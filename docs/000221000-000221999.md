# StackOverflow 问答 000221000-000221999

# java - 性能问题：在 Java 中将十六进制字符转换为其数值的最快方法？

> ID：221001
> 
> 赞同：11
> 
> 时间：2008-10-21T06:53:43.493
> 
> 标签：java, performance, algorithm

我想将表示十六进制值（大写或小写）的字符转换为字节，例如

```
'0'->0, '1' -> 1, 'A' -> 10, 'a' -> 10, 'f' -> 15 etc... 
```

我会非常频繁地调用这个方法，所以性能很重要。有没有比使用预初始化`HashMap<Character,Byte>`来获取值更快的方法？

**回答**

似乎~~在使用 switch-case 和 Jon Skeet 的直接计算解决方案之间是一个折腾——不过，switch-case 解决方案似乎略有优势。~~Greg 的数组方法胜出。以下是各种方法运行 200,000,000 次的性能结果（以毫秒为单位）：

```
Character.getNumericValue:
8360

Character.digit:
8453

HashMap<Character,Byte>:
15109

Greg's Array Method:
6656

JonSkeet's Direct Method:
7344

Switch:
7281 
```

多谢你们！

**基准方法代码**

来吧，JonSkeet，你这个老对手。;-)

```
public class ScratchPad {

    private static final int NUMBER_OF_RUNS = 200000000;

    static byte res;

    static HashMap<Character, Byte> map = new HashMap<Character, Byte>() {{
        put( Character.valueOf( '0' ), Byte.valueOf( (byte )0 ));
        put( Character.valueOf( '1' ), Byte.valueOf( (byte )1 ));
        put( Character.valueOf( '2' ), Byte.valueOf( (byte )2 ));
        put( Character.valueOf( '3' ), Byte.valueOf( (byte )3 ));
        put( Character.valueOf( '4' ), Byte.valueOf( (byte )4 ));
        put( Character.valueOf( '5' ), Byte.valueOf( (byte )5 ));
        put( Character.valueOf( '6' ), Byte.valueOf( (byte )6 ));
        put( Character.valueOf( '7' ), Byte.valueOf( (byte )7 ));
        put( Character.valueOf( '8' ), Byte.valueOf( (byte )8 ));
        put( Character.valueOf( '9' ), Byte.valueOf( (byte )9 ));
        put( Character.valueOf( 'a' ), Byte.valueOf( (byte )10 ));
        put( Character.valueOf( 'b' ), Byte.valueOf( (byte )11 ));
        put( Character.valueOf( 'c' ), Byte.valueOf( (byte )12 ));
        put( Character.valueOf( 'd' ), Byte.valueOf( (byte )13 ));
        put( Character.valueOf( 'e' ), Byte.valueOf( (byte )14 ));
        put( Character.valueOf( 'f' ), Byte.valueOf( (byte )15 ));
        put( Character.valueOf( 'A' ), Byte.valueOf( (byte )10 ));
        put( Character.valueOf( 'B' ), Byte.valueOf( (byte )11 ));
        put( Character.valueOf( 'C' ), Byte.valueOf( (byte )12 ));
        put( Character.valueOf( 'D' ), Byte.valueOf( (byte )13 ));
        put( Character.valueOf( 'E' ), Byte.valueOf( (byte )14 ));
        put( Character.valueOf( 'F' ), Byte.valueOf( (byte )15 ));
    }};
    static int[] charValues = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, -1, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,
                    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10, 11, 12, 13,14,15};
    static char[] cs = new char[]{'0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','A','B','C','D','E','F'};

    public static void main(String args[]) throws Exception {
        long time = System.currentTimeMillis();
        for( int i = 0; i < NUMBER_OF_RUNS; i++ ) {
            res = getNumericValue( i );
        }
        System.out.println( "Character.getNumericValue:" );
        System.out.println( System.currentTimeMillis()-time );
        time = System.currentTimeMillis();
        for( int i = 0; i < NUMBER_OF_RUNS; i++ ) {
            res = getDigit( i );
        }
        System.out.println( "Character.digit:" );
        System.out.println( System.currentTimeMillis()-time );
        time = System.currentTimeMillis();
        for( int i = 0; i < NUMBER_OF_RUNS; i++ ) {
            try {
                res = getValueFromArray( i );
            } catch (IllegalArgumentException e) {
            }
        }
        System.out.println( "Array:" );
        System.out.println( System.currentTimeMillis()-time );
        time = System.currentTimeMillis();
        for( int i = 0; i < NUMBER_OF_RUNS; i++ ) {
            res = getValueFromHashMap( i );
        }
        System.out.println( "HashMap<Character,Byte>:" );
        System.out.println( System.currentTimeMillis()-time );
        time = System.currentTimeMillis();
        for( int i = 0; i < NUMBER_OF_RUNS; i++ ) {
            char c = cs[i%cs.length];
            res = getValueFromComputeMethod( c );        
        }
        System.out.println( "JonSkeet's Direct Method:" );
        System.out.println( System.currentTimeMillis()-time );
        time = System.currentTimeMillis();
        for( int i = 0; i < NUMBER_OF_RUNS; i++ ) {
            res = getValueFromSwitch( i );

        }
        System.out.println( "Switch:" );
        System.out.println( System.currentTimeMillis()-time );
    }

    private static byte getValueFromSwitch( int i ) {
        byte res;
        char ch = cs[i%cs.length];
        switch( ch ) {
            case '0':
                res = 0;
                break;
            case '1':
                res = 1;
                break;
            case '2':
                res = 2;
                break;
            case '3':
                res = 3;
                break;
            case '4':
                res = 4;
                break;
            case '5':
                res = 5;
                break;
            case '6':
                res = 6;
                break;
            case '7':
                res = 7;
                break;
            case '8':
                res = 8;
                break;
            case '9':
                res = 9;
                break;
            case 'a':
            case 'A':
                res = 10;
                break;
            case 'b':
            case 'B':    
                res = 11;
                break;
            case 'c':
            case 'C':    
                res = 12;
                break;
            case 'd':
            case 'D':    
                res = 13;
                break;
            case 'e':
            case 'E':    
                res = 14;
                break;
            case 'f':
            case 'F':    
                res = 15;
                break;
            default:
                throw new RuntimeException("unknown hex character: " + ch );
        }
        return res;
    }

    private static byte getValueFromComputeMethod( char c ) {
        byte result = 0;
        if (c >= '0' && c <= '9')
        {
            result =  (byte)(c - '0');
        }
        if (c >= 'a' && c <= 'f')
        {
            result = (byte)(c - 'a' + 10);
        }
        if (c >= 'A' && c <= 'F')
        {
            result =  (byte)(c - 'A' + 10);
        }
        return result;
    }

    private static byte getValueFromHashMap( int i ) {
        return map.get( Character.valueOf( cs[i%cs.length] ) ).byteValue();
    }

    private static byte getValueFromArray( int i ) {
        char c = cs[i%cs.length];
        if (c < '0' || c > 'f') {
            throw new IllegalArgumentException();
        }
        byte result = (byte)charValues[c-'0'];
        if (res < 0) {
            throw new IllegalArgumentException();
        }
        return result;
    }

    private static byte getDigit( int i ) {
        return (byte)Character.digit( cs[i%cs.length], 16 );
    }

    private static byte getNumericValue( int i ) {
        return (byte)Character.getNumericValue( cs[i%cs.length] );
    }

} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-21T07:07:20.767

预初始化的数组会比 HashMap 更快。像这样的东西：

```
int CharValues['f'-'0'+1] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, -1, -1, ... -1, 10, 11, 12, ...};

if (c < '0' || c > 'f') {
    throw new IllegalArgumentException();
}
int n = CharValues[c-'0'];
if (n < 0) {
    throw new IllegalArgumentException();
}
// n contains the digit value 
```

您应该将此方法与其他方法（例如[Jon Skeet 的](https://stackoverflow.com/questions/221001/performance-question-fastest-way-to-convert-hexadecimal-char-to-its-number-valu#221012)直接方法）进行基准测试，以确定哪种方法对您的应用程序最快。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-21T07:00:40.657

哈希表会相对较慢。这非常快：

```
if (c >= '0' && c <= '9')
{
    return c - '0';
}
if (c >= 'a' && c <= 'f')
{
    return c - 'a' + 10;
}
if (c >= 'A' && c <= 'F')
{
    return c - 'A' + 10;
}
throw new IllegalArgumentException(); 
```

另一种选择是尝试 switch/case 语句。如果数组在缓存中，它可能没问题，但未命中可能会很昂贵。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-28T16:33:51.763

我不记得以前见过这种方法，但 Mikko Rantanen 在对问题的评论中指出了这个等式，[代码高尔夫 - 十六进制到（原始）二进制转换](https://stackoverflow.com/questions/795027/code-golf-hex-to-raw-binary-conversion)

```
(char | 32) % 39 - 9 
```

我不知道它的基准是什么（也许有人可以将它添加到上面的基准并运行它，但我猜 % 会影响性能） - 但它是一个简洁、简单的单行字符十六进制十进制转换。处理 0-9、AF、af。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-18T23:10:28.600

```
int CharValues[256] = 
{
16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,0,1,2,3,4,5,6,7,8,9,16,16,16,16,16,16,16,
16,10,11,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
16,10,11,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16
}

int n = CharValues[c];

if (n == 16)
 throw new IllegalArgumentException();

// n contains the digit value 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T07:41:57.000

使用数组应该是最快的。

数组的大小可以是 16、16^2、16^3、16^4 等。

将比一个更大的组中的数字转换会提高性能。

将有一个最值得的最佳位置，可能是 4 位数字（64k 表）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-27T04:06:34.480

伙计，我是微控制器程序员，在这个狭小的世界里，速度真的很重要。将“ASCII”数字转换为字节（从“A”到 0x0A）的最快方法是使用这段代码

```
c|=0x20;
return c<='9'? c+0xD0 : c+0xA9; 
```

这个命令的神奇之处很简单，如果你查看 ascii 表，你会发现数字以 0x3_ 开头，字母分别位于 0x4_ 和 0x6_ 列。1）如果你用0x20“或”传入的字符（变量“c”），你将永远不会改变数字......但是对于字母，你会将大写字母转换为小写字母。因为我们只寻找 A..F(a..f) 值......我不在乎别人。2）现在的魔法。为了避免减法，我使用加法运算符。0xD0 与-0x30 相同，0xA9 与-'a'+10 相同；

比较生成的分支指令非常简单，没有表查找的开销，也没有“mod”或其他运算符！

享受...

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T07:02:17.797

Character.getNumericValue(char) 是另一种方式：

```
char c = 'a';
System.out.println(c + "->" + Character.getNumericValue(c)); 
```

例如，像你想要的那样打印 'a->10' 。其他人必须评论静态方法调用与 HashMap 查找的效率，或者您可以自己检查一下。不过，它对我来说似乎更干净/更具可读性。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-21T07:41:34.210

简单但缓慢：

```
int i = Integer.parseInt(String.ValueOf(c), 16); 
```

快点：

```
int i = Character.digit(c, 16); 
```

我不会对“性能问题”使用任何特殊代码。如果你真的经常使用它，JIT 将创建编译代码并且执行会变得更快。保持代码干净。您可以尝试编写一个性能测试，比较上面代码和任何特殊实现的执行时间——我敢打赌，您不会得到显着的改进。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-21T08:00:52.907

我认为您无法击败直接数组查找。

```
static final int[] precalc = new int['f'+1];
static {
    for (char c='0'; c<='9'; c++) precalc[c] = c-'0';
    for (char c='A'; c<='F'; c++) precalc[c] = c-'A';
    for (char c='a'; c<='f'; c++) precalc[c] = c-'a';
}

System.out.println(precalc['f']); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-21T08:16:40.393

这是我对 Greg 代码的调整版本。在我的盒子上它*稍微*快一点 - 但可能在噪音范围内。它避免了下限检查，并且不需要做任何减法。创建一个 64K 数组并避免*任*一绑定检查似乎会减慢速度 - 但同样，在这样的时间安排下，几乎不可能确定什么是真实的，什么是噪音。

```
public class HexParser
{
    private static final byte VALUES = new int['f'];

    // Easier to get right for bozos like me (Jon) than
    // a hard-coded array :)
    static
    {
        for (int i=0; i < VALUES.length; i++)
        {
            VALUES[i] = (byte) -1;
        }
        for (int i='0'; i <= '9'; i++)
        {
            VALUES[i] = (byte) i-'0';
        }
        for (int i='A'; i <= 'F'; i++)
        {
            VALUES[i] = (byte) (i-'A'+10);
        }
        for (int i='a'; i <= 'f'; i++)
        {
            VALUES[i] = (byte) (i-'a'+10);
        }
    }

    public static byte parseHexChar(char c)
    {
        if (c > 'f')
        {
            throw new IllegalArgumentException();
        }
        byte ret = VALUES[c];
        if (ret == -1)
        {
            throw new IllegalArgumentException();
        }
        return ret;
    }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-28T20:43:34.703

值得注意的是，您正在为大多数测试中的 % 操作计时。此操作与其他一些选项所花费的时间大致相同。

```
private static byte lookUpTest(int i) {
    return (byte) cs[i%cs.length];
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-07-27T04:24:01.123

您可以一次查找两位数字的 16 位值表应该比其他答案中建议的 8 位值数组更快。您将以两倍的速度迭代数据，以一半的频率访问数组，并访问 short 而不是字节，所有这些都使 CPU 少做多做。

8 位值将被预先计算`x[Integer.toHexString(i).charAt[0]] = i`为`0 <= i < 256`. 然后，您只需查找十六进制字符串中的`x[c]`每个字符`c`。您可能希望复制每个十六进制值的大写和小写变体的条目。

一个 32 位值的表应该更快，这取决于你能承受多少空间。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-07-01T14:42:59.747

根据我的时间安排，以下内容优于 Jon Skeet 已经非常有效的方法。

The idea is to take advantage of the test on range 'A'..'F' to also discard one of the ranges '0'..'9' or 'a'..'f'.

```
public static int hex2Dig2(char c) {
    if (c < 'A') {
        if (c >= '0' && c <= '9')
            return c - '0';
    } else if (c > 'F') {
        if (c >= 'a' && c <= 'f')
            return c - 'a' + 10;
    } else {
        return c - 'A' + 10;
    }
    return -1; // or throw exception
} 
```

# sql - 查询以获取对象图的所有修订

> ID：221002
> 
> 赞同：0
> 
> 时间：2008-10-21T06:53:53.150
> 
> 标签：sql, sql-server, orm, union

我正在数据库上实现审核日志，因此所有内容都有 CreatedAt 和 RemovedAt 列。现在我希望能够列出对象图的所有修订，但我能想到的最好方法是使用联合。我需要获取每个唯一的 CreatedAt 和 RemovedAt id。

如果我得到一个有省份的国家列表，工会看起来像这样：

```
SELECT c.CreatedAt AS RevisionId from Countries as c where localId=@Country
UNION
SELECT p.CreatedAt AS RevisionId from Provinces as p 
INNER JOIN Countries as c ON p.CountryId=c.LocalId AND c.LocalId = @Country
UNION
SELECT c.RemovedAt AS RevisionId from Countries as c where localId=@Country
UNION
SELECT p.RemovedAt AS RevisionId from Provinces as p 
INNER JOIN Countries as c ON p.CountryId=c.LocalId AND c.LocalId = @Country 
```

对于更复杂的查询，这可能会变得非常复杂并且可能表现得很差，所以我想看看是否有人能想到更好的方法。这是在 MSSQL 服务器中。

我需要将它们全部放在一个列表中，因为这是在 from 子句中使用的，而真实数据来自加入此列表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T08:01:24.513

另一种方法是创建一个可能如下所示的审核日志：

```
AuditLog table
    EntityName varchar(2000),
    Action varchar(255),
    EntityId int,
    OccuranceDate datetime 
```

其中 EntityName 是表的名称（例如：Contries、Province），Action 是审计操作（例如：Created、Removed 等），EntityId 是原始表中修改行的主键。

该表需要在对表执行的每个操作上保持同步。有几种方法可以做到这一点：

1）在每个表上创建触发器，将行添加到 AuditTable
2）从您的应用程序中添加行到 AuditTable 中，每次对 repectivetables 进行更改

使用此解决方案非常简单地获取审计中的日志列表。

如果您需要从原始表中获取列，也可以使用如下连接：

```
select *
from 
    Contries C 
    join AuditLog L on C.Id = L.EntityId and EntityName = 'Contries' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T01:31:24.250

您很可能已经实施了您的解决方案，但要解决一些问题；我建议考虑 Aleris 的解决方案，或其一些衍生产品。

*   在您的表中，您有一个“删除于”字段——好吧，如果该字段处于活动状态（已填充），从技术上讲，数据不应该存在——或者您的实现可能已将其标记为删除，这将破坏日志记录一旦*被*移除。
    *   当您在报告期间有多个更新时会发生什么 - 以前的日志条目将被覆盖。
    *   拥有单独的日志允许对日志信息进行归档，并允许您设置与更新/编辑周期不同的日志分析周期。
    *   添加所需的任何“链接”字段，以使您能够返回原始源数据*或*使描述足够详细。

    日志中包含的字段由您决定，但 Aleris 的解决方案是直接的。我可能会创建一个动作表并将字段类型从 varchar 更改为 int，作为到动作表的链接——迫使开发人员进行一些标准化的动作。

    希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T15:45:16.527

您可能可以通过交叉连接和合并来做到这一点，但从性能的角度来看，联合可能仍然更好。您可以尝试测试每个。

```
SELECT
     COALESCE(C.CreatedAt, P.CreatedAt)
FROM
     dbo.Countries C
FULL OUTER JOIN dbo.Provinces P ON
     1 = 0
WHERE
     C.LocalID = @Country OR
     P.LocalID = @Country 
```

# macos - 可移动媒体上的 .app OSX 软件包问题

> ID：221006
> 
> 赞同：1
> 
> 时间：2008-10-21T06:56:54.703
> 
> 标签：macos, packaging, info.plist

因此，根据我对 Mac 打包的一点了解，我看到启动的实际程序是在 Info.plist 中的 CFBundleExecutable 键下定义的程序。

```
<key>CFBundleExecutable</key>
<string>JavaApplicationStub</string> 
```

现在，如果 /APP/Content/MacOS/JavaApplicationStub 不是 chmodded +x，我的应用程序将无法工作（它只是默默地失败而没有做任何事情，这很痛苦！）。很公平，我猜它是不可执行的。但是，如果您从不支持文件上的 +x 属性的地方复制应用程序，那将是一个大问题；例如 windows、fat32 USB 密钥、CDROM、网站、zip 文件等...

在这些情况下我可以做些什么来使应用程序能够运行？手动设置执行位不是一种选择。

至少会有人从 CD 上运行 Mac 应用程序！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T07:45:23.797

@mxcl，这行得通，有点，谢谢。但是，您需要在 Mac 上运行 hdiutil :(。此外，它会混淆应用程序的路径......有些文件（如 db 文件）不在 .app 文件夹中，因此是不包含在 .DMG 文件中。

我在 Windows 上构建，并且该应用程序正在部署到可移动媒体。重点是避免安装任何东西。

该应用程序也可以在 Windows 上运行，因此磁盘根目录上的 mac.app 旁边有一个 windows .exe。还有一个两个版本的应用程序共享的 sqllite.db 文件。多平台很难：/

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T07:10:01.043

我认为您唯一的选择是将 APP 捆绑包打包成 DMG 文件或 tar。

DMG 更标准，并且与使用 tar 或 zipping 一样容易。我们使用的命令行是：

```
hdiutil create -srcfolder Last.fm.app -format UDZO -imagekey zlib-level=9 -scrub Last.fm.dmg 
```

您可以从任何平台 tar，（即使是 Windows，如果您安装 cygwin，或使用 GNU 独立，[http](http://gnuwin32.sourceforge.net/packages/gtar.htm) ://gnuwin32.sourceforge.net/packages/gtar.htm ）

```
tar cf app.tar app_directory 
```

使用 gzip 压缩：

```
tar czf app.tar.gz app_directory 
```

# html - 使 html 验证成为构建周期的一部分

> ID：221018
> 
> 赞同：1
> 
> 时间：2008-10-21T07:02:15.817
> 
> 标签：html, visual-studio, validation, build-process

目前，当我建立我的网站时，我必须在 3wbc 网站上手动打开验证它（意味着当歌剧弹出时，按 ctr+alt+shft+u）为每个页面。是否可以在我构建页面时自动验证每个页面？

Ps：此页面不验证；）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T07:56:11.713

您可以下载并安装您自己的验证器副本 - [http://validator.w3.org/source/](http://validator.w3.org/source/) - 并在本地调用它，而不是为每个页面跋涉到 w3.org。尽管如此，这仍需要通过普通的 HTTP 或 API 搭载在 Web 服务器上。对于更简单的解决方案，您可能更喜欢下载W3 验证器所基于的 SP 库 - [http://www.jclark.com/sp/index.htm](http://www.jclark.com/sp/index.htm)或[http://openjade.sourceforge.net/](http://openjade.sourceforge.net/) ，然后调用命令行中的命令“nsgmls”。

当然也有很多桌面 HTML 验证器可以一次处理一批 HTML 页面，这可能不是自动化的，但肯定比手动检查每个页面要容易得多。例如[http://arealvalidator.com/](http://arealvalidator.com/) (Windows)、[http://www.webthing.com/software/validator-lite/install.html](http://www.webthing.com/software/validator-lite/install.html) (Unix)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T07:24:05.727

您可以使用验证器 API：

[http://validator.w3.org/docs/api.html](http://validator.w3.org/docs/api.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T06:05:03.633

对您来说可能不是最佳选择，但有一个 Ant 任务：[XmlValidate](http://ant.apache.org/manual/Tasks/xmlvalidate.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T18:36:44.893

如果您在 SVN 或 Git 等源代码控制中拥有 HTML 文件，则可以使用预提交挂钩脚本在它们上运行客户端验证器。或者，如果您喜欢冒险，您可以使用该方法在服务器上 ping 另一个脚本来验证实时页面......

# .net - .net SqlCommand.ExecuteReader 是否关闭连接？

> ID：221025
> 
> 赞同：4
> 
> 时间：2008-10-21T07:07:58.100
> 
> 标签：.net, sqlconnection, sqlcommand

在这句话中：

```
myCommand.ExecuteReader(CommandBehavior.CloseConnection) 
```

如果出现异常，它会关闭连接吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T07:26:23.833

进行“正常”查询的最安全方法是

```
using (var conn = new SqlConnection("..."))
{
    conn.Open();
    using (var cmd = conn.CreateCommand())
    {
        cmd.CommandText = "...";
        using (var reader = cmd.ExecuteReader())
        {
            while (reader.Read())
            {
                // ...
            }
        }
    }
} 
```

可以在此代码之外捕获异常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T07:14:00.723

命令出错的方式有很多。

最终，数据读取器的 Close 方法将关闭连接，前提是之前没有出现任何问题。

如果在 ExecuteReader 或其调用的任何方法内部发生异常，则在构造实际的 DataReader 对象之前，则不会，不会关闭连接。

如果出现异常，我不相信它会关闭连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T07:14:44.373

这取决于异常发生在哪里！

如果你正确地构建你的 try catch，那就没问题了。

例如：

```
SqlCommand myCommand = new SqlCommand();

try
{
   myCommand.dostuff();
}
catch(Exception ex)
{
  // display error message
}
finally
{
  myCommand.ExecuteReader(CommandBehavior.CloseConnection);
} 
```

如果该行： myCommand.ExecuteReader(CommandBehavior.CloseConnection) 失败（可能数据库已关闭？），则无法以编程方式关闭连接。

# java - 如何为多线程支持添加测试？

> ID：221031
> 
> 赞同：7
> 
> 时间：2008-10-21T07:13:08.103
> 
> 标签：java, multithreading, testing

我有一个 Java 服务，它现在将以批处理模式执行。多线程支持被添加到服务中，因此对于每个批处理请求，一个线程池将专门用于执行批处理。问题是我如何测试这个？我有在服务的线程版本下通过的功能测试，但不知何故，我觉得必须有一个习惯用法来测试它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T07:31:17.803

确实没有“好”的方法来做到这一点。我可以建议的最好的事情是 TestNG，它允许您注释您的测试方法并导致它们在*n 个*线程中同时执行。例如：

```
@Test(invocationCount=10, threadPool=10)
public void testSomethingConcurrently() {
    ...
} 
```

我的TestNG知识充其量是生疏的，但是AFAIK应该`testSomethingConcurrently`同时调用该方法10次。这是针对您的代码运行多线程测试的一种很好的声明方式。

您当然可以通过在循环中手动生成线程来在 JUnit 中做类似的事情，但这非常丑陋且难以使用。对于我正在从事的项目，我必须这样做一次；这些测试是一场噩梦，因为它们的失败并不总是可重复的。

由于其不确定性，并发测试很困难并且容易受挫。这就是为什么现在如此大力推动使用更好的并发抽象的部分原因，这些抽象更容易“推理”并让自己相信正确性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-04-11T15:18:28.920

我用了

```
 @Test(threadPoolSize = 100, invocationCount = 100)
    @DataProvider(parallel = true) 
```

并行执行 100 个线程 100 次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T10:22:03.340

通常导致多线程应用程序崩溃的是时间问题。我怀疑要能够在完整的多线程环境上执行单元测试，需要对代码库进行巨大更改才能做到这一点。

但是，您很可能能够做的是单独测试线程池的实现。

通过用测试代码替换线程的主体，您应该能够构建锁定和资源使用的病态条件。

然后，在可以忽略时序的单线程环境中对功能元素进行单元测试。

虽然这并不完美，但它确实保证了可重复性，这对您的单元测试非常重要。（正如 Daniel Spiewak 的回答中提到的）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T08:46:12.737

我同意丹尼尔的观点，并发测试确实非常困难。

我没有并发测试的解决方案，但我会告诉你当我想测试涉及多线程的代码时我会做什么。我的大部分测试都是使用 JUnit 和 JMock 完成的。由于 JMock 不能很好地处理多线程，因此我使用了 JMock 的扩展，它提供了 Executor 和 ScheduledExecutorService 的同步版本。这些允许我测试目标是由单个线程中的多个线程运行的代码，我还能够控制执行流程。正如我之前所说，这不会测试并发性。它仅以单线程方式检查我的代码的行为，但它减少了我在切换到多线程执行程序时遇到的错误数量。

无论如何，我推荐使用新的 Java 并发 API。它使事情变得容易得多。

# msbuild - NUnit 和 NAnt 的未来考虑

> ID：221037
> 
> 赞同：2
> 
> 时间：2008-10-21T07:19:14.160
> 
> 标签：msbuild, nunit, nant, mstest

在 .NET v1 期间，我尝试说服同事使用 NUnit 和 NAnt 的附加工具来养成测试驱动和自动化构建的工作习惯，但没有取得多大成功。当 .NET Framework 2.0 和 Visual Studio 2005 Team Suite 出现时，我能够“强制”我的团队编写测试并在 Visual Studio 中为他们自己提供可视化测试。我还能够通过额外的 MSBuild 任务来调整项目文件，以执行更多的构建自动化。

当然，这并不意味着微软已经交付了完美的系统，但我相信他们已经采取了正确的步骤。随着所有这些特性直接融入框架和产品并成为“原生”，让开发人员更容易进入更好的开发实践。

早就忘记了开源选项（我确实错过了），我想知道当前 NUnit 和 NAnt 的化身有什么价值主张？在这个阶段，有什么理由可以说服团队*不*使用 MSBuild 或 MSTest？

**澄清**：我的公司是纯微软 SI。Visual Studio Team Suite 版本、Database Professional 版本、TFS 等可供我们使用。我们不使用 Visual Studio 专业版或更低版本。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T07:38:09.643

MSBuild 是一个非常好的构建工具。我已经将它与 NAnt 和 Cruisecontrol.Net 结合使用了几次。NAnt 与 NAnt contrib 扩展一起在处理 OSS 工具（如 NUnit、NCover 等）方面似乎更加灵活，而 MSBuild 可以构建 VS 解决方案这一事实对它来说是一大优势。我发现创建构建脚本的最简单方法是使用两者，NAnt 调用构建的不同部分（构建、fxcop、测试、覆盖等）和 MSBuild 进行实际构建。

我对 MSTest 没什么好说的。安装在例如构建服务器上既慢又麻烦。它不是很灵活，并且有各种“附加”，似乎更适合于集成测试而不是单元测试。我发现轻量级 XUnit.Net、MBUnit 或 NUnit 更适合单元测试。速度在这里很重要，您希望经常运行测试以快速反馈代码更改的效果。便携性也很重要。您希望在没有安装团队系统的机器上进行 MSTest 所需的大量设置和黑客攻击，让测试在任何地方运行。尽管单元测试并不新鲜，但仍有很多开发工作正在进行中。最佳实践发生了很大变化，工具也发生了很大变化。我不 不想被绑定到每隔几年才使用 Visual Studio 升级的工具。三个 OSS .net 单元测试工具中的每一个都设置为可扩展的。MSTest 不是（据我所知）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T07:38:35.807

在我看来，NUnit 是 .NET 中单元测试的事实标准。它是免费的，您可以在任何版本的 Visual Studio 中轻松编写测试。如果 MS 在 VS 2005 Pro 中提供了 MS Test（就像在 VS 2008 Pro 中一样），它现在可能已经接管了 - 但我认为为时已晚。

我认为 ReSharper 对 Visual Studio 来说基本上是必不可少的，它包括一个很好的测试运行器，它与 NUnit 配合得很好。如果我正在开发一个开源项目，为什么需要 VS 2008 Pro 或 VS 2005 Team Suite？

MSBuild 与 NAnt 略有不同，因为 MSBuild 与框架或 SDK 捆绑在一起（我现在不记得是哪个了）——但我认为 NAnt 是一个更令人愉快的工作环境。MSBuild 显然更适合做原始“构建解决方案”位 - 但您可以从 NAnt 调用它。

# sql - 记录级权限

> ID：221040
> 
> 赞同：3
> 
> 时间：2008-10-21T07:23:54.213
> 
> 标签：sql, security, permissions

在我正在设计的数据库中，我已经实现了基于配置文件的对象级安全性。

每个用户都可以根据他所属的配置文件（角色）查看、编辑、插入、更新数据库表。

现在需要实现“外部用户”，他们只能查看相关记录并编辑其中的一些记录（但不能编辑数据库的大部分内容）。

我正在研究“记录所有权”模型。

是否有关于如何限制属于“外部用户”配置文件的用户查看和使用每个表的一些记录的任何想法，但不是全部。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T08:34:30.623

您可以创建一个 VIEW，或者您可以创建选择的存储过程并只为这些过程分配权限。

VIEW 是采用简单安全模型的方法——如果它很复杂，请使用存储过程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T08:27:30.623

您可能应该创建一个 VIEW 来限制记录，然后在视图上应用适当的权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T16:37:33.940

我有我的初稿。它是这样的：

该应用程序是一个项目管理/问题跟踪/事件管理/协作 Web 应用程序。

我创建了一个角色“外部用户”。默认情况下，该角色的用户

*   可以从人员中选择
*   可以从单位中选择（组织单位-公司-部门等）
*   可以选择分配给他的项目
*   可以选择分配给他的任务
*   不能选择任何其他项目和任务

管理员可以创建一个用户组“外部合作伙伴”并分配给该用户组一些项目和产品（有问题）

该组的成员可以选择分配的对象。

这是一个复杂的解决方案，但也是唯一解决我的客户问题的解决方案（他们不希望外部合作伙伴访问他们所有的项目数据库）。

# javascript - 滚动 div 内的 Flash - IE6 错误

> ID：221043
> 
> 赞同：0
> 
> 时间：2008-10-21T07:24:57.020
> 
> 标签：javascript, html, flash, internet-explorer-6, swfobject

我有一个包含 Flash 对象列表的 div。列表很长，所以我将 div 高度设置为 400 并溢出为自动。

这在 FF 上运行良好，但在 IE6 上只有前 5 个可见的 flash 对象有效。当我向下滚动时，最初位于可视区域之外的其余 Flash 对象是空的。swf 加载正常，因为我没有得到“电影未加载”。它们似乎也被正确嵌入，它们只是空的，即。内容永远不会被绘制。

有想法该怎么解决这个吗？

附言。涉及的html元素主要是浮动的，以防对此产生影响。Flash 对象是使用流行的 swfObject 嵌入的。

编辑：似乎该错误仅发生在 Flash 插件“WIN 8,0,24,0”中

由于我无法发布链接，我将在这里总结相关代码：

```
<div style="overflow:auto; height:400px; float:left;">
<div id="item_1" style="float:left; clear:left; height:100px;">
<!-- swfObject Embed here -->
</div>
...
<div id="item_7" style="float:left; clear:left; height:100px;">
<!-- swfObject Embed here -->
</div>
</div> 
```

编辑：在尝试在单独的页面中重新创建此问题后，我发现该错误与最初隐藏的 flash 对象有关。加载页面时，我的容器 div 具有“显示：无；可见性：隐藏”。后来样式通过javascript更改为可见。如果我加载页面以便从一开始就可以看到所有内容，那么一切都很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-21T14:51:01.113

当我在 IE6 中测试这类东西时，我做的第一件事就是开始删除样式信息。首先从父 DIV 和子 DIV 中删除所有浮动和清除。如果这不起作用，请删除所有填充和边距，并为父 DIV 和子 DIV 分别设置 100% 的宽度（保留 100 像素的高度）。如果这不起作用，请返回此处。如果我不得不冒险猜测，我会说这是因为您的 DIV 都没有宽度，但根据我对“peekaboo bug”的了解，这是一个疯狂的猜测。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T22:13:58.567

我会尝试的几件事：

*   暂时删除所有 CSS 以确定问题是否特定于 CSS
*   为浮动元素及其父元素添加像素宽度
*   将 wmode 透明参数添加到 swfobject
*   添加位置：相对

我听说过Flash 中的一个错误，该错误显然仅在Flash 在屏幕外加载部分内容时才会出现（即body > #flash {margin-top:-50px}）。您的问题可能是这种情况的变体。

或者，您可以完全删除带有溢出的 div，并尝试在带有滚动条的 flash 中创建一个容器，然后将各个 SWF 加载到该容器 flash 文件中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T12:04:06.860

这只是一种解决方法，但是您可以尝试最初为 Flash 对象创建占位符（例如具有相应高度和宽度的 div），并且仅在电影第一次可见时才加载电影（通过类似[swfobject](http://code.google.com/p/swfobject/)的东西）。这可能会产生一些问题（即电影在可见之前没有预加载），但它可能是可以接受的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T14:15:24.790

我想我有一个解决方案。我不能绝对肯定，因为有问题的页面已经重组（因为这个错误）。后来我偶然发现了一个类似的问题，在不同的页面上使用相同的 Flash 组件。

问题是有时 flash 会给出 Stage.height=0 和 Stage.width=0。当 Flash 在浏览器视口之外启动时，最有可能发生这种情况。我们使用舞台尺寸来缩放内容（在本例中为 width=0 和 height=0）。

解决方案是添加一个 onEnterFrame 处理程序，用于检查 Stage 尺寸，并且仅在它们 > 0 时继续。

# filesystems - 如何从 Windows 分布式文件系统中删除文件夹？

> ID：221051
> 
> 赞同：0
> 
> 时间：2008-10-21T07:28:23.487
> 
> 标签：filesystems, microsoft-distributed-file-system

我们最近搬到了一个网络农场并设置了 dfs，却发现一个 beta 应用程序正在创建文件，就像没有明天一样。在整个场中复制了 120 万个文件，从那时起，我们一直阻止应用程序创建新文件，但每次我们尝试删除文件时，由于复制，它会在每台服务器上替换它们。替换它们的过程实际上会导致服务器运行缓慢，并且在某些情况下会停止。

有什么方法可以在文件夹级别停止复制？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-17T00:37:10.177

然后我猜你的设置有些可疑，因为 FRS 还复制跨服务器的删除

# build-process - 用于 C++ 项目构建自动化的 NAnt 脚本

> ID：221052
> 
> 赞同：2
> 
> 时间：2008-10-21T07:28:31.770
> 
> 标签：build-process, nant

任何人都可以提供任何用于 C++ 项目构建自动化的 NAnt 脚本示例吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T16:35:32.853

如果您说的是 Microsoft Visual C++，那么我认为您可以通过从 nant 脚本中删除 msbuild.exe 并在命令行上将您的解决方案文件传递给它来获得最大的控制权。这在 Visual Studio 2005/.Net Framework 2.0 及更高版本中受支持。例如：

```
<property name="msbuild.dir" value="C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727" />

...

<exec program="${msbuild.dir}\MSBuild.exe"
    commandline="/p:Configuration=Release .\MySolution.sln" 
/> 
```

无论使用何种语言（c#、VB、C++ 等），它都会在您的解决方案中构建所有内容

麦克风

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T08:00:19.240

如果项目在 Visual Studio 中，那么你可以使用该`<Solution>`任务，我认为。这是最简单/最丑陋的方法。

**编辑：**刚刚意识到SO在那里过滤掉了我的小XML标签。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T10:28:45.213

我最近在寻找此类信息，并找到了有关它的博客条目：http: [//seclib.blogspot.com/2005/05/building-native-c-projects-with-nant.html](http://seclib.blogspot.com/2005/05/building-native-c-projects-with-nant.html)

# macos - 什么时候可以为 Mac Port 提供 boost 1.36？

> ID：221063
> 
> 赞同：0
> 
> 时间：2008-10-21T07:35:47.200
> 
> 标签：macos, boost

我怎样才能找到这些信息？

* * *

IE，

我可以使用类似的命令安装 boost 1.35

```
sudo port install boost 
```

只是为了通过端口提升 1.36，我会做这样的事情吗？

```
sudo port install boost-1.36 
```

希望能解决我的问题

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-21T07:39:24.680

Boost 网站分发源代码，可以在任何支持的平台（包括 Mac）上编译。因此，它现在可用。

* * *

这取决于您使用的包管理器。OS X 没有自带，因此任何包装都将由第三方提供。如果您使用[MacPorts](http://www.macports.org/)安装软件，请[提交错误](http://trac.macports.org/newticket)请求更新版本的 Boost 包。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T07:41:10.607

Boost 1.36 已经可用于 OS X： http: [//www.boost.org/users/download/version_1_36_0](http://www.boost.org/users/download/version_1_36_0)

不确定您到底要问什么，但 OS X 是该版本的受支持平台，并且所有平台的源下载都是相同的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T13:52:44.147

现在我看到您正在寻找 MacPorts 更新，除了按照 John 的建议提交错误之外，您可能会发现联系 boost macport 包维护者并询问它何时可用很有用。联系信息可在此处获得：[http ://www.macports.org/ports.php?by=library&substr=boost](http://www.macports.org/ports.php?by=library&substr=boost)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T01:03:59.267

我相信[这](https://trac.macports.org/ticket/16378)是相关的票。

票证中有一个新的 Portfile，这对我来说很好用。

我相信由于与 Python 和 MPI 相关的问题，票仍然是开放的。

# java - 非法尝试将集合与两个打开的会话相关联

> ID：221079
> 
> 赞同：13
> 
> 时间：2008-10-21T07:44:36.980
> 
> 标签：java, hibernate, spring, transactions

我正在尝试将 pojo 添加到另一个 pojo 的集合中。我确定我在某个地方犯了一个非常愚蠢的错误，但我不知道如何解决它。

我有一个包含列列表的 pojo LookupTable：

```
public class LookupTable {
  private long id;
  // More properties go here...
  private List<Column> columns;

  public void addColumn(Column column) {
    this.columns.add(column);
  }

  // More methods go here...
} 
```

在我的休眠配置中，我有：

```
<class name="LookupTable" table="ARR_LOOKUP_TABLE">
  <id name="id" column="ID">
    <generator class="native"/>
  </id>
  <!-- Some properties here -->
  <bag name="columns" cascade="all,delete-orphan" access="field">
    <key column="LOOKUP_TABLE" not-null="true"/>
    <one-to-many class="Column"/>
  </bag>
</class>

<class name="Column" table="ARR_LOOKUP_COLUMN">
  <id name="id" column="ID">
    <generator class="native"/>
  </id>
  <!-- Some properties here -->
</class> 
```

在我的 Spring 配置文件中，我有：

```
<tx:advice id="txAdvice" transaction-manager="txManager">
  <tx:attributes>
    <tx:method name="*" propagation="REQUIRED"/>
  </tx:attributes>
</tx:advice>
<aop:config>
  <aop:pointcut id="managers" expression="execution(public * com.foo.*Manager.*(..))"/>
  <aop:advisor advice-ref="txAdvice" pointcut-ref="managers"/>
</aop:config> 
```

最后是我的管理器类（com.foo.LookupTableManager）中所有失败的代码：

```
public void addColumnToTable(Column column, long tableId) {
  LookupTable lookupTable = this.lookupTableDao.findById(tableId);
  lookupTable.addColumn(column);
  this.lookupTableDao.saveOrUpdate(lookupTable);
} 
```

这里的变量lookupTableDao 是指一个简单的DAO 类，它扩展了HibernateDaoSupport。

我得到的错误是：

```
org.hibernate.HibernateException: Illegal attempt to associate a collection with two open sessions
  at org.hibernate.collection.AbstractPersistentCollection.setCurrentSession(AbstractPersistentCollection.java:410)
  at org.hibernate.event.def.OnUpdateVisitor.processCollection(OnUpdateVisitor.java:43)
  at org.hibernate.event.def.AbstractVisitor.processValue(AbstractVisitor.java:101)
  at org.hibernate.event.def.AbstractVisitor.processValue(AbstractVisitor.java:61)
  at org.hibernate.event.def.AbstractVisitor.processEntityPropertyValues(AbstractVisitor.java:55)
  at org.hibernate.event.def.AbstractVisitor.process(AbstractVisitor.java:123)
  at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.performUpdate(DefaultSaveOrUpdateEventListener.java:293)
  at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.entityIsDetached(DefaultSaveOrUpdateEventListener.java:223)
  at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.performSaveOrUpdate(DefaultSaveOrUpdateEventListener.java:89)
  at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.onSaveOrUpdate(DefaultSaveOrUpdateEventListener.java:70)
  at org.hibernate.impl.SessionImpl.fireSaveOrUpdate(SessionImpl.java:507)
  at org.hibernate.impl.SessionImpl.saveOrUpdate(SessionImpl.java:499)
  at org.hibernate.impl.SessionImpl.saveOrUpdate(SessionImpl.java:495)
  at com.foo.AbstractDao.saveOrUpdate(AbstractDao.java:29)
  at com.foo.LookupTableManager.addColumnToTable(LookupTableManager.java:338)
... etc ... 
```

好的，我了解我收到的基本信息。但我不明白的是我在哪里获得第二次会议......有人可以帮助我吗？

我正在使用 Hibernate 3.2.6.ga、Spring 2.5.5 和 Tomcat 6.0

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T08:40:44.370

结果我根本没有交易。我在其他配置文件之一中使用了几乎相同的事务配置。

那边的切入点也被称为“经理”，所以我的顾问在这里引用了另一个文件中的切入点。

*重命名切入点解决了我的问题。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T08:00:46.790

我的猜测是`lookupTableDao.findById`调用在一个会话中获取您的对象，但这`lookupTableDao.saveOrUpdate`是一个不同的会话 - 您如何`Session`通过 Spring 获取对象？

`Column`对象来自哪里- 已经在数据库上还是新的？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-16T16:58:13.273

问题在于 Open Session In 视图过滤器映射。它在 getSession 和其他保存时创建了一个会话。

您只能将 singleSession 更改为 false 默认为 true

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-10-09T15:17:24.230

显然使用合并可能会解决问题

```
myInstance = (myInstanceClass) Session.merge(myInstance); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-04-09T09:13:52.377

我的以下代码遇到了同样的问题：我想更新某个实体商店。我从这个方法中检索它：

```
@Override
public Store getStoreByStoreId(final long storeId) {
    getHibernateTemplate().execute(new HibernateCallback<Store>() {
        @Override
        public StoredoInHibernate(Session session) throws HibernateException, SQLException {
            return (Store) session.createCriteria(Store.class)
                    .add(Restrictions.eq(Store.PROP_ID, storeId))
                    .uniqueResult();
        }
    });
} 
```

然后，我用以下方法更新商店：

```
@Override
public void updateStoreByStoreId(final long storeId) {
    getHibernateTemplate().execute(new HibernateCallback<Void>() {
        @Override
        public Void doInHibernate(Session session) throws HibernateException, SQLException {
            Store toBeUpdated =  getStoreByStoreId(storeId);

            if (toBeUpdated != null){
                // ..change values for certain fields
                session.update(toBeUpdated);
            }
            return null;
        }
    });
} 
```

事实证明，我收到了“非法尝试...”错误，因为 get 方法的第一个会话没有关闭，而我试图用另一个会话更新商店。我的解决方案是在更新方法中移动检索要更新的商店的调用。

```
@Override
public void updateStoreByStoreId(final long storeId) {
    getHibernateTemplate().execute(new HibernateCallback<Void>() {
        @Override
        public Void doInHibernate(Session session) throws HibernateException, SQLException {
            Store toBeUpdated =  (Store) session.createCriteria(Store.class)
                    .add(Restrictions.eq(Store.PROP_ID, storeId))
                    .uniqueResult();

            if (toBeUpdated != null){
                // ..change values for certain fields
                session.update(toBeUpdated );
            }
            return null;
        }
    });
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-10T20:55:15.573

如果您只想对部分代码进行事务处理，则可以使用以下内容：

```
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction; 
```

在课堂上：

```
@Autowired private SessionFactory sessionFactory; 
```

稍后，围绕应该在同一事务中执行操作的代码：

```
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

Stuff stuff = getStuff();
manipulate(stuff);
send(stuff);
save(stuff);

tx.commit(); 
```

我在一些长时间运行的批处理作业的循环中使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-09-22T22:14:27.300

我使用的是 Windows 服务器 IIS，只是将 AppPool Managed Pipeline 模式从 Integrated 更改为 Classic 解决了我的问题。

谢谢

# javascript - 如何使用 Perl 的 LWP 提取网站的 XML 并保存在文件中？

> ID：221091
> 
> 赞同：3
> 
> 时间：2008-10-21T07:50:49.260
> 
> 标签：javascript, xml, perl, extract, lwp

如何从网站 ( [http://tv.yahoo.com/listings](http://tv.yahoo.com/listings) ) 中提取信息，然后从中创建 XML 文件？我想保存它以便稍后解析并使用 JavaScript 显示信息？

我对 Perl 很陌生，我不知道该怎么做。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T07:59:42.707

当然。最简单的方法是**[Web::Scraper](http://p3rl.org/Web::Scraper)**模块。它的作用是让您定义刮板对象，这些对象包括

1.  哈希键名，
2.  定位感兴趣元素的 XPath 表达式，
3.  以及从中提取数据位的代码。

Scraper 对象采用 URL 并返回提取数据的哈希值。如有必要，每个键的提取器代码本身可以是另一个刮板对象，以便您可以定义如何刮取重复的复合页面元素：提供 XPath 以在外部刮板中查找复合元素，然后提供更多 XPath 来拉取在内部刮刀中取出其各个位。结果会自动成为一个嵌套的数据结构。

简而言之，您可以非常优雅地将整个页面中的数据吸入 Perl 数据结构中。这样做时，XPath + Perl 的全部功能可用于任何页面。由于页面是用 HTML::TreeBuilder 解析的，所以它的 tagoup 有多糟糕并不重要。生成的爬虫脚本比基于正则表达式的爬虫更容易维护，并且更能容忍微小的标记变化。

坏消息：到目前为止，它的文档几乎不存在，所以你必须通过谷歌搜索类似 [ [miyagawa web::scraper](http://www.google.com/search?um=1&ie=UTF-8&oe=UTF-8&q=miyagawa+web%3A%3Ascraper) ] 来找到模块​​作者发布的示例脚本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T16:53:33.703

虽然通常[LWP::Simple](http://search.cpan.org/perldoc?LWP::Simple)或[WWW::Mechanize](http://search.cpan.org/perldoc?WWW::Mechanize)和[HTML::Tree](http://search.cpan.org/perldoc?HTML::Tree)是从网页中提取数据的好方法，但在这种特殊情况下（电视节目表），有一种更简单的方法：

将[XMLTV](http://wiki.xmltv.org/index.php/XMLTVProject)与来自[Schedules Direct](http://www.schedulesdirect.org/)的数据一起使用。收取少量费用（20 美元/年），但有以下优势：

1.  解析代码已经为您编写好了（只是`use XMLTV;`）。
2.  您不会违反雅虎的服务条款。
3.  您不必与 Yahoo 积极尝试破坏您的脚本打交道。（他们不喜欢自动脚本拉下电视节目表；见 #2。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T17:27:54.773

如果要将信息传递给 Javascript，请使用 Javascript 对象表示法 (JSON) 而不是 XML。有很多 Perl 库，例如[JSON::Any](http://search.cpan.org/dist/JSON-Any)，可以为您处理这些问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T21:58:24.103

tv.yahoo.com 不是很语义化，也不是很容易抓取！它们可能是更好的替代品或饲料？

使用 pQuery 我可以快速获取时间和节目......

```
use pQuery;
pQuery( 'http://tv.yahoo.com/listings' )
    ->find( '.show' )->each(
        sub {
            my $n = shift;
            my $pQ = pQuery( $_ ); 
            say $pQ->text;
        }
    );

  # => 4:00pm - 6:30pm Local Programming 
```

要了解更多细节，你可以试试这个....

```
use pQuery;
my @tv_progs;
pQuery( 'http://tv.yahoo.com/listings' )
    ->find( 'li div strong' )->each(
        sub {
            my $n = shift;
            my $pQ = pQuery( $_ ); 
            $tv_progs[ $n ]->{ time } = $pQ->text;
        }
    )
    ->end
    ->find( '.showTitle' )->each( 
        sub {
            my $n = shift;
            my $pQ = pQuery( $_ ); 
            $tv_progs[ $n ]->{ name } = $pQ->text;
        }
    );

for my $prog ( @tv_progs ) {
    say $prog->{name} . " @ " . $prog->{time};
}

   # => Local Programming @ 4:00pm - 6:30pm 
```

并获得频道....

```
use pQuery;
pQuery( 'http://tv.yahoo.com/listings' )
->find( '.chhdr a' )->each(
    sub {
        my $n = shift;
        my $pQ = pQuery( $_ ); 
        say $pQ->text;
    }
);

  # => ABC 
```

然而，将反向频道与节目信息相匹配需要一些工作；-)

# python - 在 python 2.3 上，Windows 执行具有多个参数和路径中空格的 Ghostscript 之类的程序的最佳方法是什么？

> ID：221097
> 
> 赞同：4
> 
> 时间：2008-10-21T07:56:33.943
> 
> 标签：python, windows, ghostscript

肯定有某种抽象允许这样做吗？

这本质上是命令

```
cmd = self._ghostscriptPath + 'gswin32c -q -dNOPAUSE -dBATCH -sDEVICE=tiffg4 
      -r196X204 -sPAPERSIZE=a4 -sOutputFile="' + tifDest + " " + pdfSource + '"'

os.popen(cmd) 
```

这种方式对我来说看起来很脏，一定有一些pythonic方式

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T08:00:56.213

使用[subprocess](http://docs.python.org/library/subprocess)，它取代了 os.popen，尽管它不是一个抽象：

```
from subprocess import Popen, PIPE
output = Popen(["mycmd", "myarg"], stdout=PIPE).communicate()[0]

#this is how I'd mangle the arguments together
output = Popen([
    self._ghostscriptPath, 
   'gswin32c',
   '-q',
   '-dNOPAUSE',
   '-dBATCH',
   '-sDEVICE=tiffg4',
   '-r196X204',
   '-sPAPERSIZE=a4',
   '-sOutputFile="%s %s"' % (tifDest, pdfSource),
], stdout=PIPE).communicate()[0] 
```

如果你只有没有子进程模块的 python 2.3，你仍然可以使用 os.popen

```
os.popen(' '.join([
    self._ghostscriptPath, 
   'gswin32c',
   '-q',
   '-dNOPAUSE',
   '-dBATCH',
   '-sDEVICE=tiffg4',
   '-r196X204',
   '-sPAPERSIZE=a4',
   '-sOutputFile="%s %s"' % (tifDest, pdfSource),
])) 
```

# ide - 设计师/向导生成的代码属于什么许可证？

> ID：221098
> 
> 赞同：9
> 
> 时间：2008-10-21T07:56:58.327
> 
> 标签：ide

这可能是一个愚蠢的问题，但我只是想确保......

如果我将 IDE（在本例中为 Visual Studio）生成的代码合并到我的软件中，我可以将我自己的许可证应用于该代码还是受其自己的许可证约束？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T08:23:34.780

我不是律师，但我相信根据您的输入生成的代码与任何其他程序的输出基本相同。在这种情况下，输出通常被认为属于应用程序的用户（您）而不是应用程序的开发人员。

[GPL FAQ 涵盖了一个类似的主题](http://www.gnu.org/licenses/gpl-faq.html#GPLOutput)：

> **有什么方法可以让人们从使用我的程序中获得输出？例如，如果我的程序用于开发硬件设计，我是否可以要求这些设计必须是免费的？**
> 
> 一般来说，这在法律上是不可能的；版权法在使用人们使用您的程序从他们的数据中生成的输出时没有给您任何发言权。如果用户使用你的程序输入或转换他自己的数据，输出的版权属于他，而不是你。更一般地说，当程序将其输入转换为其他形式时，输出的版权状态会继承它生成的输入的版权状态。
> 
> 因此，您对使用输出有发言权的唯一方法是，是否从程序中的文本中复制（或多或少）输出的大部分内容。例如，如果我们在这种特定情况下没有例外，Bison 的部分输出（见上文）将被 GNU GPL 覆盖。
> 
> 即使没有技术原因，您也可以人为地让程序将某些文本复制到其输出中。但是，如果复制的文本没有实际用途，用户可以简单地从输出中删除该文本并仅使用其余文本。这样他就不必遵守重新分发复制文本的条件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T08:36:27.453

在一般情况下，您应该仔细阅读向导/代码生成器附带的许可证。

在绝大多数情况下，向导（或编译器或预处理器等）生成的代码是与生成器本身完全分离的实体，并且没有对其施加任何限制。

但是，在某些情况下，可以在生成的代码中插入受版权保护的代码，例如作为支持生成代码的一组函数。

同样在这种情况下，大多数代码生成器都声明该片段代码是在非常宽松的条款下获得许可的。试图限制代码修改和重新分发或强加运行时版税已证明是一种非常糟糕的商业模式。例如，我已经看到大型机上的旧程序生成器使用它，但从那时起就不多了。

因此，在 99.9% 的情况下，您可以对生成的代码做任何您想做的事情，只需阅读细则以涵盖剩余的 0.1%

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T08:21:49.197

VS 生成的代码基于您的输入，因此实际上您只是从高级语言（数据集设计器或表单设计器）“编译”到低级语言 C# 或 VB。我认为这与根据您的源代码生成机器代码或 IL 的编译器没有什么不同。

# garbage-collection - 完整的用户数据 __gc 元方法是否需要释放（）它的内存？

> ID：221106
> 
> 赞同：3
> 
> 时间：2008-10-21T08:00:07.667
> 
> 标签：garbage-collection, lua

我在用 C 编写的 Lua 模块中有一个完整的用户数据。用户数据有`__gc()`元方法，由垃圾收集器调用。lua解释器在`__gc()`调用后释放用户数据内存，还是我必须在`free()`里面`__gc()`？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T09:32:55.343

您不应该释放内存，因为您自己没有 malloc() ；Lua 为你做这两件事。事实上，正如[Lua 5.1 参考手册](http://www.lua.org/manual/5.1/manual.html)中的第 2.10.1 节所述，内存甚至没有在同一个垃圾收集周期中被收集。

# java - xdoclet vs xdoclet2？

> ID：221108
> 
> 赞同：2
> 
> 时间：2008-10-21T08:00:33.640
> 
> 标签：java, hibernate, ant, xdoclet

我正在更新一个旧项目，并且我的 xdoclet 版本在解析 Hibernate (hibernate3) 标签时抱怨我的 Java 1.5 annontations (ArrayList data = ....)。

所以我的问题是这个...

是否有针对 Xdoclet 1.2.3 的修复程序，或者我应该转向 Xdoclet2 吗？

我已经开始移动一些代码，但是 xdoclet2 似乎没有为 hibenate 提供相同级别的配置，例如 excludetags。不过，我可能是错的。

大家怎么看？

杰夫·波特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T13:26:16.633

我肯定会失去 xdoclet 以支持 JPA 注释。您可以使用 JPA 注释从 Hibernate 获得相同的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T12:45:24.517

回答最初的问题：我有一个类似（相同？）的问题，这是由随 xdoclet 1.2.3 分发的 xjavadoc 版本引起的。

XJavadoc 提供了修复兼容性的快照版本。将 xdoclet-release 中的 jar 替换为您可以找到的作为[此 JIRA 问题](http://jira.codehaus.org/browse/MAVENUPLOAD-1399)附件的 jar （找不到直接 URL），事情应该会更好......

# asp.net - ASP.NET MVC 准备好用于业务应用程序（集成第 3 方控件/组件）了吗？

> ID：221120
> 
> 赞同：3
> 
> 时间：2008-10-21T08:08:34.013
> 
> 标签：asp.net, asp.net-mvc, controls

我的公司已经开发（并且仍在继续开发）一个大型 ASP.NET 业务应用程序。我们的平台是使用一些 ASP.NET Ajax 的 ASP.NET 2.0。我们**广泛使用第三方组件**，例如 webgrids、comboboxes、treeviews、日历和调度控件等。

现在，我不太了解 ASP.NET MVC，我想知道是否有**办法在 ASP.NET MVC 模型中使用这些第三方控件**。或者供应商是否必须重写他们的产品才能使它们适合 ASP.NET MVC？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T08:18:05.337

如果他们使用 ASP.NET 控件模型（这将是 ASP.NET 控件供应商编写的大约 99.9% 的控件），他们必须重写他们的控件。其中有多少工作，取决于他们的控件的架构而有很大的不同——他们已经使用的 ajax 越多，他们就越容易将其更改为 MVC。

用于示例的 ASP.NET AJAX 控件工具包可以与 MVC 一起使用。您可以在 WWW.ASP.NET 上的视频中看到如何做到这一点：[http ://www.asp.net/learn/mvc-videos/video-373.aspx](http://www.asp.net/learn/mvc-videos/video-373.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T08:43:20.230

许多控件需要重写，因为它们中的大多数都需要经典 ic webforms 中的回发模型。并且在 asp.net mvc 中没有回发。

所以：组件需要回发吗？-> 不能在 asp.net mvc 中工作

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T10:39:02.857

作为记录。我收到了 Telerik 电子邮件通讯，其中包含一些有趣的消息：

*“我们最令人兴奋的产品创新之一是 RadControls for ASP.NET AJAX 能够在新的 Microsoft ASP.NET MVC 框架中工作。” [...]*

链接：[Microsoft ASP.NET MVC 中的 Telerik RadControls](http://blogs.telerik.com/VladimirEnchev/Posts/08-10-02/Telerik_RadControls_in_Microsoft_ASP_NET_MVC.aspx?ReturnURL=%2fVladimirEnchev%2fPosts.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T08:24:10.677

ISV 市场肯定在追赶 MVC，但这是有道理的——它还不是 RTM（尽管最后一个预览版至少有明确的“上线”许可证）。常规的 Webforms 控件几乎需要重写。

我不认为主要参与者需要很长时间才能赶上，但是如果您使用的是较小公司的产品，则可能很难将其优先考虑 MVC。一个（非常hacky）选项可能是使用IFRAME 或AJAX 将页面的一部分视为单独的aspx 页面......真的，真的很讨厌。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T17:57:00.243

当市场份额如此之低时，您必须质疑第 3 方市场对创建 mvc 控件的兴趣。他们似乎只想专注于 webforms 和 silverlight/wpf 控件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-12T07:29:47.847

我正在审查 mvc 的同步融合工具（刚刚下载）。值得一看。似乎实际上是为 MVC 设计的。

# php - MODx 的 PHP 博客系统

> ID：221124
> 
> 赞同：0
> 
> 时间：2008-10-21T08:12:35.240
> 
> 标签：php, blogs, modx

[我使用MODx](http://modxcms.com/)内容管理系统运行一个站点。我想做的是在首页上设置一个新闻提要，并带有一个支持常见事物（标签、类别、档案）的博客风格的后端。

我研究了提供此功能的 MODx 插件（已弃用的 NewsPublisher - 我们目前使用的 - 和同上），但我不太喜欢其中任何一个。我真正想要的是带有 API 的东西，这样我就可以轻松地以编程方式添加新闻。

我考虑过安装 WordPress，但是考虑到我们只是以一种相当基本的方式使用它，这似乎有点过头了！我也考虑过推出自己的产品，但在我这样做之前，我只是想检查一下那里已经没有合适的东西了！

有没有人对具有良好 API 的轻量级、高度可定制的 PHP 博客/新闻框架有任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-12-06T19:22:21.040

我认为值得您花时间在 MODx 上试用文章系统。请参阅[此处](http://rtfm.modx.com/extras/revo/articles/articles.creating-a-blog)开始。

我经常将 Wordpress 用作博客引擎，当我第一次涉足 MODx 时，我对事情对我来说似乎是多么粗糙感到震惊。这个文章系统比我第一次遇到的其他 MODx 博客教程更接近我的预期。你得到的东西更像是一个几乎没有黑客攻击的工作博客。

当然......使用 MODx 中的块、片段和模板......如果你对它的基本结构感到满意，你应该能够让它做任何事情。

[哎呀：我刚刚注意到这个问题有多老了。嗬！]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T08:22:35.763

> **[Chyrp](http://chyrp.net/)**似乎是一个有趣的选择：干净、轻量级的 php/mysql/一些 ajax（John Gruber今年早些时候[注意到了它）](http://daringfireball.net/linked/2008/february#wed-06-chyrp)

# asp.net - PDFCreator 和 ASP.NET

> ID：221126
> 
> 赞同：2
> 
> 时间：2008-10-21T08:13:15.673
> 
> 标签：asp.net, pdf-generation

有没有人设法让 PDFCreator 在 ASP.NET 2.0 网站上运行？

在我的带有 Visual Studio 网络服务器的开发机器上，按照以下步骤操作就可以了：

*   使用 tlbimp 创建一个 com 互操作 dll
*   引用这个dll
*   写一些代码来使用它

但是，当我将它部署到我们的测试服务器时，它会因以下错误而惨遭失败：

```
Retrieving the COM class factory for component with CLSID {082391C9-8188-4364-B4FD-66A1524B2097} failed due to the following error: 80070005.
Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: System.UnauthorizedAccessException: Retrieving the COM class factory for component with CLSID {082391C9-8188-4364-B4FD-66A1524B2097} failed due to the following error: 80070005\. 
```

而且我在 DCOMCNFG.msc 中找不到这个组件。

我们的服务器配置：

*   视窗 2003
*   ASP.NET 2.0
*   微软办公室 XP
*   PDFCreator 0.9.0

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T19:10:32.043

问题是 IIS 进程（以及 ASP.Net 进程）作为 SYSTEM 帐户运行，它没有设置任何打印机。

你有两个选择：

1 - 使用Craig Lebakken 提供的[文章](http://support.microsoft.com/kb/184291/en-us)为系统帐户设置打印机

2 - 模拟 ASP.Net 站点以使用设置了打印机的帐户

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T15:00:59.437

以下 Microsoft 知识库文章描述了该问题和解决方案：

[从 ASP 调用 COM 对象时无法打印](http://support.microsoft.com/kb/q184291/)

# java - SQL Server JDBC 可信连接身份验证如何工作？

> ID：221149
> 
> 赞同：0
> 
> 时间：2008-10-21T08:24:27.133
> 
> 标签：java, sql-server, jdbc, jna, trustedconnection

SQL Server JDBC 可信连接身份验证如何工作？（即受信任的连接如何以如此透明和优雅的方式对登录的 AD 用户进行身份验证，以及如何在没有数据库连接或任何使用现有 SQL Server 解决方案的情况下，在 Java 中为我的客户端-服务器应用程序实现类似的身份验证解决方案.)

假设 * 在 Windows 2003 域中工作 * 您可以通过 JNI/JNA 访问 Windows API

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T21:06:36.517

这取决于客户。例如，如果您有一个 Web 浏览器，它可以使用 NTLM 身份验证将您当前客户端的域身份验证传递给服务器。在这种情况下，IE 或 FF 等浏览器支持此功能，而您的 Web 服务器需要支持 NTLM。例如这里的 Tomcat：http: [//jcifs.samba.org/src/docs/ntlmhttpauth.html](http://jcifs.samba.org/src/docs/ntlmhttpauth.html)

还有与 Kerberos 结合使用的 SPNEGO 协议，如下所述：http: [//java.sun.com/javase/6/docs/technotes/guides/security/jgss/lab/index.html](http://java.sun.com/javase/6/docs/technotes/guides/security/jgss/lab/index.html)

如果您有自己的客户端，它是否能够使用本地用户的安全上下文并能够传递它取决于客户端的框架。上面的页面至少针对 kerberos 场景描述了这一点。

问候伯恩德

PS：我不确定您是否可以将使用 jcifs/ntmlm 解决方案建立的身份验证上下文传递给 SQL Server 等后端组件。它应该适用于 Kerberos 票证（如果已配置）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T04:14:18.757

jTDS 和 Microsoft JDBC 驱动程序都提供本地 Windows 身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T13:23:05.237

你看过[这个问题](https://stackoverflow.com/questions/167464/can-i-connect-to-sql-server-using-windows-authentication-from-java-ee-webapp)吗？情况似乎与您的情况相似（使用 Windows 身份验证连接到 SQL Server 数据库）。

# objective-c - 调用 performSelectorOnMainThread => 多线程应用程序？

> ID：221152
> 
> 赞同：4
> 
> 时间：2008-10-21T08:27:12.683
> 
> 标签：objective-c, cocoa, multithreading

我注意到来自我的主线程的以下平庸调用

```
[self performSelectorOnMainThread:@selector(rollBar:)
      withObject:nil
      waitUntilDone:false]; 
```

导致`[NSThread isMultiThreaded]`报告我的应用程序
已成为多线程。我认为这只应该
在您分离线程时发生，
在一个线程中排队消息不应该需要做的事情。

有什么见解吗？

[这个问题和这个](https://stackoverflow.com/questions/149388/low-level-details-of-the-implementation-of-performselectoronmainthread)问题不一样。

**停止按**
我的错，`rollBar:`叫`[m_progress_bar incrementBy: 0.5];`。
漂亮的、可舔的、动画`NSProgressIndicator`负责
使我的应用程序成为多线程的。这是令人惊讶的。
我不知道。

令人惊讶的是，`[m_progress_bar usesThreadedAnimation]`总是
返回`NO`，即使我的应用程序挂起时栏会动画。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T12:30:25.453

你确定吗？我将以下代码放在我的 appDelegate 的 init 方法中：

```
`NSLog(@"Multi-threaded before? %@", [NSThread isMultiThreaded] ? @"Yes" : @"No");
[self performSelectorOnMainThread: @selector(setDelegate:) withObject: self waitUntilDone: NO];
NSLog(@"Multi-threaded after? %@", [NSThread isMultiThreaded] ? @"Yes" : @"No");` 
```

`并在控制台中得到了这个结果：`

 ````
`**2008-10-21 07:26:28.296 MyApplication[82963:20b] Multi-threaded before? No
2008-10-21 07:26:28.297 MyApplication[82963:20b] Multi-threaded after? No**` 
```

**我还在我的 applicationWillTerminate: 方法中添加了第二`NSLog(...)`条语句，它还告诉我它不是多线程的。**

 **# c# - How can I Convert a Big decimal number to Hex in C# (Eg : 588063595292424954445828)

> ID：221154
> 
> 赞同：1
> 
> 时间：2008-10-21T08:27:33.070
> 
> 标签：c#, decimal, hex, type-conversion

The number is bigger than `int` & `long` but can be accomodated in `Decimal`. But the normal `ToString` or `Convert` methods don't work on `Decimal`.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T08:29:40.803

Do it manually!

[http://www.permadi.com/tutorial/numDecToHex/](http://www.permadi.com/tutorial/numDecToHex/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T08:55:20.160

I believe this will produce the right results where it returns anything, but may reject valid integers. I dare say that can be worked around with a bit of effort though... (Oh, and it will also fail for negative numbers at the moment.)

```
static string ConvertToHex(decimal d)
{
    int[] bits = decimal.GetBits(d);
    if (bits[3] != 0) // Sign and exponent
    {
        throw new ArgumentException();
    }
    return string.Format("{0:x8}{1:x8}{2:x8}",
        (uint)bits[2], (uint)bits[1], (uint)bits[0]);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T08:33:22.873

I've got to agree with James - do it manually - but don't use base-16\. Use base 2^32, and print 8 hex digits at a time.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T08:39:45.277

I guess one option would be to keep taking chunks off it, and converting individual chunks? A bit of mod/division etc, converting individual fragments...

So: what hex value do you expect?

Here's two approaches... one uses the binary structure of decimal; one does it manually. In reality, you might want to have a test: *if* bits[3] is zero, do it the quick way, *otherwise* do it manually.

```
 decimal d = 588063595292424954445828M;
    int[] bits = decimal.GetBits(d);
    if (bits[3] != 0) throw new InvalidOperationException("Only +ve integers supported!");
    string s = Convert.ToString(bits[2], 16).PadLeft(8,'0') // high
            + Convert.ToString(bits[1], 16).PadLeft(8, '0') // middle
            + Convert.ToString(bits[0], 16).PadLeft(8, '0'); // low
    Console.WriteLine(s);

    /* or Jon's much tidier: string.Format("{0:x8}{1:x8}{2:x8}",
            (uint)bits[2], (uint)bits[1], (uint)bits[0]);  */

    const decimal chunk = (decimal)(1 << 16);
    StringBuilder sb = new StringBuilder();
    while (d > 0)
    {
        int fragment = (int) (d % chunk);
        sb.Insert(0, Convert.ToString(fragment, 16).PadLeft(4, '0'));
        d -= fragment;
        d /= chunk;
    }
    Console.WriteLine(sb); 
```

# c - TIOCM_OUT1 和 TIOCM_OUT2 有什么用？

> ID：221160
> 
> 赞同：5
> 
> 时间：2008-10-21T08:30:56.183
> 
> 标签：c, serial-port, device

`termios.h`定义：

```
#define TIOCM_OUT1      0x2000
#define TIOCM_OUT2      0x4000 
```

但是旗帜有什么用呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T18:59:45.510

```
TIOCM_OUT1 = Unassigned Programmable Output #1
TIOCM_OUT2 = Unassigned Programmable Output #2 
```

看起来它们可用于设置 MCR 中的`OUT1`和`OUT2`位。
但是未分配的可编程输出有什么用呢？
我最好的理解是它们在环回模式下用于中断，最好不要用于任何事情（因为它们打算在内部使用）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-24T16:52:31.813

它们用作类似于 DTR 等的信号线。它们是“未分配的”，因此可以使用。所以理论上你可以用它们来表示带外的一些特殊情况，这非常方便。

**但是**，除非您正在构建自己的硬件解决方案，否则我不会将它们用于**任何事情：商品串行硬件通常仅支持最常见用途的最低要求。**即，它通常**不**完全符合 RS-232（或 RS-XXX）。

# database - 使用 URI 的 md5 哈希作为数据库主键的优缺点

> ID：221165
> 
> 赞同：24
> 
> 时间：2008-10-21T08:33:12.153
> 
> 标签：database, primary-key, guid, md5, uri

我正在构建一个数据库，该数据库将存储有关一系列对象（例如科学论文、标本、DNA 序列等）的信息，这些对象都在线存在并且可以通过 URL 或诸如[DOI](http://www.doi.org/ "DOI")之类的标识符来识别. 使用这些 GUID 作为对象的主键似乎是一个合理的想法，并且我在使用 GUID 的 md5 哈希时遵循了[美味](http://delicious.com/ "可口的")和[Connotea 。](http://www.connotea.org "内涵")如果您将鼠标悬停在美味或 Connotea 书签中的编辑或删除按钮上，您将在浏览器状态栏中看到 md5 哈希。例如，[http://stackoverflow/](http://stackoverflow/)的书签是

```
http://delicious.com/url/e4a42d992025b928a586b8bdc36ad38d 
```

其中 e4a42d992025b928a586b8bdc36ad38d a 是[http://stackoverflow/](http://stackoverflow/)的 md5 哈希值。

有人对这种方法的优缺点有看法吗？

对我来说，这种方法的一个优点（与使用由数据库本身生成的自动递增主键相反）是我必须在对象之间做很多链接，并且通过使用 md5 哈希，我可以将这些链接外部存储在一个文件中（例如，作为数据挖掘/抓取的结果），然后将它们批量导入数据库。同样，如果必须从头开始重建数据库，则指向对象的 URL 不会更改，因为它们使用 md5 哈希。

我欢迎任何关于这听起来是否合理的想法，或者是否有其他（更好的？）方法来做到这一点。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T22:44:25.560

It's perfectly fine.

Accidental collision of MD5 is impossible in all practical scenarios (to get a 50% chance of collision you'd have to hash 6 *billion* URLs *per second*, every second, for 100 years).

It's such an improbable chance that you're trillion times more likely to get your data messed up due to an undetected hardware failure than due to an actual collision.

Even though there is a known collision attack against MD5, intentional malicious collisions are currently impossible against hashed URLs.

*   The type of collision you'd need to intentionally collide with a hash of another URL is called a **pre-image** attack. There are no known pre-image attacks against MD5\. As of 2017 there's no research that comes even close to feasibility, so even a determined well-funded attacker can't compute a URL that would hash to a hash of any existing URL in your database.

*   The only known collision attack against MD5 is not useful for attacking URL-like keys. It works by generating a pair of binary blobs that collide *only with each other*. The blobs will be relatively long, contain NUL and other unprintable bytes, so they're extremely unlikely to resemble anything like a URL.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T09:02:22.503

在浏览了更多stackoverfow之后，我发现了一个较早的问题[GUID / UUID数据库键的优点和缺点，](https://stackoverflow.com/questions/45399/advantages-and-disadvantages-of-guid-uuid-database-keys)它涵盖了这个领域的大部分内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T09:07:07.267

多个字符串可以产生相同的 md5 哈希。主键必须是唯一的。所以使用散列作为主键是不好的。更好的是直接使用 GUID。

是适合在 URL 中使用的 GUID。当然。这是我使用 Java 创建的 GUID（实际上是 UUID）：1ccb9467-e326-4fed-b9a7-7edcba52be84

网址可以是：

```
http://example.com/view?id=1ccb9467-e326-4fed-b9a7-7edcba52be84 
```

它很长，但完全可用，并达到了您的描述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T08:39:35.310

也许这个文档是你想阅读的东西：

[http://www.hpl.hp.com/techreports/2002/HPL-2002-216.pdf](http://www.hpl.hp.com/techreports/2002/HPL-2002-216.pdf)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T08:49:32.387

通常有很多不同的 url 指向同一个页面。 [http://example.com/](http://example.com/) example.com [http://www.example.com/](http://www.example.com/) [http://example.com/index.html](http://example.com/index.html) [http://example.com/](http://example.com/)。 [https://example.com/](https://example.com/) 等。

这对您来说可能是也可能不是问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-03T11:34:52.490

MD5 被认为已弃用 - 至少出于加密目的，但我建议仅使用 md5 与现有东西向后兼容。当我们确实有其他没有（至少）被破坏的哈希算法时，你应该有充分的理由使用 md5。

我在该方法中看到的问题：

*   重复的对象，因为 url 标识符不同（如 arend 所述）
*   网址变化

后者可能很重要——这可以像删除和添加一样简单地完成。也就是说，如果这些 id 在数据库之外永远不可见/不可存储。（就像作为 URL 的组成部分一样。）

我想这些对于 DOI 来说不会是问题。

* * *

它如何与非自动编号整数 id 设置一起工作，但离线插入器代理在哪里创建数字？（可以使用专用的数字范围吗？）如果两个用户独立添加相同的 url，可能会出现重复问题？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-02-27T04:57:01.880

md5 散列几乎是唯一的，但并非完全唯一，因此不要将其用作主键。它因加密使用而折旧。密钥冲突的可能性较小，但如果你有数十亿行的相当大的数据库，仍然有一些冲突的机会。如果您坚持使用哈希作为主键，请使用其他更好的哈希。您不能对主键使用非唯一值。如果您有很大的桌子，请不要使用它。如果你有小桌子，你可能会使用它，但不推荐。

# apache-flex - 如何在 Flex/Actionscript3 中编写通用属性修改函数？

> ID：221169
> 
> 赞同：0
> 
> 时间：2008-10-21T08:35:52.557
> 
> 标签：apache-flex, actionscript-3, events, event-handling, flexbuilder

我是 Flex 的新手，虽然对编程并不陌生。我想编写一个通用事件处理程序，当我的所有文本输入框收到焦点时，它们都会调用它。当他们有焦点时，我想改变文本输入框的颜色。当他们失去焦点时，我想恢复“非活动”颜色配置文件。我可以为每个文本输入框编写一个 ActionScript 事件处理程序，但我们都知道这很糟糕。:o) 那么，我需要的是一种访问正在调用事件处理程序的对象的方法。

在 Delphi 中，我编写了一个传入 Sender 对象的函数，允许我访问调用对象的属性。我猜 ActionScript/Flex 有一个完全不同的架构，这就是为什么我很难做到这一点。

感谢期待！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T08:43:11.620

我希望我能理解您的要求...您是在谈论事件委托吗？

这对我有用：

```
// 'focusOut' for blur
stage.addEventListener('focusIn', function(e:Event):void {
    // The focused control is e.target
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T08:43:11.777

您应该继承 TextInput 并在其中处理焦点事件。我认为这将是在没有任何复杂代码的情况下实现您正在寻找的最简单的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T15:48:27.747

如果你想改变焦点输入框的外观，你可以通过设置`focusSkin`属性来做到这一点。如果您希望这在全局范围内发生，您可以在您的 CSS 文件中放置一个样式声明。

在这个 CSS 示例中，我将默认的 focusSkin ( `mx.skins.halo.HaloFocusRect`) 替换为嵌入的 PNG 文件。

```
TextInput {
  focusSkin: Embed(source="focus.png");
} 
```

TextInput 具有一些用于更改焦点外观的属性，例如更改焦点皮肤的不透明度（`focusAlpha`属性）。查看[TextInput 文档](http://livedocs.adobe.com/flex/3/langref/mx/controls/TextInput.html)以获取更多信息。

# fortran - Fortran 中的私有函数

> ID：221170
> 
> 赞同：14
> 
> 时间：2008-10-21T08:36:21.307
> 
> 标签：fortran

如何在 Fortran 中声明私有函数？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-21T15:25:52.510

这仅适用于 Fortran 90 模块。在您的模块声明中，您可以使用“public”和“private”关键字指定变量和例程列表的访问限制。我通常发现最初单独使用 private 关键字很有帮助，它指定模块中的所有内容都是私有的，除非明确标记为 public。

在下面的代码示例中，subroutine_1() 和 function_1() 可以通过必要的“use”语句从模块外部访问，但任何其他变量/子例程/函数都是私有的。

```
module so_example
  implicit none

  private

  public :: subroutine_1
  public :: function_1

contains

  ! Implementation of subroutines and functions goes here  

end module so_example 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-06-18T22:03:15.350

如果使用模块，语法如下：

```
PUBLIC  :: subname-1, funname-2, ...

PRIVATE :: subname-1, funname-2, ... 
```

PRIVATE 中列出的所有实体都不能从模块外部访问，而 PUBLIC 中列出的所有实体都可以从模块外部访问。默认情况下，可以从模块外部访问所有其他实体。

```
MODULE  Field
  IMPLICIT   NONE

  Integer :: Dimen

  PUBLIC  :: Gravity
  PRIVATE :: Electric, Magnetic

CONTAINS

  INTEGER FUNCTION  Gravity()
    ..........
  END FUNCTION Gravity

  REAL FUNCTION  Electric()
    ..........
  END FUNCTION

  REAL FUNCTION  Magnetic()
    ..........
  END FUNCTION

  ..........

END MODULE  Field 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T08:40:18.270

我从来没有写过 FORTRAN 的一行，但是[这个关于“私有模块过程”](http://coding.derkeiler.com/Archive/Fortran/comp.lang.fortran/2004-01/1100.html)的主题似乎很热门，至少我希望如此。至少似乎包含答案。

* * *

*贾雷多*总结：

> public/private 属性存在于 Fortran 90 及更高版本的模块中。Fortran 77 及更早版本——你运气不好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T14:07:14.680

```
Private xxx, yyy, zzz

real function xxx (v)
  ...
end function xxx

integer function yyy()
  ...
end function yyy

subroutine zzz ( a,b,c )
  ...
end subroutine zzz

... 
other stuff that calls them
... 
```

# spring - 谁能指出我的 Spring MVC、Tiles、Freemarker 集成示例？

> ID：221178
> 
> 赞同：1
> 
> 时间：2008-10-21T08:42:23.230
> 
> 标签：spring, tiles, freemarker

在我基于 Spring MVC 的应用程序中，我使用 Freemarker，我非常喜欢它，但它缺乏复合视图模式提供的优势。

我正在考虑尝试将 Tiles2 与 Freemarker 一起使用 - 有谁知道我在哪里可以找到 SpringMVC 和 Tiles2+Freemarker 的简单示例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T07:24:25.960

没关系，我已经解决了。我只需要在瓷砖定义文件中指定 freemarker 模板

```
<definition name="template" template="/WEB-INF/ftl/main.ftl"> 
```

并将 freemarker servlet/maping 添加到 web.xml

```
<servlet>
    <servlet-name>freemarker</servlet-name>
    <servlet-class>freemarker.ext.servlet.FreemarkerServlet</servlet-class>

    <!-- FreemarkerServlet settings: -->
    <init-param>
        <param-name>TemplatePath</param-name>
        <param-value>/</param-value>
    </init-param>
    <init-param>
        <param-name>NoCache</param-name>
        <param-value>true</param-value>
    </init-param>
    <init-param>
        <param-name>ContentType</param-name>
        <param-value>text/html</param-value>
    </init-param>

    <!-- FreeMarker settings: -->
    <init-param>
        <param-name>template_update_delay</param-name>
        <param-value>0</param-value> <!-- 0 is for development only! Use higher value otherwise. -->
    </init-param>
    <init-param>
        <param-name>default_encoding</param-name>
        <param-value>ISO-8859-1</param-value>
    </init-param>
    <init-param>
        <param-name>number_format</param-name>
        <param-value>0.##########</param-value>
    </init-param>

    <load-on-startup>5</load-on-startup>
</servlet>  

 <servlet-mapping>
    <servlet-name>freemarker</servlet-name>
    <url-pattern>*.ftl</url-pattern>
 </servlet-mapping> 
```

在 spring 配置中指定瓷砖作为我的主要视图引擎

```
<bean id="tilesConfigurer" class="org.springframework.web.servlet.view.tiles2.TilesConfigurer">
        <property name="definitions">
            <list>
                <value>/WEB-INF/defs/definitions.xml</value>
            </list>
        </property>
</bean>
<bean id="viewResolver" class="org.springframework.web.servlet.view.UrlBasedViewResolver">
        <property name="viewClass" value="org.springframework.web.servlet.view.tiles2.TilesView"/>
</bean> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T07:28:21.317

您可以使用的另一个产品来代替 Tiles 是[SiteMesh](http://www.opensymphony.com/sitemesh/)，我在一些应用程序中使用过它。值得一试。

# c - 如何从 Windows 程序访问类似 netstat 的以太网统计信息

> ID：221181
> 
> 赞同：5
> 
> 时间：2008-10-21T08:43:11.277
> 
> 标签：c, windows, networking, ethernet, network-monitoring

如何从**netstat -e**等 C/C++ 代码访问以太网统计信息？

```
Interface Statistics

                       Received            Sent

Bytes                      21010071        15425579
Unicast packets               95512           94166
Non-unicast packets           12510               7
Discards                          0               0
Errors                            0               3
Unknown protocols                 0 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T09:04:52.560

WMI 将提供这些读数：

```
SELECT * FROM Win32_PerfFormattedData_Tcpip_IP
SELECT * FROM Win32_PerfFormattedData_Tcpip_TCP
SELECT * FROM Win32_PerfFormattedData_Tcpip_UDP
SELECT * FROM Win32_PerfFormattedData_Tcpip_ICMP
SELECT * FROM Win32_PerfFormattedData_Tcpip_Networkinterface 
```

这些类在 Windows XP 或更高版本上可用。您可能不得不放弃 Windows 2000 上匹配的“Win32_PerfRawData”类，并在显示输出之前做更多的数学运算。

在 MSDN 中找到[所有这些的文档。](http://msdn.microsoft.com/en-us/library/aa394084(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T09:06:51.883

Windows IPHelper 函数中的[GetIpStatistics](http://msdn.microsoft.com/en-us/library/aa365959(VS.85).aspx)调用是开始进行网络统计的好地方。

还有其他几种可能更便携的方法：-

*   SNMP。需要在计算机上启用 SNMP，但显然也可以用于检索远程计算机的统计信息。
*   将“netstat”的输出通过管道传输到您的应用程序中，然后从文本中取消选择值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:28:27.063

让我回答自己，因为我在另一个论坛上问过同样的问题。

WMI 很好，但改用 IpHlpApi 更容易：

```
#include <winsock2.h>
#include <iphlpapi.h>

int main(int argc, char *argv[])
{

PMIB_IFTABLE pIfTable;
MIB_IFROW ifRow;
PMIB_IFROW pIfRow = &ifRow;
DWORD dwSize = 0;

// first call returns the buffer size needed
DWORD retv = GetIfTable(pIfTable, &dwSize, true);
if (retv != ERROR_INSUFFICIENT_BUFFER)
    WriteErrorAndExit(retv);
pIfTable = (MIB_IFTABLE*)malloc(dwSize);

retv = GetIfTable(pIfTable, &dwSize, true);
if (retv != NO_ERROR)
    WriteErrorAndExit(retv);

// Get index
    int i,j;
    printf("\tNum Entries: %ld\n\n", pIfTable->dwNumEntries);
    for (i = 0; i < (int) pIfTable->dwNumEntries; i++)
    {
        pIfRow = (MIB_IFROW *) & pIfTable->table[i];
        printf("\tIndex[%d]:\t %ld\n", i, pIfRow->dwIndex);
        printf("\tInterfaceName[%d]:\t %ws", i, pIfRow->wszName);
        printf("\n");
        printf("\tDescription[%d]:\t ", i);
        for (j = 0; j < (int) pIfRow->dwDescrLen; j++)
            printf("%c", pIfRow->bDescr[j]);
        printf("\n");
        ... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T08:58:51.883

齐亚，

来自[http://en.wikipedia.org/wiki/Netstat](http://en.wikipedia.org/wiki/Netstat)

> 在 Windows 平台上，可以通过调用 IP Helper API 或 IPHLPAPI.DLL 中的 GetTcpTable 和 GetUdpTable 函数来检索 netstat 信息。返回的信息包括本地和远程 IP 地址、本地和远程端口以及（对于 GetTcpTable）TCP 状态代码。除了 Windows 附带的命令行 netstat.exe 工具外，还有基于 GUI 的 netstat 程序可用。在 Windows 平台上，仅当 Internet 协议 (TCP/IP) 协议作为组件安装在网络连接中的网络适配器属性中时，此命令才可用。

CodeProject 上的 MFC 示例：http: [//www.codeproject.com/KB/applications/wnetstat.aspx](http://www.codeproject.com/KB/applications/wnetstat.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T09:06:17.703

您可能会找到一个可行的[WMI 性能计数器](http://msdn.microsoft.com/en-us/library/aa392738(VS.85).aspx)，例如[Win32_PerfRawData_Tcpip_NetworkInterface](http://msdn.microsoft.com/en-us/library/aa394340(VS.85).aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T16:03:19.640

看Google Groups，原netstats源码已经贴过很多次了（win32 api）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-31T17:06:20.230

正如上面的答案所暗示的，WMI 性能计数器包含一些数据。请注意，在更高版本的 Windows 中，性能计数器在 v4 和 v6 中被分解，因此查询是：

选择 * 从 Win32_PerfFormattedData_Tcpip_IPv4

选择 * 从 Win32_PerfFormattedData_Tcpip_TCPv4

选择 * 从 Win32_PerfFormattedData_Tcpip_UDPv4

选择 * 从 Win32_PerfFormattedData_Tcpip_ICMP

选择 * 从 Win32_PerfFormattedData_Tcpip_IPv6

选择 * 从 Win32_PerfFormattedData_Tcpip_TCPv6

选择 * 从 Win32_PerfFormattedData_Tcpip_UDPv6

选择 * 从 Win32_PerfFormattedData_Tcpip_ICMPv6

# c++ - 如何在 Unix 控制台/Mac 终端中编译和运行 C/C++ 代码？

> ID：221185
> 
> 赞同：161
> 
> 时间：2008-10-21T08:43:35.380
> 
> 标签：c++, c, macos, console, terminal

如何在 Unix 控制台或 Mac 终端中编译/运行 C 或 C++ 代码？

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2008-10-21T09:10:24.793

如果是简单的单源程序，

```
make foo 
```

如果源文件是*foo.c*、*foo.cpp*等，你甚至不需要生成文件。Make 有足够的内置规则将您的源文件构建为同名的可执行文件，减去扩展名。

运行刚刚构建的可执行文件与运行任何程序相同 - 但您通常需要指定可执行文件的路径，因为 shell 只会搜索其中的内容`$PATH`以查找可执行文件，而且通常不包括当前目录 ( `.`）。

所以要运行构建的可执行文件`foo`：

```
./foo 
```

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2008-10-21T08:46:38.930

```
gcc main.cpp -o main.out
./main.out 
```

* * *

## 回答 #3

> 赞同：74
> 
> 时间：2011-02-24T18:02:03.813

这是适用于所有 Unix 机器的命令……我在 Linux/Ubuntu 上使用它，但它也适用于 OS X。**在Terminal.app**中键入以下命令。

```
g++ -o lab21 iterative.cpp 
```

`-o`是字母 O，而不是零

`lab21`将是您的可执行文件

`iterative.cpp`是你的 C++ 文件

运行该命令后，在终端中键入以下内容以运行您的程序：

```
./lab21 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2014-07-28T11:52:50.720

对我来说两个步骤：

第一的：

```
make foo 
```

然后：

```
./foo 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-10-22T07:51:33.080

Unix（Linux、Mac OS X、AIX 等）环境中的所有应用程序执行都取决于可执行文件搜索路径。

您可以使用以下命令在终端中显示此路径：

> 回声 $PATH

在 Mac OS X（默认）上，这将显示以下冒号分隔的搜索路径：

> /usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin

因此，列出目录中的任何可执行文件都可以通过键入其名称来运行。例如：

> 猫 mytextfile.txt

这将运行`/bin/cat`并将 mytextfile.txt 显示到终端。

要运行不在可执行文件搜索路径中的任何其他命令，您需要限定可执行文件的路径。因此，假设我在 Mac OS XI 的主目录中有一个名为 MyProgram 的可执行文件，可以像这样完全限定它：

> /用户/奥利弗/我的程序

如果您位于要执行的程序附近的位置，则可以使用部分路径限定名称。例如，如果`MyProgram`在我的目录中`/Users/oliver/MyProject`，并且我在我的主目录中，我可以像这样限定可执行文件名称，并让它执行：

> 我的项目/我的程序

或者说我在目录中`/Users/oliver/MyProject2`并且我想执行`/Users/oliver/MyProject/MyProgram`我可以使用这样的相对路径来执行它：

> ../我的项目/我的程序

同样，如果我在同一个目录中，`MyProgram`我需要使用“当前目录”相对路径。您所在的当前目录是句点字符后跟一个斜杠。例如：

> ./我的程序

要确定您当前使用的是哪个目录，请使用该`pwd`命令。

如果您通常将程序放在硬盘上您希望运行而无需限定其名称的位置。例如，如果您的主目录中有一个“bin”目录，用于存放其他程序的常用 shell 脚本，那么更改可执行文件搜索路径可能是明智之举。

这可以通过`.bash_profile`在主目录中创建或编辑现有文件并添加以下行来轻松完成：

```
#!/bin/sh
export PATH=$PATH:~/bin 
```

这里波浪号 (~) 字符被用作 /Users/oliver 的快捷方式。另请注意，井号 (#!) 行必须是文件的第一行（如果它尚不存在）。另请注意，此技术要求您的登录 shell 是 bash（Mac OS X 和大多数 Linux 发行版上的默认设置）。另请注意，如果您希望安装的程序`~/bin`优先于系统可执行文件使用，则应重新排序导出语句，如下所示：

```
export PATH=~/bin:$PATH 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-12-04T23:38:28.900

在“终端”中执行所有这些操作。

要使用 G++ 编译器，您需要这样做：

1.  导航到存储 *.cpp 文件的目录。

    `cd ~/programs/myprograms/` （~ 是您家的快捷方式，即 /Users/Ryan/programs/myprograms/，替换为您实际使用的位置。）

2.  编译它

    `g++ input.cpp -o output.bin`（*output.bin*可以是任何具有任何扩展名的东西，真的。扩展名 .bin 在 Unix 上很常见。）

    如果成功应该*没有任何返回，这***没关系**。通常，您会因失败而获得回报。

    但是，如果您键入`ls`，您将看到同一目录中的文件列表。例如，您会看到其他文件夹*input.cpp*和*output.bin*

3.  从目录内部，现在执行它`./outbut.bin`

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2015-01-14T04:07:36.243

一种紧凑的方法可能是：

```
make foo && ./$_ 
```

很高兴有一个单行，这样您就可以轻松地再次重新运行您的可执行文件。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-21T08:45:46.373

假设当前目录不在路径中，则语法为`./[name of the program]`.

例如`./a.out`

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2018-04-11T10:33:31.287

要编译 C 或 C++ 程序，有一个常用命令：

1.  `make filename`

2.  `./filename`

*make*会将您的源文件构建为具有相同名称的可执行文件。但是如果你想使用标准的方式，你可以使用`gcc`编译器来构建 C 程序和`g++`C++。

对于 C：

```
gcc filename.c

./a.out 
```

对于 C++：

```
g++ filename.cpp

./a.out 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-10-21T08:52:01.697

添加以下内容以获得最佳警告，您将不会后悔。如果可以，请使用 WISE 进行编译（*警告为错误*）。

```
- Wall -pedantic -Weffc++ -Werror 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2021-04-08T16:53:09.477

第 1 步 - 使用命令创建一个 cpp 文件

```
touch test.cpp 
```

第 2 步 - 运行此命令

```
g++ test.cpp 
```

第 3 步 - 运行您的 cpp 文件

```
./a.out 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-21T08:58:47.393

使用`makefile`. 即使对于非常小的（= 一个文件）项目，付出努力可能也是值得的，因为您可以拥有几组编译器设置来测试事物。以这种方式调试和部署工作更容易。

阅读[`make`手册](http://www.gnu.org/software/make/manual/make.html)。乍一看似乎很长，但大多数部分你可以略读。总而言之，这花了我几个小时，让我更有效率。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-12-22T18:40:40.010

我找到了这个带有方向的链接：

[http://www.wesg.ca/2007/11/how-to-write-and-compile-c-programs-on-mac-os-x/](http://www.wesg.ca/2007/11/how-to-write-and-compile-c-programs-on-mac-os-x/)

基本上你这样做：

```
gcc hello.c
./a.out (or with the output file of the first command) 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-10-05T11:49:31.703

只需输入 .c/.cpp 文件所在的目录即可。

用于编译和运行 C 代码。

```
gcc filename.c
./a.out filename.c 
```

用于编译和运行 C++ 代码。

```
g++ filename.cpp
./a.out filename.cpp 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-06-14T18:46:18.787

为了从 Mac 终端编译和运行 C++ 源代码，需要执行以下操作：

1.  如果 .cpp 文件的路径是 somePath/fileName.cpp，首先进入路径为 somePath 的目录
2.  要编译*fileName.cpp*，请键入`c++ fileName.cpp -o fileName`
3.  要运行程序，请键入`./fileName`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-08-23T07:06:31.593

使用终端运行 .C 文件是一个两步过程。第一步是在终端输入 gcc 并将 .C 文件拖放到终端，然后按`Enter`：

```
gcc /Desktop/test.c 
```

在第二步中，运行以下命令：

```
~/a.out 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-06-05T12:33:05.187

要运行 C++ 文件，请运行以下命令，*假设*文件名为“main.cpp”。

1.  编译以从 C++ 文件生成目标文件。

    ```
    g++ -c main.cpp -o main.o 
    ```

2.  由于`#include <conio.h>`macOS 不支持，我们应该使用 Mac 支持的替代方案。那就是`#include <curses.h>`。现在需要将目标文件转换为可执行文件。要使用文件*curses.h*，我们必须使用 library `-lcurses`。

    ```
    g++ -o main main.o -lcurses 
    ```

3.  现在运行可执行文件。

    ```
    ./main 
    ```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-12-13T03:59:50.963

您需要进入保存文件的文件夹。编译代码：`gcc fileName` 您也可以使用`g++ fileName` 这将编译您的代码并创建一个二进制文件。现在在同一文件夹中查找二进制文件并运行它。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-02-09T01:39:27.763

我正在使用带有[Apple M1 Pro](https://en.wikipedia.org/wiki/Apple_M1_Pro_and_M1_Max)芯片的新[MacBook Pro 。](https://en.wikipedia.org/wiki/MacBook_Pro)我安装了[Xcode](https://en.wikipedia.org/wiki/Xcode) - IDE 和命令行工具。这就是它对我的工作方式：

```
g++ one.cpp -o one

./one 
```

# javascript - JQuery 和框架 - $(document).ready 不起作用

> ID：221192
> 
> 赞同：16
> 
> 时间：2008-10-21T08:46:35.140
> 
> 标签：javascript, jquery, frames

我有一个页面，其中包含一些 js 和 jQuery 代码，并且运行良好。但不幸的是，我所有的网站都非常旧，并且使用框架。因此，当我将页面加载到框架内时，`$(document).ready()`不会启动。

我的框架集如下所示：

```
<frameset rows="79,*" frameBorder="1" frameSpacing="1" bordercolor="#5996BF" noresize> 
    <frame name="header" src="Operations.aspx?main='Info.aspx'" marginwidth="0" marginheight="0" scrolling="no" noresize frameborder="0">
    <frame name="main" src="Info.aspx" marginwidth="0" marginheight="0" scrolling="auto" noresize frameborder="0">      
</frameset> 
```

我的页面已加载到`main`框架中。我应该怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-06-17T18:11:56.073

我尝试了另一条评论中提到的方法：

```
$("#frameName").ready(function() {
    // Write you frame on load javascript code here
} ); 
```

它对我不起作用。

这做到了：

```
$("#frameName").load( function() {
     //code goes here
} ); 
```

即使事件不会很快触发 - 它也会等到图像和 css 也加载完毕。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-07-04T05:36:22.077

我知道这是一个老话题。但是为了帮助一些到达此页面的人，这是我的解决方案：

```
$($("#frameName")[0].contentWindow.document).ready(function() {
    // Write you frame onready code here
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T19:13:51.053

我认为这是我在 iframe 中使用 DOMContentLoaded 时遇到的类似问题。

我写[了一篇关于它的博客文章](http://www.zachleat.com/web/2008/12/04/domcontentloaded-inconsistencies/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-27T07:39:26.520

如果要`onload`为帧触发事件，请按照下列步骤操作：

1.  为每个标签分配一个`id`和。确保两者和属性值相同。`name``<frame>``id``name`

2.  使用以下代码触发`onload`框架事件：

    ```
    $("frameName").ready(function() { 
      // Write your frame onload code here
    } 
    ```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-31T15:23:10.840

以下内容也对我有用：

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
<script>
$(window.parent.frames[0].document).ready(function() {
    // Do stuff
});
</script> 
```

[0] 表示它是文档中的第一帧，[1] 表示第二帧，依此类推。如果您无法控制标记，这将特别好，并且它仍在使用准备好的文档。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T10:30:22.963

您是否尝试将 jQuery 代码放在 Info.aspx 页面中？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-08T06:12:20.577

我在这篇文章上工作了很长时间......这是我的解决方案。

测试.html

```
<!DOCTYPE HTML>
<html>
<head>
    <script src="http://code.jquery.com/jquery-latest.js"></script>

    <script>        
      document.write('<frameset><frame name="frame_content" id="frame_content"></frame></frameset>');

      $('#frame_content').attr('src', 'test2.html');
      $('#frame_content').load(function()
      {
        if('${"#header"}' != '') {
          $("#header", frame_content.document).remove();
        }
      });
      if($('#frame_content').complete) $('#frame_content').trigger("load");
    </script>

</head>
</html> 
```

test2.html

```
<!DOCTYPE HTML>
<html>

  <head>
  </head>

  <body>
    <div id="header">You will never see me, cause I have been removed!</div>
  </body>
</html> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-22T02:57:08.603

不知道你想做什么，但我有一个更老的经典 asp 应用程序，它在框架外运行，我最近刚刚添加了 jQuery 功能，它工作得很好。$(document).ready() 可以在一个框架内正常工作，但是如果您希望在另一个框架中引用 DOM，则必须使用 Frame 的 onload 事件来让您知道框架的 DOM 何时加载。诚然，我使用了 iFrame，但概念应该是相同的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T10:50:31.973

我不知道这是否是最好的解决方案，但是当我移除`$(document).ready()`并保留它的身体时，一切都完美无缺。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-26T03:21:02.753

无需修改标记。只需修复选择器。它应该是：

```
$("frame[name='main']").ready(function(){..}); 
```

不是

```
$("#frameName").ready(function(){..}); 
```

注意：似乎 jQuery 就绪事件会触发多次。确保你的逻辑没问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-28T09:40:23.003

这个答案可能会迟到，但这个回复可能会帮助像我这样的人......

这可以通过本机 Javascript 代码完成 -

```
ifrm2 = var ifrm2 = document.getElementById('frm2');
if (ifrm2.contentDocument.readyState == 'complete') {
  //here goes the code after frame fully loaded
}

 //id = frm2 is the id of iframe in my page 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-10-21T09:03:58.427

没有理由`$(document).ready()`不被召唤。确保您的页面包含包含到`jquery.js`. 尝试用一个空的 HTML 页面做一个简单的测试，然后发出一个警报，看看是否还有其他问题。

如果您尝试在包含框架定义的 HTML 页面中使用它，请记住那里没有文档，您必须使用

# mysql - MYSQL中递归存储过程获取分层数据的性能

> ID：221194
> 
> 赞同：1
> 
> 时间：2008-10-21T08:47:14.887
> 
> 标签：mysql

我有表员工，
员工（emp_id int 主键，emp_name varchar(50)，mngr_id int）

这里 mngr_id 要么为空，要么包含有效的 emp_id。通过这种方式，它形成了组织中员工的层次结构。

为了遍历整个层次结构，我不得不编写递归存储过程。（在 Oracle 中，使用 CONNECT BY .. START WITH 很容易）

所以问题是，考虑到层次结构的级别不会超过 10 级，这种存储过程的性能影响是什么！

有没有其他方法可以达到同样的效果？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-07-23T13:23:38.000

一个相当简单的迭代邻接列表数据库服务器端解决方案：http: [//pastie.org/1056977](http://pastie.org/1056977)

```
delimiter ;

drop procedure if exists employee_hier;

delimiter #

create procedure employee_hier
(
in p_emp_id smallint unsigned
)
begin

declare p_done tinyint unsigned default(0);
declare p_depth smallint unsigned default(0);

create temporary table hier(
 boss_id smallint unsigned, 
 emp_id smallint unsigned, 
 depth smallint unsigned
)engine = memory;

insert into hier values (null, p_emp_id, p_depth);

/* http://dev.mysql.com/doc/refman/5.0/en/temporary-table-problems.html */

create temporary table emps engine=memory select * from hier;

while p_done <> 1 do

    if exists( select 1 from employee e inner join hier on e.boss_id = hier.emp_id and hier.depth = p_depth) then

        insert into hier select e.boss_id, e.emp_id, p_depth + 1 
            from employee e inner join emps on e.boss_id = emps.emp_id and emps.depth = p_depth;

        set p_depth = p_depth + 1;          

        truncate table emps;
        insert into emps select * from hier where depth = p_depth;

    else
        set p_done = 1;
    end if;

end while;

select 
 e.emp_id,
 e.name as emp_name,
 b.emp_id as boss_emp_id,
 b.name as boss_name,
 hier.depth
from 
 hier
inner join employee e on hier.emp_id = e.emp_id
inner join employee b on hier.boss_id = b.emp_id;

drop temporary table if exists hier;
drop temporary table if exists emps;

end #

delimiter ;

call employee_hier(1);
call employee_hier(3); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T08:52:22.147

[关于最后一个问题： “将平面表解析为树的最有效/优雅的方法是什么？”](https://stackoverflow.com/questions/192220/what-is-the-most-efficientelegant-way-to-parse-a-flat-table-into-a-tree)有一些不错的选择。

您还应该考虑将递归结果缓存在中间表中。如果您仅在更新层次结构表时更改它，则递归性能影响可以忽略不计。

编辑：我个人会在我的应用程序的表示层中进行递归，例如在 Web 服务器上。与在 SQL 中可以实现的功能相比，这提供了更大的灵活性，并且您还可以使用会话或应用程序级别的缓存。（不过，使用通过触发器保持最新的预先构建的数据库表永远不会给您留下过时的缓存。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-23T09:29:29.617

Tomalak：“......我会在我的应用程序的表示层中进行递归......”

这意味着每次递归发生时，都会从表示层向数据库服务器发送另一个调用。那将是非常缓慢的。

# java - 将 Flash / Flex 组件嵌入 Java 应用程序

> ID：221218
> 
> 赞同：4
> 
> 时间：2008-10-21T08:58:15.443
> 
> 标签：java, apache-flex, flash

我正在我的公司研究一些 Flex 峰值。我们基本上是在评估不同的场景等。对于将 Flex 组件嵌入 Java 应用程序，您会推荐什么解决方案？Flex <-> Java 通信不是（还...）问题，只是将 swf 嵌入到 JFrame 中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T16:31:52.330

我已经用 EasyJCom 完成了。只要您使用标准 Java 窗口库之一（Swing、awt），它就非常简单。您可以在此处查看示例（来自 EZJCom 站点）：[http ://www.ezjcom.com/FlashTest.java.txt](http://www.ezjcom.com/FlashTest.java.txt)

EasyJCom 的负责人也反应迅速，即使我们最终没有使用他们的产品（切换平台），我还是推荐他们。

我没有使用过 JFlashPlayer，但确实查看了文档，它似乎也足够了。我认为他们的许可证要求您混淆您的代码。我觉得这有点奇怪，但也许我误解了许可证。

如果您不想使用 Com，或者如果您需要嵌入另一种类型的窗口，它会变得相当复杂。

如果你需要嵌入 flash 跨平台，你可能会被困在为 Mozilla 插件滚动你自己的 Jini 库。那时......如果你不是太远的话，也许换个平台是值得的。;）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T14:41:46.560

尚未对此进行测试，但看起来 JFlashPlayer 可以完成这项工作。[http://www.jpackages.com/jflashplayer/](http://www.jpackages.com/jflashplayer/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-21T18:16:44.693

这些都不支持 Linux 或 MacOS。跨平台的 Java 和 Flash 就这么多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-17T17:22:15.640

我认为执行此类操作的最佳方法是将类似 xulrunner 的内容嵌入到您的 java 应用程序中，然后让 java 应用程序通过 xulrunner 接口与 flash 交互。

# c# - 路径中的哈希字符引发 DirectoryNotFoundException

> ID：221224
> 
> 赞同：1
> 
> 时间：2008-10-21T08:59:04.223
> 
> 标签：c#, .net, xmltextreader

考虑以下代码片段

```
private void ProcessFile(string fullPath) {
    XmlTextReader rdr = new XmlTextReader("file:\\\\" + fullPath);
    while (rdr.Read()) {
        //Do something
    }
    return;
} 
```

现在，当传递如下路径时，此功能正常：

“C:\工作文件\技术信息\Dummy.xml”

但是通过时会抛出错误

"C:\Work Files\#Technical Information\Dummy.xml"

请注意，指定的所有文件夹和文件都存在，并且哈希字符是路径的有效字符。错误详情如下：

System.IO.DirectoryNotFoundException：找不到路径“C:\Work Files\”的一部分。
在 System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)
在 System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs , String msgPath, Boolean bFromProxy)
at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize)
at System.Xml.XmlDownloadManager.GetStream(Uri uri, ICredentials credentials)
at System。
System.Xml.XmlTextReaderImpl.OpenUrlDelegate(Object xmlResolver ) 处的 Xml.XmlUrlResolver.GetEntity(Uri absoluteUri, String role, Type ofObjectToReturn )
在 System.Threading.CompressedStack.runTryCode(Object userData)
在 System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode 代码, CleanupCode backoutCode, Object userData)
在 System.Threading.CompressedStack.Run(CompressedStack compressedStack, ContextCallback callback, Object state)
在 System.Xml.XmlTextReaderImpl.OpenUrl()
在 System.Xml.XmlTextReaderImpl.Read()
在 System.Xml.XmlTextReader.Read()

有人知道发生了什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T09:08:07.653

添加到 Konrad 的答案中，如果您使用的是 file:// 协议，则需要将 %23 用于 # 那么它可以正常工作

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T09:06:28.517

尝试省略`file:///`协议前缀。没有它对我有用。`#`我相信 .NET 会在它认为这是一个 URL之后截断任何部分。这只是基于错误消息的猜测，但考虑到`#`字符后面的部分不是由服务器处理而是由客户端在其他情况下（例如 Web 浏览器）处理，这似乎是合乎逻辑的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T09:06:53.070

你为什么不使用

XmlTextReader rdr = new XmlTextReader(fullPath);

# visual-studio - MIDL 为 /env win32 和 /env win64 生成相同的文件

> ID：221254
> 
> 赞同：5
> 
> 时间：2008-10-21T09:09:29.117
> 
> 标签：visual-studio, midl

在 Visual Studio 中，当您编译 foo.idl 时，MIDL 会在 foo_p.c 中生成代理信息。

不幸的是，对于 Win32 和 x64 文件，它使用相同的文件名。对于 Win32，文件开头为：

```
#if !defined(_M_IA64) && !defined(_M_AMD64) 
```

对于 x64，文件开头为：

```
#if defined(_M_AMD64) 
```

当您为 Win32 构建然后立即为 x64 构建时，它不会替换 foo_p.c 文件，这意味着项目无法链接。

我尝试了一个预构建事件，如果它用于错误的体系结构，则删除 foo_p.c 文件，但 VS 甚至不费心运行该步骤。

我应该如何获得它以便我可以构建一个配置然后另一个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T09:43:31.437

您可以修改 IDL 文件的编译器设置，以根据目标平台为输出代理文件指定不同的文件名。（选择 IDL 文件上的属性，然后选择配置属性/MIDL/输出）。

*   对于 Win32 版本，请使用`foo_p_w32.c`
*   对于 x64 构建，请使用`foo_p_x64.c`

然后，在您的 Win32 项目设置中，排除`foo_p_x64.c`x64 项目的文件，反之亦然。

您需要对 _i.c 文件执行相同的操作，否则 Visual Studio 似乎根本不会重建 IDL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-07T04:54:36.780

以下是我们用来允许自动构建干净地工作的配置更改

改变

```
<Tool
Name="VCMIDLTool"
TypeLibraryName="$(ProjectName).tlb"
OutputDirectory="$(SolutionDir)$(PlatformName)"
HeaderFileName="$(ProjectName)_h.h"
DLLDataFileName="$(ProjectName)_dlldata.c"
/> 
```

到

```
<Tool
    Name="VCMIDLTool"
    TypeLibraryName="$(InputName).tlb"
    OutputDirectory="$(SolutionDir)$(PlatformName)"
    HeaderFileName="$(InputName)_i.h"
    DLLDataFileName="$(InputName)_dlldata.c"
    InterfaceIdentifierFileName="$(InputName)_i.c"
    ProxyFileName="$(InputName)_p.c"
/> 
```

并将**$(SolutionDir)$(PlatformName)**添加到您的 C++ 附加包含目录

例如

```
<Tool Name="VCCLCompilerTool" ...
AdditionalIncludeDirectories="...;&quot;$(SolutionDir)$(PlatformName);&quot;" 
```

# ms-access - MS Access 报告的第一页似乎没有调用 On Page 事件

> ID：221256
> 
> 赞同：1
> 
> 时间：2008-10-21T09:09:44.610
> 
> 标签：ms-access, report

我编写了一个 MS Access 2000 报告，该报告显示一个日历，每页一个月，项目添加到特定日期。基础记录源中的唯一数据是月份列表。该结构是通过 On Page 事件创建的，该事件还读取其他数据。

打开此报告时，我注意到第一页似乎没有触发 On Page 事件。（我将此归因于这样一个事实，即在缓存页面而不是显示页面时激活报表中的 On Page，例如 On Current for Access 表单。）

当显示报告时，我的解决方法是使用 On Activate 事件来强制 On Page 子例程运行，即使该事件尚未被调用。但是，当导出报表时，它不会触发 On Activate 事件，并且导出的第一页采用以下两种格式之一：1) 如果报表在 Access 中打开（即之前已触发 On Activate），则第一页是与显示的页面之后的页面或最后一页相同，除了正确的月份（来自基础记录源）2）如果报表未在 Access 中打开，则第一页仅包含报表设计中的结构查看（即很多空框）

我最好的解决方法是强制使用（否则毫无意义的）封面，以确保第一页不包含任何需要运行代码的内容，但这远非理想。我可以强制代码在导出的第一页运行吗？或者我可能误解了 On Page 的工作原理，我需要重组我的代码？（我还注意到 On Page 似乎在最后一页运行了两次）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T12:59:31.760

我建议重组代码，以便在一个查询、多个查询或 VBA 中构建数据，然后使用新数据源打开报表。我可能还在家里有 Access 2000 可以检查，但在工作中我可以测试 2003 和 2007，并且在这两个版本中，在显示每个页面之前都会触发 OnPage 事件。如果您遇到不同的行为，我怀疑这是因为 Access 不确定如何处理您要求它执行的操作。

通常，像您所描述的那样的报告会以另一种方式设计：报告的数据源将包含所有项目信息。您尝试显示的数据是否存在阻止您构建包含所有数据的查询的内容？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T09:18:25.747

您是否考虑过各个部分的 Format 事件，尤其是 Detail 部分？格式化或打印是操作报告的更常见的事件。

# sql-server - 英国夏令时 (BST) 的 SQL Server Active Directory 导入问题

> ID：221258
> 
> 赞同：1
> 
> 时间：2008-10-21T09:10:53.623
> 
> 标签：sql-server, datetime, active-directory

我正在使用 SQL Server ADSI 从 Active Directory 导入数据，并使用 whenChanged 字段来控制是否需要重新导入组的成员。

问题是日期在 GMT 中返回，而我目前在 BST。

所以，今天早上9点50分换了会员，我说的AD工具是9点50分，但是ADSI查询返回8点50分。这意味着如果一个小时内有两个变化，我会错过一个。

我正在使用的查询如下所示：

```
Select distinguishedName, whenChanged 
From OpenQuery(ADSI, '<LDAP://OU=Groups,DC=mydomain,DC=adr>;(objectCategory=Group);distingusihedName, whenChanged') 
```

我可以使用另一个字段来给我一个准确的日期吗？有没有更好的方法来做我想要在 SQL Server 中做的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T09:41:33.187

你为什么首先存储当地时间？该`whenChanged`物业已经为您提供格林威治标准时间，在该时区不会“丢失”任何时间。

可以转换为本地时间以进行显示，但我肯定会将 GMT/UTC 存储在数据库中。

# macos - 在 Mac OS X 中复制符号链接

> ID：221267
> 
> 赞同：37
> 
> 时间：2008-10-21T09:14:52.710
> 
> 标签：macos

在 Mac 上复制符号链接的最简单方法是什么？

首选 python 或 perl 解决方案，但任何解决方案都会有所帮助。

我正在复制安装包的框架，需要维护链接

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-21T09:40:08.307

正如大卫所提到的，OS X 缺少 gnu cp 所具有的方便的 -a 选项。

但是，如果您使用 -R 进行递归复制，则默认情况下它将复制符号链接，因此

```
cp -R source destination 
```

应该工作。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2017-02-26T08:22:50.717

*@brian d foy*的解决方案曾经是正确的。较新版本的 macOS 确实支持

```
cp -a 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T09:36:43.260

在 python 中，您可以使用[os.readlink](http://docs.python.org/library/os.html#os.readlink)和[os.symlink](http://docs.python.org/library/os.html#os.symlink)来执行此操作。您应该检查您所操作的实际上是否是带有[os.lstat](http://docs.python.org/library/os.html#os.lstat)和[stat.S_ISLNK的符号链接](http://docs.python.org/library/stat.html#stat.S_ISLNK)

```
import os, stat
if stat.S_ISLNK(os.lstat('foo').st_mode):
    src = os.readlink('source')
    os.symlink(src, 'destination') 
```

您可以使用[cp 的 -R 选项来完成](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/cp.1.html)。这是因为 cp 默认情况下不遵循符号链接，而是在不指定 -R 的情况下复制非文件，这意味着递归。

```
cp -R source destination 
```

在 python 中，这将与[subprocess.call一起使用](http://docs.python.org/library/subprocess.html#subprocess.call)

```
from subprocess import call
call(['cp', '-R', 'source', 'destination']) 
```

请注意，[macosx 别名](http://developer.apple.com/documentation/MacOSX/Conceptual/BPFileSystem/Articles/Aliases.html)不是符号链接，因此符号链接特定处理将失败。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T09:37:08.220

当您标记python时，我假设您的意思是copytree（src，dst [，symlinks]）。真正的符号链接（由 ln -s 创建）将像在任何 unix 系统上一样被复制。但是如果你用 finder 创建一个别名，你不会得到一个符号链接，而是一个别名。MacOS 提供两种类型的链接：unix 类型的符号链接和别名（参见[http://developer.apple.com/documentation/MacOSX/Conceptual/BPFileSystem/Articles/Aliases.html](http://developer.apple.com/documentation/MacOSX/Conceptual/BPFileSystem/Articles/Aliases.html)）。许多工具不会将这些别名视为链接 - 据我所知，copytree 也没有。

# asp.net - 将数据从 ASP.net 返回到 ExtJS 网格

> ID：221273
> 
> 赞同：3
> 
> 时间：2008-10-21T09:18:14.030
> 
> 标签：asp.net, extjs, asp.net-2.0

我得到了一个用 html 和 javascript（通过 ExtJS）编写的网格的原型/模型，我现在需要在 ASP.net Web 应用程序中实现它。有没有人知道如何将数据传递到网格（特别是 GroupingStore）。

我宁愿不要有大量的 Web 服务或返回 XML/JSON 的帮助页面，所以如果有办法使用客户端回调或页面方法（你能不能告诉我我也不是特别熟悉 - 流行语宾果游戏！）或somesuch，那将是首选。

请不要推荐我使用 jQuery、内置的 ASP.net 网格或任何其他 UI 框架。ExtJS 网格的使用是由权力授权的，所以这就是我正在使用的网格，无论好坏 :)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T09:23:36.030

我相信为您的页面简单地返回 json 结构的服务是最好的选择，它很好地抽象和可跨应用程序而不是页面方法重用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T10:05:42.873

这是一个低技术的解决方案。它不需要使用 Web 服务或任何其他附加技术。

**第1步**

有一个带有一个参数的 ASPX 页面，并像这样调用：

```
http://mysite.com/query.aspx?sql=select * from orders where status = 'open' 
```

**第2步**

在后面的代码中，做这样的事情

```
void Page_Load(object sender, EventArgs e)
{
   Response.ContentType="text/json"; 
   DataTable contents = ExecuteDataTable(Request["sql"]);
   Response.Write( JRockSerialize( contents ) );
   Response.End();
} 
```

您可以使用[JRock](http://jayrock.berlios.de/)将数据表序列化为 JSON。恕我直言，这提供了最干净的 JSON。

所以这是`DataTable`对 JSON 排序的......

*警告：这显然是一个简单的例子。您不应该在查询字符串上传递 SQL，因为它不安全（您可以改用命名查询和参数）。*

**第 3 步**

在您的 ExtJS 代码中，使用 Json 数据存储创建一个网格，如[Ext 示例](http://www.extjs.com/deploy/dev/examples/grid/binding.html)所示。使用适当的查询字符串参数将数据存储设置`url:`为 query.aspx 页面的数据存储。

您还需要为网格设置列，再次显示在 ExtJs 示例中。

**或者...**

最近看到[Coolite 样品](http://www.coolite.com/)时，我印象深刻。他们是 ExtJS 的合作伙伴，提供良好的 ASP.NET 和 ExtJS 体验。不，我不为他们工作 :) 我没有尝试过他们的网格，但它可能是无痛的（有代价的）。

# java - JTidy Node.findBody() — 如何使用？

> ID：221277
> 
> 赞同：4
> 
> 时间：2008-10-21T09:18:52.093
> 
> 标签：java, xml, xhtml, tidy, jtidy

我正在尝试使用 JTidy 进行 XHTML DOM 解析，这似乎是一项违反直觉的任务。特别是，有一种解析 HTML 的方法：

```
Node Tidy.parse(Reader, Writer) 
```

为了得到那个节点的 <body />，我想，我应该使用

```
Node Node.findBody(TagTable) 
```

我应该在哪里获得该 TagTable 的实例？（构造函数是受保护的，我还没有找到生产它的工厂。）

我使用 JTidy 8.0-SNAPSHOT。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T10:30:38.347

我发现提取身体的方法要简单得多*：*

```
整洁 = 新的整洁（）；
tidy.setXHTML(true);
tidy.setPrintBodyOnly(true);

```

然后在 Reader-Writer 对上使用 tidy。

应该很简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T09:47:27.293

您可以改用该`parseDOM`方法，这会给您带来`org.w3c.dom.Document`回报：

```
Document document = Tidy.parseDOM(reader, writer);
Node body = document.getElementsByTagName("body").item(0); 
```

# c++ - 将简体中文 GB 2312 文本字符转换为 UTF8

> ID：221281
> 
> 赞同：1
> 
> 时间：2008-10-21T09:21:32.290
> 
> 标签：c++, unicode, internationalization

如何使用 c++ 将多字节文本字符串（例如简体中文 GB 2312）之间的文本转换为 UTF8？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T09:46:13.070

在 unix 系统上，您最好使用 iconv 库。

见[iconv_open](http://www.manpagez.com/man/3/iconv_open/)，[iconv](http://www.manpagez.com/man/3/iconv/)，[iconv_close](http://www.manpagez.com/man/3/iconv_close/)

当然，您必须知道字符编码（EUC-CN，HZ）。

如果不是在 unix 系统上，请在操作系统中搜索一些支持，手动进行字符转换很难正确。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T09:50:14.200

WinAPI：[MultiByteToWideChar](http://msdn.microsoft.com/en-us/library/ms776413(VS.85).aspx)，反之亦然，[WideCharToMultiByte](http://msdn.microsoft.com/en-us/library/ms776420(VS.85).aspx)。我可以稍后发布样本。

然而，UTF-8 在应用程序中的表示，更具体地说，在使用方面相当棘手。MultiByteToWideChar 函数将字符串转换为[UTF-16 (UCS2)](http://en.wikipedia.org/wiki/UTF-16/UCS-2)。我建议你在你的软件内部使用这种格式，并且只有在你的程序需要产生这样的输出时才使用 WideCharToMultiByte 将其转换为 UTF-8。这是在 Windows 和 OS X 上进行国际化/unicode 的标准方式。

# linux - 你可以在linux中通过命令重命名shell会话吗？

> ID：221283
> 
> 赞同：2
> 
> 时间：2008-10-21T09:23:08.700
> 
> 标签：linux, shell, session, kde

我喜欢在工作时用有用的标题命名我的 shell 会话，这有助于我跟踪我正在使用多个选项卡中的每一个的目的。

目前要重命名会话，我在控制台的选项卡部分双击其名称 - 是否有任何命令可用于从 shell 中执行此操作？这会节省我一点时间。

提前致谢

编辑：- 我正在使用 KDE 的 Konsole shell。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T09:27:49.533

文章[如何更改 xterm 的标题](http://www.faqs.org/docs/Linux-mini/Xterm-Title.html)应该会有所帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T15:05:35.483

> 目前要重命名会话，我在控制台的选项卡部分双击其名称

这听起来就像您正在使用 KDE 的 Konsole。这是真的？

如果是这样，在 KDE 3 中：

```
dcop $KONSOLE_DCOP_SESSION renameSession "I am renamed!" 
```

在 KDE 4 中，旧的 DCOP 接口尚未移植到新的 D-BUS IPC，但您可以更改选项卡名称的设置以遵循每个屏幕设置的窗口名称，并按照其他答案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T09:29:32.603

根据[这个页面](http://www.faqs.org/docs/Linux-mini/Xterm-Title.html)，你应该可以使用这样的东西：

```
echo -n "\033]0;New Window Title\007" 
```

我目前不在 Linux 中，因此未经测试。我知道可以在程序控制下更改窗口标题，所以这似乎可行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-27T14:29:09.530

对于 /usr/bin/konsole，您可以从菜单中更改 konsole 终端的标题：Settings->Edit Current Profile->Tabs

将“标签标题格式”编辑为您想要的任何内容。与外壳交互后，标题将重置为您放置的内容。

对于在 xorg-server 2:1.10.1-1ubuntu1 中运行的 /usr/bin/xterm

echo -ne "\033]0;My Fun X-Terminal\007"

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T09:28:14.633

这个问题的答案实际上取决于您使用的终端程序。

但是，我只是假设它是明智的，并且模拟了一个足以尊重 xterm 转义码的 xterm - 在这种情况下，您可能想看这里： http: [//www.faqs.org/docs/Linux-mini/Xterm -Title.html#s3](http://www.faqs.org/docs/Linux-mini/Xterm-Title.html#s3)

注意：下面的 unwind 示例要求 echo 像这样“echo -ne”调用，否则 '\' 字符会按字面意思回显。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-01T18:34:31.993

对于 Ubuntu 上的默认终端（我仍在 10.04 上），请尝试**xtitle**。

```
$> sudo apt-get install xtitle
   ...
$> xtitle --title wow it worked!
   or simply
$> xtitle this is great 
```

# .net - 向 Windows GUI 线程发送消息

> ID：221287
> 
> 赞同：4
> 
> 时间：2008-10-21T09:24:22.567
> 
> 标签：.net, windows, user-interface, asynchronous, message-pump

我注意到，当您创建一个 Web 服务对象（从 SoapHttpClientProtocol 继承）并使用 Async 方法时，它会在 Windows GUI 线程上进行回调。

1.  有谁知道这是如何工作的？
2.  我怎样才能达到同样的目的。

如果我确定回调总是在 gui 线程上发生，我认为这将使我不必在我的 GUI 表单中检查 InvokeRequired。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T09:44:55.893

我怀疑它使用[AsyncOperationmanager.SynchronizationContext](http://msdn.microsoft.com/en-us/library/system.componentmodel.asyncoperationmanager.synchronizationcontext.aspx)来静态获取同步上下文。然后，这允许您适当地发布回调。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T11:22:21.893

杰出的。感谢您的回答。这两种选择似乎都有效并且各有优势。

这是我用来测试的示例代码：

```
 public partial class AsyncTest : Form
    {
        static void Main()
        {
            Application.Run(new AsyncTest());
        }

        AsyncOperation _operation;
        SynchronizationContext _context;
        TextBox _textBox;
        public AsyncTest()
        {
            _operation = AsyncOperationManager.CreateOperation(null);
            _context = WindowsFormsSynchronizationContext.Current;
            _textBox = new TextBox();
            this.Controls.Add(_textBox);
            new Thread(AsyncThread).Start();
        }

        void AsyncThread()
        {
            _operation.Post(GuiThread, null);
            _context.Post(GuiThread, null);
        }

        void GuiThread(object state)
        {
            _textBox.Text = _textBox.InvokeRequired ? "Didn't work" : "It Worked";
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T10:14:48.097

您可以在主线程中创建一个 WindowsFormsSynchronizationContext 对象，然后在另一个线程上调用它的 Send 方法。

# crystal-reports - 为什么 Crystal Reports 8 冻结？

> ID：221292
> 
> 赞同：0
> 
> 时间：2008-10-21T09:29:32.167
> 
> 标签：crystal-reports

我在使用 Crystal Reports 8 时遇到问题。从我的应用程序导出报表时，Crystal Reports**有时会**冻结。进度窗口只是停留，表示已导出 X 条记录中的 X 条。

1.  具有较少数据的较小报告更容易冻结。
2.  速度更快的工作站（P4、Core2）往往会更频繁地死机，有时每两次尝试一次。在较旧的工作站 (< P2) 上，根本不会发生冻结，或者至少每隔一两天发生一次。
3.  导出格式（rtf、pdf、html、rpt）不影响冻结行为。
4.  同一份报告可以使用完全相同的数据成功导出多次，但最终会冻结。
5.  在 Windows Vista 上不会发生冻结 (!)

有没有办法阻止这种情况，或者至少有办法预测冻结？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-24T08:15:18.473

经过长时间的搜索，我们终于找到了`WaitForSingleObject(?, INFINITE)`电话的来源。CR8 似乎有一些同步错误，这些错误在快速工作站上变得很明显。

它在某种程度上与进度窗口有关，Vista 中的动画似乎缓解了这个问题。

从理论上讲，解决方案是修补有问题的文件并用`WaitForSingleObject`超时参数替换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T09:51:06.007

CR 8 是一个相当老的产品，您可能想检查现在拥有它的人（Business Objects 还是？）是否有更新（专门针对 v8 的修补程序）。这可能是他们过去通过服务版本修复的问题。

# javascript - 你如何在 JavaScript 中获得时间戳？

> ID：221294
> 
> 赞同：4466
> 
> 时间：2008-10-21T09:29:33.367
> 
> 标签：javascript, datetime, timestamp, date-arithmetic

类似于 Unix 的时间戳，它是一个代表当前时间和日期的数字。作为数字或字符串。

* * *

## 回答 #1

> 赞同：5537
> 
> 时间：2008-10-21T09:32:32.487

# 短而时髦：

```
+ new Date() 
```

一元运算符 like`plus`触发对象`valueOf`中的方法`Date`并返回时间戳（没有任何更改）。

**细节：**

在几乎所有当前的浏览器上，您都可以使用[`Date.now()`](http://www.ecma-international.org/ecma-262/5.1/#sec-15.9.4.4)以**毫秒为单位**获取 UTC 时间戳；一个值得注意的例外是 IE8 和更早版本（参见[兼容性表](http://kangax.github.io/compat-table/es5/#Date.now)）。

不过，您可以轻松地为此制作垫片：

```
if (!Date.now) {
    Date.now = function() { return new Date().getTime(); }
} 
```

**要以秒**为单位获取时间戳，您可以使用：

```
Math.floor(Date.now() / 1000) 
```

或者，您可以使用：

```
Date.now() / 1000 | 0 
```

这应该会稍微快一些，但可读性也会降低。
（另[请参阅此答案](https://stackoverflow.com/questions/7487977/using-bitwise-or-0-to-floor-a-number)或[此](https://stackoverflow.com/a/11446757/1519836)对位运算符的进一步解释）。

我建议使用`Date.now()`（带有兼容性垫片）。它稍微好一点，因为它更短并且不会创建新`Date`对象。但是，如果您不想要 shim 和最大兼容性，您可以使用“旧”方法以**毫秒为单位**获取时间戳：

```
new Date().getTime() 
```

然后您可以将其转换为秒，如下所示：

```
Math.round(new Date().getTime()/1000) 
```

你也可以使用`valueOf`我们上面展示的方法：

```
new Date().valueOf() 
```

**以毫秒为单位的时间戳**

```
var timeStampInMs = window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();

console.log(timeStampInMs, Date.now());
```

* * *

## 回答 #2

> 赞同：603
> 
> 时间：2011-02-18T00:33:44.610

我喜欢这个，因为它很小：

```
+new Date 
```

我也喜欢这个，因为它很短并且与现代浏览器兼容，超过 500 人投票认为它更好：

```
Date.now() 
```

* * *

## 回答 #3

> 赞同：302
> 
> 时间：2011-05-11T22:27:05.327

JavaScript 使用自纪元以来的毫秒数，而大多数其他语言使用秒数。您可以使用毫秒，但是一旦您传递一个值说 PHP，PHP 本机函数可能会失败。所以要确保我总是使用秒，而不是毫秒。

这将为您提供一个 Unix 时间戳（以秒为单位）：

```
var unix = Math.round(+new Date()/1000); 
```

这将为您提供自纪元以来的毫秒数（不是 Unix 时间戳）：

```
var milliseconds = new Date().getTime(); 
```

* * *

## 回答 #4

> 赞同：158
> 
> 时间：2008-10-21T10:05:36.320

```
var time = Date.now || function() {
  return +new Date;
};

time(); 
```

* * *

## 回答 #5

> 赞同：157
> 
> 时间：2012-07-12T07:15:09.637

***我在这个答案中提供了多种带有描述的解决方案。如果有任何不清楚的地方，请随时提出问题***

* * *

**快速而肮脏的解决方案：**

```
Date.now() /1000 |0 
```

> ***警告**：如果你施展魔法，它**可能会**在 2038 年中断并返回负数。到时候`|0`改用`Math.floor()`*

**`Math.floor()`解决方案：**

```
Math.floor(Date.now() /1000); 
```

* * *

**[Derek 朕会功夫](//stackoverflow.com/users/283863)的一些书呆子选择取自这个答案下面的评论：**

```
new Date/1e3|0 
```

* * *

**Polyfill 开始`Date.now()`工作：**

要让它在 IE 中工作，你可以这样做（来自[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now)的 Polyfill ）：

```
if (!Date.now) {
    Date.now = function now() {
        return new Date().getTime();
    };
} 
```

* * *

**如果您不关心年份/星期几/夏令时，则需要记住 2038 年之后的日期：**

按位运算将导致使用 32 位整数而不是 64 位浮点。

您需要正确使用它：

```
Math.floor(Date.now() / 1000) 
```

* * *

如果您只想知道从代码第一次运行开始的相对时间，您可以使用以下内容：

```
const relativeTime = (() => {
    const start = Date.now();
    return () => Date.now() - start;
})(); 
```

* * *

**如果您使用的是 jQuery，您可以按照[jQuery's Docs](http://api.jquery.com/jquery.now/)`$.now()`中的描述使用，这使得 polyfill 过时了，因为在内部做同样的事情：`$.now()``(new Date).getTime()`**

如果您只是对 jQuery 的版本感到满意，请考虑支持[**这个**](//stackoverflow.com/a/15434736/1519836)答案，因为我自己没有找到它。

* * *

**现在稍微解释一下`|0`：**

通过提供`|`，您告诉解释器执行二进制 OR 操作。位运算需要将十进制结果转换为整数
的绝对数。`Date.now() / 1000`

在该转换期间，小数被删除，导致与 using`Math.floor()`将输出的结果相似。

> **但请注意：**它将 64 位双精度转换为 32 位整数。
> 在处理大量数字时，这将导致信息丢失。
> 由于 32 位整数溢出，时间戳将在 2038 年之后中断，除非 Javascript 在严格模式下移动到 64 位整数。

* * *

**有关更多信息，请`Date.now`点击此链接：[`Date.now()`@ MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now)**

* * *

## 回答 #6

> 赞同：95
> 
> 时间：2008-10-21T13:00:22.520

```
var timestamp = Number(new Date()); // current time as number 
```

* * *

## 回答 #7

> 赞同：65
> 
> 时间：2016-01-29T15:08:36.643

除了其他选项，如果你想要一个 dateformat ISO，你可以直接得到它

```
console.log(new Date().toISOString());
```

* * *

## 回答 #8

> 赞同：61
> 
> 时间：2013-03-15T14:19:22.083

*jQuery*提供[了自己的方法](http://api.jquery.com/jQuery.now/)来获取时间戳：

```
var timestamp = $.now(); 
```

^(（除了它只是实现`(new Date).getTime()`表达式）)

**参考：** [http ://api.jquery.com/jQuery.now/](http://api.jquery.com/jQuery.now/)

* * *

## 回答 #9

> 赞同：47
> 
> 时间：2009-04-30T16:53:52.557

```
console.log(new Date().valueOf()); // returns the number of milliseconds since the epoch
```

* * *

## 回答 #10

> 赞同：47
> 
> 时间：2017-05-20T04:49:21.997

**Date**是 JavaScript 中的**原生对象**，是我们获取所有时间数据的方式。

请注意 JavaScript 中的时间戳取决于客户端计算机集，因此它不是 100% 准确的时间戳。要获得最佳结果，您需要从**服务器端**获取时间戳。

无论如何，我首选的方法是使用香草。这是在 JavaScript 中执行此操作的常用方法：

```
Date.now(); //return 1495255666921 
```

在 MDN 中提到如下：

> Date.now() 方法返回自 1970 年 1 月 1 日 00:00:00 UTC 以来经过的毫秒数。
> 因为 now() 是 Date 的静态方法，所以您总是将它用作 Date.now()。

如果您使用低于 ES5 的版本，`Date.now();`则不起作用，您需要使用：

```
new Date().getTime(); 
```

* * *

## 回答 #11

> 赞同：46
> 
> 时间：2018-06-27T16:33:13.127

# 表现

今天 - 2020.04.23 我对选定的解决方案进行测试。我在 Chrome 81.0、Safari 13.1、Firefox 75.0 上的 MacOs High Sierra 10.13.6 上进行了测试

### 结论

*   解决方案`Date.now()`(E) 在 Chrome 和 Safari 上最快，在 Firefox 上第二快，这可能是快速跨浏览器解决方案的最佳选择
*   令人惊讶的是，解决方案`performance.now()`(G) 在 Firefox 上比其他解决方案快 100 倍以上，但在 Chrome 上最慢
*   解决方案 C、D、F 在所有浏览器上都很慢

[![在此处输入图像描述](https://i.stack.imgur.com/lCTrK.png)](https://i.stack.imgur.com/lCTrK.png)

### 细节

铬的结果

[![在此处输入图像描述](https://i.stack.imgur.com/Eaco2.png)](https://i.stack.imgur.com/Eaco2.png)

您可以在您的机器上执行测试[这里](https://jsbench.me/f5k9ckm6lh/1)

测试中使用的代码显示在下面的代码片段中

```
function A() {
  return new Date().getTime();
}

function B() {
  return new Date().valueOf();
}

function C() {
  return +new Date();
}

function D() {
  return new Date()*1;
}

function E() {
  return Date.now();
}

function F() {
  return Number(new Date());
}

function G() {
  // this solution returns time counted from loading the page.
  // (and on Chrome it gives better precission)
  return performance.now(); 
}

// TEST

log = (n,f) => console.log(`${n} : ${f()}`);

log('A',A);
log('B',B);
log('C',C);
log('D',D);
log('E',E);
log('F',F);
log('G',G);
```

```
This snippet only presents code used in external benchmark
```

* * *

## 回答 #12

> 赞同：44
> 
> 时间：2012-09-21T19:12:49.653

加起来，这是一个在 Javascript 中返回时间戳字符串的函数。示例：下午 15:06:38

```
function displayTime() {
    var str = "";

    var currentTime = new Date()
    var hours = currentTime.getHours()
    var minutes = currentTime.getMinutes()
    var seconds = currentTime.getSeconds()

    if (minutes < 10) {
        minutes = "0" + minutes
    }
    if (seconds < 10) {
        seconds = "0" + seconds
    }
    str += hours + ":" + minutes + ":" + seconds + " ";
    if(hours > 11){
        str += "PM"
    } else {
        str += "AM"
    }
    return str;
} 
```

* * *

## 回答 #13

> 赞同：33
> 
> 时间：2014-03-31T08:18:48.013

一个我还没看过

```
Math.floor(Date.now() / 1000); // current time in seconds 
```

另一个我还没有看到的是

```
var _ = require('lodash'); // from here https://lodash.com/docs#now
_.now(); 
```

* * *

## 回答 #14

> 赞同：30
> 
> 时间：2012-05-03T09:02:16.450

[`Date.getTime()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime)稍加调整即可使用该方法：

> getTime 方法返回的值是自 1970 年 1 月 1 日 00:00:00 UTC 以来的毫秒数。

[`floor`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/floor)如有必要，将结果除以 1000 以获得 Unix 时间戳：

```
(new Date).getTime() / 1000 
```

* * *

^(该`Date.valueOf()`方法在功能上等同于`Date.getTime()`，这使得可以在日期对象上使用算术运算符来获得相同的结果。在我看来，这种方法会影响可读性。)

* * *

## 回答 #15

> 赞同：26
> 
> 时间：2015-10-14T16:41:30.740

代码`Math.floor(new Date().getTime() / 1000)`可以缩短为`new Date / 1E3 | 0`.

考虑跳过直接[`getTime()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime)调用并`| 0`用作函数的替代品[`Math.floor()`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Math/floor)。`1E3`记住是一个更短的等价物也很好`1000`（大写 E 比小写更适合表示`1E3`为常数）。

结果，您得到以下结果：

```
var ts = new Date / 1E3 | 0;

console.log(ts);
```

* * *

## 回答 #16

> 赞同：23
> 
> 时间：2015-07-14T08:29:56.083

我强烈推荐使用`moment.js`. 要获取自 UNIX 纪元以来的毫秒数，请执行

```
moment().valueOf() 
```

要获取自 UNIX 纪元以来的秒数，请执行

```
moment().unix() 
```

您还可以像这样转换时间：

```
moment('2015-07-12 14:59:23', 'YYYY-MM-DD HH:mm:ss').valueOf() 
```

我一直这样做。没有双关语的意思。

`moment.js`在浏览器中使用：

```
<script src="moment.js"></script>
<script>
    moment().valueOf();
</script> 
```

有关更多详细信息，包括安装和使用 MomentJS 的其他方式，请参阅他们的[文档](http://momentjs.com/docs/)

* * *

## 回答 #17

> 赞同：22
> 
> 时间：2015-07-06T00:01:55.000

对于具有微秒分辨率的时间戳，有[`performance.now`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now)：

```
function time() { 
  return performance.now() + performance.timing.navigationStart;
} 
```

例如，这可以产生`1436140826653.139`，而`Date.now`只给出`1436140826653`。

* * *

## 回答 #18

> 赞同：21
> 
> 时间：2013-05-21T09:22:20.913

这是一个生成时间戳的简单函数，格式为：mm/dd/yy hh:mi:ss

```
function getTimeStamp() {
    var now = new Date();
    return ((now.getMonth() + 1) + '/' +
            (now.getDate()) + '/' +
             now.getFullYear() + " " +
             now.getHours() + ':' +
             ((now.getMinutes() < 10)
                 ? ("0" + now.getMinutes())
                 : (now.getMinutes())) + ':' +
             ((now.getSeconds() < 10)
                 ? ("0" + now.getSeconds())
                 : (now.getSeconds())));
} 
```

* * *

## 回答 #19

> 赞同：21
> 
> 时间：2016-03-16T05:45:22.850

你只能使用

```
 var timestamp = new Date().getTime();
    console.log(timestamp);
```

获取当前时间戳。无需做任何额外的事情。

* * *

## 回答 #20

> 赞同：20
> 
> 时间：2015-09-29T13:55:41.480

```
// The Current Unix Timestamp
// 1443534720 seconds since Jan 01 1970\. (UTC)

// seconds
console.log(Math.floor(new Date().valueOf() / 1000)); // 1443534720
console.log(Math.floor(Date.now() / 1000)); // 1443534720
console.log(Math.floor(new Date().getTime() / 1000)); // 1443534720

// milliseconds
console.log(Math.floor(new Date().valueOf())); // 1443534720087
console.log(Math.floor(Date.now())); // 1443534720087
console.log(Math.floor(new Date().getTime())); // 1443534720087

// jQuery
// seconds
console.log(Math.floor($.now() / 1000)); // 1443534720
// milliseconds
console.log($.now()); // 1443534720087
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
```

* * *

## 回答 #21

> 赞同：19
> 
> 时间：2019-05-18T20:43:00.543

如果是用于记录目的，您可以使用**ISOString**

`new Date().toISOString()`

> “2019-05-18T20:02:36.694Z”

* * *

## 回答 #22

> 赞同：16
> 
> 时间：2013-05-09T06:53:40.297

任何不支持 Date.now 的浏览器，您可以使用它来获取当前日期时间：

```
currentTime = Date.now() || +new Date() 
```

* * *

## 回答 #23

> 赞同：15
> 
> 时间：2015-10-09T02:03:25.737

这似乎有效。

```
console.log(clock.now);
// returns 1444356078076

console.log(clock.format(clock.now));
//returns 10/8/2015 21:02:16

console.log(clock.format(clock.now + clock.add(10, 'minutes'))); 
//returns 10/8/2015 21:08:18

var clock = {
    now:Date.now(),
    add:function (qty, units) {
            switch(units.toLowerCase()) {
                case 'weeks'   :  val = qty * 1000 * 60 * 60 * 24 * 7;  break;
                case 'days'    :  val = qty * 1000 * 60 * 60 * 24;  break;
                case 'hours'   :  val = qty * 1000 * 60 * 60;  break;
                case 'minutes' :  val = qty * 1000 * 60;  break;
                case 'seconds' :  val = qty * 1000;  break;
                default       :  val = undefined;  break;
                }
            return val;
            },
    format:function (timestamp){
            var date = new Date(timestamp);
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var hours = date.getHours();
            var minutes = "0" + date.getMinutes();
            var seconds = "0" + date.getSeconds();
            // Will display time in xx/xx/xxxx 00:00:00 format
            return formattedTime = month + '/' + 
                                day + '/' + 
                                year + ' ' + 
                                hours + ':' + 
                                minutes.substr(-2) + 
                                ':' + seconds.substr(-2);
            }
}; 
```

* * *

## 回答 #24

> 赞同：14
> 
> 时间：2013-07-01T06:47:59.603

这个有一个解决方案：在 js 中将 unixtime stamp 转换为 tim 试试这个

```
var a = new Date(UNIX_timestamp*1000);
var hour = a.getUTCHours();
var min = a.getUTCMinutes();
var sec = a.getUTCSeconds(); 
```

* * *

## 回答 #25

> 赞同：14
> 
> 时间：2015-03-11T09:52:48.580

[前几天，我从JQuery Cookie](https://github.com/carhartl/jquery-cookie/blob/master/src/jquery.cookie.js)的源代码中学到了一种将给定 Date 对象转换为 Unix 时间戳的非常酷的方法。

这是一个例子：

```
var date = new Date();
var timestamp = +date; 
```

* * *

## 回答 #26

> 赞同：14
> 
> 时间：2015-05-29T13:40:52.797

如果想要一种在 Node.js 中生成时间戳的基本方法，这很有效。

```
var time = process.hrtime();
var timestamp = Math.round( time[ 0 ] * 1e3 + time[ 1 ] / 1e6 ); 
```

我们的团队正在使用它来破坏 localhost 环境中的缓存。输出是由 生成的时间戳`/dist/css/global.css?v=245521377`在哪里。`245521377``hrtime()`

希望这会有所帮助，上面的方法也可以工作，但我发现这是满足我们在 Node.js 中需要的最简单的方法。

* * *

## 回答 #27

> 赞同：12
> 
> 时间：2015-03-30T08:40:23.620

对于[lodash](https://lodash.com/docs#now)和[下划线](http://underscorejs.org/#now)用户，请使用`_.now`.

```
var timestamp = _.now(); // in milliseconds 
```

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2015-03-06T00:33:36.437

[Moment.js](http://momentjs.com)可以抽象出处理 Javascript 日期的许多痛苦。

请参阅： http: [//momentjs.com/docs/#/displaying/unix-timestamp/](http://momentjs.com/docs/#/displaying/unix-timestamp/)

```
moment().unix(); 
```

* * *

## 回答 #29

> 赞同：10
> 
> 时间：2017-12-14T10:09:55.357

在撰写本文时，最佳答案是 9 年，从那时起发生了很多变化 - 尤其是，我们几乎普遍支持非 hacky 解决方案：

```
Date.now() 
```

如果您想绝对确定这不会在某些古老的（ie9 之前）浏览器中中断，您可以将其置于检查后，如下所示：

```
const currentTimestamp = (!Date.now ? +new Date() : Date.now()); 
```

这将返回自纪元时间以来的毫秒数，当然，不是秒。

[Date.now 上的 MDN 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now "日期.现在在 MDN")

* * *

## 回答 #30

> 赞同：9
> 
> 时间：2013-10-26T03:51:22.107

更简单的方法：

```
var timeStamp=event.timestamp || new Date().getTime(); 
```

* * *

## 回答 #31

> 赞同：8
> 
> 时间：2014-04-24T06:46:40.250

有时我在 xmlhttp 调用的对象中需要它，所以我喜欢这样。

```
timestamp : parseInt(new Date().getTime()/1000, 10) 
```

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2015-04-13T08:29:01.533

```
var d = new Date();
console.log(d.valueOf()); 
```

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2019-11-26T04:33:05.727

**在 JavaScript 中获取时间戳**

> 在 JavaScript 中，时间戳是自 1970 年 1 月 1 日以来经过的毫秒数。
> 
> 如果你不打算支持< IE8，你可以使用

```
new Date().getTime(); + new Date(); and Date.now(); 
```

无需创建新的 Date 对象即可直接获取时间戳。

> 返回所需的时间戳

```
new Date("11/01/2018").getTime() 
```

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2015-03-27T11:43:20.353

就代码可读性而言，建议的正确方法是`Number(new Date())`，

此外，UglifyJS 和 Google-Closure-Compiler 将降低已解析代码逻辑树的复杂性（如果您使用其中之一来模糊/缩小代码，则相关）。

对于时间分辨率较低的 Unix 时间戳，只需将当前数字除以`1000`，保持整数。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2015-03-26T19:47:12.230

`var my_timestamp = ~~(Date.now()/1000);`

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2018-03-28T05:22:44.773

```
function getTimeStamp() {
    var now = new Date();
    return ((now.getMonth() + 1) + '/' +
            (now.getDate()) + '/' +
             now.getFullYear() + " " +
             now.getHours() + ':' +
             ((now.getMinutes() < 10)
                 ? ("0" + now.getMinutes())
                 : (now.getMinutes())) + ':' +
             ((now.getSeconds() < 10)
                 ? ("0" + now.getSeconds())
                 : (now.getSeconds())));
} 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2021-01-22T15:54:49.683

有很多方法可以做到这一点。

```
 Date.now() 
 new Date().getTime() 
 new Date().valueOf() 
```

> 要以秒为单位获取时间戳，请使用以下方法进行转换：

```
Math.floor(Date.now() / 1000) 
```

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2021-12-07T20:35:42.643

```
//if you need 10 digits
   alert('timestamp '+ts());
function ts() {
    return parseInt(Date.now()/1000);

}
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2014-05-22T21:00:20.317

这是在 JavaScript 中生成时间戳的另一种解决方案 - 包括单个数字的填充方法 - 在其结果中使用日、月、年、小时、分钟和秒（在[jsfiddle](http://jsfiddle.net/AcLzd/9/)的工作示例）：

```
var pad = function(int) { return int < 10 ? 0 + int : int; };
var timestamp = new Date();

    timestamp.day = [
        pad(timestamp.getDate()),
        pad(timestamp.getMonth() + 1), // getMonth() returns 0 to 11.
        timestamp.getFullYear()
    ];

    timestamp.time = [
        pad(timestamp.getHours()),
        pad(timestamp.getMinutes()),
        pad(timestamp.getSeconds())
    ];

timestamp.now = parseInt(timestamp.day.join("") + timestamp.time.join(""));
alert(timestamp.now); 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2020-03-02T13:30:36.973

> 要分别获取时间、月、日、年，这将起作用

```
var currentTime = new Date();
var month = currentTime.getMonth() + 1;
var day = currentTime.getDate();
var year = currentTime.getFullYear(); 
```

* * *

## 回答 #41

> 赞同：-21
> 
> 时间：2009-11-11T11:38:57.843

```
time = Math.round(((new Date()).getTime()-Date.UTC(1970,0,1))/1000); 
```

# vba - MS Word 内容控件有什么好处？

> ID：221300
> 
> 赞同：3
> 
> 时间：2008-10-21T09:34:07.383
> 
> 标签：vba, ms-word, word-2007

Office 2007 带来了一个称为“内容控件”的新功能。我需要对此进行评估，看看这是否可以作为正在研究的问题的解决方案。

由于时间有限以及我对 Office-interop-pains 普遍不屑一顾，

*   有人可以总结一下好处吗？
*   是否可以定义自定义内容控件？
*   所有单词程序员（如果有的话）都在哪里闲逛:)？

也欢迎 RTFMsdn 链接。

到目前为止，我看到（从一些截屏视频中）现在可以定义 - 模板 word 文档，其内容可以从 data-behind-XML 中存根。您可以根据需要创建此 XML。例如，将 DB 的内容转换为 XML 表单。doc 这个词现在可以“数据绑定”到这个 XML。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T12:25:45.040

经过2天的研究，这就是我发现的。

内容控件是旧书签演变的下一步。

1.  **保护**- 您可以保护文档中的内容控件，使用户无法对其进行编辑。例如，合同条款可能无法像文档的其他部分一样进行编辑
2.  **数据绑定**- 您可以在 word doc 中创建“表单”，其中包含通过可视化设计器绑定到自定义 xml 的内容控件。2-way：更改 xml 会更新 word doc 中的控件，反之亦然。为您的 xml 输入一个 xml 架构，您也可以进行用户输入验证。内容控件可以通过 XPath 绑定到单个 xml 节点。
3.  **事件**- 内容控件公开您可以处理以进行自定义处理的事件。
4.  **文档自动生成**- 借助 IO.Packaging 命名空间、Open XML 规范 + Visual Studio 的一些知识，您可以创建一个框架文档，然后通过提供不同的数据存储/对象（自定义 xml ）。您还可以执行类似 .net 'DataTemplates' 之类的操作 - 例如，这是每个订单行项目的外观。对 xml 中的 n 个行项目重复此操作

最佳一目了然的帖子： http: [//blogs.msdn.com/kathleen/archive/2007/06/20/my-favorite-feature-word-content-controls.aspx](http://blogs.msdn.com/kathleen/archive/2007/06/20/my-favorite-feature-word-content-controls.aspx)
Mike Ormond 的截屏视频 - [http://blogs .msdn.com/mikeormond/archive/2007/05/24/office-open-xml-file-format-nuggets.aspx](http://blogs.msdn.com/mikeormond/archive/2007/05/24/office-open-xml-file-format-nuggets.aspx)

# javascript - javascript中怪癖模式的元素宽度？

> ID：221307
> 
> 赞同：6
> 
> 时间：2008-10-21T09:37:28.500
> 
> 标签：javascript, html, css

我一直在浏览所有流行的 js 库，但我找不到一个具有宽度函数的 DOM 元素，它实际上解释了 Internet Explorer 中的怪癖模式。问题是当使用 quirks 模式时，填充和边框不计入宽度。据我所知，当文档类型被忽略或文档类型设置为 html 3.2 时会发生这种情况。

显然我可以将 doctype 设置为符合标准的东西，但是这个脚本可以嵌入到任何地方，所以我无法控制 doctype。

要将问题分解为更小的部分：

1）你如何检测怪癖模式？2）从元素中提取边框和填充以进行补偿的最佳方法是什么？

原型示例：

```
<html>
<head>
</head>
<body>

<div id="mydiv" style="width: 250px; pading-left: 1px; border: 2px black solid">hello</div>

<script>
  alert($('mydiv').getWidth())
</script>

</body>
</html> 
```

结果：

253 (ff) 250 (即)

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T13:34:45.727

@1

```
document.compatMode 
```

“CSS1Compat”表示“*标准模式*”，“BackCompat”表示“*怪癖模式*”。

@2

HTML 元素的 offsetWidth 属性给出了它在屏幕上的宽度，以像素为单位。

```
<div id="mydiv" style="width: 250px; padding-left: 1px; border: 2px black solid">hello</div>

document.getElementById('mydiv').offsetWidth
//255 (standards) 250 (quirks) 
```

补偿 IE quirksmode 宽度的函数必须检查渲染模式，然后为宽度添加边框和填充；

```
function compensateWidth( el, targetWidth ){

    var removeUnit = function( str ){
        if( str.indexOf('px') ){
            return str.replace('px','') * 1;
        }
        else { //because won't work for other units... one may wish to implement 
            return 0;
        }
    }
    if(document.compatMode && document.compatMode=="BackCompat"){
        if(targetWidth && el.offsetWidth < targetWidth){
            el.style.width = targetWidth;
        }
        else if (el.currentStyle){
            var borders = removeUnit(el.currentStyle['borderLeftWidth']) + removeUnit(el.currentStyle['borderRightWidth']);
            var paddings = removeUnit(el.currentStyle['paddingLeft']) + removeUnit(el.currentStyle['paddingRight']);
            el.style.width = el.offsetWidth + borders + paddings +'px';
        }
    }

} 
```

现在有两种使用方法：

```
var div = document.getElementById('mydiv')
// will try to calculate target width, but won't be able to work with units other than px
compensateWidth( div );

//if you know what the width should be in standards mode
compensateWidth( div, 254 ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T10:31:22.057

图书馆可能说的是真的。问题不在于读数不正确，而在于实际显示不正确。例如尝试：

```
<div id="mydiv" style="width: 100px; border-left: 100px black solid;">&nbsp;</div> 
```

然后尝试更改 div 内的文本以查看发生了什么。IE 会根据里面的文本显示不同的值，而 FF 会正确显示。IE 试图将 100px + 的东西填充到 100px 的空间中，并产生各种结果。

jQuery 有两种宽度方法：.width 和 .outerWidth。.outerWidth 将返回元素的全宽。它还可以获取所有其他属性（填充、边框等），如下例所示：

```
$(document).ready(function() {
    alert("width=" + $('#mydiv').width() 
    + " outerWidth=" + $('#mydiv').outerWidth() 
    + " borderLeftWidth=" + $('#mydiv').css("borderLeftWidth"))
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T12:49:17.880

```
javascript:(function(){
    var mode=document.compatmode,m;if(mode){
        if(mode=='BackCompat')m='quirks';
        else if(mode=='CSS1Compat')m='Standard';
        else m='Almost Standard';
        alert('The page is rendering in '+m+' mode.');
    }
})(); 
```

该代码将为您检测模式。

如果除了 doctype 之外的任何内容都在第一行，IE 也会进入 quirks 模式。即使是第二行带有 doctype 的空白第一行也会导致怪癖模式。

# ruby - Ruby 有哪些代码高亮库？

> ID：221310
> 
> 赞同：5
> 
> 时间：2008-10-21T09:38:18.717
> 
> 标签：ruby, syntax-highlighting, ramaze, codehighlighter

我还感兴趣的是哪些具有或多或少的依赖关系。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T10:43:12.860

我正在使用[Coderay](http://coderay.rubychan.de/)（[请参阅本文底部的实际操作](http://blog.logeek.fr/2008/3/31/data-visualization-with-ruby-and-rmagick-where-are-those-bikes)）

不确定它有多少（如果有）依赖项。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T14:45:30.623

另见[紫外线](http://ultraviolet.rubyforge.org/)库。

> Ultraviolet 是一个基于 Textpow 的语法高亮引擎。由于它使用 Textmate 语法文件，它为 50 多种语言和 20 个主题提供了开箱即用的语法突出显示。
> 
> Ultraviolet 同时是一个独立的命令行实用程序和一个 Ruby 库。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2008-10-21T10:09:42.583

[谷歌是我们的朋友](http://www.google.hu/search?q=ruby+syntax+highlighting+library&btnG=Keres%C3%A9s&hl=hu&sa=2)...

第一次点击：[http ://syntax.rubyforge.org/chapter-1.html#s1](http://syntax.rubyforge.org/chapter-1.html#s1)

# algorithm - 通过小世界图找到路径的最有效方法是什么？

> ID：221311
> 
> 赞同：14
> 
> 时间：2008-10-21T09:38:22.320
> 
> 标签：algorithm, graph-theory, path-finding

我有大量加权节点，边缘将节点集群连接在一起。该图遵循典型的小世界布局。

我希望找到一种寻路算法，它不会消耗处理器能力，沿着最佳可能路径找到一条路径，其中节点的权重最有利，最快的路线不是最重要的因素。该算法还考虑了负载和流量重新路由。

（旁注：这里可以使用神经网络吗？）

谢谢

* * *

我在看[**ACO**](http://www.scholarpedia.org/article/Ant_colony_optimization)。对于这种问题，有什么比 ACO 更好的吗？

* * *

正确的[**A***](http://en.wikipedia.org/wiki/A%2A)算法在没有负载平衡的情况下找到成本最低或最快的路线。

可以说最快或最短的路线不是最重要的路线，更重要的是遵循加权节点具有一定值的路径。没有。

没有2。如果使用 A*，那条路由上的流量就会超载，那么这条路径突然就变得多余了。因此，尽管 A* 很酷，但它没有 ACO 的某些特性，即固有的负载平衡。

-- 除非我弄错和误解了 A*

那么什么比 ACO 更胜一筹？

* * *

这看起来真的像是 ACO 和 A* 之间的一场对决，关于 A* 的正面讨论太多了，我一定会更深入地研究它。

首先是对大卫的回应；我可以在后台运行 ACO 模拟并提出最佳路径，所以是的，有初始启动成本，但幸运的是，启动并不是必需的。所以我有能力多次运行模拟。一个真正的麻烦是找到连接的源节点和目标节点。而 A* 似乎很容易做到这一点。现在，当这个网络变得像数百万个节点一样大时会发生什么。A* 能否轻松扩展？

我将进一步研究 A*。但我留给你最后一个问题！

A* 能否像 Antnet (ACO) 一样扩展？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T11:07:34.310

### 一般注意事项

Dijkstra 的算法及其优化的变体 A* 通过您的图形找到具有“最低”成本的路径。重要的是 a) 正确定义图表和 b) 定义适当的成本函数。

面对不断变化的成本函数，Dijksta 需要重新计算解决方案。

对于负载平衡，我将扩展 Dikstra 以不仅计算最佳路径，而且使用某种洪水填充行为来创建一组可能的路径（按成本排序）以找到替代方案。只有有关特定问题和成本函数的知识才能回答这是否可行以及如何可行。

另一方面，[蚁群优化在适应不断变化的成本函数方面似乎要灵活得多，方法是在成本函数变化之后/同时继续迭代。](http://www.scholarpedia.org/article/Ant_colony_optimization)

### 效率

这在很大程度上取决于您的问题域。如果您有很好的启发式（参见[A* 文章的复杂性部分](http://en.wikipedia.org/wiki/A-star_algorithm#Complexity)）并且很少更改成本，那么 A* 的多项式运行时可能有利于重复重新计算。另一方面，ACO 必须一遍又一遍地迭代，然后才能收敛到一个近似的解决方案。如果成本变化非常频繁，以恒定速率继续迭代可能比更新 A* 解决方案更有效，因为信息保留在算法的状态中。ACO 不承诺**最佳**解决方案，但**可能**在收敛到“好的”解决方案之前具有较高的启动成本。同样，这在很大程度上取决于您的特定领域、图形和成本函数以及您对最优性的要求。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T10:55:58.730

使用 A*，路径成本不需要保持不变，因此您可以从下图开始：

```
A---1---B---1---C
|               |
\-------1-------/ 
```

我们想要从 A 到 C 的位置。最初，寻路算法将选择 AC 路径，因为 ABC 为 2，而 AC 为 1。我们可以在路径中添加一个额外的项：

```
A---r---B---r---C
|               |
\-------r-------/ 
```

和

```
r(NM) = k(NM) + users(NM) / 10 
```

在哪里

```
r(NM) is the cost for a connection between N and M,
k(NM) is the constant cost for a connection between N and M,
users(NM) is the number of objects using the connection 
```

随着用户被添加到系统中，在 20 个用户 (1 + 20/10) = 3，ABC 为 2 时，路由 AC 将比 ABC 更昂贵。随着用户从系统中移除，AC 路由将成为最佳选择再次。

A* 的真正威力是您用来计算每个连接成本的启发式方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T09:46:03.943

这个问题最常用的算法是[A* (A Star)](http://en.wikipedia.org/wiki/A-star_algorithm)，它是一种广义[的 Dijkstra 算法](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)搜索，添加了启发式算法 - 启发式算法的目的是将搜索引导到搜索目标，以便典型搜索更快地完成。

这个算法有很多变种、衍生版本和改进，谷歌搜索或者维基百科页面应该是一个很好的起点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T10:13:33.700

绝对是A*。如果不存在路径，A* 将找到可能的最佳路径或根本没有路径。例如，这艘船的路径是使用 A* 计算的

[![A* 游戏地图示例](https://i.stack.imgur.com/Yg2Ye.png)](https://i.stack.imgur.com/Yg2Ye.png)
[（来源：[cokeandcode.com](http://www.cokeandcode.com/images/path1.png)）]

这是一个可以玩的[交互式 Java Demo 。](http://aigamedev.com/demo/astar-pathfinding)请注意，此算法会因睡眠而变慢，因此您会看到它正在执行。如果没有这种减速，它将在不到一秒的时间内找到路径。

该算法简单但功能强大。每个节点有 3 个值，g 是该节点的成本。h 是从该节点到目标的估计成本，f 是两者的总和（这是对完整路径的猜测）。A* 维护两个列表，打开列表和关闭列表。Open 列表包含迄今为止尚未探索的所有节点。Closed 列出了所有已探索的节点。如果算法已经测试了连接到该节点的每个节点（连接只能表示水平和垂直，但如果允许节点之间的对角线移动，则也表示对角线），则该节点被视为已探索。

该算法可以描述为

1.  设P为起点
2.  将 g、h 和 f 值分配给 P
3.  将 P 添加到打开列表（此时 P 是该列表中唯一的节点）。
4.  让 B 成为 Open 列表中的最佳节点（最佳 == 最低 f 值）
    *   如果B是目标节点->退出，你找到了路径
    *   如果打开列表为空 -> 退出，则不存在路径
5.  设 C 为连接到 B 的有效节点
    *   将 g、h 和 f 分配给 C
    *   检查 C 是否在 Open 或 Closed 列表中
        *   如果是，检查新路径是否最有效（较低的 f 值）
            *   如果是，更新路径
        *   否则将 C 添加到打开列表
    *   对连接到 B 的所有节点重复步骤 5
6.  将 B 添加到封闭列表（我们探索了所有邻居）
7.  从第 4 步开始重复。

还可以查看[Wikipedia](http://en.wikipedia.org/wiki/A-star_algorithm)了解实现细节。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T09:47:17.747

普通的 Dijkstra 还不够吗？

[http://improve.dk/generic-dijkstras-algorithm/](http://improve.dk/generic-dijkstras-algorithm/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T01:33:23.127

我也听说过可以处理此类问题的 NN 实现。因此，如果您想使用 NN，您最终会找到自己的方式；-) 但与“遗传算法”相比，它们必须逊色。

如果计算/时间消耗是一个问题，我强烈建议使用遗传算法。这正是他们擅长的问题类型。

GA 基于描述您对任何给定解决方案的满意度的函数。您可以修改此函数以满足您的需要（即，您不仅可以包含路径成本，还可以包含您希望的任何因素）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-03T08:06:42.240

Dijkstras 算法，给你的小例子

```
graph = {}

graph["start"] = {}
graph["start"]["a"] = 6
graph["start"]["b"] = 2
graph["a"] = {}
graph["a"]["finish"] = 1
graph["b"] = {}
graph["b"]["a"] = 3
graph["b"]["finish"] = 5
graph["finish"] = {}

infinity = float("inf")
costs = {}
costs["a"] = 6
costs["b"] = 2
costs["finish"] = infinity
print "The weight of each node is: ", costs

parents = {}
parents["a"] = "start"
parents["b"] = "start"
parents["finish"] = None

processed = []

def find_lowest_cost_node(costs):
    lowest_cost = float("inf")
    lowest_cost_node = None
    for node in costs:
        cost = costs[node]
        if cost < lowest_cost and node not in processed:
            lowest_cost = cost
            lowest_cost_node = node
    return lowest_cost_node

node = find_lowest_cost_node(costs)
print "Start: the lowest cost node is", node, "with weight",\
    graph["start"]["{}".format(node)]

while node is not None:
    cost = costs[node]
    print "Continue execution ..."
    print "The weight of node {} is".format(node), cost
    neighbors = graph[node]
    if neighbors != {}:
        print "The node {} has neighbors:".format(node), neighbors
    else:
        print "It is finish, we have the answer: {}".format(cost)
    for neighbor in neighbors.keys():
        new_cost = cost + neighbors[neighbor]
        if costs[neighbor] > new_cost:
            costs[neighbor] = new_cost
            parents[neighbor] = node
    processed.append(node)
    print "This nodes we researched:", processed
    node = find_lowest_cost_node(costs)
    if node is not None:
        print "Look at the neighbor:", node

# to draw graph
import networkx
G = networkx.Graph()
G.add_nodes_from(graph)
G.add_edge("start", "a", weight=6)
G.add_edge("b", "a", weight=3)
G.add_edge("start", "b", weight=2)
G.add_edge("a", "finish", weight=1)
G.add_edge("b", "finish", weight=5)

import matplotlib.pyplot as plt
networkx.draw(G, with_labels=True)
plt.show()

print "But the shortest path is:", networkx.shortest_path(G, "start", "finish") 
```

# sharepoint - Moss 2007：更改搜索选项的标签（高级搜索）

> ID：221317
> 
> 赞同：3
> 
> 时间：2008-10-21T09:40:20.227
> 
> 标签：sharepoint, search, moss

我创建了一个自定义搜索页面，在我的搜索范围内包含一些已定义的选项。

我有一个 metadata mapped `jobtitle`，并将搜索选项添加到我的自定义搜索中。

```
<Property name="JobTitle" 
          ManagedName="title" 
          ProfileURI="urn:schemas-microsoft-com:sharepoint:portal:profile:Title"/> 
```

我想将我的托管名称更改为`jobtitle`，因为 title 不符合荷兰语的 jobtitle 单词。我将托管名称更改为`jobtitle`，应用更改后它不会更改标签。

有人有想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T21:18:48.317

由于您使用的是自定义搜索页面，因此很难确切知道您的问题是什么。

我假设您创建了一个新的托管属性并将其映射到某些东西。`xsl/xml`然后，您通过编辑（[此处](http://www.sharepoint-tips.com/2006/07/found-it-how-to-add-properties-to.html)的方向）将其添加到高级搜索 Web 部件。如果您更改刚刚添加的属性的名称，则还需要更新 Web 部件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T21:02:48.773

在重新抓取数据之前，对托管属性的更改不会出现在搜索结果中。我建议您重置搜索索引并进行全面爬网。

# ruby - Ruby 中的标准文件命名约定

> ID：221320
> 
> 赞同：55
> 
> 时间：2008-10-21T09:44:00.187
> 
> 标签：ruby, file, naming-conventions, conventions

对于包含给定类 SomeCoolClass 的文件，正确或标准的文件名是什么？

```
1.somecoolclass.rb
 2\. some_cool_class.rb
 3\. some-cool-class.rb
 4.SomeCoolClass.rb

```

或其他一些变化？

我注意到在 Ruby 标准库中，使用了版本 1、2 和 3。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-21T10:25:28.043

只有[Ruby](http://www.ruby-lang.org)（即不是Rails），命名只是一个约定。在[Rails](http://rubyonrails.org)中，使用下划线的[约定](http://itsignals.cascadia.com.au/?p=7)是必要的（几乎）。

我认为约定 #2 `lowercase_and_underscore.rb`更常见并且看起来相当不错，尽管文章[Here](http://rails.learnhub.com/lesson/page/5028-ruby-coding-convention)说`lowercasenounderscore.rb`是 Ruby 约定。

**选择**哪个惯例更常见，或者你更喜欢哪个惯例。最重要的是**在项目中保持一致**。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-21T14:53:10.327

我个人认为连字符作为单词分隔符通常可以最大程度地提高可读性和可打字性，因此我建议在可能的情况下（在某些情况下，不能使用连字符，例如在大多数语言的标识符中）。要记住的一件重要事情是，您选择的方案将与用户将与您的 lib 一起使用的 require 语句产生影响，并且您希望**避免使用与 library name 不同的 gem 名称**。

坏的

```
# gem install my_cool_lib
require 'my-cool-lib'

# gem install MyCoolLib
require 'my_cool_lib' 
```

好的

```
# gem install my_cool_lib
require 'my_cool_lib'

# gem install my-cool-lib
require 'my-cool-lib' 
```

不幸的是，少数库违反了这个简单的可用性规则。不要成为那些图书馆之一。:)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T11:07:34.293

我会推荐带下划线的小写字符（你的问题中的数字 2）。确实，这种命名方案是 Rails 中的约定，在非 Rails 项目中不是必需的。但是，我仍然会坚持 Rails 约定，因为大多数 Ruby 程序员可能都将 Ruby 专门用于 Rails。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-03-05T11:11:33.493

```
my-proj
├── README
├── lib
│   └── some_cool_class.rb
└── test
    └── some_cool_class_test.rb 
```

# c# - 共享程序集

> ID：221323
> 
> 赞同：3
> 
> 时间：2008-10-21T09:45:11.183
> 
> 标签：c#

A 有一个设计问题。我写了几个 c# 应用程序。这些应用程序中的大多数都有自己的sql或access数据库，但它们也共享一个公共数据库，但它们是完全不同的应用程序，在各自的业务领域有自己的职责。

与我交谈过的一些人认为：应用程序应该是孤岛。他们不应该分享任何东西。不共享组件、组件或数据库。

我需要这方面的建议。什么时候可以接受分享，或者这不是一个好主意。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T10:02:36.780

有一条线，某处......积极鼓励共享库代码 - 但是当应用程序相互消耗时你需要小心*一点*，只是为了防止意大利面条式代码和循环引用。

如果您提到的代码确实是库代码（即两个项目都不是此数据的“主”），那么它应该没问题（除了版本控制问题）。如果是项目 A 想要项目 B 的数据，那么通常没多久，项目 B 想要项目 A 的数据，并且你有一个蜘蛛网。在这种情况下，最好使用 SOA 方法；让项目通过 WCF 服务之类的方式公开其数据，以便其他项目仅调用公共 mex/wsdl API（最好不共享程序集）。

但这是一个看似复杂的问题，我认为任何单一的答案都不能满足所有情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T10:11:09.617

我想说**只分享设计和打算分享的东西。**

大多数时候，我发现代码共享只是出于懒惰，也就是说，共享的代码根本不是为了共享而设计的，也不是为了共享而设计的。当原始代码需要更改并且没有简单的方法可以做到这一点时，这几乎总是会导致问题，因为**代码旨在从一个位置**而不是多个位置使用，因此设计者没有应对扩展的可能性对于多个“用户”。

另一方面，您可能会想到您正在设计要共享的东西，例如通信库或加密库或整个 .NET 框架。在这种情况下，共享是理想的，并且将提高可维护性和代码重用性，因为设计从一开始就涵盖了它。

这不仅适用于程序集，还适用于类、资源或项目的任何其他部分。这就是为什么**设计如此重要**的原因，因为事先考虑过它，**您已经预见到了大多数可能的复杂性**，因此共享的影响已被量化和限制，因此**共享的成本低于收益**。如果您在不考虑后果的情况下急于共享，那么您的代码将不会为此做好准备，因此调整代码以进行共享的成本或共享的相关问题将远远高于任何可能的收益。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T09:51:47.287

这不是汇编的“dll”的全部意义吗？分享东西...

当您可以在程序集中共享内容时，为什么要重新创建和双重维护代码？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T09:57:48.583

您应该共享所有内容（当然在常识范围内）。您是一个开发人员团队，而不是一组单独的开发人员。共享代码有很多好处：可重用性意味着更快的开发、更简单的维护（您只需修复一次错误）、新功能或改进可能会立即使所有相关项目受益，这也意味着共享想法。就个人而言，我从同事编写的源代码中学到了一些技巧和良好实践。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T10:01:33.177

使用 dll 共享代码的好处是您只需编写一次代码。如果每个应用程序都是一个孤岛，那么您必须保留相同代码的多个副本，因此必须在许多地方潜在地修复相同的错误。

然而，在应用程序之间共享代码会带来一系列问题。在您共享代码的那一刻，您会遇到不同应用程序需要不同版本的共享代码的问题。这通常被称为[dll 地狱](http://en.wikipedia.org/wiki/DLL_hell)。即使是.NET——它的系统允许同一个dll的多个版本在一个系统上共存——也不能解决所有问题。除非您可以让所有客户了解所有产品的最新信息，否则您仍然可能会遇到必须对同一个 dll 的不同版本进行相同更改的情况。

这个没有正确答案。孤岛和共享都给他们带来了问题。

编辑：

如果您指的是在孤岛中工作而不是共享代码的团队，那么 DrJokepu 是对的：在个人和团队之间共享开发工作是绝对“必须做的”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T10:05:48.833

仅从理论的角度来看，跨应用程序共享程序集才有意义。实际上它带来了一大堆问题。避免程序集共享，在本地部署所有程序集。

# python - 如何在 Django 模型中编写方法来检索相关对象？

> ID：221328
> 
> 赞同：2
> 
> 时间：2008-10-21T09:49:04.373
> 
> 标签：python, django, model-view-controller, frameworks

我有两个模型。我们称它们为对象 A 和对象 B。它们的设计如下所示：

```
class Foo(models.Model):
     name = models.CharField()

class Bar(models.Model):
     title = models.CharField()
     Foo= models.ForeignKey('myapp.Foo') 
```

现在，假设我想在 Foo 中创建一个方法，该方法返回引用该 Foo 实例的所有 Bar 对象。我该怎么做呢？

```
class Foo(models.Model):
     name = models.CharField()
     def returnBars(self):
         ???? 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T09:54:58.620

你可以免费得到这个：

[http://docs.djangoproject.com/en/dev/topics/db/queries/#backwards-related-objects](http://docs.djangoproject.com/en/dev/topics/db/queries/#backwards-related-objects)

默认情况下，您可以访问管理器，该管理器使您可以通过`RELATEDCLASSNAME_set`属性访问相关项目：

```
some_foo.bar_set.all() 
```

或者你可以使用`related_name`参数来`ForeignKey`指定应该持有反向关系管理器的属性：

```
class Foo(models.Model):
     name = models.CharField()

class Bar(models.Model):
     title = models.CharField()
     foo = models.ForeignKey(Foo, related_name='bars')

...

some_foo.bars.all() 
```

# java - 我应该如何实现一个下拉框，其中包含需要以不同语言显示的项目列表？

> ID：221336
> 
> 赞同：1
> 
> 时间：2008-10-21T09:53:59.667
> 
> 标签：java, internationalization, enums, drop-down-menu, lookup-tables

我正在尝试设计一个表单，其中包含一个包含杂货选择列表的下拉框。

在尝试决定是使用 java 枚举还是查找表时，我应该查看哪些标准？此外，我需要提前计划 i18n 对下拉字符串的支持。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T10:22:52.917

我尝试最小化查找表并尽可能多地使用枚举和代码，直到每个项目都附加了一些需要持久化的额外数据。此外，我通常在枚举中使用映射到 ResourceBundle 字符串的键来找到正确的翻译。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T11:20:43.330

使用[属性资源包](http://java.sun.com/j2se/1.4.2/docs/api/java/util/PropertyResourceBundle.html)。它们专为这种情况而设计，您必须添加 i18n 支持。

记住要考虑排序/排序。所有语言的列表是否会以相同的顺序显示？还是根据语言环境按字母顺序排序？

# python - 是否可以在 TextMate 中实现 Python 代码补全？

> ID：221339
> 
> 赞同：20
> 
> 时间：2008-10-21T09:54:58.807
> 
> 标签：python, autocomplete, text-editor, textmate

[PySmell](http://github.com/orestis/pysmell/tree/master)似乎是一个很好的起点。

我认为这应该是可能的，PySmell`idehelper.py`做了大部分复杂的事情，它应该只是给它当前行，提供完成（我不确定的位）然后用选定的行替换行的情况一。

```
>>> import idehelper
>>> # The path is where my PYSMELLTAGS file is located:
>>> PYSMELLDICT = idehelper.findPYSMELLDICT("/Users/dbr/Desktop/pysmell/")
>>> options = idehelper.detectCompletionType("", "" 1, 2, "", PYSMELLDICT)
>>> completions = idehelper.findCompletions("proc", PYSMELLDICT, options)
>>> print completions
[{'dup': '1', 'menu': 'pysmell.pysmell', 'kind': 'f', 'word': 'process', 'abbr': 'process(argList, excluded, output, verbose=False)'}] 
```

它永远不会完美，但它会非常有用（即使只是为了完成 std​​lib 模块，它永远不会改变，所以你不必在添加函数时不断地重新生成 PYSMELLTAGS 文件）

* * *

进步！我有完成的全部基础 - 几乎没有工作，但它很接近..

我跑了`python pysmells.py /System/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/*.py -O /Library/Python/2.5/site-packages/pysmell/PYSMELLTAGS`

将以下内容放在 TextMate 捆绑脚本中，设置“输入：整个文档”、“输出：插入为文本”、“激活：等效键：alt+esc”、“范围选择器：source.python”

```
#!/usr/bin/env python

import os
import sys
from pysmell import idehelper

CUR_WORD = os.environ.get("TM_CURRENT_WORD")

cur_file = os.environ.get("TM_FILEPATH")
orig_source = sys.stdin.read()
line_no = int(os.environ.get("TM_LINE_NUMBER"))
cur_col = int(os.environ.get("TM_LINE_INDEX"))

# PYSMELLS is currently in site-packages/pysmell/
PYSMELLDICT = idehelper.findPYSMELLDICT("/Library/Python/2.5/site-packages/pysmell/blah")
options = idehelper.detectCompletionType(cur_file, orig_source, line_no, cur_col, "", PYSMELLDICT)
completions = idehelper.findCompletions(CUR_WORD, PYSMELLDICT, options)

if len(completions) > 0:
    new_word = completions[0]['word']
    new_word = new_word.replace(CUR_WORD, "", 1) # remove what user has already typed
    print new_word 
```

然后我新建了一个python文档，输入“import url”，按alt+escape，就完成了“import urllib”！

正如我所说，这完全是一个正在进行中的工作，所以不要使用它..

* * *

*最后更新：*

orestis 已将其集成到 PySmell 项目的代码中！任何进一步的摆弄都将[在 github 上进行](http://github.com/orestis/pysmell/tree/master)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T23:42:15.647

编辑：我实际上已经把你的代码放在上面并集成到一个命令中。它将正确显示一个完成列表供您选择。

您可以在这里获取它：http: [//github.com/orestis/pysmell/tree/master](http://github.com/orestis/pysmell/tree/master)（点击下载并执行 python setup.py 安装）。这很粗糙，但它有效。[- 请在http://code.google.com/p/pysmell/](http://code.google.com/p/pysmell/)上报告任何错误

--

你好，我是 PySmell 的开发者。我也使用 Mac，所以如果您可以给我发一封电子邮件（联系信息在源代码中），说明您目前的进度，我可以尝试整合它:)

哦，顺便说一句，它被称为 PySmell - 没有尾随 's' :)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T12:06:28.543

这不是您正在寻找的东西，但它可能会让您开始：

[在 Django 中使用 TextMate](http://code.djangoproject.com/wiki/TextMate)

它们似乎有点特定于 Django，但一些片段可能有助于满足您的需求。您还可以使用 PySmells 在此基础上进行构建。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T14:04:59.867

它并不完美，但您可以尝试一下：http: [//mtod.org/tempy](http://mtod.org/tempy)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T22:59:10.190

在 TextMate 中，PHP 以硬编码的一组函数名称的形式提供了一个简单的自动完成功能。听起来像 PHP 一样丑陋，但在实践中它已经足够好用了。

# c# - 如何获取“System.Drawing.Image”的文件大小

> ID：221345
> 
> 赞同：29
> 
> 时间：2008-10-21T10:00:04.337
> 
> 标签：c#, image, image-processing, image-manipulation

我目前正在编写一个系统，该系统存储大约 140,000 张 ish 图像的元数据，这些图像存储在一个遗留图像库中，这些图像正在移动到云存储中。我正在使用以下内容获取jpg数据...

```
System.Drawing.Image image = System.Drawing.Image.FromFile("filePath"); 
```

我对图像处理很陌生，但这对于获取宽度、高度、纵横比等简单值来说很好，但我无法解决的是如何检索以字节表示的 jpg 的物理文件大小。任何帮助将非常感激。

谢谢

最终解决方案，包括图像的 MD5 哈希，以供以后比较

```
System.Drawing.Image image = System.Drawing.Image.FromFile(filePath);

if (image != null)
{
  int width = image.Width;
  int height = image.Height;
  decimal aspectRatio = width > height ? decimal.divide(width, height) : decimal.divide(height, width);  
  int fileSize = (int)new System.IO.FileInfo(filePath).Length;

  using (System.IO.MemoryStream stream = new System.IO.MemoryStream(fileSize))
  {
    image.Save(stream, System.Drawing.Imaging.ImageFormat.Jpeg);
    Byte[] imageBytes = stream.GetBuffer();
    System.Security.Cryptography.MD5CryptoServiceProvider provider = new System.Security.Cryptography.MD5CryptoServiceProvider();
    Byte[] hash = provider.ComputeHash(imageBytes);

    System.Text.StringBuilder hashBuilder = new System.Text.StringBuilder();

    for (int i = 0; i < hash.Length; i++)
    {
      hashBuilder.Append(hash[i].ToString("X2"));
    }

    string md5 = hashBuilder.ToString();
  }

  image.Dispose();

} 
```

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-10-21T10:01:26.953

如果您直接从文件中获取图像，则可以使用以下代码获取原始文件的大小（以字节为单位）。

```
 var fileLength = new FileInfo(filePath).Length; 
```

如果您从其他来源获取图像，例如获取一个位图并将其与其他图像组合，例如添加水印，您将必须在运行时计算大小。您不能只使用原始文件大小，因为压缩可能会导致修改后的输出数据大小不同。在这种情况下，您可以使用 MemoryStream 将图像保存到：

```
long jpegByteSize;
using (var ms = new MemoryStream(estimatedLength)) // estimatedLength can be original fileLength
{
    image.Save(ms, ImageFormat.Jpeg); // save image to stream in Jpeg format
    jpegByteSize = ms.Length;
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T10:06:10.003

如果您没有原始文件，则文件大小不清楚，因为它取决于图像格式和质量。所以你要做的就是将图像写入流（例如 MemoryStream），然后使用流的大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T10:03:23.690

`System.Drawing.Image`不会给你大小的文件长度。您必须为此使用另一个库。

```
int len = (new System.IO.FileInfo(sFullPath)).Length; 
```

# c++ - 我可以使用什么来代替箭头运算符`->`？

> ID：221346
> 
> 赞同：124
> 
> 时间：2008-10-21T10:00:08.797
> 
> 标签：c++, pointers

箭头运算符 ( `->`) 的同义词是什么？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-10-21T10:02:47.653

以下两个表达式是等价的：

```
a->b

(*a).b 
```

（如 Konrad 所提到的，受运算符重载的影响，但这是不寻常的）。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-10-21T10:03:38.353

`a->b`一般是 的同义词`(*a).b`。这里的括号是必要的，因为运算符的绑定强度`*`和`.`: `*a.b`不起作用，因为`.`绑定更强并且首先执行。因此这等价于`*(a.b)`。

但是要小心重载：由于两者`->`和`*`都可以重载，它们的含义可能会有很大的不同。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2008-10-21T10:09:52.803

C++ 语言将箭头运算符 ( `->`) 定义为取消引用指针的同义词，然后`.`在该地址上使用 - 运算符。

例如：

如果你有一个对象，`anObject`和一个指针，`aPointer`：

```
SomeClass anObject = new SomeClass();
SomeClass *aPointer = &anObject; 
```

为了能够使用您取消引用指针并对该地址执行方法调用的对象方法之一：

```
(*aPointer).method(); 
```

可以用箭头运算符编写：

```
aPointer->method(); 
```

箭头操作符存在的主要原因是它缩短了一个非常常见的任务的打字时间，而且它也很容易忘记指针解引用周围的括号。如果您忘记了括号，.-operator 将绑定比 *-operator 更强，并使我们的示例执行为：

```
*(aPointer.method()); // Not our intention! 
```

其他一些答案也提到了 C++ 运算符可以重载并且它并不常见。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2010-11-06T15:06:11.263

在 C++0x 中，运算符有第二个含义，表示函数或 lambda 表达式的返回类型

```
auto f() -> int; // "->" means "returns ..." 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-21T10:05:37.943

我主要是从右到左阅读并调用“in”

```
foo->bar->baz = qux->croak 
```

变成：

“在 foo 中的 bar 中的 baz 在 qux 中变成了呱呱。”

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-03-08T12:33:32.477

`->`在访问您有指针的数据时使用。

例如，您可以创建一个指向 int intVar 类型变量的指针 ptr，如下所示：

```
int* prt = &intVar; 
```

然后，您可以仅通过取消引用该指针来在其上使用函数，例如 foo - 以在指针指向的变量上调用函数，而不是在该变量的内存位置的数值上调用函数：

```
(*ptr).foo(); 
```

如果没有括号，编译器会理解为`*(ptr.foo())`运算符优先级，这不是我们想要的。

这实际上和打字一样

```
ptr->foo(); 
```

由于`->`取消引用该指针，因此调用`foo()`指针为我们指向的变量上的函数。

同样，我们可以使用`->`来访问或设置一个类的成员：

```
myClass* ptr = &myClassMember;
ptr->myClassVar = 2; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-05-08T02:46:59.863

您可以使用 -> 来定义一个函数。

```
auto fun() -> int
{
return 100;
} 
```

它不是一个 lambda。这真的是一个功能。“->”表示函数的返回类型。

# javascript - 从旧 ASP 应用程序连接到 Microsoft Dynamics CRM 4.0

> ID：221347
> 
> 赞同：0
> 
> 时间：2008-10-21T10:00:13.820
> 
> 标签：javascript, asp.net, asp-classic, dynamics-crm, dynamics-crm-4

我有一个用 JScript 编写的旧版 ASP 应用程序。目前，它使用自己的数据库表进行用户帐户和身份验证。此应用程序的客户数据正在移入 Microsoft Dynamics CRM 4.0，我需要修改 ASP 站点的身份验证以改为在 Dynamics CRM 中查找用户凭据。

以下是我迄今为止提出的可能方法：

1.  将所有身份验证令牌移动到显式 cookie 中，而不是依赖 Session 变量；然后将登录页面等重写为 .aspx 页面，并使用 WSDL 生成的包装类从这些页面中连接到 Dynamics Web 服务。
2.  在 WSDL 生成的包装器类周围创建一个 COM 包装器，并使用 Server.CreateObject() 从旧版 ASP 页面中调用它
3.  围绕 WSDL 接口编写一个 JSON 包装器，并使用 MSXML2.ServerXMLHTTP COM 对象或类似的东西从旧版 ASP 中调用它
4.  直接从 ASP 调用 WSDL 并使用 MSXML 或其他东西解析结果。

我认为选项 1 可能是现阶段最好的选项，但我希望有人以前尝试过这个并且可以分享他们的经验！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:29:20.250

我们在混合环境中工作（一些经典的 asp，一些 asp.net），并且我们连接到 mscrm 3.0。所以这不完全是你在做什么，而是类似的。

我们将 1 和 2 组合起来。我们编写了一个类库，封装了我们需要使用的 mscrm Web 服务功能。然后，我们将该库公开给 COM，以便我们的遗留内容和我们的 asp .net 应用程序都可以使用它。

然后在不久的将来，当我们迁移到 mscrm 4.0 时，我们唯一需要更新的是我们的类库，因为 asp 和 asp.net 的东西应该保持不变。

# emacs - Emacs Lisp：如何将文件夹及其所有第一级子文件夹添加到加载路径

> ID：221365
> 
> 赞同：15
> 
> 时间：2008-10-21T10:08:22.960
> 
> 标签：emacs, elisp

如果我有这样的文件夹结构：

```
~/Projects
    emacs
        package1
            package1-helpers
        package2
            package2-helpers
            package2-more-helpers
        package3
            package3-helpers 
```

如何添加这些文件夹：

*   ~/项目/emacs
*   ~/项目/emacs/package1
*   ~/项目/emacs/package2
*   ~/项目/emacs/package3

...`load-path`从我的 .emacs 文件？

我基本上需要这段代码的简短自动化版本：

```
(add-to-list 'load-path "~/Projects/emacs")
(add-to-list 'load-path "~/Projects/emacs/package1")
(add-to-list 'load-path "~/Projects/emacs/package2")
(add-to-list 'load-path "~/Projects/emacs/package3") 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-21T10:53:45.647

```
(let ((base "~/Projects/emacs"))
  (add-to-list 'load-path base)
  (dolist (f (directory-files base))
    (let ((name (concat base "/" f)))
      (when (and (file-directory-p name) 
                 (not (equal f ".."))
                 (not (equal f ".")))
        (add-to-list 'load-path name))))) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-31T17:58:32.243

这是我在 .emacs 中使用的内容：

```
(let* ((my-lisp-dir "~/.elisp/")
       (default-directory my-lisp-dir)
       (orig-load-path load-path))
  (setq load-path (cons my-lisp-dir nil))
  (normal-top-level-add-subdirs-to-load-path)
  (nconc load-path orig-load-path)) 
```

如果您查看 normal-top-level-add-subdirs-to-load-path 的描述，选择要排除的目录有点聪明。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T14:37:42.717

我建议你使用[subdirs.el](http://www.panix.com/~tehom/my-code/how-to-use-subdirs-el.txt)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-04T08:56:37.087

这是我的破解版：P

```
(defun add-to-list-with-subdirs (base exclude-list include-list)
  (dolist (f (directory-files base))
 (let ((name (concat base "/" f)))
   (when (and (file-directory-p name)
     (not (member f exclude-list)))
  (add-to-list 'load-path name)
  (when (member f include-list)
   (add-to-list-with-subdirs name exclude-list include-list)))))
  (add-to-list 'load-path base)) 
```

这将从基础添加所有第一级目录并排除排除列表中的目录，而对于包含列表中的目录，它也会添加该目录的所有第一级目录。

```
(add-to-list-with-subdirs "~/.emacs.d" '("." ".." "backup") '("vendor" "my-lisp")) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-25T04:11:52.520

此函数将映射 BASE-PATH 中的第一级子文件夹和文件，如果它是目录（不包括目录“.”和“..”），则将其添加到 LOAD-LIST。

```
(defun add-subdirs-to-load-path (base-path)
  "Adds first level subfolders to LOAD-PATH.
BASE-PATH must not end with a '/'"
  (mapc (lambda (attr)
          (let ((name (car attr))
                (folder-p (cadr attr)))
            (unless (or (not folder-p)
                        (equal name ".")
                        (equal name ".."))
              (add-to-list 'load-path (concat base-path "/" name)))))
        (directory-files-and-attributes base-path))) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-23T23:52:17.603

安装[**`dash`**](https://github.com/magnars/dash.el)和[**`f`**](https://github.com/rejeep/f.el)第三方库。您需要的功能是[`f-directories`](https://github.com/rejeep/f.el#f-directories-path-optional-fn-recursive)：

```
(f-directories "~/YOURDIR") ; return only immediate directories
(f-directories "~/YOURDIR" nil t) ; all directories recursively 
```

然后使用[`--each`](https://github.com/magnars/dash.el#-each-list-fn)将每个找到的目录添加到`load-path`. 整个操作在 O(n²) 中工作，但`load-path`通常超小，谁在乎。

```
(add-to-list 'load-path "~/YOURDIR") ; your parent folder itself
(--each (f-directories "~/YOURDIR") (add-to-list 'load-path it)) 
```

# xml - 使用 LINQ 展平 XML 文件的简单方法

> ID：221370
> 
> 赞同：1
> 
> 时间：2008-10-21T10:12:44.793
> 
> 标签：xml, linq

LINQ 有没有一种简单的方法来展平 XML 文件？

我可以看到 XSLT 的多种方式，但想知道 LINQ 的最佳选择是什么？

我不能像 stackoverflow 似乎过滤 chevron 字符那样将 xml 结构完全建立起来。但它是这样的

节点A

--nodeA1

--nodeA2

节点B

我想结束

节点A

节点A1

节点A2

节点B

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T10:15:40.827

好的; 这取决于您想要的输出 - 使用 XElement，您需要做一些工作来删除所有后代节点等。但是，使用 XmlDocument 实际上非常简单：

```
string xml = @"<xml><nodeA><nodeA1/><nodeA2/></nodeA><NodeB/></xml>";

XmlDocument doc = new XmlDocument();
doc.LoadXml(xml);

XmlDocument clone = new XmlDocument();
XmlElement root = (XmlElement) clone.AppendChild(clone.CreateElement("xml"));
foreach(XmlElement el in doc.SelectNodes("//*")) {
    root.AppendChild(clone.ImportNode(el, false));
}
Console.WriteLine(clone.OuterXml); 
```

输出：

```
<xml><xml /><nodeA /><nodeA1 /><nodeA2 /><NodeB /></xml> 
```

* * *

[是] 愿意在这种情况下定义“扁平化”吗？即“之前”和“之后”？XDocument 有 Descendants() 和 DescendantNodes() 可以完成这项工作......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-25T04:41:12.300

使用扩展方法这很容易做到：

```
public static class XElementExtensions
{
    public static string Path(this XElement xElement)
    {
        return PathInternal(xElement);
    }

    private static string PathInternal(XElement xElement)
    {
        if (xElement.Parent != null)
            return string.Concat(PathInternal(xElement.Parent), ".", xElement.Name.LocalName);

        return xElement.Name.LocalName;
    }
} 
```

然后 ：

```
private static void Main()
{
    string sb =@"<xml>
                <nodeA>
                    <nodeA1>
                        <inner1/><inner2/>
                    </nodeA1>
                    <nodeA2/>
                </nodeA>
                <NodeB/>
                </xml>";

    XDocument xDoc = XDocument.Parse(sb);

    var result = xDoc.Root.Descendants()
        .Select(r => new {Path = r.Path()});

    foreach (var p in result)
        Console.WriteLine(p.Path);
} 
```

结果是 ：

```
xml.nodeA
xml.nodeA.nodeA1
xml.nodeA.nodeA1.inner1
xml.nodeA.nodeA1.inner2
xml.nodeA.nodeA2
xml.NodeB 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T17:30:10.260

Marc 所说的最后一部分是我认为您正在寻找的内容。这是一个示例，您可以放入[LINQPad](http://www.linqpad.net/)并查看“扁平化”的结果。

```
string xml = @"<xml><nodeA><nodeA1><inner1/><inner2/></nodeA1><nodeA2/></nodeA><NodeB/></xml>";

XDocument doc = XDocument.Parse(xml);

doc.Dump();
doc.Root.Descendants().Dump();
doc.Descendants().Dump();
doc.Root.Descendants().Count().Dump();
doc.Descendants().Count().Dump(); 
```

# java - 是否可以通过仅替换单个类文件来更新 Java Web 应用程序？

> ID：221373
> 
> 赞同：6
> 
> 时间：2008-10-21T10:14:37.723
> 
> 标签：java, web-applications

有时，当我们对我们的 Web 应用程序进行小的更改时，例如错误修复，我们不会每次都构建一个全新的 WAR 文件，而只是仅替换爆炸的 Web 应用程序目录下受影响的类文件`WEB-INF/classes`并重新启动应用程序。

可以吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T10:23:06.270

我想说这可能不是最佳实践，因为版本控制：你怎么知道你部署了哪个版本的应用程序？如果您部署一个 .war 文件，您的构建过程可以负责更新构建号（来自源代码控制，或单独，无论 - 只要每个构建有不同的数字就可以了）。

如果您正在使用持续集成（这绝对是一个好主意），那么每次您对源代码进行更改时，您的构建过程都应该踢出一个“工件”（war 文件）。也可能使用内部版本号标记版本控制中的代码。

因此，当您部署 Web 应用程序时，您确切知道正在运行的版本以及构成该版本的源代码。

我会说，通过更新单个 .class 文件来进行小的增量更改对于本地开发人员测试以外的任何事情可能都不是一个好主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T13:08:31.287

您可以使用 maven 解决部署任务。

每次更改任何内容时，只需键入

```
svn update
mvn clean compile war:exploded tomcat:inplace -P deployment 
```

您的 pom.xml 文件中有“部署”配置文件，其中包含部署环境所需的所有配置。

通过这种方式，您可以自动执行部署过程，并且在手动复制错误/旧/etc 文件时永远不会失败。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-06-24T20:12:41.430

@Phill Sacre 和其他人涵盖了这个问题的大部分方面。我面临着不同的方面，并想做出贡献。

简短回答：不，仅替换修改后的 java 文件的类文件可能还不够。请继续阅读以了解详细信息。

这是我的场景。

*   我有一个 .java 主要包含 SQL 查询。我修改了一个查询，放入了新的 .class 文件，并退回了 Tomcat（未连接到我的 IDE）。上一个查询仍在执行中。
*   当我替换所有 .class 文件时，正在执行新查询。

要诊断，

*   我采用了两个 Maven 构建并执行了目录比较。
*   令我惊讶的是，我发现修改**了 2 个 .class 文件，而不是 1**个。
    *   这个额外的 .class 文件实际上是使用我修改的 .class 文件。
*   当我查看额外 .class 文件的反编译版本时，我发现 SQL 查询（一个字符串）作为**inline**存在。

这清楚地解释了为什么更换一个类并不能解决问题。在这种情况下，替换第一个 .class 文件永远不会有效。

得到教训。以下是我总结我从中学到的东西：

*   在开发过程中，IDE（我使用 Eclipse）负责热部署。
*   在生产系统上，假设仅替换一个 .class 文件就足够了是不明智的。应该考虑完整的部署。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T13:04:05.913

同意菲尔；似乎节省的时间可以忽略不计，潜在的风险很多

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T13:09:12.893

从技术上讲，只要类/方法签名相同，它就可以工作。但正如 Phill 指出的那样，这不是世界上最好的主意。

我假设您既没有使用[Apache Ant](http://ant.apache.org)也没有使用[Apache Maven](http://maven.apache.org)来创建您的 .war 文件。我强烈建议您选择一个可以自动创建 .war 文件的工具，正是为了避免像您所说的那种手动黑客攻击。我个人使用 Maven，它负责编译、运行单元测试和打包我的应用程序。好东西 ：）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T14:26:56.573

将更新的类文件注入应用程序只能在有限的基础上进行，并且不应该是构建的标准活动。话虽如此，我已经看到它在大型应用程序上完成，整个重建/重新打包需要几个小时，并且需要尽快修复错误。希望能帮助到你。

# python - 将版权符号放入 Python 文件中

> ID：221376
> 
> 赞同：16
> 
> 时间：2008-10-21T10:15:16.893
> 
> 标签：python, encoding

我需要在我生成的每个 Python 源文件的顶部包含版权声明：

```
#   Copyright: © 2008 etc. 
```

但是，当我运行这样的文件时，我会收到以下消息：

SyntaxError：第 3 行文件 MyFile.py 中的非 ASCII 字符“\xa9”，但未声明编码；有关详细信息，请参阅[http://www.python.org/peps/pep-0263.html](http://www.python.org/peps/pep-0263.html)。

显然 Python 对版权符号不满意，因为它假定源文件都是 ASCII 格式。要么我需要让我的第一行是：

```
# -*- coding: iso-8859-1 -*- 
```

告诉 Python 我正在使用拉丁编码，或者我可以将版权声明更改为：

```
#   Copyright: \xa9 2008 etc. 
```

这可能没有相同的法律地位。

有没有更优雅的解决方案？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-21T10:17:32.523

ASCII 中的版权符号是拼写`(c)` 或“ `Copyright`”。

参见第 61 号通知，[计算机程序的版权登记](http://www.copyright.gov/circs/circ61.pdf)。

虽然法律形式主义（参见第 1 号通告，[版权基础](http://www.copyright.gov/circs/circ01.pdf)）确实是

> 符号©（圆圈中的字母C），或单词“Copyright”或缩写“Copr.”；和...

这也是真的

> 为保证在所有 UCC 成员国中保护受版权保护的作品，通知必须包含符号 ©（不接受“版权”一词或缩写词）

[您可以通过循环3](http://www.copyright.gov/circs/circ03.html)和[38a](http://www.copyright.gov/circs/circ38a.html)进行挖掘。

然而，这已经在法庭上进行了测试。这不是一个有趣的问题。如果您搜索“(c) 可接受的 c-in-a-circle”，您会发现所有律师都同意 (c) 是可接受的替代品。见珀尔和威廉姆斯。参见 Scott 关于信息技术法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T11:50:53.707

与公认的答案相反，AFAIK，（c）不是版权符号的官方认可替代品，尽管我不确定它是否在法庭上经过测试。

但是，© 只是版权一词的缩写。说“版权所有 2008 Robert Munro”等同于说“© 2008 Robert Munro”

您的“版权：© 2008 等” 扩展为“版权：版权 2008 等”

维基百科的页面似乎同意我的[观点 http://en.wikipedia.org/wiki/Copyright_symbol](http://en.wikipedia.org/wiki/Copyright_symbol)

在美国，版权声明由三个元素组成： 1\. © 符号，**或**单词“Copyright”或缩写“Copr.”；...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-10-06T15:32:56.927

先放这一行：

```
# -*- coding: utf-8 -*- 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T10:17:51.977

你总是可以恢复到旧的（c）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T11:40:55.583

等待[Python 3k](http://docs.python.org/dev/3.0/whatsnew/3.0.html)，其中源的默认编码是 UTF-8？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-05T20:48:45.580

对于 Python 2，“正确”的做法是指定编码，或者永远不要使用非 ASCII 字符。指定编码使编译器和人类更简单。抱歉，Python 最初指定 ASCII 作为默认值，早在黑暗时代。

对于 Python 3，UTF-8 是默认编码，所以你应该没问题。在这种情况下，如果您使用默认值，我建议不要指定编码。

无论一种语言是否允许/需要编码规范，在 Unicode 时代，这是我们需要为每个“文本”文件牢记的问题。

# .net - 使用 DotNet 从 XML 字符串中删除已知位置的元素的最佳方法？

> ID：221378
> 
> 赞同：3
> 
> 时间：2008-10-21T10:16:25.567
> 
> 标签：.net, xml

我很欣赏现在 dotnet 中有许多机制可以以多种方式处理 XML...

假设我有一个包含 XML 的字符串......

```
<?xml version="1.0" encoding="utf-8" ?>
<root>
    <Element1>
        <Element1_1>
            SomeData
        </Element1_1>
    </Element1>
    <Element2>
        Some More Data
    </Element2>
</root> 
```

**删除 Element1_1 的最简单（最易读）的方法是什么？**

更新...我可以使用 .Net 3.5 中可用的任何 .Net API：D

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T10:20:35.980

您可以使用哪些 API？例如，您可以使用 .NET 3.5 和 LINQ to XML 吗？如果是这样，[XNode.Remove](http://msdn.microsoft.com/en-us/library/system.xml.linq.xnode.remove.aspx)就是您的朋友 - 只需选择 Element1_1（以使用 LINQ to XML 很容易的多种方式中的任何一种）并在其上调用 Remove()。

如何选择元素的示例：

```
XElement element = doc.XPathSelectElement("/root/Element1/Element1_1");
element.Remove(); 
```

或者：

```
XElement element = doc.Descendants("Element1_1").Single().Remove(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T10:30:58.703

我会使用这个：

```
XmlDocument x = new XmlDocument();
x.LoadXml(SomeXmlString);

foreach (XmlNode xn in x.SelectNodes("//Element1_1"))
  xn.ParentNode.RemoveChild(xn); 
```

或与显式 XPath 相同：

```
foreach (XmlNode xn in x.SelectNodes("/root/Element1/Element1_1"))
  xn.ParentNode.RemoveChild(xn); 
```

或者，更具体的：

```
XmlNode xn = x.SelectSingleNode("/root/Element1/Element1_1");
xn.ParentNode.RemoveChild(xn); 
```

# java - 休眠：hbm2ddl.auto=生产中的更新？

> ID：221379
> 
> 赞同：366
> 
> 时间：2008-10-21T10:17:03.567
> 
> 标签：java, hibernate, hbm2ddl

在生产环境中运行配置`hbm2ddl.auto=update`为更新数据库模式的 Hibernate 应用程序是否可以？

* * *

## 回答 #1

> 赞同：415
> 
> 时间：2008-10-21T10:41:47.340

不，这是不安全的。

尽管 Hibernate 团队尽了最大的努力，但您根本不能依赖**生产**中的自动更新。编写您自己的补丁，与 DBA 一起审查，测试它们，然后手动应用它们。

理论上，如果**hbm2ddl 更新**在开发中有效，它也应该在生产中有效。但实际上，情况并非总是如此。

即使它工作正常，它也可能不是最理想的。DBA 的薪水这么高是有原因的。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-10-21T11:52:38.697

我们在生产环境中执行此操作，尽管使用的应用程序不是关键任务且员工中没有高薪 DBA。这只是少了一个受人为错误影响的手动过程——应用程序可以检测到差异并做正确的事情，而且您可能已经在各种开发和测试环境中对其进行了测试。

一个警告 - 在集群环境中，您可能希望避免它，因为多个应用程序可能同时出现并尝试修改可能不好的架构。或者放入某种机制，只允许一个实例更新架构。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2010-10-01T09:07:21.813

[Hibernate 创建者在他们的“Java Persistence with Hibernate”](https://www.manning.com/books/java-persistence-with-hibernate)一书中不鼓励在生产环境中这样做：

> 警告：我们已经看到 Hibernate 用户尝试使用 SchemaUpdate 自动更新生产数据库的模式。这可能很快以灾难告终，并且您的 DBA 不允许这样做。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2011-08-13T19:49:30.167

查看 LiquiBase XML 以保存更新的变更日志。直到今年我才使用它，但我发现它非常容易学习，并且使数据库修订控制/迁移/变更管理非常简单。我从事一个 Groovy/Grails 项目，Grails 在其所有 ORM（称为“GORM”）下使用 Hibernate。我们使用 Liquibase 来管理所有 SQL 模式更改，随着我们的应用程序随着新功能的发展，我们经常这样做。

基本上，您保留一个变更集的 XML 文件，随着应用程序的发展，您将继续添加这些变更集。该文件与项目的其余部分一起保存在 git（或您正在使用的任何东西）中。部署您的应用程序后，Liquibase 会检查您要连接的数据库中的更改日志表，以便知道已应用的内容，然后智能地应用文件中尚未应用的任何更改集。它在实践中非常有效，如果您将它用于所有架构更改，那么您可以 100% 确信您签出和部署的代码将始终能够连接到完全兼容的数据库架构。

令人敬畏的是，我可以在笔记本电脑上获取一个完全空白的 mysql 数据库，启动应用程序，然后立即为我设置架构。它还可以通过首先将它们应用于本地开发或暂存数据库来轻松测试模式更改。

开始使用它的最简单方法可能是获取您现有的数据库，然后使用 Liquibase 生成初始的 baseline.xml 文件。然后在将来你可以附加到它并让 liquibase 接管管理模式更改。

[http://www.liquibase.org/](http://www.liquibase.org/)

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2012-09-27T00:53:24.857

当不知道自己在做什么的人在不应该使用它的情况下使用它时，Hibernate 必须在 prod 中放置关于不使用自动更新的免责声明来掩盖自己。

授予不应该使用它的情况大大超过了可以使用的情况。

我已经在许多不同的项目中使用它多年，并且从未遇到过一个问题。这不是一个蹩脚的答案，也不是牛仔编码。这是历史事实。

一个说“永远不要在生产中这样做”的人正在考虑一组特定的生产部署，即他熟悉的那些（他的公司、他的行业等）。

“生产部署”的范围是广泛而多样的。

经验丰富的 Hibernate 开发人员确切地知道给定映射配置会产生什么 DDL。只要您测试并验证您期望的内容最终会出现在 DDL 中（在 dev、qa、staging 等中），就可以了。

当您添加大量功能时，自动模式更新可以节省大量时间。

自动更新无法处理的列表是无穷无尽的，但一些示例是数据迁移、添加不可为空的列、列名更改等。

此外，您还需要注意集群环境。

但是话又说回来，如果你知道所有这些东西，你就不会问这个问题了。唔 。. . 好的，如果你问这个问题，你应该等到你有很多 Hibernate 和自动模式更新的经验，然后再考虑在 prod 中使用它。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2017-06-05T05:33:56.850

`hbm2ddl.auto`在生产中使用不是一个好主意。

管理数据库模式的唯一方法是使用增量迁移脚本，因为：

*   这些脚本将与您的代码库一起驻留在 VCS 中。当您签出一个分支时，您从头开始重新创建整个架构。
*   增量脚本可以在应用于生产之前在 QA 服务器上进行测试
*   [由于脚本可以由Flyway](https://flywaydb.org/)运行，因此无需手动干预，因此它减少了与手动运行脚本相关的人为错误的可能性。

甚至[Hibernate 用户指南](http://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#schema-generation)也建议您避免在`hbm2ddl`生产环境中使用该工具。

[![Hibernate ORM 用户指南说得最好](https://i.stack.imgur.com/93cOo.png)](https://i.stack.imgur.com/93cOo.png)

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2008-12-03T02:45:16.443

我会投反对票。Hibernate 似乎不理解列的数据类型何时发生变化。示例（使用 MySQL）：

```
String with @Column(length=50)  ==> varchar(50)
changed to
String with @Column(length=100) ==> still varchar(50), not changed to varchar(100)

@Temporal(TemporalType.TIMESTAMP,TIME,DATE) will not update the DB columns if changed 
```

可能还有其他示例，例如将 String 列的长度推高超过 255 并看到它转换为文本、中文本等。

当然，我不认为真的有一种方法可以在不创建新列、复制数据和清除旧列的情况下“转换数据类型”。但是，当您的数据库中的列不反映当前的 Hibernate 映射时，您的生活就非常危险......

Flyway 是解决这个问题的一个不错的选择：

[http://flywaydb.org](http://flywaydb.org)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-21T10:44:24.993

我不会冒险，因为您最终可能会丢失本应保留的数据。hbm2ddl.auto=update 纯粹是一种让您的开发数据库保持最新的简单方法。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-03-10T11:50:19.500

我们在一个生产运行了几个月的项目中做到了这一点，到目前为止从未出现过问题。请记住此食谱所需的两种成分：

1.  使用向后兼容的方法设计您的对象模型，即**弃用**对象和属性，而不是删除/更改它们。这意味着如果您需要更改对象或属性的名称，请保留旧名称，添加新名称并编写某种迁移脚本。如果您需要更改对象之间的关联，如果您已经在生产中，这意味着您的设计首先是错误的，因此请尝试想一种新的方式来表达新的关系，而不会影响旧数据。

2.  始终在部署之前 **备份数据库。**

我的感觉是——在阅读了这篇文章之后——参与讨论的 90% 的人一想到在生产环境中使用这样的自动化就会感到震惊。有些人*把球扔给*DBA。请花点时间考虑一下，并非所有生产环境都会提供 DBA，而且没有多少开发团队能够负担得起（至少对于中等规模的项目）。所以，如果我们谈论的是每个人都必须做所有事情的球队，那么球就在他们身上。

在这种情况下，为什么不尝试两全其美呢？像这样的工具可以提供帮助，经过精心设计和计划，可以在许多情况下提供帮助。相信我，管理员最初可能很难说服，但如果他们知道球不在他们手中，他们会喜欢的。

就个人而言，我永远不会回去手动编写脚本来扩展任何类型的模式，但这只是我的看法。而在最近开始采用 NoSQL 无模式数据库之后，我可以看到，所有这些基于模式的操作都将属于过去，所以你最好开始改变你的观点，向前看。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-08-12T05:38:25.267

*   在我的情况下（Hibernate 3.5.2、Postgresql、Ubuntu），设置`hibernate.hbm2ddl.auto=update`只创建了新表并在现有表中创建了新列。

*   它既没有删除表，也没有删除列，也没有更改列。它可以被称为一个安全的选择，但类似的东西`hibernate.hbm2ddl.auto=create_tables add_columns`会更清楚。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-03-30T19:13:05.013

这不安全，不推荐，但有可能。

我有在生产中使用自动更新选项的应用程序经验。

那么，这个解决方案中发现的主要问题和风险是：

*   **部署在错误的数据库**中。如果您错误地在错误的数据库中使用旧版本的应用程序（EAR/WAR/etc）运行应用程序服务器......您将有很多新的列、表、外键和错误。数据源文件中的一个简单错误（复制/粘贴文件并忘记更改数据库）也会出现同样的问题。在简历中，情况可能是您的数据库中的灾难。
*   **应用程序服务器启动时间过长**。发生这种情况是因为 Hibernate 每次启动应用程序时都会尝试查找所有创建的表/列/等。他需要知道需要创建什么（表、列等）。随着数据库表的增长，这个问题只会变得更糟。
*   **数据库工具几乎不可能使用**。要创建数据库 DDL 或 DML 脚本以使用新版本运行，您需要考虑启动应用程序服务器后自动更新将创建什么。例如，如果您需要用一些数据填充新列，则需要启动应用程序服务器，等待 Hibernate 创建新列，然后才运行 SQL 脚本。如您所见，数据库迁移工具（如 Flyway、Liquibase 等）几乎不可能在启用自动更新的情况下使用。
*   **数据库更改不是集中式**的。由于 Hibernate 创建表和其他一切的可能性，很难在应用程序的每个版本中观察数据库的变化，因为它们大部分是自动进行的。
*   **鼓励数据库上的垃圾**。由于自动更新的“简单”使用，您的团队可能会忽略删除旧列和旧表，因为休眠自动更新无法做到这一点。
*   **灾难迫在眉睫**。生产中发生某些灾难的迫在眉睫的风险（就像其他答案中提到的一些人一样）。即使应用程序运行和更新多年，我也不认为这是一个安全的选择。使用此选项时，我从未感到安全。

因此，我不建议在生产中使用自动更新。

如果您真的想在生产中使用自动更新，我建议：

*   **分离的网络**。您的测试环境无法访问同源环境。这有助于防止应该在测试环境中的部署更改认证数据库。
*   **管理脚本顺序**。您需要在部署之前组织脚本以运行（结构表更改、删除表/列）和部署之后的脚本（为新列/表填充信息）。

而且，与其他帖子不同，我不认为启用自动更新与“非常高薪”的 DBA 相关（如其他帖子中所述）。DBA 有比编写 SQL 语句来创建/更改/删除表和列更重要的事情要做。这些简单的日常任务可以由开发人员完成和自动化，并且只传递给 DBA 团队审查，而不需要 Hibernate 和 DBA “非常高的薪水”来编写它们。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2011-02-15T21:49:17.193

不，永远不要这样做。Hibernate 不处理数据迁移。是的，它会使您的架构看起来正确，但不能确保有价值的生产数据不会在此过程中丢失。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-07-17T05:34:03.860

*   通常，大型组织中的企业应用程序以降低的权限运行。

*   数据库用户名可能没有`DDL`权限添加`hbm2ddl.auto=update`需要的列。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-21T17:40:09.430

我同意弗拉基米尔的观点。如果我提出这样的课程，我公司的管理员肯定不会感激的。

此外，创建一个 SQL 脚本而不是盲目信任 Hibernate 可以让您有机会删除不再使用的字段。Hibernate 不这样做。

而且我发现将生产模式与新模式进行比较可以让您更好地了解您在数据模型中所做的更改。你知道，当然，因为你做到了，但现在你一口气看到了所有的变化。甚至那些让你喜欢“这到底是什么？！”的人。

有一些工具可以为您制作模式增量，所以这甚至不是艰苦的工作。然后你就知道会发生什么。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-04-26T19:47:13.583

应用程序的模式可能会随着时间而演变；如果您有多个安装，可能处于不同的版本，您应该有一些方法来确保您的应用程序、某种工具或脚本能够将模式和数据从一个版本逐步迁移到任何后续版本。

将所有持久性保留在 Hibernate 映射（或注释）中是控制模式演变的一种非常好的方法。

您应该考虑到模式演变有几个方面需要考虑：

1.  数据库模式在添加更多列和表方面的演变

2.  删除旧列、表和关系

3.  用默认值填充新列

Hibernate 工具特别重要，尤其是在（就像我的经验一样）您在许多不同类型的数据库上拥有同一应用程序的不同版本的情况下。

第 3 点在您使用 Hibernate 的情况下非常敏感，因为如果您引入新的布尔值属性或数字属性，如果 Hibernate 会在此类列中找到任何空值，则会引发异常。

所以我要做的是：确实使用 Hibernate 工具的模式更新功能，但您必须在其旁边添加一些数据和模式维护回调，例如填充默认值、删除不再使用的列等。通过这种方式，您可以获得优势（数据库独立的模式更新脚本和避免重复编码更新、持久性和脚本），但您还涵盖了操作的所有方面。

因此，例如，如果版本更新只是添加一个 varchar 值属性（因此是列），它可能默认为 null，那么您将完成自动更新。在需要更复杂的地方，就需要更多的工作。

这是假设应用程序在更新时能够更新其模式（可以这样做），这也意味着它必须具有对模式执行此操作的用户权限。如果客户的政策阻止了这种情况（可能是蜥蜴脑案例），您将必须提供特定于数据库的脚本。

# jquery - Ruby on Rails 和 jeditable (jquery)

> ID：221385
> 
> 赞同：13
> 
> 时间：2008-10-21T10:21:29.300
> 
> 标签：jquery, ruby-on-rails, ruby, jeditable

有没有人让 jquery 插件[jeditable](http://www.appelsiini.net/projects/jeditable)在 Rails 应用程序中正常运行。如果是这样，您能否分享一些有关如何设置的提示？我在创建“submit-url”时遇到了一些麻烦。

* * *

IIRC，您不能简单地从 javascript 中调用 ruby​​ 代码（请让我错了:-)。你是说RJ吗？？？这不限于原型吗？我正在使用 jQuery。

* * *

**更新：**
呃.....不久前问过这个问题，同时切换到不同的解决方案。但 IIRC 我的主要问题如下：

我正在使用 RESTful 资源。因此，假设我必须为博客建模，从而拥有资源“帖子”。如果我想编辑一个帖子（例如 ID 为 8 的帖子），我的更新通过 HTTP 发送到带有 HTTP 动词 POST的 URL [http://my.url.com/posts/8 。](http://my.url.com/posts/8)然而，这个 URL 是在我的 Rails 代码中构建的。那么如何将我的提交 URL 放入我的 jQuery 代码中呢？因为这是 RESTful 代码，所以我的更新 URL 会随着每篇文章而改变。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-15T18:52:09.453

以下是我如何将 JEditable (1.6.2) 与我宁静的 Rails 应用程序 (2.2.2) 连接起来：

**内联表格：**

```
<div id="email_name"><%= h( @email.name ) %></div>

$('#email_name').editable( <%= email_path(@email).to_json %>, {
  name: 'email[name]',
  method: 'PUT',
  submitdata: {
    authenticity_token: <%= form_authenticity_token.to_json %>,
    wants: 'name'
  }
}); 
```

**控制器：**

```
def update
  @email = Email.find( params[:id] )
  @email.update_attributes!( params[:email )
  respond_to do |format|
    format.js
  end
end 
```

**更新.js.erb**

```
<%=
    case params[:wants]
    when 'name' then h( @email.name )
    # add other attributes if you have more inline forms for this model
    else ''
    end
%> 
```

这个 switch 语句有点笨拙。如果 ajax 请求成功并且没有返回任何内容，如果 JEditable 默认只保存提交的值，那就太好了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-03T20:07:19.960

请原谅我现在才提出这个问题，但我刚刚找到时间再次查看我的代码。我想我通过以下javascript（我在rails中的application.js）解决了我的问题：

```
jQuery(document).ready(function($) {

$(".edit_textfield").each( function(i) {
  $(this).editable("update", {
         type      : 'textarea',
         rows      : 8,
         name : $(this).attr('name'),
         cancel    : 'Cancel',
         submit    : 'OK',
         indicator : "<img src='../images/spinner.gif' />",
         tooltip   : 'Double-click to edit...'
     })
 });
}); 
```

如果您的控制器 URL 是 RESTful，则此方法有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-03T20:21:51.630

如果您在 html 中包含 .js 文件，则不能，但如果您的视图模板中有 js 内联，则可以。

您还可以拥有 .erb.js 文件，即 js 视图。

一切皆有可能:D

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-03T16:32:37.973

我不确定我是否完全理解您遇到的问题，但我认为您可以在您的 javascript 中添加这样的内容：

```
<%= url_for(@post) %> 
```

这取决于你如何构建你的 javascript，你如何组织你的文件等等......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-19T04:28:14.843

如果您是控制器，则不那么安宁。特别是如果您有更新特定字段的操作，那么这也可以。密钥正在传递身份验证令牌。

*index.html.erb*

```
<span id="my_edit"><%= foo.bar %></span>

<script type="text/javascript">
  $(document).ready(function() {
    $("#my_edit").editable('<%= url_for(:action => "update_bar", 
                  :id => foo) %>',
                    {
                       method: 'PUT',
                       cancel    : 'Cancel',
                       submit    : 'OK',
                       indicator : "<img src='../images/spinner.gif' />",
                       tooltip   : 'Double-click to edit...',
                       submitdata: {
                         authenticity_token: <%= form_authenticity_token.to_json %>,
                       }
                     }
    });
</script> 
```

过于简单的控制器并不能证明不平静：

*foo_controller.rb*

```
def update_bar
    foo = Foo.find(params[:id])
    bar= params[:value]
            // insert justifiable code here
    foo.save
    render :text=>params[:value]
end 
```

（与带有 Jeditable 1.7.0 和 jRails 0.4 的 Rails 2.2.2 和 2.3.2 一起使用，尽管 jRails 除了为 jQuery 1.5 提供包含之外并没有在这里进行太多交互）

# python - 使用python从大型二进制文件中删除一系列字符

> ID：221386
> 
> 赞同：3
> 
> 时间：2008-10-21T10:21:46.537
> 
> 标签：python, numpy, binaryfiles

我想从 python 中的二进制文件中修剪相同值的长序列。一种简单的方法是简单地读取文件并使用 re.sub 替换不需要的序列。这当然不适用于大型二进制文件。可以用 numpy 之类的方法完成吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T13:18:37.040

如果你没有内存要做`open("big.file").read()`，那么 numpy 不会真正有帮助。它使用与 python 变量相同的内存（如果你有 1GB 的 RAM，你只能将 1GB 的数据加载到 numpy 中）

解决方案很简单 - 分块读取文件.. `f = open("big.file", "rb")`，然后执行一系列`f.read(500)`，删除序列并将其写回另一个文件对象。几乎如何在 C 中进行文件读/写。

那么问题是如果您错过了要替换的模式。例如：

```
target_seq = "567"
input_file = "1234567890"

target_seq.read(5) # reads 12345, doesn't contain 567
target_seq.read(5) # reads 67890, doesn't contain 567 
```

显而易见的解决方案是从文件中的第一个字符开始，检查`len(target_seq)`字符，然后前进一个字符，再次检查。

例如（伪代码！）：

```
while cur_data != "":
    seek_start = 0
    chunk_size = len(target_seq)

    input_file.seek(offset = seek_start, whence = 1) #whence=1 means seek from start of file (0 + offset)
    cur_data = input_file.read(chunk_size) # reads 123
    if target_seq == cur_data:
        # Found it!
        out_file.write("replacement_string")
    else:
        # not it, shove it in the new file
        out_file.write(cur_data)
    seek_start += 1 
```

这并不是最有效的方法，但它会起作用，并且不需要在内存中保留文件的副本（或两个）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T10:33:57.903

如果两个副本适合内存，那么您可以轻松制作副本。第二份是压缩版。当然，你可以使用 numpy，但你也可以使用[array](http://www.python.org/doc/2.5.2/lib/module-array.html)包。此外，您可以将大型二进制对象视为一串字节并直接对其进行操作。

听起来您的文件可能*真的*很大，并且您无法将两个副本放入内存中。（您没有提供很多细节，所以这只是一个猜测。）您必须分块进行压缩。您将读取一个块，对该块进行一些处理并将其写出。同样，numpy、数组或简单的字节串都可以正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T17:04:42.067

dbr 的解决方案是一个好主意，但有点过于复杂，您真正需要做的就是在读取下一个块之前将文件指针倒回您正在搜索的序列的长度。

```
def ReplaceSequence(inFilename, outFilename, oldSeq, newSeq):
 inputFile  = open(inFilename, "rb")
 outputFile = open(outFilename, "wb")

 data = ""
 chunk = 1024

 while 1:
      data = inputFile.read(chunk)
      data = data.replace(oldSeq, newSeq)
      outputFile.write(data)

      inputFile.seek(-len(oldSequence), 1)
      outputFile.seek(-len(oldSequence), 1)

     if len(data) < chunk:
           break

 inputFile.close()
 outputFile.close() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-28T18:30:10.197

AJMayorga 的建议很好，除非替换字符串的大小不同。或者替换字符串在块的末尾。

我这样修复它：

```
def ReplaceSequence(inFilename, outFilename, oldSeq, newSeq):
    inputFile  = open(inFilename, "rb")
    outputFile = open(outFilename, "wb")

data = ""
chunk = 1024

oldSeqLen = len(oldSeq)

while 1:
    data = inputFile.read(chunk)

    dataSize = len(data)
    seekLen= dataSize - data.rfind(oldSeq) - oldSeqLen
    if seekLen > oldSeqLen:
        seekLen = oldSeqLen

    data = data.replace(oldSeq, newSeq)
    outputFile.write(data)
    inputFile.seek(-seekLen, 1) 
    outputFile.seek(-seekLen, 1)

    if dataSize < chunk:
        break

inputFile.close()
outputFile.close() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T12:48:00.097

你需要让你的问题更精确。您是否知道要提前修剪的值？

`subprocess`假设你这样做，我可能会使用运行“ ”搜索匹配的部分`fgrep -o -b <search string>`，然后使用 python`file`对象的`seek`,`read`和`write`方法更改文件的相关部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-17T17:23:38.517

这个基于生成器的版本将在内存中一次只保留文件内容的一个字符。

请注意，我是从字面上理解您的问题标题-您希望将同一*字符*的运行减少为单个字符。对于一般替换模式，这不起作用：

```
import StringIO

def gen_chars(stream):
   while True:
      ch = stream.read(1)
      if ch: 
         yield ch
      else:
         break

def gen_unique_chars(stream):
   lastchar = ''
   for char in gen_chars(stream):
      if char != lastchar:
         yield char
      lastchar=char

def remove_seq(infile, outfile):
   for ch in gen_unique_chars(infile):
      outfile.write(ch)

# Represents a file open for reading
infile  = StringIO.StringIO("1122233333444555")

# Represents a file open for writing
outfile = StringIO.StringIO()

# Will print "12345"
remove_seq(infile, outfile)
outfile.seek(0)
print outfile.read() 
```

# wifi - 如何在 Nintendo DS 上使用 PAlib 以编程方式搜索 Wi-Fi 接入点

> ID：221387
> 
> 赞同：1
> 
> 时间：2008-10-21T10:21:47.817
> 
> 标签：wifi, nintendo-ds, palib

我需要一种方法来检查我的 DS 自制软件上的 Wi-Fi 路由器/接入点。我正在使用 PAlib。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T15:23:52.493

i used the code from ds_wifi_test (which comes with the original dswifi library) when i tried to implement this. Basically, access points are scanned internally when you invoke `Wifi_ScanMode()`. You can then have the number of AP identified with `Wifi_GetNumAP()` and retrieve the information for the ith access point with `Wifi_GetAPData(i,&data);`

```
nbitems=Wifi_GetNumAP();
Wifi_AccessPoint ap;

for (int i=0;i<nbitems; i++) {
   if(Wifi_GetAPData(i+scrolltop,&ap)==WIFI_RETURN_OK)
      do_whatever_with(&ap);
} 
```

I'm not aware of any "helper" functions through the PALib in this regards. All the PALib seems to have is a few "wrappers" to ease common tasks once a WFC setting has been defined ([see day#20 tutorial](http://www.palib.info/wiki/doku.php?id=day20))

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-18T18:50:08.523

如果我是你，我会避开 PALib。它构建在过时的 libnds 版本之上，并且为了向后兼容而没有使用新版本进行更新。相反，花时间学习 libnds，并从一个维护良好且没有自身依赖关系的库中获益。sylvainulg 上面写的相同代码仍然可以工作，因为它依赖于 dswifi，而不是 libnds 或 PALib。

# php - Javascript 和 PHP 函数

> ID：221396
> 
> 赞同：5
> 
> 时间：2008-10-21T10:28:03.483
> 
> 标签：php, javascript, function

是否可以使用`onsubmit`JavaScript 从 PHP 调用函数？如果是这样，有人可以给我一个如何完成的例子吗？

```
function addOrder(){
    $con = mysql_connect("localhost", "146687", "password");
    if(!$con){
        die('Could not connect: ' . mysql_error())
    }

    $sql = "INSERT INTO orders ((user, 1st row, 2nd row, 3rd row, 4th row)
    VALUES ($session->username,1st variable, 2nd variable, 3rd variable, 4th variable))";

    mysql_query($sql,$con)
    if(mysql_query($sql,$con)){
        echo "Your order has been added";
    }else{
        echo "There was an error adding your order to the databse: " . mysql_error();
    }
} 
```

这就是我要调用的函数。它是一个订购系统，您输入您想要的每件商品的数量，点击提交，它*应该*将订单添加到表格中。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-21T12:25:50.283

## 您不能从 Javascript 调用 PHP 函数...

Javascript 是一种客户端语言（它在 Web 浏览器上执行，在接收到网页之后），而 PHP 在服务器端（它在网页呈现之前执行）。您无法拨打另一个电话。

## ...但您可以获得外部 PHP 脚本的结果

有一个名为 xhttprequest 的 Javascript 函数，它允许您调用 Web 服务器上的任何脚本并得到它的答案。因此，要解决您的问题，您可以创建一个输出一些文本（或 XML 或 JSON）的 PHP 脚本，然后调用它，然后使用 Javascript 分析答案。

这个过程就是我们所说的[AJAX](http://fr.wikipedia.org/wiki/Ajax)，用好的工具比自己做要容易得多。看看[JQuery](http://www.jquery.info/)，它功能强大且易于使用 Javascript 库，内置 AJAX 助手。

JQuery（客户端）的示例：

```
$.ajax({
   type: "POST", // the request type. You most likely going to use POST
   url: "your_php_script.php", // the script path on the server side
   data: "name=John&location=Boston", // here you put you http param you want to be able to retrieve in $_POST 
   success: function(msg) {
     alert( "Data Saved: " + msg ); // what you do once the request is completed
   } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T10:32:26.687

听起来你想要[AJAX](http://en.wikipedia.org/wiki/AJAX)。

对于一个单一的答案来说，这个话题太大了，但这应该能让你继续前进。

基本上，Javascript 会将 HTTP 请求发送到您服务器上的 PHP 脚本，然后对响应执行一些操作。 [JSON](http://json.org)可能也是您想要了解的内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T12:03:15.240

使用 JavaScript可以**间接**调用 PHP 函数。正如其他人已经提到的那样，您将要执行某种类型的请求 - 这不一定是 Ajax。它可以是同步的。在不确切知道您要完成的工作的情况下，这就是我的建议：

*   将事件处理程序附加到表单的提交选项（如果您不打算使用 Ajax，则使用标准提交）
*   将需要在 POST 中或在页面地址的查询字符串中传递给 PHP 函数的所有参数捆绑在一起。
*   触发请求（异步或通过提交）
*   在作为请求目标的 PHP 脚本中，从 $_POST 或 $_GET 中提取参数。
*   使用参数调用您需要的 PHP 函数。
*   请求完成后，回显响应并根据需要对其进行解析。

同样，这有点笼统，但您的问题也是如此。希望这能给出某种方向。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T12:03:30.687

您将获得的最接近的是[xajax](http://xajaxproject.org/)，它可以让您将 PHP 函数包装到 AJAX 调用中。在开始使用 Zend Framework 之前，我已经使用了很多次，发现它很难以 OO 方式实现。

使用 xajax，您可以编写一个 PHP 函数来执行所有常规逻辑，然后返回一个 ObjectResponse 对象，该对象通过 AJAX 操作浏览器（警报框、更改 HTML、CSS 等）。你用 xajax 注册你的函数，然后 xajax 会在你的 HTML 部分吐出一些 javascript。

在您的 HTML 中，您只需调用 xajax 生成的 javascript 函数，然后它会通过 AJAX 处理其余部分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T14:02:13.787

您将需要执行以下操作：

```
<form action="add_order.php" method="POST" id="add_order_form">
<!-- all of your form fields -->
<input type='submit' value='Add Order'>
</form>

<script type="text/javascript">
$("#add_order_form").submit(function() {
    var action = $("#add_order_form").attr("action");
    var data = $("#add_order_form").serialize();
    $.post(action, data, function(json, status) {
        if(status == 'success') {
            alert(json.message);
        } else {
            alert('Something went wrong.');
        }
    }, "json"); 
    return false;
});
</script> 
```

然后有一个 PHP 文件命名为`add_order.php`：

```
$success = 0;
$con = mysql_connect("localhost", "146687", "password");
if(!$con) {
    $message = 'Could not connect to the database.';
} else {
    // SANITIZE DATA BEFORE INSERTING INTO DATABASE
    // LOOK INTO MYSQL_REAL_ESCAPE_STRING AT LEAST,
    // PREFERABLY INTO PREPARED STATEMENTS
    $query_ok = mysql_query("INSERT INTO `orders` ....");
    if($query_ok) {
        $success = 1;
        $message = "Order added.";
    } else {
        $message = "Unable to save information";
    }
}

print json_encode(array('success' => $success, 'message' => $message)); 
```

要使这种美感发挥作用，您必须访问[jQuery](http://jquery.com/)网站，下载它并包含 jquery.js 文件。

我没有测试过上面的，但它应该可以工作。祝你好运。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T11:48:17.987

对不起，你的问题太基础了。取决于*您*想在 formsubmit Ajax 上调用的 PHP 函数对您没有帮助。您是否了解 PHP 和 JavaScript 之间的基本（客户端/服务器端）差异？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-21T10:47:17.360

是的，另一个学习 ajax 的伟大而简单的教程是：

[http://24ways.org/2005/easy-ajax-with-prototype/](http://24ways.org/2005/easy-ajax-with-prototype/)

如果您的项目还没有走得太远并且需要恢复很多功能，那么我推荐的另一件事是原型。

[http://www.prototypejs.org/](http://www.prototypejs.org/)

祝你好运！

# php - 没有重复条目时的mysql重复条目错误（通过php批量加载）

> ID：221399
> 
> 赞同：6
> 
> 时间：2008-10-21T10:28:43.683
> 
> 标签：php, mysql, rename, truncate, mysql-error-1062

我正在使用**mysql (5.0.32-Debian_7etch6-log)**并且我有一个夜间运行的批量加载**php (5.2.6)**脚本**（通过 PDO 使用 Zend_DB (1.5.1)**），它执行以下操作：

1.  截断一组 4 个“导入”表
2.  将数据批量插入到这 4 个“导入”表中（重新使用以前在表中的 id，但我截断了整个表，所以这应该不是问题，对吧？）
3.  如果一切顺利，将“live”表重命名为“temp”，将“import”表重命名为“live”，然后将“temp”（旧“live”）表重命名为“import”

这工作了好几个星期。现在我偶尔会得到这个，在整个批量加载过程的中间的某个地方：

`SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '911' for key 1`

请注意，这不是截断之前表中的第一个 id。当我再次手动启动脚本时，它就像一个魅力。

有任何想法吗？剩余索引，可能与重命名有关？

此外，当我之后检查表中是否有 id 为 911 的条目时，它甚至不在那里。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T02:04:51.657

当 MyISAM 表损坏时，可能会发生此类错误。在有问题的表上运行修复命令通常是修复它所需的全部内容：

```
> repair table mytablename; 
```

更好的解决方案是不要将 MyISAM 用于数据不断变化的表 - InnoDB 更加防弹，正如 Paul 正确指出的那样，您可以在 InnoDB 表上使用事务，但不能在 MyISAM 上使用。

顺便说一句，我会避免在运行中重命名表 - 这是定期做的一件相当笨重的事情，如果在重命名过程中系统上有其他用户，可能会导致一些非常意外的结果。为什么不这样做：

```
> truncate table temptable;
> truncate table importtable;

> #bulk insert new data
> insert into importtable(col1,col2,col3) 
> values(1,2,3),(4,5,6),(7,8,9);

> #now archive the live data
> insert into temptable(col1,col2,col3)
> select col1,col2,col3 from livetable;

> #finally copy the new data to live
> truncate table livetable;
> insert into livetable(col1,col2,col3)
> select col1,col2,col3 from importtable; 
```

当然，如果您要插入大量行，那么风险将是，只要插入需要完成，您的所有实时数据都将不可用，但总体而言，这种方法对索引、触发器或其他任何东西的破坏性要小得多这可能与相关表格相关联。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:20:39.787

显然存在一些锁定问题或其他问题，我能够通过在并行连接中将“SELECT”语句发送到受影响的和相关的表来重现该行为。

现在我使用`DELETE FROM`而不是`TRUNCATE`将`RENAME TABLE`语句（我一次做了 3 个重命名）更改为一堆单个`ALTER TABLE xxx RENAME TO zzz`语句，并且无法再重现错误。

所以这可能会解决。也许其他人可以从我花在研究和大量尝试和错误上的一天中受益。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T10:41:43.143

在您的导入脚本运行时，是否可以将其他一些脚本插入到数据库中？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T10:44:57.473

您是否尝试过启用查询日志以查看您是否真的在插入重复项？

你能在你的测试环境中重现它吗？不要在生产中启用查询日志。

如果问题是真实的，则表可能已损坏；这可能是由多种原因引起的，但也有可能是不可靠的硬件或电源故障。

检查 mysql 日志，看看它最近或期间是否有任何问题（或崩溃）。

同样，我能建议的只是尝试在您的测试环境中重现它。创建大量测试数据并重复加载它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-16T16:25:22.797

您正在创建一条省略“id”字段（或为 NULL）的新记录，但之前您已更新另一条记录并将其“id”更改为“911”。换句话说，如果您的表的 AUTO_INCREMENT 值被采用，您将无法创建另一条记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T20:40:41.563

你在使用交易吗？您可以消除事务中的许多此类问题，尤其是在可以锁定表或将事务隔离模式设置为可序列化的情况下。我不太熟悉 MySQL 上的那些，但我相信事务只适用于 InnoDB 表（或者这可能是过时的知识）。

# .net - 以编程方式远程注销活动域用户

> ID：221410
> 
> 赞同：1
> 
> 时间：2008-10-21T10:35:21.253
> 
> 标签：.net, active-directory, logoff

我需要能够从程序的 Windows 会话中注销任何用户。

我知道我可以以管理员身份登录并强制远程注销。有没有其他方法可以在不登录的情况下强制注销？

该工具将以管理员身份运行，因此这不是问题，无需登录即可远程注销。

工具在 .NET 中，但欢迎使用任何其他方式（JScript、从 PInvoke 运行的命令行工具等）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T12:01:37.007

也许使用 Sysinternals 的[PsTools](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx "PsTools")，尤其是[PsShutdown](http://technet.microsoft.com/en-us/sysinternals/bb897541.aspx "Ps关机")？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T14:56:20.167

最后在这个页面中找到了这个脚本：[http ://www.robvanderwoude.com/files/logoff_vbs.txt](http://www.robvanderwoude.com/files/logoff_vbs.txt)

我决定将它作为字符串存储在工具中，并将其写入磁盘，执行并删除它。不是特别优雅（是的，是的，丑得要命），但现在已经足够好了。

```
' Logoff.vbs, Version 1.00
' Logoff current user on any WMI enabled computer on the network
'
' Adapted from posts by Alex Angelopoulos on www.developersdex.com
' and Michael Harris on microsoft.public.scripting.vbscript
'
' Written by Rob van der Woude
' http://www.robvanderwoude.com

' Check command line parameters
Select Case WScript.Arguments.Count
    Case 0
        ' Default is local computer if none specified
        strComputer = "."
    Case 1
        Select Case WScript.Arguments(0)
            ' "?", "-?" or "/?" invoke online help
            Case "?"
                Syntax
            Case "-?"
                Syntax
            Case "/?"
                Syntax
            Case Else
                strComputer = WScript.Arguments(0)
        End Select
    Case Else
        ' More than 1 argument is not allowed
        Syntax
End Select

' Define some constants that can be used in this script;
' logoff = 0 (no forced close of applications) or 5 (forced);
' 5 works OK in Windows 2000, but may result in power off in XP
Const EWX_LOGOFF   = 0
Const EWX_SHUTDOWN = 1
Const EWX_REBOOT   = 2
Const EWX_FORCE    = 4
Const EWX_POWEROFF = 8

' Connect to computer
Set OpSysSet = GetObject("winmgmts:{(Shutdown)}//" & strComputer & "/root/cimv2").ExecQuery("select * from Win32_OperatingSystem where Primary=true")

' Actual logoff
for each OpSys in OpSysSet
    OpSys.Win32Shutdown EWX_LOGOFF
next

' Done
WScript.Quit(0)

Sub Syntax
msg = vbCrLf & "Logoff.vbs,  Version 1.00" & vbCrLf & _
      "Logoff the current user of any WMI enabled computer on the network." & _
      vbCrLf & vbCrLf & "Usage:  CSCRIPT  LOGOFF.VBS  [ computer_name ]" & _
      vbCrLf & vbCrLf & _
      "Where:  " & Chr(34) & "computer_name" & Chr(34) & _
      "  is the name of the computer to be logged off" & vbCrLf & _
      "                         (without leading backslashes); default is " & _
      Chr(34) & "." & Chr(34) & vbCrLf & _
      "                         (the local computer)." & vbCrLf & vbCrLf & _
      "Written by Rob van der Woude" & vbCrLf & _
      "http://www.robvanderwoude.com" & vbCrLf & vbCrLf & _
      "Based on posts by Alex Angelopoulos on www.developersdex.com" & _
      vbCrLf & _
      "and Michael Harris on microsoft.public.scripting.vbscript" & vbCrLf
Wscript.Echo(msg)
Wscript.Quit(1)
End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-03T14:08:08.490

您可以使用简单的命令行从任何远程用户强制注销，如下所示

```
C:\>psexec \\remotepc shutdown /f /l 
```

# windows - 如何为通过 CreateWindow 创建的窗口指定字体？

> ID：221411
> 
> 赞同：16
> 
> 时间：2008-10-21T10:36:07.493
> 
> 标签：windows, winapi, fonts

我正在使用纯 Win32 API（RegisterClass 和 CreateWindow 函数）创建窗口。如何为窗口指定字体而不是系统定义的字体？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-22T13:32:54.467

当您创建自己的窗口类时，您自己负责管理字体。该任务将分为四个部分：

1.  创建窗口时（即处理[WM_CREATE](http://msdn.microsoft.com/en-us/library/ms632619(VS.85).aspx)时），使用[CreateFont()](http://msdn.microsoft.com/en-us/library/ms534214.aspx)或[CreateFontIndirect()](http://msdn.microsoft.com/en-us/library/ms534009(VS.85).aspx)获取要在窗口中使用的字体的 HFONT。您需要将此 HFONT 与您为窗口类的每个实例保留的其他数据一起存储。您可以选择让您的窗口类也处理[WM_GETFONT](http://msdn.microsoft.com/en-us/library/ms632624(VS.85).aspx)和[WM_SETFONT](http://msdn.microsoft.com/en-us/library/ms632642(VS.85).aspx)，但顶级窗口通常不需要它（如果您正在创建控制窗口类，您将需要处理 WM_SETFONT，因为对话框管理器会发送该消息）。
2.  如果您的窗口有任何包含文本的子窗口，只要您的窗口字体发生变化，就向每个子窗口发送一条 WM_SETFONT 消息。所有常见的 Windows 控件都处理 WM_SETFONT。
3.  当您绘制窗口的内容时（通常是响应[WM_PAINT消息），在绘制文本之前使用](http://msdn.microsoft.com/en-us/library/ms534901(VS.85).aspx)[SelectObject()](http://msdn.microsoft.com/en-us/library/ms533272(VS.85).aspx)函数将您的 HFONT 选择到设备上下文中（或使用诸如或[GetTextMetrics()](http://msdn.microsoft.com/en-us/library/ms534026.aspx)之类的文本函数）。
4.  当窗口被销毁时（即当您处理[WM_DESTROY](http://msdn.microsoft.com/en-us/library/ms632620(VS.85).aspx)时），使用[DeleteObject()](http://msdn.microsoft.com/en-us/library/ms533225(VS.85).aspx)释放您在步骤 1 中创建的字体。请注意，如果您选择在窗口中处理 WM_SETFONT，请*不要*删除您在 WM_SETFONT 中收到的字体对象处理程序，因为发送消息的代码期望保留该句柄的所有权。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-22T04:06:26.467

正如vivios所说，只需使用[CreateFont()/CreateFontIndirect](http://msdn.microsoft.com/en-us/library/ms534214.aspx)：

```
HFONT hFont = CreateFont (13, 0, 0, 0, FW_DONTCARE, FALSE, FALSE, FALSE, ANSI_CHARSET, 
      OUT_TT_PRECIS, CLIP_DEFAULT_PRECIS, DEFAULT_QUALITY, 
      DEFAULT_PITCH | FF_DONTCARE, TEXT("Tahoma")); 
```

[然后使用WM_SETFONT](http://msdn.microsoft.com/en-us/library/ms632642(VS.85).aspx)消息为您的窗口/控件设置此字体：

```
SendMessage(window, WM_SETFONT, hFont, TRUE); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T10:40:29.310

如果您超类化一个已经有自己的字体句柄的标准公共控件，请使用这种方法：只需使用`CreateFont`or创建字体`CreateFontIndirect`并使用 message 设置它`WM_SETFONT`（在 MFC 和 ATL 中会有相应的`SetFont`函数）。当不再需要字体时，使用`DeleteObject`. 确保不要破坏窗口先前设置的字体。

如果您正在编写一个可以自行绘制的自定义控件，只需使用`CreateFont`or创建一个新的字体对象`CreateFontIndirect`并将其存储在您的类中的某个位置。如果要支持第三方用户，请处理`WM_SETFONT`并`WM_GETFONT`让用户设置另一种字体。绘画时，使用存储在类中的当前字体对象。

# email - SMTP 错误 554“邮件不符合标准”

> ID：221416
> 
> 赞同：16
> 
> 时间：2008-10-21T10:38:24.697
> 
> 标签：email, outlook, smtp

我使用 MDaemon 作为外发邮件服务器，最近几天我收到一个错误“554 消息不符合标准”，用于从其中一台机器发送的电子邮件。知道可能是什么原因造成的吗？其他机器工作正常。

更多信息....这是日志文件：

```
2008 年 10 月 20 日星期一 16:11:37：会议 7831；孩子 1; 线程 3908
星期一 2008-10-20 16:11:36：接受来自 [80.78.72.135 : 43579] 的 SMTP 连接
2008 年 10 月 20 日星期一 16:11:36：执行 PTR 查找 (135.72.78.80.IN-ADDR.ARPA)
Mon 2008-10-20 16:11:36: * 错误：名称服务器报告域名未知
周一 2008-10-20 16:11:36: * 未找到 PTR 记录
星期一 2008-10-20 16:11:36: ---- 结束 PTR 结果
星期一 2008-10-20 16:11:36: --> 220 ikubinfo.com ESMTP MDaemon 9.5.2; 2008 年 10 月 20 日星期一 16:11:36 +0200
Mon 2008-10-20 16:11:36:250 ikubinfo.com 你好 RS，很高兴认识你
2008 年 10 月 20 日星期一 16:11:36：
周一 2008-10-20 16:11:36：执行 IP 查找 (ikubINFO.com)
星期一 2008-10-20 16:11:36: * D=ikubINFO.com TTL=(633) A=[216.75.60.232]
星期一 2008-10-20 16:11:36: * P=010 S=000 D=ikubINFO.com TTL=(708) MX=[mail.ikubinfo.com]
星期一 2008-10-20 16:11:36: * D=ikubINFO.com TTL=(633) A=[216.75.60.232]
Mon 2008-10-20 16:11:36: ---- 结束 IP 查找结果
周一 2008-10-20 16:11:36：执行 SPF 查找 (ikubINFO.com / 80.78.72.135)
星期一 2008-10-20 16:11:36: * ikubINFO.com 80.78.72.135; 与 SPF 缓存匹配
2008 年 10 月 20 日星期一 16:11:36：* 结果：通过
星期一 2008-10-20 16:11:36: ---- 结束 SPF 结果
星期一 2008-10-20 16:11:36: --> 250 ，发件人确定
2008 年 10 月 20 日星期一 16:11:36：
周一 2008-10-20 16:11:36：执行 DNS-BL 查找（80.78.72.135 - 连接 IP）
星期一 2008-10-20 16:11:36: * sbl-xbl.spamhaus.org - 通过
2008 年 10 月 20 日星期一 16:11:36：* relays.ordb.org - 失败
星期一 2008-10-20 16:11:36: * bl.spamcop.net - 通过
Mon 2008-10-20 16:11:36: ---- 结束 DNS-BL 结果
2008 年 10 月 20 日星期一 16:11:36: --> 250 ，收件人正常
星期一 2008-10-20 16:11:37:354 输入邮件，以 . 结尾。
2008 年 10 月 20 日星期一 16:11:37：消息大小：389 字节
Mon 2008-10-20 16:11:37: --> 554 消息不符合标准
Mon 2008-10-20 16:11:37:221 网络空间见
2008 年 10 月 20 日星期一 16:11:37：SMTP 会话终止（输入/输出字节：491/319）

```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-21T11:52:18.213

SMTP 错误 554 是比较模糊的错误代码之一，但通常是由接收服务器在 From 或 To 标头中看到它不喜欢的内容引起的。这可能是由于垃圾邮件陷阱将您的计算机识别为中继，或作为不受信任的计算机从您的域发送邮件所致。

我们最近在向我们的阵列添加新服务器时遇到了这个问题，我们通过确保我们设置了正确的[反向 DNS 查找](http://en.wikipedia.org/wiki/Reverse_DNS_lookup)来修复它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-01-23T11:50:07.717

554 通常被 dns 黑名单用于驱逐黑名单服务器。我假设

> 2008 年 10 月 20 日星期一 16:11:36：* relays.ordb.org - 失败

在您包含的日志中是罪魁祸首。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-20T01:46:58.517

可能是由于发件人端未配置 SPF 记录造成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T11:00:23.307

要解决问题，请转到 MDaemon-->setup-->Miscellaneous options-->Server-->SMTP Server Checks commands and headers for RFC Compliance

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-12T13:35:31.903

刚刚遇到了 Outlook 客户端通过 Exchange 服务器到 Windows XP 上的外部地址的问题。清除临时文件似乎可以解决问题。

# windows - 如何以编程方式访问 Windows 符号链接的目标路径？

> ID：221417
> 
> 赞同：14
> 
> 时间：2008-10-21T10:38:37.580
> 
> 标签：windows, visual-studio-2008, symlink

Windows 6（Vista 和 Server 2008）支持正确的符号链接，可以通过[CreateSymbolicLink](http://msdn.microsoft.com/en-us/library/aa363866.aspx)函数创建。但是似乎没有相应的函数来询问符号链接以获取链接目标的路径。

我发现符号链接是重解析点的一种实现，所以重解析点函数可以用来获取目标路径。但是我需要使用重解析点的头文件似乎随[Windows Driver Kit](http://www.microsoft.com/whdc/devtools/wdk/default.mspx)一起提供。用 VS2008 设置这个套件似乎不是一件容易的事。

是否有一个很好的简单函数我错过了获取链接的目标，或者我真的必须设置一个 Windows 驱动程序开发环境只是为了编写代码来访问这些信息？

编辑：Adam Mitz 提出了 GetFinalPathNameByHandle 的建议。此功能非常适用于本地符号链接，但似乎不适用于解析远程链接（通过 UNC 路径）。

编辑 2：应亚当的要求，这里有更多关于我尝试过的细节：

我最初沿着`FSCTL_GET_REPARSE_POINT`/`DeviceIoControl`路线走，但这会产生一个`REPARSE_DATA_BUFFER`结构。定义此结构的标头似乎仅存在于 Windows 驱动程序工具包中。

`GetFinalPathNameByHandle()`当链接存在于本地磁盘（`C:\...\link`等）上时工作正常。奇怪的是，我发现无论目标文件是否存在，我都可以使用`CreateFileW()`是否指定标志来获取链接的句柄 - 从而获取目标。`FILE_FLAG_OPEN_REPARSE_POINT`

当`CreateFileW()`和`GetFinalPathNameByHandle()`用于询问远程链接时（`\\?\UNC\....`），事情开始解开。如果`FILE_FLAG_OPEN_REPARSE_POINT`指定，则`GetFinalPathNameByHandle()`始终返回链接路径，而不是目标路径。如果`FILE_FLAG_OPEN_REPARSE_POINT`未指定，则返回目标路径，但前提是目标存在并且与链接位于同一台机器上。如果链接指向另一台机器，我会收到网络权限错误。如果链接指向本地 - 不存在 - 文件，我会收到文件未找到错误。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T11:36:14.983

[GetFinalPathNameByHandle](http://msdn.microsoft.com/en-us/library/aa364962(VS.85).aspx)

> A final path is the path that is returned when a path is fully resolved. For example, for a symbolic link named "C:\tmp\mydir" that points to "D:\yourdir", the final filesystem path would be "D:\yourdir".

# sql-server - 如何以编程方式创建 SSIS 包？

> ID：221428
> 
> 赞同：8
> 
> 时间：2008-10-21T10:44:51.703
> 
> 标签：sql-server, ssis, etl, dataflowtask

我正在尝试以**编程**方式创建一个 SSIS 包，其中包含在同一数据库中从表 A 到表 B 的简单数据流。我正在使用[此处](http://technet.microsoft.com/en-us/library/ms136020.aspx)给出的示例。该包被创建并保存到一个 dtsx 文件中，但是当我在 Visual Studio 中打开它时，我看到源表和目标表尚未被选择。

我还想在它到达目的地之前插入一个转换任务。

* * *

## 编辑

好吧，我已经设法选择了源表和目标表，并且任务甚至成功运行。原来我需要

(a) 对源和目标各使用一个 oleDB 连接[我不喜欢这种方式；我只想使用一个连接]

(b) 在目标***SetComponentProperty("AccessMode", 3) 中将***Accessmode 设置为 3，这相当于 Table 或 View - 快速加载。

某处是否有关于此的一些文档。我所能找到的只是**SetComponentProperty**的作用，而不是它可以采取的所有参数。例如。除了“AccessMode”，我还能放什么？第二个参数 3 或 2 或 1 代表什么？

仍在尝试映射绰号。STOCK:PipelineTask 表示 DataFlow 任务。说...复制列的绰号是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T19:58:36.013

是的，这是我对 SSIS 的不满之一：他们没有提供新术语的简单表格或地图。

您可以使用一小段代码来发现可用的组件。

代码位于：http: [//msdn.microsoft.com/en-us/library/ms136106.aspx](http://msdn.microsoft.com/en-us/library/ms136106.aspx)

当我运行它时，我发现复制列的名字是：名称：复制列创建名称：DTSTransform.CopyMap.1

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-04-03T21:03:35.263

如果您不想使用 DTS .net 程序集，您可以使用 EzApi，它提供了一种更简单的语法来以编程方式创建 SSIS 包。

> EzAPI 是一个 .NET 库，由 SSIS 团队的一名测试人员 Evgeny Koblov 用 C# 编写，用于抽象出许多繁琐的低级编码，这些代码需要直接用编程语言创建 SSIS 包 XML

EzApi 最初是作为 Microsoft 产品团队创建的 SSIS 社区示例项目的一部分发布的：

*   [SQLSrvIntegrationSrv](https://archive.codeplex.com/?p=sqlsrvintegrationsrv)
*   [GitHub - MSSQL SSIS 社区示例](https://github.com/fan130/mssql-ssis-community-samples)

后来它作为一个单独的项目发布，以添加对 SQL Server 2016 的支持：

*   [GitHub - EzApi2016](https://github.com/fpvmorais/EzApi2016)
*   [NuGet 库 - EzApi](https://www.nuget.org/packages/EzAPI/)

要开始使用 EzApi，您可以参考 Internet 上的许多链接，例如：

*   [EzAPI – 替代包创建 API](https://blogs.msdn.microsoft.com/mattm/2008/12/30/ezapi-alternative-package-creation-api/)
*   [EzAPI 概述](http://billfellows.blogspot.com/2012/01/ezapi-overview.html)
*   [EzApi 一个用于以编程方式创建 SSIS 包的 C# 库](https://www.kapacity.dk/ezapi-a-c-library-for-creating-ssis-packages-programatically/?lang=en)
*   [EzAPI 入门](https://www.dimodelo.com/blog/2013/getting-started-with-ezapi/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T02:18:36.467

我曾经拥有一本Wrox 书籍[SQL Server 2005 Integration Services的副本。](http://www.wrox.com/WileyCDA/WroxTitle/Professional-SQL-Server-2005-Integration-Services.productCd-0764584359.html)我很确定它有一两章专门用于以编程方式使用 SSIS 包。您可能想查看当地的书店并翻阅它，它可能有您想要的东西。

对不起，我不能给你比参考书更具体的东西。祝你好运。

# javascript - 如何使用 Javascript 确认浏览器窗口已打开？

> ID：221432
> 
> 赞同：5
> 
> 时间：2008-10-21T10:45:34.913
> 
> 标签：javascript, popup

我正在为一些成员从我的站点打开一个新的浏览器窗口。但是，有些人可能稍后会关闭它，或者它最初可能无法打开。

是否有一段相当简单的 Javascript 可以在每个页面上运行，以确认是否打开了另一个浏览器窗口，如果没有，提供重新打开它的链接？

**[澄清：]**检查窗口是否打开的代码将在其他页面上运行 - 而不仅仅是在打开它的同一个窗口和 URL 中。想象一个用户登录，窗口（试图）打开，然后他们在同一个选项卡/窗口（或其他）中浏览一段时间，然后关闭第二个窗口（或它从未打开） - 我希望能够注意到窗口在最初尝试打开/关闭后的一段时间后已经关闭，所以我不确定是否可以轻松使用或确实可能.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T11:00:02.327

这篇[优秀的综合文章](http://www.irt.org/articles/js205/index.htm) *（“几乎完全控制弹出窗口”）*应该回答您关于 javascript 弹出窗口的所有问题。

*“JavaScript 1.1 还引入了 window **closed**属性。使用此属性，可以检测窗口是否已打开并随后关闭。如果它仍然为 JavaScript 1.1 启用，我们可以使用它将页面直接加载到打开器窗口中浏览器：”*

```
<script language="JavaScript"><!--
function open_main(page) {
    window_handle = window.open(page,'main');
    return false;
}
//--></script>

<script language="JavaScript1.1"><!--
function open_main(page) {
    if (opener && !opener.closed) {
        opener.location.href = page;
    }
    else {
        window_handle = window.open(page,'main');
    }
    return false;
}
//--></script>

<a href="example.htm" onClick="return open_main('example.htm')">example.htm</a> 
```

**补充：** 您可以通过以下方式引用弹出窗口的名称，将窗口句柄返回到另一个页面：

```
window_handle = window.open(page,'myPopupName'); 
```

我想在您的情况下，您应该考虑一种一致的方法来在整个应用程序中创建弹出窗口的所有名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T10:48:14.487

```
var myWin = window.open(...);

if (myWin.closed)
{
    myWin = window.open(...);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T12:58:34.817

没有通用的方法来检查它，因为每个弹出窗口阻止程序都有不同的行为。例如，Opera 不会显示弹出窗口，但 widow.closed 将返回 false，因为在幕后 Opera 会保留被阻止窗口的影子副本，以防用户无论如何都想看到它。

# firefox - Firefox 3 不应用我的 xslt 样式表，但其他浏览器可以

> ID：221434
> 
> 赞同：10
> 
> 时间：2008-10-21T10:47:10.840
> 
> 标签：firefox, xslt, firefox-3

我正在尝试从 Web 服务器提供动态生成的 xml 页面，并从同一 Web 服务器提供自定义、静态、xslt，它将处理卸载到客户端 Web 浏览器中。

直到最近，我在 Firefox 2、3、IE5、6 和 Chrome 中都能正常工作。不过，最近发生了一些变化，Firefox 3 现在只显示源代码中的文本元素。

页面源代码是这样开始的：

```
<?xml version="1.0" encoding="UTF-8"?>
<!-- Firefox 2.0 and Internet Explorer 7 use simplistic feed sniffing to override desired presentation behavior for this feed, and thus we are obliged to insert this comment, a bit of a waste of bandwidth, unfortunately. This should ensure that the following stylesheet processing instruction is honored by these new browser versions. For some more background you might want to visit the following bug report: https://bugzilla.mozilla.org/show_bug.cgi?id=338621 -->
<?xml-stylesheet type="text/xsl" href="/WebObjects/SantaPreview.woa/Contents/WebServerResources/Root.xsl"?>
<wrapper xmlns="http://www.bbc.co.uk/ContentInterface/Content" xmlns:cont="http://www.bbc.co.uk/ContentInterface/Content" sceneId="T2a_INDEX" serviceName="DSat_T2">
    .... 
```

Firebug 显示正在加载 Root.xsl 文件，并且它的响应标头包括该行

```
Content-Type    text/xml 
```

*我也尝试过使用 application/xml 作为内容类型，但没有区别:-(*

Web Developer Extension 也显示了正确的生成源，如果你保存它并在 Firefox 中加载页面，它会正确显示。

显示问题的 Firefox 版本是 3.0.3

有什么想法我可能做错了吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T21:03:28.443

只显示文本元素是您从空的 XSL 样式表中得到的行为。

对我来说，这表明您的 xpath 表达式有问题，并且 xsl:template/@match 属性与源文档不匹配。

您没有提供足够的信息来进一步诊断，所以我只能提供这种盲目的猜测。

编辑：原来的问题是 IE 和 Chrome 默默地接受一个节点集作为[string-length](http://www.w3.org/TR/xpath#function-string-length)的参数，而 FF3 没有。请注意，规范要求使用可选的字符串参数，并且没有指定节点集参数的行为。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-04-24T12:02:02.037

如果您使用的是 NoScript，这也会禁用 XSL 样式表，直到您`Allow <site>`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-24T08:48:21.890

*根据后续调查回答我自己的问题。[ddaa](https://stackoverflow.com/questions/221434/how-can-i-get-firefox-3-to-display-a-page-after-performing-the-xsl-stylesheet-p#231522)引导我朝着正确的方向前进。*

Firefox 似乎对 xslt 转换非常挑剔。仔细检查您的 xslt 以确保它没有被 IE 和 Chrome 屏蔽的错误。

XML Spy 是一个不错的产品，虽然并不便宜，但它会突出 xslt 中的一系列错误。它似乎至少解决了与 Firefox 渲染器一样多的问题。

不幸的是，您似乎不能依靠 Web Developer 扩展来解决问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-10-13T15:48:03.433

我只是为了后代而写在这里-我有同样的症状，也有 Firefox 3。但是在*我的*情况下，问题是另一个：

Firefox 似乎真的*非常*不喜欢 XSL 文件**`_`**的名称中包含下划线。我的 XSLT 文件被称为`my_super_nice_xslt_which_loads_in_opera_and_ie.xsl`.

所以，人们，我们不要使用下划线。请改用连字符（减号）： `my-super-nice-xslt-which-loads-in-opera-and-ie.xsl`.

然后它也将加载到 Firefox 中。我想从现在开始，我将只使用带有字母和数字的简单名称。你知道这句话，“一次被咬，两次害羞”。*（就我而言，我被咬了两次，但忘记了第一次，所以这一次让我害羞了四倍。）*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T23:59:14.610

尝试将其作为 application/xml 而不是 text/xml

# java - 如何为 Java 创建 REST 客户端？

> ID：221442
> 
> 赞同：257
> 
> 时间：2008-10-21T10:50:58.897
> 
> 标签：java, rest, client

通过 JSR 311 及其实现，我们拥有了通过 REST 公开 Java 对象的强大标准。然而，在客户端似乎缺少与 Apache Axis for SOAP 相当的东西——隐藏 Web 服务并将数据透明地编组回 Java 对象的东西。

如何创建 Java RESTful 客户端？使用 HTTPConnection 和手动解析结果？或者专门的客户，例如 Jersey 或 Apache CXR？

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2011-02-17T02:48:29.767

这是一个老问题（2008 年），所以现在有比当时更多的选择：

*   **Apache CXF**具有三种不同的[REST 客户端选项](http://cxf.apache.org/docs/jax-rs-client-api.html)
*   **[泽西岛](https://jersey.java.net/)**（如上所述）。
*   **[Spring RestTemplate](http://blog.springsource.com/2009/03/27/rest-in-spring-3-resttemplate/)**被**Spring WebClient取代**
*   **[Commons HTTP Client](http://hc.apache.org/httpclient-3.x/)**为较旧的 Java 项目构建您自己的客户端。

**更新（2020 年仍然活跃的项目）：**

*   **[Apache HTTP 组件 (4.2) Fluent 适配器](http://hc.apache.org/httpcomponents-client-ga/tutorial/html/fluent.html)**- JDK 的基本替代品，被此列表中的其他几个候选者使用。比旧的 Commons HTTP Client 3 更好，并且更易于用于构建您自己的 REST 客户端。您必须使用[Jackson 之类的东西来支持 JSON 解析](http://jackson.codehaus.org/)，并且可以使用[HTTP 组件 URIBuilder 来构造](http://hc.apache.org/httpcomponents-client-ga/tutorial/html/fundamentals.html#d5e49)类似于 Jersey/JAX-RS Rest 客户端的资源 URI。HTTP 组件也支持 NIO，但考虑到 REST 的短请求性质，我怀疑你会获得比 BIO 更好的性能。**Apache HttpComponents 5**支持 HTTP/2。
*   **[OkHttp](https://github.com/square/okhttp)** - JDK 的基本替代品，类似于 http 组件，被此列表中的其他几个候选人使用。支持较新的 HTTP 协议（​​SPDY 和 HTTP2）。适用于安卓系统。不幸的是，它没有提供真正的基于反应器循环的异步选项（参见上面的 Ning 和 HTTP 组件）。但是，如果您使用较新的 HTTP2 协议，则问题不大（假设连接数有问题）。
*   **[Ning Async-http-client](https://github.com/AsyncHttpClient/async-http-client)** - 提供 NIO 支持。~~以前被Sonatype~~称为~~**[Async-http-client](https://github.com/sonatype/async-http-client)**~~。
*   低级 http 客户端（okhttp、apache httpcomponents）的**[Feign包装器。](https://github.com/OpenFeign/feign)**基于类似于某些 Jersey 和 CXF 扩展的接口存根自动创建客户端。强大的弹簧集成。
*   **[Retrofit](http://square.github.io/retrofit/)** - 低级 http 客户端 (okhttp) 的包装器。基于类似于某些 Jersey 和 CXF 扩展的接口存根自动创建客户端。
*   **[用于 jdk http 客户端的Volley](https://github.com/google/volley)** 包装器，由 google 提供
*   用于 jdk http 客户端或 apache httpcomponents 的**[google-http包装器，由 google 提供](https://github.com/googleapis/google-http-java-client)**
*   **[用于 jdk http 客户端的Unirest](https://github.com/Kong/unirest-java)** 包装器，由 kong
*   **[用于 jdk http 客户端的Resteasy](https://github.com/resteasy)** JakartaEE 包装器，由 jboss 提供，是 jboss 框架的一部分
*   **[用于 apache httpcomponents 的jcabi-http](https://github.com/jcabi/jcabi-http)**包装器，是 jcabi 集合的一部分
*   **[用于 apache httpcomponents 的restlet](https://github.com/restlet/restlet-framework-java)**包装器，restlet 框架的一部分
*   **[带有断言的放心](https://github.com/rest-assured/rest-assured)**包装器，便于测试

关于选择 HTTP/REST 客户端的警告。确保检查您的框架堆栈正在为 HTTP 客户端使用什么，它是如何处理线程的，并且如果提供了一个客户端，最好使用相同的客户端。也就是说，如果您使用诸如 Vert.x 或 Play 之类的东西，您可能想尝试使用其支持客户端来参与框架提供的任何总线或反应器循环......否则为可能有趣的线程问题做好准备。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-10-21T12:58:39.497

[正如我在这个线程](https://stackoverflow.com/questions/165720/how-to-debug-restful-services#166269)中提到的，我倾向于使用实现 JAX-RS 并带有一个不错的 REST 客户端的[Jersey 。](http://jersey.java.net/)好消息是，如果您使用 JAX-RS 实现 RESTful 资源，那么 Jersey 客户端可以重用实体提供程序，例如 JAXB/XML/JSON/Atom 等 - 因此您可以在服务器端重用与您相同的对象在客户端单元测试中使用。

例如，这里有一个来自[Apache Camel 项目](http://activemq.apache.org/camel/)[的单元测试用例](http://svn.apache.org/viewvc/activemq/camel/trunk/components/camel-rest/src/test/java/org/apache/camel/rest/resources/EndpointsTest.java?revision=700513&view=markup)，它从 RESTful 资源（使用 JAXB 对象端点）中查找 XML 有效负载。resource(uri) 方法在[这个基类](http://svn.apache.org/viewvc/activemq/camel/trunk/components/camel-rest/src/test/java/org/apache/camel/rest/resources/TestSupport.java?revision=700513&view=markup)中定义，它只使用 Jersey 客户端 API。

例如

```
 clientConfig = new DefaultClientConfig();
    client = Client.create(clientConfig);

    resource = client.resource("http://localhost:8080");
    // lets get the XML as a String
    String text = resource("foo").accept("application/xml").get(String.class); 
```

顺便说一句，我希望 JAX-RS 的未来版本能够像 Jersey 中的那样添加一个不错的客户端 API

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2010-08-20T18:20:38.723

您可以使用标准 Java SE API：

```
private void updateCustomer(Customer customer) { 
    try { 
        URL url = new URL("http://www.example.com/customers"); 
        HttpURLConnection connection = (HttpURLConnection) url.openConnection(); 
        connection.setDoOutput(true); 
        connection.setInstanceFollowRedirects(false); 
        connection.setRequestMethod("PUT"); 
        connection.setRequestProperty("Content-Type", "application/xml"); 

        OutputStream os = connection.getOutputStream(); 
        jaxbContext.createMarshaller().marshal(customer, os); 
        os.flush(); 

        connection.getResponseCode(); 
        connection.disconnect(); 
    } catch(Exception e) { 
        throw new RuntimeException(e); 
    } 
} 
```

或者，您可以使用 JAX-RS 实现（例如 Jersey）提供的 REST 客户端 API。这些 API 更易于使用，但需要在类路径中添加额外的 jar。

```
WebResource resource = client.resource("http://www.example.com/customers"); 
ClientResponse response = resource.type("application/xml");).put(ClientResponse.class, "<customer>...</customer."); 
System.out.println(response); 
```

有关更多信息，请参阅：

*   [http://bdoughan.blogspot.com/2010/08/creating-restful-web-service-part-55.html](http://bdoughan.blogspot.com/2010/08/creating-restful-web-service-part-55.html)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-02-24T20:47:25.503

如果您只想调用 REST 服务并解析响应，您可以尝试使用[Rest Assured](https://github.com/jayway/rest-assured)

```
// Make a GET request to "/lotto"
String json = get("/lotto").asString()
// Parse the JSON response
List<String> winnderIds = with(json).get("lotto.winners.winnerId");

// Make a POST request to "/shopping"
String xml = post("/shopping").andReturn().body().asString()
// Parse the XML
Node category = with(xml).get("shopping.category[0]"); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-21T18:35:04.750

您还可以查看具有完整客户端功能的[Restlet](http://www.restlet.org)，比 HttpURLConnection 或 Apache HTTP 客户端（我们可以将其用作连接器）等低级库更面向 REST。

最好的问候，杰罗姆·卢维尔

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-09-02T23:05:19.347

你可以试试[拉帕](https://github.com/harikrishnan83/rapa/wiki/)。让我们知道您对此的反馈。并随时记录问题或预期功能。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-12-25T07:48:56.980

我想指出另外两个选择：

*   [Restfulie](http://restfulie.caelum.com.br/)基于 VRaptor Web 框架，具有服务器端和客户端实现，并具有非常好的超媒体支持。
*   [RESTEasy](http://www.jboss.org/resteasy)有一个[基于 JAX-RS 代理的客户端](http://docs.jboss.org/resteasy/docs/2.3.0.GA/userguide/html/RESTEasy_Client_Framework.html)实现。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-04-29T12:11:40.463

`JdkRequest`从[jcabi-http](http://http.jcabi.com/)尝试（我是开发人员）。这是它的工作原理：

```
String body = new JdkRequest("http://www.google.com")
  .header("User-Agent", "it's me")
  .fetch()
  .body() 
```

查看此博客文章了解更多详细信息：[http ://www.yegor256.com/2014/04/11/jcabi-http-intro.html](http://www.yegor256.com/2014/04/11/jcabi-http-intro.html)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-06-07T09:09:57.963

我最近从 square 尝试了[Retrofit](http://square.github.io/retrofit/) Library，它很棒，你可以很容易地调用你的 rest API。基于注释的配置允许我们摆脱大量的样板编码。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-11-16T14:18:27.057

与 Retrofit 结合使用时，OkHttp 也是轻量级和强大的。这适用于一般 Java 使用以及 Android。

**okhttp**：[http ://square.github.io/okhttp/](http://square.github.io/okhttp/)

```
public static final MediaType JSON
    = MediaType.parse("application/json; charset=utf-8");

OkHttpClient client = new OkHttpClient();

String post(String url, String json) throws IOException {
  RequestBody body = RequestBody.create(JSON, json);
  Request request = new Request.Builder()
      .url(url)
      .post(body)
      .build();
  Response response = client.newCall(request).execute();
  return response.body().string();
} 
```

**改造**：[http ://square.github.io/retrofit/](http://square.github.io/retrofit/)

```
public interface GitHubService {
  @GET("/users/{user}/repos")
  Call<List<Repo>> listRepos(@Path("user") String user);
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-21T11:04:15.297

我使用 Apache HTTPClient 来处理所有 HTTP 方面的事情。

我为将 XML 解析为对象模型的 XML 内容编写了 XML SAX 解析器。我相信 Axis2 还公开了 XML -> Model 方法（Axis 1 隐藏了这部分，很烦人）。XML 生成器非常简单。

在我看来，编码不需要很长时间，而且效率很高。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-04-28T14:19:22.373

由于没有人提到，这里还有一个：[Feign](https://github.com/OpenFeign/feign)，它是[Spring Cloud](https://cloud.spring.io/spring-cloud-openfeign/)使用的。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-01-13T12:48:14.760

尽管创建 HTTP 客户端并进行请求很简单。但是如果你想使用一些自动生成的客户端，你可以使用 WADL 来描述和生成代码。

您可以使用[RestDescribe](http://tomayac.de/rest-describe/latest/RestDescribe.html)生成和编译 WSDL，您可以使用它在 php、ruby、python、java 和 C# 中生成客户端。它生成干净的代码，并且有一个很好的更改，您必须在代码生成后对其进行一些调整，您可以在[此处](https://docs.google.com/document/edit?id=1uydmzsDFIiw8OsoMdk5v_s1VW7wrujUmGdUU2zge0fs)找到该工具背后的良好文档和基本思想。

在 Wintermute 中提到的有趣且有用的[WADL 工具很少。](http://wintermuteblog.blogspot.com/2010/01/wadl-toolbox.html)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-04-04T07:20:20.333

我编写了一个将 java 接口映射到远程 JSON REST 服务的库：

[https://github.com/ggeorgovassilis/spring-rest-invoker](https://github.com/ggeorgovassilis/spring-rest-invoker)

```
public interface BookService {
   @RequestMapping("/volumes")
   QueryResult findBooksByTitle(@RequestParam("q") String q);

   @RequestMapping("/volumes/{id}")
   Item findBookById(@PathVariable("id") String id);
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-09-23T10:43:07.970

jersey Rest 客户端示例：
添加依赖项：

```
 <!-- jersey -->
    <dependency>
        <groupId>com.sun.jersey</groupId>
        <artifactId>jersey-json</artifactId>
        <version>1.8</version>
    </dependency>
   <dependency>
        <groupId>com.sun.jersey</groupId>
        <artifactId>jersey-server</artifactId>
        <version>1.8</version>
    </dependency>

<dependency>
    <groupId>com.sun.jersey</groupId>
    <artifactId>jersey-client</artifactId>
    <version>1.8</version>
</dependency>

    <dependency>
    <groupId>org.json</groupId>
    <artifactId>json</artifactId>
    <version>20090211</version>
</dependency> 
```

ForGetMethod 并传递两个参数：

```
 Client client = Client.create();
           WebResource webResource1 = client
                        .resource("http://localhost:10102/NewsTickerServices/AddGroup/"
                                + userN + "/" + groupName);

                ClientResponse response1 = webResource1.get(ClientResponse.class);
                System.out.println("responser is" + response1); 
```

GetMethod 传递一个参数并获取 List 的响应：

```
 Client client = Client.create();

        WebResource webResource1 = client
                    .resource("http://localhost:10102/NewsTickerServices/GetAssignedUser/"+grpName);    
    //value changed
    String response1 = webResource1.type(MediaType.APPLICATION_JSON).get(String.class);

    List <String > Assignedlist =new ArrayList<String>();
     JSONArray jsonArr2 =new JSONArray(response1);
    for (int i =0;i<jsonArr2.length();i++){

        Assignedlist.add(jsonArr2.getString(i));    
    } 
```

在上面它返回一个 List ，我们将其作为 List 接受，然后将其转换为 Json Array ，然后将 Json Array 转换为 List 。

如果发布请求将 Json 对象作为参数传递：

```
 Client client = Client.create();
    WebResource webResource = client
            .resource("http://localhost:10102/NewsTickerServices/CreateJUser");
    // value added

    ClientResponse response = webResource.type(MediaType.APPLICATION_JSON).post(ClientResponse.class,mapper.writeValueAsString(user));

    if (response.getStatus() == 500) {

        context.addMessage(null, new FacesMessage("User already exist "));
    } 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-12-30T08:23:29.590

我大部分时间都使用[RestAssured](https://self-learning-java-tutorial.blogspot.com/2019/11/restassured-tutorial.html)来解析休息服务响应并测试服务。除了 Rest Assured，我还使用以下库与 Resful 服务进行通信。

一种。[泽西休息客户端](https://self-learning-java-tutorial.blogspot.com/2015/08/jersey-rest-client-api-tutorial.html)

湾。[弹簧休息模板](https://self-learning-java-tutorial.blogspot.com/2019/09/spring-resttemplate-tutorial.html)

C。[Apache HTTP 客户端](https://self-learning-java-tutorial.blogspot.com/2015/10/apache-http-client-tutorial.html)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-07-20T01:32:58.037

尝试查看 http-rest-client

[https://github.com/g00dnatur3/http-rest-client](https://github.com/g00dnatur3/http-rest-client)

这是一个简单的例子：

```
RestClient client = RestClient.builder().build();
String geocoderUrl = "http://maps.googleapis.com/maps/api/geocode/json"
Map<String, String> params = Maps.newHashMap();
params.put("address", "beverly hills 90210");
params.put("sensor", "false");
JsonNode node = client.get(geocoderUrl, params, JsonNode.class); 
```

该库为您处理 json 序列化和绑定。

这是另一个例子，

```
RestClient client = RestClient.builder().build();
String url = ...
Person person = ...
Header header = client.create(url, person);
if (header != null) System.out.println("Location header is:" + header.value()); 
```

最后一个例子，

```
RestClient client = RestClient.builder().build();
String url = ...
Person person = client.get(url, null, Person.class); //no queryParams 
```

干杯!

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-03-03T22:03:05.997

我目前正在使用[https://github.com/kevinsawicki/http-request](https://github.com/kevinsawicki/http-request)我喜欢它们的简单性和显示示例的方式，但大多数时候我在阅读时被卖掉了：

> 有什么依赖关系？
> 
> 没有任何。这个库的目标是成为一个带有一些内部静态类的单类类。测试项目确实需要 Jetty 来针对实际的 HTTP 服务器实现测试请求。

它解决了 java 1.6 项目的一些问题。至于将json解码成对象，[gson简直](https://github.com/google/gson)是无敌的:)

# excel - 从 Excel VBA 浏览文件

> ID：221444
> 
> 赞同：3
> 
> 时间：2008-10-21T10:51:52.857
> 
> 标签：excel, excel-2003, fileopendialog, vba

如何从 Excel 中运行的某些 VBA 中设置“文件打开”对话框？

我正在使用 Excel 2003。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T10:57:49.290

你想要这个`Application.GetOpenFilename`功能。从 VBA 对象浏览器复制：

> 函数 GetOpenFilename([FileFilter], [FilterIndex], [Title], [ButtonText], [MultiSelect])
> Excel.Application 的成员

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T10:57:43.797

添加对 ComDLG32.OCX 的引用，然后添加类似...

```
Sub PromptForFile()
Dim d As New MSComDlg.CommonDialog

d.Filter = "xls"
d.Filename = "*.xls"
d.ShowOpen

Excel.Workbooks.Open d.Filename

Set d = Nothing
End Sub 
```

# smtp - 如何为征求的促销电子邮件提供 smtp 服务器？

> ID：221446
> 
> 赞同：1
> 
> 时间：2008-10-21T10:52:30.313
> 
> 标签：smtp, blacklist

我有一个客户需要向他的联系人发送一些直接邮件，这些邮件是从贸易展览等中收集的。我正在考虑为他们提供一个基于 Web 的解决方案来发送直接邮寄材料——但是这种解决方案总是面临一个重大困难将服务器列入黑名单。我想知道是否有关于如何维护这样的 SMTP 服务器的建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T11:20:33.393

*   让您的 SMTP 服务器使用您的特定 DNS 名称响应 HELO/EHLO 命令，而不是通用 IP 或通用反转（是：mail.example.com；否：1.2.3.4、4-3-2-1.dsl.example.com )
*   具有与 HELO 响应匹配的反向 DNS（例如：nslookup mail.example.com -> 1.2.3.4，nslooup 1.2.3.4 -> mail.example.com）
*   确保除了合法用户之外没有人可以发送电子邮件，没有开放的中继或转发器！
*   正确发送强制电子邮件地址（滥用、邮递员和信息、IIRC），并且电子邮件的回复地址存在并定期检查（重复发送到死电子邮件地址可能会被列入黑名单）
*   检查双重选择是否用于互联网驱动的订阅
*   还要确保选择退出有效
*   有明确的免责声明

而且，以防万一： - 确保 SMTP 的 IP 地址与您的其他 SMTP 不同，这样万一出现故障，您仍然可以从其他帐户发送邮件！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T11:01:05.210

除了服务器（只需设置 exim 或 postfix 和一个 Web 界面来发送新闻通讯，并在 IP 地址与您自己的个人邮件服务器不同的服务器上执行此操作（甚至可能是不同的网络）），您将希望使您的使用条款和条件更加完善和严格，以便您可以删除任何对电子邮件提出投诉的客户对系统的访问权限。事实上，您可以强制所有发送的电子邮件必须是合法的（例如，有效的退订选项等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T12:50:16.207

雅虎有一些群发邮件的最佳实践指南。在将邮件发送到其他邮件服务器时，它们也是很好的一般最佳实践。

您可以在以下位置找到它们

[发送到 Yahoo! 时的最佳实践 邮件](http://help.yahoo.com/l/us/yahoo/mail/postmaster/postmaster-15.html)

[与 Yahoo! 建立 SMTP 连接的指南 邮件](http://help.yahoo.com/l/us/yahoo/mail/postmaster/postmaster-277515.html)

# c# - 我可以在 XAML（或代码旁）中定义跨容器 TabIndex 顺序吗

> ID：221452
> 
> 赞同：1
> 
> 时间：2008-10-21T10:54:09.327
> 
> 标签：c#, wpf, user-interface, .net-3.5, layout

```
Control.TabIndex 
```

只允许我覆盖给定容器中控件的 Tab 顺序。

有没有办法在所有控件中指定这一点，例如 UserControl，而不管用于排列控件的包含。

干杯，

简

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T15:57:34.333

我不确定是否有一种特别好的方法可以满足您的要求，但请查看[Change WPF focus in code](http://www.julmar.com/blog/mark/PermaLink,guid,6e4769e5-a0b3-47b2-a142-6dfefd0c028e.aspx "在代码中更改 WPF 焦点")。

这用于`KeyboardNavigation.TabNavigation`设置各种容器如何获取和放弃对选项卡的关注，并设置`TabIndex`每个控件的属性。查看`TabNavigation`设置为“继续”的示例代码。

如果您的标签问题很简单，您应该可以在这里找到解决方案，如果它们很复杂需要概括，那么可能需要更多的工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T17:22:09.257

这种焦点处理在 WPF 中是可怕的。最好的方法是让很多控件不接受 Focusable="False" 的焦点。

TabNavigation 答案将解决 tab 键，但是箭头键不会像你想要的那样工作。

# pdf - Ghostscript PDF -> TIFF 转换对我来说很糟糕，人们对此赞不绝口，我一个人看起来很闷闷不乐

> ID：221455
> 
> 赞同：11
> 
> 时间：2008-10-21T10:56:14.050
> 
> 标签：pdf, image-manipulation, tiff, ghostscript

当我看到这种输出时，我的胃在翻腾。

[http://www.freeimagehosting.net/uploads/e1097a5a10.jpg](http://www.freeimagehosting.net/uploads/e1097a5a10.jpg)

这是我的命令，正如[Best way to convert pdf files to tiff files所建议的那样](https://stackoverflow.com/questions/75500/best-way-to-convert-pdf-files-to-tiff-files#221341)

```
gswin32c.exe -q -dNOPAUSE -sDEVICE=tiffg4 -sOutputFile=a.tif a.pdf -c quit 
```

我究竟做错了什么？

（不考虑商业产品）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-21T11:21:07.620

tiffg4 是一个黑白输出设备。您应该使用 tiff24nc 或 tiff12nc 作为彩色 PDF 的输出设备 - 请参阅[ghostscript 输出设备](http://pages.cs.wisc.edu/~ghost/doc/AFPL/8.00/Devices.htm#TIFF)。这些将是未压缩的，但您可以通过 imagemagick 或类似方法将生成的 TIFF 重新保存为压缩的 TIFF。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-12-13T09:31:31.710

我使用 ImageMagick 已经有一段时间了。这是一个很好的工具，有很多功能。

安装[ImageMagick](https://www.imagemagick.org/script/download.php#windows)并运行以下命令。这是我在 Linux 上使用的，您可能需要更换`convert`为正确的。

以下命令将 PDF 转换为**CCITT Group 3**标准 TIF（传真标准）：

```
convert -define quantum:polarity=min-is-white \
        -endian MSB \
        -units PixelsPerInch \
        -density 204x196 \
        -monochrome \
        -compress Fax \
        -sample 1728 \
        "input.pdf" "output.tif" 
```

您也可以使用[GraphicsMagick](http://www.graphicsmagick.org/)，它也类似于 ImageMagick，但 ImageMagick 更关注质量而不是速度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-19T05:23:04.647

与建议的其他帖子一样，使用颜色格式（例如 -sDEVICE=tiff24nc）并指定更高的分辨率（例如 -r600x600）：

```
gswin32c.exe -q -dNOPAUSE -r600 -sDEVICE=tiff24nc -sOutputFile=a.tif a.pdf -c quit 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T11:58:46.920

传真非常好！;-)

如果您需要彩色副本，danio 的答案可能是最好的。

我还注意到，从链接的线程中，您省略了为输出指定 DPI，因此看起来很糟糕......如果您需要纯抖动的 B&W，您应该使用更高的分辨率。

[我还使用NConvert](http://pagesperso-orange.fr/pierre.g/xnview/en_nconvert.html "NConvert")得到了一个好看的图像

```
nconvert -page 1 -out tiff -dpi 200 -c 2 -o c.tif FMD.pdf 
```

我提到它是为了记录，因为我认为您需要许可证才能重新分发它（否则它是免费供个人使用的）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T04:50:35.147

谢谢大家，这就是我最终得到的

```
 os.popen(' '.join([
                       self._ghostscriptPath + 'gswin32c.exe', 
                       '-q',
                       '-dNOPAUSE',
                       '-dBATCH',
                       '-r800',
                       '-sDEVICE=tiffg4',
                       '-sPAPERSIZE=a4',
                       '-sOutputFile=%s %s' % (tifDest, pdfSource),
                       ])) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-05T18:24:09.310

setori 的命令没有指定用于*tiffg4*输出的分辨率。结果是：Ghostscript 将对该输出使用其默认设置，即 204x196dpi。

为了将分辨率提高到 600dpi，添加一个`-r600`命令行参数：

```
gswin32c.exe ^
   -o output.tiff ^
   -sDEVICE=tiffg4 ^
   -r600 ^
    input.pdf 
```

另请注意，TIFFG4 是标准传真格式，因此它仅使用黑白/灰度，但没有颜色。

**@jeff：**你有没有尝试过`-dDITHERPPI=<lpi>`Ghostscript 的参数？*（ lpi*的合理值是 N/5 到 N/20，其中 N 是 dpi 中的分辨率。因此请`-r600`尝试使用`-dDITHERPPI=30`to `dDITHERPPI=120`）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-01T19:54:33.047

我在传真页面上遇到了同样的问题。

我在 php 中使用了 Imagick，这个命令修复了它的外观。

```
$Imagick->blackThresholdImage('grey'); 
```

我没有看到任何使用“gs”的阈值选项，但转换也可能对您有用。

```
convert a.pdf -threshold 60% a.tif 
```

# c# - C#泛型问题

> ID：221467
> 
> 赞同：1
> 
> 时间：2008-10-21T11:01:46.007
> 
> 标签：c#, generics

我正在尝试从一本关于泛型的书中完成一个练习题，但这个问题对我来说没有意义。就这样吧。

创建两个具有相同功能的类。对第一个类使用泛型，并将第二个类转换为 Object 类型。创建一个使用类和基于对象的类的 for 循环来确定哪个性能更好。

我不确定强制转换为 Object 类型意味着什么。到目前为止，这是我的代码

```
 //Generic
    class Person<T> {

        T var1;

        public Person(T yer) {
            var1 = yer;
        }

        public T Value { get { return var1; } }
    }

    //Normal class
    class Human {

        int var1;

        public Human(int yer) {
            var1 = yer;
        }

        public int Value { get { return var1; } }
    } 
```

我的主程序运行循环

```
for (int i = 0; i < 1000000; i++) {
                Person<int> me = new Person<int>(1);
                int hey = me.Value;
            }

            for (int i = 0; i < 1000000; i++) {
                Human per = new Human(1);
                object her = (object)per.Value;
            } 
```

我不知道我这样做是否正确。请帮忙 ：-）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T11:07:31.220

我认为问题是要求您创建一个集合类，并将您的类的实例插入其中。

例如，

泛型版本：

```
List<Human> myList = new List<Human>();
Human h = new Human();
myList.Add(h); 
```

对象版本：

```
ArrayList myObjectList = new ArrayList();
Human h = new Human();
myObjectList.Add((object)h)); 
```

我还没有检查它是否编译，现在必须运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T11:17:20.717

我认为问题是循环遍历你的类集合。

**通用的**

```
List<Person> pList = new List<Person>();
for(int i = 0; i<1000; ++i)
    pList.Add(new Person(30));

StopWatch sw = new StopWatch();
sw.start();
int sum = 0;
foreach(Person p in pList)
    sum += p.Value;
sw.Stop(); 
```

**目的**

```
ArrayList hList = new ArrayList;
for(int i = 0; i<1000; ++i)
    hList.Add(new Human(30));

StopWatch sw = new StopWatch();
sw.start();
int sum = 0;
foreach(Object h in hList)
    sum += ((Human)h).Value;
sw.Stop(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T11:30:06.213

你被要求做的是在你的类中使用 Object，所以 Person<> 是完美的。您需要做的是更改 Human 以便 Var1 是一个对象。然后，无论您在何处使用 var1 将其转换为 int 或从 int 转换：

```
class Human 
{        
     object var1;
     public Human(int yer) 
     {            
          var1 = (object) yer;        
     }
     public int Value 
     { 
         get { return (int) var1;     }
     }    
} 
```

混淆来自于这个例子中的事实，var1 除了一个 int 之外真的不能是任何东西，所以它真的不是泛型的好候选者，并且在生产中应该像你最初编写 Human 一样编写。但正如我写的那样，这个练习没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T11:12:33.580

我认为你做对了，除了 for 循环。int 是一种对象类型，因此请替换

```
object her = (object)per.Value; 
```

和

```
int her = per.Value; 
```

您缺少的另一件事是一些性能计数器。看看 Timer 类，看看你可以做哪些事情来看看哪个表现更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T11:13:42.673

我不确定，但这听起来像是一个试图测试你对[装箱和拆箱](http://msdn.microsoft.com/en-us/library/yz2be5wk(VS.80).aspx)规则的知识的问题。

诠释 i = 123; 对象 o = (对象)i; // 拳击

然后可以将对象 o 拆箱并分配给整数变量 i：

o = 123; i = (int)o; // 拆箱

如果一个对象被装箱和拆箱，它会随着新对象的创建而变慢。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T11:15:22.500

是的，你做对了。对于纯 Object 实例，您无能为力，因为大多数运算符都无法处理它们。定义了四个公共方法：Equals、GetHashCode、GetType 和 ToString。我想你可以摆弄 Equals 看看这是否有什么不同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T11:24:51.403

好吧，如果我做得对，那么根据我的计数器（DateTime.Now.Ticks），我根本看不到性能上有任何差异。

如果我采用 endian 的方法，那么我可以看到性能影响在哪里。

让我们希望我的考试问题更清楚一点。

谢谢大家。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-13T08:26:02.463

`DateTime.Now.Ticks`我知道这是对这个问题的最新补充，但我完全使用了这段代码，并通过更新以下内容使其工作：

```
 DateTime t = DateTime.Now;
        for (int i = 0; i < 1000000; i++)
        {
            Person<int> me = new Person<int>(1);
            int hey = me.Value;
        }
        long a = DateTime.Now.Ticks - t.Ticks;
        TimeSpan A = new TimeSpan(a);

        for (int i = 0; i < 1000000; i++)
        {
            Human per = new Human(1);
            object her = (object)per.Value;
        }

        long b = DateTime.Now.Ticks - t.Ticks;
        TimeSpan B = new TimeSpan(b);

        Console.WriteLine(A.ToString());
        Console.WriteLine(B.ToString());
        Console.ReadLine(); 
```

性能有很大差异，因为泛型的速度大约是其两倍。

# asp.net - 如何防止下载运行而不是保存在 IE 中

> ID：221474
> 
> 赞同：1
> 
> 时间：2008-10-21T11:08:56.740
> 
> 标签：asp.net, internet-explorer

当您在网页上创建指向用于下载的可执行文件（例如 update.exe）的链接时，IE7 会为用户提供“运行”或“保存”选项。我不希望用户运行他们应该下载的更新文件。

是否可以禁用 IE 显示的对话框中的“保存”选项，甚至可以自动强制下载。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T11:18:30.963

编辑：对不起，我认为这段代码是不言自明的。鉴于 OP 将其标记为 ASP.NET，我认为我们处于 ASP.NET 的上下文中。

这应该放在链接到的代理文件中，而不是直接链接到 .exe 文件。然后代理文件发送 .exe 文件并强制（试图说服）浏览器强制下载文件，而不是直接运行它。

```
HttpContext.Current.Response.Buffer = false;
HttpContext.Current.Response.ClearContent();
HttpContext.Current.Response.ClearHeaders();
HttpContext.Current.Response.AddHeader("Content-disposition", "attachment; filename=filename.exe");
HttpContext.Current.Response.AddHeader("Content-length", contentLength);
HttpContext.Current.Response.AddHeader("Content-Transfer-Encoding", "binary");
HttpContext.Current.Response.ContentType = "application/octet-stream";
HttpContext.Current.Response.TransmitFile(filePath); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T11:16:39.983

下载行为内置在浏览器中。用户应该有选择权。无论如何它有什么区别？当用户选择“运行”时，文件被下载到一个临时位置并像用户已经下载并手动运行一样执行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T11:29:20.037

执行此操作的非技术方法是以相关对话框图像的形式输入下载说明，在保存按钮周围有一个友好的圆圈，以及一些告诉用户单击保存按钮的文本. 这将一切留给用户，而没有留给程序员。当试图实现这样的事情时，#1 问题是验证它是否真的有效。配置差异如此之大，以至于在所有情况下进行测试都变得不切实际，在这种情况下，任何解决方案都不能保证有效，这意味着花费的任何时间/金钱都是浪费。

此外，这意味着有一些非核心功能需要专业知识来维护。这是自找麻烦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T11:20:25.920

尝试在您正在使用的编程语言中添加等效项：

response.setHeader("Content-Disposition", "attachment;filename=...">

从服务器提供文件时。

编辑：将省略号 (...) 替换为您希望他们下载的文件。

编辑 2：为了澄清，不要直接服务器 fred.png，而是使用 fred.php，在该 php 文件中，生成自定义标头信息（包括 Content-Disposition）并将其与 fred.png 内容一起传递回去给客户。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T11:17:35.880

我只是在猜测，但您可以强制将 content-type 标头字段设置为默认值之外的内容。我见过“application/x-msdownload”，它可能会做你想做的事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T11:19:03.817

我能想到的唯一方法是通过组策略，如果它为此定义了一个选项。如果您可以控制最终用户计算机，那么这将是一个可行的解决方案，因此在 Intranet/加入域的环境中。

作为标准，您无法在 IE/HTM/HTTP 中使用任何东西来控制呈现给最终用户的 UI。您可以考虑一些替代解决方案/解决方法：

*   通过下载文件本身并因此要求保存文件的 ActiveX 交付可执行文件。
*   通过引导包装器交付最终的可执行文件，该包装器的功能与选择的运行/保存无关，并执行最终可执行文件本身的下载。

这两个选项几乎相同，但一个需要 ActiveX 并且仅是 IE，而另一个不需要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T11:20:34.017

您可以将您提供的文件重命名为 update.exe.safe 之类的文件，但是您会遇到让用户正确重命名文件的问题，以便他们可以双击它并发生一些事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T11:39:43.650

不知道为什么您不希望用户运行它，但也许您可以将 exe 放入 Zip 文件中：这是一种熟悉的格式，大多数用户知道如何在需要时提取文件。如果它是用于自动更新/安装（使用选项运行？），我想你可以在运行它之前解压缩。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-02-03T14:26:32.650

与 Mark S. Rasmussen 的反应类似。

您可能需要的是内容处置标头。这允许您提示用户保存文件。话虽如此，这取决于用户的浏览器。

[http://www.jtricks.com/bits/content_disposition.html](http://www.jtricks.com/bits/content_disposition.html)

# c# - 如何在不加载整行的情况下更新 LINQ 中的单个列？

> ID：221475
> 
> 赞同：7
> 
> 时间：2008-10-21T11:08:58.253
> 
> 标签：c#, linq, performance, linq-to-sql

在 LinqToSql 中，加载一行、更改一列并将更改提交到数据库非常简单：

```
using (MyDataContext wdc = new MyDataContext())
{        
  Article article = wdc.Article.First(p => p.ID == id);
  article.ItemsInStock = itemsinstock;
  wdc.SubmitChanges();
} 
```

唯一的缺点：文章很大。**要加载整篇文章，仅更新一列就太过分**了，而且会显着降低我的应用程序的速度。

有没有办法使用 LINQ 更新单个列，而不必加载整行？

现在我恢复使用速度至关重要的 ExecuteCommand ，但这很丑陋且容易出错：

```
wdc.ExecuteCommand("UPDATE Article SET ItemsInStock = @1 WHERE ID = @2", itemsinstock,id); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T11:41:38.890

您需要在 Article 类的所有属性上设置 UpdateCheck，除了主键（单击 LINQ2SQL 设计器中的类属性并切换到属性工具窗口）为 Never（不确定 WhenChanged，也许这也有效 - 继续尝试它！）。

这将强制 LINQ2SQL 使用

```
UPDATE ... SET ... WHERE ID = @2 
```

而不是 WHERE 子句中所有列的长版本：

```
 UPDATE ... SET ... WHERE ID = @2 AND ItemsInStock = @1 AND SomeOtherColumn = @3 AND... 
```

现在您可以使用类似的代码

```
context.Articles.Attach(article /* article with updated values */, new Article { ID = articleID, ItemsInStock = -1 } /* pretend that this is the original article */);
context.SubmitChanges(); 
```

基本上，您表明只有 ItemsInStock 属性已更改-其他道具应具有相同的默认值，articleID 当然是相同的。

注意：您不需要在此之前获取文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-01T10:21:24.770

ligget78 给了我另一个想法，如何更新单个列：

为这种更新创建一个新的DataContext，并且只将需要的列包含到这个DataContext中。

这样甚至不会加载不需要的列，当然也不会将其发送回数据库。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2011-07-22T11:23:14.870

它会正常工作 ExecuteCommand("UPDATE tIdx_TicketActivity SET Archive = {0} WHERE ExpiryTimeStamp

# eclipse - 如何删除旧版本的 Eclipse 插件？

> ID：221476
> 
> 赞同：34
> 
> 时间：2008-10-21T11:10:07.423
> 
> 标签：eclipse, plugins

更新后，旧的 Eclipse 插件保留在“plugins”文件夹中（“features”文件夹中也有剩余）。

有没有办法自动删除这些？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-04-08T08:46:33.137

要摆脱旧插件，您必须清除安装历史记录。转到帮助 | 关于日食 | 安装细节 | 安装历史并选择所有旧的东西。然后单击删除并重新启动。瞧。这适用于 Eclipse Helios (3.6)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2018-09-30T10:34:50.353

我使用以下命令：

```
eclipse -application org.eclipse.equinox.p2.garbagecollector.application -profile epp.package.jee 
```

**笔记：**

1.  这记录在[Equinox/p2/FAQ](https://wiki.eclipse.org/Equinox/p2/FAQ#Why_aren.27t_bundles_being_removed_when_their_associated_feature_has_been_removed.3F)中，请参阅“为什么在删除相关功能后不删除捆绑包？”

    常见问题解答引用[了 Eclipse 社区论坛主题](http://www.eclipse.org/forums/index.php?t=msg&goto=543500)“功能卸载后插件 jar 仍然存在”（2010 年 6 月）作为本秘籍的来源。

    该配方现在仍然有效，使用 Eclipse 4.8 Photon。

2.  该`-profile`参数取决于您使用的 Eclipse IDE 的包装。上面的 ( `epp.package.jee`) 是针对“Eclipse for Java EE Developers”的。我在文件中找到它`configuration/config.ini`。相关行如下：

    ```
    eclipse.p2.profile=epp.package.jee 
    ```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-06-04T08:22:46.637

我也想删除旧插件，但今天仍然没有找到答案，所以我写了一个快速而肮脏的脚本`guess-old-eclipse-plugins.sh`来处理旧插件。

该脚本将扫描 Eclipse 目录下的 plugins 目录。并将生成一个`remove-old-eclipse-plugins.txt`可用于删除旧插件的文件。

此脚本在 Windows XP 上的 Cygwin 1.7.15 下测试。

# 猜测-老-eclipse-plugins.sh

```
PluginsDir=plugins
FeaturesDir=features
PluginIDSeparator=_
RemovingScriptFileName=remove-old-eclipse-plugins.txt
rm -rf $RemovingScriptFileName

#for dir in $PluginsDir $FeaturesDir
for dir in $PluginsDir  # $FeaturesDir: most file names in features dir contains more than 1 _ character
do
    echo "Processing [$dir] directory..."
    # split PluginID from filename
    # (not reliable, but general working. (ex: will get one junit PluginID because there're move than 1 _ characters in file name))
    file_list=$(ls $dir);
    echo "$file_list" | cut -f1 -d $PluginIDSeparator         > $dir-all.txt
    echo "$file_list" | cut -f1 -d $PluginIDSeparator  | uniq > $dir-uniq.txt

    # get the PluginList which VERY POSSIBLY has old versions
    diff_result=$(diff -U 0 $dir-uniq.txt $dir-all.txt)
    plugins_which_has_old_versions=$(echo "$diff_result" | grep -e "^+[^+]" | cut -f 2 -d +)

    #
    for p in $(echo "$plugins_which_has_old_versions")
    do
        echo "$p"
        i=0
        for f in $(ls -d -t $dir/$p$PluginIDSeparator*) # use 'ls' command, can sort result by file time, but can not handle file name contains special characters (white space) when using wildcard
        #for f in $(find $dir -name "$p$PluginIDSeparator*")    # use 'find' command
        do
            if [ -d $f ]
            then
                # should use rm -rf
                echo -n "[D]"
            else
                echo -n "   "
            fi
            echo -n "$f"

            ((i++))
            if [ $i -eq 1 ]
            then
                echo ""
                continue    # first file, the newest version
            fi
            echo "    [old]"
            echo "rm -rf $f" >> $RemovingScriptFileName
        done

        echo
    done
done 
```

# 重要通知

在使用生成的`remove-old-eclipse-plugins.txt`文件删除插件之前，请确保其中列出的所有插件都是**真正**的旧插件。因为，此脚本无法处理包含超过 1 个`_`字符的文件名。例如：JUnit v3 和 v4 插件是 2 个*不同*的插件，但脚本会将其视为**相同**的插件，因为这 2 个文件名使用相同`org.junit_`的前缀。

```
org.junit
[D]plugins/org.junit_3.8.2.v3_8_2_v20100427-1100
[D]plugins/org.junit_4.8.2.v4_8_2_v20110321-1705    [old]  <-- wrong 
```

因此，**请非常小心**地使用它，在使用之前删除错误的部分，否则您的 Eclipse IDE 可能无法正常工作。

# 样本输出

```
$ ./guess-old-eclipse-plugins.sh
Processing [plugins] directory...
org.eclipse.gef
   plugins/org.eclipse.gef_3.7.2.v20111106-2020.jar
   plugins/org.eclipse.gef_3.6.2.v20110110-2020.jar    [old]

org.eclipse.help.base
   plugins/org.eclipse.help.base_3.6.2.v201202080800.jar
   plugins/org.eclipse.help.base_3.5.3.v201102101200.jar    [old]

org.eclipse.help.ui
   plugins/org.eclipse.help.ui_3.5.101.r37_20110819.jar
   plugins/org.eclipse.help.ui_3.5.3.r36_20101116.jar    [old]
... 
```

# 示例生成的脚本

```
rm -rf plugins/org.eclipse.gef_3.6.2.v20110110-2020.jar
rm -rf plugins/org.eclipse.help.base_3.5.3.v201102101200.jar
rm -rf plugins/org.eclipse.help.ui_3.5.3.r36_20101116.jar
rm -rf plugins/org.eclipse.help.webapp_3.5.3.r36_20101130.jar
rm -rf plugins/org.eclipse.jdt.apt.core_3.3.402.R36_v20110120-1000.jar
rm -rf plugins/org.eclipse.jdt.debug.ui_3.5.2.v20100928a_r362.jar 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-03-04T08:57:07.553

删除旧插件总是很麻烦。特别是当您升级并且您的 Eclipse 不想重新启动并且您需要通过插件依赖项的元数据地狱来解决它时。

我看到你们中的几个人试图通过脚本来解决这个问题。

# Eclipse 插件清理器

好吧，我创建了一个**基于 java 的工具**（**带有测试，由 maven 构建并托管在 github，所以你可以自由地分叉它**），它通过内省清单文件（或文件名，如果清单不完整或损坏）检查插件的重复性.

# 现在

例如，您可以很容易地下载最新的 Eclipse 并将旧的 Eclipse 放入`dropins/eclipse`文件夹，该工具将清理 dropins 文件夹 - 因此您的新包被保留并删除旧包（`dropins`如果 2 个或更多相同，则首选删除该文件夹找到版本）。

有关**Eclipse 插件清洁器**的更多信息，请访问[https://github.com/azachar/eclipse-plugin-cleaner](https://github.com/azachar/eclipse-plugin-cleaner)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-11-20T03:29:36.927

而不是排序等，解决方案应该基于`bundles.info`.

手动解决方案：

*   创建一个副本`eclipse/configuration/org.eclipse.equinox.simpleconfigurator/bundles.info`
*   编辑
*   搜索正则表达式：`.*plugins/([^,]*),.*`，替换为：（`$1`例如使用**Notepad++**）
*   去`eclipse/plugin/`
*   选择此新文件中列出的文件和文件夹（例如在**Total Commander**中：*Mark > Load Selection From File*）
*   反转选择
*   删除/移动选定的文件和文件夹

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-07-16T12:53:09.223

我修改了脚本以允许所有插件、功能和插件。首先，它依靠反向排序来猜测最新的规范插件版本。

接下来，它将合格的插件版本名称简化为规范的插件 sed 表达式。如果插件是这个表达式的第一个匹配项，它会存储它的模式并保留它，否则它是一个旧的过时版本，它会将它标记为删除。

```
# scan_old_plugins.sh

# script to scan for duplicate old eclipse features, plugins and dropins
# generates a "clean-old-plugins.sh" script to clean old versions.
# warning: DANGEROUS! review clean-old-plugins script before running it.

DropinsDir=dropins
FeaturesDir=features
PluginsDir=plugins

CanonicalPluginsFile=sed_canonical_plugins.sh
CleanPluginScriptFile=clean_old_plugins.sh

echo "" > $CanonicalPluginsFile
echo "" > $CleanPluginScriptFile

#for dir in $PluginsDir
for dir in $FeaturesDir $PluginsDir $DropinsDir
do
    echo "Processing [$dir] directory..."
    # 
    file_list=$(\ls -1 $dir | sort -r);
    echo "$file_list" > $dir-all.txt

    #
    for p in $(echo "$file_list")
    do
        v=$(echo $p | sed -e 's/_[0-9\._\-]*/_.*/g' | sed -e 's/[0-9][0-9]*/.*/g')
        g=$(grep -l "$v" $CanonicalPluginsFile | head -1 | awk '{print $1}')
        if [ "$g" = "" ]; then
            echo "$p=keep";
            echo "$v=$p" >>  $CanonicalPluginsFile
        else
            echo "$p=stale";
            echo "rm -rf $p" >> $CleanPluginScriptFile
        fi

    done
done 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-02-24T14:42:17.530

对我来说，这有效：

```
eclipse -application org.eclipse.equinox.p2.garbagecollector.application -profile SDKProfile 
```

经过测试的 Eclipse v4.9。删除我的插件的旧版本。其他解决方案中提到的配置文件`epp.package.jee`为我返回“不存在”。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-21T14:02:31.320

使用 Ganymede (3.4)，管理插件的正确方法是将它们放在“ **dropins** ”文件夹中：

```
\[eclipse\]/dropins/eclemma1.3.1/eclipse/(plugins|features) 
```

该插件将被“p2”配置机制检测并使用，但***不会复制到 eclipse 的插件和功能目录中***。它保留在 dropins 文件夹中。

当您删除 eclemma1.3.2 时，您所要做的就是从您的 dropins 目录中删除 eclemma1.3.1，旧版本就消失了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T13:44:23.133

Eclipse 允许您恢复到任何以前的配置（转到“帮助”菜单，然后转到“软件更新”）。我的猜测是 Eclipse 不会删除这些旧版本，否则这个功能将不再起作用。

如果重新启动 Eclipse 时提供“-clean”参数，它会执行各种清理操作，但由于上述原因，我认为它不会删除旧插件/功能。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-05-20T21:55:58.457

我在 python 中创建了一个脚本来将旧插件移动到备份文件夹，所以如果出现问题，它可以返回。该脚本有两种操作模式：手动模式询问您如何处理检测到的每个重复插件，并且仅在字符串长度已更改并因此可能已更改系统或版本编号的情况下自动询问。

我希望这可以帮助别人

```
# -*- coding: utf-8 -*-
import os
import re
from datetime import datetime

directory="C:\\eclipse64\\plugins"
dirBackup="C:\\eclipse64\\PluginsBackup"        #This folder is a kind of recycle bin for save deleted plugins. In case you have problems running eclipse after remove them you can restore them. If you don't detect any problem you can erase this folder to save disk space
manual=False    #Verifying deletion of each plugin manually (True) or automatic (False) 

def globRegEx(directory,pat,absolutePath=True,type_=0):
    '''Function that given a directory and a regular pattern returns a list of files that meets the pattern

    :param str directory: Base path where we search for files that meet the pattern
    :param str pat: Regular expression that selected files must match 
    :param bool absolutePath: Optional parameter that indicates if the returned list contains absolute (True) or relative paths (False)
    :param int type_: Type of selection 0: selects files and directories 1: only selects files 2: only selects directories
    :return: a list with the paths that meet the regular pattern
    '''
    names=os.listdir(directory)
    pat=re.compile(pat)
    res=[]

    for name in names:
        if pat.match(name):
            path=directory+os.sep+name

            if type_==1 and os.path.isfile(path):
                res.append(path if absolutePath else name)
            elif type_==2 and os.path.isdir(path):
                res.append(path if absolutePath else name)
            elif type_==0:
                res.append(path if absolutePath else name)

    return(res)

def processRepeated(repList):
    ''' this function is responsible for leaving only the newer version of the plugin
    '''

    if repList and len(repList)>1:     #If the plugin is repeated
        repList.sort(reverse=True)
        print("Repeated plugins found:")
        min=len(repList[0])    # If strings haven't got the same length indicates a change in the numeration version system
        max=min
        newer=datetime.fromtimestamp(0)
        sel=0

        for i,path in enumerate(repList):
            lr=len(path)
            modifDate=datetime.fromtimestamp((os.path.getctime(path)))
            if modifDate>newer:     #Keep the last creation date and its index
                newer=modifDate
                sel=i+1

            if lr<min: 
                min=lr
            elif lr>max: 
                max=lr

            print(str(i+1) + " " + modifDate.strftime("%Y-%m-%d") + ": " + path)
        print(" ")

        if manual or min!=max:      #If manual mode is enabled or if there is a string length diference between different version of plugins
            selec=raw_input("Which version do you want to keep?: ["+str(sel)+"] ")
            if selec:
                selec=int(selec)
            else: 
                selec=sel   #Newer is the Default value
        else:
            selec=1

        del(repList[selec-1])      #Delete selected plugin from the list

        for path in repList:  #Move the rest of the list to the backup folder
            print("Deleting: "+ path)
            os.renames(path,os.path.join(dirBackup,os.path.basename(path)))

        print("-------------------------------------\n\n")

def main():

    filePlugins=globRegEx(directory,"^.*$",False,1)      #Creates a list with all the files only
    dirPlugins=globRegEx(directory,"^.*$",False,2)       #Creates a list with all the folders only

    #Process files first

    for plugin in filePlugins:
        m=re.match(r"(.*_)\d.*?\.jar$",plugin)   #Creates the glob pattern
        if m:
            patAux=m.groups()[0]+".*?\.jar$"
            find=globRegEx(directory,patAux,True,1)
            processRepeated(find)

    #Now Directories 

    for plugin in dirPlugins:
        m=re.match(r"(.*_)\d.*$",plugin)   #Creates the glob pattern
        if m:
            patAux=m.groups()[0]+".*$"
            find=globRegEx(directory,patAux,True,2)
            processRepeated(find)

if __name__=="__main__":
    main() 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-06-21T16:29:18.933

最简单、干净、高效的解决方案是简单地删除当前的 Eclipse 安装并安装最新的 Eclipse 版本（或重新安装当前版本）。

*   关键是通过 zip 包而不是安装程序或**Install / Update**来安装 Eclipse 。
*   见：[https ://www.eclipse.org/downloads/packages/](https://www.eclipse.org/downloads/packages/)
*   例如，面向企业 Java 和 Web 开发人员的 Eclipse IDE：`eclipse-java-2021-06-R-win32-x86_64.zip`
*   注意：所有 Eclipse 用户首选项都会保留，因为它们都存储在您的 Eclipse 工作区中。

### 脚步

*   (1)手动删除`eclipse`包含当前Eclipse安装的现有目录
*   (2) 下载最新的Eclipse IDE zip文件
    *   [https://www.eclipse.org/downloads/packages/](https://www.eclipse.org/downloads/packages/)
*   (3)将最新的Eclipse IDE zip文件解压到`eclipse`目录下
*   (4) 启动最新的Eclipse IDE
*   (5) 选择你现有的 Eclipse 工作区
*   (6) 提示时执行 Eclipse 工作区迁移
    *   注意：如果偏执，请备份工作空间（在此步骤之前）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-08-23T10:37:46.293

对于 STM32CubeIDE（一种流行的基于 Eclipse 的 STM32 微控制器系列的 IDE），此命令确实清理了 Windows 10 下的旧插件版本：

```
"C:\ST\STM32CubeIDE_1.3.0\STM32CubeIDE\eclipsec" -application org.eclipse.equinox.p2.garbagecollector.application -profile STM32CubeIDE 
```

# c++ - 使用 C/C++ 进行单元测试：经验教训，要记住什么？

> ID：221482
> 
> 赞同：8
> 
> 时间：2008-10-21T11:14:45.947
> 
> 标签：c++, unit-testing, tdd

使用 C/C++ 进行单元测试：你教那些以前没有做过单元测试或者来自 Java/Junit 的人什么？

从您的角度来看，最重要的课程/要记住/练习的事情是什么，可以节省大量时间或压力（尤其是关于 C/C++）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T11:41:45.800

1.  单元测试必须在每次签入时自动运行（或者，编写然后忘记的单元测试不是单元测试）。
2.  在修复错误之前，编写一个单元测试来公开它（它应该会失败）。然后修复错误并在测试变为绿色时欢欣鼓舞。
3.  为了更容易测试而牺牲一个类的一些“美”是可以的（比如提供不应该真正公开的公共方法，但有助于您的测试/模拟）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T11:47:29.453

读这个......无论如何你都会...... ![替代文字](https://i.stack.imgur.com/iaN6v.jpg)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T16:57:52.387

我反对所有这些自动授予测试类友谊的建议......

就我个人而言，我更喜欢关注以下内容，以允许我访问我需要测试的类的内部：

1.  尽可能依赖类的公共接口；有时这意味着稍微扩展公共接口以便于测试。不要过多地与这些扩展作斗争，但也不要让它们过多地驱动你的设计......
2.  考虑添加一个可供“真实”代码和测试代码使用的监控接口，以启用对被测代码的监控。（我仍然惊讶于这是设计过程中非常好的一部分）。
3.  考虑通过“受保护的接口”向派生类提供对类的某些部分的访问，并派生相关类的“可测试”版本，然后可以对其进行检测和测试。

总而言之，我更喜欢看到在测试点中设计，而不是与测试类建立全面的友谊。当然，前者比后者更难做，但恕我直言，会产生更好的代码和更好的测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T12:04:33.197

我想改写 ripper234 并添加更多规则：

1.  每个模块（通常是 DLL 项目）都应该有单独的 UT 项目。所有 UT 类都应该是它们需要从中访问私有方法/成员的所有 DLL 类的朋友。
2.  如果你想改变模块 - 首先改变 UT。在签入前确保 DLL 及其 UT 编译、链接和 UT 运行时没有崩溃和故障。每次签入之前无需为所有模块运行所有 UT - 这是浪费时间。
3.  所有 UT 应与所有 DLL 一起在夜间构建中自动重建。所有 UT 和模块都应该在构建期间编译和链接。
4.  夜间构建成功后应自动运行所有 UT，并汇总结果。
5.  应将包含所有 UT 结果的摘要发布给开发人员，如果出现任何故障或崩溃，应尽快予以纠正。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T13:44:42.387

在处理没有测试的遗留代码库的情况下，您很可能会开始（正如我必须这样做的）使用单元测试框架进行实现的功能测试。不要惊慌——您的代码是如此相互关联，以至于可能无法编写适当的单元测试。也不要自满——一旦功能测试到位，您需要重构以便真正的单元测试成为可能。你的代码会更好！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T13:23:05.080

最重要的一课：有考试总比没有考试好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T13:37:57.687

一个单元测试用例应该只测试一件事。

与 C# 和 Java 相比，我在 C/C++ 中更经常看到单元测试用例测试整个工作流程。

可能是因为大多数 C/C++ xUnit 框架需要几个步骤来注册一个测试用例，所以在添加新功能时只向现有测试用例添加几行的诱惑更高。

# c# - 从 DataGridView 中的自定义编辑控件引发 CellValueChanged

> ID：221490
> 
> 赞同：4
> 
> 时间：2008-10-21T11:17:43.353
> 
> 标签：c#, winforms, datagridview

我有一个 DataGridView (WinForms)，我在其中定义了一个从 DataGridViewTextBoxEditingControl 派生的自定义 EditingControl，它只允许数字字符。

每次用户按键时，我都需要在 DataGridView 上引发 CellValueChanged 事件，但默认行为是仅在编辑完成时引发事件。

每次按下键时如何引发事件？

```
public class DataGridViewNumericTextBoxEditingControl : DataGridViewTextBoxEditingControl
{
    protected override void OnKeyPress(KeyPressEventArgs e)
    {
        e.Handled = Char.IsLetter(e.KeyChar);
        if (!e.Handled)
            RaiseDataGridViewCellValueChanged(); // <-- Any way?
    }
} 
```

**更新：**

我找到了一种解决方法，但我不确定这是一个好的解决方案：

```
public class DataGridViewNumericTextBoxEditingControl : DataGridViewTextBoxEditingControl
{
    protected override void OnKeyPress(KeyPressEventArgs e)
    {
        e.Handled = Char.IsLetter(e.KeyChar);
        if (!e.Handled)
        {
            EditingControlDataGridView.EndEdit();
            EditingControlDataGridView.BeginEdit(false);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T18:25:59.213

这里的目标是什么？您似乎正在尝试创建一个键盘掩码，其中任何非确认字符都会引发警报？如果是这样，您可能会通过添加 MaskedTextBoxColumn 在 DataGridView 中找到快乐。MaskedTextBoxColumn 以比强制编辑提交更合理的方式控制输入。

请参阅此处了解如何使用它的代码：http: [//msdn.microsoft.com/en-us/library/ms180996.aspx](http://msdn.microsoft.com/en-us/library/ms180996.aspx)

根据您在评论中更新的标准，听起来您的解决方案可能与它所能获得的一样好。但是要意识到，当您有其他控件根据键盘事件更新到另一个控件时，*很*容易进入无限事件循环。您可能最好在表单上拥有一个处理所有事件的委托，因为它可以通过丢弃基于状态的虚假事件来防止事件触发器的无限循环。

实际上，这将使用 Model View Presenter 模式，您的委托充当演示者并管理您的视图（您的 UI）上的流量。

这样做，您甚至可以将 Presenter 逻辑移动到一个新类中，然后将数据绑定到该类中，从而允许您从一个逻辑结构而不是事件处理程序的大杂烩中完全控制 UI。

# vb6 - Vb 6 使.exe 对调试器产生不同的结果

> ID：221502
> 
> 赞同：1
> 
> 时间：2008-10-21T11:20:52.270
> 
> 标签：vb6

我正在比较使用“Make .exe”时产生的结果，与通过 IDE vb 6 调试器使用完全相同的变量运行完全相同的进程时产生的结果。

我尝试了一系列不同的编译器选项，但无济于事。

所以我的问题是为什么我会在调试器和“Make .exe”之间有所不同？你有没有遇到过类似的事情，如果有，你找到解决办法了吗？

*该程序在一个时间段内获取大量汽车计数文件，并将每条路线一个月内一天的时间平均为 15 分钟。它消除某些记录取决于是否存在超出标准偏差和其他统计算法的值来消除值。不幸的是，要发布的代码有点多...*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T12:11:42.557

`Debug.Assert`和`Debug.Print`Statement 不会编译到二进制文件中。我有时使用它来检测我是在 IDE 中还是在编译的二进制文件中：

```
出错时继续下一步
调试.打印 1/0
如果 Err=0 则
  '编译二进制
别的
  '在IDE中
万一

```

小心这样的陈述：

```
Debug.Assert( DoSomeThingImportend() ) 
```

在编译版本中，该语句不会被执行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T12:20:09.437

我发现在某些（非常罕见的）情况下，VB6 的编译和调试代码可能存在差异。

可能值得尝试“编译为 P 代码”选项 - 有时这会产生与本机代码略有不同的结果。您可以在项目属性/编译选项卡中找到它。

如果您发布您的算法，我们可能会找到更多的可能性。

编辑：由于您不能发布算法，我建议逐步分解算法并尝试找出差异的确切位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-12T14:10:21.670

编译的调试版本之间的大多数时间差异来自时序问题，调试版本稍慢并且可能会错过一些其他初始化的值，或者没有等待足够长的时间来完成另一部分过程

您可以通过在代码的各个部分之间添加一些暂停来测试这一点，通常额外的 DoEvent 可以解决问题，或者让一些 msgbox 弹出（然后您还可以将编译版本的中间结果与调试版本进行比较）

尝试找出计算的哪一部分给出了错误的结果，并将该部分分成一个单独的函数

通常差异直接发生在开始时（没有时间初始化），或者在过程中的某个地方直到结束（在另一个进程上运行）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-13T20:33:17.880

VB 6 在编译一致性方面非常可靠。但是一种可能性可能是，如果您以任何方式依赖事件并使用 doevents 来让步。

这种组合在 IDE 与编译代码中的行为可能完全不同。

我猜你不是，但是，嘿，需要检查一下。

# c# - IUsable：以比 IDisposable 更好的方式控制资源

> ID：221503
> 
> 赞同：1
> 
> 时间：2008-10-21T11:20:54.797
> 
> 标签：c#, .net, language-features

我希望我们在 C# 中有“可用”模式，当 using 构造的代码块将作为委托传递给函数时：

```
class Usable : IUsable
{
  public void Use(Action action)  // implements IUsable
  {
    // acquire resources
     action();
    // release resources
  }
} 
```

在用户代码中：

```
using (new Usable())
{
  // this code block is converted to delegate and passed to Use method above
} 
```

优点：

*   受控执行，异常
*   使用“可用”的事实在调用堆栈中可见

缺点：

*   委托费用

你认为它是否可行和有用，如果从语言的角度来看它没有任何问题？有没有你能看到的陷阱？

编辑：大卫施密特[提出](https://stackoverflow.com/questions/221503/iusable-controlling-resources-in-a-better-way-than-idisposable#221522)以下

```
using(new Usable(delegate() {
    // actions here
}) {} 
```

它可以在这样的示例场景中工作，但通常您已经分配了资源并希望它看起来像这样：

```
using (Repository.GlobalResource) 
{ 
  // actions here 
} 
```

GlobalResource（是的，我知道全球资源不好）实现 IUsable 的地方。你可以重写的时间很短

```
Repository.GlobalResource.Use(() =>
{
  // actions here
}); 
```

但它看起来有点奇怪（如果你显式地实现接口，那就更奇怪了），而且这种情况在各种风格中都很常见，我认为它应该成为一种语言中的新语法糖。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T11:37:05.153

恕我直言，我看不出这种模式有什么用处，因为：

1.  using 块已经要求对象具有 IDisposable 接口，因此我们可以使用 IDisposable 接口进行受控执行
2.  我们从哪里传递 Action 对象？

我已经使用 IDisposable 成功地将这种模式用于数据库操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T13:41:54.857

关于什么：

```
class Usable<T> where T : ICriticalResource, new()
{
    static void Do(Action<T> action) {
        ICriticalResource resource = new T();
        resource.Acquire();
        action(resource);
        resource.Relese();
    }
} 
```

然后将它用于实现 ICritialResource 的所有内容。

```
Usable<SomeResource>.Do(resource => resource.SomeMethod()); 
```

另一种选择是按原样使用 IDisposable。是的，它可能没有它应该的那么优雅，但至少大多数人已经习惯了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T11:32:08.270

通过使用这样的匿名委托，您已经可以拥有大部分内容：

```
using(new Usable(delegate() {
    // actions here
}) {} 
```

当然，将它包装在某个函数中，或者直接实现 try/finally 可能会使它不仅有用，而且甚至有点漂亮。

# hibernate - 休眠：检查对象是否存在

> ID：221514
> 
> 赞同：29
> 
> 时间：2008-10-21T11:26:26.563
> 
> 标签：hibernate

假设类型*A*的对象存储在 DB 中。这是我使用休眠从数据库加载特定的方式：

```
org.hibernate.Session session = ...;
long id = 1;
A obj = session.load(A.class, id); 
```

如果 id=1 的对象不存在，我将得到*ObjectNotFoundException*。但是有没有办法检查这样的对象是否存在而不必捕获异常？我想要的是：

```
org.hibernate.Session session = ...;
long id = 1;
boolean exists = session.exists(A.class, id);
if(exists){
 // do smth.....
} 
```

找不到它休眠文档...

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2011-07-22T21:16:42.287

您可以使用**HQL**来检查对象是否存在：

```
public Boolean exists (DTOAny instance) {
    Query query = getSession().             
    createQuery("select 1 from DTOAny t where t.key = :key");
        query.setString("key", instance.getKey() );
    return (query.uniqueResult() != null);
} 
```

*如果没有找到数据，*Hibernates* **uniqueResult()方法返回 null。**通过使用 HQL，您可以创建更复杂的查询标准。*

 ** * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-21T11:34:18.450

您可以使用`session.get`：

```
public Object get(Class clazz,
                  Serializable id)
           throws HibernateException 
```

如果对象在数据库中不存在，它将返回 null。[您可以在Hibernate API 文档](http://www.hibernate.org/hib_docs/v3/api/ "休眠 API")中找到更多信息。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2015-06-02T13:59:26.943

**休眠**

仅获取键以获得最佳性能：

```
public boolean exists(Class clazz, String idKey, Object idValue) {
    return getSession().createCriteria(clazz)
            .add(Restrictions.eq(idKey, idValue))
            .setProjection(Projections.property(idKey))
            .uniqueResult() != null;
} 
```

**JPA**

由于 Hibernate 是 JPA 的实现，因此可以[注入](https://docs.oracle.com/cd/E16439_01/doc.1013/e13981/usclient005.htm)EntityManager。此方法还具有良好的性能，因为它[延迟获取](http://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html#getReference-java.lang.Class-java.lang.Object-)实例：

```
public boolean exists(Class clazz, Object key) {
   try {
      return entitymanager.getReference(Entity.class, key) != null;
   } catch (EntityNotFoundException.class) {
      return false;
   }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-02-23T00:20:11.353

@Journeycorner 的一点简化方法

```
public boolean exists(Class<?> clazz, Object idValue) {
    return getSession().createCriteria(clazz)
            .add(Restrictions.idEq(idValue))
            .setProjection(Projections.id())
            .uniqueResult() != null;
} 
```

下面的方法也很有用。请记住，此方法只能用于生成不超过一条记录的条件（如`Restrictions.idEq()`条件）

```
public static boolean uniqueExists(Criteria uniqueCriteria) {
    uniqueCriteria.setProjection(Projections.id());
    return uniqueCriteria.uniqueResult() != null;
} 
```

# linq - Linq to XML 'Where not in' 语法问题

> ID：221519
> 
> 赞同：0
> 
> 时间：2008-10-21T11:30:38.600
> 
> 标签：linq, linq-to-xml, linq-to-objects

以下代码无法编译

```
Dim BasicGroups As String() = New String() {"Node1", "Node2"}
Dim NodesToRemove = From Element In SchemaDoc.Root.<Group> _
                    Where Element.@Name not in BasicGroups
For Each XNode In NodesToRemove
    XNode.Remove()
Next 
```

它应该删除根节点的任何直接子节点，该子节点具有名为 name 的属性，其值**未**在 BasicGroups StringArray 中列出。

**此任务的正确语法是什么？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T12:05:26.673

您可能想要移动“不”部分。例如（伪代码）

```
where (not (list.Contains(foo)) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T12:07:23.563

如果要删除的节点的 Name 属性可以使用简单的模式进行匹配，则以下内容应该有效：

```
Dim SchemaDoc As New XDocument(<Root><Group Name="Foo"/><Group Name="Node1"/>
                           <Group Name="Node2"/><Group name="Bar"/></Root>)
Dim NodesToRemove = From Element In SchemaDoc.<Root>.<Group> Where _
                           Element.@Name Like "NotNode?"
For Each XNode In NodesToRemove.ToArray()
  XNode.Remove()
Next 
```

请注意在 NodesToRemove 枚举中使用 ToArray()：在开始修改它所基于的集合之前，您需要它来强制评估 XQuery。

如果这不起作用，这里是使用 LINQ 的替代方法（因为最初我认为在 LINQ 查询中插入'not'是行不通的，但我被另一个答案直接设置了——你每天都会学到新东西...... ):

```
Dim NodesToRemove As New Collections.ObjectModel.Collection(Of XNode)
For Each Element In SchemaDoc.<Root>.<Group>
  If Not BasicGroups.Contains(Element.@Name) Then
    NodesToRemove.Add(Element)
  End If
Next 
```

性能应该与使用 LINQ 几乎相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-29T21:59:57.270

也许你可以尝试这样的事情

mylistWithOutUndesirebleNodes = (from b in NodeLists.Cast() where (from c in NodesToDeleteList.Cast() where c.Attributes["atributo"].Value == b.Attributes["atributo"].Value select c).Count( ) == 0 选择 b).ToList();

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-29T22:24:31.157

```
Dim NodesToRemove = From Element In SchemaDoc.Root.<Group> _
                    Where Not BasicGroups.Contains(Element.@Name) 
```

# c# - 为什么 ^*$ 匹配“127.0.0.1”

> ID：221520
> 
> 赞同：9
> 
> 时间：2008-10-21T11:31:09.970
> 
> 标签：c#, regex

我不明白，为什么下面的正则表达式：

```
^*$ 
```

匹配字符串“127.0.0.1”？使用`Regex.IsMatch("127.0.0.1", "^*$");`

使用 Expresso，它不匹配，这也是我所期望的。使用表达式`^.*$`确实匹配字符串，这也是我所期望的。

从技术上讲，`^*$`应该多次匹配字符串/行的开头，然后是字符串/行的结尾。似乎 * 被隐含地视为`.*`

我错过了什么？

编辑：运行以下命令以查看问题的示例。

```
using System;
using System.Text.RegularExpressions;

namespace RegexFubar
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine(Regex.IsMatch("127.0.0.1", "^*$"));
            Console.Read();
        }
    }
} 
```

我不希望 ^*$ 匹配我的字符串，我想知道为什么它**匹配**它。我认为表达式应该导致抛出异常，或者至少是不匹配。

EDIT2：消除任何混乱。我写这个正则表达式并不是为了让它匹配“127.0.0.1”。我们应用程序的用户输入了表达式，想知道为什么它不应该匹配字符串。看完之后，我无法解释它为什么匹配——尤其是因为 Expresso 和 .NET 似乎处理它的方式不同。

我猜这个问题的答案是由于.NET实现避免抛出异常，即使它在技术上是一个不正确的表达式。但这真的是我们想要的吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-21T11:41:06.130

好吧，理论上你是对的，它不应该匹配。但这取决于实现在内部的工作方式。大多数正则表达式 impl。将从前面获取您的正则表达式并删除 ^（注意它必须从字符串的开头匹配）并从末尾删除 $（注意它必须到字符串的末尾），剩下的只是“* " 和 "*" 本身就是一个有效的正则表达式。您正在使用的实现在如何处理它方面是错误的。您可以尝试将“^*$”替换为“*”会发生什么；我想它也会匹配一切。似乎该实现将单个星号视为“。*”。

根据 ISO/IEC 9945-2:1993 标准，这也在[POSIX 标准](http://www.opengroup.org/onlinepubs/007908799/xbd/re.html)中有所描述，它被打破了。它被破坏了，因为标准说在 ^ 字符之后，星号根本没有特殊含义。这意味着 "^*$" 实际上应该只匹配一个字符串，而这个字符串是**"*"**！

引用标准：

> 星号是特殊的，除非使用：
> 
> *   在括号表达式中
> *   作为整个 BRE 的第一个字符（在初始 ^ 之后，如果有的话）
> *   作为子表达式的第一个字符（在初始 ^ 之后，如果有的话）；请参阅匹配多个字符的 BRE。

因此，如果它是第一个字符（如果存在 ^ 则不算作第一个字符），它没有特殊含义。这意味着在这种情况下，星号应该只匹配一个字符，那就是星号。

* * *

## 更新

微软说

> Microsoft .NET Framework 正则表达式结合了其他正则表达式实现的最流行的特性，例如 Perl 和 awk 中的那些。.NET Framework 正则表达式旨在与 Perl 5 正则表达式兼容，包括其他实现中尚未出现的功能，例如从右到左匹配和动态编译。

来源：http: [//msdn.microsoft.com/en-us/library/hs600312.aspx](http://msdn.microsoft.com/en-us/library/hs600312.aspx)

好的，让我们测试一下：

```
# echo -n 127.0.0.1 | perl -n -e 'print (($_ =~ m/(^.*$)/)[0]),"\n";'
-> 127.0.0.1
# echo -n 127.0.0.1 | perl -n -e 'print (($_ =~ m/(^*$)/)[0]),"\n";'
-> 
```

不，它没有。Perl 工作正常。^.*$ 匹配字符串，^*$ 不 => .NET 的正则表达式实现被破坏，它不像 MS 声称的 Perl 5 那样工作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-21T11:41:53.630

星号 (*) 匹配前面的元素**零次或**多次。如果需要一个或多个，请使用 + 运算符而不是 *。

您要求它匹配字符串标记的可选开头和字符串标记的结尾。即，如果我们省略字符串标记的开头，您只是在寻找字符串标记的结尾......它将匹配任何字符串！

我真的不明白你想做什么。如果您能给我们更多信息，那么也许我可以告诉您您应该做什么:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T12:22:04.173

如果你试试

```
Regex.Match("127.0.0.1", "^*1$") 
```

你会看到它也匹配。Match.Index属性的*值为*8，这意味着它匹配最后一个“1”，而不是第一个。这是有道理的，因为“^*”将匹配零个或多个行首，并且在 '1' 之前有零个行首。

想想“a*1$”的匹配方式，因为“1$”之前没有“a”。所以 "a*$" 将与行尾匹配，就像你的例子一样。

顺便说一句，MSDN 文档没有提到“*”只匹配“*”，除非转义为“\*”。而 '*' 本身会抛出异常，而不匹配 '*'。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T11:43:35.967

您实际上是在说“匹配一个不包含任何内容或任何内容的字符串”。所以它会匹配。在这种情况下， ^ 和 $ 绑定并没有真正的区别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T11:46:44.183

除了非法的正则表达式，你想写的很可能不是那个。

您写：*"`^*$`应该匹配字符串/行的开头任意多次，然后是字符串/行的结尾"*，这意味着您需要多行正则表达式，但是您忘记了一行不能开始两次，没有行结束之间。

此外，您在要求中提出的问题实际上符合“127.0.0.1”:) A`^`​​ 不是换行符/回车符，而是行首，`$`不仅是换行符，而且是行尾。

此外，`*`尽可能匹配（除非设置了非贪婪模式），这意味着正则表达式`/^.**$/`regexp 将匹配所有内容。如果要管理换行符，则必须明确编码。

希望这能澄清一些事情:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T13:36:27.847

POSIX 正则表达式标准非常古老且有限。今天仍然遵循它的少数工具，例如 grep、sed 和朋友，主要是在 unix/linux shell 上。Perl 和 PCRE 是两个非常扩展的风格，在 POSIX 标准中几乎没有提到的内容仍然适用。

[http://www.regular-expressions.info/refflavors.html](http://www.regular-expressions.info/refflavors.html)

在 PCRE 和 Perl 中，引擎将`^`和`$`视为匹配字符串开头和结尾的标记（如果设置了多行标志，则为行）。`*`只是重复`^`标记零次或多次（在这种情况下，正好是零次）。因此，引擎只查找与任何字符串匹配的源字符串的结尾。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-21T11:39:40.483

使用[RegexDesigner](http://www.sellsbrothers.com/tools/#regexd)，我可以看到它在“127.0.0.1”之后的“空”令牌上匹配。似乎因为您没有指定标记并且加号匹配零次或多次，所以它匹配“空”标记。

以下正则表达式应该可以工作：

```
^+$ 
```

# iphone - 滑动 UISearchBar

> ID：221523
> 
> 赞同：5
> 
> 时间：2008-10-21T11:33:16.660
> 
> 标签：iphone, cocoa-touch

我想大部分时间隐藏 UISearchBar 并且只在用户需要时才调用它。

我在 Interface Builder 中放置了一个 UISearchBar 并将其隐藏在视图后面，当用户单击按钮时，它会调用以下代码，我希望它将搜索栏带到前面并滑动键盘以查看。但它并没有......

```
- (IBAction)search:(id)sender
{
   [mySearchBar performSelector:@selector(searchBarTextDidBeginEditing:)];
} 
```

有人知道如何通过代码激活 UISearchBar 吗？

谢谢。

感谢您的回复。我只是发布完整的代码以防有人感兴趣

```
- (IBAction)search:(id)sender
{
    mySearchBar.hidden = NO;
    [mySearchBar becomeFirstResponder];
}

#pragma mark UISearchBarDelegate delegate methods

// called when keyboard search button pressed
- (void)searchBarSearchButtonClicked:(UISearchBar *)searchBar
{
    mySearchBar.hidden = YES;
    [mySearchBar resignFirstResponder];
// Do something with the mySearchBar.text
}

// called when cancel button pressed
- (void)searchBarCancelButtonClicked:(UISearchBar *)searchBar
{
    mySearchBar.hidden = YES; 
    [mySearchBar resignFirstResponder];
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T12:19:57.440

如果你想弹出键盘，你需要调用 [mySearchBar becomeFirstResponder]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T11:55:18.020

我将搜索栏放在视图顶部并将其隐藏。那么你只需要：

```
mySearchBar.hidden = NO; 
```

显示它。根据您正在做的事情，您可能还需要调整底层视图的大小（否则它的顶部将被裁剪）。而且它仍然没有“滑入”视野。使用带有适当附加搜索栏的全新视图可能会更容易。

# datetime - VC++ MFC编辑框排序

> ID：221524
> 
> 赞同：0
> 
> 时间：2008-10-21T11:33:50.463
> 
> 标签：datetime, visual-c++, mfc

如何在编辑框中按降序对日期和时间进行排序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-01T05:00:39.550

一个编辑框只包含一个文本（多行或单行）。

如果您想要日期/时间字符串列表，请使用 CListBox 并且它具有排序成员函数。否则，您需要从编辑框中检索完整的字符串，将其加载到行数组中，然后排序，然后放回排序后的结果。

# java - 你将如何在 Java 中实现 LRU 缓存？

> ID：221525
> 
> 赞同：172
> 
> 时间：2008-10-21T11:34:10.323
> 
> 标签：java, caching, data-structures, lru

请不要说 EHCache 或 OSCache 等。出于这个问题的目的，假设我想只使用 SDK 来实现我自己的（边做边学）。鉴于缓存将在多线程环境中使用，您将使用哪些数据结构？我已经使用[LinkedHashMap](http://docs.oracle.com/javase/7/docs/api/java/util/LinkedHashMap.html)和[Collections#synchronizedMap](http://docs.oracle.com/javase/7/docs/api/java/util/Collections.html#synchronizedMap(java.util.Map))实现了一个，但我很好奇是否有任何新的并发集合会是更好的候选者。

更新：当我发现这个金块时，我正在阅读[Yegge 的最新消息：](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)

> 如果您需要恒定时间的访问并希望维护插入顺序，那么最好的方法就是 LinkedHashMap，这是一种真正美妙的数据结构。唯一可能更精彩的方法是如果有一个并发版本。可惜。

在我使用上面提到的`LinkedHashMap`+实现之前，我的想法几乎完全相同。`Collections#synchronizedMap`很高兴知道我没有忽略一些事情。

根据到目前为止的答案，对于高度并发的 LRU，我最好的选择是使用一些相同的逻辑来扩展[ConcurrentHashMap](http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentHashMap.html)`LinkedHashMap`。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-12-23T15:43:23.770

我喜欢很多这些建议，但现在我想我会坚持使用`LinkedHashMap`+ `Collections.synchronizedMap`。如果我将来重新审视这个，我可能会以与 extends`ConcurrentHashMap`相同的方式进行`LinkedHashMap`扩展`HashMap`。

更新：

根据要求，这是我当前实施的要点。

```
private class LruCache<A, B> extends LinkedHashMap<A, B> {
    private final int maxEntries;

    public LruCache(final int maxEntries) {
        super(maxEntries + 1, 1.0f, true);
        this.maxEntries = maxEntries;
    }

    /**
     * Returns <tt>true</tt> if this <code>LruCache</code> has more entries than the maximum specified when it was
     * created.
     *
     * <p>
     * This method <em>does not</em> modify the underlying <code>Map</code>; it relies on the implementation of
     * <code>LinkedHashMap</code> to do that, but that behavior is documented in the JavaDoc for
     * <code>LinkedHashMap</code>.
     * </p>
     *
     * @param eldest
     *            the <code>Entry</code> in question; this implementation doesn't care what it is, since the
     *            implementation is only dependent on the size of the cache
     * @return <tt>true</tt> if the oldest
     * @see java.util.LinkedHashMap#removeEldestEntry(Map.Entry)
     */
    @Override
    protected boolean removeEldestEntry(final Map.Entry<A, B> eldest) {
        return super.size() > maxEntries;
    }
}

Map<String, String> example = Collections.synchronizedMap(new LruCache<String, String>(CACHE_SIZE)); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-12-13T02:21:07.740

如果我今天从头开始再做一次，我会使用 Guava 的[`CacheBuilder`](http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/cache/CacheBuilder.html).

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-12-17T21:23:57.503

这是第二轮。

第一轮是我想出的，然后我重新阅读了评论，域名在我的脑海中更加根深蒂固。

所以这是最简单的版本，它带有一个单元测试，表明它可以基于其他一些版本工作。

首先是非并发版本：

```
import java.util.LinkedHashMap;
import java.util.Map;

public class LruSimpleCache<K, V> implements LruCache <K, V>{

    Map<K, V> map = new LinkedHashMap (  );

    public LruSimpleCache (final int limit) {
           map = new LinkedHashMap <K, V> (16, 0.75f, true) {
               @Override
               protected boolean removeEldestEntry(final Map.Entry<K, V> eldest) {
                   return super.size() > limit;
               }
           };
    }
    @Override
    public void put ( K key, V value ) {
        map.put ( key, value );
    }

    @Override
    public V get ( K key ) {
        return map.get(key);
    }

    //For testing only
    @Override
    public V getSilent ( K key ) {
        V value =  map.get ( key );
        if (value!=null) {
            map.remove ( key );
            map.put(key, value);
        }
        return value;
    }

    @Override
    public void remove ( K key ) {
        map.remove ( key );
    }

    @Override
    public int size () {
        return map.size ();
    }

    public String toString() {
        return map.toString ();
    }

} 
```

true 标志将跟踪gets 和puts 的访问。请参阅 JavaDocs。构造函数没有 true 标志的 removeEdelstEntry 只会实现 FIFO 缓存（请参阅下面关于 FIFO 和 removeEldestEntry 的注释）。

这是证明它可以用作 LRU 缓存的测试：

```
public class LruSimpleTest {

    @Test
    public void test () {
        LruCache <Integer, Integer> cache = new LruSimpleCache<> ( 4 );

        cache.put ( 0, 0 );
        cache.put ( 1, 1 );

        cache.put ( 2, 2 );
        cache.put ( 3, 3 );

        boolean ok = cache.size () == 4 || die ( "size" + cache.size () );

        cache.put ( 4, 4 );
        cache.put ( 5, 5 );
        ok |= cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 2 ) == 2 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();
        ok |= cache.getSilent ( 4 ) == 4 || die ();
        ok |= cache.getSilent ( 5 ) == 5 || die ();

        cache.get ( 2 );
        cache.get ( 3 );
        cache.put ( 6, 6 );
        cache.put ( 7, 7 );
        ok |= cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 2 ) == 2 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();
        ok |= cache.getSilent ( 4 ) == null || die ();
        ok |= cache.getSilent ( 5 ) == null || die ();

        if ( !ok ) die ();

    } 
```

现在对于并发版本...

包 org.boon.cache；

```
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.concurrent.locks.ReadWriteLock;
import java.util.concurrent.locks.ReentrantReadWriteLock;

public class LruSimpleConcurrentCache<K, V> implements LruCache<K, V> {

    final CacheMap<K, V>[] cacheRegions;

    private static class CacheMap<K, V> extends LinkedHashMap<K, V> {
        private final ReadWriteLock readWriteLock;
        private final int limit;

        CacheMap ( final int limit, boolean fair ) {
            super ( 16, 0.75f, true );
            this.limit = limit;
            readWriteLock = new ReentrantReadWriteLock ( fair );

        }

        protected boolean removeEldestEntry ( final Map.Entry<K, V> eldest ) {
            return super.size () > limit;
        }

        @Override
        public V put ( K key, V value ) {
            readWriteLock.writeLock ().lock ();

            V old;
            try {

                old = super.put ( key, value );
            } finally {
                readWriteLock.writeLock ().unlock ();
            }
            return old;

        }

        @Override
        public V get ( Object key ) {
            readWriteLock.writeLock ().lock ();
            V value;

            try {

                value = super.get ( key );
            } finally {
                readWriteLock.writeLock ().unlock ();
            }
            return value;
        }

        @Override
        public V remove ( Object key ) {

            readWriteLock.writeLock ().lock ();
            V value;

            try {

                value = super.remove ( key );
            } finally {
                readWriteLock.writeLock ().unlock ();
            }
            return value;

        }

        public V getSilent ( K key ) {
            readWriteLock.writeLock ().lock ();

            V value;

            try {

                value = this.get ( key );
                if ( value != null ) {
                    this.remove ( key );
                    this.put ( key, value );
                }
            } finally {
                readWriteLock.writeLock ().unlock ();
            }
            return value;

        }

        public int size () {
            readWriteLock.readLock ().lock ();
            int size = -1;
            try {
                size = super.size ();
            } finally {
                readWriteLock.readLock ().unlock ();
            }
            return size;
        }

        public String toString () {
            readWriteLock.readLock ().lock ();
            String str;
            try {
                str = super.toString ();
            } finally {
                readWriteLock.readLock ().unlock ();
            }
            return str;
        }

    }

    public LruSimpleConcurrentCache ( final int limit, boolean fair ) {
        int cores = Runtime.getRuntime ().availableProcessors ();
        int stripeSize = cores < 2 ? 4 : cores * 2;
        cacheRegions = new CacheMap[ stripeSize ];
        for ( int index = 0; index < cacheRegions.length; index++ ) {
            cacheRegions[ index ] = new CacheMap<> ( limit / cacheRegions.length, fair );
        }
    }

    public LruSimpleConcurrentCache ( final int concurrency, final int limit, boolean fair ) {

        cacheRegions = new CacheMap[ concurrency ];
        for ( int index = 0; index < cacheRegions.length; index++ ) {
            cacheRegions[ index ] = new CacheMap<> ( limit / cacheRegions.length, fair );
        }
    }

    private int stripeIndex ( K key ) {
        int hashCode = key.hashCode () * 31;
        return hashCode % ( cacheRegions.length );
    }

    private CacheMap<K, V> map ( K key ) {
        return cacheRegions[ stripeIndex ( key ) ];
    }

    @Override
    public void put ( K key, V value ) {

        map ( key ).put ( key, value );
    }

    @Override
    public V get ( K key ) {
        return map ( key ).get ( key );
    }

    //For testing only
    @Override
    public V getSilent ( K key ) {
        return map ( key ).getSilent ( key );

    }

    @Override
    public void remove ( K key ) {
        map ( key ).remove ( key );
    }

    @Override
    public int size () {
        int size = 0;
        for ( CacheMap<K, V> cache : cacheRegions ) {
            size += cache.size ();
        }
        return size;
    }

    public String toString () {

        StringBuilder builder = new StringBuilder ();
        for ( CacheMap<K, V> cache : cacheRegions ) {
            builder.append ( cache.toString () ).append ( '\n' );
        }

        return builder.toString ();
    }

} 
```

你可以看到我为什么先介绍非并发版本。以上尝试创建一些条带以减少锁争用。所以我们对键进行散列，然后查找该散列以找到实际的缓存。这使得限制大小更多地是一个建议/粗略猜测，取决于您的密钥散列算法的传播程度。

这是显示并发版本可能有效的测试。:)（在火下测试将是真正的方式）。

```
public class SimpleConcurrentLRUCache {

    @Test
    public void test () {
        LruCache <Integer, Integer> cache = new LruSimpleConcurrentCache<> ( 1, 4, false );

        cache.put ( 0, 0 );
        cache.put ( 1, 1 );

        cache.put ( 2, 2 );
        cache.put ( 3, 3 );

        boolean ok = cache.size () == 4 || die ( "size" + cache.size () );

        cache.put ( 4, 4 );
        cache.put ( 5, 5 );

        puts (cache);
        ok |= cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 2 ) == 2 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();
        ok |= cache.getSilent ( 4 ) == 4 || die ();
        ok |= cache.getSilent ( 5 ) == 5 || die ();

        cache.get ( 2 );
        cache.get ( 3 );
        cache.put ( 6, 6 );
        cache.put ( 7, 7 );
        ok |= cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 2 ) == 2 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();

        cache.put ( 8, 8 );
        cache.put ( 9, 9 );

        ok |= cache.getSilent ( 4 ) == null || die ();
        ok |= cache.getSilent ( 5 ) == null || die ();

        puts (cache);

        if ( !ok ) die ();

    }

    @Test
    public void test2 () {
        LruCache <Integer, Integer> cache = new LruSimpleConcurrentCache<> ( 400, false );

        cache.put ( 0, 0 );
        cache.put ( 1, 1 );

        cache.put ( 2, 2 );
        cache.put ( 3, 3 );

        for (int index =0 ; index < 5_000; index++) {
            cache.get(0);
            cache.get ( 1 );
            cache.put ( 2, index  );
            cache.put ( 3, index );
            cache.put(index, index);
        }

        boolean ok = cache.getSilent ( 0 ) == 0 || die ();
        ok |= cache.getSilent ( 1 ) == 1 || die ();
        ok |= cache.getSilent ( 2 ) != null || die ();
        ok |= cache.getSilent ( 3 ) != null || die ();

        ok |= cache.size () < 600 || die();
        if ( !ok ) die ();

    }

} 
```

这是最后一篇文章。我删除的第一篇文章是 LFU 而不是 LRU 缓存。

我想我会再试一次。我试图使用标准 JDK 提供最简单的 LRU 缓存版本，但没有太多实现。

这是我想出的。我的第一次尝试有点灾难，因为我实现了 LFU 而不是 LRU，然后我添加了 FIFO 和 LRU 支持……然后我意识到它正在变成一个怪物。然后我开始和我几乎不感兴趣的朋友 John 交谈，然后我详细描述了我如何实现 LFU、LRU 和 FIFO，以及如何使用简单的 ENUM arg 切换它，然后我意识到我真正想要的只是是一个简单的 LRU。所以请忽略我之前的帖子，如果您想查看可通过枚举切换的 LRU/LFU/FIFO 缓存，请告诉我...不是吗？好的..他走了。

仅使用 JDK 的最简单的 LRU。我实现了并发版本和非并发版本。

我创建了一个通用界面（它是极简主义，因此可能缺少一些您想要的功能，但它适用于我的用例，但是如果您想查看功能 XYZ，请告诉我……我为编写代码而生。） .

```
public interface LruCache<KEY, VALUE> {
    void put ( KEY key, VALUE value );

    VALUE get ( KEY key );

    VALUE getSilent ( KEY key );

    void remove ( KEY key );

    int size ();
} 
```

您可能想知道***getSilent***是什么。我用它来测试。getSilent 不会更改项目的 LRU 分数。

首先是非并发的....

```
import java.util.Deque;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.Map;

public class LruCacheNormal<KEY, VALUE> implements LruCache<KEY,VALUE> {

    Map<KEY, VALUE> map = new HashMap<> ();
    Deque<KEY> queue = new LinkedList<> ();
    final int limit;

    public LruCacheNormal ( int limit ) {
        this.limit = limit;
    }

    public void put ( KEY key, VALUE value ) {
        VALUE oldValue = map.put ( key, value );

        /*If there was already an object under this key,
         then remove it before adding to queue
         Frequently used keys will be at the top so the search could be fast.
         */
        if ( oldValue != null ) {
            queue.removeFirstOccurrence ( key );
        }
        queue.addFirst ( key );

        if ( map.size () > limit ) {
            final KEY removedKey = queue.removeLast ();
            map.remove ( removedKey );
        }

    }

    public VALUE get ( KEY key ) {

        /* Frequently used keys will be at the top so the search could be fast.*/
        queue.removeFirstOccurrence ( key );
        queue.addFirst ( key );
        return map.get ( key );
    }

    public VALUE getSilent ( KEY key ) {

        return map.get ( key );
    }

    public void remove ( KEY key ) {

        /* Frequently used keys will be at the top so the search could be fast.*/
        queue.removeFirstOccurrence ( key );
        map.remove ( key );
    }

    public int size () {
        return map.size ();
    }

    public String toString() {
        return map.toString ();
    }
} 
```

如果缓存很大，则**queue.removeFirstOccurrence** 可能是一项代价高昂的操作。可以以 LinkedList 为例，添加一个从元素到节点的反向查找哈希映射，以使删除操作更快更一致。我也开始了，但后来意识到我不需要它。但是……也许……

当调用***put***时，键被添加到队列中。当***get***被调用时，键被移除并重新添加到队列的顶部。

如果您的缓存很小并且构建项目的成本很高，那么这应该是一个很好的缓存。如果您的缓存真的很大，那么线性搜索可能是一个瓶颈，特别是如果您没有缓存的热点区域。热点越强烈，线性搜索越快，因为热点总是在线性搜索的顶部。无论如何...为了加快速度，需要编写另一个具有删除操作的 LinkedList，该操作具有反向元素到节点查找以进行删除，然后删除将与从哈希映射中删除键一样快。

如果您的缓存少于 1,000 个项目，这应该可以正常工作。

这是一个简单的测试来展示它的实际操作。

```
public class LruCacheTest {

    @Test
    public void test () {
        LruCache<Integer, Integer> cache = new LruCacheNormal<> ( 4 );

        cache.put ( 0, 0 );
        cache.put ( 1, 1 );

        cache.put ( 2, 2 );
        cache.put ( 3, 3 );

        boolean ok = cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 0 ) == 0 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();

        cache.put ( 4, 4 );
        cache.put ( 5, 5 );
        ok |= cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 0 ) == null || die ();
        ok |= cache.getSilent ( 1 ) == null || die ();
        ok |= cache.getSilent ( 2 ) == 2 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();
        ok |= cache.getSilent ( 4 ) == 4 || die ();
        ok |= cache.getSilent ( 5 ) == 5 || die ();

        if ( !ok ) die ();

    }
} 
```

最后一个 LRU 缓存是单线程的，请不要将它包装在同步的任何东西中......

这是并发版本的尝试。

```
import java.util.Deque;
import java.util.LinkedList;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.locks.ReentrantLock;

public class ConcurrentLruCache<KEY, VALUE> implements LruCache<KEY,VALUE> {

    private final ReentrantLock lock = new ReentrantLock ();

    private final Map<KEY, VALUE> map = new ConcurrentHashMap<> ();
    private final Deque<KEY> queue = new LinkedList<> ();
    private final int limit;

    public ConcurrentLruCache ( int limit ) {
        this.limit = limit;
    }

    @Override
    public void put ( KEY key, VALUE value ) {
        VALUE oldValue = map.put ( key, value );
        if ( oldValue != null ) {
            removeThenAddKey ( key );
        } else {
            addKey ( key );
        }
        if (map.size () > limit) {
            map.remove ( removeLast() );
        }
    }

    @Override
    public VALUE get ( KEY key ) {
        removeThenAddKey ( key );
        return map.get ( key );
    }

    private void addKey(KEY key) {
        lock.lock ();
        try {
            queue.addFirst ( key );
        } finally {
            lock.unlock ();
        }

    }

    private KEY removeLast( ) {
        lock.lock ();
        try {
            final KEY removedKey = queue.removeLast ();
            return removedKey;
        } finally {
            lock.unlock ();
        }
    }

    private void removeThenAddKey(KEY key) {
        lock.lock ();
        try {
            queue.removeFirstOccurrence ( key );
            queue.addFirst ( key );
        } finally {
            lock.unlock ();
        }

    }

    private void removeFirstOccurrence(KEY key) {
        lock.lock ();
        try {
            queue.removeFirstOccurrence ( key );
        } finally {
            lock.unlock ();
        }

    }

    @Override
    public VALUE getSilent ( KEY key ) {
        return map.get ( key );
    }

    @Override
    public void remove ( KEY key ) {
        removeFirstOccurrence ( key );
        map.remove ( key );
    }

    @Override
    public int size () {
        return map.size ();
    }

    public String toString () {
        return map.toString ();
    }
} 
```

主要区别在于使用 ConcurrentHashMap 而不是 HashMap，以及 Lock 的使用（我本来可以使用同步的，但是......）。

我还没有对它进行过测试，但它似乎是一个简单的 LRU 缓存，它可能适用于 80% 的需要简单 LRU 映射的用例。

我欢迎反馈，除了你为什么不使用库 a、b 或 c。我不总是使用库的原因是因为我并不总是希望每个 war 文件都为 80MB，而且我编写库所以我倾向于使用足够好的解决方案使库可插入，并且有人可以插入- 如果他们愿意，可以在另一个缓存提供程序中。:) 我不知道什么时候有人可能需要 Guava 或 ehcache 或其他我不想包含它们的东西，但是如果我使缓存可插入，我也不会排除它们。

减少依赖有其自身的回报。我喜欢就如何使这更简单或更快或两者兼而有之获得一些反馈。

另外，如果有人知道准备好了....

好的..我知道你在想什么...他为什么不直接使用 LinkedHashMap 中的 removeEldest 条目，我应该但是.. 但是.. 但是.. 那将是 FIFO 而不是 LRU，我们是尝试实现 LRU。

```
 Map<KEY, VALUE> map = new LinkedHashMap<KEY, VALUE> () {

        @Override
        protected boolean removeEldestEntry ( Map.Entry<KEY, VALUE> eldest ) {
            return this.size () > limit;
        }
    }; 
```

对于上述代码，此测试失败...

```
 cache.get ( 2 );
        cache.get ( 3 );
        cache.put ( 6, 6 );
        cache.put ( 7, 7 );
        ok |= cache.size () == 4 || die ( "size" + cache.size () );
        ok |= cache.getSilent ( 2 ) == 2 || die ();
        ok |= cache.getSilent ( 3 ) == 3 || die ();
        ok |= cache.getSilent ( 4 ) == null || die ();
        ok |= cache.getSilent ( 5 ) == null || die (); 
```

所以这里是一个使用 removeEldestEntry 的快速且脏的 FIFO 缓存。

```
import java.util.*;

public class FifoCache<KEY, VALUE> implements LruCache<KEY,VALUE> {

    final int limit;

    Map<KEY, VALUE> map = new LinkedHashMap<KEY, VALUE> () {

        @Override
        protected boolean removeEldestEntry ( Map.Entry<KEY, VALUE> eldest ) {
            return this.size () > limit;
        }
    };

    public LruCacheNormal ( int limit ) {
        this.limit = limit;
    }

    public void put ( KEY key, VALUE value ) {
         map.put ( key, value );

    }

    public VALUE get ( KEY key ) {

        return map.get ( key );
    }

    public VALUE getSilent ( KEY key ) {

        return map.get ( key );
    }

    public void remove ( KEY key ) {
        map.remove ( key );
    }

    public int size () {
        return map.size ();
    }

    public String toString() {
        return map.toString ();
    }
} 
```

FIFO 很快。不用四处寻找。您可以在 LRU 前面放置一个 FIFO，这样可以很好地处理大多数热条目。更好的 LRU 将需要反向元素到节点功能。

无论如何......现在我写了一些代码，让我看看其他答案，看看我错过了什么......我第一次扫描它们时。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-05T03:33:34.193

`LinkedHashMap`是 O(1)，但需要同步。无需在那里重新发明轮子。

增加并发性的 2 个选项：

1.创建多个`LinkedHashMap`，并散列到它们中：示例：`LinkedHashMap[4], index 0, 1, 2, 3`。在 do `key%4` （或`binary OR`on `[key, 3]`）键上选择要执行 put/get/remove 的地图。

2.您可以通过扩展来做一个“几乎”LRU `ConcurrentHashMap`，并在其中的每个区域中都有一个类似结构的链接哈希图。锁定将比`LinkedHashMap`同步的更细化。在列表的头部和尾部需要一个`put`或仅一个锁（每个区域）。`putIfAbsent`在删除或获取整个区域时需要锁定。我很好奇某种原子链表是否会在这里有所帮助——对于列表的头部可能是这样。也许更多。

该结构不会保留总订单，而只会保留每个区域的订单。只要条目的数量远大于区域的数量，这对于大多数缓存来说就足够了。每个区域都必须有自己的条目计数，这将被使用而不是驱逐触发器的全局计数。a 中的默认区域数`ConcurrentHashMap`是 16，这对于当今的大多数服务器来说已经足够了。

1.  在中等并发下会更容易编写和更快。

2.  将更难编写，但在非常高的并发性下可以更好地扩展。正常访问会更慢（就像没有并发的地方一样`ConcurrentHashMap`慢）`HashMap`

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-07-16T23:53:03.493

有两种开源实现。

Apache Solr 有 ConcurrentLRUCache： [https ://lucene.apache.org/solr/3_6_1/org/apache/solr/util/ConcurrentLRUCache.html](https://lucene.apache.org/solr/3_6_1/org/apache/solr/util/ConcurrentLRUCache.html)

ConcurrentLinkedHashMap 有一个开源项目： [http ://code.google.com/p/concurrentlinkedhashmap/](http://code.google.com/p/concurrentlinkedhashmap/)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-21T11:41:20.730

我会考虑使用[java.util.concurrent.PriorityBlockingQueue](http://java.sun.com/javase/6/docs/api/java/util/PriorityQueue.html)，优先级由每个元素中的“numberOfUses”计数器确定。我会***非常非常小心***地让我的所有同步正确，因为“numberOfUses”计数器意味着元素不能是不可变的。

元素对象将是缓存中对象的包装器：

```
class CacheElement {
    private final Object obj;
    private int numberOfUsers = 0;

    CacheElement(Object obj) {
        this.obj = obj;
    }

    ... etc.
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-10-28T05:01:33.077

希望这可以帮助 。

```
import java.util.*;
public class Lru {

public static <K,V> Map<K,V> lruCache(final int maxSize) {
    return new LinkedHashMap<K, V>(maxSize*4/3, 0.75f, true) {

        private static final long serialVersionUID = -3588047435434569014L;

        @Override
        protected boolean removeEldestEntry(Map.Entry<K, V> eldest) {
            return size() > maxSize;
        }
    };
 }
 public static void main(String[] args ) {
    Map<Object, Object> lru = Lru.lruCache(2);      
    lru.put("1", "1");
    lru.put("2", "2");
    lru.put("3", "3");
    System.out.println(lru);
}
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-04-06T08:41:23.327

LRU Cache 可以使用 ConcurrentLinkedQueue 和 ConcurrentHashMap 来实现，也可以在多线程场景中使用。队列的头部是在队列中时间最长的元素。队列的尾部是在队列中时间最短的元素。当 Map 中存在元素时，我们可以将其从 LinkedQueue 中移除并插入到尾部。

```
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentLinkedQueue;

public class LRUCache<K,V> {
  private ConcurrentHashMap<K,V> map;
  private ConcurrentLinkedQueue<K> queue;
  private final int size; 

  public LRUCache(int size) {
    this.size = size;
    map = new ConcurrentHashMap<K,V>(size);
    queue = new ConcurrentLinkedQueue<K>();
  }

  public V get(K key) {
    //Recently accessed, hence move it to the tail
    queue.remove(key);
    queue.add(key);
    return map.get(key);
  }

  public void put(K key, V value) {
    //ConcurrentHashMap doesn't allow null key or values
    if(key == null || value == null) throw new NullPointerException();
    if(map.containsKey(key) {
      queue.remove(key);
    }
    if(queue.size() >= size) {
      K lruKey = queue.poll();
      if(lruKey != null) {
        map.remove(lruKey);
      }
    }
    queue.add(key);
    map.put(key,value);
  }

} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-04-14T16:36:01.370

这是我对 LRU 的实现。我使用了 PriorityQueue，它基本上可以作为 FIFO 而不是线程安全的。Used Comparator 基于页面时间创建并基于最近最少使用时间执行页面排序。

## 供考虑的页数：2、1、0、2、8、2、4

添加到缓存中的页面是：2
添加到缓存中的页面是：1
添加到缓存中的页面是：0
页面：2 已经存在于缓存中。上次访问时间更新
页面错误，页面：1，替换为页面：8
添加到缓存中的页面为：8
页面：2 已存在于缓存中。上次访问时间更新
页面错误，页面：0，替换为页面：4
添加到缓存中的页面为：4

## 输出

LRUCache Pages
-------------
PageName: 8, PageCreationTime: 1365957019974
PageName: 2, PageCreationTime: 1365957020074
PageName: 4, PageCreationTime: 1365957020174

在这里输入代码

```
import java.util.Comparator;
import java.util.Iterator;
import java.util.PriorityQueue;

public class LRUForCache {
    private PriorityQueue<LRUPage> priorityQueue = new PriorityQueue<LRUPage>(3, new LRUPageComparator());
    public static void main(String[] args) throws InterruptedException {

        System.out.println(" Pages for consideration : 2, 1, 0, 2, 8, 2, 4");
        System.out.println("----------------------------------------------\n");

        LRUForCache cache = new LRUForCache();
        cache.addPageToQueue(new LRUPage("2"));
        Thread.sleep(100);
        cache.addPageToQueue(new LRUPage("1"));
        Thread.sleep(100);
        cache.addPageToQueue(new LRUPage("0"));
        Thread.sleep(100);
        cache.addPageToQueue(new LRUPage("2"));
        Thread.sleep(100);
        cache.addPageToQueue(new LRUPage("8"));
        Thread.sleep(100);
        cache.addPageToQueue(new LRUPage("2"));
        Thread.sleep(100);
        cache.addPageToQueue(new LRUPage("4"));
        Thread.sleep(100);

        System.out.println("\nLRUCache Pages");
        System.out.println("-------------");
        cache.displayPriorityQueue();
    }

    public synchronized void  addPageToQueue(LRUPage page){
        boolean pageExists = false;
        if(priorityQueue.size() == 3){
            Iterator<LRUPage> iterator = priorityQueue.iterator();

            while(iterator.hasNext()){
                LRUPage next = iterator.next();
                if(next.getPageName().equals(page.getPageName())){
                    /* wanted to just change the time, so that no need to poll and add again.
                       but elements ordering does not happen, it happens only at the time of adding
                       to the queue

                       In case somebody finds it, plz let me know.
                     */
                    //next.setPageCreationTime(page.getPageCreationTime()); 

                    priorityQueue.remove(next);
                    System.out.println("Page: " + page.getPageName() + " already exisit in cache. Last accessed time updated");
                    pageExists = true;
                    break;
                }
            }
            if(!pageExists){
                // enable it for printing the queue elemnts
                //System.out.println(priorityQueue);
                LRUPage poll = priorityQueue.poll();
                System.out.println("Page Fault, PAGE: " + poll.getPageName()+", Replaced with PAGE: "+page.getPageName());

            }
        }
        if(!pageExists){
            System.out.println("Page added into cache is : " + page.getPageName());
        }
        priorityQueue.add(page);

    }

    public void displayPriorityQueue(){
        Iterator<LRUPage> iterator = priorityQueue.iterator();
        while(iterator.hasNext()){
            LRUPage next = iterator.next();
            System.out.println(next);
        }
    }
}

class LRUPage{
    private String pageName;
    private long pageCreationTime;
    public LRUPage(String pagename){
        this.pageName = pagename;
        this.pageCreationTime = System.currentTimeMillis();
    }

    public String getPageName() {
        return pageName;
    }

    public long getPageCreationTime() {
        return pageCreationTime;
    }

    public void setPageCreationTime(long pageCreationTime) {
        this.pageCreationTime = pageCreationTime;
    }

    @Override
    public boolean equals(Object obj) {
        LRUPage page = (LRUPage)obj; 
        if(pageCreationTime == page.pageCreationTime){
            return true;
        }
        return false;
    }

    @Override
    public int hashCode() {
        return (int) (31 * pageCreationTime);
    }

    @Override
    public String toString() {
        return "PageName: " + pageName +", PageCreationTime: "+pageCreationTime;
    }
}

class LRUPageComparator implements Comparator<LRUPage>{

    @Override
    public int compare(LRUPage o1, LRUPage o2) {
        if(o1.getPageCreationTime() > o2.getPageCreationTime()){
            return 1;
        }
        if(o1.getPageCreationTime() < o2.getPageCreationTime()){
            return -1;
        }
        return 0;
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-22T02:22:16.630

好吧，对于缓存，您通常会通过代理对象（URL，String ....）查找一些数据，因此在接口方面您将需要一个地图。但是要将事情踢出去，您需要一个类似结构的队列。在内部，我会维护两个数据结构，一个 Priority-Queue 和一个 HashMap。这是一个应该能够在 O(1) 时间内完成所有事情的实现。

这是我很快就开始的一门课：

```
import java.util.HashMap;
import java.util.Map;
public class LRUCache<K, V>
{
    int maxSize;
    int currentSize = 0;

    Map<K, ValueHolder<K, V>> map;
    LinkedList<K> queue;

    public LRUCache(int maxSize)
    {
        this.maxSize = maxSize;
        map = new HashMap<K, ValueHolder<K, V>>();
        queue = new LinkedList<K>();
    }

    private void freeSpace()
    {
        K k = queue.remove();
        map.remove(k);
        currentSize--;
    }

    public void put(K key, V val)
    {
        while(currentSize >= maxSize)
        {
            freeSpace();
        }
        if(map.containsKey(key))
        {//just heat up that item
            get(key);
            return;
        }
        ListNode<K> ln = queue.add(key);
        ValueHolder<K, V> rv = new ValueHolder<K, V>(val, ln);
        map.put(key, rv);       
        currentSize++;
    }

    public V get(K key)
    {
        ValueHolder<K, V> rv = map.get(key);
        if(rv == null) return null;
        queue.remove(rv.queueLocation);
        rv.queueLocation = queue.add(key);//this ensures that each item has only one copy of the key in the queue
        return rv.value;
    }
}

class ListNode<K>
{
    ListNode<K> prev;
    ListNode<K> next;
    K value;
    public ListNode(K v)
    {
        value = v;
        prev = null;
        next = null;
    }
}

class ValueHolder<K,V>
{
    V value;
    ListNode<K> queueLocation;
    public ValueHolder(V value, ListNode<K> ql)
    {
        this.value = value;
        this.queueLocation = ql;
    }
}

class LinkedList<K>
{
    ListNode<K> head = null;
    ListNode<K> tail = null;

    public ListNode<K> add(K v)
    {
        if(head == null)
        {
            assert(tail == null);
            head = tail = new ListNode<K>(v);
        }
        else
        {
            tail.next = new ListNode<K>(v);
            tail.next.prev = tail;
            tail = tail.next;
            if(tail.prev == null)
            {
                tail.prev = head;
                head.next = tail;
            }
        }
        return tail;
    }

    public K remove()
    {
        if(head == null)
            return null;
        K val = head.value;
        if(head.next == null)
        {
            head = null;
            tail = null;
        }
        else
        {
            head = head.next;
            head.prev = null;
        }
        return val;
    }

    public void remove(ListNode<K> ln)
    {
        ListNode<K> prev = ln.prev;
        ListNode<K> next = ln.next;
        if(prev == null)
        {
            head = next;
        }
        else
        {
            prev.next = next;
        }
        if(next == null)
        {
            tail = prev;
        }
        else
        {
            next.prev = prev;
        }       
    }
} 
```

这是它的工作原理。密钥存储在一个链表中，最旧的密钥位于列表的前面（新密钥位于后面），因此当您需要“弹出”某些内容时，只需将其从队列前面弹出，然后使用密钥从地图中删除值。当一个项目被引用时，您从地图中获取 ValueHolder，然后使用 queuelocation 变量从队列中的当前位置删除键，然后将其放在队列的后面（它现在是最近使用的）。添加东西几乎是一样的。

我敢肯定这里有很多错误，我还没有实现任何同步。但是这个类将提供 O(1) 添加到缓存，O(1) 删除旧项目和 O(1) 检索缓存项目。由于运行时间的原因，即使是微不足道的同步（仅同步每个公共方法）仍然很少有锁争用。如果有人有任何聪明的同步技巧，我会非常感兴趣。此外，我确信您可以使用 maxsize 变量对地图进行一些额外的优化。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-05-26T11:46:44.963

这是我测试过的性能最好的并发 LRU 缓存实现，没有任何同步块：

```
public class ConcurrentLRUCache<Key, Value> {

private final int maxSize;

private ConcurrentHashMap<Key, Value> map;
private ConcurrentLinkedQueue<Key> queue;

public ConcurrentLRUCache(final int maxSize) {
    this.maxSize = maxSize;
    map = new ConcurrentHashMap<Key, Value>(maxSize);
    queue = new ConcurrentLinkedQueue<Key>();
}

/**
 * @param key - may not be null!
 * @param value - may not be null!
 */
public void put(final Key key, final Value value) {
    if (map.containsKey(key)) {
        queue.remove(key); // remove the key from the FIFO queue
    }

    while (queue.size() >= maxSize) {
        Key oldestKey = queue.poll();
        if (null != oldestKey) {
            map.remove(oldestKey);
        }
    }
    queue.add(key);
    map.put(key, value);
}

/**
 * @param key - may not be null!
 * @return the value associated to the given key or null
 */
public Value get(final Key key) {
    return map.get(key);
} 
```

}

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-02-21T17:02:40.987

这是我使用的 LRU 缓存，它封装了一个 LinkedHashMap，并通过一个简单的同步锁来处理并发，保护多汁点。它在使用时“接触”元素，使它们再次成为“最新鲜”的元素，因此它实际上是 LRU。我还要求我的元素具有最短寿命，您也可以将其视为允许的“最大空闲时间”，然后您将被驱逐。

但是，我同意 Hank 的结论并接受了答案——如果我今天再次开始，我会查看 Guava 的`CacheBuilder`.

```
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.Map;

public class MaxIdleLRUCache<KK, VV> {

    final static private int IDEAL_MAX_CACHE_ENTRIES = 128;

    public interface DeadElementCallback<KK, VV> {
        public void notify(KK key, VV element);
    }

    private Object lock = new Object();
    private long minAge;
    private HashMap<KK, Item<VV>> cache;

    public MaxIdleLRUCache(long minAgeMilliseconds) {
        this(minAgeMilliseconds, IDEAL_MAX_CACHE_ENTRIES);
    }

    public MaxIdleLRUCache(long minAgeMilliseconds, int idealMaxCacheEntries) {
        this(minAgeMilliseconds, idealMaxCacheEntries, null);
    }

    public MaxIdleLRUCache(long minAgeMilliseconds, int idealMaxCacheEntries, final DeadElementCallback<KK, VV> callback) {
        this.minAge = minAgeMilliseconds;
        this.cache = new LinkedHashMap<KK, Item<VV>>(IDEAL_MAX_CACHE_ENTRIES + 1, .75F, true) {
            private static final long serialVersionUID = 1L;

            // This method is called just after a new entry has been added
            public boolean removeEldestEntry(Map.Entry<KK, Item<VV>> eldest) {
                // let's see if the oldest entry is old enough to be deleted. We don't actually care about the cache size.
                long age = System.currentTimeMillis() - eldest.getValue().birth;
                if (age > MaxIdleLRUCache.this.minAge) {
                    if ( callback != null ) {
                        callback.notify(eldest.getKey(), eldest.getValue().payload);
                    }
                    return true; // remove it
                }
                return false; // don't remove this element
            }
        };

    }

    public void put(KK key, VV value) {
        synchronized ( lock ) {
//          System.out.println("put->"+key+","+value);
            cache.put(key, new Item<VV>(value));
        }
    }

    public VV get(KK key) {
        synchronized ( lock ) {
//          System.out.println("get->"+key);
            Item<VV> item = getItem(key);
            return item == null ? null : item.payload;
        }
    }

    public VV remove(String key) {
        synchronized ( lock ) {
//          System.out.println("remove->"+key);
            Item<VV> item =  cache.remove(key);
            if ( item != null ) {
                return item.payload;
            } else {
                return null;
            }
        }
    }

    public int size() {
        synchronized ( lock ) {
            return cache.size();
        }
    }

    private Item<VV> getItem(KK key) {
        Item<VV> item = cache.get(key);
        if (item == null) {
            return null;
        }
        item.touch(); // idle the item to reset the timeout threshold
        return item;
    }

    private static class Item<T> {
        long birth;
        T payload;

        Item(T payload) {
            this.birth = System.currentTimeMillis();
            this.payload = payload;
        }

        public void touch() {
            this.birth = System.currentTimeMillis();
        }
    }

} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-21T12:17:15.260

看看[ConcurrentSkipListMap](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ConcurrentSkipListMap.html)。如果元素已经包含在缓存中，它应该给你 log(n) 时间来测试和删除一个元素，以及重新添加它的恒定时间。

您只需要一些计数器等和包装器元素来强制对 LRU 顺序进行排序，并确保在缓存已满时丢弃最近的内容。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-05-25T13:56:21.557

这是我的简短实现，请批评或改进它！

```
package util.collection;

import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentLinkedQueue;

/**
 * Limited size concurrent cache map implementation.<br/>
 * LRU: Least Recently Used.<br/>
 * If you add a new key-value pair to this cache after the maximum size has been exceeded,
 * the oldest key-value pair will be removed before adding.
 */

public class ConcurrentLRUCache<Key, Value> {

private final int maxSize;
private int currentSize = 0;

private ConcurrentHashMap<Key, Value> map;
private ConcurrentLinkedQueue<Key> queue;

public ConcurrentLRUCache(final int maxSize) {
    this.maxSize = maxSize;
    map = new ConcurrentHashMap<Key, Value>(maxSize);
    queue = new ConcurrentLinkedQueue<Key>();
}

private synchronized void freeSpace() {
    Key key = queue.poll();
    if (null != key) {
        map.remove(key);
        currentSize = map.size();
    }
}

public void put(Key key, Value val) {
    if (map.containsKey(key)) {// just heat up that item
        put(key, val);
        return;
    }
    while (currentSize >= maxSize) {
        freeSpace();
    }
    synchronized(this) {
        queue.add(key);
        map.put(key, val);
        currentSize++;
    }
}

public Value get(Key key) {
    return map.get(key);
}
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-12-21T12:18:24.463

这是我自己对这个问题的实现

simplelrucache 提供线程安全、非常简单、非分布式 LRU 缓存，支持 TTL。它提供了两种实现：

*   基于 ConcurrentLinkedHashMap 的并发
*   基于LinkedHashMap同步

你可以在这里找到它：[http ://code.google.com/p/simplelrucache/](http://code.google.com/p/simplelrucache/)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-05-03T10:55:06.160

实现的最佳方法是使用维护元素插入顺序的 LinkedHashMap。以下是示例代码：

```
public class Solution {

Map<Integer,Integer> cache;
int capacity;
public Solution(int capacity) {
    this.cache = new LinkedHashMap<Integer,Integer>(capacity); 
    this.capacity = capacity;

}

// This function returns false if key is not 
// present in cache. Else it moves the key to 
// front by first removing it and then adding 
// it, and returns true. 

public int get(int key) {
if (!cache.containsKey(key)) 
        return -1; 
    int value = cache.get(key);
    cache.remove(key); 
    cache.put(key,value); 
    return cache.get(key); 

}

public void set(int key, int value) {

    // If already present, then  
    // remove it first we are going to add later 
       if(cache.containsKey(key)){
        cache.remove(key);
    }
     // If cache size is full, remove the least 
    // recently used. 
    else if (cache.size() == capacity) { 
        Iterator<Integer> iterator = cache.keySet().iterator();
        cache.remove(iterator.next()); 
    }
        cache.put(key,value);
} 
```

}

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-08-09T21:07:27.063

我正在寻找使用 Java 代码的更好的 LRU 缓存。您是否可以使用`LinkedHashMap`和共享您的 Java LRU 缓存代码`Collections#synchronizedMap`？目前我正在使用`LRUMap implements Map`并且代码工作正常，但我正在`ArrayIndexOutofBoundException`使用以下方法使用 500 个用户进行负载测试。该方法将最近的对象移动到队列的前面。

```
private void moveToFront(int index) {
        if (listHead != index) {
            int thisNext = nextElement[index];
            int thisPrev = prevElement[index];
            nextElement[thisPrev] = thisNext;
            if (thisNext >= 0) {
                prevElement[thisNext] = thisPrev;
            } else {
                listTail = thisPrev;
            }
            //old listHead and new listHead say new is 1 and old was 0 then prev[1]= 1 is the head now so no previ so -1
            // prev[0 old head] = new head right ; next[new head] = old head
            prevElement[index] = -1;
            nextElement[index] = listHead;
            prevElement[listHead] = index;
            listHead = index;
        }
    } 
```

`get(Object key)`和`put(Object key, Object value)`方法调用上述`moveToFront`方法。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-08-08T06:00:07.487

想对汉克给出的答案添加评论，但有些我无法做到 - 请将其视为评论

LinkedHashMap 也根据在其构造函数中传递的参数维护访问顺序它保持双行列表以维护顺序（参见 LinkedHashMap.Entry）

@Pacerier 如果再次添加元素，LinkedHashMap 在迭代时保持相同的顺序是正确的，但这仅适用于插入顺序模式。

这是我在 LinkedHashMap.Entry 对象的 java 文档中找到的

```
 /**
     * This method is invoked by the superclass whenever the value
     * of a pre-existing entry is read by Map.get or modified by Map.set.
     * If the enclosing Map is access-ordered, it moves the entry
     * to the end of the list; otherwise, it does nothing.
     */
    void recordAccess(HashMap<K,V> m) {
        LinkedHashMap<K,V> lm = (LinkedHashMap<K,V>)m;
        if (lm.accessOrder) {
            lm.modCount++;
            remove();
            addBefore(lm.header);
        }
    } 
```

此方法负责将最近访问的元素移动到列表末尾。所以总而言之 LinkedHashMap 是实现 LRUCache 的最佳数据结构。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-04-25T13:02:17.993

另一个想法甚至是使用 Java 的 LinkedHashMap 集合的简单实现。

LinkedHashMap 提供了 removeEldestEntry 方法，可以按照示例中提到的方式覆盖该方法。默认情况下，这个集合结构的实现是假的。如果该结构的真实性和大小超出初始容量，则将删除最旧或更旧的元素。

在我的情况下，我们可以有一个 pageno 和页面内容 pageno 是整数，而 pagecontent 我保留了页码值字符串。

> ```
> import java.util.LinkedHashMap;
> import java.util.Map;
> 
> /**
>  * @author Deepak Singhvi
>  *
>  */
> public class LRUCacheUsingLinkedHashMap {
> 
>      private static int CACHE_SIZE = 3;
>      public static void main(String[] args) {
>         System.out.println(" Pages for consideration : 2, 1, 0, 2, 8, 2, 4,99");
>         System.out.println("----------------------------------------------\n");
> 
> // accessOrder is true, so whenever any page gets changed or accessed,    // its order will change in the map, 
>               LinkedHashMap<Integer,String> lruCache = new              
>                  LinkedHashMap<Integer,String>(CACHE_SIZE, .75F, true) {
> 
>            private static final long serialVersionUID = 1L;
> 
>            protected boolean removeEldestEntry(Map.Entry<Integer,String>                           
> 
>                      eldest) {
>                           return size() > CACHE_SIZE;
>                      }
> 
>                 };
> 
>   lruCache.put(2, "2");
>   lruCache.put(1, "1");
>   lruCache.put(0, "0");
>   System.out.println(lruCache + "  , After first 3 pages in cache");
>   lruCache.put(2, "2");
>   System.out.println(lruCache + "  , Page 2 became the latest page in the cache");
>   lruCache.put(8, "8");
>   System.out.println(lruCache + "  , Adding page 8, which removes eldest element 2 ");
>   lruCache.put(2, "2");
>   System.out.println(lruCache+ "  , Page 2 became the latest page in the cache");
>   lruCache.put(4, "4");
>   System.out.println(lruCache+ "  , Adding page 4, which removes eldest element 1 ");
>   lruCache.put(99, "99");
>   System.out.println(lruCache + " , Adding page 99, which removes eldest element 8 ");
> 
>      }
> 
> } 
> ```

上述代码执行结果如下：

```
 Pages for consideration : 2, 1, 0, 2, 8, 2, 4,99
--------------------------------------------------
    {2=2, 1=1, 0=0}  , After first 3 pages in cache
    {2=2, 1=1, 0=0}  , Page 2 became the latest page in the cache
    {1=1, 0=0, 8=8}  , Adding page 8, which removes eldest element 2 
    {0=0, 8=8, 2=2}  , Page 2 became the latest page in the cache
    {8=8, 2=2, 4=4}  , Adding page 4, which removes eldest element 1 
    {2=2, 4=4, 99=99} , Adding page 99, which removes eldest element 8 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-01-30T17:50:01.057

遵循@sanjanab 的概念（但在修复之后），我制作了我的 LRUCache 版本，还提供了 Consumer，允许在需要时对已删除的项目执行某些操作。

```
public class LRUCache<K, V> {

    private ConcurrentHashMap<K, V> map;
    private final Consumer<V> onRemove;
    private ConcurrentLinkedQueue<K> queue;
    private final int size;

    public LRUCache(int size, Consumer<V> onRemove) {
        this.size = size;
        this.onRemove = onRemove;
        this.map = new ConcurrentHashMap<>(size);
        this.queue = new ConcurrentLinkedQueue<>();
    }

    public V get(K key) {
        //Recently accessed, hence move it to the tail
        if (queue.remove(key)) {
            queue.add(key);
            return map.get(key);
        }
        return null;
    }

    public void put(K key, V value) {
        //ConcurrentHashMap doesn't allow null key or values
        if (key == null || value == null) throw new IllegalArgumentException("key and value cannot be null!");

        V existing = map.get(key);
        if (existing != null) {
            queue.remove(key);
            onRemove.accept(existing);
        }

        if (map.size() >= size) {
            K lruKey = queue.poll();
            if (lruKey != null) {
                V removed = map.remove(lruKey);
                onRemove.accept(removed);
            }
        }
        queue.add(key);
        map.put(key, value);
    }
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2014-09-18T09:07:11.417

Android 提供了[LRU Cache](http://developer.android.com/reference/android/util/LruCache.html)的实现。[代码](https://android.googlesource.com/platform/frameworks/support.git/+/master/v4/java/android/support/v4/util/LruCache.java)简洁明了。

# intranet - Intranet 与 Internet Web 应用程序注意事项

> ID：221534
> 
> 赞同：12
> 
> 时间：2008-10-21T11:37:14.983
> 
> 标签：intranet

**在设计或开发Intranet 和 Internet 应用程序**方面，考虑因素有何**不同**？

 *** * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T12:13:40.150

另一件事是，在 Intranet 环境中，您通常会有一个标准的客户端构建，这意味着您可以编码到特定的浏览器和版本（哈哈，通常是 IE6）。

在互联网的狂野中，您必须处理各种浏览器和版本，因此您的 html/css/js 需要处理所有这些。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T12:16:14.060

Intranet 应用程序可以利用链接到内部 UNC 路径（例如`\\corporateserver\devteam\ArchitectureDiagram.vsd`）上的资源的能力。

但是，请注意浏览器在处理此类链接的方式上有所不同。在 Firefox 中，默认情况下，单击 UNC 路径上的资源链接会静默失败（单击该链接不会执行任何操作）；[有一些解决方法可用](http://kb.mozillazine.org/Links_to_local_pages_don%27t_work)。在 Internet Explorer 中，指向 UNC 路径资源的链接*默认*有效。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T12:17:02.703

在 Intranet 上，您可以利用现有的身份验证和授权服务。我工作过的银行都有非常安全的第三方认证服务。在其他使用 Windows 平台的公司中，Active Directory 可用于身份验证和授权（使用“组”来定义角色）。

当这些功能可用时，您不必对散列（和加盐）或加密密码、密码强度、密码到期等做出太多决定。并且您不必为设置用户、检索或重置密码等创建所有管理页面。用户不会在不同的 Intranet 应用程序上面临不同的密码策略，并且通常可以为多个应用程序使用相同的登录凭据。

不必处理所有这些，让您有更多时间花在应用程序的主要功能上。

尽管 Intranet 环境似乎较少受到黑客的威胁，但只需一次破坏即可破坏系统。而且，Intranet 可能正在处理极其敏感的数据。所以，我认为你需要使 Intranet 应用程序至少与 Internet 应用程序一样安全。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T14:24:46.490

请不要错误地认为，因为应用程序是 Intranet 独有的，所以它不需要像互联网应用程序那样安全。如果有的话，它需要更安全，因为它很有可能处理比公司互联网应用程序处理的数据更敏感的数据。

如果您依赖 Intranet 的安全性，那么您的应用程序将仅与 Intranet 一样安全（并且与所有用户中最弱的用户一样安全，这些用户的密码写在监视器上的便签上）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T11:40:35.553

一些考虑...

1.  安全
2.  站点 IO
3.  交通
4.  数据模型
5.  需要可扩展性

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T12:02:04.543

Galwegian 已经编写了其中的大部分，但我认为您应该在外部缓存时考虑更多缓存，因为您的数据库可能更活跃。

另一点是当您在您的企业（内部网）中时，您可能能够使用较低的安全参数来访问您用户的硬盘驱动器。这对于通过网络的外部网站/应用程序是不可能的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T13:25:40.177

考虑设计考虑中的相似性可能会更有成效。

您仍然需要问自己相同的基本问题，例如您要解决的问题、针对谁、他们的能力是什么、您可以访问哪些平台……等等。

如果您适当考虑范围，这些差异将很快变得明显。其中许多已经由其他贡献者在这里标出，但请尽量避免预先做出太多假设。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T12:14:53.517

Intranet 通常具有一组受支持的固定浏览器。

如果你幸运的话，你可以忽略 IE6。这很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-21T07:27:29.010

@Galwegian 和其他人：

6.  是时候开始申请了。在公共互联网上，许多业余和营销企业活动的使用时间都很短（1-2 年？）。因此，接受“混乱”的设计和混乱的临时技术。然后业余爱好者没有精力开发，新的营销总监对新的彩色软件等有了新的大预算；）

重要的“硬”业务软件必须存在（扩展、开发）例如 8 到 10 年甚至更长时间，没有停顿。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-11-13T14:02:07.770

Intranet 应用程序更多地用于内部人员和知识管理目的。

其更敏感的数据将在网络内共享

[http://www.dreamznetsolutions.com/intranet_application_development_mumbai.html](http://www.dreamznetsolutions.com/intranet_application_development_mumbai.html)

# javascript - '+new Date' 中的加号有什么作用

> ID：221539
> 
> 赞同：254
> 
> 时间：2008-10-21T11:39:57.583
> 
> 标签：javascript, syntax

我在几个[地方看到过这个](https://stackoverflow.com/questions/221294/how-do-you-get-a-timestamp-in-javascript#221357)

```
function fn() {
    return +new Date;
} 
```

而且我可以看到它返回的是时间戳而不是日期对象，但我找不到任何关于加号正在做什么的文档。

谁能解释一下？

* * *

## 回答 #1

> 赞同：311
> 
> 时间：2008-10-21T11:49:18.670

那是`+`一元运算符。它相当于：

```
function(){ return Number(new Date); } 
```

请参阅[http://xkr.us/articles/javascript/unary-add](http://xkr.us/articles/javascript/unary-add)和[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Unary_plus)。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-21T11:47:18.707

JavaScript 是松散类型的，因此它在某些情况下执行类型强制/转换：

[http://blog.jeremymartin.name/2008/03/understanding-loose-typing-in.html](http://blog.jeremymartin.name/2008/03/understanding-loose-typing-in.html)
[http://www.jibbering.com/faq/faq_notes/type_convert.html](http://www.jibbering.com/faq/faq_notes/type_convert.html)

其他示例：

```
>>> +new Date()
1224589625406
>>> +"3"
3
>>> +true
1
>>> 3 == "3"
true 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T12:11:20.450

这是关于“一元加法”运算符的[规范。](http://bclary.com/2004/11/07/#a-11.4.6)希望能帮助到你...

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-09-10T06:46:36.817

JavaScript 日期可以写成字符串：

2015 年 9 月 10 日星期四 12:02:54 GMT+0530 (IST)

或作为一个数字：

1441866774938

日期写成数字，指定自 1970 年 1 月 1 日 00:00:00 以来的毫秒数。

谈到您的问题，它通过在赋值运算符 '=' 之后添加 '+' 来将 Date 转换为相等的数值。

同样可以使用 Number() 函数来实现，例如 Number(new Date());

```
var date = +new Date(); //same as 'var date =number(new Date());' 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-10-16T12:07:47.663

如果你还记得，当你想找到两个日期之间的时间差时，你只需执行以下操作：

```
var d1 = new Date("2000/01/01 00:00:00"); 
var d2 = new Date("2000/01/01 00:00:01");  //one second later

var t = d2 - d1; //will be 1000 (msec) = 1 sec

typeof t; // "number" 
```

现在，如果您检查 d1-0 的类型，它也是一个数字：

```
t = new Date() - 0; //numeric value of Date: number of msec's since 1 Jan 1970.
typeof t; // "number" 
```

这`+`也将日期转换为数字：

```
typeof (+new Date()) //"number" 
```

但请注意，`0 + new Date()`不会**被**同等对待！它将被连接为字符串：

```
0 + new Date() // "0Tue Oct 16 05:03:24 PDT 2018" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-09-18T08:40:18.400

它是一个*一元加法*运算符，也用于显式数字转换，因此当您调用 时`+new Date()`，它会尝试获取该对象的数值，`valueOf()`就像我们从中获取字符串一样`toString()`

```
new Date().valueOf() == (+new Date)  // true 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-10-21T11:48:02.557

它与以下内容完全相同：

```
function(){ 返回 0+新日期；}

```

与以下结果相同：

```
function(){ return new Date().getTime(); }

```

# syntax - 如何将多个参数传递给 logparser sql 查询？

> ID：221544
> 
> 赞同：6
> 
> 时间：2008-10-21T11:40:56.550
> 
> 标签：syntax, logparser

使用 logparser，您可以将参数传递给您要运行的查询，例如：

```
logparser file:query.sql?logs=somewhere\*.log -o:Sql -server:databaseserver 
  -database:database  -createtable:ON -i:IISW3C 
  -iCheckPoint:somewhere\query.lpc -transactionRowCount:200 
```

现在我想将第二个参数传递给 sql 查询，但似乎不可能。

```
logparser file:query.sql?a=1&b=2 
```

被视为：a = "1&b=2"。用重音转义字符也不起作用。这是 logparser 工具的限制吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T12:05:29.277

[找到答案](http://blogs.msdn.com/adcman/archive/2006/05/15/598149.aspx)，使用 + 字符：

```
logparser file:query.sql?a=1+b=2 
```

# c# - C# 泛型/设计模式：我应该使用模板方法吗？

> ID：221550
> 
> 赞同：1
> 
> 时间：2008-10-21T11:42:24.287
> 
> 标签：c#, web-services, design-patterns, generics

**设想：**

（如果最近有人回答/查看了我的问题，这将有些熟悉）

我有 3 个不同的 Web 服务，它们公开了一组具有共性的对象。我使用通用方法编写了包装类和转换逻辑，以在中间对象和服务对象之间进行更改。

我有一个 Webservice 的接口，为了这个问题，让它被称为 IService。我有 3 个实现类 Service1Impl、Service2Impl 和 Service3Impl。其中每一个都引用不同的 Web 服务，并使用我前面提到的通用方法在适当的对象之间进行转换。

这些在运行时通过构造函数注入到我的 ServiceWrapper 类中（工厂用于创建 ISerivice 的适当实现

例如：

```
_service = ServiceWrapper.GetServiceWrapper("2"); 
```

会给我一个使用 Service2Impl 实例化的 ServiceWrapper。

（该死的图表会很有用！）

好的，所以 IService 的每个实现都有一个为参数而调用的方法.. GetProperties：

```
public IProperty[] GetProperties(string item, IProperty[] properties)
{
    Property[] props = ServiceObjectFactory.CreateProperties<Property>(properties);
    Property[] result = _service.GetProperties(item, props);
    return ServiceObjectFactory.CreateProperties(result);
} 
```

这看起来有点令人困惑（我想我要重构名称）。

基本上正在发生的事情是：

1.  从 ServiceWrapper 对该函数的调用是使用中间对象 (IProperty) 进行的（从参数中可以看出）。

2.  中间对象被转换为特定于服务的属性对象。

3.  结果作为服务特定的 Property 对象返回。

4.  结果在被传递回 ServiceWrapper 之前被转换为中间对象。

现在，对于 Service1Impl、Service2Impl 和 Service3Impl，此代码将完全相同。当然，除了使用的类型不同。

谁能想到一种方法来做到这一点，这样我就没有 3 次相同的代码？

**注意：并非每个实现中的每个方法都是如此。只是他们中的大多数。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T13:26:11.907

我认为一般来说，如果您希望您的代码具有不同的类型签名，则必须将代码编写三个不同的时间。由于类型不同，因此根本不是“相同的代码”。

您可以将所拥有的内容放入继承的方法中，然后将结果包装在每个子类中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T12:35:56.720

我不确定它是否适合您的场景，但通读您的问题[控制反转让](http://en.wikipedia.org/wiki/Inversion_of_Control)我想到了。

# rss - 从数据库创建 RSS 提要，将多少项放入提要以便它们都可能被消费？

> ID：221554
> 
> 赞同：12
> 
> 时间：2008-10-21T11:43:50.820
> 
> 标签：rss, feed, publish

我正在从数据库创建几个 RSS 提要，以发布诸如职位空缺、志愿者机会和一般链接之类的内容。我的问题是，应该在提要中返回多少项目，以便某人最有可能在阅读器中获得所有项目而没有任何间隙？

选择前 100 名？（显然需要为 X 时间估计的提要数量设置）

选择过去的 24、48、72 小时？

如果我通过 Feedburner 运行我的提要，是否有人知道他们是否会检查某个时间间隔，以便我可以按照他们的标准创建它并确保 Feedburner 提要将包含所有项目？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T11:54:59.173

好吧，这将取决于条目出现的速度。

但我猜想以最后 48 小时左右为目标是安全的——因为许多用户将运行独立的 RSS 阅读器，他们需要点击提要来拉下当前的任何内容。但如果这将是太多的数据，那么也许只是限制它。100虽然很多。

它还取决于用户如何使用这些数据。职位空缺可能适用于该数量，但如果用户经常看到太多条目进入并取消订阅，他们可能会被淹没。

而且您需要警惕实际提要本身的大小。一些提要聚合服务设置了 512kb 之类的限制，如果它变得更大，则不会转发它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T16:05:51.337

如果您首先完成了创建提要的艰苦工作，那么提供查询字符串变量来影响返回的记录。

我最近为基于 Intranet 的提要做了类似的事情，就像这样

feed.asp?d=3&n=100

它返回最近 3 天的提要，最多 100 条记录。

相似地，

feed.asp?d=7（过去 7 天的所有记录）

feed.asp?n=10（最后 10 条记录）

然后用户可以调整提要以适应他们的情况，因为您通常不可能有一个提要满足所有用户的要求。

虽然在请求 feed.asp 时这对您的“默认”值没有帮助，但它至少允许技术用户根据需要修改提要。确保您也检查查询字符串值，以防止愚蠢/恶意的请求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T14:22:54.803

我个人会尽量保持在 25 岁以下。我知道使用 iGoogle 来查看 RSS 提要的人数正在增加，并且那里的最大显示限制为 9 个条目。许多其他 RSS 提要显示限制为 10-15 个条目。

我发现 RSS 提要，除非它本质上是一个“包罗万象”的提要，否则通常是对正在发生的事情或可用内容的小型、快速的更新。

正如 madlep 所提到的，我也会小心地缩小尺寸。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T11:56:22.773

feedburner[似乎每 5 分钟检查一次，](http://blogs.feedburner.com/feedburner/archives/2004/04/feedburner_saved_my_bandwidth.php)但您可以在您的帐户中进行设置。另一个论坛帖子似乎表明[它是每 30 分钟一次](http://groups.google.com/group/feedburner-services/browse_thread/thread/cc8d22a80b8397f0)。

# css - 保存与 Dreamweaver 文档相关的 CSS

> ID：221556
> 
> 赞同：0
> 
> 时间：2008-10-21T11:44:59.693
> 
> 标签：css, dreamweaver

我发现 Dreamweaver 非常烦人，每次我去保存我的文档时，我都必须在每个 css 文件中添加标签并单独保存它们。一个 css 文件不是问题，但是当你有 3 或 4 个时，它会很痛苦。是否可以将您的 Dreamweaver 文档和所有相关的 css 文件保存在一个热键中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T00:27:05.177

没有办法将*相关*文件保存为一个组，但文件菜单中有“全部保存”，工具栏中有“全部保存”图标（两张软盘）。

# java - SWT - 获取等宽字体的操作系统无关方式

> ID：221568
> 
> 赞同：28
> 
> 时间：2008-10-21T11:50:49.993
> 
> 标签：java, fonts, swt

SWT 中有没有一种方法可以简单地获得等宽字体，并且可以在各种操作系统中使用？

例如。这适用于 Linux，但不适用于 Windows：

```
 Font mono = new Font(parent.getDisplay(), "Mono", 10, SWT.NONE); 

```

或者我是否需要一种方法来尝试加载不同的字体（Consolas、Terminal、Monaco、Mono）直到一个不为空？或者，我可以在启动时在属性文件中指定它。

我尝试从 Display 获取系统字体，但不是等宽字体。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2012-02-27T14:57:54.897

我花了一段时间猛烈抨击这个，直到我意识到显然 Eclipse 必须可以访问等宽字体才能在其文本字段、控制台等中使用。有点挖掘出现了：

```
Font terminalFont = JFaceResources.getFont(JFaceResources.TEXT_FONT); 
```

如果您感兴趣的只是获取一些等宽字体，那么这很有效。

**编辑：**或基于@ctron 的评论：

```
Font font = JFaceResources.getTextFont(); 
```

**编辑：**警告（基于@Lii 的评论）：这将为您提供配置的文本字体，它可以被用户覆盖，并且可能不是等宽字体。但是，它将与编辑器和控制台中使用的字体保持一致，这*可能*是您想要的。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-21T18:14:42.463

根据[国际化支持](http://java.sun.com/javase/6/docs/technotes/guides/intl/)相关 API的 JDK 文档中的[字体配置文件部分，](http://java.sun.com/javase/6/docs/technotes/guides/intl/fontconfig.html) **Logical Font**的概念用于定义某些与平台无关的字体​​，这些字体映射到默认字体配置文件中的物理字体：

 **> Java 平台定义了每个实现必须支持的五个逻辑字体名称：Serif、SansSerif、Monospaced、Dialog 和 DialogInput。这些逻辑字体名称以与实现相关的方式映射到物理字体。

所以在你的情况下，我会尝试

`Font mono = new Font(parent.getDisplay(), "Monospaced", 10, SWT.NONE);`

获取运行代码的当前平台的物理等宽字体的句柄。

**编辑**：SWT 似乎对逻辑字体一无所知（eclipse.org 上的[Bug 48055对此进行了详细描述）。](https://bugs.eclipse.org/bugs/show_bug.cgi?id=48055)在这个错误报告中，建议了一个骇人听闻的解决方法，其中物理字体的名称可以从 AWT 字体中检索...

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-22T15:50:58.713

据我所知，AWT API 不公开底层字体信息。如果你能得到它，我希望它依赖于实现。当然，比较几个 JRE lib 目录中的字体映射文件，我可以看到它们的定义方式不一致。

您可以加载自己的字体，但这似乎有点浪费，因为您知道该平台带有您需要的东西。

这是一个加载 JRE 字体的 hack：

```
private static Font loadMonospacedFont(Display display) {
    String jreHome = System.getProperty("java.home");
    File file = new File(jreHome, "/lib/fonts/LucidaTypewriterRegular.ttf");
    if (!file.exists()) {
        throw new IllegalStateException(file.toString());
    }
    if (!display.loadFont(file.toString())) {
        throw new IllegalStateException(file.toString());
    }
    final Font font = new Font(display, "Lucida Sans Typewriter", 10,
            SWT.NORMAL);
    display.addListener(SWT.Dispose, new Listener() {
        public void handleEvent(Event event) {
            font.dispose();
        }
    });
    return font;
} 
```

它适用于 IBM/Win32/JRE1.4、Sun/Win32/JRE1.6、Sun/Linux/JRE1.6，但这是一种非常脆弱的方法。根据您对 I18N 的需求，那里也可能有问题（我还没有检查过）。

另一个技巧是测试平台上可用的字体：

```
public class Monotest {

    private static boolean isMonospace(GC gc) {
        final String wide = "wgh8";
        final String narrow = "1l;.";
        assert wide.length() == narrow.length();
        return gc.textExtent(wide).x == gc.textExtent(narrow).x;
    }

    private static void testFont(Display display, Font font) {
        Image image = new Image(display, 100, 100);
        try {
            GC gc = new GC(image);
            try {
                gc.setFont(font);
                System.out.println(isMonospace(gc) + "\t"
                        + font.getFontData()[0].getName());
            } finally {
                gc.dispose();
            }
        } finally {
            image.dispose();
        }
    }

    private static void walkFonts(Display display) {
        final boolean scalable = true;
        for (FontData fontData : display.getFontList(null, scalable)) {
            Font font = new Font(display, fontData);
            try {
                testFont(display, font);
            } finally {
                font.dispose();
            }
        }
    }

    public static void main(String[] args) {
        Display display = new Display();
        try {
            walkFonts(display);
        } finally {
            display.dispose();
        }
    }

} 
```

这可能不是一个好方法，因为它可能会让您面临语言环境问题。此外，您不知道您遇到的第一个等宽字体是否不是一些绕组图标集。

最好的方法可能只是根据字体/区域设置映射白名单进行最佳猜测，并确保用户可以通过[FontDialog](http://help.eclipse.org/stable/nftopic/org.eclipse.platform.doc.isv/reference/api/org/eclipse/swt/widgets/FontDialog.html)轻松地重新配置 UI 以适合自己。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-03-07T11:23:05.853

对于有同样问题的人，您可以下载任何字体 ttf 文件，将其放入资源文件夹（在我的情况下为 /font/ *** *.ttf）并将此方法添加到您的应用程序中。这是100％的工作。

```
public Font loadDigitalFont(int policeSize) {
    URL fontFile = YouClassName.class
            .getResource("/fonts/DS-DIGI.TTF");
    boolean isLoaded = Display.getCurrent().loadFont(fontFile.getPath());
    if (isLoaded) {
        FontData[] fd = Display.getCurrent().getFontList(null, true);
        FontData fontdata = null;
        for (int i = 0; i < fd.length; i++) {
            if (fd[i].getName().equals("DS-Digital")) {
                fontdata = fd[i];
                break;
            }}
        if (fontdata != null) {
            fontdata.setHeight(policeSize);
            fontdata.setStyle(SWT.BOLD);return new Font(getDisplay(), fontdata));}
    }return null;   } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-11T11:38:28.327

如果您只想要等宽字体，请使用“Courier”=>`new Font(display, "Courier", 10, SWT.NORMAL)`

# java - Java 有哪些代码高亮库？

> ID：221570
> 
> 赞同：11
> 
> 时间：2008-10-21T11:52:02.050
> 
> 标签：java, syntax-highlighting, codehighlighter

我希望它们易于捆绑，依赖少且易于使用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T11:58:15.423

您想突出显示 Java 代码还是使用 Java 库突出显示其他代码？

我使用这两个：[https](https://jhighlight.dev.java.net/) ://jhighlight.dev.java.net/ （服务器端）用于 xml，[http://code.google.com/p/syntaxhighlighter/](http://code.google.com/p/syntaxhighlighter/)（js lib）用于其他东西。后者有一种叫做“画笔”的东西，它是几种语言的“可插入”.js。如果您正在做简单的突出显示，我推荐使用 ,js 方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T11:54:54.137

[http://sourceforge.net/projects/jintilla/](http://sourceforge.net/projects/jintilla/)

[http://syntax.jedit.org/](http://syntax.jedit.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-13T21:56:26.567

[http://tohtml.com/](http://tohtml.com/)这个不错。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-11-18T23:37:44.843

一点点更新，当我们最近在寻找高亮库时，我们发现了非常好的 Jygments：[http](http://code.google.com/p/jygments/) ://code.google.com/p/jygments/ 。

通过threecrickets repo 可用于Ant/Maven/SBT 项目，它是Pygments ( [http://pygments.org](http://pygments.org) ) 的Java 端口，适用于几种主要语言。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-10-31T09:05:44.267

[RSyntaxTextArea 在这里](http://bobbylight.github.io/RSyntaxTextArea/)为我工作

```
 RSyntaxTextArea textArea = new RSyntaxTextArea();
        textArea.setSyntaxEditingStyle(SyntaxConstants.SYNTAX_STYLE_JAVA);
        textArea.setCodeFoldingEnabled(true);
        RTextScrollPane rs = new RTextScrollPane(textArea); 
```

# linux - 如何解除无线接口与接入点的关联？

> ID：221578
> 
> 赞同：0
> 
> 时间：2008-10-21T11:54:45.243
> 
> 标签：linux, wireless

我正在尝试制作一个脚本，让我的无线网卡在 linux 中休眠。为此，我正在使用以下`deepsleep`命令`iwpriv`：

```
iwpriv wlan0 deepsleep 1 
```

问题是该命令仅在无线网卡断开连接和解除关联时才有效。当它连接时没有问题，因为如果我断开连接，它会自动取消关联。但是如果它断开连接，有时它会自动关联（但不连接）到未加密的网络，所以我无法运行该`iwpriv`命令。我发现的唯一解决方法是先将模式更改为 Ad-Hoc，然后在睡眠卡之前更改为 Managed：

```
iwconfig wlan0 mode ad-hoc
iwconfig wlan0 mode managed
iwpriv wlan0 deepsleep 1 
```

但我认为这有点棘手。

是否存在一种更直接的方法来在 linux 中解除无线网卡的关联？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T05:21:48.720

许多驱动程序使用与 NULL AP 关联的惯例与当前 AP 断开连接。再加上一个短暂的延迟，你可能会得到你想要的。例如，

```
iwconfig wlan0 ap 00:00:00:00:00:00
sleep 1
iwpriv wlan0 deepsleep 1 
```

通常，与 AP 断开连接的时间不应超过 250-500 毫秒，但部分睡眠命令（例如 sleep 0.25）是不可移植的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T12:05:32.787

我没有解决办法，但您可以尝试将卡的 ESSID 设置为随机字符串，并希望附近没有接入点使用该 ESSID。这应该可以防止自动连接到找到的任何未加密网络。不是解决方案，但也许是更好的创可贴。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T14:29:46.833

如果您执行 ifconfig wlan0 down，它不会解除关联吗？

# .net - 检查 DBNull 然后分配给变量的最有效方法是什么？

> ID：221582
> 
> 赞同：151
> 
> 时间：2008-10-21T11:55:52.137
> 
> 标签：.net, dbnull

这个问题偶尔会出现，但我还没有看到满意的答案。

一个典型的模式是（行是一个**DataRow**）：

```
 if (row["value"] != DBNull.Value)
 {
      someObject.Member = row["value"];
 } 
```

我的第一个问题是哪个更有效（我已经改变了条件）：

```
 row["value"] == DBNull.Value; // Or
  row["value"] is DBNull; // Or
  row["value"].GetType() == typeof(DBNull) // Or... any suggestions? 
```

[这](https://stackoverflow.com/questions/184681/is-vs-typeof)表明 .GetType() 应该更快，但也许编译器知道一些我不知道的技巧？

第二个问题，是否值得缓存 row["value"] 的值，或者编译器是否优化了索引器？

例如：

```
 object valueHolder;
  if (DBNull.Value == (valueHolder = row["value"])) {} 
```

笔记：

1.  行[“值”] 存在。
2.  我不知道列的列索引（因此是列名查找）。
3.  我特别询问是否检查 DBNull 然后分配（不是关于过早优化等）。

我对几个场景进行了基准测试（以秒为单位的时间，10,000,000 次试验）：

```
row["value"] == DBNull.Value: 00:00:01.5478995
row["value"] is DBNull: 00:00:01.6306578
row["value"].GetType() == typeof(DBNull): 00:00:02.0138757 
```

Object.ReferenceEquals 与 "==" 具有相同的性能

最有趣的结果？如果您按大小写不匹配列的名称（例如，“Value”而不是“value”，则大约需要十倍的时间（对于字符串）：

```
row["Value"] == DBNull.Value: 00:00:12.2792374 
```

这个故事的寓意似乎是，如果您不能通过索引查找列，那么请确保您提供给索引器的列名称与 DataColumn 的名称完全匹配。

缓存值似乎也快了近**两倍**：

```
No Caching: 00:00:03.0996622
With Caching: 00:00:01.5659920 
```

所以最有效的方法*似乎*是：

```
 object temp;
 string variable;
 if (DBNull.Value != (temp = row["value"]))
 {
      variable = temp.ToString();
 } 
```

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-06-16T04:37:18.217

我肯定错过了什么。不是检查`DBNull`该方法的确切[`DataRow.IsNull`](http://msdn.microsoft.com/en-us/library/3fwatee0.aspx)作用吗？

我一直在使用以下两种扩展方法：

```
public static T? GetValue<T>(this DataRow row, string columnName) where T : struct
{
    if (row.IsNull(columnName))
        return null;

    return row[columnName] as T?;
}

public static string GetText(this DataRow row, string columnName)
{
    if (row.IsNull(columnName))
        return string.Empty;

    return row[columnName] as string ?? string.Empty;
} 
```

用法：

```
int? id = row.GetValue<int>("Id");
string name = row.GetText("Name");
double? price = row.GetValue<double>("Price"); 
```

如果您不想要`Nullable<T>`返回值`GetValue<T>`，您可以轻松地返回`default(T)`或其他选项。

* * *

在不相关的说明中，这是 Stevo3000 建议的 VB.NET 替代方案：

```
oSomeObject.IntMember = If(TryConvert(Of Integer)(oRow("Value")), iDefault)
oSomeObject.StringMember = If(TryCast(oRow("Name"), String), sDefault)

Function TryConvert(Of T As Structure)(ByVal obj As Object) As T?
    If TypeOf obj Is T Then
        Return New T?(DirectCast(obj, T))
    Else
        Return Nothing
    End If
End Function 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-21T12:01:04.840

您应该使用以下方法：

```
Convert.IsDBNull() 
```

考虑到它内置在框架中，我希望这是最有效的。

我建议以下内容：

```
int? myValue = (Convert.IsDBNull(row["column"]) ? null : (int?) Convert.ToInt32(row["column"])); 
```

是的，编译器应该为你缓存它。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-21T12:02:57.690

编译器不会优化索引器（即，如果您使用 row["value"] 两次），所以是的，这样做会*稍微*快一些：

```
object value = row["value"]; 
```

然后使用 value 两次；如果 .GetType() 为空，则使用 .GetType() 可能会出现问题...

`DBNull.Value`实际上是一个单例，所以要添加第四个选项 - 你也许可以使用 ReferenceEquals - 但实际上，我认为你在这里担心太多了......我不认为“is”，“== 之间的速度不同" 等将是您看到的任何性能问题的原因。**分析您的整个代码**并专注于重要的事情......不会是这样。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-14T20:27:17.963

I would use the following code in C# ([VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET) is not as simple).

The code assigns the value if it is not null/DBNull, otherwise it asigns the default which could be set to the LHS value allowing the compiler to ignore the assign.

```
oSomeObject.IntMemeber = oRow["Value"] as int? ?? iDefault;
oSomeObject.StringMember = oRow["Name"] as string ?? sDefault; 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-02-06T08:58:20.953

我觉得这里只有极少数方法不会让潜在的 OP 最担心（Marc Gravell、Stevo3000、Richard Szalay、Neil、Darren Koppand），而且大多数方法都不必要地复杂。充分意识到这是无用的微优化，我说你应该基本上使用这些：

1）不要从 DataReader/DataRow 读取值两次 - 因此要么在空检查和强制转换/转换之前缓存它，要么更好地直接将您的`record[X]`对象传递给具有适当签名的自定义扩展方法。

2) 要遵守上述规定，请勿在 DataReader/DataRow 上使用内置`IsDBNull`函数，因为它会在内部调用`record[X]`，因此实际上您将执行两次。

3) 一般来说，类型比较总是比值比较慢。只要`record[X] == DBNull.Value`做得更好。

4）直接铸造将比调用`Convert`类转换更快，尽管我担心后者会更少动摇。

5）最后，通过索引而不是列名访问记录将再次更快。

* * *

我觉得通过 Szalay、Neil 和 Darren Koppand 的方法会更好。我特别喜欢 Darren Koppand 的扩展方法方法，它包含`IDataRecord`（尽管我想进一步缩小到`IDataReader`）和索引/列名。

小心称呼它：

```
record.GetColumnValue<int?>("field"); 
```

并不是

```
record.GetColumnValue<int>("field"); 
```

如果您需要区分`0`和`DBNull`。例如，如果您在枚举字段中有空值，则`default(MyEnum)`可能会返回第一个枚举值。所以最好打电话`record.GetColumnValue<MyEnum?>("Field")`。

由于您正在阅读 a `DataRow`，因此我将为两者创建扩展方法，`DataRow`并`IDataReader`通过[DRYing](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)通用代码。

```
public static T Get<T>(this DataRow dr, int index, T defaultValue = default(T))
{
    return dr[index].Get<T>(defaultValue);
}

static T Get<T>(this object obj, T defaultValue) //Private method on object.. just to use internally.
{
    if (obj.IsNull())
        return defaultValue;

    return (T)obj;
}

public static bool IsNull<T>(this T obj) where T : class 
{
    return (object)obj == null || obj == DBNull.Value;
} 

public static T Get<T>(this IDataReader dr, int index, T defaultValue = default(T))
{
    return dr[index].Get<T>(defaultValue);
} 
```

所以现在这样称呼它：

```
record.Get<int>(1); //if DBNull should be treated as 0
record.Get<int?>(1); //if DBNull should be treated as null
record.Get<int>(1, -1); //if DBNull should be treated as a custom value, say -1 
```

我相信这首先应该在框架中（而不是`record.GetInt32`,`record.GetString`等方法） - 没有运行时异常，并为我们提供了处理空值的灵活性。

根据我的经验，我在使用一种通用方法从数据库中读取数据时运气不佳。我总是必须自定义处理各种类型，所以从长远来看，我必须编写自己的`GetInt`、`GetEnum`、`GetGuid`等方法。如果您想在默认情况下从 db 读取字符串时修剪空格，或者将`DBNull`其视为空字符串怎么办？或者，如果您的小数点应该被截断所有尾随零。`Guid`当底层数据库可以将它们存储为字符串或二进制文件时，我在不同的连接器驱动程序的行为方式上也遇到了最大的麻烦。我有这样的重载：

```
static T Get<T>(this object obj, T defaultValue, Func<object, T> converter)
{
    if (obj.IsNull())
        return defaultValue;

    return converter  == null ? (T)obj : converter(obj);
} 
```

使用 Stevo3000 的方法，我觉得调用有点丑陋和乏味，而且很难用它来制作通用函数。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-06-16T04:10:15.270

存在对象可能是字符串的麻烦情况。下面的扩展方法代码处理所有情况。以下是您将如何使用它：

```
 static void Main(string[] args)
    {
        object number = DBNull.Value;

        int newNumber = number.SafeDBNull<int>();

        Console.WriteLine(newNumber);
    }

    public static T SafeDBNull<T>(this object value, T defaultValue) 
    {
        if (value == null)
            return default(T);

        if (value is string)
            return (T) Convert.ChangeType(value, typeof(T));

        return (value == DBNull.Value) ? defaultValue : (T)value;
    } 

    public static T SafeDBNull<T>(this object value) 
    { 
        return value.SafeDBNull(default(T)); 
    } 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-21T12:07:16.497

我个人喜欢这种语法，它使用由 公开的显式 IsDbNull 方法`IDataRecord`，并缓存列索引以避免重复的字符串查找。

为提高可读性而扩展，它类似于：

```
int columnIndex = row.GetOrdinal("Foo");
string foo; // the variable we're assigning based on the column value.
if (row.IsDBNull(columnIndex)) {
  foo = String.Empty; // or whatever
} else { 
  foo = row.GetString(columnIndex);
} 
```

重写以适应 DAL 代码中的紧凑性以适合单行 - 请注意，在此示例中，我们分配`int bar = -1`if`row["Bar"]`为 null。

```
int i; // can be reused for every field.
string foo  = (row.IsDBNull(i  = row.GetOrdinal("Foo")) ? null : row.GetString(i));
int bar = (row.IsDbNull(i = row.GetOrdinal("Bar")) ? -1 : row.GetInt32(i)); 
```

如果您不知道它的存在，内联赋值可能会令人困惑，但它将整个操作保持在一行上，我认为当您从一个代码块中的多个列填充属性时，它可以提高可读性。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-21T13:36:43.557

并不是说我已经这样做了，但是您可以绕过双索引器调用，并且仍然可以通过使用静态/扩展方法来保持代码干净。

IE。

```
public static IsDBNull<T>(this object value, T default)
{
    return (value == DBNull.Value)
        ? default
        : (T)value;
}

public static IsDBNull<T>(this object value)
{
    return value.IsDBNull(default(T));
} 
```

然后：

```
IDataRecord record; // Comes from somewhere

entity.StringProperty = record["StringProperty"].IsDBNull<string>(null);
entity.Int32Property = record["Int32Property"].IsDBNull<int>(50);

entity.NoDefaultString = record["NoDefaultString"].IsDBNull<string>();
entity.NoDefaultInt = record["NoDefaultInt"].IsDBNull<int>(); 
```

还具有将空检查逻辑保留在一个位置的好处。当然，缺点是它是一个额外的方法调用。

只是一个想法。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-22T19:50:01.667

我尽量避免这种检查。

对于不能容纳的列，显然不需要这样做`null`。

如果您存储在 Nullable 值类型（`int?`等）中，您可以使用`as int?`.

如果你不需要区分`string.Empty`and `null`，你可以调用`.ToString()`，因为 DBNull 会返回`string.Empty`。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-26T01:22:53.160

我用扩展方法做了类似的事情。这是我的代码：

```
public static class DataExtensions
{
    /// <summary>
    /// Gets the value.
    /// </summary>
    /// <typeparam name="T">The type of the data stored in the record</typeparam>
    /// <param name="record">The record.</param>
    /// <param name="columnName">Name of the column.</param>
    /// <returns></returns>
    public static T GetColumnValue<T>(this IDataRecord record, string columnName)
    {
        return GetColumnValue<T>(record, columnName, default(T));
    }

    /// <summary>
    /// Gets the value.
    /// </summary>
    /// <typeparam name="T">The type of the data stored in the record</typeparam>
    /// <param name="record">The record.</param>
    /// <param name="columnName">Name of the column.</param>
    /// <param name="defaultValue">The value to return if the column contains a <value>DBNull.Value</value> value.</param>
    /// <returns></returns>
    public static T GetColumnValue<T>(this IDataRecord record, string columnName, T defaultValue)
    {
        object value = record[columnName];
        if (value == null || value == DBNull.Value)
        {
            return defaultValue;
        }
        else
        {
            return (T)value;
        }
    }
} 
```

要使用它，你会做类似的事情

```
int number = record.GetColumnValue<int>("Number",0) 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-25T20:08:18.303

这就是我处理从 DataRows 读取的方式

```
///<summary>
/// Handles operations for Enumerations
///</summary>
public static class DataRowUserExtensions
{
    /// <summary>
    /// Gets the specified data row.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="dataRow">The data row.</param>
    /// <param name="key">The key.</param>
    /// <returns></returns>
    public static T Get<T>(this DataRow dataRow, string key)
    {
        return (T) ChangeTypeTo<T>(dataRow[key]);
    }

    private static object ChangeTypeTo<T>(this object value)
    {
        Type underlyingType = typeof (T);
        if (underlyingType == null)
            throw new ArgumentNullException("value");

        if (underlyingType.IsGenericType && underlyingType.GetGenericTypeDefinition().Equals(typeof (Nullable<>)))
        {
            if (value == null)
                return null;
            var converter = new NullableConverter(underlyingType);
            underlyingType = converter.UnderlyingType;
        }

        // Try changing to Guid  
        if (underlyingType == typeof (Guid))
        {
            try
            {
                return new Guid(value.ToString());
            }
            catch

            {
                return null;
            }
        }
        return Convert.ChangeType(value, underlyingType);
    }
} 
```

使用示例：

```
if (dbRow.Get<int>("Type") == 1)
{
    newNode = new TreeViewNode
                  {
                      ToolTip = dbRow.Get<string>("Name"),
                      Text = (dbRow.Get<string>("Name").Length > 25 ? dbRow.Get<string>("Name").Substring(0, 25) + "..." : dbRow.Get<string>("Name")),
                      ImageUrl = "file.gif",
                      ID = dbRow.Get<string>("ReportPath"),
                      Value = dbRow.Get<string>("ReportDescription").Replace("'", "\'"),
                      NavigateUrl = ("?ReportType=" + dbRow.Get<string>("ReportPath"))
                  };
} 
```

怪物道具[得到了我的 .Net](http://monstersgotmy.net/post/QueryString-Candy-Could-Rot-Your-Teeth.aspx)用于 ChageTypeTo 代码。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-21T12:03:03.930

我总是使用：

```
if (row["value"] != DBNull.Value)
  someObject.Member = row["value"]; 
```

发现它简短而全面。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-02-25T07:23:08.780

如果在 DataRow 中的 row["fieldname"] isDbNull 用 0 替换它，否则得到十进制值：

```
decimal result = rw["fieldname"] as decimal? ?? 0; 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-05-20T07:14:00.310

我在一个从数据库中读取大量数据的程序中有 IsDBNull。使用 IsDBNull，它会在大约 20 秒内加载数据。没有 IsDBNull，大约 1 秒。

所以我认为最好使用：

```
public String TryGetString(SqlDataReader sqlReader, int row)
{
    String res = "";
    try
    {
        res = sqlReader.GetString(row);
    }
    catch (Exception)
    { 
    }
    return res;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-05-05T13:56:40.773

```
public static class DBH
{
    /// <summary>
    /// Return default(T) if supplied with DBNull.Value
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="value"></param>
    /// <returns></returns>
    public static T Get<T>(object value)
    {   
        return value == DBNull.Value ? default(T) : (T)value;
    }
} 
```

像这样使用

```
DBH.Get<String>(itemRow["MyField"]) 
```

# sql - 这个问题的最佳实践是什么（不同类别的不同属性）？

> ID：221584
> 
> 赞同：7
> 
> 时间：2008-10-21T11:56:36.473
> 
> 标签：sql, sql-server, database, database-design, entity-attribute-value

我有一些属于某个类别的产品。

每个类别可以有不同的属性。

例如，

*   类别*汽车*具有属性*颜色*，功率，...
*   类别*宠物*具有 *重量*，*年龄*，...

类别数约为 10-15。每个类别中的属性数量为 3-15。产品数量非常大。

这个应用程序的主要要求是非常好的搜索。我们将选择类别，并为该类别中的每个属性输入标准。

必须为这种情况设计数据库。(SQL Server 2005)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-21T12:17:49.253

经典的设计方法是（星号表示主键列）：

```
Product
  ProductId*
  CategoryId: FK to Category.CategroyId
  Name

Category
  CategoryId*
  Name

Property
  PropertyId*
  Name
  Type

CategoryProperty
  CategoryId*: FK to Category.CategoryId
  PropertyId*: FK to Property.PropertyId

ProductProperty
  ProductId*: FK to Product.ProductId
  PropertyId*: FK to Property.PropertyId
  ValueAsString 
```

如果您可以接受这样一个事实，即每个属性值都将作为字符串进入数据库，并且类型转换信息存储在属性表中，那么这种布局就足够了。

查询会是这样的：

```
SELECT
   Product.ProductId,
   Product.Name AS ProductName,
   Category.CategoryId,
   Category.Name AS CategoryName,
   Property.PropertyId,
   Property.Name AS PropertyName,
   Property.Type AS PropertyType,
   ProductProperty.ValueAsString
FROM
   Product 
   INNER JOIN Category         ON Category.CategoryId = Product.CategoryId
   INENR JOIN CategoryProperty ON CategoryProperty.CategoryId = Category.CategoryId
   INNER JOIN Property         ON Property.PropertyId = CategoryProperty.PropertyId
   INNER JOIN ProductProperty  ON ProductProperty.PropertyId = Property.PropertyId
                                  AND ProductProperty.ProductId = Product.ProductId
WHERE
   Product.ProductId = 1 
```

您提供的 WHERE 条件越多（联合使用，例如使用 AND），查询速度就越快。如果您已正确索引表，那就是。

事实上，该解决方案对于全文索引情况并不理想。一个以更非规范化的方式存储与 ProductId 关联的所有文本的附加表可以在这里提供帮助。此表需要通过侦听 ProductProperty 表中的更改的触发器进行更新。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T12:02:12.467

如果应用程序的用户*必须*在搜索之前选择一个类别，我会按类别将您的产品分成不同的数据库表。类别本身几乎没有共同点这一事实也表明了这种解决方案。按类别细分也会使每次搜索速度更快，因为当您的用户正在寻找宠物时，不会浪费时间搜索汽车。

将产品划分为类别后，使用每个类别中产品的通用属性创建表格应该很容易。您的应用程序的用户界面应该是动态的（我正在考虑一个 Web 表单），因为当用户选择一个类别时，用户可以选择的属性应该会发生变化。

请注意，如果您希望在多个类别中列出产品，此解决方案将导致表中出现重复数据。在设计数据库时，需要在速度和规范化之间进行权衡。如果您*没有*适合多个类别的产品，那么我认为这将是最快的解决方案（就搜索速度而言）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T17:02:41.080

大多数人建议使用实体-属性-值 (EAV) 设计的变体。这种设计对您的情况来说太过分了，它引入了一大堆问题，例如：

*   您不能为属性定义数据类型；您可以为整数属性输入“香蕉”
*   您不能将属性声明为强制（即常规表中的 NOT NULL）
*   您不能在属性上声明外键约束

如果您的类别较少，最好在 Bogdan Maxim 的答案中使用解决方案 A。也就是说，为所有类别定义一个具有公共属性的表 Products，并为每个类别定义一个附加表，以存储特定于类别的属性。

只有当您有无限数量的类别或者您必须在 Products 中的每行支持不同的属性集时，EAV 才是一个好的解决方案。但是你根本没有使用关系数据库，因为 EAV 违反了几个规范化规则。

如果您真的需要这么大的灵活性，最好将数据存储在 XML 中。实际上，您可能会研究 RDF 和[Sesame 之](http://www.openrdf.org/)类的语义 Web 框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T12:05:52.037

您可能需要考虑一种[实体-属性-值](http://en.wikipedia.org/wiki/Entity-attribute-value_model)类型的排列，您可以在其中使用任意名称/值属性对“标记”每个产品。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T12:08:16.947

你可以试试这个。我不太确定您问题的实际细节，也许有人可以帮助您翻译得更好一些。

5张桌子。3用于存储数据，2用于存储数据之间的映射。

```
tProduct 
  productID
  <other product details>

tCategory
  categoryID
  <other category details>

tProperty
  propertyID
  <other property details>

tProductXCategory
  productyID
  categoryID

tCategoryXProperty
  categoryID
  propertyID 
```

您的查询需要使用映射表连接数据，但这将允许您在类别、属性和产品之间建立不同的多对多关系。

使用存储过程或参数化查询从搜索中获得更好的性能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T13:03:47.710

你可以尝试一些更面向对象的东西。

## 1\. 为 Products 定义一个基表

`Products(ProductID, CategoryID, <any other common properties>)`

## 2.定义表Categories

`Categories(CategoryID, Name, Description, ..)`

从这里你有很多选项，几乎所有选项都会破坏数据库的规范化。

## 解决方案 A。

如果您需要添加新产品，这将是一场维护噩梦

## A1。为每个类别定义一个单独的表

`Cars(CarID, ProductID, ..)` `Pets(PetID, ProductID, ..)`

## A2。根据关系连接表以使用数据

`SELECT <fields> FROM Cars INNER JOIN Products ON Cars.ProductID = Products.ProductID`

## 解决方案 B。

不同类型属性（即 int、varchar 等）的维护噩梦

## B1。定义属性表

`CategoryProperty (CPID, Name, Type)`

## B2。定义一个表来保存类别和属性之间的关联

`PropertyAssociation (CPID, PropertyID)`

## B12。定义一个表格来保存属性（B1 和 B2 的替代方案）

`Properties(CategoryID, PropertyID, Name, Type)`

## B3。为每种类型的属性（int、double、varchar 等）添加一个值表

`PropertyValueInt(ProductID, CPID, PropertyID, Value)`- 对于 int `PropertyValueString(ProductID, CPID, PropertyID, Value)`- 对于字符串 `PropertyValueMoney(ProductID, CPID, PropertyID, Value)`- 对于金钱

## B4。加入所有表以检索所需的属性。

通过使用这种方法，您不必管理单独表中的所有属性，而是管理它们的值类型。基本上所有涉及的表都是查找表。缺点是，为了检索每个值，您必须对每个值类型进行“大小写”。

选择这些方法时，请记住这些文章（[此处](http://www.sqlservercentral.com/articles/Advanced/lookuptablemadness/1464/)和[此处）。](http://www.developerdotstar.com/community/lookup_table)[这个论坛帖子](http://www.sqlservercentral.com/Forums/Topic205432-230-1.aspx)也很有趣，并且与主题相关，即使它是关于本地化的。

如果您觉得需要，您也可以使用[Tomalak 的答案并添加强类型。](https://stackoverflow.com/questions/221584/what-is-best-practice-for-this-problem-different-properties-for-different-categ#221638)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T12:10:16.973

如果您想灵活处理类别和属性，则应创建以下表格：

*   产品：产品ID
*   类别：CategoryID、ProductID
*   属性：PropertyID、CategoryID

当您想通过 mroe 共享一个类别而不是一个产品时，您必须为 n:m 连接创建一个链接表：

*   productCategoryPointer：ProdCatID、ProductID、CategoryID。

您将不得不在您的查询中加入一些连接，但是使用正确的索引，您应该能够快速查询您的数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T13:09:01.427

我最近不得不这样做，我正在使用 NHibernate，我有三个实体

产品类别选项 OptionCategory

一个产品有 1* 个类别

一个产品有 1* 选项

一个选项有 1 个选项类别

一旦设置好，您就可以使用 Nhibernate 缓存

干杯

# javascript - iPhone 上的地理定位 API

> ID：221592
> 
> 赞同：40
> 
> 时间：2008-10-21T12:01:40.050
> 
> 标签：javascript, iphone, geolocation, gps

有谁知道 iPhone 是否支持或即将支持[W3C 地理定位规范](http://dev.w3.org/geo/api/spec-source.html)？

我希望为移动用户构建一个应用程序，但与其花时间为每个不同的平台（iPhone、Android 等）开发应用程序，我更愿意创建一个利用W3C 标准。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-07-15T21:14:27.747

这段代码对我有用——在 iPhone 网络浏览器**Safari上** *，*作为一个额外的好处，它甚至可以在我的笔记本电脑上与**FireFox 3.5**一起使用！Geolocation API 规范是 W3 联盟标准的一部分**但请注意：它尚未最终确定。**

[![替代文字](https://i.stack.imgur.com/iHatw.jpg)](https://i.stack.imgur.com/iHatw.jpg)
[（来源：[bemoko.com](http://blog.bemoko.com/wp-content/uploads/2009/06/iphone-geo-300-1-150x150.jpg)）] [（来源：][[bemoko.com](http://blog.bemoko.com/wp-content/uploads/2009/06/iphone-geo-300-2-150x150.jpg)][）][![替代文字](https://i.stack.imgur.com/94v2x.jpg)](https://i.stack.imgur.com/94v2x.jpg)

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Geolocation API Demo</title>
<meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" name="viewport"/>
<script>
function successHandler(location) {
    var message = document.getElementById("message"), html = [];
    html.push("<img width='256' height='256' src='http://maps.google.com/maps/api/staticmap?center=", location.coords.latitude, ",", location.coords.longitude, "&markers=size:small|color:blue|", location.coords.latitude, ",", location.coords.longitude, "&zoom=14&size=256x256&sensor=false' />");
    html.push("<p>Longitude: ", location.coords.longitude, "</p>");
    html.push("<p>Latitude: ", location.coords.latitude, "</p>");
    html.push("<p>Accuracy: ", location.coords.accuracy, " meters</p>");
    message.innerHTML = html.join("");
}
function errorHandler(error) {
    alert('Attempt to get location failed: ' + error.message);
}
navigator.geolocation.getCurrentPosition(successHandler, errorHandler);
</script>
</head>
<body>
<div id="message">Location unknown</div>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-19T08:36:36.657

在 iPhone 3.0 发布之后，您现在可以在 safari 浏览器中从 Javascript API 获取位置 - 我们创建了一个工作示例 @ [http://blog.bemoko.com/2009/06/17/iphone-30-geolocation-javascript-接口/](http://blog.bemoko.com/2009/06/17/iphone-30-geolocation-javascript-api/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-12-16T08:18:48.980

由于 iPhone OS 3.0 Safari 支持获取地理位置。请参阅：[Safari 参考库：获取地理位置](https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/GettingGeographicalLocations/GettingGeographicalLocations.html)另一方面，W3C Geo API 规范仍在草稿中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-18T17:41:06.877

我更新了 MyWhirledView 的代码。在我的 iOS 4.3 设备上运行良好。Google 不再需要 API 密钥来访问其静态地图库。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>iPhone 4.0 geolocation demo</title>
<meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" name="viewport"/>
<script>
function handler(location) {
var message = document.getElementById("message");
message.innerHTML ="<img src='http://maps.google.com/maps/api/staticmap?center=" + location.coords.latitude + "," + location.coords.longitude + "&zoom=14&size=256x256&maptype=roadmap&sensor=false&markers=color:blue%7Clabel:ABC%7C" + location.coords.latitude + "," + location.coords.longitude + "' />";

message.innerHTML+="<p>Longitude: " + location.coords.longitude + "</p>";
message.innerHTML+="<p>Accuracy: " + location.coords.accuracy + "</p>";
message.innerHTML+="<p>Latitude: " + location.coords.latitude + "</p>";

}
navigator.geolocation.getCurrentPosition(handler);
</script>
</head>
<body>
<div id="message">Location unknown</div>
</body>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-09T17:46:31.687

这就是我开发Locatable 应用程序的原因——它本质上是iPhone Safari 的一个插件。目前它仅适用于越狱手机。

见[http://lbs.tralfamadore.com/](http://lbs.tralfamadore.com/)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-07T00:11:30.447

可以在 iPhone 上用 JavaScript 获取 GPS 信息。QuickConnectiPhone 框架为您公开了这一点以及加速信息。

但是，要获取此信息，您必须在设备上安装应用程序。该框架很快将可用于 Android 安装的应用程序以及诺基亚。

您可以将您的应用程序放入每个设备的框架中，然后编译和发布。

QuickConnectiPhone 位于[https://sourceforge.net/projects/quickconnect/](https://sourceforge.net/projects/quickconnect/)

如果您联系我，我可以为您提供 Android 和诺基亚的预发布版本。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-05T18:38:23.517

[Rhodes](http://rhomobile.com/products/rhodes)承诺提供“一次开发，到处运行”的解决方案。自己没有试过。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-01-21T10:41:09.127

这个小型 javascript 库是**跨平台**的，开箱即用地支持所有现代智能手机：

> > [http://code.google.com/p/geo-location-javascript/](http://code.google.com/p/geo-location-javascript/)

以下是你如何使用它：

```
//determine if the handset has client side geo location capabilities
if(geo_position_js.init()){
   geo_position_js.getCurrentPosition(success_callback,error_callback);
}else{
   alert("Functionality not available");
} 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-10-21T12:24:31.843

目前，仅使用 JavaScript API 无法获取 iPhone 的 GPS 位置。有人说这会很好，但苹果当然不会公开评论未来的改进。

# c# - 如何计算 ObjectQuery 将返回多少个对象 ?

> ID：221593
> 
> 赞同：1
> 
> 时间：2008-10-21T12:01:43.293
> 
> 标签：c#, entity-framework

我正在构建一个这样的 ObjectQuery：

```
 string query = "select value obj from Entities.Class as obj " +
                       "where obj.Property = @Value";

        ObjectQuery<Class> oQuery = new ObjectQuery<Class>(query, EntityContext.Instance);
        oQuery.Parameters.Add(new ObjectParameter("Value", someVariable)); 
```

我现在可以将此对象分配为控件的 DataSource，或者使用 foreach 循环进行迭代，甚至强制实现到 List，但是，我可以计算将返回的对象的数量，而不强制实现吗？

我是否需要创建一个将执行 count() 的伴随查询，或者是否有一个函数可以在某处为我执行此操作？

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T12:15:50.833

`ObjectQuery<T>`implements `IQueryable<T>`，所以你不能简单地使用扩展方法：

```
int count = oQuery.Count(); 
```

如果你执行这个会发生什么？我本来希望整个查询只做一个 Count()...（并不是说我做了很多 EF...）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T12:16:39.583

ObjectQuery<T> 类实现了支持 Count() 方法的 IEnumerable<T> 接口。

你从中得到什么？

```
int count = oQuery.Count(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-02T14:44:35.960

如果计数小于 1，则它找到了一条新记录，如果没有，它已经有了该记录。

# asp.net-ajax - 如何获得一个位于 asp:UpdatePanel 内的按钮来更新整个页面？

> ID：221595
> 
> 赞同：3
> 
> 时间：2008-10-21T12:02:04.200
> 
> 标签：asp.net-ajax, triggers, updatepanel

我在更新面板中有一个按钮，我想更新整个页面。我已经设置`ChildrenAsTriggers="false"`和`UpdateMode="Conditional"`.

我在这里有一些示例代码来演示我的问题。

```
<asp:UpdatePanel ID="myFirstPanel" runat="server" ChildrenAsTriggers="false" UpdateMode="Conditional">
   <ContentTemplate>
      <asp:Button runat="server" ID="myFirstButton" Text="My First Button" onclick="myFirstButton_Click" />
      <asp:Button runat="server" ID="mySecondButton" Text="My Second Button" onclick="mySecondButton_Click" />
   </ContentTemplate>
</asp:UpdatePanel>

<asp:UpdatePanel ID="mySecondPanel" runat="server">
   <ContentTemplate>
       <asp:Label runat="server" ID="myFirstLabel" Text="My First Label"></asp:Label>
    </ContentTemplate>
    <Triggers>
       <asp:AsyncPostBackTrigger ControlID="myFirstButton" EventName="Click" />
    </Triggers>
</asp:UpdatePanel>
<asp:Label runat="server" ID="mySecondLabel" Text="My Second Label"></asp:Label> 
```

以及背后的代码：

```
protected void myFirstButton_Click(object sender, EventArgs e)
{
  myFirstLabel.Text = "Inside Panel " + DateTime.Now.ToString("mm:ss");
}
protected void mySecondButton_Click(object sender, EventArgs e)
{
  mySecondLabel.Text = "Outside Panel " + DateTime.Now.ToString("mm:ss");
} 
```

单击第二个按钮时，我想更新不在更新面板内的标签。第二个按钮需要在更新面板中。我不想将标签放入更新面板。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T12:51:18.780

尝试将 PostBackTrigger 添加到第一个 UpdatePanel，作为第二个按钮。这将告诉更新面板，该按钮应该进行完整的回发。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T13:01:56.310

ScriptManager.GetCurrent(Page).RegisterPostBackControl(button); 会解决你的问题

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T12:51:24.553

如果您像这样将 PostBackTrigger 添加到第一个更新面板

```
<Triggers>
   <asp:PostBackTrigger ControlID="mySecondButton" />
</Triggers> 
```

当单击第二个按钮时，这将导致完整的回帖发生。这是我正在寻找的确切行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-17T20:48:31.990

我有一个类似但稍微复杂一点的案例，我花了一天多的时间才弄清楚这个答案。（答案与@serkan 给出的答案基本相同。我只是在扩展它。）我们有一个 ASP.NET 用户控件，它有一个按钮，单击该按钮会生成图像并触发图像的下载. 这在普通页面上工作得很好，但当用户控件嵌入到更新面板中时就不行了。我不知道如何告诉更新面板只为这个按钮进行定期回发，特别是因为该按钮位于用户控件内，而使用它的页面没有明显的访问权限。

最终奏效的方法非常简单。无需尝试为面板指定回发触发器。相反，在*用户控件的 Page_Load 中，*我添加了以下内容：

```
 protected void Page_Load(object sender, EventArgs e)
    {
        // If the chart is within an update panel then we need to tell the script manager
        // to not do an asynch postback on chartdownload.  If we don't, the download
        // doesn't work.
        var scriptManager = ScriptManager.GetCurrent(Page);
        if (scriptManager != null)
        {
            scriptManager.RegisterPostBackControl(ChartSaveButton);
        }
        // Rest of Page_Load followed here... 
```

此外，我创建了`ChartSaveButton`属性来轻松访问按钮的控件：

```
 private Control ChartSaveButton
    {
        get { return FindControl("btnDownloadChart"); }
    } 
```

（“btnDownloadChart”是按钮的 ID。）

到达这里是一条痛苦的道路，但我很高兴解决方案如此优雅。我希望这能帮到您。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-21T12:49:59.750

对我来说，这个设置没有意义。请记住，虽然更新面板可能是一种非常容易实现类似 ajax 效果的好方法，但它们并不是在所有情况下都理想。

如果您的页面架构需要像您在示例中那样排列元素，则最好查看使用带有 javascript 的页面或服务方法来更新标签。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-10-21T12:24:00.770

如果标签不在更新面板中，刷新值的唯一方法是像在正常回发中一样刷新整个页面。您必须重定向到同一页面才能刷新它。即使请求来自更新面板，ajax 框架也知道要处理重定向，因此只需在按钮单击时执行 Response.Redirect(...) 。

# c# - 谁在为他们的博客使用 BlogEngine.Net？它运行良好吗？它会扩展吗？:P

> ID：221598
> 
> 赞同：4
> 
> 时间：2008-10-21T12:02:54.417
> 
> 标签：c#, blogs, blogengine.net

我正在考虑使用 BlogEngine.NET 来启动我的博客。我是一名 C# 程序员，我想知道 BlogEngine.NET 是否存在。

它的扩展性好吗？缓存是否正确？它是内存密集型的吗？您可以轻松添加/删除功能吗？

我也接受任何托管建议:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T14:38:37.877

我尝试过 dasBlog、subText 和 BlogEngine.Net，我个人认为 BlogEngine.Net 总体上是最可靠的开源 .Net 博客平台。但是与大多数开源项目一样，您应该期望给它加点油，以使其看起来和行为符合您的意愿。例如，我不得不修改核心并重新编译，以便能够在博客的首页上显示评论。

我在缓存方面经历了一些奇怪的事情。有时更改不会立即出现。如果它真的开始引起问题，那么配置中可能有一个设置可以使用。但整体缓存对我来说不是问题。

另一方面，该平台对我来说运行得非常快，也许是因为缓存运行良好。

我目前正在使用 BE.Net 实现我的第四个博客/站点。我对此非常满意，并期待在不久的将来为该项目做出贡献。我曾经是 subText 的忠实粉丝，但 BE 只是把它从水中吹出来。再加上 subText revs 不是很频繁，Haack 正在寻找用 ASP MVC 重写整个东西，这很有趣，但是 ASP MVC 不是我想学习的东西，只是为了可以皮肤和自定义我的博客实例.

问候。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T12:46:51.567

我正在运行 BlogEngine.Net。我不知道缩放，因为我的博客还没有那么受欢迎。我很高兴。我之前尝试过潜文本，但遇到了一些稳定性问题，它记录了我发现难以调试的异常。我将数据库导出到 BlogML 时出错，它打乱了我的博客文章的顺序。BlogEngine.Net 似乎要稳定得多。

我正在由我的朋友托管的虚拟化服务器上​​运行。我没有看到任何性能问题，但这可能是因为每天有 15 名访问者的峰值负载。Live Writer 两次发布博客条目时遇到了一些麻烦，但我怀疑这是 Live Writer 的错。

我真的很喜欢扩展模型以及在博客设计中拖放扩展的方式。目前还没有多少主题支持这一点，但我通过在大约三个小时内更改标准主题创建了自己的外观和感觉。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T14:12:08.447

它对我们来说运行良好。我确实看到了非常罕见的情况，当我们遇到 DDOS 时内存猛增（似乎是某种内存泄漏），但总的来说，它运行良好。我们没有运行最受欢迎的博客，但我们的一些帖子确实获得了大量流量。

我们也为我们的目的编写了自己的插件。

( [http://blog.lavablast.com](http://blog.lavablast.com) )

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T18:38:54.317

我在 Mono 上运行它。我从 livejournal 导入了我的帖子，并为我的需要编写了一些扩展。它在 Mono 和国际化方面存在一些问题，但总的来说我非常喜欢它——如果你是 .net 开发人员，它很容易理解和修改。工作的速度和逻辑都很好。无法说明稳定性或缓存，因为到目前为止我还没有体验过斜线点效果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T15:55:26.240

请在网络农场或云上支持 BlogEngine.net 进行研究。BE.net 从来没有被设计为在这些环境中工作，并且有一些技巧可以帮助......

所有帖子都存储在内存中（我在查看他们的搜索引擎时发现了这一点），所以有点担心这将如何扩展。

不然写的好！

# java - Hibernate 和 MySQL 的创建时间戳和上次更新时间戳

> ID：221611
> 
> 赞同：284
> 
> 时间：2008-10-21T12:06:50.117
> 
> 标签：java, hibernate, timestamp

对于某个 Hibernate 实体，我们需要存储其创建时间和上次更新时间。你会怎么设计这个？

*   您将在数据库中使用哪些数据类型（假设 MySQL，可能与 JVM 在不同的时区）？数据类型会感知时区吗？

*   你会在 Java 中使用哪些数据类型（`Date`, `Calendar`, `long`, ...）？

*   你会让谁负责设置时间戳——数据库、ORM 框架（Hibernate）还是应用程序程序员？

*   您会为映射使用哪些注释（例如`@Temporal`）？

我不仅在寻找一个可行的解决方案，而且在寻找一个安全且设计良好的解决方案。

* * *

## 回答 #1

> 赞同：290
> 
> 时间：2008-10-21T13:14:29.233

如果您正在使用 JPA 注释，则可以使用`@PrePersist`事件`@PreUpdate`挂钩来执行此操作：

```
@Entity
@Table(name = "entities")    
public class Entity {
  ...

  private Date created;
  private Date updated;

  @PrePersist
  protected void onCreate() {
    created = new Date();
  }

  @PreUpdate
  protected void onUpdate() {
    updated = new Date();
  }
} 
```

或者您可以`@EntityListener`在类上使用注释并将事件代码放在外部类中。

* * *

## 回答 #2

> 赞同：202
> 
> 时间：2016-09-10T16:01:22.407

您可以使用`@CreationTimestamp`and `@UpdateTimestamp`：

```
@CreationTimestamp
@Temporal(TemporalType.TIMESTAMP)
@Column(name = "create_date")
private Date createDate;

@UpdateTimestamp
@Temporal(TemporalType.TIMESTAMP)
@Column(name = "modify_date")
private Date modifyDate; 
```

* * *

## 回答 #3

> 赞同：122
> 
> 时间：2010-10-27T22:49:30.073

使用这篇文章中的资源以及从不同来源获取的信息，我提出了这个优雅的解决方案，创建以下抽象类

```
import java.util.Date;

import javax.persistence.Column;
import javax.persistence.MappedSuperclass;
import javax.persistence.PrePersist;
import javax.persistence.PreUpdate;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;

@MappedSuperclass
public abstract class AbstractTimestampEntity {

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = "created", nullable = false)
    private Date created;

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = "updated", nullable = false)
    private Date updated;

    @PrePersist
    protected void onCreate() {
    updated = created = new Date();
    }

    @PreUpdate
    protected void onUpdate() {
    updated = new Date();
    }
} 
```

并让您的所有实体扩展它，例如：

```
@Entity
@Table(name = "campaign")
public class Campaign extends AbstractTimestampEntity implements Serializable {
...
} 
```

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2020-02-23T08:00:57.463

1.  您应该使用哪些数据库列类型

* * *

你的第一个问题是：

> 您将在数据库中使用哪些数据类型（假设 MySQL，可能与 JVM 在不同的时区）？数据类型会感知时区吗？

在 MySQL 中，`TIMESTAMP`column 类型会从 JDBC 驱动本地时区转移到数据库时区，但它最多只能存储时间戳`2038-01-19 03:14:07.999999`，因此它不是未来的最佳选择。

所以，最好`DATETIME`改用它，它没有这个上限限制。但是，`DATETIME`不知道时区。因此，出于这个原因，最好在数据库端使用 UTC 并使用`hibernate.jdbc.time_zone`Hibernate 属性。

2.  您应该使用什么实体属性类型

* * *

你的第二个问题是：

> 你会在 Java 中使用哪些数据类型（日期、日历、长......）？

在 Java 方面，您可以使用 Java 8 `LocalDateTime`。您也可以使用 legacy `Date`，但 Java 8 Date/Time 类型更好，因为它们是不可变的，并且在记录它们时不要将时区转换为本地时区。

现在，我们也可以回答这个问题：

> 您会为映射使用哪些注释（例如`@Temporal`）？

如果您使用`LocalDateTime`or`java.sql.Timestamp`来映射时间戳实体属性，那么您不需要使用`@Temporal`，因为 HIbernate 已经知道该属性将被保存为 JDBC 时间戳。

只有在使用`java.util.Date`时，才需要指定`@Temporal`注解，如下所示：

```
@Temporal(TemporalType.TIMESTAMP)
@Column(name = "created_on")
private Date createdOn; 
```

但是，如果你像这样映射它会更好：

```
@Column(name = "created_on")
private LocalDateTime createdOn; 
```

## 如何生成审计列值

你的第三个问题是：

> 你会让谁负责设置时间戳——数据库、ORM 框架（Hibernate）还是应用程序程序员？
> 
> 您会为映射使用哪些注释（例如@Temporal）？

有很多方法可以实现这一目标。您可以允许数据库执行此操作..

对于该`create_on`列，您可以使用`DEFAULT`DDL 约束，例如：

```
ALTER TABLE post 
ADD CONSTRAINT created_on_default 
DEFAULT CURRENT_TIMESTAMP() FOR created_on; 
```

对于`updated_on`列，您可以使用 DB 触发器在`CURRENT_TIMESTAMP()`每次修改给定行时设置列值。

或者，使用 JPA 或 Hibernate 来设置这些。

假设您有以下数据库表：

[![具有审计列的数据库表](https://i.stack.imgur.com/DQ59s.png)](https://i.stack.imgur.com/DQ59s.png)

而且，每个表都有如下列：

*   `created_by`
*   `created_on`
*   `updated_by`
*   `updated_on`

## 使用 Hibernate`@CreationTimestamp`和`@UpdateTimestamp`注解

Hibernate 提供了`@CreationTimestamp`和`@UpdateTimestamp`注释，可用于映射`created_on`和`updated_on`列。

您可以使用它`@MappedSuperclass`来定义将由所有实体扩展的基类：

```
@MappedSuperclass
public class BaseEntity {

    @Id
    @GeneratedValue
    private Long id;

    @Column(name = "created_on")
    @CreationTimestamp
    private LocalDateTime createdOn;

    @Column(name = "created_by")
    private String createdBy;

    @Column(name = "updated_on")
    @UpdateTimestamp
    private LocalDateTime updatedOn;

    @Column(name = "updated_by")
    private String updatedBy;

    //Getters and setters omitted for brevity
} 
```

而且，所有实体都将扩展`BaseEntity`，如下所示：

```
@Entity(name = "Post")
@Table(name = "post")
public class Post extend BaseEntity {

    private String title;

    @OneToMany(
        mappedBy = "post",
        cascade = CascadeType.ALL,
        orphanRemoval = true
    )
    private List<PostComment> comments = new ArrayList<>();

    @OneToOne(
        mappedBy = "post",
        cascade = CascadeType.ALL,
        orphanRemoval = true,
        fetch = FetchType.LAZY
    )
    private PostDetails details;

    @ManyToMany
    @JoinTable(
        name = "post_tag",
        joinColumns = @JoinColumn(
            name = "post_id"
        ),
        inverseJoinColumns = @JoinColumn(
            name = "tag_id"
        )
    )
    private List<Tag> tags = new ArrayList<>();

    //Getters and setters omitted for brevity
} 
```

但是，即使`createdOn`和`updateOn`属性是由特定于 Hibernate 的`@CreationTimestamp`和`@UpdateTimestamp`注释设置的，`createdBy`和 也`updatedBy`需要注册应用程序回调，如下面的 JPA 解决方案所示。

## 使用 JPA`@EntityListeners`

您可以将审计属性封装在 Embeddable 中：

```
@Embeddable
public class Audit {

    @Column(name = "created_on")
    private LocalDateTime createdOn;

    @Column(name = "created_by")
    private String createdBy;

    @Column(name = "updated_on")
    private LocalDateTime updatedOn;

    @Column(name = "updated_by")
    private String updatedBy;

    //Getters and setters omitted for brevity
} 
```

并且，创建一个`AuditListener`来设置审计属性：

```
public class AuditListener {

    @PrePersist
    public void setCreatedOn(Auditable auditable) {
        Audit audit = auditable.getAudit();

        if(audit == null) {
            audit = new Audit();
            auditable.setAudit(audit);
        }

        audit.setCreatedOn(LocalDateTime.now());
        audit.setCreatedBy(LoggedUser.get());
    }

    @PreUpdate
    public void setUpdatedOn(Auditable auditable) {
        Audit audit = auditable.getAudit();

        audit.setUpdatedOn(LocalDateTime.now());
        audit.setUpdatedBy(LoggedUser.get());
    }
} 
```

要注册`AuditListener`，您可以使用`@EntityListeners`JPA 注释：

```
@Entity(name = "Post")
@Table(name = "post")
@EntityListeners(AuditListener.class)
public class Post implements Auditable {

    @Id
    private Long id;

    @Embedded
    private Audit audit;

    private String title;

    @OneToMany(
        mappedBy = "post",
        cascade = CascadeType.ALL,
        orphanRemoval = true
    )
    private List<PostComment> comments = new ArrayList<>();

    @OneToOne(
        mappedBy = "post",
        cascade = CascadeType.ALL,
        orphanRemoval = true,
        fetch = FetchType.LAZY
    )
    private PostDetails details;

    @ManyToMany
    @JoinTable(
        name = "post_tag",
        joinColumns = @JoinColumn(
            name = "post_id"
        ),
        inverseJoinColumns = @JoinColumn(
            name = "tag_id"
        )
    )
    private List<Tag> tags = new ArrayList<>();

    //Getters and setters omitted for brevity
} 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2014-04-25T05:25:55.630

使用 Olivier 的解决方案，在更新语句期间，您可能会遇到：

> com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException：列“创建”不能为空

为了解决这个问题，将 updatable=false 添加到“created”属性的@Column 注释中：

```
@Temporal(TemporalType.TIMESTAMP)
@Column(name = "created", nullable = false, updatable=false)
private Date created; 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2011-10-21T01:32:29.253

您还可以使用拦截器来设置值

创建一个名为 TimeStamped 的接口，您的实体实现该接口

```
public interface TimeStamped {
    public Date getCreatedDate();
    public void setCreatedDate(Date createdDate);
    public Date getLastUpdated();
    public void setLastUpdated(Date lastUpdatedDate);
} 
```

定义拦截器

```
public class TimeStampInterceptor extends EmptyInterceptor {

    public boolean onFlushDirty(Object entity, Serializable id, Object[] currentState, 
            Object[] previousState, String[] propertyNames, Type[] types) {
        if (entity instanceof TimeStamped) {
            int indexOf = ArrayUtils.indexOf(propertyNames, "lastUpdated");
            currentState[indexOf] = new Date();
            return true;
        }
        return false;
    }

    public boolean onSave(Object entity, Serializable id, Object[] state, 
            String[] propertyNames, Type[] types) {
            if (entity instanceof TimeStamped) {
                int indexOf = ArrayUtils.indexOf(propertyNames, "createdDate");
                state[indexOf] = new Date();
                return true;
            }
            return false;
    }
} 
```

并将其注册到会话工厂

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-23T14:22:36.520

感谢所有帮助过的人。在自己做了一些研究之后（我是提出这个问题的人），这是我发现最有意义的：

*   数据库列类型：自 1970 年以来与时区无关的毫秒数，表示为**`decimal(20)`**因为 2^64 有 20 位并且磁盘空间很便宜；让我们直截了当。另外，我不会使用`DEFAULT CURRENT_TIMESTAMP`, 也不会使用触发器。我不想在数据库中使用魔法。

*   Java 字段类型：**`long`**. Unix 时间戳在各种库中得到很好的支持，`long`没有 Y2038 问题，时间戳算法快速简单（主要是 operator`<`和 operator `+`，假设计算中不涉及天/月/年）。而且，最重要的是，与 s 不同，原始`long`s 和`java.lang.Long`s 都是**不可变**的——有效地按值传递`java.util.Date`；`foo.getLastUpdate().setTime(System.currentTimeMillis())`在调试别人的代码时，我真的很生气。

*   ORM 框架应该负责自动填充数据。

*   我还没有对此进行测试，但只查看了我认为**`@Temporal`**可以完成这项工作的文档；不确定我是否可以`@Version`用于此目的。 **`@PrePersist`**并且**`@PreUpdate`**是手动控制的好选择。将它添加到所有实体的层超类型（公共基类）中，是一个可爱的想法，前提是您确实希望为*所有*实体添加时间戳。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2015-10-14T16:20:57.873

如果您使用的是 Session API，则 PrePersist 和 PreUpdate 回调将无法根据此[答案](https://stackoverflow.com/a/4133629)工作。

我在我的代码中使用 Hibernate Session 的 persist() 方法，所以我可以完成这项工作的唯一方法是使用下面的代码并遵循这篇[博](http://notatube.blogspot.ro/2010/03/hibernate-using-event-listener-to-set.html)文（也发布在[答案](https://stackoverflow.com/a/4133629)中）。

```
@MappedSuperclass
public abstract class AbstractTimestampEntity {

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = "created")
    private Date created=new Date();

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = "updated")
    @Version
    private Date updated;

    public Date getCreated() {
        return created;
    }

    public void setCreated(Date created) {
        this.created = created;
    }

    public Date getUpdated() {
        return updated;
    }

    public void setUpdated(Date updated) {
        this.updated = updated;
    }
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2020-12-11T12:00:50.713

对于那些想要创建或修改用户详细信息以及使用 JPA 和 Spring Data 的时间的人可以遵循这个。您可以 在基本域中添加`@CreatedDate`、`@LastModifiedDate`和。用和标记基本域，如下所示：`@CreatedBy``@LastModifiedBy``@MappedSuperclass``@EntityListeners(AuditingEntityListener.class)`

```
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseDomain implements Serializable {

    @CreatedDate
    private Date createdOn;

    @LastModifiedDate
    private Date modifiedOn;

    @CreatedBy
    private String createdBy;

    @LastModifiedBy
    private String modifiedBy;

} 
```

由于我们用标记了基域，`AuditingEntityListener`我们可以告诉 JPA 当前登录的用户。所以我们需要提供一个 AuditorAware 和 override`getCurrentAuditor()`方法的实现。而在里面`getCurrentAuditor()`我们需要返回当前授权的用户ID。

```
public class AuditorAwareImpl implements AuditorAware<String> {
    @Override
    public Optional<String> getCurrentAuditor() {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        return authentication == null ? Optional.empty() : Optional.ofNullable(authentication.getName());
    }
} 
```

在上面的代码中，如果`Optional`不工作，您可以使用 Java 7 或更早版本。在这种情况下，请尝试`Optional`使用`String`.

现在要启用上述 Auditior 实现，请使用以下代码

```
@Configuration
@EnableJpaAuditing(auditorAwareRef = "auditorAware")
public class JpaConfig {
    @Bean
    public AuditorAware<String> auditorAware() {
        return new AuditorAwareImpl();
    }
} 
```

现在您可以将该`BaseDomain`类扩展到您想要创建和修改的日期和时间以及用户 ID 的所有实体类

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-04-22T22:27:54.290

现在还有@CreatedDate 和@LastModifiedDate 注释。

=> [https://programmingmitra.blogspot.fr/2017/02/automatic-spring-data-jpa-auditing-saving-CreatedBy-createddate-lastmodifiedby-lastmodifieddate-automatically.html](https://programmingmitra.blogspot.fr/2017/02/automatic-spring-data-jpa-auditing-saving-CreatedBy-createddate-lastmodifiedby-lastmodifieddate-automatically.html)

（弹簧框架）

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2019-04-06T06:42:12.040

以下代码对我有用。

```
package com.my.backend.models;

import java.util.Date;

import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.MappedSuperclass;

import com.fasterxml.jackson.annotation.JsonIgnore;

import org.hibernate.annotations.ColumnDefault;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import lombok.Getter;
import lombok.Setter;

@MappedSuperclass
@Getter @Setter
public class BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    protected Integer id;

    @CreationTimestamp
    @ColumnDefault("CURRENT_TIMESTAMP")
    protected Date createdAt;

    @UpdateTimestamp
    @ColumnDefault("CURRENT_TIMESTAMP")
    protected Date updatedAt;
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-21T12:27:44.943

一个好的方法是为所有实体创建一个通用基类。在这个基类中，如果它在您的所有实体（通用设计）、您的创建和上次更新日期属性中通用命名，您可以拥有您的 id 属性。

对于创建日期，您只需保留一个*java.util.Date*属性。请务必始终使用*new Date()*对其进行初始化。

对于最后一个更新字段，您可以使用 Timestamp 属性，您需要使用 @Version 对其进行映射。使用此注释，Hibernate 将自动更新属性。请注意，Hibernate 也会应用乐观锁定（这是一件好事）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-21T13:02:30.800

只是为了强调：**`java.util.Calender`不适用于 Timestamps**。 `java.util.Date`有一段时间，与时区等区域性事物无关。大多数数据库以这种方式存储东西（即使它们看起来不是；这通常是客户端软件中的时区设置；数据很好）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-21T12:30:52.660

作为 JAVA 中的数据类型，我强烈推荐使用 java.util.Date。我在使用日历时遇到了非常讨厌的时区问题。看到这个[线程](https://stackoverflow.com/questions/82235/is-there-a-problem-with-jpa-entities-oracle-10g-and-calendar-type-properties)。

对于设置时间戳，我建议使用 AOP 方法，或者您可以简单地在表上使用触发器（实际上这是我发现使用触发器唯一可以接受的方法）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-21T13:16:32.287

您可以考虑将时间存储为 DateTime 和 UTC。我通常使用 DateTime 而不是 Timestamp，因为 MySql 在存储和检索数据时会将日期转换为 UTC 并返回本地时间。我宁愿将任何一种逻辑保留在一个地方（业务层）。我确信在其他情况下使用 Timestamp 更可取。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-06-24T07:35:57.977

我们也有类似的情况。我们使用的是 Mysql 5.7。

```
CREATE TABLE my_table (
        ...
      updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ); 
```

这对我们有用。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-09-23T13:29:11.703

如果我们在方法中使用@Transactional，@CreationTimestamp 和**@UpdateTimestamp**会将值保存在DB 中，但在使用save(...) 后将返回null。

在这种情况下，使用 saveAndFlush(...) 就可以了

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-09-27T09:29:14.683

我认为在 Java 代码中不这样做会更整洁，您可以简单地在 MySql 表定义中设置列默认值。 [![在此处输入图像描述](https://i.stack.imgur.com/DwpZG.png)](https://i.stack.imgur.com/DwpZG.png)

# authentication - Websphere 6.1 和基本身份验证

> ID：221629
> 
> 赞同：0
> 
> 时间：2008-10-21T12:15:24.373
> 
> 标签：authentication, websphere, websphere-6.1

我有一个用于 BASIC 页面身份验证的示例文件，它在 tomcat 中完美运行，但在 websphere 中根本无法运行。有什么想法需要在 Websphere 中以不同方式完成吗？

谢谢达米安

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-13T14:21:20.280

达米安，

请查看标题为“保护 Web 应用程序”的 Websphere 6.1 安全手册第 7 章： [http ://www.redbooks.ibm.com/redbooks/pdfs/sg246316.pdf](http://www.redbooks.ibm.com/redbooks/pdfs/sg246316.pdf)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-13T09:37:57.100

您是否在 Websphere 上启用了全局安全性？

# log4net - 混合 log4cxx 和 log4net

> ID：221648
> 
> 赞同：7
> 
> 时间：2008-10-21T12:21:43.753
> 
> 标签：log4net, log4cxx

我有一个 c++ 应用程序，它使用 log4cxx（RollingFile appender）记录到某个文件。我想同时从另一个用 c# 编写的模块登录到同一个文件；所以我将 log4net 配置为使用相同的文件，但我无法获取新消息。如果我停用 c++ 日志记录，我可以看到 c# 消息。所以我认为这是一个锁定问题，并寻找一个配置选项来告诉 log4cxx 不要锁定文件。我进入了 log4net 的 MinimalLock 模型，但在 log4cxx 中找不到任何东西......有人知道它是否可以完成，以及如何完成？

提前致谢，

埃内斯托·卡伦

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T12:38:04.437

我认为，只要您尝试将两个不同的进程记录到同一个文件，无论您使用什么配置，您都可能会遇到并发和争用问题。

您应该考虑将日志事件从两个进程发送到第三个集中位置 - 看看log4net 中的[RemotingAppender](http://logging.apache.org/log4net/release/sdk/log4net.Appender.RemotingAppender.html)，我假设 log4cxx 有类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T22:35:00.987

即使问题很老（并标记为已回答）并且您可能已经完成了您的项目：

log4net 和 log4cxx 是不同的日志记录框架，它们彼此不知道，因此您无法将它们配置为写入同一个文件。只有一个框架会打开文件以进行写入，以先到者为准。

我在类似情况下所做的（具有自定义日志记录的旧 c++ 应用程序使用 log4net 的新 c# 模块）是[创建一个自定义 log4net 附加程序](http://www.google.com/search?hl=en&q=log4net+custom+appender&btnG=Google+Search&cts=1234823516335&aq=0&oq=log4net+custom)，它将跟踪转发到旧的日志记录框架。在我参与的项目中，旧的 C++ 代码有一个 Windows COM 接口，用于编写自定义附加程序使用的日志消息。

另一种方法是使用 C++/CLI 创建自定义附加程序。

# database - 规范跨表共享的公共 ID 类型

> ID：221652
> 
> 赞同：1
> 
> 时间：2008-10-21T12:23:46.947
> 
> 标签：database, database-design, normalization

这是问题的简化版本。

我们有客户向我们发送大量数据，然后进行查询。他们要求我们有几个“公共”ID，他们可以用来查询我们的数据。（大多数人希望通过他们与数据一起发送的 id 来查询我们的系统，但并非总是如此）。为简单起见，我们称它们为“pid”、“crid”和“musicbrainzid”。我们有一个“实体”表来存储这些信息。它看起来像这样（“权威”是发送数据的人）：

```
entity 
-- 
entity_id   
authority  // who sent the data
type       // 'pid', 'crid', 'musicbrainz', etc.
value      // the actual id value 
```

然后我们有单独的实体，例如“episode”、“series”和“broadcast”（实际上，还有很多，但我在这里保持简单）。其中每一个都有一个指向实体表的 entity_id。

外部客户如何通过 pid 或 crid 搜索并获得适当的剧集或系列，以及正确识别它是什么？给定一个 pid，我们可以获取实体 id，但是我们需要在剧集、系列和广播表中搜索该值。此外，并非所有 id 都必然与所有其他表相关，但任何实体（例如，“episode”）都可能具有多个 id（pid、crid 等）

策略：

1.  查找 pid 的实体 id 并在每个其他表中搜索该 pid。
2.  在实体上放置一个“entity_type”列，但如果它是剧集表中的 pid，但我们不小心将剧集.type 设置为系列怎么办？我们不想复制数据，也不想将数据库元数据放入列值中。

选项 1 很慢而且似乎是错误的（此外，各种表的结构不同，这会造成问题）。

选项 2 表示重复数据，并且此数据可能不同步。我们可以使用触发器来强制执行此操作，但这看起来非常讨厌，而且无论如何，mysql 触发器实现中的错误已经多次袭击我们。我们现在正在使用这种策略，但没有触发器。

选项3是什么？

旁注：我们知道我们需要将“权限”分解到一个单独的表中，因为并非所有权限/类型组合都是有效的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T12:49:12.917

如果我正确理解了您的问题，我会选择选项 1。

基于 entity_id 标识行的查询不应该那么慢，因为所有数据都应该在索引中。
如果您的索引配置正确，这甚至不应该访问实际数据。（至少在 SQL Server 中不会。）

我要做的一个小改变是创建一小组表来标识哪些 id 对哪些表有效。
然后，您将使用它来缩小需要搜索的表的范围。

选项 1 或 2 的替代方案可能是完全更改您的数据库结构，将不同的数据存储在同一个表上，使用 entity_id 作为主键，并使用包含数据的通用列。
这肯定会更加激进，但我已经看到它适用于像您这样的数据及其结构非常动态的系统。

# command-line - 如何在 Enterprise Architect 中自动生成 HTML 输出

> ID：221654
> 
> 赞同：9
> 
> 时间：2008-10-21T12:24:09.163
> 
> 标签：command-line, uml, enterprise-architect

Enterprise Architect 有一种方法可以在 HTML/RTF/etc 中生成文档。您可以发布，但您必须使用其 GUI 手动执行此操作。当您在 CVS/Subversion 服务器中拥有 *.eap 文件时，拥有一个每天检查最新版本并将其发布到 Web 服务器的脚本会很有用。据我所知，EA 没有用于此目的的命令行实用程序。我发现您可以使用它的 COM 接口自动化几乎任何事情，但这意味着需要编写一个小程序来做到这一点。关于最简单/最干净的方法的任何想法（如果可能，无需编写代码）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-23T21:48:49.397

恐怕您需要编写一些代码，但不应超过十几行左右。您将要调用的函数是 Project.RunHTMLReport() - 在 EA 帮助文件中快速搜索“RunHTMLReport”会告诉您它需要哪些参数，在 Sparx 网站论坛上搜索会找到一两个示例。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T22:13:40.097

谢谢黑猩猩，这比我想象的要容易。在 Java 中：

```
class EADump
{
    public static void main(String[] args)
    {
     org.sparx.Repository r = new org.sparx.Repository();

     System.out.println("Repository: " + args[0]);
     System.out.println("Package:    " + args[1]);
     System.out.println("Output:     " + args[2]);
     r.OpenFile(args[0]);
     r.GetProjectInterface().RunHTMLReport(args[1], args[2], "GIF", "<default>", ".html");
     r.CloseFile();
    }
} 
```

# asp.net-mvc - ASP.NET MVC CTP（第一版）卸载失败

> ID：221669
> 
> 赞同：0
> 
> 时间：2008-10-21T12:35:48.967
> 
> 标签：asp.net-mvc, visual-studio-2008, uninstallation, visual-studio-addins

msi 执行的有问题的命令是：

```
 .\devenv.com /command "View.Toolbox" /setup 
```

这会因日期执行预防错误而失败。

devenv.exe 日志包含一堆这样的错误：

```
 <entry>
    <record>120</record>
    <time>2008/10/21 12:32:01.277</time>
    <type>Warning</type>
    <source>Microsoft Visual Studio Appid Stub</source>
    <description>CheckPackageSignature failed; invalid Package Load Key</description>
    <guid>{0C6E6407-13FC-4878-869A-C8B4016C57FE}</guid>
  </entry> 
```

并以：

```
 <entry>
    <record>122</record>
    <time>2008/10/21 12:32:05.817</time>
    <type></type>
    <source>Microsoft Visual Studio</source>
    <description>Destroying Main Window</description>
  </entry> 
```

帮助？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T13:04:21.280

使用 msiexec 并强制更新/卸载和卸载克隆侦探（用于 VS.NET）解决了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T12:40:28.350

您是否已将此信息发送给 MVC 框架的开发人员？我认为他们很高兴得到这样的信息。

# spam-prevention - 可以做些什么来防止类似论坛的应用程序中的垃圾邮件？

> ID：221674
> 
> 赞同：4
> 
> 时间：2008-10-21T12:38:58.803
> 
> 标签：spam-prevention

除了 CAPTCHA 之外，还有其他方法可以用于[Pastie.org](http://pastie.org)或[p.ramaze.net](http://p.ramaze.net)等网络应用程序吗？对于我的口味来说，验证码需要很长时间才能制成小糊状物。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T12:48:56.337

你可以试试[蜜罐验证码](http://haacked.com/archive/2007/09/11/honeypot-captcha.aspx)。本质上，您使用 CSS 隐藏了一些表单字段。您的用户永远不会填写这些字段，因为他们不会看到它们，但不支持 CSS 的垃圾邮件机器人会填写它们。在服务器端，您只需忽略评论/粘贴/等。填写了该字段。

除了蜜罐，您还可以使用时间戳和一次性令牌来阻止重放攻击。下面是[结合这两种技术的讨论](http://nedbatchelder.com/text/stopbots.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T12:49:11.747

就个人而言，在我的博客上，我收到了很多来自机器人的垃圾邮件。在分析了垃圾邮件的样子后，我做了一些快速的正则表达式来检测诸如充满链接的帖子，或者主题、评论和名称字段都填充相同文本的情况。如果帖子被阻止，我会显示一条很好的用户友好消息。由于我采用了这种技术，我每周收到数百条垃圾评论，几乎为零。我想我想说的是，分析您收到的垃圾邮件流量，看看是否有一种简单的方法可以将其删除，只需进行一些简单的分析，而不是求助于验证码之类的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T12:48:29.720

我之前已经成功使用过 hashcash。

它需要启用 javascript 的浏览器并将帖子延迟几秒钟（可配置），但具有不增加 UI 复杂性的优点。

*虽然hashcash**本身* 并不能避免垃圾邮件，但它要求垃圾邮件发送者浪费时间计算 javascript 哈希，这反过来又要求垃圾邮件发送者启用了 javascript（这非常罕见），并且它每分钟最多只能发送几封垃圾邮件

 ** * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T12:50:41.933

你可以试试[Akismet](http://akismet.com/development/)。它非常擅长阻止垃圾邮件，可能是免费的（取决于您的使用），并且具有用于众多 Web 应用程序的 API。

不过，您的两个未列出，因此需要进行一些工作才能使其与它们一起使用。paste.org 是基于 rails 的吗？如果是这样，那么就有一个用于 Akismet 的 rails API。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T12:52:01.930

来自[维基百科](http://en.wikipedia.org/wiki/Captcha)

> 验证码系统是一种自动生成新挑战的方法，它：
> 
> ```
> * Current software is unable to solve accurately.
> * Most humans can solve.
> * Does not rely on the type of CAPTCHA being new to the attacker. 
> ```

我自己在解决验证码（至少是基于图像的验证码）方面真的很糟糕，对我来说，感觉当前的实现不符合上面的“规范”。许多广泛使用的实现实际上可以通过软件解决。我和大多数人一样，我无法解决这些......（我知道主观）

我可能会尝试实施一个系统，用户可以在其中将我删除的内容标记为垃圾邮件。是的，如果没有管理员本人的任何输入，垃圾邮件将是可见的，但不会持续很长时间。

想想看，SO 的声誉和投票系统非常有效地减少了垃圾邮件的影响，因为问题被关闭并被否决 => 情人可见度

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-25T06:33:42.990

查看 defensio.com。它使用贝叶斯过滤（如邮件过滤器）。这很有效。这是一项免费的网络服务。

免责声明：过去在那里工作过。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T13:15:41.600

像 Phil Haacks[隐形](http://haacked.com/archive/2007/09/11/honeypot-captcha.aspx)验证码这样的东西呢？

# c# - 您可以使用“where”来要求 c# 中的属性吗？

> ID：221687
> 
> 赞同：37
> 
> 时间：2008-10-21T12:45:09.027
> 
> 标签：c#, generics, attributes, constraints, where

我想创建一个只接受可序列化类的泛型类，可以用 where 约束来完成吗？

我正在寻找的概念是这样的：

```
public class MyClass<T> where T : //[is serializable/has the serializable attribute] 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-21T12:47:58.567

不，恐怕不是。您可以对约束做的唯一事情是：

*   `where T : class`- T 必须是引用类型
*   `where T : struct`- T 必须是不可为空的值类型
*   `where T : SomeClass`- T 必须是 SomeClass 或派生自它
*   `where T : ISomeInterface`- T 必须是 ISomeInterface 或实现它
*   `where T : new()`- T 必须有一个公共的无参数构造函数

各种组合是可行的，但不是全部。属性无关。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T12:53:49.727

我知道的; 你不可以做这个。您是否考虑过添加“初始化”方法或类似方法？

```
public void Initialize<T>(T obj)
{
     object[] attributes = obj.GetType().GetCustomAttributes(typeof(SerializableAttribute));
     if(attributes == null || attributes.Length == 0)
          throw new InvalidOperationException("The provided object is not serializable");
} 
```

我没有测试过这段代码，但我希望你明白我的意思。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T12:49:43.697

怕不是。最好的办法是对[Type.IsSerializable](http://msdn.microsoft.com/en-us/library/system.type.isserializable.aspx)进行运行时检查。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T15:54:59.657

如果您正在寻找任何可序列化的类，我认为您不走运。如果您正在寻找您创建的对象，您可以创建一个可序列化的基类，并让您想要支持的每个类都派生自它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-01-25T14:08:46.513

我知道这很旧，但我正在使用静态构造函数进行检查。它是稍后的，但允许您在运行时引发错误。

# .net-3.5 - .NET 3.5 SP1 网络共享允许 exe 应用程序运行

> ID：221689
> 
> 赞同：2
> 
> 时间：2008-10-21T12:46:18.697
> 
> 标签：.net-3.5

我可能可以从其他地方找到这一点，但认为堆栈溢出问题会是一个很好的问题。

.NET 2.0 默认停止从网络共享运行托管 exe，尽管您可以运行非托管 exe。

我看到有人提到这在 .NET 3.5 SP1 中已更改

这是真的？

这会包括我假设的任何dll吗？

我需要为 3.5 重新编译应用程序还是 3.5 设置会覆盖 2.0 应用程序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T12:57:12.607

是的，这在 3.5 中已更改。您无需更改任何内容，只要客户端具有 3.5 SP1，它“就可以正常工作”

[http://blogs.msdn.com/vancem/archive/2008/08/13/net-framework-3-5-sp1-allows-managed-code-to-be-launched-from-a-network-share。 aspx](http://blogs.msdn.com/vancem/archive/2008/08/13/net-framework-3-5-sp1-allows-managed-code-to-be-launched-from-a-network-share.aspx)

# c# - 为什么 IEnumerable 从 IEnumerable 继承？

> ID：221691
> 
> 赞同：38
> 
> 时间：2008-10-21T12:46:33.437
> 
> 标签：c#, generics, ienumerable

这可能是一个老问题：为什么`IEnumerable<T>`继承自`IEnumerable`？

.NET 就是这样做的，但它带来了一些麻烦。每次我写一个类 implements`IEumerable<T>`时，我都要写两个`GetEnumerator()`函数，一个 for ，一个`IEnumerable<T>`for `IEnumerable`。

而且，`IList<T>`不从 IList 继承。

我不知道为什么`IEnumerable<T>`以其他方式设计。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-21T12:52:57.340

[直接从马的嘴里](https://docs.microsoft.com/en-us/archive/blogs/brada/why-does-ienumerable-inherits-from-ienumerable)（Hejlsberg）：

> 理想情况下，所有泛型集合接口（例如`ICollection<T>`）`IList<T>`都将从它们的非泛型对应物继承，这样泛型接口实例既可以与泛型代码一起使用，也可以与非泛型代码一起使用。例如，如果`IList<T>`可以将 an 传递给需要`IList`.

> 事实证明，唯一可行的`IEnumerable<T>`通用`IEnumerable<T>`接口`IEnumerable<T>`是）。`ICollection<T>`并`IList<T>`在输入和输出位置都使用 T，因此这些接口是不变的。（顺便说一句，如果 T 仅用于输入位置，它们将是逆变的，但这在这里并不重要。）

> <...剪辑...>

所以，回答你的问题，`IEnumerable<T>`继承自，`IEnumerable`因为它可以！:-)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-21T12:52:13.193

答案`IEnumerable`是：“因为它可以在不影响类型安全的情况下”。

`IEnumerable`是一个“只读”接口 - 所以泛型形式比非泛型形式更具体并不重要。你不会通过同时实现两者来破坏任何东西。`IEnumerator.Current`返回`object`，而`IEnumerator<T>.Current`返回`T`- 没关系，因为您始终可以合法地转换为`object`，尽管这可能意味着拳击。

将此与`IList<T>`and `IList`- 进行比较，您可以调用`Add(object)`an `IList`，而这可能对任何特定`IList<T>`（除`IList<object>`事实上之外的任何内容）都无效。

Brad Abram 的[博客中包含 Anders](https://docs.microsoft.com/en-us/archive/blogs/brada/why-does-ienumerable-inherits-from-ienumerable)对这个问题的回答。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T12:53:36.060

这是为了向后兼容。如果您调用需要普通 IEnumerable 的 .Net 1.1 函数，则可以传入通用 IEnumerable。

幸运的是，通用 IEnumerator 继承自旧式 IEnumerator

我通常实现一个返回枚举器的私有方法，然后将它传递给旧式和新式 GetEnumerator 方法。

```
 private IEnumerator<string> Enumerator() {
        // ...
    }

    public IEnumerator<string> GetEnumerator() {
        return Enumerator();
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator() {
        return Enumerator();
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T12:52:56.640

这样它就可以与不支持泛型的类一起使用。此外，.NET 泛型不允许您执行诸如将 IList<long> 转换为 IList<int> 之类的操作，因此当您需要固定的基类或接口时，接口的非泛型版本可能非常有用。

# php - 将文件附加到电子邮件时，是否需要先将其存储在服务器上？

> ID：221693
> 
> 赞同：0
> 
> 时间：2008-10-21T12:47:20.520
> 
> 标签：php, mysql

我有一个自动将表格导出到 CSV 文件的功能，然后我尝试将相同的文件附加到将通过电子邮件发送给它的功能中。我以前使用 html mime 邮件发送过附件，但我想知道是否需要先将创建的 CSV 文件存储在服务器上，然后再将其附加到电子邮件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T12:49:33.433

这取决于您的功能，如果您有一个可以将表格作为 CSV 导出到字符串中的功能，然后邮件功能支持从字符串创建附件，那么我认为您有您需要的...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T12:51:26.627

理论上，您可以通过编写适当的标签并自己手工制作电子邮件来自己嵌入它。

或者您可以采用简单的方法将其保存到临时位置，使用 PHPMailer 之类的工具（可能还支持字符串附件）附加文件，发送邮件，然后删除临时文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T12:51:37.500

当您将二进制文件附加到电子邮件时，它会将二进制文件转换为文本，以便可以通过文本介质进行传输。转换过程调用`uuencode`用于转换二进制文件。

因此，当您使用客户端附加文件时，它只是对其进行 uuencode 并将文本与消息的其余部分一起添加。我不确定确切的格式是否使它看起来像客户端的附件（而不仅仅是消息正文中的胡言乱语）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T14:12:49.067

如果您使用 PEAR 中的 Mail_Mime 包及其“addAttachment”方法，请将“$isfile”（第 4 个）参数设置为 false 并将字符串作为“$file”（第一个）参数传递。更多[在这里](http://pear.php.net/manual/en/package.mail.mail-mime.addattachment.php)。

如果您使用 PHPMailer，请使用其“AddStringAttachment”方法。

如果你不使用这些，那么你需要更具体。

# c# - 处理 UTC 和夏令时的最佳方法

> ID：221700
> 
> 赞同：1
> 
> 时间：2008-10-21T12:49:06.710
> 
> 标签：c#, .net

处理 UTC 转换和夏令时转换的最佳方法是什么。有哪些问题及其解决方案。全部在 C# .Net 2.0 中。.Net 2.0 中也存在与此相关的任何问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T12:50:56.957

如果您使用 UTC 时间，则不必担心客户时区或夏令时...（如果他们设定了标准）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T12:55:40.800

如果您在任何地方都使用 UTC，那么您真的不需要为 .NET 担心太多。如果您有兴趣看到这种实际的东西，您可以查看[TimeZoneInfo](http://msdn.microsoft.com/en-us/library/system.timezoneinfo_members.aspx)类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T12:55:48.257

我建议将您的应用程序和数据库中的所有日期时间条目标准化为 UTC。然后，您可以让用户选择他们的时区首选项，将其存储为偏移量（例如，东部时间为 -5），或者在向用户显示时间时使用客户端计算机的本地化设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T12:56:49.377

不要试图自己弄清楚 DST。因客户而异。您不能真正假设基于时区的 DST 规则具有世界上所有不同的规则。把它留给您的 CLR 供应商（即 Microsoft）。坚持所有事件的 UTC（但请记住，午夜取决于时间，所以日期也是如此）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T12:57:38.737

那么在这种特殊情况下，我将本地时间转换为 UTC。但我在某处读到夏令时规则最近发生了变化。Sooo Date.ToUniversalTime() 函数是否仍然正常工作。基本上 2007 年之前的日期（新规则生效时）会被正确转换，但之后的日期不会。我在这里吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T13:11:40.517

@Xardas

我认为 DST 时间是在最近的补丁中更新的（比如几个月前）。如果您的系统已修补，则不必担心。

# javascript - 有没有好的 Javascript 图形库？

> ID：221710
> 
> 赞同：35
> 
> 时间：2008-10-21T12:50:02.107
> 
> 标签：javascript, graphics, 3d

在盯着[这个 3D 立方体](http://maettig.com/code/javascript/3d_dots.html)和[这些三角形](http://www.uselesspickles.com/triangles/demo.html)看了一会儿之后，我开始想知道是否有任何可靠的、具有基本 3D 支持的 Javascript 图形库。

有什么建议吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-21T12:57:25.757

John Resig 将处理库移植到 Javascript：

[http://ejohn.org/blog/processingjs](http://ejohn.org/blog/processingjs)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-21T12:59:59.293

我对[Raphaël](http://raphaeljs.com/)感到非常兴奋。我在一个项目中使用过它，它就像一种魅力。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T12:56:36.460

[Flot](http://code.google.com/p/flot/)是一个用于 jQuery 的纯 Javascript 绘图库。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T12:57:23.400

以下是一些用 javascript 编写的具有一些图形功能的物理引擎。

[http://blog.quantumstate.co.uk/javascript-physics-engine.html](http://blog.quantumstate.co.uk/javascript-physics-engine.html)

[http://box2d-js.sourceforge.net/](http://box2d-js.sourceforge.net/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-11T07:38:50.620

看一下 dojox.gfx：[docs](http://docs.dojocampus.org/dojox/gfx)、[tests](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx/tests/)、[demos](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx/demos/)（最后两个链接指向测试服务器上为调试而不是生产优化的每晚快照）。

它使用原生图形：SVG、VML、Silverlight 或 Canvas — 涵盖所有主要浏览器（IE、Firefox、Safari/Webkit、Opera）的客户端上可用的任何图形。

虽然它是 2D 的，但它可以用作 3D 东西的基础。事实上，有一个库可以利用它：[dojox.gfx3d](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/)。示例（可以在[测试中找到）：](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/tests/)

[](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/tests/)

[](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/tests/)
*   [气缸](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/tests/test_cylinder.html)
*   [立方体](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/tests/test_cube.html)
*   [飞行员考试](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx3d/tests/test_drawer.html)

对于真正喜欢冒险的类型，作为 Google Summer of Code 2008 的一部分，为 Dojo 提供了一个库：True 3D。显然它比 2D/3D 混合要快得多，并且适用于流体动画。您可以自行探索它（上一个链接是一个公开的 Subversion 存储库），但请注意：它仅适用于 Firefox 和 Opera 以及各自供应商提供的特殊 3D 图形插件。您将在文档中找到所有血淋淋的细节。

玩得开心！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T20:12:27.127

查看 Walter Zorn 的图书馆

[www.walterzorn.de/en](http://www.walterzorn.de/en/jsgraphics/jsgraphics_e.htm)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-24T23:08:05.743

canvas html 元素可能是最好的支持，并在许多库中使用（我知道兄弟姐妹提到的 flot 和 processingjs 正在使用它）

canvas 元素是你可以获得的较低的 API 抽象级别，在概念上可能类似于[Cairo](http://www.cairographics.org/ "开罗图形库")或[GDI](http://fr.wikipedia.org/wiki/Graphics_Device_Interface)

*   [http://en.wikipedia.org/wiki/Canvas_(HTML_element)](http://en.wikipedia.org/wiki/Canvas_(HTML_element))
*   [https://developer.mozilla.org/En/HTML:Canvas](https://developer.mozilla.org/En/HTML:Canvas)

# ruby-on-rails - 无法在 Rails 生产环境中启动 workling_starling_client

> ID：221711
> 
> 赞同：0
> 
> 时间：2008-10-21T12:50:04.290
> 
> 标签：ruby-on-rails, god, workling, starling-server

我使用**上帝**来启动和监控我的八哥和工作守护进程。

在**开发**机器上工作得很好，但“workling_starling_client”拒绝在我的**生产**机器上启动。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T12:58:44.257

我意识到通过明确地做

```
export RAILS_ENV=production 
```

我的 workling-starling-client 正常启动。

**因此我必须在发布上帝配置文件**之前声明**RAILS_ENV**变量

 **```
RAILS_ENV=production god -d config/monitor_daemons.god -t 
```

我还使用该变量在**生产端口中启动****八哥守护进程**

 **```
STARLING_PORT = ENV['RAILS_ENV'] == 'production' ? '-p 15151' : ''

God.watch do |w|
  ...
  w.start = "starling -d -P log/starling.pid -q log/ #{STARLING_PORT}"
  ...
end

God.watch do |w|
  ...
  w.start = "script/workling_starling_client start"
  ... 
```

结尾

# lamp - 大多数“大”公司更喜欢 WISA 而不是 LAMP？为什么？

> ID：221716
> 
> 赞同：7
> 
> 时间：2008-10-21T12:51:14.567
> 
> 标签：lamp, wisa

如果这是真的，我想知道为什么。我们是否看到有很大比例的安全和高流量 Web 应用程序内置在 LAMP 中？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-21T12:56:17.960

这都是关于支持的。从 Microsoft 购买的大公司将通过热线与他们的支持团队联系。因为任何停机时间对于一家大公司来说都可能是非常昂贵的，所以随时获得即时支持的能力比在初始购买时节省的任何成本都更有价值。

此外，如果一切都出错了，有人应该责备并可能起诉；）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-21T12:53:51.957

“没有人会因为购买 IBM 而被解雇”。这总结了很多高管的选择。没有人会因为信任一家拥有成功记录的大公司而被解雇——即使这不是最佳选择。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T13:23:13.863

我相信这更多的是大公司给你的安全感，而不是支持。大多数开源公司的商业模式依赖于提供支持和服务，而不是向您收取软件许可证费用。所以，也许，支持不是那里的主要问题。

此外，还有可见性问题。当我们走出计算机科学世界时，开源就失去了大部分可见性。它对我们的意义与对我们的家人、朋友和一般非计算机极客的意义完全不同。他们会说“Windows，我当然知道 Microsoft Windows……Linux……嗯……是的。我听说过。它是免费的，对吧？有什么收获？”

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T12:54:25.967

根据我的经验，大公司似乎并不“信任”开源软件。尽管开源软件在许多情况下比封闭软件更安全。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T12:55:43.013

这主要是因为一旦公司达到一定规模，平台决策就不再是具有技术知识的人了。

规模经济？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-21T13:01:55.857

您不会因为将公司押在 Microsft 上而被解雇。

一旦你拥有了一个由 Win Server 管理员/.NET 开发人员/不合格的猴子组成的团队，就更容易坚持你所知道的。

你是 ASP.NET 开发人员，也是 winforms 开发人员和 MS Office '平台' 开发人员。

但这当然只适用于内部应用程序。对于公共的东西，我认为 LAMP 总是有优势的。许多在 WISA 上构建内部应用程序的人也运行 LAMP/WAMP 和/或 J2EE，用于购买应用程序。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T15:28:33.017

[Wikipedia](http://en.wikipedia.org/wiki/Wikipedia#Software_and_hardware)和[Facebook](http://www.techcrunchit.com/2008/06/30/facebook-building-out-own-datacenters/)都运行 LAMP 堆栈。维基百科的利润可能并不大，但他们拥有大量的用户和内容。我认为无论从任何定义来看，Facebook 都很大。不同之处在于它们不是“企业”，我认为这就是“大”的真正含义。“企业”公司的定义是在他们不需要但运作不佳的事情上花费比必要更多的钱，通常伴随着/由可怕的官僚机构引起。其他回复已经详细介绍了此类公司的瘟疫，因此我不再赘述；我只是想指出 LAMP 的一些成功用途。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T12:53:24.343

一般来说，因为 MS 卖给他们，MS 提供支持。当您有重大缺陷时，致电制造商的能力值得产品成本（在业务眼中）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T13:00:19.167

可能是因为 WISA 得到了支持和官方补丁和升级的支持，无论它们相距多远。加上 WISA 有一个很好的开发环境。而且您不必阅读大量文本文件来弄清楚如何管理某事。此外，从 8 个服务器操作系统选项中选择比看似无限的免费选项更容易。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-21T13:29:45.490

我认为这是“没有人因为购买 IBM 而被解雇”的因素。如果一家公司想要一个有支持的 Linux/UNIX 系统，他们有很多选择。Redhat、Novell、Sun 和 Canonical 都为其系统提供支持。这样就更容易找到 Windows 程序员和管理员。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T12:55:49.800

许多人更喜欢另一家大公司的安全性来解决支持问题。话虽如此，在 LAMP 上建立了许多成功的高流量网站。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-21T13:00:58.947

“利基”和/或新兴技术很难获得额外的湿件。

我所说的硬是指湿器的交货期很长，价格昂贵且通常不可参考。

新技术或开源可能是显而易见的选择，但如果实施，往往会存在于一两个资源的脑海中，如果他们觉得自己被低估了，就会有逃跑的风险。

J/。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-21T14:06:48.893

不过，我想知道，在这些艰难的经济时期，我们是否开始看到更多的大公司开始采用开源“LAMP”和其他此类衍生产品……这让我想知道我是否也需要这样做。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-21T14:47:48.030

它的另一部分可能是第一批 Web 开发人员在公司开始使用的东西。如果这家公司是由前微软员工或曾在微软工作的技术负责人创办的，那么我想你可以期望他们使用微软员工商店来获取一些软件的副本来构建网站。至少，这就是我在大学毕业后进入 Visual Studio 开发的原因，因为它是一个 dot-com。

# windows - 在命令提示符下运行 .exe 的 Bat 文件

> ID：221730
> 
> 赞同：149
> 
> 时间：2008-10-21T12:54:14.687
> 
> 标签：windows, batch-file, exe

我想创建一个 .bat 文件，这样我就可以单击它来运行它：

```
svcutil.exe /language:cs /out:generatedProxy.cs /config:app.config http://localhost:8000/ServiceModelSamples/service 
```

有人可以帮助我了解 .bat 文件的结构吗？

* * *

## 回答 #1

> 赞同：218
> 
> 时间：2011-07-06T19:55:13.953

要启动程序然后关闭命令提示符而不等待程序退出：

```
start /d "path" file.exe 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2013-04-11T17:18:30.433

您可以使用：

```
start "windowTitle" fullPath/file.exe 
```

注意：第一组引号必须在那里，但您不必在其中添加任何内容，例如：

```
start "" fullPath/file.exe 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2011-05-29T09:50:41.670

这是一个非常简单的代码，用于在记事本中执行以下代码类型并保存到扩展名 .bat 示例：notepad.bat

```
start "c:\windows\system32" notepad.exe 
```

（上面的代码“c:\windows\system32”是您保存 .exe 程序的路径，notepad.exe 是您的 .exe 程序文件文件）

请享用！

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-10-21T12:56:31.373

只需将该行放入bat文件中...

或者，您甚至可以为 svcutil.exe 创建一个快捷方式，然后在“目标”窗口中添加参数。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-21T12:56:52.450

bat 文件没有结构......这是您在命令行上键入它的方式。所以只需打开你最喜欢的编辑器..复制你想要运行的代码行..并将文件保存为whatever.bat或what.cmd

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-21T13:09:39.460

只需插入一个文件并将其命名为“ServiceModelSamples.bat”或其他名称。

您可以将“@echo off”添加为第一行，因此该命令不会打印到屏幕上：

```
@echo off
svcutil.exe /language:cs /out:generatedProxy.cs /config:app.config http://localhost:8000/ServiceModelSamples/service 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-21T13:16:53.643

如果你想变得更聪明，在命令行输入：

```
echo svcutil.exe /language:cs /out:generatedProxy.cs /config:app.config http://localhost:8000/ServiceModelSamples/service >CreateService.cmd 
```

然后你就`CreateService.cmd`可以随时运行（`.cmd`只是`.bat`文件的另一个扩展名）

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-21T12:57:01.483

什么事拦住你了？

将此命令放入文本文件中，使用 .bat（或 .cmd）扩展名保存并双击它...

假设命令在您的系统上执行，我想就是这样。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-05-16T07:11:23.683

[如此处](http://ss64.com/nt/start.html)所述，关于`Start`命令，以下将使用您指定的参数启动您的应用程序：

```
start "svcutil" "svcutil.exe" "language:cs" "out:generatedProxy.cs" "config:app.config" "http://localhost:8000/ServiceModelSamples/service" 
```

*   `"svcutil"`，在`start`命令之后，是在运行指定的应用程序时赋予 CMD 窗口的名称。这是`start`命令的必需参数。

*   `"svcutil.exe"`是要运行的应用程序的绝对或相对路径。使用引号允许您在路径中包含空格。

*   指定要启动的应用程序后，以下所有参数都被解释为发送给应用程序的参数。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-07-30T12:58:19.577

如果您的文件夹设置为“隐藏文件扩展名”，您将文件命名为 *.bat 或 *.cmd，它仍然是一个文本文件（隐藏的 .txt 扩展名）。确保您可以正确命名文件！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-02-28T13:26:56.863

好吧，这里似乎很重要的一点是，默认情况下，svcutil 在命令行中不可用，您可以从 vs xommand 行快捷方式运行它，但是如果您通常制作一个批处理文件，除非您之前运行 vcvarsall.bat 文件，否则这将无济于事剧本。下面是一个示例

```
“C:\Program Files\Microsoft Visual Studio *version*\VC\vcvarsall.bat”
svcutil.exe /language:cs /out:generatedProxy.cs /config:app.config http://localhost:8000/ServiceModelSamples/service

```

# c# - 日期时间“空”值

> ID：221732
> 
> 赞同：306
> 
> 时间：2008-10-21T12:54:32.830
> 
> 标签：c#, datetime, null

我一直在寻找很多，但找不到解决方案。您如何处理应该能够包含未初始化值（相当于 null）的 DateTime？我有一个可能设置或不设置 DateTime 属性值的类。我正在考虑将属性持有者初始化为 DateTime.MinValue，然后可以轻松地对其进行检查。我想这是一个很常见的问题，你是怎么做到的？

* * *

## 回答 #1

> 赞同：478
> 
> 时间：2008-10-21T12:56:04.887

对于普通的 DateTimes，如果您根本不初始化它们，那么它们将匹配`DateTime.MinValue`，因为它是值类型而不是引用类型。

您还可以使用可为空的 DateTime，如下所示：

```
DateTime? MyNullableDate; 
```

或者更长的形式：

```
Nullable<DateTime> MyNullableDate; 
```

最后，还有一种内置方式可以引用任何类型的默认值。这会返回`null`引用类型，但对于我们的 DateTime 示例，它将返回与以下内容相同的内容`DateTime.MinValue`：

```
default(DateTime) 
```

或者，在更新的 C# 版本中，

```
default 
```

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2008-10-21T12:56:19.130

如果您使用的是 .NET 2.0（或更高版本），则可以使用可为空的类型：

```
DateTime? dt = null; 
```

或者

```
Nullable<DateTime> dt = null; 
```

然后稍后：

```
dt = new DateTime(); 
```

您可以通过以下方式检查该值：

```
if (dt.HasValue)
{
  // Do something with dt.Value
} 
```

或者你可以像这样使用它：

```
DateTime dt2 = dt ?? DateTime.MinValue; 
```

你可以在这里阅读更多：http:
[//msdn.microsoft.com/en-us/library/b3h38hb0.aspx](http://msdn.microsoft.com/en-us/library/b3h38hb0.aspx)

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2017-02-06T06:21:38.307

以下方式也有效

```
myClass.PublishDate = toPublish ? DateTime.Now : (DateTime?)null; 
```

请注意，属性 PublishDate 应该是 DateTime？

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2010-04-28T16:08:16.100

约会时间？我的日期时间{get;set;}

```
MyDateTime = (dr["f1"] == DBNull.Value) ? (DateTime?)null : ((DateTime)dr["f1"]); 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-21T12:56:11.157

我会考虑使用可为[空的类型](http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx)。

`DateTime? myDate`而不是`DateTime myDate`.

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-04-30T22:00:23.920

值得指出的是，虽然一个`DateTime`变量不能是`null`，但它仍然可以在`null`没有编译器错误的情况下进行比较：

```
DateTime date;
...
if(date == null) // <-- will never be 'true'
  ... 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-21T13:27:33.853

您可以将 DateTime 设置为 Nullable。默认情况下 DateTime 不可为空。您可以通过几种方式使其为空。在类型 DateTime 之后使用问号？myTime 或使用通用样式 Nullable。

```
DateTime? nullDate = null; 
```

或者

```
DateTime? nullDate; 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-21T12:56:47.817

您可以使用可为空的类。

```
DateTime? date = new DateTime?(); 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-21T12:56:57.207

您可以为此使用可为空的 DateTime。

```
Nullable<DateTime> myDateTime; 
```

或者像这样写的同样的东西：

```
DateTime? myDateTime; 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-21T12:57:16.443

我总是把时间设置为`DateTime.MinValue`。这样我就不会收到任何 NullErrorException 异常，并且可以将其与我知道未设置的日期进行比较。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2016-01-28T07:25:34.493

请注意 - 当使用 Nullable 时，它​​显然不再是“纯”日期时间对象，因此您无法直接访问 DateTime 成员。我会试着解释一下。

通过使用 Nullable<> 您基本上将 DateTime 包装在一个可以为空的容器（感谢泛型）中 - 显然它的目的。该容器有自己的属性，您可以调用这些属性来访问上述 DateTime 对象；使用正确的属性后 - 在本例中为 Nullable.Value - 然后您可以访问标准的 DateTime 成员、属性等。

所以 - 现在想到了访问 DateTime 对象的最佳方式的问题。有几种方法，1 号是 FAR 最好的，2 号是“老兄为什么”。

1.  使用 Nullable.Value 属性，

    `DateTime date = myNullableObject.Value.ToUniversalTime(); //Works`

    `DateTime date = myNullableObject.ToUniversalTime(); //Not a datetime object, fails`

2.  使用 Convert.ToDateTime() 将可为空的对象转换为日期时间，

    `DateTime date = Convert.ToDateTime(myNullableObject).ToUniversalTime(); //works but why...`

尽管此时答案已经有据可查，但我相信 Nullable 的使用可能值得一提。对不起，如果你不同意。

编辑：删除了第三个选项，因为它有点过于具体且取决于大小写。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-07-18T11:26:25.027

虽然每个人都已经给了你答案，但我会提到一种可以很容易地将日期时间传递给函数的方法

**[错误：无法转换 system.datetime？到 system.datetime]**

```
DateTime? dt = null;
DateTime dte = Convert.ToDateTime(dt); 
```

现在您可以在函数内部传递 dte 没有任何问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-05-14T12:19:09.050

如果您有时期望 null ，则可以使用以下内容：

```
var orderResults = Repository.GetOrders(id, (DateTime?)model.DateFrom, (DateTime?)model.DateTo) 
```

在您的存储库中使用可为空的日期时间。

```
public Orders[] GetOrders(string id, DateTime? dateFrom, DateTime? dateTo){...} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-02-17T22:48:47.773

我遇到了同样的问题，因为我在对 Throws ArgumentNullException 执行单元测试时必须将 Null 作为 DateTime 的参数。它在我的情况下使用以下选项起作用：

```
Assert.Throws<ArgumentNullException>(()=>sut.StartingDate = DateTime.Parse(null)); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-07-26T09:43:22.530

鉴于日期/时间数据类型的性质，它不能包含`null`值，即它需要包含值，它不能为空或不包含任何内容。如果您将日期/时间变量标记为`nullable`then 您只能为其分配空值。因此，您要做的是两件事之一（可能还有更多，但我只能想到两件事）：

*   如果您没有值，请为您的变量分配一个最小日期/时间值。您也可以指定最大日期/时间值 - 无论哪种方式适合您。在检查日期/时间值时，请确保您在整个站点范围内保持一致。决定使用`min`or`max`并坚持下去。

*   将您的日期/时间变量标记为`nullable`. 这样，`null`如果您没有变量，您可以将日期/时间变量设置为。

让我用一个例子来说明我的第一点。`DateTime`变量类型不能设置为 null，它需要一个值，在这种情况下，如果没有值，我将其设置为的`DateTime`最小值。

我的情况是我有一`BlogPost`堂课。它有许多不同的字段/属性，但我在这个例子中只选择了两个。`DatePublished`是帖子发布到网站并且必须包含日期/时间值的时间。`DateModified`是当一个帖子被修改时，所以它不必包含一个值，但可以包含一个值。

```
public class BlogPost : Entity
{
     public DateTime DateModified { get; set; }

     public DateTime DatePublished { get; set; }
} 
```

`ADO.NET`用于从数据库中获取数据（赋值为`DateTime.MinValue`没有值）：

```
BlogPost blogPost = new BlogPost();
blogPost.DateModified = sqlDataReader.IsDBNull(0) ? DateTime.MinValue : sqlDataReader.GetFieldValue<DateTime>(0);
blogPost.DatePublished = sqlDataReader.GetFieldValue<DateTime>(1); 
```

`DateModified`您可以通过将字段标记为 来完成我的第二点`nullable`。现在您可以将其设置为`null`如果它没有值：

```
public DateTime? DateModified { get; set; } 
```

用于从数据库`ADO.NET`中获取数据，它看起来与上面完成的方式有点不同（分配`null`而不是`DateTime.MinValue`）：

```
BlogPost blogPost = new BlogPost();
blogPost.DateModified = sqlDataReader.IsDBNull(0) ? (DateTime?)null : sqlDataReader.GetFieldValue<DateTime>(0);
blogPost.DatePublished = sqlDataReader.GetFieldValue<DateTime>(1); 
```

我希望这有助于消除任何困惑。鉴于我的回复是大约 8 年后，您现在可能是 C# 专家级程序员了 :)

# python - 是否可以在 Twisted 中的套接字上设置超时？

> ID：221745
> 
> 赞同：9
> 
> 时间：2008-10-21T12:56:32.670
> 
> 标签：python, networking, sockets, twisted

我意识到我可能只是愚蠢并且错过了一些重要而重要的事情，但我无法弄清楚如何使用reactor.listenUDP指定扭曲的超时。我的目标是能够指定超时，并且在所述时间之后，如果 DatagramProtocol.datagramReceived 没有被执行，让它执行一个回调或者我可以用来调用 reactor.stop() 的东西。任何帮助或建议表示赞赏。谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-30T18:52:01.677

我认为`reactor.callLater`会比`LoopingCall`. 像这样的东西：

```
class Protocol(DatagramProtocol):
    def __init__(self, timeout):
        self.timeout = timeout

    def datagramReceived(self, datagram):
        self.timeout.cancel()
        # ...

timeout = reactor.callLater(5, timedOut)
reactor.listenUDP(Protocol(timeout)) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T13:15:01.180

由于 Twisted 是事件驱动的，因此您本身不需要超时。您只需要在收到数据报时设置一个状态变量（如 datagramRecieved）并注册一个检查状态变量的[循环调用](http://twistedmatrix.com/projects/core/documentation/howto/time.html)，在适当的情况下停止反应器然后清除状态变量：

```
from twisted.internet import task
from twisted.internet import reactor

datagramRecieved = False
timeout = 1.0 # One second

# UDP code here

def testTimeout():
    global datagramRecieved
    if not datagramRecieved:
        reactor.stop()
    datagramRecieved = False

l = task.LoopingCall(testTimeout)
l.start(timeout) # call every second

# l.stop() will stop the looping calls
reactor.run() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-04T16:26:20.000

对于反应堆，我们必须使用 callLater。connectionMade 时开始超时倒计时。当 lineReceived 时重置超时倒计时。

这是

```
# -*- coding: utf-8 -*-

from twisted.internet.protocol import Factory
from twisted.protocols.basic import LineReceiver
from twisted.internet import reactor, defer

_timeout = 27

class ServiceProtocol(LineReceiver):

    def __init__(self, users):
        self.users = users

    def connectionLost(self, reason):
        if self.users.has_key(self.name):
            del self.users[self.name]

    def timeOut(self):
        if self.users.has_key(self.name):
            del self.users[self.name]
        self.sendLine("\nOUT: 9 - Disconnected, reason: %s" % 'Connection Timed out')
        print "%s - Client disconnected: %s. Reason: %s" % (datetime.now(), self.client_ip, 'Connection Timed out' )
        self.transport.loseConnection()

    def connectionMade(self):
        self.timeout = reactor.callLater(_timeout, self.timeOut)

        self.sendLine("\nOUT: 7 - Welcome to CAED")

    def lineReceived(self, line):
        # a simple timeout procrastination
        self.timeout.reset(_timeout)

class ServFactory(Factory):

    def __init__(self):
        self.users = {} # maps user names to Chat instances

    def buildProtocol(self, addr):
        return ServiceProtocol(self.users)

port = 8123
reactor.listenTCP(port, ServFactory())
print "Started service at port %d\n" % port
reactor.run() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-22T19:09:07.100

一个更好的方法是使用`twisted.protocols.policies.TimeoutMixin`. 它本质上是在做 a`callLater`但抽象成`Mixin`.

# javascript - 如何强制 ASP.NET Ajax 使用来自 FS 而不是 WebResource.axd 的脚本，或减少其 HTTP 请求？

> ID：221761
> 
> 赞同：1
> 
> 时间：2008-10-21T12:58:34.787
> 
> 标签：javascript, asp.net-ajax, webresource.axd, scriptresource.axd

这是一个我还没有找到答案的问题的嗡嗡声。

我在几个页面上使用 ASP.NET ajax 控件工具包控件，这些页面本质上希望通过 WebResource.axd 加载脚本资源。这对某些应用程序来说很好，但每次调用 WebResource.axd 都需要一个 HTTP 请求。大多数页面会从 WebResource.axd 中提取至少 3 或 4 个资源，因此每个页面都会发出这么多 HTTP 请求。

由于 HTTP 请求过多会对性能和用户对性能的看法产生负面影响，因此如果可能的话，我想将其减少到 1 个 HTTP 请求。

如果我可以从 AXD 中提取脚本或将 asp.net ajax 配置为使用脚本而不是 WebResource，那就太好了。

有谁知道我如何在使用 asp.net ajax 时实现最终目标？（此时另一个 JS AJAX 框架不是一个选项。）

编辑：找到解决方案。这家伙永远狡猾，如果我们见面，我会欠他很多饭菜/啤酒。[http://www.codeproject.com/KB/aspnet/fastload.aspx](http://www.codeproject.com/KB/aspnet/fastload.aspx)

编辑：找到另一个解决方案——显然 MS 允许您在不包括资源 dll[的情况下下载脚本。](http://www.asp.net/ajax/downloads/)您需要做的就是将它们包含在项目中并在脚本管理器上设置 ScriptPath。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T13:48:54.840

最简单的方法：定义适当的 HTTP 缓存标头。用户代理将根据它们对同一资源的多个请求进行分类，您不必在服务器端解决问题。

# asp.net - 数据库表或 XML

> ID：221765
> 
> 赞同：6
> 
> 时间：2008-10-21T12:58:45.973
> 
> 标签：asp.net, sql, xml, database

我正在设计一个小型网站，并且很好奇何时可以/应该用 XML 文件替换数据库表。在某些情况下，我认为使用数据库表可能有点矫枉过正，只是想知道是否有其他人遇到过做出这个决定。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T13:00:36.407

如果您认为最终需要的不仅仅是少量的 CRUD，或者您的站点将超过少数用户，请**使用数据库**。

搜索或更新 XML 文件可能会影响性能和未来的可扩展性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T13:01:51.130

当可能发生并发写入时，我会选择使用数据库表，即在任何情况下，当您不能保证在任何时候都只会对数据进行一次更改时。

此外，如果数据是关系数据，我会使用数据库。

对于可能是低流量的小事情，XML 很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T13:02:11.393

IMO：当您对数据有很多写入事务时，请使用数据库。如果您主要编写配置类型的文档，主要是只读的，请使用 XML。XML 作为数据存储并不是您最好的解决方案，因为使用 DB 可以获得更好的结果。尤其是当您开始拥有许多记录（行）时，数据库开始变得更容易使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T14:09:22.007

考虑数据的性质，并限制数据存储对数据的影响。如果您的数据类似于记录而不是文档，具有规则的结构和很少的层次结构，并且数据元素之间可能存在许多水平关系，那么通常使用 RDBMS 将获得比使用某种原生 XML 存储更好的性能和健壮性。如果您的数据采用文档的形式，具有不规则的顺序结构和不明确的层次结构，您可能不会很乐意在 RDBMS 中对这些数据进行建模，并且您可能希望探索原生 XML 数据存储。开源示例包括

*   [存在](http://exist.sourceforge.net/index.html)
*   [塞德娜](http://www.modis.ispras.ru/sedna/)
*   [MonetDB](http://monetdb.cwi.nl/)（此站点现在表现不佳）

商业 XML 数据库包括

*   [马克逻辑](http://www.marklogic.com/)
*   [老虎逻辑](http://www.tigerlogic.com/)
*   [塔米诺](http://www.softwareag.com/Corporate/products/wm/tamino/default.asp)

我自己还没有使用过这些产品。

无论哪种情况，您都可以使用 XML 作为数据交换格式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T13:24:50.163

我不同意斯蒂芬。尤其是在应用程序之间共享数据是一个问题时，应该使用数据库。

数据库用于共享数据。这就是他们被发明的目的，也是他们擅长的。即使在并发更新不成问题的情况下，数据库也比 XML 文件更正式。XML 的非正式性一开始很诱人，但最终会导致不可用。

尽管解决某些应用程序与数据的关系模型和/或 SQL 接口之间的阻抗不匹配可能很困难，但与使用 XML 相比，您仍然可以获得更多的灵活性和稳定性。

我会为正式数据分析在某种程度上不合适或正式数据库设计超出开发团队能力范围的情况保留 XML。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T13:02:59.693

如果您不打算对记录（用于标签、配置等）进行许多更改，则可以使用 XML，否则使用表更合适。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T13:14:52.477

我设计我的表格并生成带有选择属性的 XML 文档（用于 XML）。

我认为如果遇到性能问题，我可以使用 DB 更改我的存储库。

如果发生性能问题等，最好进行可变设计。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-22T02:39:31.463

XML 应该用于数据传输——即在应用程序之间移动数据（当其他应用程序由于某种原因无法访问数据库时）。

然而， [几乎] 没有理由***不***使用数据库来驱动网站。

您还可以考虑一种混合方法，例如莱斯大学的[Connexions](http://cnx.org)项目所使用的方法：他们使用 Plone（以及在其之上的其他东西）来呈现来自他们的数据库中的数据，这些数据是用 CNXML 方言创建的。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-21T13:01:50.957

我正在使用一个使用 100% XML 进行数据存储的应用程序。这样做的原因是允许在许多不同的其他应用程序中进行文本搜索。当您需要在其他应用程序中共享数据时，有时 XML 会更好。

# visual-studio - 单元测试 Visual Studio

> ID：221769
> 
> 赞同：0
> 
> 时间：2008-10-21T13:00:00.120
> 
> 标签：visual-studio, unit-testing

anbyody 可以告诉我在 Visual Studio 中运行单元测试时如何包含某个文件夹。文件夹中是测试所需的 xml 文件。我似乎再也找不到需要添加此文件夹的位置了。

谢谢，Lieven Cardoen 又名 Johlero

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T13:04:43.213

如果单击 XML 文件上的属性，您可以告诉它复制到输出文件夹，以便它在与测试相同的文件夹中可用。或者，如果您不想复制所有测试的支持文件，您可以选择将其作为资源嵌入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T13:04:34.323

我不确定您是否可以根据需要将文件夹添加到测试解决方案中；它要么必须添加到解决方案中并每次加载，要么您必须在测试中单独加载文件。

你能澄清一下你在找什么吗？

# php - 是否有将字符串转换为小写的 MySQL 命令？

> ID：221774
> 
> 赞同：128
> 
> 时间：2008-10-21T13:01:20.820
> 
> 标签：php, mysql

我有一个目前混合大小写的关键字的 MySQL 数据库。但是，我想将它们全部转换为小写。是否有一个简单的命令可以做到这一点，无论是使用 MySQL 还是 MySQL 和 PHP？

* * *

## 回答 #1

> 赞同：257
> 
> 时间：2008-10-21T13:03:16.867

```
UPDATE table SET colname=LOWER(colname); 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-21T13:03:35.260

是的，函数是 LOWER() 或 LCASE() （它们都做同样的事情）。

例如：

```
select LOWER(keyword) from my_table 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-21T13:02:15.123

`SELECT LOWER(foo) AS foo FROM bar`

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-21T13:07:50.650

您可以使用函数 LOWER() 或 LCASE()。

这些可以用于列或字符串文字。例如

```
SELECT LOWER(column_name) FROM table a; 
```

或者

```
SELECT column_name FROM table a where column = LOWER('STRING') 
```

在这两个示例中，LCASE() 都可以替代 LOWER()。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-21T13:03:30.987

你试过查一下吗？谷歌，手动...

[http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_lower](http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_lower)

```
mysql> SELECT LOWER('QUADRATICALLY');
        -> 'quadratically' 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-01-09T11:55:12.163

只需使用：

```
UPDATE `tablename` SET `colnameone`=LOWER(`colnameone`); 
```

或者

```
UPDATE `tablename` SET `colnameone`=LCASE(`colnameone`); 
```

这两个功能的工作方式相同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-09-19T15:10:30.057

有趣的是，字段名称被重命名，如果你在函数中引用它，除非你给他一个别名（可以是它自己的名字），否则你不会得到它的值

示例：我使用一个函数来动态获取字段名称值：

```
function ColBuilder ($field_name) {
…
While ($result = DB_fetch_array($PricesResult)) {
$result[$field_name]
}
…
} 
```

我的查询是：SELECT LOWER(itemID), … etc..

需要更改为： SELECT LOWER(itemID) **as itemID** , ... 等等..

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2014-03-24T13:50:19.313

使用`LOWER`函数将数据或字符串转换为小写。

```
select LOWER(username) from users; 
```

或者

```
select * from users where LOWER(username) = 'vrishbh'; 
```

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2008-10-21T13:06:22.993

我相信你可以使用 php

```
strtolower() 
```

所以你可以制作一个 php 来读取表中的所有条目，然后使用该命令将它们打印为小写

# visual-studio-2008 - “控件已与元素关联”异常

> ID：221781
> 
> 赞同：1
> 
> 时间：2008-10-21T13:02:21.957
> 
> 标签：visual-studio-2008, telerik

我们正在将 Web 应用程序从 vs05 迁移到 vs08。此应用程序使用 Telerik Web 控件。转换项目并运行后，出现异常：“控件已与元素关联”。我将其追溯到一个带有 Telerik RadCombo 框的使用控件。但是，我没有看到任何不妥之处。研究了一下，没有得到任何结果。我会很感激任何指示。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-08T06:03:06.560

在您的解决方案中搜索有问题的组合框的 ID 并查看它的使用位置。如果您没有为控件设置 ID 属性 - 这样做并确保它是唯一的。

如果您使用 AJAX 请求，请确保您正在更新所有需要在 AJAX 之后更新的控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-22T17:40:22.217

不确定这是否有帮助，但是当我们从 2.0 迁移到 4.0 时，我们开始遇到此异常。我们已经在处理控件，但修复方法是将其设置为未定义。

```
child.control.dispose();
child.control = undefined; 
```

# c# - UdpClient，在 Send() 之后的 Receive() 不起作用？

> ID：221783
> 
> 赞同：6
> 
> 时间：2008-10-21T13:02:34.933
> 
> 标签：c#, networking, sockets, udpclient

考虑以下代码：

```
client.Send(data, data.Length, endpoint);
byte[] response = client.Receive(ref endpoint); 
```

虽然根据 WireShark（网络嗅探器）的说法，远程主机确实回复了数据，但这里的应用程序只是永远等待数据......由于某种原因它没有收到来自远程主机的回答。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T16:20:33.193

您可能想要设置两个 UdpClients：一个用于侦听，一个用于发送。

对于接收 UdpClient，请使用接受端口的构造函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-31T10:02:48.490

可能远程主机有防火墙然后无法响应请求，在发送请求之前设置

```
client.Client.ReceiveTimeout = 5000; 
```

因此，当响应无法获得请求时，您会遇到异常

# msbuild - MSBuild，过滤 .cs 文件的整个解决方案的示例

> ID：221800
> 
> 赞同：0
> 
> 时间：2008-10-21T13:06:21.667
> 
> 标签：msbuild

我想学习 MSBuild，想知道是否有人可以让我开始使用一个简单的构建脚本来过滤掉我的 vs.net 2008 项目中所有扩展名为 .cs 的文件。

1.  如何运行构建？
2.  您通常将构建存储在哪里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T14:24:41.790

You typically run an MSBuild script from the command line using the following syntax:

```
MSBuild <scriptfilename> /t:targetname 
```

You can get more information here: [http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)

What are you trying to accomplish by parsing out all of the .cs files from the project file? Keep in mind that with VS2005 and later, the project files **are** MSBuild scripts in their own right, so you can simply call MSBuild on the command line and give it the name of the project file as the and the appropriate target.

That being said, if you create a separate script file I typically store them in the root project folder.

If you want the list of files as a single string property that is semicolon delimited:

```
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
  <Import Project="Project.csproj" Condition="Exists(Project.csproj')"/>

  <Target Name="Test">
     <Message Text="@(Compile)"/>
  </Target>
</Project> 
```

If you want to be able to dispaly each file individually:

```
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
  <Import Project="Project.csproj" Condition="Exists(Project.csproj')"/>

  <Target Name="Test">
     <Message Text="%(Compile.FullPath)"/>
  </Target>
</Project> 
```

Walking through each of these samples, the first line (`<Project ...>`) identifies the fact that this is an MSBuild project file, defines the DefaultTargets (those targets that will run if no target (/t: targetname) is given on the command line) the XML schema (xmlns) used to validate the file and the version of MSBuild to use (ToolsVersion).

The second line (`<Import ...>`) tells MSBuild to include the contents of the MSBuild script named "Project.csproj" if it exists.

Finally, we define a target named "Test" that contains one task. That task is the "Message" task, which prints a message (whatever is contained in "Text") on the screen.

In the first sample, `<Message Text="@(Compile)"/>`, we are referencing an ItemGroup named "Compile" as a semicolon delimited list. In the second example, we are referencing the same ItemGroup but looping over each item in that ItemGroup and printing the "FullPath" metadata contents. (The Compile ItemGroup is defined in the .csproj that we imported in line 2.)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T13:19:28.490

```
C:\projects\_Play\SimpleIpService>type \\sysrdswbld1\public\bin\mrb-vs2008.cmd
@echo off

call "c:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat"

echo %0 %*
echo %0 %* >> %MrB-LOG%
cd
if not ""=="%~dp1" pushd %~dp1
cd
if exist %~nx1 (
        echo VS2008 build of '%~nx1'.
        echo VS2008 build of '%~nx1'. >> %MrB-LOG%
        set MrB-BUILDLOG=%MrB-BASE%\%MrB-WORK%.%MrB-NICEDATE%.%MrB-NICETIME%.build-errors.log
        msbuild.exe %~nx1 /t:Rebuild /p:Configuration=Release > %MrB-BUILDLOG%
        findstr /r /c:"[1-9][0-9]* Error(s)" %MrB-BUILDLOG%
        if not errorlevel 1 (
                echo ERROR: sending notification email for build errors in '%~nx1'.
                echo ERROR: sending notification email for build errors in '%~nx1'. >> %MrB-LOG%
                call mrb-email "Mr Build isn't happy about build errors in '%~nx1'" %MrB-BUILDLOG%
        ) else (
                findstr /r /c:"[1-9][0-9]* Warning(s)" %MrB-BUILDLOG%
                if not errorlevel 1 (
                        echo ERROR: sending notification email for build warnings in '%~nx1'.
                        echo ERROR: sending notification email for build warnings in '%~nx1'. >> %MrB-LOG%
                        call mrb-email "Mr Build isn't happy about build warnings in '%~nx1'" %MrB-BUILDLOG%
                ) else (
                        echo Successful build of '%~nx1'.
                        echo Successful build of '%~nx1'. >> %MrB-LOG%
                )
        )
) else (
        echo ERROR '%1' doesn't exist.
        echo ERROR '%1' doesn't exist. >> %MrB-LOG%
)
popd 
```

# visual-studio - Visual Studio (2008)“干净的解决方案”选项

> ID：221803
> 
> 赞同：97
> 
> 时间：2008-10-21T13:06:58.233
> 
> 标签：visual-studio, visual-studio-2008

这个选项有什么作用？它可以从 Build 菜单访问。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-21T13:08:21.740

它会删除与解决方案关联的所有已编译和临时文件。它确保下一个构建是完整的，而不仅仅是重新编译更改的文件。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2008-10-21T13:16:02.317

它删除之前编译/构建期间生成的所有目标代码。它会删除以下所有类型的文件：-

*.obj - 目标代码

*.pdb - 程序调试数据库文件

*.bsc - 源浏览器数据库

*.ilk - 增量链接器文件

*.sbr - 源浏览器中间文件

*.idb - 重建依赖文件

*.lib - 库文件

*.exe - 可执行文件

JFYI - 即使是 Rebuild All 命令也会完成所有这些，然后继续构建完整的源文件集。

-广告

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-04-23T16:11:32.737

我希望这是一个评论，但显然需要 50 个代表。

为了警告其他人，我发现重建解决方案并没有自己清理。我通常不需要清理它并在它工作之后构建/重建它 - 我认为重建它会自我强制完全编译而不清理并覆盖所有内容，但不会摆脱额外的东西。

没有研究什么重新构建代码明智，只是一个一般性的观察，以防其他人有同样的问题。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-07-18T20:14:36.170

这是一个旧帖子，但我认为这值得一提。在为 Silverlight 编码时，我通常同时打开 Blend 和 VS2010。因此，有时 VS2010 会出现异常，IntelliSense 无法找到东西在哪里，导致它错误地突出显示很多错误。

清理解决方案可以解决此问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T13:07:59.370

擦除在编译过程中创建的文件。下次有效地强制重新编译/构建。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-20T18:34:23.083

清洁溶液时要小心；当您清理解决方案并且如果您在项目中引用了一个库（例如 nhibernate）并且该库具有依赖项（例如 iesi.collections），那么您会看到 iesi.collections 将被删除，即使您重建了解决方案，您必须再次将该 dll 放入您的文件夹。或者您也可以参考 ie​​si.collections 并从其属性中选择 copy-local : yes 选项

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-13T23:15:14.890

仅供参考，Clean 和 Rebuild 都不会删除非构建文件，例如在预构建命令期间复制的文件。我一直对此感到困惑！

# arrays - 使用 vb.net 查找数组中的最小值和最大值

> ID：221804
> 
> 赞同：2
> 
> 时间：2008-10-21T13:07:15.410
> 
> 标签：arrays, vb.net

我需要在数组中找到最小值和最大值。该`.max`功能有效，但`.min`始终显示为零。

```
Public Class Program_2_Grade
    Dim max As Integer
    Dim min As Integer
    Dim average As Integer
    Dim average1 As Integer
    Dim grade As String
    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        If TextBox1.Text = Nothing Or TextBox1.Text > 100 Then
            MsgBox("Doesn't Meet Grade Requirements", MsgBoxStyle.Exclamation, "Error")
            TextBox1.Clear()
            TextBox1.Focus()
            counter = 0
        Else
            grade_enter(counter) = TextBox1.Text
            TextBox1.Clear()
            TextBox1.Focus()
            counter = counter + 1

            If counter = grade_amount Then
                max = grade_enter.Max()
                min = grade_enter.Min()

                For i As Integer = 0 To counter
                    average = average + grade_enter(i) / counter
                    average1 = average1 + grade_enter(i) - grade_enter.Min / counter
                Next

                Select Case average
                    Case 30 To 49
                        grade = "C"
                    Case 50 To 69
                        grade = "B"
                    Case 70 To 100
                        grade = "A"
                    Case Else
                        grade = "Fail"
                End Select

                If (Program_2.CheckBox1.Checked = True) Then
                    Program_2.TextBox4.Text = _
                ("Name:" & " " & (Program_2.TextBox1.Text) & vbNewLine & _
                "Class: " & (Program_2.TextBox2.Text) & vbNewLine & _
                "Number Of Grades:" & " " & (Program_2.TextBox3.Text) & vbNewLine & _
                "Max:" & " " & max & vbNewLine & _
                "Min:" & " " & min & vbNewLine & _
                "Average:" & " " & average1 & vbNewLine) & _
                "Grade:" & " " & grade & vbNewLine & _
                "Dropped Lowest Grade"
                Else
                    Program_2.TextBox4.Text = _
                ("Name:" & " " & (Program_2.TextBox1.Text) & vbNewLine & _
                "Class: " & (Program_2.TextBox2.Text) & vbNewLine & _
                "Number Of Grades:" & " " & (Program_2.TextBox3.Text) & vbNewLine & _
                "Max:" & " " & max & vbNewLine & _
                "Min:" & " " & min & vbNewLine & _
                "Average:" & " " & average & vbNewLine) & _
                "Grade:" & " " & grade & vbNewLine
                End If

                Me.Close()
                average = 0
                average1 = 0
                counter = 0
            End If
        End If
    End Sub 
```

我的数组设置在全局范围内。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T13:15:29.247

您尚未显示创建grade_enter 的位置。我的猜测是它比它需要的大，所以当你试图找到最小值时，会有“空”条目（值为 0）被拾取。

您可以将其更改为：

```
max = grade_enter.Take(counter).Max()
min = grade_enter.Take(counter).Min() 
```

作为使其工作的一种骇人听闻的方式，但最好使用适量的空间来开始（或 a `List(Of Integer)`）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T13:37:21.760

库存101：

正如其他人所提到的，您的数组的初始值将为 0，因此如果您创建的数组大于必要的，`Min()`将始终返回 0。

此外，Visual Basic .NET 的一个可爱的小怪癖是，当您声明一个数组时，例如：

```
Public grade_enter(20) As Integer 
```

您实际上是在创建一个 21 项数组，而不是 20 项数组。（VB 将数组声明为其上限。）（参见[StartVBDotNet](http://www.startvbdotnet.com/language/arrays.aspx)。）所以这可能与它有关。

无论如何，如果您使用的是 VB.NET 2005 或 2008，您可能会考虑学习该[`List(Of Integer)`](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)课程。（这实际上只是一个`List`类；它就是所谓的“通用”。）这个类将允许您动态调整大小的数组，这些数组会根据添加到其中的项目而增长或缩小。不幸的是，它没有`Min()`and`Max()`方法，但它确实有一个[`ToArray()`](http://msdn.microsoft.com/en-us/library/x303t819.aspx)方法，然后您可以从中运行`Min()`and`Max()`方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T13:15:42.740

我很难找到您定义grade_enter() 的位置。如果你把它分解成几个更小的方法，那段代码会更容易阅读。但我猜你将它定义为一个整数数组，其静态大小足以容纳教授告诉你期望的许多项目。在这种情况下，任何未设置的项目的值为 0，这将小于输入的任何成绩。您需要考虑这一点，也许是使用 a`List(Of Integer)`而不是数组。

# debugging - 向后调试

> ID：221806
> 
> 赞同：5
> 
> 时间：2008-10-21T13:07:35.907
> 
> 标签：debugging

我有两个问题：

1.  在进行源代码级调试（使用任何调试器）时，任何调试器是否会保存某些迭代/for-loop/任何已执行代码的状态，并允许用户在稍后的时间点在调试期间返回到先前执行的代码/数据状态？对此的需要是一些变量/指针在执行期间的某个时间较早的地方被损坏，但在代码执行的一段时间后/稍后被访问，这就是它崩溃/挂起代码的时候，所以我想回去看看哪个函数/变量何时损坏/计算并写入错误的值？是否可以在任何调试器中（gcc，MSVC6.0 ...）

2.  是否有任何调试器/IDE 规定当内存地址/变量被标记为“分析”时，它应该在每次更改/写入时显示哪个文件中的哪个函数，以及哪个代码更改了该内存（写入）？

-广告

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T13:28:48.673

这听起来很像您想要获取 Visual Studio 2010 的副本。

他们几乎完全实现了您在 #1 中描述的内容 - 在[Channel 9](http://channel9.msdn.com/posts/VisualStudio/Historical-Debugger-and-Test-Impact-Analysis-in-Visual-Studio-Team-System-2010/)上的 Visual Studio Team System 2010 中有一个关于新的“历史调试器”的截屏视频。

在位于此处的这个条目中有更多关于它的内容[（这个是代号为“Rosario”的 2008 年 4 月 CTP）](http://dotnet.org.za/willy/archive/2008/06/06/rosario-april-ctp-investigation-part-6-developer.aspx)

我从 Maor David 的博客文章中找到了新历史调试器的定义（[这里](http://blogs.microsoft.co.il/blogs/maordavid/archive/2008/04/21/Rosario-Preview-_2300_3-_2D00_-Developer-Edition.aspx)）：

“Visual Studio 历史调试器捕获并记录应用程序在运行时所做的事情。当发生错误时，您可以通过调查历史调试器记录的信息快速找到根本原因。在调试过程中的任何时候，您都可以去及时向后和向前以确定错误发生的位置。”

这里还有另一个[视频演练](http://blogs.msdn.com/habibh/archive/2008/10/01/what-s-new-in-visual-studio-team-system-2010-issue-2.aspx)！

编辑：我开始评估Visual Studio 2010 的[最近 (1) 次 CTP](http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en)下降（31/10 - 10 月 8 日），他们似乎实现了历史调试器的早期版本。这可能值得一试。

(1) [ [http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en]](http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en])

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T13:34:58.927

我认为您正在尝试使用[Omniscient 调试器](http://www.lambdacs.com/debugger/)或[有形程序历史](http://research.microsoft.com/research/pubs/view.aspx?msr_tr_id=MSR-TR-2000-54)（从 1999 年开始！！）。

当然，这些是更多的研究论文/实现，但似乎这些概念终于进入了主流编译器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T13:16:50.787

对于 #2，您可能想了解gdb 中可用的[watchpoints以及其他调试器。](http://www.unknownroad.com/rtfm/gdbtut/gdbwatch.html)

> 观察点类似于断点。但是，没有为函数或代码行设置观察点。观察点设置在变量上。当这些变量被读取或写入时，观察点被触发并且程序执行停止。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-06-06T11:17:43.157

自 2009 年 9 月以来，GNU 调试器 (gdb) 具有反向调试的可能性，即能够使被调试的程序单步执行并反向继续。这听起来像你所要求的。

有关详细信息，请参见此处：http: [//sourceware.org/gdb/news/reversible.html](http://sourceware.org/gdb/news/reversible.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T14:05:55.947

You may want to look at [Replay Debugging](http://stackframe.blogspot.com/2008/09/replay-debugging-works-with-windows.html) from VMware.

From the link:

> What we did was integrating Visual Studio plugin for Workstation with Record/Replay technology. You can now develop your application with Visual Studio, and then with a few mouse clicks launch it in a VM in recording mode. You can then replay recording as many times as you want, using all the debugging facilities Visual Studio provides.
> 
> But we did not stop at that. We also implemented unique "reverse execution" feature. Say, if you are debugging a memory corruption, you can put watchpoint on corrupted memory and then hit "Reverse Continue" in Visual Studio plugin menu - and we'll navigate the recording right to the place where memory was last written to.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T13:15:46.810

我不知道有任何调试器可以让您保存状态以便稍后返回。调试器无法知道什么状态是相关的。您可以得到的最接近的方法是在某个时候创建​​一个转储文件，这可以让您稍后检查整个程序状态。

Visual Studio 确实支持[数据断点](http://msdn.microsoft.com/en-us/library/350dyxd0.aspx)，只要写入给定的内存位置，它就会中断调试器。

这些对于找出正在损坏的内存块上的内容非常有用。但是，您可以设置的数据断点的数量存在限制，因为它们是使用处理器的硬件寄存器支持来实现的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T13:28:45.913

对于第一个问题：ddd/gdb 有一个[回溯](http://www.gnu.org/manual/ddd/html_mono/ddd.html#Backtraces)，可以准确地向您展示它是如何到达那个点的。核心转储也可能会有所帮助。

一篇关于可能的副作用的有趣文章是[这个](http://www.yosefk.com/blog/i-love-globals-or-google-core-dump.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T13:18:02.580

对于第一点，您可以尝试条件断点。我用过的大多数调试器似乎都有这个功能，虽然很多人不知道。您可以将断点设置为仅在满足某些条件时停止，例如您的迭代器变量是某个数字，或者某个其他变量为空。例如：

```
for (i = 0; i < list.size(); i++) {
  foo = list[i];
} 
```

您可以设置条件断点来停止 when`i == 17`或 when `foo == null`。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T13:20:28.613

这样的调试器正在制作中。您可以查看以下[Google Talk - 及时向后调试](http://www.youtube.com/watch?v=xpI8hIgOyko)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T14:18:21.630

While current debuggers don't save the state, they do let you go back, to some degree. You can use the "move execution point to here" feature (actual name will depend on your debugger, of course) to set the line being executed.

This only really works well for jumping around within a single function, but it can be useful for "trying again" with a different value - you break after a loop, use the debugger to change the variable values, and then jump back to the top of the loop. Alternatively, if you know that a function call is going to fail but you want to see what happens afterwards (for example... something timed out because you were stopped in the debugger, but you want to carry on executing as if it hadn't timed out), you can use the "move execution point to here" feature to skip over that code.

I know it's not what you asked for, but for the moment, it's all we have... I believe such technology will probably be available fairly soon, but for the moment I think it is in the "research" phase.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T13:13:25.863

我相信最新版本的 OCaml 有这个。这似乎是一种新时尚，但 IIRC 这在 Visual Studio 未来版本的愿望清单上。

VS 中我没有使用过的一个功能，可以跟踪对象（制作对象 id 或其他东西）。

# visual-studio - Visual Studio 的 Mylyn 类型插件

> ID：221809
> 
> 赞同：22
> 
> 时间：2008-10-21T13:08:10.150
> 
> 标签：visual-studio, plugins, mylyn

[Mylyn](http://www.eclipse.org/mylyn/)是一个面向任务的插件，例如，它允许将一组文件分配给一个任务。是否有适用于 Visual Studio 的 Mylyn 类型插件？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-08-13T20:25:52.430

Tasktop 刚刚宣布将 Mylyn 的生产力引入 Visual Studio！正在发布的测试版将支持从 HP ALM、Quality Center 和 Bugzilla 引入任务。它包括 Mylyn 的**任务列表**和**任务编辑器**。下一个级别的支持，包括与所有现有 Mylyn 连接器的兼容性，将在此测试版之后提供。更进一步，Tasktop 还将在 Visual Studio IDE 中提供上下文捕获和焦点。

Beta 版将于 2010 年 11 月末发布。

有关详细信息，请参阅最近的[博客文章](http://tasktop.com/blog/tasktop/eclipse-mylyn-microsoft-visual-studio)。

大卫·谢泼德，Tasktop 技术
[http://www.twitter.com/davidcshepherd](http://www.twitter.com/davidcshepherd)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T11:37:58.350

我发现的最接近的是[Tasktop](http://tasktop.com/products/)，由创建 Mylyn 的人开发，但它是一个独立的应用程序，不与 Visual Studio 集成。

（Resharper 无关紧要）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-12T19:08:25.480

甚至不接近 mylyn，但这是一个用于 Visual Studio 的开源插件，它有助于将源文件列表分配给“会话”（您可以将会话视为“任务”）

[http://dsmaddin.codeplex.com/](http://dsmaddin.codeplex.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T23:24:12.767

我不知道任何开源，但我知道团队系统设置为支持这种类型的工作流。

resharper 可能还具有您正在寻找的功能，但同样不是 foss

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T15:20:05.360

我在 Teched 2008 向 VS.NET 开发团队提出了这个问题。

她说他们已经注意到了 Mylyn，但仍在关注它。任务聚焦插件在 VS.NET 环境中还没有准备好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-23T08:37:30.020

您可能对来自 Tasktop 的新闻感兴趣：http: [//tasktop.com/blog/tasktop/eclipse-mylyn-microsoft-visual-studio](http://tasktop.com/blog/tasktop/eclipse-mylyn-microsoft-visual-studio)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-28T21:31:07.437

我将第二个tasktop。最新版本特别好看。就像 orip 说的那样，它不提供 VS 集成，但是有一个 Firefox 扩展，它应该非常好……胜过纯粹为 Mylyn 使用 Eclipse。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-05-31T12:05:02.457

我最近发布了 Visual Studio 2015 的（商业）[Task Canvas](https://vlasovstudio.com/task-canvas/)扩展，它支持具有分配的文档集和代码片段的任务。

# flash - 基于 Flash 的 RSS1/RSS2/ATOM/RDF 阅读器的来源？

> ID：221819
> 
> 赞同：0
> 
> 时间：2008-10-21T13:10:49.333
> 
> 标签：flash, actionscript, rss, rdf, atom-feed

有谁知道在哪里可以找到一个好的开源 RSS 阅读器在 Flash 中？我看到很多实现了 RSS 或 ATOM 或 RSS2，但没有一个能实现所有不同的 RSS 样式格式。我更愿意将它保存在 Flash 中，因为我试图保留它，以便它以最低的服务器要求运行......

要求： - 解析 RSS1/RSS2/ATOM/RDF，如果可能，更多 - 在 ActionScript 2 中工作 - 最好是开源的，但如果它带有源代码，我会考虑商业化。

谢谢，

布拉德。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-21T14:35:40.113

你看过[as3syndicationlib](http://code.google.com/p/as3syndicationlib/)吗？它是用 ActionScript 3 编写的，但如果您真的需要在 ActionScript 2 中使用它，我认为您可以轻松移植它。

> 使用联合库轻松解析 Atom 和所有版本的 RSS。该库隐藏了格式之间的差异，因此您可以解析任何类型的提要，而无需知道它是哪种提要。

# sql - Sybase开发者问：Oracle中如何创建临时表？

> ID：221822
> 
> 赞同：4
> 
> 时间：2008-10-21T13:11:43.450
> 
> 标签：sql, sql-server, oracle, sybase, temp-tables

我熟悉 Sybase / SQL server，我可以在其中创建一个临时文件。像这样的表：

```
SELECT * 
INTO   #temp
FROM   tab1 , 
       tab2 
WHERE  tab1.key = tab2.fkey

SELECT * 
FROM   #temp 
WHERE  field1 = 'value' 
```

#temp 仅在此会话期间存在，并且只能由我看到。

我想在 Oracle 中做类似的事情，但我正在阅读“全局临时表”，这听起来不像是一回事。

如何在 Oracle 中执行与在 Sybase 中相同的操作？

谢谢 ：）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T13:35:41.403

全局临时表是不一样的，定义在会话结束后仍然存在，表（但不是数据）对所有会话都是可见的。

如果您正在编写存储过程，您是否研究过游标？它有点复杂，但使用临时数据集是一种非常有效和干净的方式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-22T13:31:06.733

您的第一种方法应该是作为单个查询执行此操作：

```
SELECT * 
FROM   
(
SELECT * 
FROM   tab1 , 
       tab2 
WHERE  tab1.key = tab2.fkey
)
WHERE  field1 = 'value'; 
```

对于非常复杂的情况或 temp# 非常大的情况，请尝试使用子查询因式分解子句，可选择使用具体化提示：

```
with #temp as
(
SELECT /*+ materialize */ 
       * 
FROM   tab1 , 
       tab2 
WHERE  tab1.key = tab2.fkey
)
SELECT * 
FROM   temp#
WHERE  field1 = 'value'; 
```

如果这没有帮助，请转到全局临时表方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T19:25:05.083

Oracle 不提供此工具的直接类似物。全局临时表是类似的，但它必须提前创建，并且由于锁定问题可能难以更改。

这种性质的大多数需求都可以通过游标或不同的 pl/sql 集合类型（嵌套表、可变数组、关联数组）之一来满足，但这些都不能像表一样使用。也就是说，您不能从它们中选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T13:28:06.023

我相信[全局临时](http://www.oracle-base.com/articles/8i/TemporaryTables.php)表是一样的。他们将为您提供对会话结束时终止的临时表的私有访问权限：

> 全局临时表中的数据是私有的，因此会话插入的数据只能由该会话访问。全局临时表中特定于会话的行可以为整个会话保留，也可以只为当前事务保留。ON COMMIT DELETE ROWS 子句指示应在事务结束时删除数据。

再读几次问题后，我认为这是主要区别，也许您的问题是临时表在会话之间持续存在。因此，正如您在 Oracle 中想象的那样，不可能完全等价于：

```
CREATE GLOBAL TEMPORARY TABLE my_temp_table ON COMMIT DELETE ROWS select * from other table; 
```

即使通过会话，该表将一直存在，直到它被删除，尽管其中的数据没有。相反，您需要提前创建临时表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T13:38:34.533

Oracle 中的临时表模型有些不同，它以“CREATE GLOBAL TEMPORARY TABLE..”语句为中心。临时表定义始终是全局的，但数据始终是会话私有的，并且数据是否在提交时保留取决于是否指定了限定条件“提交时保留行”或“提交时删除行”。

我在我的博客上有一些 Perl 脚本和一篇探索特定行为或 Oracle 临时表的[博](http://tardate.blogspot.com/2007/05/do-oracle-temp-tables-behave-correctly.html)文。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T13:30:31.820

是的，卡森说得对。全局临时表仅对创建它们的会话可见，并在第一次提交或回滚时或在会话结束时消失。您可以在创建 gtt 时进行设置。

# c# - 影响 UTC 转换的夏令时更改

> ID：221824
> 
> 赞同：9
> 
> 时间：2008-10-21T13:12:50.047
> 
> 标签：c#, .net

基本上，我将存储在数据库中的本地日期转换为 UTC。但我在某处读到夏令时规则在 2007 年发生了变化。Date.ToUniversalTime() 函数仍然正常工作。基本上 2007 年之前的日期（新规则生效时）会被正确转换，但之后的日期不会。我在这里吗？或者.Net 会在内部处理转换，即取决于不同的夏令时规则？

编辑：日期作为当地时间存储在数据库中。我正在将其转换为 UTC。因此，诸如“2005 年 3 月 9 日”之类的日期应使用 2005 年的日光规则而不是今天的规则进行转换。2007 年，美国的规则发生了变化。所以日期差了一小时。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T13:18:41.720

这取决于您使用的 .NET 版本以及您使用的 Windows 版本。.NET 3.5 具有包含历史更改等的[TimeZoneInfo](http://msdn.microsoft.com/en-us/library/system.timezoneinfo.aspx)类 - 不幸的是，在此之前，支持更加不完整。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T13:18:13.640

我希望`ToUniversalTime()`考虑到这一点。您是否尝试并检查了 DST 更改前后日期的结果？

编辑

如果您*知道*数据库中所有日期的时区偏移量，我强烈建议您在表级别将它们转换为 UTC。这样你就摆脱了很多头痛。转换为本地时间以进行显示更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T13:22:48.390

这取决于信息在数据库中的存储方式。

希望数据库中的数据包含 UTC 偏移量，如果是这样，对夏令时规则的任何更改都将无关紧要。

如果不知道 UTC 偏移量，那么几乎不可能知道如何将其转换为 UTC。例如，如果时间被存储为一个没有元数据的整数，那么系统必须知道它*何时*被添加到数据库中，以便能够计算出相应的 UTC 时间戳。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T14:20:33.577

我不想这么说，但你*完蛋*了。咬紧牙关，在问题变得更糟之前将数据库中的日期更改为 UTC。如果您继续尝试将本地时间存储在数据库中，您的代码将很快成为特例日期数学的噩梦。

妥协：将本地时间和 UTC 时间存储在单独的列中；至少你会有一个参考

看到[这篇文章](https://stackoverflow.com/questions/220405/how-to-deal-with-time-storage-in-sql#220706)有更多的理由永远不要在本地时间存储数据库时间

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-13T14:05:18.040

看看[http://geekswithblogs.net/ewright/archive/2004/09/14/11180.aspx](http://geekswithblogs.net/ewright/archive/2004/09/14/11180.aspx)是否对你有帮助。

# database - 访问的替代方案

> ID：221826
> 
> 赞同：15
> 
> 时间：2008-10-21T13:14:21.977
> 
> 标签：database, ms-access, portable-database

MS Access 有什么替代品吗？

要求：

*   便携式数据库文件
*   **用于数据输入的集成表单开发**
*   无需编译。可以即时修改。

* * *

还有两个要求：

*   适用于 Linux 或 Windows

*   不一定是免费的

    编辑：强调*数据输入的集成表单开发*作为该问题的最高投票答案，在编辑时，两者都推荐一个简单的数据库系统。对于简单的部门级 CRUD（以及更多）应用程序而言，Access 仍然难以替代的原因是数据库、数据输入表单和报告工具的集成。简单地推荐一个数据库并*不能*回答所提出的问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T13:47:40.880

您的选择似乎是：

1.  [SQL 服务器速成](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx)。这曾经被称为 MSDE

2.  SQL Server 精简版。

3.  [MySQL](http://www.mysql.com/)。

4.  [SQLite](http://www.sqlite.org/)。

5.  [维斯塔数据库](http://www.vistadb.net/)。

==========

我正在修改它以添加我发现的唯一真正的竞争者：Kexi

[http://kexi-project.org/](http://kexi-project.org/)

我不能说我用过它，但它看起来会做你想做的一切。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-21T13:20:59.297

OpenOffice 附带的可能是您正在寻找的，我相信它被称为“Base”：http: [//dba.openoffice.org](http://dba.openoffice.org)

不过，我投票给 zacherates 是因为我也喜欢 SQLite。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T13:17:53.187

[SQLite](http://www.sqlite.org/)一直是我对轻量级数据库的选择，尽管它没有表单创建器，因为它只是一个数据库。

SQLite 很棒，因为：

*   它只是您的应用程序调用的库，而不是服务器。
*   没有配置。
*   您的数据库只是一个文件。

（...对于那些沉迷于单元测试的人，您可以在内存数据库中使用它进行测试：）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T19:24:13.200

我已经完成了很多 MS-Access 开发，从表单设计或 RAD（快速应用程序开发）的角度来看，这很难被击败。

但是，您可以将 MS-Access 与另一个数据库服务器结合使用，这将为您提供灵活性。我的建议是使用 Sybase Advantage 数据库服务器。由于我支持该产品，所以我有点偏见，但我们有一个免费的本地服务器版本供您试用，稍后您可以通过简单地更改连接来实现完整的客户端/服务器设置。[优势开发区](http://devzone.advantagedatabase.com)

如果您使用其他数据库引擎，您可能会使用 ODBC 作为 Advantage 支持的连接类型以及 JDBC、OLEDB、.NET、PHP 等。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T13:51:22.683

当您在网站上搜索此问题的答案时，您可能错过了[此问答。](https://stackoverflow.com/questions/29044/good-free-alternative-to-ms-access)你也可以在那里找到一些不错的选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-21T13:37:37.360

FileMaker 满足您的要求，尽管我不建议将它用于协作开发。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-08-10T07:47:10.013

查看文件制作者

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T16:02:24.900

我过去使用过[4th Dimension](http://www.4d.com/)。但是，我不知道它是否*需要*编译 - 但它可以编译。

但在我看来，它的设计特点非常友好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-25T18:28:51.003

如果您要在共享主机上运行您的网站（几乎所有这些都不允许您在完全信任模式下运行您的网站），并且如果您需要简单的启用 x-copy 部署的网站，VistaDB 是唯一的选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T13:27:44.557

曾经有一个很棒的dos产品，叫做Q&A，后来变成了[http://www.lantica.com/](http://www.lantica.com/)，但是自从dos版本之后我就没有看过它。

或者试试这个 wiki 页面[http://en.wikipedia.org/wiki/Comparison_of_office_suites](http://en.wikipedia.org/wiki/Comparison_of_office_suites)在底部附近有一些比较表。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-10-21T13:16:36.107

[SQLite](http://www.sqlite.org)很棒。

# asp.net - 带有 ASP.Net MVC 的 VirtualPathProvider

> ID：221828
> 
> 赞同：1
> 
> 时间：2008-10-21T13:14:31.183
> 
> 标签：asp.net, asp.net-mvc

我已经实现了 VirtualPathProvider 类，因此我可以将所有视图保存在数据库中，而不是 Web 服务器的 FileSystem 中。

似乎 MVC 从数据库中正确请求了 aspx 页面，但无法请求相关的代码隐藏 .cs 文件并由于无法加载代码隐藏类文件而引发错误。

这个 virtualPathProvider 就像普通 Web 表单的魅力一样。

我必须对 MVC 框架或任何其他内容进行任何特定更改吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T16:08:28.443

ASP.NET MVC 是一种 Web 应用程序项目。因此，所有的代码隐藏在部署之前都被编译成一个程序集。在请求时编译代码隐藏时，它不像网站项目。

这意味着您的视图有一个“继承”声明。他们继承的类型必须存在于某个地方。如果您的页面从 ViewPage 继承，那么您已经设置好了。如果他们从 T 的 ViewPage 继承，那么你就有问题了。定义泛型类型的 CLR 语法很丑陋。查看这篇[文章了解更多信息](http://www.squaredroot.com/post/2008/01/MVC-Strongly-Type-ViewPages-Without-A-Code-Behind.aspx)。

下面是一个语法示例：

```
System.Web.Mvc.ViewPage`1[ [System.Int32,mscorlib] ] 
```

# java - 在 Java 中设置 BufferedImage alpha 掩码

> ID：221830
> 
> 赞同：21
> 
> 时间：2008-10-21T13:14:45.440
> 
> 标签：java, graphics, alpha, compositing

我有两个从 png 加载的 BufferedImages。第一个包含图像，第二个包含图像的 alpha 蒙版。

我想通过应用 alpha 蒙版从两者中创建一个组合图像。我的 google-fu 让我失望了。

我知道如何加载/保存图像，我只需要从两个 BufferedImage 到一个具有正确 alpha 通道的 BufferedImage 的位。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2011-11-08T23:24:14.703

这个答案我来得太晚了，但无论如何它可能对某人有用。这是 Michael Myers 方法的一个更简单、更有效的版本：

```
public void applyGrayscaleMaskToAlpha(BufferedImage image, BufferedImage mask)
{
    int width = image.getWidth();
    int height = image.getHeight();

    int[] imagePixels = image.getRGB(0, 0, width, height, null, 0, width);
    int[] maskPixels = mask.getRGB(0, 0, width, height, null, 0, width);

    for (int i = 0; i < imagePixels.length; i++)
    {
        int color = imagePixels[i] & 0x00ffffff; // Mask preexisting alpha
        int alpha = maskPixels[i] << 24; // Shift blue to alpha
        imagePixels[i] = color | alpha;
    }

    image.setRGB(0, 0, width, height, imagePixels, 0, width);
} 
```

它在开始时将所有像素读入一个数组，因此只需要一个 for 循环。此外，它直接将蓝色字节转换为 alpha（掩码颜色），而不是先掩蔽红色字节然后再转换它。

与其他方法一样，它假设两个图像具有相同的尺寸。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-21T14:02:08.793

我最近玩了一些这个东西，在另一个图像上显示图像，并将图像淡化为灰色。
还使用具有透明度的蒙版蒙版图像（我以前版本的此消息！）。

我使用了我的小测试程序并对其进行了一些调整以获得想要的结果。

以下是相关位：

```
TestMask() throws IOException
{
    m_images = new BufferedImage[3];
    m_images[0] = ImageIO.read(new File("E:/Documents/images/map.png"));
    m_images[1] = ImageIO.read(new File("E:/Documents/images/mapMask3.png"));
    Image transpImg = TransformGrayToTransparency(m_images[1]);
    m_images[2] = ApplyTransparency(m_images[0], transpImg);
}

private Image TransformGrayToTransparency(BufferedImage image)
{
    ImageFilter filter = new RGBImageFilter()
    {
        public final int filterRGB(int x, int y, int rgb)
        {
            return (rgb << 8) & 0xFF000000;
        }
    };

    ImageProducer ip = new FilteredImageSource(image.getSource(), filter);
    return Toolkit.getDefaultToolkit().createImage(ip);
}

private BufferedImage ApplyTransparency(BufferedImage image, Image mask)
{
    BufferedImage dest = new BufferedImage(
            image.getWidth(), image.getHeight(),
            BufferedImage.TYPE_INT_ARGB);
    Graphics2D g2 = dest.createGraphics();
    g2.drawImage(image, 0, 0, null);
    AlphaComposite ac = AlphaComposite.getInstance(AlphaComposite.DST_IN, 1.0F);
    g2.setComposite(ac);
    g2.drawImage(mask, 0, 0, null);
    g2.dispose();
    return dest;
} 
```

其余的只是在一个小的 Swing 面板中显示图像。
请注意，蒙版图像是灰度级，黑色变为完全透明，白色变为完全不透明。

虽然你已经解决了你的问题，但我可以分享我的看法。它使用了一种更类似于 Java 的方法，使用标准类来处理/过滤图像。
实际上，我的方法使用了更多的内存（制作额外的图像），我不确定它是否更快（测量各自的性能可能很有趣），但它稍微抽象一点。
至少，你有选择！:-)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-21T14:02:57.730

您的解决方案可以通过一次获取超过一个像素的 RGB 数据来改进（请参阅[http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html](http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html)），并通过不在内部循环的每次迭代中创建三个 Color 对象。

```
final int width = image.getWidth();
int[] imgData = new int[width];
int[] maskData = new int[width];

for (int y = 0; y < image.getHeight(); y++) {
    // fetch a line of data from each image
    image.getRGB(0, y, width, 1, imgData, 0, 1);
    mask.getRGB(0, y, width, 1, maskData, 0, 1);
    // apply the mask
    for (int x = 0; x < width; x++) {
        int color = imgData[x] & 0x00FFFFFF; // mask away any alpha present
        int maskColor = (maskData[x] & 0x00FF0000) << 8; // shift red into alpha bits
        color |= maskColor;
        imgData[x] = color;
    }
    // replace the data
    image.setRGB(0, y, width, 1, imgData, 0, 1);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-09-28T17:20:56.977

对于那些在原始图像中使用 alpha 的人。

我在 Koltin 中编写了这段代码，这里的关键点是，如果您的原始图像上有 alpha，则需要将这些通道相乘。

科尔廷版本：

```
 val width = this.width
    val imgData = IntArray(width)
    val maskData = IntArray(width)

    for(y in 0..(this.height - 1)) {

      this.getRGB(0, y, width, 1, imgData, 0, 1)
      mask.getRGB(0, y, width, 1, maskData, 0, 1)

      for (x in 0..(this.width - 1)) {

        val maskAlpha = (maskData[x] and 0x000000FF)/ 255f
        val imageAlpha = ((imgData[x] shr 24) and 0x000000FF) / 255f
        val rgb = imgData[x] and 0x00FFFFFF
        val alpha = ((maskAlpha * imageAlpha) * 255).toInt() shl 24
        imgData[x] = rgb or alpha
      }
      this.setRGB(0, y, width, 1, imgData, 0, 1)
    } 
```

Java 版本（刚从 Kotlin 翻译过来的）

```
 int width = image.getWidth();
    int[] imgData = new int[width];
    int[] maskData = new int[width];

    for (int y = 0; y < image.getHeight(); y ++) {

        image.getRGB(0, y, width, 1, imgData, 0, 1);
        mask.getRGB(0, y, width, 1, maskData, 0, 1);

        for (int x = 0; x < image.getWidth(); x ++) {

            //Normalize (0 - 1)
            float maskAlpha = (maskData[x] & 0x000000FF)/ 255f;
            float imageAlpha = ((imgData[x] >> 24) & 0x000000FF) / 255f;

            //Image without alpha channel
            int rgb = imgData[x] & 0x00FFFFFF;

            //Multiplied alpha
            int alpha = ((int) ((maskAlpha * imageAlpha) * 255)) << 24;

            //Add alpha to image
            imgData[x] = rgb | alpha;
        }
        image.setRGB(0, y, width, 1, imgData, 0, 1);
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T13:25:13.517

其实，我已经想通了。这可能不是一种*快速*的方法，但它有效：

```
for (int y = 0; y < image.getHeight(); y++) {
    for (int x = 0; x < image.getWidth(); x++) {
        Color c = new Color(image.getRGB(x, y));
        Color maskC = new Color(mask.getRGB(x, y));
        Color maskedColor = new Color(c.getRed(), c.getGreen(), c.getBlue(),
            maskC.getRed());
        resultImg.setRGB(x, y, maskedColor.getRGB());
    }
} 
```

# java - 热部署 Java EAR 以最小化或消除服务器上应用程序的停机时间？

> ID：221846
> 
> 赞同：7
> 
> 时间：2008-10-21T13:17:01.083
> 
> 标签：java, deployment, jboss

我听说这就是 JavaRebel 所做的，但有没有其他好的方法来部署新版本的 EAR，同时允许用户在以前的版本上保持活动状态？我们使用 JBoss 作为应用程序服务器...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T19:02:36.363

这不是 JavaRebel 所做的。JavaRebel（根据描述）热替换内存中的类。在现有系统连接的情况下这是不可接受的，因为更新的类可能会破坏客户端的逻辑。

曾经我工作的一家公司也遇到过类似的问题，然后就这样解决了：

*   智能路由器被用作负载平衡器
*   新版本已部署到（新）集群的 50% 的节点
*   新连接被严格传送到这些更新的节点，旧节点在旧节点之间平衡
*   旧节点脱机（一个接一个，以使每个节点的客户端数量保持在限制范围内）
*   同时，新版本被部署到离线的“旧”节点，并作为新节点启动
*   由于 EJB 集群，会话和 bean 被其他旧节点拾取
*   最终（几个小时后），只剩下一个旧节点，只有一个旧版本实例，所有使用旧版本的客户端都连接到它
*   当最后一个旧客户端断开连接时，该节点也被关闭

现在，我不是网络人，不能给你很多细节（比如什么是路由器硬件等等）。我的理解这可以很容易地设置，除了，如果我没记错的话，我们必须设置一个额外的 Weblogic 域来部署应用程序的新版本（否则它将与 JNDI 名称上的旧版本冲突）。

希望有帮助。

PS Ichorus 提供了一条评论，称该应用程序部署在客户端的服务器上。所以路由器技巧可能不可行。现在，我现在只看到一个可行的解决方案（现在是 21:52，我可能会忽略一些事情 :)）——

*   使用“版本化”的 JNDI 名称开发新版本；例如，如果客户 bean 在版本 1 中位于 ejb/Customer 下，那么在版本 2 中它将位于 ejb/Customer2 下
*   在应用程序中有一个具有稳定基本接口（工厂风格）的业务外观，当被要求提供 Customer bean 时，它会尝试找到最高版本的 JNDI 名称（当然，不是在每次调用时都可以缓存一个小时左右）。该外观可以（并且应该）部署为一个单独的应用程序——并且永远不会或很少更新
*   现在每个新客户端都可以访问最新部署的应用程序，并且应用程序不会发生冲突。

这种方法需要仔细规划和测试，但恕我直言。

我最近以类似的方式修改了一些应用程序，让它们在同一个域中共存（在它们对不同的数据源使用相同的 JNDI 名称之前）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T09:22:56.063

据我了解，WebLogic 有一个称为并行部署的功能，可以消除 EAR 版本升级期间的停机时间。您可以在不停止现有应用程序的情况下部署新版本，并且一旦成功部署新版本，您就可以透明地从旧版本切换到新版本。

我不确定其他应用程序服务器是否支持这一点。

参考：[http://edocs.bea.com/wls/docs100/deployment/redeploy.html#wp1022490](http://edocs.bea.com/wls/docs100/deployment/redeploy.html#wp1022490)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T06:48:51.287

Vladimir 关于使用负载均衡器的建议是实现您想要的非常可靠的方法。请记住，它不一定是高端硬件负载均衡器。相反，如果您在 JBoss 服务器前面使用本地 Web 服务器（Apache 或 IIS）和 mod_jk 或 mod_proxy，您可以维护一个通用的 Web 外观并在 EAR 升级时实现适用的加载和路由例程。

//尼古拉斯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T02:27:09.867

我认为您可能想使用 OSGI 框架研究 Spring。 [http://www.springframework.org/osgi](http://www.springframework.org/osgi)

# c# - 我昨天的问题的附录：来自 sql 数据库的 C# 类

> ID：221847
> 
> 赞同：1
> 
> 时间：2008-10-21T13:17:42.503
> 
> 标签：c#, asp.net, asp.net-2.0, data-access-layer

这是我的链接： [链接文本](https://stackoverflow.com/questions/219986/c-class-from-a-sql-database-table)

想了想，这是我的另一个问题：

现在，如果我要反对存储过程，是否有一种简单的方法可以不使用 T4、LLCodeGen、Codesmith、subsonic 等来获取输入/输出参数和类型，如果我想生成自己的数据访问层

这是 ASP.Net 2.0

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T13:21:40.480

查看称为对象关系映射或 ORM 的东西。有很多很好的工具可以为您自动化大部分数据层代码：NHibernate、Castle Active Record、[SubSonic](http://subsonicproject.com/)等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T13:27:22.640

添加到 Joel Coehoorn 的 ORM 列表中，您还可以考虑[SubSonic](http://subsonicproject.com/)。我发现它非常易于使用，并且它支持在您认为必要时直接访问您的过程、视图和表格。

使用现有工具而不是滚动自己的代码生成器会好得多。（不是说你不能自己动手，而是为什么要重新发明轮子——尤其是有这么多好的选择呢？）

# c# - 远程机器上的实体框架模型更新

> ID：221862
> 
> 赞同：0
> 
> 时间：2008-10-21T13:22:34.847
> 
> 标签：c#, database, entity-framework

我正在构建一个使用实体框架的 Web 应用程序。这些文件位于远程计算机上，数据库和 Web 服务器也是如此。

在visual studio（2k8sp1）中，项目路径为：\\Server\Web\XXXX

现在，我从数据库中生成了 EF 实体，后来我更新了数据库并在其中添加了一个存储过程。当我想在 Visual Studio 中更新我的模型时，我收到一条错误消息，上面写着：

> 尝试从数据库更新时发生 Systen.ArgumentException 类型的异常。异常消息是：“不同设备上的文件不可能有相对路径”。

关于如何更新我的模型的任何想法？

附言。我也无法在 EF 模型设计器中更改我的连接字符串。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T14:14:28.987

I think you might be using the Entity Framework incorrectly. The edmx files are source code, and should be treated as such. They should be added to your project, checked into source control, and edited locally on the development machine.

Try importing your model from your database into a local edmx and see if that works better for you.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-09T20:31:22.253

你也可以使用[EDMTools2](http://blogs.msdn.com/adonet/archive/2008/06/20/edm-tools-options-part-1-of-4.aspx)工具来更新你的 EDM Schema。你也可以在你的开源代码中使用这个工具例程。只需在项目内部复制并调用一些函数，如创建模型、从模型创建代码..

我希望这对你有帮助

# tfs - TFS 2008 在编辑时自动检出代码

> ID：221873
> 
> 赞同：6
> 
> 时间：2008-10-21T13:26:35.683
> 
> 标签：tfs

我正在处理已添加到 TFS 服务器的 Visual Studio 2008 项目。我不确定已为 TFS 配置了哪些设置和策略（这是由单独的部门完成的，而不是开发人员）

每次我对代码文件进行编辑时，都会自动检出该文件（无需自己明确检出代码文件）

请帮助我找到此设置或策略，因为它目前不是很有用。有时您想进行本地更改以尝试某些内容，而不必检查代码....

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-21T13:35:07.723

它位于 Options\SourceControl\Environment

> 已签出项目：**自动签出**

将其更改为

> 已签出项目：**提示独家结帐**

![在此处输入图像描述](https://i.stack.imgur.com/68oke.png)

或您的首选操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T13:59:04.663

不幸的是，使用 TFS，它会在您的文件上设置只读锁，以防止您在未先检查文件的情况下编辑文件。

我无法忍受这个决定。您需要做的是让 TFS 签出该文件，然后如果您不想签出，则稍后对其“撤消签出”。

确保您已启用共享结帐，专门锁定文件是疯狂的路径。;)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-24T23:21:42.487

我认为这是一个功能而不是问题。如果您更改了一个模块并且它处于源代码控制之下，那么您现在与存储库“不同步”。如果您退出（并且默认行为是保存） - 稍后再回来 - 该文件不是其他人看到的。这可能很危险。

例如：在 VSS 的日子里——在一个星期五的下午，我不得不“灭火”并调试 Prod 环境中的问题，所以我在相应的配置文件中更改了连接字符串。另一位开发人员检查了该文件 - 所以我做了通常的解决方法将文件标记为只读，以便我可以保存它。我发现了问题并通知了用户。这是在灭火模式 - 所以我没有考虑我现在在我的开发配置中有生产连接字符串的事实。

星期一早上我进来打开解决方案。是否有任何反馈告诉我配置文件指向生产？不，我必须记住。

但是，如果文件已签出-该图标对我来说是一个指示器，它“标记”了文件已被修改的事实。我不太明白必须右键单击解决方案并说“取消待定更改”的“大问题”

或者，如果您想保存它们，正如 aleichtle.wordpress 的反对意见（我不理解反对票 - 我认为这是一个很好的建议）所解释的那样，您可以搁置更改。这将删除签出并将更改保存在服务器上。

版本控制系统是软件开发生命周期的关键和重要组成部分。考虑你的“过程”很重要。当您使用不同的工具时，您可能需要进行调整（“在罗马时”....）

进行调整可能很困难 - 但通常有充分的理由该工具以它的方式工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T13:32:05.763

您可以制作代码的搁置集，允许您对代码进行更改而不影响其余的开发。

您可以通过右键单击文件并选择搁置未决更改来执行此操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-27T16:59:32.550

我正在运行 Windows 7 和 VS 2010。在 Windows 资源管理器中，您可以 - 右键单击​​项目的主文件夹 - 选择 Team Foundation Server - 选择工作区 - 删除活动的工作文件夹（屏幕底部）。

我相信这会删除与 TFS 的绑定，并且您可以随意对您的代码造成严重破坏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T14:20:18.773

*   关闭您的解决方案。

*   拔下网络电缆。

*   打开您的解决方案。

*   Visual Studio 将告诉您 TFS 不可用，并将打开“脱机”解决方案。

*   重新插入网络电缆。除非您明确要求，否则 VS 不应采用“在线”解决方案。

*   然后，您可以进行任何您喜欢的更改。当您尝试保存文件时，它会告诉您它们是只读的 - 只需覆盖它们。

*   如果您决定要签入它们，请通过在解决方案资源管理器中右键单击该解决方案来在线获取该解决方案。

*   否则，只需在完成后删除源的本地副本。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-02T21:39:10.623

您可以从文件菜单中删除与源代码管理的绑定。

# java - Java 可扩展枚举

> ID：221892
> 
> 赞同：7
> 
> 时间：2008-10-21T13:32:05.763
> 
> 标签：java, design-patterns, enums, enumeration

有没有办法编写一个可以扩展的枚举。我有几种方法我希望始终可用于我的枚举。例如，我对我的数据库字段使用枚举。我在数据库中包含了实际的字段名称。

```
public enum ORDERFIELDS
        {
            OrderID("Order_ID");
            private String FieldName;

            private ORDERFIELDS(String fname)
                {
                    this.FieldName = fname;
                }

            public String getFieldName()
                {
                    return FieldName;
                }
        } 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-21T13:35:42.263

所有枚举都隐式扩展`java.lang.Enum`。由于 Java 不支持多重继承，因此枚举不能扩展其他任何东西。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-21T13:38:54.393

如果我理解正确，你想做的是这样的：

```
public abstract class DatabaseField {
    private String fieldName;

    private DatabaseField(String fieldName) {
        this.fieldName = fieldName;
    }

    public String getFieldName() {
        return fieldName;
    }
} 
```

然后定义你的枚举来扩展这个类。然而，不幸的是枚举不能扩展一个类，但它可以实现一个接口，所以目前你能做的最好的事情就是定义一个包含 getFieldName() 方法的接口，并让你的所有枚举都实现这个接口。

但是，这意味着您必须在所有枚举中复制此方法（以及任何其他方法）的实现。[这个问题](https://stackoverflow.com/questions/77213/eliminating-duplicate-enum-code)中有一些关于如何尽量减少这种重复的建议。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T13:40:01.287

枚举可以实现接口但不能扩展，因为在编译时它们会转换为 java.lang.Enum。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-21T19:59:23.517

抽象枚举可能非常有用（目前不允许）。但是，如果您想游说 Sun 中的某个人添加它，那么存在一个提案和原型：

[http://freddy33.blogspot.com/2007/11/abstract-enum-ricky-carlson-way.html](http://freddy33.blogspot.com/2007/11/abstract-enum-ricky-carlson-way.html)

太阳 RFE：

[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6570766](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6570766)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T14:22:55.973

要回到 Java 之前的 5 天，请查看[Josh Bloch 的第 5 章第 21 条，有效的 Java](http://java.sun.com/developer/Books/effectivejava/Chapter5.pdf)。他谈到通过添加值来扩展“枚举”，但也许您可以使用一些技术来添加新方法？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T03:33:27.250

以类似于 Josh Bloch 的 Effective Java 中定义的机制手工制作枚举。

我要补充一点，如果您需要“扩展”枚举，那么枚举可能不是您所追求的构造。它们是静态常量恕我直言。

# c++ - C++：在 Vista 上获取网络适配器的 MAC 地址？

> ID：221894
> 
> 赞同：11
> 
> 时间：2008-10-21T13:34:30.923
> 
> 标签：c++, windows-vista, mac-address

我们目前使用的是[NetBios方法](http://support.microsoft.com/default.aspx?scid=kb;en-us;118623)，在XP下运行正常。在 Vista 下的初步测试表明它也可以工作，但有一些警告 - 例如，必须存在 NetBIOS，并且根据我一直在阅读的内容，适配器的顺序必然会改变。我们的替代方法 - 使用[SNMPExtensionQuery](http://msdn.microsoft.com/en-us/library/aa378021(VS.85).aspx) - 在 Vista 下似乎被破坏了。

问题是：您知道在 Vista 机器上获取本地 MAC 地址列表的可靠方法吗？与 XP 的向后兼容性是一个优点（我宁愿有一个单一的方法而不是许多丑陋的#ifdef）。谢谢！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-21T14:03:32.753

这将为您提供计算机上所有 MAC 地址的列表。它也适用于所有版本的 Windows：

```
void getdMacAddresses(std::vector<std::string> &vMacAddresses;)
{
    vMacAddresses.clear();
    IP_ADAPTER_INFO AdapterInfo[32];       // Allocate information for up to 32 NICs
    DWORD dwBufLen = sizeof(AdapterInfo);  // Save memory size of buffer
    DWORD dwStatus = GetAdaptersInfo(      // Call GetAdapterInfo
    AdapterInfo,                 // [out] buffer to receive data
    &dwBufLen);                  // [in] size of receive data buffer

    //No network card? Other error?
    if(dwStatus != ERROR_SUCCESS)
        return;

    PIP_ADAPTER_INFO pAdapterInfo = AdapterInfo;
    char szBuffer[512];
    while(pAdapterInfo)
    {
        if(pAdapterInfo->Type == MIB_IF_TYPE_ETHERNET)
        {
            sprintf_s(szBuffer, sizeof(szBuffer), "%.2x-%.2x-%.2x-%.2x-%.2x-%.2x"
                , pAdapterInfo->Address[0]
                , pAdapterInfo->Address[1]
                , pAdapterInfo->Address[2]
                , pAdapterInfo->Address[3]
                , pAdapterInfo->Address[4]
                , pAdapterInfo->Address[5]
                );
            vMacAddresses.push_back(szBuffer);
        }
        pAdapterInfo = pAdapterInfo->Next;

    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T13:44:26.147

你可以使用[WMIService](http://msdn.microsoft.com/en-us/library/aa394579(VS.85).aspx)吗？不过，我在 Vista 之前的日子里用它来获取机器的 mac 地址。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-08-29T21:20:55.027

老问题，已经回答，但这是更安全的代码 - 以防 WMI 无法完全初始化。

为了访问有关您的系统的信息，这里有一个极简类，它试图保持安全：

注意：`ToString`和`convertToUtf8`留给`convertFromUtf8`读者作为练习。:)

注意：我刚刚展示了WMI 系统的*安全*初始化和拆卸，以及从 WMI 获取值和获取 MAC 地址的基础知识（OP 中的问题）。

这*来自*工作代码，但在我将其粘贴到此处时进行了修改。因此，有可能其他本应包括在内的东西被遗漏了。哎呀。

```
class WmiAccessor
{
public:
    WmiAccessor()
        : _pWbemLocator(NULL)
        , _pWbemServices(NULL)
        , _com_initialized(false)
        , _com_need_uninitialize(false)
        , _svc_initialized(false)
        , _loc_initialized(false)
        , _all_initialized(false)
        , _errors("")
        , m_mutex()
    {
        HRESULT hr;
        hr = ::CoInitializeEx(NULL, COINIT_MULTITHREADED);
        switch (hr)
        {
        case S_OK:
            // The COM library was initialized successfully on this thread.
            _com_initialized = true;
            _com_need_uninitialize = true;
            break;
        case S_FALSE:
            // The COM library is already initialized on this thread.
            _com_initialized = true;
            _com_need_uninitialize = true;
            break;
        case RPC_E_CHANGED_MODE:
            // A previous call to CoInitializeEx specified the concurrency model
            // for this thread as multithread apartment (MTA).
            //  This could also indicate that a change from neutral-threaded apartment to
            //  single-threaded apartment has occurred.
            _com_initialized = true;
            _com_need_uninitialize = false;
            break;
        default:
            _com_initialized = false;
            _com_need_uninitialize = false;
            _errors += "Failed to initialize COM.\r\n";
            return;
        }

        hr = ::CoInitializeSecurity(NULL, -1, NULL, NULL,
            0 /*RPC_C_AUTHN_LEVEL_DEFAULT*/,
            3 /*RPC_C_IMP_LEVEL_IMPERSONATE*/,
            NULL, EOAC_NONE, NULL);
        // RPC_E_TOO_LATE == Security must be initialized before!
        // It cannot be changed once initialized. I don't care!
        if (FAILED(hr) && (hr != RPC_E_TOO_LATE))
        {
            _errors += "Failed to initialize COM Security.\r\n";
            if (_com_need_uninitialize)
            {
                ::CoUninitialize();
                _com_need_uninitialize = false;
            }
            return;
        }

        hr = _pWbemLocator.CoCreateInstance(CLSID_WbemLocator);
        if (FAILED(hr) || (_pWbemLocator == nullptr))
        {
            _errors += "Failed to initialize WBEM Locator.\r\n";
            return;
        }
        _loc_initialized = true;

        hr = _pWbemLocator->ConnectServer(
            CComBSTR(L"root\\cimv2"), NULL, NULL, 0, NULL, 0, NULL, &_pWbemServices);
        if (FAILED(hr) || (_pWbemServices == nullptr))
        {
            _errors += "Failed to connect WBEM Locator.\r\n";
            _pWbemLocator.Release();
            _loc_initialized = false;
            return;
        }
        else
        {
            _svc_initialized = true;

            // Set security Levels on the proxy
            hr = CoSetProxyBlanket(_pWbemServices,
                RPC_C_AUTHN_WINNT,           // RPC_C_AUTHN_xxx
                RPC_C_AUTHZ_NONE,            // RPC_C_AUTHZ_xxx
                NULL,                        // Server principal name
                RPC_C_AUTHN_LEVEL_CALL,      // RPC_C_AUTHN_LEVEL_xxx
                RPC_C_IMP_LEVEL_IMPERSONATE, // RPC_C_IMP_LEVEL_xxx
                NULL,                        // client identity
                EOAC_NONE                    // proxy capabilities
            );
            if (FAILED(hr))
            {
                _errors += "Failed to set proxy blanket.\r\n";
                return;
            }
        }

        _all_initialized = true;
    }

    ~WmiAccessor()
    {
        std::unique_lock<std::mutex> slock(m_mutex);

        if (_svc_initialized)
        {
            if (_pWbemServices)
                _pWbemServices.Release();
            _svc_initialized = false;
        }
        if (_loc_initialized)
        {
            if (_pWbemLocator)
                _pWbemLocator.Release();
            _loc_initialized = false;
        }
        if (_com_initialized)
        {
            if (_com_need_uninitialize)
            {
                ::CoUninitialize();
            }
            _com_initialized = false;
            _com_need_uninitialize = false;
        }
        _all_initialized = false;
    }

    // public: must lock
    std::string get_and_clear_errors()
    {
        std::string result = "";
        std::unique_lock<std::mutex> slock(m_mutex);
        std::swap(result, _errors);
        return result;
    }

    // public: must lock
    std::string get_string(const std::string& name, const std::string& dflt /*= ""*/)
    {
        std::unique_lock<std::mutex> slock(m_mutex);
        return _all_initialized ? _string(name) : dflt;
    }

    // public: must lock
    uint32_t get_uint32(const std::string& name, uint32_t dflt /*= 0*/)
    {
        std::unique_lock<std::mutex> slock(m_mutex);
        return _all_initialized ? _uint32(name) : dflt;
    }

    // similarly for other public accessors of basic types.

private:
    CComPtr<IWbemLocator> _pWbemLocator;
    CComPtr<IWbemServices> _pWbemServices;
    volatile bool _com_initialized;
    volatile bool _com_need_uninitialize;
    volatile bool _svc_initialized;
    volatile bool _loc_initialized;
    volatile bool _all_initialized;
    std::string _errors;
    CComVariant _variant(const std::wstring& name);
    std::string _string(const std::string& name);
    uint32_t _uint32(const std::string& name);
    uint16_t _uint16(const std::string& name);
    uint8_t _uint8(const std::string& name);
    std::vector<std::string> _macAddresses(bool forceReCalculate = false);
    // to protect internal objects, public methods need to protect the internals.
    //
    mutable std::mutex m_mutex;
    std::vector<std::string> _macs; // unlikely to change, so save them once found.

    // internal: assumes inside a lock
    CComVariant _variant(const std::wstring& name)
    {
        if (!_all_initialized)
            return CComVariant();

        CComPtr<IEnumWbemClassObject> pEnum;
        CComBSTR cbsQuery = std::wstring(L"Select " + name + L" from Win32_OperatingSystem").c_str();
        HRESULT hr = _pWbemServices->ExecQuery(
            CComBSTR(L"WQL"), cbsQuery, WBEM_FLAG_FORWARD_ONLY, NULL, &pEnum);
        CComVariant cvtValue;
        if (FAILED(hr) || !pEnum)
        {
            std::wstring wquery(cbsQuery, SysStringLen(cbsQuery));
            _errors += "Failed to exec WMI query: '" + convertToUtf8(wquery) + "'\r\n";
            return cvtValue;
        }
        ULONG uObjectCount = 0;
        CComPtr<IWbemClassObject> pWmiObject;
        hr = pEnum->Next(WBEM_INFINITE, 1, &pWmiObject, &uObjectCount);
        if (FAILED(hr) || !pWmiObject)
        {
            _errors
                += "Failed to get WMI Next result for: '" + convertToUtf8(name) + "'\r\n";
            return cvtValue;
        }
        hr = pWmiObject->Get(name.c_str(), 0, &cvtValue, 0, 0);
        if (FAILED(hr))
        {
            _errors
                += "Failed to get WMI result value for: '" + convertToUtf8(name) + "'\r\n";
        }
        return cvtValue;
    }

    // internal: assumes inside a lock
    std::string _string(const std::string& name)
    {
        if (!_all_initialized)
            return "";

        CComVariant cvtValue = _variant(convertFromUtf8(name).c_str());
        std::wstring wValue(cvtValue.bstrVal, SysStringLen(cvtValue.bstrVal));
        std::string sValue = convertToUtf8(wValue);
        return sValue;
    }

    // internal: assumes inside a lock
    uint32_t _uint32(const std::string& name)
    {
        if (!_all_initialized)
            return 0;

        CComVariant cvtValue = _variant(convertFromUtf8(name).c_str());
        uint32_t uValue = static_cast<uint32_t>(cvtValue.lVal);
        return uValue;
    }

    // similarly for other internal access of basic types.

    // internal: assumes inside a lock
    std::vector<std::string> _macAddresses(bool forceReCalculate /*= false*/)
    {
        if (!_all_initialized)
        {
            return _macs; // it will still be empty at this point.
        }
        if (forceReCalculate)
        {
            _macs.clear();
        }
        if (_macs.empty())
        {
            // hr == 0x80041010 == WBEM_E_INVALID_CLASS
            // hr == 0x80041017 == WBEM_E_INVALID_QUERY
            // hr == 0x80041018 == WBEM_E_INVALID_QUERY_TYPE
            CComBSTR cbsQuery = std::wstring(L"Select * from Win32_NetworkAdapter").c_str();
            CComPtr<IEnumWbemClassObject> pEnum;
            HRESULT hr = _pWbemServices->ExecQuery(
                CComBSTR(L"WQL"), cbsQuery, WBEM_RETURN_IMMEDIATELY, NULL, &pEnum);
            if (FAILED(hr))
            {
                _errors += "error: MacAddresses: ExecQuery('"
                           + convertToUtf8((LPWSTR)cbsQuery) + "') returned "
                           + ToString(hr) + "\r\n";
            }
            if (SUCCEEDED(hr))
            {
                ULONG fetched;
                VARIANT var;
                IWbemClassObject* pclsObj = NULL;
                while (pEnum)
                {
                    hr = pEnum->Next(WBEM_INFINITE, 1, &pclsObj, &fetched);
                    if (0 == fetched)
                        break;

                    std::string theMac = "";
                    VariantInit(&var);
                    hr = pclsObj->Get(L"MACAddress", 0, &var, 0, 0);
                    if (SUCCEEDED(hr))
                    {
                        switch (var.vt)
                        {
                            case VT_NULL: break;
                            case VT_BSTR:
                                theMac = (var.bstrVal == NULL)
                                       ? ""
                                       : convertToUtf8(var.bstrVal);
                                break;
                            case VT_LPSTR:
                                theMac = (var.bstrVal == NULL)
                                       ? ""
                                       : (const char*)var.bstrVal;
                                break;
                            case VT_LPWSTR:
                                theMac = (var.bstrVal == NULL)
                                       ? ""
                                       : convertToUtf8((LPWSTR)var.bstrVal);
                                break;
                            // _could_ be array of BSTR, LPSTR, LPWSTR; unlikely, but ....
                            case VT_ARRAY | VT_BSTR:
                            case VT_ARRAY | VT_LPSTR:
                            case VT_ARRAY | VT_LPWSTR:
                                _errors += "warning: MacAddresses: unexpected array of addresses";
                                _errors += "\r\n";

                                // yet another exercise for the reader :)
                                break;
                            default:
                                _errors += "error: MacAddresses: unexpected VARIANT.vt =  "
                                       + ToString(var.vt) + "\r\n";
                                break;
                        }
                        // local loopback has an empty address?
                        if (!theMac.empty())
                        {
                            _macs.push_back(theMac);
                        }
                    }
                    VariantClear(&var);
                    pclsObj->Release();
                }
            }
        }
        return _macs;
    }

...

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T13:43:22.340

GetAdaptersInfo() 是官方方法，它枚举所有适配器，甚至是断开连接的适配器。
请参阅此帖子以获取示例代码[codeguru](http://www.codeguru.com/Cpp/I-N/network/networkinformation/article.php/c5451/ "代码大师")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-03T19:22:50.477

```
#define _CRT_SECURE_NO_WARNINGS
#include <iostream>
#include <stdio.h>
#include <vector>
#include <Windows.h>
#include <Iphlpapi.h>
#include <Assert.h>
#include <string>
#pragma comment(lib, "iphlpapi.lib")

char* getdMacAddresses()
{

    IP_ADAPTER_INFO AdapterInfo[32];       // Allocate information for up to 32 NICs
    DWORD dwBufLen = sizeof(AdapterInfo);  // Save memory size of buffer
    DWORD dwStatus = GetAdaptersInfo(      // Call GetAdapterInfo
        AdapterInfo,                 // [out] buffer to receive data
        &dwBufLen);                  // [in] size of receive data buffer

    //Exit When Error 
    if (dwStatus != ERROR_SUCCESS)
        return "ERROR";

    PIP_ADAPTER_INFO pAdapterInfo = AdapterInfo;
    char szBuffer[512];
    while (pAdapterInfo)
    {
        if (pAdapterInfo->Type == MIB_IF_TYPE_ETHERNET)
        {

            sprintf_s(szBuffer, sizeof(szBuffer), "%.2x-%.2x-%.2x-%.2x-%.2x-%.2x"
                , pAdapterInfo->Address[0]
                , pAdapterInfo->Address[1]
                , pAdapterInfo->Address[2]
                , pAdapterInfo->Address[3]
                , pAdapterInfo->Address[4]
                , pAdapterInfo->Address[5]
                );

            return szBuffer; 

        }

        pAdapterInfo = pAdapterInfo->Next;

    }

    return "ERROR";
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-21T13:43:28.597

您可以在 XP 和 Vista 上使用 WMI，网上有很多示例。例如： [使用 Windows Management Instrumentation (WMI) 获取 MAC 地址](http://www.thescarms.com/dotnet/WMI.aspx)

# java - 客户端的 javafx

> ID：221901
> 
> 赞同：1
> 
> 时间：2008-10-21T13:35:41.857
> 
> 标签：java, javafx

除了适当的 jdk 和 javafx 兼容浏览器之外，客户端是否需要其他东西来访问 javafx 小程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T20:50:43.570

JavaFX 基于可下载的 JAR。我认为有多个运行时，但它们都需要 JRE 1.6。JavaFX 类将由 WebStart 或 Applet 类加载器加载，因此 JRE 不需要提供此扩展。

但是，由于 Java 6 Update 10 的一些新功能专门针对推出 JavaFX 小程序，因此这很可能是最佳选择。Update 10 有一个[新的 Java 插件](https://jdk6.dev.java.net/plugin2/)，在速度、安装和稳定性方面都有所改进，并且它允许更快的初始安装。

以下 JNLP 示例适用于已发布的 Java 6u10：

[http://javafx.com/htdocs/samples.html](http://javafx.com/htdocs/samples.html) [http://a.stritzinger.googlepages.com/jfxrace](http://a.stritzinger.googlepages.com/jfxrace)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T06:46:40.887

好的，感谢您提供此信息。所有样本都是在网络浏览器“外部”运行的“独立”应用程序（启动了一个新程序，您必须下载它并接受一些签名/证书）。是否可以在浏览器中运行小程序？（对我的客户来说更透明）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-07T23:43:21.703

JavFX 可以作为小程序运行，用于运行小程序的 Java 插件已针对 Java 6ul10 进行了重写，以便为 JavaFX 版本的每个人提供更好的体验。

您可以在 JavaFX.com 上看到大量小程序示例以及 Netbeans 6.5 JavaFX 插件中的示例。

# sql - Oracle PL/SQL - NO_DATA_FOUND 异常对存储过程性能有害吗？

> ID：221909
> 
> 赞同：28
> 
> 时间：2008-10-21T13:37:55.627
> 
> 标签：sql, oracle, exception, plsql

我正在编写一个需要在其中进行大量调节的存储过程。根据 C#.NET 编码中的一般知识，异常会损害性能，我也一直避免在 PL/SQL 中使用它们。我在这个存储过程中的调节主要围绕是否存在记录，我可以通过以下两种方式之一进行：

```
SELECT COUNT(*) INTO var WHERE condition;
IF var > 0 THEN
   SELECT NEEDED_FIELD INTO otherVar WHERE condition;
.... 
```

**-或者-**

```
SELECT NEEDED_FIELD INTO var WHERE condition;
EXCEPTION
WHEN NO_DATA_FOUND
.... 
```

第二种情况对我来说似乎更优雅一些，因为这样我就可以使用 NEEDED_FIELD，我必须在第一种情况下的条件之后的第一个语句中选择它。更少的代码。但是如果使用 COUNT(*) 存储过程运行得更快，那么我不介意多输入一点来弥补处理速度。

有什么提示吗？我错过了另一种可能性吗？

**编辑** 我应该提到这一切都已经嵌套在 FOR LOOP 中。不确定这是否对使用游标有影响，因为我认为我不能将游标声明为 FOR LOOP 中的选择。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-21T15:46:55.837

I would not use an explicit cursor to do this. Steve F. no longer advises people to use explicit cursors when an implicit cursor could be used.

The method with `count(*)` is unsafe. If another session deletes the row that met the condition after the line with the `count(*)`, and before the line with the `select ... into`, the code will throw an exception that will not get handled.

The second version from the original post does not have this problem, and it is generally preferred.

That said, there is a minor overhead using the exception, and if you are 100% sure the data will not change, you can use the `count(*)`, but I recommend against it.

I ran these benchmarks on *Oracle 10.2.0.1* on *32 bit Windows*. I am only looking at elapsed time. There are other test harnesses that can give more details (such as latch counts and memory used).

```
SQL>create table t (NEEDED_FIELD number, COND number); 
```

> Table created.

```
SQL>insert into t (NEEDED_FIELD, cond) values (1, 0); 
```

> 1 row created.

```
declare
  otherVar  number;
  cnt number;
begin
  for i in 1 .. 50000 loop
     select count(*) into cnt from t where cond = 1;

     if (cnt = 1) then
       select NEEDED_FIELD INTO otherVar from t where cond = 1;
     else
       otherVar := 0;
     end if;
   end loop;
end;
/ 
```

> PL/SQL procedure successfully completed.
> 
> Elapsed: **00:00:02.70**

```
declare
  otherVar  number;
begin
  for i in 1 .. 50000 loop
     begin
       select NEEDED_FIELD INTO otherVar from t where cond = 1;
     exception
       when no_data_found then
         otherVar := 0;
     end;
   end loop;
end;
/ 
```

> PL/SQL procedure successfully completed.
> 
> Elapsed: **00:00:03.06**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T19:19:17.420

Since SELECT INTO assumes that a single row will be returned, you can use a statement of the form:

```
SELECT MAX(column)
  INTO var
  FROM table
 WHERE conditions;

IF var IS NOT NULL
THEN ... 
```

The SELECT will give you the value if one is available, and a value of NULL instead of a NO_DATA_FOUND exception. The overhead introduced by MAX() will be minimal-to-zero since the result set contains a single row. It also has the advantage of being compact relative to a cursor-based solution, and not being vulnerable to concurrency issues like the two-step solution in the original post.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T15:42:44.143

@Steve 代码的替代方案。

```
DECLARE
  CURSOR foo_cur IS 
    SELECT NEEDED_FIELD WHERE condition ;
BEGIN
  FOR foo_rec IN foo_cur LOOP
     ...
  END LOOP;
EXCEPTION
  WHEN OTHERS THEN
    RAISE;
END ; 
```

The loop is not executed if there is no data. Cursor FOR loops are the way to go - they help avoid a lot of housekeeping. An even more compact solution:

```
DECLARE
BEGIN
  FOR foo_rec IN (SELECT NEEDED_FIELD WHERE condition) LOOP
     ...
  END LOOP;
EXCEPTION
  WHEN OTHERS THEN
    RAISE;
END ; 
```

Which works if you know the complete select statement at compile time.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T15:53:27.010

@DCookie

I just want to point out that you can leave off the lines that say

```
EXCEPTION  
  WHEN OTHERS THEN    
    RAISE; 
```

You'll get the same effect if you leave off the exception block all together, and the line number reported for the exception will be the line where the exception is actually thrown, not the line in the exception block where it was re-raised.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T16:12:12.900

Stephen Darlington makes a very good point, and you can see that if you change my benchmark to use a more realistically sized table if I fill the table out to 10000 rows using the following:

```
begin 
  for i in 2 .. 10000 loop
    insert into t (NEEDED_FIELD, cond) values (i, 10);
  end loop;
end; 
```

Then re-run the benchmarks. (I had to reduce the loop counts to 5000 to get reasonable times).

```
declare
  otherVar  number;
  cnt number;
begin
  for i in 1 .. 5000 loop
     select count(*) into cnt from t where cond = 0;

     if (cnt = 1) then
       select NEEDED_FIELD INTO otherVar from t where cond = 0;
     else
       otherVar := 0;
     end if;
   end loop;
end;
/

PL/SQL procedure successfully completed.

Elapsed: 00:00:04.34

declare
  otherVar  number;
begin
  for i in 1 .. 5000 loop
     begin
       select NEEDED_FIELD INTO otherVar from t where cond = 0;
     exception
       when no_data_found then
         otherVar := 0;
     end;
   end loop;
end;
/

PL/SQL procedure successfully completed.

Elapsed: 00:00:02.10 
```

The method with the exception is now more than twice as fast. So, for almost all cases,the method:

```
SELECT NEEDED_FIELD INTO var WHERE condition;
EXCEPTION
WHEN NO_DATA_FOUND.... 
```

is the way to go. It will give correct results and is generally the fastest.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T13:57:03.640

如果这很重要，您真的需要对这两个选项进行基准测试！

话虽如此，我一直使用异常方法，原因是最好只访问数据库一次。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T13:54:41.227

是的，您缺少使用游标

```
DECLARE
  CURSOR foo_cur IS 
    SELECT NEEDED_FIELD WHERE condition ;
BEGIN
  OPEN foo_cur;
  FETCH foo_cur INTO foo_rec;
  IF foo_cur%FOUND THEN
     ...
  END IF;
  CLOSE foo_cur;
EXCEPTION
  WHEN OTHERS THEN
    CLOSE foo_cur;
    RAISE;
END ; 
```

诚然，这是更多的代码，但它不使用 EXCEPTIONs 作为流控制，我从 Steve Feuerstein 的 PL/SQL Programming 书中学到了我的大部分 PL/SQL，我相信这是一件好事。

我不知道这是否更快（我现在很少做 PL/SQL）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T10:19:16.213

Rather than having nested cursor loops a more efficient approach would be to use one cursor loop with an outer join between the tables.

```
BEGIN
    FOR rec IN (SELECT a.needed_field,b.other_field
                  FROM table1 a
                  LEFT OUTER JOIN table2 b
                    ON a.needed_field = b.condition_field
                 WHERE a.column = ???)
    LOOP
       IF rec.other_field IS NOT NULL THEN
         -- whatever processing needs to be done to other_field
       END IF;
    END LOOP;
END; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T16:18:32.857

May be beating a dead horse here, but I bench-marked the cursor for loop, and that performed about as well as the no_data_found method:

```
declare
  otherVar  number;
begin
  for i in 1 .. 5000 loop
     begin
       for foo_rec in (select NEEDED_FIELD from t where cond = 0) loop
         otherVar := foo_rec.NEEDED_FIELD;
       end loop;
       otherVar := 0;
     end;
   end loop;
end; 
```

PL/SQL procedure successfully completed.

Elapsed: 00:00:02.18

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-18T07:11:47.863

you dont have to use open when you are using for loops.

```
declare
cursor cur_name is  select * from emp;
begin
for cur_rec in cur_name Loop
    dbms_output.put_line(cur_rec.ename);
end loop;
End ; 
```

or

```
declare
cursor cur_name is  select * from emp;
cur_rec emp%rowtype;
begin
Open cur_name;
Loop
Fetch cur_name into  Cur_rec;
   Exit when cur_name%notfound;
    dbms_output.put_line(cur_rec.ename);
end loop;
Close cur_name;
End ; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-01-03T13:26:42.173

The count(*) will never raise exception because it always returns actual count or 0 - zero, no matter what. I'd use count.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-12-18T03:04:40.640

The first (excellent) answer stated -

The method with count() is unsafe. If another session deletes the row that met the condition after the line with the count(*), and before the line with the select ... into, the code will throw an exception that will not get handled.

Not so. Within a given logical Unit of Work Oracle is totally consistent. Even if someone commits the delete of the row between a count and a select Oracle will, for the active session, obtain the data from the logs. If it cannot, you will get a "snapshot too old" error.

# installation - .net 3.5 SP1 未找到安装程序的引导程序

> ID：221913
> 
> 赞同：6
> 
> 时间：2008-10-21T13:38:20.197
> 
> 标签：installation, .net-3.5, bootstrapping

尝试为我的安装项目包含 .net 3.5 sp1 先决条件时收到警告。警告状态无法找到引导的先决条件。

有什么建议么？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T14:03:28.470

我按照 2.3.1.1 为 .NET Framework 3.5 SP1 引导程序包启用 Samesite 中的说明进行操作，现在一切正常。

谢谢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-05T17:41:13.390

最终，与创作者 Ryan 遇到了同样的问题，我通过以下步骤解决了我的 delim 问题：

更新包数据

在 x64 操作系统上打开 [Program Files]\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\DotNetFx35SP1 文件夹或 %ProgramFiles(x86)%\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\DotNetFx35SP1 编辑记事本中的 Product.xml 文件。将以下内容粘贴到 < PackageFiles > 元素中：

```
<PackageFile Name="TOOLS\clwireg.exe"/>
<PackageFile Name="TOOLS\clwireg_x64.exe"/>
<PackageFile Name="TOOLS\clwireg_ia64.exe"/> 
```

找到元素`< PackageFile Name="dotNetFX30\XPSEPSC-x86-en-US.exe"`并将 PublicKey 值更改为：`3082010A0282010100A2DB0A8DCFC2C1499BCDAA3A34AD23596BDB6CBE2122B794C8EAAEBFC6D526C232118BBCDA5D2CFB36561E152BAE8F0DDD14A36E284C7F163F41AC8D40B146880DD98194AD9706D05744765CEAF1FC0EE27F74A333CB74E5EFE361A17E03B745FFD53E12D5B0CA5E0DD07BF2B7130DFC606A2885758CB7ADBC85E817B490BEF516B6625DED11DF3AEE215B8BAF8073C345E3958977609BE7AD77C1378D33142F13DB62C9AE1AA94F9867ADD420393071E08D6746E2C61CF40D5074412FE805246A216B49B092C4B239C742A56D5C184AAB8FD78E833E780A47D8A4B28423C3E2F27B66B14A74BD26414B9C6114604E30C882F3D00B707CEE554D77D2085576810203010001` 找到 < PackageFile Name="dotNetFX30\XPSEPSC-amd64-en-US.exe" 的元素并将 PublicKey 值更改为与上述步骤 4 中相同 保存 product.xml文件

下载并解压核心安装文件

导航到以下 URL： http: [//go.microsoft.com/fwlink ?LinkID=118080](http://go.microsoft.com/fwlink?LinkID=118080) 将 dotNetFx35.exe 文件下载到本地磁盘。打开命令提示符窗口并切换到您下载 dotNetFx35.exe 的目录。在命令提示符处，键入：dotNetFx35.exe /x:。这会将框架文件提取到当前目录中名为“WCU”的文件夹中。复制 WCU\dotNetFramework 文件夹的内容并将它们粘贴到 %Program Files%\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\DotNetFx35SP1 文件夹 (%ProgramFiles(x86)%\Microsoft SDKs\Windows\v6.0A \Bootstrapper\Packages\DotNetFx35SP1 在 x64 操作系统上）。注意：不要复制 WCU\dotNetFramework 文件夹本身。WCU 文件夹下应该有 5 个文件夹，现在每个文件夹都应该出现在 DotNetFx35SP1 文件夹中。文件夹结构应类似于以下内容：

您现在可以删除在步骤 2 和 4 中下载和提取的文件和文件夹。

发现于[Microsoft 解决方案](http://download.microsoft.com/download/A/2/8/A2807F78-C861-4B66-9B31-9205C3F22252/VS2008SP1Readme.htm#General%20Issues)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-12-03T14:17:11.060

对于 VS 2015，这是一个**非常简单的解决方案**（包括一些 Michael Eakins 的回答）：

1.  在此处下载安装程序：http: [//go.microsoft.com/fwlink ?LinkID=118080](http://go.microsoft.com/fwlink?LinkID=118080)

2.  使用 7zip 或 Winrar 提取/打开并将内容提取到文件夹

3.  将提取的文件夹“wcu\dotNetFramework”路径下的所有内容复制/移动到：

> C:\Program Files (x86)\Microsoft Visual Studio 4.0\SDK\Bootstrapper\Packages\DotNetFX35SP1

4.  在 VS2015 中发布

# perl - 我应该使用命令行开关或编译指示打开 Perl 警告吗？

> ID：221919
> 
> 赞同：15
> 
> 时间：2008-10-21T13:40:22.283
> 
> 标签：perl, warnings, pragma

下面两个开始 Perl 脚本的例子有区别吗？如果是这样，我什么时候会使用其中一个？

示例 1：

```
#!/usr/bin/perl

use warnings; 
```

示例 2：

```
#!/usr/bin/perl -w 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-21T13:44:22.730

**使用该开关将启用程序使用的所有**模块中的所有警告。使用编译指示，您只能在该特定模块（或脚本）中启用它。理想情况下，您在所有模块中都使用警告，但通常情况并非如此。当您使用不是警告安全的第三方模块时，使用该开关可能会收到很多警告。

因此，理想情况下，这并不重要，但实际上，您的最终用户通常最好不要使用 switch，而是使用 pragma。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-21T14:25:13.160

命令行开关为整个`-w`解释器全局打开警告。另一方面，`use warnings`是“词法杂注”，仅适用于使用它的词法范围。通常，您将它放在文件的顶部，以便它适用于整个文件，但您也可以将其范围限定为特定的块。此外，您可以使用`no warnings`在块内临时关闭它们，以防您需要执行其他会产生警告的行为。如果你坚持下去，你就不能这样做`-w`。

有关词法警告如何工作的详细信息，包括如何打开和关闭它们的各种子集，请参阅[perllexwarn](http://perldoc.perl.org/perllexwarn.html)文档。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-21T15:23:15.773

“-w”较旧，曾经是打开警告的唯一方法（实际上“-w”只是启用全局 $^W 变量）。“使用警告；” 现在更可取（从 5.6.0 及更高版本开始），因为（如前所述）它具有词法而不是全局范围，并且您可以打开/关闭特定警告。并且不要忘记以“use strict;”开头。:-)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T21:10:03.157

另一个值得注意的区别是，“使用警告”杂注还允许您选择要启用的特定警告（同样，“无警告”允许您选择要禁用的警告）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-22T21:09:27.527

除了使用 pragma 启用/禁用特定断言之外，您还可以将部分或全部警告提升为错误：

```
use strict;
use warnings FATAL => 'all', NONFATAL => 'exec'; 
```

# unix - 使用 grep --exclude/--include 语法不通过某些文件 grep

> ID：221921
> 
> 赞同：862
> 
> 时间：2008-10-21T13:41:01.673
> 
> 标签：unix, search, shell, command-line, grep

我正在`foo=`目录树的文本文件中查找字符串。它在一台普通的 Linux 机器上，我有 bash shell：

```
grep -ircl "foo=" * 
```

目录中还有许多匹配的二进制文件`"foo="`。由于这些结果不相关并且会减慢搜索速度，因此我希望 grep 跳过搜索这些文件（主要是 JPEG 和 PNG 图像）。我该怎么做？

我知道有`--exclude=PATTERN`and`--include=PATTERN`选项，但是模式格式是什么？grep 的手册页说：

```
--include=PATTERN     Recurse in directories only searching file matching PATTERN.
--exclude=PATTERN     Recurse in directories skip file matching PATTERN. 
```

在*grep include*、*grep include exclude*、*grep exclude*和变体上搜索未找到任何相关内容

如果只有在某些文件中有更好的 grepping 方法，我完全赞成；移动有问题的文件不是一种选择。我不能只搜索某些目录（目录结构很乱，到处都是）。此外，我无法安装任何东西，所以我必须使用常用工具（如*grep*或建议的*find*）。

* * *

## 回答 #1

> 赞同：874
> 
> 时间：2008-10-21T13:44:01.793

使用 shell[通配符语法](https://man7.org/linux/man-pages/man7/glob.7.html)：

```
grep pattern -r --include=\*.cpp --include=\*.h rootdir 
```

for 的语法`--exclude`是相同的。

请注意，星号用反斜杠转义，以防止它被外壳扩展（引用它，例如`--include="*.cpp"`，也可以）。否则，如果您在当前工作目录中有与该模式匹配的任何文件，命令行将扩展为类似 的`grep pattern -r --include=foo.cpp --include=bar.cpp rootdir`内容，它只会搜索名为`foo.cpp`and的文件`bar.cpp`，这很可能不是您想要的。

**2021-03-04 更新**

我已经编辑了原始答案以删除使用[大括号扩展](https://www.gnu.org/software/bash/manual/bash.html#Brace-Expansion)，这是 Bash 和 zsh 等几个 shell 提供的一个功能，用于简化这样的模式；但请注意，大括号扩展不符合 POSIX shell。

原来的例子是：

```
grep pattern -r --include=\*.{cpp,h} rootdir 
```

搜索根目录中的`.cpp`所有文件。`.h``rootdir`

* * *

## 回答 #2

> 赞同：229
> 
> 时间：2008-10-21T14:12:04.623

如果您只想跳过二进制文件，我建议您查看`-I`(大写 i) 选项。它忽略二进制文件。我经常使用以下命令：

```
grep -rI --exclude-dir="\.svn" "pattern" * 
```

它递归搜索，忽略二进制文件，并且不会在 Subversion 隐藏文件夹中查找我想要的任何模式。我在工作的盒子上将它别名为“grepsvn”。

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2008-10-21T14:18:19.400

请查看[ack](http://petdance.com/ack/)，它专为这些情况而设计。你的例子

```
grep -ircl --exclude=*.{png,jpg} "foo=" * 
```

用 ack 完成

```
ack -icl "foo=" 
```

因为默认情况下 ack 从不查找二进制文件，而 -r 默认情况下是打开的。如果你只想要 CPP 和 H 文件，那么就做

```
ack -icl --cpp "foo=" 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2009-02-04T18:41:39.567

grep 2.5.3 引入了`--exclude-dir`可以按照您想要的方式工作的参数。

```
grep -rI --exclude-dir=\.svn PATTERN . 
```

您还可以设置环境变量：`GREP_OPTIONS="--exclude-dir=\.svn"`

不过，我会支持[安迪对](https://stackoverflow.com/users/8454/andy-lester)[ack](http://petdance.com/ack/)的投票，这是最好的。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2012-12-20T04:54:44.537

很长一段时间后我发现了这一点，您可以添加多个包含和排除，例如：

```
grep "z-index" . --include=*.js --exclude=*js/lib/* --exclude=*.min.js 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-12-17T18:56:38.317

建议的命令：

```
grep -Ir --exclude="*\.svn*" "pattern" * 
```

在概念上是错误的，因为 --exclude 对基本名称起作用。换句话说，它只会跳过当前目录中的 .svn。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-04-01T10:13:14.727

在 grep 2.5.1 中，您必须将此行添加到 ~/.bashrc 或 ~/.bash 配置文件

```
export GREP_OPTIONS="--exclude=\*.svn\*" 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-21T13:44:45.973

我发现 grepping grep 的输出有时很有帮助：

```
grep -rn "foo=" . | grep -v "Binary file" 
```

不过，这实际上并不能阻止它搜索二进制文件。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2011-11-14T20:41:29.233

如果您不反对使用`find`，我喜欢它的`-prune`功能：

```
`find [directory] \
        -name "pattern_to_exclude" -prune \
     -o -name "another_pattern_to_exclude" -prune \
     -o -name "pattern_to_INCLUDE" -print0 \
| xargs -0 -I FILENAME grep -IR "pattern" FILENAME` 
```

`在第一行，您指定要搜索的目录。`.`（当前目录）是一个有效的路径，例如。`

 `在第 2 行和第 3 行，使用`"*.png"`, `"*.gif"`, `"*.jpg"`, 等等。尽可能多地使用这些`-o -name "..." -prune`结构，就像你有模式一样。

在第 4 行，你需要另一个`-o`（它指定“或”到`find`），你想要的模式，你需要一个`-print`或`-print0`在它的末尾。如果您只想要修剪 , 等图像后剩余的“其他所有内容”，`*.gif`请`*.png`使用 `-o -print0`并完成第 4 行。

最后，在第 5 行是管道，`xargs`它接收每个生成的文件并将它们存储在一个变量`FILENAME`中。`grep`然后它传递`-IR`标志，`"pattern"`，然后`FILENAME`扩展`xargs`成为 找到的文件名列表`find`。

对于您的特定问题，该语句可能类似于：

```
`find . \
     -name "*.png" -prune \
     -o -name "*.gif" -prune \
     -o -name "*.svn" -prune \
     -o -print0 | xargs -0 -I FILES grep -IR "foo=" FILES` 
```

* * *

 `## 回答 #10

> 赞同：7
> 
> 时间：2014-11-07T18:43:19.663

在 CentOS 6.6/Grep 2.6.3 上，我必须像这样使用它：

```
grep "term" -Hnir --include \*.php --exclude-dir "*excluded_dir*" 
```

注意缺少等号“=”（否则，，，`--include`和`--exclude`被`include-dir`忽略`--exclude-dir`）

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2018-04-15T01:51:24.053

### [`git grep`](https://git-scm.com/docs/git-grep)

使用`git grep`针对性能进行了优化，旨在搜索某些文件。

默认情况下，它会忽略二进制文件并尊重您的`.gitignore`. 如果你不使用 Git 结构，你仍然可以通过传递`--no-index`.

示例语法：

```
git grep --no-index "some_pattern" 
```

有关更多示例，请参见：

*   [如何从 git grep search 中排除某些目录/文件](https://stackoverflow.com/q/10423143/55075)。
*   [检查文件中是否存在所有多个字符串或正则表达式](https://stackoverflow.com/a/49836697/55075)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-08-27T06:02:29.330

我是一个外行，当然，但这是我的 ~/.bash_profile 的样子：

```
导出 GREP_OPTIONS="-orl --exclude-dir=.svn --exclude-dir=.cache --color=auto" GREP_COLOR='1;32'

```

请注意，要排除两个目录，我必须使用 --exclude-dir 两次。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-04-15T01:45:38.767

> 目录中还有许多二进制文件。我不能只搜索某些目录（目录结构很乱）。是否有更好的方法仅在某些文件中进行 grepping？

### [`ripgrep`](https://github.com/BurntSushi/ripgrep)

这是设计用于递归搜索当前目录的最快工具之一。它是用[Rust](https://en.wikipedia.org/wiki/Rust_(programming_language))编写的，构建在[Rust 的正则表达式引擎](https://github.com/rust-lang-nursery/regex)之上以实现最高效率。在这里查看[详细分析](http://blog.burntsushi.net/ripgrep/)。

所以你可以运行：

```
rg "some_pattern" 
```

它尊重您`.gitignore`并自动跳过隐藏文件/目录和二进制文件。

您仍然可以使用`-g`/自定义包含或排除文件和目录`--glob`。通配规则匹配 glob `.gitignore`。检查`man rg`寻求帮助。

有关更多示例，请参阅：[如何使用 grep 排除某些与某些扩展名不匹配的文件？](https://unix.stackexchange.com/a/441567/21471)

在 macOS 上，您可以通过`brew install ripgrep`.

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-21T13:45:26.893

find 和 xargs 是你的朋友。使用它们来过滤文件列表而不是 grep 的 --exclude

尝试类似的东西

```
find . -not -name '*.png' -o -type f -print | xargs grep -icl "foo=" 
```

习惯这一点的好处是它可以扩展到其他用例，例如计算所有非 png 文件中的行数：

```
find . -not -name '*.png' -o -type f -print | xargs wc -l 
```

要删除所有非 png 文件：

```
find . -not -name '*.png' -o -type f -print | xargs rm 
```

等等

正如评论中所指出的，如果某些文件的名称中可能包含空格，请使用`-print0`and`xargs -0`代替。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-10-21T13:54:13.677

试试这个：

```
$查找。-name "*.txt" -type f -print | xargs 文件 | grep "foo=" | 剪切-d：-f1

```

在这里成立：[http ://www.unix.com/shell-programming-scripting/42573-search-files- exclude-binary-files.html](http://www.unix.com/shell-programming-scripting/42573-search-files-excluding-binary-files.html)

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2016-08-22T02:30:22.473

如果您以非递归方式搜索，则可以使用[glop 模式](https://en.wikipedia.org/wiki/Glob_(programming))来匹配文件名。

```
grep "foo" *.{html,txt} 
```

包括html和txt。它仅在当前目录中搜索。

在子目录中搜索：

```
 grep "foo" */*.{html,txt} 
```

在子子目录中：

```
 grep "foo" */*/*.{html,txt} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-11-05T08:30:45.060

那些脚本并不能解决所有问题......试试这个更好：

```
du -ha | grep -i -o "\./.*" | grep -v "\.svn\|another_file\|another_folder" | xargs grep -i -n "$1" 
```

这个脚本更好，因为它使用“真正的”正则表达式来避免搜索目录。只需用“\|”分隔文件夹或文件名 在 grep -v

好好享受！在我的 linux shell 上找到了！XD

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2010-11-10T05:11:55.040

看@这个。

```
grep --exclude="*\.svn*" -rn "foo=" * | grep -v Binary | grep -v tags 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-04-06T11:15:46.977

`--binary-files=without-match`GNU的选项`grep`让它跳过二进制文件。（相当于`-I`别处提到的开关。）

（这可能需要最新版本的`grep`; 2.5.3 至少有它。）

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-04-02T17:33:44.170

适用于 tcsh .alias 文件：

```
alias gisrc 'grep -I -r -i --exclude="*\.svn*" --include="*\."{mm,m,h,cc,c} \!* *' 
```

我花了一段时间才弄清楚 {mm,m,h,cc,c} 部分不应该在引号内。〜基思

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2010-09-16T18:34:53.810

忽略来自 grep 的所有二进制结果

```
grep -Ri "pattern" * | awk '{if($1 != "Binary") print $0}' 
```

awk 部分将过滤掉所有二进制文件 foo 匹配行

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2010-11-10T23:50:26.257

试试这个：

1.  在 currdir ..下创建一个名为“ `--F`”的文件夹 ..（或链接另一个文件夹重命名为“ `--F`”即`double-minus-F`。
2.  `#> grep -i --exclude-dir="\-\-F" "pattern" *`

# c# - 从流中创建字节数组

> ID：221925
> 
> 赞同：1008
> 
> 时间：2008-10-21T13:42:55.103
> 
> 标签：c#, .net-3.5, inputstream

从输入流创建字节数组的首选方法是什么？

这是我当前使用 .NET 3.5 的解决方案。

```
Stream s;
byte[] b;

using (BinaryReader br = new BinaryReader(s))
{
    b = br.ReadBytes((int)s.Length);
} 
```

读取和写入流的块仍然是一个更好的主意吗？

* * *

## 回答 #1

> 赞同：1389
> 
> 时间：2008-10-21T13:45:57.500

这真的取决于你是否可以信任`s.Length`。对于许多流，您只是不知道会有多少数据。在这种情况下——在 .NET 4 之前——我会使用这样的代码：

```
public static byte[] ReadFully(Stream input)
{
    byte[] buffer = new byte[16*1024];
    using (MemoryStream ms = new MemoryStream())
    {
        int read;
        while ((read = input.Read(buffer, 0, buffer.Length)) > 0)
        {
            ms.Write(buffer, 0, read);
        }
        return ms.ToArray();
    }
} 
```

对于 .NET 4 及更高版本，我会使用[`Stream.CopyTo`](https://msdn.microsoft.com/en-us/library/system.io.stream.copyto)，这基本上相当于我的代码中的循环 - 创建`MemoryStream`、 调用`stream.CopyTo(ms)`然后返回`ms.ToArray()`。任务完成。

我也许应该解释为什么我的答案比其他人长。[`Stream.Read`](http://msdn.microsoft.com/en-us/library/system.io.stream.read.aspx)不保证它会读取它所要求的所有内容。例如，如果您正在从网络流中读取数据，它可能会读取一个数据包的价值然后返回，即使很快会有更多数据。[`BinaryReader.Read`](http://msdn.microsoft.com/en-us/library/system.io.binaryreader.read.aspx)将一直持续到流结束或您指定的大小，但您仍然必须知道开始的大小。

上述方法将继续读取（并复制到 a 中`MemoryStream`），直到数据用完。然后它要求`MemoryStream`返回数组中数据的副本。如果您知道开始的大小 - 或者*认为*您知道大小，但不确定 - 您可以将 构建`MemoryStream`为开始的大小。同样，您可以在最后进行检查，如果流的长度与缓冲区的大小相同（由 返回[`MemoryStream.GetBuffer`](http://msdn.microsoft.com/en-us/library/system.io.memorystream.getbuffer.aspx)），那么您可以只返回缓冲区。所以上面的代码不是很优化，但至少是正确的。它不承担关闭流的任何责任——调用者应该这样做。

有关更多信息（和替代实现），请参阅[本文。](https://jonskeet.uk/csharp/readbinary.html)

* * *

## 回答 #2

> 赞同：827
> 
> 时间：2011-07-05T16:45:39.760

虽然 Jon 的回答是正确的，但他正在重写已经存在于`CopyTo`. 所以对于 .Net 4 使用 Sandip 的解决方案，但对于以前版本的 .Net 使用 Jon 的答案。Sandip 的代码将通过使用“使用”来改进，因为`CopyTo`在许多情况下，很可能会留下未处理的异常`MemoryStream`。

```
public static byte[] ReadFully(Stream input)
{
    using (MemoryStream ms = new MemoryStream())
    {
        input.CopyTo(ms);
        return ms.ToArray();
    }
} 
```

* * *

## 回答 #3

> 赞同：122
> 
> 时间：2010-04-13T14:54:01.430

只是想指出，如果你有一个 MemoryStream 你已经拥有`memorystream.ToArray()`了。

此外，如果您正在处理未知或不同子类型的流并且您可以收到 a `MemoryStream`，您可以针对这些情况继续使用上述方法，并且仍然对其他情况使用已接受的答案，如下所示：

```
public static byte[] StreamToByteArray(Stream stream)
{
    if (stream is MemoryStream)
    {
        return ((MemoryStream)stream).ToArray();                
    }
    else
    {
        // Jon Skeet's accepted answer 
        return ReadFully(stream);
    }
} 
```

* * *

## 回答 #4

> 赞同：73
> 
> 时间：2011-02-12T13:33:29.263

```
MemoryStream ms = new MemoryStream();
file.PostedFile.InputStream.CopyTo(ms);
var byts = ms.ToArray();
ms.Dispose(); 
```

* * *

## 回答 #5

> 赞同：55
> 
> 时间：2013-02-18T16:01:22.587

只是我的几分钱......我经常使用的做法是将这样的方法组织为自定义助手

```
public static class StreamHelpers
{
    public static byte[] ReadFully(this Stream input)
    {
        using (MemoryStream ms = new MemoryStream())
        {
            input.CopyTo(ms);
            return ms.ToArray();
        }
    }
} 
```

将命名空间添加到配置文件并在您希望的任何地方使用它

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2018-07-11T19:21:03.320

您可以简单地使用 MemoryStream 类的 ToArray() 方法，例如

```
MemoryStream ms = (MemoryStream)dataInStream;
byte[] imageBytes = ms.ToArray(); 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2012-07-18T17:01:12.830

你甚至可以通过扩展使它更漂亮：

```
namespace Foo
{
    public static class Extensions
    {
        public static byte[] ToByteArray(this Stream stream)
        {
            using (stream)
            {
                using (MemoryStream memStream = new MemoryStream())
                {
                     stream.CopyTo(memStream);
                     return memStream.ToArray();
                }
            }
        }
    }
} 
```

然后将其作为常规方法调用：

```
byte[] arr = someStream.ToByteArray() 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2011-05-31T00:55:31.820

Bob（即提问者）的代码出现编译时错误。Stream.Length 是 long 而 BinaryReader.ReadBytes 采用整数参数。就我而言，我不希望处理大到需要长精度的流，因此我使用以下内容：

```
Stream s;
byte[] b;

if (s.Length > int.MaxValue) {
  throw new Exception("This stream is larger than the conversion algorithm can currently handle.");
}

using (var br = new BinaryReader(s)) {
  b = br.ReadBytes((int)s.Length);
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2018-10-17T22:57:13.013

如果有人喜欢它，这里是一个仅 .NET 4+ 的解决方案，它作为扩展方法形成，无需对 MemoryStream 进行不必要的 Dispose 调用。这是一个无可救药的微不足道的优化，但值得注意的是，未能 Dispose 一个 MemoryStream 并不是真正的失败。

```
public static class StreamHelpers
{
    public static byte[] ReadFully(this Stream input)
    {
        var ms = new MemoryStream();
        input.CopyTo(ms);
        return ms.ToArray();
    }
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-07-30T22:22:24.473

上面的那个没问题...但是当您通过 SMTP 发送内容时（如果需要），您会遇到数据损坏。我已经改成了其他有助于正确发送字节的东西：'

```
using System;
using System.IO;

        private static byte[] ReadFully(string input)
        {
            FileStream sourceFile = new FileStream(input, FileMode.Open); //Open streamer
            BinaryReader binReader = new BinaryReader(sourceFile);
            byte[] output = new byte[sourceFile.Length]; //create byte array of size file
            for (long i = 0; i < sourceFile.Length; i++)
                output[i] = binReader.ReadByte(); //read until done
            sourceFile.Close(); //dispose streamer
            binReader.Close(); //dispose reader
            return output;
        }' 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2018-09-20T13:28:44.783

创建一个辅助类并在您希望使用它的任何地方引用它。

```
public static class StreamHelpers
{
    public static byte[] ReadFully(this Stream input)
    {
        using (MemoryStream ms = new MemoryStream())
        {
            input.CopyTo(ms);
            return ms.ToArray();
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2019-01-14T15:20:40.570

在命名空间 RestSharp.Extensions 中有方法 ReadAsBytes。在此方法中使用了 MemoryStream，并且与此页面上的某些示例中的代码相同，但是当您使用 RestSharp 时，这是最简单的方法。

```
using RestSharp.Extensions;
var byteArray = inputStream.ReadAsBytes(); 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-01-10T02:47:26.717

这是我正在使用、测试和运行良好的功能。请记住，'input' 不应该为空，'input.position' 应该在读取之前重置为'0'，否则它将破坏读取循环并且不会读取任何内容以转换为数组。

```
 public static byte[] StreamToByteArray(Stream input)
    {
        if (input == null)
            return null;
        byte[] buffer = new byte[16 * 1024];
        input.Position = 0;
        using (MemoryStream ms = new MemoryStream())
        {
            int read;
            while ((read = input.Read(buffer, 0, buffer.Length)) > 0)
            {
                ms.Write(buffer, 0, read);
            }
            byte[] temp = ms.ToArray();

            return temp;
        }
    } 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-07-27T06:49:07.823

您可以使用此扩展方法。

```
public static class StreamExtensions
{
    public static byte[] ToByteArray(this Stream stream)
    {
        var bytes = new List<byte>();

        int b;
        while ((b = stream.ReadByte()) != -1)
            bytes.Add((byte)b);

        return bytes.ToArray();
    }
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2021-09-23T11:41:35.550

如果流支持 Length 属性，则可以直接创建字节数组。优点是`MemoryStream.ToArray`创建了两次数组。另外，缓冲区中可能有一些未使用的额外字节。此解决方案分配所需的确切数组。如果流不支持 Length 属性，则会抛出`NotSupportedException`异常。

还值得注意的是，数组不能大于 int.MaxValue。

```
public static async Task<byte[]> ToArrayAsync(this Stream stream)
{
    var array = new byte[stream.Length];
    await stream.ReadAsync(array, 0, (int)stream.Length);
    return array;
} 
```

根据流是否支持查找在两个版本之间切换的完整代码。

```
/// <summary>
/// Converts stream to byte array.
/// </summary>
/// <param name="stream">Stream</param>
/// <returns>Binary data from stream in an array</returns>
public static async Task<byte[]> ToArrayAsync(this Stream stream)
{
    if (!stream.CanRead)
    {
        throw new AccessViolationException("Stream cannot be read");
    }

    if (stream.CanSeek)
    {
        return await ToArrayAsyncDirect(stream);
    }
    else
    {
        return await ToArrayAsyncGeneral(stream);
    }
}

private static async Task<byte[]> ToArrayAsyncGeneral(Stream stream)
{
    using (var memoryStream = new MemoryStream())
    {
        await stream.CopyToAsync(memoryStream);
        return memoryStream.ToArray();
    }
}

private static async Task<byte[]> ToArrayAsyncDirect(Stream stream)
{
    var array = new byte[stream.Length];
    await stream.ReadAsync(array, 0, (int)stream.Length);
    return array;
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2017-05-17T13:42:28.890

将两个投票最多的答案组合成一个扩展方法：

```
public static byte[] ToByteArray(this Stream stream)
{
    if (stream is MemoryStream)
        return ((MemoryStream)stream).ToArray();
    else
    {
        using MemoryStream ms = new();
        stream.CopyTo(ms);
        return ms.ToArray();
    }            
} 
```

* * *

## 回答 #17

> 赞同：-7
> 
> 时间：2017-03-07T16:06:58.833

我能够让它在一条线上工作：

```
byte [] byteArr= ((MemoryStream)localStream).ToArray(); 
```

正如[johnnyRose](https://stackoverflow.com/users/2840103/johnnyrose)所澄清的那样，上面的代码仅适用于 MemoryStream

# asp.net - 如何阻止 ASP.NET 菜单控件生成内联 html 样式元素

> ID：221930
> 
> 赞同：5
> 
> 时间：2008-10-21T13:44:04.697
> 
> 标签：asp.net

我有一个包含 ASP.NET 服务器端菜单控件 (System.Web.UI.WebControls.Menu) 的母版页

我*正在*使用这里的 CSSFriendly 适配器

[http://www.asp.net/CSSAdapters/Menu.aspx](http://www.asp.net/CSSAdapters/Menu.aspx)

并且它们确实使渲染的 HTML 更加干净但是我仍然像这样将内联样式输出到 HTML 中的 HEAD 元素中

```
<style type="text/css">
    .ctl00_SiteHeader1_TabBar1_Menu1_0 { background-color:white;visibility:hidden;display:none;position:absolute;left:0px;top:0px; }
    .ctl00_SiteHeader1_TabBar1_Menu1_1 { text-decoration:none; }
    .ctl00_SiteHeader1_TabBar1_Menu1_2 {  }
    .ctl00_LeftColumnContent_LeftHandNavigator1_Menu1_0 { text-decoration:none; }

</style>
</head>

<body> 
```

我认为这些样式是由 ASP.NET 生成的，我认为我不需要它们，因为我正在使用 CSSAdapters，所以有什么方法可以阻止它们生成？

德里克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-02-24T10:52:44.040

在 .NET Framework 4 中，ASP.NET 菜单有一个新属性 ，`IncludeStyleBlock`您可以将其设置为 false 以避免生成`<style>`块。但是，它仍然会生成一个`style="float:left"`只能`float: none !important`在样式表中用 a 覆盖的属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T14:08:01.527

简短的故事是它不[容易](http://forums.asp.net/p/1006669/1336527.aspx)完成。该代码在预渲染阶段由菜单添加到标题中。

一种可能的解决方法可能是在自定义菜单控件中覆盖菜单的 onprerender 并且不调用 base. [然后，您可以使用tagMappings](http://msdn.microsoft.com/en-us/library/ms164641.aspx)将默认菜单控件替换为您自己的控件。

如果可以的话，我建议你远离菜单控件。

# silverlight - 跨域托管 Silverlight 应用程序未在 https 网页中加载

> ID：221938
> 
> 赞同：2
> 
> 时间：2008-10-21T13:45:08.250
> 
> 标签：silverlight, hosting, cross-domain

我想为我的客户提供 silverlight 应用程序，同时在我自己的站点上托管应用程序以简化维护。

*   我的 Silverlight .xap 托管在域*me-supplier.com 中*
*   我想将它嵌入到*my-customer.com域中*

它适用于*[http://my-customer.com](http://my-customer.com)**，*不适用于***https://my-customer.com***

 **   我添加了（*me-supplier.com*托管）跨域 silverlight 策略文件以允许*my-customer.com*
*   我已经为 .xap 配置了 mime 类型
*   silverlight 应用程序需要 html dom 访问，因此我相信 iframe 方法不可行。

这适用于 javascript 代码，那么为什么不适用 silverlight 呢？任何想法，解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T13:58:44.307

silverlight 应用程序也在 https 上吗？如果没有，您可能会遇到不允许混合 http 和 https 应用程序域的安全墙

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T14:03:24.140

我认为[这个问题](https://stackoverflow.com/questions/73517/silverlight-cross-domain-policies)的答案可以解释它。

通常，HTTPS 不喜欢您在页面内的域之间绘制数据，因为证书与当前域相关联。

# asp.net - asp.net mvc 和 web 表单之间有性能差异吗？

> ID：221944
> 
> 赞同：14
> 
> 时间：2008-10-21T13:48:48.930
> 
> 标签：asp.net, asp.net-mvc, performance, webforms

> **可能重复：**
> [ASP.NET MVC 性能](https://stackoverflow.com/questions/43743/asp-net-mvc-performance)

我知道有一个学习曲线，但是性能呢？在我看来，Web 表单的性能会降低，但我还没有尝试过 MVC 还不确定。其他人都在经历什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T13:49:12.297

这几乎是一个重复的问题。以下是一些类似的讨论：

[ASP.NET MVC 性能](https://stackoverflow.com/questions/43743/aspnet-mvc-performance)

[ASP.NET webforms 和 MVC 之间的主要区别是什么](https://stackoverflow.com/questions/142132/what-are-the-key-differences-between-aspnet-webforms-and-mvc)

[使用 ASP.Net MVC 与 Web 表单的最大优势](https://stackoverflow.com/questions/102558/biggest-advantage-to-using-aspnet-mvc-vs-web-forms)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T14:07:57.300

The thing about WebForms is that it's very easy to make a page that performs really bad, because it encourages you to do a lot of simple updates server-side that really should be done client-side. If you're paying attention to your postbacks and ViewState then WebForms isn't so bad. Also, MVC has the *potential* for better performance because it takes fewer steps during a page load, but *realizing that potential* can require a lot of discipline by the programmer, just like web forms.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T16:53:18.590

这是值得商榷的，因为它们都有不同的性能优缺点，例如 ASP.net MVC 让您可以控制到达浏览器的 HTML/JS，因此您可以最大限度地减少线路上的数据量以使整个应用程序重量少，但是 ASP.net MVC 路由对反射有很大的依赖，这比 Web 窗体正在执行的从磁盘获取文件要慢。

# c++ - 对任意值类型的操作

> ID：221950
> 
> 赞同：5
> 
> 时间：2008-10-21T13:50:07.490
> 
> 标签：c++, c, cuda, gpgpu, value-type

本文[描述](http://themechanicalbride.blogspot.com/2008/04/using-operators-with-generics.html)了一种在 C# 中允许添加具有为它们定义的 + 运算符的任意值类型的方法。本质上它允许以下代码：

```
public T Add(T val1, T val2)
{
   return val1 + val2;
} 
```

此代码无法编译，因为无法保证 T 类型具有“+”运算符的定义，但使用如下代码可以实现效果：

```
public T Add(T val1, T val2)
{
   //Num<T> defines a '+' operation which returns a value of type T
   return (new Num<T>(val1) + new Num<T>(val2));
} 
```

按照链接查看 Num 类是如何实现这一点的。无论如何，关于这个问题。有什么方法可以在 C 或 C++ 中实现相同的效果？出于好奇，我试图解决的问题是允许 CUDA 内核通过允许它在更多类型上运行来更加灵活/通用。

**更新：**对于 .NET，Marc Gravell 制作了一个[实用程序库](http://www.yoda.arachsys.com/csharp/miscutil/usage/genericoperators.html)，可以非常优雅地解决操作员问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T13:54:52.847

由于模板在 C++ 中编译的方式，只需执行以下操作：

```
template < class T >
T add(T const & val1, T const & val2)
{
    return val1 + val2;
} 
```

将起作用，对于未定义 operator+ 的每种类型，您都会收到编译错误。

C++ 模板为每种类型实例化生成代码，因此对于每种类型，都会生成正确的 T 代码。这样 C++ 就不需要 Num<> 诡计了。

据我所知，在纯 C 语言中，这是不可能的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T13:56:42.110

**在 C++ 中，这根本不是问题。**如果将第一个示例中的代码按字面翻译成 C++（ETA：就像 Pieter 所做的那样），那么代码就可以工作，但我想不出直接使用 + 不起作用的任何情况。您正在寻找不存在的问题的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T13:55:05.093

这可以使用模板在 C++ 中轻松完成：

```
 template <typename T>
T Add(T val1, T val2)
{
  return val1 + val2;
}
```

但是请注意，这**必须**在头文件中定义，并且您可能还希望通过 const 引用而不是通过值来传递参数。

这根本不能在纯 C 中完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T14:06:25.913

它也可以在 C 中完成，尽管我不确定它是否满足问题要求，使用宏。

```
#define ADD(A,B) (A+B) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T13:56:42.127

C++ 中的模板。在 C 中，并非没有大量的麻烦和开销。

```
template<typename T> 
T add(T x, T y)
{ 
    return x + y;
} 
```

# user-interface - 面向程序员的用户界面设计书籍/资源

> ID：221966
> 
> 赞同：17
> 
> 时间：2008-10-21T13:57:02.923
> 
> 标签：user-interface

我将很快每月去书店旅行，我有兴趣学习一些用户界面和/或设计的东西——主要是与网络相关的，我应该看哪些好书？我过去经常看到的一个是[Don't Make Me Think](https://rads.stackoverflow.com/amzn/click/com/0321344758)，它看起来很有希望。

我知道程序员通常不会成为伟大的设计师这一事实，因此这更像是一种潜在的爱好，而不是成为专业设计师的举动。

我也在寻找关于这个主题的任何好的网络资源。例如，我订阅了 Jakob Nielsen 的[Alertbox 时事通讯](http://www.useit.com/alertbox/)，尽管它似乎每个月左右才来一次。

谢谢！

一些相关的问题：

[https://stackoverflow.com/questions/75863/what-are-the-best-resources-for-designing-user-interfaces](https://stackoverflow.com/questions/75863/what-are-the-best-resources-for-designing-user-interfaces) [用户界面设计](https://stackoverflow.com/questions/7973/user-interface-design)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-21T13:58:25.167

[不要让我想](http://www.sensible.com/dmmt.html)是那个！

还可以查看[Steve Krug 的网站](http://www.sensible.com/)，了解可用性测试的提示和示例表格。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-21T14:00:37.593

[日常用品的设计](https://rads.stackoverflow.com/amzn/click/com/0465067107)？一个“旧”的经典，但如果您计划任何需要人工交互的东西，它就会很有用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T14:08:42.103

Joel Spolsky's [User Interface Design for Programmers](http://www.joelonsoftware.com/uibook/chapters/fog0000000057.html) is at least entertaining, and a recommended read.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-21T14:01:04.990

Tufte，定量信息的视觉显示[http://www.edwardtufte.com/tufte/](http://www.edwardtufte.com/tufte/)

Don Norman，日常用品设计[http://www.jnd.org/](http://www.jnd.org/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-21T14:04:01.003

Although completely independent of web and programming, [The Design of Everyday Things](https://rads.stackoverflow.com/amzn/click/com/0465067107) by Donald Norman taught me a lot!

For a less in-depth, more cook-book approach (if you don't want to think), try Robin Williams' [The Non-Designer's Design Book: Design and Typographic Principles for the Visual Novice](https://rads.stackoverflow.com/amzn/click/com/1566091594).

Presonally I much prefer The Design of Everyday Things.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-21T14:05:21.640

Also take a look at Alan Cooper's *About Face*.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T14:00:50.840

[Apple 人机界面](http://developer.apple.com/documentation/UserExperience/Conceptual/AppleHIGuidelines/XHIGIntro/chapter_1_section_1.html)指南很棒！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-21T14:01:35.767

这与 GUI 设计或编程没有直接关系，但是 The Psychology of Everyday Things 是一本好书。

这是对事物如何设计以及如何失败的总体看法。本书中的概念虽然不能直接应用于 GUI，但确实适用。事实上，你可以说它们适用于所有以用户为中心的设计实例。

[http://www.amazon.com/Psychology-Everyday-Things-Donald-Norman/dp/0465067093](https://rads.stackoverflow.com/amzn/click/com/0465067093)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T14:05:30.800

**AboutFace.3.0** The Essentials of Interaction Design would be good Idea to read

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-06-01T08:22:16.623

除了到目前为止给出的重要提示外，还请参阅[Windows 用户体验交互指南](https://web.archive.org/web/20151126214052/http://download.microsoft.com/download/e/1/9/e191fd8c-bce8-4dba-a9d5-2d4e3f3ec1d3/ux%20guide.pdf)，如Kirill Osenkov的这篇有趣[的博客文章中所述。](https://docs.microsoft.com/en-us/archive/blogs/kirillosenkov/windows-user-interface-guidelines)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T14:07:47.330

"Don't Make Me Think" is great. After sitting in on several usability studies I can safely say that several of his biggest points are the kinds of things drilled in your head over and over.

Joel Spolsky's book on user interfaces is also decent.

[http://www.amazon.com/User-Interface-Design-Programmers-Spolsky/dp/1893115941](https://rads.stackoverflow.com/amzn/click/com/1893115941)

# wcf - 负载测试 WCF 服务（托管在 IIS 上）

> ID：221973
> 
> 赞同：26
> 
> 时间：2008-10-21T13:59:58.767
> 
> 标签：wcf, performance, iis, load-testing

有哪些工具可以测试 WCF 服务？

我期待分配负载，所以我想知道单个服务器可以处理多少。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-21T14:50:32.020

[一路 WCFLoadTest](http://www.codeplex.com/WCFLoadTest)。我什至与对这个工具发誓的 MS 家伙交谈过。

Visual Studio 也有一些可用的负载测试工具，但我不能保证他们的工作做得如何，也不能说哪些版本的 VS 包含负载测试工具。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-02T07:36:29.463

我编写了自己的工具（[WCFStorm](http://www.wcfstorm.com/wcf/home.aspx)）。这些是特点：

**一般**：

◦动态调用和测试 WCF 服务

◦动态调用和测试以任何语言编写的 Web 服务

◦将您打开的服务及其测试用例保存到可以随时重新加载的“项目”中

◦动态调用服务方法，即使是那些包含复杂数据类型的方法

◦基于 UI 的复杂数据类型的动态编辑

◦在单个 UI 中测试多个 WCF 和 Web 服务。

◦多标签界面

◦基本和windows认证

◦测试服务位于代理后面

◦动态修改 WCF 或 Web 服务的 URL 端点。

◦动态编辑服务绑定。

**功能测试**：

◦创建功能测试用例并将其保存为项目的一部分

◦创建并保存包含预期结果的功能测试用例。

◦以图形方式比较（并排）预期结果与服务的实际响应。

**性能测试：**

◦创建性能测试用例并将其保存为项目的一部分

◦随着性能测试的进行，实时以图形方式显示图表。

◦可配置的测试参数（代理数量、测试持续时间、间隔等）。您可以随心所欲地强调您的服务。

查看屏幕截图。

[![替代文字](https://i.stack.imgur.com/HMgRt.jpg)](https://i.stack.imgur.com/HMgRt.jpg)
[（来源：[geekswithblogs.net](http://geekswithblogs.net/images/geekswithblogs_net/Erik/WcfStorm/WcfStormPerfTest.jpg)）]

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T14:01:48.717

从这个开始：

[http://www.codeplex.com/WCFLoadTest](http://www.codeplex.com/WCFLoadTest)

它不能用 WCF 做所有可能的事情，但它是最好的工具。更糟糕的是，使用 Web 服务编写手动调用代码并不难。它们比网站更容易加载测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-03T21:51:26.480

SO-Aware 测试工作台通过丰富的视觉体验让事情变得非常简单。您可以构建各种测试和场景并快速运行它们。

[http://www.tellagostudios.com/products/so-aware-test-workbench%E2%84%A2](http://www.tellagostudios.com/products/so-aware-test-workbench%E2%84%A2)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-17T09:30:15.143

试试[http://www.soapui.org/](http://www.soapui.org/)有一个开源和专业版，你需要勾选下载 loadui，这是你的负载测试位。

# java - 从方法返回 gif 图像

> ID：221976
> 
> 赞同：2
> 
> 时间：2008-10-21T14:00:45.440
> 
> 标签：java, image, gif

我正在用java创建一个应用程序，它将成为外部应用程序的一部分。我的应用程序包含一个视口，它显示了一些多边形和类似的东西。外部应用程序需要获取 gif 格式的视口图像。为此，它调用接口中的方法（由我的应用程序实现）并且我的应用程序返回图像。外部应用程序需要将图像存储在数据库中（或与它相关的东西，我不需要担心）。

我的问题是：- 当我的应用程序将图像发送到外部应用程序时，图像的数据容器类型应该是什么？我的意思是该方法的返回类型应该是什么？目前我的 gif 编码器类返回一个字节数组。还有其他“更好”的选择吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T14:08:21.167

如果您希望 GIF 很小，则字节数组可能是合适的，但您可能会考虑使用一个`OutputStream`，这样您就可以更有效地流式传输位。

即使今天您只返回一个完全填充的`ByteArrayOutputStream`，这也将允许您在将来更改您的实现而不会影响 cilent 代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T14:17:30.883

更直观的返回类型可能是 java.awt.Image。

以下是一些示例： [http ://www.google.com/codesearch?q=java+gif+image&hl=en&btnG=Search+Code](http://www.google.com/codesearch?q=java+gif+image&hl=en&btnG=Search+Code)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:42:23.420

如果您的“应用程序”实际上正在调用 Java 方法，那么它应该理解 Java 返回类型并且您应该返回 java.awt.image。

如果您通过某种无法理解 Java 类型的远程过程执行此操作，我将返回一个字节数组并让接收应用程序对其进行解码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T19:25:46.017

我会创建两种方法：

1.  第一个方法创建图像并返回一个`java.awt.Image`. 在这里你可以把你的方法的绘图部分。
2.  第二种方法根据`java.awt.Image`外部应用程序的请求创建 gif 表示。它应该`OutputStream`按照已经建议的方式返回。

# .net - 如何判断 Excel 应用程序是否处于单元格编辑模式？

> ID：221984
> 
> 赞同：3
> 
> 时间：2008-10-21T14:02:27.590
> 
> 标签：.net, excel, vsto, com-interop

我正在使用.net 中的 COM 互操作编写 Excel 插件。我有一个弹出对话框的命令，从对话框中我做了一些工作，比如从几张纸的使用范围中收集数据。问题是，如果一个单元格处于编辑模式，我需要进行的一些调用将引发异常。我想要一种预先确定 Excel 处于编辑模式的方法，以便我可以警告用户先完成对单元格的编辑。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T16:16:34.527

有一个 Application.Ready 属性应该为您提供此信息，但实际上它不能可靠地工作。请参阅[此处](http://www.codeproject.com/KB/office/Excel_Edit_Mode.aspx)以获取解决方法。

您可能还想在 .net 代码执行其工作时查看设置 Application.Interactive=false。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-07-31T11:31:01.843

试试这个功能：

```
 Function IsInEditMode(ByRef exapp As Excel.Application) As Boolean
        If exapp.Interactive = False Then
            Return False
        Else
            Try
                exapp.Interactive = False
                exapp.Interactive = True

                Return False
            Catch
                Return True
            End Try
        End If
    End Function 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-08-03T19:01:21.327

你没有提到你使用的是哪种语言。[SZL的函数](https://stackoverflow.com/a/25057820/3626160)是用VB编写的。由于我使用的是 C#，因此我必须对其进行转换。工作得很好。这是等效的 C# 代码。

```
 bool IsInEditMode(ref Microsoft.Office.Interop.Excel.Application exapp)
    {
        if (exapp.Interactive == false)
        {
            return false;
        }
        else
        {
            try
            {
                exapp.Interactive = false;
                exapp.Interactive = true;
                return false;
            }

            catch
            {
                return true;
            }
        }

    } 
```

# visual-studio - Add files to a VS.Net solution/project from Vim

> ID：221989
> 
> 赞同：1
> 
> 时间：2008-10-21T14:02:44.813
> 
> 标签：visual-studio, vim, projects-and-solutions

Pretty much what the title says. Is there a way to add files to a vsnet project from inside Vim? I work in a group of devs, and all of our code has solutions and projects as you would expect. I would like to use Vim, and was hoping for a way to maintain those project files when I added or removed files without having to go into vsnet.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T14:14:37.380

The project and solution files are in xml and are hand-edittable. (I often have to during an SVN merge.) However, HUGE DISCLAIMER AHOY, adding stuff from scratch is a lot more dubious than an svn merge. I get to see the lines and just move them in (or not) here or there. To be confident that you're not destroying the proj and sln files, you would have to experiment with visual studio a little bit to make sure what has to be added.

There are more IDEs than visual studio... perhaps there's some clues in their guts.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T15:58:53.767

问题是你试图让 Vim 成为一个 IDE 的角色，它不是而且从来没有声称是。您几乎可以在阳光下编辑任何东西，但是当您开始要求它像我认为您想要的那样管理文件和关系时，您会感到头疼。

# database - MS Access 迁移的前端？

> ID：221995
> 
> 赞同：25
> 
> 时间：2008-10-21T14:04:46.213
> 
> 标签：database, ms-access, desktop-application

### 背景

我为一个拥有数千个 MS Access 应用程序的大型组织工作。这些都不是我写的——事实上，大多数原作者早已离开公司——但有时另一个 Access 应用程序会出现在我的办公桌上寻求支持。我很想*用*不同的解决方案替换访问。

### 要求

我知道 MS Access（Jet 数据库）的数据库部分有几个不错的替代方案，例如 SQLite、MySQL、VistaDB 等。

我想知道的是：有什么东西可以取代 MS Access 的前端部分吗？

即可以用来构建表单、编写简单脚本和查询等的东西？

### 为什么？

@BracC 问“为什么要替换访问权限？” - 确实是一个公平的问题。
我想摆脱访问权限，因为：

*   它隐藏了逻辑，导致难以支持的应用程序。逻辑可以在很多不同的地方，没有一个提供或鼓励任何结构：
    *   宏
    *   模块
    *   查询
    *   形式
*   它的本质鼓励用户创建“小”应用程序，这些应用程序成为“不那么小的应用程序”。然后用户离开，我必须支持一堆意大利面。我知道访问权限不是唯一的罪魁祸首，但它是我组织中的领导者，我很想完全摆脱它。

### 额外学分

我*真正*想找到的是可以在 MDB 文件中读取并输出类似 C# 的东西来复制功能的东西。（或任何语言 - 不挑剔）。

我希望这一切都清楚了。如果没有，请发表评论，我将重新编写/添加详细信息。

### 更新

@GuinnessFan 提出了一些我觉得很有趣的观点。我添加了我的评论来讨论这些观点。

自从我提出这个问题以来，我们做了什么：

*   让用户向我们提供他们使用和需要的访问应用程序的明确列表。（理解是任何不在列表中的 MDB 文件都可以删除 - 万岁！）。
*   分析了名单上的MDB，得出以下结论：
    *   大多数“应用程序”由单个硬编码查询或单个链接表组成。
    *   许多是带有日期参数或类似参数的少量查询。
    *   很少（如果有的话）有任何真正复杂的逻辑。
*   我们现在正在处理该列表，将大多数应用程序转换为 SSRS（SQL Server Reporting Services）包。
*   任何无法使用 SSRS 复制的东西都将成为手工制作的 Web 应用程序。然而，这些并不多。

非常感谢***所有***给我有用的答案的人。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T14:12:36.930

几年前，我将一个应用程序的后端从 MSacces 切换到了 MSSQL。保留前端，因为它运行良好，而且我没有发现任何易于使用/修改的东西。

我从未见过 MSAccess -> C# 翻译器。但是，您可能能够找到一个 MSAccess 到 VB6 的翻译器（它们的语法大致相似），并且从那里有 VB6->VB.Net 翻译器（甚至是 VB.Net ->C# 翻译器）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T14:21:17.677

您可以查看[Oracle 的 Application Express](http://apex.oracle.com/i/index.html)。它是免费的，面向 Access 开发人员。

它还有一个迁移助手，您可以通过它运行您的 Access 数据库，它处理数据和表单，将所有内容迁移到 Oracle 数据库（这适用于免费数据库 Oracle XE，并且默认安装）并构建 Web 表单为您的 Access 数据库。

因此，最终您将拥有 Web 上的 Access 数据库、Oracle 中的数据以及用于扩展它们的一些不错的 Web 前端。

就 Oracle 而言，该工具还不错。[你可以在这里](http://apex.oracle.com/pls/otn/f?p=4700:1:194910063149485:::::)注册一个免费的实例来玩。

[这是解释如何迁移 Access 数据库的文档。](http://download.oracle.com/docs/cd/E10513_01/doc/appdev.310/e12854/toc.htm)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T14:54:27.657

那么，除了个人厌恶之外，为什么要更换 Access 前端呢？对于某些（简单）数据库来说可能很容易做到，但现实世界中的大多数 Access 应用程序都非常复杂。

当然，升级后端的原因有很多（可扩展性、性能、数据库损坏、用户锁定）。Access 甚至有一个内置的“升级向导”工具，允许您从数据中拆分表单和逻辑，并将数据升级到 MS SQL 服务器。如果需要，可以使用此向导将后端升级到 SQL Express，然后手动迁移到另一个数据库平台。

希望这不会离题太远，但有时您需要使用 Access 做的就是：

1.  升级后端（正如我们已经讨论过的）

2.  始终确保前端已锁定（只读）

3.  如有必要，为不同的用户角色创建不同的前端（作为一种安全形式）。

4.  如果可能，出于性能原因，在每个工作站上本地复制前端。您可能需要一个网络脚本来检查前端的新版本。

我没有任何直接经验，但我确实在[http://www.microtools.us/找到了一个名为“Access Whiz”的访问 ASP.Net 转换器工具](http://www.microtools.us/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T20:04:13.803

我们使用基于 MS Access 的内部应用程序作为 MySQL 数据库的前端。我们遇到了[很多问题](https://stackoverflow.com/questions/5842/issues-using-ms-access-as-a-front-end-to-a-mysql-database-back-end#9200)，最终在[CodeGear Delphi 2007 for Win32](http://www.codegear.com/products/delphi/win32)中重写了整个应用程序。这是一个巨大的成功，尽管迁移确实花费了很多精力（培训/雇用了几个 Delphi 程序员，购买了一些第三方工具）。不过，我可以全心全意地推荐 Delphi。而且 AFAIK，与 MS Access 后端集成当然是可能的 --- 我曾经写过一个 Delphi 应用程序，它就是这样做的，只花了我几天时间就得到了一个功能完整的版本！

我意识到这是一个完整的编程解决方案，所以你肯定会失去一些用于构建前端的 MS Access 的易用性。再说一次，您可以在 10 分钟内用 Delphi 组装一个数据库应用程序，而无需编写太多代码 --- 不开玩笑！自 2009 年发布以来，该语言再次慢慢成为主流......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T15:01:22.310

@布拉德C

我不推荐 MicroTools。我曾在一家公司工作过一段时间，我们遇到了同样的问题。除非 MicroTools 对其产品进行了重大改进，否则我上次检查时它会吐出垃圾。

我们发现几乎任何升级路径都需要大量的编码更改。所有这些工具的好处是维护与原始应用程序类似的 GUI。他们的代码没有对象结构，只有一堆实用函数，它们被转储在每个页面上，以模拟 Access 提供记录导航的方式。如果您有大量表单，则提取他们的解决方案并实施您自己的解决方案需要一些工作和大量的查找和替换操作。

我们对 MicroTools 的性能非常失望，于是开始编写自己的转换器。经过一周的编码，我们得到了更好的 ASP.NET 表单。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-21T14:12:06.353

您不会找到同时附带桌面界面设计工具的服务器级*引擎*。大型服务器引擎都希望您使用 C++、C#、Java 或 PHP 之类的东西来构建您的界面。

我也很想看到一个访问升级工具，它会输出一些基本的 C# 表单并与等效的 SQL Server 数据库对话。对于微软来说，这似乎是一个大赚钱的工具，因为他们可以用它作为向客户追加销售完整 SQL Server 的一种方式。

IIRC，可能有一种方法可以告诉 Access 前端与 SQL Server 对话，或者将 Access 前端使用的表更改为真正链接到 SQL Server 的表，或类似的东西，但我从来没有必须自己使用该功能。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-21T19:52:20.723

我有不同的观点供你考虑。您的主要问题是它隐藏了逻辑，并且数据和应用程序分散在组织中。

不幸的是，我不知道有一个 RAD（快速应用程序开发）工具可以像 Access 一样简单地创建功能表单。

但是，我建议您更多地关注集中数据和逻辑的可能性，并且仍然允许 Access 作为前端。我支持一个名为 Advantage Database Server 的数据库产品，它支持 RI（引用完整性）规则、存储过程、触发器等，这些都可以在中央服务器上进行管理，从而为您提供所有逻辑。然后，这些 Access 前端可以使用 ODBC 或 OLEDB 链接到数据后端。如果您切换到这样的解决方案，那么稍后您将可以灵活地编写其他应用程序，例如 .NET、PHP、JDBC 等，这些应用程序与相同的数据相关联，同时逐步淘汰 Access 前端。

一个好的开始是停止新的 Access 开发，除非他们使用这种数据后端。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-11-03T03:53:39.557

在 1000 个 Access 文件中，有多少是您被要求支持的？我猜不到 100 个。为什么要重建一个 A) 没有人使用 B) 可以正常工作的应用程序？

您需要制定一个策略，让大型组织在稳健、可扩展、可靠的 yadda yadda yadda 环境中开发自定义应用程序是一种可接受的做法。确定您认为很重要或已经过时的 Access 应用程序，然后在这些应用程序上工作。

准备好应对快速周转获得快速而肮脏的小型应用程序的期望。您必须向他们展示您的新应用程序的好处。

I think you just need to be a resident expert and teach these users how to improve their application or get your input from the beginning to start them off right. The requirements to convert all of these files would otherwise be overwhelming.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-19T08:28:40.797

Microtools 提供 Access Whiz，一套 Access 转换工具。它由 Access to ASP .NET (VB/C#) 转换器、Access to VB6 转换器、Access to WinForms (VB .NET/C#) 转换器和 Access to Crystal Reports 转换器组成。更多信息和试用演示可以在[http://www.microtools.us](http://www.microtools.us)找到。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-23T21:24:14.057

你也可以看看[火鸟](http://www.firebirdsql.org)

这是[迁移](http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=sql2gdb)的方式（你需要Delphi）

我也找到了这个[MDB2FDB](http://www.firebase.com.br/fb/downloads.php?categ=8)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T14:13:59.907

> 有什么东西可以取代 MS Access 的前端部分吗？

也许[可喜](http://www.kexi-project.org/)？

# ruby-on-rails - How to display events in the calendar using Ruby?

> ID：221999
> 
> 赞同：3
> 
> 时间：2008-10-21T14:05:56.023
> 
> 标签：ruby-on-rails, ruby, events, calendar

I am building a calendaring application in ruby on rails. I am using my own schema for storing events, but I don't know how to display events in calendar, and also how to add a calendar in my application.

Will I have to write code to display calendar or can I use any plugin to display calendar.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T15:40:35.693

我认为[calendar_helper 插件](http://topfunky.net/svn/plugins/calendar_helper/)是你想要的。它为您的视图提供了一个日历方法，可以调用该方法以在 HTML 中生成月视图日历。

您可以将一个构建每天单元格内容的块传递给它，您可以在其中执行您的事件模式所需的任何操作以提取当天的事件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-16T19:15:29.453

EventCalendar 插件正是出于这个原因而创建的。跨日历日和行轻松显示多个重叠事件。

[http://github.com/elevation/event_calendar](http://github.com/elevation/event_calendar)

屏幕截图：http: [//dev.elevationblog.com/2009/7/23/event-calendar-rails-plugin](http://dev.elevationblog.com/2009/7/23/event-calendar-rails-plugin)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-13T03:50:24.923

我还必须在 Rails 中构建日历。现有的日历宝石都没有吸引我，因为它们做得太多了。我想自己渲染日历，这样我就可以控制样式。我也有一个现有的事件模型，所以我不需要任何类型的事件处理。我最终创建[了 cal gem](https://github.com/austinthecoder/cal)。当您查看自述文件时，它非常简单。我计划对其进行改进，使其具有每周和每日日历。祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T18:38:17.877

[这里](http://code.google.com/p/calendardateselect/)有一些候选人名单。

页面本身的插件似乎提供了一些 AJAX 优点，如果您对此感兴趣的话。*``************`