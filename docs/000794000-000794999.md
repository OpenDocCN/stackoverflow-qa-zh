# StackOverflow 问答 000794000-000794999

# c++ - 当人们说 C++ 具有“不可判定的语法”时，他们是什么意思？

> ID：794015
> 
> 赞同：39
> 
> 时间：2009-04-27T15:21:24.330
> 
> 标签：c++, compiler-construction

人们说这话的时候是什么意思？对程序员和编译器有什么影响？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-04-27T15:44:04.620

这与C++的模板系统[图灵完备](https://stackoverflow.com/questions/189172/c-templates-turing-complete)有关。这意味着（理论上）您可以在编译时使用可以使用任何其他图灵完备语言或系统的模板来计算任何东西。

这会产生一些明显有效的 C++ 程序无法编译的副作用。编译器将永远无法确定程序是否有效。如果编译器能够判断所有程序的有效性，就可以解决[停机问题](http://en.wikipedia.org/wiki/Halting_problem)。

~~请注意，这与 C++ 语法的歧义无关。~~

* * *

**编辑：** Josh Haberman 在下面的评论和[博客文章](http://blog.reverberate.org/2013/08/parsing-c-is-literally-undecidable.html)中指出，为 C++ 构建解析树实际上是不可判定的。由于语法的模糊性，不可能将语法分析与语义分析分开，而语义分析是不可判定的，语法分析也是不可判定的。

另请参阅（来自 Josh 帖子的链接）：

*   [C++ 语法：类型名称与对象名称问题](http://yosefk.com/c++fqa/web-vs-c++.html#misfeature-2)
*   [C++ 语法：类型与对象和模板特化](http://yosefk.com/c++fqa/web-vs-c++.html#misfeature-3)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-27T15:35:32.410

这可能意味着 C++ 语法在语法上是模棱两可的，您可以根据上下文写下一些可能意味着不同事物的代码。（语法是对语言语法的描述。它决定了这`a + b`是一个加法运算，涉及变量 a 和 b。）

例如`foo bar(int(x));`，正如所写，可以是一个名为 bar 的变量的声明，它的类型为 foo，其中 int(x) 是一个初始值设定项。它也可以是一个名为 bar 的函数的声明，接受一个 int，并返回一个 foo。这是在语言中定义的，但不是语法的一部分。

编程语言的语法很重要。首先，它是一种理解语言的方式，其次，它是编译的一部分，可以快速进行。因此，与 C++ 具有明确语法的情况相比，C++ 编译器更难编写且使用更慢。此外，虽然一个好的编译器会提供足够的线索，但制造某些类别的错误更容易。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-27T16:00:19.120

如果“某些人”包括 Yossi Kreinin，那么根据他在[这里](http://yosefk.com/c++fqa/web-vs-c++.html#misfeature-2)写的内容......

> 考虑这个例子：
> 
> ```
> x * y(z); 
> ```
> 
> 在两种不同的情况下：
> 
> ```
> int main() {
>     int x, y(int), z;
>     x * y(z);
> } 
> ```
> 
> 和
> 
> ```
> int main() {
>     struct x { x(int) {} } *z;
>     x * y(z);
> } 
> ```

...他的意思是“您无法通过查看 x * y(z) 来决定它是表达式还是声明。” 在第一种情况下，它的意思是“用参数 z 调用函数 y，然后用 x 和函数调用的返回值调用 operator*(int, int)，最后丢弃结果。” 在第二种情况下，它意味着“y 是指向结构 x 的指针，初始化为指向与 z 相同的（垃圾和定时炸弹）地址。”

假设您有 COBOLmania 并在语言中添加了 DECLARE。然后第二个将成为

```
int main() {
    DECLARE struct x { x(int) {} } *z;
    DECLARE x * y(z);
} 
```

并且会出现可判定性。请注意，可判定并不会消除指向垃圾的指针问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-27T16:18:02.150

“不可判定的语法”是一个非常糟糕的词选择。真正不可判定的文法是这样的，即不存在将在所有可能的输入上终止的文法解析器。他们可能的意思是 C++ 语法不是上下文无关的，但即使这样也有点问题：在哪里划清语法和语义之间的界限？任何编译器都只会承认那些通过解析器阶段而没有语法错误的程序的正确子集，并且只有这些程序的正确子集实际上没有错误地运行，因此没有一种语言是真正的上下文无关甚至是可判定的（可能除了一些深奥的语言） .

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T15:37:25.383

对于我们这些使用该语言的人来说，这意味着错误消息可能会变得非常奇怪，非常快（实际上这并不是什么大问题。STL 库错误通常比由于语言而导致的错误更糟糕）语法）。

对于编写编译器的人来说，这意味着他们必须花费大量额外的时间和精力来编译语言。

# winapi - 将 WinXP 任务栏工具提示替换为另一个程序

> ID：794018
> 
> 赞同：1
> 
> 时间：2009-04-27T15:21:51.350
> 
> 标签：winapi, tooltip, taskbar, windows-xp

我需要将 WinXP 任务栏中的常用工具提示替换为另一个应用程序。因此，当鼠标悬停任务按钮时，我需要运行应用程序。这可能吗，以编程方式？如果是这样，怎么做？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T15:31:13.310

你为什么要弄乱另一个应用程序，而没有构建该应用程序来支持这种混乱？在不知道更多细节的情况下，听起来你正在尝试做一些你不应该做的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T14:11:04.273

是的，一切皆有可能（RPM 或其他，请参阅 Google Groups 以获取 C 中的示例，Win32）

# c# - 动态识别/定位页面内的 HTML 表格？

> ID：794022
> 
> 赞同：1
> 
> 时间：2009-04-27T15:23:21.283
> 
> 标签：c#, .net, asp.net, vb.net, .net-2.0

管理员用户可以通过 CMS 文本框控件将 HTML 内容添加到网站。

当此内容显示给网站访问者时，我想确定 HTML 表格的存在（由管理员用户使用 CMS 添加）并显示访问者导出该表格的选项。

我可以处理导出，但识别 HTML 表让我很难过。谁能给我一些方向？本网站使用 ASP.NET 2.0/VB.NET。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T15:24:56.210

给他们一个特定的 ID 并使用作用于 DOM 的 Javascript 来定位这个 ID。

[http://www.w3schools.com/htmldom/dom_obj_table.asp](http://www.w3schools.com/htmldom/dom_obj_table.asp)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T15:30:35.557

如果您想在客户端完成这项工作，您可以使用 JavaScript 使用 getElementsByTagName('table') 来完成。

[http://www.w3schools.com/HTMLDOM/met_doc_getelementsbytagname.asp](http://www.w3schools.com/HTMLDOM/met_doc_getelementsbytagname.asp)

# asp.net-mvc - ASP.NET MVC：漂亮 URL 的表单输入

> ID：794031
> 
> 赞同：3
> 
> 时间：2009-04-27T15:25:15.790
> 
> 标签：asp.net-mvc, routing, url-routing

我有一个网址：

装运/搜索/{searchType}/{searchValue}

和一个控制器动作：

```
// ShipmentSearchType is an enum ... PartNumber, CustomerOrder, etc...
ActionResult Search(ShipmentSearchType searchType, string searchValue) 
```

所以这意味着我可以输入漂亮的网址，例如：

装运/搜索/零件编号/Widget-01

并获取具有该零件编号的所有货物的清单。

现在，我正在忙于应用程序的工作，并且到了我正在制作一个要求零件号的搜索表单并将其发回搜索的地步。所以基本上我想要：

装运/搜索/零件编号/{user-input-from-textbox}

不幸的是，我无法通过表单访问上述网址——它必须在服务器端生成。因此，我将使用 {user-input} 作为发布请求值将表单发布回 Shipment/Search/PartNumber。

所以我最终得到：

```
[AcceptVerbs(HttpVerbs.Post)]
ActionResult Search(ShipmentSearchType searchType, string searchValue, bool? post)
{
    return RedirectToAction("Search", new { searchType = searchType, searchValue = searchValue});
} 
```

2件事：

1）有没有一种方法可以让我不用在客户端使用 javascript 就可以使用 Search 的 post 方法？

2）布尔？邮政价值在那里，所以他们有不同的签名。这显然是丑陋的。有没有更聪明的方法来做到这一点？

谢谢！

编辑：

“不幸的是，我认为我不能从表单中做到这一点（至少没有 javascript）。” &“有没有一种方法可以让我在不使用 javascript 的情况下绕过帖子？”

这有点模棱两可。我的意思是我不认为我可以让表单生成 url /Shipment/Search/PartNumber/{value-from-textbox} 并将其提供给表单方法获取。我认为这在 javascript 中很简单（覆盖提交操作以动态构建 url），但我没有这样做。我并不是说 javascript 是发布帖子所必需的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-27T15:35:05.937

我有同样的情况，但没有 javascript 它工作正常，我只是在 [post]Search 中收到 FormCollections，然后重定向到这样的操作：

```
[AcceptVerbs(HttpVerbs.Post)]
ActionResult Search(FormCollection form)
{    return RedirectToAction("Search", new { searchType = form["searchType"], searchValue = form["searchValue"]}); } 
```

我认为这是一个很好的解决方案，因为我观看了有关 Post-Redirect-Get 模式的视频 - asp.net mvc 应用程序中的良好实践。

# apache-flex - Flex 应用程序中的 UI 呈现不一致

> ID：794032
> 
> 赞同：0
> 
> 时间：2009-04-27T15:25:26.287
> 
> 标签：apache-flex, flex3, air, flash

有没有人注意到 Flex 应用程序中的 UI 呈现不一致。我在中继器内遇到单选按钮和文本控件问题。下面是一个示例...

什么会导致这种不一致？电脑性能，网速？

下面的转发器有一个 XML Web 服务作为数据提供者，使用 Flex 的 e4x 支持。在给定的 Flex 应用程序中是否存在可以呈现的数据阈值？

请注意，*大多数*情况下 Flex 会渲染应用程序，但*大多数*情况下在此应用程序中还不够好。

谢谢。

[替代文字 http://img87.imageshack.us/img87/1435/error3b.jpg](http://img87.imageshack.us/img87/1435/error3b.jpg)

下面的 MXML 代码，根据要求：

```
 <mx:Repeater id="rpQuestions" width="100%" height="100%" dataProvider="{srv.lastResult..Question}">
    <mx:Box backgroundColor="#FFFF99" width="100%">
        <mx:Text styleName="questionText" text ="{rpQuestions.currentIndex+1 +': ' +rpQuestions.currentItem.@QuestionText}" fontSize ="12" width="100%" selectable="false" />
    </mx:Box>
    <mx:HBox visible="{rpQuestions.currentItem..Image.length() > 0}" includeInLayout="{rpQuestions.currentItem..Image.length() > 0}">
    <mx:Repeater id="rpImages" dataProvider=quot;{rpQuestions.currentItem..Image}" >
        <mx:Image source="{rpImages.currentItem.@Path}" width="350" height="250"  />
    </mx:Repeater>
    </mx:HBox>
    <mx:Repeater id="rpAnswers" dataProvider="{rpQuestions.currentItem..Answer}" width="75%" height="75%">
        <mx:HBox>
            <mx:Spacer width="12" />
            <!-- NOTE: the RadioButton's label property is not used because long text won't  wrap. Instead we use a Text control. -->
            <mx:RadioButton 
            groupName="{rpQuestions.currentItem.@QuestionID}"
            value="{rpAnswers.currentItem.@AnswerID}"
            click="_questionAnswerd(event)"
            selected="{rpAnswers.currentItem.@Selected == '1'}"
                        />
        <mx:Text text="{rpAnswers.currentItem.@Answer}" width="600" selectable="false"  />
        <!-- End-->
        </mx:HBox>
    </mx:Repeater>
</mx:Repeater> 

```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-28T15:50:08.840

我会尝试确保中继器内的 hbox 设置了一个高度百分比（比如带有单选按钮的那个是 100%，它的中继器设置为 75%）。

或者您可以在中继器完成创建子组件（“repeatEnd”事件）后尝试使显示/大小无效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T10:16:23.503

这看起来与 Flex SDK 3.3.0 中报告的错误有关：

[SDK-198805：当存在中间组件时，嵌套中继器组件无法正确显示](https://bugs.adobe.com/jira/browse/SDK-19805)

# ruby-on-rails - ActiveRecord 中的快捷方式？

> ID：794035
> 
> 赞同：1
> 
> 时间：2009-04-27T15:26:07.440
> 
> 标签：ruby-on-rails, activerecord

Rails 的 ActiveRecord 中是否有任何快捷方式可以让您按字段的值进行搜索？

例如，假设我有一个可以活跃或不活跃的“用户”。有没有做 User.active 的好方法？还是我需要做 User.find_by_active(1)

这是否也适用于可能具有许多不同值的字段，例如状态列？例如 Ticket.open、Ticket.close？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T23:50:23.780

如果`active`属性是数据库中的布尔列，那么您可以简单地调用`User.active?`它，它将返回`true`或`false`取决于布尔值。

在 a state 列的情况下，这将不起作用。但是，您可以为 User 模型创建方法，例如...

```
def open?
  true if self.state == "open"
end

def closed?
  not open?
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T15:33:21.807

在这里回答我自己的问题：

命名范围：
[http ://ryandaigle.com/articles/2008/3/24/what-s-new-in-edge-rails-has-finder-functionality](http://ryandaigle.com/articles/2008/3/24/what-s-new-in-edge-rails-has-finder-functionality)

# vb.net - 选择案例真

> ID：794036
> 
> 赞同：19
> 
> 时间：2009-04-27T15:26:53.757
> 
> 标签：vb.net, vba, vb6

显然，这曾经是 VB6 和 VBA 中短路并执行第一个真实案例的一种方式：

```
Select Case True
End Select 
```

这还在使用（VB.NET）吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-27T15:37:46.523

这种语法经常被用来代替`If...ElseIf`语句。有些人觉得它更容易阅读。例如：

```
Select Case True
    Case testVariable < 0
         Console.Write("You must supply a positive value.")
    Case testVariable > 10
         Console.Write("Please enter a number from 0-10.")
    Case True
         Call DoWork(testVariable)
End Select 
```

答案是肯定的，这在 VB.NET 中仍然有效。使用时请注意，因为它不是“标准编程结构”，对于将来必须维护您的代码的人来说可能不熟悉。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-27T15:42:12.627

我不确定这个构造如何提供以下优势：

```
If testVariable < 0 Then
     Console.Write("You must supply a positive value.")
ElseIf testVariable > 10 Then
     Console.Write("Please enter a number less than 10.")
Else
     Call DoWork(testVariable)
End If 
```

上面的结构是短路的，我不必试图弄清楚它的作用，因为它是一个标准结构。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-27T17:55:13.527

其他人已经回答了这个实际问题，但我只想说我经常使用这个结构。我认为这通常是同时测试两个布尔条件的最易读的方法：

```
Dim A As Boolean
Dim B As Boolean
'
'do stuff to set values of A and B
'
Select Case True
  Case A And B
    'something
  Case A And Not B
    'something else
  Case Not A And B
    'you get the picture
  Case Else
    '...
End Select 
```

我承认我发现它易于阅读的部分原因是我确实使用了它，而且我确实记得我第一次看到它时不得不解析它——但一旦成功解析，我的反应是“太棒了！”

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-11-12T15:50:49.170

关于这个主题有很多困惑，但要回答 OPs 的问题：是的，VB.Net 中的逻辑评估与 VB6 中的逻辑评估和 VBA 中的逻辑评估相同。[http://support.microsoft.com/kb/817250](http://support.microsoft.com/kb/817250)

要利用 Select Case 优化技术，您可以使用 Select Cases 固有语法来避免使用逻辑运算符 And、Or、Xor 等。这些运算符确实具有短路评估。

考虑这个例子：

```
Public Sub Example()
    If A Or B Then
        Beep
    End If
    Select Case True
        Case A, B
            Beep
    End Select
End Sub

Private Function A() As Boolean
Debug.Print "A Ran"
    A = True
End Function

Private Function B() As Boolean
Debug.Print "B Ran"
    B = False
End Function 
```

Select Case 版本将只运行 A。If-Block 将同时运行。这不是 If 语句的错，而是 And 运算符的错。如果您愿意，可以像这样构造 If 语句以短路：

```
Public Sub Example2()
    If A Then
    ElseIf B Then
        Beep
    End If
End Sub 
```

B不会运行。这只是风格问题。

要知道的重要一点是，您要避免的是 And/Or/Xor 运算符而不是 If 块。如果您更喜欢 If-Block 的 Select Case 版本...为您提供更多功能：）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-10-20T12:02:15.253

`Select Case`本身就是[一个强大的运营商](http://msdn.microsoft.com/en-us/library/cy37t14y%28v=vs.110%29.aspx)。但即使`Select Case True`仍然支持，从可维护性的角度来看，最好避免使用。你总是必须证明需要。如果非常需要，您甚至可以使用`DoEvents`and `GoTo`。对于接受的答案，它可以这样写：

```
Select Case testVariable
  Case Is < 0 : Console.Write("You must supply a non-negative value.")
  Case Is > 10 : Console.Write("Please enter a number from 0-10.")
  Case Else : Call DoWork(testVariable)
End Select 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-27T15:32:53.977

你的意思是这样的吗？

```
 Select Case True
    Case 1 = 0
        Console.Write("1")
    Case 1 = 1
        Console.Write("2")
    Case 2 = 2
        Console.Write("3")
End Select 
```

在其中，程序将编写 2...如果这是您要问的，那么是的，它仍然存在于 VB.NET 中

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-03-05T07:22:37.947

您可以在任何包装器类型上定义等于运算符。然后您可以在 Select Case 上使用 Wrapper 类型。

样品包装。

```
Imports System.Runtime.InteropServices
<DebuggerStepThrough()> Friend Module Util
  Public Function _Is(v As Object) As IsWrapper
      Return New IsWrapper With {.Obj = v}
  End Function
  Public Structure IsWrapper
     Public Obj As Object
     Public Shared Operator =(ByVal a As IsWrapper, ByVal b As Object) As Boolean
         Return a.Obj Is b
     End Operator
     Public Shared Operator <>(ByVal a As IsWrapper, ByVal b As Object) As Boolean
         Return a.Obj IsNot b
     End Operator
  End Structure
End Module 
```

现在您可以使用 _is(AnyObject)：

```
Private Sub RbClass_CheckedChanged(sender As System.Object, e As System.EventArgs)
    If DirectCast(sender, RadioButton).Checked = False Then Return
    Select Case _Is(sender)
        Case RbClass : Rb = 0
        Case RbTablePredicate : Rb = 1
        Case RbTableRowFilter : Rb = 2
    End Select
    QueryCtl1_QueryChanged(Nothing, Nothing)
End Sub

Public Sub Predicate(ByVal PredicateType As Type, ByVal Op As Operadores, ByVal Obj As Object, ByVal CompareOptions As CompareOptions, ByVal Fnc As [Delegate])
   Dim pred As [Delegate] = Nothing
   Select Case _Is(PredicateType)
      Case GetType(Boolean)
          pred = New Predicate(Of Boolean)(Function(v) v)
      Case GetType(String)
          pred = StrPredicate(Op, Obj, CompareOptions)
      Case Else 'Utilizar Generics
          pred = GenericHelper.Builder(PredicateType).Predicate(Op, Obj)
   End Select
   Predicate(pred, Fnc)
End Sub 
```

**关于性能。**发布代码已优化。Wrapper 没有性能损失。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-01-11T17:41:18.867

使用构造 SELECT CASE TRUE 的另一个原因是当您的 case 语句评估为布尔值时。SELECT CASE 需要让所有案例评估为与控件相同的数据类型。如果您正在查看字符串数据类型，那么所有 case 语句也必须是字符串。

```
SELECT CASE [string]
CASE "String 1", "String 2"
    [do a thing]
CASE "String 3"
    [do another thing]
END SELECT 
```

但是，如果您使用 LIKE 运算符比较部分字符串，那么您的案例数据类型将变为布尔值，这将与字符串控件不匹配。以下代码将不起作用：

```
SELECT CASE [string]
CASE LIKE "*1", "*2"
    [do a thing]
CASE LIKE "*3"
    [do another thing]
END SELECT 
```

为了使用通配符（因此具有布尔大小写结果），您必须具有布尔控制值，因此结构需要是：

```
SELECT CASE TRUE
CASE [string] LIKE "*1", "*2"
    [do a thing]
CASE [string] LIKE "*3"
    [do another thing]
END SELECT 
```

我想你可以使用 IF...ELSEIF

```
IF [string] LIKE "*1" AND [string] LIKE "*2" THEN
    [do a thing]
ELSEIF [string] LIKE "*3"
    [do another thing]
END IF 
```

就个人而言，我发现选择的情况更易于使用，并且在有三个选项时读取。当我必须评估两个或三个不同的选项（>、=、<）或者我正在测试特定范围的“有效”条目的值时，我使用 IF...ELSE 和 IF...ELSEIF。相反，如果条目具有更多种类，并且我需要确定发生了十种可能性中的哪一种，则 SELECT CASE 是一个更容易使用的构造，因为它消除了对多个 OR 语句的需要。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-12-14T10:10:36.180

阅读此线程后，似乎主要论点`Select Case True`是可读性。这够了吗？当我第一次在 VB.NET 中看到这样使用的构造时，我不得不仔细阅读它几次以确保我掌握了它的要点，但仍然按照与[上面的 RolandTumble](https://stackoverflow.com/a/794549/3748030)相同的思路进行思考。因此，即使是可读性也要付出一点代价。每个人都知道`If...ElseIf...End If`声明是什么以及为什么存在。`AndAlso`可以使用or辅助短路`OrElse`，复杂性完全取决于所涉及的代码和编码器。

甚至`If`语句也可以优化。问明显的（是否是你的`value = True`）有什么意义。曾经有人问我，与我们一起工作的编码员做了以下什么...

```
Dim isVisible As Boolean
....
If isVisible Then
    ....
End If 
```

结构的使用`Select Case True`也感觉就像你将焦点或比较重点从实际`Select Case`行移到`Case`陈述中，这听起来很奇怪。

# dll - .NET 中的 DLL 混乱，如何将一个解决方案拆分为多个 DLL？

> ID：794038
> 
> 赞同：1
> 
> 时间：2009-04-27T15:27:13.507
> 
> 标签：dll, plugins, projects-and-solutions, coupling

我有一个包含 5-6 个项目的大型 VS.NET 项目，其中一个项目是 Core DLL。

现在要添加一些插件支持，我提取了一个接口，但是需要接口才能使用其他一些类，并且 Core.dll 需要该接口，因此我必须将它们分开。（我不能互相引用）

在那之后，我的一天被毁了，因为即使花了大约 4 个小时，我也无法将它们分开！最后，我创建了 20 多个项目，但仍然无法正常工作（*实际上甚至没有关闭*）。看起来我最终将完成 50 个项目，并且需要更改大量代码以使其正确。

我知道我的代码是高度耦合的，并且有点退缩。

我这样做对吗？现在我是否必须为我的高度耦合的代码付出代价并受苦？还是我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T15:32:09.530

重构，重构，重构。你将不得不支付你的会费，但我认为这是值得的。你会学到很多东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-27T15:32:17.050

如果您使用接口，您应该能够将您的接口从核心 DLL 中拉出，并且接口可以满足对该原始接口的任何要求，而几乎没有痛苦。

如果您的接口具有高度耦合的依赖关系，您可能需要进行一些重构。尝试从主接口的依赖项中提取接口或基类（这很容易拉入新项目）。这应该有助于防止听起来像您现在遇到的循环依赖问题。

不过，总的来说，我会说在你做这件事之前先退后一步想想你的项目。项目布局应该基于功能而不是依赖关系——如果你根据类的干净程度对它们进行分组，大多数依赖问题往往会自行清理。在您尝试提取之前，我真的会考虑重构它，以便获得最干净的布局。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T15:38:34.353

您是否考虑过使用[MEF](http://www.codeplex.com/MEF)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T18:22:18.017

您是否已经创建了依赖关系图？Graphviz dot 可以帮助可视化（和解释）问题。

# sql-server-2005 - 控制 SQL Server CLR 保留内存

> ID：794043
> 
> 赞同：4
> 
> 时间：2009-04-27T15:28:24.987
> 
> 标签：sql-server-2005, memory, sqlclr

我最近在我的 64 位 SQL Server 2005 机器上启用了 CLR，以使用大约 3 个过程。当我运行以下查询以收集有关内存使用情况的一些信息时...

```
select single_pages_kb+ multi_pages_kb + virtual_memory_committed_kb as TotalMemoryUsage, virtual_memory_reserved_kb 
from sys.dm_os_memory_clerks 
where type = 'MEMORYCLERK_SQLCLR' 
```

我明白了

129 mb MemoryUsage 和 6.3 gb 保留的虚拟内存

机器的总内存为 21 gig。保留的虚拟内存到底是什么意思，我如何控制分配的大小？6 gig 对于我们正在做的事情来说太过分了，sproc 缓存会更好地利用内存。我担心这个保留的内存会导致交换到页面文件。

请帮我收回对内存的控制权！

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-09T04:26:59.600

您正在运行 64 位，因此 VAS（虚拟内存）不是问题。

虚拟内存并未实际使用或分配。它只是保留了地址范围。

# sql - SQL存储字符串

> ID：794044
> 
> 赞同：1
> 
> 时间：2009-04-27T15:28:37.527
> 
> 标签：sql, sql-server, tsql

我需要将字符串保存在数据库中。每个字符串的大小从 1 到 N 不等。我认为这个限制大约是 10000，也许更多。nvarchar(MAX) 将是解决此问题的最佳方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T15:30:14.823

In`SQL Server 2005`和更高版本，`NVARCHAR(MAX)`是存储长度超过`4000`字符的字符串的最佳方式。

这是推荐用于和更高版本的唯一方法`SQL Server 2005`，尽管它仍然支持`TEXT`列以实现向后兼容性。

请注意，您不能在`NVARCHAR(MAX)`列上创建索引。

要使用索引，请创建一个计算列并在索引搜索中使用它。它可以作为一个有效的粗过滤器：

```
CREATE TABLE foo (id INT NOT NULL, mytext NVARCHAR(MAX) NOT NULL, mytext_index AS CAST(mytext AS NVARCHAR(450))

CREATE INDEX ix_foo_mytext (mytext_index)

SELECT  *
FROM    mytext
WHERE   mytext_index LIKE 'L%' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T15:31:09.690

如果它们是 unicode（或其他非 7 位或 8 位字符串），则 nvarchar 是正确的。如果它们是例如 ASCII latin-1 文本（在许多情况下就足够了），则 varchar(MAX) 将节省空间。

# visual-studio-2008 - 是否可以使用 Visual Studio 和 MS XNA Game Studio SDK 编写商业 XBOX 游戏？

> ID：794045
> 
> 赞同：5
> 
> 时间：2009-04-27T15:28:46.390
> 
> 标签：visual-studio-2008, xna

我知道大多数商业游戏开发都是用汇编或 C/C++ 完成的，但有没有人尝试过使用 XNA 和 VS 2008 来创建一个适合在大街上发布的实时密集型应用程序，而不是仅在 XBOX Live 上发布。您遇到的限制是什么，您获得了什么样的帧速率以及分辨率是多少？

显然你可以用它来写冠军经理/摇滚乐队之类的东西，但你能用它来开发像 Pro Evo 这样的游戏吗？

我怀疑我已经知道答案，但我很想听听其他人使用 XNA 和 Visual Studio 2008 的经验。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T15:45:32.527

XNA 作为一种技术当然能够提供高性能的应用程序。在某些情况下，例如绝对前沿的游戏，我认为可以公平地说 XNA 的性能尚未经过测试。

更大的问题是许可问题之一。微软目前并未将 XNA 作为开发专业 XBox 应用程序的框架，而是将其更多地用于社区开发。目前没有一个“专业”的目标 XNA 平台，据我所知，没有使用 XNA 的零售 SKU。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T15:12:40.753

Schizoid 是使用 XNA 开发的商业 Xbox Live Arcade 游戏（不是社区游戏）。

[Torpex 游戏](http://www.torpexgames.com/index.php)

Jamie Fristrom 在他的博客上讨论了这一发展：

[游戏开发博客](http://www.gamedevblog.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T15:58:15.087

我认为问题真的是，你为什么要这样做？如果您是一家想要为 XBOX 开发商业游戏的开发人员，那么您显然有资金和资金可以投资。那么 XBOX 360 的官方 SDK 已经多少钱了？我不知道确切的数字，但我认为大约是 20k 左右。总体而言，这并不算多钱，那么当您可以访问完整的 SDK 时，为什么要限制自己使用 XNA 呢？

还有一点，我认为如果您使用本机 C/C++ 进行开发，跨平台开发会容易得多。我非常怀疑你为这款游戏构建的 XNA 库的任何部分都可以轻松移植到 PS3/PC 上。让我们面对现实吧，如今越来越多的大型游戏正在跨平台发展，所以这是您需要考虑的另一件事。

我知道这并不能回答你关于它是否有能力的问题，但我想知道我们是否会发现......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-04T13:33:45.027

洗碗机是使用 XNA 开发的：http: [//thedishwasherdeadsamurai.com/](http://thedishwasherdeadsamurai.com/)

您可以在此处阅读开发人员 (James Silva) 的博客：http: [//skasoftware.wordpress.com/](http://skasoftware.wordpress.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T16:07:18.137

[http://creators.xna.com/en-US/](http://creators.xna.com/en-US/)

您不能将 XNA 游戏放在磁盘上以在 Xbox 上使用，但您可以在 Xbox Live 的社区部分提供购买和下载。XNA 的表现非常好，尤其是在计算机硬件上。

# java - 使用表达式访问对象的属性值

> ID：794049
> 
> 赞同：2
> 
> 时间：2009-04-27T15:29:39.850
> 
> 标签：java

考虑以下代码：

```
Class Demo
{
    Person person = new Person("foo"); // assume Person class has a 'name' field.

    //Now, how do I get the value of a field, using some expression.
    String expression = "person.name";
} 
```

现在，我想评估“表达式”以获取“名称”属性的值。谁能告诉它怎么做？

-- 更新：我将从 XML 文件中获取的“表达式”字符串。那么，在那种情况下也可以使用“反射”吗？“表达式”字符串也可能进入更深层次，例如“person.birthday.date”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T15:34:05.800

Java 中没有本地方法可以做到这一点。存在多种其他选择。

一种方法是使用[JXPath](http://commons.apache.org/jxpath/)。这使用 XPath 样式的语法来查询对象。对于您的目的而言，这可能有点矫枉过正，但无疑是强大的。

例如来自 JXPath 主页：

```
Address address = (Address)JXPathContext.newContext(vendor).
         getValue("locations[address/zipCode='90210']/address"); 
```

它向给定的供应商对象询问其地址，邮政编码为 90210。因此，您可以导航对象层次结构并提供谓词来执行“SELECT .. WHERE”类型的查询。

另请参阅[这篇](http://today.java.net/pub/a/today/2006/08/03/java-object-querying-using-jxpath.html)java.net 文章以获取更多示例（我写的东西的无耻插件）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T15:33:13.227

通常在 Java 中，您创建 getter 来检索此信息。但是，如果您需要按名称获取字段的值，则应该使用[反射](http://java.sun.com/docs/books/tutorial/reflect/index.html)。

然而，关于你的问题，有一些东西让我觉得你的问题更多地与设计有关，而不是与反思有关。你能告诉我们更多吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T15:58:20.170

您当然可以通过编写一个使用反射的解析器自己做这种事情，但您也可以使用 Spring 的表达式评估语言，这几乎是您想要的（[文档](http://www.epril.com/resources/spring3/reference/html/ch07s03.html)！）。

你可以用它做一些很酷的事情；它是一种功能强大的语言，类似于 JSP 的 EL 脚本（也是一种选择）。你只需要传递一个上下文，其中“人”意味着什么。

例子！

```
public class DoStuff {
  class MyVariables {
    private person;
    public void getPerson() { return person; }
    public void setPerson(Person person) { this.person = person; 
  }

  public static Object eval( String input ) {
     MyVariables myVariables = new MyVariables();
     StandardEvaluationContext simpleContext = new StandardEvaluationContext(myVariables);
     ExpressionParser parser = new SpelAntlrExpressionParser();
     Expression exp = parser.parseExpression( input );
     return exp.getValue(context);
  }

  public static void main(String[] args) {
      String name = (String)eval("person.name");//woot!
  }

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-27T16:38:02.773

尽管我建议像其他人建议的那样使用工具来解析表达式，但您可以使用*反射。*

但是，如果您的表达式很*简单*，您可以执行以下操作：

```
public static Object GetFieldValue(Object obj, String expr) throws SecurityException, NoSuchFieldException, IllegalAccessException {
    if (obj == null)
        throw new IllegalArgumentException("obj");

    if (expr == null || expr.isEmpty())
        throw new IllegalArgumentException("expr");

    String[] parts = expr.split("\\.");

    if (parts.length > 0) {
        Object currentFieldValue = obj;

        for (String fieldName : parts) {
            Field field = currentFieldValue.getClass().getDeclaredField(fieldName);
            field.setAccessible(true);
            currentFieldValue = field.get(currentFieldValue);
        }

        return currentFieldValue;
    }

    return null;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T15:31:05.057

假设您不想要简单的路线`String expression = person.name;`（没有引号`person.name`），您需要[反射](http://java.sun.com/docs/books/tutorial/reflect/member/index.html)。

但是，解析任意表达式并不容易。如果您想调用带有参数的方法，那么您正在向自定义脚本语言迈进。但是仅仅为了访问一个成员，这并不太难。但是在我给你写任何代码之前，我想知道为什么你想要有任意表达式，而普通的 Java 可以在这里做。

**编辑：**此代码可能会起作用：

```
public static Object getValue(Object obj, String path)
        throws NoSuchFieldException,
               IllegalArgumentException,
               IllegalAccessException {

    Object currentObj = obj;

    while (true) {
        int indexOfDot = path.indexOf('.');
        boolean lastIter = indexOfDot < 0;

        String fieldName = lastIter ? path : path.substring(0, indexOfDot);

        Field f = currentObj.getClass().getDeclaredField(fieldName);
        f.setAccessible(true);
        currentObj = f.get(currentObj);

        if (lastIter)
            return currentObj;

        path = path.substring(indexOfDot + 1);
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-27T15:32:26.193

“正确”的方法是在 Person 中有一个名为 getName() 的 getter 方法，它返回 name 的值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-27T15:35:59.337

尽管您可以使用反射来做到这一点（`java.bean`可能更有意义），但使用反射往往会导致混淆。

为什么要解释一些文本？你是故意写解释器吗？引用`person`本身是否真的应该被视为一个对象？告诉我们您的意图。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-27T15:38:46.223

如果您希望允许用户通过提供表达式（例如您的 person.name 表达式）来自定义您的程序，您可以查看在您的程序中嵌入 groovy 或 jython 并在该上下文中运行它们的表达式。这是嵌入 groovy 的第一个 google 点击。 [http://groovy.codehaus.org/Embedding+Groovy](http://groovy.codehaus.org/Embedding+Groovy)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-27T16:46:39.820

如果数据是 XML DOM，那么[XPath](http://java.sun.com/javase/6/docs/api/javax/xml/xpath/package-summary.html)可能是最好的选择。如果您想添加自己对[统一表达式语言的支持，您可以通过](http://java.sun.com/products/jsp/reference/techart/unifiedEL.html)[实现几个类](http://illegalargumentexception.blogspot.com/2008/04/java-using-el-outside-j2ee.html)来添加它。如果您想通过[javax.script](http://java.sun.com/javase/6/docs/api/javax/script/package-summary.html)使用几乎任何脚本语言（需要 Java 6），请查看[这个脚本引擎库](https://scripting.dev.java.net/)。

开箱即用，您可以使用 Java 6 执行此操作：

```
public class ResolveMe {

  public URI uri;

  public static void main(String[] args)
      throws ScriptException, URISyntaxException {
    ResolveMe myObject = new ResolveMe();
    myObject.uri = new URI("http://stackoverflow.com/foo");

    String expression = "myObject.uri.host";

    ScriptEngineManager sem = new ScriptEngineManager();
    ScriptEngine engine = sem
        .getEngineByMimeType("application/javascript");
    engine.put("myObject", myObject);

    System.out.println(engine.eval(expression));
  }

} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-27T17:00:06.560

您是否真的需要“名称”才能成为 java 对象中的成员？您可以将其存储在哈希表中并使用查找来代替吗？

（提示：如果您在该对象内部对其进行操作，您只需要它成为该对象的成员，即使这样，如果您愿意，您也有一个对象在内部将其数据存储为哈希）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-27T18:48:22.773

不要一个人做这么辛苦的工作。使用执行此操作的库。Apache common 的 bean utils 有一个方法 BeanUtils.getProperty(Object bean, String name) 您可以将 bean 和属性传递给该方法。例如， BeanUtils.getProperty(foo, "name") 将为您获取 foo 的 Person 的 name 属性（您不会使用“person.name”，因为这将等效于 foo.getPerson().getName() ）。

您可以从 maven 中央存储库下载 BeanUtils jar： [http ://repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.8.0/commons-beanutils-1.8.0.jar](http://repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.8.0/commons-beanutils-1.8.0.jar)

It may need some dependencies that are in the [http://repo1.maven.org/maven2/commons-beanutils](http://repo1.maven.org/maven2/commons-beanutils) hierarchy, I'm not sure. You can google for apache commons BeanUtils jar and see if you can get the dependencies this way, but you may be able to use the jar standalone.

# javascript - 使用 scriptaculous 获取文件名

> ID：794050
> 
> 赞同：0
> 
> 时间：2009-04-27T15:29:46.917
> 
> 标签：javascript, file-io

我希望基本上创建一个带有 scriptaculous 的图像旋转器。诀窍是我想使用某个目录中的图像来驱动旋转。

例如，如果目录中有 3 个文件，则它会旋转 3 个图像，5 它将旋转 5 个图像。

如何读取文件名以用于/确定 Scriptaculous？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T15:54:59.290

Scriptaculous 只是一个 JavaScript 库。作为 JavaScript 意味着它无法访问文件系统。您将需要一些服务器端代码来执行此操作，并将文件列表作为字符串或 JSON 集成到 JavaScript 中。

就像是：

```
imgList="a.gif,b.gif,c.gif".split(",") 
```

...可以为您构建一个简单的数组。

# asp.net - ASP.NET 是否可以将会话长度与用户区分开来？

> ID：794052
> 
> 赞同：1
> 
> 时间：2009-04-27T15:30:26.773
> 
> 标签：asp.net, session

在 asp.net 会话长度中，它可以根据用户登录的类型而具有不同的长度吗？我希望管理员用户在 3 小时后超时，但标准用户在 30 分钟后超时，因为办公室的工作人员经常打开多个窗口，并要求更长的会话长度。我对为外界延长它有点怀疑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T15:35:42.813

您可以设置会话超时（分钟）。

```
 if (User.IsInRole("Admin"))
      Session.Timeout = 3 * 60; 
```

# sifr - 从 XML 文件中用 spry 加载的文本可以替换为 sIFR 文本吗？

> ID：794054
> 
> 赞同：0
> 
> 时间：2009-04-27T15:30:39.003
> 
> 标签：sifr

在 sIFR 方面，我是一个相对较新的人，但我之前已经设法让它运行起来。我从来没有听说过这个问题。我通过 Adob​​e Spry 将数据加载到我的页面中，然后我尝试在加载后将 sIFR 替换应用于该文本。我可以让 sIFR 替换占位符文本，但不从 XML 加载文本，或者我可以加载 XML 数据，但根本没有 sIFR 样式的文本。我不能让两者都工作。不知道是什么问题。任何想法将不胜感激。

链接和用户名和密码如下。（它只是受到保护，因为该网站尚未完成，我不希望搜索引擎蜘蛛捡起它。）

jordanheider.com/builder.php

用户名：dash 密码：kudzu

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T21:39:22.457

sIFR 只能替换替换时文档中的内容，以及页面上显示的内容。因此，在您的情况下，确实在将新内容加载到页面后，您必须再次进行替换。

我注意到一些动画，可能时间不正确，这意味着当您进行替换时内容实际上还没有显示。

如果 sIFR 替换占位符文本，则无法加载新文本是什么意思，但听起来 sIFR 可能会阻止负责加载文本的代码触发。这可以通过手动连接事件来解决，使用`onRelease`您可以在`sIFR.replace()`.

# binary - 正数的二进制补码表示法是同一个数吗？

> ID：794062
> 
> 赞同：13
> 
> 时间：2009-04-27T15:31:45.790
> 
> 标签：binary, complement

正数的二进制补码符号是否与其二进制表示相同？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-27T17:13:49.023

一些答案和评论正在混淆“二进制补码表示法”和“数字的二进制补码”之间的关系。这个问题可能需要稍微澄清一下，但它显然是在询问“二进制补码表示法”。

二进制补码表示法包括正数和负数。二进制数可能意味着很多东西，所以为了确定任何二进制数应该代表什么，首先必须知道正在使用什么符号或编码。二进制数可以是无符号整数、二进制补码整数、IEEE 浮点数、字符串或完全其他的东西。

所以 7 在二进制补码表示法中是 00000111，就像它是一个无符号整数一样。二进制补码表示法中的 -7 是 11111001。

所以，是的，二进制补码表示法中的正整数的表示方式与无符号整数的表示方式相同（假设它是正在使用的位数的有效整数）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-27T16:41:43.763

我认为你在这里混淆了一些东西。正整数通常存储为简单的二进制数。1 是 1，10 是 2，11 是 3，等等。负整数存储*为其绝对值的二进制补码*，即对应的正整数。使用这种表示法时，正数的二进制补码是负数。

为了翻转数字的符号，您总是计算该数字的二进制补码：翻转所有位，然后加 1。这与原始数字是正数还是负数无关。

示例：8 位有符号二进制表示法中的 3 是 00000011。要翻转符号，首先翻转所有位 (11111100)，然后加 1 (11111101)。所以，-3 是 11111101。要再次翻转符号，首先翻转所有位（00000010），然后添加 1（00000011），您可以看到这是相同的 3。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-27T15:39:53.973

> 正数的二进制补码表示法是同一个数吗？

一个很好的例子来自[wiki](http://en.wikipedia.org/wiki/Two%27s_complement)，通过注意 256 = 255 + 1 来实现与二进制补码的关系，并且 (255 - x) 是 x 的补码

0000 0111=7 二进制补码是 1111 1001= -7

它的工作方式是 msb（最高有效位）接收一个负值，因此在上述情况下

> -7 = 1001= -8 + 0+ 0+ 1

**编辑 -**用二进制补码表示的正数与用无符号表示的数字相同（尽管最高有效位必须为零）。一个负数可以用二进制补码表示法写入，方法是将其绝对值的所有位取反，然后将结果加 1。[补码符号](http://74.125.93.132/search?q=cache:ld9pBnc4_QcJ:cnx.org/content/m10808/latest/+two+complement+notation&cd=2&hl=en&ct=clnk&gl=us&client=firefox-a)

可以用 k 位二进制补码表示法表示的最大数是 2^(k-1)−1

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-12-22T00:01:16.213

根据我在计算机科学课上学到的知识，二进制补码、一个补码和有符号幅度仅在正整数值中是相同的。这将与负整数值不同，对于一个补码，您必须翻转位，对于二进制补码，保留翻转的位并添加 1 位以将负位变为绝对整数。

我还在学习，一年级计算机科学专业的学生，​​希望它有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T16:21:13.783

不，正数的 2 的补码不是同一个数，它们不会以 2 的补码形式存储在内存中。在正数的情况下，它们按原样存储在内存中，只有在负数的情况下，才以 2 的补码形式表示负数以 2 的补码形式存储，因为 2 的补码有利于减法。示例：5 + -7 = -2 这里 -7 以 2 的补码形式 (1001) 存储。0101 + 1001 = 1110 请注意，我们自动得到否定答案

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-27T15:37:53.730

这是真的。如果我们不将 1 添加到负数表示中，我们将得到值 0 和 -0，这有点浪费。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-17T05:41:11.820

您可以使用[它](http://escumalha.com/Binary.html "这")来检查数字在二元组中的表示方式。

# sql - 如何中止在触发器中插入多行

> ID：794064
> 
> 赞同：4
> 
> 时间：2009-04-27T15:31:55.337
> 
> 标签：sql, sql-server, sql-server-2005

使用 sql Server 2005。我已经声明了一个触发 "AFTER INSERT, UPDATE" 的触发器，在这个触发器中，我使用 WHILE 和 CURSOR 循环插入表的行。当我发现一行不满足特定条件时：

我希望触发器引发错误并且不插入任何触发触发器的行（即使是那些已经满足我的条件的行）。<--- 我不知道该怎么做！

您能告诉我如何提高错误并防止插入吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-27T15:35:41.177

使用回滚

```
IF <some condition>
BEGIN
   RAISERROR ('condition doesn't satisfy something', 16, 1)
   ROLLBACK TRANSACTION
END 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-27T18:08:17.910

我不确定您在该游标循环中执行什么逻辑，但**如果可能的话，请**尝试用查询替换游标循环：

```
if exists (select PK from INSERTED where .....)
BEGIN
    --from @SQLMenace's answer
    RAISERROR ('condition doesn't satisfy something', 16, 1)
    ROLLBACK TRANSACTION

END 
```

触发器中的光标给我一种不好的感觉：锁定，阻塞和缓慢浮现在脑海......

# asp.net - 我的 Lucene 文档中应该包含哪些内容？

> ID：794079
> 
> 赞同：1
> 
> 时间：2009-04-27T15:34:43.317
> 
> 标签：asp.net, lucene, lucene.net

我使用[Lucene.net](http://incubator.apache.org/lucene.net/)在我们的 CMS 上索引内容和文档等。到目前为止效果很好，但现在我必须考虑到网页的以下添加：

1.  发布日期
2.  到期日
3.  页面“处于活动状态”
4.  用户授权

因此，搜索结果应该只显示发布/到期窗口内的页面，这些页面是“活动的”并且当前用户有权查看。

我应该在 Lucene 索引中包含上述信息吗？它会使查询变得更复杂一些，但 hits 集合只会返回“有效”文档，这将使分页结果更容易。

另一方面，我将重复 CMS 数据库中已经存在的信息，因此我将冒着数据完整性的风险，并且每当上述列表中的任何内容发生更改时，我都会更新索引以及实际内容本身。

还有其他人有这个问题吗？你是怎么解决的？谢谢。

**编辑：**我可能需要使用“FieldCache”（[此处](http://www.lucenetutorial.com/techniques/permission-filtering.html)提到）将“有效”文档 ID 传递给 lucene 搜索？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T17:58:14.267

首先查询 CMS 数据库，并使用所有匹配的文档构建一个 BitSet（您需要一个 FieldCache 来在您的应用程序的文档 ID 与 Lucene 的内部文档 ID 之间进行转换）。然后，您可以使用过滤器（包装 BitSet）对索引运行 Lucene 查询。

您将所有可变数据保存在数据库中（它所属的位置），您不必担心更新或重建索引。这也将运行得非常快。

PS 我只使用了 Lucene 的 Java 版本，但这在 Lucene.NET 中应该可以正常工作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T15:58:58.657

> ..所以搜索结果应该只显示发布/到期窗口内的页面，是“活动的”并且当前用户有权查看。

有几种方法可以处理授权问题。您可以维护多个索引（每个权限级别一个），使用查询过滤结果（通过存储所需的权限）或在显示结果之前过滤结果。如果只有几个级别，我认为我会维护单独的索引 - 这似乎是最安全的。

至于“处于活动状态” - 你能记住这一点来重建你的索引吗？只需经常在后台重建您的索引，并且只添加活动内容。您可能有太多信息无法实现这一点 - 但 Lucene 非常快。

# interop - 如何避免建造围墙花园？

> ID：794081
> 
> 赞同：4
> 
> 时间：2009-04-27T15:34:56.547
> 
> 标签：interop

我和一些朋友有了一个网站的想法，并开始着手制作它。它将依赖于为共享知识库做出贡献的人，并且人们还将能够创建具有合理数据量的个人资料。我们希望人们在我们的网站上建立他们的个人资料时应该能够利用他们在其他网站（例如：flickr、youtube）上的内容。

我们突然想到，我们想成为优秀的互联网公民，让我们的网站对人们来说是可访问和有用的，无论他们是否有帐户。我们还希望确保人们为我们网站贡献的任何数据都不会被“锁定”，并且可以适当地用于其他网站。

是否有任何我们应该遵循的特定做法，以及我们应该避免的类似做法？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T15:40:00.293

您应该考虑将特定许可证附加到您网站上的内容。例如，StackOverflow 对提供的所有内容使用[知识共享](http://creativecommons.org/licenses/by-sa/2.5/)署名-相同方式共享许可。根据您希望对网站内容的使用施加什么限制，您应该调查类似的事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-27T15:41:23.067

我建议您按照这个站点的示例进行操作。

对非匿名帐户/登录使用 OpenID，但允许匿名发布。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-27T15:46:41.213

您可以使用[OpenID](http://openid.net/)进行身份验证。如果您正在处理的数据类型存在此类标准，我建议您提供以开放标准导出数据的选项。例如，如果您有任何类型的新闻或事件提要，则为这些提要提供[RSS](http://en.wikipedia.org/wiki/RSS_(file_format))提要。如果您正在使用的数据不存在标准，那么为您的客户提供一种以合理格式获取数据的好方法；最好是[REST](http://en.wikipedia.org/wiki/Representational_State_Transfer)风格的 API，其数据以合理的序列化形式（如[XML](http://en.wikipedia.org/wiki/XML)或[JSON](http://www.json.org/)）。

# django - 如何在没有输入字段的情况下将数据存储在 Django 模型中

> ID：794088
> 
> 赞同：2
> 
> 时间：2009-04-27T15:37:11.143
> 
> 标签：django, django-models, django-admin, django-forms

我有这样的模型：

```
class Meeting(models.Model):
    date = models.DateTimeField(default=datetime.datetime.now)
    team = models.CharField(max_length=100)

    class Meta:
        verbose_name_plural = u'Meetings'
        ordering = ['-date', 'team']

    def __unicode__(self):
        return u'%s %s' % (self.date, self.team)

class Entry(models.Model):
    meeting = models.ForeignKey(Meeting, blank=True)
    meeting_date = models.DateField(null=True)
    description = models.TextField()

    class Meta:
        verbose_name_plural = u'Entries'

    def __unicode__(self):
        return self.title 
```

我有一个表格，我用它来控制输入

```
class MyEntryAdminForm(forms.ModelForm):
class Meta:
    model = Entry 
```

我正在获取会议字段的数据

```
meeting = forms.ModelChoiceField(queryset=Meeting.objects.all(), empty_label=None) 
```

我想提取会议字段的日期部分（我能够管理它）。此日期部分应该是 meeting_date 字段的输入。meeting_date 字段在表单中没有输入字段，应自动填充。我不知道如何将此日期提取到 meeting_date 字段以及如何存储它

def clean(self) 中的尝试

```
cleaned_data['meeting_date'] = date_extract_from_meeting 
```

不工作

非常感谢任何帮助

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-27T15:55:28.087

可能有一种方法可以覆盖表单 save() 方法并在该步骤中输入日期，但我找不到任何这样做的示例。

我知道肯定会起作用的一种方法是将 commit=False 传递给 form.save （这样实际的数据库插入还没有发生）：

```
instance = form.save(commit=False) 
```

然后您可以设置会议日期并保存对象：

```
instance.meeting_date = instance.meeting.date
instance.save() 
```

希望这可以帮助。

# c# - 我可以在没有 IIS 7 集成模式的情况下生活吗？

> ID：794094
> 
> 赞同：1
> 
> 时间：2009-04-27T15:38:00.173
> 
> 标签：c#, asp.net, iis-7

我想知道不适应它的陷阱是什么，因为我面临着集成模式的许多问题。例如 URLRewritng.net 没有以集成模式解析阿拉伯语查询字符串，以及许多其他问题。

更好的问题是他们能够将两者从 web.config 结合起来，我的意思是让一些 HTTP 处理程序和模块以适合它的模式运行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T15:55:07.900

IIS7 的集成模式的主要优势似乎是将本机 .NET 集成到 HTTP 请求/响应管道中。

本机集成使您可以访问每个请求，甚至是静态文件，并且不需要在服务器本身上进行配置，只需在配置文件中进行设置，这使得共享托管更容易。

在 IIS6 中，可以通过使用通配符映射 (*) 将 .NET 集成到管道中，这基本上为您提供了 IIS7 集成模式的大部分优点，尽管有人说通配符映射会降低性能，但似乎没有人有具体的数字和**[这个 SO question 实际上表明性能根本没有受到影响。](https://stackoverflow.com/questions/323325/iis-6-0-wildcard-mapping-benchmarks)**

我认为仅仅为了支持集成模式、坚持经典模式并在必要时打开通配符映射而更改代码是不值得的。

# sql-server - SQL - 使用命名实例连接到链接服务器

> ID：794095
> 
> 赞同：3
> 
> 时间：2009-04-27T15:38:08.457
> 
> 标签：sql-server, linked-server, named-instance

如何连接到链接 SQL 服务器的命名实例。

如果它没有链接，我会执行以下操作：

```
ServerName.DatabaseName.dbo.TableName 
```

如果它是链接的，我会假设以下内容：

```
ServerName\InstanceName.DatabaseName.dbo.TableName 
```

但 SQL 不喜欢“\”

什么是正确的语法

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-27T15:39:23.960

检查[这个](https://stackoverflow.com/questions/793827/how-to-get-the-data-from-linked-servers-using-queries/793836#793836)

您可以用括号括起服务器名称

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-29T15:48:31.380

正确的语法是`[ServerName\InstanceName].DatabaseName.dbo.TableName`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-01T20:14:00.910

如果您使用的是默认实例，则无需指定实例名称。

使用默认实例的示例：[MyServer].[MyDatabase].[MySchema].[MyTable]

注意：如果您不知道您的架构名称，请尝试 [dbo]，因为这是默认架构。

所以像这样的东西应该适合你

```
SELECT *
FROM [MyTable] t
INNER JOIN [MyLinkedServer].[MyLinkedDatabase].[MyLinkedSchema].[MyLinkedTable] lt ON lt.Id = t.Id 
```

# c# - 异步服务器端 TCP/IP

> ID：794109
> 
> 赞同：0
> 
> 时间：2009-04-27T15:41:51.100
> 
> 标签：c#, tcp

我在 msdn 看到了创建 TCP 服务器所需的内容，但代码中缺少部分。

[>这里是<](http://msdn.microsoft.com/en-us/library/6y709t3b.aspx)文章，这里是代码：

```
// This server waits for a connection and then uses asynchronous operations to
// accept the connection with initial data sent from the client.

// Establish the local endpoint for the socket.

IPHostEntry ipHostInfo = Dns.GetHostEntry(Dns.GetHostName());
IPAddress ipAddress = ipHostInfo.AddressList[0];
IPEndPoint localEndPoint = new IPEndPoint(ipAddress, 11000);

// Create a TCP/IP socket.
Socket listener = new Socket(AddressFamily.InterNetwork,
    SocketType.Stream, ProtocolType.Tcp );

// Bind the socket to the local endpoint, and listen for incoming connections.
listener.Bind(localEndPoint);
listener.Listen(100);

while (true) 
{
    // Set the event to nonsignaled state.
    allDone.Reset();

    // Start an asynchronous socket to listen for connections and receive data from the client.
    Console.WriteLine("Waiting for a connection...");

    // Accept the connection and receive the first 10 bytes of data. 
    // BeginAccept() creates the accepted socket.
    int receivedDataSize = 10;
    listener.BeginAccept(null, receivedDataSize, new AsyncCallback(AcceptReceiveDataCallback), listener);

    // Wait until a connection is made and processed before continuing.
    allDone.WaitOne();
}
}

public static void AcceptReceiveDataCallback(IAsyncResult ar) 
{
// Get the socket that handles the client request.
Socket listener = (Socket) ar.AsyncState;

// End the operation and display the received data on the console.
byte[] Buffer;
int bytesTransferred;
Socket handler = listener.EndAccept(out Buffer, out bytesTransferred, ar);
string stringTransferred = Encoding.ASCII.GetString(Buffer, 0, bytesTransferred);

Console.WriteLine(stringTransferred);
Console.WriteLine("Size of data transferred is {0}", bytesTransferred);

// Create the state object for the asynchronous receive.
StateObject state = new StateObject();
state.workSocket = handler;
handler.BeginReceive( state.buffer, 0, StateObject.BufferSize, 0,
new AsyncCallback(ReadCallback), state);
} 
```

“event allDone”不见了，我该如何做一个类似的，让它等待连接？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T15:44:03.717

allDone 是一个 ManualResetEvent。

请参阅[http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)

-Oisin

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T11:56:08.590

ManualResetEvent类型与事件（如控件上的 Click 事件）无关[。](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)他们都碰巧在名字中有“事件”这个词。

请参阅[异步服务器套接字示例](http://msdn.microsoft.com/en-us/library/fx6588te.aspx)。

# wpf - 您如何在大型项目中组织 WPF 资源？

> ID：794113
> 
> 赞同：16
> 
> 时间：2009-04-27T15:43:57.537
> 
> 标签：wpf, xaml, resources

即使在我一直在做的最小的 WPF 示例和原型上，**它也`<Windows.Resources>`开始快速膨胀**。将其放回`app.xaml`我的 Windows 和 UserControls 之外，但**很难组织**（Visual Studio“XAML 折叠”功能没有帮助，因为您只有一个充满“样式...”一词的页面）。

此外，我正在努力寻找一种易于记忆且有条理的方式来**命名我的风格**。我发现它的最佳方式是冗长且具有描述性，所以我得到这样的东西：BottomMainLeftScrollViewerStyle 等。但这有其局限性，很快也会让人困惑。我决定使用**camelCase 作为样式名称**，以便在 XAML 的页面和页面中轻松发现它们。

**防止 WPF 资源变得笨拙**的策略是什么？****

 **```
<Window.Resources>

    <local:CutOffConverter x:Key="AgeConverter" Cutoff="30"/>

    <Style TargetType="Grid" x:Key="customerGridMainStyle">
        <Setter Property="Background">
            <Setter.Value>
                <LinearGradientBrush StartPoint="0,0" EndPoint=".5,.5">
                    <GradientStop Offset="0.0" Color="#888"/>
                    <GradientStop Offset="1.0" Color="#ccc"/>
                </LinearGradientBrush>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="StackPanel" x:Key="mainStackPanelStyle">
        <Setter Property="HorizontalAlignment" Value="Left"/>
    </Style>
    <Style TargetType="ScrollViewer" x:Key="mainScrollViewerStyle">
        <Setter Property="Height" Value="250"/>
    </Style>
    <Style TargetType="ListBox" x:Key="mainListBoxStyle">
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="Margin" Value="10"/>
    </Style>

    <ObjectDataProvider x:Key="customers"
                        ObjectType="{x:Type local:Customer}"
                        MethodName="GetAllCustomers"/>

    <DataTemplate DataType="{x:Type local:Customer}">
        <Grid x:Name="MainGrid" Style="{StaticResource customerGridMainStyle}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="150"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition/>
                <RowDefinition/>
                <RowDefinition/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Column="0" Grid.Row="0" Text="First Name" Margin="5"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding FirstName}" Margin="5"/>
            <TextBlock Grid.Column="0" Grid.Row="1" Text="Last Name" Margin="5"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding LastName}" Margin="5"/>
            <TextBlock Grid.Column="0" Grid.Row="2" Text="Age" Margin="5"/>
            <TextBlock x:Name="Age" Grid.Column="1" Grid.Row="2" Text="{Binding Age}" Margin="5"/>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding Path=Age, Converter={StaticResource AgeConverter}}">
                <DataTrigger.Value>true</DataTrigger.Value>
                <Setter TargetName="Age" Property="Foreground" Value="Red"/> 
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>
</Window.Resources> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-27T15:49:23.110

使用单独`ResourceDictionary`的 s 并根据需要将它们合并到可视树中的适当级别。

```
<App ...>
    <App.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="ListBoxResources.xaml"/>
                <ResourceDictionary Source="ComboBoxResources.xaml"/>
                <ResourceDictionary Source="LabelResources.xaml"/>
                <ResourceDictionary Source="TextBoxResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <!-- if you have local resources, place them here.
                (as noted by Mark Synowiec in the comments)
             -->
        </ResourceDictionary>
    </App.Resources>
</App> 
```

# c# - 深拷贝 System.Windows.Forms.WebBrowser 对象/恢复状态

> ID：794117
> 
> 赞同：2
> 
> 时间：2009-04-27T15:44:14.183
> 
> 标签：c#, .net, vb.net, browser, deep-copy

本质上，我想要做的是复制一个 WebBrowser 对象，这样我就可以执行相当于“在新选项卡中打开”或“在新窗口中打开”操作，维护任何已发布的数据。我不只是想导航到与原始 WebBrowser 对象相同的 URL，而是想重复 HttpWebRequest。这可能吗？如何？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-06-03T15:44:03.667

我相信 WebBrowser 对象是一个控件，因此它有一个窗口句柄，如果您尝试克隆它会导致问题。我不认为你会得到你想要的行为。

# mysql - Mysql：在选择中设置变量

> ID：794124
> 
> 赞同：1
> 
> 时间：2009-04-27T15:46:15.737
> 
> 标签：mysql

鉴于我的两个数据库表别名和订阅者有这样的条目：

```
aliases.username    = '5551234567'  
aliases.contact     = 'sip:a_sip_username@sip.domain.com'  
subscriber.username = 'a_sip_username' 
```

我只想选择在 aliases.contact 字段中具有subscriber.username 的匹配行。这是我的第一次尝试，但它没有返回任何内容：

`SELECT
aliases.username as phone_number,
(@B:=subscriber.username) as user_name
FROM aliases,subscriber
WHERE aliases.contact regexp "^sip:@B[.*]"` 

这甚至可能还是我应该将逻辑移至应用程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T15:49:22.720

```
SELECT  aliases.username AS phone_number,
        subscriber.username AS user_name
FROM    aliases, subscriber
WHERE   aliases.contact REGEXP CONCAT('^sip:', subscriber.user_name, '[.*]') 
```

请注意，以下查询将更有效：

```
SELECT  aliases.username AS phone_number,
        subscriber.username AS user_name
FROM    aliases, subscriber
WHERE   aliases.contact LIKE CONCAT('sip:', subscriber.user_name, '%') 
```

，而这个虽然看起来很复杂，但效率更高：

```
CREATE FUNCTION fn_get_next_subscriber(initial VARCHAR(200)) RETURNS VARCHAR(200)
NOT DETERMINISTIC
READS SQL DATA
BEGIN
        DECLARE _username VARCHAR(200);
        DECLARE EXIT HANDLER FOR NOT FOUND RETURN UNHEX('FFFF');
        SELECT  username
        INTO    _username
        FROM    subscribers
        WHERE   username>= initial
                AND username NOT LIKE CONCAT(initial, '%')
        ORDER BY
                username
        LIMIT 1;
        RETURN _username;
END

SELECT  a.username AS phone_number,
        s.username AS user_name
FROM    (
        SELECT  si.*, CONCAT('sip:', username) AS fromcontact
        FROM    subscriber si
        ) s, aliases a
WHERE   a.contact >= fromcontact
        AND a.contact < fn_get_next_subscriber(fromcontact) 
```

这将使用索引`aliases (contact)`并避免全表扫描。

请参阅我的博客中的这篇文章：

*   **[文章感知标题过滤：国际化](http://explainextended.com/2009/03/24/article-aware-title-filtering-internationalization/)**：如何`JOIN`在`LIKE`条件下

# php - 缩短 Zend 框架路由定义

> ID：794126
> 
> 赞同：11
> 
> 时间：2009-04-27T15:46:32.413
> 
> 标签：php, zend-framework, routes

如何缩短 Zend Framework 中自定义路由的定义？我目前有这个定义：

```
$route = new Zend_Controller_Router_Route(
    ":module/:id",
    array(
        "controller" => "index",
        "action" => "index" 
    ),
    array("id" => "\d+")
);
self::$frontController->getRouter()->addRoute('shortcutOne', $route);

$route = new Zend_Controller_Router_Route(
    ":module/:controller/:id",
    array("action" => "index"),
    array("id" => "\d+")
);
self::$frontController->getRouter()->addRoute('shortcutTwo', $route);

$route = new Zend_Controller_Router_Route(
    ":module/:controller/:action/:id",
    null,
    array("id" => "\d+")
);
self::$frontController->getRouter()->addRoute('shortcutThree', $route); 
```

有没有办法更好地结合这些规则？你在哪里放置这些的最佳实践是什么？我目前在前端控制器初始化后将它们放在我的引导类中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-06-03T19:45:43.813

我的 routes.ini 文件开始变得非常大，所以我决定在路由解析后使用 Zend Caching 来缓存它们。我使用 Xcache 作为后端缓存解决方案。这是代码，应该放在 Bootstrap.php 文件中：

```
受保护的函数 _initRoutes()
{
  $backendType = 'Xcache';
  $backendOptions = 数组（）；

  // 实例化一个缓存对象来缓存路由
  $cache = Zend_Cache::factory('File', $backendType,
    大批（
      '自动序列化' => 真，
      'master_files'=>array(APPLICATION_PATH . '/configs/routes.ini')
    ),
    $backendOptions
  );

  $frontController = Zend_Controller_Front::getInstance();        

  if(!$router = $cache->load('router')) {

    // 加载 .ini 文件并将结果放入缓存
    $routes = new Zend_Config_Ini (APPLICATION_PATH . '/configs/routes.ini', 'production');            
    $router = $frontController->getRouter();
    $router->addConfig( $routes, 'routes' );

    $cache->save($router, '路由器');
  }     
  别的 {        
    // 使用缓存版本
    $frontController->setRouter($router);
  }

}

```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-10-13T08:28:11.267

我更喜欢使用 *.ini 文件而不是 XML，尤其是在使用 Zend 时，因为它更类似于 Zend，而且更轻量级和紧凑。这是一个几乎相似的配置，使用`Zend_Config_Ini()`.

**应用程序.ini**

```
[routes]
routes.shortcutone.route=:module/:id
routes.shortcutone.defaults.controller=index
routes.shortcutone.defaults.action=index
routes.shortcutone.reqs=\d+ 
```

**引导程序.php**

```
$config = new Zend_Config_Ini('application.ini', 'routes');
$router = Zend_Controller_Front::getInstance()->getRouter();
$router->addConfig($config, 'routes'); 
```

请注意，文件中的`[routes]`部分`application.ini`可以重命名。并且当它被重命名时，第二个参数`Zend_Config_Ini()`应该反映新的节标题。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-05T11:41:56.867

在设置这样的路线时，我使用配置文件。作为偏好，我使用 XML 来存储我的配置数据，但是这些也可以很容易地以另一种支持的格式存储。然后，我将配置中的路由添加到引导程序中的路由器。

**配置：**

```
<config>
    <routes>
        <shortcutone  type="Zend_Controller_Router_Route">
            <route>:module/:id</route>
            <defaults>
                <controller>index</controller>
                <action>index</action>
            </defaults>
            <reqs id="\d+">
        </shortcutone>
        <shortcuttwo  type="Zend_Controller_Router_Route">
            <route>:module/:controller/:id</route>
            <defaults>
                <controller>index</controller>
            </defaults>
            <reqs id="\d+">
        </shortcuttwo>
        <shortcutthree  type="Zend_Controller_Router_Route">
            <route>:module/:controller/:action/:id</route>
            <defaults>
                <controller>index</controller>
                <action>index</action>
            </defaults>
            <reqs id="\d+">
        </shortcutthree>
    </routes>
</config> 
```

**引导程序**

```
$config = new Zend_Config_Xml('config.xml');
$router = Zend_Controller_Front::getInstance()->getRouter();
$router->addConfig($config, 'routes'); 
```

显然，还有其他选项，我鼓励您阅读有关此的[文档](http://framework.zend.com/manual/en/zend.controller.router.html)，但是，这适合您的示例。

# c# - 通过引用传递 IDisposable 对象会导致错误？

> ID：794128
> 
> 赞同：3
> 
> 时间：2009-04-27T15:47:24.300
> 
> 标签：c#, dispose, idisposable, pass-by-reference

我正在尝试创建一个通用方法来处理实现[IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable(loband).aspx)的对象，称为`DisposeObject()`

为了确保我正在处理由原始引用指向的对象，我试图通过引用传递一个对象。

但我收到一个编译错误，上面写着

> 'ref' 参数类型与参数类型不匹配

在下面的（简化的）代码中，两者都`_Baz`实现`_Bar`了[IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable(loband).aspx)。

![替代文字](https://farm4.static.flickr.com/3576/3479637489_d92cf9f406_o.png)

所以问题是，

1.  为什么我会收到此错误？
2.  有没有办法绕过它？

**[更新]** 从目前提供的答案来看，只要我不将 IDisposable 参数设置为 null，我就可以简单地按值传递对象，而无需使用`ref`. 我现在遇到了另一个麻烦，是否`null`在`DisposeObject`方法内设置一次性对象。

以下是完整性的完整来源：

```
public class Foo : IDisposable
{
    private Bar _Bar;
    private Baz _Baz;
    private bool _IsDisposed;

    ~Foo() { Dispose(false); }

    public void Dispose(bool disposing)
    {
        if (!_IsDisposed)
        {
            if (disposing)
            {
                DisposeObject(ref _Baz);
                DisposeObject(ref _Bar);
            }
        }

        _IsDisposed = true;
    }

    private void DisposeObject(ref IDisposable obj)
    {
        try
        {
            if (obj == null) 
                return;
            obj.Dispose();
            obj = null;
        } catch (ObjectDisposedException) { /* Already Disposed... */ }
    }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }
}

public class Bar : IDisposable
{
    public void Dispose() {}
}

public class Baz : IDisposable
{
    public void Dispose() {}
} 
```

**[结果]**
我删除了将参数设置为 null ( `obj = null;`)的代码，`DisposeObject` 所以最终的代码变成了。

```
 public void Dispose(bool disposing)
    {
        if (!_IsDisposed)
        {
            if (disposing)
            {
                DisposeObject(_Baz);
                DisposeObject(_Bar);
            }
        }

        _IsDisposed = true;
    }

    private void DisposeObject(IDisposable obj)
    {
        try
        {
            if (obj == null) 
                return;
            obj.Dispose();
        } catch (ObjectDisposedException) { /* Already Disposed... */ }
    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-27T16:24:21.950

这是您的示例的一个选项（现在无法针对编译器进行验证，但您会明白的）：

```
private void DisposeObject<T>(ref T obj) where T : IDisposable
{
    // same implementation
} 
```

要调用它，请使用

```
DisposeObject<Baz>(ref _Baz);
DisposeObject<Bar>(ref _Bar); 
```

正如其他评论中所指出的，您得到的编译器错误有其自身的目的（防止您在方法中分配其他类型的 IDisposable，从而导致状态不一致）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-27T15:50:40.640

试试这个：

```
IDisposable d = (IDisposable)_Baz;
DisposeObject(ref d); 
```

**编辑**：正如亚当指出的那样，您的代码不需要这是参考。对象总是作为引用传递。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-27T15:55:18.337

您无需通过引用传递，因为您正在传递引用类型。您应该`ref`从方法定义中删除关键字。这样做，你不应该有任何问题，虽然我不确定这比简单调用更有效或更清晰`Dispose()`（除了你不必为显式实现强制转换它并且这会`null`检查你）。

**编辑**

跳舞，虽然我希望围绕这个主题的讨论对您有所帮助，但您的初衷似乎并不可行。为了传递一些 as `ref`，你不能传递一个类型不是`ref`参数期望的类型的变量（换句话说，你不能传递一个声明为 a`class`或其他`interface`实现的变量，`IDisposable`如果`ref`参数是`IDisposable`）。因为`ref`参数允许赋值传播回调用者，您将打开允许不兼容类型存储在变量中的可能性。

`null`如果这是你想要的，你最好的选择是分配自己。如果您想将`null`检查和忽略异常封装到函数中，那很好，但`ref`不幸的是，无论您如何切片，在这种情况下都不会为您工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-27T15:51:09.347

这种方法闻起来很有趣，但我暂时忽略它。

要解决您的问题，您需要使用“（IDisposable）”转换您传递的对象

我承认编译器和 Jon Skeet 的意愿。为此，您需要一个实际对象：

```
IDisposable _BazD = (IDisposable)_Baz;
DisposeObject(ref _BazD); 
```

~~除了 try/catch 之外，我还会在 DisposeObject() 中添加一个空检查。与昂贵的异常捕获相比，“obj==null”将是一种快速简便的检查，如果同一对象多次命中该异常捕获。~~ 嗯……那是一分钟前吗？没关系。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-13T19:42:41.387

谢谢 Dan C。我还没有足够的代表来添加评论，所以我必须添加这个作为答案。但是，此解决方案完全归功于 Dan C。

这是工作代码：

```
public override void Dispose()
{
    base.Dispose();

    DisposeOf<UserTableAdapter>(ref userAdapter);
    DisposeOf<ProductsTableAdapter>(ref productsAdapter);

    if (connection != null)
    {
        if (connection.State == ConnectionState.Open)
        {
            connection.Close();
        }
        DisposeOf<SqlConnection>(ref connection);
    }
}

private void DisposeOf<T>(ref T objectToDispose) where T : IDisposable
{
    if (objectToDispose != null)
    {
        objectToDispose.Dispose();
        objectToDispose = default(T);
    }
} 
```

# jquery - 如果不使用 cassini 在 ASP.NET MVC 中发布 jQuery 帖子，则无法成功发布

> ID：794130
> 
> 赞同：1
> 
> 时间：2009-04-27T15:47:40.617
> 
> 标签：jquery, asp.net-mvc, post

当我将项目设置为使用 Visual Studio 开发服务器 (Cassini:Port) 启动应用程序时，我的 jQuery 正确发布到以下 URL

“一些控制器/一些方法”。

当我使用 localhost 运行以下 URL 时，它不起作用

“ [http://localhost/Store/SomeController/SomeMethod](http://localhost/Store/SomeController/SomeMethod) ”或“SomeController/SomeMethod”。

有人遇到这种问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T16:00:01.227

尝试使用 Url.Action 映射 URL，以便无论虚拟根是什么，它们都是正确的。

```
$.post( '<%= Url.Action( "SomeMethod", "SomeController" ) %>'
        data,
        function() { ...callback.. },
        'json' ); 
```

如果这仍然不起作用，那么我们可能需要查看您的路由设置。了解 ActionLinks 是否有效但 jQuery AJAX 无效也会很有帮助。如果是这种情况并且 URL 相同，那么您的 Javascript 文件可能没有正确的 url。在这种情况下，您需要使用 Url.Content 来映射这些 URL，以便它们始终正确。

```
<script type="text/javascript"
       src='<%= Url.Content( "~/Scripts/jquery-1.3.2.js' ) %>'>
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T15:53:19.433

您可以在 iis yourapp.com 和 [WindoewsRoot]\System32\drivers\etc\host 添加第 127.0.0.1 yourapp.com 行，现在您可以在此 URL [http://yourapp.com/testpage/上测试您的应用程序](http://yourapp.com/testpage/)

# python - 返回一个对象与返回一个元组

> ID：794132
> 
> 赞同：11
> 
> 时间：2009-04-27T15:48:48.743
> 
> 标签：python

我正在用python开发一个可以读写文件的文件类，其中包含xyz坐标列表。在我的程序中，我已经有一个 Coord3D 类来保存 xyz 坐标。

我的问题与 getCoordinate(index) 方法的设计有关。我应该返回一个浮点元组还是一个 Coord3D 对象？

在第一种情况下，我得到非常低的耦合，但是我可能不得不用获得的值实例化一个 Coord3D 对象，尽管在文件类之外。在第二种情况下，我将文件类与 Coord3D 类紧密耦合。

请注意，我认为这两种解决方案之间没有太大区别，但我想阅读您的答案及其背后的原因。

* * *

**编辑**：回顾一下我到目前为止得到的答案，看起来没有明确的选择。有人说（恰当地）python不是Java，你不需要一个专门的类来处理所有事情，因为你需要它的语言架构。但是，就我而言，我有以下条件：

1.  我正在开发一个库，其中 Coord3D 对象按原样使用。使用它会增加我的库的凝聚力，因为数据类型将被统一使用。
2.  Coord3D 对象具有状态和行为。实际上，Coord3D 对象将坐标和单位聚合在一个实体中。Coord3D 对象之间的操作将考虑潜在的不同单元，并相应地采取行动。
3.  我可以将集中控制代码放入 Coord3D 类实例化中以拒绝，例如长度为 4 的数组或非单位的数组。如果我使用元组，则无法执行此检查。此外，如果一个方法接受 Coord3D，则可以保证它预先形成良好的格式（您可以大胆并检查 isinstance，或检查接口）。元组可以包含无效数据。尽管在出现问题的地方使用了 python 的错误处理方法，但是阻止我使用由三个字符串组成的 xyz 坐标的类在某种程度上是有益的（如果错了，请纠正我）

另一方面，使用元组具有以下优点：

1.  占用资源少，在巨量的情况下相当关键
2.  更简单的设计。更多的类意味着更复杂的设计。元组是一种标准数据类型，易于理解并且可以轻松解包。个性化的课程不是。
3.  使用元组，XYZFile 类与库的其余部分完全分离（因为它不使用 Coord3D 对象）。这意味着它可以作为一个独立的实体完全重复使用。

进一步的评论非常欢迎！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-28T00:34:52.223

妥协的解决方案：而不是类，使 Coord3D a[`namedtuple`](http://docs.python.org/library/collections.html#namedtuple-factory-function-for-tuples-with-named-fields)并返回:-)

用法：

```
Coord3D = namedtuple('Coord3D', 'x y z')

def getCoordinate(index):
    # do stuff, creating variables x, y, z
    return Coord3D(x, y, z) 
```

返回值可以完全用作元组，并且具有相同的速度和内存属性，因此您不会失去任何通用性。但是您也可以通过名称访问它的值：如果`c`是 的结果`getCoordinate(index)`，那么您可以使用`c.x`,`c.y`等来提高可读性。

（很明显，如果您的 Coord3D 类也需要其他功能，这将不太有用）

[如果你不在 python2.6 上，你可以从[食谱](http://code.activestate.com/recipes/500261/)中获取 namedtuples ]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T16:03:08.710

如果其他人（除了你自己）将使用这个类，在我看来，返回一个对象会鼓励数据类型的某种一致性。如果 Coord3D 类有一个方法或属性可以将这些坐标作为一个元组访问，那么如果他们需要它，那仍然会为他们提供该选项：

```
# get the object
coord_obj = my_obj.getCoordinate(my_index)
# get the tuple (for example, via a property named "coords")
coord_tup = my_obj.getCoordinate(my_index).coords 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-27T16:07:25.967

更基本的问题是“为什么你有 Coord3D 类？” 为什么不只使用一个元组？

我们大多数人对 Python n00bz 的一般建议是“在非必要之前不要发明新类”。

你的 Coord3D 有独特的方法吗？也许你需要一门新课。或者——也许——你只需要一些对元组进行操作的函数。

你的 Coord3D 有可变状态吗？几乎不可能。不可变元组开始看起来比新类更好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-28T18:47:51.893

看看 Will McGugan 的[Gameobjects 库](http://code.google.com/p/gameobjects/)。他有一个[Vector3 类](http://code.google.com/p/gameobjects/source/browse/trunk/vector3.py)，可以用另一个 Vector3 对象、一个元组、单个浮点值等进行初始化。我想这会回答你的问题......另外你可能最终只使用他的库，因为它已经优化并且有很多已经有用的方法了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T15:55:11.740

如果它只用于您的应用程序，并且`Coord3D`无论如何您要使用这些值创建一个实例，我只会返回一个`Coord3D`实例以节省您的工作量。但是，如果您有兴趣使这个可移植/通用，请返回一个元组。`Coord3D`无论如何，使用它很容易创建

```
c3d = Coord3D(*getCoordinate(index)) 
```

（假设你的构造函数是`Coord3D.__init__(self, x, y, z)`）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-27T15:55:40.147

我问过自己同样的问题，尽管是在做 2D 几何的时候。

我为自己找到的答案是，如果我打算编写一个更大的库，具有更多功能等等，请继续返回 Point，或者在你的情况下返回 Coord3D 对象。如果它只是一个 hacky 实现，那么元组会让你走得更快。最后，这就是你要用它做的事情，是否值得付出努力。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-27T16:09:14.763

返回一个对象将是最佳实践，并会为您提供更好的整体软件设计。我建议这样做

但是，请记住，创建/返回对象将花费更多的处理时间。如果您经常执行此操作，它可能会改变一些东西，在这种情况下，您可能需要考虑一下......

# iphone - 如何设置 CMake 为 iPhone 构建库

> ID：794137
> 
> 赞同：9
> 
> 时间：2009-04-27T15:50:13.263
> 
> 标签：iphone, xcode, cmake

我正在尝试使用 CMake 通过手动设置某些属性来为 iPhone 生成 Xcode 配置。（这甚至是正确的方法吗？）我的 CMake 文件如下所示：

```
project(MYLIB)
set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
set(CMAKE_CONFIGURATION_TYPES Debug Release Debug-iPhone)
set(FILES list of my files...)

add_library(mylib FILES)

set(XCODE_ATTRIBUTE_SDKROOT iphoneos2.2.1)
# more attributes later, I'm just trying to get one to work first 
```

首先，这似乎不起作用 - 在生成的 Xcode 项目（我正在运行`cmake . -G Xcode`）中，`SDKROOT`仍然设置为空，因此它显示“当前 Mac OS”。

其次，假设这是正确的方法，我该如何仅为配置设置属性`Debug-iPhone`？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T20:07:25.187

据我所知，有两种方法。最有可能的，你几乎在那里，是用来`CMAKE_OSX_SYSROOT`设置 XCode SDKROOT。还有一个变量`CMAKE_OSX_ARCHITECTURES`，它映射到 XCode 中的 ARCHS。

另一种方法是使用[CMake 的交叉编译支持](http://www.cmake.org/Wiki/CMake_Cross_Compiling)。我没有将它用于 iphone，但我已经为其他 ARM 处理器使用过。您需要设置一个如下所示的工具链文件：

```
set(CMAKE_SYSTEM_NAME Generic)
set(CMAKE_SYSTEM_VERSION 1)
set(CMAKE_SYSTEM_PROCESSOR arm-elf)
set(CMAKE_C_COMPILER /path/to/complier/bin/arm-elf-gcc)
set(CMAKE_FIND_ROOT_PATH /path/to/compiler)
set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY) 
```

然后在运行 cmake 时，将`CMAKE_TOOLCHAIN_FILE`变量设置为工具链文件的名称。或者，如果您只编译到一种架构，您可以硬编码 CMakeLists.txt 文件中的值。但我想你需要为 iphone 模拟器和实际的 iphone 本身进行交叉编译，对吗？所以你会运行其中一个，可能有几个构建变体：

```
cmake -DCMAKE_TOOLCHAIN_FILE=/path/to/my/iphone-sim.cmake .
cmake -DCMAKE_TOOLCHAIN_FILE=/path/to/my/iphone-real.cmake . 
```

sim/real 文件定义模拟器或真实 iphone 编译器工具的环境。

其他一些可能有帮助的链接是[这个错误报告](http://public.kitware.com/Bug/view.php?id=8915)和[这个邮件列表对话](http://www.cmake.org/pipermail/cmake/2009-April/028695.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-03-20T21:04:44.343

此信息也可能有用：

> 这个项目提供了一个简单的 iOS 工具链文件，可以与 CMake 一起使用来构建库和设置应用程序。包括几个示例项目。

[http://code.google.com/p/ios-cmake/](http://code.google.com/p/ios-cmake/)

# domain-driven-design - 实体/值对象选择

> ID：794140
> 
> 赞同：0
> 
> 时间：2009-04-27T15:51:37.487
> 
> 标签：domain-driven-design

在领域驱动设计中，具有标识的对象是实体是常识。例如，任何人都会有多种形式的身份（姓名等）。

但是值对象是那些没有身份的对象。一个常见的值对象是地址，但是地址没有身份。但是在数据库层，我们可以有一个复合键。这个概念在 DDD 中有效吗？它将通过道路名称、邮政编码和门号的组合来识别地址（省略城镇和城市等信息）。金钱将是另一个价值对象。

区别似乎在于没有单一可识别字段的对象，而值对象往往实际上并不属于实体。例如，“我”（替换为我的名字）可能会穿鞋等，但“我”不是鞋、衬衫等（[http://www.lostechies.com/blogs/joe_ocampo/archive/2007/04/23/域驱动设计值对象.aspx 的讨论](http://www.lostechies.com/blogs/joe_ocampo/archive/2007/04/23/a-discussion-on-domain-driven-design-value-objects.aspx)）。

这是思考问题的正确方式吗？此外，通过这种心态/方法，我可以将其应用于 C# 中的值/引用类型选择。我也可以使用 DDD 方法吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T16:29:22.467

我认为您对实体和值类型之间的区别的概念是正确的，因为它们在域驱动设计中被理解（尽管我在这方面远非专家 - 也许更好地说您符合我对这些概念的理解）。但是，在选择是否将这些对象建模为 C# 中的引用或值时，我建议不要将其用作决定性指标。

值类型和引用类型之间的主要区别在于，值类型在传递给方法时会被复制。这意味着它们更有可能位于堆栈而不是堆上，并且传递的成本可能更高；因此，尺寸成为考虑的因素。建议结构的大小应小于 16 字节（在[此处](http://msdn.microsoft.com/en-us/library/ah19swz4(VS.71).aspx)注释的底部），而综合地址结构（门牌号、门牌名称、街道区域、城市、国家等...）将很容易打破这一点。

尽管如此，entity:value :: class:struct 的语义非常相似，我可以看到以这种方式建模数据的很多好处（住在同一地址的两个人在更改后不再*共享*该地址一个人的地址不应该改变另一个人的地址。因此，将地址作为结构将强制执行这种分离。而应用程序中一个人的所有实例都应该指向同一个人）。但是有性能和内存方面的考虑。也许不可变类非常适合这些值类型？

总结一下：DDD中实体和值的区别是基于对象是什么。在代码中应该基于你打算用它做什么。

# ruby-on-rails - 使用 rspec 在 ruby on rails 中测试会话装饰器库

> ID：794144
> 
> 赞同：4
> 
> 时间：2009-04-27T15:52:59.107
> 
> 标签：ruby-on-rails, rspec

我在 lib/user_session.rb 中有这段代码

我的一个控制器通过包括 UserSession 使用它。

我该如何测试它？我在 spec/lib/user_session.rb 中添加了测试，但代码依赖于我不确定如何模拟的会话。

```
module UserSession
  def viewed
    session[:viewed] ||= Array.new
    return session[:viewed]
  end

  def viewed_add(id, name)
    if viewed.select{|b| b[:id] == id}.empty?
      session[:viewed] << {:id => id, :name => name}
    end
    return session[:viewed]
  end

  def viewed_delete(id)
    unless id.nil?
      session[:viewed].delete_if{|b| b[:id] == id}
      return session[:viewed]
    end
  end
end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T12:51:53.817

据我从您的代码中可以看出，您不依赖会话，而是依赖符合括号阅读器形式的基本接口的对象。

现在，我自己不使用 RSpec，所以我不能确切地说在这种情况下如何使用它，但我会创建一个带有括号读取器实例方法的模拟类，甚至是一个哈希，然后针对该对象进行测试，例如

```
fake_session = { :viewer => nil }
class << fake_session
  include UserSession
end
assert_equal [], fake_session.viewer 
```

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-10T04:45:02.937

您需要在会话中模拟或存根 [] 运算符。例如，在您的规范中，您可以执行以下操作：

```
session.stub!(:[]).and_return "foo" 
```

或者

```
session.should_receive(:[]).with(:viewed) 
```

# sql - SQL：有效地查找来自数据库外部的许多 ID

> ID：794146
> 
> 赞同：1
> 
> 时间：2009-04-27T15:53:32.490
> 
> 标签：sql

我需要按 ID 查找数千行，但这些 ID 来自数据库外部，因此我无法从其他表中获取它们，如下所示：

> SELECT * FROM some_table WHERE ID IN (SELECT KnownID FROM some_other_table WHERE someCondition)

还有什么比这更好的吗：

> SELECT * FROM some_table WHERE ID IN ('1001', '1002', '1003', ...)

我可以参数化这样一个id的数量不固定的查询吗？还是我每次都只是将一个大字符串连接在一起？

（顺便说一句，我正在使用 sqlite，但我也对其他数据库感到好奇。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T15:55:15.810

我会用变量值创建一个临时表并做一个“ `select were in`”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T15:56:54.840

> （顺便说一句，我正在使用 sqlite，但我也对其他数据库很好奇。）

在 sql server 中，您可以拥有一个链接服务器，然后如果它位于不同的服务器上，则只需在两者之间进行连接。如果它在同一台服务器上但在不同的数据库中，那么您只需进行常规连接并在表和模式名称中添加 dbname

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T15:59:05.817

您的输入 ID 采用什么格式？

它们是由用户手动输入的吗？在文本/csv/xml 文件中？从服务中拉出来？

如果您批量获取它们，您可以将它们插入到#temp 表中，然后针对您的#temp 表进行选择...例如

```
//PSEUDO CODE
foreach(string s in ListOfIdsFromFile)
{
    //INSERT INTO #TempTable (ID) Values (ConvertToInt32(s))
} 
```

然后

```
SELECT * FROM some_table a INNER JOIN #temp_table b ON a.ID = b.ID 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T16:11:24.257

SQL Server 2008 有一个称为表值参数的功能。[见这篇文章](http://www.sqlteam.com/article/sql-server-2008-table-valued-parameters "表值参数")。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T16:12:05.473

在 SqlServer 你可以做这样的事情

```
SELECT * FROM some_table WHERE ID IN (SELECT ID1 UNION ALL SELECT ID2  UNION ALL SELECT ID3  UNION ALL SELECT ID4  UNION ALL SELECT ID4 ) 
```

# delphi - 在 Delphi 中使用 OPOS 驱动程序检查打印机消息

> ID：794162
> 
> 赞同：1
> 
> 时间：2009-04-27T15:57:08.677
> 
> 标签：delphi, point-of-sale, opos

我正在尝试使用 Delphi (BDS2006) 中的 OPOS 驱动程序打开销售点 (POS) 打印机，但不知道如何检查打印机状态。

我将如何检查来自打印机`Check Paper`的消息？`Paper Jam`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-27T17:42:55.630

我没有使用过 OPOS 驱动程序，但我已经使用 POS 驱动程序为连接到现金抽屉的爱普生收据打印机做了一些工作。我发现，如果打印机安装在 Windows 中，您可以直接打开到它的连接并让它做任何您想做的事情。

打印机这么慢的原因是它使用了 Windows 的图形字体功能。当您直接打开打印机时，您会将模式设置为 RAW，它只会像老式点阵一样发送文本。要打开钱箱，您只需将特定的控制代码发送给它，就好像您要打印它们一样。打印机在打印之前拦截代码并将抽屉打开。

顺便说一句，我不知道这将如何与 Unicode 一起使用。我只真正使用过 ASCII 数据的打印机。可能会有为国际市场设计的变体，它们的工作方式会有所不同。

这是我用来使它工作的代码（VxMsgBox 只是 MessageBox 的一个封面）：

```
{***************************************************************************}
{**             PrintDirect2Printer                                       **}
{***************************************************************************}
procedure PrintDirect2Printer(PrinterName, Data:pchar; dwByteCount:DWORD);
var PrinterHandle  : THandle;
    DocInfo        : TDocInfo1;
    dwJob          : DWORD;
    dwBytesWritten : DWORD;
begin
if not OpenPrinter(PrinterName, PrinterHandle, nil) then exit; //failed to open printer, abort
DocInfo.pDocName    := 'Direct 2 Printer';
DocInfo.pOutputFile := nil;
DocInfo.pDataType   := 'RAW';
dwJob:=StartDocPrinter(PrinterHandle, 1, @DocInfo);
if dwJob=0 then //failed to start a document
   begin
   ClosePrinter(PrinterHandle);
   exit;
   end;
if not StartPagePrinter(PrinterHandle) then
   begin
   EndDocPrinter(PrinterHandle);
   ClosePrinter(PrinterHandle);
   exit;
   end;
if not WritePrinter(PrinterHandle, Data, dwByteCount, dwBytesWritten) then
   begin
   EndPagePrinter(PrinterHandle);
   EndDocPrinter(PrinterHandle);
   ClosePrinter(PrinterHandle);
   exit;
   end;
if not EndPagePrinter(PrinterHandle) then
   begin
   EndDocPrinter(PrinterHandle);
   ClosePrinter(PrinterHandle);
   exit;
   end;
if not EndDocPrinter(PrinterHandle) then
   begin
   ClosePrinter(PrinterHandle);
   exit;
   end;
ClosePrinter(PrinterHandle);
if dwBytesWritten<>dwByteCount then
   VxMsgBox('Print Direct To Printer failed.', 'Printer Error', mb_Ok);
end;

{***************************************************************************}
{**             OpenPrintDirect2Printer                                   **}
{***************************************************************************}
function OpenPrintDirect2Printer(PrinterName, DocName:pchar; var PrinterHandle:THandle):boolean;
var DocInfo        : TDocInfo1;
    dwJob          : DWORD;
begin
result:=false;
if not OpenPrinter(PrinterName, PrinterHandle, nil) then exit; //failed to open printer, abort
DocInfo.pDocName    := DocName;
DocInfo.pOutputFile := nil;
DocInfo.pDataType   := 'RAW';
dwJob:=StartDocPrinter(PrinterHandle, 1, @DocInfo);
if dwJob=0 then //failed to start a document
   begin
   ClosePrinter(PrinterHandle);
   exit;
   end;
if not StartPagePrinter(PrinterHandle) then
   begin
   EndDocPrinter(PrinterHandle);
   ClosePrinter(PrinterHandle);
   exit;
   end;
result:=true;
end;

{***************************************************************************}
{**             WritePrintDirect2Printer                                  **}
{***************************************************************************}
function WritePrintDirect2Printer(PrinterHandle:THandle; Data:pchar; dwByteCount:DWORD):boolean;
var dwBytesWritten : DWORD;
begin
result:=true;
if not WritePrinter(PrinterHandle, Data, dwByteCount, dwBytesWritten) then
   result:=false;
if dwBytesWritten<>dwByteCount then
   VxMsgBox('WritePrintDirect2Printer byte check failed.', 'Printer Error', mb_Ok);
end;

{***************************************************************************}
{**             ClosePrintDirect2Printer                                  **}
{***************************************************************************}
procedure ClosePrintDirect2Printer(var PrinterHandle:THandle);
begin
if not EndPagePrinter(PrinterHandle) then
   begin
   EndDocPrinter(PrinterHandle);
   ClosePrinter(PrinterHandle);
   PrinterHandle:=0;
   exit;
   end;
if not EndDocPrinter(PrinterHandle) then
   begin
   ClosePrinter(PrinterHandle);
   PrinterHandle:=0;
   exit;
   end;
ClosePrinter(PrinterHandle);
PrinterHandle:=0;
end; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T18:09:04.850

您是否从此处使用 ActiveX 控件：http: [//monroecs.com/oposccos.htm](http://monroecs.com/oposccos.htm)？它有一个错误状态事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T17:11:41.537

首先，您必须为您的设备安装正确的支持软件，您可能必须从制造商的网站下载该软件。请记住，有时，许多设备（如收据打印机）包含标准硬件（例如 EPSON TX-88III），尽管品牌名称可能不同。

支持软件通常包含驱动程序、配置工具以及如何使用驱动程序的可能的编程示例。确保正确完成以下步骤：

1.  驱动安装，配置工具完成

2.  设备使用正确的电缆正确连接（我在找到正确的串行电缆时遇到了问题，因为它们有很多不同的类型）

3.  您的设备被配置软件（通过驱动程序）识别并且通信良好，至少它响应了一些功能

4.  使用随驱动程序安装的 ActiveX 控件。它应该与驱动程序具有相似的名称。

完成上述步骤后，您将在应用程序中拥有一个控件，该控件为您提供所有可用的功能、状态属性和事件（用于纸张或其他任何东西）。

# c# - 在 C# 中将自定义类对象添加到列表框

> ID：794163
> 
> 赞同：3
> 
> 时间：2009-04-27T15:57:10.453
> 
> 标签：c#, class, .net-2.0

我有一个看起来像这样的课程

```
public class Process_Items
{
    String Process_Name;
    int Process_ID;
    //String Process_Title;
    public string ProcessName
    {
        get { return Process_Name; }
        set { this.Process_Name = value; }
    }
    public int ProcessID
    {
        get { return Process_ID; }
        set { this.Process_ID = value; }
    }
} 
```

现在我想创建一个 Process_Items[] 数组并在多列列表框中显示所有元素。这样第一列必须有 processName，第二列必须有 processID。我如何在 C# 2.0 中实现这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-27T16:07:49.023

您应该使用 ListView 控件并添加两列（ListBox 只有一列）

```
Process_Items[] items = new Process_Items[] // Initialize array

foreach(Process_Items p in items) {
    listView.Items.Add(p.ProcessName).Subitems.Add(p.ProcessID.ToString());
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-27T16:04:07.537

列表框有一个向用户显示的 ListItem（字符串）。

所以你可以覆盖 ToString() 为

```
public override string ToString()
{
    return string.Format("{0} [ProcID: {1}]", this.Process_Name , this.ProcessID);
} 
```

如果这是针对 winforms 应用程序，请查看 ListView 控件或 DataGridView

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T16:04:44.600

您对列表使用哪种控件？如果您使用 ListView，那么您可以这样做（假设该*实例*是 Process_Items - 顺便说一句，对于 IMO 类来说这是一个奇怪的名称 - 实例）：

```
listView1.Items.Add(instance.ProcessName).SubItems.Add(instance.ProcessID.ToString()); 
```

# callstack - 重构和增加调用堆栈之间的最佳权衡是什么？

> ID：794171
> 
> 赞同：0
> 
> 时间：2009-04-27T15:59:20.543
> 
> 标签：callstack, refactoring

我正在考虑将许多大型（1000 多行）方法重构为漂亮的块，然后可以酌情进行单元测试。

这让我开始思考调用堆栈，因为我的许多重构块中都有其他重构块，而且我的大型方法很可能已被其他大型方法调用。

我想打开它进行讨论，看看重构是否会导致调用堆栈问题。我怀疑在大多数情况下它会，但想知道重构的递归方法以及是否有可能在不创建无限循环的情况下导致堆栈溢出？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T16:03:00.033

排除递归，我不会担心调用堆栈问题，直到它们出现（他们可能不会）。

关于递归：无论它是如何完成的，都必须仔细实施和仔细测试，所以这没有什么不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T16:03:45.290

我想这在技术上是可行的。但除非在我测试代码时真正发生，否则我不会担心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T16:04:10.093

当我还是个孩子的时候，计算机有 64K 的 RAM，调用堆栈的大小很重要。

如今，几乎不值得讨论。内存很大，堆栈帧很小，一些额外的函数调用很难测量。

例如，Python 有一个人为的小型调用堆栈，因此它可以迅速检测到无限递归。默认大小为 1000 帧，但可通过简单的 API 调用进行调整。

在 Python 中与堆栈发生冲突的唯一方法是不假思索地解决 Project Euler 问题。即便如此，您通常会在堆栈用完之前用完时间。（100 万亿次循环所花费的时间远远超过人类的寿命。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T16:04:39.203

我认为您在重构时不太可能在没有递归的情况下获得 stackoverflow。我可以看到会发生这种情况的唯一方法是，如果您在堆栈本身的方法之间分配和/或传递大量数据。

# python - 访问 MultipleChoiceField 选项值

> ID：794178
> 
> 赞同：3
> 
> 时间：2009-04-27T16:00:53.270
> 
> 标签：python, django

如何从表单中获取选择字段值而不是键？

我有一个表格，让用户为公司选择一些用户的电子邮件。例如，我有一个这样的表单（模型表单的原因是它在表单集中 - 但现在这并不重要）：

```
class Contacts(forms.ModelForm):
   def __init__(self, *args, **kwargs):
        super(Contacts, self).__init__(*args, **kwargs)
        self.company = kwargs['initial']['company']
        self.fields['emails'].choices = self.company.emails
        # This produces stuff like:
        # [(1, 'email@email.com'), ...]

   emails = forms.MultipleChoiceField(required=False)

    class Meta:
        model = Company 
```

我想在视图中获取所有选定电子邮件的列表，如下所示：

```
 form = ContactsForm(request.POST)
  if form.is_valid():
       form.cleaned_data['emails'][0] # produces 1 and not email 
```

没有`get_emails_display()`一种方法，例如模型中的方法。此外，建议`form.fields['emails'].choices`不起作用，因为它提供了所有选择，而我需要类似的东西`form.fields['emails'].selected_choices`？

任何想法，或者如果不清楚，请告诉我。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-27T18:06:50.597

好的，希望这更接近你想要的。

```
emails = filter(lambda t: t[0] in form.cleaned_data['emails'], form.fields['emails'].choices) 
```

这应该为您提供所需的选定选项列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T16:04:35.087

这可能不是一个漂亮的解决方案，但我想显示名称仍然可用，`form.fields['emails'].choices`因此您可以循环`form.cleaned_data['emails']`并从字段的选项中获取选项名称。

# iphone - 如何在我的 NavigationControllers TableView 上方添加视图

> ID：794193
> 
> 赞同：1
> 
> 时间：2009-04-27T16:05:52.413
> 
> 标签：iphone

我创建了一个可重用的类，它在设备屏幕底部淡入“加载消息”和指示器。

我遇到的问题是，当我将加载视图添加到 NavigationController 中包含的视图时，我希望视图保持在屏幕底部，即使在滚动 tableview 时也是如此。

如何在不受滚动等影响的 TableView 上方添加视图？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T17:47:19.940

将其添加到包含 UITableView 的视图中，使其成为 UITableView 的对等点，而不是它的子项。通常，这是您的应用程序委托拥有的 UIWindow。

# c# - 如何检查给定值是否是通用列表？

> ID：794198
> 
> 赞同：98
> 
> 时间：2009-04-27T16:07:09.557
> 
> 标签：c#, reflection, list, generics

```
public bool IsList(object value)
    {
        Type type = value.GetType();
        // Check if type is a generic list of any type
    } 
```

检查给定对象是列表还是可以转换为列表的最佳方法是什么？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-04-27T16:25:48.013

对于喜欢使用扩展方法的你们：

```
public static bool IsGenericList(this object o)
{
    var oType = o.GetType();
    return (oType.IsGenericType && (oType.GetGenericTypeDefinition() == typeof(List<>)));
} 
```

所以，我们可以这样做：

```
if(o.IsGenericList())
{
 //...
} 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2009-04-27T16:12:02.680

```
using System.Collections;

if(value is IList && value.GetType().IsGenericType) {

} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-27T16:14:23.987

```
 bool isList = o.GetType().IsGenericType 
                && o.GetType().GetGenericTypeDefinition() == typeof(IList<>)); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-27T16:25:18.123

```
public bool IsList(object value) {
    return value is IList 
        || IsGenericList(value);
}

public bool IsGenericList(object value) {
    var type = value.GetType();
    return type.IsGenericType
        && typeof(List<>) == type.GetGenericTypeDefinition();
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-27T16:09:56.290

```
if(value is IList && value.GetType().GetGenericArguments().Length > 0)
{

} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-08-15T18:32:52.523

这是一个适用于 .NET Standard 的实现，并且适用于接口：

```
 public static bool ImplementsGenericInterface(this Type type, Type interfaceType)
    {
        return type
            .GetTypeInfo()
            .ImplementedInterfaces
            .Any(x => x.GetTypeInfo().IsGenericType && x.GetGenericTypeDefinition() == interfaceType);
    } 
```

这是测试（xunit）：

```
 [Fact]
    public void ImplementsGenericInterface_List_IsValidInterfaceTypes()
    {
        var list = new List<string>();
        Assert.True(list.GetType().ImplementsGenericInterface(typeof(IList<>)));
        Assert.True(list.GetType().ImplementsGenericInterface(typeof(IEnumerable<>)));
        Assert.True(list.GetType().ImplementsGenericInterface(typeof(IReadOnlyList<>)));
    }

    [Fact]
    public void ImplementsGenericInterface_List_IsNotInvalidInterfaceTypes()
    {
        var list = new List<string>();
        Assert.False(list.GetType().ImplementsGenericInterface(typeof(string)));
        Assert.False(list.GetType().ImplementsGenericInterface(typeof(IDictionary<,>)));
        Assert.False(list.GetType().ImplementsGenericInterface(typeof(IComparable<>)));
        Assert.False(list.GetType().ImplementsGenericInterface(typeof(DateTime)));
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-01-17T00:53:14.457

根据 Victor Rodrigues 的回答，我们可以为泛型设计另一种方法。事实上，原来的解决方案可以简化为只有两行：

```
public static bool IsGenericList(this object Value)
{
    var t = Value.GetType();
    return t.IsGenericType && t.GetGenericTypeDefinition() == typeof(List<>);
}

public static bool IsGenericList<T>(this object Value)
{
    var t = Value.GetType();
    return t.IsGenericType && t.GetGenericTypeDefinition() == typeof(List<T>);
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-08-10T05:48:11.497

我正在使用以下代码：

```
public bool IsList(Type type) => type.IsGenericType && (
            (type.GetGenericTypeDefinition() == typeof(List<>))
            || (type.GetGenericTypeDefinition() == typeof(IList<>))
            ); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-27T16:08:55.123

可能最好的方法是做这样的事情：

```
IList list = value as IList;

if (list != null)
{
    // use list in here
} 
```

这将为您提供最大的灵活性，并允许您使用许多不同类型的实现`IList`接口。

# sql - 复杂 SQL where 子句：是否分解逻辑

> ID：794204
> 
> 赞同：0
> 
> 时间：2009-04-27T16:08:21.677
> 
> 标签：sql, database, optimization, boolean, boolean-logic

我有一个复杂的 SQL where 子句，由于需求更改而变得更加复杂。有四组基本案例，每组都有其他因素的不同组合。将四个案例作为 where 子句的单独分支，并在每个分支中重复冗余标准，这样更具可读性（在我看来）。但我不知道数据库引擎将如何优化它。

这是冗余形式的表达式。我已经用字母替换了实际标准。A 是“分支”标准，有四种形式。`field='value'`除非另有说明，否则所有表达式均采用 形式。

```
A1 AND B AND C AND D
OR A2 AND B AND C AND D AND E AND F1 AND G
OR A3 AND A3a AND B AND C AND D AND E AND F1 AND G
OR A4 AND B AND C AND D AND F2 
```

除 A4 之外的所有 A 都采用`field in ('value1','value2')`. D 是`field > 'value'`。G 的形式为`field not in (subquery)`。

这是表达式，考虑到（我认为）它最不冗余的形式。

```
B AND C AND D AND (
    A1
    OR (
        E AND F1 AND G AND (
            A2
            OR (A3 AND A3a)
        )
    )
    OR (A4 AND F2) 
```

我的问题是我是否应该将此表达式分解为最简单（最少冗余）的*逻辑*形式，或者是否可以将其保留为更冗余但也更易读的形式。目标数据库是 Sybase，但我一般想知道 RDMBS 的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T16:17:23.463

如果我在 M$ SQL Server 上解决这个问题，我会按照我想要的方式编写它并查看查询执行计划。如果它 (a) 运行缓慢并且 (b) 有一个糟糕的执行计划，那么我会重构并记录。不确定 Sybase 中用于查看优化器如何执行查询的机制是什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T16:35:07.993

在一个`RDBMS`我不会为冗余而烦恼的世界里，效率在这里更为重要。

在您的情况下，我会将`UNION`所有四个查询都使用`A`'s 作为顶级条件，如下所示：

```
SELECT  *
FROM    mytable
WHERE   A1 AND B AND C
UNION
SELECT  *
FROM    mytable
WHERE   A2 AND B AND C AND D AND E AND F1 AND G
… 
```

多年来我没有研究`Sybase`过`7`，但在所有专业`RDBMS`的 ' `UNION`s 都比 's 更有效`OR`。

请参阅我的博客中的这篇文章，了解解决类似问题的方法`Oracle`：

*   [**选择最低值**](http://explainextended.com/2009/04/24/selecting-lowest-value/)：有效使用`UNION`in`Oracle`

还有这篇文章用于比较`UNION`与`OR`in `MySQL`：

*   [**选择朋友**](http://explainextended.com/2009/03/07/selecting-friends/)：与in中`UNION`的一个相比的效率`OR``MySQL`

我认为这些方法也适用`Sybase`。

您还需要在条件中使用的列上创建索引以受益`UNION`于

**更新：**

由于 condition`G`是一个子查询，它可能需要 a`HASH JOIN`来快速执行。`HASH JOIN`需要对所有未过滤的值进行全扫描，这就是为什么在一次全扫描中过滤所有值然后执行以下操作可能会更好`HASH JOIN`：

```
SELECT  *
FROM    (
        SELECT  *
        FROM    foo
        WHERE   condition_set_1
        UNION
        SELECT  *
        FROM    foo
        WHERE   condition_set_2_but_no_g
        …
        ) q
WHERE   G 
```

为了做出任何进一步的判断，真正地查看查询本身会好得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T16:14:23.097

我会重构它。最终，重复的逻辑会让你遇到问题。第二个示例可能需要几秒钟的时间才能理解，但在大范围内更容易看到发生了什么，因为您可以快速查看整个 where 子句并开始确定影响什么。

# sql-server-2000 - SQL Server 2008 Express 可以与 SQL Server 2000 在同一台服务器上存在吗？

> ID：794205
> 
> 赞同：1
> 
> 时间：2009-04-27T16:08:48.163
> 
> 标签：sql-server-2000, sql-server-2008-express

我想知道是否有人在尝试将 SQL Server 2008 Express 与 SQL Server 2000 一起安装时有任何经验。我们有一个运行 2000 的生产服务器，我们当前的所有东西都在它上面运行。但是，使用 SQL Server 2008 Express 的管道正在酝酿中。

到目前为止，点击谷歌并没有给我任何具体的信息。2008 年的预览版显然没有，但 RTM 2008 没有。

我可以尝试安装它，但想在安装之前尽可能多地了解。我可以看到 2008 安装失败，在此过程中吃了 2000。

我拥有的替代路径包括将 2008 db 转换为 2000 格式（我想避免这种情况，因为我们只有 5 个连接许可证）并构建一个新服务器（我们已经有足够的了，而且看起来有点矫枉过正）。重做 2008 DB 是可行的，因为它不使用 2008 年以来的任何新的惊人功能。

虚拟化也可以是一种选择，但它还不是我们的文化。

这里的任何见解将不胜感激。

基思

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T16:15:35.963

是的，您可以，如果 2000 版本是默认实例，则必须将 2008 版本设为命名实例

# c# - 如何刷新 HttpListener 响应流？

> ID：794207
> 
> 赞同：6
> 
> 时间：2009-04-27T16:09:04.653
> 
> 标签：c#, .net, http, flush, httplistener

HttpListener 为您提供响应流，但调用 flush 没有任何意义（从来源很清楚，因为它实际上什么都不做）。深入研究 HTTP API 表明这是 HttpListener 本身的限制。

任何人都知道如何刷新 HttpListener 的响应流（可能带有反射或额外的 P/Invokes）？

**更新：**如果您没有刷新选项或定义缓冲区大小的能力，则无法 http 流式传输任何内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T16:17:17.473

当 Transfer-Encoding 设置为 Chuncked 时，Flush 仅在大多数 System.Net 命名空间中有效，否则将返回整个请求并且 Flush 真的什么都不做。至少这是我在使用 HttpWebResponse 时所经历的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T17:08:43.387

我还没有尝试过，但是为流响应编写一个单独的 TCP 服务器怎么样？然后将来自 HttpListener 的请求转发到“内部”tcp 服务器。使用此重定向，您可以根据需要将数据流回。

至于冲洗它，我看到的唯一方法是模拟处置，而不是实际处置。如果您可以侵入 HttpResponseStream 对象，告诉它处理，取消设置 m_Closed 标志等，您可能能够刷新流数据。

# sql - 创建日期列出的所有存储过程？

> ID：794211
> 
> 赞同：2
> 
> 时间：2009-04-27T16:09:41.703
> 
> 标签：sql, sql-server, sql-server-2005, tsql, stored-procedures

任何人都知道一个简单的查询来获取一个 SQL 2005 数据库中的所有存储过程的列表，该数据库按 createdate 排序？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-27T16:11:58.017

单程

```
select name from sys.procedures
where type = 'P'
order by create_date 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-27T16:14:42.847

select * from sys.objects where [type] = 'P' order by create_date

# c# - 转换大量网页的最佳方法？

> ID：794221
> 
> 赞同：0
> 
> 时间：2009-04-27T16:12:05.910
> 
> 标签：c#, html, html-agility-pack

以编程方式将大量非常相似的网页转换为更新的基于 css 的布局的最佳方法是什么？

我正在将旧网站的所有内容更改为基于 css 的新布局。许多页面非常相似，我希望能够自动化该过程。

我目前正在考虑做的是使用 HtmlAgilityPack 读取页面，并为每组将创建输出文本的相似页面创建一个方法。

您认为最好的方法是什么？这些页面的不同之处主要在于图像使用了哪个 .jpg 文件，或者该特定页面上有多少组标题图像文本

编辑：我不能使用 .html 以外的任何其他文件类型，因为这是我被授权做的所有事情。有什么建议么？

EDIT2：理想情况下，我也可以使它足够通用，只需切换几个移动部件，我就可以将它用于许多不同的 html 文件组。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-04T23:05:30.253

如何使用服务器端包含 (SSI) <#!--#INCLUDE -->

这是您可以在不同文件中创建网页的不同部分，并将它们“包含”在您想要的任何其他页面中。

header.html body.html footer.html

```
<html>
<!--#INCLUDE file="header.html" -->
<!--#INCLUDE file="body.html" -->
<!--#INCLUDE file="footer.html" -->
</html> 
```

更多信息[在这里](http://www.htmlbasix.com/includes.shtml)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T16:36:58.097

听起来你应该重用代码。如果您使用严格的 HTML，我会考虑改为使用基于 PHP 或 ASP 的网页。这样，您可以创建页眉/内容/页脚/导航部分，并在所有网页中重复使用相同的代码。

这将使其更具可持续性，因为您将来只需要编辑一个文件。

# java - 如何提前了解 OutOfMemory 或 StackOverflow 错误

> ID：794227
> 
> 赞同：8
> 
> 时间：2009-04-27T16:15:02.267
> 
> 标签：java, exception

在 Java 中，有没有办法知道`StackOverflow`错误或`OutOfMemory`异常可能很快发生？

`OutOfMemory`如果能够以编程方式获取内存使用统计信息，并且提前知道在`OutOfMemory`引发异常之前需要使用多少内存，则该异常可能更容易捕获。但是这些值是可知的吗？

对于`StackOverflow`错误，有没有办法获得递归深度，如何知道递归深度的什么值会导致错误发生？

通过提前知道这些错误是否会发生，我觉得我可以更优雅地恢复应用程序，而不是看着它崩溃。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-27T16:47:52.750

### Anticipating Out of Memory Errors

I'm surprised I didn't see this mentioned in the other posts, but you can use [ManagementFactory](http://java.sun.com/javase/6/docs/api/java/lang/management/ManagementFactory.html) in Java 5/6 to get at a lot of the memory usage information.

Look at the [platform mbean server page](http://java.sun.com/j2se/1.5.0/docs/guide/management/mxbeans.html#low_memory) for more information on detecting low memory conditions in Java. I believe you can setup notifiers to call code when memory usage reaches a certain threshold.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-27T16:19:46.563

[`Runtime.freeMemory()`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#freeMemory())您可以使用和预测内存不足的情况[`Runtime.maxMemory()`](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#maxMemory())。大多数时候很难优雅地恢复，但我把它留给你。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-27T16:18:11.510

大多数 StackOverflow 错误都源于错误的递归。不幸的是，确定递归是否停止的问题通常是不可确定的（这是 CS 中的核心概念）。但是，在某些情况下，您可能会收到警告，例如，如果您在没有参数的情况下递归调用函数，某些 IDE 会通知您。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-27T16:17:14.743

~~如果您的应用程序设计和实现正确，您将永远不会看到`StackOverflow`异常！~~

通常，如果您遇到`StackOverflow`异常，则表明您的递归代码中存在错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T16:47:16.077

Usually memory useage is hard to predict.

Stack Overflows from infinite regression generally show up in the write/debug cycle.

Harder to catch are memory issues on things like large held collections, caches, etc.etc. As has been pointed out you can check runtime free and max memory, but be careful, as their meanings aren't obvious - "free" here, means "free now", e.g. meaning if you ran a full gc you might get more. Unfortunately there's no way to get the "total possible free, including garbage-collectible" without running System.gc(), which is not a nice thing to do on a production application (where you're liable to have large enough data sets to cause the problem in the first place) because the entire JVM will come to a screeching halt for a few seconds (or more, in a large app). Note that even System.gc() is not guaranteed to run "now", but my experience has been that it has whenever I've played with it.

You can print gc activity from the running jvm by starting java with -verbose:gc, -XX:+PrintGCTimeStamps, and -XX:+PrintGCDetails (more detail [here](http://java.sun.com/developer/technicalArticles/Programming/GCPortal/)), and in general if the collector starts to run more frequently, it's probably a sign that you're running out of memory.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-27T17:31:08.263

One useful thing you can do is use `SoftReference`s for caches. That will give you a gradual performance slide as you run out of memory. Just don't use `WeakReference` even in a `WeakHashMap` because it will annoy me when your application dies nastily on me.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-27T18:08:34.490

The [MemoryMXBean](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/management/MemoryMXBean.html) can emit notifications if your memory reaches a certain threshold.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-27T16:21:19.133

通过创建 Throwable 对象并查询其 getStackTrace() 方法，您可以发现很多关于递归深度的信息。但这样做很昂贵。

如果您确实有一个方法可能会引发 StackOverflowError 或 OutOfMemoryError，为什么不插入 try-catch 块并捕获这些错误呢？它们可以像检查异常一样被捕获和处理。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-27T16:24:59.467

我不知道在运行时解决这个问题，或者一旦你预测它会发生，你可以做些什么来避免它。最好首先尝试避免它发生。

1) 您可以使用[Findbugs](http://findbugs.sourceforge.net/)，这可能表明某些 StackOverFlow 错误是由于无意中从自身调用相同的方法而发生的。

2) You could store data likely to cause you to run out of memory with a SoftReference and have a null check on accessing it so it can be reloaded if it's been garbage collected.

If either of these things are actually issues for you then the solution probably isn't in detecting it happening but architecting your solution differently to avoid them occuring if at all possible.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-27T17:06:47.540

For StackOverflowError:

To know the current depth, usually it's either:

1.  using a stateful function (storing the depth in outside the function)
2.  using an accumulator (passing the depth as an argument to the function)

Knowing the depth it will occur is difficult. There are several factors:

1.  The stack space allocated to the JVM (you can change this with the -Xss option)
2.  The amount of stack space already used
3.  The amount used by the current function.

Why not try it out using something like this?

```
public static void main(String[] args) {
    try {
        recurs();
    } catch (Throwable t) {
        // not a good idea in production code....
    }
}
static int depth = 0;
static void recurs() {
    System.out.println(depth++);
    recurs();
} 
```

Run it several times. Also try adding dummy variables. It can be seen that even the same code may halt at different depths and adding more variables cause it to end earlier. So yeah, pretty much it's unpredictable.

I suppose that besides rewriting the algorithm the only option would be to increase the stack space with the -Xss option.

For OutOfMemoryError, there's the -Xmx option

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-05-28T11:23:18.443

Implementation example using `MemoryPoolMXBean`

```
import static java.lang.management.ManagementFactory.getMemoryMXBean;
import static java.lang.management.ManagementFactory.getMemoryPoolMXBeans;
import static java.lang.management.MemoryNotificationInfo.MEMORY_THRESHOLD_EXCEEDED;
import static java.lang.management.MemoryType.HEAP;
import java.lang.management.MemoryPoolMXBean;
import java.lang.management.MemoryUsage;
import java.util.Collection;
import java.util.concurrent.CopyOnWriteArrayList;
import javax.management.Notification;
import javax.management.NotificationEmitter;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class MemoryWatcher {

    public interface Listener {
        void memoryUsageLow(long usedMemory, long maxMemory);
    }

    private static final MemoryPoolMXBean tenuredGenPool = findTenuredGenPool();
    private static final Logger logger = LoggerFactory.getLogger(MemoryWatcher.class);

    private static MemoryPoolMXBean findTenuredGenPool() {
        for (MemoryPoolMXBean pool : getMemoryPoolMXBeans())
            if (pool.getType() == HEAP && pool.isUsageThresholdSupported())
                return pool;
        return null;
    }

    public static MemoryPoolMXBean getTenuredGenPool() {
        return tenuredGenPool;
    }

    private final Collection<Listener> listeners = new CopyOnWriteArrayList<>();

    public MemoryWatcher(double usageThresholdPercent) {
        if (tenuredGenPool == null) {
            logger.warn("Tenured pool is not used");
            return;
        }
        if (tenuredGenPool.getUsageThreshold() != 0)
            logger.warn("Overriding tenured usage threshold {} with {}", tenuredGenPool.getUsage().getMax() / (double) tenuredGenPool.getUsageThreshold(), usageThresholdPercent);
        tenuredGenPool.setUsageThreshold((long) (tenuredGenPool.getUsage().getMax() * usageThresholdPercent));

        NotificationEmitter emitter = (NotificationEmitter) getMemoryMXBean();
        emitter.addNotificationListener((Notification n, Object hb) -> {
            MemoryUsage usage = tenuredGenPool.getUsage();
            if (n.getType().equals(MEMORY_THRESHOLD_EXCEEDED) && usage.getMax() == usage.getCommitted())
                listeners.forEach(listener -> listener.memoryUsageLow(usage.getUsed(), usage.getMax()));
        }, null, null);
    }

    public boolean addListener(Listener listener) {
        return listeners.add(listener);
    }

    public boolean removeListener(Listener listener) {
        return listeners.remove(listener);
    }
} 
```

# django - Django 视图返回在 html 模板中未正确表示的字符串

> ID：794232
> 
> 赞同：4
> 
> 时间：2009-04-27T16:17:16.570
> 
> 标签：django, templates, view

我正在使用的视图将字符串返回到 html 模板。返回的字符串包含在模板中未正确表示的特殊字符。简单地说，从视图返回的字符串可能如下所示：

```
test = "\"Foo bar\""
return render_to_response('index.html', {'test': test}) 
```

并显示在 html 模板中，如下所示：

```
& quot;Foo bar& quot; 
```

如何修复编码以便正确显示？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-27T16:20:08.573

打印时使用[安全过滤器：](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#safe)

```
{{ test|safe }} 
```

或者，在视图中执行此操作：

```
from django.utils.safestring import mark_safe
test = mark_safe("\"Foo bar\"") 
```

请注意，这样做是在告诉 Django，字符串的内容是安全的，不需要 HTML 转义。如果您打算放置任何可能来自用户的内容，那么这将使您容易受到 XSS 攻击，因此请谨慎使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T07:14:53.900

最好的办法是查阅 Django 文档，其中详细解释了这一点：

[https://docs.djangoproject.com/en/2.0/ref/templates/language/#automatic-html-escaping](https://docs.djangoproject.com/en/2.0/ref/templates/language/#automatic-html-escaping)

# php - Good Zend Framework example apps to learn from

> ID：794240
> 
> 赞同：18
> 
> 时间：2009-04-27T16:19:33.507
> 
> 标签：php, zend-framework, open-source

Do you know of any open-source Zend Framework applications besides Magento that show in a good OOP-way how to develop big apps with Zend Framework?

My problem right now is, that I'm pretty good at PHP and OOP, but I don't have enough knowledge of the Zend Framework and how things should be solved in it.

So do you know any good applications that showcase best-practices for ZF?

Thanks!

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-29T09:21:22.790

Have a look at:

*   JotBug (from 2009): [http://www.ohloh.net/p/jotbug](http://www.ohloh.net/p/jotbug) ([zip file of code](http://akrabat.com/wp-content/uploads/jotbug.zip))
*   Pastebin: [http://github.com/weierophinney/pastebin/](http://github.com/weierophinney/pastebin/)
*   'ZF 1.8 Web Application Development' code: [http://code.google.com/p/zendframeworkstorefront/](http://code.google.com/p/zendframeworkstorefront/)
*   Enygma's Ext-JS with ZF example app: [https://github.com/enygma/Agile-ExtJS-ZF](https://github.com/enygma/Agile-ExtJS-ZF)
*   MTD issues: [https://github.com/mtd/issues](https://github.com/mtd/issues)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-16T09:36:55.177

Magento is a good example of the Zend Framework, Until you start looking at how they decided to go about templating! Wow.. wonder how late that meeting was when they decided to depart from logic and create their highly nested template components.. fun times (from a designers perspective) :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T04:56:17.140

I've only peeked into the source of Magento (magentocommerce.com) but it has a pretty good result on the outside.

# internet-explorer - Internet Explorer 忽略某些域上的 cookie（无法读取或设置 cookie）

> ID：794243
> 
> 赞同：62
> 
> 时间：2009-04-27T16:20:37.153
> 
> 标签：internet-explorer, cookies

我有一个站点，例如`example.com`，用户可以在其中设置自己的子域（一个用户 - 一个子域）并上传自己的脚本，例如`http://somedomain.example.com/xyzzy.php`将映射到`/www/somedomain/xyzzy.php`

现在，在其中一些域上，Internet Explorer 7 不会/不能接受 cookie。用 Fiddler 检查：服务器正确发送 Set-Cookie 响应，但 cookie 从未出现在 IE 中 - 对于 JS 或开发人员工具。根据请求，IE7 也不发送 Cookie 标头。

cookie 是为用户的域设置的（例如`somedomain.example.com`），路径是`/`，尝试了不同的过期选项（过去、未来、当前、“0”），不是 HttpOnly，不安全。

FF、Opera、Safari 和 Chrome 都可以正常工作。

为什么 IE 会忽略 cookie？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-04-27T16:29:06.837

子域之一是否使用下划线？IE 在接受来自不遵循[URI RFC](http://www.ietf.org/rfc/rfc2396.txt)的子域的 cookie 时遇到问题。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-04-27T16:29:54.697

根据[RFC1035](http://www.faqs.org/rfcs/rfc1035.html)（域名 - 实现和规范）：

> [域名] 必须以字母开头，以字母或数字结尾，内部字符只能包含字母、数字和连字符。

事实证明，一些域中有一个下划线（“_”）`some_domain.example.com`：. 尽管这违反了 RFC，但所有其他浏览器都可以正常工作。

**带有下划线的域上的 MSIE 7 会默默地删除该主机的所有 cookie**并拒绝接受新的 cookie。

唯一的解决方案是使用符合 RFC 的域（我已将所有的“_”替换为“-”并设置了 RewriteRule，以便将流量重定向到符合的域）。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-01-25T11:13:26.457

该问题不仅适用于域名中的下划线，还适用于以数字开头的域名。所以`1aaaaaaa.tld`实际上是一个非标准的域名，会导致IE拒绝cookie。

我通过使用 only 解决了这个问题，`www2.1aaaaaaa.tld`然后在. 不知道这是否真的符合标准的解决方案......但无论如何，它似乎已经解决了 cookie 问题。`1aaaaaaa.tld``www.1aaaaaaa.tld``.htaccess`

希望对某人有所帮助！

# c++ - 我应该如何更正导致“计算值未使用”警告的代码？

> ID：794244
> 
> 赞同：0
> 
> 时间：2009-04-27T16:20:40.507
> 
> 标签：c++, g++

我有一个双精度数组，需要对该数组进行计算，然后找到该计算产生的最小值和最大值。这基本上是我所拥有的：

```
double * array;
double result;
double myMin;
double myMax;

// Assume array is initialized properly...
for (int i = 0; i < sizeOfArray; ++i) {
    result = transmogrify(array[i]);
    if (i == 0) {
        myMin = result;
        myMax = result;
    }
    else if (result < myMin) {
        myMin = result;
    }
    else if (result > myMax) {
        myMax = result;
    }
} 
```

我收到一条警告说计算的值`result`从未使用过，并且由于我们将所有警告都视为错误，因此无法编译。如何修复此代码以避免警告？我正在为我的编译器使用 g++。

这是警告文本：

```
cc1plus: warnings being treated as errors
foo.cc:<lineno of transmogrify call>: error: value computed is not used 
```

编辑：我不明白反对票，但我现在已经开始工作了。感谢大家花时间帮助我。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T16:26:49.697

假设您不需要`result`在循环之外，您可以`result`在循环内声明：

```
for( int i=0; i < sizeOfArray; ++i ) {
    double result = transmogrify( array[i] );
    ...
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-27T16:31:59.653

> 我收到一个警告说计算的值`result`从未使用过，因为（理论上）可能不会选择任何 if/else 分支

这不能是警告的原因，因为`result`也用于 if 条件。即使没有任何分支被采用，`result`仍然用于决定它们不应该被采用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-27T16:31:31.167

分别用 DBL_MAX 和 DBL_MIN 初始化 myMin 和 myMax，并通过循环检查第一次摆脱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-27T16:28:55.417

我不认为发布的代码应该产生错误，除非编译器正在进行一些惊人的流分析。它当然可以用 g++ 编译，但我不确定 g++ 是否支持您收到的警告。

您的代码的以下修改保留了其结构，不会产生 g++ 错误：

```
int main() {
double * array;
double result;
double myMin;
double myMax;

double t(double);

// Assume array is initialized properly...
for (int i = 0; i < 10; ++i) {
    result = t(array[i]);
    if (i == 0) {
        myMin = result;
        myMax = result;
    }
    else if (result < myMin) {
        myMin = result;
    }
    else if (result > myMax) {
        myMax = result;
    }
} 
```

}

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T16:30:49.750

```
result = [...]
if (i == 0) {
    [... do something with result ...]
}
else if (result < myMin) { 
```

在 if() 的两个分支中，`result`都使用了。在第一种情况下，它被分配给一个变量，在第二种情况下，它被用于比较。所以编译器不应该发出警告。

我怀疑你可能误诊了这个问题。请你能准确地说出错误信息是什么（复制粘贴）。另外，请尝试发布可以实际编译并发出警告的最小代码段？（只是尝试这样做可能会让您发现问题）

编辑： transmogrify() 是否有可能是一个`result`内部使用的宏？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-27T16:32:20.230

在“if”语句之前：

```
result = 0.0; 
```

或其他一些价值。在使用之前将变量设置为某个值总是一种很好的形式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-27T16:34:21.537

> 我收到一条警告说，为 result 计算的值从未使用过，因为（理论上）可能不会选择任何 if/else 分支，并且由于我们将所有警告都视为错误，因此无法编译。如何修复此代码以避免警告？我正在为我的编译器使用 g++

始终使用用于结果的值。如果未分配，则在比较器中使用它。因此编译器有问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-27T16:41:34.933

一个快速的解决方案可能是展开第一次迭代，如下所示：

```
double * array;
double result = transmogrify(array[0]);
double myMin = result;
double myMax = result;
int i;

for (i = 1; i < sizeOfArray; ++i) {
    result = transmogrify(array[i]);

    if (result < myMin) {
        myMin = result;
    }

    if (result > myMax) {
        myMax = result;
    }
} 
```

编辑：我将对此进行一些扩展。您没有提供有关 sizeOfArray 的任何详细信息，但我的猜测是它是有符号整数类型。

我相信您误解了警告的原因，结果可能未使用，因为 sizeOfArray 可能小于或等于零，而不是因为循环中的 if..else 子句。在上面的代码中，为什么需要仔细处理大小写 (sizeOfArray <= 0) 可能更清楚一些，但它在原始代码片段中也同样重要。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-27T16:29:46.977

删除第一个 else 只会影响循环中第一次运行的运行时间。我宁愿消除它。

```
if (i == 0) {
    myMin = result;
    myMax = result;
}
if (result < myMin) 
    myMin = result;
else if (result > myMax) 
    myMax = result; 
```

# perl - 我应该使用哪个适用于 Perl 的 Google API 搜索模块？

> ID：794245
> 
> 赞同：1
> 
> 时间：2009-04-27T16:20:54.657
> 
> 标签：perl, search

您推荐哪个用于 Perl 的 Google API 搜索模块？

[REST::Google::Search](http://search.cpan.org/dist/REST-Google)或[Google::Search](http://search.cpan.org/dist/Google-Search)

易用性很重要，因为我只需要从网络搜索中获得前两个，也许是三个结果。

另外，是否有一个知道从维基百科获取东西的模块？再次，易于使用很重要。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T08:22:51.727

他们之间似乎没有太多选择。

对于它的价值，我会使用 Google::Search，主要是因为它是使用 Moose 在引擎盖下编写的：D

# java - 一种反转java String.split（）效果的方法？

> ID：794248
> 
> 赞同：133
> 
> 时间：2009-04-27T16:22:07.227
> 
> 标签：java, string, split

我正在寻找一种将字符串数组组合成分隔字符串的方法。与 split() 相反。

在我自己写之前想问问论坛（因为JDK什么都有）

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-04-27T16:25:39.590

据我所知，JDK 中没有针对此的方法。[Apache Commons Lang](http://commons.apache.org/lang/)在类中有各种重载`join()`方法，[`StringUtils`](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/StringUtils.html#join(T...))可以做你想做的事。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2013-08-19T19:16:35.477

至少从 2009 年开始就有一个开放的功能请求。总而言之，它将成为 JDK 8 的 java.util.StringJoiner 类功能的一部分。 [http://download.java.net/lambda/b81/docs/api/java/util/StringJoiner.html](http://download.java.net/lambda/b81/docs/api/java/util/StringJoiner.html)

如果您有兴趣，这里是 Oracle 问题。 [http://bugs.sun.com/view_bug.do?bug_id=5015163](http://bugs.sun.com/view_bug.do?bug_id=5015163)

这是一个字符串数组上的新 JDK 8 StringJoiner 示例

```
String[] a = new String[]{"first","second","third"};
StringJoiner sj = new StringJoiner(",");
for(String s:a) sj.add(s);
System.out.println(sj); //first,second,third 
```

String 中的实用方法使这更加简单：

```
String s = String.join(",", stringArray); 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2011-05-24T20:31:12.623

`Arrays`您可以将此功能从实用程序包中偷偷出来。

```
import java.util.Arrays;
...
    String delim = ":",
            csv_record = "Field0:Field1:Field2",
            fields[] = csv_record.split(delim);

    String rebuilt_record = Arrays.toString(fields)
            .replace(", ", delim)
            .replaceAll("[\\[\\]]", ""); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-27T16:35:24.467

我在[这里得到了以下示例](http://www.java2s.com/Code/JavaAPI/org.apache.commons.lang/StringUtilsjoinObjectarrayStringseparator.htm)

```
/*
7) Join Strings using separator >>>AB$#$CD$#$EF

 */

import org.apache.commons.lang.StringUtils;

public class StringUtilsTrial {
  public static void main(String[] args) {

    // Join all Strings in the Array into a Single String, separated by $#$
    System.out.println("7) Join Strings using separator >>>"
        + StringUtils.join(new String[] { "AB", "CD", "EF" }, "$#$"));
  }
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-04-28T04:14:22.960

Google 还在他们的 Google Collections 库中提供了一个 joiner 类：

[连接器 API](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/base/Joiner.html)

[谷歌收藏](http://code.google.com/p/google-collections/)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-27T16:33:33.253

如果您想推出自己的与集合一起使用的[DZone Snippets](http://snippets.dzone.com/posts/show/91) ，有几个示例。例如：

```
public static String join(AbstractCollection<String> s, String delimiter) {
    if (s == null || s.isEmpty()) return "";
    Iterator<String> iter = s.iterator();
    StringBuilder builder = new StringBuilder(iter.next());
    while( iter.hasNext() )
    {
        builder.append(delimiter).append(iter.next());
    }
    return builder.toString();
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-05-11T16:07:19.470

If you have an int[], `Arrays.toString()` is the easiest way.

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-09-02T17:44:44.073

基于之前的所有答案：

```
public static String join(Iterable<? extends Object> elements, CharSequence separator) 
{
    StringBuilder builder = new StringBuilder();

    if (elements != null)
    {
        Iterator<? extends Object> iter = elements.iterator();
        if(iter.hasNext())
        {
            builder.append( String.valueOf( iter.next() ) );
            while(iter.hasNext())
            {
                builder
                    .append( separator )
                    .append( String.valueOf( iter.next() ) );
            }
        }
    }

    return builder.toString();
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-11-19T14:26:42.233

对于 Android：在 [android.text.TextUtils](http://developer.android.com/reference/android/text/TextUtils.html) 中有方法：

```
public static String join (CharSequence delimiter, Iterable tokens)
public static String join (CharSequence delimiter, Object[] tokens) 
```

*返回包含由分隔符连接的标记的字符串。*

*tokens -- 要加入的数组对象。字符串将通过调用 object.toString() 从对象中形成。*

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-07-26T12:50:39.703

由于 JDK8 我非常喜欢 Streams 和 Lambdas，所以我建议：

```
public static String join( String delimiter, String[] array )
{
    return Arrays.asList( array ).stream().collect( Collectors.joining( delimiter ) );
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-12-03T19:25:14.700

为了完整起见，我想补充一点，您通常不能反转[String#split](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#split%28java.lang.String%29)，因为它接受正则表达式。

`"hello__world".split("_+");`产量`["hello", "world"]`。
`"hello_world".split("_+");`产量`["hello", "world"]`。

这些从不同的起点产生相同的结果。分裂不是一对一的操作，因此是不可逆的。

综上所述，如果您假设您的参数是固定字符串，而不是正则表达式，那么您当然可以使用许多已发布的答案之一来做到这一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-02-19T16:35:04.913

*如果您使用 jdk8，请参阅@Nathaniel Johnson 的[答案](https://stackoverflow.com/a/18321389/5445670)，因为这样会更好。*

我认为这里的许多答案都很复杂或不容易阅读。分支预测如此高效，为什么您根本不使用 if 语句？

```
public static String join(List<String> fooList){

    if (fooList.isEmpty()) return "";

    StringBuilder sb = null;

    for (String element : fooList) {

        if (sb == null) {
            sb = new StringBuilder();
        } else {
            sb.append(", ");
        }

        sb.append(element);
    }
    return sb.toString();
} 
```

应该提到的是，Apache 使用了一个简单的 for 循环，其中包含这样的 if 语句（它使用数组作为索引来知道第一个元素），而 openjdk 8 也这样做，但在单独的方法调用中而不是简单的循环。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-04-05T15:09:52.810

我写了这个：

```
public static String join(Collection<String> col, String delim) {
    StringBuilder sb = new StringBuilder();
    Iterator<String> iter = col.iterator();
    if (iter.hasNext())
        sb.append(iter.next());
    while (iter.hasNext()) {
        sb.append(delim);
        sb.append(iter.next());
    }
    return sb.toString();
} 
```

`Collection`JSP 不支持，所以对于 TLD，我写道：

```
public static String join(List<?> list, String delim) {
    int len = list.size();
    if (len == 0)
        return "";
    StringBuilder sb = new StringBuilder(list.get(0).toString());
    for (int i = 1; i < len; i++) {
        sb.append(delim);
        sb.append(list.get(i).toString());
    }
    return sb.toString();
} 
```

并`.tld`归档：

```
<?xml version="1.0" encoding="UTF-8"?>
<taglib version="2.1" xmlns="http://java.sun.com/xml/ns/javaee"
    <function>
        <name>join</name>
        <function-class>com.core.util.ReportUtil</function-class>
        <function-signature>java.lang.String join(java.util.List, java.lang.String)</function-signature>
    </function>
</taglib> 
```

并在 JSP 文件中将其用作：

```
<%@taglib prefix="funnyFmt" uri="tag:com.core.util,2013:funnyFmt"%>
${funnyFmt:join(books, ", ")} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-03-27T03:25:58.500

这个也不错：

```
public static String join(String delimitor,String ... subkeys) {
    String result = null;
    if(null!=subkeys && subkeys.length>0) {
        StringBuffer joinBuffer = new StringBuffer(subkeys[0]);
        for(int idx=1;idx<subkeys.length;idx++) {
            joinBuffer.append(delimitor).append(subkeys[idx]);
        }
        result = joinBuffer.toString();
    }
    return result;
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-10-24T18:52:36.310

下面的代码给出了一个基本的想法。虽然这不是最好的解决方案。

```
public static String splitJoin(String sourceStr, String delim,boolean trim,boolean ignoreEmpty){
    return join(Arrays.asList(sourceStr.split(delim)), delim, ignoreEmpty);
}

public static String join(List<?> list, String delim, boolean ignoreEmpty) {
    int len = list.size();
    if (len == 0)
        return "";
    StringBuilder sb = new StringBuilder(list.get(0).toString());
    for (int i = 1; i < len; i++) {
        if (ignoreEmpty && !StringUtils.isBlank(list.get(i).toString())) {
            sb.append(delim);
            sb.append(list.get(i).toString().trim());
        }
    }
    return sb.toString();
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-03-19T05:49:21.973

我更喜欢这个：

```
public String join(Collection<String> strCollection, String delimiter) {
    String joined = "";
    int noOfItems = 0;
    for (String item : strCollection) {
        joined += item;
        if (++noOfItems < strCollection.size())
            joined += delimiter;
    }
    return joined;
} 
```

这是迄今为止我找到的最简洁的解决方案。（不用担心使用原始 String 对象而不是 StringBuilder。现代 Java 编译器无论如何都使用 StringBuilder，但这段代码更具可读性）。

# c# - C# 线程和队列

> ID：794249
> 
> 赞同：13
> 
> 时间：2009-04-27T16:23:16.180
> 
> 标签：c#, multithreading

这不是关于我可以或应该使用的不同方法来以最佳方式利用队列，而是我所看到的对我来说毫无意义的事情。

```
void Runner() {
    // member variable
    queue = Queue.Synchronized(new Queue());
    while (true) {
        if (0 < queue.Count) {
            queue.Dequeue();
        }
    }
} 
```

这是在单个线程中运行的：

```
var t = new Thread(Runner);
t.IsBackground = true;
t.Start(); 
```

其他事件在其他地方“入队”。我所看到的情况是在一段时间内，Dequeue 实际上会抛出 InvalidOperationException，队列为空。这应该是不可能的，因为计数如何保证那里有东西，而且我很肯定没有其他东西是“出队”的。

问题：

1.  Enqueue 是否有可能在项目完全进入队列之前增加计数（无论这意味着什么......）？
2.  线程是否有可能在 Dequeue 语句处以某种方式重新启动（过期、重置......），但在它已经删除一个项目之后立即？

**编辑（澄清）：**

这些代码片段是实现后台帮助线程的 Wrapper 类的一部分。这里的Dequeue是唯一的Dequeue，所有的Enqueue/Dequeue都在Synchronized成员变量（queue）上。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-27T16:37:04.447

使用反射器，您可以看到不，直到添加项目后计数才会增加。

正如 Ben 指出的那样，您似乎确实有多个人调用 dequeue。

你说你很肯定没有其他东西正在调用出队。那是因为你只有一个线程调用出队吗？dequeue 是否在其他任何地方调用？

编辑：

我写了一些示例代码，但无法重现问题。它只是不停地运行，没有任何例外。

在出现错误之前它运行了多长时间？也许你可以分享更多的代码。

```
class Program
{
    static Queue q = Queue.Synchronized(new Queue());
    static bool running = true;

    static void Main()
    {
        Thread producer1 = new Thread(() =>
            {
                while (running)
                {
                    q.Enqueue(Guid.NewGuid());
                    Thread.Sleep(100);
                }
            });

        Thread producer2 = new Thread(() =>
        {
            while (running)
            {
                q.Enqueue(Guid.NewGuid());
                Thread.Sleep(25);
            }
        });

        Thread consumer = new Thread(() =>
            {
                while (running)
                {
                    if (q.Count > 0)
                    {
                        Guid g = (Guid)q.Dequeue();
                        Console.Write(g.ToString() + " ");
                    }
                    else
                    {
                        Console.Write(" . ");
                    }
                    Thread.Sleep(1);
                }
            });
        consumer.IsBackground = true;

        consumer.Start();
        producer1.Start();
        producer2.Start();

        Console.ReadLine();

        running = false;
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-27T16:29:07.303

这是我认为有问题的顺序是：

1.  `(0 < queue.Count)`计算结果为真，队列不为空。
2.  该线程被[抢占](http://en.wikipedia.org/wiki/Preemption_(computing))，另一个线程运行。
3.  另一个线程从队列中删除一个项目，将其清空。
4.  该线程恢复执行，但现在位于 if 块内，并尝试将空列表出列。

但是，你说没有其他东西正在出队......

尝试在 if 块中输出计数。如果您看到计数向下跳数，则表明其他人正在出队。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-27T16:32:04.457

[这是MSDN 页面](http://msdn.microsoft.com/en-us/library/system.collections.queue.synchronized.aspx)上关于此主题的可能答案：

> 通过集合进行枚举本质上不是线程安全的过程。即使一个集合被同步，其他线程仍然可以修改该集合，这会导致枚举器抛出异常。为了保证枚举过程中的线程安全，您可以在整个枚举过程中锁定集合，也可以捕获其他线程更改导致的异常。

我的猜测是你是对的 - 在某些时候，会发生竞争情况，你最终会出队一些不存在的东西。

Mutex 或 Monitor.Lock 在这里可能是合适的。

祝你好运！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-27T16:38:00.527

“排队”数据的其他区域是否也使用相同的同步队列对象？为了使 Queue.Synchronized 是线程安全的，所有 Enqueue 和 Dequeue 操作必须使用相同的同步队列对象。

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.collections.queue.synchronized.aspx)：

> 为了保证 Queue 的线程安全，所有的操作都只能通过这个 wrapper 来完成。

编辑：如果您正在循环涉及大量计算的许多项目，或者您正在使用长期线程循环（通信等），您应该考虑使用等待功能，例如[System.Threading.Thread.Sleep](http://msdn.microsoft.com/en-us/library/system.threading.thread.sleep.aspx)，[System.循环中的Threading.WaitHandle.WaitOne](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitone.aspx)、[System.Threading.WaitHandle.WaitAll](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitall.aspx)或[System.Threading.WaitHandle.WaitAny](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitany.aspx)，否则可能会降低系统性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T20:20:21.197

问题 1：如果您使用的是同步队列，那么：不，您是安全的！但是您需要在供应商和馈线双方使用同步实例。

问题2：当没有工作要做时终止你的工作线程，是一项简单的工作。但是，无论哪种方式，您都需要一个监控线程，或者让队列在队列有事情要做时启动一个后台工作线程。最后一个听起来更像是 ActiveObject 模式，而不是一个简单的队列（Single-Responsibily-Pattern 说它应该只做排队）。

此外，我会选择阻塞队列而不是上面的代码。即使没有工作要做，您的代码的工作方式也需要 CPU 处理能力。阻塞队列让您的工作线程在无事可做时休眠。您可以在不使用 CPU 处理能力的情况下运行多个休眠线程。

C# 没有阻塞队列实现，但有很多。请参阅此[示例](https://stackoverflow.com/questions/530211/creating-a-blocking-queuet-in-net)和此[示例](http://www.codeproject.com/KB/recipes/boundedblockingqueue.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-19T19:51:24.957

使线程安全地使用队列的另一个选项是自 2009 年（这个问题的年份）以来引入的[ConcurrentQueue<T>类。](https://docs.microsoft.com/en-us/dotnet/api/system.collections.concurrent.concurrentqueue-1?view=net-6.0)这可能有助于避免编写自己的同步代码，或者至少有助于使其更简单。

从 .NET Framework 4.6 开始，`ConcurrentQueue<T>`也实现了接口`IReadOnlyCollection<T>`。

# php - 我在 Google App Engine 上运行 PHP - 如何使用数据库？

> ID：794250
> 
> 赞同：9
> 
> 时间：2009-04-27T16:23:50.080
> 
> 标签：php, database, google-app-engine, quercus, google-eclipse-plugin

我[在 Google appengine 上按照 PHP](http://www.webdigi.co.uk/blog/2009/run-php-on-the-google-app-engine/)进行设置，效果很好。有关如何在 GAE 上使用带有 PHP 的数据库/数据存储的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T02:55:15.037

因为 Google 在 Java API 中提供了对数据存储的低级访问

[http://code.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/package-summary.html](http://code.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/package-summary.html)

您应该能够使用 php-java 集成访问这些类，例如：

```
 // Get a handle on the datastore itself
 $datastore = new Java('com.google.appengine.api.datastore.DatastoreServiceFactory')->getDatastoreService();

 // Lookup data by known key name
 $userEntity = $datastore->get(new Java('com.google.appengine.api.datastore.KeyFactory')->createKey("UserInfo", email)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-24T11:28:27.017

有关如何在 Google App Engine 的 PHP 中使用 SQL CRUD（创建、检索、更新、删除）的概念证明，请参阅下面的 URL。

糟糕，新用户无法发布链接。点击右下角我的名字，然后点击网站网址。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-20T10:24:01.897

我认为这就是您正在寻找的 [https://developers.google.com/appengine/docs/php/cloud-sql/](https://developers.google.com/appengine/docs/php/cloud-sql/) 使用支持的三个 MySQL 库之一，与本地安装 MySQL 和 Google CloudSQL 部署时，通过使用 mysql_connect() 连接到的实例名称。需要启用计费才能设置 CloudSQL 实例 :-(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T16:38:44.207

您刚刚链接到的教程中有一些关于 GQL 数据存储的讨论。

> Google App Engine 的数据存储有一种类似于 SQL 的语法，称为“GQL”。GQL 中的 Select 语句只能在一张表上执行。

和内存缓存

> 无论如何，对于 php 访问任何类型的数据库。- 我知道 Memcached 是由 GAE 提供的，所以我们可以通过简单地添加键值对来使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-10T13:32:00.947

[https://gae-php-tips.appspot.com/2013/12/23/getting-started-with-the-cloud-datastore-on-php-app-engine/](https://gae-php-tips.appspot.com/2013/12/23/getting-started-with-the-cloud-datastore-on-php-app-engine/)

[https://gae-php-tips.appspot.com/2013/12/24/getting-started-with-the-cloud-datastore-on-php-app-engine-part-ii/](https://gae-php-tips.appspot.com/2013/12/24/getting-started-with-the-cloud-datastore-on-php-app-engine-part-ii/)

它正在使用不完整的实现。如果您认真考虑使用 google 数据存储，这是一个很好的起点。

# visual-studio - 如何在 Visual Studio 中使用即时窗口？

> ID：794255
> 
> 赞同：132
> 
> 时间：2009-04-27T16:25:32.180
> 
> 标签：visual-studio, debugging, immediate-window

即时窗口是调试应用程序的非常有用的工具。它可用于执行在断点上下文中有效的代码语句并检查值。我还用它来输入代码片段来学习语言特性。

如何使用即时窗口？

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-09-01T07:57:09.253

Visual Studio 中即时窗口的一个很好的特性是它能够评估方法的返回值，特别是当它由您的客​​户端代码调用但它*不是*变量赋值的一部分时。如前所述，在调试模式下，您可以与变量交互并在内存中执行表达式，这在执行此操作方面起着重要作用。

例如，如果您有一个返回两个数字之和的静态方法，例如：

```
private static int GetSum(int a, int b)
{
    return a + b;
} 
```

然后在立即窗口中，您可以键入以下内容：

```
? GetSum(2, 4)
6 
```

如您所见，这对于静态方法非常有效。但是，如果该方法是非静态的，那么您需要与对该方法所属对象的引用进行交互。

例如，假设这是您的班级的样子：

```
private class Foo
{
    public string GetMessage()
    {
        return "hello";
    }
} 
```

如果对象已经存在于内存中并且在范围内，那么只要它在当前断点*之前*（或者至少在代码在调试模式下暂停的任何位置之前）被实例化，就可以在即时窗口中调用它：

```
? foo.GetMessage(); // object ‘foo’ already exists
"hello" 
```

另外，如果你想直接交互和测试方法而不依赖内存中的现有实例，那么你可以在即时窗口中实例化你*自己的实例：*

```
? Foo foo = new Foo(); // new instance of ‘Foo’
{temp.Program.Foo}
? foo.GetMessage()
"hello" 
```

如果您想进行进一步的评估、计算等，您可以更进一步，暂时将方法的结果分配给变量：

```
? string msg = foo.GetMessage();
"hello"
? msg + " there!"
"hello there!" 
```

此外，如果您甚至不想为新对象声明变量名而只想运行其方法/函数之一，请执行以下操作：

```
? new Foo().GetMessage()
"hello" 
```

查看方法值的一种非常常见的方法是选择类的方法名称并执行“添加监视”，以便您可以在监视窗口中查看其当前值。然而，再一次，对象需要被实例化并且在显示有效值的范围内。与使用立即窗口相比，它的功能和限制要小得多。

除了检查方法，您还可以做简单的数学方程式：

```
? 5 * 6
30 
```

或比较值：

```
? 5==6
false
? 6==6
true 
```

如果您直接在即时窗口中，问号 ('?') 是不必要的，但为了清楚起见，将其包含在此处（以区分键入的表达式与结果。）但是，如果您在命令行窗口中并且需要在即时窗口中做一些快速的事情，然后在你的陈述之前加上“？” 然后你就走了。

[Intellisense 在即时窗口](https://stackoverflow.com/questions/288317/visual-studio-where-is-intellisense-in-the-immediate-window)中工作，但有时可能会有点不一致。以我的经验，它似乎只在调试模式下可用，但在设计非调试模式下不可用。

不幸的是，立即窗口的另一个缺点是它不支持循环。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2017-02-27T18:57:55.520

## 使用即时窗口执行命令

即时窗口也可用于执行命令。只需键入 a`>`后跟命令。

[![在此处输入图像描述](https://i.stack.imgur.com/9DSEU.png)](https://i.stack.imgur.com/9DSEU.png)

例如`>shell cmd`，将启动一个命令 shell（例如，这对于检查哪些环境变量被传递给 Visual Studio 很有用）。`>cls`将清除屏幕。

以下是非常常用的命令列表，它们有自己的别名：[https ://msdn.microsoft.com/en-us/library/c3a0kd3x.aspx](https://msdn.microsoft.com/en-us/library/c3a0kd3x.aspx)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-11-22T07:56:32.830

立即窗口用于调试和评估表达式、执行语句、打印变量值等等。它允许您在调试期间输入要由开发语言评估或执行的表达式。

要显示即时窗口，请选择 Debug >Windows >Immediate 或按 Ctrl-Alt-I

[![在此处输入图像描述](https://i.stack.imgur.com/6Lplq.png)](https://i.stack.imgur.com/6Lplq.png)

这是立即窗口的示例：

```
int Sum(int x, int y) { return (x + y);}
void main(){
int a, b, c;
a = 5;
b = 7;
c = Sum(a, b);
char temp = getchar();} 
```

添加断点

[![在此处输入图像描述](https://i.stack.imgur.com/WV9Eq.png)](https://i.stack.imgur.com/WV9Eq.png)

调用命令

[![在此处输入图像描述](https://i.stack.imgur.com/jzU1p.png)](https://i.stack.imgur.com/jzU1p.png)

[https://msdn.microsoft.com/en-us/library/f177hahy.aspx](https://msdn.microsoft.com/en-us/library/f177hahy.aspx)

# design-patterns - 公司和联系人 对象设计帮助

> ID：794263
> 
> 赞同：3
> 
> 时间：2009-04-27T16:28:38.337
> 
> 标签：design-patterns, ooad

我希望有人（或某些人）可以帮助我们解决我们已经争论了几天的问题。给定附图，如何组织我们的业务对象？

我们正在寻找任何帮助（关于在哪里或如何搜索我们可以用来解决这个问题的设计模式/对象模型的想法。我们的情况稍微复杂一些，但我们试图为了问这个问题，我们尽可能地简化它。

一些细节：有些公司有产品线，有些没有。
每个公司都有一个联系人列表。如果一家公司至少有一个产品线，那么其中一些公司联系人也与至少一个产品线相关联。
一些联系人是其他联系人的参考（业务/个人）。
每个公司和每个联系人可以有零个或多个地址。

感谢您在寻找更合适的解决方案时提供的任何帮助（我的假设是我们将需要使用多个模型/模式）。

![实体图](https://farm4.static.flickr.com/3540/3480423086_deafb0e200.jpg)

[图的大图 (flickr.com)](http://www.flickr.com/photos/9844492@N08/3480423086/sizes/o/)

**（来自图表）我们公司的员工/内部应用程序用户包含在联系人中，因为他们也可以是参考等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T16:38:09.670

您可以使用以下对象模型：

```
Organization
-id
-name
-description
-productLines ( collection object consisting of products)
-orgcontacts ( collection object consisting of contacts)
-addresses (of type Address, can be a collection depends on business rule)

Contact
-id
-name
-type (Business, personal, etc)
-parentID (null if no reference)
-adresses (Address or collection)

ProductLine
-id
-name
-prLineContacts ( collection object consisting of contacts) 
```

你可以建立在我能想到的这个基本模型上。你有数据模式吗？如果是这样，您应该决定从哪里开始。有些人喜欢他们的对象和数据模型之间的 1-1 映射，有些人希望根据性能设计他们的数据模式，然后在对象和数据库之间有另一个抽象映射。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T16:36:22.293

如果您正在尝试设计数据库，我会这样做：

```
Companies = [id, name]
Contacts = [id, name]
Products = [id, name]
Adresses = [id, details]

CompaniesContacts = [contact_id, company_id]
CompaniesProducts = [product_id, company_id]
AdressesContacts = [contact_id, address_id]

References = [contact_id, referenced] // referenced is also a contact_id 
```

另外，我建议使用 UML。这只是一个快速的答案，尝试更新你的问题，我会更新一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T16:37:48.627

我们的应用程序中有一个类似的结构，它对我们很有效。我们有两张额外的桌子

我们有公司和地址之间的站点的概念，人们可以在我们的架构中附加一个或多个站点，这样可以节省存储数千个重复地址。您也可以直接在地址簿中引用客户端地址。

您在哪里存储联系方式？

# sifr - sifr 的文本对齐语法？

> ID：794270
> 
> 赞同：0
> 
> 时间：2009-04-27T16:29:43.857
> 
> 标签：sifr, text-alignment, text-align

我无法找到 sifr 的文本对齐功能的用法/语法。此功能在 flashvars 参数中正确吗？那么它会是这样的：

sIFR.replace(fontname, { 选择器: 'h1', wmode: '透明', flashvars: 'textalign=center' });

我使用 r436 构建尝试了上述方法，但没有成功。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T16:34:40.257

显然您只需要编辑 all.css 文件。[这里](http://www.coffeecup.com/help/articles/how-do-i-change-the-text-alignment/)有人在谈论这个。

如果您不想更改根元素的 css 样式，则可以使用 sifr 指定要应用的 CSS 选择`sSelector`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T21:35:12.343

您混淆了 sIFR 2 和 3 的语法。`flashvars`不再存在，对于 sIFR 3，请在替换 CSS 中指定它：

```
sIFR.replace(fontname, { selector: 'h1', css: '.sIFR-root { textalign: center; }' }); 
```

您也可以`background-color`在此处指定，因此您不需要使用透明度。

# ruby-on-rails - 将 Ruby Gem 类比为 Java JAR 是否有效？

> ID：794273
> 
> 赞同：16
> 
> 时间：2009-04-27T16:29:56.833
> 
> 标签：ruby-on-rails, ruby, programming-languages, rubygems

我相信我已经非常清楚和简洁地提出了这个问题。我为什么要问？

我要向学生解释 Ruby on Rails 框架，这需要我对 Java 世界进行一些类比（因为该课程非常以 Java 为中心）。我没有使用 Ruby on Rails 的实践经验，但我觉得 Gem/Jar 类比是一个有效的类比。

任何人都可以对这个问题有更多的了解吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-27T16:59:22.130

作为一个简短的回答，我会说：是的，它是有效的。

作为一个长答案，我会说：是的，它是有效的，但是您可能还想描述一些重要的区别。

罐子有一些特质，使它与宝石有很大不同。JAR 是打包的可执行库，您通常必须在调用时在 Java 程序的执行中显式声明依赖项（通过在调用 java 解释器时将 jar 声明为依赖项）。除了一些定义良好的文件位置（例如，目录结构必须镜像包路径）之外，jar 几乎没有强制执行它的结构。

Gem 是用于将库永久安装到系统的描述符，以及可在运行时声明为依赖项的功能包。gem 有一个严格的版本控制语法作为其定义的一部分，并且 gem 往往从几个集中的存储库中分发，这些存储库花费了大量的精力来确保 gem 名称的唯一性。Gems 可以显式声明它们对其他 gems 的依赖关系。（与 JAR 相比，您必须确保在调用时满足 jar 的所有依赖项，并且 jar 没有明确承担依赖声明或解析的责任）。此外，gem 工具中内置了一些非常方便的可选功能，例如，如果用户希望，您可以为要调用的 gem 声明一个默认可执行文件“

此外，您可能想向您的学生描述 RubyGems 是一个独立于 Ruby 语言本身创建的工具，并且在多年的 Java 开发中充分暴露了管理 jar 引起的许多不便和抱怨之后，它受益匪浅。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-27T16:49:20.813

我不确定是不是很容易...

我觉得 Gem 和 jar 基本上是一样的，但是 Gem 必须有名字和版本，jar 没有这个，嗯，比方说……，限制。

Jar 机制是为打包而创建的，并且只是为了打包。恕我直言，Gem 中最重要的是 RubyGems 项目 RubyGems 功能集比打包要大一些，涉及到包分发和安装。

我认为 Apache Maven 分发和安装机制是 Java 社区与 Ruby Gems 最接近的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-27T17:10:49.310

作为一个简单的解释，将它们与 JAR 进行比较对于基本的 Ruby 类来说已经足够了。有关更详细的解释，请参阅 Holychao 的答案。我想到的一个比喻是，Gem 之于 Ruby，就像 CPAN 之于 Perl。

# linq - Linq-to-entities - Include() 方法未加载

> ID：794283
> 
> 赞同：46
> 
> 时间：2009-04-27T16:32:06.877
> 
> 标签：linq, entity-framework

如果我使用连接，则 Include() 方法不再起作用，例如：

```
from e in dc.Entities.Include("Properties")
join i in dc.Items on e.ID equals i.Member.ID
where (i.Collection.ID == collectionID) 
select e 
```

`e.Properties`未加载

没有连接， Include() 工作

李

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-05-06T00:52:50.490

更新：实际上我最近添加了另一个技巧，涵盖了这一点，并提供了一个替代的可能更好的解决方案。这个想法是将 Include() 的使用延迟到查询结束，有关更多信息，请参阅：[Tip 22 - How to make include 真正包含](http://blogs.msdn.com/alexj/archive/2009/06/02/tip-22-how-to-make-include-really-include.aspx)

* * *

使用 Include() 时，实体框架中存在已知限制。Include 不支持某些操作。

看起来你可能已经遇到了这些限制，要解决这个问题，你应该尝试这样的事情：

```
var results = 
   from e in dc.Entities //Notice no include
   join i in dc.Items on e.ID equals i.Member.ID
   where (i.Collection.ID == collectionID) 
   select new {Entity = e, Properties = e.Properties}; 
```

这将带回属性，如果实体和属性之间的关系是一对多（但不是多对多），您会发现每个生成的匿名类型在以下位置具有相同的值：

```
anonType.Entity.Properties
anonType.Properties 
```

这是实体框架中称为关系修复的功能的副作用。

有关更多信息，请参阅我的[EF 技巧系列中的技](http://blogs.msdn.com/alexj/archive/2009/03/26/index-of-tips.aspx)[​​巧 1](http://blogs.msdn.com/alexj/archive/2009/02/25/tip-1-sorting-relationships-in-entity-framework.aspx)。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-04-19T19:18:59.803

试试这个：

```
var query = (ObjectQuery<Entities>)(from e in dc.Entities
            join i in dc.Items on e.ID equals i.Member.ID
            where (i.Collection.ID == collectionID) 
            select e)

return query.Include("Properties") 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-28T13:31:00.627

那么“实体”上与“Item.Member”相关的导航属性的名称是什么（即，导航的另一端）。您应该使用它而不是连接。例如，如果“实体”添加了一个名为 Member 的属性，其基数为 1，而 Member 有一个名为 Items 的属性，其基数为 many，你可以这样做：

```
from e in dc.Entities.Include("Properties")
where e.Member.Items.Any(i => i.Collection.ID == collectionID) 
select e 
```

我在这里猜测您模型的属性，但这应该会给您一个大致的想法。*在大多数情况下，在 LINQ to Entities 中使用 join 是错误*的，因为它表明您的导航属性设置不正确，或者您没有使用它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-01T21:28:33.743

所以，我意识到我在这里聚会迟到了，但我想我会添加我的发现。这真的应该是对亚历克斯詹姆斯帖子的评论，但由于我没有声誉，它必须到这里。

所以我的回答是：它似乎根本不像你想要的那样工作。Alex James 提供了两个有趣的解决方案，但是如果您尝试它们并检查 SQL，那就太可怕了。

我正在处理的示例是：

```
 var theRelease = from release in context.Releases
                         where release.Name == "Hello World"
                         select release;

        var allProductionVersions = from prodVer in context.ProductionVersions
                                    where prodVer.Status == 1
                                    select prodVer;

        var combined = (from release in theRelease
                        join p in allProductionVersions on release.Id equals p.ReleaseID
                        select release).Include(release => release.ProductionVersions);              

        var allProductionsForChosenRelease = combined.ToList(); 
```

这遵循两个示例中较简单的一个。如果没有包含，它会产生非常受人尊敬的 sql：

```
SELECT 
    [Extent1].[Id] AS [Id], 
    [Extent1].[Name] AS [Name]
    FROM  [dbo].[Releases] AS [Extent1]
    INNER JOIN [dbo].[ProductionVersions] AS [Extent2] ON [Extent1].[Id] = [Extent2].[ReleaseID]
    WHERE ('Hello World' = [Extent1].[Name]) AND (1 = [Extent2].[Status]) 
```

但是，天哪：

```
SELECT 
[Project1].[Id1] AS [Id], 
[Project1].[Id] AS [Id1], 
[Project1].[Name] AS [Name], 
[Project1].[C1] AS [C1], 
[Project1].[Id2] AS [Id2], 
[Project1].[Status] AS [Status], 
[Project1].[ReleaseID] AS [ReleaseID]
FROM ( SELECT 
    [Extent1].[Id] AS [Id], 
    [Extent1].[Name] AS [Name], 
    [Extent2].[Id] AS [Id1], 
    [Extent3].[Id] AS [Id2], 
    [Extent3].[Status] AS [Status], 
    [Extent3].[ReleaseID] AS [ReleaseID],
    CASE WHEN ([Extent3].[Id] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C1]
    FROM   [dbo].[Releases] AS [Extent1]
    INNER JOIN [dbo].[ProductionVersions] AS [Extent2] ON [Extent1].[Id] = [Extent2].[ReleaseID]
    LEFT OUTER JOIN [dbo].[ProductionVersions] AS [Extent3] ON [Extent1].[Id] = [Extent3].[ReleaseID]
    WHERE ('Hello World' = [Extent1].[Name]) AND (1 = [Extent2].[Status])
)  AS [Project1]
ORDER BY [Project1].[Id1] ASC, [Project1].[Id] ASC, [Project1].[C1] ASC 
```

总垃圾。这里要注意的关键点是它返回了不受status=1限制的表的外连接版本。

这会导致返回错误的数据：

```
Id  Id1 Name        C1  Id2 Status  ReleaseID
2   1   Hello World 1   1   2       1
2   1   Hello World 1   2   1       1 
```

请注意，尽管我们有限制，但仍将返回 2 的状态。它根本行不通。如果我在某个地方出错了，我会很高兴发现，因为这是对 Linq 的嘲弄。我喜欢这个想法，但目前执行似乎不可用。

* * *

出于好奇，我尝试了 LinqToSQL dbml 而不是产生上述混乱的 LinqToEntities edmx：

```
SELECT [t0].[Id], [t0].[Name], [t2].[Id] AS [Id2], [t2].[Status], [t2].[ReleaseID], (
    SELECT COUNT(*)
    FROM [dbo].[ProductionVersions] AS [t3]
    WHERE [t3].[ReleaseID] = [t0].[Id]
    ) AS [value]
FROM [dbo].[Releases] AS [t0]
INNER JOIN [dbo].[ProductionVersions] AS [t1] ON [t0].[Id] = [t1].[ReleaseID]
LEFT OUTER JOIN [dbo].[ProductionVersions] AS [t2] ON [t2].[ReleaseID] = [t0].[Id]
WHERE ([t0].[Name] = @p0) AND ([t1].[Status] = @p1)
ORDER BY [t0].[Id], [t1].[Id], [t2].[Id] 
```

稍微紧凑一些 - 奇怪的计数子句，但总体上相同的总失败。

有没有人在真正的商业应用程序中使用过这些东西？我真的开始怀疑......请告诉我我错过了一些明显的东西，因为我真的很想喜欢 Linq！

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-27T16:56:45.443

尝试更详细的方法~~来做或多或少相同的事情~~获得相同的结果，但有更多的数据调用：

```
var mydata = from e in dc.Entities
             join i in dc.Items 
                 on e.ID equals i.Member.ID 
             where (i.Collection.ID == collectionID) 
             select e;

foreach (Entity ent in mydata) {
    if(!ent.Properties.IsLoaded) { ent.Properties.Load(); }
} 
```

你仍然得到相同的（意外）结果吗？

**编辑**：更改了第一句话，因为它不正确。感谢您的指针评论！

# java - Java3d 行为和运动

> ID：794284
> 
> 赞同：1
> 
> 时间：2009-04-27T16:32:19.060
> 
> 标签：java, java-3d

我想在一个简单的宇宙中沿随机方向移动一个球体。我如何通过逐帧更改少量位置的行为来实现这一点。我尝试这样做的原因是在宇宙中产生随机运动，并最终在粒子之间建立简单的碰撞检测。

任何建议/链接将不胜感激

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-03T15:56:46.007

使用以下框架添加一个扩展 Behavior 的新类：

```
public class XXXBehavior extends Behavior
{
    private WakeupCondition wc = new WakeupOnElapsedTimer(1000); // 1000 ms

    public void initialize()
    {
        wakeupOn(wc);
    }

    public void processStimulus(Enumeration criteria)
    {
        // Move the shape here

        // prepare for the next update
        wakeupOn(wc);
    }
} 
```

稍后您需要实例化该类并将其添加到场景图中。你还需要定义边界，否则什么都不会发生！

```
xxxEffect = new XXXBehavior();
xxxEffect.setSchedulingBounds(bounds);
sceneBG.addChild(xxxEffect); 
```

# ruby-on-rails - rails :url 参数中的 javascript

> ID：794288
> 
> 赞同：1
> 
> 时间：2009-04-27T16:33:18.870
> 
> 标签：ruby-on-rails

我想创建一个 drop_receiving_element ，其中 :url 包含 javascript。目前我刚刚创建了一个辅助函数并将元素硬编码如下：

```
def create_classification_droppable(droppable_id, classification)
  "<script type='text/javascript'>
    //<![CDATA[
      Droppables.add('#{droppable_id}', {accept:'lead', onDrop:function(element){new Ajax.Request('/leads/' + (element.id.split('_').last()) + '.js', {asynchronous:true, evalScripts:true, method:'put', parameters:'lead[classification]=#{classification}&authenticity_token=' + encodeURIComponent('#{form_authenticity_token}')})}})
    //]]>
  </script>"
end 
```

不过，这非常骇人听闻。理想情况下，我想做类似的事情：

```
drop_receiving_element('some_class',                 
  :accept => 'some_other_class',
  :url    => formatted_whatever_path( SOMETHING_BASED_ON_WHATEVER_IS_BEING_DROPPED ) ) 
```

或者

```
formatted_whatever_path(:id => "some_javascript", :js) 
```

不幸的是，这似乎不可能，因为 url 在调用链的下游被转义了（我相信在 url_for 中）。有哪些替代方案？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-31T10:40:33.310

您使用的是什么版本的导轨？如果您使用的是 2.3.8，那么您的“转义”可能仅仅是因为“字符串添加错误”： [https ://rails.lighthouseapp.com/projects/8994/tickets/4695-string-added-to-rails_helpers -gets-html-转义](https://rails.lighthouseapp.com/projects/8994/tickets/4695-string-added-to-rails_helpers-gets-html-escaped)

您可以通过在它周围找到巧妙的技巧来修复它（例如，将您的字符串包含在“#{my_string}”中以重新评估它）或降级到 2.3.5。

# objective-c - 如何在全屏 UIScrollView 中居中 UIImageView？

> ID：794294
> 
> 赞同：20
> 
> 时间：2009-04-27T16:34:49.817
> 
> 标签：objective-c, iphone, uiscrollview, uiimageview, fullscreen

在我的应用程序中，我想向用户展示一个全屏照片查看器，就像在照片应用程序中使用的那样。这仅适用于单张照片，因此应该非常简单。我只希望用户能够查看这张具有缩放和平移功能的照片。

我有大部分工作。而且，如果我不将我的 UIImageView 居中，一切都会完美运行。但是，当图像充分缩小时，我真的希望 UIImageView 在屏幕上居中。我不希望它粘在滚动视图的左上角。

一旦我试图使这个视图居中，我的垂直可滚动区域似乎比它应该的要大。因此，一旦我放大一点，我就可以滚动超过图像顶部约 100 像素。我究竟做错了什么？

```
@interface MyPhotoViewController : UIViewController <UIScrollViewDelegate>
{
    UIImage* photo;
    UIImageView *imageView;
}
- (id)initWithPhoto:(UIImage *)aPhoto;
@end

@implementation MyPhotoViewController

- (id)initWithPhoto:(UIImage *)aPhoto
{
    if (self = [super init])
    {
        photo = [aPhoto retain];

        // Some 3.0 SDK code here to ensure this view has a full-screen
        // layout.
    }

    return self;
}

- (void)dealloc
{
    [photo release];
    [imageView release];
    [super dealloc];
}

- (void)loadView
{
    // Set the main view of this UIViewController to be a UIScrollView.
    UIScrollView *scrollView = [[UIScrollView alloc] init];
    [self setView:scrollView];
    [scrollView release];
}

- (void)viewDidLoad
{
    [super viewDidLoad];

    // Initialize the scroll view.
    CGSize photoSize = [photo size];
    UIScrollView *scrollView = (UIScrollView *)[self view];
    [scrollView setDelegate:self];
    [scrollView setBackgroundColor:[UIColor blackColor]];

    // Create the image view. We push the origin to (0, -44) to ensure
    // that this view displays behind the navigation bar.
    imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0.0, -44.0,
        photoSize.width, photoSize.height)];
    [imageView setImage:photo];
    [scrollView addSubview:imageView];

    // Configure zooming.
    CGSize screenSize = [[UIScreen mainScreen] bounds].size;
    CGFloat widthRatio = screenSize.width / photoSize.width;
    CGFloat heightRatio = screenSize.height / photoSize.height;
    CGFloat initialZoom = (widthRatio > heightRatio) ? heightRatio : widthRatio;
    [scrollView setMaximumZoomScale:3.0];
    [scrollView setMinimumZoomScale:initialZoom];
    [scrollView setZoomScale:initialZoom];
    [scrollView setBouncesZoom:YES];
    [scrollView setContentSize:CGSizeMake(photoSize.width * initialZoom,
        photoSize.height * initialZoom)];

    // Center the photo. Again we push the center point up by 44 pixels
    // to account for the translucent navigation bar.
    CGPoint scrollCenter = [scrollView center];
    [imageView setCenter:CGPointMake(scrollCenter.x,
        scrollCenter.y - 44.0)];
}

- (void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    [[[self navigationController] navigationBar] setBarStyle:UIBarStyleBlackTranslucent];
    [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleBlackTranslucent animated:YES];
}

- (void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];
    [[[self navigationController] navigationBar] setBarStyle:UIBarStyleDefault];
    [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDefault animated:YES];
}

- (UIView *)viewForZoomingInScrollView:(UIScrollView *)scrollView
{
    return imageView;
}

@end 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-08-13T17:00:00.993

这段代码应该可以在大多数版本的 iOS 上运行（并且已经过测试可以在 3.1 以上版本上运行）。

它基于[PhotoScroller 的 Apple WWDC 代码](http://developer.apple.com/library/ios/#samplecode/PhotoScroller/Introduction/Intro.html "PhotoScroller 示例代码")。

将以下内容添加到您的子类中`UIScrollView`，并替换`tileContainerView`为包含您的图像或图块的视图：

```
- (void)layoutSubviews {
    [super layoutSubviews];

    // center the image as it becomes smaller than the size of the screen
    CGSize boundsSize = self.bounds.size;
    CGRect frameToCenter = tileContainerView.frame;

    // center horizontally
    if (frameToCenter.size.width < boundsSize.width)
        frameToCenter.origin.x = (boundsSize.width - frameToCenter.size.width) / 2;
    else
        frameToCenter.origin.x = 0;

    // center vertically
    if (frameToCenter.size.height < boundsSize.height)
        frameToCenter.origin.y = (boundsSize.height - frameToCenter.size.height) / 2;
    else
        frameToCenter.origin.y = 0;

    tileContainerView.frame = frameToCenter;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-29T21:24:55.003

你检查过 UIViewAutoresizing 选项吗？

（来自文档）

```
UIViewAutoresizing
Specifies how a view is automatically resized.

enum {
   UIViewAutoresizingNone                 = 0,
   UIViewAutoresizingFlexibleLeftMargin   = 1 << 0,
   UIViewAutoresizingFlexibleWidth        = 1 << 1,
   UIViewAutoresizingFlexibleRightMargin  = 1 << 2,
   UIViewAutoresizingFlexibleTopMargin    = 1 << 3,
   UIViewAutoresizingFlexibleHeight       = 1 << 4,
   UIViewAutoresizingFlexibleBottomMargin = 1 << 5
};
typedef NSUInteger UIViewAutoresizing; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T04:35:29.757

您是否使用 IB 添加滚动视图？将滚动视图的自动调整大小选项更改为附加图像。 [![替代文字](https://i.stack.imgur.com/jmwuz.jpg)](https://i.stack.imgur.com/jmwuz.jpg)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-04T19:22:32.593

我认为其背后的原因是因为 zoomScale 适用于整个 contentSize，而不管 scrollView 内的子视图的实际大小（在你的情况下它是一个 imageView）。contentSize 高度似乎总是等于或大于 scrollView 框架的高度，但永远不会更小。因此，当对其应用缩放时，contentSize 的高度也会乘以 zoomScale 因子，这就是为什么您会获得额外的 100 像素左右的垂直滚动。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-27T21:29:43.993

您可能希望设置滚动视图的边界 = 图像视图的边界，然后将滚动视图置于其包含视图的中心。如果您将视图放置在滚动视图中与顶部偏移的位置，您将获得其上方的空白空间。

# c# - 这个类是线程安全的吗？

> ID：794308
> 
> 赞同：2
> 
> 时间：2009-04-27T16:39:35.063
> 
> 标签：c#, multithreading

这个 ValueStore 类是线程安全的吗？GetInt(string key) 中的锁定范围是否需要围绕收益返回进行扩展？

```
public class ValueStore
{
  private readonly object _locker = new object();
  private readonly Dictionary<string, int> _data = 
    new Dictionary<string, int>();

  public ValueStore(Dictionary<string, int> data)
  {
    _data = data;
  }

  public IEnumerable<int> GetInt(string key)
  {
    IEnumerable<KeyValuePair<string, int>> selected;
    lock(_locker)
    {
      selected = _data.Where(x => x.Key.Equals(key));
    }

    foreach (KeyValuePair<string, int> pair in selected)
    {
      yield return pair.Value;
    }
  }
} 
```

单元测试似乎很好：

```
[TestFixture]
public class ValueStoreTest
{
  [Test]
  public void test1()
  {
    Dictionary<string, int> data = new Dictionary<string, int>();
    for (int i = 0; i < 100000; i++)
    {
      data.Add(i.ToString(),i);
    }

    ValueStore vs = new ValueStore(data);

    for (int i = 0; i < 900000; i++)
    {
      ThreadPool.QueueUserWorkItem(delegate
      {
        for (int j = 0; j < 100000; j++)
        {
          IEnumerable<int> d = vs.GetInt(j.ToString());
        }
      });
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-27T16:44:56.160

不，它绝对不是线程安全的。

它使用客户端传入的字典这一事实意味着您无法控制客户端何时更改它。您也只是在应用该`Where`子句时才锁定它——但这实际上根本不执行任何迭代。您需要在迭代结果时保持锁定 - 但正如我之前所说，它不会阻止客户端随时更改字典。

如果您在类中创建了字典并且只公开了其中的数据（即保护它不受外界影响），您可以使其完全线程安全。如果您坚持客户端代码不会改变字典，那么您根本不需要锁，因为当没有作者时，字典可以安全地从多个线程中读取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T16:46:46.497

我可以告诉你，锁中的语句直到锁被释放后才会执行。如果您必须在迭代期间锁定集合，则将 yield 移到 lock 语句中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T16:48:16.213

不它不是。如果您开始读取和写入`Dictionary<string, int>`传递给构造函数的对象，那么您就会遇到问题。您的类声明`_data`会立即被构造函数中的赋值覆盖。

要更正此问题，请将构造函数中传入的每个键/值对复制`Dictionary`到您的类中，`Dictionary`而不是直接赋值。

然后，我认为你是线程安全的，但显然你的类是只读的。

# asp.net-mvc - 从 asp.net POST 操作方法更新休眠实体的正确方法是什么？

> ID：794314
> 
> 赞同：8
> 
> 时间：2009-04-27T16:40:21.693
> 
> 标签：asp.net-mvc, nhibernate

我是 nHibernate 的新手，并试图了解从 Web 应用程序表单 POST 更新分离对象的正确方法。（我们使用的是 ASP.NET MVC）

我要更新的对象包含（除其他外）子对象的 IList，映射如下：

```
<bag name="PlannedSlices" inverse="true" cascade="all-delete-orphan">
      <key column="JobNumber" />
      <one-to-many class="SliceClass" />
</bag> 
```

我们已经安排了我们的 MVC 编辑视图表单，以便当它被回发时，我们的操作方法被传递给一个对象（包括子项的 List<>。我们通过表单正确地往返所有实体 ID。

我们对 post 操作方法的天真尝试执行 session.SaveOrUpdate(parentObject)，其 parentObject 已由默认模型绑定器从视图表单中抓取。

这似乎适用于以下任何情况：

*   创建一个新的父对象
*   修改父属性
*   添加新的子对象
*   修改现有的子对象（查看 nHibernate 日志，我可以看到它正确地确定对象是新的还是现有的，并发出适当的 UPDATE 或 INSERT）

失败的情况是： - 删除子对象 - 即，如果它们不在 IList 中，它们不会从数据库中删除。没有例外或任何东西，它们只是不会被删除。

我的理解是，这是因为 nHibernate 执行创建需要删除的子列表的魔法不适用于分离实例。

我还没有找到一个简单的例子来说明这种动作方法在 nHibernate 中应该是什么样子（即使用模型绑定器对象作为分离的 nHibernate 实例） - 基于 MS EF 的示例（例如[http://stephenwalther. com/blog/archive/2009/02/27/chapter-5-understanding-models.aspx](http://stephenwalther.com/blog/archive/2009/02/27/chapter-5-understanding-models.aspx)）似乎使用“ApplyPropertyChanges”方法将更改的属性从模型绑定对象复制到重新加载的实体实例。

所以，毕竟，问题很简单——如果我有模型绑定器给我一个包含子对象集合的新对象，我应该如何通过 nHibernate 更新它（其中“更新”可能包括删除子对象）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T19:50:07.650

这是一个我认为你正在尝试做的例子。如果我误解了您要执行的操作，请告诉我。

给定以下“域”类：

```
public class Person
{
    private IList<Pet> pets;

    protected Person()
    { }

    public Person(string name)
    {
        Name = name;
        pets = new List<Pet>();
    }

    public virtual Guid Id { get; set; }
    public virtual string Name { get; set; }
    public virtual IEnumerable<Pet> Pets
    {
        get { return pets; }
    }

    public virtual void AddPet(Pet pet)
    {
        pets.Add(pet);
    }

    public virtual void RemovePet(Pet pet)
    {
        pets.Remove(pet);
    }
}

public class Pet
{
    protected Pet()
    { }

    public Pet(string name)
    {
        Name = name;
    }

    public virtual Guid Id { get; set; }
    public virtual string Name { get; set; }
} 
```

使用以下映射：

```
 public class PersonMap : ClassMap<Person>
    {
        public PersonMap()
        {
            LazyLoad();
            Id(x => x.Id).GeneratedBy.GuidComb();
            Map(x => x.Name);
            HasMany(x => x.Pets)
                   .Cascade.AllDeleteOrphan()
                   .Access.AsLowerCaseField()
                   .SetAttribute("lazy", "false");
        }
    }

    public class PetMap : ClassMap<Pet>
    {
        public PetMap()
        {
            Id(x => x.Id).GeneratedBy.GuidComb();
            Map(x => x.Name);
        }
    } 
```

本次测试：

```
 [Test]
    public void CanDeleteChildren()
    {
        Person person = new Person("joe");

        Pet dog = new Pet("dog");
        Pet cat = new Pet("cat");

        person.AddPet(dog);
        person.AddPet(cat);

        Repository.Save(person);

        UnitOfWork.Commit();

        CreateSession();
        UnitOfWork.BeginTransaction();

        Person retrievedPerson = Repository.Get<Person>(person.Id);
        Repository.Evict(retrievedPerson);

        retrievedPerson.Name = "Evicted";

        Assert.AreEqual(2, retrievedPerson.Pets.Count());
        retrievedPerson.RemovePet(retrievedPerson.Pets.First());

        Assert.AreEqual(1, retrievedPerson.Pets.Count());

        Repository.Save(retrievedPerson);

        UnitOfWork.Commit();

        CreateSession();
        UnitOfWork.BeginTransaction();

        retrievedPerson = Repository.Get<Person>(person.Id);
        Assert.AreEqual(1, retrievedPerson.Pets.Count());
    } 
```

运行并生成以下 sql：

DeletingChildrenOfEvictedObject.CanDeleteChildren : 通过 NHibernate: INSERT INTO [Person] (Name, Id) VALUES (@p0, @p1); @p0 = '乔'，@p1 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'

NHibernate: INSERT INTO [Pet] (Name, Id) VALUES (@p0, @p1); @p0 = '狗'，@p1 = '464e59c7-74d0-4317-9c22-9bf801013abb'

NHibernate: INSERT INTO [Pet] (Name, Id) VALUES (@p0, @p1); @p0 = '猫'，@p1 = '010c2fd9-59c4-4e66-94fb-9bf801013abb'

NHibernate: UPDATE [Pet] SET Person_id = @p0 WHERE Id = @p1; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'，@p1 = '464e59c7-74d0-4317-9c22-9bf801013abb'

NHibernate: UPDATE [Pet] SET Person_id = @p0 WHERE Id = @p1; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'，@p1 = '010c2fd9-59c4-4e66-94fb-9bf801013abb'

NHibernate: SELECT person0_.Id as Id5_0_, person0_.Name as Name5_0_ FROM [Person] person0_ WHERE person0_.Id=@p0; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'

NHibernate: SELECT pets0_.Person_id as Person3_1_, pets0_.Id as Id1_, pets0_.Id as Id6_0_, pets0_.Name as Name6_0_ FROM [Pet] pets0_ WHERE pets0_.Person_id=@p0; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'

NHibernate: UPDATE [Person] SET Name = @p0 WHERE Id = @p1; @p0 = '驱逐'，@p1 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'

NHibernate: UPDATE [Pet] SET Name = @p0 WHERE Id = @p1; @p0 = 'dog'，@p1 = '464e59c7-74d0-4317-9c22-9bf801013abb' NHibernate：更新 [宠物] SET Person_id = null WHERE Person_id = @p0 AND Id = @p1; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'，@p1 = '010c2fd9-59c4-4e66-94fb-9bf801013abb'

NHibernate：从 [Pet] 中删除 Id = @p0；@p0 = '010c2fd9-59c4-4e66-94fb-9bf801013abb'

NHibernate: SELECT person0_.Id as Id5_0_, person0_.Name as Name5_0_ FROM [Person] person0_ WHERE person0_.Id=@p0; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'

NHibernate: SELECT pets0_.Person_id as Person3_1_, pets0_.Id as Id1_, pets0_.Id as Id6_0_, pets0_.Name as Name6_0_ FROM [Pet] pets0_ WHERE pets0_.Person_id=@p0; @p0 = 'cd123fc8-6163-42a5-aeeb-9bf801013ab2'

注意从 [宠物] 中删除...

因此，您需要做的是使用修改后的集合手动休眠一个 Person 对象（在此示例中），它应该能够确定要删除的内容。确保您设置了 Cascade.AllDeleteOrphan() 属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T20:44:47.033

Rob 的回答说服我更仔细地研究“将现有项目加载到新会话中然后合并”的方法，当然还有 ISession.Merge，它似乎完全符合我的要求，即获取一个新对象并将它与刚刚重新加载到第二个会话的前任合并。

所以我认为我试图问的问题的答案是“重新加载现有实体，然后用新实体调用'ISession.Merge'”。

# sql-server-2005 - SQL Server 分析问题-我的多维数据集损坏，声称找不到存在的列

> ID：794319
> 
> 赞同：1
> 
> 时间：2009-04-27T16:40:55.717
> 
> 标签：sql-server-2005, ssas, olap

我正在尝试自己学习 SSAS，但无法理解我的立方体的问题。我有一个数据库项目，我想在其中对单个表进行报告。我知道这有点不寻常，但它是一个相对简单的模型，并且数据已经被规范化到那个表中。它有两列作为维度——拍卖结束时间和产品类型。有许多衡量标准，包括售出物品的数量和售价。在 SSAS 中设置多维数据集和维度并进行处理后，它工作正常，我可以浏览多维数据集。我可以从 SAS 或我制作的 SSRS 报告中浏览多维数据集。

但是，如果我稍后再回来，我将无法再更新多维数据集。支持多维数据集的表模式没有改变，尽管有新行。当我在 SSAS 中“处理多维数据集”时，出现此错误：

> OLAP 存储引擎中的错误：找不到属性键：表：dbo_ScrapedAuction，列：Id，值：76878。 OLAP 存储引擎中的错误：由于找不到属性键，因此跳过了记录。属性：Id of Dimension：Scraped Auction from Database：SSAS，Cube：Ebay Scraper，度量组：Scraped Auction，分区：Scraped Auction，记录：2913。OLAP 存储引擎中的错误：由于遇到的错误数量，流程操作结束在处理过程中达到了定义的操作允许错误限制。OLAP 存储引擎中的错误：处理来自 SSAS 数据库的“Ebay Scraper”多维数据集的“Scraped Auction”度量组的“Scraped Auction”分区时发生错误。

肯定有一个表 [dbo].[ScrapedAuction]，它仍然有 [Id] 列，并且表中有一行我可以用 Id 76878 查询。有谁知道我遇到了什么问题? 我通过重新创建立方体来解决这个问题......这不是生产系统的真正解决方案。

# c++ - 他们是否将copy_if添加到c ++ 0x？

> ID：794320
> 
> 赞同：7
> 
> 时间：2009-04-27T16:41:04.373
> 
> 标签：c++, algorithm, c++11

`copy_if`不在 C++ 中很烦人。有谁知道它是否会在 C++0x 中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-27T16:55:10.050

由于 C++0x 还没有定稿，所以只能看看最新的[草稿](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2857.pdf)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-28T10:24:29.340

与此同时，自己制作`copy_if()`using并不难`remove_copy_if()`：

```
#include <functional>

struct my_predicate : std::unary_function<my_arg_type, bool> {
    bool operator()(my_arg_type const& x) const { ... }
};

// To perform "copy_if(x, y, z, my_predicate())", write:
remove_copy_if(x, y, z, std::not1(my_predicate())); 
```

Using`not1()`需要你的谓词类提供一个嵌套类型，`argument_type`，标识参数的类型——如上所示，一种方便的方法是派生自`unary_function<T, U>`，`T`参数类型在哪里。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-05-10T09:36:46.387

为了完整起见，如果有人用他/她的方式搜索这个问题，应该提到现在（在 C++11 及更高版本中）**有**一个[**if**](http://www.cplusplus.com/reference/algorithm/copy_if/)算法的副本。它的行为符合预期（将某个谓词返回 true 的范围内的元素复制到另一个范围）。

一个典型的用例是

```
std::vector<int> foo{ 25, 15, 5, -5, -15 };
std::vector<int> bar;

// copy only positive numbers:
auto it = std::copy_if (foo.begin(), foo.end(), std::back_inserter(bar), 
            [](int i){return !(i<0);
          }); 
```

# asp.net - IIS 6.0 和 ASP.NET - 无法写入输出文件...目录名称无效

> ID：794323
> 
> 赞同：8
> 
> 时间：2009-04-27T16:41:34.467
> 
> 标签：asp.net, iis, asp.net-2.0, temporary-asp.net-files

我在 Windows 2003 上运行 IIS 6.0 并开始收到此错误：

`Compiler Error Message: CS0016: Could not write to output file 'c:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root\7382c13f\ea9b3ff7\App_global.asax.zodyof_q.dll' -- 'The directory name is invalid. '`

我已经检查了所有权限，一切都符合要求 - 另外，错误消息没有提及权限。我已经尝试过以下方法：

*   按照此 [过时] 知识库文章中的说明操作：http: [//support.microsoft.com/kb/825791/en-us](http://support.microsoft.com/kb/825791/en-us)
*   修复 .NET Framework v3.5 安装，然后重新启动
*   删除内容`c:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root`，然后运行`iisreset`
*   重置权限`c:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root`，然后运行`iisreset`
*   重新设置权限`c:\WINDOWS\TEMP`，然后运行`iisreset`。

有什么建议么？

* * *

**其他说明/回复：**

*   索引服务被禁用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-12T20:55:23.320

如果您安装了 ANTS 分析器并且它在分析时崩溃，我找到了一个适用的答案。此[知识库文章](http://www.red-gate.com/supportcenter/Content.aspx?p=ANTS%20Profiler&c=knowledgebase%5CANTS_Profiler%5CKB200903000362.htm)描述了其中一种解决方案：

[http://www.red-gate.com/supportcenter/Content.aspx?p=ANTS%20Profiler&c=knowledgebase\ANTS_Profiler\KB200903000362.htm](http://www.red-gate.com/supportcenter/Content.aspx?p=ANTS%20Profiler&c=knowledgebase) _

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-30T09:20:36.250

1.  在 下创建一个临时文件夹`%SystemRoot%`，然后将其命名`Temp`。
2.  将 Temp 文件夹的完全权限授予 .NET Framework 1.0 中的 aspnet 用户帐户或 .NET Framework 1.1 中的 NETWORK SERVICE 用户帐户。
3.  右键单击我的电脑，然后单击属性。
4.  在高级选项卡上，单击环境变量。
5.  选择系统变量下的 TEMP 变量，然后单击编辑。
6.  在变量值框中键入`%SystemRoot%\TEMP`，然后单击确定。
7.  重复步骤 5 和 6 以编辑 TMP 变量。单击确定两次。
8.  单击开始，然后单击运行。

要重置 Internet 信息服务 (IIS)，请在命令提示符下键入 iisreset。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-27T16:45:09.573

使用 SysInternals FileMon（或 ProcMon，如果您愿意）来查看它所抱怨的真实文件。如果您有一个繁忙的服务器，您可以将其限制为仅监视 IIS，尽管我会从所有进程开始并仅捕获几秒钟的输出。

在运行之前，请确保 IIS 已使用 iisreset /restart 重置，以便以前不会缓存错误。

瑞安

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-10T09:54:06.763

我在运行 IIS 7.0 / Vista Ultimate / .NET 2.0 Web App 时遇到了同样的错误。我尝试为 NETWORK SERVICE 用户设置临时文件夹的“完全控制”权限（右键单击文件夹`c:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727`、属性、安全选项卡）并关闭防病毒和 UAC，但没有帮助。

但这很神奇：打开 IIS 管理器 -> 从右侧菜单中选择“查看应用程序池” -> 选择“高级设置” -> 在“身份”属性中设置您的用户名（和密码） -> 重新启动 IIS

如果这不起作用，请另外检查您是否是`c:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727`文件夹的所有者（右键单击，属性，安全选项卡，高级，所有者选项卡）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-07T00:33:58.130

致所有仍有问题的人！我的解决方法如下 [http://support.microsoft.com/kb/825791](http://support.microsoft.com/kb/825791)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-27T16:58:52.817

好的，当您修复安装时，您的意思是 ASPNET_REGIIS -u / ASPNET_REGIIS -i 吗？这将修复磁盘权限。

可能是您的病毒扫描程序；如果可以并且安全的话，排除您的 .net 临时文件夹/inetpub。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-27T16:46:02.413

必须尝试为临时 asp.net 文件夹[禁用](http://support.microsoft.com/kb/329065) [Windows 索引服务](http://www.google.com/url?sa=t&source=web&ct=res&cd=3&url=http%3A%2F%2Fblogs.msdn.com%2Fomars%2Farchive%2F2005%2F01%2F29%2F363189.aspx&ei=AeH1SdzxHIWEtwe1lKmsDw&usg=AFQjCNEQohBsQK-8NM--TIw9otPFdKJHjw)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-05T20:25:47.003

我收到了同样的错误。防病毒/安全软件 (McAffee Viruscan Enterprise) 阻止了 Visual Studio 工具 csc.exe 动态编译代码并在位于 windows 目录文件夹下的目录文件夹中创建实体数据模型 dll。McAffee 中有一个名为访问保护的部分，其中有一个名为“最大保护”的规则，该规则禁止在 windows 目录文件夹中创建可执行文件。只需暂时禁用规则或访问保护即可成功编译网站。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-12T14:36:45.543

这是最终的解决方案:)

* * *

1.  首先将所有权限授予 ASPNET 帐户，NETWORK SERVICE 帐户到它使用的框架下的“ASP.NET 临时文件”文件夹。
    比如 C:\windows\microsoft.net\framework\v2.xxx\ASP.NET 临时文件。

2.  在 TEMP 和 TEMP 的环境变量下检查为您的机器配置的临时文件夹。对于该文件夹，还授予 ASPNET 帐户、NETWORK SERVICE 帐户的所有权限。重置 IIS 它应该可以正常工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-08-18T15:54:08.257

从 windows server 2003 x64 、 IIS6 、 net 4.0 、 asp 应用程序中，我看到了错误：

> 编译器错误消息：CS0016：无法写入输出文件 'c:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files\root\7382c13f\ea9b3ff7\App_global.asax.zodyof_q.dll' -- '目录名无效。'

我创建 DIR 时解决了

> d:\温度

不知道为什么 D:\temp 很重要，但我会尽快更新这个答案并说明原因。

对 DIR 的权限是：

> 管理员满
> 
> 创作者所有者特别
> 
> 系统满
> 
> 用户读取&执行/列出/读取

未定义 IIS 特定用户权限。

Working to migrate to IIS7 host but thought this answer maybe helpful for someone.

# java - 禁用 Tomcat 中所有默认的 HTTP 错误响应内容

> ID：794329
> 
> 赞同：71
> 
> 时间：2009-04-27T16:42:41.500
> 
> 标签：java, http, tomcat, servlets, httpresponse

默认情况下，如果遇到 HTTP 404 之类的问题，Tomcat 会将一些 HTML 内容发送回客户端。我知道可以`web.xml`通过`<error-page>` [配置](http://wiki.apache.org/tomcat/FAQ/Miscellaneous#Q6)来自定义这些内容。

但是，我只是希望 Tomcat在响应内容方面**不发送任何**内容（当然，我仍然想要状态码）。有什么方法可以轻松配置吗？

我试图避免 A) 从我的 Servlet 的响应流上显式发送空内容，以及 B) 为我的`web.xml`.

对于某些背景，我正在开发一个 HTTP API 并控制我自己的响应内容。例如，对于 HTTP 500，我在包含错误信息的响应中填充了一些 XML 内容。对于像 HTTP 404 这样的情况，HTTP 响应状态对于客户端来说就足够了，而 Tomcat 正在发送的内容是不必要的。如果有不同的方法，我愿意听听。

**编辑：** 经过继续调查，我仍然找不到太多的解决方案。如果有人可以明确地说这是不可能的，或者提供有证据证明它不起作用的资源，我会接受它作为答案并尝试解决它。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-09-20T13:39:30.910

如果您不希望 tomcat 显示错误页面，请不要使用 sendError(...)。而是使用 setStatus(...)。

例如，如果您想给出 405 响应，那么您可以

```
response.setStatus(HttpServletResponse.SC_METHOD_NOT_ALLOWED);      
response.getWriter().println("The method " + request.getMethod() + 
   " is not supported by this service."); 
```

还要记住不要从您的 servlet 中抛出任何异常。而是捕获异常，然后再次设置您自己的状态代码。

IE

```
protected void service(HttpServletRequest request,
      HttpServletResponse response) throws IOException {
  try {

    // servlet code here, e.g. super.service(request, response);

  } catch (Exception e) {
    // log the error with a timestamp, show the timestamp to the user
    long now = System.currentTimeMillis();
    log("Exception " + now, e);
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    response.getWriter().println("Guru meditation: " + now);
  }
} 
```

当然，如果您不想要任何内容​​，那么就不要给作者写任何东西，只需设置状态即可。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2014-08-11T07:14:53.193

虽然这并没有完全回应关于问题的“不发送任何东西”声明，并且在[Clive Evans 的回答](https://stackoverflow.com/a/8166149/1504300)浪潮中，我发现在 tomcat 中你可以让那些太多冗长的文本从错误页面中消失而无需创建自定义 ErrorReportValve。

您可以通过“server.xml”上的 2 个参数“showReport”和“showServerInfo”来完成此自定义 ErrorReportValve：

```
<Valve className="org.apache.catalina.valves.ErrorReportValve" showReport="false" showServerInfo="false" /> 
```

[链接到官方文档](http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html#Error_Report_Valve)。

在 tomcat 7.0.55 上为我工作，在 tomcat 7.0.47 上对我不起作用（我认为是因为以下链接[http://www.mail-archive.com/users@tomcat.apache.org /msg113856.html](http://www.mail-archive.com/users@tomcat.apache.org/msg113856.html) )

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-11-17T11:12:20.920

阻止 Tomcat 发送任何错误主体的快速、略微肮脏但简单的方法是针对 tomcat 主机调用 setErrorReportValveClass，并使用自定义错误报告阀覆盖报告以不执行任何操作。IE：

```
public class SecureErrorReportValve extends ErrorReportValve {

@Override
protected void report(Request request,Response response,Throwable throwable) {
}

} 
```

并将其设置为：

```
 ((StandardHost) tomcat.getHost()).setErrorReportValveClass(yourErrorValveClassName); 
```

如果你想发送你的消息，并且只是认为 Tomcat 不应该搞砸它，你想要一些类似的东西：

```
@Override
protected void report(final Request request, final Response response, final Throwable throwable) {
    String message = response.getMessage();
    if (message != null) {
        try {
            response.getWriter().print(message);
            response.finishResponse();
        } catch (IOException e) {
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-01-16T09:47:18.837

虽然它符合 Servlet 规范，但出于安全原因，我不希望 tomcat 或任何其他 Servlet 容器发送错误详细信息。我也为此苦苦挣扎。经过搜索和尝试，解决方法可以总结为：

1.  正如其他人提到的，不要使用`sendError()`，`setStatus()`而是使用（[在 Jersey 框架中你可以选择](https://stackoverflow.com/a/36600434/505893)）
2.  像 Spring Security 这样的框架`sendError()`虽然使用...
3.  写一个[`Filter`](http://docs.oracle.com/javaee/6/api/javax/servlet/Filter.html)那个
    。将呼叫重定向`sendError()`到`setStatus()`
    b。最后刷新响应以防止容器进一步修改响应

[可以在此处找到执行此操作的一个小示例 servlet 过滤器](https://gist.github.com/4545911)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-09-28T09:04:55.307

正如Heikki所说，设置状态而不是`sendError()`导致Tomcat不接触响应实体/正文/有效负载。

如果您只想发送没有任何实体的响应标头，例如在我的情况下，

```
response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
response.setContentLength(0); 
```

成功了。使用`Content-Length: 0`，`print()`即使使用也不会产生任何影响，例如：

```
response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
response.setContentLength(0);
response.getWriter().print("this string will be ignored due to the above line"); 
```

客户收到类似的东西：

```
HTTP/1.1 401 Unauthorized
Server: Apache-Coyote/1.1
Content-Type: text/html;charset=utf-8
Content-Length: 0
Date: Wed, 28 Sep 2011 08:59:49 GMT 
```

如果您想发送一些错误消息，请使用`setContentLength()`带有消息长度（不为零）或者您可以将其留给服务器

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-11-23T21:16:34.473

虽然这个问题有点老了，但我也遇到了这个问题。首先，Tomcat的行为是绝对正确的。这是每个 Servlet 规范。不应该根据规范改变 Tomcat 的行为。正如 Heikki Vesalainen 和 mrCoder 所提到的，使用`setStatus`and `setStatus`only。

对于它可能关心的人，我已经向 Tomcat 提出了[一张票](https://issues.apache.org/bugzilla/show_bug.cgi?id=54198)，以改进`sendError`.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-11-28T08:15:57.007

### 配置`<error-page>`元素`web.xml`

编辑`$CATALINA_HOME/conf/web.xml`，在最后添加以下内容`<error-page>`，保存并重启tomcat

```
<web-app>

...
...
...

    <error-page>
        <error-code>404</error-code>
        <location>/404.html</location>
    </error-page>

    <error-page>
        <error-code>500</error-code>
        <location>/500.html</location>
    </error-page>

    <error-page>
        <error-code>400</error-code>
        <location>/400.html</location>
    </error-page>

</web-app> 
```

*   即使我实际上没有为那些指定的`location`值创建有效的路由（例如`/400.html`） ，它也能像我预期的那样工作得很好

* * *

前

[![在此处输入图像描述](https://i.stack.imgur.com/ACUwd.png)](https://i.stack.imgur.com/ACUwd.png)

后

[![在此处输入图像描述](https://i.stack.imgur.com/JRVHO.png)](https://i.stack.imgur.com/JRVHO.png)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-27T17:51:03.550

为什么不用`<error-page>`空的 HTML 页面来配置元素呢？

# sql-server - 编译访问 (mde) 文件的链接表问题

> ID：794330
> 
> 赞同：0
> 
> 时间：2009-04-27T16:42:52.200
> 
> 标签：sql-server, vba, ms-access

我有一个旧的编译访问应用程序`mde`文件。此应用程序已将表链接到网络共享文件夹。我尝试在主数据库上使用升迁向导升级主数据库，一切顺利。然后，当应用程序启动时，它会给出错误消息

> Microsoft jet 数据库引擎找不到输入表或查询表

我检查了共享的 mdb 文件，它具有准确的表名和所有内容。然后我打电话给开发这个应用程序的人。他说我必须重写应用程序才能不使用 Jet 引擎......

Jet Engine 与链接表有什么关系？我真的必须重写整个应用程序才能使用 ADO 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T19:53:45.830

许多问题：

1.  你有源 MDB 文件吗？如果链接表未正确连接，我不记得创建 MDE 是否会失败。无论如何，如果您最终需要更改应用程序，您将需要源 MDB 文件。

2.  您报告的错误消息应该给出丢失表的名称。

3.  你知道什么时候报错吗？在许多地方，简单地将链接到 Jet MDB 后端的表替换为与服务器的 ODBC 链接并不能解决问题。例如，如果代码中有任何已保存的查询或 SQL 绕过链接表并使用直接连接字符串，则可能会产生如您所见的错误。

4.  关于开发人员的回应“我必须重写应用程序才能不使用Jet引擎......”要么你误解了他所说的，要么你的开发人员完全不称职。或者两者兼而有之，我猜。Jet 与 ODBC 链接表配合得非常好，如果您使用的是 MDB 前端，则不可能完全消除 Jet，因为 MDB 是一个 Jet 数据文件。消除 Jet 的愿望主要来自那些懒得学习如何正确使用它的人。

对我来说，这听起来好像你得到了一个未处理的错误，但关于产生它的信息不足。您需要实际的 MDB 对其进行故障排除，因为代码没有显示在 MDE 中，因此无法确定问题的实际根源是什么。如果您的开发人员不给您 MDB，那么您需要检查开发该应用程序的合同——如果您同意让他控制源代码，您基本上任由他摆布，应该解雇任何签字的人在那。值得一提的是，当我向客户交付 MDE 时，他们也会获得完整的 MDB。他们通常不会对它做任何事情，但是如果我不再可以进行进一步的开发工作，他们已经获得了可以提供给任何他们想要的任何人的源代码。

最后，我认为即使你的应用程序正常运行，仅仅扩大规模也不太可能在性能或稳定性方面提供很多。确实，很多时候，90% 或更多的大型应用程序无需更改即可运行，但其他 10% 可能非常有问题。通常，您需要将某些操作移至服务器端以获得服务器后端提供的效率。这意味着您的前端应用程序需要重新设计，以更好地与您扩大的后端一起工作。不同应用程序的真实程度会有所不同，但很少有绝对一切都可以在没有修改的情况下运行的情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T20:13:30.323

您确实更改了 Access 数据库版本吗？您的 mdb 可能与旧版本的 Jet 驱动程序链接，而这些驱动程序无法连接到较新的 mdb 版本。

# c# - C# 中的 XML 比较

> ID：794331
> 
> 赞同：13
> 
> 时间：2009-04-27T16:42:52.730
> 
> 标签：c#, xml

我正在尝试使用 C# 代码比较两个 Xml 文件。我想忽略 Xml 语法差异（即前缀名称）。为此，我正在使用 Microsoft 的[XML Diff and Patch](http://www.microsoft.com/downloads/details.aspx?FamilyID=3471df57-0c08-46b4-894d-f569aa7f7892&DisplayLang=en) C# API。它适用于某些 Xml，但我找不到将其配置为与以下两个 Xml 一起使用的方法：

XML A：

```
<root xmlns:ns="http://myNs">
  <ns:child>1</ns:child>
</root> 
```

XML B：

```
<root>
  <child xmlns="http://myNs">1</child>
</root> 
```

我的问题是：

1.  这两个xml在语义上是相等的（或同构的），我对吗？
2.  可以配置 Microsoft 的 XML Diff 和 Patch API 来支持它吗？
3.  是否有任何其他 C# 实用程序可以做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-27T20:14:18.417

这些文档是同构的，如下面的程序所示。我认为如果你使用`XmlDiffOptions.IgnoreNamespaces`and`XmlDiffOptions.IgnorePrefixes`来配置`Microsoft.XmlDiffPatch.XmlDiff`，你会得到你想要的结果。

```
using System.Linq;
using System.Xml.Linq;
namespace SO_794331
{
    class Program
    {
        static void Main(string[] args)
        {
            var docA = XDocument.Parse(
                @"<root xmlns:ns=""http://myNs""><ns:child>1</ns:child></root>");
            var docB = XDocument.Parse(
                @"<root><child xmlns=""http://myNs"">1</child></root>");

            var rootNameA = docA.Root.Name;
            var rootNameB = docB.Root.Name;
            var equalRootNames = rootNameB.Equals(rootNameA);

            var descendantsA = docA.Root.Descendants();
            var descendantsB = docB.Root.Descendants();
            for (int i = 0; i < descendantsA.Count(); i++)
            {
                var descendantA = descendantsA.ElementAt(i);
                var descendantB = descendantsB.ElementAt(i);
                var equalChildNames = descendantA.Name.Equals(descendantB.Name);

                var valueA = descendantA.Value;
                var valueB = descendantB.Value;
                var equalValues = valueA.Equals(valueB);
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T16:54:33.950

我知道您的重点不是单元测试，但[XMLUnit](http://xmlunit.sourceforge.net/)可以比较两个 XML 文件，我认为它能够解决您的示例。也许你可以看看代码找出你的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T12:07:11.387

我在 XML 和 .NET Framework MSDN 论坛中得到[了 Martin Honnen 的答案。](http://social.msdn.microsoft.com/Forums/en-US/xmlandnetfx/thread/3f2bb47f-356d-48f3-866c-b2533e5731f8/)简而言之，他建议使用 XQuery 1.0 的 deep-equal 函数并提供一些 C# 实现。似乎工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-27T16:56:35.040

从每个 xml 文件加载 XmlDocument 实例并比较 XML DOM 可能是一个想法？对每个都进行正确的验证，这应该为您提供一个比较的共同点，并且应该允许标准差异报告。甚至可能使用增量更新另一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T18:51:37.663

这些文档在语义上并不等效。第一个的顶级元素在`http://myNS`命名空间中，而第二个的顶级元素在默认命名空间中。

两个文档的*子*元素是等价的。但文件本身不是。

**编辑：**

`xmls:ns='http://myNS'`和之间存在天壤之别`xmlns='http://myNS'`，我似乎忽略了这一点。无论如何，这些文档在语义上是等效的，我只是弄错了。

# c# - 将“句柄”从 VB.NET 迁移到 C#

> ID：794332
> 
> 赞同：10
> 
> 时间：2009-04-27T16:43:18.737
> 
> 标签：c#, vb.net, events, handles

我正在将一些代码从 VB.NET 迁移到 C# (3.5)。

我发现如下结构：

```
Public Event DataLoaded(ByVal sender As Object, ByVal e As EventArgs)

Protected Sub Mag_Button_Load_Click(ByVal sender As Object, ByVal e As EventArgs) Handles Mag_Button_Load.Click
[..]
        RaiseEvent DataLoaded(Me, EventArgs.Empty)
End Sub
[..]

'Other Class
Private Sub LoadData(ByVal sender As Object, ByVal e As System.EventArgs) Handles oData.DataLoaded
[..]
End Sub 
```

将这种行为转换为 C# 的最直接方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-27T16:49:16.040

我推荐使用[Telerik Code Converter](http://converter.telerik.com/)作为开始。

C# 没有像 VB.NET 那样通过“Handles”关键字轻松自动附加事件处理程序。

```
//EventHandler declaration
public event EventHandler  DataLoaded;
protected void Mag_Button_Load_Click(object sender, EventArgs e)
{

    //Raise Event
    if (DataLoaded != null) {
        DataLoaded(this, EventArgs.Empty);
    }
} 
```

此外，您需要将事件处理程序分配给如下对象：

```
Button1.Click += Button1_Click;

protected void Button1_Click(object sender, EventArgs e)
{
  //do something.
} 
```

然而，C# 也确实具有这样做的简洁能力：

```
Button1.Click += (sender, e)=>
{
    //do something
} 
```

# windows - 如何以原子方式替换网络服务器上的文件，使其最新版本持续可用？

> ID：794334
> 
> 赞同：1
> 
> 时间：2009-04-27T16:43:59.407
> 
> 标签：windows, perl

我正在开发一个生成 Google 地球 KML 文件并将文件保存到 Web 可访问目录的项目。它使用 ActivePerl 在 Windows 上运行。（不是我喜欢的平台，但它是我必须使用的。）

我为此使用的方法是：写入*temp.kml*，使用 File::Copy 将*temp.kml*复制到*real.kml*。这种情况每秒发生一次。

Google 地球通过 apache2 网络服务器获取这个*real.kml 。*问题是，当 Google Earth在将*temp.kml*复制到*real.kml*的同时抓取*real.kml*时会引发错误。

 **我知道这很有可能是不可避免的，但是有什么方法可以最大程度地减少引发错误的频率吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T16:57:42.477

处理完成后，为什么不直接将文件从临时目录移动到 web 目录，而不是复制文件？如果您的临时目录与 web 目录位于同一个文件系统上，这应该只会导致文件名发生变化，而内容保持不变。竞争条件的可能性应该较小。

[使用 file::Copy 移动文件](http://perldoc.perl.org/File/Copy.html)

# c# - WCF：如何将 ServiceThrottlingBehavior 添加到 WCF 服务？

> ID：794338
> 
> 赞同：4
> 
> 时间：2009-04-27T16:45:54.377
> 
> 标签：c#, wcf, web-services, throttling

我有以下代码用于返回我的 WCF 服务实例`ServiceClient`：

```
 var readerQuotas = new XmlDictionaryReaderQuotas()
    {
        MaxDepth = 6000000,
        MaxStringContentLength = 6000000,
        MaxArrayLength = 6000000,
        MaxBytesPerRead = 6000000,
        MaxNameTableCharCount = 6000000
    };

    var throttlingBehaviour = new ServiceThrottlingBehavior(){MaxConcurrentCalls=500,MaxConcurrentInstances=500,MaxConcurrentSessions = 500}; 
    binding = new WSHttpBinding(SecurityMode.None) {MaxReceivedMessageSize = 6000000, ReaderQuotas = readerQuotas};

    dualBinding = new WSDualHttpBinding(WSDualHttpSecurityMode.None)
                      {MaxReceivedMessageSize = 6000000, ReaderQuotas = readerQuotas};

    endpointAddress = new EndpointAddress("http://localhost:28666/DBInteractionGateway.svc"); 

    return new MusicRepo_DBAccess_ServiceClient(new InstanceContext(instanceContext), dualBinding, endpointAddress); 
```

最近我遇到了一些超时问题，所以我决定添加一个限制行为，比如：

```
 var throttlingBehaviour = new ServiceThrottlingBehavior () {
        MaxConcurrentCalls=500, 
        MaxConcurrentInstances=500,
        MaxConcurrentSessions = 500
    }; 
```

我的问题是，**我应该在上面的代码中的哪个位置将它添加`throttlingBehaviour`到我的`MusicRepo_DBAccess_ServiceClient`实例中？**

* * *

从我在网上找到的一些例子中，他们正在做这样的事情：

```
ServiceHost host = new ServiceHost(typeof(MyService));
ServiceThrottlingBehavior throttleBehavior = new ServiceThrottlingBehavior
{
    MaxConcurrentCalls = 40,
    MaxConcurrentInstances = 20,
    MaxConcurrentSessions = 20,
};
host.Description.Behaviors.Add(throttleBehavior);
host.Open(); 
```

请注意，在上面的代码中，他们使用的是 a`ServiceHost`而我不是，然后他们打开它（使用`Open()`），而我打开`MusicRepo_DBAccess_ServiceClient`实例......这让我感到困惑。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2013-08-14T12:21:58.853

可以为像我这样在运行时配置的人用代码完成。

VB版：

```
 Dim stb As New ServiceThrottlingBehavior
    stb.MaxConcurrentSessions = 100
    stb.MaxConcurrentCalls = 100
    stb.MaxConcurrentInstances = 100
    ServiceHost.Description.Behaviors.Add(stb) 
```

c#版本：

```
 ServiceThrottlingBehavior stb = new ServiceThrottlingBehavior {
        MaxConcurrentSessions = 100,
        MaxConcurrentCalls = 100,
        MaxConcurrentInstances = 100
    };
    ServiceHost.Description.Behaviors.Add(stb); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-12T19:44:13.390

节流是一种服务端（服务器）行为而不是客户端行为

阿农

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-27T17:00:06.327

您可以在配置文件 afaik 中指定行为，生成的客户端将服从，使用行为。

为简洁起见，排除了一些配置部分

```
<service 
    behaviorConfiguration="throttleThis" />

        <serviceBehaviors>
            <behavior name="throttleThis">
                <serviceMetadata httpGetEnabled="True" />
                <serviceThrottling
                    maxConcurrentCalls="40"
                    maxConcurrentInstances="20"
                    maxConcurrentSessions="20"/>
            </behavior>
        </serviceBehaviors> 
```

# java - JAXBContext 初始化加速？

> ID：794354
> 
> 赞同：28
> 
> 时间：2009-04-27T16:51:26.893
> 
> 标签：java, performance, jaxb

有什么方法可以加快 javax.xml.bind.JAXBContexts 的初始化与大量（> 1000）类？在我们的 XML 繁重的应用程序中，启动时间大约为 10 分钟，主要包括 JAXBContexts 的初始化时间。:-(

我们在 JDK 1.5 中使用 Sun 的 JAXB 实现，并使用 org.jvnet.jaxb2.maven2.maven-jaxb2-plugin 从 XSD 生成代码。

澄清：问题不在于我们有许多具有相同上下文路径的 JAXBContext 实例，而在于一个 JAXBContext 的初始化需要数十秒，因为它必须加载和处理数千个类。（我们的 XSD 相当大且复杂。）所有 JAXBContext 实例都有不同的上下文路径 - 我们无法进一步减少数量。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-11-23T09:55:12.520

由于这个原因，JAXB 参考实现具有某种未记录的系统属性：

```
-Dcom.sun.xml.internal.bind.v2.runtime.JAXBContextImpl.fastBoot=true 
```

或者对于包重构之前的旧版本：

```
-Dcom.sun.xml.bind.v2.runtime.JAXBContextImpl.fastBoot=true 
```

这指示 JAXB 跳过预先缓存完成这项工作所需的各种反射肌肉的昂贵过程。相反，它会在使用上下文时进行所有反射。这使得运行时间更慢，但初始化速度要快得多，尤其是对于大量类。

但是，速度问题的一部分是不可避免的，那就是 JAXB 必须加载您的每一个类，并且类加载很慢。如果您在第一个上下文之后立即使用相同的配置创建第二个上下文，这很明显 - 您会看到它已经加载了类，速度要快得多。

此外，您说您有多个 JAXBContext 实例，因为您有多个上下文路径。您是否意识到可以将多个上下文路径放入单个上下文中？您只需在初始化上下文时将它们全部作为分号分隔的字符串传递，例如

```
JaxbContext.newInstance("a.b.c:x.y.z"); 
```

将加载上下文`a.b.c`和`x.y.z`. 不过，它可能不会对性能产生任何影响。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-28T18:13:47.310

通常，您不必创建许多 JAXBContext 实例，因为它们在配置后是线程安全的。在大多数情况下，只需一个上下文就可以了。

那么创建许多实例是否有特定原因？也许有人假设它们不是线程安全的？（这是可以理解的，因为没有明确记录——但这是一种非常常见的模式，需要在配置期间同步，但在使用期间不需要同步，只要不更改配置）。

除此之外，如果这仍然是一个问题，分析瓶颈并在 jaxb.dev.java.net 上提交问题（从配置文件中指出热点）将有助于改善情况。JAXB 团队非常好，反应迅速，如果你能指出问题出在哪里，他们通常会提出很好的解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T14:58:57.250

JAXBContext 确实是线程安全的，因此建议使用单例包装它。我写了一个简单的单例，其中包含一个似乎可以完成这项工作的类->上下文映射。如果您的应用程序使用许多线程，您可能还想创建一个 [un]marshaller 对象池，因为这些对象不是线程安全的，并且您也可能会看到一些初始化惩罚。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-23T09:48:21.990

在我们的例子中，更新 JAXB 库是一个好主意。顺便说一句，即使在开发环境中使用服务器 VM 代替客户端 VM 也是一个好主意，尽管这通常会减慢服务器启动速度：由于 JAXB 初始化需要很长时间，因此更好地编译服务器 VM 会有所帮助。

# javascript - 为非程序员学习 JavaScript

> ID：794355
> 
> 赞同：1
> 
> 时间：2009-04-27T16:51:39.280
> 
> 标签：javascript, unobtrusive-javascript

我编写 CSS/XHTML 就像它应该是我的母语一样，并且我确实按照可访问性等准则编写了有效的语义代码。

但是我想学习 Unobtrusive JavaScripting，但是对于一个完全非程序员的大脑，我需要一些动力/技巧/等等，比如学习它的最佳方法是什么，以及它需要多长时间/你需要多长时间才能感觉到知识的力量？:)

PS：我确实了解 JavaScript 如何工作和更改 DOM 等。我认为这更多的是通过头脑学习语法，而不是必须查找它。

### 也可以看看：

> [对开始 javascript 编程的人的建议。](https://stackoverflow.com/questions/284452/suggestions-for-someone-starting-javascript-programming)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T16:57:29.623

就用它吧。真的，你花在阅读和写作上的时间越多，它就越自然。使用[Firebug](http://getfirebug.com/)或等效的控制台来测试简短的想法；从命令行获取现有网页并以交互方式连接事件，习惯将行为代码编写为与编写标记分开的过程的想法。

如果你想要一本好书，我可以推荐优秀的[jQuery in Action——](http://www.manning.com/bibeault/)是的，它是针对 jQuery 用户的，但是无论你在库中选择什么，这些概念都适用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-27T17:02:49.440

动机，抱歉无能为力。

语法是死记硬背的。规则很简单，而且相当一致，所以实际上语法并不难。

您与语法混为一谈的可能是其他方面，例如哪些对象可以使用哪些属性、要调用哪些函数、您的框架提供了什么。同样，这基本上是死记硬背。

许多框架通过巧妙地使用 JavaScript 语法添加了一些语法，您也需要学习这些语法。

但归根结底，学习这些东西的唯一方法就是使用它。

你不能读它，你必须这样做。

找到您想要解决的问题、您网站的功能或其他任何内容，然后对其进行攻击。

如果您在网上找到教程或任何您想要的东西，请输入代码，不要剪切和粘贴它。当你输入时，质疑每一个符号或字符，试着理解你为什么要输入你正在输入的内容。

努力改变事物，即使它只是变量名，因为这样你就会更好地了解事物的用途以及它们是如何被引用的。它还可以让您专注于较大程序的一小部分。

如果您将“window1”变量更改为“myWindow”，那么至少您可以将代码视为“blah blah blah window1 blah blah window1”，而无需了解所有代码。

从小处着手，不要担心“做对了”等等，只要成功就行。如果它的完成方式不打扰你，那么你很好。如果你看着它并说“那不太对”，因为你在开始之后学到了一些东西，然后回去清理它。

在这个阶段，功能大于形式。许多形式只是来自经验。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-27T18:22:39.090

取决于你想做什么。您是一名正在考虑进入开发方面的成功网页设计师吗？勇往直前，但谨慎行事。JavaScript 很容易上手，但很快就会变得丑陋。它与任何服务器端语言（包括 Java）都大不相同。您的一些 JavaScript 技能将翻译成其他语言（例如，条件和控制流运算符）。但是有些东西是 JavaScript 独有的，如果你转向另一种语言，则需要重新学习。

此外，除非您进行过面向对象的开发，否则 JavaScript 中的某些内容将无法完全理解。即使 JavaScript 是“基于原型的”而不是严格面向对象的，但如果没有相关的 OO 概念，原型系统可能难以理解。如果您没有大量使用不同类型系统（静态与动态、显式与隐式）的经验，则类型系统也可能没有多大意义。

使用像 jQuery 或 YUI 这样好的框架，但一定要了解幕后发生的事情。Shog9 使用 FireBug 的建议也很好。它将向您展示正在发生的事情（无需在代码中执行大量 alert() 语句）。

您的 HTML DOM 和 CSS 经验会有所帮助，但仅限于理解 JavaScript 试图做什么。手工编写 HTML 和 CSS 不会帮助您学习编写 JavaScript；HTML 和 CSS 是文档标记语言，而不是命令式编程语言。

所以去吧，但不要指望它很容易。你可能取得了很多快速的进步，却发现你并没有像你想象的那么远，事情并没有像看起来的那样工作。但是通过足够的努力和研究，您可能会到达那里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-27T17:07:05.433

如果你已经准备好使用 HTML 和 CSS，我认为学习 Javascript 是一个好主意。Javascript 是一种很酷但很古怪的语言。大多数使用的人并不真正知道如何编写好的 JS 代码。我强烈推荐观看 Douglas Crockford 的视频，请参阅[http://video.yahoo.com/watch/111593](http://video.yahoo.com/watch/111593)

他们将提供有关 Javascript 的真正独家新闻。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T18:26:39.317

我之前推荐过[JavaScript: The Good Parts](http://oreilly.com/catalog/9780596517748/)（而且推荐的力度还不够），但如果您是编程新手，我建议您从[Head First JavaScript](http://oreilly.com/catalog/9780596527747/)开始。

[![头部优先 JavaScript](https://i.stack.imgur.com/KPJAJ.gif)](https://i.stack.imgur.com/KPJAJ.gif)
[（来源：[oreilly.com](http://oreilly.com/catalog/covers/9780596527747_cat.gif)）]

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-08T22:01:54.423

我认为你已经得到了很多很好的答案和资源，但我也想加入，因为我已经看到了一些 jQuery 建议：

我也喜欢 jQuery，几乎每天都在使用它。也就是说，对于初学者，我建议您在深入了解 jQuery 之前先**熟悉javascript。**熟悉语法、变量、范围和至少一些 DOM 概念将极大地提高您对如何使用 jQuery 做您想做的事情的理解。如果您尝试过快地超越基础知识，您肯定会陷入一些常见的误解，而 jQuery 无法帮助您解决。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-13T01:44:33.053

[http://codeavengers.com](http://codeavengers.com) 1 级 JavaScript 非常适合初学者。我创建了这些课程，并从初学者那里得到了很多很好的反馈，他们发现我的课程是学习 JavaScript 的一种有趣且有效的方式。

# grails - Groovy 中的类转换异常

> ID：794357
> 
> 赞同：2
> 
> 时间：2009-04-27T16:51:55.190
> 
> 标签：grails, groovy, classcastexception

我想在 grails 上使用 groovy 上传图像。我的gsp页面如下（我展示的是原版的简化版）

```
<g:form controller="post" action="save" enctype="multipart/form-data">        
      My picture  <input type="file" name="myPicture" />     
    <g:submitButton name="submit" value="Save"/>
</g:form> 
```

我的域类如下：

```
class Post {    

byte[] myPicture

static mapping = {
    myPicture type:  "blob" 
} 
```

我需要这个映射，否则 MySql 将创建一个小到适合图像的 smallblob

```
static constraints = {
    myPicture(nullable:false)      
}

} 
```

在控制器上，我有一个名为 save 的操作，如下所示：

```
def save = {                               
    def post = loadPost(params.id)

    post.properties = params

    if(post.save()) {
        print "hallo world"             
        redirect(action:'list', params:params)
    } else {
        render(view:'edit', model:[post:post])
    }
} 
```

当我尝试将图像保存在数据库中时引发异常。

```
2009-04-27 18:16:07,319 [20806951@qtp0-0] ERROR errors.GrailsExceptionResolver  - java.lang.ClassCastException: [B cannot be cast to java.sql.Blob 
```

org.codehaus.groovy.runtime.InvokerInvocationException: java.lang.ClassCastException: [B 不能转换为 java.sql.Blob

任何提示这是为什么？

顺便说一句，我在教程中看到图像被处理为字符串，但效果不佳。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T17:03:21.903

我在 Nabble 上发现了一个类似的问题：

[http://www.nabble.com/MySQL-and-Blobs-td16116885.html](http://www.nabble.com/MySQL-and-Blobs-td16116885.html)

提出了两种可能的解决方案：

*   将 blob 属性的约束更改为较大的最大大小，以阻止它使用“TinyBlob”。
*   使用 Hibernate Blob 实现而不是 byte[] 作为属性的类型声明。这将要求您将数据流式传输到 Blob，而不是直接分配，但上面的帖子提供了这样做的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T17:17:47.577

您可以尝试在您的方法中使用 Spring 的[MultipartFile吗？](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/web/multipart/MultipartFile.html)`loadPost()`

[这是文档](http://grails.org/doc/1.1/guide/single.html#6.1.8%20Uploading%20Files)中的一个示例：

```
def upload = {
    def f = request.getFile('myFile')
    if(!f.empty) {
      f.transferTo( new File('/some/local/dir/myfile.txt') )
      response.sendError(200,'Done');
    }    
    else {
       flash.message = 'file cannot be empty'
       render(view:'uploadForm')
    }
} 
```

我相信你可以`f.bytes`直接访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-04T09:20:55.043

试试这种方式：

```
 def save = {                               

    def post = loadPost(params.id)

    def f = request.getFile('myPicture')             

    post.myPicture = f.getBytes()
    post.pictureType = f.getContentType()                    

    if(post.save()) { 
```

# .net - 如何从 .Net 窥探另一个进程的内存？

> ID：794359
> 
> 赞同：1
> 
> 时间：2009-04-27T16:52:39.103
> 
> 标签：.net, memory-management, interprocess

我想从 .Net 控制台应用程序附加到另一个进程并探索数据区域。具体来说，我想附加到 Windows Vista 中的“蜘蛛纸牌”应用程序，因为我有兴趣查看它发出的卡片是否在所有情况下都可以解决。

这可能吗？如果可以，我应该查看哪些 API？

这是一个“只是为了好玩”的项目，所以我可以扩展我的知识。

瑞安

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T16:57:30.043

您必须使用 win32 `ReadProcessMemory`API - 没有内置任何内容。有关如何使用 P/Invoke 执行此操作的信息，请参阅[此处。](http://www.pinvoke.net/default.aspx/kernel32/ReadProcessMemory.html)另外，请查看[此](http://www.codeproject.com/KB/trace/minememoryreader.aspx)示例。

# excel - 具有相对位置的Excel总和

> ID：794360
> 
> 赞同：3
> 
> 时间：2009-04-27T16:53:21.800
> 
> 标签：excel

我如何从 B2 到 C2 中的内容求和？

B2 = A10 或仅 10（首选）
C2 = A25 或仅 25（首选）

通常你只会使用 SUM(A10:A25)，但 B2 和 C2 中的值不是固定的，它们会根据输入而变化。我可以使用 MATCH 来查找数字，但是如何告诉 SUM 使用这些数字？要求和的值始终在同一列中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T17:15:34.417

您可以为此使用 INDIRECT 功能，例如

```
=SUM(INDIRECT(B2):INDIRECT(C2)) 
```

如果您可以输入整个单元格名称（A10，A25）。

或者只在 B2 和 C2 中有数字，您可以使用

```
=SUM(INDIRECT(ADDRESS(B2;1)):INDIRECT(ADDRESS(C2;1))) 
```

（希望我按正确的顺序排列列和行！）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T16:59:15.063

您想在 Cell 的值中指定 Cell Co-ordinates 吗？

这就是你的意思吗？

尝试设置

```
B1 = "A10"
C1 = "A25"
D1 = =SUM(INDIRECT(B1):INDIRECT(C1)) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T16:57:36.270

使用该[`INDIRECT()`](http://support.microsoft.com/kb/213933)功能。您将一个字符串传递给它，该字符串是一个范围，它允许您根据输入获得一个动态范围。

# c# - 如何在 C# 中使用 TransactionScope？

> ID：794364
> 
> 赞同：38
> 
> 时间：2009-04-27T16:54:53.280
> 
> 标签：c#, .net, database, transactions, transactionscope

我正在尝试使用`TransactionScope`，但不断收到以下异常。
该应用程序运行在与数据库不同的机器上，如果这很重要的话。我正在使用 SQL Server 2005。

> 分布式事务管理器 (MSDTC) 的网络访问已被禁用。请使用组件服务管理工具在 MSDTC 的安全配置中启用 DTC 以进行网络访问。

```
using (TransactionScope tsTransScope = new TransactionScope())
{
    //Do stuff here
    tsTransScope.Complete();
} 
```

**编辑**

我根据反馈做了一些修改。现在我收到此错误：

> “对 COM 组件的调用已返回错误 HRESULT E_FAIL。”
> “与底层事务管理器的通信失败。”

**解决方案** 我认为接受的答案解决了我遇到的最初问题。第二个错误似乎特定于实体框架。我会为此发布另一个问题。

**以下是客户端的属性：**
[客户端 http://www.portnine.com/data/images/Misc/client.jpg](http://www.portnine.com/data/images/Misc/client.jpg)

**以下是服务器上的属性：**
[服务器 http://www.portnine.com/data/images/Misc/server.jpg](http://www.portnine.com/data/images/Misc/server.jpg)

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-27T17:02:43.230

您需要启用网络 DTC 访问，如本[Microsoft TechNet 文章](http://technet.microsoft.com/en-us/library/cc753510.aspx)中所述。可能必须在数据库和应用程序服务器上都进行此更改。通常 DTC 已经在数据库服务器上打开，所以我会先查看应用程序服务器。

这是我们使用的屏幕截图，除了“允许远程管理”选项： ![安全配置截图](https://i.stack.imgur.com/8YOq7.png)

我没有遇到您现在遇到的 HRESULT E_Fail 问题，但这篇关于[XP SP2 和事务](http://blogs.msdn.com/florinlazar/archive/2004/06/18/159127.aspx)的文章有这个有趣的建议：

> 您需要注意的另一个配置设置（尽管我认为这是一种不常见的情况）是 RestrictRemoteClients 注册表项。如果此键的值设置为 2 (RPC_RESTRICT_REMOTE_CLIENT_HIGH)，则 MSDTC 网络事务将无法正常工作。MSDTC 仅支持 RPC_RESTRICT_REMOTE_CLIENT_NONE (0) 和 RPC_RESTRICT_REMOTE_CLIENT_DEFAULT (1) 值。有关 RestrictRemoteClients 的更多信息，请参阅 [http://www.microsoft.com/technet/prodtechnol/winxppro/maintain/sp2netwk.mspx#XSLTsection128121120120](http://www.microsoft.com/technet/prodtechnol/winxppro/maintain/sp2netwk.mspx#XSLTsection128121120120) 。

最后，虽然不是特定于您的问题，但使用该类需要注意的一个非常重要的事情`TransactionScope`是，它的默认设置是使用[Serializable 的事务隔离级别](http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Serializable)。Serializable 是最严格的隔离级别，坦率地说，它被选为默认级别令人惊讶。如果您不需要这种级别的锁定，我强烈建议您在实例化 a 时将隔离级别设置为限制较少的选项（ReadCommitted）`TransactionScope`：

```
var scopeOptions = new TransactionOptions();
scopeOptions.IsolationLevel = System.Transactions.IsolationLevel.ReadCommitted;
scopeOptions.Timeout = TimeSpan.MaxValue;

using (var scope = new TransactionScope(TransactionScopeOption.Required,
    scopeOptions))
{
    // your code here
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-27T17:00:25.780

控制面板 - 管理工具 - 组件服务 - 我的电脑属性 - MSDTC 选项卡 - 安全配置选项卡 - 网络 DTC 访问（选中）/允许远程客户端（选中）/允许入站（选中）/允许出站（选中）/启用 TIP 事务（检查）

重新启动计算机。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-27T17:02:02.123

根据您使用的后端，TransactionScope 通常需要启用分布式事务管理器。[此 MSDN 博客上](http://blogs.msdn.com/angelsb/archive/2004/07/06/174215.aspx)有一些详细信息。

此外，如果您使用多个资源，则可能需要 DTC。在您的情况下可能需要启用 DTC，或者确保您使用的是 SQL Server 2005 并坚持在轻量级事务中可行的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-27T17:02:22.950

您需要使用组件服务管理工具在 MSDTC 的安全配置中启用 DTC 以进行网络访问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T16:59:28.980

如果您使用的是 SQL Server 2000，`System.Transactions.TransactionScope`将导致所有事务被提升为分布式事务，需要运行 MS 分布式事务协调器。

您可以通过启动 MSDTC 服务、升级到 SQL Server 2005 或实施类似于我的 codeproject 解决方案的方法来解决此问题：http: [//www.codeproject.com/KB/database/typed_dataset_transaction.aspx](http://www.codeproject.com/KB/database/typed_dataset_transaction.aspx)

我从来不需要这样做，但您也应该检查 Ocdecio 的回答，以配置 DTC 的网络安全设置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-27T17:09:49.657

您需要为数据库服务器和运行应用程序的服务器启用网络 DTC 访问。

您还需要验证连接不会被防火墙阻止。由于将启动从数据库服务器到应用程序机器的连接，因此将 MSDTC 添加到应用程序机器上的防火墙例外列表中同样重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-27T17:46:11.910

我在运行集成测试时遇到了同样的问题。

[我在这里](https://stackoverflow.com/questions/761031/how-do-you-get-around-multiple-database-connections-inside-a-transactionscope-if)发布了一个关于这个的问题

但最终我找到了解决方法。虽然，我不建议对生产代码这样做。我是在测试的背景下做的。

# jpa - 如何获得自动生成的值？

> ID：794366
> 
> 赞同：1
> 
> 时间：2009-04-27T16:56:00.390
> 
> 标签：jpa

```
@TableGenerator(name = "trial", table = "third",
        pkColumnName = "a" , valueColumnName = "b", pkColumnValue = "first")

@Entity

public class First{

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE, generator = "trial")
    protected int a;

    @OneToMany(mappedBy ="first", cascade = CascadeType.PERSIST)
    @JoinColumn(name = "a")
    protected List<Second> seconds;
}

@Entity

public class Second{

    @Id
    protected int a;

    @ManyToOne
    @JoinColumn(name = "b")
    First first;
} 
```

当我在 main 中运行以下命令时：

```
Second aSecond = new Second();

aSecond.a = 2;

First aFirst = new First();

List<Second> scnds = new ArrayList<Second>();
scnds.add(aSecond);

aFirst.seconds = scnds;

aEntityManager.getTransaction().begin();

aEntityManager.persist(aFirst);

aEntityManager.getTransaction().commit(); 
```

它在表第二的“b”列中设置了null？如何获取在 in 中自动创建的值`a`以`First`设置`b`in `Second`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T17:08:19.690

有几件事：

First：您不需要在 First 类中的 seconds 集合上使用 @JoinColumn(name = "a") 注释。映射由第二类处理。

下一个：

```
Second aSecond = new Second();
aSecond.a = 2;
First aFirst = new First();

//its a bi-directional mapping so you have to set the references both ways
aFirst.seconds.add(aSecond);
aSecond.first = aFirst;

aEntityManager.getTransaction().begin();
aEntityManager.persist(aFirst);
aEntityManager.getTransaction().commit(); 
```

# wpf - 一次更新 UserControl 中的所有绑定

> ID：794370
> 
> 赞同：7
> 
> 时间：2009-04-27T16:57:23.367
> 
> 标签：wpf, data-binding, wpf-controls, custom-controls

当 UserControl 的可见性更改为 Visible 时，我需要更新其上的所有绑定。几乎我所有的绑定都绑定到用​​户控件的 DataContext 属性，所以我正在尝试更新该绑定的目标：

```
BindingOperations.GetBindingExpressionBase(this, UserControl.DataContextProperty).UpdateTarget(); 
```

但是我得到`null`了方法的结果，`GetBindingExpression(..)`我想知道我是否用错了。

此外，是否有任何其他好方法来刷新控件上的所有绑定（使用 DataContext 作为源）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-27T17:36:06.817

好吧，您*可以*重新分配`DataContext`：

```
var dataContext = DataContext;
DataContext = null;
DataContext = dataContext; 
```

仅供参考，将属性重置为其值（即`DataContext = DataContext`）将不起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-15T18:28:26.693

您在错误的属性上使用了 BindingOperations.GetBindingExpressionBase 方法。您必须在绑定到 DataContext 属性的属性上使用它，而不是 DataContext 属性本身。

# sql - 更改表添加列语法

> ID：794371
> 
> 赞同：151
> 
> 时间：2009-04-27T16:57:24.943
> 
> 标签：sql, sql-server, tsql, ddl

我正在尝试以编程方式将标识列添加到表Employees。不知道我的语法有什么问题。

```
ALTER TABLE Employees
  ADD COLUMN EmployeeID int NOT NULL IDENTITY (1, 1)

ALTER TABLE Employees ADD CONSTRAINT
    PK_Employees PRIMARY KEY CLUSTERED 
    (
      EmployeeID
    ) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, 
    ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] 
```

我究竟做错了什么？我试图导出脚本，但 SQL Mgmt Studio 做了整个 Temp Table 重命名的事情。

**更新**：我认为第一条语句“关键字'COLUMN'附近的语法不正确”令人窒息。

* * *

## 回答 #1

> 赞同：206
> 
> 时间：2009-04-27T17:02:01.203

只需`COLUMN`从`ADD COLUMN`

```
ALTER TABLE Employees
  ADD EmployeeID numeric NOT NULL IDENTITY (1, 1)

ALTER TABLE Employees ADD CONSTRAINT
        PK_Employees PRIMARY KEY CLUSTERED 
        (
          EmployeeID
        ) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, 
        ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2017-04-10T11:15:27.023

这就是向表中添加新列的方式

```
ALTER TABLE [tableName]
ADD ColumnName Datatype 
```

**例如**

```
ALTER TABLE [Emp]
ADD Sr_No Int 
```

如果你想让它自动递增

```
ALTER TABLE [Emp]
ADD Sr_No Int IDENTITY(1,1) NOT NULL 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-01-27T08:58:09.950

将列添加到表中的正确语法是：

```
ALTER TABLE table_name
  ADD column_name column-definition; 
```

在您的情况下，它将是：

```
ALTER TABLE Employees
  ADD EmployeeID int NOT NULL IDENTITY (1, 1) 
```

要添加多列，请使用括号：

```
ALTER TABLE table_name
  ADD (column_1 column-definition,
       column_2 column-definition,
       ...
       column_n column_definition); 
```

`COLUMN`SQL SERVER 中的关键字仅用于更改：

```
ALTER TABLE table_name
  ALTER COLUMN column_name column_type; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T17:03:53.023

如果您尝试在表的开头添加一列（因为这比更改顺序更容易），它可能正在重命名临时表。此外，如果Employees表中有数据，它必须执行insert select *才能计算EmployeeID。

# .net - 带有不寻常字符的正则表达式

> ID：794376
> 
> 赞同：1
> 
> 时间：2009-04-27T16:58:26.283
> 
> 标签：.net, regex

我正在尝试想出一些正则表达式来处理 # 符号。

例如，#PRODUCT_143#

如果输入是 #PRODUCT_143，则正则表达式`#PRODUCT_(\d*$)`匹配并返回 143 作为匹配项。但是将 # 添加到输入和正则表达式的末尾会导致它中断。我需要在这里做什么才能匹配？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-27T17:00:49.007

如果您尝试过`#PRODUCT_(\d*$)#`，它没有找到匹配项也就不足为奇了。由于`$`已经标记了字符串的结尾，并且`#`之后它永远不会被匹配。

所以试试这个：

```
#PRODUCT_(\d*)#$ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T17:00:49.817

它不应该破坏任何东西，也许你忘记`$`在正则表达式中移动，这意味着行尾？这个正则表达式应该没问题：

```
#PRODUCT_(\d*)#$ 
```

（我不确定您为什么要在原始正则表达式中捕获行尾）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T17:01:32.407

你只是忘了`$`把括号移出吗？

```
    ^#PRODUCT_([0-9]*)#$

```

请注意添加的`^`内容 - 可能不适合您的输入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-27T17:03:12.713

$ 可能与行尾匹配，因此您的额外 # 会混淆它：

```
#PRODUCT_(\d*)#$ 
```

# java - 如何在 Java 中查找与通配符字符串匹配的文件？

> ID：794381
> 
> 赞同：180
> 
> 时间：2009-04-27T16:59:44.453
> 
> 标签：java, file, wildcard

这应该很简单。如果我有这样的字符串：

```
../Test?/sample*.txt 
```

那么获取与此模式匹配的文件列表的普遍接受的方法是什么？（例如它应该匹配`../Test1/sample22b.txt`and`../Test4/sample-spiffy.txt`但不匹配`../Test3/sample2.blah`or `../Test44/sample2.txt`）

我看了看，[`org.apache.commons.io.filefilter.WildcardFileFilter`](http://commons.apache.org/io/apidocs/org/apache/commons/io/filefilter/WildcardFileFilter.html)它似乎是正确的野兽，但我不确定如何使用它在相对目录路径中查找文件。

我想我可以查看 ant 的源代码，因为它使用通配符语法，但我必须在这里遗漏一些非常明显的东西。

（**编辑**：上面的例子只是一个示例案例。我正在寻找在运行时解析包含通配符的一般路径的方法。我根据 mmyers 的建议想出了如何做到这一点，但这有点烦人。更不用说java JRE似乎从单个参数自动解析main（String []参数）中的简单通配符以“节省”我的时间和麻烦......我很高兴我没有非文件参数混合。）

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2009-04-27T19:13:38.000

[`FileUtils`](http://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/FileUtils.html)从[Apache commons-io](http://commons.apache.org/io)（`listFiles`和`iterateFiles`方法）尝试：

```
File dir = new File(".");
FileFilter fileFilter = new WildcardFileFilter("sample*.java");
File[] files = dir.listFiles(fileFilter);
for (int i = 0; i < files.length; i++) {
   System.out.println(files[i]);
} 
```

为了解决您的`TestX`文件夹问题，我将首先遍历文件夹列表：

```
File[] dirs = new File(".").listFiles(new WildcardFileFilter("Test*.java");
for (int i=0; i<dirs.length; i++) {
   File dir = dirs[i];
   if (dir.isDirectory()) {
       File[] files = dir.listFiles(new WildcardFileFilter("sample*.java"));
   }
} 
```

相当“蛮力”的解决方案，但应该可以正常工作。如果这不符合您的需求，您可以随时使用[RegexFileFilter](http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/filefilter/RegexFileFilter.html)。

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2009-04-30T05:55:10.673

考虑来自 Apache Ant 的 DirectoryScanner：

```
DirectoryScanner scanner = new DirectoryScanner();
scanner.setIncludes(new String[]{"**/*.java"});
scanner.setBasedir("C:/Temp");
scanner.setCaseSensitive(false);
scanner.scan();
String[] files = scanner.getIncludedFiles(); 
```

您需要参考 ant.jar（ant 1.7.1 约为 1.3 MB）。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2015-07-28T19:39:38.383

以下是由[Java 7 nio](https://docs.oracle.com/javase/tutorial/essential/io/fileio.html) [globbing](https://stackoverflow.com/questions/9148528/how-do-i-use-directory-globbing-in-jdk7)和 Java 8 lambdas 提供支持的按模式列出文件的示例：

```
 try (DirectoryStream<Path> dirStream = Files.newDirectoryStream(
            Paths.get(".."), "Test?/sample*.txt")) {
        dirStream.forEach(path -> System.out.println(path));
    } 
```

或者

```
 PathMatcher pathMatcher = FileSystems.getDefault()
        .getPathMatcher("regex:Test./sample\\w+\\.txt");
    try (DirectoryStream<Path> dirStream = Files.newDirectoryStream(
            new File("..").toPath(), pathMatcher::matches)) {
        dirStream.forEach(path -> System.out.println(path));
    } 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2016-06-29T14:23:35.600

从 Java 8 开始，您可以`Files#find`直接从`java.nio.file`.

```
public static Stream<Path> find(Path start,
                                int maxDepth,
                                BiPredicate<Path, BasicFileAttributes> matcher,
                                FileVisitOption... options) 
```

### 示例用法

```
Files.find(startingPath,
           Integer.MAX_VALUE,
           (path, basicFileAttributes) -> path.toFile().getName().matches(".*.pom")
); 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2009-04-27T19:04:00.473

您可以将通配符字符串转换为正则表达式并将其与 String 的`matches`方法一起使用。按照你的例子：

```
String original = "../Test?/sample*.txt";
String regex = original.replace("?", ".?").replace("*", ".*?"); 
```

这适用于您的示例：

```
Assert.assertTrue("../Test1/sample22b.txt".matches(regex));
Assert.assertTrue("../Test4/sample-spiffy.txt".matches(regex)); 
```

以及反例：

```
Assert.assertTrue(!"../Test3/sample2.blah".matches(regex));
Assert.assertTrue(!"../Test44/sample2.txt".matches(regex)); 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-04-27T17:25:57.060

现在可能对您没有帮助，但 JDK 7 旨在将 glob 和正则表达式文件名匹配作为“更多 NIO 功能”的一部分。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2010-12-16T01:42:08.557

通配符库有效地进行 glob 和正则表达式文件名匹配：

[http://code.google.com/p/wildcard/](http://code.google.com/p/wildcard/)

实现很简洁——JAR 只有 12.9 KB。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-11-05T07:45:56.650

不使用任何外部导入的简单方法是使用此方法

我创建了名为 billing_201208.csv 、billing_201209.csv 、billing_201210.csv 的 csv 文件，它看起来工作正常。

如果上面列出的文件存在，输出将如下

```
found billing_201208.csv
found billing_201209.csv
found billing_201210.csv 
```

```
    //使用导入 -> 导入 java.io.File
        公共静态无效主要（字符串[]参数）{
        字符串 pathToScan = ".";
        字符串目标文件；// fileThatYouWantToFilter
        文件夹ToScan = new File(pathToScan);

```
 File[] listOfFiles = folderToScan.listFiles();

     for (int i = 0; i < listOfFiles.length; i++) {
            if (listOfFiles[i].isFile()) {
                target_file = listOfFiles[i].getName();
                if (target_file.startsWith("billing")
                     && target_file.endsWith(".csv")) {
                //You can add these files to fileList by using "list.add" here
                     System.out.println("found" + " " + target_file); 
                }
           }
     }    
} 
```

            回答 #9

赞同：6

时间：2013-02-01T00:11:53.093

正如在另一个答案中发布的那样，通配符库适用于 glob 和正则表达式文件名匹配：[http ://code.google.com/p/wildcard/](http://code.google.com/p/wildcard/)

我使用以下代码匹配 glob 模式，包括 *nix 样式文件系统上的绝对和相对：

```
String filePattern = String baseDir = "./";
// If absolute path. TODO handle windows absolute path?
if (filePattern.charAt(0) == File.separatorChar) {
    baseDir = File.separator;
    filePattern = filePattern.substring(1);
}
Paths paths = new Paths(baseDir, filePattern);
List files = paths.getFiles(); 
```

我花了一些时间试图让 Apache commons io 库中的 FileUtils.listFiles 方法（请参阅 Vladimir 的答案）来做到这一点，但没有成功（我现在意识到/认为它一次只能处理匹配一个目录或文件的模式） .

此外，使用正则表达式过滤器（参见 Fabian 的回答）来处理任意用户提供的绝对类型 glob 模式而不搜索整个文件系统将需要对提供的 glob 进行一些预处理以确定最大的非正则表达式/glob 前缀。

当然，Java 7 可以很好地处理请求的功能，但不幸的是，我现在被 Java 6 困住了。该库相对较小，只有 13.5kb。

审稿人注意：我试图将上述内容添加到提及此库的现有答案中，但编辑被拒绝。我也没有足够的代表将此添加为评论。有没有更好的办法...

            回答 #10

赞同：5

时间：2011-07-07T23:55:52.527

您应该可以使用`WildcardFileFilter`. 只需用于`System.getProperty("user.dir")`获取工作目录。试试这个：

```
public static void main(String[] args) {
File[] files = (new File(System.getProperty("user.dir"))).listFiles(new WildcardFileFilter(args));
//...
} 
```

假设通配符过滤器使用 ，您不需要替换`*`为。我没有对此进行测试，但我确实经常使用模式和文件过滤器。`[.*]``java.regex.Pattern`

            回答 #11

赞同：5

时间：2013-06-03T13:02:33.060

[Java7 的Glob](http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob)：[查找文件](http://docs.oracle.com/javase/tutorial/essential/io/find.html)。（[样本](http://docs.oracle.com/javase/tutorial/displayCode.html?code=http://docs.oracle.com/javase/tutorial/essential/io/examples/Find.java)）

            回答 #12

赞同：3

时间：2009-04-27T17:02:49.923

Apache 过滤器是为迭代已知目录中的文件而构建的。要在目录中也允许使用通配符，您必须在 ' `\`' 或 ' `/`' 上拆分路径并分别对每个部分进行过滤。

            回答 #13

赞同：1

时间：2019-04-05T21:12:20.577

仅使用 Java 流

```
Path testPath = Paths.get("C:\");

Stream<Path> stream =
                Files.find(testPath, 1,
                        (path, basicFileAttributes) -> {
                            File file = path.toFile();
                            return file.getName().endsWith(".java");
                        });

// Print all files found
stream.forEach(System.out::println); 
```

            回答 #14

赞同：0

时间：2009-04-27T17:07:07.150

为什么不使用做类似的事情：

```
File myRelativeDir = new File("../../foo");
String fullPath = myRelativeDir.getCanonicalPath();
Sting wildCard = fullPath + File.separator + "*.txt";

// now you have a fully qualified path 
```

这样您就不必担心相对路径，并且可以根据需要进行通配符。

            回答 #15

赞同：0

时间：2014-12-16T15:36:40.490

实现 JDK FileVisitor 接口。这是一个示例[http://wilddiary.com/list-files-matching-a-naming-pattern-java/](http://wilddiary.com/list-files-matching-a-naming-pattern-java/)

            回答 #16

赞同：0

时间：2016-01-23T19:37:40.483

使用方法：

```
public static boolean isFileMatchTargetFilePattern(final File f, final String targetPattern) {
        String regex = targetPattern.replace(".", "\\.");  //escape the dot first
        regex = regex.replace("?", ".?").replace("*", ".*");
        return f.getName().matches(regex);

    } 
```

jUnit测试：

```
@Test
public void testIsFileMatchTargetFilePattern()  {
    String dir = "D:\\repository\\org\my\\modules\\mobile\\mobile-web\\b1605.0.1";
    String[] regexPatterns = new String[] {"_*.repositories", "*.pom", "*-b1605.0.1*","*-b1605.0.1", "mobile*"};
    File fDir = new File(dir);
    File[] files = fDir.listFiles();

    for (String regexPattern : regexPatterns) {
        System.out.println("match pattern [" + regexPattern + "]:");
        for (File file : files) {
            System.out.println("\t" + file.getName() + " matches:" + FileUtils.isFileMatchTargetFilePattern(file, regexPattern));
        }
    }
} 
```

输出：

```
match pattern [_*.repositories]:
    mobile-web-b1605.0.1.pom matches:false
    mobile-web-b1605.0.1.war matches:false
    _remote.repositories matches:true
match pattern [*.pom]:
    mobile-web-b1605.0.1.pom matches:true
    mobile-web-b1605.0.1.war matches:false
    _remote.repositories matches:false
match pattern [*-b1605.0.1*]:
    mobile-web-b1605.0.1.pom matches:true
    mobile-web-b1605.0.1.war matches:true
    _remote.repositories matches:false
match pattern [*-b1605.0.1]:
    mobile-web-b1605.0.1.pom matches:false
    mobile-web-b1605.0.1.war matches:false
    _remote.repositories matches:false
match pattern [mobile*]:
    mobile-web-b1605.0.1.pom matches:true
    mobile-web-b1605.0.1.war matches:true
    _remote.repositories matches:false 
```

            回答 #17

赞同：-1

时间：2021-05-18T19:22:34.953

使用 io 库的 File 类最简单易行的方法是：

```
 String startingdir="The directory name";
    String filenameprefix="The file pattern"
    File startingDirFile=new File(startingdir); 
    final File[] listFiles=startingDirFile.listFiles(new FilenameFilter() {
        public boolean accept(File arg0,String arg1)
        {System.out.println(arg0+arg1);
            return arg1.matches(filenameprefix);}
        });
    System.out.println(Arrays.toString(listFiles)); 
```

        html - 如何将大量类似的糟糕 html 页面转换为高质量的基于 css 的页面？

ID：794405

赞同：2

时间：2009-04-27T17:03:58.220

标签：html, css

以编程方式将大量非常相似的网页转换为更新的基于 css 的布局的最佳方法是什么？

我正在将旧网站的所有内容更改为基于 css 的新布局。许多页面非常相似，我希望能够自动化该过程。

我目前正在考虑做的是使用 HtmlAgilityPack 读取页面，并为每组将创建输出文本的相似页面创建一个方法。

您认为最好的方法是什么？这些页面的不同之处主要在于图像使用了哪个 .jpg 文件，或者该特定页面上有多少组标题图像文本

编辑：我不能使用 .html 以外的任何其他文件类型，因为这是我被授权做的所有事情。有什么建议么？

EDIT2：理想情况下，我也可以使它足够通用，只需切换几个移动部件，我就可以将它用于许多不同的 html 文件组。

[典型页面样本](http://www.shaolin.org/video-clips-3/sabah2007/sabah01.html)

上面的链接是我正在处理的示例。页面之间不同的部分将是：

*   元描述标签
*   各种标题，尤其是主标题
*   页面上的几乎每张图片都是新的
*   每个视频的文本将是唯一的，但它们将被组合成相似的块
*   视频文件和视频大小将是唯一的

其他一切都一样，页面的格式也一样。

EDIT3：当有疑问时，可能有帮助的另一件事是编写一些代码来为我编写页面。我只需要剪掉原始的可变部分，并将它们放入一个数据文件中，该文件被读取并用于写入新版本。

            回答 #1

赞同：1

时间：2009-04-27T17:19:34.750

这取决于“非常相似”实际上有多相似。如果您的意思是他们有效地使用了许多模板，那么我可能会使用[Template-Toolkit为新设计构建新模板，并使用](http://template-toolkit.org/)[Template::Extract](http://search.cpan.org/~audreyt/Template-Extract-0.41/lib/Template/Extract.pm)吸出数据。可能将数据存储在本地数据库中，以便将来更容易重建页面。

            回答 #2

赞同：1

时间：2009-04-27T17:27:16.197

我认为这取决于有多少页面，如果没有太多，您可以创建一个模板并使用所见即所得的编辑器来复制和粘贴内容。

但是，如果您需要以编程方式执行此操作，我建议您解析 html 以提取内容。或者清理它，如果你可以访问它，你可以使用我用于类似任务的 Expression Web，你可以清理 html，只留下标题标签，段落等，然后你可以应用 css 来格式化它在你想要的设计中。

但是，编写代码可能比手动编写代码需要更长的时间。有时没有什么比手工更快的了。

祝你好运

            回答 #3

赞同：0

时间：2009-04-27T17:12:38.277

虽然这听起来有点油嘴滑舌，但我能提供的最好的实际选择是[Rent-A-Coder](http://www.rentacoder.com/RentACoder/DotNet/default.aspx)

            回答 #4

赞同：0

时间：2009-04-27T17:56:26.033

当面对像这样经常生成的旧代码时，我倾向于在我的文本编辑器中进行搜索和替换。

听起来很糟糕，不是吗？

说真的，如果你有一个强大的编辑器，它支持搜索多个文件和/或正则表达式，那可以删除大部分讨厌的代码。至少可以说这不是一门完美的科学，可能需要进行一些手动操作才能将其变成“有用”的形式，但它会消除大部分清理工作。

            回答 #5

赞同：0

时间：2009-04-27T17:17:48.653

取决于页面，您可以尽可能多地用 Perl 或您喜欢的任何其他脚本语言编写脚本，并让他们记下他们无法修复或不理解的任何内容。

        sharepoint - Word 和自定义内容类型

ID：794407

赞同：2

时间：2009-04-27T17:04:17.440

标签：sharepoint, sharepoint-2007

我为 sharepoint 定义了一个新的内容类型（文档）。我遇到的问题是 word 自动出现允许更新这些未经验证的属性（例如生效日期）的窗口，我不希望它在用户上传更改时显示（我填写了其中一些字段在 eventreceiver 类中的更新方法上）。是否可以禁用此功能或至少自定义单词行为？

            回答 #1

赞同：2

时间：2009-04-27T17:20:54.963

您可以创建自己的文档信息面板：http: [//msdn.microsoft.com/en-us/library/bb684925.aspx](http://msdn.microsoft.com/en-us/library/bb684925.aspx)。

另一种选择可能是设置 SPField 的 ShowInNewForm/ShowInEditForm 属性。但我不确定 Word 是否使用它们。

        jquery - jQuery jqModal Ajax 和嵌套模态问题

ID：794409

赞同：1

时间：2009-04-27T17:06:26.637

标签：jquery, ajax, jqmodal

我刚开始使用 jqModal，因为我需要对嵌套模式的支持。我注意到嵌套模式和 AJAX 的一些不稳定行为，但我不知道如何修复它。发生的情况是，当我加载其中有一个嵌套模式的主模式时，我得到了两个 jqmOverlay div，这就像它为两个模式应用了覆盖，即使尚未触发嵌套的一个。因此，当我关闭模式时，仍然会显示一个叠加层。这是代码：

```
// Main Modal
$(function(){
  $("#modal").jqm({ajax:'@href'});
});
<a class="label jqModal" href="/suppliers/2/edit">View Supplier</a>

// Nested Modal code fragment within the /suppliers/2/edit html
$(function(){
  $("#nested_modal").jqm({ajax:'@href', zIndex:3001});
})
<a class="button jqModal" href="/suppliers/6/bills/new">Add Bill</a> 
```

它似乎第一次工作，但如果我关闭主模式，然后再次打开，我会遇到双重叠加问题。这是一个错误吗？还是我调用嵌套模式的方式？另外，我知道它与嵌套模式有关，因为当我删除嵌套模式上的 jqm 调用时，主模式每次都能正常工作。

            回答 #1

赞同：4

时间：2009-05-01T21:59:03.093

我的嵌套 AJAX jqModals 也有类似的问题。这是解决方案：**toTop**参数，结合**z-index**。

设置嵌套模式的高**z-index**，然后在创建 JQM 时将**toTop设置为 true。**例如：

```
// Nested:
<div id="test" style="z-index: 5000;">Test content</div>
...
<script type="text/javascript">
$.ready(function(){
    $('#test').jqm({
    toTop:                  true,
    modal:                  true,
    overlay:                10,
    });
});
</script> 
```

使用**z-index**和**toTop**参数应该有助于解决您的问题。

        sql-server - 如何显示存储过程的执行计划？

ID：794411

赞同：49

时间：2009-04-27T17:06:49.600

标签：sql-server, stored-procedures, optimization, ssms

我可以毫无问题地查看查询的估计执行计划（Management Studio 9.0），但是对于存储过程，如果不从 ALTER 屏幕复制代码并将其粘贴到查询窗口，否则它将显示 ALTER 的计划而不是过程。即使这样做了，任何输入都丢失了，我需要这样声明它们。

有没有更简单的方法可以在存储过程上做到这一点？

**编辑：**
我只是想到了一些可行的方法，但我不确定。

我可以做估计的执行计划吗

```
exec myStoredProc 234 
```

            回答 #1

赞同：54

时间：2009-04-28T13:36:29.550

```
SET SHOWPLAN_ALL ON
GO

-- FMTONLY will not exec stored proc
SET FMTONLY ON
GO

exec yourproc
GO

SET FMTONLY OFF
GO

SET SHOWPLAN_ALL OFF
GO 
```

            回答 #2

赞同：32

时间：2011-05-20T13:09:08.680

选择存储过程名称（只需在查询窗口中键入），右键单击，然后选择 SQl Server Mgmt Studio 工具栏中的“显示估计执行计划”按钮。
**请注意**，您不必打开存储过程代码。只需选择过程名称。

被调用过程中存储过程的计划也将以图形形式显示。

            回答 #3

赞同：3

时间：2009-04-27T17:15:33.463

在 SQL Management Studio 2008 中执行存储过程时，您可以单击 Query -> Include Actual Execution Plan 从菜单中...它也在工具栏上

在阅读完评论后，执行似乎是一个问题，为了解决这个问题，我建议将存储过程的执行包装在最后回滚的事务中

            回答 #4

赞同：3

时间：2009-04-28T03:21:52.180

采用

```
SET SHOWPLAN_ALL ON
Go
exec myStoredProc 234
GO
SET SHOWPLAN_ALL OFF
GO 
```

请参阅[http://msdn.microsoft.com/en-us/library/aa259203.aspx](http://msdn.microsoft.com/en-us/library/aa259203.aspx)
只要您不使用 tmp 表，我认为这将起作用

            回答 #5

赞同：2

时间：2017-04-26T16:37:54.193

我知道答案是不久前提交的，但我发现下面的查询很有用

```
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;

SELECT  [ProcedureName]          =   OBJECT_NAME([ps].[object_id], [ps].[database_id]) 
       ,[ProcedureExecutes]      =   [ps].[execution_count] 
       ,[VersionOfPlan]          =   [qs].[plan_generation_num]
       ,[ExecutionsOfCurrentPlan]    =   [qs].[execution_count] 
       ,[Query Plan XML]         =   [qp].[query_plan]  

FROM       [sys].[dm_exec_procedure_stats] AS [ps]
       JOIN [sys].[dm_exec_query_stats] AS [qs] ON [ps].[plan_handle] = [qs].[plan_handle]
       CROSS APPLY [sys].[dm_exec_query_plan]([qs].[plan_handle]) AS [qp]
WHERE   [ps].[database_id] = DB_ID() 
       AND  OBJECT_NAME([ps].[object_id], [ps].[database_id])  = 'TEST' 
```

            回答 #6

赞同：1

时间：2020-10-21T09:41:23.340

有很多方法可以获取存储过程的实际执行计划。

```
SELECT
qp.query_plan, 
SQLText.text
FROM sys.dm_exec_cached_plans AS CP
 CROSS APPLY sys.dm_exec_sql_text( plan_handle)AS SQLText
 CROSS APPLY sys.dm_exec_query_plan( plan_handle)AS QP
 WHERE objtype = 'Proc' and cp.cacheobjtype = 'Compiled Plan' 
```

使用生产服务器中的数据统计信息查看生产服务器上的计划可能会显示与具有较小数据集的开发盒不同的计划。
还有很多数据要查看，例如根据查询缓存执行过程的频率

```
SELECT
    qp.query_plan, 
    CP.usecounts as [Executed], 
    DB_name(QP.dbid) as [Database],
    OBJECT_NAME(QP.objectid) as [Procedure],
    SQLText.text as [TSQL],
    so.create_date as [Procedure Created],
    so.modify_date as [Procedure  Modified]
FROM sys.dm_exec_cached_plans AS CP
CROSS APPLY sys.dm_exec_sql_text( plan_handle)AS SQLText
CROSS APPLY sys.dm_exec_query_plan( plan_handle)AS QP
join sys.objects as so on so.[object_id]=QP.objectid
WHERE objtype = 'Proc' and cp.cacheobjtype = 'Compiled Plan' 
```

XML 查询计划（两个查询中的第一列），包含执行计划的 XML，允许您在 SSMS 中单击它并查看实际计划，但也允许您扫描您不喜欢索引的内容扫描或“上帝禁止”表扫描。

```
SELECT
    qp.query_plan, 
    CP.usecounts as [Executed], 
    DB_name(QP.dbid) as [Database],
    OBJECT_NAME(QP.objectid) as [Procedure],
    SQLText.text as [TSQL],
    so.create_date as [Procedure Created],
    so.modify_date as [Procedure  Modified]
FROM sys.dm_exec_cached_plans AS CP
CROSS APPLY sys.dm_exec_sql_text( plan_handle)AS SQLText
CROSS APPLY sys.dm_exec_query_plan( plan_handle)AS QP
join sys.objects as so on so.[object_id]=QP.objectid
WHERE objtype = 'Proc' and cp.cacheobjtype = 'Compiled Plan'
and cast(qp.query_plan as nvarchar(max)) like '%loop%' 
```

我通过将 XML 转换为字符串然后进行通配符搜索，使用一种非常糟糕的方式对此进行了采样，但是 XML 查询并不是每天最常做的事情，字符串通配符对每个人来说都很容易。

            回答 #7

赞同：0

时间：2009-04-27T17:12:00.587

在启用显示实际执行计划（从查询菜单）的情况下在管理工作室（或查询分析器）中运行存储过程将在您运行存储过程后向您显示存储过程的计划。如果您无法运行它，则会显示估计的执行计划（尽管根据我的经验，这通常不太准确。）

            回答 #8

赞同：0

时间：2009-04-27T17:15:42.607

您还可以使用 Profiler 查看执行计划。您需要包括 Performance : Show Plan Statistics Profile 选项，并确保在列中包含二进制数据。

然后，您可以运行任何查询或过程并查看执行计划。

**编辑**

如果您不能使用分析器，并且您不想打开另一个窗口，我建议您在存储过程的开头包含一个注释块。例如想象以下情况：

```
/* 
     Description: This procedure does XYZ etc...
     DevelopedBy: Josh
     Created On:  4/27/09

     Execution: exec my_procName N'sampleparam', N'sampleparam'
*/

ALTER PROCEDURE  my_procName
   @p1 nvarchar(20),
   @p2 nvarchar(20)

AS 
```

这允许您仅突出显示执行目的并打开显示执行计划。并运行它。

            回答 #9

赞同：0

时间：2018-04-04T15:56:30.113

这是一个屏幕截图。我花了一段时间才弄清楚在哪里寻找。

[![在此处输入图像描述](https://i.stack.imgur.com/Zn7rK.png)](https://i.stack.imgur.com/Zn7rK.png)

        winforms - 如何制作“部分”模式对话框？

ID：794414

赞同：0

时间：2009-04-27T17:08:07.540

标签：winforms

有没有办法开始以模态方式显示对话框，但不是隐藏它，而是在将其更改为非模态对话框时保持可见？

我想显示一个对话框，阻止显示对话框的方法。然后当用户单击我想要的对话框上的“完成”按钮时：

*   对话框保持可见。
*   控件返回到显示对话框的方法。

我通过在单独的 STA 线程上运行对话框并使用事件阻止主 UI 线程直到按下“完成”来实现此结果，但此方法有一个问题：您可以单击关闭按钮对话框可见时的“主”窗口，隐藏对话框时主窗口关闭。

更新

感谢您到目前为止的回复。抱歉 - 看起来我在背景太多和不够之间取得了错误的平衡。

该表单实际上是一个模态“向导”对话框 - 它出现，模态地位于主应用程序的前面，然后被隐藏。因此，就用户而言，没有非标准的怪异发生。唯一的区别是对话框是由来自 UI 线程的一系列回调驱动的，所以我认为在其生命周期内使其真正成为模态（通过调用 ShowDialog）是行不通的。第一个回调必须显示对话框，然后在用户通过对话框 UI 设置其偏好时阻止。之后，对话框保持可见并显示进度条页面，同时从 UI 线程进行各种其他回调。最终表格被隐藏。表单启动时，用户没有与主窗口交互。就他们而言，它看起来应该是 100% 模态 wrt 主 UI 线程。

（表单是 Visual Studio 向导的对话框 - 这些是由 UI 线程上的一系列回调驱动的）。另一种方法是显示对话框，将其隐藏，然后立即显示最顶层的“进度”表单，然后将其隐藏，但我认为显示单个对话框对于用户来说是一种更加无缝的体验。

再次 - 很抱歉造成混乱！

            回答 #1

赞同：6

时间：2009-04-27T17:12:37.637

也许您想重新考虑您的交互模型？您将如何向您的用户解释这一点？他们有一个计算机程序如何工作的内在模型，你最好有一个很好的理由来打破它。他们知道模态对话框，他们知道非模态对话框，他们知道检查器。选择一个，然后应用它。

模态对话框用于短时间交互。他们不应阻止退出应用程序。用户可以控制交互，程序只提供所需的最少限制。

[解释后，替换] 模态对话框显示进度条有什么问题？单击确定后开始处理，禁用所有按钮，仅保持取消按钮处于活动状态？如果需要很长时间，用户可能想要中止操作。仅在完成处理后关闭对话框。

            回答 #2

赞同：1

时间：2009-04-27T17:14:32.233

您可以使用无模式对话框，然后让您的主 UI 检查用户是否单击了“完成”按钮。如果无模式对话框已打开但未单击已完成，则不要响应主窗体中的任何用户操作...

            回答 #3

赞同：1

时间：2009-04-27T17:18:20.697

这只是一个糟糕的想法——它完全是非标准的行为，你将跳过各种各样的圈子来获得一些工作，这只会让你的用户感到非常困惑。

            回答 #4

赞同：1

时间：2009-04-27T18:37:04.673

就像这里所说的大多数其他答案一样，您正在实现非标准 UI 元素，这会让大多数用户感到困惑。

如果对话框保持可见只是为了提供对数据的只读访问权限，那么为什么不正常关闭对话框窗口并在应用程序中使用对话框窗口中的数据打开一个侧边栏窗口呢？

如果对话框仍然可见以允许用户继续在其中进行更新，那么它可能不应该是模态的。

重点是，有几种不同的方法可以在不破坏标准 UI 隐喻的情况下完成任务。

            回答 #5

赞同：0

时间：2009-04-27T17:20:46.417

我会让它从你的应用程序的侧面或底部弹出，将其他东西推开。如果它位于用户可能需要查看或与之交互的其他内容之上，那么它只会惹恼他们。

            回答 #6

赞同：0

时间：2009-04-28T11:11:05.767

我发现在交互的阻塞阶段在主 UI 线程上显示一个不可见的模式对话框效果很好。

隐藏模式对话框设置（因此不可见）：ShowInTaskBar=false、FormBorderStyle=None、size={0,0}、Opacity=0%、StartupPosition=CenterParent。

隐藏的对话框使用 ShowDialog 显示在 UI 线程上。可见对话框显示在单独的 STA 线程上。在主 UI 线程上调用 hiddenDialog.ShowDialog 之前启动线程。

可见对话框在想要完成初始阻塞状态时隐藏 hiddenDialog。这会阻止主 UI 线程阻塞。

重要的代码位：

```
void LaunchWizardForm(s)
{
  // Show the wizard on its own thread.
  ThreadStart t = () =>
  {
    _wizard = new WizardForm(s);
    Application.Run(new ApplicationContext(_wizard));
  };
  var thread = new Thread(t);
  thread.SetApartmentState(ApartmentState.STA);
  thread.Start();

  // Block this (main UI) thread
  _hiddenForm.ShowDialog();
}

void EndModalEpisode()
{
    _hiddenForm.Invoke((Action) (() => _hiddenForm.Hide()));
} 
```

        .net - 使用 gcServer="true" 为 .NET 设置垃圾收集器的经验

ID：794415

赞同：25

时间：2009-04-27T17:08:16.430

标签：.net, asp.net, performance, garbage-collection

是否有人使用了启用垃圾收集器的配置，该配置使用 Aspnet.config 为多处理器机器优化：

```
<gcServer enabled="true"/>
<gcConcurrent enabled="true"/> 
```

您的网站性能有改善吗？

是否注意到任何问题？

            回答 #1

赞同：20

时间：2009-04-27T17:14:11.737

首先，并发和服务器是互斥的选项。有关服务器 GC 误解的一些详细信息，请参阅[此博客文章](http://blogs.msdn.com/clyon/archive/2004/09/10/228104.aspx)。但是，默认情况下，ASP.NET 托管服务器 GC（请参阅[Scott Hanselman 的讨论](http://www.hanselman.com/blog/UsingTheServerRatherThanWorkstationGarbageCollectorWithTheNETFrameworkCLR.aspx)），因此不会有任何区别。

对于 ASP.NET 网站，我建议坚持使用服务器而不是并发。对于用户模式应用程序，并发 GC 一直是用户响应，因为服务器 gc 会导致“挂起”。  

我使用了服务器 GC，并注意到某些情况下的显着改进。

但是，如果您的用户应用程序正在使用巨大的内存池并且变得高度碎片化，那么服务器模式 GC 确实可以帮助用户应用程序。

            回答 #2

赞同：4

时间：2012-03-27T17:09:19.800

*（非常老的问题，我知道，但我还是想添加这个）*

Server GC 和 Concurrent GC 之间有一个主要区别：Server GC 每个处理器有一个线程，并在进行收集时暂停该处理器上的线程，服务器 Concurrent GC 线程与其他线程并行运行，即没有暂停。有关更多信息和更细微的差异，请参阅[此 MSDN 文章。](http://msdn.microsoft.com/en-us/library/ms998547.aspx#scalenetchapt05_topic9)

根据一个周期所花费的时间，这可能会对您的应用程序的用户响应产生相当大的影响，因此请明智地选择。对于没有 UI 的 ASP.NET，Server GC 是更好的（也是默认的）选项。

            回答 #3

赞同：2

时间：2009-12-08T04:41:07.900

简而言之，Workstation GC 模式提高了单个用户的性能，而 server GC 模式旨在用于一直有多个请求的程序。我真的希望这个问题不是更大问题的征兆。有时当人们开始质疑垃圾收集器时，这是因为他们没有看到他们所期望的内存占用。不要期望使用不同的垃圾收集器获得巨大收益。在我所做的几乎所有测试中，您使用的收集器几乎没有什么区别。

        asp.net - 如何在按钮的事件处理程序中使用 page_load 局部变量

ID：794426

赞同：1

时间：2009-04-27T17:12:20.587

标签：asp.net, vb.net

我使用 vb 在 Visual Studio 中创建了一个站点，并且我在 page_load 中有一个变量，但需要在按钮的事件处理程序中使用它的值来传递会话。

关于如何做到这一点的任何建议？任何帮助表示赞赏

            回答 #1

赞同：2

时间：2009-04-27T17:14:22.547

您可以在 Button 的 CommandArgument 属性中存储一个值：

```
btn.CommandArgument = "Your value" 
```

然后在处理事件时，您可以将其拉出：

```
CType(sender, Button).CommandArgument 
```

如果您需要多个参数，您还可以创建一个扩展 Button 的新类并创建如下所示的新属性：

```
Class SessionButton
    Inherits Button

    Public Property SessionGUID() As Guid
        Get
            Dim s As Guid = Nothing
            If Not String.IsNullOrEmpty(ViewState("SessionGUID")) Then
                s = New Guid(ViewState("SessionGUID").ToString())
            End If

            Return s
        End Get
        Set(ByVal value As Guid)
            ViewState("SessionGUID") = value.ToString()
        End Set
    End Property

End Class 
```

            回答 #2

赞同：1

时间：2009-04-27T17:33:38.553

您可以将其存储在视图状态支持的属性中：

```
Public Property MyStringVar() As String
   Get
     If ViewState("MyStringVar") = Nothing Then
        Return String.Empty
    End If
    Return ViewState("MyStringVar").ToString()
End Get
Set
    ViewState("MyStringVar") = value
End Set
End Property 
```

现在使用此属性，您可以在页面加载时保存变量并在按钮单击事件处理程序中访问它。

编辑：更新到 VB

            回答 #3

赞同：1

时间：2009-04-27T17:38:05.190

你不能把这个变量变成一个类范围的变量，而不是本地的吗？

            回答 #4

赞同：1

时间：2010-10-29T18:18:16.780

你在 page_load 之外声明变量，然后你可以在你想要的地方使用它:)

            回答 #5

赞同：0

时间：2009-04-27T18:54:59.420

您还可以创建一个封装动作的类。然后，您可以捕获所需的任何数据，并在以后轻松添加。

```
void Page_Load()
{
    myBtn.Click += new MyButtonClass(variable).Run;
}

class MyButtonClass
{
    int Param;

    MyButtonClass(int param)
    {
        Param = param;
    }

    public void Run(object sender, EventArgs args)
    {
        // Do something usefull
    }
} 
```

如果在每个 Page_Load 上创建/检索数据，这将起作用。如果它包裹在 (!IsPostBack) 周围，则数据必须存储在会话中。幸运的是，可以轻松修改该类以存储/加载会话参数中的变量。

我很抱歉 c# 代码，也许其他人可以翻译它然后删除此消息？

        ruby-on-rails - 希望将电子邮件从我的服务器（后缀）发送到我域上的电子邮件地址以发送到谷歌应用程序

ID：794431

赞同：3

时间：2009-04-27T17:12:57.917

标签：ruby-on-rails, email, google-apps, postfix-mta

我有用于接收电子邮件的谷歌应用程序。我在 info@[my-domain.com] 上收到人们的询问，该电子邮件托管在 google 上。

有时，我希望我的 Rails 设置可以从我自己的服务器发送电子邮件，这很好用。但是当我想发送到我自己域上的电子邮件地址时，例如 info@my-domain.com，postfix 会看到 my-domain.com 并尝试在本地发送。

我知道这很正常，但我希望将这些电子邮件发送到谷歌应用程序，而不是尝试在本地发送。

我知道有一个用于别名的 postfix 配置文件，但是在这里，电子邮件地址是相同的，只需要告诉 postfix 不要尝试在本地发送。

有什么办法可以做到这一点？

            回答 #1

赞同：3

时间：2009-04-27T17:41:58.020

听起来您设置了两个邮件服务器作为向您的域发送电子邮件的主要目的地：Google Apps 和您的 postfix 服务器。您不能这样做，因为正如您所发现的，邮件有时会发送到一台服务器，有时会发送到另一台服务器。

大概您希望 Google Apps 成为主要目的地。也就是说，您域的邮件应该发送到 Google 服务器，而不是您的服务器。您需要重新配置 postfix，使其不是您域的邮件服务器。

编辑**/etc/postfix/main.cf**文件并查找**mydestination**行。从该行中删除您的域。

我通常不使用后缀，但我认为如果该行看起来像这样，你会很好：

```
mydestination = $myhostname localhost.$mydomain localhost 
```

假设您的服务器名称是“test1”，您的域是“example.com”。以下地址将在本地交付：

```
info@test1
info@localhost.example.com
info@localhost 
```

但是发送到 info@example.com 的邮件会转到 Google Apps，因为 postfix 未配置为仅接受“example.com”的邮件。

            回答 #2

赞同：0

时间：2009-04-27T17:18:48.497

我通过这样做[http://souptonuts.sourceforge.net/postfix_tutorial.html](http://souptonuts.sourceforge.net/postfix_tutorial.html)来解决它。基本上通过您的一个谷歌域帐户而不是本地发送该邮件。  

            回答 #3

赞同：0

时间：2009-05-05T06:13:07.157

正如 Barry Brown 建议的那样，通过从 postfix 框上的 $mydestination 中删除它来告诉 postfix my-domain.com 不是本地的，或者如果这不切实际，则在 Postfix 中使用虚拟别名来重写该特定地址（info@my- domain.com) 到您要将其交付到的 google 托管地址。

Postfix 中的虚拟别名不仅仅适用于虚拟别名地址类；它们是一种通用的队列前地址重写机制。Sendmail 样式的别名（取决于您的发行版，/etc/aliases 或 /etc/postfix/aliases）由本地投递代理使用，并且仅适用于本地地址类。当然，您可以使用 sendmail 样式的别名将“信息”的邮件转发到 some-address@your-google-hosted-domain。

postfix.org 上的文档非常好。尝试

[http://www.postfix.org/STANDARD_CONFIGURATION_README.html](http://www.postfix.org/STANDARD_CONFIGURATION_README.html)

[http://www.postfix.org/ADDRESS_CLASS_README.html](http://www.postfix.org/ADDRESS_CLASS_README.html)

[http://www.postfix.org/ADDRESS_REWRITING_README.html](http://www.postfix.org/ADDRESS_REWRITING_README.html)

[http://www.postfix.org/VIRTUAL_README.html](http://www.postfix.org/ADDRESS_REWRITING_README.html)

        iphone - DB Wrapper 不响应消息？

ID：794445

赞同：1

时间：2009-04-27T17:17:16.457

标签：iphone, objective-c, sqlite

我正在为 iphone-sdk 2.2.1 开发（所以没有 CoreData *cry*）。

所以我正在使用[FMDatabase 项目](http://code.google.com/p/flycode/source/browse/trunk/fmdb/src/FMDatabase.h)，它只是 Obj C 中的一个 SQLite 包装器。从我的 AppDelegate 与它交互时，我的数据库运行良好。我已经从 AppDelegate 测试了连接、插入等。

现在，我有一个要存储到数据库中的数据对象。我希望这个事件发生在 ViewController 类中。让我们看一些代码：

App Delegate 在 applicationDidFinishLaunching 方法中创建数据库。DB 被声明为此类的属性，因此我可以轻松访问它。

```
db = [FMDatabase databaseWithPath:[self getDBPath]]; 
```

这很好用，我已经测试过了。我唯一有点担心的是“db”是类的属性。这不应该引起问题，不是吗？

从同一个 applicationDidFinishLaunching 方法中，我测试了一个简单的插入是否可以使用。这有效：

```
[db beginTransaction];
[db executeUpdate:@"INSERT INTO tblDataSamples (...) VALUES (...);"];
[db commit]; 
```

现在，如果我只是简单地将这个确切的代码移到 AppDelegate 的一个实例方法中，那么该代码将不再有效。`"EXC_BAD_ACCESS"`当我们点击 [db beginTransaction] 行时出现错误。

此调用的代码流程： - AltViewController 接收按钮点击事件 - AltViewController 告诉 ApplicationDelegate 执行“addSample”方法。- ApplicationDelegate 的 addSample 方法在 [db beginTransaction] 上失败。

现在我已经把它写出来了，我想问题是我的数据库在 ApplicationDelegate 加载 RootView 后丢失了。也许我错了。有人有想法么？

！！！！！！！！！

**更新！**
*我刚刚更改了我的 addSample 方法以包含* 

```
db = [FMDatabase databaseWithPath:[self getDBPath]];
    if (![db open]) {
        NSLog(@"Could not open db.");
    } 
```

和

```
[db close]; 
```

整个交易现在有效。所以，新的问题是：我如何使数据库打开一次并在不同的视图和视图控制器之间保持打开状态？

            回答 #1

赞同：2

时间：2009-04-27T17:49:02.807

您遇到了麻烦，因为您还不知道内存管理规则。在这种情况下，该`databaseWithPath:`方法返回一个自动释放的对象，该对象在运行循环结束时被释放。但是，您的 db 指针仍然指向该无效的内存位置，这就是`EXC_BAD_ACCESS`您稍后尝试访问它时看到错误的原因。

好消息是内存管理在 Cocoa 中实际上很容易学习。看看[这个页面](http://www.cocoadev.com/index.pl?MemoryManagement)作为初学者，它应该有足够的信息让你继续前进。要解决这个特殊问题，您需要在`retain`创建 db 对象后调用该方法，并在不再需要它时释放它（如果您在应用程序的生命周期内保留它，那么释放它并没有任何好处，但它是仍然很好的做法）。

        lisp - lisp 今天用于什么，你认为它的发展方向是什么？

ID：794450

赞同：33

时间：2009-04-27T17:18:45.937

标签：lisp

从来不是一个*lisp*用户，所以在阅读本文时不要把我看得太密集。然而;

*   今天用 lisp 做什么？

我知道存在该语言的几种变体，至少有一种可以让它在商业上存活更长时间（AutoLisp、VisualLisp——来自 Autodesk 的相当大的支持）……但我没有遇到日常使用它的人。因此，如果您能对此事有所了解：

*   现在它的主要目标市场是什么？  

你认为它的未来会是什么？.. 它会成为少数应用程序中的另一种支持语言，还是会走向某个地方？

此外，除了“不得说出姓名的编辑”；

*   还有哪些其他应用程序将其作为支持语言？

            回答 #1

赞同：17

时间：2009-04-27T17:40:10.957

Lisp 方言 Clojure 似乎越来越受欢迎 - 您可以在某个论坛的[http://clojure.org/](http://clojure.org/)上询问，看看人们正在使用它构建哪些实际应用程序。

            回答 #2

赞同：15

时间：2009-04-27T17:24:30.370

我的 lisp 项目中的一个示例：

ShareBot：下载股市数据，进行分析并自动交易。每个月把钱存入我的银行账户！

            回答 #3

赞同：11

时间：2009-04-28T00:57:05.023

飞机设计：[http ://www.piano.aero/](http://www.piano.aero/)

LispWorks 列出了几个应用程序：[http ://www.lispworks.com/success-stories/index.html](http://www.lispworks.com/success-stories/index.html)

Franz 技术应用广泛：[http ://www.franz.com/](http://www.franz.com/)

            回答 #4

赞同：10

时间：2009-04-28T23:36:26.723

上周我想排版一些音乐，声誉最好的程序（免费或其他）似乎是 Lilypond。看到它主要是用 Scheme 编写和定制的，我感到很惊喜。

            回答 #5

赞同：10

时间：2009-04-28T23:51:00.947

主要用于配置和扩展 Emacs！

*鸭子*

            回答 #6

赞同：8

时间：2009-04-27T18:49:31.880

[CoCreate Modeling，现在是 CREO Elements/Direct Modeling](http://www.ptc.com/cad/3d-cad)，一个广泛的 3D CAD 应用程序使用 Common Lisp 作为其扩展语言。AFAIK 现在 Common Lisp 中有 7M+ LOC 用于该应用程序。实际上，Common Lisp 不仅是扩展语言，而且应用程序的大部分都是用 Common Lisp（加上一些 C++）编写的。

除此之外，Lisp 是一个具有不同实现的不同方言家族（Scheme、Common Lisp、Emacs Lisp、Visual Lisp、Clojure、Logo ......）等等。

强项例如：

*   符号计算（Maxima、Reduce、Axiom、ACL2、...）
*   人工智能、语义网、...（有关示例，请参阅 Franz 的客户故事）
*   CAD（AutoCAD、CoCreate 等）
*   音乐（OpenMusic、Common Music、PWGL、...）
*   图形应用程序（有关一些示例，请参阅 LispWorks 客户案例）
*   开发环境（Emacs 和其他）
*   教育（DrScheme，...）

            回答 #7

赞同：5

时间：2009-04-28T19:02:15.867

另请参阅[2009 年国际 Lisp 会议的主题](http://www.international-lisp-conference.org/2009/speakers)。这应该让您了解人们使用 Lisp 的目的以及他们正在考虑的新想法。

            回答 #8

赞同：4

时间：2009-04-27T17:57:49.073

似乎存在于[就业市场](http://seeker.dice.com/jobsearch/servlet/JobSearch?op=300&N=0&Hf=0&NUM_PER_PAGE=30&Ntk=JobSearchRanking&Ntx=mode+matchall&AREA_CODES=&AC_COUNTRY=1525&QUICK=1&ZIPCODE=&RADIUS=64.37376&ZC_COUNTRY=0&COUNTRY=1525&STAT_PROV=0&METRO_AREA=33.78715899%2C-84.39164034&TRAVEL=0&TAXTERM=0&SORTSPEC=0&FRMT=0&DAYSBACK=30&LOCATION_OPTION=2&FREE_TEXT=lisp&WHERE=)

骰子上的 24 个工作。

            回答 #9

赞同：4

时间：2009-04-27T18:01:03.357

Common Lisp 根本没有在该领域广泛使用，但这是我所知道的最成功的应用程序之一。

[ITA Software：Airfare Shopping Engine](http://www.franz.com/success/customer_apps/data_mining/itastory.php3)和 Franz lisp[列出](http://www.franz.com/success/)了其他人。

            回答 #10

赞同：1

时间：2010-04-08T07:37:47.167

今天使用lisp是用符号数据解释的AI系统。Lisp主要是为了展示List的功能而开发的。但它用作象征性的代表语言

            回答 #11

赞同：0

时间：2009-05-08T12:52:45.303

它可用于所有其他编程语言用于的任何事物，包括 Web、游戏、内部应用程序……

        c# - 页面上用户控件之间的通信 - C#/ASP.NET

ID：794452

赞同：0

时间：2009-04-27T17:19:25.763

标签：c#, asp.net

如果一个页面上有 2 个用户控件并且它们都有复选框控件。选中/取消选中一个用户控件中的复选框应选中/取消选中另一个用户控件中的复选框。

我看到需要用户控制通信。

有什么办法可以在客户端做到这一点？（我不想使用服务器端代码）

谢谢

            回答 #1

赞同：1

时间：2009-04-27T17:26:40.833

是的，最简单的方法是使用 jquery css 选择器并操作复选框值。这是一个简单的代码片段：

```
$("#checkbox1").attr("checked", $("#checkbox2").attr("checked")) 
```

checkbox1 的值是根据 checkbox2 的“选中”值设置的

            回答 #2

赞同：1

时间：2009-04-27T17:37:30.680

当然，不用说，使用**[jQuery](http://jQuery.com)**有更简单的方法可以做到这一点，但这里有一个例子，说明如何在没有它的情况下做到这一点。

```
<asp:CheckBox runat="server" ID="CheckBox1" onclick="checkBoxChanged1(this)" />
<asp:CheckBox runat="server" ID="CheckBox2" onclick="checkBoxChanged2(this)"/>

<script type="text/javascript">
var checkBox1 = document.getElementById("<%=CheckBox1.ClientID %>");
var checkBox2 = document.getElementById("<%=CheckBox2.ClientID %>");
function checkBoxChanged1(e)
{
    checkBox2.checked = e.checked;      
}
function checkBoxChanged2(e)
{
    checkBox1.checked = e.checked;      
}
</script> 
```

**这是使用 jQuery 的相同示例：**

```
<script type="text/javascript">
  $(function(){
       $("#<%=CheckBox1.ClientID %>").click(function(){
           $("#<%=CheckBox2.ClientID %>").checked = this.checked;
        });
       $("#<%=CheckBox2.ClientID %>").click(function(){
           $("#<%=CheckBox1.ClientID %>").checked = this.checked;
        });             
   });
</script> 
```

        c# - Windows 窗体 - ErrorProvider + DataGridView

ID：794459

赞同：10

时间：2009-04-27T17:21:53.510

标签：c#, .net, winforms, datagridview, errorprovider

如何将 ErrorProvider 与 DataGridView 控件上的单个单元格挂钩？

            回答 #1

赞同：10

时间：2013-07-29T16:45:10.717

我对 BFree 的解决方案的问题是，当单元格处于编辑模式时，什么都没有显示，但是如果我结束编辑，我会收到数据格式错误（因为我的值是双精度值）。我通过将 ErrorProvider 直接附加到单元格编辑控件来解决这个问题，如下所示：

```
private ErrorProvider ep = new ErrorProvider();
private void DGV_CellValidating(object sender, DataGridViewCellValidatingEventArgs e)
{
    if (e.ColumnIndex < 0 || e.RowIndex < 0)
        return;
    double val;
    Control edit = DGV.EditingControl;
    if (edit != null && ! Double.TryParse(e.FormattedValue.ToString(), out val))
    {
        e.Cancel = true;
        ep.SetError(edit, "Numeric value required");
        ep.SetIconAlignment(edit, ErrorIconAlignment.MiddleLeft);
        ep.SetIconPadding(edit, -20); // icon displays on left side of cell
    }
}

private void DGV_CellEndEdt(object sender, DataGridViewCellEventArgs e)
{
    ep.Clear();
} 
```

            回答 #2

赞同：8

时间：2009-04-27T18:07:57.253

我不确定您是否可以以这种方式使用 ErrorProvider，但是 DataGridView 具有内置的功能，这基本上是相同的想法。

这个想法很简单。DataGridViewCell 有一个 ErrorText 属性。你要做的是，你处理 OnCellValidating 事件，如果验证失败，你设置错误文本属性，你会得到那个红色的错误图标显示在单元格中。这是一些伪代码：

```
public Form1()
{
    this.dataGridView1.CellValidating += new DataGridViewCellValidatingEventHandler(dataGridView1_CellValidating);
}

private void dataGridView1_CellValidating(object sender, DataGridViewCellValidatingEventArgs e)
        {
            if (!this.Validates(e.FormattedValue)) //run some custom validation on the value in that cell
            {
                this.dataGridView1.Rows[e.RowIndex].Cells[e.ColumnIndex].ErrorText = "Error";
                e.Cancel = true; //will prevent user from leaving cell, may not be the greatest idea, you can decide that yourself.
            }
        } 
```

            回答 #3

赞同：2

时间：2010-04-01T09:25:17.890

您可以只`IDataErrorInfo`在您的 BusinessObjects 中实现，并将 BindingSource 也设置为 ErrorProvider 的 DataSource。这样，您的 BusinessObject 实习生验证就会显示在 DataGrid 中以及对象自动绑定到的所有字段上。

            回答 #4

赞同：1

时间：2009-07-22T18:43:48.257

```
private void myGridView_CellValidating(object sender, DataGridViewCellValidatingEventArgs e)
{
    var dataGridView = (DataGridView)sender;
    var cell = dataGridView.Rows[e.RowIndex].Cells[e.ColumnIndex];
    if ( ... ) // Validation success
    {
        cell.ErrorText = string.Empty;
        return;
    }

    dataGridView.EndEdit();
    cell.ErrorText = error;
    e.Cancel = true;
} 
```

            回答 #5

赞同：0

时间：2009-04-27T17:33:36.993

您可以向 dataGridView.Columns 添加一列（如 DataGridViewTextBoxColumn），将 CellTemplate 设置为您自己的实现（例如，从 DataGridViewTextBoxCell 继承）。然后在您的实现中 - 根据需要处理验证 - 渲染和定位编辑面板以满足您的需求。

[您可以在http://msdn.microsoft.com/en-us/library/aa730881(VS.80).aspx](http://msdn.microsoft.com/en-us/library/aa730881(VS.80).aspx)查看示例。

但话又说回来 - 可能有一个更简单的解决方案。

        c++ - POSIX线程经验？（或者推荐更好的）

ID：794462

赞同：2

时间：2009-04-27T17:24:08.157

标签：c++, multithreading, cross-platform, pthreads

我正在寻找适用于 C++ 的轻量级多线程框架。我找到了 POSIX 线程。

请分享您使用 POSIX 线程的实践经验：在开始使用它之前，我想从真实的人那里了解它的优缺点，而不是从 wiki。

如果您实际上将它与任何东西（也许更好）进行了比较，那么了解它们也会很有趣。  

**UPD：**跨平台功能对我来说真的很重要，所以我会很感激所描述的这个方向。  

**UPD2：**我已经体验过 QNX / Win32 的一个框架，但它不是轻量级的，而且 - 哦，我忘了提， - 它是商业的，不是免费的，但我需要一个免费的。

            回答 #1

赞同：12

时间：2009-04-27T17:26:27.777

我发现[Boost.Threads](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)非常好，尤其是在 1.35 重写之后。Windows 上的 POSIX 线程并不是那么简单，它是一个 C API，所以我肯定更喜欢 Boost。它拥有您需要的所有东西，便携且几乎不需要设置。

            回答 #2

赞同：3

时间：2009-05-01T15:59:08.887

另一个 C 线程 API 是来自 GLib 的 GThreads。一些 gthread 和 pthread 调用（例如 pthread_create）之间存在一对一的映射，但 gthread 有两个我发现非常有用的大特性：

*   线程池和
*   用于在线程之间发送消息的异步队列。

线程池非常强大，允许动态调整池大小。见[http://library.gnome.org/devel/glib/2.20/glib-Threads.html](http://library.gnome.org/devel/glib/2.20/glib-Threads.html)

            回答 #3

赞同：2

时间：2009-04-27T17:34:33.777

POSIX 线程 API 是 C API，而不是 C++。

你想用它做什么？就个人而言，我发现它是一个非常笨拙且过于冗长的 API。但如果您想在类 Unix/Linux 操作系统上进行跨平台开发，这是您最好的选择。它在 Windows 上不受本机支持。

就个人而言，我不会直接在您的代码中使用线程或任何其他依赖于操作系统的 API。在其之上构建另一个抽象层。例如，我们构建了我们所谓的“操作系统层”；一个用于处理线程、信号量、计时器、互斥锁等的 C++ 框架。我们的代码专门使用它。在底层，我们有针对 POSIX、Win32、INTEGRITY 和 vxWorks 的实现。这让我们的代码可以在各种各样的平台上工作。

如果您不想构建自己的层，则可以考虑重用许多其他层，例如 Boost、Qt 等。

            回答 #4

赞同：2

时间：2009-04-27T17:38:16.203

不久前，我在编写的程序中使用了 POSIX。它在 Linux 和 Solaris 上运行良好，实现起来也不是很复杂。另一方面，我的兄弟是一名 Windows 程序员，他更喜欢 Posix。我想这取决于你的目标。我发现 boost 有点臃肿，并且听说过有关它的坏消息。我哥哥认为这是自切片面包以来最棒的事情。我想这是福特vs雪佛兰的事情。每个人都会有意见。

            回答 #5

赞同：2

时间：2009-04-27T17:53:36.273

如果你不喜欢[Boost](http://www.boost.org/)的线程 API，那么你可能想看看[POCO](http://pocoproject.org/)的。

            回答 #6

赞同：1

时间：2009-04-28T23:41:53.480

正如你提到的 QNX 看看[ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)。它是一个庞大的框架，可用于[许多平台](http://www.cs.wustl.edu/~schmidt/ACE-versions-i.html)（包括 QNX）。其他人已经提到了[Boost](http://www.boost.org/)。

建议您使用这些库之一，而不是使用低级、不可移植且容易出错的 C API。

            回答 #7

赞同：1

时间：2009-05-15T00:42:31.893

如果您使用 C++ 工作，Boost 线程库可能是您最好的选择。我在 Unix 和 win32 上都有非常积极的经验。避免 ACE - 糟糕的设计，错误的方法。也看看[Intel TBB](http://www.threadingbuildingblocks.org/)，虽然我没有在实践中使用它。

            回答 #8

赞同：0

时间：2009-04-27T18:03:12.710

我发现它与 win32 线程 API 非常相似，您需要注意的唯一（真正）区别是 win32 互斥锁在同一个线程上使用时不会阻塞，而 posix 会阻塞。除此之外，它还是一个非常简单的 API。

        php - PHP 中的“网页已过期”$_SESSIONS

ID：794465

赞同：3

时间：2009-04-27T17:25:12.303

标签：php, session

在我正在使用的网络应用程序中`$_SESSIONS`，但有时，当用户按下退格键时，他会得到：

网页已过期

信息。

为什么会这样？我能做些什么来避免这种情况？

            回答 #1

赞同：6

时间：2009-04-27T17:26:52.937

这与变量没有任何关系`$_SESSION`，它与您使用 POST 方法在页面之间传输信息有关。如果你想避免它，你需要使用 GET 方法而不是 POST。

            回答 #2

赞同：2

时间：2009-04-27T19:05:14.573

它还与发送到浏览器的缓存控制指令有关。看看[http://de.php.net/manual/en/session.configuration.php#ini.session.cache-limiter](http://de.php.net/manual/en/session.configuration.php#ini.session.cache-limiter)和[http://shiflett.org/articles/how-to-avoid-page- has-expired-warnings](http://shiflett.org/articles/how-to-avoid-page-has-expired-warnings)以了解有关缓存设置的更多信息。

[http://shiflett.org/articles/how-to-avoid-page-has-expired-warnings](http://shiflett.org/articles/how-to-avoid-page-has-expired-warnings)：回顾

为避免“页面已过期”警告，请将 session.cache_limiter 设置为私有，并确保使用 POST 方法的任何表单提交到将用户重定向到不同 URL 的中间处理页面。

            回答 #3

赞同：2

时间：2009-04-27T20:47:04.033

就像乍得说的，这是返回到一个 POST 请求结果的页面的结果。就像评论说的那样，您不能只用 GET 替换 POST，因为出于各种原因，这是一个坏主意。

但是，您可以将两者结合起来：让请求为 POST，但发出 Location 标头重定向，然后浏览器将作为 GET 执行。对用户来说，这看起来像是一个单一的操作，但对浏览器来说，这将是一个 POST 后跟一个 GET，这有效地消除了这个问题。

        c# - 如何避免内存泄漏？

ID：794466

赞同：15

时间：2009-04-27T17:25:23.427

标签：c#, memory-leaks

我可以使用哪些技巧来避免应用程序中的内存泄漏？有什么我可以注意的陷阱或陷阱吗？

            回答 #1

赞同：21

时间：2009-04-27T17:27:30.940

对 IDisposable 对象调用 Dispose 或使用该`using`子句。这应该可以解决我能想到的大多数泄漏问题。

            回答 #2

赞同：12

时间：2009-04-27T17:32:52.033

注意您删除了您使用的任何事件处理程序。在 .NET 中，它们是导致内存泄漏的最常见原因。

            回答 #3

赞同：7

时间：2009-04-27T17:31:10.137

正如 ocdecio 所提到的，请务必在 Idisposable 对象上调用 Dispose，并记住在使用完对象后删除事件处理程序。在构建使用非托管资源的类时，一定要实现 Idisposable，这样用户就会知道有需要处理的关键资源。

此外，即使垃圾收集为您做了很多工作，您也应该摆脱对已完成对象的引用。否则他们仍然有一个根，他们不会被 GC'ed。

            回答 #4

赞同：6

时间：2009-04-27T18:30:26.920

不要低估工具在这些情况下的帮助。.NET 内存分析器现在相当成熟和健壮，如果您有一个复杂的应用程序，其中您认为应该释放的对象仍然被其他东西作为引用保存，那么查明该引用的能力是无价的。

我刚刚完成了对 WPF 选项卡页托管 Windows 窗体控件的内存泄漏的追捕（因为这些选项卡包含大量数据，您可以随意打开和关闭它们，只需等待 GC 清除关闭时的内存不是一个选项）。在打开选项卡、打开选项卡、再次关闭它并拍摄另一个快照之前，我使用[YourKit](http://www.yourkit.com/.net/profiler/index.jsp)分析器拍摄内存快照。在分析器中，您可以直观地比较两个快照，并查看哪些对象在该过程中幸存下来，并根据它们的引用返回 GC 根。我没有使用其他分析器的经验，但我知道如果 YourKit 不能满足您的需求，那里有一些。

编辑添加：

好的，这不是在*避免*内存泄漏，而是在修复它们。但我将把它留在这里，因为我认为它是有用的信息，而且我认为没有足够多的 .NET 开发人员了解这些工具。

            回答 #5

赞同：5

时间：2009-04-27T17:38:10.273

我知道有些人会建议将垃圾收集作为解决方案。但是在很多情况下，垃圾收集并没有给您预期的结果。最终很容易坚持一个杂散的引用，这会阻止整个内存链被释放。[阅读](http://www.codeproject.com/KB/showcase/IfOnlyWedUsedANTSProfiler.aspx)有关这如何破坏 DARPA 大挑战条目的信息。您可以争辩说这些不是内存泄漏，但如果程序希望释放内存，它仍然是一个问题。就像在 C 编程中一样，几个月后，您就掌握了如何确保不会留下不需要的引用的窍门。

            回答 #6

赞同：5

时间：2009-04-27T17:53:26.993

内存泄漏是错误，所以一般来说 - 这个问题可以像“如何在没有错误的情况下编写代码”一样回答？从长远来看 - 不可能没有错误，但您可以限制在已发布代码中出现错误的机会。

从关心开发的代码质量开始，并遵循其他人提到的指导方针。

1.  简单是金 - 代码越简单 - 错误或泄漏的机会就越少
2.  使用非托管资源时要小心——Windows 句柄、数据库连接、GDI 对象等。
3.  用于 IDisposables
4.  为携带非托管资源的类实现 IDisposable
5.  确保删除对未使用对象的任何引用 - 包括棘手的事件处理程序

在这些之上 -**实施测试**以查看内存是否泄漏 - 单元、并发、压力和负载测试在这里最有帮助。通过检查指标（性能计数器）查看内存是否泄漏。您还可以记录对象的创建和销毁，并在测试结束时分析日志。

            回答 #7

赞同：3

时间：2009-04-27T17:41:37.007

我遇到了对象（Ping）通过实现 IDisposable 接口并同时继承它两次实现 Dispose() 的问题。继承的方法什么也没做，因此在调用 Dispose() 时必须将对象强制转换为 IDisposable，否则会泄漏内存。这是[我几年前写的一篇](http://blog.mbcharbonneau.com/2006/11/14/using-the-ping-class-in-net-20-without-memory-leaks/)更详细的帖子。

            回答 #8

赞同：3

时间：2009-04-27T17:48:27.067

1.  在 using 构造中包装任何一次性的东西。
2.  避免使用 COM 对象。
3.  检查所有事件处理程序是否已正确删除。
4.  检查所有数据绑定是否被正确删除。
5.  把事情简单化

如果您的应用程序逻辑变得不必要地复杂，您可能会开始以内存泄漏告终。如果你保持你的类很小并遵循一般的编码实践，你可能不会在托管代码中遇到任何内存泄漏。这是可能的，但不像过去那样可能。

如果您怀疑内存泄漏，请使用分析器查看是否有任何对象被保留的时间超过所需时间。

上一次我遇到严重的内存泄漏是 .NET 1.1，结果发现框架中存在错误。

            回答 #9

赞同：2

时间：2009-04-27T17:34:50.470

[对垃圾收集器](http://msdn.microsoft.com/en-us/library/0xy59wtx.aspx)的工作原理有一个基本的了解将帮助您避免滥用内存。例如，如果您保留对不再需要的对象的引用，gc 将无法收集它。

同样，如果您要存储用户输入的数据或随时间添加的数据，则应考虑某种限制，以免内存使用量无限增长。

            回答 #10

赞同：2

时间：2009-04-27T17:43:12.900

我在 .NET 中遇到的大多数内存泄漏都与使用 COM 对象和未正确释放它们有关。一旦我看到对 COM 对象的引用，我就会想到“内存泄漏”。

            回答 #11

赞同：2

时间：2009-04-27T17:59:10.457

内存未被 GC 销毁的最常见情况是，当您的事件处理程序未正确解除挂钩时。如果需要，您可以在 Dispose() 中取消挂钩。

我更详细地描述了这个问题，并且我有办法编写测试以确定您是否在[此处](http://houseofbilz.com/archive/2008/11/11/writing-tests-to-catch-memory-leaks-in-.net.aspx)泄漏对象。

            回答 #12

赞同：2

时间：2009-04-27T18:06:12.423

正如其他人所说，调用 Dispose() （或使用 using 语句），但另外考虑类是否使用资源，如果是，则实现 IDisposeable。这在我的代码中最常见的问题是我有一个类，其成员在 GC 之前不会被清理。

            回答 #13

赞同：1

时间：2009-04-27T17:27:55.633

它是托管代码，即 c#，因此您必须努力泄漏内存：P

试试谷歌：
 [http ://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=Mbp&q=c%23+memory+leaks&btnG=Search](http://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=Mbp&q=c%23+memory+leaks&btnG=Search)

            回答 #14

赞同：1

时间：2009-04-27T18:31:34.607

如果任何一个终结器由于某种原因阻塞，实现终结器的类型可能会泄漏。由于锁定和线程单元问题，我已经看到终结器阻塞。

由于具有终结器的类型的实例在它们各自的终结器运行之前不会被收集，因此单个阻塞终结器将阻止任何其他可终结的对象等待收集。

            回答 #15

赞同：1

时间：2009-04-27T19:07:18.640

首先，让我分享一下我对内存泄漏的严格理解。我对内存泄漏的定义是当您分配了内存并且不再引用它时，因此无法释放该内存。话虽如此，.net 对象（我的意思是托管堆中的 CTS 类型的实例）中不可能存在内存泄漏。未引用的内存正是 GC 寻找释放的内存。

话虽如此，人们对什么是内存泄漏可能会有更松散的理解。如果您认为内存泄漏是正在使用的内存的不受控制的增长，那么这很容易。只是大量滥用静态变量，主要是那些引用巨大列表的变量。如果你保留这些对象的引用，GC 将永远不会清理它们，将它们提升到更高的代，并使它们更难收集。尽管这不是严格意义上的内存泄漏，但最终它可能会导致类似的症状。尝试检测这种“泄漏”的一个好方法是使用[CLR Profiler](http://www.microsoft.com/downloads/details.aspx?FamilyId=A362781C-3870-43BE-8926-862B40AA0CD0&displaylang=en "CLR 探查器")。

“泄漏”的另一个来源是如前所述不恰当地使用事件处理程序。每当对象 A 向对象 B 的事件注册其实例方法之一时，对象 B 就会结束对对象 A 的间接引用，这意味着当 B 处于活动状态时，A 将保持活动状态。但是请注意，这里没有循环。只要 B 或 A 都没有任何根引用，无论它们有多少交叉引用，它们最终都会被收集。

最后，实际上可以在 .net 中引发内存泄漏，但在谈论托管内存时（至少理论上）永远不会，因为 GC 在清除它方面做得很好。如果您的任何对象维护对非托管内存的引用，例如通过互操作，则需要显式清理该内存。如果不这样做，确实会导致内存泄漏。尽管我从未经历过这样的场景，但至少在理论上这可能会发生。如前所述，持有此类引用的对象应该实现 IDiposable 以清除内存，并且它们的使用应保证为此目的调用 Dispose，主要是通过使用 using 子句。请注意，Dispose 不会释放对象的内存，而只会要求对象释放它所引用的任何非托管内存。

一种特殊的非托管内存是互操作场景中使用的 COM 对象所需要的。这些对象通过 Runtime Callable Wrappers、朋友的 RCW 访问，但没有 Dispose。“使用”将不起作用。释放底层 COM 对象的方式是通过静态方法：

```
System.Runtime.InteropServices.Marshal.ReleaseComObject(object); 
```

由于“使用”只是在 finally 块中调用 IDisposable.Dispose() 的语法糖，因此它不能与 RCW 一起使用，因此不要忘记自己将调用放在 finally 块中的 ReleaseComObject(object) 中，以便确保它真的叫。

            回答 #16

赞同：0

时间：2009-04-27T17:48:09.283

使用“using”关键字自动调用 IDisposable 对象的 Dispose() 方法。

对于任何 COM 互操作，您必须手动释放所有资源。

            回答 #17

赞同：0

时间：2009-11-03T14:33:15.377

您可能会发现我的新文章很有用：[如何检测和避免 .NET 应用程序中的内存和资源泄漏](http://weblogs.asp.net/fmarguerie/archive/2009/11/03/article-detect-avoid-memory-leaks.aspx)

        asp.net - 使用 sharpsvn API 从 ASP.Net 访问 Visual SVN

ID：794467

赞同：4

时间：2009-04-27T17:25:28.433

标签：asp.net, svn, visualsvn-server, sharpsvn

有没有人尝试使用 SharpSVN API 通过 ASP.Net访问[VisualSVN 服务器存储库？](http://www.visualsvn.com/server/)如果是，挑战是什么？

            回答 #1

赞同：3

时间：2009-04-27T20:46:28.573

在 ASP.NET 中使用[SharpSvn](http://sharpsvn.net/)时，您应该注意一件事，请参阅[此论坛帖子](http://sharpsvn.open.collab.net/ds/viewMessage.do?dsForumId=728&dsMessageId=107725)

        vb.net - 如何使用 VB.NET 从压缩文件夹中使用剪贴板复制和粘贴文件

ID：794482

赞同：1

时间：2009-04-27T17:29:42.480

标签：vb.net, clipboard

如何使用[VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET)从压缩文件夹中使用剪贴板复制和粘贴文件？

我想从剪贴板粘贴一个文件，该文件已使用 VB.NET 从压缩文件夹中复制。通过检查剪贴板，我看到有一个 FileGroupDescriptorW 似乎包含有关该文件的一些信息。但是我如何使用这些信息来抓取文件并粘贴呢？

            回答 #1

赞同：1

时间：2010-03-24T03:04:16.300

剪贴板应包含[CF_HDROP](http://msdn.microsoft.com/en-us/library/aa313482%28v=vs.60%29.aspx)格式的数据。这可以通过调用[DragQueryFile](http://msdn.microsoft.com/en-us/library/windows/desktop/bb776408%28v=vs.85%29.aspx) API 转换为文件列表。

然后它只是复制的任何文件的完全限定文件名的列表，现在您可以对这些文件进行操作。*[如何获取从 Windows 资源管理器复制的文件](http://support.microsoft.com/kb/231721)*中有一个 Visual Basic 示例。

        asp.net-mvc - Ajax.BeginForm 在 Firefox 中不起作用

ID：794484

赞同：0

时间：2009-04-27T17:30:08.313

标签：asp.net-mvc, firefox, ajax.beginform

当我将 Ajax.BeginForm 与 updateTargetId 一起使用时，它在 IE 中运行良好 - 替换了 updateTargetId 标记内的 html。同样的事情将页面重定向到表单的操作。Ajax.BeginForm 在 Firefox 中工作吗？

            回答 #1

赞同：0

时间：2009-04-27T17:38:13.723

是的，确实如此。您可能有格式不正确的 HTML 或阻止其正常工作的 javascript 错误。

如果您仍然找不到它，请发布呈现的标记，我们可以查看它。

        .net - 如何重构紧耦合类？

ID：794485

赞同：5

时间：2009-04-27T17:31:05.690

标签：.net, design-patterns, refactoring, coupling

我正在尝试重构一个大型紧密耦合的应用程序，并试图使其更易于维护和灵活。

我有很多单元测试，所以我希望逐步重构。

我应该考虑实施/应用哪些设计和重构模式来完成这项任务？

我能想到一些：

*   [提取接口](http://sourcemaking.com/refactoring/extract-interface) 
*   [提取方法](http://sourcemaking.com/refactoring/extract-method)
*   [依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)

也可以随意分享你自己的这种重构工作的经验和最佳实践。

**更新** 

[由于这个问题中解释的原因，](https://stackoverflow.com/questions/794038)我正在执行此重构。基本上我不能在不提取几个接口的情况下实现插件系统，并且这些接口是高度耦合的，这需要将应用程序分离到 40 多个 DLL 中才能在没有循环引用问题的情况下进行编译。

            回答 #1

赞同：9

时间：2009-04-27T17:37:04.020

说真的，重构并不是一件可以掉以轻心的事情，尤其是在紧密耦合的系统中。在执行之前，它通常看起来像是一项值得的任务，但根据我的经验，一旦开始它很快就会成为一种负担，因为它通常更可能引入新的错误而不是解决任何现有的问题。

在着手进行重大重构之前，您应该考虑将获得哪些收益以及有哪些替代方案（例如从头开始创建新产品，仅立即重构需要它的部分等）。在开始之前，您当然应该对架构、角色和职责以及预期和现有的行为有一个很好的了解，以确保您知道什么时候出了问题。

此外，制定重构后的设计以及如何映射到当前实现，这样您就可以保持重点，这可能是有益的。您还应该尽可能频繁地进行回归测试。

当设计显然需要重构时，完美主义者可能会感到沮丧，但有时必须考虑更改的成本/收益并承认战斗。如果你必须做出改变，小心行事，不要试图一次做太多。

            回答 #2

赞同：9

时间：2009-04-27T17:56:46.673

这是一个很大的问题，一个人可以写一本书来回答它。幸运的是，有人已经有了。获取一份Michael Feathers的**《有效使用遗留代码》的副本。**这几乎是一整本书，专门用来回答你的问题。

这也是一本非常好的书。我肯定会将它与**Code Complete**、**Design Patterns**和**Pragmatic Programmer**一起放在每个开发人员图书馆都应该包含的书籍列表中。

            回答 #3

赞同：5

时间：2009-04-27T17:37:43.333

重构接口和依赖注入将是减少耦合的关键。您可能还想考虑使用工厂来创建依赖对象。

            回答 #4

赞同：2

时间：2009-04-27T17:59:33.000

*以上所有，然后一些。*  但在你开始之前，我会考虑大局。定义程序的各个部分（包、项目等），然后制定计划将功能移动到适当的包中。然后，一旦一切都在逻辑上应该开始使用提取接口、依赖注入和工厂方法开始解耦包。

            回答 #5

赞同：1

时间：2009-04-27T18:03:11.620

菲利普的一些好建议：
[重构低悬的果实](http://c2.com/cgi/wiki?RefactorLowHangingFruit)

我认为如果没有更多信息，很难说哪些特定的重构适合您的特定情况。

            回答 #6

赞同：0

时间：2009-04-29T20:24:28.953

感谢所有答案，在尝试了这么多不同的方法之后，我发现最好的办法就是为所有东西创建接口。这让我可以自由地更改设计，我只中断了一天的构建（一天因为项目很大，我需要修复这么多的引用和单元测试 + 一些重构）。

经过一天的提取和修复所有界面后，我可以创建单独的解决方案并自由地使用设计。

基本上，我认为首先应该将所有内容移至接口，然后尝试摆脱内部依赖项。

        permissions - BizTalk 服务器的用户权限

ID：794489

赞同：1

时间：2009-04-27T17:32:24.237

标签：permissions, biztalk

我的开发机器以本地管理员身份运行 BizTalk，我收到警告说它应该是......但我仍然这样做

但是将 BizTalk 用户放在“实时”服务器上的最佳安全组是什么？

            回答 #1

赞同：4

时间：2009-04-27T17:43:46.657

BizTalk 应用程序用户。

检查[BizTalk 2006 R2 安装指南](http://www.microsoft.com/downloads/details.aspx?FamilyID=df2e8a88-fb23-49a4-9ac7-d17f72517d12&displaylang=en)。

            回答 #2

赞同：3

时间：2009-04-28T19:08:22.797

我赞同 Rodrigo 关于查看安装指南的建议。但是，我还要补充一点，在大多数实时环境中，您需要在安装之前做好安全规划，因为安全和功能性部署可能很复杂。

特别是，密切关注与 BizTalk 交互的每个人（系统管理员、sql 管理员等）所需的权限，并确保为每个服务/主机定义单独的帐户以及应如何配置它们。

通常，您将使用至少两台独立的机器（一台运行数据库的 SQL 服务器和一台运行 BizTalk 本身）来部署 BizTalk。这要求您事先定义您的 BizTalk 帐户和安全组，并在部署*之前*在 AD 基础结构中创建它们，因此请确保您做对了。

即使您要将所有内容部署到单个服务器，请确保您对所有内容都使用域帐户并且不要跳过安全计划。这将使以后迁移到多服务器部署变得*更加*容易，而无需从头开始。

            回答 #3

赞同：0

时间：2012-02-17T01:21:27.663

我有 50% 的时间是 IT 管理员。另外 50% 是开发人员。这是你的开发机器。当然，您应该以管理员身份运行所有内容。别介意警告。你知道你做对了吗？如果不是..阅读罗德里戈答案中链接的访问权限。这是下一个级别 - 常见的开发/测试机器，您应该在其中遇到在现实条件下运行的问题......  

这是一个常见的开发/IT 操作问题，不仅与 BizTalk 有关。我知道这是一个古老的答案，但我希望开发人员能够接受我正在放下的东西......

        java - 如何在 Spring 中定义多个 sessionfactory 实例？

ID：794496

赞同：3

时间：2009-04-27T17:34:49.893

标签：java, hibernate, spring

我想在 Spring 应用程序中有多个 Hibernate SessionFactories，除了 DataSource 之外，它们都具有相同的配置。理想情况下，我会按名称获取特定的 SessionFactory。我需要能够根据运行时状态执行此操作，并且无法确定在应用程序启动时我需要哪些会话工厂。基本上，我需要一个 SessionFactoryTemplate 或类似的东西。

这可能吗？我该怎么做呢？

            回答 #1

赞同：3

时间：2009-05-01T18:16:37.653

您可以定义一个抽象 bean 并使用 bean 继承。这意味着您将拥有一个用作模板的 bean 定义，并且您可能有多个 bean 只是复制父 bean 设置的属性。

这是一个例子：

```
<bean id="abstractSessionFactory" abstract="true"
    class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
    <property name="mappingResources">
      <list>
        <value>product.hbm.xml</value>
      </list>
    </property>
    <property name="hibernateProperties">
      <value>
        hibernate.dialect=org.hibernate.dialect.HSQLDialect
      </value>
    </property>
</bean>

<bean id="mySessionFactory" parent="abstractSessionFactory">
    <property name="dataSource" ref="myDataSource"/>
    ...
</bean>

<bean id="mySessionFactory2" parent="abstractSessionFactory">
    <property name="dataSource" ref="myDataSource2"/>
    ...
</bean> 
```

使用“抽象”属性可以确保 bean 不会被实例化，它只会被用作模板。

更多信息在这里：[链接文本](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-child-bean-definitions)

            回答 #2

赞同：1

时间：2009-05-04T16:32:24.243

您确定需要多个 SessionFactories 吗？如果所有映射/配置都相同，并且您只有多个相同的数据库（例如在多租户应用程序中？），那么让一个连接到动态提供适当数据库连接的 DataSource 的 SessionFactory 怎么样？

有关更多详细信息，请参阅[此问题](https://stackoverflow.com/questions/120007/multiple-session-factories-under-spring-hibernate/120665#120665)：

还有这篇关于 Spring 中动态数据源路由的[博文。](http://blog.springsource.com/2007/01/23/dynamic-datasource-routing/)

            回答 #3

赞同：0

时间：2009-04-27T17:49:30.980

我不知道你当前的 bean 定义现在是什么样子，但你不会只是......定义第二个 SessionFactory 吗？

```
<bean id="mySessionFactory1" 
   class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
    <property name="dataSource" ref="myDataSource1"/>
    <property name="mappingResources">
      <list>
        <value>product.hbm.xml</value>
      </list>
    </property>
    <property name="hibernateProperties">
      <value>
        hibernate.dialect=org.hibernate.dialect.HSQLDialect
      </value>
    </property>
</bean>

<bean id="mySessionFactory2"
   class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
    <property name="dataSource" ref="myDataSource2"/>
    ...
</bean> 
```

然后，您可以简单地将您的 DAO 与一个 sessionFactory 与另一个连接起来：

```
<bean id="myProductDao" class="product.ProductDaoImpl">
  <property name="sessionFactory" ref="mySessionFactory1"/>
</bean>

<bean id="myCompanyDao" class="product.ProductDaoImpl">
  <property name="sessionFactory" ref="mySessionFactory2"/>
</bean> 
```

            回答 #4

赞同：0

时间：2009-04-27T22:45:14.357

我不知道使用 Spring 解决您的问题的简单方法。

但是，您可以使用 Hibernate 拦截器，前提是可以通过一个主/管理数据库连接访问您的特定数据库/数据源。[这篇博客文章](http://www.alvinsingh.org/blog/2008/06/hibernate-dynamic-table-routing/)详细解释了如何，但它的要点是动态替换 Hibernate 生成的 SQL 语句中的表名，用限定名称标识不同的数据库。这相对容易理解和维护，并且在我公司的多租户设置中运行良好。

除此之外，您可以尝试编写自己的`TransactionManager`，以`HibernateTransactionManager`为起点，添加对使用多个会话工厂的支持。但是，这意味着您必须真正深入了解 Spring ORM 支持内部，这是我尝试过的，但后来放弃了第一种方法。我确信它可以通过适度的努力来完成，但之前的解决方案已经为我们完成了这项工作。

        javascript - Safari 和 Chrome：动态编辑输入“大小”属性的问题

ID：794499

赞同：2

时间：2009-04-27T17:35:28.393

标签：javascript, jquery, safari, google-chrome

我有以下代码来创建自动调整大小的文本输入：

```
// setup quick jump input
$("#goto").keydown(function(e){
  var size = $(this).val().length;

  // sanity
  if ( size < 1 ) {
    size = 1;
  }

  $(this).attr("size",size);

  // if enter then GOTO->
  if ( e.keyCode == 13 ) {
    window.location.href = "/" + $(this).val();
  }
}); 
```

HTML：

```
<input type="text" id="goto" size="1" name="goto" /> 
```

**问题：**
调整输入大小在 Safari 或 Chrome 中不起作用，仅在 Firefox 和 Opera 中起作用。我正在使用 jquery 1.3.2 并且想知道它是 jquery 还是我的实现中的错误。

编辑：对不起，我一开始还不够清楚 - 这是我试图动态更新输入大小的部分，它被破坏了。我的错。感谢到目前为止的反馈，那里有一些非常有用的链接。

            回答 #1

赞同：3

时间：2009-04-28T02:33:28.617

我怀疑 size 属性是否可以跨浏览器工作。我会切换到设置输入字段的 maxlength 和 css 宽度，而不是更改 size 属性。

看起来像 webkit 中的错误/不支持的功能。哪个 Safari/Chrome 共享。

            回答 #2

赞同：1

时间：2009-04-27T17:38:46.373

根据 jQuery 文档[`keydown()`](http://docs.jquery.com/Events/keydown#fn)：

```
// Different browsers provide different codes
// see here for details: http://unixpapa.com/js/key.html    
// ... 
```

您是否检查[了引用的页面](http://unixpapa.com/js/key.html)以查看 Safari/Chrome/Webkit 是否具有不同的 Enter 键值？

            回答 #3

赞同：1

时间：2009-04-27T17:57:19.590

问题似乎在于设置 size 属性。这一行：

```
$(this).attr("size",size); 
```

            回答 #4

赞同：1

时间：2010-01-08T13:38:01.517

Safari 和 Chrome 不尊重某些属性。但是您可以通过 css 元素设置它。效果很好。

```
$(this).css("width","4em"); 
```

例如，我注意到在输入**onclick时****onClick**属性在 Chrome 中不起作用。 # .net - 如何创建使用 asp:ListItem 列表作为子控件的 ASP.NET 用户/服务器控件？

> ID：794500
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-04-27T17:35:49.937
> 
>         
> 
> 标签：.net, asp.net, user-controls, servercontrols

我希望创建一个用户/服务器控件，该控件将使用以下内容创建：

```
<my:MyListControl runat="server">
   <asp:ListItem Text="Test1" Value="Test1" />
   <asp:ListItem Text="Test2" Value="Test2" />
</my:MyListControl> 
```

我只是在这里寻找一个开始：文章或代码示例。

我应该从哪个基类继承？要覆盖什么？

可能如何自定义我的控件接受的子项（my:ListItem 而不是 asp:ListItem）。

我要做的是为我网站的一小部分创建一个非常简单的面包屑控件。我使用股票 ASP.NET 控件进行了所有操作，但是这些项目是在代码中添加的，这意味着修复拼写错误或格式错误涉及重新编译，这并不理想。

# 编辑：

这是我的代码，并在下面添加了 Josh 的建议：

命名空间 MySite.Controls 部分类 BreadCrumbs 继承 UserControl

```
 Private m_BreadCrumbs As New List(Of BreadCrumbItem)

    <PersistenceMode(PersistenceMode.InnerProperty)> _
    Public Property Items() As List(Of BreadCrumbItem)
        Get
            Return m_BreadCrumbs
        End Get
        Set(ByVal value As List(Of BreadCrumbItem))
            m_BreadCrumbs = value
        End Set
    End Property

    Private Sub Page_Load(ByVal sender As Object, ByVal e As EventArgs) Handles MyBase.Load
        Bind()
    End Sub

    Private Sub Bind()
        lvCrumbs.DataSource = Items
        Me.DataBind()
    End Sub
End Class

Public Class BreadCrumbItem
    Private m_Text As String
    Public Property Text() As String
        Get
            Return m_Text
        End Get
        Set(ByVal value As String)
            m_Text = value
        End Set
    End Property

    Private m_Url As String
    Public Property Url() As String
        Get
            Return m_Url
        End Get
        Set(ByVal value As String)
            m_Url = value
        End Set
    End Property
End Class 
```

结束命名空间

然后我的页面代码如下所示：

```
<%@ Page Language="VB" AutoEventWireup="false" Inherits="MySite.MyPage" Title="My Page" Codebehind="MyPage.aspx.vb" %>
<%@ Register TagPrefix="my" Namespace="MySite.Controls" Assembly="MySite" %>
<my:BreadCrumbs ID="breadcrumbs" runat="server">
    <Items>
        <my:BreadCrumbItem Text="Another page" Url="AnotherPage.aspx" />
    </Items>
</my:BreadCrumbs> 
```

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-04-27T17:46:13.080

您可以在用户控件的代码后面添加一个属性，例如：

```
[PersistenceMode(PersistenceMode.InnerProperty)]
public List<ListItem> Items
{
    get;
    set;
} 
```

您的标记将是：

```
<my:MyListControl runat="server">
  <Items>
    <asp:ListItem/>
  </Items>
</my:myListControl> 
```

为了使 ListItem 可以成为您自己的列表项（我建议这样做而不是使用 asp.net。）您需要创建自己的类。

这是我使用的服务器控件的示例（我删除了很多噪音，因此这只是一个骨架）：

```
 [ToolboxData("<{0}:Menubar runat=server></{0}:Menubar>")]
    [System.ComponentModel.DesignTimeVisible(false)]
    public class Menubar : WebControl, IPostBackEventHandler
    {

        private List<MenuItem> _menuItems = new List<MenuItem>();
        [PersistenceMode(PersistenceMode.InnerProperty)]
        public List<MenuItem> MenuItems
        {
            get
            {
                return _menuItems;
            }
        }

    }
    [ToolboxItem(false)]
    [ParseChildren(true, "MenuItems")]
    public class MenuItem
    {
        private string _clientClick;
        private List<MenuItem> _menuItems = new List<MenuItem>();

        [Localizable(true)]
        public string Title { get; set; }
        public string Href { get; set; }
        public string Id { get; set; }
        [PersistenceMode(PersistenceMode.InnerDefaultProperty)]
        public List<MenuItem> MenuItems
        {
            get { return _menuItems; }
            set { _menuItems = value; }
        }
    } 
```

现在我可以像这样使用它：

```
<my:Menubar runat="server" ID="menuBar">
    <MenuItems>
        <my:MenuItem Title="Save" Href="javascript:saveItem(this);"  />
        <my:MenuItem Title="Print" Href="javascript:void(0);">
            <MenuItems>
                <my:MenuItem Title="Preview" Href=""/>
                <my:MenuItem Title="To Pdf" Href="javascript:"/>
            </MenuItems>
        </my:MenuItem>
    </MenuItems>
</my:Menubar> 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:57:25.887

使用 asp:Repeater 然后将其绑定到面包屑中所需的对象列表。您可以使用模板自定义项目本身和分隔符。

# perl - 如何在文件中搜索具有不同标题的字符串？

> ID：794501
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T17:35:56.787
> 
>         
> 
> 标签：perl

我正在使用 perl 搜索文件中的特定字符串，其中不同的标题下列出了不同的序列。当存在一个序列即一个标题但无法推断它时，我能够编写脚本。假设我需要在给定文件中搜索一些字符串“FSFSD”，然后例如：
**如果文件具有以下内容，则无法搜索**：   

> 波兰
> 
>   CACAGTTGCTACGATCGATCGATDDASD 
> 
>   HCAYCHAYCHAYCAYCSDHADASDSADASD
> 
>   塞利姆斯
> 
>   FJDSKLFJSLKFJKASFJLAKJDSADAK 
> 
>   DASDNJASDKJASDJDSDJHAJDASDASDASDSAD 
> 
>   Teerag 
> 
>   DFAKJASKDJASKDJADJLLKJ 
> 
>   SADSKADJALKDJSKJDLJKLK

**当文件有一个标题时可以搜索，即：**

> 人
> 
>   族 FDKFJSKFJKSAFJALKFJLLJ 
> 
>   DKDJKASJDKSADJALKJLJKL 
> 
>   DJKSAFDHAKJFHAFHFJHAJJ

我需要将结果输出为“在标题**abc下找到的字符串****xyz** ”

 **我正在使用的代码是：

```
print "Input the file name \n";
$protein= <STDIN>;
chomp $protein;
unless (open (protein, $protein))
{
print "cant open file \n\n";
exit;
}
@prot= <protein>;
close protein;
$newprotein=join("",@prot);
$protein=~s/\s//g;
do{
print "enter the motif to be searched \n";
$motif= <STDIN>;
chomp $motif;
if ($protein =~ /motif/)
{
print "found motif \n\n";
}
else{
print "not found \n\n";
}
}
until ($motif=~/^\s*$/);
exit; 
```

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:33:25.103

看到您的代码，我想在不回答您的问题的情况下提出一些建议：

1.  永远，永远，*永远* `use strict;`。为了爱你可能（或可能不）相信的任何更高的力量，`use strict;`.

2.  每次你`use strict;`，你都应该`use warnings;`跟着它。

3.  另外，认真考虑使用一些缩进。

4.  此外，请考虑为不同的变量使用明显不同的名称。

5.  最后，你的风格真的很不一致。这是您的所有代码还是您将它们修补在一起？不要试图侮辱你或任何东西，但我建议不要复制你不理解的代码——至少在你复制它之前*尝试一下。*

现在，您的代码的可读性更高版本，包括一些修复和对您可能打算做什么的一些猜测，如下所示：

```
use strict;
use warnings;

print "Input the file name:\n";
my $filename = <STDIN>;
chomp $filename;
open FILE, "<", $filename or die "Can't open file\n\n";
my $newprotein = join "", <FILE>;
close FILE;
$newprotein =~ s/\s//g;
while(1) {
  print "enter the motif to be searched:\n";
  my $motif = <STDIN>;
  last if $motif =~ /^\s*$/;
  chomp $motif;
  # here I might even use the ternary ?: operator, but whatever
  if ($newprotein =~ /$motif/) {
    print "found motif\n\n";
  }
  else {
    print "not found\n\n";
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:02:14.363

主要问题是您如何区分标题和数据，从您的示例中我假设一行是标题，[如果](http://en.wikipedia.org/wiki/If_and_only_if "当且仅当")它包含一个小写字母。

```
use strict;
use warnings;
print "Enter the motif to be searched \n";
my $motif = <STDIN>;
chomp($motif);
my $header;
while (<>) {
    if(/[a-z]/) {
        $header = $_;
        next;
    }
    if (/$motif/o) {
        print "Found $motif under header $header\n";
        exit;
    }
}
print "$motif not found\n"; 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:06:00.333

所以你说你能够阅读一行并完成这项任务。但是当文件中有不止一行时，你不能做同样的事情吗？

只需有一个循环并逐行读取文件。

```
$data_file="yourfilename.txt";
open(DAT, '<', $data_file) || die("Could not open file!");
while( my $line = <DAT>)
{
 //same command that you do for one 'heading' will go here. $line represents one heading
} 
```

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:15:00.763

编辑：您发布的示例没有明确的分隔符，您需要在标题和序列之间找到明确的划分。您可以使用多个换行符或非字母数字字符，例如“,”。无论您选择什么，让以下代码中的 WHITESPACE 等于您选择的分隔符。如果您坚持使用现有格式，则必须更改以下语法以忽略空格并通过大写分隔（使其稍微复杂一些）。

简单的方法（ O(n^2)? ）是使用空格分隔符拆分文件，为您提供标题和序列数组（ heading[i] = split_array[i*2], sequence[i] = split_array[i *2+1])。对于每个序列执行您的正则表达式。

稍微困难的方法（ O(n) ），给定一个 BNF 语法，例如：

```
file: block
    | file block
    ;

block: heading sequence

heading: [A-Z][a-z]

sequence: [A-Z][a-z] 
```

尝试递归体面解析（伪代码，我不知道 perl）：

```
GLOBAL sequenceHeading, sequenceCount
GLOBAL substringLength = 5
GLOBAL substring = "FSFSD"

FUNC file ()
    WHILE nextChar() != EOF
        block()
        printf ( "%d substrings in %s", sequenceCount, sequenceHeading )
    END WHILE
END FUNC

FUNC block ()
    heading()
    sequence()
END FUNC

FUNC heading ()
    in = popChar()
    IF in == WHITESPACE
        sequenceHeading = tempHeading
        tempHeading = ""
        RETURN
    END IF
    tempHeading &= in
END FUNC

FUNC sequence ()
    in = popChar()
    IF in == WHITESPACE
        sequenceCount = count
        count = 0
        i = 0
    END IF
    IF in == substring[i]
        i++
        IF i > substringLength
            count++
        END IF
    ELSE
        i = 0
    END IF
END FUNC 
```

有关递归体面解析的详细信息，请查看[Let's Build a Compiler](http://compilers.iecc.com/crenshaw/)或[Wikipedia](http://en.wikipedia.org/wiki/Recursive_descent_parser)。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:29:05.593

```
use strict;
use warnings;
use autodie qw'open';

my($filename,$motif) = @ARGV;

if( @ARGV < 1 ){
  print "Please enter file name:\n";
  $filename = <STDIN>;
  chomp $filename;
}

if( @ARGV < 2 ){
  print "Please enter motif:\n";
  $motif = <STDIN>;
  chomp $motif;
}

my %data;

# fill in %data;
{
  open my $file, '<', $filename;

  my $heading;
  while( my $line = <$file> ){
    chomp $line;
    if( $line ne uc $line ){
      $heading = $line;
      next;
    }
    if( $data{$heading} ){
      $data{$heading} .= $line;
    } else {
      $data{$heading}  = $line;
    }
  }
}

{
  # protect against malicious users
  my $motif_cmp = quotemeta $motif;

  for my $heading ( keys %data ){
    my $data = $data{$heading};

    if( $data =~ /$motif_cmp/ ){
      print "String $motif found under Heading $heading\n";
      exit 0;
    }
  }

  die "String $motif not found anywhere in file $filename\n";
} 
```

# language-agnostic - 这种模式叫什么（有助于避免类型转换）？

> ID：794503
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-04-27T17:37:01.073
> 
>         
> 
> 标签：language-agnostic, design-patterns, oop

发现自己试图找到这个设计模式的官方定义的链接，我相信我在 Go4 中看到过，但似乎在任何地方都找不到。

```
class Processor{
    ProcessParameter(AbstractParameter x){
        x.Process(this);
    }

    ProcessParameter(ParameterA x){
        ... A-specific logic...
    }

    ProcessParameter(ParameterB x){
        ... B-specific logic...
    }
}

abstract class AbstractParameter{
    abstract void Process(Processor p);
}

class ParameterA : AbstractParameter{
    override void Process(Processor p){
        p.ProcessParameter(this);
    }
}

class ParameterB : AbstractParameter{
    override void Process(Processor p){
        p.ProcessParameter(this);
    }
} 
```

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2009-04-27T17:37:52.803

它是[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)。该技术称为“双重调度”。

# .net - 如何在 WPF 中实现自定义画笔？

> ID：794512
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-04-27T17:38:22.647
> 
>         
> 
> 标签：.net, wpf, brush

我在哪里可以找到有关画笔如何实现我自己的 System.Windows.Media.Brush 的足够信息？我可以处理所有可冷冻的行李，但我需要覆盖什么才能让它工作并不是很明显。

* * *

是的，所以我并不是说我想使用预定义的画笔。我想扩展 System.Windows.Media.Brush，它是一个抽象类。这一切纯粹是为了我自己的熏陶。我什至不确定我能做什么样的刷子。我只是想了解刷子是如何工作的。如：

```
public AwesomeBrush : Brush
{

    protected override Freezable CreateInstanceCore()
    {
        return new AwesomeBrush();
    }

    ... // concrete brush stuff

} 
```

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-04-27T18:34:45.613

我使用[Reflector](http://www.red-gate.com/products/reflector/)快速浏览了现有的画笔。看起来他们的实现非常封闭，并且依赖于大量的`internal`管道。虽然可以实现自己的画笔，但它似乎不是一个受支持的选项。甚至可能是 WPF 控件与现有画笔紧密相关，无法与自定义画笔一起使用。

实现类似于自定义画笔的最佳方式很可能是使用带有一些复杂绘图逻辑的[DrawingBrush 。](http://msdn.microsoft.com/en-us/library/system.windows.media.drawingbrush.aspx)您可以使用其他画笔从复杂的形状组成绘图画笔，这样您就可以实现所需的目标。

**修改后更新**

由于这是用于教育，您最好下载反射器并使用它来查看画笔的工作原理。它们并不是要自行实现的，而且由于它们依赖于`internal`程序员通常无法访问的某些类，因此很难做到这一点。

虽然有趣的是，[Brush 文档](http://msdn.microsoft.com/en-us/library/system.windows.media.brush.aspx)确实有一条注释供继承者以正确的方式从 Brush 继承。

**更多更新**

当我四处寻找时，我发现了一种在[中文博客](http://translate.google.com/translate?prev=hp&hl=fi&js=n&u=http%3A%2F%2Fblog.csdn.net%2Fxeonol%2Farchive%2F2007%2F12%2F17%2F1943067.aspx&sl=zh-CN&tl=en)上实现类似目标的非常巧妙的方法。诀窍是使用标记扩展，所以它看起来就像一个画笔。实际上，它会根据其属性创建一个新的图像画笔。似乎他得出了同样的结论，即有一些内部类阻碍了简单的实现。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2012-02-15T17:34:52.943

要回答为什么您可能想要自定义画笔的问题，请考虑一个复杂的几何图形，并且您希望使用与形状匹配的渐变填充它，同时从形状的中心（或任何任意起点）径向更改颜色。

没有办法用静态填充来做到这一点（这几乎消除了所有现有的画笔）。没有一遍又一遍地复制对象并将它们嵌套（并制定外壳以使其看起来都正确），用不同的颜色填充每个对象，唯一实用的方法是使用可以查看正在填充的对象的刷子.

这实际上在 Forms 中是可行的。

但看起来在 WPF 中没有任何方法可以做到这一点，这是不幸的。

事实上，WPF 的画笔同时具有惊人的强大功能和惊人的局限性。它们显然是为某些概念模型设计的，但我完全不确定它是否有用，除了一些非常微不足道的视觉效果，而且像往常一样，它变得更加复杂，带有奇怪的（记录不充分的）参数，这使得做简单，有些复杂。

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2010-03-18T21:18:54.477

我尝试了所有可能的角度来寻找制作自定义画笔的解决方案，从使用 MarkupExtensions 到弄乱 TypeConverter 属性，然后它让我大吃一惊：您只需创建一个基于 DependencyObject 的包装类，创建一个 Brush 类型的 DependencyProperty，实现您的自定义然后绑定到 Brush DependencyProperty。

然后，将自定义画笔放在资源中

```
 <l:CustomBrush x:Key="CustomBrush" Brush="Magenta" /> 
```

然后绑定到它：

```
 <Line X1="0" Y1="-5" X2="200" Y2="-5" 
        Stroke="{Binding Source={StaticResource CustomBrush}, Path=Brush}" 
        StrokeThickness="12"/> 
```

我认为这比 MarkupExtension 解决方案更好，因为您不能在 Resources 中放置一个，因此每次使用它时都必须重新定义自定义设置。

无论如何，这似乎是从任何 Wpf 对象继承的简单解决方案，并且借助 Bindings 的灵活性，您还可以绑定到包装的 Wpf 对象本身的成员。

这是简单的类：

```
public class CustomBrush : DependencyObject
{
   public CustomBrush()
   {
      this.Brush = Brushes.Azure;      
   }

   #region Brush DependencyProperty

   [BindableAttribute(true)]
   public Brush Brush
   {
     get { return (Brush)GetValue(BrushProperty); }
     set { SetValue(BrushProperty, value); }
   }
   public static readonly DependencyProperty BrushProperty =
      DependencyProperty.Register(
         "Brush",
         typeof(Brush),
         typeof(CustomBrush),
         new UIPropertyMetadata(null));

   #endregion         
} 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T18:15:59.623

您不能通过从`System.Windows.Media.Brush`类继承来制作自定义 WPF 画笔，因为该类包含内部的抽象成员。

如果使用 Reflector 查看`System.Windows.Media.Brush`类的源代码，会看到如下内部抽象方法：

```
internal abstract DUCE.ResourceHandle AddRefOnChannelCore(DUCE.Channel channel);
internal abstract DUCE.Channel GetChannelCore(int index);
internal abstract int GetChannelCountCore();
internal abstract DUCE.ResourceHandle GetHandleCore(DUCE.Channel channel);
internal abstract void ReleaseOnChannelCore(DUCE.Channel channel); 
```

这些必须被覆盖，但不能被覆盖，因为它们是内部的。

**注意：**编辑了我的答案，因为之前的答案是关于`System.Drawing.Brush`这个问题并且与这个问题无关。特别感谢 Mikko Rantanen 的评论。

# bash - 将 xargs Bash 命令转换为 PowerShell？

> ID：794516
> 
>         
> 
> 赞同：21
> 
>         
> 
> 时间：2009-04-27T17:40:13.810
> 
>         
> 
> 标签：bash, powershell

我有一个简单的 Bash 命令，可以使用 ImageMagick 在低流量网站上自动调整一些图像的大小——我想将其转换为 PowerShell 命令，这样我就不必在我的网络服务器上安装 Cygwin。任何人都可以在这里借用他们的 PSh 技能吗？

```
ls | xargs -I {} rconvert "{}" -resize 128x128\> "{}" 
```

* * *

## 回答 #1

> 赞同：33
> 
>             
> 
> 时间：2009-04-27T18:04:12.410

最好的办法是像这样将 ls 的输出通过管道传输到 foreach-object 命令行开关（% 是 foreach-object 的别名）：

```
ls | %{rconvert $_ -resize 128x128} 
```

编辑： ls 将 FileInfo 或 DirectoryInfo 对象的列表输出到管道上。要过滤掉 DirectoryInfo 对象，请使用 where-object 过滤器（? 是别名）：

```
ls | ?{-not $_.PSIsContainer} | %{rconvert $_ -resize 128x128} 
```

如果您需要访问命令中的完整路径名，请使用 FileInfo 对象的 FullName 属性（$_ 本身将被解析为 $_.Name ，这只是文件名）：

```
ls | ?{-not $_.PSIsContainer} | %{rconvert $_.FullName -resize 128x128} 
```

# ftp - Dreamweaver 和通过 FTP 的二进制 PUT

> ID：794519
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T17:42:09.673
> 
>         
> 
> 标签：ftp, dreamweaver, zend-guard

众所周知（不是吗？），**Dreamweaver 上的 FTP 功能**对于专业产品来说是不可原谅的，但我可以忍受它，因为 Dreamweaver 有其他有用的东西使 FTP 黯然失色。

但是，我有一个特定的 FTP 情况，这几年来一直困扰着我，希望有人能找到解决方案。

我们对一些 PHP 文件使用**ZEND 加密。**一旦你这样做了，这些文件就不再是文本文件（而是二进制文件）。

我的理解是，Dreamweaver 将所有内容都作为二进制文件进行 FTP（也许我误解了？），但是每次我使用 Dreamweaver 将这些 ZEND 加密的 PHP 文件上传（FTP）到服务器时，它们都不起作用（只是一个白屏——这意味着它们是腐败）。

我必须进入命令行 FTP，FTP 进入服务器，然后手动 PUT 文件（当然是在输入 BIN 之后）。不太难，但增加了我宁愿避免的额外步骤。

是否有任何调整、工具、插件或任何东西可以强制 Dreamweaver 正确上传文件？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:20:44.727

看起来您必须修改您的`FTPExtensionMap.txt`，这就是 Dreamweaver 用来选择 FTP 传输模式的方法。

虽然这会使*所有* 文件都以 BINARY 格式传输，但如果您在 Win/UNIX/Mac 其他非编码文件`.php`之间来回传输，这可能不是您想要的`.php`

[这里是关于如何修改文件的说明](http://help.adobe.com/en_US/Dreamweaver/10.0_Extending/WS5b3ccc516d4fbf351e63e3d117f53d6108-7fcc.html)。

# boost-build - 使用 bjam 构建基本的 Boost 应用程序

> ID：794522
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-04-27T17:42:55.940
> 
>         
> 
> 标签：boost-build, bjam

我可以在 Boost.Build 上找到大量通用文档，但令人惊讶的是，没有关于如何使用它来构建简单的 Boost 应用程序。

我用 bjam 为 mingw 编译了 Boost，得到了所有的库并包含在 C:\Boost 中。现在，使用所有这些的基本 Jamroot 文件会是什么样子？

这些库都有复杂的名称，例如“libboost_filesystem-mgw34-mt-s.lib”，我确信某处有某种神奇的开关可以说“链接到 libboost_filesystem”！

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2010-09-02T19:17:20.370

当然有捷径！示例项目可能如下所示：

```
#jamfile - an example Boost.Build project
exe my_exe : [ glob *.cpp ] /boost//filesystem ; 
```

从项目目录中的所有 .cpp 文件制作可执行文件并使用 Boost.Filesystem。然后你不需要手动构建任何 boost 库，bjam 会根据需要自行处理。这也将确保您的应用程序始终与使用正确选项编译的 boost 库链接。为准备使用 Boost.Build 的环境需要进行一些初始配置工作，例如为方便起见创建一个 user-config.jam、一个 boost-build.jam 和一个 jamroot（具有 eg`use-project /boost : /path/to/boost`语句）。但这是一次性的努力，之后事情比以前容易得多。
[http://www.boost.org/boost-build2/doc/html/index.html](http://www.boost.org/boost-build2/doc/html/index.html)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-05-22T14:41:04.267

没有必要以任何方式使用 bjam 来构建与 boost 一起使用的代码。

因此，使用 gmake，或批处理脚本，或 IDE，或任何你喜欢的东西。bjam 是您发现的更难的选择之一，文档很差。

有一个非常基本的教程：

[http://www.boost.org/doc/libs/1_39_0/more/getting_started/unix-variants.html](http://www.boost.org/doc/libs/1_39_0/more/getting_started/unix-variants.html)

或者

[http://www.boost.org/doc/libs/1_39_0/more/getting_started/windows.html](http://www.boost.org/doc/libs/1_39_0/more/getting_started/windows.html)

# iphone - 如果我向它发送-release，集合是否会向它持有的所有对象发送-release消息？

> ID：794531
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T17:46:27.633
> 
>         
> 
> 标签：iphone, cocoa-touch, memory-management, uikit

我一直在阅读，如果一个集合“被释放”，它也会释放它的所有对象。另一方面，我还读到，一旦集合被释放，集合就会释放它的对象。

但正如苹果所说，最后一件事可能并不总是发生。系统决定是否可以解除分配。在大多数情况下会，但在某些情况下不会。

所以我想知道一个集合是否会导致这样的内存泄漏？并且当它在向集合本身发出 -release 消息时释放所有对象时，它实际上应该在我保留集合本身时立即保留集合中的所有对象。

帮助我清楚地了解这一点。谢谢！

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-04-27T17:56:02.417

当您将对象添加到集合时，它会被集合保留，直到它被删除或集合被释放。发送到集合的后续保留或释放消息不会更改集合内对象的保留计数。

换句话说，从所有权的角度考虑它，而不是计算保留。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T17:58:36.810

向对象发送版本会降低其保留计数。当它的保留计数达到零时，它就会被销毁。当容器被销毁（未释放）时，它的对象被释放（但如果它们的保留计数由于其他原因不为零，则不会被销毁）。

简短的回答：这一切都会按照您的预期进行，您的问题是您将“释放”视为“被摧毁”的意思。他们是不同的。

# performance - 操作和存储大量有序列表或哈希的最佳方法是什么？

> ID：794543
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T17:50:43.503
> 
>         
> 
> 标签：performance, perl

我有一个简单的有序列表，可以包含 100 万个或更多项目。此列表仅完成了一些操作：

*   存在值中的查找

*   查找值的索引

*   查找索引的值

*   添加一个值

*   获取列表中的项目数

一旦一个值被添加到列表中，它就永远不会改变。我将项目附加到列表中，没有插入或删除。

我需要操纵这个大列表，并持久地存储它。现在我正在使用数据库 Int => String 来表示列表，但我认为应该有一种更有效的方法来做到这一点。

我可以使用 memcached，但我认为缺少 2 个函数：

*   持久存储

*   查找值的索引

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-04-27T18:08:48.517

看来您还需要一个`String -> Int`映射表。

在 Perl 中，最简单的方法是对`tie`DBM 文件进行哈希处理（请参阅 参考资料`man perltie`）。

未经测试的示例代码几乎肯定可以改进：

```
use DB_File;
tie %value2index, 'DB_File', 'value2index';
tie %index2value, 'DB_File', 'index2value';

sub index_count() {
    return scalar %value2index;
}

sub value_exists() {
    my $value = shift;
    return exists($value2index{$value});
}

sub append() {
    my $value = shift;
    if (!value_exits($value)) { # prevent duplicate insertions
        my $index = index_count() + 1;
        $value2index{$value} = $index;
        $index2value{$index} = $value;
    }
}

sub find_index() {
    my $value = shift;
    return $value2index{$value};
}

sub find_value() {
    my $index = shift;
    return $index2value{$index};
} 
```

不要在多线程环境中使用这个，这里有非原子操作。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:26:40.607

你的物品有多大？你介意使用多少内存？你的物品是独一无二的吗？

你可能会逃脱这样的事情：

```
my @list; # This keeps the ordered list
my %keyval; # This maps key to value
my %valkey; # This maps value to key 
```

在每个插入上，您将：

```
push @list, value;
$valkey{$value} = $#list;
$keyval{$#list} = $value; 
```

对于您的每一个要求：

```
#Existence of a value:
if(exists($valkey{$value}));

#Existence of an index;
if(exists($keyval{$index}));

#value for an index:
$keyval{$index};

#value for a key:
$valkey{$value};

#Size
$#list; 
```

# sql-server - MSSQL 中的并发检查（TSEQUAL 的替代方案）

> ID：794545
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-04-27T17:52:36.183
> 
>         
> 
> 标签：sql-server, concurrency

我正在 SQL 2008 下进行开发，但是我有一个 SQL 2000 数据库（在兼容模式下）。

有几个查询使用“TSEQUAL”函数进行并发检查。然而，似乎该函数已在 SQL 2008 中完全删除，并且这些语句（位于 SPROCS 中）不再编译。

**在 SQL 2005 及更高版本中进行并发检查的最佳方法是什么？**

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T17:56:11.823

请参阅[http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=126933](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=126933)。

# sql - 外键列的 SQL Pivot

> ID：794550
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T17:55:13.820
> 
>         
> 
> 标签：sql, sql-server, foreign-keys, pivot

我有一张这样的表：财政年度，地区，国家，Office1，Office2，Office3，Office4

其中办公室 1-4 是外键。

我想得到这样的输出： Office 1：财政年度，地区，国家办事处 2：财政年度，地区，国家办事处 3：财政年度，地区，国家办事处 4：财政年度，地区，国家

这可以使用枢轴完成吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:01:33.900

我认为这更像是 UNPIVOT：

```
SELECT [Fiscal Year], Region, County, OFfice
FROM 
   (SELECT [Fiscal Year], Region, County, OFfice1, Office2, Office3, Office4
   FROM unpvt) p
UNPIVOT
   (yourtable FOR Office IN 
      (Office1, Office2, Office3, Office4)
) AS unpvt; 
```

但是你也可以通过一个简单的查询来做到这一点：

```
select [Fiscal Year], Region, County, OFfice1 
from yourtable
union
select [Fiscal Year], Region, County, OFfice2 
from yourtable
union
select [Fiscal Year], Region, County, OFfice3
from yourtable
union
select [Fiscal Year], Region, County, OFfice4
from yourtable 
```

# c - 同时定义数组和符号索引

> ID：794556
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T17:57:26.763
> 
>         
> 
> 标签：c, syntax

我试图想出一种聪明的方法（在 C 中）来创建一个字符串数组，以及数组索引的符号名称（枚举或#define），在一个易于维护的构造中。就像是：

const char *strings[] = { M(STR_YES, "yes"), M(STR_NO, "no"), M(STR_MAYBE, "maybe") };

结果将相当于：

const char *strings[] = {“是”、“否”、“也许”}；枚举索引 {STR_YES, STR_NO, STR_MAYBE}; （或#define STR_YES 0 等）

但在这种情况下，我正在为如何构造 M 宏画一个空白。

有什么聪明的主意吗？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-04-27T18:10:15.033

clang 编译器源代码中使用的一种技术是创建`.def`包含这样一个列表的文件，该列表的设计类似于 C 文件，并且可以轻松维护而无需触及使用它的其他代码文件。例如：

```
#ifndef KEYWORD
#define KEYWORD(X)
#endif
#ifndef LAST_KEYWORD
#define LAST_KEYWORD(X) KEYWORD(X)
#endif

KEYWORD(return)
KEYWORD(switch)
KEYWORD(while)
....
LAST_KEYWORD(if)

#undef KEYWORD
#undef LAST_KEYWORD 
```

现在，它所做的就是包含这样的文件：

```
/* some code */
#define KEYWORD(X) #X, 
#define LAST_KEYWORD(X) #X

const char *strings[] = { 
#include "keywords.def"
};

#define KEYWORD(X) kw_##X, 
#define LAST_KEYWORD(X) kw_##X

enum { 
#include "keywords.def"
}; 
```

在你的情况下，你可以做类似的事情。如果您可以使用`STR_yes`, `STR_no`, ... 作为枚举数名称，则可以使用与上述相同的方法。否则，只需通过宏两件事。一个小写名称和一个大写名称。然后你可以像上面那样将你想要的字符串化。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:07:04.543

这是使用代码生成的好地方。使用 perl、php 或其他任何语言来生成您的 .h 文件。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T23:45:15.227

不需要将其放入特定的 .def 文件中；仅使用预处理器是完全可能的。我通常定义一个列表，命名为`...LIST`每个元素都包含在`...LIST_ELEMENT`. 根据我将使用列表的内容，我将只用逗号分隔除最后一个条目（最简单）之外的所有条目，或者在一般情况下，可以在每次使用时单独选择分隔符。例子：

```
#include <string.h>

#define DIRECTION_LIST \
DIRECTION_LIST_ELEMENT( up,    DIRECTION_LIST_SEPARATOR ) \
DIRECTION_LIST_ELEMENT( down,  DIRECTION_LIST_SEPARATOR ) \
DIRECTION_LIST_ELEMENT( right, DIRECTION_LIST_SEPARATOR ) \
DIRECTION_LIST_ELEMENT( left,  NO_COMMA )

#define COMMA ,
#define NO_COMMA /**/

#define DIRECTION_LIST_ELEMENT(elem, sep) elem sep
#define DIRECTION_LIST_SEPARATOR COMMA
typedef enum {
    DIRECTION_LIST
} direction_t;
#undef DIRECTION_LIST_ELEMENT
#undef DIRECTION_LIST_SEPARATOR

#define DIRECTION_LIST_ELEMENT(elem, sep) void (*move_ ## elem)(struct object_s * object);
#define DIRECTION_LIST_SEPARATOR NO_COMMA
typedef struct object_s {
    char *name;
    // ...
    DIRECTION_LIST
} object_t;
#undef DIRECTION_LIST_ELEMENT
#undef DIRECTION_LIST_SEPARATOR

static void move(object_t *object_p, const char * direction_string)
{
    if (0) {
    }
#define DIRECTION_LIST_SEPARATOR NO_COMMA
#define DIRECTION_LIST_ELEMENT(elem, sep) \
    else if (strcmp(direction_string, #elem) == 0) { \
        object_p->move_ ## elem(object_p); \
    }
    DIRECTION_LIST
#undef DIRECTION_LIST_ELEMENT
#undef DIRECTION_LIST_SEPARATOR
} 
```

# c# - 实体框架：重新生成已更改的表（关键更改）

> ID：794557
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-04-27T17:57:27.980
> 
>         
> 
> 标签：c#, entity-framework, .net-3.5

我有一个相当大的数据库连接到我的实体框架。我有一组特定的表，其中从设计中删除了一个公用键 (fk)。当我“从数据库更新模型”时，我得到了一系列关于这个现在丢失的键的错误。

为什么更新过程不能准确检测到此密钥已被删除？此外，如果我手动从模型中删除该属性，我只会遇到其他错误。我还尝试简单地删除表并重新添加它，但现在该表没有显示在更新向导的“添加”部分中。

那么，除了删除整个事情并重新开始之外，有没有办法优雅地恢复？EF 团队是否发布了该向导的任何更新版本，其中已经修复了其中一些问题？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:10:40.727

实体框架确实会不时感到困惑。您需要做的是从模型中删除实体表，然后将 SQL Server 中的表重命名为 TableName_Temp，刷新模型，现在实体表应该没问题，所以再次删除实体表将其重命名为原始名称并再次刷新模型。这次应该一切都好。

我知道这是一个混乱的过程，但这是我发现解决此问题的唯一方法，而不会破坏整个 edmx 并从头开始。目前在我的组织中，我们有一项政策，除非绝对必要，否则我们不会对 EDMX 进行更改，以便我们可以在需要时删除和重新创建而不会出现任何问题。

希望这可以帮助！

# iphone - iPhone 上的图形生成

> ID：794562
> 
>         
> 
> 赞同：24
> 
>         
> 
> 时间：2009-04-27T17:58:18.400
> 
>         
> 
> 标签：iphone, cocoa-touch

有人有在 iPhone 上绘制图表的经验吗？看起来 GraphKit 不是一个选项，所以由程序员自己编写库（我猜是使用 OpenGL）或现有库。我似乎找不到任何已确认可在 iPhone 上运行的库。

如果你自己写了，你是怎么做的（opengl、quartz等），或者如果你使用了哪个库？

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2009-04-27T19:51:35.587

我一直在关注这个：

[核心情节](http://code.google.com/p/core-plot/)

但我还没有尝试过。虽然它看起来很有潜力。

克里斯。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2010-09-04T15:25:44.393

我用过 coreplot……有一个应用商店应用程序……对它的使用并不兴奋。它非常可定制，也许太可定制了。它给我设置了很多麻烦，我仍然有问题。我想知道 Roambi.com 是如何从 excel 进行移植的，看起来还不错。MSOffice4mac 应该只是带有一个直接连接到 iphone 的端口

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2011-03-22T10:34:59.890

在前往应用商店应用的路上尝试并使用过 CorePlot。设置它然后深入挖掘，当然是目前最好的图形选项，这很痛苦。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-28T13:37:13.777

在使用 Quartz2D 之前，我已经在应用程序中完成了图表。由于图表特别宽，我不得不为视图使用 CATiledLayer，我认为这是导致问题多于修复的原因。图表看起来不错，但最终，它太难处理了。尝试一次绘制太多图形，或尝试在用户在不同视图之间切换时快速连续多次绘制图形时出现太多错误。

在这一点上，我的建议是在 OpenGL 中尝试一些东西，虽然我不知道你将如何实现它，因为在 iPhone 上的 OpenGL 中绘制线条非常基本。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-07-21T08:56:25.657

我尝试使用 Quartz 2D 绘制图表。它看起来更像是一幅画。但我正在固定轴并根据轴绘制坐标。但问题是我想让图形用户交互。图表上的每个坐标都必须进一步深入显示坐标的详细信息。那么如何使坐标交互。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2011-05-03T08:03:47.423

您可以查看[PowerPlot 库](http://powerplot.nua-schroers.de)，它是一个 iOS 原生库。这是唯一的选择（据我所知），不仅具有“通常”的图表分类，而且视图之间的图形（带有节点和连接）。它不是基于OpenGL，而是基于Quartz。它也不针对 MacOS 的桌面版本，专门针对 iOS。

许可政策是双重许可——开发者可以选择 GPLv3 或商业许可。

# excel - Excel 数据透视表问题 - 如何获取行区域字段的小计？

> ID：794574
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:04:01.977
> 
>         
> 
> 标签：excel, pivot, pivot-table

我在数据库中有以下情况：

**部门**表包含公司的所有部门。

**Employee**表包含所有员工，以及他们的部门 id 和 AllowedAbsenceDays 字段，它告诉我们该员工今年允许缺勤多少天。

**缺勤**表包含公司中发生的所有缺勤。它有员工 ID 和缺勤日期，以及缺勤原因（假期、病假、个人日，以及未来可能更多......）

[![替代文字](https://i.stack.imgur.com/i30g1.jpg)](https://i.stack.imgur.com/i30g1.jpg)

我应该创建一个报告，列出所有员工并显示他们允许缺勤的天数以及他们缺勤的天数（以及缺勤的原因）。

我按员工和缺勤原因对数据进行了分组：

[![替代文字](https://i.stack.imgur.com/7Sej6.jpg)](https://i.stack.imgur.com/7Sej6.jpg)

到目前为止，通过将部门、员工和允许的缺勤天数放在枢轴行区域，将原因放在列区域，将缺勤天数总和放在数据区域，这是我目前所能得到的：

[![替代文字](https://i.stack.imgur.com/n7WhD.jpg)](https://i.stack.imgur.com/n7WhD.jpg)

问题是我无法获得每个部门允许的缺勤天数的小计（这是一项严格的要求）。最终报告应该看起来像这样（我已经对此进行了Photoshop处理）。

[![替代文字](https://i.stack.imgur.com/3UK8j.jpg)](https://i.stack.imgur.com/3UK8j.jpg)

有没有办法得到这些小计？也许我应该以不同的方式为数据透视表准备数据？请注意，总计栏应仅包括实际缺勤天数（而不是允许缺勤天数）。

示例工作簿可在[此处下载](http://dc93.4shared.com/download/102041351/110b1e55/AbsenceReport.xlsx?tsid=20090427-131518-fc8c06d2)

感谢所有仍在阅读的人:)

PS 实际情况不同（在问题域中）。这是一个有些人为的例子，但基本问题是相同的。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-29T02:09:28.743

这是一个经典的数据规范化问题。“允许的缺勤天数”字段与员工有关，与任何特定缺勤无关。在每一行（记录）中重复此信息是导致问题的原因。

要在 Excel 工作表和数据透视表中实现此目的，您可以删除“允许缺勤天数”列，而使用“允许缺勤天数”作为“原因”列中的值之一。将允许的天数显示为负数或将其他缺勤原因的天数显示为负数可能是有益的。否则，总的总数将毫无意义。

工作表和数据透视表应大致如下所示：

[显示重组数据的 Excel 电子表格：A 列是部门，B 是员工，C 是缺勤天数，D 是原因。允许缺勤天数现在是一个原因，相关天数缺勤是负数 http://img527.imageshack.us/img527/1979/so1.png](http://img527.imageshack.us/img527/1979/so1.png)

[![Excel 数据透视表显示 C 到 E 列中缺勤天数的总和。C 列允许缺勤天数](https://i.stack.imgur.com/u4U5o.png)](https://i.stack.imgur.com/u4U5o.png)

为每个员工重复部门似乎并不理想，但我想员工可以在一年中更换部门，所以你可能/可能不必以某种方式考虑这一点。您还需要它来使数据透视表正常工作

如果您绝对 100% 不能以这种方式影响总计，那么我不相信您可以通过数据透视表来实现这一点。您可能希望查看使用 ADO 查询工作表并使用一些 VBA 宏来格式化和输出结果。[此页面](http://www.microsoft.com/technet/scriptcenter/resources/officetips/jun05/tips0607.mspx)应该让您了解所涉及的内容

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-01-28T14:52:59.147

只需在所有行中将“允许的缺勤天数”留空，然后在底部/顶部输入“允许的缺勤天数”所需的数字和其他内容的空白。

然后只需将您的“允许缺勤天数”放在数据中而不是数据透视表中的列中，然后将其拖到左侧。

# javascript - 设计 Javascript 验证方法

> ID：794575
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T18:04:09.370
> 
>         
> 
> 标签：javascript, validation

在 JavaScript 中进行验证时，如何让需要处理一堆意外事件的验证方法变得不守规矩？

例如，我有一个带有验证的字段的表单：

*   新值是数字吗？

*   当当前字段 > 0 时，表单上另一个字段中的值是否 > 0

*   是表单上的另一个字段 == 1 并且当前字段 == 0

*   表单上的另一个字段 == true 并且当前字段是 Mod 另一个字段 == 0

等等。

目前，我有一个带有一堆 if/else 语句的方法。

我可以将每次检出分解成它自己的方法并从主验证方法中调用它，但这会创建大量新方法。

**更新**：无论我是使用框架还是单独的方法，我是否仍然愿意让调用验证方法填充 If/Else 或 Switch 语句以及失败验证的警报框？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T18:30:38.917

为什么要重新发明轮子？我建议使用[jQuery Validation Plugin](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)。也可以查看[演示页面](http://jquery.bassistance.de/validate/demo/)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:30:52.127

听起来你可能想要一个基本的状态机。您可能会考虑的一件事是将验证器分解为最简单的形式：

```
function validator(op, options, pass, fail) {
    if (op(options)) {
        pass(options);
    } else {
        fail(options);
    }
} 
```

然后您可以将它们链接在一起以形成更复杂的系统。

```
function isFooChecked(options) {
    return $(options.foo).is(':checked');
}

function sayHi(options) {
    alert('hi ' + options.name);
}

function fail(options) {
    alert(options.name + ' was bad');
}

function validateName() {
    validator(isFooChecked, { foo: '#someField', name: $('#nameField').val() }, sayHi, fail);
} 
```

你仍然会有很多代码，但如果你做对了，函数应该很小并且易于理解。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:29:36.703

我建议将每个单独的签出拆分为自己的方法，并将要验证的控件作为参数传入。这样你就可以很容易地重用常用的（“新值是数字吗？”）。

我不知道在 JavaScript 中使用大量方法（命名空间拥挤除外）有什么缺点，但我可能会遗漏一些东西。

当然，您可能还想研究使用某种[框架](http://www.benjaminkeen.com/software/rsv/)。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2010-01-18T22:26:41.823

我有一个看起来像的 Json 对象

```
{'field1': {'rule_name1':{'rule': rule1, 'message': message1},
    {'rule_name2':{'rule': rule2, 'message': message2}},
    field2: {'rule_name3':{'rule': rule3, 'message': message3},
    {'rule_name4':{'rule': rule1, 'message': message1}},
    {'rule_name5':{'rule': rule4, 'message': message4}}} 
```

或者，如果您发现它更具可读性

```
field1
    rule_name1
        rule: rule1
        message: message1
    rule_name2
        rule: rule2
        message: message2
field2
    rule_name3
        rule: rule3
        message: message3
    rule_name4
        rule: rule1
        message: message1
    rule_name5
        rule: rule4
        message: message4 
```

基本上，您有一个字段列表。在每个字段下，您会找到一个规则列表，其名称无关紧要，并且对于每个 rule_name，您都有一个规则和一条消息。

每次我需要检查一个字段时，我都会找到相应的子对象。然后我遍历 rule_names，对于 rule_name，我得到一条规则和一条消息。该规则对应于检查字段的方法（例如“notEmpty()”）。所以我调用了这个方法：如果它返回 true，我将迭代带到下一个 rule_name。否则我会返回消息。

然后我可以在视图方法中使用我想要的消息。

# sql - 只需简单的 SQL INSERT 就可以实现手动增量吗？

> ID：794577
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-04-27T18:04:20.447
> 
>         
> 
> 标签：sql, sql-server, sql-server-2005, language-agnostic, insert

我有一个我不想自动递增的主键（出于各种原因），所以我正在寻找一种方法来在我插入时简单地递增该字段。简单地说，我的意思是没有存储过程和触发器，所以只有一系列 SQL 命令（最好是一个命令）。

这是我迄今为止尝试过的：

```
BEGIN TRAN

INSERT INTO Table1(id, data_field)
VALUES ( (SELECT (MAX(id) + 1) FROM Table1), '[blob of data]');

COMMIT TRAN;

* Data abstracted to use generic names and identifiers 
```

但是，执行时，命令错误，说

> “在这种情况下不允许子查询。只允许标量表达式”

那么，我该怎么做/我做错了什么？

* * *

编辑：由于它被指出为一个考虑因素，因此要插入的表保证已经至少有 1 行。

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-04-27T18:16:56.593

你明白你会发生碰撞吗？

你需要做这样的事情，这可能会导致死锁，所以要非常确定你要在这里完成什么

```
DECLARE @id int
BEGIN TRAN

    SELECT @id = MAX(id) + 1 FROM Table1 WITH (UPDLOCK, HOLDLOCK)
    INSERT INTO Table1(id, data_field)
    VALUES (@id ,'[blob of data]')
COMMIT TRAN 
```

为了解释碰撞的事情，我提供了一些代码

首先创建这个表并插入一行

```
CREATE TABLE Table1(id int primary key not null, data_field char(100))
GO
Insert Table1 values(1,'[blob of data]')
Go 
```

现在打开两个查询窗口并同​​时运行它

```
declare @i int
set @i =1
while @i < 10000
begin
BEGIN TRAN

INSERT INTO Table1(id, data_field)
SELECT MAX(id) + 1, '[blob of data]' FROM Table1

COMMIT TRAN;
set @i =@i + 1
end 
```

你会看到一堆这样的

服务器：消息 2627，级别 14，状态 1，第 7 行违反主键约束“PK__Table1__3213E83F2962141D”。无法在对象“dbo.Table1”中插入重复键。该语句已终止。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:08:32.103

试试这个：

```
INSERT INTO Table1 (id, data_field)
SELECT id, '[blob of data]' FROM (SELECT MAX(id) + 1 as id FROM Table1) tbl 
```

不过，出于任何原因（性能、交易安全等），我不建议这样做

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:13:06.540

可能是因为没有记录，所以子查询返回 NULL ...尝试

```
INSERT INTO tblTest(RecordID, Text) 
VALUES ((SELECT ISNULL(MAX(RecordID), 0) + 1 FROM tblTest), 'asdf') 
```

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2012-03-13T15:24:19.517

我不知道是否有人仍在寻找答案，但这里有一个似乎可行的解决方案：

```
-- Preparation: execute only once
    CREATE TABLE Test (Value int)

CREATE TABLE Lock (LockID uniqueidentifier)
INSERT INTO Lock SELECT NEWID()

-- Real insert

    BEGIN TRAN LockTran

    -- Lock an object to block simultaneous calls.
    UPDATE  Lock WITH(TABLOCK)
    SET     LockID = LockID

    INSERT INTO Test
    SELECT ISNULL(MAX(T.Value), 0) + 1
    FROM Test T

    COMMIT TRAN LockTran 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2012-04-03T19:48:36.417

我们有类似的情况，我们需要增加并且不能在数字上有差距。（如果您使用标识值并且回滚事务，则不会插入该数字，并且您将有间隙，因为标识值不会回滚。）

我们为最后使用的数字创建了一个单独的表，并将其设置为 0。

我们的插入需要几个步骤。

--增加数字更新dbo.NumberTable设置数字=数字+1

--找出增加的数字是什么 select @number = number from dbo.NumberTable

-- 使用@number 将数字插入 dbo.MyTable

提交或回滚

这会导致并发事务在一行中处理，因为每个并发事务将等待，因为 NumberTable 已锁定。一旦等待事务获得锁，它就会增加当前值并将其与其他事务锁定。该当前值是最后使用的数字，如果事务回滚，则 NumberTable 更新也会回滚，因此没有间隙。

希望有帮助。

另一种导致单个文件执行的方法是使用 SQL 应用程序锁。我们已经将这种方法用于运行时间较长的进程，例如在系统之间同步数据，因此一次只能运行一个同步进程。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:08:49.047

如果您在触发器中执行此操作，则可以确保它是“INSTEAD OF”触发器并在几个语句中执行：

```
DECLARE @next INT
SET @next = (SELECT (MAX(id) + 1) FROM Table1)

INSERT INTO Table1
VALUES (@next, inserted.datablob) 
```

唯一需要注意的是并发性——如果同时插入两行，它们可能会尝试对@next 使用相同的值，从而导致冲突。

这能实现你想要的吗？

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:45:39.753

在没有 IDENTITY（自动增量）列的情况下做这种事情似乎很奇怪，这让我质疑架构本身。我的意思是，说真的，这是 IDENTITY 列的完美情况。如果您能解释此决定背后的原因，它可能会帮助我们回答您的问题。=)

话虽如此，一些选择是：

*   为此目的使用 INSTEAD OF 触发器。因此，您将执行 INSERT（INSERT 语句不需要传入 ID）。触发代码将处理插入适当的 ID。您需要使用另一个应答器使用的 WITH (UPDLOCK, HOLDLOCK) 语法在触发器期间保持锁定（隐式包装在事务中）并将锁定类型从“共享”提升到“更新” " 锁 (IIRC)。

*   您可以使用上面的想法，但是有一个表，其目的是存储插入到表中的最后一个最大值。因此，一旦设置了表，您将不再需要每次都执行 SELECT MAX(ID)。您只需增加表中的值。如果您使用适当的锁定（如所讨论的），这是安全的。同样，这避免了每次插入时重复的表扫描。

*   使用 GUID 而不是 ID。跨数据库合并表要容易得多，因为 GUID 将始终是唯一的（而跨数据库的记录将具有冲突的整数 ID）。为避免页面拆分，可以使用顺序 GUID。这仅在您可能需要进行数据库合并时才有用。

*   使用存储过程代替触发器方法（因为出于某种原因要避免触发器）。您仍然会遇到锁定问题（以及可能出现的性能问题）。但是存储过程优于动态 SQL（在应用程序的上下文中），并且通常性能更高。

抱歉跑题了。希望有帮助。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2018-10-02T16:02:12.053

如何创建一个单独的表来维护计数器？它比 具有更好的性能`MAX(id)`，因为它将是 O(1)。  `MAX(id)`最多为 O(lgn)，具体取决于实现。

然后当您需要插入时，只需锁定计数器表以读取计数器并增加计数器。然后您可以释放锁定并使用递增的计数器值插入您的表。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2021-01-06T16:22:55.073

有一个单独的表格，您可以在其中保存您的最新 ID，并为每笔交易获取一个新 ID。它可能会慢一些，但它应该可以工作。

```
DECLARE @NEWID INT
BEGIN TRAN
UPDATE TABLE SET ID=ID+1
SELECT @NEWID=ID FROM TABLE
COMMIT TRAN

PRINT @NEWID -- Do what you want with your new ID 
```

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2021-01-06T17:08:10.827

没有任何事务范围的代码（我在工程师课程中将其用作练习）：

```
-- Preparation: execute only once
CREATE TABLE increment (val int);
INSERT INTO increment VALUES (1);

-- Real insert
DECLARE @newIncrement INT;

UPDATE increment
SET    @newIncrement = val,
       val = val + 1;

INSERT INTO Table1 (id, data_field)
SELECT @newIncrement, 'some data'; 
```

* * *

## 回答 #11

> 赞同：-1
> 
>             
> 
> 时间：2009-04-27T18:10:28.560

```
declare @nextId int
set @nextId = (select MAX(id)+1 from Table1)

insert into Table1(id, data_field) values (@nextId, '[blob of data]')

commit; 
```

但也许更好的方法是使用标量函数 getNextId('table1')

* * *

## 回答 #12

> 赞同：-1
> 
>             
> 
> 时间：2015-10-03T12:24:03.590

对此有何批评？为我工作。

```
DECLARE @m_NewRequestID INT
        , @m_IsError BIT = 1
        , @m_CatchEndless INT = 0

WHILE @m_IsError = 1
    BEGIN TRY
        SELECT  @m_NewRequestID = (SELECT ISNULL(MAX(RequestID), 0) + 1 FROM Requests)

        INSERT INTO Requests (  RequestID
                                , RequestName
                                , Customer
                                , Comment
                                , CreatedFromApplication)
            SELECT  RequestID = @m_NewRequestID
                    , RequestName = dbo.ufGetNextAvailableRequestName(PatternName)
                    , Customer = @Customer
                    , Comment = [Description]
                    , CreatedFromApplication = @CreatedFromApplication
                FROM    RequestPatterns
                WHERE   PatternID = @PatternID

        SET @m_IsError = 0
    END TRY
    BEGIN CATCH
        SET @m_IsError = 1
        SET @m_CatchEndless = @m_CatchEndless + 1
        IF @m_CatchEndless > 1000
            THROW 51000, '[upCreateRequestFromPattern]: Unable to get new RequestID', 1
    END CATCH 
```

* * *

## 回答 #13

> 赞同：-2
> 
>             
> 
> 时间：2009-04-27T18:09:06.207

这应该有效：

```
INSERT INTO Table1 (id, data_field)
SELECT (SELECT (MAX(id) + 1) FROM Table1), '[blob of data]'; 
```

或者这个（用 LIMIT 代替其他平台）：

```
INSERT INTO Table1 (id, data_field)
SELECT TOP 1
    MAX(id) + 1, '[blob of data]'
FROM
   Table1
ORDER BY
   [id] DESC; 
```

# javascript - 使用javascript取消选择文本框的内容

> ID：794583
> 
>         
> 
> 赞同：13
> 
>         
> 
> 时间：2009-04-27T18:05:45.497
> 
>         
> 
> 标签：javascript, jquery, dom, focus

我知道使用 javascript，您可以使用以下代码（在 jQuery 中）选择文本框的内容：

```
$("#txt1").select(); 
```

有没有办法做相反的事情？取消选择文本框的内容？我将一系列文本框的焦点事件设置为选择其中的内容。现在有时我想关注一个特定的文本框而不选择它。我打算做的是为这个特定的文本框调用焦点事件，然后调用它来取消选择它。

```
$("input[type=text]").focus(function() {
    $(this).select();
});

//code....

$("#txt1").focus();

//some code here to deselect the contents of this textbox 
```

有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2010-06-08T14:34:00.957

那这个呢：

```
$("input").focus(function(){
  this.selectionStart = this.selectionEnd = -1;
}); 
```

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2009-04-27T18:14:05.197

如果您只是将文本框的值分配给自身，它应该取消选择文本。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2011-02-08T13:25:03.920

您需要设置`selectionStart`and`selectionEnd`属性。但是由于某种原因，将这些设置在焦点事件上不起作用（我不知道为什么）。要使其工作，请在一小段时间后设置属性。

```
 $(document).ready(function(){
    $('#txt1').focus(function(){
      setTimeout(function(){
        // set selection start, end to 0
        $('#txt1').attr('selectionStart',0);
        $('#txt1').attr('selectionEnd',0);
      },50);  // call the function after 50ms
    });
  }); 
```

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2012-04-16T15:14:53.903

要“聚焦特定的文本框而不选择它”：我会使用[修补的 jquery 插件 jquery-fieldselection 的一部分](https://github.com/localhost/jquery-fieldselection/blob/bc33fa60a4c8f5d7553fe6cd10ee0f71825ce83f/jquery-fieldselection.js "修补")

使用它你可以打电话

```
$('#my_text_input').setSelection({"start":0, "end":0}); // leaves the cursor at the left 
```

或者使用这个将光标放在文本末尾的简化版本（默认情况下）

```
(function() {
var fieldSelection = {
    setSelection: function() {
        var e = (this.jquery) ? this[0] : this, len = this.val().length || ;
        var args = arguments[0] || {"start":len, "end":len};
        /* mozilla / dom 3.0 */
        if ('selectionStart' in e) {
            if (args.start != undefined) {
                e.selectionStart = args.start;
            }
            if (args.end != undefined) {
                e.selectionEnd = args.end;
            }
            e.focus();
        }
        /* exploder */
        else if (document.selection) {
            e.focus();
            var range = document.selection.createRange();
            if (args.start != undefined) {
                range.moveStart('character', args.start);
                range.collapse();
            }
            if (args.end != undefined) {
                range.moveEnd('character', args.end);
            }
            range.select();
        }
        return this;
    }
};
jQuery.each(fieldSelection, function(i) { jQuery.fn[i] = this; });
})(); 
```

这样使用：

```
$('#my_text_input').setSelection(); // leaves the cursor at the right 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:19:08.617

与其选择然后取消选择，不如在 dom 元素上临时存储一个布尔值？

```
 $("input[type=text]").focus(function() {
     if($(this).skipFocus) return;
     $(this).select();
 });

 //code....

 $("#txt1").skipFocus = true;
 $("#txt1").focus(); 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2012-06-15T23:01:36.307

我想提出一个简单的解决方案

```
$("input[type=text]").focus(function() {
    $(this).select();
});

$("input[type=text]").blur(function() {
    $('input[type="hidden"][value=""]').select();
});

//code....

$("#txt1").focus(); 
```

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2015-03-04T23:43:34.960

这是一个没有jquery的简单解决方案

```
<input type="text" onblur="this.selectionStart = this.selectionEnd = -1;"> 
```

* * *

## 回答 #8

> 赞同：-1
> 
>             
> 
> 时间：2010-06-08T14:31:00.853

如果要使用 jQuery 取消选择文本框，请执行以下操作：

```
 $(your_input_selector).attr('disabled', 'disabled');
   $(your_input_selector).removeAttr('disabled'); 
```

# javascript - 无法在 Firefox 中使用 jQuery 脚本

> ID：794584
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:05:53.763
> 
>         
> 
> 标签：javascript, jquery, firefox, safari

我的主页中有以下[脚本](http://jqueryfordesigners.com/slide-out-and-drawer-effect/)

```
$(function () { // same as $(document).ready(function () { })
  // assuming we have the open class set on the H2 when the HTML is delivered
  $('li.drawer h2:not(.open)').next().hide();

  $('h2.drawer-handle').click(function () {
    // find the open drawer, remove the class, move to the UL following it and hide it
    $('h2.open').removeClass('open').next().hide();

    // add the open class to this H2, move to the next element (the UL) and show it
    $(this).addClass('open').next().show();
  });
}); 
```

它适用于 Safari，但不适用于 Firefox 3.08/3.1 beta3。

**你怎样才能让上面的 jQuery 脚本在 Firefox 中工作？**

[编辑]

**我的 index.html 的第一行**

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"/>
<link href="template.css" type="text/css" rel="stylesheet"/>
<title>Abc</title>

<script type="text/javascript" src="jquery.js" />  

<script type="text/javascript"> 

! - - - - Above Code is at Here - - - - - 

</script>

</head> 
```

**index.html 的主体**

```
<body>
<div class="mainbody">

<h1 class="myheader">Test</h1>
<p>Test</p>

<ul class="drawers">

   <li class="drawer">
      <h2 class="drawer-handle open">Contact info</h2>
      <ul>

         <li>name
         </li>

         <li>
            <div class="">aaa
            </div>
         </li>
      </ul>
   </li>

   <li class="drawer">
      <h2 class="drawer-handle">Unpublished</h2>
      <ul>
         <li class="italic">
            <i>A</i> (2009).
         </li>
         <li class="italic">
            <i>aaa</i> (2008).
         </li>
      </ul>
   </li>     

   <li class="drawer">
      <h2 class="drawer-handle">Recent projects</h2>
      <ul>
         <li class="italic">
            Websites
         </li>

         <li class="italic">
            Search
            <form action="http://www.google.com/cse" id="cse-search-box">
            <div>
               <input type="hidden" name="cx" value="8834479:1qd7hky6khe" />
               <input type="hidden" name="ie" value="UTF-8" />
               <input type="text" name="q" size="31" />
               <input type="submit" name="sa" value="Search" />
            </div>
            </form>
            <script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&lang=en"></script>
         </li>

      </ul>
   </li>     

</ul>

</div>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:19:26.057

它适用于 Firefox 3.0.9

究竟是什么不工作？

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:37:51.643

我的猜测是您的 HTML 无效，这会导致 Firefox 中出现错误的 DOM 结构。但是如果不看你的代码就很难判断。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:52:19.863

为什么你的 jquery 选择器中的标签是大写的？根据您的文档类型，您使用的是 XHTML，并且所有标签都必须是小写的。不确定这是否会有所作为，但您应该更改 H2 => h2 等。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T23:31:43.793

通过替换以下代码，我得到了在 Firefox 中工作的代码

```
<script type="text/javascript" src="jquery.js" /> 
```

到

```
<script type="text/javascript" src="jquery.js"></script> 
```

# nhibernate - ORM 是否与现有应用程序集成或我不理解？

> ID：794587
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T18:06:20.270
> 
>         
> 
> 标签：nhibernate, hibernate, orm, integration

假设 ORM 处于休眠状态。

我不知道怎么问这个。我想构建一个可以替换另一个应用程序的一部分。例如，假设我有一个包含各种模块的应用程序，称为“大”应用程序。这个应用程序可以处理人力资源、财务、采购、技能组合等。但也许，出于某种原因，我不喜欢技能组合模块，但我喜欢应用程序的其余部分。我想构建一个应用程序，它使用与“大”应用程序的其余部分相同的数据库，但使用我的软件作为该部分的前端。

我可以构建我的应用程序并让它直接访问数据库而无需 ORM。我的问题是在这里使用 ORM 是否有优势。我认为这是因为如果“大”应用程序消失并且购买了另一个应用程序，我们可以继续使用我的技能集版本，因为我使用的是休眠而不是直接打东西。我仍在学习，但我认为我的应用程序使用了我命名的对象，并且在我刚才描述的情况下，我只需要更改我的映射文件或/和我的代码很少。

这是另一个例子。我有一个遗留应用程序和遗留数据库。它使用数据库 X。我决定不再喜欢用于获取数据的旧终端仿真器应用程序，并且我想要一个图形版本。我可以在我的应用程序中使用 hibernate，当我最终决定摆脱旧数据库并更改为最新的 Oracle 或 SQL Server 时，我可以轻松地做到这一点吗？还是我的数据库会发生如此大的变化以至于无论如何都没有关系（我建议在更改为新数据库时需要捕获更多信息）？

如果我误解了为什么休眠/ORM 可能会或可能不会有好处，我希望得到评论。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:17:08.870

从一个 DBMS 切换到另一个（从 Oracle 到 SQL Server）是使用 ORM 肯定会变得更容易的一件事。

至于从一个“大应用程序”切换到另一个“大应用程序”，我怀疑使用 ORM 是否会有那么大的帮助。很可能数据库结构和业务逻辑会有很大的不同，以至于你会发现自己重写了很多代码。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:17:46.390

如果数据库模式更改为完全不同的东西，我认为您不会从休眠中获得巨大的好处，您可能需要更改的不仅仅是映射 - 特别是如果将更多“结构”添加到数据库（表、列等）架构事物）。也就是说，如果数据库的结构基本相同，但可以说只是列名和表名发生变化，并且有几个表被合并或类似的东西 - 你只需更改映射即可。

但我真的建议使用 hbernate 来实现数据库不可知性，这是一条非常简单的途径。

然后仅仅因为如果你的整个数据库被改变它并不能完全帮助你，它有如此多的其他力量，我会选择它而不是直接数据库访问。

最后，您可以考虑使用服务层，例如将数据访问抽象化的存储库模式，因此如果数据库发生更改，您的应用程序的业务就不需要更改。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:52:18.007

您可以使用 Hibernate Tools 生成域对象，如果这样做的话，它将变得轻松而快速。但是，如果你手写所有的对象，你会死的。我认为重写部分应用程序并更好地了解hibernate是个好主意。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-28T01:53:49.553

我认为根据未知数与已知数做出任何决定通常是一个坏主意。无论您是在决定数据访问/持久性策略、购买什么汽车或上哪所大学，您都应该最重视您今天想要的事情，而不是担心可能发生或可能不会发生的事情明天。

因此，在考虑 ORM 时，我不会太担心诸如应用程序“消失”或 DBMS 变化之类的事情（除非已经讨论过，或者您的公司有这方面的历史）。我并不是说这些不是永远不会发生的事情，而是说它们应该退居到更重要的可维护性、性能和开发人员生产力的考虑因素上。

所以简而言之，根据它解决问题的能力和满足你今天的需求来选择一个 ORM。

# algorithm - 以预定义的频率生成一组随机事件

> ID：794588
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:06:50.020
> 
>         
> 
> 标签：algorithm, language-agnostic, random

我有一组必须**随机**发生的事件，但以预定义的频率发生。即在（完全）无限事件的过程中，事件 A 应该发生 10% 的次数，事件 B 应该发生 3% 的时间，依此类推……当然，事件列表的百分比总和将相加最多 100 个。

我想以编程方式实现这一目标。我该怎么做呢？  

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:14:55.973

你还没有指定语言，所以这里有一些伪代码

你基本上想要一个函数，它会以各种概率调用其他函数

```
Function RandomEvent

    float roll = Random() -- Random number between 0 and 1
    if roll < 0.1 then
        EventA
    else if roll < 0.13 then
        EventB
    .... 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:13:19.487

有趣的描述。如果没有限制实施的具体细节，我只能提供一个想法，您可以对其进行修改以适应您已经对实施做出的选择。如果您有一个文件，其中每一行都包含一个事件，则将文件构造为具有 10% 的 A 行、3% 的 B 行等。然后在选择事件时，获取一个随机生成的整数以从文件。  

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:13:32.060

您必须详细说明您的意思。如果您只是希望概率与您描述的一样，只需选择 1-100 之间的随机数并将其映射到事件。也就是说，如果随机数是1-10，做事件A。如果是11-13，做事件B，等等。

但是，如果您**要求**事物始终以这些比例精确出现（并不是说这真的可能），则必须以不同的方式进行。请确认您要查找的含义，如果需要，我将进行编辑。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:14:32.310

对于每个事件，生成一个介于 0 和 100 之间的随机数。如果事件 A 应发生 10% 的时间，则将值 0 - 10 映射到事件 A，依此类推。

例如，对于 2 个事件：

```
n = 0 - 10 ==> Event A
n = 11 - 99 ==> Event B 
```

如果你这样做，你可以让你的事件在随机时间发生，并且如果运行时间足够长（并且你的 RNG 足够好），事件频率将加起来达到所需的百分比。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:16:34.957

1.  以您想要的确切比例生成一系列事件。

2.  对于每个事件，在您的时间范围内随机生成每个事件应交付的时间戳。

3.  按该时间戳排序

4.  遍历列表，在适当的时间传递每个事件。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:19:07.493

从 1 到 100（包括 1 到 100）中选择一个随机数。为每个事件分配一组唯一的整数，表示它应该发生的频率。如果您随机生成的数字落在该特定选定的数字范围内，则会触发相关事件。

在上面的示例中，应该显示 10% 的时间的事件您将为其分配一个 10 个整数长的整数范围（1-10、12-21 等...）。如何存储这些整数范围取决于您。

就像迈克尔说的那样，由于这些是随机数，因此无法保证所述事件在 10% 的时间内准确触发，但从长远来看，它应该......给定随机数的均匀分布。

# javascript - 为什么在 Javascript 中使元素成为全局变量是不好的？

> ID：794598
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:09:04.397
> 
>         
> 
> 标签：javascript, internet-explorer, variables, events, global

我听说在 JavaScript 中使元素全局化并不是一个好主意。我不明白为什么。这是IE无法处理的事情吗？

例如：

```
 div = getElementById('topbar'); 
```

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-04-27T18:18:05.530

我不认为这是一个实施问题，而是一个好与坏的实践问题。通常 global * 是不好的做法，应该避免（全局变量等），因为您永远不知道项目的范围将如何演变以及您的文件将如何被包含在内。

我不是一个大的 JS 怪胎，所以我无法详细说明为什么 JS 事件不好，但是[Christian Heilmann 在这里谈到了 JS 最佳实践](http://www.slideshare.net/cheilmann/javascript-best-practices-1041724)，你可以看看。也可以尝试谷歌搜索“JS 最佳实践”

编辑：关于全局变量的维基百科，这也可能适用于您的问题：

> [全局变量] 通常被认为是不好的做法，正是因为它们的非局部性：全局变量可能会在任何地方被修改（除非它们驻留在受保护的内存中）并且程序的任何部分都可能依赖于它。因此，全局变量具有创建相互依赖关系的无限潜力，并且添加相互依赖关系会增加复杂性。看远处的动作。但是，在少数情况下，全局变量可能适合使用。例如，它们可用于避免在多个函数中连续传递常用变量。

通过[http://en.wikipedia.org/wiki/Global_variable](http://en.wikipedia.org/wiki/Global_variable)

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:14:41.200

> 这是IE无法处理的事情吗？

**不**，这不是 IE 的东西。您永远不能假设您的代码将是文档中使用的唯一脚本。因此，确保您的代码没有其他脚本可以覆盖的全局函数或变量名称非常重要。

有关示例，请参阅[与他人玩得好。](http://74.125.93.132/search?q=cache:zzyCvm7mUdcJ:icant.co.uk/articles/seven-rules-of-unobtrusive-javascript/+why+not+make+events+global+in+js&cd=1&hl=en&ct=clnk&gl=us&client=firefox-a)

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:23:47.933

我假设“事件”是指事件处理 JavaScript（函数）。

一般来说，在 JS 中使用多个全局变量是不好的。（如果您要存储任何数据以供将来使用，则不可能不使用至少一个。）这是因为它遇到了与所有[命名空间](http://en.wikipedia.org/wiki/Namespace_(computer_science))试图解决的问题相同的问题——如果您编写了一个方法 doSomething() 而其他人编写了一个称为 doSomething() 的方法？

解决这个问题的最好方法是创建一个全局变量，它是一个保存所有数据和函数的对象。例如：

```
var MyStuff = {};
MyStuff.counter = 0;
MyStuff.eventHandler = function() { ... };
MyStuff.doSomething = function() { ... };

// Later, when you want to call doSomething()...
MyStuff.doSomething(); 
```

这样，您对全局命名空间的污染最小；您只需要担心其他人使用您的全局变量。

当然，如果您的代码永远不会与其他人的代码一起使用，那么这一切都不是问题……但是如果您最终使用了其他人的代码，这种想法会在以后咬您一口。只要每个人都在 JS 全局名称方面表现良好，所有代码都可以相处。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2012-07-15T07:18:38.007

只要您将全局变量包装在唯一的命名空间/对象中（以避免与不属于您的脚本发生冲突），在代码中使用全局变量应该没有任何问题

在 javascript 中使用全局变量的主要优势源于 javascript 不是一种强类型语言。因此，如果您将一些复杂的对象作为参数传递给函数，您将可能会失去这些对象的所有智能（在函数范围内）。而使用全局对象，则会保留该智能。

我个人觉得这非常有用，而且它肯定在我的代码中占有一席之地。

（当然，应该始终在语言环境和全局变量之间做出正确的平衡）

# c++ - 基数树/帕特里夏树中的前缀搜索

> ID：794601
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-04-27T18:09:34.630
> 
>         
> 
> 标签：c++, algorithm, prefix, patricia-trie

我目前正在实现一个基数树/帕特里夏树（无论你想怎么称呼它）。我想用它在一个严重不足的硬件上的字典中进行前缀搜索。它应该或多或少像自动完成一样工作，即显示输入前缀匹配的单词列表。

我的实现基于[这篇文章](http://www.codeproject.com/KB/string/PatriciaTrieTemplateClass.aspx)，但其中的代码不包括前缀搜索，尽管作者说：

> [...]假设您要枚举所有具有公共前缀“AB”的键的节点。您可以从该根开始执行深度优先搜索，只要遇到后边缘就停止。

但我不明白这应该如何工作。例如，如果我从这些词构建一个基数树：

> 疾病
> 
>   想象
> 
>   想象
> 
>   想象
> 
>   模仿
> 
>   立即
> 
>   立即
> 
>   巨大
> 
>   的

对于前缀“i”和“in”，我将得到完全相同的“最佳匹配”，因此我似乎很难通过从最佳匹配中遍历树来收集所有匹配的单词。

此外，[Java 中有一个基数树实现，它在](http://code.google.com/p/radixtree/)[RadixTreeImpl.java](http://code.google.com/p/radixtree/source/browse/trunk/RadixTree/src/ds/tree/RadixTreeImpl.java)中实现了前缀搜索。该代码显式检查所有节点（从某个节点开始）是否有前缀匹配 - 它实际上比较字节。

谁能指出我在基数树上实现前缀搜索的详细描述？Java实现中使用的算法是唯一的方法吗？

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-04-27T18:26:56.710

想想你的 trie 编码了什么。在每个节点上，您都有通往该节点的路径，因此在您的示例中，您从 Λ（这是一个大写的 Lambda，这种希腊字体很烂）与空字符串对应的根节点开始。Λ 对使用的每个字母都有子级，因此在您的数据集中，您有一个分支，用于“i”。

*   Λ

*   Λ→“我”

在“i”节点，有两个孩子，一个用于“m”，一个用于“n”。下一个字母是“n”，所以你拿那个，

*   Λ→“i”→“n”

并且由于数据集中唯一以“i”、“n”开头的单词*是*“in”，因此“n”没有子代。那是一场比赛。

现在，假设数据集不是“in”，而是“infindibulum”。（我所引用的 SF 留作练习。）您仍然会以相同的方式到达“n”节点，但是如果您得到的下一个字母是“q”，您就知道该词不会出现在你的数据集中，因为没有“q”分支。那时，你说“好吧，不匹配”。（也许你然后开始添加这个词，也许不是，这取决于应用程序。）

但如果下一个字母是“f”，你可以继续。但是，您可以通过一些技巧将其短路：一旦到达代表唯一路径的节点，您就可以将*整个字符串*挂在该节点上。当你到达那个节点时，你知道字符串的其余部分*必须*是“findibulum”，所以你使用了前缀来匹配整个字符串，并返回它。

你怎么用的？在许多非 UNIX 命令解释器中，例如旧的 VAX DCL，您可以使用命令的任何唯一前缀。*因此， ls(1)*的等价物是`DIRECTORY`，但没有其他命令以 DIR 开头，因此您可以键入`DIR`，这与执行整个单词一样好。如果您不记得正确的命令，您可以只输入“D”，然后按（我认为）ESC；DCL CLI 将返回*所有*以 开头的命令，`D`它可以非常快速地搜索这些命令。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2010-03-02T16:14:27.650

事实证明，标准 c++ lib 的 GNU 扩展包括一个 Patricia trie 实现。它位于基于策略的数据结构扩展下。请参阅[http://gcc.gnu.org/onlinedocs/libstdc++/ext/pb_ds/trie_based_containers.html](http://gcc.gnu.org/onlinedocs/libstdc++/ext/pb_ds/trie_based_containers.html)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-28T07:13:39.643

另一种算法：保持简单愚蠢！

只需对您的关键字进行排序列表即可。当您有前缀时，二进制搜索以查找该前缀在列表中的位置。所有可能的完成都将从该索引开始，随时可以访问。

该算法将只需要 Patricia trie 的 5% 的代码，并且易于维护、理解和更新。几乎可以肯定，这个简单的列表搜索也会更有效。

唯一的缺点是，如果您有大量具有相似前缀的长关键字，则 trie 可以节省一些存储空间，因为它不需要为每个条目保留完整的前缀。在实践中，如果你的单词少于几百万，这不会节省，因为树的指针开销将占主导地位。这种节省更多地用于搜索具有数百万个字符的 DNA 字符串数据库等应用程序，而不是文本关键字。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2013-06-18T20:54:41.367

另一种替代算法是[三元搜索树](http://en.wikipedia.org/wiki/Ternary_search_tree)（内存效率更高）[https://github.com/varunpant/TernaryTree/tree/master/TernaryTree](https://github.com/varunpant/TernaryTree/tree/master/TernaryTree)

# sql-server - 如何管理本地 sql server 数据库文件？

> ID：794606
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:11:46.183
> 
>         
> 
> 标签：sql-server

我的系统是用于开发的，我运行 sql server 2005 的本地副本。我想将所有数据库文件从程序文件中移出，并放在另一个分区上更好的位置。为此，您是否只需分离 SSMS 中的所有数据库，使用 Windows 资源管理器移动 .mdf 和 .ldf 文件，然后重新附加？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:12:29.303

那应该行得通。

[http://support.microsoft.com/kb/224071](http://support.microsoft.com/kb/224071)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:20:10.110

是的，分离并重新连接它们。如果您还打算移动系统数据库，那将需要一些特别的努力。可以在 MSDN 上找到相关说明。

[http://msdn.microsoft.com/en-us/library/ms345408(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms345408(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:57:05.890

可能这就是您正在寻找的。我想在这里写下我的答案，但是我懒得这样做，但是我将您发送到有关在 SQL Server 中移动数据文件的博客文章；

[http://dbalink.wordpress.com/2008/11/06/how-to-moving-data-files/](http://dbalink.wordpress.com/2008/11/06/how-to-moving-data-files/) 

# c# - 进行 XML RPC 调用时出现问题

> ID：794614
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:13:21.110
> 
>         
> 
> 标签：c#, httpwebrequest, xml-rpc

我正在尝试隔离我在进行 XML RPC 调用时遇到的问题：

```
XDocument doc = new XDocument();
doc.Add(new XElement("methodCall",
        new XElement("methodName", "send"),
        new XElement("params",
            new XElement("param", new XElement("value", new XElement("string", this.ApiKey))),
            new XElement("param", new XElement("value", new XElement("string", this.FromAddress))),
            new XElement("param", new XElement("value", new XElement("string", recipient))),
            new XElement("param", new XElement("value", new XElement("string", contents)))  
        )
    )
);

HttpWebRequest req = (HttpWebRequest)WebRequest.Create("http://urlremoved");
req.ContentType = "text/xml";
req.Method = "POST";

XmlTextWriter writer = new XmlTextWriter(req.GetRequestStream(), Encoding.UTF8);
doc.Save(writer);

HttpWebResponse response = (HttpWebResponse)req.GetResponse();
StreamReader reader = new StreamReader(response.GetResponseStream());
return reader.ReadToEnd(); 
```

这只是停止并且永远不会超时（即使我在 req.TimeOut 和 req.ReadWriteTimeout 上设置了超时）。我删除了 url，主要是为了只关注代码。

代码有什么问题会阻止进行此调用吗？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-06-05T07:30:46.440

如果`writer.Flush();`在保存 XML 后调用会发生什么？

我不确定为什么这不会超时，但也许它不会超时，因为由于写入被缓冲而没有发出请求？

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-08-23T18:22:36.257

我最终使用[http://www.xml-rpc.net/](http://www.xml-rpc.net/)而不是自己编写。

# vb6 - 从 VB6 调用一个简单的 VC DLL

> ID：794616
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:13:58.393
> 
>         
> 
> 标签：vb6, dllimport

我有一个用 VC6 编写的简单 DLL，具有一个功能：

```
__declspec(dllexport) int myfunc(long a, unsigned char *b, unsigned char *c, unsigned char *d, unsigned char *e) 
```

我使用以下命令从 vb6 调用它：

```
Declare Function myfunc Lib "mylib.dll" (ByVal a As Long, ByVal b As String, ByVal c As String, ByVal d As String, ByVal e As String) As Long

....

dim a as long
dim b as string
dim c as string
dim d as string
dim e as string
dim r as long

r=myfunc(a,b,c,d,e) 
```

我收到“错误的 dll 调用约定”错误，但我不知道为什么。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T18:28:21.510

一般来说，'bad DLL...' 意思是它所说的。VB6 要求它调用的任何外部函数都使用 _stdcall 约定（如 Win API）。

尝试添加`__stdcall`到 C 函数原型，看看会发生什么。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-09-17T00:55:39.597

查看 Paul Caton 的 Universal DLL 函数调用程序：

[http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=70195&lngWId=1](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=70195&lngWId=1)

它将允许您从 VB6 调用几乎任何类型的函数。

# c++ - Eclipse中的Boost链接错误

> ID：794625
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:16:06.143
> 
>         
> 
> 标签：c++, eclipse, linker, include

我一直在试图在我的 Ubuntu 上的 Eclipse C++ 项目中包含 boost 的线程功能，但毫无结果。

到目前为止的步骤：

从 boost.org 下载 boost

```
./configure --with-libraries=system,thread
make
sudo make install

sudo ldconfig -v 
```

在eclipse项目中，将include目录设置为：

```
/usr/local/include/boost-1_38/ 
```

在链接器中将库（-l）设置为“boost_thread”

将搜索路径 (-L) 设置为

```
/usr/local/lib 
```

链接器运行，返回 ld 错误

```
/usr/bin/ld: cannot find -lboost_thread 
```

如下：

```
Invoking: GCC C++ Linker
g++ -L/usr/local/lib -o"boostHello3"  ./src/boostHello3.o   -lboost_thread
/usr/bin/ld: cannot find -lboost_thread
collect2: ld returned 1 exit status 
```

以下是 /usr/local/lib 中的相关条目：

```
libboost_system-gcc43-mt-1_38.a
libboost_system-gcc43-mt-1_38.so
libboost_system-gcc43-mt-1_38.so.1.38.0
libboost_system-gcc43-mt.a
libboost_system-gcc43-mt.so

libboost_thread-gcc43-mt-1_38.a
libboost_thread-gcc43-mt-1_38.so
libboost_thread-gcc43-mt-1_38.so.1.38.0
libboost_thread-gcc43-mt.a
libboost_thread-gcc43-mt.so 
```

这是/etc/ld.so.conf的内容

```
include /etc/ld.so.conf.d/*.conf
/usr/local/lib 
```

链接器如何缺少这个？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:28:18.547

好吧，链接器试图在其搜索路径中找到一个名为“libboost_thread.a”（或“libboost_thread.so”）的库，而您显然没有。创建适当的链接，或使用“-lboost_thread-gcc43-mt”

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:23:28.107

您的链接器行应该是`-lboost_thread-gcc43-mt-1_38`.

# cakephp - cakephp 并获取请求

> ID：794630
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:17:18.323
> 
>         
> 
> 标签：cakephp

cakephp 如何处理获取请求？例如，它将如何处理这样的请求...
 [http://us.mc01g.mail.yahoo.com/mc/welcome?.gx=1&.rand=9553121_pg=showFolder&fid=Inbox&order=down&tt=1732&pSize=20& .rand=425311406&.jsrand=3](http://us.mc01g.mail.yahoo.com/mc/welcome?.gx=1&.rand=9553121_pg=showFolder&fid=Inbox&order=down&tt=1732&pSize=20&.rand=425311406&.jsrand=3)

“mc”是控制器，“welcome”是动作吗？其余信息如何处理？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-04-27T19:04:59.113

另请注意，您可以从 Cake 1.2 开始使用命名参数。命名参数按 key:value 顺序排列，因此 URL [http://somesite.com/controller/action/key1:value1/key2:value2](http://somesite.com/controller/action/key1:value1/key2:value2)将给出 aa $this->params['named'] array( 'key1' = > 'value1', 'key2' => 'value2' ) 来自任何控制器。

如果您使用 CNN.com 样式的 GET 请求（[http://www.cnn.com/2009/SHOWBIZ/books/04/27/ayn.rand.atlas.shrugged/index.html](http://www.cnn.com/2009/SHOWBIZ/books/04/27/ayn.rand.atlas.shrugged/index.html)），则参数按顺序排列$this->params['pass'] 数组中的外观（2009、SHOWBIZ、书籍等），索引从 0 开始。

我强烈推荐命名参数，因为您以后可以通过传递 get 参数来添加功能，而不必担心顺序。我相信您也可以更改命名参数分隔键（默认情况下，它是'：'）。

因此，它与“传统”GET 参数（page.php?key1=value1&key2=value2）略有不同。但是，您可以轻松地在应用程序中添加一些逻辑，通过绑定应用程序解析请求的方式来自动将传统参数解析为数组。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:21:50.793

CakePHP 使用路由来确定这一点。默认情况下，路由按照您的描述工作。'?' 之后的余数 是查询字符串，可以`$this->params['url']`在控制器中找到，解析为关联数组。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2010-09-03T00:17:04.790

因为我在搜索它时发现了它，即使它有点旧了。

```
$this->params['url'] 
```

持有 GET 信息。

我已经测试过，但它确实有效。Cakephp 书中的页面是**“url”**部分下的[这个链接。](http://book.cakephp.org/view/55/The-Parameters-Attribute-params)它甚至给出了一个与此处原始问题中的示例非常相似的示例。这也适用于我正在运行的 CakePHP 1.3。

 *** * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-28T00:49:01.440

从那以后，它并没有真正使用典型的 get 。

如果它通过那长长的疯狂字符串，什么都不会发生。它需要这种格式的数据：site.com/controller/action/var1/var2/var....

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-08-02T00:12:46.717

有人可以澄清正确答案吗？在我看来，斯波尔森和肖恩唐尼的陈述相互矛盾？

是否有人能够使用最新版本的 CakePHP 并获得以下 url 工作：

**[http://www.domain.com/index.php/oauth/authorize?oauth_version=1.0&oauth_nonce=c255c8fdd41bd3096e0c3bf0172b7b5a&oauth_timestamp=1249169700&oauth_consumer_key=8a001709e6552888230f88013f23d5d004a7445d0&oauth_signature_method=HMAC-SHA1&oauth_signature=0bj5O1M67vCuvpbkXsh7CqMOzD0%3D](http://www.domain.com/index.php/oauth/authorize?oauth_version=1.0&oauth_nonce=c255c8fdd41bd3096e0c3bf0172b7b5a&oauth_timestamp=1249169700&oauth_consumer_key=8a001709e6552888230f88013f23d5d004a7445d0&oauth_signature_method=HMAC-SHA1&oauth_signature=0bj5O1M67vCuvpbkXsh7CqMOzD0%3D)**

oauth 是控制器并授权作为一种方法，因为它最终能够接受 GET 请求？

# c++ - 以编程方式获取缓存行大小？

> ID：794632
> 
>         
> 
> 赞同：189
> 
>         
> 
> 时间：2009-04-27T18:17:27.310
> 
>         
> 
> 标签：c++, c, caching, operating-system, systems-programming

欢迎所有平台，请指定您回答的平台。

一个类似的问题：[How to programmatically get the CPU cache page size in C++?](https://stackoverflow.com/q/150294)

* * *

## 回答 #1

> 赞同：197
> 
>             
> 
> 时间：2009-04-28T16:10:47.153

在 Linux（具有相当新的内核）上，您可以从 /sys 中获取此信息：

```
/sys/devices/system/cpu/cpu0/cache/ 
```

该目录对每一级缓存都有一个子目录。这些目录中的每一个都包含以下文件：

```
coherency_line_size
level
number_of_sets
physical_line_partition
shared_cpu_list
shared_cpu_map
size
type
ways_of_associativity 
```

这为您提供了有关缓存的更多信息，然后您希望知道，包括缓存线大小 ( `coherency_line_size`) 以及哪些 CPU 共享此缓存。如果您正在使用共享数据进行多线程编程，这非常有用（如果共享数据的线程也共享缓存，您将获得更好的结果）。

* * *

## 回答 #2

> 赞同：161
> 
>             
> 
> 时间：2010-05-08T23:06:39.183

On Linux look at sysconf(3). 

```
sysconf (_SC_LEVEL1_DCACHE_LINESIZE) 
```

You can also get it from the command line using getconf:

```
$ getconf LEVEL1_DCACHE_LINESIZE
64 
```

* * *

## 回答 #3

> 赞同：122
> 
>             
> 
> 时间：2010-10-29T06:36:16.660

I have been working on some cache line stuff and needed to write a cross-platform function. I committed it to a github repo at [https://github.com/NickStrupat/CacheLineSize](https://github.com/NickStrupat/CacheLineSize), or you can just use the source below. Feel free to do whatever you want with it.

```
#ifndef GET_CACHE_LINE_SIZE_H_INCLUDED
#define GET_CACHE_LINE_SIZE_H_INCLUDED

// Author: Nick Strupat
// Date: October 29, 2010
// Returns the cache line size (in bytes) of the processor, or 0 on failure

#include <stddef.h>
size_t cache_line_size();

#if defined(__APPLE__)

#include <sys/sysctl.h>
size_t cache_line_size() {
    size_t line_size = 0;
    size_t sizeof_line_size = sizeof(line_size);
    sysctlbyname("hw.cachelinesize", &line_size, &sizeof_line_size, 0, 0);
    return line_size;
}

#elif defined(_WIN32)

#include <stdlib.h>
#include <windows.h>
size_t cache_line_size() {
    size_t line_size = 0;
    DWORD buffer_size = 0;
    DWORD i = 0;
    SYSTEM_LOGICAL_PROCESSOR_INFORMATION * buffer = 0;

    GetLogicalProcessorInformation(0, &buffer_size);
    buffer = (SYSTEM_LOGICAL_PROCESSOR_INFORMATION *)malloc(buffer_size);
    GetLogicalProcessorInformation(&buffer[0], &buffer_size);

    for (i = 0; i != buffer_size / sizeof(SYSTEM_LOGICAL_PROCESSOR_INFORMATION); ++i) {
        if (buffer[i].Relationship == RelationCache && buffer[i].Cache.Level == 1) {
            line_size = buffer[i].Cache.LineSize;
            break;
        }
    }

    free(buffer);
    return line_size;
}

#elif defined(linux)

#include <stdio.h>
size_t cache_line_size() {
    FILE * p = 0;
    p = fopen("/sys/devices/system/cpu/cpu0/cache/index0/coherency_line_size", "r");
    unsigned int i = 0;
    if (p) {
        fscanf(p, "%d", &i);
        fclose(p);
    }
    return i;
}

#else
#error Unrecognized platform
#endif

#endif 
```

* * *

## 回答 #4

> 赞同：32
> 
>             
> 
> 时间：2009-04-27T18:28:23.570

在 x86 上，您可以使用带有函数 2 的[CPUID](http://en.wikipedia.org/wiki/CPUID)指令来确定缓存和 TLB 的各种属性。解析函数 2 的输出有些复杂，所以我将向您介绍[Intel 处理器标识和 CPUID 指令](http://www.intel.com/assets/pdf/appnote/241618.pdf)(PDF) 的第 3.1.3 节。

要从 C/C++ 代码中获取此数据，您需要使用内联汇编、编译器内在函数或调用外部汇编函数来执行 CPUID 指令。

* * *

## 回答 #5

> 赞同：9
> 
>             
> 
> 时间：2016-10-08T11:40:19.257

If you're using SDL2 you can use this function:

```
int SDL_GetCPUCacheLineSize(void); 
```

Which returns the size of the L1 cache line size, in bytes.

In my x86_64 machine, running this code snippet:

```
printf("CacheLineSize = %d",SDL_GetCPUCacheLineSize()); 
```

Produces `CacheLineSize = 64`

I know I'm a little late, but just adding information for future visitors.
The SDL documentation currently says the number returned is in KB, but it is actually in bytes.

* * *

## 回答 #6

> 赞同：7
> 
>             
> 
> 时间：2009-12-14T11:50:24.060

在 Windows 平台上：

from [http://blogs.msdn.com/oldnewthing/archive/2009/12/08/9933836.aspx](http://blogs.msdn.com/oldnewthing/archive/2009/12/08/9933836.aspx)

> The GetLogicalProcessorInformation
>   function will give you characteristics
>   of the logical processors in use by
>   the system. You can walk the
>   SYSTEM_LOGICAL_PROCESSOR_INFORMATION
>   returned by the function looking for
>   entries of type RelationCache. Each
>   such entry contains a ProcessorMask
>   which tells you which processor(s) the
>   entry applies to, and in the
>   CACHE_DESCRIPTOR, it tells you what
>   type of cache is being described and
>   how big the cache line is for that
>   cache.

* * *

## 回答 #7

> 赞同：4
> 
>             
> 
> 时间：2015-10-13T15:50:18.633

ARMv6 and above has ***`C0`*** or the Cache Type Register. However, its only available in privileged mode.

For example, from [Cortex™-A8 Technical Reference Manual](http://infocenter.arm.com/help/topic/com.arm.doc.ddi0344f/DDI0344F_cortex_a8_r2p3_trm.pdf):

> The purpose of the Cache Type Register is to determine the instruction
>   and data cache minimum line length in bytes to enable a range of
>   addresses to be invalidated.
> 
>   
>   
> 
> The Cache Type Register is:
> 
>   
>   
> 
> *   a read-only register 
> 
> *   accessible in privileged modes only.
> 
>   
>   
> 
> The contents of the Cache Type Register depend on the specific
>   implementation.  Figure 3-2 shows the bit arrangement of the Cache
>   Type Register...

* * *

Don't assume the ARM processor has a cache (apparently, some can be configured without one). The standard way to determine it is via ***`C0`***. From the [ARM ARM](https://www.scss.tcd.ie/~waldroj/3d1/arm_arm.pdf), page B6-6:

> From ARMv6, the System Control Coprocessor Cache Type register is the
>   mandated method to define the L1 caches, see Cache Type register on
>   page B6-14\. It is also the recommended method for earlier variants of
>   the architecture. In addition, Considerations for additional levels of
>   cache on page B6-12 describes  architecture guidelines for level 2
>   cache support.

* * *

## 回答 #8

> 赞同：3
> 
>             
> 
> 时间：2009-04-28T13:47:30.523

您也可以尝试通过测量一些时间以编程方式进行。显然，它并不总是像 cpuid 之类的那样精确，但它更便携。ATLAS 在其配置阶段执行此操作，您可能需要查看它：

[http://math-atlas.sourceforge.net/](http://math-atlas.sourceforge.net/)

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2022-01-22T15:29:09.413

You can use [std::hardware_destructive_interference_size](https://en.cppreference.com/w/cpp/thread/hardware_destructive_interference_size) since C++17.

Its defined as:

> Minimum offset between two objects to avoid false sharing. Guaranteed
> to be at least alignof(std::max_align_t)

# sql - 如何使用随机日期更新行

> ID：794637
> 
>         
> 
> 赞同：80
> 
>         
> 
> 时间：2009-04-27T18:18:18.430
> 
>         
> 
> 标签：sql, sql-server

我有一个简单的 SQL 表，它有一个 DateTime 列。我想用随机日期更新所有行（>100000 行）。有没有一种简单的方法来执行此 SQL 查询？

* * *

## 回答 #1

> 赞同：95
> 
>             
> 
> 时间：2009-04-27T18:25:33.687

使用它在 1900 年 1 月 1 日到 2079 年 6 月 6 日之间生成一个 smalldatetime（未选中，未安装 SQL）

```
DATEADD(day, (ABS(CHECKSUM(NEWID())) % 65530), 0) 
```

NEWID 比尝试使用 RAND 更好：RAND 不会在单个 SELECT 或 UPDATE 中生成不同的值行（如果行为发生了变化，它在 SQL 2000 中不会生成）。

编辑：像这样

```
UPDATE
  table
SET
  datetimecol = DATEADD(day, (ABS(CHECKSUM(NEWID())) % 65530), 0) 
```

编辑：将 65535 更改为 65530 并添加 ABS 以避免在范围上限溢出

* * *

## 回答 #2

> 赞同：70
> 
>             
> 
> 时间：2009-04-27T18:35:42.943

我将补充以下答案，

```
SELECT DATEADD(DAY, ABS(CHECKSUM(NEWID()) % 3650), '2000-01-01')
FROM your_table 
```

这会生成从 2000-01-01 开始的日期，并且您可以更改模值中的天数，我输入 3650（大约 10 年），这种方法不会溢出。

如果你想更新，那么

```
UPDATE your_table
SET your_date_field = DATEADD(DAY, ABS(CHECKSUM(NEWID()) % 3650), '2000-01-01')
WHERE your_conditions 
```

* * *

## 回答 #3

> 赞同：47
> 
>             
> 
> 时间：2013-05-07T12:00:59.910

这个问题似乎很老，但我的回答可能对其他人有用。

```
 Update table
      SET Time= DateAdd(d, ROUND(DateDiff(d, '2010-01-01', '2013-12-31') * RAND(CHECKSUM(NEWID())), 0),
      DATEADD(second,CHECKSUM(NEWID())%48000, '2010-01-01')) 
```

这会在给定范围之间生成随机日期时间。

* * *

## 回答 #4

> 赞同：10
> 
>             
> 
> 时间：2014-11-21T10:30:04.077

我改编了上面 Jhonny 的答案，以获取过去 10 年的日期：

```
SELECT dateadd(day, (abs(CHECKSUM(newid())) % 3650) * -1, getdate()) 
```

请注意，这只是 SQLServer。

* * *

## 回答 #5

> 赞同：7
> 
>             
> 
> 时间：2013-08-12T14:08:59.860

我用它为我的所有测试数据设置了 1940 年到 1985 年之间的出生日期

```
SET [Birth Date] = DATEADD(day, (ABS(CHECKSUM(NEWID())) % 16250), '1940-1-1 00:00:00.001') 
```

* * *

## 回答 #6

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:34:46.503

以下代码将使用两个给定日期之间的随机日期填充 FiscalYear 表的 StartDate 列：    

```
-- First, let's declare the date range.
DECLARE @date_from DATETIME;
DECLARE @date_to DATETIME;

-- Set the start and date dates. In this case, we are using
-- the month of october, 2006.
SET @date_from = '1985-10-14';
SET @date_to = '2009-04-27';

UPDATE FiscalYear SET StartDate =  
(
    -- Remember, we want to add a random number to the
    -- start date. In SQL we can add days (as integers)
    -- to a date to increase the actually date/time
    -- object value.
    @date_from +
    (
        -- This will force our random number to be >= 0.
        ABS
        (
            -- This will give us a HUGE random number that
            -- might be negative or positive.
            CAST(CAST(NewID() AS BINARY(8)) AS INT)
        )

        -- Our random number might be HUGE. We can't have
        -- exceed the date range that we are given.
        -- Therefore, we have to take the modulus of the
        -- date range difference. This will give us between
        -- zero and one less than the date range.
        %

        -- To get the number of days in the date range, we
        -- can simply substrate the start date from the
        -- end date. At this point though, we have to cast
        -- to INT as SQL will not make any automatic
        -- conversions for us.
        CAST((@date_to - @date_from) AS INT)
    )
) 
```

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2013-11-30T23:20:48.290

我正在寻找一个与此类似的问题，它也产生了一个随机时间，我找到了这个脚本。认为它在这里可能有用：

```
DECLARE @DateFrom DATETime = '2001-01-01'
DECLARE @DateTo DATeTime = '2013-11-30'
DECLARE @DaysRandom Int= 0
DECLARE @MillisRandom Int=0

--get random number of days

select @DaysRandom= DATEDIFF(day,@DateFrom,@DateTo)
SELECT @DaysRandom = ROUND(((@DaysRandom -1) * RAND()), 0)

--get random millis
SELECT @MillisRandom = ROUND(((99999999) * RAND()), 0)

SELECT @DateTo = DATEADD(day, @DaysRandom, @DateFrom)
SELECT @DateTo = DATEADD(MILLISECOND, @MillisRandom, @DateTo)
SELECT @DateTo 
```

我从这里得到它：
 http: [//crodrigues.com/sql-server-generate-random-datetime-within-a-range/](http://crodrigues.com/sql-server-generate-random-datetime-within-a-range/)

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:28:56.907

使用下面的代码，您可以获得@Min (1) 和@Max (365) 之间的随机整数，然后使用 dateadd 函数可以创建去年的随机日期。

```
CREATE VIEW vRandNumber
AS
SELECT RAND() as RandNumber
GO

CREATE FUNCTION RandNumber(@Min int, @Max int)
RETURNS int
AS
 BEGIN
 RETURN round(@Min + (select RandNumber from vRandNumber) * (@Max-@Min),0)
 END
GO

Update table1
set theDate = dateadd(d,0-dbo.RandNumber(1,365),getdate()) 
```

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:29:40.993

您可以尝试获取一个随机数（正数或负数），然后将该数添加到日期（可能是系统日期）。

例如（我现在无权访问 sqlserver，因此无法验证语法）

```
DATEADD(day, DATEDIFF(day, 0, GETDATE()) - 1 - FLOOR(RAND(CAST(NEWID() AS binary(4))) * 365.25 * 90), 0) 
```

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2016-06-25T17:19:20.047

我为自己结合了几个答案，我认为它对你有用。我花了 40 秒来执行 140k 行。i5, 1333MHZ, 标准笔记本硬盘

```
 DECLARE @rank INT = 0;

WHILE @rank < yourmaxrow --(you can use Select count (*) from your table name as well)
BEGIN
   DECLARE @FromDate DATETIME = DATEADD(DAY, -720, GETDATE()) -- 2 years back
   DECLARE @ToDate   DATETIME = DATEADD(DAY, -1, GETDATE()) -- until yesterday

   DECLARE @Seconds INT = DATEDIFF(SECOND, @FromDate, @ToDate)
   DECLARE @Random INT = ROUND(((@Seconds-1) * RAND()), 0)
   DECLARE @Milliseconds INT = ROUND((999 * RAND()), 0)

update yourtablename
Set yourdatetiemcolumnname = DATEADD(MILLISECOND, @Milliseconds, DATEADD(SECOND, @Random, @FromDate))
WHERE Id = @rank
   SET @rank = @rank + 1;       
END; 
```

# visual-studio - Visual Studio 调试/构建

> ID：794640
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:19:23.607
> 
>         
> 
> 标签：visual-studio, debugging, compiler-construction, build

我有一个解决方案，它有一个普通的旧 asp.net 网站和一个 winforms 应用程序。

我将 winforms 应用程序设置为我的启动应用程序。

当我按下 (CTRL+)F5 时，它只是运行应用程序而不构建。因此，我的更改并未内置到程序中。

我应该怎么做才能解决这个问题？

## 编辑

我不想去构建菜单然后调试。我想要一步。

## 编辑 2

这是VS 2008 SP1

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:33:39.987

我必须进入我的解决方案的属性并选择我想要在构建期间包含的项目。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:23:02.803

构建->构建解决方案（按 F6）

用于直接调试（按 F5）

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:26:06.370

在按 F5 之前，您可以使用 CTRL+SHIFT+B 进行构建。这不是一步，但它不是使用鼠标。

但是如果有更改它不会首先编译，这确实看起来很奇怪。它曾经在我的电脑上做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2010-05-06T12:29:05.623

在Visual Studio中，转到工具，导入和导出设置，重置。希望这可能会有所帮助

# .net - 为什么用户信息存储在 ASP.NET 的默认 Membership Provider 的两个不同的表中？

> ID：794647
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-04-27T18:20:43.900
> 
>         
> 
> 标签：.net, asp.net, asp.net-membership

有两个表：aspnet_users 和 aspnet_membership。谁能详细说明他们不为此使用单个表的原因？

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-04-27T18:48:26.067

成员资格表包含与**MembershipProvider** API 接口相关的信息。users 表存储用户名和用户 id，它们是从许多提供程序中引用的。

*   用户

    *   会员资格 (MembershipProvider)

    *   配置文件（ProfileProvider）

    *   角色 (RoleManager)

    *   ETC

aspnetdb 系统是非常模块化的，每个部分都可以通过各种供应商进行定制。这些表需要分开，以便每个接口都可以重写、重定向等。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:29:27.327

ASP.NET 中的一些其他提供程序（Membership 提供程序除外）也存储用户特定的信息。例如个人资料。

有关此的更多信息：

一些附带的 ASP.NET 提供程序在用户名的上下文中存储/使用信息。其中之一是**MembershipProvider**，它提供身份验证存储和一组服务。

另一个是**ProfileProvider**，它允许针对每个用户保存特定于用户的数据。

无论您是否选择使用**MembershipProvider** ，您仍然可以使用**ProfileProvider**。因为**ProfileProvider**必须根据用户名存储数据（即由属性公开），所以它将继续并将用户记录添加到 aspnet_Users 中。****`Context.User.Identity.Name`****

 ****希望这能澄清分离的原因。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:35:48.390

老实说，这对我来说也没有多大意义。似乎 aspnet_Membership 表设置为容纳用户/应用程序级别信息，但 UserID 是一个 PK。很奇怪。也许在以后的版本中，您确实为每个用户拥有多个应用程序的情况进行了设置。

Dave 提到还有其他表（例如 aspnet_Profile）保存用户特定信息。可能是 ASP.NET 2.0 的人们只是试图将不同的字段分组分离成更容易理解的块。

我知道这只是一堆猜想。希望有一些实际知识的人会加入。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:56:02.863

我从这个[页面](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)找到了这个解释：

SqlMembershipProvider 将用户帐户信息存储在两个相关的表中：

*   aspnet_Users - 有每个用户帐户的记录，存储基本要素。UserId 列唯一标识系统中的每个用户，并存储为唯一标识符（GUID）。

*   aspnet_Membership - 有一个 UserId 列，它将每条记录与 aspnet_Users 中的特定记录联系起来。aspnet_Membership 表存储与每个用户帐户关联的核心数据：电子邮件、密码、安全问题和答案等。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:08:01.287

包含您创建的`aspnet_users`用户（身份验证表格）...注意当您的身份验证设置为 WINDOWS 时，用户是 WINDOWS 用户，例如 domain\firstname.lastname

`aspnet_membership`包含在`WebPart`s 和用户设置等内容中使用的成员偏好信息

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2011-06-24T20:42:18.703

aspnet_users 表包含所有用户的信息：匿名和非匿名。aspnet_membership 表包含有关注册用户（非匿名）的信息。

# iphone - 在视图控制器之间传播数据

> ID：794650
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:21:52.370
> 
>         
> 
> 标签：iphone

我有一个表格视图控制器。表格的一些行打开了新的控制器，让用户输入更多数据或使用选择器等。这就像内置的日历应用程序一样。当用户在第二个屏幕上点击“保存”时，我希望该屏幕上的值传播回表格视图控制器，但我不知道该怎么做。由于我使用 pushNavigationController 进入第二个屏幕，因此没有机会提供指向原始对象的指针。（即使有可能，这似乎也是非常糟糕的设计，因为第二个控制器必须知道有关其父级的信息。）

此外，从测试来看，pushNavigationController 似乎不会“暂停”原始控制器，因此一旦弹出第二个屏幕，您就不会在下一行代码上恢复。

好像我在这里错过了一些非常基本的东西。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:40:36.453

Apple 的许多框架都支持 MVC（模型视图控制器）设计模式。控制器（本例中为 UITableViewController）协调获取数据以将其移交给视图（本例中为 UITableView）。要充分利用这种模式，您的数据应该来自模型对象。这是您设计用于表示数据的对象 - 提供抽象，以便您的 UI 实现和数据松散耦合。当您的控制器推送另一个控制器以进一步检查或编辑数据时，模型对象将传递给此控制器，以便新控制器可以访问模型中包含的数据。用户更改 UI 中的数据，然后在按下“保存”时修改模型对象。

当用户按下“保存”按钮时，有多种方法可以将更改传播回 UITableViewController。您可以使用 KVO（键值观察），从而在模型对象的属性发生更改时通知表或其单元格之一。另一种方法是在两个控制器之间使用 NSNotificationCenter 通知来传达更改。

# iphone - 可以切换由 UINavigationController 管理的视图控制器吗？

> ID：794652
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:22:12.727
> 
>         
> 
> 标签：iphone, cocoa-touch, uinavigationcontroller

我正在打破 UINavigationController 的正常范式，或者至少我正在尝试这样做。

我们知道导航控制器通过堆栈管理导航。如果我使用根控制器 A 进行初始化，导航到 B，然后导航到 C，堆栈将看起来像 - C/B/A。

不过，我想做的是在视图 C 上有一个按钮，该按钮将显示另一个视图，比如 X，但仍将导航控制器的导航栏保持在原位。本质上，在堆栈上切换“C”和“X”。我试图通过弹出 C 并立即按下 X 来实现这一点，如下所示，但它不起作用。我在这里走错路了吗？

```
-(IBAction)showViewX:(id)sender {
[[self.parentViewController navigationController] popViewControllerAnimated:NO];

XViewController *xViewController = [[XViewController alloc]
        initWithNibName:@"X" 
        bundle:[NSBundle mainBundle]];
[[self.parentViewController navigationController] pushViewController: xViewController animated:YES];
[xViewController release];  
} 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T21:21:24.387

你所说的“视图 C”实际上是“视图控制器 C”。由于它是一个视图控制器，您可以轻松地将其设置为在两个视图 X 和 Y 之间切换。所以您只需将 C 留在堆栈中，不要弹出它，然后在 C 本身的视图之间切换。例如，您可以将 C 设置为使用工具栏在视图之间切换。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:21:58.603

可能是您真的没有尝试执行 UINavigationController 旨在支持的那种导航。在您的示例中，您的用户如何从视图 X 回到视图 C？

UINavigationController 旨在允许基本的向前/向后导航。如果您有更复杂的导航需求，则必须构建自己的导航系统。看看一些更复杂的 Apple 应用程序（邮件和 Safari）是如何进行导航的——也许其中有一些有用的东西？

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T21:21:12.017

（看上面的澄清评论，我误解了原始问题的目标，更好的方法是从 View C 本身管理 View X 或 View C 的显示，根据需要切换，而不是在全部。）

由于您想保留导航控制器栏，但您不希望能够从“X”返回到“C”（我假设“X”之外还有其他路径）那么您可以执行以下操作：

```
self.navigationItem.hidesBackButton = YES; 
```

从 ViewController X 内部，在`viewDidLoad`方法内部。

X 仍在堆栈中，C 仍在堆栈中，但您获得了所需的视觉表示。

否则，您可能需要滚动一个新的 NavigationContoller，将 X 弹出到它的堆栈上，然后跳转到它，将旧堆栈（和 ViewController）留在后面。

# vb.net - Visual Basic COM 项目模板在哪里？

> ID：794655
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:22:32.400
> 
>         
> 
> 标签：vb.net, visual-studio, com, project-template

我最近在上课，讲师使用“COM 项目”模板启动了一个新的 Visual Studio 2008 项目。现在我回来了，我尝试在我的 VS2008 安装中找到该模板，但没有成功。有谁知道我在哪里可以找到那个模板，或者如果没有，它可能会做些什么来达到它的效果？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:25:38.210

你看过 C++ 模板吗？

**编辑**
VB.NET，相信不会做COM项目。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T21:25:13.067

找到了……不是项目模板，是类模板。

# sql - 将 TSQL 转换为 MS-Access SQL

> ID：794656
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-04-27T18:22:37.687
> 
>         
> 
> 标签：sql, ms-access, syntax, join, parentheses

TSQL（在 MS SQL Server 2000 和 2005 中使用）允许多个 JOIN 子句，一个接一个，不需要逗号或括号。在 Access 中试试这个，它会抛出一个合适的结果：“查询表达式中的语法错误（缺少运算符）......”

根据我在 Google 中收集到的信息，Access SQL 需要括号来对 JOIN 子句进行分组。关于如何完成此操作的大多数建议是使用设计视图或查询向导，并让 Access 找出将括号放在哪里（在标准 SQL 中不需要）。问题是，我太习惯在文本编辑器（记事本、SSMS、VS2005 等等）中执行我的 SQL，以至于设计视图和向导阻碍了我的皮肤爬行。有时，如果有多种可能性，向导会对加入什么做出错误的假设，而且我已经习惯于自己在 TSQL 中做这件事，以至于我宁愿让向导排除在外。

是否没有将 TSQL 转换为 Access SQL 的工具，或者至少有一组关于放置括号的规则？

例子：

```
SELECT ...
FROM Participant PAR
    INNER JOIN Individual IND 
        ON PAR.APETSID = IND.APETSID
    INNER JOIN Ethnicity ETH 
        ON IND.EthnicityID = ETH.ID
    INNER JOIN Education EDU 
        ON IND.EducationID = EDU.ID
    INNER JOIN Marital MAR 
        ON IND.Marital = MAR.ID
    INNER JOIN Participant-Probation PXP 
        ON PAR.ID = PXP.ParticipantID
    INNER JOIN Probation PBN 
        ON PXP.ProbationID = PBN.ID
    INNER JOIN Class-Participant CXP 
        ON PAR.ID = CXP.ParticipantID
    INNER JOIN Class CLS 
        ON CXP.ClassID = CLS.ID
    INNER JOIN Official OFR 
        ON PAR.ReferringPO = OFR.ID
    INNER JOIN Participant-Official PXO 
        ON PAR.ID = PXO.ParticipantID
    INNER JOIN Official OFA 
        ON PXO.OfficialID = OFA.ID 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T20:01:25.843

是的，MS-Access 是愚蠢的。

我认为不存在（从 MS-SQL/TSQL 到 MS-Access 的市场可能也不大）。通常，我使用设计视图，就我而言，它并不是真正的向导。然后我手动添加表，然后（如果我没有创建适当的关系船图，或者有些古怪）在设计器中手动创建关系。之后，我在 SQL 视图中检查查询并根据需要进行更正。

在您的示例中（如您所示），您可能需要括号，并且必须手动添加它们。你可能想要这样的东西：

```
SELECT ...
FROM (((Participant PAR
    INNER JOIN Individual IND 
        ON PAR.APETSID = IND.APETSID)
    INNER JOIN Ethnicity ETH 
        ON IND.EthnicityID = ETH.ID)
    INNER JOIN Education EDU 
        ON IND.EducationID = EDU.ID)
    INNER JOIN Marital MAR 
        ON IND.Marital = MAR.ID 
```

（如果您有 N 个内连接，则开头需要 N-1 个左括号，连接结束时需要一个左括号；不包括最后一个）

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T23:08:45.520

这适用于 Access。

```
SELECT *
FROM (((Individual AS IND 

INNER JOIN Ethnicity AS ETH 
    ON IND.EthnicityID = ETH.ID) 

INNER JOIN Education AS EDU 
    ON IND.EducationID = EDU.ID) 

INNER JOIN Marital AS MAR 
    ON IND.Marital = MAR.ID) 

INNER JOIN (((((((Participant AS PAR 

    INNER JOIN Official AS OFR 
        ON PAR.ReferringPO = OFR.ID) 

    INNER JOIN [Class-Participant] AS CXP 
        ON PAR.ID = CXP.ParticipantID) 

    INNER JOIN Class AS CLS 
        ON CXP.ClassID = CLS.ID) 

    INNER JOIN [Participant-Official] AS PXO 
        ON PAR.ID = PXO.ParticipantID) 

    INNER JOIN Official AS OFA 
        ON PXO.OfficialID = OFA.ID) 

    INNER JOIN [Participant-Probation] AS PXP 
        ON PAR.ID = PXP.ParticipantID) 

    INNER JOIN Probation AS PBN 
        ON PXP.ProbationID = PBN.ID) 

 ON IND.APETSID = PAR.APETSID 
```

如您所见，要连接的表被分组在一起。

# django - Django：想使用 loop.counter 为 Google Maps 标记分配字母

> ID：794662
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:24:13.347
> 
>         
> 
> 标签：django, google-maps, django-templates

我有可变数量的项目，介于 0 到 20 之间。

我想用谷歌静态地图列出这些，第一个显示一点“a”，第二个显示一个“b”，依此类推。

我是使用 Google App Engine 的新手，所以我被限制在 0.96（除非我使用各种补丁，我不想这样做。因为我是新手。）

```
&markers={% for item in results %}{{item.latitude}},{{item.longitude}}{% if not forloop.last %}|{% endif %}{% endfor %} 
```

可以很好地提供红色标记列表。  

```
&markers={% for item in results %}{{item.latitude}},{{item.longitude}},{{forloop.counter0}}{% if not forloop.last %}|{% endif %}{% endfor %} 
```

让我在地图上获得 0-9。

现在，我已将结果集减少到 10。我想回到 20。有没有使用循环计数器和切片的方法（如 {{ alpha_list|slice:":loop_counter"}} ？我在各种咒语中挣扎，在 loop_counter 周围尝试 {{ }} 并且没有并且无法让它工作。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:46:32.247

最简单的方法是编写模板标签。有一个[很好的 tut](http://codespatter.com/2009/01/22/how-to-write-django-template-tags/)，但代码基本上是：

```
def inttoalpha(n):
    a = ord('A')
    return chr(a+n) 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-05-14T04:25:59.120

如果你想完全在模板内完成，你可以使用[循环标签](http://docs.djangoproject.com/en/dev/ref/templates/builtins/?from=olddocs#cycle)。

类似于以下内容，带有 ... 扩展：

```
{% cycle 'a' 'b' ... 'z' as alphabet %}
&markers={% for item in results %}{{item.latitude}},{{item.longitude}},{% cycle alphabet %}{% if not forloop.last %}|{% endif %}{% endfor %} 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:01:28.230

使用此处提供的方法创建模板标签

[如何在 Python 中遍历字符串？](https://stackoverflow.com/questions/228730/how-do-i-iterate-through-the-alphabet-in-python)

# .net - .NET 将数字转换为字符串表示形式（1 到 1、2 到 2 等...）

> ID：794663
> 
>         
> 
> 赞同：31
> 
>         
> 
> 时间：2009-04-27T18:24:26.980
> 
>         
> 
> 标签：.net

.NET 中是否有内置方法可以将数字转换为数字的字符串表示形式？例如，1 变为 1，2 变为 2，等等。

* * *

## 回答 #1

> 赞同：49
> 
>             
> 
> 时间：2009-04-27T19:01:31.090

我一直是递归方法的粉丝

```
 public static string NumberToText( int n)
  {
   if ( n < 0 )
      return "Minus " + NumberToText(-n);
   else if ( n == 0 )
      return "";
   else if ( n <= 19 )
      return new string[] {"One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", 
         "Nine", "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", 
         "Seventeen", "Eighteen", "Nineteen"}[n-1] + " ";
   else if ( n <= 99 )
      return new string[] {"Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", 
         "Eighty", "Ninety"}[n / 10 - 2] + " " + NumberToText(n % 10);
   else if ( n <= 199 )
      return "One Hundred " + NumberToText(n % 100);
   else if ( n <= 999 )
      return NumberToText(n / 100) + "Hundreds " + NumberToText(n % 100);
   else if ( n <= 1999 )
      return "One Thousand " + NumberToText(n % 1000);
   else if ( n <= 999999 )
      return NumberToText(n / 1000) + "Thousands " + NumberToText(n % 1000);
   else if ( n <= 1999999 )
      return "One Million " + NumberToText(n % 1000000);
   else if ( n <= 999999999)
      return NumberToText(n / 1000000) + "Millions " + NumberToText(n % 1000000);
   else if ( n <= 1999999999 )
      return "One Billion " + NumberToText(n % 1000000000);
   else 
      return NumberToText(n / 1000000000) + "Billions " + NumberToText(n % 1000000000);
} 
```

[资源](http://www.dotnet2themax.com/blogs/fbalena/PermaLink,guid,cdceca73-08cd-4c15-aef7-0f9c8096e20a.aspx)

* * *

## 回答 #2

> 赞同：17
> 
>             
> 
> 时间：2009-04-27T18:28:52.837

啊，可能没有一个类可以做到这一点，但是有一个代码高尔夫问题，我提供了一个 C# 示例：

[代码高尔夫：数字到单词](https://stackoverflow.com/questions/309884/code-golf-number-to-words/408776#408776)

但是，它不是最容易阅读的，它只能达到 decimal.MaxValue，所以我编写了一个新版本，可以达到你需要的最高值。

我找不到任何有关高于 vigintillions 的值的信息，但如果将这些值附加到 thou[] 数组，则可以继续往上走。它仍然不支持分数，但我正在考虑在某个时候添加它。

```
 static string NumericStringToWords(string NumericValue)
    {
        if ("0" == NumericValue) return "zero";

        string[] units = { "one", "two", "three", "four", "five", 
                           "six", "seven", "eight", "nine" };

        string[] teens = { "eleven", "twelve", "thirteen", "four", "fifteen", 
                           "sixteen", "seventeen", "eighteen", "nineteen" };

        string[] tens = { "ten", "twenty", "thirty", "forty", "fifty", 
                          "sixty", "seventy", "eighty", "ninety" };

        string[] thou = { "thousand", "million", "billion", "trillion", 
                          "quadrillion", "quintillion", "sextillion", 
                          "septillion", "octillion", "nonillion", "decillion", 
                          "udecillion", "duodecillion", "tredecillion", 
                          "quattuordecillion", "quindecillion", "sexdecillion", 
                          "septendecillion", "octodecillion", "novemdecillion", 
                          "vigintillion" };

        string sign = String.Empty;
        if ("-" == NumericValue.Substring(0, 1))
        {
            sign = "minus ";
            NumericValue = NumericValue.Substring(1);
        }

        int maxLen = thou.Length * 3;
        int actLen = NumericValue.Length;
        if(actLen > maxLen)
            throw new InvalidCastException(String.Format("{0} digit number specified exceeds the maximum length of {1} digits.  To evaluate this number, you must first expand the thou[] array.", actLen, maxLen));

        //Make sure that the value passed in is indeed numeric... we parse the entire string
        //rather than just cast to a numeric type to allow us to handle large number types passed
        //in as a string.  Otherwise, we're limited to the standard data type sizes.
        int n; //We don't care about n, but int.TryParse requires it
        if (!NumericValue.All(c => int.TryParse(c.ToString(), out n)))
            throw new InvalidCastException();

        string fraction = String.Empty;
        if (NumericValue.Contains("."))
        {
            string[] split = NumericValue.Split('.');
            NumericValue = split[0];
            fraction = split[1];
        }

        StringBuilder word = new StringBuilder();
        ulong loopCount = 0;

        while (0 < NumericValue.Length)
        {
            int startPos = Math.Max(0, NumericValue.Length - 3);
            string crntBlock = NumericValue.Substring(startPos);
            if (0 < crntBlock.Length)
            {
                //Grab the hundreds tens & units for the current block
                int h = crntBlock.Length > 2 ? int.Parse(crntBlock[crntBlock.Length - 3].ToString()) : 0;
                int t = crntBlock.Length > 1 ? int.Parse(crntBlock[crntBlock.Length - 2].ToString()) : 0;
                int u = crntBlock.Length > 0 ? int.Parse(crntBlock[crntBlock.Length - 1].ToString()) : 0;

                StringBuilder thisBlock = new StringBuilder();

                if (0 < u)
                    thisBlock.Append(1 == t? teens[u - 1] : units[u - 1]);

                if (1 != t)
                {
                    if (1 < t && 0 < u) thisBlock.Insert(0, "-");
                    if (0 < t) thisBlock.Insert(0, tens[t - 1]);
                }

                if (0 < h)
                {
                    if (t > 0 | u > 0) thisBlock.Insert(0, " and ");
                    thisBlock.Insert(0, String.Format("{0} hundred", units[h - 1]));
                }

                //Check to see if we've got any data left and add
                //appropriate word separator ("and" or ",")
                bool MoreLeft = 3 < NumericValue.Length;
                if (MoreLeft && (0 == h) && (0 == loopCount))
                    thisBlock.Insert(0, " and ");
                else if (MoreLeft)
                    thisBlock.Insert(0, String.Format(" {0}, ", thou[loopCount]));

                word.Insert(0, thisBlock);
            }

            //Remove the block we just evaluated from the 
            //input string for the next loop
            NumericValue = NumericValue.Substring(0, startPos);

            loopCount++;
        }
        return word.Insert(0, sign).ToString();
    } 
```

我使用附加到自身的 Decimal.MaxValue 对其进行了测试，以生成大量：

7 octodecillion, 922 septendecillion, 816 sexdecillion, 251 quindecillion, 426 quattuordecillion, 433 tredecillion, 759 duodecillion, 3 154 十亿，三百九十五十亿，三十三非亿，五百七十九亿，二百二十八亿，一百六十二亿，五百零四亿，二百六十四万亿、三百三十七万亿、五千九百三十亿、五亿四千三百万、九十五万、三百三十五

* * *

## 回答 #3

> 赞同：12
> 
>             
> 
> 时间：2009-04-28T19:43:52.570

```
public string IntToString(int number)//nobody really uses negative numbers
{
    if(number == 0)
        return "zero";
    else
        if(number == 1)
            return "one";
        .......
        else
            if(number == 2147483647)
                return "two billion one hundred forty seven million four hundred eighty three thousand six hundred forty seven";
} 
```

* * *

## 回答 #4

> 赞同：7
> 
>             
> 
> 时间：2009-04-27T20:50:51.247

这是我使用的修改后的代码：

```
//Wrapper class for NumberToText(int n) to account for single zero parameter.
public static string ConvertToStringRepresentation(long number)
{
    string result = null;

    if (number == 0)
    {
        result = "Zero";
    }
    else
    {
        result = NumberToText(number);
    }

    return result;
}

//Found at http://www.dotnet2themax.com/blogs/fbalena/PermaLink,guid,cdceca73-08cd-4c15-aef7-0f9c8096e20a.aspx.
//Modifications from original source:
//  Changed parameter type from int to long.
//  Changed labels to be singulars instead of plurals (Billions to Billion, Millions to Million, etc.).
private static string NumberToText(long n)
{
    if (n < 0)
        return "Minus " + NumberToText(-n);
    else if (n == 0)
        return "";
    else if (n <= 19)
        return new string[] {"One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", 
                                "Nine", "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", 
                                "Seventeen", "Eighteen", "Nineteen"}[n - 1] + " ";
    else if (n <= 99)
        return new string[] {"Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", 
                                "Eighty", "Ninety"}[n / 10 - 2] + " " + NumberToText(n % 10);
    else if (n <= 199)
        return "One Hundred " + NumberToText(n % 100);
    else if (n <= 999)
        return NumberToText(n / 100) + "Hundred " + NumberToText(n % 100);
    else if (n <= 1999)
        return "One Thousand " + NumberToText(n % 1000);
    else if (n <= 999999)
        return NumberToText(n / 1000) + "Thousand " + NumberToText(n % 1000);
    else if (n <= 1999999)
        return "One Million " + NumberToText(n % 1000000);
    else if (n <= 999999999)
        return NumberToText(n / 1000000) + "Million " + NumberToText(n % 1000000);
    else if (n <= 1999999999)
        return "One Billion " + NumberToText(n % 1000000000);
    else
        return NumberToText(n / 1000000000) + "Billion " + NumberToText(n % 1000000000);
} 
```

* * *

## 回答 #5

> 赞同：6
> 
>             
> 
> 时间：2009-11-07T01:56:24.843

这个线程是一个很大的帮助。我最喜欢 Ryan Emerle 的解决方案，因为它很清晰。这是我的版本，我认为它使结构清晰：

```
public static class Number
{
    static string[] first =
    {
        "Zero", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine",
        "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen",
        "Seventeen", "Eighteen", "Nineteen"
    };
    static string[] tens =
    {
        "Twenty", "Thirty", "Fourty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety",
    };

    /// <summary>
    /// Converts the given number to an english sentence.
    /// </summary>
    /// <param name="n">The number to convert.</param>
    /// <returns>The string representation of the number.</returns>
    public static string ToSentence(int n)
    {
        return n == 0 ? first[n] : Step(n);
    }
    // traverse the number recursively
    public static string Step(int n)
    {
        return n < 0            ? "Minus " + Step(-n):
               n == 0           ? "":
               n <= 19          ? first[n]:
               n <= 99          ? tens[n / 10 - 2] + " " + Step(n % 10):
               n <= 199         ? "One Hundred " + Step(n % 100):
               n <= 999         ? Step(n / 100) + "Hundred " + Step(n % 100):
               n <= 1999        ? "One Thousand " + Step(n % 1000):
               n <= 999999      ? Step(n / 1000) + "Thousand " + Step(n % 1000):
               n <= 1999999     ? "One Million " + Step(n % 1000000):
               n <= 999999999   ? Step(n / 1000000) + "Million " + Step(n % 1000000):
               n <= 1999999999  ? "One Billion " + Step(n % 1000000000):
                                  Step(n / 1000000000) + "Billion " + Step(n % 1000000000);
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
>             
> 
> 时间：2013-08-28T16:26:32.850

基于 Ryan Emerle 的解决方案，这会在正确的位置添加破折号，不包括尾随空格，不复数，并正确处理零 (0) 的输入：

```
public static string ToText(long n) {
    return _toText(n, true);
}
private static string _toText(long n, bool isFirst = false) {
    string result;
    if(isFirst && n == 0) {
        result = "Zero";
    } else if(n < 0) {
        result = "Negative " + _toText(-n);
    } else if(n == 0) {
        result = "";
    } else if(n <= 9) {
        result = new[] { "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine" }[n - 1] + " ";
    } else if(n <= 19) {
        result = new[] { "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen" }[n - 10] + (isFirst ? null : " ");
    } else if(n <= 99) {
        result = new[] { "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety" }[n / 10 - 2] + (n % 10 > 0 ? "-" + _toText(n % 10) : null);
    } else if(n <= 999) {
        result = _toText(n / 100) + "Hundred " + _toText(n % 100);
    } else if(n <= 999999) {
        result = _toText(n / 1000) + "Thousand " + _toText(n % 1000);
    } else if(n <= 999999999) {
        result = _toText(n / 1000000) + "Million " + _toText(n % 1000000);
    } else {
        result = _toText(n / 1000000000) + "Billion " + _toText(n % 1000000000);
    }
    if(isFirst) {
        result = result.Trim();
    }
    return result;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2014-06-03T14:13:00.870

中没有内置解决方案`.net`，但周围有很好的库。目前最好的肯定是[Humanizr](http://humanizr.net/)：

```
Console.WriteLine(794663.ToWords()); // => seven hundred and ninety-four thousand six hundred and sixty-three 
```

它还支持序数和罗马表示：

```
Console.WriteLine(794663.ToOrdinalWords()); // => seven hundred and ninety-four thousand six hundred and sixty third
Console.WriteLine(794.ToRoman()); // => DCCXCIV 
```

* * *

`Humanizr``string`也有关于,`DateTime`等的各种工具`TimeSpan`。

```
Console.WriteLine(794.Seconds().Humanize().Underscore().Hyphenate()); // => 13-minutes 
```

* * *

## 回答 #8

> 赞同：2
> 
>             
> 
> 时间：2013-02-10T17:50:23.223

这是我对第一个答案的改进版本。我希望它有用。

```
/// <summary>
/// Converts an <see cref="int"/> to its textual representation
/// </summary>
/// <param name="num">
/// The number to convert to text
/// </param>
/// <returns>
/// A textual representation of the given number
/// </returns>
public static string ToText(this int num)
{
    StringBuilder result;

    if (num < 0)
    {
        return string.Format("Minus {0}", ToText(-num));
    }

    if (num == 0)
    {
        return "Zero";
    }

    if (num <= 19)
    {
        var oneToNineteen = new[]
        {
            "One",
            "Two",
            "Three",
            "Four",
            "Five",
            "Six",
            "Seven",
            "Eight",
            "Nine",
            "Ten",
            "Eleven",
            "Twelve",
            "Thirteen",
            "Fourteen",
            "Fifteen",
            "Sixteen",
            "Seventeen",
            "Eighteen",
            "Nineteen"
        };

        return oneToNineteen[num - 1];
    }

    if (num <= 99)
    {
        result = new StringBuilder();

        var multiplesOfTen = new[]
        {
            "Twenty",
            "Thirty",
            "Forty",
            "Fifty",
            "Sixty",
            "Seventy",
            "Eighty",
            "Ninety"
        };

        result.Append(multiplesOfTen[(num / 10) - 2]);

        if (num % 10 != 0)
        {
            result.Append(" ");
            result.Append(ToText(num % 10));
        }

        return result.ToString();
    }

    if (num == 100)
    {
        return "One Hundred";
    }

    if (num <= 199)
    {
        return string.Format("One Hundred and {0}", ToText(num % 100));
    }

    if (num <= 999)
    {
        result = new StringBuilder((num / 100).ToText());
        result.Append(" Hundred");
        if (num % 100 != 0)
        {
            result.Append(" and ");
            result.Append((num % 100).ToText());
        }

        return result.ToString();
    }

    if (num <= 999999)
    {
        result = new StringBuilder((num / 1000).ToText());
        result.Append(" Thousand");
        if (num % 1000 != 0)
        {
            switch ((num % 1000) < 100)
            {
                case true:
                    result.Append(" and ");
                    break;
                case false:
                    result.Append(", ");
                    break;
            }

            result.Append((num % 1000).ToText());
        }

        return result.ToString();
    }

    if (num <= 999999999)
    {
        result = new StringBuilder((num / 1000000).ToText());
        result.Append(" Million");
        if (num % 1000000 != 0)
        {
            switch ((num % 1000000) < 100)
            {
                case true:
                    result.Append(" and ");
                    break;
                case false:
                    result.Append(", ");
                    break;
            }

            result.Append((num % 1000000).ToText());
        }

        return result.ToString();
    }

    result = new StringBuilder((num / 1000000000).ToText());
    result.Append(" Billion");
    if (num % 1000000000 != 0)
    {
        switch ((num % 1000000000) < 100)
        {
            case true:
                result.Append(" and ");
                break;
            case false:
                result.Append(", ");
                break;
        }

        result.Append((num % 1000000000).ToText());
    }

    return result.ToString();
} 
```

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:28:33.740

*[从整数到长格式英语的转换...我可以这样写 ;-)](http://weblogs.asp.net/justin_rogers/archive/2004/06/09/151675.aspx)*是关于该主题的一篇非常好的文章：

```
using System;

public class NumberToEnglish {
    private static string[] onesMapping =
        new string[] {
            "Zero", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine",
            "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"
        };
    private static string[] tensMapping =
        new string[] {
            "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"
        };
    private static string[] groupMapping =
        new string[] {
            "Hundred", "Thousand", "Million", "Billion", "Trillion"
        };

    private static void Main(string[] args) {
        Console.WriteLine(EnglishFromNumber(long.Parse(args[0])));
    }

    private static string EnglishFromNumber(int number) {
        return EnglishFromNumber((long) number);
    }

    private static string EnglishFromNumber(long number) {
        if ( number == 0 ) {
            return onesMapping[number];
        }

        string sign = "Positive";
        if ( number < 0 ) {
            sign = "Negative";
            number = Math.Abs(number);
        }

        string retVal = null;
        int group = 0;
        while(number > 0) {
            int numberToProcess = (int) (number % 1000);
            number = number / 1000;

            string groupDescription = ProcessGroup(numberToProcess);
            if ( groupDescription != null ) {
                if ( group > 0 ) {
                    retVal = groupMapping[group] + " " + retVal;
                }
                retVal = groupDescription + " " + retVal;
            }

            group++;
        }

        return sign + " " + retVal;
    }

    private static string ProcessGroup(int number) {
        int tens = number % 100;
        int hundreds = number / 100;

        string retVal = null;
        if ( hundreds > 0 ) {
            retVal = onesMapping[hundreds] + " " + groupMapping[0];
        }
        if ( tens > 0 ) {
            if ( tens < 20 ) {
                retVal += ((retVal != null) ? " " : "") + onesMapping[tens];
            } else {
                int ones = tens % 10;
                tens = (tens / 10) - 2; // 20's offset

                retVal += ((retVal != null) ? " " : "") + tensMapping[tens];

                if ( ones > 0 ) {
                    retVal += ((retVal != null) ? " " : "") + onesMapping[ones];
                }
            }
        }

        return retVal;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2014-09-11T08:02:13.563

Another naasking, version in VB.NET if any one is interested! Had to use the floor function to round  properly..

```
 Public Function NumberToText(n As Integer) As String
        Dim a As String() = {"One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"}
        Dim tens As String() = {"Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy",
         "Eighty", "Ninety"}

        If (n < 0) Then
            Return "Minus " + NumberToText(-n)
        ElseIf (n = 0) Then
            Return ""
        ElseIf (n <= 19) Then
            Return a(n - 1) + " "
        ElseIf (n <= 99) Then
            Return tens(Math.Floor(n / 10) - 2) + " " + NumberToText(n Mod 10)
        ElseIf (n <= 199) Then
            Return "One Hundred " + NumberToText(n Mod 100)
        ElseIf (n <= 999) Then
            Return NumberToText(Math.Floor(n / 100)) + "Hundreds " + NumberToText(n Mod 100)
        ElseIf (n <= 1999) Then
            Return "One Thousand " + NumberToText(n Mod 1000)
        ElseIf (n <= 999999) Then
            Return NumberToText(Math.Floor(n / 1000)) + "Thousands " + NumberToText(n Mod 1000)
        ElseIf (n <= 1999999) Then
            Return "One Million " + NumberToText(n Mod 1000000)
        ElseIf (n <= 999999999) Then
            Return NumberToText(Math.Floor(n / 1000000)) + "Millions " + NumberToText(n Mod 1000000)
        ElseIf (n <= 1999999999) Then
            Return "One Billion " + NumberToText(n Mod 1000000000)
        Else
            Return NumberToText(Math.Floor(n / 1000000000)) + "Billions " + NumberToText(n Mod 1000000000)
        End If

    End Function 
```

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2015-05-08T17:18:27.213

这是基于此处发布的一些想法的更完整/改进的解决方案。包括语法/连字符修复，以及可选的大写、长期支持、对零的支持，但仍然非常简洁（VB.Net）：

```
Function NumberToCapitalizedWords(ByVal n As Long) As String
    Return New System.Globalization.CultureInfo("en-US", False).TextInfo.ToTitleCase(NumberToWords(n))
End Function

Function NumberToWords(ByVal n As Long) As String
    Return LTrim(NumberToWords(n, False, False))
End Function

Function NumberToWords(ByVal n As Long, ByVal recursed As Boolean, ByVal iesLast As Boolean) As String
    If (n < 0) Then
        Return "negative" + NumberToWords(-n, False, False)
    ElseIf (n = 0) Then
        If recursed Then
            Return ""
        End If
        Return "zero"
    ElseIf (n < 20) Then
        Return If(iesLast, "-", " ") + New String() {"one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen"}(n - 1)
    ElseIf (n < 100) Then
        Return " " + New String() {"twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety"}(n \ 10 - 2) + NumberToWords(n Mod 10, True, True)
    ElseIf (n < 1000) Then

        Return NumberToWords(n \ 100, True, False) + " hundred" + NumberToWords(n Mod 100, True, False)
    Else
        Dim log1000 As Integer = Math.Floor(Math.Log(n, 1000))
        Return NumberToWords(n \ PowerNoFloat(1000, log1000), True, False) + " " + New String() {"thousand", "million", "billion", "trillion", "quadrillion", "quintillion"}(log1000 - 1) + NumberToWords(n Mod PowerNoFloat(1000, log1000), True, False)
    End If

End Function

Function PowerNoFloat(ByRef base As Long, ByRef power As Integer) As Long
    If power < 0 Then
        Return 0
    End If
    Dim result As Long = 1
    For i As Integer = 1 To power
        result *= base
    Next
    Return result
End Function 
```

# asp.net - CSS div位置问题

> ID：794668
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:26:18.240
> 
>         
> 
> 标签：asp.net, css, html, master-pages

我有一个基于 css 的 asp.net 母版页。我正在使用位于导航 div 正上方的浏览 div。浏览 div 在导航 div 后面向下流动。我对该位置进行了一些尝试，发现如果我更改导航位置，它会修复它，但是该 div 中的所有内容都会移动到页面的一半。我做了一些谷歌搜索，但找不到任何关于如何强制 div 始终位于顶部的信息。如果您需要更多信息，我可以提供。

我在下面粘贴了部分 CSS 代码：

```
#header2 {
height: 2.5em;
border-bottom: 1px dashed #0055a5;
color: #FFF;
background-color: white;
}

#header2 .browse {
color: #000000;
background-color: transparent;
float: left;
margin-left: 1em;
margin-top: .1em;
font-weight:bold;
font-style: normal;
font-variant: normal;
font-size: 70%;
line-height: normal;
font-family: Arial, Helvetica, Georgia, "Times New Roman", Times, serif;
width: 144px;
position: fixed;    
}

#navigation 
{
background-color: white;
width: 200px;
height:100%;
top: 105px;
left: 0em;
width: 13em;    
position: absolute;
font-family: Arial, Helvetica, sans-serif;
font-size:90%;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:03:04.360

顶部是指视口的顶部，还是堆栈的顶部（即 z-index？）。

如果您的意思是视口的顶部，请尝试 position:fixed;

编辑，再读一遍，我想你的意思是 z-index。将要保留在顶部的元素的位置（浏览？）设置为相对，然后将 z-index 设置为 100 之类的值，即

```
position:relative;z-index:100; 
```

这应该够了吧。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:33:38.223

如果您希望它固定在页面的最顶部，您可以尝试`top: 0;`在`.browse`类上进行设置。还要查看它是垂直居中放置的实际`<div>`标签，还是只是它的内容。

我敢打赌，如果你使用[firebug](http://addons.mozilla.org/en-US/firebug/addon/1843) ，你会节省一些试验时间——如果你还没有，那就去买吧 =)

# css - CSS - 悬停时带有底部边框的目标文本链接，但没有边框的图像链接

> ID：794677
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-04-27T18:27:56.707
> 
>         
> 
> 标签：css

我希望能够在悬停时使用边框底部定位 CSS 中的文本链接，但所有图像链接在悬停时都没有边框。所以：

```
<a href="#"><img src="image.png"  /></a>  ==> this should not have a bottom-border on hover
<a href="#">regular text link</a> ==> this should have a bottom-border on hover 
```

我试过这个CSS：

```
#sidebar a:hover {
  border-bottom: 1px dotted red;
}
#sidebar a:hover img {
  border-bottom: none;
} 
```

但这不起作用……我认为，锚点必须是目标而不是图像。我一直在谷歌周围寻找，似乎没有人知道如何做到这一点，除非通过使用特定类或 id 来定位图像链接，或者使用 display:block。  

但是，我不能使用这些解决方案，因为内容在 CMS 中，所以我不希望用户必须为他们插入的每个图像分配一个类。并且 display:block 不起作用，因为我不知道这是否适合用户想要显示的每张图像。  

最后，我希望能够在纯 CSS（无 Javascript）中做到这一点。也许没有办法......但是您的任何帮助或想法将不胜感激！

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2010-01-02T21:23:34.577

就 JavaScript 而言，我建议使用[jQuery](http://www.jquery.com/)为所有包含图像的链接添加一个类：

```
$('#sidebar a:has(img)').addClass('image-link'); 
```

（`:has`选择器是 jQuery 的东西；它不存在于 CSS 中。）

然后相应地调整您的样式表。

```
#sidebar a:hover {
  border-bottom: 1px dotted red;
}
#sidebar a.image-link:hover {
  border-bottom: none;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:03:57.447

您不能根据元素具有的子元素来定位元素，因此您必须在代码中添加一些内容以定位不同的链接。

你不能用下划线代替底边吗？这将起作用，因为它应用于链接中的文本而不是链接元素本身。

```
#sidebar a:hover { text-decoration: underline; }
#sidebar a:hover img { text-decoration: none; } 
```

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:05:20.627

抱歉，您想要的是某种 :parent 伪类，它选择子类但适用于父类，不幸的是它不存在（即使在 CSS3 中也不存在）。

您必须做一些 Javascript，选择所有匹配**#sidebar a:hover 的**元素，然后在它们没有子 IMG 元素的情况下应用红色底部边框。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:51:33.700

这可能有效

```
a img {position:relative; top: Npx}, where N is the hover border thickness 
```

这将使图像覆盖边界，尽管它会向下移动一个像素左右。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2010-01-02T21:11:44.257

试试这个技巧。有用。

```
a { text-decoration:none; border-bottom:2px solid; }

a img { border:none; vertical-align:top; } 
```

另一种方式 - PHP：

```
$text = preg_replace('#<a(.*?)<img(.*?)/>(.*?)</a>#is', "<a class='imgshow' \\1 <img\\2 />\\3</a>", $text); 
```

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2010-11-11T15:04:13.160

它可能与 css3 using 一起使用`a:not(img) a:hover {style:whatever;}`，但有一些注意事项。这是一个带有图像的解释：http: [//nerdinprogress.blogspot.com/2010/11/target-text-links-but-not-images-with.html](http://nerdinprogress.blogspot.com/2010/11/target-text-links-but-not-images-with.html)

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2012-01-16T21:03:54.667

简单的方法是使用  

```
:hover (text-decoration: underline} 
```

另见  

```
text-underline-position 
```

[http://dev.w3.org/csswg/css3-text/#text-underline-position0](http://dev.w3.org/csswg/css3-text/#text-underline-position0)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:59:10.750

这在不添加新标签的情况下使用纯 CSS 是不可能的。为了使用纯 CSS/HTML 执行此操作，您需要将标签添加到图像的 [a href] 链接.. 或将标签添加到要显示带下划线的 [a hrer] 链接。

您可以在 javascript 中编写一小段代码，它可以很容易地改变悬停时元素的边框属性。您只需要检查元素是否为 IMG。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:00:00.857

这实际上似乎是一个相当困难的问题。您是否有能力更改 CMS 的代码？如果您可以做一些事情，例如`<span>`在链接内的任何文本周围环绕（并将图像留在链接之外），这将变得很容易。那么你所要做的就是`#sidebar a:hover span`拥有边界。

如果您无法更改代码，我不确定这是否可能。我肯定什么都想不出来。

# asp.net - ASP.net MVC 中的 ASP.net AJAX 有什么意义？

> ID：794678
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-04-27T18:27:57.487
> 
>         
> 
> 标签：asp.net, asp.net-mvc

所以 ASP.net MVC 默认附带 JQuery 和 ASP.net Ajax。虽然 JQuery 的用例很明显而且很多，但我只是想知道 ASP.net Ajax 的意义何在？如果我只是让我的控制器操作返回 JSON，我不需要它吗？此外，任何“旧”的 ASP.net 控件只有在您使用 Webforms 视图引擎时才有效（我想我想使用另一个，但这不是重点）。

ASP.net Ajax 在 MVC 环境中提供什么？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:32:32.233

熟悉使用 ASP.NET AJAX 的人。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:33:19.207

ASP.NET AJAX 与 JQuery 有点不同，它是一个大型库，允许您像在典型的 .NET 编程中一样使用名称相似的 API。你有更多的字符串函数等等。话虽如此，我通常完全绕过 ASP.NET AJAX，并在 JQuery 和其他较小的库中找到我需要的大部分内容。ASP.NET AJAX 对我来说有点重，但它确实有它的用途。

# .net - 继承自 List(of T) 类的问题

> ID：794679
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-04-27T18:28:01.683
> 
>         
> 
> 标签：.net, vb.net, inheritance, list

我想实现一个优先队列类。当以更高的优先级添加项目时，它将被推到队列的前面，而不是添加到队列的末尾。

简单的几行代码

```
Public Class PriorityQueue(Of T)
    Inherits List(Of T)

    Private _list As New List(Of T)

    Public Sub Enque(ByVal item As T, Optional ByVal pushToFront As Boolean = False)
        If pushToFront = True Then
            _list.Insert(0, item)
        Else
            _list.Add(item)
        End If
    End Sub
    Public Function Deque() As T
        If _list.Count <> 0 Then
            Dim item As T = _list(0)
            _list.RemoveAt(0)
            Return item
        Else
            Throw New InvalidOperationException
        End If
    End Function
   End Class 
```

* * *

现在调用函数试图找到队列中的元素，因此......

```
dim _q as new PriorityQueue(Of integer)
_q.Enque(1)
_q.Enque(2)
msgbox(_q.Count()) 
```

......

程序打印出 0！如果添加一个 Count() 属性，那么一切都很好。我原以为继承的类应该调用基类的 Count 函数。请注意，即使我在派生类中没有实现，计数也会显示在智能感知中。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-04-27T18:34:59.310

您的问题是您都继承自`List(of T)`并且您拥有该类型的实例属性，这是您存储数据的位置。当`Count`在您的上述代码中调用时，它使用的`Count`是您的 parent 的属性`List(of T)`，这不是您存储数据的位置。

一个更好的主意是让您继承`object`并明确地实现`PriorityQueue(of T)`。你根本不需要改变你的内部实现，你只需要添加代码来支持这些接口。`ICollection``IEnumerable(of T)`

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:33:48.643

您将项目添加到私人列表实例 (_list.Insert / _list.Add) 而不是基本列表 (Me.Insert / Me.Add)

实际上，我认为像您一样使用私有列表，并且添加 Count 属性是比从 List 继承更好的设计。

正如 Adam Robinson 指出的那样，如果您希望您的类的用户能够（例如）遍历队列中的项目，您可以考虑实现部分或全部 IEnumerable<T>、ICollection<T>、ICollection、IEnumerable。  

如果您的调用者仅将其用作队列（调用 Enqueue 或 Dequeue），则这不是绝对必要的。  

标准队列类 Queue<T> 实现了 IEnumerable<T>、ICollection 和 IEnumerable，至少实现这些对一致性有好处。

# c# - 您可以使用 ARP-Poisoning（欺骗）来应用模拟的外部效果吗？

> ID：794687
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-04-27T18:29:21.227
> 
>         
> 
> 标签：c#, networking, spoofing, arp

我们正在研究创建网络效果服务器的方法。我的意思是一个中央服务器，它将检查网络上的所有数据包并根据实际网络之外的因素（例如天气和视线）应用逻辑（丢弃、延迟、更改等）。

这与运行多个现实世界实体的模拟有关：网络中的物理节点将代表 3D 虚拟世界中的 3D 移动实体。正如我所提到的，将根据节点的“虚拟世界位置”之间的视线、距离、干扰等计算效果。

我知道其他工具可以让您执行此类效果（例如 OPNET，我们可能会将其用作解决方案的一部分），但它们通常要求您将数据直接路由到它们进行处理。它们也不处理 UDP 或 TCP。

*我需要一种方法来透明地运行我们的服务器并应用效果，而无需为 UDP 和 TCP 更改任何现有软件（无论如何有些软件无法更改）。*

在这种情况下，我们正在考虑使用 ARP 中毒（或欺骗，无论您喜欢如何称呼它）来强制所有流量通过这些服务器中的一个（或潜在的多个用于负载平衡）来执行数据包整形。

> 这是一种可行的方法吗？（不想在意识到有太多障碍或完全不可能之前花费数周时间进行开发）
> 
> 如果可行，[RFC826](https://www.rfc-editor.org/rfc/rfc826)（加上[5227](https://www.rfc-editor.org/rfc/rfc5227)和[5494](https://www.rfc-editor.org/rfc/rfc5494)）是 ARP 的最新文档吗？那里有更好的文件吗？
> 
> 当某些网络节点是虚拟机（它们可能被桥接或 NAT'ed）时，这会起作用吗？
> 
> 是否有任何库可以让您在 C# 中执行此操作？

（我们对我们使用的语言持开放态度，但可能更喜欢基于 C# 或 Qt 的解决方案）

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-05-04T03:07:27.110

从技术上讲，您可以使用 ARP 中毒来做到这一点，但我真的不认为我会推荐它。我真的不明白你为什么要这样做，但从它的声音来看，你正在寻找模拟可能由射频设备引起的数据包丢失/损坏的类型。

首先，您提到了 C#，它确实不是用于执行此操作的语言，低级网络距离太远了。我认为 C# 确实提供了一个原始套接字类，但是如果您尝试模拟 TCP/IP 和 UDP 并且欺骗地址不属于您的主机，它实际上会丢弃您的数据包。可能有办法阻止这种情况，但您必须研究 .Net Raw Socket。

您也可以将 WinPcap 与 ac# 包装器一起使用。但它仍然不是本机实现，可能会遭受性能损失。有一个用于 WinPcap 的 C# 包装器，我使用它称为[SharpPcap](http://sourceforge.net/projects/sharppcap/)，但是有些部分没有很好地实现，我必须根据需要对其进行修改。我已经做了一些简单的测试以捕获 300Mbps 的流量，但这不包括任何协议分析或将数据包注入网络。这也可以用于将数据包放回网络上，但在过去，这也是众所周知的低性能。我的网络同行普遍认为，如果没有硬件支持 Gbps 速度，就无法完成此类检查。

我看到你注意到你控制着路由器和实验室。我不知道思科是否对此功能有最低要求，但您可以将静态路由指向接口。因此，如果您将拦截服务器从路由器的一个端口挂起，并为每台主机设置路由以访问您的拦截服务器，它可能会接收通过路由器路由的所有流量。您可以通过将接口定义为下一跳而不是 IP 地址来实现此目的。

*请注意 Bob McCormick 的注释，它只会影响不同子网上的主机，但是有一个简单的作弊方法，在每台主机（如果分配了静态 IP 地址）上，将子网掩码设置为 /32（即 255.255.255.255）。这实质上将强制主机发送所有要由路由器路由的帧，因为它不再知道与自己在同一网络上的任何其他用户。

最后一个警告是我不知道这是否可以在虚拟机中工作。我认为如果您在 vmware 中使用一种类型的网络接口，它会，但我没有尝试过，并且不知道其他虚拟机提供商。

但是，如果您正在做这个级别的工作，我建议您再次考虑使用 linux 作为您发送的主机，您也可以使用 Bob McCormick 推荐的工具。但是，在 linux 中，我确信可以设置大量工具来模拟您正在寻找的此类事件。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:35:21.197

我不是 ARP 中毒方面的专家，但我相信要可靠且一致地实现其效果，您需要路由器的同意。我的意思不是在合法性方面同意，而是同意路由器实际上会将您设置为网络上所有设备的中间人。  

有这种可能吗？

**编辑：**  由于您控制网络，我认为您根本不需要 ARP 中毒。我不确定您的地形是什么样的，但对于中小型设置，我会从 CISCO 或同等设备切换并研究将 linux 机器作为路由器运行。然后根据需要丢弃/延迟/更改数据包所需的任何脚本。Linux而不是Cisco的决定可能有点棘手，我不是专家，但对于一个小型实验室来说，这应该不是任何问题。  

我个人使用shorewall（iptables的前端）来分割我的网络并在段之间丢弃/拒绝/允许数据包。将其连接到使用由外部因素控制的脚本将是很多 iptables 工作以动态添加和删除规则，但肯定是可行的。

**免责声明**：我从未使用过 Cisco 设备，所以我不知道它们具有哪些高级功能。也许他们能够运行这样的高级逻辑，如果是这样，那就更好了——我只是假设他们没有。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-05-02T03:12:20.453

欺骗永远不会是可靠的。这基本上是您与您正在欺骗的 IP 地址的合法所有者之间的竞赛。  

请注意，任何涉及使用路由器的配置，例如使用 linux 路由器的建议等，*只会*让您影响不同子网上的主机之间的流量。  

如果这对您有用，我可以建议您从Linux 内核中的 Netem 功能（ [http://www.linuxfoundation.org/en/Net:Netem ）开始吗？](http://www.linuxfoundation.org/en/Net:Netem)Netem 将允许您控制 Linux 内核转发的任何数据包的带宽、延迟、抖动、数据包重新排序等。我已经多次使用它来模拟 Cisco 路由器之间的 WAN 特性以测试 QOS 配置。

# biztalk - BizTalk 映射到 Excel

> ID：794688
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:29:26.313
> 
>         
> 
> 标签：biztalk

有没有办法将 BizTalk 映射转换或获取映射到 excel 或文本文件。从那里我们可以直接看到哪个字段映射到哪个字段，而不是按照线条。我有一个 BizTalk 地图，其中映射了大约 600 个字段。

任何指示都会非常有帮助。

编辑：我尝试解决我的问题：[http ://bmc.codeplex.com/](http://bmc.codeplex.com/)

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:51:11.660

您可以[在此处查看](http://www.codeplex.com/BizTalkDocumenter)BizTalk 文档器，该文档器将为许多 BizTalk 工件（包括地图）提供帮助样式的文档。您也可以只使用文本编辑器查看创建的 XSLT，但地图如此庞大，可能是一项艰巨的任务。我听说一些开发人员在那里创建了自己的 XSLT 来将地图 XSLT 转换为类似格式的表格，但我无法立即找到任何代码。我会四处寻找，看看我是否也能找到另一种方法。

你也可以看[这里](http://www.soft-r-us.com/biz/doc/display.asp?state=2)，但老实说我以前没有使用过它，所以它输出的风险由你自己承担。  

-布莱恩

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:44:18.110

XSLT 不是一种可以在电子表格中很好地表示的表格格式。简单的映射是可能的，但是任何时候创建转换或将多个字段连接到一个，或者一个拆分为多个，它就会变得混乱。

如果它是一个简单的映射，那么将 XSLT 转换为 CSV 格式的脚本可能是最容易将其导入 Excel 的。除非您想将其加载到 DOM 中并使用 Excel 对象直接构建它。除非这不是一次性的事情，否则这可能是矫枉过正。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-22T03:56:00.393

创建了一个小型应用程序，它将解析我的 BTM 文件并给我一个包含所有映射的 excel 文件。将相同的内容上传到[http://bmc.codeplex.com/](http://bmc.codeplex.com/)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2016-02-24T10:39:34.347

在 MS Excel 中打开您的 xsl 文件。它将要求转换为 xml。然后按**是**，就完成了。

# c# - 使用泛型约束 VS 显式类型声明的参数类型

> ID：794692
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:30:18.683
> 
>         
> 
> 标签：c#, .net, generics

这两个看似相似的声明之间有什么区别？

你什么时候会选择一种语法而不是另一种？

有什么特别的理由选择其中一个吗？

任何一种情况都会招致任何性能处罚？

```
public void Import<T>(
    Func<IEnumerable<T>> getFiles, Action<T> import)
        where T : IFileInfo
{
        // Import files retrieved through "getFiles"
}

public void Import(
        Func<IEnumerable<IFileInfo>> getFiles, Action<IFileInfo> import)
{
        // Import files retrieved through "getFiles"
} 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T18:35:59.450

不同之处在于，第一个允许您传入使用更具体类型实现的东西`IFileInfo`。例如：

```
Func<IEnumerable<SpecialFileInfo>> lister = () => ListFiles();
Import(lister, file => Console.WriteLine(file.SpecialProperty)); 
```

（where `SpecialProperty`is a property which exists on `SpecialFileInfo`but not `IFileInfo`。）你不能用后一种形式做到这一点。

泛型方法和类型有一个非常轻微的执行时间损失 - 对于不同的每个值类型`T`类型参数（不要忘记值类型可以实现`IFileInfo`）和所有引用类型（即一旦它被 JITted），它将被 JIT 一次或一种引用类型，它不需要再次 JITted）。不过，这几乎可以肯定在您的实际应用程序中可以忽略不计。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:04:07.290

尽管已经回答了这个问题：也许您想采用限制较少的解决方案：

```
public void Import<T,S>(
        Func<IEnumerable<S>> getFiles, Action<T> import)
            where T : IFileInfo
            where S : T
    {
            // Import files retrieved through "getFiles"
    } 
```

这个允许传递an`Action<IFileInfo>`和 an 。`Func<IEnumerable<ConcreteFileInfo>>`

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:33:36.693

没有任何运行时性能损失——这一切都由编译器在为您的代码生成 IL 时处理。

至于语法，我认为第二个更清楚地表明您只对 IFileInfo 接口感兴趣。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:34:46.957

在这种情况下，没有太大区别，但是假设您想进一步限制它，例如您希望 T 具有默认的无参数构造函数。您只能通过第一种方式进行操作：

```
public void Import<T>(
        Func<IEnumerable<T>> getFiles, Action<T> import)
            where T : IFileInfo, new()
    {
            // Import files retrieved through "getFiles"
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:35:12.617

您不会注意到函数方面的差异，但您可以在调用方看到差异。

```
public class MyFileInfo : IFileInfo
{
  public string MyString { get; set; }
}

Import<MyFileInfo>(files,
                   (mfi) => Console.WriteLine("Import {0}", mfi.MyString)); 
```

# version-control - 版本控制的创意用途

> ID：794697
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-04-27T18:31:40.160
> 
>         
> 
> 标签：version-control

[我正在为Version Control](http://en.wikipedia.org/wiki/Revision_control)寻找创造性的——或者至少是非标准的——用途。我有一个特定的目的，但我不想用任何限制来扼杀你的创造性思维。

为此，不要仅仅因为我说创意/非标准就取消 VCS 处理源代码的创造性使用：这并不意味着它不能处理源代码。这只是意味着我正在寻找分支、合并、标记、回滚和分叉以外的想法。

**例如：**我认为使用版本控制作为一种快速而肮脏的[SharePoint](http://www.microsoft.com/sharepoint/)仿制品是一个可以接受的答案，但只是勉强。

你还见过哪些有趣的用途？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-04-27T18:39:01.203

我使用 SVN 来管理我的照片。这比拥有一堆“另存为”副本要好得多。另外，我的技术倾向的家庭成员可以从 TRUNK 分支获得最新的照片……效果很好。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:42:55.640

个人日记，或[作家/小说家](http://www.ryumaou.com/hoffman/netgeek/2008/07/version-control-for-writers/)。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T18:53:50.250

请参阅将[Git 用于非预期用途](http://thread.gmane.org/gmane.comp.version-control.git/110411)[原文如此] 竞赛。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-04-30T13:18:33.120

我使用 SVN 托管照片。

但不是相册，只是我发布到论坛、通过 IM 发送等的图片。

通过这种方式，我以后可能总是会修复图片，从颜色调整到替换为 10 000 x 10 000 闪烁的 GIF 以将提到的论坛分开（从来没有这样做过，但是......）

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:36:54.470

好吧，我已经看到它在我工作的一个地方用作 FTP Warez Share 的替代品。

```
Developer: "Hi, can you open port 22 for FTP"
SysAdmin: "Nope Company policy"
Developer: "Ok Fair enough" 
```

几天后，我看到几集 Family guy + 一些其他随机的东西出现在 SVN Repo 的一个名为“File Drop”的文件夹下，以几个拆分的 .rar 文件的形式出现

不可思议的是，他们不是由指定用户签入，而是由我们在构建期间用于下载 repo 的 sys 帐户签入...该帐户随后被锁定为 ReadOnly

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2009-04-30T14:06:34.173

我已经为文件系统上的本地 wiki 使用了版本控制 (darcs)。因为 darcs 存储库是通过 http 获取的，所以让我的本地存储库可以从我的 Web 服务器访问意味着任何人都可以获取我的 wiki 的副本，并进行自己的更改。

要获得新的更改，我会从他们的存储库中获取。

这样做的一个好处是没有垃圾邮件，因为您可以回滚更改并停止从任何输入垃圾邮件的人那里获取。

我在存储库本身中保留了一个从远程存储库中获取的脚本，因此没有中央服务器可以翻转和死机，并且当您获取新的 wiki 时很容易找到其他 wikizens。

我编写的 wiki 系统从来没有看到太多用处，但[gitit](http://github.com/jgm/gitit/network)是一个活跃的项目，具有相同的想法（darcs 或 git），并且具有更多功能。

我还对我的主目录中的许多文件使用版本控制：.zshrc .emacs 等等。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-04-30T13:31:05.397

[Flashbake](http://bitbucketlabs.net/flashbake/)为普通人提供源代码控制，[Boing boing 宣传它对作家有用](http://www.boingboing.net/2009/02/13/flashbake-free-versi.html)。

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:56:04.707

我可以想象将它用于我的所有文件系统。我认为它对于 word 文档、来自喜欢的邮件程序的电子邮件数据库、图像（如上所述）、桌面符号也非常有用。您可以通过多种方式受益！

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2009-04-30T13:40:17.077

有时有点棘手（因为 root 访问），但我使用 svn 来托管我的机器设置。

```
/etc/X11/xorg.conf
/etc/apt/sources.list
/home/me/.*
etc. 
```

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2009-04-30T13:45:00.497

我记得读过一些人用它来保持他的虚拟机在家庭和办公室之间同步。因此，离开办公室时检查，回家时检查。

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:17:03.247

签入您的工具链可以使供应开发人员箱只需一米的简单安装和拉动。

# c# - 为什么 TransactionScope 不能与实体框架一起使用？

> ID：794707
> 
>         
> 
> 赞同：26
> 
>         
> 
> 时间：2009-04-27T18:33:43.293
> 
>         
> 
> 标签：c#, .net, entity-framework, transactions, transactionscope

请参阅下面的代码。如果我初始化了多个实体上下文，那么我**只会在第二组代码中**得到以下异常。如果我注释掉第二组它会起作用。

> {“底层提供程序在打开时失败。”}
> 
>   
>   
> 
> 内部：{“与底层事务管理器的通信失败。”}
> 
>   
>   
> 
> 内部：{“错误 HRESULT E_FAIL 已从对 COM 组件的调用中返回。”}

请注意，这是一个示例应用程序，我知道连续创建 2 个上下文没有意义。但是，生产代码确实有理由在同一个 中创建多个上下文`TransactionScope`，这是无法更改的。

**编辑**

这是我之前尝试设置 MS-DTC 的问题。它似乎在服务器和客户端上都启用了。我不确定它是否设置正确。另请注意，我尝试这样做的原因之一是`TransactionScope`使用 ADO.NET 和 Linq 2 Sql 中的现有代码......我希望那些也使用相同的事务。（这可能听起来很疯狂，但如果可能的话，我需要让它工作）。

[如何在 C# 中使用 TransactionScope？](https://stackoverflow.com/questions/794364/how-do-i-use-transactionscope-in-c)

**解决方案**

*Windows 防火墙阻止了与 MS-DTC 的连接。*

```
using(TransactionScope ts = new System.Transactions.TransactionScope())
        {
                using (DatabaseEntityModel o = new DatabaseEntityModel())
                {
                    var v = (from s in o.Advertiser select s).First();
                    v.AcceptableLength = 1;
                    o.SaveChanges();
                }

                //-> By commenting out this section, it works
                using (DatabaseEntityModel o = new DatabaseEntityModel())
                {
                    //Exception on this next line
                    var v = (from s1 in o.Advertiser select s1).First();                         v.AcceptableLength = 1;
                    o.SaveChanges();
                }
                //->

                ts.Complete();
        } 
```

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2009-04-27T18:48:15.800

您可以通过管理您自己的 EntityConnection 并将此 EntityConnection 传递给您的 ObjectContext 来避免使用分布式事务。否则请查看这些。

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=580828&SiteID=1&mode=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=580828&SiteID=1&mode=1) 
[http://forums.microsoft.com/msdn/showpost.aspx?postid=113669&siteid=1&sb=0&d=1&at=7&ft =11&tf=0&pageid=1](http://forums.microsoft.com/msdn/showpost.aspx?postid=113669&siteid=1&sb=0&d=1&at=7&ft=11&tf=0&pageid=1)

```
EntityConnection conn = new EntityConnection(ConnectionString);

using (TransactionScope ts = new TransactionScope())
{
    using (DatabaseEntityModel o = new DatabaseEntityModel(conn))
    {
            var v = (from s in o.Advertiser select s).First();
            v.AcceptableLength = 1;
    }

    //-> By commenting out this section, it works
    using (DatabaseEntityModel o = new DatabaseEntityModel(conn))
    {
        //Exception on this next line
        var v = (from s1 in o.Advertiser select s1).First();
                v.AcceptableLength = 1;
    }
    //->

    ts.Complete();
} 
```

* * *

## 回答 #2

> 赞同：19
> 
>             
> 
> 时间：2009-04-27T18:54:21.947

您的 MS-DTC（分布式事务协调器）由于某种原因无法正常工作。MS-DTC 用于协调跨多个异构资源的事务结果，包括多个 sql 连接。

查看[此链接](http://social.msdn.microsoft.com/Forums/en-US/windowstransactionsprogramming/thread/71f7a219-c85d-4a04-973b-c73464f59606)以获取有关正在发生的事情的更多信息。

基本上，如果您确保您的 MS-DTC 正在运行并正常工作，那么使用 2 个 ADO.NET 连接应该没有问题 - 无论它们是实体框架连接还是任何其他类型。

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2009-05-06T09:29:54.273

将 C:\Windows\msdtc.exe 添加到防火墙和服务器上的防火墙例外中。在我这样做之前，我花了很长时间在打开特定的端口号和范围内胡闹，但无济于事。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2013-03-29T09:05:34.060

我将把它贴在这里，因为我昨天和一位同事花了 3 个小时调试这个问题。围绕这个问题的每一个答案都表明这始终是一个防火墙问题。但是在我们的情况下它不是。希望这可以减轻其他人的痛苦。

我们的情况是我们目前正在迁移到实体框架。这意味着我们有部分代码在单个事务中使用 a 直接打开`new SqlConnection(connectionString).Open()`和使用 EF 数据上下文间接打开。

这已经在我们的应用程序中运行了一段时间，但是当我们开始回顾并围绕在生产中工作的代码进行测试时，从测试运行器执行的代码在 EF 对象第一次尝试连接时不断抛出这个错误在同一事务中建立直接连接**后**到数据库。

该错误的原因最终证明是，如果您不`Application Name=`为连接字符串提供参数，则实体框架会默认添加一个参数（类似于`EntityFrameworkMUF`）。这意味着您的连接池中有两个不同的连接：

1.  `Application Name=`您无需参数手动打开的那个

2.  一个自动生成的后缀`Application Name=EntityFrameworkMUF`

并且不可能在单个事务中打开两个不同的连接。生产代码指定了一个应用程序名称；因此它起作用了；测试代码没有。指定`Application Name=`参数为我们修复了错误。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2009-05-02T00:06:46.297

顺便说一句，当您使用这样的显式事务时，您应该考虑将 SaveChanges(false) 与 AcceptChanges() 结合使用。

这样，如果 SaveChanges(false) 中出现问题，ObjectContext 不会丢弃您的更改，因此您可以稍后重新应用或进行一些错误记录等。

有关更多信息，请参阅此帖子：http: [//blogs.msdn.com/alexj/archive/2009/01/11/savechanges-false.aspx](http://blogs.msdn.com/alexj/archive/2009/01/11/savechanges-false.aspx)

干杯

亚历克斯

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:53:19.453

问题是 2 个不同的 DataContext 有效地创建了两个不同的连接。

在这种情况下，事务必须提升为分布式事务。我假设您的问题来自服务器和/或客户端上 MS DTC（Microsoft 分布式事务协调器）的配置。例如，如果服务器未配置为允许 MSDTC 的远程连接，您将遇到这种异常。

例如，您可以参考[这个 MS 页面](http://msdn.microsoft.com/en-us/library/aa561924.aspx)来解决 MSDTC 问题，并且谷歌充满了关于它的文章/论坛问题。

现在，它可能是别的东西，但听起来确实是一个 MSDTC 问题。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:24:37.490

我在另一个关于如何诊断 MSDTC 事务失败的问题中写了一个答案。

您可能会发现该答案很有帮助。

[如何在 SQL Server 上启用 MSDTC？](https://stackoverflow.com/questions/7694/how-do-i-enable-mstdc-on-sqlserver/479149#479149)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2010-04-03T03:29:16.643

在从 MQ 队列读取消息、处理它们并将其存储在 SQL 2005 Express Edition 数据库中时，使用 DTC 时确实发生了类似的错误。我没有足够的时间来调查到底是 2005 版还是 excatly Express 版导致了这个问题，但是切换到 2008 标准版使这种特殊行为消失了。

# c# - C# 在小顶部裁剪图像

> ID：794709
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:34:04.930
> 
>         
> 
> 标签：c#

我有一个图像，我想裁剪图像的顶部并将图像保存在 C# 中。我该怎么办？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:46:42.857

这是一些有据可查的[裁剪代码：](http://www.eggheadcafe.com/community/aspnet/2/10021760/heres-some-cropping-code.aspx)

```
 try
 {
    //create the destination (cropped) bitmap
    Bitmap bmpCropped = new Bitmap(100, 100);
    //create the graphics object to draw with
    Graphics g = Graphics.FromImage(bmpCropped);

    Rectangle rectDestination = new Rectangle(0, 0, bmpCropped.Width, bmpCropped.Height);
    Rectangle rectCropArea = new Rectangle(myX, myY, myCropWidth, myCropHeight);

    //draw the rectCropArea of the original image to the rectDestination of bmpCropped
    g.DrawImage(myOriginalImage, rectDestination, rectCropArea,GraphicsUnit.Pixel);
    //release system resources
 }
 finally
 {
     g.Dispose();
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:32:57.143

其他答案也可以，这里是如何通过为s 创建一个[扩展方法](http://msdn.microsoft.com/en-us/library/bb383977.aspx)`Image`来做到这一点：

```
class TestProgram
{
    static void Main()
    {
        using (Image testImage = Image.FromFile(@"c:\file.bmp"))
        using (Image cropped = 
                     testImage.Crop(new Rectangle(10, 10, 100, 100)))
        {
            cropped.Save(@"c:\cropped.bmp");
        }
    }
}

static public class ImageExtensions
{
    static public Bitmap Crop(this Image originalImage, Rectangle cropBounds)
    {
        Bitmap croppedImage = 
            new Bitmap(cropBounds.Width, cropBounds.Height);

        using (Graphics g = Graphics.FromImage(croppedImage))
        {
            g.DrawImage(originalImage,
                0, 0,
                cropBounds,
                GraphicsUnit.Pixel);
        }

        return croppedImage;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:42:06.440

您可以创建一个所需大小的新位图，并使用 Graphics.FromImage 将旧图像的一部分绘制到新图像中，以创建一个绘制到新图像中的 Graphics 对象。完成后请务必 Dispose 图形对象，然后您可以保存新创建的图像。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:23:30.833

```
public static Bitmap Crop(Bitmap bitmap, Rectangle rect)
{
    // create new bitmap with desired size and same pixel format
    Bitmap croppedBitmap = new Bitmap(rect.Width, rect.Height, bitmap.PixelFormat);

    // create Graphics "wrapper" to draw into our new bitmap
    // "using" guarantees a call to gfx.Dispose()
    using (Graphics gfx = Graphics.FromImage(croppedBitmap))
    {
        // draw the wanted part of the original bitmap into the new bitmap
        gfx.DrawImage(bitmap, 0, 0, rect, GraphicsUnit.Pixel);
    }

    return croppedBitmap;
} 
```

# jsp - 什么是 asp 的 Request.ServerVariables("AUTH_USER") jsp 等价物？

> ID：794710
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:34:13.463
> 
>         
> 
> 标签：jsp, iis, authentication

好吧，在具有集成 Windows 身份验证且没有匿名访问的 IIS 网站上，我可以检索用户的登录用户名，例如 domain\user...

是否可以在tomcat上使用jsp来实现这一点？（或任何其他容器）

我试过 request.getHeaderNames （在tomcat上），但我只得到

主机、用户代理、接受、接受语言、接受编码、接受字符集、保持活动、连接、cookie、编译指示、缓存控制

嘿，在 asp 和 php 中我得到了更多的信息！！！有什么办法可以实现吗？？？

多谢...

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T22:45:47.010

您可以使用 request.getHeader("AUTH_USER") 甚至 request.getUserPrincipal() 。这种信息与语言无关，是浏览器/服务器问题。

# java - 通常在大型 J2EE Web 应用程序上，按模块明确区分应用程序。可能使用业务委托模式

> ID：794719
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T18:35:15.113
> 
>         
> 
> 标签：java, spring, jakarta-ee

在我问我的“一般”问题之前，我想引用一些我对业务委托模式的高级一般理解的引用：

“您希望将客户端从与业务服务组件的远程通信的复杂性中隐藏起来。”

“您希望从表示层组件和客户端（例如设备、Web 服务和富客户端）访问业务层组件。”

假设您有大型 J2EE Web 应用程序。当我的意思是大时，我的意思是应用程序已经开发了好几年，并且由许多不同的人和部门开发。该系统的设计不适合增长。现在，假设应用程序配置有一个 Web 应用程序。

如果应用程序更加模块化，那就太好了。但事实并非如此。一段代码或一个库可以让整个系统崩溃。测试和其他方法被用来防止这种情况发生，但理想情况下，这只是一个单一的 Web 应用程序。

这是我的问题；在 J2EE 应用程序中，您通常如何避免这种类型的设计，其中应用程序不断增长，一个单独的应用程序可能会破坏一切。

我不熟悉 EJB，也不打算将它们用于任何太严肃的事情。但是，业务委托和服务定位器模式的概念似乎很合适。

假设您有一个购物车屏幕（相同的 Web 应用程序）和一组用于管理用户帐户的屏幕（相同的 Web 应用程序）。在您的 Web 层（某种 MVC 操作方法）中，您似乎可以有一个 Locator 来获取特定于业务的接口，每个模块调用这些接口，如果该模块出现问题，那么它不会杀死其他代码. 假设购物车模块失败（无论出于何种原因），用户帐户屏幕仍然有效。

* * *

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-05-03T22:15:07.750

The best way to avoid such a mess when you were given a chance to restart is:

*   Use the Spring Framework throughout.

*   Pay attention to high-cohesion, low coupling: make sure there are no circular dependencies between package (com.myapp.packageA depends on com.myapp.packageB which depends on com.myapp.packageA). There are some great free tools like Architecture Rules that can verify that for you automatically.

With these two rules you'll already be forced to follow sound good design principles. Otherwise, design needs constant attention. The point of any design effort is to reduce uncertainty, so you basically have to know why you're designing in the first place.

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T22:34:14.743

在一个健康的软件开发环境中，应用程序“不断增长”，因为业务人员要求更改和新功能，而且通常没有任何问题。

让我们忘记可扩展性问题，而专注于设计问题，这会导致非常痛苦的维护。

您需要做的是将您的应用程序分成对业务人员（和用户）有意义的模块。系统的每个模块都应该有明确的业务含义，反映应用领域。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-29T01:38:33.683

所有这些想法都很好，如果你从头开始，那将是完全合理的。不幸的是，您不是从头开始，而是在处理一个原型[Big Ball of Mud](http://en.wikipedia.org/wiki/Big_ball_of_mud)。当我说我感受到你的痛苦时，请相信我。

比特定模式更重要的是在这个烂摊子上强加某种顺序，任何顺序。比您的特定设计选择更重要 - 您能否合理地将您的设计选择强加于整个系统，以便有一个统一的范式贯穿整个应用程序？

如果您的设计满足设计要求并在概念上简化了应用程序，那么它是有效的。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-05-03T20:22:37.567

改进这样一个系统的最好方法是慢慢地让它变得更好。如果您的系统与我工作过的系统类似，那么更改代码通常会导致错误。自动化测试是一种减少引入新错误的机会的方法，但通常编写代码时没有考虑到测试，并且更改代码以更容易编写测试可能会导致错误。

解决此问题的方法是引入一些自动化集成测试，并在您仔细重构代码并在较低级别引入测试时将这些测试用作安全网。使代码更具可测试性通常会导致引入使代码更易于使用的接口和抽象。它还经常需要将业务逻辑与表示逻辑分离（因为同时测试两者都很痛苦）并将我们的代码分解为模块（因为具有许多依赖关系的类可能很难测试）。

当您为您的系统编写新代码时，请在编写代码的同时尝试编写单元测试。这比为遗留代码编写测试要容易得多（因此也不那么令人沮丧），并且让您有机会看到重构遗留代码时可能会去哪里。

我知道关于这个主题的两个极好的错误：   Robert C. Martin 的[《有效地使用遗留代码》和 Joshua Kerievsky 的](https://rads.stackoverflow.com/amzn/click/com/0131177052)[《重构为模式》](https://rads.stackoverflow.com/amzn/click/com/0321213351)。

最后，考虑使用依赖注入框架，如 Spring 或 Guice。依赖注入使您的代码更容易通过单元测试进行测试。它还可以更容易地遵循良好的设计实践，例如[依赖倒置原则](http://www.objectmentor.com/resources/articles/dip.pdf)和[接口隔离原则](http://www.objectmentor.com/resources/articles/isp.pdf)。

# java - 您对 Tomcat 6 添加 SSL 有何经验？

> ID：794727
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:36:10.870
> 
>         
> 
> 标签：java, tomcat, ssl, out-of-memory

上周末，我们将 SSL 安全性添加到已经运行了一段时间且没有出现错误的 Tomcat 6 实例。今天早上，机器上的会话数增加后，Tomcat 开始向用户抛出 500 错误。我检查了日志，发现了一个 OutOfMemory 实例，随后出现了几十个与 Google Guice 尝试启动新线程相关的错误。我只能想象随着 SSL 的添加，正在创建的更多线程或某些此类情况正在使用更多内存。我不太确定在哪里或如何使用额外的资源。

我希望那些有在 Tomcat 上使用 SSL 经验的人可以为我指出一些寻找线索的方向。目前我不确定问题可能出在哪里。以下是有关我们的设置和配置的一些统计信息：

-XX:ThreadStackSize=512

初始内存池：128MB

最大内存池：1024MB

线程堆栈大小：512KB

我一直在以各种方式调整这些，试图至少找到一条通往成功的道路。到目前为止，在服务器重新启动后大约 5 分钟，性能开始下降。任何方向将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:05:20.077

这里有一种可能性，尽管它有点远：浏览器缓存 https 内容的积极性远低于 http 内容。因此，如果您的最终用户现在通过 HTTPS 访问服务，但之前通过 HTTP 访问，您将处理更多请求（尽管会话数量相同）。

如果做不到这一点，我会接受上面 Matt B 的建议；profile 以找出堆的使用位置。添加`-verbose:gc -Xloggc:/path/to/where/you/want/gc.log`  到您的启动 JVM 参数，并使用生成的 gc.log 来查看是否可以将堆大小的跳跃与特定的请求序列相关联。用于`jmap -dump:format=b,file=/path/to/dump {tomcat PID}`生成堆转储。如果启动tomcat后立即取一个，启动死机的时候取一个，那么可以用jhat来显示两者的区别。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:39:35.103

将 SSL 证书/https 添加到 Tomcat6 应该不会导致这些问题。

OutOfMemoryError 来自哪里？你能附上一个分析器来看看是什么占用了这么多内存吗？

我认为你在这里看到的是两个不相关的变化：

1.  您启用了 SSL/https

2.  您的会话数量增加了，暴露了内存问题。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-04T14:49:25.817

对 SSLSessionImpl 对象中 gc 的讨论可能是相关的。. . .

[https://forums.oracle.com/forums/thread.jspa?threadID=1532009](https://forums.oracle.com/forums/thread.jspa?threadID=1532009)

# bash - 变量作为 Bash 脚本中的命令

> ID：794728
> 
>         
> 
> 赞同：30
> 
>         
> 
> 时间：2009-04-27T18:36:21.837
> 
>         
> 
> 标签：bash, unix, shell

我正在编写一个非常简单的 Bash 脚本，[它对](https://en.wikipedia.org/wiki/Tar_%28computing%29)给定目录进行 tar，加密该目录的输出，然后将生成的文件拆分为多个较小的文件，因为备份媒体不支持大文件。

我在 Bash 脚本方面没有太多经验。我相信我在正确引用我的变量以允许参数中有空格时遇到问题。脚本如下：

```
#! /bin/bash

# This script tars the given directory, encrypts it, and transfers
# it to the given directory (likely a USB key).

if [ $# -ne 2 ]
then
    echo "Usage: `basename $0` DIRECTORY BACKUP_DIRECTORY"
    exit 1
fi

DIRECTORY=$1
BACKUP_DIRECTORY=$2
BACKUP_FILE="$BACKUP_DIRECTORY/`date +%Y-%m-%dT%H-%M-%S.backup`"

TAR_CMD="tar cv $DIRECTORY"
SPLIT_CMD="split -b 1024m - \"$BACKUP_FILE\""

ENCRYPT_CMD='openssl des3 -salt'

echo "$TAR_CMD | $ENCRYPT_CMD | $SPLIT_CMD"

$TAR_CMD | $ENCRYPT_CMD | $SPLIT_CMD

say "Done backing up" 
```

运行此命令失败，并显示：

> 拆分：“foo/2009-04-27T14-32-04.backup”aa：没有这样的文件或目录

`$BACKUP_FILE`我可以通过删除我设置的引号来修复它`$SPLIT_CMD`。但是，如果我的备份目录名称中有空格，则它不起作用。此外，如果我将“echo”命令的输出直接复制并粘贴到终端中，它工作正常。显然，我不明白 Bash 是如何逃避事情的。

* * *

## 回答 #1

> 赞同：55
> 
>             
> 
> 时间：2009-04-27T18:55:56.063

只是不要将整个命令放在变量中。试图恢复引用的论点会遇到很多麻烦。

还：

1.  避免在脚本中使用全大写的变量名。这是一个简单的方法来射击自己的脚。

2.  不要使用反引号。改用 $(...) ；它嵌套得更好。

* * *

```
#! /bin/bash

if [ $# -ne 2 ]
then
    echo "Usage: $(basename $0) DIRECTORY BACKUP_DIRECTORY"
    exit 1
fi

directory=$1
backup_directory=$2
current_date=$(date +%Y-%m-%dT%H-%M-%S)
backup_file="${backup_directory}/${current_date}.backup"

tar cv "$directory" | openssl des3 -salt | split -b 1024m - "$backup_file" 
```

* * *

## 回答 #2

> 赞同：11
> 
>             
> 
> 时间：2016-06-01T15:33:03.443

`eval`如果您的目录名称可以由不受信任的来源生成，则不是可接受的做法。有关为什么不应该使用的更多信息，请参阅[BashFAQ #48](http://mywiki.wooledge.org/BashFAQ/048) ，有关此问题的根本原因及其正确解决方案的更多信息，请参阅 BashFAQ #50，其中一些在下面涉及[：](http://mywiki.wooledge.org/BashFAQ/050)`eval`

如果您需要随着时间的推移构建命令，请使用数组：

```
tar_cmd=( tar cv "$directory" )
split_cmd=( split -b 1024m - "$backup_file" )
encrypt_cmd=( openssl des3 -salt )
"${tar_cmd[@]}" | "${encrypt_cmd[@]}" | "${split_cmd[@]}" 
```

或者，如果这只是在一个中心位置定义您的命令，请使用函数：

```
tar_cmd() { tar cv "$directory"; }
split_cmd() { split -b 1024m - "$backup_file"; }
encrypt_cmd() { openssl des3 -salt; }
tar_cmd | split_cmd | encrypt_cmd 
```

* * *

## 回答 #3

> 赞同：10
> 
>             
> 
> 时间：2009-04-27T18:47:41.637

我不确定，但可能值得先在命令上运行一个[eval](https://linux.die.net/man/1/bash)（靠近“ *The args are read and concatenated together”*）。

这将让 Bash 将变量*$TAR_CMD*等扩展到它们的全部宽度（就像[echo](https://linux.die.net/man/1/echo)命令对控制台所做的那样，你说它有效）。

然后 Bash 将在扩展变量的情况下第二次读取该行。

```
eval $TAR_CMD | $ENCRYPT_CMD | $SPLIT_CMD 
```

Page *[Bash：为什么使用带有变量扩展的 eval？](https://fvue.nl/wiki/Bash:_Why_use_eval_with_variable_expansion%3F)*看起来它可以很好地解释为什么需要这样做。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T22:33:18.520

仅将命令和选项放在变量中是有道理的。

```
#! /bin/bash

if [ $# -ne 2 ]
then
    echo "Usage: `basename $0` DIRECTORY BACKUP_DIRECTORY"
    exit 1
fi

. standard_tools    

directory=$1
backup_directory=$2
current_date=$(date +%Y-%m-%dT%H-%M-%S)
backup_file="${backup_directory}/${current_date}.backup"

${tar_create} "${directory}" | ${openssl} | ${split_1024} "$backup_file" 
```

您可以将命令重新定位到您源的另一个文件，这样您就可以在许多脚本中重复使用相同的命令和选项。当您有很多脚本并且想要控制它们如何使用工具时，这非常方便。所以 standard_tools 将包含：

```
export tar_create="tar cv"
export openssl="openssl des3 -salt"
export split_1024="split -b 1024m -" 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:58:09.660

引用变量内的空格以使 shell 正确地重新解释事物是*困难*的。正是这种类型的东西促使我寻求一种更强大的语言。无论是[Perl](https://en.wikipedia.org/wiki/Perl)、[Python](https://en.wikipedia.org/wiki/Python_%28programming_language%29)、[Ruby](https://en.wikipedia.org/wiki/Ruby_%28programming_language%29)还是其他什么（我选择 Perl，但并不总是适合所有人），它只是允许您绕过 shell 进行引用的*东西。*

并不是说我从来没有设法用自由剂量的[eval](https://linux.die.net/man/1/bash)把它弄好，只是那个 eval 给了我 heebie-jeebies （当你想接受用户输入并评估它时，这会变成一个全新的头痛，尽管在这种情况下你'会拿你写的东西然后评估它），而且我在调试时很头疼。

以 Perl 为例，我可以执行以下操作：

```
@tar_cmd = ( qw(tar cv), $directory );
@encrypt_cmd = ( qw(openssl des3 -salt) );
@split_cmd = ( qw(split -b 1024m -), $backup_file ); 
```

这里最困难的部分是做管道——但是有点[IO::Pipe](http://search.cpan.org/%7Egbarr/IO-1.2301/IO/Pipe.pm)、 fork 和重新打开[标准输出](https://en.wikipedia.org/wiki/Ruby_%28programming_language%29)和[标准错误](https://en.wikipedia.org/wiki/Standard_streams#Standard_error_(stderr))，这还不错。有人会说这比正确引用 shell 更糟糕，我理解它们的来源，但是，对我来说，这更容易阅读、维护和编写。哎呀，有人可以从中完成艰苦的工作并创建一个 IO::Pipeline 模块并使整个事情变得微不足道;-)

# asp.net - 我应该在服务层还是在控制器层发送电子邮件？

> ID：794735
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-04-27T18:37:36.043
> 
>         
> 
> 标签：asp.net, asp.net-mvc

我在 ASP.NET 中使用 MVC 模式，使用服务 (BLL) 和存储库层进行数据管理。在某些情况下，当通过我们的网站发送新请求时，我想发送一封自动电子邮件。这封电子邮件应该在架构的哪一层发送？在控制器层还是服务层？我在考虑服务层，因为那是“业务逻辑”应该去的地方，但我不能 100% 确定这在语义上是否正确。

编辑：当我说“新请求”时，我的意思是用户采取了保存到某种数据存储的操作。例如，他们在网站上创建了一个新的“项目”。因此请求将通过控制器 > 服务 > 存储库层。

* * *

## 回答 #1

> 赞同：16
> 
>             
> 
> 时间：2009-04-27T18:39:32.500

同意。它们属于服务层。控制器应该**很薄**；只需调用适当的业务/数据/任何类并将数据放在一致的视图中即可。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-04-27T18:50:07.387

大多数情况下，您可以通过考虑如果您的 BLL 前面有一个 Web 服务层或 Windows 应用程序而不是您的 Web 应用程序，您希望发生什么来澄清此类问题。您还希望发送相同的电子邮件吗？如果答案是肯定的，那么发送电子邮件是您的商业模式的一部分，它应该放在 BLL 中。如果答案是否定的，那么发送电子邮件实际上是应用程序逻辑，它应该进入您的应用程序层。

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T18:41:40.793

我总是设计我的业务层，以便无论数据通过何种媒介呈现，它都能正常工作。因此，例如，如果我要在创建新帐户时发送电子邮件，无论用户是通过网站还是桌面应用程序创建帐户，我都希望这种情况发生。在这种情况下，电子邮件的发送将发生在业务层，因为它对两种媒体都是通用的。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T18:38:48.193

我会把它放在服务层。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:42:55.970

在 mix 和 pdc 菲尔在他的演讲中说，

```
thin controllers, fat models 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-04-28T16:57:01.800

如果它是核心业务功能，我会将其放在服务层中。

然而，我可能会抽象一个“MailSender”类，这样我的服务层就不会明确地与以特定方式发送电子邮件（例如使用 System.Web.Mail）相关联。您可能希望稍后使用另一种方法（例如，使用队列异步发送邮件）。它还允许您在不向任何人发送垃圾邮件的情况下安全地进行单元测试（通过将 MailSender 替换为实际上不发送任何邮件的邮件）:)

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:44:40.693

实际上，我的控制器中只有控制器操作。所有其他业务逻辑都由其他层处理，无论它可能是什么。

# wcf - 使用 WCF 从类库中公开对象

> ID：794739
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T18:38:29.083
> 
>         
> 
> 标签：wcf, datacontract

我正在使用一个公开一些对象的类库。这些对象有几个属性来保存我的客户需要的数据。我想创建一个将对象返回给我的客户的 WCF 服务，但我无法更新类库以添加 DataContract 和 DataMember 属性。暴露这些对象的最简单方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-04-27T18:43:32.973

您可以使用[DataContractSurrogate](http://msdn.microsoft.com/en-us/library/ms751540.aspx)。

> ...您可以将 DataContract 属性应用于 Person 类，但这并不总是可行的。例如，可以在您无法控制的单独程序集中定义 Person 类。
> 
>   
>   
> 
> 鉴于此限制，序列化 Person 类的一种方法是将其替换为另一个标有 DataContractAttribute 的类，并将必要的数据复制到新类。目标是使 Person 类显示为 DataContractSerializer 的 DataContract。请注意，这是序列化非数据协定类的一种方法。...

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:44:24.780

如果您无法在对象上设置 [DataContract] 和 [DataMember] 属性，则必须找到一种使用 XmlSerializer 公开它们的方法。

您可以通过在服务合同或单独的 OperationContract 上指定 [XmlSerializerFormat] 属性来定义服务或操作以使用 XmlSerializer。

这可能有帮助吗？

马克

# .net - WPF ComboBox 自定义滚动条

> ID：794746
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T18:41:15.460
> 
>         
> 
> 标签：.net, wpf, combobox, scroll

我正在寻找有关如何更改 WPF 中组合框呈现的滚动条大小（宽度）的资源。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T18:46:36.257

[http://mark-dot-net.blogspot.com/2008/06/styling-listbox-with-silverlight-2-beta_21.html](http://mark-dot-net.blogspot.com/2008/06/styling-listbox-with-silverlight-2-beta_21.html)似乎很好地描述了如何在 Silverlight 中设置滚动条的样式。其中大部分应该可以在 WPF 中使用。

# flash - 在 Flash 中：gotoAndStop 和嵌套的 MovieClip 问题

> ID：794750
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T18:42:01.837
> 
>         
> 
> 标签：flash, actionscript-3

这是一个奇怪的问题，我希望有足够的信息继续下去：

在 Flash IDE 中，我有一个包含 3 帧的 MovieClip。在每一帧中，我都有一系列的文本字段。基本上这是一个糟糕的 mans viewstack - 所以这是问题所在 - 在 FP10 中，我可以毫无问题地编写以下代码：

```
public function showMenu():void{

     gotoAndStop(2);
     textItem.text = "This worked."

} 
```

其中“this”是一个 MovieClip，而 textItem 是一个 TextField，它仅位于该 movieClip 的第二帧上。如果我以 FP9 为目标并运行相同的代码，则会收到 1009 错误，提示我尝试引用空对象上的属性。  

我知道它在完全实例化之前试图访问该属性，我不明白为什么它在 FP10 而不是 FP9 中工作？Flash 播放器中可能会发生什么变化以允许这样做？

更新：

在 FP9 中看起来有些奇怪 - 可以在此处找到解决方法：

[http://www.scottgmorgan.com/blog/index.php/2008/03/06/accessing-displayobjects-on-the-timeline-after-a-gotoandstop-or-gotoandplay/](http://www.scottgmorgan.com/blog/index.php/2008/03/06/accessing-displayobjects-on-the-timeline-after-a-gotoandstop-or-gotoandplay/)

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T20:46:20.430

是的，它已经改变了。这在 as2 中*是*可能的，但在 as3 中消失了，它采用了较短时间线脚本的大部分简单性。因此，它在 FP10 中恢复了。我已经阅读了 adobe 某人关于此的博客文章，但我现在找不到它。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:14:02.613

我通常发现，当您在时间线上有对象时，为了使用动作脚本访问它们，它们必须位于时间线的所有帧上，您只需将它们的可见性设置为隐藏出现在屏幕上。我很确定我在使用 fp10 和 fp9 时都遇到了这个问题，所以我很惊讶你的代码实际上在 fp10 中对你有用。

# asp.net-mvc - ASP.NET MVC 路由从 html 页面开始

> ID：794753
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-04-27T18:42:08.297
> 
>         
> 
> 标签：asp.net-mvc

我正在使用 IIS 6。我认为我的问题是我不知道如何使用 routes.MapRoute 路由到非控制器。

我有一个 url，例如 example.com，我希望它为 index.htm 页面提供服务，而不是使用 MVC。我该如何设置？在 IIS 中，我有 index.htm 作为我的开始文档，而我的 global.asax 有标准的“默认”路由，它调用 Home/Index。

```
 public static void RegisterRoutes(RouteCollection routes)
    {
        routes.IgnoreRoute("{resource}.axd/{*pathInfo}");
        routes.MapRoute(
            "Default",                                              // Route name
            "{controller}/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        );

    } 
```

我添加了这个：

```
 protected void Application_BeginRequest(object sender, EventArgs e)
    {
        if (Context.Request.FilePath == "/") Context.RewritePath("index.htm");
    } 
```

有用。但这是最好的解决方案吗？

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2009-09-01T16:27:18.033

当指定网站的根目录时，我添加了一个虚拟控制器用作默认控制器。这个控制器有一个单一的索引动作，它重定向到根目录下的 index.htm 站点。

```
public class DocumentationController : Controller
{
    public ActionResult Index()
    {
        return Redirect( Url.Content( "~/index.htm" ) );
    }

} 
```

请注意，我使用的是基于 MVC 的 REST Web 服务的文档。如果您转到站点的根目录，您将获得服务的文档，而不是一些默认的 Web 服务方法。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2014-07-03T18:43:40.287

将 asp.net 路由配置为忽略`root ("/") requests`并让`IIS's "Default Document"`ISAPI 过滤器为静态`index.htm`文件提供服务

将以下内容添加到`RegisterRoutes`方法中。

```
routes.IgnoreRoute(""); 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2016-02-22T08:42:24.127

最好的解决方案是删除默认控制器。您遇到了这个问题，因为您在没有任何参数的情况下同时指定了默认页面和默认路由。

通过仅删除`controller = "Home"`路由默认值，`/`将不再匹配路由，并且因为没有其他路由可以满足，IIS 将查看默认文档。

```
public static void RegisterRoutes(RouteCollection routes)
{
    routes.IgnoreRoute("{resource}.axd/{*pathInfo}");
    routes.MapRoute(
        "Default",                                              // Route name
        "{controller}/{action}/{id}",                           // URL with parameters
        new { action = "Index", id = "" }                       // Parameter defaults
    );
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
>             
> 
> 时间：2009-04-27T18:46:50.280

路线。忽略路线？

另外，请参阅这个问题：[How to ignore route in asp.net forms url routing](https://stackoverflow.com/questions/273447/how-to-ignore-route-in-aspnet-forms-url-routing)

# drag-and-drop - 在 KListWidget 中拖放（PyQt/PyKde 编程）

> ID：794759
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-04-27T18:43:44.033
> 
>         
> 
> 标签：drag-and-drop, pyqt, pykde, plasmoid

我正在 PyQt/PyKde 中开发一个小应用程序（准确地说是 KDE4 plasmoid）。

在我的应用程序中，我有一个 KListWidget 填充了一些行，请参见这张图片：

[http://img212.imageshack.us/img212/8444/sshot3.jpg](http://img212.imageshack.us/img212/8444/sshot3.jpg)

我需要为列表行实现拖放操作，例如我应该能够将任何文件放在一行上，然后应用程序会将此文件发送到列表中的名称。

该列表是由这段代码创建的：

```
self.contactsList = KListWidget()
self.contactsList.setFrameShape(QFrame.StyledPanel)
self.contactsList.setFrameShadow(QFrame.Sunken)
self.contactsList.setIconSize(QSize(35, 35)); 
```

拖放发生时调用的方法已经实现，我只需要将方法连接到列表，方法类似于：

```
self.connect(self.contactsList, SIGNAL("signal_()"), self.method) 
```

任何帮助将不胜感激

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-04-28T11:21:48.923

PyQt信号可以动态定义，所以只要定义self.contacts_list_method()的类继承自QWidget，就可以发出动态信号。

例如，在联系人列表对象中处理列表附加代码的方法的末尾：

```
def contacts_list_method(self, someparameters):
  doStuff()
  doMoreStuff()
  ...
  self.emit(QtCore.SIGNAL("contacts_list_method_done()")) 
```

然后在包含 contactsList 对象的类的初始化程序中（或任何您认为更好的地方）放置以下连接：

```
self.connect(self.contactsList, SIGNAL("contacts_list_method_done()"), self.method) 
```

您还可以将 QtCore.SIGNAL("contacts_list_method_done()") 预定义为一个对象，然后在 contacts_list_method 中发出它时仅引用该对象。

# c# - 数组索引是否存在

> ID：794760
> 
>         
> 
> 赞同：99
> 
>         
> 
> 时间：2009-04-27T18:43:49.570
> 
>         
> 
> 标签：c#, arrays, indexing

我在工作中继承了一些气味非常难闻的代码。我希望找到最无痛的解决方案。

有没有办法检查某个任意数字是否是数组中的有效元素？

示例 - 我需要检查 array[25] 是否存在。

最好我宁愿这样做而不通过数组执行 foreach() 来找到行。

有什么办法可以做到这一点，还是我坚持使用 foreach 循环？

* * *

## 回答 #1

> 赞同：160
> 
>             
> 
> 时间：2009-04-27T18:45:12.673

测试长度

```
int index = 25;
if(index < array.Length)
{
    //it exists
} 
```

* * *

## 回答 #2

> 赞同：127
> 
>             
> 
> 时间：2015-12-31T09:05:15.173

您也可以使用 LINQ 来实现：

```
var exists = array.ElementAtOrDefault(index) != null; 
```

* * *

## 回答 #3

> 赞同：22
> 
>             
> 
> 时间：2009-04-27T18:45:37.320

“是一个有效的元素”到底是什么意思？你可以这样做：

```
if (array.Length >= 26) 
```

这将告诉您 25 是否是数组的有效索引（假设下限为 0）。

如果您需要知道它是否为非空，只需使用：

```
if (array[25] != null) 
```

（或两者的组合）。

如果这些没有帮助，请为您的问题给出更准确的“有效”含义。

* * *

## 回答 #4

> 赞同：12
> 
>             
> 
> 时间：2009-04-27T18:45:33.700

假设您还想检查项目是否不为空   

```
if (array.Length > 25 && array[25] != null)
{
    //it exists
} 
```

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2014-01-23T21:42:09.083

```
// I'd modify this slightly to be more resilient to a bad parameter
// it will handle your case and better handle other cases given to it:

int index = 25;

if (index >= 0 && index < array.Length)
{
    // Array element found
} 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:45:38.193

您可以使用数组的长度，并查看您的任意数字是否适合该范围。例如，如果您有一个大小为 10 的数组，则 array[25] 无效，因为 25 不小于 10。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:45:48.910

您可以使用列表，这样您就可以检查是否存在。

```
List<int> l = new List<int>();
l.Add(45);
...
...

if (l.Count == 25) {
  doStuff();
}
int num = 45;
if (l.Contains(num)) {
  doMoreStuff();
} 
```

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:46:11.420

`array.length`会告诉你数组中有多少元素

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2021-01-26T17:06:02.527

这里的答案很简单，但仅适用于一维数组。对于多维数组，检查 null 是判断元素是否存在的直接方法。此处的示例代码检查空值。请注意，try/catch 块 [可能] 过度杀伤，但它使块防弹。

```
public ItemContext GetThisElement(int row,
    int col)
{
    ItemContext ctx = null;
    if (rgItemCtx[row, col] != null)
    {
        try
        {
          ctx = rgItemCtx[row, col];
        }
        catch (SystemException sex)
        {
          ctx = null;
          // perhaps do something with sex properties
        }
    }

    return (ctx);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:46:39.877

您可以检查索引是否小于数组的长度。这不会检查空值或其他可以为索引分配值但没有明确给出值的奇怪情况。

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T18:47:08.783

您可以检查数组的长度以查看第 25 项在数组中是否有效，然后您可以使用

```
if (array.Length > 25)
{ 
   if (array[25] != null)
   {
       //good
   }
} 
```

查看数组项本身是否已设置。

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:25:38.437

听起来很像您正在使用数组来存储不同的字段。这绝对是一种代码味道。我会尽可能避免使用数组，因为它们在高级代码中通常不适合（或不需要）。

在短期内切换到简单的字典可能是一个可行的选择。就像使用一个大的属性包类一样。有很多选择。你现在遇到的问题只是糟糕设计的症状，你应该着眼于解决潜在的问题，而不是仅仅修补糟糕的设计，所以它现在有点，有点像现在这样。

# http - 相同的页面，不同的网址。重定向？

> ID：794764
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T18:44:49.490
> 
>         
> 
> 标签：http, url, redirect, seo

假设我有一篇多页的文章。每个页面在 URL 中都有一个短标题（wordpress 称它们为 post slug）。如果 URL 中没有给出此标题，则会显示第一页，因此 example.com/myarticle 与 example.com/myarticle/firstpage 是同一页面。

问题是：我应该将前者重定向到后者吗？如果是这样，哪个代码？301, 303?

请记住，文章发表后首页的标题可能会更改（甚至可能是新的首页）。example.com/myarticle 现在可能指向 example.com/myarticle/introduction，但将来如果作者决定改组他的文章，它可能是 example.com/myarticle/tableofcontents。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T18:48:35.800

您可以重定向；如果您为 SEO 执行此操作，请使用 301，因此从地址栏中复制 URL 的人将复制您首选的 URL 形式。

至少应该适用于 Google 的另一种选择是使用[`<link rel="canonical">`](http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html).

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T18:48:51.790

您应该使用 301（永久）重定向。如果您不使用重定向，您将面临重复内容处罚的风险。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-29T07:29:14.917

考虑到这对搜索引擎优化并不重要，我只是不打算重定向。我会在适当的地方添加规范链接（感谢您的建议）

# python - Python列表理解 - 访问最后创建的元素？

> ID：794774
> 
>         
> 
> 赞同：23
> 
>         
> 
> 时间：2009-04-27T18:46:27.753
> 
>         
> 
> 标签：python

是否可以访问在列表理解中生成的前一个元素。

我正在研究一些玩具加密的东西。给定作为任意大整数的密钥、一个初始化值和一个元素列表作为要加密的消息。我需要将每个元素与前一个加密元素和密钥进行异或。下面的循环就可以了。

```
previous = initialization_value
cipher = []
for element in message:
    previous = element ^ previous ^ key
    cipher.append(previous) 
```

我觉得应该可以将其转换为列表理解，但我不确定如何处理初始值或访问生成的先前值。有可能吗？如果可以，理解会是什么？

* * *

## 回答 #1

> 赞同：23
> 
>             
> 
> 时间：2009-04-27T19:12:32.997

没有一个好的 Pythonic 方法可以通过列表理解来做到这一点。考虑列表推导的最佳方式是替代`map`and `filter`。换句话说，只要你需要一个列表，你就会使用列表推导式

*   使用它的元素作为某些表达式的输入（例如对元素求平方）

*   根据某些条件删除它的一些元素

这些东西的共同点是它们每次只查看一个列表元素。这是一个很好的经验法则；即使理论上您可以编写显示为列表理解的代码，它也会很尴尬且不符合 Python 标准。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-04-27T23:21:26.893

大概可以做到；请参阅[列表理解的秘密名称](http://code.activestate.com/recipes/204297/)。不过，这不是pythonic。

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2010-01-15T00:09:20.547

作为生成器：

```
def cypher(message, key, seed):
    for element in message:
        seed = element ^ seed ^ key
        yield seed

list(cypher(message, key, initial_seed)) 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T20:29:11.173

你可以使用[reduce()](http://docs.python.org/library/functions.html#reduce)来做到这一点。这不是列表理解，而是功能样式方法：

```
cipher = []
def f(previous, element):
    previous = element ^ previous ^ key
    cipher.append(previous)
    return previous
reduce(f, message, initialization_value) 
```

在这种情况下，它并不比普通循环更漂亮。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2020-10-22T09:03:34.160

下面是一个示例，如何使用 enumerate 访问列表推导中最后和下一个创建的元素。

**之前的值...**

这里 -1 是偏移量， None 是默认值。

```
A = ['A','B','C','D','E','F','G','H','I','J']
[(A[i-1] if (i-1) >= 0 else None,x) for i,x in enumerate(A) 
```

输出为元组（上一个，当前）

> [（无，'A'），（'A'，'B'），（'B'，'C'），（'C'，'D'），（'D'，'E'），（ 'E', 'F'), ('F', 'G'), ('G', 'H'), ('H', 'I'), ('I', 'J')]

**下一个值...**

```
A = ['A','B','C','D','E','F','G','H','I','J']
[(x, A[i+1] if (i+1) < len(A) else None) for i,x in enumerate(A)] 
```

输出为元组（当前，下一个）

> [('A', 'B'), ('B', 'C'), ('C', 'D'), ('D', 'E'), ('E', 'F') , ('F', 'G'), ('G', 'H'), ('H', 'I'), ('I', 'J'), ('J', 无)]

这与sql中的lag()和lead()解析函数非常相似。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:13:12.183

您可以在迭代序列时使用辅助对象来存储所有内部状态：

```
class Encryption:
  def __init__(self, key, init_value):
    self.key = key
    self.previous = init_value
  def next(self, element):
    self.previous = element ^ self.previous ^ self.key
    return self.previous

enc = Encryption(...)
cipher = [enc.next(e) for e in message] 
```

话虽如此，将先前加密的元素添加到 xor 中并不会使您的算法更难破解，而不仅仅是使用密钥对每个元素进行异或。攻击者可以将密文中的任何字符与前一个加密字符进行异或运算，从而取消加密期间完成的异或运算。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2020-06-07T06:10:57.733

我更喜欢使用类似`enumerate`生成器的东西

```
def emit_previous(iterable, initial=None):
    previous = initial
    for item in iterable:
        yield previous, item
        previous = item

cipher = []
for previous, element in emit_previous(message, initial=initialization_value):
    seed = element ^ previous ^ key
    cipher.append(seed) 
```

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2021-11-12T12:03:03.400

因此，您可以附加到列表推导中的列表，并将最后添加的元素用作该列表推导的新元素，然后最终将该推导分配给列表变量。

```
message = [0,1,2,3,4,5,6,7]
key = 8
previous = 9

cipher = [previous]

cipher = [(cipher.append(element^cipher[-1]^key), cipher[-1])[1] for element in message]

print(cipher) 
```

# java - Java 交叉影线纹理

> ID：794780
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T18:46:53.010
> 
>         
> 
> 标签：java, graphics, rendering

知道如何在 Java 中重新创建交叉散列纹理吗？下面的 C# 代码显示了如何为 .NET 框架完成此操作。Java 代码片段很接近，但我无法将线条正确旋转 45 度。

C＃

```
HatchBrush crossHatch =
        new HatchBrush(HatchStyle.Cross, somecolor, somecolor); 
```

爪哇

```
BufferedImage bufferedImage =
        new BufferedImage(5, 5, BufferedImage.TYPE_INT_ARGB);

Graphics2D g2 = bufferedImage.createGraphics();

g2.setColor(Color.BLUE);
g2.fillRect(0, 0, 5, 5);
g2.setColor(pinColor);
g2.fillOval(0, 0, 5, 5);

// paint with the texturing brush
Rectangle2D rect = new Rectangle2D.Double(0, 0, 5, 5);
g2d.setPaint(new TexturePaint(bufferedImage, rect));
g2d.fill(shape); 
```

提前致谢。

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-04-27T19:13:23.837

这是一个应该以 5 像素间隔交叉的阴影：

```
BufferedImage bufferedImage =
        new BufferedImage(5, 5, BufferedImage.TYPE_INT_ARGB);

Graphics2D g2 = bufferedImage.createGraphics();
g2.setColor(backColor);
g2.fillRect(0, 0, 5, 5);
g2.setColor(stripeColor);
g2.drawLine(0, 0, 5, 5); // \
g2.drawLine(0, 5, 5, 0); // /

// paint with the texturing brush
Rectangle2D rect = new Rectangle2D.Double(0, 0, 5, 5);
g2d.setPaint(new TexturePaint(bufferedImage, rect));
g2d.fill(shape); 
```

# wpf - WPF 列表框选择颜色

> ID：794792
> 
>         
> 
> 赞同：14
> 
>         
> 
> 时间：2009-04-27T18:49:01.087
> 
>         
> 
> 标签：wpf, listbox, triggers, listboxitem

抱歉，如果之前有人问过这个问题，但我在弹出的相关问题或谷歌上找不到我正在寻找的解决方案。

在我的应用程序中，我正在尝试重新创建 Words 新文档对话框，在项目左侧列出，在右侧列出下方带有文本的图标。在 Word 中，当您将鼠标悬停时，它具有橙色渐变，当您选择一个项目时，它具有较暗的渐变。我已经重新创建了大部分内容，除了在您选择一个项目后更改背景颜色。这是我用来创建它的代码：

```
 <ListView Margin="236,34,17,144" Name="listView1" HorizontalContentAlignment="Stretch">
        <ListView.ItemsPanel>
            <ItemsPanelTemplate>
                <UniformGrid  Columns="5" IsItemsHost="True" VerticalAlignment="Top" >
                </UniformGrid>
            </ItemsPanelTemplate>
        </ListView.ItemsPanel>
        <ListView.ItemTemplate>
            <DataTemplate >
                <StackPanel HorizontalAlignment="Center" Width="auto">
                    <Image Source="images/document32.png" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding}" HorizontalAlignment="Center" />
                </StackPanel>
            </DataTemplate>
        </ListView.ItemTemplate>
        <ListView.ItemContainerStyle>
            <Style TargetType="{x:Type ListViewItem}"  >                 
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="true">
                        <Setter Property="Foreground" Value="Yellow" />
                        <Setter Property="Background" Value="Orange" />
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter Property="Foreground" Value="Black" />
                        <Setter Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="1,0">
                                    <GradientStop Color="#d3e7ff" Offset="0.986"/>
                                    <GradientStop Color="#b0d2fc" Offset="0.5"/>
                                    <GradientStop Color="#8ec1ff" Offset="0.51"/>
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                    </Trigger>

                </Style.Triggers>
            </Style>
        </ListView.ItemContainerStyle>
    </ListView> 
```

所以这创造了我想要的外观，鼠标悬停，当我在列表视图中选择一个项目时，它会将字体文本更改为黄色，但它拒绝将背景从默认的蓝色更改为橙​​色，理想情况下无论如何，这将是另一个渐变，而不是泛滥的颜色。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：31
> 
>             
> 
> 时间：2009-04-27T18:56:47.853

你可以做一些技巧，比如覆盖系统颜色键，但很可能你会想要提供一个新模板来实现这一点。这是我放在一起的一个相当漂亮的：

```
<Style x:Key="ListboxItemStyle" TargetType="{x:Type ListBoxItem}">
    <Setter Property="Margin" Value="1,2,1,1"/>
    <Setter Property="HorizontalAlignment" Value="Stretch" />
    <Setter Property="Background" Value="{StaticResource NormalItemBackground}" />
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                <Grid>
                    <Border Background="{TemplateBinding Background}" />
                    <Border Background="#BEFFFFFF" Margin="3,1">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Border Margin="2,1,2,0" Grid.Row="0" Background="#57FFFFFF" />
                        </Grid>
                    </Border>
                    <ContentPresenter Margin="8,5" />
                </Grid>
                <ControlTemplate.Triggers>
                    <MultiTrigger>
                        <MultiTrigger.Conditions>
                            <Condition Property="IsMouseOver" Value="True" />
                            <Condition Property="IsSelected" Value="False"/> 
                        </MultiTrigger.Conditions>
                        <Setter Property="Background" Value="{StaticResource HotItemBackground}" />
                    </MultiTrigger>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{StaticResource SelectedItemBackground}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>
<Style x:Key="ListBoxStyle" TargetType="{x:Type ListBox}">
    <Setter Property="ItemContainerStyle" Value="{DynamicResource ListboxItemStyle}" />
    <Setter Property="Margin" Value="3,3,2,1" />
</Style> 
```

# python - PyQT 组合框仅对用户交互作出反应

> ID：794813
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-04-27T18:55:46.047
> 
>         
> 
> 标签：python, qt, qcombobox

我有一个列表框，您可以在其中选择用户。左侧是一个组合框，列出了用户可以放入的可用组。如果用户在一个组中，组合框将自动设置为该组。我想这样做，所以当您更改组选择时，它会将用户移动到该组。我添加了这个连接：

```
QtCore.QObject.connect(self.GroupsBox, QtCore.SIGNAL("currentIndexChanged(QString)"), self.HandleGrouping) 
```

问题是，由于我将在不同的组中选择不同的用户，每次我选择一个新用户时，组合框中的默认选项都会更改，Qt 会将其注册为“currentIndexChanged”信号。

似乎没有办法只在用户与小部件本身直接交互时触发信号。我可以使用什么方法来解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T19:16:20.193

捕获来自 QComboBox ( [`activated(int index)`](https://doc.qt.io/qt-5/qcombobox.html#activated)) 的信号，并据此更新选定的用户。在您的 Handler 函数中，如果组合框中的选定索引与选定用户所在的组相同，则不要执行任何操作。

也许将您的组合框移动到用户列表框的右侧，因为您的操作顺序将是选择用户 --> 选择组。

# python - 使用 Python-AppKit-ObjectiveC 转换为预先组合的 Unicode 字符串

> ID：794836
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-04-27T19:02:54.767
> 
>         
> 
> 标签：python, objective-c

Apple [Technical Q&A QA1235](http://developer.apple.com/qa/qa2001/qa1235.html)的这份文档描述了一种将 unicode 字符串从组合版本转换为分解版本的方法。由于我对包含某些字符的文件名（例如重音坟墓）有疑问，我想尝试转换功能

void CFStringNormalize(CFMutableStringRef theString, CFStringNormalizationForm theForm);

我将它与 Python 和 AppKit 库一起使用。如果我将 Python 字符串作为参数传递，我会得到：

> > > CoreFoundation.CFStringNormalize("abc",0) 2009-04-27 21:00:54.314 Python[4519:613] *** -[OC_PythonString _cfNormalize:]：无法识别的选择器发送到实例 0x1f02510 Traceback（最近一次调用最后一次）：文件“ "，第 1 行，在 ValueError: NSInvalidArgumentException - *** -[OC_PythonString _cfNormalize:]: unrecognized selector sent to instance 0x1f02510

我想这是因为需要 CFMutableStringRef 作为参数。如何将 Python 字符串转换为 CFMutableStringRef？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-28T05:52:59.807

OC_PythonString （这是 Python 字符串的桥接）是一个 NSString 子类，所以你可以得到一个 NSMutableString ：

```
mutableString = NSMutableString.alloc().initWithString_("abc") 
```

然后使用 mutableString 作为 CFStringNormalize 的参数。

# wcf - DataContractJsonSerializer 和枚举

> ID：794838
> 
>         
> 
> 赞同：44
> 
>         
> 
> 时间：2009-04-27T19:03:11.927
> 
>         
> 
> 标签：wcf, json, serialization

当我使用 DataContractJsonSerializer 序列化枚举值时，它会序列化枚举的数值，而不是字符串名称。

IE：

```
enum foo
{
   bar,
   baz
} 
```

序列化 foo.bar 的值返回“0”，而不是“bar”。

我更喜欢它，有没有办法覆盖它？

编辑：

因为我不想更改序列化程序，所以我使用了一个简单的解决方法 hack。

我在类中公开了一个属性来序列化调用 ToString 的值，即：

```
// Old
[DataMember]
public EnumType Foo
{
    get { return _foo; }
    set { _foo = value; }
}

// New, I still kept the EnumType but I only serialize the string version

public EnumType Foo
{
    get { return _foo; }
    set { _foo = value; }
}

[DataMember]
public string FooType
{
    get { return _foo.ToString(); }
    private set {}
} 
```

* * *

## 回答 #1

> 赞同：26
> 
>             
> 
> 时间：2009-04-27T19:34:50.120

[看起来这是设计使然](http://msdn.microsoft.com/en-us/library/bb412170.aspx)，并且无法更改此行为：

> 枚举成员值在 JSON 中被视为数字，这与它们在数据协定中的处理方式不同，它们被包含为成员名称。

这是一个使用[替代](http://james.newtonking.com/projects/json-net.aspx)（和 IMO 更好和更可扩展）序列化程序的示例，它可以实现您正在寻找的内容：

```
using System;
using Newtonsoft.Json;

class Program
{
    static void Main(string[] args)
    {
        var baz = Foo.Baz;
        var serializer = new JsonSerializer();
        serializer.Converters.Add(new JsonEnumTypeConverter());
        serializer.Serialize(Console.Out, baz);
        Console.WriteLine();
    }
}

enum Foo
{
    Bar,
    Baz
}

public class JsonEnumTypeConverter : JsonConverter
{
    public override bool CanConvert(Type objectType)
    {
        return objectType == typeof(Foo);
    }
    public override void WriteJson(JsonWriter writer, object value)
    {
        writer.WriteValue(((Foo)value).ToString());
    }

    public override object ReadJson(JsonReader reader, Type objectType)
    {
        return Enum.Parse(typeof(Foo), reader.Value.ToString());
    }
} 
```

* * *

## 回答 #2

> 赞同：13
> 
>             
> 
> 时间：2014-08-18T16:36:48.733

我疯狂地试图找到一个优雅的解决方案来解决这个问题，因为似乎每个人都默认使用 Newtonsoft 的序列化程序来解决这个问题。尽管 Newtonsoft 提供了更多功能，但它确实有一些严重的缺点。举几个例子：需要无参数的构造函数，如果你想序列化实现 IEnumerable 的类的疯狂行为，并且在使用抽象类型时表现非常糟糕（因为它不使用 KnownTypes 属性，解决方法会生成一个将内部命名空间暴露给调用者的详细输出）。

另一方面，在 MVC4 WebApi 解决方案上使用 DataContractJsonSerializer 时如何自定义它的例子很少。

我花了一段时间才找到将枚举表示为字符串并解决 DataContractJsonSerializer 附带的已知 DateTime 格式问题的解决方案。

PART I - 将这些扩展方法放在扩展类中~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~

```
#region JSon

    /// <summary>Serializes an object to JSon.</summary>
    /// <param name="obj">The object to serialize.</param>
    /// <returns>Returns a byte array with the serialized object.</returns>
    /// <remarks>This implementation outputs dates in the correct format and enums as string.</remarks>
    [SuppressMessage("StyleCop.CSharp.DocumentationRules", "SA1650:ElementDocumentationMustBeSpelledCorrectly", Justification = "Reviewed.")]
    public static byte[] SerializeJson(this object obj)
    {
        using (MemoryStream b = new MemoryStream())
        {
            SerializeJson(obj, b);
            return b.ToArray();
        }
    }

    /// <summary>Serializes an object to JSon.</summary>
    /// <param name="obj">The object to serialize.</param>
    /// <param name="stream">The stream to write to.</param>
    /// <remarks>This implementation outputs dates in the correct format and enums as string.</remarks>
    [SuppressMessage("StyleCop.CSharp.DocumentationRules", "SA1650:ElementDocumentationMustBeSpelledCorrectly", Justification = "Reviewed.")]
    public static void SerializeJson(this object obj, Stream stream)
    {
        var settings = new DataContractJsonSerializerSettings();
        settings.DateTimeFormat = new System.Runtime.Serialization.DateTimeFormat("yyyy-MM-dd'T'HH:mm:ssZ");
        settings.DataContractSurrogate = new EnumToStringDataContractSurrogate();

        var type = obj == null ? typeof(object) : obj.GetType();

        var enumerationValue = obj as System.Collections.IEnumerable;

        var fixedValue = enumerationValue != null
                         ? type.IsGenericType && !type.GetGenericArguments()[0].IsInterface
                            ? enumerationValue.ToArray(type.GetGenericArguments()[0])
                            : enumerationValue.OfType<object>().ToArray()
                         : obj;

        if (enumerationValue != null && (!type.IsGenericType || (type.IsGenericType || type.GetGenericArguments()[0].IsInterface)))
        {
            var firstMember = (fixedValue as System.Collections.IEnumerable).OfType<object>().FirstOrDefault();
            if (firstMember != null)
                fixedValue = enumerationValue.ToArray(firstMember.GetType());
        }

        var fixedType = obj == null
                        ? type
                        : fixedValue.GetType();

        var jsonSer = new DataContractJsonSerializer(fixedType, settings);
        jsonSer.WriteObject(stream, fixedValue);
    }

    /// <summary>
    /// Deserializes an object.
    /// </summary>
    /// <typeparam name="T">The output type of the object.</typeparam>
    /// <param name="data">The serialized contents.</param>
    /// <returns>Returns the typed deserialized object.</returns>
    /// <remarks>This implementation outputs dates in the correct format and enums as string.</remarks>
    [SuppressMessage("Microsoft.Naming", "CA1702:CompoundWordsShouldBeCasedCorrectly", MessageId = "JSon")]
    [SuppressMessage("StyleCop.CSharp.DocumentationRules", "SA1650:ElementDocumentationMustBeSpelledCorrectly", Justification = "Reviewed.")]
    public static T DeserializeJSon<T>(this byte[] data)
    {
        using (MemoryStream b = new MemoryStream(data))
            return DeserializeJSon<T>(b);
    }

    /// <summary>Deserializes a JSon object.</summary>
    /// <typeparam name="T">The output type of the object.</typeparam>
    /// <param name="stream">The stream to read from.</param>
    /// <returns>Returns the typed object.</returns>
    /// <remarks>This implementation outputs dates in the correct format and enums as string.</remarks>
    [SuppressMessage("Microsoft.Naming", "CA1702:CompoundWordsShouldBeCasedCorrectly", MessageId = "JSon")]
    [SuppressMessage("StyleCop.CSharp.DocumentationRules", "SA1650:ElementDocumentationMustBeSpelledCorrectly", Justification = "Reviewed.")]
    public static T DeserializeJSon<T>(this Stream stream)
    {
        var settings = new DataContractJsonSerializerSettings();
        settings.DateTimeFormat = new System.Runtime.Serialization.DateTimeFormat("yyyy-MM-dd'T'HH:mm:ssZ");
        settings.DataContractSurrogate = new EnumToStringDataContractSurrogate();

        var jsonSer = new DataContractJsonSerializer(typeof(T), settings);
        return (T)jsonSer.ReadObject(stream);
    }

    /// <summary>Deserializes a JSon object.</summary>
    /// <param name="data">The serialized contents.</param>
    /// <param name="targetType">The target type.</param>
    /// <returns>Returns the typed deserialized object.</returns>
    /// <remarks>This implementation outputs dates in the correct format and enums as string.</remarks>
    [SuppressMessage("Microsoft.Naming", "CA1702:CompoundWordsShouldBeCasedCorrectly", MessageId = "JSon")]
    [SuppressMessage("StyleCop.CSharp.DocumentationRules", "SA1650:ElementDocumentationMustBeSpelledCorrectly", Justification = "Reviewed.")]
    public static object DeserializeJSon(this byte[] data, Type targetType)
    {
        using (MemoryStream b = new MemoryStream(data))
        {
            return DeserializeJSon(b, targetType);
        }
    }

    /// <summary>Deserializes a JSon object.</summary>
    /// <param name="data">The serialized contents.</param>
    /// <param name="targetType">The target type.</param>
    /// <returns>Returns the typed deserialized object.</returns>
    /// <remarks>This implementation outputs dates in the correct format and enums as string.</remarks>
    [SuppressMessage("Microsoft.Naming", "CA1702:CompoundWordsShouldBeCasedCorrectly", MessageId = "JSon")]
    [SuppressMessage("StyleCop.CSharp.DocumentationRules", "SA1650:ElementDocumentationMustBeSpelledCorrectly", Justification = "Reviewed.")]
    public static object DeserializeJSon(this Stream data, Type targetType)
    {
        var settings = new DataContractJsonSerializerSettings();
        settings.DateTimeFormat = new System.Runtime.Serialization.DateTimeFormat("yyyy-MM-dd'T'HH:mm:ssZ");
        settings.DataContractSurrogate = new EnumToStringDataContractSurrogate();

        var jsonSer = new DataContractJsonSerializer(targetType, settings);
        return jsonSer.ReadObject(data);            
    }

    /// <summary>Enumerator contract surrogate.</summary>
    internal class EnumToStringDataContractSurrogate : IDataContractSurrogate
    {
        Type IDataContractSurrogate.GetDataContractType(Type type)
        {
            return type == typeof(Enum) ? typeof(string) : type;
        }

        object IDataContractSurrogate.GetDeserializedObject(object obj, Type targetType)
        {
            if (targetType.IsEnum)
            {
                return obj == null
                       ? System.Enum.GetValues(targetType).OfType<int>().FirstOrDefault()
                       : System.Enum.Parse(targetType, obj.ToString());
            }
            return obj;
        }

        object IDataContractSurrogate.GetObjectToSerialize(object obj, Type targetType)
        {
            if (obj is Enum)
            {
                var pair = Enum.GetName(obj.GetType(), obj);
                return pair;
            }

            return obj;
        }

        object IDataContractSurrogate.GetCustomDataToExport(Type clrType, Type dataContractType)
        {
            throw new NotImplementedException();
        }

        object IDataContractSurrogate.GetCustomDataToExport(System.Reflection.MemberInfo memberInfo, Type dataContractType)
        {
            throw new NotImplementedException();
        }

        void IDataContractSurrogate.GetKnownCustomDataTypes(System.Collections.ObjectModel.Collection<Type> customDataTypes)
        {
            throw new NotImplementedException();
        }

        Type IDataContractSurrogate.GetReferencedTypeOnImport(string typeName, string typeNamespace, object customData)
        {
            throw new NotImplementedException();
        }

        System.CodeDom.CodeTypeDeclaration IDataContractSurrogate.ProcessImportedType(System.CodeDom.CodeTypeDeclaration typeDeclaration, System.CodeDom.CodeCompileUnit compileUnit)
        {
            throw new NotImplementedException();
        }
    }

    #endregion

    /// <summary>Creates an array from a non generic source.</summary>
    /// <param name="source">The source.</param>
    /// <param name="type">The target type of the array.</param>
    /// <returns>Returns a typed array.</returns>
    public static Array ToArray(this IEnumerable source, Type type)
    {
        var param = Expression.Parameter(typeof(IEnumerable), "source");
        var cast = Expression.Call(typeof(Enumerable), "Cast", new[] { type }, param);
        var toArray = Expression.Call(typeof(Enumerable), "ToArray", new[] { type }, cast);
        var lambda = Expression.Lambda<Func<IEnumerable, Array>>(toArray, param).Compile();

        return lambda(source);
    } 
```

PART II - 通过封装 DataContractJsonSerializer 创建自己的格式化程序~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～

```
/// <summary>Custom implementation of DataContract formatter.</summary>
public class DataContractJsonFormatter : MediaTypeFormatter
{

    /// <summary>Creates a new instance.</summary>
    public DataContractJsonFormatter()
    {
        SupportedMediaTypes.Add(new System.Net.Http.Headers.MediaTypeHeaderValue("application/json"));
    }

    /// <summary>Gets if the formatter the write a given type.</summary>
    /// <param name="type">The type to handle.</param>
    /// <returns>Returns if the formatter the write a given type.</returns>
    public override bool CanWriteType(Type type)
    {
        return true;
    }

    /// <summary>Gets if the formatter the read a given type.</summary>
    /// <param name="type">The type to handle.</param>
    /// <returns>Returns if the formatter the read a given type.</returns>
    public override bool CanReadType(Type type)
    {
        return true;
    }

    /// <summary>Deserializes an object.</summary>
    /// <param name="type">The target type.</param>
    /// <param name="readStream">The stream to read from.</param>
    /// <param name="content">The http content.</param>
    /// <param name="formatterLogger">A logger.</param>
    /// <returns>Returns the deserialized object.</returns>
    public override Task<object> ReadFromStreamAsync(Type type, Stream readStream, System.Net.Http.HttpContent content, IFormatterLogger formatterLogger)
    {
        var task = Task<object>.Factory.StartNew(() =>
        {
            return readStream.DeserializeJSon(type);
        });

        return task;
    }

    /// <summary>Serializes an object.</summary>
    /// <param name="type">The target type.</param>
    /// <param name="value">The object to serialize.</param>
    /// <param name="writeStream">The stream to write to.</param>
    /// <param name="content">The http content.</param>
    /// <param name="transportContext">The context.</param>
    /// <returns>Returns the deserialized object.</returns>
    public override Task WriteToStreamAsync(Type type, object value, Stream writeStream, System.Net.Http.HttpContent content, System.Net.TransportContext transportContext)
    {
        var task = Task.Factory.StartNew(() =>
        {
            value.SerializeJson(writeStream);
        });

        return task;
    }
} 
```

第三部分 - 编辑您的 Global.asax 文件并使用您的新 JSon 格式化程序 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～

```
 /// <summary>Event handlers of when the application starts.</summary>
    [SuppressMessage("Microsoft.Performance", "CA1822:MarkMembersAsStatic")]
    protected void Application_Start()
    {
       //Register my custom DataContract JSon serializer
        GlobalConfiguration.Configuration.Formatters.Insert(0, new DataContractJsonFormatter());

        //Register areas
        AreaRegistration.RegisterAllAreas();

        WebApiConfig.Register(GlobalConfiguration.Configuration);
        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);
        RouteConfig.RegisterRoutes(RouteTable.Routes);
       // BundleConfig.RegisterBundles(BundleTable.Bundles);

        //JSON serialization config
        var json = GlobalConfiguration.Configuration.Formatters.JsonFormatter;
        json.UseDataContractJsonSerializer = false;
    } 
```

* * *

## 回答 #3

> 赞同：11
> 
>             
> 
> 时间：2010-02-20T20:36:00.297

要获得 wcf json 的 2 路序列化/反序列化，您可以添加第二个字符串类型的 get set 属性，当您在 javascript 中构建 json 对象时使用*字符串*命名属性，在服务器端使用强类型枚举版本：例如

```
public class DTOSearchCriteria {
  public int ? ManufacturerID { get; set; }
  public int ? ModelID { get; set; }

  private SortBy _sort;

  public SortBy SortType {
    get { return _sort; }
    set { _sort = value; }
  }

  public String Sort {
    get {
      return _sort.ToString();
    }
    set {
      _sort = (SortBy) Enum.Parse(typeof(SortBy), value);
    }
  }

  public int PageSize { get; set; }
  public int PageNumber { get; set; }
}

public enum SortBy {
  PriceDescending,
  PriceAscending
} 
```

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T22:54:08.410

编辑：抱歉刚起床没喝咖啡:(

这是使用 Json 序列化器而不是 DataContractJsonSerializer 执行您想要执行的操作的代码。

我还没有使用 DataContractJsonSerializer 完成任何工作，但是在快速扫描文档后，我对 MS 相当失望。他们显然走极端使 WCF 非常可扩展，但是使用 DataContractJsonSerializer 没有可扩展性。你必须使用 MS 风格的 JSON。MS的超级蹩脚......已经搞砸了WCF。

```
 using System;
    using System.Collections.Generic;
    using System.Runtime.Serialization;
    using System.Web.Script.Serialization; 
```

一些测试对象和枚举：

```
 public enum SomeSillyEnum
    {
        Foo,Bar,Doo,Daa,Dee
    }

    public class UseSillyEnum
    {
        public SomeSillyEnum PublicEnum { get; set; }
        public string SomeOtherProperty { get; set; }
        public UseSillyEnum()
        {
            PublicEnum = SomeSillyEnum.Foo;
            SomeOtherProperty = "Testing";
        }
    } 
```

JavaScript 转换器。一个用于所有枚举，一个用于使用枚举的对象。

```
public class EnumStringConverter : JavaScriptConverter
{
    public override object Deserialize(IDictionary<string, object> dictionary, Type type, JavaScriptSerializer serializer)
    {
        foreach(string key in dictionary.Keys)
        {
            try { return Enum.Parse(type, dictionary[key].ToString(), false); }
            catch(Exception ex) { throw new SerializationException("Problem trying to deserialize enum from JSON.",ex); }
        }
        return Activator.CreateInstance(type);
    }

    public override IDictionary<string, object> Serialize(object obj, JavaScriptSerializer serializer)
    {
        Dictionary<string,object> objs = new Dictionary<string, object>();
        objs.Add(obj.ToString(), ((Enum)obj).ToString("D"));
        return objs;
    }

    public override IEnumerable<Type> SupportedTypes{get {return new Type[] {typeof (Enum)};}}
}

public class SillyConverter : JavaScriptConverter
{
    public override object Deserialize(IDictionary<string, object> dictionary, Type type, JavaScriptSerializer serializer)
    {
        UseSillyEnum se = new UseSillyEnum();
        foreach (string key in dictionary.Keys)
        {
            switch(key)
            {
                case "PublicEnum":
                    se.PublicEnum = (SomeSillyEnum) Enum.Parse(typeof (SomeSillyEnum), dictionary[key].ToString(), false);
                    break;
                case "SomeOtherProperty":
                    se.SomeOtherProperty = dictionary[key].ToString();
                    break;
            }
        }
        return se;
    }

    public override IDictionary<string, object> Serialize(object obj, JavaScriptSerializer serializer)
    {
        UseSillyEnum se = (UseSillyEnum)obj;
        Dictionary<string, object> objs = new Dictionary<string, object>();
        objs.Add("PublicEnum", se.PublicEnum);
        objs.Add("SomeOtherProperty", se.SomeOtherProperty);
        return objs;
    }

    public override IEnumerable<Type> SupportedTypes { get { return new Type[] { typeof(UseSillyEnum) }; } }
} 
```

并在页面内使用它：

```
public partial class _Default : System.Web.UI.Page 
{
    protected void Page_Load(object sender, EventArgs e)
    {
        /* Handles ALL Enums

        JavaScriptSerializer jsonSer = new JavaScriptSerializer(); 
        jsonSer.RegisterConverters( new JavaScriptConverter[] { new EnumStringConverter() } );

        string json = jsonSer.Serialize(new UseSillyEnum());
        Response.Write(json);

        UseSillyEnum obj = jsonSer.Deserialize<UseSillyEnum>(json);
        Response.Write(obj.PublicEnum);

        */

        /* Handles Object that uses an enum */
        JavaScriptSerializer jsonSer = new JavaScriptSerializer();
        jsonSer.RegisterConverters( new JavaScriptConverter[] { new SillyConverter() } );
        string json = jsonSer.Serialize(new UseSillyEnum());
        Response.Write(json);

        UseSillyEnum obj = jsonSer.Deserialize<UseSillyEnum>(json);
        Response.Write(obj.PublicEnum);
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2016-07-12T13:31:17.637

`Newtonsoft.Json`我已经使用库以在 WCF 中工作的方式将这个解决方案的所有部分组合在一起。它修复了枚举问题，也使错误处理变得更好，并且可以在 IIS 托管服务中运行。这是相当多的代码，所以你可以在 GitHub 上找到它：[https ://github.com/jongrant/wcfjsonserializer/blob/master/NewtonsoftJsonFormatter.cs](https://github.com/jongrant/wcfjsonserializer/blob/master/NewtonsoftJsonFormatter.cs)

您必须添加一些条目才能`Web.config`使其正常工作，您可以在此处查看示例文件：
 [https ://github.com/jongrant/wcfjsonserializer/blob/master/Web.config](https://github.com/jongrant/wcfjsonserializer/blob/master/Web.config)

# java - GWT 1.6 项目战争布局 - 混合源代码和编译器生成的工件？

> ID：794839
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:03:13.597
> 
>         
> 
> 标签：java, gwt, war

刚刚结束了一个基于 GWT-1.5 的项目，我正在研究迁移到 1.6 需要做些什么。看到 GWT 似乎想将其编译后的输出写入 war 目录，我感到非常惊讶，您通常会将项目置于源代码控制之下。

这背后的原因是什么？谷歌真的认为这是个好主意吗？是否有一种解决方法可以将源代码与编译器生成的工件分开？还有其他我想念的原因吗？

**编辑**：

有人建议我使用该`-war`选项来指定输出目录。我写了一些 ANT 脚本，并且大部分都在工作。我不得不将我的静态资源（例如 HTML、JSP 等）复制到这个目录中（我使用`target/war,`的是 maven 样式）。这就是大多数人正在做的事情吗？还是您只是让 GWT 将其输出写入您的源代码控制`war`目录，并告诉您的 VCS 忽略非版本控制的文件？在我看来，让 GWT 直接写入这个目录可能会有一些好处，因为那时 Jetty 可以自动注意到对 JSP、HTML 等的更改，并且避免复制以使这些更改可见。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T20:51:37.983

使用“-war”选项来控制输出的去向。

仅供参考：Wiki 有[设计文档](http://code.google.com/p/google-web-toolkit/wiki/WAR_Design_1_6)，希望可以让您对他们的想法有所了解。

另请参阅讨论新项目布局的[发行说明](http://code.google.com/webtoolkit/doc/1.6/ReleaseNotes_1_6.html)，以及此更改需要注意的一些事项。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-05-04T17:13:05.500

Salvador Diaz 提供[了一个很好的解决方案](http://blog.salvadordiaz.fr/2009/04/29/keep-your-source-tree-clean-gwt/)。  

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-20T13:26:22.063

是的，看看 -war 选项可能会有所帮助。我正在做的（可能不像 maven 那样干净，而且我不使用 -war）是我将整个项目目录放在 SVN 上，然后忽略包含 js 和其他已编译 bs 的子目录以及类目录。这样我就拥有了源代码控制上的所有其他内容，包括我想要的库。因此，另一个团队成员可以从 SVN 中检查整个项目，编译并准备就绪。  

# c - 使用未定义的结构编译错误 - C

> ID：794854
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T19:06:34.663
> 
>         
> 
> 标签：c, windows, mongoose-web-server

编译器不知道 stat.h 在哪里？

错误：c:\Projects\ADC_HCI\mongoose.c(745)：错误 C2079：“st”使用未定义的结构“_stat64”

```
#include <sys/types.h>
#include <sys/stat.h>

static int
mg_stat(const char *path, struct mgstat *stp)
{
    struct  _stat64 st; //<-- ERROR

    int     ok;
    wchar_t     wbuf[FILENAME_MAX];

    to_unicode(path, wbuf, ARRAY_SIZE(wbuf));
    if (_wstat64(wbuf, &st) == 0) {
        ok = 0;
        stp->size = st.st_size;
        stp->mtime = st.st_mtime;
        stp->is_directory = S_ISDIR(st.st_mode);
    } else {
        ok = -1;
    }

    return (ok);
} 
```

...直接从[源](http://code.google.com/p/mongoose/w/list)下载文件。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-05-24T16:33:32.177

请参阅[MSDN](http://msdn.microsoft.com/en-us/library/14h5k7ff(VS.80).aspx)：`_wstat64`采用参数`struct __stat64`（带有*两个*下划线）。将您的变量`st`重新声明为 type `struct __stat64`。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-05-24T16:43:36.283

请注意，在任何标准（例如 POSIX）记录的意义上，“标准”`_stat64`都不是“标准”。`__stat64`您通常会使用`struct stat`; 如果您担心这是否适用于大文件（超过 2 GiB），请检查您的平台上需要哪些编译选项以获得“大文件支持”。对于 64 位机器和 64 位编译（不一定是 Windows 64），您通常无需担心。您通常可以使用以下方法获得大文件支持：

```
-D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE 
```

这些至少是半标准化的。诸如`autoconf`自动检测这些事情的系统（如果您要求他们这样做）。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-05-05T13:08:20.823

将 _stat64 更改为 stat64。至少在我的 Linux 机器上是这个结构的名称。我不知道它在Windows中是否有所不同。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-07-05T23:17:31.773

我建议你同步到 SVN 中继。

如果您没有 SVN 客户端，只需下载两个文件：
 http: [//mongoose.googlecode.com/svn/trunk/mongoose.h](http://mongoose.googlecode.com/svn/trunk/mongoose.h)（以及 .c 文件）

The reason is that recently the code was refactored, and CRT _stat function was substituted 
with WinAPI one, GetFileAttributesExW().

# wpf - WPF 工具提示绑定未更新

> ID：794857
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:07:19.077
> 
>         
> 
> 标签：wpf, data-binding, tooltip

大家下午好，我必须使用旧版 Winforms 应用程序，但我想开始将其迁移到 WPF。它现在没有工具提示控件，所以我想使用 WPF 工具提示对象。

我创建了一个工具提示对象的单个全局实例。我已经在其中绑定了控件，并且我的应用程序设置了工具提示的数据上下文。我可以手动显示和隐藏工具提示。我第一次将鼠标悬停在一个对象上时，它会完美地拾取绑定数据并且效果很好。当我移过另一个控件时，工具提示数据上下文已更改，但显示的数据永远不会重新加载。

我尝试实现属性更改事件并在绑定到的对象中使用 INotifyPropertyChanged 接口。wpf 工具提示似乎没有在监听该事件。

我尝试将绑定模式设置为 Oneway（它是仅显示工具提示）。

工具提示是以编程方式创建的：

```
// build the tooltip window.
System.Windows.Controls.Image img = new System.Windows.Controls.Image();
img.Width = 50;
img.Height = 60;

// bind the image
System.Windows.Data.Binding imageBinding = new System.Windows.Data.Binding("PatientImage.Data");
imageBinding.Mode = System.Windows.Data.BindingMode.OneWay;
imageBinding.Source = bed;
img.SetBinding(System.Windows.Controls.Image.SourceProperty, imageBinding);

// wrap image in a border
System.Windows.Controls.Border brdr = new System.Windows.Controls.Border();
brdr.BorderBrush = System.Windows.Media.Brushes.Blue;
brdr.Margin = new System.Windows.Thickness(6);
brdr.Child = img;

System.Windows.Controls.WrapPanel wp = new System.Windows.Controls.WrapPanel();

System.Windows.Controls.TextBlock tb = new System.Windows.Controls.TextBlock();
tb.Background = System.Windows.Media.Brushes.LightBlue;
tb.Foreground = System.Windows.Media.Brushes.Blue;

// bind the text block
System.Windows.Data.Binding textBlockBinding = new System.Windows.Data.Binding("TooltipText");
textBlockBinding.Mode = System.Windows.Data.BindingMode.OneWay;
textBlockBinding.Source = bed;
tb.SetBinding(System.Windows.Controls.TextBlock.TextProperty, textBlockBinding);

wp.Children.Add(brdr);
wp.Children.Add(tb);

bedTooltip = new System.Windows.Controls.ToolTip();
bedTooltip.Content = wp; 
```

知道为什么这不起作用吗？也许我需要为每个控件使用一个工具提示对象而不是一个全局对象作为解决方法？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2011-06-13T22:51:23.217

绑定指定 a `Source`，因为它们不再“关心” DataContext ，因此如果源对象上的属性本身之外的任何其他内容发生更改，则绑定不会更新。

# css - CSS 100% 高度 + 带有静态高度的标题；

> ID：794860
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-04-27T19:08:27.360
> 
>         
> 
> 标签：css, flash, internet-explorer, height

我正在构建一个布局，其中包含一个高度为 40 像素的标题。在此标头下方，有一个 SWF 驻留，它应该占用剩余的可用空间。

到目前为止，最好的解决方案是使用表格，将第一行 40 像素高度和第二行 100% 高度 - 但这些行仍然在 Internet Explorer 中相加，导致滚动条出现 40 个额外像素 - 这不应该就是这样。

我尝试使用这个：[http](http://www.456bereastreet.com/archive/200609/css_frames_v2_fullheight/) ://www.456bereastreet.com/archive/200609/css_frames_v2_fullheight/ - 如果您的内容最终会向下推送但其中包含 100% 的 SWF，它将工作正常，它将接管整个页面，或页面的一半（取决于将 SWF 放在内容 div 中还是 SWF 是内容 div）。

在我求助于 javascript 来处理这项业务之前，我想知道其他人是否知道更好的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:14:12.370

尝试将标题设置为静态。所以它漂浮在主体上，并将主体设置为 100% 高度。然后在顶部给 body 一个 40px 的内边距。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:45:27.240

将页脚强制到页面底部的类似解决方案可能有效

```
 html, body{height:100%;margin:0;padding:0;}
    #head{height:40px;background:blue;}
    #wrapper{min-height: 100%;height: auto !important;height: 100%; margin: 0 auto -40px;background:red;}
    #content{}

<div id="wrapper">
<div id="head">
</div>
<div id="content">
</div>
</div> 
```

# java - 两个对象之间共享的模型

> ID：794862
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:09:14.953
> 
>         
> 
> 标签：java, model-view-controller, oop

我有三个班级以一种有趣的方式互动。一个是模型类，它必须被其他两个类访问，所以它的一个实例被保存为每个类的成员。这两个类都以不同的方式与模型交互。

有几个实例必须完全丢弃模型对象并用新实例替换，这使事情变得复杂。这些情况出现在两个查看/控制类中。因此，这些类中的任何一个都必须能够向另一个发送信号，说“我们需要协调并促进用新的 Model 对象替换我们的 Model 对象。” 现在我在 B 类中有代码告诉 A 类构造一个新模型并将其发回，但现在我需要处理相反的情况，即事件发生在 A 类中，不幸的是 A 类没有引用B类，可能不应该。

有什么好的方法来处理这个？

**更新**：对不起，伙计们，这不可能是单身人士。单例是当你需要保证只有一个东西的时候。这与我上面表达的任何要求无关。这个类不是单例，也不应该是。

**更新**：到目前为止，这个模型类实际上只有一个实例，但我有一个模糊的怀疑，我需要允许更多，我不想通过使用单例设计模式来限制自己，当它实际解决时与我所关心的不同。事实证明我是对的：昨天我收到了一个新要求，现在我需要支持任意数量的这些要求。:) 不要在不必要的时候限制自己，也不要在非预期的情况下滥用设计模式！

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T19:13:19.733

您将需要一个中间模型层，即两个类中的每一个都引用的模型“持有者”对象。ModelHolder 持有对模型的引用。

这个 ModelHolder 也应该支持监听器，所以当它的模型被抛出时，它可以通知任何监听器模型已经改变。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:14:09.840

好的，如果您需要更改模型（但不是强制），您可以创建一个侦听器接口，并让对象 A 和 B 都实现它：

```
public interface ModelListener {

    public void modelChanged(Model newModel);
} 
```

并在适当的时候通知听众新模型的变化。您还可以拥有一个包含所有已注册侦听器的列表。

```
List<ModelListener> modelListeners = new ArrayList<ModelListener>();

    public void setNewModel(Model m) {
        for (ModelListener aListener : m.modelListeners)
            aListener.modelChanged(m);
    } 
```

与往常一样，在简单性和稳健性之间存在权衡。您可能想尝试自己案例所需的级别。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:23:20.583

我经常在 GUI 项目（Swing、GWT）中遇到这个设计问题。我通常做的是创建一个更高级别的“状态”模型，它包含一个在 2 个或多个类之间共享的对象实例。然后，State 有一个 ModelListener 接口，其他类可以实现该接口以获取底层模型更改的通知。State.setFoo() 然后向侦听器触发 ModelChanged 事件，侦听器相应响应。

# perl - 如何使用 subversion 部署 Web 应用程序？

> ID：794863
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-04-27T19:09:26.030
> 
>         
> 
> 标签：perl, svn, web-applications

我们是一个由 4 名开发人员组成的小型团队，致力于开发 Web 应用程序。我们在共享服务器上使用 trac+svn 进行版本控制和票务，我们对此感到高兴和满意。同一个共享服务器还托管我们的 Web 应用程序。该应用程序本身是一个 Perl CGI 应用程序，它使用 CGI::Application 以及安装在通常 (/usr/lib/perl...) 和一些不寻常位置 ( /home/user/lib/perl..)。虽然广泛的细节可能无关紧要，但最重要的一点是**我们开发机器上库的位置/布局与生产（共享）服务器上的不同**。我们必须接受这一点。但是，所有开发机器上的库布局都是相同的。  

这是我和我的同事遵循的典型但显然不是最佳的工作周期：

1.  开发机器上的代码和测试

2.  签出/提交/更新我们的代码到 SVN

3.  定期“ `svn export`”到服务器的相应 DocumentRoot

4.  手动编辑导出的树以设置库包括匹配服务器上的库布局

5.  在直播服务器上测试应用，互相提票

6.  转到 1

显然，必须有更好的方法，并且希望听到其他可能比我们处理得更好的人的意见。例如，有没有办法以`svn export`自动化的方式修复图书馆位置？或者是否有一些完全不同的方法来处理这种情况，而不是我们迄今为止所做的。

感谢您的关注

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:30:47.943

您应该有可以为您执行此操作的脚本，这些脚本可以从本地机器上运行。我的总是看起来像：

```
$> checkout from source or copy from working
$> run sed/perl -pi/copy to convert configs to the production values 
     (ie cp production.config myconfig)
$> upload to web server (rsync/ssh/ftp/etc)
$> ssh $SERVER migrate_db, set permissions, run unit tests, etc 
```

最后一个需要我一直在寻找的 ssh 访问权限，但其他一切都可以在本地完成。您通常会有一组开发配置和一组生产配置（或从开发转换为生产的脚本

一步上传总是一个**非常**好的主意。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:19:17.067

保留一个存储所有系统相关路径和变量的配置文件（例如 config.pl）。然后在这个文件上设置[svn:ignore](http://www.petefreitag.com/item/662.cfm)属性，使它永远不会被提交。这将允许您轻松地为每个系统保留一个与提交树分开的本地配置脚本。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:25:45.243

如果您无法在生产中镜像您的开发服务器，为什么不能在开发中镜像您的生产服务器？这可能需要重新配置，但有什么风险？一切都签入svn。

但也许这真的，真的不是你的选择。我对部署 Web 应用程序的偏好是执行 svn checkout，然后运行符号链接脚本。这个想法是您编写一个规则系统，将一个文件夹的内容逻辑映射到另一个文件夹的内容。当然，如果您将文件夹符号链接放在文档根目录中，则必须告诉 Apache 遵循它们。

坦率地说，绝对最安全的方案是设置一个可以像生产机器一样配置的虚拟机。这样您就可以实际测试部署脚本的内容并提交工单。然后，当发现问题时，*您修改脚本*以使开发部署更有可能遵循新的和改进的过程。

而且，作为旁注：我更喜欢使用 svn checkouts 而不是 svn export。确保 apache 或任何您的 Web 服务器对 .svn 文件夹没有权限应该不难（尤其是如果您使用部署脚本）。理想情况下，您可以做的任何事情来使 svn 回滚成为单行命令绝对是关键。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:14:54.473

如果这是一个 Linux 机器，您可以编写一个 cron 作业来为您处理这个问题。您可以使用 sed/awk 替换代码中所需的字符串，并且 svn export 在 cron 作业中可以正常工作。您需要维护脚本，但它似乎比每次都手动执行要快。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-04-28T04:04:58.723

对于手动编辑部分，我会在 Subversion 中为您需要的本地修改提供一个单独的分支。开发人员提交到主干，当您需要部署时，使用 'svn merge' 或 svnmerge.py 将更改从主干合并到分支。

第一次创建分支后，在其中进行本地修改。

在服务器上，将 DocumentRoot 和 /usr/lib/perl 和 /home/user/lib/perl 中的目录作为从分支签出的 Subversion 工作副本。

不要使用 svn export，只要有一个 checkout 这样你就可以 'cd /usr/lib/perl; svn 起来'。

需要注意的一件事是不要在 DocumentRoot 中公开您的 .svn 目录，请使用以下命令：

```
# Prevent any access to .svn directories.
<DirectoryMatch "^/.*/\.svn/">
    Options None
    AllowOverride None
    Order allow,deny
    Deny from all
</DirectoryMatch> 
```

在 DocumentRoot 中部署工作副本也很好，如果您需要回滚更改，只需 'svn up -r PREV'。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2010-07-07T22:25:09.930

Codesion 按需提供企业级颠覆和跟踪。此外，我们现在可以通过 ftp、scp、rsync 等多种方式一键发布/部署您的代码。这将是您完成您正在尝试做的事情的一种简单快捷的方法。

查看我们的 Codesion Publisher 功能：

[https://help.codesion.com/View.jsp?procId=01fabe5e83381dda4edda959b97b2c5b](https://help.codesion.com/View.jsp?procId=01fabe5e83381dda4edda959b97b2c5b)

# sql - 删除 t-sql 中所有大表的最佳方法是什么？

> ID：794865
> 
>         
> 
> 赞同：14
> 
>         
> 
> 时间：2009-04-27T19:10:08.180
> 
>         
> 
> 标签：sql, sql-server-2005

我们遇到了一个有点奇怪的情况。基本上，我们的一个数据库中有两个表，它们提供了大量我们不需要或不关心的日志信息。部分原因是我们的磁盘空间不足。

我正在尝试清理表格，但这需要很长时间（让这个周末运行后仍有 57,000,000 多条记录......这只是第一张桌子！）

仅使用 delete table 会永远占用驱动器空间（我相信是因为事务日志。）现在我正在使用 while 循环一次删除记录 X，同时使用 X 来确定实际最快的。例如，X=1000 需要 3 秒，而 X=100,000 需要 26 秒……计算起来要快一些。

但问题是是否有更好的方法？

（完成此操作后，要运行 SQL 代理作业，每天清理一次表……但需要先将其清除。）

* * *

## 回答 #1

> 赞同：20
> 
>             
> 
> 时间：2009-04-27T19:11:29.957

**[在删除之前TRUNCATE](http://www.tsqltutorials.com/truncate-table.php)**表或禁用索引

```
TRUNCATE TABLE [tablename] 
```

截断将从表中删除所有记录，而不单独记录每个删除。

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2009-04-27T19:15:50.260

要添加到其他响应，如果您想保留过去一天的数据（或过去的月份或年份或其他任何内容），然后将其保存，执行 TRUNCATE TABLE，然后将其插入原始表中：

```
SELECT
     *
INTO
     tmp_My_Table
FROM
     My_Table
WHERE
     <Some_Criteria>

TRUNCATE TABLE My_Table

INSERT INTO My_Table SELECT * FROM tmp_My_Table 
```

接下来要做的是问问自己，如果没有人关心它，为什么要将所有这些信息插入日志。如果您真的根本不需要它，请在源头关闭日志记录。

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:12:51.437

1) 截断表

2) 编写表格，删除并重新创建表格

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:12:20.360

```
TRUNCATE TABLE [tablename] 
```

将删除所有记录而不记录。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:13:14.383

根据您要保留的数量，您可以将所需的记录复制到临时表，截断日志表，然后将临时表记录复制回日志表。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:28:24.613

如果您可以计算出最佳 x，它将以最快的速度不断循环删除。设置行数会限制在循环的每个步骤中将被删除的记录数。如果日志文件变得太大；在循环中插入一个计数器并每百万行左右截断一次。

在 1=1 开始时设置 @@rowcount x

从表中删除 If @@Rowcount = 0

结尾

将数据库上的日志记录模式更改为简单或批量记录将减少一些删除开销。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2014-02-21T04:57:58.213

检查这个

1.  来自 MSDN 的文章[Delete_a_Huge_Amount_of_Data_from](http://social.technet.microsoft.com/wiki/contents/articles/20651.sql-server-delete-a-huge-amount-of-data-from-a-table.aspx)

2.  [恢复模型](http://msdn.microsoft.com/en-us/library/ms189275.aspx)信息

3.  以及[查看或更改数据库的恢复模式](http://msdn.microsoft.com/en-us/library/ms189272.aspx)

# algorithm - 推荐产品的算法

> ID：794870
> 
>         
> 
> 赞同：19
> 
>         
> 
> 时间：2009-04-27T19:12:25.727
> 
>         
> 
> 标签：algorithm, autosuggest

有什么好的算法可以根据他们以前的选择来推荐某人可能喜欢的东西？（例如被亚马逊推广以推荐书籍，并用于 iRate Radio 或 YAPE 等服务，您可以通过评分项目获得建议）

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2009-04-27T19:16:03.253

**简单明了（订购购物车）：**

根据一起订购的物品保留交易清单。例如，当有人在亚马逊上购买摄像机时，他们也会同时购买用于录制的媒体。

在决定给定产品页面上“建议”什么时，查看订购该产品的所有订单，计算同时购买的所有其他商品，然后显示同时购买最多的前 5 件商品时间。

您不仅可以根据订单，还可以根据人们在网站上按顺序搜索的内容等从那里扩展它。

**就评级系统（即电影评级）而言：**

当您输入评级时，它变得更加困难。而不是一个人购买的一篮子离散的物品，你有一个物品评级的客户历史。  

那时您正在研究数据挖掘，其复杂性是巨大的。

不过，一个简单的算法与上述算法相距不远，但它采用了不同的形式。取客户评分最高的商品和评分最低的商品，并找到其他具有相似最高评分和最低评分列表的客户。您希望将他们与具有相似极端好恶的其他人匹配 - 如果您只关注喜欢，那么当您提出他们讨厌的东西时，您会给他们带来不好的体验。在建议系统中，您总是希望在“不冷不热”的体验方面犯错，而不是“讨厌”，因为一次糟糕的体验会使他们因使用建议而感到厌烦。

向客户推荐其他最高列表中的项目。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:17:44.247

考虑查看“[什么是好的推荐算法？](http://cacm.acm.org/blogs/blog-cacm/22925-what-is-a-good-recommendation-algorithm/fulltext) ”及其在 Hacker News 上的[讨论。](http://news.ycombinator.com/item?id=537371)

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:22:25.577

没有明确的答案，而且极不可能有一个标准算法。

您如何做到这一点在很大程度上取决于您想要关联的数据类型及其组织方式。这取决于您如何在应用程序范围内定义“相关”。

通常最简单的想法会产生好的结果。对于书籍，如果您有一个数据库，其中每个书籍条目具有多个属性（例如作者、日期、流派等），您可以简单地选择建议一组来自同一作者、相同流派、相似标题和其他人喜欢这样。

但是，您总是可以尝试更复杂的东西。记录需要此“产品”的其他用户，并建议这些用户过去需要的其他“产品”（产品可以是任何东西，从一本书到一首歌，再到你能想象的任何东西）。大多数具有建议功能的主要网站都会做的事情（尽管它们可能会获取大量信息，从产品属性到人口统计数据，以最好地为客户服务）。

或者你甚至可以求助于所谓的人工智能；可以构建神经网络，将所有这些是产品的属性，并尝试（基于先前的观察）将其与他人联系起来并自我更新。

任何这些情况的混合都可能对您有用。

我个人建议考虑一下您希望算法如何工作以及如何建议相关的“产品”。然后，您可以探索所有选项：从简单到复杂并平衡您的需求。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:16:43.563

推荐产品算法现在是一项巨大的业务。NetFlix 只提供 100,000 美元，只是为了稍微提高其算法的准确性。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:24:48.253

正如您迄今为止从答案中推断出的那样，并且确实正如您所建议的那样，这是一个庞大而复杂的主题。我不能给你一个答案，至少没有什么还没有说，但我给你指出了几本关于这个主题的优秀书籍：

*   编程 CI：
     http: [//oreilly.com/catalog/9780596529321/](http://oreilly.com/catalog/9780596529321/)
    是一个相当温和的 Python 示例介绍。

*   CI In Action：
     http: [//www.manning.com/alag](http://www.manning.com/alag)看起来更深入一些（但我只阅读了第一章或第 2 章）并且有 Java 示例。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:58:32.870

我认为大多数有用的建议已经被提出，但我想我会提出我将如何去做，只是想一想，因为我没有做过这样的事情。

首先，我会在应用程序中找到要对要使用的数据进行采样的位置，所以如果我有商店，它可能会在结账时。然后我会保存结帐购物车中每个项目之间的关系。

现在，如果用户进入项目页面，我可以计算与其他项目的关系数，并选择与所选项目关系数最多的 5 个项目。

我知道它很简单，并且可能有更好的方法。

但我希望它有所帮助

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:19:29.283

购物篮分析是您正在寻找的研究领域：

Microsoft 为其分析服务器提供了两种合适的算法： Microsoft 关联算法 Microsoft 决策树算法

查看这篇 msdn 文章，了解有关如何最好地使用 Analysis Services 解决此问题的建议。

[链接文本](http://msdn.microsoft.com/en-us/library/ms175595.aspx)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:23:32.207

我认为在最小均方回归（或类似的东西）上做一个谷歌可能会给你一些值得咀嚼的东西。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2013-11-03T09:57:58.107

亚马逊创建了一个名为 Certona 的推荐平台，您可能会觉得这很有用，它被 B&Q 和 Screwfix 等公司使用，更多信息请访问 www.certona.com/‎</p>

# tfs - TFS 用户无法查看历史记录

> ID：794880
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T19:13:24.413
> 
>         
> 
> 标签：tfs, starteam

我有一个非常奇怪的情况......从 StarTeam 迁移到 TFS（使用 TimlyMigration == awesome）后，有一个奇怪的地方。

当我查看源代码控制视图中的任何给定文件时，我会看到所有迁移的历史记录。但是，如果项目中的其他人查看该文件，则看不到历史记录。这听起来像是一个权限问题，但即使我更改他们的组成员身份，将他们添加到项目管理员中，他们仍然无法获得历史记录。

所以我想知道resposity是否可能存在问题，以及是否有我可以运行的TFS内部一致性检查器。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-06-06T23:20:30.187

历史记录是否包括任何重命名/移动？TFS 权限基于路径，因此如果人们没有对“旧”路径的权限，那么他们将不会在移动之前看到历史记录条目。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-05-06T13:53:21.940

要研究的另一件事是源代码管理中的权限（假设您已授予项目权限）。

在源代码管理资源管理器中，右键单击项目并选择属性。然后选择安全选项卡。不需要将用户添加到此，但在某些情况下我必须这样做。

瓦卡诺

# c# - WPF 事件：BitmapImage PropertyChanged：“调用线程无法访问”

> ID：794882
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T19:13:34.210
> 
>         
> 
> 标签：c#, wpf, xaml

我试图了解以下代码的含义，该代码对加载文本文件并显示其内容非常满意，但**对****加载**BitmapImage 并将其显示在 timer.Elapsed 事件处理程序上不满意。

我知道这与 UI 线程有关。

但是为什么对于文本文件示例来说这不是问题？

首先，XAML：

```
<Window x:Class="WpfApplication7.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">

<StackPanel Orientation="Vertical">

<TextBlock Text="{Binding Path=Message, UpdateSourceTrigger=PropertyChanged}" FontSize="20" Height="40" Width="300"  Background="AliceBlue"  />

<Image Source="{Binding Path=Image,UpdateSourceTrigger=PropertyChanged}" Height="100" Width="100"/>

</StackPanel>
</Window> 
```

和 C#，它在计时器上引发 PropertyChangedEventHandler：

```
using System;
using System.ComponentModel;
using System.Timers;
using System.Windows;
using System.IO;
using System.Windows.Threading;
using System.Windows.Media.Imaging; 
```

和

```
namespace WpfApplication7
{
  public partial class Window1 : Window, INotifyPropertyChanged
  {
    public BitmapImage Image { get; private set; }
    public string Message { get; set; }
    public event PropertyChangedEventHandler PropertyChanged = delegate { };

    private Timer timer;

    public Window1()
    {
      InitializeComponent();
      this.DataContext = this;

      this.timer = new Timer { Enabled = true, Interval = 100 };

      this.timer.Elapsed += (s, e) =>
      {
        //---happy loading from text file. UI updates :)
        this.Message = File.ReadAllText(@"c:\windows\win.ini").Substring(0, 20);
        PropertyChanged(this, new PropertyChangedEventArgs("Message"));

        //---not happy loading a BitmapImage. PropertyChanged unhappy :(
        // (Don't make me have to: ! )
        //Application.Current.Dispatcher.Invoke(
        //DispatcherPriority.Send, new Action(delegate
        //{

          this.Image = new BitmapImage(new Uri(@"C:\WINDOWS\Web\Wallpaper\Ascent.jpg"));

          //Edit --Ah hah, thanks Daniel ! 
          // DependencyObject-> Freezable-> Animatable-> 
          // ImageSource-> BitmapSource-> BitmapImage
          this.Image.Freeze();  //<--- this will fix it, no need for Dispatcher

          //Without Dispatcher or Freeze() ... right here:
          //"The calling thread cannot access this object because a different thread owns it."
          PropertyChanged(this, new PropertyChangedEventArgs("Image"));
        //}));
      };
    }
  }
} 
```

我知道我可以用“Application.Current.Dispatcher.Invoke”来解决这个问题。所以修复它不是问题。不明白为什么我必须这样做是问题:)

*类似*问题

*   [使用 WPF 在 C# 中异步加载 BitmapImage](https://stackoverflow.com/questions/36748/asynchronously-loading-a-bitmapimage-in-c-using-wpf)

*   [确保在 MVVM WPF 应用程序的 UI 线程上调用 OnPropertyChanged()](https://stackoverflow.com/questions/590590/making-sure-onpropertychanged-is-called-on-ui-thread-in-mvvm-wpf-app)

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:49:45.403

我认为这两种情况的关键区别在于 BitmapImage 是一个依赖对象，这意味着它具有“拥有”线程（创建对象的线程）的概念。当您的主 UI 线程尝试访问在另一个线程上创建（并拥有）的 BitmapImage 对象时......砰！

另一方面，字符串没有“拥有”线程的概念。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2012-02-02T02:48:40.667

对于我们这些（像我一样）来这里希望了解如何跨线程实际传递位图的人，请查看

[https://stackoverflow.com/a/2672929/745913](https://stackoverflow.com/a/2672929/745913)

答案`Freeze()`首先是位图。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:06:37.233

我认为这是因为 BitmapImage 是 DispatchObject 的；您正在非 UI 线程上创建 DispatcherObject，因此是异常。由于文本不是线程对象，因此您看不到文本分配错误。

# storage - 实施大规模日志文件分析

> ID：794885
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T19:13:51.573
> 
>         
> 
> 标签：storage, hadoop, mapreduce, bigtable

谁能指出我的参考资料或提供有关 Facebook、Yahoo、Google 等公司如何执行他们为运营特别是 Web 分析执行的大规模（例如多 TB 范围）日志分析的高级概述？

特别关注网络分析，我对两个密切相关的方面感兴趣：查询性能和数据存储。

我知道一般的方法是使用 map reduce 将每个查询分布在一个集群上（例如使用 Hadoop）。但是，最有效的存储格式是什么？这是日志数据，因此我们可以假设每个事件都有一个时间戳，并且通常数据是结构化的而不是稀疏的。大多数 Web 分析查询涉及分析两个任意时间戳之间的数据切片并检索该数据中的聚合统计信息或异常情况。

像 Big Table（或 HBase）这样的面向列的数据库会是一种有效的方式来存储，更重要的是，查询这些数据吗？您选择行子集（基于时间戳）的事实是否违背了这种存储类型的基本前提？将其存储为非结构化数据会更好，例如。反向索引？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-28T17:09:57.650

不幸的是，没有一种适合所有人的答案。

我目前正在使用 Cascading、Hadoop、S3 和 Aster Data 通过 AWS 内部的分阶段管道每天处理 100 次演出。

Aster Data 用于查询和报告，因为它为 Hadoop 上的级联进程清理和解析的海量数据集提供了 SQL 接口。使用 Cascading JDBC 接口，加载 Aster Data 是一个非常简单的过程。

请记住，像 HBase 和 Hypertable 这样的工具是键/值存储，所以不要在没有 MapReduce/Cascading 应用程序的帮助下执行临时查询和连接来执行带外连接，这是一种非常有用的模式。

完全公开，我是 Cascading 项目的开发人员。

[http://www.asterdata.com/](http://www.asterdata.com/)

[http://www.cascading.org/](http://www.cascading.org/)

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-06-18T20:22:44.440

Hadoop：O'Reilly 的权威指南一书有一章讨论了 hadoop 如何在两个现实世界的公司中使用。

[http://my.safaribooksonline.com/9780596521974/ch14](http://my.safaribooksonline.com/9780596521974/ch14)

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:42:34.907

请查看Google的论文[解释数据：使用 Sawzall 进行并行分析。](http://research.google.com/archive/sawzall.html)这是一篇关于 Google 用于日志分析的工具的论文。

# java - 如何为 Spring 的 WebServiceTemplate 创建一个模拟对象？

> ID：794899
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-04-27T19:16:22.970
> 
>         
> 
> 标签：java, mocking, spring-ws

我有一个调用现有 Web 服务的类。我的班级正确处理了有效结果以及 Web 服务生成的错误字符串。对 Web 服务的基本调用看起来像这样（尽管这是简化的）。

```
public String callWebService(final String inputXml)
{
  String result = null;

  try
  {
    StreamSource input = new StreamSource(new StringReader(inputXml));
    StringWriter output = new StringWriter();

    _webServiceTemplate.sendSourceAndReceiveToResult(_serviceUri, input, new StreamResult(output));

    result = output.toString();
  }
  catch (SoapFaultClientException ex)
  {
    result = ex.getFaultStringOrReason();
  }

  return result;
} 
```

现在我需要创建一些单元测试来测试所有的成功和失败条件。它不能调用实际的 Web 服务，所以我希望 Spring-WS 的客户端有可用的模拟对象。有谁知道可用于 WebServiceTemplate 或任何相关类的模拟对象？我是否应该尝试编写自己的类并修改我的类以使用 WebServiceOperations 接口与 WebServiceTemplate？

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-04-28T15:46:18.040

迈克尔的回答非常接近，但这是一个有效的例子。

我已经在我的单元测试中使用了 Mockito，所以我对这个库很熟悉。然而，与我之前使用 Mockito 的经验不同，简单地模拟返回结果并没有帮助。我需要做两件事来测试所有用例：

1.  修改 StreamResult 中存储的值。

2.  引发 SoapFaultClientException。

首先，我需要意识到我不能用 Mockito 模拟 WebServiceTemplate，因为它是一个具体的类（如果这是必要的，你需要使用 EasyMock）。幸运的是，对 Web 服务 sendSourceAndReceiveToResult 的调用是 WebServiceOperations 接口的一部分。这需要更改我的代码以期望 WebServiceOperations 与 WebServiceTemplate。

以下代码支持在 StreamResult 参数中返回结果的第一个用例：

```
private WebServiceOperations getMockWebServiceOperations(final String resultXml)
{
  WebServiceOperations mockObj = Mockito.mock(WebServiceOperations.class);

  doAnswer(new Answer()
  {
    public Object answer(InvocationOnMock invocation)
    {
      try
      {
        Object[] args = invocation.getArguments();
        StreamResult result = (StreamResult)args[2];
        Writer output = result.getWriter();
        output.write(resultXml);
      }
      catch (IOException e)
      {
        e.printStackTrace();
      }

      return null;
    }
  }).when(mockObj).sendSourceAndReceiveToResult(anyString(), any(StreamSource.class), any(StreamResult.class));

  return mockObj;
} 
```

对第二个用例的支持类似，但需要抛出异常。以下代码创建了一个包含 faultString 的 SoapFaultClientException。faultCode 由我正在测试的处理 Web 服务请求的代码使用：

```
private WebServiceOperations getMockWebServiceOperations(final String faultString)
{
  WebServiceOperations mockObj = Mockito.mock(WebServiceOperations.class);

  SoapFault soapFault = Mockito.mock(SoapFault.class);
  when(soapFault.getFaultStringOrReason()).thenReturn(faultString);

  SoapBody soapBody = Mockito.mock(SoapBody.class);
  when(soapBody.getFault()).thenReturn(soapFault);

  SoapMessage soapMsg = Mockito.mock(SoapMessage.class);
  when(soapMsg.getSoapBody()).thenReturn(soapBody);

  doThrow(new SoapFaultClientException(soapMsg)).when(mockObj).sendSourceAndReceiveToResult(anyString(), any(StreamSource.class), any(StreamResult.class));

  return mockObj;
} 
```

这两个用例可能需要更多代码，但它们适用于我的目的。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T19:45:51.717

实际上我不知道是否存在预配置的模拟对象，但我怀疑是否为所有“失败条件”进行了配置，因此您可以为您的 JUnit 测试创建一个特殊的 Spring ApplicationContext 替代品或使用模拟框架，它是没那么难:-)

我在示例中使用了[Mockito](http://mockito.org/)模拟框架（并快速输入），但[EasyMock](http://easymock.org/)或您喜欢的模拟框架也应该这样做

```
package org.foo.bar
import java.util.ArrayList;
import java.util.List;
import org.junit.Before;
import org.junit.Test;
import static org.mockito.Mockito.*;
import static org.junit.Assert.*;

public class WebserviceTemplateMockTest {

    private WhateverTheInterfaceIs webServiceTemplate;
    private TestClassInterface testClass;
    private final String inputXml = "bar";

    @Test
    public void testClient(){
        // 
        assertTrue("foo".equals(testClass.callWebService(inputXml));
    }

    /**
     * Create Webservice Mock.
     */
    @Before
    public void createMock() {
        // create Mock
        webServiceTemplate = mock(WhateverTheInterfaceIs.class);
        // like inputXml you need to create testData for Uri etc.
        // 'result' should be the needed result data to produce the
        // real result of testClass.callWebService(...)
        when(webServiceTemplate.sendSourceAndReceiveToResult(Uri, inputXml, new StreamResult(output))).thenReturn(result);
        // or return other things, e.g.
        // .thenThrow(new FoobarException());
        // see mockito documentation for more possibilities
        // Setup Testclass
        TestClassImpl temp = new TestClassImpl();
        temp.setWebServiceTemplate(generatedClient);
        testClass = temp;
    }
} 
```

# linux - od(1) 的反义词是什么？

> ID：794902
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-04-27T19:17:29.910
> 
>         
> 
> 标签：linux, command-line

假设我有 8b1f 0008 0231 49f6 0300 f1f3 75f4 0c72 f775 0850 7676 720c 560d 75f0 02e5 ce00 0861 1302 0000 0000，如何在不复制+粘贴到十六进制编辑器的情况下轻松获取二进制文件？

* * *

## 回答 #1

> 赞同：16
> 
>             
> 
> 时间：2009-04-27T19:27:21.633

采用：

```
% xxd -r -p in.txt out.bin 
```

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:20:54.257

见[xxd](http://linux.die.net/man/1/xxd)。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2016-03-16T20:05:30.070

此版本也适用于二进制格式：

```
cat /bin/sh \
| od -A n -v -t x1 \
| tr -d '\r' \
| xxd -r -g 1 -p1 \
| md5sum && md5sum /bin/sh 
```

额外的 '\r' 只是如果您正在处理 w/dos 文本文件......并逐字节处理以防止在不同系统上运行部分管道时字节序差异。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2016-09-22T19:25:09.177

所有目前的答案都是指方便的`xxd -r`方法，但对于`xxd`不可用或不方便的情况，这里是一种更便携（更灵活，但更冗长且效率更低）的解决方案，仅使用 POSIX shell 语法（它也补偿了奇数-输入的位数）：

```
un_od() {
    printf -- "$(
        tr -d '\t\r\n ' | sed -e 's/^(.(.{2})*)$/0\1/' -e 's/\(.\{2\}\)/\\x\1/g'
    )"
} 
```

顺便说一句：你没有指定你的输入是大端还是小端，或者你是否想要大/小端输出。通常，例如您的问题中的输入将是大端/网络顺序（例如由 创建`od -t x1 -An -v`），并且预计会转换为大端输出。我假设`xxd`只是假设默认值，如果没有另外说明，这个解决方案也是这样做的。如果需要字节交换，那么如何进行字节交换还取决于系统的字长（例如 32 位、64 位），而字节大小*很少*（你几乎总是可以假设 8 位字节 - 八位字节 - 不过） .

以下函数使用更复杂版本的`binary -> od -> binary`技巧来可移植字节交换二进制数据，以系统字节顺序为条件，并考虑系统字长。该算法适用于高达 72 位字长的任何内容（因为`seq -s '' 10`->`12345678910`不起作用）：

```
if { sed --version 2>/dev/null || :; } | head -n 1 | grep -q 'GNU sed'; then
    _sed() { sed -r "${@}"; }
else
    _sed() { sed -E "${@}"; }
fi

sys_bigendian() {
    return $(
        printf 'I' | od -t o2 | head -n 1 | \
            _sed -e 's/^[^ \t]+[ \t]+([^ \t]+)[ \t]*$/\1/' | cut -c 6
    )
}

sys_word_size() { expr $(getconf LONG_BIT) / 8; }

byte_swap() {
    _wordsize=$1
    od -An -v -t o1 | _sed -e 's/^[ \t]+//' | tr -s ' ' '\n' | \
        paste -d '\\' $(for _cnt in $(seq $_wordsize); do printf -- '- '; done) | \
        _sed -e 's/^/\\/' -e '$ s/\\+$//' | \
        while read -r _word; do            
            _thissize=$(expr $(printf '%s' "$_word" | wc -c) / 4)
            printf '%s' "$(seq -s '' $_thissize)" | tr -d '\n' | \
                tr "$(seq -s '' $_thissize -1 1)" "$_word"
        done
    unset _wordsize _prefix _word _thissize
} 
```

无论系统字节序如何，您都可以使用上述内容以 bigendian 格式输出文件内容：

```
if sys_bigendian; then
    cat /bin/sh
else
    cat /bin/sh | byte_swap $(sys_word_size)
fi 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2014-08-02T22:37:38.263

这是反转“od”输出的方法：

```
echo "test" | od -A x -t x1 | sed -e 's|^[0-f]* ?||g' | xxd -r
test 
```

# sql - 如何有效地将数据插入索引丰富的 oracle db？

> ID：794910
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T19:19:21.810
> 
>         
> 
> 标签：sql, oracle, performance

我们如何将大约 200 万行的数据插入到我们有许多索引的 oracle 数据库表中？我知道一种选择是禁用索引然后插入数据。谁能告诉我其他选择是什么？  

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-28T14:00:21.600

检查[SQL*Loader （尤其是关于](http://www.orafaq.com/wiki/SQL*Loader_FAQ)[性能优化](http://Can_one_improve_the_performance_of_SQL.2ALoader.3F)的段落）：它是 Oracle 的标准批量加载实用程序，一旦您知道如何使用它（与 Oracle 一样），它就会做得很好。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:25:16.633

以索引键顺序使用预排序数据批量加载

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2013-11-13T15:16:25.460

固定de insert的技巧有很多，下面我写了一些

*   如果您使用 sequence.nextval 进行插入，请确保序列具有较大的缓存值（通常 1000 就足够了）

*   在插入之前删除索引并在之后创建（确保在删除之前获得索引的创建脚本）在创建时您可以使用并行选项

*   如果目标表具有 fk 依赖关系，则在插入之前和插入之后再次启用它们。如果您确定您的数据可以使用**novalidate**选项（novalidate 选项对**oracle**有效，其他 rdbms 系统可能有类似的选项）

*   如果您选择并插入，您可以为选择语句提供并行提示，对于插入，您可以使用附加提示（**直接路径插入**）（直接路径插入概念对**oracle**有效，其他 rdbms 系统可能有类似的选项）

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:24:11.643

不确定您是如何插入记录的；如果你可以的话; 以较小的块插入数据。根据我的经验，50 组 20k 记录通常比 1 x 1000000 快

确保您的数据库文件足够大，然后再开始在插入期间避免数据库增长...

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:24:43.153

如果您确定数据，除了索引之外，您还可以禁用引用和约束检查。您还可以降低事务隔离级别。

不过，所有这些选择都是有代价的。每个选项都会增加您拥有损坏数据的风险，因为您最终可能会得到空 FK 等。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2014-01-19T18:30:43.807

作为另一种选择，可以使用 10 G 以上的 oracle 高级和更快的数据泵（expdp、impdp）实用程序。尽管如此，Oracle 仍然支持旧的导出/导入（exp、imp）。

Oracle 为我们提供了许多数据加载选择，有些方式比其他方式更快：

*   Oracle10 数据泵 Oracle 导入实用程序

*   SQL插入和合并

*   forall PL/SQL 运算符的语句 PL/SQL 批量加载

*   SQL*加载器

[每个的优点/缺点可以在这里找到..](http://www.dba-oracle.com/oracle_tips_data_load.htm)

# jquery - 切换动画？

> ID：794912
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:20:21.900
> 
>         
> 
> 标签：jquery, jquery-animate

我有这个代码：

```
$('.couch-hide').click(function() {
    $(this).animate({right:0},1000, 'easeOutBounce');           
}); 
```

我试图让它切换，所以首先单击，将其弹出，然后再次单击，然后将其放回内部。我需要将变量设置为跟踪器吗？告诉它处于哪个阶段？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-04-27T19:30:04.890

只需将原始值保存在某处，并记住在开始新动画之前停止任何正在进行的动画。动画例程将处理其余部分：

```
var panel = $('.couch-hide');
var originalPos = panel.css("right");
panel.toggle(function() {
    $(this).stop().animate({right:0},1000, 'easeOutBounce');
  },
  function() {
    $(this).stop().animate({right:originalPos},1000, 'easeOutBounce');
  }); 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:31:34.107

通常，jquery 切换几乎以如下给出的标准方式工作，但是我还没有真正尝试过动画的东西，但这可能会奏效。

```
$('.couch-hide').click(function() {
    $(this).animate({right:0},1000, 'easeOutBounce').toggle();                       
}); 
```

# anti-patterns - 混淆实践的通用设计？

> ID：794940
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-04-27T19:27:10.043
> 
>         
> 
> 标签：anti-patterns

您看到混淆人群在设计中使用了哪些常见做法？我发现从事不允许重写的项目很有趣，而这将是解决问题的更快和最有效的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T20:10:00.283

我最喜欢的总是围绕着变量……将不再使用的变量留在代码中，然后给它们所有无意义的名称。当然，如果你真的想混淆，你必须小心避免几乎所有的约定。因此，一个完美的方法是拥有两个类似使用的变量，一个名为 myVar1，另一个名为 myVarOne。类似的东西...

另一种方法是包含仅在代码中可见的未使用控件。我盯着一个 ASP.NET 站点看了一个小时，试图弄清楚为什么将 FormView 放入其中......（没有答案）。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T20:23:42.857

我曾经研究过 perl 代码，作者决定让大多数 subs 接收单个散列作为变量，并返回相同的散列并添加或删除数据。基本上一个全局哈希用于通过不同的代码路径传递数据。

它看起来像这样：

```
my $hash = ();

$hash->{'CUSTID'} = 1001;
$hash = GetAccounts($hash);

if ($hash->{'AccountTotal'} > 100) {
    $hash = getTotals($hash);
    $hash->{'Acct_Sbkt_Marker'} = 'R1';
    $hash->{'Acct_Invr_Marker'} = 'BT';
    $hash = removeInvalidAccount($hash);
} 
```

直到今天，我都无法弄清楚他试图用这个实现什么设计模式。

我记得`$hash`会很好地排列。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:29:55.140

我们有一个人在名为 /kensington 的文件夹中处理存储文件，以便“隐藏”它们。它只是包含一些他不想看到的 xml 文件，并且认为人们不会在那里查看。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:04:12.030

代码中没有或无用的注释，也没有有用的文档。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:02:03.160

我和一个程序员一起工作，他曾经编写过非常复杂的条件，当遇到这些条件时，会调用一个简单地完成系统的方法。他在整个应用程序中做了几十次。仍然不知道为什么....

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:30:11.717

在那里，我认为设计良好的代码应该独立地被阅读，而不是被破译。

我了解鼓励关心混淆的人在其他环境中使用 dotfuscator 等工具及其等效工具。混淆的意义在于使代码更难反编译，而不仅仅是让它工作起来很痛苦。

为什么有人会故意设计糟糕的代码（除了演示陷阱）我无法理解。

# vb.net - VB.NET 会自动生成 ComClass 属性和 guid 吗？

> ID：794942
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:27:57.780
> 
>         
> 
> 标签：vb.net, com

我遇到了一些明确创建三个 GUID 常量并在类的 ComClass 属性中使用它们的 VB.NET 代码。过去我只通过检查项目选项中的“使 COM 可见”和“注册 COM 互操作”选项来编写 COM 感知类。这个显式代码是完全没有必要的，还是它做的事情超出了这两个选项的作用？这是一个片段：

```
<ComClass(MenuHandler.ClassId, MenuHandler.InterfaceId, MenuHandler.EventsId)> _
Public Class MenuHandler
    Public Const ClassId As String = "A2204623-A902-44d4-B524-FDFFCD176E53"
    Public Const InterfaceId As String = "3449CA8B-16DF-4a61-8BAB-DFF27AE70F5E"
    Public Const EventsId As String = "06C156DD-0ABA-437e-9EE0-C1CE2CA34033"
End Class 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:41:46.233

ComClass 属性特定于 Visual Basic，旨在简化在 .Net 代码中创建 COM 对象。当编译器看到这个属性时，它会在后台执行一些必须在 C# 中手动完成的繁琐工作。总之，它是 Visual Basic Code 创建 COM 对象的快捷方式。

这是一篇很棒的文章，介绍了在 C# 中执行相同操作所提供的功能：

*   [http://codebetter.com/blogs/peter.van.ooijen/archive/2005/08/02/130157.aspx](http://codebetter.com/blogs/peter.van.ooijen/archive/2005/08/02/130157.aspx)

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:41:42.507

通过显式地将属性放在要公开的类和枚举上，您可以防止诸如辅助类、内部工具或不应公开的内部类之类的东西被公开。这是微软推荐的方法......当他们推荐一些东西时，通常意味着如果你不这样做，你的程序将来可能会中断。:)

勾选“使 COM 可见”和“注册 COM 互操作”是使 COM 可见对象的简单方法，但不推荐。这将增加每个可见类的开销——即使是你可能不想要的。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2012-11-08T02:25:23.880

> VB.NET 会自动生成 ComClass 属性和 guid 吗？

是的，如果您使用 VB.NET COMClass 模板创建类，COMClassAttribute 和那些 GUID 将自动生成。

[MSDN](http://msdn.microsoft.com/zh-cn/library/x66s8zcd%28v=vs.100%29.aspx "微软")
部分“使用 COM 类模板创建 COM 对象”中的详细信息

# php - 简单 php 框架的最佳类结构是什么？

> ID：794946
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-04-27T19:29:22.830
> 
>         
> 
> 标签：php

我正在尝试创建简单的 php 框架。但我不确定类结构，例如哪些类应该扩展到哪些类。首先我知道一些基本类，如路由器，视图类必须访问一些基本数据，如请求url 或请求的 ccontroller 和操作，那么我如何将基本数据导入这些类。如果我的问题不清楚，请解释你自己关于框架的经验和想法。或者如果你知道，请谈谈已知的框架，如 zend、cakephp 或 symfony

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:42:44.780

没有最好的班级结构。取决于你想要做什么。你的意思是最纯粹的 MVC 设计吗？最可测试？最容易理解？

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:02:58.150

有一个简单的经验法则：

*   要么您有标准框架无法满足的需求

*   或者你应该使用一个好的标准框架来满足你的需要。

在第一种情况下，限制将是您设计中的驱动因素。

框架中的类结构没有通用的设计规则。但是，如果您决定编写自己的，请记住这一点：

*   最小化模块之间的依赖关系

*   总是尝试给出默认值

*   尽量减少开销

*   *多多和同行讨论，尽早发现缺陷。*

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T23:43:41.113

如果您从未在其他人的框架中工作过，您将不知道哪些想法适合您，哪些不适合您。如果您只使用过杂乱无章的意大利面条式代码，那么您就会知道什么对您有意义。如果您在多个不相关的项目中对杂乱无章的意大利面条代码进行了大量重组，那么您应该对构建框架的想法有一个很好的了解。:-)

如果你对如何编写框架没有一个明确的想法，但你想编写一个，我认为你需要从零开始，有机地构建它。但是，您应该对您希望它的外观有所了解，即使它与您希望包含文件所在的位置一样愚蠢。换句话说，您所需要的只是一个起点。然后，当你遇到丑陋时，它就是重新考虑丑陋的问题。不久之后，您将拥有一个数据库处理程序、一个分派机制，也许是一个数据访问层，甚至可能是一个模板系统！

但是，在回复@MrFox 时，您应该注意危险的依赖关系。显然，数据访问层将依赖于数据库处理程序；所以你*不*希望你的数据库处理程序依赖于你的数据访问层。事实上，你也不希望他们彼此有亲密的了解。它应该是一个合理的“黑盒”界面。

此外，许多框架试图构建“一个”对象层次结构。这意味着他们认为 Action is-a Model is-a Database Handler。我个人对这种错误应用的抽象有疑问，所以如果它对你不起作用，不要害怕拒绝这个想法。正如@Tyndall 所说，没有一种单一的“正确”方法可以做到这一点。

# ksh - ksh 中的着色目录名称

> ID：794951
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:31:01.970
> 
>         
> 
> 标签：ksh, prompt

在我目前的情况下，我连接到几台 UNIX 计算机，根据情况作为几个不同的用户，并遍历机器上的各种目录，这并不罕见。我在整个过程中都使用了 ksh。

我最近在摆弄我的提示，我能够让它根据我当前的用户名和当前服务器改变一些颜色。但是，我还想要它根据我当前的目录更改颜色。例如，如果我在目录“foo”中，提示应该是黄色的，但如果我在目录“bar”中，提示应该是洋红色。在这两种情况下，子目录也应该计算在内，因此简单的子字符串检查就足够了。

然而，我遇到的问题是，当我运行我的 .profile 脚本时，它会正确地为目录着色——但每当我切换到另一个目录时它不再动态更新——而且我不知道在我完成所有操作之前是怎么做的分支，即使在切换目录之后，我也能够让它正确打印我当前的工作目录。

我做了一些谷歌搜索，找到了 bash 的信息，但 ksh 似乎在很大程度上被忽略了。由于我自己无法弄清楚如何做到这一点，因此我必须将其带到 Stack Overflow 社区，以将其添加到未来的知识中。因此，通过我冗长的解释，我的问题的“快速版本”如下：

在 ksh 中，如何设置提示符以显示当前工作目录并根据当前工作目录的位置为文本着色？甚至可能吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:51:23.107

为什么不使用 zsh？它基于 ksh，而且功能更强大。在 zsh 中，您可以编写每次更改目录时都会隐式调用的 chpwd 函数。在此功能中，您可以检查当前目录并将 PS1 设置为您想要的任何内容。

或者（即使在 ksh 中）您也可以为 cd 命令创建一个别名：

```
change_my_ps() {
  PS1=...
}
better_cd() {
  builtin cd "$@"
  change_my_ps
}
alias cd=better_cd 
```

像这样的东西。我不确定它是否正确，我不记得 ksh 语法。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-30T14:41:02.547

我能够在这里挖掘出一个半解决方案：

[http://books.google.com/books?id=QYu_v2R6fIQC&pg=PA71&lpg=PA71&dq=korn+dynamic+prompt&source=bl&ots=yMEZiWrGyU&sig=8KBbs12Mtk3eGNSZQiLVmFYZVFY&hl=en&ei=2HX4Sej0K6LWMP2NxresPP72,result1&oi=book#](http://books.google.com/books?id=QYu_v2R6fIQC&pg=PA71&lpg=PA71&dq=korn+dynamic+prompt&source=bl&ots=yMEZiWrGyU&sig=8KBbs12Mtk3eGNSZQiLVmFYZVFY&hl=en&ei=2HX4Sej0K6LWMP2NxakP&sa=X&oi=book_result&ct=result&resnum=2#PPA72,M1)

尽管制定它仍然很困难。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2010-02-28T03:53:26.667

要在 ksh 中显示当前目录，请将其放入您的 .profile 文件中： export PS1="\$PWD " 当您更改目录时，它将动态更新，而无需使用函数。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2015-09-18T05:23:48.487

由于没有人真正回答关于颜色的部分，这就是我的做法。我无法为文本着色，所以我还附上了我的终端屏幕截图。

有关颜色代码的完整列表以及在ksh 中打印转义序列的详细信息，请参阅[Wikipedia 上有关 ANSI 转义码的页面。](https://en.wikipedia.org/wiki/ANSI_escape_code#Colors)`print --man``printf --man`

（请注意，目前处于测试阶段的 ksh93v 将包含一种基于（我认为）基于 bash 的提示语言，这将使这类事情变得更容易一些，尽管我认为你可能仍然需要使用类似这个函数的东西来完成复杂的像这样的条件提示。）

```
> cat ~/scripts/prompt    
function prompt
{
    set -eu
    typeset c=
    case $PWD in
        */foo) c=3;; # yellow
        */bar) c=5;; # magenta
    esac
    print "\E[3${c}m$PWD\E[m > "
}
PS1='`prompt`'
> . ~/scripts/prompt
/Users/adavies > cd foo  
/Users/adavies/foo > cd ../bar
/Users/adavies/bar > 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Ww6Jh.png)](https://i.stack.imgur.com/Ww6Jh.png)

* * *

## 回答 #5

> 赞同：-1
> 
>             
> 
> 时间：2009-05-01T21:01:41.513

我用这个：

```
function chdir
{
   cd "$@"
   CWDH=${PWD%/*}
   PS1="($_time)$hname:${CWDH##*/}/${PWD##*/} ->"
   export PS1
}
alias cd=chdir
chdir . 
```

忽略时间和 hname，但其余的应该适合你。更改颜色将取决于终端。您需要知道您将使用的终端的每种颜色的转义码。如果您知道您只使用过 xterm，那会更容易。

# javascript - Dreamweaver JavaScript 调试器

> ID：794956
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T19:32:25.647
> 
>         
> 
> 标签：javascript, debugging, dreamweaver

Dreamweaver CS 3 有 JavaScript 调试器吗？

关于任何关闭的唯一信息是它说我需要单击打开页面的“浏览器中的预览/调试”按钮，但是当页面出现错误时不会进行任何调试。我也看不到设置断点或遍历代码的方法。

MS [Visual Web Developer](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio_Express)（[Visual Studio Express](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio_Express#Visual_C.2B.2B_Express) - 免费）有一个可以附加到进程的调试器。因此，即使您不是在其中进行开发，您也可以在任何浏览器中调试 JavaScript。它还具有一个非常丰富的变量监视，可让您深入了解对象的所有后代以获取其各自的值。我希望 Dreamweaver 至少可以匹配 Visual Web Developer ......

将 Visual Studio 调试器工具用于非 Internet Explorer 浏览器的体验如何？  

*   Dreamweaver 没有有效的内置调试器。

*   [Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)非常适用于非 Internet Explorer 浏览器

*   Visual Studio 工具非常适用于 ID 浏览器

什么是全面运作良好的？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-06-15T19:18:30.230

调试器特定于特定的解释器/编译器，而不是特定于语言。同一种语言——在这种情况下是 JavaScript——可以有多个解释器/编译器。特别是，每个浏览器都有自己的。

因此，要在 Internet Explorer 中调试 JavaScript，您需要一个 Internet Explorer 调试器——可以是 Internet Explorer 中内置的调试器，也可以是 Visual Studio 中的一种。要在 Chrome 中调试 JavaScript，请使用 Chrome 的调试器。要在 Firefox 中调试 JavaScript，请使用[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)。（等等。）

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:58:03.107

Dreamweaver 没有原生的东西可以处理 JavaScript 调试，但还有其他几个免费的选项。

Firefox 的 Firebug 插件允许您设置断点并单步执行 JavaScript。下载并使用它，你应该找到你需要的东西。这里有一个简短的教程来说明你的观点：[Debug Javascript with Firebug](http://thecodecentral.com/2007/08/01/debug-javascript-with-firebug)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:40:55.627

我使用 FireFox 中的错误控制台解决了大多数 JavaScript 问题。我从来没有让 Dreamweaver 工作。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:46:52.570

我同意 CheGueVerra 的观点，最好的调试器无疑是 Firefox 中的“错误控制台”。如果您想让它变得更好，只需下载[Firefox Add-on Console²](https://addons.mozilla.org/en-US/firefox/addon/1815)。调试 JavaScript 代码所需的一切都在那里。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T20:01:31.037

你也可以使用[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)，在我看来它是 Firefox 最好的 JavaScript 调试器，即使有时仍然存在一些问题（参考我几天前的帖子，Stack Overflow 问题*[Firebug debugger not working in Firefox 3.x?](https://stackoverflow.com/questions/778591/firebug-debugger-not-working-in-ff-3-x)*）。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-04-28T13:37:47.957

我假设您正在寻找可以附加断点之类的东西......好吧，不要回应其他人（这可以在 Firebug 中完成），请尝试[Aptana Studio](http://en.wikipedia.org/wiki/Aptana#Aptana_Studio)。它可以像[Eclipse](http://en.wikipedia.org/wiki/Eclipse_%28software%29)上的插件一样运行，并可用于调试 JavaScript。

# html - HTML 表单域（类型=文本）的默认大小是多少？

> ID：794957
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T19:32:43.977
> 
>         
> 
> 标签：html, internet-explorer, firefox

我有一个页面，在视觉上具有两个相互重叠的字段，但实际上是两种不同的形式。

在 Firefox 中，它们似乎具有相同的宽度。在 IE（IE6、IE7、IE8）中，它们以不同的宽度出现。

这是一个示例，我认为问题在于缺少“size=”

```
<input id="fieldid" type="text"  name="fieldname" value="" /> 
```

当你这样做（没有尺寸）时，尺寸是多少？

我发现了一些关于[HTML3](http://www.w3.org/TR/REC-html32.html#isize)和[HTML4](http://www.w3.org/TR/html4/interact/forms.html#adef-size-INPUT "HTML4")的文档......

但无法清楚地知道默认值应该是什么。

从在 Firefox 3.0 中使用 Firebug 来看，它在 Gecko 中看起来是 20。

在 IE 中，它看起来是可变的，基于我不理解的其他一些条件。

更新：

我确实尝试进一步比较这两种形式的特征，但无法隔离变量。我确实破解了文件以使两者都使用 set size=20，但宽度仍然不同（尽管比以前小）。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:38:22.933

在 IE6 和 7 中，它似乎也是 20。如果不了解更多关于您的测试条件或结果，很难说出为什么您会遇到“可变”的默认大小。

“大小”属性将始终相对于样式中设置的字体大小呈现。例如，10 号字体的“20”不同于 20 号字体的“20”，因为“大小”与字符宽度有关。如果您想要硬/静态宽度，请使用 width css 属性。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2013-12-12T13:01:55.797

默认大小为 20。要增加大小，请使用“大小”

# java - equals 和 compareTo 不一致是否有意义？

> ID：794961
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-04-27T19:34:04.083
> 
>         
> 
> 标签：java, collections

我想让一个类在`SortedSet`|中可用 `SortedMap`.

```
class MyClass implements Comparable<MyClass>{
  // the only thing relevant to comparisons:
  private final String name;

  //...
} 
```

类的实例必须按其名称属性排序。

但是，我不希望将同名实例视为相等。

所以`SortedSet`内容看起来像**a, a, a, b, c**。

（通常`SortedSet`只允许**a, b, c**）

**首先：这（哲学上）是否一致？**

如果是这样，当我不覆盖`equals(...)`and时，我是否必须期待不可预测的行为`hashCode()`？

**编辑：**

对不起，我的问题似乎不一致：

我想将**多个“相等”值**放在一个**set**中，这在概念上是不允许的。

所以，请不要再回答我的问题了。

感谢所有已经回复的人。

* * *

## 回答 #1

> 赞同：17
> 
>             
> 
> 时间：2009-04-27T19:37:18.070

`a.compareTo(b)`让我问你一个问题：有return 0 和`a.equals(b)`return有意义`false`吗？

我会用 a[`Comparator<MyClass>`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)代替。这就是为什么我所知道的所有`SortedMap`/实现都允许您在创建时传递。`SortedSet``Comparator`

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:44:46.100

来自 Javadoc for Comparable

> 强烈建议（尽管不是必需的）自然排序与 equals 一致。这是因为没有显式比较器的排序集（和排序映射）在与自然顺序与等于不一致的元素（或键）一起使用时表现“**奇怪”**

如果您希望 compareTo 与 equals() 不一致，建议您通过提供实现 Comparator 的类来使用显式比较器。

> 如果是这样，当我不覆盖equals（...）和hashcode（）时，我是否必须期待不可预测的行为？

You should still override equals() and hashcode().  Whether or not equals() and hashcode() are consistent with compareTo is a different matter.

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:41:45.873

[Effective Java](http://java.sun.com/docs/books/effective/)建议，如果你不实现与你`compareTo`一致，`equals`你应该清楚地指出：

> 推荐的语言是“注意：这个类具有与等于不一致的自然顺序。”

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-27T19:42:46.433

只需将此代码放在 equals 方法中，不要再考虑它：

```
public boolean equals(Object obj) {
    if (this == obj) return true;
    if (!(obj instanceof MyClass)) return false;
    return 0 == this.compareTo((MyClass) obj);
} 
```

# email - 多部分电子邮件中的数字是什么意思？

> ID：794964
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-04-27T19:35:56.060
> 
>         
> 
> 标签：email, multipart

我正在查看来自 Thunderbird 的多部分消息的来源（希望从 C++/Javascript 编写我自己的多部分消息）

我想知道以下是什么意思（电子邮件的纯文本部分和 html 部分之间的部分）以及如何为我自己的程序计算它以生成多部分电子邮件：

```
This is a multi-part message in MIME format.

------=_NextPart_32252.1057009685.31.001
Content-Type: multipart/alternative;
    boundary="----=_NextPart_32252.1057009685.31.002"
Content-Description: Message in alternative text and HTML forms

------=_NextPart_32252.1057009685.31.002 
```

（如此[处所示](http://mailformat.dan.info/headers/mime.html)）

对于帖子部分，其余的消息代码对我来说很有意义。

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-04-27T19:42:38.713

**您在边界分隔符内看到的数字不一定意味着任何东西**（尽管[RFC](http://www.ietf.org/rfc/rfc2046.txt)并不排除实现者试图包含某些含义）。  

它们必须是唯一的，并且不包含在它们封装的部分中。

来自[**RFC 2046**](http://www.ietf.org/rfc/rfc2046.txt)：

> **5.1。多部分媒体类型**
> 
>   
>   
> 
> 在多部分实体的情况下，其中一个或多个不同的数据集组合在一个主体中，“多部分”媒体类型字段必须出现在实体的标题中。正文必须包含一个或多个正文部分，每个部分前面都有**一个边界分隔线**...    
> 
>   
>   
> 
> 如前所述，每个正文部分前面都有一个包含边界分隔符的边界分隔符行。  **边界分隔符不得出现在任何封装部分内，单独出现在一行上或作为任何行的前缀**......
> 
>   
>   
> 
> ...
> 
>   
>   
> 
> **5.1.1。通用语法**
> 
>   
>   
> 
> 多部分实体的 Content-Type 字段需要一个参数，“boundary”。**然后，边界分隔符行被定义为完全由两个连字符**（“-”，十进制值 45）组成的行，后跟来自 Content-Type 标头字段的边界参数值、可选的线性空格和终止 CRLF。
> 
>   
>   
> 
> ...
> 
>   
>   
> 
> **注意：**  因为边界分隔符不能出现在被封装的主体部分中，所以用户代理必须小心选择唯一的边界参数值。  **边界参数值[可能]是一种算法的结果，该算法旨在生成边界定界符，该边界定界符在要封装的数据中已经存在的概率非常低，而无需预先扫描数据。**  ... 可能的最简单的边界分隔线类似于“---”，闭合边界分隔线为“-----”。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:39:04.337

他们没有任何意义。它们只是一个随机字符串，不会出现在电子邮件正文中。它们仅用于标记嵌入消息的开始和停止位置。

# c# - 如何在 VS 2008/C# 中获得类似 Eclipse 的类大纲？

> ID：794971
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T19:37:58.147
> 
>         
> 
> 标签：c#, visual-studio-2008, eclipse, user-interface

我最近刚刚开始将 VS2008 用于一个新的工具项目，并且在 Eclipse/Java 上花费了很多时间。我缺少的一件事是我可以发誓的事情是我最后一次使用 VS2005 - 课程大纲。

我说的是 Eclipse 中的基本大纲，您可以在其中查看类成员、方法等并单击它们以导航到它们。

唯一听起来可能是（但不是）的是类视图。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-04-27T19:42:29.943

这可能是您发现的最接近的插件：

*   [源代码大纲 Power Toy](http://sourcecodeoutliner.codeplex.com/)

（左侧的窗口是它添加到 Visual Studio 的内容）

[替代文本 http://i3.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=SourceCodeOutliner&DownloadId=3493](http://i3.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=SourceCodeOutliner&DownloadId=3493)

*   “您可以将 Source Code Outliner 停靠在任何地方，例如代码编辑器窗口旁边的 Visual Studio 窗口左侧。”

*   “单击 Source Outliner 中的方法或变量名称，与您单击的内容相关的代码将显示在代码编辑器窗口顶部附近。”

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T21:32:10.273

JetBrains 整形器。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2010-09-17T13:24:36.513

这是我必须做的：

打开对象浏览器（视图->对象浏览器）。它将作为选项卡打开。

右键单击选项卡并选择“可停靠”选项。然后它将作为一个浮动的窗口打开。

我有 2 台显示器，所以其中一台有 Visual Studio，另一台有 Object Browser 窗口。如果您在对象浏览器中单击某些内容，它将带您到 Visual Studio 编辑器中定义的位置。

与 Eclipse 大纲不同（我也想念它），但这是我在不添加插件的情况下找到的最接近的大纲。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T19:40:54.177

试试这个菜单选项：

> `View > Class View`

默认的键盘快捷键是

> `Control + Shift + C`

# .net - C#/.NET - 自定义二进制文件格式 - 从哪里开始？

> ID：794977
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-04-27T19:40:15.083
> 
>         
> 
> 标签：.net, file, binary, file-format, binary-data

我需要能够以自定义二进制文件格式存储一些数据。我以前从未设计过自己的文件格式。它需要是一种在 C#、Java 和 Ruby/Perl/Python 世界之间穿梭的友好格式。

首先文件将包含记录。一个 GUID 字段和一个 JSON/YAML/XML 数据包字段。我不确定用什么作为分隔符。逗号、制表符或换行符之类的东西似乎太脆弱了。Excel 是做什么的？还是 XML 之前的 OpenOffice 格式？您应该使用 ASCII 字符 0 还是 1。不知道从哪里开始。有没有关于这个主题的文章或书籍？

此文件格式稍后可能会扩展为包含“标题部分”。

注意：首先我将在 .NET 中工作，但我希望该格式易于移植。

**更新：**

“数据包”的处理可能很慢，但文件格式内的导航不能。所以我认为 XML 不在讨论范围内。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-04-27T19:49:28.430

看看使用“协议缓冲区”怎么样？设计为一种高效、可移植、版本兼容的通用二进制格式，它为您提供[谷歌库中的 C++、Java 和 Python，以及](http://code.google.com/p/protobuf/)[社区端口](http://code.google.com/p/protobuf/wiki/OtherLanguages)中的 C#、Perl、Ruby 和其他？

请注意， Guid 没有特定的数据类型，但您可以使用（基本上） a 将其作为消息填充`byte[]`。

**通常**对于 .NET 工作，我会推荐[protobuf-net （但作为作者，我有些偏见） - 但是，如果您打算稍后使用其他语言，则使用 Jon 的](http://code.google.com/p/protobuf-net/)[dotnet-protobufs](http://github.com/jskeet/dotnet-protobufs/tree/master)可能会做得更好（长期）；这将为您提供跨平台的熟悉 API（其中 protobuf-net 使用 .NET 习语）。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-27T19:44:52.233

ASCII 字符 0 或 1 每个占用几个位（就像任何其他字符一样），所以如果你这样存储它，你的“二进制”文件将比​​它应该的大几倍。在零和一的文本文件不完全是二进制文件:)

您可以使用[BinaryWriter](http://msdn.microsoft.com/en-us/library/system.io.binarywriter.aspx)将原始数据直接写入[文件流](http://msdn.microsoft.com/en-us/library/system.io.filestream.aspx)。您需要弄清楚的唯一部分是将您的内存格式（通常是某种对象图）转换为 BinaryWriter 可以使用的字节序列。

*但是*，如果您的主要兴趣是可移植性，我建议您完全反对二进制格式。~~XML 正是为解决可移植性和互操作性问题而设计的。作为一种文件格式，它既冗长又繁重，但这是您为解决这些问题所做的权衡。~~如果人类可读的格式不在桌面上，[Marc 的答案](https://stackoverflow.com/questions/794977/c-net-custom-binary-file-formats-where-to-start/795014#795014)就是要走的路。无需重新发明便携轮！

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2015-04-29T14:06:12.270

我将尝试添加一些用于创建可移植二进制文件格式的一般提示。

请注意，发明二进制文件格式意味着记录其中的位必须如何传输以及它们的含义。它不是编码，而是文档。

现在提示：

1.  决定如何处理**字节序**。好的和简单的方法是一劳永逸地决定它。在普通 PC（即 x86）上使用时，选择最好是小端，以节省转换（性能）。

2.  创建**标题**。是的，总是有一个标题是个好主意。文件的第一个字节应该能够告诉你，你在搞乱什么格式。

    *   从能够识别您的格式的魔法开始（ASCII 字符串就可以了）

    *   添加版本。添加文件格式的版本不会有什么坏处，它可以让您稍后进行向后兼容。

3.  最后，添加数据。现在，数据的格式将是特定的，它将始终基于您的确切需求。基本上，数据将存储在某种数据结构的二进制映像中。数据结构是您需要提出的。

如果您需要通过某种索引随机访问您的数据，[B-Trees](https://en.wikipedia.org/wiki/B-tree)是一种选择，而如果您只需要大量的数字来将它们全部写入然后读取它们，那么“数组”就可以解决问题。

此外，您可以使用[TLV（类型-长度-值）](https://en.wikipedia.org/wiki/Type-length-value "TLV")概念来实现前向兼容性。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T19:53:09.980

这取决于您将写入二进制文件的数据类型以及二进制文件的用途。它们是类对象还是只是记录数据？如果是记录数据，我建议将其放入 xml 格式。这样，您可以包含模式验证以验证文件是否符合您的标准。java 和 .NET 中都有工具可以从 / 到 xml 格式导入和导出数据。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T21:05:21.993

假设您的格式是：

```
 struct Format
    {
        struct Header // 1
        {
            byte a;
            bool b1, b2, b3, b4, b5, b6, b7, b8;
            string name;
        }
        struct Container // 1...*
        {
            MyTypeEnum Type;
            byte[] data;
        }
    }

    enum MyTypeEnum
    {
        Sound,
        Video,
        Image
    } 
```

然后我会有一个顺序文件：

* * *

字节 // 一个

字节 // b

int // 名称大小

char[] // 名称（具有上面指定的大小，记住 .NET 中的 char 是 16 位）

int // MyTypeEnum 类型

int // 数据大小

byte[] // 数据（具有上面指定的大小）

* * *

然后，您可以根据需要重复最后三行。

要阅读，请使用`BinaryReader`它支持读取字节、整数和字节序列。还有一个`BinaryWriter`。

此外，请记住 Microsoft .NET（因此在 Windows/Intel 机器上）是 little-endian。`BinaryReader`和也是如此`BinaryWriter`。

# windows - nmake - 关于转义的简单问题

> ID：794981
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-04-27T19:41:12.490
> 
>         
> 
> 标签：windows, macros, nested, escaping, nmake

我想制作下面的 nmake 代码来生成包含以下内容的 check.mak 文件：$(A) 而我收到以下错误：“NMAKE：致命错误 U1040：内部错误：宏扩展”有什么建议吗？我的 nmake 版本是 9.00.30729.01 (VC 2008)。

```
OPTION = A
FILE = check.mak

all :
    @echo "$$($(OPTION))" > $(FILE) 
```

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T23:05:11.690

这看起来像 NMAKE 中的一个错误。经过一些实验，我发现以下解决方法可以为您提供所需的输出，尽管它有点难看：

```
OPTION=A
FILE=check.mak
LPAREN=(
RPAREN=)

all:
        echo $$$(LPAREN)$(OPTION)$(RPAREN) > $(FILE) 
```

对于它的价值，我还用我公司销售的 NMAKE 模拟器尝试了你的原版，发现它能够毫无错误地处理 makefile，这就是为什么我有信心说观察到的行为是NMAKE 实现而不是 NMAKE 语法的限制。

希望有帮助，

埃里克·梅尔斯基

# log4j - 如何让 log4j 根据日期和大小滚动文件？

> ID：794987
> 
>         
> 
> 赞同：27
> 
>         
> 
> 时间：2009-04-27T19:42:15.920
> 
>         
> 
> 标签：log4j

所以 log4j 带有两个现有的日志滚轮：RollingFileAppender 和 DailyRollingFileAppender。有没有人听说过一个可以同时做前者的附加程序？

我需要一个附加器，它会根据文件大小滚动日志文件，但也会将当前日期附加到它。

我一直在考虑创建自己的 appender，但是如果已经创建了一个 appender，为什么不节省时间并使用它呢？

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-04-27T19:48:20.587

看起来您想要混合使用[http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/DailyRollingFileAppender.html](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/DailyRollingFileAppender.html)和[http://logging.apache.org/log4j/1.2/apidocs /org/apache/log4j/RollingFileAppender.html](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/RollingFileAppender.html)。

你必须自己编码。好消息是：您只需“合并”这些类功能，不需要“低级”新代码。

* * *

## 回答 #2

> 赞同：11
> 
>             
> 
> 时间：2010-06-06T07:28:25.813

我知道这篇文章有点晚了，但你可以试试 TimeAndSizeRollingAppender。它在 Apache 2.0 许可下免费提供，从[www.simonsite.org.uk](http://www.simonsite.org.uk)下载。

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2012-03-13T13:32:51.610

“companions”项目中的 Log4J Extras 提供了一系列滚动策略，包括您正在寻找的内容。

APIDoc：[http](http://logging.apache.org/log4j/extras/apidocs/index.html) ://logging.apache.org/log4j/extras/apidocs/index.html
主页：[http ://logging.apache.org/log4j/extras/](http://logging.apache.org/log4j/extras/)

* * *

## 回答 #4

> 赞同：6
> 
>             
> 
> 时间：2016-11-27T17:22:40.760

## 使用 Log4j

正如@JavaJigs 所说，可以使用Log4j 的附加功能。

首先，如果您使用的是 Maven，请将其添加为依赖项，记住使用相同的 log4j 版本，以避免任何类型的冲突。

```
<!-- you should already have something like this -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>

<!-- add this one, please note the version is the same than log4j -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>apache-log4j-extras</artifactId>
    <version>1.2.17</version>
</dependency> 
```

然后，设置一个 appender 来使用这两种滚动。这是一个快速而肮脏的示例，每分钟滚动一次和/或当日志文件的大小超过 1000 字节时滚动。

```
<appender name="rollout5" class="org.apache.log4j.rolling.RollingFileAppender">
    <rollingPolicy class="org.apache.log4j.rolling.TimeBasedRollingPolicy">
        <param name="ActiveFileName" value="log4j-current.log" />
        <param name="FileNamePattern" value="log4j-%d{HH-mm}.%i.log.gz" />
    </rollingPolicy>
    <triggeringPolicy class="org.apache.log4j.rolling.SizeBasedTriggeringPolicy">
        <param name="MaxFileSize" value="1000" />
    </triggeringPolicy>
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss} %-5p - %m%n" />
    </layout>
</appender> 
```

像往常一样将 appender 添加到 logger。

如果你运行应用程序，你应该得到类似的东西......

```
log4j-current.log
log4j-18-13.1480266729211.log.gz
log4j-18-12.1480266729095.log.gz
log4j-18-12.1480266729123.log.gz 
```

显然，文件的数量及其名称取决于您的应用程序的日志记录方式。

如您所见，`%i`占位符被替换为一种随机但不断增加的数字。我无法找到一种方法将其替换为从 0 开始的数字。不过，按字母顺序列出的此类文件应与其历史顺序相匹配。

## 其他想法

我知道您明确提到了 log4j。但是，如果可以的话，为什么不评估迁移到 log4j2 呢？[在这个 log4j2 文档](https://logging.apache.org/log4j/2.x/manual/appenders.html#RollingFileAppender)中，有几个示例似乎可以满足您的需求。

* * *

## 回答 #5

> 赞同：5
> 
>             
> 
> 时间：2013-07-11T16:16:01.587

来不及回复了。但希望这会对某人有所帮助。

将 log4j 依赖项添加到您的 pom.xml 文件

```
 <dependency>
        <groupId>log4j</groupId>
        <artifactId>log4j</artifactId>
        <version>1.2.17</version>
    </dependency> 
```

获取此 FileAppender 实现的副本。感谢此文件的作者。

```
http://haobangshou.googlecode.com/svn/trunk/hbs/APPLICATION/server/common/src/com/hbs/common/appender/TimeSizeRollingFileAppender.java 
```

将此 log4j.xml 文件放在资源文件夹中

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">
<log4j:configuration>
<appender name="consoleAppender" class="org.apache.log4j.ConsoleAppender">
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss} [%p] %c{1} %m%n"/>
    </layout>
</appender> 

<appender name="debug" class="com.myproject.log.TimeSizeRollingFileAppender">
    <param name="File" value="log/debug.log"/>
    <param name="MaxBackupIndex" value="300"/>
    <param name="Encoding" value="GB2312"/>
    <!--CHANGE THIS TO A LARGER SIZE EG : 20MB. USE 1MB TO TEST IF THE SETTING WORKS.-->
    <param name="MaxFileSize" value="1MB"/>
    <param name="DatePattern" value="'.'yyyy-MM-dd"/>
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%d{ISO8601} %p [%c] - [%m]%n"/>
    </layout>
</appender>

<!--CHANGE name TO ROOT PACKAGE NAME OF YOUR PROJECT THAT YOU WANT TO LOG.-->
<logger name="com.myproject" additivity="false">
    <level value="debug"/>
    <appender-ref ref="consoleAppender"/>
    <appender-ref ref="debug"/>
</logger>

<logger name="org.springframework" additivity="false">
    <level value="debug"/>
    <appender-ref ref="consoleAppender"/>
    <appender-ref ref="debug"/>
</logger>

<logger name="org.hibernate" additivity="false">
    <level value="debug"/>
    <appender-ref ref="consoleAppender"/>
    <appender-ref ref="debug"/>
</logger>

<root>
    <priority value="INFO"></priority>
    <appender-ref ref="consoleAppender"/>
    <appender-ref ref="debug"/>
 </root> 
```

要进行快速测试：

```
import org.apache.log4j.Logger;

public class Main {

    static public void main(String[] args) {
        Logger log = Logger.getLogger(Main.class);
        for(int i = 0; i < 10000; i ++)
            log.info("Testing log");
        }
} 
```

完毕！！

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2012-12-11T09:17:20.430

我们使用您[在此处](http://haobangshou.googlecode.com/svn/trunk/hbs/APPLICATION/server/common/src/com/hbs/common/appender/TimeSizeRollingFileAppender.java)看到的类。它按照您的描述工作并扩展了 FileAppender。

# c# - Visual Studio 2005/2008 加载项

> ID：794991
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T19:42:39.680
> 
>         
> 
> 标签：c#, visual-studio-2008, visual-studio-2005, add-in

我正在为 Visual Studio 2005/2008 编写一个插件。我想访问下图中的控件：[alt text http://img145.imageshack.us/img145/2773/82813838.jpg](http://img145.imageshack.us/img145/2773/82813838.jpg)

怎么做？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-06-02T22:56:31.803

Visual Studio 2008 中的 Intellisense 也适用于 javascript 源代码。您不需要额外的插件，而只需要 javascript 的文档文件。它也适用于 Prototype 库，但您不会有任何文档，也不会在链接多个函数时工作，因为它不知道返回类型。

无论如何，这应该是一个不错的开始（因为它适用于 1.6.0 RC1 版本）：
 [Prototype VS2008 Intellisense](http://gatekeeper.opensourceconnections.com/amplify/browser/amplify.js/trunk/javascripts/prototype.intellisense.js?rev=249)

# python - 如何在django中将日期时间转换为python中的字符串

> ID：794995
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-04-27T19:42:52.003
> 
>         
> 
> 标签：python, django

我的模型中有一个日期时间对象。我将它发送到视图，但是在 html 中我不知道要写什么来格式化它。

我在尝试

```
{{ item.date.strftime("%Y-%m-%d")|escape }} 
```

但我明白了

```
TemplateSyntaxError: Could not parse some characters: item.date.strftime|("%Y-%m-%d")||escape 
```

当我只是使用

```
{{ item.date|escape }} 
```

它正在工作，但现在使用我想要的格式。

有什么建议么？

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-04-27T19:44:51.687

尝试使用内置的 Django[日期格式过滤器](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#date)：

```
{{ item.date|date:"Y M d" }} 
```

# linq-to-sql - LINQ To SQL 分组

> ID：794996
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-04-27T19:44:28.100
> 
>         
> 
> 标签：linq-to-sql, tsql

能否请好心人借给我以下 T-SQL 查询的 Linq To SQL 查询

```
SELECT e.EmployeeName, MIN(a.SignInTime), MAX(a.SignOutTime)
FROM Employee e
LEFT OUTER JOIN Attendance a ON e.Id = a.EmployeeId AND CAST (CONVERT (varchar, a.SignInTime, 106) AS DATETIME) = '28 APR 2009'
GROUP BY e.EmployeeName 
```

我拥有的数据库架构如下

```
Employee: {Id: int identity PK, EmployeeName: varchar(200) NOT NULL}
Attendance: {Id: int identity PK, EmployeeId: int FK(Employee(Id)) NOT NULL, SignInTime: DateTime, SignOutTime: DateTime} 
```

**注意：**转换噱头仅用于截断 SignInTime 中的时间部分以进行比较

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-27T20:05:53.197

这绝对是一个挑战。这很丑陋，但它可以解决问题。它准确地返回您正在寻找的内容。对于没有出勤的员工，您将返回具有空次的姓名。

```
var selectedDate = new DateTime(2009,4,28);
var query = from e in db.Employees
    join a in db.Attendances on e.Id equals a.EmployeeId into Temp          
    from t in Temp.DefaultIfEmpty()
    where t.SignInTime == null || (t.SignInTime >= selectedDate && t.SignInTime < selectedDate.AddDays(1))
    group t by e.EmployeeName into grouped          
    select new
    {
       Employee = grouped.Key,
       FirstSignInTime = grouped.Min(a => a.SignInTime),
       LastSignOutTime = grouped.Max(a => a.SignOutTime)
    }; 
```

**这是该表达式发出的 SQL：**

```
DECLARE @p0 DateTime = '2009-04-27 00:00:00.000'
DECLARE @p1 DateTime = '2009-04-28 00:00:00.000'

SELECT MIN([t1].[SignInTime]) AS [FirstSignInTime], MAX([t1].[SignOutTime]) AS [LastSignOutTime], [t0].[EmployeeName] AS [Employee]
FROM [Employee] AS [t0]
LEFT OUTER JOIN [Attendance] AS [t1] ON [t0].[Id] = [t1].[EmployeeId]
WHERE ([t1].[SignInTime] IS NULL) OR (([t1].[SignInTime] >= @p0) AND ([t1].[SignInTime] < @p1))
GROUP BY [t0].[EmployeeName] 
```

*这与您的原始 SQL 非常接近。我添加了 where "t.SignInTime == null" 以便它返回有出勤的员工，但如果这不是你想要的，你可以删除它。*

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-27T20:04:18.880

这应该有效：

```
from e in db.Employee
join a in db.Attendance
      on new { e.Id, Column1 = (DateTime?)Convert.ToDateTime(Convert.ToString(a.SignInTime)) }
  equals new { Id = a.EmployeeId, Column1 = "28 APR 2009" } into a_join
from a in a_join.DefaultIfEmpty()
group new {e, a} by new {
  e.EmployeeName
} into g
select new {
  g.Key.EmployeeName,
  Column1 = g.Min(p => p.a.SignInTime),
  Column2 = g.Max(p => p.a.SignoutTime)
} 
```

# java - 如何从 Java 中的 Matlab 获取结果？

> ID：794997
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-04-27T19:44:36.740
> 
>         
> 
> 标签：java, matlab, interop

我可以从 Java 调用`.m`Matlab 中的文件，并且工作正常，但我想从 Matlab 检索结果并在 Java 中显示它们。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2011-07-09T00:17:12.620

[matlabcontrol](http://matlabcontrol.googlecode.com)是一个 Java API，它允许您这样做。它允许在 MATLAB 中调用 eval 和 feval 并将结果返回给 MATLAB。该[演练](http://code.google.com/p/matlabcontrol/wiki/Walkthrough)通过示例解释了如何执行此操作。该演练使用内置的 MATLAB 函数和命令，但您可以将其与您自己的 .m 文件一起使用，因为使用 matlabcontrol 就像与 MATLAB 的命令行窗口进行交互一样。******** 
```****