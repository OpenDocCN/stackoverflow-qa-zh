# StackOverflow 问答 000295000-000295999

# inversion-of-control - IoC，在构造函数中将注入与参数混合？

> ID：295005
> 
> 赞同：3
> 
> 时间：2008-11-17T06:28:19.103
> 
> 标签：inversion-of-control

我是[控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)(IoC) 的新手，所以我想知道处理我想要传递数据结构/参数以及将对象注入类的情况的最佳策略。

一个简单的例子：

```
public class EmailSender
{

    public EmailSender(string toEmail, string Subject, String body,
                       ILogger emailLogger)
    {.....}
} 
```

这里最好的策略是什么？估计不能直接注入吧？

我想我需要将所有字符串参数作为设置器而不是`Ilogger`在构造函数中，或者相反？

还是我错了？

Ps 我知道上面的例子很糟糕，`toEmail`应该`body`在一个单独的方法调用中传递，但这只是为了做一个例子。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T06:32:50.933

不，您应该能够在构造函数调用中指定字符串。诚然，我通常希望那些作为方法参数传递的更“瞬态”值：

```
public class EmailSender
{
    private readonly ILogger emailLogger;

    public EmailSender(ILogger emailLogger)
    {
         this.emailLogger = emailLogger;
    }

    public void SendEmail(string toEmail, string subject, string body)
    {
         // ...
    }
} 
```

这样，同样`EmailSender`可以用来发送许多电子邮件 - 电子邮件本身的详细信息“流经”发件人，而不是成为其中的一部分。

编辑：鉴于对问题的编辑，尚不完全清楚剩下的内容。如果您真的在询问如何将字符串指定为构造函数参数，那将取决于您使用的 IoC 框架。如果您可以指定框架，我们可能会为您提供适当的语法。

# sql - 在 Oracle 中，“缓冲区获取”实际上指的是什么？

> ID：295009
> 
> 赞同：26
> 
> 时间：2008-11-17T06:35:10.133
> 
> 标签：sql, oracle

我目前正在与 Oracle DBA 打交道，他已向我发送了一些他已完成的分析。他的报告中的一个术语是“缓冲区获取”，知道这实际上意味着什么吗？我的猜测是从缓冲区中检索到的字节，但我真的不知道。这是一些示例输出：

```
 Buffer Gets    Executions  Gets per Exec  %Total Time (s)  Time (s) Hash Value
--------------- ------------ -------------- ------ -------- --------- ----------
    137,948,100       31,495        4,380.0   98.4  6980.57   6873.46 4212400674
Module: JDBC Thin Client
SELECT fieldOne, fieldTwo, fieldThree, fieldFour, fieldFive FROM TableExample
WHERE fieldOne = 'example' 
```

知道'Gets per Exec'的含义也很方便，因为我猜它们是相关的？我是程序员，但不是 DBA。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-17T08:26:57.833

Oracle 存储被安排成给定大小（例如 8k）的块。表和索引由磁盘上的一系列块组成。当这些块在内存中时，它们占用一个缓冲区。

当 Oracle 需要一个块时，它会执行一个**缓冲区获取**。首先，它检查它是否已经在内存中拥有它需要的块。如果是这样，则使用内存版本。如果它在内存中没有该块，则它将它从磁盘读取到内存中。

因此，一个缓冲区 get 表示 Oracle 必须访问一个块的次数。读取可能已经从内存（缓冲区）中得到满足，或者已经导致物理 IO。

由于物理 IO 非常昂贵（与内存或 CPU 相比），一种调优方法是专注于减少缓冲区获取，假设将继续减少物理 IO。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-17T13:29:15.523

只是为了回答您的问题的一部分，WW 没有：

“Gets per Exec”只是获取除以语句的执行次数。您可能有一个非常有效但执行多次的语句；这将有大量的总缓冲区获取，但每次执行的获取率较低。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2014-02-20T12:17:04.023

我只是想稍微考虑一下。

首先，Dave Costa 是对的，Buffer 获得 exec 才是真正重要的。

有了这些数据，我们不能说它们是否太多，因为你没有说你的查询提取了多少条记录

如果您提取 4000 条记录，则可能有 4,380 条记录 如果您只提取 1 条记录，它们可能太多了

那么，有多少记录呢？

还有更多，你有sql计划看看吗？你有 fieldOne 的索引吗？

正确的索引是调优查询的第一个“秘密”。

只是我的 2 美分

# c++ - 在没有手动分配缓冲区的情况下使用 sprintf

> ID：295013
> 
> 赞同：9
> 
> 时间：2008-11-17T06:38:45.460
> 
> 标签：c++, c, string, memory

在我正在处理的应用程序中，日志记录工具`sprintf`用于格式化写入文件的文本。所以，像：

```
char buffer[512];
sprintf(buffer, ... ); 
```

当发送的消息对于手动分配的缓冲区来说太大时，这有时会导致问题。

有没有办法获得`sprintf`行为而不必像这样手动分配内存？

编辑：虽然`sprintf`是 C 操作，但我正在寻找 C++ 类型的解决方案（如果有的话！）让我获得这种行为......

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-17T06:53:59.173

您可以使用 asprintf(3) （注意：非标准）为您分配缓冲区，因此您无需预先分配它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-17T06:52:37.587

不，您不能使用它`sprintf()`来分配足够的内存。替代方案包括：

*   用于`snprintf()`截断消息 - 不能完全解决您的问题，但可以防止缓冲区溢出问题
*   双倍（或三倍或......）缓冲区 - 除非您处于受限环境中
*   使用 C++`std::string`和`ostringstream`- 但你会失去 printf 格式，你必须使用 << 运算符
*   使用带有类似 printf 的 % 运算符的[Boost Format](http://www.boost.org/doc/libs/1_41_0/libs/format/doc/format.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-17T08:33:05.840

我也不知道避免分配的版本，但是如果 C99 sprintfs 允许将 NULL 指针作为字符串。效率不高，但这会给你完整的字符串（只要有足够的内存可用）而不会冒溢出的风险：

```
length = snprintf(NULL, ...);
str = malloc(length+1);
snprintf(str, ...); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-17T06:44:08.477

“日志工具使用 sprintf 格式化写入文件的文本”

`fprintf()`不施加任何大小限制。如果您可以将文本直接写入文件，请这样做！

但是，我假设有一些中间处理步骤。如果您知道需要多少空间，则可以使用它`malloc()`来分配那么多空间。

有时像这样的一种技术是分配一个合理大小的缓冲区（在 99% 的情况下足够大），如果不够大，则将数据分解为您一个一个处理的块。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T06:45:53.623

使用 sprintf 的 vanilla 版本，无法防止数据覆盖传入的缓冲区。无论内存是手动分配的还是在堆栈上分配的，这都是正确的。

为了防止缓冲区被覆盖，您需要使用更安全的 sprintf 版本之一，例如 sprintf_s（仅限 Windows）

[http://msdn.microsoft.com/en-us/library/ybk95axf.aspx](http://msdn.microsoft.com/en-us/library/ybk95axf.aspx)

# php - 是否可以使用 call_user_func_array() 通过引用传递参数？

> ID：295016
> 
> 赞同：46
> 
> 时间：2008-11-17T06:43:03.707
> 
> 标签：php, reference, callback

使用时`call_user_func_array()`我想通过引用传递参数。我该怎么做。例如

```
function toBeCalled( &$parameter ) {
    //...Do Something...
}

$changingVar = 'passThis';
$parameters = array( $changingVar );
call_user_func_array( 'toBeCalled', $parameters ); 
```

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-17T06:46:27.850

要通过引用传递 using `call_user_func_array()`，数组中的参数必须是引用 - 它是否通过引用传递并不取决于函数定义。例如，这将起作用：

```
function toBeCalled( &$parameter ) {
    //...Do Something...
}

$changingVar = 'passThis';
$parameters = array( &$changingVar );
call_user_func_array( 'toBeCalled', $parameters ); 
```

有关详细信息，请参阅[`call_user_func_array()`函数文档](http://au2.php.net/manual/en/function.call-user-func-array.php)中的注释。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-08-12T18:21:04.120

直接地，这可能是不可能的——但是，如果你可以控制你正在实现的函数*和**调用*它的代码——那么有一个你*可能会*发现合适的解决方法。

您是否可以将有问题的变量嵌入到对象中？如果你这样做，代码看起来（有点）像这样。

```
function toBeCalled( $par_ref ) {
    $parameter = $par_ref->parameter;
    //...Do Something...
    $par_ref->parameter = $parameter;
}

$changingVar = 'passThis';
$parembed = new stdClass; // Creates an empty object
$parembed->parameter = array( $changingVar );
call_user_func_array( 'toBeCalled', $parembed ); 
```

您会看到，PHP 中的对象变量只是对对象*内容的**引用*--- 因此，如果您将对象传递给函数，则函数对对象*内容*所做的任何更改都将反映在调用的内容中函数也可以访问。

 **只要确保调用函数永远不会对对象变量*本身*进行赋值- 否则会导致函数基本上*丢失*引用。函数所做的任何赋值语句都必须*严格*针对对象的*内容*。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-02-08T20:28:26.680

这是通过双重引用来工作的，当修改 $parameter 变量时会修改原始变量。

```
$a = 2;
$a = toBeCalled($a);
echo $a //50

function toBeCalled( &$par_ref ) {
    $parameter = &$par_ref;
    $parameter = $parameter*25;
} 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-09-08T12:57:06.560

除非您在此处使用已弃用的功能。您将在 PHP5 中生成一个警告，使其不够完美。

> 警告：调用时传递引用已被弃用；如果您想通过引用传递它，请修改运行时函数名称的声明。如果您想启用调用时传递引用，您可以在您的 INI 文件中将 allow_call_time_pass_reference 设置为 true ...

不幸的是，据我所知，似乎没有任何其他选择。

# java - 语言特定数据结构的 protobuf 序列化

> ID：295017
> 
> 赞同：2
> 
> 时间：2008-11-17T06:43:17.760
> 
> 标签：java, protocol-buffers

使用谷歌的[Protocul Buffers](http://code.google.com/p/protobuf/)，我有一个已经用 Java 编写的服务，它已经有自己的数据结构。我想使用 pb 来传递消息，我正在寻找一种方法将我在 Java 中拥有的现有数据结构序列化为 pb。我可以从头开始定义 pb 中的所有数据结构，这可能是正确的方法，但我太懒了。那么，假设我有一个 Java （或其他支持的语言）的 Person 类或一个具有数十个属性的 Plane 类，有没有办法将该类序列化为 pb？我可以有一个平面类型的 pb 属性吗？（当 Plane 不是 pb 时，它是一个 Java 类）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T07:05:19.200

不，你不能。protobuf 消息中的字段始终是原语（基本上是数字、字符串和字节数组）、protobuf 枚举（生成为 Java 枚举）或 protobuf 消息——当然，还有所有这些的重复版本。

您可能会编写一个使用反射从 Java 类创建 .proto 文件的工具，但我怀疑您会发现手动完成它会更快。特别是，如果您*确实*使用了反射，则需要确保始终使用相同的名称生成字段，以保持兼容性。您*可以*做的一件事是注释 Java 类并编写代码以基于这些注释生成 .proto 文件 - 甚至可能使用注释直接序列化为 proto 格式。就我个人而言，我建议以*某种*方式创建 .proto 文件，而不是有效地重写 PB 项目 - 否则在已经彻底测试过的代码中引入错误的风险很大。

如果您*确实*创建了一个注释系统，我相信 Kenton Varda（以及 PB 社区的其他成员）会对它感兴趣。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-11-22T22:27:18.307

我能想到的一种方法是在 protobuf 中有一个字符串字段，并使用 Java 的原始序列化将 Java 类序列化到该字段。这样，假设消息的接收者知道如何读取/反序列化它，我可以轻松地将 Java 序列化为 Java 消息。

不过，这种技术也有缺点。仅举几例：

1.  它只是 Java 到 Java（没有 C++、Python 或其他）
2.  它不如原生 protobufs 高效（解析/序列化和消息大小都不明智）
3.  数据结构的逻辑分散在几个地方，一些在 protobufs 定义文件中，一些在其他 Java 类中，这使得事情更难维护。

但是 - 它可以在短期内完成工作。

# c++ - 长度为零的数组

> ID：295027
> 
> 赞同：54
> 
> 时间：2008-11-17T06:54:23.853
> 
> 标签：c++, arrays, visual-c++, flexible-array-member

我正在重构一些旧代码，并发现很少有包含零长度数组的结构（如下）。当然，编译指示会抑制警告，但我未能通过包含此类结构的“新”结构创建（错误 2233）。数组'byData'用作指针，但为什么不使用指针呢？还是长度为 1 的数组？当然，没有添加任何评论来让我享受这个过程......有什么理由使用这样的东西吗？在重构这些方面有什么建议吗？

```
struct someData
{
   int nData;
   BYTE byData[0];
} 
```

注意它是 C++、Windows XP、VS 2003

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-17T16:53:22.210

是的，这是一个 C-Hack。
创建任意长度的数组：

```
struct someData* mallocSomeData(int size)
{
    struct someData*  result = (struct someData*)malloc(sizeof(struct someData) + size * sizeof(BYTE));
    if (result)
    {    result->nData = size;
    }
    return result;
} 
```

现在你有了一个带有指定长度数组的 someData 对象。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-11-17T06:59:34.390

不幸的是，在结构的末尾声明一个长度为零的数组有几个原因。它本质上使您能够拥有从 API 返回的可变长度结构。

Raymond Chen 就该主题发表了一篇出色的博文。我建议你看看这篇文章，因为它可能包含你想要的答案。

请注意，在他的帖子中，它处理大小为 1 而不是 0~~的数组。之所以如此，是因为零长度数组是标准中较新的条目。~~ 他的帖子应该仍然适用于您的问题。

[http://blogs.msdn.com/oldnewthing/archive/2004/08/26/220873.aspx](http://blogs.msdn.com/oldnewthing/archive/2004/08/26/220873.aspx)

**编辑**

注意：尽管 Raymond 的帖子说 0 长度数组在 C99 中是合法的，但实际上它们在 C99 中仍然不合法。这里应该使用长度为 1 的数组，而不是长度为 0 的数组

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-17T06:58:04.923

这是一个旧的 C hack，允许灵活大小的数组。

在 C99 标准中，这不是必需的，因为它支持 arr[] 语法。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-05-21T06:39:50.837

您对“为什么不使用大小为 1 的数组”的直觉是正确的。

代码做错了“C struct hack”，因为零长度数组的声明是违反约束的。这意味着编译器可以在编译时立即拒绝您的 hack，并带有停止翻译的诊断消息。

如果我们想进行黑客攻击，我们必须偷偷溜过编译器。

进行“C struct hack”（与可追溯到 1989 年 ANSI C 并且可能更早的 C 方言兼容）的正确方法是使用大小为 1 的完全有效的数组：

```
struct someData
{
   int nData;
   unsigned char byData[1];
} 
```

此外，`sizeof struct someData`之前零件的尺寸不是 ，而是`byData`使用以下公式计算的：

```
offsetof(struct someData, byData); 
```

要在 中分配`struct someData`42 个字节的空间`byData`，我们将使用：

```
struct someData *psd = (struct someData *) malloc(offsetof(struct someData, byData) + 42); 
```

请注意，`offsetof`即使在数组大小为零的情况下，此计算实际上也是正确的计算。你看，`sizeof`整个结构可以包括填充。例如，如果我们有这样的事情：

```
struct hack {
  unsigned long ul;
  char c;
  char foo[0]; /* assuming our compiler accepts this nonsense */
}; 
```

`struct hack`由于成员的原因，很可能会填充的大小以进行对齐`ul`。如果`unsigned long`是四个字节宽，那么很可能`sizeof (struct hack)`是 8，而`offsetof(struct hack, foo)`几乎可以肯定是 5。该`offsetof`方法是获取数组之前结构前一部分的准确大小的方法。

所以这将是重构代码的方法：使其符合经典的、高度可移植的 struct hack。

为什么不使用指针？因为指针占用了额外的空间并且必须被初始化。

不使用指针还有其他充分的理由，即指针需要地址空间才能有意义。struct hack 是可外部化的：也就是说，在某些情况下，这种布局符合外部存储，例如文件、数据包或共享内存的区域，在这种情况下，您不需要指针，因为它们没有意义。

几年前，我在内核和用户空间之间的共享内存消息传递接口中使用了 struct hack。我不想要那里的指针，因为它们只对生成消息的进程的原始地址空间有意义。该软件的内核部分使用自己在不同地址的映射来查看内存，因此一切都基于偏移计算。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-02-09T20:20:43.860

值得指出 IMO 进行尺寸计算的最佳方法，在上面链接的 Raymond Chen 文章中使用。

```
struct foo
{
    size_t count;
    int data[1];
}

size_t foo_size_from_count(size_t count)
{
    return offsetof(foo, data[count]);
} 
```

第一个条目与所需分配结束的偏移量也是所需分配的大小。IMO 这是一种非常优雅的尺寸计算方式。可变大小数组的元素类型是什么并不重要。offsetof（或 Windows 中的 FIELD_OFFSET 或 UFIELD_OFFSET）始终以相同的方式写入。没有 sizeof() 表达式会意外搞砸。

# python - 来自 ConfigParser 的就地替换

> ID：295028
> 
> 赞同：0
> 
> 时间：2008-11-17T06:55:05.240
> 
> 标签：python, configuration-files

我手头有一个非常棘手的情况（按照我的标准）。我有一个脚本需要从[ConfigParser](https://docs.python.org/2/library/configparser.html)读取脚本变量名。例如，我需要阅读

```
self.post.id 
```

来自 .cfg 文件并将其用作脚本中的变量。我如何实现这一目标？

我想我的查询不清楚。.cfg 文件类似于：

```
[head]
test: me
some variable : self.post.id 
```

这个 self.post.id 将在运行时被替换，从脚本中获取值。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T07:02:53.820

测试.ini：

```
[head]
var: self.post.id 
```

Python：

```
import ConfigParser

class Test:
  def __init__(self):
      self.post = TestPost(5)
  def getPost(self):
      config = ConfigParser.ConfigParser()
      config.read('/path/to/test.ini')
      newvar = config.get('head', 'var')
      print eval(newvar) 

class TestPost:
  def __init__(self, id):
      self.id = id

test = Test()
test.getPost()   # prints 5 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T14:53:43.857

这有点傻。

您有一种动态语言，以源代码形式分发。

您正在尝试对源进行更改。这是易于阅读的纯文本 Python。

为什么不直接更改 Python 源代码并停止使用配置文件呢？

拥有这样的代码块要容易得多

```
# Change this for some reason or another
x = self.post.id # Standard Configuration 
# x = self.post.somethingElse # Another Configuration
# x = self.post.yetAnotherCase # A third configuration 
```

更改它与更改配置文件一样复杂。而且你的 Python 程序更简单、更清晰。

# sharepoint - 为单个列表注册事件处理程序

> ID：295035
> 
> 赞同：3
> 
> 时间：2008-11-17T07:02:12.870
> 
> 标签：sharepoint, moss, event-handling

我有一个共享点事件处理程序，我想为单个列表激活它，而不是站点中的所有列表。我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T08:15:09.980

得到了答案。我们需要运行此代码，可能在控制台应用程序中。我仍然不知道如何在添加事件处理程序后删除它......

```
string siteUrl = Console.ReadLine();
SPSite site = new SPSite(siteUrl);
SPWeb web = site.OpenWeb();
string listName = Console.ReadLine();

SPList list = web.Lists[listName];
string assemblyName = "Issue.EventHandler, Version=1.0.0.0, Culture=Neutral,    PublicKeyToken=89fde668234f6b1d";
string className = "Issue.EventHandler.IssueEventHandler";

list.EventReceivers.Add(SPEventReceiverType.ItemUpdated, assemblyName, className); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T07:11:16.067

只是那个列表还是每个站点中的那个列表？我一直在测试事件发生时运行的代码，并且我使用了来自 u2u 的一个[不错的小工具](http://www.wssdemo.com/Lists/Resources/DispForm.aspx?ID=731)，它允许我为每个列表添加或删除事件处理程序。

[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms475328.aspx)是一本不错的入门读物。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T15:30:55.433

另一种选择是“ [SharePoint 事件管理器](http://www.codeplex.com/speventsmanager)”。

> 事件管理器是 SharePoint 的一项功能，允许管理员直接使用浏览器管理附加到其站点列表和文档库的事件。
> 
> 这个简单的功能可以通过列表设置菜单上的新项目来管理列表和文档库上的事件。
> 
> 您可以查看、添加和删除事件，甚至可以从程序集名称中自动找到感兴趣的类和事件。
> 
> 您可以在此处下载此功能，并使用“stsadm -o addolution -filename GatWeb.SharePoint.EventsManager.wsp”进行安装。
> 
> 此功能已本地化为法语和英语。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-17T17:43:42.233

我最近在我们的 Sharepoint SIG 上就这个问题发表了演讲。幻灯片和工具[可在此处获得](http://www.mobiusdevelopment.com/dev/Download.asp?ArticleID=1802313708980020849)。你可以

*   编写一个控制台应用程序来执行此操作
*   编写一个使用控制台应用程序中的代码部署到正确列表的功能
*   使用 PowerShell
*   使用 Brian Wilson 的[管理工具](http://blogs.msdn.com/brianwilson/archive/2007/03/18/event-handlers-part-3-register-event-handlers-plus-free-site-settings-manage-event-handlers-add-on.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-06T13:23:48.287

您可以使用此代码删除事件处理程序：

```
for (int i = 0; i < olist.EventReceivers.Count; i++) {
    olist.EventReceivers[i].Delete();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T08:58:37.597

看看我之前发布的 u2u 工具附带的代码。当您使用事件处理程序时，它是一个方便的工具。

# .net - WPF TwoWay 使用转换器绑定到当前源？

> ID：295042
> 
> 赞同：1
> 
> 时间：2008-11-17T07:05:42.943
> 
> 标签：.net, wpf, data-binding

当您绑定到当前源 (Path=".") 并使用转换器时，WPF 中的数据绑定是否存在问题？在这种情况下，双向绑定似乎不起作用。

我知道我可以更改路径，但我希望能够将“名称”值传递给转换器。

我无法让以下示例正常工作：

```
<Window x:Class="WpfTest.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:l="clr-namespace:WpfTest"
Title="Window1" Height="600" Width="600">

<Window.Resources>
    <l:Person x:Key="myDataSource" Name="Cam"/>

    <l:TestConverter x:Key="converter" />
</Window.Resources>

<StackPanel>
    <StackPanel.DataContext>
        <Binding Source="{StaticResource myDataSource}"/>
    </StackPanel.DataContext>

    <TextBox>
        <TextBox.Text>
            <Binding 
                Path="." 
                UpdateSourceTrigger="PropertyChanged"  
                Converter="{StaticResource converter}" 
                ConverterParameter="Name" 
                />
        </TextBox.Text>
    </TextBox> 
    <TextBlock Text="{Binding Path=Name}"/>
</StackPanel>
</Window>

class TestConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return Reverse(value, parameter);
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return Reverse(value, parameter);
    }

    private static object Reverse(object value, object parameter)
    {
        if (value == null)
            throw new ArgumentNullException("value", "value is null.");
        if (parameter == null)
            throw new ArgumentNullException("parameter", "parameter is null.");

        Person p = (Person)value;

        if (parameter.ToString() == "Name")
        {
            StringBuilder sb = new StringBuilder();
            for (int i = p.Name.Length - 1; i >= 0; i--)
            {
                sb.Append(p.Name[i]);
            }

            return sb.ToString();
        }

        throw new NotImplementedException();
    }
}

public class Person:INotifyPropertyChanged
{
    private string name;
    public string Name
    {
        get
        {
            return name;
        }
        set
        {
            name = value;

            if (PropertyChanged != null)
                PropertyChanged(this, new PropertyChangedEventArgs("Name"));
        }
    }
    public event PropertyChangedEventHandler PropertyChanged;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T16:32:21.910

卡梅伦，

我不太确定你想要做什么。

你绑定到“。” 这意味着您需要能够从字符串转换为 Person 以及从 Person 转换为字符串，但您的实现不这样做。但是随后您将更改 Resource myDataSource 指向的实例。我不确定你能做到这一点。

如果您只想修改字符串，为什么不将 Binding.Path 指定为“名称”并提供一个转换器来对字符串执行您想要的操作？

山姆

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T15:47:10.033

您不能对当前源使用两种方式绑定（带或不带转换器）。

在没有转换器的情况下考虑一下，当绑定到当前源时，您没有要设置的属性 - 除了通常从另一个源派生的 DataContext 本身（例如，它可能由 ItemControl 设置为列表项) 所以没有必要覆盖 DataContext 属性。

因此 WPF 不会尝试将更改绑定回源，因为它无法更改源。

Now, a custom ValueConverter can obviously do anything, including things that are not just value conventions but are useful in your specific situation, but a value converter is just supposed to convert the value type - and the system has nothing to do with the result of the value converter in this case, it has nowhere to assign it to - so there's no point in calling the value converter.

# vsto - 如何捕获 PowerPoint VSTO 文本更改事件？

> ID：295043
> 
> 赞同：2
> 
> 时间：2008-11-17T07:10:36.707
> 
> 标签：vsto, powerpoint

我正在开发一个 PowerPoint C# VSTO 加载项。每当更改幻灯片的标题文本时，我希望能够捕获文本更改事件。

如何附加一个自定义事件处理程序，该处理程序会在标题文本更改时触发？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-03T21:28:35.510

两件事：1）这是在 VBA 中，但应该很容易移植到 C# 和 VSTO，2）“文本更改”的事情有点棘手。我可以告诉你“你在标题框中吗”——剩下的就更琐碎了。它与查找原始状态与任何更改有关。应该可以吧，我还没做。

要在 PPT VBA 中挂钩选择更改，您需要一个类和一个模块。在课堂上，把这个：

```
Public WithEvents PPTEvent As Application
Private Sub PPTEvent_WindowSelectionChange(ByVal Sel As Selection)
    With Sel
        If .Type = ppSelectionText Then
            Dim sh As Shape: Set sh = .ShapeRange(1)
            If sh.Type = msoPlaceholder Then
                originalText = sh.TextFrame.Text
                Dim placeHolderType As Integer
                placeHolderType = sh.PlaceholderFormat.Type
                If placeHolderType = ppPlaceholderTitle Then
                    MsgBox "this is a title placeholder"
                End If
            End If
        End If
    End With
End Sub 
```

将类命名为“clsPPTEvents”。然后在任何模块中，输入以下内容：

```
Public newPPTEvents As New clsPPTEvents
Sub StartEvents()
    Set newPPTEvents.PPTEvent = Application
End Sub
Sub EndEvents()
    Set newPPTEvents.PPTEvent = Nothing
    Set newPPTEvents = Nothing
End Sub 
```

按下`F5`StartEvents，这将启用钩子。在 EndEvents 上按 F5 以禁用它。

# sql-server - 如何在 ms 访问中显示来自 sql server 的图像

> ID：295044
> 
> 赞同：0
> 
> 时间：2008-11-17T07:11:00.077
> 
> 标签：sql-server, sql-server-2005, image, ms-access

我有一个 MS sql 服务器数据库。有一个表格，其中包含“图像”类型的列之一。现在，客户想要从 MS 访问中读取数据。他想以一种形式显示图像。我从未使用过访问权限，也不知道如何在那里做简单的事情。任何帮助将不胜感激。

谢谢，拉姆吉

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T11:38:18.680

与其将存储的图像写入文件以显示它们，不如使用 ASP 来显示图像并在 Access 表单上使用 Web 浏览器控件来显示页面。我没有试过这个。

如何显示存储在 BLOB 字段中的图像：http: [//support.microsoft.com/kb/173308](http://support.microsoft.com/kb/173308)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T08:05:21.013

我认为你可以通过使用流来做到这一点。将图像从字段流式传输到未绑定的图像控件。我们使用相同的过程来打开存储在 SQL Server 数据库中的文档和其他二进制数据。

* * *

另一方面，Access 有一个可以链接到表中的字段的 Image 控件。这对用户来说应该容易得多！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-23T12:26:25.060

您可以将常规图像控件放在窗体上，并在当前事件中声明 MyPic.PictureData=PicField。

或者您可以使用 AccessImagine，它非常适合 MS Access 中的图片，并且不需要编写脚本。你可以在这里下载 - [http://access.bukrek.net/download](http://access.bukrek.net/download)

# lua - 如何从 Lua 脚本中确定系统的操作系统？

> ID：295052
> 
> 赞同：20
> 
> 时间：2008-11-17T07:24:06.587
> 
> 标签：lua, environment-variables

好的，我需要从 Lua 脚本中确定系统的操作系统，但是 Lua 本身没有用于此的 API，所以我使用 os.getenv() 并查询环境变量。在 Windows 上检查环境变量“OS”给了我系统操作系统的名称，但是在 Windows 和大多数风格的 Unix 上是否存在一些可以检查的变量？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2013-01-20T15:08:01.763

你可以试试`package.config:sub(1,1)`。它返回路径分隔符，`'\\'`在 Windows 和`'/'`Unix 上...

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-28T21:05:00.437

在 Unix 系统上，尝试 os.capture 'uname' ，其中 os.capture 定义如下：

```
函数 os.capture(cmd, raw)
  本地 f = 断言（io.popen（cmd，'r'））
  本地 s = assert(f:read('*a'))
  f:关闭（）
  如果原始则返回 s 结束
  s = string.gsub(s, '^%s+', '')
  s = string.gsub(s, '%s+$', '')
  s = string.gsub(s, '[\n\r]+', ' ')
  返回
结尾

```

这将有助于所有风格的 unix 和 Mac OSX。如果失败，您可能在 Windows 系统上？或者检查 os.getenv 'HOME'。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2015-06-21T00:06:46.257

编译 lua 时，根据编译的操作系统，它的配置略有不同。

因此，在“包”模块中设置的许多字符串可以用来区分它是为哪个系统编译的。

例如，当 lua 加载作为动态库分发的基于 C 的模块时，它必须知道用于这些库的扩展名，这在每个操作系统上都不同。

因此，您可以使用如下函数来确定操作系统。

```
local BinaryFormat = package.cpath:match("%p[\\|/]?%p(%a+)")
if BinaryFormat == "dll" then
    function os.name()
        return "Windows"
    end
elseif BinaryFormat == "so" then
    function os.name()
        return "Linux"
    end
elseif BinaryFormat == "dylib" then
    function os.name()
        return "MacOS"
    end
end
BinaryFormat = nil 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-17T07:34:19.140

我想如果你只需要 Windows/Unix 检测，你可以检查文件系统是否存在 /etc 或 /bin 或 /boot 目录。此外，如果您需要知道它是哪个发行版，大多数 Linux 发行版在 /etc 中都有一个小文件显示发行版和版本，遗憾的是它们的名称都不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T07:28:37.700

Unix 应该有 $HOME 变量（而 Windows 没有），所以你可以检查它（在检查 OS 变量为空之后）。

# xml - 我做了什么来破坏我的 xForms？

> ID：295055
> 
> 赞同：0
> 
> 时间：2008-11-17T07:27:45.037
> 
> 标签：xml, xforms

我正在学习 xForms，但显然不够好，因为我无法弄清楚为什么[这段代码](http://www.logomachist.info/temp/fix_me.xhtml.xml)不起作用。

它在带有 xForms 扩展的 FF2 中解析，但不呈现表单控件。IE7 和 X-Smiles 给我带来了不同的问题，但我不确定这些问题是因为我的 xForms 还是因为其他原因——直到我让它在 FF2 中工作之前我真的无法判断。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-17T09:19:57.470

不幸的是，该文档包含大量问题，我将依次逐一介绍。

1) 最大的问题出现了几次，似乎源于`model`UI 和 UI 之间的一些混淆。这两者在 XForms 中是完全独立的野兽，它遵循模型-视图-控制器设计模式。因此，您需要记住，其中的所有`model`内容都与 UI 中的所有内容完全分开。两者的关系很简单，就是 UI 控件可能会绑定到你`model`的 s 中的实例数据节点。实际上，就您的文档而言，这意味着您的`select1`和`repeat`元素不应该是元素的子`model`元素。只有`instance`和`bind`动作元素可能是 的子元素`model`。

2）您正在使用多个`model`元素，这在如此简单的形式中是不必要的（因为每个元素`model`可能包含许多`instance`s 和`bind`s）。我标记这个的原因是因为你通过使用多个`model`s 引入了几个潜在的陷阱，最好通过尽可能坚持一个来避免`model`。例如，`instance`XPath 函数不会跨`model`s 工作，因此您必须非常小心它们之间的数据依赖关系。此外，UI 控件会根据`model`它所绑定的内容进行刷新，这在过去经常给我带来问题，因为控件显然不能正常刷新。

3) 您尝试使用一个`repeat`元素将一个子元素应用于`bind`许多节点。这是错误的，因为`repeat`它是 UI 元素，而不是模型元素。但是，由于`bind`采用`nodeset`属性而不是`ref`属性，因此您实际上根本不需要 a `repeat`。相反，您可以这样做：

```
<xf:bind nodeset="//want" readonly="true()" /> 
```

4) 在您的许多 UI 控件上，您同时指定了 bind 属性和 ref 属性。这些属性是互斥的，因为它们代表实现同一事物的不同方式。ref 属性应包含标识要将 UI 控件绑定到的实例数据节点的 XPath。bind 属性应该包含已在别处定义的 bind 元素的 id（在这种情况下，bind 元素本身将通过其 nodeset 属性标识控件绑定到的节点）。因此，通过在同一个 UI 控件上使用这两个属性，您自相矛盾。

5) 在某些地方，您尝试使用 ref 属性将控件绑定到 UI 中的另一个元素。控件只能绑定到实例数据。

6) 你有一个`setvalue`inside a `repeat`，你试图在`xforms-value-changed`事件上调用它。这个事件不会被分派给`repeat`元素，所以你`setvalue`永远不会被调用。该`xforms-value-changed`事件仅分派给核心表单控件，这些控件在[XForms 规范中](http://www.w3.org/TR/xforms11/)[定义](http://www.w3.org/TR/xforms11/#elems-form-controls)为：

输入|秘密|文本区域|输出|上传|范围|触发器|提交|选择|选择1

7）this question的另一个答案提到您将`model`元素放在文档正文中是错误的。不幸的是，我没有足够的声誉在那里发表评论，但我只是想指出答案实际上是错误的。尽管将`model`元素放在文档中已成为惯例`head`，但 XForms 规范中并没有强制要求这样做。事实上，由于浏览器的限制，一个主要的 XForms 处理器[Ubiquity XForms](http://ubiquity-xforms.googlecode.com/)实际上要求`model`s 在 document中。`body`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T09:57:04.470

你不应该把你的模型放在身体部分。相反，所有模型定义都应该在 head 部分。就像现在一样，您的代码不符合标准并且很难理解。

[Xforms Wiki 书](http://en.wikibooks.org/wiki/XForms)是学习 XForms 的一个很好的资源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T20:44:33.960

我将添加 xf:repeat, xf:group, xf:input,... 不能是 xf:model 的子级

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T14:33:56.193

[XForms 验证器](http://xformsinstitute.com/validator/)是一个很好的起点。之后，我建议从一个工作示例开始，逐渐添加您的代码，以观察哪个部分失败。

# python - 将字符串转换为预先存在的变量名

> ID：295058
> 
> 赞同：35
> 
> 时间：2008-11-17T07:32:09.987
> 
> 标签：python

如何将字符串转换为[Python](http://en.wikipedia.org/wiki/Python_%28programming_language%29)中的变量名？

例如，如果程序包含一个名为的对象，该对象`self.post`包含一个名为的变量，我想做类似的事情：

```
somefunction("self.post.id") = |Value of self.post.id| 
```

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-17T16:26:46.633

注意：在从用户输入的输入中获取要查找的名称的任何情况下都**不要使用 eval。**例如，如果这来自网页，则没有任何东西可以阻止任何人进入：

```
__import__("os").system("Some nasty command like rm -rf /*") 
```

作为论据。[更好的是使用getattr()](https://docs.python.org/2/library/functions.html#getattr)限制明确定义的查找位置，例如字典或实例。例如，要查找 self 的“post”值，请使用：

```
varname = "post"
value = getattr(self, varname)  # Gets self.post 
```

类似地设置它，使用 setattr()：

```
value = setattr(self, varname, new_value) 
```

要处理[完全限定名称](https://en.wikipedia.org/wiki/Fully_qualified_name)，例如“post.id”，您可以使用以下函数代替 getattr() / [setattr()](https://docs.python.org/2/library/functions.html#setattr)。

```
def getattr_qualified(obj, name):
    for attr in name.split("."):
        obj = getattr(obj, attr)
    return obj

def setattr_qualified(obj, name, value):
    parts = name.split(".")
    for attr in parts[:-1]:
        obj = getattr(obj, attr)
    setattr(obj, parts[-1], value) 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-11-17T07:37:00.227

正如 Stack Overflow 问题*[Inplace replacement from ConfigParser](https://stackoverflow.com/questions/295028/)*中所引用的，您正在寻找`eval()`：

```
print eval('self.post.id') # Prints the value of self.post.id 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-11-17T08:47:58.273

此外，[Python中有一个](http://en.wikipedia.org/wiki/Python_%28programming_language%29)**[globals()](https://docs.python.org/2/library/functions.html#globals)**函数，它返回一个包含所有已定义变量的字典。你也可以使用这样的东西：

```
print globals()["myvar"] 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-11-14T01:32:15.757

您可以执行 Geo 推荐的操作，或者使用：

```
>>> wine = 'pinot_noir'
>>> vars()[wine] = 'yum'
>>> pinot_noir
'yum' 
```

~~注意： vars() 和 globals() 是一样的，我只是习惯于使用 vars()~~ 我很惊讶没有人在这个问题上叫我！无论如何，它`vars()`和*`locals()`*那个是一样的。

# javascript - 从一个窗口获取值到另一个窗口 - JavaScript

> ID：295059
> 
> 赞同：0
> 
> 时间：2008-11-17T07:33:03.043
> 
> 标签：javascript

是否可以从第一页到第二页获取值，但没有`FORM`？

我们要不要使用

```
window.parent.document.getElementById("").value.. 
```

但这在`popup`窗口中工作，但我需要在从第一页重定向到第二页的两个页面之间使用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T07:51:17.937

如果要从一个页面重定向到另一个页面，则必须使用表单元素从页面传递到页面或使用查询字符串值。就是这样，Javascript对上一页的结构一无所知..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T12:57:20.750

或者你可以使用cookies...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T13:11:18.353

您也可以通过调用`site.com/index.php?info=value`和转义`value`. URL 可以动态更改，如下所示：

```
<input type="text" id="the_value" />
<a href="#" onclick="return updateURL()" id="the_link">Click me</a>
<script type="text/javascript">
function updateURL()
{
    document.getElementById('the_link').href =
        'site.com/index2.php?info=' +
        encodeURIComponent(document.getElementById('the_value'));
    return true;
}
</script> 
```

# java - 在 Java 上嵌入 XULRunner 应用程序

> ID：295060
> 
> 赞同：5
> 
> 时间：2008-11-17T07:33:20.577
> 
> 标签：java, embed, xul, xulrunner

**我的目标是让 Limewire(JAVA) 和 Songbird(XULRunner) 一起运行。**

我在想最好的方法是在 JAVA 摆动面板中运行 XUL 应用程序（songbird）。还有其他方法吗？

将 GUI 完全放在 XUL 中，然后以某种方式访问​​我的 JAVA 对象会更好还是可能？

我该怎么做呢？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T11:16:45.190

看看[JRex](http://jrex.mozdev.org/)，因为它可能让您窥探一些想法。

除此之外，我也会研究关于[犀牛皮](http://zelea.com/project/textbender/o/rhinohide/description.xht)的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-06T17:16:38.147

看看[DJ Native Swing](http://djproject.sourceforge.net/ns/ "DJ 本地摇摆")，一个使用 SWT 和 Xulrunner 的本地 Swing 实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T09:51:45.477

我目前正在研究 XUL 的新产品，我遇到了[JavaXPCOM](https://developer.mozilla.org/en/JavaXPCOM "JavaXPCOM")，它允许 Java 代码与 XPCOM 对象进行交互。我仍然围绕着 Mozilla 堆栈，但据我了解，所有 XULRunner 应用程序都使用 XPCOM。因此，您似乎应该能够使用这种方法嵌入 Songbird。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T21:07:29.590

Mozilla 的官方 XUL 实现，严重依赖 Gecko。Gecko 不是用 Java 编写的，也不是嵌入在 AWT/Swing/SWT 中（至少不使用 JNI）。

所以，简短的回答是：不。您必须要么使用 JNI，要么使用繁重、复杂和不完整的第三方库。

但是，JavaXPCOM 似乎允许嵌入 Gecko：[https](https://developer.mozilla.org/en/JavaXPCOM) ://developer.mozilla.org/en/JavaXPCOM 但在这种情况下，您将依赖 Gecko ......而且我不知道这是否足以运行 Songbird。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T18:21:53.793

我会检查 Limewire 的源代码。如果 UI 和应用程序的其余部分之间有一个清晰的分离，我会尝试找到一个解决方案来从 Songbird 扩展中实例化和调用 Limewire 的非 UI 代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T17:06:36.170

我会看看 eclipse swt 的 xulrunner 嵌入：http: [//www.eclipse.org/swt/faq.php#whatisbrowser](http://www.eclipse.org/swt/faq.php#whatisbrowser)

# module - 在 Sitefinity 中创建一个新模块

> ID：295063
> 
> 赞同：1
> 
> 时间：2008-11-17T07:35:35.283
> 
> 标签：module, controls, command, sitefinity

我正在尝试为 Sitefinity 创建一个新模块。我的模块基于链接到文档的示例模块。[http://www.sitefinity.com/help/developer-manual/adding-modules-pluggable-explained.html](http://www.sitefinity.com/help/developer-manual/adding-modules-pluggable-explained.html)

我想要的是一个视频列表。在左侧 - 命令面板 - 应该有 3 个按钮 - “视频”、“艺术家”和“流派”。

无论何时选择其中任何一个，在右侧，都应显示视频/艺术家/流派列表。

这个概念很简单，但我正在努力解决的是实际放置代码的位置。

我应该将列表直接硬编码到 CommandPanel.ascx 中吗？我应该为视频、艺术家和流派创建新控件吗？或者我应该有一个控件和多个面板，我可以显示/隐藏它们？以及如何连接左侧的菜单项和更改右侧的面板？

注意。将视频、艺术家和流派都放在左边可能是错误的。也许它应该只是“视频”，而艺术家和流派应该是单独的模块？

我不需要一个完整的答案，只需要一些关于如何在这个框架中编码的方向，以及一切应该去哪里。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T13:01:28.583

嗨，我刚刚看到这个出现了整个 Sitefinity 模块过程，特别是对于您正在尝试做的事情。在 Sitefinity 块上检查[具有新架构的准系统模块](http://blogs.sitefinity.com/Ivan/Posts/09-01-25/Sitefinity_3_6_beta_-_sample_bare_bones_module_on_the_new_backend_architecture.aspx)。我认为这会满足您的需求，因为您可以为每个视频、艺术家和流派以及他们的所有视图（如创建、编辑等）创建一个单独的“视图”。

# performance - 是否有存储性能测试结果的“结果服务器”，具有良好的分析工具？

> ID：295065
> 
> 赞同：3
> 
> 时间：2008-11-17T07:37:05.640
> 
> 标签：performance, performance-testing

我需要一个“结果服务器”，它可以存储我的原始测试数据（服务器 CPU、内存使用等）、创建报告模板（例如用户数与响应时间）、基于模板生成实时报告并执行复杂的分析（例如如 70/80/90 百分位图，测试之间的数据分布比较等）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T08:51:01.403

如果您在 Microsoft 平台上，请尝试使用 Visual Studio 负载测试功能。它使用 SQL Server 存储测试结果，并为您进行各种分析。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T13:51:31.110

如果钱不是问题，HP 作为一个称为[Performance Center](https://h10078.www1.hp.com/cda/hpms/display/main/hpms_content.jsp?zn=bto&cp=1-11-126-17%5E1582_4000_100__)的工具，它是 Mercury LoadRunner 的网络化版本（HP 不久前是 Mercury；Performance Center 是我的 Mercury 开发的，而不是 HP）以及一些基本的测试管理。

如果您需要更进一步，[HP Quality Center](https://h10078.www1.hp.com/cda/hpms/display/main/hpms_content.jsp?zn=bto&cp=1-11-127-24_4000_100__)（以前的 Mercury 测试目录）提供了额外的功能。

# c++ - 使用 COM 传递数组？

> ID：295067
> 
> 赞同：6
> 
> 时间：2008-11-17T07:39:22.657
> 
> 标签：c++, com

我是一个用 ATL 编写的 COM 对象，用于 C++ 应用程序，我想在两者之间传递一个 BYTE 数组。到目前为止，我对 COM/IDL 的体验仅限于传递简单类型（BSTR、LONG 等）。

有没有一种相对简单的方法可以让 COM 对象将数组传递给调用者？例如，我想传递原始图像 (TIFF) 而不是弄乱临时文件。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-17T07:55:51.843

尝试将安全数组变体传递给 COM 对象。像这样将 BYTE 数组放入 safearray 变体中的东西....

```
bool ArrayToVariant(CArray<BYTE, BYTE>& array, VARIANT& vtResult)
{
SAFEARRAY FAR*  psarray;
SAFEARRAYBOUND sabounds[1]; 

sabounds[0].lLbound=0;
sabounds[0].cElements = (ULONG)array.GetSize();

long nLbound;

psarray = SafeArrayCreate(VT_UI1, 1, sabounds);
if(psarray == NULL)
    return false;

for(nLbound = 0; nLbound < (long)sabounds[0].cElements ; nLbound++){
    if(FAILED(SafeArrayPutElement(psarray, &nLbound, &array[nLbound]))){
        SafeArrayDestroy(psarray);
        return false;
    }
}

VariantFree(vtResult);
vtResult.vt = VT_ARRAY|VT_UI1;
vtResult.parray = psarray;
return true;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T13:40:08.200

如果您希望符合 OLE-Automation，则 SAFEARRAY 是您的最佳选择，并且可能使用其他语言（如 VB6）的 COM 接口。但是在 IDL 中有一个替代方案，例如：-

```
void Fx([in] long cItems, [in, size_is(cItems)] BYTE aItems[]); 
```

这描述了一种方法，其中编组代码可以通过检查第一个参数的值来推断要传输的字节数。

如果您的客户端都是用 C/C++ 编写的，这很好，但我*认为*包含它的接口将不符合自动化要求，因此不能从 VB6 使用，并且*可能*标准编组器将无法进行编组，所以您需要从 IDL 生成您自己的代理/存根 DLL。做起来不难，但比使用 SAFEARRAY 难一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T07:44:52.940

[使用safearrays](http://msdn.microsoft.com/en-us/library/ms221482.aspx)检查。这是一些示例代码：

安全数组作为指向 VARIANT 的指针返回

```
[id(1), helpstring("LogCache")] HRESULT LogCache([out,retval] VARIANT* logCache); 
```

Safearrays 非常易于使用。下面是一些示例代码，它缓存了某个应用程序的最新 1000 条日志消息：

```
 safearray_t<bstr_t> m_logCache;
   ...
   if (m_logCache.size() > 1000)
   {
       m_logCache.pop_back();
   }

   m_logCache.push_front(Msg.str(), 0);

    variant_t LogCache()
    {
        if (!m_logCache.is_empty())
        {
            variant_t cache(m_logCache);
            return cache;
        }
    } 
```

请注意，由于我使用的是[comet COM library](http://www.lambdasoft.dk/Comet/doc/index.html) ，因此几乎可以肯定您的语法会有所不同，但想法/概念是相同的。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-11-17T07:57:45.303

您可以使用 BSTR 传递字节数组。

```
BYTE array[buffer_size];
...
BSTR toBePassed = SysAllocStringByteLen((OLECHAR*)array,length);
YourCOMMethod(toBePassed);
SysFreeString(toBePassed); 
```

在你的方法中：

```
BYTE* pData = (BYTE*)bstrPassed;
DWORD dataLength = SysStringByteLen(bstrPassed); 
```

# javascript - 您是否注意到一些 JSP 与 WebSphere 的不兼容？

> ID：295071
> 
> 赞同：0
> 
> 时间：2008-11-17T07:45:21.007
> 
> 标签：javascript, jsp, websphere

当我们编写 Javascript 表达式时：

```
expression < <%=variableJsp%> 
```

双“<”似乎是一个问题，JSP 没有被解释？

不应该接受这种表达方式是其他服务器的错吗？还是 WebSphere 那个 bug？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T11:26:29.360

您的小代码示例看起来像我们没有问题的事情。

尝试创建一个说明问题的 JSP，仅此而已。要么从头开始创建一个新的，要么删除与问题无关的所有内容。

您可能会发现错误不在您的代码示例中。但是，如果您可以制作一个说明问题的小 JSP 文件（几行），请将其展示给我们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T07:49:12.120

我发现在 jsp 页面上内联 javascript 通常是个坏主意。您的问题只是将 javascript 函数设为外部的原因之一。

虽然我不知道 websphere，但我在其他容器上也遇到过这种情况。

如果您坚持保持内联，您可能可以使用

```
expression &lt; <%=variableJsp%> 
```

# java - groovy.swing.factory.BindProxyFactory 在哪里？

> ID：295073
> 
> 赞同：0
> 
> 时间：2008-11-17T07:48:26.880
> 
> 标签：java, swing, groovy, java-2d

尝试使用 GraphicsBuilder 时，我得到一个`java.lang.NoClassDefFoundError`for `groovy.swing.factory.BindProxyFactory`.

这是我的环境：

```
% java -version
java version "1.6.0_10"
Java(TM) SE Runtime Environment (build 1.6.0_10-b33)
Java HotSpot(TM) Server VM (build 11.0-b15, mixed mode)
% groovy --version
Groovy Version: 1.5.7 JVM: 1.6.0_10
% ls ~/.groovy/lib/graphicsbuilder*
graphicsbuilder-0.6.1.jar
... 
```

这就是我尝试做的事情：

```
 % groovysh
Groovy Shell (1.5.7, JVM: 1.6.0_10)
Type 'help' or '\h' for help.
-------------------------------------------------------------------------------
groovy:000> import groovy.swing.SwingBuilder
groovy:000> import groovy.swing.j2d.GraphicsBuilder  
groovy:000> import groovy.swing.j2d.GraphicsPanel
groovy:000> def gb = new GraphicsBuilder()  
ERROR java.lang.NoClassDefFoundError: groovy.swing.factory.BindProxyFactory
        at groovysh_evaluate.run (groovysh_evaluate:5)
        ... 
```

BindProxyFactoryBean 在哪里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T17:05:53.557

它在 Groovy 1.6 版本中，而不是 1.5.7 版本中。显然 GfxBuilder 6.1 是针对 Groovy 1.6 代码库构建的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T17:53:30.507

对，那是正确的。GfxBuilder 6.1 及更高版本需要 Groovy 1.6.x。

# css - CSS：字体大小：继承 * 70%？

> ID：295085
> 
> 赞同：8
> 
> 时间：2008-11-17T08:09:57.867
> 
> 标签：css, font-size

有没有办法将一个类的字体大小指定为继承字体大小的 70%？

我有一个通用的“按钮”类，它用适当的边框、背景等设置我的按钮。我在多个地方使用它，包括一个字体大小相当小的地方和另一个字体大小相当大的地方。

```
<div style="font-size: 26px;">
Push this: <input class="button" type="submit" value="Go">
</div>
<div style="font-size: 10px;">
Push this too: <input class="button" type="submit" value="Go">
</div> 
```

在这两种情况下，我都希望按钮字体大小约为按钮所在 span 或 div 字体大小的 70%。

我可以用纯 CSS 做到这一点吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-17T12:57:13.483

EM 确实像百分比一样工作，因为基本字体大小始终为 1em，而 .7em 将是该百分比的 70%（同样，1.2em 将相当于基本字体大小的 120%）。尽管您需要在文档正文上定义基本字体大小，但要使其正常工作。通过实验我发现 font-size: 77%; 在所有浏览器中为您提供一个不错的基本尺寸（即它使 1em 以“正常”和可读的尺寸呈现）。您可能需要尝试 75% 到 80% 之间的其他值，具体取决于您要使用的字体系列。还要记住，相对字体大小是累积继承的——例如：

```
<style>
small { font-size: .8em; }
span.tiny { font-size: .8em } 
</style>

<small>This text is 80% of base size where as 
    <span class="tiny">this text is 80% of 80% (or 64%) of base size</span>
</small> 
```

这对您有利，因为您只需为按钮类提供 .7em 的字体大小即可实现您想要的效果（按钮的字体大小将始终为其父对象的 70%）。快乐编码！

**2014年编辑：**

值得指出的是，浏览器对 Root EM 单元的支持现在非常好*，如果您还没有使用它，那么值得研究一下。根 EM (rem) 与根（文档）字体大小相关联，与“正常”EM 不同，它不受嵌套影响 - 它始终与根字体大小相关。虽然`em`'s 对于大多数文本大小仍然非常有用，正是因为它*确实*尊重嵌套，但`rem`它非常适用于边距和填充等内容，您可能不想通过嵌套更改大小（这是左边距未对齐的常见原因） ，但您*确实*希望随根`html`字体大小一起更改大小（通常使用[媒体查询](https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Media_queries)）。

[您可以在 Design Shack 上](http://designshack.net/articles/typography/whats-the-deal-with-em-and-rem/)阅读更多关于 EM 与 REM的信息。

*) IE8 是唯一不支持它的常见浏览器 (~5%) - 如果您需要支持 IE8，只需在声明*前包含一个等效大小（以像素为单位）。*`rem`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-17T08:14:35.080

在 CSS 中，如果你给出一个相对单位，默认情况下它是相对于你继承的大小的。这意味着，您可以将按钮的字体大小定义为“70%”。

字体大小还有另外两个方便的相对单位：em 和 ex。1 em 是字母“M”的宽度，1 ex 是字母“x”的高度——显然也是继承的。

你不应该使用 px 作为字体大小，就像你的例子一样。px 不服从屏幕的 DPI。例如在我的屏幕上，10px 和 26px 都会很小*。*您应该改用“pt”，甚至以“em”开头。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T08:12:33.713

尝试：

```
font-size: 0.7em; 
```

这里有更多信息：[如何](http://www.alistapart.com/articles/howtosizetextincss/)在 A List Apart中调整 CSS 中的文本大小

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T08:29:04.723

```
<input style="font-size: 70%" class="button" type="submit" value="Go"> 
```

?

# .net - dotnet：ListChangedType.ItemDeleted 没用？

> ID：295091
> 
> 赞同：6
> 
> 时间：2008-11-17T08:18:18.957
> 
> 标签：.net, data-binding

IBindingList 的 ListChanged 事件在删除项目时触发类型 ListChangedType.ItemDeleted，可能是用户删除绑定​​到列表的数据网格控件中的一行。问题是该事件中列表中的NewIndex无效，已被删除，并且被删除的项目不可用。应该有一个 ItemDeleting 事件，但我怀疑他们会解决这个问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-01-24T14:19:45.767

是的，这很烦人，但有一个简单的解决方法。我创建了一个`BindingListBase<T>`用于所有列表的类，而不是使用普通的`BindingList<T>`. 因为我的类继承自`BindingList<T>`，所以我可以访问它的所有受保护成员，包括`RemovedItem`方法。

这使我能够在删除项目时拿起。您可以做我所做的事情，并拥有一个 mRemovedItems 列表，我总是将项目添加到该列表中，或者引发您自己的“ItemRemoved”事件。

请参阅下面的代码示例：

```
Public MustInherit Class BindingListBase(Of T)
    Inherits BindingList(Of T)

    Protected mRemovedItems As New List(Of T)

    Protected Overrides Sub ClearItems()
        MyBase.ClearItems()
        mRemovedItems.Clear()
    End Sub

    Protected Overrides Sub RemoveItem(ByVal index As Integer)
        Dim item As T = MyBase.Item(index)

        MyBase.RemoveItem(index)

        mRemovedItems.Add(item)
    End Sub

    Public ReadOnly Property RemovedItems as List(Of T)
        Get
            Return mRemovedItems
        End Get
    End Property
End Class 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T12:25:17.960

它并不是真的为此目的。`NewIndex`是项目被删除时所在的索引，它对于绑定控件能够在它们自己的列表中找到其关联的显示项目并将其删除很有用。

您想使用 启用什么用例`ItemDeleting`？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-19T01:09:19.810

这是我实现 ItemRemoved 事件的 BindingList 类的版本，而不是保留已删除项目的辅助列表

```
public class ItemRemovedEventArgs : EventArgs
{
    public Object Item { get; set; }

    public ItemRemovedEventArgs(Object item)
    {
        this.Item = item;
    }
}

public delegate void ItemRmoveEventHandler(Object sender, ItemRemovedEventArgs e);

public class BindingListRedux<T> : BindingList<T>
{
    public BindingListRedux() : base() { }

    public BindingListRedux(IList<T> list) : base(list) { }

    public event ItemRmoveEventHandler ItemRemoved;

    protected void OnItemRemoved(ItemRemovedEventArgs e)
    {
        if (ItemRemoved != null)
        {
            ItemRemoved(this, e);
        }
    }

    protected override void RemoveItem(int index)
    {
        Object item = base[index];
        base.RemoveItem(index);
        this.OnItemRemoved(new ItemRemovedEventArgs(item));
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-02-06T19:21:12.890

我做了类似于 Adam Valpied 所做的事情，即使用 ListChanging 事件处理程序实现了我自己的类。这让我可以在实际执行之前处理即将从列表中删除的项目。

为了回答 Sunlight 关于用例的问题......除其他事项外，我使用它来删除在包含项目被放入列表时放置在该项目上的事件处理程序。我的数据元素包含在验证期间确定的错误严重性级别，以及它们绑定以将该错误严重性显示为背景颜色的 GUI 元素。当数据元素的错误严重级别改变时，必须更新 GUI 元素。所以我必须在数据元素显示时（无论是单独还是作为正在显示的列表的一部分）在数据元素上放置一个 HighestSeverityChanged 事件处理程序，并且当 GUI 元素未绑定时，我需要删除该事件处理程序数据元素。

# sql - 排序和过滤记录

> ID：295094
> 
> 赞同：0
> 
> 时间：2008-11-17T08:29:04.817
> 
> 标签：sql, filter, sorting

是否有任何已知的模式/算法关于如何以正确的方式执行排序或过滤记录列表（来自数据库）？我目前的尝试涉及使用提供一些过滤和排序选项的表单，然后将这些标准和排序算法附加到我现有的 SQL 中。然而，我发现它很容易被滥用，用户可能会得到他们不应该看到的结果。

我正在构建的应用程序是一个调度程序，我将所有事件存储在数据库表中。然后根据用户的级别/角色/权限，将显示不同的数据子集。因此我的查询可能很复杂

```
SELECT  * 
FROM    app_event._event_view 
WHERE   ((class_id = (SELECT class_id FROM app_event._ical_class WHERE name = 'PUBLIC') AND class_id != (SELECT class_id FROM app_event._ical_class WHERE name = 'PRIVATE') AND class_id != (SELECT class_id FROM app_event._ical_class WHERE name = 'CONFIDENTIAL')) OR user_id = '1') 
        AND calendar_id IN (SELECT calendar_id FROM app_event.calendar WHERE is_personal = 't') 
        AND calendar_id = (SELECT calendar_id FROM app_event.calendar WHERE name = 'personal') 
        AND state_id IN (1,2,3,4,5,6) AND EXTRACT(year FROM dtstart) = '2008' 
        AND EXTRACT(month FROM dtstart) = '11' 
```

由于我更关心提供正确的信息子集，因此目前性能不是主要问题（因为提到的 sql 是由脚本逐句生成的）。我正在考虑将所有这些复杂的 SQL 语句转换为视图，这样生成的 SQL 不合适的机会就会减少。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T14:17:22.087

首先，如果您使用连接，此查询的外观和性能会更好：

```
SELECT  * 
  FROM    
    app_event._event_view EV
    INNER JOIN app_event.calendar C
        ON EV.calendar_id = C.calendar.id
    INNER JOIN app_event._ical_class IC
        ON C.class_id = EV.class_id
  WHERE   
    C.is_personal = 't'
    AND C.name = 'personal'
    AND state_id IN (1,2,3,4,5,6) 
    AND EXTRACT(year FROM dtstart) = '2008' 
    AND EXTRACT(month FROM dtstart) = '11'
    AND (
        IC.name = 'PUBLIC' -- other two are redundant
        OR user_id = '1'
        ) 
```

这是降低复杂性的良好开端。然后，如果您想直接向 SQL 添加额外的过滤器，您可以在末尾附加更多的“AND ...”语句。由于所有条件都与 AND 相关（OR 安全地包含在括号中），因此不可能有人在这些条件之后添加一个条件以某种方式撤消上述条件 - 也就是说，一旦你用一个部分限制了结果子句，如果它与 AND 串在一起，则不能用后面的子句“取消限制”它。（当然，如果这些附加子句靠近用户文本输入，则必须对其进行清理以防止 SQL 注入攻击。）

一般来说，数据库可以比任何其他层更快地过滤，因为在数据库上使用 WHERE 子句通常可以让数据库避免从磁盘读取不必要的记录，这比你可以做的任何事情都慢几个数量级中央处理器。在数据库上排序通常也更快，因为数据库通常可以以这样一种方式进行连接，即记录已经按照您想要的顺序排序。所以，性能方面，如果你能在数据库上做到这一点，那就更好了。

不过，您说性能在这里并不是真正的关键，因此以编程方式在业务逻辑中添加过滤器可能对您来说很好，并且比弄乱 SQL 字符串更容易阅读。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T08:48:48.053

很难理解那个查询，因为我必须大量滚动，而且我不知道数据库......

但是如果权限是“一维的”，例如管理员可以看到所有内容，高级用户可以看到的比管理员少，客人可以看到的比高级用户少，等等：您可以在事件和事件中将权限实现为整数用户，那么

```
select from event where conditions AND event.privilegue <= user.privilegue 
```

如果您将权限值设置为 10 000（高/管理员）、5000、1（最低/访客），您可以稍后在两者之间添加更多级别，而无需更改所有代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T08:57:17.647

使用 ORM 工具或使用以下参数：

```
SELECT  * 
FROM    app_event._event_view 
WHERE
    (
        :p_start_year is null or
        (state_id IN (1,2,3,4,5,6) AND EXTRACT(year FROM dtstart) = :p_start_year)
    )
    and
    (
        :p_date_start is null or
        AND EXTRACT(month FROM dtstart) = :p_date_start
    ) 
```

# jquery - 如何使用带有 jQ uery 的锚来设置文本框的值？

> ID：295095
> 
> 赞同：25
> 
> 时间：2008-11-17T08:30:20.743
> 
> 标签：jquery

我有一个文本框，我想根据锚标记的内部文本设置其值。换句话说，当有人点击这个锚点时：

```
<a href="javascript:void();" class="clickable">Blah</a> 
```

我希望我的文本框填充文本“Blah”。这是我目前正在使用的代码：

```
<script type="text/javascript">
    $(document).ready(function(){
        $("a.clickable").click(function(event){
            $("input#textbox").val($(this).html());
        });  
    });
</script> 
```

在我的 html 中有一个锚标签列表，其中包含“可点击”类和一个 ID 为“文本框”的文本框。

我已经用代码替换了上面的代码，只是用 $(this).html() 显示一个 javascript 警报，它似乎显示了正确的值。我还将 $(this).html() 更改为硬编码字符串，它正确设置了文本框值。但是当我将它们结合起来时，文本框就会被清除。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-17T08:35:47.440

我写了这个代码片段，它工作正常：

```
<a href="#" class="clickable">Blah</a>
<input id="textbox">
<script type="text/javascript">
    $(document).ready(function(){
        $("a.clickable").click(function(event){
            event.preventDefault();
            $("input#textbox").val($(this).html());
        });  
    });
</script> 
```

也许你忘了给你的链接一个“可点击”的类名？

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-11-03T11:26:59.727

要在 jQuery 中为 id 为 ёtextboxё 的文本框赋值，请执行以下操作

```
$("#textbox").val('Blah'); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T09:06:03.853

请注意，在选择器中添加 tagName 前缀比仅使用 id 慢。在您的情况下，jQuery 将获取所有输入，而不仅仅是使用 getElementById。只需使用 $('#textbox')

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-25T09:35:51.503

要在 JQuery 中为 id 为“textbox”的文本框赋值，请执行以下操作

$("#textbox").get(0).value = "blah"

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T09:48:27.387

跟随 redsquare：你不应该在 href 属性中使用像“javascript:void();”这样的 JavaScript 代码 - 这是错误的。更好地使用例如 href="#"，然后在您的事件处理程序中作为最后一个命令：“return false;”。甚至更好 - 在 href 正确链接中使用 - 如果用户禁用了 javascript，网络浏览器会跟随链接 - 在这种情况下，您的网页应该重新加载输入，并填充该链接的值。

# c# - 为您的应用程序请求内存

> ID：295100
> 
> 赞同：0
> 
> 时间：2008-11-17T08:36:52.227
> 
> 标签：c#, sql-server-2005, memory-management

我和[这个人](https://stackoverflow.com/questions/28387/sql-server-2k5-memory-consumption)有类似的问题。主要区别是应用程序并不适用于开发人员环境，因此我需要知道如何优化 Sql Server 使用的空间（可能基于规格的每台机器）。

[我对Ricardo C 的](https://stackoverflow.com/users/10795/ricardo-c)回答很感兴趣，尤其是以下内容：

> 从 SQL Server 文档中提取：
> 
> 最大服务器内存（MB）
> 
> 指定 SQL Server 在启动和运行时可以分配的最大内存量。如果您知道有多个应用程序与 SQL Server 同时运行并且您希望保证这些应用程序有足够的内存来运行，则可以将此配置选项设置为特定值。如果这些其他应用程序（例如 Web 或电子邮件服务器）仅在需要时请求内存，则不要设置该选项，因为 SQL Server 会根据需要向它们释放内存。**但是，应用程序通常会在启动时使用任何可用内存，并且在需要时不会请求更多内存**. 如果以这种方式运行的应用程序与 SQL Server 同时在同一台计算机上运行，​​则将该选项设置为一个值，以保证应用程序所需的内存不是由 SQL Server 分配的。

我的问题是：应用程序如何在需要时从操作系统请求内存？这是编译中内置的东西还是由开发人员管理的东西？在这台机器上运行的两个主要应用程序是 Sql Server 和我正在开发的（相当重量级的）C# 应用程序，我几乎可以肯定我们在向操作系统请求内存方面没有专门做任何事情。有没有正确/必要的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T08:49:53.013

有些应用程序在启动时会分配大量内存，然后在其上运行自己的内存管理系统。这对于具有特定分配模式的应用程序很有用，并且感觉它们可以比运行时系统提供的更通用的内存管理器做得更好。

许多游戏都这样做，因为它们通常非常了解其内存使用模式的外观，并且通常进行了大量优化。默认/系统分配器是通用的，并不总是足够快。[Doom 做到了这一点](http://doom.wikia.com/wiki/Zone_memory)，并且以它而闻名，当然它的代码是可用的并且被广泛讨论。

在像 C# 这样的“托管”语言中，我认为这非常罕见，您无需担心。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T08:49:15.353

每次创建新对象时，您都在要求 .NET 垃圾收集器为您提供内存。如果 GC 在托管堆上没有足够的内存，那么它将向操作系统请求更多。正如另一个问题所说，尽管 SQL Server 旨在将内存归还给它，但它似乎并没有做得很好。这里不会有任何硬性规定，您将不得不猜测 SQL Server 的一些设置，然后测试性能。如果您发布一些有关服务器、数据库大小、应用程序似乎需要多少内存的信息，那么我相信人们会很乐意为您提供一些初始配置的建议。不过有一个警告，我认为更改其内存限制需要重新启动服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T11:32:51.017

这将取决于一些事情 - 特别是操作系统和使用的语言。

例如，在 MacOS Classic 下，启动后不可能分配更多内存 - 我们过去必须使用 Finder 修改分配的内存量，然后重新启动应用程序。那是糟糕的过去。

现代操作系统将允许正在运行的进程请求更多内存——例如在 C 中，您可以使用 alloc()、malloc()、realloc() 或类似方法来请求内存块。在动态语言中，您只需创建对象或变量，并分配更多内存。

在 java 中，JVM 可以访问多少内存是有限制的——这可以通过重新启动 JVM 并向它传递一些参数来改变（听起来像过去的糟糕日子，不是吗？）。

在 Objective-C 中，除了 malloc() 系列函数之外，您还可以在堆上创建对象，使用

```
[object alloc]; 
```

这通常被视为

```
[[object alloc] init]; 
```

请注意，这与在堆栈上创建对象略有不同 - 如果您对编程很认真，学习这两者之间的差异也可能很有用:)

总之 - 程序员需要向操作系统请求更多内存。这可以是隐式的（在动态语言中，通过创建对象，或通过在堆上创建对象）或显式的，例如在 C 中使用 alloc()/malloc()/etc。

# xml - 如何将数据驱动的 SWF 刻录到 CD/DVD？

> ID：295101
> 
> 赞同：1
> 
> 时间：2008-11-17T08:39:30.803
> 
> 标签：xml, flash, actionscript, movie

我有一部电影由一系列读取 XML 的 SWF 文件组成。有没有办法将其刻录到 CD/DVD 或至少将其转换为“可刻录”格式，例如 AVI、MPEG 或 ISO？目前为了刻录它，我必须做一些时髦的屏幕截图并以这种方式将其录制到 DVD 中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T10:12:13.563

Flash CS3 有一种很好的方式可以将任何 swf（包括那些使用脚本的）导出到视频，但由于某种原因，这仅在导出为 .mov 时可用

在 Flash 中打开您的动画，如果您没有可用的 .fla，则制作一个加载您的 swf 的简单包装器也应该可以工作。然后去文件 -> 导出 -> 导出电影，然后选择 Quicktime。根据您的喜好设置各种繁琐的位，然后 Flash 将尽可能快地逐步浏览您的动画，从而为您节省丢帧的风险和不得不等待 1 fps 捕获的风险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T14:38:20.690

你的预期目的是什么？您是希望将 Flash 播放作为演示，还是希望它具有交互性，以便用户可以像通常在网站上一样使用它？

如果您只是想让它播放，那么@grapefrukt 提到的方法可能会正常工作。在电影正常播放的情况下，我遇到了一些问题。正如您所提到的，我们已经提出了将文件截屏为电影的最全面的方法。

如果您希望使其具有交互性，那么您可以使用像[Zinc](http://www.multidmedia.com/)这样的程序来创建 Flash 文件的跨平台可执行文件，然后将它和您的 XML 数据作为应用程序刻录到 CD 中。然后，用户将能够运行可执行文件并与您的文件完全交互。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-20T07:38:28.683

如果您的目标是光盘媒体，则将 XML 嵌入到您的 SWF 中可能会有所帮助。这是一个片段示例——这是使用 JSON 数据，但 XML 文件的工作方式或多或少是相同的。

```
package ost.panda.map.core {

/// ...

public dynamic class Signatories extends EventDispatcher {

    [Embed(source='../build/json/local_all.json',
        mimeType='application/octet-stream')]
    public static var rawSignatoryJSON:Class;

    public static function loadAll():void {
        loadFromJSON(JSON.deserialize(String(new rawSignatoryJSON())));
    }
    /// etc ...
}

} /// package 
```

... 将数据嵌入 SWF 将使 Flash Player 无需多次往返光盘即可读取另一个文件，这在光学媒体的情况下会有所不同。

# c# - 字段和属性有什么区别？

> ID：295104
> 
> 赞同：1374
> 
> 时间：2008-11-17T08:41:38.037
> 
> 标签：c#, oop, properties, field

在 C# 中，是什么让字段与属性不同，什么时候应该使用字段而不是属性？

* * *

## 回答 #1

> 赞同：1188
> 
> 时间：2008-11-17T08:44:18.813

属性公开字段。字段应该（几乎总是）对类保持私有，并通过 get 和 set 属性访问。属性提供了一个抽象级别，允许您更改字段，同时不影响使用您的类的事物访问它们的外部方式。

```
public class MyClass
{
    // this is a field.  It is private to your class and stores the actual data.
    private string _myField;

    // this is a property. When accessed it uses the underlying field,
    // but only exposes the contract, which will not be affected by the underlying field
    public string MyProperty
    {
        get
        {
            return _myField;
        }
        set
        {
            _myField = value;
        }
    }

    // This is an AutoProperty (C# 3.0 and higher) - which is a shorthand syntax
    // used to generate a private field for you
    public int AnotherProperty { get; set; } 
} 
```

@Kent 指出 Properties 不需要封装字段，它们可以对其他字段进行计算，或用于其他目的。

@GSS 指出您还可以执行其他逻辑，例如验证，当访问属性时，这是另一个有用的功能。

* * *

## 回答 #2

> 赞同：302
> 
> 时间：2008-11-17T09:05:28.567

面向对象的编程原则说，一个类的内部工作应该对外界隐藏。如果您公开一个字段，您实质上就是在公开该类的内部实现。因此，我们用属性（或 Java 中的方法）包装字段，使我们能够在不破坏代码的情况下更改实现，这取决于我们。看到我们可以在属性中放置逻辑也允许我们在需要时执行验证逻辑等。C# 3 具有可能令人困惑的自动属性概念。这使我们可以简单地定义属性，C#3 编译器将为我们生成私有字段。

```
public class Person
{
   private string _name;

   public string Name
   {
      get
      {
         return _name;
      }
      set
      {
         _name = value;
      }
   }
   public int Age{get;set;} //AutoProperty generates private field for us
} 
```

* * *

## 回答 #3

> 赞同：196
> 
> 时间：2008-11-17T13:44:00.597

一个重要的区别是接口可以有属性但不能有字段。对我来说，这强调了属性应该用于定义类的公共接口，而字段则用于类的私有内部工作。作为一项规则，我很少创建公共字段，同样我也很少创建非公共属性。

* * *

## 回答 #4

> 赞同：109
> 
> 时间：2008-11-17T14:27:54.750

我会给你几个例子，说明使用可能使齿轮转动的属性：

*   **[延迟初始化](https://en.wikipedia.org/wiki/Lazy_initialization)：**如果您有一个对象的属性加载起来很昂贵，但在代码的正常运行中没有被访问那么多，您可以通过该属性延迟它的加载。这样，它只是坐在那里，但是当另一个模块第一次尝试调用该属性时，它会检查底层字段是否为空 - 如果是，它会继续加载它，调用模块不知道。这可以大大加快对象初始化。
*   **Dirty Tracking：**我实际上是从StackOverflow 上[的问题中了解到的。](https://stackoverflow.com/questions/33469/caching-patterns-in-aspnet)当我有很多在运行期间值可能发生变化的对象时，我可以使用该属性来跟踪它们是否需要保存回数据库。如果一个对象的单个属性没有改变，IsDirty 标志不会被触发，因此在决定需要返回数据库的内容时，保存功能将跳过它。

* * *

## 回答 #5

> 赞同：65
> 
> 时间：2009-06-26T06:32:18.790

使用属性，您可以在属性值更改（又名 PropertyChangedEvent）或更改值以支持取消之前引发事件。

这对于（直接访问）字段是不可能的。

```
public class Person {
 private string _name;

 public event EventHandler NameChanging;     
 public event EventHandler NameChanged;

 public string Name{
  get
  {
     return _name;
  }
  set
  {
     OnNameChanging();
     _name = value;
     OnNameChanged();
  }
 }

 private void OnNameChanging(){       
     NameChanging?.Invoke(this,EventArgs.Empty);       
 }

 private void OnNameChanged(){
     NameChanged?.Invoke(this,EventArgs.Empty);
 }
} 
```

* * *

## 回答 #6

> 赞同：50
> 
> 时间：2014-10-06T06:59:17.637

`Properties`由于他们中的许多人已经解释了and的技术优缺点`Field`，是时候进入实时示例了。

**1.属性允许您设置只读访问级别**

考虑 和 的`dataTable.Rows.Count`情况`dataTable.Columns[i].Caption`。他们来自班级`DataTable`，对我们都是公开的。它们的访问级别的区别在于我们不能将值设置为`dataTable.Rows.Count`但我们可以读取和写入`dataTable.Columns[i].Caption`。可以通过`Field`吗？不！！！只能这样做`Properties`。

```
public class DataTable
{
    public class Rows
    {       
       private string _count;        

       // This Count will be accessable to us but have used only "get" ie, readonly
       public int Count
       {
           get
           {
              return _count;
           }       
       }
    } 

    public class Columns
    {
        private string _caption;        

        // Used both "get" and "set" ie, readable and writable
        public string Caption
        {
           get
           {
              return _caption;
           }
           set
           {
              _caption = value;
           }
       }       
    } 
} 
```

**2\. PropertyGrid 中的属性**

您可能曾`Button`在 Visual Studio 中使用过。它的属性显示在`PropertyGrid`like`Text`等中`Name`。当我们拖放一个按钮时，当我们单击属性时，它会自动找到类`Button`和过滤器`Properties`并显示在`PropertyGrid`其中（即使它们是公共的`PropertyGrid`也不会显示）。`Field`

```
public class Button
{
    private string _text;        
    private string _name;
    private string _someProperty;

    public string Text
    {
        get
        {
           return _text;
        }
        set
        {
           _text = value;
        }
   } 

   public string Name
   {
        get
        {
           return _name;
        }
        set
        {
           _name = value;
        }
   } 

   [Browsable(false)]
   public string SomeProperty
   {
        get
        {
           return _someProperty;
        }
        set
        {
           _someProperty= value;
        }
   } 
```

在中，将显示和`PropertyGrid`的属性，但不会显示。为什么？？？因为 Properties 可以接受[Attributes](https://msdn.microsoft.com/en-us/library/aa288454%28v=vs.71%29.aspx)。如果 where为假，则不会显示。`Name``Text``SomeProperty``[Browsable(false)]`

**3.可以在Properties里面执行语句**

```
public class Rows
{       
    private string _count;        

    public int Count
    {
        get
        {
           return CalculateNoOfRows();
        }  
    } 

    public int CalculateNoOfRows()
    {
         // Calculation here and finally set the value to _count
         return _count;
    }
} 
```

**4、Binding Source中只能使用Properties**

[Binding Source](https://www.codeproject.com/Articles/24656/A-Detailed-Data-Binding-Tutorial)帮助我们减少代码行数。`Fields`不被接受`BindingSource`。我们应该使用`Properties`它。

**5.调试模式**

考虑我们`Field`用来保存一个值。在某些时候，我们需要调试并检查该字段的值在何处变为空。代码行数超过 1000 行的地方就很难做到。这种情况下我们可以使用`Property`并且可以在里面设置调试模式`Property`。

```
 public string Name
   {
        // Can set debug mode inside get or set
        get
        {
           return _name;
        }
        set
        {
           _name = value;
        }
   } 
```

* * *

## 回答 #7

> 赞同：45
> 
> 时间：2013-09-12T14:18:31.537

## 差异 - 用途（何时以及为何）

**字段**是直接在类或结构中声明的变量。类或结构可能具有实例字段或静态字段或两者兼有。通常，您应该*仅将字段用于具有私有或受保护可访问性的变量*。您的类向客户端代码公开的数据*应通过方法、属性*和索引器提供。通过使用这些结构来间接访问内部字段，您可以防止无效的输入值。

**属性**是提供灵活机制来读取、写入或计算私有字段值的成员。属性可以像公共数据成员一样使用，但它们实际上是称为*访问器*的特殊方法。这使得数据可以轻松访问，并且仍然有助于提高*方法的安全性和灵活性*。属性使类能够公开获取和设置值的公共方式，同时隐藏实现或验证代码。get 属性访问器用于返回属性值，而 set 访问器用于分配新值。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2019-06-26T13:24:09.430

尽管字段和属性看起来彼此相似，但它们是两种完全不同的语言元素。

1.  **字段是如何在类级别存储数据的唯一机制。**字段在概念上是类范围内的变量。如果要将一些数据存储到类（对象）的实例中，则需要使用字段。没有其他选择。属性不能存储任何数据，尽管看起来他们可以这样做。见下文。

2.  **另一方面，属性从不存储数据。**它们只是可以以与字段类似的方式在语法上调用的方法对（get 和 set），并且在大多数情况下它们访问（用于读取或写入）字段，这是一些混乱的根源。但是因为属性方法是（有一些限制，比如固定原型）常规 C# 方法，它们可以做任何常规方法可以做的事情。这意味着它们可以有 1000 行代码，可以抛出异常，调用其他方法，甚至可以是虚拟的、抽象的或重写的。属性的特别之处在于，C# 编译器将一些额外的元数据存储到程序集中，可用于搜索特定属性 - 广泛使用的特性。

获取和设置属性方法具有以下原型。

```
PROPERTY_TYPE get();

void set(PROPERTY_TYPE value); 
```

因此，这意味着可以通过定义一个字段和 2 个相应的方法来“模拟”属性。

```
class PropertyEmulation
{
    private string MSomeValue;

    public string GetSomeValue()
    {
        return(MSomeValue);
    }

    public void SetSomeValue(string value)
    {
        MSomeValue=value;
    }
} 
```

这种属性模拟对于不支持属性的编程语言（如标准 C++）来说是典型的。在 C# 中，您应该始终更喜欢属性作为访问字段的方式。

因为只有字段才能存储数据，这意味着类包含的字段越多，该类的内存对象就会越多。另一方面，将新属性添加到类中不会使此类的对象变大。这是示例。

```
class OneHundredFields
{
        public int Field1;
        public int Field2;
        ...
        public int Field100;
}

OneHundredFields Instance=new OneHundredFields() // Variable 'Instance' consumes 100*sizeof(int) bytes of memory.

class OneHundredProperties
{
    public int Property1
    {
        get
        {
            return(1000);
        }
        set
        {
            // Empty.
        }
    }

    public int Property2
    {
        get
        {
            return(1000);
        }
        set
        {
            // Empty.
        }
    }

    ...

    public int Property100
    {
        get
        {
            return(1000);
        }
        set
        {
            // Empty.
        }
    }
}

OneHundredProperties Instance=new OneHundredProperties() // !!!!! Variable 'Instance' consumes 0 bytes of memory. (In fact a some bytes are consumed becasue every object contais some auxiliarity data, but size doesn't depend on number of properties). 
```

尽管属性方法可以做任何事情，但在大多数情况下，它们用作访问对象字段的一种方式。如果您想让其他类可以访问一个字段，您可以通过 2 种方式来完成。

1.  将字段设为公开 - 不可取。
2.  使用属性。

这是一个使用公共字段的类。

```
class Name
{
    public string FullName;
    public int YearOfBirth;
    public int Age;
}

Name name=new Name();

name.FullName="Tim Anderson";
name.YearOfBirth=1979;
name.Age=40; 
```

虽然代码完全有效，但从设计的角度来看，它有几个缺点。因为字段既可以读取也可以写入，因此您不能阻止用户写入字段。您可以应用`readonly`关键字，但这样，您必须仅在构造函数中初始化只读字段。更重要的是，没有什么可以阻止您将无效值存储到您的字段中。

```
name.FullName=null;
name.YearOfBirth=2200;
name.Age=-140; 
```

代码是有效的，所有的赋值都会被执行，尽管它们是不合逻辑的。`Age`有一个负值，`YearOfBirth`是遥远的未来，不对应于 Age 并且`FullName`为空。使用字段，您无法阻止用户`class Name`犯此类错误。

这是具有修复这些问题的属性的代码。

```
class Name
{
    private string MFullName="";
    private int MYearOfBirth;

    public string FullName
    {
        get
        {
            return(MFullName);
        }
        set
        {
            if (value==null)
            {
                throw(new InvalidOperationException("Error !"));
            }

            MFullName=value;
        }
    }

    public int YearOfBirth
    {
        get
        {
            return(MYearOfBirth);
        }
        set
        {
            if (MYearOfBirth<1900 || MYearOfBirth>DateTime.Now.Year)
            {
                throw(new InvalidOperationException("Error !"));
            }

            MYearOfBirth=value;
        }
    }

    public int Age
    {
        get
        {
            return(DateTime.Now.Year-MYearOfBirth);
        }
    }

    public string FullNameInUppercase
    {
        get
        {
            return(MFullName.ToUpper());
        }
    }
} 
```

类的更新版本具有以下优点。

1.  `FullName`并`YearOfBirth`检查无效值。
2.  `Age`不可写。它是从`YearOfBirth`当年开始计算的。
3.  新属性`FullNameInUppercase`转换`FullName`为大写。这是一个有点人为的属性使用示例，其中属性通常用于以更适合用户的格式呈现字段值 - 例如在特定数字`DateTime`格式上使用当前语言环境。

除此之外，属性可以定义为虚拟的或被覆盖的——仅仅因为它们是常规的 .NET 方法。与常规方法相同的规则适用于此类属性方法。

C# 还支持索引器，它们是在属性方法中具有索引参数的属性。这是示例。

```
class MyList
{
    private string[]                 MBuffer;

    public MyList()
    {
        MBuffer=new string[100];
    }

    public string this[int Index]
    {
        get
        {
            return(MBuffer[Index]);
        }
        set
        {
            MBuffer[Index]=value;
        }
    }
}

MyList   List=new MyList();

List[10]="ABC";
Console.WriteLine(List[10]); 
```

**由于 C# 3.0 允许您定义自动属性。**这是示例。

```
class AutoProps
{
    public int Value1
    {
        get;
        set;
    }

    public int Value2
    {
        get;
        set;
    }
} 
```

即使`class AutoProps`只包含属性（或看起来像），它也可以存储 2 个值，并且此类对象的大小等于`sizeof(Value1)+sizeof(Value2)`=4+4=8 个字节。

这样做的原因是简单的。当您定义一个自动属性时，C# 编译器会生成自动代码，其中包含隐藏字段和一个具有访问该隐藏字段的属性方法的属性。这是编译器产生的代码。

这是**ILSpy**从已编译的程序集中生成的代码。类包含生成的隐藏字段和属性。

```
internal class AutoProps
{
    [CompilerGenerated]
    [DebuggerBrowsable(DebuggerBrowsableState.Never)]
    private int <Value1>k__BackingField;

    [CompilerGenerated]
    [DebuggerBrowsable(DebuggerBrowsableState.Never)]
    private int <Value2>k__BackingField;

    public int Value1
    {
        [CompilerGenerated]
        get
        {
            return <Value1>k__BackingField;
        }
        [CompilerGenerated]
        set
        {
            <Value1>k__BackingField = value;
        }
    }

    public int Value2
    {
        [CompilerGenerated]
        get
        {
            return <Value2>k__BackingField;
        }
        [CompilerGenerated]
        set
        {
            <Value2>k__BackingField = value;
        }
    }
} 
```

因此，如您所见，编译器仍然使用字段来存储值——因为字段是将值存储到对象中的唯一方法。

*如您所见，尽管属性和字段具有相似的用法语法，但它们是非常不同的概念。*即使您使用自动属性或事件 - 隐藏字段也是由存储真实数据的编译器生成的。

如果您需要使外部世界（您班级的用户）可以访问字段值，请不要使用公共或受保护字段。字段应始终标记为私有。属性允许您进行值检查、格式化、转换等，并且通常使您的代码更安全、更具可读性和更可扩展以供将来修改。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2008-11-17T10:09:51.540

属性的主要优点是允许您更改访问对象数据的方式，而不会破坏其公共接口。例如，如果您需要添加额外的验证，或者将存储的字段更改为计算字段，如果您最初将该字段公开为属性，则可以轻松完成。如果您只是直接公开一个字段，那么您将不得不更改您的类的公共接口以添加新功能。该更改会破坏现有客户端，要求它们在使用新版本的代码之前重新编译。

如果您编写一个专为广泛使用而设计的类库（例如被数百万人使用的 .NET Framework），这可能是个问题。但是，如果您正在编写一个在小型代码库（例如 <= 50 K 行）内部使用的类，这真的没什么大不了的，因为没有人会受到您的更改的不利影响。在这种情况下，它真的只是归结为个人喜好。

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2008-11-17T11:40:22.403

属性支持非对称访问，即您可以拥有一个getter 和一个setter，或者只是两者之一。同样，属性支持 getter/setter 的单独可访问性。字段始终是对称的，即您始终可以获取和设置值。例外情况是只读字段，初始化后显然无法设置。

属性可能会运行很长时间，有副作用，甚至可能抛出异常。字段速度很快，没有副作用，并且永远不会抛出异常。由于副作用，属性可能会为每次调用返回不同的值（可能是 DateTime.Now 的情况，即 DateTime.Now 并不总是等于 DateTime.Now）。字段总是返回相同的值。

字段可以用于 out / ref 参数，属性不能。属性支持额外的逻辑——这可用于实现延迟加载等。

属性通过封装获取/设置值的任何含义来支持抽象级别。

在大多数/所有情况下使用属性，但尽量避免副作用。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-11-17T10:51:52.457

在后台，属性被编译成方法。所以一个`Name`属性被编译成`get_Name()`and `set_Name(string value)`。如果您研究编译的代码，您可以看到这一点。所以在使用它们时会有（非常）小的性能开销。通常，如果您将字段公开到外部，您将始终使用属性，如果您需要验证值，您通常会在内部使用它。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-12-29T06:48:45.900

当您希望您的私有变量（字段）可以从其他类访问您的类的对象时，您需要为这些变量创建属性。

例如，如果我有名为“id”和“name”的变量，它们是私有的，但可能存在该变量需要在类外进行读/写操作的情况。在那种情况下，属性可以帮助我根据为属性定义的获取/设置来读取/写入该变量。一个属性可以是只读/只写/读写两者。

这是演示

```
class Employee
{
    // Private Fields for Employee
    private int id;
    private string name;

    //Property for id variable/field
    public int EmployeeId
    {
       get
       {
          return id;
       }
       set
       {
          id = value;
       }
    }

    //Property for name variable/field
    public string EmployeeName
    {
       get
       {
          return name;
       }
       set
       {
          name = value;
       }
   }
}

class MyMain
{
    public static void Main(string [] args)
    {
       Employee aEmployee = new Employee();
       aEmployee.EmployeeId = 101;
       aEmployee.EmployeeName = "Sundaran S";
    }
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2015-08-15T14:07:57.877

这里的第二个问题，“什么时候应该使用一个字段而不是一个属性？”，在[另一个答案中只是简单地提到了这个问题](https://stackoverflow.com/a/295380/1083771)，也有点像[这个](https://stackoverflow.com/a/295193/1083771)，但没有太多细节。

一般来说，所有其他答案都是关于良好设计的：更喜欢公开属性而不是公开字段。虽然你可能不会**经常发现自己说“哇，想象一下如果我把它变成一个字段而不是一个属性会****变得**多么糟糕”，但很少想到你会说“哇，感谢上帝，我在这里使用了一个字段而不是一个属性。”

但是字段比属性有一个优势，那就是它们可以用作“ref”/“out”参数。假设您有一个具有以下签名的方法：

```
public void TransformPoint(ref double x, ref double y); 
```

并假设您想使用该方法来转换这样创建的数组：

```
System.Windows.Point[] points = new Point[1000000];
Initialize(points); 
```

这是我认为最快的方法，因为[X](https://msdn.microsoft.com/en-us/library/system.windows.point.x.aspx)和[Y](https://msdn.microsoft.com/en-us/library/system.windows.point.y.aspx)是属性：

```
for (int i = 0; i < points.Length; i++)
{
    double x = points[i].X;
    double y = points[i].Y;
    TransformPoint(ref x, ref y);
    points[i].X = x;
    points[i].Y = y;
} 
```

这将是相当不错的！除非您有测量结果证明并非如此，否则没有理由发臭。但我相信在技术上并不能保证它的速度如此之快：

```
internal struct MyPoint
{
    internal double X;
    internal double Y;
}

// ...

MyPoint[] points = new MyPoint[1000000];
Initialize(points);

// ...

for (int i = 0; i < points.Length; i++)
{
    TransformPoint(ref points[i].X, ref points[i].Y);
} 
```

我自己进行了一些[测量](https://gist.github.com/airbreather/0b183895cdbfa7c99777)，带有字段的版本大约需要 61% 的时间作为带有属性的版本（.NET 4.6、Windows 7、x64、发布模式、未附加调试器）。方法越昂贵`TransformPoint`，差异就越不明显。要自己重复这一点，请在第一行注释掉并且不注释掉的情况下运行。

即使上述情况没有性能优势，也有其他地方能够使用 ref 和 out 参数可能是有益的，例如在调用[Interlocked](https://msdn.microsoft.com/en-us/library/system.threading.interlocked.aspx)或[Volatile](https://msdn.microsoft.com/en-us/library/system.threading.volatile.aspx)系列方法时。 *注意：如果这对您来说是新的，Volatile 基本上是一种获得`volatile`关键字提供的相同行为的方法。因此，就像它一样`volatile`，它并没有像它的名字所暗示的那样神奇地解决所有线程安全问题。*

我绝对不想看起来像是在提倡你去“哦，我应该开始公开字段而不是属性”。关键是，如果您需要在带有“ref”或“out”参数的调用中经常使用这些成员，特别是在可能是一个简单的值类型的东西上，它不太可能需要任何属性的增值元素，可以提出论据。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-11-17T09:44:55.803

如果您要使用线程原语，则必须使用字段。属性可以破坏你的线程代码。除此之外，科里所说的是正确的。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-11-17T10:46:29.597

此外，属性允许您在设置值时使用逻辑。

所以你可以说你只想给一个整数字段设置一个值，如果值大于x，否则抛出异常。

真正有用的功能。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-06-26T06:13:37.260

（这确实应该是评论，但我不能发表评论，所以如果它不适合作为帖子，请原谅）。

我曾经在一个推荐的做法是使用公共字段而不是属性的地方工作，而等效的属性 def 只是在访问一个字段，如下所示：

```
get { return _afield; }
set { _afield = value; } 
```

他们的理由是，如果需要，将来可以将公共字段转换为属性。当时我觉得有点奇怪。从这些帖子来看，这里似乎也没有多少人会同意。你可能会说什么来尝试改变事情？

编辑：我应该补充一点，这个地方的所有代码库都是同时编译的，所以他们可能认为更改类的公共接口（通过将公共字段更改为属性）不是问题。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2013-11-01T07:04:05.633

从技术上讲，我认为没有区别，因为属性只是用户创建或编译器自动创建的字段的包装器。属性的目的是强制封装并提供类似方法的轻量级功能。将字段声明为公共的只是一种不好的做法，但它没有任何问题。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2015-08-10T20:03:19.933

字段是类的**普通成员变量**或成员实例。属性是**获取和设置其值的抽象**。属性也称为访问器，因为如果您将类中的字段公开为私有，它们提供了一种更改和检索字段的方法。通常，您应该将成员变量声明为私有，然后为它们声明或定义属性。

```
 class SomeClass
  {
     int numbera; //Field

     //Property 
    public static int numbera { get; set;}

  } 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2016-12-09T09:46:54.247

我对字段的设计是字段只需要由其父级修改，因此是类。结果变量变为私有，然后能够授予读取外部类/方法的权限，我只使用 Get 来通过属性系统。然后该字段由属性检索并且是只读的！如果你想修改它，你必须通过方法（例如构造函数），我发现由于这种让你安全的方式，我们可以更好地控制我们的代码，因为我们“法兰”。一个人很可能总是把所有东西都公开，所以每一种可能的情况，变量/方法/类等的概念……在我看来只是对代码的开发和维护的一种帮助。例如，如果一个人恢复带有公共字段的代码，他可以做任何事情，因此事情“不合逻辑” 关于目标，编写代码的逻辑。这是我的观点。

当我使用经典模型私有字段/公共只读属性时，对于 10 个私有字段，我应该写 10 个公共属性！代码可以更快地变大。我发现了私有设置器，现在我只使用带有私有设置器的公共属性。setter 在后台创建一个私有字段。

**这就是为什么我以前的经典编程风格是：**

```
public class MyClass
{
 private int _id;
 public int ID { get { return _id; } }
 public MyClass(int id)
 {
  _id = id;
 }
} 
```

**我的新编程风格：**

```
public class MyClass
{
 public int ID { get; private set; }
 public MyClass(int id)
 {
  ID = id;
 }
} 
```

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2019-06-15T17:32:24.903

基本和一般的区别是：

字段

*   **始终**给予 get 和 set 访问权限
*   **不能**引起副作用（抛出异常、调用方法、更改字段，除了被获取/设置的字段等）

特性

*   **不总是**同时授予 get 和 set 访问权限
*   **会**引起副作用

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-11-17T10:05:18.243

属性封装字段，从而使您能够对要设置或检索的值执行额外的处理。如果您不对字段值进行任何预处理或后处理，则使用属性通常是矫枉过正的。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2013-12-16T15:03:51.493

IMO，属性只是我们之前使用的“SetXXX()”“GetXXX()”函数/方法/接口对，但它们更简洁优雅。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2015-04-01T01:30:10.473

传统上，私有字段是通过 getter 和 setter 方法设置的。为了减少代码，您可以使用属性来设置字段。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2015-04-01T03:09:23.263

当您有一个“汽车”课程时。属性是颜色，形状..

其中 as 字段是在类范围内定义的变量。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2015-08-26T10:58:37.543

来自维基百科——[面向对象的编程](https://en.wikipedia.org/wiki/Object-oriented_programming)：

> 面向对象编程（OOP）是一种基于“对象”概念的编程范式，“对象”是包含**数据的数据结构，以字段的形式**，通常称为属性；和**代码，以过程的形式，通常称为方法**。*（重点补充）*

属性实际上是对象行为的一部分，但旨在为对象的消费者提供使用对象数据的错觉/抽象。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2017-01-16T17:42:16.467

附加信息：默认情况下，get 和 set 访问器与属性本身一样可访问。您可以通过在它们上应用更多限制性访问修饰符来单独控制/限制访问器可访问性（用于获取和设置）。

例子：

```
public string Name
{
    get
    {
        return name;
    }
    protected set
    {
        name = value;
    }
} 
```

这里 get 仍然是公开访问的（因为属性是公共的），但 set 是受保护的（更受限制的访问说明符）。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2017-06-26T14:48:33.940

想一想：你有一个房间和一扇门可以进入这个房间。如果您想检查谁是如何进入并保护您的房间，那么您应该使用属性，否则它们将不是任何门，并且每个人都可以轻松进入而没有任何规定

```
class Room {
   public string sectionOne;
   public string sectionTwo;
}

Room r = new Room();
r.sectionOne = "enter"; 
```

人们很容易进入sectionOne，没有任何检查

```
class Room 
{
   private string sectionOne;
   private string sectionTwo;

   public string SectionOne 
   {
      get 
      {
        return sectionOne; 
      }
      set 
      { 
        sectionOne = Check(value); 
      }
   }
}

Room r = new Room();
r.SectionOne = "enter"; 
```

**现在你检查了这个人，知道他是否有邪恶的东西**

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2018-10-24T07:57:42.100

字段是类中的变量。字段是您可以通过使用访问修饰符封装的数据。

属性类似于字段，因为它们定义状态和与对象关联的数据。

与字段不同，属性具有控制人们如何读取数据和写入数据的特殊语法，这些称为 get 和 set 运算符。集合逻辑通常可用于进行验证。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2016-03-01T08:53:25.230

属性是一种特殊的类成员，在属性中我们使用预定义的 Set 或 Get 方法。它们使用访问器，通过这些访问器我们可以读取、写入或更改私有字段的值。

例如，让我们使用一个名为 的类`Employee`，其中包含 name、age 和 Employee_Id 的私有字段。我们无法从类外部访问这些字段，但我们可以通过属性访问这些私有字段。

我们为什么要使用属性？

将类字段公开并公开是有风险的，因为您无法控制分配和返回的内容。

为了通过一个例子清楚地理解这一点，让我们以一个有 ID、passmark、name 的学生班级为例。现在在这个例子中，公共领域有一些问题

*   ID 不应为 -ve。
*   名称不能设置为空
*   通过标记应该是只读的。
*   如果缺少学生姓名，则不应返回姓名。

为了消除这个问题，我们使用 Get 和 set 方法。

```
// A simple example
public class student
{
    public int ID;
    public int passmark;
    public string name;
}

public class Program
{
    public static void Main(string[] args)
    {
       student s1 = new student();
       s1.ID = -101; // here ID can't be -ve
       s1.Name = null ; // here Name can't be null
    }
} 
```

现在我们以get和set方法为例

```
public class student
{
    private int _ID;
    private int _passmark;
    private string_name ;
    // for id property
    public void SetID(int ID)
    {
        if(ID<=0)
        {
            throw new exception("student ID should be greater then 0");
        }
        this._ID = ID;
    }
    public int getID()
    {
        return_ID;
    }
}
public class programme
{
    public static void main()
    {
        student s1 = new student ();
        s1.SetID(101);
    }
    // Like this we also can use for Name property
    public void SetName(string Name)
    {
        if(string.IsNullOrEmpty(Name))
        {
            throw new exeception("name can not be null");
        }
        this._Name = Name;
    }
    public string GetName()
    {
        if( string.IsNullOrEmpty(This.Name))
        {
            return "No Name";
        }
        else
        {
            return this._name;
        }
    }
        // Like this we also can use for Passmark property
    public int Getpassmark()
    {
        return this._passmark;
    }
} 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2017-06-14T17:37:21.690

属性用于公开字段。他们使用访问器（set, get），通过这些访问器可以读取、写入或操作私有字段的值。

属性不命名存储位置。相反，它们具有读取、写入或计算其值的访问器。

使用属性，我们可以对字段上设置的数据类型设置验证。

例如，我们有私有整数字段年龄，我们应该允许正值，因为年龄不能为负。

我们可以通过两种方式使用 getter 和 setter 以及使用属性来做到这一点。

```
 Using Getter and Setter

    // field
    private int _age;

    // setter
    public void set(int age){
      if (age <=0)
       throw new Exception();

      this._age = age;
    }

    // getter
    public int get (){
      return this._age;
    }

 Now using property we can do the same thing. In the value is a key word

    private int _age;

    public int Age{
    get{
        return this._age;
    }

    set{
       if (value <= 0)
         throw new Exception()
       }
    } 
```

自动实现的属性如果我们不在 get 和 set 访问器中进行逻辑处理，我们可以使用自动实现的属性。

当使用**自动实现的属性编译时，会创建一个私有的匿名字段**，该字段只能通过 get 和 set 访问器访问。

```
public int Age{get;set;} 
```

**抽象属性** 一个抽象类可能有一个抽象属性，它应该在派生类中实现

```
public abstract class Person
   {
      public abstract string Name
      {
         get;
         set;
      }
      public abstract int Age
      {
         get;
         set;
      }
   }

// overriden something like this
// Declare a Name property of type string:
  public override string Name
  {
     get
     {
        return name;
     }
     set
     {
        name = value;
     }
  } 
```

我们可以私下设置一个属性在这个我们可以私下设置自动属性（在类中设置）

```
public int MyProperty
{
    get; private set;
} 
```

您可以使用此代码实现相同的目的。在此属性集功能中不可用，因为我们必须直接将值设置为字段。

```
private int myProperty;
public int MyProperty
{
    get { return myProperty; }
} 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2018-02-27T11:33:15.277

在绝大多数情况下，它将是您访问的属性名称，而不是变量名称（**字段**），原因是它在 .NET 和 C# 中被认为是一种很好的做法，尤其是在保护类中的每条数据方面，无论是实例变量还是静态变量（类变量），因为它与一个类相关联。

使用相应的属性保护所有这些变量，这些属性允许您在处理这些数据时定义、**设置和获取** [访问器并执行验证等操作。](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/using-properties)

但在其他情况下，如[Math 类](https://msdn.microsoft.com/en-us/library/system.math(v=vs.110).aspx#Syntax)（系统命名空间），类中内置了几个静态属性。其中之一是数学常数[PI](https://msdn.microsoft.com/en-us/library/system.math(v=vs.110).aspx#Fields)

例如。数学.PI

并且因为 PI 是一条定义明确的数据，我们不需要有多个 PI 副本，它始终是相同的值。因此，静态变量有时用于在类的对象之间共享数据，但也常用于只需要一份数据副本的常量信息。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2020-04-21T10:05:57.437

区别[在这里](https://www.dotnetodyssey.com/2017/05/31/difference-fields-properties-c/)清楚地解释了。但是，只是为了总结和强调：

字段被封装在类内部以进行内部操作，而属性可用于将类公开给外部世界，以及共享链接中显示的其他内部操作。此外，如果您想根据值加载某些方法或用户控件特定字段，然后该属性将为您完成：

例如：

您可以通过简单地为您的 aspx 页面中的 Id preperty 分配一个值来在您的 asp.net 页面中的用户控件下方运行，如下所示：

```
useMeId.Id=5 ---call the property of user control "UseMe.ascx" 
```

使用Me.ascx

```
<%@ Register Src=~/"UseMe.ascx" TagPrefix="uc" TagName="UseMe" %>
<uc:UseMe runat="Server" id="useMeId" />

UseMe.ascx.cs

private int currentId;

public int Id
   {
      get
      {
         return currentId;
      }
      set
      {
         currentId = value;
       LoadInitialData(currentId);
      }
   }
Private void LoadinitialData(int currentIdParam)
{
//your action

} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2022-02-14T11:13:03.360

阅读所有答案后，我没有找到有关并发访问的答案。

假设您有一个可以异步访问的 API 端点，并且您正在使用静态字段来存储数据，并且完全需要对静态字段具有独占访问权限。

要重现此示例，您将需要进行负载测试以同时对端点进行大量访问。

当使用**静态 int 计数器字段**时，端点在两次或多次访问中获得相同的值。 [![在此处输入图像描述](https://i.stack.imgur.com/QAZlM.png)](https://i.stack.imgur.com/QAZlM.png)

使用**静态 int 计数器属性**时，端点处理并发并始终获取计数器的新值。

[![在此处输入图像描述](https://i.stack.imgur.com/LMRxJ.png)](https://i.stack.imgur.com/LMRxJ.png)

这根本不能回答问题，但是在使用其中一种时必须考虑到这种行为。

# c# - c#预处理器指令作用域

> ID：295110
> 
> 赞同：8
> 
> 时间：2008-11-17T08:46:22.943
> 
> 标签：c#, scope, c-preprocessor, preprocessor-directive

我正在寻找使用：

```
#define 
```

和

```
#if 
```

允许我在单元测试期间模拟可能不存在的硬件。使用`#define`语句的规则是什么？

即它的默认范围是什么？我可以更改指令的范围吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-17T09:16:23.927

正如克里斯所说，#define 的范围只是文件。（值得注意的是，这与“类”不同——如果你有一个部分类型，它可能包含两个文件，一个定义了符号，另一个没有！

您还可以在项目范围内定义符号，但这是通过[项目属性](http://msdn.microsoft.com/en-us/library/c7f8bfy4.aspx)或[编译器开关](http://msdn.microsoft.com/en-us/library/0feaad6z.aspx)完成的，而不是在源代码中指定。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T08:49:29.783

从[MSDN](http://msdn.microsoft.com/en-us/library/yt3yck0x(VS.71).aspx)，它的范围是文件

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T08:51:44.210

虽然你不能沿着 Mock objects 的路线走，ala [Mock.Rhinos](http://ayende.com/projects/rhino-mocks.aspx)吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T09:16:29.667

是的，正如 Chris 提到的，它的范围是整个文件。您可以在文件中的任何位置使用定义的关键字。

IE;

```
#define something
... some code ... 
```

在任何方法、类体或命名空间中，您都可以像这样使用它；

```
#if something
  ... some conditional code ...
#else
  ... otherwise ...
#endif 
```

# php - PHP SimpleXML。如何获得最后一项？

> ID：295112
> 
> 赞同：1
> 
> 时间：2008-11-17T08:47:19.913
> 
> 标签：php, xml, simplexml

如何在 simplexml 对象中获取最后一项（或任何特定项）？假设您不知道会有多少个节点。

前任。

```
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl.xml"?>
<obj 
  href="http://xml.foo.com/" 
  display="com.foo.bar" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns="http://obix.org/ns/schema/1.0" 
>
 <list name="data" of="HistoryRecord">
  <obj>
   <abstime name="timestamp" val="1876-11-10T00:00:00-08:00"></abstime>
   <int name="energy_in_kwh" val="1234"></int>
   <int name="energy_out_kwh" val="123456"></int>
  </obj>
  <obj>
   <abstime name="timestamp" val="1876-11-10T00:15:00-08:00"></abstime>
   <int name="energy_in_kwh" val="1335"></int>
   <int name="energy_out_kwh" val="443321"></int>
  </obj>
 </list>
 <int name="count" val="2"></int>
</obj> 
```

我想抓住最后`<obj></obj>`一块（甚至只是其中的一部分）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T10:17:53.273

使用 XPath 的`last()`函数，它解决了这个问题：

```
<?php 
$xml = simplexml_load_file('HistoryRecord.xml'); 
$xml->registerXPathNamespace('o', 'http://obix.org/ns/schema/1.0');

$xpath = "/o:obj/o:list/o:obj[last()]/o:int[@name = 'energy_in_kwh']";
$last_kwh = $xml->xpath($xpath); 
?> 
```

它在这里查找最后一个 inner `<obj>`，并在其中查找`<int>`名称为 的`"energy_in_kwh"`。

注意命名空间注册。（所有元素都是`"http://obix.org/ns/schema/1.0"`命名空间的一部分，XPath 查询必须反映这一点。

* * *

编辑：请注意，这`[last()]`相当于`[position() = last()]`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-17T10:24:09.423

有一个 XPath 表达式可以完全满足您的要求：

```
$xml='<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl.xml"?>
<obj href="http://xml.foo.com/" display="com.foo.bar" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://obix.org/ns/schema/1.0" >
 <list name="data" of="HistoryRecord">
  <obj>
   <abstime name="timestamp" val="1876-11-10T00:00:00-08:00"></abstime>
   <int name="energy_in_kwh" val="1234"></int>
   <int name="energy_out_kwh" val="123456"></int>
  </obj>
  <obj>
   <abstime name="timestamp" val="1876-11-10T00:15:00-08:00"></abstime>
   <int name="energy_in_kwh" val="1335"></int>
   <int name="energy_out_kwh" val="443321"></int>
  </obj>
 </list>
 <int name="count" val="2"></int>
</obj>';
$x=simplexml_load_string($xml);
$x->registerXPathNamespace('obix', 'http://obix.org/ns/schema/1.0');
$objects=$x->xpath('/obix:obj/obix:list/obix:obj[last()]');
print_r($objects); 
```

例如`/bookstore/book[last()]`，将选择作为 bookstore 元素的子元素的最后一个 book 元素。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T09:02:14.923

对于程序员来说，访问 XML 中节点的最快方法是 XPath。看看[xpath 方法](http://www.php.net/manual/en/function.simplexml-element-xpath.php)和[xpath 本身](http://w3schools.com/xpath)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T08:56:13.843

我认为 SimpleXML 无论如何都会加载整个 XML，并且（如果我没记错的话）您可以像使用数组一样使用 SimpleXML 节点，因此您可以只使用数组函数来获取最后一个节点。自从我使用 PHP 以来已经有一段时间了，但是您应该能够获取长度，然后以长度 1 获取项目...

**编辑：** 您当然也可以使用 XPath，我想我也应该提到这一点，但我不确定是否适用`last()`于 SimpleXML XPath 实现。

我不确定使用数组索引或 XPath 最快，我猜数组索引更快，但你应该在循环中尝试几千次，以获得循环前后的时间来检查。

但在 CS 中总是如此：你选择什么取决于很多事情。

它是时间紧迫的还是经常使用的：然后找到最快的解决方案。

如果您需要更复杂的查询并且速度不是问题：那么使用最容易实现并提供所需功能的任何东西（XPath 适用于复杂的树导航，数组索引适用于列表类型数据结构中的快速随机访问; XML 可用于两者。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T09:30:35.990

你可以从这个开始。你可以把它挖出来。我不喜欢他们在 2 个级别使用相同的标签名称。我尽量避免重复的标签名称。

```
<?php
$s = simplexml_load_file('in.xml');
$s->registerXPathNamespace('obix', 'http://obix.org/ns/schema/1.0');
$items = $s->xpath('//obix:list');
?> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-26T16:38:28.473

正如已经提到的，您可以使用数组表示法和函数。

```
 <?php 
    $xml = simplexml_load_file('HistoryRecord.xml'); 
    $lastObj = $xml->list->obj[$xml->list->obj->count()-1]; 
```

或者

```
 $lastObj = $xml->list->obj[count($xml->list->obj)-1]; 
```

你也可以`end()`用来获取最后一个元素，但前提是你总是有多个 <obj>，否则它会返回不同的结果。

# svn - 网络共享上的 SVN 工作副本

> ID：295114
> 
> 赞同：7
> 
> 时间：2008-11-17T08:48:11.440
> 
> 标签：svn

好的，我正在为我的网络团队准备版本控制流程。

我知道理想情况下每个用户都会在他们的本地机器上拥有他们代码的完整工作副本。

不幸的是，对于我们的许多 Web 应用程序，它们具有无法在用户工作站上复制的附加服务器特定数据库或其他系统集成要求（即某些服务器不会安装在 XP、vista 等上）

我正在考虑在我的一台服务器上设置一个区域，该区域充当每个用户的工作副本，但仍驻留在网络上。

IE

```
/SVRROOT/
- Dev1 Working Copy
- Dev2 Working Copy
- Dev3 Working Copy 
```

这意味着每个用户都将拥有自己的工作空间（根据 SVN 最佳实践），但它将驻留在网络上。

有人看到这个模型有问题吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T08:52:02.773

您可能会发现通过网络执行 Subversion 操作的性能远低于本地执行相同 Subversion 操作的性能。我在 Unix 领域遇到了这个问题，工作目录安装在 NFS 上，但我怀疑你可能会在使用 Windows 共享时遇到同样的情况。

值得比较不同情况下的性能，看看会产生什么影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-08-05T13:09:24.713

我们在 Win10 开发者机器和通过 smb 挂载的 AIX 服务器之间拥有与您完全相同的模型。我使用此设置的经验是 Windows 的每个 SVN 操作都非常慢（尤其是 svn 检查 modifs。一个大项目需要几分钟）。另外，如果您在同一个工作副本上从 win 和命令行 AIX 运行并行 svn 操作，您通常最终会损坏 WC 并不得不签出一个新的。

我们这样做是因为项目在 AIX 上编译，并且我们希望在提交更改之前编译和测试我们的更改。我们通常做的是使用通常的 IDE 从 windows 编辑源代码，但直接从 CLI 使用 AIX svn 客户端执行每个 svn 命令（即 windows 只修改文件，而 AIX 完成所有 svn 工作）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T13:52:40.920

如果将网络文件夹映射到驱动器号，某些颠覆操作会执行得更好一些。当您使用 unc 路径而不是驱动器号时，apache Apr 库会执行一些额外的网络请求。

通常，您应该只为您的工作副本使用本地文件夹，因为您只需备份服务器就足够了。

Visual Studio 2005 和 2008 允许大多数 Web 服务器方案使用其迷你 Web 服务器，并且大多数数据库可以通过网络访问（或每个开发人员设置）。这将开发人员与单点故障分开。

每个人都在一台服务器上，一个开发人员可以使所有开发人员正在使用的网络服务器/数据库服务器崩溃......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-03-20T14:25:58.910

[根据常见问题解答](https://tortoisesvn.net/faq.html#wconshare)，至少在使用`TortoiseSVN`时强烈建议不要在网络共享上使用工作副本：

> 我可以将工作副本存储在网络共享上吗？
> 这取决于网络共享。但我们真的，真的敦促你**不**要这样做！即使您使用的是 Windows 服务器并使用这些网络共享，fcntl() 文件锁定也不是完全可靠的。对于基于 Samba 的股票，所有赌注都已取消。这意味着您**将**获得一个损坏的工作副本，然后您将丢失数据！也许不是今天，也许不是明天，但总有一天你会的。

我不确定这通常如何适用于 SVN。

我们还在 Windows 网络共享上使用 SVN 工作副本，最近遇到了一些问题，例如偶尔更改文件/目录权限导致工作副本无法使用。

# c++ - C++ 标记为已弃用

> ID：295120
> 
> 赞同：160
> 
> 时间：2008-11-17T08:51:29.670
> 
> 标签：c++

我在一个接口中有一个方法，我想用可移植的 C++ 弃用它。当我用谷歌搜索时，我得到的只是微软特定的解决方案；[`#pragma deprecated`](https://docs.microsoft.com/en-us/cpp/preprocessor/deprecated-c-cpp?view=vs-2017)和[`__declspec(deprecated)`](https://docs.microsoft.com/en-us/cpp/cpp/deprecated-cpp?view=vs-2017)。

二等奖解决方案是`ifdef`MSVC 和 GCC 解决方案。

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2014-01-17T17:24:43.110

* * *

## 回答 #2

> 赞同：131
> 
> 时间：2008-11-17T10:09:41.137

这应该可以解决问题：

```
#ifdef __GNUC__
#define DEPRECATED(func) func __attribute__ ((deprecated))
#elif defined(_MSC_VER)
#define DEPRECATED(func) __declspec(deprecated) func
#else
#pragma message("WARNING: You need to implement DEPRECATED for this compiler")
#define DEPRECATED(func) func
#endif

...

//don't use me any more
DEPRECATED(void OldFunc(int a, float b));

//use me instead
void NewFunc(int a, double b); 
```

但是，如果函数返回类型的名称中有逗号，您将遇到问题，例如`std::pair<int, int>`，因为这将被预处理器解释为将 2 个参数传递给 DEPRECATED 宏。在这种情况下，您将不得不 typedef 返回类型。

[编辑：这里](https://stackoverflow.com/a/21265197/2651243)更简单（但可能不太兼容）版本。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2014-01-21T17:33:49.147

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-11-17T09:11:43.047

在 GCC 中，您可以使用不推荐使用的属性声明您的函数，如下所示：

```
void myfunc() __attribute__ ((deprecated)); 
```

当在 .c 文件中使用该函数时，这将触发编译时警告。

[您可以在http://gcc.gnu.org/onlinedocs/gcc/Pragmas.html](http://gcc.gnu.org/onlinedocs/gcc/Pragmas.html)的“诊断编译指示”下找到更多信息

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2018-02-28T20:22:27.430

这是2018年更完整的答案。

如今，许多工具不仅可以让您将某些内容标记为已弃用，还可以提供消息。这使您可以告诉人们什么时候不推荐使用，并可能将他们指向替代品。

编译器支持仍然有很多种类：

*   C++14 支持`[[deprecated]]`/ `[[deprecated(message)]]`。
*   `__attribute__((deprecated))`受 GCC 4.0+ 和 ARM 4.1+ 支持
*   `__attribute__((deprecated))`并`__attribute__((deprecated(message)))`支持：
    *   海合会 4.5+
    *   几个伪装成 GCC 4.5+ 的编译器（通过设置`__GNUC__`/ `__GNUC_MINOR__`/ `__GNUC_PATCHLEVEL__`）
    *   英特尔 C/C++ 编译器至少可以追溯到 16（你不能相信`__GNUC__`/ `__GNUC_MINOR__`，他们只是将它设置为安装的任何版本的 GCC）
    *   ARM 5.6+
*   MSVC`__declspec(deprecated)`自 13.10 (Visual Studio 2003) 起支持
*   MSVC`__declspec(deprecated(message))`自 14.0 (Visual Studio 2005) 起支持

您还可以`[[gnu::deprecated]]`在 C++11 中基于`__has_cpp_attribute(gnu::deprecated)`.

我在[Hedley](https://github.com/nemequ/hedley)中有一些宏可以自动处理所有这些，我会保持最新状态，但当前版本 (v2) 如下所示：

```
#if defined(__cplusplus) && (__cplusplus >= 201402L)
#  define HEDLEY_DEPRECATED(since) [[deprecated("Since " #since)]]
#  define HEDLEY_DEPRECATED_FOR(since, replacement) [[deprecated("Since " #since "; use " #replacement)]]
#elif \
  HEDLEY_GCC_HAS_EXTENSION(attribute_deprecated_with_message,4,5,0) || \
  HEDLEY_INTEL_VERSION_CHECK(16,0,0) || \
  HEDLEY_ARM_VERSION_CHECK(5,6,0)
#  define HEDLEY_DEPRECATED(since) __attribute__((__deprecated__("Since " #since)))
#  define HEDLEY_DEPRECATED_FOR(since, replacement) __attribute__((__deprecated__("Since " #since "; use " #replacement)))
#elif \
  HEDLEY_GCC_HAS_ATTRIBUTE(deprcated,4,0,0) || \
  HEDLEY_ARM_VERSION_CHECK(4,1,0)
#  define HEDLEY_DEPRECATED(since) __attribute__((__deprecated__))
#  define HEDLEY_DEPRECATED_FOR(since, replacement) __attribute__((__deprecated__))
#elif HEDLEY_MSVC_VERSION_CHECK(14,0,0)
#  define HEDLEY_DEPRECATED(since) __declspec(deprecated("Since " # since))
#  define HEDLEY_DEPRECATED_FOR(since, replacement) __declspec(deprecated("Since " #since "; use " #replacement))
#elif HEDLEY_MSVC_VERSION_CHECK(13,10,0)
#  define HEDLEY_DEPRECATED(since) _declspec(deprecated)
#  define HEDLEY_DEPRECATED_FOR(since, replacement) __declspec(deprecated)
#else
#  define HEDLEY_DEPRECATED(since)
#  define HEDLEY_DEPRECATED_FOR(since, replacement)
#endif 
```

如果您不想使用 Hedley，我将把它作为一个练习来弄清楚如何摆脱`*_VERSION_CHECK`和宏（我主要写了 Hedley，所以我不必经常考虑这个问题）。`*_HAS_ATTRIBUTE`

如果使用 GLib，则可以使用[`G_DEPRECATED`](https://developer.gnome.org/glib/stable/glib-Miscellaneous-Macros.html#G-DEPRECATED:CAPS)和[`G_DEPRECATED_FOR`](https://developer.gnome.org/glib/stable/glib-Miscellaneous-Macros.html#G-GNUC-DEPRECATED-FOR:CAPS)宏。它们不如 Hedley 的强大，但如果您已经使用 GLib，则无需添加任何内容。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-17T09:14:03.603

在处理可移植项目时，您几乎不可避免地会在某些时候需要针对一系列平台进行预处理的替代方案。#ifdef 这个 #ifdef 那等等。

在这样的部分中，您可以很好地有条件地定义一种弃用符号的方法。我的偏好通常是定义一个“警告”宏，因为大多数工具链都支持自定义编译器警告。然后，您可以继续使用特定的警告宏进行弃用等。对于支持专用弃用方法的平台，您可以使用它而不是警告。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-08-27T19:01:47.510

对于 Intel Compiler v19.0，使用它作为`__INTEL_COMPILER`评估`1900`：

```
#  if defined(__INTEL_COMPILER)
#    define DEPRECATED [[deprecated]]
#  endif 
```

适用于以下语言级别：

*   C++17 支持 (/Qstd=c++17)
*   C++14 支持 (/Qstd=c++14)
*   C++11 支持 (/Qstd=c++11)
*   C11 支持 (/Qstd=c11)
*   C99 支持 (/Qstd=c99)

英特尔编译器似乎存在一个错误，即它不支持`[[deprecated]]`所有其他编译器所支持的某些语言元素的属性。例如，使用 Intel Compiler v19.0 编译 GitHub 上（非常出色的）[{fmtlib/fmt}](https://github.com/fmtlib/fmt)库的 v6.0.0。它会破裂。然后[在 GitHub 提交中查看修复](https://github.com/fmtlib/fmt/commit/744302add085f30120c57f73cddbcb826cc92de9)。

# javascript - 什么是好的 JavaScript 非常高级的 UI 框架？

> ID：295123
> 
> 赞同：15
> 
> 时间：2008-11-17T08:52:28.313
> 
> 标签：javascript, user-interface

我需要为自定义服务器系统编写一个临时的基于 Web 的图形前端。在这种情况下，性能和可扩展性不是问题，因为最多 10 个人可以同时检查系统。它也应该是 PHP 或 Python（服务器）和 JavaScript（客户端）（不能将 Flex 或 Silverlight 用于非常具体的非编程相关问题）。

所以我知道我可以使用 YUI 或 jQuery，但想知道是否有更高级的东西可以让我在几个小时内编写这样一个小项目，并完成它。基本上我想尽可能地懒惰（无论如何这都是一次性代码），并在尽可能短的时间内完成工作。

有什么建议么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-17T08:58:09.533

您可以查看[ext.js](http://extjs.com) - 它为 GetThingsDone 快速提供了许多小部件。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-17T09:01:02.257

因为它还没有被提及：[jQuery.UI](http://ui.jquery.com/)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-03-10T03:50:34.827

另请参阅此问题

[ExtJS 的替代品是什么？](https://stackoverflow.com/questions/200284/what-are-alternatives-to-extjs)

现在是 2016 年

1.  [聚合物](https://www.polymer-project.org/1.0/)
2.  [http://angular-ui.github.io/](http://angular-ui.github.io/)

这是一些（旧的）

1.  [ampleSDK](http://www.amplesdk.com/examples/)（有趣的方法）
2.  [DojoToolkit](http://www.dojotoolkit.org/) 和他们漂亮的[小部件集](http://download.dojotoolkit.org/release-1.5.0/dojo-release-1.5.0/dijit/themes/themeTester.html)
3.  [jQuery 用户界面](http://jqueryui.com/)
4.  [卡布奇诺](http://cappuccino.org/learn/demos/)
5.  [里亚托](http://rialto.improve-technologies.com/wiki/)
6.  [回声](http://echo.nextapp.com/site/demo)
7.  简单的 UI 套件[UKI](http://ukijs.org/)查看[演示](http://ukijs.org/examples/core-examples/wave/)
8.  [vaadin](http://demo.vaadin.com/)（需要 Java）
9.  [jxlib.org](http://jxlib.org/)
10.  [活管网](http://livepipe.net/control)
11.  [dhtmlx.com](http://dhtmlx.com/index.shtml)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-17T09:43:46.820

我最近一直在玩[Cappuccino](http://cappuccino.org/)，发现它是一个非常简单且令人愉快的框架。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-07-10T08:18:15.003

作为 2017 年*

如果你想给钱：

*   [剑道用户界面](http://www.telerik.com/kendo-ui)
*   [维莫](http://demos.wijmo.com/5/angular/explorer/explorer/#/)
*   [ExtJs](https://www.sencha.com/)
*   [DHTMLX](http://dhtmlx.com/docs/products/dhtmlxGrid/)
*   [Webix](http://webix.com/blog/webix-grid-1-000-000-rows-and-more/)
*   [JQWidgets](http://www.jqwidgets.com/license/)
*   [智能客户端](http://www.smartclient.com/#Welcome)
*   [jQueryEasyUi](http://www.jeasyui.com/demo/main/index.php)

如果您决定自己保管钱财：

*   [道场](https://dojotoolkit.org/documentation/#widgets)
*   [基础](http://foundation.zurb.com/)
*   [jQueryUI](https://jqueryui.com/tabs/)
*   [材质-UI](http://material-ui.com/#/components/appbar)
*   [离子](http://ionicframework.com/)
*   [语义用户界面](https://semantic-ui.com/introduction/getting-started.html)

如果目标是编写非常高级的 UI 代码，那么以下代码生成器程序可以在几分钟内构建应用程序的整个 UI（对于那些想要使用[Bootstrap](http://getbootstrap.com/)的人来说）：

*   [引导工作室](https://bootstrapstudio.io/)
*   [平根多](http://pingendo.com/)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-04-12T16:18:26.653

此外，Dojo 的名为[Dijit](http://dojotoolkit.org/reference-guide/dijit/index.html)的 UI 库绝对可观！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-17T09:38:42.010

[ExtJs](http://extjs.com/)，[Bindows](http://www.bindows.net/)，[YUI](http://developer.yahoo.com/yui/)。前两个是商业的，但物有所值。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-07-30T06:43:13.777

查看[DHTMLX](http://www.dhtmlx.com/)。

> DHTMLX Toolkit 是一套全面的支持 Ajax 的 DHTML UI 组件。专业开发的网格、树形网格、树形视图、标签栏、日历、菜单、工具栏、组合框、窗口、项目浏览器、颜色选择器和文件上传器，使开发人员能够构建具有高交互性和丰富用户体验的跨浏览器 Web 应用程序。DHTMLX 组件提供了最完整的功能集，并允许您将类似桌面的功能引入 Web。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-04-12T16:10:29.280

在所有的 JS 框架中，JQuery 和 YUI 是我的最爱。他们完成了很多相同的工作，但方式却截然不同。

对于您的要求（懒惰、简单和强大），我会投票给 JQuery。如果这是一个更长期的东西，而且是一个非常冗长和代码繁重的应用程序，我会投票给 YUI。

我真的认为没有什么比这两个框架更好的了。任何一种选择都是好的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-07-10T08:26:25.003

我是否遗漏了一些东西，[引导程序](http://getbootstrap.com/)不是事实上的选择吗？

此外，更酷的是，谷歌的聚合物……基于网络组件：

[https://www.polymer-project.org/1.0/](https://www.polymer-project.org/1.0/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-17T10:06:08.087

我会尝试 application.js - 更少的动画绒毛，很多控件，它是一个窗口管理器（有人提到 Bindows .. 不值得为糟糕的 UI 花钱）。

在此[在线文字处理器中使用](http://shutterb.org/)

我发现卡布奇诺令人困惑，我不想再学习与单个库相关的另一种语言。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-18T05:58:50.567

YUI 似乎不错，而 Extjs 也非常接近。YUI 和 Extjs 之间几乎没有区别，尽管 YUI 是免费的，拥有更大的社区支持，并且得到了雅虎这样的巨头的支持。对于卡布奇诺，你将不得不花时间学习继承 Objective-J，一旦了解到你不需要编写一行 HTML、CSS 和 Dom 操作。但如果你对所有这些都感到满意，为什么还要花时间学习 Objective-J？Bindows 又是一个很好的框架，与 YUI 和 Extjs 非常相似，我喜欢它的是它有许多现成的主题，这使得设计自己的自定义主题更加有吸引力和简单。但是说 2 年后我个人觉得 YUI 会比所有这些走得更远。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-04-12T15:56:10.837

我前一阵子来了[qooxdoo 。](http://qooxdoo.org/)我没用过，但至少演示看起来很酷。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-08-07T21:51:21.770

Qooxdoo 是非凡的。你可以用它做移动、网络和桌面。它抽象出所有的 html 和 css。它有据可查且面向对象。您还可以在服务器端和客户端使用相同的对象。

[http://qooxdoo.org/demos](http://qooxdoo.org/demos)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-08-01T06:12:09.180

免责声明：我是 Web Atoms JS 的作者

Web Atoms JS 旨在引入 Flex、Silverlight 和 XUL 的所有概念。这些技术中的每一个都使用了更多的 XML 标记来实现非常高级的 UI 控件。屏幕变得复杂，当它不断变化时，将它们可视化变得很痛苦。

使用 Web Atoms，您将编写比任何其他框架更少的代码。

这是 Web Atoms JS 中一切皆有可能的示例。

这是文档的链接。 [http://webatomsjs.neurospeech.com/docs](http://webatomsjs.neurospeech.com/docs)

![在此处输入图像描述](https://i.stack.imgur.com/ThE9L.jpg)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-10-18T05:52:12.680

[ShieldUI](http://www.shieldui.com)也是一个很好的商业框架。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-09-27T06:45:26.467

我可以推荐[Controls.js](http://controlsjs.com/)及其[Tools](http://controlsjs.com/tools/)。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-07-30T06:35:03.950

Sproutcore 将是一个不错的选择。

如果您不熟悉它，您可能会发现学习基础知识所需的时间对于一次性代码来说太长了，但是一旦您掌握了基础知识，就可以很快地进行开发。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-02-21T05:26:56.407

最新加入列表的将是 WIJMO 和 KendoUI。

[**http://www.wijmo.com**](http://www.wijmo.com)

[**http://www.kendoui.c​​om**](http://www.kendoui.com)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-02-26T15:09:14.547

你可以试试**RedUI**，它还没有准备好投入生产，但它应该对你的目标有好处。

该方法受到 WPF 的启发，您可以使用预定义的控件（例如**Textbox**、**Combobox**）以及一些更复杂的控件（例如**TreeView**或**GridView** ）来描述您的 UI 。在模型中，您还声明了数据绑定。

该库将为您呈现一个窗口。

然后将它绑定到视图模型，订阅事件，并添加处理这些事件的自定义逻辑（例如，在“window.close”时，您可以将更新的视图模型发送回服务器）。

[您可以在http://redui.net/](http://redui.net/)上查看实时示例

您还可以在[http://redui.net/mailclientdemo/](http://redui.net/mailclientdemo/)上查看演示应用程序。这会让你知道你能做什么。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-01-06T10:41:11.607

尝试使用[Anijs](http://anijs.github.io/)。它将高级 UI 操作简化为简单的线条

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-12-09T06:42:48.623

我使用了 JQuery.UI。这不一定是这个问题的答案（特别是因为它是一个旧帖子），但我想我会分享我所拥有的，以防它帮助其他人，因为我来到这篇帖子寻找如何创建拖放用户界面。

请注意，这是针对 MVC 的。

**请注意**，目前还没有实际添加功能，它是一个起点，它创建了一个允许拖放项目的 UI：

布局：

```
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>jQuery UI Droppable - Default functionality</title>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">
<style>
    ul.listRoles {
        width: 300px;
        height: auto;
        padding: 5px;
        margin: 5px;
        list-style-type: none;
        border-radius: 5px;
        min-height: 70px;
    }

        ul.listRoles li {
            padding: 5px;
            margin: 10px;
            background-color: #ffff99;
            cursor: pointer;
            border: 1px solid Black;
            border-radius: 5px;
        }
</style>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
    $(function () {
        $("#listDenyRoles, #listAllowRoles, #listAllowMoreRoles").sortable({
            connectWith: ".listRoles"
        }).disableSelection();
    });

    function submitNewRoles() {
        //Generate List of new allow roles
        var outputList = $("#listAllowRoles li").map(function () { return $(this).html(); }).get().join(',');
        $("#GrantRoles").val(outputList);
        $("#formAssignRoles").submit();
    }
</script>
</head>
<body>
<div class="container body-content">
        @RenderBody()
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - My ASP.NET Application</p>
        </footer>
    </div>
    }
</body>
</html> 
```

索引页面（我用此代码替换了主页索引）：

```
@{
    ViewBag.Title = "Home Page";
}

<p>
    To GRANT a user a role, click and drag a role from the left Red box to the right Green box.<br />
    To DENY a user a role, click and drag a role from the right Green box to the left Red box.
</p>

@using (Html.BeginForm("AssignRoles", "UserAdmin", FormMethod.Post, new { id = "formAssignRoles" }))
{

    String[] AllRoles = ViewBag.AllRoles;
    String[] AllowRoles = ViewBag.AllowRoles;

    if (AllRoles == null) { AllRoles = new String[] { "Test1","Test2","Test3","Test4", "Test5", "Test6", "Test7", "Test8", "Test9", "Test10", "Test11", "Test12", "Test13" }; }
    if (AllowRoles == null) { AllowRoles = new String[] { }; }

    @Html.ValidationSummary(true)
    <div class="jumbotron">
        <fieldset>
            <legend>Drag and Drop Roles as required;</legend>
            @Html.Hidden("Username", "Username")
            @Html.Hidden("GrantRoles", "")

            <table>
                <tr>
                    <th style="text-align: center">
                        Deny Roles
                    </th>
                    <th style="text-align: center">
                        Allow Roles
                    </th>
                </tr>
                <tr>
                    <td style="vertical-align: top">
                        <ul id="listDenyRoles" class="listRoles" style="background-color: #cc0000;">
                            @foreach (String role in AllRoles)
                            {
                                if (!AllowRoles.Contains(role))
                                {

                                    <li>@role</li>
                                }
                            }
                        </ul>
                    </td>
                    <td style="vertical-align: top">

                        <ul id="listAllowRoles" class="listRoles" style="background-color: #00cc00;">
                            @foreach (String hasRole in AllowRoles)
                            {
                                <li>@hasRole</li>
                            }
                        </ul>
                    </td>
                    <td style="vertical-align: top">

                        <ul id="listAllowMoreRoles" class="listRoles" style="background-color: #000000;">
                            @foreach (String hasRole in AllowRoles)
                            {
                                <li>@hasRole</li>
                            }
                        </ul>
                    </td>
                </tr>
            </table>
            <p><input type="button" onClick="submitNewRoles()" value="Assign Roles" /></p>
        </fieldset>

    </div>
} 
```

希望这可以帮助其他人朝着正确的方向发展。

# .net - 使用版本化的 .Net 程序集

> ID：295124
> 
> 赞同：0
> 
> 时间：2008-11-17T08:54:03.987
> 
> 标签：.net, assemblies, versioning, side-by-side

在我们的处理软件中，我们正在从外部组件的一个版本迁移到更新的版本。虽然程序集执行的总体任务是相同的，但 API 完全不同，并且没有保持向后兼容性。API 负责从外部站点提取数据，这些站点可能与匹配的新旧 API 一起运行（也没有向后兼容性）。我们无法控制外部程序集或外部工作站中的软件。外部程序集没有强签名，并且程序集中的模块在两个版本中具有相同的名称。

我们不想维护我们的处理软件的两个版本，而是希望动态地发展它并让它使用旧版本或新版本的外部组件，这取决于外部站进行联系。我们能够确定外部站是否支持新版本，因此“版本”的选择可以或多或少明确。

所以设置是我们有两个版本的外部程序集 ComLib.dll。我们可以从同一个程序集/项目中引用这两个版本吗？在确定类型等时我们如何区分这两个程序集？

假设上述内容不能在单个程序集/项目中完成，我们可以实现特定于版本的“适配器”程序集，每个版本的外部程序集一个（我认为我们已经为此准备了足够的接口和抽象），但是我们应该注意一些警告或一些特定设置以避免运行时的类型/版本混淆（程序集解析/加载等）？对于此设置，.NET 运行时是否有足够的“并行”支持？

更新：这个问题的进一步扭曲只是为了让事情变得更有趣。似乎外部程序集加载了其他程序集并使用了外部配置文件。由于不同的版本需要不同的配置文件和不同的附加程序集，每个版本都需要以某种方式加载与其版本相匹配的附加程序集。

在我看来，我们想要的是每个版本的程序集在包含其配置文件和其他程序集的单独文件夹中加载一个“根”。这甚至可以通过标准程序集解析器/加载器实现，还是我们必须做一些魔术并手动加载程序集（在单独的 AppDomains 中？）以强制执行“根”文件夹？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T09:05:42.827

可以在此处找到有关此选项的好帖子：http: [//kevin-berridge.blogspot.com/2008/01/two-versions-of-same-shared-assembly.html](http://kevin-berridge.blogspot.com/2008/01/two-versions-of-same-shared-assembly.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T10:03:54.550

您可以使用[ILMerge](http://www.microsoft.com/downloads/details.aspx?familyid=22914587-b4ad-4eae-87cf-b14ae6a939b0&displaylang=en)自己对程序集进行签名，然后使用[此技术](http://kentb.blogspot.com/2008/11/visual-studio-referencing-same-assembly.html)从同一项目中引用它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-25T11:32:04.400

你说这个代码是用来和外部站通信的。为什么不使用与外部站点通信的代码来提供服务呢？该服务将从您当前的程序中调用。

这将允许您运行两个版本的服务 - 一个用于旧 API，一个用于新 API。每个服务都在它自己的进程中（或者可能是 AppDomain），因此可以加载它喜欢的程序集版本。在您的主程序从一个站点切换到另一个站点的过程中，您会随着 API 版本的变化而从一个服务切换到另一个服务。

这将有额外的好处，将您与外部供应商隔离开来，创建与前两个不向后兼容的 API的*第三个版本。*

该解决方案的性能可能非常高，因为您的主程序可以通过命名管道甚至内存中的传输与服务进行通信。WCF 可以在传输（绑定）之间切换，在大多数情况下无需更改您的代码。

# c# - LINQ：获取具有任何名称空间但特定名称的属性

> ID：295125
> 
> 赞同：2
> 
> 时间：2008-11-17T08:54:30.383
> 
> 标签：c#, xml, linq-to-xml, xmpp

我需要能够从具有特定本地名称但具有任何命名空间的元素中获取单个特定属性（如果您熟悉 XMPP，您会明白为什么）。除了编写我自己的（枚举器或单选）扩展方法之外，还有什么想法吗？

我有以下内容，但我根本不喜欢它：

```
 XAttribute from = (from c in elem.Attributes()
                           where c.Name.LocalName == "from"
                           select c).FirstOrDefault<XAttribute>();

        XAttribute to = (from c in elem.Attributes()
                         where c.Name.LocalName == "to"
                         select c).FirstOrDefault<XAttribute>(); 
```

编辑：想要类似的东西：

```
 string val = (string)elem.Attribute("{*}to"); 
```

解决方案：

```
 XAttribute from = elem.Attributes()
            .FirstOrDefault(a => a.Name.LocalName == "from");

        XAttribute to = elem.Attributes()
            .FirstOrDefault(a => a.Name.LocalName == "to"); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T09:01:46.513

如果你不喜欢这个语法，你可以使用这个；

```
elem.Attributes().FirstOrDefault(a=>a.Name.LocalName == "from"); 
```

# c# - C# 最佳实践：集中式事件控制器与否

> ID：295128
> 
> 赞同：6
> 
> 时间：2008-11-17T08:56:50.223
> 
> 标签：c#, events, architecture

我有一个应用程序，它由几个不同的程序集组成，其中一个包含类所遵循的各种接口，并且类通过这些接口跨程序集边界进行通信。有几个类触发事件，并且有几个对这些事件感兴趣。

我的问题如下：实施某种中央 EventConsolidator 是一种好习惯吗？这将是高度耦合的，因为它需要知道引发事件的每个类（或至少是接口），并且事件的每个消费者都需要引用 EventConsolidator 才能订阅。

目前我的情况是 A 类知道 B 类（但不是 C），B 类知道 C 类，等等。然后如果 C 触发事件 B 需要拿起它并触发自己的事件以便 A 响应。这些链条可能会变得很长，可能是 B 只对事件感兴趣以便传递它。我不想让 A 知道 C，因为那会破坏封装。

在这种情况下有什么好的做法？集中事件，还是笑着忍受并在每个中间类中定义事件？或者做出决定的标准是什么？谢谢！

编辑：[这](https://stackoverflow.com/questions/217233/bubbling-up-events)是另一个问题，基本上是同样的事情。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-17T09:09:12.990

您可以将事件本身放在一个接口中，这样 A 不需要直接了解 C，而只需知道它具有相关事件即可。但是，也许您的意思是 A 的实例没有看到 C 的实例...

我会尽量避开集中式事件系统。正如您所说，这可能会使测试变得更加困难，并引入了紧密耦合。

值得了解的一种模式是使事件代理变得简单。如果 B 只公开一个事件以将其代理给 C，您可以这样做：

```
public event FooHandler Foo
{
    add
    {
        c.Foo += value;
    }
    remove
    {
        c.Foo -= value;
    }
} 
```

这样它就代理了订阅/取消订阅，而不是引发事件的行为。当然，这会对 GC 资格产生影响——这可能是有益的，也可能是无益的，这取决于具体情况。不过值得思考。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-17T09:26:28.663

您可以尝试使用[NInject](http://ninject.org/ "NInject 主页")或[Unity Application Block](http://www.codeplex.com/unity "统一主页")的事件代理。

例如，这允许您：

```
[Publish("foo://happened")]
public event EventHandler<FooArgs> FooHappened;

[Subscribe("foo://happened")]
public void Foo_Happened(object sender, FooArgs args)
{ } 
```

如果两个对象都是通过容器创建的，则事件将自动连接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T09:04:39.833

我可能会尝试按摩域，以便每个类都可以直接依赖于适当的事件源。我的意思是问为什么A不知道C？也许有一个 D 等待出现？

作为一种替代方法，您可以考虑使用事件代理架构。这意味着观察者不直接知道来源。这是一个有趣的[视频](http://ayende.com/Blog/archive/2007/05/26/Hibernating-Rhinos-3-Implementing-the-Event-Broker.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T09:06:12.543

> 这将是高度耦合的，因为它需要知道每个类

如果您认为耦合不好，我认为您已经回答了自己的问题！在许多环境中，通过一系列潜在的处理程序传递事件是一种相当常见的模式。它可能不是最有效的方法，但它避免了您建议的方法所涉及的复杂性。

您可以采取的另一种方法是使用消息调度程序。这涉及使用通用消息格式（或至少通用消息头格式）来表示事件，然后将这些消息放入队列中。然后，调度程序依次（或基于某些优先级）拾取这些事件中的每一个，并将它们直接路由到所需的处理程序。每个处理程序必须在启动时向调度程序注册。

在这种情况下，消息可能只是一个开头带有几个特定字段的类。特定消息可能只是派生的，或者您可以将特定于消息的数据作为“对象”参数与消息头一起传递。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T15:47:08.350

如果您想要集中式事件，您可以查看 M$ 模式和实践库中的 EventBroker 对象。

就我个人而言，我认为最好考虑您的架构，即使我们在这里使用 EventBroker，但我们的新代码都没有使用它，我们希望在阳光明媚的日子逐步淘汰它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-29T20:39:56.767

我们有自己的事件代理实现（开源）教程： http: [//sourceforge.net/apps/mediawiki/bbvcommon/index.php ?title=Event_Broker](http://sourceforge.net/apps/mediawiki/bbvcommon/index.php?title=Event_Broker)

以及性能分析：www.planetgeek.ch/2009/07/12/event-broker-performance/

与 CAB 相比的优点： - 更好的日志记录 - 扩展支持 - 更好的错误处理 - 可扩展的处理程序（UI，后台线程，...）还有一些我现在想不起来了。

干杯，乌尔斯

# python - 将字符串转换为有效的文件名？

> ID：295135
> 
> 赞同：369
> 
> 时间：2008-11-17T09:02:07.683
> 
> 标签：python, filenames, slug, sanitize

我有一个要用作文件名的字符串，所以我想使用 Python 删除文件名中不允许出现的所有字符。

我宁愿严格而不是严格，所以假设我只想保留字母、数字和一小组其他字符，例如`"_-.() "`. 什么是最优雅的解决方案？

文件名需要在多个操作系统（Windows、Linux 和 Mac OS）上有效——它是我的库中的一个 MP3 文件，文件名是歌曲标题，并且在 3 台机器之间共享和备份。

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-11-17T12:23:52.690

您可以查看[Django 框架](http://www.djangoproject.com)，了解它们如何从任意文本创建“slug”。slug 是 URL 和文件名友好的。

Django text utils 定义了一个函数，[`slugify()`](https://docs.djangoproject.com/en/2.1/ref/utils/#django.utils.text.slugify)，这可能是这类事情的黄金标准。本质上，他们的代码如下。

```
import unicodedata
import re

def slugify(value, allow_unicode=False):
    """
    Taken from https://github.com/django/django/blob/master/django/utils/text.py
    Convert to ASCII if 'allow_unicode' is False. Convert spaces or repeated
    dashes to single dashes. Remove characters that aren't alphanumerics,
    underscores, or hyphens. Convert to lowercase. Also strip leading and
    trailing whitespace, dashes, and underscores.
    """
    value = str(value)
    if allow_unicode:
        value = unicodedata.normalize('NFKC', value)
    else:
        value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore').decode('ascii')
    value = re.sub(r'[^\w\s-]', '', value.lower())
    return re.sub(r'[-\s]+', '-', value).strip('-_') 
```

和旧版本：

```
def slugify(value):
    """
    Normalizes string, converts to lowercase, removes non-alpha characters,
    and converts spaces to hyphens.
    """
    import unicodedata
    value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore')
    value = unicode(re.sub('[^\w\s-]', '', value).strip().lower())
    value = unicode(re.sub('[-\s]+', '-', value))
    # ...
    return value 
```

还有更多，但我忽略了它，因为它没有解决 slugification ，而是逃避。

* * *

## 回答 #2

> 赞同：140
> 
> 时间：2008-11-17T09:12:49.910

您可以将列表推导与字符串方法一起使用。

```
>>> s
'foo-bar#baz?qux@127/\\9]'
>>> "".join(x for x in s if x.isalnum())
'foobarbazqux1279' 
```

* * *

## 回答 #3

> 赞同：108
> 
> 时间：2008-11-17T09:10:49.507

如果文件的格式或非法的有效字符组合（如“..”）没有限制，例如，您所说的，这种白名单方法（即只允许 valid_chars 中存在的字符）将起作用将允许一个名为“.txt”的文件名，我认为这在 Windows 上无效。由于这是最简单的方法，我会尝试从 valid_chars 中删除空格并在出现错误时添加一个已知的有效字符串，因此任何其他方法都必须知道允许在哪里处理[Windows 文件命名限制](https://stackoverflow.com/questions/62771/how-check-if-given-string-is-legal-allowed-file-name-under-windows)，因此是复杂得多。

```
>>> import string
>>> valid_chars = "-_.() %s%s" % (string.ascii_letters, string.digits)
>>> valid_chars
'-_.() abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
>>> filename = "This Is a (valid) - filename%$&$ .txt"
>>> ''.join(c for c in filename if c in valid_chars)
'This Is a (valid) - filename .txt' 
```

* * *

## 回答 #4

> 赞同：107
> 
> 时间：2008-11-17T09:12:02.110

使用字符串作为文件名的原因是什么？如果人类可读性不是一个因素，我会选择 base64 模块，它可以生成文件系统安全字符串。它不可读，但您不必处理碰撞并且它是可逆的。

```
import base64
file_name_string = base64.urlsafe_b64encode(your_string) 
```

**更新**：根据马修评论更改。

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2008-11-17T09:57:40.240

只是为了使事情更加复杂，仅通过删除无效字符就不能保证您获得有效的文件名。由于允许的字符在不同的文件名上有所不同，因此保守的方法最终可能会将有效名称变成无效名称。您可能需要为以下情况添加特殊处理：

*   该字符串都是无效字符（留下一个空字符串）

*   您最终会得到一个具有特殊含义的字符串，例如“。” 或者 ”..”

*   在 Windows 上，[某些设备名称](http://msdn.microsoft.com/en-us/library/aa365247.aspx)是保留的。例如，您不能创建名为“nul”、“nul.txt”（或实际上是 nul.anything）的文件。保留名称为：

    CON、PRN、AUX、NUL、COM1、COM2、COM3、COM4、COM5、COM6、COM7、COM8、COM9、LPT1、LPT2、LPT3、LPT4、LPT5、LPT6、LPT7、LPT8 和 LPT9

您可以通过在文件名前添加一些永远不会导致这些情况之一的字符串并去除无效字符来解决这些问题。

* * *

## 回答 #6

> 赞同：43
> 
> 时间：2015-04-29T11:19:47.043

Github 上有一个不错的项目叫做[python-slugify](https://github.com/un33k/python-slugify)：

安装：

```
pip install python-slugify 
```

然后使用：

```
>>> from slugify import slugify
>>> txt = "This\ is/ a%#$ test ---"
>>> slugify(txt)
'this-is-a-test' 
```

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2017-10-18T00:24:44.417

就像[S.Lott](https://stackoverflow.com/users/10661)回答的那样，您可以查看[Django 框架](https://www.djangoproject.com/)，了解它们如何将字符串转换为有效的文件名。

最新和更新的版本在 utils/text.py 中，并定义了“get_valid_filename”，如下：

```
def get_valid_filename(s):
    s = str(s).strip().replace(' ', '_')
    return re.sub(r'(?u)[^-\w.]', '', s) 
```

（见[https://github.com/django/django/blob/master/django/utils/text.py](https://github.com/django/django/blob/master/django/utils/text.py)）

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2009-03-30T19:40:17.967

这是我最终使用的解决方案：

```
import unicodedata

validFilenameChars = "-_.() %s%s" % (string.ascii_letters, string.digits)

def removeDisallowedFilenameChars(filename):
    cleanedFilename = unicodedata.normalize('NFKD', filename).encode('ASCII', 'ignore')
    return ''.join(c for c in cleanedFilename if c in validFilenameChars) 
```

unicodedata.normalize 调用将重音字符替换为无重音等效字符，这比简单地将它们剥离要好。之后，所有不允许的字符都将被删除。

我的解决方案没有预先添加已知字符串来避免可能的不允许的文件名，因为我知道在我的特定文件名格式下它们不会出现。一个更通用的解决方案需要这样做。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2016-08-04T11:29:03.080

在一行中：

```
valid_file_name = re.sub('[^\w_.)( -]', '', any_string) 
```

您还可以放置“_”字符以使其更具可读性（例如，在替换斜杠的情况下）

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2008-11-17T10:45:54.277

请记住，Unix 系统上的文件名实际上没有限制，除了

*   它可能不包含 \0
*   它可能不包含 /

其他一切都是公平的游戏。

```
$触摸“
> 甚至多行
> 哈哈
> ^[[31m 红色 ^[[0m
> 邪恶”
$ ls -la
-rw-r--r-- 11 月 17 日 23:39？甚至是多行？哈哈？？[31m 红色？[0m？邪恶
$ ls -实验室
-rw-r--r-- 0 Nov 17 23:39 \neven\ multiline\nhaha\n\033[31m\ red\ \033[0m\nevil
$ perl -e 'for my $i ( glob(q{./*even*}) ){ print $i; } '
./
甚至多行
哈哈
 红色的
邪恶的

```

是的，我只是将 ANSI 颜色代码存储在一个文件名中并让它们生效。

为了娱乐，将 BEL 字符放在目录名称中，然后观看 CD 插入其中的乐趣；）

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-11-17T09:10:53.640

您可以使用 re.sub() 方法来替换任何不是“类似文件”的东西。但实际上，每个字符都可能是有效的；所以没有预先构建的功能（我相信）来完成它。

```
import re

str = "File!name?.txt"
f = open(os.path.join("/tmp", re.sub('[^-a-zA-Z0-9_.() ]+', '', str)) 
```

将导致 /tmp/filename.txt 的文件句柄。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2008-11-17T10:15:15.290

```
>>> import string
>>> safechars = bytearray(('_-.()' + string.digits + string.ascii_letters).encode())
>>> allchars = bytearray(range(0x100))
>>> deletechars = bytearray(set(allchars) - set(safechars))
>>> filename = u'#ab\xa0c.$%.txt'
>>> safe_filename = filename.encode('ascii', 'ignore').translate(None, deletechars).decode()
>>> safe_filename
'abc..txt' 
```

它不处理空字符串、特殊文件名（'nul'、'con' 等）。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-11-17T11:24:49.690

为什么不直接用 try/except 包装“osopen”，让底层操作系统判断文件是否有效？

这似乎少了很多工作，并且无论您使用哪种操作系统都是有效的。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-11-17T13:24:19.840

其他评论尚未解决的另一个问题是空字符串，这显然不是有效的文件名。您还可以通过剥离太多字符而得到一个空字符串。

Windows 保留的文件名和点的问题是什么，最安全的答案是“如何从任意用户输入规范化有效文件名？”这个问题。是“甚至不要费心尝试”：如果您能找到任何其他方法来避免它（例如，使用数据库中的整数主键作为文件名），请这样做。

如果必须，并且您确实需要允许空格和“。” 对于作为名称一部分的文件扩展名，请尝试以下操作：

```
import re
badchars= re.compile(r'[^A-Za-z0-9_. ]+|^\.|\.$|^ | $|^$')
badnames= re.compile(r'(aux|com[1-9]|con|lpt[1-9]|prn)(\.|$)')

def makeName(s):
    name= badchars.sub('_', s)
    if badnames.match(name):
        name= '_'+name
    return name 
```

即使这也不能保证正确，尤其是在意外的操作系统上——例如 RISC 操作系统讨厌空格并使用 '.' 作为目录分隔符。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2009-03-11T10:44:46.900

虽然你必须小心。如果您只看拉丁语，您的介绍中没有明确说明。如果仅使用 ascii 字符对某些单词进行消毒，它们可能会变得毫无意义或其他含义。

假设您有“forêt poésie”（森林诗歌），您的消毒可能会产生“fort-posie”（强+无意义的东西）

更糟糕的是，如果您必须处理中文字符。

“下北沢”你的系统可能最终会做“---”，这在一段时间后注定会失败并且没有多大帮助。因此，如果您只处理文件，我鼓励您将它们称为您控制的通用链或保持字符不变。对于 URI，大致相同。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2019-03-11T12:21:02.210

我意识到有很多答案，但它们主要依赖于正则表达式或外部模块，所以我想提出我自己的答案。一个纯 python 函数，不需要外部模块，不使用正则表达式。我的方法不是清除无效字符，而是只允许有效字符。

```
def normalizefilename(fn):
    validchars = "-_.() "
    out = ""
    for c in fn:
      if str.isalpha(c) or str.isdigit(c) or (c in validchars):
        out += c
      else:
        out += "_"
    return out 
```

如果您愿意，您可以在变量开头添加自己的有效字符`validchars`，例如英文字母表中不存在的国家字母。这是您可能想要也可能不想要的东西：一些不在 UTF-8 上运行的文件系统可能仍然存在非 ASCII 字符的问题。

此函数用于测试单个文件名的有效性，因此它将用 _ 替换路径分隔符，因为它们是无效字符。如果要添加它，修改`if`以包含 os 路径分隔符很简单。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-10-05T16:36:47.090

我喜欢这里的 python-slugify 方法，但它也剥离了不希望的点。所以我优化了它以通过这种方式将干净的文件名上传到 s3：

```
pip install python-slugify 
```

示例代码：

```
s = 'Very / Unsafe / file\nname hähä \n\r .txt'
clean_basename = slugify(os.path.splitext(s)[0])
clean_extension = slugify(os.path.splitext(s)[1][1:])
if clean_extension:
    clean_filename = '{}.{}'.format(clean_basename, clean_extension)
elif clean_basename:
    clean_filename = clean_basename
else:
    clean_filename = 'none' # only unclean characters 
```

输出：

```
>>> clean_filename
'very-unsafe-file-name-haha.txt' 
```

这是非常安全的，它适用于没有扩展名的文件名，它甚至只适用于不安全的字符文件名（结果在`none`这里）。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2019-04-22T04:48:57.433

针对 python 3.6 修改的答案

```
import string
import unicodedata

validFilenameChars = "-_.() %s%s" % (string.ascii_letters, string.digits)
def removeDisallowedFilenameChars(filename):
    cleanedFilename = unicodedata.normalize('NFKD', filename).encode('ASCII', 'ignore')
    return ''.join(chr(c) for c in cleanedFilename if chr(c) in validFilenameChars) 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2020-03-25T19:34:33.297

如果您不介意安装软件包，这应该很有用： [https ://pypi.org/project/pathvalidate/](https://pypi.org/project/pathvalidate/)

从[https://pypi.org/project/pathvalidate/#sanitize-a-filename](https://pypi.org/project/pathvalidate/#sanitize-a-filename)：

> ```
> from pathvalidate import sanitize_filename
> 
> fname = "fi:l*e/p\"a?t>h|.t<xt"
> print(f"{fname} -> {sanitize_filename(fname)}\n")
> fname = "\0_a*b:c<d>e%f/(g)h+i_0.txt"
> print(f"{fname} -> {sanitize_filename(fname)}\n") 
> ```
> 
> ### 输出
> 
> ```
> fi:l*e/p"a?t>h|.t<xt -> filepath.txt
> _a*b:c<d>e%f/(g)h+i_0.txt -> _abcde%f(g)h+i_0.txt 
> ```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2021-03-26T08:15:03.323

当遇到同样的问题时，我使用了 python-slugify。

Shoham 也建议使用，但正如 therealmarv 指出的那样，默认情况下 python-slugify 也会转换点。

`regex_pattern`可以通过在参数中包含点来推翻这种行为。

```
> filename = "This is a väryì' Strange File-Nömé.jpeg"
> pattern = re.compile(r'[^-a-zA-Z0-9.]+')
> slugify(filename,regex_pattern=pattern) 
'this-is-a-varyi-strange-file-nome.jpeg' 
```

请注意，正则表达式模式是从

`ALLOWED_CHARS_PATTERN_WITH_UPPERCASE`

`slugify.py`python-slugify 包文件中的全局变量，并以“。”扩展。

请记住，`.()`必须使用 . 等特殊字符进行转义`\`。

如果要保留大写字母，请使用该`lowercase=False`参数。

```
> filename = "This is a väryì' Strange File-Nömé.jpeg"
> pattern = re.compile(r'[^-a-zA-Z0-9.]+')
> slugify(filename,regex_pattern=pattern, lowercase=False) 
'This-is-a-varyi-Strange-File-Nome.jpeg' 
```

这使用 Python 3.8.4 和 python-slugify 4.0.1

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2012-05-16T01:04:34.197

这些解决方案中的大多数都不起作用。

'/hello/world' -> 'helloworld'

'/helloworld'/ -> 'helloworld'

这通常不是您想要的，假设您正在为每个链接保存 html，您将覆盖不同网页的 html。

我腌制一个字典，例如：

```
{'helloworld': 
    (
    {'/hello/world': 'helloworld', '/helloworld/': 'helloworld1'},
    2)
    } 
```

2 表示应附加到下一个文件名的数字。

我每次从字典中查找文件名。如果它不存在，我创建一个新的，如果需要，附加最大数量。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-09-12T12:19:39.407

不完全是 OP 所要求的，但这是我使用的，因为我需要独特且可逆的转换：

```
# p3 code
def safePath (url):
    return ''.join(map(lambda ch: chr(ch) if ch in safePath.chars else '%%%02x' % ch, url.encode('utf-8')))
safePath.chars = set(map(lambda x: ord(x), '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+-_ .')) 
```

结果是“有点”可读的，至少从系统管理员的角度来看。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-07-10T10:19:11.657

**更新**

在这个 6 岁的答案中，所有链接都无法修复。

另外，我也不会再这样做了，只是`base64`编码或丢弃不安全的字符。Python 3 示例：

```
import re
t = re.compile("[a-zA-Z0-9.,_-]")
unsafe = "abc∂éåß®∆˚˙©¬ñ√ƒµ©∆∫ø"
safe = [ch for ch in unsafe if t.match(ch)]
# => 'abc' 
```

您可以编码和解码，因此`base64`您可以再次检索原始文件名。

但是根据用例，您最好生成一个随机文件名并将元数据存储在单独的文件或数据库中。

```
from random import choice
from string import ascii_lowercase, ascii_uppercase, digits
allowed_chr = ascii_lowercase + ascii_uppercase + digits

safe = ''.join([choice(allowed_chr) for _ in range(16)])
# => 'CYQ4JDKE9JfcRzAZ' 
```

**原始链接回答**：

该`bobcat`项目包含一个执行此操作的 python 模块。

它并不完全健壮，请参阅此[帖子](http://mail.python.org/pipermail/python-list/2007-September/628023.html)和此[回复](http://mail.python.org/pipermail/python-list/2007-September/628042.html)。

因此，如前所述：`base64`如果可读性无关紧要，编码可能是一个更好的主意。

*   文档[https://svn.origo.ethz.ch/bobcat/src-doc/safefilename-module.html](https://svn.origo.ethz.ch/bobcat/src-doc/safefilename-module.html)
*   来源[https://svn.origo.ethz.ch/bobcat/trunk/src/bobcatlib/safefilename.py](https://svn.origo.ethz.ch/bobcat/trunk/src/bobcatlib/safefilename.py)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2012-05-05T03:56:00.797

我确定这不是一个很好的答案，因为它修改了它循环的字符串，但它似乎工作正常：

```
import string
for chr in your_string:
 if chr == ' ':
   your_string = your_string.replace(' ', '_')
 elif chr not in string.ascii_letters or chr not in string.digits:
    your_string = your_string.replace(chr, '') 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-12-18T16:18:21.980

在这里，这应该涵盖所有基础。它为您处理所有类型的问题，包括（但不限于）字符替换。

适用于 Windows、*nix 和几乎所有其他文件系统。仅允许可打印字符。

```
def txt2filename(txt, chr_set='normal'):
    """Converts txt to a valid Windows/*nix filename with printable characters only.

    args:
        txt: The str to convert.
        chr_set: 'normal', 'universal', or 'inclusive'.
            'universal':    ' -.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'
            'normal':       Every printable character exept those disallowed on Windows/*nix.
            'extended':     All 'normal' characters plus the extended character ASCII codes 128-255
    """

    FILLER = '-'

    # Step 1: Remove excluded characters.
    if chr_set == 'universal':
        # Lookups in a set are O(n) vs O(n * x) for a str.
        printables = set(' -.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz')
    else:
        if chr_set == 'normal':
            max_chr = 127
        elif chr_set == 'extended':
            max_chr = 256
        else:
            raise ValueError(f'The chr_set argument may be normal, extended or universal; not {chr_set=}')
        EXCLUDED_CHRS = set(r'<>:"/\|?*')               # Illegal characters in Windows filenames.
        EXCLUDED_CHRS.update(chr(127))                  # DEL (non-printable).
        printables = set(chr(x)
                         for x in range(32, max_chr)
                         if chr(x) not in EXCLUDED_CHRS)
    result = ''.join(x if x in printables else FILLER   # Allow printable characters only.
                     for x in txt)

    # Step 2: Device names, '.', and '..' are invalid filenames in Windows.
    DEVICE_NAMES = 'CON,PRN,AUX,NUL,COM1,COM2,COM3,COM4,' \
                   'COM5,COM6,COM7,COM8,COM9,LPT1,LPT2,' \
                   'LPT3,LPT4,LPT5,LPT6,LPT7,LPT8,LPT9,' \
                   'CONIN$,CONOUT$,..,.'.split()        # This list is an O(n) operation.
    if result in DEVICE_NAMES:
        result = f'-{result}-'

    # Step 3: Maximum length of filename is 255 bytes in Windows and Linux (other *nix flavors may allow longer names).
    result = result[:255]

    # Step 4: Windows does not allow filenames to end with '.' or ' ' or begin with ' '.
    result = re.sub(r'^[. ]', FILLER, result)
    result = re.sub(r' $', FILLER, result)

    return result 
```

此解决方案不需要外部库。它也替代了不可打印的文件名，因为它们并不总是易于处理。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-06-22T12:30:24.883

Windows 特定路径的另一个答案，使用简单的替换并且没有时髦的模块：

```
import re

def check_for_illegal_char(input_str):
    # remove illegal characters for Windows file names/paths 
    # (illegal filenames are a superset (41) of the illegal path names (36))
    # this is according to windows blacklist obtained with Powershell
    # from: https://stackoverflow.com/questions/1976007/what-characters-are-forbidden-in-windows-and-linux-directory-names/44750843#44750843
    #
    # PS> $enc = [system.Text.Encoding]::UTF8
    # PS> $FileNameInvalidChars = [System.IO.Path]::GetInvalidFileNameChars()
    # PS> $FileNameInvalidChars | foreach { $enc.GetBytes($_) } | Out-File -FilePath InvalidFileCharCodes.txt

    illegal = '\u0022\u003c\u003e\u007c\u0000\u0001\u0002\u0003\u0004\u0005\u0006\u0007\u0008' + \
              '\u0009\u000a\u000b\u000c\u000d\u000e\u000f\u0010\u0011\u0012\u0013\u0014\u0015' + \
              '\u0016\u0017\u0018\u0019\u001a\u001b\u001c\u001d\u001e\u001f\u003a\u002a\u003f\u005c\u002f' 

    output_str, _ = re.subn('['+illegal+']','_', input_str)
    output_str = output_str.replace('\\','_')   # backslash cannot be handled by regex
    output_str = output_str.replace('..','_')   # double dots are illegal too, or at least a bad idea 
    output_str = output_str[:-1] if output_str[-1] == '.' else output_str # can't have end of line '.'

    if output_str != input_str:
        print(f"The name '{input_str}' had invalid characters, "
              f"name was modified to '{output_str}'")

    return output_str 
```

当用 测试时`check_for_illegal_char('fas\u0003\u0004good\\..asd.')`，我得到：

```
The name 'fas♥♦good\..asd.' had invalid characters, name was modified to 'fas__good__asd' 
```

# visual-studio - 如何在单个 MSI 中部署多个项目？

> ID：295138
> 
> 赞同：3
> 
> 时间：2008-11-17T09:04:26.993
> 
> 标签：visual-studio, windows-installer

我的解决方案中有 3 个要部署的项目。是否有一种使用 Visual Studio 的安装项目使用一个 MSI 部署所有三个应用程序并让用户决定他要在安装过程中安装哪些应用程序的快捷方式？

我为 3 个单独的应用程序设置了项目，我还有一个包含其他三个项目输出的总体设置项目。我是在正确的轨道上还是有更好的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T09:15:26.923

我想你可能想要合并模块。根据 MSDN：

> 合并模块是 Microsoft Windows Installer 的标准功能，它将组件与任何相关文件、资源、注册表项和设置逻辑打包在一起。您可以使用合并模块来安装多个应用程序共享的组件。您不能直接安装合并模块。您必须将它们合并到部署项目中。

[http://support.microsoft.com/kb/827025](http://support.microsoft.com/kb/827025)

在您的情况下，每个应用程序都是一个合并模块，您需要提供一些 UI 来选择要安装的应用程序。您可以修改默认页面模板之一来执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T17:36:55.617

如果使用 WiX（我建议这样做），那么您将每个项目分解为其组件，每个项目将表示为 WiX/MSI 中的一个功能，您可以对其进行有条件的安装。用于选择功能的安装程序的标准树对话框基于此，WiX 示例具有使用它的现成 UI。

至于合并模块，WiX 的主要开发人员参与了合并模块规范的早期创建，他现在建议使用 .wixlibs。[看这里](http://robmensching.com/blog/posts/2008/10/10/What-are-.wixlibs-and-why-would-you-use-them)

[WiX v3 文档](http://wix.sourceforge.net/manual-wix3/main.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T13:48:57.713

我也有类似的要求，但是我使用了合并模块，但似乎无法找到一种方法来选择要安装和不安装的特定 msm。据我了解，在将 msm 与 msm 集成时，可以在 msm 上设置无条件属性。请让我知道是否有其他方法可以这样做..

谢谢， APN

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-11T13:03:04.000

您可以使用我在此处发布的 Wix -->

[VS 2005 设置项目：使用一个 MSI 部署多个项目](https://stackoverflow.com/questions/219327/vs-2005-setup-projects-deploy-many-projects-with-one-msi#432769)

# asp.net - asp.Net GridView 将自定义对象与嵌套列表绑定

> ID：295141
> 
> 赞同：3
> 
> 时间：2008-11-17T09:05:36.523
> 
> 标签：asp.net, data-binding, gridview, gridviewcolumn, custom-object

我有一个自定义对象列表，其中包含一个自定义列表。

```
class person{
  string name;
  int age;
  List<friend> allMyFriends;
}

class friend{
  string name;
  string address;
} 
```

我试图将这些对象的列表绑定到 GridView 并且 Grid 应该为每个朋友创建一个列并在其中写入名称。如果某些人具有相同的网格，则不应创建单独的列，而应使用现有的列。你知道我的意思。（这些类只是一些示例类以简化我的案例）

有没有办法动态自定义绑定？

如果它们需要从某些接口等继承，我可以更改类定义等。

我用谷歌搜索了很多，但似乎没有一个例子能真正涵盖这种情况。

使用 objectSourceControl 可以以某种方式解决我的问题吗？

### 更新：

提供更多信息：最后我有一个人列表，而列表中的每个人都有一个朋友列表。

```
List<person> allPerson = new List<person>();
// fill the list
Grid.DataSource = allPerson;
Grid.DataBind() 
```

该表应该有每个朋友的列，行是人。如果一个人有朋友，则需要在网格中放置一个十字架（或其他）。

```
friend1 friend2
   x              peter
   x       x      adam 
```

目前拦截了 RowDataBound 事件，并且由于绑定只创建带有名称的行而不是列，因为我的 person 对象上的唯一属性是名称。有没有办法强制绑定查看人员对象中的列表属性并为每个对象创建一列。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-13T19:25:41.530

我能够使用 DataTable 作为网格的数据源来解决这个问题。我不喜欢从漂亮干净的对象转移到 DataTable 的想法，但它为您需要的动态绑定提供了支持。我修改了您的朋友对象以具有一些构造函数。这允许我清理静态代码声明，但在您的实现中可能不是必需的。

基本思想是，您将逐步遍历所有可能的朋友，将他们的名字作为 DataColumn 添加到 DataTable 中，然后为所有人员对象及其各自的朋友填写数据。这可能被编写为在 allPerson 对象的单次迭代中工作，但我更喜欢两次迭代以使代码更易于阅读。

该解决方案是为 c# 3.5 编写的，但可以通过更改静态数据声明来转换为旧版本。我希望这有帮助。

```
public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        // setup your person object with static data for testing
        List<person> allPerson = new List<person>()
        {
            new person() 
            { 
                name = "Dan", 
                age = 21, 
                allMyFriends = new List<friend>() { new friend("James"), new friend("John"), new friend("Matt") } 
            }, 
            new person() 
            { 
                name = "James", 
                age = 21, 
                allMyFriends = new List<friend>() { new friend("Dan"), new friend("Matt"), new friend("Tom") } 
            }, 
            new person() 
            { 
                name = "John", 
                age = 21, 
                allMyFriends = new List<friend>() { new friend("Dan") } 
            }, 
            new person() 
            { 
                name = "Matt", 
                age = 21, 
                allMyFriends = new List<friend>() { new friend("Dan"), new friend("James") } 
            }, 
            new person() 
            { 
                name = "Tom", 
                age = 21, 
                allMyFriends = new List<friend>() { new friend("James") } 
            }
        };

        System.Data.DataTable dt = new System.Data.DataTable();
        dt.Columns.Add("Name");
        dt.Columns.Add("Age");

        foreach (person p in allPerson)
        {
            // step through each person and look at their friends
            foreach (friend f in p.allMyFriends)
            {
                // look to see if this friend has a column already
                if (!dt.Columns.Contains(f.name))
                {
                    dt.Columns.Add(f.name);
                }
            }
        }

        foreach (person p in allPerson)
        {
            // create the datarow that represents the person
            System.Data.DataRow dr = dt.NewRow();
            dr["Name"] = p.name;
            dr["Age"] = p.age;

            // find the friends and mark them
            foreach (friend f in p.allMyFriends)
            {
                dr[f.name] = "X";
            }

            dt.Rows.Add(dr);
        }

        // fill the list
        this.Grid.DataSource = dt;
        this.Grid.DataBind();

    }
}

public class person
{
    public string name;
    public int age;
    public List<friend> allMyFriends = new List<friend>();
}

public class friend
{
    public string name;
    public string address;

    public friend()
    {

    }

    public friend(string name)
    {
        this.name = name;
    }

    public friend(string name, string address)
    {
        this.name = name;
        this.address = address;
    }
} 
```

编辑：我忘了添加这是如何呈现的。

```
-------------------------------------------------
| Name  | Age | James | John | Matt | Dan | Tom |
-------------------------------------------------
| Dan   | 21  | X     | X    | X    |     |     |
| James | 21  |       |      | X    | X   | X   |
| John  | 21  |       |      |      | X   |     |
| Matt  | 21  | X     |      |      | X   |     |
| Tom   | 21  | X     |      |      |     |     |
------------------------------------------------- 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T13:17:50.430

听起来您正试图在 GridView 中显示矩阵/交叉表。您可能会发现以更兼容的格式获取检索数据会更容易。如果您使用 SQL Server，可以考虑编写交叉表查询。

如果您必须使用当前形式的对象，在开始之前创建一个合并的朋友列表也可以通过提供列列表来提供帮助。然后，您可以将每一列绑定到一个函数调用，该函数调用可能会尝试在行好友列表中查找列 person。

不漂亮，但可以工作...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-08T01:49:17.120

您也可以只使用 RowDataBound 事件处理程序来执行复杂的绑定。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-28T07:31:48.703

使用以下内容：

DataBinder.Eval(Container.DataItem,"PPP.PPP")

# asp.net - ASP.NET 安全最佳实践

> ID：295156
> 
> 赞同：27
> 
> 时间：2008-11-17T09:14:18.410
> 
> 标签：asp.net, security

还有哪些其他 ASP.NET 安全最佳实践？

到目前为止确定的列表如下：

*   每当您将应用程序转移到生产环境时，请始终生成新的加密密钥和管理员密码。

*   切勿直接或以加密形式存储密码。始终存储一种方式的哈希密码。

*   始终将连接字符串存储在 Web.config 的标记中，并使用受保护的配置提供程序（RSA 或 DPAPI）在配置部分对其进行加密。在此处查看[示例](http://msdn.microsoft.com/en-us/library/ms998372.aspx#pagpractices0001_conhowtoencryptsensitivedatainmachineconfigandwebconfig)

*   使用具有最低权限的用户 ID 连接到 SQL 服务器或您正在使用的数据库。例如，如果您只从应用程序的某个模块执行存储过程，那么您必须创建一个仅具有执行权限的用户 ID。

*   如果要在页面上使用基于角色的安全性，请使用[PrincipalPermission 。](http://msdn.microsoft.com/en-us/library/system.security.permissions.principalpermission.aspx)

    ```
    [PrincipalPermission(SecurityAction.Demand, Role="Admin")]  
    公共类 AdminOnlyPage : BasePageClass  
    {  
      // ...  
    }
    ```

*   始终使用参数来防止SQL 查询中的[SQL 注入](http://en.wikipedia.org/wiki/SQL_Injection)。

    1.  考虑在 IIS 服务器上安装 URLScan 以防止 SQL 注入。此外，用于防止 XSS 攻击。您可以使用 MSFT 的 AntiXSS 库而不是内置的编码输出，而不是 HttpServerUtility 中的内置 HtmlEncode。
*   始终保持 web 配置中的 customErrors 使您的错误/异常私有化

    <customErrors mode="On" defaultRedirect="MyErrorPage.htm" />

*   在 Web 应用程序中，始终验证用户输入的 html 标记或任何脚本。

*   切勿在 cookie 中存储敏感信息，例如密码。

*   不要显示系统错误消息、堆栈跟踪等，以防出现异常。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-17T12:58:42.560

我发现 Microsoft 的[Developer Highway Code](https://download.microsoft.com/documents/uk/msdn/security/The%20Developer%20Highway%20Code.pdf)是一个有用的安全检查表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-17T12:09:57.133

微软对这个话题有很多话要说：

*   [ASP.NET Web 应用程序安全性](http://msdn.microsoft.com/en-us/library/330a99hc.aspx)。
*   [提高 Web 应用程序安全性](http://msdn.microsoft.com/en-us/library/ms994921.aspx)（专门针对该主题的一本书）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-18T14:19:35.343

1.  切勿将密码等敏感信息存储在 cookie 中。
2.  不要显示系统错误消息、堆栈跟踪等，以防出现异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T06:24:17.907

查看新的安全运行时引擎（测试版于 11 月 14 日发布）：

[http://blogs.msdn.com/cisg/archive/2008/10/24/a-sneak-peak-at-the-security-runtime-engine.aspx](http://blogs.msdn.com/cisg/archive/2008/10/24/a-sneak-peak-at-the-security-runtime-engine.aspx)

[http://blogs.msdn.com/cisg/archive/2008/11/13/an-update-on-some-upcoming-free-tools.aspx](http://blogs.msdn.com/cisg/archive/2008/11/13/an-update-on-some-upcoming-free-tools.aspx)

这应该替换当前的 Anti-XSS 库。

安东尼:-) www.codersbarn.com

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T12:16:23.610

在页面上显示来自数据库的内容时，您可以使用**HttpServerUtility.HtmlEncode**对输出进行编码以避免跨站点脚本 (XSS) 攻击。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T02:49:49.057

考虑在 IIS 服务器上安装 URLScan 以防止 SQL 注入。
此外，为了防止 XSS 攻击，我将使用 MSFT 的 AntiXSS 库而不是内置的编码输出而不是 HttpServerUtility 中的内置 HtmlEncode。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-10T11:10:21.207

您可能会对这篇[安全最佳实践：ASP.NET 应用程序](http://www.cyphersec.com/2009/10/04/how-to-secure-an-asp-net-application/)感兴趣。高温高压

# .net - 如果未安装 .NET 3.5，如何避免 FileNotFoundException？

> ID：295161
> 
> 赞同：3
> 
> 时间：2008-11-17T09:16:27.360
> 
> 标签：.net, .net-3.5

如果您尝试在未安装此版本的 .NET 框架的 Windows 计算机上启动 .NET 3.5 应用程序，您将获得`FileNotFoundException`一些系统程序集（例如 System.Core 3.5.0.0）。

是否有可能捕获此异常并告诉用户升级他们的 .NET 框架，或者它是否过早抛出而无法处理？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T09:22:20.530

最简单的事情就是尝试一下。（我没有任何非 3.5 的机器来测试它，但我假设你有。）

使您的入口点成为一个非常简单的入口点，它只是尝试`System.Core.dll`适当地加载和处理异常。如果它通过，则转到另一个可以使用它的类。如果失败，给出相应的错误信息并退出。

我*怀疑*您不需要完全这种级别的隔离-只要您没有任何类型不可用的字段，我不希望程序集在您第一次调用需要它的方法之前得到解决. 我必须通过 C# 咨询 CLR 来检查。然而，保持它完全隔离可能会更安全——它可以避免你以后不小心引入依赖项。哎呀，您甚至可以将“启动和检查”类型放在一个单独的程序集中，如果一切正常，它什么都不做，只是启动另一个程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T09:55:23.067

您目前如何部署应用程序？ClickOnce 可以在启动前进行组装 (GAC) 检查，并且使用 msi，您应该有一系列可用的预检查选项......虽然并不总是可行，但您可能会考虑其中一个部署选项？

重新捕获异常 - 只需确保将 Main 拆分，以便它除了捕获异常之外*什么都不*做- 否则 JIT 可以阻止 Main 加载：

```
// [STAThread] here if winform
[MethodImpl(MethodImplOptions.NoInlining)]
static void Main() {
    try {
       MainCore();
    } catch (SomeException ex) {
       // TODO something simple but fun
    }
}

static void MainCore() { ... } // your app here... 
```

如果你在外部 Main 中放了太多，它可能会在运行*任何*它之前呕吐，因为 JIT 可能需要这些类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T09:28:02.717

你可以捕捉到那个异常，是的。

在您的主程序中，只需在主消息循环周围使用 try..catch 即可。

```
try
{
   Application.Run(new MainForm());
}
catch (Exception ex)
{ 
    if (ex.MessageContains("Could not load file or assembly 'System.Core, Version=3.5.0.0"))
    {
        MessageBox.Show("This product requires the Microsoft .NET Framework version 3.5, or greater, in order to run.\n\nPlease contact your System Administrator for more information.");
    }
} 
```

# java - 如何为此线程而不是系统设置 SecurityManager？

> ID：295163
> 
> 赞同：1
> 
> 时间：2008-11-17T09:16:38.920
> 
> 标签：java, security, multithreading, securitymanager

我有一个在其所有线程中运行基本 RMISecurityManager 的程序。但我想对多个线程进行更多控制，并专门为这些线程设置另一个 SecurityManager。

我怎样才能做到这一点 ？...如果这是可能的！？

提前谢谢你。

编辑：我找到了我的解决方案。[有关更多详细信息，请参见此处](https://stackoverflow.com/questions/290545/how-to-automatically-copy-data-to-new-rmi-threads#298148)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T11:50:39.013

这没有多大意义。如果代码（无论是否恶意）导致在不同的线程上执行怎么办？这甚至可以在 Java 库中发生，并传输安全上下文（可能使用`java.security.AccessController.getContext`/ `doPrivileged`）。

Applet 确实使用了涉及 s 的稍微困难的系统`ThreadGroup`，但我不推荐它。JAAS 允许将 a`Subject`添加到 . `AccessControlContext`，但我个人建议不要使用这种编程风格。

授予下载的代码（如果有）适当的权限，并且不要将敏感对象授予您不信任的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T11:40:08.410

SecurityManager 根据正在运行的线程的安全上下文执行检查，也许你想让你的 SecurityManager 根据它在上下文中找到的任何东西来表现不同？

或者，您可能想使用策略模式来实现您的[SecurityManager 。](http://en.wikipedia.org/wiki/Strategy_pattern)

yc

# c# - 如何在 Excel 中的 SheetChange 事件中确定新的和以前的单元格值？

> ID：295165
> 
> 赞同：2
> 
> 时间：2008-11-17T09:19:28.210
> 
> 标签：c#, excel, vsto

我的 Excel 工作簿中有一些特殊的单元格，由我的 Excel 加载项管理。我想阻止用户更改这些单元格的内容，但我也想知道用户想要输入这些单元格的值。在 SheetChange 事件中，我可以检查哪些用户输入了我的特殊单元格，但是如何确定这些单元格中的 PREVIOUS 值并恢复用户更改？

* * *

这不是我的解决方案。如果我在 Excel 中锁定单元格，它将变为只读的 - 用户甚至无法尝试在此单元格中输入任何内容 - 在这种情况下，Excel 会弹出警告对话框。我的问题是我想捕捉用户输入我的单元格的内容，用这个值做一些事情，然后将单元格内容恢复为原始值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T13:17:53.987

也许它适合捕获进入单元格的值：

```
Option Explicit
Dim LastText As String

Private Sub Workbook_SheetSelectionChange(ByVal Sh As Object, _
        ByVal Target As Excel.Range)
    LastText = Target.Value
End Sub

Private Sub Workbook_SheetChange(ByVal Sh As Object, _
        ByVal Source As Range)
    Debug.Print LastText; Source
End Sub 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T10:02:52.257

像这样的东西怎么样，它在 VBA 中，但应该很容易翻译成 C#

```
Option Explicit

' We are monitoring cell B2...

Private initialB2Value As Variant  ' holds the value for reinstatement when the user changes it

Private Sub Worksheet_Activate()
' record the value before the user makes any changes.
' Could be a constant value, or you could use .Formula to ensure a calculation is not lost
    initialB2Value = Range("B2").Value

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)

Static alreadyChanging As Boolean 
' when we reset the cell, Worksheet_Change will fire again, so we'll use a flag
' to tell us if we should care or not...

    If alreadyChanging Then ' change is because of this code, no need to process
        alreadyChanging = False
        Exit Sub
    End If

    If IsEmpty(Intersect(Target, Range("B2"))) Then
    ' If the change is not happening to the range we are monitoring, ignore it
        Exit Sub
    End If

    ' Do something with the user's input here
    Debug.Print "User input " & Range("B2").Value & " into B2"

    ' before we reset the value, flag that we are changing the value in code
    alreadyChanging = True

    ' now apply the old value
    Range("B2").Value = initialB2Value

End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T09:30:06.770

如果您需要防止用户更改值，为什么不锁定单元格（右键单击、格式化单元格、锁定）然后保护工作表（工具-保护-保护工作表）。当以编程方式更改单元格时，更改锁定属性并在计算后将其更改回来

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-18T16:32:17.657

我通过`Application.Undo`检查更改是否无效来解决此问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T12:33:19.723

我会将单元格的副本保留在隐藏的工作表上。

然后当用户更改一个单元格时，很容易在隐藏的工作表上找到匹配的单元格。

# c++ - Windows 上的 C 编译器之间的实际区别是什么？

> ID：295169
> 
> 赞同：3
> 
> 时间：2008-11-17T09:23:05.647
> 
> 标签：c++, c, winapi, cross-platform

用 Visual C/C++ 2005/2008 编写的程序可能无法使用其他编译器（例如 GNU C/C++）编译，反之亦然。例如，当尝试重用为特定编译器编写的使用 windows.h 的代码时，需要注意哪些差异？

是否有关于如何生成与一种编译器或另一种编译器兼容的代码的任何信息，例如与 GC/C++ 或 MSVC/C++ 兼容的代码？尝试这样做会导致什么问题？

那么其他编译器呢，例如 LCC 和 Digital Mars？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-17T10:25:42.243

尝试将 MSVC 编写的代码编译到其他编译器时要做的第一件事是在关闭 Microsoft 扩展的情况下对其进行编译。（我认为使用 /Za 标志）。这会消除 GCC 和其他编译器会抱怨的很多东西。

下一步是确保特定于 Windows 的 API（MFC、Win32 等）在特定于 Windows 的文件中被隔离，从而有效地将您的代码划分为“通用”和“特定于 Windows”的模块。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-17T16:02:27.523

还记得如果您希望您的网页在不同的浏览器上工作，那么您应该编写符合标准的 HTML 的论点吗？

编译器也是如此。

在语言级别，如果您的代码在 GCC 上使用 -std=c89（或 C++ 的 -std=c++98）、-pedantic -Wall 以及 -Wextra 编译时没有警告，如果您感觉很勇敢，并且只要您还没有使用 -pedantic 允许的任何更明显的 GNU 扩展（这很难意外地做到），那么它很有可能在大多数 C89 编译器上工作。C++ 不太确定，因为您可能依赖于目标编译器对该标准的支持程度。

编写正确的 C89 有点限制（ // 没有注释，声明必须在块中的语句之前，没有 inline 关键字，没有 stdint.h 因此没有 64 位类型等），但是一旦你习惯了它并不算太糟糕。如果你只关心 GCC 和 MSVC，你可以打开一些你知道 MSVC 有的语言特性。否则，您可以编写自己的小“语言抽象”标题。例如，在 GCC 和 MSVC/C++ 上将“inline”定义为“inline”，而在 MSVC/C 上定义为“__inline”。或者 MSVC stdint.h 很容易找到或编写。

我过去曾成功编写过可移植代码——我主要在一个平台上使用 GCC 为特定产品工作。我还编写了适用于所有平台的代码，包括 Windows XP 和 Mobile。在构建服务器上运行“测试构建”之前，我从未为这些平台编译过它，而且我很少遇到任何问题。我想我可能编写了错误的代码，触发了一次或两次 64 位兼容性警告。

Windows 程序员采取相反的方式偶尔会导致问题，主要是因为他们的编译器不像我们的那样迂腐，所以我们看到了他们没有的警告，而不是 GCC 根本不支持的东西。但是修复警告意味着当代码后来在具有更原始编译器的系统上使用时，它仍然有效。

在图书馆层面，这要困难得多。如果你#include 并通过 windows.h 使用 Windows API，那么显然它不会在 linux 上工作，如果你使用 KDE 和 GCC，然后尝试使用 MSVC 编译，情况也是如此。

严格来说，这是一个平台问题，而不是编译器问题，但它相当于同一件事。如果你想编写可移植的代码，你需要一个操作系统抽象 API，比如你的所有目标都支持的 POSIX（或其子集），并且你需要在编写它时考虑“可移植”。采用大量使用特定于 Windows 的 API 的代码，并试图让它在 GCC/linux 上工作，基本上是对 AFIAK 的完全重写。使用 WINE 可能比尝试重新编译它更好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-17T17:09:10.743

您正在混淆“编译器”和“操作系统”。<windows.h> 不是 MSVC C 编译器带来的东西：它是 Windows API 的 C 特定体现。您可以从 Visual Studio 中独立获得它。Windows 上的任何其他 C 编译器都可能提供它。例如，在 Linux 端，您有 <unistd.h>、<pthereads.h> 等。它们不是 GCC 的重要组成部分，任何其他为 Linux 编译的编译器都会提供它们。

因此，您需要回答两个不同的问题：如何以任何编译器都接受的方式编写 C 代码？以及如何隐藏我对操作系统的依赖？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-18T07:16:50.563

正如您从不同的答案中可以看出的那样，这个主题相当复杂。请记住，这是我最近将一些代码移植到三个平台（msvc 8/Windows、gcc 4.2/Linux、gcc 3.4/嵌入式 ARM9 处理器）时遇到的一些问题。它最初只能在 Visual Studio 2005 下编译。

a) 许多在 Windows 平台上编写的代码使用 windows.h 中定义的类型。我必须创建一个“windows_types.h”文件，其中包含以下内容：

```
#ifndef _WIN32
    typedef short              INT16;
    typedef unsigned short     UINT16;
    typedef int                INT32;
    typedef unsigned int       UINT32;
    typedef unsigned char      UCHAR;
    typedef unsigned long long UINT64;
    typedef long long          INT64;
    typedef unsigned char      BYTE;
    typedef unsigned short     WORD;
    typedef unsigned long      DWORD;
    typedef void *             HANDLE;
    typedef long               LONG;
#endif 
```

丑陋，但比修改以前仅针对 Windows 的代码要容易得多。

b) 在模板代码中不需要 typename 关键字来声明类型。MSVC 在这方面很松懈（尽管我假设某些编译器开关会产生警告）。不得不在很多地方添加它。

c) 简单，但耗时：Windows 不区分大小写，许多#included 文件被指定为不正确的大小写，导致在 Linux 下出现问题。

d) 有相当多的代码使用 Windows API 来做很多事情。例如 CRITICAL_SECTIONS 和 INTERLOCKED_INCREMENT。我们尽可能使用 boost 库来解决这些问题，但重新编写代码非常耗时。

e) 许多代码依赖于包含在预编译头文件中的头文件。我们在 gcc3.4 上使用 pch 时遇到了问题，因此我们必须确保所有 .h/cpp 文件正确地包含它们的所有依赖项（因为它们应该首先具有）。

f) VS 2005 有两个讨厌的错误。 [auto_ptr 可以分配给任何东西](https://stackoverflow.com/questions/270347/replacing-autoptr-in-vc-8)，并且允许将临时变量传递给引用参数。两者都无法在 gcc 下编译（谢天谢地！），但需要返工。

g) 奇怪的是，我们有模板代码试图明确地专门化*类*模板函数。不允许。gcc 再次拒绝，VS 2005 放手了。一旦理解了问题，就很容易将其返工为常规重载。

h) 在 VS 2005 下，允许使用字符串构造 std::exception。在 gcc 或标准下不允许。重新编写代码以更喜欢使用派生异常类之一。

希望这就是您正在寻找的信息！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-17T09:31:19.233

嗯，这是一个相当困难的问题。事实上，MSVC 不支持最新的 C 标准，关于它的 c++ 合规性，我可以告诉你任何事情。但是，MSVC 和 gcc 都可以理解“windows”C，您只是不能指望另一种方式。例如，如果您使用 ANSI C99 功能，那么您可能很难从 gcc“移植”到 MSVC。

但只要你尝试 MSVC-> gcc 的方式，你的机会会更好。您唯一需要注意的是库。Windows 上的大多数库都应该与 MSVC 一起使用，因此您需要一些额外的工具来使 gcc 也可以访问它们。

LCC 是一个相当老的系统，AFAIKT 不太支持 ANSI C99，它还需要 MSVC 的工具才能正常工作。LCC“只是”一个编译器。

lcc-win32 是一个 C 开发系统，力求与 ANSI C99 兼容。它与链接器、IDE 等一起提供。

我无法了解 Digital Mars 的实施状态

然后还有 Pelles-C，它也是一个成熟的 IDE。

我们一直在 OpenWatcom 附近闲逛。这曾经是一个相当不错的系统，但我不知道它的一致性如何。

总而言之，您可以希望从 MSVC -> 其他系统中获得更简单的方法，但反过来它可能会更糟。

问候弗里德里希

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T19:16:37.040

> 用 Visual C/C++ 2005/2008 编写的程序可能无法使用其他编译器（例如 GNU C/C++）编译，反之亦然。

如果您 (1) 在一个编译器中使用某种可用的扩展而不在另一个编译器中使用某种扩展（例如，C++ 标准在一些地方需要`typename`and`template`关键字，但许多编译器 - 包括 Visual C++ 不强制执行此操作，则这是正确的； gcc 过去也不强制执行此操作，但[在 3.4 中已更改](http://www.gnu.org/software/gcc/bugs.html#new34)）或 (2) 使用在一个编译器上实现的一些标准兼容行为，但在另一个编译器上没有实现（现在这个海报男孩是导出模板，但只有一两个编译器支持这一点， Visual C++ 和 gcc 不在该组中）。

> 例如，当尝试重用为特定编译器编写的使用 windows.h 的代码时，

我从来没有见过这样做的问题。我在 gcc 中看到了使用 Microsoft 的 windows.h 的问题。但是当我在 gcc 中使用 gcc 的 windows.h 和在 Visual C++ 中使用 Microsoft 的 windows.h 时，我可以访问所有记录在案的函数。毕竟，这就是“实现的 windows.h”的定义。

> 有什么区别需要注意？

我见过的主要是人们不知道上面提到的依赖`template`/`typename`事物。我觉得有趣的是，许多人认为 gcc 不够聪明，无法做 Visual C++ 所做的事情，而实际上 gcc 首先拥有该功能，然后以符合标准的名义决定将其删除。

在不久的将来，您将在使用 C++0x 功能时遇到问题。但是 gcc 和 Visual C++ 都在该标准中实现了更简单的东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-12T17:45:29.900

vs2008 比 2005 更符合标准。
我遇到了更多问题，尤其是 gcc 的“功能”，它允许您在运行时分配一个可变大小的数组“int array [variable]”，这只是纯粹的邪恶。

# java - 我应该使用什么 Java FTP 客户端库？

> ID：295178
> 
> 赞同：93
> 
> 时间：2008-11-17T09:30:56.673
> 
> 标签：java, ftp, client

因为我没有收到[上一个](https://stackoverflow.com/questions/285237/does-a-javascriptable-ftp-upload-javaflash-applet-exist)问题的肯定答案。我将尝试自己编写一个 Java FTP 上传小程序。

我的问题是：“你能推荐一个 Java FTP 客户端库供我使用吗？”

我希望它是：

*   稳定的
*   能够处理被动和主动模式
*   能够提供上传进度信息
*   如果出现问题，抛出可捕获的异常（尤其是当上传不成功时）
*   便宜/免费使用，最好是开源的

我找到[了一些图书馆的](http://www.javaworld.com/javaworld/jw-04-2003/jw-0404-ftp.html) [概述](http://www.javaworld.com/javaworld/jw-04-2003/ftp/jw-0404-ftptable.html)，但由于这篇文章是从 2003 年开始的，也许已经发生了一些新的发展:)

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-17T10:30:25.540

查看包含 FTP 实用程序的 Apache [commons-net 。](http://commons.apache.org/net/)我不知道它是否满足您的所有要求，但它肯定是免费的！

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-03-12T13:27:54.037

ftp4j 是最好的，无论是功能还是许可证：

[http://www.sauronsoftware.it/projects/ftp4j/](http://www.sauronsoftware.it/projects/ftp4j/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T15:14:40.943

我使用[了 Apache Commons VFS](http://commons.apache.org/vfs/)

青色

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-04T07:07:57.300

是的，EnterpriseDT 的[edtFTPj](http://www.enterprisedt.com/products/edtftpj/overview.html)是稳定的（2000 年首次发布），具有您可能需要的所有功能，并且也是开源的。

它被用于大量开源项目（以及许多商业项目）中，并且被公认为[是](http://www.javaworld.com/javaworld/jw-03-2006/jw-0306-ftp.html?page=3).

正如另一张海报所指出的，如果您确实希望升级到 SFTP 和/或 FTPS，这是一个简单的升级路径，只需要很少的代码更改。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-17T11:28:17.420

Commons-net 肯定。:) 现在大多数开源项目都在使用它。

yc

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T19:33:01.530

我已经成功使用了免费开源的[Enterprise DT FTP库。](http://www.enterprisedt.com/)我无法将它与其他库（如 Apache Commons Net 库）进行比较，因为我没有使用它们。它确实提供了到 SFTP（通过 SSH）和 FTPS（通过 SSL）的简单升级路径，尽管这是一种付费商业产品。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T01:04:46.023

Apache commons-nets 最近更新得更频繁，而 Enterprise DT 库似乎更新得更频繁。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-17T11:11:44.583

您还有这篇[2006 年的文章](http://www.nsftools.com/tips/JavaFtp.htm)，其中列出了 FTP 客户端的不同选项。

commons-net 很好，但[FTP-GO](https://web.archive.org/web/20081213000904/http://www.cellspark.com/ftp.html)可以为您提供一些您正在寻找的更高级的功能。

![kagi Ftp-Go](https://i.stack.imgur.com/lGmOE.jpg)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-31T03:56:24.580

我正在下载视频文件。Apache 的 FTPClient 失败了，它以相当快的速度下载了视频。但是当我尝试播放视频时，它会从视频中间丢失大块。ftp4j 会毫无损失地下载整个视频。

ftp4j ftw

# c# - 多产品时的生产者消费模式

> ID：295182
> 
> 赞同：2
> 
> 时间：2008-11-17T09:35:57.290
> 
> 标签：c#, design-patterns, events, .net-3.5

我有一个为一种产品工作的生产者-消费者模式。当生产者生产许多产品时，最好的实施是什么？例如，消费者应使用的 DataBaseEvent、GuiEvent 和 ControlEvent。下面的代码显示了一种产品（DataBaseEvent）的模式。每个事件类型是否应该在自己的队列中排队，或者事件是否应该继承可以排队的基类。在处理许多事件类型时可能存在更好的模式？

```
class DataBaseEventArgs : EventArgs
{
    public string textToDB = "";
}

class Consumer
{
    private Producer mProducer = new Producer();
    private Queue<DataBaseEventArgs> mDataBaseEventQueue = new Queue<DataBaseEventArgs>();
    private static EventWaitHandle mDataBaseEventWaitHandle = new EventWaitHandle(false, EventResetMode.ManualReset);
    private Thread mDataBaseEventDequeueThread = null;

    public Consumer()
    {
        mDataBaseEventDequeueThread = new Thread(DataBaseDequeueEvent);
        mDataBaseEventDequeueThread.Start();
        mProducer.mDataBaseEventHandler += WhenDataBaseEvent;
    }

    protected void DataBaseDequeueEvent()
    {
        while (true)
        {
            DataBaseEventArgs e;
            lock (((ICollection)mDataBaseEventQueue).SyncRoot)
            {
                if (mDataBaseEventQueue.Count > 0)
                {
                    e = mDataBaseEventQueue.Dequeue();
                }
            }
            // WriteToDatabase(e.textToDB);
            if (mDataBaseEventQueue.Count == 0)
            {
                mDataBaseEventWaitHandle.WaitOne(1000);
                mDataBaseEventWaitHandle.Reset();
            }
        }
    }

    internal void WhenDataBaseEvent(object sender, DataBaseEventArgs e)
    {
        lock (((ICollection)mDataBaseEventQueue).SyncRoot)
        {
            mDataBaseEventQueue.Enqueue(e);
            mDataBaseEventWaitHandle.Set();
        }
    }
}

class Producer
{
    public event EventHandler<DataBaseEventArgs> mDataBaseEventHandler = null;

    public void SendDataBaseEvent()
    {
        if (mDataBaseEventHandler != null)
        {
            DataBaseEventArgs e = new DataBaseEventArgs();
            e.textToDB = "This text will be written to DB";
            mDataBaseEventHandler(this, e);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T09:42:00.803

如果您想主动分离工作，则多个队列将很有用 - 即为不同类型的事件使用不同的线程/池。如果您想分担负载，还有另一种选择 - 使用接口（而不是基类）。基类很好，但我想不出任何可以通过接口强制基类的东西。甚至只是一个代表去做的工作！

另外-我不确定在这种情况下您是否需要重置事件；您通常可以只使用 lock 和 Monitor.Pulse / Wait 来处理生产者/消费者（这具有较少的开销，因为不涉及 OS 对象 - 只是托管对象）。但是，如果代码当前是稳定的，也许可以保持“原样” - 线程很难做到一次，更不用说两次了......

但作为参考，它将类似于：

```
while(true) {
    T item;
    lock(lockObj) {
        if(queue.Count == 0) { // empty
            Monitor.Wait(lockObj);
            continue; // ensure there is genuinely something to do
        }
        item = queue.Dequeue();
    }
    // TODO: process item
}
...
void Add(T item) {
    lock(lockObj) {
        queue.Enqueue(item);
        if(queue.Count == 1) { // first
            Monitor.PulseAll(lockObj);
        }
    }
} 
```

（并记得在清除队列时使用 PulseAll）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T09:41:28.900

我认为如果它们具有相同的优先级并且将以类似的方式处理，最好将所有请求排入一个队列。

如果其中一个请求的概率较高，那么您需要一些花哨的优先级队列，或者您可以使用不同的队列。

此外，如果您以不同的方式处理消息，则没有必要使模式过于复杂。

# c# - 如何将数据绑定到桌面应用程序，如基于 Web 的应用程序

> ID：295192
> 
> 赞同：1
> 
> 时间：2008-11-17T09:44:10.097
> 
> 标签：c#, .net

我有一个表单，我正在“表单加载”事件中对我的 datagridview 进行数据绑定，问题是，表单需要一点（或很大程度上取决于信息的大小）来加载，因为我的数据有很多二进制信息（照片）要绑定在那里。

在一些网站，我们可以看到一个图片说“正在加载”，这很酷，对用户也有好处，因为我知道那是加载而不是停止。所以，当我对表格进行数据绑定时，我想在桌面应用程序中模拟类似的东西，你能帮我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T10:02:55.783

您不能对实际绑定本身做太多事情，因为表单具有线程关联性。但是，您可以在单独的线程上加载数据（从数据库或任何地方） - 例如查看[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)。

如果 db-load 很快，但绑定很慢，您可以查看许多标准基于列表的控件存在的“[虚拟模式”之类的东西。](http://msdn.microsoft.com/en-us/library/ms171622.aspx)这可以通过仅查看立即可见的数据来减少绑定所需的时间。

除此之外，你可以做一些事情，比如改变光标，在另一个线程上显示一个飞溅，等等。这真的取决于时间花在哪里（你有没有分析过？）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T09:45:41.747

您可以在不同的线程中显示“加载”表单。

还要考虑是否需要与表单一起加载的*所有*数据 - 可以在表单加载后加载这些数据中的任何一个吗？

尝试让您的应用程序有一种*感知*速度的感觉。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T10:36:52.703

有时不是我们决定在用户​​操作后加载数据。我的客户希望在没有用户操作的情况下加载数据。

谢谢你的回答:)

# python - 如何将带有冒号的目录添加到 PYTHONPATH？

> ID：295195
> 
> 赞同：7
> 
> 时间：2008-11-17T09:46:19.000
> 
> 标签：python, bash, shell

问题很简单：

使用 bash，我想将一个目录添加到我的 PYTHONPATH 以方便脚本执行。不幸的是，我要使用的目录中有一个 : 。所以我尝试以下每一项

```
export PYTHONPATH=${PYTHONPATH}:/home/shane/mywebsite.com:3344/
export PYTHONPATH=${PYTHONPATH}:/home/shane/mywebsite.com\:3344/
export PYTHONPATH=${PYTHONPATH}:"/home/shane/mywebsite.com:3344/" 
```

这些都不起作用。每次，路径都会在 python 的路径上创建为两个单独的目录。我的问题是，是否可以为 bash 做到这一点？如果是这样，需要什么语法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-17T10:38:26.243

问题不在于 bash。它应该正确设置您的环境变量，并带有`:`字符。

相反，问题在于 Python 对`PYTHONPATH`变量的解析。[`PATH`按照变量](http://sourceware.org/cgi-bin/cvsweb.cgi/libc/posix/execvp.c?rev=1.27&content-type=text/x-cvsweb-markup&cvsroot=glibc)设置的示例，似乎根本没有转义字符，因此无法将其解释`:`为分隔符以外的其他内容。您可以在[Python 解释器源代码](http://svn.python.org/view/python/trunk/Modules/getpath.c?rev=54257&view=auto)中亲自查看。

正如几个人已经提到的，唯一的解决方案是使用符号链接或其他东西来允许您为目录提供无冒号的名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T10:08:42.277

只有一个你没有尝试过：

```
export PYTHONPATH=${PYTHONPATH}:"/home/shane/mywebsite.com\:3344/" 
```

问题在于没有引号，转义被直接解释，并在字符串中转换为文字“：”。但是“：”需要稍后评估。

```
$ echo "foo:" 
foo:
$ echo \:foo
:foo
$ echo ":foo"
:foo
$ echo "\:foo"
\:foo 
```

我不能保证这会解决您的 python 路径问题，但它会将 \ 文字放入字符串中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-01-11T17:56:53.373

OP 试图将带有端口号的 URL 添加到文件路径列表中。这种类型的 URL 不是文件路径，因此 python 永远不会在该位置找到 python 文件。将带有端口号的 URL 放入 PYTHONPATH 是没有意义的。

无论如何，有些人可能会因为以下原因而结束这个问题：

在 Windows 路径上，驱动器指示符后跟冒号，例如`C:/Python27/lib`. 在 Windows 上的 bash 中，您可以使用分号向 PYTHONPATH 添加多个路径，如下所示：

```
$ export PYTHONPATH="C:\MYPATH1;C:\MYPATH2"
$ python -i
Python 2.7.13 (v2.7.13:a06454b1afa1, Dec 17 2016, 20:53:40) [MSC v.1500 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.path
['', 'C:\\MYPATH1', 'C:\\MYPATH2', 'C:\\Windows\\system32\\python27.zip', 'C:\\Python27\\DLLs', 'C:\\Python27\\lib', 'C:\\Python27\\lib\\plat-win', 'C:\\Python27\\lib\\lib-tk', 'C:\\Python27', 'C:\\Python27\\lib\\site-packages', 'C:\\Python27\\lib\\site-packages\\win32', 'C:\\Python27\\lib\\site-packages\\win32\\lib', 'C:\\Python27\\lib\\site-packages\\Pythonwin'] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T10:10:58.967

我不知道您想要的是否直接可行，但是如果您使用的是 linux 文件系统，一种解决方法是创建一个指向“coloned”目录的符号链接并将这个符号链接添加到您的 PYTHONPATH 中，如下所示：

```
ln -s /home/shane/mywebsite.com\:3344 /home/shane/mywebsite.3344
export PYTHONPATH=${PYTHONPATH}:/home/shane/mywebsite.3344 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T10:17:31.930

符号链接黑客可能是唯一可行的选择，除非有一些启发式方法来确定如何处理 PYTHONPATH 中的冒号。

# asp.net-mvc - 如何在没有表单的情况下将未持久的修改对象从视图传递回控制器？

> ID：295200
> 
> 赞同：0
> 
> 时间：2008-11-17T09:49:32.737
> 
> 标签：asp.net-mvc, model-binding

*简短：*模型绑定如何将对象从视图传递到控制器？

*龙：*
首先，根据用户通过搜索表单给出的参数，从数据库中检索到一些对象。这些对象被赋予对客户可见（但不定义）的元数据（例如：对象的命名和定价因地区而异）。
稍后在站点中，用户可以单击应显示这些对象详细信息的链接。因为这些元数据对于显示很重要，但不是定义，所以我需要在控制器中取回之前更改的对象。当我使用默认的 asp.net mvc 模型绑定时，使用了 .ToString() 方法。这当然不会返回用于重新创建完整对象的相关字符串。
我本以为会涉及 ISerializable 接口，但事实并非如此。我应该如何去获得预期的效果？我无法想象我是第一个面临这个问题的人，所以我想我在某个地方遗漏了一些东西......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T12:35:42.230

默认模型绑定按名称获取表单参数，并将它们与参数列表中指定的类型的属性匹配。例如，您的模型具有属性“价格”和“名称”，那么表单需要包含带有 ids/名称“价格”和“名称”的输入（我怀疑它不区分大小写匹配）。绑定器使用反射将与这些键关联的表单值转换为适当的类型，并将其分配给参数指定类型的新创建对象的属性（再次通过反射派生）。

您实际上可以在[http://www.codeplex.com/aspnet](http://www.codeplex.com/aspnet)查看（并下载）源代码，尽管您必须从那里深入了解 MVC 源代码。我会提供一个指向 DefaultModelBinder 源的链接，但是它们的构造方式，我相信链接会随着修订的引入而改变。

因此，要回答您的问题，您需要在表单上包含与您要重新创建的对象的属性相对应的参数（可以隐藏）。当您将表单（在视图中）发布到控制器时，活页夹应使用表单参数重构指定类型的对象。如果您需要将表单参数中的值转换为对象属性，您可能需要实现自己的自定义模型绑定器。

[编辑] 回应您的第二篇文章：

假设我们想要一个链接返回到使用自定义对象的操作。我们可以使用特定的键将自定义对象存储在 TempData（或 Session，如果我们需要它通过多个回发持续更长时间）。然后我们可以构造动作链接并将对象的键作为值提供给匿名类中的 ActionLink。这会将密钥作为请求参数传回。在我们的操作中，我们可以使用此参数中的键从 TempData 中检索对象。

```
<%= Html.ActionLink( ViewData["CustomObject1",
                     "Select",
                     new { TempDataKey = ViewData["CustomObject1_Key"] }
                   ) %>
&nbsp;

public ActionResult Select()
{
    Entity custObj = null;
    string objKey = Request.Params["TempDataKey"];
    if (!string.IsNullOrEmpty(objKey))
    {
       custObj = (Entity)TempData[objKey];
    }

    ... continue processing
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T14:44:11.567

@tvanfosson

感谢您的解释，但是链接呢？（不涉及表单）目前 Html.ActionLink(c=>c.Action(parameter), "label") 将对象作为参数。这些必须被翻译成 URL 部分。为此，MVC 总是使用 .ToString() 方法。我不想在 ToString 方法中序列化我的对象。
我不应该能够以某种方式帮助框架序列化我的对象吗？说通过ISerialize接口什么的？

# vim - Vim 回流段落添加了不需要的缩进

> ID：295201
> 
> 赞同：3
> 
> 时间：2008-11-17T09:49:48.413
> 
> 标签：vim

当我使用 `gqap' 命令在 vim 中重排段落时，vim 似乎尝试变得聪明并自动添加缩进，例如

*   当一行以 ',' 结尾时：

```
我们通过两个步骤保护您的权利：(1) 软件版权，以及 (2)，
   向您提供此许可证，授予您复制、分发的合法许可
   和/或修改软件。

```

*   当一行有不匹配的括号时：

```
程序或其中的一部分，逐字或经过修改和/或
翻译成另一种语言。（以下不包括翻译
        “修改”一词的限制。）每个被许可人都被称为
“你”。

```

有没有办法关闭它？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T09:58:42.173

你用什么文件类型做这个？':set' 的输出是什么？

如果您将文本复制到一个空文件，它会按照您想要的方式对其进行格式化。我启用了 smartindent 和 autoindent，所以你可以试试。（设置 si，设置 ai）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T10:08:15.133

我注意到我设置了 cindent ..取消设置，而是设置 smartindent 和 autoindent ，它现在可以工作了。谢谢！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-08T11:30:40.803

我也遇到了这个问题，但与其他答案不同，它发生在没有 cindent 集的 .txt 文件中。但是，我注意到设置了 smartindent **，**禁用它可以解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-03T16:40:16.500

我有同样的问题。我查看了这样的设置：

：放

我没有设置 cindent，但我确实有 smartindent。因此，基于上述：

:set nosmartindent

然后修复了最后一行（如上所述）上不需要的缩进。

谢谢您的帮助！

# vbscript - 从 vbscript 中执行 caspol

> ID：295209
> 
> 赞同：0
> 
> 时间：2008-11-17T09:59:53.230
> 
> 标签：vbscript, wsh, caspol

我想从 msi（设置项目）中自定义操作内的脚本中调用 caspol。与 ClickOnce 相比，我更喜欢标准 msi，因为使用标准 msi 我可以安装驱动程序并将文件类型与我们的应用程序相关联，而使用 ClickOnce 我不能。

当我从命令行执行 caspol 命令时，它会成功，但在 vbscript 中，它总是会失败，并出现错误“Fehler：Unbekannte Mitgliedschaftsbedingung - -url ..” - 翻译为“错误：未知的成员资格条件：-url”。进一步澄清：作为本地管理员，作为工作组的一部分，生成的命令的复制和粘贴直接在原始虚拟机的本地驱动器上的命令行上正常工作。

我有两个想法： 1\. 我不是 vbscript 之王，所以也许我错过了引号或犯了其他类型的语法错误。2\. Caspol 识别出我正在从脚本中运行它，并因故意的无意义错误而停止。

就个人而言，我相信这只是一个愚蠢的语法错误。

这是我的脚本：

```
set sh = CreateObject("Wscript.Shell")
Set fso = CreateObject("Scripting.FileSystemObject")

dim command
dim location
dim retVal

location = fso.GetFile(Wscript.ScriptFullName).ParentFolder

'%windir%\microsoft.net\framework\v2.0.50727\caspol.exe -pp off -m -addgroup 1 –url file://COMPUTER/SHARE/* FullTrust -name sbw2
command = fso.GetSpecialFolder(0) & "\microsoft.net\framework\v2.0.50727\caspol.exe -pp off -m -ag 1 –url file://"
for each s in Split(location, "\")
        if Len(s) > 0 then
                command = command & s & "/"
        end if
next
command = command & "* FullTrust -name sbw2"

'DEBUG
'command = fso.GetSpecialFolder(0) & "\microsoft.net\framework\v2.0.50727\caspol.exe -m -ag 1 –url file://mjlaptop/sbw2/* FullTrust"
Wscript.StdOut.WriteLine VbClrf
Wscript.StdOut.WriteLine command
Wscript.StdOut.WriteLine VbClrf

Set output = sh.Exec(command)

dim text
while Not output.StdOut.AtEndOfStream
        text = text & output.StdOut.Read(1)
Wend
Wscript.StdOut.WriteLine text 
```

提前致谢，

马特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T10:24:19.873

不，不是这样。即使在所有字符串连接的末尾使用 command = command & """" 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T15:04:27.330

将您的答案复制并粘贴到我的代码中：

```
"C:\WINDOWS\microsoft.net\framework\v2.0.50727\caspol.exe -pp off -m -ag 1 -url "file://mjlaptop/sbw2/*" FullTrust -name sbw2

\\mjlaptop\sbw2\setpolicy.vbs(32, 1) WshShell.Exec: Das System kann die angegebene Datei nicht finden. 
```

它缺少一个报价。现在，添加一个右引号，正如我猜你的意图：

```
"C:\WINDOWS\microsoft.net\framework\v2.0.50727\caspol.exe" -pp off -m -ag 1 -url "file://mjlaptop/sbw2/*" FullTrust -name sbw2

Microsoft (R) .NET Framework CasPol 2.0.50727.42
Copyright (c) Microsoft Corporation. Alle Rechte vorbehalten.

Fehler: Unbekannte Mitgliedschaftsbedingung - -url.. 
```

这是我原帖中给出的错误。你是对的：命令是有效的。该命令有效不是问题。我可以将血腥的回声复制并粘贴到命令窗口中，它会成功执行。我可以在其中添加任意数量的引号，但我认为它仍然会抱怨“未知的会员条件”。

我会尽量在评论中回复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:35:20.637

由于某种原因，将命令中 url 的 url 格式更改为 \\mjlaptop\sbw2*，格式为“file://...”将不起作用。带或不带引号。

这个 uid (yossarian) 也属于我 (Matt Jacobsen)。我不得不使用上述内容，因为 claimid 已停止维护。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-21T22:28:29.820

"C:\WINDOWS\microsoft.net\framework\v\caspol" -pp off -m -ag 1 -url "file://mjlaptop/sbw2/*" FullTrust -name sbw2

Microsoft (R) .NET Framework CasPol 2.0.50727.42 版权所有 (c) Microsoft Corporation。Alle Rechte vorbehalten。

Fehler: Unbekannte Mitgliedschaftsbedingung - -url..

使用 v 而不是整个文件名允许代码在每个版本文件夹中搜索 caspol。

# jquery - 如何使用 jQuery 实现批量上传相同的文件？

> ID：295210
> 
> 赞同：0
> 
> 时间：2008-11-17T10:02:01.980
> 
> 标签：jquery

在同一批次中上传一些图像/音频/视频文件时，我希望在一个字段中选择的文件不应该在其他按钮中被接受。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T01:55:37.387

我想你是在问如何做到这一点，所以文件上传框列表中没有两个文件是相同的，所以你不会意外上传同一个文件两次。

这可以使用 input.onchange 事件轻松完成。添加新文件输入框时，将其 onchange 事件分配给如下函数：

```
function fileChanged()
{
        $(createFileInput()).insertAfter(this).wrap('<p>' + '</p>').change(fileChanged);

        if(!isFileUnique(this))
        {
            $(this).remove();

            alert('You already chose to upload this file.\nPlease choose a different file.');

            return false;
        }

        return true;
} 
```

使用一些辅助函数：

```
function isFileUnique(input) {
    if(input.value == '')
        return true;

    var fileInputs = $(input).parents('form').find('input:file');

    var sameInputs = $.grep(fileInputs, function(item, index) {
        if(item == input)
            return false;

        if(item.value == input.value)
            return true;

        return false;
    });

    return sameInputs.length == 0;
}

function createFileInput() {
    var input = document.createElement('input');

    input.type = 'file';

    return input;
} 
```

事情有点复杂，因为你不能只做一个“this.value = '';” 所以我们只需删除“this”并创建一个新的输入字段。无论如何，我们都需要创建一个新文件（这样用户可以上传一个额外的文件），所以这个问题被抵消了。

（不需要 fileChanged 的​​返回值，因为我认为文件输入不会允许 Javascript 忽略更改命令。）

# windows - 离开全屏远程桌面会话的键盘快捷键

> ID：295211
> 
> 赞同：21
> 
> 时间：2008-11-17T10:02:50.027
> 
> 标签：windows, keyboard-shortcuts, remote-desktop

全屏使用远程桌面，移动到另一个应用程序的最短方法是什么？（当然不使用鼠标。我讨厌老鼠）。

我目前使用以下之一：

`ctrl`- `alt`- `del`，`alt`- `t`（进入本地机器的 taskmgr），`alt`- `tab`（移动到所需的应用程序），或： `ctrl`- `alt`- `pause`（将远程桌面切换到窗口），`alt`- `tab`。

有没有更短的方法？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-17T12:17:01.067

`CTRL`- `ALT`- `PAUSE`，那么你可以使用`ALT`- `TAB`。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-10-21T15:12:19.800

按照上面 Berzerk 的建议设置`Alt`-`Tab`始终在本地计算机上运行。然后使用`Alt`-`PageUp`在远程计算机中 - 它的工作方式类似于`Alt`-`Tab`在 RDP 会话中。

# javascript - 我的 Facebook 应用程序的 Javascript 在 Google Chrome 中不起作用

> ID：295216
> 
> 赞同：4
> 
> 时间：2008-11-17T10:03:59.510
> 
> 标签：javascript, facebook, google-chrome

我的 Facebook 应用程序包含在 Firefox 和 IE 中工作的 Javascript，但在 Chrome 中中止。

在 Javascript 控制台中，它给出了几个错误。包括：

```
Uncaught TypeError: Object onloadhooks has no method 'replace' 
```

有类似的错误抱怨“toLowerCase”缺少方法。

**停止按下**问题不再发生。Chrome 似乎已经修复了该错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T10:04:37.933

根据 Chrome 开发人员（[第 1717 期](http://code.google.com/p/chromium/issues/detail?id=1717)）的说法，这是 Facebook FBJS 库的问题，他们计划升级到 Facebook。

在此期间，我没有解决方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T10:25:19.980

Facebook 本身在 Chrome 中存在问题。在某些页面上，按钮不起作用（例如删除您自己页面上的新闻条目）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-25T11:05:13.897

我总是对谷歌浏览器中的 java 有任何问题。很烂，因为我实际上喜欢浏览器。

双你开球效果

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-03T07:52:58.573

那么，像“flixter movies”这样的 facebook 应用程序为什么能够显示 FBJS 的扩展权限对话框，以便将其发布到用户和朋友的墙上。？

# c# - C# 和 Java 之间的主要区别是什么？

> ID：295224
> 
> 赞同：209
> 
> 时间：2008-11-17T10:07:23.700
> 
> 标签：c#, .net, clr, java

我只想澄清一件事。这不是哪个更好的问题，这部分我留给其他人讨论。我不在乎。我在工作面试中被问到这个问题，我认为多学一点可能会有用。

这些是我能想到的：

*   Java 是“平台无关的”。现在你可以说有[Mono](http://en.wikipedia.org/wiki/Mono_%28software%29)项目，所以 C# 也可以考虑，但我认为这有点夸张。为什么？好吧，当 Java 的新版本完成时，它可以同时在它支持的所有平台上使用，另一方面，在 Mono 实现中仍然缺少 C# 3.0 的多少功能？或者我们真的应该在这里比较[CLR](http://en.wikipedia.org/wiki/Common_Language_Runtime)与[JRE](http://en.wikipedia.org/wiki/JRE)吗？
*   Java 不支持事件和委托。据我所知。
*   在 Java 中，所有方法都是虚拟的
*   开发工具：我相信还没有像 Visual Studio 这样的工具。特别是如果您使用过团队版本，您就会明白我的意思。

请添加您认为相关的其他人。

更新：我突然想到，Java 没有类、方法等的自定义属性。或者是吗？

* * *

## 回答 #1

> 赞同：329
> 
> 时间：2008-11-17T10:16:58.687

**比较 Java 7 和 C# 3**

（此处未提及 Java 7 的某些特性，但`using`已删除所有 C# 版本优于 Java 1-6 的声明优势。）

并非所有摘要都是正确的：

*   *在 Java 中，方法默认*是虚拟的，但您可以将它们设为最终方法。（在 C# 中，默认情况下它们是密封的，但您可以将它们设为虚拟。）
*   有很多 Java IDE，包括免费的（例如 Eclipse、Netbeans）和商业的（例如 IntelliJ IDEA）

除此之外（以及您的摘要中已经包含的内容）：

*   两者之间的泛型完全不同；Java 泛型只是一种编译时“技巧”（但在这方面很有用）。在 C# 和 .NET 中，泛型也在执行时维护，并且适用于值类型和引用类型，保持适当的效率（例如，`List<byte>`作为`byte[]`支持它的 a，而不是盒装字节数组。）
*   C# 没有检查异常
*   Java 不允许创建用户定义的值类型
*   Java 没有运算符和转换重载
*   Java 没有用于简单实现迭代器的迭代器块
*   Java没有像LINQ这样的东西
*   部分由于没有委托，Java 没有任何类似匿名方法和 lambda 表达式的东西。匿名内部类通常扮演这些角色，但笨拙。
*   Java 没有表达式树
*   C# 没有匿名内部类
*   C# 根本没有 Java 的内部类，事实上 - C# 中的所有嵌套类都类似于 Java 的静态嵌套类
*   Java 没有静态类（没有*任何*实例构造函数，不能用于变量、参数等）
*   Java 没有任何等效于 C# 3.0 匿名类型
*   Java 没有隐式类型的局部变量
*   Java 没有扩展方法
*   Java 没有对象和集合初始化表达式
*   访问修饰符有些不同——在 Java 中（目前）没有直接等效的程序集，因此不知道“内部”可见性；在 C# 中，没有等效于 Java 中的“默认”可见性，它考虑了命名空间（和继承）
*   Java 和 C# 中的初始化顺序略有不同（C# 在链式调用基类型的构造函数之前执行变量初始化程序）
*   Java 没有属性作为语言的一部分。它们是 get/set/is 方法的约定
*   Java 没有相当于“不安全”的代码
*   C#（和一般的 .NET）中的互操作比 Java 的 JNI 更容易
*   Java 和 C# 对枚举有一些不同的想法。Java 更加面向对象。
*   Java 没有预处理器指令（C# 中的#define、#if 等）。
*   Java 没有 C# 的等价物，并且无法`ref`通过`out`引用传递参数
*   Java 没有等价的部分类型
*   C# 接口不能声明字段
*   Java 没有无符号整数类型
*   Java 没有对十进制类型的*语言*支持。（java.math.BigDecimal 提供*类似*System.Decimal 的东西 - 有区别 - 但没有语言支持）
*   Java 没有可空值类型的等价物
*   Java 中的装箱使用预定义的（但“正常的”）引用类型以及对它们的特定操作。C# 和 .NET 中的装箱是一件更透明的事情，CLR 为任何值类型的装箱创建了一个引用类型。

这并不详尽，但它涵盖了我能想到的一切。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-17T10:55:11.153

以下是 Dare Obasanjo 关于 C# 和 Java 之间差异的深入参考。在两者之间切换时，我总是发现自己指的是这篇文章。

[http://www.25hoursaday.com/CsharpVsJava.html](http://www.25hoursaday.com/CsharpVsJava.html)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-17T13:56:23.520

C# 具有非常方便的自动属性，它们还有助于保持代码更简洁，至少当您的 getter 和 setter 中没有自定义逻辑时。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-01-04T16:01:13.337

C# Absent in Java 的特性 • C# 包括更多的原始类型和捕获算术异常的功能。

• 包括大量优于 Java 的符号便利，其中许多，例如运算符重载和用户定义的强制转换，已经为大型 C++ 程序员社区所熟悉。

• 事件处理是“一等公民”——它是语言本身的一部分。

• 允许定义类似于类但可以在堆栈上分配的“结构”（与C# 和Java 中的类实例不同）。

• C# 将属性实现为语言语法的一部分。

• C# 允许switch 语句对字符串进行操作。

• C# 允许匿名方法提供闭包功能。

• C# 允许通过函数式yield 关键字使用协同例程的迭代器。

• C# 支持输出参数，有助于返回多个值，这是 C++ 和 SQL 共享的功能。

• C# 具有命名空间别名的能力。

• C# 具有“显式成员实现”，它允许类专门实现接口的方法，与它自己的类方法分开。这也允许它实现两个不同的接口，它们恰好有一个同名的方法。接口的方法不需要公开；它们只能通过该接口访问。

• C# 提供与COM 的集成。

• 按照 C 和 C++ 的示例，C# 允许通过引用调用原始类型和引用类型。

C#中没有Java的特点

• Java 的 strictfp 关键字保证浮点运算的结果在不同平台上保持不变。

• Java 支持检查异常以更好地执行错误捕获和处理。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-20T13:40:52.300

另一个很好的资源是[http://www.javacamp.org/javavscsharp/](http://www.javacamp.org/javavscsharp/) 该站点列举了许多示例，说明了这两种编程语言之间的几乎所有差异。

关于属性，Java 有注释，其工作方式几乎相同。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-17T10:14:43.403

泛型：

使用 Java 泛型，您实际上不会获得使用 .NET 获得的任何执行效率，因为当您在 Java 中编译泛型类时，编译器会去掉类型参数并在任何地方替换 Object。例如，如果你有一个`Foo<T>`类，java 编译器会生成字节码，就好像它是`Foo<Object>`. 这意味着必须在“背景”中进行铸造以及装箱/拆箱。

我已经使用 Java/C# 有一段时间了，在我看来，正如您所指出的，在语言级别上的主要区别是委托。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-02T08:40:35.070

请通过下面给出的链接 msdn.microsoft.com/en-us/library/ms836794.aspx 它涵盖了 C# 和 java 之间的相似之处和不同之处

# jsp - 必须使用 在 Sun App Server 8.2 中？

> ID：295227
> 
> 赞同：1
> 
> 时间：2008-11-17T10:09:02.387
> 
> 标签：jsp, jstl, sunone

我在 JSP 中使用`${...}`而不是；`<c:out value="${...}"/>`在tomcat 6.0.10中，可以解析成功。但是在 SunOne Application Server 8.2 中，它不支持这种用法

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T00:12:01.603

JSP 2.0 引入了裸 EL 表达式 without `c:out`，因此它应该可以工作，因为“Application Server 8.2 符合 JSP 2.0 规范”（[来源](http://docs.sun.com/app/docs/doc/819-4725/6n6rv9ssk?a=view)）。或许问题在于所讨论的 JSP 页面指定了 1.1 版。

# sql - MSSQL2000如何进行SQL查询“你比XX%的其他用户好”

> ID：295232
> 
> 赞同：3
> 
> 时间：2008-11-17T10:10:29.373
> 
> 标签：sql, sql-server

我有一张大表，上面有这样的分数列表，每个用户一个分数：

```
user,score
------
 matt,10
 john,20 
 bill,30 
```

我想做一个回答问题的查询：“约翰，你比其他人的 xx% 快”

如何以最佳性能对 Microsoft SQLServer 2000 进行此类查询。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T10:42:30.353

我没有 MSSQL 2k，但这适用于 2005 年，并且在分数和用户中都有适当的索引应该表现得相当好。

```
SELECT (count(*)/(SELECT cast(count(*) as float) FROM users))*100 FROM users
WHERE score < (SELECT score FROM users WHERE user = 'john') 
```

# apache-flex - 公有/私有在 actionscript 函数中有哪些限制？

> ID：295234
> 
> 赞同：1
> 
> 时间：2008-11-17T10:11:14.033
> 
> 标签：apache-flex, actionscript-3

我目前正在维护一些弹性代码，并注意到很多函数声明如下：

```
private function exampleFunc():void {
    ....
} 
```

这些函数在*全局范围内*，不属于任何特定类，所以我有点不清楚将它们声明为私有会有什么影响。“私人”限定符对这样的功能有什么限制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T13:37:28.020

您的 mxmlc 代码中包含的 actionscript 函数将作为 mxmlc 组件的一部分提供，该组件在幕后被编译成一个类。因此，将它们标记为私有会使它们无法访问。

这是一个说明问题的示例，假设您有以下组件，我们将其称为 FooBox：

```
 <!-- FooBox.mxml -->
<mx:Box xmlns:mx="http://www.macromedia.com/2003/mxml">
    <mx:Script><![CDATA[
        private function foo():void {
            lbl.text = "foo";
        }
        public function bar():void {
            lbl.text = "bar";
        }
    ]]></mx:Sctipt>
    <mx:Label id="lbl">
</mx:Box> 

```

我现在可以将 FooBox 添加到我的应用程序中，并使用它的功能：

```
 <mx:Application
 xmlns:mx="http://www.macromedia.com/2003/mxml"
 xmlns:cc="controls.*"
>
     <mx:Script><![CDATA[
       private function init():void {
            fbox.foo(); // opps, this function is unaccessible.
            fbox.bar(); // this is ok...
       }
    ]]></mx:Sctipt>
    <cc:FooBox id="fbox" />
</mx:Application> 

```

如果 actionscript 函数包含在您的主应用程序文件中，我*认为*您可以通过 Application.application 对象从子控件调用这些函数，例如：

```
 Application.application.bar(); 

```

如果 bar 函数被放置在主 mxmlc 代码中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T13:05:44.057

全局范围是什么意思？这些函数是否在主 MXML 文件中声明？

一般来说，私有意味着函数只能从声明它们的类中调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T09:49:48.693

但是，当你把它放在一个动作脚本文件中时，它是否仍然被编译成一个类？

因为 asdoc 不喜欢它。

# c# - 当 c# 中的日期时间更改时收到通知

> ID：295235
> 
> 赞同：4
> 
> 时间：2008-11-17T10:11:27.997
> 
> 标签：c#, events, datetime, systemevent

最近我正在尝试制作一个日历应用程序，它将向用户显示当前的年月日。问题是，如果用户要让我的应用程序在第二天继续运行，我如何得到通知？如何更改显示的日期？我不想轮询当前日期来更新它。这在 c# 中是否可能。

注意：我尝试了**SystemEvent.TimeChanged**事件，但只有当用户从控制面板手动更改时间/日期时它才有效。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T10:22:29.613

@OddThinking 的答案将起作用（您可以为间隔设置一个计时器而不是睡眠）。另一种方法是设置一个间隔为 1 分钟的计时器，然后简单地检查系统日期是否已更改。由于您每分钟只执行一次轻量级代码，我怀疑开销会很明显。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-11-04T14:11:59.693

```
public void Main()
{

    var T = new System.Timers.Timer();

    T.Elapsed += CallBackFunction;

    var D = (DateTime.Today.AddDays(1).Date - DateTime.Now);

    T.Interval = D.TotalMilliseconds;

    T.Start();

}

private void CallBackFunction(object sender, System.Timers.ElapsedEventArgs e)
{

    (sender as System.Timers.Timer).Interval = (DateTime.Today.AddDays(1).Date - DateTime.Now).TotalMilliseconds;

} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-17T10:15:53.260

你能简单地计算出直到午夜的秒数，然后睡那么久吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T10:18:14.630

尝试查看监视 WMI 事件，您应该能够创建一个 Wql 事件查询来监视星期几的变化（即 ManagementEventWatcher 等），然后设置一个在事件到达时触发的事件处理程序。

```
使用系统；
使用 System.Management；

课堂节目
{
    公共静态无效 Main()
    {
        WqlEventQuery q = 新 WqlEventQuery();
        q.EventClassName = "__InstanceModificationEvent";
        q.Condition = @"TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 22 AND TargetInstance.Minute = 7 AND TargetInstance.Second = 59";

        Console.WriteLine(q.QueryString);

        使用 (ManagementEventWatcher w = new ManagementEventWatcher(q))
        {
            w.EventArrived += new EventArrivedEventHandler(TimeEventArrived);
            w.Start();
            Console.ReadLine(); // 阻塞这个线程仅用于测试目的....
            w.停止（）；
        }
    }

    静态无效 TimeEventArrived（对象发送者，EventArrivedEventArgs e）
    {
        Console.WriteLine("这是你的警钟");
        Console.WriteLine("{0}", new
        DateTime((long)(ulong)e.NewEvent.Properties["TIME_CREATED"].Value));
    }
}

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T11:00:37.010

一个检查日期变化的线程怎么样。线程可以有一些需要此信息的控件可以订阅的事件。

# c# - “页面”之后的客户端渲染问题。来电

> ID：295251
> 
> 赞同：0
> 
> 时间：2008-11-17T10:18:05.597
> 
> 标签：c#, asp.net, postback, cross-posting

我试过，'PreviousPage'，'PreviousPage.IsCrossPagePostBack''Page.previousPage'，page.title

它会导致客户端在此行之后停止呈现页面。

简单的例子

```
protected void Page_Load(object sender, EventArgs e)
{
response.write("I can see this");
string test = PreviousPage.IsCrossPagePostBack.toString(); //Any page call Causes client rendering to freeze
response.write("But i cant see this");   
System.Windows.Forms.MessageBox.Show("However i can see this,proving that the server is still running the code");   
} 
```

有人请，有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T11:29:37.123

回答

好吧，它最终是愚蠢的。代码气味结束。

我用来触发 PostBack 的按钮有一个触发重定向的处理程序，我刚刚删除了处理程序，保留了 PostBackUrl 设置和魔法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T10:19:42.643

您是否检查过 PreviousPage 是否为空？

来自[msdn](http://msdn.microsoft.com/en-us/library/system.web.ui.page.previouspage.aspx)：

> 当用户直接从服务器请求该页面时，PreviousPage 属性是一个空引用（在 Visual Basic 中为 Nothing）。

另外 -`MessageBox`以网络形式，*不是*一个好主意......也许使用内置的[trace.axd](http://msdn.microsoft.com/en-us/library/bb386420.aspx)

# c# - 如何实现可取消事件？

> ID：295254
> 
> 赞同：9
> 
> 时间：2008-11-17T10:20:27.807
> 
> 标签：c#, events

在 System.ComponentModel 中，有一个名为 CancelEventArgs 的类，其中包含一个可以在事件侦听器中设置的 Cancel 成员。MSDN 上的文档解释了如何使用它从侦听器中取消事件，但是如何使用它来实现我自己的可取消事件？有没有办法在每个侦听器触发后检查 Cancel 成员，还是我必须等到事件触发所有侦听器之后？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-17T10:25:32.603

要依次检查每个侦听器，您需要通过 GetInvocationList 手动获取处理程序：

```
class Foo
{
    public event CancelEventHandler Bar;

    protected void OnBar()
    {
        bool cancel = false;
        CancelEventHandler handler = Bar;
        if (handler != null)
        {
            CancelEventArgs args = new CancelEventArgs(cancel);
            foreach (CancelEventHandler tmp in handler.GetInvocationList())
            {
                tmp(this, args);
                if (args.Cancel)
                {
                    cancel = true;
                    break;
                }
            }
        }
        if(!cancel) { /* ... */ }
    }
} 
```

# c# - 如何在注册表项中搜索特定值

> ID：295257
> 
> 赞同：10
> 
> 时间：2008-11-17T10:22:47.693
> 
> 标签：c#, registry

如何在注册表项中搜索特定值？

例如我想搜索 XXX in

```
HKEY_CLASSES_ROOT\Installer\Products 
```

C# 中的任何代码示例将不胜感激，

谢谢

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-17T14:59:11.910

如果您不想依赖 LogParser（尽管它很强大）：我会看看这个`Microsoft.Win32.RegistryKey`类（[MSDN](http://msdn.microsoft.com/en-us/library/microsoft.win32.registrykey(VS.80).aspx)）。使用`OpenSubKey`打开 HKEY_CLASSES_ROOT\Installer\Products，然后调用`GetSubKeyNames`，好吧，获取子项的名称。

依次打开其中的每一个，调用`GetValue`您感兴趣的值（我猜是 ProductName）并将结果与​​您正在寻找的结果进行比较。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-17T10:26:33.193

[在这里](http://bytes.com/forum/thread279622.html)帮忙...

微软有一个很棒的（但不是众所周知的）工具——叫做[LogParser](https://www.microsoft.com/en-us/download/details.aspx?id=24659)

它使用 SQL 引擎来查询所有类型的基于文本的数据，如注册表、文件系统、事件日志、AD 等...要从 C# 中使用，您需要使用以下命令从 Logparser.dll COM 服务器构建一个互操作程序集（调整 LogParser.dll 路径）命令。

```
tlbimp "C:\Program Files\Log Parser 2.2\LogParser.dll"
/out:Interop.MSUtil.dll 
```

以下是一个小示例，说明了如何在 \HKLM\SOFTWARE\Microsoft 树中查询值“VisualStudio”。

```
using System;
using System.Runtime.InteropServices;
using LogQuery = Interop.MSUtil.LogQueryClass;
using RegistryInputFormat = Interop.MSUtil.COMRegistryInputContextClass;
using RegRecordSet = Interop.MSUtil.ILogRecordset;

class Program
{
public static void Main()
{
RegRecordSet rs = null;
try
{
LogQuery qry = new LogQuery();
RegistryInputFormat registryFormat = new RegistryInputFormat();
string query = @"SELECT Path from \HKLM\SOFTWARE\Microsoft where
Value='VisualStudio'";
rs = qry.Execute(query, registryFormat);
for(; !rs.atEnd(); rs.moveNext())
Console.WriteLine(rs.getRecord().toNativeString(","));
}
finally
{
rs.close();
}
}
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-09-23T13:38:33.123

此方法将在指定的注册表项中搜索包含指定值的第一个子项。如果找到键，则返回指定的值。Searchign 只有一级深。如果您需要更深入的搜索，那么我建议修改此代码以利用递归。搜索区分大小写，但如果需要，您可以再次修改它。

```
private string SearchKey(string keyname, string data, string valueToFind, string returnValue)
{
    RegistryKey uninstallKey = Registry.LocalMachine.OpenSubKey(keyname);
    var programs = uninstallKey.GetSubKeyNames();

    foreach (var program in programs)
    {
        RegistryKey subkey = uninstallKey.OpenSubKey(program);
        if (string.Equals(valueToFind, subkey.GetValue(data, string.Empty).ToString(), StringComparison.CurrentCulture))
        {
            return subkey.GetValue(returnValue).ToString();
        }
    }

    return string.Empty;
} 
```

示例用法

```
// This code will find the version of Chrome (32 bit) installed
string version = this.SearchKey("SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall", "DisplayName", "Google Chrome", "DisplayVersion"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-10-11T17:49:44.993

@Caltor 你的解决方案给了我我正在寻找的答案。我欢迎改进或不涉及注册表的完全不同的解决方案。我正在使用已加入 Azure AD 的设备在 Windows 10 上使用企业应用程序。我希望/需要在 UWP 应用中为设备和 HoloLens 2 使用 Windows Hello。我的问题是从 Windows 10 获取 AAD userPrincipal 名称。经过几天搜索和尝试大量代码后，我在 Windows 注册表中搜索了当前用户密钥中的 AAD 帐户并找到了它。通过一些研究，这些信息似乎在一个特定的键中。因为您可以加入多个目录，所以可能有多个条目。我并没有试图解决这个问题，而是使用 AAD 租户 ID 完成的。我只需要 AAD userPrincipal 名称。我的解决方案对返回列表进行去重复，以便我拥有一个唯一的 userPrincipal 名称列表。应用程序用户可能必须选择一个帐户，这对于 HoloLens 来说也是可以容忍的。

```
using Microsoft.Win32;
using System.Collections.Generic;
using System.Linq;

namespace WinReg
{
  public class WinRegistryUserFind
  {
    // Windows 10 apparently places Office/Azure AAD in the registry at this location
    // each login gets a unique key in the registry that ends with the aadrm.com and the values
    // are held in a key named Identities and the value we want is the Email data item.
    const string regKeyPath = "SOFTWARE\\Classes\\Local Settings\\Software\\Microsoft\\MSIPC";
    const string matchOnEnd = "aadrm.com";
    const string matchKey = "Identities";
    const string matchData = "Email";

    public static List<string> GetAADuserFromRegistry()
    {
      var usersFound = new List<string>();
      RegistryKey regKey = Registry.CurrentUser.OpenSubKey(regKeyPath);
      var programs = regKey.GetSubKeyNames();
      foreach (var program in programs)
      {
        RegistryKey subkey = regKey.OpenSubKey(program);
        if(subkey.Name.EndsWith(matchOnEnd))
        {
          var value = (subkey.OpenSubKey(matchKey) != null)? (string)subkey.OpenSubKey(matchKey).GetValue(matchData): string.Empty;
          if (string.IsNullOrEmpty(value)) continue;
          if((from user in usersFound where user == value select user).FirstOrDefault() == null)
            usersFound.Add(value) ;
        }
      }

      return usersFound;
    }
  }
} 
```

# windows - Delphi 中的跨应用程序拖放

> ID：295259
> 
> 赞同：9
> 
> 时间：2008-11-17T10:24:16.550
> 
> 标签：windows, delphi, drag-and-drop, windows-explorer

我想为 Windows XP 创建一个 Delphi 应用程序，它允许删除从 Windows 资源管理器（桌面或文件夹窗口）或其他支持此操作的应用程序（例如 Total Commander）拖动的文件。反之呢？当用户从我的应用程序中拖动图标时，我应该能够将拖动对象的内容设置为自定义数据。

我的目标是创建一个自定义应用程序工具栏，我可以在其上放置应用程序并显示它们的图标或从中拖动应用程序或其他实体。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-17T10:33:12.150

这可以通过[拖放组件套件](http://melander.dk/delphi/dragdrop/)来完成。它也有你想要的例子。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T12:18:06.027

[Raymond Chen](http://blogs.msdn.com/oldnewthing)有一系列关于拖放的精彩文章：

*   [多么拖沓 旧事新事](https://devblogs.microsoft.com/oldnewthing/tag/what-a-drag)
*   [多么拖沓：拖拽一个虚拟文件（HGLOBAL 版）](https://devblogs.microsoft.com/oldnewthing/20080318-00/?p=23083)
*   [多么拖沓：拖拽一个虚拟文件（IStorage 版）](https://devblogs.microsoft.com/oldnewthing/20080320-00/?p=23063)
*   [多么拖沓：拖拽一个虚拟文件（IStream 版）](https://devblogs.microsoft.com/oldnewthing/20080319-00/?p=23073)

当您搜索拖放时，他的博客上还有许多其他好文章。

# sql-server - %book% 的全文目录/索引搜索

> ID：295266
> 
> 赞同：16
> 
> 时间：2008-11-17T10:28:06.917
> 
> 标签：sql-server, sql-server-2005, wildcard, full-text-search

我正试图围绕如何搜索出现在单词/表达式中间的东西——比如搜索“LIKE %book%”——但在 SQL Server (2005) 全文目录中。

我怎样才能做到这一点？**在搜索表达式的开头**几乎看起来两者都支持通配符，`CONTAINS`而且`FREETEXT`真的不支持通配符- 真的可以吗？

 **我原以为`FREETEXT(*, "book")`会发现里面有“书”的任何东西，包括“重新预订”或类似的东西。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-17T10:43:40.710

不幸的是 CONTAINS 只支持前缀通配符：

```
CONTAINS(*, '"book*"') 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-17T10:45:40.813

SQL Server 全文搜索基于将文本标记为单词。单词没有更小的单位，所以你能找到的最小的东西就是单词。

您可以使用[前缀搜索](http://msdn.microsoft.com/en-us/library/ms142492.aspx)来查找以某些字符开头的匹配项，这是可能的，因为单词列表按字母顺序保存，服务器所要做的就是扫描列表以查找匹配项。

要执行您想要的带有`LIKE '%book%'`子句的查询，可能会同样快（或慢）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T10:36:17.573

如果你想做一些严肃的全文搜索，那么我会（并且已经）使用 Lucene.Net。除了基础知识之外，MS SQL 全文搜索似乎从来没有那么好用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-05T20:33:19.580

这是一个解决通配符限制的建议。您创建一个包含相同内容但与您正在搜索的列相反的计算列。

例如，如果您正在搜索名为“ProductTitle”的列，则创建一个名为 ProductsRev 的列。然后将该字段的“计算列规范”值更新为：

（反向（[产品标题]））

在您的搜索中包含“ProductsRev”列，您现在应该能够返回支持在单词开头使用通配符的结果。祝你好运！！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-22T18:59:42.817

全文有一个表格，列出了引擎找到的所有单词。它的行数应该比全文索引表少几个数量级。您可以从该表中选择“where field like '%book%'”来获取所有包含“book”的单词。然后使用该列表编写全文查询。它很麻烦，但它会起作用，而且在速度部门也可以。但是，最终您在执行此操作时使用的是错误的全文。实际上，最好让这些功能请求的来源了解全文在做什么。您希望他们了解它想要做什么，这样他们就可以从全文中获得高价值。例如，仅在单词末尾使用通配符，这意味着考虑有序列表中的单词。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-07T19:21:45.813

为什么不在 C# 中编写程序集来计算所有不重复的后缀。例如，如果您有文本“吃红肉”，则可以将“吃在他的红肉”字段中（请注意，不必再次添加“吃”和“吃”），然后在该字段中使用全文搜索。一个可以很容易地用 Csharp 编写的函数

x）我知道这看起来很奇怪......这是一个工作方法 x）我知道我在插入/更新中增加了开销......只有当这个开销除了搜索功能的改进之外微不足道时才合理 x）我知道那里也是存储数据大小的开销。

但我很有信心会很快

# c++ - 获取一个字节中 4 个最低有效位的最快方法是什么（C++）？

> ID：295279
> 
> 赞同：7
> 
> 时间：2008-11-17T10:39:24.320
> 
> 标签：c++, optimization, operators, bit-shift, modulo

我说的是这个：

如果我们有字母“A”，它是十进制的 77 和十六进制的 4D。我正在寻找获得 D 的最快方法。

我想了两个办法：

给定 x 是一个字节。

1.  `x << 4; x >> 4`

2.  `x %= 16`

还有其他方法吗？哪个更快？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-11-17T11:21:21.180

简洁很好 - 解释更好:)

*   `x &= 0x0f`

> 是，当然，正确的答案。它准确地表达了您想要实现的意图，并且在任何健全的架构上总是会编译到最少的指令数（即 1）。将常量放入按位运算符时，请务必使用十六进制而不是十进制。

*   `x <<= 4; x >>= 4`

> 仅当您的“字节”是正确的无符号类型时才有效。如果它实际上是一个有符号字符，那么第二个操作可能会导致符号扩展（即原始位 3 也会出现在位 4-7 中）。
> 
> 如果不进行优化，这当然需要 2 条指令，但在 OSX 上使用 GCC，甚至`-O1`会减少到第一个答案。

*   `x %= 16`

> 即使没有启用优化器，您的编译器几乎肯定会在这里做正确的事情，并将昂贵的 div/mod 操作变成第一个答案。然而，它只能为 2 的幂次方做到这一点，而且这种范式并没有让你想要实现的目标变得那么明显。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-17T10:43:18.930

我总是用`x &= 0x0f`

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-17T11:53:16.607

有很多好的答案，其中一些在技术上是正确的。

在更广泛的范围内，人们应该理解 C/C++ 不是汇编程序。程序员的工作是尝试告诉编译器你想要实现的意图。编译器将根据体系结构和各种优化标志选择最佳方式。

x &= 0x0F; 是告诉编译器你想要实现什么的最清晰的方法。如果在某些架构上上下移动更快，那么编译器的工作就是了解它并做正确的事情。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-17T10:42:57.963

单AND操作就可以做到。

```
x = (x & 0x0F); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-17T11:20:23.677

它在某种程度上取决于架构——在 ARM 上上下移动可能是最快的方式——但是编译器应该为你做这件事。事实上，所有建议的方法都可能会被编译器优化为相同的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T10:44:52.720

x = x & 15

# gcc - 在 ubuntu gcc 上为 arm 编译 darwin 的步骤

> ID：295285
> 
> 赞同：4
> 
> 时间：2008-11-17T10:42:57.933
> 
> 标签：gcc, ubuntu, arm, cross-compiling, darwin

有没有人有在 ubuntu 上为 arm 编译 gcc 上的 darwin 库的步骤？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T23:43:53.447

有一个[站点](http://ostatic.com/darwin-arm)为和 arm darwin 内核提供补丁。

> Darwin on ARM 为 Apple Darwin-xnu 内核源开发并提供补丁，以便可以交叉编译以在 ARM 处理器上运行。

这个 ubuntu[论坛条目](http://ubuntuforums.org/showthread.php?t=360877)展示了如何安装 arm-linux-gcc 交叉编译器。

把两者放在一起，你应该得到你想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-04-18T01:05:40.133

[https://github.com/tpoechtrager/osxcross](https://github.com/tpoechtrager/osxcross)

逐步安装它，参考[https://enigma-dev.org/docs/wiki/index.php?title=CrossCompileLinuxOSX](https://enigma-dev.org/docs/wiki/index.php?title=CrossCompileLinuxOSX)

# c# - 如何防止提供扩展方法的公共类出现在 Intellisense 中？

> ID：295287
> 
> 赞同：3
> 
> 时间：2008-11-17T10:43:16.747
> 
> 标签：c#, extension-methods, intellisense

有没有办法从 Intellisense 中“隐藏”一个类的名称，其唯一目的是提供扩展方法？

我想从 Intellisense 列表中删除类名，但需要通过 Intellisense 以通常的方式将类的扩展方法提供给外部程序集。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T10:56:22.977

我希望您可以使用 EditorBrowsable 属性来做到这一点：

```
[EditorBrowsable(EditorBrowsableState.Never)]
static class MyExtensions { } 
```

不幸的是，这似乎不起作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T12:02:05.903

好的，我有这个问题的答案。Hallgrim 建议用..标记课程

```
[EditorBrowsable(EditorBrowsableState.Never)] 
```

..确实有效，但仅在引用**程序集**而不是项目的地方起作用，就像我自己的 VS 解决方案在编写提供类的程序集时的情况一样。扩展方法照常可用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T10:45:00.473

您的意思是要隐藏类还是扩展方法？

如果将静态类放在它自己的命名空间中，那么任何不使用 using 指令导入该命名空间的代码都不会“看到”扩展方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T11:08:06.837

如果您将扩展方法放在模块中，则会有一个名为 HideModuleName 的属性，它将隐藏模块名称，使其不显示在 Intellisense 中。

# c# - VS 2008 中使用类型化数据集的编程模式

> ID：295291
> 
> 赞同：1
> 
> 时间：2008-11-17T10:44:50.207
> 
> 标签：c#, sql, visual-studio-2008, .net-2.0, dataset

我目前正在执行以下操作以在 vs2008 中使用类型化数据集：

右键单击“app_code”添加新数据集，将其命名为 tableDS。

打开tableDS，右键，添加“表格适配器”

在向导中，选择一个预定义的连接字符串，“使用 SQL 语句”

select * from tablename and next + next 完成。（我为数据库中的每个表生成一个表适配器）

在我的代码中，当我只需要一个数据时，我会执行以下操作来获取一行数据：

cpcDS.tbl_cpcRow tr = (cpcDS.tbl_cpcRow)(new cpcDSTableAdapters.tbl_cpcTableAdapter()).GetData().Select("cpcID = " + cpcID)[0];

我相信这将从数据库中获取整个表并在 dotnet 中进行过滤（即不是最佳的），有什么办法可以让 tableadapter 来过滤数据库上的结果集（即我想要的是发送选择* 从 tbl_cpc 其中 cpcID = 1 到数据库）

作为旁注，我认为这是从 vs2008 中的数据库获取数据的一种相当不错的设计模式。它的编码、阅读和维护相当容易。但我想知道还有其他更好的设计模式吗？我使用数据集进行读取/更新/插入和删除。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T11:03:08.970

有点转变，但您询问不同的模式 - LINQ 怎么样？由于您使用的是 VS2008，因此（尽管不能保证）您也可以使用 .NET 3.5。

LINQ-to-SQL 数据上下文提供了对数据（过滤等）的更多托管访问。这是一个选项吗？不过，我不确定目前是否会使用“实体框架”（[请参见此处](https://stackoverflow.com/questions/276433/do-you-think-its-advantageous-to-switch-to-entity-framework#276439)）。

根据请求编辑：

要从数据上下文中获取一行，您只需指定“谓词” - 在这种情况下，主键匹配：

```
int id = ... // the primary key we want to look for
using(var ctx = new MydataContext()) {
   SomeType record = ctx.SomeTable.Single(x => x.SomeColumn == id);
   //... etc

   // ctx.SubmitChanges(); // to commit any updates
} 
```

上面使用 Single 是经过深思熟虑的——这种特殊用法 [Single(predicate)] 允许数据上下文充分利用本地内存中的数据——即，如果谓词只是在主键列上，它可能不必如果数据上下文已经看到该记录，请完全触摸数据库。

但是，LINQ 非常灵活。您还可以使用“查询语法” - 例如，稍微不同的（列表）查询：

```
 var myOrders = from row in ctx.Orders
                   where row.CustomerID = id && row.IsActive
                   orderby row.OrderDate
                   select row; 
```

ETC

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T11:17:31.110

使用类型化数据集有两个潜在问题，

一是可测试性。在使用类型化数据集时，设置要在单元测试中使用的对象是一项相当艰巨的工作。

另一个是可维护性。使用类型化的数据集通常是更深层次问题的症状，我猜你所有的业务规则都存在于数据集之外，其中相当一部分将数据集作为输入并基于它们输出一些聚合值。这会导致业务逻辑到处泄漏，虽然在前 6 个月里一切都是虚无缥缈的，但一段时间后它就会开始对你不利。数据集的这种使用基本上是非面向对象的

话虽如此，使用数据集建立一个合理的架构是完全可能的，但这并不是自然而然的。ORM 最初设置起来会比较困难，但它很适合编写可维护和可测试的代码，因此您不必回顾 6 个月后所造成的混乱。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T19:44:53.253

您可以将带有 where 子句的查询添加到您感兴趣的表的 tableadapter。

LINQ 很好，但它实际上只是 OP 已经在做的事情的快捷语法。

除非您的数据模型非常复杂，否则类型化数据集非常有意义。那么编写自己的 ORM 将是最好的选择。我有点困惑，为什么 Andreas 认为类型化的数据集很难维护。关于它们的唯一烦人的事情是，每当更改选择命令时，插入、更新和删除命令都会被删除。

此外，与您自己的 ORM 相比，创建类型化数据集的速度优势让您可以专注于应用程序本身，而不是数据访问代码。

# sql-server - 是否记录 SQL Server 超时？

> ID：295299
> 
> 赞同：16
> 
> 时间：2008-11-17T10:46:12.637
> 
> 标签：sql-server, timeout, error-log

SQL Server 超时（特别是 SELECT 查询）是否记录在 ERRORLOG 文件中？

背景是一位客户，其网站偶尔会出现“请求超时”消息，假设超时是由数据库超时引起的。有问题的 ERRORLOG 中没有超时错误。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-17T10:50:15.203

不可以。您需要使用 SQL Profiler。带有**Lock Timeout**事件和**Deadlock Graph**事件的标准跟踪应该可以做到这一点。

*   [Lock:Timeout 事件类](http://msdn.microsoft.com/en-us/library/ms189107.aspx)

*   [死锁图事件类](http://msdn.microsoft.com/en-us/library/ms177409.aspx)

除了硬件（例如足够的 RAM 和快速驱动器，以及在适当的 RAID 配置上适当放置数据和日志文件）之外，大多数超时都是由于您的工作负载没有足够“好”的索引集引起的。

您是否有定期安排的索引维护计划？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-05-28T09:16:34.220

SQL Server 超时作为**注意事件**从客户端*启动*，并且不会记录在 SQL Server 错误日志中。

 **您可以使用以下方法监控注意事件：

*   [SQL Server 探查器](http://msdn.microsoft.com/en-us/library/ms190979.aspx)
*   DMV [sys.dm_os_ring_buffers](http://www.johnsansom.com/using-sys-dm_os_ring_buffers-troubleshoot-connectivity-issues/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T11:00:26.883

您还可以使用在超时和死锁事件时引发的事件通知。触发后，您可以将其写入表格或给自己发送电子邮件。

我在这里展示了一般技术：

> ## [在不更改现有代码的情况下立即通知死锁](http://weblogs.sqlteam.com/mladenp/archive/2008/07/18/Immediate-deadlock-notifications-without-changing-existing-code.aspx)
> 
> 2008 年 7 月 18 日

这样您就不必运行 Profiler；这会影响性能。

# windows - vbscript 中的 CommonAppData

> ID：295303
> 
> 赞同：7
> 
> 时间：2008-11-17T10:49:39.793
> 
> 标签：windows, winapi, vbscript, windows-shell, special-folders

客户的应用程序“AppName”的配置文件存储在 CommonAppData 中。

*   在 Windows XP 下是`C:\Documents and Settings\All Users\Application Data\AppName`
*   在 Windows Vista 下是`C:\ProgramData\AppName`

如何使用 VBScript 获得正确的文件夹名称？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-17T11:01:40.003

```
Const CommonAppData = &H23&  ' the second & denotes a long integer '

Set objShell  = CreateObject("Shell.Application")
Set objFolder = objShell.Namespace(CommonAppData)

Set objFolderItem = objFolder.Self

MsgBox objFolderItem.Name & ": " & objFolderItem.Path 
```

MSDN 有一个页面，列出了其他[Shell 特殊文件夹常量](http://msdn.microsoft.com/en-us/library/bb774096(VS.85).aspx)。

这个页面也很好：[枚举特殊文件夹](http://www.microsoft.com/technet/scriptcenter/guide/sas_fil_higv.mspx?mfr=true)，Microsoft Windows 2000 脚本指南的一部分。（链接现已失效，但[互联网档案馆仍有副本](https://web.archive.org/web/20090403061459/http://www.microsoft.com/technet/scriptcenter/guide/sas_fil_higv.mspx)。）

# c# - 尝试 File.Move() 时处理打开的文件

> ID：295307
> 
> 赞同：2
> 
> 时间：2008-11-17T10:52:31.050
> 
> 标签：c#, vb.net, file-io

这是在 Windows 服务中处理文件移动的最佳方式吗？我们有许多匹配和移动的文件，但最终用户可能在移动时打开了文件。

这就是代码当前所说的：

```
Do While IO.File.Exists(OriginalFilePath)

    Try
        IO.File.Move(OriginalFilePath, BestMatchPath)
    Catch ex As IO.IOException
        Log(TraceLevel.Warning, "The file '{0}' was unable to be moved (probably opened by someone)", OriginalFilePath)
        Threading.Thread.Sleep(1000)
    End Try

Loop 
```

有没有更好的方法来管理这个？我曾考虑过线程化它以允许该过程继续，但目前我不确定这是否可行，因为该过程的其余部分可能需要文件路径准确。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T11:02:53.540

一个建议：在服务`Start()`方法中，激活一个`System.Timers.Timer`定期运行你的文件移动循环，无需`Sleep(1000)`调用。这样，在当前运行中未移动的文件将不会阻止其他（解锁）文件的移动。有问题的文件将有机会在以后的试验中被移动。调整计时器间隔以满足您的需要。

@Andy 考虑过线程 - a`Timer`是处理线程的有效方法。服务进程是重复执行代码段的适当位置。请注意，没有的循环`Sleep(1000)`不会阻塞。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T13:20:49.643

由于这是一项 Windows 服务，并且根据您尝试同时移动的文件数量，我会考虑为每个文件移动使用​​后台线程。如果您使用 BackgroundWorker 类型，您可以将任何异常编组回主线程，然后等待 X 分钟，然后再次尝试移动文件。

通常我不会提倡多线程解决方案，但在这种情况下，线程之间没有共享状态，因此控制任何线程问题要容易得多。

至于执行依赖于所有文件移动成功的其他任务，您可以加入后台线程，以便您知道它们何时全部完成。

# asp.net-mvc - 使用 SelectList 进行模型绑定

> ID：295313
> 
> 赞同：1
> 
> 时间：2008-11-17T10:57:20.150
> 
> 标签：asp.net-mvc, model-binding, selectlist

我使用 Html.DropDownList(string NameSelectListInViewData) 方法创建了一个 DropDown。这会生成具有正确值的有效 Select 输入。一切都很好。

然而，在提交时，源 SelectList 中的值未绑定。

*案例：* ViewData.SearchBag.FamilyCodes：

```
public SelectList FamilyCodes { get; set; } 
```

生成下拉列表的 Html：

```
<%=Html.DropDownList("SearchBag.FamilyCodes")%> 
```

生成的html：

```
<select id="SearchBag.FamilyCodes" name="SearchBag.FamilyCodes">
    <option value=" ">Any</option>
    <option value="A">BLUE</option>
    <option value="B">BLACK</option>
    <option value="C">BEIGE</option>
    <option value="G">GREEN</option>
    <option value="O">ORANGE</option>
    <option value="P">PURPLE</option>
    <option value="R">RED</option>
    <option value="S">GRAY</option>
    <option value="U">BROWN</option>
    <option value="W">WHITE</option>
    <option value="Y">YELLOW</option>
</select> 
```

在我的控制器中，我有一个带有参数 searchBag 的操作。

```
public ActionResult AdvancedSearch(SearchBag searchBag) { 
    //Do Stuff with parameters in searchBag
    return View("AdvancedSearch", searchViewData);
} 
```

所有其他字段都绑定得很好，只有选择框没有。有任何想法吗？

*更新*
对于未来的读者来说，阅读这篇博文可能是值得的： http: [//haacked.com/archive/0001/01/01/model-binding-to-a-list.aspx](http://haacked.com/archive/0001/01/01/model-binding-to-a-list.aspx)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-02T01:55:46.397

SearchBag 在 html 中需要小写（searchBag 而不是 SearchBag）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T11:35:06.610

虽然“SearchBag.FamilyCodes”是一个有效的 HTML id，但框架会尝试将每个表单项映射到同名的相应参数，并且参数名称中不能有句点。如果为控件分配一个单独的 ID（Html.DropDownList 方法的不同重载），它会通过吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T17:40:09.787

我认为您需要将 FamilyCodes 的类型从 SelectList 更改为字符串。

```
public string FamilyCodes { get; set; } 
```

然后在提交时 FamilyCodes 的值应该是从下拉列表中选择的值。我目前的项目中有几个，没有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-03T09:55:55.100

昨天与选择列表有类似的问题，列表会生成正常，只是在 UpdateModel- 上会失败 =- 未绑定？

我在参数列表中找到了答案......

```
SelectList (
Collection - items to use in the  drop down,
ValueField - ie the primarykey as a String,
NameField  - ie the name of the thing as a String,
SelectedValue -  which is the passed in current objects FK relationship) 
```

所以对我来说...

Country = new SelectList(db.Countries, "pkCountry", "CountryName",address.fkCountry);

我使用 ViewModel 方法 - 并在视图模型的构造函数中使用它......

```
public AddressCountryViewModel(){
public SelectList Countrys {get; private set;}
public AddressCountryViewModel(Address address)
{
     Countrys = new SelectList(db.Countries, "pkCountry", "CountryName",address.fkCountry);
} 
```

然后我抓取控制器**编辑操作**中的值并分配回正在更新的对象......

```
address.fkCountry = Convert.ToInt32(collection["fkCountry"]); 
```

# eclipse - Eclipse 3.4 ant 任务挂起

> ID：295314
> 
> 赞同：3
> 
> 时间：2008-11-17T10:58:23.237
> 
> 标签：eclipse, ant, build-process, build, obfuscation

当我从 Eclipse 3.4.x 启动一个 ant 脚本时，它会将输出打印到控制台，直到某个阶段。之后它经常挂起（永远等待）。我在屏幕（控制台）上看到的最后几行 - 我的混淆器的部分输出。

在 Eclipse 3.3.2 下一切正常（相同的项目、工作区、设置、JVM 等）。

有人有同样的问题吗？任何想法如何解决它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-05T09:13:19.887

我也可以在 Eclipse 3.6 和 Ant 1.7.1 中看到这种现象。在我的情况下，我必须将外部工具配置（菜单运行->外部工具）中的 JRE 设置为“在与工作区相同的 JRE 中运行”，然后它就可以正常工作了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-11T07:22:17.940

我正在使用 Eclipse 3.4.2 并且 ant 任务挂起，ant 输出仅在一定程度上进入控制台，之后没有任何工作。

我查看了控制台的最后一行，发现了一些与 UTF-8 相关的问题。

这是消息（警告：用于编码 UTF8 的不可映射字符）。

转到外部工具。选择 ant 任务，点击“Common Tab”，将编码从默认（UTF-8）更改为 ISO-8859-1。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T09:07:07.813

您是否限制了控制台可以分配的内存？菜单“窗口”-> 首选项-> 运行/调试-> 控制台。

选择“限制控制台输出”将“控制台缓冲区大小（字符）”设置为 200000。

您看到的效果可能与垃圾收集有关：控制台使用了过多的 RAM，并且 GC 开始占用所有可用的 CPU 周期进行清理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:41:38.180

我们有一个类似的问题，我们无法通过升级到最新的 Eclipse 版本来解决这个问题。一段时间后，我们发现这是由向控制台写入特殊字符（德语变音符号ü）的任务引起的。将字符更改为“ue”后，一切正常。

我想那个角色以某种方式杀死了 Eclipse 中的“从蚂蚁获取角色并将它们写入控制台”线程。蚂蚁继续往通讯管道里写字符，终于填满了，永远阻塞了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T11:22:24.437

一个可能的原因是您[的内存不足](http://dev.eclipse.org/newslists/news.eclipse.tools.jdt/msg03414.html)

还尝试使用该`-diagnostics`选项运行 ant。

您可以检查您的[内存使用情况](https://stackoverflow.com/questions/94331/eclipse-memory-use#101193)和您的[eclipse.ini](https://stackoverflow.com/questions/142357/what-are-the-best-eclipse-34-jvm-settings#144349)。

另一个典型的罪魁祸首是**阻止对锁定资源**的访问（例如对已被另一个进程使用的文件的访问）：尝试关闭许多可以关闭的应用程序并重新启动 ant。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T14:59:12.503

您是否在 Eclipse 3.4 发行说明中查看了[Ant 的已知问题？](http://www.eclipse.org/eclipse/development/readme_eclipse_3.4.html#I-Platform-Ant)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T18:08:00.873

您可以使用 Eclipse 的调试器运行 ant 构建，这可能有助于找出问题所在。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-05T09:41:24.603

那件事不久前发生在我身上。我需要清除所有与 Ant 相关的外部工具配置（菜单运行->外部工具），将默认 JRE 设置为 1.6 并重新启动 Eclipse。然后我的任务奏效了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-11T22:15:02.680

看起来 Eclipse 3.4.x 中的 ant 实现部分损坏（与 Eclipse 3.4 和 3.4.1 相关）。几天前在 Ant 任务（dbunit）中遇到了 OOM。如果没有 Eclipse，ant 任务可以正常工作（测试 bot ant 1.6.5 和 1.7.0）。

希望 3.5 和 3.4.2 解决 ant 实现的不可预测的行为。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T14:04:06.840

看起来大多数 ant 问题都在 Eclipse 3.4.2 下得到了解决

# jquery - 尝试在 jQuery 中显示一个 DIV

> ID：295315
> 
> 赞同：0
> 
> 时间：2008-11-17T10:59:03.783
> 
> 标签：jquery

我有这个java代码：

```
<script src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("jquery", "1.2.6");

$("a#more").click(function() {

$("#info_box").show("blind", { direction: "vertical" }, 800);

});
</script> 
```

这个链接：

```
<a href="#" id="more">More Info...</a> 
```

info_box 只是一个具有以下属性的 div：

```
width: 30%;
position: absolute;
left: 35%;
top: 250px;
background-color: #FFFFFF;
border: 2px solid #000000;
visibility: hidden; 
```

这怎么可能行不通，一直试图弄清楚 20 分钟。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T11:22:10.477

您可以在初始 CSS 中使用该`ready()`函数`display: none`

工作 HTML：

```
<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(
    function()
    {
            $("a#more").click(function() {
                $("#info_box").show("blind");
            });
});
</script>
<style>
    #info_box {
        width: 30%;
        position: absolute;
        left: 35%;
        top: 250px;
        background-color: #FFFFFF;
        border: 2px solid #000000;
        display: none;}
</style>
</head>
<body>

<a href="#" id="more">More Info...</a>

<div id="info_box">Secret info goes here</div>

</body>
</html> 
```

显示功能也有问题。您正在使用未记录的`params`. 请改用“动画”功能来制作自定义动画。

我还建议您将来使用 Firebug 来解决 javascript 问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T11:08:18.507

你确定你调用了正确的函数吗？根据[http://docs.jquery.com/Effects/show](http://docs.jquery.com/Effects/show)上的文档， show 函数将速度作为第一个参数，将回调函数作为第二个参数。我认为你的`"blind"`和`{ direction: "vertical" }`错位了。

还值得检查是否与其他脚本（例如 mootools）没有冲突。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-10T04:49:27.120

我有同样的问题。您需要加载 jQuery ui 插件以及普通的 Jquery 才能使用您在那里的格式。

# vim - 在 Vim 中，有没有办法将当前行号复制到缓冲区中？

> ID：295321
> 
> 赞同：10
> 
> 时间：2008-11-17T11:02:40.000
> 
> 标签：vim, x11

使用 gdb 和 Vim 时，我经常想停在特定的行上。通常在 Vim 中，我将规则区域上显示的行号复制粘贴到 gdb 会话中。如果我可以使用类似`"+<magic-incantation>`的方法将当前光标位置的行号复制到 xclipboard 缓冲区中，它会为我省去很多麻烦。这可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-17T11:27:00.840

把它放在你的 vimrc 中

```
map ,n <Esc>:let @*=line(".")<CR> 
```

然后使用`,``n`将当前行号复制到剪贴板

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-17T11:32:33.823

所以魔术线是：

```
 :call setreg('*', line('.')) 
```

原因：

1.  寄存器 * 持有剪贴板
2.  `line('.')`保存当前行号

当然，您可以将该功能映射到快捷方式：

```
nmap ,ln :call setreg('*', line('.'))<CR> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T11:33:56.067

此外，要在 vim 中使用 GDB，您可能需要查看 vim.sourceforge.net 上的一些 gdb 脚本 -

*   [http://vim.sourceforge.net/scripts/script.php?script_id=84](http://vim.sourceforge.net/scripts/script.php?script_id=84)
*   [http://vim.sourceforge.net/scripts/script.php?script_id=663](http://vim.sourceforge.net/scripts/script.php?script_id=663)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-17T11:11:51.790

不确定这是否是您所追求的，但您是否尝试过使用标记？

将光标放在您想要的行上，然后输入 m 和一个字母，比如 a。

输入 'a 将带您到包含标记的行。

输入 `a 会将您带到您在该行中标记的实际字母。

嗯，再想一想，这必须是可用的，因为行号可用于各种功能，例如用于状态栏。

# asp.net - 不在自定义 MembershipProvider 中使用电子邮件地址？

> ID：295325
> 
> 赞同：1
> 
> 时间：2008-11-17T11:03:54.193
> 
> 标签：asp.net, asp.net-membership, membership

我正在为旧数据库编写自定义 MembershipProvider。用户通过登录名和密码进行身份验证，没有附加电子邮件属性。什么是“短周期”的最佳途径`FindUsersByEmail()`和`GetUserNameByEmail()`方法？我幼稚的做法是不执行它们，因为我假设如果不需要恢复密码，也不需要通过电子邮件查找用户——这有什么副作用吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T11:49:11.810

我会冒险猜测你会没事的。快速浏览一下 Reflector 中的依赖关系会发现，这些方法仅由 Membership 类的静态方法使用。

但是，由于这些是公共方法，其他 3rd 方控件/API 可能会假定它们已实现。似乎某些 SharePoint API 就是这种情况（请参阅灰色的私有方法） SPMembershipProviderPrincipalResolver 使用这两种方法。

[http://img143.imageshack.us/img143/7097/windowclipping3rn3.png](http://img143.imageshack.us/img143/7097/windowclipping3rn3.png)

# javascript - Javascript onkeypress 删除或点

> ID：295329
> 
> 赞同：3
> 
> 时间：2008-11-17T11:05:31.243
> 
> 标签：javascript, onkeypress

有没有办法找出用户是否按下了删除键或点？它在 FireFox 中具有相同的键码。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T11:23:29.833

以下是有关键盘事件时浏览器行为的一个很好的概述：

[JavaScript Madness：键盘事件](http://unixpapa.com/js/key.html) *（也是最近的：2008 年 7 月 7 日）*

向下滚动到“3.2\. 字符事件返回的值”，有一个表格显示了不同浏览器的功能。

底线是：这取决于。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T11:18:05.880

根据[Detecting keystrokes](http://www.quirksmode.org/js/keys.html)，有可能，前提是：

*   您在onkeydown/up 上搜索 keyCode（删除**8 ），然后**
*   忽略 onkeypress 和 charCode （特别是如果您考虑到 IE 不会触发 keypressed 事件，只有按键向上/向下）。

# cocoa - NSAlert 没有弹跳停靠图标

> ID：295333
> 
> 赞同：5
> 
> 时间：2008-11-17T11:10:17.240
> 
> 标签：cocoa, macos

如果您`NSAlert`在应用程序在后台运行一段时间后，您的停靠栏图标会开始弹跳并继续弹跳，直到您切换回来。

我觉得这很烦人。

有谁知道如何禁用单个应用程序？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-17T12:13:50.387

创建您自己的 NSApplication 子类，并实现如下内容：

```
- (int)requestUserAttention:(NSRequestUserAttentionType)requestType
    {
        if (dontDoThatBouncyThing) {
            return 0;
        }
        return [super requestUserAttention:requestType];
    } 
```

不要忘记将 Info.plist 中的“NSPrincipalClass”从 NSApplication 更改为您自己的 NSApplication 子类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T11:37:13.813

并不是我会推荐它，但有一个 Haxie 可能会有所帮助：[Dock Detox](http://unsanity.com/haxies/dockdetox)。

我认为，它们允许您拦截弹跳并做其他事情。

一个快速的谷歌出现了：

```
- (void)cancelUserAttentionRequest:(int)request 
```

但我真的不知道这是否适合您的目的。

# algorithm - 在 F# 中计算移动平均线

> ID：295336
> 
> 赞同：6
> 
> 时间：2008-11-17T11:12:20.620
> 
> 标签：algorithm, f#, statistics, queue

我仍在研究 F# 的东西 - 试图弄清楚如何在 F# 中“思考”，而不仅仅是从我知道的其他语言翻译。

我最近一直在考虑在之前和之后之间没有 1:1 映射的情况。List.map 崩溃的情况。

其中一个示例是移动平均线，通常在对 n 个项目进行平均时，对于长度为 len 的列表，您将得到 len-n+1 个结果。

对于那里的大师来说，这是一个好方法吗（使用从[Jomo Fisher](http://blogs.msdn.com/jomo_fisher/archive/2007/12/12/strange-confluence-an-immutable-queue-in-f.aspx)捏出来的队列）？

```
//Immutable queue, with added Length member
type Fifo<'a> =
    new()={xs=[];rxs=[]}
    new(xs,rxs)={xs=xs;rxs=rxs}

    val xs: 'a list;
    val rxs: 'a list;

    static member Empty() = new Fifo<'a>()
    member q.IsEmpty = (q.xs = []) && (q.rxs = [])
    member q.Enqueue(x) = Fifo(q.xs,x::q.rxs)
    member q.Length() = (List.length q.xs) + (List.length q.rxs)
    member q.Take() =
        if q.IsEmpty then failwith "fifo.Take: empty queue"
        else match q.xs with
                | [] -> (Fifo(List.rev q.rxs,[])).Take()
                | y::ys -> (Fifo(ys, q.rxs)),y

//List module, add function to split one list into two parts (not safe if n > lst length)
module List =
    let splitat n lst =
        let rec loop acc n lst =
            if List.length acc = n then
                (List.rev acc, lst)
            else
                loop (List.hd lst :: acc) n (List.tl lst)
        loop [] n lst

//Return list with moving average accross len elements of lst
let MovingAverage (len:int) (lst:float list) = 
    //ugly mean - including this in Fifo kills genericity
    let qMean (q:Fifo<float>) = ((List.sum q.xs) + (List.sum q.rxs))/(float (q.Length()))

    //get first part of list to initialise queue
    let (init, rest) = List.splitat len lst

    //initialise queue with first n items
    let q = new Fifo<float>([], init)

    //loop through input list, use fifo to push/pull values as they come
    let rec loop (acc:float list) ls (q:Fifo<float>) =
        match ls with
        | [] -> List.rev acc
        | h::t -> 
            let nq = q.Enqueue(h) //enqueue new value
            let (nq, _) = nq.Take() //drop old value
            loop ((qMean nq)::acc) t nq //tail recursion

    loop [qMean q] rest q

//Example usage    
MovingAverage 3 [1.;1.;1.;1.;1.;2.;2.;2.;2.;2.] 
```

（也许更好的方法是通过从 Fifo 继承来实现 MovingAverageQueue？）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T03:26:09.750

如果你不太关心性能，这里有一个非常简单的解决方案：

```
#light

let MovingAverage n s =
   Seq.windowed n s
   |> Seq.map Array.average

let avgs = MovingAverage 5000 (Seq.map float [|1..999999|])

for avg in avgs do
    printfn "%f" avg
    System.Console.ReadKey() |> ignore 
```

这会从头开始重新计算每个“窗口”的平均值，因此如果窗口很大，则效果不佳。

无论如何，请查看 Seq.windowed：

[http://research.microsoft.com/projects/cambridge/fsharp/manual/FSharp.Core/Microsoft.FSharp.Collections.Seq.html](http://research.microsoft.com/projects/cambridge/fsharp/manual/FSharp.Core/Microsoft.FSharp.Collections.Seq.html)

因为在你的后兜里放这样的东西很方便。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T18:19:34.400

如果您*确实*关心性能，那么您可以使用类似这样的方法有效地计算移动平均线（假设我们正在计算 3 天窗口内的移动平均线）

```
数字[n] 运行总数[n]
--------- ---------------
n[0] = 7 7 = 数字[0]
n[1] = 1 8 = RunningTotal[1-1] + Numbers[1]
n[2] = 2 10 = RunningTotal[2-1] + Numbers[2]
n[3] = 8 11 = RunningTotal[3-1] + Numbers[3] - Numbers[3-3]
n[4] = 4 14 = RunningTotal[4-1] + Numbers[4] - Numbers[4-3]
n[5] = 1 13 = RunningTotal[5-1] + Numbers[5] - Numbers[5-3]
n[6] = 9 14 = RunningTotal[6-1] + Numbers[6] - Numbers[6-3]
...
N RunningTotal[N] = RunningTotal[N-1] + Numbers[N] - Numbers[N-3]

```

这方面的困难部分是保留您之前的运行总数和 Number [N-window]。我想出了以下代码：

```
let movingAverage days l =
    seq {
        let queue = new Queue<_>(days : int)
        let divisor = decimal days

        let total = ref 0m
        for cur in l do
            queue.Enqueue(cur)
            total := !total + cur
            if queue.Count < days then
                yield (cur, 0m)
            else
                yield (cur, !total / divisor)
                total := !total - (queue.Dequeue())
    } 
```

这个版本不像 Haskell 代码那样好看，但它应该避免与在每次运行时重新计算“窗口”相关的性能问题。它保持一个运行总数并将以前使用的数字保存在一个队列中，所以它应该非常快。

只是为了好玩，我写了一个简单的基准测试：

```
#light
open System
open System.Collections.Generic
open System.Diagnostics;

let windowAverage days (l : #seq<decimal>) = Seq.windowed days l |> Seq.map (Seq.average)

let princessAverage days l =
    seq {
        let queue = new Queue<_>(days : int)
        let divisor = decimal days

        let total = ref 0m
        for cur in l do
            queue.Enqueue(cur)
            total := !total + cur
            if queue.Count < days then
                yield (cur, 0m)
            else
                yield (cur, !total / divisor)
                total := !total - (queue.Dequeue())
    }

let testData =
    let rnd = new System.Random()
    seq { for a in 1 .. 1000000 -> decimal (rnd.Next(1000)) }

let benchmark msg f iterations =
    let rec loop = function
        | 0 -> ()
        | n -> f 3 testData |> ignore; loop (n - 1)

    let stopWatch = Stopwatch.StartNew()
    loop iterations
    stopWatch.Stop()
    printfn "%s: %f" msg stopWatch.Elapsed.TotalMilliseconds

let _ =
    let iterations = 10000000
    benchmark "princessAverage" princessAverage iterations
    benchmark "windowAverage" windowAverage iterations
    printfn "Done" 
```

结果：

```
公主平均：1670.791800
窗口平均：2986.146900
```

我的版本快 1.79 倍。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-31T08:06:08.427

如果您关心性能并喜欢优雅的代码，请尝试

```
module MovingAverage = 
    let selfZip n l =
        Seq.skip n l |> Seq.zip l 

    let runTotal i z =
        Seq.scan ( fun sum (s, e) -> sum - s + e ) i z

    let average n l:seq<'a> =
        Seq.skip n l
        |> selfZip n
        |> runTotal (l |> Seq.take n |> Seq.sum)
        |> Seq.map ( fun sum -> decimal sum / decimal n ) 

 let ma = MovingAverage.average 2 myseq 
```

使用 FSUnit 我们可以测试它

```
 let myseq = seq { for i in 0..10 do yield i }

 Seq.nth 0 ma |> should equal 0.5
    Seq.nth 1 ma |> should equal 1.5
    Seq.nth 2 ma |> should equal 2.5
    Seq.nth 3 ma |> should equal 3.5 
```

该算法的技巧是先将前 n 个数字相加，然后通过添加窗口头部和减去窗口尾部来保持运行总计。滑动窗口是通过对序列执行自压缩来实现的，但第二个参数是按窗口大小提前的 zip。

在管道结束时，我们只需将运行总数除以窗口大小。

注意扫描就像折叠一样，但将每个版本的状态生成一个序列。

一个更优雅的解决方案虽然可能会影响性能，但可以观察到，如果我们对序列进行零填充，我们就不需要计算初始总和。

```
namespace Utils

module MovingAverage = 
    let selfZip n l =
        Seq.skip n l |> Seq.zip l 

    let rec zeros = 
        seq { yield 0.0; yield! zeros} 

    // Create a running total given
    let runTotal z =
        Seq.scan (fun sum (s,e) -> sum - s + e ) 0.0 z

    let average n l =
        Seq.concat [(Seq.take n zeros); l]
        |> selfZip n
        |> runTotal
        |> Seq.map ( fun sum -> sum / float n ) 
        |> Seq.skip n 
```

由于与两个序列的包装相关的第二次间接性可能会导致性能下降，但可能并不重要，具体取决于窗口的大小

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T13:54:08.173

[这是此处](https://stackoverflow.com/questions/295336/calculating-a-moving-average-in-f#295537)提出的 Haskell 解决方案的 F# 版本（我希望已更正）。

编辑：现在是尾递归的，不是更快，但不会在 n = 50000 时爆炸。（请参阅非尾递归版本的编辑历史记录）

```
let LimitedAverage n ls = 
    let rec loop acc i n ls = 
        match i with
        | 0 -> acc //i counts down from n to 0, when we hit 0 we stop
        | _ -> match ls with
               | [] -> acc //if we hit empty list before end of n, we stop too
               | x::xs -> (loop (acc + (x / float n)) (i - 1) n xs) //divide this value by n, perform average on 'rest' of list
    loop 0\. n n ls

LimitedAverage 50000 (List.map float [1..9999999])
//>val it : float = 25000.5

let rec MovingAverage3 n ls = 
    let rec acc loop i n ls = 
        match i with 
        | 0 -> List.rev acc //i counts down from n to 0, when we hit 0 we stop
        | _ -> match ls with
                | [] -> List.rev acc //if we hit empty list before end of n, we stop too
                | x::xs -> loop (LimitedAverage2 n ls :: acc) (i - 1) n xs // limited average on whole list, then moving average on tail
    loop [] (n + 1) n ls 

MovingAverage3 50000 (List.map float [1..9999999])
//>val it : float list = [25000.5; 25001.5; 25002.5; ...] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-04T22:24:50.633

这是我的版本。

```
let sma list n =
    let len = List.length list
    let rec loop acc sum cnt =
        if cnt >= len then List.rev acc
        else if cnt < n-1 then loop (0.0::acc) (sum + List.nth list cnt) (cnt+1)
        else loop (((sum + List.nth list cnt)/(float n))::acc) (sum + (List.nth list cnt) - (List.nth list (cnt-n+1))) (cnt+1)
    loop [] 0.0 0 
```

例子：

```
sma (List.map float [5..50]) 5
[0, 0, 0, 0, 7, 8, 9, ...] 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-09-28T10:10:56.033

来自[http://www.fssnip.net/4S/title/Moving-Average](http://www.fssnip.net/4S/title/Moving-Average)

```
let movingAverage (period : int) (values : float seq) =
  Seq.zip values (Seq.skip period values)
  |> Seq.scan (fun last (prev, cur) -> last - prev + cur) (values |> Seq.take period |> Seq.sum)
  |> Seq.map (fun x -> x / float(period)) 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-17T13:07:18.093

据我所知，您的代码充满了`let`语句。我不熟悉 F#，但确实做过一些 Haskell。功能范式意味着不考虑“如何”，而是考虑“什么”：您认为是 Fifo，但实际上您应该只指定移动平均线的语义。

```
-- the limited average of a list
limitedaverage 0 _ = 0
limited verage n (x:xs) = (x/n) + ( limited average (n-1) xs )

-- a list, transformed into a sequence of moving averages of 
movingaverages n [] = []
movingaverages n (x:xs) = ( movingaverage n (x:xs) : movingaverages n xs ) 
```

# c# - 在离屏位图上应用 PixelShader

> ID：295337
> 
> 赞同：4
> 
> 时间：2008-11-17T11:12:39.747
> 
> 标签：c#, .net-3.5, image-processing, shader

我目前正在尝试使用 .net 3.5 sp1 引入的 PixelShaders 来提高图像处理性能。一切都快得多，但直到我刚刚将效果应用于我的 wpf 表单中的某些元素，我实际上想避免。

我们有一堆图像处理功能，我想用像素着色器逐个替换一些其他的东西以获得一些性能。有没有办法将这样的像素着色器应用于 ImageSource 而不必显示它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T19:55:02.593

*看到您还没有从 C# 专家那里得到任何答案，我将尝试从 C++ DirectX 开发人员的角度来解决这个问题，希望如果我的答案没有用，至少它会为您指明正确的方向。我对 C# 知之甚少，对 PixelShaders 的支持方式一无所知，因此机会是完全错误的，我在这里写的内容根本不适用。在这种情况下，请随时根据需要发表评论或投反对票*

通常在 C++/DirectX 中实现这一点的方法是：

准备（一次）

*   使用 CreateRenderTarget 创建渲染目标
*   使用 CreateOffscreenPlainSurface 创建屏幕外表面
*   使用 SetRenderTarget 设置渲染目标表面
*   创建所需的任何其他输入资源（纹理、顶点缓冲区...）

渲染（多次完成）

*   根据需要更新输入资源（纹理、缓冲区）
*   使成为
*   通过 GetRenderTarget 将渲染目标的内容复制到屏幕外表面
*   锁定屏幕外表面并在 CPU 上读取其内容

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-08-27T13:26:33.517

谁仍然需要这个：我刚刚在这里创建了这篇文章，展示了如何在 WPF 中做到这一点。 [http://www.codeproject.com/Articles/642151/Pixel-shaders-in-a-background-thread-in-WPF](http://www.codeproject.com/Articles/642151/Pixel-shaders-in-a-background-thread-in-WPF)

相关代码复制如下。它来自一个带有一些存储变量的类

*   来源：一个 ImageSource
*   DpiX，DpiY：包含源 Dpi 的双精度数
*   img：WPF 图像控件
*   视图框：WPF 视图框控件
*   WPF_DPI_X、WPF_DPI_Y：const 加倍，值为 96.0

1.Image img 嵌入在 Viewbox 中（也在屏幕外）

```
//prepare images
img = new Image();
img.Stretch = Stretch.None;
viewbox = new Viewbox();
viewbox.Stretch = Stretch.None;
viewbox.Child = img; //control to render 
```

2.img 和 viewbox 的大小调整到正确的比例，并且在 viewbox 上调用了一些布局函数。这使得控件在应用着色器的情况下进行渲染。

```
/// <summary>
/// Loads the image and viewbox for off-screen rendering.
/// </summary>
public void LoadImage(double width, double height)
{
    img.BeginInit();
    img.Width = width;
    img.Height = height;
    img.Source = Source;
    img.EndInit();

    viewbox.Measure(new Size(img.Width, img.Height));
    viewbox.Arrange(new Rect(0, 0, img.Width, img.Height));
    viewbox.UpdateLayout();
} 
```

3.并获取图像的内容，如果您愿意，请提供“屏幕截图”：

```
void SaveUsingEncoder(BitmapEncoder encoder, Stream stream)
{
    RenderTargetBitmap bitmap = new RenderTargetBitmap((int)(img.Width * DpiX / WPF_DPI_X), (int)(img.Height * DpiY / WPF_DPI_Y), DpiX, DpiY, PixelFormats.Pbgra32);
    bitmap.Render(viewbox);

    BitmapFrame frame = BitmapFrame.Create(bitmap);
    encoder.Frames.Add(frame);
    encoder.Save(stream);
} 
```

另外，如果你想在一个单独的线程中运行它，你需要创建一个线程

```
thread.SetApartmentState(ApartmentState.STA); 
```

有关更多信息和演示项目，请参阅文章。

# c - Repcached for Win32 - 有人构建它吗？

> ID：295339
> 
> 赞同：1
> 
> 时间：2008-11-17T11:13:08.997
> 
> 标签：c, winapi, memcached

我终于获准在我们的项目中使用 Memcached（经过几个月的游说反对基于数据库的缓存解决方案 - 只是不要问......），但是我们还需要使用 Repcached 来备份我们的数据。有没有人为Win32构建过这个？我们最终可能会在生产中使用 Linux，但开发很可能会在 Windows 上进行。

感谢您收到任何提示或指示 - 似乎有很多 .T 文件，我认为是 TCL？那可能很有趣...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T15:14:07.387

[您可以从http://code.jellycan.com/memcached/](http://code.jellycan.com/memcached/)应用补丁，使 memcached 支持 win32。我没有厌倦它，但可能会工作。

# cryptography - 如何使用 Microsoft ECSP 仅使用 RSA 公钥加密小数据块？

> ID：295345
> 
> 赞同：2
> 
> 时间：2008-11-17T11:18:15.383
> 
> 标签：cryptography, rsa, cryptoapi

我需要使用 512 位 RSA 公钥加密一小块数据（16 字节）——对于我所知的大多数加密库来说，这是一项相当容易的任务，除了 MS CSP API，看起来。[CryptEncrypt](http://msdn.microsoft.com/en-us/library/aa379924(VS.85).aspx)函数的文档指出

> Microsoft Enhanced Cryptographic Provider 支持使用 RSA 公钥的直接加密和使用 RSA 私钥的解密。加密使用 PKCS #1 填充。

但这对我不起作用。好吧，我的代码可以正常工作并生成大小正确的加密数据块，但 openssl 无法解密它。看起来 CryptEncrypt 仍然使用对称密码。

不幸的是，我发现的所有示例都指的是组合密码学与对称密码，所以我手头没有一个工作示例，这肯定会使事情变得更容易。

请任何人指出这样一个例子，或者让我知道我是否错过了一些不那么明显的陷阱？

谢谢你。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T03:42:05.847

这听起来像一个[字节顺序](http://en.wikipedia.org/wiki/Endianness)问题。Microsoft 的[CryptEncrypt](http://msdn.microsoft.com/en-us/library/windows/desktop/aa379924(v=vs.85).aspx)函数以 little-endian 格式返回密文，而 OpenSSL 希望其数据采用 big-endian 格式。在将加密数据传递给 OpenSSL 之前，您需要对其进行反转。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-18T16:58:26.753

这是代码（以防万一有人用谷歌搜索了这个主题）：

```
BYTE *spkiData = SPKI; // X.509 ASN.1 encoded SubjectPublicKeyInfo
DWORD dwSPKISize = SPKI_SIZE; // 94 bytes for RSA

DWORD dwBufSize = 0;
// Get buffer size for decoded spki structure
CryptDecodeObject(X509_ASN_ENCODING, X509_PUBLIC_KEY_INFO, spkiData, dwSPKISize, 0, NULL, &dwBufSize);
BYTE* decBuf = new BYTE[dwBufSize];
CryptDecodeObject( X509_ASN_ENCODING, X509_PUBLIC_KEY_INFO, spkiData, dwSPKISize, 0, decBuf, &dwBufSize);
// Now decode the RSA Public key itself
CERT_PUBLIC_KEY_INFO * spki = (CERT_PUBLIC_KEY_INFO *) decBuf;
// Get buffer size for decoded public key structure
CryptDecodeObject( X509_ASN_ENCODING, RSA_CSP_PUBLICKEYBLOB, spki->PublicKey.pbData, spki->PublicKey.cbData, 0, 0, &dwBufSize);
// Get the RSA public key blob
BYTE *blobBuf = new BYTE[dwBufSize];
CryptDecodeObject(X509_ASN_ENCODING, RSA_CSP_PUBLICKEYBLOB, spki->PublicKey.pbData, spki->PublicKey.cbData, 0, blobBuf, &dwBufSize);
// Acquire crypto provider context
HCRYPTPROV hCryptProv = NULL;
CryptAcquireContext(&hCryptProv, 0, MS_ENHANCED_PROV, PROV_RSA_FULL, CRYPT_VERIFYCONTEXT);
// Import key
HCRYPTKEY key = NULL;
CryptImportKey(hCryptProv, blobBuf, dwBufSize, 0, 0, &key);
// Get the key size
DWORD dwKeySize;
DWORD dwParamSize = sizeof(DWORD);
CryptGetKeyParam(key, KP_KEYLEN, (BYTE*) &dwKeySize, &dwParamSize, 0);
// we need it in bytes for convenience
dwKeySize /= 8;
// Now the fun
// allocate a buffer of key size
BYTE *data = new BYTE[dwKeySize];
// Copy data need to be encrypted
// With PKCS#1 padding data length can not exceed keysize - 11 bytes
DWORD dataLen = 16;
memcpy(data, "0123456789012345", dataLen);
CryptEncrypt(key, 0, TRUE, 0, data, &dataLen, dwKeySize)
// now convert it to big endian (for the rest of the world)
for (int i = 0; i < (dwKeySize / 2); i++) {
    BYTE c = data[i];
    data[i] = data[dwKeySize - 1 - i];
    data[dwKeySize - 1 - i] = c;
}
// now data points to a dwKeySize length block of RSA PKCS#v1.5 encrypted data 
```

# windows-services - 如何监控 Windows 服务

> ID：295348
> 
> 赞同：40
> 
> 时间：2008-11-17T11:21:08.043
> 
> 标签：windows-services, monitoring

我正在寻找一种方法来**监视某些 Windows 服务**（在 Windows Server 2003 上）并**在必要时重新启动**。这些服务位于不同的服务器上，主要包括 SQL Server 服务（例如 SQL Server Agent），但也包括一些专有服务。

如果服务停止，则发送电子邮件警报也非常有用。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-11-17T11:31:13.297

Windows 中内置了一个“可能足够”的版本。查看服务属性的“恢复”选项卡，可通过`services.msc`.

您可以通过以下方式处理服务失败：

*   “重启服务”
*   “运行程序”
*   “重启电脑”

例如，“运行程序”可以是一个发送邮件的小脚本。

如果您想要一个带有概览仪表板等的更大解决方案，有很多可用的系统监控解决方案。例如，想到了 SolarWinds IPMonitor、Nagios 或 Cacti。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-17T11:55:41.390

如果您对某些*.NET*编程感兴趣，[System.ServiceProcess](http://msdn.microsoft.com/en-us/library/system.serviceprocess.aspx)命名空间提供了允许您实现、安装和控制 Windows 服务应用程序的类。

简单示例，在 C# 中检查并启动服务：

```
var srv = new ServiceController("MyService");
Console.WriteLine("MyService Status {0}", srv.Status);
if (srv.Status != ServiceControllerStatus.Running)
    srv.Start(); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T11:30:36.463

它们可能是一些专用工具，但我只想指出**[wmic](http://www.ss64.com/nt/wmic.html)**工具。

```
wmic /node:[hostname] service list 
```

能够列出任何计算机的服务

```
WMIC SERVICE where caption='TELNET' CALL STARTSERVICE 
```

将重新启动 telnet 服务。

如果你把 wmic 封装成脚本语言（能够发送邮件），你就可以拥有你正在寻找的监控工具。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-17T13:14:12.463

这取决于您要监控的具体内容：

*   就服务控制管理器 (SCM) 而言，服务实际上已停止。
*   服务在 SCM 不知情的情况下崩溃 - 由于线程，这很常见。
*   一项服务在 SCM 不知情的情况下挂起 - 这也很常见。

对于第一项，您可以将服务配置为启动发送电子邮件警报的脚本。请注意，如果服务由于其无法控制的情况（依赖于不稳定的网络连接或其他）而不断重新启动，这可能真的很烦人。

对于其他两项，您将需要某种类型的心跳服务，您可以构建或购买。小心让心跳监控器在其监控的服务本地运行，因为正如我前段时间所写，[网络不可靠](http://sleeksoft.co.uk/public/techblog/articles/20041218_1.html)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-12-22T09:53:01.080

您可以使用 ManageEngine Free Windows Service Monitor。使用它，您可以启动/停止远程系统中的服务。

[http://www.manageengine.com/free-windows-service-monitor/free-windows-service-monitor-index.html](http://www.manageengine.com/free-windows-service-monitor/free-windows-service-monitor-index.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-23T21:25:58.103

+1 用于确保在本地计算机上监控服务。

[Service Hawk](http://www.servicehawk.com)之类的东西可以监控您的服务并在它们停止时重新启动它们并向您发送电子邮件警报。您还可以考虑安排定期重启，因为正如另一张海报所提到的，就 SCM 而言，该服务并不总是显示为“已停止”。在这些情况下，服务会被挂起、冻结或以其他方式出现问题，并按计划每隔一段时间重新启动服务，以保持其干净运行。它只是清除内存等，并给它一个新的开始。

# ruby-on-rails - 将多个对象保存到表中的单个字段

> ID：295358
> 
> 赞同：0
> 
> 时间：2008-11-17T11:28:16.483
> 
> 标签：ruby-on-rails, serialization

我想将从文本字段（以逗号分隔）收集的一组电子邮件地址保存到表中的单个字段中。我正在尝试使用序列化，但出现 SerializationTypeMismatch 错误。我怎样才能做到这一点？

这是我的模型：

类船员 < ActiveRecord::Base

类收件人 < HashWithIndifferentAccess ; 结尾

序列化：收件人，收件人

结尾

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T11:49:47.830

我真的建议您解析（例如以逗号分隔）电子邮件列表并将每个放在单独的表中的一行中（我假设您正在谈论数据库表？）。如果您想将电子邮件地址用于某些事情，最好将它们单独存储，并且由于您在谈论序列化，我猜您已经解析了电子邮件，并尝试将数组或类似内容存储到数据库中的单个字段中. 执行此操作的“正确”规范化数据库方法是在您当前尝试保存对象的模型中，添加一个`has_many :emails`（或类似的）并为每封电子邮件创建一个新的电子邮件表。

将列表类型数据存储在 blob 中，而不是使用适当的关联表，应该总是有*很好的理由。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T15:15:02.510

如果给您一个逗号分隔的电子邮件地址列表，并且当您需要使用该信息时，逗号分隔的列表很有用，那么只需将其放在模型中的文本列中，无需序列化。

如果需要序列化列表，不就是一个数组吗？你能解释一下哈希的选择吗？

# delphi - Delphi：从继承的表单中删除可视组件引用

> ID：295383
> 
> 赞同：3
> 
> 时间：2008-11-17T11:42:26.020
> 
> 标签：delphi

当我删除基本表单中的可视组件并忘记继承表单中的任何引用时，我的应用程序只会在运行时中断。

我通常做的是使用搜索工具在 .DFM 中查找引用，但我对这种方法并不完全满意。

你有更好的建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T12:04:10.623

也许[Andreas Hausladen 的 DFMCheck 有](http://cc.codegear.com/Item/25538)帮助？

乌力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T12:04:28.987

可以肯定的是，但是您是否在继承的 dfm 中使用了“继承”？

```
inherited Form1: TForm1
  Caption = 'Form1'
  PixelsPerInch = 96
  TextHeight = 13
end 
```

如果您有“对象”而不是“继承”，则会遇到很多问题。

# visual-studio-2008 - Visual Web Developer 2008 Express ed 中的语法高亮显示

> ID：295384
> 
> 赞同：0
> 
> 时间：2008-11-17T11:43:49.650
> 
> 标签：visual-studio-2008, visual-studio-express

如何查看哪些文件扩展名与哪种语法突出显示相关？不幸的是，`Tools -> Options -> Text Editor -> File Extensions`只列出手动输入的，没有默认的。而且我没有设法通过谷歌或其他方式自己找到它。

我的特殊问题是，我想让 .inc 与 .asp 完全一样突出显示，但我不确定 .asp 使用的是哪个编辑器。我确实尝试了以下方法（没有奏效）：

*   网页表单编辑器
*   VB脚本编辑器
*   HTML 编辑器
*   脚本编辑器

（从某种意义上说，它们确实起作用了，它们以一种或另一种方式为我的代码着色，但它与我在`.asp`文件中得到的突出显示不同）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T23:58:39.823

实际上我不能（可能是由于服务器配置），.inc 文件被完全视为 .asp。虽然我知道这个安全问题，暂时我只是将文件重命名为 .asp ;) 谢谢 Eduardo。

但我的问题仍然存在......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T11:50:43.617

非 .asp 文件存在安全问题。问题是如果直接在 URL 中访问文件，就可以查看文件的完整代码。

推荐的解决方法（作为奖励解决您的问题）是创建一个相同的 .asp 文件并将 .inc 文件更改为包含 .asp 文件

# perl - 是否有任何工具可以在我的 Perl 程序中查找内存泄漏？

> ID：295385
> 
> 赞同：12
> 
> 时间：2008-11-17T11:45:03.470
> 
> 标签：perl, memory-leaks

我在 Windows 2003 Server 上使用 ActiveState Perl 5.6，并且遇到了一些内存泄漏问题。是否有任何好的工具（甚至可以提供线索的坏工具）我可以用来帮助找到它们。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-17T12:19:48.517

所有 perl 程序内存泄漏要么是一个持有引用的 XS，要么是一个循环数据结构。[如果您知道哪些结构可能包含循环，则Devel::Cycle](http://search.cpan.org/dist/Devel-Cycle/)是查找循环引用的好工具。[Devel::Peek](http://search.cpan.org/dist/Devel-Peek/)可用于查找引用计数高于预期的对象。

如果您不知道该去哪里寻找，[Devel::LeakTrace::Fast](http://search.cpan.org/dist/Devel-LeakTrace-Fast/)可能是一个不错的选择，但您需要一个为调试而构建的 perl。

如果您怀疑泄漏在 XS 空间内，那就更难了，而[Valgrind](http://valgrind.org/)可能是您最好的选择。[Test::Valgrind](http://search.cpan.org/dist/Test-Valgrind/)可能会帮助您减少需要搜索的代码量，但这在 Windows 上不起作用，因此您必须将（至少是泄漏的部分）移植到 Linux 才能做到这一点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-07T23:06:38.280

[Devel::Gladiator](http://search.cpan.org/~nuffin/Devel-Gladiator-0.01/lib/Devel/Gladiator.pm)将向您显示 Perl 在任何给定时间在内存中具有多少每种变量类型的列表，以及它们所引用的内容。对于确定正在创建但未释放的对象类型非常有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-30T13:06:27.803

由于尚未提及，因此[Devel::Size](https://metacpan.org/module/Devel::Size)将报告数据结构的大小。没有给出其他信息，它用来确定数据结构“边界”的规则是不透明的。对于简单的结构，这不是问题。

[Devel::SizeMe](https://metacpan.org/module/Devel::SizeMe)是我的一个爱好项目，旨在解决 Devel::Size 的问题，并使perl 解释器的*整个内存使用情况可视化。*有关更多信息，请参阅[我的博客](http://blog.timbunce.org/tag/sizeme/)，包括指向截屏视频和视频的链接。我的目标之一是实现泄漏的检测和可视化，但这还有很长的路要走。

更新：

除了其他评论之外，您可能会发现我在 LPW2013 上的[Perl Memory Use 演讲很有用。](http://www.slideshare.net/Tim.Bunce/perl-memory-use-lpw2013)我建议观看[截屏视频](https://archive.org/details/Perl-Memory-Profiling-LPW2013)，因为它解释了幻灯片，最后有一些可爱的视觉效果和一些问答。

我还建议查看我在演讲中提到的 Paul Evans [Devel::MAT](https://metacpan.org/pod/Devel::MAT)模块。

# php - 如何在计划任务中运行 PHP 文件（Windows 任务计划程序）

> ID：295386
> 
> 赞同：46
> 
> 时间：2008-11-17T11:45:10.633
> 
> 标签：php, windows, scheduled-tasks

如何创建计划任务来运行 PHP 文件？
是的，我在计划任务中填写了所有内容，但它仍然不起作用。

> 运行：“C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\WEB\4w_website\save.php”
> 
> 开始于：“C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\WEB\4w_website”

它只是在记事本中打开 PHP 文件。

我给出了正确的用户名和密码。

请帮我..

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-11-17T12:00:16.827

运行命令应该是

```
C:\Path\to\php.exe -f "C:\Path\to\file.php"

```

从 php.exe 的命令行帮助：

```
-f 解析并执行 <file>。

```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-02-03T00:29:55.200

我刚刚写了一个`.bat`文件来完成工作**file.bat**

```
@ECHO OFF
php.exe -f "C:\code\cust.php" 
```

并将其放入计划任务中，如下所示：

跑：`C:\code\file.bat`

开始于：`C:\code\`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-01-28T10:05:58.323

如果您运行 php 脚本，在大多数情况下，脚本等待在当前文件夹中运行。这意味着您必须为每个操作设置文件夹，使用字段“ **Start In** ”。

例子：

```
Run: C:\php\php.exe 
Arguments: -f C:\web\myscript.php 
```

**不要忘记：**

```
 Start in: C:\web\ 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-17T11:53:23.843

听起来您没有与 EXE 关联的 PHP 文件。

你可以这样做**我的电脑**>**工具**>**文件夹选项**>**文件类型**。如果不出意外，这也可以帮助您验证他们的设置。

否则，您可以在任务中指定**“C:\path\to\php.exe [file]”**。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-03T05:14:59.737

这就是我所做的：

1.  PHP 文件

    ```
    <?php my code goes here ?> 
    ```

    *请注意，如果您在 CLI 中使用 HTTP API/CURL，请使用`dl("php_curl.dll");`

    这会将 curl 加载到 cli

2.  现在我将 PHP 添加到 Windows 路径变量中，这可以从我的电脑、属性、高级设置、环境变量、新建

3.  接下来我创建了一个 .bat 文件，只需打开记事本并在下面输入代码并保存为 myfile.bat

    ```
    @ECHO OFF
    php -f d:\wamp\www\V3\task.php 
    ```

    [该站点](http://www.makeuseof.com/tag/write-simple-batch-bat-file/)可能会帮助您了解 .bat 文件语法。

4.  现在在 Windows 上创建一个新的计划任务并调用上面的 .bat 文件作为源，

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-10-07T00:52:12.087

### 对于那些无法使@Tomalak 的答案起作用的人：

检查您的目录中是否有空格 ( `)。如果是这样，您需要用`"`.`

 ````
"C:\Path\to php file\php.exe" -f "C:\Path\to php file\file.php" 
```

如果它仍然不起作用，请检查`file.php`其中是否包含包含文件。

```
include("file2.php"); /* OR */
include_once("file2.php"); 
```

去掉它。如果`file.php`确实需要您的包含文件，请尝试将代码/脚本从该包含文件移动到您的主文件。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-17T11:50:02.480

我认为，您必须通过 URL 执行您的 PHP 脚本。您可以为执行 URL 编写批处理脚本。为什么不使用其他语言编写后端脚本，例如批处理脚本、vbscript 等。

# c# - 如何在调试模式下运行另一个进程？

> ID：295387
> 
> 赞同：3
> 
> 时间：2008-11-17T11:45:49.117
> 
> 标签：c#, visual-studio, debugging, visual-studio-2005

我正在编写一个 Windows 服务。该服务运行我通过 Process 类方法开发的另一个进程，但我也想在调试模式下运行该进程，例如使用断点。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T11:59:42.147

调试服务时，DebugBreak() 非常好。您甚至可以调试服务的启动，如果您尝试附加该进程，这可能会非常困难。

在 C# 中

```
#if DEBUG
  System.Diagnostics.Debugger.Break();
#endif 
```

在 C++ 中

```
#if DEBUG
  System.Diagnostics.Debugger.Break();
#endif 
```

另请参阅问题：[如何在 C# 中使用 debugbreak()。](https://stackoverflow.com/questions/104235/how-can-i-use-debugbreak-in-c)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T11:47:49.580

从主菜单“调试->附加进程”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T11:49:17.723

除了“附加进程”模式外，我有时还发现拥有一个可以直接从 Visual Studio 运行（或仅作为控制台应用程序）运行的可执行文件很方便。我不记得这样做是否有任何困难，但我*认为*没有......你只需要提供一个正常的入口点以及服务入口点。

# jquery - JQuery 使用的运行时间

> ID：295399
> 
> 赞同：0
> 
> 时间：2008-11-17T11:51:38.513
> 
> 标签：jquery, runtime

假设 JQuery 实际上不是 ECMA 规范的实现而是某种框架是否正确？

如果这是真的，它使用什么运行时间？例如在 IE 中，它是否最终以 IE 中的 javascript 引擎结束？

谢谢

塞什

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T11:57:42.947

jQuery 完全用 Javascript 编写。它使用运行它的浏览器中的任何 Javascript 引擎运行，因此如果您在 IE 中运行它，它将使用 IE 的引擎。在 Firefox 中，它使用 Firefox 引擎。

基本上它只是一个围绕每个浏览器遵循的半标准 Javascript API 构建的 API。它考虑了浏览器之间的任何怪癖，并为您（在内部）平滑它们，以便在框架内开发时无论浏览器如何，一切都一样。

它仅在每个浏览器允许的范围内遵循 ECMA 规范。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T11:57:15.740

jQuery 是一个用 javascript 编写的框架，因此当然是由浏览器的 javascript 引擎运行的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T12:03:07.070

jQuery 不是一个 ECMA 规范实现，而是一个 javascript 框架。它能够在所有现代浏览器中运行，并提供使 JavaScript 开发更容易的 API。由于浏览器之间的 javascript 运行时不同，jQuery 会动态检测浏览器并采取相应措施。

所以要回答你的问题，在 IE 中它结束在 IE 的 javascript 引擎下运行。

# svn - Subversion 中的单个多用户结帐 - 可能吗？

> ID：295402
> 
> 赞同：1
> 
> 时间：2008-11-17T11:53:11.177
> 
> 标签：svn, multi-user

在我们的组织中，我们有以下问题。我们希望对我们的网络树进行修订控制，但我们中的许多人希望能够更改（并签入）该树的任何文件。我们还希望所有这一切都只有一次退房，因为这棵树相当大。对于该树的某些部分，我们目前正在使用 RCS，它允许上述行为，但当然还有其他一些缺点。

有谁知道如何在 Unix 服务器上使用 Subversion 做这样的事情（可能有某种解决方法）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T12:56:36.290

开发人员不是在自己的机器上吗？树是否如此巨大以至于必须将其签出到服务器上的共享网络驱动器上，因为它不适合单个开发人员的工作站？我认为这个问题需要一些数字来进一步澄清问题和背后的推理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T15:12:10.183

正如您可能从其他帖子中看到的那样，这个问题的一般答案是“不要那样做”。一般来说，Subversion 用于将部分或全部存储库单独检出到本地工作区。

如果您绝对肯定地**必须**了解每个开发人员的整个存储库，但开发人员只更改了一小部分，那么这里有一个适合您的潜在解决方案。您需要开发一些脚本来简化我所描述的内容（它基于我曾经使用的 UNIX IDE）。

根据您的评论，我还假设环境是 UNIX 或 Linux - 我认为在 Windows 中不可能出现以下情况。

1.  在某个位置以只读方式签出整个项目。确保所有开发人员都具有对其的读取权限。
2.  有一个开发人员可以执行的脚本，该脚本使用指向该开发人员工作区中只读目录的*符号链接来创建该结构的镜像，从而对目录结构进行爬网。*
3.  签出要编辑的树的一部分时，删除符号链接并从 Subversion 签出该路径（您可能需要一个脚本来包装`svn`命令来处理此问题）
4.  在单独的脚本中`svn commit`或在单独的脚本中，您可能希望删除工作区目录并重新建立符号链接。
5.  `post-commit`通过Subversion 中的挂钩或定期使用`cron`或类似的方式更新只读副本。

*符号链接为每个开发人员*提供了整个树的视图，并允许仅对开发人员正在积极编辑的树的那些部分进行“本地”检查。

迂回的原因是 Subversion 真的不打算以这种方式使用。但是，对于您所描述的内容，这种方法会起作用，但会有些痛苦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T13:14:10.110

磁盘驱动器很便宜。让每个开发人员检查树的副本。Subversion 解决了锁定问题，因此每个拥有自己副本的用户不会干扰其他人进行更改。如果每个人都签出并管理他们自己的源代码树开发版本，那么您的工作效率会更高，并且对更改有更好的责任感。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T11:56:24.370

为什么不直接查看您有兴趣改变的那棵树呢？那应该不是问题。也许我对您所说的“单次退房”感到困惑。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T12:17:20.770

在典型的 SVN 环境中，每个用户都有自己的（完整或部分）树副本，她可以在其中对树进行任何她想要执行的更改，而不会打扰或破坏她的同事。然后她决定签入什么。所有其他人都可以签出，只要他们认为这是最好的时间。主要（部署）用户定期（每日构建）签出以检查完整性。

我认为与 CVS/subversion 相比，您的困惑是 RCS：RCS 在编辑时为所有其他人阻止文件，SVN 不会阻止任何内容（通常。阻止是可能的，但很少使用）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T12:34:04.713

@Lytha：我知道 RCS 是基于锁的，在我们的场景中我们对此没有任何问题。我也知道您可以使用带有锁定功能的 SVN，但每个用户的签出问题仍然存在......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-17T11:54:20.207

我建议您为所有开发人员都可以访问的网络树使用一个特殊帐户，并以该用户的身份检查网络树。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-17T11:58:35.440

@Jesper：是的，这是可能的。所有成员的额外帐户，可能带有额外的 sudo 规则。

@Jon：问题是基本上我们所有人都需要更改树的*某些部分中的**一些文件。*这就是为什么我们都需要整棵树，但我们不希望有那么多的签出。

 ** * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-17T18:16:43.417

Subversion 允许您检出树的任何部分，并且 1.5 版还支持[稀疏检出](http://subversion.tigris.org/svn_1.5_releasenotes.html#sparse-checkouts)。这意味着您可以将结帐微调到单个目录级别（但不能达到 RCS 可以达到的单个文件级别）。

例如，如果您的存储库如下所示：

```
存储库根
  标签
  分支机构
  树干
    文档
    源代码
      模块1
        资源
      模块2
    图片

```

您可以使用以下命令仅签出`module1`目录（而不是其子目录）中的文件：

```
svn checkout --depth=files svn://server/repository/trunk/src/module1 
```

如果您还需要子目录内容，您可以稍后调整结帐的大小，请参阅文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-17T18:22:56.960

如果检查工作副本的延迟/带宽让您担心，请记住工作副本是完全独立的。这意味着您可以签出一个巨大的存储库，然后简单地将那个“工作副本”复制给任何需要它的人。

同样的技巧也适用于分支——如果你有一个未更改的最近的主干工作副本，你可以简单地复制它，然后将它“svn switch”到一个新的分支。

1.  将巨大的存储库签出到 base_working_copy（过夜？）
2.  cp -a base_working_copy my_working_copy （以及其他需要它的人）
3.  cp -a base_working_copy my_branch
4.  cd my_branch
5.  将我的分支切换到任何分支 URL

我还成功地使用它向有带宽问题的人发送大型工作副本的 CD。

另见：[在一个非常大的网站上使用颠覆](https://stackoverflow.com/questions/174806/using-subversion-with-a-really-really-big-site)

# message-queue - 如何生成 Websphere MQ 脚本？

> ID：295403
> 
> 赞同：3
> 
> 时间：2008-11-17T11:53:15.653
> 
> 标签：message-queue, ibm-mq

很多时候，我使用“mqsc”从脚本文件创建 MQ 队列管理器，但我不知道如何生成脚本文件。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-02T16:39:58.533

有一个 SupportPac 安装了一个名为“saveqmgr.exe”的程序。

这是 Pac 的下载链接：http: [//shrinkster.com/17kc](http://shrinkster.com/17kc)

IBM 似乎经常重组其网站，因此如果您在很长一段时间后返回此处查看上述链接可能无法正常工作，但通过在 Websphere MQ 页面上搜索“saveqmgr”可以轻松找到 SupportPac。希望这可以帮助！

IBM 对 SupportPac 有这样的看法：

> **摘要** 此 SupportPac (saveqmgr) 将本地或远程队列管理器中定义的所有对象（例如队列、通道等）保存到文件中。
> 
> **下载说明** 此 SupportPac 询问定义到队列管理器（本地或远程）的所有对象的属性并将它们保存到文件中。
> 
> **可能的用途**此文件的格式适用于 runmqsc。因此，可以使用此 SupportPac 保存队列管理器已知的对象定义，然后重新创建该队列管理器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-30T13:41:53.530

saveqmgr 是生成代表现有队列管理器的脚本的常用方法。脚本文件只是包含与 runmqsc 一起使用的命令的文本文件，因此您也可以在文本编辑器中轻松地手动编写它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-27T04:27:51.443

如果您使用脚本解析 MQSC 文件，SupportPac [MO72: MQSC Client for WebSphere MQ](http://bit.ly/aPJ8tZ)是非常宝贵的。它在客户端或绑定模式下运行，作用类似于 runmqsc，但您也可以指定输出格式为一行。这使您可以提交类似的命令

```
DIS CHL(*) ALL 
```

...并且由于每个通道的输出有一行，因此您可以 grep 查找有趣的属性。查找连接到某个 IP 地址的所有通道变得非常容易。我通常从一个迭代所有 QMgrs 并执行 MQSC 代码的程序中驱动 MO72。这允许跨所有节点报告或批量更新。

# .net - 如何判断我的应用程序是否在 RDP 会话中运行

> ID：295415
> 
> 赞同：18
> 
> 时间：2008-11-17T11:56:41.233
> 
> 标签：.net, winforms, rdp

我有一个 .net winforms 应用程序，它有一些动画效果、淡入和滚动动画等。这些工作正常，但是如果我在远程桌面协议会话中，动画开始出现。

有人可以建议一种确定应用程序是否在 RDP 会话中运行的方法，以便我可以在这种情况下关闭效果吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-17T12:29:08.733

假设您至少使用 .NET Framework 2.0，则无需使用 P/Invoke：只需检查`System.Windows.Forms.SystemInformation.TerminalServerSession`( [MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.systeminformation.terminalserversession(VS.80).aspx) ) 的值。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T18:09:48.350

请参阅我问的类似问题：[如何检查我们是否正在使用电池运行？](https://stackoverflow.com/questions/241142/c-net-how-to-check-if-were-running-on-battery)

因为如果您使用电池运行，您还想禁用动画。

```
/// <summary>
/// Indicates if we're running in a remote desktop session.
/// If we are, then you MUST disable animations and double buffering i.e. Pay your taxes!
/// 
/// </summary>
/// <returns></returns>
public static Boolean IsRemoteSession
{
    //This is just a friendly wrapper around the built-in way
    get    
    {
        return System.Windows.Forms.SystemInformation.TerminalServerSession;    
    }
} 
```

然后检查您是否使用电池运行：

```
/// <summary>
/// Indicates if we're running on battery power.
/// If we are, then disable CPU wasting things like animations, background operations, network, I/O, etc
/// </summary>
public static Boolean IsRunningOnBattery
{
   get
   {
      PowerLineStatus pls = System.Windows.Forms.SystemInformation.PowerStatus.PowerLineStatus;
      if (pls == PowerLineStatus.Offline)
      {
         //Offline means running on battery
         return true;
      }
      else
      {
         return false;
      }
   }
} 
```

您可以将其组合成一个：

```
public Boolean UseAnimations()
{
   return 
      (!System.Windows.Forms.SystemInformation.TerminalServerSession) &&
      (System.Windows.Forms.SystemInformation.PowerStatus.PowerLineStatus != PowerLineStatus.Offline);
} 
```

* * *

**注意：**这个问题已经被问[过（确定程序是否在远程桌面上运行](https://stackoverflow.com/questions/159910/determine-if-a-program-is-running-on-a-remote-desktop#241176)）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T17:59:56.823

除了进行初始检查以查看您的桌面是否在 RDP 会话中运行，您可能还需要处理远程会话在您的应用程序运行时连接或断开连接的情况。您可以在控制台会话上运行一个应用程序，然后有人可以启动到控制台的 RDP 连接。除非您的应用程序定期调用 GetSystemMetrics，否则它将假定它没有作为终端服务会话运行。

您将让您的应用程序通过 WTSRegisterSessionNotification 注册会话更新通知。这将允许您的应用程序在远程连接已打开或关闭到您的应用程序正在运行的桌面会话时立即得到通知。有关一些示例 C# 代码，请参见[此处](http://pinvoke.net/default.aspx/wtsapi32.WTSRegisterSessionNotification "pinvoke.net: WTSRegisterSessionNotification (wtsapi32)")。

有关使用 WTSRegisterSessionNotification 的一些好的 Delphi Win32 示例代码，请参阅此[页面](http://www.swissdelphicenter.ch/torry/showcode.php?id=1109)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-17T12:06:53.007

使用 user32.dll 中的[GetSystemMetrics()](http://msdn.microsoft.com/en-us/magazine/cc164123.aspx)函数。使用[PInvoke](http://ttp://msdn.microsoft.com/en-us/library/ms724385.aspx)调用它。以下是第一个链接提供的示例代码。第二个链接告诉您如何在 .NET 中调用它。

```
 BOOL IsRemoteSession(void){
      return GetSystemMetrics( SM_REMOTESESSION );
   } 
```

完整代码：

```
[DllImport("User32.dll")]
static extern Boolean IsRemoteSession()
{
 return GetSystemMetrics ( SM_REMOTESESSION);
} 
```

还有一个`SystemInformation.TerminalServerSession`属性，它确定客户端是否连接到终端服务器会话。MSDN 提供的[代码](http://msdn.microsoft.com/en-us/library/system.windows.forms.systeminformation.terminalserversession(VS.80).aspx)比较丰富，这里不再赘述。

# string - 将整数格式化为 5 位数字的字符串

> ID：295417
> 
> 赞同：5
> 
> 时间：2008-11-17T11:57:22.527
> 
> 标签：string, asp-classic, integer, format

我需要一个基于整数的字符串，它应该总是有 5 位数字。

例子：

```
myInteger = 999
formatedInteger = "00999" 
```

在经典 ASP 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-17T12:09:56.150

您可以为此使用字符串操作函数。

这假定带有 VBScript 的经典 ASP（答案的原始版本）。

```
Const NUMBER_DIGITS = 5

Dim myInteger
Dim formatedInteger

myInteger = 999
formatedInteger = Right(String(NUMBER_DIGITS, "0") & myInteger, NUMBER_DIGITS) 
```

这是一个优化版本，包装在一个函数中，提供可变宽度填充：

```
Const NUMBER_PADDING = "000000000000" ' a few zeroes more just to make sure

Function ZeroPadInteger(i, numberOfDigits)
  ZeroPadInteger = Right(NUMBER_PADDING & i, numberOfDigits)
End Function

' Call in code:

strNumber = ZeroPadInteger(myInteger, 5) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T12:08:40.040

像这样的东西是我大部分时间看到的：

```
function PadNumber(number, width)
   dim padded : padded = cStr(number)

   while (len(padded) < width)
       padded = "0" & padded
   wend

   PadNumber = padded
end function

PadNumber(999, 5) '00999 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T15:02:54.723

试试这个单行（好吧，两个防止错误）：

```
function padZeroDigits(sVariable, iLength)
    if (iLength <= len(sVariable)) then padZeroDigits = sVariable : exit function : end if
    padZeroDigits = string(iLength - len(sVariable),"0") & sVariable
end function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T12:10:47.367

真的，你应该问自己为什么你可能想要这个。

如果这是出于显示目的，那么最好在显示点将字符串格式化函数（会有一个）应用于您的整数。

另一方面，如果您需要它进行内部处理，即您总是希望循环中有五位数字或其他什么，但您不希望对值进行算术运算，然后先将整数转换为字符串然后做任何处理。

简而言之，将整数变量转换为字符串并存储在一个新变量中，然后使用它。

# sql-server - SQL Server 2005 中的压缩备份

> ID：295419
> 
> 赞同：2
> 
> 时间：2008-11-17T11:57:55.007
> 
> 标签：sql-server, sql-server-2005, compression, backup

压缩维护计划生成的备份的最佳免费方法是什么？

我知道有非免费工具可以压缩备份，但我对它们不感兴趣。

选项：

1.  在备份之后有一个 T-SQL 任务，它将通过 xp_cmdshell 运行一个脚本，该脚本会压缩每个未压缩的备份。
2.  ？？？

欢迎任何其他想法，我想避免编写脚本/程序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-23T17:04:33.800

我是一个开源项目（GPL v3）的作者，这可能是您正在寻找的（虽然它不是基于维护计划的）。它是一个命令行工具（用于在 Windows 中的计划任务中进行计划）并备份到 gzip、zip（特别是 zip64，因为常规 zip 文件的 4GB 限制）或 bzip2 文件。您可以使用该工具直接从压缩文件中恢复，也可以解压缩压缩文件（标准 *.bak 文件）并使用 SQL Server 进行恢复。

It's called SQL Server Compressed Backup, found here: [http://sourceforge.net/projects/mssqlcompressed/](http://sourceforge.net/projects/mssqlcompressed/)

A sample command would be:

```
msbp.exe backup "db(database=model)" "zip64" "local(path=c:\model.full.bak.zip)" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T15:41:56.643

你需要三个组件。*调度程序*应该启动*备份*、*压缩*和其他步骤，例如将最终结果复制到文件服务器。您可以为每项任务选择您的工具，但我可以推荐我们基于[Cobian Backup](http://www.educ.umu.se/~cobian/cobianbackup.htm)的设置，该设置已经运行了几年。

*   调度程序：Cobian Backup

*   备份：[ExpressMaint](http://www.codeplex.com/ExpressMaint)（用于 MSSQL Express）

*   压缩：Cobian Backup

基本上，您使用 Cobian 设置备份计划，将 ExpressMaint 或其他 MSSQL 备份工具作为 Cobian “事件前”运行。Cobian 然后压缩结果并将其保存到目的地。

如果您打算在网络中移动它们和/或集中它们的存储，则需要压缩 SQL Server 备份文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T12:10:27.227

C:\Program Files\Support Tools>压缩/?

是一个用于压缩文件的命令行工具。

我不知道如何只压缩未压缩的文件，但您可能已经知道 T-SQL 任务中的文件名？

如果这样做，您可以将文件名作为参数传递给您的 xp_cmdshell 调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T12:05:05.333

我会按照您的建议在备份之后安排一项任务。另外，我相信 SQL2008（至少有一些版本）会进行压缩备份。

但是，如果您出于磁盘空间原因需要压缩备份，我建议您考虑更多存储空间。当然，除非您试图减小磁带传输的尺寸。

# javascript - 什么是最好的非所见即所得文本区域编辑器？

> ID：295421
> 
> 赞同：2
> 
> 时间：2008-11-17T11:58:36.627
> 
> 标签：javascript, jquery, html, editor, textarea

我正在尝试找到一个编辑器（或一些简单的 JavaScript - 最好是 jQuery），它允许我编辑文本区域的内容。

我不希望它是富文本或所见即所得；我只是希望能够选择一些文本，单击一个按钮/链接，并在突出显示的文本的任一侧定义一些简单的 HTML 标签。如果在文本区域中没有选择文本，我还希望能够在光标处插入空标签。本质上，我正在寻找类似于 Stack Overflow 文本编辑器，但用于自定义 HTML，而不是 Markdown。

我可以使用哪些选项？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T00:35:58.517

[BUEditor](http://ufku.com/drupal/bueditor)是您所描述的内容的流畅编辑器。它是为与 Drupal 一起使用而构建的，但[非 Drupal 使用](http://ufku.com/drupal/bueditor/non-drupal)的说明似乎相当清楚。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-20T14:07:31.087

看看[Markitup](http://markitup.jaysalvat.com/home/) - 它是一个基于 jQuery 的纯文本标记编辑器，非常可定制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T12:03:17.600

[这样](http://krijnhoetmer.nl/stuff/javascript/textarea/)的东西适合吗？我认为它只是`document.selection`用来识别插入标记的位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-20T13:46:50.350

我已经免费提供了我为我的 CMS 创建的[Byrst XHTML 编辑器](http://www.byrst.com.au/xhtml-editor/)

# automated-tests - 如何将多个测试对象从测试对象映射添加到脚本

> ID：295423
> 
> 赞同：0
> 
> 时间：2008-11-17T11:59:39.527
> 
> 标签：automated-tests, bulk

测试我必须自动化：在一个应用程序中我必须创建 1000 个对象。然后我必须去每个对象，我必须投入一些价值。

我使用脚本创建了一个对象，然后转到该对象并设置值。

现在在对象创建步骤中，我放置了一个 for 循环，它创建了 1000 个不同名称的对象。

现在使用 RFT 的“添加对象以测试地图对象”向导，我将所有这些对象添加到测试对象地图中。

现在我想将所有这些对象从测试对象映射添加到我的脚本中。使用 RFT 工具，我可以一一添加，这很耗时。我想要一种方法，通过它我可以从测试对象映射中选择所有这些对象并添加到脚本中。

如果您知道，请为我提供解决方案。为此，我会很感谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T04:37:44.817

您可以将对象定义存储在与 RFT 提供的本机对象映射不同的存储库形式中。然后您可以使用[TestObject.find](http://www-128.ibm.com/developerworks/rational/library/06/0711_nowacki_nodwell/)方法动态定位对象。

# visual-studio - 你能指定 VS 在调试移动应用程序时使用的文件夹吗？

> ID：295425
> 
> 赞同：0
> 
> 时间：2008-11-17T11:59:49.010
> 
> 标签：visual-studio, configuration, windows-mobile, compact-framework

点击调试会将应用程序部署到 \program files\AppNamespace\AppName.exe 并附加到它。但是，我的应用程序在存储卡 \SD-MMC 卡上运行。

这意味着我在不同的地方调试和运行，所以我有一个轻微的维护头痛。

因此问题是，任何人都知道您是否可以指定 VS 在调试时将使用的文件夹？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:22:24.763

那你为什么要从 \program files\AppNamespace\AppName.exe 调试呢？从实际目标位置进行调试。

项目属性->设备->输出文件夹

将其设置为“位置”=“根文件夹”，将“子目录”设置为“\SD-MMC 卡”。

此外，当您在 SO 上回复某人时，不要为此创建答案，请在他们的帖子中发表评论。

另请参阅[此问题](https://stackoverflow.com/questions/259032/deploying-an-application-to-windows-mobile-pocket-pc#259120)。

# java - Java/JCE：解密用 RSA 加密的“长”消息

> ID：295436
> 
> 赞同：2
> 
> 时间：2008-11-17T12:06:45.113
> 
> 标签：java, rsa, encryption, jce

我有一条消息包含在一个字节 [] 中，用“RSA/ECB/PKCS1Padding”加密。为了解密它，我创建了一个 Cipher c 并使用它启动它

```
c = Cipher.getInstance("RSA/ECB/PKCS1Padding"); 
```

到目前为止，我只使用*doFinal()*方法解密了小消息，返回一个带有解密字节的 byte[]。

```
c.init(Cipher.DECRYPT_MODE, privateKey);
byte[] decryptetBytes = c.doFinal(encryptedBytes); 
```

但在这种情况下，数据更大（大约 500 字节），并且*doFinal()*方法会引发异常（javax.crypto.IllegalBlockSizeException：数据不得超过 128 字节）。我想我需要使用*update()* - 方法，但我不知道如何让它正常工作。这是怎么做到的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-04-20T20:30:28.140

我认为将 RSA 加密用于除密钥传输之外的任何事情都是滥用。

为对称密码生成一个新密钥并用它加密您的批量数据。然后用 RSA 加密密钥。将对称加密的密文与非对称加密的内容加密密钥一起发送给您的收件人。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-19T06:53:32.297

使用 RSA，您只能加密/解密大小不超过您的密钥长度减去填充长度的块。如果您的数据比您的密钥长，则它可能只是合并到一个数组中，因此您应该将其拆分为具有密钥大小的块（128 字节表示没有填充的 1024 密钥，我不确定是否可能）。使用 update() 不是这里的情况。

简单地说，你必须知道这个数组是如何创建的。

一般来说，不应该使用 RSA 来加密大量数据，因为它非常耗时。应该用于将密钥加密为对称密码，如 AES。

看看这里： [https ://www.owasp.org/index.php/Digital_Signature_Implementation_in_Java](https://www.owasp.org/index.php/Digital_Signature_Implementation_in_Java)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-20T15:58:20.037

正如埃里克森所说，

您应该采取的加密步骤是：

1.  生成 RSA 密钥对（或从密钥库中检索公钥）
2.  生成对称密钥 (AES)
3.  使用 AES 密钥加密数据
4.  使用公共 RSA 密钥加密 AES 密钥
5.  存储（或发送给具有私钥的人）加密的 AES 密钥和 AES 加密数据

解密：

1.  获取与用于加密的密钥对关联的私钥
2.  用私钥解密 AES 密钥
3.  使用 AES 密钥解密数据
4.  使用数据

# python - 一个模拟/存根 python 模块如何像 urllib

> ID：295438
> 
> 赞同：75
> 
> 时间：2008-11-17T12:07:40.803
> 
> 标签：python, unit-testing, testing, mocking

我需要测试一个需要使用 urllib.urlopen 查询外部服务器上的页面的函数（它也使用 urllib.urlencode）。服务器可能已关闭，页面可能会更改；我不能依靠它进行测试。

控制 urllib.urlopen 返回的最佳方法是什么？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-11-17T12:32:42.953

另一种简单的方法是让您的测试覆盖 urllib 的`urlopen()`函数。例如，如果您的模块有

```
import urllib

def some_function_that_uses_urllib():
    ...
    urllib.urlopen()
    ... 
```

你可以这样定义你的测试：

```
import mymodule

def dummy_urlopen(url):
    ...

mymodule.urllib.urlopen = dummy_urlopen 
```

然后，当您的测试调用 , 中的函数时`mymodule`，`dummy_urlopen()`将调用而不是真正的`urlopen()`. 像 Python 这样的动态语言使得为测试提取方法和类变得非常容易。

[请参阅我在http://softwarecorner.wordpress.com/](http://softwarecorner.wordpress.com/)上的博客文章，了解有关为测试排除依赖关系的更多信息。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2010-03-06T15:31:31.283

我正在使用[Mock 的](http://www.voidspace.org.uk/python/mock/)补丁装饰器：

```
from mock import patch

[...]

@patch('urllib.urlopen')
def test_foo(self, urlopen_mock):
    urlopen_mock.return_value = MyUrlOpenMock() 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-11-17T12:49:46.103

你给[莫克斯](https://pypi.python.org/pypi/mox)看了吗？它应该做你需要的一切。这是一个简单的交互式会话，说明了您需要的解决方案：

```
>>> import urllib
>>> # check that it works
>>> urllib.urlopen('http://www.google.com/')
<addinfourl at 3082723820L ...>
>>> # check what happens when it doesn't
>>> urllib.urlopen('http://hopefully.doesnotexist.com/')
#-- snip --
IOError: [Errno socket error] (-2, 'Name or service not known')

>>> # OK, let's mock it up
>>> import mox
>>> m = mox.Mox()
>>> m.StubOutWithMock(urllib, 'urlopen')
>>> # We can be verbose if we want to :)
>>> urllib.urlopen(mox.IgnoreArg()).AndRaise(
...   IOError('socket error', (-2, 'Name or service not known')))

>>> # Let's check if it works
>>> m.ReplayAll()
>>> urllib.urlopen('http://www.google.com/')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python2.5/site-packages/mox.py", line 568, in __call__
    raise expected_method._exception
IOError: [Errno socket error] (-2, 'Name or service not known')

>>> # yay! now unset everything
>>> m.UnsetStubs()
>>> m.VerifyAll()
>>> # and check that it still works
>>> urllib.urlopen('http://www.google.com/')
<addinfourl at 3076773548L ...> 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-11-08T20:01:37.407

[HTTPretty](https://github.com/gabrielfalcao/HTTPretty)的工作方式与 FakeWeb 完全相同。HTTPretty 在套接字层工作，因此它应该可以拦截任何 python http 客户端库。它针对 urllib2、httplib2 和请求进行了实战测试

```
import urllib2
from httpretty import HTTPretty, httprettified

@httprettified
def test_one():
    HTTPretty.register_uri(HTTPretty.GET, "http://yipit.com/",
                           body="Find the best daily deals")

    fd = urllib2.urlopen('http://yipit.com')
    got = fd.read()
    fd.close()

    assert got == "Find the best daily deals" 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-07-11T00:12:41.583

如果您甚至不想加载模块：

```
import sys,types
class MockCallable():
  """ Mocks a function, can be enquired on how many calls it received """
  def __init__(self, result):
    self.result  = result
    self._calls  = []

  def __call__(self, *arguments):
    """Mock callable"""
    self._calls.append(arguments)
    return self.result

  def called(self):
    """docstring for called"""
    return self._calls

class StubModule(types.ModuleType, object):
  """ Uses a stub instead of loading libraries """

  def __init__(self, moduleName):
    self.__name__ = moduleName
    sys.modules[moduleName] = self

  def __repr__(self):
    name  = self.__name__
    mocks = ', '.join(set(dir(self)) - set(['__name__']))
    return "<StubModule: %(name)s; mocks: %(mocks)s>" % locals()

class StubObject(object):
  pass 
```

进而：

```
>>> urllib = StubModule("urllib")
>>> import urllib # won't actually load urllib

>>> urls.urlopen = MockCallable(StubObject())

>>> example = urllib.urlopen('http://example.com')
>>> example.read = MockCallable('foo')

>>> print(example.read())
'foo' 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-17T12:23:30.413

处理此问题的最佳方法可能是拆分代码，以便处理页面内容的逻辑与获取页面的代码分开。

然后将 fetcher 代码的实例传递给处理逻辑，然后您可以轻松地将其替换为模拟 fetcher 以进行单元测试。

例如

```
class Processor(oject):
    def __init__(self, fetcher):
        self.m_fetcher = fetcher

    def doProcessing(self):
        ## use self.m_fetcher to get page contents

class RealFetcher(object):
    def fetchPage(self, url):
        ## get real contents

class FakeFetcher(object):
    def fetchPage(self, url):
        ## Return whatever fake contents are required for this test 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-17T12:26:06.337

最简单的方法是更改​​您的函数，使其不必使用 urllib.urlopen。假设这是您的原始功能：

```
def my_grabber(arg1, arg2, arg3):
    # .. do some stuff ..
    url = make_url_somehow()
    data = urllib.urlopen(url)
    # .. do something with data ..
    return answer 
```

添加一个参数，该参数是用于打开 URL 的函数。然后你可以提供一个模拟函数来做你需要的任何事情：

```
def my_grabber(arg1, arg2, arg3, urlopen=urllib.urlopen):
    # .. do some stuff ..
    url = make_url_somehow()
    data = urlopen(url)
    # .. do something with data ..
    return answer

def test_my_grabber():
    my_grabber(arg1, arg2, arg3, urlopen=my_mock_open) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-01-25T10:03:24.247

添加到克林特米勒的答案，要做到这一点，我必须创建一个实现读取方法的假类，如下所示：

```
class FakeURL:
    def read(foo):
        return '{"some":"json_text"}' 
```

然后存根 urllib2.open：

```
# Stub out urllib2.open.
def dummy_urlopen(foo, bar, baz):
  return FakeURL()
urllib2.urlopen = dummy_urlopen 
```

# sharepoint - Sharepoint：如何过滤文档库视图以显示子文件夹的内容？

> ID：295448
> 
> 赞同：15
> 
> 时间：2008-11-17T12:12:15.413
> 
> 标签：sharepoint, filter, subdirectory

我使用的许多业务领域使用文件夹结构来组织他们的 Sharepoint 托管文档（我知道这并不理想，但我们坚持使用它）。

我想使用 Web 部件页面根据文档所在的子文件夹来呈现他们文档库的多个视图，但这比我想象的要困难得多。过去有没有人克服过这个问题？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-07-19T17:30:33.240

使用 Sharepoint Designer，您可以编辑 XSLT 列表视图的 CAML。

如果将 View 元素的 Scope 属性设置为*Recursive*或*RecursiveAll*，这将返回所有文件和文件夹，则可以通过*FileDirRef*过滤文档：

```
<Where>
   <Contains>
      <FieldRef Name='FileDirRef' />
      <Value Type='Lookup'>MyFolder</Value>
   </Contains>
</Where> 
```

这将返回路径中包含字符串“MyFolder”的所有文档。

我在[http://platinumdogs.wordpress.com/2009/07/21/querying-document-libraries-or-pulling-teeth-with-caml/上找到了有关此的信息，并在](http://platinumdogs.wordpress.com/2009/07/21/querying-document-libraries-or-pulling-teeth-with-caml/)[http://blog](http://blog.thekid.me.uk/archive/2007/03/21/wss-field-display-amp-internal-names-for-lists-amp-document-libraries.aspx)上找到了有关字段的有用信息。 [thekid.me.uk/archive/2007/03/21/wss-field-display-amp-internal-names-for-lists-amp-document-libraries.aspx](http://blog.thekid.me.uk/archive/2007/03/21/wss-field-display-amp-internal-names-for-lists-amp-document-libraries.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-25T03:51:14.997

Have you thought about creating a view with 'Folder = Show all items without folders', that would get all your documents out of their folders and then perhaps you could create your filter(s) over that view.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T01:56:40.193

按类型查看内容 web 部件 - [http://codeplex.com/eoffice](http://codeplex.com/eoffice) - 可能是最灵活的查看 web 部件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-28T15:44:39.573

使用页面查看器 webpart 并从网页切换到文件夹。您可以指定要在链接中显示的文件夹。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T17:21:28.363

视图中需要什么样的文档库信息？您希望用户如何过滤视图？

通常，在 sharepoint 中创建视图的最强大方法是使用数据视图 Web 部件。 [http://office.microsoft.com/en-us/sharepointdesigner/HA100948041033.aspx](http://office.microsoft.com/en-us/sharepointdesigner/HA100948041033.aspx)

您将需要 Microsoft Office SharePoint Designer。

您可以使用数据视图过滤器和排序控件呈现文件夹的不同视图。

您可以使用 Web 部件连接来筛选数据视图。您可以使用任何链接到下拉菜单的数据源来过滤数据视图。 [如何将下拉列表绑定到 Sharepoint 2007 中的网格视图？](https://stackoverflow.com/questions/177076/how-to-tie-a-dropdown-list-to-a-gridview-in-sharepoint-2007)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-28T15:39:52.290

我不知道任何开箱即用的方法来实现这一点。正如您所说，这不是 SharePoint 列表的预期使用方式。创建一个显示文档路径的自定义网站栏可能会起作用，因为这可能会在过滤器中使用。不过，从未尝试过。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-03T19:09:42.487

您还可以使用“TreeValue”、“TreeField”和“RootFolder”直接链接到文件夹中的视图。

例子：

```
http://sharepoint/Docs/YourLibrary/Forms/YourView.aspx?RootFolder=MyFolder&TreeField=Folders&TreeValue=MyFolder 
```

进一步解释：我有一个 SharePoint 网站，其中包含一个名为 YourLibrary 的文档库。我有一个名为 MyFolder 的文件夹。我创建了一个视图，可以在该库结构的任何级别使用 YourView.aspx 的 URL 路径使用该链接，它将带我到我创建的视图，其中包含所有过滤器和样式，但仅显示结果将出现在 RootFolder 和 TreeValue 中该文件夹的内容中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-03-23T17:57:27.037

试试这个，选择或创建一列并设置该值，以便始终填充它，例如标题。不包含文件夹名称的字段。然后在您的过滤器中放置您想要的过滤器，它将仅选择您想要的文件。然后将或添加到您的过滤器，选择您的“必填”字段，然后将其设置为等于并将过滤器留空。由于所有文件夹在此必填字段中都有空白，因此您的文件夹将与您的文件一起显示。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-02-17T05:48:26.980

在 SP2013 Online 中，我尝试过滤条件为`Name` `Contains` `Folder_I_want_to_list`

这向我显示`Name`了文件路径中包含的所有文件夹。它甚至列出了我尝试时不可用的子文件夹内容`Name` `equal to` `Folder_I_want_to_list`

# db2 - 我们如何在 db2 中执行 DBMS OUTPUT 行（就像在 oracle 中一样）

> ID：295455
> 
> 赞同：1
> 
> 时间：2008-11-17T12:16:43.003
> 
> 标签：db2

在 Oracle 中，我们可以打印输出，`dbms_output.put_line()`但我不知道在 DB2 中做同样的事情。

我目前`signal`用于在调试时打印一些消息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T03:48:28.190

您可以将一行存储在永久调试表或已声明的全局临时表 (DGTT) 中。您还可以编写一个简单的 Java 存储过程，将一行文本存储到一个文件中。

当 DB2 9.7 发布时（2009 年 6 月的某个时间），它将自动附带 dbms_output 特性，作为 DB2 新的“SQL 方言”支持（也称为 Oracle 兼容性）的一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-08T12:41:02.460

你可以做：

```
select 'message' from sysibm.sysdummy1; 
```

# clojure - Clojure 中的漂亮打印

> ID：295458
> 
> 赞同：20
> 
> 时间：2008-11-17T12:17:21.533
> 
> 标签：clojure

Clojure 中是否有一个漂亮的打印功能，可以以人类可读的方式输出列表和结构等数据结构？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-01-30T11:35:00.157

正如 Chouser 所提到的，在 1.3 中 pprint 被移动到 clojure 本身。

[http://clojure.github.io/clojure/clojure.pprint-api.html#clojure.pprint/pprint](http://clojure.github.io/clojure/clojure.pprint-api.html#clojure.pprint/pprint)

您可以 (:require clojure.pprint) 并开始使用它。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-04-20T23:14:25.130

clojure-contrib 现在有一个 pprint 函数。

API 文档位于[http://richhickey.github.com/clojure-contrib/pprint-api.html](http://richhickey.github.com/clojure-contrib/pprint-api.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-20T10:59:04.463

Clojure 的漂亮打印机可[在此处](http://github.com/tomfaulhaber/cl-format/tree/master)获得。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-19T22:49:08.420

[昨天Clojure 邮件列表上](http://groups.google.com/group/clojure/browse_thread/thread/79d07b898b2a0fde/1a8470fc8df44b1d)有一篇文章，其中一些人发布了一些漂亮打印机的试用实现。但正如[mipadi](https://stackoverflow.com/users/28804/mipadi)所说，它还没有最终确定。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-17T12:48:11.613

还*没有*，但是这个特性已经被几个接近 Clojure 的人讨论过并且（大概）正在开发中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T15:02:11.170

正如其他人所说，计划但不完整。当 clojure.contrib.pprint 被移动到 clojure 本身时，更新将被发布到它的[ticket](http://www.assembla.com/spaces/clojure/tickets/20)中。

# python - 如何使用 subprocess.Popen 通过管道连接多个进程？

> ID：295459
> 
> 赞同：69
> 
> 时间：2008-11-17T12:17:49.223
> 
> 标签：python, pipe, subprocess

如何使用 Python[`subprocess`](https://docs.python.org/library/subprocess.html)模块执行以下 shell 命令？

```
echo "input data" | awk -f script.awk | sort > outfile.txt 
```

输入数据将来自一个字符串，所以我实际上并不需要`echo`. 我已经走了这么远，谁能解释我如何让它通过管道`sort`？

```
p_awk = subprocess.Popen(["awk","-f","script.awk"],
                          stdin=subprocess.PIPE,
                          stdout=file("outfile.txt", "w"))
p_awk.communicate( "input data" ) 
```

**更新**：请注意，虽然下面接受的答案实际上并未按要求回答问题，但我相信 S.Lott 是正确的，最好避免首先解决该问题！

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-11-17T13:32:13.787

您会对以下内容更满意。

```
import subprocess

awk_sort = subprocess.Popen( "awk -f script.awk | sort > outfile.txt",
    stdin=subprocess.PIPE, shell=True )
awk_sort.communicate( b"input data\n" ) 
```

将部分工作委托给 shell。让它通过管道连接两个进程。

你会更高兴将“script.awk”重写为 Python，消除 awk 和管道。

**编辑**. 建议 awk 没有帮助的一些原因。

[有太多理由通过评论回复。]

1.  awk 正在添加一个没有重要价值的步骤。awk 的处理没有什么是 Python 无法处理的独特之处。

2.  对于大型数据集，从 awk 到排序的流水线可能会缩短处理时间。对于短数据集，它没有显着的好处。快速测量`awk >file ; sort file`并`awk | sort`揭示并发性会有所帮助。使用排序，它很少有帮助，因为排序不是一次性过滤器。

3.  “Python to sort”处理（而不是“Python to awk to sort”）的简单性可以防止在这里提出确切的问题。

4.  Python - 虽然比 awk 更冗长 - 也是明确的，其中 awk 具有某些对新手不透明的隐含规则，并且让非专业人士感到困惑。

5.  awk（就像 shell 脚本本身）添加了另一种编程语言。如果所有这些都可以用一种语言（Python）完成，那么消除 shell 和 awk 编程就消除了两种编程语言，从而使人们可以专注于任务中产生价值的部分。

底线：awk 不能增加显着的价值。在这种情况下，awk 是净成本；它增加了足够的复杂性，因此有必要提出这个问题。删除 awk 将是一个净收益。

**侧边栏**为什么构建管道 ( `a | b`) 如此困难。

当外壳遇到它时，`a | b`它必须执行以下操作。

1.  fork 原始 shell 的子进程。这最终会变成b。

2.  构建一个 os 管道。（不是 Python subprocess.PIPE），而是`os.pipe()`返回两个通过公共缓冲区连接的新文件描述符的调用。此时，该进程具有来自其父级的标准输入、标准输出、标准错误，以及一个将是“a 的标准输出”和“b 的标准输入”的文件。

3.  叉一个孩子。孩子用新的 a 的标准输出替换它的标准输出。执行`a`流程。

4.  b 子关闭用新 b 的标准输入替换其标准输入。执行`b`流程。

5.  b 孩子等待 a 完成。

6.  父母正在等待 b 完成。

我认为上面可以递归地用于 spawn `a | b | c`，但是你必须隐式地用括号括起来长管道，把它们当作`a | (b | c)`.

由于 Python 有`os.pipe()`,`os.exec()`和`os.fork()`, 并且您可以替换`sys.stdin`and `sys.stdout`，所以有一种方法可以在纯 Python 中完成上述操作。实际上，您可以使用`os.pipe()`和来计算一些快捷方式`subprocess.Popen`。

但是，将该操作委托给 shell 会更容易。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2012-02-06T17:20:01.037

```
import subprocess

some_string = b'input_data'

sort_out = open('outfile.txt', 'wb', 0)
sort_in = subprocess.Popen('sort', stdin=subprocess.PIPE, stdout=sort_out).stdin
subprocess.Popen(['awk', '-f', 'script.awk'], stdout=sort_in, 
                 stdin=subprocess.PIPE).communicate(some_string) 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2013-05-23T09:01:24.997

要模拟 shell 管道：

```
from subprocess import check_call

check_call('echo "input data" | a | b > outfile.txt', shell=True) 
```

不调用 shell（参见[17.1.4.2\. 替换 shell 管道](http://docs.python.org/2.7/library/subprocess.html#replacing-shell-pipeline)）：

```
#!/usr/bin/env python
from subprocess import Popen, PIPE

a = Popen(["a"], stdin=PIPE, stdout=PIPE)
with a.stdin:
    with a.stdout, open("outfile.txt", "wb") as outfile:
        b = Popen(["b"], stdin=a.stdout, stdout=outfile)
    a.stdin.write(b"input data")
statuses = [a.wait(), b.wait()] # both a.stdin/stdout are closed already 
```

[`plumbum`](http://plumbum.readthedocs.org/en/latest/)提供了一些语法糖：

```
#!/usr/bin/env python
from plumbum.cmd import a, b # magic

(a << "input data" | b > "outfile.txt")() 
```

的模拟：

```
#!/bin/sh
echo "input data" | awk -f script.awk | sort > outfile.txt 
```

是：

```
#!/usr/bin/env python
from plumbum.cmd import awk, sort

(awk["-f", "script.awk"] << "input data" | sort > "outfile.txt")() 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-12-09T00:09:20.220

公认的答案是回避这个问题。这是一个链接多个进程的输出的片段：请注意，它还打印（有点）等效的 shell 命令，因此您可以运行它并确保输出正确。

```
#!/usr/bin/env python3

from subprocess import Popen, PIPE

# cmd1 : dd if=/dev/zero bs=1m count=100
# cmd2 : gzip
# cmd3 : wc -c
cmd1 = ['dd', 'if=/dev/zero', 'bs=1M', 'count=100']
cmd2 = ['tee']
cmd3 = ['wc', '-c']
print(f"Shell style : {' '.join(cmd1)} | {' '.join(cmd2)} | {' '.join(cmd3)}")

p1 = Popen(cmd1, stdout=PIPE, stderr=PIPE) # stderr=PIPE optional, dd is chatty
p2 = Popen(cmd2, stdin=p1.stdout, stdout=PIPE)
p3 = Popen(cmd3, stdin=p2.stdout, stdout=PIPE)

print("Output from last process : " + (p3.communicate()[0]).decode())

# thoretically p1 and p2 may still be running, this ensures we are collecting their return codes
p1.wait()
p2.wait()
print("p1 return: ", p1.returncode)
print("p2 return: ", p2.returncode)
print("p3 return: ", p3.returncode) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-17T12:26:50.890

[http://www.python.org/doc/2.5.2/lib/node535.html](http://web.archive.org/web/20081222144252/http://www.python.org/doc/2.5.2/lib/node535.html)很好地涵盖了这一点。这其中有没有你不明白的部分？

您的程序将非常相似，但是第二个程序`Popen`将 stdout= 指向文件，并且您不需要其`.communicate()`.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-02-10T10:50:04.947

受到@Cristian 回答的启发。我遇到了同样的问题，但使用了不同的命令。所以我把我测试过的例子，我相信这可能会有所帮助：

```
grep_proc = subprocess.Popen(["grep", "rabbitmq"],
                             stdin=subprocess.PIPE, 
                             stdout=subprocess.PIPE)
subprocess.Popen(["ps", "aux"], stdout=grep_proc.stdin)
out, err = grep_proc.communicate() 
```

这是经过测试的。

## 做了什么

*   `grep`使用管道中的标准输入声明延迟执行。该命令将在`ps`命令执行时执行，此时管道将被`ps`.
*   调用主命令`ps`，标准输出指向命令使用的管道`grep`。
*   Grep 进行通信以从管道中获取标准输出。

我喜欢这种方式，因为它是用`subprocess`接口轻轻包裹的自然管道概念。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-11-18T15:50:43.897

之前的答案错过了一个重要的点。正如geocar所指出的，[更换shell管道基本上是正确的。](https://docs.python.org/2/library/subprocess.html#replacing-shell-pipeline)在管道的最后一个元素上运行*几乎*就足够了。`communicate`

剩下的问题是将**输入数据**传递到管道。对于多个子流程，`communicate(input_data)`最后一个元素上的简单操作不起作用 - 它永远挂起。您需要像这样手动创建一个管道和一个孩子：

```
import os
import subprocess

input = """\
input data
more input
""" * 10

rd, wr = os.pipe()
if os.fork() != 0: # parent
    os.close(wr)
else:              # child
    os.close(rd)
    os.write(wr, input)
    os.close(wr)
    exit()

p_awk = subprocess.Popen(["awk", "{ print $2; }"],
                         stdin=rd,
                         stdout=subprocess.PIPE)
p_sort = subprocess.Popen(["sort"], 
                          stdin=p_awk.stdout,
                          stdout=subprocess.PIPE)
p_awk.stdout.close()
out, err = p_sort.communicate()
print (out.rstrip()) 
```

现在子进程通过管道提供输入，父进程调用communication()，按预期工作。使用这种方法，您可以创建任意长的管道，而无需求助于“将部分工作委托给 shell”。不幸的是，[子流程文档](https://docs.python.org/2/library/subprocess.html)没有提到这一点。

有一些方法可以在没有管道的情况下达到相同的效果：

```
from tempfile import TemporaryFile
tf = TemporaryFile()
tf.write(input)
tf.seek(0, 0) 
```

现在`stdin=tf`使用`p_awk`. 这是你喜欢什么口味的问题。

以上仍然不是 100% 等效于 bash 管道，因为信号处理不同。如果您添加另一个截断输出的管道元素`sort`，例如，您可以看到这一点`head -n 10`。使用上面的代码，`sort`将打印“Broken pipe”错误消息到`stderr`. 当您在 shell 中运行相同的管道时，您不会看到此消息。（这是唯一的区别，结果`stdout`是一样的）。原因似乎是 python 的`Popen`设置`SIG_IGN`为`SIGPIPE`，而 shell 将其设置为`SIG_DFL`， 和`sort`的信号处理在这两种情况下是不同的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-12-04T18:51:58.210

**编辑：** `pipes`在 Windows 上可用，但至关重要的是，它似乎并不能在 Windows 上实际*工作*。请参阅下面的评论。

Python 标准库现在包含`pipes`用于处理此问题的模块：

[https://docs.python.org/2/library/pipes.html](https://docs.python.org/2/library/pipes.html) , [https://docs.python.org/3.4/library/pipes.html](https://docs.python.org/3.4/library/pipes.html)

我不确定这个模块已经存在了多久，但这种方法似乎比使用`subprocess`.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-10T21:00:09.337

对我来说，下面的方法是最干净、最容易阅读的

```
from subprocess import Popen, PIPE

def string_to_2_procs_to_file(input_s, first_cmd, second_cmd, output_filename):
    with open(output_filename, 'wb') as out_f:
        p2 = Popen(second_cmd, stdin=PIPE, stdout=out_f)
        p1 = Popen(first_cmd, stdout=p2.stdin, stdin=PIPE)
        p1.communicate(input=bytes(input_s))
        p1.wait()
        p2.stdin.close()
        p2.wait() 
```

可以这样调用：

```
string_to_2_procs_to_file('input data', ['awk', '-f', 'script.awk'], ['sort'], 'output.txt') 
```

# xml - 如何从我的 xml 文件中删除 BOM 字符

> ID：295472
> 
> 赞同：68
> 
> 时间：2008-11-17T12:27:01.123
> 
> 标签：xml, xslt, unicode, byte-order-mark

我正在使用 xsl 来控制我的 xml 文件的输出，但是正在添加 BOM 字符。

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2008-11-18T22:59:37.027

```
# vim file.xml
:set nobomb
:wq 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-05T16:40:46.967

只需将其添加到您的 xslt 文件中：

```
<xsl:output method="text"
        encoding="ASCII"/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T12:48:02.923

只需使用任何十六进制编辑器剥离前两个字节。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-25T11:04:12.510

使用 XSLT 从字符串中删除 BOM 符号非常简单：

`<xsl:value-of select="translate(StringWithBOM,'','')"/>`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T23:19:27.097

您的 XSL 设置使用什么输出编码？输入文档是什么编码？输入来自哪里，同时在哪里保存/上传/下载？

如果没有指定其他内容，XML 和 XSL 应该*默认使用 UTF-8。*但很明显，这里出了点问题。

可能发生的一件事是，XML 正在由 Web 服务器提供服务，该服务器默认设置为在 ISO-8859-1 中提供服务，这是一个非常好的默认设置...... pre-Unicode。

有点离题，但[Joel](http://www.joelonsoftware.com/articles/Unicode.html)关于文本编码的非常有启发性的文章让我大开眼界。有很多人在编程方面非常聪明，但他们坚持认为存在诸如“纯文本”之类的东西，或者称他们的文本为“ASCII”或“ANSI”。如果您还没有解决这个问题，那么您确实需要解决这个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T12:58:00.500

我的印象是鼓励以 Unicode 和某些 Unicode 编码来编写 XML，并且某些 Unicode 编码被指定为包含初始字节顺序标记。如果没有该字节顺序标记，您的文件将不再以 Unicode 编码正确编码，因此不再正确的 XML。鼓励 XML 处理器不宽容，在最轻微的错误（例如不正确的 Unicode 编码）上立即失败。您希望破解哪些类型的 XML 处理器？

显然，从 UTF-8 编码的文档中去除字节顺序标记会使该文档看起来是 ASCII 编码的（不是 Unicode），并且一些文本处理器只能使用 ASCII 编码的文档。这是你的工作吗？

# asp.net-2.0 - 如何使用 ASP.NET 修复我的 HTTP 处理程序和不同的主机标头？

> ID：295476
> 
> 赞同：1
> 
> 时间：2008-11-17T12:27:46.630
> 
> 标签：asp.net-2.0, httphandler

当站点与 URL 一起使用时，**test.com**处理程序不会被触发。然而，如果该站点与**www.test.com**一起使用，处理程序是否可以正常工作？该站点位于 ISA 防火墙后面。我应该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T12:54:42.957

[Scott Gu 的博客 http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx](http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx)对 URL 重写进行了广泛的讨论

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T13:50:37.680

确保 DNS 将两个主机名都解析为 ISA 服务器的 IP 地址。

确保将 ISA 服务器配置为将两个 URL 都路由到您的服务器。

配置您的网站（IIS 5/6：属性、网站、高级、添加）以接受额外的主机标头。

考虑将 ISA 服务器配置为仅永久重定向到其中一个 URL。这也可以通过 IIS 中的附加网站来实现。

# c++ - T4 模板 - 适合生成 C++ 代码？

> ID：295506
> 
> 赞同：7
> 
> 时间：2008-11-17T12:52:29.560
> 
> 标签：c++, code-generation, t4, template-engine

是否有任何问题可能使 MS 的 T4 模板代码生成系统不适合生成 C++ 代码？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2013-02-09T08:13:45.980

*有点冗长的答案，但我认为有些人可能会觉得它很有趣*

我会说 T4 非常适合生成 C++

有些人可能会反驳说 C++ 已经有工具来进行元编程，比如：

**预处理器**

使用预处理器和高阶宏，您可以在一定程度上实现使用 T4 可以做的事情，但我说 T4 有一些非常令人信服的好处：

1.  从 T4 生成的代码易于调试和理解
2.  使用 T4 进行元编程比使用预处理器更简单。预处理器可以很容易地完成像 max/min 这样的宏，但是当我们谈论模型驱动的模板时，它变得很困难
3.  T4 比预处理器更强大，更容易开发模板
4.  T4 可以作为构建过程的一部分或按需执行

**部分模板专业化**

我确实喜欢部分模板专业化技巧，但我从经验中说并不是每个人都喜欢维护它们。

我一直努力减少代码冗余以提高可维护性。此外，如果可能，我更喜欢编译时错误而不是运行时错误。因此，在阅读了 Andrei Alexandrescu 的 Modern C++ 之后，我想我找到了*答案*。

我写了一个受这本书启发的组件，效果很好，然后我去度假了。当我回来时，团队已经扔掉了组件并使用传统技术重写了他们自己的组件。它包含更多代码，错误更多并且性能不佳，但是他们无法弄清楚如何将功能添加到我编写的组件中，并确定他们必须这样做。没有什么可以挽救的。这些人也是聪明人。

他们这样做有错吗？就可维护性而言，我会说他们做出了正确的选择，尽管这让我感到难过。

我对这个轶事的看法是，T4 比部分模板专业化技巧有一些好处：

1.  从 T4 生成的代码易于调试和理解
2.  T4更简单
3.  T4更强大
4.  T4 可以在构建过程的一部分或按需执行
5.  如果维护人员无法理解 T4 模板，他们仍然可以挽救代码（开始维护生成的代码并丢弃模板）。这在上面的轶事中是不可能的。

当然，在 C++ 中，元编程是预处理器和部分模板专业化的组合。

**缺点**

T4当然有缺点；

1.  它是 Visual Studio 特定的（或 Mono 特定的）。然而，生成的代码当然可以被 GCC 和其他人编译。
2.  这是非标准的
3.  Visual Studio C++ 项目似乎不支持 T4，这迫使我使用一个虚拟的 .NET 项目来生成代码。

**包起来**

总而言之，我对使用 PreProcessor 或类型系统的花哨技巧（尽管我确实将它们用于更简单的任务）进行高级 MetaProgramming C++ 失去了兴趣，并且这些天依赖于 T4。

如果有人对如何在 C++ 中执行此操作的示例感兴趣，您可以查看[InteractiveGraphics](https://github.com/mrange/InteractiveGraphics)。它是一个用于 C#、VB、PowerShell 和 SmallBasic 的库，用于在其中执行简单的图形。我使用 T4 生成所有 API 和样板代码，用于在 .NET 和 C++ 之间传递消息（如果可以避免的话，我不使用 C++/CLI all) 来自描述 API 的模型。添加一个新方法就像扩展模型和重新生成所有模板文件一样简单，然后我在 C++ 中实现一个抽象方法并做一些有趣的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T18:15:27.033

它可以生成您想要的任何文本，包括 C++ 代码。

# delphi - 如何从 Delphi 将 GUID 设置为 ADO 查询参数？

> ID：295511
> 
> 赞同：4
> 
> 时间：2008-11-17T12:53:55.017
> 
> 标签：delphi, guid, ado

MS Access 允许在数据库中存储为 16 字节二进制字段的数字类型 GUID（在德语中称为“Replikations-ID”，所以我猜在英语中将是“replication id”）。

我发现如何使用 TADOQuery / TADOTable 在 Delphi中[**访问**](http://docwiki.embarcadero.com/Libraries/Tokyo/en/Data.Win.ADODB.TADOQuery)这些[**字段**](http://docwiki.embarcadero.com/Libraries/Tokyo/en/Data.Win.ADODB.TADOTable)

```
(TheQuery.FieldByName('SomeGuidField') as TGUIDField).AsGuid; 
```

但现在我想执行这样的 SQL 查询：

```
SELECT * FROM SomeTable WHERE SomeGuidField=:AGuid 
```

我尝试为上述语句设置一个[**TADOQuery.SQL**](http://docwiki.embarcadero.com/Libraries/Tokyo/en/Data.Win.ADODB.TADOQuery.SQL)属性，但没有找到实际设置`AGuid`参数以便可以打开查询的方法。无论我尝试什么都会导致（ADO/COM）错误

> 没有为一个或多个必需参数指定值

例如：

```
TheQuery.ParamByName('AGuid').Value := QuotedString(GuidToStr(AGuid));
TheQuery.Open; // <<== crashes here 
```

这也不起作用：

```
TheQuery.ParamByName('AGuid').Value := GuidToStr(AGuid);
TheQuery.Open; // <<== crashes here 
```

我查看了`TGuidField(...).AsGuid`它的工作原理，发现它首先将 GUID 转换为字符串，然后将字符串转换为变体（反之亦然）。

如果我总是像这样生成 SQL 语句，它工作正常：

```
SELECT * FROM SomeTable WHERE SomeGuidField='<a guid goes here>' 
```

当我在程序中传递该**TADOQuery**对象时，我只想更改`AGuid`-Parameter 以使大多数方法与实际的 SQL 语句无关。

除了总是更改完整的 SQL 语句之外，还有其他方法可以设置 GUID 参数吗？

（它必须是一个 GUID，因为我需要一个全局唯一标识符来与基于 MS SQL 或 MS Access 的其他数据库同步。）

**编辑** vradmilovic 是对的，这有效：

```
TheQuery.ParamByName('AGuid').Value := GuidToStr(AGuid);
TheQuery.Open; 
```

我不明白为什么我第一次尝试它时它不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T13:40:41.320

这是使用 ADO 设置参数的正确方法。您收到的消息很可能是由于某些字段的拼写错误（如果字段不存在，您会收到相同的消息）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-18T12:41:30.130

值得我使用 GUID，但我将它们作为字符串保存在数据库中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-28T08:41:23.777

您不应该将它们保存为字符串。您应该使用唯一标识符。要使用的两个函数是 GUIDToString 和 StringToGUID（不是 str-ones）。

如果您从活动目录中复制值（以 ftVarBytes 的形式出现），您可以使用 assign 为您带来魔力：

```
QueryIns.Parameters.ParamByName('GUID').Assign(Query.FieldByName('objectGUID')); 
```

如果要从 AD 中提取 objectGUID，则需要将 objectGUID 转换为 uniqueidentifier：

```
Query.SQL.Add('select cast(objectGUID as uniqueidentifier) as objectGUID');
Query.SQL.Add('from vwADGroups');
Query.Open;
while not Query.Eof do begin
  Index := List.IndexOfName(Query.FieldByName('objectGUID').AsString);
  //...
end; 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-11-17T13:37:07.597

如果您确定参数是 TGuid，那么以下应该可以工作：

```
TGuidField(TheQuery.ParamByName('AGuid')).AsGuid 
```

尽管这在内部执行了 GuidToString，但问题可能相同。值得一试！

# php - 输出长度很长的 PHP 哈希函数？

> ID：295515
> 
> 赞同：3
> 
> 时间：2008-11-17T12:56:01.050
> 
> 标签：php, hash

在我的代码中，我正在生成 URL 的散列（实际上是无限长度的）。我目前正在使用 sha1()，我知道它发生冲突的可能性很小，但是我有多达 255 个字节来存储哈希，所以我觉得我不妨利用可用空间来降低冲突的可能性更远。

是否有：

1.  另一个具有更长或可自定义哈希长度的 PHP 哈希函数？
2.  使用带有可变长度输入的 sha1 等固定长度哈希函数来生成更长哈希的方法？

或者，sha1 的 20 字节散列对任何事情都足够好，我应该停止担心它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T12:58:21.920

> 或者，sha1 的 20 字节对任何事情都足够好，我应该停止担心吗？

确切地。

哈希表、鸽洞和生日
[http://www.codinghorror.com/blog/archives/001014.html](http://www.codinghorror.com/blog/archives/001014.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T13:39:09.950

让我们看看... [http://www.cryptography.com/cnews/hash.html](http://www.cryptography.com/cnews/hash.html)

> 问：在 SHA-1 中找到冲突有多难？
> 答：报告的攻击需要估计工作因子为 2^69（约 5900 亿）的哈希计算

看起来风险很低...^_^

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T13:05:20.907

如果您真的很担心，请选择 256 位或 512 位哈希（32 或 64 个字符）。

如果您真的非常偏执，请加盐。

如果您比这更偏执，请将两个散列连接成一个更长的散列，例如 md5 和 sha-256。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T13:34:03.110

您总是可以在现有哈希之前/附加一个顺序 ID（十进制或十六进制）？

当然，您不会有固定长度的哈希，但您会知道代码是 a) 唯一且 b) 不可猜测（即使有人注意到顺序部分，他们也不知道您对其余部分进行加盐/散列的方式编码）。

当然，如果您不想向任何人隐藏这些哈希值，那么为什么不首先简单地使用顺序 ID？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T14:22:59.160

由于我不确切知道您要做什么，因此我假设您不想输入两次数据，并且希望能够快速检测碰撞。在这种情况下，我用伪代码提出以下算法：

```
found = false
hv = hash(urlValue)
if table[hash,url] contains pair (hv,urlValue)
   found = true
endif

if (not found)
   insert table (hv,urlValue)
endif 
```

在您的数据库中，在哈希列上创建一个非唯一索引以加快查找速度。这将允许对 (hash,url) 的查询快速进行——在正常情况下，您只查看一行，因为哈希可能是唯一的，但您实际上是根据实际 url 决定接受或拒绝。这将允许您使用更短的散列函数。大概您已经存储了 url 以供以后使用，因此这不会涉及任何额外的存储。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T14:37:51.173

如果你真的想对它着迷，你可以做的是结合 URL 不同部分的哈希值。

假设 URL 有 40 个字符长 - 将其分成 5 部分：获取字符 1-8 的 SHA1，连接到字符 9-16 的 SHA1，连接到 17-24 的 SHA1 ......等等。理论上你会然后有 2 ^(800 种可能性，并且只需要在 2) ^((69*5)) = 2 ^(345) = 7.2 * 10 ^(103)行之后开始担心冲突。

但就像我说的，我们正用这样的方法直奔疯狂的小镇。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-24T23:01:09.307

好吧，只有当你有一个短哈希键时才有意义。否则存在表中数据溢出的风险。

# mysql - MySQL max_allowed_pa cket 参数有什么问题？

> ID：295523
> 
> 赞同：4
> 
> 时间：2008-11-17T12:58:26.397
> 
> 标签：mysql, configuration, performance

我需要增加 max_allowed_pa​​cket 参数，以适应一些理论上非常大的项目。如果我将此参数设置为 10M，与将其设置为 1M 或 4M 相比，我支付的价格是多少。感谢您的任何意见！托马斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T17:28:16.570

我找到了这个解释：`http://www.astahost.com/info.php/max_allowed_packet-mysql_t2725.html`

> 增加此变量的值是安全的，因为仅在需要时才分配额外的内存。例如，只有当您发出长查询或 mysqld 必须返回大结果行时，mysqld 才会分配更多内存。该变量的小默认值是一种预防措施，可以在客户端和服务器之间捕获不正确的数据包，并确保您不会因意外使用大数据包而耗尽内存。

另请注意，我读到您必须更改 mysql 客户端和 mysql 服务器的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T14:48:19.653

我建议不要碰这个变量，而是调整你的存储实现以使用默认设置处理任何大小的文件。

你能[在这里](http://www.dreamwerx.net/phpforum/?id=1)看到一个例子吗。

# flash - 具有复制/粘贴功能的网站图像管理器？（闪光？）

> ID：295524
> 
> 赞同：0
> 
> 时间：2008-11-17T12:58:31.233
> 
> 标签：flash, image, upload, content-management-system

我正在寻找一个基于网络的上传管理器，它对图像有很好的支持。新手用户应该尽可能简单地“将图像添加到网站”。我可以将这样的东西用于两个用例：

*   供外部使用的 CMS，需要适当的图像支持（1 文件上传并不能完全削减它）。
*   一个供内部使用的 Wiki，要流行起来，它需要能够轻松放入屏幕截图，而无需担心“将屏幕截图保存到文件 - 上传文件 - 在页面上放置复杂的标记以显示图像”。

理想情况下，我正在寻找的东西显示上传图像的画廊，并允许用户添加/删除/替换图像。

我知道可能有很多服务器端 PHP 脚本可以在弹出窗口或 AJAX 中执行此类操作，但它们都缺少复制/粘贴支持。特别是对于内部支持站点，printscreen + paste 将是一个理想的解决方案，但我找不到支持这个的包。

我猜这应该可以使用 Flash 来实现。除非没有办法将图像数据粘贴到 Flash 文件中。不过我对此知之甚少。我可能自己开发一些东西，但我真的不想学习 Flash，而且我没有 $$ 支付 Flash 开发工具的费用。

那么告诉我，是否可以将位图数据复制/粘贴到 Flash 电影中？是否有人可能已经编写了一个优雅的图像/上传管理器来使用它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T22:09:48.483

我不相信 Flash 支持这样的复制和粘贴。我已经研究过很多次了。我相信你最好的选择是走我们在尝试解决这个问题时走的同一条路。我们使用 DotNetNuke 作为我们的 CMS，并为 DotNetNuke 创建了一个 MetaWeblog 桥，因此您可以使用 Windows Live Writer 等 MetaWeblog 客户端管理您的内容。这对我们来说非常有效，因为最终用户可以在 Windows 应用程序中编辑他们的 Web 内容，而不是基于 Web 的编辑器，这为用户提供了更高的稳定性和更广泛的功能，例如拖放图像的能力. 如果您对使用 DotNetNuke 感兴趣，您可能想查看我们的产品。它叫做 metaPost，有一个免费的社区版，您可以下载并试用。

我们网站的主页上有一个指向产品页面的链接，以及产品专业版中一些可用功能的示例（请参阅标签）。

[http://www.itcrossing.com/](http://www.itcrossing.com/)

高温下，

大学教师

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-21T08:55:00.390

这是一个纯 JavaScript 实现的示例，它支持 Google Chrome 中的 Print Screen / Ctrl+V 粘贴：http: [//strd6.com/2011/09/html5-javascript-pasting-image-data-in-chrome/](http://strd6.com/2011/09/html5-javascript-pasting-image-data-in-chrome/)

一旦您在客户端获得图像数据，您就可以对它做任何您想做的事情。

# graph-theory - 比赛图表问题

> ID：295531
> 
> 赞同：1
> 
> 时间：2008-11-17T13:01:49.573
> 
> 标签：graph-theory, directed-graph, tournament

锦标赛图和有向完全图是一回事吗？而且，锦标赛图中的所有顶点是否都具有相同数量的边？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T13:11:21.817

除非我遗漏了一些明显的东西，否则你两个问题的答案都是“是”

锦标赛图被定义为具有为边选择的方向的完整图。因此它是一个有向完全图。

[比赛图的维基百科定义](http://en.wikipedia.org/wiki/Tournament_(graph_theory))

并且由于完整的图在每个顶点之间都有一条边，因此每个顶点都有相同数量的边，并且当为边选择方向时，这不会改变。

[完整图的维基百科定义](http://en.wikipedia.org/wiki/Complete_graph)

# c# - 将 boost::signal 包装到 C# 委托

> ID：295533
> 
> 赞同：4
> 
> 时间：2008-11-17T13:04:09.007
> 
> 标签：c#, c++, boost, wrapper, swig

假设我有一个异步库，用本机 C++ 编写，接口类似于：

```
class connection {
public:
    boost::signal< void() > sig_connection_made;
    boost::signal< void(const std::string&) > sig_error;

    void connect(const std::string& host, const std::string& port);
}; 
```

我想用 C# 包装。有谁知道一种方法，使用 SWIG 或类似的东西，可以让我将信号绑定到 C# 委托？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T13:24:04.443

听起来像是[C++/CLI](http://en.wikipedia.org/wiki/C%2B%2B/CLI)的任务。

另请参阅[混合程序集](http://msdn.microsoft.com/en-us/library/x0w2664k.aspx)和[从托管代码调用本机函数](http://msdn.microsoft.com/en-us/library/ms235282.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T21:03:19.497

您可以使用 SWIG 将委托从 C# 传递到 c++ 中，将其分配给函数指针，然后调用函数指针，它将触发委托。

# c# - 连接到网络共享时如何提供用户名和密码

> ID：295538
> 
> 赞同：213
> 
> 时间：2008-11-17T13:07:44.333
> 
> 标签：c#, .net, winapi, networking, passwords

当连接到当前用户（在我的情况下是启用网络的服务用户）没有权限的网络共享时，必须提供名称和密码。

我知道如何使用 Win32 函数（`WNet*`来自 的系列`mpr.dll`）来做到这一点，但想使用 .Net (2.0) 功能来做到这一点。

有哪些可用选项？

**也许更多信息会有所帮助：**

*   用例是 Windows 服务，而不是 Asp.Net 应用程序。
*   该服务在对共享没有权限的帐户下运行。
*   共享所需的用户帐户在客户端未知。
*   客户端和服务器不是同一个域的成员。

* * *

## 回答 #1

> 赞同：351
> 
> 时间：2009-07-29T00:10:11.967

我非常喜欢[Mark Brackett](https://stackoverflow.com/users/2199/mark-brackett)的回答，所以我自己快速实施。如果其他人需要它，请在这里：

```
public class NetworkConnection : IDisposable
{
    string _networkName;

    public NetworkConnection(string networkName, 
        NetworkCredential credentials)
    {
        _networkName = networkName;

        var netResource = new NetResource()
        {
            Scope = ResourceScope.GlobalNetwork,
            ResourceType = ResourceType.Disk,
            DisplayType = ResourceDisplaytype.Share,
            RemoteName = networkName
        };

        var userName = string.IsNullOrEmpty(credentials.Domain)
            ? credentials.UserName
            : string.Format(@"{0}\{1}", credentials.Domain, credentials.UserName);

        var result = WNetAddConnection2(
            netResource, 
            credentials.Password,
            userName,
            0);

        if (result != 0)
        {
            throw new Win32Exception(result);
        }   
    }

    ~NetworkConnection()
    {
        Dispose(false);
    }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    protected virtual void Dispose(bool disposing)
    {
        WNetCancelConnection2(_networkName, 0, true);
    }

    [DllImport("mpr.dll")]
    private static extern int WNetAddConnection2(NetResource netResource, 
        string password, string username, int flags);

    [DllImport("mpr.dll")]
    private static extern int WNetCancelConnection2(string name, int flags,
        bool force);
}

[StructLayout(LayoutKind.Sequential)]
public class NetResource
{
    public ResourceScope Scope;
    public ResourceType ResourceType;
    public ResourceDisplaytype DisplayType;
    public int Usage;
    public string LocalName;
    public string RemoteName;
    public string Comment;
    public string Provider;
}

public enum ResourceScope : int
{
    Connected = 1,
    GlobalNetwork,
    Remembered,
    Recent,
    Context
};

public enum ResourceType : int
{
    Any = 0,
    Disk = 1,
    Print = 2,
    Reserved = 8,
}

public enum ResourceDisplaytype : int
{
    Generic = 0x0,
    Domain = 0x01,
    Server = 0x02,
    Share = 0x03,
    File = 0x04,
    Group = 0x05,
    Network = 0x06,
    Root = 0x07,
    Shareadmin = 0x08,
    Directory = 0x09,
    Tree = 0x0a,
    Ndscontainer = 0x0b
} 
```

* * *

## 回答 #2

> 赞同：161
> 
> 时间：2008-11-17T14:39:18.517

您可以更改线程标识或 P/Invoke WNetAddConnection2。我更喜欢后者，因为有时我需要为不同的位置维护多个凭据。我将它包装成一个 IDisposable 并调用 WNetCancelConnection2 之后删除凭据（避免多个用户名错误）：

```
using (new NetworkConnection(@"\\server\read", readCredentials))
using (new NetworkConnection(@"\\server2\write", writeCredentials)) {
   File.Copy(@"\\server\read\file", @"\\server2\write\file");
} 
```

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2016-09-16T21:39:44.350

7 年后的今天，我面临同样的问题，我想分享我的解决方案版本。

它已准备好复制和粘贴 :-) 这是：

# 第1步

在您的代码中（每当您需要使用权限做某事时）

```
ImpersonationHelper.Impersonate(domain, userName, userPassword, delegate
                            {
                                //Your code here 
                                //Let's say file copy:
                                if (!File.Exists(to))
                                {
                                    File.Copy(from, to);
                                }
                            }); 
```

# 第2步

神奇的 Helper 文件

```
using System;
using System.Runtime.ConstrainedExecution;
using System.Runtime.InteropServices;
using System.Security;
using System.Security.Permissions;
using System.Security.Principal;    
using Microsoft.Win32.SafeHandles;

namespace BlaBla
{
    public sealed class SafeTokenHandle : SafeHandleZeroOrMinusOneIsInvalid
    {
        private SafeTokenHandle()
            : base(true)
        {
        }

        [DllImport("kernel32.dll")]
        [ReliabilityContract(Consistency.WillNotCorruptState, Cer.Success)]
        [SuppressUnmanagedCodeSecurity]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool CloseHandle(IntPtr handle);

        protected override bool ReleaseHandle()
        {
            return CloseHandle(handle);
        }
    }

    public class ImpersonationHelper
    {
        [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
        private static extern bool LogonUser(String lpszUsername, String lpszDomain, String lpszPassword,
        int dwLogonType, int dwLogonProvider, out SafeTokenHandle phToken);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private extern static bool CloseHandle(IntPtr handle);

        [PermissionSet(SecurityAction.Demand, Name = "FullTrust")]
        public static void Impersonate(string domainName, string userName, string userPassword, Action actionToExecute)
        {
            SafeTokenHandle safeTokenHandle;
            try
            {

                const int LOGON32_PROVIDER_DEFAULT = 0;
                //This parameter causes LogonUser to create a primary token.
                const int LOGON32_LOGON_INTERACTIVE = 2;

                // Call LogonUser to obtain a handle to an access token.
                bool returnValue = LogonUser(userName, domainName, userPassword,
                    LOGON32_LOGON_INTERACTIVE, LOGON32_PROVIDER_DEFAULT,
                    out safeTokenHandle);
                //Facade.Instance.Trace("LogonUser called.");

                if (returnValue == false)
                {
                    int ret = Marshal.GetLastWin32Error();
                    //Facade.Instance.Trace($"LogonUser failed with error code : {ret}");

                    throw new System.ComponentModel.Win32Exception(ret);
                }

                using (safeTokenHandle)
                {
                    //Facade.Instance.Trace($"Value of Windows NT token: {safeTokenHandle}");
                    //Facade.Instance.Trace($"Before impersonation: {WindowsIdentity.GetCurrent().Name}");

                    // Use the token handle returned by LogonUser.
                    using (WindowsIdentity newId = new WindowsIdentity(safeTokenHandle.DangerousGetHandle()))
                    {
                        using (WindowsImpersonationContext impersonatedUser = newId.Impersonate())
                        {
                            //Facade.Instance.Trace($"After impersonation: {WindowsIdentity.GetCurrent().Name}");
                            //Facade.Instance.Trace("Start executing an action");

                            actionToExecute();

                            //Facade.Instance.Trace("Finished executing an action");
                        }
                    }
                    //Facade.Instance.Trace($"After closing the context: {WindowsIdentity.GetCurrent().Name}");
                }

            }
            catch (Exception ex)
            {
                //Facade.Instance.Trace("Oh no! Impersonate method failed.");
                //ex.HandleException();
                //On purpose: we want to notify a caller about the issue /Pavel Kovalev 9/16/2016 2:15:23 PM)/
                throw;
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2011-11-25T16:20:15.953

我搜索了很多方法，我按照自己的方式做了。您必须通过命令提示符 NET USE 命令打开两台机器之间的连接，并在完成工作后使用命令提示符 NET USE "myconnection" /delete 清除连接。

您必须从后面的代码中使用命令提示符过程，如下所示：

```
var savePath = @"\\servername\foldername\myfilename.jpg";
var filePath = @"C:\\temp\myfileTosave.jpg"; 
```

用法很简单：

```
SaveACopyfileToServer(filePath, savePath); 
```

这里是函数：

```
using System.IO
using System.Diagnostics;

public static void SaveACopyfileToServer(string filePath, string savePath)
    {
        var directory = Path.GetDirectoryName(savePath).Trim();
        var username = "loginusername";
        var password = "loginpassword";
        var filenameToSave = Path.GetFileName(savePath);

        if (!directory.EndsWith("\\"))
            filenameToSave = "\\" + filenameToSave;

        var command = "NET USE " + directory + " /delete";
        ExecuteCommand(command, 5000);

        command = "NET USE " + directory + " /user:" + username + " " + password;
        ExecuteCommand(command, 5000);

        command = " copy \"" + filePath + "\"  \"" + directory + filenameToSave + "\"";

        ExecuteCommand(command, 5000);

        command = "NET USE " + directory + " /delete";
        ExecuteCommand(command, 5000);
    } 
```

而且 ExecuteCommand 功能是：

```
public static int ExecuteCommand(string command, int timeout)
    {
        var processInfo = new ProcessStartInfo("cmd.exe", "/C " + command)
                              {
                                  CreateNoWindow = true, 
                                  UseShellExecute = false, 
                                  WorkingDirectory = "C:\\",
                              };

        var process = Process.Start(processInfo);
        process.WaitForExit(timeout);
        var exitCode = process.ExitCode;
        process.Close();
        return exitCode;
    } 
```

这个功能对我来说非常快速和稳定。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2014-03-18T13:55:42.150

Luke Quinane 解决方案看起来不错，但在我的 ASP.NET MVC 应用程序中仅部分起作用。在具有不同凭据的同一服务器上拥有两个共享，我只能将模拟用于第一个。

WNetAddConnection2 的问题还在于它在不同的 Windows 版本上表现不同。这就是我寻找替代方案并找到[LogonUser](http://msdn.microsoft.com/en-us/library/windows/desktop/aa378184%28v=vs.85%29.aspx)功能的原因。这是我的代码，它也适用于 ASP.NET：

```
public sealed class WrappedImpersonationContext
{
    public enum LogonType : int
    {
        Interactive = 2,
        Network = 3,
        Batch = 4,
        Service = 5,
        Unlock = 7,
        NetworkClearText = 8,
        NewCredentials = 9
    }

    public enum LogonProvider : int
    {
        Default = 0,  // LOGON32_PROVIDER_DEFAULT
        WinNT35 = 1,
        WinNT40 = 2,  // Use the NTLM logon provider.
        WinNT50 = 3   // Use the negotiate logon provider.
    }

    [DllImport("advapi32.dll", EntryPoint = "LogonUserW", SetLastError = true, CharSet = CharSet.Unicode)]
    public static extern bool LogonUser(String lpszUsername, String lpszDomain,
        String lpszPassword, LogonType dwLogonType, LogonProvider dwLogonProvider, ref IntPtr phToken);

    [DllImport("kernel32.dll")]
    public extern static bool CloseHandle(IntPtr handle);

    private string _domain, _password, _username;
    private IntPtr _token;
    private WindowsImpersonationContext _context;

    private bool IsInContext
    {
        get { return _context != null; }
    }

    public WrappedImpersonationContext(string domain, string username, string password)
    {
        _domain = String.IsNullOrEmpty(domain) ? "." : domain;
        _username = username;
        _password = password;
    }

    // Changes the Windows identity of this thread. Make sure to always call Leave() at the end.
    [PermissionSetAttribute(SecurityAction.Demand, Name = "FullTrust")]
    public void Enter()
    {
        if (IsInContext)
            return;

        _token = IntPtr.Zero;
        bool logonSuccessfull = LogonUser(_username, _domain, _password, LogonType.NewCredentials, LogonProvider.WinNT50, ref _token);
        if (!logonSuccessfull)
        {
            throw new Win32Exception(Marshal.GetLastWin32Error());
        }
        WindowsIdentity identity = new WindowsIdentity(_token);
        _context = identity.Impersonate();

        Debug.WriteLine(WindowsIdentity.GetCurrent().Name);
    }

    [PermissionSetAttribute(SecurityAction.Demand, Name = "FullTrust")]
    public void Leave()
    {
        if (!IsInContext)
            return;

        _context.Undo();

        if (_token != IntPtr.Zero)
        {
            CloseHandle(_token);
        }
        _context = null;
    }
} 
```

**用法：**

```
var impersonationContext = new WrappedImpersonationContext(Domain, Username, Password);
impersonationContext.Enter();

//do your stuff here

impersonationContext.Leave(); 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-11-05T15:42:15.253

对于 VB.lovers 来说，VB.NET 相当于 Luke Quinane 的代码（感谢 Luke！）

```
Imports System
Imports System.Net
Imports System.Runtime.InteropServices
Imports System.ComponentModel

Public Class NetworkConnection
    Implements IDisposable

    Private _networkName As String

    Public Sub New(networkName As String, credentials As NetworkCredential)
        _networkName = networkName

        Dim netResource = New NetResource() With {
             .Scope = ResourceScope.GlobalNetwork,
             .ResourceType = ResourceType.Disk,
             .DisplayType = ResourceDisplaytype.Share,
             .RemoteName = networkName
        }

        Dim userName = If(String.IsNullOrEmpty(credentials.Domain), credentials.UserName, String.Format("{0}\{1}", credentials.Domain, credentials.UserName))

        Dim result = WNetAddConnection2(NetResource, credentials.Password, userName, 0)

        If result <> 0 Then
            Throw New Win32Exception(result, "Error connecting to remote share")
        End If
    End Sub

    Protected Overrides Sub Finalize()
        Try
            Dispose (False)
        Finally
            MyBase.Finalize()
        End Try
    End Sub

    Public Sub Dispose() Implements IDisposable.Dispose
        Dispose (True)
        GC.SuppressFinalize (Me)
    End Sub

    Protected Overridable Sub Dispose(disposing As Boolean)
        WNetCancelConnection2(_networkName, 0, True)
    End Sub

    <DllImport("mpr.dll")> _
    Private Shared Function WNetAddConnection2(netResource As NetResource, password As String, username As String, flags As Integer) As Integer
    End Function

    <DllImport("mpr.dll")> _
    Private Shared Function WNetCancelConnection2(name As String, flags As Integer, force As Boolean) As Integer
    End Function

End Class

<StructLayout(LayoutKind.Sequential)> _
Public Class NetResource
    Public Scope As ResourceScope
    Public ResourceType As ResourceType
    Public DisplayType As ResourceDisplaytype
    Public Usage As Integer
    Public LocalName As String
    Public RemoteName As String
    Public Comment As String
    Public Provider As String
End Class

Public Enum ResourceScope As Integer
    Connected = 1
    GlobalNetwork
    Remembered
    Recent
    Context
End Enum

Public Enum ResourceType As Integer
    Any = 0
    Disk = 1
    Print = 2
    Reserved = 8
End Enum

Public Enum ResourceDisplaytype As Integer
    Generic = &H0
    Domain = &H1
    Server = &H2
    Share = &H3
    File = &H4
    Group = &H5
    Network = &H6
    Root = &H7
    Shareadmin = &H8
    Directory = &H9
    Tree = &HA
    Ndscontainer = &HB
End Enum 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-17T13:18:07.853

一种可能有效的选择是使用`WindowsIdentity.Impersonate`（并更改线程主体）成为所需的用户，[就像这样](http://blogs.msdn.com/shawnfa/archive/2005/03/21/400088.aspx)。回到 p/invoke，不过，我担心......

另一个厚颜无耻（同样远非理想）的选择可能是产生一个流程来完成这项工作......`ProcessStartInfo`接受一个`.UserName`,`.Password`和`.Domain`.

~~最后 - 也许在有权访问的专用帐户中运行服务？~~（删除，因为您已澄清这不是一个选项）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-01-30T08:12:10.180

好的...我可以回应..

免责声明：我刚刚度过了 18 个多小时的一天（再次）.. 我老了，健忘.. 我不会拼写.. 我的注意力很短，所以我最好快速回复.. :-)

问题：

是否可以将线程主体更改为在本地计算机上没有帐户的用户？

回答：

是的，即使您使用的凭据未在本地定义或不在“森林”范围内，您也可以更改线程主体。

我在尝试通过服务的 NTLM 身份验证连接到 SQL 服务器时遇到了这个问题。此调用使用与进程关联的凭据，这意味着您需要本地帐户或域帐户进行身份验证，然后才能模拟。呸呸呸……

但...

使用 ??????_NEW_CREDENTIALS 属性调用 LogonUser(..) 将返回一个安全令牌，而不尝试验证凭据。Kewl.. 不必在“森林”内定义帐户。获得令牌后，您可能必须调用 DuplicateToken() 并选择启用模拟以生成新令牌。现在调用 SetThreadToken(NULL, token); （可能是 &token？）.. 调用 ImpersonateLoggedonUser(token); 可能是必需的，但我不这么认为。查一下。。

做你需要做的。。

如果您调用了 ImpersonateLoggedonUser() 则调用 RevertToSelf() 然后 SetThreadToken( NULL, NULL ); （我想......查一下），然后在创建的句柄上关闭Handle（）..

没有承诺，但这对我有用......这是我的头顶（就像我的头发），我不会拼写！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-17T14:35:27.560

如果您无法创建本地有效的安全令牌，似乎您已经排除了所有选项栏 Win32 API 和 WNetAddConnection*。

MSDN 上有关 WNet 的大量信息 - PInvoke 信息和连接到此处的 UNC 路径的示例代码：

> [http://www.pinvoke.net/default.aspx/mpr/WNetAddConnection2.html#](http://www.pinvoke.net/default.aspx/mpr/WNetAddConnection2.html#)

MSDN 参考这里：

> [http://msdn.microsoft.com/en-us/library/aa385391(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa385391(VS.85).aspx)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-11-10T16:22:04.180

也移植到[F#](http://fsharp.org "F＃")以与[FAKE一起使用](https://github.com/fsharp/FAKE "伪造的")

```
module NetworkShare

open System
open System.ComponentModel
open System.IO
open System.Net
open System.Runtime.InteropServices

type ResourceScope =
| Connected = 1
| GlobalNetwork = 2
| Remembered = 3
| Recent = 4
type ResourceType =
| Any = 0
| Disk = 1
| Print = 2
| Reserved = 8
type ResourceDisplayType =
| Generic = 0x0
| Domain = 0x01
| Server = 0x02
| Share = 0x03
| File = 0x04
| Group = 0x05
| Network = 0x06
| Root = 0x07
| Shareadmin = 0x08
| Directory = 0x09
| Tree = 0x0a
| Ndscontainer = 0x0b

//Uses of this construct may result in the generation of unverifiable .NET IL code.
#nowarn "9"
[<StructLayout(LayoutKind.Sequential)>]
type NetResource =
  struct
    val mutable Scope : ResourceScope
    val mutable ResourceType : ResourceType
    val mutable DisplayType : ResourceDisplayType
    val mutable Usage : int
    val mutable LocalName : string
    val mutable RemoteName : string
    val mutable Comment : string
    val mutable Provider : string
    new(name) = {
      // lets preset needed fields
      NetResource.Scope = ResourceScope.GlobalNetwork
      ResourceType = ResourceType.Disk
      DisplayType = ResourceDisplayType.Share
      Usage = 0
      LocalName = null
      RemoteName = name
      Comment = null
      Provider = null
    }
  end

type WNetConnection(networkName : string, credential : NetworkCredential) =
  [<Literal>]
  static let Mpr = "mpr.dll"
  [<DllImport(Mpr, EntryPoint = "WNetAddConnection2")>]
  static extern int connect(NetResource netResource, string password, string username, int flags)
  [<DllImport(Mpr, EntryPoint = "WNetCancelConnection2")>]
  static extern int disconnect(string name, int flags, bool force)

  let mutable disposed = false;

  do
    let userName = if String.IsNullOrWhiteSpace credential.Domain
                   then credential.UserName
                   else credential.Domain + "\\" + credential.UserName
    let resource = new NetResource(networkName)

    let result = connect(resource, credential.Password, userName, 0)

    if result <> 0 then
      let msg = "Error connecting to remote share " + networkName
      new Win32Exception(result, msg)
      |> raise

  let cleanup(disposing:bool) =
    if not disposed then
      disposed <- true
      if disposing then () // TODO dispose managed resources here
      disconnect(networkName, 0, true) |> ignore

  interface IDisposable with
    member __.Dispose() =
      disconnect(networkName, 0, true) |> ignore
      GC.SuppressFinalize(__)

  override __.Finalize() = cleanup(false)

type CopyPath =
  | RemotePath of string * NetworkCredential
  | LocalPath of string

let createDisposable() =
  {
    new IDisposable with
      member __.Dispose() = ()
  }

let copyFile overwrite destPath srcPath : unit =
  use _srcConn =
    match srcPath with
    | RemotePath(path, credential) -> new WNetConnection(path, credential) :> IDisposable
    | LocalPath(_) -> createDisposable()
  use _destConn =
    match destPath with
    | RemotePath(path, credential) -> new WNetConnection(path, credential) :> IDisposable
    | LocalPath(_) -> createDisposable()
  match srcPath, destPath with
  | RemotePath(src, _), RemotePath(dest, _)
  | LocalPath(src), RemotePath(dest, _)
  | RemotePath(src, _), LocalPath(dest)
  | LocalPath(src), LocalPath(dest) ->
    if FileInfo(src).Exists |> not then
      failwith ("Source file not found: " + src)
    let destFilePath =
      if DirectoryInfo(dest).Exists then Path.Combine(dest, Path.GetFileName src)
      else dest
    File.Copy(src, destFilePath, overwrite)

let rec copyDir copySubDirs filePattern destPath srcPath =
  use _srcConn =
    match srcPath with
    | RemotePath(path, credential) -> new WNetConnection(path, credential) :> IDisposable
    | LocalPath(_) -> createDisposable()
  use _destConn =
    match destPath with
    | RemotePath(path, credential) -> new WNetConnection(path, credential) :> IDisposable
    | LocalPath(_) -> createDisposable()
  match srcPath, destPath with
  | RemotePath(src, _), RemotePath(dest, _)
  | LocalPath(src), RemotePath(dest, _)
  | RemotePath(src, _), LocalPath(dest)
  | LocalPath(src), LocalPath(dest) ->
    let dir = DirectoryInfo(src)
    if dir.Exists |> not then
      failwith ("Source directory not found: " + src)

    let dirs = dir.GetDirectories()
    if Directory.Exists(dest) |> not then
      Directory.CreateDirectory(dest) |> ignore

    let files = dir.GetFiles(filePattern)
    for file in files do
      let tempPath = Path.Combine(dest, file.Name)
      file.CopyTo(tempPath, false) |> ignore

    if copySubDirs then
      for subdir in dirs do
        let subdirSrc =
          match srcPath with
          | RemotePath(_, credential) -> RemotePath(Path.Combine(dest, subdir.Name), credential)
          | LocalPath(_) -> LocalPath(Path.Combine(dest, subdir.Name))
        let subdirDest =
          match destPath with
          | RemotePath(_, credential) -> RemotePath(subdir.FullName, credential)
          | LocalPath(_) -> LocalPath(subdir.FullName)
        copyDir copySubDirs filePattern subdirDest subdirSrc 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-17T13:12:23.107

您应该考虑添加这样的内容：

```
<identity impersonate="true" userName="domain\user" password="****" /> 
```

进入你的 web.config。

[更多信息。](http://msdn.microsoft.com/en-us/library/ms998358.aspx)

# c++ - 掌上电脑上的 MS Web 浏览器

> ID：295556
> 
> 赞同：0
> 
> 时间：2008-11-17T13:21:03.887
> 
> 标签：c++, mfc, activex, pocketpc

我正在尝试在 C++ MFC 中的袖珍电脑上创建自定义 Web 浏览器。当我添加 Microsoft Web Browser activeX 控件并在袖珍电脑（模拟器）上运行应用程序时，会弹出此错误：“调试断言失败。occcont.cpp 行：916”

当我查看 VS2005 的调试窗口时：“OLE 控件 {8856F961-340A-11D0-A96B-00C04FD705A2} 的 CoCreateInstance 失败。结果代码：0x80040154 控件是否正确注册？警告：资源项和 Win32 Z 顺序列表是不同步。标签顺序可能没有很好地定义。

如何在袖珍电脑上使用此控件？或者是否有类似的控件有效？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T11:48:55.677

FWIW，我已经在 .NET CF 应用程序中成功使用了这个控件。这意味着它应该工作。我怀疑您为桌面选择了 ActiveX 对象。但我不知道你是怎么选对的。

# c# - C#：下载超时的 URL

> ID：295557
> 
> 赞同：6
> 
> 时间：2008-11-17T13:21:58.237
> 
> 标签：c#, httpwebrequest, timeout, webrequest, .net-3.0

在 .NET 中最好的方法是什么？我总是忘记我需要什么`Dispose()`（或用 包裹`using`）。

编辑：经过长时间使用`WebRequest`，我发现了自定义`WebClient`. 好多了。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-28T21:32:26.447

同步方式：

```
var request = HttpWebRequest.Create("http://www.contoso.com");
request.Timeout = 50000;
using (var response = request.GetResponse())
{
    //your code here
} 
```

您还可以采用异步方式：

```
using System;
using System.Net;
using System.IO;
using System.Text;
using System.Threading;

public class RequestState
{
  // This class stores the State of the request.
  const int BUFFER_SIZE = 1024;
  public StringBuilder requestData;
  public byte[] BufferRead;
  public HttpWebRequest request;
  public HttpWebResponse response;
  public Stream streamResponse;
  public RequestState()
  {
    BufferRead = new byte[BUFFER_SIZE];
    requestData = new StringBuilder("");
    request = null;
    streamResponse = null;
  }
}

class HttpWebRequest_BeginGetResponse
{
    public static ManualResetEvent allDone = new ManualResetEvent(false);
    const int BUFFER_SIZE = 1024;
    const int DefaultTimeout = 2 * 60 * 1000; // 2 minutes timeout

    // Abort the request if the timer fires.
    private static void TimeoutCallback(object state, bool timedOut)
    {
        if (timedOut)
        {
            HttpWebRequest request = state as HttpWebRequest;
            if (request != null)
            {
                request.Abort();
            }
        }
    }

    static void Main()
    {

        try
        {
            // Create a HttpWebrequest object to the desired URL. 
            HttpWebRequest myHttpWebRequest = (HttpWebRequest)WebRequest.Create("http://www.contoso.com");
            myHttpWebRequest.ReadWriteTimeout = DefaultTimeout;

            // Create an instance of the RequestState and assign the previous myHttpWebRequest
            // object to its request field.  
            RequestState myRequestState = new RequestState();
            myRequestState.request = myHttpWebRequest;

            // Start the asynchronous request.
            IAsyncResult result =
              (IAsyncResult)myHttpWebRequest.BeginGetResponse(new AsyncCallback(RespCallback), myRequestState);

            // this line implements the timeout, if there is a timeout, the callback fires and the request becomes aborted
            ThreadPool.RegisterWaitForSingleObject(result.AsyncWaitHandle, new WaitOrTimerCallback(TimeoutCallback), myHttpWebRequest, DefaultTimeout, true);

            // The response came in the allowed time. The work processing will happen in the 
            // callback function.
            allDone.WaitOne();

            // Release the HttpWebResponse resource.
            myRequestState.response.Close();
        }
        catch (WebException e)
        {
            Console.WriteLine("\nMain Exception raised!");
            Console.WriteLine("\nMessage:{0}", e.Message);
            Console.WriteLine("\nStatus:{0}", e.Status);
            Console.WriteLine("Press any key to continue..........");
        }
        catch (Exception e)
        {
            Console.WriteLine("\nMain Exception raised!");
            Console.WriteLine("Source :{0} ", e.Source);
            Console.WriteLine("Message :{0} ", e.Message);
            Console.WriteLine("Press any key to continue..........");
            Console.Read();
        }
    }
    private static void RespCallback(IAsyncResult asynchronousResult)
    {
        try
        {
            // State of request is asynchronous.
            RequestState myRequestState = (RequestState)asynchronousResult.AsyncState;
            HttpWebRequest myHttpWebRequest = myRequestState.request;
            myRequestState.response = (HttpWebResponse)myHttpWebRequest.EndGetResponse(asynchronousResult);

            // Read the response into a Stream object.
            Stream responseStream = myRequestState.response.GetResponseStream();
            myRequestState.streamResponse = responseStream;

            // Begin the Reading of the contents of the HTML page and print it to the console.
            IAsyncResult asynchronousInputRead = responseStream.BeginRead(myRequestState.BufferRead, 0, BUFFER_SIZE, new AsyncCallback(ReadCallBack), myRequestState);
            return;
        }
        catch (WebException e)
        {
            Console.WriteLine("\nRespCallback Exception raised!");
            Console.WriteLine("\nMessage:{0}", e.Message);
            Console.WriteLine("\nStatus:{0}", e.Status);
        }
        allDone.Set();
    }
    private static void ReadCallBack(IAsyncResult asyncResult)
    {
        try
        {

            RequestState myRequestState = (RequestState)asyncResult.AsyncState;
            Stream responseStream = myRequestState.streamResponse;
            int read = responseStream.EndRead(asyncResult);
            // Read the HTML page and then print it to the console.
            if (read > 0)
            {
                myRequestState.requestData.Append(Encoding.ASCII.GetString(myRequestState.BufferRead, 0, read));
                IAsyncResult asynchronousResult = responseStream.BeginRead(myRequestState.BufferRead, 0, BUFFER_SIZE, new AsyncCallback(ReadCallBack), myRequestState);
                return;
            }
            else
            {
                Console.WriteLine("\nThe contents of the Html page are : ");
                if (myRequestState.requestData.Length > 1)
                {
                    string stringContent;
                    stringContent = myRequestState.requestData.ToString();
                    Console.WriteLine(stringContent);
                }
                Console.WriteLine("Press any key to continue..........");
                Console.ReadLine();

                responseStream.Close();
            }

        }
        catch (WebException e)
        {
            Console.WriteLine("\nReadCallBack Exception raised!");
            Console.WriteLine("\nMessage:{0}", e.Message);
            Console.WriteLine("\nStatus:{0}", e.Status);
        }
        allDone.Set();

    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-17T13:22:28.220

这是我使用的，它似乎工作，但我不知道这是否是最好的方法：

```
public string GetRequest(Uri uri, int timeoutMilliseconds)
{
    var request = System.Net.WebRequest.Create(uri);
    request.Timeout = timeoutMilliseconds;
    using (var response = request.GetResponse())
    using (var stream = response.GetResponseStream())
    using (var reader = new System.IO.StreamReader(stream))
    {
        return reader.ReadToEnd();
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-11-15T13:57:32.447

在 Thomas Levesque 的评论之后，[这里](https://stackoverflow.com/questions/1469805/c-canonical-http-post-code/1474861#1474861)有一个更简单、更通用的解决方案。

我们创建了一个`WebClient`支持超时的子类，我们得到了[WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)的所有优点。

```
public class WebClientWithTimeout : WebClient
{
  private readonly int timeoutMilliseconds;
  public WebClientWithTimeout(int timeoutMilliseconds)
  {
    this.timeoutMilliseconds = timeoutMilliseconds;
  }

  protected override WebRequest GetWebRequest(Uri address)
  {
    var result = base.GetWebRequest(address);
    result.Timeout = timeoutMilliseconds;
    return result;
  }
} 
```

示例用法：

```
public string GetRequest(Uri uri, int timeoutMilliseconds)
{
  using (var client = new WebClientWithTimeout(timeoutMilliseconds))
  {
    return client.DownloadString();
  }
} 
```

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2008-11-17T13:34:49.850

在单独的线程中运行 System.Net.WebClient，设置一个计时器以在最长时间后将其终止。

# windows-services - 从 vbscript 启用/禁用 windows-update

> ID：295563
> 
> 赞同：3
> 
> 时间：2008-11-17T13:30:49.513
> 
> 标签：windows-services, vbscript

我需要从我的安装中禁用 windows-update 服务。我已经使用 vbscript 来做一些事情，所以我想用 vbscript 来做。

我对 vbscript（或任何其他脚本语言）的了解非常有限，所以......有人可以帮我解决这个问题吗？我会很感激的！

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T15:25:04.900

感谢 Tomalak 和 Patrick Cuff。我真的很感谢你的帮助。我认为这可能是一个很好且完整的答案。

方法一：防止“自动更新”服务在机器启动时自动启动。

```
strComputer = "."  'could be any computer, not just the local one '
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")

Set colServiceList = objWMIService.ExecQuery _
("Select * from Win32_Service where Name = 'wuauserv'")

For Each objService in colServiceList
  objService.ChangeStartMode("Disabled")
Next 
```

方法2：将“自动更新”配置从“自动”更改为“关闭自动更新”。（MSDN 列出[了其他 NotificationLevel 常量](http://msdn.microsoft.com/en-us/library/aa385806(VS.85).aspx)）

```
Const AU_DISABLED = 1

Set objAutoUpdate = CreateObject("Microsoft.Update.AutoUpdate")
Set objSettings = objAutoUpdate.Settings

objSettings.NotificationLevel = AU_DISABLED
objSettings.Save 
```

在这两种情况下，您都不会获得自动更新。使用方法 1 将无法启动，而使用方法 2 服务仍在运行，只是没有执行任何操作。

您可以通过 GUI 完成这两件事：

*   方法一：管理工具\服务\自动更新，将“启动类型”从“自动”改为“禁用”。
*   方法二：控制面板\自动更新，选择“关闭自动更新”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T13:53:14.103

谢谢托马拉克。

我还发现：

```
Const SCHEDULED_INSTALLATION = 1

Set objAutoUpdate = CreateObject("Microsoft.Update.AutoUpdate")
Set objSettings = objAutoUpdate.Settings

objSettings.NotificationLevel = SCHEDULED_INSTALLATION
objSettings.Save 
```

这是链接： http: [//www.microsoft.com/technet/scriptcenter/resources/tales/sg0705.mspx](http://www.microsoft.com/technet/scriptcenter/resources/tales/sg0705.mspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T13:48:23.830

如果要使用 VBScript，请使用 WMI：

```
strComputer = "."  'could be any computer, not just the local one '
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")

Set colServiceList = objWMIService.ExecQuery _
("Select * from Win32_Service where Name = 'wuauserv'")

For Each objService in colServiceList
  objService.ChangeStartMode("Disabled")
Next 
```

查看[WMI Win32_Service 类的文档](http://msdn.microsoft.com/en-us/library/aa384896(VS.85).aspx)以找出其他可行的方法。

更容易使用`sc.exe`：

```
sc config wuauserv start=auto

```

以下是`sc.exe`可以做什么的摘录：

```
C:\>sc config
Modifies a service entry in the registry and Service Database.
SYNTAX:
sc <server> config [service name] <option1> <option2>...
CONFIG OPTIONS:
NOTE: The option name includes the equal sign.
 type= <own|share|interact|kernel|filesys|rec|adapt>
 start= <boot|system|auto|demand|disabled>
 error= <normal|severe|critical|ignore>
 binPath= <BinaryPathName>
 group= <LoadOrderGroup>
 tag= <yes|no>
 depend= <Dependencies(separated by / (forward slash))>
 obj= <AccountName|ObjectName>
 DisplayName= <display name>
 password= <password> 
```

# javascript - 在客户端清理/重写 HTML

> ID：295566
> 
> 赞同：83
> 
> 时间：2008-11-17T13:34:33.220
> 
> 标签：javascript, html, security, html-sanitizing

我需要显示通过跨域请求加载的外部资源，并确保只显示“*安全*”内容。

可以使用 Prototype 的[String#stripScripts](http://www.prototypejs.org/api/string/stripScripts)删除脚本块。但是诸如`onclick`or之类的处理程序`onerror`仍然存在。

是否有任何图书馆至少可以

*   剥离脚本块，
*   杀死 DOM 处理程序，
*   删除列入黑名单的标签（例如：`embed`或`object`）。

那么是否有任何与 JavaScript 相关的链接和示例？

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2009-01-10T00:19:59.017

2016 年更新：现在有一个基于 Caja sanitizer的[Google Closure包。](https://github.com/google/closure-library/blob/master/closure/goog/html/sanitizer/htmlsanitizer.js)

它有一个更简洁的 API，被重写以考虑现代浏览器上可用的 API，并与 Closure Compiler 更好地交互。

* * *

无耻插件：请参阅[caja/plugin/html-sanitizer.js](https://github.com/google/caja/blob/master/src/com/google/caja/plugin/html-sanitizer.js)了解经过彻底审查的客户端 html sanitizer。

它被列入白名单，而不是列入黑名单，但白名单可根据[CajaWhitelists进行配置](https://github.com/google/caja/wiki/CajaWhitelists)

* * *

如果要删除所有标签，请执行以下操作：

```
var tagBody = '(?:[^"\'>]|"[^"]*"|\'[^\']*\')*';

var tagOrComment = new RegExp(
    '<(?:'
    // Comment body.
    + '!--(?:(?:-*[^->])*--+|-?)'
    // Special "raw text" elements whose content should be elided.
    + '|script\\b' + tagBody + '>[\\s\\S]*?</script\\s*'
    + '|style\\b' + tagBody + '>[\\s\\S]*?</style\\s*'
    // Regular name
    + '|/?[a-z]'
    + tagBody
    + ')>',
    'gi');
function removeTags(html) {
  var oldHtml;
  do {
    oldHtml = html;
    html = html.replace(tagOrComment, '');
  } while (html !== oldHtml);
  return html.replace(/</g, '&lt;');
} 
```

人们会告诉您，您可以创建一个元素，然后分配`innerHTML`然后获取`innerText`or `textContent`，然后在其中转义实体。不要那样做。它容易受到 XSS 注入的影响，因为即使节点从未附加到 DOM`<img src=bogus onerror=alert(1337)>`也会运行处理程序。`onerror`

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2012-07-05T11:31:06.563

通过将 Google Caja [HTML sanitizer嵌入到](https://code.google.com/p/google-caja/source/browse/trunk/src/com/google/caja/plugin/html-sanitizer.js)[web worker](https://developer.mozilla.org/en/Using_web_workers)中，可以使其“支持网络” 。sanitizer 引入的任何全局变量都将包含在 worker 中，并且处理发生在它自己的线程中。

对于不支持 Web Worker 的浏览器，我们可以使用 iframe 作为 sanitizer 工作的单独环境。 Timothy Chien 有一个[polyfill](https://github.com/timdream/simworker)可以做到这一点，使用 iframe 来模拟 Web Worker，所以这部分已经为我们完成了。

[Caja 项目有一个关于如何使用 Caja 作为独立客户端消毒](https://code.google.com/p/google-caja/wiki/JsHtmlSanitizer)器的 wiki 页面：

*   签出源代码，然后通过运行构建`ant`
*   在您的页面中包含`html-sanitizer-minified.js`或`html-css-sanitizer-minified.js`
*   称呼`html_sanitize(...)`

工作脚本只需要遵循这些说明：

```
importScripts('html-css-sanitizer-minified.js'); // or 'html-sanitizer-minified.js'

var urlTransformer, nameIdClassTransformer;

// customize if you need to filter URLs and/or ids/names/classes
urlTransformer = nameIdClassTransformer = function(s) { return s; };

// when we receive some HTML
self.onmessage = function(event) {
    // sanitize, then send the result back
    postMessage(html_sanitize(event.data, urlTransformer, nameIdClassTransformer));
}; 
```

（需要更多代码才能使 simworker 库正常工作，但这对于本次讨论并不重要。）

演示：[https ://dl.dropbox.com/u/291406/html-sanitize/demo.html](https://dl.dropbox.com/u/291406/html-sanitize/demo.html)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-01-10T00:53:23.757

Never trust the client. If you're writing a server application, assume that the client will always submit unsanitary, malicious data. It's a rule of thumb that will keep you out of trouble. If you can, I would advise doing all validation and sanitation in server code, which you know (to a reasonable degree) won't be fiddled with. Perhaps you could use a serverside web application as a proxy for your clientside code, which fetches from the 3rd party and does sanitation before sending it to the client itself?

[edit] I'm sorry, I misunderstood the question. However, I stand by my advice. Your users will probably be safer if you sanitize on the server before sending it to them.

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2015-02-16T01:59:47.067

现在所有主流浏览器都支持沙盒 iframe，我*认为*有一种更简单的方法可以保证安全。如果更熟悉此类安全问题的人可以查看此答案，我会很高兴。

**注意：此方法在 IE 9 及更早版本中绝对行不通。有关支持沙盒的浏览器版本，请参阅[此表](http://caniuse.com/#feat=iframe-sandbox)。**（注意：表格似乎说它在 Opera Mini 中不起作用，但我刚刚尝试过，它起作用了。）

这个想法是创建一个禁用 JavaScript 的隐藏 iframe，将不受信任的 HTML 粘贴到其中，然后让它解析它。然后你可以遍历 DOM 树并复制出被认为是安全的标签和属性。

此处显示的白名单只是示例。白名单的最佳选择取决于应用程序。如果您需要一个更复杂的策略，而不仅仅是标签和属性的白名单，则可以通过此方法来满足，尽管此示例代码无法满足。

```
var tagWhitelist_ = {
  'A': true,
  'B': true,
  'BODY': true,
  'BR': true,
  'DIV': true,
  'EM': true,
  'HR': true,
  'I': true,
  'IMG': true,
  'P': true,
  'SPAN': true,
  'STRONG': true
};

var attributeWhitelist_ = {
  'href': true,
  'src': true
};

function sanitizeHtml(input) {
  var iframe = document.createElement('iframe');
  if (iframe['sandbox'] === undefined) {
    alert('Your browser does not support sandboxed iframes. Please upgrade to a modern browser.');
    return '';
  }
  iframe['sandbox'] = 'allow-same-origin';
  iframe.style.display = 'none';
  document.body.appendChild(iframe); // necessary so the iframe contains a document
  iframe.contentDocument.body.innerHTML = input;

  function makeSanitizedCopy(node) {
    if (node.nodeType == Node.TEXT_NODE) {
      var newNode = node.cloneNode(true);
    } else if (node.nodeType == Node.ELEMENT_NODE && tagWhitelist_[node.tagName]) {
      newNode = iframe.contentDocument.createElement(node.tagName);
      for (var i = 0; i < node.attributes.length; i++) {
        var attr = node.attributes[i];
        if (attributeWhitelist_[attr.name]) {
          newNode.setAttribute(attr.name, attr.value);
        }
      }
      for (i = 0; i < node.childNodes.length; i++) {
        var subCopy = makeSanitizedCopy(node.childNodes[i]);
        newNode.appendChild(subCopy, false);
      }
    } else {
      newNode = document.createDocumentFragment();
    }
    return newNode;
  };

  var resultElement = makeSanitizedCopy(iframe.contentDocument.body);
  document.body.removeChild(iframe);
  return resultElement.innerHTML;
}; 
```

**安全漏洞：**评论者@Explosion 指出`href`属性可以包含 JavaScript，例如`<a href="javascript:alert('Oops')">`. 应该可以在清理代码中捕获并删除它，但是上面的代码（还没有）被更新来做到这一点。

[你可以在这里](http://aldel.com/htmlsanitize.html)试试。

请注意，我在此示例中不允许使用样式属性和标签。如果您允许它们，您可能想要解析 CSS 并确保它对您的目的是安全的。

我已经在几种现代浏览器（Chrome 40、Firefox 36 Beta、IE 11、Android 版 Chrome）和一个旧浏览器（IE 8）上对此进行了测试，以确保它在执行任何脚本之前被保释。我很想知道是否有任何浏览器遇到问题，或者我忽略了任何边缘情况。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-08-23T17:00:19.490

所以，现在是 2016 年，我想我们中的许多人现在都`npm`在我们的代码中使用模块。[`sanitize-html`](https://www.npmjs.com/package/sanitize-html)似乎是 npm 上的主要选项，尽管还有[其他](https://www.npmjs.com/browse/keyword/sanitize).

这个问题的其他答案为如何推出自己的问题提供了很好的输入，但这是一个足够棘手的问题，经过良好测试的社区解决方案可能是最好的答案。

在命令行上运行它来安装： `npm install --save sanitize-html`

ES5： `var sanitizeHtml = require('sanitize-html'); // ... var sanitized = sanitizeHtml(htmlInput);`

ES6： `import sanitizeHtml from 'sanitize-html'; // ... let sanitized = sanitizeHtml(htmlInput);`

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-11-17T15:26:35.473

您无法预料到某处浏览器可能会跳过黑名单以逃避黑名单的每一种可能的奇怪类型的畸形标记，所以不要将其列入黑名单。除了脚本/嵌入/对象和处理程序之外，您可能需要删除更多的结构*。*

而是尝试将 HTML 解析为层次结构中的元素和属性，然后针对尽可能少的白名单运行所有元素和属性名称。还要根据白名单检查您允许通过的任何 URL 属性（请记住，还有比 JavaScript 更危险的协议：）。

如果输入是格式良好的 XHTML，那么上面的第一部分就容易多了。

与 HTML 清理一样，如果您能找到任何其他方法来避免这样做，请改为这样做。有很多很多潜在的漏洞。如果主要的网络邮件服务在这么多年后仍然在寻找漏洞，那么是什么让您认为自己可以做得更好？

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2019-01-21T15:06:41.477

*[免责声明：我是作者之一]*

我们为此编写了一个“仅限网络”（即“需要浏览器”）开源库[https://github.com/jitbit/HtmlSanitizer](https://github.com/jitbit/HtmlSanitizer)，它删除了`tags/attributes/styles`除“白名单”之外的所有内容。

用法：

```
var input = HtmlSanitizer.SanitizeHtml("<script> Alert('xss!'); </scr"+"ipt>"); 
```

PS 比“纯 JavaScript”解决方案运行得更快，因为它使用浏览器来解析和操作 DOM。如果您对“纯 JS”解决方案感兴趣，请尝试[https://github.com/punkave/sanitize-html](https://github.com/punkave/sanitize-html)（非附属）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-03-16T13:38:11.983

上面建议的 Google Caja 库过于复杂，无法配置并包含在我的 Web 应用程序项目中（因此，在浏览器上运行）。因为我们已经使用了 CKEditor 组件，所以我采取的方法是使用它内置的 HTML 清理和白名单功能，这更容易配置。因此，您可以在隐藏的 iframe 中加载 CKEditor 实例并执行以下操作：

```
CKEDITOR.instances['myCKEInstance'].dataProcessor.toHtml(myHTMLstring) 
```

现在，当然，如果你没有在你的项目中使用 CKEditor，这可能有点矫枉过正，因为组件本身大约是半兆字节（最小化），但如果你有源代码，也许你可以隔离代码白名单（`CKEDITOR.htmlParser`？）并使其更短。

[http://docs.ckeditor.com/#!/api](http://docs.ckeditor.com/#!/api)

[http://docs.ckeditor.com/#!/api/CKEDITOR.htmlDataProcessor](http://docs.ckeditor.com/#!/api/CKEDITOR.htmlDataProcessor)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-02-03T13:34:28.927

我没有使用正则表达式，而是想到了一种使用原生 DOM 的方法。通过这种方式，您可以将 HTML 解析为文档，获取该 HTML 并轻松获取所有特定元素以及要删除的白名单元素和属性。这使用属性列表作为允许的简单属性字符串数组，或者它可以使用正则表达式来验证它们的值并且只允许某些标签。

```
const sanitize = (html, tags = undefined, attributes = undefined) => {
    var attributes = attributes || [
      { attribute: "src", tags: "*", regex: /^(?:https|http|\/\/):/ },
      { attribute: "href", tags: "*", regex: /^(?!javascript:).+/ },
      { attribute: "width", tags: "*", regex: /^[0-9]+$/ },
      { attribute: "height", tags: "*", regex: /^[0-9]+$/ },
      { attribute: "id", tags: "*", regex: /^[a-zA-Z]+$/ },
      { attribute: "class", tags: "*", regex: /^[a-zA-Z ]+$/ },
      { attribute: "value", tags: ["INPUT", "TEXTAREA"], regex: /^.+$/ },
      { attribute: "checked", tags: ["INPUT"], regex: /^(?:true|false)+$/ },
      {
        attribute: "placeholder",
        tags: ["INPUT", "TEXTAREA"],
        regex: /^.+$/,
      },
      {
        attribute: "alt",
        tags: ["IMG", "AREA", "INPUT"],
        //"^" and "$" match beggining and end
        regex: /^[0-9a-zA-Z]+$/,
      },
      { attribute: "autofocus", tags: ["INPUT"], regex: /^(?:true|false)+$/ },
      { attribute: "for", tags: ["LABEL", "OUTPUT"], regex: /^[a-zA-Z0-9]+$/ },
    ]
    var tags = tags || [
      "I",
      "P",
      "B",
      "BODY",
      "HTML",
      "DEL",
      "INS",
      "STRONG",
      "SMALL",
      "A",
      "IMG",
      "CITE",
      "FIGCAPTION",
      "ASIDE",
      "ARTICLE",
      "SUMMARY",
      "DETAILS",
      "NAV",
      "TD",
      "TH",
      "TABLE",
      "THEAD",
      "TBODY",
      "NAV",
      "SPAN",
      "BR",
      "CODE",
      "PRE",
      "BLOCKQUOTE",
      "EM",
      "HR",
      "H1",
      "H2",
      "H3",
      "H4",
      "H5",
      "H6",
      "DIV",
      "MAIN",
      "HEADER",
      "FOOTER",
      "SELECT",
      "COL",
      "AREA",
      "ADDRESS",
      "ABBR",
      "BDI",
      "BDO",
    ]

    attributes = attributes.map((el) => {
      if (typeof el === "string") {
        return { attribute: el, tags: "*", regex: /^.+$/ }
      }
      let output = el
      if (!el.hasOwnProperty("tags")) {
        output.tags = "*"
      }
      if (!el.hasOwnProperty("regex")) {
        output.regex = /^.+$/
      }
      return output
    })
    var el = new DOMParser().parseFromString(html, "text/html")
    var elements = el.querySelectorAll("*")
    for (let i = 0; i < elements.length; i++) {
      const current = elements[i]
      let attr_list = get_attributes(current)
      for (let j = 0; j < attr_list.length; j++) {
        const attribute = attr_list[j]
        if (!attribute_matches(current, attribute)) {
          current.removeAttribute(attr_list[j])
        }
      }
      if (!tags.includes(current.tagName)) {
        current.remove()
      }
    }
    return el.documentElement.innerHTML
    function attribute_matches(element, attribute) {
      let output = attributes.filter((attr) => {
        let returnval =
          attr.attribute === attribute &&
          (attr.tags === "*" || attr.tags.includes(element.tagName)) &&
          attr.regex.test(element.getAttribute(attribute))
        return returnval
      })

      return output.length > 0
    }
    function get_attributes(element) {
      for (
        var i = 0, atts = element.attributes, n = atts.length, arr = [];
        i < n;
        i++
      ) {
        arr.push(atts[i].nodeName)
      }
      return arr
    }
  }
```

```
* {
  font-family: sans-serif;
}
textarea {
  width: 49%;
  height: 300px;
  padding: 10px;
  box-sizing: border-box;
  resize: none;
}
```

```
<h1>Sanitize HTML client side</h1>
<textarea id='input' placeholder="Unsanitized HTML">
&lt;!-- This removes both the src and onerror attributes because src is not a valid url. --&gt;
&lt;img src=&quot;error&quot; onerror=&quot;alert('XSS')&quot;&gt;
&lt;div id=&quot;something_harmless&quot; onload=&quot;alert('More XSS')&quot;&gt;
   &lt;b&gt;Bold text!&lt;/b&gt; and &lt;em&gt;Italic text!&lt;/em&gt;, some more text. &lt;del&gt;Deleted text!&lt;/del&gt;
&lt;/div&gt;
 &lt;script&gt;
    alert(&quot;This would be XSS&quot;);
  &lt;/script&gt;
</textarea>
<textarea id='output' placeholder="Sanitized HTML will appear here" readonly></textarea>
<script>
  document.querySelector("#input").onkeyup = () => {
    document.querySelector("#output").value = sanitize(document.querySelector("#input").value);
  }
</script>
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-04T05:58:16.007

我建议从你的生活中删除框架，从长远来看，它会让你的事情变得非常容易。

***cloneNode***：克隆节点会复制其所有属性及其值，但**不会复制事件侦听***器。*

 *[https://developer.mozilla.org/en/DOM/Node.cloneNode](https://developer.mozilla.org/en/DOM/Node.cloneNode)

尽管我已经使用 treewalkers 有一段时间了，但以下内容没有经过测试，它们是 JavaScript 中最被低估的部分之一。这是您可以抓取的节点类型的列表，通常我使用**SHOW_ELEMENT**或**SHOW_TEXT**。

[http://www.w3.org/TR/DOM-Level-2-Traversal-Range/traversal.html#Traversal-NodeFilter](http://www.w3.org/TR/DOM-Level-2-Traversal-Range/traversal.html#Traversal-NodeFilter)

```
function xhtml_cleaner(id)
{
 var e = document.getElementById(id);
 var f = document.createDocumentFragment();
 f.appendChild(e.cloneNode(true));

 var walker = document.createTreeWalker(f,NodeFilter.SHOW_ELEMENT,null,false);

 while (walker.nextNode())
 {
  var c = walker.currentNode;
  if (c.hasAttribute('contentEditable')) {c.removeAttribute('contentEditable');}
  if (c.hasAttribute('style')) {c.removeAttribute('style');}

  if (c.nodeName.toLowerCase()=='script') {element_del(c);}
 }

 alert(new XMLSerializer().serializeToString(f));
 return f;
}

function element_del(element_id)
{
 if (document.getElementById(element_id))
 {
  document.getElementById(element_id).parentNode.removeChild(document.getElementById(element_id));
 }
 else if (element_id)
 {
  element_id.parentNode.removeChild(element_id);
 }
 else
 {
  alert('Error: the object or element \'' + element_id + '\' was not found and therefore could not be deleted.');
 }
} 
```

# objective-c - 单元测试以验证对象被释放

> ID：295569
> 
> 赞同：3
> 
> 时间：2008-11-17T13:35:40.097
> 
> 标签：objective-c, cocoa, unit-testing

我正在寻找的是一种以编程方式验证目标对象已被释放的方法。目前我在我希望观察的对象的 dealloc 方法中有一个 NSLog 语句。单元测试框架来自 Google Toolbox for mac，它运行良好。我只是不确定如何构建这个特定的测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T15:11:18.330

使用 _GTMDevLog ：

查看高级资料 | [此页面上的](http://code.google.com/p/google-toolbox-for-mac/wiki/iPhoneUnitTesting)单元测试日志记录。

[有关DevLogNAssert](http://code.google.com/p/google-toolbox-for-mac/wiki/DevLogNAssert)的更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T04:00:08.387

你可以调整`dealloc`方法。参见[CocoaDev 上的 MethodSwizzling](http://cocoadev.com/?MethodSwizzling)；使用 Leopard 的新`method_exchangeImplementations`功能的现代方法（当前）位于页面底部附近。

您的实现需要告诉您的测试用例对象它已被调用。一种方法是在文件中定义一个静态变量，其中定义了测试用例类和替换`dealloc`方法；您的测试方法将该变量设置为`NO`，然后释放该对象，然后断言该变量的值现在为真。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T15:35:18.670

我在 C#/.Net 中做了与此非常相似的事情。我使用“WeakReference”来跟踪该项目，并测试它不再存在（见链接）。你能把这种方法应用到你的环境中吗？

[http://geekswithblogs.net/HouseOfBilz/archive/2008/11/11/writing-tests-to-catch-memory-leaks-in-.net.aspx](http://geekswithblogs.net/HouseOfBilz/archive/2008/11/11/writing-tests-to-catch-memory-leaks-in-.net.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T15:57:06.067

在过去，我创建了一个变量来计算给定类的对象数量，这些对象通过在构造函数中递增并在析构函数中递减来分配。单元测试只是在测试结束时检查变量是否为零。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T13:45:10.030

您能否在某种事件监视器服务中记录 dealloc，以便测试代码可以使用它进行查询以查看是否发生了 dealloc。显然，您将按名称或 ID 记录它，因为该对象正在被释放...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T14:47:15.850

我可能很天真，但释放的单元测试不包括

*   分配一个对象，
*   通过您要测试的方法释放它，
*   试图从对象中调用某些东西，然后
*   捕获异常并查看其类型是否正确？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-11T15:44:54.770

我编写了一个函数，该函数释放对象并`YES`在对象被释放时返回：

```
BOOL getsDeallocatedByReleasing(id object); 
```

还有一个高级接口，您可以在一个块中运行任意代码，您将获得一个布尔值，指示给定类的对象是否被释放：

```
BOOL classGetsDeallocated(Class c, void (^block)(void)); 
```

该代码使用方法调配，它非常丑陋并且绝对不是线程安全的，但它可以工作。你可以在[GitHub 上](https://gist.github.com/672643)找到它，如果我发现任何错误，我会保持更新。

* * *

PS 在编写完所有代码之后（d'oh！），难道不能`retain`在开始时添加一个，做任何你想做的事，拆掉你正在检查的对象图并检查对象的保留计数吗？

# sql - 从结果集中创建一个长字符串

> ID：295575
> 
> 赞同：5
> 
> 时间：2008-11-17T13:40:06.517
> 
> 标签：sql, tsql, string

我在存储过程中的 MS-SQL 中有一个结果集，可以说它有一个 VARCHAR 列，但有很多行。我想创建一个包含所有这些值的逗号分隔字符串，有没有一种简单的方法可以做到这一点，还是我必须逐步检查每个结果并手动构建字符串？

最好我想在存储过程本身中执行此操作。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-17T13:49:13.377

这是一种方法（使用 AdventureWorks2008 DB）：

```
DECLARE @name varchar(255)
SET @name = NULL

select @Name = COALESCE(@Name + ',','') + LastName from Person.Person
Select @name 
```

这是另一个（从 SQL 2005 开始）：

```
SELECT 
    LastName + ','
FROM 
    Person.Person
FOR XML PATH('') 
```

在这两种情况下，您都需要删除结尾的逗号“，”（可以使用 STUFF() 函数）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T13:52:59.237

这个问题之前被问过几次：

[如何在一列中返回多个值（T-SQL）？](https://stackoverflow.com/questions/122942/how-to-return-multiple-values-in-one-column-t-sql)

# asp.net - 如何将来自 LinqDataSource 的 TotalRowCount 转换为 Literal？

> ID：295576
> 
> 赞同：0
> 
> 时间：2008-11-17T13:40:09.307
> 
> 标签：asp.net, linq-to-sql

我有一个 LinqDataSource 用于计算表中的行数。我想用数字更新文字的值，下面的代码取自 MSDN ( [linqdatasourcestatuseventargs.totalrowcount.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.linqdatasourcestatuseventargs.totalrowcount.aspx) )：

```
protected void linqDataSource1_Selected(object sender, LinqDataSourceStatusEventArgs e)
{
    Literal1.Text = e.TotalRowCount.ToString();
} 
```

如何触发数据源上的选择事件？SqlDataSource 类有一个 Select() 方法，因此可以在 Page_Load 中以编程方式触发它，但 LinqDataSource 没有这个方法。我目前通过将我的数据源绑定到一个空的 FormView 元素解决了这个问题，但这太难看了。

我非常有信心在使用 LinqToSql 时有一种更好的方法可以将总行数放入我的文字中，我只是不知道该怎么做。

tvanfosson 提出的将方法附加到数据源的选定事件的建议，不幸的是并没有解决我的问题，因为在页面加载时仍然没有触发 select 事件。（顺便说一句，我已经将 _Selected 方法与 OnSelected 属性附加在一起，就像这样）

```
<asp:LinqDataSource ID="linqDataSource1" runat="server"
    OnSelected="linqDataSource1_Selected"> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T01:52:38.097

将您的方法连接为 Page_Load 中 Selected 事件的事件处理程序。

```
public void Page_Load( object sender, EventArgs e )
{
     linqDataSource1.Selected += LinqDataSource1_Selected;
}

protected void LinqDataSource1_Selected(object sender, LinqDataSourceStatusEventArgs e)
{
    Literal1.Text = e.TotalRowCount.ToString();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T23:56:29.750

我最终放弃了数据源，而是将代码放在后面的代码中。不是我想要的点击式编程，但仍然很短。我看起来像这样：

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!Page.IsPostBack)
    {
        var context = new MyDataContext();

        numberOfModificationsLiteral.Text =
            (
                from modification in context.Modifications
                where modification.Start >= DateTime.Now
                select modification
            ).Count().ToString();
    }
} 
```

# wpf - WPF GroupBox 使用扩展按钮隐藏/显示？

> ID：295578
> 
> 赞同：1
> 
> 时间：2008-11-17T13:41:34.983
> 
> 标签：wpf, expander

是否有这样的控件`System.Windows.Controls.GroupBox`可以隐藏其内容并仅显示名称和扩展按钮？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-17T14:53:21.423

检查[扩展器](http://msdn.microsoft.com/en-us/library/system.windows.controls.expander.aspx)控件。

# java - 确定整数平方根是否为整数的最快方法

> ID：295579
> 
> 赞同：1559
> 
> 时间：2008-11-17T13:43:21.907
> 
> 标签：java, math, optimization, perfect-square

我正在寻找确定一个`long`值是否是完美平方的最快方法（即它的平方根是另一个整数）：

1.  我通过使用内置[`Math.sqrt()`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Math.html#sqrt(double)) 函数以简单的方式完成了它，但我想知道是否有一种方法可以通过将自己限制在仅限整数域来更快地完成它。
2.  维护查找表是不切实际的（因为大约有 2 ^(31.5)个整数的平方小于 2 ^(63)）。

这是我现在正在做的非常简单直接的方法：

```
public final static boolean isPerfectSquare(long n)
{
  if (n < 0)
    return false;

  long tst = (long)(Math.sqrt(n) + 0.5);
  return tst*tst == n;
} 
```

[注意：我在很多[Project Euler](http://projecteuler.net/)问题中都使用了这个函数。因此，没有其他人将不得不维护此代码。而这种微优化实际上可以产生影响，因为部分挑战是在不到一分钟的时间内完成每个算法，并且在某些问题中这个函数需要被调用数百万次。]

* * *

我尝试了不同的解决方案来解决这个问题：

*   经过详尽的测试，我发现添加`0.5`到 Math.sqrt() 的结果是没有必要的，至少在我的机器上不是。
*   [快速逆平方根](https://en.wikipedia.org/wiki/Fast_inverse_square_root)更快，但它在n >= 410881 时给出了不正确的结果。但是，正如[BobbyShaftoe](https://stackoverflow.com/users/38426/bobbyshaftoe)所建议的，我们可以对 n < 410881 使用 FISR hack。
*   牛顿的方法比`Math.sqrt()`. 这可能是因为`Math.sqrt()`它使用了类似于牛顿法的东西，但在硬件中实现，因此它比 Java 快得多。此外，牛顿法仍然需要使用双打。
*   修改后的牛顿方法，它使用了一些技巧，因此只涉及整数数学，需要一些技巧来避免溢出（我希望这个函数可以处理所有正的 64 位有符号整数），它仍然比`Math.sqrt()`.
*   二进制斩波甚至更慢。这是有道理的，因为二进制斩波平均需要 16 遍才能找到 64 位数字的平方根。
*   根据 John 的测试，`or`在 C++ 中 using 语句比使用 a 更快，但在 Java 和 C# 中， and`switch`之间似乎没有区别。`or``switch`
*   我还尝试制作一个查找表（作为 64 个布尔值的私有静态数组）。`or`然后，我只想说，而不是 switch 或语句`if(lookup[(int)(n&0x3F)]) { test } else return false;`。令我惊讶的是，这（只是稍微）慢了一点。这是因为[在 Java 中检查了数组边界](https://stackoverflow.com/questions/299079/why-is-this-code-with-several-or-statements-slightly-faster-than-using-a-lookup-t#299205)。

* * *

## 回答 #1

> 赞同：794
> 
> 时间：2009-01-08T16:32:42.587

我想出了一个比你的 6bits+Carmack+sqrt 代码快 35% 的方法，至少在我的 CPU (x86) 和编程语言 (C/C++) 上是这样。您的结果可能会有所不同，尤其是因为我不知道 Java 因素将如何发挥作用。

我的方法有三个：

1.  首先，过滤掉明显的答案。这包括负数和查看最后 4 位。（我发现查看最后六个没有帮助。）我也对 0 回答是。（在阅读下面的代码时，请注意我的输入是`int64 x`。）

    ```
    if( x < 0 || (x&2) || ((x & 7) == 5) || ((x & 11) == 8) )
        return false;
    if( x == 0 )
        return true;
    ```

2.  接下来，检查它是否是模 255 = 3 * 5 * 17 的平方。因为这是三个不同素数的乘积，所以模 255 的余数中只有大约 1/8 是平方。但是，根据我的经验，调用模运算符 (%) 的成本高于获得的收益，因此我使用涉及 255 = 2^8-1 的位技巧来计算残差。（无论好坏，我没有使用从单词中读取单个字节的技巧，只是按位与和移位。）

    ```
    int64 y = x;
    y = (y & 4294967295LL) + (y >> 32); 
    y = (y & 65535) + (y >> 16);
    y = (y & 255) + ((y >> 8) & 255) + (y >> 16);
    // At this point, y is between 0 and 511\.  More code can reduce it farther. 
    ```

    为了实际检查余数是否为正方形，我在预先计算的表格中查找答案。

    ```
    if( bad255[y] )
        return false;
    // However, I just use a table of size 512 
    ```

3.  最后，尝试使用类似于[Hensel 引理](http://en.wikipedia.org/wiki/Hensel%27s_lemma)的方法计算平方根。（我不认为它直接适用，但它可以通过一些修改来工作。）在此之前，我用二分搜索除以 2 的所有幂：

    ```
    if((x & 4294967295LL) == 0)
        x >>= 32;
    if((x & 65535) == 0)
        x >>= 16;
    if((x & 255) == 0)
        x >>= 8;
    if((x & 15) == 0)
        x >>= 4;
    if((x & 3) == 0)
        x >>= 2;
    ```

    此时，要使我们的数字成为正方形，它必须是 1 mod 8。

    ```
    if((x & 7) != 1)
        return false;
    ```

    亨塞尔引理的基本结构如下。（注意：未经测试的代码；如果不起作用，请尝试 t=2 或 8。）

    ```
    int64 t = 4, r = 1;
    t <<= 1; r += ((x - r * r) & t) >> 1;
    t <<= 1; r += ((x - r * r) & t) >> 1;
    t <<= 1; r += ((x - r * r) & t) >> 1;
    // Repeat until t is 2^33 or so.  Use a loop if you want.
    ```

    这个想法是，在每次迭代中，您将一位添加到 r 上，即 x 的“当前”平方根；每个平方根都精确模数越来越大的 2 次方，即 t/2。最后，r 和 t/2-r 将是 x 模 t/2 的平方根。（请注意，如果 r 是 x 的平方根，那么 -r 也是如此。偶数模数也是如此，但请注意，对某些数模数，事物的平方根甚至可能超过 2 个；值得注意的是，这包括 2 的幂。 ) 因为我们的实际平方根小于 2^32，此时我们实际上可以检查 r 或 t/2-r 是否是真正的平方根。在我的实际代码中，我使用了以下修改后的循环：

    ```
    int64 r, t, z;
    r = start[(x >> 3) & 1023];
    do {
        z = x - r * r;
        if( z == 0 )
            return true;
        if( z < 0 )
            return false;
        t = z & (-z);
        r += (z & t) >> 1;
        if( r > (t >> 1) )
            r = t - r;
    } while( t <= (1LL << 33) );
    ```

    这里的加速是通过三种方式获得的：预先计算的起始值（相当于循环的约 10 次迭代）、循环的提前退出和跳过一些 t 值。对于最后一部分，我看一下`z = r - x * x`，并将 t 设置为 2 除 z 的最大幂，有点技巧。这使我可以跳过不会影响 r 值的 t 个值。在我的例子中，预先计算的起始值选择了“最小正”平方根模 8192。

即使这段代码对你来说运行得更快，我希望你喜欢它包含的一些想法。完整的、经过测试的代码如下，包括预先计算的表。

```
typedef signed long long int int64;

int start[1024] =
{1,3,1769,5,1937,1741,7,1451,479,157,9,91,945,659,1817,11,
1983,707,1321,1211,1071,13,1479,405,415,1501,1609,741,15,339,1703,203,
129,1411,873,1669,17,1715,1145,1835,351,1251,887,1573,975,19,1127,395,
1855,1981,425,453,1105,653,327,21,287,93,713,1691,1935,301,551,587,
257,1277,23,763,1903,1075,1799,1877,223,1437,1783,859,1201,621,25,779,
1727,573,471,1979,815,1293,825,363,159,1315,183,27,241,941,601,971,
385,131,919,901,273,435,647,1493,95,29,1417,805,719,1261,1177,1163,
1599,835,1367,315,1361,1933,1977,747,31,1373,1079,1637,1679,1581,1753,1355,
513,1539,1815,1531,1647,205,505,1109,33,1379,521,1627,1457,1901,1767,1547,
1471,1853,1833,1349,559,1523,967,1131,97,35,1975,795,497,1875,1191,1739,
641,1149,1385,133,529,845,1657,725,161,1309,375,37,463,1555,615,1931,
1343,445,937,1083,1617,883,185,1515,225,1443,1225,869,1423,1235,39,1973,
769,259,489,1797,1391,1485,1287,341,289,99,1271,1701,1713,915,537,1781,
1215,963,41,581,303,243,1337,1899,353,1245,329,1563,753,595,1113,1589,
897,1667,407,635,785,1971,135,43,417,1507,1929,731,207,275,1689,1397,
1087,1725,855,1851,1873,397,1607,1813,481,163,567,101,1167,45,1831,1205,
1025,1021,1303,1029,1135,1331,1017,427,545,1181,1033,933,1969,365,1255,1013,
959,317,1751,187,47,1037,455,1429,609,1571,1463,1765,1009,685,679,821,
1153,387,1897,1403,1041,691,1927,811,673,227,137,1499,49,1005,103,629,
831,1091,1449,1477,1967,1677,697,1045,737,1117,1737,667,911,1325,473,437,
1281,1795,1001,261,879,51,775,1195,801,1635,759,165,1871,1645,1049,245,
703,1597,553,955,209,1779,1849,661,865,291,841,997,1265,1965,1625,53,
1409,893,105,1925,1297,589,377,1579,929,1053,1655,1829,305,1811,1895,139,
575,189,343,709,1711,1139,1095,277,993,1699,55,1435,655,1491,1319,331,
1537,515,791,507,623,1229,1529,1963,1057,355,1545,603,1615,1171,743,523,
447,1219,1239,1723,465,499,57,107,1121,989,951,229,1521,851,167,715,
1665,1923,1687,1157,1553,1869,1415,1749,1185,1763,649,1061,561,531,409,907,
319,1469,1961,59,1455,141,1209,491,1249,419,1847,1893,399,211,985,1099,
1793,765,1513,1275,367,1587,263,1365,1313,925,247,1371,1359,109,1561,1291,
191,61,1065,1605,721,781,1735,875,1377,1827,1353,539,1777,429,1959,1483,
1921,643,617,389,1809,947,889,981,1441,483,1143,293,817,749,1383,1675,
63,1347,169,827,1199,1421,583,1259,1505,861,457,1125,143,1069,807,1867,
2047,2045,279,2043,111,307,2041,597,1569,1891,2039,1957,1103,1389,231,2037,
65,1341,727,837,977,2035,569,1643,1633,547,439,1307,2033,1709,345,1845,
1919,637,1175,379,2031,333,903,213,1697,797,1161,475,1073,2029,921,1653,
193,67,1623,1595,943,1395,1721,2027,1761,1955,1335,357,113,1747,1497,1461,
1791,771,2025,1285,145,973,249,171,1825,611,265,1189,847,1427,2023,1269,
321,1475,1577,69,1233,755,1223,1685,1889,733,1865,2021,1807,1107,1447,1077,
1663,1917,1129,1147,1775,1613,1401,555,1953,2019,631,1243,1329,787,871,885,
449,1213,681,1733,687,115,71,1301,2017,675,969,411,369,467,295,693,
1535,509,233,517,401,1843,1543,939,2015,669,1527,421,591,147,281,501,
577,195,215,699,1489,525,1081,917,1951,2013,73,1253,1551,173,857,309,
1407,899,663,1915,1519,1203,391,1323,1887,739,1673,2011,1585,493,1433,117,
705,1603,1111,965,431,1165,1863,533,1823,605,823,1179,625,813,2009,75,
1279,1789,1559,251,657,563,761,1707,1759,1949,777,347,335,1133,1511,267,
833,1085,2007,1467,1745,1805,711,149,1695,803,1719,485,1295,1453,935,459,
1151,381,1641,1413,1263,77,1913,2005,1631,541,119,1317,1841,1773,359,651,
961,323,1193,197,175,1651,441,235,1567,1885,1481,1947,881,2003,217,843,
1023,1027,745,1019,913,717,1031,1621,1503,867,1015,1115,79,1683,793,1035,
1089,1731,297,1861,2001,1011,1593,619,1439,477,585,283,1039,1363,1369,1227,
895,1661,151,645,1007,1357,121,1237,1375,1821,1911,549,1999,1043,1945,1419,
1217,957,599,571,81,371,1351,1003,1311,931,311,1381,1137,723,1575,1611,
767,253,1047,1787,1169,1997,1273,853,1247,413,1289,1883,177,403,999,1803,
1345,451,1495,1093,1839,269,199,1387,1183,1757,1207,1051,783,83,423,1995,
639,1155,1943,123,751,1459,1671,469,1119,995,393,219,1743,237,153,1909,
1473,1859,1705,1339,337,909,953,1771,1055,349,1993,613,1393,557,729,1717,
511,1533,1257,1541,1425,819,519,85,991,1693,503,1445,433,877,1305,1525,
1601,829,809,325,1583,1549,1991,1941,927,1059,1097,1819,527,1197,1881,1333,
383,125,361,891,495,179,633,299,863,285,1399,987,1487,1517,1639,1141,
1729,579,87,1989,593,1907,839,1557,799,1629,201,155,1649,1837,1063,949,
255,1283,535,773,1681,461,1785,683,735,1123,1801,677,689,1939,487,757,
1857,1987,983,443,1327,1267,313,1173,671,221,695,1509,271,1619,89,565,
127,1405,1431,1659,239,1101,1159,1067,607,1565,905,1755,1231,1299,665,373,
1985,701,1879,1221,849,627,1465,789,543,1187,1591,923,1905,979,1241,181};

bool bad255[512] =
{0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,
 1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,
 0,1,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,
 1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,
 1,1,1,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,
 1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,
 1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,
 0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,
 1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,
 0,1,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,
 1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,
 1,1,1,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,
 1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,
 1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,
 0,0};

inline bool square( int64 x ) {
    // Quickfail
    if( x < 0 || (x&2) || ((x & 7) == 5) || ((x & 11) == 8) )
        return false;
    if( x == 0 )
        return true;

    // Check mod 255 = 3 * 5 * 17, for fun
    int64 y = x;
    y = (y & 4294967295LL) + (y >> 32);
    y = (y & 65535) + (y >> 16);
    y = (y & 255) + ((y >> 8) & 255) + (y >> 16);
    if( bad255[y] )
        return false;

    // Divide out powers of 4 using binary search
    if((x & 4294967295LL) == 0)
        x >>= 32;
    if((x & 65535) == 0)
        x >>= 16;
    if((x & 255) == 0)
        x >>= 8;
    if((x & 15) == 0)
        x >>= 4;
    if((x & 3) == 0)
        x >>= 2;

    if((x & 7) != 1)
        return false;

    // Compute sqrt using something like Hensel's lemma
    int64 r, t, z;
    r = start[(x >> 3) & 1023];
    do {
        z = x - r * r;
        if( z == 0 )
            return true;
        if( z < 0 )
            return false;
        t = z & (-z);
        r += (z & t) >> 1;
        if( r > (t  >> 1) )
            r = t - r;
    } while( t <= (1LL << 33) );

    return false;
}
```

* * *

## 回答 #2

> 赞同：440
> 
> 时间：2013-09-08T17:37:37.850

![](https://i.stack.imgur.com/UDUNr.png)

我参加聚会已经很晚了，但我希望提供更好的答案；更短并且（假设我的[基准测试](https://www.dropbox.com/s/ad4r6oxfcilqkch/IsSquareBenchmark.java?dl=0)是正确的）也[更快](https://microbenchmarks.appspot.com/runs/185f228a-fd9b-44b4-8a7a-48d12101aece)。

```
long goodMask; // 0xC840C04048404040 computed below
{
    for (int i=0; i<64; ++i) goodMask |= Long.MIN_VALUE >>> (i*i);
}

public boolean isSquare(long x) {
    // This tests if the 6 least significant bits are right.
    // Moving the to be tested bit to the highest position saves us masking.
    if (goodMask << x >= 0) return false;
    final int numberOfTrailingZeros = Long.numberOfTrailingZeros(x);
    // Each square ends with an even number of zeros.
    if ((numberOfTrailingZeros & 1) != 0) return false;
    x >>= numberOfTrailingZeros;
    // Now x is either 0 or odd.
    // In binary each odd square ends with 001.
    // Postpone the sign test until now; handle zero in the branch.
    if ((x&7) != 1 | x <= 0) return x == 0;
    // Do it in the classical way.
    // The correctness is not trivial as the conversion from long to double is lossy!
    final long tst = (long) Math.sqrt(x);
    return tst * tst == x;
} 
```

第一个测试快速捕获大多数非正方形。它使用一个包含 64 项的长表，因此没有数组访问成本（间接和边界检查）。对于均匀随机`long`的 ，有 81.25% 的概率在这里结束。

第二个测试捕获所有在因式分解中具有奇数个二的数字。该方法`Long.numberOfTrailingZeros`非常快，因为它将 JIT 编入单个 i86 指令。

删除尾随零后，第三个测试处理以二进制结尾的 011、101 或 111 的数字，它们不是完美的正方形。它还关心负数并处理 0。

最后的测试回到`double`算术。由于`double`只有 53 位尾数，从`long`to的转换`double`包括对大值的舍入。尽管如此，测试是正确的（除非[证明](https://math.stackexchange.com/questions/237865/show-that-floating-point-sqrtx-cdot-x-geq-x-for-all-long-x)是错误的）。

试图合并 mod255 的想法并不成功。

* * *

## 回答 #3

> 赞同：136
> 
> 时间：2008-11-17T14:27:17.310

你必须做一些基准测试。最佳算法将取决于输入的分布。

您的算法可能接近最优，但您可能需要在调用平方根例程之前快速检查以排除一些可能性。例如，通过按位“与”来查看十六进制数字的最后一位数字。完美的平方只能以 16 为底以 0、1、4 或 9 结尾，因此对于 75% 的输入（假设它们是均匀分布的），您可以避免调用平方根以换取一些非常快速的位旋转。

Kip 对以下实现十六进制技巧的代码进行了基准测试。在测试数字 1 到 100,000,000 时，此代码的运行速度是原始代码的两倍。

```
public final static boolean isPerfectSquare(long n)
{
    if (n < 0)
        return false;

    switch((int)(n & 0xF))
    {
    case 0: case 1: case 4: case 9:
        long tst = (long)Math.sqrt(n);
        return tst*tst == n;

    default:
        return false;
    }
} 
```

当我在 C++ 中测试类似代码时，它的运行速度实际上比原来的要慢。但是，当我消除 switch 语句时，十六进制技巧再次使代码速度提高了一倍。

```
int isPerfectSquare(int n)
{
    int h = n & 0xF;  // h is the last hex "digit"
    if (h > 9)
        return 0;
    // Use lazy evaluation to jump out of the if statement as soon as possible
    if (h != 2 && h != 3 && h != 5 && h != 6 && h != 7 && h != 8)
    {
        int t = (int) floor( sqrt((double) n) + 0.5 );
        return t*t == n;
    }
    return 0;
} 
```

消除 switch 语句对 C# 代码几乎没有影响。

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2008-11-17T13:50:19.817

我在想我在数值分析课程中度过的可怕时光。

然后我记得，有一个函数在 Quake 源代码中的“网络”周围盘旋：

```
float Q_rsqrt( float number )
{
  long i;
  float x2, y;
  const float threehalfs = 1.5F;

  x2 = number * 0.5F;
  y  = number;
  i  = * ( long * ) &y;  // evil floating point bit level hacking
  i  = 0x5f3759df - ( i >> 1 ); // wtf?
  y  = * ( float * ) &i;
  y  = y * ( threehalfs - ( x2 * y * y ) ); // 1st iteration
  // y  = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed

  #ifndef Q3_VM
  #ifdef __linux__
    assert( !isnan(y) ); // bk010122 - FPE?
  #endif
  #endif
  return y;
} 
```

它基本上计算平方根，使用牛顿的近似函数（不记得确切的名称）。

它应该是可用的，甚至可能更快，它来自一个现象级的 id 软件游戏！

它是用 C++ 编写的，但是一旦你明白了，在 Java 中重用相同的技术应该不会太难：

我最初在以下位置找到它： http: [//www.codemaestro.com/reviews/9](http://www.codemaestro.com/reviews/9)

牛顿的方法在维基百科上解释：[http ://en.wikipedia.org/wiki/Newton%27s_method](http://en.wikipedia.org/wiki/Newton%27s_method)

您可以点击链接以获取有关其工作原理的更多说明，但如果您不太在意，那么这大致就是我从阅读博客和参加数值分析课程时所记得的：

*   这`* (long*) &y`基本上是一个快速转换为长的函数，因此可以对原始字节应用整数运算。
*   该`0x5f3759df - (i >> 1);`线是近似函数的预先计算的种子值。
*   将`* (float*) &i`值转换回浮点数。
*   该`y = y * ( threehalfs - ( x2 * y * y ) )`行基本上再次迭代函数的值。

逼近函数提供的值越精确，您在结果上迭代的次数越多。在 Quake 的情况下，一次迭代“足够好”，但如果它不适合您……那么您可以根据需要添加尽可能多的迭代。

这应该更快，因为它将天真的平方根中完成的除法运算次数减少到简单的除以 2（实际上是`* 0.5F`乘法运算），并用几个固定数量的乘法运算代替它。

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2008-11-17T13:51:45.867

我不确定它是否会更快，甚至更准确，但您可以使用[John Carmack 的 Magical Square Root](https://web.archive.org/web/20081106174735/http://www.codemaestro.com/reviews/9)算法更快地求解平方根。您可能可以轻松地测试所有可能的 32 位整数，并验证您实际上得到了正确的结果，因为它只是一个近似值。但是，现在我考虑一下，使用双打也是近似的，所以我不确定这将如何发挥作用。

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2008-11-17T13:50:48.710

如果您进行二进制切分以尝试找到“正确的”平方根，您可以相当容易地检测到您所获得的值是否足够接近以判断：

```
(n+1)^2 = n^2 + 2n + 1
(n-1)^2 = n^2 - 2n + 1 
```

因此，计算`n^2`后，选项是：

*   `n^2 = target`: 完成，返回真
*   `n^2 + 2n + 1 > target > n^2`：你很接近，但它并不完美：return false
*   `n^2 - 2n + 1 < target < n^2`: 同上
*   `target < n^2 - 2n + 1`：在较低的二进制印章`n`
*   `target > n^2 + 2n + 1`：更高的二进制印章`n`

（对不起，这`n`用作您当前的猜测和`target`参数。为混淆道歉！）

我不知道这是否会更快，但值得一试。

编辑：二进制印章也不必包含整个整数范围`(2^x)^2 = 2^(2x)`，因此，一旦您在目标中找到了最高设置位（可以通过位旋转技巧来完成；我完全忘记了如何）您可以快速获得一系列可能的答案。请注意，一个简单的二元切割仍然只需要 31 或 32 次迭代。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2013-06-10T16:39:07.577

我对这个线程中的几个算法进行了自己的分析，并得出了一些新结果。您可以在此答案的编辑历史记录中看到这些旧结果，但它们并不准确，因为我犯了一个错误，并且浪费了时间分析几种不接近的算法。然而，从几个不同的答案中吸取教训，我现在有两种算法可以粉碎这个线程的“赢家”。这是我做的与其他人不同的核心事情：

```
// This is faster because a number is divisible by 2^4 or more only 6% of the time
// and more than that a vanishingly small percentage.
while((x & 0x3) == 0) x >>= 2;
// This is effectively the same as the switch-case statement used in the original
// answer. 
if((x & 0x7) != 1) return false; 
```

然而，这个简单的行，大多数时候添加一两个非常快速的指令，将`switch-case`语句大大简化为一个 if 语句。但是，如果许多测试数字具有显着的二次幂因子，它可以增加运行时间。

下面的算法如下：

*   **互联网**- Kip 发布的答案
*   **Durron** - 我使用一次性答案作为基础的修改答案
*   **DurronTwo** - 我使用两遍答案的修改答案（@JohnnyHeggheim），还有一些其他的细微修改。

如果数字是使用生成的，这是一个示例运行时`Math.abs(java.util.Random.nextLong())`

```
 0% Scenario{vm=java, trial=0, benchmark=Internet} 39673.40 ns; ?=378.78 ns @ 3 trials
33% Scenario{vm=java, trial=0, benchmark=Durron} 37785.75 ns; ?=478.86 ns @ 10 trials
67% Scenario{vm=java, trial=0, benchmark=DurronTwo} 35978.10 ns; ?=734.10 ns @ 10 trials

benchmark   us linear runtime
 Internet 39.7 ==============================
   Durron 37.8 ============================
DurronTwo 36.0 ===========================

vm: java
trial: 0 
```

这是一个示例运行时，如果它仅在前一百万个 long 上运行：

```
 0% Scenario{vm=java, trial=0, benchmark=Internet} 2933380.84 ns; ?=56939.84 ns @ 10 trials
33% Scenario{vm=java, trial=0, benchmark=Durron} 2243266.81 ns; ?=50537.62 ns @ 10 trials
67% Scenario{vm=java, trial=0, benchmark=DurronTwo} 3159227.68 ns; ?=10766.22 ns @ 3 trials

benchmark   ms linear runtime
 Internet 2.93 ===========================
   Durron 2.24 =====================
DurronTwo 3.16 ==============================

vm: java
trial: 0 
```

正如你所看到的，`DurronTwo`对于大输入做得更好，因为它经常使用魔术，但与第一个算法相比，它被破坏了，`Math.sqrt`因为数字要小得多。同时，更简单`Durron`的是一个巨大的赢家，因为它在前一百万个数字中不必多次除以 4。

这是`Durron`：

```
public final static boolean isPerfectSquareDurron(long n) {
    if(n < 0) return false;
    if(n == 0) return true;

    long x = n;
    // This is faster because a number is divisible by 16 only 6% of the time
    // and more than that a vanishingly small percentage.
    while((x & 0x3) == 0) x >>= 2;
    // This is effectively the same as the switch-case statement used in the original
    // answer. 
    if((x & 0x7) == 1) {

        long sqrt;
        if(x < 410881L)
        {
            int i;
            float x2, y;

            x2 = x * 0.5F;
            y  = x;
            i  = Float.floatToRawIntBits(y);
            i  = 0x5f3759df - ( i >> 1 );
            y  = Float.intBitsToFloat(i);
            y  = y * ( 1.5F - ( x2 * y * y ) );

            sqrt = (long)(1.0F/y);
        } else {
            sqrt = (long) Math.sqrt(x);
        }
        return sqrt*sqrt == x;
    }
    return false;
} 
```

和`DurronTwo`

```
public final static boolean isPerfectSquareDurronTwo(long n) {
    if(n < 0) return false;
    // Needed to prevent infinite loop
    if(n == 0) return true;

    long x = n;
    while((x & 0x3) == 0) x >>= 2;
    if((x & 0x7) == 1) {
        long sqrt;
        if (x < 41529141369L) {
            int i;
            float x2, y;

            x2 = x * 0.5F;
            y = x;
            i = Float.floatToRawIntBits(y);
            //using the magic number from 
            //http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf
            //since it more accurate
            i = 0x5f375a86 - (i >> 1);
            y = Float.intBitsToFloat(i);
            y = y * (1.5F - (x2 * y * y));
            y = y * (1.5F - (x2 * y * y)); //Newton iteration, more accurate
            sqrt = (long) ((1.0F/y) + 0.2);
        } else {
            //Carmack hack gives incorrect answer for n >= 41529141369.
            sqrt = (long) Math.sqrt(x);
        }
        return sqrt*sqrt == x;
    }
    return false;
} 
```

还有我的基准线束：（需要 Google caliper 0.1-rc5）

```
public class SquareRootBenchmark {
    public static class Benchmark1 extends SimpleBenchmark {
        private static final int ARRAY_SIZE = 10000;
        long[] trials = new long[ARRAY_SIZE];

        @Override
        protected void setUp() throws Exception {
            Random r = new Random();
            for (int i = 0; i < ARRAY_SIZE; i++) {
                trials[i] = Math.abs(r.nextLong());
            }
        }

        public int timeInternet(int reps) {
            int trues = 0;
            for(int i = 0; i < reps; i++) {
                for(int j = 0; j < ARRAY_SIZE; j++) {
                    if(SquareRootAlgs.isPerfectSquareInternet(trials[j])) trues++;
                }
            }

            return trues;   
        }

        public int timeDurron(int reps) {
            int trues = 0;
            for(int i = 0; i < reps; i++) {
                for(int j = 0; j < ARRAY_SIZE; j++) {
                    if(SquareRootAlgs.isPerfectSquareDurron(trials[j])) trues++;
                }
            }

            return trues;   
        }

        public int timeDurronTwo(int reps) {
            int trues = 0;
            for(int i = 0; i < reps; i++) {
                for(int j = 0; j < ARRAY_SIZE; j++) {
                    if(SquareRootAlgs.isPerfectSquareDurronTwo(trials[j])) trues++;
                }
            }

            return trues;   
        }
    }

    public static void main(String... args) {
        Runner.main(Benchmark1.class, args);
    }
} 
```

**更新：**我制作了一种新算法，在某些情况下更快，在其他情况下更慢，我已经根据不同的输入获得了不同的基准。如果我们计算模数`0xFFFFFF = 3 x 3 x 5 x 7 x 13 x 17 x 241`，我们可以消除 97.82% 的不能为平方的数字。这可以（在某种程度上）在一行中完成，使用 5 次按位操作：

```
if (!goodLookupSquares[(int) ((n & 0xFFFFFFl) + ((n >> 24) & 0xFFFFFFl) + (n >> 48))]) return false; 
```

结果索引是 1) 残基，2) 残基`+ 0xFFFFFF`，或 3) 残基`+ 0x1FFFFFE`。当然，我们需要有一个残基模数查找表`0xFFFFFF`，它大约是一个 3mb 文件（在这种情况下，存储为 ascii 文本十进制数字，不是最佳的，但显然可以用 a`ByteBuffer`等来改进。但由于这是预先计算，它不会没关系。[你可以在这里找到文件](http://www.stwing.org/~martinja/24residues_squares.txt)（或自己生成）：

```
public final static boolean isPerfectSquareDurronThree(long n) {
    if(n < 0) return false;
    if(n == 0) return true;

    long x = n;
    while((x & 0x3) == 0) x >>= 2;
    if((x & 0x7) == 1) {
        if (!goodLookupSquares[(int) ((n & 0xFFFFFFl) + ((n >> 24) & 0xFFFFFFl) + (n >> 48))]) return false;
        long sqrt;
        if(x < 410881L)
        {
            int i;
            float x2, y;

            x2 = x * 0.5F;
            y  = x;
            i  = Float.floatToRawIntBits(y);
            i  = 0x5f3759df - ( i >> 1 );
            y  = Float.intBitsToFloat(i);
            y  = y * ( 1.5F - ( x2 * y * y ) );

            sqrt = (long)(1.0F/y);
        } else {
            sqrt = (long) Math.sqrt(x);
        }
        return sqrt*sqrt == x;
    }
    return false;
} 
```

我将它加载到这样的`boolean`数组中：

```
private static boolean[] goodLookupSquares = null;

public static void initGoodLookupSquares() throws Exception {
    Scanner s = new Scanner(new File("24residues_squares.txt"));

    goodLookupSquares = new boolean[0x1FFFFFE];

    while(s.hasNextLine()) {
        int residue = Integer.valueOf(s.nextLine());
        goodLookupSquares[residue] = true;
        goodLookupSquares[residue + 0xFFFFFF] = true;
        goodLookupSquares[residue + 0x1FFFFFE] = true;
    }

    s.close();
} 
```

示例运行时。在我运行的每次试验中，它都击败了`Durron`（第一版）。

```
 0% Scenario{vm=java, trial=0, benchmark=Internet} 40665.77 ns; ?=566.71 ns @ 10 trials
33% Scenario{vm=java, trial=0, benchmark=Durron} 38397.60 ns; ?=784.30 ns @ 10 trials
67% Scenario{vm=java, trial=0, benchmark=DurronThree} 36171.46 ns; ?=693.02 ns @ 10 trials

  benchmark   us linear runtime
   Internet 40.7 ==============================
     Durron 38.4 ============================
DurronThree 36.2 ==========================

vm: java
trial: 0 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2008-11-17T14:58:24.453

[使用牛顿法](http://en.wikipedia.org/wiki/Newton%27s_method)计算[Integer Square Root](http://en.wikipedia.org/wiki/Integer_square_root)应该快得多，然后将这个数字平方并检查，就像您在当前解决方案中所做的那样。牛顿法是其他一些答案中提到的卡马克解决方案的基础。您应该能够获得更快的答案，因为您只对根的整数部分感兴趣，从而可以更快地停止近似算法。

您可以尝试的另一种优化：如果数字的[数字根](http://en.wikipedia.org/wiki/Digital_root)不是以 1、4、7 或 9 结尾，则该数字**不是**完美的平方。这可以用作在应用较慢的平方根算法之前消除 60% 输入的快速方法。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-11-18T15:57:44.473

> 我希望这个函数适用于所有正的 64 位有符号整数

`Math.sqrt()`使用双精度作为输入参数，因此对于大于**2^53**的整数，您将无法获得准确的结果。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2008-12-02T10:00:22.837

仅作记录，另一种方法是使用素数分解。如果分解的每个因素都是偶数，那么这个数字是一个完美的平方。所以你想要的是看看一个数字是否可以分解为素数平方的乘积。当然，你不需要得到这样的分解，只要看看它是否存在。

首先建立一个小于 2^32 的素数平方表。这远小于包含此限制的所有整数的表。

一个解决方案将是这样的：

```
boolean isPerfectSquare(long number)
{
    if (number < 0) return false;
    if (number < 2) return true;

    for (int i = 0; ; i++)
    {
        long square = squareTable[i];
        if (square > number) return false;
        while (number % square == 0)
        {
            number /= square;
        }
        if (number == 1) return true;
    }
} 
```

我想这有点神秘。它所做的是在每一步中检查素数的平方除以输入数。如果是这样，那么它会尽可能地将数字除以平方，以从素数分解中删除该平方。如果通过这个过程，我们得到 1，那么输入数字是素数平方的分解。如果平方变得大于数字本身，那么这个平方或任何更大的平方都无法分割它，因此该数字不能是素数平方的分解。

鉴于如今的 sqrt 在硬件中完成并且需要在这里计算素数，我想这个解决方案要慢得多。但正如 mrzl 在他的回答中所说，它应该比使用 sqrt 的解决方案提供更好的结果，因为 sqrt 不能超过 2^54。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2013-10-15T15:48:34.123

整数问题需要整数解。因此

对（非负）整数进行二进制搜索以找到最大整数 t 使得`t**2 <= n`. 然后测试是否`r**2 = n`准确。这需要时间 O(log n)。

如果你不知道如何对正整数进行二进制搜索，因为集合是无界的，这很容易。你首先计算你的递增函数 f （上图`f(t) = t**2 - n`） 2 的幂。当你看到它变成正数时，你已经找到了一个上限。然后你可以进行标准的二分搜索。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2008-11-29T03:52:36.310

有人指出，`d`完美正方形的最后一位数字只能取某些值。一个数字的最后一位`d`（以 为基数`b`）与除以`n`时的余数相同，即。用 C 表示法。`n``b`^(`d`)`n % pow(b, d)`

这可以推广到任何模数`m`，即。`n % m`可用于排除某些百分比的数字不是完美的正方形。您当前使用的模数是 64，它允许 12，即。19% 的余数，尽可能为正方形。通过一点编码，我找到了模数 110880，它只允许 2016，即。余数的 1.8% 作为可能的正方形。因此，根据模数运算（即除法）和表查找与机器上的平方根的成本，使用此模数可能会更快。

顺便说一句，如果 Java 有办法存储查找表的压缩位数组，请不要使用它。如今，110880 个 32 位字的 RAM 并不多，获取机器字将比获取单个位更快。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2014-07-13T10:17:15.427

maaartinus 解决方案的以下简化似乎在运行时减少了几个百分点，但我在基准测试方面还不够好，无法生成我可以信任的基准：

```
long goodMask; // 0xC840C04048404040 computed below
{
    for (int i=0; i<64; ++i) goodMask |= Long.MIN_VALUE >>> (i*i);
}

public boolean isSquare(long x) {
    // This tests if the 6 least significant bits are right.
    // Moving the to be tested bit to the highest position saves us masking.
    if (goodMask << x >= 0) return false;
    // Remove an even number of trailing zeros, leaving at most one.
    x >>= (Long.numberOfTrailingZeros(x) & (-2);
    // Repeat the test on the 6 least significant remaining bits.
    if (goodMask << x >= 0 | x <= 0) return x == 0;
    // Do it in the classical way.
    // The correctness is not trivial as the conversion from long to double is lossy!
    final long tst = (long) Math.sqrt(x);
    return tst * tst == x;
} 
```

值得检查如何省略第一个测试，

```
if (goodMask << x >= 0) return false; 
```

会影响性能。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2008-12-05T05:36:38.903

为了性能，您经常不得不做出一些妥协。其他人已经表达了各种方法，但是，您注意到 Carmack 的 hack 在 N 的某些值下更快。然后，您应该检查“n”，如果它小于该数字 N，请使用 Carmack 的 hack，否则使用描述的其他方法在这里的答案中。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2010-05-06T13:29:10.273

这是我能想到的最快的 Java 实现，它结合了这个线程中其他人建议的技术。

*   Mod-256 测试
*   不精确的 mod-3465 测试（以一些误报为代价避免整数除法）
*   浮点平方根，四舍五入并与输入值比较

我还尝试了这些修改，但它们对性能没有帮助：

*   额外的 mod-255 测试
*   将输入值除以 4 的幂
*   Fast Inverse Square Root（对于 N 的高值，它需要 3 次迭代，足以使其比硬件平方根函数慢。）

```
public class SquareTester {

    public static boolean isPerfectSquare(long n) {
        if (n < 0) {
            return false;
        } else {
            switch ((byte) n) {
            case -128: case -127: case -124: case -119: case -112:
            case -111: case -103: case  -95: case  -92: case  -87:
            case  -79: case  -71: case  -64: case  -63: case  -60:
            case  -55: case  -47: case  -39: case  -31: case  -28:
            case  -23: case  -15: case   -7: case    0: case    1:
            case    4: case    9: case   16: case   17: case   25:
            case   33: case   36: case   41: case   49: case   57:
            case   64: case   65: case   68: case   73: case   81:
            case   89: case   97: case  100: case  105: case  113:
            case  121:
                long i = (n * INV3465) >>> 52;
                if (! good3465[(int) i]) {
                    return false;
                } else {
                    long r = round(Math.sqrt(n));
                    return r*r == n; 
                }
            default:
                return false;
            }
        }
    }

    private static int round(double x) {
        return (int) Double.doubleToRawLongBits(x + (double) (1L << 52));
    }

    /** 3465<sup>-1</sup> modulo 2<sup>64</sup> */
    private static final long INV3465 = 0x8ffed161732e78b9L;

    private static final boolean[] good3465 =
        new boolean[0x1000];

    static {
        for (int r = 0; r < 3465; ++ r) {
            int i = (int) ((r * r * INV3465) >>> 52);
            good3465[i] = good3465[i+1] = true;
        }
    }

} 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2009-01-01T22:12:38.813

你应该从一开始就去掉 N 的 2 次方部分。

**第二次编辑** 下面 m 的神奇表达式应该是

```
m = N - (N & (N-1)); 
```

而不是写的

**第二次编辑结束**

```
m = N & (N-1); // the lawest bit of N
N /= m;
byte = N & 0x0F;
if ((m % 2) || (byte !=1 && byte !=9))
  return false; 
```

**第一次编辑：**

小改进：

```
m = N & (N-1); // the lawest bit of N
N /= m;
if ((m % 2) || (N & 0x07 != 1))
  return false; 
```

**第一次编辑结束**

现在像往常一样继续。这样，当你到达浮点部分时，你已经摆脱了所有 2 次方为奇数的数字（大约一半），然后你只考虑剩下的 1/8。即，您在 6% 的数字上运行浮点部分。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2009-03-25T15:23:05.457

标签中提到了 Project Euler，其中的许多问题都需要检查数字 >> `2^64`。当您使用 80 字节缓冲区时，上面提到的大多数优化都不容易工作。

我使用了 java BigInteger 和牛顿方法的略微修改版本，它对整数效果更好。问题是精确平方`n^2`收敛到`(n-1)`而不是`n`因为`n^2-1 = (n-1)(n+1)`，最终误差仅比最终除数低一步，算法终止。通过在计算错误之前向原始参数添加一个很容易修复。（为立方根等添加两个）

该算法的一个很好的特性是您可以立即判断该数字是否为完美平方 - 牛顿方法中的最终误差（非校正）将为零。一个简单的修改还可以让您快速计算`floor(sqrt(x))`而不是最接近的整数。这对于几个欧拉问题很方便。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2009-01-01T22:27:43.587

这是旧的 Marchant 计算器算法从十进制到二进制的返工（对不起，我没有参考），在 Ruby 中，专门针对这个问题进行了调整：

```
def isexactsqrt(v)
    value = v.abs
    residue = value
    root = 0
    onebit = 1
    onebit <<= 8 while (onebit < residue)
    onebit >>= 2 while (onebit > residue)
    while (onebit > 0)
        x = root + onebit
        if (residue >= x) then
            residue -= x
            root = x + onebit
        end
        root >>= 1
        onebit >>= 2
    end
    return (residue == 0)
end 
```

这是一个类似的工作（请不要因为编码风格/气味或笨拙的 O/O 而投票给我 - 这是重要的算法，C++ 不是我的母语）。在这种情况下，我们正在寻找残差 == 0：

```
#include <iostream>  

using namespace std;  
typedef unsigned long long int llint;

class ISqrt {           // Integer Square Root
    llint value;        // Integer whose square root is required
    llint root;         // Result: floor(sqrt(value))
    llint residue;      // Result: value-root*root
    llint onebit, x;    // Working bit, working value

public:

    ISqrt(llint v = 2) {    // Constructor
        Root(v);            // Take the root 
    };

    llint Root(llint r) {   // Resets and calculates new square root
        value = r;          // Store input
        residue = value;    // Initialise for subtracting down
        root = 0;           // Clear root accumulator

        onebit = 1;                 // Calculate start value of counter
        onebit <<= (8*sizeof(llint)-2);         // Set up counter bit as greatest odd power of 2 
        while (onebit > residue) {onebit >>= 2; };  // Shift down until just < value

        while (onebit > 0) {
            x = root ^ onebit;          // Will check root+1bit (root bit corresponding to onebit is always zero)
            if (residue >= x) {         // Room to subtract?
                residue -= x;           // Yes - deduct from residue
                root = x + onebit;      // and step root
            };
            root >>= 1;
            onebit >>= 2;
        };
        return root;                    
    };
    llint Residue() {           // Returns residue from last calculation
        return residue;                 
    };
};

int main() {
    llint big, i, q, r, v, delta;
    big = 0; big = (big-1);         // Kludge for "big number"
    ISqrt b;                            // Make q sqrt generator
    for ( i = big; i > 0 ; i /= 7 ) {   // for several numbers
        q = b.Root(i);                  // Get the square root
        r = b.Residue();                // Get the residue
        v = q*q+r;                      // Recalc original value
        delta = v-i;                    // And diff, hopefully 0
        cout << i << ": " << q << " ++ " << r << " V: " << v << " Delta: " << delta << "\n";
    };
    return 0;
}; 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2009-03-11T13:25:05.237

如前所述， sqrt 调用并不完全准确，但有趣且有启发性的是，它不会在速度方面吹走其他答案。毕竟，sqrt 的汇编语言指令序列很小。英特尔有一个硬件指令，我相信 Java 不使用它，因为它不符合 IEEE。

那为什么慢呢？因为 Java 实际上是通过 JNI 调用 C 例程，而且这样做实际上比调用 Java 子例程要慢，而 Java 子例程本身比内联调用要慢。这很烦人，Java 应该想出一个更好的解决方案，即在必要时构建浮点库调用。那好吧。

在 C++ 中，我怀疑所有复杂的替代方案都会降低速度，但我还没有全部检查过。我所做的，以及 Java 人会发现有用的，是一个简单的 hack，是 A. Rex 建议的特殊情况测试的扩展。使用单个 long 值作为位数组，不检查边界。这样，您就有了 64 位布尔查找。

```
typedef unsigned long long UVLONG
UVLONG pp1,pp2;

void init2() {
  for (int i = 0; i < 64; i++) {
    for (int j = 0; j < 64; j++)
      if (isPerfectSquare(i * 64 + j)) {
    pp1 |= (1 << j);
    pp2 |= (1 << i);
    break;
      }
   }
   cout << "pp1=" << pp1 << "," << pp2 << "\n";  
}

inline bool isPerfectSquare5(UVLONG x) {
  return pp1 & (1 << (x & 0x3F)) ? isPerfectSquare(x) : false;
} 
```

例程 isPerfectSquare5 在我的 core2 duo 机器上运行的时间大约是 1/3。我怀疑沿着相同的路线进行进一步的调整可以进一步减少平均时间，但是每次你检查时，你都是在用更多的测试来换取更多的消除，所以你不能在这条路上走得太远。

当然，您可以用同样的方法检查高 6 位，而不是单独测试阴性。

请注意，我所做的只是消除可能的正方形，但是当我有潜在的情况时，我必须调用原始的内联 isPerfectSquare。

init2 例程被调用一次以初始化 pp1 和 pp2 的静态值。请注意，在我的 C++ 实现中，我使用的是 unsigned long long，所以既然您已签名，就必须使用 >>> 运算符。

对数组进行边界检查没有本质上的需要，但是 Java 的优化器必须很快解决这些问题，所以我不怪他们。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2009-05-25T01:22:28.583

我喜欢在某些输入上使用几乎正确的方法的想法。这是一个具有更高“偏移量”的版本。该代码似乎工作并通过了我的简单测试用例。

只需更换您的：

```
if(n < 410881L){...} 
```

这个代码：

```
if (n < 11043908100L) {
    //John Carmack hack, converted to Java.
    // See: http://www.codemaestro.com/reviews/9
    int i;
    float x2, y;

    x2 = n * 0.5F;
    y = n;
    i = Float.floatToRawIntBits(y);
    //using the magic number from 
    //http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf
    //since it more accurate
    i = 0x5f375a86 - (i >> 1);
    y = Float.intBitsToFloat(i);
    y = y * (1.5F - (x2 * y * y));
    y = y * (1.5F - (x2 * y * y)); //Newton iteration, more accurate

    sqrt = Math.round(1.0F / y);
} else {
    //Carmack hack gives incorrect answer for n >= 11043908100.
    sqrt = (long) Math.sqrt(n);
} 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2010-12-04T01:22:34.910

考虑到一般位长（尽管我在这里使用了特定类型），我尝试设计如下简单的算法。最初需要对 0、1、2 或 <0 进行简单而明显的检查。从某种意义上说，以下很简单，它不会尝试使用任何现有的数学函数。大多数运算符可以替换为按位运算符。不过，我还没有使用任何基准数据进行测试。我既不是数学专家，也不是计算机算法设计方面的专家，我很乐意看到你指出问题。我知道那里有很多改进的机会。

```
int main()
{
    unsigned int c1=0 ,c2 = 0;  
    unsigned int x = 0;  
    unsigned int p = 0;  
    int k1 = 0;  
    scanf("%d",&p);  
    if(p % 2 == 0) {  
        x = p/2; 
    }  
    else {  
        x = (p/2) +1;  
    }  
    while(x) 
    {
        if((x*x) > p) {  
            c1 = x;  
            x = x/2; 
        }else {  
            c2 = x;  
            break;  
        }  
    }  
    if((p%2) != 0)  
        c2++;

    while(c2 < c1) 
    {  
        if((c2 * c2 ) == p) {  
            k1 = 1;  
            break;  
        }  
        c2++; 
    }  
    if(k1)  
        printf("\n Perfect square for %d", c2);  
    else  
        printf("\n Not perfect but nearest to :%d :", c2);  
    return 0;  
} 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2011-12-04T04:30:52.463

当观察到正方形的最后 n 位时，我检查了所有可能的结果。通过连续检查更多位，可以消除多达 5/6 的输入。我实际上设计了这个来实现费马的因式分解算法，而且速度非常快。

```
public static boolean isSquare(final long val) {
   if ((val & 2) == 2 || (val & 7) == 5) {
     return false;
   }
   if ((val & 11) == 8 || (val & 31) == 20) {
     return false;
   }

   if ((val & 47) == 32 || (val & 127) == 80) {
     return false;
   }

   if ((val & 191) == 128 || (val & 511) == 320) {
     return false;
   }

   // if((val & a == b) || (val & c == d){
   //   return false;
   // }

   if (!modSq[(int) (val % modSq.length)]) {
        return false;
   }

   final long root = (long) Math.sqrt(val);
   return root * root == val;
} 
```

最后一点伪代码可用于扩展测试以消除更多值。上面的测试是针对 k = 0, 1, 2, 3

*   a 的形式为 (3 << 2k) - 1*   b 的形式为 (2 << 2k)*   c 的形式为 (2 << 2k + 2) - 1*   d 的形式为 (2 << 2k - 1) * 10

    它首先测试它是否具有模量为 2 的平方残差，然后基于最终模数进行测试，然后使用 Math.sqrt 进行最终测试。我从上面的帖子中提出了这个想法，并试图对其进行扩展。我感谢任何意见或建议。

    **更新：**使用模数 (modSq) 和模数基数 44352 进行的测试，我的测试在 OP 更新中高达 1,000,000,000 的数字的 96% 的时间内运行。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2018-10-17T22:49:54.223

# 具有整数算术的牛顿法

如果您希望避免非整数运算，可以使用以下方法。它基本上使用针对整数算术修改的牛顿法。

```
/**
 * Test if the given number is a perfect square.
 * @param n Must be greater than 0 and less
 *    than Long.MAX_VALUE.
 * @return <code>true</code> if n is a perfect
 *    square, or <code>false</code> otherwise.
 */
public static boolean isSquare(long n)
{
    long x1 = n;
    long x2 = 1L;

    while (x1 > x2)
    {
        x1 = (x1 + x2) / 2L;
        x2 = n / x1;
    }

    return x1 == x2 && n % x1 == 0L;
} 
```

此实现无法与使用`Math.sqrt`. 但是，可以通过使用其他一些帖子中描述的过滤机制来提高其性能。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-12-27T17:13:51.067

**这是一个分而治之的解决方案。**

如果自然数 ( ) 的平方根`number`是自然数 ( )，您可以根据 的位数`solution`轻松确定 的范围：`solution``number`

*   `number`有 1 位数字：`solution`在范围内 = 1 - 4
*   `number`有 2 位数字：`solution`范围 = 3 - 10
*   `number`有 3 位数字：`solution`在范围内 = 10 - 40
*   `number`有 4 位数字：`solution`在范围内 = 30 - 100
*   `number`有 5 位数字：`solution`在范围内 = 100 - 400

注意到重复了吗？

您可以在二进制搜索方法中使用此范围来查看是否存在`solution`以下内容：

```
number == solution * solution 
```

**这是代码**

这是我的课 SquareRootChecker

```
public class SquareRootChecker {

    private long number;
    private long initialLow;
    private long initialHigh;

    public SquareRootChecker(long number) {
        this.number = number;

        initialLow = 1;
        initialHigh = 4;
        if (Long.toString(number).length() % 2 == 0) {
            initialLow = 3;
            initialHigh = 10;
        }
        for (long i = 0; i < Long.toString(number).length() / 2; i++) {
            initialLow *= 10;
            initialHigh *= 10;
        }
        if (Long.toString(number).length() % 2 == 0) {
            initialLow /= 10;
            initialHigh /=10;
        }
    }

    public boolean checkSquareRoot() {
        return findSquareRoot(initialLow, initialHigh, number);
    }

    private boolean findSquareRoot(long low, long high, long number) {
        long check = low + (high - low) / 2;
        if (high >= low) {
            if (number == check * check) {
                return true;
            }
            else if (number < check * check) {
                high = check - 1;
                return findSquareRoot(low, high, number);
            }
            else  {
                low = check + 1;
                return findSquareRoot(low, high, number);
            }
        }
        return false;
    }

} 
```

这是一个如何使用它的例子。

```
long number =  1234567;
long square = number * number;
SquareRootChecker squareRootChecker = new SquareRootChecker(square);
System.out.println(square + ": " + squareRootChecker.checkSquareRoot()); //Prints "1524155677489: true"

long notSquare = square + 1;
squareRootChecker = new SquareRootChecker(notSquare);
System.out.println(notSquare + ": " + squareRootChecker.checkSquareRoot()); //Prints "1524155677490: false" 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-11-01T07:53:17.923

一个数字的平方根，假设该数字是一个完美的平方。

复杂度为 log(n)

```
/**
 * Calculate square root if the given number is a perfect square.
 * 
 * Approach: Sum of n odd numbers is equals to the square root of n*n, given 
 * that n is a perfect square.
 *
 * @param number
 * @return squareRoot
 */

public static int calculateSquareRoot(int number) {

    int sum=1;
    int count =1;
    int squareRoot=1;
    while(sum<number) {
        count+=2;
        sum+=count;
        squareRoot++;
    }
    return squareRoot;
} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-11-17T23:29:58.337

如果速度是一个问题，为什么不将最常用的输入集及其值划分到查找表中，然后针对特殊情况执行任何优化的魔法算法？

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-02-22T06:22:01.027

应该可以比这更有效地打包“如果最后 X 位是 N，则不能是完美的正方形”！我将使用 java 32 位整数，并生成足够的数据来检查数字的最后 16 位——即 2048 个十六进制整数值。

...

行。要么我遇到了一些超出我能力的数论，要么我的代码中有错误。无论如何，这里是代码：

```
public static void main(String[] args) {
    final int BITS = 16;

    BitSet foo = new BitSet();

    for(int i = 0; i< (1<<BITS); i++) {
        int sq = (i*i);
        sq = sq & ((1<<BITS)-1);
        foo.set(sq);
    }

    System.out.println("int[] mayBeASquare = {");

    for(int i = 0; i< 1<<(BITS-5); i++) {
        int kk = 0;
        for(int j = 0; j<32; j++) {
            if(foo.get((i << 5) | j)) {
                kk |= 1<<j;
            }
        }
        System.out.print("0x" + Integer.toHexString(kk) + ", ");
        if(i%8 == 7) System.out.println();
    }
    System.out.println("};");
} 
```

结果如下：

（ed：因为 prettify.js 的性能不佳而被省略；查看修订历史以查看。）

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2009-09-24T09:46:57.980

“我正在寻找最快的方法来确定一个长值是否是一个完美的平方（即它的平方根是另一个整数）。”

答案令人印象深刻，但我没有看到一个简单的检查：

检查 long it 右边的第一个数字是否是集合 (0,1,4,5,6,9) 的成员。如果不是，那么它不可能是一个“完美的正方形”。

例如。

4567 - 不可能是完美的正方形。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-10-12T23:08:19.120

这是最简单和最简洁的方法，虽然我不知道它在 CPU 周期方面的比较。如果您只想知道根是否为整数，则此方法非常有用。如果你真的关心它是否是一个整数，你也可以算出来。这是一个简单（纯粹）的功能：

```
private static final MathContext precision = new MathContext(20);

private static final Function<Long, Boolean> isRootWhole = (n) -> {
    long digit = n % 10;
    if (digit == 2 || digit == 3 || digit == 7 || digit == 8) {
        return false;
    }
    return new BigDecimal(n).sqrt(precision).scale() == 0;
}; 
```

如果您不需要微优化，那么这个答案在简单性和可维护性方面会更好。如果要计算负数，则需要相应地处理，并将绝对值发送到函数中。我已经包含了一个小的优化，因为由于二次残差 mod 10，没有完美的正方形具有 2、3、7 或 8 的十位数。

在我的 CPU 上，在 0 - 10,000,000 上运行该算法，每次计算平均需要 1000 - 1100 纳秒。

如果您执行的计算数量较少，则较早的计算需要更长的时间。

我有一个负面评论，说我之前的编辑不适用于大量数字。OP提到了Longs，Long的最大完美正方形是9223372030926249001，所以这种方法适用于所有Longs。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2018-12-27T02:42:56.340

用牛顿法计算平方根非常快……只要起始值合理。然而，没有合理的起始值，实际上我们以二等分和 log(2^64) 行为结束。
为了真正快速，我们需要一种快速的方法来获得合理的起始值，这意味着我们需要深入研究机器语言。如果处理器在 Pentium 中提供类似 POPCNT 的指令，它计算前导零，我们可以使用它来获得具有一半有效位的起始值。小心，我们可以找到一个固定数量的牛顿步，这总是足够的。（因此无需循环并具有非常快速的执行。）

第二种解决方案是通过浮点工具进行，它可能具有快速的 sqrt 计算（如 i87 协处理器）。甚至通过 exp() 和 log() 的偏移也可能比牛顿退化为二进制搜索更快。这有一个棘手的方面，即依赖于处理器的分析，分析之后需要进行哪些改进以及是否需要改进。

第三种解决方案解决了一个略有不同的问题，但值得一提，因为问题中描述了这种情况。如果你想为稍微不同的数字计算大量平方根，你可以使用牛顿迭代，如果你从不重新初始化起始值，而只是把它留在前面计算停止的地方。我在至少一个欧拉问题中成功地使用了它。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2019-01-19T13:44:25.317

可能是该问题的最佳算法是快速整数平方根算法[https://stackoverflow.com/a/51585204/5191852](https://stackoverflow.com/a/51585204/5191852)

@Kde 声称牛顿方法的三次迭代足以使 32 位整数的精度达到 ±1。当然，64 位整数需要更多的迭代，可能是 6 或 7。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-11-17T13:48:29.870

如果你想要速度，考虑到你的整数大小有限，我怀疑最快的方法是（a）按大小划分参数（例如，按最大位集划分类别），然后根据完美正方形数组检查值在那个范围内。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-03-11T13:18:14.003

关于 Carmac 方法，再次迭代似乎很容易，这应该会使准确度的位数增加一倍。毕竟，它是一种非常截断的迭代方法——牛顿法，第一次猜测非常好。

关于您目前的最佳表现，我看到了两个微优化：

*   使用 mod255 检查后将检查与 0 移动
*   重新排列四的除法以跳过通常（75％）情况的所有检查。

IE：

```
// Divide out powers of 4 using binary search

if((n & 0x3L) == 0) {
  n >>=2;

  if((n & 0xffffffffL) == 0)
    n >>= 32;
  if((n & 0xffffL) == 0)
      n >>= 16;
  if((n & 0xffL) == 0)
      n >>= 8;
  if((n & 0xfL) == 0)
      n >>= 4;
  if((n & 0x3L) == 0)
      n >>= 2;
} 
```

更好的可能是一个简单的

```
while ((n & 0x03L) == 0) n >>= 2; 
```

显然，知道每个检查点有多少数字被剔除会很有趣——我相当怀疑这些检查是否真正独立，这让事情变得棘手。

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2018-09-26T16:32:44.843

不确定这是否是最快的方法，但这是我（很久以前在高中时）在数学课上无聊和玩计算器时偶然发现的。当时，我真的很惊讶这能奏效......

```
public static boolean isIntRoot(int number) {
    return isIntRootHelper(number, 1);
}

private static boolean isIntRootHelper(int number, int index) {
    if (number == index) {
        return true;
    }
    if (number < index) {
        return false;
    }
    else {
        return isIntRootHelper(number - 2 * index, index + 1);
    }
} 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2022-02-24T21:20:59.097

```
static boolean isPerfectSquare (int input) {
  return Math.sqrt(input) == (int) Math.sqrt(input);
} 
```

如果平方根的整数值`input`等于双精度值，这将返回。这意味着它是一个整数，它将返回`true`. 否则，它将返回`false`。

* * *

## 回答 #36

> 赞同：-3
> 
> 时间：2008-11-17T13:57:20.647

不知道最快，但最简单的是以正常方式取平方根，将结果乘以自己，看看它是否与您的原始值匹配。

由于我们在这里讨论整数，所以禁食可能会涉及一个集合，您可以在其中进行查找。

# asp.net-mvc - Microsoft 站点之外的哪些资源可用于了解 Form 和 MVC Web 应用程序？

> ID：295584
> 
> 赞同：2
> 
> 时间：2008-11-17T13:47:12.273
> 
> 标签：asp.net-mvc, winforms, webforms

我在 Microsoft 网站上找到了一些页面（有些甚至链接到许多其他页面），我昨晚收藏了这些页面以供今天阅读，但我很好奇用于讨论 ASP.NET 的其他非 Microsoft 资源Web 应用程序，包括 Forms 和 MVC（包括两者之间的比较/对比）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:07:48.150

留意 MVC 论坛，阅读博客：

*   [菲尔·哈克](http://haacked.com)
*   [斯科特·汉塞尔曼](http://computerzen.com)
*   [罗伯·科纳里](http://blog.wekeroad.com)
*   [西蒙娜·基亚雷塔](http://codeclimber.net.nz/)
*   [德里克·惠特克](http://devlicio.us/blogs/derik_whittaker)
*   [我](http://flux88.com):)
*   [杰里米·斯金纳](http://www.jeremyskinner.co.uk/)
*   [托克尔·奥德高](http://www.codinginstinct.com/)
*   [史蒂夫·桑德森](http://blog.codeville.net)

有很多人在写博客。另外，查看一些使用它的开源项目：

*   [MvcContrib](http://mvccontrib.org)
*   [代码营服务器](http://codecampserver.org)
*   [基格](http://www.codeplex.com/Kigg)

一堆书出来了：

*   史蒂夫·桑德森的[Pro ASP.NET MVC](http://apress.com/book/view/1430210079)
*   Alex Horovitz 编写的[ASP.NET MVC 编程](http://oreilly.com/catalog/9780596521851/)
*   Simone Chiaretta[开始 ASP.NET MVC](https://rads.stackoverflow.com/amzn/click/com/047043399X)
*   Phil Haack、Scott Hanselman、Rob Conery 的[专业 ASP.NET MVC](https://rads.stackoverflow.com/amzn/click/com/0470384611)
*   我、Jeffrey Palermo 和 Jimmy Bogard 的[ASP.NET MVC实践](http://manning.com/palermo)

> 我想你可以猜到我最推荐哪一个:)。我们的书有一个早期访问程序，允许您在编写 PDF 时下载它们。

```
</shamelessPlug> 
```

还有什么我应该添加到这个列表中的吗？我将其标记为社区 wiki。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T14:40:44.757

作为第一个停靠点，我会使用一个社交书签网站，例如 Delicious，来获取热门/标记的帖子和网站的列表：

*   [ASP.NET MVC 标记的书签](http://delicious.com/tag/aspnetmvc)
*   [流行的 ASP.NET MVC 书签](http://delicious.com/popular/aspnetmvc)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T14:53:44.573

[Phil Haack 的博客](http://haacked.com/)似乎是一个很好的来源。他是内幕人士，可以告诉你需要知道的技巧。最后，这一切都取决于你喜欢如何学习——有些人喜欢视频，有些人喜欢书籍。对我来说，最好的方法是边做边学。所以看看Phil，去CodePlex，找到一个使用ASP.NET MVC的项目，看看代码。这样，您还将看到人们如何解决他们的问题以及他们遵循了哪些实践，而不仅仅是学习框架的规则。

# c# - foreach 循环中内置的 Linq 查询始终从上次迭代中获取参数值

> ID：295593
> 
> 赞同：17
> 
> 时间：2008-11-17T13:51:21.190
> 
> 标签：c#, linq

我有一个包含几个关键字的列表。我通过他们像这样与他们一起构建我的 linq 查询（归结为消除代码噪音）：

```
List<string> keys = FillKeys()
foreach (string key in keys){
    q = q.Where(c => c.Company.Name.Contains(key));
} 
```

当我现在让我的密钥包含 2 个单独返回结果的密钥时，但永远不会一起出现（q 中的每个项目都是“xyz”或“123”，而不是“123”和“xyz”），我仍然得到结果。结果集与它到达的最后一个字符串相同。

我查看了 linq 查询，它似乎创建了正确的 sql，但它用相同的（最后迭代的）值替换了 @p1 和 @p2。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-17T13:52:51.217

您`key`在 lambda 表达式中重用了相同的变量 ( )。

有关更多详细信息，请参阅我关于[匿名方法](http://pobox.com/~skeet/csharp/csharp2/delegates.html#anonymous.methods)的文章，并且还有许多相关的 SO 问题：

*   [LINQ to SQL 错误（或非常奇怪的功能）...](https://stackoverflow.com/questions/293216/linq-to-sql-bug-or-very-strange-feature-when-using-iqueryable-foreach-and-multi)
*   [带委托的局部变量](https://stackoverflow.com/questions/148669/local-variables-with-delegates)
*   [C# 在循环中捕获变量](https://stackoverflow.com/questions/271440/c-captured-variable-in-loop)
*   [C#得到答案](https://stackoverflow.com/questions/241134/what-is-the-worst-cnet-gotcha#241180)
*   [以编程方式构建 LINQ 查询，而没有局部变量欺骗我](https://stackoverflow.com/questions/190227/building-a-linq-query-programatically-without-local-variables-tricking-me)

简单的解决方法是先复制变量：

```
List<string> keys = FillKeys()
foreach (string key in keys){
    string copy = key;
    q = q.Where(c => c.Company.Name.Contains(copy));
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-17T13:54:10.777

可能是捕获的变量问题；尝试添加：

```
List<string> keys = FillKeys()
foreach (string key in keys){
    string tmp = key;
    q = q.Where(c => c.Company.Name.Contains(tmp));
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-30T00:57:45.890

它已在 C# 5.0 中修复，上面的示例在 C# 5.0 中有效，但在早期版本的 C# 中失败。

但要小心，它不涉及 for 循环

```
 static void Main()
        {
            IEnumerable<char> query = "aaa bbb ccc";
            string lettersToRemove = "ab";

            Console.WriteLine("\nOK with foreach:");
            foreach (var item in lettersToRemove)
            {
                query = query.Where(c => c != item);   
            }   
            foreach (char c in query) Console.Write(c);

            //OK:
            Console.WriteLine("\nOK with foreach and local temp variable:");
            query = "aaa bbb ccc";

            foreach (var item in lettersToRemove)
            {
                var tmp = item;
                query = query.Where(c => c != tmp);
            }            
            foreach (char c in query) Console.Write(c);

            /*
             An IndexOutOfRangeException is thrown because:
             firstly compiler iterates the for loop treating i as an outsite declared variable  
             when the query is finnaly invoked the same variable of i is captured (lettersToRemove[i] equals 3) which generates IndexOutOfRangeException

             The following program writes aaa ccc instead of writing ccc:
             Each iteration gets the same variable="C", i (last one frome abc). 
             */

            //Console.WriteLine("\nNOK with for loop and without temp variable:");
            //query = "aaa bbb ccc";

            //for (int i = 0; i <  lettersToRemove.Length; i++)
            //{
            //    query = query.Where(c => c != lettersToRemove[i]);
            //}
            //foreach (char c in query) Console.Write(c);

            /*
             OK
             The solution is to assign the iteration variable to a local variable scoped inside the loop
             This causes the closure to capture a different variable on each iteration.
            */
            Console.WriteLine("\nOK with for loop and with temp variable:");
            query = "aaa bbb ccc";

            for (int i = 0; i < lettersToRemove.Length; i++)
            {
                var tmp = lettersToRemove[i];
                query = query.Where(c => c != tmp);
            }
            foreach (char c in query) Console.Write(c);
        } 
```

# sql-server - 使用 vbscript 获取选定实例的 SQL Server 数据库文件夹

> ID：295600
> 
> 赞同：2
> 
> 时间：2008-11-17T13:52:59.673
> 
> 标签：sql-server, vbscript

假设您有一个名为 (local)\SQLEXPRESS 的正在运行的 SQL Server Express 实例。它的数据库文件夹是 c:\program files\Microsoft SQL Server\MSSQL.1\MSSQL\Data。

如何使用 VBScript 来检索该文件夹？

也许通过使用SMO？如果是这样，怎么办？<- 算了。SMO 使用 .NET。只有在 PowerShell 中才有可能。

* * *

**更新：** 原因是，我正在开发一个 MSI 设置，它使用自定义操作（调用基于 .NET 的程序集）将 mdf 文件附加到现有 SQL 服务器实例。为此，.mdf 文件从安装介质传输到硬盘驱动器。所以设置需要知道文件的放置位置。

由于我想支持标准，我需要将文件放入公共数据文件夹中。

* * *

**更新：** 在 InstallShield 中选择 SQL 服务器实例时，属性 IS_SQLSERVER_SERVER 设置为实例名称。

我发现，我可以查询 HKLM\Software\Microsoft\Microsoft SQL Server\Instance Names\SQL 下的注册表以获取实例名称的 SQL 名称（例如 SQLEXPRESS -> MSSQL.1）。

有了这些信息，我可以查询 HKLM\Software\Microsoft\Microsoft SQL Server\MSSQL.1\Setup 来检索 SQLDataRoot 键。当我将 \Data 附加到此处找到的值时，我就有了我正在寻找的文件夹。

然而，有没有更好的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T14:52:25.170

[SQL-DMO](http://technet.microsoft.com/en-us/library/ms133993.aspx)的[PrimaryFilePath 属性](http://technet.microsoft.com/en-us/library/ms144134.aspx)看起来很有趣。

MSDN 声明 SQL-DMO 自 SQL Server 2008 起已弃用，但目前它应该仍然可以工作。

如果您不想再使用 SQL-DMO，我想`root\Microsoft\SqlServer`WMI 的命名空间中可能会有一些可用的东西。但是微软要么隐藏得很好，要么我的搜索技能离开了我，目前我在这方面找不到任何东西。

*（编辑：删除了一些没有回答问题的内容。）*

默认数据路径也存储在注册表中：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSSQLServer\MSSQLServer\DefaultData

```

我不确定实例将数据写入何处，但它必须在逻辑附近的某个地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T14:35:59.397

如果你说你为什么这样做，它可能会更容易。

SQL Server 将允许您将文件放在任何本地驱动器号上（甚至可以移动 master、model、msdb 和 temp），尽管在安装过程中每个实例都使用一个默认文件夹。

> 由于我想支持标准，我需要将文件放入公共数据文件夹中。

如果我是安装您的软件的 DBA，我希望您不要将它们放在那个位置（通常在 C: 驱动器上）。我宁愿你问我在哪里安装它们，因为如果这些数据库甚至有相当大的用途，它们将继续放在 SAN 驱动器上，我可以轻松扩展容量，我希望数据库和日志在单独的驱动器上（即不是微软默认安装的方式），尤其是在驱动器上的日志（**即不是 C:**），如果它填满，我不会以任何方式使我的服务器无法运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-08-13T18:46:13.247

在自定义操作中使用此代码，

```
strName = "(local)\SQLEXPRESS"
arrNames = Split(strName, "\")
intIndex = Ubound(arrNames)
strFile =  arrNames(intIndex)
strFile = trim(strFile)

if strFile <> "" then
    reg = readFromRegistry("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\" & strFile & "\Setup\SQLPath", "")
    reg = trim(reg)
    if reg <> "" then
        reg = reg & "\DATA"
    end if
end if

msgbox reg

function readFromRegistry (strRegistryKey, strDefault )
    Dim WSHShell, value

    On Error Resume Next
    Set WSHShell = CreateObject("WScript.Shell")
    value = WSHShell.RegRead( strRegistryKey )

    if err.number <> 0 then
        readFromRegistry= strDefault
    else
        readFromRegistry=value
    end if

    set WSHShell = nothing
end function 
```

该变量`reg`将检索路径。您可以在开始时在变量上给出实例名称`strName`。

*注册表函数源：* [如何使用 VbScript 检查注册表值](https://stackoverflow.com/questions/1233651/how-to-check-for-registry-value-using-vbscript)

# java - 使用 JDBC-ODBC 桥连接到 SQLServer

> ID：295603
> 
> 赞同：0
> 
> 时间：2008-11-17T13:53:16.007
> 
> 标签：java, jdbc, odbc-bridge

我正在编写一个在 MySQL 上进行原型设计的应用程序，现在正在连接到 Oracle 数据库。

连接到 oracle 数据库（已建立表结构）我所要做的就是更改连接字符串。

连接到另一台机器上的 SQL Server DB 的格式是什么？

我已经阅读了一些教程，这些教程告诉您使用 SQL Server JDBC 适配器，但我宁愿配置应用程序，使其与数据库无关，并且只需让连接字符串指定协议等。

我看到的任何告诉您如何将桥与 SQL Server 一起使用的参考资料都需要安装 ODBC 数据源，这并不理想，因为我的应用程序可能在 Linux 或 Windows 上运行。

我没有做任何复杂的事情，只是插入。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T13:55:37.157

您不应在生产环境中使用 JDBC-ODBC 桥。它比其他 JDBC 驱动程序慢得多，并且仅在 JDBC 驱动程序不可用时才需要。

SQL Server 具有 Microsoft 提供的[JDBC 驱动程序](http://www.microsoft.com/downloads/details.aspx?familyid=C47053EB-3B64-4794-950D-81E1EC91C1BA&displaylang=en)。如果您使用它，那么您将获得所需的结果。

使用 ODBC 桥，您别无选择，只能安装 ODBC 驱动程序。

本文[介绍](http://msdn.microsoft.com/en-us/library/ms378428(SQL.90).aspx)了连接到 SQL Server 时需要使用的连接字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T15:05:28.340

不要使用 JDBC-ODBC 桥接驱动程序。这纯粹是为了测试，而不是为了生产。您仍然可以使用针对您要连接的数据库进行优化的驱动程序使您的应用程序数据库不可知。只需将用户名、密码数据库驱动程序名称和连接字符串外部化，不要使用任何特定于 DB 的 SQL，就可以了。

要连接到 SQL Server，请使用 jTDS 驱动程序[http://jtds.sourceforge.net/](http://jtds.sourceforge.net/)连接字符串格式如下所示：

jdbc:jtds:sqlserver://localhost/my_database

您可以包含一些其他参数，用分号分隔，但我认为这就是所有需要的。显然，当您连接时，您需要提供用户名和密码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T14:00:58.907

现在它很容易使用工厂模式，然后加载 JDBC 驱动程序来处理给定的数据库。这种架构提供了两全其美的优势，即灵活性和效率。这样做的一个缺点是处理动态加载的位配置/编程，但我希望如果你想让它与数据库无关，那就是要走的路。

# asp.net - ASP.NET - 分层网格视图

> ID：295607
> 
> 赞同：1
> 
> 时间：2008-11-17T13:55:19.230
> 
> 标签：asp.net, gridview

关于如何实现“分层”网格视图的任何想法？基本上我想要当用户点击“+”时，我“展开”并插入新行，而没有完整的页面回发。

这听起来像是很多 AJAX 的东西吗？或者我应该阅读 ASP.NET MVC

请指出我正确的方向

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T14:27:11.677

另一种方法是在 Grid 视图 Trick 中使用旧的 Grid 视图。基本概念是将 [+] 和父数据作为单个模板列中的项目数据。附加按钮的单击事件并将您的网格设置为编辑/选择模式。当它处于编辑模式时，使用子数据呈现第二个网格视图。尽管它是网格视图中的网格视图，但在视觉上它将完成一个“分层”视图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-26T03:51:30.293

[Hierarchical GridView](http://www.vbknowledgebase.com/?Id=125&Desc=Asp.Net-Hierarchical-GridView)的示例源代码， 使用 [-] 和 [+] 折叠和展开，如 VB6 Hierarchical Grid

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T14:48:53.367

@bnkdev - GridView 中的 GridView 听起来一团糟。

@Jandwenyi - 我想你是在某个场景下这样做的，你需要在某个时候重用它，就像现在看起来不太可能一样。我的建议 - 找到一个可以做你想做的第三方网格控件 - 那里有很多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T14:02:23.630

我想你有两个选择：

*   您可以渲染出您想要插入的那些行，[+] 显示和隐藏它们
*   您不渲染它们，它们通过 AJAX 发送到浏览器，然后插入到表中。

我已经做到了两种方式，在我看来，更网格化的方式是第一种。您可以为 [+] 创建一个新的模板字段；定义一个子关系名称，然后在渲染时对每一行调用[GetChildRows](http://msdn.microsoft.com/en-us/library/system.data.datarow.getchildrows.aspx)（或等效项），使这些行隐藏。

# html - CSS浮动和HTML问题

> ID：295611
> 
> 赞同：2
> 
> 时间：2008-11-17T13:57:00.397
> 
> 标签：html, css, css-float

我有一些关于基本 CSS 的问题，我无法理解或找到答案。

首先，我尝试在另一个 div 标签中放置 3 个 div 标签。包含其他 3 个标签的第一个主 div 标签除了大小（`400px`由`400px`. 里面的其他 3 个 div 都是`20px`by `20px`，其中 1 个是assigned `float:left`，另外两个被分配了一个向右浮动的样式。所有属性都在一个样式中定义，并且`float:right`分配了相同样式的两个 div。我的问题是，在代码中最后出现的 2 个 div 中，会首先出现在浏览器中，我不明白其中的原因。

这是代码：

```
<html>
<head>
<style>
#main{ 
    border: red 4px dashed;
    width: 25%
    height: 25%,
    }
#left{ 
    float: left;    
    width: 20px;
    height: 20px,
    }
#right{ 
    float: right;   
    width: 20px;
    height: 20px,
    }
</style>
</head>
<body>
<div id="main">
<div id="left">1</div>
<div id="right">2</div>
<div id="right">3</div>
</div>
</body>
</head>
</html> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T14:04:46.967

> 我的问题是，在代码中最后出现的 2 个 div 中，会首先出现在浏览器中，我不明白其中的原因。

我认为你误解了“先出现”。您将您的 div 设置为向右浮动。所以一个“2”的 div，它在你的代码中是第一个，是第一个向右浮动的，所以它首先到右侧。然后浮动“3” div，所以我转到“2” div 的左侧 - 因为“2”是第一个，所以它在浏览器窗口的右侧排在第一位，而 div“3” 排在第二位放置在窗口的右侧。

在这种情况下，“窗口右侧的第二位”意味着“首先，从左侧看”;-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T14:08:07.817

起初，我会为 div 使用 class 而不是 id。但是css中也有一些错字：

```
#main{ 
    border: red 4px dashed;
    width: 25%;  /* <-- Missing ; */
    height: 25%; /* <-- change , to ; */
}
#left{ 
    float: left;        
    width: 20px;
    height: 20px; /* <-- change , to ; */
}
#right{ 
    float: right;       
    width: 20px;
    height: 20px; /* <-- change , to ; */
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T14:05:35.560

我不知道分层问题，但你不能有两个具有相同 ID 的元素。你可能想要：

```
...
<div class="right">2</div>
<div class="right">3</div>
... 
```

并在 CSS 中更改`#right`为。`.right`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T14:06:01.363

我认为您的问题是您使用的是 id 而不是 class。ID 应该是唯一的，因此第二个 id="right" 的 div 是唯一具有该 id 的 div。

您可以更改您的代码，以便您拥有：

<div class="right" >2</div>

<div class="right" >3</div>

（而不是 id="right"）

在css中你会有：

。对 {

```
float: right;       

width: 20px;

height: 20px,

} 
```

（而不是#right）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-09-06T08:51:07.010

你可以使用这个代码

```
<div id="main">
        <div id="left">1</div>
        <div id="right">3</div>
        <div id="right">2</div>
    </div> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-05T19:41:08.737

您不能多次使用同一个 ID。

```
<div class="right">2</div>
<div class="right">3</div> 
```

更好的方法是分配课程。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-04-22T11:49:04.490

```
<html>
<head>
<style>
#main {
    border: 4px dashed red;
    display: block;
    overflow: hidden;
}
#left {
    float: left;
    width: 20px;
    height: 20px,
}
#right {
    float: right;
    width: 20px;
    height: 20px,
}
</style>
</head>
<body>
<div id="main">
  <div id="left">1</div>
  <div id="right">3</div>
  <div id="right">2</div>
</div>
</body>
</head>
</html> 
```

# actionscript-3 - 未处理的 Socket securityError 即使（看似）处理它

> ID：295615
> 
> 赞同：2
> 
> 时间：2008-11-17T13:58:35.417
> 
> 标签：actionscript-3, sockets, error-handling

我有一个问题，我偶尔（即并非总是）在启动我的应用程序后从 Debug Flash Player 中看到以下错误弹出窗口：

```
Error #2044: Unhandled securityError:. text=Error #2048: Security sandbox violation: http://example.com/myApp.swf cannot load data from localhost:4499.
    at org.mydomain.mypackage::MyClassUsingSocket()
    at MyMainApplicationClass$cinit()
    at global$init()
    at global$init()
    at flash.system::ApplicationDomain/hasDefinition()
    at mx.managers::SystemManager/getDefinitionByName()
    at _MyMainApplicationClass_mx_managers_SystemManager/create()
    at mx.managers::SystemManager/initializeTopLevelWindow()
    at mx.managers::SystemManager/http://www.adobe.com/2006/flex/mx/internal::docFrameHandler() 
```

我在这个应用程序中有一些代码尝试`localhost:4499`通过 a连接`Socket`，当套接字服务器未运行并正在侦听连接时会发生此错误，*这是可以预料*的。但是，我*不*明白的是，为什么当我尝试连接套接字时尝试/捕获块来捕获**s时，** **Flash Player 会抱怨未处理的安全`SecurityError`**`SecurityErrorEvents`错误（以及该错误消息的侦听器似乎指向，虽然）。

相关类的构造函数如下：

```
/**
* Constructor.
*/
public function MyClassUsingSocket(aHost:String = null, aPort:int = -1):void
{
    super();

    var hostToConnectTo:String = (aHost != null) ? aHost : DEFAULT_HOST;
    var portToConnectTo:int = (aPort != -1) ? aPort : DEFAULT_PORT;

    try
    {
        _out_socket = new Socket();

        // note: the event handlers used below are private functions within the same class
        _out_socket.addEventListener(Event.CONNECT, _socketConnectEventHandler, false,0,true);
        _out_socket.addEventListener(IOErrorEvent.IO_ERROR, _socketIOErrorEventHandler, false,0,true);
        _out_socket.addEventListener(SecurityErrorEvent.SECURITY_ERROR, _socketSecurityErrorEventHandler, false,0,true);

        _out_socket.connect(hostToConnectTo, portToConnectTo);
    }
    catch(e:IOError)
    {
        enabled = false;
    }
    catch(e:SecurityError)
    {
        enabled = false;
    }
} 
```

关于为什么会发生这种情况的任何想法？我错过了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-23T14:58:25.190

我也为此挣扎了几个小时。解决方案是监听 SecurityErrorEvent.SECURITY_ERROR。显然，只有在没有这样的事件处理程序时才会引发 SecurityError 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T02:57:55.950

我不认为对话框中显示的错误是同步的。我几乎可以肯定它们被抛出您的代码路径之外（在异步网络事件期间），因此用 try-catch 捕获它们是不可能的。

所以你会认为在正确的调度程序上监听正确的事件会捕获错误？我试过听舞台、根、对象（套接字），但没有什么能抑制错误。

是的，这太可怕了。一段时间以来，我一直在寻找捕捉这些小动物的方法。唯一的安慰是，我认为它在播放器的发布版本中被压制了。还是很神秘吧？也没有太多文档（我发现）。

这不是一个真正的答案。对不起。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-18T14:04:30.757

在黑暗中射击：尝试捕捉通用错误？

```
 try
        {
                _out_socket = new Socket();

                // note: the event handlers used below are private functions within the same class
                _out_socket.addEventListener(Event.CONNECT, _socketConnectEventHandler, false,0,true);
                _out_socket.addEventListener(IOErrorEvent.IO_ERROR, _socketIOErrorEventHandler, false,0,true);
                _out_socket.addEventListener(SecurityErrorEvent.SECURITY_ERROR, _socketSecurityErrorEventHandler, false,0,true);

                _out_socket.connect(hostToConnectTo, portToConnectTo);
        }
        catch(e:IOError)
        {
                enabled = false;
        }
        catch(e:SecurityError)
        {
                enabled = false;
        }
        catch( e:Error )
        {
                trace( e );
        } 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-18T12:51:58.173

这可能不是问题，但您正在捕获 SecurityError 及其引发的 securityError。也许尝试小写 s。

# c# - 对象序列化时如何指定元素的名称

> ID：295619
> 
> 赞同：1
> 
> 时间：2008-11-17T14:01:07.440
> 
> 标签：c#, .net, serialization, xml-serialization

我有以下课程

```
 [XmlRoot(ElementName= "webSites")] //No capital w at the beginning
public class WebSites : List<WebSite>
{

}

public class WebSite
{
    [XmlAttribute("name")]
    public string Name { set; get; }
    [XmlAttribute("url")]
    public String Url { set; get; }
} 
```

这被序列化为

```
 <?xml version="1.0" encoding="DOS-862"?>
<webSites xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http:
//www.w3.org/2001/XMLSchema">
  <WebSite name="nice website" url="mydomain.com" /> 
```

这几乎没问题，但我希望`WebSite`（有大写）将是`webSite`（无大写）我知道我只能为根指定这个，但我怎样才能为内部成员指定呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T14:02:01.823

```
[XmlType("webSite")]
public class WebSite {...} 
```

或控制包装类上的集合属性：

```
[XmlArrayItem("webSite")]
[XmlArray("sites")]
public WebSites Sites { get; set; } 
```

# delphi - 如何从 VB6 调用 Delphi DLL

> ID：295620
> 
> 赞同：2
> 
> 时间：2008-11-17T14:01:37.033
> 
> 标签：delphi, dll, vb6, declare

鉴于以下 Delphil DLL 声明

```
function csd_HandleData(aBuf: PChar; aLen: integer): integer; stdcall; 
```

使用它的 VB6 声明是什么？

我尝试了各种声明，例如

```
Declare Function csd_HandleData Lib "chsdet.dll" (ByVal aBuf As String, ByVal aLen As Integer)
Declare Function csd_HandleData Lib "chsdet.dll" (aBuf As Long, ByVal aLen As Integer)
Declare Function csd_HandleData Lib "chsdet.dll" (aBuf As Byte, ByVal aLen As Integer) 
```

使用适合参数的相关代码，但似乎没有任何效果，即 Delphi 调试器说我在 aLen 中有一个太大的值，在 aBuf 中有一个空字符串。

我正在努力使用 TypeLib 来驱动连接，但正在使用 Declares 进行原型设计。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T14:08:09.767

尝试

```
Declare Function csd_HandleData Lib "chsdet.dll" (ByVal aBuf As String, 
ByVal aLen As Integer) As Integer 
```

似乎您忘记了返回值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T07:53:54.717

VB整数数据类型是16bit，所以你应该声明它为long，相当于Delphi和其他语言中的整数。

```
Declare Function csd_HandleData Lib "chsdet.dll" (ByVal aBuf As String, ByVal aLen As long) as long 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T14:10:26.003

我不知道 Delphi 中的 PChar 是什么，它只是一个字符吗？ASCII？？统一码？

Integer 在 VB6 中是 16 位，您必须声明`aLen`为 Long，它可以容纳 32 位。

您还必须声明函数的返回类型，在这种情况下，您也需要返回 Long 值。

这可能会起作用：

```
Declare Function csd_HandleData Lib "chsdet.dll" (aBuf As Byte, ByVal aLen As Long) As Long 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T08:00:54.390

对于那些感兴趣的人，这里是[CHSDET](http://chsdet.sourceforge.net/)的 typelib 的最终 IDL 。给我留下深刻印象（在重新发现 Matt Curland 的 EditTLB 工具之后）是我可以将结构放入类型库中，并且 VB 处理它们就像我在源代码中声明它们一样。

我已经写信给 ChsDet 的作者，也许这最终会成为标准发行版的一部分。

```
// Generated .IDL file (by the OLE/COM Object Viewer)
// 
// typelib filename: chsdet.tlb

[
  uuid(316A83D7-8BF4-490E-BDDE-75EBC332C355),
  version(1.0),
  helpstring("Charset Detector - as the name says - is a stand alone executable module for automatic charset detection of a given text.\r\n\t\r\nIt can be useful for internationalisation support in multilingual applications such as web-script editors or Unicode editors.\r\n\t\r\nGiven input buffer will be analysed to guess used encoding. The result can be used as control parameter for charset conversation procedure.\r\n\t\r\nCharset Detector can be compiled (and hopefully used) for MS Windows (as dll - dynamic link library) or Linux.\r\n\t\r\nBased on Mozilla's i18n component - http://www.mozilla.org/projects/intl/. \r\n\r\nCharset Detector is open source project and distributed under Lesser GPL.\r\nSee the GNU Lesser General Public License for more details - http://www.opensource.org/licenses/lgpl-license.php\r\n\r\nNikolaj Yakowlew \xFFFFFFA9 2006-2008 \r\nTypeLib by Bruce M. Axtens, 2008.")
]
library CHSDET
{
    // TLib :     // Forward declare all types defined in this typelib

    [
      dllname("CHSDET.dll"),
      version(1.0),
      helpstring("Functions in CHSDET.DLL")
    ]
    module CHSDETFunctions {
    [entry(0x60000000), helpstring("Returns rAbout record (qv)")]
    void _stdcall GetAbout([in, out] rAbout* AboutRec);
    [entry(0x60000001), helpstring("Reset detector. Prepares for new analysis.")]
    void _stdcall Reset();
    [entry(0x60000002), helpstring("Analyse given buffer of specified length.

Return value is of eHandleDataErrors, either 
NS_ERROR_OUT_OF_MEMORY (Unable to create internal objects) or NS_OK.

Function can be called more that one time to continue guessing. Charset Detector remembers last state until Reset called.")]
    void _stdcall HandleData(
            [in] BSTR aBuf, 
            [in] short aLen, 
            [out, retval] short* retVal);
    [entry(0x60000003), helpstring("Returns either TRUE (Charset Detector is sure about text encoding.) or FALSE.

NB: If input buffer is smaller then 1K, Charset Detector returns FALSE.")]
    void _stdcall IsDone([out, retval] short* retVal);
    [entry(0x60000004), helpstring("Signal data end. If Charset Detector hasn't sure result (IsDone = FALSE) the best guessed encoding will be set as result.")]
    void _stdcall DataEnd();
    [entry(0x60000005), helpstring("Returns guessed charset as rCharsetInfo record")]
    void _stdcall GetDetectedCharset([out, retval] rCharsetInfo* retVal);
    [entry(0x60000006), helpstring("Returns all supported charsets in form "0x0A Name - CodePage"")]
    void _stdcall GetKnownCharsets(
            [in, out] long* sList, 
            [out, retval] long* retVal);
    [entry(0x60000007), helpstring("Return eBOMKind value matching byte order mark (if any) of input data.")]
    void _stdcall GetDetectedBOM([out, retval] eBOMKind* retVal);
    [entry(0x60000008), helpstring("Remove CodePage from consideration as a possible match")]
    void _stdcall DisableCharsetCP([in] long CodePage);
    };

    typedef [uuid(91694067-30AB-44A9-A210-F5602935475F)]
    struct tagrAbout {

long lMajor;

long lMinor;

long lRelease;

long sAbout;
    } rAbout;

    typedef [uuid(3C8B7420-D40B-458B-8DE8-9B3D28607396)]
    enum {
    BOM_Not_Found = 0,
    BOM_UCS4_BE = 1,
    BOM_UCS4_LE = 2,
    BOM_UCS4_2143 = 3,
    BOM_UCS4_3412 = 4,
    BOM_UTF16_BE = 5,
    BOM_UTF16_LE = 6,
    BOM_UTF8 = 7
    } eBOMKind;

    typedef [uuid(9B231DEF-93FB-440D-B06B-D760AECE09D0)]
    struct tagrCharsetInfo {

long Name;

short CodePage;

long Language;
    } rCharsetInfo;

    typedef enum {
    NS_OK = 0,
    NS_ERROR_OUT_OF_MEMORY = -2147024882
    } eHandleDataErrors;
}; 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-17T14:08:32.137

我不确切知道 Vb 是如何工作的，但 PChar 是一个指针，所以尝试获取引用而不是值。

```
Declare Function csd_HandleData Lib "chsdet.dll" (**ByReference <--guessing here :D** aBuf As String, ByVal aLen As Integer) 
```

# asp.net - 将 ModalPopup 移到 IFrame 之外。可能的？

> ID：295621
> 
> 赞同：17
> 
> 时间：2008-11-17T14:01:54.427
> 
> 标签：asp.net, iframe, modalpopupextender

我的主页中有一个 iframe。iframe 页面内有一个 modalpopup。所以当modalpopup显示出来的时候，modalpopup的父级就是iframe body和main page parent body。因此，覆盖仅覆盖 iframe 而不是整个页面。

我尝试使用 jQuery 将 modalpopup 从 iframe 移动到父窗口主体元素（或父主体内的任何其他元素）。我收到一个无效的参数错误。

如何从 iframe 内的页面显示 modalpopup 并且它应该覆盖整个文档，以及父文档？

**更新：**

由于很少有用户对实现相同的行为感兴趣..这是解决方法

我建议的最佳解决方法是在主页中使用 modalpopup .. 然后从 iframe 调用它.. 说这样的话..

```
/* function in the main(parent) page */
var _onMyModalPopupHide = null;
function pageLoad(){
    // would be called by ScriptManager when page loads
    // add the callback that will be called when the modalpopup is closed
    $find('MyModalPopupBehaviorID').add_hidden(onMyModalPopupHide);
}
// will be invoked from the iframe to show the popup
function ShowMyModalPopup(callback) {
    _onMyModalPopupHide = callback;
    $find('MyModalPopupBehaviorID').show();
}
/* this function would be called when the modal popup is closed */
function onMyModalPopupHide(){
    if (typeof(_onMyModalPopupHide) === "function") {
        // fire the callback function
        _onMyModalPopupHide.call(this);
    }
}

/* functions in the page loaded in the iframe */
function ShowPopup(){
    if(typeof(window.parent.ShowMyModalPopup) === "function") {
        window.parent.ShowMyModalPopup.apply(this, [OnPopupClosed]);
    }
}
// will be invoked from the parent page .. after the popup is closed
function OnPopupClosed(){
    // do something after the modal popup is closed
} 
```

希望能帮助到你

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-12T23:33:34.447

如果您仅将 iframe 用于可滚动内容，则可以考虑使用带有**溢出的样式 div：auto**或**scroll**。

这样的设置使得修改整个页面的外观变得更容易，因为您没有处理多个文档，每个文档在页面内都有自己的窗口空间。您可以绕过一些跨框架通信，如果需要，保持信息同步可能会更容易。

这可能并不适合所有情况，可能需要 ajax（或使用 javascript 修改 dom）来更改 div 内容，而不是仅在 iframe 中加载不同的文档。此外，一些较旧的移动浏览器（例如 Android Froyo 构建）不能很好地处理可滚动的 div。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-22T15:55:12.453

您在更新中回答了自己的问题。模态对话框需要存在于父页面上并从 iframe 调用。您唯一的其他选择是使用滚动 div 而不是 iframe。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-01T17:52:46.520

你问的方式不可能。这样想：iframe 是一个单独的窗口。您不能（暂时）将一个网页中的 div 移动到另一个网页中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-24T14:31:24.037

我已经通过为 jQuery 编写一个小代码来做到这一点，请参见下文，也许这会有所帮助：

**注意：确保你在同一个域上做**

**HTML：**

```
<button type="button" id="popup">Show Popup</button>
<br />
<br />
<iframe src="your url" style="width: 100%; height:400px;"></iframe> 
```

**JS：**

```
// Author : Adeel Rizvi
// It's just a attempt to get the desire element inside the iframe show outside from iframe as a model popup window.

// As i don't have the access inside the iframe for now, so I'll grab the desire element from parent window.

(function () {
    $.fn.toPopup = function () {
        return this.each(function () {

            // Create dynamic div and set its properties
            var popUpDiv = $("<div />", {
                class: "com_popup",
                width: "100%",
                height: window.innerHeight
            });

            // append all the html into newly created div
            $(this).appendTo(popUpDiv);

            // check if we are in iframe or not
            if ($('body', window.parent.document).length !== 0) {

                // get iframe parent window body element
                var parentBody = $('body', window.parent.document);

                // set height according to parent window body
                popUpDiv.css("height", parentBody.height());

                // add newly created div into parent window body
                popUpDiv.appendTo(parentBody);

            } else {

                // if not inside iframe then add to current window body
                popUpDiv.appendTo($('body'));
            }

        });
    }
})();

$(function(){
 $("#popup").click(function () {

    // find element inside the iframe
    var bodyDiv = $('iframe').contents().find('YourSelector');

    if (bodyDiv.length !== 0) {

        // Show
        $(bodyDiv).toPopup();

    } else {
        alert('Sorry!, no element found');
    }

 });
}); 
```

**CSS：**

```
.com_popup {
    background-color: Blue;
    left: 0;
    position: absolute;
    top: 0;
    z-index: 999999;
} 
```

# windows - 在 Windows Server 上部署的最佳免费 Web 框架？

> ID：295624
> 
> 赞同：2
> 
> 时间：2008-11-17T14:02:23.040
> 
> 标签：windows, frameworks

如果您开始从头开始开发新的 Web 应用程序，并且您仅有的两个要求是将其部署到 Windows 2008 Server 和标准的 ASP.NET，包括。VS2008 并没有削减它（不管为什么，假设这是许可证成本，您不会自己托管 Windows 2008 Server）。在这种情况下，您会选择哪个 Web 框架？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T15:16:31.877

我前段时间阅读了一篇基准文章，该文章建议在 Windows 之上运行开源 Web 堆栈是所有变体（即 WAMP）中表现最好的。我不知道对这些类型的文章有多大信心，而且 IIRC 它以非常小的优势击败了 LAMP。您可能会发现 WAMP 非常适合您的情况，但我认为您应该为自己节省 Windows 税并使用 LAMP（或使用 Postgres 而不是 MySQL……我更喜欢它）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T14:40:19.670

我想知道为什么您要在 Windows 服务器上托管而不使用 ASP.Net。它是 Windows 环境中最好的服务器端框架，因为它最直观地与 IIS 一起工作。

但是还有另一个问题：如果内存够用，所有其他框架都需要额外的软件才能在服务器上运行。[PHP 需要将 PHP 运行时安装为 IIS 中的 CGI 扩展](http://us2.php.net/install.windows)，[Rails 需要 Ruby](http://codebetter.com/blogs/ben.reichelt/archive/2006/02/21/138812.aspx)，CGI 样式选项（C、Perl、Python）不仅需要编译器/运行时，还需要一些关于 IIS 如何处理这些文件的底层知识，JSP 需要...我不确定，我从未使用过 JSP，而[ColdFusion 需要该框架，而且它确实需要高昂的许可成本](http://www.adobe.com/products/coldfusion/buy/)（相对于服务器免费下载的 ASP.Net）。

因此，最后，您基本上只能选择一个选项，安装必要的软件并继续前进。就个人而言，如果被迫做出这个选择，我会选择 PHP 或 Ruby on Rails，但除了随机和主观的选择之外，没有任何正当理由。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:35:25.067

[微块](http://common-lisp.net/project/cl-weblocks/)

> Weblocks 是一个基于 continuation 的 Web 框架，用 Common Lisp 编写。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T16:53:05.563

我同意[Stephen](https://stackoverflow.com/questions/295624/best-free-web-framework-to-deploy-on-windows-server#295705)的观点，将许可成本归咎于不使用 ASP.NET 似乎有点奇怪，尤其是当您将使用 Windows 进行托管时？诚然 VS 2008 Pro 并不便宜，但它也几乎不会破产。新的 2008 Express 版本的 VS 是免费的，我不得不说还不错。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-28T20:30:20.673

我怀疑在 Windows 上加载 Smalltalk [Squeak](http://www.squeak.org/)非常容易，所以我会认真考虑使用[Seaside](http://www.seaside.st/)作为选项。

另一种选择是查看适用于 Windows 的[ActivePerl](http://www.activestate.com/activeperl/)，然后您可以使用任何免费的 Perl Web 框架，例如[Catalyst](http://www.catalystframework.org/)或[Jifty](http://jifty.org)。

# .net - system.io.fileloadexception 故障排除

> ID：295626
> 
> 赞同：6
> 
> 时间：2008-11-17T14:02:43.053
> 
> 标签：.net

我有一个在我的机器上运行良好的 .net 3.5 WinForms 应用程序，但在另一台机器上它立即因 system.io.fileloadexception 而崩溃。不幸的是，没有关于哪个文件加载失败的详细信息，所以我不知道问题到底出在哪里。

我相信我知道它可能是哪一个（SQL Server Compact 版本），但在我漫无目的地寻找之前，我想知道除了使用 SysInternals 的 FileMon 之外，是否有适当的方法来找出导致 fileloadexception 的原因。

唯一的错误信息是：

> EventType clr20r3，P1 myapplication.exe，P2 2.1.0.0，P3 490eca78，P4 myapplication，P5 2.1.0.0，P6 490eca78，P7 2e，P8 21，P9 system.io.fileloadexception，P10 NIL。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-17T14:03:22.413

打开[融合记录](http://blogs.msdn.com/suzcook/archive/2003/05/29/57120.aspx)？

[布拉德威尔逊的这篇博客文章](http://bradwilson.typepad.com/blog/2007/12/we-were-crashin.html)提供了如果失败该怎么办的信息......

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-17T14:15:42.433

您可以尝试使您的`Main()`方法更加健壮以捕获（并显示）异常......[就像这样](https://stackoverflow.com/questions/295161/)。

通常，问题是太多代码进入最外层的`Main()`方法。JIT 必须能够完全理解`Main()`，否则你的代码**都**无法运行。通过`Main()`简化，您就有机会。在链接的示例中，如果`MainCore()`失败：很好，我们仍然可以在`Main()`.

这是可行的，因为 JIT 是在一个方法一个方法的基础上完成的……也就是说`MainCore()`，在它被调用之前不会被 JITted，此时我们已经有了我们的 try/catch。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T15:49:05.523

挂钩并记录[AppDomain.AssemblyResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T14:20:47.213

获取 Microsoft 调试工具 SDK，并使用 windbg 或 cordbg 附加并运行您的应用程序。如果没有查明问题，这至少应该给你一个线索，问题出在哪里。

# java - SecureRandom：初始化一次还是每次都需要？

> ID：295628
> 
> 赞同：31
> 
> 时间：2008-11-17T14:03:32.490
> 
> 标签：java, security, random, cryptography

我们的团队正在使用 SecureRandom 生成密钥对列表（SecureRandom 被传递给 KeyPairGenerator）。我们无法就使用以下两个选项中的哪一个达成一致：

1.  每次我们需要生成密钥对时创建一个新实例

2.  初始化一个静态实例并将其用于所有密钥对

哪种方法通常更好，*为什么*？

补充：我的直觉是第二种选择更安全。但我唯一的论点是基于伪随机性源自当前时间戳的假设的理论攻击：有人可能会看到密钥对的创建时间，猜测周围时间间隔内的时间戳，计算可能的伪随机序列，并获得关键材料。

补充：我关于基于时间戳的确定性的假设是错误的。这就是 Random 和 SecureRandom 之间的区别。所以，看起来答案是：就安全性而言，这并不重要。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-17T14:15:07.130

与`java.util.Random`类不同，`java.security.SecureRandom`类必须在每次调用时产生非确定性输出。

这意味着，在这种情况下`java.util.Random`，如果您每次需要一个新的随机数时都使用相同的种子重新创建一个实例，那么每次基本上都会得到*相同*的结果。但是，`SecureRandom`保证不会这样做 - 因此，每次创建单个实例或创建一个新实例都*不会*影响它生成的随机字节的随机性。

那么，从正常的良好编码实践的角度来看，为什么要创建太多实例呢？

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-07-19T04:08:34.877

对于[SecureRandom](http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/security/SecureRandom.html)，您可能需要考虑通过如下调用偶尔重新播种（[在大多数情况下使用系统熵）：](http://bugs.sun.com/view_bug.do?bug_id=6202721)

```
mySecureRandom.setSeed(mySecureRandom.generateSeed(someInt)); 
```

以便给潜在的攻击者一些少于无限的时间来发现您的密钥。

[正义联盟](http://www.cigital.com/justiceleague/2009/08/14/proper-use-of-javas-securerandom/)博客上有一些关于这一考虑的精彩文章。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T14:07:33.027

初始化一个静态实例并将其用于所有密钥对。它不会或多或少是随机的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-08-20T09:10:13.553

每`SecureRandom`一代都是从某个熵池中播种的。根据所使用的操作系统，这可能是操作系统维护的熵池，例如`/dev/random`Linux，或者可能是 JVM 制作的东西。在一些较早的实现中，Sun JVM 用于生成多个线程并使用它们的时间数据来创建种子。

在每次调用时创建一个新`SecureRandom`的可能会导致应用程序变慢，因为创建种子可能会阻塞。最好重用静态创建的实例，但确保在从中提取固定数量的随机字节后重新设置它。

您可能希望在实例上创建一个包装器，该包装器计算在或调用`SecureRandom`中提取的字节数，并在多个字节后使用系统熵池重新植入内部实例。`nextBytes``generateSeed``SecureRandom`

然而，包装器方法在 Linux 上的 Java 上是不可能的，因为`SecureRandom`您从 new 获得的实例`SecureRandom()`只不过是一个包装器`/dev/random`，每次调用`nextBytes`或`generateSeed`实际上耗尽操作系统熵池。在 Linux 和 Solaris 上，最好使用 JCE 提供程序进行`SecureRandom`创建。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-17T17:14:20.857

除了加密安全的 PRNG，我不会依赖 SecureRandom。Gowri 从 javadocs 中使用的完整引用是：

> 此外，SecureRandom 必须产生非确定性输出，因此要求种子材料是不可预测的，并且 SecureRandom 的输出是加密强序列，如 RFC 1750：安全随机性建议中所述。

从中并不清楚真正的期望是什么 - RFC 1750 详细说明了使用硬件来增强随机数生成，但 javadocs 说“因此要求种子材料是不可预测的”，这似乎与此相矛盾。

最安全的假设是您的 SecureRandom 实现只是一个密码安全的 PRNG，因此您的密钥并不比您使用的随机种子更安全。因此，为每个密钥使用一个新的（唯一的、真正随机的）种子来初始化一个新的 SecureRandom 将是最安全的选择。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T19:08:50.940

一次应该就够了。我的经验也是，初始化 SecureRandom 类型生成器有时也会很慢（由于如何实现随机性），因此您应该考虑到这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-10-15T17:06:46.333

我决定问Java编译器。简短的回答是，是的，重用`SecureRandom`对象有一些性能优势，但不是更好*或更糟*的是实际随机性。这纯粹是一个调优问题。不是安全问题。

但是请注意，JIT 需要一段时间才能启动，这样您才能看到好处。要点是，对于重度/频繁使用，绝对要重复使用该对象。对于不经常使用的情况，您最好每次都使用一个新对象。

## 结果

```
warm up 
-----------------------------
default seed - re-use - 1807 ms
explicit seed - re-use - 835 ms
constant seed - new every time - 1044 ms
default seed - new every time - 1621 ms
-----------------------------
interation 0
-----------------------------
default seed - re-use - 412 ms
explicit seed - re-use - 418 ms
constant seed - new every time - 955 ms
default seed - new every time - 1676 ms
-----------------------------
interation 1
-----------------------------
default seed - re-use - 389 ms
explicit seed - re-use - 369 ms
constant seed - new every time - 893 ms
default seed - new every time - 1498 ms 
```

## 来源

```
package foo;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;

import java.security.SecureRandom;
import java.util.HashSet;
import java.util.Set;

import org.junit.BeforeClass;
import org.junit.Test;

public class SecureRandomTest {

    static long elapsedMillis( long startNs ) {
        long now = System.nanoTime();
        return (now - startNs) / 1_000_000;
    }
    final static long seed = 123456789123456L;
    final static int nIter = 1000000;

    public static void main(String[] args) {
        warmup();
        SecureRandomTest test = new SecureRandomTest();
        for ( int ix = 0; ix < 5; ++ix ) {
            test.run(ix);
        }
    }

    void run(int ix) {
        System.out.printf( "interation %d\n-----------------------------\n", ix);
        secure_random_default_seed_reuse();
        secure_random_constant_seed_reuse();
        secure_random_constant_seed();
        secure_random_default_seed();
        System.out.println("-----------------------------");
    }

    /* Warm up JVM/JIT */
    @BeforeClass
    public static void warmup() {
        new SecureRandomTest().run(-1);
    }

    @Test
    public void secure_random_constant_seed() {
        long started = System.nanoTime();
        int nDupes = 0, ix = 0;
        Set<Long> generated = new HashSet<>(nIter);
        for ( /**/; ix < nIter; ++ix) {
            SecureRandom rand = new SecureRandom();
            rand.setSeed(seed);
            long xRand = rand.nextLong();
            if ( !generated.add(xRand) ) {
                ++nDupes;
            }
        }
        assertEquals( "Unexpected # of dupes " + nDupes + ", ix == " + ix, nIter-1, nDupes );
        System.out.printf( "constant seed - new every time - %d ms\n", elapsedMillis(started) );
    }

    @Test
    public void secure_random_constant_seed_reuse() {
        long started = System.nanoTime();
        int nDupes = 0, ix = 0;
        SecureRandom rand = new SecureRandom();
        rand.setSeed(seed);
        Set<Long> generated = new HashSet<>(nIter);
        for ( /**/; ix < nIter; ++ix) {
            long xRand = rand.nextLong();
            if ( !generated.add(xRand) ) {
                ++nDupes;
            }
        }
        assertTrue( "Unexpected # of dupes " + nDupes + ", ix == " + ix, 0 == nDupes );
        System.out.printf( "explicit seed - re-use - %d ms\n", elapsedMillis(started) );
    }

    @Test
    public void secure_random_default_seed() {
        long started = System.nanoTime();
        int nDupes = 0, ix = 0;
        Set<Long> generated = new HashSet<>(nIter);
        for ( /**/; ix < nIter; ++ix) {
            long xRand = new SecureRandom().nextLong();
            if ( !generated.add(xRand) ) {
                ++nDupes;
            }
        }
        assertTrue( "Unexpected # of dupes " + nDupes + ", ix == " + ix, 0 == nDupes );
        System.out.printf( "default seed - new every time - %d ms\n", elapsedMillis(started) );
    }

    @Test
    public void secure_random_default_seed_reuse() {
        long started = System.nanoTime();
        int nDupes = 0, ix = 0;
        SecureRandom rand = new SecureRandom();
        Set<Long> generated = new HashSet<>(nIter);
        for ( /**/; ix < nIter; ++ix) {
            long xRand = rand.nextLong();
            if ( !generated.add(xRand) ) {
                ++nDupes;
            }
        }
        assertTrue( "Unexpected # of dupes " + nDupes + ", ix == " + ix, 0 == nDupes );
        System.out.printf( "default seed - re-use - %d ms\n", elapsedMillis(started) );
    }
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-17T14:05:19.757

为什么要每次都创建一个新实例？不是那样会*更*随机。我认为最好初始化一次并将其用于所有对。

# java - 使用 JDBC 连接到不同数据库的模式

> ID：295629
> 
> 赞同：7
> 
> 时间：2008-11-17T14:04:44.687
> 
> 标签：java, jdbc

我正在编写一个应用程序，该应用程序必须可配置为连接到 Oracle、SQL Server 和 MySQL，具体取决于客户端的突发奇想。

到目前为止，我一直在计划使用 JDBC-ODBC 桥并使用不同的连接字符串连接到数据库。

**我被告知这不是很有效。**

1.  是否有连接到多个数据库系统的模式或最佳实践？或者选择使用哪个驱动程序？

2.  我应该配置它吗？但包括所有三个驱动程序或构建三个单独的客户端？

我没有做任何复杂的事情，只是将数据从事件流中泵入（插入）到数据库中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-17T14:16:50.187

我建议您将其配置为可配置并包含三个驱动程序。您可以使用这样的模式：创建一个提供连接到数据库的功能的超类（我们称之为 DAO）。这可能是抽象的。

为您希望连接的每种类型的数据库创建一个具体的子类。因此，您最终可能会使用 MySQLDAO、MSSQLDAO 和 OracleDAO。每个都将加载各自的驱动程序并使用其各自的连接字符串。

使用 getDAO(DB) 方法创建另一个类（我们称之为 DAOFactory），该方法将根据 DB 的值创建 DAO 的实例。

例如（在伪代码中）：

```
 if(DB.equals("MySQL")){
    DAO = new MySQLDAO();
}
return DAO; 
```

所以任何需要连接到数据库的代码都会调用 DAOFactory 并请求一个 DAO 实例。您可以将 DB 值存储在外部文件（如属性文件）中，这样您就不必修改代码来更改数据库的类型。

这样你的代码就不需要知道它连接到哪种类型的数据库，如果你决定以后支持第四种类型的数据库，你将不得不再添加一个类并修改 DAOFactory，而不是你的代码的其余部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T14:13:02.563

如果您需要任何复杂的东西，Hibernate 是一个不错的选择。

否则，我要做的是将您的连接详细信息存储在属性文件（或某种其他形式的配置）中 - 即：驱动程序类名、JDBC url、用户名和密码。

然后，您需要做的就是从您的属性文件中加载连接详细信息并在您的类路径中包含正确的 JAR 文件，然后您就完成了。

如果您希望配置更容易一些，您可以使用诸如 Commons-DBCP 之类的库，但除此之外，这就是您需要做的所有事情（当然，前提是您的 SQL 语句适用于每个数据库）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T19:06:55.060

如果您小心（并且您进行了测试），您可以使用直接的 JDBC 来执行此操作，并且只需更改驱动程序类和连接信息。您肯定希望远离 JDBC-ODBC 桥，因为它通常很慢且不可靠。与 JDBC 相比，桥跨 dbs 的行为更有可能不同。

如果您的要求像列出的那样简单，我认为 DAO 路径是矫枉过正的。

如果您正在执行大量插入操作，您可能需要调查准备好的语句和批量更新，因为它们的效率要高得多。这可能最终会变得不那么便携——如果没有测试就很难说。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T14:41:54.223

看看[数据源](http://docs.oracle.com/javase/7/docs/api/javax/sql/DataSource.html)。这是获取数据库连接的首选机制。

IMO 这为管理员选择数据库、连接池和事务策略提供了最大的灵活性。

如果您使用的是 tomcat，请参阅[此处](http://tomcat.apache.org/tomcat-8.0-doc/jndi-datasource-examples-howto.html)了解如何使用 tomcat 的 JNDI 注册数据源。

如果您使用的是 Spring，那么您可以使用[`jee:jndi-lookup`](http://docs.spring.io/spring/docs/3.0.x/reference/xsd-config.html).

如果您使用 Spring，但不想使用 JNDI，请查看 [DriverManagerDataSource](http://docs.spring.io/spring/docs/3.0.x/api/org/springframework/jdbc/datasource/DriverManagerDataSource.html)以讨论如何获取池化数据源（DBCP 或 C3P0）。

# java - 如何在 Java Applet 中注册 JavaScript 回调？

> ID：295645
> 
> 赞同：10
> 
> 时间：2008-11-17T14:12:25.967
> 
> 标签：java, javascript, applet, callback, methods

我正在开发一个不可见的 Java Applet，它将完全由 JavaScript 控制。

我可以轻松调用小程序的 Java 方法，并且可以使用`netscape.javascript.JSObject.getWindow(this).call()`.

但是为了在小程序中注册一个 JavaScript 回调，我想我需要一个 JavaScript 函数对象。

我想要做：

```
public void registerCallback( SomeJavascriptFunction func ) { ... } 
```

我可以从 Javascript 调用：

```
myapplet.registerCallback(function(){ alert("called back"); }); 
```

所以我可以在后面的代码中调用这个函数：

```
func.call( ... ); 
```

这样的事情存在吗？我怎样才能做到这一点？

现在我正在考虑创建一些 Javascript 来处理这个回调机制，而不是从小程序中这样做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-13T11:24:44.083

我意识到这是一个*非常*古老的问题，但它在我搜索其他内容的一次中排名第二，我认为以下内容可能会帮助其他找到此问题的人。

我最近做了类似的事情，Java 小程序需要在完成任务时回调到 JavaScript，在成功或错误时调用不同的函数。正如最近的趋势一样，我需要调用匿名函数，这些函数定义为传递给其他函数的参数。这是客户端的javascript：

```
applet.DoProcessing({
    success: function(param) {
        alert('Success: ' + param);
    },
    error: function(param) {
        alert('Failed: ' + param);
    }
}); 
```

正如其他答案中提到的，Java 只能按名称调用 JavaScript 方法。这意味着您需要一个全局回调方法，然后可以根据需要调用其他方法：

```
function ProcessingCallback(isSuccessful, cbParam, jsObject) {
    if (isSuccessful && jsObject.success)
        jsObject.success(cbParam);
    else if (!isSuccessful && jsObject.error)
        jsObject.error(cbParam);
} 
```

此函数直接从 Java 小程序中调用：

```
public void DoProcessing(final Object callbacks) {
   //do processing....

   JSObject w = JSObject.getWindow(this);
   //Call our named callback, note how we pass the callbacks parameter straight
   //back out again - it will be unchanged in javascript.
   w.call("ProcessingCallback", new Object[]{successful, output, callbacks});
} 
```

如果您想将其用作某种形式的注册回调而不是一次性使用，则可以无限期地保留正在传递的参数对象的引用等。

在我们的例子中，处理可能是时间密集型的，所以我们实际上启动了另一个线程——回调在这里也仍然有效：

```
public void DoProcessing(final Object callbacks) {
    //hold a reference for use in the thread
    final Applet app = this;

    //Create a new Thread object to run our request asynchronously
    //so we can return back to single threaded javascript immediately
    Thread async = new Thread() {
        //Thread objects need a run method
        public void run() {
            //do processing....

            JSObject w = JSObject.getWindow(app);
            //Call our named callback, note how we pass the callbacks parameter
            //straight back out again - it will be unchanged in javascript.
            w.call("ProcessingCallback", new Object[]{successful, output, callbacks});
        }
    }
    //start the thread
    async.start();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T18:40:43.350

我是 Java <-> JavaScript 通信的新手，因为我计划本周探索它。一个很好的机会...... :-)

经过一些测试，您似乎无法将 JS 函数传递给 Java 小程序。除非我做错了方法...

我试过：

```
function CallJava()
{
  document.Applet.Call("Does it work?");
  document.Applet.Call(function () { alert("It works!"); });
  document.Applet.Call(DoSomething); // A simple parameterless JS function
  document.Applet.Call(window.location);
}
function DumbTest(message, value)
{
  alert("This is a dumb test with a message:\n" + message + "\n" + value);
} 
```

其中 Call 被定义为：

```
public void Call(String message)
{
  JSObject win = (JSObject) JSObject.getWindow(this);
  String[] arguments = { "Call with String", message };
  win.call("DumbTest", arguments);
}

public void Call(JSObject jso)
{
  JSObject win = (JSObject) JSObject.getWindow(this);
  String[] arguments = { "Call with JSObject", jso.toString() };
  win.call("DumbTest", arguments);
} 
```

当我传递一个 JS 函数（FF3 中的所有测试）时，我在 Java 端得到一个空值。

请注意，以下 Java 例程允许显示 DumberTest 函数的 JS 代码！

```
public int Do()
{
  JSObject win = (JSObject) JSObject.getWindow(this);
  JSObject doc = (JSObject) win.getMember("document");
  JSObject fun = (JSObject) win.getMember("DumberTest");
  JSObject loc = (JSObject) doc.getMember("location");
  String href = (String) loc.getMember("href");
  String[] arguments = { href, fun.toString() };
  win.call("DumbTest", arguments);
  return fun.toString().length();
} 
```

切中要害：我做了一个JS函数：

```
function RegisterCallback(cbFunction)
{
  var callback = cbFunction.toString(); // We get JS code
  var callbackName = /^function (\w+)\(/.exec(callback);
  document.Applet.RegisterCallback(callbackName[1]);
} 
```

我从 toString 结果中提取 JS 函数的名称并将其传递给 Java 小程序。我不认为我们可以处理匿名函数，因为 Java 按名称调用 JS 函数。

Java端：

```
String callbackFunction;
public void RegisterCallback(String functionName)
{
  callbackFunction = functionName;
}
void UseCallbackFunction()
{
    if (callbackFunction == null) return;
    JSObject win = (JSObject) JSObject.getWindow(this);
    win.call(callbackFunction, null);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T21:13:02.217

win.eval() 将调用预定义的 javascript。

```
String callbackFunction;
public void RegisterCallback(String functionName)
{
  callbackFunction = functionName;
}
void UseCallbackFunction()
{
    if (callbackFunction == null) return;
    JSObject win = (JSObject) JSObject.getWindow(this);
    win.eval(callbackFunction);
} 
```

# javascript - Firefox Javascript 事件匿名函数

> ID：295647
> 
> 赞同：1
> 
> 时间：2008-11-17T14:13:11.830
> 
> 标签：javascript, firefox, event-handling, closures, anonymous-function

当用户单击 HTML 表中的单元格时，我试图注册一个匿名函数。下面是一些原始的、纯粹的代码：

```
document.getElementById(
    "course"+displayed_year_index+occurrences_indices[displayed_year_index]).onclick =
        eval("function() {PrintReceipt("+result.years[result_year_index].rul_code+");};"); 
```

注意使用`eval`, 因为它位于一个循环中，并且匿名函数每次都不同。

可以说，这在 Firefox 2 中工作得非常好。但是，Firefox 3 会抛出一个“语法错误”，指向“函数”一词之后的括号内。

有人对我如何解决这个问题有任何聪明的想法吗？

* * *

为了清楚地说明我正在尝试做什么，这里有一个非常简化的示例：

```
for (index=0; index<4; index++) {
    document.getElementById("div"+index).onclick = 
        eval("function () {Foo(index);};");
} 
```

换句话说，我希望用不同的参数值来触发相同的函数`div`。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T14:22:42.810

你有没有尝试过这样的事情？

```
document.getElementById('course' + displayed_year_index + occurences_indices[displayed_year_index]) =
    function (nr)
    {
        return function () { PrintReceipt(nr) }
    } (result.years[result_year_index].rul_code); 
```

您能否发布循环以帮助我们找到问题，而不是让我们猜测您要做什么？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-17T17:28:30.017

恕我直言，在这种情况下不应该使用闭包，也不需要为每个 onlick 创建一个新函数（使用比必要更多的内存），而 eval 是错误的答案。

您知道您使用 getElementById 获得的元素是一个对象，并且您可以为其赋值吗？

```
for ( /* your definition */ ) {
  var e = document.getElementById(
    "course"+displayed_year_index+occurrences_indices[displayed_year_index]
  );
  e.rul_code = result.years[result_year_index].rul_code;
  e.onclick = PrintReceipt;
} 
```

但是您应该首先定义 PrintReceipt：

```
function PrintReceipt() {
  //This function is called as an onclick handler, and "this" is a reference to the element that was clicked.
  if (this.rul_code === undefined) { return; }
  //Do what you want with this.rul_code
  alert (this.rul_code);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T15:39:34.263

使用 Tom 建议的闭包。

这是 John Resig 的一个很好的解释：[闭包的工作原理](http://ajaxian.com/downloads/books/javascriptninja/JavaScriptNinja_ch3_Article1.pdf)(pdf)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T14:35:17.903

这似乎是你想要去的方向：

```
document.getElementById("course"+displayed_year_index+occurrences_indices[displayed_year_index]).addeventlistener("click",  function() {
    var current_rul_code = result.years[result_year_index].rul_code;
    PrintReceipt(current_rul_code);
}, true); 
```

这应该会导致在不同的范围内创建每个 onclick 事件（循环的每次迭代）。 [闭包](http://www.jibbering.com/faq/faq_notes/closures.html)将负责其余的工作。

# java - 向 JTable 添加行

> ID：295649
> 
> 赞同：14
> 
> 时间：2008-11-17T14:13:47.260
> 
> 标签：java, swing

我们有一个简单的项目，我们从套接字读取数据，我们想用即将到来的数据填充一个表，但是我们找不到向尚未创建的`JTable`对象添加行的方法，我们只能找到如何在表的创建时间。

是否可以将行动态添加到 a `JTable`，或者有更好的替代对象来处理这种显示数据的方式？

**编辑**：非常感谢您的回答。

他们三个看起来都很有前途，但我只能选择一个，我认为最好的是纪尧姆的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-17T14:26:30.353

您应该创建一个自定义[`TableModel`](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/table/TableModel.html). A`JTable`实际上并不存储行，它总是将其委托给 a `TableModel`。为了帮助您实现它，您应该使用[`AbstractTableModel`](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/table/AbstractTableModel.html). [`fireTableRowsInserted()`](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/table/AbstractTableModel.html#fireTableRowsInserted(int,%20int))每次添加行时不要忘记调用。如果添加很多行，为了获得更好的性能，请尝试批量更新并一次添加很多行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-17T14:36:20.507

如果您对 JTable 使用默认表模型，则可以使用以下代码添加行

```
 if ( dest+1 < table.getRowCount()-1 )
    ( (DefaultTableModel) table.getModel() ).insertRow(dest+1, getValuesForNewRow());
  else
    ( (DefaultTableModel) table.getModel() ).addRow(getValuesForNewRow()); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T14:26:01.743

一旦您开始在 JTable 中动态添加和删除元素，您确实需要开始使用 TableModel。

有关更多详细信息，请参阅[Java 教程](http://java.sun.com/docs/books/tutorial/uiswing/components/table.html)。

# html - css层排序和排列

> ID：295660
> 
> 赞同：0
> 
> 时间：2008-11-17T14:18:35.657
> 
> 标签：html, css

我试图有一层，并在其中居中图像。IE，如果我有 3 个图像并希望它们下面有 3 个链接，有没有办法做到这一点，而无需为每个链接和图像使用单独的 div 标签？自动使链接在图像下方居中，并且图像在图层内均匀分布？

我也想知道如果可能的话，我将如何让标准 html 后面的 div 显示。IE 如果我有一些文本和文本上的 div，当我希望它在后面时，div 将默认显示在文本上。这只能通过使用另一层来实现吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T14:23:44.510

是的，您必须在每个图像及其标题周围放置一个容器元素，例如 div，以将它们保持在一起。

```
<div class="pictureBox">
    <div>
        <img />
        caption caption
    </div>
    <div>
        <img />
        more caption
    </div>
</div>
--------
.pictureBox div {
    text-align: center;
    /* whatever width/height/positioning you want */
} 
```

对于问题的第二部分，关于将其放在其他文本后面，请查看[CSS z-index](http://www.w3schools.com/css/pr_pos_z-index.asp)，尽管我认为这仅适用于绝对定位的元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T14:28:44.687

nickf 是对的，z-index 仅适用于绝对定位的元素。

您可以使包含元素位置：相对，然后同时提供图像和链接位置：绝对以影响它们的堆叠顺序。

# php - 为什么 PHP Doctine 的 free() 不起作用？

> ID：295662
> 
> 赞同：5
> 
> 时间：2008-11-17T14:18:51.117
> 
> 标签：php, memory, orm, doctrine

这是一个适合你们任何 Doctrine 用户的。我有一个 PHP CLI 守护进程，它每 n 秒检查一次表以查找尚未处理的条目。它基本上是一个FIFO。无论如何，我总是超过分配给 PHP 的内存，因为 Doctrine 并没有释放它的资源。为了解决这个问题，它免费提供了查询对象。我似乎无法让它工作。这是代码：

```
 22     print "You are using " . (memory_get_usage() / 1024). "\n";
 23     $query = Doctrine_Query::create()
 24                 ->from('SubmissionQueue s')
 25                 ->where('s.time_acted_on IS NULL')
 26                 ->orderby('s.time_queued')
 27                 ->limit(1)
 28                 ->execute();
 29     print $query[0]->time_queued . "\n";
 30     $query->free(); 
```

任何想法我做错了什么？

编辑：我正在使用 1.0.3

编辑：我已经尝试了以下所有建议。我非常有希望，`unset()`因为在我找到它之前我就在那里`free()`。

这是更多可能有助于任何帮助的代码。在您质疑连接的打开和关闭之前，它将是生成子进程的守护进程，并且根据我的经验，连接必须是唯一的。

```
 1 <?php
  2
  3 require_once('/usr/local/lib/php/Doctrine/lib/Doctrine.php');
  4
  5 spl_autoload_register(array('Doctrine', 'autoload'));
  6
  7 $manager = Doctrine_Manager::getInstance();
  8 $manager->setAttribute('model_loading','conservative');
  9 Doctrine::loadModels('lib/model/master');
 10
 11 while(1){
 12     print "You are using " . intval(memory_get_usage() / 1024) . "\n";
 13     $manager->connection('********************************************','master');
 14     $query = Doctrine_Query::create()
 15                 ->from('SubmissionQueue s')
 16                 ->where('s.time_acted_on IS NULL')
 17                 ->orderby('s.time_queued')
 18                 ->limit(1)
 19                 ->execute();
 20     print "[" . $query[0]->time_queued . "]\n";
 21     $query->free();
 22     unset($query);
 23     $query = null;
 24     $manager->closeConnection(Doctrine_Manager::getInstance()->getConnection('master'));
 25     sleep(5);
 26 }
 27 
```

一些示例输出：

```
You are using 14949KB
[2008-11-17 13:59:00]
You are using 14978KB
[2008-11-17 13:59:00]
You are using 15007KB
[2008-11-17 13:59:00]
You are using 15035KB
[2008-11-17 13:59:00]
You are using 15064KB
[2008-11-17 13:59:00]
You are using 15093KB
[2008-11-17 13:59:00]
You are using 15121KB
[2008-11-17 13:59:00]
You are using 15150KB
[2008-11-17 13:59:00]
You are using 15179KB
[2008-11-17 13:59:00]
You are using 15207KB
[2008-11-17 13:59:00]
You are using 15236KB
[2008-11-17 13:59:00]
You are using 15265KB
[2008-11-17 13:59:00]
You are using 15293KB
[2008-11-17 13:59:00]
You are using 15322KB 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T19:01:17.023

问题是，这`free()`并没有从内存中删除 Doctrine 对象，而只是消除了对这些对象的循环引用，从而使垃圾收集器可以清理这些对象。请参阅[Doctrine 手册](http://www.doctrine-project.org/documentation/manual/1_0)中的[23.6 自由对象](http://www.doctrine-project.org/documentation/manual/1_0?chapter=improving-performance#free-objects)：

> 从 5.2.5 版本开始，PHP 不能对具有循环引用的对象图进行垃圾收集，例如，Parent 具有对 Child 的引用，而 Child 具有对 Parent 的引用。由于许多学说模型对象都有这样的关系，即使对象超出范围，PHP 也不会释放它们的内存。
> 
> 对于大多数 PHP 应用程序来说，这个问题并不重要，因为 PHP 脚本往往是短暂的。寿命较长的脚本，例如批量数据导入器和导出器，可能会耗尽内存，除非您手动中断循环引用链。Doctrine 在 Doctrine_Record、Doctrine_Collection 和 Doctrine_Query 上提供了一个 free() 函数，它消除了对这些对象的循环引用，将它们释放用于垃圾回收。

解决方案应该是使用后`unset()`的`$query`对象`free()`：

```
$query = Doctrine_Query::create()
            ->from('SubmissionQueue s')
            ->where('s.time_acted_on IS NULL')
            ->orderby('s.time_queued')
            ->limit(1);
$query->execute();
print $query[0]->time_queued . "\n";
$query->free();
unset($query); // perhaps $query = null; will also work 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:43:33.223

Doctrine_Query 也有一个 free() 方法，此时您只是在 Doctrine_Collection 上调用 free()，例如，尝试：

```
 $query = Doctrine_Query::create()
             ->from('SubmissionQueue s')
             ->where('s.time_acted_on IS NULL')
             ->orderby('s.time_queued')
             ->limit(1);
 $results = $query->execute();
 print $results[0]->time_queued . "\n";

 $results->free();
 $query->free(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:55:14.340

没有使用 Doctrine 的经验（只是我在这个周末发现了一些兴趣......），所以接受或留下我的猜测...... ^_^

我会尝试将查询创建与其执行部分分开：

```
$query = Doctrine_Query::create()
            ->from('SubmissionQueue s')
            ->where('s.time_acted_on IS NULL')
            ->orderby('s.time_queued')
            ->limit(1);
$query->execute();
print $query[0]->time_queued . "\n";
$query->free(); 
```

不确定执行返回什么，但以防万一，值得尝试......除非有人有更开明的建议！:-P

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T16:06:14.880

试试 $query->free(true);

（？）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T19:41:24.960

我想我可能只是将 PDO 用于实际上不需要 ORM 的后端部分，因为没有那么多查询。我真的很想在这个系统中的所有应用程序中使用一种单一的方式与数据库进行交互。也许我会多考虑一下。

# c# - 什么是部分类？

> ID：295670
> 
> 赞同：8
> 
> 时间：2008-11-17T14:24:32.683
> 
> 标签：c#, python, oop, programming-languages

它是什么以及如何在 C# 中使用它。
你能在 Python/Perl 中使用相同的概念吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-17T14:26:55.907

[部分类型](http://msdn.microsoft.com/en-us/library/wa80x488.aspx)（它不必是类；结构和接口也可以是部分的）基本上是一种单一类型，其代码分布在多个文件中。

这样做的主要用途是允许代码生成器（例如 Visual Studio 设计者）“拥有”一个文件，而将手写代码放在另一个文件中。

恐怕我不知道 Python/Perl 是否具有相同的功能。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-17T14:58:09.713

c# 部分类已经在这里解释过，所以我将只介绍 python 部分。您可以使用多重继承来优雅地分发类的定义。

```
class A_part1:
    def m1(self):
        print "m1"

class A_part2:
    def m2(self):
        print "m2"

class A(A_part1, A_part2):
    pass

a = A()
a.m1()
a.m2() 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T14:50:12.567

部分类只是一个包含在多个文件中的类。有时它的一部分是机器生成的，而另一部分是用户编辑的。

当我创建一个有点太大的类时，我在 C# 中使用它们。我将把访问器和构造器放在一个文件中，所有有趣的方法放在另一个文件中。

在 Perl 中，您只需拥有两个（或更多）文件，每个文件都声明自己在一个包中：

（主程序）

```
 use MyClass; 
```

（在 MyClass.pm 中）

```
 use MyClassOtherStuff;
    package MyClass;
    # [..class code here...] 
```

（在 MyClassOtherStuff.pm 中）

```
 package MyClass;
    # [...rest of code here...] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-17T14:42:02.880

部分类型的概念已经解释过了。

这可以在 python 中完成。例如，在 python shell 中执行以下操作。

```
class A(object):
    pass

obj = A()

def _some_method(self):
    print self.__class__
A.identify = _some_method

obj.identify() 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T14:39:54.553

因为 python 是一种动态语言，所以你不需要像偏类这样的概念。在 python 中，可以在运行时扩展具有功能的对象，因此可以将类声明分解为不同的文件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T14:51:13.970

Partial 类型是其声明在多个文件中分隔的类型。如果您有一个大类（对于典型的开发人员来说很难处理和阅读），那么使用它们是有意义的，将类定义分隔在单独的文件中，并在每个文件中放入逻辑上分隔的代码部分（例如所有公共方法和属性在一个文件中，私有在另一个文件中，db 处理代码在第三个文件中，依此类推..)

不，您在 Python 中没有相同的语法元素。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-17T20:32:03.813

Python 也有元类，但它更像是一个模板类而不是部分类。使用元类的一个很好的例子是 Django ORM。您的所有表模型都继承自一个基模型类，该基模型类也从元类中获取功能。这是一个非常酷的概念，可以启用像模式这样的活动记录（它是完整的活动记录吗？）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-19T02:59:06.053

`auto-generated code`当您使用某些工具时，部分课程会派上用场。请参阅问题[Project structure for Schema First Service Development using WCF](https://stackoverflow.com/questions/15447072/project-structure-for-schema-first-service-development-using-wcf)作为示例。

您可以将逻辑放在部分类中。即使自动生成的文件被销毁并重新创建，您的逻辑也会保留在部分类中。

# java - 使用 Eclipse 远程调试器抛出 com.sun.jdi.InternalException

> ID：295686
> 
> 赞同：31
> 
> 时间：2008-11-17T14:32:06.940
> 
> 标签：java, eclipse, debugging

抛出以下错误：

```
com.sun.jdi.InternalException: Got error code in reply:35 occurred while retrieving value. for all expressions 
```

对于所有表达式，我都收到此错误，并且在其上找不到任何内容。我的猜测是调试器没有正确连接到远程版本，但我不确定。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2018-02-27T07:08:36.410

看起来问题与新的调试功能“一步操作后显示方法结果”有关：请参阅Eclipse 论坛上的线程[Eclipse Oxygen - 调试问题：](https://www.eclipse.org/forums/index.php?t=msg&th=1088650&goto=1772065&)

**解决方法是转到 Preferences -> Java -> Debug 并禁用选项“在步骤操作后显示方法结果（如果 VM 支持；可能会很慢）”。**

另请参阅 Eclipse Bugzilla [Bug 531706 - Oygen.2 com.sun.jdi.InternalException: Got error code in reply:35 while debugging](https://bugs.eclipse.org/bugs/show_bug.cgi?id=531706)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-11-16T11:56:05.167

我在本地服务器上也遇到了同样的问题。但是，这是`for`循环的问题。我正在使用：

```
for(Object obj: list)
{
    for(Object obj2 : list)
    {}
} 
```

当我用简单的 for 循环（基于索引）替换该代码时，它解决了上述问题。我认为对于每个循环都无法在同一循环中迭代另一个相同类型的列表。解决此问题的方法是将 for 循环替换为基于索引的 for 循环。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-17T14:53:47.817

只是为了确定：你是在远程调试一些检测代码吗？

[因为JProfiler](http://forums.sun.com/thread.jspa?threadID=5276797)似乎有一些问题......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-08-02T13:11:40.983

## 解决方法：取消选中此框：

[![在此处输入图像描述](https://i.stack.imgur.com/t6FRk.png)](https://i.stack.imgur.com/t6FRk.png)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-05-31T19:38:19.123

如果您在调试时在“表达式”选项卡中打开了“逻辑结构”，即使在 Eclipse IDE 版本 4.11.0 中，这似乎仍然会导致问题。关闭它对我有帮助。*它本身*不是一个“解决方案” ，而是一种变通方法。

请参阅[Eclipse 错误 48815](https://bugs.eclipse.org/bugs/show_bug.cgi?id=48815)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-24T17:56:36.317

I am not sure but I have got this plenty of times. It comes when I debug the application, and I think it occurs when the debugger tries to wrap a exception which arises due to code. At one instance while debugging when I see the logs I get some business exception, but while debugging it gave me `com.sun.jdi.internalexception`.

Yes I do remote debugging the servers JVM so it could also be beacuse the debugger isn't correctly connecting to the remote version as you pointed out

# .net - 获取 Windows 窗体应用程序执行目录的路径

> ID：295687
> 
> 赞同：53
> 
> 时间：2008-11-17T14:34:34.813
> 
> 标签：.net, winforms, path, directory

我想获取 Windows 窗体应用程序的执行目录的路径。（即可执行文件所在的目录。）

有谁知道.NET 中的内置方法可以做到这一点？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-11-17T14:36:11.147

在 VB.NET 中

```
Dim directory as String = My.Application.Info.DirectoryPath 
```

在 C# 中

```
string directory = AppDomain.CurrentDomain.BaseDirectory; 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-11-17T14:41:08.780

Application.Current 导致 appdomain [http://msdn.microsoft.com/en-us/library/system.appdomain_members.aspx](http://msdn.microsoft.com/en-us/library/system.appdomain_members.aspx)

这也应该给你装配的位置

```
AppDomain.CurrentDomain.BaseDirectory 
```

我似乎记得有多种方法可以获取应用程序的位置。但这至少在过去对我有用（我已经有一段时间没有做过winforms编程了：/）

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-17T14:36:59.647

这可能会有所帮助；

```
Path.GetDirectoryName(Application.ExecutablePath); 
```

这里也是[参考](http://www.csharp-examples.net/get-application-directory/)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-01T09:48:38.960

`System.Windows.Forms.Application.StartupPath`会解决你的问题，我想

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-07T05:14:28.753

这两个示例都在 VB.NET 中。

**调试路径：**

```
TextBox1.Text = My.Application.Info.DirectoryPath 
```

**EXE路径：**

```
TextBox2.Text = IO.Path.GetFullPath(Application.ExecutablePath) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T14:50:07.217

```
string apppath = 
    (new System.IO.FileInfo
    (System.Reflection.Assembly.GetExecutingAssembly().CodeBase)).DirectoryName; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-29T07:20:37.047

看一下这个：

```
Imports System.IO
Imports System.Management

Public Class Form1
        Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        TextBox1.Text = Path.GetFullPath(Application.ExecutablePath)
        Process.Start(TextBox1.Text)
    End Sub
End Class 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-08-09T13:39:29.580

```
Private Sub Main_Shown(sender As Object, e As EventArgs) Handles Me.Shown
    Dim args() As String = Environment.GetCommandLineArgs()
    If args.Length > 0 Then
        TextBox1.Text = Path.GetFullPath(Application.ExecutablePath)
        Process.Start(TextBox1.Text)   
    End If
End Sub 
```

# .net - 一对多的内部选择

> ID：295688
> 
> 赞同：1
> 
> 时间：2008-11-17T14:34:53.427
> 
> 标签：.net, sql, sql-server, tsql

我有 2 张桌子 event + event_artist

## 事件

```
eventId | eventName  
-------------------
1 , gig1  
2, gig2 
```

## 事件艺术家

```
eventId, artistName 
------------------- 
1, Led Zip  
1, The Beatles 
```

ie Led Zep 和披头士都在玩@ Gig1

我需要创建 SQl 以绑定到 gridview（您必须了解 gridviews 才能回答这个问题）

我想要的结果看起来像这样
eventId = 1, EventName = Gig1。ArtistLineup = Led Zep，披头士乐队

所以我需要创建一个别名 ArtistLineup 来列出所有艺术家。我认为通过内部选择。

关于这会是什么样子的任何想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:14:31.833

在 SQL Server Magazine 中看到了这个——不是很好，总列表会有一个长度上限，但是：

```
drop table event
go

drop table event_artist
go

create table event (eventid int, eventname varchar(255))
go

create table event_artist (eventid int, artistname varchar(255))
go

insert into event values (1, 'gig1')
go

insert into event values (2, 'gig2')
go

insert into event_artist values (1, 'Led Zip')
go

insert into event_artist values (1, 'The Beatles')
go

drop function Event_Display
go

create function Event_Display (@EventID int) returns varchar(2000) as
begin
    declare @artistList varchar(2000)
    set @artistList=''

    select @artistList=@artistList + ', ' + isnull(artistname,'') 
    from event_artist 
    where eventid=@EventID

    return substring(@artistList,3,2000)  --eliminate initial comma
end
go

select event.eventid, event.eventname, dbo.Event_Display(event.eventid) from event 
```

```

1 gig1 Led Zip，披头士乐队

2演出2     

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T14:59:31.333

SQL Server 没有内置任何东西来在这样的一个语句中连接值。您可以构建字符串，但必须一次完成一个。

但是，您可以通过构建自己的[自定义聚合函数](https://stackoverflow.com/questions/43940/custom-aggregate-functions-in-ms-sql-server)来解决此问题（需要在 SQL Server 2000 中使用 ActiveX 对象进行混乱的游戏）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:09:22.607

你可能想尝试这样的事情： [为什么这个 SQL 脚本会这样工作？](https://stackoverflow.com/questions/279444/why-does-this-sql-script-work-as-it-does)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T15:28:44.033

ScottK 的答案基本上是您想要的答案。这是我的其余部分：

查询：

```
select e.*, dbo.ArtistList(e.EventId) as ArtistList
from [event] e 
```

功能：

```
CREATE FUNCTION ArtistList<br>
(
    -- Add the parameters for the function here<br>
    @EventId int<br>
)
RETURNS varchar(MAX)<br>
AS
BEGIN
    -- Declare the return variable here
    DECLARE @ArtistList varchar(MAX)
    -- Add the T-SQL statements to compute the return value here
    SELECT @ArtistList = COALESCE(@ArtistList + ', ', '') + Artist
    FROM EventArtist
    WHERE EventId = @EventId
    -- Return the result of the function
    RETURN @ArtistList
END
GO 
```

我的答案和 ScottK 的答案之间的唯一区别是我使用`varchar(MAX)`. 这几乎可以解决有关艺术家名单被截断的任何担忧。

我已经删除了我之前的（不完整的）答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T15:38:18.477

您可以使用[Kevin Fairchild](https://stackoverflow.com/users/3743/kevin-fairchild)发布[的巧妙的 FOR XML 技巧](https://stackoverflow.com/questions/273238/how-to-use-group-by-to-concatenate-strings-in-mssql)（我已对其进行了修改以考虑包含空格的乐队名称）：

```
/*
create table [event] (eventid int, eventname varchar(255))
create table event_artist (eventid int, artistname varchar(255))
insert into [event] values (1, 'gig1')
insert into [event] values (2, 'gig2')
insert into event_artist values (1, 'Led Zip')
insert into event_artist values (1, 'The Beatles')
*/

SELECT  e.eventid
       ,e.eventname
       ,REPLACE(REPLACE(RTRIM((
                               SELECT   artistname + '| '
                               FROM     [event_artist]
                               WHERE    eventid = e.eventid
                              FOR
                               XML PATH('')
                              )), '| ', ', '), '|', '') AS artists
FROM    [event] AS e 
```

请注意，这要求 FOR XML 中的列未命名（命名列获得 XML 包装器）。

# php - 这个 preg_replace_callback 在 PHP 中做了什么？以及如何阻止它泄漏内存？

> ID：295690
> 
> 赞同：0
> 
> 时间：2008-11-17T14:35:25.453
> 
> 标签：php, preg-replace-callback, create-function

我在 b2evo PHP 网站上有一段代码，它执行以下操作：

```
$content = preg_replace_callback(
    '/[\x80-\xff]/',
    create_function( '$j', 'return "&#".ord($j[0]).";";' ),
    $content); 
```

这部分代码是做什么的？我的猜测是它会去除 128 到 256 之间的 ascii 字符，但我不能确定。

此外，就目前而言，每次从页面中调用这段代码时，PHP 都会分配然后不释放多达 2K 的内存。如果该函数在一个页面上被调用 1000 次以上（这可能发生），那么该页面会使用额外的 2MB 内存。

这导致我的 Web 应用程序出现问题。为什么我会丢失内存，以及如何重写它以免出现内存泄漏？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T14:37:22.797

就是`create_function`这会泄漏您的记忆-只需使用普通功能就可以了。

该函数本身正在用数字 HTML 实体 ( `&#xxx;`)替换字符

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T14:37:32.920

不是真正的剥离，它用它们的实体替换了高 Ascii 字符。

请参阅[preg_replace_callback](http://fr.php.net/manual/en/function.preg-replace-callback.php "PHP: preg_replace_callback - 手动")。
create_function 用于创建匿名函数，但您可以使用普通函数：

```
$content = 'Çà ! Nœm dé fîçhïèr tôrdù, @ pöür têstër... ? ~ Œ[€]';
$content = preg_replace_callback('/[\x80-\xff]/', 'CB_CharToEntity', $content);
echo $econtent . '<br>';
echo htmlspecialchars($content) . '<br>';
echo htmlentities($content) . '<br>';
echo htmlentities($content, ENT_NOQUOTES, 'cp1252') . '<br>';

function CB_CharToEntity($matches)
{
    return '&#' . ord($matches[0]) . ';';
} 
```

[编辑] 找到了一种更清洁、可能更快的方法来完成这项工作！^_^ 只需使用带有适合您需求的选项的 htmlentities。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-15T07:40:15.910

`preg_replace`在您的情况下使用`/e`标志要简单得多：

```
$content = preg_replace(
    '/[\x80-\xff]/e',
    '"&#".ord($0).";"',
    $content); 
```

# javascript - Dojo 的 Javascript 执行顺序问题

> ID：295708
> 
> 赞同：-1
> 
> 时间：2008-11-17T14:40:59.577
> 
> 标签：javascript, dojo

在我问我的问题之前，这是有问题的代码：

```
var coords = dojo.coords(g);
g.style.left = coords.x + "px";
g.style.top = coords.y + "px";
g.style.position = "absolute"; 
```

现在想象这`g`是一个相对定位的元素，`x`位置为 70，`y`位置为 30。如果我注释掉上面代码的最后一行，这就是`dojo.coords(g)`给我的。但是，只要我添加最后一行，就会`dojo.coords(g)`返回一个`x`18 的位置，如果它是绝对定位的，这就是元素所在的位置。在我看来，调用`dojo.coords()`不应该受到它下面的代码的影响，但确实如此。

我也看到了同样的问题`dojo.require()`，如果我在加载它的函数调用之前直接调用它，我会得到一个给定函数的未定义错误。

我在 Firefox 3 中进行测试，但我也注意到 Safari 3 中的类似问题。有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T04:47:19.130

这不是 Dojo 的怪癖，而是浏览器的工作方式。基本上，DOM 可能需要一些时间来反映您的更改和重新定位元素，甚至更改布局。这就是为什么你看到你所看到的。

另一个原因可能在您的元素的父级中。dojo.coords() 返回相对于视口的位置。如果您将“true”作为第二个值传递，它将返回相对于文档根的位置。直接分配 top/left 并将位置更改为“绝对”会使元素相对于其父元素（如果它也被定位（绝对、相对或固定））或文档根定位。这是一个微妙的区别，但有时它会咬人。相关参考：[包含块](http://code.google.com/docreader/#p=doctype&s=doctype&t=PositionCSSProperty)，[MSDN：位置属性](http://msdn.microsoft.com/en-us/library/ms534345(VS.85).aspx)，[谷歌文档类型：位置](http://code.google.com/docreader/#p=doctype&s=doctype&t=PositionCSSProperty)。

PS：就我个人而言，我依靠 Dojo 来设置 left/top，希望它能针对浏览器的怪癖做正确的事情，我首先设置了位置：

```
var coords = dojo.coords(g);
g.style.position = "absolute";
dojo.marginBox(g, {l: coords.x, t: coords.y}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T19:03:50.667

我仍然希望有人解释为什么会这样，但这里有一个解决方案：

```
var coords = dojo.coords(g);
g.style.left = coords.x + "px";
g.style.top = coords.y + "px";
setTimeout(function(h) {
    h.style.position = "absolute";
}, 0, g); 
```

干杯

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-17T14:46:58.830

很抱歉没有回答你的问题，（因为我不知道 dojo）但是除非 coords.x 和 coords.y 返回一个字符串，否则你的函数中有错误，

> g.style.left = coords.x + "px";
> 
> g.style.top = coords.y + "px";

您需要始终将字符串传递给样式，因此还要添加以下内容：

```
g.style.left = parseInt(coords.x) + "px";
g.style.top = parseInt(coords.y) + "px"; 
```

你会惊讶于这种错误有多少次让我头晕目眩。关于答案，对不起，我帮不了你。

祝你好运！

编辑：

哦，如果我明白了，我现在可以帮助你.. 好吧，因为我不知道 dojo，所以我可以向你指出一个类似的 javascript，它可以满足你的需求。

```
g.offsetTop 
```

和

```
g.offsetLeft 
```

将为您提供元素位置的坐标。尝试一下，看看它是否有效..

# entity-framework - 使用 Entity Framework 记录每个数据更改

> ID：295710
> 
> 赞同：30
> 
> 时间：2008-11-17T14:41:24.177
> 
> 标签：entity-framework, logging

客户需要将每个数据更改与进行修改的实际用户一起记录到日志表中。应用程序使用一个 SQL 用户访问数据库，但我们需要记录“真实”用户 ID。

我们可以在 t-sql 中通过为每个表插入和更新编写触发器，并使用 context_info 来存储用户 ID 来做到这一点。我们将用户 ID 传递给存储过程，将用户 ID 存储在 contextinfo 中，触发器可以使用此信息将日志行写入日志表。

我找不到使用 EF 做类似事情的地方或方式。所以主要目标是：如果我通过 EF 对数据进行更改，我想以半自动方式将确切的数据更改记录到表中（所以我不想在之前检查每个字段的更改保存对象）。我们正在使用 EntitySQL。

不幸的是，我们必须坚持使用 SQL 2000，因此 SQL2008 中引入的数据更改捕获不是一种选择（但也许这对我们来说也不是正确的方法）。

任何想法、链接或起点？

**[编辑]** 一些注意事项：通过使用 ObjectContext.SavingChanges 事件处理程序，我可以获得可以注入 SQL 语句来初始化 contextinfo 的点。但是我不能混合使用 EF 和标准 SQL。所以我可以获得 EntityConnection 但我无法使用它执行 T-SQL 语句。或者我可以获取EntityConnection的连接字符串，并基于它创建一个SqlConnection，但是会是不同的连接，所以contextinfo不会影响EF进行的保存。

我在 SavingChanges 处理程序中尝试了以下操作：

```
testEntities te = (testEntities)sender;
DbConnection dc = te.Connection;
DbCommand dcc = dc.CreateCommand();
dcc.CommandType = CommandType.StoredProcedure;
DbParameter dp = new EntityParameter();
dp.ParameterName = "userid";
dp.Value = textBox1.Text;
dcc.CommandText = "userinit";
dcc.Parameters.Add(dp);
dcc.ExecuteNonQuery(); 
```

错误：EntityCommand.CommandText 的值对于 StoredProcedure 命令无效。与 SqlParameter 而不是 EntityParameter 相同：不能使用 SqlParameter。

```
StringBuilder cStr = new StringBuilder("declare @tx char(50); set @tx='");
cStr.Append(textBox1.Text);
cStr.Append("'; declare @m binary(128); set @m = cast(@tx as binary(128)); set context_info @m;");

testEntities te = (testEntities)sender;
DbConnection dc = te.Connection;
DbCommand dcc = dc.CreateCommand();
dcc.CommandType = CommandType.Text;
dcc.CommandText = cStr.ToString();
dcc.ExecuteNonQuery(); 
```

错误：查询语法无效。

所以我在这里，坚持在 Entity Framework 和 ADO.NET 之间建立一座桥梁。如果我能让它工作，我会发布一个概念证明。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-17T15:28:08.857

如何处理上下文。[保存更改](http://msdn.microsoft.com/en-us/library/cc716714.aspx)？

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-02-25T20:42:10.437

感谢您为我指明正确的方向。但是，在我的情况下，我还需要在执行 select 语句时设置上下文信息，因为我正在查询使用上下文信息来控制用户行级安全性的视图。

我发现附加到连接的 StateChanged 事件最容易，只需注意从未打开到打开的变化。然后我调用设置上下文的 proc，它每次都有效，即使 EF 决定重置连接。

```
private int _contextUserId;

public void SomeMethod()
{
    var db = new MyEntities();
    db.Connection.StateChange += this.Connection_StateChange;
    this._contextUserId = theCurrentUserId;

    // whatever else you want to do
}

private void Connection_StateChange(object sender, StateChangeEventArgs e)
{
    // only do this when we first open the connection
    if (e.OriginalState == ConnectionState.Open ||
        e.CurrentState != ConnectionState.Open)
        return;

    // use the existing open connection to set the context info
    var connection = ((EntityConnection) sender).StoreConnection;
    var command = connection.CreateCommand();
    command.CommandText = "proc_ContextInfoSet";
    command.CommandType = CommandType.StoredProcedure;
    command.Parameters.Add(new SqlParameter("ContextUserID", this._contextUserId));
    command.ExecuteNonQuery();
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-20T09:03:22.813

最后在克雷格的帮助下，这是一个概念证明。它需要更多测试，但首先看起来它正在工作。

首先：我创建了两张表，一张用于数据，一张用于记录。

```
-- This is for the data
create table datastuff (
    id int not null identity(1, 1),
    userid nvarchar(64) not null default(''),
    primary key(id)
)
go

-- This is for the log
create table naplo (
    id int not null identity(1, 1),
    userid nvarchar(64) not null default(''),
    datum datetime not null default('2099-12-31'),
    primary key(id)
)
go 
```

第二：为插入创建触发器。

```
create trigger myTrigger on datastuff for insert as

    declare @User_id int,
        @User_context varbinary(128),
        @User_id_temp varchar(64)

    select @User_context = context_info
        from master.dbo.sysprocesses
        where spid=@@spid

    set @User_id_temp = cast(@User_context as varchar(64))

    declare @insuserid nvarchar(64)

    select @insuserid=userid from inserted

    insert into naplo(userid, datum)
        values(@User_id_temp, getdate())

go 
```

您还应该为更新创建一个触发器，它会更复杂一些，因为它需要检查每个字段的更改内容。

应该扩展日志表和触发器以存储创建/更改的表和字段，但我希望你明白了。

第三：创建一个存储过程，将用户ID填充到SQL上下文信息中。

```
create procedure userinit(@userid varchar(64))
as
begin
    declare @m binary(128)
    set @m = cast(@userid as binary(128))
    set context_info @m
end
go 
```

我们已经准备好 SQL 端了。这里是 C# 部分。

创建一个项目并将 EDM 添加到项目中。EDM 应包含数据表（或您需要监视更改的表）和 SP。

现在对实体对象做一些事情（例如添加一个新的数据对象）并挂钩到 SavingChanges 事件。

```
using (testEntities te = new testEntities())
{
    // Hook to the event
    te.SavingChanges += new EventHandler(te_SavingChanges);

    // This is important, because the context info is set inside a connection
    te.Connection.Open();

    // Add a new datastuff
    datastuff ds = new datastuff();

    // This is coming from a text box of my test form
    ds.userid = textBox1.Text;
    te.AddTodatastuff(ds);

    // Save the changes
    te.SaveChanges(true);

    // This is not needed, only to make sure
    te.Connection.Close();
} 
```

在 SavingChanges 中，我们注入代码来设置连接的上下文信息。

```
// Take my entity
testEntities te = (testEntities)sender;

// Get it's connection
EntityConnection dc = (EntityConnection )te.Connection;

// This is important!
DbConnection storeConnection = dc.StoreConnection;

// Create our command, which will call the userinit SP
DbCommand command = storeConnection.CreateCommand();
command.CommandText = "userinit";
command.CommandType = CommandType.StoredProcedure;

// Put the user id as the parameter
command.Parameters.Add(new SqlParameter("userid", textBox1.Text));

// Execute the command
command.ExecuteNonQuery(); 
```

所以在保存更改之前，我们打开对象的连接，注入我们的代码（不要在这部分关闭连接！）并保存我们的更改。

不要忘记！这需要根据您的日志记录需求进行扩展，并且需要进行良好的测试，因为这仅显示了可能性！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-19T20:47:38.570

您是否尝试过将存储过程添加到您的实体模型中？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-08T19:55:31.307

我们以不同的方式解决了这个问题。

*   从您生成的实体容器类继承一个类
*   使基实体类抽象。您可以通过单独文件中的部分类定义来完成
*   在继承的类中，用你自己的方法隐藏 SavingChanges 方法，在方法定义中使用 new 关键字
*   在您的 SavingChanges 方法中：

    1.  a、打开实体连接
    2.  使用 ebtityclient 执行用户上下文存储过程
    3.  调用 base.SaveChanges()
    4.  关闭实体连接

在您的代码中，您必须使用继承的类。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-08-06T21:44:01.057

只需使用 DbContext 或 ObjectContext 强制执行 SET CONTEXT_INFO：

```
...
FileMoverContext context = new FileMoverContext();
context.SetSessionContextInfo(Environment.UserName);
...
context.SaveChanges(); 
```

FileMoverContext 继承自 DbContext 并具有 SetSessionContextInfo 方法。这是我的 SetSessionContextInfo(...) 的样子：

```
public bool SetSessionContextInfo(string infoValue)
{
   try
   {
      if (infoValue == null)
         throw new ArgumentNullException("infoValue");

      string rawQuery =
                   @"DECLARE @temp varbinary(128)
                     SET @temp = CONVERT(varbinary(128), '";

      rawQuery = rawQuery + infoValue + @"');
                    SET CONTEXT_INFO @temp";
      this.Database.ExecuteSqlCommand(rawQuery);

      return true;
   }
   catch (Exception e)
   {
      return false;
   }
} 
```

现在您只需设置一个数据库触发器，它可以访问 CONTEXT_INFO() 并使用它设置一个数据库字段。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-09T10:17:40.870

我有一些类似的场景，我通过以下步骤解决了这个问题：

1.  首先为以下所有 CRUD 操作创建一个通用存储库，这始终是一个好方法。公共类 GenericRepository : IGenericRepository 其中 T : 类

2.  现在写下你的动作，比如“public virtual void Update(T entityToUpdate)”。

3.  无论您在哪里需要记录/审计；只需调用用户定义的函数，如下所示“LogEntity(entityToUpdate, “U”);”。
4.  请参阅下面粘贴的文件/类来定义“LogEntity”函数。在这个函数中，在更新和删除的情况下，我们将通过主键获取旧实体插入到审计表中。为了识别主键并获取它的值，我使用了反射。

在下面找到完整课程的参考：

```
 public class GenericRepository<T> : IGenericRepository<T> where T : class
{
    internal SampleDBContext Context;
    internal DbSet<T> DbSet;

    /// <summary>
    /// Constructor to initialize type collection
    /// </summary>
    /// <param name="context"></param>
    public GenericRepository(SampleDBContext context)
    {
        Context = context;
        DbSet = context.Set<T>();
    }

    /// <summary>
    /// Get query on current entity
    /// </summary>
    /// <returns></returns>
    public virtual IQueryable<T> GetQuery()
    {
        return DbSet;
    }

    /// <summary>
    /// Performs read operation on database using db entity
    /// </summary>
    /// <param name="filter"></param>
    /// <param name="orderBy"></param>
    /// <param name="includeProperties"></param>
    /// <returns></returns>
    public virtual IEnumerable<T> Get(Expression<Func<T, bool>> filter = null, Func<IQueryable<T>,
                                            IOrderedQueryable<T>> orderBy = null, string includeProperties = "")
    {
        IQueryable<T> query = DbSet;

        if (filter != null)
        {
            query = query.Where(filter);
        }

        query = includeProperties.Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries).Aggregate(query, (current, includeProperty) => current.Include(includeProperty));

        if (orderBy == null)
            return query.ToList();
        else
            return orderBy(query).ToList();
    }

    /// <summary>
    /// Performs read by id operation on database using db entity
    /// </summary>
    /// <param name="id"></param>
    /// <returns></returns>
    public virtual T GetById(object id)
    {
        return DbSet.Find(id);
    }

    /// <summary>
    /// Performs add operation on database using db entity
    /// </summary>
    /// <param name="entity"></param>
    public virtual void Insert(T entity)
    {
        //if (!entity.GetType().Name.Contains("AuditLog"))
        //{
        //    LogEntity(entity, "I");
        //}
        DbSet.Add(entity);
    }

    /// <summary>
    /// Performs delete by id operation on database using db entity
    /// </summary>
    /// <param name="id"></param>
    public virtual void Delete(object id)
    {
        T entityToDelete = DbSet.Find(id);
        Delete(entityToDelete);
    }

    /// <summary>
    /// Performs delete operation on database using db entity
    /// </summary>
    /// <param name="entityToDelete"></param>
    public virtual void Delete(T entityToDelete)
    {
        if (!entityToDelete.GetType().Name.Contains("AuditLog"))
        {
            LogEntity(entityToDelete, "D");
        }

        if (Context.Entry(entityToDelete).State == EntityState.Detached)
        {
            DbSet.Attach(entityToDelete);
        }
        DbSet.Remove(entityToDelete);
    }

    /// <summary>
    /// Performs update operation on database using db entity
    /// </summary>
    /// <param name="entityToUpdate"></param>
    public virtual void Update(T entityToUpdate)
    {
        if (!entityToUpdate.GetType().Name.Contains("AuditLog"))
        {
            LogEntity(entityToUpdate, "U");
        }
        DbSet.Attach(entityToUpdate);
        Context.Entry(entityToUpdate).State = EntityState.Modified;
    }

    public void LogEntity(T entity, string action = "")
    {
        try
        {
            //*********Populate the audit log entity.**********
            var auditLog = new AuditLog();
            auditLog.TableName = entity.GetType().Name;
            auditLog.Actions = action;
            auditLog.NewData = Newtonsoft.Json.JsonConvert.SerializeObject(entity);
            auditLog.UpdateDate = DateTime.Now;
            foreach (var property in entity.GetType().GetProperties())
            {
                foreach (var attribute in property.GetCustomAttributes(false))
                {
                    if (attribute.GetType().Name == "KeyAttribute")
                    {
                        auditLog.TableIdValue = Convert.ToInt32(property.GetValue(entity));

                        var entityRepositry = new GenericRepository<T>(Context);
                        var tempOldData = entityRepositry.GetById(auditLog.TableIdValue);
                        auditLog.OldData = tempOldData != null ? Newtonsoft.Json.JsonConvert.SerializeObject(tempOldData) : null;
                    }

                    if (attribute.GetType().Name == "CustomTrackAttribute")
                    {
                        if (property.Name == "BaseLicensingUserId")
                        {
                            auditLog.UserId = ValueConversion.ConvertValue(property.GetValue(entity).ToString(), 0);
                        }
                    }
                }
            }

            //********Save the log in db.*********
            new UnitOfWork(Context, null, false).AuditLogRepository.Insert(auditLog);
        }
        catch (Exception ex)
        {
            Logger.LogError(string.Format("Error occured in [{0}] method of [{1}]", Logger.GetCurrentMethod(), this.GetType().Name), ex);
        }
    }
}

CREATE TABLE [dbo].[AuditLog](
[AuditId] [BIGINT] IDENTITY(1,1) NOT NULL,
[TableName] [nvarchar](250) NULL,
[UserId] [int] NULL,
[Actions] [nvarchar](1) NULL,
[OldData] [text] NULL,
[NewData] [text] NULL,
[TableIdValue] [BIGINT] NULL,
[UpdateDate] [datetime] NULL,
 CONSTRAINT [PK_DBAudit] PRIMARY KEY CLUSTERED 
(
[AuditId] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = 
OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-22T19:28:19.787

这是我在[这里](https://exceptionnotfound.net/entity-change-tracking-using-dbcontext-in-entity-framework-6/)找到的我修改了它，因为它不起作用

```
private object GetPrimaryKeyValue(DbEntityEntry entry)
        {
            var objectStateEntry = ((IObjectContextAdapter)this).ObjectContext.ObjectStateManager.GetObjectStateEntry(entry.Entity);
            object o = objectStateEntry.EntityKey.EntityKeyValues[0].Value;
            return o;
        }

         private bool inExcludeList(string prop)
        {
            string[] excludeList = { "props", "to", "exclude" };
            return excludeList.Any(s => s.Equals(prop));
        }

        public int SaveChanges(User user, string UserId)
        {
            var modifiedEntities = ChangeTracker.Entries()
                .Where(p => p.State == EntityState.Modified).ToList();
            var now = DateTime.Now;

            foreach (var change in modifiedEntities)
            {

                var entityName = ObjectContext.GetObjectType(change.Entity.GetType()).Name;
                var primaryKey = GetPrimaryKeyValue(change);
                var DatabaseValues = change.GetDatabaseValues();

                foreach (var prop in change.OriginalValues.PropertyNames)
                {
                    if(inExcludeList(prop))
                    {
                        continue;
                    }

                    string originalValue = DatabaseValues.GetValue<object>(prop)?.ToString();
                    string currentValue = change.CurrentValues[prop]?.ToString();

                    if (originalValue != currentValue)
                    {
                        ChangeLog log = new ChangeLog()
                        {
                            EntityName = entityName,
                            PrimaryKeyValue = primaryKey.ToString(),
                            PropertyName = prop,
                            OldValue = originalValue,
                            NewValue = currentValue,
                            ModifiedByName = user.LastName + ", " + user.FirstName,
                            ModifiedById = UserId,
                            ModifiedBy = user,
                            ModifiedDate = DateTime.Now
                        };

                        ChangeLogs.Add(log);
                    }
                }
            }
            return base.SaveChanges();
        }

public class ChangeLog 
    {
        public int Id { get; set; }
        public string EntityName { get; set; }
        public string PropertyName { get; set; }
        public string PrimaryKeyValue { get; set; }
        public string OldValue { get; set; }
        public string NewValue { get; set; }
        public string ModifiedByName { get; set; }

        [ForeignKey("ModifiedBy")]
        [DisplayName("Modified By")]
        public string ModifiedById { get; set; }
        public virtual User ModifiedBy { get; set; }

        [Column(TypeName = "datetime2")]
        public DateTime? ModifiedDate { get; set; }
    } 
```

# file-format - 在寻找未知的存档文件之前我应该 知道什么？

> ID：295711
> 
> 赞同：4
> 
> 时间：2008-11-17T14:41:35.503
> 
> 标签：file-format

我玩的游戏将其所有数据存储在 .DAT 文件中。人们在检查文件方面做了一些[工作。](http://wiki.xentax.com/index.php?title=Guild_Wars_DAT)还有一些[现有的工具](http://wiki.xentax.com/index.php?title=Game_Tools#Guild_Wars)，但我不确定它们的当前状态。我认为自己在数据中四处寻找会很有趣，但我从未尝试过检查文件，更不用说以前这样的事情了。

在我一头扎进去之前，关于检查文件格式以进行数据提取，有什么我应该知道的吗？

编辑：我想要非常一般的提示，因为检查文件格式似乎很有趣。我希望能够使用 File X 并学习如何解决学习它的问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-17T14:51:49.693

1.  在你走得太远之前，你肯定会想要一个十六进制编辑器。它可以让您在任何字体记事本（或任何文本编辑器）中将原始数据视为数字而不是大的空块。
2.  尝试在您拥有的任何存档提取器（即 zip、7z、rar、gz、tar 等）中打开它，看看它是否只是重命名的文件格式（.PK3 类似）。
3.  在文件中的某处查找已知文件格式的标题，这将帮助您发现数据的某些部分存储在何处（即搜索“IPNG”以查找其中某处的任何（未压缩）png 文件）。
4.  如果您确实找到了某条数据的存储位置，请记下它的位置和长度，并查看是否可以在文件开头附近找到等于其中任何一个值的数字，这些数字通常充当指向实际数据的指针数据。
5.  有时你只需要猜测或直觉某个值的含义，如果你错了，那么，继续前进。您对此无能为力。
6.  我发现[http://www.wotsit.org](http://www.wotsit.org "Wotsit.org")对于已知的文件类型格式特别有用，有助于在 .dat 文件中查找标题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T15:00:27.227

先备份文件。一旦你限制了你可以造成的伤害量，就按照 Ed 的建议四处寻找。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T15:07:35.217

看看你的代表水平，我想关于十六进制数字、字节顺序、各种数据类型的表示以及所有这些都有点多余。一个可以以十六进制显示数据的好工具当然是必不可少的，编写快速脚本以测试有关数据结构的复杂假设的能力也是必不可少的。所有这些对您来说都应该是显而易见的，但可能会对其他人有所帮助，所以我想我会提到它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-17T15:29:52.970

One of the best ways to attack unknown file formats, when you have some control over contents is to take a differential approach. Save a file, make a small and controlled change, and save again. Do a binary compare of the files to find the difference - preferably using a tool that can detect inserts and deletions. If you're dealing with an encrypted file, a small change will trigger a massive difference. If it's just compressed, the difference will not be localized. And if the file format is trivial, a simple change in state will result in a simple change to the file.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-17T15:34:06.393

另一件事是查看一些常见的压缩技术，尤其是 zip 和 gzip，并了解它们的“签名”。这些格式中的大多数都是“自我识别”的，因此当他们开始解压缩时，他们可以进行快速的健全性检查，以确保他们正在处理的格式是他们理解的格式。

除非加密，存档文件格式基本上是某种索引机制（目录或排序），以及通过索引中的指针从存档中定位这些元素的方法。

随着标准压缩算法的普及，主要是找到这些块从哪里开始，并尝试寻找索引或目录。

有些会将索引全部放在一个位置（就像文件系统一样），有些则会简单地在存档中的每个元素之前加上其身份信息。但最后在某个地方，有关于从一个块到另一个块的偏移量的信息，还有关于数据类型的信息（例如，如果它们存储 GIF 文件，GIF 也有签名）等等。

这些是您试图在文件中寻找的模式。

如果您能以某种方式获得使用相同格式的两个版本的数据，那就太好了。例如，在游戏中，您可能能够从 CD 中获取初始版本和更新的补丁版本。这些可以真正突出您正在寻找的信息。

# configuration - 条件配置框架

> ID：295714
> 
> 赞同：2
> 
> 时间：2008-11-17T14:43:24.377
> 
> 标签：configuration, frameworks

我正在寻找一个基于条件处理键/值对的配置框架。语言和存储类型无关紧要。

应用程序 XYZ 的背景颜色示例：

*   应用程序的背景颜色为“红色”。
*   星期一的背景颜色应该是绿色。
*   星期一用户 XYZ 的背景颜色应该是橙色。

开发人员只要求“application.background.color”之类的东西，这应该根据给定的条件返回正确的值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T14:47:26.880

在 Java 中，查看 Commons Configuration。您需要对其进行一些扩展，但您应该能够使用现有的框架变量扩展，前提是您可以提前定义可用的上下文元素。

# mysql - 将 MediaWiki 内容合并在一起

> ID：295716
> 
> 赞同：10
> 
> 时间：2008-11-17T14:44:44.000
> 
> 标签：mysql, wiki, mediawiki, merge, pywikibot

目前我有两个 MediaWiki，一个比另一个版本稍旧。我想将两者的内容合并在一起，而不消除重复的页面。到目前为止，我能想到的最佳选择是使用机器人（如 pywikipedia）浏览一个 wiki 的所有页面，并尝试将它们插入另一个 wiki，重命名重复的页面。

不过，这个解决方案似乎需要一段时间才能完成。有没有更愉快的方式来做到这一点，我只是不知道？我没有直接使用 MediaWiki 数据库，所以我不太愿意在不知道自己在做什么的情况下搞乱它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-17T15:05:03.193

MediaWiki 具有[导入](http://meta.wikimedia.org/wiki/Help:Import)和[导出](http://meta.wikimedia.org/wiki/Help:Export)功能，可用于移动内容。它确实合并了现有页面的历史记录（请参阅导入链接）。

但是，它不处理同名的两个不同页面的冲突，因此您必须自己处理移动页面。据我在 MediaWiki [page table](http://www.mediawiki.org/wiki/Page_table)的描述中所见，您可能能够直接在 SQL 中查找和重命名重复页面，但 pywikipedia 也应该可以工作（但您需要删除“正确”页面移动导致的重定向，否则他们会弄乱从其他 wiki 导入的页面）。

# asp.net - ASP.NET URL 验证

> ID：295719
> 
> 赞同：10
> 
> 时间：2008-11-17T14:45:43.060
> 
> 标签：asp.net, iis, url

我们在 ASP.NET 上有一个自定义的 REST 处理程序，它被配置为处理所有传入的请求：

```
<add path="*" verb="*" type="REST.RESTProtocolHandler"/> 
```

但是，将管道字符传递给它，无论是否正确编码，都会触发一个似乎来自 ASP.NET 内部的验证错误。

访问`[http://localhost:8080/%7c](http://localhost:8080/%7c)`或`[http://localhost:8080/|](http://localhost:8080/|)`产生此错误：

> [ArgumentException: Illegal characters in path.] System.IO.Path.CheckInvalidPathChars(String path) +7489125 System.IO.Path.Combine(String path1, String path2) +40 System.Web.Configuration.UserMapPath.GetPhysicalPathForPath(String path , VirtualDirectoryMapping 映射) +114 System.Web.Configuration.UserMapPath.GetPathConfigFilename(String siteID, VirtualPath path, String& directory, String& baseName) +72 System.Web.Configuration.UserMapPath.MapPath(String siteID, VirtualPath path) +30 System. Web.Configuration.UserMapPath.MapPath(String siteID, String path) +31 System.Web.Hosting.HostingEnvironment.MapPathActual(VirtualPath virtualPath, Boolean permitNull) +297 System.Web.Hosting.HostingEnvironment.MapPathInternal(VirtualPath virtualPath, Boolean permitNull) +51 System.Web.CachedPathData。GetConfigPathData(String configPath) +341 System.Web.CachedPathData.GetVirtualPathData(VirtualPath virtualPath, Boolean permitPathsOutsideApp) +110 System.Web.HttpContext.GetFilePathData() +36 System.Web.HttpContext.GetConfigurationPathData() +26 System.Web.Configuration .RuntimeConfig.GetConfig(HttpContext context) +43 System.Web.Configuration.CustomErrorsSection.GetSettings(HttpContext context, Boolean canThrow) +41 System.Web.HttpResponse.ReportRuntimeError(Exception e, Boolean canThrow, Boolean localExecute) +101 System.Web .HttpRuntime.FinishRequest(HttpWorkerRequest WR, HttpContext 上下文, 异常 e) +383Web.HttpContext.GetConfigurationPathData() +26 System.Web.Configuration.RuntimeConfig.GetConfig(HttpContext context) +43 System.Web.Configuration.CustomErrorsSection.GetSettings(HttpContext context, Boolean canThrow) +41 System.Web.HttpResponse.ReportRuntimeError(异常 e，布尔 canThrow，布尔 localExecute) +101 System.Web.HttpRuntime.FinishRequest(HttpWorkerRequest wr，HttpContext context，异常 e) +383Web.HttpContext.GetConfigurationPathData() +26 System.Web.Configuration.RuntimeConfig.GetConfig(HttpContext context) +43 System.Web.Configuration.CustomErrorsSection.GetSettings(HttpContext context, Boolean canThrow) +41 System.Web.HttpResponse.ReportRuntimeError(异常 e，布尔 canThrow，布尔 localExecute) +101 System.Web.HttpRuntime.FinishRequest(HttpWorkerRequest wr，HttpContext context，异常 e) +383例外 e) +383例外 e) +383

没有用户态代码被执行。这是某个地方的配置选项吗？在 IIS 7 和 VS Studio 的 2008 开发服务器上复制。

Stack Overflow 似乎可以处理这个错误，它看起来像一个动态生成的 404 MVC 页面被渲染为[https://stackoverflow.com/%7c](https://stackoverflow.com/%7c)。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-19T14:51:02.940

尝试拦截 Global.asax 文件中的异常。在那里实现（Global.asax.cs）这个方法：

```
protected void Application_Error(Object sender, EventArgs e)
{
    Exception ex = Server.GetLastError();
    //do whatever you want with that exception
    //or get the url from the context, reformat and redirect
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:57:29.520

*   首先，您需要修改注册表：

    [http://support.microsoft.com/default.aspx?scid=kb;EN-US;826437](http://support.microsoft.com/default.aspx?scid=kb;EN-US;826437)

*   重新启动 IIS

瞧，它起作用了。

但是我已经在 IIS7 上毫无问题地完成了这项工作，但是在 IIS6 上我得到了这个错误（路径中的非法字符）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T09:08:14.643

我有一个类似的程序可以拦截所有并用管道尝试它会给我同样的错误。我认为它与 IIS 在知道谁来处理请求之前进行路径测试（mappath）有关。您的处理程序获取根（意味着所有调用），但我认为 IIS 的方式是通用的。

因此，我假设您无法在文件系统上使用的任何或大部分路径字符在 IIS 请求 (GET/POST) 时都会失败。

也许有人知道如何禁用 IIS 检查。根据错误，它似乎发生在您的 web.config 被读取之前，因为它试图找到正确的配置？，

也许可以使用您自己的错误页面作为重定向回您的处理程序？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-06T01:18:09.193

我认为答案在您的堆栈跟踪中。在 System.IO.Path.CheckInvalidPathChars() 调用上引发错误 - 这不是检查 Url，而是检查 IIS 所在的 Windows 文件系统。这不是管道字符是 Url 非法的情况，而是基本上 DOS 非法的情况。

如果您在 IIS 尝试在服务器上查找匹配路径之前拦截 Url，我希望您可以处理此错误。这可能在于有一个重写规则或类似规则来查找和重写其中包含不需要的字符的 Url。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-17T15:03:06.427

默认情况下，IIS 不允许 URL 中的某些字符，并认为它们是非法的。这就是您的问题所在 - 它甚至不会调用您拥有的处理程序。据我所知，除了 Windows 注册表外，没有其他地方可以配置通过 UI 接受哪些字符。我不知道你为什么要使用管道，但我认为这不是一个好习惯。至于错误页面 -对于任何异常，[您始终可以拥有自己的错误页面](http://aspnetresources.com/articles/CustomErrorPages.aspx)，这样用户就不会看到丑陋的消息。

# c# - 在 C#.NET 中捕获所有未处理异常的简单方法

> ID：295731
> 
> 赞同：30
> 
> 时间：2008-11-17T14:49:39.947
> 
> 标签：c#, asp.net

我有一个用 C#.NET 构建的网站，它倾向于从各种用户控件产生相当稳定的 SQL 超时流，我想轻松弹出一些代码以捕获所有未处理的异常并将它们发送到可以记录它们并显示的东西给用户的友好信息。

我如何通过最小的努力捕获所有未处理的异常？

[这个问题](https://stackoverflow.com/questions/944/unhandled-exception-handler-in-net-11)似乎说这是不可能的，但这对我来说没有意义（而且它是关于 Windows 应用程序中的 .NET 1.1）：

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-17T14:54:17.677

所有未处理的异常最终都通过 global.asax 中的 Application_Error。因此，要给出一般异常消息或进行日志记录操作，请参阅[Application_Error](http://www.eggheadcafe.com/community/aspnet/2/10021988/applicationerror-catches.aspx)。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-17T15:04:35.143

如果您需要在所有线程中捕获异常，最好的方法是实现 UnhandledExceptionModule 并将其添加到您的应用程序中，请[在此处](http://support.microsoft.com/kb/911816) 查看示例

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-11-17T15:42:10.077

在 Global.asax 文件中使用 Application_Error 方法。在 Application_Error 方法实现调用 Server.GetLastError() 中，根据需要记录 Server.GetLastError() 返回的异常的详细信息。

例如

```
void Application_Error(object sender, EventArgs e) 
{ 
    // Code that runs when an unhandled error occurs
    log4net.ILog log = log4net.LogManager.GetLogger(typeof(object));
    using (log4net.NDC.Push(this.User.Identity.Name))
    {
        log.Fatal("Unhandled Exception", Server.GetLastError());
    }
} 
```

不要太在意 log4net 的东西，Server.GetLastError() 是最有用的部分，记录你喜欢的细节。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-17T16:17:20.863

[ELMAH 项目](http://code.google.com/p/elmah/)听起来值得一试，它的功能列表包括：

> ELMAH（错误记录模块和处理程序）是一个完全可插拔的应用程序范围的错误记录工具。它可以动态添加到正在运行的 ASP.NET Web 应用程序，甚至是一台机器上的所有 ASP.NET Web 应用程序，无需重新编译或重新部署。
> 
> *   记录几乎所有未处理的异常。
> *   用于远程查看重新编码异常的整个日志的网页。
> *   用于远程查看任何记录的异常的完整详细信息的网页。
> *   在许多情况下，即使关闭了 customErrors 模式，您也可以查看 ASP.NET 为给定异常生成的原始黄屏死机。
> *   每个错误发生时的电子邮件通知。
> *   来自日志的最后 15 个错误的 RSS 提要。
> *   日志的许多后备存储实现

更多关于使用 dotnetslackers 的[ELMAH](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-17T15:10:58.110

您可以订阅该`AppDomain.CurrentDomain.UnhandledException`事件。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-17T16:26:43.810

请注意，您**不应该**捕获未处理的异常，这可能很重要。如果您遇到 SQL 超时问题，您应该专门解决​​这些问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-17T14:52:25.683

您的意思是在所有线程中处理它，包括由第三方代码创建的线程？在“已知”线程中，只需`Exception`在堆栈顶部捕获。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-17T14:56:16.783

我建议查看[log4net](http://logging.apache.org/log4net/index.html)并查看它是否适合问题的日志记录部分。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-29T01:05:26.627

如果您没有强制关闭 sqlconnections，通常会发生超时错误。

所以如果你有一个

```
try {
    conn.Open();
    cmd.ExecuteReader();
    conn.Close();
} catch (SqlException ex) {
    //do whatever
} 
```

如果该 ExecuteReader 出现任何问题，您的连接将不会关闭。总是添加一个 finally 块。

```
try {
    conn.Open();
    cmd.ExecuteReader();
    conn.Close();
} catch (SqlException ex) {
    //do whatever
} finally {
    if(conn.State != ConnectionState.Closed)
       conn.Close();
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-07-29T02:14:06.863

一个简短的答案是在调用委托时使用（匿名）委托方法和公共处理代码。

*背景*：如果您已经针对弱点，或者有一些样板错误处理代码，您需要普遍适用于特定类别的问题，并且您不想为每个调用位置编写相同的 try..catch，（例如如更新每个页面上的特定控件等）。

*案例研究*：一个痛点是 Web 表单和将数据保存到数据库。我们有一个向用户显示保存状态的控件，我们希望在每个页面中都有通用的错误处理代码和通用显示，而不需要复制粘贴重用。此外，每个页面都以自己的方式做自己的事情，所以代码中唯一真正常见的部分是错误处理和显示。

现在，在被抨击之前，这不能替代数据访问层和数据访问代码。这一切仍然假设存在，良好的 n 层分离等。这段代码是 UI 层特定的，允许我们编写干净的 UI 代码而不是重复自己。我们坚信不取消异常，但某些异常不应该让用户获得通用错误页面并丢失他们的工作。会有sql超时、服务器宕机、死锁等。

*解决方案*：我们这样做的方式是将匿名委托传递给自定义控件上的方法，并实质上使用匿名委托注入 try 块。

```
// normal form code.
private void Save()
{
    // you can do stuff before and after. normal scoping rules apply
    saveControl.InvokeSave(
        delegate
        {
            // everywhere the save control is used, this code is different
            // but the class of errors and the stage we are catching them at
            // is the same
            DataContext.SomeStoredProcedure();
            DataContext.SomeOtherStoredProcedure();
            DataContext.SubmitChanges();
        });
} 
```

SaveControl 本身具有如下方法：

```
public delegate void SaveControlDelegate();

public void InvokeSave(SaveControlDelegate saveControlDelegate)
{        
    // I've changed the code from our code. 
    // You'll have to make up your own logic.
    // this just gives an idea of common handling.
    retryButton.Visible = false;
    try
    {
        saveControlDelegate.Invoke();
    }
    catch (SqlTimeoutException ex)
    {
        // perform other logic here.
        statusLabel.Text = "The server took too long to respond.";
        retryButton.Visible = true;
        LogSqlTimeoutOnSave(ex);
    }
    // catch other exceptions as necessary. i.e.
    // detect deadlocks
    catch (Exception ex)
    {
        statusLabel.Text = "An unknown Error occurred";
        LogGenericExceptionOnSave(ex);
    }
    SetSavedStatus();
} 
```

* * *

*   还有其他方法可以实现这一点（例如通用基类、接口），但在我们的例子中，这是最合适的。
*   这不能替代[Elmah](http://code.google.com/p/elmah/)等用于记录所有未处理异常的出色工具。这是一种以标准方式处理某些异常的有针对性的方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-17T15:17:35.600

如果使用 .net 2.0 框架，我使用内置的健康监控服务。这里有一篇很好的文章描述了这种方法：http: **[//aspnet.4guysfromrolla.com/articles/031407-1.aspx](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)**

如果您坚持使用 1.0 框架，我会使用 ELMAH：http: **[//msdn.microsoft.com/en-us/library/aa479332.aspx](http://msdn.microsoft.com/en-us/library/aa479332.aspx)**

希望这可以帮助

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-17T15:26:43.977

这个问题处理和识别有两个部分。

识别

这就是当异常最终被捕获时你所做的，不一定是它被抛出的地方。所以那个阶段的异常必须有足够的上下文信息让你确定问题所在

处理

对于处理，您可以 a) 添加一个 HttpModeule。请参阅 [http://www.eggheadcafe.com/articles/20060305.asp](http://www.eggheadcafe.com/articles/20060305.asp) 我建议仅在绝对没有可用的上下文信息并且可能存在与 IIS/aspnet 相关的问题时才建议这种方法，简而言之，就是灾难性情况

b）创建一个名为 AbstractBasePage 的抽象类，它派生自 Page 类，并让所有代码隐藏类派生自 AbstractBasePage

AbstractBasePage 可以实现 Page.Error 委托，以便可以在此处捕获（并可能记录）通过 n 层架构向上渗透的所有异常

对于您正在谈论的那种异常（SQlException），我会建议这种原因，有足够的上下文信息可以让您确定它是超时并采取可能的措施。此操作可能包括将用户重定向到自定义错误页面，并针对每种不同类型的异常（Sql、Web 服务、异步调用超时等）提供适当的消息。

谢谢 RVZ

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-03-18T10:31:07.787

这是一个老问题，但最好的方法（对我来说）没有在这里列出。所以我们在这里：

ExceptionFilterAttribute 对我来说是一个不错且简单的解决方案。来源：[http](http://weblogs.asp.net/fredriknormen/asp-net-web-api-exception-handling) ://weblogs.asp.net/fredriknormen/asp-net-web-api-exception-handling 。

```
public class ExceptionHandlingAttribute : ExceptionFilterAttribute
{
    public override void OnException(HttpActionExecutedContext context)
    {
        var exception = context.Exception;
        if(exception is SqlTimeoutException)
        {
            //do some handling for this type of exception
        }
    }
} 
```

并将其附加到 fe HomeController：

```
[ExceptionHandling]
public class HomeController: Controller
{

} 
```

# java - 在 Java 中生成一个在 JVM 关闭后仍然存在的进程

> ID：295736
> 
> 赞同：14
> 
> 时间：2008-11-17T14:51:31.630
> 
> 标签：java, process

我需要在 Java 中生成一个进程（仅在 Linux 下），该进程将在 JVM 退出后继续运行。我怎样才能做到这一点？

基本上，Java 应用程序应该生成一个更新程序，它会停止 Java 应用程序，更新文件，然后再次启动它。

我对一种 hack & slash 方法感兴趣，如果你有一个更好的设计方案，让它工作以及更好的设计方案:)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-17T14:54:00.203

如果您使用[`java.lang.Process`](http://java.sun.com/javase/6/docs/api/java/lang/Process.html)它生成进程应该“正常工作” - 我不相信当 JVM 退出时生成的进程会死掉。您可能会发现 Ant 库使您更容易控制生成。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-17T15:36:19.870

它实际上“只是工作”，除非你想变得聪明。

我包装的 java.lang.Process 试图捕获脚本的输出，所以当 JVM 死掉时，脚本没有任何地方可以发送输出，所以它就死了。如果我不尝试捕获输出，或者脚本没有生成任何内容或将所有内容重定向到文件或 /dev/null，则一切正常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-09-14T08:41:53.437

我遇到了这个问题，当 JVM 关闭时，启动的进程被杀死了。

将 stdout 和 stderr 重定向到一个文件解决了这个问题。我猜这个过程与启动的 java 应用程序相关联，因为默认情况下它希望将其输出传递给它。

这是对我有用的代码（减去异常处理）：

```
ProcessBuilder pb = new ProcessBuilder(cmd);
pb.redirectOutput(logFile);
pb.redirectError(logFile);
Process p = pb.start(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T16:05:56.143

我认为 Java 的全部意义在于它完全包含在 JVM 中。没有运行时运行字节码有点困难。

如果您希望拥有一个完全独立的进程，您可能会考虑尝试启动第二个 java.exe 实例。尽管对于您的应用程序来说，简单地创建一个同步块来停止（但不会杀死）您的应用程序，进行更新，然后重新初始化您的应用程序的数据可能会更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-27T12:04:27.213

它不会总是“正常工作”。当 JVM 生成子进程然后关闭时，子进程在某些情况下也会关闭。这是进程的预期行为。在 WIN32 系统下，它可以正常工作。

例如，如果 WebLogic 服务器由 Java 进程启动，然后该进程退出，它还会通过 JVM 中的关闭挂钩向 WebLogic 发送关闭信号，这会导致 WebLogic 也关闭。

如果它对您“正常工作”，那么就没有问题，但是如果您发现自己处于子进程也随着 JVM 关闭的位置，那么值得看看“nohup”命令。该进程不会响应 SIGTERM 信号，但会响应 SIGKILL 信号，以及正常操作。

更新：上述方式有点矫枉过正。另一种方法是在命令末尾使用“&”。这将产生一个新进程，它不是当前 java 进程的子进程。

PS对不起这么多更新，我一直在从头开始学习和尝试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-30T11:30:11.527

> >>不要相信生成的进程会在 JVM 退出时死掉。

每当我杀死 java 时，子进程总是在我的盒子（SuSE）上死去。我认为，如果子进程正在处理父进程（即java）的I/O，它就会死掉

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2008-11-17T16:46:57.887

如果您正在考虑在 Linux 上制作更新程序，那么您可能找错了树。我相信所有主要的 linux 发行版都内置了包管理器。您应该使用包管理器进行更新。没有什么比尝试自我更新的程序更让我沮丧的了……（我在看着你，Eclipse）

# php - XML-RPC 服务器的帮助

> ID：295740
> 
> 赞同：0
> 
> 时间：2008-11-17T14:52:57.570
> 
> 标签：php, codeigniter, xml-rpc

我现在正在尝试使用 CodeIgniter 框架创建一个 xml-rpc 服务器。

```
<?php
$this->load->library('xmlrpc');
$this->load->library('xmlrpcs');

$config['functions']['weblogUpdates.ping'] = array('function' => 'weblogUpdates.ping');
$config['functions']['ping'] = array('function' => 'weblogUpdates.ping');
$config['functions']['weblogUpdates'] = array('function' => 'weblogUpdates.ping');
$config['object'] = $this;

$this->xmlrpcs->serve();
?> 
```

但我遇到的问题是当 Wordpress 试图 ping 我的文件时。我不知道我应该在 $config['functions'][HERE];

有人对此有解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T16:10:00.863

你看过[codeigniter用户指南](http://codeigniter.com/user_guide/libraries/xmlrpc.html)吗？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-24T01:28:45.397

谢谢，找到问题了，我太笨了。有一个 beta-server 正在运行，我将 Wordpress 设置为 ping，当我得到新服务器时忘记更改地址：$

# c# - .Net 中 Nativemethods.GetSystemMetrics 函数的输入值

> ID：295749
> 
> 赞同：0
> 
> 时间：2008-11-17T14:54:08.753
> 
> 标签：c#, .net, vb.net, native-methods, getsystemmetrics

这个函数似乎是一种访问各种系统值的方法。例如 nativemethods.GetSystemMetrics(4096) 返回会话是远程的还是本地的。我在网上能找到的只是具体的例子——有谁知道我在哪里可以找到输入参数值的完整列表/它们返回的内容？似乎它可能非常有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T14:56:12.960

来自PInvoke.NET的[这个页面](http://www.pinvoke.net/default.aspx/Enums/SystemMetric.html)是你想要的吗？

# language-agnostic - 任务或对话框的 Presentation-/ViewModel 是什么样的？

> ID：295751
> 
> 赞同：2
> 
> 时间：2008-11-17T14:54:34.993
> 
> 标签：language-agnostic, design-patterns, mvvm

我正在尝试迁移到模型/视图模型/视图架构，并在尝试将选择对话框推送到此模式时卡住了。我想将检索选择列表（业务/演示逻辑）和实际显示/选择机制（视图）分开，以便在不同的视图中重用前者（例如 ComboBox 与模态对话框）。

这种选择任务的 ViewModel 会是什么样子？还是我在努力，我应该只在视图中实现这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T19:01:49.983

你的意思是你想使用实现来检索列表？如果是这样，我认为您可以在应用程序层创建一个服务类并重用该功能..

# .net - 带有 .NET 安装程序的 Windows Vista 上的文件安全性

> ID：295752
> 
> 赞同：1
> 
> 时间：2008-11-17T14:55:06.257
> 
> 标签：.net, windows-vista, installation, file-permissions

我正在尝试编写一个可以在 Windows Vista 和 XP 上运行的安装程序（通过创建一个 .vdproj）。我发现的唯一一件事是，当我尝试在 Vista 上运行它时，我在安装程序中包含的文件以用户组的只读权限安装。这是一个问题，因为应用程序需要从这些文件中读取/写入。我能够让它工作的唯一方法是“以管理员身份运行”或实际更改权限。有谁知道如何让这些文件对任何人开放写？谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-17T15:06:36.717

Program Files 文件夹及其内容对于标准用户是只读的。这是设计使然，您会发现**在 Windows XP 上也是如此。** 只是在 windows xp 上，很多人一直以管理员权限运行，您可能会侥幸逃脱。如果您想将您的应用程序分发到商业环境中，您很快就会发现它也无法在 XP 上运行。

如果标准用户需要写入权限，解决方案是不要将文件放在程序的可执行文件夹中。而是将它们放在 Application Data 文件夹中。对于大多数 xp 机器，将在此处：
C:\Documents And Settings\All Users\Application Data\Your App

但是，情况并非总是如此，无论如何它在 Vista 上略有不同，因此请确保您通过编程环境提供的机制获得该路径。在 .Net 中，您可以使用该`Environment.GetFolderPath()`功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T17:03:19.663

为乔尔的回答添加一些细节：

*   在 Win2K 和 XP 中，CSIDL_APPDATA 应该用于**每个用户，漫游**。在 Vista 中，这是 FOLDERID_RoamingAppData。

*   在 Win2K 和 XP 中，CSIDL_LOCAL_APPDATA 应该用于**每个用户，非漫游**。在 Vista 中，这是 FOLDERID_LocalAppData。

*   在 Win2K 和 XP 中，CSIDL_COMMON_APPDATA 应该用于**per-machine**，即应用程序的所有用户。在 Vista 中，这是 FOLDERID_ProgramData。

注意最后一个文件夹通常对非管理员非高级用户是只读的。推荐的解决方案是在应用安装期间创建一个读/写子文件夹。

编辑：要使用托管代码在特定机器上获取这些常量的实际位置，请尝试使用[此处](http://msdn.microsoft.com/en-us/library/bb762584(VS.85).aspx)定义的常量**System.Environment.GetFolderPath**。另一个有用的链接在[这里](http://blogs.msdn.com/cjacks/archive/2008/02/05/where-should-i-write-program-data-instead-of-program-files.aspx)。

# excel - SSRS 和 Excel 颜色兼容性

> ID：295757
> 
> 赞同：4
> 
> 时间：2008-11-17T14:56:38.390
> 
> 标签：excel, reporting-services, colors

我创建了 SSRS 报告并以 Excel 格式呈现。我在 SSRS 中使用了自定义颜色（在 excel 规范 R23、G123、B87 中提到）。但它在 SSRS 中以相同的组合显示不同的颜色。一旦我将报告渲染到 Excel，它会显示不同的颜色，尽管我使用了相同的颜色组合。

为什么 Excel 和 SSRS 的色差？我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T19:42:25.957

标准 Microsoft Excel 2003 调色板有 40 种颜色加上 16 种颜色用于图表填充和线条。大多数当前构建的商业智能报告系统（Cognos Series 8、Business Objects XI R3、Reporting Services 2000/2005 等）会自动将颜色转换为“最匹配”的 Excel 2003 调色板选择，作为呈现到 Excel 的一部分方法。这对于 Office 2007 用户来说可能非常令人沮丧，因为默认情况下 Excel 具有几乎无限的调色板选择。

Reporting Services 2008 没有此调色板限制。如果您在 Reporting Services 2008 中向 Excel 呈现报表，则颜色将与您呈现的 HTML 报表中显示的颜色相匹配。

# .net - 如何在我的安装程序中包含 SQL Compact 和 .NET Framework

> ID：295759
> 
> 赞同：2
> 
> 时间：2008-11-17T14:57:57.387
> 
> 标签：.net, installation, sql-server-ce

我需要让我的安装程序包含 .NET Framework 3.5 SP1 以及 SQL Compact 3.5。我记得在 Visual Studio IDE 中的某个地方看到了这些可以包含在安装中的地方，但我找不到它们。有谁知道如何做到这一点？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T15:05:43.223

找到了！看起来您可以转到安装程序项目的“属性”窗口并单击“先决条件”按钮以查看要包含在安装程序中的先决条件安装程序列表，例如 SQL Server、SQL Compact、.NET Framework 版本等。

似乎该列表是由您在开发计算机上安装的东西驱动的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T15:10:44.227

您可能还想注册再分发权：

[http://www.microsoft.com/sqlserver/2005/en/us/compact-redistribute.aspx](http://www.microsoft.com/sqlserver/2005/en/us/compact-redistribute.aspx)

# java - Java SAX 解析器引发 UnknownHostException

> ID：295766
> 
> 赞同：7
> 
> 时间：2008-11-17T15:00:09.910
> 
> 标签：java, dtd, sax

我要解析的 XML 文件以：

```
<!DOCTYPE plist PUBLIC "-//...//DTD PLIST 1.0//EN" "http://www.....dtd"> 
```

所以当我启动 SAX praser 时，它会尝试在线访问这个 DTD，然后我得到一个 java.net.UnknownHostException。

1.  在将 XML 文件提供给 SAX 解析器之前，我无法修改它
2.  即使没有互联网连接，我也必须跑步

如何更改 SAX 解析器行为，使其不尝试加载 DTD？谢谢。

```
javax.xml.parsers.SAXParserFactory factory = javax.xml.parsers.SAXParserFactory.newInstance();
factory.setValidating(false);

javax.xml.parsers.SAXParser parser = factory.newSAXParser();
parser.parse(xmlFile, handler); 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-17T16:10:03.920

好的，结果证明该`parse()`方法使用传递给 parse 方法的处理程序覆盖了任何先前设置的实体解析器。以下代码应该可以工作：

```
javax.xml.parsers.SAXParserFactory factory = javax.xml.parsers.SAXParserFactory.newInstance();
factory.setValidating(false);
javax.xml.parsers.SAXParser parser = factory.newSAXParser();
parser.parse(new java.io.File("x.xml"), new org.xml.sax.helpers.DefaultHandler(){
        public org.xml.sax.InputSource resolveEntity(String publicId, String systemId)
                throws org.xml.sax.SAXException, java.io.IOException {
            System.out.println("Ignoring: " + publicId + ", " + systemId);
            return new org.xml.sax.InputSource(new java.io.StringReader(""));
        }
    }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-10T13:04:54.833

使用 XMLReader 而不是 SAXParser。

```
 XMLReader reader =XMLReaderFactory.createXMLReader();
 reader.setEntityResolver(new DummyEntityResolver());
    reader.setContentHandler(handler);
 reader.parse(inputSource); 
```

它也应该与 SAXParser 一起使用，但由于某些原因它不能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:20:55.907

您可以实现自定义`EntityResolver`，用于在 XML 解析期间查找外部实体。

```
org.xml.sax.EntityResolver customEntityResolver = new DummyEntityResolver();
javax.xml.parsers.SAXParser parser = factory.newSAXParser();
parser.getXMLReader().setEntityResolver(customEntityResolver);
parser.parse(xmlFile, handler); 
```

在您的自定义 EntityResolver 中，始终返回 null。我认为这应该可以解决这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T15:32:59.923

您应该提供一个 EntityResolve 来解决问题。我建议您编写一个解析器，它知道如何在本地读取 DTD（前提是您将它​​们与您的应用程序一起提供）。否则，像 Gowri 建议的那样返回 null 。

您可能需要阅读[API 文档](http://java.sun.com/j2se/1.4.2/docs/api/javax/xml/parsers/DocumentBuilder.html#setEntityResolver(org.xml.sax.EntityResolver))。

yc

# c# - 为什么我不能使用“AccessDeniedException”命名空间？

> ID：295768
> 
> 赞同：1
> 
> 时间：2008-11-17T15:00:27.697
> 
> 标签：c#, exception-handling

当我使用下面的代码时，我收到了找不到命名空间的消息。AccessDeniedException 在哪里？

```
try { ... } 
catch (SomeKindOfException ex) 
{ 
MessageBox.Show(ex.Message); 
} 
catch (AccessDeniedException ex) 
{ 
//Do something else 
} 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T15:08:09.847

我认为这不是您要寻找的例外。唯一具有此名称（我能找到）的名称位于 Sharepoint 命名空间中。尝试附加调试器并查看抛出异常的确切类型。

异常的类型将根据您的上下文而有所不同。因此，例如，如果在尝试打开文件时出现“访问被拒绝”，则可能是 FileLoadException 或类似情况。如果是因为代码访问安全性而遇到的，它将是 SecurityException。等等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T15:13:49.557

您可能需要为异常提供完整的命名空间，或者在代码文件的顶部使用 using 语句，以便 .NET 知道在哪里可以找到您正在谈论的异常。如果这不起作用，您可能需要将包含该异常的 DLL 添加到项目中的“REFERENCES”列表中。

# c# - .net 远程处理每 100 秒停止一次

> ID：295770
> 
> 赞同：1
> 
> 时间：2008-11-17T15:00:58.693
> 
> 标签：c#, .net, remoting

我们有一个非常奇怪的问题，我们的一个应用程序正在使用.net remoting 不断地查询服务器，并且每隔 100 秒应用程序会停止查询一小段时间，然后恢复操作。问题出在客户端而不是服务器上，因为应用程序实际上同时查询多个服务器，并同时停止从所有服务器接收数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:08:22.203

100 秒是一个免费数字，因为它是 .Net 中 webrequest 的默认超时。

我过去曾看到 PSI（Microsoft Project 中的项目服务器接口）没有覆盖超时，因此应用了 100 秒的默认值，并且会终止任何与它对话的时间超过该时间。

您是否有权访问所有代码，并且您确定您已在适用的情况下设置了超时，以便不会在您不知情的情况下应用任何默认值？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T15:09:50.937

我以前从未见过这种行为，不幸的是，这是一个模糊的场景，我认为你很难在这个板上找到遇到问题的人。它可能特定于您的应用程序。

我认为你可以做一些调查来帮助你缩小问题的范围。

1.  确定实际停止的是客户端还是服务器。如果您在确定这一点时遇到问题，请尝试安装数据包过滤器并监控流量以查看谁发送了最后一个数据。您可能无法读取二进制数据，但至少您会知道谁落后了。
2.  一旦确定是客户端还是服务器导致了延迟，请尝试调试应用程序并获取发生挂起的断点。这应该为您提供足够的详细信息来帮助追踪问题。或者至少问一个关于 SO 的更明确的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:11:05.210

应用程序如何编码以实现连续查询？它是在一个连续的循环中吗？还是带有 Thread.Sleep 的循环？还是在计时器上？

首先确定您的系统是否在您期望的时候在您的代码中执行这个“触发器”，或者如果它是，并且远程服务器没有响应......所以，......

如果您无法在可以调试的开发环境中重现此问题，那么，如果可以，我建议您在此循环中添加代码，以便在每次“应该”时写入日志文件（或其他一些持久性机制）正在检查它用来决定是否查询远程服务器的任何条件，然后在问题再次发生时查看这些日志......

如果您可以在远程服务器中执行相同的操作，以记录服务器何时收到远程请求，这也将有所帮助......

...哦，是的，只是一个想法，（我不知道您是如何编码的...）但是如果您在客户端中使用单独的线程来发出远程处理请求，并且正在注册频道，并且在那个单独的线程上取消注册，确保您正在消除请求的冲突，因为您不能同时在同一台机器上注册同一个端口两次......（尽管这可能会在您的客户端中引发异常，如果这是问题）

# java - 使用 SQL Server 方言配置 Hibernate 以转义 LIKE 子句中的下划线

> ID：295771
> 
> 赞同：5
> 
> 时间：2008-11-17T15:01:38.550
> 
> 标签：java, sql, sql-server, hibernate

我有一个 SQL SELECT 查询，它有一个包含下划线的 LIKE 子句，它应该专门查找下划线，而不是将其视为通配符：

```
SELECT * FROM my_table WHERE name LIKE '_H9%'; 
```

我知道我可以将实际子句更改为 '[_]H9%' 以使其按预期工作，但问题是该子句是由 Hibernate 生成的。

有没有办法配置 Hibernate 以这种方式转义所有查询中的所有下划线？如果做不到这一点，有没有办法配置 SQL Server（在我的例子中是 2008 年）*不*将下划线视为通配符？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-08T02:33:31.893

如果您使用 Criteria 创建查询，则可以创建自己的表达式，该表达式是 org.hibernate.criterion.LikeExpression 的子类，使用接受“Character escapeChar”的受保护构造函数之一，并为您替换值。假如说 '！' 是一个不会出现在任何搜索字符串中的已知值（我猜你可以选择任何你喜欢的），你可以这样做：

```
public class EscapingLikeExpression extends LikeExpression {
  public EscapingLikeExpression(String propertyName, String value) {
      super(propertyName, escapeString(value), '!', false);
  }

  static String escapeString(String inputString) {
    inputString = inputString.replace("_", "!_");
    return inputString;
  }

} 
```

如果没有这样的字符（不会作为文字出现在您的搜索值中），则添加以下内容作为 escapeString() 的第一行以转义这些字符：

```
 inputString = inputString.replace("!", "!!"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-08T00:53:18.147

为什么不能对值进行字符串替换？这是如何使用的，所以这是一个不可行的解决方案？

# c# - 使用 LINQ 和 C# 查询 Microsoft Access MDB 数据库

> ID：295772
> 
> 赞同：37
> 
> 时间：2008-11-17T15:02:09.937
> 
> 标签：c#, linq, ms-access

我有一个 *.MDB 数据库文件，我想知道是否可以或建议使用 C# 中的 LINQ 对其进行处理。我也想知道一些简单的例子会是什么样子。

我对 LINQ 了解不多，但我对这项任务的要求非常简单（我相信）。用户将向我传递 Microsoft Access MDB 数据库的文件路径，我想使用 LINQ 将行添加到数据库中的一个表中。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-17T15:10:39.407

您需要的是 LINQ to ODBC 提供程序，或 LINQ to JET/OLEDB 提供程序。

开箱即用，MS 没有制造一个。可能有第 3 方。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-10-21T19:57:27.947

实际上，我最近（今天）发现您可以使用 LinqToSql 访问 Access 数据库。它必须是 2002 或更新的格式，您将无法将表拖放到数据上下文中，因此可以在 dbml 中手动创建对象，或者您可以使用 SQL Server Migration for Access 将其移动到 sql server 和然后拖放所有你想要的。当您想要实际创建上下文时，将其传递给 OleDbConnection。在 OleDbConnection 上使用标准 Jet.OLEDB.4.0 连接字符串，一切顺利。不确定这可能会产生的限制。我只是做了一个快速的样本，并没有问题地做了一个 OrderBy。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-03-08T17:21:47.147

我写了一个小示例程序来测试大卫的答案。您需要创建一个访问数据库并为 Linq-to-SQL 手动创建 DBML，因为您无法拖放它们。

插入失败，引用`Missing semicolon (;) at end of SQL statement.`但查询似乎工作正常。

![访问程序的数据库表](https://i.stack.imgur.com/JmzWn.png)

```
using System;
using System.Collections.Generic;
using System.Data.OleDb;
using System.IO;
using System.Linq;
using Linq2Access.Data;

namespace Linq2Access
{
    class Program
    {
        static readonly string AppPath = Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location);
        static readonly string DbPath = Path.Combine(AppPath, "Data", "database.accdb");
        static readonly string DbConnString = @"Provider=Microsoft.ACE.OLEDB.12.0;Data Source='" + DbPath + "';Persist Security Info=False;";

        static void Main(string[] args)
        {
            if (!File.Exists(DbPath))
                throw new Exception("Database file does not exist!");

            using (OleDbConnection connection = new OleDbConnection(DbConnString))
            using (DataRepositoryDataContext db = new DataRepositoryDataContext(connection))
            {
                List<dbProject> projects = new List<dbProject>();
                for (int i = 1; i <= 10; i++)
                {
                    dbProject p = new dbProject() { Title = "Project #" + i };
                    for (int j = 1; j <= 10; j++)
                    {
                        dbTask t = new dbTask() { Title = "Task #" + (i * j) };
                        p.dbTasks.Add(t);
                    }
                    projects.Add(p);
                }

                try
                {
                    //This will fail to submit
                    db.dbProjects.InsertAllOnSubmit(projects);
                    db.SubmitChanges();
                    Console.WriteLine("Write succeeded! {0} projects, {1} tasks inserted",
                                        projects.Count,
                                        projects.Sum(x => x.dbTasks.Count));
                }
                catch(Exception ex)
                {
                    Console.WriteLine("Write FAILED. Details:");
                    Console.WriteLine(ex);
                    Console.WriteLine();
                }

                try
                {
                    //However, if you create the items manually in Access they seem to query fine
                    var projectsFromDb = db.dbProjects.Where(x => x.Title.Contains("#1"))
                                                        .OrderBy(x => x.ProjectID)
                                                        .ToList();

                    Console.WriteLine("Query succeeded! {0} Projects, {1} Tasks",
                                        projectsFromDb.Count,
                                        projectsFromDb.Sum(x => x.dbTasks.Count));
                }
                catch (Exception ex)
                {
                    Console.WriteLine("Query FAILED. Details:");
                    Console.WriteLine(ex);
                    Console.WriteLine();
                }

                Console.WriteLine();
                Console.WriteLine("Press any key to continue...");
                Console.ReadKey();
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-25T07:05:22.647

您可以使用数据集。有一些 linq 扩展，可以让您使用我们已经习惯使用的所有 LINQ 优点查询数据:)

```
eICATDataSet.ICSWSbuDataTable tbl = new eICATDataSet.ICSWSbuDataTable();

ICSWSbuTableAdapter ta = new ICSWSbuTableAdapter();
ta.Fill(tbl);

var res = tbl.Select(x => x.ProcedureDate.Year == 2010); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-10-26T03:07:55.530

我在几个论坛上看到了很多这个问题。我试了一下，对于那些一直在看它的人来说，这是一个完整的答案。

LinQ 不是为 Access 设计的。但是，许多查询都可以使用 Access，包括删除过程。因此，据我所知，使用 Access 时只有两个关键缺陷，它们是：

1.  无法保存数据。
2.  无法将对象拖放到 dbml

插入将失败，并出现错误“缺少分号 (;)”。这是因为 LinQ 保存过程是为了保存数据并一次性检索保存的记录的主键 ID。我们知道您不能在 Access 中执行多个 SQL 语句，所以这就是失败的原因。

更新将失败并出现错误“找不到记录”。更新过程将寻找要更新的记录然后更新它。我不知道为什么它找不到它，当正常的 LinQ 查询查找记录工作正常时。

因为使用 LinQ 有很多好处，所以我想出了如何解决这个缺陷，同时在整个应用程序中享受其他好处。这就是方法（注意：我的代码在 VB.net 中，但您可以根据需要进行转换）：

创建 LinQ to SQL (.dbml) 类来根据访问数据库管理 LinQ，以及管理保存过程的方法。以下是我创建的完整程序，我现在使用 LinQ 访问没有任何问题：

在表单上添加一个`DataGridView`。添加用于添加、编辑和删除的按钮

[![在此处输入图像描述](https://i.stack.imgur.com/TaYgc.png)](https://i.stack.imgur.com/TaYgc.png)

填充网格的代码：

> ```
> Private Sub ResetForm()
> 
>     Try
> 
>         Using db As New AccessDataClassesDataContext(ACCCon)
> 
>             Dim rows = (From row In db.AccountTypes
>                         Where row.AccountTypeID > 1
>                         Order By row.AccountTypeID Ascending
>                         Select row).ToList()
>             Me.DataGridView1.DataSource = rows
> 
>         End Using
> 
>     Catch ex As Exception
>         MessageBox.Show("Error: " & vbCr & ex.ToString, "Data Error", MessageBoxButtons.OK)
>     End Try
> 
> End Sub 
> ```

明细表

[![在此处输入图像描述](https://i.stack.imgur.com/Q7YZd.png)](https://i.stack.imgur.com/Q7YZd.png)

设置控制值的代码

> 私有子 ResetForm()
> 
> ```
>  Try
> 
>         If _accountTypeID = 0 Then
>             Exit Sub
>         End If
> 
>         Using db As New AccessDataClassesDataContext(ACCCon)
> 
>             'Dim rows = (From row In db.AccountTypes
>             '            Where row.AccountTypeID = _accountTypeID
>             '            Order By row.AccountTypeID Ascending
>             '            Select row.AccountTypeID, row.AccountType, row.LastUpdated).ToList()
>             Dim rows = (From row In db.AccountTypes
>                         Where row.AccountTypeID = _accountTypeID
>                         Select row).ToList()
> 
>             For Each s In rows
> 
>                 Me.AccountTypeIDTextBox.Text = s.AccountTypeID
>                 Me.myGuidTextBox.Text = s.myGuid
>                 Me.AccountTypeTextBox.Text = s.AccountType
>                 Me.AcHeadIDTextBox.Text = s.AcHeadID
>                 Me.DescriptionTextBox.Text = s.Description
>                 Me.LastUpdatedDateTimePicker.Value = s.LastUpdated
> 
>             Next
> 
>         End Using
> 
>     Catch ex As Exception
> 
>     End Try
> 
> End Sub 
> ```

LinQToSQLClass

您必须手动将数据对象添加到 dbml，因为使用 Access 时无法拖放。另请注意，您必须在属性窗口中正确设置字段的所有属性。添加字段时未设置多个属性。

[![在此处输入图像描述](https://i.stack.imgur.com/ZZjDR.png)](https://i.stack.imgur.com/ZZjDR.png)

要保存的代码

> 公共函数 SaveAccountType(Optional ByVal type As String = "Close") As Boolean
> 
> ```
>  Dim success As Boolean = False
>     Dim row As New AccountType
> 
>     Using db As New AccessDataClassesDataContext(ACCCon)
> 
>         If _accountTypeID > 0 Then
> 
>             row = (From r In db.AccountTypes
>                    Where r.AccountTypeID = _accountTypeID).ToList()(0)
> 
>             If String.IsNullOrEmpty(row.AccountTypeID) Then
>                 MessageBox.Show("Requested record not found", "Update Customer Error")
>                 Return success
>             End If
> 
>         End If
> 
>         Try
> 
>             With row
>                 .myGuid = Me.myGuidTextBox.Text
>                 .AccountType = Me.AccountTypeTextBox.Text
>                 .Description = Me.DescriptionTextBox.Text
>                 .AcHeadID = Me.AcHeadIDTextBox.Text
>                 .LastUpdated = Date.Parse(Date.Now())
>             End With
> 
>             If _accountTypeID = 0 Then db.AccountTypes.InsertOnSubmit(row)
>             db.SubmitChanges()
> 
>             success = True
> 
>         Catch ex As Exception
>             MessageBox.Show("Error saving to Customer: " & vbCr & ex.ToString, "Save Data Error")
>         End Try
> 
>     End Using
> 
>     Return success
> 
> End Function 
> ```

现在替换这两行：

> ```
>  If _accountTypeID = 0 Then db.AccountTypes.InsertOnSubmit(row)
>             db.SubmitChanges() 
> ```

像这样：

> ```
>  Dim cmd As IDbCommand
> 
>         cmd = Me.Connection.CreateCommand()
>         cmd.Transaction = Me.Transaction
>         cmd.CommandText = query
> 
>         If myGuid.Trim.Length < 36 Then myGuid = UCase(System.Guid.NewGuid.ToString())
>         cmd.Parameters.Add(New OleDbParameter("myGuid", row.myGuid))
>         cmd.Parameters.Add(New OleDbParameter("AccountType", row.AccountType))
>         cmd.Parameters.Add(New OleDbParameter("Description", row.Description))
>         cmd.Parameters.Add(New OleDbParameter("AcHeadID", row.AcHeadID))
>         cmd.Parameters.Add(New OleDbParameter("LastUpdated", Date.Now))
>         If AccountTypeID > 0 Then cmd.Parameters.Add(New OleDbParameter("AccountTypeID", row.AccountTypeID))
> 
>         If Connection.State = ConnectionState.Closed Then Connection.Open()
> 
>         result = cmd.ExecuteNonQuery()
> 
>         cmd = Me.Connection.CreateCommand()
>         cmd.Transaction = Me.Transaction
>         cmd.CommandText = "SELECT @@IDENTITY"
>         result = Convert.ToInt32(cmd.ExecuteScalar()) 
> ```

上面代码的最后一部分是获取保存记录的 ID。就个人而言，我通常会选择这个选项，因为在大多数情况下我不需要它，所以我不需要在每次保存记录时添加取回数据的开销，我很高兴知道一个记录已保存。

这是添加到 LinQ 的开销，这会导致 Insert 使用 Access 失败。真的有必要拥有吗？我不这么认为。

您可能已经注意到，我通常将我的更新和插入程序放在一起，这样可以节省我的时间并一次性解决插入和更新程序。

删除代码：

> ```
> Private Sub DelButton_Click(sender As Object, e As EventArgs) Handles DelButton.Click
>     Using db As New AccessDataClassesDataContext(ACCCon)
> 
>         Dim AccountTypeID As Integer = Me.DataGridView1.CurrentRow.Cells(0).Value
>         Dim row = From r In db.AccountTypes Where r.AccountTypeID = AccountTypeID
> 
>         For Each detail In row
>             db.AccountTypes.DeleteOnSubmit(detail)
>         Next
> 
>         Try
>             db.SubmitChanges()
>         Catch ex As Exception
>             ' Provide for exceptions.
>             MsgBox(ex)
>         End Try
> 
>     End Using
> 
> End Sub 
> ```

现在您可以享受 LinQ 访问了！快乐编码:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T15:22:45.403

LINQ to SQL 仅适用于 SQL Server 数据库。您需要的是 Microsoft Entity Framework。这使得面向对象访问您的 mdb。从这里您可以运行 LINQ 查询。

[http://msdn.microsoft.com/en-us/library/aa697427(vs.80).aspx](http://msdn.microsoft.com/en-us/library/aa697427(vs.80).aspx)

# php - ajax 显示代码而不是结果

> ID：295773
> 
> 赞同：-1
> 
> 时间：2008-11-17T15:03:00.810
> 
> 标签：php, ajax

我有一个基本的 ajax 应用程序，它不起作用，而是在浏览器中显示 php 代码。javascript 和 html 看起来不错。我从这里逐字复制了代码：

[http://arief.aeroven.com/2008/07/30/first-ajax-script-tutorial-connecting-ajax-contain-pure-htmlphpand-javascript-to-mysql-database/](http://arief.aeroven.com/2008/07/30/first-ajax-script-tutorial-connecting-ajax-contain-pure-htmlphpand-javascript-to-mysql-database/)

这是php：

```
<?
session_start();
//start the session
$cmd = $_GET["cmd"];
$con = mysql_connect('localhost', 'root', 'indosat');
if (!con) {
    die('Connection to MySQL server failed: ' . mysql_error());
    //show error message (mysql_error) if connection failed
}
mysql_select_db('ajax', $con);
//select the database, in this case our database name is "ajax"
if ($cmd === 'GetEmployee') //set command value (executed from javascript ajaxlib.js)
{
    sleep(10);
    //give delay about 10 seconds before execute the command
    //we use this sleep function so we can see the loading animation
    //you can edit/remove
    echo "<table border='1' width='100%'>
    <tr>
    <th>EmpNo</th>
    <th>fName</th>
    <th>lName</th>
    <th>Age</th>
    </tr>";
    //print a table to browser to show the values
    $sql = "select * from employee";
    //this is query to show all records
    $result = mysql_query($sql);
    //execute the query & fill it to $result variable
    while ($row = mysql_fetch_array($result)) {
        echo "<tr>
    <td>" . $row['IdEmp'] . "</td>
    <td>" . $row['fName'] . "</td>
    <td> " . $row['lName'] . "</td>
    <td>" . $row['Age'] . "</td>
    </tr>";
        //print the record to the table
    }
    echo '</table>';
    //close the table
}
mysql_close($con);
//close the mysql connection    
?> 
```

我看不出问题出在哪里

编辑：它不是短标签。它们已启用，并且使用“长”标签没有区别。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T15:06:01.677

也许您没有启用 php 短标签？完整的 php on 标签是`"<?php"` 设置为由 php 解析的文件扩展名之一吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T15:07:17.667

通常，当您的 Web 服务器无法正确处理 PHP 代码时，就会发生这种情况。它不是处理代码，而是将原始文件发送到浏览器。问题很可能不在代码中，而是在服务器设置中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T15:20:13.553

文件扩展名是否正确（PHP 默认只处理*.php*文件，除非它们被用作包含）？文件的位置是否正确（以便预处理器可以访问它）？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T15:08:59.097

我敢打赌短标签是问题

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T15:25:40.063

这是未启用的 php 短标签。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T15:40:52.887

我不知道答案，但这里有一个关于如何解决这些问题的指南：

1.  完全删除文件
    *   创建一个同名的新文件，只包含 html
    *   只用一个重写内容`<?php echo phpinfo(); ?>`

我怀疑这与 PHP 有什么关系，并相信它与 Apache 有关。您确定将文件保存在正确的位置吗？您的`DocumentRoot`目录设置是什么？您将文件保存在哪里？以上所有步骤都有效吗？我怀疑您是否达到（3），在测试用例中一切正常，但原始代码中断。这可能与文件扩展名（在 Linux 上区分大小写）或您放置文件的位置有关。

# iphone - iPhone - 调试“未分配指针被释放”错误

> ID：295778
> 
> 赞同：7
> 
> 时间：2008-11-17T15:04:45.613
> 
> 标签：iphone, cocoa-touch, malloc-history

当过度释放指针时，您可能会看到错误，例如

“未分配被释放的指针”

在使用模拟器进行调试时，我添加了一个构建参数 MallocStackLogging = YES - 这允许我在终端中使用 malloc_history 来追踪我过度释放指针的位置。

如果我使用此构建参数在设备上进行调试，我会收到各种控制台错误“无法创建堆栈日志文件”等。

奇怪的是，我在设备上出现了一些过度释放的指针错误，但在模拟器上却没有。

有没有人有使用设备本身追踪这些的经验？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-12-15T20:47:01.943

另一种方法来做到这一点。确保打开 NSZombie，以便它报告正在获得额外释放的对象的内存地址。然后使用性能工具-> 对象分配运行。这将带来乐器。查看 Xcode 管理器提供的控制台日志。一旦你得到崩溃查找仪器中的内存地址。您将看到该对象上 malloc/frees 的全部历史，以及直接进入您的代码的链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T19:07:27.087

我通常使用 NSZombie 来做这些事情，看看[这个](http://www.cocoadev.com/index.pl?DebuggingAutorelease)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T23:04:49.883

您需要在目标可执行文件上设置 MallocStackLogging 环境变量...

要访问这些设置，请从 XCode 的 Groups & Files 窗格中选择您的可执行文件，然后选择 Get Info。

转到参数选项卡并将以下条目添加到“要在环境中设置的变量”框中：

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-25T07:54:21.087

请测试程序是否有内存泄漏，还要检查自动释放以及是否正确释放对象。此外，我们需要检查释放的对象是否分配了内存。您还需要注意自动释放​​，因为不小心我们可能会释放一个数组或一个字符串或任何已经自动释放的对象......希望它有帮助并且有效！

**提示：您可以通过分析您的项目来测试泄漏（单击 shift+command+k）**

# unix - 在 Unix 上计算一列输出总和的最短命令？

> ID：295781
> 
> 赞同：50
> 
> 时间：2008-11-17T15:05:17.747
> 
> 标签：unix, math, shell, ksh

我确信有一种快速简便的方法来计算 Unix 系统上的一列值的总和（使用类似`awk`或`xargs`可能的东西），但是编写一个 shell 脚本来逐行解析行是唯一的事情此刻心里。

例如，修改以下命令以计算和显示 SEGSZ 列 (70300) 的总数的最简单方法是什么？

```
ipcs -mb | head -6
IPC status from /dev/kmem as of Mon Nov 17 08:58:17 2008
T         ID     KEY        MODE        OWNER     GROUP      SEGSZ
Shared Memory:
m          0 0x411c322e --rw-rw-rw-      root      root        348
m          1 0x4e0c0002 --rw-rw-rw-      root      root      61760
m          2 0x412013f5 --rw-rw-rw-      root      root       8192 
```

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-11-17T15:14:20.023

```
ipcs -mb | tail +4 | awk '{ sum += $7 } END { print sum }' 
```

或者没有尾巴：

```
ipcs -mb | awk 'NR > 3 { sum += $7 } END { print sum }' 
```

将 awk 与 bc 一起使用以获得任意长的结果（归功于`Jouni K.`）：

```
ipcs -mb | awk 'NR > 3 { print $7 }' | paste -sd+ | bc 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-06-02T10:50:05.953

我会尝试构造一个计算字符串并将其提供给*bc*，如下所示：

1.  *grep*包含数字的行
2.  *消除*每行数字之前（和之后）的所有字符
3.  *xargs*结果（获取由空格分隔的一串数字）
4.  *将空格*转换为 '+' 字符
5.  好胃口*！*

`ipcs -mb | grep -w '^m ' | sed 's/^.*\s//' | xargs | tr ' ' + | bc`

*看起来这比awk*解决方案略长，但对于无法阅读（和理解）奇怪*awk*代码的每个人来说，这可能更容易掌握...... :-)

如果未安装*bc ，您可以在上面的步骤 5 中使用双括号来计算结果：*

*   `echo $(( $(ipcs -mb | grep -w '^m ' | sed 's/^.*\s//' | xargs | tr ' ' +) ))`或者
*   `SUM=$(( $(ipcs -mb | grep -w '^m ' | sed 's/^.*\s//' | xargs | tr ' ' +) ))`或者
*   `(( SUM=$(ipcs -mb | grep -w '^m ' | sed 's/^.*\s//' | xargs | tr ' ' +) ))`

双括号前后的间距是可选的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T09:28:00.637

我有一个实用程序脚本，它只是将*所有*列相加。从单行输出中获取所需的内容通常很容易。作为奖励，可以识别一些 SI 后缀。

```
#!/usr/bin/awk -f
# Sum up numerical values by column (white-space separated)
#
# Usage:  $0 [file ...]
#
# stern, 1999-2005

{
    for(i = 1; i <= NF; ++i) {
        scale = 1
        if ($i ~ /[kK]$/) { scale = 1000 }
        if ($i ~ /[mM]$/) { scale = 1000*1000 }
        if ($i ~ /[gG]$/) { scale = 1000*1000*1000 }
        col[i] += scale * $i;
    }
    if (NF > maxnf) maxnf = NF;
}

END {
    for(i = 1; i <= maxnf; ++i) { printf " %.10g", col[i] }
    print "";
} 
```

带有自定义字段分隔符的示例：

```
$ head /etc/passwd | addcol -F:
0 0 45 39 0 0 0 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-02-16T22:42:37.647

我知道这个问题有些过时，但我在这里看不到“我的”答案，所以我还是决定发布。我会结合

*   尾巴（得到你需要的线条）
*   tr（将多个连续空格缩小为一个）
*   剪切（仅获取所需的列）
*   粘贴（用`+`符号连接每一行）
*   bc（进行实际计算）

`ipcs`没有在我的系统上提供输出，所以我将通过以下方式进行演示`df`：

```
# df
Filesystem     1K-blocks    Used Available Use% Mounted on
rootfs          33027952 4037420  27312812  13% /
udev               10240       0     10240   0% /dev
tmpfs             102108     108    102000   1% /run
/dev/xvda1      33027952 4037420  27312812  13% /
tmpfs               5120       0      5120   0% /run/lock
tmpfs             204200       0    204200   0% /run/shm
/dev/xvda1      33027952 4037420  27312812  13% /var/www/clients/client1/web1/log
/dev/xvda1      33027952 4037420  27312812  13% /var/www/clients/client1/web2/log
/dev/xvda1      33027952 4037420  27312812  13% /var/www/clients/client1/web3/log
/dev/xvda1      33027952 4037420  27312812  13% /var/www/clients/client1/web4/log
/dev/xvda1      33027952 4037420  27312812  13% /var/www/clients/client2/web5/log
/dev/xvda1      33027952 4037420  27312812  13% /var/www/clients/client2/web6/log
# df | tail -n +2 | tr -s ' ' | cut -d ' ' -f 2 | paste -s -d+ | bc
264545284 
```

我知道在我的系统上做这个特殊的计算并没有什么意义，但它显示了这个概念。

该解决方案的所有部分都已在其他答案中显示，但从未在该组合中显示。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-17T15:14:25.747

Python 解决方案

```
#!/usr/bin/env python
text= file("the_file","r")
total= 0
for line in text:
    data = line.split()
    if data[0] in ('T', 'Shared', 'IPC'): continue
    print line
    segsize= int(data[6])
    total += segsize
print total 
```

大多数 Linux 发行版都有 Python。

如果要将标准输入作为管道的一部分进行处理，请使用

```
import sys
total = 0
for line in sys.stdin:
   ...etc... 
```

如果您想假设总是有 3 个标题行：

```
import sys
total = 0
for line in sys.stdin.readlines()[3:]:
    total += int(line.split()[6])
print total 
```

单线：

```
import sys; print sum( [int(line.split()[6]) for line in sys.stdin.splitlines()[3:]] ) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T15:13:14.487

您可以从运行数据开始`cut`- 这至少会减少列。

然后，您应该能够将其通过管道传输到`grep`，剥离非数字。

然后......好吧，那我不确定。可以将其通过管道传输到`bc`. 如果没有，它当然可以交给一个 shell 脚本来添加每个项目。

如果您曾经`tr`将换行符 ( `\n`) 更改为空格 ( `)，并通过 xargs 将其传送到循环直到没有更多输入的脚本中，然后添加每个输入，您可能会得到答案。`

 `因此，类似于以下内容：

```
cat <whatever> | cut -d'\t` -f7 | grep -v <appropriate-character-class> | tr '\n' ' ' | xargs script-that-adds-arguments 
```

我的`cut`标志可能略有错误 - 但`man`你的朋友是 :)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-17T15:28:52.177

您可以在任何在线 awk 参考资料中查找它：

```
ipcs | awk '
BEGIN { sum = 0 }
/0x000000/ { sum = sum + $2 }
END {print sum}' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-13T15:14:22.573

感谢上面的 Python 单线！它帮助我轻松检查驱动器上的已用空间。这是一个混合的 shell / Python 单线，它执行此操作 - 以兆字节为单位计算设备 /dev/sda 上的已用空间。我花了一些时间才发现它，所以，也许有人也觉得这很有用。

```
df -h -B 1M | grep dev/sda | tr -s ' '| cut -d' ' -f3 |python -c "import sys; print sum([int(num) for num in sys.stdin.readlines()])" 
```

或更多 Python / 更少外壳：

```
 df -h -B 1M | python -c "import sys; print sum([int(l.split()[2]) for l in sys.stdin.readlines() if '/dev/sda' in l])" 
```

再次感谢！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-10-26T13:39:01.333

要对列中的值求和，您可以使用 GNU datamash。由于前四行不包含您想要总结的值，我们用 删除它们`tail +4`。

```
ipcs -mb  | tail +4 | datamash -W sum 7 
```

该`-W`选项将字段分隔符设置为（可能是多个）空格。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-12-21T12:55:37.407

如果您有特定的多列要求和，您可以使用：

```
input_command | awk '{s1+=$1;s2+=$2;s3+=$3;s4+=$4;s5+=$5}END{print s1,s2,s3,s4,s5}' 
```

如果您想对第 1-5 列求和，这将起作用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-08-22T14:42:15.967

难以想象 perl 没有被举例说明！

参见`perldoc perlrun`-a（这意味着 -n）。并`perldoc perlvar`了解 $。和朋友。

```
$ df |perl -aE'$.<2or$u+=$F[2]}{say"Used: $u"'
Used: 129016836 
```

如果你真的想发疯：

```
$ df -h |perl -anE'$|=1;
  BEGIN{%M=(""=>1,k=>1e3,K=>2**10,M=>2**20,G=>2**30,T=>2**40);%D=reverse%M}
  print;
  if($.<2){@V=map length(),/\s*+[^a-z]\S*(?:\s+[a-z]+)*/g;next} # parse header
  ($w=($_==$#V)+length($F[$_])-$V[$_])>0 and do{$V[$_]+=$w;$_<$#V and $V[$_+1]-=$w} for 0..$#F; # optimize column widths
  $S[$_]+=($F[$_]=~/^(\d+(?:[.]\d*)?)([kKMGT])?$/aa?$1*$M{($D||=$2)&&$2}:-Inf)for 0..$#F; # scale numeric values
}{ # show results
  say join("",map+("-"x($V[$_]-1)).($S[$_]<0?"^":"+"),0..$#V);
  $V[$_]+=$V[$_-1]for 1..$#V;
  if($D){for$s(@S){@s=sort{$b<=>$a}grep{$_<$s}keys%D and$s=sprintf"%.1f%s",$s/$s[0],$D{$s[0]}}}
  say sprintf+("%s%*s"x@S),map{((!$p||($_>0 and length($S[$_])>=($w=($V[$_]-$V[$_-1])))?(($q?"\n":(($p=$q=1)&&"")),$V[$_]):("",0+$w)),$S[$_])}grep{$S[$_]!=-Inf}0..$#S;
' 
```

# perl - 如何在 Perl 中获取文件元信息？

> ID：295798
> 
> 赞同：5
> 
> 时间：2008-11-17T15:09:16.180
> 
> 标签：perl, file

我正在寻找一个模块或某种方式来获取有关文件内容的信息。

Linux“文件”命令所做的事情相同，但使用 Perl 语言。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-17T15:15:11.143

看看 CPAN 上的 File::Magic 模块。（编者注：此模块已被其作者删除。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T15:15:39.303

看看 File::Magic

[http://search.cpan.org/~rehsack/File-Magic-0.01/](http://search.cpan.org/~rehsack/File-Magic-0.01/)

File::Magic 不再受支持。改用 File::MMagic（现在 metacpan.org 也优于 search.cpan.org）

[https://metacpan.org/pod/File::MMagic](https://metacpan.org/pod/File::MMagic)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-17T16:29:05.723

我终于选择做类似的事情

```
$res = `file a.txt`; 
```

# java - 从 ColdFusion 调用 .jar

> ID：295811
> 
> 赞同：7
> 
> 时间：2008-11-17T15:13:13.130
> 
> 标签：java, coldfusion, instantiation

我有一个 .jar 文件，我已将它放在我的 D:\Coldfusion8\wwwroot\web-inf\lib\ 目录中。该文件是 abcdef.jar

这是我第一次这样做，不确定我的 createObject() 中的路径应该是什么。

```
<cfset abcObj = createObject("java","com.abcdef") />
<cfset result = acbObj.doStuff("123456") /> 
```

但是当我运行它时，我得到

```
Object Instantiation Exception.
Class not found: com.vp4jo_b 
```

我在路径中缺少什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T13:51:13.387

您是否考虑过使用[JavaLoader](http://javaloader.riaforge.org/)？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-17T15:42:30.137

您是否重新启动了 Coldfusion 服务？

即使在类路径中，jar 也只会在服务器启动时加载。

信息从评论中上移：

*   确保该文件位于 System 类路径中，或者位于 ColdFusion 的配置类路径之一中。
*   至于类名参数`CreateObject()`：类名在jar内开始。像 .zip 文件一样打开它并查看其结构。虚线路径模仿文件夹结构，所以如果服务器仍然抱怨，你一定是在虚线路径中遗漏了一些东西。

# java - 如何在 WebLogic Workshop 中创建支持 JPA 实体 bean 的项目？

> ID：295813
> 
> 赞同：0
> 
> 时间：2008-11-17T15:13:18.200
> 
> 标签：java, jpa, weblogic, entity-bean

如何在 WebLogic Workshop（10.3 版）中创建一个支持 JPA 实体 bean 的项目？

我正在尝试在 Workshop 中创建一个单独的 EJB 和 EJBClient 项目，并且 EJB3 会话 bean 工作得很好，但是我遇到了 JPA 实体 bean 的问题。

似乎在创建新项目时，如果您正在创建 Web 项目，则可以添加对 JPA 和 BEA Kodo 的支持，但由于某种原因，您无法将 JPA 支持添加到 EJB 项目中。

我确实想将我的 EJB3/entity bean 的东西和 Web 的东西分开到单独的项目中。我怎样才能做到这一点？

我应该将 Kodo/JPA .jar 添加到我的 EJB 项目中吗？或者我应该创建一个单独的动态 web 项目并将其视为 EJB 项目。

工作示例项目会很好;）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-10T04:30:37.980

[http://jaiswaltraining.com/ejb3/weblogic/ch2.php](http://jaiswaltraining.com/ejb3/weblogic/ch2.php)提供了一些循序渐进的 EJB3 示例、带有 JPA 的实体 Bean、数据源创建以及 Eclipse 中的所有内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T20:39:26.447

最简单的事情似乎是将 JPA 库添加到 EJB 项目并完成它。似乎 Workshop 对 EJB 项目中的 JPA 没有特定的支持。并不是说它是必需的。

# sql-server - 将 SQL Server 锁定到 Web 服务器上的特定应用程序

> ID：295825
> 
> 赞同：1
> 
> 时间：2008-11-17T15:15:41.457
> 
> 标签：sql-server, security, web-applications

我很好奇，有没有办法告诉 SQL Server 特定组只能从单个位置/应用程序访问数据库。我有一个 SQL Server 和一个 Web Server。我们的应用程序使用存储过程，并且每个存储过程的访问权限都基于允许访问它的角色。然后，用户组会根据他们将要执行的功能分配角色。作为附加的安全层，我想指定这些用户可以从中访问数据库的 Web 应用程序。

我想这是矫枉过正。存储过程名称始终对用户隐藏（所有错误都被隐藏，向用户显示通用的“对不起，这不起作用”）。用户只能访问他们被允许执行的存储过程。这只是一个很好的附加安全性，因此如果一个表意外授予每个人完全访问权限，数据库将只允许从一个位置进行完全访问。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T15:37:06.013

我建议将应用程序/应用程序池作为对程序具有权限的服务帐户运行，但不要向用户本身授予任何权限。这需要不在数据库级别实现用户安全，而是在应用级别实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T15:45:07.653

在连接字符串中，您可以设置`Application Name=MyAppName`- 这不是真正的安全性，但您可以在您的 SP（列`sysprocesses`中的 - `program_name`）和通过`sp_who`.

对于表格，您无能为力 - 这就是为什么我建议任何**人**都不要担任**任何**允许访问表格的角色（`SELECT`、`INSERT`、`UPDATE`或`DELETE`）。

您可以使用一些自动化的 T-SQL 定期对此进行审核，以确保没有人做过任何愚蠢的事情。

**我不提倡以任何方式这样**做，但您可以对视图执行类似的操作（比较当前进程的 SPID 和 program_name）：

```
CREATE VIEW YourViewNameHere
AS
SELECT *
FROM YourTableNameHere
WHERE EXISTS (
    SELECT spid, program_name
    FROM sys.sysprocesses
    WHERE program_name = 'YourProgramNameHere'
        AND spid = @@SPID
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T17:03:44.297

最简单的方法是将其锁定在用户级别。您可以在您配置了所需权限的特定安全上下文下运行您的 win/web 应用程序。

这提供了强制用户运行您的应用程序以与 SQL 交互的好处，而不能只打开企业管理器或其他任何东西。

# javascript - 检测网页中重复的javascript函数名称的工具？

> ID：295827
> 
> 赞同：8
> 
> 时间：2008-11-17T15:16:05.590
> 
> 标签：javascript

**背景**

我们有一个 Web 应用程序，其中几个开发人员编写了几个 .js 文件来操作 DOM，重复函数名称的问题已经潜入我们的应用程序。

**问题**

谁能推荐一个工具，当我们不小心用两个同名的 javascript 函数编写网页时会警告我们？

**例子**

*网页*

```
<script language="JavaScript" src="test.js" type="text/javascript"></script>
<script>function foo() {alert('bar');}</script> 
```

*测试.js*

```
function foo() {alert('foo');} 
```

由于 foo() 在页面中被声明了两次，显然只加载优先的那个。

我使用的工具似乎忽略了这一点。Firebug 只显示加载的函数。Netbeans 将在导航器中显示这两个函数（没有警告），但一次只查看一个文件（即，我不能将它指向 HTML 文件并同时查看它和 .js。）和 web开发人员扩展允许我一次查看所有内容，但没有错误或警告。Firefox 的错误控制台也不会抛出任何警告或错误。IE也不行。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T17:38:23.850

我经常使用[JSLINT](http://jslint.com/)

简而言之，它是使用 JavaScript 的 JavaScript 的“编译器”。通过观看 Douglas Crockford 的培训视频，我学到了很多东西。

它不仅检查重复的函数，还检查全局变量和一大堆其他东西。就像 Douglas 在他的一个视频中所说的那样，它只允许你使用 JavaScript 的优秀部分

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-17T18:19:46.357

好吧，使用解析器可能并不总是理想的，因为它需要一个额外的步骤，将您的代码和其他所有人的代码复制并粘贴到解析器中，即使那样我也不确定它是否能捕捉到您想要的东西。久经考验的协作 Javascript 开发解决方案是命名您的代码。

```
var myNamespace = function (){
   var myPrivateProperty;
   var myPrivateFunction = function(){};
   return{

      myPublicProperty: '',
      myPublicFunction: function(){}

   }

 }(); 
```

这是基于 Douglas Crockford 的[模块模式](http://yuiblog.com/blog/2007/06/12/module-pattern/)。

然后你可以这样调用你的公共函数：

```
 myNamespace.myPublicFunction(); 
```

还有你的公共财产：

```
 myNamespace.myPublicProperty; 
```

每个开发者都可以在自己的命名空间中开发，以免踩到别人的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T17:05:26.930

我的解决方案是一个用于 Java 的简单 HTML 解析器（我刚刚用正则表达式破解了一个；您可能想尝试[http://java-source.net/open-source/html-parsers/jtidy](http://java-source.net/open-source/html-parsers/jtidy)）和 Apache Rhino 库（[http ://www.mozilla.org/rhino/doc.html](http://www.mozilla.org/rhino/doc.html)）。

如果重新定义函数，应该可以重载 Rhino 中的解析器以引发错误。

我正在使用John Resig的 env.js ( [http://jqueryjs.googlecode.com/svn/trunk/jquery/build/runtest/env.js ) 的略微修改版本来模拟浏览器。](http://jqueryjs.googlecode.com/svn/trunk/jquery/build/runtest/env.js)这允许我在 JUnit 测试中测试 JavaScript。我可以填写表格、提交表格、检查页面布局等。

有关详细信息，请参阅我的博客：http: [//blog.pdark.de/2008/11/18/testing-the-impossible-javascript-in-a-web-page/](http://blog.pdark.de/2008/11/18/testing-the-impossible-javascript-in-a-web-page/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-20T07:55:12.963

ScriptManager.RegisterClientScriptInclude（我，Page.GetType，“jsTest”，“test.js”）

# xml - 在内联 VB 代码中嵌入 XML 元素

> ID：295832
> 
> 赞同：2
> 
> 时间：2008-11-17T15:18:02.433
> 
> 标签：xml, vb.net

考虑 VB9 中的以下代码：

```
Dim text = "Line1<br/>Line2"
Dim markup = <span><%= text %></span>.ToString 
```

虽然我希望标记最终会成为`<span>Line1<br/>Line2</span>`，但它实际上评估为`<span>Line1&lt;br/&gt;Line2</span>`.

有没有办法让变量的值不被 HTML 编码？

PS：这是我正在尝试做的一个过于简单的例子。我知道这可以通过多种方式重写以使其工作，但是我的代码的构造方式，对变量进行非编码将是最佳的。如果那是不可能的，那么我会走另一条路。

更多细节：“文本”来自数据库，用户可以在其中输入自由格式的文本，并带有回车。输出是 HTML，所以我需要从数据库中获取值并将回车转换为换行符。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T15:35:21.290

此行为是设计使然。” 在 XML 文字中嵌入字符串表达式时，该值将被转义为合法的字符串值。

要获得您正在寻找的行为，您需要在 XML 文字中嵌入 XElement/XNode。举个例子。它将正确地将`<br/>`标记保留为 XElement。

```
Dim text2 = <a>Line<br/>Line</a>
Dim markup2 = <span><%= text2 %></span>.ToString 
```

实现此目的的一种方法是伪造 XElement。例如，要使文本成为有效字符串，只需将其两端用普通标签包装即可`<a>`。现在这是一个可解析的 XML 片段。拥有 XElement 后，很容易获得您正在寻找的嵌入式行为

```
Dim text = "Line1<br/>Line2"
Dim text2 = XElement.Parse("<a>" + text + "</a>")
Dim markup = <span><%= text2.Nodes %></span>.ToString 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T05:16:12.873

在 VB.NET 中，您可以直接编写**XML 文字**

```
Dim markup As XElement = <span>Line1<br/>Line2</span> 
```

*   VB 编译器**“看到”XML，**
*   并为您创建**等效的 Xlinq**命令。

阅读有关[VB.NET 中 XML 文字的](http://donxml.com/allthingstechie/archive/2005/10/10/2239.aspx)更多信息。

# c# - ? 的可空类型问题：条件运算符

> ID：295833
> 
> 赞同：159
> 
> 时间：2008-11-17T15:18:35.740
> 
> 标签：c#, generics, nullable, conditional-operator

有人可以解释为什么这在 C#.NET 2.0 中有效：

```
 Nullable<DateTime> foo;
    if (true)
        foo = null;
    else
        foo = new DateTime(0); 
```

...但这不是：

```
 Nullable<DateTime> foo;
    foo = true ? null : new DateTime(0); 
```

后一种形式给了我一个编译错误“条件表达式的类型无法确定，因为 '<null>' 和 'System.DateTime' 之间没有隐式转换。”

不是我不能使用前者，而是第二种风格更符合我的其余代码。

* * *

## 回答 #1

> 赞同：335
> 
> 时间：2008-11-17T15:21:26.653

编译器告诉您它不知道如何转换`null`为`DateTime`.

解决方案很简单：

```
DateTime? foo;
foo = true ? (DateTime?)null : new DateTime(0); 
```

请注意，`Nullable<DateTime>`可以编写`DateTime?`这将为您节省大量打字。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-17T15:25:48.767

仅供参考（Offtopic，但很漂亮并且与可空类型相关）我们有一个方便的运算符，仅用于可空类型，称为空合并运算符

```
?? 
```

像这样使用：

```
// Left hand is the nullable type, righthand is default if the type is null.
Nullable<DateTime> foo;
DateTime value = foo ?? new DateTime(0); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-17T15:22:25.607

这是因为在三元运算符中，两个值必须解析为相同的类型。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-08-27T15:04:17.613

另一个类似于接受的解决方案是使用 C# 的[`default`](http://msdn.microsoft.com/en-us/library/xwth0h0d%28v=vs.100%29.aspx)关键字。虽然使用泛型定义，但它实际上适用于任何类型。

适用于 OP 问题的示例用法：

```
Nullable<DateTime> foo;
foo = true ? default(DateTime) : new DateTime(0); 
```

当前接受的答案的示例用法：

```
DateTime? foo;
foo = true ? default(DateTime) : new DateTime(0); 
```

此外，通过使用`default`，您无需指定变量`nullable`，以便为其分配`null`值。编译器将自动分配特定变量类型的默认值，不会遇到错误。例子：

```
DateTime foo;
foo = true ? default(DateTime) : new DateTime(0); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-04-07T21:46:30.897

我知道这个问题是在 2008 年提出的，现在是 5 年后，但标记为答案的答案并不让我满意。真正的答案是 DateTime 是一个结构体，并且作为一个结构体它与 null 不兼容。你有两种解决方法：

首先是使 null 与 DateTime 兼容（例如，将 null 转换为 DateTime？正如拥有 70 票赞成的绅士所建议的那样，或者将 null 转换为 Object 或 ValueType）。

二是使 DateTime 与 null 兼容（例如，将 DateTime 转换为 DateTime？）。

# debugging - 控制 Eclipse CDT 调试器输出？

> ID：295836
> 
> 赞同：8
> 
> 时间：2008-11-17T15:20:32.040
> 
> 标签：debugging, eclipse-cdt

使用 CDT 时，我希望 std::string 显示在“变量”调试窗口中，并带有它包含的字符串。例如，如果它当前持有*“历史”*一词，我想在标有“变量”的调试器窗口中查看**历史**。

我认为有一种通用的方法可以让它深入到对象中，但我不能把手指放在它上面。有没有人知道如何做到这一点？

当从复杂对象输出单个字段时，这对我也很有用。

谢谢，比尔

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-26T16:15:48.683

长期以来，使用 eclipse/gdb 显示 stl 容器对我来说也是一个主要的痛苦。

但是现在我刚刚发现启用了 python 的最新版本的 gdb 可以帮助解决这个问题。

它遵循我所做的（使用 Ubuntu Linux 8.10）：

*   安装 gdb 版本 >= 6.8.50（例如[来自 debian experimental](http://packages.debian.org/experimental/i386/gdb/download)）
*   在项目根目录中创建一个名为 .gdbinit 的文件，其内容如下：

    python 导入 gdb.libstdcxx.v6.printers

现在 stl 容器将**打印得很漂亮**。

如果您想检查您是否已经启用了 python 的 gdb（或者您的新安装是否有效）：

*   从控制台启动 gdb
*   在 gdb 提示符下执行以下命令

    (gdb) python print '启用 Python 的 GDB 正在工作！

*   如果上面的命令产生了我们期望的结果，那么它就可以工作了。

有关更多详细信息，请查看[此博客](http://tromey.com/blog/?p=524)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T15:44:44.003

请注意，您**不**想要深入研究对象的一般方法；你想漂亮地打印 STL 容器。

我认为 CDT 将此委托给调试器后端；即，由您的调试器（也许是gdb？）通知CDT 变量的值以及如何扩展它。

编辑：我认为 CDT 附带的 GDB 后端不支持 STL 容器的“智能”显示。如果您真的对此感兴趣，我建议您通过 cdt-dev@eclipse.org 联系 CDT 开发团队。

更新/编辑：有关如何在 CDT 中启用漂亮打印机的说明，请参阅下面的其他回复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-18T19:40:18.943

Windows 7的

获取漂亮的打印机： `svn co svn://gcc.gnu.org/svn/gcc/trunk/libstdc++-v3/python`

使用以下命令设置 Eclipse：C/C++ 调试 Gdb：

```
C:\MinGW\bin\gdb-python27.exe
C:\MinGW\bin\.gdbinit

```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-10T19:13:34.777

我想扩展 Windows 7 的响应，因为省略了一些关键步骤：

# 这适用于使用 Eclipse CDT 的 MinGW 用户

0) 如果您没有 python GDB，请打开 shell/命令并使用 MinGW-get.exe 来“安装”启用 Python 的 GDB，例如

```
 MinGw-get.exe install gdb-python 
```

[1a) 从http://python.org/download/](http://python.org/download/)获取 Python 2.7.x并安装

1b) 确保在您的环境中设置了 PYTHONPATH 和 PYTHONHOME：

```
 PYTHONPATH should be C:\Python27\Lib   (or similar)
 PYTHONHOME should be C:\Python27 
```

1c) 将 PYTHONHOME 添加到您的 PATH

```
 %PYTHONHOME%;... 
```

2a) 打开一个文本回车，输入以下语句。请注意，第 3 行指向 python 脚本所在的位置。请参阅下面的注释！

```
python
import sys
sys.path.insert(0, 'C:/MinGW/share/gcc-4.6.1/python')         
from libstdcxx.v6.printers import register_libstdcxx_printers
register_libstdcxx_printers (None)
end 
```

2b) 另存为 '.gdbinit' 注意：Windows 资源管理器不允许您命名以资源管理器中的句点开头的文件。大多数文本编辑（包括记事本）都可以。GDB 初始化文件就像 GDB 命令的“脚本”，GBD 将在加载时执行。

2c) '.gdbinit' 文件需要位于 GDB 的工作目录中（很可能这是您的项目根目录，但您的 IDE 可以告诉您。

3) 打开您的 Eclipse（或其他 IDE）首选项对话框。转到 C++ 调试器子菜单。

4) 配置 Eclipse 以`C:\MinGW\bin\gdb-python27.exe`用作调试器和您`.gdbinit`的配置文件。

5a) 重新创建所有调试启动配置（删除旧配置并从头开始创建新配置）。

```
--OR-- 
```

5b) 编辑每个调试配置并将其指向新的 gdb-python.exe 并将其指向。

## 如果您遇到问题：

--别忘了把上面python代码中的位置改成python目录！这个目录是由 MinGW 创建的，所以不要去下载漂亮的打印机，MinGW 在第 0 步为你做了。只需转到您的 MinGW 安装目录、共享文件夹、GCC 文件夹（有版本号），您就会找到 python 文件夹。这个位置应该是 GDB 加载的 python 脚本中的位置。

--另外，.gdbinit 是一个 PITA，确保它的命名正确并且在 GDB 的工作文件夹中，这不一定是 gdb-python.exe 所在的位置！在加载 GDB 时查看您的 GDB 输出，以查看是否 a) 'python-enabled' 在加载过程中出现，以及 .gdbinit 中的语句是否出现。

--最后，我对系统变量有很多问题。如果 python 给你'ImportError'，那么很可能你没有设置 PYTHONPATH 或 PYTHONHOME。

--带有'gdb-python27'的目录（例如C:\MinGW\bin'）也应该在你的路径上，如果是的话，它会使设置eclipse更好一些，因为你不需要输入绝对路径. 但是，有时 .gbdinit 需要绝对路径。如果它有效，您将在调试器启动时看到来自 gbd (console->gdb 跟踪) 的输出：

```
835,059 4^done
835,059 (gdb) 
835,059 5-enable-pretty-printing
835,069 5^done
....
835,129 12^done
835,129 (gdb) 
835,129 13source C:\MinGW\bin\.gdbinit
835,139 &"source C:\\MinGW\\bin\\.gdbinit\n"
835,142 13^done
835,142 (gdb) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T20:01:03.780

我发现的唯一方法是使用 GDB 命令行：

1.  在*调试*窗口中，单击*gdb*。它就在堆栈跟踪下方。
2.  在*控制台*窗口中，使用 GDB`up`命令获取所需的堆栈帧
3.  再次在*控制台*窗口中，使用`print`命令显示 `std::string`变量：

    p 我的字符串

但这很麻烦。

我注意到的是，当我将鼠标悬停在变量上时，实际上显示了 std::string 的字段，但它被截断了，所以我没有看到最有趣的部分：字符串值。也许有一种方法可以增加显示值的最大长度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T15:51:14.410

billcoke 最好的办法是使用一些 gdb 宏，您可以在 gdb 控制台中键入这些宏，这些宏可以在 eclipse 的“控制台/调试器”窗口中打开。你可以在这里找到它们：http: [//www.yolinux.com/TUTORIALS/src/dbinit_stl_views-1.01.txt](http://www.yolinux.com/TUTORIALS/src/dbinit_stl_views-1.01.txt)

悬停时它不会是自动的，但是你必须输入很累的....但是即使在 2009 年，eclipse CDT 也没有成功地为我们带来一些很好的调试功能，所以这是你最好的选择。

致 RPSENG：感谢 rpseng 的提示！效果很好！不幸的是，我的日食（Ganymede）似乎变得如此混乱，以至于它不会再发现指向我自己制作的类及其继承的实例的指针类型，因此不再可能单步执行这些指针的成员变量。您在使用 CDT 6.0 吗？它在那里工作得更好吗？

# .net - Dotnetnuke 开发环境和部署

> ID：295837
> 
> 赞同：7
> 
> 时间：2008-11-17T15:20:37.623
> 
> 标签：.net, asp.net, dotnetnuke

我的公司正在重新设计我们的 Intranet 站点，并决定使用 DotNetNuke 作为实施解决方案。在过去的一年里，我一直在努力推动改变，将开发、测试和生产环境分开。我还希望与站点相关的所有更改都进入 SVN，这包括定义页面和模块布局的数据。

有没有人尝试过使用 dotnetnuke 进行此操作？有没有人有其他关于开发 dotnetnuke 网站的技巧？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-17T16:40:40.457

源代码控制

我建议对 DotNetNuke 项目（皮肤、模块、提供程序）使用单独的项目，而不是将实际网站本身检查到源代码控制环境中（DNN 模块将使用 WAP 样式项目）。然后，每个开发人员都可以在他们的开发环境中拥有自己的 DotnetNuke 站点和数据库。我也不建议对 DotNetNuke 的核心进行更改，以便您拥有干净的升级路径。我建议使用诸如[Red Gate 的 SQL 数据比较之](http://www.red-gate.com/products/SQL_Data_Compare/index.htm)类的工具，以便为您的数据生成数据库脚本，您也可以将这些脚本保存在源代码控制环境中。

[以下是有关为 DotNetNuke 模块设置 Web 应用程序项目的更多信息。](http://weblogs.asp.net/ianrobinson/archive/2008/10/15/creating-dotnetnuke-modules-using-a-web-application-project-wap.aspx)

测试/分期/生产

在 DotNetNuke 中将它们分开通常非常容易，因为您已经在创建插入 DNN 站点的模块。我的建议是创建打包且版本正确的模块，以便您可以在测试、登台和生产环境中干净地安装它们。

[以下是有关使用 NAnt 自动化 DNN 模块打包的一些信息。](http://www.dotnetnuke.com/Community/Blogs/tabid/825/EntryId/1489/DotNetNuke-Tip-Packaging-your-DotNetNuke-Module-using-NANT.aspx)

# firefox - wmv 文件在 Firefox 3.0.3 中不工作，在 IE 中工作正常

> ID：295839
> 
> 赞同：2
> 
> 时间：2008-11-17T15:20:44.783
> 
> 标签：firefox

我正在使用以下代码嵌入`.wmv`在 Firefox 中不起作用的文件、带扩展名的视频。它在 IE 中运行良好。

```
document.getElementById("QuestionMedia").innerHTML += 
  '<OBJECT ID="MediaPlayer" WIDTH="350" HEIGHT="280" CLASSID="CLSID:22D6F312-B0F6-11D0-94AB-0080C74C7E95"STANDBY="Loading Windows Media Player components..." TYPE="application/x-oleobject">' + 
    '<PARAM NAME="FileName" VALUE="video/' + Question.Media + '">' +
    '<PARAM name="autostart" VALUE="false">' +
    '<PARAM name="ShowControls" VALUE="true">' +
    '<param name="ShowStatusBar" value="false">' +
    '<PARAM name="ShowDisplay" VALUE="false">' +
    '<EMBED TYPE="video/x-ms-wmv " SRC="video/' + Question.Media + '" NAME="MediaPlayer" WIDTH="350" HEIGHT="280" ShowControls="1" ShowStatusBar="0" ShowDisplay="0" autostart="1"> </EMBED>' + 
  '</OBJECT>'; 
```

请让我知道我该怎么做才能使它工作..？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T15:23:21.317

您应该拥有[适用于 Firefox 的 Windows Media Player 插件](http://port25.technet.com/pages/windows-media-player-firefox-plugin-download.aspx)才能看到视频。WMV 是 Microsoft/Media Player 特定格式，需要用于浏览器的插件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T21:42:16.237

我遇到了一个遇到相反问题的人-这是在 Firefox 中对他们有用的方法-在 bith IE7 和 Firefox 中也对我有用。

代码如下：

```
<!-- begin embedded WindowsMedia file... -->
<table border='0' cellpadding='0' align="center">
  <tr><td>
    <OBJECT id='mediaPlayer' width="704" height="573" classid='CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95' codebase='http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701' standby='Loading Microsoft Windows Media Player components...' type='application/x-oleobject'>
      <param name='fileName' value="../content/Video/video.wmv">
      <param name='animationatStart' value='true'>
      <param name='transparentatStart' value='true'>
      <param name='autoStart' value="true">    
      <param name='showControls' value="true"> <param name='loop' value="true">
      <EMBED type='application/x-mplayer2' pluginspage='http://microsoft.com/windows/mediaplayer/en/download/' id='mediaPlayer' name='mediaPlayer' displaysize='4' autosize='-1' bgcolor='darkblue' showcontrols="true" showtracker='-1' showdisplay='0' showstatusbar='-1' videoborder3d='-1' width="704" height="573" src="../content/Video/video.wmv" autostart="true" designtimesp='5311' loop="true">
      </EMBED>
    </OBJECT>
  </td></tr>
<!-- ...end embedded WindowsMedia file -->
<!-- begin link to launch external media player... -->
  <tr><td align='center'>
  </td></tr>
</table> 
```

您需要更改播放器的尺寸以满足您的要求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T15:36:41.430

您不能在文件中包含视频播放器对象并使用 JavaScript 将其设置为 SRC 吗？如果可行并且您找不到问题的答案，那将是一个[肮脏的]解决方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T15:18:34.490

我在 PC 上使用 Firefox 3 时遇到了非常相似的问题。当我改变

```
<embed src="/media/video.wmv"> 
```

至

```
<embed src="http://mysite.com/media/video.wmv"> 
```

我的问题突然消失了。去搞清楚。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T21:16:17.890

如果您使用的是 VideoLAN 插件，请尝试将其卸载。它给我带来的只是麻烦。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-08T07:25:50.727

为什么不使用可用的开源之一，即免费的开源解决方案将电影嵌入页面。

这将解决潜在的插件问题（显然需要的 Flash Player 除外）并且可以在任何平台或浏览器上工作。

标题

# xml - 我在哪里可以找到关于如何编写 XML DTD 的好文档？

> ID：295847
> 
> 赞同：5
> 
> 时间：2008-11-17T15:22:35.093
> 
> 标签：xml, dtd

XML 1.1 规范中对 DTD 的描述非常简洁，很难理解哪些特性是可用的。例如，通过查看未扁平化的[XHTML+MathML+SVG DTD](http://www.w3.org/TR/XHTMLplusMathMLplusSVG/#driver)，我知道可以导入和部分重新定义外部 DTD，但通过阅读规范我永远猜不到这是可能的。

有谁知道学习 DTD 写作细节的好资源？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:24:19.690

可能对您的需求来说太基础了，但是[W3 学校](http://www.w3schools.com/dtd/default.asp)通常有很好的入门书？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T03:27:18.030

我会推荐*Elliotte-Rusty Harold*的**[书](https://rads.stackoverflow.com/amzn/click/com/0764549863)“ [XML Bible](https://rads.stackoverflow.com/amzn/click/com/0764549863) ”**。

这不是“文档”，文档类型定义 (DTD) 是 XML 中最复杂的部分之一，值得从最好的资源中学习。

还可以从检查现有的良好 DTD 中学习。例如，请看下面的 DTD，它需要用于[**Balisage 会议幻灯片演示**](http://www.mulberrytech.com/slideshow/index.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T03:32:52.637

我只是使用[Liquid Technologies XML Studio](http://www.liquid-technologies.com/Product_XmlStudio.aspx)的自动完成功能来实现它；他们甚至有一个工具，可以让我给出我正在为其编写 XSD 的 XML 示例，它会尝试推断定义。当然，我现在意识到这是一个 XSD 而不是 DTD。

# c# - Perl 的重复运算符的 C# 等价物是什么？

> ID：295849
> 
> 赞同：7
> 
> 时间：2008-11-17T15:23:02.987
> 
> 标签：c#, perl, string

在 Perl 中

```
print "a" x 3;  # aaa 
```

在 C# 中

```
Console.WriteLine( ??? ) 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-17T15:25:11.420

这取决于你需要什么......`new string('a',3)`例如。

用于处理字符串；你可以循环......不是很有趣，但它会工作。

在 3.5 中，您可以使用`Enumerable.Repeat("a",3)`，但这会给您一个字符串序列，而不是复合字符串。

如果您要经常使用它，可以使用定制的 C# 3.0 扩展方法：

```
 static void Main()
    {
        string foo = "foo";
        string bar = foo.Repeat(3);
    }
    // stuff this bit away in some class library somewhere...
    static string Repeat(this string value, int count)
    {
        if (count < 0) throw new ArgumentOutOfRangeException("count");
        if (string.IsNullOrEmpty(value)) return value; // GIGO            
        if (count == 0) return "";
        StringBuilder sb = new StringBuilder(value.Length * count);
        for (int i = 0; i < count; i++)
        {
            sb.Append(value);
        }
        return sb.ToString();
    } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-17T15:25:39.080

如果您只需要重复一个字符（如您的示例中所示），那么这将起作用：

```
Console.WriteLine(new string('a', 3)) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-06T10:35:29.383

好吧，在所有版本的 .NET 中重复一个字符串，你总是可以这样做

```
public static string Repeat(string value, int count)
{
  return new StringBuilder().Insert(0, value, count).ToString();
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-17T15:56:32.527

如果您需要像 Tom 指出的那样使用字符串来执行此操作，那么扩展方法将很好地完成这项工作。

```
static class StringHelpers
{
    public static string Repeat(this string Template, int Count)
    {
        string Combined = Template;
        while (Count > 1) {
            Combined += Template;
            Count--;
        }
        return Combined;
    }
}

class Program
{
    static void Main(string[] args)
    {
        string s = "abc";
        Console.WriteLine(s.Repeat(3));
        Console.ReadKey();
    } 
```

# linux - 为什么人们使用 tarball？

> ID：295860
> 
> 赞同：90
> 
> 时间：2008-11-17T15:25:49.657
> 
> 标签：linux, package, archive

作为一个主要的 Windows 开发人员，也许我在 Linux 社区中缺少一些文化，但它总是让我感到困惑。

下载文件时首先将文件放入`.tar`存档然后*压缩*。为什么是两步过程？*压缩*不能实现文件分组吗？还有其他一些我不知道的好处吗？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-11-17T15:27:38.357

`bzip`并`gzip`处理单个文件，而不是文件组。普通的旧`zip`（和`pkzip`）对文件组进行操作，并具有内置存档的概念。

*nix 哲学是可以很好地完成特定工作并且可以链接在一起的小工具之一。这就是为什么这里有两个具有特定任务的工具，它们旨在很好地结合在一起。这也意味着您可以使用 tar 对文件进行分组，然后您可以选择压缩工具（`bzip`、`gzip`等）。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-11-17T15:49:29.360

一个重要的区别在于这两种档案的性质。

TAR 文件只不过是文件内容与一些标题的串联，而 gzip 和 bzip2 是流压缩器，在 tarball 中应用于整个串联。

ZIP 文件是单独压缩文件的串联，带有一些标题。实际上，zip 和 gzip 都使用 DEFLATE 算法，并且通过适当的二进制调整，您可以获取 gzip 流的有效负载并将其放入具有适当标题和字典条目的 zip 文件中。

这意味着两种不同的存档类型有不同的权衡。对于小文件的大集合，TAR 后跟流压缩器通常会导致比 ZIP 更高的压缩率，因为流压缩器将有更多的数据来构建其字典频率，因此能够挤出更多的冗余信息。另一方面，ZIP 文件中的（文件长度保留）错误只会损坏那些压缩数据受到影响的文件。通常，流压缩器无法从流中的错误中有意义地恢复。因此，ZIP 文件更能抵御损坏，因为存档的一部分仍然可以访问。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-11-17T15:41:44.070

奇怪的是，没有人提到现代版本的 GNU`tar`允许您在捆绑时进行压缩：

```
tar -czf output.tar.gz directory1 ...

tar -cjf output.tar.bz2 directory2 ... 
```

您还可以使用您选择的压缩器，只要它支持“ `-c`”（到标准输出，或从标准输入）和“ `-d`”（解压缩）选项：

```
tar -cf output.tar.xxx --use-compress-program=xxx directory1 ... 
```

这将允许您指定任何替代压缩器。

[*补充*：如果您从文件中提取`gzip`或`bzip2`压缩文件，GNU`tar`会自动检测这些文件并运行适当的程序。也就是说，您可以使用：

```
tar -xf output.tar.gz
tar -xf output.tgz        # A synonym for the .tar.gz extension
tar -xf output.tar.bz2 
```

这些都会得到妥善处理。如果您使用非标准压缩器，则需要在提取时指定。]

与所选答案一样，分离的原因是职责分离。除此之外，这意味着人们可以使用 ' `cpio`' 程序来打包文件（而不是`tar`），然后使用选择的压缩器（曾几何时，首选压缩器是`pack`，后来它是`compress`（比`pack`)，然后`gzip`它围绕着它的两个前辈运行，并且与`zip`（它已被移植到 Unix，但不是本地的）完全竞争，现在`bzip2`，根据我的经验，它通常比`gzip`.

[*补充*：有人在他们的回答中指出了`cpio`有趣的约定。确实如此，但是在 GNU`tar`获得相关选项（' `-T -`'）之前，`cpio`当您不想归档给定目录下的所有内容时，这是更好的命令——您实际上可以准确地选择要归档的文件。缺点`cpio`是你不仅*可以*选择文件——你*必须*选择它们。还有一个地方可以`cpio`得分；它可以从一个目录层次结构原位复制到另一个目录层次结构，而无需任何中间存储：

```
cd /old/location; find . -depth -print | cpio -pvdumB /new/place 
```

顺便说一句，在这种情况下，' `-depth`' 选项`find`很重要 - 它会在设置目录本身的权限之前复制目录的内容。当我在输入这个答案之前检查命令时，我复制了一些只读目录（555权限）；当我去删除副本时，我必须在 ' `rm -fr /new/place`' 完成之前放宽目录的权限。如果没有该`-depth`选项，该`cpio`命令将失败。我只是在进行清理时才重新记住这一点-引用的公式对我来说是自动的（主要是由于多年来的多次重复）。]

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-17T19:46:03.640

有趣的是，你可以得到`tar`and的创建者没有预料到的行为`gzip`。例如，您不仅可以 gzip 一个 tar 文件，还可以 tar gzip 压缩的文件，以生成一个`files.gz.tar`（从技术上讲，这将更接近工作方式`pkzip`）。或者您可以将另一个程序放入管道中，例如一些密码学，您可以选择任意顺序的 tarring、gzipping 和加密。编写密码学程序的人不必对他的程序将如何使用有丝毫的想法，他所要做的就是从标准输入读取并写入标准输出。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-17T15:31:10.677

在 Unix 世界中，大多数应用程序都被设计为只做一件事，并且做得很好。Unix 中最流行的 zip 实用程序 gzip 和 bzip2 只进行文件压缩。tar 进行文件连接。将 tar 的输出通过管道传输到压缩实用程序中可以满足需要，而不会增加任何软件的过度复杂性。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-17T16:14:09.840

它如此流行的另一个原因是 tar 和 gzip 几乎存在于整个 *NIX 安装基础上。我相信这可能是最大的原因。这也是 zip 文件在 Windows 上非常流行的原因，因为无论 RAR 或 7z 中的高级例程如何，都内置了支持。

GNU tar 还允许您从一个命令（一步）创建/提取这些文件：

*   **创建存档：**
*   `tar -cfvj destination.tar.bz2 *.files`
*   `tar -cfvz destination.tar.gz *.files`

*   **提取存档：** *（-C 部分是可选的，默认为当前目录）*

*   `tar -xfvj archive.tar.bz2 -C destination_path`
*   `tar -xfvz archive.tar.gz -C destination_path`

这些是我多年来在 Linux 和最近在 Nexenta (OpenSolaris) 上的记忆。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-17T15:34:11.950

我认为您正在寻找更多的历史背景。原始 zip 用于单个文件。Tar 用于将多个文件放入一个文件中。因此，tarring 和 zipping 是两步过程。为什么它今天仍然如此占主导地位是任何人的猜测。

来自维基百科的[Tar_ (file_format)](http://en.wikipedia.org/wiki/Tar_(file_format))

> 在计算中，tar（源自磁带存档）既是一种文件格式（以一种存档比特流的形式），也是用于处理此类文件的程序的名称。该格式由 POSIX.1-1988 和后来的 POSIX.1-2001 标准化。最初作为一种原始格式开发，用于磁带备份和其他用于备份目的的顺序访问设备，现在它通常用于将文件集合整理成一个更大的文件，用于分发或归档，同时保留文件系统信息，例如用户和组权限、日期和目录结构。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-03-19T03:39:57.217

## tar 是 UNIX，因为 UNIX 是 tar

在我看来，今天**仍在**使用的原因`tar`是它是（可能很少见的）UNIX 方法从一开始就完美正确的情况之一。

仔细看看创建档案所涉及的各个阶段，我希望您会同意，在这里分离不同任务的方式是**UNIX 哲学**的最佳表现：

*   一个工具（`tar`在这里给它一个名字）专门用于将**任何**选择的文件、目录和符号链接（包括**所有**相关的元数据，如时间戳、所有者和权限）转换为一个字节流。

*   并且只是另一个可任意互换的工具（`gzip` `bz2` `xz`仅举几个选项），它将**任何**输入字节流转换为另一个（希望）更小的输出流。

使用这种方法为用户和开发人员带来了一系列好处：

*   **可扩展性** 允许`tar`与**任何**已经存在的压缩算法或**任何**尚待开发的压缩算法相结合，**而无需**对内部工作进行任何更改`tar`。

    一旦全新的“hyper-zip-utra”或其他压缩工具问世，您就已经准备好使用它来拥抱您的新仆从`tar`.

*   **自 80 年代初以来，稳定性** `tar`一直在大量使用，并在许多操作系统和机器上进行了测试和运行。

    避免在为**每个新的归档工具****一次又一次**地实现存储所有权、权限、时间戳等方面**重新发明**轮子的需要，不仅节省了大量（否则不必要地花费）的开发时间，而且还保证了每个新归档工具的相同**可靠性**新的应用程序。

*******   **一致性**用户界面始终保持不变。

    无需记住，要使用工具 A 恢复权限，您必须通过选项`--i-hope-you-rember-this-one`，使用工具 B，您必须`--this-time-its-another-one` 在使用工具 C 时使用它是 `--hope-you-didnt-try-with-tool-as-switch。

    而在使用工具 D 时，如果您不使用`--if-you-had-used-tool-bs-switch-your-files-would-have-been-deleted-now`.****** 

 ***** * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-17T17:07:21.917

**tar**之所以流行，主要是出于历史原因。有几种现成的替代方案。其中一些存在的时间几乎与 tar 一样长，但由于几个原因，它们的受欢迎程度无法超过 tar。

*   cpio（异形语法；理论上更一致，但人们喜欢他们所知道的，tar 占了上风）
*   ar（很久以前流行，现在用来打包库文件）
*   shar（自解压shell脚本，有各种各样的问题；曾经很流行）
*   zip（由于许可问题，它在许多 Unices 上并不容易获得）

tar 的一个主要优点（和缺点）是它既没有文件头，也没有内容的中央目录。因此，多年来，它从未受到文件大小的限制（直到这十年，档案内文件的 8 Gb 限制成为一个问题，几年前解决了）。

显然 tar.gz （或 ar.Z ）的一个缺点，即您必须解压缩整个存档以提取单个文件并列出存档内容，永远不会伤害到足以使他们大量从 tar 中脱离的人.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-17T15:28:48.853

gzip 和 bzip2 只是一个压缩器，而不是一个归档软件。因此，组合。您需要 tar 软件来捆绑所有文件。

ZIP 本身和 RAR 也是这两个过程的组合。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-17T15:29:21.570

通常在 *nux 世界中，文件包以 tarball 的形式分发，然后可选地进行 gzip 压缩。Gzip 是一个简单的文件压缩程序，它不像 tar 或 zip 那样进行文件捆绑。

曾几何时，zip 无法正确处理 Unix tar 和 unix 文件系统认为正常的一些事情，例如符号链接、大小写混合文件等。我不知道这是否发生了变化，但这就是我们使用 tar 的原因。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-17T15:27:48.887

Tar = 将文件分组到 1 个文件中

GZip = 压缩文件

他们将过程分成两部分。就是这样。

在 Windows 环境中，您可能更习惯使用执行 Zip 的 WinZip 或 WinRar。这些软件的 Zip 进程确实对文件进行分组和压缩，但您根本看不到该进程。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-06-09T18:18:35.640

与 mac 用户喜欢磁盘映像的原因相同：它们是一种非常方便的方式来存档内容，然后将其传递、上传/下载或通过电子邮件发送等。

并且比 zips 恕我直言，更易于使用且更便携。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-06-27T05:23:08.400

在我的 Altos-XENIX 时代（1982 年），我们开始使用 tar（磁带存档器）从 5 1/4 软盘或流式磁带中提取文件并复制到这些媒体。它的功能非常类似于 DOS 5.0 和 6.22 中的 BACKUP.EXE 和 RESTORE.EXE 命令作为补充，如果它不能只适合一个媒体，则允许您跨越多个媒体。缺点是，如果多个媒体中的一个出现问题，整个事情就一文不值。tar 和 dd 源自 UNIX SYStem III，可能出于向后兼容性的原因，它仍然是类 UNIX 操作系统的标准发布实用程序。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-17T18:53:30.940

Tar 不仅是一种文件格式，而且是一种磁带格式。磁带逐位存储数据。每个存储实现都是自定义的。Tar 是一种方法，您可以通过这种方法从磁盘中取出数据，并将其存储到磁带上，这样其他人无需您的自定义程序即可检索它。

后来，压缩程序出现了，*nix 仍然只有一种方法可以创建包含多个文件的单个文件。

我相信这只是惯性，随着 tar.gz 趋势的延续。Pkzip 一举开始同时进行压缩和归档，但是 DOS 系统通常没有连接磁带驱动器！

来自维基百科的 Tar_ (file_format)

> 在计算中，tar（源自磁带存档）既是一种文件格式（以一种存档比特流的形式），也是用于处理此类文件的程序的名称。该格式由 POSIX.1-1988 和后来的 POSIX.1-2001 标准化。最初作为一种原始格式开发，用于磁带备份和其他用于备份目的的顺序访问设备，现在它通常用于将文件集合整理成一个更大的文件，用于分发或归档，同时保留文件系统信息，例如用户和组权限、日期和目录结构。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-04-25T00:29:24.593

**作为一名 Windows 开发人员， tarball**看起来很奇怪是可以理解的。这个词`tar`代表磁带存档。想想卷对卷磁带录音机。

在 Windows 世界中，程序通常安装有`setup.exe`或`install.exe`在注册表中运行各种巫术，创建目录和安装`.dll`（动态链接库）文件。

在 Linux 中，尤其是 Ubuntu，根据我自己的经验，包管理器*大部分时间都*负责获取应用程序并安装它。在 Ubuntu 中，开发人员创建了一个以`.deb`（Debian，Ubuntu 所基于）结尾的包。安装 a 的基本语法`.deb`是：

```
sudo apt install <package_name> 
```

尽管这对用户来说相对简单，但开发人员创建`.deb`包和关联 PPA 需要做很多工作。

对于开发人员来说，一种更简单的方法是创建一个 tarball。然后安装的负担由最终用户分担。他们一定：

*   下载 tarball（通常以 结尾`.tar.gz`）。
*   将源代码解压到一个目录。
*   编译源代码（在 Windows for Profit 世界中闻所未闻）。
*   希望写下他们所做的事情，以防他们将来需要重复，因为没有`apt`可以备份的数据库（想想 Windows 安装的程序列表）。

正如您提出的另一个问题的另一个答案已经说明的那样，您可以同时创建一个 tarball 并压缩数据。不需要两次通过过程。

# linux - 为了使用 LAMP 部署网站，我应该学习多少 Linux？

> ID：295861
> 
> 赞同：18
> 
> 时间：2008-11-17T15:25:54.447
> 
> 标签：linux, lamp, system-administration

作为一名 Windows 开发人员，我目前正在使用 LAMP 开发自己的项目。我了解我需要了解的有关 PHP 和 MySQL 的知识，但是 Linux 看起来很大，并且不清楚从哪里开始以及考虑到我的目标，什么就足够了。我的目标是掌握一般概念，能够将项目部署到托管服务提供商，并能够监控站点的性能，以便发现问题、加载问题等。

我知道，最好的解决方案是让 Linux 管理员来做这件事，但在我做这件事之前，我需要自己做。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-17T16:28:52.947

80% 的问题是权限问题。Windows 以不同的方式处理它们；如果您以 root 身份登录（或使用类似 root 的权限），您可以绕过权限。阿帕奇不能也不会。

*   了解如何正确设置文件和目录的所有权。任何 Unix 书籍都会涉及到这一点：一定要真正理解它——这不是 Windows 安全拼写不同——这是一种不同的安全模型。

在剩下的问题中，80% 将是 PATH 问题。PHP 没有 Java 和 Python 那样大的 PATH 问题，但它们都使用 PATH 设置来查找组件和库。你会经常出错。Windows 有一个 PATH，但它也有一个注册表，使事情变得超级简单或超级秘密。Unix 没有任何秘密。

*   了解 PHP 和 MySQL 使用哪些环境变量。确保你知道它们在哪里以及如何设置。Apache 运行在它自己特有的环境中，它有命令通过`mod_php`. 编写简短`echo $PATH`的 shell 脚本来揭示正在发生的事情。

在剩下的问题中，80% 与数据库有关。在整理出数据库权限之后，您仍然需要连接，并且“命名管道”与“本地主机”的内容将以晦涩难懂的方式出错。MySQL 非常宽容，但你会在这里犯一些错误。

*   尝试每种替代连接，了解它们的工作原理。不要选择一个，因为它类似于 Windows，或者“更简单”。实际锻炼每一个。如何将用户名和密码从 Web 应用程序传递到数据库服务器也很重要。Apache 以“nobody”身份运行——您不想让他们默认访问任何内容。您的应用程序应有意连接到数据库而不使用默认值。

在剩下的问题中，80% 将是 Apache 配置。Apache 非常简单，但有一百万种选择。有四种方法可以做任何事情，你总是会尝试两种根本不起作用的方法，而选择第三种方法会很糟糕。第四个更简单，你永远不会想到。

*   阅读很多关于 Apache 配置的内容。httpd.apache.org[站点](http://httpd.apache.org/)有很多信息。力求简单。复制现有示例并使用它们。不要根据 IIS 体验或 Windows 桌面体验来编造要求或期望的实现。复制一些有效的东西。

在剩下的问题中，80% 将是文件系统的应用程序使用。如果您尝试打开、读取或写入本地文件，您会发现 (a) 您尝试使用的目录的权限不正确 [见上文] 并且 (b) Unix 文件路径不同。没有太大的不同，但有足够的不同，有些东西会以一种模糊的方式打破。

*   Unix/Linux 书籍中的每一本编程书籍都涵盖了这一点。它与 Windows 并没有太大的不同，只是足以让你第一次绊倒。编写类似“hello world”的 PHP 页面，以实现最简单的上传或下载版本，以确保您已准备好所有部分。然后修复您的完整应用程序以正确执行此操作。

在剩下的问题中，80% 将是子进程创建。Windows 以不同的方式执行此操作。Unix 中最重要的事情之一是记住您的子进程是您的孩子，您必须真正等待它完成，以便操作系统可以清理。如果您将子进程视为并行的“即发即弃”的事情，那么您将拥有僵尸进程并被迫定期重新启动。

*   编写非常简单的 PHP 页面来秒杀子进程管理。黄金法则是管理你的孩子并清理他们。然后修复您的完整应用程序以正确执行此操作。

剩下的问题将是微不足道的应用程序逻辑，但由于平台差异，在你追查 PHP 应用程序中的错误之前，你会责怪 Unix。

*   让你的[单元测试](http://phpunit.sourceforge.net/)和你的[日志](http://www.devshed.com/c/a/PHP/Logging-With-PHP/)保持一致，这样你就可以有效地调试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-17T15:30:12.143

在我的脑海中，你需要：

1.  了解文件系统的方法。
2.  了解如何启动/停止您正在使用的进程（服务）。
3.  查找或学习基本的文本编辑器（[Vim](https://en.wikipedia.org/wiki/Vim_%28text_editor%29)、[JOE](https://en.wikipedia.org/wiki/Joe%27s_Own_Editor)或[Pico](https://en.wikipedia.org/wiki/Pico_(text_editor))）
4.  学习检查进程以查看事情是否正在运行（[ps](https://en.wikipedia.org/wiki/Ps_(Unix)) , [top](https://en.wikipedia.org/wiki/Top_(software))）
5.  如果您正在维护服务器，则需要学习如何安装软件包。

这些只是基础。下一步是意识到何时遇到问题并知道可以去哪里找到有关它的更多信息。即使有了这一切，它也只是表面上的东西，很多事情可能没有意义。不过，这是一个好的开始。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T21:12:27.680

[当我被要求将一个相当复杂的 Intranet 站点从IIS](https://en.wikipedia.org/wiki/Internet_Information_Services) /Windows 移植到[Apache](https://en.wikipedia.org/wiki/Apache_HTTP_Server) /Linux时，我已经在 Windows 和 Mac 上做 PHP/MySQL 几年了。我对 Linux 和没有任何操作系统的空白服务器的经验为零。大约两天后，我和另一位几乎没有 Linux 经验的 Windows 管理员安装了[CentOS](https://en.wikipedia.org/wiki/CentOS)副本并运行 PHP/MySQL/Apache 以及 Intranet。

我学到的经验教训：安装服务时，[YUM是你最好的朋友，配置服务时，](https://en.wikipedia.org/wiki/Yum_(software)) [sudo](https://en.wikipedia.org/wiki/Sudo)是你最好的朋友（权限可能很麻烦），几乎所有其他问题都是由区分大小写或斜杠反斜杠问题引起的。

事实证明，我们确实在 FTP 访问上稍微搞砸了安全性，但这是在防火墙 ( [DMZ](https://en.wikipedia.org/wiki/DMZ_%28computing%29) ) 后面，所以在他们进行真正的安全审计并加强安全之前，没有造成任何损害。

最终答案：如果你愿意卷起袖子弄脏你的命令行，那么在 Linux 机器上启动并运行一个基本的网站并不是一项艰巨的任务，直到你获得安全性（IMO）最好留给那些该领域的专家。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T15:29:31.397

根据您的介绍，您可能会考虑使用[WAMP](https://en.wikipedia.org/wiki/LAMP_(software_bundle)#Variants)选项（Windows Apache MySQL Python、Perl 和 PHP）。

学习 Linux 并不*难*，但它肯定也不是一项短期任务。有很多系统管理任务在平台之间进行，但您问题的真正答案是至少成为一名爱好者 Linux 管理员，然后从那里开始。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T15:36:54.440

我会学习[vi](https://en.wikipedia.org/wiki/Vi)和[Bash](https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29)。*vi*是轻量级的，并且倾向于安装在任何地方。在您习惯之前可能会很痛苦，但如果您想了解 Linux，它几乎总是可用的，并且您将非常需要一个文本编辑器。我也会学习 Bash，因为它往往是默认的 shell。

vfilby 的建议很好。

绝对要为您选择的任何 Linux 学习包管理器。我会花一些时间在[Apache](https://en.wikipedia.org/wiki/Apache_HTTP_Server)上，因为它有点像怪物，因为它有*很多*配置选项。

我试图让我的 Linux 测试平台远离公共 Internet，因为我知道我不是一个足够好的系统管理员来保证它的安全。至少把它放在防火墙后面。很容易找到 iptables 脚本来阻止一切进入，因此您可能需要查看 iptables 以获得一些良好的防火墙/地址/端口操作。

祝你好运！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T16:26:24.900

首先，您应该决定是使用 GUI 工具（[GNOME](https://en.wikipedia.org/wiki/GNOME)或[KDE](https://en.wikipedia.org/wiki/KDE_Software_Compilation)）来管理系统，还是主要使用命令行从 SSH 访问。（这通常是基于服务器所在位置的决定）。学习一点 GUI 和 CLI 会有很长的路要走。CLI 超级强大，比 Windows 上的命令提示符要强大得多（我知道[PowerShell](https://en.wikipedia.org/wiki/Windows_PowerShell) ......）

[从 GUI 的角度来看，从Debian](https://en.wikipedia.org/wiki/Debian) / [Ubuntu](https://en.wikipedia.org/wiki/Ubuntu_%28operating_system%29)的角度来看，我通常会运行终端 (CLI) ：

1.  启动/停止进程：`sudo /etc/init.d/apache stop`或`sudo /etc/init.d/apache start`
2.  文本编辑器：[gedit](https://en.wikipedia.org/wiki/Gedit) (GUI - GNOME)、[Kate](https://en.wikipedia.org/wiki/Kate_%28text_editor%29) (GUI - KDE)、[Vim](https://en.wikipedia.org/wiki/Vim_%28text_editor%29) (CLI) 或[nano](https://en.wikipedia.org/wiki/GNU_nano) (CLI)
3.  正在运行的进程：`ps -aux`
4.  终止进程`sudo kill -s TERM <process_id>`
5.  添加一个包：`sudo apt-get install php5-cli`
6.  升级/修补系统：`sudo apt-get update && sudo apt-get upgrade`

这里有很多信息和多种选择。我建议使用具有友好社区的 Linux 发行版（即 Ubuntu、[CentOS](https://en.wikipedia.org/wiki/CentOS)（去品牌/免费[Red Hat Linux](https://en.wikipedia.org/wiki/Red_Hat_Linux) (RHEL)）或 RHEL（你付钱给他们帮助你）。

周末在家里/工作的虚拟机或备用机器上玩弄一个发行版肯定会有很多价值。Linux 社区非常*庞大*，如果您寻找它，您会找到极好的支持。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-17T18:08:51.700

你应该

*   学习[Bash](https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29) shell（尤其是`$PATH`和[`history`](https://en.wikipedia.org/wiki/History_(command))）
*   基本命令（`cd`、[`ls`](https://linux.die.net/man/1/ls)、[`rm`](https://en.wikipedia.org/wiki/Rm_(Unix))、[`tail`](https://en.wikipedia.org/wiki/Tail_(Unix))、[`kill`](https://en.wikipedia.org/wiki/Kill_(command))、[`ps`](https://en.wikipedia.org/wiki/Ps_(Unix))和[`top`](https://en.wikipedia.org/wiki/Top_(software))）
*   了解[`/proc`](https://en.wikipedia.org/wiki/Procfs)及其主要用途
*   学习一个编辑器（总是安装[vi 。如果你愿意，你也可以学习](https://en.wikipedia.org/wiki/Vi)[Emacs](https://en.wikipedia.org/wiki/Emacs)）
*   基本的[sed](https://en.wikipedia.org/wiki/Sed)替换 ( `sed s,orig,repl,g`) 和一点[AWK](https://en.wikipedia.org/wiki/AWK)
*   如何使用[`iptables`](https://en.wikipedia.org/wiki/Iptables)，[`netstat`](https://en.wikipedia.org/wiki/Netstat)以及[`traceroute`](https://en.wikipedia.org/wiki/Traceroute)
*   如何获取信息 ( [`man`](https://en.wikipedia.org/wiki/Man_page),`info`和`--help`)
*   如何安装软件包（`pacman -S <name>`对于[Arch Linux](https://en.wikipedia.org/wiki/Arch_Linux)，`apt-get install <name>`对于基于[Debian](https://en.wikipedia.org/wiki/Debian)），删除和更新您的系统。
*   了解如何在您的发行版中启动/停止服务 ( `/etc/init.d`, `/etc/rc.d`)
*   一般而言，Unix 文件系统是如何工作的（[inode](https://en.wikipedia.org/wiki/Inode)。什么是`quota`？）。例如，理解[`/etc/fstab`](https://en.wikipedia.org/wiki/Fstab)。了解[`df`](https://en.wikipedia.org/wiki/Df_(Unix)).
*   了解如何管理用户和组（[`useradd`](https://linux.die.net/man/8/useradd)和[`groupadd`](https://linux.die.net/man/8/groupadd)）。了解和的`/etc/passwd`格式`/etc/group`
*   你在哪里寻找[Apache](https://en.wikipedia.org/wiki/Apache_HTTP_Server)和[`syslog`](https://en.wikipedia.org/wiki/Syslog)守护进程的日志文件。
*   了解一些低级的东西，比如[`dmesg`](https://en.wikipedia.org/wiki/Dmesg)和[`hdparm`](https://en.wikipedia.org/wiki/Hdparm)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-17T19:55:39.487

大多数情况下，您应该知道如何使用 Linux（如日常使用）。然后，您还应该知道如何处理命令行。

最后，你必须学习[LAMP](https://en.wikipedia.org/wiki/LAMP_%28software_bundle%29)特定的东西。您应该了解并应用一些基本（或不那么基本）的安全准则。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-17T20:41:49.737

坦率地说，如果您要处理的网站非常小或非常大，那么很少。

非常小意味着共享主机，您无需费力。非常大意味着您可能需要一名系统管理员来处理它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-17T21:43:40.830

*   收藏或下载[GNU coreutils 手册](http://www.gnu.org/software/coreutils/manual/)并定期阅读

*   学习[Vim](https://en.wikipedia.org/wiki/Vim_%28text_editor%29)。一个好的开始是`vimtutor`在外壳上。

*   学习如何使用安全机制；不要只是禁用它们。Windows 的安全性松懈，因为它的可用应用程序期望它以这种方式（否则会中断）。在类 Unix 环境中，应用程序总是被迫运行，默认情况下安全性可能很严格。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-11-17T16:36:07.907

[在Craigslist](https://en.wikipedia.org/wiki/Craigslist)上找到一个旧盒子并在上面安装[Gentoo Linux](https://en.wikipedia.org/wiki/Gentoo_Linux)。那...经验...应该让您对 Linux 及其思考方式有很多感觉。

此外，在*[vi](https://en.wikipedia.org/wiki/Vi) vs. [Emacs](https://en.wikipedia.org/wiki/Emacs)*的情况下，我统治*Emacs*。（尽管您会想从[Pico](https://en.wikipedia.org/wiki/Pico_(text_editor)) / [nano](https://en.wikipedia.org/wiki/GNU_nano)开始，因为在学习新操作系统的同时学习全功能编辑器是没有意义的）。

# .net - 用逗号格式化数字，但保留小数

> ID：295877
> 
> 赞同：15
> 
> 时间：2008-11-17T15:30:24.250
> 
> 标签：.net, string, formatting

我想将数字组合成千位，但也输出小数位数实际上是数字。我无法弄清楚格式字符串。

```
 1000 => 1,000
 100000 => 100,000
 123.456 => 123.456
 100000.21 => 100,000.21
 100200.123456 => 100,200.123456 
```

免责声明（它并不像您想象的那么简单）：

*   请不要向我指出[这个问题](https://stackoverflow.com/questions/105770/net-stringformat-to-add-commas-in-thousands-place-for-a-number)，它不能回答我的问题
*   请不要将我指向[MS](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx) [DN](http://msdn.microsoft.com/en-us/library/0c899ak8.aspx#)，这些文章对我没有帮助。（如果您认为我读错了，请自己阅读并发布正确答案）
*   `.ToString("n")`不起作用，它会将数字四舍五入

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-17T15:38:52.860

这似乎完全符合您的要求：

```
public void Code(params string[] args)
{
    Print(1000);
    Print(100000);
    Print(123.456);
    Print(100000.21 );
    Print(100200.123456);
}

void Print(double n)
{
    Console.WriteLine("{0:###,###.#######}", n);
}

1,000
100,000
123.456
100,000.21
100,200.123456 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-24T17:07:47.210

一个旧线程，但没有一个答案让我完全满意。他们中的大多数将零变成空字符串，包括投票最多的字符串。

我认为更好的解决方案是`"#,##0.#################"`，它至少显示零。不过还是很丑。肯定有更好的办法。

```
double[] vals = new double[] { 0.0, 0.1234, -0.1234, 1.0, 
                               123456789.123456, 123456789.0, 
                               0.123456789123456 };
foreach (double val in vals) 
{ 
    Console.WriteLine(val + ": " + val.ToString("#,##0.#################")); 
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T15:42:04.537

尝试简单地使用“#,#”，这会为数千等添加逗号，但我不知道它是否会保留小数，否则“#,###.########### #########”，或小数点后所需的任意数量的“#”符号。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T15:37:27.823

试试这个：

VB：

```
Dim vals() As Double = {1000, 100000, 123.456, 100000.21, 100200.123456}
For Each val As Double in vals
   Console.WriteLine(val.ToString("###,###.#########"))
Next val 
```

C＃：

```
double[] vals = new double[] {1000, 100000, 123.456, 100000.21, 100200.123456};
foreach (double val in vals)
{
    Console.WriteLine(val.ToString("###,###.#########"));
} 
```

问题是没有格式可以处理任意数量的小数。但是，由于您只能*存储*非常有限的精度，因此您可以使用它并根据需要添加更多 # 字符来覆盖它，假设您愿意让它切断任何无关紧要的 0。

您发布的 MSDN 链接正是您阅读如何执行此操作的确切位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T15:42:14.430

您可以创建自定义格式字符串 .ToString("###,###.######") [自定义数字格式字符串](http://msdn.microsoft.com/en-us/library/0c899ak8.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-17T15:51:22.147

这可能有点慢，但它会做你想做的事。

```
public static string FormatNumber(double num)
{
    string s = num.ToString();
    string result = "";

    if(s.IndexOf('.') != -1)
    {
        result = s.Substring(s.IndexOf('.'));
        s = s.Substring(0, s.IndexOf('.'));
    }

    while (s.Length > 3)
    {
        result = "," + s.Substring(s.Length - 3);
        s = s.Substring(0, s.Length - 3);
    }
    if (s.Length == 0)
        return result.Substring(1);
    return s + result;
} 
```

# java - Java 批量监控

> ID：295897
> 
> 赞同：3
> 
> 时间：2008-11-17T15:36:25.500
> 
> 标签：java, frameworks, monitoring, batch-processing

我们有 50 多个 Java 批处理进程，它们在一天中的不同时间运行。它们在 Solaris 机器上运行，并通过 cron 启动。目前，我们只知道它们是成功还是失败的唯一方法是通过在每个批处理结束时生成的电子邮件。我们有一个支持团队来监控这些电子邮件。最近，我们遇到了未收到电子邮件的问题，即使批次正在运行。肯定有更好的办法。

不用重新发明轮子，有没有开源的批量监控应用？

还有一个更普遍的问题，监控批处理过程的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:50:30.823

目前是否有一些批次管理系统到位？或者作业是否通过操作系统调度程序运行？（即 Windows`Schedule Tasks`或 *nix `cron`）

[Quartz](http://www.opensymphony.com/quartz)是一个开源（Apache 许可）基于 java 的作业调度程序，它为可用于通知目的的*侦听器提供了适当的基础设施，但会涉及一些代码开发。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T16:03:32.047

我不了解开源批处理监控应用程序，但是 Spring 有一个新的子项目：提供批处理框架的 Spring-Batch。我已经在一些新项目中成功使用了它。

当您启动批处理作业时，您可以连接作业执行侦听器。在我的例子中，当作业因异常而失败时，我的执行侦听器会拦截它并将带有相关堆栈跟踪的错误电子邮件发送到众所周知的电子邮件列表。我在批处理结束时使用 Tasklet 发送电子邮件以指示正常完成。

当然，如果电子邮件子系统出现错误（并且消息没有被发送），那么所有的赌注都将被取消......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T16:10:18.803

必须有一种方法可以使用 Nagios 来查看日常任务是否已成功运行，因为它可以以多种不同的方式监视事物（从 PID 文件到存在的文本文件，到拖网日志文件等）。遗憾的是，Nagios 不在我的工作范围内，所以我不能更进一步。

# .net - System.Random 不断返回相同的值

> ID：295900
> 
> 赞同：9
> 
> 时间：2008-11-17T15:36:56.297
> 
> 标签：.net, random

我正在使用一个 System.Random 对象，该对象在整个应用程序中都使用固定种子进行实例化。我正在调用 NextDouble 方法，经过一段时间后，我得到 0.0 作为结果。

有什么补救办法吗，有其他人遇到过吗？

编辑：为了方便起见，我为整个运行设置了一个种子，设置为 1000。random.NextDouble 被调用了几十万次。它是一个优化器应用程序，可以运行几个小时，但这实际上是在执行 10-0 分钟后发生的。我最近向应用程序添加了更多随机调用。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-17T15:55:44.743

.NET 中的随机数生成器不是线程安全的。其他开发人员也注意到了相同的行为，一种解决方案如下（来自[http://blogs.msdn.com/brada/archive/2003/08/14/50226.aspx](http://blogs.msdn.com/brada/archive/2003/08/14/50226.aspx)）：

```
class ThreadSafeRandom
{
    private static Random random = new Random();

    public static int Next()
    {
       lock (random)
       {
           return random.Next();
       }
    }
}
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-17T15:42:01.573

你多久播种一次随机？它应该只在程序开始时执行一次。

一旦使用给定值播种，它将始终产生完全相同的序列。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-17T15:56:16.833

Tomas，我之前遇到过这个“错误”，我的解决方案是使 _rnd 变量模块级别：

```
Private Shared _rnd As System.Random()
Public Shared Function RandRange(ByVal low As Integer, ByVal high As Integer) As Integer
    If _rnd Is Nothing Then
        _rnd = New System.Random()
    End If
    Return rnd.Next(low, high)
End Function 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-17T16:07:46.250

其他人已经做了体面的工作来解释它并提供解决方案。

[无论如何， Erik](https://stackoverflow.com/users/16942/erik)之前已经回答了一个类似的问题，请查看：

[具有相同输出的伪随机发生器](https://stackoverflow.com/questions/239063/pseudo-random-generator-with-same-output)

您还可以在以下位置获得与该主题（随机数生成器）相关的更多问题和答案：

[Stackoverflow.com 随机数生成器](https://stackoverflow.com/questions/tagged/random-number-generator)

基因

*PS这只是为了补充接受的答案。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T15:45:02.690

看看这个[http://msdn.microsoft.com/en-us/library/system.random.aspx](http://msdn.microsoft.com/en-us/library/system.random.aspx)它应该解释为什么你得到相同的值。

# sql-server - DBO 会对服务器造成什么危害？

> ID：295910
> 
> 赞同：1
> 
> 时间：2008-11-17T15:41:23.587
> 
> 标签：sql-server, security, sql-server-2005, dbo

除了执行我在 SQL 2005 安装中禁用的 XP_CmdShell 之外，获得对我的数据库的 DBO 权限的恶意用户还能做什么：

*   到我的数据库，
*   到我的服务器？

我正在评估某人获得 DBO 以证明在应用程序中运行“最低权限”用户帐户的最坏情况安全风险。一些人声称，由于我们不使用“机密数据”，因此获得 DBO 的人的影响是微乎其微的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T15:43:54.380

他可以运行任何 XP_ sproc，因此它可能会弄乱注册表并弄乱您的整个服务器。删除/更改表等...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-17T16:12:27.097

dbo 是数据库所有者——它可能是也可能不是 sa。作为 dbo，您基本上可以自由支配*拥有的数据库*- 显然，这可能导致权限更改、表删除等。

作为 sa，您可以自由支配服务器。这包括安装新的扩展过程（或 .NET 程序集，如果您启用了 CLR），以及 dbo 可以做的所有事情（适用于所有数据库）。而且，您还可以再次[启用 xp_cmdshell](http://pentestmonkey.net/blog/resurecting-xp_cmdshell/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T15:48:23.323

网上有很多关于 SQL 注入的信息。限制您连接到 SQL 的用户的权限是一项非常重要的防御措施。

[http://en.wikipedia.org/wiki/SQL_injection](http://en.wikipedia.org/wiki/SQL_injection)

这是我几年前遇到的一个简单而可怕的例子。网站使用 URL 动态生成 SQL 语句并运行它们。我能够猜到像这样的网址

www.blah.com/.../load.aspx?itemid=1

像这样生成SQL

SELECT * FROM id=1 的项目

所以我发送了这个网址：

www.blah.com/.../load.aspx?itemid=1;删除表项

砰。

至少，如果数据库连接不是 dbo，这将失败。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T16:24:52.283

说白了，如果他拥有你的数据库，他就拥有你*的*数据库。也就是说，你可以吻别你的数据了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T16:38:25.360

> 也就是说，你可以吻别你的数据了。

但是你在磁盘*和*磁带上有备份，所以你是金子！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T19:39:08.240

是的。典型的防御是“好吧，至少他不能弄乱他的数据库之外的任何东西”（未启用 xp_CmdShell）。我，我不喜欢在我家锁着的壁橱里有一个疯狗强奸犯。但这个类比对管理层来说并不是一个很好的卖点。

# c# - 为什么此 LINQ to XML 查询不起作用（Amazon S3）

> ID：295911
> 
> 赞同：8
> 
> 时间：2008-11-17T15:41:35.397
> 
> 标签：c#, .net, linq-to-xml

鉴于此 XML ...

```
<ListBucketResult xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
 <Name>public.rpmware.com</Name>
 <Prefix></Prefix>
 <Marker></Marker>
 <MaxKeys>1000</MaxKeys>
 <IsTruncated>false</IsTruncated>
 <Contents>
  <Key>0.dir</Key>
  <LastModified>2008-06-25T16:09:49.000Z</LastModified>
  <ETag>"0ba2a466f9dfe225d7ae85277a99a976"</ETag>
  <Size>16</Size>
  <Owner>
   <ID>1234</ID>
   <DisplayName>kyle</DisplayName>
  </Owner>
  <StorageClass>STANDARD</StorageClass>
 </Contents>
 <!-- repeat similar 100x -->     
</ListBucketResult> 
```

而这个 C# 代码：

```
XDocument doc =  XDocument.Load(xmlReader);
var contents = from content in doc.Descendants("Contents") select new {Key = content.Element("Key").Value, ETag = content.Element("ETag").Value};

        foreach (var content in contents)
        {
            Console.WriteLine(content.Key);
            Console.WriteLine(content.ETag);
        } 
```

我知道 Xdoc 不是空的并且包含正确的 XML。

我还实现了一些 ScottGu 代码（[http://weblogs.asp.net/scottgu/archive/2007/08/07/using-linq-to-xml-and-how-to-build-a-custom-rss-feed -reader-with-it.aspx](http://weblogs.asp.net/scottgu/archive/2007/08/07/using-linq-to-xml-and-how-to-build-a-custom-rss-feed-reader-with-it.aspx)）作为健全性检查，它完全按预期工作。

```
XDocument doc2 = XDocument.Load(@"http://weblogs.asp.net/scottgu/rss.aspx");
        var posts = from items in doc2.Descendants("item") select new { Title = items.Element("title").Value };
        foreach (var post in posts)
        {
            Console.WriteLine(post.Title);
        } 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-17T15:47:54.527

XML 命名空间：

```
 XNamespace ns = "http://s3.amazonaws.com/doc/2006-03-01/";
    var contents = from content in doc.Descendants(ns + "Contents")
                   select new { Key = content.Element(ns + "Key").Value,
                       ETag = content.Element(ns + "ETag").Value }; 
```

# asp.net - 无法加载程序集“App_Web_kh7-x3ka”。确保在访问页面之前已编译

> ID：295919
> 
> 赞同：15
> 
> 时间：2008-11-17T15:43:27.623
> 
> 标签：asp.net

我似乎无法弄清楚我在这里做错了什么。我将我的网站发布到我的服务器，当我尝试运行它时，出现以下异常：

> 无法加载程序集“App_Web_kh7-x3ka”。确保在访问页面之前已对其进行编译。

有没有其他人遇到过这个？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-17T17:41:28.057

当您获取预编译的 aspx 页面并像未编译一样对其进行编辑时，也会发生这种情况，例如从 Live 服务器复制它并覆盖您的开发/工作版本。

在`<%@Page />`标签内的 aspx 页面的第一行，您可能会看到如下属性：

`inherits="yourPageClass, App_Web_kh7-x3ka"`.

删除“ `App_Web_XXXX`”部分并添加指向您的代码隐藏文件的 CodeFile 属性：

`CodeFile="yourPageFile.aspx.cs"`

该`<%@Page />`标签现在看起来应该类似于您从头开始创建新页面时的样子。

当您的 Asp.Net 页面被预编译以发布到生产服务器时，对后面代码的引用将替换为对具有该`App_Web_XXXX`名称的已编译 DLL 的引用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T15:54:27.477

“确保在访问页面之前对其进行编译”的快速谷歌搜索。

引导我到以下

[http://www.velocityreviews.com/forums/t301533-could-not-load-assembly-make-sure-that-it-is-compiled-before-accessing-the-page.html](http://www.velocityreviews.com/forums/t301533-could-not-load-assembly-make-sure-that-it-is-compiled-before-accessing-the-page.html)

问题可能如所述，应用程序池/网站未设置为正确的 .NET 版本

以下问题有另一种解决方案作为最后的回复 [http://forums.asp.net/t/1131537.aspx](http://forums.asp.net/t/1131537.aspx)

从查找来看，您的网络服务器似乎配置不正确，或者您指的是不存在/旧的 dll

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-20T10:34:53.033

我们最近在我们的一个预编译网站上一夜之间实现了这个问题。原来我们服务器的防病毒软件正在默默地隔离其中一个已编译的 DLL 文件。（显然我的代码类似于更新劫持者......迷人）

这个问题的原因有点离谱，但希望它在未来对其他人有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-27T00:56:07.277

如果您使用 BitBucket Source Tree（例如使用 Azure），Soruce Tree 默认不上传 .DLL 文件。你需要去 -> Source Tree>Tools>Options>Git>Global Ignore List [Edit File] Remove *.Dll line and Save file。

重建你的项目（你不需要），提交代码，推送代码！

您的网站应该开始工作...

# java - 如何中止正在运行的 JDBC 事务？

> ID：295920
> 
> 赞同：30
> 
> 时间：2008-11-17T15:43:52.927
> 
> 标签：java, jdbc

有没有办法过早中止交易？比如说，我已经向数据库发送了一个运行五分钟的命令，四分钟后，我想中止它。

JDBC 是否定义了一种向数据库发送“停止您在此连接上所做的任何事情”信号的方法？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-11-17T18:35:12.800

正如 james 所提到的，[Statement.cancel()](https://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html#cancel())将取消正在运行的 Statement（选择、更新等）的执行。JDBC 文档特别指出 Statement.cancel() 从另一个线程运行是安全的，甚至建议在超时线程中调用它。

取消语句后，您仍然需要回滚事务。这*没有*记录为从另一个线程运行是安全的。[Connection.rollback()](https://docs.oracle.com/javase/7/docs/api/java/sql/Connection.html#rollback())应该发生在执行所有其他 JDBC 调用的主线程中。您可以在取消的 Statement.execute...() 调用以 JDBCException（由于取消）完成后处理该问题。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-17T15:52:50.460

我猜你想要做的是防止你的应用程序阻塞长时间运行的查询/事务。为此，JDBC 支持查询超时的概念。您可以使用以下方法设置查询超时：

```
java.sql.Statement.setQueryTimeout(seconds) 
```

并通过回滚事务来处理方法`SQLException`抛出的问题（当然，只有当您将 autocommit 设置为 false 并且您的 JDBC 驱动程序支持 Statement.cancel() 时，这才有效）。`execute()`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-17T18:09:04.850

查看 Statement.cancel()。

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2008-11-17T15:50:23.897

不，您不能使用标准 JDBC 中止它。

您可能会尝试检查您的特定 RDBMS 是否定义了一些扩展来支持它。

# xml - 如何在 ActionScript 中动态编辑 XML 节点值？

> ID：295925
> 
> 赞同：3
> 
> 时间：2008-11-17T15:45:12.393
> 
> 标签：xml, apache-flex, actionscript

```
/* I start with this: */

<Report>
    <prop1>4</prop1> 
    <prop2>2255</prop2> 
    <prop3>true</prop3> 
    <prop4>false</prop4> 
    <prop5>true</prop5> 
</Report>

/* I want this result (change the value of node "prop5"): */

<Report>
    <prop1>4</prop1> 
    <prop2>2255</prop2> 
    <prop3>true</prop3> 
    <prop4>false</prop4> 
    <prop5>false</prop5> 
</Report>

/* I tried this: */

var reportXML:XML = 
    <Report>
        <prop1>4</prop1> 
        <prop2>2255</prop2> 
        <prop3>true</prop3> 
        <prop4>false</prop4> 
        <prop5>true</prop5> 
    </Report>;

var myArray:Array = [{xmlNodeName: "prop5", value: false}];

for each (var item:Object in myArray)
{
    report.xml[item.xmlNodeName] = item.value.toString();
}

/* But this just adds a new node, resulting in this: */

<Report>
    <prop1>4</prop1> 
    <prop2>2255</prop2> 
    <prop3>true</prop3> 
    <prop4>false</prop4> 
    <prop5>true</prop5> 
    <prop5>false</prop5> 
</Report>; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-02T05:17:31.317

这似乎正是你想要的。这只是你的代码，修正了一些错别字。

```
 var reportXML:XML = 
            <Report>
                <prop1>4</prop1> 
                <prop2>2255</prop2> 
                <prop3>true</prop3> 
                <prop4>false</prop4> 
                <prop5>true</prop5> 
            </Report>;

        var myArray:Array = [{xmlNodeName: "prop5", value: false}];

        for each (var item:Object in myArray)
        {
            reportXML[item.xmlNodeName] = item.value.toString();
        }

        trace(reportXML); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-12T11:54:02.193

创建对象后，我无法在 XML 对象中编辑元素，而且 Adob​​e 文档也不清楚这是否可能。

对于动态设置值，我创建了一个临时字符串并将我的所有 XML 节点和属性附加到此处。然后您可以简单地创建将您的临时字符串指定为唯一参数的 xml 对象。

就像是：

```
var tempString:String = "<XML_PARENT><SOME_SUB_NODE>";
tempString += "<SOMETHING_ELSE value=\"" + someTextField.text + "\"/>";
tempString += "</SOME_SUB_NODE></XML_PARENT>";

var xmlObj:XML = new XML( tempString ); 
```

现在如果你跟踪 xmlObj，你会得到

```
<XML_PARENT>
    <SOME_SUB_NODE>
        <SOMETHING_ELSE value=""/>
    </SOME_SUB_NODE>
<XML_PARENT> 
```

这将使您可以动态地将所需的任何内容分配给字符串，然后在事后构建 XML。如果您想编辑现有的 XML 对象，这并不完全有帮助，但您可以使用 toString() 并相应地修改字符串。它至少可能有助于开始动态构建 XML 文件！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T20:47:37.057

我刚刚验证了这行得通：

```
private var reportXML:XML = 
    <Report>
        <prop1>4</prop1>
        <prop2>2255</prop2>
        <prop3>true</prop3>
        <prop4>false</prop4>
        <prop5>true</prop5>
    </Report>;

private function changeXML():void {
    reportXML.prop5[0] = 'false';
    trace(reportXML.prop5);  // traces 'false'
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-15T00:32:49.467

如果你只有节点，你可以这样

```
var node:XML
inp = new textfield(style, node.text());
inp.addEventListener(TextEvent.TEXT_INPUT, change, false, 0, true);
addChild(inp);

private function change(e:TextEvent):void
 {
 XML(node.parent())[node.name()][node.childIndex()] = inp.text+e.text;
 } 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-17T15:48:04.930

在 ActionScript 3 中使用 E4X 语法，我猜想是这样的：

```
report.prop5[0] = false; 
```

# capistrano - 我怎样才能建立一个“不错的” Capistrano 部署？

> ID：295936
> 
> 赞同：2
> 
> 时间：2008-11-17T15:49:21.340
> 
> 标签：capistrano, nice

我怎样才能设置一个不错的指数`cap:deploy`？

我希望远程服务器能够`cp`像这样执行命令：

```
nice -n 19 cp ... 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T17:53:38.843

不确定**cp**。你不使用单片机吗？

我尝试了我的设置（我使用颠覆），这似乎有效。在*deploy.rb*中，添加：

```
set :scm_command, "nice -19 svn" 
```

如果您不使用 SCM，这似乎有些困难，您必须在*deploy/scm/none.rb*中重载 checkout() 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-12-11T11:43:37.600

对于那些想要`assets:precomile`完成任务的人来说，非常耗时的任务对我有用。

```
namespace :deploy do
  task :map_bins_to_nice  do
    SSHKit.config.command_map.prefix[:rake]&.unshift('nice -n 19')
  end
end

Capistrano::DSL.stages.each do |stage|
  after stage, 'deploy:map_bins_to_nice'
end 
```

请注意，这会使每个`rake`任务都变得更好。例如`rake db:migrate`。

这最初取自以下帖子（日语）。 [http://d.hatena.ne.jp/nekonokataomoi/20140819/1408443332](http://d.hatena.ne.jp/nekonokataomoi/20140819/1408443332)

# java - EMMA 不会涵盖我的一个项目

> ID：295938
> 
> 赞同：2
> 
> 时间：2008-11-17T15:49:33.057
> 
> 标签：java, ant, junit, code-coverage, emma

我对 EMMA 有一个问题，它正确地涵盖了我所有的各种 Java 项目，除了一个。我很困惑为什么会发生这种情况，因为 ANT 脚本似乎是正确的。给出以下预期输出：

```
 [echo] c:\cc_local_home\emmadata\ProjectName
[instr] processing instrumentation path ...
[instr] instrumentation path processed in 1876 ms
[instr] [84 class(es) instrumented, 0 resource(s) copied]
[instr] metadata merged into [c:\cc_local_home\data\2008-11-17_14.35.19\coverage.emma] {in 62 ms} 
```

以上是由以下 ANT 脚本生成的：

```
<target name="emma" depends="init" if="use.emma">
  <echo message="${emma.bin}" /> 
  <emma enabled="true">
    <instr instrpath="${test.bin}" destdir="${emma.bin}" metadatafile="${test.data.dir}/coverage.emma" merge="true">
      <filter excludes="*Test*,*test*" /> 
      <filter excludes="*Exception" /> 
      <filter excludes="*AppConstants" /> 
    </instr>
  </emma>
</target> 
```

运行 JUnit 测试后，将记录以下内容。

emma.report：[report] 处理输入文件 ...
[report] 1 个文件在 16 毫秒内读取和合并
[report] 无所事事：在任何数据文件中都找不到运行时覆盖率数据

并且不会生成覆盖率报告。

我确定coverage.emma 文件已正确链接，那么为什么EMMA 没有覆盖代码？

该`emma.report`任务如下所示：

```
<target name="emma.report" if="use.emma">
  <emma enabled="true">
    <report sourcepath="${test.reports.dir}"> 
      <infileset dir="${test.data.dir}" includes="*.emma" /> 
      <html outfile="${test.reports.dir}/coverage.html" /> 
    </report>
  </emma>
</target> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T16:00:29.603

`<emma.report>`元素长什么样？

您可能想查看有关此确切消息的此[常见问题解答：](http://emma.sourceforge.net/faq.html#q.report.noop)[为什么 <report></report> 说“无事可做：在任何数据文件中找不到...数据”并退出而不生成任何内容？](http://emma.sourceforge.net/faq.html#q.report.noop)

而且，与往常一样`Ant`，打开`-verbose`并仔细检查输出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T19:15:09.303

我会检查以确保 JUnit 目标正在运行检测代码，而不是运行非检测代码（不会产生任何覆盖数据）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T18:01:51.917

```
<target name="emma.report" if="use.emma">
  <emma enabled="true">
    <report sourcepath="${test.reports.dir}"> 
      <infileset dir="${test.data.dir}" includes="*.emma" /> 
      <html outfile="${test.reports.dir}/coverage.html" /> 
    </report>
  </emma>
</target> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-19T18:32:00.230

当您使用错误的命令生成报告时，您会收到此错误。大多数在线教程都在提倡错误的（可能是旧的）命令，即使我在使用以下命令生成报告时也遇到了这个错误：

{JAVA_HOME}\jre\lib\ext>java -cp emma.jar emma report -r html -in coverage.em, {ALFRESCO_HOME}\coverage.ec EMMA: 处理输入文件 ... EMMA: 1 个文件已读取并在 60 毫秒内合并 EMMA：无事可做：在任何数据文件中都找不到运行时覆盖数据

命令的正确用法是： **{JAVA_HOME}\jre\lib\ext>java -cp emma.jar emma report -r txt,html -in {JAVA_HOME}\jre\lib\ext\coverage.em -in C:\ t1_tempSetup\Alfresco\coverage.ec** EMMA：处理输入文件 ... EMMA：在 70 毫秒内读取和合并 2 个文件 EMMA：将 [txt] 报告写入 [{JAVA_HOME}\jre\lib\ext\coverage.txt ] ... EMMA：将 [html] 报告写入 [{JAVA_HOME}\jre\lib\ext\coverage\index.html]

# vim - 使用 gvim 打印差异？

> ID：295939
> 
> 赞同：6
> 
> 时间：2008-11-17T15:49:33.837
> 
> 标签：vim, vimdiff

有没有办法打印出差异，就像你用“gvim -d”打开它们时显示的那样，所有通用代码都折叠起来，只有差异在上下文中显示？我尝试了打印菜单选项，但它打印了我当前“进入”的整个文件，而不是打印折叠的差异。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T13:54:19.200

我认为没有一种方法可以并排打印正在区分的两个文件。但是，您可以对正在区分的两个文件中的每一个文件使用 Vim 的“转换为 HTML”工具，然后分别打印出来。然后，您可以将它们并排堆叠以获得相同的效果。

转换为 HTML 是一种“漂亮的打印”——它保存了所有视觉颜色/语法/折叠信息。

```
:he convert-to-HTML 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-03-28T13:26:50.657

使用 diff 和 a2ps 的组合我很幸运：

```
$ diff -y --suppress-common-lines oldfile newfile | \
  a2ps -l 130 --columns 1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-28T20:03:38.607

首先，`TOhtml`@Gowri 提到的插件能够输出一个 HTML 并显示两个文件（除非您已设置`g:html_diff_one_file`为 1）。其次，如果您对 TOhtml 的输出不满意，您可以尝试我自己的[formatvim](http://www.vim.org/scripts/script.php?script_id=3113)（在这种情况下使用的命令：（`:Format diffformat`可能被截断为`:Format d`））。它在 html 输出中具有更多功能，但我费心编写它的主要原因是您可以编写自己的输出格式规范，所有与 html 相关的东西都保存在一个地方。

# asp.net - Windows 身份验证和网络服务帐户作为 db_owner

> ID：295945
> 
> 赞同：5
> 
> 时间：2008-11-17T15:51:02.227
> 
> 标签：asp.net, sql-server, windows-authentication

那里有许多商业产品，它们为您提供基于 Windows 的安装程序，用于配置您的应用程序和后端 SQL Server DB。通常，它会询问您是否要使用 Windows 或 SQL Server 身份验证连接到数据库。他们中的大多数人建议使用 Windows Auth，然后使用分配给 db_owner 数据库角色的网络服务帐户配置您的数据库。我知道 Windows 身份验证更安全，因为您不必在 web.config 中存储凭据并在向 SQL Server 进行身份验证时通过网络发送它们，但这是生产环境的安全配置，其中网络服务帐户是数据库所有者？我们应该注意哪些具体风险？

* * *

谢谢吝啬杰克，

我听到你在说什么，不过他们必须先以网络服务用户身份登录数据库。有没有简单的方法可以做到这一点？

我真正想弄清楚的是，是否存在与分配 db_owner 角色的**默认**网络服务帐户这一事实相关的任何固有风险。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T02:34:47.790

对于很多环境来说，使用 NETWORK SERVICE 作为 db_owner 可能是可以的。

如果您想获得更高程度的安全性，只需创建一个单独的 Windows 帐户，授予它在 SQL Server 中所需的最低访问权限，然后将应用程序更改为在这个新帐户的上下文下运行。

具体风险是：

*   在 NETWORK SERVICE 环境下运行的一个编写不佳的应用程序可能允许未经授权访问 NETWORK SERVICE 有权访问的所有其他数据。您可以通过为所有应用程序创建单独的帐户来降低这种风险。
*   db_owner 的访问权限可能比应用程序真正需要的更多，这意味着如果您受到攻击，则更有可能被滥用/利用。您可以通过选择要授予的常识性特权来大大减少这种情况。但是，如果走得太远，您将获得收益递减和更多的支持头痛。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T16:04:27.583

是的，应用程序（以及它的任何用户）可能会执行 dbo 可以对数据库执行的任何操作。删除表、从密码中选择 * 等。

如果您设置了针对 SQL 注入的预防措施并使用适当的应用程序层安全性编写了您的应用程序，那么使用带有 dbo 的 Windows Auth 可能会没问题。

如果您正在处理非常敏感的数据，不信任应用程序（还），或者希望尽可能安全，那么您将必须在数据库层实现安全性。

例如，用户 x 可以访问表视图 a 和 b 以及视图 c，而用户 y 只能访问视图 c。您的应用程序必须以适当的用户身份连接才能访问正确的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T20:20:46.037

作为网络服务（域\机器$）登录到数据库将非常困难（我不知道，但一些 l33t haxor 可能会），除非您是网络盒上的服务。

没有密码，它不是交互式的，并且权限非常有限（除非“本地系统”）。

主要问题是SQL注入攻击。这些适用于与数据库服务器的任何连接。

拥有 db_owner 的额外风险是 DROP TABLE，甚至是 DROP DATABASE 类型的攻击。如果没有 db_owner，它仍然很危险，例如“SELECT * FROM usertable WHERE 1=1”攻击。

不幸的是，您无法选择商业或第三方应用程序来使用存储过程、最少权限等。

不过，您可以在安装后减少权限。

# selenium - 如何阻止 Selenium 中的 Invalid Length 警告发生？

> ID：295948
> 
> 赞同：3
> 
> 时间：2008-11-17T15:51:37.763
> 
> 标签：selenium

有时在运行 selenium 时，它会显示类似于以下内容的消息：

> 警告 - 长度无效：内容长度=798242 写入=8192

然后 Selenium 停止响应。自动化下的网站在 ASP.NET 上运行，并通过 IIS 提供服务。

如何防止 Selenium 由于任何错误而停止？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T16:03:55.413

URL 只能这么长。RFC 中定义了硬性限制。我怀疑您发出的命令会导致 URL 超出这些限制。您需要调试 Selenium 脚本并找出导致问题的原因，而不是抑制这种症状。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-25T20:23:52.737

Selenium Server 抱怨的问题是请求的页面包含 798242 字节的 Content-Length 标头，但 Selenium 仅接收到 8192 字节的数据。我发现当您的网页之一手动写入响应流而不是使用 ASP.NET 生命周期时，通常会发生这种情况。

寻找这样的代码：

```
Response.ClearContent();
string data = GetSomeData();
Response.Write(data);
Response.Flush();
Response.Close(); 
```

您需要像这样添加 Content-Length 标头：

```
Response.AddHeader("Content-Length", data.Length.ToString()); 
```

所以你的代码应该是这样的：

```
Response.ClearContent();
string data = GetSomeData();
Response.AddHeader("Content-Length", data.Length.ToString());
Response.Write(data);
Response.Flush();
Response.Close(); 
```

# business-intelligence - 什么是“商业智能”软件？

> ID：295949
> 
> 赞同：34
> 
> 时间：2008-11-17T15:51:47.000
> 
> 标签：business-intelligence, buzzword-compliance

[“商业智能”](http://en.wikipedia.org/wiki/Business_intelligence)是一个对软件开发人员没有真正意义的流行词，还是该术语在软件做什么或软件如何做（一般意义上）方面具有某种隐含意义？它似乎是一个真正的商业术语，但它对执行商业智能任务的软件有什么特别的意义吗？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-11-17T16:12:09.017

BI != 报告。BI 平台使用户能够构建帮助组织学习和了解其业务的应用程序。[Gartner 将](http://web.archive.org/web/20081216003746/http://mediaproducts.gartner.com/reprints/microsoft/vol7/article3/article3.html)BI 平台定义为提供以下 12 项功能的软件平台：

> **一体化**
> 
> *   **BI 基础架构**——平台中的所有工具都应该使用相同的安全性、元数据、管理、门户集成、对象模型和查询引擎，并且应该共享相同的外观和感觉。
> *   **元数据管理**——这可以说是 12 项功能中最重要的一项。不仅所有工具都应该利用相同的元数据，而且产品应该提供一种强大的方法来搜索、捕获、存储、重用和发布元数据对象，例如维度、层次结构、度量、性能指标和报告布局对象。
> *   **开发**——BI 平台应该提供一套程序化的开发工具——连同用于创建 BI 应用程序的软件开发工具包——可以集成到业务流程中，和/或嵌入到另一个应用程序中。BI 平台还应该使开发人员能够通过使用类似向导的组件进行图形化组装过程来构建 BI 应用程序而无需编码。开发环境还应支持 Web 服务执行常见任务，例如调度、交付、管理和管理。
> *   **工作流和协作**——此功能使 BI 用户能够通过公共文件夹和讨论线程共享和讨论信息。此外，BI 应用程序可以根据预定义的业务规则分配和跟踪分配给特定用户的事件或任务。通常，此功能是通过与单独的门户或工作流工具集成来提供的。
> 
> **信息传递**
> 
> *   **报告**——报告提供了创建格式化和交互式报告的能力，具有高度可扩展的分发和调度功能。此外，BI 平台供应商应处理各种报告样式（例如，财务、运营和绩效仪表板）。
> *   **仪表板**——报告的这个子集包括发布正式的、基于 Web 的报告的能力，这些报告具有直观的信息显示，包括刻度盘、仪表和交通灯。这些显示指示性能指标的状态，与目标或目标值进行比较。仪表板越来越多地用于传播来自运营应用程序的实时数据。
> *   **即席查询**——此功能也称为自助服务报告，使用户能够就数据提出自己的问题，而无需依赖 IT 创建报告。特别是，这些工具必须具有强大的语义层，以允许用户导航可用的数据源。此外，这些工具应提供查询治理和审计功能，以确保查询执行良好。
> *   **Microsoft Office 集成**——在某些情况下，BI 平台用作管理、保护和执行 BI 任务的中间层，但 Microsoft Office（尤其是 Excel）充当 BI 客户端。在这些情况下，BI 供应商提供与 Microsoft Office 的集成至关重要，包括对文档格式、公式、数据“刷新”和数据透视表的支持。高级集成包括单元锁定和回写。
> 
> **分析**
> 
> *   **OLAP——**这使最终用户能够以极快的查询和计算性能分析数据，从而实现一种称为“切片和切块”的分析风格。这种能力可以跨越各种存储架构，例如关系型、多维型和内存型。
> *   **高级可视化**——这提供了通过使用交互式图片和图表而不是行和列更有效地显示数据的许多方面的能力。随着时间的推移，高级可视化将不仅仅是对数据进行切片和切块，还包括更多流程驱动的 BI 项目，让所有利益相关者通过可视化表示更好地理解工作流。
> *   **预测建模和数据挖掘**——这种能力使组织能够使用先进的数学技术对分类变量进行分类并估计连续变量。
> *   **记分卡**——这些将仪表板中显示的指标应用到战略地图中，使关键绩效指标与战略目标保持一致，从而使仪表板中显示的指标更进一步。记分卡指标应与相关报告和信息相关联，以便进行进一步分析。记分卡意味着使用绩效管理方法，例如六西格码或平衡记分卡框架。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-18T16:36:28.637

## 定义

**[商业智能 (BI)](http://en.wikipedia.org/wiki/Business_intelligence)**是指用于帮助企业更好地了解其商业环境的技能、技术、应用程序和实践。商业智能也可能指收集到的信息本身。

BI 技术提供业务运营的历史、当前和预测视图。商业智能技术的常见功能是报告、OLAP、分析、数据挖掘、业务绩效管理、基准、文本挖掘和预测分析。

商业智能通常旨在支持更好的商业决策。因此，BI 系统可以称为决策支持系统 (DSS)。

## 个人经验

[在过去在BI 软件产品](http://www.swgreenhouse.com/Productos/Hi-Spins/Hispins.html)中工作了 7 年之后，我不认为这是一个空洞的流行语。去超市，问他们怎么知道店里放了多少奶酪；他们把它放在哪里；以及哪些品牌。去找一家香肠生产商：他们让我们的产品分析销售基于很多变量，例如，他们在超市获得了哪种展示：普通、更相关、难以发现。 *他们*决定了哪些变量与他们相关，因此应该进行分析。去包裹寄送公司询问他们推广哪些服务以及为什么。他们都分析所有数据，并为此使用软件。当然，您需要大脑和软件；但是，唉，你需要软件和大脑。

是的，这可能是一个广泛而开放的术语。但这不是一个空话。

更实际地说，任何支付 7 年账单的东西都不是空的 :-)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-17T16:01:01.693

我只能代表 Cognos，它是一种报告工具，已被添加到如此多的内容中，以至于他们将其称为“BI 套件”。我认为大多数 BI 工具都是相同的。

如果您看到标有“BI 工具”的产品，预计它会高度集中在报告上（这是 BI 中最明显的部分）。您必须自己创建数据仓库，然后您将使用 BI 工具对您的多维数据集进行建模，以最好地表示用户希望从您的 DW 中获得的数据。最后，您将使用该工具创建报告，尽管您的用户可以使用您创建的报告之外的功能查看多维数据集中的数据。

此外，您可以添加业务对象、Crystal 报表、任何这些报表工具，因为实际上，BI == Reporting。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-17T16:00:57.450

您可以编写一个“商业智能”软件——但它相当复杂。通过分析数据并提出建议，此类软件将充当某种管理者。考虑一个拥有 MBA 学位的项目。关键是，要真正编写这样的程序，不仅需要构建分析工具以让应用程序自动扫描信息以查找业务模式，而且还需要为程序提供大多数成功的业务经理所拥有的“直觉”。基于严格规则运行的程序不一定会做出最好的决定，只会做出最好的记录决定。

一家公司（这是商业智能的实际应用示例）联系了我，该公司想要一个应用程序来监控某些市场类别的趋势，并使用这些趋势来预测其产品的最佳价格。他们销售的奢侈品价格全年波动，并根据各种经济指标。他们的大多数经理都可以进行这种定价，并且他们希望将其自动化。执行此操作所需的分析将涉及高级统计数据，一些人工智能来解释它，更不用说自行获取所需数据的能力了。该项目的初始预算为 200 万美元。不适合轻松愉快的人。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-18T03:41:29.330

商业智能是将现有的 OLTP 数据库非规范化为衡量标准的系统。商业智能系统最重要的要求之一是报告的数据以极快的速度输出。事务型 OLTP 数据库系统会阻塞 OLAP（用于 BI 报告的数据库类型）数据库通常以极快的速度执行的查询。当我谈到速度时，根据我的经验，任何花费超过 5 秒的查询都表明需要以更好的方式重构架构。在事务环境中，使用的数据库语言是 TSQL。在 OLAP 世界中，统一语言被称为 MDX，多维扩展，实际上是 SQL 语言的扩展。在 Microsoft 堆栈和 VS 2005 中，分析服务以及 MS SQL Server 都与 CLR 相得益彰。可以直接在 Visual Studio 的 IDE 中创建和维护应用程序。从 VS 中挂钩到 SSIS 对象并创建可以与 SQL Server 集成的 ETL 处理层的能力，并拥有经过清理的数据仓库，其源成为 Analysis Services 数据库的数据源，这无疑向我表明，开发人员获得了大量的控制权使用 MS Stack 创建解决方案时的输入和输出。无论如何，这是我的看法。从 VS 中挂钩到 SSIS 对象并创建可以与 SQL Server 集成的 ETL 处理层的能力，并拥有经过清理的数据仓库，其源成为 Analysis Services 数据库的数据源，这无疑向我表明，开发人员获得了大量的控制权使用 MS Stack 创建解决方案时的输入和输出。无论如何，这是我的看法。从 VS 中挂钩到 SSIS 对象并创建可以与 SQL Server 集成的 ETL 处理层的能力，并拥有经过清理的数据仓库，其源成为 Analysis Services 数据库的数据源，这无疑向我表明，开发人员获得了大量的控制权使用 MS Stack 创建解决方案时的输入和输出。无论如何，这是我的看法。

根据经验，Business Objects、Oracle 和较小程度的 Cognos 被迫收购以增强其 BI 产品，因为 Business Objects 更像是一个报告消费者，而不是数据库和报告消费者公司。在我看来，当 Cognos 从 Applix 购买了一个名为 TM1 的额外规划 OLAP 数据库时，Cognos 进行了更明智的收购，并且随之获得了业务中最好的自助服务 OLAP 报告工具之一，名为 Executive Viewer，它可以针对 Oracle 的 Essbase、TM1 进行报告， Cognos 可能到目前为止，Analysis Services，SAP BW，据我所知，HP 没有 BI 产品。但是，当我上次查看时，他们正在使用Executive Viewer。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-17T16:04:15.867

实际上，它是描述一组产品的流行词，例如 Business Objects、SAS BI，以及 Oracle 和 HP 等常见嫌疑人的一些产品。

大多数情况下，这些都是“漂亮的打印”报告，将前端写入数据仓库风格的数据库，并且，最好的通用描述可能是数据仓库架构中的表示层。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-18T16:33:32.647

商业智能 (BI) 代表在公司战略规划过程中发挥关键作用的工具和系统。这些系统允许公司收集、存储、访问和分析公司数据，以帮助做出决策。通常，这些系统将说明客户分析、客户支持、市场研究、市场细分、产品盈利能力、统计分析以及库存和分销分析等领域的商业智能。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-01-04T19:33:09.173

根据数据仓库研究所 (TDWI) 的说法，BI 是“将数据转化为信息、将信息转化为知识以及将知识转化为推动盈利业务行动的计划所需的流程、技术和工具”。

恕我直言，BI 确实有其含义，它不仅仅是一个流行词，对于通过 BI 从其数据资产中获得真正价值的业务人员来说尤其如此。

BI 不仅仅是报告和数据分析的前端工具，它是技术、流程和人员的总和，因此，它不仅仅是一个技术问题，即使它包含一个真实的（通常是困难的）技术方面。[链接文本](http://www.tdwi.org/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-01-04T20:53:23.380

给出更长的答案似乎使它听起来充满了风，所以：

商业智能：具有强大附加功能的报告软件，专注于基于历史数据的未来预测。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-18T16:29:15.970

新一代 BI 变得更加面向交互。借助 Flash 和其他 web 2.0、复杂但易于使用的仪表板，可视化像以前的报告一样在 web 上提供。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-05-24T02:58:02.230

我认为 BI 的最佳定义是它使您能够轻松地询问系统的假设问题。提供固定信息就是报告。提供实时信息的是仪表板。提供交互式答案是 BI

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-11-17T15:59:02.943

商业智能是关于理解一个人的业务。这是关于了解敌人的军事情报的奇怪对话。它为西装提供做出商业决策的信息。

对于开发人员来说，它是一种可以开发的软件。开发人员不会使用那么多。

# c# - 基于类型的 C# 观察者？

> ID：295952
> 
> 赞同：3
> 
> 时间：2008-11-17T15:54:12.843
> 
> 标签：c#, design-patterns, generics, observer-pattern

假设我想根据类型创建一组观察者。也就是说，当他们被通知一个事件时，他们被告知其中一个参数的类型，然后根据它是否可以对该类型进行操作来决定是否采取行动。

有什么简单的方法可以做到这一点吗？我认为这对泛型来说相当简单，但这似乎比我想象的要难。如果可以避免的话，我宁愿不必处理对对象的一堆引用。

我陷入困境的地方是这样做：

```
public delegate void NotifyDelegate<T>(IEnumerator<T> loadable, NotifyArgs na);

interface IObserver
{
    void Notify<T>(IEnumerator<T> loadable, NotifyArgs na);
}

class Subject
{
    NotifyDelegate notifier;  //won't compile:  needs type args

    void Register(IObserver o)
    {
        notifier += o.Notify;
    }
} 
```

当然，我也可以将 Subject 设为通用，但是我必须为每种类型设置一个单独的 Subject。有人在这里有什么建议吗？是否有一些我在某处遗漏的功能，或者我是否过于复杂？

**更新**：我确实过度简化了 Notify 和 NotifyDelegate 采用的论点。而不是这个：

```
public delegate void NotifyDelegate<T>(NotifyArgs na); 
```

我实际上想做这样的事情：

```
public delegate void NotifyDelegate<T>(IEnumerator<T> loadable, NotifyArgs na); 
```

我基本上试图来回传递的是来自数据库的数据。抱歉，如果前面的代码示例让任何人感到困惑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T16:11:35.867

首先，将您拥有的代码更改为以下内容：

```
interface IObserver
{
}

class Subject
{
  public Subject ()
  {
    m_observers = new List<IObserver> ();
  }

  public void Register (IObserver o)
  {
    m_observers.Add (o);
  }

  List<IObserver>
    m_observers;
} 
```

然后，使用反射根据参数类型找到合适的函数：

```
 public void NotifyObservers (object param)
  {
    foreach (IObserver observer in m_observers)
    {
      foreach (MethodInfo method in observer.GetType ().GetMethods (BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.FlattenHierarchy | BindingFlags.Instance))
      {
        if (method.Name == "Notify")
        {
          ParameterInfo []
            parameters = method.GetParameters ();

          if (parameters.Length == 1 && parameters [0].ParameterType == param.GetType ())
          {
            method.Invoke (observer, new object [] { param });
            break;
          }
        }
      }
    }
  } 
```

并像这样使用它：

```
class Observer : IObserver
{
  public Observer (Subject s)
  {
    s.Register (this);
  }

  void Notify (float value)
  {
    System.Diagnostics.Trace.WriteLine ("float value = " + value);
  }

  void Notify (int value)
  {
    System.Diagnostics.Trace.WriteLine ("int value = " + value);
  }
}

static void Main (string [] args)
{
  Subject
    s = new Subject ();

  Observer
    o = new Observer (s);

  float
    v1 = 3.14f;

  int
    v2 = 42;

  System.Diagnostics.Trace.WriteLine ("sending float");
  s.NotifyObservers (v1);
  System.Diagnostics.Trace.WriteLine ("sending int");
  s.NotifyObservers (v2);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T19:00:35.153

```
interface IObserver
{
    void Notify(NotifyArgs na);
    bool SupportsType(Type t);
}

class Subject
{
    List<IObserver> observers;

    void Register(IObserver o)
    { observers.Add(o);
    }

   void OnNotify(Type t, NotifyArgs args)
    {
      foreach (IObserver o in observers)  
      {
        if (o.SupportsType(t)) o.Notify(args));
      }
    }
} 
```

# java - JEdi t 宏 - 打开和保存文件

> ID：295956
> 
> 赞同：1
> 
> 时间：2008-11-17T15:56:07.223
> 
> 标签：java, macros, jedit, beanshell

我有一个 JEdit (BeanShell) 宏，它打开一个特定文件，然后立即将文件保存到我的 c:\temp 文件夹中（这样我就不会意外更新真实文件）。

这是豆壳代码：

```
logFilePath = "c:\\temp\\aj.txt";
jEdit.openFile( view , logFilePath );
_buffer = jEdit.getBuffer(logFilePath);
_buffer.save(view,"c:\\temp\\backup.txt",true); 
```

这给了我以下错误：

```
I/O Error
Each buffer can only execute one input/output operation at a time.  
Please wait until the current operation finishes 
(or abort it in the I/O progress monitor) before starting another one. 
```

我尝试添加一个while循环来等待，直到 `buffer.isLoaded()` 它是真的，但这只是进入一个无限循环。
似乎起作用的是弹出一个消息框（ `Macros.message` ）。但是，我真的不想进行这种不必要的对话。

我不太了解java，所以如果我犯了菜鸟错误，请告诉我。

## 更新：

添加了我自己的答案以显示[Serhii 的答案](https://stackoverflow.com/users/34009/serhii)指向的代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T18:04:15.530

你可以试试[这个解决方案](http://community.jedit.org/?q=node/view/4026)，打电话`VFSManager.waitForRequests();`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T09:54:02.167

### 这个作品

这是上面[Serhii 的答案](https://stackoverflow.com/questions/295956/jedit-macro-open-and-save-file#296361)所指向的代码。

`VFSManager.waitForRequests();` 在 `jEdit.openFile()` 命令后添加。

### 完整代码

```
logFilePath = "c:\\temp\\aj.txt";
jEdit.openFile( view , logFilePath );

VFSManager.waitForRequests();

/* 
    VFSManager.waitForRequests();

    jEdit waits then for the file to be completely loaded before continuing 
    ... It's designed for waiting on all 'pending I/O requests'".
*/

_buffer = jEdit.getBuffer(logFilePath);
_buffer.save(view,"c:\\temp\\backup.txt",true); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-27T16:38:14.880

你也可以不那么大胆。

1.  使用jEdit.openFile()的返回值，这已经是Buffer，不需要getBuffer()
2.  不要调用等待所有请求完成的 VFSManager.waitForRequests()，而只需将 BufferListener 添加到从 jEdit.openFile() 获得的 Buffer 中，然后在此侦听器的 bufferLoaded 方法中进行保存调用:-)

# visual-studio - 在 CompositeControl 上使用 ScriptManager 添加脚本？

> ID：295963
> 
> 赞同：1
> 
> 时间：2008-11-17T15:57:40.123
> 
> 标签：visual-studio, scriptmanager, composite-controls

我试图在友好的“ScriptManager”类上调用我的旧“RegisterClientScriptBlock”。

它对我的 CompositeControl 不起作用？我在正常的用户控件（ascx）上使用它。

如果我这样做并尝试编译，Visual Studio 根本不会接受我输入“ScriptManager”，或者我得到“当前上下文中不存在名称 'ScriptManager'”。出了什么问题 - 我确实有对 System.Web.UI 的引用，我什至得到了 resharper 来帮助我添加它（以及 using 语句）——如果它只是在那里的话。

好的，所以一些非常简单的事情和逻辑现在正在下降，我只需要知道什么......

有任何想法吗？

我得到了带有 SP1 的 Visual Studio 2008。

编辑：不起作用的 CompositeControl 实际上是一个简单的类库，而不是 ascx 文件自然是 Web 应用程序的一部分。我知道这可能会导致问题，因为我必须以某种方式设置对 Page 的引用 - 我尝试查看 ClientScriptManager 但它的构造函数是内部的，表明它是在 ScriptManager 内部的某个地方使用的 - 但它也暗示可能有一个入口来自一个类库（没有对 Page 对象的编译时引用）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-17T16:15:14.597

```
ClientScriptManager cs = Page.ClientScript;
cs.RegisterClientScriptBlock(GetType(), "GenerateMatrixText", script, true); 
```

终于找到了：）

# file - 加密、受密码保护的文件创建

> ID：295973
> 
> 赞同：1
> 
> 时间：2008-11-17T16:02:39.067
> 
> 标签：file, ms-word, extract, encryption, self-extracting

我正在编写一个程序来创建一个包含敏感信息的 Word 文档。我想对文档进行加密和密码保护并将其分发到自解压文件中，以便用户可以双击，提供密码，然后接收未加密的文件。

我可以创建 Word 文档，但我想要一个第三方程序，无论是否可编写脚本（我可以使用命令行），它可以：

1.  加密Word文档，
2.  密码保护加密，以及
3.  创建一个自解压文件。

任何人都可以为此目的推荐软件吗？由于数据以前托管在 SSL 加密站点上，因此任何 SSL 安全性或更高安全性都足够了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-19T20:23:26.530

也许您想要的只是一个已加密并设置为自解压的[7zip 。](http://www.7-zip.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T16:10:38.677

[Finecrypt.net](http://www.finecrypt.net/)应该满足您的要求（免费版本[在这里](http://www.finecrypt.net/download.html)）

![Finecrypt](https://i.stack.imgur.com/O5D8n.gif)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-19T20:15:19.540

[WinRAR](http://rarlab.com)可以创建带有密码保护的自解压文件。它使用 128 位 AES 进行加密。自解压器的窗口是可配置的。作为奖励，您可以获得良好的压缩效果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T10:20:41.577

[DotNetZip](http://dotnetzip.codeplex.com)做到了这一点。您可以编写脚本或对其进行编程。有命令行工具和 GUI 工具来生成 AES 加密的 ZIP 或自解压档案。自由。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-19T08:11:15.137

如果你想在 LAMP 服务器上加密 Word 文档，就像 MS Word 一样，你可以使用 PHPDocX 的 Crypto API：[CryptoPHPDocX](http://www.phpdocx.com/documentation/cryptophpdocx-word-document-protection-and-encryption-with-php)。

考虑到加密的 MS Word 文件是 MS 复合文件二进制文件，而不是标准的 OOXML/OPC 文件。

与其他解决方案相比的优点是：

*   Office 将加密文件直接识别为 Word 文件
*   Word 直接提示你输入密码
*   每当保存修改后的 Word 文档时，它都会保留其加密状态
*   加密算法为AES128

CryptoPHPDocX API 还允许文档保护（不安全，但对于交换您想要防止直接编辑的文档非常有用）并且还可以加密 PDF 文件。

# visual-studio - Visual Studio 2008 是否与 SourceSafe 集成？

> ID：295980
> 
> 赞同：4
> 
> 时间：2008-11-17T16:04:00.920
> 
> 标签：visual-studio, visual-sourcesafe

我正在使用 Visual Studio 2008 专业版。在以前的版本中，已经与 VSS 集成，通过它可以“从 SourceSafe 打开”，然后在解决方案视图中，可以通过单击单个文件与源代码管理进行交互。我在2008下好像有一些集成，即File菜单下有一个“Source Control”菜单项，但我能做的只有“Launch Microsoft Visual SourceSafe”。如何获得 2005 年的集成？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-17T16:10:21.097

您必须安装 VSS 客户端软件，如果您想要自动签出等，项目必须绑定到源代码控制存储库。

还可以尝试查看工具 -> 选项 -> 源代码控制菜单项。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-08T11:28:43.670

为了启用 Visual Source Safe 2005 与 Visual Studio 2008 的集成，您只需安装一个小更新：

[Visual SourceSafe 2005 更新](http://www.microsoft.com/downloadS/details.aspx?familyid=8A1A68D8-DB11-417C-91AD-02AAB484776B&displaylang=en)

[http://www.microsoft.com/downloadS/details.aspx?familyid=8A1A68D8-DB11-417C-91AD-02AAB484776B&displaylang=en](http://www.microsoft.com/downloadS/details.aspx?familyid=8A1A68D8-DB11-417C-91AD-02AAB484776B&displaylang=en)

* * *

了解更多信息：

[在 Visual SourceSafe 2005 更新中修复的错误列表](http://support.microsoft.com/default.aspx/kb/943847)

[http://support.microsoft.com/default.aspx/kb/943847](http://support.microsoft.com/default.aspx/kb/943847)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T00:31:26.543

您可以单击文件 -> 打开 -> 项目/解决方案，其中一个选项是 Microsoft Visual SourcsSafe。您可以选择要使用的 VSS 数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T17:12:55.867

我的机器上有一个独立的“Microsoft Visual SourceSafe”（2005）应用程序。VS 2008 是否有单独的“客户端”组件？我在安装 VS 之前安装了 VSS。这有什么不同吗？

在工具 -> 选项 -> 源代码管理中，我在下拉列表中有三个选项：“无”、“Microsoft Visual SourceSafe”和“Microsoft Visual SourceSafe (Internet)”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-06T15:30:06.723

我有一个类似的问题。VS2008 中的 VSS 集成似乎没有按预期工作。它知道我的 VSS 存储库在我的项目中的位置，但是如果我尝试编辑签入文件，它只会询问我是否要使其可写......嗯，不，我想检查一下，但那不是一个选项。

所以我也在一边使用VSS客户端，一边手动签入和签出文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-07T03:49:13.360

您应该关闭 Visual Studio 并再次安装更新。这个对我有用

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T00:19:39.063

我已经尝试了此下拉列表中的所有设置。

在找到让解决方案资源管理器集成正常工作的方法之前，我会在单独的窗口中运行 VSS 客户端并手动签出文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-20T00:25:26.650

我不确定如何解决您的问题。仅供参考，我最近将 Visual Studio 2008 与现有的 Visual Studio 2005 安装一起安装，它自动运行。VS 2008 与 SourceSafe 集成，我完全没有配置。对不起，它不适合你。

# c# - 使用 SOAP 的有状态 PHP Web 服务

> ID：295990
> 
> 赞同：1
> 
> 时间：2008-11-17T16:07:55.767
> 
> 标签：c#, php, .net, web-services, stateful

我正在尝试使用 SOAP 扩展在 PHP 中实现有状态的 Web 服务。（是的，我知道 Web 服务应该是无状态的；我真正关心的只是某种形式的会话 ID，因此我不需要在每次调用服务时都进行身份验证）。PHP.net 的 API 文档在这方面有些欠缺，并且没有太多其他内容。

我找到了一个讨论它的页面（[http://bytes.com/forum/thread160816.html](http://bytes.com/forum/thread160816.html)）并将代码实现为测试。我构建了一个小型 .NET 应用程序，它使用 Web 服务并调用每个函数并显示结果。根据我的阅读，只要使用 setClass() 函数将功能封装在一个类中，并且 setPersistence() 函数通过 SOAP_PERSISTENCE_SESSION 传递，PHP SOAP 扩展就会在调用之间保持类变量。

这是我的代码：

```
<?php

class User 
{
    var $name = "Initial value";

    function setName($name) 
    {
        $this->name = $name;

        // Tried this too.
        // $this->name = "Set to string constant" ;
    }

    function getName() 
    {
        // This always returns "Initial value"
        return $this->name;
    }
}

// Tried placing session_start() in several places
// before $server->handle()...
// One guy says this doesn't need to be called.
// I assume it depends on if session autostart is on.
session_start();

$server = new SoapServer(null, array('uri' => 'http://localhost/'));
$server->setClass('User');
$server->setPersistence(SOAP_PERSISTENCE_SESSION);
$server->handle();

?> 
```

我遇到的问题是 $name 在调用之间没有持久化——我总是得到初始化的值，而不是我分配给 setName() 的值。正如我所说，我试图在对数据库进行身份验证后保留会话 ID——如果有人有更好的方法来做到这一点，我愿意接受建议；但是，我仍然想解决一般情况。有人有想法么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T00:59:56.783

我实际上解决了我自己的问题。

我的工作假设是：1）.NET 自动处理 cookie；2）我的问题是 PHP 的。也不是这样。我的 PHP 代码很好，但我需要在我的 .NET 代码中再添加一个元素来处理会话 cookie。

实例化 Web 服务对象后，我需要将 CookieContainer 类的实例分配给 Web 服务对象。我的最终客户端代码如下：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;

namespace WsTest
{
    public partial class PhpWsForm : Form
    {
        private localhost.MyWebService ws;

        public PhpWsForm()
        {
            InitializeComponent();
            ws = new WsTest.localhost.MyWebService();

            // The line below is the part that I forgot!
            ws.CookieContainer = new System.Net.CookieContainer();
        }

        private void butSetVal_Click(object sender, EventArgs e)
        {
            ws.setName(txtSetVal.Text);
        }

        private void butGetVal_Click(object sender, EventArgs e)
        {
            txtGetVal.Text = ws.getName();
        }
    }
} 
```

不管怎么说，还是要谢谢你！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T16:19:03.777

大多数soap客户端为每个请求启动一个新连接，因此没有“会话”。

如果它是您的 SOAP 服务，您可以在每次回复时在 SOAP 信封内的某处发送会话 ID，并要求客户端在每个后续请求中传递会话 ID。

这要好得多，因为您的客户现在对行为有了线索和控制权。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-13T10:27:15.583

要使用有状态的 Web 服务，您需要在客户端的 SOAP cookie 中设置服务器会话的会话 ID。默认情况下，每次发送 SOAP 请求时，服务器都会生成一个唯一的会话 ID。为了防止这种情况，只需设置从 SOAP cookie 中的第一个请求获得的会话 ID。该 cookie 将与您所有后续的肥皂电话一起发送。例如，如果您使用 SOAP 使用 ASP.net Web 服务，则在第一次 WS 调用之后，获取如下响应标头：

```
$client = SoapClient("some.wsdl", array('trace' => 1));
$result = $client->SomeFunction();
$headers = $client->__getLastResponseHeaders(); 
```

现在`$headers`必须包含名称类似于“ASP.NET_SessionId”的会话 ID。从 中获取 ID`$headers`并创建一个 cookie，如下所示：

```
//$client->__setCookie($cookieName, $cookieValue);
$client->__setCookie('ASP.NET_SessionId', $cookieValue); 
```

现在，来自客户端的所有 SOAP 请求都将包含此会话 ID，并且您的状态将在服务器上持续存在。

# delphi - 如何在 Delphi 中使用当前语言环境格式化整数

> ID：295992
> 
> 赞同：7
> 
> 时间：2008-11-17T16:07:57.310
> 
> 标签：delphi, text-formatting

```
var i : integer;

i := 1234567; 
```

鉴于上述情况，我希望将字符串“1,234,567”作为输出（假设为英国语言环境）。IntToStr 只给了我“1234567”。我敢肯定有一个单行，但我找不到它...

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-17T16:24:25.187

试试格式化功能。

```
Label1.Caption := Format('%.0n', [i + 0.0]); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-17T20:57:17.913

或者，如果您需要线程安全或想要确保使用系统默认语言环境或想要指定一个：

```
function FormatIntFromLCID(const AValue: Integer; const LCID: Integer = LOCALE_SYSTEM_DEFAULT): string;
var
  AFormatSettings: TFormatSettings;
begin
  GetLocaleFormatSettings(LCID, AFormatSettings);
  Result := FormatFloat('#,##0',AValue, AFormatSettings);
end; 
```

有关格式/语言环境的更完整讨论，请参阅[此帖子](https://stackoverflow.com/questions/86002/in-delphi-how-can-you-have-currency-data-types-shown-in-different-currencies-in#87306)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-17T16:23:54.547

s := FormatFloat('#,##0', i);

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-05-14T02:40:15.570

我有这个功能可以做到这一点，其中 d 可能表示十进制数：

```
function dn(i: integer): string; 
begin 
  result := format('%.0n', [i.ToDouble]) 
end; 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-17T16:36:00.543

```
stringreplace(format('%n',[1234567.0]),'.00','',[]); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-17T18:43:01.863

格式('%n', [12345.678]);

# events - 如何获得有关 SharePoint 组更改的通知。

> ID：295993
> 
> 赞同：4
> 
> 时间：2008-11-17T16:08:57.573
> 
> 标签：events, sharepoint, event-handling, moss

我实际上正在寻找一种方法来获取有关 SharePoint 组的任何更改的通知。首先，我可以通过将事件处理程序附加到某种组列表来实现这一点。但不幸的是，没有代表 SharePoint 组的此类列表。

我的第二次尝试是将事件处理程序绑定到内容类型 SharePointGroup ，但这也不起作用。

那么是否有任何其他选项可以获取有关 SharePoint 组上的事件的通知？

**编辑：**

感谢您到目前为止的回复。

我忘了提到我已经用谷歌搜索并阅读了用户信息列表。对不起。

首先，我找到了一个论坛条目，他们将相对 URL 发布到用户信息列表 (_catalogs/users/simple.aspx)。当我使用此链接查看列表时，它只包含用户而没有组。我不知道，但也许这个链接在列表中做了一些过滤。

我在几篇博客和论坛帖子中发现的其他信息是，附加到用户信息列表的事件处理程序不会在事件中触发。我不得不承认，在阅读了很多次之后，它甚至在 MSDN（[http://msdn.microsoft.com/en-us/library/aa979520.aspx](http://msdn.microsoft.com/en-us/library/aa979520.aspx)）上都不起作用，我没有自己尝试过.

将事件处理程序附加到内容类型的问题不是附加的事情，例如，当我更改组名或从组中删除用户时，处理程序根本没有被触发。我不知道为什么不调用处理程序我很确定我实现了正确的方法并将它们附加到正确的事件。

**有关如何了解 SharePoint 组更改的任何其他建议？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-10T17:10:51.163

确实很烦人，添加或从组中删除没有事件处理程序，这是我使用 Google 发现的最佳解决方法！是打开审计。

然后定期循环审核以触发我的事件。

```
 wssQuery = new SPAuditQuery(site);
            wssQuery.AddEventRestriction(SPAuditEventType.SecGroupMemberAdd);
            wssQuery.AddEventRestriction(SPAuditEventType.SecGroupMemberDel);
            wssQuery.SetRangeStart(startTime.AddMinutes(-16));
            auditCol = site.Audit.GetEntries(wssQuery);

            foreach (SPAuditEntry entry in auditCol)
            {
                    xml.LoadXml("<event>" + entry.EventData + "</event>");

                    int userId = Int32.Parse(xml.SelectSingleNode("/event/user").InnerText);
                    int groupId = Int32.Parse(xml.SelectSingleNode("/event/groupid").InnerText);

                    if (entry.Event == SPAuditEventType.SecGroupMemberAdd)
                    {
                       // Do Stuff
                    }

                    if (entry.Event == SPAuditEventType.SecGroupMemberDel)
                    {
                        // Do Stuff
                    }

             } 
```

它确实会导致成员被添加到组和事件触发之间的严重延迟！

我在审计中也找不到事件处理程序，所以唯一的选择似乎是循环遍历。

这对我来说很昂贵，因为我们有数百个网站集！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T17:12:43.530

您是什么意思没有针对 SharePoint 组的此类列表？您拥有用户和 SharePoint 组所在的用户信息列表。您可以在此处附加事件接收器并过滤项目。例如，您可以筛选 SharePoint 组的内容类型 ID，即 0x010b。

此外，应该可以将事件接收器附加到 SharePoint 组。什么没用？

.b

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-10T05:42:41.007

不幸的是，“不会在 UserInformation 列表类型上引发列表事件。” 请参阅：http: [//msdn.microsoft.com/en-us/library/aa979520.aspx](http://msdn.microsoft.com/en-us/library/aa979520.aspx) 或此处的讨论：http: [//social.msdn.microsoft.com/Forums/en-US/ea2e06fb-63e1-4096- 843c-413ddf33f24b/how-to-add-event-receivers-for-spgroup-in-sharepoint](http://social.msdn.microsoft.com/Forums/en-US/ea2e06fb-63e1-4096-843c-413ddf33f24b/how-to-add-event-receivers-for-spgroup-in-sharepoint)

但是，对于 SP 2013，有一个解决方案： [http ://www.c-sharpcorner.com/UploadFile/anavijai/create-groupuseradded-event-receiver-in-sharepoint-2013/](http://www.c-sharpcorner.com/UploadFile/anavijai/create-groupuseradded-event-receiver-in-sharepoint-2013/)

# c - fread/fwrite 将大小和计数作为参数的基本原理是什么？

> ID：295994
> 
> 赞同：105
> 
> 时间：2008-11-17T16:09:06.840
> 
> 标签：c, file-io, libc

我们在这里讨论了为什么*fread()*和*fwrite()*为每个成员取一个大小并计数并返回读/写的成员数，而不仅仅是取一个缓冲区和大小。我们能想到的唯一用途是，如果你想读/写一个结构数组，这些结构不能被平台对齐整除，因此已经被填充，但不能那么普遍以至于保证这个选择在设计中。

从[fread(3)](https://man7.org/linux/man-pages/man3/fread.3.html)：

> 函数 fread() 从 stream 指向的流中读取数据的 nmemb 元素，每个 size 字节长，并将它们存储在 ptr 给定的位置。

> 函数 fwrite() 将 nmemb 数据元素（每个 size 字节长）写入 stream 指向的流，从 ptr 给定的位置获取它们。

> fread() 和 fwrite() 返回成功读取或写入的项目数（即，不是字符数）。如果发生错误或到达文件结尾，则返回值是一个短项目计数（或零）。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-11-17T16:16:58.883

`fread(buf, 1000, 1, stream)`and的不同之处`fread(buf, 1, 1000, stream)`在于，在第一种情况下，如果文件较小，您只会得到一个 1000 字节的块或什么都没有，而在第二种情况下，您会得到文件中小于和最多 1000 字节的所有内容。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-11-17T16:19:39.267

它基于[fread](http://www.opengroup.org/onlinepubs/009695399/functions/fread.html)的实现方式。

单一 UNIX 规范说

> 对于每个对象，应对 fgetc() 函数进行大小调用，并将结果按照读取的顺序存储在恰好覆盖该对象的 unsigned char 数组中。

[fgetc](http://www.opengroup.org/onlinepubs/009695399/functions/fgetc.html)也有这个注释：

> 由于 fgetc() 对字节进行操作，因此读取由多个字节组成的字符（或“多字节字符”）可能需要多次调用 fgetc()。

当然，这早于 UTF-8 等花哨的可变字节字符编码。

SUS 指出这实际上取自 ISO C 文档。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-09-19T02:32:15.607

这纯粹是猜测，但是在过去（有些仍然存在），许多文件系统并不是硬盘驱动器上的简单字节流。

许多文件系统是基于记录的，因此为了以有效的方式满足此类文件系统，您必须指定项目的数量（“记录”），从而允许 fwrite/fread 作为记录在存储上进行操作，而不仅仅是字节流。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-17T17:46:10.543

在这里，让我修复这些功能：

```
size_t fread_buf( void* ptr, size_t size, FILE* stream)
{
    return fread( ptr, 1, size, stream);
}

size_t fwrite_buf( void const* ptr, size_t size, FILE* stream)
{
    return fwrite( ptr, 1, size, stream);
} 
```

至于`fread()`/参数的基本原理`fwrite()`，我很久以前就丢失了 K&R 的副本，所以我只能猜测。我认为一个可能的答案是 Kernighan 和 Ritchie 可能简单地认为执行二进制 I/O 将最自然地在对象数组上完成。此外，他们可能认为块 I/O 会更快/更容易实现或在某些架构上实现。

尽管 C 标准规定`fread()`和以和`fwrite()`的形式实现，但请记住，该标准在 K&R 定义 C 之后很久就已经存在，并且标准中指定的内容可能不在最初设计者的想法中。K&R 的“C 编程语言”中所说的内容甚至可能与最初设计该语言时不同。`fgetc()``fputc()`

`fread()`最后，这是 PJ Plauger在“标准 C 库”中所说的：

> 如果`size`（第二个）参数大于 1，则您无法确定该函数是否还读取了`size - 1`超出其报告内容的其他字符。通常，您最好调用该函数`fread(buf, 1, size * n, stream);`而不是 `fread(buf, size, n, stream);`

基本上，他是说`fread()`的界面坏了。因为`fwrite()`他指出，“写错误通常很少见，所以这不是主要缺点”——我不同意这种说法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-17T16:21:29.933

很可能它可以追溯到文件 I/O 的实现方式。（回到过去）以块为单位写入/读取文件可能会更快，然后一次写入所有内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-08-11T01:34:03.443

对于可以避免读取任何部分记录的实现，具有单独的大小和计数参数可能是有利的。如果要从管道之类的东西中使用单字节读取，即使使用的是固定格式的数据，也必须考虑到一条记录被拆分为两次读取的可能性。如果可以改为请求，例如，当有 293 个字节可用时，最多读取 40 个记录，每个记录 10 个字节，并让系统返回 290 个字节（29 个完整记录），同时保留 3 个字节为下一次读取做好准备，那将方便很多。

我不知道 fread 的实现在多大程度上可以处理这种语义，但它们肯定可以在承诺支持它们的实现上派上用场。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2012-04-18T11:20:58.387

我认为这是因为 C 缺乏函数重载。如果有一些，大小将是多余的。但是在 C 中，您无法确定数组元素的大小，您必须指定一个。

考虑一下：

```
int intArray[10];
fwrite(intArray, sizeof(int), 10, fd); 
```

如果 fwrite 接受的字节数，您可以编写以下内容：

```
int intArray[10];
fwrite(intArray, sizeof(int)*10, fd); 
```

但这只是效率低下。您将有 sizeof(int) 倍的系统调用。

应该考虑的另一点是您通常不希望将数组元素的一部分写入文件。你想要整个整数或什么都没有。fwrite 返回成功写入的元素数量。所以如果你发现一个元素只写了 2 个低字节，你会怎么做？

在某些系统上（由于对齐），您无法在不创建副本和移位的情况下访问整数的一个字节。

# windows - EnumWindows 返回句柄的顺序是否有意义？

> ID：295996
> 
> 赞同：19
> 
> 时间：2008-11-17T16:09:54.683
> 
> 标签：windows, winapi, enumeration, hwnd

从几个初步测试看来，[`EnumWindows`](http://msdn.microsoft.com/en-us/library/ms633497.aspx)总是以反向实例化顺序返回窗口，即最先实例化的窗口。这是一个有效的观察吗？如果是这样，是否适用于所有版本的 Windows？这是一个可靠的假设吗，即该行为是否记录在某处？

* * *

上下文：*我正在处理一种情况，我正在触发第三方应用程序打开几个非模态窗口，一旦它们打开，我需要向这些窗口发送一些窗口消息，但我没有万无一失的方法将它们标识为它们的窗口类和它们的标题都会有所不同，我也不知道它们的预期坐标。但是，如果我可以依赖上述行为，`EnumWindows`我可以简单地使用`EnumWindows`其类和标题符合我期望的返回的第一个句柄。这仍然会留下一些假设的漏洞，但我认为这已经足够好了。不过，欢迎提供替代建议。*

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-17T16:15:31.913

它按 Z 顺序返回它们。首先是带有`WS_EX_TOPMOST`set 的最顶部的窗口，直到带有 的最底部的窗口`WS_EX_TOPMOST set`，然后是没有 的最顶部的窗口`WS_EX_TOPMOST`，尽管是没有 的最底部的窗口`WS_EX_TOPMOST`。请注意，可见性不是决定因素，因此在 Z 顺序中高于可见窗口的不可见窗口仍将出现在其之前。

**编辑**：

您不太可能随心所欲地使用它，只需从`EnumWindows`. 不仅您的新窗口不太可能是第一次返回，而且您还会遇到其他窗口可以同时打开的竞争条件。但是，您可以保留应用程序所有已知窗口的列表，当您需要查找新打开的窗口时，调用`EnumWindows`窗口句柄并将其与列表中的句柄进行比较。*当您找到一个没有*在您的列表中的具有正确类和标题（您甚至可以使用 来检查它是否属于正确的进程`GetWindowThreadProcessID`）时，您就找到了新窗口。

 *但是，出于您的目的，安装 CBT 挂钩并注意 HCBT_CREATEWND 通知可能会更好地为您服务。[有关详细信息，](http://msdn.microsoft.com/en-us/library/ms644977(VS.85).aspx)请参阅 MSDN 帮助[`SetWindowsHookEx()`](http://msdn.microsoft.com/en-us/library/ms644990(VS.85).aspx)和[回调](http://msdn.microsoft.com/en-us/library/ms644977(VS.85).aspx)。[`CBTProc`](http://msdn.microsoft.com/en-us/library/ms644977(VS.85).aspx)

**枚举顺序的确定程度**：

对此问题的许多评论和其他答案都提到了 MSDN 中缺乏关于`EnumWindows`返回窗口句柄顺序的精确文档。事实上，页面[`EnumWindows`](http://msdn.microsoft.com/en-us/library/ms633497(VS.85).aspx)和[回调](http://msdn.microsoft.com/en-us/library/ms633498(VS.85).aspx)都对这个问题保持沉默[。`EnumWindowsProc`](http://msdn.microsoft.com/en-us/library/ms633498(VS.85).aspx)我提供以下证据：

1.  [MSDN 杂志中的一篇 C++ Q&A 文章](http://msdn.microsoft.com/en-us/magazine/cc164067.aspx)确实明确指出：

    > EnumWindows 以自上而下的 Z 顺序枚举窗口

2.  页面上[`EnumChildWindows`](http://msdn.microsoft.com/en-us/library/ms633494(VS.85).aspx)暗指备注部分的订单：

    > 在枚举过程中按 Z 顺序移动或重新定位的子窗口将被正确枚举。

    这意味着顺序是 Z 顺序相关的。因为，在*hWndParent*参数的描述中，它说：

    > 如果此参数为 NULL，则此函数等效于 EnumWindows。

    可以假设相同的逻辑和顺序适用于`EnumWindows`.

3.  这是此函数的可观察行为，这使得对其进行更改是一项重大更改。总的来说，微软在不对可观察行为进行重大更改方面做得很好。这不是保证，但这是一个非常安全的赌注。您更有可能发现在下一个版本中您正在使用的功能已被弃用——并被另一个“Ex”版本取代——而不是发现它的可观察行为发生了变化。

当然，在这一点上这都是非常学术的，因为`EnumWindows`可能不是解决 OP 问题的最佳解决方案——至少`EnumThreadWindows`可能更合适——但我认为对于可能遇到这个问题的其他人来说值得一提邮政。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-02-15T10:02:02.103

以前的答案需要相当大的改进。Enum-order = Z-order 仅当 GetSystemMetrics(SM_IMMENABLED)=0 时，即禁用输入法管理器/输入法编辑器功能。因为所有窗口类“IME”（标题“Default IME”）和“MSCTFIME UI”都在窗口“Progman”（“程序管理器”）之后枚举，即不是Z 顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-17T16:24:32.847

该顺序未在 API（[MSDN 链接](http://msdn.microsoft.com/en-us/library/ms633497.aspx)）中指定，因此不能保证它是特别的 - 如果有保证，它将在 API 中明确指定。例如，如果在枚举的中途创建了一个窗口，会发生什么 - 它是否包含在枚举中？如果这样做变得更有效率，这允许窗口管理器自由地更改其实现。

但是，有一个独特的值可以用来区分窗口 - 窗口句柄本身。在您的`EnumWindowProc`方法中，保存每个匹配窗口的窗口句柄 - 无论如何您都需要它来向窗口发送消息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T16:40:30.007

如果您控制这两个进程，您可以从第一个进程发送一个带有“HWND_BROADCAST”作为第一个参数的 SendMessage。

然后其他程序在收到消息时，可以向他的子窗口发送一个 SendMessage。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-17T16:42:49.423

如果文档没有说明枚举顺序，我强烈建议您远离任何假设。Raymond Chen 的博客 (blogs.msdn.com/oldnewthing) 上的几篇文章会告诉您有多少应用程序依赖于所有这些未记录的内容/观察结果，并且当新版本的 Windows 出现时会出现严重错误（除非MS 开发人员为另一个表现不佳的应用程序引入了另一个 shim）。

至于您的目的，有几个函数可以帮助您完成任务，例如 GetWindowThreadProcessID、GetParent、EnumThreadWindows 和 EnumWindows。*****`**`******