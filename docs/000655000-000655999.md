# StackOverflow 问答 000655000-000655999

# .net - 避免硬编码 SQL 语句的最佳策略是什么

> ID：655005
> 
> 赞同：2
> 
> 时间：2009-03-17T16:31:52.177
> 
> 标签：.net

前几天，我向一位同事展示了我正在编写的一些代码，顺便说一句，他评论说我有硬编码的 SQL 语句。现在这些 SQL 语句是非常静态的，而那些确实倾向于改变的语句我在数据库上创建了视图，并且有一个硬编码的“从视图中选择列''”之类的事情。

所以我的问题是在这些情况下最好的做法是什么？

是否将SQL语句作为资源添加到项目中，然后在代码中调用资源？有更好的方法吗？

编辑：在这种情况下，我使用 .Net2.0 与 SQL Server 2005 和 Oracle 数据库进行交互

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T16:34:51.577

1.  存储过程。防止各种可能的注射、维护问题。将数据库代码放在数据库代码所属的位置。

2.  ORM 工具（如 Hibernate、Subsonic 等）意味着您一开始就看不到一行 T-SQL。更陡峭的学习曲线，但最好早点开始而不是晚点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T16:35:46.020

您确实应该为特定的数据模型构建应用程序。

如果您的底层数据模型发生更改，这是唯一需要更改 SQL 语句的事情，那么实际上也无法避免进行代码更改。

我自己认为硬编码的 SQL 语句没有任何问题。有一些用于处理数据库的代码生成器，但是您仍然必须围绕特定的已知数据模型进行设计，因此如果模型发生更改，您仍然会遇到同样的问题——代码必须更改。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T16:36:31.183

我不惜一切代价避免使用更难编码的 SQL。我更喜欢调用存储过程。

如果您使用的是 .NET 3.5 和 MS SQL Server，您可能会查看 LINQ，然后您的 SQL 语句在代码中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T16:42:43.850

这实际上取决于您的数据模型以及您对数据库的权限。我去过的公司不允许他们的 .Net 开发人员编写存储过程，并且只允许一组选定的数据库开发人员这样做。

就像 Frakkle 提到的那样，如果您的数据模型不经常更改，那么硬编码语句很可能不会成为问题。

如果您不使用存储过程或 ORM 工具，则有一些方法可以对硬编码的 sql 语句进行参数化。这是推荐的做法。

如果您使用的是 MSSql 2005+，那么根据我所看到和测试的情况，您的硬编码语句仍将缓存其执行计划。还有一些可以使用的提示（例如 OPTIMIZE FOR UNKNOWN），这将有助于提高性能。

评估您的环境和数据层的变化量，无论哪种方式，您都应该没问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T17:37:10.477

一些想法：

1.  在数据库级别，限制应用程序用户执行存储过程以外的对象。
2.  使用将 SP 绑定到类或仅适用于 SP 的数据库库。
3.  编码策略与代码审查/演练相结合。

这些可能不是最友好的方法，但它们在某些环境中确实有价值。

# eclipse - IDE 的可定制性

> ID：655006
> 
> 赞同：1
> 
> 时间：2009-03-17T16:31:58.010
> 
> 标签：eclipse, plugins, ide, notepad++

我正在考虑修改现有的 IDE（例如：通过开发插件）以提供对专有脚本语言的支持。我只需要实现一些功能，如语法突出显示、自动完成等（即要求非常简单）。集成该功能的最佳 IDE 或文本编辑器是什么？例如，如果我想为此开发一个 eclipse 插件，那将是一件痛苦的事情。

你觉得记事本++怎么样？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T16:42:33.493

您可能想尝试一下 NetBeans[通用语言框架](http://wiki.netbeans.org/GLFTutorial)。

> 称为通用语言框架的 NetBeans 项目允许您定义一种编程语言并将其集成到 NetBeans IDE。在第一步中，您应该描述语言 - 词汇部分（使用正则表达式定义标记）和语法（语法规则）。在第二步中，您可以定义如何在 NetBeans 中可视化这种语言。您可以为标记（语法着色）或折叠（基于语法规则）定义颜色。您可以定义该语言的哪些部分应显示在导航器中，以及如何缩进该语言以及许多其他功能。
> 
> 本教程应指导您完成创建新 NetBeans 模块、向其中添加语言支持、描述您的语言的词汇和语法结构以及添加对您的语言的所有标准编辑器功能的支持的过程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:37:02.553

在 vim 中，您可以通过在语法文件夹中添加另一个文件来轻松添加自定义语法突出显示规则；有关详细信息，最好查看帮助。

如果我没记错的话，notepad++ 也允许定义自定义语法文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T16:46:34.153

Notepad++ 允许您以非常简单的方式定义自定义语法高亮文件，但它不是自动完成的一个很好的解决方案（看看[这个](https://stackoverflow.com/questions/484742/notepad-and-code-completion)SO question）。

如果你想要一个真正的 IDE 来扩展，我建议你使用[Eclipse](http://www.eclipse.org/)。

**更新**：关于如何开发 Eclipse 插件的[教程。](http://www.ibm.com/developerworks/opensource/library/os-eclipse-plugindev1/)

# java - 如何从类路径提供 Jacl 包？

> ID：655008
> 
> 赞同：0
> 
> 时间：2009-03-17T16:32:20.973
> 
> 标签：java, tcl, jacl

我需要分发一些 TCL 代码作为企业应用程序的一部分，并且该代码必须可用于集群中的所有节点。由于安全策略，Tcl 解释器无法从文件系统访问 TCL 代码，因此我必须使其在 EAR 本身的 jar 中可用。

我怎样才能说服 Jacl（1.4.1，如果重要的话）在类路径上为包找到 pkgIndex.tcl？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T06:27:20.797

Jacl 在变量 auto_path 中寻找 pkgIndex

如果你执行命令 puts $auto_path 你会看到例如：

资源：/tcl/lang/库

添加您的路径： lappend auto_path 资源：

# delphi - DELPHI - 需要 ClientDataSet 的帮助

> ID：655009
> 
> 赞同：-1
> 
> 时间：2009-03-17T16:32:21.397
> 
> 标签：delphi, tclientdataset

我有一个包含以下数据的 ClientDataSet

```
IDX   EVENT BRANCH_ID   BRANCH
1     E1     7  B7
2     E2     5  B5
3     E3     7  B7
4     E4     1  B1
5     E5     2  B2
6     E6     7  B7
7     E7     1  B1 
```

我需要将这些数据转换为

```
IDX   EVENT BRANCH_ID   BRANCH
1     E1     7  B7
2     E2     5  B5
4     E4     1  B1
5     E5     2  B2 
```

唯一重要的字段是 BRANCH_ID 和 BRANCH 和 BRANCH_ID 必须是唯一的

由于有很多数据，我不知道哪两个有它的副本。

**问题**：您能否建议一种使用**原始**数据的克隆版本转换数据的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:48:16.990

克隆不允许您实际更改克隆中的数据，并且不会在原始数据中反映相同的更改，因此如果您想要这样做，您可能会重新考虑克隆的想法。

克隆确实为您在克隆中提供了一个单独的光标，并允许您独立于主客户端数据集对其进行过滤和索引（即排序）。从您提供的数据来看，您似乎想要过滤一些分支数据并按 branch_id 排序。您可以通过在克隆上设置新的过滤器和索引来完成此操作。这是一篇很好的文章，其中包括如何做到这一点的示例：

[http://edn.embarcadero.com/article/29416](http://edn.embarcadero.com/article/29416)

再看看你的问题，似乎你需要做的就是在克隆数据集的 branch_id 上设置一个唯一索引。上面的链接文章有关于如何设置索引的信息；检查 clientdataset.addindex 函数上的文档以获取更多详细信息以及有关设置索引以仅显示唯一值的信息，如果我记得这可能只是意味着您将 branch_id 设置为主键。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:08:31.403

我想不出一种巧妙的方法来做到这一点，但是您可以在 BRANCH_ID 上建立索引，向数据集添加一个 fkInternalCalc 布尔字段，然后在每个分支的第一行将该字段初始化为 True（使用组状态或手动）和然后根据字段的值过滤克隆。不过，您必须更新有关数据更改的字段。

我有一种感觉，更好的解决方案是拥有一个主数据集，每个分支都有一行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T06:28:55.950

您没有提供有关您的用例的许多详细信息，因此我将尝试给您一些提示：

1.  “大量数据”表明您可能从 SQL 后端获得它。使用 'SELECT DISTINCT...' 或 'SELECT ... GROUP BY BRANCH_ID' （或类似的语法，取决于您使用什么 SQL 后端）将轻松快速地提供所需的结果。请确认，我会给你更多的细节。

2.  正如其他人所说，一个简单的“克隆”是行不通的。最简单（也许更快）的解决方案，假设通常数据的 WRT 分支数量很少，是在数据集之外有一个索引。如果你真的想过滤你的原始数据，那么在你的数据上添加一个状态字段（例如布尔值）并在第一次出现时放置一个标志（例如'True'）。

伪代码：（假设：您的 ClientDataSet 是 cds1 您的 cds1 有一个状态字段 cds1Status（布尔值）-这是可选的，仅当您想要排序/过滤/搜索 cds1 时才需要，您有一​​个 lIndex，它是一个 TStringList）

```
lIndex.Clear;
lIndex.Sorted:=True; 

with cds1 do
try
  DisableControls;
  First;
  while not Eof do //scan the dataset
  begin
    cVal:=cds1Branch_ID.AsString;
    Edit; //we anyway update the Status field
    if lIndex.Find(cVal, nDummy) then //nDummy - we don't use it. 
    begin //already in index
      cds1Status.AsBoolean:=False; //we say here "No, isn't the 1st occurence"
    end
    else
    begin //Not found! - Well, let's add it...
      lIndex.Append(cVal); //update the index 
      cds1Status.AsBoolean:=True; //mark the first occurence
    end;
    Post; //save the changes in the status field
    Next;
  end; //scan
finally
  EnableControls; //housekeeping
end; 
```

//警告！- 未经测试。我是从头开始写的，但我认为你明白了……

...取决于您尝试完成的工作（这将是您可能与我们分享的最好的事情）以及您对 BRANCH_ID 的选择性，也许根本不需要状态引擎。如果您对该字段的选择性非常低（选择性=唯一值的数量/记录的数量），那么拥有一个新数据集并仅复制唯一值而不是将原始CD的每条记录放入其中要快得多编辑 + 发布状态。（更改数据集状态是昂贵的操作。特别是如果您的 cd 链接到远程数据存储 - 即服务器）。

h,

PS：我的解决方案主要是简单的。您也可以使用 lIndex.Sorted:=False 进行测试，并使用 lIndex.IndexOf 而不是 Find。在某些（罕见）情况下更好。取决于你的数据。如果您想让事情复杂化并且速度确实是一个问题，您可以实现一个成熟的 BTree 索引来执行您的搜索（可用的库）。您也可以使用 CDS 的索引引擎并索引 BRANCH_ID 并在克隆上执行许多“定位”，但是因为您的选择性显然 < 1，所以理论上扫描 cds 的整个索引应该比对唯一索引的扫描要慢，特别是如果您的定制索引是根据您的数据类型、结构、分布等量身定制的。

只是 my2c

# sql - 如何使用 ms sql 进行更新和排序

> ID：655010
> 
> 赞同：57
> 
> 时间：2009-03-17T16:33:18.460
> 
> 标签：sql, sql-server, tsql, sql-order-by, sql-update

理想情况下，我想这样做：

```
UPDATE TOP (10) messages SET status=10 WHERE status=0 ORDER BY priority DESC; 
```

In English: 我想从数据库中获取前 10 条可用 (status=0) 消息并锁定它们 (status=10)。优先级更高的消息应该首先得到。

不幸的是，MS SQL 不允许在更新中使用 order by 子句。

无论如何如何规避这个？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2009-03-17T16:37:02.663

```
WITH    q AS
        (
        SELECT  TOP 10 *
        FROM    messages
        WHERE   status = 0
        ORDER BY
                priority DESC
        )
UPDATE  q
SET     status = 10 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-03-17T16:35:43.867

您可以执行子查询，首先获取按优先级排序的前 10 个 ID，然后更新该子查询中的 ID：

```
UPDATE  messages 
SET status=10 
WHERE ID in (SELECT TOP (10) Id 
             FROM Table 
             WHERE status=0 
             ORDER BY priority DESC); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-07-06T14:14:35.230

我必须将此作为一种更好的方法提供 - 你并不总是拥有身份字段的奢侈：

```
UPDATE m
SET [status]=10
FROM (
  Select TOP (10) *
  FROM messages
  WHERE [status]=0
  ORDER BY [priority] DESC
) m 
```

您还可以根据需要使子查询变得复杂 - 加入多个表等......

为什么这样更好？它不依赖于表中是否存在标识字段（或任何其他唯一列）`messages`。它可用于更新任何表的前 N ​​行，即使该表根本没有唯一键。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T18:42:24.593

```
UPDATE messages SET 
 status=10 
WHERE ID in (SELECT TOP (10) Id FROM Table WHERE status=0 ORDER BY priority DESC); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T16:44:00.057

如以下评论中所述，您还可以使用 SET ROWCOUNT 子句，但仅适用于 SQL Server 2014 及更早版本。

```
SET ROWCOUNT 10

UPDATE messages
SET status = 10 
WHERE status = 0 

SET ROWCOUNT 0 
```

更多信息：http: [//msdn.microsoft.com/en-us/library/ms188774.aspx](http://msdn.microsoft.com/en-us/library/ms188774.aspx)

或使用临时表

```
DECLARE @t TABLE (id INT)
INSERT @t (id)
SELECT TOP 10 id
FROM messages
WHERE status = 0
ORDER BY priority DESC

UPDATE messages
SET status = 10
WHERE id IN (SELECT id FROM @t) 
```

# qt - 您可以在 qt 中创建 setup.exe 以在客户端计算机上安装您的应用程序吗

> ID：655011
> 
> 赞同：16
> 
> 时间：2009-03-17T16:33:19.880
> 
> 标签：qt, installation, qt-installer

我已经创建了一个桌面应用程序，现在我需要安装在客户端的计算机上。

但是，客户希望有一个安装向导。像 Visual Studio 安装项目一样，您可以添加安装程序。

Qt 是否允许您创建安装程序，还是我需要使用 InstallShield 或 Wise 等第 3 方安装程序？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T18:38:18.660

我使用[Inno](http://www.jrsoftware.org/isinfo.php)并且非常喜欢它。我已经尝试了其他几个，这个对我来说效果很好。（免费）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-12-07T14:50:47.620

您应该使用**Qt 安装程序框架**： [http ://doc.qt.io/qtinstallerframework/ifw-overview.html](http://doc.qt.io/qtinstallerframework/ifw-overview.html)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-18T11:25:28.357

您肯定需要第三方安装程序。已经提到了一些好的。如果您决定使用付费解决方案，[bitrock 的安装程序](http://bitrock.com/products_installbuilder_overview.html)是一个完美的选择，他们也以 Qt 为中心，他们的主要业务围绕 Qt。

作为开源替代品，我建议[NSIS](http://nsis.sourceforge.net/Main_Page)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-17T16:57:52.100

如果只针对 Windows，可以使用 WiX（Windows Installer XML），它可以集成到 Visual Studio 和 MSBuild 中，所以比较好用。它是免费的，并且可以生成有效的 MSI 文件，无论如何这可能是必需的。

如果您需要简单的向导设置，请尝试 InnoSetup。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T16:34:58.083

我认为最好使用像 installshield 这样的第三方软件。它们针对包装目的进行了优化，并提供了许多可定制的选项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T16:38:48.243

如果您已经拥有 Visual Studio，则可以继续使用安装项目来分发您的应用程序。这些工具是内置的。这是 WiX “取代”的技术（稍后会详细介绍），这就是我所做的。这不是一个理想的解决方案，但它为我提供了一个 MSI，这就是这些天应该如何安装 Windows 软件的方式。使用 InstallShield 或其他东西可能会更好，但老实说，我从来没有与任何第三方安装程序有过良好的经验。这就是为什么我坚持使用不太理想的设置项目；它胜过在昂贵、丑陋且经常令人沮丧的第三方安装程序创建工具上花费大量资金。简而言之，这是一个非常务实的解决方案，务实的解决方案是有意义的。

至于 WiX：我真的完全不推荐它。这似乎是个好主意，但几个月后我发现自己切换回设置项目。尽管他使用 WiX 的时间比我使用设置项目的时间长，但我们的 WiX 专家需要两倍的时间才能完成任何事情。（他也是一个了不起的程序员，只是有点被开源蒙蔽了。）您最终需要维护数千个复制的文本行。有了几个不同的项目，它就变得一团糟。

我不建议尝试自己在 Qt 中构建安装程序。除了必须获得很多恰到好处的行为之外，作为 Qt 应用程序，它还需要 Qt 库。除非您静态链接它们，这在商业版（不是 LGPL）中是可能的，但很难且不推荐。另外，您将在下载中包含两个 Qt 库副本。

Qt 本身似乎使用了 nullsoft 安装程序。仅此一点就应该告诉您自己构建不是一个好主意。:)

# asp.net - 在 IIS 中管理后台线程有哪些最佳实践？

> ID：655012
> 
> 赞同：12
> 
> 时间：2009-03-17T16:33:30.753
> 
> 标签：asp.net, multithreading, httpmodule

我写了一个产生后台线程的 HttpModule。我正在使用线程，就像在进程中运行的计划任务一样，这真的很方便。

跟踪此线程的最佳做法是什么？我以前从来没有这样做过，我对它的某些方面有点困惑：

1.  我怎么知道线程是否仍在运行？我看到它完成了它的工作，但是还有其他方法可以知道它是否还活着？我下载了 ProcMon，但 w3wp.exe 产生了*大量*线程，所以我不知道哪个是我的线程。我给它起了名字，但这并没有帮助。

2.  如果线程死了，我如何“抓住”线程？是否有某种 Dispose 方法可以让它写入 EventLog 或者如果它失败了？“垂死宣言”之类的？

3.  如何主动停止线程？如果我想让它停止运行这个后台进程，如何在不反弹 IIS 的情况下杀死它？

4.  无论如何要重新启动它，独立于 HttpModule 吗？（我猜这个答案是否定的……）

**编辑：**只是为了澄清，目的是我的线程永远不会消失。它运行一个函数，然后进入睡眠状态几分钟，然后唤醒并再次运行该函数。这不像是完成一项任务然后结束。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T17:27:06.553

当 Jeff 制作 Stackoverflow 时，他遇到了类似的问题。

他的解决方案是使用缓存过期。您将某些内容放入缓存中，然后当它过期时，会在非面向用户的线程中触发一个事件。在过期的事件处理程序中，您插入一些代码以将项目重新添加到缓存中，并为您的应用程序执行任何需要完成的内务工作

使用这种技术，您的子问题很容易得到回答：

1.  您检查该项目是否仍在缓存中。
2.  如果该项目不在缓存中，请重新添加它。
3.  从缓存中删除缓存项。
4.  将项目添加回缓存。

您可以制作一个小的管理页面来配置这些选项。

这为您提供了一种在 Web 应用程序中大致计时内务处理过程的好方法。它不需要单独的 Windows 服务，这是一个巨大的胜利。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T17:16:27.110

根据我的经验，你可以让它“足够好”，但并不完美。我建议在 Windows 服务中实现您的重复任务。根据任务所做的事情，Windows 服务可能甚至不必与 Web 应用程序对话，反之亦然，例如，如果两者都使用同一个数据库。否则，您仍然可以使用例如 WCF 进行通信。

最大的好处是：windows服务将随操作系统启动，您可以使用控制面板轻松配置、启动和停止它，您通过Windows事件日志内置监控，您可以独立更新后台服务和Web应用程序等等

如果这不是一个选项，例如因为您处于共享托管环境中，我会推荐以下内容：

1.  在 Application_start (Global.asax) 中启动后台线程，并将线程引用存储在静态变量中。
2.  使用 try/catch 包装在后台线程上调用的每个方法，因为从 .NET 2.0 开始，后台线程上的每个未处理异常都会关闭应用程序。（它将在下一个请求时重新启动，但它会减慢下一个请求，杀死所有当前会话和缓存，当然在下一个请求之前不会有任何计时器处于活动状态。）
3.  在每个请求上（实现了一个 HttpModule 或再次在 Global.asax 中），检查全局变量中的 Thread 实例（它是否仍然！= null，线程是否处于活动状态并正在运行等）。如果没有，请调用重新启动代码。在重新启动部分使用锁定以确保线程不会同时创建两次。

即使那样，如果您没有全天候的常规流量，您也无法确定您的后台线程是否始终在运行。另请记住，在共享托管环境中，如果几个小时内没有活动，关闭应用程序池是很常见的。您可以尝试通过在您自己的网络上的客户端计算机上设置计划任务来改进这一点，每隔几分钟对您的应用程序执行一次轻量级 HTTP 请求，以确保您的应用程序始终运行。

# c++ - 成员函数什么时候应该同时是 const 和 volatile ？

> ID：655027
> 
> 赞同：11
> 
> 时间：2009-03-17T16:36:33.163
> 
> 标签：c++, constants, volatile

我正在阅读有关 volatile 成员函数的内容，并确认成员函数可以同时是**const 和 volatile**。我没有得到这种东西的真正用途。任何人都可以分享他们将成员函数作为 const 和 volatile 一起**实际使用的经验。**

我写了小班来测试同样的：

```
class Temp
{
public:

    Temp(int x) : X(x)
    {
    }

    int getX() const volatile
    {
        return X;
    }

    int getBiggerX()
    {
        return X + 10;
    }
private:
    int X;
};

void test( const volatile Temp& aTemp)
{
    int x = aTemp.getX();
}

int main(int argc, char* argv[])
{
    const volatile Temp aTemp(10);
    test(aTemp);

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-17T16:40:32.903

*cv*资格蒸馏意味着：

> 我不会改变这个值，但是有一些东西可以。

您向自己承诺不会更改值（`const`限定），并要求编译器保持对这个对象的黏糊糊的手并关闭所有优化（`volatile`限定）。不幸的是，在公平对待方面，编译器供应商几乎没有标准`volatile`。毕竟`volatile`是对编译器的*提示*。

一个实际用例是系统时钟。假设 0xDEADBEEF 是您要编写的硬件时钟寄存器的系统特定地址：

```
int const volatile *c = reinterpret_cast<int *>(0xDEADBEEF); 
```

您无法修改该寄存器值，但每次读取它时，它都可能具有不同的值。

此外，可以使用它来模拟[UART](http://en.wikipedia.org/wiki/16550_UART)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-17T17:02:47.000

您要求提供 volatile 成员函数的实际示例。好吧，我想不出一个，因为我*能*想象的唯一情况是如此低级，以至于我一开始不会考虑使用成员函数，而只是一个简单的结构，其数据成员可通过 volatile 引用访问。

但是，为了回答这个问题，让我们在其中放入一个 const volatile 函数。假设您有一个地址为 0x378h 的端口，其中包含 2 个整数，每个 4 个字节。然后你可以写

```
struct ints {
    int first;
    int second;
    int getfirst() const volatile {
        return first;
    }

    int getsecond() const volatile {
        return second;
    }
      // note that you could also overload on volatile-ness, just like
      // with const-ness
};

// could also be mapped by the linker. 
ints const volatile &p = *reinterpret_cast<ints*>(0x378L); 
```

你在说

> **我**没有改变它们，但是这个抽象语义之外的另一件事可能会改变它。所以总是从它的地址做一个真正的加载。

实际上，*volatile*表示对象的值可能不是最后存储到其中的值，但实际上是未知的，并且可能在外部（编译器无法观察到）条件之间发生了变化。因此，当您从 volatile 对象中读取数据时，编译器必须模拟确切的抽象语义，并且不执行任何优化：

```
a = 4;
a *= 2; 
  // can't be optimized to a = 8; if a is volatile because the abstract
  // semantics described by the language contain two assignments and one load. 
```

以下已经确定了做什么`volatile`。一切都可以在`1.9`标准中找到。它谈论的参数是实现定义的东西，比如某种类型的 sizeof。

> 本国际标准中的语义描述定义了一个参数化的非确定性抽象机。本国际标准对一致性实现的结构没有要求。特别是，它们不需要复制或模仿抽象机器的结构。相反，需要符合要求的实现来模拟（仅）抽象机的可观察行为，如下所述。[...]
> 
> 执行格式良好的程序的一致实现应产生与具有相同程序和相同输入的抽象机的相应实例的可能执行序列之一相同的可观察行为。[...]
> 
> 抽象机的可观察行为是它对易失性数据的读取和写入顺序以及对库 I/O 函数的调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T16:40:16.900

我从来不需要任何既是 const 又是 volatile 的东西，但这是我的猜测：

*Const*：您，您的代码，不允许更改该值。

*Volatile*：该值可能会随着时间而改变，而您的程序没有做任何事情。

因此，由另一个进程或某些硬件公开的一些只读数据将是 const 和 volatile。它甚至可以被内存映射到您的进程中，并且页面标记为只读，因此如果您尝试写入它而不是 const，您会遇到访问冲突。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T18:26:06.397

我认为我们有“const volatile”函数的原因与我们有“受保护”继承的原因是一样的：语法允许它，所以我们最好想出一个含义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T03:10:00.437

我能想到的一种情况可能需要在成员函数上同时使用 const 和 volatile ，这是在嵌入式系统情况下，您的函数在逻辑上是 const 但实际上必须修改共享内存位置中的数据缓存（例如，构建一个按需位图并缓存位图，以防很快再次需要相同的位图）。它当然不会经常出现。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-17T16:12:19.987

标记为 const volatile 的对象将不允许被声明它的代码更改。由于 const 限定符，将引发错误。限定符的 volatile 部分意味着编译器无法针对对象优化代码。

在嵌入式系统中，这通常用于访问可由硬件读取和更新的硬件寄存器，因此能够通过代码写入寄存器是没有意义的。一个示例可能是串行端口的状态寄存器。各种位将指示状态，例如字符是否正在等待读取。根据串行端口硬件中发生的其他情况，对该状态寄存器的每次读取都可能导致不同的值。写入状态寄存器没有意义，但您需要确保每次读取寄存器都会导致实际读取硬件。

*下面是一个插图：*

```
//We assume that the below declared pointers
//point to the correct
//hardware addresses
unsigned int const volatile *status_reg;
unsigned char const volatile *recv_reg;

#define CHAR_READ 0x01

int get_next_char()
{
    while((*status_reg & CHAR_READ) == 0);
    return *recv_reg;
} 
```

希望这可以帮助。

问候 Sandipan Karmakar。

# memory - 从 16 位硬件寄存器中读取

> ID：655029
> 
> 赞同：2
> 
> 时间：2009-03-17T16:36:43.693
> 
> 标签：memory, embedded, cpu-registers

在嵌入式系统上，我们有一个设置允许我们通过命令行界面读取任意数据以进行诊断。对于大多数数据，这很好用，我们使用`memcpy()`在请求的地址复制数据并通过串行连接将其发送回。

但是，对于 16 位硬件寄存器，`memcpy()`会导致一些问题。如果我尝试使用两个 8 位访问来访问 16 位硬件寄存器，则无法正确读取高位字节。

有没有人遇到过这个问题？我是一个“高级”（C#/Java/Python/Ruby）的人，正在向硬件靠拢，这是一个陌生的领域。

处理这个问题的最佳方法是什么？[我看到了一些信息，具体来说，这里](http://dragonsgate.net/pipermail/icc-430/2007-February/000682.html)的 [to me] 有点令人困惑。这篇文章的作者有*完全相同*的问题，但我讨厌在不完全理解我在做什么的情况下实施解决方案。

非常感谢您对这个问题提出的任何看法。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T16:51:14.253

该硬件中的每个寄存器都公开为一个两字节数组，第一个元素在两字节边界处对齐（其地址是偶数）。memcpy() 运行一个循环并在每次迭代时复制一个字节，因此它以这种方式从这些寄存器中复制（所有循环展开，char 是一个字节）：

```
*((char*)target) = *((char*)register);// evenly aligned - address is always even
*((char*)target + 1) = *((char*)register + 1);//oddly aligned - address is always odd 
```

但是，由于某些硬件特定原因，第二行无法正常工作。如果您一次复制两个字节而不是一次复制一个，则以这种方式完成（short int 是两个字节）：

```
*((short int*)target) = *((short*)register;// evenly aligned 
```

在这里，您在一次操作中复制两个字节，并且第一个字节均匀对齐。由于没有从奇怪对齐的地址单独复制，所以它可以工作。

修改后的 memcpy 检查地址是否完全对齐，如果是，则复制到两个字节块中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T16:52:56.307

除了[Eddie 所说](https://stackoverflow.com/questions/655029/reading-from-16-bit-hardware-registers/655071#655071)的之外，您通常需要使用 volatile 指针来读取硬件寄存器（假设内存映射寄存器，并非所有系统都如此，但听起来对您的系统如此）。就像是：

```
// using types from stdint.h to ensure particular size values
// most systems that access hardware registers will have typedefs
// for something similar (for 16-bit values might be uint16_t, INT16U,
// or something)

uint16_t volatile* pReg = (int16_t volatile*) 0x1234abcd;  // whatever the reg address is

uint16_t val = *pReg;  // read the 16-bit wide register 
```

以下是 Dan Saks 的一系列文章，它们应该为您提供几乎所有您需要知道的内容，以便能够在 C/C++ 中有效地使用内存映射寄存器：

*   [“映射内存”](http://www.embedded.com/columns/programmingpointers/26807176)
*   [“有效地映射内存”](http://www.embedded.com/columns/programmingpointers/50900224)
*   [“更多映射内存的方法”](http://www.embedded.com/columns/programmingpointers/55301821)
*   [“大小和对齐设备寄存器”](http://www.embedded.com/columns/programmingpointers/160502362)

*   [“明智地使用 volatile”](http://www.embedded.com/columns/programmingpointers/170701302)

*   [“准确放置挥发物”](http://www.embedded.com/columns/programmingpointers/174300478)
*   [“像承诺一样波动”](http://www.embedded.com/columns/programmingpointers/175801310)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T16:45:48.337

如果您需要访问特定大小的硬件寄存器，那么您有两种选择：

*   了解您的 C 编译器如何生成代码，以便您可以使用适当的整数类型来访问内存，或者
*   嵌入一​​些程序集以使用正确的字节或字长进行访问。

当然，读取硬件寄存器可能会产生副作用，具体取决于寄存器及其功能，因此以适当大小的访问权限访问硬件寄存器非常重要，这样您就可以一次读取整个寄存器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T16:52:54.920

我认为所有的细节都包含在你发布的那个帖子中，所以我会试着把它分解一下；

具体来说;

```
If you access a 16-bit hardware register using two 8-bit
accesses, the high-order byte doesn't read correctly (it
always read as 0xFF for me). This is fair enough since
TI's docs state that 16-bit hardware registers must be
read and written using 16-bit-wide instructions, and
normally would be, unless you're using memcpy() to
read them. 
```

所以这里的问题是硬件寄存器只有在它们的值在单个 16 位读取中读取时才会报告正确的值。这相当于做；

```
uint16 value = *(regAddress); 
```

这使用单个 16 字节读取从地址读取到值寄存器。另一方面，你有 memcpy，它一次复制一个字节的数据。就像是;

```
while (n--)
{
  *(uint8*)pDest++ = *(uint8*)pSource++;
} 
```

因此，这会导致寄存器一次读取 8 位（1 个字节），从而导致值无效。

该线程中发布的解决方案是使用 memcpy 的一个版本，该版本将使用 16 位读取复制数据，只要源和目标是 6 位对齐的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T16:53:05.840

通常使用与寄存器大小相同的整数类型就足够了。在*大多数*编译器上，short 是 16 位。

```
void wordcpy(short *dest, const short *src, size_t bytecount)
{
    int i;
    for (i = 0;  i < bytecount/2;  ++i)
        *dest++ = *src++;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T16:52:07.400

你需要了解什么？您已经找到了一个单独的帖子来解释它。显然 CPU 文档*要求*通过 16 位读写访问 16 位硬件寄存器，但您的 memcpy 实现使用 8 位读写。所以他们不能一起工作。

解决方案就是不使用 memcpy 来访问这个寄存器。相反，编写自己的例程来复制 16 位值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T16:53:39.223

不确定到底是什么问题-我认为该帖子有正确的解决方案。正如您所说，问题在于标准 memcpy() 例程一次读取一个字节，这对于内存映射的硬件寄存器不能正常工作。这是处理器的限制 - 根本无法获得一次读取一个字节的有效值。

建议的解决方案是编写自己的 memcpy() ，它只适用于字对齐地址，一次读取 16 位字。这相当简单 - 该链接提供了 ac 和汇编版本。唯一的问题是确保您始终从有效对齐的地址进行 16 位复制。您可以通过两种方式做到这一点：使用链接器命令或编译指示来确保对齐，或者在未对齐缓冲区的前面添加额外字节的特殊情况。

# c# - 需要在c#中进行double类型的枚举

> ID：655038
> 
> 赞同：2
> 
> 时间：2009-03-17T16:38:47.213
> 
> 标签：c#, enumeration

如何创建 double 类型的枚举？

有可能还是我必须创建某种集合和哈希？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T16:42:39.203

你不能让它成为一个枚举。

[http://msdn.microsoft.com/en-us/library/y94acxy2.aspx](http://msdn.microsoft.com/en-us/library/y94acxy2.aspx)

一种可能：

```
public static class MyPseudoEnum
{
    public static readonly double FirstVal = 0.3;
    public static readonly double SecondVal = 0.5;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T17:49:50.553

我想这取决于你想去多大的麻烦。您*可以*将 double 转换为 long，因此如果您在单独的程序中将 double 值转换为 long 整数，并输出常量值，则可以在程序中使用它们。

顺便说一句，我强烈反对这样做，但有时你必须做你必须做的事情。

首先，编写一个程序将双精度数转换为长整数：

```
 Console.WriteLine("private const long x1 = 0x{0:X16}L;", 
        BitConverter.DoubleToInt64Bits(0.5));
    Console.WriteLine("private const long x2 = 0x{0:X16}L;", 
        BitConverter.DoubleToInt64Bits(3.14)); 
```

现在，将该输出添加到您的程序并创建枚举：

```
 private const long x1 = 0x3FE0000000000000L;
    private const long x2 = 0x40091EB851EB851FL;

    enum MyEnum : long
    {
        val1 = x1,
        val2 = x2
    } 
```

当您想针对枚举测试双精度值时，您必须调用`BitConverter.DoubleToInt64Bits()`，并将结果转换为您的枚举类型。要以另一种方式转换，请调用`BitConverter.Int64BitsToDouble()`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T16:49:50.917

不，枚举本质上是整数值。

我不知道您正在解决的特定问题，但您可以制作通用词典。

当然，双打的比较总是很有趣，特别是当它们在小数位上相差甚远时。如果您尝试将计算结果（相等）与已知的双精度进行比较，可能会很有趣。只是一个警告，如果这是你可能需要做的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T16:41:55.147

枚举类型必须是[整数](http://msdn.microsoft.com/en-us/library/exx3b86w(VS.80).aspx)类型，除了`char`. 这不包括`double`，因此您需要制作一个查找表或一组常量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T16:43:57.297

我认为 byte、sbyte、short、ushort、int、uint、long 或 ulong 是您唯一的选择。

为什么，出于兴趣？也许我们可以解决它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T16:45:04.267

枚举不能使用双精度。有关枚举如何工作的说明，请参阅以下 MSDN 文章：

[MSDN 文章](http://msdn.microsoft.com/en-us/library/sbbt4032.aspx)

这是回答您问题的文章的引述：

> 每个枚举类型都有一个底层类型，它可以是除 char 之外的任何整数类型。枚举元素的默认基础类型是 int。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-22T12:52:37.820

为什么需要使用 double 类型的枚举？

如果您需要子值，您可以将双精度值与常量运算符相乘以将它们全部转换为整数（并保持相同的比率），然后使用相同的运算符将您的值转回双精度值......如果您相乘几十个，这就像暂时将小数点分隔符向左移动。简单但有效。

# c# - 是否可以拥有一个只有一些 SSL 页面的个性化 ASP.NET Web 应用程序？

> ID：655042
> 
> 赞同：3
> 
> 时间：2009-03-17T16:39:25.450
> 
> 标签：c#, asp.net, security, web-applications

我有一个 Web 应用程序，一旦登录，几乎所有页面都会个性化。

我希望能够使用 SSL 锁定一些非常特定的页面，这些页面可能包含敏感信息。据我所知，一旦您通过 SSL 登录页面（网站区域）登录，我用来存储大量个性化和用户凭据的会话信息对非 SSL 部分不可用的网站，因为它们被认为是 2 个单独的应用程序。

这个 MSDN 文档几乎说明了我在说什么：[MSDN Doc](http://msdn.microsoft.com/en-us/library/ms998310.aspx)

> 注意：如果您使用这种类型的站点结构，您的应用程序不得依赖非 SSL 页面上的用户身份。在上述配置中，对于非 SSL 页面的请求，不会发送表单身份验证票证。因此，用户被认为是匿名的。这对需要用户名的相关功能有影响，例如个性化。

我也没有使用表单身份验证。当用户登录时，会话对象会存储他们的凭据，包括他们的 IP。如果此会话对象存在于具有相同 IP 的特定用户，则他们被视为“已登录”并启用个性化功能。

所以我的问题是，是否有任何解决方法可以说我的登录页面和其他一些页面正在使用 SSL，网站的重置不是，并且所有页面都可以访问相同的会话变量？

如果没有，任何人都可以建议任何其他方法来完成相同类型的个性化功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:59:35.183

由于没有评论，我想我会提供一个不雅但实用的解决方案。

在表单身份验证配置块中关闭 RequireHTTPS。

接下来，您将创建一个实现 IHttpModule 的自定义类。这个接口有一个 Init 方法，它接受一个 HTTPApplication 实例作为参数。然后，您可以附加到此实例上的“AuthenticateRequest”事件。

从这里，您可以在不使用 SSL 的情况下对任何应该执行的请求进行 302 重定向。您可能希望从 web.config 中的自定义配置部分驱动哪些页面需要 SSL。

要将此类用于您的请求，您必须在 web.config 的 HttpModules 部分添加一行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:07:22.793

首先，请查看此代码项目文章： http: [//www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx](http://www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx) - 这将使您能够“踩”和“踩” https for某些页面。

关于您的会话问题，我认为您有点卡住了。标准表单身份验证机制存储一个 cookie 来标识通过 http 或 https 可用的已验证会话。我的建议是切换到使用表单身份验证，并使用 ProviderUserKey guid 作为访问每个会话数据的密钥。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T21:20:06.080

我们决定在需要 SSL 的那几个页面中不使用 SSL。我们查看了其他做类似事情但不使用 SSL 的 Web 应用程序。我们并没有真正保护任何对恶意用户来说非常有用的东西，因为无论如何都要经历窃取的麻烦。

在决定删除 SSL 之前，我确实考虑过的一个选择是将用户的会话存储在应用程序的 Web 服务接口上。每个页面调用都将访问 Web 服务以访问会话信息。这将在每个页面调用上强制执行，以确保会话保持活动状态。在做出 SSL 决定之前，我没有对使用此解决方案进行过多调查，因此此解决方案可能存在许多缺点，尤其是每次服务器命中时都必须对 Web 服务进行额外调用。

# asp.net-ajax - 标题标签与 AJAX 不同步

> ID：655043
> 
> 赞同：0
> 
> 时间：2009-03-17T16:39:44.840
> 
> 标签：asp.net-ajax, title

因此，当用户登陆我网站上的产品页面时，我们有一些交叉销售的产品可以通过 AJAX 交换到主视图。标题标签发生了变化，但它不会随着第一个替代产品翻转，然后在您翻阅其他产品时保持单击。

我唯一能想到的是我在回发过程中没有足够早地设置标题标签以使其正确更新，但我已经玩了一点，到目前为止我无法让它正常工作.

有人知道这个的好解决方案吗？

我在后面的代码中用一个简单的 Page.Title = "Product: "+productName;

我需要切换到使用 javascript 来设置它吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T17:02:54.303

我想我们需要看一下代码......我在基本页面中有以下内容，单击按钮可以更新标题：

在 Page_Load() 中：

```
Page.Title = DateTime.Now.ToString(); 
```

在 aspx 内：

```
 <asp:UpdatePanel ID="UpdatePanel1" runat="server">
    <ContentTemplate>
    <asp:Button ID="Button1" runat="server" Text="Button" OnClick="Button1_Click" />
    </ContentTemplate>
    </asp:UpdatePanel> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:16:40.880

我想通了，产品更新是在页面加载之后发生的，因为它是一个被触发的事件。

移动了标题更新，它工作正常。

# java - 不再设置时 Eclipse 仍然使用 http.proxyHost 设置

> ID：655045
> 
> 赞同：3
> 
> 时间：2009-03-17T16:40:17.413
> 
> 标签：java, eclipse, proxy, jvm

我正在处理与“ [OSX 上 JVM 的僵尸 http.proxyHost 设置](https://stackoverflow.com/questions/619567/zombie-http-proxyhost-settings-for-jvm-on-osx)”相同的问题，但我使用的是 Kubuntu 8.04 和 Eclipse 3.4.2。我不得不使用代理来工作，但已经迁移了它。我已经重置了我在 Eclipse 内部和外部可以找到的环境中的所有内容，以摆脱设置代理。但是，当我尝试使用软件更新功能时，我发现它仍在使用代理。在错误日志中，我可以看到：

> !ENTRY org.eclipse.core.net 1 0 2009-03-17 10:49:50.137 !MESSAGE 系统属性 http.proxyHost 已被外部源设置为 netproxy.blah.com。将使用首选项中的值覆盖此值
> 
> !ENTRY org.eclipse.core.net 1 0 2009-03-17 10:49:50.164 !MESSAGE 系统属性 http.proxyPort 已被外部源设置为 3128。将使用首选项中的值覆盖此值

关于设置此属性的外部来源可能是什么的任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-28T19:41:25.767

这是首选项面板中的错误。如果您拖尾工作区/.metadata/.log 文件，您可以看到它。

解决方法（至少在 Eclipse 3.4.2 中）是：

*   打开**Window > Preferences**，然后**General > Network Connections**
*   选择**手动代理配置**
*   单击**添加主机...**按钮添加“无代理”条目
*   输入一个随机条目，例如“localhost”，然后单击“**确定”**
*   单击**直接连接到 Internet**
*   **使用OK**按钮关闭属性面板。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-02-03T12:31:49.253

或者转到您的*eclipse.ini*文件并检查是否有一些参数，例如：

```
-Dorg.eclipse.ecf.provider.filetransfer.excludeContributors=org.eclipse.ecf.provider.filetransfer.httpclient
-Dhttp.proxyPort=8080
-Dhttp.proxyHost=myproxy
-Dhttp.proxyUser=mydomain\myusername
-Dhttp.proxyPassword=mypassword
-Dhttp.nonProxyHosts=localhost|127.0.0.1 
```

或相同的参数，但第一个在 4 中完成，如下所示：

```
 -Dorg.eclipse.ecf.provider.filetransfer.excludeContributors=org.eclipse.ecf.provider.filetransfer.httpclient4 
```

自 Eclipse Kepler (4.3) 发布以来

使用此参数，您可以禁用 HttpClient 提供程序并让 ECF 改用基于 JRE URLConnection 的提供程序（第 1 行）。并设置代理设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-20T22:32:09.933

我记得 mantis mylyn 连接器也有类似的问题。我不记得该条目的确切位置，但我认为您工作区的元数据文件夹中的某处是这个特定插件的选项文件。您的问题可能存在类似的问题。在 Windows 系统上，我已经在用户主目录的应用程序文件夹中找到了 eclipse 设置。不确定这是如何在 Ubuntu 上处理的……已经有一段时间了。

最坏的情况是你可以安装另一个 Eclipse 实例，看看它是否有效。尽管如果导致此问题的配置文件不在 eclipse 文件夹中的某个位置，您仍然会遇到同样的问题。

至少你会知道它在哪里 - 主文件夹中的 eclipse 文件夹、工作区或系统设置。

问候和好运！

# c# - SQL Server 的日期、时间和日期时间偏移的等效 C# 数据类型是什么？

> ID：655049
> 
> 赞同：39
> 
> 时间：2009-03-17T16:40:55.570
> 
> 标签：c#, sql-server-2008, types

对于 SQL Server 中的日期数据类型，最合适的等效 C# 数据类型是什么？我专门找

*   `date`
*   `time`
*   `datetimeoffset`

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-17T16:45:41.333

以下是 和 SQL Server 数据类型的等效 CLR`date`数据`time`类型`datetimeoffset`：

**日期**- `DateTime`,`Nullable<DateTime>`
**时间**- `TimeSpan`,`Nullable<TimeSpan>`
**日期**时间偏移- `DateTimeOffset`,`Nullable<DateTimeOffset>`

请注意，您可以在此处找到所有 SQL Server 数据类型及其 CLR 等效项的列表，[映射 CLR 参数数据](http://msdn.microsoft.com/en-us/library/ms131092.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T16:50:45.517

在 C# 中，您可以使用

*   日期
*   时间跨度
*   [DateTimeOffset 结构](http://msdn.microsoft.com/en-us/library/system.datetimeoffset(VS.95).aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T16:46:37.163

仅当您安装 .NET Framework 3.5 SP1 时才支持新类型。

*   SqlDbType.日期

*   SqlDbType.Time

*   SqlDbType.DateTime2

*   SqlDbType.DateTimeOffSet

有关详细信息，请参阅[SQL Server 2008 中的日期和时间数据](http://msdn.microsoft.com/en-us/library/bb675168.aspx)

# sql - 奇怪的 SQL 行为，为什么这个查询什么都不返回？

> ID：655053
> 
> 赞同：3
> 
> 时间：2009-03-17T16:42:23.477
> 
> 标签：sql, sql-server-2005, unicode, unicode-string

假设有一个名为“myTable”的表，包含三列：

```
{**ID**(PK, int, not null), 
 **X**(PK, int, not null), 
 **Name**(nvarchar(256), not null)}. 
```

让 {4, 1, аккаунт} 成为桌子上的记录。

```
select * from myTable as t 
    where t.ID=4  
    AND t.X = 1 
    AND (     t.Name = N'аккаунт'  )

select * from myTable as t 
    where t.ID=4  
    AND t.X = 1 
    AND (  t.Name LIKE N'%аккаунт%'  ) 
```

第一个查询返回记录，但是，第二个没有？为什么？

遇到此问题的系统：

*Windows XP - Professional - 版本 2002 - SP3
*服务器排序规则：* Latin1_General_CI_AS
*版本：* 9.00.3073.00
*级别：* SP2
*版本：*开发人员版

*服务器排序：* SQL_Latin1_General_CP1_CI_AS
*版本：* 9.00.3054.00
*级别：* SP2
*版本：*企业版

结果：

```
SELECT SERVERPROPERTY('SQLCharSetName')
iso_1

Using OSQL.exe
0x30043A043A04300443043D04420400000000000000000000000000000000
0x3F3F3F3F3F3F3F0000000000000000000000000000000000000000000000
0x253F3F3F3F3F3F3F25000000000000000000000000000000000000000000

SELECT CAST(name AS BINARY),
       CAST(N'аккаунт' AS BINARY),
       CAST(N'%аккаунт%' AS BINARY)
FROM   myTable t
WHERE  t.ID = 4  
       AND t.X = 1

CAST(name AS BINARY) 
0x30043A043A04300443043D04420400000000000000000000000000000000  
CAST(N'аккаунт' AS BINARY)
0x3F3F3F3F3F3F3F0000000000000000000000000000000000000000000000  
CAST(N'%аккаунт%' AS BINARY)
0x253F3F3F3F3F3F3F25000000000000000000000000000000000000000000 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:03:32.723

您能否发布以下查询的结果：

```
SELECT CAST(name AS BINARY),
       CAST(N'аккаунт' AS BINARY),
       CAST(N'%аккаунт%' AS BINARY)
FROM   myTable t
WHERE  t.ID = 4  
       AND t.X = 1 
```

这将有助于缩小问题的范围。

**更新：**

从您的查询结果中我可以看出，您的编码有问题。

字符串常量中的西里尔文字正在转换为问号 ( `0x3F`)。

不幸的是，我无法`Management Studio`在我的测试服务器上重现这种行为。

我认为设置存在一些问题`OS`，因为西里尔字符很可能甚至达不到`SQL Server`.

请您再回答三个问题：

1.  你`OS`在用什么（版本、语言，`MUI`如果有的话）

    *   此查询返回什么：

        SELECT SERVERPROPERTY('SQLCharSetName')

    *   `osql.exe`使用并发出以下查询连接到您的服务器：

        SELECT CAST(name AS BINARY), CAST(N'аккаунт' AS BINARY), CAST(N'%аккаунт%' AS BINARY) from myTable t WHERE t.ID = 4
        AND tX = 1 GO

    它在运行时返回什么`osql.exe`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:48:49.203

两个查询都为我返回相同的结果。

```
select * from myTable as t
where t.ID=4
AND t.X = 1
AND (t.Name = N'аккаунт') 
```

回报：

```
ID          X           Name
----------- ----------- ------------
4           1           аккаунт 
```

和

```
select * from myTable as t
where t.ID=4
AND t.X = 1
AND (t.Name LIKE N'%аккаунт%') 
```

回报：

```
ID          X           Name
----------- ----------- ------------
4           1           аккаунт 
```

（1 行受影响）

我的 SQL Server 版本是：

```
Microsoft SQL Server 2005 - 9.00.3077.00 (Intel X86) 
    Dec 17 2008 15:19:45 
    Copyright (c) 1988-2005 Microsoft Corporation
    Express Edition on Windows NT 5.1 (Build 2600: Service Pack 3) 
```

我的排序规则设置为：`SQL_Latin1_General_CP1_CI_AS`

我对 Quassnoi 的结果： `0x30043A043A04300443043D04420400000000000000000000000000000000` `0x30043A043A04300443043D04420400000000000000000000000000000000` `0x250030043A043A04300443043D0442042500000000000000000000000000`

（1 行受影响）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T16:08:28.587

好吧，经过大量研究，我发现确实是在以下版本的SQL Server 2005上发现的问题：

Windows XP - 专业版 - 2002 版 - SP3
版本：9.00.3073.00
级别：SP2
版：开发者版

版本：9.00.3054.00
级别：SP2
版本：企业版

..也可能是其他版本。

修复：升级到 SP3。

# c++ - 什么时候应该在 C++ 中使用 new 关键字？

> ID：655065
> 
> 赞同：328
> 
> 时间：2009-03-17T16:44:56.030
> 
> 标签：c++, pointers, reference, new-operator, keyword

我使用 C++ 有一段时间了，我一直想知道这个`new`关键字。简单地说，我应该使用它，还是不使用它？

1.  用`new`关键字...

```
 MyClass* myClass = new MyClass();
    myClass->MyField = "Hello world!"; 
```

2.  没有`new`关键字...

```
 MyClass myClass;
    myClass.MyField = "Hello world!"; 
```

从实现的角度来看，它们似乎没有什么不同（但我确信它们是不同的）......但是，我的主要语言是 C#，当然第一种方法是我习惯的。

困难似乎在于方法 1 更难与 std C++ 类一起使用。

我应该使用哪种方法？

### 更新1：

我最近对超出范围（即从函数返回）的大型数组使用了*堆*内存（或*空闲存储*`new`）关键字。在我使用堆栈之前，这会导致一半元素在范围之外损坏，切换到堆使用可确保元素完好无损。耶！

 **### 更新 2：

我的一个朋友最近告诉我，使用`new`关键字有一个简单的规则；每次键入时`new`，键入`delete`。

```
 Foobar *foobar = new Foobar();
    delete foobar; // TODO: Move this to the right place. 
```

这有助于防止内存泄漏，因为您总是必须将删除放在某处（即，当您将其剪切并粘贴到析构函数或其他位置时）。

* * *

## 回答 #1

> 赞同：352
> 
> 时间：2009-03-17T16:48:37.143

**方法 1（使用`new`）**

*   [**为空闲存储**](http://www.gotw.ca/gotw/009.htm)上的对象分配内存 （这通常与**堆**相同）
*   需要您`delete`稍后明确您的对象。（如果你不删除它，你可能会造成内存泄漏）
*   内存一直分配，直到你`delete`它。（即您可以`return`使用创建的对象`new`）
*   除非指针为d，否则问题中的示例将[泄漏内存；](http://en.wikipedia.org/wiki/Memory_leak)`delete`并且**应该始终删除**它，无论采用哪个控制路径，或者是否抛出异常。

**方法2（不使用`new`）**

*   **为堆栈**上的对象分配内存（所有局部变量所在的地方）堆栈可用的内存通常较少；如果你分配了太多的对象，你就有堆栈溢出的风险。
*   以后你就不需要了`delete`。
*   超出范围时不再分配内存。（即你不应该`return`指向堆栈上的对象）

至于使用哪一个；鉴于上述限制，您选择最适合您的方法。

**一些简单的案例：**

*   如果您不想担心调用`delete`，（以及导致[内存泄漏](http://en.wikipedia.org/wiki/Memory_leak)的可能性），您不应该使用`new`.
*   如果您想从函数返回指向对象的指针，则必须使用`new`

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2009-03-17T17:16:26.330

两者之间有一个重要的区别。

未分配的所有内容都与`new`C# 中的值类型非常相似（人们经常说这些对象是在堆栈上分配的，这可能是最常见/最明显的情况，但并非总是如此）。更准确地说，未使用分配的对象`new`具有*自动存储持续时间* 分配的所有内容都`new`在堆上分配，并返回指向它的指针，就像 C# 中的引用类型一样。

在堆栈上分配的任何东西都必须有一个常量大小，在编译时确定（编译器必须正确设置堆栈指针，或者如果对象是另一个类的成员，它必须调整另一个类的大小） . 这就是 C# 中的数组是引用类型的原因。它们必须是，因为使用引用类型，我们可以在运行时决定请求多少内存。这同样适用于这里。只有具有恒定大小（可以在编译时确定的大小）的数组才能分配自动存储持续时间（在堆栈上）。必须在堆上分配动态大小的数组，方法是调用`new`.

（这就是与 C# 的任何相似性停止的地方）

现在，在堆栈上分配的任何东西都有“自动”存储持续时间（您实际上可以将变量声明`auto`为来自）

自动存储持续时间意味着它听起来像，变量的持续时间是自动处理的。相比之下，在堆上分配的任何东西都必须由您手动删除。这是一个例子：

```
void foo() {
  bar b;
  bar* b2 = new bar();
} 
```

此函数创建三个值得考虑的值：

在第 1 行，它在堆栈上声明了一个`b`类型变量（自动持续时间）。`bar`

在第 2 行，它在堆栈上声明一个`bar`指针`b2`（自动持续时间），*并*调用 new，在堆上分配一个`bar`对象。（动态持续时间）

当函数返回时，会发生以下情况：首先，`b2`超出范围（破坏顺序总是与构造顺序相反）。但是`b2`只是一个指针，所以什么也没有发生，它占用的内存被简单地释放了。*重要的是，它指向*的内存（`bar`堆上的实例）没有被触及。只有指针被释放，因为只有指针具有自动持续时间。其次，`b`超出范围，因此由于它具有自动持续时间，因此调用其析构函数并释放内存。

堆上的`bar`实例呢？它可能还在那里。没有人愿意删除它，所以我们泄露了内存。

从这个例子中，我们可以看到任何具有自动持续时间的东西都*保证*在超出范围时调用其析构函数。这很有用。但是在堆上分配的任何东西只要我们需要它就可以持续，并且可以动态调整大小，就像数组一样。这也很有用。我们可以使用它来管理我们的内存分配。如果 Foo 类在其构造函数中在堆上分配一些内存，并在其析构函数中删除该内存会怎样。然后我们可以两全其美，保证再次释放的安全内存分配，但没有强制所有内容都在堆栈上的限制。

这几乎就是大多数 C++ 代码的工作方式。以标准库`std::vector`为例。这通常在堆栈上分配，但可以动态调整大小和调整大小。它通过在必要时在堆上内部分配内存来做到这一点。该类的用户永远不会看到这一点，因此不会泄漏内存或忘记清理您分配的内容。

这个原理叫做RAII（Resource Acquisition is Initialization），它可以扩展到任何必须被获取和释放的资源。（网络套接字、文件、数据库连接、同步锁）。它们都可以在构造函数中获取，并在析构函数中释放，因此您可以保证您获得的所有资源都会再次被释放。

作为一般规则，永远不要直接从您的高级代码中使用 new/delete。始终将它包装在一个可以为您管理内存的类中，这将确保它再次被释放。（是的，这条规则可能有例外。特别是，智能指针要求您`new`直接调用，并将指针传递给其构造函数，然后由构造函数接管并确保`delete`正确调用。但这仍然是一个非常重要的经验法则)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2018-04-05T18:09:34.557

简短的回答是：如果你是 C++ 的初学者，你*永远不*应该使用`new`或`delete`自己。

相反，您应该使用智能指针，例如`std::unique_ptr`and `std::make_unique`（或者不太常见的`std::shared_ptr`and `std::make_shared`）。这样，您几乎不必担心内存泄漏。即使您更高级，最佳实践通常是将您正在使用的自定义方式封装`new`到`delete`一个专门用于对象生命周期问题的小类（例如自定义智能指针）中。

当然，在幕后，这些智能指针仍在执行动态分配和释放，因此使用它们的代码仍然会产生相关的运行时开销。这里的其他答案已经涵盖了这些问题，以及如何就何时使用智能指针而不是仅在堆栈上创建对象或将它们合并为对象的直接成员做出设计决策，足够好，我不会重复它们。但我的执行摘要是：在某些事情迫使您使用之前，不要使用智能指针或动态分配。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-03-17T16:53:23.530

> 我应该使用哪种方法？

这几乎从来不是由您的打字偏好决定的，而是由上下文决定的。如果您需要将对象保留在几个堆栈中，或者如果它对于堆栈来说太重，您可以将它分配到免费存储中。此外，由于您正在分配一个对象，因此您还负责释放内存。查找`delete`运算符。

为了减轻使用免费商店管理的负担，人们发明了类似`auto_ptr`和`unique_ptr`. 我强烈建议你看看这些。它们甚至可能对您的打字问题有所帮助；-)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-03-24T02:22:26.310

如果您使用 C++ 编写代码，您可能是为了性能而编写代码。使用 new 和 free 存储比使用堆栈慢得多（尤其是在使用线程时），所以只在需要时使用它。

正如其他人所说，当您的对象需要位于函数或对象范围之外，对象非常大或者您在编译时不知道数组的大小时，您需要 new 。

另外，尽量避免使用删除。将你的 new 包装成一个智能指针。让智能指针为你调用 delete。

在某些情况下，智能指针不智能。永远不要将 std::auto_ptr<> 存储在 STL 容器中。由于容器内的复制操作，它将过早删除指针。另一种情况是当您有一个非常大的 STL 对象指针容器时。boost::shared_ptr<> 会产生大量的速度开销，因为它会上下颠簸引用计数。在这种情况下，更好的方法是将 STL 容器放入另一个对象中，并为该对象提供一个析构函数，该析构函数将对容器中的每个指针调用 delete。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-17T16:48:10.220

简单的答案是肯定的 - new() 在堆上创建一个对象（不幸的副作用是您必须管理它的生命周期（通过显式调用它的 delete），而第二种形式在当前堆栈中创建一个对象范围，并且该对象将在超出范围时被销毁。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-17T16:51:13.363

如果没有`new`关键字，您会将其存储在[call stack](http://en.wikipedia.org/wiki/Call_stack)上。在堆栈上存储过大的变量会导致[堆栈溢出](http://en.wikipedia.org/wiki/Stack_overflow)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-17T16:57:17.997

您是将 myClass 从函数中传递出来，还是期望它存在于该函数之外？正如其他人所说，当您不在堆上分配时，这完全与范围有关。当您离开该功能时，它会消失（最终）。初学者犯的经典错误之一是试图在函数中创建某个类的本地对象并返回它而不在堆上分配它。我记得在我早期使用 C++ 时调试过这种事情。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-17T17:09:28.593

如果您的变量仅在单个函数的上下文中使用，则最好使用堆栈变量，即选项 2。正如其他人所说，您不必管理堆栈变量的生命周期 - 它们是构造和自动销毁。此外，相比之下，在堆上分配/释放变量很慢。如果您的函数被调用得足够频繁，那么如果使用堆栈变量与堆变量相比，您将看到巨大的性能提升。

也就是说，有几个明显的情况是堆栈变量不足。

如果堆栈变量具有较大的内存占用，那么您将面临堆栈溢出的风险。默认情况下，[每个线程的堆栈大小](http://msdn.microsoft.com/en-us/library/ms686774(VS.85).aspx)在 Windows 上为 1 MB。您不太可能创建大小为 1 MB 的堆栈变量，但您必须记住堆栈利用率是累积的。如果您的函数调用一个函数，该函数调用另一个函数，该函数调用另一个函数......，所有这些函数中的堆栈变量都会占用同一个堆栈上的空间。递归函数会很快遇到这个问题，这取决于递归的深度。如果这是一个问题，您可以增加堆栈的大小（不推荐）或使用 new 运算符在堆上分配变量（推荐）。

另一个更可能的情况是您的变量需要“生存”在您的函数范围之外。在这种情况下，您将在堆上分配变量，以便可以在任何给定函数的范围之外访问它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-17T16:50:13.223

第二种方法在堆栈上创建实例，以及诸如声明的内容`int`和传递给函数的参数列表等内容。

第一种方法为堆栈上的*指针*腾出空间，您已将其设置为内存中`MyClass`已在堆上分配新的位置或空闲存储的位置。

第一种方法还要求您`delete`使用`new`.

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-03-17T16:47:48.333

简短的回答是肯定的，“new”关键字非常重要，因为当您使用它时，对象数据存储在堆上而不是堆栈上，这是最重要的！

# php - 如何在一个表中使用多个外键引用 cakephp 中的另一个表

> ID：655068
> 
> 赞同：3
> 
> 时间：2009-03-17T16:45:20.770
> 
> 标签：php, cakephp

使用 cakephp，我有一个通用地址表，我想将其链接到客户、供应商、联系人。大多数表只有一对一的关系，但我希望我的客户表有 2

也许为了澄清：我有一张客户表

```
id, int
mailing_address_id, int
billing_address_id, int 
```

和地址表

```
id,int
addr, varchar
city, varchar
etc.... 
```

现在我知道我可以`customer_id`在地址表中添加一个。但我不想这样做，因为我有一个vendors 表、contacts 表和其他所有都将使用addresses 表的表。与`customer_id`其他表格无关。

我希望客户模型自动链接两个地址

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T00:51:51.380

遵循 Travis Leleu 的建议 - 因为这是个好主意，无论如何。

然后将一个枚举字段添加到`Addresses`名为`table_id`. 该`table_id`字段的值可以是“customer”、“vendor”、“contact”，以及任何其他可以链接到地址表的表。

还包括一个名为`entity_id`. 此外键将是相应客户、供应商或其他任何东西的主键。

例如，当您想要某个供应商的帐单地址时，请在`$conditions`数组中添加：

```
'Address.entity_id'=>'123456'
'Address.table_id'=>'vendor'
'Address.type'=>'billing' 
```

使用此设置，您可以拥有任意数量的表来引用该`Addresses`表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-18T19:13:21.020

我喜欢[Kyle](https://stackoverflow.com/questions/655068/how-do-i-use-multiple-foreign-keys-in-one-table-referencing-another-table-in-cake/684105#684105)和[Travis 的](https://stackoverflow.com/questions/655068/how-do-i-use-multiple-foreign-keys-in-one-table-referencing-another-table-in-cake/655407#655407)建议，但您也可以将外键放在另一个方向。

如果您希望您的地址是独立的并且有几个其他表引用它们，那么您应该能够定义两个从客户到地址的[belongsTo 关系。](http://book.cakephp.org/view/78/Associations-Linking-Models-Together#belongsTo-81)然后，每个关系都必须指定使用哪个字段作为外键。

```
<?php

class Customer extends AppModel {
    var $name = 'Customer';                
    var $belongsTo = array(
        'BillingAddress' => array(
            'className'    => 'Address',
            'foreignKey'    => 'billing_address_id'
        ),
        'MailingAddress' => array(
            'className'    => 'Address',
            'foreignKey'    => 'mailing_address_id'
        )
    );  
}
?> 
```

但是，这两种解决方案都会让您对孤立地址开放，因为外键约束并不真正正确。最简单的解决方案可能是在地址表中添加一堆可选的外键，例如`customer_id`, `company_id`,`employee_id`等等。然后你就有了一个标准的弧形图案，并且键指向正确的方向，所以你得到了正确的参照完整性。

另一种解决方案是设计一个更通用的实体表，将地址作为子表。那么客户、公司和雇员都是实体表的子类型。有关这种模式的更多详细信息，我推荐David Hay 的[Data Model Patterns](https://rads.stackoverflow.com/amzn/click/com/0932633293)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T18:04:41.517

杰克，

也许我没有正确理解这个问题，所以如果我误解了，我深表歉意。

我可能只是在地址表中创建一个枚举字段来记录它是什么类型的地址（帐单或邮寄）。然后，您可以在客户模型和地址模型之间使用直接的 $hasMany 关系。当您执行查询时（例如，您只需要给定客户的帐单地址），只需在 $conditions 数组中指定 'Address.type'=>'billing'。

HTH，特拉维斯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T18:18:45.400

如果客户 HASMANY 地址，使用 has-many 关联：

[http://book.cakephp.org/view/82/hasMany](http://book.cakephp.org/view/82/hasMany)

如果客户 HASONE（并且只有一个）地址，请使用 has-one 关联：

[http://book.cakephp.org/view/80/hasOne](http://book.cakephp.org/view/80/hasOne)

如果客户可能共享相同的地址（相同的记录），您将需要将 HABTM 与您提到的连接表一起使用。

有关 Cake 关联的更多信息：http: [//book.cakephp.org/view/78/Associations-Linking-Models-Together](http://book.cakephp.org/view/78/Associations-Linking-Models-Together)

# database - 数据库设计一对多，其中多为至少一

> ID：655074
> 
> 赞同：3
> 
> 时间：2009-03-17T16:46:11.613
> 
> 标签：database, database-design, schema-design

[与我之前的问题](https://stackoverflow.com/questions/653922/best-schema-design-for-table-relationship-that-enforces-integrity)有点相关，这是关于强制执行表模式的创建模式，其中“A”有许多“B”子级，其中“C”是“A”的子“B”表，但至少有一个。

目前我有：

```
A (A_ID primary key, B_ID reference key)
B (B_ID primary key, etc)
C (A_ID reference, B_ID reference) 
```

关键是A肯定总是至少有一个'B''child'，但可以选择更多..但是我遇到的问题是'C'表当前可以引用'A'已经是相同的'B'隐式引用..

例子：

```
A
- Id: 1
- B_Id: 37

C
- A_Id: 1
- B_Id: 37 
```

限制这一点的最佳方法是什么？注意到可以更新“A”以尝试引用已经在“C”集合中为该“A”声明的“B”，更有可能的是，“C”引用了已经隐含声明的“B”相关的'A'..

希望这是有道理的，并再次提前欢呼。

编辑：表格如下：

'A' 是一个提交，一个提交可以有多个“贡献者”（成员），但总是至少有一个。'B' 是一个成员 'C' 是将一个 'A' 链接到许多 'B' 的表

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T21:29:25.763

将您的抽象模式转换为具体模式，我相信看起来像这样：

*   提交（SubmissionID，PrimaryContributorID，...）
*   贡献者（ContributorID，...）
*   SubmissionContributors (SubmissionID, ContributorID)

这可以为您提供每次提交的“至少一个”贡献者，但这意味着要执行一些奇怪/困难的规则。由于 PrimaryContributorID 存在困难——SubmissionContributors 表中是否存在匹配记录？如果 PrimaryContributor 发生变化，是否需要重新排列 SubmissionContributors 中的记录？如果 PrimaryContributor 没有匹配的 SubmissionContributor 记录，则每次列出提交的贡献者时，都必须在 PrimaryContributor 中联合，等等。

不幸的是，SQL 没有“至少一对多”的关系（反正我不知道 :)），所以你想出的任何解决方案都会涉及一些妥协。

对我来说，最好的方法是删除 PrimaryContributorID；所有贡献者都存在于 SubmissionContributors 表中，并且您将拥有强制执行需求的“至少一个”部分的域逻辑（例如，如果没有至少一个贡献者，插入/更新提交记录的方法将失败，并且方法如果没有至少一个贡献者，读取提交记录将失败）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:57:48.713

我不认为您会希望/需要在两个单独的区域中包含参考。

此外，您希望在一对多关系的多方面获得参考。如果 A 有 1+ B，则 B 表应包含 A 引用，反之亦然。

如果 C 需要返回 A 拥有的 B，只需将 C 设为存储过程或连接 A 和 B 表的视图，这样数据就永远不会不同步。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:38:22.767

也许我不理解和过于简单化，但是如果在 B 和 A 之间设置了主键/外键关系，并且表 A 中 B 的 id 的 fk 字段是必填字段，它不会让您向 A 添加一条在 B 中没有记录的记录。如果它比这更复杂，您可能需要通过 A 上的触发器强制执行规则。

# ajax - 从 Google Analytics 跟踪 Ajax Popover 中的页面

> ID：655093
> 
> 赞同：1
> 
> 时间：2009-03-17T16:50:27.653
> 
> 标签：ajax, seo, google-analytics, popover

我正在寻找跟踪论坛提交时出现的弹出页面：

[http://www.xebra.com/salesAssistance.html](http://www.xebra.com/salesAssistance.html)

我尝试将 urchin/google 分析代码添加到弹出窗口中显示的页面，但每当我这样做时，状态栏都会显示“阅读[http://www.google-analytics.com/](http://www.google-analytics.com/) ”和整个表单页面变为空白。

跟踪弹出窗口中的页面很重要，因为该页面是转换目标（我们试图将人们引导到的页面）。

如何阻止 Google Analytics 破坏我的窗口，同时仍跟踪用户是否去过那里？

谢谢你，
安德鲁·J·李尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:05:29.630

您可以将您的谷歌分析代码分成两部分：

页面顶部的一个：

```
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." :"http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
    var pageTracker = _gat._getTracker("#########");
} catch(err) {}
</script> 
```

另一个就在“end body”标签之前

```
<script>
   pageTracker._trackPageview();
</script> 
```

并调用**pageTracker._trackPageview();** “弹出”窗口的*ajaxComplete*回调中的方法。

# unix - 为什么我的“查找”工作不像我期望的那样使用 -exec？

> ID：655103
> 
> 赞同：14
> 
> 时间：2009-03-17T16:52:30.567
> 
> 标签：unix, shell, find

我正在尝试从工作目录中删除所有 .svn 目录。

我以为我会像这样使用 find 和 rm ：

```
find . -iname .svn -exec 'rm -rf {}' \; 
```

但结果是：

查找：rm -rf ./src/.svn：没有这样的文件或目录

显然该文件存在，或者 find 找不到它......我错过了什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-17T16:55:11.620

你不应该把它`rm -rf {}`放在单引号中。

正如您所引用的，shell 将它的所有参数`-exec`视为命令而不是命令加参数，因此它正在寻找一个调用的文件`"rm -rf ./src/.svn"`而不是找到它。

尝试：

```
find . -iname .svn -exec rm -rf {} \; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T17:00:13.793

顺便说一下，您可能应该改掉使用 -exec 来处理可以一次对多个文件执行的操作的习惯。例如，我会出于习惯将其写为

```
find . -iname .svn -print | xargs rm -rf 
```

或者，因为我现在使用的是 Macintosh，并且更有可能遇到带有空格的文件或目录名称

```
find . -iname .svn -print0 | xargs -0 rm -rf 
```

“xargs”确保每个“N”个文件只调用一次“rm”，其中“N”通常是 20。在这种情况下，这并不是一个巨大的胜利，因为 rm 很小，但如果你想要执行的程序每个文件都很大或者在启动时做了很多处理，它可以让事情变得更快。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-10T22:05:05.627

也许它只是我，但旧的 find & rm 脚本*不适*用于我当前的配置，a la：

> 查找 /data/bin/test -type d -mtime +10 -name "[0-9]*" -exec rm -rf {} \;

而 xargs 解决方案*确实如此*：

> 查找 /data/bin/test -type d -mtime +10 -name '[0-9]*' -print | xargs rm -rf ;

不知道为什么，但我已经更新了我的 scriptLib，所以我不会再花几个小时在这么简单的事情上敲打我的头......

（在 kernel-2.6.18-194.11.3.el5 下运行 RHEL）

**编辑**：找出原因 - 我的 RHEL 发行版默认 vi 将可怕的 cr 插入换行符（其中中断命令） - 遵循 linuxquestions.org 上 nx5000 和 jliagre 的建议，将以下内容添加到 ~/.vimrc：

> ：设置文件格式=unix
> 
> 映射 <F4> :set fileformat=unix<CR>
> 
> 映射 <F5> :set fileformat=dos<CR>

这允许行为以 F4/F5 为中心。

检查 CR 是否嵌入到您的文件中：

> 头 -1 脚本文件.sh | od -c | 头-1

[http://www.linuxquestions.org/questions/linux-general-1/bad-interpreter-no-such-file-or-directory-213617/](http://www.linuxquestions.org/questions/linux-general-1/bad-interpreter-no-such-file-or-directory-213617/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T16:55:57.267

您也可以使用 svn 命令，如下所示：

```
svn export <url-to-repo> <dest-path> 
```

[在这里查看更多信息](http://svnbook.red-bean.com/en/1.0/re10.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T16:55:57.313

尝试

```
find . -iname .svn -exec rm -rf {} \; 
```

这可能应该适用于 IIRC。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-12T22:30:09.490

您可以使用以下技巧在引号中传递您想要的任何内容。

```
find . -iname .svn -exec bash -c 'rm -rf {}' \; 
```

该`exec`选项将很高兴看到您只是使用参数调用可执行文件，但您的参数将能够包含基本上任何大小和形状的脚本。

```
find . -iname .svn -exec bash -c '
  ls -l "{}" | wc -l
' \; 
```

# c# - 奇怪的dll错误信息

> ID：655118
> 
> 赞同：1
> 
> 时间：2009-03-17T16:55:24.040
> 
> 标签：c#, unit-testing, dll

大约 2 周以来，我一直无法为项目运行任何 UnitTests（内置 VS 单元测试）。以前一切正常。错误信息是：

*无法加载文件或程序集“C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\PrivateAssemblies\MyProjectName.XmlSerializers.dll”或其依赖项之一。*

该项目引用 System.Xml.Serialization 并使用 XmlSerializer 类；就像我写的许多其他课程/项目一样。由于某种原因，只有这个项目受到影响。它构建良好，运行良好，我只是无法运行我的单元测试。

我检查了目录，该目录中的所有 dll 都是 Microsoft dll。它正在寻找的 dll 显然不是 Microsoft dll。

有人有想法么？

**编辑：** 它显然与使用 XmlSerializer 有关，它会自动生成该文件，而不是使用 sgen.exe。这是 MSDN[文章](http://msdn.microsoft.com/en-us/library/bk3w6240.aspx)的链接。据我所知，它与使用带有泛型的序列化程序有关。我发现的所有资源似乎都没有提供任何使它真正起作用的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:03:54.080

首先启用加载程序日志记录（`FUSLOGVW.exe`从 SDK 使用）以确认未找到的内容。

然后在所有程序集上使用 Reflector 来查找试图加载不存在的程序集的程序集。如果您没有找到这样的程序集，则它必须是动态加载的，在这种情况下，附加到 AppDomain.AssemblyResolve 应该可以让您确定在哪里。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T17:03:05.190

尝试将所有源文件复制到某处，然后删除该项目并尝试从头开始制作。也许项目依赖项发生了一些事情

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T10:14:58.907

你的电脑是64位的吗？尝试使用设置为 x86 程序集（使用 corflags）的 NUnit 运行 64 位 dll 时，我遇到了同样的错误。

你大概可以从错误信息中找到（使用 FUSLOGVW.exe lick Richard 建议）。

如果是这种情况，您可以使用[corflags](http://blogs.microsoft.co.il/blogs/dhelper/archive/2009/01/22/how-to-run-as-32bit-executable-on-a-64bit-machine.aspx)发送 dll 或 NUnit 作为正确的程序集运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T15:24:11.293

**解决方案**

事实证明，问题出在 VMWare 上。我安装了最新版本的 VMWare，它还安装了在 VM 中调试的工具。它安装或更改的东西导致了这个问题。当我卸载 VMWare 时，问题就消失了。因此，我重新安装了 VMWare，但没有安装它的调试功能，问题也没有出现。

**解决方法**：

我仍然不知道为什么这个问题突然开始出现，但我找到了一个让它工作的黑客。

我必须转到项目属性 => 构建事件并将这一行添加到构建后事件命令行：

```
"C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\Bin\sgen.exe" "$(TargetPath)" /force
```

这会强制 VS 生成文件。然后我不得不手动将该文件复制到它正在寻找它的目录中：

```
"C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\PrivateAssemblies"
```

现在我可以运行我的测试并逐步完成它们。我现在遇到的问题是 1）我必须记住每次更改要序列化的类中的某些内容时都将 dll 复制到该目录，以及 2）当测试完成运行时，我现在得到一个 ThreadInterruptedException；因此 3) 我一次只能运行一个测试。

不是一个好的解决方案，但至少我可以跛行。不幸的是，正如 Nikita Borodulin 建议的那样，重做所有事情并不是一种选择。

# c++ - 对现有应用程序进行运行以进行数据库更改，好主意吗？

> ID：655122
> 
> 赞同：3
> 
> 时间：2009-03-17T16:56:08.577
> 
> 标签：c++, architecture, grails, refactoring

我们有一个现有的“遗留”应用程序，用 C++/powerbuilder 编写，在 Unix 上运行，带有自己的 Sybase 数据库。对于复杂的组织（现有应用程序必须经过大量繁文tape节才能修改）和代码原因（多年来没有进行重构，因此代码是意大利面条），因此很难对这个应用程序进行修改。因此，我正在考虑编写一个新的基于 grails 的现代 Web 应用程序来直接在数据库中执行一些“管理”类型的事情。例如添加用户，或添加“约束行”。

软件社区如何看待这种围绕现有应用程序运行的方法？好主意？提示和提示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:07:36.240

一个单一的应用程序和几个更集中的应用程序之间总是存在争论。我认为将事物分开不一定是一个坏主意-您使事物更加模块化，减少依赖性等。要避免的是功能重复。如果您单独拆分管理应用程序，请确保从旧应用程序中删除该功能，否则您将拥有一组未维护的管理工具，这些工具可能会再次困扰您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T17:04:01.007

好主意？不。

有时有必要吗？是的。

生活在一个你有时不得不做你知道不是一个好主意的事情的世界里？无价。

一般来说，您应该始终遵循最佳实践。对于其他一切，都有杂物。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T17:07:28.003

首先从乔尔那里看到[这个](http://www.joelonsoftware.com/articles/fog0000000069.html)！

更新：我有点误解了这个问题，并认为更多内容正在被重写。

我对您建议的“实用程序”系统的看法并不像我对 Joel 文章的链接所暗示的那样保留。事实上，出于多种原因，我衷心建议您采用这种方法。

首先，这很可能是达到您想要的结果的最快途径，因为旧代码很难使用。

其次，这可以让您体验新的开发技术，并在您现有工作的背景下这样做——这是一个真正的优势。

第三，几年前我在将应用程序从 C++ 转换到 Delphi 时采用了这种方法。随着时间的推移，Delphi 应用程序变得如此强大，以至于可以完全飞跃到该平台。用户在任何时候都不会缺少他们已经知道的功能，因为在替换功能得到验证之前，旧应用程序不会被淘汰。然而，正是在这个阶段，您需要注意 Joel 的警告：请记住，您看到的一些“混乱”实际上是旧代码中包含的知识。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T21:31:54.410

好主意？这取决于数据库的记录和/或理解程度。对一些隐含的应用程序级实现的规则、关系或约束犯了一个错误，你的遗留应用程序可能最终会在过道上做侧手翻。

举一个假设的例子。假设使用旧系统添加用户会将记录添加到下表中：

*   app_users
*   app_constraints
*   应用权限
*   用户地址

假设你抓住了前三个，错过了第四个。不可能很重要吧？但是如果在应用程序中，在使用 app_users 的 50 个位置中，有一个位置与 user_address 进行了内部连接。（为什么不呢？应用程序编写者*知道*他总是向 user_address 写入一条记录！）新添加的用户突然从应用程序的视图中消失，根据原始编码器，这是“永远不会发生”的情况，应用程序咳出一个毛球。不能接受订单。生产停止。一位副总裁对他的新心脏搭桥手术进行了测试。

谁受责备？不是应该为更多异常编写代码的早已离开的开发人员。不是那些设置繁文缛节来控制变化的人。那个完成了结局的人绕过了那些控制。

祝你好运，

特里。

# python - python postgres光标时间戳问题

> ID：655125
> 
> 赞同：5
> 
> 时间：2009-03-17T16:57:23.753
> 
> 标签：python, postgresql, cherrypy

我对事务数据库有些陌生，并且遇到了我试图理解的问题。

我创建了一个简单的演示，其中一个数据库连接存储在cherrypy 创建的5 个线程中的每一个中。我有一个方法可以显示存储在数据库中的时间戳表和一个按钮来添加新的时间戳记录。

该表有 2 个字段，一个用于 python 传递的 datetime.datetime.now() 时间戳，另一个用于设置为默认 NOW() 的数据库时间戳。

```
 CREATE TABLE test (given_time timestamp,
                   default_time timestamp DEFAULT NOW()); 
```

我有两种与数据库交互的方法。第一个将创建一个新游标，插入一个新的 given_timestamp，提交游标，并返回到索引页面。第二种方法将创建一个新游标，选择 10 个最近的时间戳并将其返回给调用者。

```
 import sys
import datetime
import psycopg2
import cherrypy

def connect(thread_index): 
    # Create a connection and store it in the current thread 
    cherrypy.thread_data.db = psycopg2.connect('dbname=timestamps')

# Tell CherryPy to call "connect" for each thread, when it starts up
cherrypy.engine.subscribe('start_thread', connect)

class Root:
    @cherrypy.expose
    def index(self): 
        html = []
        html.append("<html><body>")

        html.append("<table border=1><thead>")
        html.append("<tr><td>Given Time</td><td>Default Time</td></tr>")
        html.append("</thead><tbody>")

        for given, default in self.get_timestamps():
            html.append("<tr><td>%s<td>%s" % (given, default))

        html.append("</tbody>")
        html.append("</table>")

        html.append("<form action='add_timestamp' method='post'>")
        html.append("<input type='submit' value='Add Timestamp'/>")
        html.append("</form>")

        html.append("</body></html>")
        return "\n".join(html)

    @cherrypy.expose
    def add_timestamp(self):
        c = cherrypy.thread_data.db.cursor()
        now = datetime.datetime.now()
        c.execute("insert into test (given_time) values ('%s')" % now)
        c.connection.commit()
        c.close()
        raise cherrypy.HTTPRedirect('/')

    def get_timestamps(self):
        c = cherrypy.thread_data.db.cursor()
        c.execute("select * from test order by given_time desc limit 10")
        records = c.fetchall()
        c.close()
        return records

if __name__ == '__main__':

    cherrypy.config.update({'server.socket_host': '0.0.0.0',
                            'server.socket_port': 8081,
                            'server.thread_pool': 5,
                            'tools.log_headers.on': False,
                            })

    cherrypy.quickstart(Root()) 
```

我希望 given_time 和 default_time 时间戳彼此之间只有几微秒的差距。但是我得到了一些奇怪的行为。如果我每隔几秒添加一次时间戳，则 default_time 不会与 given_time 相差几微秒，但通常与*前一个*given_time 相差几微秒。

```
给定时间 默认时间
2009-03-18 09:31:30.725017 2009-03-18 09:31:25.218871
2009-03-18 09:31:25.198022 2009-03-18 09:31:17.642010
2009-03-18 09:31:17.622439 2009-03-18 09:31:08.266720
2009-03-18 09:31:08.246084 2009-03-18 09:31:01.970120
2009-03-18 09:31:01.950780 2009-03-18 09:30:53.571090
2009-03-18 09:30:53.550952 2009-03-18 09:30:47.260795
2009-03-18 09:30:47.239150 2009-03-18 09:30:41.177318
2009-03-18 09:30:41.151950 2009-03-18 09:30:36.005037
2009-03-18 09:30:35.983541 2009-03-18 09:30:31.666679
2009-03-18 09:30:31.649717 2009-03-18 09:30:28.319693

```

然而，如果我大约每分钟添加一个新的时间戳，那么 given_time 和 default_time 都只有几微秒，正如预期的那样。但是，在提交第 6 个时间戳（线程数 + 1）之后，default_time 与第一个 given_time 时间戳相差几微秒。

```
给定时间 默认时间
2009-03-18 09:38:15.906788 2009-03-18 09:33:58.839075
2009-03-18 09:37:19.520227 2009-03-18 09:37:19.520293
2009-03-18 09:36:04.744987 2009-03-18 09:36:04.745039
2009-03-18 09:35:05.958962 2009-03-18 09:35:05.959053
2009-03-18 09:34:10.961227 2009-03-18 09:34:10.961298
2009-03-18 09:33:58.822138 2009-03-18 09:33:55.423485

```

即使我在每次使用后都明确关闭游标，但似乎前一个游标仍在被重用。如果我在完成后关闭光标并每次创建一个新光标，这怎么可能？有人可以解释一下这里发生了什么吗？

**更接近答案：**

我在 get_timestamps 方法中添加了 cursor.connection.commit() ，现在它为我提供了带有时间戳的准确数据。谁能解释为什么我需要调用 cursor.connection.commit() 当我所做的只是一个选择？我猜每次我得到一个游标时，一个事务就会开始（或继续使用它提交的现有事务单元）。有没有更好的方法来做到这一点，或者我每次得到一个光标时都会坚持提交，不管我用那个光标做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:12:27.680

尝试按照模块文档中的说明调用 c.close()：[http ://tools.cherrypy.org/wiki/Databases](http://tools.cherrypy.org/wiki/Databases)

```
def add_timestamp(self):
        c = cherrypy.thread_data.db.cursor()
        now = datetime.datetime.now()
        c.execute("insert into test (given_time) values ('%s')" % now)
        c.connection.commit()
        c.close()
        raise cherrypy.HTTPRedirect('/')

def get_timestamps(self):
        c = cherrypy.thread_data.db.cursor()
        c.execute("select * from test order by given_time desc limit 10")
        records = c.fetchall()
        c.close()
        return records 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T07:24:44.230

要解决您最近的编辑提出的问题：

在 PostgreSQL 中，`NOW()`不是当前时间，而是*当前**事务开始时*的时间。Psycopg2 可能正在为您隐式启动事务，并且由于事务从未关闭（通过提交或其他方式），因此时间戳会“卡住”并变得陈旧。

可能的修复：

*   经常提交（如果你只做 SELECT 就傻了）
*   设置 Psycopg2 以使用不同的行为来自动创建事务（可能很难做到正确，并且*会*影响应用程序的其他部分）
*   使用不同的时间戳函数，例如`statement_timestamp()`（不符合 SQL 标准，但非常适合这种情况）

在[手册的第 9.9.4 节中](http://www.postgresql.org/docs/8.3/static/functions-datetime.html#FUNCTIONS-DATETIME-CURRENT)，强调了：

> PostgreSQL 提供了许多返回与当前日期和时间相关的值的函数。这些 SQL 标准函数都基于当前事务的开始时间返回值：
> 
> *   `CURRENT_DATE`
> *   `CURRENT_TIME`
> *   `CURRENT_TIMESTAMP`
> *   `CURRENT_TIME(precision)`
> *   `CURRENT_TIMESTAMP(precision)`
> *   `LOCALTIME` `LOCALTIMESTAMP`
> *   `LOCALTIME(precision)`
> *   `LOCALTIMESTAMP(precision)`
> 
> `CURRENT_TIME`并`CURRENT_TIMESTAMP` 提供带有时区的值； `LOCALTIME`并`LOCALTIMESTAMP` 提供无时区的价值。
> 
> `CURRENT_TIME`, `CURRENT_TIMESTAMP`, `LOCALTIME`, 和`LOCALTIMESTAMP`可以选择给定一个精度参数，这会使结果四舍五入到秒字段中的小数位数。如果没有精度参数，则将结果提供给完整的可用精度。
> 
> ...
> 
> 由于**这些函数返回当前事务的开始时间，因此它们的值在事务期间不会改变**。这被认为是一个特性：目的是允许单个事务具有一致的“当前”时间概念，以便同一事务中的多个修改具有相同的时间戳。
> 
> *注意：*其他数据库系统可能会更频繁地推进这些值。
> 
> PostgreSQL 还提供了返回当前语句开始时间的函数，以及调用函数时的实际当前时间。非 SQL 标准时间函数的完整列表是：
> 
> *   `now()`
> *   `transaction_timestamp()`
> *   `statement_timestamp()`
> *   `clock_timestamp()`
> *   `timeofday()`
> 
> `now()`是传统的 PostgreSQL 等价于`CURRENT_TIMESTAMP`. `transaction_timestamp()`同样等价于`CURRENT_TIMESTAMP`, 但被命名为清楚地反映它返回的内容。`statement_timestamp()` 返回当前语句的开始时间（更具体地说，从客户端收到最新命令消息的时间）。 `statement_timestamp()`并 `transaction_timestamp()`在事务的第一个命令期间返回相同的值，但在后续命令期间可能会有所不同。 `clock_timestamp()`返回实际的当前时间，因此即使在单个 SQL 命令中，它的值也会发生变化。`timeofday()`是一个历史性的 PostgreSQL 函数。像 `clock_timestamp()`，它返回实际的当前时间，但作为格式化的文本字符串而不是带有时区值的时间戳。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T17:43:58.553

我已经向选择时间戳的方法添加了一个提交并解决了问题。

```
 def get_timestamps(self):
    c = cherrypy.thread_data.db.cursor()
    c.execute("select * from test order by given_time desc limit 10")
    records = c.fetchall()
    c.connection.commit()  # Adding this line fixes the timestamp issue
    c.close()
    return records 
```

当我所做的只是选择时，谁能解释为什么我需要调用 cursor.connection.commit() ？

# asp.net - 调用 VirtualPathUtility.ToAbsolute 的单元测试代码

> ID：655134
> 
> 赞同：13
> 
> 时间：2009-03-17T17:00:59.393
> 
> 标签：asp.net, .net, unit-testing

我正在尝试对一些调用`VirtualPathUtility.ToAbsolute`.

VS 2008 提供的单元测试工具可以做到这一点吗？如果没有，是否可以使用更高版本的 Visual Studio？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2014-09-04T16:24:10.757

我们已经过了 VS 2008，但对于仍在努力解决此问题的任何人，我在以下网址找到了解决方案：[http](http://forums.asp.net/t/995143.aspx?Mocking+HTTPContext+object) ://forums.asp.net/t/995143.aspx?Mocking+HTTPContext+object 。

在您的测试初始化​​中使用以下代码来覆盖默认的 AppDomain 值。（VirutalPathUtility 静态方法将使用您的新值。）

```
[TestInitialize]
public void Initialize()
{
    // Fake out env for VirtualPathUtility.ToAbsolute(..)
    string path = AppDomain.CurrentDomain.BaseDirectory; 
    const string virtualDir = "/";
    AppDomain.CurrentDomain.SetData(".appDomain", "*");
    AppDomain.CurrentDomain.SetData(".appPath", path);
    AppDomain.CurrentDomain.SetData(".appVPath", virtualDir);
    AppDomain.CurrentDomain.SetData(".hostingVirtualPath", virtualDir);
    AppDomain.CurrentDomain.SetData(".hostingInstallDir", HttpRuntime.AspInstallDirectory);
    TextWriter tw = new StringWriter();
    HttpWorkerRequest wr = new SimpleWorkerRequest("default.aspx", "", tw);
    HttpContext.Current = new HttpContext(wr);
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T17:14:18.470

静态类和方法在单元测试中真的很难使用（这是我试图避免它们的原因之一）。在这种情况下，我可能会围绕静态类开发一个包装器，只包含我使用的那些方法。然后我会用我的包装类代替真正的类。包装类将被构造，以便于模拟。

使用 RhinoMocks 的示例（有点）。请注意，它使用依赖注入为被测类提供包装器的副本。如果提供的包装器为空，它会创建一个。

```
public class MyClass
{
     private VPU_Wrapper VPU { get; set; }

     public MyClass() : this(null) {}

     public MyClass( VPU_Wrapper vpu )
     {
         this.VPU = vpu ?? new VPU_Wrapper();
     }

     public string SomeMethod( string path )
     {
         return this.VPU.ToAbsolute( path );
     }
}

public class VPU_Wrapper
{
    public virtual string ToAbsolute( string path )
    {
         return VirtualPathUtility.ToAbsolute( path );
    }
}

[TestMethod]
public void SomeTest()
{
     string path = "~/path";
     string expected = "/app/path";

     var vpu = MockRepository.GenerateMock<VPU_Wrapper>();
     vpu.Expect( v => v.ToAbsolute( path) ).Return( expected );

     MyClass class = new MyClass( vpu );

     string actual = class.SomeMethod( path );

     Assert.AreEqual( expected, actual );

     vpu.VerifyAllExpectations();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-10-15T19:32:49.787

使用 Microsoft Fakes，我们可以轻松伪造 VirtualPathUtility ToAbsolute 方法。

1.  在 References > Right Click > Add Fakes Assembly 中浏览 System.Web。

使用以下代码

```
using Microsoft.QualityTools.Testing.Fakes;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Web.Fakes;

 public class TestCode
    {
        [TestMethod]
        public void TestSummaryTabLinks()
        {
            using (ShimsContext.Create())
            {
                //Fake VirtualPathUtility ToAbsolute method to Work properly in case of Unit Test Project
                //For Finding Relative url.
                ShimVirtualPathUtility.ToAbsoluteString = (string s) => { return s; };

                MyClass class = new MyClass( vpu );

                string actual = class.SomeMethod( path );

                Assert.AreEqual( expected, actual );

            }
      }

} 
```

# postgresql - 如何强制 Postgresql 8.3 字符串函数接受非字符串数据类型

> ID：655136
> 
> 赞同：1
> 
> 时间：2009-03-17T17:01:23.790
> 
> 标签：postgresql

8.3 文档中有一条[注释](http://www.postgresql.org/docs/current/static/functions-string.html)解释了为什么在我将 Postgresql 从 8.1 升级到 8.3 后我的公司应用程序被破坏了。

有没有一种简单的方法可以将 8.3 版本更改为像 8.1 一样？例如：现在使用 8.3，当我将数据类型作为第一个参数传递给 substr 函数时，我得到一个错误。8.1 版本默默地将数据值转换为字符串值。

应用程序太大，隐式转换伤口解决了问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T19:14:36.187

PG 开发人员 Peter Eisentraut 创建了一个 SQL 脚本来添加缺失的演员表。你可以在[这里](http://petereisentraut.blogspot.com/2008/03/readding-implicit-casts-in-postgresql.html)得到它。

# c# - 将注册表中的密码作为“秘密”保存

> ID：655137
> 
> 赞同：8
> 
> 时间：2009-03-17T17:01:27.270
> 
> 标签：c#, .net, encryption, registry, passwords

我需要将我的用户名/密码存储在某个地方（最好是注册表），以便我的 .Net 应用程序可以使用它们代表用户登录到某些远程服务。我知道可以将值作为“秘密”存储在注册表中，这意味着它们使用 Windows 域用户令牌或其他东西进行了加密。换句话说，我不想自己处理加密。

澄清一下：我不能存储密码的哈希值或加盐或任何东西。这些凭据适用于第 3 方系统，我能够代表我的用户登录到该系统的**唯一方法是以某种方式保留他们的凭据并能够恢复它们。**

所以不管怎样，我隐约记得注册表里有这样一个地方，但细节很模糊。而且我需要在 C# 中执行此操作（尽管如果它是简单的注册表访问，则无关紧要）。

**编辑：**另外一件事，它应该在 Windows 用户会话之间持续存在（如果用户注销和登录后密码不可读，它对我没有帮助）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T17:04:08.697

您可能正在考虑数据保护 API。搜索 MSDN 或[阅读一些博客](http://blogs.msdn.com/shawnfa/archive/2004/05/05/126825.aspx)，看看是否适合您。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T17:05:10.473

您可以尝试使用 System.Security.Cryptography.ProtectedData，它可以使用每个用户的密钥对其进行加密。 [http://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata.aspx。](http://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata.aspx)

它并不完全安全，因为以用户身份运行的代码可以解密数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T17:58:26.960

请记住，如果您可以自动（无需用户输入）检索密码，那么您并不能真正安全地存储任何内容。只要您将解码密钥存储在应用程序中，使用 RSA、对称或其他加密就不会产生影响。一旦有人拿到钥匙，秘密就泄露了。

但是，上面提到的数据保护 API 应该保护同一台机器上其他用户的密码。（[听起来](http://msdn.microsoft.com/en-us/library/aa380261(VS.85).aspx "加密保护数据")DPAPI 使用您的登录凭据进行加密。）

如需更多选项，请查看[威胁缓解](http://msdn.microsoft.com/en-us/library/ms717803(VS.85).aspx "威胁缓解")的 msdn 页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:07:27.130

*   您永远不应将凭据存储为纯文本。使用对称密钥密码。在运行时取出密码。请参阅有关密码学功能的[MSDN 参考。](http://msdn.microsoft.com/en-us/library/aa380252(VS.85).aspx)

# c# - 免费的 C# XML Diff 库或类

> ID：655141
> 
> 赞同：3
> 
> 时间：2009-03-17T17:02:16.097
> 
> 标签：c#, xml, diff

我正在寻找 XML Diff 类或库。我的要求是： - 开源 :) - 输出对象模型 (*) - 相当快（对于 4mb XML）

我正在尝试使用 MS XML Diff and Patch Tools，但我想获取具有 2 个 XML 文件（而不是 HTML 标记）差异的对象列表。

* * *

UPD：感谢您的所有回复。我实施了自己的解决方案；使用 Linq2Xml 并不太难 :) UPD2：对不起，伙计们，但我现在不能在这里发布我的解决方案（实际上我没有得到它，因为我最近改变了我的工作）。我的解决方案也有一些特定的部分，所以它不能以任何方式解决常见问题。主要建议是使用 Linq2Xml，实现你的逻辑并玩得开心:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:39:13.600

如果您想在代码中执行此操作，则不太确定您的帖子。

但是，如果您只是在一个不错的程序之后并排查看两个文档并查看差异并对其进行更改，我会推荐[Beyond Compare 3](http://www.scootersoftware.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T16:12:27.420

我对这个话题做了一些研究。

[用于比较 xml 文件的工具或库](https://stackoverflow.com/questions/547399/tool-or-library-for-comparing-xml-files)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:44:07.020

Microsoft XML Diff and Patch 工具确实为您提供了 2 个 XML 文档之间的差异列表。输出是一个 XML 文档，它告诉您如何将文档 #1 更改为 #2。

# bash - 我想做一个有条件的cronjob

> ID：655149
> 
> 赞同：2
> 
> 时间：2009-03-17T17:03:20.197
> 
> 标签：bash, unix, scripting, cron

我有一个每小时运行的 cron 作业。它访问一个 xml 提要。如果 xml 提要不可用（这似乎每天发生一次），它会创建一个“失败”文件。这个“失败”文件中包含一些元数据，并在下一小时脚本再次运行并且 XML 提要再次工作时被删除。

我想要的是在第一个任务后几分钟运行第二个 cron 作业，查看目录中的“失败”文件，如果存在，重试第一个 cron 作业。

我知道如何设置 cron 作业，只是不知道如何使脚本像那样有条件。我是否以完全错误的方式解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:07:08.300

可能。也许您最好让原始脚本休眠并重试（有限）次。

Sleep 是一个 shell 命令，shell 支持循环，所以它看起来像这样：

```
for ((retry=0;retry<12;retry++)); do
    try the thing
    if [[ -e my_xlm_file ]]; then break; fi
    sleep 300 
    # five minutes later...
    done 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:08:48.250

作为要运行的命令，请尝试：

```
/bin/bash -c 'test -e failurefile && retrycommand -someflag -etc' 
```

如果失败文件存在，它将运行重试命令

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:10:39.103

为什么不让您的脚本在成功完成后触摸状态文件。让它每 5 分钟运行一次，并让脚本的第一次检查是查看状态文件是否小于 60 分钟，如果它是年轻的，则退出，如果它是旧的，则获取。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-02T21:10:25.113

我同意 MarkusQ 的观点，即您应该重试原始作业，而不是创建另一个作业来观看第一个作业。

看看这个工具，使重试更容易：[https ://github.com/kadwanev/retry](https://github.com/kadwanev/retry)

您可以非常轻松地将原始 cron 包装在重试中，并且失败文件的最终存在将指示它是否在重试之后失败。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-12-29T16:49:35.513

如果有人需要`bash`脚本来 ping 端点（例如，通过 运行计划的 API 任务`cron`），重试它，如果响应状态不好，则：

```
#!/bin/bash
echo "Start pinch.sh script.";
# run 5 times
for ((i=1;i<=5;i++))
do
    # run curl to do a POST request to https://www.google.com
    # silently flush all its output
    # get the response status code as a bash variable
    http_response=$(curl -o /dev/null -s -w "%{response_code}" https://www.google.com);
    # check for the expected code
    if [ $http_response != "200" ]
    then
        # process fail
        echo "The pinch is Failed. Sleeping for 5 minutes."
        # wait for 300 seconds, then start another iteration
        sleep 300
    else
        # exit from the cycle
        echo "The pinch is OK. Finishing."
        break;
    fi
done
exit 0 
```

# c# - 如何检测 BindingList 中项目属性的更改 ?

> ID：655158
> 
> 赞同：16
> 
> 时间：2009-03-17T17:05:25.153
> 
> 标签：c#, .net, collections

我有一个具有属性 A 和 B 的自定义类 Foo。我想在数据绑定控件中显示它。

我创建了一个类`Foos : BindingList<Foo>`。

为了更新 Foos 类的一些内部属性，我需要通知列表中项目的属性更改（我可以处理插入、删除等）。您将如何实现该功能？

我应该从支持它的框架中的某个对象继承 Foo 吗？我想我可以创建事件来通知我是否发生变化，但应该这样做吗？或者框架中有一些模式对我有帮助吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-17T17:19:42.797

Foo 应该实现[`INotifyPropertyChanged`](http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.aspx)and[`INotifyPropertyChanging`](http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanging.aspx)接口。

```
public void Foo : INotifyPropertyChanged
{
    public event PropertyChangedEventHandler PropertyChanged;

    private void NotifyPropertyChanged(String info)
    {
        if (PropertyChanged != null)
        {
            PropertyChanged(this, new PropertyChangedEventArgs(info));
        }
    }

    private int _someValue;
    public int SomeValue
    {
        get { return _someValue; }
        set { _someValue = value; NotifyPropertyChanged("SomeValue"); }
    }
} 
```

应该自动连接到您的`BindingList`事件处理程序，并且您的 GUI 现在应该在您设置类调用`PropertyChanged`事件处理程序时更新。

[编辑添加：]此外，`BindingList`该类公开[两个事件](http://msdn.microsoft.com/en-us/library/ms132740.aspx)，当集合被添加或修改时通知您：

```
public void DoSomething()
{
    BindingList<Foo> foos = getBindingList();
    foos.ListChanged += HandleFooChanged;
}

void HandleFooChanged(object sender, ListChangedEventArgs e)
{
    MessageBox.Show(e.ListChangedType.ToString());
} 
```

# asp.net-mvc - 如何获取下拉列表以在 MVC 中发布表单

> ID：655161
> 
> 赞同：6
> 
> 时间：2009-03-17T17:06:12.703
> 
> 标签：asp.net-mvc

我有一个简单的 MVC 视图，其中包含一个下拉列表和一个提交按钮，该按钮发布表单并使用下拉列表的值来更改视图（“值”填充在控制器中）：

```
<% Using Html.BeginForm()%>
<%=Html.DropDownList("values", "No value")%>
<input type="submit" value="Submit" />
<%--rest of page here--%>
<% End Using%> 
```

一旦下拉列表更改，我如何设置它以更改，即消除提交按钮？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-17T17:09:03.477

您可以使用 onchange 事件提交当前表单：

```
<%=Html.DropDownList("values", ViewData["ListData"],
                      new { onchange="this.form.submit();" })%> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T17:09:35.783

我会使用**jquery**进行更改

首先将类添加到您的提交按钮和下拉列表中，如下所示：

```
 <%=Html.DropDownList("values", "No value",new {_class="dropdown"})%>

      <input type="submit" value="Submit" class="submit"/> 
```

然后像这样使用jquery：

```
 $(document).ready(function() {

   $(".dropdown").change({

   $(".submit").hide();
    })
  }); 
```

# c - 将静态库转换为共享库？

> ID：655163
> 
> 赞同：64
> 
> 时间：2009-03-17T17:06:15.200
> 
> 标签：c, linux, shared-libraries, static-libraries

我有一个第三方库，主要由大量静态（`.a`）库文件组成。我可以把它编译成一个单一的`.a`库文件，但我真的需要它是一个单一的`.so`共享库文件。

有没有办法将静态`.a`文件转换为共享`.so`文件？或者更一般地说，有没有一种好方法可以将大量静态`.a`文件与几个`.o`目标文件组合成一个`.so`文件？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-03-17T17:08:23.650

这样做（当然有适当的-L）

```
gcc -shared -o megalib.so foo.o bar.o -la_static_lib -lb_static_lib 
```

不做吗？

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-18T08:11:56.497

如果静态库中的对象是在没有 -fPIC 或类似的情况下编译的，则无法执行此操作。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-09-08T12:57:34.137

```
g++ -shared -o megalib.so foo.o bar.o -Wl,--whole-archive -la_static_lib -lb_static_lib -Wl,--no-whole-archive -lc_static_lib -lother_shared_object 
```

我不确定 gcc，但对于 g++，我必须添加 --whole-archive 链接器选项以将静态库中的对象包含在共享对象中。如果要链接到 libc_static_lib.a 和 libother_shared_object.so，但不将它们作为一个整体包含在 megalib.so 中，则 --no-whole-archive 选项是必需的。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2016-01-13T21:44:06.563

`ar -x`如果您想专注于`.a`s 中的特定对象并且不想自己添加任何内容，这也很有用。

例子：

```
ar -x lib***.a
gcc -shared *.o -o lib***.so 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-05-04T08:24:35.347

```
ar -x lib***.a
gcc -shared *.o -o lib***.so 
```

# ruby-on-rails - 将 Rails Restful Auth App Login 集成到 Wiki（MediaWiki？）的最佳方法是什么

> ID：655174
> 
> 赞同：1
> 
> 时间：2009-03-17T17:08:19.780
> 
> 标签：ruby-on-rails, ruby, authentication, wiki, mediawiki

我有一个使用 RESTful 身份验证的 ruby​​ on rails 应用程序，我希望在我的网站上添加一个 Wiki。MediaWiki 看起来是我最好的选择，因为它功能齐全，而且我可以使用 LAMP 堆栈。但是，如果有另一个（最好是开源的）应用程序可以更好地集成，我不会在 MediaWiki 上出售。

我想知道是否有人可以建议将我的 rails 应用程序的登录与 MediaWiki 集成的方法，这样用户就不必登录两次，或者至少可以在 rails 和 wiki 应用程序中拥有相同的登录凭据。

我查看了 MediaWiki 扩展，但无法真正确定哪个是最佳解决方案。当前的 Rails 应用程序托管在 CentOS 上，带有企业级 ruby​​ 和 phusion。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T00:09:50.337

也许不是最干净的解决方案，但 MediaWiki 提供对 OpenID 的支持。同样，您可以在此处修改 RESTful 身份验证以支持 OpenID。这将在[下面的帖子](http://railsforum.com/viewtopic.php?id=14216)中讨论。

如果您的两个应用程序都支持 OpenID，那么您已经实现了目标。如果这是一个内部解决方案，显然这并不理想。

# python - 使用 Outlook 2003 发送富文本格式电子邮件

> ID：655180
> 
> 赞同：1
> 
> 时间：2009-03-17T17:09:27.187
> 
> 标签：python, email, outlook

我正在尝试使用 Outlook 2003 发送富文本格式的电子邮件。以下代码导致将 RTF HTML 源代码转储到邮件正文中。

我应该怎么做才能解决这个问题，并使 Outlook 显示格式化数据而不是源 HTML？

```
import win32com.client

RTFTEMPLATE = """<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
08.00.0681.000">
<TITLE>%s</TITLE>
</HEAD>
<BODY>
<!-- Converted from text/rtf format -->

<P DIR=3DLTR><SPAN LANG=3D"en-us"><FONT =
FACE=3D"Calibri">%s</FONT></SPAN><SPAN =
LANG=3D"en-us"></SPAN></P>

</BODY>
</HTML>"""

Format = { 'UNSPECIFIED' : 0, 'PLAIN' : 1, 'HTML' : 2, 'RTF'  : 3}
profile = "Outlook"
subject="Subject"
body = "Test Message"

session = win32com.client.Dispatch("Mapi.Session")
outlook = win32com.client.Dispatch("Outlook.Application")
session.Logon(profile)
mainMsg = outlook.CreateItem(0)
mainMsg.To = "test@test.test"
mainMsg.Subject = subject
mainMsg.BodyFormat = Format['RTF']
mainMsg.Body = RTFTEMPLATE % (subject,body)
mainMsg.Send() 
```

编辑：当使用 HTMLBody 而不是 Body 时，Outlook 将邮件检测为 HTML 而不是 RTF。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T17:25:18.133

如果必须使用 RTF，则需要将 HTML 转换为 RTF 格式。查看[zopyx 包](http://pypi.python.org/pypi/zopyx.convert/1.1.9)。

要使用 HTML，请更改以下行：

```
mainMsg.Body = RTFTEMPLATE % (subject,body) 
```

到：

```
mainMsg.HTMLBody = RTFTEMPLATE % (subject,body) 
```

# c# - 将现有的 .cs 文件添加到 VS 2008，而无需 VS 2008 将文件复制到项目

> ID：655184
> 
> 赞同：3
> 
> 时间：2009-03-17T17:09:51.133
> 
> 标签：c#, visual-studio-2008

如何在没有 VS 2008 将文件复制到项目文件夹的情况下将现有 C# 文件添加到 VS 2008 C# 项目？

将现有 C++ 文件添加到 C++ 项目时，VS 2008 不会复制这些文件。它只是使用文件路径。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T17:11:16.187

添加时请注意，对话框上的添加按钮有一个下拉菜单。这允许您“添加为链接”：这不会复制文件。

# project-management - 您如何减轻单人团队的固有风险？

> ID：655186
> 
> 赞同：7
> 
> 时间：2009-03-17T17:10:23.847
> 
> 标签：project-management

可以采取哪些步骤来降低单人团队从事项目的风险，尤其是当这个人是相当初级的程序员时？

我问是因为我*是*那个初级程序员，没有人可以/愿意做代码审查之类的事情。我想，部分问题是我在一家嵌入式软件公司从事网络应用程序的工作，因此大多数员工的专业知识都在不同的领域。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T17:20:20.093

认识到这是一个问题比大多数“初级程序员”所能做的要多:)

不幸的是，大多数雇主没有看到多人在同一任务中的好处（只有缺点）。

由于您的雇主对这一点缺乏了解，请坚持所有常规规则，例如自动化测试、文档和源代码控制。我非常清楚，当一个人在一个项目上工作时，很容易变得自满。

事实是，文档不仅仅是帮助其他人了解您的代码的作用。它也可以帮助你。源代码控制不仅仅是让多个人在一个项目上工作和合并更改，它还有助于提高生产力（从某种意义上说，您可以轻松地恢复更改），强制备份，并让您可以很好地跟踪您的时间和精力都花在了哪里.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T17:19:21.017

源代码控制和自动化测试是对任何环境都有帮助的两件事。仅这两件事就可以减轻一些主要的灾难（丢失的工作、不断变化和重构导致的错误代码）。

除此之外，坚持基本原则： KISS 让你的代码设计尽可能简单，让你的类保持简单，遵循单一职责原则，最重要的是，避免重复（这将极大地指导你的设计）。充分利用您拥有的每一种资源：留言板、其他公司的其他程序员、学校的朋友，以及您可以使用的任何资源。即使有一个可以发送电子邮件的导师也是有帮助的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T17:14:11.357

最佳实践与更大的群体没有太大不同。源代码控制、单元测试、遵循您的语言的风格指南、编写所有内容而不是使用手动流程，并尝试在代码的棘手部分中至少包含一些高级文档和注释。对于重要且难以更改的特定决策，例如您的代码如何与数据库交互，请尝试找出设计良好的项目使用的方法，如有必要，请访问此站点。

单元测试尤其是其他人快速弄清楚你的代码应该如何表现并检查他们的更改是否破坏任何东西的好方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T17:30:08.887

StackOverflow 充满了可用且愿意帮助解决问题并提供建议的人。

除此之外，准备好犯错误并从中吸取教训。

哦，是的，并获得一份 Code Complete 的副本！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T17:28:45.627

正如@MattJ 提到的那样，您足够关心以*尝试*减轻这种风险这一事实意味着比您当前的职位所声称的资历要高得多。

我会说你应该做你所做的所有正常的事情来降低风险，并且在无法获得其他资源的情况下，要么自己做，要么跳过这一步。

这是你能做的最好的。

# .net - DLR 是如何工作的？

> ID：655194
> 
> 赞同：8
> 
> 时间：2009-03-17T17:13:12.140
> 
> 标签：.net, dynamic-language-runtime

.Net 4 将具有 DLR（动态语言运行时）。我知道它将用于 Iron Python 和 Iron Ruby 之类的东西。但这就是它的全部好处吗？

DLR 有什么用处？

DLR 是如何工作的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T17:14:33.727

它有助于让开发人员更轻松地构建动态语言，动态语言与 CLR 以及动态语言（基于 DLR 构建）之间的兼容性。

DLR 建立在顶级 CLR 之上，因此您将能够访问其他 .Net 库。多语言支持使您能够为正确的任务选择正确的语言。DLR 允许开发人员更轻松地[创建自己的动态语言](http://www.dotnetguru.org/us/dlrus/DLR2.htm)（我认为这是很多开发人员的梦想）

它通过使用动态代码生成（在运行时生成代码）来工作[动态类型系统](http://en.wikipedia.org/wiki/Type_system)（在运行时更改类型并允许 DLR 语言拥有一个通用的通信平台）[动态方法调度](http://en.wikipedia.org/wiki/Dynamic_dispatch)（动态调度是能够动态地更改执行的代码）运行时的方法）。

**基本上**，DLR 根据表达式树动态生成代码。表达式树是发送到 DLR 以编译和运行的操作列表。

我认为 DLR 将改变游戏规则。在 DLR 发布之后，我认为您会看到大量新语言的涌现以及现有语言的更多端口。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-29T17:25:54.150

除了充当“动态语言的 CLR 桥”之外，DLR 的另一个有趣用途是充当“（可能）任何结构化逻辑序列表示的 CLR 桥”。

换句话说……“动态语言”可以是 Visio 流程图、XML 文档、存储在数据库中的数据等。DLR 提供了从结构化数据映射到可执行代码的工具。DLR 和 WF 之间存在重叠……很想知道这将如何发挥作用。

如果您考虑 Oslo 所做的事情（提供将结构分层到其他非结构化“数据”的工具），您可以看到这一切都在哪里。Oslo + DLR 可能会在未来几年成为一个非常大的交易。

当然，我们中的一些人不只是等待这一切自行发生。;-)

# sql-server-2005 - 将行转换为 t-sql 中的列 - sql server 2005

> ID：655197
> 
> 赞同：1
> 
> 时间：2009-03-17T17:13:46.553
> 
> 标签：sql-server-2005

我的情况是我在结构中有一张桌子

```
ID, name
 1, 'value1'
 1, 'value2'
 2, 'value3'
 2, 'value4'
 1, 'value5' 
```

我想以下列格式显示上述数据

```
id , combineName
1  ,'value1','value2', 'value5'
2  ,'value3','value4' 
```

在 SQL Server 2005 中是否有一种简单的方法可以做到这一点，还是我必须运行游标才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T17:29:19.713

SQL 2005 有一个 PIVOT 函数，可以满足您的需求。 [http://msdn.microsoft.com/en-us/library/ms177410.aspx](http://msdn.microsoft.com/en-us/library/ms177410.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T23:44:30.930

假设您的数据在 aTable 中：

```
create  FUNCTION toCSV (@id int)

RETURNS varchar(100)

AS

BEGIN

DECLARE @List varchar(100)

SELECT @List = COALESCE(@List + ', ', '') + 
   CAST(name AS varchar(10))

FROM aTable

WHERE ID = @id

RETURN(@list)

END;

go 
```

然后：

从 aTable 中选择不同的 id，dbo.toCSV(id)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:31:45.077

您可以使用嵌套选择来执行此操作，或者更轻松地使用枢轴运算符，尽管您必须事先知道所有可能的值。

如果您希望它是动态的，那么您将需要一个游标和一些动态 SQL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T11:15:18.163

COALESCE 函数的简单示例：

Created one Temp table in which i have put one 9 rows with the help of WHILE loop. The at the Main part i have just take Column to COALESCE function.

DROP TABLE #Material SET NOCOUNT ON CREATE TABLE #Material (

```
MaterialID INT 
```

)

DECLARE @LoopCounter INT DECLARE @MaxLoopCounter INT

SET @LoopCounter = 1 SET @MaxLoopCounter = 10

WHILE (@LoopCounter < @MaxLoopCounter) BEGIN INSERT INTO #Material (MaterialID) VALUES (@LoopCounter) SET @LoopCounter = @LoopCounter + 1 END

/* MAIN PART */ DECLARE @MaterialID VARCHAR(100)

SELECT @MaterialID = COALESCE(@MaterialID + ',','') + CAST(MaterialID AS VARCHAR(100)) FROM #Material

PRINT 'FINAL OUTPUT: '+ @MaterialID

-- SELECT * FROM #Material SET NOCOUNT OFF

# c++ - git and C++ workflow, how to handle object and archive files?

> ID：655202
> 
> 赞同：12
> 
> 时间：2009-03-17T17:14:48.610
> 
> 标签：c++, git, workflow

I use git to interface with an SVN repository. I have several git branches for the different projects I work on.

Now, whenever I switch from one branch to another using 'git checkout ', all the compiled executables and object files from the previous branch are still there. What I would like to see is that switching from branch A to B results in a tree with all object files and binaries from the last time I worked on branch B.

Is there a way to handle this without creating multiple git repositories?

**Update:** I understand that executables and binaries should not end up in the repository. I'm a bit disappointed in the fact that all the branching stuff in git is useless to me, as it turns out I'll have to clone my proxy git repository for every branch I want to start. Something I already did for SVN and hoped to avoid with git. Of course, I don't have to do it, but it would result in me doing a new make most of the time after switching between branches (not fun).

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T17:41:59.183

What you want is a full context, not just the branch... which is *generally* out of scope for a version control tool. The best way to do that is to use multiple repositories.

Don't worry about the inefficiency of that though... Make your second repository a clone of the first. Git will automatically use links to avoid having multiple copies on disk.

**Here's a hack to give you want you want**

Since you have separate obj directories, you could modify your Makefiles to make the base location dynamic using something like this:

```
OBJBASE = `git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1\//'`
OBJDIR = "$(OBJBASE).obj"
# branch master: OBJBASE == "master/", OBJDIR == "master/.obj"
# non-git checkout: OBJBASE == "", OBJDIR == ".obj" 
```

That will but your branch name into OBJBASE, which you can use to build your actual objdir location from. I'll leave it to you to modify it to fit your environment and make it friendly to non-git users of your Makefiles.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T17:39:05.777

This is not git or svn specific - you should have your compiler and other tools direct the output of intermediate files like .o files to directories that are not under version control.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-12-11T16:25:20.267

To keep multiple checkouts of the same repo, you can use git --work-tree. For example,

```
mkdir $BRANCH.d
GIT_INDEX_FILE=$BRANCH.index git --work-tree $BRANCH.d checkout $BRANCH 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T18:10:08.757

You could set your IDE compiler to generate all private temporary files (.class and so on) in `<output>\branchName\...`.

By configuration your compilation setting branch by branch, you can register the name of the branch in the output directory path.

That way, even if though private files remain when you `git checkout`, your project on the new branch is ready to go.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-18T16:12:28.637

In the `contrib/` directory of the `git` distribution, there is a script called `git-new-workdir` that allows you to checkout multiples branches in different directories without cloning your repository.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T17:32:39.830

Those files aren't tracked by Git or Subversion, so they're left alone on the assumption that they are of some use to you.

I just do my checkouts in different directories. Saves me the trouble of doing cleanup.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T15:06:39.163

A make clean should not be necessary because files that are different between different branches get checked out with the actual date!!!

This means that if your Makefile is correct, only those object-files, libs and executables are compiled again that really changed because of the checkout. Which is exactly the reason a makefile is there in the first place.

The exception is if you need to switch compiler options or even compilers in different branches. In that case probably git-new-workdir is the best solution.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-10T19:08:43.193

**If the compiled executables are files that have been checked in**
then git stash solves the problem.

```
[compile]
git stash save "first branch"
git checkout other_branch
[Fiddle with your code]
[compile]
git stash save "second branch"
git checkout first_branch
git stash apply [whatever index your "first branch" stash has]
# alternatively git stash pop [whatever index...] 
```

**If the compiled executables are files that have not and will not be checked in**
then simply add them to .gitignore

# c# - 我应该在哪里存储自定义控件（用户控件）的配置数据？

> ID：655208
> 
> 赞同：1
> 
> 时间：2009-03-17T17:18:02.923
> 
> 标签：c#, asp.net, user-controls, custom-controls

我正在编写一个自定义控件，我想为该控件添加一些配置选项，但我不确定应该将它们放在哪里。

我可能可以将它们放在`web.config`我正在使用控件的应用程序中，但这对我来说似乎有点混乱。

我应该做什么？

编辑：配置数据通常会处理非常简单的东西，比如文件路径信息等。它们不会是最终用户更改的东西，而是开发人员在设计时设置的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T17:27:18.953

在控件类或您使用它的应用程序中仅使用常规 .xml 文件怎么样？

当你说你不想把它放在你的 web.config 文件中时，我理解你的意思。我们有一个应用程序，它在 web.config 中有很多配置选项，并且变得难以管理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:03:05.297

控件的配置选项有哪些示例？

如果您希望最终用户能够更改它们，您可以在用户控件中公开属性，您可以在 .aspx 文件（或后面的代码）中绑定这些属性。属性也可以有默认值。如果您的配置选项非常复杂，那么此选项可能不适合您，但如果它们是简单类型，则可能。

-

另见（可绑定属性）

[http://msdn.microsoft.com/en-us/library/system.componentmodel.bindableattribute.aspx](http://msdn.microsoft.com/en-us/library/system.componentmodel.bindableattribute.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T18:18:30.377

这些配置选项是否适用于控件的每个实例？如果是这样，那么它们属于 web.config，这是所有配置应该去的地方。使用自定义配置部分，以便它们可以被强类型化和验证。

如果这些选项从控件的一个实例到另一个不同，那么，正如 Aaron Hoffman 所说，它们应该是可绑定的属性，并让调用者决定如何处理它们。

# vb.net - Understanding Variables in Visual Basic

> ID：655209
> 
> 赞同：0
> 
> 时间：2009-03-17T17:18:11.317
> 
> 标签：vb.net, variables, variant

What's the main problem if I don't declare the type of a variable? Like, `Dim var1` versus `Dim var1 as Integer`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T17:25:16.260

The main reason to declare variable types in languages which allow you to use variant types is as a check on yourself. If you have a variable that you're using to hold a string, and then by accident you pass it to a function that expects an integer, the compiler can't tell *you* that you messed up unless you told *it* that that variable was supposed to always be a string. Instead, you're stuck with your string being reinterpreted as an integer, which is pretty much never going to give you what you want and the results will likely be confusing, and it will be hard to track down the bug.

In pretty much all languages there are a lot of constructs where you could leave it out and your program would work, but exist as a check on the programmer. The first job of a compiler is to make your code into an executable. But the second job of the compiler is to try as much as possible to make sure that the programmer didn't make a mistake. Especially when your program gets large, it's easier to let the compiler find mistakes like this as opposed to trusting that you typed everything exactly right.

Additionally, there is usually some processing overhead associated with variants, but this is a more minor concern.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T17:28:42.867

There are a few reasons:

*   Vastly improved type safety.
*   Lower cognitive overhead; the compiler and Intellisense can help you.
*   Lower performance overhead; transforming things to and from `Variant` types has a small but nontrivial cost.
*   Eliminates need for naming warts (e.g., `lblTitle` to tell you that something is supposed to hold a `Label`).
*   Moves some kinds of runtime errors to compile-time errors, which is a big productivity win.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:23:54.267

Someone else already mentioned Intellisense, but but it's worth repeating.

Additionally, when you declare an explicit type for your variable you make it possible for the compiler to do all kinds of extra type checking and validation on your code that would not otherwise be possible. What happens is that now certain kinds of very common error are caught *and fixed* at compile time rather than run time. The user never sees them. You don't want to leave errors for run-time.

You say "it could be anything" — and that is true. But you then go on to say "so it must be good". That doesn't necessarily follow, and it's very dangerous. Not everything can be assigned or combined with everything else. It could be anything — but it *is* something, or rather some specific thing. Without an explicit type, the compiler has no way to know what and can't help you avoid errors.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:20:04.790

Superficially, if you don't declare the type, Intellisense can't help you with it because it doesn't know what type it is.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T01:22:43.050

Contrast this to Python's typing system. Python allows a developer to use a variable without declaring type in advance but once a variable is used, the type is fixed. A variant, by contrast, can be assigned any type of value initially and a different type can be stored later on without any warning or complaint. So you can put a string into a variable that previously held a numeric.

```
Dim myvar1
myvar1 = 1

'A whole lot more code 

myvar1 = "this string" 
```

If you ever have to maintain someone else's code, you'll start to understand why this sort of thing (changing a variable type silently) can be extra tough to maintain. Especially if you're using a module level variable this could lead to some really interesting problems. This is along the same lines as using Option Explicit in VB code. Without Option Explicit you can do this sort of thing without realizing it:

```
myvar1 = 1

'A whole lot more code here too

myvarl = 2 
```

In some fonts those two variable names would be impossible to distinguish and this could lead to some tough to find bugs.

# iis - IIS -> Isapi_Redirect -> Tomcat

> ID：655213
> 
> 赞同：3
> 
> 时间：2009-03-17T17:18:59.910
> 
> 标签：iis, tomcat, isapi, isapi-redirect

几天来，我一直在尝试通过 Jakarta 连接器通过 IIS 启动和运行 Tomcat。

我已按照 Microsoft 的所有说明进行操作——将连接器 .dll 放入 %tomcatdir%\bin\win32\i386\，添加注册表项，将过滤器（指向 .dll）添加到默认网站...然而，每当我尝试访问 Tomcat Web 应用程序时，都会收到“您无权查看此页面”错误。

有没有人经历过这个？帮助！

谢谢，-丹

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T17:26:24.760

[http://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/win32/jk-1.2.14/isapi_redirect-1.2.14.exe](http://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/win32/jk-1.2.14/isapi_redirect-1.2.14.exe)

我将此重定向与 Tomcat 5.5 和 IIS 5 或 6 一起使用。我没有在 IIS 7 上尝试过。

您必须修改 uriworkermap.properties 文件以选择要重定向的路径，但除此之外它几乎可以直接运行。它会为您添加所有注册表垃圾。

啊，除了在 IIS 6 上，您必须将 isapi redirect.dll 添加到其应用程序白名单中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-08-11T12:38:41.200

试试这个朋友，它可以帮助你。

[http://itgration.blogspot.com/2016/04/configuring-tomcat-connector-for-iis-8.html](http://itgration.blogspot.com/2016/04/configuring-tomcat-connector-for-iis-8.html)

它告诉您如何通过 IIS 配置对 tomcat 网站的访问以及将 tomcat 服务器设置为 Windows 服务然后通过端口 80 将网站转发到 IIS 的必要条件。您将通过在 IIS 中安装自定义 ISAPI 过滤器来完成此操作，该过滤器了解如何使用AJP协议（Apache JServ Protocol）与tomcat通信。主要思想是使用可从 apache 网站下载的 Tomcat 连接器 ISAPI。我将它与 IIS 8 和 7 一起使用

# wcf - WCF 服务调用 - 未添加任何引用

> ID：655220
> 
> 赞同：1
> 
> 时间：2009-03-17T17:20:14.947
> 
> 标签：wcf, service, testing

我想调用 wcf 服务在 http 层上进行测试。我不想添加服务引用并创建代理和调用。我想创建一个新的 Web 测试（VSTS），它向服务发送一个 http 请求，并将 http 正文中的请求作为 xml 发布（Http post）。

我有服务元数据，我可以通过它查看数据合同，但 wsdl:operation 只有操作名称，wsdl:input 只是空白。

在 Contary 上，asmx 服务将在元数据中包含soap 请求，可以将其复制为 http 请求正文，并替换参数。

如何仅通过查看服务元数据（也无法访问服务日志）从头开始构建 wcf 服务 xml 主体，已经到了终点。

有点像

```
<root>
 <element1>element1</element1>
 <element2>element2</element2>
</root> 
```

但是，如何找出这个，root 必须是类似的东西

```
<FunctionRequest xmlns=""http://schemas...."" xmlns:i=""http://www.w3.org/2001/XMLSchema-instance""> 
```

（经过本地服务测试并有效）

现在，无法访问服务日志（svctraceviewer 日志），无法添加服务引用，无法使用 svcutil.exe（基于证书的服务），仅使用元数据 - wsdl，有没有办法找出请求那是要送去服务？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T21:23:38.817

好吧，您将必须创建代理 - 通过添加服务引用或在服务元数据上运行 svcutil 来静态创建代理，或者如果您愿意，您可以完全在代码中动态构建它。

在这种情况下，您必须准备好您的服务合同 (ISomethingService)，并查看[ChannelFactory < ISomethingService > ()](http://msdn.microsoft.com/en-us/library/ms734681.aspx)概念 - 这应该可以帮助您入门。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-09T08:07:08.693

是的，你可以，但你必须先做一些工作。

通过在 wsdl/xsd 元数据上运行 svcutil.exe 来构建服务客户端。这将使用您的服务和数据合同对象生成 ac#。使用 csc.exe 将其编译为程序集。

查看soap信封*主体*，您可以创建一个请求对象并使用数据合约序列化程序手动对其进行序列化。或者，您可以在[WcfSvcHost.exe](http://msdn.microsoft.com/en-us/library/bb552363.aspx)中托管程序集并将 wcf 日志记录添加到配置文件中。在任何一种情况下，您都将只有正确的 xml 正文，如果实际服务使用 xml 序列化程序而不是数据协定序列化程序，即使这样也可能是错误的。

下一部分是困难的部分，因为您需要了解实际服务的安全模型。如果它只使用证书进行 SSL 和服务器识别，您应该能够使用 WebClient 发送 xml。但是，如果它使用相互证书和/或安全令牌，您几乎必须使用正确的绑定手动创建一个通道工厂。

# c# - 列表框中的数据绑定工具提示

> ID：655223
> 
> 赞同：0
> 
> 时间：2009-03-17T17:20:33.370
> 
> 标签：c#, .net, wpf, xaml

我正在将 xml 结构绑定到列表框。我对此感到很困惑。如何将数据模板放入数据模板中，或者我需要使用 hirarchialdatatemplate ...例如从 xml 中，我想在列表框中显示汽车的品牌名称，我想要将相应的 Suv 显示为工具提示或上下文菜单。如何执行此操作..请帮助..任何输入都将非常有帮助..我的 xml 文件结构如下所示

```
<XmlDataProvider x:Key="src">
    <x:XData>
        <Automobiles>
            <Id>24</Id>
            <Category>Cars</Category>
            <MakeName>Audi</MakeName>
            <Suvs>
                <SuvId>Item1</SuvId>
                <SuvId>Item1</SuvId>
                <SuvId>Item1</SuvId>
                <SuvId>Item1</SuvId>
            </Suvs>
            <IsPanel>1</IsPanel>
            <IsFav>1</IsFav>
        </Automobiles>
    </x:XData>
</XmlDataProvider> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T22:40:48.530

我修改了您的 XML 格式以支持多个汽车组：

```
 <XmlDataProvider x:Key="src">
        <x:XData>
            <Automobiles xmlns="">
                <Automobile>
                    <Id>24</Id>
                    <Category>Cars</Category>
                    <MakeName>Audi</MakeName>
                    <Suvs>
                        <SuvId>audiItem1</SuvId>
                        <SuvId>audiItem2</SuvId>
                        <SuvId>audiItem3</SuvId>
                        <SuvId>audiItem4</SuvId>
                    </Suvs>
                    <IsPanel>1</IsPanel>
                    <IsFav>1</IsFav>
                </Automobile>
                <Automobile>
                    <Id>24</Id>
                    <Category>Cars</Category>
                    <MakeName>BMW</MakeName>
                    <Suvs>
                        <SuvId>bmwItem1</SuvId>
                        <SuvId>bmwItem2</SuvId>
                        <SuvId>bmwItem3</SuvId>
                        <SuvId>bmwItem4</SuvId>
                    </Suvs>
                    <IsPanel>1</IsPanel>
                    <IsFav>1</IsFav>
                </Automobile>
            </Automobiles>
        </x:XData>
    </XmlDataProvider> 
```

我连接了上下文菜单和工具提示。以下是我连接绑定的方式：

```
<ItemsControl ItemsSource="{Binding Source={StaticResource src}, XPath=/Automobiles/Automobile}">
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <StackPanel.ContextMenu>
                            <ContextMenu ItemsSource="{Binding XPath=Suvs}">
                                <ContextMenu.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="SUV ID: " />
                                            <TextBlock Text="{Binding XPath=SuvId}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ContextMenu.ItemTemplate>
                            </ContextMenu>
                        </StackPanel.ContextMenu>
                        <StackPanel.ToolTip>
                            <ListBox ItemsSource="{Binding XPath=Suvs/SuvId}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="SUV ID: " />
                                            <TextBlock Text="{Binding InnerText, StringFormat={}}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </StackPanel.ToolTip>
                        <TextBlock Text="Make: " />
                        <TextBlock Text="{Binding XPath=MakeName}" />
                    </StackPanel>
                </Grid>
            </DataTemplate>
        </ItemsControl.ItemTemplate> 
```

# iphone - UIWebView 底面

> ID：655225
> 
> 赞同：6
> 
> 时间：2009-03-17T17:20:52.700
> 
> 标签：iphone

有没有办法改变页面过度滚动时看到的 UIWebView 的灰色底面的颜色？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-18T01:31:34.323

只需设置`backgroundColor`属性。下面我提到了 swift 3 语法，目前 Xcode 提供了颜色板来代替 Color，用于提颜色

```
webview.backgroundColor = Color.white 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-11T12:10:40.203

```
[self.webView setBackgroundColor:[UIColor clearColor]];
for(UIView* subview in [self.webView1 subviews]){
  if([subview respondsToSelector:@selector(setBackgroundColor:)]){
    [subview setBackgroundColor:[UIColor clearColor]];
  }
  for(UIView* imageView in [subview subviews]){
    if([imageView isKindOfClass:[UIImageView class]]){
      imageView.hidden = YES;
    }
  }
} 
```

# php - PHP/SQL：ORDER BY 或排序（$array）？

> ID：655226
> 
> 赞同：7
> 
> 时间：2009-03-17T17:21:34.180
> 
> 标签：php, sql, arrays

您认为在 PHP 脚本中哪个更快：

```
$query = "SELECT... FROM ... ORDER BY first_val"; 
```

或者

```
while($row = odbc_fetch_array($result))
    $arrayname[] = array(
        "first_key" => $row['first_val'],
        "second_key" => $row['second_val'],
        etc...
    );
sort($arrayname); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T17:24:15.873

这取决于很多因素，我什至不知道从什么开始。

但通常，您在数据库端执行排序。

索引、排序规则和所有这些，它们都有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T17:37:20.787

> 您认为在 php 脚本中哪个更快：

`ORDER BY`不在 PHP 脚本中执行 - 它在 PHP 脚本检索数据之前在数据库中执行。抱歉，如果这看起来很迂腐，我只是想确保您理解这一点。

无论如何，我会使用的原因`ORDER BY`是数据库可以访问数据库中的索引和缓存页面。PHP 中的排序当然是对内存中的数据集进行排序，但无法访问任何索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:24:20.037

如果有序字段被索引，我会说可能是 SQL 查询。如果不是，我不确定，但我无法想象这两种方式都会过于引人注目，除非您正在处理大量荒谬的行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T17:27:02.060

ORDER BY 几乎总是更快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T21:32:03.680

在我看来，没有什么比实际计时更重要的了，所以你真的非常肯定地知道：

```
$time_start = microtime(true);

// Try the ORDER BY and sort($array) variants here

$time_end = microtime(true);
$time = $time_end - $time_start;

echo "It took $time seconds"; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T23:05:37.730

如果第一个查询有 LIMIT，并且没有 LIMIT 的查询将匹配的行集比 LIMIT 大得多，那么查询上的 ORDER BY 肯定更快。

也就是说，如果您需要从 10,000 行表中的前 50 行，那么让数据库为您排序并只返回前 50 行比检索所有 10,000 行并自己排序要快得多php。这可能代表了现实世界应用程序中将发生的绝大多数情况

如果在任何情况下，PHP 中的排序甚至具有可比性，那么它们很少而且相差甚远。

此外，SQL 排序功能更强大——对多个列、子查询、聚合函数的返回值等进行排序很简单。

# wcf - 从 WCF/.Net 向 WSDL 输出添加注释

> ID：655234
> 
> 赞同：23
> 
> 时间：2009-03-17T17:24:55.763
> 
> 标签：wcf, wsdl

根据 W3 中的 WSDL 规范，可以将“wsdl:document”标签添加到 WSDL 输出中，以便使用该 Web 服务的人对该 Web 服务有更好的解释/文档。

有谁知道如何让 WCF 使用这些注释/描述，或者如何在 C# 中编写将这些注释作为 wsdl 的一部分导出的代码？

谢谢，迈克尔

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-03-12T09:51:43.590

似乎 GitHub 上的社区项目[WCFExtras](https://github.com/lamronby/wcfextrasplus)提供了一种解决 .NET 3.5 限制的方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T16:34:26.397

如果您在 C# 类中进行设计/编码，并装饰有 [ServiceContract] 和 [OperationContract]，那么不幸的是，我不知道有任何方法可以将您可能拥有的关于这些类和方法的文档导出到 WSDL 中。

我也对此感到震惊——我希望任何/// 对我的类和方法的评论都会出现在 WSDL 中——不走运:-(

我们现在的解决方案是：1）我们使用 C# 中的所有操作创建服务接口的基本“模型” 2）我们将其编译成程序集 3）我们从该程序集中提取元数据（WSDL、XSD）然后丢弃C#“原型” 4) 我们手动添加注释 (xs:annotation/xs:documentation) 到 WSDL 和 XSD 5) 从现在开始，WSDL/XSD 是主要的 - 我们从这些描述中生成我们的界面

麻烦又烦人，但它对我们来说还算可以。

我当然希望 VS2010 / WCF 4.0 能给我们在这方面带来更多的支持！！

马克

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-06-27T23:47:14.820

[http://msdn.microsoft.com/en-us/library/aa717040.aspx](http://msdn.microsoft.com/en-us/library/aa717040.aspx)

我认为这会做你想要的，但它只适用于 .NET 客户端。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T02:02:35.870

不幸的是，WCF 不会自己做。WSDL 生成有一些扩展点，您可以使用它们至少部分地完成此任务：查找 [IWSDLExportExtension](http://msdn.microsoft.com/en-us/library/system.servicemodel.description.iwsdlexportextension.aspx)接口。

我有一个关于如何在我的网站上实现简单的 WSDL 导出扩展的[小示例，这可能会帮助您入门。](http://www.winterdom.com/wcf/winfx/web%20services/2006/09/19/asampleiwsdlexportextensionforwcf.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-30T22:02:48.347

```
[WebService(Namespace = "XXXXXXXXXXXXX", **Description**="V0.2.42")] 
```

描述将您想要的任何内容放入 .NET 4.0 中，不确定哪些版本......可能回答得有点晚，但答案似乎比向 WSDL 添加简介所需的复杂，只有开发人员才能看到。

# dns - DNS RFC是否允许根域CNAME到其他域？

> ID：655235
> 
> 赞同：23
> 
> 时间：2009-03-17T17:25:08.273
> 
> 标签：dns, cname

我们正在托管我们许多客户的页面。我们希望能够为我们的客户提供我们自己域的子域，例如 customerpages.ourdomain.com，以便他们可以为该子域创建 CNAME。

```
www.customer1.com CNAME customerpages.ourdomain.com.  {This will work just fine.} 
```

但情况是我不知道我们所有的客户是否都可以放置以下 CNAME

```
customer1.com CNAME customerpages.ourdomain.com 
```

最后一个 CNAME 看起来像是违反了 DNS 的 RFC。

任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-17T18:08:10.587

不，您不能这样做 -`CNAME`记录只能作为单个记录存在，并且不能与任何其他资源记录组合（DNSSEC 记录除外）。

每个域的顶部始终存在显式`SOA`和记录，因此可以防止在层次结构的同一部分使用。`NS``CNAME`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T19:08:14.483

[确实，给定域 example.com，如果您为 example.com 和www.example.com](http://www.example.com)设置 CNAME 记录，一些 DNS 服务器（一个是小域名）不会抱怨。但我仍然会避免它，因为它会破坏 example.com 的电子邮件（请参阅 RFC 2821“[地址解析和邮件处理](https://www.rfc-editor.org/rfc/rfc2821#section-5)”）。

# http-headers - 内容类型标头的 RFC？

> ID：655240
> 
> 赞同：0
> 
> 时间：2009-03-17T17:25:46.587
> 
> 标签：http-headers, rfc

我看过@ [rfc 2231](http://www.faqs.org/rfcs/rfc2231.html)和[2183](http://www.faqs.org/rfcs/rfc2183.html)。处理多部分/相关的 mime 有效负载。

如果以下语法正确，我正在尝试解密，特别是第一个 Content-Type 的“开始”属性，但我无法找到正确的 RFC。

```
Content-Type: multipart/related; boundary="=_34e1b39f5c290f66360ff510d4c38da4";  type="application/smil"; start="<cid:eaec2c30d892902b14044d57dbb6ff85>"

--=_34e1b39f5c290f66360ff510d4c38da4
Content-ID: <eaec2c30d892902b14044d57dbb6ff85>
Content-Type:  application/vnd.oma.drm.message; boundary=ihvdxymhvdhobklkqbcn;
 name="IrishJi2.dm";
Content-Disposition: attachment;
 filename="IrishJi2.dm";

--ihvdxymhvdhobklkqbcn
Content-Type: audio/mpeg
Content-Transfer-Encoding: binary 
```

一些好奇的背景信息。application/vnd.oma.drm.* 文件类型只是一个有效载荷项目（mp3、jpg 等）的包装器，它告诉蜂窝设备包装的文件将被视为受保护的有效载荷，并且不允许它被转发或转移反正电话里。如果不是出于合同义务，我只会撕掉包装，发送有效载荷，然后开心，但这太容易了，而且可能是非法的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:28:27.907

来自[**RFC 2387**（MIME 多部分/相关内容类型）](http://www.ietf.org/rfc/rfc2387.txt)：

> **3.2\. 启动参数**
> 
> `start`参数，如果给定，是复合对象的`content-ID`“根”。如果不存在，“根”是 Multipart/Related 实体中的第一个主体部分。“根”是应用程序首先处理的元素。

# git - 忽略git中修改（但未提交）的文件？

> ID：655243
> 
> 赞同：202
> 
> 时间：2009-03-17T17:27:00.267
> 
> 标签：git, git-svn, ignore

我可以告诉 git 忽略已修改（删除）但不应提交的文件吗？

情况是我在 repo 中有一个子目录，其中包含我根本不感兴趣的东西，所以我删除了它以防止它出现在自动完成等（在 IDE 中）。

但是现在，如果我将该文件夹添加到 .gitignore，则没有任何变化，所有内容都显示为 git status 已删除。

有没有办法让 git 忽略它？

（或者，当我使用 git-svn 时，我可以将更改提交到本地 git 并确保它们不会传递到 svn 存储库吗？）

* * *

## 回答 #1

> 赞同：298
> 
> 时间：2009-04-17T16:22:14.873

查看[git-update-index 手册页](https://git-scm.com/docs/git-update-index#_using_assume_unchanged_bit)和 --assume-unchanged 位和相关的。

当我遇到你的问题时，我会这样做

```
git update-index --assume-unchanged dir-im-removing/ 
```

或特定文件

```
git update-index --assume-unchanged config/database.yml 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2012-02-29T17:17:23.647

一个更新更好的选择是 `git update-index --skip-worktree`不会在硬重置或拉动的新变化时丢失。

请参阅[手册页](https://git-scm.com/docs/git-update-index#_skip_worktree_bit)。

并在[http://fallengamer.livejournal.com/93321.html进行比较](http://fallengamer.livejournal.com/93321.html)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2017-04-20T05:56:41.153

使用此代码

```
git update-index --assume-unchanged file-name 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-17T21:09:44.857

我通常做的是

```
git stash

git whatever-else

git stash apply

git stash clear 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-17T17:37:24.017

跟踪的文件不能被忽略，因此您必须先将它们从索引中删除。添加一个`.gitignore`忽略您不想要的目录的目录，然后删除它们，并使用`git rm --cached`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-11-09T10:27:36.673

**在我的情况下有效：**

### `git restore --staged filename`

例子：`git restore --staged index.js`

# deployment - 图标未显示在 CAB 安装程序中

> ID：655247
> 
> 赞同：0
> 
> 时间：2009-03-17T17:27:28.893
> 
> 标签：deployment, cab, smart-device

我在智能设备应用程序的 VS 项目中添加了 icon.ico 文件（自定义）。我还创建了一个 CAB 安装程序项目。icon.ico 应该会自动显示为快捷方式图标，但它对我不起作用。我是否必须手动将 icon.ico 添加到我的 CAB 安装程序项目中？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-02T17:46:40.277

它是自动出现的，我猜 VS 正在缓存它。

# c++ - 二进制补码形式

> ID：655257
> 
> 赞同：0
> 
> 时间：2009-03-17T17:29:52.850
> 
> 标签：c++, binary, twos-complement

在 TC++ 编译器中，**5**的二进制表示是**(00000000000000101)**。我知道负数存储为 2 的补码，因此二进制中的**-5**是**(111111111111011)**。最高有效位（符号位）是 1，表示它是负数。

那么编译器如何知道它是**-5**呢？如果我们将上面给出的二进制值**(111111111111011)**解释为无符号数，结果会完全不同吗？

另外，为什么 1 是**5** **-6 (1111111111111010)**的补码？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T17:34:31.480

**编译器不知道**。如果你投到`-5`你`unsigned int`会得到`32763`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T17:35:51.400

编译器知道，因为这是 CPU 原生使用的约定。您的计算机有一个 CPU，它以二进制补码表示法存储负数，因此编译器也会效仿。如果您的 CPU 支持一个补码表示法，编译器将使用它（顺便说一下，IEEE 浮点数就是这种情况）。

有关该主题的 Wikipedia 文章解释了[二进制补码](http://en.wikipedia.org/wiki/Two%27s%5Fcomplement)符号的工作原理。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T17:36:07.250

处理器实现有符号和无符号指令，它们将以不同的方式对二进制数表示进行操作。编译器根据所涉及的操作数的类型（即`int`vs. `unsigned int`）知道要发出哪些指令。

编译器不需要知道一个数字是否为负，它只是为所涉及的类型发出正确的机器或中间语言指令。这些指令的处理器或运行时的实现通常不太关心数字是否为负，因为二进制补码算法的公式对于正数或负数是相同的（事实上，这是主要的补码算法的优势）。需要*知道*一个数字是否为负数`printf()`，就像 Andrew Jaffe 指出的那样，设置的 MSBit 表示二进制补码中的负数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T17:31:55.963

第一位仅为负数设置（称为符号位）

详细信息可[在此处获得](http://en.wikipedia.org/wiki/Two%27s_complement)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T17:40:54.960

二进制补码的kewl部分是机器语言加法和减法指令可以忽略所有这些，只做二进制算术，它就可以工作......

即，-3 + 4

在二进制 2 的补码中，是

```
 1111 1111 1111 1101   (-3)
+  0000 0000 0000 0100   ( 4)
   -------------------
   0000 0000 0000 0001   ( 1) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-12-03T09:49:17.253

举个例子：我们在二进制的两个字节中有两个数字：A = 10010111 B = 00100110（注意机器不知道这个级别有符号或无符号的概念）

现在当您说“添加”这两个时，机器是什么？它只是添加：

R = 10111101（和进位位：1）

现在，我们——作为编译器——需要解释这个操作。我们有两个选择：数字可以有符号或无符号。

1-无符号情况：在c中，数字是“无符号字符”类型，值是151和38，结果是189。这是微不足道的。

2 - 带符号的情况：我们，编译器，根据它们的 msb 解释数字，第一个数字是 -105，第二个数字仍然是 38。所以 -105 + 38 = -67。但是 -67 是 10111101。但这就是我们在结果 (R) 中已有的内容！结果是一样的，唯一的区别是编译器如何解释它。

结论是，无论我们如何考虑数字，机器都会对数字进行相同的操作。但是编译器会依次解释结果。

请注意，**不是机器知道 2 的补码的概念**。它只是添加两个数字而不关心内容。**然后，编译器**查看符号位并**决定**.

When it comes to subtraction, this time again, the operation is unique: take 2's complement of the second number and add the two.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T17:35:37.220

如果该数字被声明为有符号数据类型（而不是类型转换为无符号类型），那么编译器将知道，当符号位为 1 时，它是一个负数。至于为什么使用 2 的补码而不是 1 的补码，您不希望能够具有 -0 的值，而 1 的补码允许您这样做，所以他们发明了 2 的补码来解决这个问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T17:32:39.440

这正是最重要的位——如果你知道一个数字是有符号的，那么如果 MSB=1 编译器（和运行时！）知道将其解释为负数。这就是为什么类 c 语言同时具有整数（正数和负数）和无符号整数的原因——在这种情况下，您将它们都解释为正数。因此，有符号字节从 -128 到 127，但无符号字节从 0 到 255。

# math - 如何将命题公式转换为合取范式（CNF）？

> ID：655261
> 
> 赞同：16
> 
> 时间：2009-03-17T17:31:02.720
> 
> 标签：math, artificial-intelligence, boolean-logic

如何将此方程转换为 CNF？

```
¬((p ∨ ¬Q) ⊃ R) ⊃ (P ∧ R)) 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2012-03-02T12:47:04.517

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T17:39:22.827

[http://en.wikipedia.org/wiki/Conjunctive_normal_form](http://en.wikipedia.org/wiki/Conjunctive_normal_form)

> 要将一阶逻辑转换为 CNF：
> 
> 1.  转换为否定范式。
>     1.  消除影响：将 x → y 转换为 ¬ x ∨ y
>     2.  向内移动 NOT。
> 2.  标准化变量
> 3.  将语句简化
> 4.  删除通用量词
> 5.  在 OR 上分配 AND。
> 
> （人工智能：一种现代方法 [1995...] Russel 和 Norvig）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:38:18.350

我可以建议这个吗？页面上有转换算法。

[合取范式](http://en.wikipedia.org/wiki/Conjunctive_normal_form)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-15T16:56:51.977

我在 Java 中实现了一个小工具，可以将布尔表达式基本转换为 (C|D)NF。如果你有兴趣，你可能想看看[https://github.com/julianthome/ctrans](https://github.com/julianthome/ctrans)。实施基于[这些讲义](http://resources.mpi-inf.mpg.de/departments/rg1/teaching/autrea-ss10/script/lecture2.pdf)。更详细的描述可以在[这里](http://www.mpi-inf.mpg.de/~weidenb/publications/handbook99small.ps.gz)找到。任何反馈将不胜感激;-)。

# wpf - WPF - 我可以停止 UserControl 公开其命名的子元素吗？

> ID：655265
> 
> 赞同：0
> 
> 时间：2009-03-17T17:31:53.687
> 
> 标签：wpf, user-controls, encapsulation

这是一个菜鸟问题，但我刚刚意识到，如果我创建一个 UserControl 并选择将它的一些子元素命名为 la -

```
<UserControl x:Class="UserControls.uControl"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Height="300" Width="300">
<Grid x:Name="maingrid">

</Grid> 
```

然后我可以在使用 XAML 的代码隐藏中引用命名元素。所以对于上面的例子我可以写

```
uControl.mainGrid = new Grid(); 
```

我很好奇为什么会这样，更重要的是，我如何安全地封装这些控件。

像往常一样，任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T18:18:37.647

你想要的是[`x:FieldModifier`](http://msdn.microsoft.com/en-us/library/aa970905.aspx)属性：

```
<UserControl x:Class="UserControls.uControl" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Width="300" Height="300">
    <Grid x:Name="maingrid" x:FieldModifier="private">
    </Grid>
</UserControl> 
```

出于某种原因，默认值为**internal 。**[你可以在这里](http://joshsmithonwpf.wordpress.com/2009/01/07/make-use-of-the-xfieldmodifier-attribute/)阅读更多关于它的信息。

# visual-studio-2008 - 在 VWD Express 2008 中构建 Visual Studio 2008 Web 应用程序

> ID：655273
> 
> 赞同：0
> 
> 时间：2009-03-17T17:33:07.053
> 
> 标签：visual-studio-2008

我有一个 ASP.NET Web 应用程序，其中包含一个 Web 表单项目，这些项目依赖于几个业务类库项目和一个 WCF 项目。这是使用 Visual Studio 2008 构建的。

我将此源代码文件夹树复制到另一台 PC 并复制到 C:\Inetpub\wwwroot 下，打开 IIS 并在上述文件夹的属性中，创建应用程序。

我在 Visual Web Developer Express 2008 中将其作为带有 HTTP 绑定的本地网站打开。所有项目现在都显示为文件夹。

但是，当我建立网站时，我收到如下错误：-

在应用程序级别之外使用注册为 allowDefinition='MachineToApplication' 的部分是错误的。此错误可能是由未在 IIS 中配置为应用程序的虚拟目录引起的。c:\inetpub\wwwroot\Foo\FOO\Web.config 39

错误是什么，我该如何克服？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T17:45:12.843

这意味着 \foo\FOO 不是应用程序。也许您将 \foo 设置为应用程序？

# asp.net-mvc - MVC DropDownList参数问题

> ID：655274
> 
> 赞同：1
> 
> 时间：2009-03-17T17:34:25.817
> 
> 标签：asp.net-mvc

以下下拉列表正是我想要的，但我正在寻找一种更简单的方式来表达它（注意这是 VB 语法）。

```
<%=Html.DropDownList("values", CType(ViewData("values"), IEnumerable(Of SelectListItem)), "No values", New With {.onchange = "this.form.submit();"})%> 
```

因为 ViewData 值与下拉列表命名相同，所以 HTML 帮助器允许以下工作：

```
<%=Html.DropDownList("values", "No values")%> 
```

但是一旦我尝试添加 onchange 代码：

```
<%=Html.DropDownList("values", "No values", New With {.onchange = "this.form.submit();"})%> 
```

我收到“重载解析失败，因为没有缩小转换就无法调用可访问的“DropDownList””错误。

如何利用 HTML 帮助程序功能但仍指定 htmlAttributes？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T17:39:52.653

**编辑**

在线查看源代码似乎与大多数其他 HtmlHelper 扩展不同，Select 扩展不检查值中的 null 并且默认基于模型/视图数据加载。如果您不想编写自己的扩展，似乎最好的方法是像在第一个示例中那样转换视图数据。在检查了我自己的代码后，我发现这实际上就是我所做的。

原始答案留给上下文：

只需将选择列表指定为`Nothing`，它就会按照您的预期从您的模型/视图数据中提取它。这允许编译器匹配现有的方法签名，但不需要您准确地告诉它要使用的列表。如果您查看源代码 (www.codeplex.com/aspnet)，您会发现参数较少的方法只是进行这种替换，调用具有适当默认值的参数较多的方法。

```
<%=Html.DropDownList("values",
                     Nothing,
                     "No values",
                     New With {.onchange = "this.form.submit();"})%> 
```

# c# - 消息队列错误：找不到能够读取消息的格式化程序

> ID：655276
> 
> 赞同：28
> 
> 时间：2009-03-17T17:35:34.927
> 
> 标签：c#, message-queue

我正在将消息写入 C# 中的消息队列，如下所示：

```
queue.Send(new Message("message")); 
```

我正在尝试阅读以下消息：

```
Messages messages = queue.GetAllMessages();
foreach(Message m in messages)
{
  String message = m.Body;
  //do something with string
} 
```

但是，我收到一条错误消息，上面写着：“找不到能够读取此消息的格式化程序。”

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-18T10:25:58.907

我通过向每条消息添加格式化程序解决了这个问题。向队列中添加格式化程序不起作用。

```
Messages messages = queue.GetAllMessages();
foreach(Message m in messages)
{
  m.Formatter = new XmlMessageFormatter(new String[] { "System.String,mscorlib" });
  String message = m.Body;

  //do something with string
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-08-18T02:00:33.807

或者你可以使用

```
 message.Formatter =
     new System.Messaging.XmlMessageFormatter(new Type[1] { typeof(string) }); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-02-15T13:35:25.563

您可以尝试阅读消息的正文流而不是正文，如下所示：

```
StreamReader sr = new StreamReader(m.BodyStream);    
string messageBody = "";    
while (sr.Peek() >= 0) 
{
    messageBody += sr.ReadLine();
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-08-30T20:06:15.440

```
Message recoverableMessage = new Message();
recoverableMessage.Body = "Sample Recoverable Message";

recoverableMessage.Formatter = new XmlMessageFormatter(new String[] {"System.String,mscorlib" });

MessageQueue myQueue = new MessageQueue(@".\private$\teste"); 
```

队列也必须设置格式化程序。

```
myQueue.Formatter = new XmlMessageFormatter(new String[] { "System.String,mscorlib" }); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-05-28T23:28:18.283

这里的每个人都在提供解决方案方面做得非常出色，并且我自己刚刚完成了与这个问题的斗争，我想投入我自己的 2c 并展示我想出的解决方案非常有效。

首先，当创建队列时，我确保像这样打开权限（我不关心我们应用程序上下文中的队列安全性......这是一个经过计算的决定）：

```
queue.SetPermissions("Everyone", MessageQueueAccessRights.FullControl, AccessControlEntryType.Set); 
```

如果没有那条线，我会收到各种无法访问的错误，甚至无法从计算机管理屏幕浏览队列。顺便说一句，如果这种情况发生在您身上，并且您想知道如何杀死您无权访问的队列：

1.  停止服务“消息队列”
2.  转到“C:\Windows\System32\msmq\storage\lqs”
3.  在记事本中打开每个文件并查找您的队列名称（很可能是最近修改的文件）
4.  删除该文件并重新启动消息服务

为您的队列消息项创建一个基类并将其标记为 [Serializable]。在应用程序加载缓存所有消息类型的列表，使用如下所示：

```
var types = typeof(QueueItemBase).Assembly
            .GetTypes()
            .Where(t => typeof(QueueItemBase).IsAssignableFrom(t) && t.IsAbstract == false)
            .ToArray();
...
// Create and cache a message formatter instance
_messageFormatter = new XmlMessageFormatter(types); 
```

现在您可以开始接收消息了。我的第一直觉是轮询消息，但 api 并不喜欢那样工作。因此，我创建了一个后台线程并在队列上调用阻塞方法 Receive，一旦消息可用，该方法将返回。从那里解码消息很简单：

```
var message = queue.Receive();
if (message == null)
    continue;

// Tell the message about our formatter containing all our message types before we 
// try and deserialise
message.Formatter = _messageFormatter;

var item = message.Body as QueueItemBase; 
```

这应该是您获得良好实现、类型安全的 MSMQ 集成所需的全部内容！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-20T15:28:25.030

似乎只有在访问类的`Body`属性时才进行序列化`Message`。只要您`Body`在设置消息权限后访问该属性，`Formatter`它就可以正常工作。

如果您不想`Formatter`为每条消息创建一个，您可以`Formatter`在队列上设置 并为每条消息（在访问 Body 属性之前）设置队列中的`Formatter`属性`Formatter`。

```
_queue.Send(new Message() { Formatter = _queue.Formatter, Body = myData } );

var msg = _qeueu.Receive();
msg.Formatter = _queue.Formatter;
var myObject = (MyClass) msg.Body; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-04-26T15:11:05.347

这对我来说可以从远程机器读取私有队列：

```
MessageQueue queue = new MessageQueue(@"FormatName:Direct=OS:MACHINENAME\private$\MyQueueName", QueueAccessMode.Peek);

Message msg = queue.Peek();
StreamReader sr = new StreamReader(msg.BodyStream);
string messageBody = sr.ReadToEnd(); 
```

## 2019-11-29 更新

不要使用 Microsoft 消息队列 (MSMQ)。只是不要。就任何有用的、高性能的甚至远程精心设计的东西而言，它都已被弃用，而且是最底层的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-15T20:17:38.617

这很好用：

```
static readonly XmlMessageFormatter f = new XmlMessageFormatter(new Type[] { typeof(String) });

private void Client()
{
    var messageQueue = new MessageQueue(@".\Private$\SomeTestName");

    foreach (Message message in messageQueue.GetAllMessages())
    {
        message.Formatter = f;
        Console.WriteLine(message.Body);
    }
    messageQueue.Purge();
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-30T07:50:16.097

添加格式化程序解决了我的问题：

```
 public void ReceiveAsync<T>(MqReceived<T> mqReceived)
    {
        try
        {
            receiveEventHandler = (source, args) =>
            {
                var queue = (MessageQueue)source;
                using (Message msg = queue.EndPeek(args.AsyncResult))
                {
                    XmlMessageFormatter formatter = new XmlMessageFormatter(new Type[] { typeof(T) });
                    msg.Formatter = formatter;
                    queue.ReceiveById(msg.Id);
                    T tMsg = (T)msg.Body;
                    mqReceived(tMsg);

                }
                queue.BeginPeek();
            };

            messageQueu.PeekCompleted += receiveEventHandler;
            messageQueu.BeginPeek();

        }
        catch (Exception e)
        {
            Console.WriteLine(e.Message);
        }
    } 
```

您可以在 github 上查看示例代码和 msmq 库： [https ://github.com/beyazc/MsmqInt](https://github.com/beyazc/MsmqInt)

# firefox - sIFR - 仅 Firefox 3 中的行高问题？

> ID：655281
> 
> 赞同：0
> 
> 时间：2009-03-17T17:36:49.167
> 
> 标签：firefox, sifr, spacing

我正在尝试使用[sIFR](http://en.wikipedia.org/wiki/Scalable_Inman_Flash_Replacement)为我正在处理的主页创建标签云效果。有 4 行文本，每行内有不同的字体大小和字体颜色。

我怀疑 sIFR 纯粹主义者会说这会创建太多的电影剪辑以保证安全，但这确实是我们正在寻找的效果，它是我们拥有的最佳选择，它有利于[SEO](http://en.wikipedia.org/wiki/Search_engine_optimization)，并且会优雅地降级。如果我们可以让它工作，那就是......

我遇到的问题是颜色、字体大小等都显示得很好，但文本周围似乎有过多的填充，造成行高比 200% 或 1 em 更接近 200% 的效果. 我已经让它在 Internet Explorer 7 和其他一些浏览器中运行良好，但 Firefox 似乎显示的一切都错了！

任何想法和帮助表示赞赏;）

```
<h1 style="font-weight:600;">
<span class="titleleft">Content </span>
<span class="titleright">Formula:</span>
<span class="focussed">Focused </span>
<span class="creative">creative </span>
<span class="and">and </span>
<span class="targeted">targeted </span>
<span class="content">content </span>
<span class="for">for </span>
<span class="bluechip">blue chip </span>
<span class="global">global </span>
<span class="websites">websites </span>
<span class="and2">and </span>
<span class="intranets">intranets. </span>
<span class="wedeliver">We deliver </span>
<span class=success>success </span>
<span class="witha"> with a </span>
<span class="degree">360 degree </span>
<span class="approach">approach to online</span><br />
<span class="communications">communications.</span>
</h1> 
```

示例配置行：

```
sIFR.replace(arial, 
{selector: '#main_content_left_home>h1>span.titleleft' 
,css: '.sIFR-root { color: #000000; font-weight:bold;letter-spacing: -1;}' 
,tuneWidth: (+10)
});

sIFR.fixWrap = false;
sIFR.fitExactly = true;
sIFR.useStyleCheck = false;
sIFR.useDomLoaded = false;
sIFR.preserveSingleWhitespace = true;
sIFR.autoInitialize = true;
sIFR.forceWidth = true;
sIFR.repaintOnResize = true; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T22:10:36.693

检查额外的大小是在 Flash 影片内部还是在其周围。在后一种情况下，您将不得不求助于 CSS 调整。

在前一种情况下，请查看`tuneHeight`/`tuneWidth`和`offsetTop`/的`offsetLeft`参数`sIFR.replace()`。这些让您可以更改 Flash 影片中文本的位置，并让您更改 Flash 影片在文本周围留下的边距。

This is sometimes necessary because the dimensions of the text are reported incorrectly by Flash.

# xslt - 仅使用 xslt 1.0 将字符串的第一个字符小写

> ID：655284
> 
> 赞同：11
> 
> 时间：2009-03-17T17:37:20.303
> 
> 标签：xslt, xslt-1.0

对于使用 xslt 1.0 的人，我已经看到了使用 translate 函数将字符串转换为小写（或大写）的[模式。](https://stackoverflow.com/questions/586231/how-can-i-convert-a-string-to-upper-or-lower-case-with-xslt)

有没有一种优雅的方法可以让字符串的第一个字母小写？

```
TestCase => testCase 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T17:48:06.953

例如，如果您的字符串位于名为 的属性中`name`：

```
<xsl:value-of select="concat(translate(substring(@name, 1, 1), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), substring(@name, 2))"/> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T17:44:33.093

您应该能够将[substring](http://www.zvon.org/xxl/XSLTreference/W3C/xpath.html#function-substring)和[concat](http://www.zvon.org/xxl/XSLTreference/W3C/xpath.html#function-concat)与 translate 结合使用，如下所示：

```
concat(translate(substring(s,1,1), $smallcase, $uppercase),substring(s,2)) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:40:58.267

使用 XPath`translate`函数，将字符串分成第一个字符和其余字符。这将需要有点冗长的 XSLT 使用多个变量来保存中间结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:41:12.510

XSLT 有一个 substring 函数，因此您可以使用该模式和 substring 函数来获得您想要的。

# c# - WCF Web 服务的多种语言。最佳实践是什么？

> ID：655289
> 
> 赞同：0
> 
> 时间：2009-03-17T17:38:13.327
> 
> 标签：c#, wcf, multilingual

我正在开发一个需要以法语和英语返回结果的网络服务。（以后可能会添加其他语言。）Web 服务是用 C# 编写的。

我已将所有字符串分离到一个资源文件中。我正计划向服务添加一个参数并将 Thread.CurrentThread.CurrentCulture 设置为适当的值。然后，当我去检索正确的字符串时，我会检查 CurrentCulture 值。

这是一个好习惯吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:43:41.240

与其向服务中的每个调用（或您拥有的任何类型的 Web 服务上下文 - 我已经有一段时间没有做过任何 WS 的东西）添加参数，您有没​​有想过在不同的 URL 下托管 Web 服务来表示不同的语言？

我不会声称这是一个绝妙的想法，但它的好处是非常简单:) 说真的，我敢肯定会有很多优点和缺点，但这是另一回事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T19:21:49.197

这种类型的信息进入肥皂标题。检查此链接以获取有关如何设置它的信息：http: [//geekswithblogs.net/claeyskurt/archive/2007/10/23/SoapHeadersInWCFforAMSXClients.aspx](http://geekswithblogs.net/claeyskurt/archive/2007/10/23/SoapHeadersInWCFforAMSXClients.aspx)。

# .net - 在 SQL Server 2008 中使用 SqlBulkCopy 需要什么权限？

> ID：655293
> 
> 赞同：22
> 
> 时间：2009-03-17T17:38:44.793
> 
> 标签：.net, sql-server, ado.net

使用 .NET 的 SqlBulkCopy，我需要在 SQL Server 2008 中向用户授予什么权限？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-17T17:40:35.037

[http://msdn.microsoft.com/en-us/library/ms162802.aspx](http://msdn.microsoft.com/en-us/library/ms162802.aspx)

bcp out 操作需要对源表具有 SELECT 权限。

操作中的 bcp 最低限度需要目标表的 SELECT/INSERT 权限。此外，如果以下任何一项为真，则需要 ALTER TABLE 权限：

*   存在约束且未指定 CHECK_CONSTRAINTS 提示。ms162802.note(zh-cn,SQL.100).gif注意：禁用约束是默认行为。要显式启用约束，请使用带有 CHECK_CONSTRAINTS 提示的 -h 选项。

*   触发器存在且未指定 FIRE_TRIGGER 提示。ms162802.note(zh-cn,SQL.100).gif注意：默认情况下，不会触发触发器。要显式触发触发器，请使用带有 FIRE_TRIGGERS 提示的 -h 选项。

*   您使用 -E 选项从数据文件中导入标识值。

注意：要求目标表的 ALTER TABLE 权限是 SQL Server 2005 中的新增功能。如果用户帐户缺少目标表的 ALTER 表权限，此新要求可能会导致不强制执行触发器和约束检查的 bcp 脚本失败。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-10-03T01:38:55.510

要从 .net 指定这些提示：

```
var bulkCopy = new SqlBulkCopy(System.Configuration.ConfigurationSettings.AppSettings["ConnectionString"],
        SqlBulkCopyOptions.FireTriggers | SqlBulkCopyOptions.CheckConstraints); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-25T21:25:39.757

SqlBulkCopy 类只需 SELECT/INSERT 权限即可成功执行。该类针对目标 SQL Server 表发出 INSERT BULK 语句。今天在我们的一台开发服务器上验证了这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:43:37.527

有一个 bulkadmin 角色允许 BULK INSERT 命令。[http://msdn.microsoft.com/en-us/library/ms189934(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms189934(SQL.90).aspx)

# asp.net - Ashx 处理程序不能通过 控制

> ID：655299
> 
> 赞同：0
> 
> 时间：2009-03-17T17:40:35.943
> 
> 标签：asp.net, httphandler

在 ASP.NET 3.5 应用程序中，我创建了一个 ashx 处理程序，如下所示：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.IO;
using System.Web.Services;

namespace TestWebConfig
{
    [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    public class Handler1 : IHttpHandler
    {

        public void ProcessRequest(HttpContext context)
        {
            context.Response.ContentType = "image/jpg";
            BinaryReader br = new BinaryReader(File.Open( @"d:\Temp\images\AutumnLeaves.jpg", FileMode.Open ));

            int bufferLength = 1000;

            do
            {
                byte[] buffer = br.ReadBytes(bufferLength);
                context.Response.OutputStream.Write(buffer, 0, buffer.Length);
                if (buffer.Length < bufferLength)
                {
                    break;
                }
            } while (true);
            br.Close();
        }

        public bool IsReusable
        {
            get
            {
                return true;
            }
        }
    }
} 
```

在 aspx 页面中，如果我指定：

```
<img alt="alt2" src="Handler1.ashx" style="border-width:0px"/> 
```

然后将网页与图像一起加载到浏览器中。另一方面，如果我使用：

```
<asp:Image ID="Image2" runat="server" /> 
```

在代码隐藏中：

```
protected void Page_Load(object sender, EventArgs e)
{
   Image2.ImageUrl = "Handler1.asxh";
} 
```

然后 Image2 控件不加载图片，尽管相关的 html 代码看起来很相似。仅显示替代文本。怎么了？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T17:45:41.080

对于您的 Page_Load 中的一件事，您似乎给了它错误的扩展名，但我认为这不是问题所在。

# c# - Html.Routelink 输出 - ASP.NET C# MVC

> ID：655305
> 
> 赞同：1
> 
> 时间：2009-03-17T17:42:55.487
> 
> 标签：c#, asp.net-mvc, asp.net-mvc-routing

我有一个看起来像这样的电话：

```
<%= Html.RouteLink(item.displayName, "DisplayCategory", new { category = Html.Encode(item.displayName), subcat = item.searchName }) %> 
```

我得到的 html 看起来像这样：

```
http://localhost:1485/Home/ShowCategory/Electronics%20&%20Photography?subcat=electronics-photo 
```

为什么 URL 以 "?subcat=electronics-photo" 而不是 "/electronics-photo" 结尾？它与路由定义有某种关系吗？

```
 routes.MapRoute(
        "DisplayCategory",
        "Home/ShowCategory/{category}/{tags}",
        new { controller = "Home", action = "ShowCategory", category = "", tags = "" }
    ); 
```

任何线索将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-19T23:18:55.733

如果查询字符串与路由定义中的参数之一不匹配，则 MVC 路由会在查询字符串上添加。尝试将 subcat 添加到您的路线：

```
routes.MapRoute(
        "DisplayCategory",
        "Home/ShowCategory/{category}/{tags}/{subcat}",
        new { controller = "Home", action = "ShowCategory", category = "", tags = "", subcat = "" }
    ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:27:43.707

我只是在尝试，但看起来您正在使用 MVC 框架。

其中每个控制器都有一个动作，在本例中为 ShowCategory，默认情况下它们采用查询字符串，在本例中为类别。MVC 有目的地抽象了文件夹结构。我相信 MVC 应用程序将始终具有这种类型和深度 domain.ext/Controller/Action?queryString 的 URL。

我认为问题可能是 subcat 是否设置正确。更多信息/代码可能是有希望的。

也很抱歉没有解决您问题的路由部分。

# asp.net - jQuery / ASP MVC——“$.ajax”调用中的解析器错误

> ID：655307
> 
> 赞同：4
> 
> 时间：2009-03-17T17:43:12.880
> 
> 标签：asp.net, jquery, asp.net-mvc, ajax

我想使用 jQuery 1.3.1 在 ASP.Net MVC RC2 中创建一个简单的操作链接 - 如下所示：

> `<a href="#" onclick="AjaxTest1()">Tester</a>`

具有以下`AjaxTest1`功能：

```
 function AjaxTest1() {
            $.ajax({
                    url: "Home/Ajax1",
                    error: function(request, status, error) {
                        alert("error: " + status + ", " + "\n" +
                               error + ", " + request.responseText +
                               request.getAllResponseHeaders());
                    },
                    success: function(data, status) {
                         alert("Finally, it worked!");
                    },
                    type: "GET",
                    dataType: "text",
                });
                return false;
        } 
```

和控制器动作：

```
 public ActionResult Ajax1()
        {
            return this.Content("Test Content");
        } 
```

我要做的只是返回一个简单的字符串 - 但“错误”回调总是以`parseerror`. XmlHttpRequest 中包含内容字符串“Test Content” - 因此正在调用控制器操作并返回正确的数据。我尝试设置 dataType（为“text”、“html”、“json”），在控制器中使用 JsonResult 类型，将返回的内容类型设置为“text/plain”，使用 $.get , $.getJson 等......没有任何效果。我觉得我一定错过了一些非常非常简单的东西 - 特别是因为谷歌没有帮助。想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T02:12:10.433

我不敢相信我发现了这一点 - 有一个错字`jquery-1.3.1*vsdoc.js`（`jQuery.httpData`如果有人感兴趣的话 - 他们将输入参数定义为`filter`，然后尝试将其引用为`s`，这会引发异常）。奇怪的是，如果您使用非 *vsdoc 版本，则不存在拼写错误。

看起来他们发布了带有 vsdocs 的 jQuery-1.3.2 - 没有错字。所以我会说答案是只下载更新。( [jQuery 下载页面](http://docs.jquery.com/Downloading_jQuery#Current_Release))

我生命中的一天......希望这对某人有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:18:19.753

你在进入伟大的谷歌空白的旅程中得到这篇文章了吗？

[http://encosia.com/2008/06/05/3-mistakes-to-avoid-when-using-jquery-with-aspnet-ajax/](http://encosia.com/2008/06/05/3-mistakes-to-avoid-when-using-jquery-with-aspnet-ajax/)

他还有很多其他关于asp.net 和jquery 交互的文章。

您是否尝试过发布而不是获取？如此处所示：[http ://weblogs.asp.net/scottgu/archive/2007/04/04/json-hijacking-and-how-asp-net-ajax-1-0-mitigates-these-attacks.aspx](http://weblogs.asp.net/scottgu/archive/2007/04/04/json-hijacking-and-how-asp-net-ajax-1-0-mitigates-these-attacks.aspx)

# database - 数据层测试

> ID：655313
> 
> 赞同：1
> 
> 时间：2009-03-17T17:44:31.987
> 
> 标签：database, testing

试图围绕测试驱动开发。单元测试已经到位，从业务层到包括 Web UI 在内都可以正常工作。现在我正在尝试解决如何测试数据层和带下划线的数据库的问题。过去，数据层的代码比业务层和 UI 的代码多，保持层未经测试确实会损害质量。

是否有任何框架来设置数据库和数据层测试？具体来说，我正在寻找 .NET Framework 和 SQL Server 的解决方案，但我也对其他平台和数据库感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T19:10:20.360

如果您使用的是 Visual Studio Team Edition，则可以使用 Database Developer 部分针对您的数据模型创建单元测试。

除此之外，只需使用常规单元测试直接调用您的 DAL 或存储过程。

当然，数据库测试通常有一个额外的设置任务来让数据处于测试状态。另一个用于在所有处理完成后进行清理。

# .net - 服务器端 XSLT + .Net 的常见实现是什么？

> ID：655316
> 
> 赞同：2
> 
> 时间：2009-03-17T17:44:42.173
> 
> 标签：.net, xslt

使用 XSLT + .Net 的常见类结构是什么？（服务器端 XSLT）我的目标是避免标准的 web 表单，倾向于纯 MVC，但仍然保留 ASP.net 的所有机会（缓存、会话管理等）。将其实现为处理程序、页面级别或控件是否更好？它绝对取决于特定任务还是仍然有更好的实现？什么是最灵活的实现？

现在我通过 Facade（域实体实现 IXMLSerializable）从域获取 xml 字符串，从磁盘加载和缓存 XslCompiledTransforms 的静态集合作为单例，以及一个控制请求处理逻辑并有权访问的控制器（作为 httphandler）以前的类和缓存页面。是对的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-06T08:38:03.160

我使用以 XML 为中心的模型进行开发，我发现自定义处理程序方法适用于服务 XML -> XSLT -> HTML。

确保保持数据访问层解耦对于让处理程序专注于其特定任务非常重要。

您已经缓存了 XslCompiledTransforms，这很棒，因为初始编译是我编写的一些应用程序中最大的性能损失。

就“首选实现”而言 - 你不会找到很多关于这种 HTML 服务风格的信息。核心库中缺乏对 XSLT 2.0/XPATH 2.0 的支持并且没有关注 Microsoft 的此类开发是 IMO 的主要贡献者。

# jtable - 如何从 JTable 中删除选定的行？

> ID：655325
> 
> 赞同：17
> 
> 时间：2009-03-17T17:46:12.903
> 
> 标签：jtable

我试过这个：

```
public void removeSelectedFromTable(JTable from)
{
    int[] rows = from.getSelectedRows();
    TableModel tm= from.getModel();

    while(rows.length>0)
    {
        ((DefaultTableModel)tm).removeRow(from.convertRowIndexToModel(rows[0]));

        rows = from.getSelectedRows();
    }
    from.clearSelection();
} 
```

但是，它有时会留下一个仍然存在。可能是什么问题？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2011-01-30T16:22:38.570

它不起作用，这更好：

```
public void removeSelectedRows(JTable table){
   DefaultTableModel model = (DefaultTableModel) this.table.getModel();
   int[] rows = table.getSelectedRows();
   for(int i=0;i<rows.length;i++){
     model.removeRow(rows[i]-i);
   }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-07-07T14:23:25.527

```
int[] selectedRows = getTable().getSelectedRows();
        if (selectedRows.length > 0) {
            for (int i = selectedRows.length - 1; i >= 0; i--) {
                tableModel.removeRow(selectedRows[i]);
            }
        } 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-09-15T16:43:56.550

这对我有用

```
int numRows = table.getSelectedRows().length;
for(int i=0; i<numRows ; i++ ) {

    m_tableModel.removeRow(table.getSelectedRow());
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-07-20T09:01:58.410

**Java 8+ 流解决方案：**

*JTable表；
DefaultTableModel 模型 = (DefaultTableModel) table.getModel();*

```
IntStream.of(table.getSelectedRows())
            .boxed()
            .sorted(Collections.reverseOrder())
            .map(table::convertRowIndexToModel) // support for sorted table
            .forEach(model::removeRow); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-09-01T12:29:47.067

```
removeRows: {
    int[] lines = t.getSelectedRows();
    if(lines.length==0)
        break removeRows;
    for(int i=0; i<lines.length; i++) {
        lines[i]=t.convertRowIndexToModel(lines[i]);
    }
    Arrays.sort(lines);
    for(int i=lines.length-1; i>=0; i--) {
        dtm.removeRow(lines[i]);    
    }
} 
```

使用排序、移动列、多选等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-17T18:17:23.880

为什么不直接使用这个，

```
public void removeSelectedFromTable(JTable from)
{
        int[] rows = from.getSelectedRows();
        TableModel tm = (DefaultTableModel) from.getModel();

        for (int row : rows) {
            tm.removeRow(from.convertRowIndexToModel(row));
        }

        from.clearSelection();
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-09-25T06:48:28.220

试试这是完美的工作和简单

```
DefaultTableModel df1 = (DefaultTableModel) jTable1.getModel();
    int rs[] = jTable1.getSelectedRows();
    for (int i = rs.length-1; i >=0 ; i--) {

        int k = rs[i];

        df1.removeRow(k);

    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-03-28T21:53:11.370

这段代码对我有用！

```
DefaultTableModel model = (DefaultTableModel) Table.getModel();
    int nbrrow=Table.getRowCount();

        if(nbrrow>=1){
            int[] rows = Table.getSelectedRows();
            if(rows.length>=1){
            if(Table.getModel().isCellEditable(Table.getSelectedRow(),Table.getSelectedColumn())
                       &&Table.isEditing()==true)
               {
                   Table.getCellEditor().stopCellEditing();
                    for(int i=0;i<rows.length;i++){ 
                     model.removeRow(rows[i]-i);
                   }
               }else{
                            for(int i=0;i<rows.length;i++){ 
                             model.removeRow(rows[i]-i);
                           }

                }
            for(int i=0;i<Table.getRowCount();i++){
                           model.setValueAt(i, i, 0);
                       }
              Table.revalidate();
              Table.repaint();
            }
        } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-03-27T19:18:10.513

```
int[] selectedRows = table.getSelectedRows();
List<Object> selectedObjects = new ArrayList<Object>();
for (int row : selectedRows) {
    selectedObjects.add(tableModel.getObject(row));
}
for (Object obj : selectedObjects) {
    tableModel.removeObject(obj);
} 
```

// 我的 TableModel 是这个的子类：

```
public abstract class ListTableModel<T> extends AbstractTableModel {

    private List<T> data;

    public void setData(List<T> data) {
        this.data = data;
    }

    public T getObject(int row) {
        return data.get(row);
    }

    @Override
    public int getRowCount() {
        return data.size();
    }

} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-12-09T18:49:37.180

尝试这个：

```
int selectedIndex = table_.getSelectedRow();
while (selectedIndex >= 0) {
    int modelIndex = table_.convertRowIndexToModel(selectedIndex);
    tableModel_.removeRow(modelIndex);

    selectedIndex = table_.getSelectedRow();
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-02-06T00:40:56.127

尝试这个

```
 public void removeSelectedFromTable(JTable table) {

        DefaultTableModel model = (DefaultTableModel) table.getModel();
        int indexes[] = table.getSelectedRows(); 
        int res = 0;
        for(int i = 0; i < indexes.length; i++) {
            res += (i>0)?(indexes[i]-indexes[i-1]-1):0;
            int index = table.convertRowIndexToModel(indexes[0]+res)
            model.removeRow(index);
        }
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-12-26T06:32:55.647

下面的代码将起作用：

```
do {
    ((DefaultTableModel) jXTable1.getModel()).removeRow(jXTable1.getSelectedRows()[0]);
} while (jXTable1.getSelectedRowCount() > 0); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-01-16T09:55:00.167

这对我行得通：

```
if(tablaNotif.getSelectedRows().length>0){
    int[] rows = tablaNotif.getSelectedRows();
    if(tablaNotif.getSelectedRows().length<2) {
        modelo.remove(tablaNotif.convertRowIndexToModel(rows[0]));
    } else{
        for(int i = 0; i<tablaNotif.getSelectedRows().length;i++) {
            modelo.remove(tablaNotif.convertRowIndexToModel(rows[i]));
        }
        modelo.remove(tablaNotif.convertRowIndexToModel(rows[(tablaNotif.getSelectedRows().length-1)]));
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-09-12T14:36:08.873

上面的流解决方案没有考虑排序，可以这样修复：

```
 IntStream.of(table.getSelectedRows())
            .boxed().map(i -> table.convertRowIndexToModel(i))
            .sorted(Collections.reverseOrder())
            .forEach(((DefaultTableModel)table.getModel())::removeRow); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-01-10T07:13:13.727

它被我唤醒了。在此处输入代码

```
public void removeSelectedFromTable(JTable from)
    {
        int[] rows = from.getSelectedRows();
        DefaultTableModel tm = (DefaultTableModel) from.getModel();
        for (int i = rows.length-1; i >= 0; i--) {
            tm.removeRow(rows[i]);
        }
} 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2012-03-12T17:55:33.520

该解决方案适用于标题排序并自动更新表（即：不需要重新构建它）。

“Collecions.sort in reverse order”可以避免 IndexOutOfBondException。

```
private void deleteSelectedRows() {
        int[] selectedRows = table.getSelectedRows();
        table.clearSelection();

        // get model rows
        List<Integer> selectedModelRows = new LinkedList<Integer>();
        for (int i =`enter code here` 0; i < selectedRows.length; i++) {
            selectedModelRows.add(table.convertRowIndexToModel(selectedRows[i]));
        }

        Collections.sort(selectedModelRows, Collections.reverseOrder());

        for (int selectedModelRow : selectedModelRows) {
            tableModel.removeRow(selectedModelRow);
            tableModel.fireTableRowsDeleted(selectedModelRow, selectedModelRow);
        }
} 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2011-05-17T15:00:51.227

我查看了所有解决方案，但有一些例外，所以我想添加这个答案。

```
for (int i = 0; i < raws.length; i++) {
    System.out.println("I : " + i);
    for (int j = 1; j <= 1; j++) {
        defaultTableModel.removeRow(0);
        jTStockJournal.clearSelection();
        defaultTableModel.fireTableDataChanged();
    }
} 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2015-07-28T03:17:59.363

私人无效 jButton2ActionPerformed(java.awt.event.ActionEvent evt) {
DefaultTableModel defaultModel = (DefaultTableModel) jTable1.getModel(); 向量新行 = 新向量（）；defaultModel.removeRow(jTable1.getSelectedRow()); 我 = 我 - 1; }

# c# - 将许多 TimeSpan 减少为更少的平均 TimeSpan 的干净方法？

> ID：655326
> 
> 赞同：4
> 
> 时间：2009-03-17T17:46:36.507
> 
> 标签：c#, linq, timespan, average

我有一个包含 500 个元素的 C# Queue<TimeSpan>。

我需要通过以 10 个 TimeSpan 为一组并选择它们的平均值，将它们减少为 50 个元素。

有没有一种干净的方法可以做到这一点？我认为 LINQ 会有所帮助，但我想不出一个干净的方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:03:50.800

我会使用 Chunk 函数和循环。

```
foreach(var set in source.ToList().Chunk(10)){
    target.Enqueue(TimeSpan.FromMilliseconds(
                            set.Average(t => t.TotalMilliseconds)));
} 
```

Chunk 是我的标准助手库的一部分。 [http://clrextensions.codeplex.com/](http://clrextensions.codeplex.com/)

[块的来源](http://clrextensions.codeplex.com/SourceControl/changeset/view/25483#274852)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T17:54:57.703

查看[.Skip() 和 .Take()](http://msdn.microsoft.com/en-us/library/bb386988.aspx)扩展方法，将队列划分为集合。然后，您可以使用 .Average(t => t.Ticks) 来获取代表平均值的新 TimeSpan。只需将这 50 个平均值中的每一个都塞入一个新队列中，您就可以开始了。

```
Queue<TimeSpan> allTimeSpans = GetQueueOfTimeSpans();
Queue<TimeSpan> averages = New Queue<TimeSpan>(50);
int partitionSize = 10;
for (int i = 0; i <50; i++) {
    var avg = allTimeSpans.Skip(i * partitionSize).Take(partitionSize).Average(t => t.Ticks)
    averages.Enqueue(new TimeSpan(avg));
} 
```

我是一个 VB.NET 人，所以在那个例子中可能有一些语法不是 100% 写的。让我知道，我会修复它！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:53:41.077

在这种情况下，在方法调用中可能没有什么能比得上一个好的旧程序执行了。不花哨，但很简单，Jr.级别的开发人员可以维护。

```
public static Queue<TimeSpan> CompressTimeSpan(Queue<TimeSpan> original, int interval)
{
    Queue<TimeSpan> newQueue = new Queue<TimeSpan>();
    if (original.Count == 0) return newQueue;

    int current = 0;
    TimeSpan runningTotal = TimeSpan.Zero;
    TimeSpan currentTimeSpan = original.Dequeue();

    while (original.Count > 0 && current < interval)
    {
        runningTotal += currentTimeSpan;
        if (++current >= interval)
        {
            newQueue.Enqueue(TimeSpan.FromTicks(runningTotal.Ticks / interval));
            runningTotal = TimeSpan.Zero;
            current = 0;
        }
        currentTimeSpan = original.Dequeue();
    }
    if (current > 0)
        newQueue.Enqueue(TimeSpan.FromTicks(runningTotal.Ticks / current));

    return newQueue;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T17:55:21.353

将其与整数 (0..n) 一起压缩并按序列号 div 10 分组？

我不是 linq 用户，但我相信它看起来像这样：

```
for (n,item) from Enumerable.Range(0, queue.length).zip(queue) group by n/10 
```

take(10) 解决方案可能更好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T18:07:48.810

分组将如何进行？

假设一些非常简单的事情（一次取 10 个），您可以从以下内容开始：

```
List<TimeSpan> input = Enumerable.Range(0, 500)
                                 .Select(i => new TimeSpan(0, 0, i))
                                  .ToList();

var res = input.Select((t, i) => new { time=t.Ticks, index=i })
               .GroupBy(v => v.index / 10, v => v.time)
               .Select(g => new TimeSpan((long)g.Average()));

int n = 0;
foreach (var t in res) {
    Console.WriteLine("{0,3}: {1}", ++n, t);
} 
```

笔记：

*   Select 的重载来获取索引，然后使用这个和整数除法拾取 10 组。可以使用模数将每 10 个元素放入一个组，每 10 个 + 1 个放入另一个组，...
*   分组的结果是具有 Key 属性的枚举序列。但这里只需要那些单独的序列。
*   没有 Enumerable.Average 重载，`IEnumerable<TimeSpan>`所以使用 Ticks（长）。

编辑：以 10 人为一组，以更好地解决问题。
EDIT2：现在使用经过测试的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T18:08:23.130

我会使用循环，但只是为了好玩：

```
IEnumerable<TimeSpan> AverageClumps(Queue<TimeSpan> lots, int clumpSize)
{
    while (lots.Any())
    {
        var portion = Math.Min(clumpSize, lots.Count);
        yield return Enumerable.Range(1, portion).Aggregate(TimeSpan.Zero,
            (t, x) => t.Add(lots.Dequeue()),
            (t) => new TimeSpan(t.Ticks / portion));
        }
    }
} 
```

这只检查每个元素一次，因此性能比其他 LINQ 产品要好得多。不幸的是，它改变了队列，但也许它是一个特性而不是一个错误？

它确实具有作为迭代器的好处，所以它一次给你一个平均值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T18:11:32.717

你可以使用

```
static public TimeSpan[] Reduce(TimeSpan[] spans, int blockLength)
{
    TimeSpan[] avgSpan = new TimeSpan[original.Count / blockLength];

    int currentIndex = 0;

    for (int outputIndex = 0;
         outputIndex < avgSpan.Length; 
         outputIndex++)
    {
        long totalTicks = 0;

        for (int sampleIndex = 0; sampleIndex < blockLength; sampleIndex++)
        {
            totalTicks += spans[currentIndex].Ticks;
            currentIndex++;
        }

        avgSpan[outputIndex] =
            TimeSpan.FromTicks(totalTicks / blockLength);
    }

    return avgSpan;
} 
```

它有点冗长（它不使用 LINQ），但很容易看到它在做什么......（你可以很容易地从一个数组/从一个队列）

# asp.net - 更新面板和 javascript

> ID：655327
> 
> 赞同：2
> 
> 时间：2009-03-17T17:46:53.947
> 
> 标签：asp.net, asp.net-ajax, updatepanel

我有一个用户控件，其结构是 -

```
<updatepanel UpdateMode="Always">
<ContentTemplate>
   <asp:FormView>
    <EditItemTemplate>
       <table>
           <tr id='tr1'>
             <td>
                 Textbox1
                 btn1
             </td> 
           </tr> 
           <tr id='tr2'>
             <td>
                  textbox2
             </td> 
           </tr> 
        <table>
   </EditItemTemplate>
  </asp:FormView>
</ContentTemplate>
</updatepanel> 
```

在页面加载时，我使用以下来隐藏 tr2

```
ClientScriptManager cs = Page.ClientScript;
csText.AppendLine("");
csText.AppendLine("if(document.getElementById('tr2')!=null) 
           document.getElementById('tr2').style.display = 'none';");
csText.AppendLine("");
cs.RegisterStartupScript(this, this.GetType(), csName, csText.ToString(), false); 
```

这部分工作正常。现在点击 btn1 我弹出模态弹出扩展控件。这会导致 tr2 再次显示。我知道脚本需要与 updatePanel 内联。我尝试使用`ScriptManager.RegisterStartupScript(....);`但不起作用。此外 updateMode 需要始终如此，以便可以将来自 pop 扩展器的数据放入 Textbox1

感谢所有帮助。谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T18:01:36.033

由于您使用的是 UpdatePanel，因此您实际上不需要任何 javascript。

如果您将 tr2 元素更改为...

```
<tr id="tr2" runat="server"> 
```

这将允许您在服务器端代码中控制它。要隐藏您的 tr2 行，只需执行...

```
tr2.Style["display"] = "none"; 
```

这应该在回调中很好地保持同步。

# java - 如何避免许多小类的代码重复？

> ID：655328
> 
> 赞同：3
> 
> 时间：2009-03-17T17:47:03.323
> 
> 标签：java, oop, casting

我有不同的类，称为`English`, `Spanish`,`French`等：

```
Class English{
    String name = "English";
    String alias = "ENG";
}

Class French{
    String name = "French";
    String alias = "Fre";
} 
```

其他语言课程也类似。

还有一类叫做`Language`：

```
Class Language{
    String name = "";
    String alias = "";
} 
```

根据我的要求，我想将英语/法语/西班牙语转换为我的语言课程。

```
Class ABC{

    main(){
        Language lan = new Language();
        Object obj = getObject(1);
        if(obj instanceof English){
            lan.name = ((English)obj).name;
            lan.aliasName = ((English)obj).aliasName;
        }
    }

} 
```

如果我有 10 种语言，我是否需要为 10 种不同的语言编写相同的代码？在这种情况下，如何创建一个方法并将这些参数作为参数传递？像这样的东西：

```
setVariablesForLanguage(String className, Object obj) 
```

在这里，我只显示了 2 个变量，但我的类将包含 100 多个变量。我的实际要求是我想从其中一种语言中设置我的语言变量。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-17T17:59:34.243

如果您正在制作几个小类，每个小类都持有常量值，那么您不应该让它们成为类。我建议让它们成为 Language 的常量实例：

```
public static final Language ENGLISH = new Language("English", "Eng");
public static final Language FRENCH  = new Language("French",  "Fre"); 
```

并给 Language 一个构造函数来匹配。（实际上，这看起来更像是一个[enum](http://java.sun.com/j2se/1.5.0/docs/guide/language/enums.html)，但我不会一次向你倾倒太多。）

然后在你的主代码中，不要检查它是否是英语、法语等的实例。只需检查它是否是一种语言，然后调用

```
Language lan = new Language();
Object obj = getObject(1);
if(obj instanceof Language){
    lan.name = ((Language)obj).name;
    lan.aliasName = ((Language)obj).aliasName;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T17:52:05.400

使用声明 Name 和 Alias 属性的接口或抽象类。为每个类实现接口或从抽象类派生。

这是适用于“许多看起来非常相似的类”的常见问题的一般原则 - 但这里到底发生了什么？为什么会有多个英语实例？这里的真实状态是什么？

你*真的*想要一种[智能枚举](https://stackoverflow.com/questions/633656/programming-against-an-enum-in-a-switch-statement-is-this-your-way-to-do/633674#633674)吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T18:09:01.880

> *如果我有 10 种语言，我是否需要为 10 种不同的语言编写相同的代码？*

不，实际上可能您甚至根本不需要这些课程。

如果它们具有相同的属性并且唯一使它们不同的是这些属性的值，那么您可以有一个类（ Language ）并为每种语言使用不同的值。

顺便说一句，当你说 alais 时，你的意思是别名？

你可以这样：

```
public class Language  {

    String name;
    String alias;

    public Language( String aName, String anAlias ) { 
        this.name = aName;
        this.alias = anAlias;
    }
} 
```

并相应地设置值。

如果您更改“getObject()”的签名，那么它会返回对象，而是返回语言本身，那么您可以从此更改您的代码：

```
Language lan = new Language();

Object obj = getObject(1);

if(obj instanceof English){

    lan.name = ((English)obj).name;

    lan.aliasName = ((English)obj).alias;
} 
```

对此：

```
Language lang  = getObject(1); 
```

就是这样。在里面`getObject`你可以这样定义它：

```
public Language getObject( int id ) { 
     switch( id ) { 
          case 0:  return new Language("English", "ENG");
          case 1:  return new Language("French", "FRE");
          case 2:  return new Language("Spanish", "ESP");
          case 3:  return new Language("German", "GER");
          case 4:  return new Language("Portuguese", "POR");
          ....
          etc. 
      }
} 
```

**正如您可能意识到的那样，当行为**不同时，创建一个子类或**不同**的类是有意义的。当行为相同时，唯一**改变**的是**数据**，那么参数化类就足够了。

最后的评论：

根据您的需要，您可能会查看[Locale](http://java.sun.com/javase/6/docs/api/java/util/Locale.html)类并可能阅读[本文](http://java.sun.com/docs/books/tutorial/i18n/index.html)以了解 Java 对这种情况有什么作用。我不知道您的代码是否需要它，但它可能会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T18:17:36.510

这不是您问题的完整解决方案（它甚至可能不是您真正的解决方案），但我想指出一些我认为您提供的代码会更好的事情。

对于提供的代码，您最好编写如下内容：

```
abstract class Language
{
    private final String name;
    private final String alias;

    public Language(final String m, final String a)
    {
        name  = n;
        alias = a;
    }

    public String getName()
    {
        return (name);
    }

    public String getAlias()
    {
        return (alias);
    }
}

class English
    extends Language
{
    public English()
    {
        super("English", "ENG");
    }
}

class ABC
{
    public static void main(final String[] argv)
    {
        fnal Language lang;

        lang = getObject(1);
    }
} 
```

一般来说：

*   您应该尽可能避免使用 instanceof。
*   当你有相同类型的东西时（比如英语、法语等......你应该创建一个父类并将常见的东西放入其中）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T17:53:20.997

为什么不让英语、法语等都成为语言的子类？

那么你的代码会更简单：

```
 Class ABC{

main(){

 Language lan = getObject(1);

}

} 
```

编辑：如上所述，语言作为接口或抽象类也可能做得更好。

# silverlight - silverlight 按钮不拉伸？

> ID：655330
> 
> 赞同：1
> 
> 时间：2009-03-17T17:47:40.060
> 
> 标签：silverlight, button, stretch

我有下面的 xaml 标记，按钮看不到在屏幕上伸展，而是左对齐。它包含在堆栈面板中。我在这里做错了什么？

```
 <Grid>
    <ListBox Name="SideNavBar">
        <ListBox.ItemTemplate>
            <DataTemplate>
                <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch">
                    <Button Content="{Binding}"/>
                </StackPanel>
            </DataTemplate>
        </ListBox.ItemTemplate>
    </ListBox>
    </Grid> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T19:54:43.173

这显然是 ListBoxItem 的一个已知问题。

看到[这个论坛讨论](http://silverlight.net/forums/t/11426.aspx)...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T09:41:35.267

您已在示例中将 StackPanel 对齐设置为拉伸，而不是按钮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:59:23.900

拉伸 StackPanel 是不合逻辑的，因为它的工作是将每个子控件并排放置在一行或一列中。

我认为同样的想法也适用于 ListBox，但我目前无法确认。

# oop - 类定义中的封装

> ID：655336
> 
> 赞同：1
> 
> 时间：2009-03-17T17:48:58.170
> 
> 标签：oop, class, encapsulation

例如，您是在方法定义中使用访问器和修改器还是直接访问数据？有时，一直或何时在罗马？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T17:52:49.987

始终尝试使用访问器，即使在类内部也是如此。您唯一希望直接访问状态而不是通过公共接口访问状态的情况是，如果出于某种原因需要绕过访问器方法中包含的验证或其他逻辑。

现在，如果您发现自己*确实*需要绕过该逻辑，您应该退后一步，问问自己这种需要是否暴露了您的设计中的缺陷。

**编辑：**阅读Eric Lippert 的[Automatic vs Explicit Properties](http://blogs.msdn.com/ericlippert/archive/2009/01/14/automatic-vs-explicit-properties.aspx)，他在其中深入研究了这个问题并非常清楚地解释了事情。它专门针对 C#，但 OOP 理论是普遍且可靠的。

这是一段摘录：

> 如果促使从自动实现的属性更改为显式实现的属性的原因是改变属性的语义，那么您应该评估从类中访问属性时所需的语义是否与访问时所需的语义相同或不同课外的财产。
> 
> 如果该调查的结果是“从类内部访问此属性的所需语义与从外部访问该属性的所需语义不同”，那么您的编辑引入了一个错误。你应该修复这个错误。如果它们相同，那么您的编辑没有引入错误；保持执行相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:52:36.663

一般来说，我更喜欢访问器/修改器。这样，我可以更改类的内部实现，而类以相同的方式对外部用户（或我不想破坏的现有代码）起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T17:58:59.533

访问器的设计使您可以添加特定于属性的逻辑。如

```
int Degrees
{
    set
    {
        _degrees = value % 360;
    }
} 
```

因此，您总是希望通过 getter 和 setter 访问该字段，这样您就可以始终确定该值永远不会大于 360。

如果像 Andrew 提到的那样，您需要跳过验证，那么很可能是功能设计或验证设计存在缺陷。

Accessors 和 Mutators 旨在确保数据的一致性，因此即使在您的类中，您也应该始终努力确保无法将未经验证的数据注入这些字段。

**编辑**

另请参阅此问题： [OO 设计：您在内部使用公共属性还是私有字段？](https://stackoverflow.com/questions/734760/oo-design-do-you-use-public-properties-or-private-fields-internally)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T18:05:59.907

我不倾向于与外界分享我的类的“内部结构”，因此我对数据的内部需求（私有方法的东西）通常不会像我的公共接口那样做同样的事情。

我会编写一个私有方法将调用的访问器/修改器是很罕见的，但我怀疑我在这里是少数。也许我*应该*做更多这样的事情，但我不倾向于这样做。

无论如何，那是我的 [铜绿覆盖] 两美分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T18:07:04.210

我通常会从私有自动属性开始，然后在必要时进行重构。我将重构为具有支持字段的属性，然后将支持字段替换为“真实”存储，例如 ASP.NET 应用程序的 Session 或 ViewState。

从：

```
 private int[] Property { get; set; } 
```

到

```
 private int[] _property;
    private int[] Property
    {
        get { return _property; }
        set { _property = value; }
    } 
```

到

```
 private int[] _property;
    private int[] Property
    {
        get
        {
            if (_property == null)
            {
                _property = new int[8];
            }
            return _property;
        }
        set { _property = value; }
    } 
```

到

```
 private int[] Property
    {
        get
        {
            if (ViewState["PropertyKey"] == null)
            {
                ViewState["PropertyKey"] = new int[8];
            }
            return (int[]) ViewState["PropertyKey"];
        }
        set { ViewState["PropertyKey"] = value; }
    } 
```

当然，我使用的是 ReSharper，所以这比发帖花费的时间更少。

# jquery - 使用jquery从xml动态加载数据到下拉框

> ID：655340
> 
> 赞同：1
> 
> 时间：2009-03-17T17:50:03.160
> 
> 标签：jquery

我接管了一个小型 Web 应用程序。我正在学习 JQuery，所以我喜欢用 JQuery 重写当前的 java 脚本。这是我所拥有的 1\. xml 文件如下

```
<courses>
    <course title="math">
        <time>1:00pm</time>
        <time>3:00pm</time>
    </course>
    <course title="physic">
        <time>1:00pm</time>
        <time>3:00pm</time>
    </course>
</courses> 
```

2.  我喜欢加载到带有标题的下拉框1。
3.  当从box1中选择标题时，下拉框2将填写响应标题的时间。

感谢您提供任何提示和帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T18:04:00.113

这应该让你开始：

```
<script type="text/javascript">
$(document).ready(function() {
    var course_data; // variable to hold data in once it is loaded
    $.get('courses.xml', function(data) { // get the courses.xml file
        course_data = data; // save the data for future use
                            // so we don't have to call the file again
        var that = $('#courses'); // that = the courses select
        $('course', course_data).each(function() { // find courses in data
            // dynamically create a new option element
            // make its text the value of the "title" attribute in the XML
            // and append it to the courses select
            $('<option>').text($(this).attr('title')).appendTo(that);
        });
    }, 'xml'); // specify what format the request will return - XML

    $('#courses').change(function() { // bind a trigger to when the
                                      // courses select changes
        var val = $(this).val(); // hold the select's new value
        var that = $('#times').empty(); // empty the select of times
                                        // and hold a reference in 'that'
        $('course', course_data).filter(function() { // get all courses...
            return val == $(this).attr('title'); // find the one chosen
        }).find('time').each(function() { // find all the times...
            // create a new option, set its text to the time, append to
            // the times select
            $('<option>').text($(this).text()).appendTo(that);  
        });
    });
});
</script>

Courses:
<select id='courses'>
    <option value='0'>----------</option>
</select>
<br>
Times:
<select id='times'>
    <option value='0'>----------</option>
</select> 
```

## 它在做什么：

我习惯`$(document).ready();`等到页面准备好。一旦完成，我将加载文件中的所有数据`courses.xml`（您可以将其更改为返回 XML 文件的任何内容）。获得这些数据后，我将`<select>`使用 XML 中所有课程的值填充课程。然后，每次`<select>`更改课程时，我都会绑定一个触发器来触发。发生这种情况时，我会找到选择的课程并循环遍历所有时间，并将它们附加到 times `<select>`。

测试和工作。

# multithreading - 如何正确杀死在tomcat上运行的webapp拥有的本地线程被指示关闭

> ID：655342
> 
> 赞同：5
> 
> 时间：2009-03-17T17:50:54.593
> 
> 标签：multithreading, jvm, shutdown

后端 web 应用程序部署在 Tomcat 6 servlet 容器上。在 webapp 中，启动了几个监控线程。问题在于关机。

*   我怎么知道 webapp 被请求关闭？
*   我应该如何在我的线程中处理这个？

目前我的线程实现如下。当 servlet 被指示关闭 (shutdown.sh) 时，它确实完成了干净的关闭并且不会因为这个线程而挂起——为什么？

```
class Updater extends Thread {
  volatile boolean interrupted = false;

  @Override
  public void run() {
    Integer lastUpdateLogId = CommonBeanFactory.getXXX()
                              .getLastUpdateLogRecordKey(MLConstants.SMART_DB_NAME);

    List<UpdateLog> updateLogRecords;
    while (!interrupted) {
      boolean isConfigurationUpdateRequested = false;

      try {
        TimeUnit.SECONDS.sleep(5);
      } catch (InterruptedException e) {
        setInterrupted(true);
      }

      updateLogRecords = CommonBeanFactory.getXXX()
                         .getLastFactsUpdateLogRecords(MLConstants.XXXX, lastUpdateLogId);

      for(UpdateLog updateLog : updateLogRecords) {
        if (updateLog.getTable_name().equals(MLConstants.CONFIG_RELOAD)) {
          isConfigurationUpdateRequested = true;
        }

        lastUpdateLogId = updateLog.getObjectKey();
      }

      if (isConfigurationUpdateRequested) {
        Configuration.getInstance().loadConfiguration();
      }
    }
  }

  public boolean getInterrupted() {
    return interrupted;
  }

  public void setInterrupted(boolean interrupted) {
    this.interrupted = interrupted;
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-03-23T13:48:15.540

我想我还不能回复答案。埃迪的回答并不完全正确。

我发现了这个问题，因为我想弄清楚为什么我的 webapp 没有正确关闭；当我运行关机时，我的线程不会被杀死。*。事实上，它会停止一些线程，但最终只是处于某种不确定状态。事实上，我的课几乎和这个一模一样。

在前台 Tomcat 窗口（在 Windows 上）中键入 Ctrl+C 会停止一切，但是使用 Tomcat 附带的 init 脚本不会。不幸的是，我还没有弄清楚为什么......

编辑：我想通了。我的大多数监视线程都是在 ServletContextListener 中启动的，但是当该上下文被“破坏”时，子线程不会得到通知。我通过简单地将所有子线程保存在 List 中并循环遍历，在 contextDestroyed() 方法中对每个子线程调用 Thread.interrupt() 来修复它。这与 Eddie 所说的 servlet destroy() 方法几乎相同。

但是，当您运行 shutdown.{sh|bat} 时，JVM 立即关闭是不正确的。这更像是该脚本向 Tomcat 组件发送关闭请求。您可以接收这些关闭消息并将它们传递给您自己的对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T20:33:40.390

Servlet 在被指示关闭时会收到生命周期事件。您可以使用此事件来停止您的监控线程。也就是说，当一个 servlet 启动时，它的`init()`方法被调用。当它停止时，它的`destroy()`方法被调用。

覆盖`destroy()`servlet 中的方法并在那里停止线程。

当你调用`shutdown.sh`整个 JVM 时就关闭了。由于 JVM 停止，所有线程（无论其状态如何）如果仍在运行，将被强制停止。这是调用的逻辑等价物`System.exit(0);`

# .net - 如何在 DLL 中嵌入 Web 服务设置？

> ID：655345
> 
> 赞同：0
> 
> 时间：2009-03-17T17:52:21.843
> 
> 标签：.net, web-services, configuration

我正在用 VB.NET 编写一个 DLL，该 DLL 将被 ASP.NET 网站引用。

DLL 项目中包含对 Web 服务的引用。当我将 Web 服务添加到项目时，一大块配置信息被添加到“app.config”文件中。

为了让它在主机网站上工作，我必须将“app.config”文件中的信息复制到网站的“web.config”中。

有人知道如何将这些设置嵌入到我编译的 DLL 中吗？我不希望我的 DLL 的使用者必须将此设置块插入到他们的 web.config 文件中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T14:51:18.710

'svc.Endpoint.Address' 需要一个 System.ServiceModel.EndpointAddress 类型的对象，所以实际上需要的是...

```
Dim address As New System.ServiceModel.EndpointAddress("http://Whatever")
Dim binding As New System.ServiceModel.BasicHttpBinding()

' The binding object is already set up with the default values normally found in the
' <bindings> section of the App.Config, but can be overriden here, eg...
binding.ReceiveTimeout = new System.TimeSpan(0,20,0)

Dim ws As New MyWebServiceSoapClient(binding, address) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:13:50.560

> 有人知道如何将这些设置嵌入到我编译的 DLL 中吗？我不希望我的 DLL 的使用者必须将此设置块插入到他们的 web.config 文件中

是的，您可以在代码中设置地址。在生成的代理类上，您有 Url 属性（用于旧式 asp.net Web 服务代理）或 Endpoint.Address 属性（用于 WCF 生成的 Web 服务代理）。

```
//MyWebService is a non-WCF generated proxy
MyWebService ws = new MyWebService();
ws.Url = "http://whatever/"; 
```

或者

```
//MyWebServiceSoapClient is a WCF generated proxy
MyWebServiceSoapClient svc = new MyWebServiceSoapClient();
svc.Endpoint.Address = "http://whatever"; 
```

虽然，这可能意味着在你的 dll 中硬编码这些值，我不建议这样做......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T17:58:00.677

实际上，复制和粘贴是解决方案。这就是 .NET 一直以来的工作方式。任何外部（库）代码的配置设置必须进入“执行”应用程序的配置文件。这可能是控制台或 Windows 服务应用程序的***应用程序***.exe.config 文件，或者是 ASP.NET、WCF 或其他基于 Web 的应用程序的 web.config 文件之一。

请参阅[如果 DLL 的 app.config 应该在“主配置”中……我们如何处理 DLL 中的 WCF 引用？](https://stackoverflow.com/questions/634439/if-app-config-for-a-dll-should-be-in-the-main-config-what-do-we-do-with-wcf-refe).

总体思路是，需要设置的库代码可能被多个正在执行的应用程序使用。*在这种情况下，每个应用程序*的设置会有所不同。

如果您的设置在 DLL 中，那么您的 DLL 的使用者将无法编辑设置。

如果您有不允许更改的“设置”，那么，如[https://stackoverflow.com/a/686126/76337](https://stackoverflow.com/a/686126/76337)和[https://stackoverflow.com/a/655452/76337](https://stackoverflow.com/a/655452/76337)所示，您应该配置代码中的东西，而不是不可配置的配置文件。

# visual-studio-2005 - 如何使用 MSBuild 将文件复制到另一个目录？

> ID：655360
> 
> 赞同：5
> 
> 时间：2009-03-17T17:55:08.763
> 
> 标签：visual-studio-2005, msbuild, copy

我正在尝试将 $(TargetDir) 中的几个文件复制到另一个文件夹（例如 C:\BinCache），但无论出于何种原因，我都无法让 MSBuild 停止抱怨。

```
 <Target Name="AfterBuild">
    <Copy SourceFiles="$(TargetDir)\*.*"
          DestinationFolder="C:\BinCache" />
  </Target> 
```

我在这里做错了什么？

编辑：解决方案是使用 CreateItem 任务。据推测，Visual Studio 2008 消除了这个限制。谢谢斯科特！

```
<Target Name="AfterBuild">
  <CreateItem Include="$(TargetDir)\*.*">
    <Output TaskParameter="Include" ItemName="SourceFiles" />
  </CreateItem>
  <Copy SourceFiles="@(SourceFiles)" DestinationFolder="C:\BinCache" />  
</Target> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T17:59:24.743

SourceFiles 需要是一个项目列表

你需要类似的东西

```
<Target Name="AfterBuild">
  <ItemGroup>
    <SourceFiles Include="$(TargetDir)\*.*" />
  </ItemGroup>
  <Copy SourceFiles="@(SourceFiles)" DestinationFolder="C:\BinCache" />  
</Target> 
```

刚刚注意到你在 2005 年，在这种情况下你需要使用 CreateItem 任务

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T17:58:50.220

只需使用常规的构建前或构建后事件。VS 开箱即用地支持这一点。

```
xcopy "@(TargetDir)*.dll" "\yourdir" /i /f /s /v /y 
```

# c# - 您将如何重构它以使其更好？

> ID：655364
> 
> 赞同：2
> 
> 时间：2009-03-17T17:56:21.537
> 
> 标签：c#, asp.net, refactoring

你会如何重构这样的东西？

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    try
    {
        string username = txtUsername.Text.Trim().ToLower();
        string password = txtPassword.Text.Trim().ToLower();
        string email = txtEmail.Text.Trim().ToLower();
        string status = ddlStatus.SelectedValue.Trim();

        IUser user = UserFactory.getInstance().createUser(username, password, email,status);

        if (user.save())
        {
            jsMsgBox("Successfully added new user");
            Response.Redirect(ConfigurationManager.AppSettings["AdminLink"], true);
        }
        else
        {
            jsMsgBox("An error was encountered while trying to add a new user.");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox("An Error was encountered while trying to add a new user.");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
}

protected void btnUpdate_Click(object sender, EventArgs e)
{
    try
    {
        string username = txtUsername.Text.Trim().ToLower();
        string password = txtPassword.Text.Trim().ToLower();
        string email = txtEmail.Text.Trim().ToLower();
        int userPK = Int32.Parse(txtUserPK.Text.ToString());
        string status = ddlStatus.SelectedValue.Trim();

        IUser user = UserFactory.getInstance().createUser(userPK, username, password, email,status);

        if (user.save())
        {
            jsMsgBox("Successfully updated selected users information.");
            Response.Redirect(ConfigurationManager.AppSettings["AdminLink"], true);
        }
        else
        {
            jsMsgBox("An error was encountered while trying to update the selected users information.");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox("An Error was encountered while trying to update the selected users information.");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
} 
```

小心

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:13:34.973

作为一个开始：

```
protected string cleaned(string raw) {
    raw.Text.Trim().ToLower()
    }
protected void attempt_to_save(IUser user, string task) {
    if (user.save()) {
        jsMsgBox("Successfully finished "+task);
        Response.Redirect(ConfigurationManager.AppSettings["AdminLink"], true);
      } else {
        jsMsgBox("An error was encountered while "+task);
        }
    }

protected void btnAdd_Click(object sender, EventArgs e)
{
    try
    {
        IUser user = UserFactory.getInstance().createUser(
            cleaned(txtUsername), 
            cleaned(txtPassword), 
            cleaned(txtEmail),
            ddlStatus.SelectedValue.Trim()
            );

        attempt_to_save(user,"adding a new user.");
    }
    catch (Exception ex)
    {
        jsMsgBox("An Error was encountered while trying to add a new user.");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
}

protected void btnUpdate_Click(object sender, EventArgs e)
{
    try
    {

        IUser user = UserFactory.getInstance().createUser(
            Int32.Parse(txtUserPK.Text.ToString()), 
            cleaned(txtUsername), 
            cleaned(txtPassword), 
            cleaned(txtEmail),
            ddlStatus.SelectedValue.Trim()
            );

        attempt_to_save(user,"updating the selected users information.");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox("An Error was encountered while trying to update the selected users information.");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
} 
```

请注意，有必要稍微改写一些消息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T18:32:10.030

试试这个

首先创建一个用户信息对象

```
 class UserInfo
{
    public string username {get;set;}
    public string password {get;set;}
    public string email {get;set;}
    public string status {get;set;}
} 
```

然后像这样重构你的代码

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    UserInfo myUser = GetUserInfo();
    try
    {
        IUser user = UserFactory.getInstance().createUser(myUser);

        if (user.save())
        {
            jsMsgBox("Successfully added new user");
            Response.Redirect(ConfigurationManager.AppSettings["AdminLink"], true);
        }
        else
        {
            jsMsgBox("An error was encountered while trying to add a new user.");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox("An Error was encountered while trying to add a new user.");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
}

protected void btnUpdate_Click(object sender, EventArgs e)
{
    UserInfo myUser = GetUserInfo();
    int userPK = Int32.Parse(txtUserPK.Text.ToString());

    try
    {       
        IUser user = UserFactory.getInstance().createUser(userPK,myUser);

        if (user.save())
        {
            jsMsgBox("Successfully updated selected users information.");
            Response.Redirect(ConfigurationManager.AppSettings["AdminLink"], true);
        }
        else
        {
            jsMsgBox("An error was encountered while trying to update the selected users information.");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox("An Error was encountered while trying to update the selected users information.");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
}

private UserInfo GetUserInfo()
{
    UserInfo myUser = new UserInfo();

    UserInfo.username = txtUsername.Text.Trim().ToLower();
    UserInfo.password = txtPassword.Text.Trim().ToLower();
    UserInfo.email = txtEmail.Text.Trim().ToLower();
    UserInfo.status = ddlStatus.SelectedValue.Trim();

    return myUser;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T18:29:27.497

当两种方法相似时，我通常会采用两种方法。

无论哪种情况，我通常将它们更改为一个方法，并将相似的行放在一起。

一种是有一个变量，它知道你在使用哪种方法，并使用它来确定要做什么。

if(update) // 使用更新行 else // 使用添加行

您还必须能够处理您可能不会在一种状态下初始化变量的情况（例如 update 设置 userPK，但 add 不使用它）

这是一个快速简单的重构，可以轻松组合 2 种方法，并且如果您的代码相当干净，则很难搞砸。

另一种方法更复杂，用于将这种“组合”方法变成可重用的东西。我经常先做上一个，然后在必要时继续...

有两种方法可以使您的组合类更可重用。一是“传递”差异。传入一个实现不同代码行的对象。

第二个是使其成为“父”类并在您孩子的方法中实现不同的行。因此，当父级达到必须进行创建的地步时，它只会调用 create() 方法。create() 方法将在子类中被覆盖以运行一种方法或另一种方法。您可能会为每个代码差异委派一个这样的方法。

哦，如果只有“数据”不同，请说您的“组合”方法如下所示：

```
if(user==0)
    System.out.println("Bill was here");
else if(user==1)
    System.out.println("Bob was here"); 
```

我通常通过创建索引数组或枚举来解决这个问题，使其最终看起来像这样：

```
System.out.println(users[user]+" was here"); 
```

我知道这似乎很明显，但提取数据对重构有很大帮助，如果你不知道下一步该做什么，这是一个很好的开始......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T19:06:27.797

首先，摆脱这些 try/catch，为 asp.net 配置一个友好的错误页面并记录任何未处理的异常。

在处理程序上，您希望他们清楚地阅读正在发生的事情。我发现这个版本非常适合这个场景：

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    bool isInsert = true;
    bool saved = SaveUserFromControlInfo(isInsert);
    ShowJsMessageBox(
        saved, 
        "Successfully added new user", 
        "An error was encountered while trying to add a new user."
        );
    if(saved) RedirectToAdmin();
}
protected void btnUpdate_Click(object sender, EventArgs e)
{
    bool isInsert = false;
    bool saved = SaveUserFromControlInfo(isInsert);
    ShowJsMessageBox(
        saved,
        "Successfully updated selected users information.",
        "An error was encountered while trying to update the selected users information."
        );
    if (saved) RedirectToAdmin();
} 
```

支持方法是：

```
void RedirectToAdmin()
{
    Response.Redirect(ConfigurationManager.AppSettings["AdminLink"], true);
}
void ShowJsMessageBox(bool success, string succesMessage, string failedMessage)
{
    jsMsgBox(success ? succesMessage : failedMessage);
}
void SaveUserFromControlInfo(bool isInsert)
{
    string username = txtUsername.Text.Trim().ToLower();
    string password = txtPassword.Text.Trim().ToLower();
    string email = txtEmail.Text.Trim().ToLower();
    string status = ddlStatus.SelectedValue.Trim();
    var userFactory = UserFactory.getInstance();
    IUser user;
    if( isInsert )
        user = userFactory.createUser(username, password, email, status);
    else
    {
        int userPK = Int32.Parse(txtUserPK.Text);
        user = userFactory.createUser(userPK, username, password, email, status);
    }
    return user.save();
} 
```

我会稍微调整一下 SaveUserFromControlInfo。我希望有一个与 CreateUser 请求关联的类，它包含一个可选的 userPK。

附言。我通常不会这样做，因为我使用 MVP，并且这个视图只有代码来获取控件中的用户信息（在其他地方定义了一个类）并将事件转发给演示者。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T21:13:32.757

我将在这里冒险并建议这段代码不是特别需要重构。可能还有空间让它更优雅、更简洁或更健壮，但就目前而言，代码非常简单且易于阅读。在这种情况下，我的直觉反应是，“如果它没有坏，就不要修理它。”

编辑：说了这么多，我至少赞成其他三个答案。那里有一些很棒的想法。

编辑#2：再看一遍后，对我来说最明显的问题是以下代码的重复：

```
 string username = txtUsername.Text.Trim().ToLower();
    string password = txtPassword.Text.Trim().ToLower();
    string email = txtEmail.Text.Trim().ToLower();
    string status = ddlStatus.SelectedValue.Trim(); 
```

这里真正的问题是，如果 UI 更改为添加、删除或重命名某个字段，则需要在两个地方更改此支持代码。正如其他几个答案所建议的那样，在支持课程中发生这种情况要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T18:14:42.070

```
protected void btnAdd_Click(object sender, EventArgs e) { SaveUser();}
protected void btnUpdate_Click(object sender, EventArgs e) { SaveUser();}
private void SaveUser()
{
      int? userId = string.IsNullOrEmpty(txtUserPK.Text)? null:
                   Int32.Parse(txtUserPK.Text.ToString());
      UserFactory.Save(userId , txtUsername.Text, txtPassword.Text, 
                      txtEmail.Text, ddlStatus.SelectedValue);  
      jsMsgBox("Successfully added new user");            
      Response.Redirect(
          ConfigurationManager.AppSettings["AdminLink"], true);         
} 
```

然后把 Save 参数处理放在 Factory 中（或者其他方法中的某处

```
.. In UserFactory...
 Save(int? userId, string userName, string password, 
         string eMail, string selvalue)
 {
     // code to process input parameters and save/update user
     userName = userName.Trim().ToLower();
     password = password.Trim().ToLower();
     eMail    = eMail.Trim().ToLower();
     selvalue = selvalue.Trim().ToLower();
     IUser user = userId.HasValue?
                    UserFactory.getInstance().createUser(
                            userId.Value, username, password, 
                            email,status):
                    UserFactory.getInstance().createUser(
                            username, password, 
                            email, status);
     try { user.Save(); }
     catch(DBException dbX)  //   catch/rethrow Database exception 
                             //   as custom expcetion here
     {
         throw new MyCustomAppException(
                 "Save User failed: + dbX.Message",
                 dbX);
     }  
 } 
```

并将异常处理放在 Web 表单的主入口点...

```
public partial class MyWebPage:  System.Web.UI.Page     
{
    static void Page_Load(object sender, EventArgs e)         
    {
         try 
         {
             // asp.Net Page Load code here ...
         }
         catch(MyMainCustomApplicationException X)
         {
             jsMsgBox("An Error was encountered: " + X.Message);  
             lblInfo.Text = X.Message;        
             lblInfo.Visible = true;
         }
         catch(Exception eX) 
         {  
              // Maybe Log it here...
              throw;   // Important to retrhow all unexpected exceptions to
                       // MAKE web page crash !! as you have no idea
                       // whether web app is in consistent state now.
         }
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T18:03:53.080

在方法中封装变量的分配以便重用

```
private IUser GetUser()
{

    string username = FormatText(txtUsername.Text)
    string password = FormatText(txtPassword.Text);
    string email = FormatText(txtEmail.Text);       
    string status = ddlStatus.SelectedValue.Trim();
    if(txtUserPK.Text!=string.empty){
        int userPK = Int32.Parse(txtUserPK.Text);
        IUser user = UserFactory.getInstance().
                         createUser(userPK, username, password, email, status);
    }
    else
    {
        IUser user = UserFactory.getInstance().
                         createUser(username, password, email, status);
    }
    return user;
}

private string FormatText(string input)
{
    return input.Trim().ToLower();
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T18:15:22.863

此外，您获取用户/密码/电子邮件/状态两次。我至少将这四个封装到一个具有单个 Get 方法或属性的类中。如果它们一起出现在表单上，​​我会将它们封装在用户控件中，将各个值作为用户控件的属性公开。

不重构，但仍然：

我会摆脱 try/catch 块。您向用户显示的消息不是他们希望看到的，或者可以做任何事情。最好让它传播并由 ASP.NET 记录。使用自定义错误页面为用户提供更漂亮的外观，例如“对不起，我们搞砸了”。

# c# - 每次迭代都会评估 for 循环中的条件吗？

> ID：655373
> 
> 赞同：36
> 
> 时间：2009-03-17T17:58:48.410
> 
> 标签：c#, .net, loops

当您执行以下操作时：

```
for (int i = 0; i < collection.Count; ++i ) 
```

每次迭代都会调用collection.Count吗？

如果 Count 属性在调用时动态获取计数，结果会改变吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-17T18:17:30.893

Yes Count 将在每一次通过时进行评估。原因是在循环执行期间可能会修改集合。给定循环结构，变量 i 应该表示迭代期间集合中的有效索引。如果没有在每个循环上都进行检查，那么这不能证明是正确的。示例案例

```
for ( int i = 0; i < collection.Count; i++ ) {
  collection.Clear();
} 
```

此规则的一个例外是循环遍历约束为长度的数组。

```
for ( int i = 0; i < someArray.Length; i++ ) {
  // Code
} 
```

在某些情况下，CLR JIT 会对这种类型的循环进行特殊处理，因为数组的长度不能改变。在这些情况下，边界检查只会发生一次。

参考：http: [//blogs.msdn.com/brada/archive/2005/04/23/411321.aspx](http://blogs.msdn.com/brada/archive/2005/04/23/411321.aspx)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-17T18:01:21.947

每次通过都会评估计数。如果您继续添加到集合中并且迭代器从未赶上，您将有一个无限循环。

```
class Program
    {
        static void Main(string[] args)
        {
            List<int> intCollection = new List<int>();
            for(int i=-1;i < intCollection.Count;i++)
            {
                intCollection.Add(i + 1);
            }
        }
    } 
```

这最终会出现内存不足异常。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T18:06:54.960

是的，从 i 初始化后的第一次迭代到检查失败并退出 for 循环的最后一次迭代，每次调用都会检查计数。您可以根据需要修改集合计数，但要意识到您最终可能会陷入无限循环。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-17T18:21:31.133

就像这里的其他答案一样：是的，原则上。

（至少）有一个明显的例外，array.Length。在

```
for (int i = 0; i < a.Length; i++) a[i] = ...; 
```

Length 属性只会被评估一次。这是一种硬连线到编译器中的优化。（将来）可能会有其他类似的情况，但前提是保证不会对可观察的行为产生影响。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-17T18:20:49.670

旁注，这不是为 VB 中的每个交互检查。

与 C# 不同，VB 缓存了 collection.Count 的结果。

编辑：

C# for 循环的文字 VB 版本是：

```
Dim i = 0
Do While i < collection.Count
    'code goes here
    i+=1
Loop 
```

# c++ - 如何在c ++中将内存块读取为char

> ID：655378
> 
> 赞同：1
> 
> 时间：2009-03-17T17:59:30.377
> 
> 标签：c++, malloc, char

您好，我有一块内存（使用 malloc() 分配），其中包含位（位字面量），我想将其读取为 char 数组，或者，更好的是，我想打印出 8 的 ASCII 值连续位的内存。

我已将他的内存分配为 char *，但我无法以比评估每个位更好的方式取出字符，将值添加到 char 并在循环中向左移动 char 的值，但我正在寻找更快的解决方案。谢谢

我现在写的是这样的：

分配：

```
char * bits = (char*) malloc(1); 
```

写给内存：

```
ifstream cleartext;
cleartext.open(sometext);
while(cleartext.good())
{
     c = cleartext.get();
     for(int j = 0; j < 8; j++)
     {  //set(index) and reset(index) set or reset the bit at bits[i]
        (c & 0x80) ? (set(index)):(reset(index));//(*ptr++ = '1'):(*ptr++='0');
         c = c << 1;
     }..
}.. 
```

直到现在我还无法恢复角色，我只能使用以下方法打印出位：

```
printf("%s\n" bits); 
```

我正在尝试做的一个例子是：

input.txt 包含字符串“AAAB”

我的程序必须将“AAAB”作为“01000001010000010100000101000010”写入内存（AAAB 的 ASCII 值是 65656566 位）

然后我希望它具有将内存内容重写为文件的功能。

因此，如果内存再次包含“01000001010000010100000101000010”，它将写入输出文件“AAAB”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T18:12:39.783

```
int numBytes = 512;
char *pChar = (char *)malloc(numBytes);
for( int i = 0; i < numBytes; i++ ){
   pChar[i] = '8';
} 
```

由于这是 C++，您也可以使用“new”：

```
int numBytes = 512;
char *pChar = new char[numBytes];
for( int i = 0; i < numBytes; i++ ){
   pChar[i] = '8';
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:21:53.193

如果你想访问内存块中的每*一位*，看起来你需要`std::bitset`.

```
char* pChunk = malloc( n );
// read in pChunk data

// iterate over all the bits.
for( int i = 0; i != n; ++i ){
    std::bitset<8>& bits = *reinterpret_cast< std::bitset<8>* >( pByte );
    for( int iBit = 0; iBit != 8; ++iBit ) {
        std::cout << bits[i];
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T18:33:27.983

> 我想打印出内存连续 8 位的 ASCII 值。

任何位的可能值是 0 或 1。您可能至少需要一个字节。

> char * bits = (char*) malloc(1);

在堆上分配 1 个字节。更有效和更轻松的事情是在堆栈上创建一个对象，即：

```
char bits; // a single character, has CHAR_BIT bits 
```

> ifstream 明文；
> 
> cleartext.open(sometext);

上面没有写任何东西给内存。它尝试以输入模式打开文件。

> 它有 ascii 字符和常见的 eof 或 \n 或类似的东西，输入只会是一个文本文件，所以我认为它应该只包含 ASCII 字符，如果我错了，请纠正我。

如果您的文件只有 ASCII 数据，您不必担心。您需要做的就是读入文件内容并将其写出。编译器管理数据的存储方式（即为您的字符使用哪种编码以及如何用二进制表示它们，系统的字节序等）。读取/写入文件的最简单方法是：

```
// include these on as-needed basis
#include <algorithm>
#include <iostream>
#include <iterator>
#include <fstream>

using namespace std;
// ...

/* read from standard input and write to standard output */
copy((istream_iterator<char>(cin)), (istream_iterator<char>()),
                  (ostream_iterator<char>(cout)));
/*-------------------------------------------------------------*/

/* read from standard input and write to text file */
copy(istream_iterator<char>(cin), istream_iterator<char>(),
         ostream_iterator<char>(ofstream("output.txt"), "\n") );
/*-------------------------------------------------------------*/

/* read from text file and write to text file */
copy(istream_iterator<char>(ifstream("input.txt")), istream_iterator<char>(),
         ostream_iterator<char>(ofstream("output.txt"), "\n") );
/*-------------------------------------------------------------*/ 
```

~~最后剩下的问题是：你想用二进制表示做点什么吗？如果没有，那就算了。否则，再更新一次您的问题。~~

> 例如：处理字符数组以使用分组密码对其进行加密

```
/* a hash calculator */
struct hash_sha1 {
 unsigned char operator()(unsigned char x) {
    // process
    return rc;
  }
};

/* store house of characters, could've been a vector as well */
basic_string<unsigned char> line;

/* read from text file and write to a string of unsigned chars */   
copy(istream_iterator<unsigned char>(ifstream("input.txt")),
                                     istream_iterator<char>(),
                                      back_inserter(line) );

/* Calculate a SHA-1 hash of the input */   
basic_string<unsigned char> hashmsg;
transform(line.begin(), line.end(), back_inserter(hashmsg), hash_sha1()); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T18:03:33.843

像这样的东西？

```
char *buffer = (char*)malloc(42);
// ... put something into the buffer ...
printf("%c\n", buffer[0]); 
```

但是，既然你使用的是 C++，我想知道你为什么要这么麻烦`malloc`……

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T18:06:42.200

```
char* ptr = pAddressOfMemoryToRead;

while(ptr < pAddressOfMemoryToRead + blockLength)
{
     char tmp = *ptr;
     // temp now has the char from this spot in memory
     ptr++;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T18:06:56.613

这是你想要实现的目标：

```
char* p = (char*)malloc(10 * sizeof(char));
char* p1 = p;
memcpy(p,"abcdefghij", 10);

for(int i = 0; i < 10; ++i)
{
    char c = *p1;
    cout<<c<<" ";
    ++p1;
}
cout<<"\n";
free(p); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T18:08:49.760

您能否更详细地解释一下，也许包括代码？除非我完全误读了您的问题，否则您所说的毫无意义。你在做这样的事情吗？

```
char * chunk = (char *)malloc(256); 
```

`chunk`如果是这样，您可以通过将其视为数组来访问任何字符的数据：`chunk[5]`为您提供第 5 个元素等。当然，这些将是字符，这可能是您想要的，但我无法从您的问题中完全看出...例如，如果`chunk[5]`是 65，当你像 一样打印它时`cout << chunk[5];`，你会得到一个字母'A'。

但是，您可能会问如何打印出实际的数字 65，在这种情况下您想要执行`cout << int(chunk[5]);`. 转换为`int`将使其打印为整数值而不是字符。如果您澄清您的问题，我或其他人可以进一步帮助您。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T18:11:59.127

您是在问如何将任意结构的内存字节复制到 char* 数组中？如果是这样，这应该可以解决问题

```
SomeType t = GetSomeType();
char* ptr = malloc(sizeof(SomeType));
if ( !ptr ) {
  // Handle no memory.  Probably should just crash
}
memcpy(ptr,&t,sizeof(SomeType)); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T18:55:31.380

我不确定我是否完全理解您正在尝试做的事情，但有一些建议：

1) 使用 std::vector 代替 malloc/free 和 new/delete。它更安全，并且没有太多开销。

2）处理时，尝试做块而不是字节。即使流被缓冲，它通常一次抓取一个块更有效。

3）有很多不同的方式来输出位，但同样你不希望每个字符都有流输出。您可能想尝试以下方法：

```
void outputbits(char *dest, char source)
{
    dest[8] = 0;
    for(int i=0; i<8; ++i)
        dest[i] = source & (1<<(7-i)) ? '1':'0';
} 
```

将 char[9] 输出缓冲区和 char 输入传递给它，您将得到一个可打印的位串。体面的编译器为此生成好的输出代码......你需要多少速度？

# visual-studio - 双击文件时如何强制 Visual Studio 2008 使用 Open 实例？

> ID：655380
> 
> 赞同：5
> 
> 时间：2009-03-17T17:59:40.343
> 
> 标签：visual-studio, visual-studio-2008

我使用 Visual Studio 处理的某些非项目文件（.build、.xml、自由漫游 html 和 css 文件）已经与 Visual Studio 相关联，并在我双击它们时在其中打开。

如何让它们在现有的 Visual Studio 实例中打开？现在如果我双击同一个文件两次，它将打开两个 Visual Studio 实例，如果已经有一个 VS 打开实例，我希望它基本上忽略第二次打开尝试。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T20:01:10.200

好的，理查德帮助我指出了正确的方向，但我想我找到了我想要的。

1.  从资源管理器窗口，转到工具-> 文件夹选项-> 文件类型选项卡
2.  找到您要更改的扩展名。
3.  如果有恢复按钮，请单击它。
4.  单击高级
5.  单击新建... 以创建新操作。
6.  我设置了以下内容：

操作：在 VS 2008 中打开
"C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe" /dde
check use dde
​​DDE Message: Open("%1")
Application: VisualStudio.9.0
DDE Application Not Running :（留空）
主题：系统

7.  点击确定
8.  将新操作设置为默认值。
9.  点击确定，点击确定

现在，该扩展名的行为将与问题中的描述完全相同。如果 Visual Studio 已经打开，该文件将在现有的 VS 中打开。

我还使用它来修复一些在 2008 年之后重新安装 VS 2005 时损坏的扩展。

Win 7/ VS 2012
您可以右键单击文件，转到属性。然后有一个“打开方式”行和一个更改按钮。但我看不到强制其他命令行选项的方法。VS2012 似乎默认使用打开的实例。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-04T14:09:30.520

Windows 7 vs2010 答案；

因为“默认程序 > 将文件类型或协议与程序关联”太没用了，所以使用 regedit。

导航到**HKEY_CLASSES_ROOT\VisualStudio.XXX.10.0\shell\Open\Command**并将**/edit**添加到 open with 行的末尾，其中 XXX 是您希望影响的文件类型。

.cpp 的示例 .reg 文件；

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\VisualStudio.cpp.10.0\shell\Open\Command]
@="\"C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\Common7\\IDE\\devenv.exe\" /dde /edit" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T18:48:14.563

哪个版本的VS？

对于 2003 年，有[VSEdit](http://code.msdn.microsoft.com/VSEdit)。

在 2005 年，这就是它开箱即用的方式。快速谷歌搜索发现[了一些](http://blogs.msdn.com/saraford/archive/2005/12/08/501824.aspx)可能有帮助的东西。

希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-22T13:32:41.767

更高版本的 Visual Studio 似乎也有通过 DDE 从某些应用程序打开文件的问题（例如，在 SSHCommunications 的安全文件传输客户端中；Winzip 和资源管理器似乎工作正常）。之前给出的解决方案仍然会发生这种情况。

1.  当 IDE 已经加载时，IDE 聚焦但给出错误“找不到指定的模板。请检查完整路径是否正确'
2.  当 IDE 未加载时，它会间歇性地给出错误“无法打开文件，因为它正在被另一个进程使用。请关闭所有可能访问此文件的应用程序，然后重试”。重试继续为 1)

结合之前的所有帖子，您可以让它在所有情况下都能正常工作！

1.  安装[VSEdit](http://code.msdn.microsoft.com/VSEdit)应用程序（如 Richard/Jeff 为 .Net 2003 所建议的那样），无论您使用的 msdev 版本是什么（或多个版本）：他们引用的 Sara Ford 的[帖子](http://saraford.net/2005/12/08/use-devenv-edit-to-open-any-file-in-an-existing-visual-studio-instance-vsedit-functionality/)推荐 VSEdit 用于 VS2005 中的命令行操作 - 它似乎也适用于更高版本。
2.  按照 Jeff 的建议更改 DDE（工具-> 文件夹选项-> 文件类型），但直接通过 VSEdit.exe 而不是 devenv.exe 打开。具体来说：

> 操作：打开 "C:\Program Files\PowerToys for Visual Studio .NET 2003\VSEdit\VSEdit.exe" /c "C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe /Edit """ %1"""" "%1" 使用 dde：（选中）DDE 消息：（留空）应用程序：VSEdit DDE 应用程序未运行：（留空）主题：系统

注意 三重/四重引号是故意的 - 它们将第一个打开的文件（引用）添加到启动命令的末尾，以防止 msdev 在启动时抱怨 /Edit 模式的命令行使用情况。显然，命令路径需要针对不同的安装进行更改。

# c++ - gcc -O2 的含义

> ID：655382
> 
> 赞同：17
> 
> 时间：2009-03-17T18:00:15.723
> 
> 标签：c++, c, gcc

我在 makefile 中经常看到这个标志。它是什么意思，应该在什么时候使用？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-17T18:01:45.410

优化级别 2。

从 GCC 手册页：

> -O1 优化。优化编译需要更多时间，大型函数需要更多内存。
> 
> -O2 优化更多。GCC 执行几乎所有支持的优化，不涉及空间速度折衷。当您指定 -O2 时，编译器不会执行循环展开或函数内联。与 -O 相比，此选项增加了编译时间和生成代码的性能。
> 
> -O3 优化更多。-O3 打开 -O2 指定的所有优化，同时打开 -finline-functions、-funswitch-loops、-fpredictive-commoning、-fgcse-after-reload 和 -ftree-vectorize 选项。
> 
> -O0 减少编译时间并使调试产生预期的结果。这是默认设置。
> 
> -Os 优化大小。-Os 启用通常不会增加代码大小的所有 -O2 优化。它还执行旨在减少代码大小的进一步优化。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-17T18:02:23.393

优化级别 2，最大值为 3。参见： http: [//gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html)

请注意，在几年前`-O3`，过度“优化”代码可能会导致一些故障。AFAIK，现代版本的 GCC 不再适用。但有了惯性，`-O2`就被认为是“最大的安全”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T18:01:56.720

这是一个优化开关。请参阅 gcc --help。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T18:04:14.170

编译器可以使用各种优化技术，如循环展开、CPU 管道优化来查找无用代码并避免数据危害来加速您的代码。例如，发生固定次数的循环将被转换为连续代码，而没有循环控制开销。或者，如果所有循环迭代都是独立的，则可以进行一些代码并行化。

将优化级别设置为 2 表明编译器应该花费多少精力来寻找这些优化。可能的值范围从 1 到 3

您可以了解更多关于编译器可以做什么来优化您的代码：[http ://en.wikipedia.org/wiki/Compiler_optimization](http://en.wikipedia.org/wiki/Compiler_optimization)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T18:06:17.863

尝试过手册页？

-O2

进一步优化。GCC 执行几乎所有支持的优化，不涉及空间速度折衷。当您指定 -O2 时，编译器不会执行循环展开或函数内联。与 -O 相比，此选项增加了编译时间和生成代码的性能。

*用人类的话来说：这是最高的真正安全的优化方式。-O3 进行重组，这有时会很麻烦。这样的主题是相当深刻的。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-30T19:09:47.343

在没有任何优化选项的情况下，编译器的目标是降低编译成本并使调试产生预期的结果。打开优化会使编译器尝试以牺牲编译时间和调试程序的能力为代价来提高性能和/或代码大小。

默认为关闭优化。这会产生最快的编译时间，但编译器绝对不会尝试优化，并且生成的程序比启用优化时要大得多且慢得多。gcc 中有各种 -O 开关（允许的形式是 -O0、-O1 -O2、-O3 和 -Os）来控制优化级别：

-O0 无优化；生成未优化的代码，但编译时间最快。这是默认设置。

-O1 中等优化；优化得相当好，但不会显着降低编译时间。大型功能需要更多内存。

-O2 GCC 执行几乎所有支持的优化，不涉及空间速度折衷。当您指定时，编译器不会执行循环展开或函数内联

-O3 与 -O2 一样的完全优化；还使用更积极的单元内子程序的自动内联并尝试向量化循环。它还打开 -finline-functions、-funswitch-loops、-fpredictive-commoning、-fgcse-after-reload 和 -ftree-vectorize 选项。

-Os 优化大小。-Os 启用通常不会增加代码大小的所有 -O2 优化。它还执行旨在减少代码大小的进一步优化。

要了解有关在各种优化级别使用的标志/选项及其详细信息的更多信息：http: [//gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html)

# ruby - 有没有办法离线更新 RubyGems？

> ID：655386
> 
> 赞同：6
> 
> 时间：2009-03-17T18:01:06.377
> 
> 标签：ruby, rubygems, watir

我正在尝试将 Ruby + WATIR 安装到处于隔离环境中的 Windows 服务器。通常我会运行 ruby​​ 安装程序，然后运行以下两个命令：

1) 宝石更新--系统

2）宝石安装水

这是按照[这里的说明](http://wtr.rubyforge.org/install.html)

我现在尝试安装的服务器没有互联网连接。这会导致上述命令失败。

*有没有办法可以下载所需的更新包并将它们复制到服务器以在本地安装？*

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T18:24:04.793

当您执行 gem install 时，它将在查找远程源之前搜索当前目录。如果要安装本地 gem，则必须指定版本（请参阅[ruby​​gems 手册](http://www.rubygems.org/read/chapter/10#page33)）。

```
gem install copland-0.2.0.gem 
```

对不起，我不知道不用[手动升级离线更新gem系统的方法](http://docs.rubygems.org/read/chapter/3#page13)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:33:18.063

我通常使用

```
gem unpack blah-1.1.1.gem 
```

将 gem 解压到单独的 Ruby 文件中。然后你只需要确保该目录在你的 Ruby 加载路径中，它和普通的 gem 一样好。

# java - Lucene 相似类的高级解释？

> ID：655393
> 
> 赞同：7
> 
> 时间：2009-03-17T18:02:01.617
> 
> 标签：java, search, lucene, search-engine

你知道我在哪里可以找到[Lucene Similarity Class](http://lucene.apache.org/java/2_2_0/api/org/apache/lucene/search/Similarity.html)算法的高级解释。我想理解它，而不必破译与搜索和索引有关的所有数学和术语。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T18:22:28.120

Lucene 的内置`Similarity`是一个相当标准的[“逆文档频率”](http://en.wikipedia.org/wiki/Tf%E2%80%93idf)评分算法。维基百科的文章很简短，但涵盖了基础知识。[*Lucene in Action*](http://www.amazon.com/gp/search?field-isbn=978-1932394283)一书更详细地分解了 Lucene 公式；它并没有完美地反映当前的 Lucene 公式，但解释了所有主要概念。

首先，分数随该词条在当前文档中出现的次数（*词条频率*）而变化，与该词条在所有文档中出现的次数（*文档频率）**成反比*。公式中的其他因素是次要的，调整分数以试图使不同查询的分数彼此相当。

 ** * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T18:24:24.823

将每个文档和搜索词视为一个向量，其坐标代表了整个文档语料库中每个词对该特定文档或搜索词的重要性的某种度量。相似性告诉您两个不同向量之间的距离。

假设您的语料库被规范化以忽略某些术语，那么仅包含这些术语的文档将位于您的语料库定义的向量空间中所有文档的图形的原点。每个包含一些其他术语的文档都表示空间中的一个点，其坐标由文档中该术语相对于语料库中该术语的重要性定义。两个文档（或一个文档和搜索）的坐标将它们的“点”靠得更近，比坐标使它们的“点”更远的那些更相似。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-22T22:52:42.480

Erickson 在 Lucene 中提到的余弦相似度词频-逆文档频率 (TF-IDF)。假设您在查询和文档中有两袋术语。此测量仅匹配完全匹配的术语，并且在上下文中包括它们的语义权重。经常出现的术语权重较小（重要性），因为您可以在很多文档中找到它们。但是我看到的严重问题是余弦相似度 TF-IDF 在更不一致的数据上不是那么稳健，您需要计算查询和更稳健的文档之间的相似度，例如拼写错误、印刷和语音错误。因为单词必须完全匹配。

# c# - JQuery/WCF without ASP.NET AJAX:

> ID：655400
> 
> 赞同：10
> 
> 时间：2009-03-17T18:03:36.357
> 
> 标签：c#, jquery, wcf, json, .net-3.5

I am proper struggling getting that "magic" moment when WCF is configured nicely and jQuery is structuring its requests/understanding responses nicely.

I have a service:

```
<%@ ServiceHost Language="C#" Debug="true" Service="xxx.yyy.WCF.Data.ClientBroker" Factory="System.ServiceModel.Activation.WebScriptServiceHostFactory"  %> 
```

This was recommended by the man [Rick Strahl](http://www.west-wind.com/WebLog/posts/310747.aspx) to avoid having to define the behaviours within Web.config.

My interface for the WCF service sits in another assembly:

```
namespace xxx.yyy.WCF.Data
{       
    [ServiceContract(Namespace = "yyyWCF")] 
    public interface IClientBroker
    {
        [OperationContract]         
        [WebInvoke(Method="POST",BodyStyle=WebMessageBodyStyle.Wrapped,ResponseFormat=WebMessageFormat.Json)]
        IClient GetClientJson(int clientId);    
    }
} 
```

The concrete service class is:

```
namespace xxx.yyy.WCF.Data
{
    [AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]
    class ClientBroker : IClientBroker 
    {
        public IClient GetClientJson(int clientId)
        {
            IClient client=new Client();

            // gets and returns an IClient
            return client;
        }
    }
} 
```

My IClient is an Entity Framework class so is decorated with DataContract/DataMember attributes appropriately.

I am trying to call my WCF service using the methods outlined on Rick Strahl's blog at [http://www.west-wind.com/weblog/posts/324917.aspx](http://www.west-wind.com/weblog/posts/324917.aspx) (the "full fat" version). The debugger jumps into the WCF service fine (so my jQuery/JSON is being understood) and gets the IClient and returns it. However, when I return the response, I get various useless errors. The errors I am getting back don't mean much.

I am using POST.

Am I right to be using an Interface instead of a concrete object? As it does get into the WCF service, it does seem to be the encoding of the result that is failing.

Does anyone have any ideas?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T20:45:02.500

At first glance there are three problems with your code:

1: you should use the [ServiceKnownTypeAttribute](http://msdn.microsoft.com/en-us/library/system.servicemodel.serviceknowntypeattribute.aspx) to specify known types when exposing only base types in your operation contracts:

```
[ServiceContract(Namespace = "yyyWCF")]     
public interface IClientBroker
{
    [OperationContract]
    [ServiceKnownType(typeof(Client))]
    [WebInvoke(
        Method="GET",
        BodyStyle=WebMessageBodyStyle.WrappedRequest,
        ResponseFormat=WebMessageFormat.Json)]
    IClient GetClientJson(int clientId);

} 
```

2: You should use `WebMessageBodyStyle.WrappedRequest` instead of `WebMessageBodyStyle.Wrapped` because the latter is not compatible with [WebScriptServiceHostFactory](http://msdn.microsoft.com/en-us/library/system.servicemodel.activation.webscriptservicehostfactory.aspx).

3: IMHO using Method="GET" would be more RESTful for a method called GetClientJson than Method="POST"

Another advice I could give you when working with WCF services is to use [SvcTraceViewer.exe](http://msdn.microsoft.com/en-us/library/ms732023.aspx) bundled with Visual Studio. It is a great tool for debugging purposes. All you need is to add the following section to your app/web.config:

```
 <system.diagnostics>
    <sources>
      <source name="System.ServiceModel"
              switchValue="Information, ActivityTracing"
              propagateActivity="true">
        <listeners>
          <add name="sdt"
              type="System.Diagnostics.XmlWriterTraceListener"
              initializeData= "WcfDetailTrace.e2e" />
        </listeners>
      </source>
    </sources>
  </system.diagnostics> 
```

Then invoke the web method and WcfDetailTrace.e2e file will be generated in your web site root directory. Next open this file with SvcTraceViewer.exe and you will see lots of useful information. For example it could say:

> Cannot serialize parameter of type 'MyNamespace.Client' (for operation 'GetClientJson', contract 'IClientBroker') because it is not the exact type 'MyNamespace.IClient' in the method signature and is not in the known types collection. In order to serialize the parameter, add the type to the known types collection for the operation using ServiceKnownTypeAttribute.

Of course you should not forget commenting this section before going into production or you might end up with some pretty big files.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T20:37:37.120

I am 99% sure you cant return an interface. I dont think Interfaces are serializable.

check out this [thread](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/31102bd8-0a1a-44f8-b183-62926390b3c3/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-31T14:10:09.750

Related to the question, a while ago I posted an article on my blog showing all the steps needed to get a WCF service working together with jQuery code on the client side:

[http://yoavniran.wordpress.com/2009/08/02/creating-a-webservice-proxy-with-jquery/](http://yoavniran.wordpress.com/2009/08/02/creating-a-webservice-proxy-with-jquery/)

# c# - 如何将属性更改事件传递给祖先？

> ID：655404
> 
> 赞同：1
> 
> 时间：2009-03-17T18:03:53.187
> 
> 标签：c#, wpf, data-binding, .net-3.5

我确定我在这里遗漏了一些基础知识，所以请多多包涵。

我有两个对象，一个 SalesOrder 和一个 SalesOrderLineItem。订单项保存在`Observablecollection<SalesOrderLineItem>`SalesOrder 中，如果我添加订单项，我的数据绑定 listView 就会知道新项目。

现在我遇到了问题：SalesOrder 有一个名为“OrderTotal”的只读属性，它知道所有行项目组合的总价格是多少。

如果我更改订单项的数量或价格，我似乎不知道如何让更改通知冒泡到“OrderTotal”。

这两个类都继承自 fire `INotifyPropertyChanged`。

我错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T18:19:22.887

ObservableCollection 仅在添加、删除 Item 或刷新列表时通知，而不是在集合中 Item 的属性更改时通知。

SalesOrder 类需要监听每个 SalesOrderLineItem 的 PropertyChanged 事件。

-

OrderTotal 属性也可以是动态的，每次都会生成总数...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:36:33.327

如果您喜欢冒险，可以尝试[BindableLinq](http://www.codeplex.com/BindableLinq)或类似的东西。它允许您公开侦听更改的查询的结果。

但它还没有退出测试版，而且我不确定它是否会... [ContinuousLinq](http://www.codeplex.com/clinq)是另一个，但它根本不支持 Silverlight。

除此之外，您必须倾听每个孩子的声音，并在集合更改时添加/删除处理程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-30T09:15:43.483

```
public ObservableCollection<TestClass> List
    {
        get { return _List; }
        set {
            if (_List!= value)
            {
                _List = value;
                raisePropertyChange("List");
                List.ToList().ForEach(i=> i.PropertyChanged+= (o,e)=>
                {
                    //PropertyChanged.Raise(() => List);
        raisePropertyChange("List");
        //or what ever you want
                }
            );

            }
        }
    } 
```

# wpf - 启用/禁用的 WPF WinForms 互操作问题

> ID：655410
> 
> 赞同：10
> 
> 时间：2009-03-17T18:05:15.120
> 
> 标签：wpf, winforms, interop

我有一个 WinForms 用户控件，其中托管 WPF 自定义列表框。在 WinForms 用户控件被禁用然后重新启用后，WinForms 用户控件中的 WPF 控件无响应。有没有其他人经历过这个？

每次控件被禁用/启用以解决问题时，我们都不得不破解并删除并重新添加元素主机。

## WinForms

```
wpfControl.Enabled = false;
...
wpfControl.Enabled = true; 
```

黑客在用户控件的 WinForms EnabledChanged 方法中修复它

```
if ( Enabled ) 
{
  ElementHost oldEh = ctlElementHost;
  ElementHost eh = new ElementHost();
  eh.Name = oldEh.Name;
  oldEh.Child = null;
  eh.Child = wpfControl;
  this.Controls.Remove( ctlElementHost );
  this.Controls.Add( eh );
  eh.Dock = DockStyle.Fill;

  oldEh.Dispose();
  ctlElementHost = eh;
} 
```

似乎存在内存泄漏，其中已处置的元素主机仍然存在，直到托管 WinForms 用户控件的父窗体关闭。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-12T14:16:08.867

我的一位同事（感谢 KwB）设法找到了解决此问题的方法：http: [//support.microsoft.com/kb/955753](http://support.microsoft.com/kb/955753)

它涉及从 ElementHost 继承并手动告诉窗口区域启用：

```
public class MyElementHost : ElementHost
{
    protected override void OnEnabledChanged(EventArgs e)
    {
        SynchChildEnableState(); 

        base.OnEnabledChanged(e);
    } 

    private void SynchChildEnableState()
    {
        IntPtr childHandle = GetWindow(Handle, GW_CHILD);
        if (childHandle != IntPtr.Zero)
        {
            EnableWindow(childHandle, Enabled);
        }
    } 

    private const uint GW_CHILD = 5; 

    [DllImport("user32.dll")]
    private extern static IntPtr GetWindow(IntPtr hWnd, uint uCmd); 

    [DllImport("user32.dll")]
    private extern static bool EnableWindow(IntPtr hWnd, bool bEnable);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T22:27:37.987

元素宿主是否订阅来自 WPF 用户控件的事件？如果是这样，并且在尝试释放元素主机之前未连接事件，它将在内存中徘徊，直到释放 WPF 控件（并且由于看起来您始终使用相同的控件实例，那就是直到表格关闭。）

# xml - 使用 XSLT 将 XML 元素转换为 XML 属性

> ID：655411
> 
> 赞同：17
> 
> 时间：2009-03-17T18:05:32.060
> 
> 标签：xml, xslt

我们有一个当前系统可以输出以下格式的 XML 文件：

```
<INVENTORY>
   <ITEM>
      <SERIALNUMBER>something</SERIALNUMBER>
      <LOCATION>something</LOCATION>
      <BARCODE>something</BARCODE>
   </ITEM>
</INVENTORY> 
```

我需要使用这些数据加载到标准的 .NET 2.0 网格中。但网格需要 XML 采用以下格式：

```
<INVENTORY>
   <ITEM serialNumber="something" location="something" barcode="something">
   </ITEM>
</INVENTORY> 
```

即item的子节点需要转化为item节点的属性。

有人知道如何使用 XSLT 做到这一点吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-17T18:16:46.713

这应该有效：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:template match="INVENTORY">
    <INVENTORY>
      <xsl:apply-templates/>
    </INVENTORY>
  </xsl:template>

  <xsl:template match="ITEM">
    <ITEM>
      <xsl:for-each select="*">
        <xsl:attribute name="{name()}">
          <xsl:value-of select="text()"/>
        </xsl:attribute>

      </xsl:for-each>
    </ITEM>
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T18:11:15.307

这两个模板应该这样做：-

```
<xsl:template match="ITEM">
   <ITEM serialNumber="{SERIALNUMBER}" location="{LOCATION}" barcode="{BARCODE}" />
</xsl:template>

<xsl:template match="INVENTORY">
   <INVENTORY>
      <xsl:apply-templates />
   </INVENTORY>
</xsl:template> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T02:02:35.170

**这可能是最简单的解决方案**，它将任何子元素转换`ITEM`为其属性并按原样复制其他所有内容，同时将元素名称转换为任何所需的属性名称：

```
<xsl:stylesheet version="1.0" 
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>
<!--                                              --> 
  <xsl:strip-space elements="*"/>

  <xsl:variable name="vrtfNameMapping">
    <item name="SERIALNUMBER" newName="serialNumber"/>
    <item name="LOCATION" newName="location"/>
    <item name="BARCODE" newName="barcode"/>
  </xsl:variable>
 <!--                                              --> 
  <xsl:variable name="vNameMapping" select=
  "document('')/*/xsl:variable[@name='vrtfNameMapping']"/>
<!--                                              --> 

  <xsl:template match="node()|@*">
    <xsl:copy>
      <xsl:apply-templates select="node()|@*"/>
    </xsl:copy>
  </xsl:template>
<!--                                              --> 
  <xsl:template match="ITEM/*">
    <xsl:attribute name=
     "{$vNameMapping/*[@name=name(current())]/@newName}">
      <xsl:value-of select="."/>
    </xsl:attribute>
  </xsl:template>
</xsl:stylesheet> 
```

**当对提供的 XML 文档应用上述转换时**：

```
<INVENTORY>
    <ITEM>
        <SERIALNUMBER>something</SERIALNUMBER>
        <LOCATION>something</LOCATION>
        <BARCODE>something</BARCODE>
    </ITEM>
</INVENTORY> 
```

**产生了想要的结果**：

```
<INVENTORY>
   <ITEM serialNumber="something" location="something" barcode="something"/>
</INVENTORY> 
```

**请注意**以下事项：

1.  [**身份规则**](http://www.dpawson.co.uk/xsl/sect2/identity.html)的使用[](http://www.dpawson.co.uk/xsl/sect2/identity.html)

***   指某东西的用途[**`<xsl:strip-space elements="*"/>`**](http://www.w3.org/TR/xslt#element-strip-space)

    *   该变量的使用**`vrtfNameMapping`**无需任何`xxx:node-set()`扩展功能。

    *   事实上，我们处理名称和 newName 之间的任何映射，而不仅仅是简单的小写字母。** 

 *** * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T18:09:05.640

这应该这样做：

```
 <xsl:for-each select="//ITEM">
    <xsl:element name="ITEM">
      <xsl:attribute name="serialNumber">
        <xsl:value-of select="SERIALNUMBER"/>
      </xsl:attribute>
      <xsl:attribute name="location">
        <xsl:value-of select="LOCATION"/>
      </xsl:attribute>
      <xsl:attribute name="barcode">
        <xsl:value-of select="BARCODE"/>
      </xsl:attribute>
    </xsl:element>
  </xsl:for-each> 
```

或使用大卫的快捷方式：

```
<xsl:for-each select="//ITEM">
  <ITEM serialNumber="{SERIALNUMBER}" location="{LOCATION}" barcode="{BARCODE}"/>
</xsl:for-each> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T18:10:21.067

如果您的来源如下所示：

```
<row><a>1</a><b>2</b></row> 
```

你希望它看起来像这样：

```
<row a="1" b="2" /> 
```

那么这个 XSLT 应该可以工作：

```
<xsl:template match="row">
    <row a="{a}" b="{b}" />
</xsl:template> 
```

# php - PHP 将时间设置为太平洋夏令时

> ID：655412
> 
> 赞同：2
> 
> 时间：2009-03-17T18:05:44.650
> 
> 标签：php, time, dst

在 PHP 站点中，我有当前时间设置：

D j MY, G:ia

如何更改它以使用夏令时反映当前太平洋时间？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:14:50.727

您可以使用[`date_default_timezone_set`](http://us.php.net/date_default_timezone_set)设置运行所有日期函数的时区。如果您只需要当前时间，PHP 日期函数会为您处理夏令时 (DST)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:38:11.203

```
date_default_timezone_set('America/Los_Angeles'); // or wherever you are

$time = time();

if ($time >= strtotime("Second Sunday March 0")  && $time < strtotime("First Sunday November 0")) 
{

    echo date('m/d/y h:i a', $time);

} else {

    echo date('m/d/y h:i a', $time);

} 
```

# c# - 在 Silverilght 中将节点集合绑定到 itemscontrol 的最佳方法

> ID：655427
> 
> 赞同：1
> 
> 时间：2009-03-17T18:09:25.297
> 
> 标签：c#, silverlight, collections

我有一个 Silverlight 项目，其中主要对象只是一堆相互连接的节点。一个父节点可以有很多子节点。

我希望能够将节点绑定到 itemscontrol 或类似的，因此想知道如何最好地构建父子关系。

是否可以创建所有节点的平面顶级列表（列出 allNodes）并将每个节点添加到该列表中，将列表绑定到 itemscontrol，然后在此之上将每个节点添加到其父节点的“子节点”列表以建立结构- 还是我在做某种丑陋的加倍？

只是希望有一些我可以掌握的最佳实践或模式

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T18:14:38.450

您应该使用[官方 silverlight 工具包](http://www.codeplex.com/Silverlight)中的树形视图。这是一个[在线演示](http://silverlight.net/samples/sl2/toolkitcontrolsamples/run/default.html)。

# vb.net - 客户使用的数据库历史记录

> ID：655430
> 
> 赞同：0
> 
> 时间：2009-03-17T18:09:55.437
> 
> 标签：vb.net, oracle, database-design

我试图找出在数据库上记录历史的最佳方式，以跟踪已完成的任何插入/删除/更新。历史数据需要被编码到前端，因为它将被用户使用。创建“历史表”（用于存储历史的每个表的副本）不是一个好方法，因为数据分布在多个表中。

在这个时间点，我最好的想法是创建一些历史表，这些表将反映我想向用户显示的输出。每当对特定表进行更改时，我也会使用数据更新此历史表。

我试图弄清楚最好的方法是什么。任何建议将不胜感激。

我正在使用 Oracle + VB.NET

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T18:15:30.150

我已经非常成功地使用了一个模型，其中每个表都有一个审计副本——同一个表有几个附加字段（时间戳、用户 ID、操作类型），以及第一个表上的 3 个触发器用于插入/更新/删除。
我认为这是一种很好的处理方式，因为表和触发器可以从模型中生成，并且从管理的角度来看几乎没有开销。应用程序可以使用这些表向用户显示审计历史记录（只读）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:57:46.303

我们的系统中有这个要求。我们添加了两个表，一个标题，一个名为 AuditRow 和 AuditField 的详细信息。AuditRow 包含在任何其他表中更改的每行一行，而 AuditField 包含每列更改旧值和新值的行。

我们在每个表上都有一个触发器，它在每次插入/更新/删除时写入标题行 (AuditRow) 和所需的详细信息行（每个更改的列一个）。这个系统确实依赖于这样一个事实，即我们在每个表上都有一个可以唯一表示行的 guid。不必是“业务”或“主”键，但它是该行的唯一标识符，因此我们可以在审计表中识别它。像冠军一样工作。矫枉过正？也许吧，但我们从来没有遇到过审计师的问题。:-)

是的，审计表是系统中迄今为止最大的表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T00:24:53.453

如果您有幸使用 Oracle 11g，您还可以使用[Flashback Data Archive](http://www.oracle.com/technology/pub/articles/oracle-database-11g-top-features/11g-transactionmanagement.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T03:10:32.243

就个人而言，我会远离触发器。当涉及到调试时，它们可能是一场噩梦，如果你想扩大规模，它们不一定是最好的。

如果您使用 PL/SQL API 来执行 INSERT/UPDATE/DELETE，您可以通过简单的设计转变来管理它，而无需（预先）历史表。

您只需要 2 个额外的列，DATE_FROM 和 DATE_THRU。插入记录时，DATE_THRU 保留为 NULL。如果该记录已更新或删除，只需通过将 DATE_THRU 设为当前日期/时间 (SYSDATE) 来“结束日期”记录。显示历史就像从表中选择一样简单，其中 DATE_THRU 为 NULL 的一条记录将是您当前或活动的记录。

现在，如果您期望进行大量更改，最好将旧记录注销到历史记录表中，但我仍然不会使用触发器来管理它，我会使用 API 来完成。

希望有帮助。

# .htaccess - 如何使用 htaccess 从 https 切换到 http

> ID：655433
> 
> 赞同：2
> 
> 时间：2009-03-17T18:10:17.243
> 
> 标签：.htaccess, https

好吧，我有一个使用所有 URL 的相对路径的站点。我刚刚添加了一个购物车，所以两个或三个结帐页面使用的是 HTTPS 而不是 HTTP。我的问题是，用户在结帐过程中途并单击导航上的链接或任何看起来*使用*HTTPS 的页面的链接，当它是不需要它的页面时（并且在某些情况下无法处理它，因为外部文件，例如 GoogleMaps.js）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:35:34.313

实际上让自己感到惊讶并一起破解了一些东西。重新路由不属于 www.domain.com/checkout 的所有内容

```
RewriteCond %{HTTPS} on
RewriteCond %{REQUEST_URI} !^(/checkout)
RewriteRule ^(.*)$ http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T18:34:01.650

你可以尝试做类似的事情

```
RewriteCond %{SERVER_PORT} !^(80|8080)$
RewriteCond %{REQUEST_URI} !^(checkout|order|etc)$
RewriteRule ^(.*)$         http://yoururl$1 
```

我不确定它是否有效，因为我没有测试它，但你可以使用测试 {SERVER_PORT} 的想法。希望能帮助到你

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T18:46:28.593

# sql-server-2005 - SSRS 2005 报告自动呈现

> ID：655435
> 
> 赞同：3
> 
> 时间：2009-03-17T18:10:41.923
> 
> 标签：sql-server-2005, reporting-services, reportingservices-2005

我创建了许多 SSRS 2005 报告，并为每个报告提供了许多参数。每个参数都有默认值，因此当有人通过 SSRS 网站访问报表时，报表会自动呈现。

我想做的是让所有报告都有它们的默认值，但防止报告自动呈现。我在网上看过，除了有人声称无法完成之外，我没有看到任何东西。我希望看到一些关于此的专家建议，以防止报告自动呈现而无需开发自定义 Web 界面。

有什么想法吗？

有谁知道这种行为在 SSRS 2008 中是否有所不同？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T18:31:05.870

奇怪的是，我的一份报告也遇到了同样的问题。您必须至少有一个未绑定到默认值的参数才能达到此效果，否则无法按照您的建议。

证明：

[http://groups.google.com/group/microsoft.public.sqlserver.reportingsvcs/browse_thread/thread/d9669fb82ecb18f0/87ed0eb0996d62bf?lnk=st&q=%22reporting+services%22+auto+load&rnum=4&hl=en&pli=1](http://groups.google.com/group/microsoft.public.sqlserver.reportingsvcs/browse_thread/thread/d9669fb82ecb18f0/87ed0eb0996d62bf?lnk=st&q=%22reporting+services%22+auto+load&rnum=4&hl=en&pli=1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:29:12.877

我遇到的唯一解决方案是使用一个不会自动选择默认值的参数。用户只需选择一个值并运行报告。我更喜欢将此作为第一个参数，以便它对于每个报告都是一致的，除此之外的任何内容都是自定义选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-21T20:40:44.037

使用可见文本参数防止 SSRS 2008 R2 自动运行：

创建参数： `DateType=Text, "Allow Blank"=True, "Allow Null"=False, "Visibility"=True, "Available Values"=None, "Default Value"=No default value.`

# .net - 从 SharePoint Webpart 调用 .NET Web 服务时如何模拟用户？

> ID：655445
> 
> 赞同：2
> 
> 时间：2009-03-17T18:12:04.293
> 
> 标签：.net, web-services, sharepoint, authentication, ntlm

在访问使用 NTLM 身份验证的 Web 服务时，模拟当前 SharePoint 用户的最佳做法是什么？webpart 有用户名但没有密码，显然，从 webpart 传递网络凭据不起作用。远程 Web 服务使用 NTLM 对用户进行授权。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:42:54.187

如果 Web 服务与 SharePoint 位于同一台服务器上，并且您使用 NTLM 访问 SharePoint，那么这可能只是简单的工作。如果 Web 服务与 SharePoint 位于不同的计算机上，那么您要么需要在两种环境中使用 Kerberos（可以将凭据委托给另一台服务器），要么在通信时必须在 Web 部件中提供用户的完整凭据与网络服务。当然，这意味着您必须知道用户的密码。MOSS 单点登录 (SSO) 功能仅可用于此目的。

# database - 究竟什么是外键？

> ID：655446
> 
> 赞同：13
> 
> 时间：2009-03-17T18:12:26.960
> 
> 标签：database, foreign-keys

行。所以我知道数据库中的主键是什么。如果您在数据库中有一个表，则主键是表中每一行唯一的单个值。例如：

```
id   | name    | whatever
-------------------------
1      Alice     ....
2      Bob       ....
45     Eve       ....
988    ....      .... 
```

所以我需要一个好的、简单的例子来解释外键到底是什么。因为我就是不明白：）

* * *

**编辑：**好的，这很容易，我想我把问题复杂化了。

所以最后一个问题，外键的唯一限制是它们是我所指的表中的有效主键值吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-17T18:16:26.387

外键是指向另一个表的主键的字段。

例子：

```
Table Name - Users

UserID    UserName    UserRoleID
1         JohnD       1
2         CourtneyC   1
3         Benjamin    2

Table Name - UserRoles

UserRoleID    Desc
1             Admin
2             Moderator 
```

您可以看到 Users.UserRoleID 是指向主键 UserRoles.UserRoleID 的外键

外键的使用使得在其他表上建立关系变得简单，允许您以一种很好的方式将多个表的数据链接在一起：

例子：

```
SELECT
    a.UserID, 
    a.UserName, 
    b.Desc as [UserRole]
FROM 
    Users a INNER JOIN 
        UserRoles b ON a.UserRoleID = b.UserRoleID 
```

输出将是：

```
UserID    UserName    User Role
1         JohnD       Admin
2         CourneyC    Admin
3         Benjamin    Moderator 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-17T18:18:03.233

假设您有另一个字段，即家乡：

```
id   | name    | city
-------------------------
1      Alice     San Francisco
2      Bob       New York
45     Eve       New York
988    Bill      San Francisco 
```

现在，在多行中重复相同的城市是没有意义的。这可能会导致您出现拼写错误、过度使用空间、难以提出结果等问题。所以你使用外键：

```
id   | name    | fk_city
-------------------------
1      Alice     1
2      Bob       2
45     Eve       2
988    Bill      1 
```

家乡城市表：

```
id   | name
-------------------------
1    | San Francisco
2    | New York 
```

希望它能让你更清楚。:-)

**更新**：关于你的最后一个问题：是的。:-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T18:18:33.293

外键是一个表中的一列，它应该唯一地标识另一个表中的某些内容。因此，这些值应对应于该其他表中的主键。

例如，如果您有一个学生正在上课的表格，那么每条记录都将包含一个学生 ID 和一个课程 ID。这些是学生表（每个学生 id 有一个记录）和课程表（每个课程 id 有一个记录）的外键。

参照完整性意味着您的所有外键实际上都对应于这些目标表中的主键。例如，您的注册表中的所有学生 ID 和课程 ID 都对应于真实的学生 ID 和课程 ID。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T18:20:05.007

```
id   | name    | whatever | countryid
-------------------------------------
1      Alice     ....       13
2      Bob       ....       42
45     Eve       ....       1
988    ....      ....       2

id   | countryid
----------------
1      Japan
2      Spain
13     Norway
42     Italy 
```

外键从 person 表（第一个）指向 country 表中的一行（第二个）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T18:17:55.307

在关系数据库中，通过让子表引用父表的 ID 来实现一对多关系。Child 表中的父 ID 称为外键，因为它引用另一个表的主键。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T18:19:32.013

外键是引用数据库中另一个表的字段。例如，假设您有 2 个表，`PERSON`并且`ADDRESS`. 在called中有一个字段，在`PERSON`called中`ID`有一个字段。您可以将其称为外键。这意味着您不能拥有一个与人无关的地址，因为该字段中的值必须存在于 table 中。`ADDRESS``PERSON_ID``PERSON_ID``PERSON.ID``ADDRESS.PERSON_ID``PERSON`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T18:21:39.027

使用您的表格示例，假设您有另一个表格：

```
cartid  |  id  | itemid
-----------------------
100        1       abc
101        1       cde 
```

在这个表中，主键是cartid，外键是id，它将链接到您的第一个表。用户 1 有两辆购物车，每辆购物车各有一件商品。

外键是您用来链接两个或多个具有相关信息的表的工具。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T18:36:41.127

外键是存储在您的表中的另一个表的主键。假设您有一张客户表和一张订单表。CustomerId 可能是 customer 表上的主键，OrderId 可能是 order 表上的主键。但是在订单表上，您需要了解此订单的客户，不是吗？因此，您需要将 CustomerId 存储在订单表中。在这种情况下，订单表上的 CustomerId 是一个外键。

我要指出的是，没有要求主键（因此是外键）是单列。当然，它更简单。但我曾在企业系统上工作过，其中主键长为 11 列，我相信还有比这更长的示例。也就是说，您需要知道 11 个不同列的值，然后才能唯一标识该行。

# visual-studio - Oracle 连接问题

> ID：655449
> 
> 赞同：1
> 
> 时间：2009-03-17T18:12:58.610
> 
> 标签：visual-studio, oracle, configuration

我最近在工作中得到了一台新机器，并从 XP 32 位转移到了 Vista 64 位。

无论我做什么，我都无法让我的 .Net 项目连接到 oracle 服务器……我可以使用 oracle sqldeveloper 连接到数据库，但不能从我的项目中连接……

我得到这个错误（这让我很困惑......）

“建立与服务器的连接时发生错误。连接到 SQL Server 时，此故障可能是由于在默认设置下 SQL Server 不允许远程连接。（提供者：SQL Network Interfaces，错误：26 - 定位服务器/指定实例时出错）”

我的第一个 WTF 是“SQL Server”部分，因为我的整个项目保持不变，而且我根本不使用 SQL Server（在这个项目中）......

我的连接字符串如下：

```
<add name="DefaultDb" providerName="System.Data.OracleClient" connectionString="Data Source=ora11dev;User Id=user;Password=pass;Integrated Security=no;"/> 
```

我已经为 .net 重新安装了 oracle 客户端和 oracle 连接工具，但我的问题仍然存在....

有人能指出我可能遗漏的东西吗？

编辑：

当我打开连接时，出现此错误：ORA-12154: TNS:could not resolve the connect identifier specified

而且我的 tnsnames.ora 正确...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T19:21:19.480

尝试将环境变量 TNS_ADMIN 设置为指向 tnsnames.ora 文件所在的目录。这将告诉您您的客户端是否在查找正确的 Ora Networking 文件时遇到问题。

编辑：Visual Studio 的路径名是什么？其中是否有括号，例如“C:\Program Files (x86)\Microsoft Visual Studio\”？如果是这样，则存在与此方案一起暴露的已知错误。修复是安装补丁，或在路径中没有括号的位置重新安装 Visual Studio。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T18:28:03.787

我会确保：

1.  您可以 tnsping 您的数据库实例
2.  您可以使用 SQL*Plus 登录

然后，我会确保您为所有 Oracle 工具（客户端和 ODAC）使用 64 位客户端。最后，如果您有多个 Oracle Home，请确保将最后一个安装的 Oracle Home 配置为允许连接。我相信 ODAC 使用最后安装的 Oracle Home 来获取其配置数据。

另外，我听说 11g 客户端连接到 10g 实例时出现问题，尽管我个人从未见过这样的问题。

我的猜测是 Visual Studio 中某处的配置设置正在做某事，或者某些防火墙规则不允许 Visual Studio 进行通信。但这些只是疯狂的猜测。

底线是如果 #1 和 #2 成功，那么它很可能在您的 Visual Studio 设置中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:58:36.813

我想我刚刚发现了我的问题......

看起来 oracle 在使用 oracle 的应用程序路径中的括号有问题...这解释了为什么 Visual Studio 不会访问 Oracle：“C:\Program Files **(x86)** \Visual Studio...”

[http://tiredblogger.wordpress.com/2007/11/21/oracle-data-access-components-odac-with-64-bit-development/](http://tiredblogger.wordpress.com/2007/11/21/oracle-data-access-components-odac-with-64-bit-development/)

[http://social.msdn.microsoft.com/forums/en-US/sqlintegrationservices/thread/ab662d63-6385-4f73-b27f-d526048f601f/](http://social.msdn.microsoft.com/forums/en-US/sqlintegrationservices/thread/ab662d63-6385-4f73-b27f-d526048f601f/)

# c++ - 在类中传递智能指针作为参数：scoped_ptr 还是 shared_ptr？

> ID：655450
> 
> 赞同：5
> 
> 时间：2009-03-17T18:13:00.157
> 
> 标签：c++, class, boost, smart-pointers

我有一个类，它在一个公共方法中创建一个对象。该对象是私有的，对类的用户不可见。然后，此方法调用同一类中的其他**私有**方法，并将创建的对象作为参数传递：

```
class Foo {
   ...
};

class A {
   private:
      typedef scoped_ptr<Foo> FooPtr;

      void privateMethod1(FooPtr fooObj);

   public:
      void showSomethingOnTheScreen() {
          FooPtr fooObj(new Foo);
          privateMethod1(fooObj);
      };
}; 
```

我相信在这种情况下正确的智能指针将是一个 scoped_ptr，但是，我不能这样做，因为如果以这种方式使用 scoped_ptr 会使类不可复制，所以我应该这样制作方法：

```
void privateMethod1(FooPtr& fooObj); 
```

privateMethod1 不存储对象，也不保留对它的引用。只需从*Foo*类中检索数据。

正确的方法可能是根本不使用智能指针并在堆栈中分配对象，但这是不可能的，因为它使用的库不允许堆栈上的对象，它们必须在堆上。

毕竟，我仍然对 scoped_ptr 的真正用法感到困惑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:20:28.563

另一种可能性是将对象创建为 static_ptr 以便于内存管理，但只需将原始指针传递给其他私有方法：

```
void privateMethod1(Foo *fooObj);

void showSomethingOnTheScreen() {
  scoped_ptr<Foo> fooObj(new Foo);
  privateMethod1(fooObj.get());
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T18:20:51.977

我会在 showSomethingOnTheScreen 中使用 scoped_ptr，但将原始指针（或引用）传递给 privateMethod1，例如

scoped_ptr<Foo> fooObj(new Foo);
privateMethod1(fooObj.get());

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T18:16:46.747

在这里使用简单的 std::auto_ptr 因为你不能在堆栈上创建对象。对于您的私有函数来说，最好只接受原始指针。

真正的用法是您不必捕获所有可能的异常并进行手动删除。

事实上，如果您的对象没有修改对象并且您的 API 返回对象，那么您最好使用

```
void privateMethod1(const Foo& fooObj); 
```

并将对象作为

```
privateMethod1(*fooObj.get()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T18:18:44.760

我对“它使用的库不允许堆栈上的对象，它们必须在堆上”的评论持怀疑态度。

为什么？这通常意味着必须以某种特殊方式释放它们——所以这些解决方案可能都不起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T18:29:51.877

在这种情况下，您只需更换分配机制。
在堆上创建对象，但将对象作为引用传递给私有方法。

```
class A {
   private:
      void privateMethod1(Foo& fooObj);

   public:
      void showSomethingOnTheScreen() {
          scoped_ptr<Foo> fooObj(new Foo);
          privateMethod1(*(fooObj.get()));
      };
}; 
```

# sharepoint - 以编程方式将 InfoPath 表单发布为站点 ContentType（不是中央管理员）

> ID：655465
> 
> 赞同：3
> 
> 时间：2009-03-17T18:16:49.630
> 
> 标签：sharepoint, infopath

有谁知道如何以编程方式（脚本或对象模型）将 InfoPath 表单 (2007) 部署为站点内容类型？我不希望将表单发布到 Central Admin 和 FormServerTemplates，而是希望由 Web 范围的功能创建的表单库。目的是能够通过脚本或代码发布表单，以便在 dev/stage/prod 环境中部署和测试表单。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T14:18:00.333

好吧，我不得不减少诱饵。似乎这两个链接现在提供了一个可行的解决方案。

Sahil Malik 的文章[在这里](http://blah.winsmarts.com/2008-8-Deploying_InfoPath_2007_Forms_to_Forms_Server_-and-ndash_Properly.aspx)提供了足够的信息来部署表单，并且数据连接很简单，只需将模块添加到功能的元素文件中即可。可以在[这里找到一些提示](http://geekswithblogs.net/DanielC/archive/2009/01/14/deploy-data-connection-files-.udcx-to-sharepoint-data-connection-library.aspx)

然而，似乎没有办法将表单部署到站点功能以外的任何地方。在深入了解 Sahil 提到的使用 Reflector 的程序集之后，会检查代码以确保该功能是站点范围的。啊。如果有人能解释为什么会这样，也许是另一种选择，我将不胜感激！希望这对其他人有帮助。

# flash - 在一瞬间杀死旧物体？

> ID：655467
> 
> 赞同：1
> 
> 时间：2009-03-17T18:17:23.203
> 
> 标签：flash, actionscript, actionscript-2

嗨，这里是第一个计时器。

我正在使用 tweenlite 库构建一个 Flash 动画。这非常简单，这就是为什么这会如此恶化。它基本上是一个带有 5 帧交叉淡入淡出的幻灯片。当调用下一帧的按钮淡出时，我想禁用它对它的任何操作。目前它会淡出，但是当您将其滚动时，您会看到按钮光标，并且过度状态会使不透明度恢复。

我真的是 Flash 中的菜鸟，所以我相信这非常简单。

谢谢，瑞恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T18:27:42.477

无论如何，即使您有一个`new`操作员来创建一个，也没有直接删除 AS 中的对象的方法。当对象没有**强**引用时，所有对象都会被垃圾回收。以下是您可以做的两件事：

*   将事件处理程序添加到按钮对象或其他任何内容时，将它们标记为弱或在完成时将事件处理程序设置为 NULL

*   尽管 AS 中没有显式删除，但您可以使用`var = null`语法将对象设置为 null，以使垃圾收集器将其标记为已准备好进行清理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T01:13:45.430

**如果您真的在使用 AS2（？）** - 据我所知 - 您应该使用`MovieClip`实例而不是`Button`. 按钮将始终保持手形光标，而 MovieClips 可以根据是否附加任何鼠标处理程序来交换行为。

每当您想停用鼠标操作时，您只需删除您之前定义的处理程序（例如`myButton.onRelease = null; myButton.onMouseOver = null; ...`）。

**如果您实际使用的是 AS3**，则应首先删除所有相关的事件侦听器（例如`myButton.removeEventListener(MouseEvent.CLICK, clickHandler);`）

然后将其设置`buttonMode`为 false 以避免出现手形光标，尽管“点击功能”已被删除 ( `myButton.buttonMode = false;`)。

希望这是有道理的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-30T23:29:55.623

我看到的大多数幻灯片都是可重新启动的，或者会自行循环播放。我不相信您想要的是删除功能，而只是删除特定时间的控件。在 MOUSE_DOWN 或 CLICK 时，您可以通过使用轻松禁用按钮

```
var slidesContainer:Sprite = new Sprite();

var slideButton:Sprite = new Sprite();
slideButton.graphics.beginFill(0x000000);
slideButton.drawRect(0,0,100,30);
slideButton.endFill();
addChild(slidebutton);

slideButton.addEventListener(MouseEvent.MOUSE_DOWN, onButtonDown);

var slide01:MovieClip = new Slide();
slidesContainer.addChild(slide01);
var slide02:MovieClip = new Slide();
slidesContainer.addChild(slide02);

//Store references to the newly created movieclips in an array.
var arrayOfSlides:Array = [slide01, slide02];
var currentSlide:int = 0;

function onBtnDown(e:MouseEvent):void
{
     TweenLite.to(arrayOfSlides[currentSlide], 1, {alpha: 0});
     e.target.mouseEnabled = false;  //The button that was pressed down is the target

     currentSlide++;
} 
```

这样我们只是使对象不可见并禁用它的鼠标功能。

在不需要时为垃圾收集准备对象是一个好主意，但重要的是要知道你想用你的工作做什么。如果您希望不再使用该对象，请通过设置为 null 来删除任何引用。如果您导出到 flash player 10，则 unloadAndStop 方法可以极大地帮助完全删除项目并为 GC 做准备。

如果您打算重用某些东西，例如在幻灯片放映在一定时间后重新启动等，您只需将按钮的可见性和 mouseEnabled 属性设置回 true。

# silverlight - PRISM2 命令和 silverlight

> ID：655482
> 
> 赞同：0
> 
> 时间：2009-03-17T18:19:45.850
> 
> 标签：silverlight, prism

在 Silverlight 中使用命令功能时，我注意到一个奇怪的行为：

添加命令时：Click.Command 和 CommandParameter 属性，IsEnabled 属性停止运行：

```
<Button Content="Delete" 
    x:Name="Btn_Delete" 
    Margin="0,0,8,0" 
    MinWidth="75" 
    commands:Click.Command="{Binding DeleteCommand}" 
    commands:Click.CommandParameter="{Binding SelectedDepartment}" 
    IsEnabled="false" /> 
```

如果我删除命令：属性 IsEnabled 功能正确。如果 IsEnabled 也绑定到我的视图模型上的值，则此行为是相同的。

这是一个错误吗？任何人都知道任何解决方法？

谢谢，马克

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T11:57:48.357

我现在通过在按钮周围添加内容控件来实现一种解决方法：

```
<ContentControl IsEnabled="false">
<Button Content="Delete" 
    x:Name="Btn_Delete" 
    Margin="0,0,8,0" 
    MinWidth="75" 
    commands:Click.Command="{Binding DeleteCommand}" 
    commands:Click.CommandParameter="{Binding SelectedDepartment}" 
     />
</ContentControl> 
```

尽管如此，仍然有兴趣找到任何“适当的”解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T12:22:49.280

这也是正确的答案： [http ://compositewpf.codeplex.com/Thread/View.aspx?ThreadId=50456&ANCHOR&ProjectName=CompositeWPF](http://compositewpf.codeplex.com/Thread/View.aspx?ThreadId=50456&ANCHOR&ProjectName=CompositeWPF)

# c# - 如何判断一个类是否可以序列化？

> ID：655488
> 
> 赞同：2
> 
> 时间：2009-03-17T18:21:19.090
> 
> 标签：c#, serialization

我正在遍历会话键并将条目及其值添加到哈希表中，然后我将对其进行序列化。我遇到的问题是 Session 上有一个不可序列化的对象，无论如何都不应该对其进行序列化。我环顾四周，很多内置类型都没有实现 ISerializable 属性，因此对此进行测试不起作用：

```
if (val is ISerializable)
{
    ...
} 
```

那么，我该如何测试呢？这有意义吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T18:24:04.340

只有一种有保证的方法可以确定对象是否可序列化。序列化它，看看操作是否成功。

我知道这似乎有点矫枉过正，但是可以破坏序列化的方式有很多。您可以检查元数据中的两项，以查看一个类型是否声明可序列化（ISerializable 和 [Serializable]），但这只是一个声明。它可以并且以许多不同的方式被破坏。

问题在于，在.Net 世界中，声明能够被序列化和实际序列化的行为是两个独立的不同行为。完全有可能（并且合法）做一个但不能做另一个。以此为例

```
[Serializable]
public class Foo {
  public Object Field1;
} 
```

这个类声称是可序列化的，而且很可能是可序列化的。这完全取决于实际存储在 Field1 中的值。再多的对类型的元数据检查都不会告诉你它是否真的可以被序列化。你所能做的就是尝试看看它是否成功。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:25:15.213

您可以使用 Type 类的 IsSerializable 属性。

```
if(val.GetType().IsSerializable) 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-17T18:23:01.567

检查 CRL 将使用的相同内容：`[Serializable]`属性。

# nhibernate - 使用 Fluent NHibernate 进行继承映射

> ID：655494
> 
> 赞同：26
> 
> 时间：2009-03-17T18:22:39.227
> 
> 标签：nhibernate, mapping, types, fluent, polymorphism

鉴于以下场景，我想使用 Fluent NHibernate 将类型层次结构映射到数据库模式。

我正在使用 NHibernate 2.0

* * *

**类型层次结构**

```
public abstract class Item
{
    public virtual int ItemId { get; set; }
    public virtual string ItemType { get; set; }
    public virtual string FieldA { get; set; }
}

public abstract class SubItem : Item
{
    public virtual string FieldB { get; set; } 
}

public class ConcreteItemX : SubItem
{
    public virtual string FieldC { get; set; } 
}

public class ConcreteItemY : Item
{
    public virtual string FieldD { get; set; }
} 
```

[看图片](http://www.freeimagehosting.net/uploads/3e9efc1fee.png)

`Item`和`SubItem`类是抽象的。

* * *

**数据库模式**

```
+------------+ +----------------+ +----------------+
| 项目 | | 混凝土项目X | | 具体项目Y |
+==========+ +================+ +===============+
| 项目 ID | | 项目 ID | | 项目 ID |
| 项目类型 | | 场C | | 字段D |
| 字段A | +---------------+ +----------------+
| 字段B |
+----------+

```

[看图片](http://www.freeimagehosting.net/uploads/10644fe741.png)

该`ItemType`字段确定具体类型。

表中的每条记录在`ConcreteItemX`表中都有一条对应的记录`Item`；对于`ConcreteItemY`桌子也是如此。

`FieldB`如果项目类型为 ，则始终为空`ConcreteItemY`。

* * *

**映射（到目前为止）**

```
public class ItemMap : ClassMap<Item>
{
    public ItemMap()
    {
        WithTable("Item");
        Id(x => x.ItemId, "ItemId");
        Map(x => x.FieldA, "FieldA");

        JoinedSubClass<ConcreteItemX>("ItemId", MapConcreteItemX);
        JoinedSubClass<ConcreteItemY>("ItemId", MapConcreteItemY);
    }

    private static void MapConcreteItemX(JoinedSubClassPart<ConcreteItemX> part)
    {
        part.WithTableName("ConcreteItemX");
        part.Map(x => x.FieldC, "FieldC");
    }

    private static void MapConcreteItemY(JoinedSubClassPart<ConcreteItemY> part)
    {
        part.WithTableName("ConcreteItemX");
        part.Map(x => x.FieldD, "FieldD");
    }
} 
```

`FieldB`未映射。

* * *

**问题**

如何使用 Fluent NHibernate 映射类的`FieldB`属性？`SubItem`

有什么方法可以利用`DiscriminateSubClassesOnColumn`该`ItemType`字段吗？

* * *

**附录**

我能够使用 hbm.xml 文件达到预期的效果：

```
<class name="Item" table="Item">

  <id name="ItemId" type="Int32" column="ItemId">
    <generator class="native"/>
  </id>

  <discriminator column="ItemType" type="string"/>

  <property name="FieldA" column="FieldA"/>

  <subclass name="ConcreteItemX" discriminator-value="ConcreteItemX">
    <!-- Note the FieldB mapping here -->
    <property name="FieldB" column="FieldB"/>
    <join table="ConcreteItemX">
      <key column="ItemId"/>
      <property name="FieldC" column="FieldC"/>
    </join>
  </subclass>

  <subclass name="ConcreteItemY" discriminator-value="ConcreteItemY">
    <join table="ConcreteItemY">
      <key column="ItemId"/>
      <property name="FieldD" column="FieldD"/>
    </join>
  </subclass>

</class> 
```

如何使用 Fluent NHibernate 完成上述映射？

是否可以使用 Fluent NHibernate 将每类层次结构表与每子类表混合？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-11-24T18:13:44.913

我知道这真的很老了，但现在设置 fluent 以生成您最初想要的精确映射非常简单。由于我在寻找答案时遇到了这篇文章，所以我想我会发布它。

您只需为基类创建 ClassMap 而不引用您的子类：

```
public class ItemMap : ClassMap<Item>
{
    public ItemMap()
    {
        this.Table("Item");
        this.DiscriminateSubClassesOnColumn("ItemType");
        this.Id(x => x.ItemId, "ItemId");
        this.Map(x => x.FieldA, "FieldA");
    }
} 
```

然后像这样映射你的抽象子类：

```
public class SubItemMap: SubclassMap<SubItemMap>
{
    public SubItemMap()
    {
        this.Map(x => x.FieldB);
    }
} 
```

然后像这样映射您的具体子类：

```
public class ConcreteItemXMap : SubclassMap<ConcreteItemX>
{
    public ConcretItemXMap()
    {
        this.Join("ConcreteItemX", x =>
        {
            x.KeyColumn("ItemID");
            x.Map("FieldC")
        });
    }
} 
```

希望这可以帮助其他人使用流利的方式寻找这种类型的映射。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-13T20:42:47.323

这就是我解决继承问题的方法：

```
public static class DataObjectBaseExtension
{
    public static void DefaultMap<T>(this ClassMap<T> DDL) where T : IUserAuditable 
    {
        DDL.Map(p => p.AddedUser).Column("AddedUser");
        DDL.Map(p => p.UpdatedUser).Column("UpdatedUser");
    }
} 
```

然后，您可以将其添加到您的超类映射构造函数中：

```
internal class PatientMap : ClassMap<Patient>
{
    public PatientMap()
    {
        Id(p => p.GUID).Column("GUID");
        Map(p => p.LocalIdentifier).Not.Nullable();
        Map(p => p.DateOfBirth).Not.Nullable();
        References(p => p.Sex).Column("RVSexGUID");
        References(p => p.Ethnicity).Column("RVEthnicityGUID");

        this.DefaultMap();
    }

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T15:00:17.890

好吧，我不确定它是否完全正确，但它可能会起作用......如果有人可以更干净地做到这一点，我很乐意看到它（说真的，我会的；这是一个有趣的问题）。

使用您提供的确切类定义，以下是映射：

```
public class ItemMap : ClassMap<Item>
{
    public ItemMap()
    {
        Id(x => x.ItemId);
        Map(x => x.ItemType);
        Map(x => x.FieldA);

        AddPart(new ConcreteItemYMap());
    }
}

public class SubItemMap : ClassMap<SubItem>
{
    public SubItemMap()
    {
        WithTable("Item");

        // Get the base map and "inherit" the mapping parts
        ItemMap baseMap = new ItemMap();
        foreach (IMappingPart part in baseMap.Parts)
        {
            // Skip any sub class parts... yes this is ugly
            // Side note to anyone reading this that might know:
            // Can you use GetType().IsSubClassOf($GenericClass$)
            // without actually specifying the generic argument such
            // that it will return true for all subclasses, regardless
            // of the generic type?
            if (part.GetType().BaseType.Name == "JoinedSubClassPart`1")
                continue;
            AddPart(part);
        }
        Map(x => x.FieldB);
        AddPart(new ConcreteItemXMap());
    }
}

public class ConcreteItemXMap : JoinedSubClassPart<ConcreteItemX>
{
    public ConcreteItemXMap()
        : base("ItemId")
    {
        WithTableName("ConcreteItemX");
        Map(x => x.FieldC);
    }
}

public class ConcreteItemYMap : JoinedSubClassPart<ConcreteItemY>
{
    public ConcreteItemYMap()
        : base("ItemId")
    {
        WithTableName("ConcreteItemY");
        Map(x => x.FieldD);
    }
} 
```

这些映射会生成两个类似这样的 hbm.xml 文件（为清楚起见，删除了一些无关数据）：

```
 <class name="Item" table="`Item`">
    <id name="ItemId" column="ItemId" type="Int32">
      <generator class="identity" />
    </id>
    <property name="FieldA" type="String">
      <column name="FieldA" />
    </property>
    <property name="ItemType" type="String">
      <column name="ItemType" />
    </property>
    <joined-subclass name="ConcreteItemY" table="ConcreteItemY">
      <key column="ItemId" />
      <property name="FieldD">
        <column name="FieldD" />
      </property>
    </joined-subclass>
  </class>

  <class name="SubItem" table="Item">
    <id name="ItemId" column="ItemId" type="Int32">
      <generator class="identity" />
    </id>
    <property name="FieldB" type="String">
      <column name="FieldB" />
    </property>
    <property name="ItemType" type="String">
      <column name="ItemType" />
    </property>
    <property name="FieldA" type="String">
      <column name="FieldA" />
    </property>
    <joined-subclass name="ConcreteItemX" table="ConcreteItemX">
      <key column="ItemId" />
      <property name="FieldC">
        <column name="FieldC" />
      </property>
    </joined-subclass>
  </class> 
```

它很丑，但看起来它可能会生成一个可用的映射文件，而且它很流畅！:/ 你也许可以进一步调整这个想法，以获得你想要的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T12:13:22.547

这行代码：`if (part.GetType().BaseType.Name == "JoinedSubClassPart1")` 可以改写如下：

```
part.GetType().BaseType.IsGenericType && part.GetType().BaseType.GetGenericTypeDefinition() == typeof(JoinedSubClassPart<>) 
```

# iis - 如何以编程方式在 Windows7 上的 IIS7 中创建 FTP 站点？

> ID：655497
> 
> 赞同：3
> 
> 时间：2009-03-17T18:23:42.953
> 
> 标签：iis, iis-7, windows-7, ftp

我希望使用批处理文件执行此步骤：“通过编辑 IIS 7.0 配置文件创建新的 FTP 站点”，并且想知道是否有人已经这样做了？

[http://learn.iis.net/page.aspx/301/creating-a-new-ftp-site/](http://learn.iis.net/page.aspx/301/creating-a-new-ftp-site/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T02:40:25.903

尝试这个。您需要引用 COM 组件“AppHostAdminLibrary”

```
using AppHostAdminLibrary;

...

public void AddFtp7Site(String siteName, String siteId, String siteRoot) {
    String configPath;
    String configSectionName;
    var fNewSite = false;
    var fNewApplication = false;
    var fNewVDir = false;
    //
    // First setup the sites section
    //
    configPath = "MACHINE/WEBROOT/APPHOST";
    configSectionName = "system.applicationHost/sites";

    var adminManager = new AppHostAdminLibrary.AppHostWritableAdminManager();
    adminManager.CommitPath = configPath;

    try {
        var sitesElement = adminManager.GetAdminSection(configSectionName, configPath);
        IAppHostElement newSiteElement = null;

        //
        // check if site already exists
        //
        for (var i = 0; i < sitesElement.Collection.Count; i++) {
            var siteElement = sitesElement.Collection[i];
            if (siteElement.Properties["name"].Value.Equals(siteName) &&
                 siteElement.Properties["id"].Value.Equals(siteId)) {
                newSiteElement = siteElement;
                break;
            }
        }

        if (newSiteElement == null) {
            //
            // Site doesn't exist yet. Add new site node
            //

            newSiteElement = sitesElement.Collection.CreateNewElement("");
            newSiteElement.Properties["id"].Value = siteId;
            newSiteElement.Properties["name"].Value = siteName;
            fNewSite = true;
        }

        // setup bindings for the new site

        var ftpBindingString = "*:21:";

        var Bindings = newSiteElement.GetElementByName("bindings");
        var BindingElement = Bindings.Collection.CreateNewElement("");
        BindingElement.Properties["protocol"].Value = "ftp";
        BindingElement.Properties["bindingInformation"].Value = ftpBindingString;

        try {
            Bindings.Collection.AddElement(BindingElement, 0);
        }
        catch (Exception ex) {
            if (ex.Message != "") // ERROR_ALREADY_EXISTS ?
            {
                throw;
            }
        }

        IAppHostElement newApplication = null;
        //
        // check if root application already exists
        //
        for (var i = 0; i < newSiteElement.Collection.Count; i++) {
            var applicationElement = newSiteElement.Collection[i];

            if (applicationElement.Properties["path"].Value.Equals("/")) {
                newApplication = applicationElement;
                break;
            }
        }

        if (newApplication == null) {
            newApplication = newSiteElement.Collection.CreateNewElement("application");
            newApplication.Properties["path"].Value = "/";
            fNewApplication = true;
        }

        IAppHostElement newVirtualDirectory = null;
        //
        // search for the root vdir
        //
        for (var i = 0; i < newApplication.Collection.Count; i++) {
            var vdirElement = newApplication.Collection[i];
            if (vdirElement.Properties["path"].Value.Equals("/")) {
                newVirtualDirectory = vdirElement;
                break;
            }
        }
        if (newVirtualDirectory == null) {
            newVirtualDirectory = newApplication.Collection.CreateNewElement("");
            newVirtualDirectory.Properties["path"].Value = "/";
            fNewVDir = true;
        }
        newVirtualDirectory.Properties["physicalPath"].Value = siteRoot;
        if (fNewVDir) {
            newApplication.Collection.AddElement(newVirtualDirectory, 0);
        }
        if (fNewApplication) {
            newSiteElement.Collection.AddElement(newApplication, 0);
        }

        var ftpSiteSettings = newSiteElement.GetElementByName("ftpServer").GetElementByName("security").GetElementByName("authentication");

        Console.WriteLine("Enable anonymous authentication");

        var anonAuthSettings = ftpSiteSettings.GetElementByName("anonymousAuthentication");
        anonAuthSettings.Properties["enabled"].Value = "true";

        Console.WriteLine("Disable basic authentication");
        var basicAuthSettings = ftpSiteSettings.GetElementByName("basicAuthentication");
        basicAuthSettings.Properties["enabled"].Value = "false";

        BindingElement.Properties["bindingInformation"].Value = "*:21:";
        //
        // Time to add new site element and commit changes
        //
        if (fNewSite) {
            sitesElement.Collection.AddElement(newSiteElement, 0);
        }
        adminManager.CommitChanges();
    }
    catch (Exception ex) {
        Console.WriteLine("Error occured in AddDefaultFtpSite: " + ex.Message);
    }

    //
    // Add <authorization> section to allow everyone Read
    //
    Console.WriteLine("Enable everyone Read access");
    try {
        configPath = "MACHINE/WEBROOT/APPHOST/" + siteName;
        configSectionName = "system.ftpServer/security/authorization";

        var azSection = adminManager.GetAdminSection(configSectionName, configPath);

        azSection.Collection.Clear();

        var newAzElement = azSection.Collection.CreateNewElement("");
        newAzElement.Properties["accessType"].Value = "Allow";
        newAzElement.Properties["users"].Value = "*";
        newAzElement.Properties["permissions"].Value = "Read";

        azSection.Collection.AddElement(newAzElement, 0);
        adminManager.CommitChanges();
    }
    catch (Exception ex) {
        Console.WriteLine("Error occured while adding authorization section: " + ex.Message);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:34:36.300

这有帮助吗？： http: [//blogs.iis.net/jaroslad/archive/2007/06/13/how-to-programatically-create-an-ftp7-site.aspx](http://blogs.iis.net/jaroslad/archive/2007/06/13/how-to-programatically-create-an-ftp7-site.aspx)

# yui - yui，表单提交和数据表

> ID：655506
> 
> 赞同：3
> 
> 时间：2009-03-17T18:25:58.237
> 
> 标签：yui, yui-datatable, yui-datasource

我是 Java 程序员，但不是 JavaScript 程序员。我刚刚发现了 YUI，并正在尝试开始使用它。我想尝试做的是在页面顶部有查询表单，用户按下提交，结果显示在查询表单下方的 YUI 数据表中。

当然，通常情况下，在 HTML 表单上，用户按下提交，请求被发送到服务器，我使用 Struts 处理它，然后将请求转发到 JSP，HTML 被发送回浏览器。这就是我每天所做的。对于 Ajax，我理解它的不同之处在于我应该返回 XML。不是问题。很容易做到。

我遇到的问题涉及 YUI 方面的问题。当按下提交按钮时，会发生什么？不是正常的表单提交，对吧？我是否实现了一个 onSubmit() JavaScript 函数，然后触发一些 YUI DataSource 去获取数据？请求参数如何传递？希望我不必手动构建请求。我猜我使用的是 YAHOO.util.XHRDataSource，这就是 DataTable 的 DataSource。

我已经设法让 YUI DataTable 使用 HTML 表格元素工作。现在我只需要将其切换为真实数据。奇怪的是，YUI 文档在这里似乎有点弱，除非我遗漏了什么。也许这只是 YUI 文档未涵盖的基本 Ajax？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:44:39.487

首先，在使用 Ajax 时，您不需要从服务器返回 XML，您可以返回纯文本、XML、JSON 字符串，以及您想要的任何形式的文本数据。此处提供了一个使用 JSON 数据填充 Datatable 的示例：

[http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html](http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html)

此处提供了如何使用 Ajax 和 YUI 发送发布请求的示例。

[http://developer.yahoo.com/yui/examples/connection/post.html](http://developer.yahoo.com/yui/examples/connection/post.html)

这应该让你开始，现在只需将它们链接在一起。

要连接到服务器，您可以使用 Yahoo.util.Connect.asyncRequest 方法，该方法接受以下参数：

```
static object asyncRequest ( method , uri , callback , postData ); 
```

在此处查看示例，此示例使用“GET”，因此您可以使用“GET”或“POST”，只需确保传入参数

[http://developer.yahoo.com/yui/examples/json/json_connect.html](http://developer.yahoo.com/yui/examples/json/json_connect.html)

一旦您的函数在您的“onSuccess”上返回，请执行以下操作以将响应文本解析为 JSON

```
try {
    jsonData = YAHOO.lang.JSON.parse(o.responseText);
}
 catch (x) {
    alert("JSON Parse failed!");
    return;
} 
```

“jsonData”对象现在包含您的数据，所以现在您可以按照以下示例进行操作：

[http://developer.yahoo.com/yui/examples/datatable/dt_basic.html](http://developer.yahoo.com/yui/examples/datatable/dt_basic.html)

它向您展示了如何使用保存数据源的本地对象初始化数据表。基本上是这样的

```
var myColumnDefs = [
        {key:"Column1Data", label:"Column1 Header" sortable:true, resizeable:true},
        {key:"Column2Data", label:"Column2 Header" sortable:true, resizeable:true}
        ];

var myDataSource = new YAHOO.util.DataSource(jsonData);
        myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
        myDataSource.responseSchema = {
            fields: ["Column1Data","Column2Data"]
        };

        var myDataTable = new YAHOO.widget.DataTable("basic",
                myColumnDefs, myDataSource, {caption:"DataTable Caption"}); 
```

为此，您必须在 HTML 代码中有一个 id 为“basic”的“div”容器，注意这与 DataTable 上的第一个参数匹配

希望这可以帮助

# apache2 - Apache：SSI 内的 SSI

> ID：655513
> 
> 赞同：2
> 
> 时间：2009-03-17T18:28:53.957
> 
> 标签：apache2, include, server-side-includes, ssi

有没有办法可以在包含文件中包含包含文件？（快说五倍！）

例如：

在**index.html**里面：

```
<!--#include virtual="/include-1.shtml"--> 
```

在**include1.shtml**里面：

```
<!--#include virtual="/include-2.shtml"--> 
```

所以树看起来像这样：**index.html <-- include_1.shtml <-- include_2.shtml**

照原样，这不适用于我的 Apache。第一个包含工作正常，但嵌套包含的内容不显示。

因为它是相关的，我在 Apache 2 上使用 XBitHack，并且我已经仔细检查了这两个文件是否可以由网络用户执行。

帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-12-04T01:37:04.217

我知道这个问题已有四年多的历史了，但是为了像我一样通过 StackOverflow**惊人**的搜索引擎汁找到它的人的利益，这就是我如何使它工作的。

在 Apache2 下，[你需要知道**这一点**](http://www.zytrax.com/tech/web/ssi.htm#include)。

相关文字：

> 此命令将包含文件的文本插入到已解析文件中。SSI 文件可能是嵌套的，即包含的文件可能包含额外的 SSI 语句***（但在这种情况下，无论 XBitHack 的设置如何，都必须具有 .shtml 后缀）***。

（强调我的）对我来说，解决方案在于取消注释默认的两行`httpd.conf`：

```
AddType text/html .shtml
AddOutputFilter INCLUDES .shtml 
```

...并将第一级包含文件的文件扩展名更改为 .shtml：

```
索引.html
  └─┬─include1.shtml
    └──── include2.html
```

繁荣！嵌套 SSI 就像一个冠军。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:39:11.573

确保 Apache 实际上正在尝试处理 *.shtml 文件。试着放

```
<!--#echo var="DATE_LOCAL" --> 
```

在 *.shtml 文件中查看是否获得预期结果。您在 *.html 文件中得到相同的结果吗？如果您在两者中都没有看到日期，则说明您的配置已关闭。

# unit-testing - Ada 有什么好的单元测试框架吗？

> ID：655514
> 
> 赞同：12
> 
> 时间：2009-03-17T18:29:12.067
> 
> 标签：unit-testing, ada

我来自 C++ 背景，但我目前在 Ada 工作。在 C++ 世界中，我在编写每个类时都会对其进行单元测试……这似乎不是我们工作中的代码库的时尚。

我想开始为我创建的 Ada 包实施单元测试，是否有任何好的框架可以做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-24T17:46:45.293

There are two open source JUnit-like unit testing frameworks around, [AUnit](http://libre.adacore.com/tools/aunit/) and [Ahven](http://ahven.sourceforge.net/).

AUnit is good if you use Ada 2005 and GNAT compiler family. Downside is that you cannot use it in Ada 95 projects. Ahven fills the gap and concentrates on being compatible with various Ada 95 compilers (like older GNAT compilers, Janus/Ada, ObjectAda).

(PS. I am author of Ahven.)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T21:45:17.577

tkoskine 说 AUnit 不支持 Ada95；不知道那是从哪里来的，在过去的 8 年里我一直在使用 AUnit 做一个仍然是 Ada95 的项目！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T18:32:50.263

查看[AUnit](https://libre.adacore.com/aunit/main.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T20:09:53.910

[VectorCAST/Ada](http://www.vectorcast.com/software-testing-products/ada-unit-testing.php)已经存在了一段时间。

# jquery - jQuery 事件链 - 从堆栈到队列

> ID：655517
> 
> 赞同：0
> 
> 时间：2009-03-17T18:29:50.380
> 
> 标签：jquery, events

将按“第一，第二”的顺序执行。我需要最后一次执行。

```
function first(){ alert('first') }
function second(){ alert('second') }
$('input').click(first).click(second); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T16:00:45.663

简短的回答：你不能这样做。

尽管在 praxis 浏览器中按分配的顺序运行事件，但您不能相信它们总是会这样做。另请注意，取消取决于您使用的事件模型。在级别 1 (onclick="...") 中，取消事件气泡会立即生效，并且不再运行任何处理程序。这不适用于 jQuery 使用的[Level 2](http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-flow) (Element.addEventListener)，其中所有注册在元素上的处理程序将始终在传播停止之前触发。

在我看来，如果您编写的东西依赖于多个处理函数来顺序运行但无法控制分配的顺序，那么您需要重新考虑您的方法。

但是 - 如果您必须这样做 - 您可以取消绑定并重新分配您需要的元素上的所有事件，以获得所需的序列。您可以获取给定元素上的事件列表，`$.data( someelement, 'events' )`然后使用推到前面的首选事件取消/重新分配它们。

# nhibernate - NHibernate fetch="join" 映射属性似乎不起作用

> ID：655520
> 
> 赞同：4
> 
> 时间：2009-03-17T18:29:56.777
> 
> 标签：nhibernate, nhibernate-mapping

用 NH 映射字典。声明如下：

```
<hibernate-mapping ...
    <map 
        name="CostsByRole" 
        table="JobAccountingSnapshotCosts"
        lazy="false" 
        fetch="join" 
        access="nosetter.camelcase-underscore">
            <key column="SnapshotId" />
            <index column="RoleCode" type="String" />
            <element column="Amount" type="Decimal" />
    </map>
</hibernate-mapping> 
```

我期望生成一个 SQL 查询，但我得到了两个：一个用于实际对象的选择，然后是一个用于字典内容的选择。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-01-20T21:27:59.750

HQL 查询不考虑映射中为 fetch 设置的值。您需要在每个 HQL 查询中专门指定它们。据说是设计使然。提取属性值仅由条件查询和加载/获取使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:20:11.933

假设这不是提交时的拼写错误，那么问题可能出`join="fetch"`在您的映射中。它应该是`fetch="join"`并且由于默认为`fetch`“选择”，这将产生您的顺序选择问题。

# mysql - 我的应用程序无法连接到 mysql，你能建议测试的东西吗？

> ID：655522
> 
> 赞同：2
> 
> 时间：2009-03-17T18:30:43.000
> 
> 标签：mysql, macos, localhost

我在mac服务器上。从我的主目录，我可以在命令行上访问 mysql。但是我安装的应用程序（我尝试了 phpMyAdmin，然后是 Wordpress）无法连接到 mysql@localhost。

解决问题的建议？

另外，我怎么知道mysql在哪个端口上运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T18:36:33.563

尝试将 127.0.0.1:3306 指定为主机，看看是否可行...

*从评论编辑：*

> 用于**`netstat -a`**检查 MySQL 正在侦听的端口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:41:42.147

检查以确保您已安装 mysql 扩展。

更多信息：[http ://us2.php.net/mysql](http://us2.php.net/mysql)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T18:46:28.703

确保在向用户授予权限时明确列出了 localhost。例如，如果您有一个名为 blog 的数据库，该数据库由名为 wordpress 的用户访问，则需要使用以下命令创建用户：

```
grant all on blog.* to 'wordpress'@'localhost' identified by 'blahblah'; 
```

我相信 mysql 命令行实用程序使用 Unix 文件套接字进行连接，这绕过了任何主机名或 DNS 限制。

# python - 如何配置 IPython 以在 Windows 上使用 gvim？

> ID：655530
> 
> 赞同：8
> 
> 时间：2009-03-17T18:33:24.210
> 
> 标签：python, windows, vim, ipython

这看起来确实像是我应该能够在 Google 上找到的东西，但由于某种原因，我无法确定它的正面或反面。有 EDITOR 环境变量、ipy_user_conf.py 文件、ipythonrc 文件、在服务器模式下运行 gvim 的一些奇怪的事情以及一堆我无法理解的其他东西（可能是因为缺乏睡眠）。

是否有我可以遵循的指南，或者也许有人可以概述我需要采取的步骤？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T19:14:33.097

将 EDITOR 环境变量设置为 'gvim -f' 似乎可行。

```
set EDITOR=gvim -f 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-05-16T19:46:26.673

1.  edit file - `C:\Users\[your username]\_ipython\ipythonrc.ini`
2.  replace line: `editor 0` to `editor gvim –f` (or `editor [whatever editor you_want to use and system recognize it]`)
3.  save file

You may have problem that your Win doesn't recognize `gvim` as a command, you can fix it like this:

Control Panel -> System -> Advances system settings (System properties - Advanced tab) -> Enviroment Variables

In system variables edit Path and add this: `;C:\Program Files\Vim\vim73\` or path that leads to **your** `gvim.exe`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-23T02:00:01.153

[在 Windows 中创建一个新的环境变量，](https://superuser.com/questions/284342/how-do-i-set-path-and-other-environment-variables/284351#284351)名为`EDITOR`：

1.  `Win XP: Start -> Control Panel -> System -> Advanced -> Environment Variables -> New`
2.  `Win 7: Start -> Type in Search Programs and Files: "environment variables" -> select 'Edit environment variables for your account' -> New...`

变量名将是`EDITOR`，变量值将是`gvim.exe`文件安装位置的文件路径（例如`"C:\Program Files\Vim\vim73\gvim.exe"`）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-17T03:12:30.110

为了让它与 qtconsole 一起工作，我必须输入

```
ipython qtconsole --ConsoleWidget.editor=gvim.bat 
```

当 gvim 在 windows 下安装时，gvim.bat 已创建并安装在我的执行路径中。因此，为了使其永久化，

```
c.IPythonWidget.editor = 'gvim.bat' 
```

行需要输入`ipython_qtconsole_config.py`。

# asynchronous - ADO.NET 数据服务：非异步调用？

> ID：655531
> 
> 赞同：0
> 
> 时间：2009-03-17T18:33:26.533
> 
> 标签：asynchronous, wcf-data-services

我在 ADO.NET 数据服务中遇到了一个问题：

在组装实体进行存储时，我需要从查找文件中获取相关值。例如，一个人的状态代码分配为“待定”，该状态代码位于名为 StatusCodes 的表中。

在 Entity Framework 中，我需要将 person.StatusCode 的值设置为 StatusCode 的一个实例。在实体框架或 LINQ2Sql 中，我会这样：

```
 var person = Person.CreatePerson(stuff);

  var statCode = myContext.StatusCodeSet.Where(sc => sc.Description == "Pending").FirstOrDefault();

  person.StatusCode = statCode;

  // ...more code here...

  myContext.BeginSaveChanges(SaveChangesOptions.Batch,

                                new AsyncCallback(OnSaveAllComplete),

                                null); 
```

statCode 查询在 ADO.NET 数据服务中不起作用，并且我收到运行时错误，指出该函数不受支持。我认为这是因为 statCode 查找不是异步调用。

然而，

```
 var person = Person.CreatePerson(stuff);
  var query = from stat in myContext.StatusCodeSet
              where stat.Description == "Pending"
              select stat;
  var dsQuery = (DataServiceQuery<StatusCode>)query;
  dsQuery.BeginExecute(
      result => tutorApplication.StatusCode = dsQuery.EndExecute(result).FirstOrDefault(), null);
  // ...more code here...
  myContext.BeginSaveChanges(SaveChangesOptions.Batch,
                            new AsyncCallback(OnSaveAllComplete),
                            null); 
```

由于查询的异步性质，也不起作用，在人员保存发生之前结果不会返回。

我正确地接近这个吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T09:52:26.553

在睡了这个之后，我想出了以下几点：

```
 var person = Person.CreatePerson(stuff);
  var appStatPending = new StatusCode()
  {
    StatusCodeId = (int)StatusCodes.Pending,
    Code = "Pending",
    Description = "Pending",
    EffectiveDate = DateTime.Now,
    EnteredBy = "",
    EnteredDate = DateTime.Now
  };

  myContext.AttachTo("StatusCodeSet", appStatPending);
  person.StatusCode = appStatPending;
  myContext.SetLink(tutorApplication, "StatusCode", appStatPending);

  // ...more code here...  
  myContext.BeginSaveChanges(SaveChangesOptions.Batch,
    new AsyncCallback(OnSaveAllComplete),
    null); 
```

我可以创建状态代码的本地副本并将其链接到上下文中。重要的是更新 appStatPending 而不是执行 StatusCode.CreateStatusCode() ，因为这样做会在人员图持续存在时将新的 StatusCode 添加到数据库中。出于同样的原因，执行 AttachTo("StatusCodeSet", appStatPending) 很重要，因为执行 myContext.AddToStatusCodeSet() 还将向数据库中的 StatusCodes 表添加一个新条目。

# image - asp 图片按钮虚线边框

> ID：655533
> 
> 赞同：1
> 
> 时间：2009-03-17T18:33:47.873
> 
> 标签：image, button

如何删除asp周围的虚线边框：图像按钮。单击图像按钮时会显示虚线边框。谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:58:45.303

那是浏览器添加的焦点边框。出于可用性目的，删除它通常是一个坏主意，除非您正在做一些特定的事情。没有它，使用键盘选择控件是非常困难的。

如果由于某种原因您真的需要删除它，我相信这里的其他答案可能会为您提供解决方案。但作为经常关注可用性的人，我建议你重新考虑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T18:51:30.437

看起来您正在谈论浏览器添加的聚焦边框。使用 Javascript 有一个技巧。将以下内容添加到您的图像标签中：

```
onfocus="this.blur();" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:02:06.027

将以下属性/值添加到 imagebutton 应该会产生您正在寻找的结果。

```
OnClientClick="this.blur();" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-06T03:41:57.403

试试这个 CSS：

```
input:focus{outline:none;} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T09:57:56.173

声音。onfocus="this.blur();" 成功了。

# c# - 如何使用 LINQ to SQL 对分层数据进行查询？

> ID：655535
> 
> 赞同：3
> 
> 时间：2009-03-17T18:34:22.053
> 
> 标签：c#, vb.net, linq-to-sql

我有 2 个相关的表。每个应用程序都可以与许多应用程序相关联。即office可以关联word、excel.......

应用
id PK int
appname varchar(50)
.....

appsrelated
relatedid int fk to app.id
appid int

示例数据 app id、appname
1、office
2、word
3、excel
4、quake

应用相关relatedid, appid
1, 2
1, 3

基本上，我是 linq-to-sql 的新手，我有 Brain lock。

我想做以下查询。我使用 vb.net 但 c# 没问题。查询是返回所有与 (1) 无关的应用，所以结果应该是 (4, quake) 。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T18:43:37.133

如果我理解正确，以下代码应该可以完成您的要求。

```
var relatedToApp1 = Context.appsrelated.Where(related => related.relatedid == 1);
var items = Context.app.Where(app => app.id != 1 && !relatedToApp1.Any(related => related.appid == app.id)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:42:14.797

C# - 查找相关应用的 id，选择 id，仅选择那些不是相关应用或其 id 未出现在相关应用的 id 中的应用。

```
var query = apps.Where( a => a.appid != 1
                             &&  !appsrelated.Where( r => r.relatedid == 1 )
                                             .Select( r => r.appid )
                                             .Contains( a.appid ) ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:37:22.557

对于那些在vb土地上的人。这是结果查询。

```
Dim dc As New dashboardDataContext  
Dim q = dc.appsrelateds _  
.Where(Function(r) r.relatedid = 17)

Dim items = dc.ApplicationInfos _  
    Where(Function(app) app.Id <> 17 And Not q.Any(Function(related) related.appid = app.Id)) 
```

# .net - 乘以倒数更好还是更差？

> ID：655537
> 
> 赞同：10
> 
> 时间：2009-03-17T18:35:32.847
> 
> 标签：.net, algorithm, optimization, math

处理**`double`**数据类型时乘以倒数是好是坏？

哪种方式**更快**？哪种方式使用更少的内存？首选哪种方式？

MSIL 如何处理这个问题？

```
SquareInches = MMSquared / 645.16 
SquareInches = MMSquared * 0.0015500031000062000124000248000496 
```

* * *

> **注意：** 10K 用户会注意到这是此问题的副本，[该问题](https://stackoverflow.com/questions/654336/is-multipying-by-the-inverse-better)已被删除，因为最初的提问者决定在问题的“评论”部分责备所有人。

这个问题被转发是因为这是一个“好”的问题。

*请“取消选中”社区 Wiki 以获得您的答案，因为我只是将其发布为 CW，因此它不会被视为“声誉”抢夺。*

### 相关问题：

> [我应该使用乘法还是除法？](https://stackoverflow.com/questions/226465/should-i-use-multiplication-or-division)

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-17T18:45:27.863

乘以倒数更快。编译器不会自动对此进行优化，因为它可能会导致少量的精度损失。（这实际上出现在一个 D 新闻组 Walter Bright 经常出现的地方，他明确表示编译器不会自动执行此操作。）您通常应该划分，因为它更具可读性和准确性。

如果您在循环中执行一段浮点代码十亿次，**并且**您不关心精度的微小损失**并且**您将多次除以相同的数字，那么乘以逆可能是一个很好的优化. 实际上，在某些情况下，我已经在现实世界中获得了显着的加速，例如乘以倒数所描述的情况，但这些是循环执行数十亿次的极端边缘情况，除了乘以浮点数之外几乎什么都不做。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-17T18:50:16.603

哪个“**更快**”确实是特定于 cpu 的问题，或者至少特定于 CPU 的速度有多快，是的，除法通常被视为比乘法慢。当然，所有性能问题都可以用“视情况而定”来回答。

但是，如果您问哪个“**更好**”而不是哪个更快，那么会有一个明确的答案，可读性越高越好。您正在查看的性能改进可能在几个时钟周期的数量级上，因此除非您谈论这样做数百万次，否则您会尝试为自己节省几微秒。并且*没有值得牺牲可读性和可维护性的微秒优化*。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-17T19:02:11.520

好处将非常小或为零，具体取决于编译器和硬件。

但它仍然很重要（在一个紧密的循环中），然后为了可读性你应该写

```
SquareInches = MMSquared * (1 / 645.16) 
```

并且最好使用 645.16 的常数。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-17T18:42:47.243

答案将取决于执行环境的架构。一般来说，在大多数处理器上，除法的成本通常比乘法略高。

因此**，除非这实际上是性能问题，否则我可能不会担心。**选择更易于理解的转换因子。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-17T19:15:20.693

来自我的 VB 代码计时器

```
Dim SquareInches As Double
Dim MMSquared As Double = 81
Const d As Double = 645.16
Const m As Double = 1 / 645.16
Private Function TestCase1() As Boolean 'One
    'Test One Code Here
    SquareInches = MMSquared / d
    'end test code
    Return True
End Function
Private Function TestCase2() As Boolean 'Two
    'Test Two Code Here
    SquareInches = MMSquared * m
    'end test code
    Return True
End Function 
```

结果

```
 3/17/2009 2:13:27 PM   CPU - 1.794GHz
 One - Using Division
 Two - Using Multiplication
 Outer Loops(OL)=7  Inner Loops=262,144
  ( times in ticks.  1 ms. = 10,000 ticks )
 >> Two faster, 0.0488 ticks/loop
  Ticks / Loop
 0.0342         0.0819          0.0331          0.0488
 OL Base        One             Two              One - Two
 1   8,936          21,459          8,609           12,850
 2   9,008          21,416          8,682           12,734
 3   8,965          21,423          8,643           12,780
 4   8,964          21,457          8,659           12,798
 5   8,966          21,469          8,640           12,829
 6   8,987          21,660          8,688           12,972
 7   8,963          21,429          8,802           12,627

  Average
 8,969          21,473          8,674           12,799
  Variance
 431.4          6,160.3         3,315.9       
  Standard Deviation
 20.8           78.5            57.6          
 3/17/2009 2:13:27 PM 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-17T18:48:27.870

在大多数情况下，除法算法比乘法算法慢**。**

这是一个权衡，您可以选择更易读的方式或更快的方式。

```
// Using division operation
SquareInches = MMSquared / 645.16 
```

这很容易阅读和维护，但比它的乘法对应物执行得慢：

```
// Using a multiplication 
SquareInches = MMSquared * 0.0015500031000062000124000248000496 
```

如果你这样做，你将需要更多的内存空间来存储倒数数字，但算法的运行速度要快得多。一位用户在 VS2005 项目上对其进行了测试，并报告说乘法版本的性能提高了 8 倍。

原因是乘法可以盲目地转换为处理器上的移位和加法运算，这是 CPU 上最优化的运算。有符号乘法的一个很好的算法是布斯算法（处理器会为您执行此操作）。另一方面，在执行除法算法时需要更多的控制开销，从而使除法算法变慢。

如果您需要性能，请使用加法、减法（只不过是添加二进制补码）、乘法、移位，但不要使用除法。如果您提前计算所有逆运算，并在除法密集型程序中使用它们进行乘法运算，您将获得不可忽略的**实质性改进。**

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T19:03:26.260

关于执行 mult 优化的编译器，他们可以优化这个（GCC 可以）：SquareInches = MMSquared * (1 / 645.16)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T18:42:50.910

如果您要除以文字值，`645.16`那么很可能没有区别，因为编译器可以轻松确定哪个版本更快并使用它。
如果您要除以或乘以一个变量，那么乘法可能会稍微快一些，因为逻辑通常更简单。
与任何事情一样，可以肯定的是，使用分析器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T18:44:00.487

乘法和加法是处理器支持的最快操作。有些处理器甚至没有除法、平方根等的硬件实现。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-17T18:44:02.560

对于大多数处理器，乘法比除法更快。但这对于大多数应用程序来说真的微不足道，在我看来，你最好使用更具可读性的那个，除非分析表明它是一条关键路径。

如果它是一种解释性语言，那么读取源代码并将其转换为数字的时间将超过实际进行数学运算所花费的时间，尤其是当您使用那么多有效数字进行乘法运算时。（你确定你真的需要那么多有效数字吗？）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T18:44:17.710

我认为第一种方法显然是首选，因为它是明确的。想象一下在别人的代码中找到这个。你怎么确定 0.00155... 真的是 1/645.16？如果原来的程序员犯了错误怎么办？此外，我怎么知道 645.16 是正确的转换因子？为简单起见，最好不要将数字压缩或统一表示。最基本的例子如下：

```
//hours per day * days per year
int hoursPerYear = 24*365; 
```

我们可以清楚地看到这个数字是正确的，但是你怎么知道，8760 是正确的答案呢？如果您需要执行许多这些操作，您可能需要在输入密集计算之前将数据预处理为正确的形式。以这种方式，您将不需要令人难以置信的效率，并且问题变得没有实际意义。

# html - 将用户从旧网站重定向到新网站时，检测是否向他们显示自定义欢迎消息的最佳方法是什么？

> ID：655543
> 
> 赞同：0
> 
> 时间：2009-03-17T18:36:52.860
> 
> 标签：html, apache, http, http-headers

假设您有一个旧网站在提供某些功能的旧代码库上运行。后续网站已启动并运行，提供所有旧功能等。一段时间以来，旧网站上有一个指向新网站的 HTML 链接，供那些关心点击的用户使用。

现在，旧网站即将结束，您希望自动将用户重定向到新网站，例如通过 301 或 302 重定向。但是，当用户遇到此重定向时，您还希望在新站点上显示一条友好的消息，欢迎他们并解释他们为什么看不到旧版本。

当用户单击 HTML 链接时，会填充 HTTP_REFERER 标头，并且可以通过该值触发欢迎消息。但是，使用 3XX 重定向代码时似乎并非如此。

谷歌对该问题的最高点击是这样说的：“HTTP 1.1 规范清楚地说明了这一点：如果给出 3XX 代码，则不会传递任何引用值。（最终，指向 3XX 站点的 URL）。” （[http://www.usenet-forums.com/apache-web-server/37811-how-set-referer-redirect.html#post145986](http://www.usenet-forums.com/apache-web-server/37811-how-set-referer-redirect.html#post145986)）

[但是，我在快速阅读规范（ https://www.rfc-editor.org/rfc/rfc2616](https://www.rfc-editor.org/rfc/rfc2616)）时找不到此声明。

谁能建议实现此功能的正确方法？

注意：这并不是一个包罗万象的解决方案。我们知道有些客户端出于隐私原因甚至不发送 HTTP_REFERER 标头，但为了争论，让我们忽略该用例。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T18:41:06.470

首先，这应该是 301，而不是 302 重定向。您的重定向是永久性的，因此您想表明这一点。至于如何指示重定向，只需在 url 中添加一个 parm 即可。而不是重定向`http://www.newsite.com`将它们重定向到`http://www.newsite.com?FromOldSite=Y`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:40:30.637

您可以将它们重定向到特定的启动页面吗？就像尝试尝试访问一样`http://oldsite.com/desired/page`，只需将它们发送到`http://newsite.com/welcome?nextpage=/desired/page`。欢迎页面可以显示消息，然后将它们传递给内容。或者，您可以将它们直接发送到 URL 中带有 a 的新页面`?show_welcome=true`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T20:00:11.390

不确定您打算如何重定向您的用户，但如果您不想“丑化”您的 URL，您可以在访问旧网站时设置自己的自定义标头，然后在新网站上检查它。

# debugging - MSIL 调试器 - Mdbg、Dbgclr、Cordbg

> ID：655559
> 
> 赞同：6
> 
> 时间：2009-03-17T18:41:54.797
> 
> 标签：debugging, cil

我一直在做一些 MSIL 工作，并且遇到了对这三个调试器的引用。

*   他们之间有什么区别？

*   其中一个比其他的更好吗？功能？

*   还有其他我错过的吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T18:50:02.407

我假设您的意思是 DbgClr 不是 Clt 和 mdbg 不是 mdbug？

*   DbgClr 使用 VS shell，因此您可以获得一个不错的 GUI。
*   mdbg 是命令行管理的调试器。
*   cordbg 是一个旧样本，但现在它只是 mdbg 的包装器。[http://blogs.msdn.com/jmstall/archive/2005/11/07/views_on_cordbg_and_mdbg.aspx](http://blogs.msdn.com/jmstall/archive/2005/11/07/views_on_cordbg_and_mdbg.aspx)

Visual Studio 是您错过的一个，但 DbgClr 应该具有相同的功能。[http://blogs.msdn.com/andypennell/archive/2005/02/21/377621.aspx](http://blogs.msdn.com/andypennell/archive/2005/02/21/377621.aspx)。

您还可以使用带有[SOS 扩展](http://msdn.microsoft.com/en-us/library/bb190764.aspx)的 windbg从 Windows 调试器进行托管调试。SOS 在使用 VS 时也很有帮助，因为它可以让您检查内存等。

要查看源代码级别的 MSIL 调试，请尝试使用带有 /debug 选项的 ilasm。上次我检查时，VS 会让您像 C# 或任何其他语言一样单步执行 .il 源代码。

MSDN 博客有大量关于调试 .NET 应用程序的内容——我建议您在那里进一步搜索。

# ant - 使用 Hudson 设置 Flex 项目的资源

> ID：655566
> 
> 赞同：0
> 
> 时间：2009-03-17T18:43:04.203
> 
> 标签：ant, continuous-integration, hudson, flex-lexer

我正在研究为我们的 flex 项目设置 CI 环境。我在设置这样的环境方面经验很少，但是已经阅读了很多关于它的内容，并且认为我们可以在我们的项目中从中受益匪浅。我确实有使用 ANT 的经验，我们目前正在将它用于我们的建筑。我一直在关注 Hudson，它看起来非常漂亮和简单，同时仍然具有支持适当 CI 环境的能力。

所以基本上，我的问题是，是否有人有与 Hudson 建立 Flex 项目的经验？如果是这样，请分享一些关于问题、成本/收益以及每个项目需要什么样的努力才能与 Hudson 一起启动和运行的信息。我已经用谷歌搜索了一段时间，可以自豪地说我对快速词法分析器和哈德逊河都了解得更多，但对这篇文章的主题知之甚少 =)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:52:26.383

几乎任何可以从命令行执行的东西都可以通过 hudson 执行。如果您的 flex 应用程序可以通过 ant 从命令行构建；它会在哈德逊工作得很好。

这可能会有所帮助：

[http://www.subotnik.com/blog/?p=100](http://www.subotnik.com/blog/?p=100)

# django - 比较 GWT 和 Django？

> ID：655573
> 
> 赞同：10
> 
> 时间：2009-03-17T18:44:41.373
> 
> 标签：django, gwt, comparison

两者似乎都很酷，在什么场景中使用？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T19:04:22.357

GWT：[http ://code.google.com/webtoolkit/](http://code.google.com/webtoolkit/)

> 比手写更快的 AJAX
> 
> 使用 Google Web Toolkit (GWT)，您可以使用 Java 编程语言编写 AJAX 前端，然后 GWT 将其交叉编译为优化的 JavaScript，该 JavaScript 可以自动在所有主要浏览器中运行。

Django： http: [//www.djangoproject.com/](http://www.djangoproject.com/)

> 一个高级 Python Web 框架，它鼓励快速开发和简洁、实用的设计。

他们彼此之间几乎没有任何关系。Django 提供了一些 Javascript；Django 可以轻松处理任何 Ajax 对话的服务器端。

Django 不会帮助您编写 javascript。它可以帮助您编写应用程序的服务器端。

Django 帮助您编写 HTML 页面（使用模板）。如果页面包含或依赖于 Javascript，Django 根本不在乎。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T19:55:20.060

[pajamas](http://code.google.com/p/pyjamas/)是 GWT 的 Python 端口，因此所有的 javascript 都是使用 Python 而不是 Java 生成的。

如果您打算使用 Django，则使用 Python 编写整个商店代码可能会简化。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T19:38:33.780

在同一个项目中使用两者是很有可能的。我已经在这样的项目上工作了一段时间了。让 Django 处理服务器端并将客户端留给 GWT。我唯一的问题是不能使用 GWT 中的 RPC 机制，因为它与 Java servlet 一起工作。我改为使用 JSON 进行通信。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T19:21:02.273

使用 GWT，您可以编写在某些浏览器 Javascript 引擎中运行的客户端应用程序。你用 Java 编码，它被编译成 Javascript。

Django 不同，因为您编写服务器端应用程序：应用程序将在服务器中执行并将其结果发送到客户端浏览器。啊! Django 是 Python。

两者都有库来实现 Web 开发人员需要的大部分任务，如国际化、会话等。Django 带有一个很好的 ORM（对象关系映射器），GWT 带有一个基于 Tomcat 的引擎，用于服务器端编码和开发。

如果您需要做出决定，只需选择基于您选择的语言的框架。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-19T20:34:06.100

我使用 xml 序列化在 django 和 gwt 之间进行通信

[http://www.eecho.info/Echo/ajax/requestbuilder-gwt-15/](http://www.eecho.info/Echo/ajax/requestbuilder-gwt-15/)

# svn - 使用绝对路径的项目上的 SVN 管理

> ID：655588
> 
> 赞同：1
> 
> 时间：2009-03-17T18:51:04.883
> 
> 标签：svn, version-control, tortoisesvn

我之前听说过在源代码控制中包含项目和工作区/解决方案文件通常是不好的做法，但我想获得有关处理这种情况的最佳方法的反馈。

我的工作要求我为我的部门设置源代码控制服务（我从 3 年前的第一天开始就一直在要求）。我最大的障碍如下。

我们在网络 SMB 共享上保留最新版本的快照，使用标签并手动更新它？可以多人同时维护此工作副本还是该文件夹仅与创建者关联？

我们所有的“项目”文件（包含文件清单、构建信息等）都使用绝对路径。如果我使用 c:\myproject 而同事使用 c:\MaiPrjLolKeke，这真的很痛苦项目通知同事可能必须添加新文件的最佳方式是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T18:55:04.330

设置您的构建文件以使用相对路径。

理想情况下，您应该能够随时（并进入任何文件夹）从 SVN 签出副本，运行构建脚本，运行自动化测试，并立即启动并运行。如果你做不到，那你就做错了。

（是的，您可能还需要首先设置操作系统、数据库服务器、Web 服务器、编程语言和 IDE。但是一旦全球基础设施已经存在，您应该能够开始运行任何时间、任何地点。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:54:52.567

问题不在于源代码中的项目文件。问题是项目文件中的硬编码路径。

您可以为此使用相对路径或使用环境变量。

例如，您可以为包含文件使用通用“根”，为其他第三方库使用通用“根”。这些根目录下的层次结构应该是相同的。

这通常在我工作过的许多地方使用，通常是您可以指向第三方库的方式。它还解决了在一台机器上拥有一组文件的多个版本的问题。通过更改一个环境变量（在构建脚本或其他方式中），您可以迎合特定的目标/构建。

至于你的另一个问题 - 你在说什么并不完全清楚。我想你是在问是否有多个人签出到同一个共享路径/网络共享。这不是一个好主意。你们都可以拥有自己的源文件的工作集/工作副本，并且默认情况下 SVN 不会“锁定”文件，因此您可以同时处理它们。您只需要练习更新/获取最新的源/更改。

编辑——正如另一张海报所说（我在这里重复一遍，这样你就不会错过了）——

**源代码管理中的解决方案和/或项目文件不是坏习惯。**

编辑：

这是另一种解决方案 - 不确定其他人是否已经提出建议。

创建到路径结构中其他位置的映射并使其成为网络驱动器 - 例如 x:\

如果每个人都这样做，他们可以保持他们喜欢的目录结构，并且仍然使用相同的项目文件。不需要假人。

例如，如果开发人员 A 有

C:\development\project\blah 将 X:\project 映射到 c:\development\project

并且开发人员 2 具有：C:\my documents\user\Visual studio\etc...，她将 X:\ 映射到该路径。

中提琴！

C：\

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:06:43.723

如果您的项目中有硬编码路径，那么您需要标准化一个，以便大家可以一起工作。这可能意味着你们都必须更改为使用“c:\work”或“C:\dev”，但这对于让一切“正常工作”来说是一个很小的代价。

如果你绝对不能这样做，那么我推荐[junction](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx) - 这会设置从一个目录到另一个目录的链接。您都可以签入“通用”路径的文件，但仍然可以从您自己的首选路径访问它。不是最好的，但可行。

如果您可以使用相对路径，那么您就处于共享工作的天堂。真的尝试一下，因为它只会解决你所有的问题。

如果您对必须位于相对于您的其他项目的特定目录中的引用文件有问题（例如，位于 c:\include 中的公共集），则将其连接到您检查它的位置，然后您假设您可以处理管理所需的纪律，那就没问题了。或者您可以使用 svn:externals 将公共文件签出到硬编码路径。

PS。将项目文件放在 SCM 中并不是一个坏习惯，我认为每个人都这样做，但所有路径都必须与项目本身相关，因此您可以在任何您喜欢的地方检查全部内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T19:21:49.133

我必须处理类似的配置（SVN 存储库中的项目文件。）主要问题是有人会“修复”他们系统的路径，然后签入更改（这会杀死其他所有人的项目或强制（邪恶）合并.)

一种可行的解决方案是将模板（例如 TEMPLATE.project）存储在存储库中并将 (.project) 添加到 SVN:ignore。这允许每个开发人员签出所需文件的模板，但不容易签入意外更改。

解决 .classpath 问题的另一种方法是使用 UserLibraries 来包含所有第三方库。这允许开发人员将它们存储在他们喜欢的任何地方并在 Eclipse 中配置映射。

# php - 需要帮助将 xml 显示为 html

> ID：655590
> 
> 赞同：0
> 
> 时间：2009-03-17T18:51:35.540
> 
> 标签：php, xml, xslt, amazon-web-services, xslt-1.0

我正在尝试使用 Macromedia XSLTransform 类将从 Amazon Web Services 返回的 XML 转换为 HTML。这是调用转换的 PHP 页面：

```
<?php
require_once('includes/MM_XSLTransform/MM_XSLTransform.class.php'); 

$restquery = "http://ecs.amazonaws.com/onca/xml?Service=AWSECommerceService&AWSAccessKeyId=[myid]&Operation=ItemLookup&ResponseGroup=Large&ItemId=" . htmlspecialchars($_GET["asin"]);
$mm_xsl = new MM_XSLTransform();
$mm_xsl->setXML($restquery);
$mm_xsl->setXSL("aws1.xsl");
echo $mm_xsl->Transform();
?> 
```

这是 aws1.xsl 页面的片段

```
<?xml version="1.0"?>
<xsl:stylesheet 
  version="1.0" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
  xmlns:aws="http://webservices.amazon.com/AWSECommerceService/2006-06-07">

  <xsl:output method="html" encoding="UTF-8" omit-xml-declaration="yes"/>

  <xsl:template match="aws:Item">
    <html>
      <body>
        <table>
          <tr>
            <td style="border-bottom:#C0C0C0 dotted 1px;padding:10px">
              <table cellpadding="0" cellspacing="0" style="width: 90%;padding:5px">
                <tr>
                  <xsl:if test="aws:SmallImage/aws:URL">
                    <td valign="top" width="50">
                      <img>
                        <xsl:attribute name="src">
                          <xsl:value-of select="aws:SmallImage/aws:URL" disable-output-escaping="yes" />
                        </xsl:attribute>
                        <xsl:attribute name="border">0</xsl:attribute>
                      </img>
                    </td>
                  </xsl:if>
                  <!-- bunch of other stuff -->
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </body>
    </html>
  </xsl:template>

</xsl:stylesheet> 
```

基本代码正在运行 - 我得到了有关预期 ASIN 商品的数据。而且我知道 XSL 基本上可以工作，因为如果我故意在其中放入一个无效属性，我会得到一个解析器错误。但我得到的是一大堆未格式化的文本，而不是 HTML。我尝试了各种`<xsl:output method>`选择，但似乎没有一个有效。我认为这是某种编码或字符集问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T19:08:25.640

您需要创建一个匹配“/”的规则，否则 XSL 将基于文档树的文本转换为您隐式生成一个规则。

我会将 XSL 重写为：

```
<xsl:stylesheet 
  version="1.0" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
  xmlns:aws="http://webservices.amazon.com/AWSECommerceService/2006-06-07">

  <xsl:output method="html" encoding="UTF-8" omit-xml-declaration="yes"/>

  <xsl:template match="/">
    <html>
      <head>...</head>
      <body>
        <table>
          <thead>...</thead>
          <tbody>
            <xsl:apply-templates select="//aws:Item"/>
          </tbody>
        </table>
      </body>
    </html>
  </xsl:template>

  <xsl:template match="aws:Item">
    <tr>
      <td>...</td>
    </tr>
  </xsl:template>

</xsl:stylesheet> 
```

或将此模板添加到您现有的 xsl

```
<xsl:template match="*|@*">
<xsl:apply-templates select="*|@*"/>
</xsl:template> 
```

两个模板都会匹配文档根目录（“/”），这是 XSL 唯一的隐式匹配。这首先会使“/”映射到 html 标记，该标记将创建一个表，其中每个表行都映射到 aws:item。第二个将匹配所有节点（和属性），不输出任何内容，然后尝试匹配所有子节点。如果您只想处理 aws:Item，第一个更好，如果您想处理所有节点，则第二个更好。第二个可能（取决于您的 xslt 处理器和您的特定 xslt 文档的优化功能）需要更长的时间来处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T18:56:22.593

设置您的内容类型以指示您发送的是 HTML 而不是 XML。

```
header('Content-type: text/html'); 
```

# file - 什么是事件记录？以及如何编写事件日志文件？

> ID：655592
> 
> 赞同：1
> 
> 时间：2009-03-17T18:54:24.220
> 
> 标签：file, visual-c++, event-log

什么是事件记录？以及如何为应用程序编写事件日志文件？我想记录应用程序的所有活动，包括它何时使用 .dll 等，并显示应用程序的信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T19:08:48.477

CodeProject.com 上有一篇很好的文章，它应该为您提供了解和使用 Windows 事件日志所需的信息。

[http://www.codeproject.com/KB/system/xeventlog.aspx](http://www.codeproject.com/KB/system/xeventlog.aspx)

如果您不想使用 Windows 事件日志并记录到文本文件等，请查看[Pantheios](http://www.pantheios.org/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T19:08:47.277

当您写入事件日志文件时，如果*未创建该文件，则将创建该文件并* [写入事件日志](http://support.microsoft.com/kb/815661)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T19:08:39.023

我认为你的意思是[这个](http://msdn.microsoft.com/en-us/library/aa385780(VS.85).aspx)和 cpp 源：http: [//msdn.microsoft.com/en-us/library/aa382690 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa382690(VS.85).aspx)

# c# - 在 C# 中表示此查找表的最佳方法

> ID：655594
> 
> 赞同：3
> 
> 时间：2009-03-17T18:54:54.923
> 
> 标签：c#, lookup-tables

我需要在 C# 中表示一个查找表，这是基本结构：

```
Name    Range   Multiplier

Active  10-20   0.5 
```

你们有什么建议？

我将需要查找范围并检索乘数。我还需要使用名称进行查找。

**更新** 它总共可能有 10-15 行。范围是整数日期类型。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T19:03:05.247

您实际拥有的是*两个*查找表：一个按名称，一个按范围。根据表的大小，有几种方法可以在内存中表示它们。

最可能适合“按名称”查找的是字典：

```
var MultiplierByName = new Dictionary<string, double>() { {"Active",.5}, {"Other", 1.0} }; 
```

范围更棘手。为此，您可能只想存储最小或最大项目，具体取决于您的范围的工作方式。您可能还需要编写一个函数来将任何给定的整数归约为其对应的存储键值（提示：使用整数除法或 mod 运算符）。

从那里您 `Dictionary<int, double>`可以选择另一个字典（`List<double>`

但就像我说的：要确定什么是最好的，我们真的需要知道查找中数据的范围和性质，以及您将用来访问它的场景。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T19:02:27.290

创建一个类来表示每一行。它将具有 Name、RangeLow、RangeHigh 和 Multiplier 属性。创建此类行的列表（从文件中读取或在代码中输入），然后使用 LINQ 对其进行查询：

```
from r in LookupTable
where r.RangeLow <= x && r.RangeHigh >= x
select r.Multiplier; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T19:00:54.533

有时简单是最好的。我们正在查看多少个条目，以及您在示例中似乎暗示的范围整数范围？虽然我能想到几种方法，但首先想到的是维护两个不同的查找字典，一个用于名称，一个用于值（范围），然后将冗余信息存储在范围字典中。当然，如果你的范围是双打键，或者你的范围达到数万，我会在我的书中寻找一些不同的东西，但简单的规则。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T19:23:09.647

我将使用 DataTable 来实现这一点，假设没有迫切的理由使用另一种数据类型。DataTable.Select 适用于在名称或范围上运行查找。为此，您使用 DataTable 确实会损失一些性能，但是如果有 10-15 条记录，这会很重要。

# c# - HTML 敏捷包 - 解析表

> ID：655603
> 
> 赞同：60
> 
> 时间：2009-03-17T19:00:18.700
> 
> 标签：c#, html, html-parsing, html-agility-pack

我想使用 HTML 敏捷包来解析来自复杂网页的表格，但我不知何故迷失在对象模型中。

我查看了链接示例，但没有以这种方式找到任何表格数据。我可以使用 XPath 来获取表格吗？在加载有关如何获取表格的数据后，我基本上迷失了。我以前在 Perl 中做过这个，有点笨拙，但是很有效。( `HTML::TableParser`)。

如果有人能阐明解析的正确对象顺序，我也很高兴。

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-03-17T20:13:52.963

怎么样：使用[HTML Agility Pack](http://html-agility-pack.net/api)

```
HtmlDocument doc = new HtmlDocument();
doc.LoadHtml(@"<html><body><p><table id=""foo""><tr><th>hello</th></tr><tr><td>world</td></tr></table></body></html>");
foreach (HtmlNode table in doc.DocumentNode.SelectNodes("//table")) {
    Console.WriteLine("Found: " + table.Id);
    foreach (HtmlNode row in table.SelectNodes("tr")) {
        Console.WriteLine("row");
        foreach (HtmlNode cell in row.SelectNodes("th|td")) {
            Console.WriteLine("cell: " + cell.InnerText);
        }
    }
} 
```

请注意，如果您愿意，可以使用 LINQ-to-Objects 使其更漂亮：

```
var query = from table in doc.DocumentNode.SelectNodes("//table").Cast<HtmlNode>()
            from row in table.SelectNodes("tr").Cast<HtmlNode>()
            from cell in row.SelectNodes("th|td").Cast<HtmlNode>()
            select new {Table = table.Id, CellText = cell.InnerText};

foreach(var cell in query) {
    Console.WriteLine("{0}: {1}", cell.Table, cell.CellText);
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2010-06-23T17:33:23.323

我发现获取特定元素的 XPath 的最简单方法是为 Firefox 安装 FireBug 扩展，转到站点/网页按 F12 调出 firebug；右键选择并右键单击页面上要查询的元素并选择“检查元素” Firebug 将在其 IDE 中选择该元素，然后右键单击 Firebug 中的元素并选择“复制 XPath”此功能将为您提供确切的 XPath查询您需要使用 HTML 敏捷库获取所需的元素。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2019-04-26T19:21:52.773

我知道这是一个非常古老的问题，但这是我的解决方案，有助于可视化表格，以便您可以创建类结构。这也是使用 HTML Agility Pack

```
HtmlDocument doc = new HtmlDocument();
doc.LoadHtml(@"<html><body><p><table id=""foo""><tr><th>hello</th></tr><tr><td>world</td></tr></table></body></html>");
var table = doc.DocumentNode.SelectSingleNode("//table");
var tableRows = table.SelectNodes("tr");
var columns = tableRows[0].SelectNodes("th/text()");
for (int i = 1; i < tableRows.Count; i++)
{
    for (int e = 0; e < columns.Count; e++)
    {
        var value = tableRows[i].SelectSingleNode($"td[{e + 1}]");
        Console.Write(columns[e].InnerText + ":" + value.InnerText);
    }
Console.WriteLine();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-05-04T23:45:21.643

就我而言，有一个表恰好是来自路由器的设备列表。如果您希望使用 TR/TH/TD（行、标题、数据）而不是上面提到的矩阵来读取表格，您可以执行以下操作：

```
 List<TableRow> deviceTable = (from table in document.DocumentNode.SelectNodes(XPathQueries.SELECT_TABLE)
                                       from row in table?.SelectNodes(HtmlBody.TR)
                                       let rows = row.SelectSingleNode(HtmlBody.TR)
                                       where row.FirstChild.OriginalName != null && row.FirstChild.OriginalName.Equals(HtmlBody.T_HEADER)
                                       select new TableRow
                                       {
                                           Header = row.SelectSingleNode(HtmlBody.T_HEADER)?.InnerText,
                                           Data = row.SelectSingleNode(HtmlBody.T_DATA)?.InnerText}).ToList();
                                       } 
```

TableRow 只是一个以 Header 和 Data 作为属性的简单对象。该方法处理空值和这种情况：

```
<tr>
    <td width="28%">&nbsp;</td>
</tr>
```

这是没有标题的行。带有常量的 HtmlBody 对象可能很容易推断出来，但我仍然为它道歉。我来自一个世界，如果你的代码中有“，它应该是常量或可本地化的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-01-13T02:11:50.813

从上面的答案行：

```
HtmlDocument doc = new HtmlDocument(); 
```

这在 VS 2015 C# 中不起作用。你不能再构造一个`HtmlDocument`了。

另一个让事情更难使用的 MS“功能”。尝试`HtmlAgilityPack.HtmlWeb`查看[此链接](http://blog.olussier.net/2010/03/30/easily-parse-html-documents-in-csharp/)以获取一些示例代码。

# xml - 订单很重要时的 XSLT 处理

> ID：655605
> 
> 赞同：1
> 
> 时间：2009-03-17T19:01:25.750
> 
> 标签：xml, xslt

我承认我是 xslt 的新手，我正在阅读各种教程和文档，但我有一种情况，我不确定如何查找答案。

基本上就是这样。我有一个看起来像这样的 xml 文档...

```
<tag1>
  <tag2>
    foo
  </tag2>
  <tag3>
    bar
   </tag3>

  <tag2>
    goo
  </tag2>
  <tag3>
    mar
  </tag3>
</tag1> 
```

所以这里的问题是顺序很重要。tag2 和 tag3 中的项目组合在一起。也就是说，“foo”和“bar”需要一起处理，“goo”和“mar”也是如此。

我不知道如何在构造中捕获它。也就是说，我可以匹配 tag2 和 tag3，但我不知道如何将它们按顺序排列在一起。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T19:36:21.150

Here's a straightforward way to do grouping if your source data is already ordered the way you expect:

```
<xsl:apply-templates select="/tag1/*[position() mod 2 = 1]" mode="group"/> 
```

This will apply templates to every odd-positioned child element of `tag1` irrespective of name. You use a mode to limit the template that gets applied (because that template has to match `*`). Within the template, you can use the `following-sibling` search axis to get the next node. This gives you something like:

```
<xsl:template match="*" mode="group">
   <xsl:variable name="next" select="following-sibling::*[1]"/>
   <group>
      <xsl:copy-of select="."/>
      <xsl:copy-of select="$next"/>
   </group>
</xsl:template> 
```

It's even simpler if you can rely on the element names:

```
<xsl:apply-templates select="/tag1/tag2"/>

<xsl:template match="tag2">
   <xsl:variable name="next" select="following-sibling::tag3[1]"/>
   <group>
      <xsl:copy-of select="."/>
      <xsl:copy-of select="$next"/>
   </group>
</xsl:template> 
```

Note that if you're grouping every N elements, you can get a list of the current element and its following N-1 siblings with:

```
<xsl:variable name="list" select=". | following-sibling::*[position() &lt; $n]"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T19:31:46.810

凯尔似乎走在了正确的轨道上：

具体来说，如果您只是想获取每对 tag2 和 tag3 值，并假设这些值总是按顺序出现在 tag1 节点中，我会使用 XSL，例如（非常简单）：

```
<xsl:template match="//tag1">
  <xsl:for-each select="tag2">
    <xsl:value-of select="self::node()" />
    <xsl:value-of select="following-sibling::tag3[1]" />
  </xsl:for-each>
</xsl:template> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T19:08:43.313

如果您只需要按顺序处理所有“tag2”和“tag3”元素，那么您可以在选择它们时将“tag2 | tag3”指定为 XPath 查询。

如果确实是一个需要处理的单元，那么“tag2”和“tag3”应该真正组合在一个新的父元素下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T19:10:02.827

我怀疑这在单一、直接的选择中是不可能的。或者，您可以单独处理组，

```
<xsl:apply-templates select="foo|bar"/>
<xsl:apply-templates select="goo|mar"/> 
```

使用匹配所有这些的模板。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T19:49:53.940

Here is an XSLT 1.0 transformation that groups two consecutive children of `<tag1>`, based on their position in the document.

```
<xsl:stylesheet version="1.0" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:template match="tag1">
    <root>
      <xsl:apply-templates select="*[position() mod 2 = 1]" />
    </root>
  </xsl:template>

  <xsl:template match="tag1/*">
    <xsl:variable name="next" select="following-sibling::*[1]" />   
    <together>
      <xsl:value-of select="normalize-space(concat(., $next))" />
    </together>
  </xsl:template>
</xsl:stylesheet> 
```

Here is how it works:

*   starting at `<tag1>`, it outputs a root `<root>` node, and then selects those children of `<tag1>` who are at the start of the group (`position() mod 2 = 1`) for further processing
*   for each of those nodes, the second template outputs the text contents of the selected node and it's following sibling

My test output is:

```
<root>
  <together>foo bar</together>
  <together>goo mar</together>
</root> 
```

# nhibernate - NHibernate O/R 问题

> ID：655608
> 
> 赞同：1
> 
> 时间：2009-03-17T19:02:11.877
> 
> 标签：nhibernate

这些年来，我编写了很多 ejb、oledb 和 ADO 代码。我对 O/R 映射器的经验充其量是速度的猪，最坏的情况是充满错误的噩梦。

NHibernate 或 Spring .NET 值得麻烦吗？为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T19:53:03.327

我没有使用过 Spring.Net Data 模块，所以我不会对此发表评论。我已经将 Spring.Net 用于它的 IOC。总的来说，我认为您可以为此做得更好。

NHibernate 非常好。它会比直接使用 ADO.Net 慢，但总的来说，还不足以让您担心。关键是 NHibernate 允许您快速启动和运行数据库代码，因此您可以担心实际的应用程序代码。您的应用程序不仅仅是数据库。

然后，当您发现查询时间过长并影响应用程序性能时，请使用传统方法重写该方法。

还有其他替代方案，Entity Framework、SubSonic、LLBLGen 等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T19:54:51.277

正如 Matt 提到的，ORM 对在您的应用程序设计中允许的关注点分离很有价值。最大的权衡当然是原始性能。我认为的理念是您始终可以扩展硬件资源，但不能轻松扩展和扩展紧密耦合的代码。

如果您正在寻找 .net 空间，请考虑[Lightspeed](http://www.mindscape.co.nz/products/LightSpeed/)。它是一个商业 ORM，但比 NHibernate 快得多，而且通常使用起来更直观。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:06:00.200

它们值得“麻烦”，因为它们使您可以在与行为和其他代码分开的模型中清楚地定义数据。您不需要编写自定义 DAL。它们有助于分离关注点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T19:38:22.470

这取决于你的注意力，我猜。

在我的店里，有些人喜欢他们（真正的 Java/OO 螺旋桨头），有些人鄙视他们（有更多的 SQL 技能）。

我在第二组，但我是一名开发人员 DBA。

它们本身并不邪恶，如果使用得当，没有任何宗教包袱，它们只是一个有用的工具。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T19:52:31.987

如果您不介意与 SQL Server 的紧密耦合以及与架构的相对紧密耦合，您可以考虑研究[LINQ to SQL](http://msdn.microsoft.com/en-us/library/bb425822.aspx)。它是框架的一部分，非常简单，而且非常容易编程。使用 VS 2008 附带的设计器，您可以在几分钟内启动并运行并编写代码。

也就是说，LINQ to SQL 并不是万能的。NHibernate 在许多方面肯定更加健壮，而且整个[实体框架](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)迁移也在进行中。

但是 LINQ to SQL 并不追求速度。而且我可以根据经验告诉你，尽管设计器并非完全没有错误，但它非常健壮，并且底层基础至少*没有*错误。

LINQ to SQL 实际上是一个相当强大和成熟的 ORM。

如果您需要一个关于 LINQ to SQL 强大功能的工作示例，请查看这个网站。它使用 LINQ to SQL 作为后端，我认为它一点也不慢。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T10:11:31.827

NHibernate 绝对值得付出努力。正如其他人所说，它比直接使用 ADO.Net 等要慢，但我认为生产力的提高是值得的。在性能方面，您可以在 NHibernate 中进行很多调整以加快速度：

1.  延迟加载 - 仅在实际请求时从数据库加载子对象/集合
2.  缓存 - NHibernate 有一级和二级缓存。默认情况下使用一级缓存，这意味着 NHibernate 不会在同一会话中多次运行相同的查询。二级缓存取决于用户，您可以在其中选择哪些操作是可缓存的（通过 3rd 方缓存引擎），NHibernate 将为您处理。例如，如果您多次（跨所有会话）加载对象，并且对象很少更改，则使其可缓存以加快速度。

# iphone - 查找 UIImage 文件类型

> ID：655617
> 
> 赞同：2
> 
> 时间：2009-03-17T19:05:31.713
> 
> 标签：iphone, objective-c, cocoa-touch, mobile

有没有办法确定用于创建 UIImage 的文件类型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T19:28:03.057

原始图像的类型真的很重要吗？`CGImageRef`您可以通过检查底层对象（称为属性`CGImage`）的详细信息以获取 alpha 组件信息等来实现您想要的任何东西吗？

有关更多详细信息，请`CGImage`从`UIImage`手册页查找文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T19:20:51.257

没有！

如果这是您自己加载的图像，您可以将该关联存储在其他地方。如果文件来自其他地方，那么它甚至可能一开始就不是来自文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-03T18:49:55.023

如果使用 imagePickerController 添加图像，您可以在图像选择器委托方法中确定类型，如下所示：

```
- (void)imagePickerController:(UIImagePickerController *)picker 
didFinishPickingMediaWithInfo:(NSDictionary *)info {

    // Get the image reference URL
    NSURL *referenceURL = [info objectForKey:UIImagePickerControllerReferenceURL];

    // The path extension contains the image type: JPG, PNG, GIF, etc.
    NSString *originalImageType = referenceURL.pathExtension; 

} 
```

# java - 如何从 Java 执行 PHP 脚本？

> ID：655620
> 
> 赞同：9
> 
> 时间：2009-03-17T19:06:02.213
> 
> 标签：java, php

我有一个通过 URL 执行的 php 脚本。（例如 www.something.com/myscript?param=xy）

当这个脚本在浏览器中执行时，它会给出一个编码结果，一个负数或正数。

我想从 Java 代码（J2EE）执行这个脚本并将结果存储在某个对象中。

我正在尝试使用`httpURLConnection`它。我建立了连接，但无法获取结果。我不确定我是否完全执行脚本。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T19:16:56.990

```
public class URLConnectionReader {
    public static void main(String[] args) throws Exception {
        URL yahoo = new URL("http://www.yahoo.com/");
        URLConnection yc = yahoo.openConnection();
        BufferedReader in = new BufferedReader(
                                new InputStreamReader(
                                yc.getInputStream()));
        String inputLine;

        while ((inputLine = in.readLine()) != null) 
            System.out.println(inputLine);
        in.close();
    }
} 
```

此片段来自官方 Java 教程 ( [http://java.sun.com/docs/books/tutorial/networking/urls/readingWriting.html](http://java.sun.com/docs/books/tutorial/networking/urls/readingWriting.html) )。这应该可以帮助你。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T19:35:38.670

如果您的 J2EE 应用程序部署在 PHP 脚本所在的同一台服务器上，您也可以像这样作为独立进程直接执行它：

```
 public String execPHP(String scriptName, String param) {
    try {
      String line;
      StringBuilder output = new StringBuilder();
      Process p = Runtime.getRuntime().exec("php " + scriptName + " " + param);
      BufferedReader input =
        new BufferedReader
          (new InputStreamReader(p.getInputStream()));
      while ((line = input.readLine()) != null) {
          output.append(line);
      }
      input.close();
    }
    catch (Exception err) {
      err.printStackTrace();
    }
    return output.toString();
  } 
```

您将支付创建和执行进程的开销，但不会在每次需要执行脚本时都创建网络连接。我认为根据输出的大小，一个会比另一个表现更好。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-17T20:50:00.567

如果您尝试通过 HTTP 运行它，我会推荐[Apache Commons HTTP 客户端](http://hc.apache.org/httpclient-3.x/) 库。它们使执行此类任务变得异常容易。例如：

```
 HttpClient http = new HttpClient();
    http.setParams(new HttpClientParams());
    http.setState(new HttpState());

    //For Get
    GetMethod get = new GetMethod("http://www.something.com/myscript?param="+paramVar);
    http.executeMethod(get);

    // For Post
    PostMethod post = new PostMethod("http://www.something.com/myscript");
    post.addParameter("param", paramVar);
    http.executeMethod(post); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-31T14:10:11.637

在相关说明中，如果您尝试从 java 程序执行 php 脚本，您可以参考以下代码

```
 Process p = Runtime.getRuntime().exec("php foo.php");

        p.waitFor();

        String line;

        BufferedReader error = new BufferedReader(new InputStreamReader(p.getErrorStream()));
        while((line = error.readLine()) != null){
            System.out.println(line);
        }
        error.close();

        BufferedReader input = new BufferedReader(new InputStreamReader(p.getInputStream()));
        while((line=input.readLine()) != null){
            System.out.println(line);

        }

        input.close();

        OutputStream outputStream = p.getOutputStream();
        PrintStream printStream = new PrintStream(outputStream);
        printStream.println();
        printStream.flush();
        printStream.close(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-07T07:14:31.017

我今天遇到了完全相同的问题。对我来说，有效的是使用 java.net.URLEncoder.encode 方法对 PHP 脚本参数进行 URLEncoding。

```
String sURL = "myURL";
String sParam="myparameters";
String sParam=java.net.URLEncoder.encode(sParam,"UTF-8");
String urlString=sURL + sParam;     
    HttpClient http = new HttpClient();
    try {
        http.getHttpResponse(urlString);
    } catch (AutomationException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }
    http=null; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-09-19T12:55:56.797

我遇到了类似的情况，我需要从 java 代码中调用 PHP 函数，我使用下面的代码来实现这一点。在下面的代码中，“/var/www/html/demo/demo.php”是 PHP 文件名，callToThisFunction() 是 PHP 函数名。希望这对某人有帮助。

```
public static void execPHP() {

        Process process = null;

        try {

            process = Runtime.getRuntime().exec(new String[]{"php", "-r", "require '/var/www/html/demo/demo.php'; callToThisFunction();"});

            process.waitFor();

            String line;

            BufferedReader errorReader = new BufferedReader(new InputStreamReader(process.getErrorStream()));

            while ((line = errorReader.readLine()) != null) {
                System.out.println(line);
            }

            errorReader.close();

            BufferedReader outputReader = new BufferedReader(new InputStreamReader(process.getInputStream()));

            while ((line = outputReader.readLine()) != null) {
                System.out.println(line);

            }

            outputReader.close();

        } catch (IOException e) {
            e.printStackTrace();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        OutputStream outputStream = process.getOutputStream();
        PrintStream printStream = new PrintStream(outputStream);
        printStream.println();
        printStream.flush();
        printStream.close();

    } 
```

# .net - 如何在 WPF 应用程序中读取标准输入？

> ID：655638
> 
> 赞同：2
> 
> 时间：2009-03-17T19:13:01.883
> 
> 标签：.net, wpf, stdin

我试图弄清楚如何从我自己的 WPF 应用程序的标准输入流中读取，但我找不到获取流的方法。标准的做法，

```
Console.ReadLine() 
```

立即返回 Null(Nothing)。我假设因为它不是控制台应用程序并且没有打开控制台窗口。如何在 WPF 应用程序中读取标准输入？

一些背景：我正在尝试读取由外部设备（磁卡读卡器）发送的文本，该设备将其数据发送到当前关注的应用程序的标准输入。如果需要，我可以将焦点放在 TextBox 上，然后从那里读取数据，但如果可能的话，我宁愿直接读取数据，以避免出现许多可能的问题。

**编辑**：尽管 Daniel Pratt 解决了我最初的问题，但弄清楚如何从标准输入中读取仍然会很好。如果您可以回答，我将更改已接受的答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T19:53:31.607

我的印象是这类设备通常用作键盘（这将使原始问题中有关 TextBox 的部分有意义）。我认为您只需要挂钩一些键盘事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-09-30T20:17:10.877

`Console.ReadLine()`在 WPF 应用程序中工作，至少当我尝试通过命令行管道时。也许 null 是由读卡器的驱动程序明确发送的（可能意味着什么）。

对于像我这样寻找一般方法的人来说，这是我所做的演示（假设 null 表示输入结束）：

1.  创建一个全新的“WPF 应用程序”项目。
2.  将此添加到`MainWindow`MainWindow.xaml.cs 中的构造函数：

    ```
    if (Console.In.Peek() != -1) // If there's input on the standard input stream.
    {
        var fullInput = new StringBuilder();
        var currentLine = string.Empty;
        while ((currentLine = Console.ReadLine()) != null)
            fullInput.AppendLine(currentLine);

        MessageBox.Show($"Input: {fullInput}");
    }
    else
        MessageBox.Show("No input detected on stdin"); 
    ```

3.  构建，并在有和没有从命令行输入字符串的情况下运行。

    *   无输入：

        ```
        c:\> WpfApplication1.exe 
        ```

        [![在此处输入图像描述](https://i.stack.imgur.com/dTvy4.png)](https://i.stack.imgur.com/dTvy4.png)

    *   有输入：

        ```
        c:\> echo "testing 1, 2, 3" | WpfApplication1.exe 
        ```

        [![在此处输入图像描述](https://i.stack.imgur.com/KrEy9.png)](https://i.stack.imgur.com/KrEy9.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T20:35:03.117

查看用于从 stdin/stdout 流读取/写入的 .NET 框架代码，看起来好像实际上没有任何依赖于控制台窗口。该代码似乎只是利用各种本机 Win32 调用，首先是 GetStdHandle 以获取标准输入/输出流的句柄，然后创建一个*__ConsoleStream*类，该类是 Win32 *ReadFileNative*和*WriteFileNative*函数的托管包装器。所以真的，我看不出有任何不应该工作的理由......当您将代码直接放在*Main*`Console.ReadLine`中时，值得检查使用*控制台从标准输入读取的调用是否成功**功能。我想这里的问题可能与 Windows 识别的应用程序类型有关，但我不明白为什么非控制台应用程序应该被限制从标准输入/写入到标准输出。另一个可能的原因可能是您从中进行调用的线程。不管怎样，去测试一下，让我知道结果。如果你仍然没有任何成功，我会尝试做一些我自己的测试，因为我对解决方案很好奇。*

 *# java - 休眠 什么时候最好用什么？

> ID：655639
> 
> 赞同：0
> 
> 时间：2009-03-17T19:14:16.530
> 
> 标签：java, database, hibernate

我对 Hibernate 比较陌生。在此之前我使用了 Persistence 和 Toplink，但在学习 Hib 时并没有太大帮助。当我定义我的实体类，特别是 id 属性时，我发现自己不知道要使用哪些值。显然，不同的情况需要不同的价值观。其中一些值是什么意思，哪些是最常用的？就像说我有一个支持排序的 oracle 数据库......那我会使用什么选择？或者当它提到在非集群环境中使用“身份”值时，这是什么意思？集群数据库还是集群应用服务器？很多hibernate使用的语言似乎很笼统？或者我只是一个菜鸟：-p 谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T21:15:55.140

如果您想要一些简单的东西，并且可以在不同的数据库引擎之间移植，请选择**本机。**

[休眠文档 5.1.4.1。发电机](http://www.hibernate.org/hib_docs/reference/en/html/mapping.html#mapping-declaration-id-generator)

# multithreading - 多线程客户端-服务器 Web 服务 - 使服务器端数据线程安全

> ID：655649
> 
> 赞同：2
> 
> 时间：2009-03-17T19:17:31.450
> 
> 标签：multithreading, dom, soap, client-server, tcp

我正在实现一个多线程 Web 服务。每个传入请求都会产生一个线程。对于每个客户端，都会创建一个会话，并且每个会话都包含一个数据部分——比如一个 DOM 树。客户端请求基本上是 get/set 方法，服务器将读取/写入 DOM。

所以 DOM 数据是每个客户端的。

现在我的问题是，服务器是否应该将此 DOM 树视为关键部分？

基本上问题是是否存在服务器有两个线程为同一个客户端服务的情况？

请求/响应是 SOAP over tcp。据我了解，即使客户端是多线程的，tcp 客户端也无法同时发送请求。所以在服务器端，我不会遇到两个线程用于同一个客户端的情况。如果我错了，请纠正我，我是 tcp/ip 客户端-服务器编程的新手。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T21:09:53.640

> 据我了解，即使客户端是多线程的，tcp 客户端也无法同时发送请求。

?? 那个是从哪里来的？

在当然是基于 TCP 的 HTTP 中，需要并发的客户端请求。RFC2616 说 HTTP 客户端（浏览器、REST 客户端等）*应该*限制对特定服务器的并发出站请求数为 2。但这不是协议的硬性要求，有时在某些情况下故意不遵循该指南架构。

我提出这个只是为了说明 TCP 本身支持客户端的多个并发出站请求。在一般情况下，一个 TCP 客户端可以打开许多并发的出站请求。

您使用的特定通信框架可能不支持客户端的多个并发出站请求。但那是另一回事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T19:31:30.120

您需要使用服务器的文档进行检查。高级服务器很可能允许您配置请求处理策略（例如，顺序、每个连接的线程、每个请求的线程、线程池等）。

如果客户端是多线程的，恐怕客户端**可以同时发送请求。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T19:28:41.340

您应该考虑到每个请求的线程对于更高的请求率不会很好地扩展，您将失去大部分时间进行线程切换

# c++ - 如何使用 SDL 用 C++ 编写 RPG 游戏？

> ID：655650
> 
> 赞同：1
> 
> 时间：2009-03-17T19:18:18.627
> 
> 标签：c++, sdl

我想知道如何使用 SDL 用 C++ 编写 2D RPG 游戏。

我已经搜索过，但找不到任何好的东西。很多文章太基础了，没有深入研究任何实用的东西。谁能帮我提供一些文章、免费书籍或其他资源，以便我可以学习如何使用 C++ 和 SDL 编写 RPG？

编辑：

我不需要 SDL 的文档。我正在使用 SDL 编写一个 RPG 游戏，我需要一些示例来帮助我完成这项任务。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T19:30:12.820

您是否有过于简单的文章示例？

这些是不是太简单了：[devshed](http://www.devshed.com/c/a/Multimedia/Game-Programming-using-SDL-Getting-Started/)或[gpwiki](http://gpwiki.org/index.php/C:SDL_tutorials)？

您可以考虑单独研究这些主题。例如，Bruce Eckels 拥有，IMO，最好的 C++ 书籍，“Thinking in C++ I & II”，它将带你从新手到专家（包括像单元测试这样的 SQA 技术），它们是[免费提供的。](http://www.mindview.net/Books/TICPP/ThinkingInCPP2e.html)

我发现 C++ 是一个苛刻的情妇，如果你没有为这门语言做好准备，那么没有专门针对“SDL 和游戏”的教程会有很大帮助——对于任何其他高级库、工具包等来说都是如此。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T19:31:54.500

编写 RPG 游戏与编写任何其他游戏没有什么不同。

如果您了解 RPG 并且您对自己想要做什么有一个完整的想法，那么您将使用与在任何游戏中工作相同的技术。

谷歌是你的朋友，用它来做研究以获得你需要的技能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T19:30:08.123

你试过[gamedev.net](http://gamedev.net)吗？他们有针对所有能力水平的文章和教程，以及充满乐于助人的活跃论坛。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T19:29:47.297

[http://www.libsdl.org/intro.en/toc.html](http://www.libsdl.org/intro.en/toc.html)

[http://www.libsdl.org/tutorials.php](http://www.libsdl.org/tutorials.php)

[http://www.libsdl.org/articles.php](http://www.libsdl.org/articles.php)

[http://www.libsdl.org/books.php](http://www.libsdl.org/books.php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-26T02:55:02.890

[您可以在此处](http://www.brighthub.com/hubfolio/matthew-casperson/blog/archive/2009/11/22/create-your-own-flash-adventure-game.aspx)找到向您展示如何使用 ActionScript 创建冒险游戏的教程。虽然它与 SDL/C++ 无关，但一般概念应该很容易移植，或者至少让您知道从哪里开始。

![替代文字](https://farm3.static.flickr.com/2771/4135076196_3f24dddfce_m.jpg)

# apache-flex - Flex 中的 Comet 实现示例

> ID：655651
> 
> 赞同：-1
> 
> 时间：2009-03-17T19:18:37.813
> 
> 标签：apache-flex, streaming, comet

我正在寻找一个示例，说明如何从 Flex/Actionscript 到支持 Comet 的 Java 服务器进行长时间运行的 HTTP 调用。长时间运行的 http 调用通常用于将数据从服务器推送到客户端，我想用于将数据“流式传输”到客户端，例如大表的数据。在调用完成之前，客户端应该已经显示了一些数据。我知道 Adob​​e 的 LCDS 支持这一点，但我对可以直接使用 HTTP 获取数据的低级实现感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T19:34:54.367

嗯......有一个[名为“flexcomet”的 googlecode 项目](http://code.google.com/p/flexcomet/source/checkout)，声称是[Bayeux 协议](http://svn.cometd.org/trunk/bayeux/bayeux.html)的实现。我自己根本没有玩过这个......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T19:37:06.797

我不知道 Blaze 是否使用 LCDS，但 Blaze 有能力做 COMET：

> 通过 HTTP 发布和订阅消息 使用 HTTP 流或长轮询 (COMET) 实时发布和订阅消息主题，具有与传统胖客户端应用程序相同的可靠性和整体服务质量，从而能够创建创新和协作的实时体验.
> 
> 消息传递和实时基础架构使用本机 Web 协议，可以在使用本机 Web 协议的同时以可靠的方式构建协作和数据推送应用程序，每个 CPU 可扩展到数百个客户端。实时示例包括性能监控、实时新闻提要和事件跟踪。协作示例包括聊天、辅助销售、实时帮助和引导式自助服务。

（来自[http://labs.adobe.com/wiki/index.php/BlazeDS:Release_Notes](http://labs.adobe.com/wiki/index.php/BlazeDS:Release_Notes)）

您可以下载包含示例应用程序的交钥匙发行版，以查看 Blaze 是否能满足您的需求。

[http://opensource.adobe.com/wiki/display/blazeds/Release+Builds](http://opensource.adobe.com/wiki/display/blazeds/Release+Builds)

# iphone - UINavigationController 与 UITableView 和 UIView

> ID：655653
> 
> 赞同：1
> 
> 时间：2009-03-17T19:20:08.590
> 
> 标签：iphone, cocoa-touch, uitableview, uiviewcontroller

我希望能够在父视图中的 UITableView 和标准 UIView 之间切换。基本上我有一个 UITableView 显示加载显示信息日志。我想在窗口的标题中有一个段控件，当用户点击时，它会转换到一个标准 UIView 的图形视图。

有问题的 UIViewController 需要能够从 RootViewController 堆栈中推送。

我已经尝试了很多事情，但我似乎无法让它发挥作用。有没有人有关于如何做到这一点的任何代码示例或建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T19:36:48.217

听起来您应该有一个包含段控件和子视图空间的父视图。当用户选择一个段时，您可以将相关视图（表格或图形）添加为视图的子视图，并设置其矩形以使其占据子区域。

```
-----------
| Segment |
-----------
|         |
|         |
|  Child  |
|         |
----------- 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-16T23:12:10.903

您根本不需要更改 UIViewController 即可在导航控制器中显示它。您的分段控制器应调用执行以下代码的方法：

```
UIViewController *myViewController = [[UIViewController alloc] init];
[self.navigationController pushViewController:myViewController animated:YES];
[myViewController release]; 
```

我没有指向示例的链接，但如有必要，我可以回答更多问题。

-画

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-21T21:10:42.187

它实际上并不像最初看起来那么困难。基本上，如果您有一个带有空白视图的 ParentViewController 和顶部的 NavController。将段控件放置在 NavController 的中心视图中。

然后，您只需在段控制更改时切换 ViewController 视图。您唯一需要做的就是保留指向当前视图的指针并在将新视图添加到 parentVC 之前将其删除。下面的代码：

```
- (void)showView
{
    if (_currentView != nil)
        [_currentView removeFromSuperview];

    if (segmentControl.selectedSegmentIndex == 0)
    {
        if (_graph == nil)
            _graph = [[DrawGraphViewController alloc] initWithNibName:@"DrawGraphViewController" bundle:[NSBundle mainBundle]]; 

        self.navigationItem.rightBarButtonItem = nil;
        _currentView = _graph.view;

        [contentView addSubview:_graph.view];
        [_graph reloadGraph];
    }
    else if (segmentControl.selectedSegmentIndex == 1)
    {   
        if (_log == nil)
            _log = [[LogTableViewController alloc] initWithNibName:@"LogTableView" bundle:[NSBundle mainBundle]];

        self.navigationItem.rightBarButtonItem = self.editButtonItem;
        _currentView = _log.view;
        [contentView addSubview:_log.view];
        [_log loadData];
    }   
    else {
        if (_export == nil)
            _export = [[ExportViewController alloc] initWithNibName:@"ExportView" bundle:[NSBundle mainBundle]];

        _currentView = _export.view;
        [contentView addSubview:_export.view];
    }
} 
```

# c# - (0 == variable) 或 (null == obj)：C# 中过时的做法？

> ID：655657
> 
> 赞同：8
> 
> 时间：2009-03-17T19:20:18.637
> 
> 标签：c#, .net, coding-style

### 完全重复：

> [为什么在 C# 中经常看到“null != variable”而不是“variable != null”？](https://stackoverflow.com/questions/271561/why-does-one-often-see-null-variable-instead-of-variable-null-in-c)

我见过高级开发人员使用标题中提到的语法。

是否需要在 .NET 中首先指定一个常量？（与 C/C++ 世界相反）

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-17T19:23:09.660

不，没有必要这样做，因为它试图避免的问题 - 即错字：

```
if (variable = 0) 
```

无论如何都不会在 C# 中编译。语句中的条件`if`必须是布尔值。仍然存在犯以下错误之一的风险：

```
if (something = true)
if (something = false) 
```

if`something`是一个布尔变量，但解决此问题的更好方法是避免使用常量：

```
if (something)
if (!something) 
```

如果您有开发人员从其他语言中引入类似这样的惯用语，而不考虑它们是否适用于 C#，您应该留意他们是否会做更多相同的事情。如果您尝试编写 C#，就好像它是 C++（或任何其他语言，几乎是 VB.NET 除外），您最终会编写非惯用的 C# 代码。

编辑：正如 cletus 所指出的，还有*另一个*潜在的关注领域：

```
bool a = false, b = true; 
if (a = b) { } // No warnings 
```

所以错误仍然可能发生 - 但无论如何我们都超出了与常量进行比较的范围:) 我会说这种情况非常罕见，不值得花太多时间担心它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T19:28:59.297

在现代世界中不需要这种语法。当我们的 C 编译器不会警告我们即将发射导弹时，我们中的许多人都会养成这种习惯。

```
if(status = RED_ALERT)
{
    launchMissiles();
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T19:23:51.827

我怀疑这是一个遗留的习惯。在 C 中：

```
 if (0 = variable) 
```

将引发编译器错误，而

```
 if (variable = 0) 
```

将不会。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T19:35:53.163

*C#*不需要它。但这仍然是一个好主意。

编程是关于习惯的，你永远不知道什么时候会发现自己在编写一些 JavaScript 或更新你认为早已不复存在的旧程序。

# python - 为什么 wx.SingleChoiceDialog 没有正确子类化

> ID：655662
> 
> 赞同：4
> 
> 时间：2009-03-17T19:21:40.180
> 
> 标签：python, oop, wxpython, subclass

我正在尝试继承 wxpython SingleChoiceDialog 类。我有一个 TableChoiceDialog 类，它继承自 SingleChoiceDialog 添加通用功能，并且我有 2 个子类用于添加更精细的功能。基本上我在 OOP'ing

在我的 TableChoiceDialog 类中，我有一行调用超类`__init__`，即

```
class TableChoiceDialog(wx.SingleChoiceDialog):
    def __init__(self, parent, message, caption, list, ...other args...):
        wx.SingleChoiceDialog.__init__(self, parent, message, caption, list) 
```

我遇到的问题是，根据`SingleChoiceDialog.__init__`文档字符串（和 wxPython API），SingleChoiceDialog 没有 self 参数作为其`__init__`方法的一部分。

```
 __init__(Window parent, String message, String caption,
        List choices=EmptyList, long style=CHOICEDLG_STYLE,
        Point pos=DefaultPosition) -> SingleChoiceDialog 
```

正如我上面所说，程序会打印错误：

```
swig/python detected a memory leak of type 'wxSingleChoiceDialog *', no destructor found. 
```

如果我取出 self 参数，系统会抱怨它期望一个`SingleChoiceDialog`对象作为第一个参数，这似乎表明它实际上想要一个对 self 的引用。

当我取出 parent 参数时，留下 self （以及我很确定的其他 3 个参数）系统抱怨它只收到 3 个参数，而它需要 4 个参数。我很确定我通过了 4 个。

所以。我犯了什么明显的错误？我是否完全误解了 python 如何处理对象（因此几乎误解了 python）？我是否误解了整个 OOP？

请帮忙。提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T20:10:21.863

1.  调用`__init__`似乎没问题（第一个参数`__init__`总是`self`）。
2.  您可能有错误的`wx`. swig 的警告消息表明没有为 生成析构函数`wxSingleChoiceDialog`，请参阅[此内存泄漏讨论](http://lists.osafoundation.org/pipermail/pyicu-dev/2006-March/000040.html)。

该消息可能与`__init__`呼叫无关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-15T11:48:01.243

wxPython 中的一些对话框是不可子类化的，因为它们不是真正的类，而是用于显示对话框的平台 API 方法的包装器。我知道对于 的情况是这样，对于 的情况`wx.MessageDialog`也可能是这样`wx.SingleChoiceDialog`。

# sql - 在Sql Server中，如何将二进制字符串转换为二进制？

> ID：655680
> 
> 赞同：5
> 
> 时间：2009-03-17T19:31:04.690
> 
> 标签：sql, sql-server, string, binary

我有一些字符串格式的数据代表二进制数据（例如'0x0002'）。是否有一些功能或技巧可以将它们从文字字符串转换为二进制？也就是说，我希望 '0x0002' 变为 0x0002，而 SELECT CAST('0x0002' AS BINARY(20)) 显然不会那样做。我确实提出了一些非常缓慢的过程，包括构建 SQL 语句并将它们分配给一个变量并执行它（例如“EXEC（@Query）”），但我正在寻找一些我不需要做的事情那。

如果有帮助，这里有一个示例表，您可以在上面进行测试：

```
CREATE TABLE #T (BinaryString VARCHAR(100))
INSERT INTO #T VALUES('0x0000000000000000000000000000000000000002') -- Binary = the integer 2
INSERT INTO #T VALUES('0x000000000000000000000000000000000000007B') -- Binary = the integer 123 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T19:48:43.103

[旧代码，SQL 7，sp_hexadecimal](http://support.microsoft.com/kb/104829)

[SQL 2005（可能 + 2000），master.dbo.fn_varbintohexstr](http://decipherinfosys.wordpress.com/2008/06/11/converting-a-hex-string-to-a-varbinary-or-vice-versa/)

[SQL 2008，本机](http://decipherinfosys.wordpress.com/2008/07/31/sql-server-2008-converting-binary-and-character-values/)

# html - ihttp 是合法协议吗？

> ID：655686
> 
> 赞同：1
> 
> 时间：2009-03-17T19:34:12.170
> 
> 标签：html, protocols

如果是这样，它有什么作用？

我在一个前同事写的一些 html 中注意到了它（所以我不能问作者）。我猜这是一个错字，除了它在几个不同的模板中的几个不同的地方，用作图像的源属性。

例如：

`<IMG height="6" src="ihttp://www.ourdomain.com/images/f2f3f4.gif" width="5">`

谷歌排名靠前的结果指向某种 apache/php/mysql 安装程序，但我们正在运行 IIS，所以我无法想象这是相关的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T19:36:53.147

**错字**。而已。

不存在这样的协议。您所看到的是一种经典的设计模式，称为*剪切和粘贴*。如果我不得不猜测，我会说那`i`是以前的领先`i`。`images/f2f3f4.gif`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-11T16:20:13.077

这是故意使用的`ihttp://`——http [://blog.instapaper.com/post/1538890633](http://blog.instapaper.com/post/1538890633)

（我在谷歌搜索时发现了这个线程。我还没有找到答案。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T19:39:26.573

它是一个错字和一个错误 - 你很幸运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-27T02:29:40.083

ihttp 是一个主要由 Asp.net 使用的新协议。它用于动态生成网页。随着网页的开发，尝试查看 asp.net 的调用堆栈。

# php - PHP: PEAR: 用 Crypt_CBC 加密，用 Perl 的 CBC 解密

> ID：655691
> 
> 赞同：4
> 
> 时间：2009-03-17T19:36:45.313
> 
> 标签：php, perl, encryption

我必须做的其中一项任务需要我从 PHP 端加密一些东西，然后用 Perl 解密它。

我发现似乎适合我需要的[PEAR模块是 Crypt_CBC。](http://pear.php.net)但是，一定有我做错或不理解的地方，因为到目前为止我一直无法获得正确的结果。

下面的代码摘录专门用于测试目的，因为我想在将其应用到我的实际项目代码之前尝试一下。

首先，这是我的 PHP 代码，我用它加密传递给 $text 参数的任何内容（即 cryptTest.php?text=hello）

```
require_once('Crypt/CBC.php');  

$key = "8326554161EB30EFBC6BF34CC3C832E7CF8135C1999603D4022C031FAEE";  
$cipher = new Crypt_CBC($key, 'BLOWFISH');

$encrypted = $cipher->encrypt($text);  

if (PEAR::isError($encrypted)) {  
    echo $encrypted->getMessage();  
} else {  
    echo "ENCRYPTED STRING: " . $encrypted;  
} 
```

从那时起，我复制从该脚本（在我的浏览器输出中）回显的任何内容，并将其粘贴到下面我的 PERL 脚本的 $encrypted 变量中：

```
use Crypt::CBC; 
$encrypted = "RandomIVá´bp3Ó¯làK”Á(Û";  
my $key = "8326554161EB30EFBC6BF34CC3C832E7CF8135C1999603D4022C031FAEE";  
my $vector = "\0\0\0\0\0\0\0\0";  

my $cipher = Crypt::CBC->new(  
                       {'key'             =>$key,  
                        'cipher'          => 'Blowfish',  
                        'iv'              => $vector,  
                        'prepend_iv'      => 0  
                       });  

my $plaintext = $cipher->decrypt($encrypted);

print $plaintext; 
```

我一直在尝试很多事情，比如没有在 Perl 端指定 IV 等，但它一直给我错误。这种形式是我得到任何输出的唯一形式。

执行上述结果，原始 $text = "hello" 是：Pñšîî7àÐŽZÊ&Rhello

我发现我的原始内容已正确解密，但并非没有在我想要的部分之前添加一堆废话字符。

谁能指出我做错了什么以及如何解决它？

谢谢一堆。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T16:34:12.500

我终于找到了解决我的问题的方法。

不过，感谢你们两个，您的回答确实有所帮助。我确实按照您的建议在 base64 中编码/解码，因此避免了任何纯文本编码问题。

为了使解密工作，我必须做的是在我的 Perl 脚本的密码创建中添加**'header' => 'randomiv'**，因为 PEAR 的 Crypt_CBC 类在加密时使用随机 IV。

[我在Crypt::CBC 的文档](http://search.cpan.org/%7Elds/Crypt-CBC-2.24/CBC.pm)中找到了该特定参数。

此外，直接查看 CBC.php 的解密函数，我发现它为确定 IV 所做的工作：获取标头的 ('RandomIV') 长度，并将其用作偏移量，以将加密字符串替换为*blocksize*值（默认为 8）。我还指定了*密钥大小*（默认为 56）以进行衡量。

为了完整起见和参考，以下是我更新的两个测试脚本：

### PHP (cryptTest.php):

```
require_once('Crypt/CBC.php');

$key = "8326554161EB30EFBC6BF34CC3C832E7CF8135C1999603D4022C031FAEE";  
$cipher = new Crypt_CBC($key, 'BLOWFISH');

$encrypted = $cipher->encrypt($text);

if (PEAR::isError($encrypted)) {  
    echo $encrypted->getMessage();  
} else {  
    echo "ENCRYPTED STRING: " . base64_encode($encrypted);  
} 
```

### PERL (decryptTest.pl)

```
use Crypt::CBC;  
use MIME::Base64;

my $encrypted = decode_base64("UmFuZG9tSVbrNE3ony00FlUbiprLn0fu");  
my $key = "8326554161EB30EFBC6BF34CC3C832E7CF8135C1999603D4022C031FAEE";  
my $header_spec = "randomiv";  
my $blocksize = 8;  
my $keysize = 56;  

my $iv_offset = length $header_spec;  
my $iv = substr $encrypted, $iv_offset, $blocksize;

my $cipher = Crypt::CBC->new(  
                {'key'        =>$key,  
                'cipher'        => 'Blowfish',  
                'iv'            => $iv,  
                'header'        => $header_spec,  
                'prepend_iv'    => $iv_offset,  
                'blocksize'  => $blocksize,  
                'keysize'      => $keysize   
                })  

my $plaintext = $cipher->decrypt($encrypted);

print $plaintext; 
```

你去吧。再次，非常感谢！

马修

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T19:50:01.553

CBC 不是容错的；密文的问题会破坏整个块。因此，您能够用一些额外的垃圾恢复纯文本这一事实表明问题出在填充上，而不是加密本身。

分组密码适用于完整的块。如果最后一个块不完整，则以允许接收者确定什么是填充以及什么是数据的方式对其进行填充。搜索 API 文档以了解如何处理填充。

如果可能，将解密后的明文转换为十六进制并发布，以使不可打印的字节可见。这可能会揭示 PHP 端使用的填充方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T10:03:57.400

您不应该使用加密例程的普通输出来执行此操作。您可能会遇到各种编码问题。我建议您对加密的字符串进行base64编码并复制并粘贴，然后在解密之前对其进行base64解码。

# .net - 数据访问层新手

> ID：655697
> 
> 赞同：0
> 
> 时间：2009-03-17T19:38:31.877
> 
> 标签：.net, linq-to-sql, dataset, data-access-layer

这里是 .NET 数据应用程序的新手，来自 Visual Foxpro 背景。

我正在计划一个 ASP.NET 和/或 Silverlight UI，也许还有一些 WPF 客户端的东西也在我们的 LAN 上，所以我想制作一个可以支持所有这些前端的数据访问层。

我的数据将在 SQL Server 中。我已经进行了将数据从 Foxpro 推送到 SQL Server 2005 的测试运行。它运行良好。这给了我一个可以使用的 SQL 服务器数据存储。

现在，这里是我迄今为止使用的数据工具，试图熟悉 .NET 数据访问：

1.  我玩过 Linq-To-Sql，并使用 L2S 中的类型化对象和集合制作了一个测试表单，然后填充了一些 WPF 列表视图和其他 UI 控件。那很酷。林克很酷！WPF 很酷。请参阅此处的表格截图：http: [//twitpic.com/26w26/full](http://twitpic.com/26w26/full)

2.  我玩过我猜你会称之为经典 ADO.Net 数据集的东西。伙计，数据集似乎需要做很多工作...... SQLConncetion 一个 SQLCommand 一个 DataSet 一个 TableAdapter

...最糟糕的是，我必须在引号内键入 SQL 代码，而 IDE 完全没有帮助来防止我输入错误，或者只编写简单错误的 SQL 代码，而且我必须知道来自我的数据表每次。错误的空间很大！和查询参数，呸。

那么，让我问一下…….NET 开发人员社区真的使用 SQLCmds、DataSets 和 DataTables 来读取和写入数据吗？它是这样工作的吗？

我知道所有关于 O/RM 之争的事情，还有 EF。

看起来您可以将任何 UI 控件从 ASP.NET/Silverlight/WPF/和 WinForms 连接到对象集合（通过 OR/M）或 DataSets/DataTables，对吗？它总是在这两者之一之间进行选择吗？

所以，现在是我做决定的时候了，但是，我不知道如何选择。它们似乎都可以工作，但是那个该死的 DataSet 东西对我来说似乎很可怕，但是，不知何故，它似​​乎也很常用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T20:00:12.340

首先，将数据获取到 SilverLight 的唯一方法是通过 WCF Web 服务。Silverlight 中不允许直接访问数据库（毕竟您是在浏览器中运行）

第二：（我会对此表示反对）数据集是邪恶的。直接生成恶魔。不惜一切代价避免，除非有人拿着枪指着你的头。问题之一是性能：没有。问题二是数据消耗：1k自动变成3k。对于桌面应用程序来说不是什么大问题，但对于 Web 应用程序来说却是个大问题。

第三：了解创建领域对象的含义。从那里您可以使用 EF 或 NHibernate。我更喜欢 NHibernate，但有一个学习曲线。一旦你有了一个好的域对象，你就可以将它传递给你列出的任何客户端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T19:52:46.993

我已经使用经典的旧 ADO.NET 很多年了，你只是习惯了它。对于更大的应用程序，您可以花一些时间创建一次数据层，然后将其与许多其他业务对象一起使用。

其他几个选项：

1.  强类型数据集。您可以创建一个强类型数据集，该数据集允许您拖放数据库对象并为您生成大量管道代码。

2 linq To Sql 设计器，它还允许您将对象拖放到设计器中，并生成用于连接和操作数据的 dbml 文件。

我最近加入了 Linq 潮流，当将数据视为对象时，它确实简化了您的生活。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T19:45:19.147

ADO.NET “Classic”（DataSet/DataTable API）没有任何问题，至少有一次，我决定使用它而不是 ORM。话虽如此，更经常使用 ADO.NET“经典”这一事实在很大程度上是历史的产物。长期以来，这是唯一可行的选择，尤其是如果您想坚持使用仅限 Microsoft 的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T19:50:01.070

使用数据集的人实际上使用 IDE 来创建强类型数据集。

使用它，您将拥有一个类似于 SQL Management Studio 的查询构建器的可视化查询构建器。这会生成带有参数的加载/保存等功能。

随处可见数据集的事实很大程度上是因为它是迄今为止唯一可用的解决方案，没有随处可见的手工编写 SQL。

如今，ORM 风靡一时，它们确实提供了一个非常好的抽象层。

# asp.net - 什么是 ASP.NET 最高效和高性能的日志记录解决方案？

> ID：655701
> 
> 赞同：1
> 
> 时间：2009-03-17T19:40:15.493
> 
> 标签：asp.net, logging, exception-logging

我想向我从以前的开发人员那里继承的 ASP.NET 2.0 网站添加日志记录。该应用程序只是在发生异常时吐出异常，并且没有已执行的金融交易记录。

我一直在研究我过去使用过的 Log4net，以及 NLog 和 BitFactory。我真正需要知道的是如何在我的应用程序中最好地实现日志记录框架，该应用程序在 SharePoint 中运行。我需要一些不会让应用程序陷入困境的东西。

ASP.NET 是否存在普遍接受的日志记录模式？您是如何在您的网站中实现登录的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T19:45:41.347

我在很多 ASP.NET 应用程序中使用的系统是[ELMAH](http://www.raboof.com/projects/Elmah/)（错误记录模块和处理程序）。不知道它是否会提供您想要的所有功能，但我真正喜欢它的是每当发生未处理的异常时通过电子邮件获取黄屏死机和堆栈跟踪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T19:53:02.203

你做的任何日志都会比不做日志要慢。日志记录与性能无关，它与可靠性和恢复有关。最好的日志框架是你虔诚地使用的，最差的是你不使用的。

我们在我们的应用程序中使用 log4net，没有抱怨，也从未回头。有什么我想调整的吗？当然。但是我们不从事日志业务，我们为客户编写应用程序，因此我们需要一个可靠的*日志系统，而 log4net 适合。

话虽如此，我们确实将调试日志包装在调试日志检查中。*只有在核心位置，*我们超越了典型的`if (log.isDebugEnabled)`检查，并在每个 if 语句上添加了我们自己的静态变量检查。在我们真正关心性能的模块的顶部（主要是我们的 ORM 或其他基础设施部分），我们有

```
#region Log4Net
const string c_EnableDebugLogging = "com.techsoftinc.BusinessObjectsCore.EnableDebugLogging";
static readonly bool _EnableDebugLogging = Convert.ToBoolean(ConfigurationManager.AppSettings[c_EnableDebugLogging] ?? "false");

static readonly log4net.ILog log = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);

//Do we support ultrafast logging? See What is REALLY the FASTEST way of (not) logging? in http://logging.apache.org/log4net/release/faq.html
static bool debugLogging
{
   get { return _EnableDebugLogging && log.IsDebugEnabled; }
}
#endregion 
```

然后当我们想要调试时，我们有（例如）

```
if (debugLogging)
   log.DebugFormat("Executing sql: {0}", sql); 
```

如果 _EnableDebugLogging 为假，那么 JIT 会将 debugLogging 函数折叠为 a `false`，然后删除整个`if (debugLogging)`语句，因为它永远不会为真。如果我们不需要它，JIT 实际上就是将我们的调试日志放在地上。

*reliable == 适用于我们遇到的所有情况。可靠并不意味着计算机科学意义上的真正可靠。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T19:47:32.043

我发现的最好的是 log4.net。我们使用它来记录未处理的错误和调试 ASP.NET。它很小，不会崩溃。我们在一个相当大的网站上使用它，我会再次使用它。

# c# - 执行无一例外地停止

> ID：655703
> 
> 赞同：1
> 
> 时间：2009-03-17T19:41:47.707
> 
> 标签：c#

我有一些代码可以使用在客户端计算机上运行的服务通过网络删除用户配置文件，如下所示：

```
public static void DeleteProfiles()
{
    ConsoleWrapper.WriteLine("We're in DeleteProfiles()");

    try
    {
        string[] users = GetUsers();
        ConsoleWrapper.WriteLine("Users gotten");

        if (users == null || users.Length == 0)
        {
            DeletingProfiles = false;
            ConsoleWrapper.WriteLine("Null or no user loaded");
            return;
        }

        DirectoryInfo oInfo = new DirectoryInfo("C:/Users");
        if (!oInfo.Exists)
            oInfo = new DirectoryInfo("C:/Documents and Settings");
        ConsoleWrapper.WriteLine("Profile folder gotten.");

        ConsoleWrapper.WriteLine("User Directory: " + oInfo.FullName);
        ConsoleWrapper.WriteLine("\nDirectories to be deleted:");

        DirectoryInfo[] SubDirectories = oInfo.GetDirectories();

        foreach (DirectoryInfo oSubDir in SubDirectories)
        {
            bool match = false;
            foreach (string user in users)
            {
                if (user == null)
                    continue;
                if (oSubDir.Name.ToLower() == user.ToLower())
                {
                    ConsoleWrapper.WriteLine("Matched: " + oSubDir.FullName);
                    match = true;
                    break;
                }
            }

            if (match)
                continue;
            try
            {
                ConsoleWrapper.WriteLine(oSubDir.FullName);
                DeletePath(oSubDir.FullName);
            }
            catch (Exception ex)
            {
                ConsoleWrapper.WriteLine(ex.StackTrace);
            }
        }
    }
    catch (Exception dirEx)
    {
        ConsoleWrapper.WriteLine(dirEx.Message);
    }
} 
```

ConsoleWrapper 中的 WriteLine 方法实际上将数据附加到 txt 文件，因为这是我能想到的在不同机器上调试的最简单方法。

当我在命令行应用程序中使用它时，这个确切的代码可以工作，但是当我尝试在 Windows 服务中使用它时，它只是写“我们在 DeleteProfiles() 中”。您会注意到，我已经捕获了所有“可捕获”异常，但我仍然不明白发生了什么。

所有客户端计算机都出现此问题，但它在我的台式机和笔记本电脑上都运行良好。我究竟做错了什么？

有关 DeletePath 代码，请参阅[http://www.vbdotnetforums.com/windows-services/16909-deletedirectory-throws-exception.html#post51470](http://www.vbdotnetforums.com/windows-services/16909-deletedirectory-throws-exception.html#post51470)。我实际上将其抬起并将其转换为 C# 代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T19:43:40.383

如果您捕获了每个可捕获的异常并且您没有在日志中看到条目，那么很可能抛出了一个**不可捕获**的异常。这通常采用 StackOverflowException 的形式。默认情况下，进程无法捕获此类异常。

如果 DeletePath 是递归函数，请尝试使其迭代并查看是否可以解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T19:47:39.500

您可能没有刷新 ConsoleWrapper。尝试在 finally 块中放入刷新，或打开自动刷新。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T19:48:02.933

GetUsers() 是做什么的？

可能需要很长时间吗？

您如何从服务中调用 DeleteProfiles()？

如果您直接从 ServiceBase.OnStart() 的覆盖调用 DeleteProfiles()，您需要知道 OnStart() 在 30 秒后超时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T22:59:10.680

服务需要额外的安全来与桌面交互。这里有一个安装程序可以为您提供：http: [//www.codeproject.com/KB/install/cswindowsservicedesktop.aspx](http://www.codeproject.com/KB/install/cswindowsservicedesktop.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T19:56:53.550

如果您无法弄清楚，请将[远程调试监视器](http://msdn.microsoft.com/en-us/library/y7f5zaaa.aspx)放在客户端上并附加到它。您可能必须将 Thread.Sleep() 放在您的方法之上，以便您有足够的时间在客户端的进程列表中找到服务进程，并在它实际运行时附加。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T20:07:44.243

从日志记录的角度来看，我会使用一个众所周知的库，例如 log4net 或 Microsoft 的 Logging Application Block。当您滚动自己的日志记录时，请确保调用 Flush() 以清除任何缓冲的写入。我发现 log4net 更容易合并到现有代码中，除非您已经是 Enterprise Library 商店。

# openid - OpenID 一定是电子商务的好选择吗？

> ID：655710
> 
> 赞同：11
> 
> 时间：2009-03-17T19:44:34.140
> 
> 标签：openid, e-commerce

作为单点登录的实现，我认为 OpenID 很棒。即便如此，它一定是电子商务的好选择吗？我知道它可以使用，但是应该吗？将一个人的所有访问详细信息放在一个篮子中是不是太冒险了？

外面的普遍看法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T11:44:09.507

当我在一家大型电子商务公司工作时，该公司研究了 OpenID。不要为此感到不安，但该公司拒绝了 OpenID，因为他们不喜欢实现的一些笨拙，并且他们发现在通过示例用户社区测试运行时，它实际上降低了注册率（用户社区讨厌它，但他们讨厌很多东西）。

底线：您绝对可以将它用于电子商务网站，但我会构建数据库以允许在必要时进行切换，并有办法确定它是否正在赢得或花费客户。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T22:36:30.483

取决于你的目标受众。

不太懂技术的人可能对 OpenID 非常陌生，这会提高您商店的门槛。一个实用的解决方案是同时提供传统身份验证和 openID 身份验证。

从技术上讲，OpenID 身份验证很容易实现，尤其是当您使用 Jboss Seam 之类的框架时。

编辑：另一个问题是将部分用户体验交到您的 openid 提供者手中。提供者并不都以相同的方式实现 OpenID 规范，因此您需要确保您不会仅使用一个来限制测试（例如，谷歌会根据您的应用程序的域返回不同的经过身份验证的 openid，而其他人则不会）。无法进行身份验证是用户将责怪您的网站而不是提供商的原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T21:25:17.927

就个人而言，没有。我不会以任何方式或形式将我的开放 ID 附加到我的银行账户中。

我对各种“垃圾”网站都使用开放 ID，我不相信他们会将我的详细信息保密或足够安全，不会让他们受到损害。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T19:52:08.460

问题实际上是它是否适合您的网站用户。一个一般的电子商务网站不太可能有很多用户已经安装了 OpenID，而 StackOverflow 的目标受众我猜至少 50% 的用户已经安装了 OpenID。

如果您有时间，那么肯定会为了那些有幸发现 OpenID 的人的利益而实施它：o）。但是，我还将为不关心 OpenID 的用户实施“标准”登录解决方案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T19:53:12.217

我认为将 OpenID 用于电子商务应用程序可能会产生一些非常积极的广泛影响。能够为您的所有在线购物使用相同的登录名（尽管这本身可能是一个小的安全风险）的想法使得其他人有可能出现并制作应用程序，这些应用程序将获取您的 OpenID 并向您呈现“您所有商店（亚马逊、百思买、eBay 等都在一个位置）的市场”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T19:50:09.340

伊莫为什么不呢？

但这有点取决于登录用户有什么选项。如果他们可以取消订单，将信用卡详细信息保留在个人资料中，下订单而不立即付款，等等。

那么你应该更加小心，但如果它就像其他电子商务网站一样，记住篮子里的东西，跟踪订单状态等等。

然后 id 个人不喜欢记住另一个用户和密码..

无论如何，用户倾向于在任何地方使用相同的密码，如果是这样，为什么不使用相同的服务进行登录:)？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-18T22:05:46.490

我正在努力解决这个版本问题。实施很容易，对于没有或想要使用 openid 的人，您肯定需要一个常规帐户系统。

我真正担心的是用户端可能出现的混淆，在另一个站点上使用一个站点的登录名并不常见、不被理解或不被信任。如果您使用它，它可以很好地工作，但只是要求某人输入他们现有的密码可能看起来像一个骗局。大多数启用 OpenID 的网站都是基于博客和信息的，而不是电子商务。我认为当涉及到他们的信用卡和个人信息时，人们更关心安全。

到目前为止，我发现电子商务中唯一提供 OpenID 登录的大牌是 sears.com / kmart.com，有人知道其他的吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T19:49:47.170

为什么不？重要的是，您为用户提供了使用两种方式进行身份验证的可能性。

例如，在 Stack Overflow 中，我使用 google 进行身份验证，我认为这是一种非常方便快捷的方式。但是，如果有足够多的人（叹气）不想向单个 Openid 提供者提供太多信息，如果您留下使用自定义注册和身份验证的可能性，他们应该会感到满意。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-19T13:02:34.490

有趣的是，我只是尝试使用我的谷歌“openid”登录这里并得到一个错误（即使我实际上是被允许/登录的，但我看到了一个错误页面）。

我想知道的是，当用户使用 openid 登录 e-comm 站点时会发生什么......站点管理员是否仍然知道用户的所有详细信息？

换句话说，openid 登录 = 网站所有者没有任何用户数据吗？或者是否创建了一个用户可以填写个人详细信息的帐户。

# asp.net - 更改视图状态的名称

> ID：655715
> 
> 赞同：0
> 
> 时间：2009-03-17T19:45:08.883
> 
> 标签：asp.net, viewstate

我有两个 ASP.NET 表单位于同一页面中。我遇到了一些问题，因为下面的隐藏字段具有相同的名称和 ID。

有什么方法可以为其中一种形式更改这些吗？（它们也不是验证的最佳选择）。

我需要视图状态提供的服务，但也许我可以在表单级别禁用它，并在较低（控制）级别使用它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T19:47:35.397

`runat="server"`这不是您想听到的，但在 ASP.Net 中，您应该每页只有一个表单。否则，这只是您将遇到的许多其他问题中的第一个。

# perl - 如何从 Perl 的 STDOUT 中取消别名？

> ID：655719
> 
> 赞同：2
> 
> 时间：2009-03-17T19:45:41.550
> 
> 标签：perl

当我运行这个：

```
open FP, ">xyz";

my $file = *FP;

printf $file "first\n";

$file = *STDOUT;

printf $file "second\n";

open $file, ">abc";

print $file "third\n";

print STDOUT "fourth\n";

print FP "fifth\n"; 
```

“第四个”打印不转到 STDOUT，而是转到“abc”。

STDOUT 与 FP 不同，FP 的行为符合预期。

我究竟做错了什么？我不明白什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-17T20:00:46.863

好吧，对于初学者来说，您错误地使用了“打开”。

```
open my $fp , '>', 'xyz' ; 
```

是推荐的语法。

强烈建议您不要使用裸露的“FP”，因为它不是词汇。

其次，您将文件指针作为新事物重新打开。这不是很好的做法，它不应该是一个问题，但它只是一个坏主意。您应该关闭文件指针或让它超出范围（通过词法）。

第三，'*STDOUT' 是一个参考。

```
my $fh = *STDOUT; 
print "$fh\n";   #prints  '*main::STDOUT'; 
```

所以当你这样做时：

```
open $fh, '>abc'; 
```

你正在做的

```
open *STDOUT, '>abc'; 
```

如果你之后立即这样做

```
print "$fh\n"; 
```

你会注意到它仍然打印`*main::STDOUT`；

一些有趣的代码片段可以解决这个问题：

```
my $fh = *STDOUT;
open $fh, '<', "foo.txt"; 
print $fh "hello";
# Filehandle STDOUT opened only for input at (eval 288) line 6.

my $fh = *STDIN;
open $fh, '<', "foo.txt"; 
print <>; 
# contents of foo.txt here 
```

以下是使用 open 的推荐方法：

```
sub foo { 
    my $fh;
    open $fh , '<', 'file.txt' or Carp::croak('Cannot Open File.txt'); 
    # do stuff with $fh; 
    close $fh or Carp::carp('Something annoying in close :S '); 
} 
```

请注意，如果您省略 close，则文件将在 $fh 不可见时立即关闭。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T20:06:31.110

如果我了解您要做什么，我认为您想使用[`select`](http://perldoc.perl.org/functions/select.html). 它允许您轻松地在文件句柄之间切换。您还应该使用更现代的 open 形式（3 个参数、词法文件句柄和错误检查）。见[`perldoc perlopentut`](http://perldoc.perl.org/perlopentut.html)。

```
#!/usr/bin/env perl
use strict;
use warnings;

open my $fh,  '>', 'abc' or die "Can't open 'abc': $!";
open my $fh2, '>', 'def' or die "Can't open 'def': $!";
open my $fh3, '>', 'xyz' or die "Can't open 'xyz': $!";

select $fh;
print "First\n";

# Later
select $fh2;
print "Second\n";

# Later
select $fh3;
print "Third\n";

# Later
select STDOUT;
print "Fourth\n"; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T20:01:38.717

您需要保存 STDOUT 以便恢复它。这是来自... perldoc for [open](http://perldoc.perl.org/functions/open.html)：

这是一个使用各种方法保存、重定向和恢复 STDOUT 和 STDERR 的脚本：

```
#!/usr/bin/perl
open my $oldout, ">&STDOUT"     or die "Can't dup STDOUT: $!";
open OLDERR,     ">&", \*STDERR or die "Can't dup STDERR: $!";

open STDOUT, '>', "foo.out" or die "Can't redirect STDOUT: $!";
open STDERR, ">&STDOUT"     or die "Can't dup STDOUT: $!";

select STDERR; $| = 1;  # make unbuffered
select STDOUT; $| = 1;  # make unbuffered

print STDOUT "stdout 1\n";  # this works for
print STDERR "stderr 1\n";  # subprocesses too

open STDOUT, ">&", $oldout or die "Can't dup \$oldout: $!";
open STDERR, ">&OLDERR"    or die "Can't dup OLDERR: $!";

print STDOUT "stdout 2\n";
print STDERR "stderr 2\n"; 
```

看看“或死”部分。您应该始终测试打开的错误...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T21:21:17.047

本地化 STDOUT。然后，您可以在有限的动态范围内为其设置别名。一旦您离开该范围，STDOUT 将恢复正常。

```
use strict;
use warnings;

print_stuff('Normal STDOUT');

{   local *STDOUT;
    open( STDOUT, '>', 'out' ) 
         or die "Can't redirect STDOUT: $!";
    local $| = 1;  # Unbuffer handle. 
                   # Do this AFTER redirecting STDOUT.

    print_stuff('Aliased to out');

    sleep 10;
} 

print_stuff('Back to normal STDOUT');

sub print_stuff {
    print join "\n", @_, '';
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T20:00:28.003

当您确实**打开 $file, ">abc"**时，您从根本上操作的是 STDOUT 的文件描述符，您现在已将其重新打开到不同的目标。**也就是说，当您执行该操作时**，您的两个别名都在一个正在被重新利用的基础资源上运行，而与用于引用它的别名无关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T21:48:30.507

如果我只想在短时间内使用文件句柄，我会将它放在一个匿名块中。这会自动限制任何非全局变量的范围。

```
{
  open my $fh, '>', 'abc';
  print $fh "assorted data";
  close $fh;
} 
```

作为一个额外的好处，您甚至不需要有 ' `close $fh;`' 行，因为它会在变量超出范围时自动关闭。

如果您打算使用这种技术，您应该始终将在代码块内修改的所有全局变量本地化。

```
{
  local *FH;
  open FH, '>', 'abc';
  print FH "assorted data";
  close FH;
} 
```

# .net - 什么是日期时间2？

> ID：655745
> 
> 赞同：27
> 
> 时间：2009-03-17T19:50:46.653
> 
> 标签：.net, sql, entity-framework, sql-server-2008, c#-3.0

我在 MSSQL 2008 的 INSERT 语句中得到了这个

> System.Data.SqlClient.SqlException：将 datetime2 数据类型转换为 datetime 数据类型导致值超出范围。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-17T19:57:20.273

SQLServer 的 datetime 数据类型的允许值范围比 .net datetime 数据类型小得多。SQLServer 的 datetime 类型基本支持公历，所以你可以拥有的最小值是 1/1/1753。2008 年，SQLServer 添加了一个 datetime2 数据类型，支持回溯到第 1 年（没有第 0 年）。听起来您正在尝试将 1753 年 1 月 1 日之前的日期时间值插入到日期时间（不是 datetime2）SQLServer 列中

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-17T19:54:58.673

> 定义与基于 24 小时制的时间组合的日期。datetime2 可以被认为是现有 datetime 类型的扩展，它具有更大的日期范围、更大的默认小数精度和可选的用户指定精度。

[http://technet.microsoft.com/en-us/library/bb677335.aspx](http://technet.microsoft.com/en-us/library/bb677335.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T19:56:48.853

来自[技术网](http://technet.microsoft.com/en-us/library/bb677335.aspx)：

> 定义与基于 24 小时制的时间组合的日期。datetime2 可以被认为是现有 datetime 类型的扩展，它具有更大的日期范围、更大的默认小数精度和可选的用户指定精度。

我不得不检查，因为我认为`datetime2`与`varchar2`. 显然，根本没有任何关系。

输入您的代码，以便我们猜测导致问题的原因。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T20:00:06.257

可能是您的数据库表有一个“DATETIME”或“SMALLDATETIME”列，而您正试图插入一个超出范围的日期？DATETIME 涵盖 1753-1-1 到 9999-12-31，而 SMALLDATETIME 仅涵盖 1900-1-1 到 2079-6-6。

新的 SQL Server 2008 DATETIME2 数据类型将涵盖 0001-1-1 到 9999-12-31。

马克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-05T10:30:43.720

当我的数据库列被创建为 NOT NULL 并且我在我的 ADO.Entity 框架 EntityType 中的 DateTime 属性上专门指定了 Nullable = true 时，我收到了这个错误。

为了解决它，我使 Nullable 属性 = (None)

# html - 是否有一个 JDK 类来进行 HTML 编码（但不是 URL 编码）？

> ID：655746
> 
> 赞同：32
> 
> 时间：2009-03-17T19:50:47.230
> 
> 标签：html, java, html-encode

我当然熟悉`java.net.URLEncoder`and`java.net.URLDecoder`类。但是，我只需要 HTML 样式的编码。（我不想`' '`替换为`'+'`等）。我不知道任何只做 HTML 编码的 JDK 内置类。有吗？我知道其他选择（例如[Jakarta Commons Lang 'StringEscapeUtils'](http://commons.apache.org/lang/api/org/apache/commons/lang3/StringEscapeUtils.html "Jakarta Commons Lang 'StringEscapeUtils'")，但我不想在我需要的项目中添加另一个外部依赖项。

我希望最近的 JDK（又名 5 或 6）中添加了一些我不知道的东西。否则我必须自己动手。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-03-17T21:52:33.397

没有内置的 JDK 类来执行此操作，但它是 Jakarta commons-lang 库的一部分。

```
String escaped = StringEscapeUtils.escapeHtml3(stringToEscape);
String escaped = StringEscapeUtils.escapeHtml4(stringToEscape); 
```

查看[JavaDoc](http://commons.apache.org/proper/commons-lang/javadocs/api-3.1/org/apache/commons/lang3/StringEscapeUtils.html#escapeHtml4(java.lang.String))

添加依赖项通常就像将 jar 放到某个地方一样简单，并且 commons-lang 有很多有用的实用程序，因此通常值得将其加入。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-01-12T15:53:33.030

一种简单的方法似乎是这样的：

```
/**
 * HTML encode of UTF8 string i.e. symbols with code more than 127 aren't encoded
 * Use Apache Commons Text StringEscapeUtils if it is possible
 *
 * <pre>
 * escapeHtml("\tIt's timeto hack & fun\r<script>alert(\"PWNED\")</script>")
 *    .equals("&#9;It&#39;s time to hack &amp; fun&#13;&lt;script&gt;alert(&quot;PWNED&quot;)&lt;/script&gt;")
 * </pre>
 */
public static String escapeHtml(String rawHtml) {
    int rawHtmlLength = rawHtml.length();
    // add 30% for additional encodings
    int capacity = (int) (rawHtmlLength * 1.3);
    StringBuilder sb = new StringBuilder(capacity);
    for (int i = 0; i < rawHtmlLength; i++) {
        char ch = rawHtml.charAt(i);
        if (ch == '<') {
            sb.append("&lt;");
        } else if (ch == '>') {
            sb.append("&gt;");
        } else if (ch == '"') {
            sb.append("&quot;");
        } else if (ch == '&') {
            sb.append("&amp;");
        } else if (ch < ' ' || ch == '\'') {
            // non printable ascii symbols escaped as numeric entity
            // single quote ' in html doesn't have &apos; so show it as numeric entity &#39;
            sb.append("&#").append((int)ch).append(';');
        } else {
            // any non ASCII char i.e. upper than 127 is still UTF
            sb.append(ch);
        }
    }
    return sb.toString();
} 
```

但是，如果您确实需要转义所有非 ASCII 符号，即您将以 7 位编码传输编码文本，则将最后一个 else 替换为：

```
 } else {
            // encode non ASCII characters if needed
            int c = (ch & 0xFFFF);
            if (c > 127) {
                sb.append("&#").append(c).append(';');
            } else {
                sb.append(ch);
            }
        } 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-09-09T16:27:54.367

显然，答案是“不”。不幸的是，在这种情况下，我不得不做一些事情并且**无法**为其添加新的外部依赖项——在短期内。我同意大家的观点，即使用 Commons Lang 是最好的长期解决方案。一旦我可以将新库添加到项目中，这就是我将采用的方法。

很遗憾，这种常用的东西不在 Java API 中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-05-22T20:08:14.510

我发现我审查过的所有现有解决方案（库）都存在以下一个或几个问题：

*   他们没有在 Javadoc 中准确地告诉您它们所替换的内容。
*   它们逃逸太多了……这使得 HTML 更难阅读。
*   它们不会记录返回值*何时*可以安全使用（安全用于 HTML 实体？用于 HTML 属性？等）
*   它们没有针对速度进行优化。
*   它们没有避免双重转义的功能（不要转义已经转义的内容）
*   他们将单引号替换为`&apos;` （错误！）

除此之外，我还遇到了无法引入外部库的问题，至少在没有一定数量的繁文缛节的情况下是这样。

所以，我推出了自己的。有罪的。

下面是它的样子，但最新版本总是可以在[这个 gist](https://gist.github.com/phansson/ac586b2b7594ec5c3cc6275ad078ba2b)中找到。

```
/**
 * HTML string utilities
 */
public class SafeHtml {

    /**
     * Escapes a string for use in an HTML entity or HTML attribute.
     * 
     * <p>
     * The returned value is always suitable for an HTML <i>entity</i> but only
     * suitable for an HTML <i>attribute</i> if the attribute value is inside
     * double quotes. In other words the method is not safe for use with HTML
     * attributes unless you put the value in double quotes like this:
     * <pre>
     *    &lt;div title="value-from-this-method" &gt; ....
     * </pre>
     * Putting attribute values in double quotes is always a good idea anyway.
     * 
     * <p>The following characters will be escaped:
     * <ul>
     *   <li>{@code &} (ampersand) -- replaced with {@code &amp;}</li>
     *   <li>{@code <} (less than) -- replaced with {@code &lt;}</li>
     *   <li>{@code >} (greater than) -- replaced with {@code &gt;}</li>
     *   <li>{@code "} (double quote) -- replaced with {@code &quot;}</li>
     *   <li>{@code '} (single quote) -- replaced with {@code &#39;}</li>
     *   <li>{@code /} (forward slash) -- replaced with {@code &#47;}</li>
     * </ul>
     * It is not necessary to escape more than this as long as the HTML page
     * <a href="https://en.wikipedia.org/wiki/Character_encodings_in_HTML">uses
     * a Unicode encoding</a>. (Most web pages uses UTF-8 which is also the HTML5
     * recommendation.). Escaping more than this makes the HTML much less readable.
     * 
     * @param s the string to make HTML safe
     * @param avoidDoubleEscape avoid double escaping, which means for example not 
     *     escaping {@code &lt;} one more time. Any sequence {@code &....;}, as explained in
     *     {@link #isHtmlCharEntityRef(java.lang.String, int) isHtmlCharEntityRef()}, will not be escaped.
     * 
     * @return a HTML safe string 
     */
    public static String htmlEscape(String s, boolean avoidDoubleEscape) {
        if (s == null || s.length() == 0) {
            return s;
        }
        StringBuilder sb = new StringBuilder(s.length()+16);
        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);
            switch (c) {
                case '&':
                    // Avoid double escaping if already escaped
                    if (avoidDoubleEscape && (isHtmlCharEntityRef(s, i))) {
                        sb.append('&');
                    } else {
                        sb.append("&amp;");
                    }
                    break;
                case '<':
                    sb.append("&lt;");
                    break;
                case '>':
                    sb.append("&gt;");
                    break;
                case '"':
                    sb.append("&quot;"); 
                    break;
                case '\'':
                    sb.append("&#39;"); 
                    break;
                case '/':
                    sb.append("&#47;"); 
                    break;
                default:
                    sb.append(c);
            }
        }
        return sb.toString();
  }

  /**
   * Checks if the value at {@code index} is a HTML entity reference. This
   * means any of :
   * <ul>
   *   <li>{@code &amp;} or {@code &lt;} or {@code &gt;} or {@code &quot;} </li>
   *   <li>A value of the form {@code &#dddd;} where {@code dddd} is a decimal value</li>
   *   <li>A value of the form {@code &#xhhhh;} where {@code hhhh} is a hexadecimal value</li>
   * </ul>
   * @param str the string to test for HTML entity reference.
   * @param index position of the {@code '&'} in {@code str}
   * @return 
   */
  public static boolean isHtmlCharEntityRef(String str, int index)  {
      if (str.charAt(index) != '&') {
          return false;
      }
      int indexOfSemicolon = str.indexOf(';', index + 1);
      if (indexOfSemicolon == -1) { // is there a semicolon sometime later ?
          return false;
      }
      if (!(indexOfSemicolon > (index + 2))) {   // is the string actually long enough
          return false;
      }
      if (followingCharsAre(str, index, "amp;")
              || followingCharsAre(str, index, "lt;")
              || followingCharsAre(str, index, "gt;")
              || followingCharsAre(str, index, "quot;")) {
          return true;
      }
      if (str.charAt(index+1) == '#') {
          if (str.charAt(index+2) == 'x' || str.charAt(index+2) == 'X') {
              // It's presumably a hex value
              if (str.charAt(index+3) == ';') {
                  return false;
              }
              for (int i = index+3; i < indexOfSemicolon; i++) {
                  char c = str.charAt(i);
                  if (c >= 48 && c <=57) {  // 0 -- 9
                      continue;
                  }
                  if (c >= 65 && c <=70) {   // A -- F
                      continue;
                  }
                  if (c >= 97 && c <=102) {   // a -- f
                      continue;
                  }
                  return false;  
              }
              return true;   // yes, the value is a hex string
          } else {
              // It's presumably a decimal value
              for (int i = index+2; i < indexOfSemicolon; i++) {
                  char c = str.charAt(i);
                  if (c >= 48 && c <=57) {  // 0 -- 9
                      continue;
                  }
                  return false;
              }
              return true; // yes, the value is decimal
          }
      }
      return false;
  } 

  /**
   * Tests if the chars following position <code>startIndex</code> in string
   * <code>str</code> are that of <code>nextChars</code>.
   * 
   * <p>Optimized for speed. Otherwise this method would be exactly equal to
   * {@code (str.indexOf(nextChars, startIndex+1) == (startIndex+1))}.
   *
   * @param str
   * @param startIndex
   * @param nextChars
   * @return 
   */  
  private static boolean followingCharsAre(String str, int startIndex, String nextChars)  {
      if ((startIndex + nextChars.length()) < str.length()) {
          for(int i = 0; i < nextChars.length(); i++) {
              if ( nextChars.charAt(i) != str.charAt(startIndex+i+1)) {
                  return false;
              }
          }
          return true;
      } else {
          return false;
      }
  }
} 
```

TODO：保留连续的空白。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T19:59:52.093

请不要自己动手。使用 Jakarta Commons Lang。它经过测试并证明可以工作。除非必须，否则不要编写代码。“不是在这里发明的”或“不是另一个依赖项”不是决定选择/写什么的很好的基础。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T19:57:27.277

不，我建议使用您提到的 StringEscapeUtils，或者例如 JTidy（[http://jtidy.sourceforge.net/multiproject/jtidyservlet/apidocs/org/w3c/tidy/servlet/util/HTMLEncode.html](http://jtidy.sourceforge.net/multiproject/jtidyservlet/apidocs/org/w3c/tidy/servlet/util/HTMLEncode.html)）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2017-07-28T10:15:56.753

我会建议使用 org.springframework.web.util.HtmlUtils.htmlEscape(String input)

可能这会有所帮助。

# .net - 与 SharePoint 共享 .NET 成员资格数据库？

> ID：655750
> 
> 赞同：1
> 
> 时间：2009-03-17T19:51:30.910
> 
> 标签：.net, sharepoint

我们有一个使用 .NET Membership 数据库的 FBA SharePoint 实施。我们希望将相同的数据库和用户集合用于新应用程序。有没有人试过这个？我从理论上知道它应该可以工作，但 SharePoint 可能很挑剔。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:25:27.257

我通常也会有点担心，但这类似于担心 Sharepoint 是否与另一个 .NET 应用程序很好地共享 Active Directory。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T03:56:47.080

我相信 SharePoint 使用 ASP.Net 2.0 来完全处理 FBA 会员资格，所以本质上 SharePoint 并没有直接接触数据库，也不知道它。您唯一担心的应该是 ASP.Net 2.0，它似乎不太可能“挑剔”。

# c# - 你能从 Application.DoEvents() 中捕获异常吗？

> ID：655751
> 
> 赞同：2
> 
> 时间：2009-03-17T19:51:38.430
> 
> 标签：c#, visual-studio, exception, exception-handling, doevents

我在 VS2005 中运行的程序和直接运行可执行文件之间遇到了一个奇怪的区别。本质上，当在调用内部的方法中引发`Application.DoEvents()`异常时，可以在 Visual Studio 中运行时捕获该异常。运行编译后的可执行文件时，不会捕获异常并且程序崩溃。

这里有一些简单的代码来演示这个问题。假设标准的 winforms 样板和两个按钮和一个标签。

要运行此程序，请单击开始按钮以开始 10 秒计数。在 10 秒之前，按中止按钮。并且将在`DoEvents()`. 应该捕获异常。这只发生在在 Visual Studio 中运行时。

```
 private void StartButton_Click(object sender, EventArgs e) {
        DateTime start = DateTime.Now;

        try {
            while (DateTime.Now - start < new TimeSpan(0, 0, 10)) {
                this.StatusLabel.Text = DateTime.Now.ToLongTimeString();
                Application.DoEvents();
            }

            MessageBox.Show("Completed with no interuption.");
        } catch (Exception) {
            MessageBox.Show("User aborted.");                
        }
    }

    private void ButtonAbort_Click(object sender, EventArgs e) {
        throw new Exception("aborted");
    } 
```

我希望能够捕获这些异常。有什么办法让它工作吗？

**更新：**

我愿意考虑 re-entrant-headache-inducing 以外的其他方法`DoEvents()`。但我还没有找到一个似乎更好的工作。我的情况是我有一个长时间运行的循环来控制一些科学仪器，并且经常需要等待温度稳定或其他什么。我想让我的用户能够中止进程，所以我有一个中止按钮，它只是抛出一个自定义异常，我打算在最初启动进程的站点上捕获它。这似乎是一个完美的解决方案。除了由于某种原因它不起作用的事实。

如果无法使其正常工作，是否有更好的方法？

**更新 2：**

当我将它作为 Main() 的第一行添加时，它可以作为可执行文件工作，但不能在 VS 中工作，所以情况正好相反。疯狂的是，它似乎是无操作的。我能理解这是怎么做的。

```
Application.ThreadException += delegate(
        object sender, 
        System.Threading.ThreadExceptionEventArgs e
    ) 
    { throw e.Exception; }; 
```

疯了吧。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T19:55:14.070

你真的*必须*使用`DoEvents`吗？它会导致重入，这可能很难调试。

我怀疑如果您从应用程序中删除重入，您将能够更轻松地找出捕获异常的位置。

编辑：是的，肯定有更好的方法来做到这一点。在不同的线程上执行您的长时间运行的任务。UI 线程应该*只*执行 UI 操作。让您的“中止”按钮设置一个标志，长期运行的任务会定期检查该标志。有关 WinForms 线程的示例，请参阅我的[WinForms 线程页面](http://pobox.com/~skeet/csharp/threads/winforms.shtml)，以及一个线程设置标志以被另一个线程监视的示例的易失[性页面。](http://www.yoda.arachsys.com/csharp/threads/volatility.shtml)

编辑：我刚刚记得[`BackgroundWorker`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)（我的文章没有涵盖 - 它是在.NET 2.0 之前编写的）有一个[`CancelAsync`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancelasync.aspx)方法 - 基本上这个（与 the 一起使用[`CancellationPending`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancellationpending.aspx)并且[`WorkerSupportsCancellation`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.workersupportscancellation.aspx)基本上处理“有一个标志设置为取消” 给你的东西。只需`CancellationPending`从工作线程中检查，然后`CancelAsync`从你的中止按钮单击处理程序中调用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T20:22:00.447

因为[DoEvents](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.doevents.aspx)会导致底层消息循环泵送，它可能导致重新进入（如[MSDN 中所述](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.doevents.aspx)），这将使您的应用程序的行为不可预测。

我建议您将您的工作（等待温度稳定）转移到一个线程中，并使用某种信号来告诉您的用户界面何时等待结束。这将允许您的用户界面保持响应，而无需使用[Application.DoEvents](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.doevents.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T20:24:26.917

我认为您也许可以使用该`Application.ThreadException`事件捕获异常。

首先，您必须 `Application.SetUnhandledExceptionMode(UnhandledExceptionMode.CatchException);`在应用程序开始时进行设置，然后再创建任何控件。然后为该事件添加事件处理程序`ThreadException`。

如果这不起作用，我建议您使用 a`BackgroundWorker`这意味着您不需要使用`DoEvents`它，这也是更好的解决方案。

编辑：在您的 ThreadException 处理程序示例中，您正在引发另一个异常。这个想法是你把你的异常处理代码放在那里，而不是引发另一个异常。

但是，我仍然敦促您使用 BackgroundWorker 来执行您的循环代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-01T01:20:14.667

不是试图提出旧消息，而是因为我一直在努力解决同样的问题并且没有找到解决方案。如果您正在运行后台工作程序并且您的用户回到主应用程序线程中工作并做其他事情并且他们想要运行位于后台工作程序上的相同功能，那么 Application.DoEvents() 似乎是最好的方法，您仍然可以用它。问题在于您在 RunWorkerCompleted 事件中有代码。当您使用 CancelAsync 取消工作人员本身时， RunWorkerCompleted 中存在的任何内容都将被执行。问题是，通常您的 RunWorkerCompleted 中的任何内容都在访问 GUI，而您在运行 Application.DoEvents() 时无法访问 GUI，从 RunWorkerCompmlted 中删除您的代码并将其合并到 ReportProgress 函数中更容易接受。但是，您需要在您的 reportprogress 函数之前抛出检查事件，以确保主线程没有请求再次运行。所以在报告进度之前是这样的：

```
if (backgroundWorker1.CancellationPending == true){
     e.Cancel = true;
     return;
}
backgroundWorker1.ReportProgress(0); 
```

所以你的后台线程正在做它的所有工作，然后在你拥有它之前 ReportProgress 把这个检查放在那里。这样，如果您的用户说，嘿，我实际上想在另一个项目上运行此查询，他们将在循环中等待，如下所示：

```
if (backgroundWorker1.IsBusy == true){
     backgroundWorker1.CancelAsync();
     While(backgroundWorker1.CancellationPending == true){
          Application.DoEvents();
     }
} 
```

虽然这显然是一种不好的做法，但使用它可以消除异常。我到处搜索，直到我开始修改我正在处理的项目，发现它出错的唯一原因是因为它同时访问主线程，我相信。可能会因此而受到抨击，但有一个答案。

# iphone - iPhone 应用程序中采样声音片段的合法性

> ID：655752
> 
> 赞同：7
> 
> 时间：2009-03-17T19:51:44.950
> 
> 标签：iphone, audio

有谁知道使用来自电影的采样声音片段（特别是口语）作为 iPhone 应用程序的一部分的合法性？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T19:56:17.607

*听起来*你什么都不应该做。对于 freesounds，请看这里 -> [www.freesound.org](http://www.freesound.org)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T20:45:55.867

如果您免费赠送，美国法律可能支持它作为合理使用。我会给它很大的几率。

如果您出售它，根据美国法律，这绝不是合理使用。（编辑 - 见下文）

AFAIK，即使您不在美国生活或工作，在美国（特别是 iPhone 商店）销售它也会使产品必须遵守美国法律。

编辑：

澄清一下，法院根据 4 个标准判断合理使用：

1.  使用的目的和性质，包括这种使用是商业性质的还是用于非营利教育目的；

2.  受版权保护作品的性质；

3.  与整个受版权保护的作品有关的部分的数量和实质；和

4.  使用对受版权保护作品的潜在市场或价值的影响。

（来自 Wikipedia，请注意其许可证允许出于这些目的使用其文本）

如果你卖这个，就会违反上面的1。其他 3 个可能会减轻您对 1 的违反，但这是有风险的。如果您确实违反了它，您将面临巨额损失和禁止销售您的产品的禁令。即使你赢了，这将是一场漫长的斗争，而且可能很昂贵（即使你最终得到了权利人支付的法庭费用）。

因此，虽然它永远不是合理使用可能不是真的，但在任何情况下，我都表现得好像它是真的一样。允许在商业范围内使用旨在允许电影/书籍/媒体评论者等人使用摘录和屏幕截图来增强或展示他们的观点等。

使用电影声音字节来增强您的产品在用户心目中创建电影和您的产品之间的关联，将他们对电影的现有意见与您的产品联系起来。它极大地增强了您的产品，使其能够刺激另一个感官组。

被盯上侵权的几率可能非常低，具体取决于您的应用的知名度。然而，为合理使用辩护的几率也很低，而且潜在的成本，恕我直言，严重超过收益（特别是因为如果它变得流行，它更有可能成为诉讼的目标）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T17:03:47.173

伊纳尔，

但合理使用通常不适用于您在 App Store 中销售的应用。合理使用有一些非常严格的要求。

就现行美国版权法而言，主要案例如下：

In 2004 the 6th US Circuit Court of Appeals ruled in "Bridgeport Music v Dimension Films" that ANY use of a digital sample of a recording without a license is a violation of copyright, REGARDLESS OF THE SIZE OR SIGNIFICANCE. This eliminated the "de minimis" standard i.e the "can you recognize the original?" standard.

I know it's whacky crazy. But that's the law. Write your congressperson. Hopefully another case will get ruled in conflict with this, and it will get bumped to the Supreme Court and then to Congress. And hopefully they will fix it.

In the mean time there's lots of stuff under Creative Commons licensing and in the public domain which can be used.

Or get a license.

Currently the App Store market is like the Wild West and a lot of apps are doing things that they won't get away with for long once the marshal catches up with them.

A good common sense standard for whether you would be allowed to use something is to ask yourself "Could I sell this as mine?". The answer is usually pretty obvious.

(Look up Fair Use in US Copyright and "Bridgeport Music v Dimension Films" on Wikipedia and save yourself some legal fees.)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T20:00:21.030

您将使用的剪辑可能受版权保护，未经版权所有者许可，您不得使用。

在某些情况下，它可以被视为合理使用，例如，如果您正在做新闻文章或纪录片之类的事情，并且正在使用该剪辑来证明一个观点。但听起来您的应用程序不属于任何此类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T20:10:40.490

这完全取决于国家 - 没有全球版权法。

在美国有这种合理使用的概念。但据我了解，这是一个非常灰色的区域，只适用于法庭；未经法官同意，您不能主张合理使用。

在其他国家，如瑞典，对使用小部分作品进行引用有更具体的限制。

在所有涉及法律的情况下：咨询律师。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T20:16:15.487

如果你不得不问，那可能不是你想做的事情。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T20:07:59.733

我不是律师，但如果这些是单个单词或短语，找一个声音与原演员相似的人，录制模仿（或让原演员这样做），你就会被覆盖。

# c# - 寻找一种创造性的设计模式

> ID：655760
> 
> 赞同：3
> 
> 时间：2009-03-17T19:53:48.660
> 
> 标签：c#, design-patterns

我正在尝试找到一种可以用来简化某些对象的构造的设计模式。

基于传入的参数，一个自定义类，我将从 System.Windows.Forms.Control 类创建各种继承者。

例如，如果自定义类的其中一个成员设置为“ChkBox”，我希望我的类返回一个 System.Windows.Forms.CheckBox，或者如果该成员是“List”，我希望我的类返回一个 ComboBox。

```
public CustomClass()
{
    FieldType type;
} 
```

和

```
GetControl(CustomClass type); 
```

共同点是我想要创建的所有类都具有 Control 作为它的基类。考虑到这一点，我想有一种方法可以将基类的成员设置在一个地方。

你知道我可以用来解决这个问题的任何设计模式吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T19:55:34.193

工厂[模式](http://en.wikipedia.org/wiki/Factory_method_pattern)

# c# - 空合并赋值运算符？

> ID：655762
> 
> 赞同：22
> 
> 时间：2009-03-17T19:54:27.987
> 
> 标签：c#, operators, language-features, null-coalescing-operator

如果 C# 允许 ??= 运算符，那就太好了。我发现自己经常写以下内容：

```
something = something ?? new Something(); 
```

我宁愿这样写：

```
something ??= new Something(); 
```

想法？新的语言扩展总是因其性质而引起争议。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-15T14:56:51.557

其他编程语言，如 Ruby，经常使用它：

```
something ||= Something.new 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-04-22T08:55:23.110

如果“某物”是属性访问器的私有字段，您可以执行以下操作....如果发现该字段为空，这将执行分配。

```
private Something something;
public Something Something
{
    get
    {
        return something ?? (something = new Something());
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T20:03:34.470

我不一定反对操作员，但是，这种变量重用对我来说并不是“正确的方式”。应该是明显的 NULL 指针的错误最终会填充意外的数据并以某种意外的方式工作，等等......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-03-09T00:35:31.373

我实际上是为 PHP7 实现的。它现在处于 RFC 提案阶段。 [https://github.com/php/php-src/pull/1795](https://github.com/php/php-src/pull/1795)

实际上这是一个关于 PHP7 中空合并运算符的问题。检查这个：

```
$this->request->data['comments']['user_id'] = $this->request->data['comments']['user_id'] ?? ‘value’;
I want to check if some var is null and if the same var is null set the same var to ‘value’. 
```

因此，我在等号运算符之后重复相同的变量，这感觉不对。

所以我觉得我们需要另一个像“??=”这样的运算符，类似于+=;

$this->request->data['comments']['user_id'] ??= 'value'。因此，如果 var 为 null，则将其设置为“value”，否则保持不变。

在那个拉取请求中，我试图实现这一点。

```
$ sapi/cli/php -r '$num = null;$num ??= 5; echo $num;'
5 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T20:01:17.813

我会说`??`操作员，更确切地说，上述模式并不常见，因此新的操作员太过分了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T20:10:08.760

以`??`类似于以下方式使用三元运算符的简写：

```
(myObject != null) ? myObject : somethingElse; 
```

而不是算术运算的简写，我认为`??=`运算不适合。它是一个条件运算符。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-17T19:59:59.627

老实说，我首先对 =++ 运算符感到厌烦，它的用法相当普遍和普遍。从清晰的角度来看，您需要输入的额外几个字符可能不值得更改语言以添加 ??=。如果这是投票，我会投票反对更改语言（好问题，坏主意。:-)

我还没有尝试过，但是您可以将 ??= 映射到 Visual Studio 中刚刚为您重写的宏吗？

# c++ - 在 C++ 中操作位数组中的字段

> ID：655772
> 
> 赞同：1
> 
> 时间：2009-03-17T19:56:04.927
> 
> 标签：c++, stl, bit-manipulation

所以我想知道设置和操作位字段。

我已经找到[了将字符数组视为比特流的 C/C++ 代码，](https://stackoverflow.com/questions/264552/cc-code-to-treat-a-character-array-as-a-bitstream)这与我猜想的问题相似，但它并没有给我一个很好的 stl 方法，我认为它必须存在。

我正在考虑来自[stl](http://www.sgi.com/tech/stl/bitset.html)的位集，但我的数据集非常复杂，位布局为 1、2、3、4、7、8、16 位格式。

假设我想访问我的数据中的一个项目，第 4 个字段是跨越字节边界的 8 位代码段，有没有简单的方法可以做到这一点？

```
字节 1 字节 2
11112344 44444455

```

我正在寻找一个好的 stl 实现来访问 4 中的数据或设置 4 中的数据，我认为存在一些问题，因为必须将数据转换为单个字节并将其屏蔽似乎很愚蠢。编写它似乎也很困难，并且应该有一种更简单的方法来完成这样的任务。

还有其他方法吗？

编辑 - 我的数据集长度约为 20 个字节，我想按位顺序保留它

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:01:51.510

你能解释一下为什么常规位域是不够的吗？换句话说，为什么不这样做：

```
 struct ComplexBitLayout {
      unsigned field1 :4;
      unsigned field2 :1;
      unsigned field3 :1;
      unsigned field4 :8;
      unsigned field5 :2;
   } __attribute__((__packed__)); // or your compiler's equivalent

   ComplexBitLayout cbl;

   cbl.field4 = x; 
```

做你想做的事？

您是否希望能够以编程方式即时构建不同的布局或其他什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:12:04.667

无论您添加任何语法糖，掩蔽和转换都会发生。如果您想让事情变得真正易于使用，但首先要制作起来有点困难，您可以使用一个类，以及一些宏/模板代码，以便更容易定义新类：

```
template<bool> struct CompileTimeAssert;
template<> struct CompileTimeAssert<true> { };

#define ASSERT(check) if (!check) throw exception("Assertion Failure" #check)

#define ADDBITVALUE(backingField, backingFieldType, fieldName, offset, size) \
    public: \
    static const unsigned int fieldName##Offset = offset; \
    static const backingFieldType fieldName##Mask = CalculateMask<offset, size, backingFieldType>::Value; \
    public: \
    void Set##fieldName(backingFieldType value) \
    {\
        ASSERT(("Value too large for field.", (value & (fieldName##Mask >> fieldName##Offset)) == value));\
        backingField |= value << fieldName##Offset;\
    }\
    backingFieldType Get##fieldName() const\
    {\
        return (backingField & fieldName##Mask) >> fieldName##Offset;\
    }\
    private:

#define ADDSPANNEDVALUE(backingField1, backingField1Type, backingField2, backingField2Type, fieldName, offset1, size1, offset2, size2)\
    ADDBITVALUE(backingField1, backingField1Type, fieldName##internal1, offset1, size1)\
    ADDBITVALUE(backingField2, backingField2Type, fieldName##internal2, offset2, size2)\
    public: \
    void Set##fieldName(backingField1Type value) \
    {\
        backingField1Type value1 = value << (sizeof(backingField1Type)*8-size1);\
        value1 = value1 >> (sizeof(backingField1Type)*8-size1);\
        Set##fieldName##internal1(value1);\
        Set##fieldName##internal2(value >> size1);\
    }\
    backingField1Type Get##fieldName() const\
    {\
        return Get##fieldName##internal1() | (Get##fieldName##internal2() << size1);\
    }\
    private:

template <unsigned int Offset, int Size, typename T>
struct CalculateMask
{
    CompileTimeAssert<(Size > 0)> Object;
    static const T Value = (T)((1 << Offset) | CalculateMask<Offset + 1, Size - 1, T>::Value);
};

template <unsigned int Offset, typename T>
struct CalculateMask<Offset, 0, T>
{
    CompileTimeAssert<(Offset <= sizeof(T) * 8)> Object;
    static const T Value = 0;
}; 
```

然后像这样定义你的类：

```
class BitGroup
{
    unsigned short Values;
    unsigned short Values2;
    ADDBITVALUE(Values, unsigned short, Field1, 0, 12);
    ADDSPANNEDVALUE(Values, unsigned short, Values2, unsigned short, Field2, 12, 4, 0, 2);
    ADDBITVALUE(Values2, unsigned short, Field3, 2, 14);
public:
    BitGroup() : Values(0), Values2(0) {}
}; 
```

用法：

```
BitGroup bg;
bg.SetField1(15);
cout << bg.GetField1();
bg.SetField2(63);
cout << bg.GetField1(); 
```

如果您的字段超出支持字段的范围，您将获得编译时断言。没有检查字段是否重叠，因此您必须注意这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T20:19:29.657

似乎现有的类，例如`vector<bool>`或`Boost.DynamicBitset`不会为您做任何事情。

底层实现将不得不进行转换和屏蔽，这没什么好笑的。使用底层编写自己的类或模板`vector<bool>`并不`vector<something_else>`难，然后您就可以针对您认为的需求优化转换/屏蔽代码，例如：

*   这是随机访问还是顺序访问？（如果它是连续的，那么您可以避免重新计算您的移位掩码。）
*   所有元素的大小是否相同，或者您是否在任意位偏移处索引任意大小的元素？

# .net - 页面渲染后GC会关闭对象吗？

> ID：655777
> 
> 赞同：1
> 
> 时间：2009-03-17T19:57:07.043
> 
> 标签：.net, garbage-collection, rendering

您好我有一个我制作的 SharePoint WebPart，我重写了 Render 方法。我的问题是对象在 GC 清理之前可以存活多久？我在 Render 函数中创建了一个 StringReader 对象，我只是想知道它会在页面呈现后被处理掉，还是我必须显式调用 .Close 方法。

这会导致 SharePoint 服务器进入 99% 吗？（w3wp.exe 进程达到 99% CPU）

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T19:58:48.727

调用 Close 会更好（阅读：实际上是强制性的）。GC 会以一种或另一种方式得到它，但它是不确定的。

> 这会导致 SharePoint 服务器进入 99% 吗？（w3wp.exe 进程达到 99% CPU）

不太可能是短暂的，但无论 w3wp 进程在做什么，您都希望尽可能显式地释放一次性资源。在处理实现 IDisposable 的对象时，请将 GC 视为安全网。

# wpf - ProgressBar 未通过绑定更改为最大值时更新

> ID：655780
> 
> 赞同：3
> 
> 时间：2009-03-17T19:58:30.427
> 
> 标签：wpf, binding, progress-bar

```
<ProgressBar Foreground="Red"
             Background="Transparent"
             Value="{Binding NumFailed, Mode=OneWay}"
             Minimum="0"
             Maximum="{Binding NumTubes, Mode=OneWay, Converter={x:Static wpftools:DebuggingConverter.Instance}, ConverterParameter=Failedprogressbar}"
             FlowDirection="RightToLeft"
             Style="{DynamicResource {x:Static wpftools:CustomResources.StyleProgressBarVistaKey}}" /> 
```

这就是我的进度条目前的样子。样式来自[http://mattserbinski.com/blog/look-and-feel-progressbar，DebuggingConverter](http://mattserbinski.com/blog/look-and-feel-progressbar)是一个无操作转换器，可将值、类型和参数打印到控制台。我已经验证，当我的 NumTubes 属性发生变化时，Maximum 的转换器被调用了。

基本上，ProgressBar 在值更改之前不会重绘。所以，如果我有 2 个管子并且 1 个失败了，即使我再添加 20 个管子，该条仍然是一半填充，直到 NumFailed 更改，然后更新比例。我尝试添加 NumFailed 属性的虚假通知，但这显然不起作用，因为值没有改变。

想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T21:53:31.493

看起来酒吧大小是在私有方法中计算的`ProgressBar.SetProgressBarIndicatorLength`。`OnValueChanged`它只能从、`OnTrackSizeChanged`和调用`OnIsIndeterminateChanged`。

您可以`SetProgressBarIndicatorLength`通过反射调用，或循环调用它的属性之一。这是蹩脚的，但它看起来不像`ProgressBar`是设计的，`Maximum`并且`Minimum`会在中期进行更改。

无论您选择哪种方法，您都可以`Maximum`使用以下方法确定属性何时更改[`DependencyPropertyDescriptor.AddValueChanged`](http://msdn.microsoft.com/en-us/library/system.componentmodel.dependencypropertydescriptor.addvaluechanged.aspx)：

```
DependencyPropertyDescriptor dpd = DependencyPropertyDescriptor.FromProperty(ProgressBar.MaximumProperty, typeof(ProgressBar)));
if (dpd != null)
{
   dpd.AddValueChanged(myProgressBar, delegate
   {
      // handle Maximum changes here
   });
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-19T18:37:49.423

我无法让解决方案在这里工作，但我找到了另一种解决方法。当我更改对象的数据源时，我的进度条不会更新（11 个中的 11 个将更改为 10 个中的 10 个并冻结进度条），并意识到我根本不需要更新最大值。

相反，我在值上使用转换器将其转换为百分比，并将最大值设置为 100。结果显示相同，但​​没有更改最大值的错误。

```
public class CreatureStaminaConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        var creature = (CreatureBase.CreatureEntityData) value;
        double max = creature.entityData.MaxStat;
        return creature.CurrentStamina/max*100;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        return null;
    }
}

 <ProgressBar Name="rpbStamina" Minimum="0" Maximum="100" Value="{Binding entityData, Converter={StaticResource CreatureStaminaConverter}}" /> 
```

# objective-c - 如何将 NSInteger 转换为二进制（字符串）值

> ID：655792
> 
> 赞同：14
> 
> 时间：2009-03-17T20:00:34.820
> 
> 标签：objective-c, binary, nsstring

我试图弄清楚如何将一个 NSInteger（比如 56）转换为一个 NSString，它是原始（int）值的二进制表示。也许有人知道一种可以接受 56 并在 Objective C 中返回“111000”的格式化技术。谢谢大家。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-17T20:13:11.797

没有内置的格式化运算符可以做到这一点。如果您想将其转换为十六进制字符串，您可以这样做：

```
NSString *str = [NSString stringWithFormat:@"%x", theNumber]; 
```

要将其转换为二进制字符串，您必须自己构建它：

```
NSMutableString *str = [NSMutableString stringWithFormat:@""];
for(NSInteger numberCopy = theNumber; numberCopy > 0; numberCopy >>= 1)
{
    // Prepend "0" or "1", depending on the bit
    [str insertString:((numberCopy & 1) ? @"1" : @"0") atIndex:0];
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-12-08T23:09:42.983

```
NSString * binaryStringFromInteger( int number )
{
    NSMutableString * string = [[NSMutableString alloc] init];

    int spacing = pow( 2, 3 );
    int width = ( sizeof( number ) ) * spacing;
    int binaryDigit = 0;
    int integer = number;

    while( binaryDigit < width )
    {
        binaryDigit++;

        [string insertString:( (integer & 1) ? @"1" : @"0" )atIndex:0];

        if( binaryDigit % spacing == 0 && binaryDigit != width )
        {
            [string insertString:@" " atIndex:0];
        }

        integer = integer >> 1;
    }

    return string;
} 
```

我从 Adam Rosenfield 的版本开始，修改为：

*   在字节之间添加空格
*   处理有符号整数

样本输出：

```
-7            11111111 11111111 11111111 11111001
7             00000000 00000000 00000000 00000111
-1            11111111 11111111 11111111 11111111
2147483647    01111111 11111111 11111111 11111111
-2147483648   10000000 00000000 00000000 00000000
0             00000000 00000000 00000000 00000000
2             00000000 00000000 00000000 00000010
-2            11111111 11111111 11111111 11111110 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T20:13:51.030

大致：

```
-(void)someFunction
{
  NSLog([self toBinary:input]);
}

-(NSString *)toBinary:(NSInteger)input
{
  if (input == 1 || input == 0) {
    return [NSString stringWithFormat:@"%d", input];
  }
  else {
    return [NSString stringWithFormat:@"%@%d", [self toBinary:input / 2], input % 2];
  }
} 
```

# mysql - 虚拟目录作为数据库查询

> ID：655797
> 
> 赞同：1
> 
> 时间：2009-03-17T20:01:26.177
> 
> 标签：mysql, database, apache, subdomain, wildcard-subdomain

我有一个站点，例如 site.com 我希望用户能够在他们的区域设置中访问它 site.com/somecity 这类似于 craigslist，但他们使用子域来访问它，例如 sfbay.craigslist.org 使用 Apache HTTP 服务器. 用于数据库的 MySql。

如果你能提供一个简短的解释，或许还有更深入的讨论的链接，我会对学习很感兴趣。我正在开发一个 Web 应用程序，想知道是否应该花一些时间来阅读 Apache，还是应该将更多时间集中在服务器端编程上。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:10:56.217

不是一个真正的编程问题，但是......

我会专注于编程，因为理想情况下它适用于您最终部署的任何服务器。如果您最终在 Apache 上进行部署，那么阅读如何配置 Apache 只会对您有所帮助。

# c# - 隔离存储，试图展示不同的隔离级别——不能用于域隔离

> ID：655802
> 
> 赞同：0
> 
> 时间：2009-03-17T20:02:09.527
> 
> 标签：c#, .net, assemblies, appdomain, isolatedstorage

我已对其进行了编辑和修剪以尝试将其关闭，因为该站点提示我接受答案或添加赏金。

我做了一个实验，在控制台应用程序引用的库中调用了 GetUserStoreForAssembly 和 GetUserStoreForDomain，但我不明白为什么在一种情况下我获得的商店比我预期的要多，而在另一种情况下却少。

Preet 帮助我调整了我的实验，最终我遇到了两个略有不同的问题：

*   当我将控制台应用程序复制到另一个目录时（因此名称保持不变），我得到了两个用户/程序集存储，即每个副本一个，当我希望它们共享时

*   当我将我的库加载到控制台应用程序中的多个域时，当我希望它们不共享时，它们仍然使用相同的用户/程序集/域存储

到那时，这个问题已经很冷了。我做了自己的阅读，我想我找到了答案，所以我自己回答了这个问题，希望有人能确认/纠正。但它在名单上的位置太低了，没有机会。我正要离开它，但后来被提示接受或添加赏金。

所以我把我的答案移到了这里，现在只需要有人添加一些有用的评论来确认或纠正，这样我就可以接受它并知道这实际上对任何想要更好地理解隔离存储的人有用：

**第一个问题的可能答案：**

强命名程序集当然由它们的强名称来标识。弱命名（不确定这是否是官方术语，但无论如何）由它们的 URL 或文件位置标识。因此，复制到不同目录的同一个弱命名程序集将拥有自己独立的独立存储。

**第二个问题的可能答案答案（对此不太确定）：**

GetUserStoreForDomain 返回的范围仅限于机器、用户、应用程序和程序集，特别是在特定应用程序中运行的程序集。

我的实验创建了多个额外的域，但它们都在同一个应用程序中。因此，它们都使用同一个域存储。

因此，为了模拟域隔离，我实际上需要从两个不同的控制台应用程序中引用该库。

只有当库（以及因此两个控制台应用程序）是强命名时，这才会正常工作。引用一个程序集会导致它被复制，这意味着如果它被弱命名，它将有一个单独的隔离存储。

我刚刚用强命名尝试了整个实验，我现在得到了 2 个域存储和 1 个装配存储，如预期的那样。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T22:05:34.847

您可以在单个程序/进程中创建多个应用程序域。在 appdomain 内，您可以加载程序集。调用每个应用程序域/程序集中的方法

这里有例子[（appdomains）](http://msdn.microsoft.com/en-us/library/system.appdomain.aspx)和[这里（AssemblyIdentity）](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstorage.assemblyidentity.aspx) 和[这里](http://hoser.lander.ca/Assembly+Identity+Concept.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T22:10:06.897

您可以在单个程序/进程中创建多个应用程序域。在 appdomain 内，您可以加载程序集。调用每个应用程序域/程序集中的方法

[这里](http://msdn.microsoft.com/en-us/library/system.appdomain.aspx)有例子

# linq - 如何在大型数据集上执行 LINQ 表达式时报告进度

> ID：655803
> 
> 赞同：6
> 
> 时间：2009-03-17T20:02:29.543
> 
> 标签：linq

如果我需要使用 LINQ 生成一个相当大的数据集，并且可能需要一段时间（比如几秒钟）并且我需要（希望）生成关于 %'age done 的使用反馈，是否有一种简单/首选的方法去做这个？

例如，假设我有包含 1000 辆汽车的列表 A 和包含 1000 辆卡车的列表 B，我想选择所有可能的有序（汽车、卡车）对，其中 car.color == truck.color 链接此：

```
var pairs = from car in A 
            from truck in B 
            where car.color==truck.color 
            select new {car, truck}; 
```

现在在某些时候，这将被评估为一组嵌套的 foreach 循环。我希望能够在交互时报告 %'age complete 并理想地更新进度条或其他内容。

编辑：就在我的查询之后，我将结果存储在一个成员变量中作为这样的列表（这会强制执行查询）：

```
mPairs = pairs.ToList(); 
```

我这样做是因为我在后台工作线程中执行此操作，因为我不希望 UI 线程在 UI 线程上按需评估 LINQ 表达式时冻结（这是在 Silverlight BTW 中）。因此，我想报告进展。用户体验基本上是这样的：

1.  用户将项目拖到工作区
2.  然后引擎在后台线程上启动以确定与工作区中所有其他项目的（许多）连接可能性。
3.  当引擎正在计算时，UI 不允许新连接并报告进度以指示新项目何时“可连接”到其他项目（所有尚未使用的可能连接路径已通过 LINQ 确定）。
4.  当引擎完成计算（查询）时，项目在 UI 中是可连接的，并且可能的连接路径存储在本地变量中以供将来使用（例如，当用户单击连接项目时，所有可能的路径都将突出显示基于添加时计算的内容）

（删除项目时必须发生类似的过程）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T20:07:31.543

编辑：这目前不起作用，因为查询表达式不允许大括号。正在编辑...

您始终可以添加显示进度的“无操作”选择或 where 子句：

```
public class ProgressCounter
{
    private readonly int total;
    private int count;
    private int lastPercentage;

    public ProgressCounter(int total)
    {
        this.total = total;
    }

    public void Update()
    {
        count++;
        int currentPercentage = (count * 100) / total;
        if (currentPercentage != lastPercentage)
        {
            Console.WriteLine("Done {0}%", currentPercentage);
            lastPercentage = currentPercentage;
        }
        return true;
    }
}

...

var progressCounter = new ProgressCounter(A.Count * B.Count);

var pairs = from car in A
            from truck in B
            where progressCounter.Update()
            where car.color==truck.color
            select new {car, truck}; 
```

请注意副作用的使用，这总是令人讨厌的。如果这真的是查询，我希望你会使用连接，顺便说一句:)

我们一直在考虑向[MoreLINQ](http://code.google.com/p/morelinq/)添加一种类似这样的运算符- 称为 Pipe、Apply、Via 或类似的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T06:41:38.570

我使用的效果很好的东西是 DataContext 的适配器，它返回了它产生的项目数的计数。

```
public class ProgressArgs : EventArgs
{
    public ProgressArgs(int count)
    {
        this.Count = count;
    }

    public int Count { get; private set; }
}

public class ProgressContext<T> : IEnumerable<T>
{
    private IEnumerable<T> source;

    public ProgressContext(IEnumerable<T> source)
    {
        this.source = source;
    }

    public event EventHandler<ProgressArgs> UpdateProgress;

    protected virtual void OnUpdateProgress(int count)
    {
        EventHandler<ProgressArgs> handler = this.UpdateProgress;
        if (handler != null)
            handler(this, new ProgressArgs(count));
    }

    public IEnumerator<T> GetEnumerator()
    {
        int count = 0;
        foreach (var item in source)
        {
            // The yield holds execution until the next iteration,
            // so trigger the update event first.
            OnUpdateProgress(++count);
            yield return item;
        }
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }
} 
```

用法

```
var context = new ProgressContext(
    from car in A 
    from truck in B 
    select new {car, truck};
);
context.UpdateProgress += (sender, e) =>
{
    // Do your update here
};

var query = from item in context
            where item.car.color==item.truck.color;

// This will trigger the updates
query.ToArray(); 
```

唯一的问题是，除非您知道总数，否则您无法轻松计算百分比。要进行总计数通常需要处理整个列表，这可能会很昂贵。如果您事先知道总计数，那么您可以在 UpdateProgress 事件处理程序中计算出一个百分比。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T20:09:24.830

大多数 Linq 都是使用惰性求值完成的。因此，在您对结果进行 foreach 之前，实际上不会执行查询。每次您从对中“拉”一个结果时，都会评估一段查询。

这意味着您可以只在迭代结果的 foreach 循环中显示进度。缺点是你事先不知道结果集有多大，计算结果集的大小也会遍历结果并执行查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:14:01.230

好吧，我的方法与 Jon 的相似，尽管我相信他的方法会更加简洁。你可以用同样的方法破解一些东西..

```
var pairs = from car in A
            from truck in B
            let myProgress = UpdateProgress(...)
            where car.color == truck.color
            select new { car, truck };

private int UpdateProgress(...)
{
    Console.WriteLine("Updating Progress...");
    return -1;
} 
```

尽管如前所述，查询在迭代之前不会被执行。这也是在查询中创建新范围变量的额外缺点。

# asp.net - 使用字段和值显示信息：ListView、GridView、FormView？

> ID：655809
> 
> 赞同：0
> 
> 时间：2009-03-17T20:03:51.880
> 
> 标签：asp.net, forms, listview, detailsview

我只想在 asp.net 页面上显示用户的一些数据（姓名、电子邮件、地址、标识符、进入日期）。哪个 ASP.NET 控件最适合这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:07:42.277

如果您只显示单个用户，为什么不只使用标签？如果你想显示它们的列表，我会使用 GridView。

或者，如果您想要对 html 进行大量控制并且想要显示列表但不想要网格，则可以使用中继器。

这真的取决于你想要什么。

# c# - 最长连续子序列算法

> ID：655817
> 
> 赞同：0
> 
> 时间：2009-03-17T20:07:14.070
> 
> 标签：c#, algorithm

我有一个具有“偏移”和“长度”属性的“范围”对象数组，如下所示。假设它将按“偏移”升序排序。

范围数组包含：

```
Offset        Length     Index
-------       -------    -------
100           10         0
110           2          1 
112           5          2
117           3          3
300           5          4
305           5          5 
400           5          6
405           10         7
415           2          8
417           4          9
421           7          10
428           1          11 
429           6          12  
500           4          13
504           9          14 
```

在这种情况下，连续的子序列将是：

```
Sequence #1 indices: 0, 1, 2, 3
Sequence #2 indices: 4, 5
Sequence #3 indices: 6, 7, 8, 9, 10, 11, 12  <-- (longest!!)
Sequence #4 indices: 13, 14 
```

假设只有一个最长的序列。遍历这些项目，我想为每个连续序列创建一个新数组并返回最大的数组，但这似乎不是最佳的。有一个更好的方法吗？我在 C# 2.0 中实现。该函数应该返回一个包含最长子序列元素的数组，或者返回原始数组中最长子序列的开始和结束索引。

感谢大家对此进行尝试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T20:33:13.120

这个问题与连续子序列问题等无关，而是一个可以在 O(n) 时间内解决的简单问题。在我看来，数组表示的“字符串”没有重叠，所以有一个非常简单的算法：将左手食指放在第一行，然后只要你在一个连续的范围内，右手食指就向下运行顺序。当序列结束时，存储长度和起始位置。然后重复这个。每当您发现比上一条记录更长的序列时，您就会更新起始位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:54:13.537

一个简单的线性算法（Python，我确信代码可以改进）：

```
# Your array
arr = [
  (100, 10), (110, 2), (112, 5), (117, 3), (300, 5), (305, 5), (400, 5), 
  (405, 10), (415, 2), (417, 4), (421, 7), (428, 1), (429, 6), (500, 4),
  (504, 9)
]

# Where does each element end?
ends = map(sum, arr)

s, e = 0, 0 # start and end of longest contiguous subseq
cur = 0     # length of current contiguous subseq
for j, i in enumerate(range(1, len(arr))):
    # See if current element is contiguous with the previous one
    if (arr[i][0] == ends[j]):
        cur += 1
    elif cur > 0:
        # If not, we may have found the end of a (currently) longest subseq
        if cur > (e - s):
            e = j
            s = e - cur

        cur = 0  # reset subseq length

# The longest contiguous subseq may be at the end of the array
if cur > (e - s):
    e = j + 1
    s = e - cur

# print the start and end index of the longest contiguous subseq
print(s, e) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-03-30T03:34:24.497

{ java 中的线性时间解，不需要动态规划。最接近的问题是：
需要`O(N^2)`DP解的最长递增子序列。

```
int LongestContiguousIncreasingSubsequence(int[] a)     
{

   int maxL = 1,currentL=1;
   int n=a.length;

   for ( int i = 0; i < n-1; i++ )
   {
       if(a[i+1]>a[i])
           currentL++;
       else 
       {
           if (currentL>maxL)
               maxL=currentL;
           currentL=1;
       }               
   }       

   return maxL;
} 
```

# sqlclr - CLR 上下文连接的限制是什么

> ID：655818
> 
> 赞同：4
> 
> 时间：2009-03-17T20:07:15.507
> 
> 标签：sqlclr

我正在尝试将一些现有的 C# 代码转换为 CLR 存储过程。要使用的明显连接字符串是上下文连接（“上下文连接 = true”）。

我遇到的问题是某些事情显然不适用于这种连接类型。最新的是 SqlConnection.GetSchema 方法失败。该错误只是说它在上下文连接上不可用。是否有一个在上下文连接上不起作用的列表？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T20:48:08.950

您可能已经在[MSDN SQL Server 2008 联机丛书](http://msdn.microsoft.com/en-us/library/bb418491.aspx)中遇到过这种情况，但是，以下链接解释了使用上下文连接时施加的限制：

> [常规和上下文连接的限制](http://msdn.microsoft.com/en-us/library/ms131101.aspx)

如果您发布完整的异常和堆栈跟踪，则可以从 .NET FX 程序集（使用 .NET Reflector）或使用 SQL 2005/2008 部署的程序集确定引发此异常的原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-16T08:24:40.620

有人可能会觉得这很有用：

```
 System.Data.DataTable schema = null;
    using (System.Data.SqlClient.SqlCommand cmd = database.Connection.CreateCommand())
    {
        cmd.CommandText = string.Format( "SELECT TOP 1 * FROM {0}", mainTable );
        cmd.CommandType = System.Data.CommandType.Text;
        using (System.Data.SqlClient.SqlDataReader rdr = cmd.ExecuteReader())
        {
            schema = rdr.GetSchemaTable();
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T21:48:21.660

[经过一番搜索后，我在这里](http://en.csharp-online.net/In-Process_Data_Access_in_SQL_Server_2005%E2%80%94Connections "这里")找到了不适用于上下文连接的列表。其中一些也记录在上面的 SQL 书籍链接中，但并未全部提及。

不适用于上下文连接的事物。

*   更改密码方法
*   GetSchema 方法
*   连接池和相关的参数和方法
*   使用数据库镜像时的透明故障转移
*   客户端统计 PacketSize、WorkstationID 和其他客户端信息

# c# - 如何从 c# 中的字符串中获取位？

> ID：655830
> 
> 赞同：6
> 
> 时间：2009-03-17T20:09:27.077
> 
> 标签：c#

如果我有以下字符串“Blue Box”，我怎么能得到构成 c# 中字符串的位以及我将它存储在什么数据类型中。

如果我只写字母“o”，我会得到 111 作为字节和 111 作为位。它是否切断了 0，如果我执行“oo”，字节数组中的每个 o 都会得到 111，但对于位，我得到的值是 28527。为什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-17T20:26:16.537

如果你想要字符串格式的位，你可以使用这个函数：

```
public string GetBits(string input)
{
    StringBuilder sb = new StringBuilder();
    foreach (byte b in Encoding.Unicode.GetBytes(input))
    {
        sb.Append(Convert.ToString(b, 2));
    }
    return sb.ToString();
} 
```

如果您使用“蓝盒”示例，您会得到：

```
string bitString = GetBits("Blue Box");
// bitString == "100001001101100011101010110010101000000100001001101111011110000" 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-17T20:16:43.393

您可以执行以下操作：

```
byte[] bytes = System.Text.UTF8Encoding.Default.GetBytes("Blue Box");
BitArray bits = new System.Collections.BitArray(bytes); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T20:12:59.050

这取决于您所说的“位”是什么意思。你在谈论ASCII表示吗？UTF8？UTF16？System.Text.Encoding 命名空间应该可以帮助您入门。

# asp-classic - 如何在我的笔记本电脑上运行为 asp.net 设置的经典 asp vb6 com 应用程序？

> ID：655831
> 
> 赞同：1
> 
> 时间：2009-03-17T20:09:36.390
> 
> 标签：asp-classic

**背景** 我是一个 asp 新手，我在 1999 年开发了一个经典的 asp 内联网应用程序，我讨厌它，我非常讨厌它，我确信智能客户端是未来，尤其是对于内联网应用程序。我更像是一个 db 人，并且有很多我想向网络公开的访问/sql 服务器数据库，所以当听到动态数据网站和 asp.net MVC 时，我很兴奋，我又回到了 asp 世界的发展。借助这两种技术，我正在笔记本电脑上积极开发。我的笔记本电脑运行 XP Pro 并具有 VS 2008、SQL Server 2005、.Net 3.5 SP1、MVC RC2。

**问题** 我有一个客户端，它有一个经典的 asp vb6 com、vb script sql server 2000 应用程序，我正在尝试调试它。我可以通过远程桌面访问这个应用程序，并且我在本地也有一个数据库副本。调试包括打开 sql profiler 和运行应用程序。
使用远程桌面进行调试是一种糟糕的体验（尤其是使用我的卫星 ISP），我希望能够在本地运行此应用程序，那么我该怎么做呢？

这就是我所拥有的

1.  在 inetput\wwwroot 下找到的所有 asp 文件和其他文件的副本。

2.  sql server 2000 db的副本。我设置了数据库，以便 SQL Server 2005 可以查看数据库

3.  在 com 目录下找到的应用程序 dll 文件的副本 我还有一份 vb6 源代码的副本，可以用 notepad2
    b 查看。我有一个 buildVB.bat（显然）用于制作 dll；我希望我不必运行它。

如果我可以相对轻松地做到这一点，那么必要的步骤是什么..这就是我的猜测

1.  解压 wwwroot.zip 文件并保存文件结构 (c:\inetpub\wwwroot)
2.  更改数据库连接设置以反映我的笔记本电脑。我不知道这个全局连接设置在哪里，以便我可以更改它。
3.  打开我的浏览器并指向？？？ [http://Localhost](http://Localhost) ????????????

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T20:28:25.720

开始 -> 设置 -> 控制面板 -> 添加删除程序

添加删除 Windows 组件。确保检查 IIS。该列表中的某处也是 ASP。（我认为，但通常在 XP Pro 上默认安装 IIS 和 asp 经典）

开始 -> 运行：inetmgr

这将打开 IIS 控制台，您可以在其中设置 IIS Web 服务器。根据您希望模拟客户端环境的程度，您必须设置一个虚拟目录，如果这是他们的设置运行方式。

否则，您可以将他们的 wwwroot 内容解压缩到 c:\inetpub\wwwroot 并将浏览器对准[http://127.0.0.1/index.asp](http://127.0.0.1/index.asp)（或任何他们的“主” asp 文件被调用。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T20:14:23.243

您拥有 XP Pro，因此假设您已经安装了 IIS（它是 XP Pro 的一部分）并且您已经注册了应用程序 dll，那么是的，您所描述的就是它。

# groovy - 如何将 XML 文件中的条目视为 GString 并让 groovy 仍然“评估”它？

> ID：655838
> 
> 赞同：3
> 
> 时间：2009-03-17T20:11:07.557
> 
> 标签：groovy

下面的第一个示例说明了工作代码。我想将工作代码更进一步，并将 SQL 存储在 XML 文件中。但是，一旦我从 XML 文件中读取它，我似乎就无法将 SQL 语句视为 GString 了。

这是工作示例：

```
private void testRefCursors(){

    //object owner paramter
    String owner = 'HR';

    //Block of Oracle SQL to execute, returning 4 parameters
    def sqlBlock = 
    """
    declare
        type crsr is ref cursor;
        tables crsr;
        objects crsr;
    begin
        select count(*) into ${Sql.INTEGER} from all_tables where owner= ${owner} ;
        open tables for select * from all_tables where owner= ${owner} ;
        ${Sql.resultSet OracleTypes.CURSOR} := tables;
        select count(*) into ${Sql.INTEGER} from all_objects where owner= ${owner} ;
        open objects for select * from all_objects where owner= ${owner};
        ${Sql.resultSet OracleTypes.CURSOR} := objects;
    end;
    """

//note the order below, is the order of the 'types'  
    //in the SQL block used in the closure as parameters.
sqlSEDREF.call(sqlBlock){
        t,user_tables,o,user_objects ->
        println "found ${t} tables from a total of ${o} objects"
        user_tables.eachRow(){x ->println "table:${x.table_name}"}
        user_objects.eachRow(){println "object:${it.object_name}"}
    }
} 
```

现在，当我更改示例以从 XML 文件中读取 SQL 块时；我不知道如何（或是否有可能）将该值视为 GString：

```
private void testRefCursors(){

    //object owner paramter
    String owner = 'HR';
    def configFile = new File("config.xml");
    config = new XmlSlurper().parse(configFile);
    // FAILURE HERE - 
    GString sqlBlock = config.'sql-test-cursors'

//note the order below, is the order of the 'types'  
    //in the SQL block used in the closure as parameters.
sqlSEDREF.call(sqlBlock){
        t,user_tables,o,user_objects ->
        println "found ${t} tables from a total of ${o} objects"
        user_tables.eachRow(){x ->println "table:${x.table_name}"}
        user_objects.eachRow(){println "object:${it.object_name}"}
    }
} 
```

返回的错误是无法使用 SQL.call(GSTring, Closure) 的 GString 实现的结果：

> 捕获：groovy.lang.MissingMethodException：没有方法签名：groovy.sql.Sql.call() 适用于参数类型：(java.lang.String,tools.UAT$_testRefCursors_closure2)

我目前的解决方法可能是从 config.xml 切换到 CONFIG.groovy 文件，并从 .groovy 文件而不是 XML 读取 GStrings。任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-23T11:59:40.300

XML 文件不会返回 GString，因为 GString 是由 groovy 编译器在编译时构造的。当您解析 XML 文件时，您会得到一个字符串，而不是已编译的 Groovy 可执行文件。

如果您真的想在 XML 文档中嵌入 groovy 代码（这正是您在这里真正想要做的），那么您应该从查看以下内容开始：[Embedding Groovy](http://groovy.codehaus.org/Embedding+Groovy)。基本上，您将阅读 SQL 并将其视为嵌入式 groovy 脚本。

另一种方法（我在遇到类似问题时采用的方法）是使用 MessageFormat 替换 XML 中的值。

```
def s = '<sql><query-name>Some SQL</query-name>
           <query>
                select * from {0}
           </query>
         </sql>' 
```

然后在 xml 上使用 XmlSlurper 之后，您可以像这样替换 XML 中的值：

```
assert java.text.MessageFormat (xml.sql.query.text()).format ('dual') 
               == 'select * from dual' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T21:43:12.780

我想你可以试试

```
var sqlBlock = config['sql-test-cursors'].text() 
```

这可能会返回一个 GString。

# c# - 如何创建“处理”页面？

> ID：655840
> 
> 赞同：1
> 
> 时间：2009-03-17T20:11:58.210
> 
> 标签：c#, .net, asp.net, javascript

有人可以告诉我如何创建“请稍候”页面。页面加载完成后，将显示 default.aspx 页面。有没有办法做到这一点？我不想处理图像或类似的东西。实际页面将是我想要的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T04:52:00.853

不久前，我写了一篇详细的博客文章。好消息是它很详细。坏消息是它已经很老了。它出现在 AJAX 之前，尽管它使用 JavaScript 并涉及一些使 AJAX 大放异彩的东西。

另外，也是为了防止用户点击两次“下单”导致重复提交。这接近您想要的，但与您要求的不完全相同。但是，我认为实现将是相似的。

[所以，如果它有帮助，就在这里。如果它太旧，请随意忽略它:)](http://www.charlieflowers.com/blog/archives/2006/09/solving_the_dou.html)

[哦，我忘了提到第 2 部分，同样古老，但讲述了如何为 ASP.NET 页面类创建一个基类，这些类都需要这个特性。希望它有助于尽管它的年龄。](http://www.charlieflowers.com/blog/archives/aspnet/index.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T20:22:20.103

我经常使用面板来做到这一点。如果处理是在回发期间，则此技术有效。

*   用户单击按钮开始处理。
*   内容区域在一个面板中，处理窗口在另一个面板中。
*   单击处理按钮，显示处理面板，隐藏其他面板。
*   单独的线程处理记录，或者页面上的ajax调用调用实际的处理例程。
*   在处理程序结束时，转到结果页面，或显示结果数据。

您可以对页内弹出屏幕或弹出图像使用类似的逻辑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T16:13:44.487

这是我一直在寻找的答案。对不起，如果我不是很清楚，我试过了。下次我会这样做。

[点击这里](http://www.eggheadcafe.com/articles/20050108.asp)

# sql - 在 TSQL 中右对齐数字的最佳实践

> ID：655841
> 
> 赞同：4
> 
> 时间：2009-03-17T20:12:01.737
> 
> 标签：sql, sql-server, tsql

在 TSQL 中右对齐数字的最佳实践是什么？

我必须格式化一个固定长度的提取文件，并且需要正确对齐数字字段。（我使用的是 SQL Server 2005）

我发现[了这个](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=104823)，这看起来很简单。

```
right('            '+convert(varchar(20),a.num),12) 
```

这是完整的 Select 语句

```
select
    a.num,
    fixed_number =
        right('            '+convert(varchar(20),a.num),12)
from
    (
    --Test Data
    select num = 2400.00    union all
    select num = 385.00 union all
    select num = 123454.34
    ) a

Results:

num        fixed_number 
---------- ------------ 
2400.00         2400.00
385.00           385.00
123454.34     123454.34

(3 row(s) affected) 
```

我问这个问题是因为我发现这行代码在工作，看起来非常复杂（它还删除了小数和零填充）

```
CAST(REPLACE(REPLICATE('0', 12 - LEN(REPLACE(CAST(CONVERT(DECIMAL(10,2),@DD8DBAMT) AS VARCHAR),'.',''))) 
+ CAST(CONVERT(DECIMAL(10,2),@DD8DBAMT) AS VARCHAR),'.','') AS VARCHAR(12)) 
```

**更新：**

Daniel Pratt 使用函数的想法让我开始关注[SQL#](http://www.sqlsharp.com/)（我们拥有）。它有一个名为[PadLeft](http://www.sqlsharp.com/features/)的函数，令人惊讶的是，它具有与 Daniel Pratt 在下面的答案中定义的 fn_PadRight 函数相同的参数和功能。

下面是如何使用 SQL# 函数：

```
DECLARE @F6D2 AS DECIMAL(8,2)
SET @F6D2 = 0
SQL#.String_PadLeft(@F6D2,9,' ')
SQL#.String_PadLeft(123.400,9,' ')
SQL#.String_PadLeft('abc',9,' ') 
```

它可以接受数字和字符串。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T20:25:19.300

你不会像我的回答一样，但最好的做法是在 SQL 以外的地方执行此操作。SQL 旨在存储检索和处理数据，而不是将其可视化。不格式化显示。恕我直言，您最好有一个控制台应用程序来提取数据然后生成文件。

但是，当我之前这样做时，我是这样做的：

```
declare @num int
set @num=1555
select replicate(' ',20-len(cast(@num as varchar))) + cast(@num as varchar) 
```

硬编码空间太讨厌了，这可能会破坏一个巨大的数字，但是如果你生成一个固定文件，你无论如何都会为大量生成垃圾

# 编辑

Ken 我确实阅读了 ops 帖子，是的，他正在将数据格式化为固定宽度的文件。关键是您应该在应用程序层中进行格式化，而不是在 SQL 中。是的，没有人在视觉上查看数据，但我想我觉得您仍在格式化数据，我们可能正在分裂头发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:38:17.227

我可以建议帮助解决“疯狂的复杂性”的唯一方法是将其封装在一个或多个函数中。这是我们正在使用的东西的一些修改版本：

```
CREATE FUNCTION [dbo].[fn_PadRight]
(
    @Value nvarchar(4000)
    ,@NewLength int
    ,@PadChar nchar(1) = ' '
) RETURNS nvarchar(4000)
AS
BEGIN
    DECLARE @ValueLength int
    SET @ValueLength = LEN(@Value)

    IF (@NewLength > @ValueLength) BEGIN
        SET @Value = @Value + REPLICATE(@PadChar, @NewLength - @ValueLength)
    END

    RETURN @Value
END
GO

CREATE FUNCTION [dbo].[fn_FormatAmountDE]
(
    @Value money
) RETURNS nvarchar(4000)
AS
BEGIN
    RETURN [dbo].[fn_PadRight](REPLACE(CAST(@Value AS varchar), '.', ''), 12, '0')
END
GO 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T20:20:39.763

一般来说，最佳实践是让数据库返回数据，并让表示层格式化数据。您不应该格式化数据库中的数据。

* * *

我现在评论指出 - 你正在创建一个提取文件。我仍然想知道您将如何将数据从 SQL Server 中取出并放入文件中。SQL Server 肯定不是通过查询创建磁盘文件吗？

我仍然建议将数据与其演示文稿分开，即使该演示文稿是一个固定长度的文件。这是我们过去“在过去的美好时光”所做的那种事情，但今天应该避免，因为我们拥有足够快的计算机来处理诸如关注点分离之类的事情。

# c# - 轨道力学

> ID：655843
> 
> 赞同：12
> 
> 时间：2009-03-17T20:12:48.987
> 
> 标签：c#, xna, physics

有没有人有实现轨道力学的例子（最好在 XNA 中）？我当前使用的代码如下，但它在执行时“感觉不对”。该物体只是向行星略微弯曲，无论我如何调整变量，我都无法让它进入轨道，甚至是部分轨道。

```
shot.Position += shot.Velocity;  

foreach (Sprite planet in planets)  
{  
  Vector2 directionToPlanet = (planet.Position - shot.Position);  
  directionToPlanet.Normalize();  

  float distance = Vector2.DistanceSquared(shot.Position, planet.Position);  

  float gPull = (float)(planet.gravityStrength * (planet.Mass * shot.Mass) / distance) + planet.gravityField;  
  shot.Position += new Vector2(directionToPlanet.X * gPull, directionToPlanet.Y * gPull);  
} 
```

**编辑** 标记 Mendelt 的回答正确指出我需要更新速度，而不是位置。我还需要将 gPull 的计算更改为

```
float gPull = shot.Mass * planet.Mass / distanceSqr * planet.gStr; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T20:18:54.963

在最后一行中，您正在更新镜头的位置。您应该更新速度。

You might want to take a look at the code in this blogpost [http://blog.mendeltsiebenga.com/post/Fun-with-planets.aspx](http://blog.mendeltsiebenga.com/post/Fun-with-planets.aspx) No xna, but working orbital mechanics. (although i never got rid of the screen-flicker)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T20:17:52.157

[Newton-Raphson 迭代](http://en.wikipedia.org/wiki/Newton%27s_method)不是解决这个问题的稳定方法（也就是说，使用如此简单的微分方程积分器*无法正确解决问题）。*考虑使用二阶（或更高阶）解决方案：[Runge-Kutta](http://en.wikipedia.org/wiki/Runge-Kutta_methods)很好，在这种情况下很容易实现。

从数值分析的角度来看，轨道力学问题归结为求解耦合微分方程组的问题：

```
x_i'' + G m_i \sum_{i != j} m_j r_ji/(|r_ji|)^3 = 0 
```

其中`x`'s 是代表物体位置的三个向量，`m`'s 是相同物体的质量，是物体和`r_ji = x_j - x_i`之间的矢量位移。`j``i`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-05-03T15:20:18.123

The "leap frog" method is very efficient and stable, and works well for any dynamic particle/field system, including plasmas. For gravity, it's simple. Here is all you do for a single iteration on a single planet (1-body problem, single planet around stationary sun):

```
 public void Push()
    {
        Position += Gravity.dT * Velocity;
        Velocity += Gravity.dT * GravityAccelerationVector(Position);
    } 
```

Where "Gravity.dT" is a uniform time step, in an arbitrary measure of time. I'm using System.Windows.Vector, but any custom Vector class will do, as long as it supports basic multiplication and addition. The trick is that the Position and Velocity aren't at the "same time", which is very common for most integration methods. Rather, they're staggered. The Position on iteration N is updated based on the Velocity from iteration N - 1/2, but then the Velocity at iteration N+1/2 is updated based on the Position at iteration N.

The N-body version looks like this:

```
 public static void PushPlanets(Planet[] planets)
    {
        // Position Push at iteration N + 0:
        foreach(var p in planets)
            p.Position += Gravity.dT * p.Velocity; // Velocity from N - 1/2

        // Velocity Push at iteration N + 1/2:
        foreach (var p in planets)
        {
            Vector TotalGravity = new Vector(0,0);
            foreach (var pN in planets)
            {
                if (pN == p) continue;
                TotalGravity += pN.Mass * p.Mass * GravityAccelerationVector(p.Position - pN.Position);
            }
            TotalGravity += Sun.Mass * p.Mass * GravityAccelerationVector(p.Position); // Solar acceleration
            p.Velocity += Gravity.dT * TotalGravity;
        } 
```

Where

```
 public static Vector GravityAccelerationVector(Vector position)
    {
        return Vector.Multiply(-G / position.LengthSquared / position.Length, position);
    } 
```

The N-body is only more complicated because instead of a single gravitational source, there are several. The code format is the same, though: each planet's position gets pushed by the N-1/2 Velocity, then we figure out the total gravity acceleration on each planet based on the new positions, then we push each planet's Velocity by that total acceleration.

Other methods, even **high order** methods, are often unstable because they linearly project the next step based on position **and** velocity at the same time. This will always err on the side of adding energy to the system, and the orbits will gradually move further and further outward. Other methods can overcompensate for this natural error and remove energy from the system. In general, one wants an energy neutral solution. The leap frog method will gradually err in terms of phase of the orbits, but not in overall energy.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T21:12:39.407

A passing object will not enter orbit. One characteristic of an orbit is that you will return to the same point (relative to the body being orbited) with the same velocity. If you started from effective infinity, you'll go back to effective infinity.

In order to enter orbit, you will need to change the velocity at some point in a way unrelated to gravity, or perhaps have additional large bodies. Similarly, you can't launch an object into orbit from the surface: you have to have something (like a last rocket burn) once the satellite reaches the desired altitude. Otherwise it will try to return to the launch point, which is on the surface.

Some of my worst debugging experiences were when the program was fine and my test data or calculations were off. Make sure you know what to look for.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T20:21:23.273

A) We have no idea what your input values are.

B) You might want to use a better approximation than Newton-Raphson.

C) Passing objects do not generally fall into orbit IRL, gravity is *extremely* weak, it takes equally weak velocities or truly exceptional masses to get much more than curvature.

# apache-flex - 闪存应用程序的国际化

> ID：655845
> 
> 赞同：6
> 
> 时间：2009-03-17T20:13:08.130
> 
> 标签：apache-flex, flash, internationalization

我正在使用 Flash 应用程序（非 flex），我想支持国际化。在 flex 中有一个很好的抽象 ResourceManager，您可以在其中为每个语言环境提供资源包。动作脚本有什么等价物吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:18:52.420

AS Foundry的[全球化](http://www.servebox.org/actionscript-foundry/actionscript-foundry-documentation/building-localized-flex-applications/)包怎么样？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-18T19:28:06.203

我自己没用过，但这个看起来很有趣：

[http://www.sephiroth.it/weblog/archives/2005/12/actionscript_30_first_attempt.php](http://www.sephiroth.it/weblog/archives/2005/12/actionscript_30_first_attempt.php)

它基于 GNU gettext 实现和工具链。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-24T17:20:28.873

我们围绕 gettext 创建了一个不错的小工具：

[http://code.google.com/p/asgettext/](http://code.google.com/p/asgettext/)

使用此工具，您可以使用默认的国际化工具轻松创建多语言应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-20T16:31:28.900

作为上述建议包的附注，您可能希望在数据库中创建和存储所有语言内容，然后生成资源包文件。通过这种方式，您可以拥有一个中央界面来管理它，但仍然可以享受资源包的性能。

祝你好运！

# php - 如何最有效地确定“页数”？

> ID：655847
> 
> 赞同：3
> 
> 时间：2009-03-17T20:13:17.443
> 
> 标签：php, database, pagination

我希望我没有写重复，但我还没有找到任何可以回答我的问题的东西。（虽然在我看来这是一个很常见的问题。）

几乎每个 Web 项目都会出现此问题：您有一个包含许多条目的表格，并希望它们显示在单个页面上。

现在我想知道计算一组特定表行所需的页数的最佳方法是什么。

这里有一些我一直在考虑的方法。我想就它们的有效性得到一些回应。我将给出特定于 PHP 的示例，但我敢打赌，其他语言中也有类似的技术。

1.  可能最好的方法是静态保存页数并在每次添加新条目时修改该值。（尽管如此......我正在寻找一个动态的解决方案:-)）

2.  `SELECT COUNT(*)`每次显示页面时对感兴趣的行执行 a并计算页码。

3.  执行普通选择以获取所有行的结果集。现在不要通过调用`mysql_fetch_row`左右加载行，而是使用`mysql_num_rows`. （由于我不知道这是如何实现的，所以我不能说它是否有效。有人知道吗？）然后我可以轻松地移动结果集指针。（因为`mysqli`有`mysql_data_seek`，但原生 MySQL 扩展没有类似的功能。因此我假设这只是 的一些缓冲行为`mysqli`）

谁能说如何最有效地计算行数（页数）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-17T20:25:25.853

2号是最常见的模式

```
select count(*) from [Table] where [Expressions] 
```

进而

```
select [Columns] from [Table] where [Expressions] limit [Pagesize] offset [Pagenum*Pagesize-Pagesize] 
```

这将为您提供整个结果集的总行数，但仅提供当前页面的行数据。

许多框架或 CMS 都有在会话中缓存此数据的某些部分的约定，您可能会或可能不想这样做，具体取决于您预期的表大小、数据的波动性等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T20:24:24.263

如果您真的想要真正 WTF 比例的东西，您可以随时通过使用插入/删除触发器增加一些寄存器来跟踪有多少行。

但我认为这是一个提出更多问题的答案；）。

如果需要，只需使用 SELECT COUNT。如果它很慢，这意味着您的数据库通常构建错误。

另外，我觉得这里有过早的优化。不要过早优化。让它有意义，然后让它更有意义。有道理？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T20:25:24.683

如果我理解正确，在我工作过的大多数系统中，我需要同时获取页数，因为我正在为一个页面获取一组新的行。这允许显示“M的第N页”或类似的东西作为标题，以及充满条目的屏幕。

它取决于数据库，但通常您传入 current_page 编号（或行号），然后执行“有限查询”（fetchsize、top 等）以获取下一组行和总页码。当然，如果下面的行数发生变化，它会变得很难看，但我通常不担心这一点。

保罗。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:29:28.107

我认为您想围绕仅修改 LIMIT 关键字的单个 SQL 查询构建导航。例如 SELECT * FROM myTable LIMIT 0,20 将返回前 20 行。然后，在您的第 2 页 PHP 脚本中，您将 SQL 查询设置为 SELECT * FROM myTable LIMIT 20,40，从而返回从 20 到 40 的行。这是您要找的吗？

导航可以使用您的 PHP 脚本构建，只需执行 select COUNT(*) / rowsPerPage 并因此循环代码结构直到满足总行数。然后，结束查询将限制为 lastLimit,TotalRowCount。

编辑：要计算需要多少页来计算所有行，您需要定义 1 页可以有多少行。然后你会做 TotalRows/MaxPerPage = howManyPagesNeeded

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T20:32:25.710

在这种情况下要考虑的2个问题：

*   如何处理查看时更新/插入的数据？
*   有多少并发用户将浏览数据，应用程序在动态获取数据页面时能否跟上流量？

根据答案，这里的其他一些答案可能适用也可能不适用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-24T16:10:08.833

您可能想查看[这个](https://stackoverflow.com/questions/168084/is-there-a-more-efficient-way-of-making-pagination-in-hibernate-than-executing-se)问题，它与您所问的非常相似。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-22T21:29:55.527

一个很好的方法是使用[`SQL_CALC_FOUND_ROWS`](http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_found-rows)

例子：

```
SELECT SQL_CALC_FOUND_ROWS * FROM tbl_name WHERE id > 100 LIMIT 10;
SELECT FOUND_ROWS(); 
```

即使您将查询限制为 10 个结果，第二个查询也将返回如果您不使用限制将返回的实际总行数。

需要注意的`FOUND_ROWS()`是，在使用 MySQL 的数据库复制时不可靠

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-03-17T20:35:21.383

实际上，如果您正在使用 PHP 填充网页，那么只需获取 MySQL 表，将数据放入数组并使用 for 循环来遍历数据就更容易了

```
for($i=0;$i<count($arrayvar);$i++){} 
```

即使是一个简单的模板引擎，您也可以在另一个块中声明一个块并在一行中解析所有数据。

希望这是您正在寻找的答案类型。我不太清楚你的问题是什么意思，但我认为就是这样。

# eclipse - 是否可以在 eclipse CDT 中将调试会话附加到正在运行的程序

> ID：655853
> 
> 赞同：22
> 
> 时间：2009-03-17T20:14:57.453
> 
> 标签：eclipse, debugging, eclipse-cdt

我正在编写一个netscape iplanet 插件（在solaris/C 上使用eclipse），它基本上是一个具有特定入口点的共享对象，我希望能够使用eclipse 的调试器（gdb）调试共享对象。我记得在 AIX 中做过类似的事情，您可以将 xldb 附加到正在运行的进程。是否可以让 eclipse 运行 gdb 以附加到正在运行的二进制文件？我应该因为我想调试一段动态加载的代码而感到悲伤吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-06T00:23:37.700

是的。您需要转到启动配置对话框并选择“C++ 附加到...”。根据您的 Eclipse 版本，可能只有一个或多个“C++ Attach to ...”变体可用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T20:27:33.990

我将 Eclipse CDT 用于 HP/UX 远程环境。我不确定它是否适合您：

1.  让你的应用在 Unix 上运行

2.  转到运行/调试配置/C/C++ 附加到远程

3.  单击调试，将显示进程列表

4.  选择要调试的进程。

# c++ - 添加新成员以复制 c-tor/复制 o-tor/序列化提醒

> ID：655856
> 
> 赞同：9
> 
> 时间：2009-03-17T20:16:17.747
> 
> 标签：c++

几乎所有的 c++ 项目都有带有复制 c-tor/复制操作符/序列化方法等的类。通常对所有成员做一些事情。

但有时开发人员会忘记向此函数添加新成员。
你知道任何简单的，不包装所有成员的方式，它会提醒开发人员做某事或在这个函数中写noop(memeber_name_)。

我试图发明一些东西，但遇到了错误。

PS：单元测试可以防止这个问题，但我想要一些编译时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:44:34.747

```
template<class T>
class SafeMember {
public:
    T _;    /* short name for convenience */
    SafeMember(T const& obj) : _(obj) { }
}; 
```

像这样使用：

```
class Student {
public:
    Student(string surname, Color hairColor)
        : surname(surname)
        , hairColor(hairColor) { }

    Student(Student const& other)
        : surname(other.surname)
        , hairColor(other.hairColor) { }

    Student& operator=(Student const& other) {
        surname = other.surname;
        hairColor = other.hairColor;
        return *this;
    }

    string getSurname() const { return surname._; }

    // The foo._ syntax is better than implicit conversion because
    // it lets us call member functions, like substr in this example:
    bool isSlavic() const {return surname._.substr(surname._.size()-2)=="ev";}

    void dyeHair(Color newColor) { hairColor = newColor; }

private:
    SafeMember<string> surname;
    SafeMember<Color> hairColor;
}; 
```

现在，当您添加一个 " `SafeMember<int> age`" 成员并忘记更新您的复制构造函数时，编译将会失败。

而对于“无操作”提示，开发人员将添加一个像“:age(0)”这样的初始化程序。

**注意：**这不会保护您的 operator=() 或 serialize() 函数免受位腐烂，只有构造函数。不过，希望这应该足够了：一旦您看到构造函数中的遗漏，您可能会记得也执行其他函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T20:41:47.533

将此功能添加到您的单元测试中。如果您的单元测试涵盖了序列化/反序列化（例如，通过确保`deser(ser(x)) == x`），则未能将成员添加到序列化函数将在单元测试期间失败。这同样适用于复制 ctor。

它不像编译时错误那么理想，但如果你有一个好的单元测试框架并且你确保你有适当的覆盖率，那么这些被忽视的错误将更难产生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T10:54:36.513

看起来您的问题没有令人满意的解决方案（Iraimbilanja 解决方案可能是最好的方法之一，但仍然不完美）。我想知道即将推出的 C++0x 中是否有可以解决这个问题的功能？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-30T16:38:49.163

我认为避免这个问题的最好方法是从根本上解决它：不要使用自定义复制运算符/构造函数。

这可能并不总是可能的，但在大多数情况下，我真的认为它是......

# c# - Global.asax 中的自动事件关联

> ID：655859
> 
> 赞同：5
> 
> 时间：2009-03-17T20:17:16.543
> 
> 标签：c#, asp.net, web-applications, event-handling, global-asax

我想知道是否有办法在 Global.asax 的事件处理程序中自动存根？到目前为止，我还没有找到任何关于如何做到这一点的例子。似乎我必须找到可供我使用的代表姓名列表并手动输入它们。

Intellisense 似乎也没有提供有关该主题的任何有用信息。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2013-03-20T19:06:13.780

ASP.Net 运行时使用反射来动态查找名称为“Application_Start”、“Session_Start”等的方法，然后将它们绑定到 HttpApplication 类上的相应事件。您可以有效地绑定到任何 HttpApplication 事件，只需在 Global.asax.cs 中包含一个名称为“Application_”的方法，后跟事件名称。例如，要利用 EndRequest 事件，请将其添加到您的 Global.asax.cs 文件中：

```
 protected void Application_EndRequest(object sender, EventArgs e)
    {
        // Your code here
    } 
```

请参阅Rick Strahl 的[博客条目，了解有关如何完成此操作的大量有用信息。](http://www.west-wind.com/weblog/posts/2009/Jun/18/How-do-ASPNET-Application-Events-Work)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T07:00:36.043

类的所有事件都[`HttpApplication`](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.aspx)可以在 global.asax 中有一个处理程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T21:28:44.937

我不太明白您所说的“自动存根”事件处理程序是什么意思？就像键入“覆盖”并让 Intellisense 告诉哪些事件处理程序可用？怕是没有了...

不过，这是一个显示可用内容的链接：

*   [mha.dk](http://www.mha.dk/post/Globalasax-file---events.aspx)

不过，似乎在任何地方都找不到任何确定的、完整的清单：-(

马克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-05-29T08:32:20.873

HttpApplication.Init 方法在所有模块对象都被创建并且它们的每个 Init 方法都被调用后被调用，这提供了一个完美的机会来设置事件处理程序，初始化一个 HttpModule?s 实例变量，并将事件处理程序连接到托管 HttpApplication。

asax 类中的方法名称是用于在 Web.config 文件中注册模块的名称属性值、下划线和事件名称的串联。

# ruby - 基于单例类创建新的非单例类

> ID：655862
> 
> 赞同：0
> 
> 时间：2009-03-17T20:18:16.697
> 
> 标签：ruby, singleton

是否可以在 Ruby 中基于单例类定义一个新的非单例类？

我尝试了这样的事情（片段）：

```
module SomeModule
  extend self
  class Singleton;end
end

class NonSingleton
  include SomeModule
end
nonsingleton = NonSingleton.new 
```

但是，当然对你们大师来说，这已经很明显了，这不会像我预期的那样起作用。

基本上我想要的是重用 Singleton 类的功能，而不以任何方式影响它的行为。可能吗？

经过进一步调查，这似乎根本不可能（如果我错了，请纠正我）。像跟随这样的黑客会太丑陋/凌乱吗？

```
singleton = File.read('some_singleton.rb')
non_singleton = eval(singleton.gsub('include Singleton', ''))
# Or perhaps:
non_singleton = eval(singleton.gsub('module SomeModule', 'module MyOwnModule')) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T21:29:11.863

好的。我这里没有真正的红宝石，只有 IronRuby，但是当我尝试这样做时会发生这种情况：

```
# define a new object
>>> s = "hello"
=> "hello"

# add a method to it's singleton class
>>> class << s
... def say; puts self; end
... end
=> nil

# get it's singleton class
>>> SingletonBaseClass = class << s; self; end
=> #<Class:#<String:0x000005c>>

# try build a new one inheriting from the singleton class
>>> class NonSingletonClass < SingletonBaseClass
... end
:0: can't make subclass of virtual class (TypeError) 
```

IronRuby 与普通的 ruby​​ 语言本身相当兼容，我敢打赌，在真正的 ruby​​ 中也会发生类似的错误消息。简而言之，你做不到。

这就引出了一个问题：你想做什么？如果特定对象的单例类变得足够复杂以至于您想重用它，那么您不应该将该代码放在常规类或模块中吗？

例如，您可以这样做：

```
# define our reusable code
module SharedMethods
  def a;end
  def b;end
  # and so on
end

# mix it into the singleton of some object
s = "hello"
class << s; include SharedMethods; end 
```

然后您可以在任何其他对象/类/等上重新使用它

# query-string - 将查询字符串添加到 asp:button 的 postbackurl 属性

> ID：655864
> 
> 赞同：0
> 
> 时间：2009-03-17T20:18:37.960
> 
> 标签：query-string, httpcontext, autopostback, postbackurl

我在 default.aspx 的表单上有一个文本框和一个按钮，在我的 DownloadHandler.ashx 中，我从 HttpContext.Request.Form("txtURI") 获得了我需要的值：

```
 <asp:TextBox ID="txtURI"
                        AutoPostBack="true"
                        runat="server"></asp:TextBox>
            <asp:Button ID="DownloadButton"
                        PostBackUrl="~/DownloadHandler.ashx" 
                        runat="server" 
                        Text="Download"/> 
```

我想更改它，以便将输入文本框中的值作为查询字符串传递给 DownloadHandler.ashx（而不是从 Request.Form 中选择它）。

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:21:15.770

我想你回答了你自己的问题。我相信您将不得不根据请求获取它并重定向。

其实，我想的越多。您可以添加一个 OnClientClick，调用一个 javascript 函数，该函数将从字段中获取值并在那里提交。但是，我只会在服务器端进行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T20:32:58.893

您还可以在按钮中使用命令参数名称和命令参数值，并以这种方式传递您需要的值。

```
<asp:Button ID="DownloadButton"
    CommandName="Download" 
    CommandArgument="whatever_argument_or_value" OnCommand="Download_Command"
    runat="server" Text="Download"
/> 
```

# c# - 如何在 C# 中动态调用构造函数？

> ID：655873
> 
> 赞同：5
> 
> 时间：2009-03-17T20:19:51.327
> 
> 标签：c#, .net, reflection

我正在使用 LINQ-to-XML 查询文件以获取对象列表。它们都具有相同的结构（一组选项，一个不确定长度的参数列表）。根据它们在 XML 文件中的名称，我想将参数用于完全不同的事情——所以我创建了这个对象的子类。

我的问题是 - 我如何动态调用正确的构造函数，而不做类似 case 语句的事情？或者从 XML 优雅地实例化不同子类的解决方案是否存在于其他地方？

```
class Object1
{
    string name;
    OptionObj opt;
    List<Param> parameters;
}

class sonOfObject : Object1
{
    public void ExecuteSomething()
    {
         //do something with the parameters
    }
}

class secondSonOfObject : Object1
{
    public void ExecuteSomething()
    {
         //do something entirely different with the parameters
    }
}

var query = from x in xmlDoc.Descendants("Object")
    select new Object
    {
        //select the object from the XML
    } 
```

在这段代码之后，我可以使用复制构造函数从更通用的查询对象中创建一个 sonOfObject。但是我如何根据子类的名称动态地做到这一点？

我知道您可以从类型中获取 MethodInfo 并调用它...

```
MethodInfo m = t.GetMethod(someName);
m.Invoke(yourObj, null); 
```

但这意味着我必须实例化 9 或 10 个这些子类对象（并获取每个对象的类型），并且仍然以某种 case 语句结束。

有没有更优雅的方式来动态调用子类构造函数？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T20:24:26.200

[Activator.CreateInstance](http://msdn.microsoft.com/en-us/library/system.activator.createinstance.aspx)允许您将类名作为字符串传递，它将返回该类的新实例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T20:37:32.267

为了让一个类参与这个方案，我会用一个自定义属性来标记它，这会给它一个“XML 名称”。

然后使用反射找到所有`Type`标有该属性的 s 并将它们放在一个`Dictionary<string, Type>`. 此时，您需要决定如何查找可能为系统提供类型的其他程序集。一种简单的方法是在同一目录中查找扩展名为 .DLL 的其他文件。

然后，每当您从 XML 中获得要用于创建相应实例的字符串时`Type`，只需`Type`在`Dictionary`by name 中查找并调用`Type.GetConstructor`and `ConstructorInfo.Invoke`。

这样做的好处是 XML 中的标识符与代码的物理布局是分开的——您可以在程序集中移动类型或重命名它们，而不会使旧的 XML 文件失效。

# java - 在 Java 中将 UTF-8 转换为 ISO-8859-1 - 如何将其保持为单字节

> ID：655891
> 
> 赞同：66
> 
> 时间：2009-03-17T20:25:06.463
> 
> 标签：java, utf-8, iso-8859-1

我正在尝试将用 Java 编码的 UTF-8 字符串转换为 ISO-8859-1。例如，在字符串 'âabcd' 中，'â' 在 ISO-8859-1 中表示为 E2。在 UTF-8 中，它表示为两个字节。C3 A2 我相信。当我执行 getbytes(encoding) 然后使用 ISO-8859-1 编码中的字节创建一个新字符串时，我得到两个不同的字符。¢。有没有其他方法可以做到这一点，以保持字符相同，即âabcd？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-03-17T20:43:21.443

如果您正在处理 UTF-16 以外的字符编码，则不应该使用`java.lang.String`或`char`原语——您应该只使用`byte[]`数组或`ByteBuffer`对象。然后，您可以使用[`java.nio.charset.Charset`](http://java.sun.com/javase/6/docs/api/java/nio/charset/Charset.html)在编码之间进行转换：

```
Charset utf8charset = Charset.forName("UTF-8");
Charset iso88591charset = Charset.forName("ISO-8859-1");

ByteBuffer inputBuffer = ByteBuffer.wrap(new byte[]{(byte)0xC3, (byte)0xA2});

// decode UTF-8
CharBuffer data = utf8charset.decode(inputBuffer);

// encode ISO-8559-1
ByteBuffer outputBuffer = iso88591charset.encode(data);
byte[] outputData = outputBuffer.array(); 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-17T20:39:17.193

```
byte[] iso88591Data = theString.getBytes("ISO-8859-1"); 
```

会成功的。根据您的描述，您似乎正在尝试“存储 ISO-8859-1 字符串”。Java 中的字符串对象*总是*以 UTF-16 隐式编码。无法更改该编码。

你可以做的是获取构成它的其他编码的字节（使用`.getBytes()`如上所示的方法）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-17T22:25:03.287

从一组使用 UTF-8 对字符串进行编码的字节开始，从该数据创建一个字符串，然后获取一些以不同编码对字符串进行编码的字节：

```
 byte[] utf8bytes = { (byte)0xc3, (byte)0xa2, 0x61, 0x62, 0x63, 0x64 };
    Charset utf8charset = Charset.forName("UTF-8");
    Charset iso88591charset = Charset.forName("ISO-8859-1");

    String string = new String ( utf8bytes, utf8charset );

    System.out.println(string);

    // "When I do a getbytes(encoding) and "
    byte[] iso88591bytes = string.getBytes(iso88591charset);

    for ( byte b : iso88591bytes )
        System.out.printf("%02x ", b);

    System.out.println();

    // "then create a new string with the bytes in ISO-8859-1 encoding"
    String string2 = new String ( iso88591bytes, iso88591charset );

    // "I get a two different chars"
    System.out.println(string2); 
```

这会正确输出字符串和 iso88591 字节：

```
âabcd 
e2 61 62 63 64 
âabcd 
```

所以你的字节数组没有与正确的编码配对：

```
 String failString = new String ( utf8bytes, iso88591charset );

    System.out.println(failString); 
```

输出

```
Ã¢abcd 
```

（或者，或者您只是将 utf8 字节写入文件并在其他地方以 iso88591 的形式读取它们）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-02-17T22:20:35.610

这就是我需要的：

```
public static byte[] encode(byte[] arr, String fromCharsetName) {
    return encode(arr, Charset.forName(fromCharsetName), Charset.forName("UTF-8"));
}

public static byte[] encode(byte[] arr, String fromCharsetName, String targetCharsetName) {
    return encode(arr, Charset.forName(fromCharsetName), Charset.forName(targetCharsetName));
}

public static byte[] encode(byte[] arr, Charset sourceCharset, Charset targetCharset) {

    ByteBuffer inputBuffer = ByteBuffer.wrap( arr );

    CharBuffer data = sourceCharset.decode(inputBuffer);

    ByteBuffer outputBuffer = targetCharset.encode(data);
    byte[] outputData = outputBuffer.array();

    return outputData;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-20T09:45:45.300

对于文件编码...

```
public class FRomUtf8ToIso {
        static File input = new File("C:/Users/admin/Desktop/pippo.txt");
        static File output = new File("C:/Users/admin/Desktop/ciccio.txt");

    public static void main(String[] args) throws IOException {

        BufferedReader br = null;

        FileWriter fileWriter = new FileWriter(output);
        try {

            String sCurrentLine;

            br = new BufferedReader(new FileReader( input ));

            int i= 0;
            while ((sCurrentLine = br.readLine()) != null) {
                byte[] isoB =  encode( sCurrentLine.getBytes() );
                fileWriter.write(new String(isoB, Charset.forName("ISO-8859-15") ) );
                fileWriter.write("\n");
                System.out.println( i++ );
            }

        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                fileWriter.flush();
                fileWriter.close();
                if (br != null)br.close();
            } catch (IOException ex) {
                ex.printStackTrace();
            }
        }

    }

    static byte[] encode(byte[] arr){
        Charset utf8charset = Charset.forName("UTF-8");
        Charset iso88591charset = Charset.forName("ISO-8859-15");

        ByteBuffer inputBuffer = ByteBuffer.wrap( arr );

        // decode UTF-8
        CharBuffer data = utf8charset.decode(inputBuffer);

        // encode ISO-8559-1
        ByteBuffer outputBuffer = iso88591charset.encode(data);
        byte[] outputData = outputBuffer.array();

        return outputData;
    }

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-03-12T05:10:04.230

如果字符串中有正确的编码，则无需执行更多操作来获取其他编码的字节。

```
public static void main(String[] args) throws Exception {
    printBytes("â");
    System.out.println(
            new String(new byte[] { (byte) 0xE2 }, "ISO-8859-1"));
    System.out.println(
            new String(new byte[] { (byte) 0xC3, (byte) 0xA2 }, "UTF-8"));
}

private static void printBytes(String str) {
    System.out.println("Bytes in " + str + " with ISO-8859-1");
    for (byte b : str.getBytes(StandardCharsets.ISO_8859_1)) {
        System.out.printf("%3X", b);
    }
    System.out.println();
    System.out.println("Bytes in " + str + " with UTF-8");
    for (byte b : str.getBytes(StandardCharsets.UTF_8)) {
        System.out.printf("%3X", b);
    }
    System.out.println();
} 
```

输出：

```
Bytes in â with ISO-8859-1
 E2
Bytes in â with UTF-8
 C3 A2
â
â 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-01-20T14:16:38.277

除了亚当罗森菲尔德的回答，我想补充一点，它`ByteBuffer.array()`返回缓冲区的底层字节数组，它不一定“修剪”到最后一个字符。将需要额外的操作，例如[此](https://stackoverflow.com/questions/679298/gets-byte-array-from-a-bytebuffer-in-java)答案中提到的操作；尤其是：

```
byte[] b = new byte[bb.remaining()]
bb.get(b); 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2010-03-30T09:00:23.993

驱逐非 ISO-8859-1 字符，将被替换为 '?' （例如发送到 ISO-8859-1 数据库之前）：

utf8String = new String (utf8String.getBytes(), "ISO-8859-1" );

# java - ColdFusion 或 Java 中的 CSS 解析器？

> ID：655896
> 
> 赞同：3
> 
> 时间：2009-03-17T20:25:52.280
> 
> 标签：java, css, coldfusion, parsing, sac

我正在构建需要一个简单的 HTML 前端来编辑 CSS 中的某些属性的东西。但是，我需要获取 CSS 文件指定的值。

我能找到的唯一解析器是[CSS Parser Project](http://cssparser.sourceforge.net/)，它是用 Java 编写的。它同时实现了[文档对象模型级别 2 样式](http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113)和[SAC：CSS API 的简单](http://www.w3.org/Style/CSS/SAC/)API。它应该可以工作，但我们还没有尝试过。关于这个项目或 API 的任何教程？

我的团队能想到的另一个解决方案是将这个责任推给客户端的浏览器 + [jQuery](http://jquery.com/)。但是，它似乎不是很可靠和有效。

正则表达式似乎不是从 CSS 中提取属性的正确工具。

有人有更好/更简单的解决方案吗？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T21:02:50.163

[Ben Nadel](http://www.bennadel.com)在 ColdFusion中创建了一个[CSS 解析器](http://www.bennadel.com/projects/css-rule.htm)——它的功能还不完整，但它可能已经足够好了？

他最近还做了很多其他与 CSS 相关的事情，所以如果你需要更多的东西，可以浏览他的博客。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-02T19:57:33.747

[http://sourceforge.net/projects/cssparser/](http://sourceforge.net/projects/cssparser/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T08:18:10.493

> 我能找到的唯一解析器是 CSS Parser Project ...关于这个项目或 API 的任何教程？

看起来这可能是从以前的项目中重命名的 - 这是 API： http: [//www.docjar.com/docs/api/com/steadystate/css/overview-summary.html](http://www.docjar.com/docs/api/com/steadystate/css/overview-summary.html)

# c# - 使用和垃圾收集

> ID：655902
> 
> 赞同：7
> 
> 时间：2009-03-17T20:28:01.260
> 
> 标签：c#, garbage-collection, using

嗨，如果我有以下情况，请澄清一下：

```
using (Object1) {
create Object2
}
// bookmark1 
```

Object2 会与 Object1 一起在书签 1 处被销毁吗？Object2 属于 StringReader，Object1 属于 MemoryStream。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-17T20:31:03.280

两个对象都不会在块结束时被**销毁。**

Object1 将被**Disposed**，一个不同的概念；Object2 不会发生任何事情。

这两个对象都将被收集，并可能在稍后的某个时间完成。垃圾收集是不确定的——你不能依赖它何时发生。

有关更多信息，请参阅MSDN 上的[IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T20:35:09.747

using 块实际上是这样的构造的语法糖：

```
try
{
    Brush b = new SolidBrush(Color.Red);
}
finally
{
    b.Dispose();
} 
```

因此，'b' 将被放置在 try 块的末尾，除非发生超出应用程序控制的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T20:49:37.557

在块（bookmark1）的末尾，在您的示例中，只会处理对象 1。在文件流的情况下，这意味着流将被关闭并释放句柄，但实际的字符串对象仍将在内存中（准备好被 GC 清理）。在您的情况下， Object2 不会被释放，因此它使用的句柄仍将保持打开状态。最终，GC 将收集它，并调用它的终结器，此时它将被正确释放。

如果您希望两个对象都被正确“清理”，则它们都需要被处置，要么通过将它们包装在 using 语句中，要么手动调用 Dispose。

还有另一种可能更简洁的语法：

```
`using (Object1 obj1 = new Object1(), Object2 obj2 = new Object2())
{
    // Do something with obj1 & obj2
}` 
```

`如果你这样做，obj1 和 obj2 都将在块的末尾被 Disposed。在您的情况下，这意味着两个对象都将关闭，并且它们的句柄将被释放。然后 GC 将在以后的垃圾收集中清理它们。`

 `有关详细信息，请参阅[MSDN 的使用页面。](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:30:15.060

object2*不会*与 object1 一起被销毁（处置）。但是，为 using 语句创建了一个单独的范围块，因此此时 object2 确实超出了范围。它的处置只是不确定的。

此外，如果 object2 也是 IDisposable 您可以这样做：

```
using (object1)
using (object2)
{
} // bookmark1 
```

无论如何，正常的垃圾收集规则都适用：对象的托管资源（内存）仍以正常方式处理。使用/IDisposable 仅释放非托管资源。

# python - 用于转推的python正则表达式

> ID：655903
> 
> 赞同：1
> 
> 时间：2009-03-17T20:28:08.017
> 
> 标签：python, regex, twitter

我正在研究一个正则表达式，它将从推文中提取转推关键字和用户名。这是一个例子，用一个相当糟糕的正则表达式来完成这项工作：

```
tweet='foobar RT@one, @two: @three barfoo'
m=re.search(r'(RT|retweet|from|via)\b\W*@(\w+)\b\W*@(\w+)\b\W*@(\w+)\b\W*',tweet)
m.groups()
('RT', 'one', 'two', 'three') 
```

我想要的是压缩重复的`\b\W*@(\w+)\b\W*`模式并使它们成为可变数字，这样如果在@three 之后添加@four，它也会被提取。我已经尝试了很多排列来重复这一点，但`+`没有成功。

我也希望这适用于类似的东西

```
tweet='foobar RT@one, RT @two: RT @three barfoo'; 
```

*如果*模式不重叠，可以使用 re.finditer 来实现。（我有一个模式重叠的版本，所以只有第一个 RT 被拾取。）

任何帮助是极大的赞赏。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T20:35:38.417

尝试

```
(RT|retweet|from|via)(?:\b\W*@(\w+))+' 
```

将`\b\W*@(\w+)`'(?:...)` 括起来允许您对重复的术语进行分组，而无需捕获聚合。

我不确定我是否在关注您问题的第二部分，但我认为您可能正在寻找涉及以下构造的内容：

```
(?:(?!RT|@).) 
```

这将匹配任何不是“@”或“RT”开头的字符，再次不捕获它。

在这种情况下，如何：

```
(RT|retweet|from|via)((?:\b\W*@\w+)+) 
```

然后后处理

```
re.split(r'@(\w+)' ,m.groups()[1]) 
```

要获得单独的句柄？

# project-management - 更高级别的项目管理（组合管理）软件？

> ID：655917
> 
> 赞同：1
> 
> 时间：2009-03-17T20:32:53.837
> 
> 标签：project-management, project-planning

可能不是该问题的最佳措辞，但...

我知道有诸如 MS Project 之类的东西来管理项目中的任务，但是我正在寻找更高级别的东西。我需要能够自己管理项目和可用资源，而不仅仅是项目中的任务。

例如

```
ProjectA 1/1/2009-1/14/2009  ResourceA, ResourceB, ResourceC
ProjectB 1/5/2009-1/12/2009 ResourceD, ResourceE
ProjectC 1/15/2009-2/20/2009 ResourceB, ResourceC 
```

所以基本上我可以添加一个新项目，看看有哪些资源可用，通过查看软件来估计我们什么时候可以开始和完成这一切。（然后我可以向管理层展示，如果他们不雇用更多人，他们会等到 2099 年。;) )

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T20:36:57.540

[http://daptiv.com/](http://daptiv.com/)

客户使用它，但我无法评论它对他们有多大的成功。

另一个（更好的？）术语可能是“投资组合管理”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T15:29:31.083

使用 MS 项目完全可以做到这一点，只需将您的公司视为一个大项目，并将每个项目视为分配资源的任务。我仍然不会推荐 MS 项目，因为它不能很好地扩展，但如果你只想制作甘特图以支持你的观点，它会做得很好。

以我的经验，管理多个项目的人使用自定义 Excel 表，它通常做得很好。示例：第一列中的时间线，每个项目每个资源一列，实际资源下拉。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T20:38:23.637

我们使用一种叫做 Clarity 的东西，以及我工作的另一个叫做 OpenWorkbench 的产品。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:44:12.657

Microsoft Project Server 有一个投资组合管理工具。我没用过，但我知道它有效。

# php - PHP 安装脚本 - Codeigniter

> ID：655921
> 
> 赞同：1
> 
> 时间：2009-03-17T20:34:00.107
> 
> 标签：php, codeigniter, installation

我使用 CodeIgniter 开发了一个应用程序，我想为其编写一个不错的、用户友好的安装脚本。最大的问题是 CodeIgniter 需要手动配置才能发生这种情况。有谁知道解决这个问题的方法？这是以最少的配置实现这一点的最佳方式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-10T16:46:24.843

You can get the content out of the config files and write (or overwrite) them.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T09:10:45.120

如果您的配置内置于表单中，您可以在安装中包含该配置。

该表单需要验证和验证配置选项，例如测试数据库连接和验证 url。

看看 WordPress 如何进行 5 分钟安装。它有几个自定义项，并在继续之前对其进行测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-03T20:22:17.803

在 codeigniter 项目中实际上只有 2 个区域需要手动配置：

1.  应用程序的 index.php 前端控制器
2.  应用程序目录中的 config.php 文件

您可以使用大量配置选项，但基本上您需要知道：

1.  应用程序的基本 URL
2.  应用程序/系统文件夹所在的基本路径

您可以通过刚刚安装应用程序的路径来确定 #2。

如果您的应用程序在 docroot 上运行，您可以将基本 url 设置为：

> "http://".$_SERVER['SERVER_NAME']."/";

否则，您需要询问用户该应用程序应该驻留在哪个 URL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-16T22:15:45.873

这是一个用于 CI 应用程序的通用安装程序脚本[https://github.com/collb/codeigniter-installer](https://github.com/collb/codeigniter-installer) 它是从[https://github.com/mikecrittenden/codeigniter-installer](https://github.com/mikecrittenden/codeigniter-installer)派生的，几乎没有编辑

# performance - MSXML2.XMLHTTP - Vista 性能

> ID：655928
> 
> 赞同：1
> 
> 时间：2009-03-17T20:36:18.883
> 
> 标签：performance, vb6, windows-vista, msxml

我有以下（简单）VB6代码：

```
Dim xmlDoc As MSXML2.DOMDocument30
Set xmlDoc = New MSXML2.DOMDocument30

Dim xmlRequest As MSXML2.XMLHTTP40
Set xmlRequest = New MSXML2.XMLHTTP40

xmlRequest.open "GET", "http://myserver.com/Service.svc/models/20080101", False
xmlRequest.setRequestHeader "Accept-Encoding:", "gzip/deflate"
xmlRequest.send

xmlDoc.loadXML xmlRequest.responseText 
```

它从我编写的网络服务中下载了一堆东西。

在我的主机上运行的 XP VM（虚拟 PC）中，此代码在约 4 秒内执行并从 Web 服务返回数据。但是，如果在我的主机（Vista x64）上编译并且生成的 exe 运行，则需要 20 多秒才能从 Web 服务返回数据。

谁能解释为什么会这样？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T20:42:39.790

对不起，只是有一个想法 - 事实证明是正确的。嗬！

原来是Avast！防病毒使事情变慢。

# asp.net - 我在哪里可以找到开箱即用的执行更新和插入的 .NET 数据网格？

> ID：655930
> 
> 赞同：0
> 
> 时间：2009-03-17T20:36:56.450
> 
> 标签：asp.net, grid

是否有一个内置网格，我可以简单地执行以下操作：

```
SELECT * FROM MYTABLE 
```

它将列出所有行，并支持分页。

允许我通过双击一行并使其可编辑等来更新/删除/插入一行。

这存在吗？是否需要我编写任何代码来执行 CRUD 操作？

（任何版本的 ASP.NET 都可以）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T21:20:01.213

查看[ASP.NET 快速入门教程](http://quickstarts.asp.net/QuickStartv20/aspnet/)。有一个关于如何使用`GridView`添加数据的教程：

> [ASP.NET 快速入门教程 - GridView](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/gridview.aspx)

该页面上的最后一个示例演示了如何`GridView`在完全没有代码的情况下实现可更新（SQL 语句除外）。

要实现一个简单的“插入数据”功能，您应该查看同一站点上的以下教程（向下滚动到最后一个示例）：

> [ASP.NET 快速入门教程：DetailsView](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)

这些应该让你开始。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T20:41:10.137

GridView 与 SqlDataSource 控件等数据源控件一起执行此操作。“没有代码”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T07:37:06.440

除此之外（如果您对第三方 ASP.NET 网格解决方案没问题），您可能对 Telerik 网格感兴趣，它有一个来自其客户端 API 的方法，可以在编辑模式下直接切换网格行dbl 点击。该控件还支持 ASP.NET 2.x 或 3.x 数据源控件的自动操作。

我将它用于我的网站开发，我对结果非常满意。从[这里](http://demos.telerik.com/aspnet-ajax/grid/examples/overview/defaultcs.aspx)的在线演示中查看 NET 3.5 和插入/更新/删除部分。

# iphone - iPhone SDK 模拟器的推荐系统要求是什么？

> ID：655932
> 
> 赞同：4
> 
> 时间：2009-03-17T20:37:12.003
> 
> 标签：iphone, macos, sdk

我知道 iPhone SDK 需要 Leopard，即 ~900mHz G4+ w/512MB RAM。而且我过去使用过 XCode，所以我对它的性能有一个很好的了解。但我从未使用过 SDK 附带的 iPhone 模拟器，我想知道它需要什么样的 CPU/内存资源才能顺利运行。

我只是下载它并亲自查看，但我的（古老的）iBook 无法运行 Leopard。在我去买一台新机器之前，我想了解一下**最慢**的系统，它可以以接近硬件的速度运行模拟器。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T20:44:17.883

iPhone SDK 需要一台运行 Leopard 的 Intel 机器，尽管我相信有办法让它在 PPC Macs 上运行（但你仍然需要 Leopard）。

SDK没有模拟器，它是一个模拟器。它运行的代码是本机代码，因此没有仿真开销。您会发现，即使是低端机器运行代码的速度也比在实际 iPhone 上快得多。

（这就是为什么在实际的 iPhone 上测试您的应用程序非常重要的原因，特别是对于任何图形或处理器密集型的应用程序）。

1GB 的 RAM 和任何基于 Intel 的 Mac 对于开发和您可能引用的任何文档/网页来说都绰绰有余。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T21:21:11.320

即使在阵容中最慢的 Mac、带有硬盘驱动器（非 SSD）的基本型号 MacBook Air 上，模拟器也能很好地运行。它运行应用程序比在真正的 iPhone 上运行要顺畅得多*。*

但是，开发过程的其余部分受益于更多的马力。SSD（笔记本电脑中可选）或 3.5 英寸硬盘驱动器（iMac 或 Mac Pro）是一个巨大的好处，你需要相当大的 CPU 能力来实现快速的 Xcode 响应和自动完成等。

最重要的是，您需要预算和便携性允许的尽可能多的屏幕空间。它在 13 英寸 MacBook 和 MacBook Air 上的 1280x800 屏幕上非常狭窄。理想情况下，您的最低配置是 15 英寸 MacBook Pro 或 20 英寸 iMac。

我建议使用 2.0 GHz 或以上的 CPU 和至少 2 GB 的 RAM。理想情况下，它至少为 2.4 GHz 和 4 GB 的 RAM。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T02:07:50.537

RAM 可能是最大的限制。这不是 iPhone SDK 的限制，而是 Xcode 的限制——调试时它至少需要 1.5GB，但只要在不使用调试器时停止调试器，它就可以在 1GB 左右正常工作。

我在旧的 iBook G4 上运行了 SDK。因此 CPU 速度要求不是很高——尽管您可能希望在外部编辑器中编辑文本，因为 Xcode 的自动完成和语法突出显示在大约 1.6Ghz 以下太慢了。

现实的建议：*任何*具有至少 2GB RAM 的 Intel Mac。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T20:41:16.547

从发行说明：

“iPhone SDK 需要基于 Intel 的 Mac，运行 Mac OS X Leopard 10.5.4 或更高版本。”

我在 Core 2 Duo Mac mini 上使用它（即在最近更新之前）没有任何问题，所以我认为 CPU 速度真的不是你需要担心的事情。我在那个系统中有 2GB 的 RAM；我不知道这些工具是否会在少于此的情况下运行良好。

编辑：当然，现在是几年后了。本次更新的最新版本需要 Mac OS X Lion，而且很明显，Apple 将继续仅针对其最新操作系统更新 Xcode。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-10T06:00:54.970

模拟器不是问题，仪器是。

如果你只是想运行一个 iPhone 模拟器，那么系统要求并不重要，只要你能运行 leopard。

如果你想要一个生产环境，它至少应该是 c2d 2.0 2G ram 并且仍然需要等待很多调试。

# c# - 不通过使用 CSS 更改 Gridview 中的标题文本颜色

> ID：655947
> 
> 赞同：3
> 
> 时间：2009-03-17T20:43:14.343
> 
> 标签：c#, asp.net, gridview

我正在使用 asp.net c#。我正在使用 gridview 来显示数据。我通过 CSS 控制所有格式。在gridview中，我定义了itemtemplate + edititemtemplate + footertemplate，并通过模板字段的绑定列进行排序。我的问题是作为标题显示的列名，颜色不会通过 CSS 更改，字体大小，键入一切正常，但前景色已修复，因为蓝色是任何主体，请帮助我如何更改标题的前景色，这是允许的排序。

我的代码看起来像：asp:TemplateField HeaderText="Slsmn No." HeaderStyle-CssClass="GridHeaderStyle" SortExpression="Profile_Var"

问题是“Slsmn No.”。显示蓝色和下划线，但在 css 中我给出了颜色：红色

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T13:28:22.493

您分配的 CSS 类 (GridHeaderStyle) 被应用于标题单元格，而不是标题链接。听起来好像正在应用默认链接颜色。

将以下内容添加到您的 CSS 文件中：

```
.GridHeaderStyle a {color: red;} 
```

这应该会更改标题中的链接颜色。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-02T14:34:02.217

起初我尝试了 Jeremy 的解决方案，但它对我不起作用。`<style="color: #333333">`这是因为生成的 .asp 代码在您使其可排序时强制在标头中添加一个标记。

以下是解决问题的方法：

```
.GridHeaderStyle a {color: white!important} 
```

!important 限定符将覆盖 asp 放入的样式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-18T07:22:16.483

发生这种情况是因为您没有定义任何关于链接颜色的 CSS 规则。

将以下内容添加到您的样式表中：

```
.GridHeaderStyle a {
    color: #f0f; /* or whatever */
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-06-30T12:20:19.763

没有任何解决方案。我非常简单地解决了这个问题。在网格定义的末尾添加了“HeaderStyle”属性。它的样子：

```
... </Columns>
...
<HeaderStyle ForeColor="Red" />
<SelectedRowStyle ...
</asp:GridView> ... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-08-10T00:38:13.747

这篇文章仍然没有最佳答案。我在 ismailperim 回答的同一个论坛中找到了以下代码。

```
.GridStyle
{
    border: 6px solid rgb(217, 231, 255);
    background-color: White;
    font-family: arial;
    font-size: 12px;
    border-collapse: collapse;
    margin-bottom: 0px;
}
.GridStyle tr
{
    border: 1px solid rgb(217, 231, 255);
    color: Black;
    height: 25px;
}
/* Your grid header column style */
.GridStyle th
{
    background-color: rgb(217, 231, 255);
    border: none;
    text-align: left;
    font-weight: bold;
    font-size: 15px;
    padding: 4px;
    color:Black;
}
/* Your grid header link style */
.GridStyle tr th a,.GridStyle tr th a:visited
{
        color:Black;
}
.GridStyle tr th, .GridStyle tr td table tr td
{
    border: none;
}

.GridStyle td
{
    border-bottom: 1px solid rgb(217, 231, 255);
    padding: 2px;
} 
```

肯定能解决问题

# xml - 在delphi中使用xml文件编程的麻烦

> ID：655949
> 
> 赞同：0
> 
> 时间：2009-03-17T20:43:29.443
> 
> 标签：xml, delphi

嗨，我是一名初学者程序员，很想将 TXMLparser 与 Delphi 一起使用来读取一个小的 xml 文件，这样我就可以了解它们是如何工作的。

我在 xml 文件 'parser.xml' 中有以下结构；

```
<rule>
  <alert>priority 3</alert>
  <desc> </desc>
  <action>beep</action>
</rule> 
```

我在delphi中有以下代码

```
VAR
  Parser : TXmlParser;
  rule, alert: string;
  i:integer;

BEGIN
  Parser := TXmlParser.Create;
  Parser.Normalize := TRUE;
  Parser.LoadFromFile ('c:\parser.xml');
  Parser.StartScan;

  WHILE Parser.Scan DO
    CASE Parser.CurPartType OF
      ptStartTag,
      ptEmptyTag :            
        For i:=0 TO Parser.CurAttr.Count-1 Do
        Begin
          rule :=Parser.CurAttr.rule (i);
          alert :=Parser.CurAttr.alert (i);
      ptContent,
      ptCData    : // Process Parser.CurContent field here
      ptEndTag   : // Process End-Tag here (Parser.CurName)
      ptPI       : // Process PI here 
                   // (Parser.CurName is the target, Parser.CurContent)
    END;
  Parser.Free;
end. 
```

我不明白要在 xml 标签中输入的位置和语法（例如“规则”或规则）。我从 XML 网站获得了代码的基础，但 FOR 循环是我的.. 似乎工作正常，但规则和警报作为未声明的标识符返回，即使它们是在 VAR 中设置的

任何关于在哪里输入和如何输入标签以及为什么标识符不能被识别的帮助将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T21:51:34.367

我不是 TXMLParser 的用户，但是快速访问文档部分和[常见问题页面](http://www.destructor.de/xmlparser/faq.htm)会显示问题。

未声明标识符的问题不是因为您在 vars 部分中声明的变量；它位于赋值右侧的循环中（参见以“// ****”结尾的行注释：

```
VAR
  Parser : TXmlParser;
  rule, alert: string;
  i:integer;

BEGIN
  Parser := TXmlParser.Create;
  Parser.Normalize := TRUE;
  Parser.LoadFromFile ('c:\parser.xml');
  Parser.StartScan;

  WHILE Parser.Scan DO
    CASE Parser.CurPartType OF
      ptStartTag,
      ptEmptyTag :            
        For i:=0 TO Parser.CurAttr.Count-1 Do
        Begin
          rule := Parser.CurAttr.rule (i);   // **** problem here with .rule
          alert :=Parser.CurAttr.alert (i); // **** problem here with .alert
      ptContent,
      ptCData    : // Process Parser.CurContent field here
      ptEndTag   : // Process End-Tag here (Parser.CurName)
      ptPI       : // Process PI here 
                   // (Parser.CurName is the target, Parser.CurContent)
    END;
  Parser.Free;
end; 
```

没有任何东西将 .rule() 或 .alert 作为 Parser.CurAttr 的方法，您不能这样对待它们。试试这个：

```
rule := Parser.CurrAttr.Value('rule');
alert := Parser.CurrAttr.Value('alert'); 
```

实际上，现在我更多地查看了您发布的 XML，您根本不是在处理属性，而是在处理内容。属性将如下所示：

```
<rule name="My rule" priority="3" alert="Very important">Other stuff</rule> 
```

尽管如此，我还是会留下这篇文章，因为它解释了您在未声明的标识符方面遇到的语法错误。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T21:13:59.013

只是对代码的几点说明：

*   请不要使用大写的保留字。
*   对创建的对象使用 try finally
*   对嵌套的复杂语句使用额外的开始/结束块
*   你忘了结束;-)
*   使用函数
*   尝试在 case 语句中使用 else 子句

/

```
procedure ProcessXML(const AFileName: string);
var
  Parser      : TXmlParser;
  rule, alert : string;
  i           : Integer; 

begin
  Parser := TXmlParser.Create;
  try
    Parser.Normalize := TRUE;
    Parser.LoadFromFile (AFileName);
    Parser.StartScan;

    while Parser.Scan do begin
      case Parser.CurPartType of
        ptStartTag,
        ptEmptyTag : begin            
          for i := 0 to Parser.CurAttr.Count-1 do begin
            rule :=Parser.CurAttr.rule (i);
            alert :=Parser.CurAttr.alert (i);
          end;
        end;
      ptContent,
      ptCData    : // Process Parser.CurContent field here
      ptEndTag   : // Process End-Tag here (Parser.CurName)
      ptPI       : // Process PI here 
                   // (Parser.CurName is the target, Parser.CurContent)
    else
      // Do something 
    end; 
```

//

```
 finally
    Parser.Free;
  end;
end; 
```

并调用函数：

```
begin
  ProcessXML('c:\parser.xml');
end. 
```

在他们的站点上查找有关[TXMLParser](http://www.destructor.de/xmlparser/index.htm)的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T21:13:49.247

for 循环是您的问题（或其中之一）：

```
 ptEmptyTag :            
        For i:=0 TO Parser.CurAttr.Count-1 Do
        Begin
          rule :=Parser.CurAttr.rule (i);
          alert :=Parser.CurAttr.alert (i);
        end; // <-- Insert end here
  ptContent,
  ptCData    : // Process Parser.CurContent field here
  ptEndTag   : // Process End-Tag here (Parser.CurName)
  ptPI       : // Process PI here 
               // (Parser.CurName is the target, Parser.CurContent)
end; // case 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T10:16:21.673

看看使用 Delphi 内置的 XML 数据绑定向导。它可以围绕 XML/模式创建强类型类包装器，因此使用 XML 与任何其他对象一样容易。

前任。rule.Alert := '警报'; rule.Description := '你好'; rule.Action := '哔';

# xml - 为什么 T-SQL OpenXML 会出现某些字符？

> ID：655950
> 
> 赞同：0
> 
> 时间：2009-03-17T20:43:31.830
> 
> 标签：xml, tsql, openxml

我在 SQL Server 中运行了以下 XML，但它中断了，为什么？

```
 declare @xml varchar(max)
 declare @hDoc int

 set @xml = '<transaction>
 <item itemId="1" value="Hello World" />
 <item itemId="2" value="Hello &World" />
 <item itemId="3" value="Hello <World" />
 <item itemId="4" value="Hello >World" />
 <item itemId="5" value="Hello ’World" />
 </transaction>'

 exec sp_xml_preparedocument @hDoc OUTPUT, @xml

 select
        itemId
 ,      value
 from
     openxml(@hDoc, '/transaction/item')
    with (
         itemId int,
         value varchar(max)
     ) item 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T20:43:41.130

XML 中的值包含无效字符。一般来说，对于 XML，您必须像这样转义小于号和 & 符号： < 和&

```
 declare @xml varchar(max)
 declare @hDoc int

 set @xml = '<transaction>
 <item itemId="1" value="Hello World" />
 <item itemId="2" value="Hello &amp;World" />
 <item itemId="3" value="Hello &lt;World" />
 <item itemId="4" value="Hello >World" />
 </transaction>'

 exec sp_xml_preparedocument @hDoc OUTPUT, @xml

 select
        itemId
 ,      value
 from
     openxml(@hDoc, '/transaction/item')
    with (
         itemId int,
         value varchar(max)
     ) item 
```

但是，当使用 openxml 时，某些值通常不起作用，特别是那个大撇号。我不确定哪些值无效，但我知道这是其中之一。所以解决方案是使用 SQL Server 2005 中的原生 XML 类型。

```
 declare @xml xml
 set @xml = '<transaction>
 <item itemId="1" value="Hello World" />
 <item itemId="2" value="Hello &amp;World" />
 <item itemId="3" value="Hello &lt;World" />
 <item itemId="4" value="Hello >World" />
 <item itemId="5" value="Hello ’World" />
 </transaction>'

 select
       item.value('@itemId', 'int')
     , item.value('@value', 'varchar(max)')
 from @xml.nodes('/transaction/item') [transaction](item) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T20:55:30.727

如果可能，在应用程序中组装您的 XML 文档。框架（.Net、Java、...？）将为您执行正确的编码，并生成有效的 XML。

# asp.net-mvc - 在 IIS7 中运行 ASP.NET MVC 应用程序的“'Sys' 未定义”错误

> ID：655954
> 
> 赞同：3
> 
> 时间：2009-03-17T20:44:21.517
> 
> 标签：asp.net-mvc, iis, iis-7

我在我的 Web 应用程序中使用 ASP.NET MVC。它使用 AJAX（MicrosoftAjax.js、MicrosoftMvcAjax.js、jquery-1.3.1.min.js）通过以下代码从视图调用 Delete 操作：

```
<%= Ajax.ActionLink("Delete", "Delete", new { id=item.id }, new AjaxOptions { Confirm = "Are you sure you want to delete the record?", HttpMethod = "Delete", UpdateTargetId = "divAttributeList" }) %> 
```

在控制器中，我使用此代码来处理视图请求：

```
[AcceptVerbs(HttpVerbs.Delete)]
    public ActionResult Delete(int id)
    {
        _service.DeleteAttribute(id);

        return PartialView("List", _service.ListAttributes());
    } 
```

当我在 ASP.NET 开发服务器上运行它时效果很好，但是当我尝试在 IIS7（Windows Vista 或 Windows Server 2008）上运行应用程序时出现错误

![替代文字](https://i561.photobucket.com/albums/ss59/segaco/Error.png)

如果我按继续，浏览器会显示下一条消息

**无法找到该资源。**

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T20:51:31.453

我会查看 javascript 包含的路径，以确保它们对于 IIS7 中使用的路径是正确的。我已经开始使用 Url.Content() 来确保我的路径相对于应用程序的根路径定义正确。

```
 <script type='text/javascript'
         src='<%= Url.Content( "~/Scripts/jquery-1.3.1.min.js" ) %>'>
 </script> 
```

# c# - 如何检测是否将项目添加到 ListBox（或 CheckedListBox）控件

> ID：655956
> 
> 赞同：23
> 
> 时间：2009-03-17T20:44:58.943
> 
> 标签：c#, .net, winforms, listbox, checkedlistbox

这似乎是一个从根本上简单的问题。我有一个带有列表框的 WinForms 对话框。此控件*不是*通过数据绑定填充的，而是填充了对

```
listBox.Items.Add (obj); 
```

有可能这个调用可以从不同的地方异步进行，我想挂钩列表框并观察其数据成员的变化，以便我可以执行其他 UI 更改（例如启用或禁用与基于列表框交互的控件关于列表中的项目数）。

不幸的是，除非我完全一无所知，否则似乎没有一个事件或虚拟方法可以用来检测这一点。我可以挂钩选择更改，并且（对于 CheckedListBox）我可以挂钩检查状态更改。但不适用于对基础数据收集的更改。

我知道这在 Win32 中是可能的（有一个窗口消息）。我错过了什么？

* * *

[西蒙编辑]

## 解决方案

我被指出了正确的解决方案（我已将其标记为已接受的答案），即覆盖 ListBox 的 WndProc 方法并手动处理列表框消息。这是我确定（并且有效）的解决方案。可以对其进行修改以在事件中提供更多详细信息，或者将消息拆分为单独的事件，但对于我的需要，这已经足够了。

```
using System;
using System.Windows.Forms;

public class CheckedListBoxEx : CheckedListBox
{
    public CheckedListBoxEx() { }

    private const int LB_ADDSTRING = 0x180;
    private const int LB_INSERTSTRING = 0x181;
    private const int LB_DELETESTRING = 0x182;
    private const int LB_RESETCONTENT = 0x184;

    protected override void WndProc(ref Message m)
    {
        if (m.Msg == LB_ADDSTRING ||
            m.Msg == LB_INSERTSTRING ||
            m.Msg == LB_DELETESTRING ||
            m.Msg == LB_RESETCONTENT)
        {
            ItemsChanged(this, EventArgs.Empty);
        }
        base.WndProc(ref m);
    }

    public event EventHandler ItemsChanged = delegate { };
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T20:52:39.657

我不知道您可以观看任何显示项目已添加到 ListBox 的事件。也许您可以改用您描述的 Win32 方法（即抓住一个句柄，使用 WndProc 等）。

或者，也许您可​​以使用另一个添加项目的类。例如，您可以让用户操作在新类中调用 Add 方法，而不是直接调用 ListBox 上的 Add 方法，然后将项目添加到 ListBox。您可以在该类中设置一个事件，以允许您观看添加的内容。

我也喜欢另一张海报提到的对 ListBox 进行子类化的想法......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T20:49:55.793

这是另一个论坛上的帖子，建议创建一个包含该行为的子类。

[http://www.eggheadcafe.com/forumarchives/netframeworkcompactframework/jul2005/post23265940.asp](http://www.eggheadcafe.com/forumarchives/netframeworkcompactframework/jul2005/post23265940.asp)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-01-30T21:31:42.047

这个解决方案似乎有效 - 在我的情况下，我在 VB 中实现了它。我刚刚创建了一个继承列表框控件、实现 INotifyPropertyChanged 并隐藏 Items 属性的 ExtendedListbox 类。

```
Imports System.ComponentModel

Public Class ExtendedListBox:Inherits ListBox:Implements INotifyPropertyChanged

    Public Shadows Property Items() As ObjectCollection
        Get
            RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("Items"))
            Return MyBase.Items
        End Get
        Set(value As ObjectCollection)
            RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("Items"))
            MyBase.Items.Clear()
            For Each o As Object In value
                MyBase.Items.Add(o)
            Next
        End Set
    End Property

    Public Event PropertyChanged(sender As Object, e As PropertyChangedEventArgs) Implements INotifyPropertyChanged.PropertyChanged
End Class 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:55:03.770

不幸的是，没有简单的方法可以使用继承或事件来做到这一点。您应该能够覆盖 Items 类的 Add 方法，但您无法使用它！您可能能够拦截消息循环以找出发生这种情况的时间，但这超出了我的经验。

我从您的问题中注意到的一件事是您提到项目是异步添加的。不要那样做。如果您在表单的线程上同步，您的问题可能会得到解决（如果您的问题是控件没有更新）。

# c++ - 使用 ADO 在 C++ 中执行参数化查询时，为什么我不断收到“必须声明标量变量“@Param1””？

> ID：655957
> 
> 赞同：1
> 
> 时间：2009-03-17T20:44:59.003
> 
> 标签：c++, com, ado

这是代码。
关于它的几点说明。DStr 是我们公司内部的字符串类。它的功能很像 CString。我可以连接到数据库并运行非参数化查询。如果我不使用参数，这个插入也可以正常工作。cmd->Execute 语句会引发异常。这是我从中得到错误消息的地方。

```
 void CEmailArchiveDatabase::TestAddUser( DStr username, DStr displayname )
{

    DStr sql = "INSERT INTO [User] (UserName, DisplayName) VALUES (@Param1, @Param2)";

    _variant_t vUser;
    _variant_t vDisp; 

    vUser.vt = VT_BSTR;
    vUser.bstrVal = username.AllocSysString();
    vDisp.vt = VT_BSTR;
    vDisp.bstrVal = displayname.AllocSysString();

    _CommandPtr cmd = NULL;
    _ConnectionPtr conn = NULL;
    _ParameterPtr prm = NULL;

    DStr connStr = "driver={SQL Server};server=DEMETER\\SQLEXPRESS;database=ExtractoMundo";

    try
    {
        conn.CreateInstance(__uuidof(Connection));
        cmd.CreateInstance(__uuidof(Command));

        if( !(conn->GetState() & adStateOpen) )
        {
            conn->ConnectionString = connStr.AllocSysString();
            conn->Open("", "", "", NULL);
            conn->CursorLocation = adUseClient;
        }   

        cmd->ActiveConnection = conn;
        cmd->CommandText = sql.AllocSysString();
        cmd->CommandType = adCmdText;

        prm = cmd->CreateParameter("@Param1", adLongVarChar, adParamInput, -1, vUser);
        cmd->Parameters->Append(prm);
        prm = cmd->CreateParameter("@Param2", adLongVarChar, adParamInput, -1, vDisp);
        cmd->Parameters->Append(prm);

        _variant_t recAff;

        cmd->Execute(&recAff, NULL, adExecuteNoRecords);

    }
    catch(_com_error &ex)
    {
        //ClearParameters();
        DStr err;
        err += PrintProviderError(conn);
        err += PrintComError(ex);
    }

    SysFreeString(vUser.bstrVal);
    SysFreeString(vDisp.bstrVal);
    SysFreeString(cmd->CommandText);
    SysFreeString(conn->ConnectionString);

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-02T14:44:41.750

ADO 拒绝在动态查询中使用命名参数。您必须将命名参数转换为参数占位符：

```
DStr sql = "INSERT INTO [User] (UserName, DisplayName) VALUES (?, ?)"; 
```

或改用存储过程。创建过程：

```
CREATE PROCEDURE spUserInsert
  @Param1 nvarchar(50), 
  @Param2 nvarchar(50) 
AS 
  SET NOCOUNT ON;
  INSERT INTO [User] (UserName, DisplayName) VALUES (@Param1, @Param2)
GO 
```

并修改您的代码以调用它：

```
DStr sql = "spUserInsert";
...
cmd->CommandType = adCmdStoredProcedure; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T21:05:07.800

也许`cmd->CreateParameter(_bstr_t("Param1"), ...)`？

“@”是 SQL Server 特定的运算符，它可能会惹恼你。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-20T15:51:25.247

您是否尝试使用 adCmdStoredProc 而不是 adCmdText？

# javascript - 如何从 javascript 中选择 div 中的文本（用于复制到剪贴板）？

> ID：655962
> 
> 赞同：3
> 
> 时间：2009-03-17T20:47:14.943
> 
> 标签：javascript, html

我有一个包含一些文本的 div，我希望用户能够轻松地从页面复制（通过剪贴板）。是否有一种跨浏览器的方式可以通过鼠标单击选择 div 中的所有文本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T21:01:35.640

跨浏览器支持通过 Javascript 复制剪贴板需要使用 Flash 来绕过 Firefox/Netscape 的安全性，它拒绝访问剪贴板。如果您使用[jQuery](http://jquery.com)，您可以轻松使用[剪贴板](http://plugins.jquery.com/project/clipboard)插件。如果您在不使用 jQuery 的情况下使用自己的 Javascript，那么这篇[博文](http://www.jeffothy.com/weblog/clipboard-copy/)可能会有所帮助。

此外，您实际上可以调整 Firefox 的安全权限，以允许脚本访问您的剪贴板。dojotoolkit.org 上提供了一个很好的[演练。](http://dojotoolkit.org/book/dojo-book-0-9/part-2-dijit/advanced-editing-and-display/editor-rich-text/setup-clipboard-action)这通常不是所追求的路径，因为它需要您的每个用户进行此调整。Flash 使用起来更容易，因为它适用于所有现代浏览器（Safari、IE、Firefox 和 Opera）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T20:51:45.557

```
<SPAN ID="copytext" STYLE="height:150;width:162;background-color:pink">
This text will be copied onto the clipboard when you click the button below. Try it!
</SPAN>
<TEXTAREA ID="holdtext" STYLE="display:none;">
</TEXTAREA>
<BUTTON onClick="ClipBoard();">Copy to Clipboard</BUTTON>    

function ClipBoard() 
    {
    holdtext.innerText = copytext.innerText;
    Copied = holdtext.createTextRange();
    Copied.execCommand("Copy");
    } 
```

[从这里](http://www.htmlgoodies.com/beyond/javascript/article.php/3458851)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T20:53:02.027

看看这两个：http: [//yangshuai.googlepages.com/jquerycopyplugin](http://yangshuai.googlepages.com/jquerycopyplugin) [http://plugins.jquery.com/project/clipboard](http://plugins.jquery.com/project/clipboard)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:51:28.490

[这个问题](https://stackoverflow.com/questions/121817/replace-text-inside-a-div-element)可能会给你一些线索。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T21:27:38.713

我找不到在 div 中选择文本的方法，也不想使用 flash 方法来复制它（尽管这是一个很好的工具）。

我最终只是这样做：

```
function selectIncidentIDText (incidentIDTxtEl) {
    incidentIDTxtEl.select();
}
<h:inputText value="(IncidentID: #{ViewIncidentBean.incident.id})" readonly="true" onclick="selectIncidentIDText(this);"/> 
```

这对于我想要的效果来说已经足够好了，尽管它有点难看。

# c# - lambda 表达式是多线程的吗？

> ID：655969
> 
> 赞同：6
> 
> 时间：2009-03-17T20:50:20.100
> 
> 标签：c#, .net, lambda, parallel-processing

lambda 表达式是多线程的吗？

说当你把一个数学公式写成一个lambda方法时，当你把它传递给另一个方法时，它会是多线程的吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T20:53:39.483

不是 100% 清楚你在问什么。

**您是在问 lambdas 是否自然地在不同的线程上运行？**

如果不是，它们只是 System.Delegate 的另一个实例，并在主线程上运行，除非特别要求这样做。

**您是在问它们是否可以安全地在多个线程上运行？**

这是一个只有知道 lambda 表达式的内容才能回答的问题。它们本质上不是线程安全的。根据我的经验，线程安全的可能性比您预期的要小得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T20:51:54.573

不，它们在创建它们的线程上执行，除非您将它传递给另一个线程，就像任何其他方法一样。你不希望它们自动在不同的线程上运行，相信我。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T20:57:09.723

在下一版本的 C# 中，他们正在向 LINQ（称为 PLINQ）和委托添加多线程选项。[在这里](http://en.wikipedia.org/wiki/Parallel_FX_Library)查看更多信息。目前，这一切都在一个线程上。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T20:57:34.030

正如其他人所说，lambda 表达式本质上不是多线程的，标准的 linq-to-objects 扩展方法也没有做任何特殊的事情来在单独的线程中调用它们。

但是，如果您想做一些类似 linq 的多线程编程，您应该查看[Parallel Extensions to .NET Framework](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)。另请查看此链接：http:
[//blogs.msdn.com/pfxteam/](http://blogs.msdn.com/pfxteam/)

不幸的是，在 VS2010/.Net4.0 出来之前，这不会是 RTM。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T20:52:09.067

lambda 只是一个匿名方法，它在调用它的任何线程上执行，除非您提供在单独线程上执行的代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-17T21:01:00.697

Lambda 表达式和其他方法一样。是什么让方法成为多线程的？

*   无法访问外部字段（简单的输入/输出方法）——这种方法总是多线程的
*   访问同步字段 - 考​​虑同步场景（`Monitor`类、读/写锁、`Interlocked`访问`WaitHandle`等），尽量减少锁争用。
*   访问捕获的变量（闭包）——确保捕获的变量只要其他线程使用它就不会改变（如何访问变量：只是读取、读取和写入......）

C# 编译器足够聪明，可以知道是为您的 lambda 生成静态方法还是实例方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-17T21:09:27.447

可能令人困惑（但真实）的答案。在一些常见的场景中，lambda 可能在另一台机器上执行，在完全不同类型的运行时环境中，因此在另一个线程上，调用者不必等待远程执行完全完成才能继续。

（具体来说，如果您将其传递给 Linq To SQL 查询。）

# c - 如何监控通过管道的流量？

> ID：655973
> 
> 赞同：0
> 
> 时间：2009-03-17T20:51:37.523
> 
> 标签：c, unix, pipe

我的情况是这样的：我正在通过管道将输入从程序中的一个位置重定向到另一个位置。但是，这似乎并没有正常工作，所以我想监控管道中的情况。

目前，我正在使用 dup2() 来简单地覆盖管道中的标准输入和标准输出。

如何监控管道之间的情况？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T21:06:47.360

当我在 bash 脚本中调试管道时，我经常使用[tee](http://linux.die.net/man/1/tee)命令来捕获正在通过它的内容，而不会中断流程。

有一个相应的[tee 系统调用](http://linux.die.net/man/2/tee)，看起来它可能对调试 C 代码中的管道很有用，但我从未尝试过。

# java - 如何使 Cobertura/Emma 与 Eclipse 应用程序配合得很好？

> ID：655979
> 
> 赞同：1
> 
> 时间：2009-03-17T20:52:22.480
> 
> 标签：java, eclipse, cobertura, headless, emma

我的公司正在升级我们的构建系统以使用 Buckminster（进展顺利）。如果我们可以在我们处理代码时自动生成一些他们用于代码的指标，经理们自然会喜欢它——其中一个指标是单元测试的覆盖率。

之前的构建是基于 PDE 的，它产生了一个单独的无头应用程序，它解析上下文中的所有插件，在它们内部查找测试类，将所有测试用例放入一个更大的套件中，然后以编程方式运行它，通过`JUnitResultFormatter.startTestSuite()`. 在此过程中，它为特定元数据（版权标记等）添加了一些本地测试，并测试了包依赖性。

似乎我应该能够为测试应用程序导出产品，使用我选择的覆盖工具对其进行检测，然后运行它；但是，看起来两个覆盖工具都想知道他们正在处理的整个类路径。是否有可能使这些工具中的任何一个都运行良好，而无需在整个构建工作区中搜索 jars 和依赖项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T14:29:19.640

在较旧的 SO 问题的帮助下，设法让一切正常工作。

我们从[这篇文章](http://rcpquickstart.com/2008/08/04/updated-pde-build-and-test-example/)开始，它为我们提供了使用 EMMA 的示例覆盖设置。然而，我们似乎需要在我们想要获取覆盖数据的每个插件上强制依赖 EMMA。

一些谷歌取证让我们看到了[这本书的摘录](http://www.informit.com/content/images/0321268385/samplechapter/arthorne_ch05.pdf)，它相当充分地涵盖了 OSGi 类加载器层次结构。通过`osgi.parentClassloader=app`将这一行添加到测试运行应用程序的 config.ini 中，我们可以在命令行上指定一个类路径。该类路径需要包括：

*   日食的`startup.jar`
*   应用程序使用的 Java SDK jar
*   覆盖工具的罐子

当然，我们是通过`<java jar="foo.jar">`Ant 任务运行测试的，它会默默地忽略您提供的任何类路径信息并仅使用 jar。在我们让 Emma 工作之后，我们切换到 Cobertura，我们最终的 Ant 脚本（略微删节和匿名化）看起来像：

```
<target name="generate.coverage" depends="buckminster.init">
  <!-- Generate the classpath. -->
  <path id="cobertura.classpath">
    <fileset dir="${tasks.dir}/lib/cobertura">
      <include name="cobertura.jar" />
      <include name="**/*.jar" />
    </fileset>
  </path>
  <taskdef classpathref="cobertura.classpath" resource="tasks.properties" />

  <!-- Get ready to run the unit tests app, and delete old coverage data. -->
  <unzip src="${test-app.artifact}" dest="${output.dir}" overwrite="true" />
  <delete file="${output.dir}/cobertura.ser" />

  <!-- Instrument the jars in-place. Make sure to only capture what you want instrumented! -->
  <cobertura-instrument datafile="${output.dir}/cobertura.ser">
    <fileset dir="${output.dir}/test-app/plugins">
      <include name="**/*our.company_*.jar" />
    </fileset>
  </cobertura-instrument>

  <!-- Run the unit test application, by classname rather than by jar. -->
  <java fork="true" classname="org.eclipse.equinox.launcher.Main" logerror="true" failonerror="true" maxmemory="1G">
    <classpath>
      <pathelement location="${output.dir}/test-app/startup.jar" />
      <pathelement location="${tasks.dir}/lib/cobertura/cobertura.jar" />
      <fileset dir="${tasks.dir}/lib/cobertura">
        <include name="**/*.jar" />
      </fileset>
      <pathelement location="${java.class.path}" />
    </classpath>
    <sysproperty key="net.sourceforge.cobertura.datafile" file="${output.dir}/cobertura.ser" />            
    <arg value="-data" />
    <arg value="${output.dir}/test-app/workspace" />
    <arg value="--formatter=org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter:${log.dir}/test-results.xml" />
  </java>

  <!-- Generate the coverage reports. -->
  <cobertura-report format="html" datafile="${output.dir}/cobertura.ser" destdir="${output.dir}/cobertura-report">
    <fileset dir="${workspace.dir}/plugins">
      <include name="**/*.java" />
    </fileset>
  </cobertura-report>
</target> 
```

希望这可以帮助与我们在同一个地方的人。

# java - 如何跟踪并完整报告符号链接链？

> ID：655982
> 
> 赞同：3
> 
> 时间：2009-03-17T20:52:43.057
> 
> 标签：java, php, unix, shell, symlink

**遵循复杂的符号链接嵌套并完全捕获和报告沿途的每个符号链接（包括路径中间的**符号链接）的最佳工具/编程技术是什么（有关更多信息，请参见下文） 。

这是一个具体的例子。考虑 shell 命令的以下输出

```
 ls -l /Library/Java/Home
 lrwxr-xr-x  1 root  admin  48 Feb 24 12:58 /Library/Java/Home -> /System/Library/Frameworks/JavaVM.framework/Home 
```

ls 命令让您知道文件 /Library/Java/Home 文件是指向另一个位置的符号链接。但是，它不会让您知道它指向的东西也是一个符号链接

```
ls -l /System/Library/Frameworks/JavaVM.framework/Home
lrwxr-xr-x  1 root  wheel  24 Feb 24 12:58 /System/Library/Frameworks/JavaVM.framework/Home -> Versions/CurrentJDK/Home 
```

反过来，这不会让您知道指向文件的*部分路径是符号链接。*

```
ls -l /System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK
lrwxr-xr-x  1 root  wheel  3 Feb 24 12:58 /System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK -> 1.5 
```

哪个，只是为了完成这个故事，是另一个符号链接

```
ls -l /System/Library/Frameworks/JavaVM.framework/Versions/1.5
lrwxr-xr-x  1 root  wheel  5 Feb 24 12:58 /System/Library/Frameworks/JavaVM.framework/Versions/1.5 -> 1.5.0 
```

最后指向一个“真实”文件夹。

是否有任何工具可以以某种方式（图形或纯旧文本）为您可视化完整的链接链？我敢肯定，一个人可以自己编写脚本（如果你愿意，请这样做并分享！），但这似乎是一种充满“哦，废话，边缘案例。哦，废话，另一个边缘案例”。我希望有人已经去打扰了。

我从事自由职业/合同工作，每个人在 Web 服务器上安装 PHP 应用程序时使用的符号链接略有不同。我的一半工作通常是取消嵌套（不可避免地）未记录的层次结构，以便我们知道将新代码/模块放在哪里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T21:03:44.997

Tcl 有一个命令 [file type $filename] 如果它是一个链接，它将返回“链接”。它有另一个命令 [file link $filename] 将返回链接指向的内容。使用这两个命令，可以获取链接并按照链接进行操作，直到找到实际文件。

也许像这样在我脑海中浮现：

```
#!/usr/bin/tclsh

proc dereferenceLink {path {tree {}}} {
    if {[file type $path] == "link"} {
        set pointsTo [file link $path]
        if {[lsearch -exact $tree $path] >= 0} {
            lappend tree $path
            return "[join $tree ->] (circular reference)"
        } else {
            lappend tree $path
            return [dereferenceLink $pointsTo $tree]
        }
    } else {
        lappend tree $path
        return [join $tree "->"]
    }
}

puts [dereferenceLink [lindex $argv 0]] 
```

您将获得如下所示的输出：

> foo->bar->baz

如果有一个循环链接，它将如下所示：

> foo->bar->baz->foo（循环引用）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T21:03:45.060

`print`如果您在循环中添加了一个，则此 python 脚本会执行此操作：

[http://mail.python.org/pipermail/python-ideas/2007-December/001254.html](http://mail.python.org/pipermail/python-ideas/2007-December/001254.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T21:05:35.163

这是我不久前为了做到这一点而拼凑起来的一个 bash 脚本。它在输出中找到“>”，该“>”`ls`指示用于遍历链接的符号链接。我不能保证在边缘情况下的完美行为（例如，为了避免循环，在遵循十个链接后很难放弃），但它对我来说效果很好。

```
#!/bin/bash

函数 deref() {

    文件="${1%/}"
    计数=0
    而 [ -L "$FILE" ]; 做
        目标=`ls -l "$FILE" | sed -e 's/^.*> //'`
        [ ${TARGET:0:1} == "/" ] || TARGET="`目录名 $FILE`/$TARGET"

        # 去除尾部斜杠；-L 无法处理那些
        FILE="${TARGET%/}"

        计数=$(( 计数 + 1 ))
        [ $COUNT -eq 10 ] && 退出 1
    完毕
    回显 $FILE

}

取消引用“$ 1”

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T20:55:15.173

如果您只需要知道最终所指对象，php 具有可以做到这一点的[realpath](http://php.net/realpath)函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T21:13:00.467

在 PHP 中，您可以使用[`is_link`](http://www.php.net/is_link)和[`readlink`](http://www.php.net/readlink)。

示例用法：

```
function dereference_link($path) {
  $parts = array();
  foreach (explode(DIRECTORY_SEPARATOR, $path) as $part) {
    $parts[] = $part;
    $partial = implode(DIRECTORY_SEPARATOR, $parts);
    if (is_link($partial)) {
      $result = dereference_link(readlink($partial) . substr($path, strlen($partial)));
      array_unshift($result, $path);
      return $result;
    }
  }
  return array($path);
} 
```

# perl - 如何管理您的 Perl 应用程序开发、构建和部署？

> ID：655986
> 
> 赞同：46
> 
> 时间：2009-03-17T20:53:05.600
> 
> 标签：perl

我还没有想出一种令人满意的方法来管理我的 Perl 应用程序的开发、构建和部署。我想听听您是如何解决这个问题的和/或您希望在您现在没有的应用程序构建系统中拥有什么。

请描述您的应用程序类型（它是一个 Web 应用程序，它是否在服务器上运行，或者您是否使用 PAR 或 PerlApp 捆绑它，以便您可以在 perlless 系统上运行）。

构建系统应提供的关键内容：

*   图书馆的控制。
    *   应该可以将库分发检查到我的 dev 目录中以在我的构建中使用它。
    *   `@INC`使用将使用适当目录的值执行 perl 应该很容易。
    *   应该可以从系统 perl 安装中获取模块列表。
*   Makefile/构建集成
    *   `make test`只需发出一个或类似的命令，就应该很容易在整个应用程序中进行全局测试。
*   版本控制友好
    *   结构不应干扰 CVS、SVN 和其他版本控制系统的正常使用。
*   跨平台
    *   系统至少应在 Win32 和 Unix 派生系统上运行。
    *   理想情况下，工具应该在 perl 运行的所有地方都具有相同的功能。
*   单个 Perl 安装
    *   作为设置环境的一部分，不必将 perl 安装到特殊目录中。
*   轻松启动
    *   启动应用程序应该是一个大部分自动化的过程。类似于 Module::Starter 或 h2xs 的东西应该可用于布局基本结构并创建任何标准文件。

**交叉张贴在[Perlmonks](http://perlmonks.org/?node_id=751283)。**

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-18T20:06:33.720

关于这个我可以写很多

1.  库的控制——我只用我想要的模块创建我自己的 CPAN 版本。最新版本的[App::Cpan](http://search.cpan.org/dist/App-Cpan)具有多项功能，例如`-j`加载一次性配置的选项，以帮助解决此问题。一旦你有了这个，你可以将它分发到一个包含所有模块、CPAN.pm 配置和你需要的所有其他东西的拇指驱动器或 CD 上。通过一点编程，您可以创建一个`run_me`脚本来实现这一切。

2.  Makefile/Build 集成 - 我不集成 Makefile。这就是灾难之路。相反，我使用顶级应用程序模块进行集成测试，该模块也会自动测试其所有依赖项。切换到 cpan 命令对于`-t`测试当前工作目录中的模块很有用：

    cpan -t。

您也可以使用各种集成测试框架。您将 PERL5LIB 设置为空（在硬编码的 @INC 目录中只有核心模块），因此`cpan`必须从头开始安装所有内容。

3.  版本控制友好 - 你使用什么并不重要。大多数东西都有某种出口，你可以在没有源代码控制的情况下获得所有东西。Git 非常好，因为它在正常情况下只有最低限度的污染。

4.  跨平台——我提到的一切都可以在 Windows 和 Unix 上正常工作。

5.  单个 Perl 安装 - 这部分比较棘手，我认为你走错路了。任何时候多个事物必须依赖于同一个 perl，就会有人为其他事物搞砸了。我绝对建议不要使用系统 Perl 进行应用程序开发，以免弄乱系统的操作。至少，每个应用程序都应该将所有非核心模块安装到它们自己的目录中，这样它们就不会与其他应用程序竞争。

6.  轻松启动 - 这只是一个简单的编程问题。

奖励：我不使用 Module::Starter。这是错误的方法，因为您必须依赖 Module::Starter 认为您应该做什么。我使用[Distribution::Cooker](http://search.cpan.org/dist/Distribution-Cooker)，它只是获取 Template Toolkit 模板的目录并处理它们以提供您的分发目录。你可以做任何你喜欢的事情。如何获得初始模板取决于您。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-18T06:20:18.683

我在一个非常小的网站应用程序上工作，我们只是在改进我们的部署（改进它从“花一天时间在 Windows 上设置我们需要的所有模块，然后向它扔文件直到一切正常”，所以这是一些改进）。

我们需要做三件事来建立我们的网站：

1.  使用 制作的 Perl 模块`Module::Starter`，包含一个`Config`包含站点范围配置选项的模块。在安装时，这个模块（使用`MakeMaker`'s`PREREQ_PM`检查我们需要的所有模块是否已经安装）。在安装此模块之前不需要安装的任何模块。
2.  需要执行一些 SQL 文件来设置数据库。
3.  构成网站的 Perl CGI 文件。只要 Apache 指向它们，该网站“就可以正常工作”。这包括所有 Perl 文件使用的公共代码模块。

部署包括我从每个人的 Git 分支中提取并打包一个版本。然后，我们可以将其移交给本地或 Amazon EC2 实例进行测试。一旦我们准备好发布，我们要么将它安装在上一个版本上，要么将数据库移动到测试实例并使其*成为*新实例。

将此与您的标准进行比较：

1.  图书馆的控制：有点。我们非常广泛地使用 CPAN 模块。为了尝试新版本，我们在生产服务器上进行升级之前升级我们自己的模块版本。我们手动维护一个列表，但由于我们的代码库相当小，因此不难确定正在使用哪些模块（例如，通过`grep`ing 开头的行`use`）。
2.  Makefile/Build 集成：是的。任何与 Makefile 相关的东西都由我们的 EU::MM 设置完成。我们没有全局测试，但由于我们的整个测试套件最近都放在一个文件夹中，希望我们很快就会有一些可以`prove`直接运行的东西。
3.  版本控制友好：是的。我们的整个源代码都包含在一个文件夹中，没有太多重复。
4.  跨平台：是的。我们在 MakeMaker 中发生了很多奇怪的事情，让我们能够做到这一点，但作为一家初创公司，拥有跨平台代码为我们提供了宝贵的灵活性。我们尝试尽可能多地使用 Perl 的核心模块和工具，以及来自 CPAN 的纯 Perl 模块。
5.  单个 Perl 安装：是的。我们可以在任何地方处理 Perl，并在任何设置下安装，只要 Perl 自己的所有模块工具都可以工作 - 已经付出了很多努力`CPAN`，`EU::MM`其他人在所有系统上都能很好地工作，浪费似乎很可耻它。
6.  轻松启动：并非如此。这个系统是从一个包含所有源文件的文件夹和一个包含需要安装的模块列表的文本文件演变而来的（即：不是智能设计的）。虽然对已安装模块的正式测试是一个巨大的改进，但我们仍然需要大约一天的时间来设置它，主要用于安装我们的必备模块（并非所有模块都易于在 Windows 上安装）。我希望使用[Perl Win32 社区](http://win32.perl.org/)来尝试解决有问题的 CPAN 模块的问题。

请注意，这是一个*非常*简单的网站，没有 XS、复杂的 Web 框架或任何类似的东西。我们也仅通过大约两个版本支持此设置，因此随着代码变得更加复杂并且我们的部署平台变得更加多样化，我们没有足够的经验来了解这将如何工作。我非常感谢对我们系统的任何建议或意见。

# android - Android 布局 - ImageView 的对齐问题

> ID：655994
> 
> 赞同：43
> 
> 时间：2009-03-17T20:56:32.720
> 
> 标签：android, layout, android-imageview

我试图将图像放在 a 的左上角`LinearLayout`，但图像边框和填充占据了整个窗口的宽度。

如果我尝试下面的 XML，我会得到我的图像，它的边框和整个页面宽度上的白色背景，*除了*图像最终**居中**，并且不会向左移动。

```
<ImageView
    android:layout_width="fill_parent"
    android:layout_height="wrap_content"
    android:layout_gravity="left"
    android:src="@drawable/banner"
    android:background="@android:color/white"
    android:padding="@dimen/d_8px"
/> 
```

是否有一些我尚未发现的属性强制图像在设置为时`ImageView`左`layout_width`对齐`fill_parent`？

与此同时，我已经解决了这个问题，方法是把`ImageView`另一个放在里面`LinearLayout`，然后把一个空的放在`TextView`它的右边，占据其余的水平空间。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-03-19T04:58:41.587

我有一个类似的问题，你今天早些时候回复了。这是 Eclipse 插件与 XML 编辑器并排提供的“屏幕设计”查看器，还是您在实际运行应用程序时遇到对齐问题？如果是前者，那是插件中的错误，如果是后者，请尝试添加：

```
android:scaleType="fitStart" 
```

从我读过的文档来看，这似乎最接近您的需要。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-09-08T18:46:28.227

只需在布局 XML 文件中配置 ImageView，如下所示：

```
 <ImageView android:id="@+id/imageViewName" 
                            android:layout_width="90dp" 
                            android:layout_height="90dp" 
                            android:scaleType="fitStart" 
                            android:adjustViewBounds="true" 
                            android:padding="10dp" 
                            android:src="@drawable/ic_contact_picture"
                            android:background="@color/white" /> 
```

# c++ - 现代 C++ 设计 通用编程和设计模式应用

> ID：655997
> 
> 赞同：19
> 
> 时间：2009-03-17T20:57:59.487
> 
> 标签：c++, design-patterns, templates

我为我们公司的团队购买了这本书，也许是为了提高我们的设计技能并最终拥有更好的编程实践。当我阅读它时，我发现，大多数情况下，一组可以与模板一起使用的漂亮技巧，并且不确定是否值得 - 并且无害 - 将其合并到我们的代码中，从而引入代码复杂性/可读性和不可维护性.

我想从跟随练习者那里了解一下，你从那本书中使用了什么？什么与专业软件开发相关和重要，应该避免什么？

一般认为这本书以及它如何适合大型系统的软件开发（在同一本书中，我喜欢 John Lakos 的书）？

什么是亚历山德雷斯库效应？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-17T21:06:08.783

在标准模板使用之外，我发现有关通用 C++ 编程的信息中最有用的操作是使用模板为无效代码场景创建编译时错误的能力。一旦你掌握了它的窍门，你就可以非常有效地将一类运行时错误转化为编译时错误。

我在工作中取得了很大的成功。当然，它会产生完全不可读的消息，我的同事偶尔会过来问“这到底是什么？”。但每次它都是一个错误，他们无法编译它。我还大量评论了特定的错误，希望它是可以理解的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-17T21:05:38.657

大约在 2005 年左右，我深入研究了表达式模板和各种编译时技巧，用于制作非常易于使用的库，例如嵌入在 C++ 中的内部特定领域语言。特别是一个相当完整的嵌入式 SQL 东西，类似于后来在 .NET 上作为 Linq 出现的东西。

对于用户来说，这很好。但是对于除了我之外的任何其他人试图维护它，它呈现出一个非常陡峭的学习曲线。这就是问题所在；像任何“聪明”的技术一样，它减少了可以维护它的人的数量。

这对于广泛使用的类库来说很好，普通用户永远不需要了解它的内容。但是对于特定团队拥有的“内部”库，他们可能都需要能够对其进行修补或明智地扩展它。根据我的经验，C++ 模板更神秘的可能性似乎排除了这一点。

不过这很有趣。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T21:06:10.623

如果您的公司/项目允许提升。这本书将帮助你发现一些提升魔法，只是为了你自己的满足。

如果您的公司/项目不允许提升。这本书将是一个很好的指南，可以重新创建一些你最需要的 boost 部分，比如 boost::function。

我相信在每个项目中都有某种实用模块。通过借用一些书籍建议的模式和 SFINAE 技巧，这样的书将帮助您使您的“实用程序”更加通用和安全。

最重要的是，本书将展示如何重新思考一些 GOF 设计模式，通过静态改变运行时多态性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T21:18:52.120

*   我直接从书中使用什么？没什么——我不使用 Loki 或 Boost。
*   它影响了我的代码吗？不是真的——在我读这本书之前，我对政策的概念很熟悉
*   值得一读吗？确实！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T21:29:44.577

对我来说，这更像是一次开阔视野的经历。我通读了这本书，不断地学习细节和技巧，其中一些我以后会用到。但最重要的部分是本书一直在讨论大写 D 的设计（D 语言没有双关语）。

关于智能指针的章节将我的“提供所有可能的功能”的心态转变为更加保守：考虑你提供的东西，是否值得？它怎么能破解密码？它会帮助用户吗？它会通过创建微妙的陷阱使代码变得脆弱吗？

基于策略的设计部分应该让您在设计您的类是否可以/应该更好地划分为更小的正交单元时有所作为。虽然在大多数情况下，我并没有结束划分所有这些策略类，但代码通常最终会变得更清晰，因为不同的正交部分变得更少纠缠。

哦，作为 Earwicker，我的第一反应是实现真正加速部分开发的花哨的东西，但话又说回来，在我工作的小公司中，我是唯一能够维护它的人，这确实是一个问题。不要过度。调试和维护所需的大脑是开发所需的两倍。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T21:02:39.680

恕我直言，阅读（并理解！）本书的第一章很有用（我相信它甚至可以免费在线获得）。本书的其余部分几乎描述了 Loki 库的内部结构，我并不真正推荐它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T22:13:28.993

我没有使用 Loki，但我在之前的工作中积极使用了 boost。Boost 实现了这本好书中的许多想法；

本书中的内容不适合在业务逻辑中使用，它们应该在库（Boost、Loki、您自己的东西）和业务逻辑中使用的库中实现。这是“在代码中使用这个技巧”或“在大多数代码中使用这个技巧并使用漂亮的库来实现分离的库”（例如 boost::bind - 丑陋的实现但使用起来很好 - 但你几乎从未见过这个实现）”

本书还展示了强大的 C++ 元编程和良好的大脑训练。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T08:29:10.200

当我说使用现代 C++ 设计中的东西时，我确实经历了一些粗鲁的反应。首先，WTF评论。紧随其后的是“不要太聪明”的评论。然后，更好地理解这些想法。然后，最后，接受这些想法，使其成为通用词汇的一部分。

确保将这本书的多份副本放在手边。理想情况下，为每个开发人员购买一份副本。此外，在这些东西成为开发人员常用的词汇之前，请在您的评论中引用模式/成语和相关页面。

# sql - Access 中的多个更新查询

> ID：655999
> 
> 赞同：1
> 
> 时间：2009-03-17T20:59:08.113
> 
> 标签：sql, ms-access, vba

使用 Access 2007，我有一个更新，我正在尝试构建一个脚本或宏，甚至只是一个有用的 SQL 块，我可以在我想运行更新时保留和使用它......

...我已经想出了如何使用更新查询来做到这一点，但是，我不想每次我想更新时都花一个小时左右...

基本上，我是从旧到新的交叉行走办公室符号......但所有旧办公室符号都需要更新：

这是访问中的 SQL 视图：

```
UPDATE [Actions Completed - Back UP] 
SET [Actions Completed - Back UP].OFC_NEW = [UPDATE TO:]
WHERE ((([Actions Completed - Back UP].OFC) Like [old])); 
```

我使用提示来浏览我的更改列表...

谢谢！

约珀史密斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T17:48:19.450

我建议您创建一个包含所需更改的表：

```
OldCode  NewCode
SYK      SYSW
SMC/PK   SYSW
AXK      SMC/PK 
```

等等。

然后，您可以轻松地运行更新查询：

```
UPDATE tblTable 
INNER JOIN tblNewCodes ON tblTable.Code = tblNewCodes.OldCode
SET tblTable.Code = tblNewCodes.NewCode 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T00:58:02.297

我认为你必须更多地描述你的问题，你想要达到的目标并不完全清楚：解释你正在跟踪什么，你的表格是如何制作的以及它包含什么。

话虽如此，使用数据表表单是输入数据的一种非常简单的方法（Access 2007）：

*   点击你的`Actions Completed - Back UP`桌子。
*   创建一个新的数据表表单（表单 > 更多表单 > 数据表）
*   您可以隐藏不想出现的列（右键单击并选择隐藏）
*   您可以锁定您不想错误编辑的列（在属性表>数据>锁定=是）
*   您可以对列表进行排序和预过滤（将表格放在 Home > View 中的 Design 视图中，单击表格，然后在 Data 下的 Property Sheet 中，您可以更改*Order By*和*Filter*）
*   查看数据时，您还可以根据列过滤器过滤列表（单击列标题中的三角形，您将获得过滤选项列表，如 Excel）。

您现在应该能够比填写输入框更快地编辑数据。

您可以做更多有趣的事情，但是由于我们对您的问题知之甚少，因此很难知道它是否会有所帮助。`******