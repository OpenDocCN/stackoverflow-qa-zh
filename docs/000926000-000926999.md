# StackOverflow 问答 000926000-000926999

# gnu - 在 HP-UX 上编译 GNU 软件。yy* 符号问题

> ID：926000
> 
> 赞同：2
> 
> 时间：2009-05-29T13:35:30.940
> 
> 标签：gnu, compilation, hp-ux

当试图在 HP-UX（例如 binutils）上编译 GNU 软件时，我收到关于不满足符号 yyfnd、yyextra、yytextuc、yyolsp 的错误消息...

某些软件无法使用 HP-UX 自己的 lex 进行编译，因此我在我的 PATH 中包含了 byacc 和 flex 可执行文件。是 HP-UX lex 的问题吗？如何解决？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T13:46:43.460

您是否尝试过使用`-lfl`和/或构建`-ly`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T13:52:13.650

您真的需要 flex 功能还是可以尝试 export LEXLIB=" " ？

# java - Apache Rampart 是否与 Maven 一起使用？

> ID：926004
> 
> 赞同：5
> 
> 时间：2009-05-29T13:36:26.490
> 
> 标签：java, apache, soap, axis2, rampart

在我正在工作的项目中，我们使用 maven 来管理依赖项。但是，我们遇到了 Apache 壁垒问题，它是 Axis2 的安全模块。我们尝试使用以下依赖项标签：

```
 <dependency>
        <groupId>org.apache.rampart</groupId>
        <artifactId>rampart</artifactId>
        <version>1.3</version>
        <type>mar</type>
    </dependency>

    <dependency>
        <groupId>org.apache.rampart</groupId>
        <artifactId>rampart</artifactId>
        <version>1.4</version>
        <type>mar</type>
    </dependency> 
```

发生的情况是 maven 无法找到作为依赖项包含在 armart pom 文件中的许多资源（请注意，rampart pom 文件是由 maven 自动下载的，所以我不应该编辑这些文件）。

当输入 maven 无法找到的壁垒依赖项的 URI 时，我收到 404 错误。看起来 apache 壁垒 pom 文件已损坏...

有人成功地使用了maven的壁垒吗？是 apache 壁垒与 maven 的集成坏了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-29T13:47:33.610

我刚遇到这个问题并找到了解决方法。不是添加壁垒依赖，而是在壁垒标准 dist 中添加所有库，即：

```
 <dependency>
        <groupId>org.apache.rampart</groupId>
        <artifactId>rampart-core</artifactId>
        <version>1.4</version>
        <exclusions>
            <exclusion>
                <groupId>bouncycastle</groupId>
                <artifactId>bcprov-jdk15</artifactId>
            </exclusion>
            <exclusion>
                <groupId>opensaml</groupId>
                <artifactId>opensaml</artifactId>
            </exclusion>
            <exclusion>
                <groupId>org.apache.santuario</groupId>
                <artifactId>xmlsec</artifactId>
            </exclusion>
        </exclusions>
    </dependency>

    <dependency>
        <groupId>org.bouncycastle</groupId>
        <artifactId>bcprov-jdk15</artifactId>
        <version>1.44</version>
    </dependency>
    <dependency>
        <groupId>org.opensaml</groupId>
        <artifactId>opensaml</artifactId>
        <version>1.1</version>
    </dependency>
    <dependency>
        <groupId>org.apache.santuario</groupId>
        <artifactId>xmlsec</artifactId>
        <version>1.4.3</version>
    </dependency> 
```

注意：我更新了一些壁垒标准 dist 的版本，因为其中一些不在 maven 存储库中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-06T16:18:54.833

由于 .mar 包装，这是一个大问题，我真的很讨厌axis2项目选择工作的方式，无论如何你可以通过添加rampart-*.mar和所有必需的*.mar来获得这个工作

```
WEB-INF/lib 
```

文件夹，如果该文件夹不存在，则需要创建该文件夹。

并以 maven 的正常方式管理其他依赖项，例如：

org.apache.rampart 壁垒核心 1.4

```
<dependency>
    <groupId>org.apache.axis2</groupId>
    <artifactId>axis2-kernel</artifactId>
    <version>1.4.1</version>
</dependency> 
```

# apache-flex - 如何在 Flex 中将文件转换为 ByteArray？

> ID：926007
> 
> 赞同：1
> 
> 时间：2009-05-29T13:37:15.787
> 
> 标签：apache-flex, file-io

我想知道如何将我服务器上的文件（pdf/excel/ppt）转换为 ByteArray。我想这样做的原因是向用户显示打开/保存的对话框，并且我必须将 Content-Type 设置为八位字节流。对话显示很好，只是 navigateToURL() 但对于 pdf，它是用户的本地浏览器设置。对于 URLRequest，我必须将数据设置为 ByteArray。我正在尝试使用位于此处的代码：

> [使用 Flex 进行自定义打印](http://kalengibbons.com/blog/index.php/tag/custom-printing-with-flex/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T16:56:35.183

如果您的目标是 Flash Player 10，这应该可以工作：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="loadFile()">

    <mx:Script>
        <![CDATA[

            private var loadedFile:ByteArray;

            private function loadFile():void
            {
                var request:URLRequest = new URLRequest("http://test.enunciato.org/sample.pdf");
                var urlLoader:URLLoader = new URLLoader(request);

                urlLoader.addEventListener(Event.COMPLETE, onURLLoaderComplete);
                urlLoader.dataFormat = URLLoaderDataFormat.BINARY;
                urlLoader.load(request);
            }

            private function onURLLoaderComplete(event:Event):void
            {
                loadedFile = event.target.data;
            }

            private function saveLoadedFile():void
            {
                var file:FileReference = new FileReference();
                file.save(loadedFile, "SampleDoc.PDF"); 
            }

        ]]>
    </mx:Script>

    <mx:Button label="Save Image" horizontalCenter="0" verticalCenter="0" click="saveLoadedFile()" />

</mx:Application> 
```

Assuming you load the file first -- in this example, the load operation happens on creationComplete, and the bytes get stored off in loadedFile -- the bytes should be and ready for saving when the user clicks Save Image. Tested and verified the example works. Hope it helps!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:54:59.053

我认为您可以执行以下操作来获取字节数组：

```
private var fileBytes:ByteArray = null;

private static function loadByteArray(url:String):void {
      var loader:Loader = new Loader();

      loader.contentLoaderInfo.addEventListener(Event.COMPLETE, 
      function(e:Event):void {
        fileBytes = e.currentTarget.bytes;
      });
      loader.load(new URLRequest(encodeURI(url)));
}

// static initializer
{ loadByteArray("my url here"); } 
```

编辑：我没有测试上述功能。如果您想直接加载字节，我建议使用 Christian Nunciato 的答案，因为他的答案更好并且经过实际测试。

但是，这听起来更像是您想直接从服务器检索文件，而不是进行三路旅行（文件来自服务器，您将字节发送回服务器，然后最终返回客户端） . 在这种情况下，您可以尝试在服务器上将内容类型和内容配置设置为附件（例如，对于 pdf，这意味着将内容类型设置为“application/pdf”并添加“Content-Disposition: attachment; filename=myFileName. pdf”到您的响应标题）。

# c++ - 分布式算法编程的帮助库？

> ID：926010
> 
> 赞同：3
> 
> 时间：2009-05-29T13:39:14.677
> 
> 标签：c++, algorithm, distributed-computing, distributed-algorithm

当您编写分布式算法时，您是否使用任何库来对处理器、寄存器、消息、链接等抽象事物进行建模？有没有这样做的图书馆？

我正在考虑例如自稳定算法，例如自稳定最小生成树算法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T13:42:53.373

有一个[DVM 系统](http://www.keldysh.ru/dvm/)可用于实现不同的分布式算法。[它在MPI](http://www.mpi-forum.org/)之上工作。

然而，它更适用于面向矩阵的科学算法，其中分布是根据数据块完成的。我有一个简短的使用它的经验——它比直接使用 MPI 方便得多，并且允许代码更具可读性和可维护性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T23:06:13.327

您可能想查看[OpenMP](http://en.wikipedia.org/wiki/OpenMP)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-23T13:54:51.593

我认为您可能会发现分布式 Apache 项目会有所帮助：

*   [Apache Hadoop](http://hadoop.apache.org/common/docs/current/hdfs_design.html)提供分布式文件系统和处理
*   [Apache Zookeeper](http://hadoop.apache.org/zookeeper/docs/current/zookeeperOver.html)是一个协调服务，它可能就在你身边。它可以用作公共订阅机制。

还有[Java 并行处理框架](http://www.jppf.org/)，它抽象了整个机器及其组合，让您可以专注于处理。

取决于你的需要。

# sql - 运行慢查询的简单 MySQL 表

> ID：926015
> 
> 赞同：3
> 
> 时间：2009-05-29T13:39:59.947
> 
> 标签：sql, mysql, performance, myisam

我有一个非常简单的表，有两列，但有 450 万行。

```
CREATE TABLE `content_link` (
  `category_id` mediumint(8) unsigned NOT NULL,
  `content_id` int(10) unsigned NOT NULL,
  PRIMARY KEY  (`content_id`,`category_id`),
  KEY `content_id` (`content_id`,`category_id`)
) ENGINE=MyISAM; 
```

当我运行一个简单的查询时：

```
SELECT
    *   
FROM
    content_link
WHERE
    category_id = '11'; 
```

mysql 在返回大约 10 行之前会占用 CPU 并需要 2-5 秒。数据非常均匀地分布在整个表中，并且我正在访问索引字段（我还分析/优化了表并且我从未更改表的内容），那么查询需要这么长时间的原因是什么？

编辑： 似乎navicat 在对我撒谎，而我的主键实际上并没有按正确的顺序键入，因为它正在向我显示表格。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-29T13:45:07.487

`category_id`不是任何索引中的第一列。

重新创建您的辅助密钥，如下所示：

```
UNIQUE KEY `ix_category_id` (`category_id`, `content_id`) 
```

请注意列顺序，这很重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-10T22:39:18.453

UNIQUE KEY 排序是一个很好的解决方案，您也应该在表中添加分区策略。

通过对表进行分段分区，MySQL 将使用正确的数据集查询特定分区。我已经申请了，我取得了很好的成绩。

```
CREATE TABLE ti (id INT, amount DECIMAL(7,2), tr_date DATE)
ENGINE=INNODB
PARTITION BY HASH( MONTH(tr_date) )
PARTITIONS 6; 
```

你需要 MySQL 5.1。

试试[http://dev.mysql.com/doc/refman/5.1/en/partitioning.html](http://dev.mysql.com/doc/refman/5.1/en/partitioning.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T13:50:17.993

您没有使用索引。当您有一个复合索引时，`(content_id, category_id)` 您可以通过 using 使用索引，`content_id`也可以使用`content_id`and `category_id`。您不能使用`category_id`和利用索引。

尝试改变：

```
KEY `content_id` (`content_id`, `category_id`) 
```

到

```
KEY `category_id` (`category_id`, `content_id`) 
```

# delphi - delphi win 32 应用程序使用什么模式构建层

> ID：926017
> 
> 赞同：7
> 
> 时间：2009-05-29T13:40:10.010
> 
> 标签：delphi, hibernate, activerecord, data-access-layer

我想使用 dbexpress 开发 mysql 数据库应用程序以从头开始开发或使用现有数据库。要创建可重用层，我应该使用什么模式组件。我希望该应用程序可以轻松扩展到 n 层。尝试 google 搜索现成的框架，但我没有发现任何信息（有些缺少文档，有些缺少示例）。

著名的 java 框架 i.batis 或 hibernate 中的某些东西会很有用。我熟悉在 PHP 中使用这样的框架来开发 xml 定义的业务对象。我试图将它转换为 Delphi，但它是一项很大的工作。（使用 delphi 严格输入的抽象使我的经验水平变得很困难。）

类似 ruby​​ on rails activerecord 的实现也可能很有用。

我永远不清楚是否丢弃 dbaware 组件。

我尝试实现一些设计模式来分离层（数据访问/连接）、（业务对象）、（gui），但没有成功。我试图实现的是模仿乐高（我可以使用任何数据库引擎，任何delphi数据库技术（bde，ado等。dbexpress是必须的，其他是可选的）。我也可以使用xml（mybase或native），文本文件（类似 csv 的遗留解析代码）

我可能需要单层、客户端/服务器和 n 层。

另外我可能需要某种Web服务实现（客户端可能是除了delphi可执行文件之外的任何技术，所以我认为生成xml，wsdl是必要的）

数据访问层是最重要的部分。它必须灵活，因为将在其上开发其他框架（用户身份验证、应用程序配置等）。

*   我可能会挑战开发自己的简单框架（我不知道要遵循什么：数据库适配器模式、数据库连接工厂、映射器、数据访问对象等。）
*   我可以使用现有的（即时对象不适用。不适用于现有的数据库模式）。我尝试过的其他一些缺乏 dbexpress 支持，或者我无法理解配置。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T15:33:30.453

Mohammed 的回答涵盖了您问题的 n 层部分。与 i.batis 或 hibernate 相似的部分将您推向面向对象的持久性框架，例如 tiOPF，它们有点不同。

这是我目前知道的 Delphi 持久性框架列表。我相信 CG 还在 Delphi Live 上做了某种持久性演示，所以可能会有其他东西出现。

*   [InstantObjects](http://www.instantobjects.org) ** Delphi 2009/2010 支持现在在 SVN 中
*   [PressObjects SDK](http://www.pressobjects.org)
*   [tiopf](http://tiopf.sourceforge.net)
*   [Jazz-SDK](http://code.google.com/p/jazz-sdk)
*   [对象](http://www.macrobject.com/en/dobject/index.htm)
*   [基础设施](http://code.google.com/p/infra)
*   [EOS](http://sourceforge.net/projects/camelos)
*   [g-框架](http://code.google.com/p/g-framework)
*   [简单的 MVC](http://sourceforge.net/projects/emvc)
*   [Delphi 持久对象](http://sourceforge.net/projects/depo)
*   [hcOPF](http://sourceforge.net/projects/larryhengensopf/) -- 刚刚发现这个 9/2009
*   德尔福的大胆 - 最后一次看到 ECO 附近的某个地方；）

FWIW - 我在几个商业产品中使用了 InstantObjects (IO)（尽管是以非标准方式），并且正在开发到 Delphi 2009 的端口。PressObjects 是由一位 IO 开发人员开发的，我最近加入了该项目，因为它看起来很有趣. 自 YMMV 以来，我不会打折像 tiOPF、Jazz 等框架。我会通过评论对这些框架造成伤害，因为我没有在简单的测试用例之外使用它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T15:15:16.540

If you would like to build Delphi n-Tiers solutions, that be access from diffrent clients (Non Delphi), you have these options:

1.  [RemObjects' DataAbstrct.](http://www.dataabstract.com/da/tour.aspx)
2.  [kbmMW](http://www.components4programmers.com/products/kbmmw/index.htm)
3.  MIDAS/DataSnap built in Delphi

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T14:26:27.077

在我的公司，我们使用 tiOPF 框架来实现这一点。它使用多种模式将 GUI 与对象模型分开。它包括一个数据库层，可以连接到几乎任何数据库或文本文件。

要将非数据感知控件链接到模型，有几个可用的中介。有了更多经验，您可以编写自己的调解器。例如，我们编写了几个中介来链接到 DevExpress 控件。

框架背后的概念文档很好。对于所有其他问题，有一个所有核心开发人员经常访问的新闻组。

看看[tiOPF](http://tiopf.sourceforge.net/)网站！

# ios - iphone sim 号码

> ID：926018
> 
> 赞同：-1
> 
> 时间：2009-05-29T13:40:10.337
> 
> 标签：ios, iphone, phone-number

> **可能重复：**
> [在 iPhone OS 中以编程方式获取自己的电话号码](https://stackoverflow.com/questions/193182/programmatically-get-own-phone-number-in-iphone-os)

如何在 iPhone 中获取电话号码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-09-26T09:58:08.250

答案是否定的，你不能...... SDK 不能帮助你。但是，通过 CoreTelephony 框架 (4.x+)，您可以获得网络代码、网络名称等信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-31T13:43:22.870

有趣的阅​​读：[http ://www.kuberan.me/2011/03/your-mobile-numbers-are-being-stolen-by-websites/](http://www.kuberan.me/2011/03/your-mobile-numbers-are-being-stolen-by-websites/)

# sql - 从单个存储过程中的多个插入/选择的表中检索自动递增的列值

> ID：926020
> 
> 赞同：5
> 
> 时间：2009-05-29T13:40:25.563
> 
> 标签：sql, sql-server, stored-procedures

我有一个包含多个插入/选择语句的存储过程。假设我正在使用第一个插入来填充“经理”表。在插入时，会添加一个 ManagerId（自动递增），但不会在插入语句中引用。然后我希望使用该表中的 ManagerId 将一行插入另一个表，其中 ManagerId 是外键。示例代码如下..

```
USE [TEST]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[sptInsertNewManager]
    -- Add the parameters for the stored procedure here
    @FName varchar(50),
    @LName varchar(50),
    @EMail varchar(100),   
    @UserRoleID int,
    @LANUserID varchar(25), 
    @GroupID int
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    -- Insert statements for procedure here
INSERT INTO [Manager]           
          ([FName], 
           [LName],
           [Email], 
           [UserRoleID],
           [LANUserID],          
           [ActiveFlag],
           [GroupID]
)
     VALUES
            (@FName
            ,@LName
            ,@EMail
            ,@UserRoleID
            ,@LANUserID
            ,1 
            ,@GroupID);

COMMIT

SELECT ManagerId FROM [Manager] AS newManager WHERE LANUserID = @LANUserID; 
        --also insert into Users table.
    INSERT INTO [dbo].[aspnet_Users] (
        [UserId],
        [UserName],
        [LoweredUserName],
        [ManagerId]
    )
        VALUES (
            NEWID(),
            @LANUserID,
            LOWER(@LANUserID),
            newManager)
END 
```

这显然是行不通的。这是我解决这个问题的尝试。我对 SQL 相当陌生，因此将不胜感激任何有关此问题的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T13:44:56.117

在插入后使用 scope_identity() 从当前范围内捕获最新的单个标识值：

```
DECLARE @ID     int

INSERT ......
SELECT @ID=scope_identity() 
```

在需要的地方使用@ID

注意：SCOPE_IDENTITY() 比旧的@@IDENTITY 更受欢迎，因为它给出了当前范围内的最后一个标识值，这避免了插入日志表（带有标识）的触发器的问题。

但是，如果您需要多个标识值（插入一组行），请使用 OUTPUT 和 INTO：

```
declare @test table (RowID  int identity(1,1) primary key not null, RowValue varchar(10) null)
declare @OutputTable table (RowID int not null)

insert into @test (RowValue)
    OUTPUT INSERTED.RowID
    INTO @OutputTable
    SELECT 'A'
    UNION SELECT 'B'
    UNION SELECT 'C'
    UNION SELECT 'D'
    UNION SELECT 'E'

select * from @OutputTable 
```

输出：

```
(5 row(s) affected)
RowID
-----------
1
2
3
4
5

(5 row(s) affected) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T13:46:40.120

用于 MS Sql 服务器

每当您插入一条记录并且它具有自动增量列（ms-sql 用语中的标识列）时，您都可以使用它来检索您插入的行的 id：

```
@id = SCOPE_IDENTITY() 
```

这可确保您获得插入生成的标识列值，而不是在代码运行期间由其他用户生成（在插入和通过*scope_identity()*获取标识之间）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T13:50:44.357

哎呀...你的过程和交易都扭曲了...

您希望这两个插入发生在同一个事务中（我是从`COMMIT`原始过程中间的语句中推断出来的）。因此，您需要在所有 and 语句周围适当地放置一个and语句，`BEGIN TRANSACTION`以隔离数据更改。`COMMIT``INSERT``SELECT`

考虑以下：

```
CREATE PROCEDURE [dbo].[sptInsertNewManager]
    -- Add the parameters for the stored procedure here
    @FName varchar(50),
    @LName varchar(50),
    @EMail varchar(100),   
    @UserRoleID int,
    @LANUserID varchar(25), 
    @GroupID int
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

DECLARE @ManagerID  INT

BEGIN TRANSACTION    

    -- Insert statements for procedure here
INSERT INTO [Manager]           
          ([FName], 
           [LName],
           [Email],     
           [UserRoleID],
           [LANUserID],          
           [ActiveFlag],
           [GroupID]
)
     VALUES
                (@FName
                ,@LName
                ,@EMail
            ,@UserRoleID
            ,@LANUserID
                ,1 
            ,@GroupID);

-- Collect the ID you just created
SELECT @ManagerID = SCOPE_IDENTITY()

        --also insert into Users table.
    INSERT INTO [dbo].[aspnet_Users] (
        [UserId],
        [UserName],
        [LoweredUserName],
        [ManagerId]
    )
        VALUES (
                NEWID(),
                @LANUserID,
                LOWER(@LANUserID),
                @ManagerID)   -- This is the new identity you just created

COMMIT

END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-21T05:08:58.833

我们可以像这样返回标识列：

```
SELECT @@identity as 'Identity' 
```

并在代码中读取此标识值，例如：

```
int ID = Convert.ToInt32(cmdinsert.ExecuteScalar()); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T21:58:25.587

也不要在事务中间提交，如果一个插入失败，您希望两个插入都回滚。阅读有关事务处理的在线书籍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T13:46:00.700

您可以使用@@Identity 全局变量来检索最后插入的标识值

```
SELECT @ManagerId=@@Identity 
```

您还可以使用 Scope_Identity 和 IDENT_Current 函数

# sql-server - 在 SQL Server 中，如何选择递归表中的所有记录？

> ID：926033
> 
> 赞同：3
> 
> 时间：2009-05-29T13:43:05.463
> 
> 标签：sql-server

我有一个递归表，其中每条记录都有一个 ID 和一个 PARENTID。PARENTID 指向同一个表中的不同 ID。SQL Server 中有没有一种方法可以在一个语句中选择整个“树”？我可以编写一个递归函数来从父级跳转到所有子级，但我想要一种在一个查询中执行此操作的方法。

在 Oracle 中，它看起来像这样：

```
select
  id,
  parentid,
  nodename
from 
  MY_SCHEMA.MY_TABLE
  connect by nocycle prior parentid = id
start with id = :starting_id_number
order by
  id 
```

SQL Server 等价物是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T14:01:43.647

这是我为您整理的一个示例。它演示了如何使用递归公用表表达式 (CTE)。

```
CREATE TABLE #tempTable
(
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    parentID INT NULL
)

INSERT INTO #tempTable (parentID) VALUES (null)
INSERT INTO #tempTable (parentID) VALUES (1)
INSERT INTO #tempTable (parentID) VALUES (1)
INSERT INTO #tempTable (parentID) VALUES (2)
INSERT INTO #tempTable (parentID) VALUES (3)
INSERT INTO #tempTable (parentID) VALUES (2)
INSERT INTO #tempTable (parentID) VALUES (5)

SELECT * FROM #tempTable;

WITH RecursiveTable (ID, ParentID, Level)
AS
(
    --Anchor
    SELECT  tt.ID, 
            tt.ParentID, 
            0 AS Level
    FROM #tempTable AS tt
    WHERE parentID IS null
    UNION ALL
    --Recursive member definition
    SELECT  tt.ID, 
            tt.ParentID, 
            LEVEL + 1
    FROM #tempTable AS tt
        INNER JOIN RecursiveTable rt ON
        tt.ParentID = rt.ID
)
SELECT * 
FROM RecursiveTable

DROP TABLE #tempTable 
```

**编辑：**作为一个额外的想法，在 SQL Server 2008 中有一种称为 hierarchyid 的数据类型，可用于实现分层数据结构。请参阅以下教程

[http://technet.microsoft.com/en-us/library/bb677213.aspx](http://technet.microsoft.com/en-us/library/bb677213.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T14:03:56.810

你可以像这样使用 CTE；

```
CREATE TABLE TestTable
( 
    ID int primary key NOT NULL,
    ParentID int
)

INSERT INTO TestTable VALUES (0, null)
INSERT INTO TestTable VALUES (1, 0)
INSERT INTO TestTable VALUES (2, 0)
INSERT INTO TestTable VALUES (3, 1)
INSERT INTO TestTable VALUES (4, 3)

-- Get branch
;WITH TreeRecCTE (ID, ParentID, IDPath)
AS
(
   SELECT ID, ParentID, CONVERT(varchar(max), ID) As IDPath
      FROM TestTable
      WHERE ParentID IS NULL
   UNION ALL
   SELECT
            Child.ID,
            Child.ParentID,
            Parent.IDPath + '.' + CONVERT(varchar(100),Child.ID) As IDPath
        FROM TestTable As Child INNER JOIN TreeRecCTE AS Parent ON Child.ParentID = Parent.ID
  )
SELECT * FROM TreeRecCTE WHERE IDPath LIKE '%.1.%' ORDER BY ParentID ASC 

-- Get complete tree:
;WITH TreeRecCTE (ID, ParentID, IDPath)
AS
(
   SELECT ID, ParentID, CONVERT(varchar(max), ID) As IDPath
      FROM TestTable
      WHERE ParentID IS NULL
   UNION ALL
   SELECT
            Child.ID,
            Child.ParentID,
            Parent.IDPath + '.' + CONVERT(varchar(100),Child.ID) As IDPath
        FROM TestTable As Child INNER JOIN TreeRecCTE AS Parent ON Child.ParentID = Parent.ID
  )
SELECT * FROM TreeRecCTE ORDER BY ParentID ASC 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T13:51:23.747

id 也有这个问题，但我没有找到解决方案。所以我创建了这个解决方法：我添加了一个新列“tree_id”，这样我的表看起来像这样。

```
treeid|id|parentid|nodename
1     |1 | null   | rootOfTreeOne
1     |2 | 1      | childOfRootOne
1     |3 | 1      | secondChild
2     |4 | null   | rootOfSecondTree
2     |5 | 4      | childofSecondTree 
```

并在程序中创建了树。优点是您可以使用一个简单的单个选择语句从树中获取所有节点。

```
select * from tree_table where tree_id = 1; 
```

但也可能有一些存储过程可以帮助您解决问题。

希望这可以帮助..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T13:53:02.307

我认为如果不在语句中使用递归，你就无法摆脱它。

如果您能够（或供将来参考），您可以尝试使用[修改后的 preorder tree traversal](http://www.sitepoint.com/article/hierarchical-data-database/2/)，这将允许您执行此操作。

在此答案中解释修改后的预排序树遍历超出了范围，因为需要一些解释和游戏才能掌握。

我要指出的是，在 MPTT 上更新和插入记录会产生开销，但选择通常效率更高。一般来说，选择比更新/插入发生的要多得多，所以这是值得的，但是在直接进入之前考虑一下你的特殊情况是值得的。

我链接到的文章对 MPTT 有很好的解释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T13:55:57.577

您应该能够使用公用表表达式进行递归查询。在“使用公共表表达式的递归查询”上进行谷歌搜索，有一篇 msdn 文章。

*感叹*新用户不允许添加超链接。

# wcf - WCF 实例上下文模式

> ID：926035
> 
> 赞同：2
> 
> 时间：2009-05-29T13:43:56.493
> 
> 标签：wcf, instancecontextmode

我有一个 Web 应用程序使用代理来调用 WCF 服务上的操作，该服务从 AS400 返回数据，例如与我们公司关联的不同销售区域、我们在现场的不同商店等。这些销售区域和商店不要经常改变，商店可能一年只增加两次，而且几年来地区都是一样的。

我想我的困惑在于 InstanceContextMode。当代理客户端调用 GetRegions() 或 GetStoresForRegion(int regionNumber)

如果我将 InstanceContextMode 设置为 single 并在任何服务操作调用之前初始化和填充区域和存储，这会有所帮助吗？基本上现在，它在每次调用时都会进行数据库查找，我认为没有必要。

所以用户登录到 Web 应用程序 -> Web 应用程序页面 -> 必须加载区域下拉列表 -> Web 开发人员调用代理来获取区域......但是当每个用户都使用 Web 应用程序时就会发生这种情况，所以基本上每次用户访问 Web 应用程序，代理调用数据库，我认为这是愚蠢的，我设置服务操作的方式有误，或者我完全误解了什么？

更新 - 服务是 IIS 托管的，所以这整个问题可能没有实际意义

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T14:00:52.433

基本的最佳实践建议是使用每次调用的单实例服务。这是最容易创建的，没有并发噩梦等。

但是：当然，每次调用服务时，都会创建一个服务实例并查询数据库后端。

如果可能的话，试着坚持下去。尝试将缓存逻辑放入数据库 - 如果您有足够的 RAM，那么您经常请求的大部分数据将保留在内存中。

在您的 WCF 服务中转到 ConcurrencyMode = multiple 会导致出现各种并发问题，您需要非常小心。尽可能避免这种情况。

尝试每次调用，首先尝试单实例，并且仅在确实需要时才进行优化！

马克

# c# - 为什么我不能在 iframe 中的表单元素之间切换？

> ID：926037
> 
> 赞同：0
> 
> 时间：2009-05-29T13:44:24.773
> 
> 标签：c#, javascript, iframe, asp.net-3.5, tabindex

我在一个站点中有一个页面，其中包含一个带有表单的 iframe。我无法更改这一点，但我可以完全控制在父页面和 iframe 页面中运行的所有 JS。

我的问题是，当我有一个集中在 iframe 文档中的表单字段时，跳到下一个字段会将光标直接发送到浏览器的地址栏，而不是表单中的下一个字段。在每个字段上设置 tabindexes 没有帮助。

浏览器将整个 iframe 本身视为页面中的元素之一（应该如此），但我想知道是否有办法捕获选项卡事件并强制焦点留在 iframe 内部及其子元素.

你们有没有人遇到过这个问题并有办法解决它？

并不是说它会对您有所帮助，但布局类似于：

```
+-------------------------------------------+
| Parent page                               |
|         +-------------------------------+ |
|  N      | iframe                        | |
|  a      |                               | |
|  v      | Has about 50 fields that I'd  | |
|  i      | like to be able to tab between| |
|  g      |                               | |
|  a      | But I can't! Help!            | |
|  t      |                               | |
|  i      +-------------------------------+ |
|  o                                        |
|  n                                        |
+-------------------------------------------+ 
```

一个想法是尝试捕获 iframe 中的 keydown 事件，检查 tab 或 shift+tab，然后重新聚焦 iframe，但是在失去焦点之前知道我在哪个字段上存在问题。有没有办法使用 JS 和表单字段上的 tabindex 属性动态聚焦下一个字段？也许这就是我下一步冒险的地方......

***更新：*** 也许我缺少一些更简单的东西。例如， [http://www.studentloan.com](http://www.studentloan.com)上的登录框是一个 iframe，我可以很好地在这些字段之间切换。也许我的JS中的其他东西导致了这个问题。

***更新 2：***我尝试将浏览器中的 iframe 文档作为独立页面加载，但我仍然无法选项卡。我认为这是我在其他地方的 JS 中所做的事情导致文档失去焦点。当我找到它时，我会发布我的解决方案。

***更新 3：***

该问题是由 Ajax Control Tookit 的 ModalPopupExtender 引起的。调用网络服务后，我将其用作加载消息。当回调方法被触发时它会被隐藏。

我可以在字段之间切换，直到第一次显示和隐藏 Modal 弹出窗口。之后，表单将永远无法保持焦点。我正在调查原因，如果我能找出原因，我会发布答案。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-23T12:52:08.687

我和你几乎有同样的问题。经过大量时间寻找解决方案后，我找到了这个网站，在那里我可以发现导致我这个问题的原因：modalpopupextender。一旦我知道真正的问题是什么，就很容易找到解决方案。这是：[http ://forums.asp.net/t/1191142.aspx](http://forums.asp.net/t/1191142.aspx)

我希望它可以帮助您像对我一样理解这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T13:52:20.297

我想使用ajax是不可能的？

如果不是，那么您没有 iframe 选项卡问题，因为您的表单是当前页面的一部分。

# .net - 是否有 Google 可视化 api 的 microsoft/.net “版本”

> ID：926038
> 
> 赞同：1
> 
> 时间：2009-05-29T13:44:27.613
> 
> 标签：.net, visualization, data-visualization

这只是关于 .Net 中是否有类似类型的可视化工具/服务的开放性问题。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T13:59:59.750

如果您正在寻找 Google Charts API，可以在[CodePlex上找到适用于 Asp.NET 的](http://codeplex.com/)[Google Chart API 控件](http://googlechartnet.codeplex.com/)和[适用于 Asp.Net 的 Google Charts](http://googlecharts.codeplex.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-09T15:55:07.993

大概您指的是[http://code.google.com/apis/chart/interactive/docs/dev/implementing_data_source.html](http://code.google.com/apis/chart/interactive/docs/dev/implementing_data_source.html)，事实证明 .net 中似乎有一个非常不错的小库可以转换系统.Data.DataTable 转换为 google JSON 数据表，只需通过 web 方法将其公开，您就可以使用 google Chart Visualisation！！

这是似乎可以为 .net 完成工作的库：[http ://code.google.com/p/bortosky-google-visualization/wiki/ReadMe](http://code.google.com/p/bortosky-google-visualization/wiki/ReadMe)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-23T04:06:19.100

有[微软图表控件](http://code.msdn.microsoft.com/mschart)

[替代文本 http://code.msdn.microsoft.com/Project/Download/FileDownload.aspx?ProjectName=mschart&DownloadId=3633](http://code.msdn.microsoft.com/Project/Download/FileDownload.aspx?ProjectName=mschart&DownloadId=3633)

# visual-studio - 有没有办法在 Visual Studio 项目中为代码添加书签？

> ID：926046
> 
> 赞同：107
> 
> 时间：2009-05-29T13:46:17.190
> 
> 标签：visual-studio

在各种项目中，我会不断跳到某些部分。有没有办法有效地“书签”这些部分，所以我可以快速跳回到某个文件（或某种方法）中的某一行？

我总是迷失在导航解决方案或“在整个项目/解决方案中查找”。

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2009-05-29T13:50:07.197

在 Visual Studio 中，您可以[在代码中设置书签](https://docs.microsoft.com/en-us/visualstudio/ide/setting-bookmarks-in-code)。

在书签之间跳转：

`Ctrl`+ `K`+ `N`（下一个）

和

`Ctrl`+ `K`+ `P` （上一个）

要为一行打开/关闭书签：

`Ctrl`+ `K`+`K`

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-05-29T13:50:49.520

是的，按热键组合`Ctrl`++ （即`K`Ctrl`K`和 K，然后是另一个 K）来切换书签。

然后你可以为下一个书签做`Ctrl`++ ，为上一个书签做`K`++ 。`N``Ctrl``K``P`

它就像一个魅力！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-07-17T07:49:02.010

使用[ReSharper](http://en.wikipedia.org/wiki/ReSharper)可以更灵活地制作书签并导航到它们。

例如，您可以按`Ctrl`+ `Shift`+ 数字`3`。`Ctrl`然后通过+引用它`3`。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-29T13:47:31.523

我可以使用[TODO](http://www.dotnetperls.com/todo)功能，添加我自己的自定义前缀“BOOKMARK”或“BM”，如果我要偷懒的话。

[自定义标签的 MSDN 文档](https://msdn.microsoft.com/en-us/library/txtwdysk.aspx#Anchor_2)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-10-27T08:18:14.277

Visual Studio 的最新版本（至少从 Visual Studio 2010 开始）具有书签功能。这是我的工作流程：

首先，您应该记住两个快捷方式，*Show Bookmark Window*和*Toggle Bookmark*。在我的设置中，它分别是`Ctrl`++和`W`++ 。`B``Ctrl``B``T`

其次，将书签窗口设置为自动隐藏。这一步对我来说很重要，因为它最终使书签变得容易和舒适。

这就是我使用书签的方式：

当我处于感兴趣的位置时，我*切换书签*和*显示书签窗口*，然后按下`F2`并重**命名条目**- 使用合理的名称对于轻松导航非常有帮助。

当我想到达另一个感兴趣的位置时，我*显示书签窗口*，导航到所需的条目，按回车键，瞧，我就在那里。

对我来说，发现书签窗口的自动隐藏是至关重要的：它允许快速获得兴趣点的完整视图，然后离开并返回焦点给编辑器。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-09-16T06:56:54.693

还有**快捷方式**：`Ctrl-K, Ctrl-H`- 将任务列表中的快捷方式设置或删除到当前行。

您可以在任务列表窗口中看到的所有快捷方式的列表。要打开它，请单击`View - Task List`菜单或按`Ctrl-\, T`。在该窗口中，您可以选择用户任务、快捷方式或评论（不在 VS2015 中）。

[![Visual Studio 2015 书签和快捷方式](https://i.stack.imgur.com/cuU5q.png)](https://i.stack.imgur.com/cuU5q.png)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-08-12T09:46:04.873

我也在寻找更好的解决方案，最近从 Delphi 7 IDE 迁移到 Visual Studio 2010。[此评论](https://stackoverflow.com/questions/926046/is-there-a-way-to-bookmark-code-in-a-visual-studio-project/#comment-734101)想知道是否可能有一个插件可以做到这一点，并将我引导到扩展管理器和搜索 Bookmark 带来了[DPack](http://www.usysware.com/dpack/)。

我认为这给了 OP 正是他正在寻找的东西，特别是在考虑[到他的这个评论时](https://stackoverflow.com/questions/926046/is-there-a-way-to-bookmark-code-in-a-visual-studio-project/#comment-734054)。

注意：安装后，我必须通过`Tools | Options | Environment | Keyboard`. 我放入`DPack`编辑`Show commands containing`框，然后向下滚动以找到对我不起作用的，并使用编辑框分配`GoToBookmark[x]`它们。（不过，在您执行此操作之前，请记下“当前正在使用的快捷方式”；我不希望您覆盖您没有意识到您广泛使用的功能！）`ToggleBookmark[x]``Press shortcut keys`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-17T17:28:20.140

Visual Studio**书签**极大地提高了生产力。点击“查看，书签”（`Ctrl` `K`, `Ctrl` `W`），您可以按类别对您的书签进行分组 - 只需创建一个文件夹，然后将相关书签拖入该文件夹即可。它们都可以一键启用/禁用。

如果您同时处理两组或更多组问题，并且您不想在专注于错误 B 的同时处理增强 A 的书签，这将非常方便。只需将每个问题的一组书签分组到各自的文件夹中，您可以一键（取消）激活它们。

此外，如果您必须经常返回某些地方，只需创建一个禁用的书签，然后通过“书签”窗口直接跳转到那里。

这是一个例子：

[![在此处输入图像描述](https://i.stack.imgur.com/muTBg.jpg)](https://i.stack.imgur.com/muTBg.jpg) *Visual Studio 命名书签*

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-29T14:58:07.170

前往查看 | 工具栏并检查文本编辑器工具栏，使其显示出来。它有工具栏按钮来切换（创建/删除）当前行 Ctrl-B、T 上的书签，以及导航到下一个/上一个书签，其中导航范围为解决方案、文件夹或文档，具体取决于您使用哪个按钮。

创建书签后，转到查看 | 其他窗口并选择书签窗口（或只需按 Ctrl-W、B）。这将显示所有书签的列表。您可以双击任何书签跳转到它，或使用书签窗口中的工具栏按钮进行上一个/下一个。

您还可以在书签窗口中命名/重命名您的书签。右键单击名称并选择重命名，或选择名称并再次单击以进入编辑模式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-30T14:39:37.287

您可以安装扩展程序：[VSBookmarks](https://github.com/SergeyVinyar/VSBookmarks)

为每个文本编辑器选项卡提供多达九个枚举书签。所有这些都可以通过快捷方式或上下文菜单访问（右键单击并查看 VSBookmark 子菜单）。

**Ctrl-Shift-[1..9]** - 设置、更改或删除书签（您将在编辑器区域的左边距看到一个适当的数字）； **Ctrl-[1..9]** - 转到以前设置的书签。

[![在此处输入图像描述](https://i.stack.imgur.com/uc4Da.png)](https://i.stack.imgur.com/uc4Da.png)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2017-03-21T15:48:21.647

在 Visual Studio 2017 中，它是

*   切换：`Ctrl`+ `B`,`T`
*   启用：`Ctrl`+ `B`,`E`
*   全部删除：`Ctrl`+ `B`,`C`

# vb.net - 在 VB.NET 中动态添加 Div 表行

> ID：926056
> 
> 赞同：0
> 
> 时间：2009-05-29T13:48:13.130
> 
> 标签：vb.net, dynamic, html

我是 VB.NET 初学者，谁能告诉我如何动态添加 div 表行或如何循环一段 html？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T14:00:56.020

我对您的工作做了一些假设（例如您使用的是 ASP.Net），但您可以使用 Repeater 控件循环一段 HTML。

```
<asp:Repeater ID="myRepeater" runat="server">
    <ItemTemplate>
           <div>What you want to loop here</div>
    </ItemTemplate>
</asp:Repeater> 
```

但是，当然，您必须对转发器进行数据绑定，以便它循环遍历数据绑定到的项目。你也可以做一个内联循环：

```
<% for (int i = 0; i < 5; i++)
   { %>
           <div>Something repeated here</div>
<% } %> 
```

当然，您必须将 for 循环放入 VB 语法中。

# wpf - 大声说“ModelViewViewModel”或“MVVM”太尴尬了！备择方案？

> ID：926057
> 
> 赞同：0
> 
> 时间：2009-05-29T13:48:36.217
> 
> 标签：wpf, mvvm

我承认这对你来说可能看起来很傻，但是当我和我的队友讨论模型-视图-视图模型模式时，这个词的发音很尴尬。“ModelViewViewModel”或“Emm-Vee-Vee-Emm”并没有完全从舌头上滚下来。尤其是当您不是以英语为母语的人时。

所以我正在寻找替代方案。说起来又快又容易。

目前的建议是：

M2VM - “emm two vee emm”（感觉更流畅）
M2V2 - “emm two vee two”（不太合适，但它的灵感来自 H2G2 :)）

还有什么想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:00:59.207

为什么不说“Move-em”而不是 MVVM。在回答某人关于要使用的模式的问题时，您可以简单地回答“我们可以移动他们”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:06:30.053

假装 Vs 是 W，这真的是 2 Us 公平地说，说**Muum**。像牛一样做的加分。

# sql - SQL 存储过程中每个客户的求和和计算

> ID：926061
> 
> 赞同：2
> 
> 时间：2009-05-29T13:49:20.443
> 
> 标签：sql, stored-procedures

在 SQL 数据库中，我获得了每个用户、每个客户的存储信息。

我需要编写一个存储过程来汇总客户用户的磁盘使用量 (MB)。当我得到一个客户的所有用户的总和（totalDiscUsage）时，我需要执行一个计算（简单示例）：

```
x = numberOfUsers * 200
y = (totalDiscUsage - x) / (10 * 5) 
```

之后，我需要将 y 写入数据库，并为所有客户执行此操作。

我的问题是如何以最好的方式做到这一点？

也许使用游标遍历每个客户，执行求和和计算，并将结果写入数据库？那会是一个很好的解决方案吗？

提前致谢。帮助将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T13:55:59.853

请 - 不要再使用游标四处走动！:-) SQL 是基于集合的——尽可能避免使用游标！

在这里，您可以 - 轻松。所以对于每个客户，你需要先确定用户数量，然后做一个简单的计算，更新客户。

我的建议是：

*   创建一个小函数来计算给定客户的用户数量
*   创建第二个小函数来计算总磁盘使用量
*   将您的存储过程编写为一个简单的更新语句来进行计算

    ```
    创建过程 dbo.UpdateCustomers()
    开始
        更新客户
        SET y = (dbo.GetTotalDiskUsage(CustomerID) - dbo.GetTotalUsers(CustomerID) * 200) / 50
    结尾

    ```

似乎太容易了，几乎:-)

马克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T13:56:47.433

您可以使用选择查询对以下值执行插入操作：

```
INSERT INTO DiskUsage
SELECT SUM(Users.Usage) FROM Customers INNER JOIN Users ON somefield and somefield 
```

或类似的东西。不是 100% 确定这是否适用于您的情况，因为我从您的问题中并不太清楚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T13:54:07.780

如果不参考数据的存储方式，即相关的表定义，就无法真正谈论报告给定数据集的“最佳方式”。

当然，除非您询问如何最好地存储数据以允许此报告，在这种情况下，您可能需要改写您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T13:55:47.387

你肯定可以用光标来做到这一点。您也有可能在一个带有子查询或可能预计算和临时表的语句中执行此操作，但如果没有更多信息就很难判断。

# .net - Win Form 应用程序中的应用程序日志

> ID：926064
> 
> 赞同：1
> 
> 时间：2009-05-29T13:49:40.193
> 
> 标签：.net, winforms, logging

什么是应用程序日志？它与错误日志有何不同？应用程序日志文件应该包含什么样的信息。有没有我可以使用的内置类？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T14:45:23.043

我强烈推荐[log4net](http://log4net)。

应用程序日志记录您告诉它记录的任何内容。一大优势是您可以选择要记录的信息，因此您可以记录系统状态、当前用户和您选择的其他参数。事件日志没有那么灵活。日志框架通常允许您记录发生在不同级别的事件，但由您来定义这些级别在代码中的含义。日志级别是通过配置设置的，所以在我们的开发系统上是 DEBUG，在我们的生产系统上是 WARN。这些是我对 log4net 级别的定义：

```
DEBUG - Tracing, etc., use at will
INFO - System state info, important/useful info that you don't care to see in the production log
WARN - Handled exceptions, rare events, unusual code branches taken
ERROR - Caught but unhandled exceptions
FATAL - Only used in global handler 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T13:53:23.023

您可以使用[System.Diagnostics.EventLog](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlog.aspx)写入 Windows 中的日志。您输入的信息类型取决于您在应用程序中的需要。[您可以按EventLogEntryType](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlogentrytype.aspx)（错误、信息、警告等）对日志条目进行分类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T13:52:42.043

在应用程序日志中，您会记录您认为在出现问题时对您有帮助的信息。有一些简单的方法可以做到这一点，但对于更正式的方法，您可以查看模式和实践组中的 Microsoft 企业库，该库将为您提供可以按原样使用或修改以适应您的需求的源代码.

# c# - C#中整数数据的简单直方图生成

> ID：926067
> 
> 赞同：8
> 
> 时间：2009-05-29T13:50:24.340
> 
> 标签：c#, histogram

作为我正在构建的测试台的一部分，我正在寻找一个简单的类来计算整数值的直方图（算法解决问题的迭代次数）。答案应该是这样的：

```
Histogram my_hist = new Histogram();

for( uint i = 0; i < NUMBER_OF_RESULTS; i++ )
{

    myHist.AddValue( some_result );
}

for( uint j = 0; j < myHist.NumOfBins; j++ )
{
     Console.WriteLine( "{0} occurred {1} times", myHist.BinValues[j], myHist.BinCounts[j] );
} 
```

我很惊讶谷歌搜索并没有找到一个很好的解决方案，但也许我没有找到正确的东西。那里有通用解决方案还是值得我自己推出？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-29T14:15:24.713

你可以使用 SortedDictionary

```
uint[] items = new uint[] {5, 6, 1, 2, 3, 1, 5, 2}; // sample data
SortedDictionary<uint, int> histogram = new SortedDictionary<uint, int>();
foreach (uint item in items) {
    if (histogram.ContainsKey(item)) {
        histogram[item]++;
    } else {
        histogram[item] = 1;
    }
}
foreach (KeyValuePair<uint, int> pair in histogram) {
    Console.WriteLine("{0} occurred {1} times", pair.Key, pair.Value);
} 
```

不过，这会遗漏空垃圾箱

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-29T15:26:12.947

根据 BastardSaint 的建议，我想出了一个简洁且相当通用的包装器：

```
public class Histogram<TVal> : SortedDictionary<TVal, uint>
{
    public void IncrementCount(TVal binToIncrement)
    {
        if (ContainsKey(binToIncrement))
        {
            this[binToIncrement]++;
        }
        else
        {
            Add(binToIncrement, 1);
        }
    }
} 
```

所以现在我可以这样做：

```
const uint numOfInputDataPoints = 5;
Histogram<uint> hist = new Histogram<uint>();

// Fill the histogram with data
for (uint i = 0; i < numOfInputDataPoints; i++)
{
    // Grab a result from my algorithm
    uint numOfIterationsForSolution = MyAlorithm.Run();

    // Add the number to the histogram
    hist.IncrementCount( numOfIterationsForSolution );
}

// Report the results
foreach (KeyValuePair<uint, uint> histEntry in hist.AsEnumerable())
{
    Console.WriteLine("{0} occurred {1} times", histEntry.Key, histEntry.Value);
} 
```

我花了一段时间才弄清楚如何使它通用（首先我只是覆盖了`SortedDictionary`构造函数，这意味着你只能将它用于`uint`键）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-07-25T17:46:13.897

您可以使用 Linq：

```
var items = new[] {5, 6, 1, 2, 3, 1, 5, 2};
items
    .GroupBy(i => i)
    .Select(g => new {
        Item = g.Key,
        Count = g.Count()
    })
    .OrderBy(g => g.Item)
    .ToList()
    .ForEach(g => {
        Console.WriteLine("{0} occurred {1} times", g.Item, g.Count);
    }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-09-18T11:43:15.860

我实现一个简单的扩展方法来创建直方图：

```
public static IReadOnlyDictionary<T, int> ToHistogram<T>(this IEnumerable<T> enumerable)
   => enumerable.GroupBy(item => item).ToDictionary(grouping => grouping.Key, grouping => grouping.Count()); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-11-08T15:48:59.150

这建立在公认的答案之上。问题是`SortedDictionary`迭代构建一个很慢，因为插入*和*检索都花费**O(log(N))**。

如果您不需要在累积时显示直方图，则可以避免这种情况。

我的修改使用了一个普通的`Dictionary`，并且只在最后将它排序为一个`SortedList`.

对于 1000 万个项目的样本大小，这个版本大约快 11 倍（在我的机器上），代价是内存使用量稍高，直到 GC 启动（约 10% 额外内存）。

```
//generate a random sample
Random r = new Random();
var items = Enumerable
    .Range(1, 10_000_000)
    .Select( _ => (uint)r.Next(100_000))
    .ToList();

//build the histogram using a normal dictionary with O(1) lookups and insertions.
var tempHistogram = new Dictionary<uint, int>();
foreach (uint item in items)
{
    if (tempHistogram.ContainsKey(item))
    {
        tempHistogram[item]++;
    }
    else
    {
        tempHistogram[item] = 1;
    }
}

//Sort it once. SortedList conveniently has a ctor that takes a dictionary.
var sortedHistogram = new SortedList<uint, int>(tempHistogram);

foreach (KeyValuePair<uint, int> pair in sortedHistogram.Take(100))
{
    Console.WriteLine("{0} occurred {1} times", pair.Key, pair.Value);
} 
```

对于非常大的样本（大于可用内存），有惊人的概率算法可以解决这个问题。
它们也非常适合*流式传输*数据。寻找“分位数草图”。这是 Apache 基金会的一个实现：[https ://datasketches.apache.org/](https://datasketches.apache.org/)

# linux - 在 Unix shell 中添加一列数字

> ID：926069
> 
> 赞同：221
> 
> 时间：2009-05-29T13:50:41.453
> 
> 标签：linux, unix, shell

给定 中的文件列表`files.txt`，我可以得到它们的大小列表，如下所示：

```
cat files.txt | xargs ls -l | cut -c 23-30 
```

产生这样的东西：

```
 151552
  319488
 1536000
  225280 
```

我怎样才能得到所有这些数字的**总和？**

* * *

## 回答 #1

> 赞同：424
> 
> 时间：2013-08-09T06:27:15.880

```
... | paste -sd+ - | bc 
```

是我找到的最短的（来自[UNIX 命令行](http://www.unixcl.com/2009/11/sum-of-numbers-in-file-unix.html)博客）。

**编辑：**添加了`-`可移植性的参数，感谢@Dogbert 和@Owen。

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2009-05-29T14:03:59.167

开始

```
cat files.txt | xargs ls -l | cut -c 23-30 | 
  awk '{total = total + $1}END{print total}' 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-03-06T05:57:25.710

如果文件名中有空格，cat 将不起作用。这是一个 perl 单行程序。

```
perl -nle 'chomp; $x+=(stat($_))[7]; END{print $x}' files.txt 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-08-12T16:10:18.813

您可以直接使用以下命令，而不是使用*cut从**ls -l*的输出中获取文件大小：

```
$ cat files.txt | xargs ls -l | awk '{total += $5} END {print "Total:", total, "bytes"}' 
```

awk 将“$5”解释为第五列。这是来自*ls -l*的列，它为您提供文件大小。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-06-04T18:03:39.193

```
python3 -c"import os; print(sum(os.path.getsize(f) for f in open('files.txt').read().split()))" 
```

Or if you just want to sum the numbers, pipe into:

```
python3 -c"import sys; print(sum(int(x) for x in sys.stdin))" 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-11-10T22:19:28.230

如果您没有安装 bc，请尝试

```
echo $(( $(... | paste -sd+ -) )) 
```

代替

```
... | paste -sd+ - | bc 
```

`$( )`<-- 返回执行命令的值

`$(( 1+2 ))`<-- 返回评估结果

`echo`<-- 将其回显到屏幕上

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-09-26T22:23:25.397

[TMTWWTDI](https://en.wikipedia.org/wiki/There%27s_more_than_one_way_to_do_it) : Perl 有一个文件大小操作符 (-s)

```
perl -lne '$t+=-s;END{print $t}' files.txt 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-05-29T14:04:55.827

如果您只想在没有 awk 或其他解释器的情况下使用 shell 脚本，则可以使用以下脚本：

```
#!/bin/bash

total=0

for number in `cat files.txt | xargs ls -l | cut -c 23-30`; do
   let total=$total+$number
done

echo $total 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-08-12T18:20:42.100

**当你有stat**时，整个 ls -l 然后 cut 相当复杂。它也容易受到**ls -l**的确切格式的影响（直到我更改了**cut**的列号才起作用）

此外，修复了[cat 的无用使用](https://en.wikipedia.org/wiki/Cat_%28Unix%29#Useless_use_of_cat)。

```
<files.txt  xargs stat -c %s | paste -sd+ - | bc 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2018-12-12T09:44:49.860

```
cat files.txt | awk '{ total += $1} END {print total}' 
```

你可以使用 awk 来做同样的事情，它甚至可以跳过非整数

```
$ cat files.txt
1
2.3
3.4
ew
1

$ cat files.txt | awk '{ total += $1} END {print total}'
7.7 
```

或者您可以使用 ls 命令并计算人类可读的输出

```
$ ls -l | awk '{ sum += $5} END  {hum[1024^3]="Gb"; hum[1024^2]="Mb"; hum[1024]="Kb"; for (x=1024^3; x>=1024; x/=1024) { if (sum>=x) { printf "%.2f %s\n",sum/x,hum[x]; break; } } if (sum<1024) print "1kb"; }'
15.69 Mb

$ ls -l *.txt | awk '{ sum += $5} END  {hum[1024^3]="Gb"; hum[1024^2]="Mb"; hum[1024]="Kb"; for (x=1024^3; x>=1024; x/=1024) { if (sum>=x) { printf "%.2f %s\n",sum/x,hum[x]; break; } } if (sum<1024) print "1kb"; }'
2.10 Mb 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-29T14:03:37.513

我会改用“du”。

```
$ cat files.txt | xargs du -c | tail -1
4480    total 
```

如果你只想要号码：

```
cat files.txt | xargs du -c | tail -1 | awk '{print $1}' 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-05-29T14:28:50.363

在 ksh 中：

```
echo " 0 $(ls -l $(<files.txt) | awk '{print $5}' | tr '\n' '+') 0" | bc 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-05-29T14:18:43.707

这是我的

```
cat files.txt | xargs ls -l | cut -c 23-30 | sed -e :a -e '$!N;s/\n/+/;ta' | bc 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-08-24T15:46:52.823

```
... |xargs|tr \  +|bc
... |paste -sd+ -|bc 
```

第一个命令只是长了一个符号（注意，它必须在反斜杠后有两个空格！），但它处理列中有空行的情况，而第二个命令导致带有额外加号的无效表达式。

例如：

```
echo "2
3
5

" | paste -sd+ - 
```

结果是

```
2+3+5++ 
```

哪个 bc 无法处理，而

```
echo "2
3
5

" | xargs | tr \  + 
```

给出一个有效的表达式

```
 2+3+5 
```

可以通过管道输入 bc 以获得最终结果

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-29T14:04:45.467

管到傻瓜：

```
 cat files.txt | xargs ls -l | cut -c 23-30 | gawk 'BEGIN { sum = 0 } // { sum = sum + $0 } END { print sum }' 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-07-16T18:08:21.293

```
#
#       @(#) addup.sh 1.0 90/07/19
#
#       Copyright (C) <heh> SjB, 1990
#       Adds up a column (default=last) of numbers in a file.
#       95/05/16 updated to allow (999) negative style numbers.

case $1 in

-[0-9])

        COLUMN=`echo $1 | tr -d -`

        shift

;;

*)

        COLUMN="NF"

;;

esac

echo "Adding up column .. $COLUMN .. of file(s) .. $*"

nawk  ' OFMT="%.2f"                                       # 1 "%12.2f"

        { x = '$COLUMN'                                   # 2

          neg = index($x, "$")                            # 3

          if (neg > 0) X = gsub("\\$", "", $x)

          neg = index($x, ",")                            # 4

          if (neg > 1) X = gsub(",", "", $x)

          neg = index($x, "(")                            # 8 neg (123 & change

          if (neg > 0) X = gsub("\\(", "", $x)

          if (neg > 0) $x = (-1 * $x)                     # it to "-123.00"

          neg = index($x, "-")                            # 5

          if (neg > 1) $x = (-1 * $x)                     # 6

          t += $x                                         # 7

          print "x is <<<", $x+0, ">>> running balance:", t

        } ' $*

# 1\.  set numeric format to eliminate rounding errors
# 1.1 had to reset numeric format from 12.2f to .2f 95/05/16
#     when a computed number is assigned to a variable ( $x = (-1 * $x) )
#     it causes $x to use the OFMT so -1.23 = "________-1.23" vs "-1.23"
#     and that causes my #5 (negative check) to not work correctly because
#     the index returns a number >1 and to the neg neg than becomes a positive
#     this only occurs if the number happened to b a "(" neg number
# 2\.  find the field we want to add up (comes from the shell or defaults
#     to the last field "NF") in the file
# 3\.  check for a dollar sign ($) in the number - if there get rid of it
#     so we may add it correctly - $12 $1$2 $1$2$ $$1$$2$$ all = 12
# 4\.  check for a comma (,) in the number - if there get rid of it so we
#     may add it correctly - 1,2 12, 1,,2 1,,2,, all = 12   (,12=0)
# 5\.  check for negative numbers
# 6\.  if x is a negative number in the form 999- "make" it a recognized
#     number like -999 - if x is a negative number like -999 already
#     the test fails (y is not >1) and this "true" negative is not made
#     positive
# 7\.  accumulate the total
# 8\.  if x is a negative number in the form (999) "make it a recognized
#     number like -999
# * Note that a (-9) (neg neg number) returns a postive
# * Mite not work rite with all forms of all numbers using $-,+. etc. * 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-07-12T12:03:43.583

我喜欢用......

```
echo "
1
2
3 " | sed -e 's,$, + p,g' | dc 
```

他们将显示每一行的总和......

适用于这种情况：

```
ls -ld $(< file.txt) | awk '{print $5}' | sed -e 's,$, + p,g' | dc 
```

总计是最后一个值...

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-02-08T17:01:14.320

纯粹的 bash

```
total=0; for i in $(cat files.txt | xargs ls -l | cut -c 23-30); do 
total=$(( $total + $i )); done; echo $total 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-02-13T21:35:21.890

```
sizes=( $(cat files.txt | xargs ls -l | cut -c 23-30) )
total=$(( $(IFS="+"; echo "${sizes[*]}") )) 
```

或者您可以在阅读尺寸时将它们相加

```
declare -i total=0
while read x; total+=x; done < <( cat files.txt | xargs ls -l | cut -c 23-30 ) 
```

如果您不关心咬合大小和块可以，那么只需

```
declare -i total=0
while read s junk; total+=s; done < <( cat files.txt | xargs ls -s ) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-07-06T08:36:47.200

- 不需要粘贴。只要 files.txt 包含一个或多个有效文件名，以下将执行：

```
<files.txt xargs stat -c %s | paste -sd+ | bc 
```

如果没有文件，cat 不需要插入 0。如果没有管道，可能在脚本中更方便，您可以使用：

```
(xargs -a files.txt stat -c %s || echo 0) | paste -sd+ | bc 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-12-24T14:44:18.700

在我看来，最简单的解决方案是“expr” unix 命令：

```
s=0; 
for i in `cat files.txt | xargs ls -l | cut -c 23-30`
do
   s=`expr $s + $i`
done
echo $s 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-05-03T05:26:09.150

如果你有 R，你可以使用：

```
> ... | Rscript -e 'print(sum(scan("stdin")));'
Read 4 items
[1] 2232320 
```

* * *

因为我对 R 很熟悉，所以我实际上有几个这样的别名，所以我可以使用它们`bash`而不必记住这种语法。例如：

```
alias Rsum=$'Rscript -e \'print(sum(scan("stdin")));\'' 
```

让我来做

```
> ... | Rsum
Read 4 items
[1] 2232320 
```

灵感：[有没有办法在单个命令中获取数字列表的最小值、最大值、中值和平均值？](https://unix.stackexchange.com/a/13775/148899)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-04-30T19:58:57.830

当管道的开头可以产生 0 行时，最流行的答案不起作用，因为它最终输出的不是 0 而是什么。您可以通过始终添加 0 来获得正确的行为：

`... | (cat && echo 0) | paste -sd+ - | bc`

# java - Java 错误：找不到符号？

> ID：926073
> 
> 赞同：0
> 
> 时间：2009-05-29T13:51:09.347
> 
> 标签：java, string

我有以下代码片段，其中一些字符串在`if`块中初始化：

```
String serialmask = request.getParameter( "serialmask"); 
String serialincrement = request.getParameter( "serialincrement");
if (serialmask == "1") { 
  String tserialmask = "aaa########"; 
} 
else { 
  String tserialmask = "";
}
if (serialincrement == "1") {  
  String tserialincrement = "aaa^^^^^^^^";
}
else { 
  String tserialincrement = ""; 
}
out.println(
  itemimport( 
    partnumber, 
    itemcost, 
    itemlistprice, 
    itemdescription, 
    PurchProdLineKey, 
    UnitMeasKey, 
    itemclasskey, 
    trackmethod, 
    tserialmask, 
    tserialincrement
  )
); 
```

我得到的错误`"cannot find symbol" symbol : variable tserialmask`在`out.println(itemimport(....tserialmask,tserialincrement));`声明中。

我尝试在块之外声明变量`if`，这似乎带来了更多错误，表明它已经被声明。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T13:58:17.010

您需要先声明变量，然后再分配它。这是版本`tserialincrement`（对于 也是如此`tserialmask`）

```
String tserialincrement;
if (serialincrement == "1")
{
   tserialincrement = "aaa^^^^^^^^";
}
else
{ 
   tserialincrement = "";
} 
```

但是，这样做有两个问题：

*   您在字符串上使用 ==，这在几乎所有情况下都是一个坏主意；利用`equals`
*   您可以使用条件运算符在一个语句（每个变量）中执行此操作：

    ```
    String tserialmask = "1".equals(serialmask) ? "aaa########" : "";
    String tserialincrement = "1".equals(serialincrement) ? "aaa^^^^^^^^" : ""; 
    ```

此外，我建议使用更好的变量名，使用 Pascal 大小写（例如`serialMask`）和一些比“t”作为前缀更有用的东西。（这意味着什么？）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T13:59:08.193

您需要在 if/else 块之外声明 tserialmask 和 tserialincrement。否则，当该块结束时，它们会超出范围。

```
String serialmask = request.getParameter( "serialmask");
String serialincrement = request.getParameter( "serialincrement");
String tserialmask;
String tserialincrement;

if (serialmask == "1")
{  
  tserialmask = "aaa########";
}
else
{ 
  tserialmask = "";
}
if (serialincrement == "1")
{
  tserialincrement = "aaa^^^^^^^^";
}
else
{ 
  tserialincrement = "";
}
out.println(itemimport(partnumber,itemcost,itemlistprice,itemdescription,PurchProdLineKey,UnitMeasKey,itemclasskey,trackmethod,tserialmask,tserialincrement)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T13:58:40.860

您在 if else 语句中声明 String 变量，然后尝试在语句之外访问它们。您需要在 if 语句之前声明变量，然后只在 if/else 语句中分配它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T13:59:34.057

您需要在 if 分支之外声明变量 tserialmask 和 tserialincrement ，**而**不是尝试在内部重新声明它们，如下所示：

```
String tserialmask;
if (serialmask == "1") {  
    tserialmask = "aaa########"; 
} else { 
    tserialmask = ""; 
} 
```

# asp.net-mvc - MVC、动态路由、Unity、判断当前控制器是否存在于global.asax中

> ID：926075
> 
> 赞同：2
> 
> 时间：2009-05-29T13:51:38.690
> 
> 标签：asp.net-mvc, model-view-controller, routing, unity-container, asp.net-mvc-routing

我想要做的是我的应用程序的动态路由。

例如，在 Application_BeginRequest() 中，我想获取当前控制器并确定它是否存在。如果没有，我想添加一组覆盖默认路由的路由，以便我的 url 看起来像这样

mysite.com/term 来自数据库

但是，如果“来自数据库的术语”是一个有效的控制器，我希望它使用默认路由

```
routes.MapRoute(
            "Default",                                              // Route name
            "{controller}/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        ); 
```

我已经按照我想要的方式制定了路线。现在我只需要获取当前控制器并确定它是否存在。如果我不添加我的自定义路线，我会收到此错误：

> IControllerFactory 'MySite.Web.UnityControllerFactory' 没有为名为 'term from database' 的控制器返回控制器。

有没有办法使用全局统一来确定控制器是否存在？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T14:03:42.397

为什么不创建一个实用程序帮助类来从数据库中注册路由，然后在 global.asax 中应用控制器路由？

由于您的数据库路由首先注册，因此如果它找到有效路由，那么它将首先使用该路由。或者你可以反之亦然。作为额外说明，我会确保您的数据库中的路线具有关联的 RouteName 以避免冲突。

```
公共类全球：HttpApplication
{
    公共静态无效注册路由（RouteCollection 路由）
    {
        //调用实用程序从数据库注册路由
        RouteHelper.RegisterRoutesFromDB(路由);

        //现在定义我的标准路线
        路线.MapRoute(
            “默认”，
            "{controller}/{action}/{id}",
            新的{控制器=“家”，动作=“索引”，id=“”}
        );

        ...

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-08T05:10:36.537

在我的[博客](http://siyamand.com/Using-Alternative-Routes-How)中，有一个解决方案。使用它，您可以为每条路线定义替代路线，如下所示

```
 var defaultRoute = routes.MapReplaceableRoute(
              name: "Default",
              url: "{controller}/{action}/{id}",
              defaults: new { controller = "Home", action = "Index", id = 
  UrlParameter.Optional    }
          );

        var route = routes.MapRoute(
            name: "Dynamic",
            url: "{name}",
            defaults: new { controller = "Dynamic", action = "Index" });

        defaultRoute.AlternativeRoute = route; 
```

# project-management - 在开始一个 Web 开发项目之前，你是如何估计你将花费的时间的？

> ID：926076
> 
> 赞同：12
> 
> 时间：2009-05-29T13:51:48.863
> 
> 标签：project-management

当你告诉你的客户或经理这可以在 10 天之内完成，但你花了 20 天才得到一个点，甚至还没有部署到生活中时，感觉真的很糟糕。

有什么经验可以和我分享一下你是如何估计在一个提议的项目上花费的时间的？

谢谢

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-29T13:56:22.130

经验将帮助您更好地进行估算，仅此而已。

不过，要记住的最重要的事情是让人们了解情况。

如果任务估计需要 10 天，而你已经到了第 5 天，但显然不会在 10 天内完成，那么你应该在那个时候让人们知道，而不是在第 11 天时让人们知道。

当事情随着时间的推移有三种选择，你接受打击并继续工作，你从系统中删除一些东西或者你要求更多的钱来完成。越早决定越好。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-29T13:55:34.877

尽可能在开始时尝试将事情分解成小块。我以前读过，人们无法准确估计任何超过几天的持续时间，因此您唯一可以做的解决方法是尝试识别所有部分并分别估计每个部分。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-29T13:53:06.410

给出时间估计是你只有通过经验才能做得更好的事情。

获取您的上一次经验并使用它来修改您的下一次估计。

另请参阅[http://en.wikipedia.org/wiki/Estimation_in_software_engineering](http://en.wikipedia.org/wiki/Estimation_in_software_engineering)了解更多信息。

我发现你能做的最糟糕的事情之一就是第一次看需求，然后在第一次会议期间做出猜测。总是说你需要回复他们，然后去分析需求并给出有根据的回应。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-29T13:57:41.237

不知道自己要做什么就无法估计；您需要将任务分解为您可以合理估计的块 - 直到 HOUR（不少于 1 小时，向上取整）

例如“让我成为登录页面”

HTML 登录表单 - 1 小时用户数据库表 - 2 小时等。

然后，调出日历并尝试填写小时数——好吧，周一我可以工作大约 5 小时，这样就可以完成一项任务。你能合理地多任务吗？可能，但不要说您可以在一天内完成 3 x 4 小时的任务，即使您确实有 12 小时可以“空闲”（这太多了）。

看看周末；你会为他们工作吗？可能不是，所以包括那个。一定要换机油吗？婚礼快到了？确保考虑到这一点。包括一些软糖时间，以防您无法工作（孩子生病，停电）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-29T13:58:59.067

我实际上制作了非常详细的站点地图，然后估计每件作品的小时（分钟）。

我将站点地图展示给客户并**告诉他们这将花费我实际期望的两倍**。

然后我们详细说明每个页面将做什么，因此没有关于网站是否“完成”的争论。

承诺不足，交付过多。我通常比我告诉客户的要早得多，他们总是很高兴我“早”完成了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-29T14:00:13.027

始终要考虑的一件事是测试时间。如果某些东西需要 10 天的时间来开发，那么最好允许至少 7-8 天的测试。预先很好地掌握需求有助于估计时间。当/如果要求发生变化时，您必须让客户知道它将增加交货日期的额外时间。

总而言之，就像扎克所说，你获得的经验越多，你的时间估计就越准确。仅仅为了得到一份工作而给出一个不切实际的时间估计只会是一件坏事。当然，我并不是说你就是这么做的。我只是将其说明为一种良好的做法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-29T14:09:47.517

你真的花了多少时间来做这件事？有什么干扰？每次你集中注意力时，有人打破了这种注意力（这是我工作的正常状态），你可能会失去 30 分钟的时间来回到那种专注状态。一天四五个，而且（处理中断的原因）你已经损失了半天。每天。

我们都这样做。在我们应该学得更好之后很久，我们仍然这样做。我们认为“这不可能花费超过几周的时间”，我们立即说出来，而不是聪明和思考。我经常自言自语，在这里！

如果我们这样说会怎样：“我认为在理想的世界中，我可能会在 10 天内完成这项工作，但你和我都知道事情会出现并且需要处理，这会产生影响。我们如何优先考虑这些功能，我会按顺序处理它们，并在每个完成后报告，并更新估计剩余时间？”

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-29T15:10:09.907

Also remember the old adage...

"The first 90% takes 90% of the time. The last 10% takes 90% of the time."

I don't think you can ever go wrong with taking how long you think a programming project is going to take and tripling it. Unless you've built EXACTLY the same thing before and it was within the last year, so much unexpected stuff will happen. You can't replace experience, but you can use this rule of thumb to stay out of trouble along the way.

And upvote the first responder... being honest and proactive along the way is huge. Better to avoid promising anything than to have to say you're not going to hit a mark.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-29T14:08:31.450

我最喜欢的一位编程老师每次得到改变时都会重复这句话：“花点时间你认为你会带你去做，然后乘以 3。即使那样，这也将是一个险情”。

起初，由于缺乏更好的做事方式，我实际上是这样做的。我仍然！主要是在那些你可以感觉到客户存在的项目中：）

这个对我有用。这不科学，但确实有效。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-29T14:10:46.953

我将项目分解成最小的不同任务。然后，我将清单翻了三遍。

当我第一次浏览列表时，我会寻找我有很多经验的东西。这些都是根据我以前的经验，我可以非常精确地估计所花费的时间。

然后我翻阅清单寻找我不确定的事情，我担心他们会花很长时间。我花了一些时间研究其中的每一个，并将它们分解成更小的任务。这使我可以更好地了解所涉及的具体内容，并且可以使以后更容易处理它。

上次查看列表时，我假设每个任务都需要一名程序员一天的工作才能完成。有时有人可以在一天内完成一大堆。那太棒了。但有时，一项任务会隐藏着各种意想不到的麻烦，而且要花上一周的时间才能弄清楚。它最终会平息。

这不会给你一个非常精确的估计。你真的不能有一个准确的估计。您永远无法准确地预测您将在哪一天完成某件事。然而，这会给你一个非常好的保守和准确的估计。准确度和精确度是两个不同的东西。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-29T14:57:20.227

确定所有可能的任务。正如上面其他人所指出的，您估计的任务越小，您就越准确。将总时间加起来，然后乘以疯狂因子。你的客户越疯狂，花费的时间就越多。你已经咨询了一段时间，所以我相信你知道类型。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-29T14:57:35.830

对我发现的项目进行里程碑式的开发可能会很有帮助。我的意思是您确定项目中的关键部分，这有助于将其分解为可交付成果的时间框架。

这样，在每个里程碑，您都可以评估您的进度，并查看您的项目是否落后、按时等。

附言。或者你可以做经典的方法，花时间你“认为”它会花你，然后加倍！！！;)

# flash - 带有编译器的目标闪存版本

> ID：926077
> 
> 赞同：1
> 
> 时间：2009-05-29T13:51:51.017
> 
> 标签：flash, compilation, target, mxmlc

当我使用 -target-player 属性运行 mxmlc 时，它会报告“未知配置变量 'target-player'”。

如何指定目标玩家？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-30T12:37:25.870

好的，找到问题了。

我使用的是 mxmlc 编译器的第 2 版。我需要使用版本 3。

# java - 折叠笨拙的 Java 类路径

> ID：926079
> 
> 赞同：2
> 
> 时间：2009-05-29T13:52:00.110
> 
> 标签：java, classpath

我们有一些遗留的 Java 应用程序，在类路径上有许多类文件夹和冗余 jar。一个供应商甚至通过我们必须预先添加到类路径的“覆盖”jar 来发布更新。虽然清理应该是一个中期目标，但我想知道是否有任何工具可以将所有这些目录/jar 折叠成一个结构，该结构代表实际上将在运行系统中类加载的文件版本. 我想我可以编写一个脚本，以正确的顺序复制目录并破解 jar 等。但是，我希望这已经完成了。

OneJar ( [http://one-jar.sourceforge.net/](http://one-jar.sourceforge.net/) ) 可以将类路径收集到一个封闭的 jar 中，但它依赖于一个特殊的类加载器实现来访问 jar 中的 jar。

下面的评论者（谁应该重新提交这个作为答案！）有一个很好的建议。我还没有机会测试它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T13:55:56.357

解决方案的一部分可能是使用代码覆盖工具运行示例会话。如果您确保您使用了应用程序的所有功能，则不使用没有覆盖的类，您可以将它们过滤掉。

事实上，从覆盖率报告中获取使用的类列表可能并不难*，*然后为列表中的每个类找到它定义的 JAR/源文件夹并将它们添加到列表（或者更确切地说，设置） . 我发现有用的是标准 Unix`grep`工具实际上非常有用，可以查看给定类在哪个 JAR 文件中。虽然由于您无法完全限定名称，但我希望它偶尔会出现误报，因此不应以自动方式使用。

希望这可以帮助您解决问题！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-02T23:01:31.210

对于最多 5000 个字符的 CLASSPATHS，我通常完全没有问题。话虽如此，我敢打赌我可以通过一个比这更长的。我确实遇到过几次 Windows 2000 有 shell 限制的实例，我不得不使用 XP shell cmd.exe，因为它拥有更长的缓冲区......

您尝试通过的类路径的最大长度是多少？

# sql-server - 如何在没有 LDF 文件的情况下附加数据库？

> ID：926096
> 
> 赞同：8
> 
> 时间：2009-05-29T13:54:48.013
> 
> 标签：sql-server

如何在 SQL Server 中附加没有 LDF 文件的数据库？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-29T13:57:31.143

您可以使用[sp_attach_single_file_db](http://technet.microsoft.com/en-us/library/ms174385.aspx)附加缺少其日志文件的数据库。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-06-20T20:24:46.103

尝试通过将 MDF 文件添加到“附加数据库”对话框来附加它。您会注意到该对话框将报告丢失的 LDF 文件。请按照图片所示的步骤进行操作：

![在此处输入图像描述](https://i.stack.imgur.com/90R2c.png)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-08-12T13:05:55.220

以下是用于以编程方式创建 .ldf 文件的代码片段

以下是3种方法。

**方法-1**

就我而言，我的数据库位于 DATA 文件夹中。

您可以通过右键单击然后转到属性来获取数据库的完整路径，然后您可以将完整路径复制到数据库

在我的情况下，路径如下。

C:\Program Files\Microsoft SQL Server\MSSQL11.DRIBBLEE\MSSQL\DATA

现在这是使用存储过程（sp_attach_single_file_db）并传递参数（数据库名称和物理路径）的第一种方法

```
 USE [master]
 GO

EXECUTE sp_attach_single_file_db 
@dbname='AdventureWorksDW_2012',
@physname=N'C:\ProgramFiles\MicrosoftSQLServer\MSSQL11.DRIBBLEE\MSSQL\DATA\AdventureWorksDW2012_Data.mdf'

GO 
```

执行代码后执行代码转到它所在的数据库文件夹，您将看到在那里创建的 .ldf 文件。

但是，您将在您的

```
The physical file name "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\AdventureWorksDW2012_log.ldf" may be incorrect.
New log file 'C:\Program Files\Microsoft SQL Server\MSSQL11.DRIBBLEE\MSSQL\DATA\AdventureWorksDW_2012_log.ldf' was created. 
```

现在您可以附加数据库并在附加数据库后右键单击对象资源管理器中的服务器名称并刷新。

**方法二**

如果您的数据库缺少一个或多个日志文件，您可以使用以下

```
 CREATE DATABASE db_namehere ON
 (
    FILENAME=N'C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\db_namehere.mdf')

FOR ATTACH_REBUILD_LOG
GO 
```

**方法三**

如果您的数据库只有一个日志文件missig，您可以使用它

```
 CREATE DATABASE db_name ON
( FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\TestDb.mdf')
FOR ATTACH
GO 
```

此外，您可以阅读 BOOKs Online 以获取更多信息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-29T14:31:20.983

您可以尝试MohammedU在[此处发布的内容。](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=78376)基本上，他使用的是 DBCC REBUILD_LOG 命令。它将根据您的服务器版本起作用。

以下是步骤（没有详细信息）：

1.  将现有 .mdf 文件重命名为 .mdf_old
2.  使用与旧数据库相同的 .mdf 和 .ldf 文件创建一个新数据库。
3.  停止 sql 服务器
4.  将新 db 的 .mdf 和 .ldf 文件重命名为 .mdf_old 和 .ldf_old
5.  将 .mdf_old 重命名为 .mdf
6.  启动sql服务器
7.  您应该在可疑模式下看到 db
8.  将数据库上下文更改为 Master 并允许更新系统表
9.  将数据库设置为紧急（绕过恢复）模式。
10.  停止并重新启动 SQL 服务器。
11.  重建日志。
12.  将数据库设置为单用户模式并运行 DBCC CHECKDB 以验证物理一致性。
13.  关闭对系统表的更新。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-04-25T09:28:49.113

通过 SQL Server Management Studio 尝试此步骤

1.  打开 SSMS 并右键单击数据库。
2.  选择附加选项
3.  然后单击添加以附加 MDF 文件。
4.  从列表中选择文件，然后单击确定
5.  现在屏幕显示 MDF 文件和 LDF 文件（未找到）
6.  选择 LDF 文件并单击删除选项。
7.  删除 LDF 文件后，单击确定。
8.  MDF 文件已成功附加到数据库列表中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-02-13T22:05:44.133

```
EXEC sp_attach_single_file_db @dbname = 'DBNAME',@physname = N'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\DBNAME_Data.mdf'; 
```

我试过了，它奏效了......希望这会有所帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-29T14:00:03.447

你可以“就这么做”它会抛出一个警告，说它找不到.ldf，但它仍然会附加数据库。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-10T23:39:19.747

如果遇到问题，请验证 mdf 文件不是只读的。

# c# - 使用 c# 替换本机 .exe 中的字符串

> ID：926097
> 
> 赞同：3
> 
> 时间：2009-05-29T13:55:28.963
> 
> 标签：c#, c++

如何从本机 windows .exe 文件中捕获所有字符串，然后使用 c# 将它们替换为其他字符串？

背景：我想创建 ac# 工具来从一个简单的 .exe 文件中提取和替换字符串。

这有可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T14:13:21.563

您需要启动的是一个 PE/COFF 解析器。如果您的字符串存储在 PE 的资源部分中，那么这很容易。例如，您可以将 exe 作为资源文件加载到 Visual Studio 中，并使用其资源编辑器更改 exe 中的图标和字符串等。另一方面，如果字符串存储在数据部分中或直接在机器代码中，则您遇到的问题要复杂得多。按原样覆盖字符串，让它们保持相同的长度可能会起作用，但是让它们更长会开始移动东西，弄乱重定位和偏移量。重写exe​​真的不是实现你想要的方法。

从我的评论上移：PE/COFF 是 windows 程序的 exe 格式。如果您只想编辑资源，则不需要解析器。您可以首先使用带有标志 LOAD_LIBRARY_AS_IMAGE_RESOURCE|LOAD_LIBRARY_AS_DATAFILE_EXCLUSIVE 的 LoadLibraryEx() 来加载 exe 以仅使用资源并使其可写。然后开始查看 LoadString()。这些都是原生 API 调用。我真的不知道你是如何在 C# 中做到这一点的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T13:59:43.213

如果你只是为了好玩，那么我建议你使用[Resource Hacker](http://angusj.com/resourcehacker/)，这是一个非常强大的程序。

如果这是项目要求，那么我也会关注这个空间来寻找答案:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T14:11:41.473

请记住，这通常是不可能的。在本机 C++ 程序中存储字符串的方法有很多。正如 aman.tur 正确提到的那样，资源字符串是简单的情况。

另一方面，数据段中的字符串通常被直接索引。在这种情况下，如果您更改它们的起始偏移量（因为前面的字符串的长度发生了变化），您需要找到所有方法来表达该偏移量，这几乎是不可能的。此外，当数据段中的字符串变长时，您可能会超出固定缓冲区。如果整个字符串集合增长，它们之后的数据也可能会移动。

小字符串（例如，最多 4 个字符，包括 \0）也很可能存储在代码段中。更改这些可能是一个更大的挑战，因为您更不可能修改字符串长度。

请注意，根据设计，这将使所有数字签名无效。

# c - 从同一个父函数调用不同的子函数

> ID：926110
> 
> 赞同：0
> 
> 时间：2009-05-29T13:57:27.323
> 
> 标签：c, function, parent-child

我希望有一个像这样的共同父函数

```
void main (param 1, param 2)
{
    <stuff to do>
    param1();
    print("The function %s was called", param 2);
    <more stuff to do>
} 
```

其中参数 1 将是要调用的函数的名称，参数 2 将是一些描述性文本。参数 2 很简单，我已经解决了，但我不清楚如何通过传入函数名称从同一个父函数调用函数。父函数还有一些其他的功能，但与其拥有多个仅在调用的函数上有所不同的父函数或具有 switch 语句的单个父函数，id 更喜欢这种方式。有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T14:22:40.313

您实际上要为参数 1 传递的是指向您要调用的函数的函数指针，而不是该函数的名称。

看看这个关于函数指针的[教程。](http://www.newty.de/fpt/index.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T14:00:33.727

这是什么语言？如果函数不是这种语言的一等公民，你就不能这样做

如果它类似于 Java，您可以通过传入一个实现接口的对象来解决这个问题，然后在该对象上调用该函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T15:40:42.107

我会说函数指针是一件好事，但你可以利用预处理器来做你想做的事......（虽然学习如何使用函数指针是一件好事）......

我的意思是，如果 param2 是静态已知的，那么拥有函数指针就毫无用处了。如果你有动态值并且在运行程序时你想给 param2 = foo 然后 param2 = bar，那么函数指针会更好...

你真的需要不同的函数原型还是你有类似的东西......

```
#ifdef BAR
 void foo() { whatever(); }
#elif defined(FOO)
 void foo() { whocares(); }
#else
 #define foo() do{} while(0)
#endif 
```

并且始终具有相同的主体，但在命令行上给出不同的 -D ...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T23:43:38.667

像这样的东西？

```
#include <stdio.h>
void foo(void) { printf("foo\n"); }
void bar(void) { printf("bar\n"); }
static inline void parent(void func(), const char *msg)
{
    /* do stuff */
    func();
    printf("%s called\n", msg);
    /* more stuff */
}
int main(void)
{
    parent(foo, "test1");
    parent(bar, "test2");
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-29T14:21:44.183

这在 C 和一般编译语言中并不容易做到。在 Windows 上，我有这样的东西（已经很长时间了）：

```
typedef void(* simple_void_function )()
HMODULE exe_module = GetModuleHandle( NULL ); // not sure about this
simple_void_function = GetProcAddress( exe_module, param1 );
(*simple_void_function)(); 
```

如果您愿意手动将 args 压入堆栈，则实际的函数调用签名可以更加灵活。

# asp.net-mvc - 将 TinyMCE 与 ASP.NET MVC 一起使用

> ID：926125
> 
> 赞同：1
> 
> 时间：2009-05-29T13:59:32.623
> 
> 标签：asp.net-mvc, tinymce

除了拼写检查器外，我的 ASP.NET MVC 应用程序中的 TinyMCE 运行良好。我关注了这篇文章，但是当我尝试使用拼写检查器时，它给了我一个“错误：无响应”消息。

关于如何解决这个问题的任何想法？

提前致谢！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-14T00:44:12.707

[其他人在这里](https://stackoverflow.com/questions/1122659/tinymce-spellchecker-in-asp-net-mvc)遇到了（听起来像）同样的问题。解决方案是确保应用程序[没有将拼写检查器服务解释为尝试的 MVC 路由](https://stackoverflow.com/questions/1122659/tinymce-spellchecker-in-asp-net-mvc/1122766#1122766)。换句话说，有必要在你的路由定义中添加这样的东西：

```
routes.IgnoreRoute("TinyMCE.ashx"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-08T05:58:52.517

听起来像是ajax的问题​​。

# sql - 如何从结果集中仅选择常用属性？

> ID：926132
> 
> 赞同：2
> 
> 时间：2009-05-29T14:00:33.260
> 
> 标签：sql, sql-server, sql-server-2005, tsql

假设我有一个包含以下列的表：

*   `ID`
*   `Name`
*   `City`
*   `State`
*   `ZIP`

我需要编写一个只返回一行的查询。此行将包括`City`、`State`和`ZIP`，但如果结果集中的所有值都相同，我只希望字段具有值，否则我希望字段为`null`。

例如，如果每条记录都具有相同的状态，则状态将在返回的结果中。如果*只有一个*结果具有不同的状态，我希望该字段为`null`. 在 SQL Server 2005 中是否可能出现这样的情况？

基本上，我想要这样的查询：

```
SELECT City, State, ZIP
FROM Users
WHERE ID IN(1,2,3,4,5,6) 
```

但只返回一行，具有我上面描述的规格。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T14:08:01.887

```
SELECT
    CASE WHEN COUNT(DISTINCT city) = 1 THEN MAX(city) ELSE NULL END AS city,
    CASE WHEN COUNT(DISTINCT state) = 1 THEN MAX(state) ELSE NULL END AS state,
    CASE WHEN COUNT(DISTINCT zip) = 1 THEN MAX(zip) ELSE NULL END AS zip
FROM Users
WHERE ID IN(1,2,3,4,5,6) 
```

在其他答案之后：

```
SELECT
    CASE WHEN COUNT(DISTINCT NULLIF(city,'**NULL**')) = 1 THEN MAX(city) ELSE NULL END AS city,
    CASE WHEN COUNT(DISTINCT NULLIF(state,'**NULL**')) = 1 THEN MAX(state) ELSE NULL END AS state,
    CASE WHEN COUNT(DISTINCT NULLIF(zip,'**NULL**')) = 1 THEN MAX(zip) ELSE NULL END AS zip
FROM Users
WHERE ID IN(1,2,3,4,5,6) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:15:35.590

如果列不可为空，或者您想忽略空值，那么 gbn 的答案是正确的。但是，如果您需要将空值视为不同的值，请尝试以下操作：

```
CASE WHEN COUNT(DISTINCT city) = 1 
      AND COUNT(city) = COUNT(*) 
     THEN MAX(city) ELSE NULL END AS city 
```

# javascript - 为什么我在使用 Google Maps API 时没有收到“同源政策”警告？

> ID：926137
> 
> 赞同：44
> 
> 时间：2009-05-29T14:01:22.447
> 
> 标签：javascript, security, rest, google-maps, cross-domain

我正在我的 JavaScript 页面中调用 RESTful Web 服务并收到以下警告：

“此页面正在访问不受其控制的信息。这会带来安全风险。要继续吗？”

现在我已经阅读了这个并且知道[跨域，同源策略](http://en.wikipedia.org/wiki/Cross-site_scripting)。但是，当我使用 Google 的 Maps API 等其他 API 时，我不会收到此类警告。显然该域与我的本地域不同。有什么不同？

`<script>`我最初的猜测是，当我的 REST 消费使用 XMLHttpRequest 时，Google 是使用标签“导入”到页面中的。如果是这种情况，这两种方法之间有什么区别，一种值得警告，另一种则不需要？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T14:17:56.157

以下可能会解释一些事情： http: [//markmail.org/message/5wrphjwmo365pajy](http://markmail.org/message/5wrphjwmo365pajy)

此外，他们还使用了一些脚本技巧（例如，将脚本插入 DOM 以获取请求的数据，而不是 XHR）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-01-05T17:30:50.737

我想总结一下解决这个问题的方法。[您可以在此处](http://www.teamlalala.com/blog/2009/04/14/how-do-you-get-data-from-one-domain-to-another-using-javascript/)找到有用的 URL 。

`<script>`本质上，您在导入 JavaScript 时通过 pages 标签注入代码。通过此标记导入的任何内容都会立即在全局上下文中执行。因此，不要传递 JavaScript 文件，而是将 URL 传递给网站，该网站返回的页面不是 HTML 标记，而是返回 JavaScript 代码文本的页面，该文本在您的代码中调用回调。

您使用 URL 参数告诉页面要返回什么“回调”以及需要进入回调的任何参数。例如：

```
<script type="text/javascript" src="http://crossdomainhost/CrossDomainConsumerSite/Default.aspx?callback=myCallback&param1=myParam"></script> 
```

评估时，'src' 参数返回的页面内容为：

```
myCallback( myParam ); 
```

在服务器端，您将在该 URL 上创建一个站点，该站点将覆盖 OnLoad 等效项（使用您使用的任何服务器端语言）。OnLoad 将采用 URL 参数并重新调整它们以匹配上面的回调调用，而不是页面 HTML。

进行替换后，客户端加载页面时会立即调用回调。这样做的好处是'src' URL 不必与托管页面的域匹配。

下面是客户端 HTML 页面最后的样子：

```
<script type="text/javascript">
    var myCallback = function( myParam ) {
        alert( "this was called across domains!" );
    };
</script>
<script type="text/javascript" src="http://crossdomainhost/CrossDomainConsumerSite/Default.aspx?callback=myCallback&param=myParam></script> 
```

# .net - SqlCommand 如何清理参数？

> ID：926142
> 
> 赞同：11
> 
> 时间：2009-05-29T14:02:30.150
> 
> 标签：.net, sqlparameter

使用`SqlParameters`是防止数据库查询中的 SQL 注入的推荐方法。我在哪里可以找到内部清理这些参数的代码/函数？我想在我的自定义实现中重用这个函数。我尝试使用 Reflector 找到它，但没有成功。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-29T14:06:06.853

它可以防止 SQL 注入，而不是 XSS，并且**没有**清理参数数据的代码或函数。

保护是通过将参数值与查询字符串分开传输到服务器来完成的，因此这些值*永远不会*直接替换到 sql 语句中。

所以不是运行这样的sql server：

```
SELECT * FROM [table] WHERE [column] = ParameterValue 
```

它更像是这样运行的：

```
DECLARE @ParamValue int
  -- //@ParamValue variable is populated from the framework in a safe way
SELECT * FROM [table] WHERE [column] = @ParamValue 
```

这比必须评估参数数据的函数更快、更安全、更健壮。这样的功能需要非常复杂（阅读：容易出错）才能处理[自定义转义字符](http://msdn.microsoft.com/en-us/library/ms378045.aspx)和未来增强功能。

这巧妙地绕过了整个问题：数据就是数据，代码就是代码，两者永远不会相遇。

* * *

您对另一个（现已删除）的评论回答：

> 如果我传入值 O'Rourke，它会将其编码为 O''Rourke，这样它就不会破坏查询。正确的？

不，这是不正确的。该变量是直接从数据块创建的，因此不需要特殊的转义或编码。

# .net - T-SQL Management Studio 执行 SP 执行计划 - 是否存在“最大结果集数”

> ID：926152
> 
> 赞同：1
> 
> 时间：2009-05-29T14:05:38.243
> 
> 标签：.net, tsql

执行存储过程并包括实际执行计划 (Ctrl+M) 时，是否有“可以显示的最大结果集数”？

查询已超过可在“执行计划”窗格中显示的最大结果集数。只有前 250 个结果集显示在执行计划窗格中。

谢谢，

卡托

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T14:12:20.973

两者都是

不确定“网格结果”模式的限制（100？）“文本结果”只是继续显示

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T14:16:06.973

可能 - 但除非我弄错了，否则它是不可配置的。为什么要返回超过 250 个结果集？存在这种限制是有原因的；-)

# java - Blackberry 上的 Set Timer 字段是什么字段类型？

> ID：926156
> 
> 赞同：0
> 
> 时间：2009-05-29T14:06:08.427
> 
> 标签：java, user-interface, blackberry, field

我正在编写一个应用程序，它有一个间隔时间作为参数，并且想要一个类似于 Timer 必须设置其时间的字段。几秒到几小时的值对应用程序有意义。

我应该使用什么类型的字段？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T17:50:46.880

看起来像一个自定义字段。

您对内置字段的选择是： `net.rim.device.api.ui.component.NumericChoiceField`，它基本上就像一个带有数字的下拉菜单（当您谈论 60 分钟/秒时不是很好，但如果您想限制说 5 分钟间隔或其他内容可能没问题）。

`net.rim.device.api.ui.component.EditField`使用自定义`net.rim.device.api.ui.text.TextFilter`（您可以使用 a `NumericTextFilter`，但这不会将您限制为 0-60，它允许任何数字）。

或者你可以自己滚动。有关创建自定义字段的开始，请参阅[本文](http://www.thinkingblackberry.com/archives/167)。您可能需要覆盖`navigationMovement`以使轨迹球上的数字上下递增/递减，并在左右移动时在字段内移动焦点 - 设置一个内部状态变量来指示焦点所在的位置并覆盖`getFocusRect`以返回适当的焦点矩形（确保从内部调用`focusRemove`并让框架知道您已更新焦点）。`focusAdd``navigationMovement`

# tsql - TSQL 语法 - 带引号前缀的别名是否已被弃用？

> ID：926158
> 
> 赞同：0
> 
> 时间：2009-05-29T14:06:34.170
> 
> 标签：tsql

谁能告诉我，如果（1）当前（或将很快）被 MSFT 弃用，或者（2）与我不知道的一些最佳实践相反，使用以下 tsql 语法编写查询？

```
SELECT 
'CustName' = (SELECT Lastname + ', ' + Firstname FROM Cust WHERE CustID = O.CustID),
'ProdName' = (SELECT ProductName FROM Product WHERE ProductID = O.ProductID)
FROM Orders O 
```

具体问题是将新列名一直放在行的“前面”或左侧，而不是编写子查询并将新列名放在子查询之后的方括号中。显然两者都可以工作，但是审查我的数据库代码的 DBA 通常会在他们看到这个时给我一个 WTF 外观，即使我告诉他们它更具可读性，因为你所有的列名都在左边......

以这种方式编写查询有什么问题吗？

**澄清：**重点不是 SELECT 语句中的子查询，而是语法是否：

```
'NewColumnName' = OldColumnName 
```

很快就会消失。我选择用一对子查询来演示这个问题，而不是使用我正在使用的生产代码中实际存在的巨大而深奥的自定义函数调用和 case 语句。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T14:11:40.647

在使用子查询设置变量时，我通常会看到这种语法，例如 @MyValue = (subquery)。所以有一分钟我也有一点WTF。但是，我明白您的观点，总的来说，我无法想象将来不会支持它。

就个人而言，尽管我更喜欢格式化的方式和独特的“AS”定义。我会这样写。

```
SELECT 
    (SELECT Lastname + ', ' + Firstname 
     FROM Cust 
     WHERE CustID = O.CustID
    ) AS CustName,
    (SELECT ProductName 
     FROM Product 
     WHERE ProductID = O.ProductID
    ) AS ProdName
FROM Orders O 
```

我个人觉得这更容易阅读......但很可能这只是我......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T14:28:51.270

绝对没有错

```
column alias = expression 
```

语法，它不被认为很快就会被弃用或不好的做法！

该查询的主要问题是您应该使用联接将 Orders 表连接到 Cust 和 Product 表。该查询看起来像您假设每个订单只有一个客户和一个产品 - 想想如果这不是真的会发生什么......

```
SELECT 
     'CustName' = C.Lastname + ', ' + C.Firstname,
     'ProdName' = P.ProductName 
FROM Orders O 
JOIN Cust C on C.CustID = O.CustID 
JOIN Product P on P.ProductID= O.ProductID 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T14:36:20.740

根据此处的 SQL 2005 BOL（ms-help://MS.SQLCC.v9/MS.SQLSVR.v9.en/instsql9/html/c10eeaa5-3d3c-49b4-a4bd-5dc4fb190142.htm）和此处：[http:// msdn.microsoft.com/en-us/library/ms143729(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms143729(SQL.90).aspx)和这里的 2008 文档：http: [//msdn.microsoft.com/en-us/library/ms143729.aspx](http://msdn.microsoft.com/en-us/library/ms143729.aspx)（在“ Transact-SQL”功能）这将在未来的版本中被弃用（未指定）。

然而，它有点微妙。此弃用警告实际上*仅*适用于在此上下文中使用引号，而不适用于 column-alias-first 格式。IE，这将被弃用：

```
'AliasName' = NewValue 
```

但是，这仍然有效，甚至被列为它的替代品：

```
AliasName = NewValue 
```

所以只要把撇号去掉，你就很好了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T14:26:43.677

您正在以一种奇怪、不熟悉的方式为列名起别名。我不得不运行它以查看它是否有效。

与其做奇怪和不寻常的事情，不如做人们期望的事情：

```
SELECT 
   (SELECT Lastname + ', ' + Firstname FROM Cust WHERE CustID = O.CustID) AS CustName,
   (SELECT ProductName FROM Product WHERE ProductID = O.ProductID) AS ProdName
FROM Orders O 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T14:34:04.847

我的猜测是人们对此犹豫不决，因为它特定于 MSSQL，不受其他系统支持（至少，不是我现在可用的系统）。这就像听一种不熟悉的方言——你可以看到这个人在说什么，但你看不出他们到底为什么会选择那样说话。

# vb.net - 如何判断是否有人从 printPreview 打印？

> ID：926160
> 
> 赞同：1
> 
> 时间：2009-05-29T14:07:04.667
> 
> 标签：vb.net, printing

```
Using printPreview As New PrintPreviewDialog()
        ' Dim x As New Printing.PrintDocument()
        ' AddHandler x.PrintPage, AddressOf PrintData
        printPreview.Document = Me.CurrentDocument
        If ShowPrinterSetup Then
            Dim x As New PrintDialog()
            x.Document = CurrentDocument
            x.ShowDialog(Anchor)
        End If
        whichPage = 0
        Return printPreview.ShowDialog(Anchor)
End Using 
```

到目前为止，无论我在 printpreview 中单击什么，showdialog 都会返回取消？如何判断用户是否打印？如果项目确实打印到打印机，我想清除项目的打印队列，或者询问他们是否应该清除它，但前提是他们确实打印了一些东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-05T04:34:19.517

您可以从 CurrentDocument EndPrint 事件中获取打印作业的结果

```
Private WithEvents CurrentDocument As New PrintDocument

Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    Using printPreview As New PrintPreviewDialog()
        printPreview.Document = Me.CurrentDocument
        printPreview.ShowDialog()
    End Using
End Sub

Private Sub document_EndPrint(ByVal sender As Object, ByVal e As PrintEventArgs) Handles CurrentDocument.EndPrint
    If e.PrintAction = PrintAction.PrintToPrinter Then
        MsgBox("Document Printed to Printer")
    End If
End Sub 
```

# programming-languages - 为什么要创建一种新的编程语言？

> ID：926161
> 
> 赞同：23
> 
> 时间：2009-05-29T14:07:33.700
> 
> 标签：programming-languages

创建一种新的编程语言的真正好处是什么？您不太可能实际使用它。

简而言之，创建一门新语言的过程将如何让你成为更好的程序员？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-29T14:09:58.687

您将了解语言设计背后的决策，并更好地全面了解在可读性、性能和可靠性之间做出的妥协。

**您对递归、闭包、垃圾收集、引用管理、类型、数据结构以及这些事物实际工作**方式等概念的熟悉程度将会提高。大多数程序员会更好地利用资源和语言特性。

类似于我们在使用其他语言时学习编写解决方案的新方法的方式，当我们编写自己的语言时，我们会探索创建解决方案的新方法。请参阅[元编程](http://en.wikipedia.org/wiki/Metaprogramming)。与问题所暗示的相反，[领域特定语言](http://en.wikipedia.org/wiki/Domain-specific_language)用于许多环境。

如果您正在编写编译器，您将比以往任何时候都了解更多关于计算机如何工作的知识。（*取决于您的目标，*可能比您打算学习的要多）

当我在学校编写自己的排序例程时，甚至是重新实现好的排序例程时，它确实将一些算法的一些[弱点](https://web.archive.org/web/20090624205111/http://linux.wku.edu/~lamonml/algor/sort/quick.html)带回家了。

*简而言之，知道如何**使用**工具的程序员和知道如何**制作**工具的程序员之间存在一个数量级的差异。*

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-29T14:15:47.380

我可以从这里的经验说...

**有趣，特定领域的问题解决，上下文复杂性**

我喜欢创造新的语言来获得**乐趣**，以及解决**特定领域的问题**。一个非常简单的例子可能是 Wikipedia 标记或像 Erlang 这样复杂的东西，它专门从事**并发处理**。

许多通用语言是相似的，因为它们是通用的。有时，您需要对正在解决的问题的机制进行更**准确的抽象**。另一个例子是 M4 宏语言。

请记住，**语言不是魔法**，它只是具有**隐含语义**的已定义语法结构的集合。SQL 是有目的的语言的一个很好的例子，该目的在它的语法和语义中定义。

学习语言是如何工作的，什么使语言可解析，什么使语义变得合理，以及它的实现，我认为可以让你成为一个更好的程序员。

**编译器体现了许多**支撑计算机科学的理论：

翻译、抽象、解释、数据结构、状态……不胜枚举。学习这些东西将使您了解程序的含义以及引擎盖下发生的事情。您当然可以独立学习，但编译器是**学习**复杂主题的绝佳环境，例如 DFA/NDFA 自动机、基于堆栈的解析器、抽象语法树......

**我认为编译器是漂亮的机器:)**

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-30T03:38:04.987

多种原因：

*   吹牛的权利
*   经济激励
*   *极度*无聊
*   对数百种现有语言的不满
*   未经治疗的精神错乱
*   希望实现有助于新设计概念的语言（例如使设计模式更易于结合的语言）
*   其他原因，也许

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-29T14:24:02.510

我认为 Jeff Attwood 在[这篇 Coding Horror 帖子](http://www.codinghorror.com/blog/archives/001145.html)中回答了这个问题——尽管他在谈论一个更普遍的问题（为什么要创建任何新的库、框架等，而同一设计空间中已经存在其他工件），我怀疑这正是说的更广阔的视野给了他一个不同而有趣的视角。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-30T03:11:07.857

我要补充一点，如果您**编写语义**，以便您的语言是一种实际语言，而不仅仅是某些特定实现所接受的语言，您将学到大量关于**如何精确描述计算行为**的知识：

*   您将了解哪些行为是容易描述的，哪些是不容易描述的——并证明是正确的。

*   您将学习如何权衡不同种类的形式来描述不同种类的特征。

*   你最终会成为一个更好的程序员，因为你将学习的形式主义和证明技术将适用于各种问题：锁定技术、内核中的安全属性、无锁数据结构、网络协议和信息安全，仅举几例. 所有这些领域都可以接受与编程语言相同的正式处理。

仅举一个例子，如果你给你的语言一个静态类型系统，然后你证明一个类型良好的程序保证是内存安全的，你将学到和你写的一样多的东西（在不同的维度上）解释器或编译器。

**编辑**：如果你想学习这些东西，我认为最简单的起点是[Benjamin Pierce 的两本关于类型和编程语言的系列丛书](http://www.cis.upenn.edu/~bcpierce/tapl/)。还有一[本 Glynn Winskel 的研究生教科书，](http://tinyurl.com/aswgge)它有点难，但更倾向于语义和证明技术。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-29T14:15:57.347

创建**领域特定语言**非常有价值。与其只考虑通用语言，不如考虑在项目中创建清晰表达抽象的所谓“小语言”。

例如，在最近的一个项目中，我决定使用命令模式来驱动服务层。我在我的命令代码中发现了一些重复，所以我编写了一个小编译器，它接受一种简单的语言来表达命令并以“底层”语言发出命令实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-29T14:14:45.260

出于同样的原因，即使您一生中从未编写过一个编译器，在大学学习编译器构建课程也会使您受益。如果可以的话，这是引擎盖下的外观。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-29T14:15:11.717

除了 altCognito 所说的（从理论/学术角度来看）之外，当现有的“通用”语言对您的任务效率极低或没有简单的方法时，创建了一些高度专业化的语言来有效地解决特定问题。使用现有的替代方案。

诚然，这种情况往往很少见，如果您遇到问题的第一反应是“我需要一种新的语言来解决这个问题。”，那么您很可能遗漏了一些东西。“可用”技术需要有相当大的差距，并且您需要保证这样的承诺。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-29T14:16:30.467

我认为对此确实有两个概念上不同的答案。首先，您了解编译器如何将您的代码转换为可执行代码。这可以帮助您更好地决定如何构建代码以更好地优化（或允许优化）。例如，如果您知道某个构造会禁止编译器内联代码块或展开循环，那么如果性能成为一个真正的问题，您就可以避免这种情况。

其次，所有当前的语言都是在历史的某个时刻发明（或衍生）的。对于其中的每一个，实际使用它的可能性可能很小，但它们就在这里。他们都找到了存在的理由，即某人想做一些在现有语言中不可能或不容易做到的事情，并决定为此做点什么。懒惰（或希望让计算机为您完成工作的愿望）是发明之母。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-29T14:26:04.987

只是为了好玩......然后你会意识到你无法做出比你认为他们糟糕的所有语言更好的东西 xD（所以你停止抱怨它们）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-29T14:13:51.377

编写编译器或解释器需要对计算机科学理论有非常深刻的理解。而且，如果您要编译为机器代码而不是另一种语言，则还需要对硬件设计有深刻的理解。

除此之外，了解如何设计编译器意味着您将对一般语言以及您所使用的特定语言有更好的理解。您将更好地理解语言设计者在编写规范时所采取的语法和权衡取舍。

并不是说编写编译器会让你成为更好的程序员。正是对语言理论和编译器设计的深刻理解让你变得更好。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-29T14:20:05.747

> 创建新语言的过程将如何让你成为更好的程序员？

你是对的，你可能会也可能不会使用该语言，但至少你从中获得**的经验**将有助于你理解编程语言的实现以及你将能够应用于未来计算的某些事情你遇到的问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-29T14:14:07.883

大多数情况下，您这样做是为了好玩或扩大您对某个主题的理解。

我不同意创建新语言会影响性能-性能是什么？恕我直言，执行速度不应该取决于语言结构，而是语言被翻译成什么 - 这是不同的：比如为一种语言创建语法并为其编写编译器/虚拟机。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-29T14:37:08.817

因为[会说话的青蛙很整洁](http://www.computerjokes.net/017.asp)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-30T03:18:50.917

我想要一种托管语言，它允许修改其内部作为标准实践。有点像 Ruby 在更广泛的范围内打鸭子。

作为图书馆的客户，我应该能够换出不符合我要求的图书馆功能。

这就是让我为 .NET 疯狂的原因。微软不会修复框架中的错误，感谢 GAC 签名，我无法修复。即使不是为了 GAC 签名，热修补全局库也是一个坏主意（可能会破坏其他一些应用程序）。

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2009-05-29T15:21:52.177

我不关心编译器是如何工作的，不关心学习新语言，也不关心使用像 perl 和 javascript 这样的脚本语言。我对构建（或应该构建）大型程序的方式更感兴趣。仍然没有好的解决方案可以让 LARGE 软件像原型代码一样易于使用。编程语言对此没有帮助。它们解决了诸如排序和内存释放之类的琐碎问题，让您独自处理真正重要的问题（使您或您的公司免于亏损）。

# c++ - 如何隐藏exe或dll中的字符串？

> ID：926172
> 
> 赞同：34
> 
> 时间：2009-05-29T14:10:17.407
> 
> 标签：c++, security, obfuscation, reverse-engineering, defensive-programming

我发现可以从二进制文件中提取硬编码字符串。
例如，[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)的属性视图显示所有超过 3 个字符的字符串。

这是我编写的一个简单可执行文件的代码，用于简单地对其进行测试：

```
#ifndef _WIN32_WINNT
#define _WIN32_WINNT 0x0501
#endif
#include <stdio.h>
#include <tchar.h>
#include <Windows.h>

int _tmain(int argc, _TCHAR* argv[])
{
    _TCHAR* hiddenString1 =_T("4537774B-CC80-4eda-B3E4-7A9EE77991F5");
    _TCHAR* hiddenString2 =_T("hidden_password_or_whatever");
    for (int i= 0; i<argc; i++) {
        if (0 == _tcscmp(argv[i],hiddenString1)) {
            _tprintf (_T("The guid argument is correct.\n")); }
        else if (0 == _tcscmp(argv[i],hiddenString2)) {
            _tprintf (_T("Do something here.\n")); }
    }

    _tprintf (_T("This is a visible string.\n"));
    //Keep Running
    Sleep(60000);
    return 0;
} 
```

可以清楚地从相应的可执行文件中提取字符串：
![替代文字](https://i.stack.imgur.com/3k8mN.png)

我认为找到字符串有点太容易了。

我的问题是：

1.  如何在可执行文件中**简单地**隐藏*hiddenString1*或*hiddenString2*？
2.  有没有比使用一些晦涩的隐藏输入更安全的方法来使用“作弊码”？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-29T14:14:12.390

欢迎来到更广阔的防御性编程世界。

有几种选择，但我相信它们都依赖于某种形式的混淆；这虽然不完美，但至少是一些东西。

1.  您可以将文本存储为其他二进制形式（十六进制？），而不是直接的字符串值。

2.  您可以加密存储在应用程序中的字符串，然后在运行时解密它们。

3.  您可以将它们拆分到代码中的各个点，然后再重新组合。

或者它们的某种组合。

请记住，有些攻击比查看实际二进制文件更进一步。有时他们会在程序运行时调查程序的内存地址空间。MS 在 .Net 2.0 中提出了一种称为[SecureString 的](http://msdn.microsoft.com/en-us/library/system.security.securestring.aspx)东西。目的是在应用程序运行时保持字符串加密。

第四个想法是不要将字符串存储在应用程序本身中，而是依赖于将验证代码提交到您控制的服务器。在服务器上，您可以验证它是否是合法的“作弊码”。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-05-29T21:04:22.933

有很多方法可以*隐藏*可执行文件中的数据。这里的其他人已经发布了很好的解决方案——一些比其他的更强大。我不会添加到该列表中。

请注意：这完全是一场猫捉老鼠的游戏：**不可能**保证**没有**人会发现你的“秘密”。

无论您使用多少加密或其他技巧；无论你投入多少精力或金钱。无论隐藏它涉及多少“NASA / MIT / CIA / NSA”类型。

这一切都归结为简单的物理原理：
如果*任何*用户都无法从可执行文件中提取您的秘密并“取消隐藏”它，那么计算机也无法取消隐藏它，您的程序也无法取消隐藏它。用它。任何有足够动力的中等技能开发人员都会找到揭开秘密的方法。

在您将可执行文件交给用户的那一刻，他们就拥有了找出秘密所需的一切。

您所能期望的最好的结果就是让揭开秘密变得*如此困难*，以至于您从知道秘密中获得的任何好处都变得不值得麻烦。

因此，如果数据公开只是“不好”，或者公开的后果只是“不方便”，则可以尝试隐藏数据。但千万不要想在你的程序中隐藏“主客户端数据库的密码”、私钥或其他一些关键机密。你就是不能。

如果你有真正的机密信息，你的程序会以某种方式需要但绝不应该成为公共信息（如私钥），那么你需要让你的程序与你控制的远程服务器通信，应用适当的身份验证和授权控制（*也就是说，确保只有经过批准的人员或计算机才能向服务器发出请求*），并让该服务器保密并使用它。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-29T14:19:47.120

最简单的方法是用 xor 或 rot-13 之类的微不足道的东西加密它们，然后在使用它们时即时解密它们。这将消除对它们的随意观看，但不会阻止任何有丰富经验的人倒车。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-29T14:18:30.010

除了克里斯提到的那些方法之外，您还可以使用散列算法。如果您只想检查是否指定了正确的 ID，您实际上不需要将整个 ID 存储在程序中。

*   创建您要比较的字符串/密码/id 的哈希（MD5、SHA 等），可能会向其添加“盐”值。将其存储在您的程序中
*   程序运行时，对输入的字符串/密码/id做同样的算法，比较两个哈希值是否匹配。

这样，实际文本永远不会存储在您的程序中，并且他们无法对您的程序进行逆向工程以找出原始文本是什么，因为哈希算法只是单向的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-01-19T15:32:58.547

> 我也想隐藏一些 http 请求的 URL。

如果您的应用程序正在发出请求，那么隐藏它是没有意义的。运行像 fiddler、http 分析器或其他数十种免费且现成的方法中的一种应用程序将显示您的应用程序正在创建的所有流量。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-29T14:23:39.203

如果存在您不希望人们看到的特定字符串，则在运行时对其进行加密和解密。

如果您不希望人们看到您的 GUID，请从字节构造它，而不是从字符串构造：

```
const GUID SecretGuid = 
      { 0x4537774B, 0xCC80, 0x4eda, { 0x7A, 0x9E, 0xE7, 0x79, 0x91, 0xF5 } }; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-29T15:24:14.247

你所有的密码都是 GUID 还是只是一个例子？

也许将您的秘密存储为二进制 guid：

```
const GUID SecretGuid =
    { 0x4537774B, 0xCC80, 0x4eda, { 0x7A, 0x9E, 0xE7, 0x79, 0x91, 0xF5 } }; 
```

然后将您提供的 guid 从字符串转换为二进制格式并比较两个二进制 guid。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-12T13:14:23.913

您可以做的最好的事情是将您的密码或其他要隐藏的字符串编码为 char 数组。例如：

```
std::string s1 = "Hello";   // This will show up in exe in hex editor
char* s2 = "World";   // this will show up in exe in hex editor
char s3[] = {'G', 'O', 'D'}; // this will not show up in exe in hex editor. 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-08-07T12:42:12.477

这是我为此目的使用的方法。首先，我使用[Sysinternals的](https://docs.microsoft.com/en-us/sysinternals/)[字符串](https://docs.microsoft.com/en-us/sysinternals/downloads/strings)工具来显示 EXE 或 DLL 中的字符串。然后，我使用[以下小工具](https://www.codeproject.com/KB/shell/1210398/TinyObfuscate.zip)（请参阅[文章](https://www.codeproject.com/Articles/1210398/Small-String-Obfuscator)）将这些字符串替换为存储为算术表达式的加扰字符数组：例如：而不是字符串： **“这是一个测试”** 我将放置以下代码：（由[该工具](http://www.codeproject.com/Articles/502283/Strings-Obfuscation-System)自动生成）

 **```
WCHAR T1[28];
 T1[22] = 69;
 T1[15] = 121 - 17;
 T1[9] = L':' + -26;
 T1[12] = L't' - 1;
 T1[6] = 116 - 1;
 T1[17] = 117 - 12;
 T1[3] = 116 - 1;
 T1[14] = L'' - 3;
 T1[13] = L'w' - 3;
 T1[23] = 69;
 T1[26] = L'Y' + 3;
 T1[19] = 111 + 0;
 T1[21] = L'k' - 34;
 T1[27] = L'\\' - 8;
 T1[20] = L'B' + 32;
 T1[4] = 42 + -10;
 T1[25] = L'm' - 17;
 T1[16] = L'H' + 18;
 T1[18] = L'A' + 56;
 T1[24] = 68;
 T1[1] = 105 - 1;
 T1[11] = L'k' - 6;
 T1[10] = 66 + 50;
 T1[2] = 105;
 T1[0] = 117 - 1;
 T1[5] = L'k' - 2;
 T1[8] = 89 + 8;
 T1[7] = 32; 
```

这个问题有很多解决方案，但没有一个（包括我的）是完美的，但是有一些方法可以打乱、伪装和隐藏敏感字符串。您当然可以在运行时对其进行加密和解密（请参阅本文），但我发现更重要的是让这些字符串在可执行文件的位和字节中消失并且它可以工作。运行我的工具后，您不会在可执行文件中找到“这是一个测试”。

# database - 如何在数据库中创建嵌套类别？

> ID：926175
> 
> 赞同：11
> 
> 时间：2009-05-29T14:11:19.667
> 
> 标签：database, nested, categories

我正在制作一个将嵌套类别的视频网站：

eg Programming-> C Language -> MIT Videos -> Video 1 Programming -> C Language -> Stanford Video -> Video 1 Programming -> Python -> Video 1

这些类别和子类别将由用户动态创建。当人们以可导航菜单的形式创建它们时，我将需要展示它们，以便人们可以轻松地浏览集合。

有人可以帮助我如何创建这样的数据库吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-29T14:15:22.090

制作一个包含以下字段的类别表：

*   类别 ID - 整数
*   CategoryName - String/Varchar/Whatever
*   ParentID - 整数

然后，您的 ParentID 将引用回其父级的 CategoryID。

例子：

```
CategoryID CategoryName ParentID
---------------------------------
1          Dog          NULL
2          Cat          NULL
3          Poodle       1
4          Dachsund     1
5          Persian      2
6          Toy Poodle   3 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-29T14:48:10.823

夸斯诺伊 说：

> 您应该使用嵌套集或父子模型。

我曾经实现它们。我能说的是：

如果您的类别表不经常更改，请使用嵌套集架构，因为在 select 子句上它很快，并且只需一个请求，您就可以获得给定条目的层次结构的整个分支。但是在插入或更新子句上，更新左和右（或下例中的下和上）字段比父子模型花费更多时间。

还有一点，我必须承认，
这很微不足道，但是：直接在数据库中手动更改层次结构非常困难（可能在开发过程中发生）。所以，一定要先实现一个接口来玩嵌套集（更改父节点，移动分支节点，删除节点或整个分支等）

这里有两篇关于这个主题的文章：

*   [在数据库中存储分层数据](http://www.sitepoint.com/hierarchical-data-database/)

*   [在 MySQL 中管理分层数据](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

最后一件事，我没有尝试过，但我在某处读到，嵌套集合表中可以有不止一棵树，我的意思是几个根。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-29T14:14:14.463

您应该使用其中一个`nested sets`或`parent-child`模型。

`Parent-child`：

```
typeid 父名

1 0 买家
2 0 卖家
3 0 裁判
4 1 电气
5 1 机械师

```

```
SELECT  *
FROM    mytable
WHERE   group IN
        (
        SELECT  typeid
        FROM    group_types
        START WITH
                typeid = 1
        CONNECT BY
                parent = PRIOR typeid
        ) 
```

将选择 中的所有买家`Oracle`。

`Nested sets`：

```
typeid 小写名字
1 1 2 买家
2 3 3 卖家
3 4 4 裁判
4 1 1 电气
5 2 2 机械师

```

```
SELECT  *
FROM    group_types
JOIN    mytable
ON      group BETWEEN lower AND upper
WHERE   typeid = 1 
```

将选择任何数据库中的所有买家。

有关更多详细信息，请参阅[**此答案**](https://stackoverflow.com/questions/916367/database-model-structure)。

`Nested sets`更容易查询，但更难更新，更难构建树形结构。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-29T14:44:54.933

从您问题中的示例来看，您似乎希望给定类别可能有多个父级（例如，“MIT Videos -> Video 1 Programming”以及“Video -> Video 1 Programming”），在这种情况下，仅添加 ParentID 列是不够的。

我建议创建两个表：一个包含 CategoryID 和 CategoryName 列的简单 Categories 表，以及一个包含 ParentCategoryID 和 ChildCategoryID 列的单独 CategoryRelationships 表。这样，您可以为任何特定类别指定任意数量的父子关系。甚至可以使用此模型建立双重关系，其中两个类别同时是彼此的父级和子级。（在我的脑海中，我想不出这种场景有什么用处，但至少它说明了模型的灵活性。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T14:15:36.070

你需要的是一个基本的父子关系：

```
Category (ID: int, ParentID: nullable int, Name: nvarchar(1000)) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-28T06:49:21.773

存储表的 parent_id 的更好方法是将其嵌套在 ID 中，例如

100000 编程 110000 C 语言 111000 视频 1 编程 111100 C 语言 111110 斯坦福视频

等等..所以你只需要一个脚本来处理ID，这样第一个数字代表顶级类别等等，当你深入层次结构时

# css - 内联 img导致 IE 中出现奇怪的问题

> ID：926180
> 
> 赞同：0
> 
> 时间：2009-05-29T14:11:50.460
> 
> 标签：css, internet-explorer, inline, image

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T14:29:11.407

使用以下 HTML，我能够重现您的问题：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <style type="text/css">
        div.something img 
        {
            display: inline;
            border: none;
        }
        div.something a
        {
            border: 0;
        }
    </style>
</head>
<body>
    <div class="something">
        <a href="http://www.somelink.com">
            <img src="images/someimage.jpg" alt="sometag" />
        </a>
        <a href="http://www.somelink.com">
            <img src="images/someimage.jpg" alt="sometag" />
        </a>
        <a href="http://www.somelink.com">
            <img src="images/someimage.jpg" alt="sometag" />
        </a>
    </div>
</body>
</html> 
```

这样做的问题是，开始“a”标签的结尾和“img”标签的开头之间的空白被认为是链接的一部分。

将那些替换为：

```
<a href="http://www.somelink.com"><img src="images/someimage.jpg" alt="sometag" /></a> 
```

为我解决了 IE8 中的问题。

**EDIT**: Removed the CSS. Turned out not to be necessary.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T14:14:37.240

您需要设置`border="0"`您的图像标签，这将解决问题。当图片在链接内时，IE 会自动在其周围放置“链接”边框，以表明它是一个链接。

您也许还可以使用 CSS 将 img 标签的边框设置为 0

# linux - 关于 fork 和 execve 系统调用

> ID：926185
> 
> 赞同：15
> 
> 时间：2009-05-29T14:13:10.660
> 
> 标签：linux, unix

据说`fork`系统调用会创建调用进程的克隆，然后（通常）子进程发出`execve`系统调用以更改其映像并运行新进程。为什么要分两步？

顺便说一句，`execve`代表什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-31T01:24:27.303

两步的原因是灵活性。在这两个步骤之间，您可以修改新执行的程序将继承的子进程的上下文。

您可能想要更改的一些内容是：

*   文件描述符
*   用户/组 ID
*   进程组和会话 ID
*   当前目录
*   资源限制
*   调度优先级和亲和力
*   文件创建掩码 (umask)

如果您没有拆分 fork 和 exec 而是有一个类似 spawn 的系统调用，如果您希望它们在子进程中设置不同，则需要为每个进程属性获取参数。例如，请参阅 Windows API 中 CreateProcess 的参数列表。

使用 fork/exec，您可以在执行新程序之前更改子进程中想要的任何可继承进程属性。

设置文件描述符是在子进程上下文中更改的更常见的事情之一。如果要捕获程序的输出，通常会在父进程中使用 pipe(2) 系统调用创建一个管道，然后在 fork(2)ing 之后关闭父进程中的写入端并关闭在调用 execve(2) 之前在子进程中读取 end。（您还将使用 dup(2) 将管道的子端设置为文件描述符 1 (stdout)）。这在单个系统调用中要么是不可能的，要么是受限的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-29T14:19:35.733

*   exec：执行新进程
*   v : 使用参数数组
*   e：同时指定环境

exec 的其他变体比比皆是：

```
int execl(const char *path, const char *arg, ...);
int execlp(const char *file, const char *arg, ...);
int execle(const char *path, const char *arg,..., char * const envp[]);
int execv(const char *path, char *const argv[]);
int execvp(const char *file, char *const argv[]); 
```

*   l：在函数上列出 arg
*   p: 使用 $PATH 定位可执行文件

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-29T14:16:55.083

每一步都比较简单。

在 Unix 中，您的进程有两部分——一个带有应用程序代码（“文本”）的只读内存区域和一个可读写的内存区域（“数据”）。

一个 fork 克隆了读写区域，只留下文本页面。您现在有两个运行相同代码的进程。它们的不同之处在于一个寄存器值——fork 的返回值——它将父与子分开。

一个 exec 替换了文本页，只留下数据页。exec 有多种形式，具体取决于您传递给它的环境信息量。有关变体的其他列表，请参见[http://linux.die.net/man/3/exec](http://linux.die.net/man/3/exec)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-29T14:22:24.993

“exec”系列函数用新的进程映像替换当前进程映像（从它被调用的位置），因此调用映像被新的进程映像替换。例如。如果您要从 shell（/bin/sh 或 /bin/csh）运行“ls”命令，那么 shell 将分叉到一个新进程，然后该进程将执行 ls。一旦 ls 命令退出，它会将控制权返回给父进程，在本例中是 shell。

如果没有 fork 功能，那么 shell 将被 'ls' 进程替换，该进程在退出时会留下一个无法访问的终端，因为内存中的 shell 映像在 exec 调用 ls 时被替换。

对于 'exec' 系列的变体，请查看 0x6adb015 的答案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-03-17T23:54:09.810

> # 代表什么`execve`？

*C 中exec*函数的 6 个变体是`exec{l,v}{,e,p}`. 有关详细信息，请参阅下面的函数原型。

**命令行参数**

*   `v`- 命令行参数作为指针数组（向量）传递给函数**。**
*   `l`- 命令行参数单独（一个**列表**）传递给函数。

**环境变量（可选）**

*   `e`- 一个指向环境变量的指针数组**被**显式传递给新的过程映像

**找到要执行的文件（可选）**

*   `p`- 使用**P** ATH 环境变量查找要执行的文件参数中命名的*文件*

* * *

```
int execl (char const *path, char const *arg0, ...);
int execle(char const *path, char const *arg0, ..., char const *envp[]);
int execlp(char const *file, char const *arg0, ...);
int execv (char const *path, char const *argv[]);
int execve(char const *path, char const *argv[], char const *envp[]);
int execvp(char const *file, char const *argv[]); 
```

* * *

[来源](https://en.wikipedia.org/wiki/Exec_(system_call))

# c++ - 两个 DLL 声明之间的区别

> ID：926187
> 
> 赞同：2
> 
> 时间：2009-05-29T14:13:22.593
> 
> 标签：c++, dll

我有一个简单但微妙的问题。下面您会看到来自 DLL 头文件的同一类的两个不同声明变体。

谁能告诉我这个类声明的区别；

```
class __declspec(dllexport) Car {
public:
    Car();
    void drive(void); 
    typedef enum { None, Indented } Formatting;
} 
```

从这个？

```
class Car {
public:
    __declspec(dllexport) Car();
    __declspec(dllexport) void drive(void); 
    __declspec(dllexport) typedef enum { None, Indented } Formatting;
} 
```

在第一个声明中，类本身是*__declspec(dllexport)*，而在后一种情况下，每个类元素都是单独声明的。

它们是不同的还是有什么共同点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T14:42:40.867

使用[depends](http://www.dependencywalker.com/)的简短测试表明，与第二个示例相比，第一个示例导出了一个额外的符号（顺便说一句，您不导出枚举，这是不合法的）。如果我没记错的话，我相信这是默认的赋值运算符。

第一种方法导出整个类，第二种方法只是以 declspec 为前缀的方法（我猜这并不奇怪）。

所以我想说导出类的正确方法显然是第一种，我个人没有看到任何使用第二种方法导出的类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T14:41:56.703

导出一个类是导出它的所有公共函数的简写。

`__declspec`所以不同之处在于`Formatting`枚举是无意义的。

有时只导出有限的类功能集更合适；那么后一种形式是首选。请注意，在您的情况下，不会导出“自动”生成的析构函数。

# .net - 需要关于编写我自己的急切加载算法的建议

> ID：926195
> 
> 赞同：0
> 
> 时间：2009-05-29T14:14:26.617
> 
> 标签：.net, sql

我正在维护一个用 C# 编写的内部 ORM，它目前没有任何急切加载机制。为了提高性能，我们决定它需要预先加载，因此我们需要编写自己的代码来支持它。（我和我的同事没有任何 ORM 工具的经验，此外，由于一些遗留原因，我们不允许使用流行的工具，如 LinqtoSQL、Entity Framework 或 Nhibernate。）

我的问题是，生成急切加载 SQL 语句的公认最佳实践是什么？我想了想，想出了两个办法——

假设有 4 个表的经典示例 - CustomerCategory 有很多 Customer A Customer 有很多 Order 一个 Order 有很多 OrderDetail

并假设我想从所有 4 个表中急切加载数据，而我的条件是 - Order.OrderDate 在 '2008-05-05' 和 '2008-12-31' 之间

方法 1 - 我生成一个 sql 来从所有 4 个表中获取数据，所有表都使用内部连接，以便我为每个表的主键的每个唯一组合获得一行。我会将我的 Where 条件应用于此 sql。

方法 2 - 我生成一个 SQL 以首先仅获取订单数据，并将我的 Where 条件应用于此 sql，因为 Order.OrderDate 来自 Order 表。然后，根据此查询的结果，我将知道我需要的所有订单 ID 值，因此我将使用这些来检索订单详细信息数据。我还将知道我需要的所有唯一客户 ID 值，因此我还将使用这些值从客户表中检索数据，最后我将对 CustomerCategory 执行相同的操作。此方法总共需要 4 个 SQL 语句。

我可以看到第一种方法效率更高，但我的一位同事指出，第二种方法虽然使用 4 条 SQL 语句，但更易于编写和维护，我同意这一点。

对此的任何想法将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T14:22:42.683

首先，您的域模型大错特错。我个人不能证明 a 中的`Customer`对象集合是合理的，`CustomerCategory`因为从性能的角度来看它没有意义：大多数时候你需要一个客户（加上它的组），而一个充满客户的组将需要一次在蓝月亮但它会一直存在，导致各种问题。这同样适用于`Customer`拥有许多`Order`s。

现在，回答你的问题。通常认为应该尽量减少到数据库的往返次数，即使是以检索到不必要的数据为代价。也就是说，连接两个大表（长表和宽表）以同时从两个关联表中选择数据可能是性能杀手，所以要小心。

我建议你看看它是如何在 NHibernate 中完成的。它允许您为每个关联指定获取策略（加入、选择），无论是一对一关联还是一对多关联。

如果您使用的是 Microsoft SQL Server 2005 或更高版本，则可以使用[MARS](http://technet.microsoft.com/en-us/library/ms345109(SQL.90).aspx)将几个 s 填充`select`到一个批次中，然后对仅发出一个 SQL 命令的整个对象图进行水合。

# php - 输出为数组

> ID：926204
> 
> 赞同：0
> 
> 时间：2009-05-29T14:15:45.210
> 
> 标签：php

```
 $result = mysql_query(" SELECT p.page_url AS url,
                               COUNT(*) AS occurrences 
                               FROM page p, word w, occurrence o
                               WHERE p.page_id = o.page_id AND
                               w.word_id = o.word_id AND
                               w.word_word = \"$keyword\"
                               GROUP BY p.page_id
                               ORDER BY occurrences DESC
                               " );

$output = "<loginsuccess>";

for( $i = 1; $row = mysql_fetch_array($result); $i++ )      {

$output .="<keyword>".$_POST['keyword']."</keyword><name>".$row['url']."</name><occur>".$row['occurrences']."</occur><queryTime>".(substr($end_time-$start_time,0,5))."</queryTime>";
}

$output .= "</loginsuccess>";
print ($output); 
```

我在 XML 中获取输出，而不是我想要它在数组中......如何实现这一点。

下面的代码不起作用...

```
$ret = array();
for( $i = 1; $row = mysql_fetch_array($result); $i++ )      {

     $tmp['url'] = $row['url'];
     $tmp['occurrences'] = $row['occurrences'];

     $ret[] = $tmp;

}
 return $ret; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T14:21:59.677

当您调用`mysql_fetch_array($result)`. 这就是[mysql_fetch_array](http://ca.php.net/mysql_fetch_array)所做的。

除非你想要其他类型的数组格式？如果是这样，您将必须更具体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T14:25:03.180

使用[`print_r()`](http://us2.php.net/manual/en/function.print-r.php)：

```
echo "<pre>";
print_r($row);
echo "</pre>"; 
```

**注意：**如果您不将其包装在`<pre>`标签中，则输出将难以阅读，因为它将全部显示在一行上

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T15:56:09.597

**for 循环**只能以增量方式使用，您试图用它来代替**while**循环。这不是“做 1000 次”，而是“在我们有一行可以使用的时候做”。

尝试这个：

```
while($row = mysql_fetch_array($result)) {
  $tmp['url'] = $row['url'];
  $tmp['occurrences'] = $row['occurrences'];
  $ret[] = $tmp;
}
return $ret; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T19:40:53.117

您需要在使用 $tmp 数组之前对其进行初始化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T14:57:21.070

像这样尝试，注意写 SQL 语句的 here-doc 风格。我觉得很有帮助。此外，我建议重写 SQL 以使用 JOIN，而不是使用连接条件来拥挤 WHERE 子句。

```
$sql = <<<EOSQL
SELECT p.page_url AS url, COUNT(*) AS occurrences 
FROM page p, word w, occurrence o
WHERE p.page_id = o.page_id AND
w.word_id = o.word_id AND
w.word_word = "$keyword"
GROUP BY p.page_id
ORDER BY occurrences DESC;
EOSQL;
$result = mysql_query($sql) or die('failed to execute the query');

while ($row = mysql_fetch_array($result)) {
    print_r ($row);
} 
```

希望这大致是你所追求的

# sql - 查询将某些行转换为列名

> ID：926209
> 
> 赞同：2
> 
> 时间：2009-05-29T14:16:15.570
> 
> 标签：sql, sql-server, pivot, transpose

我有几个看起来像这样的表 表 1

```
user_id   |  name
-------------------------   
x111      |   Smith, James
x112      |   Smith, Jane 
```

ETC..

表 2

```
id    |   code    |    date       |  incident_code    | user_id
-----------------------------------------------------------------
1     |    102008 |   10/20/2008  |    1              | x111
2     |    113008 |   11/30/2008  |    3              | x111
3     |    102008 |   10/20/2008  |    2              | x112
4     |    113008 |   11/30/2008  |    5              | x112 
```

我想展示的是这样的

```
user_id     |    user_name    |   INCIDENT IN OCT 2008   | INCIDENT IN NOV 2008
------------------------------------------------------------------------------ 
x111        |    Smith, John  |   1                      | 3
x112        |    Smith, Jane  |   2                      | 5 
```

ETC..

event_code 将替换为位于另一个表中的事件的实际描述，但我想我会先看看它是如何工作的。

一些列标题将是静态的，而其他列标题将基于日期创建。有谁知道我如何使用 sql server 2005 做到这一点？一些例子会很有帮助。

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-30T08:24:33.823

这是一个使用 PIVOT 生成并运行动态 SQL 的解决方案：

```
DECLARE @pivot_list AS VARCHAR(MAX)

--
;
WITH    cols
          AS ( SELECT DISTINCT
                        'INCIDENT IN ' + LEFT(UPPER(CONVERT(VARCHAR, [date], 107)),
                                              3) + ' '
                        + SUBSTRING(UPPER(CONVERT(VARCHAR, [date], 107)), 9, 4) AS col
               FROM     so926209_2
             )
    SELECT  @pivot_list = COALESCE(@pivot_list + ', ', '') + '[' + col + ']'
    FROM    cols

--
DECLARE @template AS VARCHAR(MAX)
SET @template = 'WITH incidents AS (
SELECT  [user_id],
        incident_code,
        ''INCIDENT IN '' + LEFT(UPPER(CONVERT(VARCHAR, [date], 107)), 3)
        + '' '' + SUBSTRING(UPPER(CONVERT(VARCHAR, [date], 107)), 9, 4) AS col
FROM    so926209_2
)
,results AS (
SELECT * FROM incidents PIVOT (MAX(incident_code) FOR col IN ({@pivot_list})) AS pvt
)
SELECT results.[user_id]
    ,so926209_1.[name]
    ,{@select_list}
FROM results INNER JOIN so926209_1 ON so926209_1.[user_id] = results.[user_id]
'

DECLARE @sql AS VARCHAR(MAX)
SET @sql = REPLACE(REPLACE(@template, '{@pivot_list}', @pivot_list), '{@select_list}', @pivot_list)

--PRINT @sql
EXEC (@sql) 
```

`so926209_1`你的`so926209_2`表1和表2在哪里？

请注意，如果同一个人在一个月内发生了多次事件，则您的示例不会显示您希望如何处理。此示例仅采用该月的最后一个事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T14:18:30.337

你想转 [http://msdn.microsoft.com/en-us/library/ms177410.aspx](http://msdn.microsoft.com/en-us/library/ms177410.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T14:32:39.543

这听起来像是一个报告任务。报告，通常从数据库的角度被称为 OLAP，在线分析处理，往往与“传统”数据库访问，OLTP（在线事务处理）有很大不同，因为它通常由跨越更长时期的大量数据聚合组成的时间。很多时候，您正在寻找的那种聚合。

使用 Tetraneutron 建议的 Pivot 对于较小的数据集就足够了。但是，随着您需要报告的数据量的增长，您可能需要更高级的东西。OLAP 由 SQL Server Analysis Services (SSAS) 提供，于 2005 年和 2008 年可用。使用 SSAS，您可以创建多维数据存储库，这些存储库可以直接从 OLTP 数据库或从中间数据仓库数据库预聚合数据。多维数据（通常称为多维数据集）提供了一种更快的方式来访问可以从 Pivot 获取的数据类型，而不会影响 OLTP 数据库中标准事务处理的性能。

如果您需要报告的数据多于少量，我建议您查看 SQL Server Analysis Services 2005、OLAP、Cubes 和 MDX（T-SQL 的多维扩展）。有一个更大的学习曲线需要设置建立一个 OLAP 多维数据集，但一旦设置好，如果您有大量的报告需求，拥有一个多维数据集的好处可能是巨大的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T17:11:21.670

像这样的查询会起作用：

```
select
    u.User_id,
    u.Name,
    Okt2008Sum = sum(case when i.date between 
        '2008-10-01' and '2008-11-01' then 1 else 0 end),
    Nov2008Sum = sum(case when i.date between 
        '2008-11-01' and '2008-12-01'then 1 else 0 end)
from #incidents i
inner join #users u on i.user_id = u.user_id
group by u.user_id, u.name 
```

根据您的客户端以及您必须运行它的频率，您可以生成此查询。在 SQL 中，这看起来像：

```
create table #months (
    MonthName varchar(25),
    StartDate datetime
)

insert into #months values ('Okt2008','2008-10-01')
insert into #months values ('Nov2008','2008-11-01')

declare @query varchar(8000)
select @query = 'select u.User_id, u.Name '

select @query = @query + ', ' + MonthName + 
    ' = sum(case when i.date between ''' + cast(StartDate as varchar) + 
    ''' and ''' + cast(dateadd(m,1,StartDate) as varchar) + 
    ''' then 1 else 0 end) '
from #Months

select @query = @query + '
    from #incidents i
    inner join #users u on i.user_id = u.user_id
    group by u.user_id, u.name'

exec (@query) 
```

# reporting - 如何根据 Reporting Services 中的参数值选择不同的数据集

> ID：926214
> 
> 赞同：1
> 
> 时间：2009-05-29T14:17:21.120
> 
> 标签：reporting, service

是否可以根据 Reporting Services 中的参数值选择不同的数据集（查询）？提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T14:57:47.123

如果您调用存储过程来返回结果集，只需有一个参数确定要运行的查询版本。保持结果集列及其类型相同。

```
create procedure YourReportProcedure
(
     @ReportVersion    char(1)
    ,@filterParam1     varchar(12)
    ,@filterParam2     int
    ....
)

if @ReportVersion='A'
BEGIN
    SELECT
        A,B,C
        FROM .....
        WHERE x=@filterParam1 and y=@filterParam2

END
ELSE IF@ReportVersion='C'
BEGIN
    SELECT
        A,B,C
        FROM .....
        WHERE g>@filterParam1 and r<@filterParam2

END
ELSE
BEGIN
    return 1 --error
END

return 0

go 
```

# java - 在 Java 中使用 SAXON Xpath 引擎

> ID：926222
> 
> 赞同：8
> 
> 时间：2009-05-29T14:19:23.097
> 
> 标签：java, xpath, saxon

这是我的代码：

```
public static void main(String[] args) {

    // System.setProperty(
    // "javax.xml.xpath.XPathFactory", 
    // "net.sf.saxon.xpath.XPathFactoryImpl");

    String xml="<root><a>#BBB#</a><a>#CCC#</a><b><a>#DDD#</a></b></root>";
    try{
        JDocument dom = new JDocument(xml);

        XPathFactory factory = net.sf.saxon.xpath.XPathFactoryImpl.newInstance();
        XPath xpath = factory.newXPath();
        XPathExpression expr = xpath.compile("//a[matches(.,'#...#')]");

        Object result = expr.evaluate(dom, XPathConstants.NODESET);
        NodeList nodes = (NodeList) result;
        Nodes sharped = new Nodes(nodes);

        for (Node n:sharped){
            System.out.println(n.toString());
        }
    }
    catch(Exception e){
        e.printStackTrace();
    }

} 
```

我明白了：

```
javax.xml.transform.TransformerException: Impossible to find the function : matches
at org.apache.xpath.compiler.XPathParser.error(XPathParser.java:608)
at org.apache.xpath.compiler.XPathParser.FunctionCall(XPathParser.java:1505)
at org.apache.xpath.compiler.XPathParser.PrimaryExpr(XPathParser.java:1444)
at org.apache.xpath.compiler.XPathParser.FilterExpr(XPathParser.java:1343)
at org.apache.xpath.compiler.XPathParser.PathExpr(XPathParser.java:1276) 
```

这意味着`org.apache.xpath.compiler.XPathParser`当我通过`net.sf.saxon.xpath.XPathFactoryImpl`.

（我实际上只需要`matches`在我的 xpaths 中放一些......所以如果知道任何不涉及撒克逊的解决方案，请考虑满足我的需要）。

我究竟做错了什么 ？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-29T14:26:50.460

来自撒克逊人的例子：

```
System.setProperty("javax.xml.xpath.XPathFactory:"+NamespaceConstant.OBJECT_MODEL_SAXON, "net.sf.saxon.xpath.XPathFactoryImpl");
XPathFactory xpf = XPathFactory.newInstance(NamespaceConstant.OBJECT_MODEL_SAXON); 
```

工作正常。

# c# - 如何检测机器是否加入域？

> ID：926227
> 
> 赞同：60
> 
> 时间：2009-05-29T14:20:07.557
> 
> 标签：c#, .net

如何检测机器是否加入了 Active Directory 域（相对于工作组模式）？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2010-02-16T18:42:28.530

如果没有必要，不要用 pinvoke 愚弄。

参考 System.DirectoryServices，然后调用：

```
System.DirectoryServices.ActiveDirectory.Domain.GetComputerDomain() 
```

`ActiveDirectoryObjectNotFoundException`如果机器未加入域，则抛出一个。返回的 Domain 对象包含您要查找的 Name 属性。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-05-29T14:40:09.810

您可以 PInvoke 到 Win32 API，例如[NetGetDcName](http://www.pinvoke.net/default.aspx/netapi32.NetGetDCName)，它将为未加入域的机器返回 null/空字符串。

更好的是[NetGetJoinInformation](http://www.pinvoke.net/default.aspx/netapi32.NetGetJoinInformation)它将明确告诉您机器是否未加入，在工作组或域中。

使用`NetGetJoinInformation`我把这个放在一起，这对我有用：

```
public class Test
{
    public static bool IsInDomain()
    {
        Win32.NetJoinStatus status = Win32.NetJoinStatus.NetSetupUnknownStatus;
        IntPtr pDomain = IntPtr.Zero;
        int result = Win32.NetGetJoinInformation(null, out pDomain, out status);
        if (pDomain != IntPtr.Zero)
        {
            Win32.NetApiBufferFree(pDomain);
        }
        if (result == Win32.ErrorSuccess)
        {
            return status == Win32.NetJoinStatus.NetSetupDomainName;
        }
        else
        {
            throw new Exception("Domain Info Get Failed", new Win32Exception());
        }
    }
}

internal class Win32
{
    public const int ErrorSuccess = 0;

    [DllImport("Netapi32.dll", CharSet=CharSet.Unicode, SetLastError=true)]
    public static extern int NetGetJoinInformation(string server, out IntPtr domain, out NetJoinStatus status);

    [DllImport("Netapi32.dll")]
    public static extern int NetApiBufferFree(IntPtr Buffer);

    public enum NetJoinStatus
    {
        NetSetupUnknownStatus = 0,
        NetSetupUnjoined,
        NetSetupWorkgroupName,
        NetSetupDomainName
    }

} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2013-09-11T16:11:21.900

也可以使用 system.net 调用

```
string domain = System.Net.NetworkInformation.IPGlobalProperties.GetIPGlobalProperties().DomainName 
```

如果域字符串为空，则机器未绑定。

返回的属性文档[https://docs.microsoft.com/en-us/dotnet/api/system.net.networkinformation.ipglobalproperties.domainname?view=netframework-4.7.2#System_Net_NetworkInformation_IPGlobalProperties_DomainName](https://docs.microsoft.com/en-us/dotnet/api/system.net.networkinformation.ipglobalproperties.domainname?view=netframework-4.7.2#System_Net_NetworkInformation_IPGlobalProperties_DomainName)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-29T14:29:56.493

```
ManagementObject cs;
        using(cs = new ManagementObject("Win32_ComputerSystem.Name='" + System.Environment.MachineName + "'" ))
        {
            cs.Get();
            Console.WriteLine("{0}",cs["domain"].ToString());
        } 
```

那应该允许您获得域。如果您是工作组而不是域的一部分，我相信它将为空或为空。

确保参考 System.Management

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-12-05T22:08:31.363

只是想在 VB 中删除 Rob 的代码：

```
 Public Class Test
    Public Function IsInDomain() As Boolean
        Try
            Dim status As Win32.NetJoinStatus = Win32.NetJoinStatus.NetSetupUnknownStatus
            Dim pDomain As IntPtr = IntPtr.Zero
            Dim result As Integer = Win32.NetGetJoinInformation(Nothing, pDomain, status)

            If (pDomain <> IntPtr.Zero) Then
                Win32.NetApiBufferFree(pDomain)
            End If

            If (result = Win32.ErrorSuccess) Then
                If (status = Win32.NetJoinStatus.NetSetupDomainName) Then
                    Return True
                Else
                    Return False
                End If
            Else
                Throw New Exception("Domain Info Get Failed")
            End If
        Catch ex As Exception
            Return False
        End Try
    End Function
End Class
Public Class Win32
    Public Const ErrorSuccess As Integer = 0
    Declare Auto Function NetGetJoinInformation Lib "Netapi32.dll" (ByVal server As String, ByRef IntPtr As IntPtr, ByRef status As NetJoinStatus) As Integer
    Declare Auto Function NetApiBufferFree Lib "Netapi32.dll" (ByVal Buffer As IntPtr) As Integer
    Public Enum NetJoinStatus
        NetSetupUnknownStatus = 0
        NetSetupUnjoined
        NetSetupWorkgroupName
        NetSetupDomainName
    End Enum
End Class 
```

以及斯蒂芬的代码在这里：

```
Dim cs As System.Management.ManagementObject
    Try
        cs = New System.Management.ManagementObject("Win32_ComputerSystem.Name='" + System.Environment.MachineName + "'")
        cs.Get()
        dim myDomain as string = = cs("domain").ToString
    Catch ex As Exception
    End Try 
```

我相信只有第二个代码才能让您知道机器加入了哪个域，即使当前用户不是域成员。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-29T14:53:38.053

环境变量可以为您工作。

```
Environment.UserDomainName 
```

[MSDN 链接](http://msdn.microsoft.com/en-us/library/system.environment.userdomainname.aspx)了解更多详细信息。

```
Environment.GetEnvironmentVariable("USERDNSDOMAIN") 
```

我不确定这个环境变量是否存在而不在域中。

如果我错了，请纠正我 Windows 管理员极客——我相信一台计算机可以位于多个域中，因此了解您所在的域（如果有）可能比它位于*任何*域中更重要。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-04-24T13:34:39.103

您可以检查 Win32_ComputerSystem WMI 类的 PartOfDomain 属性。[MSDN](http://msdn.microsoft.com/en-us/library/windows/desktop/aa394102%28v=vs.85%29.aspx)说：

> 部分域
> 
> 数据类型：布尔值
> 
> 访问类型：只读
> 
> 如果为 True，则计算机是域的一部分。如果值为 NULL，则计算机不在域中或状态未知。如果您从域中取消加入计算机，则该值变为 false。

```
/// <summary>
/// Determines whether the local machine is a member of a domain.
/// </summary>
/// <returns>A boolean value that indicated whether the local machine is a member of a domain.</returns>
/// <remarks>http://msdn.microsoft.com/en-us/library/windows/desktop/aa394102%28v=vs.85%29.aspx</remarks>
public bool IsDomainMember()
{
    ManagementObject ComputerSystem;
    using (ComputerSystem = new ManagementObject(String.Format("Win32_ComputerSystem.Name='{0}'", Environment.MachineName)))
    {
        ComputerSystem.Get();
        object Result = ComputerSystem["PartOfDomain"];
        return (Result != null && (bool)Result);
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-10-02T23:01:47.187

这是我根据本文中的几个答案开发的异常处理/注释方法。

1.  获取计算机连接到的域。
2.  仅当用户实际登录域帐户时才返回域名。

    ```
    /// <summary>
    /// Returns the domain of the logged in user.  
    /// Therefore, if computer is joined to a domain but user is logged in on local account.  String.Empty will be returned.
    /// Relavant StackOverflow Post: http://stackoverflow.com/questions/926227/how-to-detect-if-machine-is-joined-to-domain-in-c
    /// </summary>
    /// <seealso cref="GetComputerDomainName"/>
    /// <returns>Domain name if user is connected to a domain, String.Empty if not.</returns>
    static string GetUserDomainName()
    {
        string domain = String.Empty;
        try
        {
            domain = Environment.UserDomainName;
            string machineName = Environment.MachineName;

            if (machineName.Equals(domain,StringComparison.OrdinalIgnoreCase))
            {
                domain = String.Empty;
            }
        }
        catch
        {
            // Handle exception if desired, otherwise returns null
        }
        return domain;
    }

    /// <summary>
    /// Returns the Domain which the computer is joined to.  Note: if user is logged in as local account the domain of computer is still returned!
    /// </summary>
    /// <seealso cref="GetUserDomainName"/>
    /// <returns>A string with the domain name if it's joined.  String.Empty if it isn't.</returns>
    static string GetComputerDomainName()
    {
        string domain = String.Empty;
        try
        {
            domain = System.DirectoryServices.ActiveDirectory.Domain.GetComputerDomain().Name;
        }
        catch
        {
            // Handle exception here if desired.
        }
        return domain;
    } 
    ```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-01-23T15:40:13.187

您可能想尝试使用 DomainRole WMI 字段。值 0 和 2 分别显示独立工作站和独立服务器。

我们将它用于 XIA 配置我们的网络审计软件，所以我在这里抄袭了这个方法......

```
/// <summary>
/// Determines whether the local machine is a member of a domain.
/// </summary>
/// <returns>A boolean value that indicated whether the local machine is a member of a domain.</returns>
/// <remarks>http://msdn.microsoft.com/en-gb/library/windows/desktop/aa394102(v=vs.85).aspx</remarks>
public bool IsDomainMember()
{
    ManagementObject ComputerSystem;
    using (ComputerSystem = new ManagementObject(String.Format("Win32_ComputerSystem.Name='{0}'", Environment.MachineName)))
    {
        ComputerSystem.Get();
        UInt16 DomainRole = (UInt16)ComputerSystem["DomainRole"];
        return (DomainRole != 0 & DomainRole != 2);
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-11-18T21:09:58.973

如果本地用户登录，上述建议的解决方案在域计算机上返回 false。

我发现最可靠的方法是通过 WMI：

[http://msdn.microsoft.com/en-us/library/aa394102](http://msdn.microsoft.com/en-us/library/aa394102(v=vs.85).aspx) (v=vs.85).aspx（参见域角色）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-02-19T16:01:18.130

`Domain.GetComputerDomain()`可能非常慢。在某些环境中，它可能需要 30 秒以上。

如果性能很重要，请使用[GetComputerNameEx](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724301%28v=vs.85%29.aspx)函数：

```
 bool IsComputerInDomain()
    {
        uint domainNameCapacity = 512;
        var domainName = new StringBuilder((int)domainNameCapacity);
        GetComputerNameEx(COMPUTER_NAME_FORMAT.ComputerNameDnsDomain, domainName, ref domainNameCapacity);
        return domainName.Length > 0;
    }

    [DllImport("kernel32.dll", SetLastError = true, CharSet = CharSet.Auto)]
    static extern bool GetComputerNameEx(
        COMPUTER_NAME_FORMAT NameType,
        StringBuilder lpBuffer,
        ref uint lpnSize);

    enum COMPUTER_NAME_FORMAT
    {
        ComputerNameNetBIOS,
        ComputerNameDnsHostname,
        ComputerNameDnsDomain,
        ComputerNameDnsFullyQualified,
        ComputerNamePhysicalNetBIOS,
        ComputerNamePhysicalDnsHostname,
        ComputerNamePhysicalDnsDomain,
        ComputerNamePhysicalDnsFullyQualified
    } 
```

`systeminfo`它返回与shell 命令相同的值。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-07-15T15:36:57.100

您可以使用**WMI**检查：

```
private bool PartOfDomain()
{
    ManagementObject manObject = new ManagementObject(string.Format("Win32_ComputerSystem.Name='{0}'", Environment.MachineName));
    return (bool)manObject["PartOfDomain"];
} 
```

# ruby-on-rails - 在 Ruby on Rails 中使用多态的替代方法

> ID：926230
> 
> 赞同：8
> 
> 时间：2009-05-29T14:20:34.250
> 
> 标签：ruby-on-rails, polymorphism

我目前正在编写一些 Intranet Web 应用程序，人们可以在其中向管理员提交添加不同资源的请求。示例请求将是：

*   安装程序，在这种情况下，用户将选择他要安装的程序
*   增加配额，在这种情况下，用户只需输入他需要的磁盘空间量，或者他可能会选择预定义的数量 - 1GB、10GB 等......
*   创建新的电子邮件别名，在这种情况下，用户只需键入别名。
*   ...

我正在考虑只有一个模型 UserRequests 与对发件人的引用和两个可选属性一个是 reference_id 引用其他表（例如他想要安装的程序），另一个将用于免费类型字段，如电子邮件别名或配额。

所以我的问题是，根据请求的类型，模型应该包含：

*   参考其他表格
*   整数数据
*   字符串数据

根据请求的类型，应该采取给定的操作 - 可能可以从 rails 添加电子邮件别名，但用户计算机上的应用程序将手动安装。

有没有人有类似的问题？你认为对这类东西使用多态性是个好主意吗？您对如何组织表格中的数据有什么建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-29T15:30:20.427

单表继承！这样，您可以让每种类型的请求都有自定义验证，同时仍然让每个请求都存在于同一个表中。

```
class CreateUserRequests < ActiveRecord::Migration
  def self.up
    create_table :user_requests do |t|
      t.string :string_data, :type
      t.integer :user_id, :integer_data
      t.timestamps
    end
  end
  def self.down
    drop_table :user_requests
  end
end

class UserRequest < ActiveRecord::Base
  belongs_to :user
end

class EmailAliasRequest < UserRequest
  validates_presence_of :string_data
  validates_format_of :string_data, :with => EMAIL_REGEX
end

class ProgramInstallRequest < UserRequest
  belongs_to :program, :class_name => "Program", :foreign_key => "integer_data"
  validates_presence_of :integer_data
end

class QuotaIncreaseRequest < UserRequest
  validates_presence_of :string_data
  validates_inclusion_of :string_data, :in => %w( 1GB 5GB 10GB 15GB )
end 
```

当然，给你的`string_data`and `integer_data`to取别名`email`，让你的其他代码更有意义。让模型成为隐藏一切的小黑匣子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:09:04.137

我会使用多态关联，它让一个模型属于多个使用单个关联的其他模型。像这样的东西：

```
class AdminRequest < ActiveRecord::Base
  belongs_to :user
  belongs_to :requestable, :polymorphic => true
end

class EmailAlias < ActiveRecord::Base
  has_many :admin_requests, :as => :requestable
end

class ProgramInstall < ActiveRecord::Base
  has_many :admin_requests, :as => :requestable
end

class QuotaIncrease < ActiveRecord::Base
  has_many :admin_requests, :as => :requestable
end 
```

*   与以往一样，Ryan Bates 在这个主题上有着出色的[Railscast](http://railscasts.com/episodes/154-polymorphic-association)。

# icons - Web 设置项目中未显示桌面快捷方式图标

> ID：926232
> 
> 赞同：1
> 
> 时间：2009-05-29T14:21:37.930
> 
> 标签：icons, shortcuts, web-setup-project

我创建了一个 Web 设置项目，我希望它为 Web 应用程序创建一个桌面快捷方式（例如：[http://localhost/xx/yy.aspx](http://localhost/xx/yy.aspx)）。到目前为止，这很容易：我创建了一个快捷方式（不管在哪里），给它我想要的 url，将它添加到我的 web 设置项目的用户桌面特殊文件夹中，并在安装后放置在桌面上. 但后来我想显示我的自定义快捷方式图标。我设置了我在文件系统上创建的快捷方式的图标。然后我将它重新包含到安装项目中。但是安装后，快捷方式会再次显示默认的 IE 图标。（我在 Windows 2003 服务器上试过这些，在 win xp 上，快捷方式显示为无图标）

经过一些试验，我找到了另一种方法：我在我的文件系统上重新创建了一个无图标快捷方式，打开了我的 Web 设置项目，将此快捷方式和我的图标包含在目标机器上的文件系统下的 Web 应用程序文件夹中，然后单击用户的桌面，右键单击右侧空白区域，选择创建新快捷方式并选择我刚刚添加的快捷方式。然后在用户桌面下，我单击新创建的快捷方式，打开属性窗口并将其图标属性设置为我包含的图标。这些步骤在 2003 服务器和 win xp 上都解决了。

虽然这不是一个真正的问题，但我还是想分享它，因为它很烦人。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-10T19:33:59.030

那么问题是您没有在安装程序中包含包含图标的实际 ico、exe 或 dll 文件吗？快捷方式文件 (.lnk) 实际上并不包含图标的副本，而只是指向它们的链接。

# maven-2 - Ant 相当于 Maven 配置文件？

> ID：926238
> 
> 赞同：4
> 
> 时间：2009-05-29T14:22:20.940
> 
> 标签：maven-2, ant

是否有与 Maven 中的“配置文件”概念等效的 Ant？

我希望能够根据参数指定一组不同的目标来构建（从一个 Ant 文件中）。所以在 Maven 中我可以指定一个配置文件，然后像这样激活它：`mvn groupId:artifactId:goal -Denvironment=test`

所以说我的 build.xml 包含：

```
<target name="profile1">...</> 
```

和

```
<target name="profile2">...</> 
```

如何在编译时指定要执行的内容？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T19:58:11.337

您可以在调用它时将参数传递给 ant

```
ant -DProfile=foo 
```

然后`${Profile}`将替换`foo`

这是一个糟糕的解决方法，但如果这是您的目标，它应该能够通过命令行传递参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T14:35:44.530

[`property`](http://ant.apache.org/manual/Tasks/property.html)您可以使用或[`loadproperties`](http://ant.apache.org/manual/Tasks/loadproperties.html)任务从文件中读取属性。

这取决于您要复制的确切内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T04:57:51.823

对于第一种情况：“ant profile1”。第二种情况留作练习。

说真的，你想要执行的目标列表已经是 ant 的一个参数。我认为您需要使您的示例更加明确。

# wcf - 实体框架（实体从 EntityObject 到 DTO，然后再到 EntityObject ）此时是否可以在 db 中轻松更新它？

> ID：926240
> 
> 赞同：0
> 
> 时间：2009-05-29T14:22:26.367
> 
> 标签：wcf, entity-framework

我认为我的整个问题都在标题栏内=]，但我会解释更多。

我在数据库中有 2 个相关表（客户和订单）和 wcf 服务，它返回客户和所有相关订单作为 DTO，如下所示：

> 类 CustomerDto
> {
> int ID;
> IList<OrderDto> 订单；
> }
> 和：
> 类 OrderDto
> {
> int ID;
> 字符串 someString;
> }

发生了什么：
客户要求客户（客户与订单一起返回），进行一些更改（添加/删除订单，更改 someString），并将数据发送回服务。

在这里我想问一下，是否可以将修改后的客户附加到数据库上下文，或者我需要手动进行更改？

谢谢你 ！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:46:54.040

这是[一篇包含可下载代码示例](http://msdn.microsoft.com/en-us/magazine/cc700340.aspx "分层架构中的实体框架")的文章，介绍了一起使用 EF 和 WCF，包括更新。您还可以查看[RIA 服务](http://download.microsoft.com/download/F/B/8/FB8CA635-296B-487F-965C-8148F08B5319/riaservicesoverviewpreview.pdf)。

# javascript - 通过javascript将TR附加到表的最简单方法是什么？

> ID：926242
> 
> 赞同：1
> 
> 时间：2009-05-29T14:22:33.030
> 
> 标签：javascript, dom

如果表 id 是已知的——因此可以使用该表获得`docoument.getElementById(table_id)`——我如何以最简单的方式将 TR 元素附加到该表？

TR如下：

```
<tr><td><span>something here..</span></td></tr> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-29T14:26:09.777

第一个使用 DOM 方法，第二个使用非标准但广泛支持的 innerHTML

```
var tr = document.createElement("tr");
var td = document.createElement("td");
var span = document.createElement("span");
var text = document.createTextNode("something here..");
span.appendChild(text);
td.appendChild(span);
tr.appendChild(td);

tbody.appendChild(tr); 
```

或者

```
tbody.innerHTML +=  "<tr><td><span>something here..</span></td></tr>" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T14:25:59.357

使用 jQuery：

```
$('#table_id > tbody').append('<tr><td><span>something here..</span></td></tr>'); 
```

我知道有些人可能会因为提到 jQuery 而畏缩。包括一个框架来做这件事可能是矫枉过正。但我很少发现我只需要用 javascript 做“一件事”。手工编码的解决方案是创建所需的每个元素，然后以适当的顺序（从内到外）将它们添加到其他元素，最后将新行添加到表中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T14:31:38.907

插入表格行的最直接、符合标准且独立于库的方法是使用表格对象[的 insertRow 方法](https://developer.mozilla.org/en/DOM/table.insertRow)。

```
var tableRef = document.getElementById(tableID);

// Insert a row in the table at row index 0
var newRow   = tableRef.insertRow(0); 
```

PS 也可以在 IE6 中使用，但有时可能会有一些怪癖。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T14:26:42.753

如果您不反对使用 jQuery，则可以使用以下任一方法，其中“tblId”是表的 id，“_html”是表行的字符串表示形式：

```
 $(_html).insertAfter("#tblId tr:last"); 
```

或者

```
$("#tblId tr:last").after(_html); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T14:27:44.187

非常简单的例子：

```
<html>
<table id = 'test'>
   <tr><td>Thanks tvanfosson!</td></tr>
</table>
</html>

<script type="text/javascript" charset="utf-8">
   var table = document.getElementById('test');
   table.innerHTML += '<tr><td><span>something here..</span></td></tr>';
</script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T14:37:19.287

我使用此函数将一堆行附加到表中。对于大块数据，它比 jquery 快大约 100%。唯一的缺点是，如果您的行中有脚本标签，则脚本不会在 IE 中加载时执行

```
function appendRows(node, html){
    var temp = document.createElement("div");
    var tbody = node.parentNode;
    var nextSib = node.nextSibling;

    temp.innerHTML = "<table><tbody>"+html;
    var rows = temp.firstChild.firstChild.childNodes;

    while(rows.length){
        tbody.insertBefore(rows[0], nextSib);
    }
} 
```

其中 node 是要追加的行，html 是要追加的行

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-07-23T04:19:49.160

我用这个，工作柔和：

```
var changeInnerHTMLOfMyCuteTbodyById = function (id_tbody, inner_html)
{ 
     //preparing
     var my_tbody = document.getElementById (id_tbody);
     var my_table = my_tbody.parentNode;

     my_table.removeChild (my_tbody);

     //creating dom tree
     var html = '<table style=\'display:none;\'><tbody id='+ id_tbody+'>' + 
inner_html + '</tbody></table>';

     var tmp_div = document.createElement ('div');

     tmp_div.innerHTML = html;

     document.body.appendChild (tmp_div);

     //moving the tbody
     my_table.appendChild (document.getElementById (id_tbody));
} 
```

你可以这样做：

```
changeInnerHTMLOfMyCuteTbodyById('id_tbody', document.getElementById ('id_tbody').innerHTML + '<tr> ... </tr>'); 
```

# jquery - jquery livequery插件执行模糊事件更多

> ID：926245
> 
> 赞同：0
> 
> 时间：2009-05-29T14:23:15.540
> 
> 标签：jquery, jquery-plugins

我对 livequery 插件版本有问题：1.0.3。

观看此代码：

```
$('#'+$(celDiv).find('input').attr('id')).livequery('blur',function(){
    var idProduct = $('#idProduct').val();
    var idSupplier = $('#idSupplier').val();
    var lotNumber = $('#lotNumber').val();
    var idSpecification = $('#idSpecification').val();
    var version = $('#version').val();
    var idItemAnalysis = id;
    var seqItemAnalysis = $(celDiv).parents('tr').find("td").eq(5).text();
    var operator = $(celDiv).parents('tr').find("td").eq(1).text();
    var val = $('#'+$(celDiv).find('input').attr('id')).val();

    if(val != null)
    {
        if((operator != '=>' && operator != '<=' ) && !isNaN(val.replace(',','.')))
        {
            $.post('/Operations/SaveAnalysisResults',{
                idProduct: idProduct,
                idSupplier: idSupplier,
                lotNumber: lotNumber,
                idSpecification: idSpecification,
                version: version,
                idItemAnalysis: idItemAnalysis,
                seqItemAnalysis: seqItemAnalysis,
                val: val
            });
            gridResultsAnalysis.flexReload();
        }
        else{
            alert("For this operation, the value must be numerical");
            $('#'+$(celDiv).find('input').attr('id')).val('');
        }
    }
}); 
```

在 blur 事件之后，livequery 调用被执行得更多，我的数据一致性出现问题。

对于解决方案，我创建了一个布尔变量来了解此代码是否已执行，但我认为此解决方案是一种替代解决方案。

有人有其他解决方案吗？livequery插件有错误吗？

谢谢大家 ！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-23T12:02:59.020

您现在可以在 1.4.1+ 的 jQuery 核心中执行此操作，如下所示：

```
$(celDiv).find('input').live('blur', function(){ 
```

你的电话也是这样的：

```
$('#'+$(celDiv).find('input').attr('id')).val(); 
```

只能是：

```
$(celDiv).find('input').val(); 
```

或者，在您的函数内部：

```
$(this).val(); 
```

# macos - 奇怪的行为 - Mac OS X 上的 SWT 浏览器

> ID：926246
> 
> 赞同：1
> 
> 时间：2009-05-29T14:23:20.483
> 
> 标签：macos, browser, swt

这是一种奇怪的行为，没有图片很难解释，所以我会尽力而为。

我的应用程序有一个嵌入式 SWT 浏览器小部件，并且该应用程序是跨平台的。它在 Windows 上完美运行，但需要支持 Mac OS X 10.4 及更高版本。浏览器小部件位于右侧的组合中，而另一个组合中的文件树位于左侧。用户从树中单击文件，它们依次被解密并显示在浏览器中。

我目前正在 Mac 10.4.11 上测试该应用程序，这种奇怪的行为仅在我调整 shell 窗口大小时才会发生。复合和浏览器小部件本身会正确调整大小。我可以看到对象的边界/边界。问题是应该在浏览器中的图像 - 移位（几乎就像显示的图像没有锚定到浏览器的左上角一样）。它从上到下对齐，并且图像本身的大小是正确的，但是在调整大小完成后图像会移动。该应用程序在最初加载时看起来很好（意味着图像对齐完美），当文件树被隐藏并且浏览器/复合占用完整的外壳时看​​起来很好，当文件树恢复时看起来很好。只有在调整大小时才会发生这种情况。

我希望这有点道理。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T15:17:43.103

Ok i figured it out. Here is what I had at first (in pseudo-code):

webBrowser.setSize(shell.width, shell.height);

webComposite.getParent().layout();

Turns out i needed to pretty much restore the browser and its composite in the same way i did when i restored the file tree (cause i knew it was correctly sized after that action). The code above was replaced with:

webComposite.setLayoutData(new GridData(SWT.LEFT, SWT.TOP, true, true));

webComposite.setBounds(widthOfTreeComposite, 0, shell.width, shell.height);

webComposite.setSize(shell.width, shell.height);

webBrowser.setLayoutData(new GridData(SWT.LEFT, SWT.TOP, true, true));

webBrowser.setBounds(0, 0, shell.width, shell.height);

# architecture - 数据交换标准

> ID：926254
> 
> 赞同：2
> 
> 时间：2009-05-29T14:25:22.103
> 
> 标签：architecture, standards, communication

有一些国际标准定义了分布式系统中信息交换的各个高级方面。我所说的“高级”是指描述信息应该如何组织和呈现，必须提供哪些接口，如何传达元数据等。

例如，能源公用事业使用 OPC (DAIS)、CIM；模拟具有 IEEE 1516 (HLA)。可能其他一些行业对类似的交互有完善的标准吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T23:44:31.817

楼宇自动化和控制行业使用[BACnet](http://www.BACnet.org/)，它是[ASHRAE](http://ashrae.org)标准、ANSI 标准以及 ISO 标准。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T22:56:19.120

医疗保健行业使用[HL7](http://www.hl7.org/)

房地产使用[RETS](http://www.rets.org/about)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T22:36:26.647

金融业使用[SWIFT](http://www.swift.com/)和[FIX](http://www.fixprotocol.org/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T22:50:33.623

[OASIS](http://www.oasis-open.org "绿洲")记录了通用商业语言和其他数十种语言。至少，UBL 作为一种发票标准被广泛接受，一些国家（至少丹麦）将 UBL 作为对公共组织开具发票的法律要求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T23:08:03.153

您需要[EDI](http://en.wikipedia.org/wiki/Electronic_data_interchange)，尽管这是针对不同域的许多不同标准的全部内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-09T14:56:41.560

评估行业使用[MISMO](http://www.mismo.org/)（抵押行业标准维护组织）。几年前，MISMO 与 RETS（房地产交易标准）进行了松散的合作。RETS 服务于房地产社区，专门组织 MLS（多重上市系统）和感兴趣的实体之间的上市数据交换。

# performance - 不得已的性能优化策略

> ID：926266
> 
> 赞同：623
> 
> 时间：2009-05-29T14:26:59.977
> 
> 标签：performance, optimization, language-agnostic

这个网站上已经有很多性能问题，但我发现几乎所有问题都非常具体且相当狭窄。几乎所有的人都会重复这些建议以避免过早的优化。

让我们假设：

*   代码已经正常工作
*   选择的算法对于问题的情况已经是最优的
*   代码已被测量，有问题的例程已被隔离
*   还将衡量所有优化尝试，以确保它们不会使事情变得更糟

我在这里寻找的是策略和技巧，可以在没有其他事情可做的情况下，在关键算法中挤出到最后几个百分比，而不管它需要什么。

理想情况下，尝试使答案与语言无关，并在适用的情况下指出建议策略的任何缺点。

我将用我自己的初步建议添加回复，并期待 Stack Overflow 社区能想到的任何其他内容。

* * *

## 回答 #1

> 赞同：442
> 
> 时间：2009-05-29T19:41:53.210

好的，您正在将问题定义到看起来没有太大改进空间的地方。根据我的经验，这种情况相当罕见。我试图在 1993 年 11 月的 Dobbs 博士的一篇文章中解释这一点，从一个没有明显浪费的传统设计良好的非平凡程序开始，并对其进行一系列优化，直到它的挂钟时间从 48 秒减少到 1.1 秒，源代码大小减少了 4 倍。我的诊断工具[是这个](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)。变化的顺序是这样的：

*   发现的第一个问题是使用列表集群（现在称为“迭代器”和“容器类”）占一半以上的时间。这些被相当简单的代码所取代，将时间缩短到 20 秒。

*   现在最大的耗时是更多的列表建设。以百分比来说，以前没那么大，但现在是因为更大的问题被排除了。我找到了一种加快速度的方法，时间降到了 17 秒。

*   现在很难找到明显的罪魁祸首，但有一些较小的罪魁祸首我可以做点什么，时间下降到 13 秒。

现在我好像碰壁了。样本准确地告诉我它在做什么，但我似乎找不到任何可以改进的地方。然后我反思了程序的基本设计，它的事务驱动结构，并询问它所做的所有列表搜索是否实际上是由问题的要求所要求的。

然后我遇到了重新设计，其中程序代码实际上是从一组较小的源中生成的（通过预处理器宏），并且程序不会不断地找出程序员知道是相当可预测的东西。换句话说，不要“解释”要做的事情的顺序，“编译”它。

*   重新设计完成，源代码缩小了 4 倍，时间减少到 10 秒。

现在，因为它变得如此之快，很难采样，所以我给它 10 倍的工作量，但以下时间是基于原始工作量。

*   更多诊断表明它正在花费时间进行队列管理。内联这些将时间减少到 7 秒。

*   现在，我一直在做的诊断打印是一个很大的耗时。冲洗 - 4 秒。

*   现在最大的耗时是调用*malloc*和*free*。回收对象 - 2.6 秒。

*   继续采样，我仍然发现并非绝对必要的操作——1.1 秒。

总加速因子：43.6

现在没有两个程序是一样的，但在非玩具软件中，我总是看到这样的进展。首先你得到容易的东西，然后是更难的东西，直到你达到收益递减的地步。然后你获得的洞察力很可能会导致重新设计，开始新一轮的加速，直到你再次达到收益递减。现在这可能是想知道`++i`或`i++`或`for(;;)`或`while(1)`更快的意义所在：我在 Stack Overflow 上经常看到的这类问题。

PS可能想知道为什么我没有使用分析器。答案是这些“问题”中的几乎每一个都是一个函数调用站点，堆栈样本可以精确定位。即使在今天，分析器也几乎没有意识到语句和调用指令比整个函数更重要，更容易修复。

我实际上构建了一个分析器来执行此操作，但是为了真正了解代码正在执行的操作，没有什么可以替代您的手指正确的操作。样本数量少不是问题，因为发现的问题都不是小到容易漏掉的问题。

添加：jerryjvl 要求提供一些示例。这是第一个问题。它由少量单独的代码行组成，总共占用了一半以上的时间：

```
 /* IF ALL TASKS DONE, SEND ITC_ACKOP, AND DELETE OP */
if (ptop->current_task >= ILST_LENGTH(ptop->tasklist){
. . .
/* FOR EACH OPERATION REQUEST */
for ( ptop = ILST_FIRST(oplist); ptop != NULL; ptop = ILST_NEXT(oplist, ptop)){
. . .
/* GET CURRENT TASK */
ptask = ILST_NTH(ptop->tasklist, ptop->current_task) 
```

这些使用列表集群 ILST（类似于列表类）。它们以通常的方式实现，“信息隐藏”意味着该类的用户不必关心它们是如何实现的。编写这些行时（大约 800 行代码）并没有考虑到这些可能是“瓶颈”（我讨厌这个词）。它们只是推荐的做事方式。*事后看来*很容易说这些应该避免，但根据我的经验，*所有*性能问题都是这样的。一般来说，最好尽量避免产生性能问题。即使“应该避免”（事后看来），找到并修复已创建的那些甚至更好。

这是第二个问题，分两行：

```
 /* ADD TASK TO TASK LIST */
ILST_APPEND(ptop->tasklist, ptask)
. . .
/* ADD TRANSACTION TO TRANSACTION QUEUE */
ILST_APPEND(trnque, ptrn) 
```

这些是通过将项目附加到其末尾来构建列表。（解决方法是收集数组中的项目，并一次构建所有列表。）有趣的是，这些语句仅花费（即在调用堆栈上）原始时间的 3/48，因此它们不在其实一*开始*就有大问题。然而，在消除第一个问题后，它们花费了 3/20 的时间，因此现在是一条“更大的鱼”。一般来说，事情就是这样。

我可能会补充一点，这个项目是从我帮助过的一个真实项目中提炼出来的。在那个项目中，性能问题更加严重（加速也是如此），例如在内部循环中调用数据库访问例程以查看任务是否完成。

添加的参考：原始和重新设计的源代码可以在[www.ddj.com](http://www.drdobbs.com/parallel/performance-tuning-slugging-it-out/184409106)中找到，对于 1993，在文件 9311.zip、文件 slug.asc 和 slug.zip 中。

编辑 2011 年 11 月 26 日：现在有一个[SourceForge 项目](https://sourceforge.net/projects/randompausedemo/)，其中包含 Visual C++ 中的源代码以及如何调整它的详细描述。它只经历了上述场景的前半部分，并没有遵循完全相同的顺序，但仍然获得了 2-3 个数量级的加速。

* * *

## 回答 #2

> 赞同：192
> 
> 时间：2009-05-29T14:38:08.597

建议：

*   **预先计算而不是重新计算**：任何包含输入范围相对有限的计算的循环或重复调用，请考虑对有效范围内的所有值进行包含该计算结果的查找（数组或字典）输入。然后在算法内部使用一个简单的查找来代替。
    *缺点*：如果实际使用的预先计算的值很少，这可能会使事情变得更糟，查找也可能会占用大量内存。
*   **不要使用库方法**：大多数库需要编写为在广泛的场景下正确运行，并对参数执行空值检查等。通过重新实现一个方法，您可能能够剥离很多逻辑不适用于您使用它的确切情况。
    *缺点*：编写额外的代码意味着有更多的漏洞出现。
*   **一定要使用库方法**：与我自己矛盾的是，语言库是由比你或我聪明得多的人编写的；他们做得更好更快。不要自己实现它，除非你真的可以让它更快（即：总是测量！）
*   **作弊**：在某些情况下，尽管可能存在针对您的问题的精确计算，但您可能不需要“精确”，有时近似值可能“足够好”并且在交易中要快得多。问问自己，答案是否超出 1% 真的很重要吗？5%？甚至10%？
    *缺点*：嗯……答案并不准确。

* * *

## 回答 #3

> 赞同：170
> 
> 时间：2009-05-29T22:01:10.947

当您无法再提高性能时 - 看看您是否可以提高**感知**性能。

您可能无法使您的 fooCalc 算法更快，但通常有一些方法可以使您的应用程序看起来对用户响应更快。

几个例子：

*   预测用户将要请求什么并在此之前开始工作
*   在结果进入时显示结果，而不是在最后一次全部显示
*   *准确*的进度表

这些不会使您的程序更快，但可能会使您的用户对您的速度感到满意。

* * *

## 回答 #4

> 赞同：141
> 
> 时间：2009-05-29T22:19:44.390

我一生的大部分时间都在这个地方度过。大体上是运行你的分析器并让它记录下来：

*   **缓存未命中**。数据缓存是大多数程序中的第一大停顿源。通过重组有问题的数据结构以获得更好的局部性来提高缓存命中率；压缩结构和数字类型以消除浪费的字节（因此浪费的缓存提取）；尽可能预取数据以减少停顿。
*   **加载命中商店**。编译器关于指针别名的假设，以及数据通过内存在断开的寄存器集之间移动的情况，可能会导致某种病态行为，导致整个 CPU 流水线在加载操作时清除。找到浮点数、向量和整数相互转换的地方并消除它们。`__restrict`自由地使用来向编译器承诺别名。
*   **微编码操作**。大多数处理器都有一些无法流水线化的操作，而是运行存储在 ROM 中的微小子程序。PowerPC 上的示例是整数乘法、除法和按变量移位。问题是整个管道在执行此操作时停止了。尝试消除对这些操作的使用，或者至少将它们分解为它们的组成流水线操作，这样您就可以在程序的其余部分正在执行的任何操作中获得超标量调度的好处。
*   **分行误判**。这些也清空了管道。找出 CPU 在分支后花费大量时间重新填充管道的情况，并使用分支提示（如果可用）使其更频繁地正确预测。或者更好的是，尽可能用条件移动替换分支，*尤其是*在浮点运算之后，因为它们的管道通常更深，并且在 fcmp 之后读取条件标志可能会导致停顿。
*   **顺序浮点运算**。制作这些 SIMD。

还有一件事我喜欢做：

*   **将您的编译器设置为输出汇编列表**，并查看它为代码中的热点函数发出的内容。所有那些“一个好的编译器应该能够自动为你做的”聪明的优化？您的实际编译器可能不会这样做。我见过 GCC 发出真正的 WTF 代码。

* * *

## 回答 #5

> 赞同：79
> 
> 时间：2009-05-29T14:32:26.597

扔更多的硬件！

* * *

## 回答 #6

> 赞同：59
> 
> 时间：2009-06-10T14:36:18.617

更多建议：

*   **避免 I/O**：任何 I/O（磁盘、网络、端口等）总是比任何执行计算的代码慢得多，所以摆脱任何你不需要的 I/O。

*   **预先移动 I/O**：预先加载计算所需的所有数据，这样您就不会在关键算法的核心内重复 I/O 等待（并且可能因此重复磁盘查找，一次加载所有数据时可能会避免查找）。

*   **延迟 I/O**：在计算结束之前不要写出结果，将它们存储在数据结构中，然后在完成艰苦的工作时将其一次性转储。

*   **线程 I/O**：对于那些足够大胆的人，通过将加载移动到并行线程中，将“预先 I/O”或“延迟 I/O”与实际计算结合起来，这样当您加载更多数据时，您可以工作在对已有数据进行计算时，或者在计算下一批数据时，您可以同时写出上一批数据的结果。

* * *

## 回答 #7

> 赞同：48
> 
> 时间：2009-05-29T21:41:20.300

由于许多性能问题都涉及数据库问题，因此我将提供一些在调整查询和存储过程时需要注意的具体事项。

在大多数数据库中避免使用游标。也避免循环。大多数时候，数据访问应该是基于集合的，而不是逐个记录处理的。这包括在您想要一次插入 1,000,000 条记录时不重用单个记录存储过程。

永远不要使用 select *，只返回你真正需要的字段。如果存在任何连接，则尤其如此，因为连接字段将重复，从而导致服务器和网络上的不必要负载。

避免使用相关子查询。使用连接（包括在可能的情况下连接到派生表）（我知道这适用于 Microsoft SQL Server，但在使用不同的后端时测试建议）。

索引，索引，索引。如果适用于您的数据库，则更新这些统计信息。

使查询[sargable](http://en.wikipedia.org/wiki/Sargable)。意思是避免导致无法使用索引的事情，例如在 like 子句的第一个字符或连接中的函数或 where 语句的左侧使用通配符。

使用正确的数据类型。在日期字段上进行日期数学运算比必须尝试将字符串数据类型转换为日期数据类型，然后进行计算要快。

切勿将任何类型的循环放入触发器中！

大多数数据库都有一种检查查询执行方式的方法。在 Microsoft SQL Server 中，这称为执行计划。先检查那些，看看有问题的地方在哪里。

在确定需要优化的内容时，请考虑查询运行的频率以及运行时间。有时，您可以通过对每天运行数百万次的查询进行细微调整来获得比从每月仅运行一次的 long_running 查询中消除时间所获得的更多性能。

使用某种分析器工具来找出真正发送到数据库和从数据库发送的内容。我记得过去有一次我们无法弄清楚为什么当存储过程很快时页面加载如此缓慢，并且通过分析发现网页多次而不是一次请求查询。

探查器还将帮助您找到谁在阻止谁。由于其他查询的锁定，一些在单独运行时快速执行的查询可能会变得非常慢。

* * *

## 回答 #8

> 赞同：30
> 
> 时间：2009-06-19T16:51:08.833

今天最重要的一个限制因素是**有限的内存带宽**。多核只会让情况变得更糟，因为带宽是在内核之间共享的。此外，用于实现缓存的有限芯片区域也被分配给内核和线程，使这个问题更加恶化。最后，保持不同缓存一致所需的芯片间信号也会随着内核数量的增加而增加。这也增加了惩罚。

这些是您需要管理的效果。有时通过微观管理您的代码，但有时通过仔细考虑和重构。

很多评论已经提到缓存友好的代码。这至少有两种不同的味道：

*   避免内存获取延迟。
*   降低内存总线压力（带宽）。

第一个问题与使您的数据访问模式更加规则有关，从而使硬件预取器能够有效地工作。避免动态内存分配将数据对象分散在内存中。使用线性容器而不是链表、散列和树。

第二个问题与改进数据重用有关。更改您的算法以处理适合可用缓存的数据子集，并在该数据仍在缓存中时尽可能多地重用该数据。

更紧密地打包数据并确保在热循环中使用缓存行中的所有数据，将有助于避免这些其他影响，并允许在缓存中放置更多*有用*的数据。

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2009-05-29T14:42:02.660

*   你在什么硬件上运行？您可以使用特定于平台的优化（如矢量化）吗？
*   你能得到一个更好的编译器吗？例如从 GCC 切换到 Intel？
*   你能让你的算法并行运行吗？
*   您可以通过重新组织数据来减少缓存未命中吗？
*   你可以禁用断言吗？
*   针对您的编译器和平台进行微优化。以“在 if/else 中，将最常见的语句放在首位”的风格

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2011-01-26T04:35:20.537

虽然我喜欢 Mike Dunlavey 的回答，但实际上它确实是一个很好的答案，有支持的例子，我认为它可以非常简单地表达出来：

**首先找出最耗时的事情，并了解原因。**

时间猪的识别过程可以帮助您了解必须在哪里改进您的算法。对于已经应该完全优化的问题，这是我能找到的唯一包罗万象的与语言无关的答案。还假设您想在追求速度的过程中独立于架构。

因此，虽然算法可能会被优化，但它的实现可能不会。标识可以让您知道哪个部分是哪个：算法或实现。因此，无论哪个花费最多的时间都是您审查的主要候选人。但既然你说你想挤出最后几个 %，你可能还想检查较小的部分，也就是你一开始没有仔细检查的部分。

最后，对实现相同解决方案或潜在不同算法的不同方法的性能数据进行一些试验和错误，可以带来有助于识别时间浪费者和节省时间的见解。

HPH，请动。

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2009-05-29T21:58:01.030

您可能应该考虑“谷歌视角”，即确定您的应用程序如何在很大程度上实现并行化和并发，这也不可避免地意味着在某些时候考虑将您的应用程序分布在不同的机器和网络上，以便它可以理想地几乎线性扩展用你扔给它的硬件。

另一方面，谷歌也以投入大量人力和资源来解决他们正在使用的项目、工具和基础设施中的一些问题而闻名，例如通过拥有专门的工程师团队[对 gcc 进行整个程序优化](http://gcc.gnu.org/wiki/LinkTimeOptimization)破解 gcc 内部结构，以便为 Google 的典型用例场景做好准备。

同样，分析应用程序不再意味着简单地分析程序代码，还包括其所有周围的系统和基础设施（想想网络、交换机、服务器、RAID 阵列），以便从系统的角度识别冗余和优化潜力。

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2009-05-29T15:05:04.830

*   内联例程（消除调用/返回和参数推送）
*   尝试使用表格查找消除测试/切换（如果它们更快）
*   将循环（Duff 的设备）展开到刚好适合 CPU 缓存的位置
*   本地化内存访问，以免破坏您的缓存
*   如果优化器尚未执行本地化相关计算
*   如果优化器尚未这样做，则消除循环不变量

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2009-05-30T15:39:32.567

*   当您使用高效算法时，问题是您需要更多**速度或内存**。使用缓存在内存中“支付”以提高速度或使用计算来减少内存占用。
*   如果可能（并且更具成本效益）**将硬件抛出问题**- 更快的 CPU、更多内存或 HD 可以更快地解决问题，然后尝试对其进行编码。
*   **尽可能**使用并行化——在多个线程上运行部分代码。****
***   **为工作使用正确的工具**。一些编程语言创建更高效​​的代码，使用托管代码（即 Java/.NET）加速开发，但本机编程语言创建运行速度更快的代码。*   **微优化**。只有在适用的情况下，您才能使用优化的汇编来加速小段代码，在正确的地方使用 SSE/向量优化可以大大提高性能。**

 *** * *

## 回答 #14

> 赞同：12
> 
> 时间：2010-03-22T03:21:21.917

**分而治之**

如果正在处理的数据集太大，循环遍历它的块。如果你的代码正确，实现应该很容易。如果你有一个单一的程序，现在你知道得更好。

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2011-07-29T03:28:14.540

首先，正如之前的几个答案中提到的，了解什么会影响您的性能 - 是内存还是处理器、网络、数据库或其他东西。取决于那个...

*   ...如果是记忆 - 查找很久以前由 Knuth 写的一本书，这是“计算机编程的艺术”系列之一。很可能它是关于排序和搜索的——如果我的记忆有误，那么你必须找出他在哪里谈论如何处理缓慢的磁带数据存储。分别将他的*内存/磁带*对转换为您的缓存/主内存对（或 L1/L2 缓存对）。研究他描述的所有技巧——如果你没有找到解决问题的方法，那就聘请专业的计算机科学家进行专业研究。如果您的内存问题是 FFT 偶然出现的（在执行 radix-2 蝴蝶时，位反转索引处的缓存未命中），那么不要聘请科学家 - 相反，手动优化传递，直到您 要么获胜，要么陷入死胡同。你提到*挤到最后几个百分点，*对吗？如果确实*很少*，您很可能会赢。

*   ...如果是处理器 - 切换到汇编语言。研究处理器规范 -*什么需要滴答声*、VLIW、SIMD。函数调用很可能是可替换的吃蜱虫。学习循环转换 - 管道、展开。乘法和除法可以用位移替换/插值（乘以小整数可能可以用加法替换）。尝试使用较短数据的技巧 - 如果幸运的话，一条 64 位的指令可能会被替换为 32 上的两条或什至 16 上的 4 条或 8 位上的 8 条指令。*再*试试*数据 - 例如，您的浮点计算可能会比特定处理器的两倍慢。如果你有三角函数的东西，用预先计算好的表格来解决它；还要记住，如果精度损失在允许的范围内，则可以用该值替换小值的正弦。*

**   ...如果是网络 - 考虑压缩您通过它传递的数据。用二进制替换 XML 传输。研究协议。如果您能以某种方式处理数据丢失，请尝试使用 UDP 而不是 TCP。

    *   ...如果是数据库，那么，去任何数据库论坛寻求建议。内存数据网格，优化查询计划等等等。* 

 *HTH :)

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2009-09-13T16:07:25.403

**缓存！**使几乎任何事情变得更快的一种廉价方法（在程序员的努力中）是将缓存抽象层添加到程序的任何数据移动区域。无论是 I/O 还是只是传递/创建对象或结构。通常很容易将缓存添加到工厂类和读取器/写入器。

有时缓存不会给您带来太多好处，但这是一种简单的方法，只需在所有地方添加缓存，然后在没有帮助的地方禁用它。我经常发现这可以获得巨大的性能，而无需对代码进行微观分析。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2009-05-29T22:00:52.227

我认为这已经以不同的方式说了。但是当您处理处理器密集型算法时，您应该以牺牲其他一切为代价来简化最内部循环中的所有内容。

这对某些人来说似乎很明显，但无论我使用哪种语言，我都会努力关注这一点。例如，如果您正在处理嵌套循环，并且您发现有机会将一些代码降低一个级别，那么在某些情况下您可以大大加快您的代码速度。作为另一个例子，有一些小事情需要考虑，比如尽可能使用整数而不是浮点变量，尽可能使用乘法而不是除法。同样，这些是您最内部循环应该考虑的事情。

有时，您可能会发现对内部循环内的整数执行数学运算，然后将其缩小为以后可以使用的浮点变量的好处。这是牺牲一个部分的速度来提高另一个部分的速度的一个例子，但在某些情况下，回报可能是值得的。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2012-04-17T04:03:18.303

我花了一些时间优化在低带宽和长延迟网络（例如卫星、远程、离岸）上运行的客户端/服务器业务系统，并且能够通过相当可重复的过程实现一些显着的性能改进。

*   **措施**：首先了解网络的底层容量和拓扑。与业务中的相关网络人员交谈，并利用 ping 和 traceroute 等基本工具在典型运营期间建立（至少）每个客户端位置的网络延迟。接下来，对显示问题症状的特定最终用户功能进行准确的时间测量。记录所有这些测量值，以及它们的位置、日期和时间。考虑在您的客户端应用程序中构建最终用户“网络性能测试”功能，让您的高级用户参与改进过程；当您与因性能不佳的系统而沮丧的用户打交道时，像这样授权他们可能会产生*巨大的心理影响。*

*   **分析**：使用任何和所有可用的日志记录方法来准确确定在执行受影响的操作期间正在传输和接收哪些数据。理想情况下，您的应用程序可以捕获客户端和服务器传输和接收的数据。如果这些也包括时间戳，那就更好了。如果没有足够的日志记录（例如封闭系统，或无法将修改部署到生产环境中），请使用网络嗅探器并确保您真正了解网络级别的情况。

*   **缓存**：寻找重复传输静态或不经常更改的数据的情况，并考虑适当的缓存策略。典型示例包括“选择列表”值或其他“参考实体”，它们在某些业务应用程序中可能非常大。在许多情况下，用户可以接受他们必须重新启动或刷新应用程序以更新不经常更新的数据，特别是如果它可以显着缩短显示常用用户界面元素的时间。确保您了解已经部署的缓存元素的真实行为 - 许多常见的缓存方法（例如 HTTP ETag）仍然需要网络往返以确保一致性，并且在网络延迟很昂贵的情况下，您可以完全避免它不同的缓存方法。

*   **Parallelise**：寻找逻辑上不需要严格按顺序发出的顺序事务，并重新设计系统以并行发出它们。我处理了一个端到端请求的固有网络延迟约为 2 秒的情况，这对于单个事务来说不是问题，但是在用户重新获得对客户端应用程序的控制之前需要 6 个连续 2 秒的往返行程，这成了一个巨大的挫败感。发现这些事务实际上是独立的，允许它们并行执行，从而将最终用户的延迟减少到非常接近单次往返的成本。

*   **组合**：如果顺序请求*必须*按顺序执行，请寻找机会将它们组合成一个更全面的请求。典型示例包括创建新实体，然后请求将这些实体与其他现有实体相关联。

*   **压缩**：寻找机会来利用有效负载的压缩，或者通过用二进制形式替换文本形式，或者使用实际的压缩技术。许多现代（即十年内）技术堆栈几乎透明地支持这一点，因此请确保已对其进行配置。我经常对压缩的显着影响感到惊讶，似乎很明显，问题基本上是延迟而不是带宽，事后发现它允许事务适合单个数据包或以其他方式避免数据包丢失，因此有一个特大对性能的影响。

*   **重复**：回到开始并重新测量您的操作（在相同的位置和时间），改进到位，记录并报告您的结果。与所有优化一样，一些问题可能已经解决，暴露了现在占主导地位的其他问题。

在上面的步骤中，我专注于与应用程序相关的优化过程，但当然您必须确保以最有效的方式配置底层网络本身以支持您的应用程序。让业务中的网络专家参与进来，并确定他们是否能够应用容量改进、QoS、网络压缩或其他技术来解决问题。通常，他们不会理解您的应用程序的需求，因此重要的是您准备好（在分析步骤之后）与他们讨论它，并为您将要求他们承担的任何成本制定业务案例. 我遇到过错误的网络配置导致应用程序数据通过慢速卫星链路而不是陆路链路传输的情况，仅仅因为它使用的 TCP 端口并不被网络专家“熟知”；显然，纠正这样的问题会对性能产生巨大影响，根本不需要软件代码或配置更改。

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2009-05-29T14:32:36.877

很难对这个问题给出一个通用的答案。这实际上取决于您的问题域和技术实现。一种语言中立的通用技术：识别无法消除的代码热点，并手动优化汇编代码。

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2009-08-10T23:59:47.880

最后几个 % 是一个非常依赖 CPU 和应用程序的东西....

*   缓存架构不同，一些芯片具有可以直接映射的片上 RAM，ARM（有时）具有矢量单元，SH4 是有用的矩阵操作码。是否有[GPU](http://en.wikipedia.org/wiki/Graphics_processing_unit) - 也许着色器是要走的路。[TMS320](http://en.wikipedia.org/wiki/Texas_Instruments_TMS320)对循环内的分支非常敏感（因此，如果可能，将循环分开并将条件移到外面）。

名单还在继续......但这些事情真的是最后的手段......

为 x86 构建，并针对代码运行[Valgrind](http://en.wikipedia.org/wiki/Valgrind) /Cachegrind 以进行正确的性能分析。或者德州仪器的 [CCStudio](http://en.wikipedia.org/wiki/Code_Composer_Studio)有一个很好的分析器。然后你就真的知道该把重点放在哪里了...

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2011-01-29T02:23:07.820

`Did you know that a CAT6 cable is capable of 10x better shielding off extrenal inteferences than a default Cat5e UTP cable?`

对于任何非离线项目，虽然拥有最好的软件和最好的硬件，但如果你的吞吐量很弱，那么那条细线会挤压数据并给你带来延迟，尽管是以毫秒为单位......但如果你在谈论最后一滴，对于发送或接收的任何包裹，这是 24/7 获得的一些下降。

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2012-08-30T16:01:33.850

不像以前的答案那么深入或复杂，但这里有：（这些都是初学者/中级水平）

*   明显：干
*   向后运行循环，因此您始终与 0 而不是变量进行比较
*   尽可能使用位运算符
*   将重复的代码分解为模块/函数
*   缓存对象
*   局部变量有轻微的性能优势
*   尽可能限制字符串操作

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2009-05-29T15:10:12.323

没法说。这取决于代码的外观。如果我们可以假设代码已经存在，那么我们可以简单地查看它并从中找出如何优化它。

更好的缓存局部性，循环展开，尝试消除长依赖链，以获得更好的指令级并行性。如果可能，首选条件移动而不是分支。尽可能利用 SIMD 指令。

了解您的代码在做什么，并了解它运行的硬件。然后，确定您需要做什么来提高代码的性能变得相当简单。这真的是我能想到的唯一真正普遍的建议。

好吧，那个，以及“在 SO 上显示代码并针对该特定代码寻求优化建议”。

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2009-05-29T15:21:43.207

如果可以选择更好的硬件，那么肯定会选择。除此以外

*   检查您使用的是最佳编译器和链接器选项。
*   如果不同库中的热点例程用于频繁调用者，请考虑将其移动或克隆到调用者模块。消除了一些调用开销并可能提高缓存命中率（参见 AIX 如何将 strcpy() 静态链接到单独链接的共享对象）。这当然也可以减少缓存命中，这就是为什么要采取一种措施。
*   看看是否有可能使用专用版本的热点例程。缺点是要维护的版本不止一个。
*   看汇编程序。如果您认为它可能会更好，请考虑编译器为什么没有解决这个问题，以及您可以如何帮助编译器。
*   考虑一下：你真的在使用最好的算法吗？它是您输入大小的最佳算法吗？

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2009-10-09T11:01:10.973

谷歌的方式是一个选项“缓存它..尽可能不要触摸磁盘”

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2011-07-20T13:15:33.817

以下是我使用的一些快速而肮脏的优化技术。我认为这是“第一次通过”优化。

**了解时间都花在**了哪些地方 准确了解什么是花费时间。是文件IO吗？是CPU时间吗？是网络吗？是数据库吗？如果这不是瓶颈，那么优化 IO 是没有用的。

**了解您的环境** 了解在哪里进行优化通常取决于开发环境。例如，在 VB6 中，按引用传递比按值传递要慢，但在 C 和 C++ 中，按引用传递要快得多。在 C 语言中，如果返回码指示失败，尝试做一些不同的事情是合理的，而在 Dot Net 中，捕获异常比在尝试之前检查有效条件要慢得多。

**索引**在经常查询的数据库字段上建立索引。您几乎总是可以用空间换取速度。

**避免查找** 在要优化的循环内部，我避免进行任何查找。找到循环外的偏移量和/或索引，并重用里面的数据。

**尽量减少 IO**尝试以减少读取或写入次数的方式进行设计，尤其是通过网络连接

**减少**抽象 代码必须通过的抽象层越多，它就越慢。在关键循环内，减少抽象（例如，揭示避免额外代码的低级方法）

**为具有用户界面的项目生成线程**，生成一个新线程来执行较慢的任务，使应用程序*感觉*更灵敏，尽管不是。

**预处理**您通常可以用空间换取速度。如果有计算或其他密集操作，请查看是否可以在进入关键循环之前预先计算一些信息。

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2013-06-11T13:48:35.720

如果你有很多高度并行的浮点数学——尤其是单精度——尝试使用 OpenCL 或（对于 NVidia 芯片）CUDA 将其卸载到图形处理器（如果存在）。GPU 在其着色器中具有巨大的浮点计算能力，这比 CPU 的计算能力强得多。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2013-10-05T07:22:42.260

添加此答案，因为我没有看到它包含在所有其他答案中。

### 最小化类型和符号之间的隐式转换：

这至少适用于 C/C++，即使您已经*认为*自己没有转换 - 有时最好测试在需要性能的函数周围添加编译器警告，特别是注意循环内的转换。

GCC spesific：您可以通过在代码周围添加一些详细的编译指示来测试这一点，

```
#ifdef __GNUC__
#  pragma GCC diagnostic push
#  pragma GCC diagnostic error "-Wsign-conversion"
#  pragma GCC diagnostic error "-Wdouble-promotion"
#  pragma GCC diagnostic error "-Wsign-compare"
#  pragma GCC diagnostic error "-Wconversion"
#endif

/* your code */

#ifdef __GNUC__
#  pragma GCC diagnostic pop
#endif 
```

我见过这样的案例，您可以通过减少此类警告引发的转化来获得几个百分比的加速。

在某些情况下，我有一个带有严格警告的标题，我会保留这些警告以防止意外转换，但这是一个权衡，因为您最终可能会添加大量强制转换来安静的有意转换，这可能只会使代码更加混乱收益。

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2009-05-29T22:20:29.783

有时更改数据的布局会有所帮助。在 C 语言中，您可以从一个或多个数组结构切换到数组结构，反之亦然。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2009-09-13T16:12:03.377

**调整操作系统和框架。**

这听起来可能有点矫枉过正，但可以这样想：操作系统和框架旨在做很多事情。您的应用程序只做非常具体的事情。如果您可以让操作系统完全满足您的应用程序的需求，并让您的应用程序了解框架（php、.net、java）的工作原理，那么您可以更好地利用硬件。

例如，Facebook 改变了 Linux 中的一些[内核级别](http://www.facebook.com/video/video.php?v=631826881803)的东西，改变了 memcached 的工作方式（例如，他们编写了一个 memcached 代理，并[使用 udp 而不是 tcp](http://www.facebook.com/note.php?note_id=39391378919)）。

另一个例子是 Window2008。Win2K8 有一个版本，您可以只安装运行 X 应用程序（例如 Web 应用程序、服务器应用程序）所需的基本操作系统。这减少了操作系统在运行进程上的大部分开销，并为您提供更好的性能。

当然，您应该始终投入更多硬件作为第一步......

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2011-03-06T05:21:33.893

通过引用而不是按值传递

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2011-06-25T16:03:01.403

**减少可变大小（在嵌入式系统中）**

如果您的变量大小大于特定架构上的字大小，则它会对代码大小和速度产生重大影响。例如，如果您有一个 16 位系统，并且`long int`经常使用一个变量，后来意识到它永远不会超出范围 (−32.768 ... 32.767)，请考虑将其减少到`short int.`

根据我个人的经验，如果一个程序已经准备好或几乎准备好了，但我们意识到它占用了目标硬件程序内存的大约 110% 或 120%，则变量的快速标准化通常可以解决问题。

到了这个时候，优化算法或部分代码本身可能会变得徒劳无功：

*   重新组织整个结构，程序不再按预期工作，或者至少你引入了很多错误。
*   做一些聪明的技巧：通常你会花很多时间优化某些东西，但发现代码大小没有减少或只有很小的减少，因为编译器无论如何都会优化它。

许多人犯了一个错误，即让变量准确地存储他们使用变量的单位的数值：例如，他们的变量`time`存储准确的毫秒数，即使只有 50 毫秒的时间步长是相关的。也许如果您的变量每增加 1 表示 50 毫秒，您将能够适应小于或等于字长的变量。例如，在 8 位系统上，即使是两个 32 位变量的简单相加也会生成大量代码，尤其是在寄存器数量较少的情况下，而 8 位相加既小又快。

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2009-05-30T10:04:08.647

不可能有这样的笼统陈述，这取决于问题域。一些可能性：

由于您没有直接指定您的应用程序是 100% 计算：

*   搜索阻塞的调用（数据库、网络硬盘、显示更新），并隔离它们和/或将它们放入线程中。

如果您使用了一个数据库并且它恰好是 Microsoft SQL Server：

*   调查 nolock 和 rowlock 指令。（这个论坛有帖子。）

*如果*您的应用程序纯粹是计算，您可以查看我的这个关于旋转大图像的缓存优化的问题。速度的提升让我大吃一惊。

这是一个长镜头，但也许它提供了一个想法，特别是如果您的问题是在成像领域：[rotating-bitmaps-in-code](https://stackoverflow.com/questions/848025/rotating-bitmaps-in-code)

另一个是尽可能避免动态内存分配。一次分配多个结构，一次释放它们。

否则，请确定您最紧密的循环并在此处发布它们，无论是伪的还是非伪的，以及一些数据结构。

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2009-06-17T20:30:17.263

在带有模板的语言 (C++/D) 中，您可以尝试通过模板参数传播常量值。您甚至可以通过开关对一小组并非真正恒定的值执行此操作。

```
Foo(i, j); // i always in 0-4. 
```

变成

```
switch(i)
{
    case 0: Foo<0>(j); break;
    case 1: Foo<1>(j); break;
    case 2: Foo<2>(j); break;
    case 3: Foo<3>(j); break;
    case 4: Foo<4>(j); break;
} 
```

不利的一面是缓存压力，因此这只会在深度或长期运行的调用树中获得收益，其中值在持续时间内是恒定的。

# php - PHP/Cronjob 保存了搜索的可扩展性

> ID：926268
> 
> 赞同：1
> 
> 时间：2009-05-29T14:27:27.217
> 
> 标签：php, cron

当符合用户保存的搜索条件的房产上市时，我们的房地产网站会发送电子邮件通知。

我有一个在 cronjob 上运行的 PHP 脚本来处理搜索。

该系统现在拥有超过 40,000 名用户。我遇到了一个问题，我用尽了 PHP 内存大小。随着系统的增长，我可以继续增加 php.ini 中的内存大小，但希望找到一种更强大的方法来做到这一点。

有没有更可扩展的方法来实现这一点？我应该用更健壮的语言构建一些东西吗？也许是 Java 或 Python 中的线程应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T14:36:51.907

在保存的搜索表中使用一些标识符来按专用于它的计算机数量对**任务进行分区。**

**分而治**之，将搜索重构的部分分拆到许多机器上，每台机器都运行一些任务的分区。

每个脚本都可以做

```
SELECT * FROM saved_search_tbl WHERE ssid IN CALCRANGE(searchid, node_id) 
```

其中 INRANGE 是一些基于工作量和机器节点号的分区逻辑。当新的搜索出现时，您可以通过分配主要和次要计算节点来在机器之间对它们进行**负载平衡。**

一些想法，希望对你有帮助！

**祝你好运**

# php - 是否可以在构造函数中优雅地退出？

> ID：926269
> 
> 赞同：6
> 
> 时间：2009-05-29T14:27:38.620
> 
> 标签：php, constructor, return-value

是否可以优雅地退出 php 中的构造函数？大意是什么

```
class Foo { 

 function __construct()
 {

   $active = false;

   if(!$active)
   {
    return false;
   }

 }

} 
```

我正在尝试完成此操作，因为我想检查类中的任何方法是否应基于配置文件运行。我不想检查每个方法中的配置文件以查看这些方法是否应该运行。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T14:34:29.417

这取决于你所说的“优雅”是什么意思。如果你想让你的构造函数失败，你可以抛出一个异常，或者你可以使用工厂模式：

```
class FooFactory {
    function makeFoo() {
        return $someConstraint ? null : new Foo();
    }
} 
```

也许您可以详细说明您想要完成的工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T15:14:58.210

Make it blow up. There is no such thing as a graceful failure in a constructor. Perhaps in the calling code, but not in the constructor. Throw an exception and handle it appropriately.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T15:24:56.383

我能闻到代理模式的味道。您要实现的目标是不让*构造函数正常失败*，但*不允许基于某些 $active 标准在对象上调用方法*。

[这](http://www.fluffycat.com/PHP-Design-Patterns/Proxy/)可能会为您指明正确的方向。或者可能不是（=>> 我不太喜欢我链接的页面，但它是我能找到的最好的 PHP 页面）。也可以从其他来源读取 Proxy。基本上，您的 ProxyObject 将引用一个将*执行方法的**真实*对象。您的客户端代码将调用 ProxyObject 上的方法，就好像它是*真实的一样*，而 ProxyObject 将决定它是否处于活动状态，是否将消息传递给*真实的事物*或不返回任何内容或返回 null 或虚拟值。听起来不错？

 **** * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T19:17:08.627

如果构造函数做了这么多逻辑，那么它的设计就不是很好。将其留空，通过 setter 方法将配置传递给它，并让它在那里失败。

这不是面向对象编程：

```
$o = new myObject();
if (!is_object($o)) // then what??? 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T15:10:37.660

If your constructor fails, you should throw an exception, not return a false value. Unless you're using a language like C in which exceptions in the construction of the object means it can never be deconstructed.

The reason for this is because an exception forces the program to deal with it, and it give you the bad data. If you return a value, say -1 or whatever, the program can continue silently and ignore that until it causes a problem later down the road. Throwing an exception prevents these silent bugs from entering the code. You may know that it returns false if it failed to construct properly, but your co-worker may not and may happily try to use an object he thought was what he constructed to find out that it's really a boolean.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T15:03:49.997

I think N3rd suggested a very cool solution but here is another simpler method.

```
class Foo {

    private $active = TRUE;

    function __construct() {

        $this->check ( $active ); 

            //OR
            //if ($this->check ( $active )) { do something } 
    }

    function check($var) {
        if (! $var) {
            $this->active = FALSE;
            return FALSE;
        }
        return TRUE;

    }
} 
```

# wpf - WPF 绑定不通知更改

> ID：926280
> 
> 赞同：1
> 
> 时间：2009-05-29T14:29:34.637
> 
> 标签：wpf, data-binding, sorting, entityset

我有一个 WPF 排序/绑定问题。（免责声明：我对 WPF 和数据绑定非常陌生，所以如果我问一个非常愚蠢的问题，我深表歉意 :-)）

首先，我有一个`Contact`带有`EntitySet<Booking>`属性 Bookings 的 linqToSql 实体类。

如果我直接将此 Bookings 属性绑定到 a `ListView`，则应用程序似乎会正确通知 中所选项目的更改`ListView`，从而使带有`{Binding Path=Bookings/Comments}`正确更新的文本框。

```
// This code works, but Bookings is unsorted  
var binding = new Binding();
binding.Source = contact.Bookings;
bookings.SetBinding(ItemsControl.ItemsSourceProperty, binding); 
```

但是，由于我似乎无法找到对 EntitySet 进行排序的方法（请参阅[这篇文章](https://stackoverflow.com/questions/925567/how-do-you-sort-an-entitysett)），因此我尝试将其绑定到 Observable 集合，例如：

```
// This code doesn't notify of selected item changes in the ListView
var binding = new Binding();
binding.Source = new ObservableCollection<Booking>(contact.Bookings.OrderByDescending(b => b.TravelDate).ToList());
bookings.SetBinding(ItemsControl.ItemsSourceProperty, binding); 
```

但这似乎并没有正确通知评论文本框以使其更新。

如果有人有一个解决方案，可以在数据绑定之前或之后对数据进行排序，或者另一种可行的解决方案，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:53:52.640

您应该绑定到 a[`CollectionView`](http://msdn.microsoft.com/en-us/library/system.windows.data.collectionview.aspx)而不是集合本身。这将允许您指定所需的任何排序标准。例子：

```
var collectionView = new ListCollectionView(contact.Bookings);
collectionView.SortDescriptions.Add(new SortDescription("TravelDate", ListSortDirection.Ascending));
var binding = new Binding();
binding.Source = collectionView;
bookings.SetBinding(ItemsControl.ItemsSourceProperty, binding); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-05T05:50:25.313

海尼斯，

对象是否`Booking`实现`INotifyPropertyChanged`通知`Comments`属性更改？

如果没有，您不能期望`TextBox`哪个绑定到属性会在更改`Comments`时自动更新`Comments`

在这种情况下使用`ObservableCollection`只会让您在`Booking`从集合中添加或删除对象时使用更改更新视图的好处

-拉杰什

# sql-server - 我的 SSIS 问题是否合理？

> ID：926282
> 
> 赞同：7
> 
> 时间：2009-05-29T14:29:54.807
> 
> 标签：sql-server, ssis

我只是短暂地使用过 SSIS，但我发现我的抱怨很多。以下是我目前的问题：

1.  为了让包存储密码，您需要对其进行加密。即使包是更大解决方案的一部分，您也需要随时提供密码才能打开任何加密包。为什么你不能用一个密码加密整个解决方案？我有一个包含 10 个加密包的解决方案。当我点击“构建”时，我必须输入 10 个密码。
2.  加密凭据很棒。将加密包部署到服务器，提供您的密码，成功测试，安排它，然后在安排期间让它失败，因为它无法解密自己 SUCKS。这似乎是随机的，我已经多次重新部署给定的包，然后它实际上能够在计划的作业期间成功解密包凭据。
3.  仅 Windows 身份验证？也许这是一个安全功能，但它让远程管理服务器变得非常痛苦。它基本上迫使我使用远程桌面。当我可以直接访问数据库引擎时，我无法访问 SSIS 真的很重要吗？？？
4.  DTS 支持。DTS 非常丑陋，但它很有效，而且非常简单。他们为什么不为 DTS 2000 包设计器提供 SSIS ？？？现在我需要去下载它并以管理员权限安装它。
5.  大写字母？？？我将一些数据复制到外部数据库，并且更新插入到该数据库是非常痛苦的。为什么不内置此功能？为什么我不能只说“这是关键列。如果存在则更新，如果不存在则创建”。

这些是有效的问题，还是我只是对产品不熟悉，知道如何以正确的方式做事？

其他人是否有同样的问题或其他问题？

是否有使用 SSIS 的简单替代方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-29T15:14:16.420

The following links from @SQLServerSleuth might shed some light on the situation - a back and forth re: SSIS in 2005\. Are you on SQL 2008, or still working with SQL 2005? This picture changed a bit in 2008.

*   [SSIS' 15 Faults](http://ayende.com/Blog/archive/2007/07/15/SSIS-15-Faults.aspx)
*   [SSIS: The backlash (1)](http://blogs.conchango.com/jamiethomson/archive/2007/07/27/SSIS_3A00_-The-backlash-continues.aspx)
*   [SSIS: The backlash (2)](http://ayende.com/Blog/archive/2007/07/27/SSIS-The-backlash.aspx)
*   [SSIS: A response from Microsoft to some growing criticism](http://blogs.conchango.com/jamiethomson/archive/2007/07/30/SSIS_3A00_-A-response-from-Microsoft-to-the-growing-criticism.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-29T14:58:26.247

在我的系统中，使用 C# 开发数据加载总体上更容易。负载是坚如磐石的，除非我们希望它们发生变化，否则它们不会改变，因此我们在完成开发后不会再花费任何时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T14:39:01.747

我们遇到了许多相同的问题，尤其是#5，所以我同意这些是有效的。总的来说，我发现使用 SSIS 是一件非常痛苦的事情。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-29T22:41:08.603

让我先说 SSIS 很烂。工作、管理和发展是一件痛苦的事。虽然有一些工具可以让事情变得更好，但这些功能应该从一开始就包括在内。我还要说，我还没有找到（并且不相信目前存在）比 SSIS 更好的可扩展高性能数据加载工具。

1,2：将包设置为“不保存敏感”，并在您使用的任何执行上下文中使用配置或“设置值”。

3：部分同意。通过 sql auth 浏览包存储会很好，但是绝对不允许执行包（在什么上下文下执行？）您始终可以通过作业执行。

4：除了与 SSIS 无关之外，DTS 已被弃用，并且在大多数方面，甚至比 SSIS 更不灵活且更难管理。

5：Upserts 确实比它们可能的更棘手，但如果做得好，它可以完美地工作：要么使用查找来确定你是否需要插入或更新，并相应地定义你的逻辑。

旁注：认真考虑设置一个包模板。如果做得好，您可以从一开始就减轻许多这些担忧。我可能需要在某个时候公开发布我的包模板。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-29T15:19:25.347

你真的需要对每个包裹进行加密吗？如果您不存储 ftp 或其他身份验证密码，则可以说不加密存储。配置文件也是一个好主意。我推荐 www.pragmaticworks.com/products/Business-Intelligence/BIxpress/BIExpress，因为它会为您创建所有配置文件，从您的包中记录废话并提供令人惊叹的图形报告，几乎没有成本明智...

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-29T14:57:05.987

查看[包配置文件](http://www.sql-server-performance.com/articles/dba/package_configuration_2005_p1.aspx)以了解一些安全问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-29T15:14:29.803

For 1, 2, I use package configurations.

For 5 you can use a slowly changing dimension task or the third-party table difference component. I personally prefer to load to a staging table and code the UPSERT in SQL.

I've been using SSIS fairly intesively on a DW project for the last 2 years and I find it to have a few quirks but it is far more powerful than DTS.

# architecture - 脱离共享数据库模式进行重构

> ID：926284
> 
> 赞同：6
> 
> 时间：2009-05-29T14:30:42.013
> 
> 标签：architecture

在工作中，我们有几个应用程序在一个集中的 SQL 服务器中使用数据库。每当一个应用程序需要处理来自另一个应用程序的数据时，它只是通过数据库查询或更新它。我相信这就是 Enterprise Integration Patterns book (Hohpe & Woolf) 中描述的“共享数据库”模式。

这些跨数据库依赖给我们带来了很多很多的麻烦。目前最大的问题是我们在 SQL 服务器上遇到了性能问题，并且由于跨数据库依赖关系而无法横向扩展。我认为我们应该做的是从共享数据库模式转向 EIP 书中描述的消息传递系统。每个应用程序都将负责它自己的所有数据，而其他想要访问该数据的应用程序将通过服务（在消息传递总线上？）获得它。

*   我们从哪里开始重构消息传递模式？
*   我们是否首先重构其中一个应用程序来管理它自己的应用程序数据库？
*   那么目前通过数据库与该应用程序集成的其他应用程序呢？
*   这是解耦我们的数据库依赖关系的最佳方式还是我们应该从其他地方开始？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T14:37:31.220

我建议进行 3 阶段过渡。

1.  为您的每个应用程序添加一个消息传递层。
2.  更改所有跨应用程序数据访问以使用新创建的消息传递层。
3.  根据需要扩展（现在独立的）数据库。

另外，假设您有 3 个应用程序；A、B 和 C。

您还可以将其视为 3 个单独的转换：

*   应用 A

    *   将消息添加到 A
    *   在 B & C 中更改对 A 的调用
*   应用 B

    *   将消息添加到 B
    *   在 A 和 C 中更改对 B 的调用
*   应用 C

    *   将消息添加到 C
    *   在 A 和 B 中更改对 C 的调用

此时过程中的结果与第 2 阶段结束时的结果相同，可以继续第 3 阶段。区别仅仅在于专注于一种重构或专注于应用程序是否更有效率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T14:44:41.267

消息传递当然可以成为更优雅的方式之一。但是，它也需要一些工作，并且必须随着每个数据库的更改而随着时间的推移而更改。我们采用了“更简单”的方法，让每个应用程序都知道如何登录到另一个数据库，然后从那里查询每个数据库。我们发现大多数跨数据库查询都很轻巧，因此不会在第二个应用程序中构成大量代码库。选择查询有一些重复，但它的工作量比消息传递系统少。

这完全取决于您推送和拉取数据的程度。如果它很重要，那么消息传递是最好的方法。如果它是最小的，那么也许一个简单的新连接到另一个数据库是一种方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T04:03:52.920

我还会考虑应用程序如何使用数据库。通常，数据库（设计和实现）应属于以下两个不同类别之一：事务性 (OLTP) 或报告 (OLAP)。

一个设计良好（和实现）的事务数据库应该在典型的业务线应用场景中提供出色的性能；同样，一个设计良好（和实施）的报告数据库在查询大量复杂数据时应该提供出色的性能。

另一个重要的区别是“实时”和“近实时”之间的区别。

让我们假设您的各种应用程序需要同时执行事务（实时）操作和一些关于当前/旧数据的报告；您将需要两个数据存储：一个仅用于提高运行速度以支持应用程序的“实时”操作的事务性数据存储，另一个包含纯粹为报告而构建的“历史”数据。

然后，诀窍是弄清楚您需要在事务数据存储中保留多少数据，以及何时/如何将其移动到报告数据存储中。

# qt - Qt 与 GLee 冲突

> ID：926299
> 
> 赞同：5
> 
> 时间：2009-05-29T14:34:43.847
> 
> 标签：qt, opengl

我正在为基于 Qt 3（办公室政治）的游戏添加 OpenGL 支持。基础（QGLWidget 等）工作正常。

为了获得 OpenGL 扩展，我随意选择了 GLee（它是开箱即用的，而 GLew 没有）。

GLee.h 和 qgl.h 不能很好地结合在一起。AFAICT，每个都必须包含在另一个之前。

我从 GLee.h 中抽出预处理检查 [确保首先包含它]，在包含 OpenGL 头文件之前插入它使用的预处理指令，然后首先包含 qgl.h。在 linux 上，它归结为：

```
 #define __glext_h_  /* prevent glext.h from being included  */
    #define __glxext_h_ /* prevent glxext.h from being included */
    #define GLX_GLXEXT_PROTOTYPES
#include <qgl.h>
#include "GLee.h" // my hacked version 
```

这建立了（不知道我的代码是否会真正运行......这个问题是先发制人的[即我在拖延]），但它似乎是一个可怕的组合。谷歌搜索出现了很多人问这个基本问题（尽管他们中的大多数人都没有费心找出虚假的编译器错误，所以他们可以看到根本问题），但我还没有看到任何实际的答案。

有没有更好（更优雅、更便携、更健壮等）的方法来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T14:43:21.333

这仍然没有我想要的那么干净，但它至少可以构建和运行，而不需要破解 GLee.h。

在其他所有内容之后，#include qobject.h、GLee.h 和 qgl.h（按此顺序）。

所以，头文件可能看起来像

```
...blah...
...other #includes

#include <qobject.h>
#include "GLee.h"
#include <qgl.h>

class MyGlWidget : public QGLWidget
{
...
} 
```

然后源文件将最后#include 该文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-24T09:23:58.263

另一个解决方案（非常难看，仍然，但似乎所有解决方案都是除了使用 glew 之外）：

```
#include <GL/GLee.h>
#include <GL/glu.h>

#undef Status
#undef Bool
#undef CursorShape
#undef Unsorted
#undef None
#undef KeyPress
#undef KeyRelease
#undef FocusIn
#undef FocusOut
#undef FontChange
#undef GrayScale
#undef Expose
#undef Complex

...

#include <qgl.h> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T21:53:24.860

我怀疑您的补丁不起作用，因为它会阻止包含必要的标头。这可能会导致各种奇怪的问题。

（**编辑：**我不再怀疑，在阅读了您的一条评论之后 - 如果您从 GLee.h 中提取的只是检查和 #error 指令，那么事情应该可以工作......可能。）

据我所知，问题源于 Qt 试图定义与 X 预处理器宏冲突的枚举。具体来说，CursorShape 由 Xh 定义为 0，然后由 qnamespace.h 定义为枚举，导致相当无用的错误消息“错误：数字常量之前的预期标识符”

一种更简洁的方法来做你想做的事情是按这个顺序包含文件，并且这些宏未定义：

```
#include "qgl.h"
#undef __glext_h_
#undef __glxext_h_
#undef __gl_h_
#include "GLee.h" 
```

这不需要修补 GLee.h，但可能会产生意想不到的结果，这取决于为什么要首先包含 GLee.h。

更好的解决方案是将 GLee.h 和 qgl.h 包含在单独的编译单元中，但这可能是不可能的。

顺便说一句，解决这类问题的一个很好的调试策略是将 -E 传递给 gcc - 这将为您提供预处理的源代码，您可以检查它以找到有问题的行。在这种情况下，枚举名称被替换为 0 常量，这清楚地表明该名称是在其他地方定义的。对 /usr/include 下的枚举名称进行查找发现有问题的标头是 Xh 好吧，公平地说，这里有问题的部分是 Qt - 开发人员应该知道不要在跨平台框架中使用 X11 常量作为标识符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T08:58:56.377

简短的回答：使用 glew。它适用于 QT。

# c# - 您如何从 Web 应用程序访问内存中的服务？

> ID：926303
> 
> 赞同：0
> 
> 时间：2009-05-29T14:35:28.103
> 
> 标签：c#, .net, asp.net, windows-services

假设由于读/写系统的负载非常高，我需要设计一个内存服务。我想每 2 分钟转储一次对象的结果。我将如何从 Web 应用程序中访问内存中的对象/数据？

（我在想一个 Windows 服务将在后台运行处理内存服务等）

我想要最快的解决方案，我猜大多数人会说使用网络服务？我还有什么其他选择？我只是不明白如何挂钩 Windows 服务的对象等。

（请不要问我为什么要这样做，也许你是对的，这是一个坏主意，但我也很好奇这种架构是否可行。）

**更新**

我在看这个网站 swoopo.com，我认为在拍卖结束时会有很多点击，但是由于拍卖会不断将点击重置到数据库中，所以我在想他们是否在内存中这样做每 x 分钟转储到 db...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T14:46:38.517

您所描述的称为缓存，具有外观前端。

您编写一个外观，向其提交您的更改并获取您的数据集。当队列已满或经过一定时间后，外观将读取、写入和提交排队。您的 Web 应用程序具有对数据的单点访问（外观），并且外观的结构可以避免过于频繁地从存储中写入和读取。

大多数关系数据库管理系统都会为您执行此操作。他们在内部进行这种优化和排队，因此在其上编写另一层只会减慢速度。因此，如果您使用的是 RDBMS，请不要编写缓存。

关于访问这种外观的具体细节，您可以将其视为一个对象，并根据您的需要实现它（它自己的线程、线程池、Web 服务、Windows 服务等等）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T14:45:17.617

任何远程技术都可以使用，例如套接字、管道等。

查看：www.remobjects.com

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T14:47:00.890

您可以使用 Remoting 或 WCF 连接到 Windows 服务对象，两者都提供非常快速的进程间通信。套接字也很快，但与 WCF 相比，编程更麻烦。有大量的 WCF 文档和在线支持。

数据库为您提供了一定程度的缓存。内存中的黄金副本（例如您建议的副本）的优点是，当请求进入时，如果您将其托管在与 IIS 相同的机器上（前提是您有足够的 RAM 供两者使用），它永远不必从磁盘读取没有额外的网络跃点，使得查询数据库更快。但是，这种方法的缺点是，如果您需要添加机器来进行负载平衡，它的扩展性也不好。

TIBCO 等第三方消息传递提供商也值得关注。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T14:47:11.310

您可以使用 Windows 消息队列或服务总线，甚至 .NET 远程处理。请参阅[http://www.nservicebus.com/](http://www.nservicebus.com/)或[http://code.google.com/p/masstransit/](http://code.google.com/p/masstransit/)。

# silverlight - Silverlight - 你从哪里开始（免费）？

> ID：926308
> 
> 赞同：1
> 
> 时间：2009-05-29T14:36:29.617
> 
> 标签：silverlight, toolkit

首先，我阅读了大量建议去[http://silverlight.net/GetStarted/](http://silverlight.net/GetStarted/)开始使用的帖子和网站，但我没有 Visual Studio，我不会购买它只是为了“也许”学习一些我暂时无法使用的silverlight。

原因是我已经安装了 Visual Studio 和在安静的工作期间所需的所有其他东西，然后另一个项目出现了，当我重新考虑 silverlight 时，试用期已经结束。

我没有做过 C# 或 XAML（主要是 Java、AS3 和 MXML，因此缺乏 MS 工具），但是当我安静地创建一些测试项目并确定我可以在哪里使用它时，我想研究一下 Silverlight任何地方。有没有一个工具集可以让我在不购买软件的情况下学习和使用所有需要的东西（也许它会有一个像过去的 flex 数据图表一样的水印，除非你购买了它们，也许是一个 eclipse 插件 - 虽然我想我是这里有点乐观）。

如果没有这样的事情，那么也许 MS 应该调查一下，Adobe 最近让任何失业者/学生等免费获得 flexbuilder 以增加其使用率。如果 MS 做了类似的事情，那就太好了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T14:40:22.570

如果您是学生，您可以通过 Dreamspark 计划免费获得专业的 Microsoft 工具。 [http://www.dreamspark.com](http://www.dreamspark.com)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T14:40:36.127

您可以免费下载[Blend preview 3](http://www.microsoft.com/downloads/details.aspx?FamilyID=A04AA0AE-87BE-4201-A65E-E792859122FC&displaylang=en)和[visual studio 2010](http://blogs.msdn.com/onoj/archive/2009/05/19/visual-studio-2010-beta-1-download-options.aspx)并使用它。您现在拥有工具和知识；-)

也可以查看[Bizspark](http://www.microsoft.com/BizSpark/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T14:43:09.447

据称，您现在可以使用 Microsoft 的免费“Express”开发系统之一来开发 Silverlight 应用程序。

[http://www.bluerosegames.com/SilverlightBrassTacks/post/You-can-now-write-Silverlight-apps-in-Visual-Web-Developer-Express.aspx](http://www.bluerosegames.com/SilverlightBrassTacks/post/You-can-now-write-Silverlight-apps-in-Visual-Web-Developer-Express.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T14:44:16.900

除了其他答案提到的 MS 提供的免费啤酒选项之外：如果您现在只想玩 Silverlight，请考虑尝试[Moonlight——](http://www.mono-project.com/Moonlight)它可能尚未准备好进行生产工作，但尽管如此可用于学习目的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T14:44:27.883

您可以访问的一个地方是 Microsoft.com 上的[express 网站](http://www.microsoft.com/express/)。您可以在那里免费获得 Visual Studio 和 SQL Server 当前版本的版本，尽管有所缩减。

您还可以获得[Expression Blend 2](http://www.microsoft.com/Expression/products/Overview.aspx?key=blend)的试用版。Blend 是一个面向设计的工具，用于创建 Silverlight 应用程序。

您通常还可以轻松找到即将发布的测试版。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-01T19:14:44.917

Silverlight + Eclipse：

[http://www.eclipse4sl.org/download/](http://www.eclipse4sl.org/download/)

以及如何解决 Express for SL

[http://www.informikon.com/blog/howto-silverlight-and-visual-studio-express.html](http://www.informikon.com/blog/howto-silverlight-and-visual-studio-express.html)

祝你好运布劳略

# asp.net - 经过身份验证的 HttpWebRequest 具有重定向、持久化凭据？

> ID：926309
> 
> 赞同：7
> 
> 时间：2009-05-29T14:36:36.027
> 
> 标签：asp.net, authentication

`HTTPWebRequest`我的 ASP.NET 2.0 应用程序在公司的 Intranet 中创建了一个站点，该站点使用 NTLM 身份验证。传递的凭据用于服务帐户，该帐户已在域上成功验证（安全日志证实了这一点）

一些缩写代码如下..

```
HttpWebRequest req = WebRequest.Create(queryUrl) as HttpWebRequest;
NetworkCredential cred = new NetworkCredential(username,
                pwd, domain); 
req.Credentials = cred;

HttpWebResponse response = req.GetResponse() as HttpWebResponse; 
```

作为请求的一部分，有几个重定向（在同一域内）到最终响应 - 在我的开发机器（Windows 2k）上可以正常处理

当从我的部署环境（Windows 2k3）创建此请求时，我收到从站点返回的 401 Unauthorized 错误，似乎是在返回第一个重定向代码（301 Moved）之后，并且我的请求对象尝试遵循重定向。

所以基本上，有没有人知道围绕经过身份验证的 HttpWebRequests 遵循重定向的任何问题？

**PS** - 显而易见的解决方法是简单地请求重定向到的页面 - 但我负责 Intranet 站点的管理员希望通过将我重定向到特定页面来监控我的应用程序的使用情况。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-12-22T02:53:32.307

要`HttpWebRequest`跨重定向重用凭据，您需要使用凭据缓存。如果您只是分配一个`NetworkCredentials`对象，它将仅在第一个请求时使用。

这是一个例子：

```
HttpWebRequest req = WebRequest.Create(queryUrl) as HttpWebRequest;
NetworkCredential cred = new NetworkCredential(username, pwd, domain); 
var cache = new CredentialCache {{queryUrl, "Ntlm", cred}};
req.Credentials = cache;
HttpWebResponse response = req.GetResponse() as HttpWebResponse; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:05:09.480

这将取决于您的身份验证方式。计划有效。网络凭据仅对 if 的 NTLM 部分有所帮助。我怀疑您尝试访问的网站也在使用表单身份验证。如果是这种情况，当您登录时，您应该获得一个身份验证 cookie，您需要将其包含在后续请求中，例如在重定向之后。我认为 WebRequest 对象有一个 headers 集合，您可以使用它来保存 cookie。使用 fiddler 或 firebug 来查看您通常浏览时遇到的内容可能是个好主意。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-29T15:16:21.237

如果您使用的是 NTLM，这是典型的 2 跳问题。它可以在您的开发机器上运行，因为客户端和服务器在同一个盒子上，并且凭据最多传递一次（我猜是重定向到最终目标机器）

当您部署到生产环境时，涉及 3 台机器。客户端浏览器将凭据传递给 server1，然后 server1 尝试将凭据传递给 server2，这是不允许的。一种解决方法是实现 Kerberos 身份验证（一种更严格的协议），这将允许 server1 将凭据传递给 server2

# java - Apache POI 中的负单元格值样式

> ID：926314
> 
> 赞同：0
> 
> 时间：2009-05-29T14:37:08.897
> 
> 标签：java, apache, excel, apache-poi

使用 Apache POI 生成文档，我在单元格样式方面遇到了一个小问题，目前我正在使用：

```
CellStyle currencyCellStyle=workbook.createCellStyle();
currencyCellStyle.setDataFormat(format.getFormat("$#,##0.00")); 
```

这对于正数完全适用，但是我想自动为负单元格分配不同的样式。

问题是否有任何设置而无需检查单个单元格值并为它们分配单独的样式？

或者，有什么方法可以告诉 Apache POI 使用内置的 excel 货币格式及其负面选项之一？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T15:01:29.393

找到了，谢谢 :D

```
CellStyle currencyCellStyle=workbook.createCellStyle();
currencyCellStyle.setDataFormat(format.getFormat("$#,##0.00;[Red]($#,##0.00)")); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-10-22T17:15:38.117

为什么 poi 拒绝支持 excel 货币格式中的 FIRST 选项超出了我的理解！[![在此处输入图像描述](https://i.stack.imgur.com/OrlzU.png)](https://i.stack.imgur.com/OrlzU.png)

我不喜欢将 DecimalFormat 用于货币，因为您的最终单元格值在引入货币符号后变为非数字。在为一家大型金融机构工作时，我的任务是解决此格式问题。这个变化的核心思想是，因为 POI 拒绝合理并且对 Excel 的原生选项有全面的支持，我会渗透到他们的代码中，并在核心上改变他们的价值观。以下是我的解决方法：

```
private static final String CURRENCY_FORMAT_OVERRIDE = "\"$\"#,##0.00_);-\"$\"#,##0.00";
private static final String CURRENCY_FORMAT_TARGET = "\"$\"#,##0.00_);(\"$\"#,##0.00)";    

static { // static class level initializer
    Field field = org.apache.poi.ss.usermodel.BuiltinFormats.class.getDeclaredField("_formats");            
    field.setAccessible(true);
    String[] _formats = (String[])field.get(new org.apache.poi.ss.usermodel.BuiltinFormats());
    for(int i = 0; i < _formats.length; ++i) {
        if(_formats[i].equals(CURRENCY_FORMAT_TARGET)) {
            _formats[i]=CURRENCY_FORMAT_OVERRIDE;
            System.out.println("TAKE THAT, POI!!!");
        }
    }
} 
```

# jquery - jQuery - 通过单击删除表格行

> ID：926319
> 
> 赞同：15
> 
> 时间：2009-05-29T14:38:12.327
> 
> 标签：jquery

我正在制作一张表格，您可以在其中添加额外的行。添加行时，您可以保存或取消它，单击取消将删除该行。它适用于一行，但是当我创建其中六个并单击取消时，选定的行不会被删除，但最后一行会。到目前为止，这是我的代码。有谁知道我做错了什么？

```
<head>
  <script src="../jquery.js" type="text/javascript"></script>

  <script type="text/javascript">
  $(document).ready(function() {
  $(".edit").click(function() {
    var id = $(this).attr("id");
    alert("edit "+id);
  });
  $(".delete").click(function() {
    var id = $(this).attr("id");
    alert("delete "+id);
  });
  $("#newbutton").click(function() {
  var randomnumber=Math.floor(Math.random()*100);
    $("tr:last").after("<tr id="+randomnumber+"><td><form><input style='width: 80%'></form></td><td class=ok>OK</td><td id="+randomnumber+" class=cancel>Cancel</td></tr>").ready(function() {
      $("tr td .cancel").click(function() {
        $(this).remove();
      });
      $(".ok").click(function() {
        alert("OK!");
      });
    });
  })
}); 
  </script>
</head>
<table border=1 id=table>
<tr><th>Name</th></tr>
<tr><td>Bombai</td><td id=1 class=edit>edit</td><td id=1 class=delete>delete</td></tr> 
<tr><td>London</td><td id=2 class=edit>edit</td><td id=2 class=delete>delete</td></tr> 
<tr><td>Rom</td><td id=3 class=edit>edit</td><td id=3 class=delete>delete</td></tr> 
</table><label id=newbutton>New Place</label> 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-29T14:46:31.733

由于您正在向 DOM 动态添加行，因此我建议您使用**[live](http://docs.jquery.com/Events/live)**函数：

```
$("tr td .cancel").live("click", function(){
  $(this).parent("tr:first").remove()
}) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-04-08T08:07:50.140

```
<td><a class="delete" onclick ="delete_user($(this))">Delete</a></td> 
```

在javascript中

```
 function delete_user(row)
    {
        row.closest('tr').remove();

    } 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-05-20T08:54:29.883

你可以尝试做这样的事情，

### 检查这个`[Demo js Fiddle](http://jsfiddle.net/HXB4Z/)`

### HTML

```
<table border=2>
    <tr>
        <td>jQuery</td>
        <td>mootools</td>
    </tr>
    <tr>
        <td>Dojo</td>
        <td>FUEL</td>
    </tr>
    <tr>
        <td>Raphael</td>
        <td>Rico</td>
    </tr>
    <tr>
        <td>SproutCore</td>
        <td>Lively Kernel</td>
    </tr>
</table> 
```

### jQuery :

```
$(function() {
   $('tr')
       .find('td')
       .append('<input type="button" value="Delete" class="del"/>')
       .parent()//traversing to 'tr' Element
       .append('<td><input type="button" value="Delete row" class="delrow" /></td>');

    $('.del').click(function() {
       $(this).parent().remove(); //Deleting TD element
    });

    $('.delrow').click(function(){
       $(this).parent().parent().remove(); //Deleting the Row (tr) Element
    });
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T14:50:41.817

您没有将删除操作的范围限定在要添加的行的上下文中。尝试：

```
$(this).find("tr td .cancel").click(...) 
```

需要对编辑按钮做同样的处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-02-04T13:06:37.417

**脚本**

```
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <script>
    $(document).ready(function () {
        var markup = "<tr><td><input type='checkbox' name='record'></td><td></td><td></td></tr>";
        $("#Add").click(function () {
            $("#tbl1").append(markup);

        });
        $("#remove").click(function () {
            $("table tbody").find('input[name="record"]').each(function () {
                if ($(this).is(":checked")) {
                    $(this).parents("tr").remove();
                }
            });
        });
    }); </script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-04-23T07:44:31.030

试试下面的代码：

```
$(this).closest("tr").remove(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2019-02-04T13:10:44.037

**身体**

添加行

```
<table border="5px" cellspacing="3px" cellpadding="10px" id="tbl1">
    <thead>
        <tr>
        <td>
            Select
        </td>
        <td>
            column 2
        </td>
        <td>
            column 3
        </td>

    </tr>
    </thead>
    <tbody>
        <tr>
            <td><input type="checkbox" name="record"></td>
            <td></td>
            <td></td>
        </tr>
    </tbody>
</table>
<br />
<button id="remove">Delete Row</button> 
```

# oracle - 无法与 TOAD 连接，但可以与其他工具/应用程序连接

> ID：926323
> 
> 赞同：0
> 
> 时间：2009-05-29T14:39:20.373
> 
> 标签：oracle, database-connection, sqlplus, toad

我可以使用多种工具连接到 Oracle 数据库，但无法使用 Toad for Oracle 8.5.3 进行连接（*尽管在登录/注销 Windows 之前我能够*）。

我没有使用**TNSNAMES.ORA**进行连接。我有两个甲骨文之家：

> `C:\Oracle\product\10.2.0\client_1 (OraClient10g_home1)`和 `C:\Oracle\product\10.2.0\client_2` (ODACHome2)

在客户端 1 之后安装客户端 2 的位置。

我在每个家庭都尝试过 Toad，但是当我提供数据库名称、用户名和密码时，我得到“ORA-12154：TNS：无法解析指定的连接标识符”。我可以使用相同的信息使用 SQL*Plus 进行连接，也可以通过 ADO.NET (ODP.NET) 进行连接。**tnsping** (client 2) 到服务器的工作，但**tnsping** (client 1) 没有。

我的**PATH**环境变量按顺序包含：

> `C:\oracle\product\10.2.0\client_2\bin;C:\oracle\product\10.2.0\client_1\bin`

并且更改**PATH**的顺序似乎没有效果。当我添加该行时

> `NAMES.DIRECTORY_PATH= (LDAP, TNSNAMES)`

到客户端 2 的**sqlnet.ora**，Toad 仍然无法连接，但错误消息出现得更快。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T14:47:08.160

我发布后很快找到了答案，但我不知道这是否是最好的解决方案。我将**ldap.ora**文件从客户端 1 复制到客户端 2。**ldap.ora**有如下几行，出于安​​全原因，我已经修改了这些行：

> ```
> DIRECTORY_SERVERS= (XXXXX:389:636,YYYYY:389:636)
> 
> DEFAULT_ADMIN_CONTEXT = ""
> 
> DIRECTORY_SERVER_TYPE = OID 
> ```

# eclipse - Eclipse RCP 图像应用程序：如何布置图像？

> ID：926324
> 
> 赞同：0
> 
> 时间：2009-05-29T14:39:25.927
> 
> 标签：eclipse, swt, rcp, composite, scrolledcomposite

我有一个显示视图的 Eclipse 插件。我想要做的是在视图中的一行中显示 n 个图像，每个图像下都有一个居中的标签。我想查看可滚动。 **我还希望在视图的尺寸（ScrolledComposite？Composite？）发生变化时重新调整每个图像的大小，以便它利用可用的垂直和水平客户区。**

我在 createViewPart 方法中实现了以下内容（省略了声明和错误检查）：

```
    公共无效createPartControl（复合父）{

        ScrolledComposite myScrolledComposite = 新的 ScrolledComposite（父级，
        SWT.H_SCROLL | SWT.V_SCROLL | SWT.边界）；

        myComposite = new Composite(myScrolledComposite, SWT.NONE);

        myScrolledComposite.setContent(myComposite);
    }

```

**从现在开始，最好的方法是什么？**

1.  **我是否应该将 Composite 子类化并让该类在其自身上绘制给定的图像并在图像下方居中放置一个标签？**
2.  **我应该使用什么布局管理器将标签置于图像下方？**
3.  **我的子类的“父”参数应该是“myComposite”吗？**
4.  **我应该将哪个布局管理器与“myComposite”一起使用？**
5.  **在调整图像大小时，我是否使用“myComposite”的getBounds（我的子类复合材料的getBounds）来计算可用的宽度和高度？**

感谢你的协助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T15:41:19.733

我建议你看看[Eclipse Nebula 项目提供的 Gallery 小部件](http://www.eclipse.org/nebula/widgets/gallery/gallery.php)，也许你可以使用它，或者至少从他们如何实现它中获得一些想法。

# python - 内部类是非 Python 的吗？

> ID：926327
> 
> 赞同：4
> 
> 时间：2009-05-29T14:40:35.380
> 
> 标签：python

我的同事刚刚指出我对内部类的使用似乎是“unpythonic”。我猜它违反了“平面优于嵌套”的启发式。

这里的人怎么看？内部类是否比 Python 更适合 Java 等？

注意：我不认为这是一个“主观”的问题。当然，风格和美学在编程社区*中是客观的。*

* * *

**相关问题：** [在 Python 中的另一个类中定义一个类是否有好处？](https://stackoverflow.com/questions/78799/is-there-a-benefit-to-defining-a-class-inside-another-class-in-python)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-29T14:58:56.107

This may not deserve a [subjective] tag on StackOverflow, but it's subjective on the larger stage: some language communities encourage nesting and others discourage it. So why would the Python community discourage nesting? Because Tim Peters put it in [The Zen of Python](http://www.python.org/dev/peps/pep-0020/)? Does it apply to every scenario, always, without exception? Rules should be taken as guidelines, meaning you should not switch off your brain when applying them. You must understand what the rule *means* and why it's important enough that someone bothered to make a rule.

The biggest reason I know to keep things flat is because of another philosophy: do one thing and do it well. Lots of little special purpose classes living inside other classes is a sign that you're not abstracting enough. I.e., you should be removing the *need and desire* to have inner classes, *not* just moving them outside for the sake of following rules.

But sometimes you really do have some behavior that should be abstracted into a class, and it's a special case that only obtains within another single class. In that case you should use an inner class because it makes sense, and it tells anyone else reading the code that there's something special going on there.

*   **Don't** slavishly follow rules.
*   **Do** understand the reason for a rule and respect that.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-29T14:49:32.537

“平面优于嵌套”的重点是避免*过度*嵌套——即，严重的层次结构。一层嵌套本身没什么大不了的：只要你的嵌套仍然尊重[Demeter 法则](http://en.wikipedia.org/wiki/Law_of_Demeter)（一种较弱的形式） ，这通常可以通过你没有发现自己写的东西来证实`onething.another.andyet.anotherone`（太多表达式中的点是一种“代码气味”，表明您嵌套太深，需要重构以使事情变平），我不会太担心。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T14:44:23.467

实际上，我不确定我是否同意“平面优于嵌套”的整个前提。有时，实际上很多时候，表示某事的最佳方式是分层......即使是自然本身，也经常使用分层。

# iphone - 如何使 UIView 子视图不滚动

> ID：926329
> 
> 赞同：1
> 
> 时间：2009-05-29T14:40:59.823
> 
> 标签：iphone, objective-c, cocoa-touch

我的 UITable 上有一个子视图，用作“忙碌视图”。它拥有一个活动指示器和标签。当程序要下载在单元格中编入索引的照片时，我会调用它。一切正常，但问题是当我向下滚动 UITable 然后单击一个单元格并添加“忙碌视图”时，它会显示在屏幕顶部或屏幕外，因为它也向上滚动. 如何防止第二个子视图滚动并保持在屏幕中央？我试过“中心”属性，但没有帮助。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:49:46.547

不要将“忙碌视图”添加到表格视图中，将其添加到窗口中。这会将其置于屏幕上的所有其他内容之上：

```
[self.view.window addSubview: busyView]; 
```

# javascript - 如何使用 javascript 获取格式化的日期时间，如 2009-05-29 21:55:57？

> ID：926332
> 
> 赞同：46
> 
> 时间：2009-05-29T14:41:45.440
> 
> 标签：javascript, datetime

使用新日期时，我得到如下信息：

2009 年 5 月 29 日星期五 22:39:02 GMT+0800（中国标准时间）

但我想要的是 xxxx-xx-xx xx:xx:xx 格式化的时间字符串

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-05-29T14:55:55.817

尽管在某些情况下它不会填充两个字符，但它可以满足我的期望

```
function getFormattedDate() {
    var date = new Date();
    var str = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate() + " " +  date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();

    return str;
} 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2015-06-19T22:11:25.487

乔纳森的答案缺少前导零。有一个简单的解决方案：

```
function getFormattedDate(){
    var d = new Date();

    d = d.getFullYear() + "-" + ('0' + (d.getMonth() + 1)).slice(-2) + "-" + ('0' + d.getDate()).slice(-2) + " " + ('0' + d.getHours()).slice(-2) + ":" + ('0' + d.getMinutes()).slice(-2) + ":" + ('0' + d.getSeconds()).slice(-2);

    return d;
} 
```

基本上加0，然后只取最后2个字符。所以 031 将占用 31。01 将占用 01...

[jsfiddle](http://jsfiddle.net/aq5jywk5/)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-10-29T22:00:19.277

您可以使用 toJSON() 方法获取 DateTime 样式格式

```
var today = new Date().toJSON(); 
// produces something like: 2012-10-29T21:54:07.609Z 
```

从那里你可以清理它...

要获取日期和时间：

```
var today = new Date().toJSON().substring(0,19).replace('T',' '); 
```

要获取日期：

```
var today = new Date().toJSON().substring(0,10).replace('T',' '); 
```

抓住时间：

```
var today = new Date().toJSON().substring(10,19).replace('T',' '); 
```

编辑：正如其他人所指出的，这仅适用于 UTC。看上面以获得更好的答案。

注意：在此编辑时，这很受欢迎：[date-fns.org](https://date-fns.org)

**更新**

现在有很多`getters`关于`Date.prototype`但只是为了有趣的代码，这里有一些巧妙的新动作：

```
const today = new Date().toJSON();
const [date, time] = today.split('T')
const [year, month, day] = date.split('-')
const [hour, minutes, secondsTZ] = time.split(':')
const [seconds, timezone] = secondsTZ.split('.') 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-29T15:21:52.817

您正在寻找的是**toISOString**，它将成为**ECMAScript Fifth Edition**的一部分。同时，您可以简单地使用[json.org](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)的[json2.js中的](http://www.json.org)**toJSON**方法。

您感兴趣的部分是：

```
Date.prototype.toJSON = function (key) {
  function f(n) {
    // Format integers to have at least two digits.
    return n < 10 ? '0' + n : n;
  }
  return this.getUTCFullYear()   + '-' +
       f(this.getUTCMonth() + 1) + '-' +
       f(this.getUTCDate())      + 'T' +
       f(this.getUTCHours())     + ':' +
       f(this.getUTCMinutes())   + ':' +
       f(this.getUTCSeconds())   + 'Z';
}; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-29T14:45:48.177

对于您想要的东西，这可能有点过头了，但是您是否研究[过 datejs](http://www.datejs.com/)？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-06-15T03:35:37.933

尝试这个。

```
var datetime = new Date().toJSON().slice(0,10) 
    + " " + new Date(new Date()).toString().split(' ')[4];

console.log(datetime); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-29T17:29:56.560

```
Date.prototype.toUTCArray= function(){
    var D= this;
    return [D.getUTCFullYear(), D.getUTCMonth(), D.getUTCDate(), D.getUTCHours(),
    D.getUTCMinutes(), D.getUTCSeconds()];
}

Date.prototype.toISO= function(t){
    var tem, A= this.toUTCArray(), i= 0;
    A[1]+= 1;
    while(i++<7){
        tem= A[i];
        if(tem<10) A[i]= '0'+tem;
    }
    return A.splice(0, 3).join('-')+'T'+A.join(':');
    // you can use a space instead of 'T' here
}

Date.fromISO= function(s){
    var i= 0, A= s.split(/\D+/);
    while(i++<7){
        if(!A[i]) A[i]= 0;
        else A[i]= parseInt(A[i], 10);
    }
    --s[1];
    return new Date(Date.UTC(A[0], A[1], A[2], A[3], A[4], A[5]));  
}

   var D= new Date();
   var s1= D.toISO();
   var s2= Date.fromISO(s1);
   alert('ISO= '+s1+'\nlocal Date returned:\n'+s2); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-20T04:00:24.223

[Any+Time(TM) JavaScript Library](http://www.ama3.com/anytime/)的AnyTime.Converter 对象可以轻松地将 JS Date 对象转换为 ISO 或几乎任何其他格式……事实上，您想要的格式是默认格式，因此您可以简单地说：

```
(new AnyTime.Converter()).format(new Date()); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-04T09:23:07.077

使用javascript将毫秒转换为日期格式

## - 供参考，请参阅下面的 jsfiddle

[http://jsfiddle.net/kavithaReddy/cspn3pj0/1/](http://jsfiddle.net/kavithaReddy/cspn3pj0/1/)

```
function () {
   var values = "/Date(1409819809000)/";
   var dt = new Date(parseInt(values.substring(6, values.length - 2)));
   var dtString1 = (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
   alert(dtString1);
})(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-07-07T06:15:13.757

*只是另一种解决方案：* 我试图获得相同**的格式（ YYYY-MM-DD HH:MM:SS ）**，但发现 date.getMonth() 不准确。所以我决定自己推导出格式。

该代码于 2015 年初部署， 至今**运行良好。**

```
var m_names =["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

var d = new Date();
var spl = d.toString().split(' ');
var mnth = parseInt(m_names.indexOf(spl[1])+1).toString();
mnth = (mnth.length == 1) ? '0'+mnth : mnth
        //  yyyy   -   mm   -   dd       hh:mm:ss 
var data = spl[3]+'-'+mnth+'-'+spl[2]+' '+spl[4]
alert(data) 
```

[测试JSFIDDLE中的代码](https://jsfiddle.net/cqm61dLa/1/)

# c# - 客户端 - 服务器架构中的异常处理

> ID：926333
> 
> 赞同：0
> 
> 时间：2009-05-29T14:41:47.700
> 
> 标签：c#, .net, exception-handling, enterprise-library, elmah

我有一个项目，由一个 Windows 客户端（大约 150 个用户）、一个 Web 服务和一些 Windows 服务组成。所有人都在 Intranet 中工作并使用 C# .NET 3.5 构建。现在我想在中央数据库中记录异常并通过 Web 应用程序管理它们（观看前 10 名、票务系统等）。

我考虑过使用和扩展 ELMAH，因为它已经有一个用于管理的 Web 应用程序。也许为客户创建一个网络服务来记录他们的异常。

这是个好主意吗，因为 ELMAH 显然只适用于 asp.net 网站。

我知道异常管理应用程序块，但据我所知，它没有像 ELMAH 这样的管理应用程序，而且我上次访问 Enterprise Library 并不有趣。

你有什么看法，还有其他想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:37:53.363

企业库既麻烦又矫枉过正。查看开源日志记录组件：NLog[链接文本](http://www.nlog-project.org/)或 Log4Net[链接文本](http://logging.apache.org/log4net/index.html)。它们都能够记录到各种“接收器”，包括平面文件、UDP、数据库等。

我会在你的日志组件写入服务器上的事件日志的地方设置一些东西。然后使用像 Microsoft Operations Manager (MOM) 或其他可以扫描事件日志并通过分页、命令中心控制台等发出警报的系统管理软件。同时，您还可以登录到数据库进行查询等.

如果您正在寻找异常管理、报告、警报等...有大量的解决方案，例如 MS MOM、Tivoli、CA Unicenter、HP OpenView 甚至 NagIOS，您可以使用这些解决方案。

客户端有点棘手。由于它是 Intranet，因此您可以使用 UDP 并在服务器上运行一个服务，该服务将侦听这些 UDP 数据包并将它们存储在事件日志和/或数据库中。或者，您可以向 Web 服务添加一些方法来捕获日志记录事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:03:35.480

我认为您扩展 ELMAH 的想法一点也不坏。做过许多类似的项目后，我总是不得不推出自己的管理应用程序，这总是很痛苦。不确定您可以从 ELMAH 使用多少，但听起来这可能是一个很好的起点。

# django - 如何为不同的浏览器使用不同的模板

> ID：926336
> 
> 赞同：1
> 
> 时间：2009-05-29T14:42:30.290
> 
> 标签：django, django-templates

我想为不同的（移动）浏览器提供我的 django 网站的特殊版本。有什么可能的解决方案来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T14:48:50.900

在你看来，这样做

```
def map(request, options=None, longitude=None, latitude = None):
    if 'iPhone' in request.META["HTTP_USER_AGENT"]:
        user_agent = 'iPhone'
    elif 'MSIE' in request.META["HTTP_USER_AGENT"]: 
        user_agent ='MSIE'
    else: user_agent=''
    print user_agent
    return render_to_response('map/map.html', 
        {
            'user_agent': user_agent
        }) 
```

并在您的模板中

```
{% ifnotequal user_agent "iPhone" %}
    {% ifequal user_agent "MSIE" %}
        {% include 'map/map_ie.html' %}
    {% else %}
        {% include 'map/map_default.html' %}
    {% endifequal %}
{% else %}
{% include 'map/map_iphone.html' %}
{% endifnotequal %} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-11T08:01:17.317

最佳实践：使用[minidetector](http://code.google.com/p/minidetector/)将额外信息添加到请求中，然后使用 django 的内置请求上下文将其传递给您的模板，就像这样。

```
from django.shortcuts import render_to_response
from django.template import RequestContext

def my_view_on_mobile_and_desktop(request)
    .....
    render_to_response('regular_template.html', 
                       {'my vars to template':vars}, 
                       context_instance=RequestContext(request)) 
```

然后在您的模板中，您可以引入以下内容：

```
<html>
  <head>
  {% block head %}
    <title>blah</title>
  {% if request.mobile %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}/styles/base-mobile.css">
  {% else %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}/styles/base-desktop.css">
  {% endif %}
  </head>
  <body>
    <div id="navigation">
      {% include "_navigation.html" %}
    </div>
    {% if not request.mobile %}
    <div id="sidebar">
      <p> sidebar content not fit for mobile </p>
    </div>
    {% endif %>
    <div id="content">
      <article>
        {% if not request.mobile %}
        <aside>
          <p> aside content </p>
        </aside>
        {% endif %}
        <p> article content </p>
      </aricle>
    </div>
  </body>
</html> 
```

# windows - 将传入的电子邮件通过管道传输到 Windows IIS SMTP 上的脚本？

> ID：926345
> 
> 赞同：11
> 
> 时间：2009-05-29T14:44:04.890
> 
> 标签：windows, iis, email, smtp

我有一个在 Windows IIS 上运行的 Web 应用程序。这个应用程序有一个数据库，其中每个项目都有一个唯一的键（1、2、3...）和一个电子邮件地址列表（除其他外）。

我希望用户使用标识该项目的电子邮件地址向服务器发送电子邮件，然后让服务器将消息中继到该项目的电子邮件地址。例如，如果用户向以下地址发送电子邮件：

```
item-75@myserver.example.com 
```

然后服务器将接收电子邮件并将其通过管道传输到脚本。该脚本将在数据库中查询项目 75 以获取电子邮件地址列表，然后重新发送电子邮件。

我可以在 unix 系统上使用 sendmail 轻松完成此操作，但我不知道是否可以在 Windows 系统上完成类似的设置（或者是否需要额外的软件）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-30T14:19:11.923

（这听起来像你想实现像 craigslist 这样的功能）。

IIS SMTP 服务可以发送电子邮件，也可以*接受*电子邮件。

这就是你想要做的。

将 IIS SMTP 服务配置为接受域的电子邮件（您可以在 IIS SMTP 服务的属性中的域下进行配置）。说域名“myserver.example.com”

然后，在您的 DNS 服务器中，配置指向“myserver.example.com”的 MX 记录。

现在，当电子邮件被发送到您的 IIS SMTP 服务器时，它实际上会被放置在您的 mailroot/drop 文件夹中（您也可以在 IIS SMTP 服务属性中更改此文件夹）。

现在您正在接受电子邮件，下一步是编写一个脚本，它将：

1）解析电子邮件。

2）相应地修改它们（你只是想改变“到”地址吗？）。

3）如果您想重新发送电子邮件，那么您需要相应地修改它们。您将需要添加一个 X-Sender 标头，用于标识发送电子邮件的电子邮件地址，以及一个 X-Receiver 标头，用于每个将接受电子邮件的收件人。以下是修改后的示例电子邮件：

```
X-Sender: me@mywebsite.com
X-Receiver: recip1@theirdomain.com
X-Receiver: recip2@theirdomain.com
From: "jim bob" <jim@example.com>
To: <item-75@myserver.example.com>
Subject: test
MIME-Version: 1.0
Content-Type: text/plain;
Message-ID: <024f01c9e130$b3eca500$0401a8c0@local>

test 
```

一旦你有了这个修改过的内容，你就会想把它写到 mailroot/pickup 目录中的一个文件中。请务必使用唯一的名称。

IIS SMTP 服务会过来，提取电子邮件并转发它，使用 X-Sender 作为 MAIL FROM 地址发送电子邮件，并将其发送到每个 X-Receiver 标头中列出的每个电子邮件地址。

4）将此脚本作为计划任务运行。另一种选择是将其构建为 Windows 服务，或者实现类似文件系统观察器的功能，每次将电子邮件创建为文件时都会在其中执行。

5）所有这一切的另一种选择是实际实现一个 SMTP 事件接收器，但我认为这对于你想要做的事情来说太过分了，并且会产生更多的麻烦，而不是它解决的问题。如果我喜欢痛苦，我只会走事件汇路线。

希望我没有把它弄得像泥巴一样清晰。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-03T20:50:59.190

事件汇一点都不难！事实上，大约有十几个用 VBS 编写的示例（在使用 WSH 的 Win 服务器上运行）完全可以完成您想要做的事情。OnArrival 事件接收器使用您希望没有任何安全风险的任何计算机用户帐户实时运行，因为消息是异步的并且不会报告回来。

这实际上是一件非常容易的事情——最简单的事情之一。一旦设置，它也永远不会中断。在一台服务器上，我已经运行了 9 年多，每天处理几千条传入消息！我已经设置了大约十几个这样的东西——如果它需要你几个小时以上，你就做错了。如果在 UNIX 上比这更容易，我的祖母可能是一名 UNIX 程序员，所以我不会吹嘘这在 UNIX 服务器上更容易。

[http://msdn.microsoft.com/en-us/library/ms528023.aspx](http://msdn.microsoft.com/en-us/library/ms528023.aspx)

[http://support.microsoft.com/kb/894286](http://support.microsoft.com/kb/894286)

[http://msdn.microsoft.com/en-us/library/ms526206.aspx](http://msdn.microsoft.com/en-us/library/ms526206.aspx)

[http://msdn.microsoft.com/en-us/library/ms526620.aspx](http://msdn.microsoft.com/en-us/library/ms526620.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T14:56:29.590

您可以使用定时脚本通过 POP3 或 IMAP 阅读电子邮件。我也是一个 UNIXer，所以我很难理解这样的事情是多么困难，但是你有它。这是我认为你应该做的。

*   用你喜欢的任何语言编写脚本。只要它可以从 POP3 或 IMAP 读取。

*   让 Windows 每 5 分钟运行一次脚本

*   让脚本访问邮箱并操作它需要的任何电子邮件。

我个人的偏好是安装 Python，但如果你是有限的......我不知道。ASPNET 还不错，但我以前从未将它用于编写脏脚本。

# visual-studio - Visual Studio 中的远程结对编程

> ID：926349
> 
> 赞同：30
> 
> 时间：2009-05-29T14:44:18.320
> 
> 标签：visual-studio, visual-studio-2008, pair-programming

有谁知道允许在 Visual Studio 中进行远程结对编程的 Visual Studio 加载项？

[类似于 SubEthaEdit](http://www.codingmonkeys.de/subethaedit/)的东西，所有用户都可以实时编辑同一个文档。

多个用户控制键盘和鼠标的共享/远程桌面连接是朝着正确方向迈出的一步。但是，此解决方案不如 SubEthaEdit，因为默认情况下 Visual Studio 文本编辑器将无法处理同时编辑。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-29T14:56:56.437

就个人而言，最近完成了大量的远程结对编程，我更喜欢[Join.me](https://join.me/)。我们实际上并没有同时使用键盘/鼠标，我们使用源代码控制提交和推送变更集，并且实际上交换了谁是主机。

少数非常流行的 VNC 选项之一将允许双方键入并控制鼠标（与 SharedView 不同，您必须来回传递控制），并且与 Skype voip 配合得很好。

*   [超VNC](http://www.uvnc.com/)
*   [RealVNC](http://www.realvnc.com/)
*   [紧VNC](http://www.tightvnc.com/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-01-14T00:44:35.483

[VS Anywhere](http://www.vsanywhere.com)是您使用 Visual Studio 进行结对编程所需要的

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T17:00:33.897

Skype 可以处理它。结对编程的原则之一是只有一个人在键盘和鼠标旁，因此您真正需要的只是单向屏幕投射和语音聊天。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-02T08:44:35.177

我的建议是[团队查看器](http://www.teamviewer.com/index.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T14:48:19.857

您可以使用 microsoft 共享视图（虽然您不能同时键入，但您可以使用鼠标轨迹指向事物）。

并使用Skype进行对话。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-21T20:09:50.287

我刚刚通过 Windows 中的远程协助尝试了 2.5 小时的会话，效果非常好。最烦人的是我找不到让它全屏运行的方法。

我们将 Skype 用于音频，并且也在考虑使用网络摄像头运行。

想我下次会试试 TeamViewer！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-02T19:33:43.953

We are working on this. You can use beWeeVee.com by now as a workaround. Meanwhile we are working on this: [http://www.youtube.com/watch?v=DwXNk-lCIdg](http://www.youtube.com/watch?v=DwXNk-lCIdg)

# c# - ValueType.GetType() 如何确定结构的类型？

> ID：926352
> 
> 赞同：30
> 
> 时间：2009-05-29T14:44:27.650
> 
> 标签：c#, .net, types

对于引用类型，对象的内存布局是

```
| Type Object pointer|
|    Sync Block      |
|  Instance fields...| 
```

对于值类型，对象布局似乎是

```
|  Instance fields...| 
```

对于引用类型，GetType 表示从“类型对象指针”中查找对象。给定引用类型对象的所有对象都指向同一个类型对象（也有方法表）

对于值类型，此指针不可用。那么 GetType() 是如何工作的呢？

我用谷歌查了一下，我发现了这个片段……有点模糊。有人可以详细说明吗？

> 解决方案是存储值的位置可能只存储某种类型的值。这是由验证者保证的。 [来源](http://en.csharp-online.net/Common_Type_System%E2%80%94Value_Layout)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-29T14:49:15.173

调用`GetType()`一个值类型框该值类型。通过将值类型移动到堆上，您现在有了一个引用类型，它现在有一个指向该对象类型的指针。

如果您希望避免装箱，您可以调用[`GetTypeCode`](http://msdn.microsoft.com/en-us/library/system.type.gettypecode.aspx)which 返回一个枚举，该枚举指示值类型的类型而不装箱。

这是一个显示发生的拳击的示例：

**C＃：**

```
class Program
{
    static void Main()
    {
        34.GetType();
    }
} 
```

**用于`Main()`：**

```
.method private hidebysig static void Main() cil managed
{
        .entrypoint
        .maxstack 8
        L_0000: ldc.i4.s 0x22
        L_0002: box int32
        L_0007: call instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()
        L_000c: pop 
        L_000d: ret 
} 
```

* * *

**编辑：**为了显示编译器在做什么，让我们改变文字的类型，如下所示：

```
class Program
{
    static void Main()
    {
        34L.GetType();
    }
} 
```

通过`"L"`在文字后面添加 ，我告诉编译器我希望将此文字转换为`System.Int64`. 编译器看到了这一点，当它发出`box`指令时，它看起来像这样：

```
.method private hidebysig static void Main() cil managed
{
        .entrypoint
        .maxstack 8
        L_0000: ldc.i4.s 0x22
        L_0002: conv.i8 
        L_0003: box int64
        L_0008: call instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()
        L_000d: pop 
        L_000e: ret 
} 
```

如您所见，编译器已经完成了确定要发出的正确指令的艰苦工作，然后由 CLR 来执行它们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-01T08:23:51.770

*也许 Andrew H. 认为这是显而易见的，并努力让我理解 +1。我的灯泡时刻来自 Jon Skeet.. 再次（这次是通过我碰巧正在阅读的他的书.. 以及答案所在的确切区域。*

*   C# 是静态类型的。**每个变量都有一个类型**，并且在编译时是已知的。
*   值类型不能被继承。**因此，VT 对象不需要携带额外的类型信息**（与 Ref Type 对象相反，每个对象都有一个对象类型头，因为变量类型和值/对象类型**可能**不同。）

考虑下面的片段。虽然变量类型是 BaseRefType，但它指向一个更特殊类型的对象。对于值类型，由于禁止继承，因此变量类型**是**对象的类型。

```
BaseRefType r = new DerivedRefType(); 
ValueType v = new ValueType(); 
```

我缺少的部分是子弹#1。
`<Snipped after J.Skeet's comment since it seems to be wrong>`. 似乎有一些魔法可以让编译器/运行时知道给定任意变量的“变量类型”。所以运行时不知何故知道 ob 是 MyStruct 类型，即使 VT 对象本身没有类型信息。

```
MyStruct ob = new MyStruct();
ob.WhoAmI();                          // no box ; defined in MyStruct
Console.WriteLine(ob.GetHashCode());  // no box ; overridden in ValueType
Console.WriteLine( ob.GetType() );    // box ; implemented in Object 
```

因此，我能够调用 MyStruct 中定义的方法（以及出于某种原因的 ValueType），而无需装箱到 RefType。

# svn - 在您已经将提交的文件提交到 Svn 中的存储库之后将它们组合在一起（作为单个提交）？

> ID：926354
> 
> 赞同：3
> 
> 时间：2009-05-29T14:44:41.143
> 
> 标签：svn, grouping, commit, post-commit

在您已经将它们提交到 Svn 中的存储库之后，是否可以将多个提交的文件组合在一起（作为单个提交）？

在我提交了一堆文件（不使用 subeclipse 时）之后，我似乎总是忘记一两个文件，我只是想知道是否有人知道这是否可能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T14:49:39.247

一旦提交，就无法故意修改它。这样 r123 总是指的是同一件事。如果您可以在之后将文件添加到提交中，那么在更改之前签出 r123 的人将与在更改之后签出 r123 的人具有不同的视图，从而破坏任何版本控制系统的关键目标。

这实际上与“如果我提交的代码中有语法错误并且无法构建怎么办？”这个问题没有什么不同。答案是提交其他有修复的东西。这两种情况产生相同的问题并具有相同的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T14:51:06.170

不，要获得这种能力，您需要像[Git](http://git-scm.com/)这样的工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T14:53:17.380

跟进之前的答案。

在这一点上，我几乎只使用[Git SVN](http://git-scm.com/docs/git-svn)，因为它能够保留本地修订，然后在我完全使用该功能时将它们合并到 SVN 树中。使用 Git SVN 时，我在本地提交我的更改，当我完全完成时，然后同步到 SVN。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T18:26:41.193

我找到了使用更高级别的工具将修订组合在一起并跟踪更改的最佳解决方案。

我们使用 redmine 来记录所有任务，并且我们的 svn 修订版会自动标记。以这种方式工作，即使修复可能需要 7 或 8 次提交，您也可以快速搜索日志并将 Bug #366 的修复作为一个单元滚动到发布中。

Redmine、trac、fogbugz、bugzilla、tfs，都很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T15:06:50.053

解决方法：反向合并所有有问题的修订，提交，再次将这些修订中的更改应用到您的 WC，一次全部提交。

免责声明：我没有尝试过。

# zend-framework - 有没有办法从 Zend 框架中的引导程序重定向浏览器？

> ID：926361
> 
> 赞同：2
> 
> 时间：2009-05-29T14:45:52.997
> 
> 标签：zend-framework, redirect, routing

我需要根据引导文件中的某些条件进行重定向。
它是在定义了前端控制器和路由之后完成的。
我怎么做？
（我知道我可以简单地使用 header('Location: ....) 关键是我需要使用路由器来构建 URL。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-10-22T19:39:27.790

一年多后，我在 ZF 编程，我为你的问题找到了这个解决方案。这是我在引导程序中确定用户登录位置的函数。

```
class Bootstrap extends Zend_Application_Bootstrap_Bootstrap 
```

{

```
protected $_front;

(...)

protected function _initViewController() 
{
    (...)

    $this->bootstrap('FrontController');
    $this->_front = $this->getResource('FrontController');

    (...)
}

protected function _initLogado()
{
    $router = $this->_front->getRouter();
    $req = new Zend_Controller_Request_Http();
    $router->route($req);
    $module = $req->getModuleName();

    $auth = Zend_Auth::getInstance();
    if ($auth->hasIdentity()) {
        $this->_view->logado = (array) $auth->getIdentity();
    } else {
        $this->_view->logado = NULL;
        if ($module == 'admin') {
            $response = new Zend_Controller_Response_Http();
            $response->setRedirect('/');
            $this->_front->setResponse($response);
        }
    }
} 
```

}

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-22T19:51:08.123

重定向真的不应该在引导文件中......对于最终在几年内卡住你的代码的编码器来说，这将是一个可怕的调试之夜。

使用前端控制器插件、动作控制器插件，或者在你的动作控制器中进行。最终应该完全避免这种重定向......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T19:49:07.483

最好的方法可能是[控制器插件](http://framework.zend.com/manual/en/zend.controller.plugins.html)

您可以添加一个 routeShutdown() 钩子，该钩子在路由发生后调用，但在调用控制器的操作方法之前。在这个插件中，您可以检查请求数据，或者在 ACL 中查找权限，或者如果您想要的话，只是随机重定向！

这是你的选择！

编辑：重新阅读您的问题，您似乎甚至对路线不感兴趣 - 使用 routeStartup() 作为引导后的最早点来注入您的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T20:46:04.360

我会从前端控制器抓取路由器并调用它的`assemble()`方法，然后使用`header()`:)

问候，

抢...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-30T11:34:14.203

您可以检查插件中“routeShutdown”方法的条件，然后使用 $this->actionController->_helper->redirector() 进行重定向；）

# .net - 从 .NET 中的构造函数中抛出异常

> ID：926362
> 
> 赞同：12
> 
> 时间：2009-05-29T14:46:19.470
> 
> 标签：.net, exception, memory, garbage-collection

当我从如下构造函数中抛出异常时，是否存在内存泄漏？

```
class Victim
{
    public string var1 = "asldslkjdlsakjdlksajdlksadlksajdlj";

    public Victim()
    {
        //throw new Exception("oops!");
    }
} 
```

垃圾收集器会收集失败的对象吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-29T14:51:00.147

一般来说，从不泄漏内存的角度来看，这是安全的。但是，如果您在类型中分配非托管资源，则从构造函数中抛出异常是危险的。举个例子

```
public class Foo : IDisposable { 
  private IntPtr m_ptr;
  public Foo() {
    m_ptr = Marshal.AllocHGlobal(42);
    throw new Exception();
  }
  // Most of Idisposable implementation ommitted for brevity
  public void Dispose() {
    Marshal.FreeHGlobal(m_ptr);
  }
} 
```

即使您使用 using 块，每次尝试创建此类都会泄漏内存。例如，这会泄漏内存。

```
using ( var f = new Foo() ) {
  // Won't execute and Foo.Dispose is not called
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-29T14:59:12.893

如果您没有创建非托管资源，则从构造函数中抛出异常应该没问题。但是，如果您确实在构造函数中创建了非托管资源，则该构造函数的整个主体（包括 throws）都应该包装在 try/catch 中。窃取 JaredPar 的一个很好的例子：

```
public class Foo : IDisposable { 
  private IntPtr m_ptr;
  public Foo() {
    try
    {
        m_ptr = Marshal.AllocHGlobal(42);
        throw new Exception();
    }
    catch
    {
        Dispose();
        throw;
    }
  }
  // Most of Idisposable implementation ommitted for brevity
  public void Dispose() {
    Marshal.FreeHGlobal(m_ptr);
  }
} 
```

现在可以使用以下方法：

```
using ( var f = new Foo() ) {
  // Won't execute, but Foo still cleans itself up
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-29T14:52:42.033

有趣，因为我昨天 帮助了一个[类似的问题。](https://stackoverflow.com/questions/923054/best-practices-private-member-instantiation-initialization/923093#923093)

如果您有派生类型，这是一个更大的问题，因为派生类型的某些部分将初始化，而其他部分则不会。从内存的角度来看，这并不重要，因为垃圾收集器知道什么在哪里。但是，如果您有任何非托管资源（实现 IDisposable），事情就会变得模糊不清。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T14:47:50.623

是的，垃圾收集器将回收已在对象中分配的托管资源。如果您已初始化任何非托管资源，则需要以正常方式自行清理这些资源。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T14:49:22.927

这取决于您在引发异常之前获得了哪些其他资源。我不认为在构造函数中抛出异常很好，但是在终结器或 dispose() 中抛出异常要糟糕得多。

# ide - Visual Studio 在绘制 SSIS 任务时遇到问题

> ID：926386
> 
> 赞同：0
> 
> 时间：2009-05-29T14:49:22.287
> 
> 标签：ide, visual-studio-2005, ssis

在使用 SSIS 包时，我在 Visual Studio 2005 中遇到了这种奇怪的行为。Visual Studio 似乎在绘制/重新绘制任务时遇到问题。

当我打开一个包时，我看到任务项的标签和连接任务的线，但我没有看到框轮廓或任务类型的图标。当我单击任务项时，会出现大纲和图标。如果我最小化屏幕然后最大化它，它们会再次消失。

如果我弹起我的机器并自行加载 Visual Studio，就会出现问题。我对任何其他项目都没有问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-31T01:42:09.497

我已经看过几次了，在我安装了最新的视频驱动程序后，这两种情况的问题都消失了。

# windows - 我怎样才能故意减慢 Windows？

> ID：926390
> 
> 赞同：13
> 
> 时间：2009-05-29T14:49:40.430
> 
> 标签：windows, performance

我如何可逆地减慢使用 XP 的 PC？

我想在不使用可见 CPU 周期的情况下实现这一点，所以我猜一些硬件设置可能会这样做。

我不希望我的应用程序运行缓慢，我希望整个操作系统运行缓慢。我知道一些网络查找，尤其是在受信任的环境（想想 Active Directory）中会减慢 PC 的速度。这就是我想要的效果。

免责声明：这不是出于不良/邪恶/非法的原因！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-29T14:51:48.273

我们使用称为 doofus 的“残废”服务器进行负载测试。这是一个旧的 P3/500 盒子，内存有限。

另一种选择是设置一个资源非常有限的虚拟机。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-29T14:58:57.057

使用[powercfg.exe](http://technet.microsoft.com/en-us/library/cc748940.aspx)强制计算机使用您创建的电源计划，将 CPU 锁定在较低频率以节省电力。可用的状态取决于您的平台（大多数桌面只有几个。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-29T14:53:02.733

如果您认为您的硬件设置可以处理它，一些主板允许您在 BIOS 中手动指定时钟倍频或其他速度设置。通常会有一个较慢速度的选项或一个您可以手动输入较低乘数的字段。

如果没有，您可能会考虑设置虚拟机，并确保它没有完全虚拟化 - 由于虚拟化层中发生必要的转换，半虚拟化机器运行速度较慢。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-29T15:10:14.897

开源[Bochs 模拟器](http://bochs.sourceforge.net/)很容易通过编辑其配置文件来减慢速度。Windows XP 将在其中运行。它不如 vmware 强大，但有更多的配置选项。

查看配置文件“bochsrc”的文档，尤其是“IPS”条目。（每秒指令）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T14:53:58.487

去除热胶并在 CPU 上放一些灰尘 :-) 另外，去除一些 RAM。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-29T15:01:43.510

您可能想看看全系统模拟器，例如[Simics](http://www.virtutech.com/)。Simics 允许您确定性地模拟整个系统（包括网络，如果需要）。您不仅可以调整 CPU 频率，还可以详细研究系统以了解其行为方式。

不幸的是，Simics 的价格很高。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-29T15:26:23.430

如果您想非常轻松地看到真正戏剧性的效果，请在 boot.ini 中设置[/MAXMEM](http://support.microsoft.com/kb/108393)开关（或使用 msconfig）。这将限制系统使用的内存量 - 切换到 256mb 或更低会使事情变得非常非常慢。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-29T15:32:32.840

你有很多选择。我能想到的事情：

1.  将您的磁盘更改为良好的老式 IDE。没有那些高速 DMA 的东西，只是老式的 PIO。
2.  移除 RAM（或在 BIOS 中禁用）
3.  切换到通用视频驱动程序（我的意思是“通用 SVGA”类型，未加速）
4.  在 BIOS 中禁用内核
5.  在 BIOS 中减慢 CPU 速度（如果可能）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-29T14:59:25.730

出于这个原因，我们保留了一台旧笔记本电脑。帮助我在一些启动屏幕代码中找到了一个微妙的计时问题，这在体面的四核开发盒上绝对无法重现。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-29T15:31:12.390

安装 Norton 360。它会使鼠标光标在更新过程中滞后，并不断唠叨重启。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-29T15:57:59.770

在 BIOS 中禁用二级缓存

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-02-27T06:24:19.160

两个 Windows 应用程序：[Mo'Slo](http://moslo.info/)和[Cpukiller](http://www.cpukiller.com/)。

我记得听说过一个会占用大量 RAM 以减少可用 RAM 的设备，但我忘记了它叫什么。

# c# - 如何将二进制文件转换为一组 ascii 字符

> ID：926400
> 
> 赞同：0
> 
> 时间：2009-05-29T14:51:40.163
> 
> 标签：c#, encoding, io, ascii

我想将二进制文件转换为 ascii 字符数组。我怎样才能做到这一点 。谢谢你 。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T15:07:00.927

这取决于你想用它做什么。Ascii 应该是 7 位（0-127 定义明确，其他字符取决于代码页）。因此，纯 ASCII 编码可能会导致令人讨厌的意外（其中非可打印字符为空值......）

如果你想从你的字节数组中打印一些东西，你不应该用 ASCII 编码来转换它们。您最好在 Base64 中对其进行编码，这是一种在字符串中编码二进制文件的安全（尽管在大小方面不是太理想）的方法。

要在 Base64 中编码您的字节，您可以使用：

```
string result = System.Convert.ToBase64String(yourByteArray); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T14:54:46.443

查看 BASE64 或 UUEncoding。我假设您只想使用 256 字符 ASCII 集中的可打印字符。

BASE64 仅使用 64 个字符（例如，有时在通过电子邮件发送二进制文件时使用）。这会导致输出的大小增加——你必须在你的情况下考虑这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T14:56:20.543

```
StreamReader reader = new StreamReader("pathtoyourbinaryfile", System.Text.Encoding.ASCII);
char[] text = reader.ReadToEnd().ToCharArray(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T14:54:00.267

您可以读取每个字符并将其转换为字符。这会将每个字节转换为 ascii 字符。那是你想要做的吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-01T23:13:32.437

我不相信早期的响应者回答了这个问题。许多人在表示字节时会说 ASCII，所以我怀疑提问者想要读取二进制文件而不是带有编码字符的文本文件。

为了演示不同技术的影响，我从以下字符串创建了一个 UTF-8 文本文件：

```
 string s = "\ta£\x0394\x221A";   // tab; lower case a; pound sign; Greek delta; square root 
```

以下程序首先将该文件作为文本字符串读取，然后作为字节数组读取。在每种情况下，它首先将输入显示为十进制，然后显示为十六进制。

```
 String test = "";
  String fileStg = File.ReadAllText("Test.txt");
  for (int i = 0; i < fileStg.Length; i++)
    test += (int)fileStg[i] + " ";
  Debug.Print(test);
  test = "";
  for (int i = 0; i < fileStg.Length; i++)
    test += ((int)fileStg[i]).ToString("X") + " ";
  Debug.Print(test);
  test = "";
  Byte[] fileByte = File.ReadAllBytes(pathProg + "Test.txt");
  for (int i = 0; i < fileByte.Length; i++)
    test += fileByte[i].ToString() + " ";
  Debug.Print(test);
  test = "";
  for (int i = 0; i < fileByte.Length; i++)
    test += fileByte[i].ToString("X") + " ";
  Debug.Print(test); 
```

输出：

> ```
> 9 97 163 916 8730 13 10
> 9 61 A3 394 221A D A
> 239 187 191 9 97 194 163 206 148 226 136 154 13 10
> EF BB BF 9 61 C2 A3 CE 94 E2 88 9A D A 
> ```

请注意，当作为文本文件读取时，BOM 已被剥离，多字节 UTF-8 字符已成为输入字符串中的单个字符。但是当作为字节数组读取时，我会收到 BOM 和原始 UTF-8。

我怀疑提问者想要读取真正的二进制文件而不是 Unicode 文本文件，但我相信这个示例更好地说明了这两种技术的效果，并证明如果提问者希望读取二进制文件，那么 ReadAllBytes 是更合适的技术。

# sql-server - 是否可以限制 SQL Server 2005 中角色/登录名的连接数？

> ID：926402
> 
> 赞同：4
> 
> 时间：2009-05-29T14:51:56.807
> 
> 标签：sql-server, sql-server-2005, security, connection

例如，将其限制为给定技术帐户的最多 2 个连接，第三个连接被反复阻止，直到其他一个被放弃

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T16:19:57.780

是的，但您需要一点点 SQL 代码。您可以通过创建[登录触发器](http://msdn.microsoft.com/en-us/library/bb326598(SQL.90).aspx)来强制执行您喜欢的任何策略。此触发器是 SQL Server 2005 SP2 的新增功能（它**不在**RTM 版本 afaik 中），并且在每次建立连接时运行，在从所述连接接受任何语句之前。确保为触发器使用正确的 EXECUTE AS 子句。在触发器中，您可以检查 sys.dm_exec_sessions 和 sys.dm_exec_connections 并决定是否允许新连接是/否。[请注意，由于MARS](http://technet.microsoft.com/en-us/library/ms345109(SQL.90).aspx)，在 SQL 2005 上，会话数不一定等于连接数。如果您允许 2 个连接或 2 个会话，您应该决定您的策略。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:36:35.973

据我所知，这不可能通过 SQL Server 安全实现本身来实现。

但是，您可以全局配置与 SQL Server 的最大连接数。

我相信需要在数据库引擎外部控制/过滤/筛选到 SQL Server 的所有连接，以实现此目的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T15:38:24.803

您不能在服务器端以声明方式执行此操作。如果您想信任应用程序自行执行，您当然可以在 tsql 代码中执行此操作。

# java - clone() 真的用过吗？getter/setter 中的防御性复制怎么样？

> ID：926404
> 
> 赞同：8
> 
> 时间：2009-05-29T14:52:07.197
> 
> 标签：java, jakarta-ee, clone, defensive-programming

人们实际上曾经使用过防御性吸气剂/二传手吗？对我来说，99% 的时间你打算让你在另一个对象中设置的对象成为同一个对象引用的副本，并且你打算对它所做的更改也在它设置的对象中进行。如果你`setDate ( Date dt )`和以后修改 dt，谁在乎呢？除非我想要一些基本的不可变数据 bean，它只有原语并且可能像 Date 这样简单，否则我从不使用它。

就克隆而言，副本的深度或浅度存在问题，因此知道克隆对象时会出现什么似乎有点“危险”。我想我只使用`clone()`过一次或两次，那就是复制对象的当前状态，因为另一个线程（即另一个访问 Session 中相同对象的 HTTP 请求）可能正在修改它。

编辑 - 我在下面发表的评论更多的是问题：

但是话又说回来，您确实更改了日期，所以这是您自己的错，因此整个讨论了“防御性”一词。如果所有应用程序代码都在中小型开发人员群体中由您自己控制，那么仅记录您的类就足以替代制作对象副本了吗？或者这不是必需的，因为您应该始终假设在调用 setter/getter 时没有复制某些内容？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-29T15:47:32.357

来自 Josh Bloch 的 Effective Java：

> 您必须在假设您的类的客户将尽最大努力破坏其不变量的情况下进行防御性编程。如果有人试图破坏您的系统的安全性，这实际上可能是正确的，但您的类更有可能不得不处理由于使用您的 API 的程序员的诚实错误而导致的意外行为。无论哪种方式，花时间编写在面对行为不端的客户时仍然健壮的类是值得的。

[第 24 条：在需要时制作防御性副本](http://www.informit.com/articles/article.aspx?p=31551&seqNum=2)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-29T17:02:29.137

这是一个不平凡的问题。基本上，您必须考虑通过 getter 或调用另一个类的 setter 给任何其他类的类的任何内部状态。例如，如果您这样做：

```
Date now = new Date();
someObject.setDate(now);
// another use of "now" that expects its value to not have changed 
```

那么你可能有两个问题：

1.  `someObject`可能会改变 " `now`" 的值，这意味着上面的方法在以后使用该变量时可能具有与预期不同的值，并且
2.  如果在将 " `now`" 传递给`someObject`您之后更改了它的值，并且如果`someObject`没有进行防御性副本，那么您已经更改了`someObject`.

您应该避免这两种情况，或者您应该记录您对允许或禁止什么的期望，具体取决于代码的客户是谁。另一种情况是当一个类有一个`Map`并且你为它自己提供一个getter `Map`。如果`Map`是对象内部状态的一部分，并且对象希望**完全**管理 的内容`Map`，那么你**永远不**应该泄露`Map`出去。如果您必须为地图提供 getter，则返回`Collections.unmodifiableMap(myMap)`而不是`myMap`. 由于潜在的成本，您可能不想在此处制作克隆或防御性副本。通过返回您的 Map 以使其无法修改，您可以保护您的内部状态不被另一个类修改。

由于许多原因，`clone()`往往不是正确的解决方案。一些更好的解决方案是：

1.  对于吸气剂：
    1.  与其返回 a `Map`，不如仅`Iterator`将 s 返回到 the`keySet`或 the`Map.Entry`或任何允许客户端代码执行其需要执行的操作。换句话说，返回本质上是您内部状态的只读视图的内容，或者
    2.  返回包装在不可变包装器中的可变状态对象，类似于`Collections.unmodifiableMap()`
    3.  与其返回 a ，不如`Map`提供一个`get`方法，该方法接受一个键并从映射中返回相应的值。如果所有客户都想`Map`从中获取价值，那么不要给客户`Map`本身；相反，提供一个包装`Map`'`get()`方法的 getter。
2.  对于构造函数：
    1.  在对象构造函数中使用复制构造函数来复制传入的任何可变内容。
    2.  尽可能设计为将不可变数量作为构造函数参数，而不是可变数量。例如，有时将 long 返回的`new Date().getTime()`值比`Date`对象更有意义。
    3.  尽可能多地利用您的状态`final`，但请记住，`final`对象仍然可以是可变的，并且`final`数组仍然可以修改。

在所有情况下，如果有关于谁“拥有”可变状态的问题，请将其记录在 getter 或 setter 或构造函数上。在某处记录它。

这是一个糟糕代码的简单示例：

```
import java.util.Date;

public class Test {
  public static void main(String[] args) {
    Date now = new Date();
    Thread t1 = new Thread(new MyRunnable(now, 500));
    t1.start();
    try { Thread.sleep(250); } catch (InterruptedException e) { }
    now.setTime(new Date().getTime());   // BAD!  Mutating our Date!
    Thread t2 = new Thread(new MyRunnable(now, 500));
    t2.start();
  }

  static public class MyRunnable implements Runnable {
    private final Date date;
    private final int  count;

    public MyRunnable(final Date date, final int count) {
      this.date  = date;
      this.count = count;
    }

    public void run() {
      try { Thread.sleep(count); } catch (InterruptedException e) { }
      long time = new Date().getTime() - date.getTime();
      System.out.println("Runtime = " + time);
    }
  }
} 
```

您*应该*看到每个可运行文件都休眠了 500 毫秒，但是您得到了错误的时间信息。如果您更改构造函数以制作防御性副本：

```
 public MyRunnable(final Date date, final int count) {
      this.date  = new Date(date.getTime());
      this.count = count;
    } 
```

然后你得到正确的时间信息。这是一个简单的例子。您不想调试复杂的示例。

注意：未能正确管理状态的*常见*`ConcurrentModificationException`结果是迭代集合时。

你应该防御性地编码吗？如果你能**保证**同样的专家程序员团队永远是编写和维护你的项目的人，他们会不断地工作，这样他们就可以记住项目的细节，同样的人会为它工作项目的生命周期，并且项目永远不会变得“大”，那么也许你可以不这样做。但是除了极少数情况外，防御性编程的成本并不高——而且收益很大。另外：防御性编码是一个好习惯。您不想鼓励养成将可变数据传递到不应该有它的地方的坏习惯。这*将*有一天咬你。当然，所有这些都取决于项目所需的正常运行时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T15:28:49.197

对于这两个问题，重点是对状态的显式控制。可能大多数时候你可以不去想这些事情就“脱身”。随着您的应用程序变得越来越大，并且越来越难以推理状态以及它如何在对象之间传播，这往往不太正确。

您已经提到了您需要对此进行控制的一个主要原因 - 能够在另一个线程访问数据时安全地使用数据。也很容易犯这样的错误：

```
class A {
   Map myMap;
}

class B {
   Map myMap;
   public B(A a)
   {
        myMap = A.getMap();//returns ref to A's myMap
   }
    public void process (){ // call this and you inadvertently destroy a
           ... do somethign destructive to the b.myMap... 
     }
} 
```

关键不是你总是想克隆，那将是愚蠢和昂贵的。关键是不要笼统地声明这种事情何时合适。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T19:37:43.047

我可以想到克隆比复制构造函数更可取的一种情况。如果您有一个函数接受 X 类型的对象，然后返回它的修改副本，如果您想保留内部的非 X 相关信息，则该副本可能是一个克隆可能更好。例如，一个将 a 增加`Date`5 小时的函数可能很有用，即使它传递了一个类型为 的对象`SpecialDate`。也就是说，很多时候使用组合而不是继承可以完全避免这些问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T15:57:31.627

我使用 Clone() 在用户会话中保存对象状态，以允许在编辑期间撤消。我也在单元测试中使用过它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-08T23:13:59.073

我已经开始使用以下做法：

1.  在您的类中创建复制构造函数，但要保护它们。原因是使用 new 运算符创建对象可能会在使用派生对象时导致各种问题。

2.  创建一个Copyable接口如下：

```
     公共接口可复制<T> {
            公共T复制（）；
     }

```

让实现 Copyable 的类的复制方法调用受保护的复制构造函数。然后派生类可以调用 super.Xxx(obj_to_copy); 利用基类复制构造函数并根据需要添加其他功能。

[Java 支持协变返回类型](http://www.coderanch.com/t/381760/Java-General/java/Benefits-covariant-return-types)这一事实使这项工作得以实现。派生类只需适当地实现 copy() 方法，并为其特定类返回一个类型安全的值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-29T19:27:32.990

我不喜欢 clone() 方法，因为总是需要类型转换。出于这个原因，我大部分时间都使用复制构造函数。它更清楚地说明了它的作用（新对象），并且您可以很好地控制它的行为方式或副本的深度。

在我的工作中，我们不担心防御性编程，尽管这是一个坏习惯。但大多数时候一切正常，但我想我会仔细看看。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-07T08:45:04.993

在“防御性副本讨论”中，我总是缺少一件事是性能方面。恕我直言，这是性能与可读性/安全性/健壮性的完美示例。

防御副本非常适合稳健的颂歌。但是，如果您在应用程序的时间关键部分使用它，它可能是一个主要的性能问题。我们最近进行了这个讨论，其中数据向量将其数据存储在 double[] 值中。getValues() 返回 values.clone()。在我们的算法中，为*许多*不同的对象调用了 getValues()。当我们想知道为什么这段简单的代码需要这么长时间执行时，我们检查了代码 - 用返回值替换了 return values.clone()，突然我们的总执行时间降低到不到原来的 1/10价值。好吧 - 我不需要说我们选择跳过防守。

注意：我不是一般的防御副本。但是在 clone() 时使用你的大脑！

# asp.net - ASP.NET 将 <% =i %> 插入

> ID：926424
> 
> 赞同：0
> 
> 时间：2009-05-29T14:56:16.847
> 
> 标签：asp.net, vb.net

我怎样才能附加这个

```
<% =i %> 
```

变量到此。

```
<asp:DropDownList ID="AdTitle" runat="server"> 
```

由于某种原因不能有这个。

```
<asp:DropDownList ID="AdTitle<% =i %>" runat="server"> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T15:02:11.327

你的“我”从何而来？

*   如果它是固定或硬编码循环的一部分，您真的应该列出每个控件。如果有足够多的这些使这变得非常麻烦，那么您应该以某种方式驱动这些数据。
*   如果它是数据驱动的，您可能需要一个中继器控件。
*   如果它是从配置文件中提取的，请在表单上放置一个占位符并在您的代码隐藏中动态创建控件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T15:15:28.303

您不需要以这种方式动态生成 id。

使用中继器（或任何其他带有项目模板的重复控件）：

```
<asp:Repeater ID="forEachItem" runat="server">
    <ItemTemplate>
        <asp:DropDownList ID="AdTitle" runat="server" />
        <%!-- any other content per item --%>
    </ItemTemplate>
</asp:Repeater> 
```

或生成您的控件服务器端：

```
<asp:PlaceHolder ID="ph" runat="server" />

<%
    //...
    ph.Controls.Add( new DropDownList { Id = "AdTitle" + i } );
    //...
%> 
```

如果您使用中继器，请确保您使用数据绑定 ( `<%#`) 而不是文字 ( `<%=`)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T14:58:35.780

是否有多个 DropDownList？你提前知道有多少吗？如果是这样，您可以提前设置 id。如果没有，您可以即时创建控件并为它们提供您想要的任何 iD。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T15:04:22.337

```
<asp:DropDownList ID="AdTitle<% =i %>" runat="server"> 
```

和

```
<asp:DropDownList ID='<= "AddTitle" + i %>' runat="server"> 
```

由于 asp.net 处理和呈现 html 的顺序，将无法正常工作。你可以用一个简单的方法做到这一点`<select id='AddTitle<%=id%>'>`

但是你不能用 asp.net 控件来做到这一点

无论如何，您都不允许动态设置用户和服务器控件对象的 ID，因为它们用于将控件标识到服务器上的代码隐藏页面

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T15:21:20.977

If you *really* need to do something like this, you'll need to use an Expression Builder because of the way that the ASP.net engine parses the markup. I wrote a [blog posting about them](http://www.robertwray.co.uk/blog/2009/05/aspnet-expression-builders.html) a while ago and there's some good links at the top. Possibly the most useful of them is the one going to [4GuysFromRolla.com](http://www.4guysfromrolla.com/articles/030409-1.aspx).

I would add that the other suggestions here are almost certainly better ways of doing what you want to do, unless you have a very very specific reason for wanting to do it this way, which you've said you don't =)

# windows - \Windows\ 与 \Windows\System32 - 文件位置约定

> ID：926425
> 
> 赞同：3
> 
> 时间：2009-05-29T14:56:17.187
> 
> 标签：windows, directory, conventions, system32

对于进入 \Windows\ 的文件类型与进入 \Windows\System32 的文件类型是否有标准约定？

我正在开发一个具有各种 DLL、帮助程序 exe 和 Windows 服务 exe 的 SDK。之前编写代码的人将两个 exe 文件放在 \Windows\ 中，将 DLL 放在 \Windows\System32\ 中，但在我看来，它们应该都应该放在 \Windows\System32\ 中

你会做什么？

**编辑：** ~~我并不是要讨论他们是否应该去那里的优点。大量的应用程序将东西安装到 System32 ......尤其是服务或驱动程序（我正在处理这两者）。当然，我并不是说它是正确的......正如我所说，我最初并没有创建这个......为了这个问题。如果这些是你唯一的选择……那会去哪里？~~

**编辑：**好的，点了。我真的不认为我能够说服该项目的“架构师”将它们移出这两个目录中的任何一个......但在这一点上，我会更加努力。同意...不应将任何内容放入这些文件夹中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T15:05:53.910

他们也不应该进去！您的应用程序文件在您的应用程序目录中，而不是在任何情况下的 Windows 目录中 - 这些是供操作系统使用的，而不是您。

而且，您的应用程序是否正在安装可执行文件、DLL、驱动程序、字体、配置文件等等都无关紧要。它们不在 Windows 目录中。一些设计不良和编写不良的应用程序确实安装了一些东西，这一事实没有任何理由。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T15:04:37.950

我会将文件放在它们所属的 Program Files 下。Windows 和 Windows\System32 仅供操作系统使用。

# silverlight - 您可以在 SilverLight 3 中制作 3d 产品模型吗？

> ID：926429
> 
> 赞同：3
> 
> 时间：2009-05-29T14:56:45.707
> 
> 标签：silverlight, 3d, viewport

一段时间以来，我一直在使用 ViewPoint 制作 3d 模型，但我对将这些模型转移到 Silverlight 的前景很感兴趣。我有很好的 asp.net 经验，但从未创建过 Silverlight 应用程序。有没有关于在 Silverlight 3 beta 中创建 3d 模型的好教程？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-30T12:03:44.910

请参阅 Reed 的回答 - [Kit3D](http://kit3d.codeplex.com/)是您最好的选择（无论是 Silverlight 2.0*还是*3.0） - 查看[一些](http://sildev.net/3DCubes/index.html) [示例](http://www.markdawson.org/Kit3D/)。

如果您阅读过有关*“Silverlight 3.0 的新 3D 功能”的信息*，它实际上并不是一个完整的 3D 系统（a-la WPF），而是一种（基本上）“在 3D 空间中渲染平面”的新型 Transform .

它被称为**PlaneProjection**并让你做这样[的](http://conceptdev.blogspot.com/2009/05/silverlight-maps-that-bend-upwards.html)事情和[this](http://conceptdev.blogspot.com/2009/04/silverlight-30-planeprojection.html)。它非常适合翻转东西（如旋转木马控件）和类似效果（还实现了需要将深度缩放图像定位在“3D”中的 Photosynth），但不能真正渲染 3D 模型。

如果你决定玩 Kit3D（或 WPF 的 3D 东西），[Charles Petzold](http://www.charlespetzold.com/3D/)的书真的帮助我理解了这一切的基础......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:11:28.453

You can do this, even in Silverlight 2, using the [Kit3D engine](http://kit3d.codeplex.com/) for Silverlight.

This library provides Silverlight with a 3D engine very similar to WPF's Media3D tools.

# ruby-on-rails - 使用 Ext JS 作为前端并需要压缩脚本的 Rails 应用程序

> ID：926436
> 
> 赞同：0
> 
> 时间：2009-05-29T14:57:42.363
> 
> 标签：ruby-on-rails, caching, compression, extjs

我有一个使用 Ext JS 作为前端的 rails 应用程序。我在运行应用程序时没有问题。但由于 ext-all.js 体积庞大，加载需要更多时间。我尝试构建一个自定义 Ext JS，但这并没有对 Ext JS 脚本的大小产生太大影响。

自从我使用 Rails 2.x 以来，我一直在尝试使用 Rails 缓存。对于普通的 java 脚本文件，缓存没有问题，但是对于 Ext JS 脚本，它会加载，但我得到一些 DOM 对象错误，例如：`Ext is not defined`. 我正在寻找的是 Ext JS 脚本的压缩版本或一些 gzip 模式。我尝试了谷歌搜索并找到了各种尝试压缩的选项。但我还没有破解它。

谁能提供一些关于如何解决压缩问题的指示？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-11-07T20:24:03.267

It's actually a configuration of your web server. You should use something like this for Apache:

```
FileETag MTime
ExpiresActive On
ExpiresDefault "access plus 30 days"
AddOutputFilterByType DEFLATE text/html application/javascript text/javascript text/css 
```

It'll make sure that these assets are compressed and unless specified otherwise - cacheable for 30 days.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T03:01:42.373

此处解释了用于自定义构建的各种特定于 Ext 的选项：

[http://extjs.com/learn/Tutorial:Building_Ext_From_Source](http://extjs.com/learn/Tutorial:Building_Ext_From_Source)

对于压缩有很多选择。YUICompressor 是目前最好的之一。不确定“gzip 模式”是什么意思。Gzip 是一个应在 Web 服务器级别启用的选项，与 Ext 或 JavaScript 无关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-06T08:22:42.903

ExtJs 的大小并不比大多数现代网站大多少（如果有的话）。它与您的脚本一起小于 1MB。而且它只加载一次。我认为，以目前的网络速度，它对客户几乎没有影响。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T09:32:36.857

Ext 已经在生产文件中被缩小了，所以进一步缩小是徒劳的，你应该只缩小你自己的脚本。

您可以查看 CacheFly，它可以更快地为您的客户提供 Ext，因为它是分布式的。

唯一的其他选择确实是在 Apache 等中使用 mod_gzip 进行 HTTP 请求级压缩。

# database - 有没有办法在 Oracle SQL Developer 中查看关系？

> ID：926437
> 
> 赞同：14
> 
> 时间：2009-05-29T14:57:46.607
> 
> 标签：database, oracle

我想查找哪些表与特定表相关。我可以很容易地看到所有外键约束，但是我正在查看的表是主键表而另一个表是引用表的表呢？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2013-03-27T17:34:43.527

SQL Developer 中的步骤

*   转到`View`> `Data Modeler`>`Browser`打开`Browser`视图/选项卡。
*   （`Browser`查看/选项卡*）右键单击`Relational Models`并选择`New Relational Model`打开一个新窗口。

`Connections`这应该创建一个新的空白图表，可以将表格从视图拖放到图表中。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-29T15:21:58.307

目前尚不清楚您是否正在寻找 GUI 解决方案，但您可以通过以下方式从字典中查询信息：

```
select table_name from user_constraints
where r_constraint_name in
  (select constraint_name 
     from user_constraints
     where constraint_type in ('P','U')
     and table_name = upper('&tableOfInterest')
  ) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T15:00:04.357

请参阅 Oracle SQL Developer 数据建模器：[http ://www.oracle.com/technetwork/developer-tools/datamodeler/overview/index.html](http://www.oracle.com/technetwork/developer-tools/datamodeler/overview/index.html)

# c# - 将所有 aspx 文件从本地编码切换为 utf-8

> ID：926442
> 
> 赞同：1
> 
> 时间：2009-05-29T14:58:46.763
> 
> 标签：c#, asp.net, windows, iis, utf-8

如何使用 utf-8 将所有文件保存在目录中？

需要更改 IIS 中的默认文件编码以正确显示所有外来字符。问题是：所有旧文件都以（不同/随机）编码保存。

有没有办法打开（当前）并将所有这些文件安全地保存到 UTF-8？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:12:49.777

如果您使用的是 Visual Studio 2005 或 2008，您可以使用 File -> Advanced Save Options 更改保存文件的编码。您可能需要为每个文件执行此操作（尽管您可能只对具有国际化内容的文件执行此操作）。

也就是说 - 确保当您将 HTML 呈现给用户的浏览器时，您在头部设置了带有元标记的编码类型。具体的标签将是：

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:03:21.013

如果文件是文本文件，那么您可以使用重载的 System.IO.File.WriteAllText() 方法并传递 UTF-8 编码类型。这应该够了吧

# wpf - 如何将两个附加行为附加到一个 XAML 元素？

> ID：926451
> 
> 赞同：0
> 
> 时间：2009-05-29T15:00:00.643
> 
> 标签：wpf, mvvm, attachedbehaviors

我已经实现了[在此处找到的附加命令行为模式](http://marlongrech.wordpress.com/2008/12/13/attachedcommandbehavior-v2-aka-acb/)，它**可以很好**地允许边框具有在 ViewModel 中触发的左键或右键单击事件：

**XAML：**

```
<Border Background="Yellow" Width="350" Margin="0,0,10,0" Height="35" CornerRadius="2"
        c:CommandBehavior.Event="MouseLeftButtonDown" 
        c:CommandBehavior.Command="{Binding PressedLeftButton}"
        c:CommandBehavior.CommandParameter="MainBorder123">
    <TextBlock Text="this is the click area"/>
</Border> 
```

**代码背后：**

```
public ICommand PressedLeftButton { get; private set; }

public MainViewModel()
{

    Output = "original value";

    PressedLeftButton = new SimpleCommand
    {
        ExecuteDelegate = parameterValue => {
            Output = String.Format("left mouse button was pressed at {0} and sent the parameter value \"{1}\"", DateTime.Now.ToString(), parameterValue.ToString());
        }
    };
} 
```

但是，**如何将两个附加行为附加到一个元素**，例如，我想做类似以下的事情，但它当然会给我一个错误：

```
<Border Background="Yellow" Width="350" Margin="0,0,10,0" Height="35" CornerRadius="2"
        c:CommandBehavior.Event="MouseLeftButtonDown" 
        c:CommandBehavior.Command="{Binding PressedLeftButton}"
        c:CommandBehavior.CommandParameter="MainBorder123"
        c:CommandBehavior.Event="MouseRightButtonDown" 
        c:CommandBehavior.Command="{Binding PressedRighttButton}"
        c:CommandBehavior.CommandParameter="MainBorder123"
        > 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T15:09:00.330

您发送的链接包含那个答案。您可以使用 ACB v2 中的 CommandBehaviorCollection.Behaviors 功能。

```
 <Border Background="Yellow" Width="350" Margin="0,0,10,0" Height="35" CornerRadius="2" x:Name="test">
       <local:CommandBehaviorCollection.Behaviors>
               <local:BehaviorBinding Event="MouseLeftButtonDown" Action="{Binding DoSomething}" CommandParameter="An Action on MouseLeftButtonDown"/>
               <local:BehaviorBinding Event="MouseRightButtonDown" Command="{Binding SomeCommand}" CommandParameter="A Command on MouseRightButtonDown"/>
       </local:CommandBehaviorCollection.Behaviors>
       <TextBlock Text="MouseDown on this border to execute the command"/>
   </Border> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-29T16:16:08.543

“就是这样，谢谢，虽然我的 XAML 编辑器给了我错误“在类型 'CommandBehaviorCollection' 中找不到可附加属性 'Behaviors'。”虽然我可以运行和编译它，但很有趣，这是为什么呢？

原因是允许命令行为集合（它是一个附加的属性*集合*）的代码实际上是一种 XAML 漏洞。您可以在这里阅读更多相关信息： [http ://wekempf.spaces.live.com/blog/cns!D18C3EC06EA971CF!468.entry?sa=276442122](http://wekempf.spaces.live.com/blog/cns!D18C3EC06EA971CF!468.entry?sa=276442122)

# c# - 在 C# 中解析 Excel 文件时，单元格似乎在 255 个字符处被截断......我该如何阻止它？

> ID：926453
> 
> 赞同：17
> 
> 时间：2009-05-29T15:00:04.683
> 
> 标签：c#, linq, excel, excel-2007, xlsx

我正在使用 c# 在 asp.net 中解析上传的 excel 文件（xlsx）。我正在使用以下代码（简化）：

```
string connString = string.Format("Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileLocation + ";Extended Properties=\"Excel 12.0 Xml;HDR=YES\";");
OleDbDataAdapter adapter = new OleDbDataAdapter("SELECT * FROM [Sheet1$]", connString);
DataSet ds = new DataSet();
adapter.Fill(ds);
adapter.Dispose();
DataTable dt = ds.Tables[0];
var rows = from p in dt.AsEnumerable() select new { desc = p[2] }; 
```

这很好用，*但*如果单元格中的字符超过 255 个，它将被截断。知道我做错了什么吗？谢谢你。

编辑：查看 excel 表格时，它显示的字符数超过 255 个，所以我不相信表格本身是有限的。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-09-27T17:41:37.067

## 解决方案！

我今天也一直在和这个作斗争。我终于通过在解析 Excel 电子表格之前修改了一些注册表项来让它工作。

在解析 Excel 电子表格之前，您必须更新此注册表项：

```
// Excel 2010
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\14.0\Access Connectivity Engine\Engines\Excel\
or
HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Office\14.0\Access Connectivity Engine\Engines\Excel\

// Excel 2007
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\12.0\Access Connectivity Engine\Engines\Excel\

// Excel 2003
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Excel\ 
```

在此键下更改为`TypeGuessRows`和`0`。您还需要更新连接字符串以包含在扩展属性中：`ImportMixedTypes``Text``IMEX=1`

```
string connString = string.Format("Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileLocation + ";Extended Properties=\"Excel 12.0 Xml;HDR=YES;IMEX=1\";"); 
```

* * *

## 参考

[http://blogs.vertigo.com/personal/aanttila/Blog/archive/2008/03/28/excel-and-csv-reference.aspx](http://blogs.vertigo.com/personal/aanttila/Blog/archive/2008/03/28/excel-and-csv-reference.aspx)

[http://msdn.microsoft.com/en-us/library/ms141683.aspx](http://msdn.microsoft.com/en-us/library/ms141683.aspx)

> ...字符可能会被截断。**要在不截断的情况下从备注列导入数据，您必须确保至少有一个采样行中的备注列包含超过 255 个字符的值，或者您必须增加驱动程序采样的行数以包含这样的排。**您可以通过增加 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Excel 注册表项下的 TypeGuessRows 的值来增加采样的行数。...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-09-18T21:01:08.470

我遇到了这个问题，对我有用的解决方案是将带有长文本的单元格移动到电子表格的顶部。

我在描述该问题的论坛中找到了此评论

> 这是 Jet OLEDB 提供程序的问题。它查看电子表格的前**8 行**
> 以确定每列中的数据类型。如果该列
> 在前**8 行**中不包含超过 256 个字符的字段值，则假定
> 数据类型为文本，其字符数限制为 256。以下 KB 文章
> 对此问题有更多信息：[http:// support.microsoft.com/kb/281517](http://support.microsoft.com/kb/281517)

希望这对其他人有帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T15:06:15.797

您是否尝试将列数据类型设置为电子表格中的文本？我相信这样做将使单元格包含超过 255 个字符。

[[编辑] 与 MS-Excel 团队的对话](http://blogs.msdn.com/excel/archive/2005/09/26/474258.aspx)值得一读。在底部的评论部分，他们就 255 截止值进行了一些讨论。他们说 Excel 12 可以支持每个单元格 32k 个字符。

如果这是真的，那么必须有一种方法可以获取这些数据。这里有两点需要考虑。

1.  过去，我在连接字符串中使用了“IMEX=1”选项来处理包含显示为空的混合数据的列。这是一个远射，但你可以尝试一下。

2.  您可以将文件导出到制表符分隔的平面文件吗？恕我直言，这是处理 Excel 数据的最可靠方法，因为 Excel 确实有很多陷阱。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T15:02:15.367

仅通过对该主题的快速谷歌搜索，这似乎是 Excel 的限制。

**编辑**：[可能的解决方法（不幸的是在 VB 中）](http://support.microsoft.com/kb/213841)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T16:35:29.110

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)可以读取和写入（以及更多）xls 和 xlsx 工作簿，并支持与 Excel 文本相同的限制 - 换句话说，它可以正常工作。如果您想尝试一下，可以免费评估。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-03T15:40:56.993

关于上一篇文章，我还使用了 SpreadsheetGear，发现从旧的 XLS（不是 XLSX）格式读取时，它也受到每个单元格 255 个字符的限制。

# perl - 为什么我用 Perl 的 LWP 下载的图像给了我错误大小的文件？

> ID：926457
> 
> 赞同：7
> 
> 时间：2009-05-29T15:01:24.540
> 
> 标签：perl, image, lwp

我正在尝试使用 Perl 从 HTTP 服务器获取图像。

我有文件的完整 URL 并尝试使用

```
my $data = LWP::Simple::get $params{URL};
my $filename = "image.jpg";
open (FH, ">$filename");
print FH $data;
close (FH); 
```

现在，从逻辑上讲，至少对我来说，这应该可行。但是文件的大小略有不同，我不知道为什么。

帮助！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-29T15:06:37.057

您需要使用[`binmode`](http://perldoc.perl.org/functions/binmode.html)正确地将图像数据写入磁盘。

```
my $data = LWP::Simple::get $params{URL};
my $filename = "image.jpg";
open (FH, ">$filename");
binmode (FH);
print FH $data;
close (FH); 
```

否则它将被解释为文本，并且换行符会被删除。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-29T15:14:07.463

戴夫是对的，您应该/必须将文件句柄设置为二进制模式。但是你可以一次性完成所有这些：

```
LWP::Simple::getstore( $params{URL}, 'image.jpg' ); 
```

# php - mysql_query doesn't work in IIS - alternative?

> ID：926461
> 
> 赞同：0
> 
> 时间：2009-05-29T15:01:57.397
> 
> 标签：php, mysql, iis

I'm using PHP in a Windows/IIS environment and found this db related code not to work:

```
$result = mysql_query("SELECT * FROM users WHERE id=12); 
```

So is there an alternative to mysql_query?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T15:04:38.310

$result = mysql_query("SELECT * FROM users WHERE id=12"); // missing " at the end of query ?

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-19T18:40:03.000

我也遇到了同样的问题。我可以使用 mysql_select_db 选择正确的架构，然后在下一行 mysql_query 抛出 500 服务器错误，而没有在 php 错误日志中添加任何内容。错误报告也被提升到 E_ALL ......

我能够使用相同的凭据连接到数据库并运行查询并返回记录。这真的很烦人，因为它昨晚工作，现在早上第一次尝试不工作。

*编辑：* 好的，所以我顿悟了，原来我使用的数据库抽象库（元数据库）在连接到 MySQL 时使用了持久连接。我切换了配置，以便它使用 mysql_connect 而不是 mysql_pconnect 进行连接，并且一切正常。如果你没有使用 mysql_pconnect，不要忘记 mysql_connect 中的第四个参数 new_link 来强制建立新的连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-31T01:07:46.680

可能未加载 php_mysql 库。您需要确保 php_mysql.dll 正在加载到 php.ini 文件中，通常如下所示：

```
extension=php_mysql.dll 
```

# sql-server - 在触发器或过程中测试链接服务器连接

> ID：926467
> 
> 赞同：1
> 
> 时间：2009-05-29T15:04:21.087
> 
> 标签：sql-server, stored-procedures, triggers, linked-server

我写了一个触发器来更新链接服务器上的本地表和类似表。

`CREATE TRIGGER myTtableUpdate ON myTable
AFTER UPDATE AS
IF (COLUMNS_UPDATED() > 0)
BEGIN
DECLARE @retval int;
BEGIN TRY
EXEC @retval = sys.sp_testlinkedserver N'my_linked_server';
END TRY
BEGIN CATCH
SET @retval = sign(@@error);
END CATCH;`

`IF (@retval = 0)
BEGIN
UPDATE remoteTable SET remoteTable.datafield = i.datafield
FROM my_linked_server.remote_database.dbo.myTable remoteTable
INNER JOIN inserted i ON (remoteTable.id = i.id)
END
END -- end of trigger`

不幸的是，当连接断开时，我收到错误消息
*'Msg 3616，Level 16，State 1，Line*
*2''Transaction 在触发器中注定失败。Batch has been aborted'*
并回滚本地制作的更新。

有没有办法维护这个错误并保持本地更新？
请注意，我在运行 Windows XP Pro 的两台 PC 上都使用 SQL Server 2005 Express Edition。

编辑 1：SQL 服务器是 Express 版 编辑 2
：两台 PC 都运行 Windows XP Pro，所以这些不是服务器

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:16:06.307

不要在触发器中写入远程服务器。

*   创建一个本地表来存储需要推送到远程服务器的行
*   在触发器中插入这个新的本地表
*   创建一个每 N 分钟运行一次的作业，以从该本地表插入远程服务器。

该作业可以运行一个可以测试连接的过程，当它备份时，它将处理新本地表中的所有行。它可以这样处理本地表中的行：

```
declare @OutputTable table (RowID int not null)

insert into my_linked_server.remote_database.dbo.myTable remoteTable(...columns...)
    OUTPUT INSERTED.RowID
    INTO @OutputTable
    SELECT ...columns...
        from NewLocalTable

delete NewLocalTable
   from NewLocalTable           n
       inner join @OutputTable  o ON n.RowID=o.RowID 
```

**插入到这个新的本地表后，基于 EDIT 的 OP 注释**
从触发器（sp_start_job）启动作业，它将在自己的范围内运行。如果不能使用 sql server 作业，请使用 xp_cmdshell 执行存储过程（查找 SQLCMD 或 ISQL 或 OSQL，我不确定你有什么）。仍然每 N 分钟安排一次作业，所以它最终会在连接建立时运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:59:35.683

至少有一台服务器是 Workgroup 版本或更高版本吗？您可以使用 Service Broker 来发送您的记录而不是链接服务器，但由于许可限制，它无法在 Express 版本之间工作。是一个完全依赖 SQL 的解决方案，在发生事件时提供可靠性（其中一个服务器不可用），并且您的更新将实时传播（一旦提交）。我的网站有很多关于如何做到这一点的示例，您可以从这篇文章开始，[了解如何实现高消息吞吐量](http://rusanu.com/2007/04/25/reusing-conversations/)。

# wpf - WPF: How do I allow scrolling with the mouse wheel in a ListView while dragging ListView items?

> ID：926471
> 
> 赞同：8
> 
> 时间：2009-05-29T15:05:02.273
> 
> 标签：wpf, listview, drag-and-drop, mousewheel

I have implemented drag and drop in a `ListView` in my WPF application. Items can be dragged and dropped inside the `ListView`, and also into a `TreeView` that is beside the `ListView`.

Currently, I have it set up so that when you drag to the bottom of the `ListView`, it automatically scrolls down the list.

What I'd like to know is if there's any way to be able to scroll through the `ListView` with the mouse wheel while I'm dragging its items? It seems like the mouse wheel events aren't being fired while I'm dragging.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-09-13T10:49:54.447

1.  在之前创建（并启动）鼠标钩子助手`DragDrop.DoDragDrop(...)`
2.  分析鼠标滚轮（+检查鼠标是否在控制上）
3.  `DoDragDrop()`操作后停止（处置）鼠标钩子助手

注意：总是停止鼠标钩子助手，因为它可以在关闭窗口时冻结应用程序（我在 XP 上看到它）。

[在这里](http://codekea.com/ZnbQOBz1dgXQ/global-mouse-hook-in-wpf-c.html)你可以找到一个 MouseHook，采用它（我发现了 bug :)）或类似的东西。

# asp.net - ASP.net 页面上的表单标签

> ID：926481
> 
> 赞同：6
> 
> 时间：2009-05-29T15:07:00.927
> 
> 标签：asp.net

我有一个 Web 应用程序，它有一个从数据库加载内容的页面。我希望能够在动态内容中放置一个表单，但是.net 不允许内部表单执行它的操作。有没有办法允许这种或其他方式我可以在动态内容页面上获取表单？

- 编辑 -

我想我需要澄清一些事情。这是一个从数据库加载内容的 aspx 页面。据我所知，我从数据库中提取并粘贴在标签中的文本从未由 .net wp 编译或处理，因此我无法使用后面的代码来解决此问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T15:18:26.520

这是一个常见问题，当您希望将非回发表单发送到第三方网站（例如 PayPal 按钮）时。

出现此问题的原因是 HTML 不允许您在表单中包含表单，并且大多数 ASP.NET 页面`<form runat="server" />`在 HTML（或母版页）中都有“高位”。

我最喜欢的解决方案是隐藏“high up”表单标签，同时仍然显示所有内容。然后，您可以随意在正文中转储您想要的任何标签。如果您动态执行此操作，您可以逐页选择哪些页面具有自定义表单。

我创建了一个名为 GhostForm.cs 的类来处理这个问题。你可以在这里读到所有和它有关的：

[http://jerschneid.blogspot.com/2007/03/hide-form-tag-but-leave-content.html](http://jerschneid.blogspot.com/2007/03/hide-form-tag-but-leave-content.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-29T15:09:31.013

页面上只能有一个表单（asp表单）；您必须以某种方式使用该表格。

澄清一下，只能处理一种表格。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T15:08:50.813

不使用网络表单，不。您必须使用连接到 的事件处理程序在一个完整的页面表单中`Button`工作`LinkButton`。幸运的是，这很容易做到：

foo.aspx：

```
...
<asp:TextBox id="txtFoo" runat="server" />
<asp:Button id="btnFoo" runat="server" onclick="btnFoo_Click />
... 
```

foo.aspx.cs：

```
...
protected void btnFoo_Click(object sender, EventArgs e)
{
    string s = txtFoo.Text;
    // do something with s
}
... 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T15:22:42.703

Dino Esposito 有一篇来自 MSDN 杂志的文章，其中涵盖了在 ASP.Net 中处理多个表单或“模拟”子表单，这可能会回答您的所有问题。

[http://msdn.microsoft.com/en-us/magazine/cc164151.aspx](http://msdn.microsoft.com/en-us/magazine/cc164151.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-02-23T19:55:56.667

任何解决方法都将是 hacky 并且非常丑陋。按照设计，asp.net 使用表单标签来发布和获取数据。这就是他们称其为 Web 表单应用程序的原因。Html 不允许嵌套表单。您要做的是在后面的代码中使用 WebRequest 。

如果您正在尝试类似贝宝按钮的东西，您可以简单地使用类似这样的东西。

标记：

```
<div id="PayPalButtonContainer" runat="server"></div> 
```

代码背后：

```
 public static string GetPayPalButtonMarkup()
    {
        const string markup = @"https://www.paypal.com/cgi-bin/webscr
                                  ?cmd=_xclick&business={0}
                                  &item_name=Widget
                                  &amount={1}
                                  &currency_code=USD";
        return markup;
    }

    PayPalButtonContainer.InnerHtml = string.format(GetPayPalButtonMarkup,"YOUR PAYPAL USER NAME", "YOUR PRICE VALUE"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T15:11:47.780

您要么必须通过将服务器端单击事件处理程序添加到您想要成为“子表单”提交按钮的方式来处理回发（这是 Web 表单处理同一页面上的多个提交类型按钮的方式），或者做一些聪明的事情如果您不想要完整的回帖，请使用 AJAX

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-29T15:15:47.790

我以前遇到过这个问题。我所做的一种解决方法是将我希望执行操作的代码放在 asp:Panel 中。使用面板，您可以将“DefaultButton”的属性设置为面板内的按钮，单击该按钮（或按“Enter”）将触发该按钮的单击事件。当我有一个包含唯一允许的 asp:Form 的母版页时，当我想通过按 Enter 提交“表单”时，我发现这非常方便。

希望这可以帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-06-30T00:02:26.677

当我第一次遇到这个问题时，我发现对我来说最简单的解决方案是简单地复制和粘贴母版页并给它一个稍微不同的名称，例如：

```
SiteNameMasterPage      'Default page with FORM tag
SiteNameMasterPageNF    'No Form tag 
```

然后根据我是否想要一个 FORM 标签，只需更改我的内容页面顶部的母版页链接，就像这样

```
<%@ Page Title="" Language="VB" MasterPageFile="~/SiteName.master" %>
<%@ MasterType VirtualPath="~/SiteName.master" %>
<!-- This masterpage has the default FORM tag --> 
```

或者

```
<%@ Page Title="" Language="VB" MasterPageFile="~/SiteNameNF.master" %>
<%@ MasterType VirtualPath="~/SiteNameNF.master" %>
<!-- This masterpage does NOT have the default FORM tag --> 
```

然后在内容页面中，无论我想放置表单的任何地方，我都可以包含`<form>`标签

# redirect - Symfony 中的重定向和转发有什么区别？

> ID：926482
> 
> 赞同：19
> 
> 时间：2009-05-29T15:07:02.643
> 
> 标签：redirect, symfony1

我想知道两者之间的区别：

```
$this->forward("module", "action"); 
```

和

```
$this->redirect("module/action"); 
```

我的第一个猜测是一个暗示一个新的请求，而另一个不是，但我不确定。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-05-29T15:29:00.273

在某些情况下，动作执行通过请求新的动作执行而结束。例如，在`POST`请求中处理表单提交的操作通常会在更新数据库后重定向到另一个操作。另一个例子是动作别名：索引动作通常是一种显示列表的方式，实际上是转发到列表动作。

动作类提供了两种方法来执行另一个动作：

如果操作将调用转发到另一个操作：

```
$this->forward('otherModule', 'index'); 
```

如果操作导致 Web 重定向：

```
$this->redirect('otherModule/index');
$this->redirect('http://www.google.com/'); 
```

重定向或转发之间的选择有时很棘手。要选择最佳解决方案，请记住转发是应用程序内部的，对用户是透明的。就用户而言，显示的 URL 与请求的 URL 相同。相反，重定向是发送给用户浏览器的消息，涉及来自浏览器的新请求以及最终生成的 URL 的更改。

如果从带有 的提交表单中调用该操作`method="post"`，则应始终执行重定向。主要优点是如果用户刷新结果页面，表单将不会再次提交；此外，后退按钮通过显示表单而不是询问用户是否要重新提交`POST`请求的警报按预期工作。

# .net - WPF - 编译错误：模板部分不支持“PropertyArrayStart”类型的标签

> ID：926486
> 
> 赞同：26
> 
> 时间：2009-05-29T15:08:11.797
> 
> 标签：.net, wpf, xaml, compilation, dependency-properties

通常我不会只在 SO 上发布错误消息，但在 Google 搜索后只找到一个点击，我想我至少会在 SO 上为这个错误打开地板。

我有一个名为type`Sparkline`的依赖属性调用的自定义控件。这是我在 a 中使用它的示例：`Values``unit[]``DataTemplate`

```
<DataTemplate DataType="{x:Type Activity:ActivityHistory}">
    <Controls:Sparkline Grid.Column="1" Values="{Binding Path=Values}" />
</DataTemplate> 
```

此代码无法编译。我收到错误消息：

> *模板部分不支持“PropertyArrayStart”类型的标签。*

行/列编号表示`Values`属性的开始。

这真的把我扔了。在 Google 上搜索返回[了一个结果](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/66c0d61d-1a04-4933-9227-98cb7fb4bb71)，其中[John_C](http://social.msdn.microsoft.com/Forums/en-US/user?user=John_C)遇到了完全相同的问题。不幸的是，他的解决方案涉及将控件移动到单独的组件中。好吧，我的已经在一个单独的程序集中了。我的猜测是还有别的东西在起作用。

我从来没有听说过`PropertyArrayStart`。搜索仅返回与 XAML 序列化相关的几页。有趣的东西，但没有多大帮助。

想一想，我想不出框架中有任何具有数组类型的依赖属性。这是允许的吗？

我还尝试使用嵌套元素而不是`Binding`.

```
<DataTemplate DataType="{x:Type Activity:ActivityHistory}">
    <Controls:Sparkline Grid.Column="1">
        <Controls:Sparkline.Values>
            <Binding Path="Values"/>
        </Controls:Sparkline.Values>
    </Controls:Sparkline>
</DataTemplate> 
```

......仍然没有运气。

欢迎任何想法！

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-05-29T15:39:57.613

这是一个多事的 27 分钟... :)

将依赖属性的类型从更改`unit[]`为`IList<unit>`解决问题。最重要的是，它不需要太多代码更改，因为数组已经实现了该接口。

我不确定通过接口（callvirt）分派到数组是否更慢。我的猜测是肯定的。

原始错误消息暗示这里发生了一些我不太明白的事情。我会接受任何正确解释它的答案。

# c# - 如何在 .Net 中枚举 Windows 系统托盘中的对象？

> ID：926487
> 
> 赞同：2
> 
> 时间：2009-05-29T15:08:38.100
> 
> 标签：c#, .net, windows

我想监视 Windows 系统托盘的图标文本更改。

我怎样才能在 .Net 中最好在 C# 中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:23:08.833

这可以在 Windows API 中使用带有“Shell_TrayWnd”的 FindWindow 和 SendData。

要在 C# 中执行此操作，您需要 P/Invoke 到 Windows API。这是一组可用于移植的[C++ 示例代码。](http://www.codeproject.com/KB/applications/ShellTrayInfo.aspx)

# ruby-on-rails - Rails：宏样式函数

> ID：926489
> 
> 赞同：15
> 
> 时间：2009-05-29T15:09:00.110
> 
> 标签：ruby-on-rails

在模型和控制器中，我们经常在类定义之上使用 Rails 宏，如`before_validation`, 。`skip_before_filter`

这是如何实施的？如何添加自定义的？

谢谢！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-29T15:20:27.967

它们只是标准的 Ruby 函数。Ruby 灵活的语法方法使它看起来比实际更好。您可以通过将方法编写为普通的 Ruby 函数并执行以下操作之一来创建自己的方法：

1.  把它放在你的控制器可以访问的地方，比如 application.rb

2.  把它放在一个文件中并要求它。

3.  `include`通过 Ruby关键字将代码混合到一个类中。

最后一个选项非常适合模型类，而第一个选项实际上仅适用于控制器。

### 一个例子

第一种方法的示例如下所示。在此示例中，我们将代码添加到 ApplicationController 类（在 application.rb 中）并在其他控制器中使用它。

```
class BusinessEntitiesController < ApplicationController

    nested_within :Glossary

    private

        #  Standard controller code here .... 
```

nested_within*提供*辅助函数和变量来帮助识别“父”资源的 id。实际上，它会即时解析 URL，并且我们的每个控制器都可以访问。例如，当一个请求进入控制器时，它会被自动解析，并且类属性@parent_resource 被设置为 Rails 查找的结果。副作用是如果父资源不存在，则会发回“未找到”响应。这使我们免于在每个嵌套资源中键入样板代码。

这听起来很聪明，但它本质上只是一个标准的 Ruby 函数......

```
 def self.nested_within(resource)
        #
        #   Add a filter to the about-to-be-created method find_parent_id
        #
        before_filter :find_parent_id

        #
        #   Work out what the names of things
        #
        resource_name = "#{resource.to_s.tableize.singularize}"
        resource_id = "#{resource_name}_id"
        resource_path = "#{resource.to_s.tableize}_path"

        #
        #   Get a reference to the find method in the model layer
        #
        finder = instance_eval("#{resource}.method :find_#{resource_name}")

        #
        #   Create a new method which gets executed by the before_filter above
        #
        define_method(:find_parent_id) do
            @parent_resource = finder.call(params[resource_id])

            head :status => :not_found, :location => resource_path 
                    unless @parent_resource
        end
    end 
```

nested_within 函数在 ApplicationController (controllers/application.rb) 中定义，因此被自动拉入。

请注意，nested_within 在控制器类的主体内执行。这会将方法 find_parent_id 添加到控制器。

### 概括

Ruby 的灵活语法和 Rail 的约定优于配置的组合使这一切看起来比实际更强大（或更奇怪）。

下次你找到一个很酷的方法时，只需在它前面贴一个断点并跟踪它。啊开源！

让我知道我是否可以提供进一步的帮助，或者您是否需要有关该 nested_within 代码如何工作的一些指示。

克里斯

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-29T15:38:29.047

克里斯的回答是对的。但这里是你想抛出你的代码来编写你自己的地方：

添加这样的控制器方法的最简单方法是将其定义在`ApplicationController`：

```
class ApplicationController < ActionController::Base
  ...
  def self.acts_as_awesome
    do_awesome_things
  end
end 
```

然后你可以像这样从单个控制器访问它：

```
class AwesomeController < ApplicationController
  acts_as_awesome
end 
```

对于模型，您要重新打开`ActiveRecord::Base`：

```
module ActiveRecord
  class Base
    def self.acts_as_super_awesome
      do_more_awesome_stuff
    end
  end
end 
```

我个人会将它放在一个文件中，`config/initializers`以便它被加载一次，这样我就知道在哪里可以找到它。

然后你可以像这样在模型中访问它：

```
class MySuperAwesomeModel < ActiveRecord::Base
  acts_as_super_awesome
end 
```

# jquery - JQUERY：如何创建背景层并将新的 html 加载到前台？（模态形式如）

> ID：926498
> 
> 赞同：0
> 
> 时间：2009-05-29T15:09:41.233
> 
> 标签：jquery, modal-dialog

试图找到创建重叠/覆盖层以填充屏幕的最佳方法..然后在加载某些 html 时在顶部创建一个新层...

```
// Show popup - somehting like this..
$("#myBtn").click(function() {
    $("#myDiv").load("myHTMLcode.html");
}); 
```

然后我需要一种删除它的方法

任何想法，有没有一种简单的方法可以做到这一点，它类似于模态表单，除了我希望加载 html 而不是显示表单..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:18:58.140

查看以下一个或多个插件的源代码，它们以不同的方式实现您所谈论的内容，因此您应该有所了解 - 如果不这样做，您可以选择一个并使用它：

*   [块UI](http://malsup.com/jquery/block/)
*   [厚箱](http://jquery.com/demo/thickbox/)
*   [脸盒](https://github.com/defunkt/facebox)
*   [花式盒](http://fancy.klade.lv/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:21:56.950

我有理由确定您可以使用jQuery UI中的[对话框小部件来执行此操作。](http://docs.jquery.com/UI/API/1.7/Dialog)使用 open 事件处理程序挂钩提供一种在打开对话框时将 HTML 放入对话框容器的方法。

```
$('#dialogDiv').dialog({
    modal: true,
    autoOpen: false,
    buttons: { "Ok": function() { $(this).dialog("close"); },
    open: function(event,ui) {
             $(ui).find('#container').load( ... );
          }
});

$('#openButton').click( function() {
   $('#dialogdDiv').dialog('open');
}); 
```

如果需要提供 url，请考虑使用`data()`

```
$('#openButton').click( function() {
   $('#dialogdDiv').data('url','someurl').dialog('open');
});

open: function(event,ui) {
         $(ui).find('#container').load( $('#dialogDiv').data('url') );
      } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T15:12:01.883

$("#myDiv").html('');

# jquery - Jquery + 点击 + 图片交换 + IE6 = 我讨厌那个浏览器

> ID：926505
> 
> 赞同：1
> 
> 时间：2009-05-29T15:10:29.437
> 
> 标签：jquery, internet-explorer, internet-explorer-6

我在 IE6 中交换图像时遇到问题。在除那个之外的所有浏览器中都可以正常工作。

这是以下代码：

```
$(function() {
   $("#image1").click(function() {
       $(this).attr('src', '/v12/images/small/sm-wall-1-on.png');                    
       $('#image2').attr('src', '/v12/images/small/sm-wall-2.png');  
       $('#image3').attr('src', '/v12/images/small/sm-wall-3.png'); 
   });
 }); 
```

然后这里是 HTML

```
<li style="padding:3px;"><img id="image1" src="/v12/images/small/sm-wall-1-off.png" style="border:0px; width:95px; height:75px;" class="pngfix" alt=""  /></li>
<li style="padding:3px;"><img id="image2" src="/v12/images/small/sm-wall-2-selected.png" class="pngfix" style="border:0px; width:95px; height:75px;" class="pngfix" alt="" /></li>
<li style="padding:3px;"><img id="image3" src="/v12/images/small/sm-wall-3.png" class="pngfix" style="border:0px; width:95px; height:75px;" class="pngfix" alt=""  /></li> 
```

因此，基本上，如果我单击其中一张图像，我想将其他图像与我刚刚单击的图像一起换掉。一旦我执行点击，IE6 就会隐藏所有图像。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:15:30.753

谷歌是你的朋友：

[http://wolfram.kriesing.de/blog/index.php/2007/change-img-src-for-ie](http://wolfram.kriesing.de/blog/index.php/2007/change-img-src-for-ie)

这似乎是 IE 中广为人知的问题。

我的搜索词：即更改 img src

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:22:01.503

除了使用 img 标签，您可以使用包含 background-image 属性的 CSS 类的跨度，然后让您的点击功能只需更改类。

[基本上，与CSS Sprites](http://www.alistapart.com/articles/sprites/)的概念相同，但不是更改背景图像的位置，而是更改 URL。我之前在 IE6 中使用过它，它运行良好。

# .net - How can I get the PixelFormat of a Bitmap using .NET CF 2.0?

> ID：926507
> 
> 赞同：0
> 
> 时间：2009-05-29T15:10:57.517
> 
> 标签：.net, compact-framework, bitmap

I'm trying to speed up performance of some image scaling & coloring routines in a mobile app based on .Net compact framework 2.0\. I've discovered the Bitmap.LockBits method, but how can I get a Bitmap's PixelFormat when the PixelFormat property is not supported in the compact framework?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:19:08.920

[OpenNetCF 框架](http://www.opennetcf.com/Products/SmartDeviceFramework/tabid/65/Default.aspx)包含一个实现 PixelFormat 属性的 BitmapData 类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-25T09:06:35.717

这是一个添加 .netCF 默认不支持的内容的示例。您可以尝试相同的方法。

[http://blogs.msdn.com/chrislorton/archive/2006/04/07/570649.aspx](http://blogs.msdn.com/chrislorton/archive/2006/04/07/570649.aspx)

# java - 有哪些不同的 zlib 压缩方法以及如何在 Java 的 Deflater 中强制使用默认值？

> ID：926517
> 
> 赞同：3
> 
> 时间：2009-05-29T15:13:08.480
> 
> 标签：java, java-me, compression, zip, gzip

我正在使用 DeflaterOutputStream 将数据压缩为专有存档文件格式的一部分。然后我使用 jcraft zlib 代码在另一端解压缩该数据。另一端是 J2ME 应用程序，因此我依赖第三方 zip 解压缩代码而不是标准 Java 库。

我的问题是某些文件可以很好地压缩和解压缩，而其他文件则不能。

对于那些没有的，数据第一个字节中的压缩方法似乎是“5”。

从我对 zlib 的阅读中，我了解到默认值“8”表示默认的 deflate 压缩方法。解压器似乎无法接受任何其他值。

我想知道的是：

*   “5”代表什么？
*   为什么 DeflaterOutputStream 有时会使用不同的压缩方法？
*   我能以某种方式阻止它这样做吗？
*   是否有另一种方法可以生成仅使用默认压缩方法的压缩数据？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T17:36:54.303

这可能有助于准确地磨练您正在查看的内容。

在整个数据之前，通常有一个两字节的**ZLIB 标头**。据我所知，**这些第一个字节的低 4 位应始终为 8**。如果你在 nowrap 模式下初始化你的 Deflater，那么你根本不会得到这两个字节（尽管你的其他库必须期望不会得到它们）。

然后，在每个单独的数据块之前，有一个**3 位的块头**（注意，定义为*位数*，而不是字节的整数）。可以想象，您可以有一个以字节 5 开头的块，这表示压缩块是最终块，或者以字节 8 开头，这将是一个未压缩的非最终块。

创建 DeflaterOutputStream 时，可以将 Deflater 或您的选择传递给构造函数，在该 Defalter 上，您可以设置一些选项。该*级别*本质上是压缩在查找数据中的重复模式时使用的预读量；碰巧，您可以尝试将其设置为非默认值，看看它是否对您的解压缩器是否可以应付有任何影响。

策略设置（参见 setStrategy() 方法）可以在某些特殊情况下用于告诉 deflater 仅应用霍夫曼压缩。在您已经转换数据以使值的频率接近 2 的负幂（即霍夫曼编码最适合的分布）的情况下，这有时会很有用。我不希望此设置会影响库是否可以读取您的数据，但很有可能，您可能只是尝试更改此设置。

如果它有帮助，我写了一些关于[配置 Deflater](http://www.javamex.com/tutorials/compression/deflater_configuration.shtml)的文章，包括对转换后的数据使用 Huffman-only 压缩。我必须承认，无论您选择什么选项，我都希望您的图书馆能够读取数据。如果您真的确定您的压缩数据是正确的（即 ZLIB/Inflater 可以重新读取您的文件），那么您可能会考虑使用另一个库...！

哦，说明流血很明显，但无论如何我都会提到它，如果你的数据是固定的，你当然可以把它放在罐子里，它会有效地“免费”放气/充气。具有讽刺意味的是，您的 J2ME 设备必须能够解码 zlib 压缩数据，因为这本质上是 jar 的格式......

# sql-server-2008 - 如何从 SQL Server 数据库备份中挽救一小部分数据？

> ID：926521
> 
> 赞同：5
> 
> 时间：2009-05-29T15:13:57.620
> 
> 标签：sql-server-2008, backup, database-restore

我有一个实时数据库，其中删除了一些数据，我需要恢复这些数据。我有一个该数据库的最新副本，该副本已在另一台机器上恢复。自备份以来，对实时数据库进行了不相关的更改，因此我不想通过完全恢复来清除实时数据库。

我需要的数据很小——只有十几行——但是这十几行每一行都有几行来自其他表的外键，而这几行有上帝知道有多少行外键指向它们，所以它会手工恢复很复杂。

理想情况下，我能够告诉数据库的备份副本选择我需要的十几个行，以及它们所依赖的所有内容的传递闭包，以及依赖它们的所有内容，然后只导出这些数据，然后我可以导入实时数据库而不触及任何其他内容。

在这里采取的最佳方法是什么？谢谢。

大家都提到过 sp_generate_inserts。使用它时，如何防止身份列搞砸一切？你只是打开 IDENTITY INSERT 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:19:56.843

我以前遇到过类似的情况，但发现手工操作对我来说效果最好。

我将备份恢复到第二台服务器并进行查询以获取所需的信息，然后构建一个脚本来插入数据[sp_generate_inserts](http://vyaskn.tripod.com/code/generate_inserts.txt)，然后对每个具有关系行的表重复此操作。

总的来说，我在另外 2 个表中只有大约 10 条带有关系数据的主记录。我只花了大约一个小时就将一切恢复原状。

***更新***要回答您关于 sp_generate_inserts 的问题，只要您指定 @owner='dbo'，它就会将身份插入设置为 ON，然后在脚本结束时为您将其设置为 off。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:29:07.137

你必须手动恢复。sp_generate_inserts[适用](http://vyaskn.tripod.com/code/generate_inserts.txt)于新数据。但要更新数据，我这样做：

```
SELECT 'Update YourTable '
    +'SET Column1='+COALESCE(''''+CONVERT(varchar,Column1Name)+'''','NULL')
    +', Column2='+COALESCE(''''+CONVERT(varchar,Column2Name)+'''','NULL')
    +' WHERE Key='+COALESCE(''''+CONVERT(varchar,KeyColumn)+'''','NULL') FROM backupserver.databasename.owner.YourTable 
```

您也可以通过这种方式创建插入，但[sp_generate_inserts](http://vyaskn.tripod.com/code/generate_inserts.txt)更好。注意那些身份值，祝你好运（我以前遇到过这个问题，知道你现在在哪里）。

有用的查询：

```
--find out if there are missing rows, and which ones
SELECT
    b.key,c.key
    from backupserver.databasename.owner.YourTable b
        LEFT OUTER JOIN YourTable                  c ON b.key=c.key
    WHERE c.Key is NULL

--find differences
SELECT
    b.key,c.key
    from YourTable                                                c 
        LEFT OUTER JOIN backupserver.databasename.owner.YourTable b ON c.key=b.key
    WHERE  b.Key is not null
        AND (   ISNULL(c.column1,-9999)     != ISNULL(b.column1,-9999)
             OR ISNULL(c.column2,'~')       != ISNULL(b.column2,'~')
             OR ISNULL(c.column2,GETDATE()) != ISNULL(b.column2,GETDATE())
            ) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-29T18:46:49.787

SQL Server Management Studio for SQL Server 2008 允许您将表数据导出为插入语句。请参阅[http://www.kodyaz.com/articles/sql-server-script-data-with-generate-script-wizard.aspx](http://www.kodyaz.com/articles/sql-server-script-data-with-generate-script-wizard.aspx)。这种方法缺乏 sp_generate_inserts 的一些灵活性（例如，您不能指定 WHERE 子句来过滤表中的行），但可能更可靠，因为它是产品的一部分。

# visual-studio-2008 - IE8 + Visual Studio 错误

> ID：926522
> 
> 赞同：0
> 
> 时间：2009-05-29T15:13:59.227
> 
> 标签：visual-studio-2008, internet-explorer

我终于让 Windows 唠叨我从 IE6 升级到 8。

现在在 Visual Studio 2008 中，当我尝试编辑 MFC 对话框时，我收到“此页面上发生错误 - 继续运行脚本？错误”
添加变量屏幕有警告“此网站的附加组件失败跑”

Visual Studio 2008 是否适用于 IE8？
这是阻止人们使用 MFC 的神秘阴谋吗？（时间很艰难——我必须谋生）
知道我设置了什么魔法设​​置来解决这个问题吗？

编辑 - 感谢 Ghost 先生，解决方案是 regedit。

```
Under “HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet 
Settings\Zones”, create a new key called 1000 (if it isn't already there)
-          Under 1000, create a DWORD entry with:
Name = 1207
Type = REG_DWORD
Data = 0x000000 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:16:35.573

你先用谷歌试试？[First hit](http://blogs.msdn.com/vcblog/archive/2009/03/28/some-vs2005-and-vs2008-wizards-pop-up-script-error.aspx)解释了它是什么以及如何在本地解决它。

它与向导的自定义 Internet 区域中的某些安全设置有关。

# javascript - 更新控制模糊的 ValidationSummary 列表？

> ID：926527
> 
> 赞同：1
> 
> 时间：2009-05-29T15:14:54.017
> 
> 标签：javascript, asp.net, validation, dom-events, validationsummary

A`ValidationSummary`将在回发时显示错误列表。由于每个字段都是固定的，它的验证器被触发，任何验证文本都将消失。我也想自动更新`ValidationSummary`。

以下工作正常：

```
<asp:TextBox ID="ForenameTextBox" onblur="ValidationSummaryOnSubmit()" runat="server" /> 
```

但这并不理想，因为这意味着在所有领域都需要改变和保持这一点。（`ValidationSummaryOnSubmit`是微软的功能。）所以我尝试动态地做到这一点：

```
addEvent(window, "load", UpdateValidationSummary);

function addEvent(obj, evType, fn) {
    if (obj.addEventListener) {
        obj.addEventListener(evType, fn, true);
    } else {
        if (obj.attachEvent) {
            var r = obj.attachEvent("on" + evType, fn);
            return r;
        }
    }
}

function removeEvent(obj, evType, fn) {
    if (obj.removeEventListener) {
        obj.removeEventListener(evType, fn, true);
        return true;
    } else if (obj.detachEvent) {
        var r = obj.detachEvent("on" + evType, fn);
        return r;
    }
}

function UpdateValidationSummary() {
    if (typeof (Page_Validators) == "undefined") {
        return;
    }
    var i, val, ctrl;
    for (i = 0; i < Page_Validators.length; i++) {
        val = Page_Validators[i];
        if (val.controltovalidate != null && val.controltovalidate != "") {
            ctrl = document.getElementById(val.controltovalidate);
            if (ctrl != null && typeof (ValidationSummaryOnSubmit) == "function") {
                //add call to ValidationSummary on blur
                addEvent(ctrl, "blur", ValidationSummaryOnSubmit);
            }
        }
    }
} 
```

但这不起作用 -`ValidationSummary`当一个字段被固定时，整个消失，并且该`ValidationSummaryOnSubmit`函数似乎被调用了两次。如果我使用简单的赋值而不是`addEvent`它起作用的函数，但我想满足`onBlur`事件中可能已经发生某些事情的字段。

基本上我认为我只需要将对该函数的调用添加到每个控件`ValidationSummaryOnSubmit`的处理程序“列表”中。`onBlur`为什么上面的代码似乎没有这样做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T17:48:09.303

这是在所有 TextBox 上获取 onblur 属性的服务器端方法（它也应该与验证组一起使用）：

*   创建一个派生自 TextBox 的类，例如 TextBoxEx
*   在这个派生类中添加属性，例如，`this.Attributes.Add("onblur", string.Format("ValidationSummaryOnSubmit('{0}')", this.ValidationGroup);`
*   使用标签映射，以便所有现有`<asp:TextBox>`标签仍然有效： `<system.web> <pages> <tagMapping> <add tagType="System.Web.UI.WebControls.TextBox" mappedTagType="MyControls.TextBoxEx"/> </tagMapping> </pages> </system.web>`

另一种方法是使用[ControlAdapters](http://msdn.microsoft.com/en-us/magazine/cc163543.aspx)添加属性。

相关链接：
[Understanding ASP.NET Validation](http://dotnetslackers.com/articles/aspnet/understandingaspnetvalidationlibrary.aspx)
[MSDN - tagMapping Element for pages](http://msdn.microsoft.com/en-us/library/ms164641.aspx)

# asp.net - ASP/ASP.NET 处理写权限的最佳方式？

> ID：926534
> 
> 赞同：0
> 
> 时间：2009-05-29T15:15:45.853
> 
> 标签：asp.net, iis, asp-classic, permissions

假设您在 IIS 上有公共 ASP.NET（和经典 ASP）应用程序，其脚本/页面需要在位于 Web 发布文件夹树中的特定文件夹中写入或更新 html 文件。

处理这个问题的正确方法是什么，你到底是怎么做的？（即在 IIS 或 windows 资源管理器中设置目录权限）

我主要担心的是我想让 ASP/ASP.NET 应用程序写入一个文件夹，但我不希望普通的 http 用户能够通过 HTTP PUT 直接将文件放入其中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T18:05:01.423

您需要按如下方式设置 NTFS 权限：

*   IUSR_ `<MachineName>`- 匿名用户应该只有 READ 访问权限
*   网络服务（或应用程序池标识）- 读和写访问

使用这些权限，您很可能也可以从 ACL 中安全地删除所有人和经过身份验证的用户帐户。

更多信息： [http://support.microsoft.com/kb/815153](http://support.microsoft.com/kb/815153)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-31T17:35:01.277

不要在 IIS 中启用写入——它只涉及 HTTP PUT，而不涉及底层文件系统权限。然后按照gattaca所说的去做。

# iphone - Core Data NSPredicate for relationships

> ID：926536
> 
> 赞同：10
> 
> 时间：2009-05-29T15:15:52.000
> 
> 标签：iphone, cocoa, cocoa-touch, core-data, osx-leopard

My object graph is simple.

I've a feedentry object that stores info about RSS feeds and a relationship called Tag that links to "TagValues" object. Both the relation (to and inverse) are to-many. i.e, a feed can have multiple tags and a tag can be associated to multiple feeds.

I referred to [How to do Core Data queries through a relationship?](https://stackoverflow.com/questions/844162/how-to-do-core-data-queries-through-a-relationship) and created a NSFetchRequest. But when fetch data, I get an exception stating,

NSInvalidArgumentException unimplemented SQL generation for predicate

What should I do? I'm a newbie to core data :( I know I've done something terribly wrong... Please help...

Thanks

--

```
NSFetchRequest *fetchRequest = [[NSFetchRequest alloc] init];
// Edit the entity name as appropriate.
NSEntityDescription *entity = [NSEntityDescription entityForName:@"FeedEntry" inManagedObjectContext:managedObjectContext];
[fetchRequest setEntity:entity];
// Edit the sort key as appropriate.
NSSortDescriptor *sortDescriptor = [[NSSortDescriptor alloc] initWithKey:@"authorname" ascending:NO];
NSArray *sortDescriptors = [[NSArray alloc] initWithObjects:sortDescriptor, nil];

[fetchRequest setSortDescriptors:sortDescriptors];

NSEntityDescription *tagEntity = [NSEntityDescription entityForName:@"TagValues" inManagedObjectContext:self.managedObjectContext];
NSPredicate *tagPredicate = [NSPredicate predicateWithFormat:@"tagName LIKE[c] 'nyt'"];          
NSFetchRequest *tagRequest = [[NSFetchRequest alloc] init];
[tagRequest setEntity:tagEntity];
[tagRequest setPredicate:tagPredicate];

NSError *error = nil;
NSArray* predicates = [self.managedObjectContext executeFetchRequest:tagRequest error:&error];

TagValues *tv = (TagValues*) [predicates objectAtIndex:0];
NSLog(tv.tagName); // it is nyt here...

NSPredicate *predicate = [NSPredicate predicateWithFormat:@"tag IN %@", predicates];
[fetchRequest setPredicate:predicate];

// Edit the section name key path and cache name if appropriate.
// nil for section name key path means "no sections".
NSFetchedResultsController *aFetchedResultsController = [[NSFetchedResultsController alloc] initWithFetchRequest:fetchRequest managedObjectContext:managedObjectContext sectionNameKeyPath:nil cacheName:@"Root"];
aFetchedResultsController.delegate = self;
self.fetchedResultsController = aFetchedResultsController; 
```

--

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-03-13T14:53:33.983

这里的关键是“任何”

苹果的例子：

```
NSPredicate *predicate = [NSPredicate predicateWithFormat:
    @"ANY employees.firstName like 'Matthew'"]; 
```

[http://developer.apple.com/mac/library/documentation/cocoa/conceptual/CoreData/Articles/cdBindings.html](http://developer.apple.com/mac/library/documentation/cocoa/conceptual/CoreData/Articles/cdBindings.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-31T04:20:55.057

你需要 SQLite 吗？我正在努力解决类似的问题，并且发现二进制存储的一切都按预期工作。
使用 SQLite 作为存储时存在限制，尽管我还没有找到列出限制的文档，只是它们存在。

抱歉，我无法提供更多帮助。

# gwt - DialogBox标题栏中的GWT关闭按钮

> ID：926539
> 
> 赞同：13
> 
> 时间：2009-05-29T15:16:14.527
> 
> 标签：gwt

是否有非 JSNI 方法可以将关闭按钮添加到 DialogBox 的标题栏区域？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-11-16T19:01:34.007

我们从一开始就在项目中使用了 GWT-ext。这是个坏主意。他们有很多很酷的小部件，但它们不是 GWT 小部件，而且它们与 GWT 小部件不兼容。一旦选择了 GWT-Ext，一切，甚至是事件机制，都必须采用 GWT-Ext 方式，而不是 GWT 方式。这个库不会为最新版本的 GWT 更新，因为 javascript 库 Ext 不再免费。我们现在正在从我们的项目中删除 GWT-Ext。

无法在 GWT DialogBox 标题中添加不同的小部件，但您可以扩展“DecoratedPanel”（它是 DialogBox 父级）。查看 DialogBox 源代码以了解技术，特别是如何将 Caption 对象添加到面板以及如何实现窗口拖动。

这就是我们在这里所做的，而且效果很好。我们创建了自己的 Caption 类，它扩展了 FocusablePanel（一个捕获所有鼠标事件的 SimplePanel），并且我们向它添加了一个 Horizo​​ntalPanel，带有按钮和文本。我们必须通过调用 super 方法来覆盖 onAttach() 和 onDetach()（它们是受保护的）。

我相信我不能把我们的源代码放在这里，所以我只能给你这些提示。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-03-15T15:38:59.503

您可以通过向对话框的中心面板添加一个按钮来实现：

```
Image closeButton = new Image("");
closeButton.addClickHandler(new ClickHandler() {
   public void onClick(ClickEvent event) {
      registerBox.hide();               
   }
});

closeButton.setStyleName("TopRight"); 
```

然后用 CSS 定位它：

```
.TopRight {
   float:right;
   margin-top:-22px;
   width:16px;
   height:16px;
   display:block;
   background-image: url(images/cancel_16.png);
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-10-31T21:50:28.803

我创建了这个标题类：

```
public class DialogBoxCaptionWithCancel extends Composite 
    implements Caption, HasClickHandlers {

@UiField
HTMLPanel mainPanel;
@UiField
HTML captionLabel;
@UiField
PushButton cancelButton;

private HandlerManager handlerManager = null;

private static final Binder binder = GWT.create(Binder.class);

interface Binder extends UiBinder<Widget, DialogBoxCaptionWithCancel> {
}

public DialogBoxCaptionWithCancel() {
    initWidget(binder.createAndBindUi(this));

    mainPanel.setStyleName("Caption");
    Image upImage = new Image("images/closeWindow.png");
    Image hoverImage = new Image("images/closeWindowFocus.png");
    cancelButton.getUpFace().setImage(upImage);
    cancelButton.getUpHoveringFace().setImage(hoverImage);
    cancelButton.setStylePrimaryName("none");
}

/*
 * (non-Javadoc)
 * 
 * @see com.google.gwt.user.client.ui.Widget#onLoad()
 */
@Override
protected void onLoad() {
    super.onLoad();

    handlerManager = new HandlerManager(this);
}

@UiHandler("cancelButton")
public void cancelButtonOnClick(ClickEvent event) {
    handlerManager.fireEvent(event);
}

@Override
public HandlerRegistration addMouseDownHandler(MouseDownHandler handler) {
    return handlerManager.addHandler(MouseDownEvent.getType(), handler);
}

@Override
public HandlerRegistration addMouseUpHandler(MouseUpHandler handler) {
    return handlerManager.addHandler(MouseUpEvent.getType(), handler);
}

@Override
public HandlerRegistration addMouseOutHandler(MouseOutHandler handler) {
    return handlerManager.addHandler(MouseOutEvent.getType(), handler);
}

@Override
public HandlerRegistration addMouseOverHandler(MouseOverHandler handler) {
    return handlerManager.addHandler(MouseOverEvent.getType(), handler);
}

@Override
public HandlerRegistration addMouseMoveHandler(MouseMoveHandler handler) {
    return handlerManager.addHandler(MouseMoveEvent.getType(), handler);
}

@Override
public HandlerRegistration addMouseWheelHandler(MouseWheelHandler handler) {
    return handlerManager.addHandler(MouseWheelEvent.getType(), handler);
}

@Override
public String getHTML() {
    return "";
}

@Override
public void setHTML(String html) {
}

@Override
public String getText() {
    return this.captionLabel.getText();
}

@Override
public void setText(String text) {
    this.captionLabel.setText(text);
}

@Override
public void setHTML(SafeHtml html) {
}

@Override
public HandlerRegistration addClickHandler(ClickHandler handler) {
    return handlerManager.addHandler(ClickEvent.getType(), handler);
}

} 
```

当您将鼠标悬停在取消按钮上时，图像只是从 IE8 的行为中捕获的。

这是 UiBinder 代码：

```
<!DOCTYPE ui:UiBinder SYSTEM "http://dl.google.com/gwt/DTD/xhtml.ent">
<ui:UiBinder 
xmlns:ui='urn:ui:com.google.gwt.uibinder' 
xmlns:g='urn:import:com.google.gwt.user.client.ui'>

<ui:style>
    .htmlField {
        width: 100%;
    }

    .pushButton {
        border: none;
        padding: 0px;
        width: 49px;
        height: 21px;
    }
</ui:style>

<g:HTMLPanel ui:field="mainPanel">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td width="100%">
                <g:HTML ui:field="captionLabel" addStyleNames="{style.htmlField}"></g:HTML>
            </td>
            <td>
                <g:PushButton ui:field="cancelButton" addStyleNames="{style.pushButton}"></g:PushButton>
            </td>
        </tr>
    </table>
</g:HTMLPanel>
</ui:UiBinder> 
```

然后我扩展 DialogBox 的类具有以下内容：

```
public class MyDialogBox extends DialogBox implements ClickHandler {
...
// instantiate the caption with the cancel button
private static DialogBoxCaptionWithCancel caption = new DialogBoxCaptionWithCancel();
...
 public MyDialogBox() {
    // construct the dialog box with the custom caption
    super(false, false, caption);

    setWidget(binder.createAndBindUi(this));

    // set the caption's text
    caption.setText("My Caption");
}
....
protected void onLoad() {
    super.onLoad();

    // let us react to the captions cancel button
    caption.addClickHandler(this);
}
...
@Override
public void onClick(ClickEvent event) {
    // the caption's cancel button was clicked
    this.hide();
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-03T23:58:10.613

更简单的解决方案是使用 gwt-ext ( [http://code.google.com/p/gwt-ext/](http://code.google.com/p/gwt-ext/) )。它是免费且易于使用和集成的。你可以看到他们的展示[http://www.gwt-ext.com/demo/](http://www.gwt-ext.com/demo/)。我认为您想要的是 MessageBox 或 Layout Window（它们位于展示的 Windows 类别中）。

问候。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-29T11:40:22.310

你可以试试这个，通过 fungus1487 稍微改进的解决方案：

```
import com.google.gwt.dom.client.EventTarget;
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.i18n.client.HasDirection;
import com.google.gwt.user.client.Element;
import com.google.gwt.user.client.ui.*;

/**
 * @author Andrey Talnikov
 */
public class ClosablePopup extends DialogBox {

    private Anchor closeAnchor;

    /**
     * Instantiates new closable popup.
     *
     * @param title        the title
     * @param defaultClose it {@code true}, hide popup on 'x' click
     */
    public ClosablePopup(String title, boolean defaultClose) {
        super(true);

        closeAnchor = new Anchor("x");

        FlexTable captionLayoutTable = new FlexTable();
        captionLayoutTable.setWidth("100%");
        captionLayoutTable.setText(0, 0, title);
        captionLayoutTable.setWidget(0, 1, closeAnchor);
        captionLayoutTable.getCellFormatter().setHorizontalAlignment(0, 1,
                HasHorizontalAlignment.HorizontalAlignmentConstant.endOf(HasDirection.Direction.LTR));

        HTML caption = (HTML) getCaption();
        caption.getElement().appendChild(captionLayoutTable.getElement());

        caption.addClickHandler(new ClickHandler() {
            @Override
            public void onClick(ClickEvent event) {
                EventTarget target = event.getNativeEvent().getEventTarget();
                Element targetElement = (Element) target.cast();

                if (targetElement == closeAnchor.getElement()) {
                    closeAnchor.fireEvent(event);
                }
            }
        });

        if (defaultClose) {
            addCloseHandler(new ClickHandler() {
                @Override
                public void onClick(ClickEvent event) {
                    hide();
                }
            });
        }
    }

    public void addCloseHandler(ClickHandler handler) {
        closeAnchor.addClickHandler(handler);
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-01T18:01:44.973

~~就在这里~~

不，没有——至少在不摆弄 GWT 的 DialogBox 类本身或使用通用小部件重新创建 DialogBox 的情况下是这样。这是 GWT 中的一个已知问题，即[问题 1405](http://code.google.com/p/google-web-toolkit/issues/detail?id=1405)（加星标表示您的兴趣）。

~~然而; DialogBox 没有为我们提供执行此操作的工具，因此我们需要扩展它~~-**编辑：** *这不起作用。*

如果您想直接替换 DialogBox，您可以将您的类命名为 DialogBox 并导入它，而不是 GWT 中包含的那个。~~[GWT 论坛上的此线程](http://groups.google.com/group/Google-Web-Toolkit/browse_thread/thread/aae365722c98a664)提供了有关如何完成此操作的更好详细信息（已过时，使用侦听器）~~已过时，DialogBox 的内部结构自此线程以来发生了很大变化 - 它不起作用。

~~这是我破解的一些代码以获得相同的结果（使用链接的线程作为指导）~~。这不起作用：

**我的对话框：**

```
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.event.dom.client.MouseOutEvent;
import com.google.gwt.event.dom.client.MouseOutHandler;
import com.google.gwt.event.dom.client.MouseOverEvent;
import com.google.gwt.event.dom.client.MouseOverHandler;
import com.google.gwt.user.client.DOM;
import com.google.gwt.user.client.Element;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.DialogBox;
import com.google.gwt.user.client.ui.HTML;
import com.google.gwt.user.client.ui.HorizontalPanel;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.Widget;

public class MyDialogBox extends DialogBox {

    private class crossHandler implements ClickHandler, MouseOverHandler, MouseOutHandler
    {

        @Override
        public void onClick(ClickEvent event) {
            hide();
            Window.alert("Click!");
        }

        @Override
        public void onMouseOver(MouseOverEvent event) {
            DOM.setStyleAttribute(cross.getElement(), "font-weight", "bold");

        }

        @Override
        public void onMouseOut(MouseOutEvent event) {
            DOM.setStyleAttribute(cross.getElement(), "font-weight", "normal");

        }

    }

    Label cross = new Label("X"); // The close button
    crossHandler crosshandler = new crossHandler();
    HTML caption = new HTML(); // The caption aka title
    HorizontalPanel captionPanel = new HorizontalPanel(); // Contains caption and cross

      /**
       * Creates an empty dialog box. It should not be shown until its child widget
       * has been added using {@link #add(Widget)}.
       */
    public MyDialogBox()
    {
        this(false);
    }

  /**
   * Creates an empty dialog box specifying its "auto-hide" property. It should
   * not be shown until its child widget has been added using
   * {@link #add(Widget)}.
   * 
   * @param autoHide <code>true</code> if the dialog should be automatically
   *          hidden when the user clicks outside of it
   */
    public MyDialogBox(boolean autoHide) {
            this(autoHide, true);
          }

    /**
     * Creates an empty dialog box specifying its "auto-hide" property. It should
     * not be shown until its child widget has been added using
     * {@link #add(Widget)}.
     * 
     * @param autoHide <code>true</code> if the dialog should be automatically
     *          hidden when the user clicks outside of it
     * @param modal <code>true</code> if keyboard and mouse events for widgets not
     *          contained by the dialog should be ignored
     */
    public MyDialogBox(boolean autoHide, boolean modal)
    {
        super(autoHide, modal);

        cross.addClickHandler(crosshandler); 
        cross.addMouseOutHandler(crosshandler);
        cross.addMouseOverHandler(crosshandler);

        captionPanel.add(caption);
        captionPanel.add(cross);
        captionPanel.setStyleName("caption");

        Element td = getCellElement(0, 1);  // Get the cell element that holds the caption
        td.setInnerHTML(""); // Remove the old caption
        td.appendChild(captionPanel.getElement());

    }

    @Override
    public void setText(String text)
    {
        caption.setText(text);
    }

    public String getText()
    {
        return caption.getText();
    } 

    public void setHtml(String html)
    {
        caption.setHTML(html);
    }

    public String getHtml()
    {
        return caption.getHTML();
    } 
```

**注意：**此代码不起作用。ClickEvent 不是从 MyDialogBox 发送的，`cross`而是从 MyDialogBox 发送的，无论您是否将 ClickHandlers 添加到`cross`IOW，MyDialogBox 都是发送者/源，因此无法检查`cross`. 单击交叉时，由于某些原因，它不会触发 ClickEvent。

**编辑：** 除非您从头开始（几乎）编写自己的 DialogBox 或修复问题 1405，否则这似乎无法在没有 hack 的情况下完成。当然有许多现有的库已经解决了这个问题，即[SmartGWT](http://www.smartclient.com/smartgwt/showcase/#layout_windows_header_controls)和[GWT-Ext](http://www.gwt-ext.com/demo/#layoutWindow)，但是它们的实现主要是从头开始的。

所以用一句话回答你的问题：是的，有一种方法，但你不会喜欢它:)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-06-30T12:42:03.737

我想一个简单的答案是实例化一个小部件以替换 DialogBox 中的标准 Caption 小部件。我创建了一个右侧有一个按钮的标题，您可以选择对它的引用。然后你可以添加任何你想要的点击事件。

在 GWT 2.4 中，我使用了以下解决方案：

```
import com.google.gwt.event.dom.client.MouseDownHandler;
import com.google.gwt.event.dom.client.MouseMoveHandler;
import com.google.gwt.event.dom.client.MouseOutHandler;
import com.google.gwt.event.dom.client.MouseOverHandler;
import com.google.gwt.event.dom.client.MouseUpHandler;
import com.google.gwt.event.dom.client.MouseWheelHandler;
import com.google.gwt.event.shared.HandlerRegistration;
import com.google.gwt.safehtml.shared.SafeHtml;
import com.google.gwt.user.client.ui.HorizontalPanel;
import com.google.gwt.user.client.ui.InlineLabel;
import com.google.gwt.user.client.ui.PushButton;
import com.google.gwt.user.client.ui.DialogBox.Caption;

/**
 * @author Cristiano Sumariva
 */
public class ButtonCaption extends HorizontalPanel implements Caption
{
  protected InlineLabel text;
  protected PushButton closeDialog;

  /**
   * @return the button at caption
   */
  public PushButton getCloseButton()
  {
    return closeDialog;
  }
  public ButtonCaption( String label )
  {
    super();
    setWidth( "100%" );
    setStyleName( "Caption" ); // so you have same styling as standard caption widget
    closeDialog = new PushButton();
    add( text = new InlineLabel( label ) );
    add( closeDialog );
    setCellWidth( closeDialog, "1px" ); // to make button cell minimal enough to it
  }
  /* (non-Javadoc)
   * @see com.google.gwt.event.dom.client.HasMouseDownHandlers#addMouseDownHandler(com.google.gwt.event.dom.client.MouseDownHandler)
   */
  @Override
  public HandlerRegistration addMouseDownHandler( MouseDownHandler handler )
  {
    return addMouseDownHandler( handler );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.event.dom.client.HasMouseUpHandlers#addMouseUpHandler(com.google.gwt.event.dom.client.MouseUpHandler)
   */
  @Override
  public HandlerRegistration addMouseUpHandler( MouseUpHandler handler )
  {
    return addMouseUpHandler( handler );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.event.dom.client.HasMouseOutHandlers#addMouseOutHandler(com.google.gwt.event.dom.client.MouseOutHandler)
   */
  @Override
  public HandlerRegistration addMouseOutHandler( MouseOutHandler handler )
  {
    return addMouseOutHandler( handler );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.event.dom.client.HasMouseOverHandlers#addMouseOverHandler(com.google.gwt.event.dom.client.MouseOverHandler)
   */
  @Override
  public HandlerRegistration addMouseOverHandler( MouseOverHandler handler )
  {
    return addMouseOverHandler( handler );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.event.dom.client.HasMouseMoveHandlers#addMouseMoveHandler(com.google.gwt.event.dom.client.MouseMoveHandler)
   */
  @Override
  public HandlerRegistration addMouseMoveHandler( MouseMoveHandler handler )
  {
    return addMouseMoveHandler( handler );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.event.dom.client.HasMouseWheelHandlers#addMouseWheelHandler(com.google.gwt.event.dom.client.MouseWheelHandler)
   */
  @Override
  public HandlerRegistration addMouseWheelHandler( MouseWheelHandler handler )
  {
    return addMouseWheelHandler( handler );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.user.client.ui.HasHTML#getHTML()
   */
  @Override
  public String getHTML()
  {
    return getElement().getInnerHTML();
  }

  /* (non-Javadoc)
   * @see com.google.gwt.user.client.ui.HasHTML#setHTML(java.lang.String)
   */
  @Override
  public void setHTML( String html )
  {
    remove( text );
    insert( text, 1 );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.user.client.ui.HasText#getText()
   */
  @Override
  public String getText()
  {
    return text.getText();
  }

  /* (non-Javadoc)
   * @see com.google.gwt.user.client.ui.HasText#setText(java.lang.String)
   */
  @Override
  public void setText( String text )
  {
    this.text.setText( text );
  }

  /* (non-Javadoc)
   * @see com.google.gwt.safehtml.client.HasSafeHtml#setHTML(com.google.gwt.safehtml.shared.SafeHtml)
   */
  @Override
  public void setHTML( SafeHtml html )
  {
    setHTML( html.asString() );
  }
} 
```

扩展 DialogBox 以使用可用的新 ButtonCaption

```
class CaptionCloseableDialogBox extends DialogBox
{
  public CaptionCloseableDialogBox()
  {
    super( new ButtonCaption( "dialog box title" ) );
    setAutoHideEnabled( false );

    ButtonCaption ref = (ButtonCaption) this.getCaption();
    PushButton closeButton = ref.getCloseButton();
    // apply button face here closeButton;
    closeButton.addClickHandler( /* attach any click handler here like close this dialog */ );
  }
} 
```

希望它对任何人都有帮助。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-01T13:53:20.240

查看活动项目： [http ://code.google.com/p/gwt-mosaic/](http://code.google.com/p/gwt-mosaic/)

正如他们页面上提到的，他们的崇高目标是：

> 目标是通过使 API 尽可能接近 GWT 的标准小部件 API 来提供完整的小部件集。

一直被困在GXT漩涡中。根本不喜欢他们如何要求用户为侦听器使用完全不同的 API，等等。就他们而言，这是有道理的。毕竟，GXT 只是他们现有 javascript 库的一个端口。但是我一直在寻找这个马赛克项目太久了......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-02-27T14:19:38.177

只需使用 GWT 并且不使用外部库，您就可以拦截标题元素上的单击事件并执行命中测试以查看 x,y 鼠标坐标是否在锚元素（或您用作 ClickHandler 的其他元素）的范围内。

```
// Create anchor we want to accept click events
final Anchor myAnchor = new Anchor("My Anchor");

// Add handler to anchor
myAnchor.addClickHandler(new ClickHandler() {
  @Override
  public void onClick(ClickEvent event) {
    Window.alert("Anchor was clicked");
  }
});

// Create dialog
final DialogBox myDialog = new DialogBox();
myDialog.setText("My Dialog");

// Get caption element
final HTML caption = ((HTML)myDialog.getCaption());

// Add anchor to caption
caption.getElement().appendChild(myAnchor.getElement());

// Add click handler to caption
caption.addClickHandler(new ClickHandler() {
  @Override
  public void onClick(ClickEvent event) {
    // Get x,y caption click relative to the anchor
    final int x = event.getRelativeX(myAnchor.getElement());
    final int y = event.getRelativeY(myAnchor.getElement());

    // Check click was within bounds of anchor
    if(x >= 0 && y >= 0 && 
      x <= myAnchor.getOffsetWidth() && 
      y <= myAnchor.getOffsetHeight()) {
        // Raise event on anchor
        myAnchor.fireEvent(event);
    }
  }
});

// Show the dialog
myDialog.show(); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-05-13T01:45:05.143

我意识到这已经过时了，但是您可以使用绝对定位和 0 的顶部和右侧来获得右上角的小部件。对话框本身是绝对定位的，因此您的小部件的定位将与它相反。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-03-05T10:40:55.983

如果您只是不想为所提出的问题提供简单的解决方案，则此方法有效：

```
 Image button = new Image("images/cancel.png"); 

    button.addClickHandler(new ClickHandler(){ 
        public void onClick(ClickEvent event) { 
            hide();
        }
    }); 
    button.setStyleName("dialog-close");

    HorizontalPanel header = new HorizontalPanel();
    header.add(new HTML("Example Tool"));
    header.add(button);

    setHTML(header.getElement().getInnerHTML()); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-18T22:30:14.947

您可以在项目 synthfuljava 下的 google 代码中找到可关闭的对话框。它实际上称为可滚动对话框，在标题处带有关闭 X 按钮。

以下博客解释了必须克服的障碍才能使标题 X 按钮能够侦听单击事件以使其工作：

[http://h2g2java.blessedgeek.com/2009/07/gwt-useable-closeable-scrollable.html](http://h2g2java.blessedgeek.com/2009/07/gwt-useable-closeable-scrollable.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-09-21T08:40:20.763

我认为 cavila 的 ButtonCaption 是最好的解决方案，但是在实现标题时有一个 bug。调用其中一个被覆盖的方法会导致不定式循环，因为该方法以递归方式调用自身。

为了防止这种情况，您可以改为在 InlineLabel*文本*上调用该方法：

```
@Override
public HandlerRegistration addMouseDownHandler( MouseDownHandler handler ) {
    return text.addMouseDownHandler( handler );
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-09-06T18:03:35.347

GWT 对话框的顶级 DIV 具有绝对定位，因此您可以使用关闭按钮执行相同操作。就DOM而言，这允许您将其放在对话框的主体中，但使其实际出现在标题中。

在下面的示例中，我将其放置在对话框的右上方，并使用填充将其居中放置在标题上。

```
<ui:style>
    .close {
        position: absolute;
        top: 0;
        right: 0;
        padding: 3px 3px 1px 3px !important;
        border-radius: 4px;
        margin: 5px;
    }
</ui:style>

<g:PushButton ui:field="closeButton" addStyleNames="{style.close}">
    <g:upFace image='{closeIcon}'/>
    <g:downFace image='{closeIcon}'/>
    <g:upHoveringFace image='{closeIcon}'/>
    <g:downHoveringFace image='{closeIcon}'/>
    <g:upDisabledFace image='{closeIcon}'/>
    <g:downDisabledFace image='{closeIcon}'/>
</g:PushButton> 
```

# eclipse - 通过软件更新安装时为 Eclipse 3.4+ 插件指定目标文件夹

> ID：926547
> 
> 赞同：5
> 
> 时间：2009-05-29T15:17:58.440
> 
> 标签：eclipse, plugins, download, installation, share

在四处搜索后，我发现 eclipse 3.4/3.5 现在允许您使用他们的“dropin”文件夹来手动安装插件。

这在您已经下载了功能和插件文件的情况下效果很好，但是在您使用软件更新功能只是指向 URL 并下载插件的情况下，您似乎无法控制哪个文件夹插件安装到。

是否可以强制将插件安装到任意 dropin 文件夹，或者将插件导出到某个位置以便与其他人的 eclipse 安装共享？

我宁愿不必梳理插件信息并手动确定要将哪些插件 jar 复制到 dropin 文件夹中：P

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-13T13:25:37.107

我认为[这个线程](https://stackoverflow.com/questions/582391/installing-eclipse-3-4-plugins-in-a-directory-other-than-eclipsehome-plugins)中的答案和 Michael Scharf 提到的博客文章可能对你有用，尽管过程并不像应该的那么简单:(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:48:05.507

3.4 中的新 p2 系统应该有一个称为捆绑池的功能，它允许共享插件。但是，我没有使用它，所以我不确定细节。我希望这至少可以为您指明正确的方向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-12T07:08:54.510

您必须[删除 P2](http://wiki.eclipse.org/Equinox_p2_Removal)才能获得旧的更新管理器。

注意：P2 团队设法破坏了所有向后兼容的东西。这个技巧不适用于 3.5。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-10T18:11:08.557

使用 3.4.1 时，您仍然可以在`Preferences/ General/ Capabilities`. 然后您可以再次使用扩展点。但它已在 3.4.2 中完全删除。

# c++ - 在系统上的何处安装 SDK DLL，以便需要它们的应用程序可以找到它们

> ID：926551
> 
> 赞同：2
> 
> 时间：2009-05-29T15:18:26.690
> 
> 标签：c++, windows, dll, path

我有一个我正在开发的 SDK，之前的开发人员刚刚在 System32 中删除了 DLL（显然是严重的冒犯：[见这里](https://stackoverflow.com/questions/926425/windows-versus-windows-system32-file-location-conventions)）

因此，假设我将它们移到 \Program Files\\SDK （或其他）中，我如何确保所有需要这些 DLL 的应用程序都可以访问它们？澄清一下，所有访问这些的应用程序都在编译时对 DLL 进行早期（静态）绑定，因此我无法将完整路径传递给它们或任何东西。他们需要能够在仅给出 DLL 文件名的情况下找到它。

同样，包含特定版本的 MSVCR80.dll 怎么样？他们都依赖于此，但我需要确保他们获得特定版本（我包含的版本）。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T15:23:28.413

SDK 根据定义是一个开发工具包。这不是部署补丁...

这意味着依赖于这些程序集的应用程序应该随它们一起提供并将它们安装到它们的本地 \program files.. 目录中。

这样做的原因是假设您决定通过消除一个入口点来进行重大更改。通过安装“SDK”，它有可能阻止旧程序运行。

您可以从 Java 手册中试一试并更新 PATH 环境变量。每当程序调用外部程序集时，它都会沿着该环境变量搜索，直到找到它。

当然，这仍然可能导致问题出现。因此，最好的办法是将 SDK 安装到 Program Files 中，让依赖于您的工具包的产品开发人员决定是否要更新其版本。

**更新**

正如我正在考虑的那样，最后一种可能性是 GAC 你的程序集。如果您这样做，请记住，它们应该被强烈命名并正确版本化，以免相互踩踏。我不推荐这条路线，因为它隐藏了程序集的实际位置，并且使卸载变得更加困难，然后只需在您的目录上点击删除即可。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T16:01:37.930

我不能告诉您有关您自己的 DLL 的信息，但您**永远不**应该单独重新分发 Microsoft DLL。

您始终必须使用 Microsoft Redistributable Package。

例如，如果您的应用程序依赖于 Dev Studio 2005 SP1 中的 dll，您应该使用 Microsoft Visual Studio 2005 SP1 可再发行组件重新分发您的应用程序。这同样适用于 2008。MS 提供基于 MSI 的安装程序和合并模块以包含在您自己的产品安装程序中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T15:27:31.167

你问的是“DLL Hell”，我认为每个 Windows 开发人员都熟悉。查找 DLL 的顺序为：

*   调用它们的 exex 加载的目录
*   当前目录
*   各种 Windows 目录（如您上一个问题中所述）
*   PATH 变量中的目录

由于应排除 Windows 目录，因此您有三个选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T15:22:51.923

您可以将安装路径放在搜索路径中，这将允许应用程序找到它们。

或者，您可以将 DLL 部署到与依赖它们的应用程序相同的目录中。

从 SDK 的角度来看，我相信第一个更好——它会使开发更容易。但我认为第二个更适合将应用程序部署到最终用户，除非您预计单个系统上可能有许多消费者，因此拥有 DLL 副本的磁盘和内存占用量令人望而却步。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T15:23:23.343

如果您无法将 dll 安装到与使用它们的 exe 相同的目录中，则可以将目录附加到 PATH 环境变量中。

你没有说你使用的是哪个版本的 Windows，因为细节与我记忆中的略有不同。

您也可以将您的 MSVCR80.dll 版本放在同一个文件夹中。但是，您必须确保您的文件夹在路径上的系统文件夹之前，否则链接器将首先选择“标准”文件夹。但是，如果您采用“本地”dll 方法，则不会出现此问题，因为 Windows 会首先搜索本地目录，因此会选择您的 MSVCR80.dll 版本。

你的版本是最新的还是以前的版本？您最好让您的应用程序使用该版本或更高版本，然后允许用户根据需要更新他们的机器。这也说明了为什么您永远不应该弄乱 \Windows 或 \Windows\system32 中的 dll，因为正如其他人所指出的那样，您可以通过更改此 dll 的版本来破坏其他应用程序。

# vba - VBA 中的 IFDEF 等效项

> ID：926561
> 
> 赞同：4
> 
> 时间：2009-05-29T15:20:42.053
> 
> 标签：vba, excel, office-2007, office-2003

我的代码需要同时在 Excel 2003 和 Excel 2007 上运行，并且有一些地方的版本更改会导致代码停止。我尝试使用 If-Else 语句将这些行分开，但代码不会在其中任何一个上编译，因为它无法识别用于另一个的代码。有什么方法可以告诉一个版本忽略 VBA 中的一段代码，类似于 C 或 C++ 风格的#ifdef？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T18:22:16.957

> 这是一个很好的起点，但它不适用于运行它的 Excel 版本，因为这只能在运行时计算，而不是编译时计算。

如果您需要基于仅在运行时可发现的信息来分支代码，您可能会考虑将后期绑定作为一种解决方案。有两种方法可以绕过版本问题。

如果您需要访问仅存在于某些版本中的属性或方法，则可以使用第一种方式，您可以使用 CallByName。按名称调用的优点是它允许您尽可能保留对象的早期绑定（和智能感知）。

举个例子，Excel 2007 有一个新的 TintAndShade 属性。如果您想更改范围的颜色，并且对于 Excel 2007 还确保 TintAndShade 设置为 0，您会遇到麻烦，因为您的代码不会在 Excel 2003 中编译，因为 Excel 2003 没有 TintAndShade 作为范围对象的属性。如果您使用 CallByName 访问您知道不在所有版本中的属性，则您的代码将在所有版本中正常编译，但仅在您指定的版本中运行。见下文：

```
Sub Test() 
    ColorRange Selection, Excel.Application.version, 6 
End Sub 
Sub ColorRange(rng As Excel.Range, version As Double, ParamArray args() As Variant) 
    With rng.Interior 
        .colorIndex = 6 
        .Pattern = xlSolid 
        If version >= 12# Then 
             'Because the property name is stored in a string this will still compile.
             'And it will only get called if the correct version is in use.
            CallByName rng.Interior, "TintAndShade", VbLet, 0 
        End If 
    End With 
End Sub 
```

第二种方法是用于必须通过“新”实例化并且在旧版本中甚至不存在的类。你不会在 Excel 中遇到这个问题，但我会给出一个快速演示，以便你明白我的意思：

想象一下，您想做文件 IO，但出于某种奇怪的原因，并非所有计算机上都安装了 Microsoft Scripting Runtime。但是出于一些同样奇怪的原因，您想确保它在可用时被使用。如果设置对它的引用并在代码中使用早期绑定，则代码将无法在没有该文件的系统上编译。所以你改用后期绑定：

```
Public Sub test()
    Dim strMyString As String
    Dim strMyPath As String
    strMyPath = "C:\Test\Junk.txt"
    strMyString = "Foo"
    If LenB(Dir("C:\Windows\System32\scrrun.dll")) Then
        WriteString strMyPath, strMyString
    Else
        WriteStringNative strMyPath, strMyString
    End If
End Sub

Public Sub WriteString(ByVal path As String, ByVal value As String)
    Dim fso As Object '<-Use generic object
    'This is late binding:
    Set fso = CreateObject("Scripting.FileSystemObject")
    fso.CreateTextFile(path, True, False).Write value
End Sub

Public Sub WriteStringNative(ByVal path As String, ByVal value As String)
    Dim lngFileNum As Long
    lngFileNum = FreeFile
    If LenB(Dir(path)) Then Kill path
    Open path For Binary Access Write Lock Read Write As #lngFileNum
    Put #lngFileNum, , value
    Close #lngFileNum
End Sub 
```

有自 2003 年以来对 Excel 对象模型的所有添加和更改的完整列表：http:
[//msdn.microsoft.com/en-us/library/bb149069.aspx](http://msdn.microsoft.com/en-us/library/bb149069.aspx) 对于 1997 年和 2000 年之间的更改，请访问此处：
[http://msdn .microsoft.com/en-us/library/aa140068(office.10).aspx](http://msdn.microsoft.com/en-us/library/aa140068(office.10).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:55:05.307

是的，可以在 Excel VBA 中进行条件编译。下面是一个简短的资源和一些示例代码： [条件编译](http://www.pgacon.com/visualbasic.htm#Take%20Advantage%20of%20Conditional%20Compilation)

```
#If Win32 Then
    ' Profile String functions:
    Private Declare Function WritePrivateProfileString Lib "KERNEL32" Alias "WritePrivateProfileStringA" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpString As Any, ByVal lpFileName As String) As Long
    Private Declare Function GetPrivateProfileString Lib "KERNEL32" Alias "GetPrivateProfileStringA" (ByVal lpApplicationName As Any, ByVal lpKeyName As Any, ByVal lpDefault As Any, ByVal lpReturnedString As String, ByVal nSize As Long, ByVal lpFileName As String) As Long
#Else
    ' Profile String functions:
    Private Declare Function WritePrivateProfileString Lib "Kernel" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpString As Any, ByVal lpFileName As String) As Integer
    Private Declare Function GetPrivateProfileString Lib "Kernel" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpDefault As Any, ByVal lpReturnedString As String, ByVal nSize As Integer, ByVal lpFileName As String) As Integer
#End If 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-31T18:26:28.697

你能发布有问题的代码行吗？

如果它是像 vbYes 或 xlFileFormat 之类的常量，请使用相应的数值。

告诉我你得到了什么，我看看我是否可以重构它。

账单

# asp.net - 对 Web GUI 进行单元测试

> ID：926562
> 
> 赞同：1
> 
> 时间：2009-05-29T15:21:14.033
> 
> 标签：asp.net, asp.net-mvc, tdd

我最近听到一个讨论，其中 TDD 是热门词汇。现在根据一位演讲者的说法，为了测试您的行为，您需要使用 MVC，但另一方面，据说 TDD 是一种可以在任何环境中采用的方法（如围绕 ASP.NET MVC 或 Web 窗体的讨论） . 另一位演讲者声称，如果您将行为放入库或模型中，那么您只需在 TDD 中测试您的存储库或服务，因此无需担心测试 HTML。在 Web GUI 测试的情况下应该覆盖多少 TDD 还是值得付出努力？

我知道有时我们会使用“下一个最好的东西”并将其发挥到极致，但这并没有真正有利于**实际的**开发场景。那么TDD可以应用到UI上吗？

**编辑**：

我同意你们的看法，这也是我的感受：如果你真的做 TDD，那么你不需要测试你的 WEB UI 前端，因为你提供给它的数据应该在你的业务/服务/存储库下可以在没有 UI 的情况下测试的层。因此，如果您对 Web 窗体应用程序进行编程，使您的操作/行为与服务器端调用相关联（例如按钮单击事件，尽管在我的情况下它们可以通过调用较低级别的操作进行测试），您可以在 Web 窗体中使用 TDD . 感谢您的回答

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T15:28:57.543

我会大胆地说，如果您需要对您的 GUI 进行单元测试以完成业务逻辑或集成测试，那么您的设计就缺乏清晰的关注点分离。MVC 和 MVP 都是提供清晰分离关注点的模式，因此您的 UI 可以只专注于表示逻辑。

您在 ASP.Net 中使用 ASP.Net MVC 或[WCSF](http://msdn.microsoft.com/en-us/library/bb264518.aspx)（使用 Web 表单的 MVP 实现）确实有这两种选择。

话虽如此，您仍然应该进行 GUI 测试，但您无需手动执行所有这些操作。[Selenium Server 和 Selenium Remote Control](http://seleniumhq.org/projects/remote-control/)提供了通过 UI 进行自动化测试的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-31T04:26:32.890

我同意乔希的观点。不过，只是继续进行下去，所以我不能投票。

首先应该注意的是，测试你的 GUI 不是单元测试。正如 Josh 所倡导的那样，通过清晰的关注点分离，GUI 不包含业务逻辑。

需要测试的逻辑封装在一个或多个离散库中（或者可能在简单的 MVC 控制器中）。

TDD 仅指逻辑代码单元，可靠的 TDD 实践的一个标志是，您的所有逻辑代码都可以在完全没有任何 UI 的情况下编写和测试。事实上，测试通常是在他们将要测试的课程之前编写的。一旦代码完成并通过所有测试，就可以添加 UI 以利用您构建的 API 挂钩，并且该 UI 可以是 webforms、MVC、WPF、winforms 等。

使用 Selenium 之类的产品对 UI 进行的测试更多地与验收测试或*集成*测试有关。

# apache-flex - Flex：navigateToURL() 大约需要 3-5 秒？

> ID：926563
> 
> 赞同：2
> 
> 时间：2009-05-29T15:21:15.203
> 
> 标签：apache-flex, navigatetourl

我的 flex 应用程序中有一个调用：

```
navigateToURL(new URLRequest(_rURL),'_self'); 
```

但是离开当前页面大约需要 3-5 秒甚至更多秒。

如果我省略“_self”，新窗口会立即打开并且页面会立即加载......但只有当我将其设置为 _self 时，我才会在加载前延迟几秒钟......我不知道为什么，但它是烦人..我想知道是否有人知道为什么会发生这种情况或我能做些什么？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-11-12T02:21:28.413

一些浏览器在重定向到新页面之前处理请求。例如，如果 URL 是要下载的文件，则不会重定向。您可以使用窗口或框架的名称或 ID 来获得相同的效果，“top”、“window”、“parent”、“self”（不是 _self）等。更多信息在这里，[http://www.howtocreate .co.uk/tutorials/javascript/browserinspecific](http://www.howtocreate.co.uk/tutorials/javascript/browserinspecific)

# python - 为什么在类上定义 __getitem__ 使其在 python 中可迭代？

> ID：926574
> 
> 赞同：73
> 
> 时间：2009-05-29T15:22:53.360
> 
> 标签：python, iterator, overloading

为什么在类上定义 __getitem__ 使其可迭代？

例如，如果我写：

```
class b:
  def __getitem__(self, k):
    return k

cb = b()

for k in cb:
  print k 
```

我得到输出：

```
0
1
2
3
4
5
6
7
8
... 
```

我真的希望看到“for k in cb:”返回错误

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-05-29T15:37:35.130

`__getitem__`当 PEP234 将可迭代性作为主要概念引入时，迭代对 的支持可以被视为“遗留功能”，它允许更平滑的过渡。它仅适用于不接受整数 0、1 和 c`__iter__`的类，并且一旦索引变得太高（如果有的话）就会引发，通常是在出现之前编码的“序列”类（尽管没有什么能阻止你以这种方式编码新类）。`__getitem__``IndexError``__iter__`

就个人而言，我宁愿不要在新代码中依赖它，尽管它没有被弃用也不会消失（在 Python 3 中也可以正常工作），所以这只是风格和品味的问题（“显式优于隐式”所以我宁愿明确地支持可迭代性，而不是依赖于`__getitem__`隐含地支持它——但是，不是很大）。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-05-29T15:29:22.177

如果您看一下定义迭代器的[PEP234](http://www.python.org/dev/peps/pep-0234)，它会说：

```
1\. An object can be iterated over with "for" if it implements
   __iter__() or __getitem__().

2\. An object can function as an iterator if it implements next(). 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2009-05-29T15:38:10.153

`__getitem__`早于迭代器协议，并且在过去是使事物可迭代的*唯一方法。*因此，它仍然被支持作为一种迭代方法。本质上，迭代的协议是：

1.  检查`__iter__`方法。如果存在，请使用新的迭代协议。

2.  否则，尝试`__getitem__`使用连续更大的整数值调用，直到引发 IndexError。

(2) 曾经是这样做的唯一方法，但缺点是它假设了支持迭代所需的更多内容。为了支持迭代，您必须支持随机访问，这对于文件或网络流之类的东西来说要昂贵得多，因为它们向前很容易，但向后移动则需要存储所有内容。 `__iter__`允许没有随机访问的迭代，但由于随机访问通常允许迭代，并且因为破坏向后兼容性会很糟糕，`__getitem__`所以仍然支持。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-29T15:28:06.157

特殊方法，例如`__getitem__`向对象添加特殊行为，包括迭代。

[http://docs.python.org/reference/datamodel.html#object。**获取项目**](http://docs.python.org/reference/datamodel.html#object.__getitem__)

“for 循环期望会为非法索引引发 IndexError，以允许正确检测序列的结尾。”

引发 IndexError 表示序列结束。

您的代码基本上相当于：

```
i = 0
while True:
    try:
        yield object[i]
        i += 1
    except IndexError:
        break 
```

其中 object 是您在 for 循环中迭代的内容。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-29T15:38:23.337

之所以如此，是因为历史原因。在 Python 2.2 之前，__getitem__ 是创建可以用 for 循环迭代的类的唯一方法。在 2.2 中添加了 __iter__ 协议，但为了保持向后兼容性 __getitem__ 仍然适用于 for 循环。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-29T15:26:14.180

因为`cb[0]`是一样的`cb.__getitem__(0)`。请参阅有关此的[python 文档](http://docs.python.org/reference/datamodel.html)。

# jquery - JQuery 自动完成文本框

> ID：926575
> 
> 赞同：4
> 
> 时间：2009-05-29T15:22:56.200
> 
> 标签：jquery, autocomplete

当我单击文本框而不输入任何内容时，如何使用 JQuery 实现自动完成。String[] 将返回一个预先构建的列表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-30T09:19:18.813

自动完成插件 ( [http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/) ) 是您最好的选择，特别是如果您在 AJAXy 应用程序中，因为它会转到您的服务器并获取可能的列表实时。

示例用法：

```
$("#sometextbox").autocomplete("search.php", {
    width: 260,
    selectFirst: false
}); 
```

然后 search.php 可能会返回：

```
Great Bittern|Botaurus stellaris
Little Bittern|Ixobrychus minutus
American Bittern|Botaurus lentiginosus 
```

您也可以动态生成输出，因为插件在 'q' 参数中传递在查询字符串中输入的文本。

为了回答在不输入任何内容的情况下触发自动完成，该插件不支持这一点，但以一种骇人听闻的方式实现起来相当简单：

该插件挂钩到框的 keydown（或 keypress）事件，如下所示（非缩小代码的第 92 行）：

```
$input.bind(($.browser.opera ? "keypress" : "keydown") + ".autocomplete",...) 
```

因此，您可以通过执行以下操作强制自动完成器运行：

```
$("#autocompletedInput").click(function() {
    $(this).trigger(($.browser.opera ? "keypress" : "keydown") + ".autocomplete");
} 
```

哪个*应该*触发事件。您可能需要将随机字符键码传递到触发器中，所以它不知道发生了什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T23:50:42.600

```
<pre>'<input type="text"/><div class=displayPanel></div>'</pre> 
```

$jq('input').bind('click', function() {

> $jq('.displayPanel').slideDown('slow', function() {
> 
> > this.text = 文本数组；
> 
> });

});

我不知道这是否是你需要的，但是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T09:13:11.027

您是否尝试过 jQuery 的自动完成插件之一？

即[http://plugins.jquery.com/project/js-autocomplete](http://plugins.jquery.com/project/js-autocomplete)，但还有其他几个。

# python - 配置 Apache 以从 mod_python 错误中恢复

> ID：926579
> 
> 赞同：0
> 
> 时间：2009-05-29T15:23:29.677
> 
> 标签：python, django, apache, mod-python

我正在使用 mod_python 在 Apache 上托管一个 Django 应用程序。偶尔，我得到一些神秘的 mod_python 错误，通常是`ImportError`各种各样的，尽管通常不是指同一个模块。问题是，这些似乎是针对单个分叉子进程的，而其他子进程运行良好，即使我强制要求使用问题进程出错的模块的行为也是如此。一旦进程遇到错误，每次 Apache 选择它来处理请求时，它总是会提供相同的回溯。（这也很麻烦，因为我的用户不一定会在第一次出现错误时报告错误，并且一旦过程遇到错误。）

与配置 Apache 相比，我对配置 Django 的了解更多，但这对我没有任何帮助，因为请求永远不会到达 Django 进行处理。理想情况下，我应该解决根本问题，这可能涉及我的代码、项目或机器配置，但在那之前，我需要帮助来诊断和缓解问题。

1.  有什么方法可以配置 Apache 日志以包含子进程 ID？
2.  如果遇到错误，有什么方法可以强制子进程重新生成？
3.  我应该知道与此相关的任何已知问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T23:16:35.507

作为一种解决方法，假设您可以在服务器上自由安装新的 Apache 模块，您可以尝试以下方法之一

*   mod_scgi
*   mod_fastcgi
*   mod_wsgi

反而。我使用 SCGI 将 nginx 前端网络服务器连接到我的 Django 应用程序，这突出了一个主要好处（与网络服务器分离）。所有这些软件包都在 Debian 中可用，可能也在 RHELx 上。

# jquery - 使用jQuery查找文本字符串？

> ID：926580
> 
> 赞同：247
> 
> 时间：2009-05-29T15:23:48.177
> 
> 标签：jquery, text

假设一个网页有一个字符串，例如“我是一个简单的字符串”，我想找到它。我将如何使用 JQuery 来解决这个问题？

* * *

## 回答 #1

> 赞同：334
> 
> 时间：2009-05-29T15:34:20.030

jQuery 有 contains 方法。这是给你的一个片段：

```
<script type="text/javascript">
$(function() {
    var foundin = $('*:contains("I am a simple string")');
});
</script> 
```

上面的选择器选择包含目标字符串的任何元素。foundin 将是一个包含任何匹配元素的 jQuery 对象。参见 API 信息：[https ://api.jquery.com/contains-selector/](https://api.jquery.com/contains-selector/)

使用“*”通配符需要注意的一件事是，您将获得所有元素，包括您的 html 和 body 元素，这可能是您不想要的。这就是为什么 jQuery 和其他地方的大多数示例都使用 $('div:contains("I am a simple string")')

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-05-29T16:20:21.803

通常 jQuery 选择器不会在 DOM 中的“文本节点”内进行搜索。但是，如果您使用 .contents() 函数，将包含文本节点，那么您可以使用 nodeType 属性仅过滤文本节点，并使用 nodeValue 属性搜索文本字符串。

```
    $('*', '正文')
        .andSelf()
        。内容（）
        .filter（函数（）{
            返回 this.nodeType === 3;
        })
        .filter（函数（）{
            // 仅当文本中任何位置包含“简单字符串”时才匹配
            return this.nodeValue.indexOf('simple string') != -1;
        })
        .每个（函数（）{
            // 用 this.nodeValue 做点什么
        });

```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-05-29T16:40:03.330

这将只选择包含“I am a simple string”的叶子元素。

```
$('*:contains("I am a simple string")').each(function(){
     if($(this).children().length < 1) 
          $(this).css("border","solid 2px red") }); 
```

将以下内容粘贴到地址栏中进行测试。

```
javascript: $('*:contains("I am a simple string")').each(function(){ if($(this).children().length < 1) $(this).css("border","solid 2px red") }); return false; 
```

如果你只想抓住*"I am a simple string"*。首先将文本包装在这样的元素中。

```
$('*:contains("I am a simple string")').each(function(){
     if($(this).children().length < 1) 
          $(this).html( 
               $(this).text().replace(
                    /"I am a simple string"/
                    ,'<span containsStringImLookingFor="true">"I am a simple string"</span>' 
               )  
           ) 
}); 
```

然后执行此操作。

```
$('*[containsStringImLookingFor]').css("border","solid 2px red"); 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-05-29T16:49:42.413

如果您只想要最接近您正在搜索的文本的节点，您可以使用这个：

```
$('*:contains("my text"):last'); 
```

如果您的 HTML 如下所示，这甚至会起作用：

```
<p> blah blah <strong>my <em>text</em></strong></p> 
```

使用上面的选择器将找到`<strong>`标签，因为这是包含整个字符串的最后一个标签。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-05-29T15:25:26.427

看看[highlight](http://johannburkard.de/blog/programming/javascript/highlight-javascript-text-higlighting-jquery-plugin.html)（jQuery插件）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-12-10T09:27:02.527

只是添加到托尼米勒的答案，因为这让我对我正在寻找的东西有 90% 的了解，但仍然没有工作。添加`.length > 0;`到他的代码末尾使我的脚本正常工作。

```
 $(function() {
    var foundin = $('*:contains("I am a simple string")').length > 0;
 }); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-06-13T18:42:06.533

这个功能应该可以工作。基本上进行递归查找，直到我们得到一个不同的叶节点列表。

```
function distinctNodes(search, element) {
    var d, e, ef;
    e = [];
    ef = [];

    if (element) {
        d = $(":contains(\""+ search + "\"):not(script)", element);
    }
    else {
            d = $(":contains(\""+ search + "\"):not(script)");
    }

    if (d.length == 1) {
            e.push(d[0]);
    }
    else {
        d.each(function () {
            var i, r = distinctNodes(search, this);
            if (r.length === 0) {
                e.push(this);
            }
            else {
                for (i = 0; i < r.length; ++i) {
                    e.push(r[i]);
                }
            }
        });
    }
    $.each(e, function () {
        for (var i = 0; i < ef.length; ++i) {
            if (this === ef[i]) return;
        }
        ef.push(this);
    });
    return ef;
} 
```

# c# - ShowDialog() 不会使窗口模态化

> ID：926582
> 
> 赞同：6
> 
> 时间：2009-05-29T15:24:11.780
> 
> 标签：c#, winforms

我有一个 windows 窗体，如果在窗体加载时满足某些条件，它会弹出一个对话框。问题是窗口没有停留在顶部，我仍然可以单击父项上的东西。但是，表单上有一个按钮，按下时会打开同一个窗口，当我这样做时，它会按预期工作（如对话框窗口）。

首次加载表单时显示对话框是否存在问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:31:41.970

您是从 Form 类中调用 ShowDialog 吗？因为如果从另一个窗体调用它只会设置父窗口。或者，您可以使用具有[IWin32Window](http://msdn.microsoft.com/en-us/library/aa335146(VS.71).aspx)参数的重载来专门设置所有者。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:39:17.283

你能进一步解释这个问题吗，因为这是我的代码，它在对话框关闭之前不会显示它自己的表单，无论你是否设置了父级

```
 private void Form1_Load(object sender, EventArgs e)
        {
            //your functionality goes here    
            AboutBox1 box = new AboutBox1();
            box.ShowDialog();
        }
    } 
```

另一方面，您也可以查看 TopMost 属性

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-31T03:16:35.080

大炸弹，

为了做你想做的事，你必须从你的主窗体的构造函数中调用你的模态对话框，而不是从 Form_Load 事件中。

像这样的东西：

```
 public Form1()
    {
        InitializeComponent();
        this.Show();
        Form2 popupForm = new Form2();
        popupForm.ShowDialog();
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-31T01:42:45.127

ShowDialog 方法需要从您希望成为其父/所有者的表单中调用，以使其成为该表单的模态。或者，我相信您可以直接设置对话框的所有者，但我从来不需要这样做。

# javascript - 在 IE7 上检测 adobe flash 版本 - vista

> ID：926588
> 
> 赞同：0
> 
> 时间：2009-05-29T15:25:28.597
> 
> 标签：javascript, flash, windows-vista, internet-explorer-7

看来我无法在 Vista/IE7 上检测到已安装的 flash 版本。

以下代码失败：

```
var x = new ActiveXObject('ShockwaveFlash.ShockwaveFlash'); 
```

我得到的错误是：

```
automation server cannot create object 
```

查看 Adob​​e Flash 检测工具包（来自 adobe），它看起来也失败了。我只有一台 vista 机器可以测试，所以我很好奇：

*   有没有办法解决这个问题
*   每个人都会出现这个问题吗？

我已经在 Windows XP 上的 IE6 和 IE7 上成功地测试了这个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-08-26T15:29:12.790

看起来 swfobject - [http://code.google.com/p/swfobject/](http://code.google.com/p/swfobject/) - 是一个实际可行的选项。

“它是 SWFObject 1.5、UFO 和 Adob​​e Flash Player 检测工具包的继任者。” - [http://www.adobe.com/devnet/flashplayer/articles/swfobject.html](http://www.adobe.com/devnet/flashplayer/articles/swfobject.html)

代码看起来像这样（没有在没有安装 Flash 的机器上测试过）：

```
<script type="text/javascript" src="/Scripts/swfobject/swfobject.js"></script>
<script type="text/javascript">
$(window).load(function() {
    try {
        var flashPlayer = swfobject.getFlashPlayerVersion();
        var flashVersion = flashPlayer.major + "." + flashPlayer.minor + "." + flashPlayer.release;
    } catch (ex) {
    }
});
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T18:16:52.060

关于如何检索当前安装的 Flash 版本的版本有[很好的示例。](http://www.derekentringer.com/blog/actionscript-detect-flash-version/)所有类似的示例都使用 actionscript (v2+)，它们只是收集有关 flash 版本的信息并将其显示给用户。

# eclipse - 在 Eclipse 3.5 中安装一个普通的插件 jar

> ID：926594
> 
> 赞同：57
> 
> 时间：2009-05-29T15:27:27.187
> 
> 标签：eclipse

由于 Eclipse 3.5 似乎没有选项可以在 Eclipse 基本目录中放置一个插件 jar（不是功能）并在下次启动时将其拾取。

是否有可能在 Eclipse 3.5 中安装普通插件 jar？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-05-29T16:37:19.373

自 p2 出现以来，您应该改用[dropins 目录](http://wiki.eclipse.org/Equinox_p2_Getting_Started#Dropins)。

> 要完全清楚，在“/dropins”下创建“插件”，并确保使用“-clean”选项重新启动 Eclipse。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-31T10:48:03.277

最简单的方法 - 只需放入 Eclipse 插件文件夹。您可以使用 -clean 选项启动 Eclipse，以确保 Eclipse 清理其插件缓存并查看新插件。

通常，更建议使用适当的更新站点安装插件。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2016-04-09T14:35:15.247

对于 Eclipse Mars（我刚刚验证过）你要这样做（假设 C:\eclipseMarsEE 是你的 Eclipse 的根文件夹）：

1.  将**插件**文件夹添加到 C:\eclipseMarsEE\dropins 使其看起来像： C:\eclipseMarsEE\dropins\plugins
2.  然后将要安装的插件添加到该文件夹​​中：C:\eclipseMarsEE\dropins\plugins\someplugin.jar
3.  使用 clean 选项启动 Eclipse。
4.  如果您在桌面上使用快捷方式，则只需右键单击 Eclipse 图标 > 属性，然后在目标字段中添加：-clean，如下所示：C:\eclipseMarsEE\eclipse.exe **-clean**

[![在此处输入图像描述](https://i.stack.imgur.com/GY5qg.png)](https://i.stack.imgur.com/GY5qg.png)

5.  启动 Eclipse 并验证您的插件是否有效。
6.  从目标字段中删除**-clean**选项。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-06-07T16:15:16.143

转到`Help`-> `Install New Software...`-> `Add`-> `Archive...`。完毕。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-07-25T07:57:21.477

在 Eclipse 4.4.1 中

1.  在“C:\eclipse\plugins”中复制 jar
2.  编辑文件“C:\eclipse\configuration\org.eclipse.equinox.simpleconfigurator\bundles.info”
3.  添加罐子信息。例子： `com.soft4soft.resort.jdt,2.4.4,file:plugins\com.soft4soft.resort.jdt_2.4.4.jar,4,false`
4.  重启 Eclipse。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-05-20T10:30:14.640

您可以这样做：

1.  关闭日食
2.  下载一个 jar 插件（假设它的 testNG.jar）
3.  将 testNG.jar 复制到某个文件夹（比如 C:\Project\resources\plugins）
4.  在您的 Eclipse 安装文件夹中，有一个名为 dropins 的文件夹（可能是 C:\eclipse\dropins），在该文件夹中创建一个 .link 文件（如 plugins.link）
5.  使用任何文本编辑器打开此文件并输入这一行：
    *path=C:/Project/resources/plugins*

6.  保存文件并启动 Eclipse。

你很高兴去！

**请不要忘记在步骤 5 中将插件文件夹路径中的反斜杠更改为正斜杠。我以前忘记了，这会花费我不必要的时间。**

# asp.net-mvc - ASP.NET MVC如何传递参数

> ID：926595
> 
> 赞同：0
> 
> 时间：2009-05-29T15:27:28.687
> 
> 标签：asp.net-mvc, parameters

我想在 View A.aspx 上有一些隐藏的输入并将值传递给控制器​​。其中一个值是 bool，另一个是 char。

如何在 Controller 中获取那些隐藏的输入值？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T15:31:44.370

有很多方法可以做到这一点，只需使用 Html->Hidden()，然后提取控制器参数中的信息，如 action(char param1, bool param2)。如果您发布 true/false，那么 .NET 将为您完成转换工作。同样，您也可以附加到查询中。

# tsql - 通过 HQL 在 TSQL 中的日期时间和时间跨度算术

> ID：926599
> 
> 赞同：0
> 
> 时间：2009-05-29T15:28:27.887
> 
> 标签：tsql, hql

我需要创建一个 HQL where 子句，其形式为：

```
where tbl1.DateTimeField + tbl2.TimeSpanField >= :someDateTimeParameter 
```

DateTimeField 的类型为 DateTime

TimeSpanField 是 BigInt 类型（这是最好的选择吗？）

someDateTimeParameter 是 DateTime

如上所述编写 HQL 查询几乎可以完全转换为 TSQL，但这显然是无效的。

1.  我需要做什么才能让这个 where 子句起作用？我可以使用一些 HQL 技巧吗？
2.  如果没有，我如何编写 HQL 以使用一些 TSQL 函数为我做比较？
3.  我需要什么 TSQL？

谢谢！

安德鲁

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-24T11:11:10.073

对于 1 和 2，请参阅[在 HQL 中执行日期/时间数学？](https://stackoverflow.com/questions/639522/performing-date-time-math-in-hql)寻求答案。对于 3 使用 dateadd 或 datediff（谷歌为 t-sql + 函数名）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-24T12:58:48.967

我最终将时间跨度存储为从 1900 年 1 月 1 日偏移的日期时间，就像这样

```
protected readonly DateTime leadTimeAdjustment = new DateTime(1900, 1, 1);

[Obsolete("For use by NHibernate only.")]
public virtual DateTime _leadTime { get; protected set; }

public virtual TimeSpan LeadTime
{
    get { return _leadTime - leadTimeAdjustment; }
    set { _leadTime = leadTimeAdjustment.Add(value); }
} 
```

# windows - IMAPI2 可以刻录大于 4Gb 的文件吗？

> ID：926606
> 
> 赞同：1
> 
> 时间：2009-05-29T15:29:07.497
> 
> 标签：windows, imapi

IMAPI2 接口 IFileSystem 使用 COM IStream 接口来表示文件数据。有 AddTree 方法将指定的目录内容添加到 IFileSystem。所以 AddTree 必须在这个过程中创建 IStream。我想知道它使用什么 IStream 实现？如果它使用标准的 OLE 实现，我们就会遇到一个讨厌的问题，因为 OLE 流不支持大于 4Gb 的文件。

任何人都可以对这个问题有所了解吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-11-13T16:42:04.577

IMAPIv2 将 ISO9660 兼容光盘上的文件大小限制为 2GB。

为了刻录超过 2GB 的文件，您必须设置 UDF 文件系统。

```
 HRESULT hr = FileSystemImage->put_FileSystemsToCreate( FsiFileSystemUDF ); 
```

FsiFileSystems枚举定义了[已](http://msdn.microsoft.com/en-us/library/windows/desktop/aa364840%28v=vs.85%29.aspx)识别文件系统的值：

```
typedef enum FsiFileSystems { 
  FsiFileSystemNone     = 0,
  FsiFileSystemISO9660  = 1,
  FsiFileSystemJoliet   = 2,
  FsiFileSystemUDF      = 4,
  FsiFileSystemUnknown  = 0x40000000
} FsiFileSystems; 
```

> *   FsiFileSystemNone 光盘不包含可识别的文件系统。
> *   FsiFileSystemISO9660 标准 CD 文件系统。
> *   FsiFileSystemJoliet Joliet 文件系统。
> *   FsiFileSystemUDF UDF 文件系统。
> *   FsiFileSystemUnknown 光盘似乎有文件系统，但布局与任何可识别的类型都不匹配。

UDF 原生支持许多现代文件系统功能：

*   大分区大小（512B 块大小最大 2TB，或 2KB 块大小最大 8TB）64 位文件大小
*   没有大小限制的扩展属性（例如，命名流或分支）
*   长文件名（最大 254 字节，名称中可以出现任何字符）
*   文件名的 Unicode 编码
*   稀疏文件
*   硬链接
*   符号链接
*   元数据校验和

限制：

*   有限的分区大小。对于 512 个扇区大小，32 位块号将分区大小限制为 2TB。
*   不支持压缩/加密文件和目录。

# sharepoint - Sharepoint 功能，各种站点级别的自定义 aspx 页面

> ID：926607
> 
> 赞同：0
> 
> 时间：2009-05-29T15:29:16.123
> 
> 标签：sharepoint, moss, wss

我在[这里](https://stackoverflow.com/questions/898094/sharepoint-wsp-solutions-and-page-urls)问过类似的问题，但更具体的是什么。

我希望能够部署解决方案并激活将各种自定义 aspx 页面配置到我网站中不同站点级别的功能。

所以我的第一个自定义 aspx 页面将位于根目录：[http ://example.org/custompage1.aspx](http://example.org/custompage1.aspx)

然后另一个自定义 aspx 页面将出现在更深层次：[http ://example.org/subsite1/custompage2.aspx](http://example.org/subsite1/custompage2.aspx)

我的解决方案仅限于“网络”级别。如果我在子站点级别激活该功能，我可以访问应该出现在这个更深层次的自定义 aspx 页面，但是，我也可以访问应该只出现在网站根目录的其他页面，例如[http:// example.org/subsite1/custompage1.aspx](http://example.org/subsite1/custompage1.aspx)

哪个是错的，错的，错的！

我试图将功能范围限定为“站点”，但这似乎只提供了根自定义 aspx 页面，而不是应该出现在网站更深层次的页面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T16:51:34.363

“自定义 aspx”页面在 SharePoint 中称为“应用程序”页面，它们部署在 _layouts 目录中（通常是 C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\TEMPLATE\LAYOUTS）。Layouts 目录中的所有页面都可以从 Web 应用程序中的每个站点获得。

如果您事先知道哪个页面与哪个站点一起使用，那么您可以在每个自定义页面中放置代码，检查是否从“无效”站点访问它，如果是，则抛出自定义 404 错误（参见此处：[隐藏功能的 ASP.NET](https://stackoverflow.com/questions/54929/hidden-features-of-asp-net/55229#55229) ) 或类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-30T06:03:28.863

您在功能 xml 中所做的任何事情都将仅适用于激活该功能的站点。如果您想基于相对 url 在多个站点上做某事，您将需要设置一个功能接收器并使用自定义代码将文件/功能部署到其他站点。

最简单的方法可能是在您的解决方案中创建一个单独的 Web 范围的功能，并让站点范围的功能接收器在子站点上激活它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T18:47:08.217

克洛菲尔确定了答案。我只想补充一点，您可以在页面中使用 SPContext.Current.Web 来确定您在调用时所在的网站。

# web-services - 带有 SOAP 请求的 Asp Classic 调用 web 服务

> ID：926611
> 
> 赞同：2
> 
> 时间：2009-05-29T15:29:29.383
> 
> 标签：web-services, asp-classic

我试图在不使用 get 参数的情况下从 ASP.NET Web 服务获得响应。我有以下代码。

```
strBarcode = "ABC123
strURL ="http://serverName/BarcodeGenerator.asmx"
Set xmlReq = Server.CreateObject("Msxml2.DOMDocument.3.0")
Set xmlResp = Server.CreateObject("Msxml2.DOMDocument.3.0")
Set httpReq = Server.CreateObject("MSXML2.ServerXMLHTTP") 

xmlReq.async = false
strXML = CStr(CreateRequest(strBarcode ))

xmlReq.loadXML(CStr(strXML))

//Open, async

httpReq.open "POST", CStr(strURL), true 

httpReq.setRequestHeader "Host", "serverName"
httpReq.setRequestHeader "Content-Type", "text/xml; charset=utf-8"
httpReq.setRequestHeader "SOAPAction", "http://tempuri.org/GetBarcode"

httpReq.send(xmlReq)

strDone = "0"
bTimeout = false
dStart = Now()
dEnd = Now()
lCounter = 0
lCounterPrev = -1   
intStatus = 0
Do while intStatus <> 4 and (Not bTimeout)
   dEnd = Now()
   lCounter = DateDiff("s",dStart,dEnd)

   if lCounter > 30 then bTimeout = True       
   %>. <%      
   'Wait a second
   httpReq.waitForResponse 1000
   intStatus = httpReq.readyState
Loop

If httpReq.readyState = 4 Then
    bTimeout = false
    Set xmlResp = httpReq.responseXML
    %>
    Status: <%=httpReq.statusText%><BR>
    Response: <%=httpReq.responseText%> <BR><BR>
    <%
    Set nodes = xmlResp.getElementsByTagName("GetBarcodeResult")
    If (nodes is nothing) THen
    %>Nodes is NULL<BR><%
    Else
    %>Number of Nodes: <%=nodes.length%><%
    End IF
    Set node = nodes(0)
    url = node.nodeValue
End If 
```

状态是

> 状态：错误请求

响应是

> 响应：错误请求（无效的主机名）

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T18:25:04.330

这篇[文章](https://web.archive.org/web/20110924001231/http://www.mrtweak.com/windows-servers/iis-server/fixing-a-bad-request-invalid-hostname-400-error-on-windows-iis/)（现在通过 web.archive.org 为后代）解释得最好，但基本上，由于 IIS 配置，服务器无法定位自己（classic-asp 和 web 服务托管在同一台服务器上）。代码没有问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-31T20:31:36.577

您的代码正在尝试设置 Host 标头本身。你不应该这样做。

ServerXMLHTTP 将为您从提供的 URL 绘制主机字符串执行此操作。通过尝试自己添加它，您正在破坏 HTTP 协议的一个重要标准。Host 是 1.1 协议中最基本的标头，它是 1.1 请求中必须存在的唯一标头。

我不确定您为什么使用异步请求和 WaitForResponse 只是为了检测超时。为什么不使用 setTimeouts 方法和同步请求？

# .net - 使用 RegEx 正确匹配 HTML 中的结束标签与其起始标签

> ID：926617
> 
> 赞同：0
> 
> 时间：2009-05-29T15:30:43.547
> 
> 标签：.net, asp.net, vb.net, regex, asp.net-2.0

我在 ASP.Net 2.0 应用程序中使用 VB.Net 来运行一些删除一些不必要标记的正则表达式。我想做的一件事是删除其中没有任何属性的 span 元素：

```
output = Regex.Replace(output, "<span\s*>(?<Text>.*?)</span>" & styleRegex, "${Text}", RegexOptions.Compiled Or RegexOptions.CultureInvariant Or RegexOptions.IgnoreCase Or RegexOptions.Singleline) 
```

所以对于这个内容：

```
<span>Lorem <span class="special">ipsum</span> dolor sit amet.</span> 
```

我想删除外部跨度元素。不幸的是，我上面的正则表达式给了我这个结果，因为关闭跨度匹配它遇到的第一个：

```
Lorem <span class="special">ipsum dolor sit amet.</span> 
```

这是否可以通过正则表达式实现，还是我必须实现一些更高级的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-30T00:01:20.597

不幸的是，正则表达式没有这种能力。你至少需要一种上下文相关的语言来表达类似的东西。（对不起[理论的东西](http://en.wikipedia.org/wiki/Chomsky_hierarchy)）

我还建议改用 XSLT。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T23:33:53.083

我会使用 XSLT 而不是正则表达式。

.NET 似乎对 XSLT 有很好的支持（谷歌：xslt vb.net），但我不知道它是否会解析非 XHTML。标准的 xsltproc 命令将带有 --html 标志。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T06:49:50.767

HTML 敏捷包应该对此有所帮助。

[Codeplex 上的 HTML 敏捷包](http://www.codeplex.com/htmlagilitypack "Codeplex 上的 HTML 敏捷包")

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-18T21:11:30.190

XSLT 不是一个选项，因为输入可能并不总是有效的 XML，而且[Codeplex 上的 HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)看起来很不错，但在这种情况下确实有点矫枉过正。这是我最终使用的最后一个 RegEx：

```
<span\s*>(?<Text>.*?(?:<span[^>]*>.*?</span>.*?)*)</span> 
```

在我测试过的所有情况下，将其替换为`${Text}`有效地去除了无用的外部标签。`span`

# asp.net - VB.NET Repeater 无数据源的简单数据绑定

> ID：926619
> 
> 赞同：4
> 
> 时间：2009-05-29T15:31:08.413
> 
> 标签：asp.net, vb.net, repeater, datarepeater

我有一个表格，必须是网页上的转发器。我有一个数字参数，告诉我要添加多少额外的客户详细信息。在此页面中，我有一个需要重复项目一定次数的中继器控件。对于每个项目，都有一组输入框，需要附加一个 id。我需要绑定的是每个附加输入框的数字，即`<% #id %>`. 我不知道如何在没有特定数据源的情况下设置简单的数据绑定，而只是在循环中构建一个。

```
<asp:Repeater ID="myRepeater" runat="server"> 
    <HeaderTemplate>  
       <div class="AdditionalRowTitle">
            <div class="AdditionalCellTitle">Title</div>
            <div class="AdditionalCellFirstName">First Name</div>
            <div class="AdditionalCellLastName">Last Name</div>
            <div class="AdditionalCellDOB">DOB</div>
            <div class="AdditionalCellRelationship">Relationship</div>
        </div>
    </HeaderTemplate>

    <ItemTemplate>
       <div class="AdditionalRow">
            <div class="AdditionalInputTitle">
                <asp:DropDownList ID="AdTitle" runat="server">
                    <asp:ListItem Selected="True" Value="" Text=""/>
                    <asp:ListItem Selected="False" Value="Miss" Text="Miss"/>
                    <asp:ListItem Selected="False" Value="Ms" Text="Ms"/>
                    <asp:ListItem Selected="False" Value="Mrs" Text="Mrs"/>
                    <asp:ListItem Selected="False" Value="Mr" Text="Mr"/>
                    <asp:ListItem Selected="False" Value="Other" Text="Other"/>
                </asp:DropDownList>
            </div>

            <div class="AdditionalInputFirstName">
                <asp:TextBox ID="AdFirstName" runat="server"></asp:TextBox>
            </div>

            <div class="AdditionalInputLastName">
                <asp:TextBox ID="AdLastName" runat="server"></asp:TextBox>
            </div>

            <div class="AdditionalInputDOB">
                <asp:DropDownList ID="AdDOBDay" runat="server">
                    <asp:ListItem Selected="True" Value="" Text=""/>
                    <asp:ListItem Selected="False" Value="1" Text="1"/>
                    <asp:ListItem Selected="False" Value="2" Text="2"/>
                    <asp:ListItem Selected="False" Value="3" Text="3"/>
                    <asp:ListItem Selected="False" Value="4" Text="4"/>
                    <asp:ListItem Selected="False" Value="5" Text="5"/>
                    <asp:ListItem Selected="False" Value="6" Text="6"/>
                    <asp:ListItem Selected="False" Value="7" Text="7"/>
                    <asp:ListItem Selected="False" Value="8" Text="8"/>
                    <asp:ListItem Selected="False" Value="9" Text="9"/>
                    <asp:ListItem Selected="False" Value="10" Text="10"/>
                    <asp:ListItem Selected="False" Value="11" Text="11"/>
                    <asp:ListItem Selected="False" Value="12" Text="12"/>
                    <asp:ListItem Selected="False" Value="13" Text="13"/>
                    <asp:ListItem Selected="False" Value="14" Text="14"/>
                    <asp:ListItem Selected="False" Value="15" Text="15"/>
                    <asp:ListItem Selected="False" Value="16" Text="16"/>
                    <asp:ListItem Selected="False" Value="17" Text="17"/>
                    <asp:ListItem Selected="False" Value="18" Text="18"/>
                    <asp:ListItem Selected="False" Value="19" Text="19"/>
                    <asp:ListItem Selected="False" Value="20" Text="20"/>
                    <asp:ListItem Selected="False" Value="21" Text="21"/>
                    <asp:ListItem Selected="False" Value="22" Text="22"/>
                    <asp:ListItem Selected="False" Value="23" Text="23"/>
                    <asp:ListItem Selected="False" Value="24" Text="24"/>
                    <asp:ListItem Selected="False" Value="25" Text="25"/>
                    <asp:ListItem Selected="False" Value="26" Text="26"/>
                    <asp:ListItem Selected="False" Value="27" Text="27"/>
                    <asp:ListItem Selected="False" Value="28" Text="28"/>
                    <asp:ListItem Selected="False" Value="29" Text="29"/>
                    <asp:ListItem Selected="False" Value="30" Text="30"/>
                    <asp:ListItem Selected="False" Value="31" Text="31"/>
                </asp:DropDownList>

                <asp:DropDownList ID="AdDOBMonth" runat="server">
                    <asp:ListItem Selected="True" Value="" Text=""/>
                    <asp:ListItem Selected="False" Value="1" Text="January"/>
                    <asp:ListItem Selected="False" Value="2" Text="Febuary"/>
                    <asp:ListItem Selected="False" Value="3" Text="March"/>
                    <asp:ListItem Selected="False" Value="4" Text="April"/>
                    <asp:ListItem Selected="False" Value="5" Text="May"/>
                    <asp:ListItem Selected="False" Value="6" Text="June"/>
                    <asp:ListItem Selected="False" Value="7" Text="July"/>
                    <asp:ListItem Selected="False" Value="8" Text="August"/>
                    <asp:ListItem Selected="False" Value="9" Text="September"/>
                    <asp:ListItem Selected="False" Value="10" Text="October"/>
                    <asp:ListItem Selected="False" Value="11" Text="November"/>
                    <asp:ListItem Selected="False" Value="12" Text="December"/>
                </asp:DropDownList>

                <asp:DropDownList ID="AdDOBYear" runat="server">
                </asp:DropDownList>

                <ajaxToolkit:CascadingDropDown ID="CascadingDropDown2"
                                           Category="AdDOBYear"
                                           LoadingText=""
                                           ServicePath="TravelWebService.asmx"
                                           ServiceMethod="GetYears"
                                           PromptText=""
                                           TargetControlID="AdDOBYear"
                                           runat="server">
                </ajaxToolkit:CascadingDropDown>
            </div>

            <div class="AdditionalInputRelationship">
                <asp:DropDownList ID="AdRelationship" runat="server">
                    <asp:ListItem Selected="True" Value="" Text=""/>
                    <asp:ListItem Selected="False" Value="Partner" Text="Partner"/>
                    <asp:ListItem Selected="False" Value="Child" Text="Child"/>
                    <asp:ListItem Selected="False" Value="Unrelated" Text="Unrelated"/>
                </asp:DropDownList>
            </div>
        </div>
   </ItemTemplate>
</asp:Repeater> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T15:57:49.257

这是一种重复项目的方法。在页面加载事件中，添加以下内容：

```
Dim repeatTimes() As Integer = New Integer(){1, 2, 3}
myRepeater.DataSource = repeatTimes
myRepeater.DataBind() 
```

重复器项将按数组中的元素数重复。在这种情况下，有 3 个元素。数组的实际内容无关紧要，只是元素的数量。

**编辑：**我不太了解 VB.NET，但我认为这应该可行

```
Sub Page_Load()
  Dim NumberToRepeat As Integer ''*Should come from the parameter
  If Not Page.IsPostBack Then
    Dim repeatTimes(NumberToRepeat) As Integer
    myRepeater.DataSource = repeatTimes
    myRepeater.DataBind()
  End If
End Sub 
```

# wpf - MVVM ICommand 替代方案

> ID：926622
> 
> 赞同：4
> 
> 时间：2009-05-29T15:31:16.680
> 
> 标签：wpf, mvvm, viewmodel

我已经开始创建一个 wpf mvvm 应用程序。ViewModel 的一个重要组成部分似乎是一堆 ICommand，它们具有允许视图与 viewmodel 交互的松散耦合方式。

我的问题是，为什么我不能直接绑定到一个方法？

我使用了 Josh Smith 的 ICommand 的 RelayCommand 实现，它允许您将 delgate 注入到 ICommand 对象中，但实际上，是否有一些更简单的方法可以让按钮按下来调用视图模型中的方法？

我是 MVVM 的新手，我相信我需要一些启发

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T15:48:23.120

您不能直接绑定到方法，因为`Button`（例如）没有接受委托的属性。相反，它具有`Command`type 的属性`ICommand`。A `RelayCommand`(aka `DelegateCommand`) 只是`ICommand`包装代表的一个。

我看不出为什么视图无法通过标记扩展绑定到视图模型上的特定方法的技术原因：

```
<Button Command="{ViewModelMethod SomeMethodName}"/> 
```

但是，这会更慢，并且会增加视图和视图模型之间的耦合。如果视图只知道 type 视图模型上的一个属性，`ICommand`那么该命令的实现可能会完全改变（或者方法可能被重命名）而视图不知道。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-19T00:59:27.127

我完全不同意。

调用的速度无关紧要：命令是用户交互，它们从不需要速度。

关于耦合的论点也是有缺陷的。为什么 {Binding MyProperty} 不是耦合，而 {ViewMethod MyMethod} 是耦合？

将特制的“命令”包裹在方法周围的要求是愚蠢的。命令可能是隐蔽的有用实现，但我们已经在 C# 中有方法，用大而笨重的东西替换它们是不对的。

还有关于 MarkupExtension 和 Binding 的事情，真的很难。但这是可以完成的。其实已经搞定了，你可以看看 CodePlex 上的 MethodCall 项目：http: [//methodcallthing.codeplex.com/](http://methodcallthing.codeplex.com/)

您可以使用绑定为方法选择“this”，并且可以使用绑定来获取参数。所有这些都是实时的，即在调用命令时计算。另一个好处是方法调用的推送结果，您也可以为此使用绑定（OneWayToSource）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-09-02T23:47:24.380

ICommand 为您提供控制启用所需的 CanExecute。一个简单的委托没有。ICommand 是要走的路。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-06-24T21:06:14.133

显然微软需要一个命令来成为一流的东西，可能是因为他们认为拥有 CanExecute 对于大多数应用程序来说是必要的。我不同意并认为 CanExecute 应该只是另一个 DependencyProperty，您将绑定到您的视图模型的属性，但是，嘿，我知道什么？

可能他们还认为有必要将命令的实现与控件的数据上下文分离。再一次，这对我来说似乎没有必要，因为逻辑应该靠近正在操作的数据，这是 OO 的基本原则。

就我个人而言，我避免在 MVVM 中使用命令，因为你必须创建混乱来实现它们。我只是让视图的代码隐藏将事件委托给视图模型。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-01-06T13:48:31.643

由于此问题标题的措辞方式，读者可能会在这里寻找替代方法`ICommand`，而不仅仅是将 UI 操作直接绑定到 viewModel 方法的方法。（这没有什么价值，因为它留下了如何处理“CanExecute”部分的问题。）

的使用本身`ICommand`是有问题的，因为它是`Windows.Input`在`ICommand`可能会注意到`MessageBox`还有大量其他 GUI 功能可用，并可能开始使用它，从而导致混合应用程序逻辑和表示逻辑的混乱局面。

所以，如果你想摆脱`using System.Windows`，那么你需要摆脱`ICommand`，如果你想摆脱`ICommand`，那么你可能会很高兴知道以下内容：

## WPF（特别是 XAML 设计器）不需要您的 viewModel*静态*公开接口的实例`ICommand`。

*这里的静态*是指设计者不需要能够在设计期间使用反射来证明您的命令对象实现了接口`ICommand`；取而代之的是，WPF***在运行时***检查以确保 UI 操作绑定到实际上最终实现了`ICommand`.

因此，在您的 viewModels（应用程序逻辑）而不是`ICommand`WPF 的接口中，您可以使用`Command`自己设备的某些接口，并且您需要确保的是，您将在运行时实例化以实现您的`Command`接口的类也`ICommand`实现让 WPF 开心。通过这种方式，您可以避免`ICommand`在您的 ViewModel 中包含，并且随后您可能能够避免`System.Windows`在您的应用程序逻辑中进行引用。

# wpf - 为什么我的 XAML 编辑器会给我一个错误但项目编译并运行良好？

> ID：926625
> 
> 赞同：0
> 
> 时间：2009-05-29T15:31:56.930
> 
> 标签：wpf, xaml

我已经实现了**编译和运行良好的**[附加行为命令模式](http://marlongrech.wordpress.com/2008/12/13/attachedcommandbehavior-v2-aka-acb/)，但奇怪的是我的 XAML 编辑器给出了错误：

 **> 在类型“CommandBehaviorCollection”中找不到可附加属性“行为”。

在这个 XAML 中：

```
 <c:CommandBehaviorCollection.Behaviors>
        <c:BehaviorBinding Event="MouseLeftButtonDown" 
                           Command="{Binding PressedLeftButton}"
                           CommandParameter="MainBorder123"/>
        <c:BehaviorBinding Event="MouseRightButtonDown" 
                           Command="{Binding PressedRightButton}"
                           CommandParameter="MainBorder123"/>
    </c:CommandBehaviorCollection.Behaviors> 
```

但是，我可以编译并运行它。

我已重建项目、解决方案、关闭并打开它，但 XAML 编辑器仍然给我这个错误。

以前有没有人经历过这样的**XAML 编辑器和编译器之间的不协调**？知道如何让 XAML 编辑器看到确实没有问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T15:42:14.540

是的。我通常会关闭 XAML 编辑器并改用 XML 编辑器。它更快，并且不会向您抛出这些红鲱鱼“错误”。我还没有机会尝试它，但希望 VS2010 在这方面做得更好。

# c# - C# 应用程序配置数据

> ID：926628
> 
> 赞同：0
> 
> 时间：2009-05-29T15:32:44.900
> 
> 标签：c#, .net, configuration

嘿，我想存储应用程序配置数据。目前，我正在使用 INI，但它们太旧了，现在我想尝试一些新的东西。我在使用 C# 的 .NET 平台上。

我有什么解决方案？应用程序配置？

这里的场景是这样的，我想让其他程序读取配置数据。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T15:37:13.150

是的，各种 .config 文件（app.config、web.config 等）已经取代了 INI，并且在某种程度上，注册表成为了存储应用程序配置数据的首选方式。

任何程序，.Net 或其他程序，都可以读取这些文件。.Net 有 ConfigurationManager 类，其他语言可以简单地进行 XML 解析以获取他们需要的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:37:35.897

.NET 的标准方法是使用 app.config 文件进行应用程序设置，使用 user.config 文件进行用户特定设置（尽管位置在 XP 和 Vista 之间有所不同）。

没有什么可以阻止其他程序读取配置数据，您只需要在第二个（或第三个）应用程序中进行配置设置，告诉它在哪里查找。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T15:37:48.843

app.config 将是在 .NET 中做事的首选方式。只要您为它们提供正确的文件路径，从其他应用程序中读取也应该可以正常工作。它只是一个 XML 文件，因此您也可以从非 .NET 应用程序中读取它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T15:37:55.613

如果您使用的是 Visual Studio，则可以为此目的使用应用程序设置。只需打开自动添加的*Settings.settings*或创建另一个。它们将自动在 XML 中可用`Properties.Settings.Default`并存储为 XML。您还可以拥有多个用于不同目的的设置文件。

这是一个 Visual Studio 概念，而不是一个 .NET 概念。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T15:46:22.217

我经常使用 SQL 表来保存我的应用程序设置。我创建了一个单例类，通常称为 AppSettings，我从表中加载数据。然后使用 AppSettings 类来获取配置值，而不是直接访问配置文件。对于 ASP.Net 应用程序，我在 Global.asax.cs 的 Application_Start 事件中实例化 AppSettings 类。

这样做为我提供了一种允许用户控制某些应用程序设置的方法，例如用于通知的电子邮件地址。它还可以在维护应用程序的 prod、QA 和 dev 版本时简化事情（假设每个都有单独的数据库实例）

# cookies - 使用 Cookie 进行浏览器通信

> ID：926629
> 
> 赞同：1
> 
> 时间：2009-05-29T15:32:59.580
> 
> 标签：cookies

我计划使用 cookie 在两个浏览器窗口之间进行通信。我想知道是否有任何我想不到的缺点。服务器端不需要数据，因此通过 cookie 进行通信就足够了。我错过了什么还是可以使用？

我知道限制是4K。文字中的4k大概是多少？说我想存储 MD5/SHA 字符串。我可以在一个 cookie 中存储多少个这样的 md5 字符串？

非常感谢您的宝贵时间。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T15:37:06.503

*   显而易见的是，用户可能在他们的浏览器中禁用了 cookie……
*   4K文字多少钱？关于这么多（由[Lipsum Generator](http://www.lipsum.com/)提供）：

Lorem ipsum dolor sit amet, consectetur adipiscing elit。Duis quam quam, bibendum sat amet egestas id, suscipit vel mi。Integer est lacus, blandit vel accumsan non, lobortis eget purus。Nunc non felis nec justo ullamcorper suscipit。前庭 dapibus lobortis semper。Quisque mollis, lectus non porta semper, quam sapien adipiscing erat, in tincidunt risus lacus et felis。Vivamus pellentesque, massa in varius cursus, lorem tortor vehicula velit, et commodo neque sapien eget felis。Morbi iaculis condimentum lorem nec iaculis。Vivamus sem ligula，前庭 id tempus scelerisque，aliquam non velit。整数 ac sapien lorem, sed egestas ligula。Nam tristique tortor id odio imperdiet 发酵 sed sat amet nisl。Aliquam in tortor ligula, dignissim iaculis libero。Fusce ut tortor ante，在 convallis nisi。

Curabitur accumsan condimentum turpis，tincidunt fringilla nibh hendrerit vitae。Aliquam ac arcu nibh, eget viverra dui。Sed 一个 nisi nibh, ut interdum orci。Suspendisse laoreet sollicitudin libero ac 发酵。Curabitur ultrices enim 坐在 dapibus libero iaculis 中的 amet massa mollis。在 enim elit, mattis eget vestibulum at, faucibus at felis。Sed ultrices posuere libero，id consectetur nibh lacinia vel。Maecenas non mi eu dui sodales commodo et a mi。Aliquam erat volutpat。Vestibulum interdum, lectus eget cursus elementum, ligula metus iaculis libero, ac accumsan sapien eros vitae eros。Quisque vulputate massa quis augue mollis pharetra ac eu risus。Donec tristique purus nec erat tristique hendrerit。整数 consectetur nibh nec augue ornare tempus varius eros imperdiet。Quisque venenatis condimentum nisi, facilisis elementum lorem molestie eu。Donec id elit nec arcu tincidunt consectetur id sit amet velit。Nulla ut purus sapien。

Praesent一个tortor magna。Lorem ipsum dolor sit amet, consectetur adipiscing elit。Nam non tincidunt mauris。euismod 中的 Morbi euismod sollicitudin ipsum。暂停潜力。Ut semper, risus viverra porta semper, urna nisi placerat erat，位于 velit 的 luctus ante mi。Sed ac congue purus。Curabitur 坐在 amet lacinia elit。Sed ac eros 精英。在 hac habitasse platea dictumst 中。在 dolor viverra non dictum dui fringilla 的 feugiat ipsum 中。Duis quis urna mi。Mauris non tellus non augue pretium commodo vitae adipiscing nulla。Donec aliquet libero 坐 amet ipsum pharetra 非发酵 sapien euismod。Quisque commodo erat vel nisl tristique placerat。Morbi eros urna, dignissim pulvinar ullamcorper sed, convallis at risus。Phasellus quis convallis lectus。Etiam eu aliquet odio。Integer diam neque, tincidunt ac semper quis, gravida eget eros。Praesent augue orci,

Nam ac erat 坐在 ac quam 的 amet metus congue ullamcorper。Sed auctor fringilla ligula、vitae iaculis mauris tempus 等。Etiam pulvinar、odio non egestas mollis、odio ligula elementum dolor、non auctor nulla leo sit amet orci。Aenean leo urna，congue id tristique in，consequat in augue。Morbi vel condimentum dui。Curabitur eu augue felis，sed luctus nisi。Pellentesque eu tortor non erat placerat iaculis a nectortor。Maecenas ultrices tristique lectus et 发酵。Duis et faucibus 直径。Vivamus vitae nibh neque。sed massa odio, adipiscing at ultricies non, viverra a urna。Praesent posuere dui in nibh pulvinar vitae lacinia est congue。Ut congue vestibulum arcu，eget venenatis augue scelerisque quis。Vivamus augue libero，molestie ut condimentum ac，pretium v​​itae nunc。

Faucibus orci luctus et ultrices posuere cubilia Curae 的前庭前庭；Pellentesque 居民 morbi tristique senectus et netus et malesuada 名声 ac turpis egestas。Lorem ipsum dolor sit amet, consectetur adipiscing elit。Vivamus sodales varius orci a tempus。暂停潜力。Sed pellentesque euismod erat，et tincidunt lectus vehicula quis。Mauris blandit infantum urna，一种 posuere risus vestibulum feugiat。Sed pulvinar, lacus quis dignissim ullamcorper, odio arcu euismod massa, in suscipit odio ipsum quis sapien。前庭 nec neque vel leo tincidunt sollicitudin。Quisque et est ut erat blandit dapibus a mollis metus。Etiam turpis duis。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T15:42:41.480

4k 是 4096 字节。因此，您可以存储 4096 个一字节字符 (ASCII)。

但是，当您要存储哈希值时，最好使用原始哈希值的 Base64 编码值。因此，如果您使用十六进制值，您可以每个字符存储 6 位而不是每个字符仅存储 4 位。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T15:52:03.387

存储为名称/值对，每个 MD5 将至少有 36 个字符（假设它存储为具有单个字符名称的十六进制字符串，md5+name+"="+separator = 32+2+1+1），更长'会很好并使用有意义的名称...在 36 个字符中，您可以在 4K 中容纳 117 个字符（4096 个字符，假设始终使用 ASCII 字符），但请确保为服务器端脚本环境中的会话 id cookie 等开销留出空间等等。

SHA1 会更长（160 位，而不是 128 位），而 SHA2 会更长（在 224 和 512 位之间，具体取决于使用的具体变体）。使用 Base64 编码或类似编码而不是普通十六进制将减小大小（MD5 为 22 个字符，假设没有填充，而不是 32）。

就以这种方式使用 cookie 而言，主要问题是某些用户完全关闭了 cookie（甚至是第一方会话 cookie），尽管取决于您的目标受众，这可能不是问题。

您还需要确保在用户可能使用的所有浏览器中进行测试，确保一个窗口中脚本对 cookie 的更新确实会更新其他窗口中脚本可用的数据，而无需客户端/服务器往返。

您还需要培训 Internet Explorer 用户了解使用 ctrl-N 或链接启动新 IE 窗口与通过从开始菜单启动 IE 启动新进程之间的区别。在后一种情况下，cookie 几乎肯定不会与其他窗口共享，直到发生往返。

# c# - 如何将 byte[] 引用作为 System.Net.Sockets.Send().Recieve() 中的缓冲区传递

> ID：926632
> 
> 赞同：0
> 
> 时间：2009-05-29T15:34:12.370
> 
> 标签：c#, sockets, memory-management

我一直在阅读有关 .NET 异步套接字的各种内存管理问题。

只有少数几个链接，但是爬取这个链接会让你得到所有链接： [http ://codebetter.com/blogs/gregyoung/archive/2007/06/18/async-sockets-and-buffer-management.aspx](http://codebetter.com/blogs/gregyoung/archive/2007/06/18/async-sockets-and-buffer-management.aspx)

**基本上**
，当套接字异步发送/接收许多小字节 []
时，发送/接收字节 [] 被固定在内存中
导致碎片。

所以为了创建缓冲区管理器：我有一个托管缓冲区（字节 []）

```
byte[] managedBuffer = new byte[1024];
// do stuff with managedBuffer; 
```

如何通过引用将此字节 [] 发送到套接字的异步 .BeginSend() 方法？

```
// I don't want to pass the VALUE to the method, but a reference
// to managedBuffer;
System.Net.Sockets.Socket.BeginSend(managedBuffer...(other params)); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:41:52.730

数组总是通过引用传递，所以你已经这样做了。如果您正在异步使用套接字，那么您需要确保在它进行中时不使用 managedBuffer。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:42:28.300

数组总是作为引用传递（就像传递指针一样）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-30T01:38:48.667

正如 Nik 所指出的，当您将 传递`byte[]`给方法时，您已经通过引用传递它。但是，使用`ArraySegment`您在文档中找到的方法是有好处的；它们主要是为了避免`byte[]`在异步调用期间固定缓冲区中固有的内存碎片问题。

有关更多详细信息，请参阅我的回答：[如何编写基于可扩展 Tcp/Ip 的服务器](https://stackoverflow.com/questions/869744/how-to-write-a-scalable-tcp-ip-based-server/908766#908766)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T15:42:10.030

BeginSend 对字节数据所做的唯一事情是将其发送到打开的 Socket。之后，字节数组将像 .NET 中的任何其他字节数组一样被 GC 处理（在函数末尾，或者在定义数组的类被处理时）。

# c# - 将二进制转换为图像 WPF；

> ID：926644
> 
> 赞同：1
> 
> 时间：2009-05-29T15:37:22.650
> 
> 标签：c#, .net, wpf

嗨，我正在尝试创建一个转换器来转换数据库中的图像，数据类型“Varbinary（Max）”以在 WPF 中填充我的 DataGrid，但我有 2 个错误，我向您展示了转换器：

```
public class BinaryToImageConverter : IValueConverter
 {

public object Convert(object value, System.Type targetType, object parameter, 

System.Globalization.CultureInfo culture)
    {

   Binary binaryData =  value;// here there is the first error .How convert BinaryData to Object??
        if (binaryData == null) {
            return null;
         }

        byte[] buffer = binaryData.ToArray();
        if (buffer.Length == 0) {
              return null;
         }

          BitmapImage res = new BitmapImage();
         res.BeginInit();
         res.StreamSource = new System.IO.MemoryStream(buffer);
           res.EndInit();
         return res;
      }

     public object ConvertBack(object value, System.Type targetType, object parameter, System.Globalization.CultureInfo culture)
      {
         BitmapImage source = value;//How convert Bitmap to Object?
          if (source == null) {
              return null;
          }
          if ((source.StreamSource != null) && source.StreamSource.Length > 0) {
             return GetBytesFromStream(source.StreamSource);
         }

         return null;
      }

     private Binary GetBytesFromStream(System.IO.Stream stream)
     {
           stream.Position = 0;
         byte[] res = new byte[stream.Length + 1];
        using (System.IO.BinaryReader reader = new System.IO.BinaryReader(stream)) {
              reader.Read(res, 0, (int)stream.Length);
         }
          return new Binary(res);
     }

 } 
```

出租车你建议我是否正确或有更好的方法来做到这一点？谢谢你的帮助。祝你有美好的一天

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:46:01.763

如果 value 参数确实包含 BinaryData 类型的对象，那么您可以对其进行类型转换：

```
Binary binaryData =  (Binary)value; 
```

或者

```
Binary binaryData =  value as Binary; 
```

最好在强制转换之前对 value 参数进行 is-null 检查，而不是像现在这样在强制转换之后进行检查。

# windows - USB 层次结构驱动程序

> ID：926650
> 
> 赞同：0
> 
> 时间：2009-05-29T15:38:10.933
> 
> 标签：windows, macos, usb

是否可以为自定义 USB 集线器创建驱动程序（Windows/Mac），使其在我的电脑/Finder 中显示为一个设备，并且连接的 USB 读卡器每个都显示为该设备中的子文件夹？任何指向正确方向的指针将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T16:35:40.217

这是*可能的*，但非常困难。你真的不想这样做。真的。您基本上将从头开始重新实现 USBHub.sys，并打破 Windows 中驱动器的标准范例（即驱动器出现在我的电脑中）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-08T20:13:56.923

你有两种方法可以做到这一点：

1) 构建您自己的自定义 USB 集线器设备，它将自己呈现为单个驱动器，并根据连接的设备创建自己的内部文件夹。

2）编写一些严肃的忍者驱动程序代码，将多个USB读卡器设备组合到一个驱动器中。这将非常依赖于平台（Windows v. Mac），并且需要至少 6 个月的工作，给予或接受。

老实说，如果这是必须的，我会选择第一个。会需要一个定制的硬件虽然......

# ruby-on-rails - 当我运行生成/脚手架时，为什么 Rails 将我的名为 menuitem 的模型拆分为 menu_item？它破坏了我的应用程序吗？

> ID：926654
> 
> 赞同：1
> 
> 时间：2009-05-29T15:38:27.487
> 
> 标签：ruby-on-rails

当我为名为 menuitem 的模型类生成脚手架时，它会为 menuitem 生成一个类文件，但在数据库中创建 menu_item 并将视图和控制器中的类称为 menu_item。这可能让我很头疼，因为我正在生成一个新闻节目链接，但它没有告诉我缺少方法。rake 路线告诉我显示路线应该是 menu_menu_item，但是当我这样做时：

```
 <td><%= link_to 'Show', menu_menu_item(@menu) %></td> 
```

它不起作用。

那是因为时髦的两个词类名吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T16:15:58.590

您必须已生成`menu_item`或`menuItem`或`MenuItem`。除非你告诉它，否则它不知道一个词在哪里停止，另一个词从哪里开始。

另外，对于您`link_to`的 s，您只需要附加`_path`：

```
<td><%= link_to 'Show', menu_menu_item_path(@menu) %></td> 
```

好吧，实际上，这在我看来有点不对劲。看起来您正在尝试访问单个项目，我认为这将要求您同时指定菜单和项目：

```
<td><%= link_to 'Show', menu_menu_item_path(@menu, @menu_item) %></td> 
```

对于菜单中的所有菜单项：

```
<td><%= link_to 'Show', menu_menu_items_path(@menu) %></td> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:57:50.753

[Pluralizer](http://nubyonrails.com/tools/pluralize/MenuItem)向您展示了应该根据 Rails 的约定命名的东西。

# c# - 带有 NOLOCK 的实体框架

> ID：926656
> 
> 赞同：144
> 
> 时间：2009-05-29T15:38:48.500
> 
> 标签：c#, entity-framework, ado.net

如何`NOLOCK`在 Entity Framework 上使用该功能？XML 是唯一的方法吗？

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2009-09-23T16:13:16.267

不，但您可以启动事务并将[隔离级别设置为 read uncommited](https://stackoverflow.com/questions/1018651/nolock-vs-transaction-isolation-level)。这本质上与 NOLOCK 相同，但不是在每个表的基础上执行此操作，而是对事务范围内的所有内容执行此操作。

如果这听起来像你想要的，那么你可以这样做......

```
//declare the transaction options
var transactionOptions = new System.Transactions.TransactionOptions();
//set it to read uncommited
transactionOptions.IsolationLevel = System.Transactions.IsolationLevel.ReadUncommitted;
//create the transaction scope, passing our options in
using (var transactionScope = new System.Transactions.TransactionScope(
    System.Transactions.TransactionScopeOption.Required, 
    transactionOptions)
)

//declare our context
using (var context = new MyEntityConnection())
{
    //any reads we do here will also read uncomitted data
    //...
    //...
    //don't forget to complete the transaction scope
    transactionScope.Complete();
} 
```

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2013-08-31T23:33:16.640

扩展方法可以使这更容易

```
public static List<T> ToListReadUncommitted<T>(this IQueryable<T> query)
{
    using (var scope = new TransactionScope(
        TransactionScopeOption.Required, 
        new TransactionOptions() { 
            IsolationLevel = System.Transactions.IsolationLevel.ReadUncommitted }))
    {
        List<T> toReturn = query.ToList();
        scope.Complete();
        return toReturn;
    }
}

public static int CountReadUncommitted<T>(this IQueryable<T> query)
{
    using (var scope = new TransactionScope(
        TransactionScopeOption.Required, 
        new TransactionOptions() { 
            IsolationLevel = System.Transactions.IsolationLevel.ReadUncommitted }))
    {
        int toReturn = query.Count();
        scope.Complete();
        return toReturn;
    }
} 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2013-04-10T13:42:07.497

如果您需要大量的东西，我们发现比每次实际启动事务范围更小的侵入性的最佳方法是在您创建对象上下文后通过运行以下简单命令简单地设置连接上的默认事务隔离级别：

```
this.context.ExecuteStoreCommand("SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;"); 
```

[http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx](http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx)

使用这种技术，我们能够创建一个简单的 EF 提供程序，它为我们创建上下文，并为我们所有的上下文每次实际运行此命令，因此我们始终默认处于“未提交读取”状态。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2014-06-05T11:32:57.060

虽然我完全同意使用未提交的事务隔离级别是最好的选择，但有时你被迫使用 NOLOCK 提示，应经理或客户的要求，并且没有理由反对这一点被接受。

使用 Entity Framework 6，您可以像这样实现自己的 DbCommandInterceptor：

```
public class NoLockInterceptor : DbCommandInterceptor
{
    private static readonly Regex _tableAliasRegex = 
        new Regex(@"(?<tableAlias>AS \[Extent\d+\](?! WITH \(NOLOCK\)))", 
            RegexOptions.Multiline | RegexOptions.IgnoreCase);

    [ThreadStatic]
    public static bool SuppressNoLock;

    public override void ScalarExecuting(DbCommand command, 
        DbCommandInterceptionContext<object> interceptionContext)
    {
        if (!SuppressNoLock)
        {
            command.CommandText = 
                _tableAliasRegex.Replace(command.CommandText, "${tableAlias} WITH (NOLOCK)");
        }
    }

    public override void ReaderExecuting(DbCommand command, DbCommandInterceptionContext<DbDataReader> interceptionContext)
    {
        if (!SuppressNoLock)
        {
            command.CommandText = 
                _tableAliasRegex.Replace(command.CommandText, "${tableAlias} WITH (NOLOCK)");
        }
    }
} 
```

有了这个类，您可以在应用程序启动时应用它：

```
DbInterception.Add(new NoLockInterceptor()); 
```

并有条件地关闭将`NOLOCK`提示添加到当前线程的查询中：

```
NoLockInterceptor.SuppressNoLock = true; 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-06-01T12:09:54.537

增强[Jones 医生](https://stackoverflow.com/a/1467052/1290868)接受的答案并使用[PostSharp](https://www.postsharp.net/)；

第一个“ **ReadUncommitedTransactionScopeAttribute** ”

```
[Serializable]
public class ReadUncommitedTransactionScopeAttribute : MethodInterceptionAspect
{
    public override void OnInvoke(MethodInterceptionArgs args)
    {
        //declare the transaction options
        var transactionOptions = new TransactionOptions();
        //set it to read uncommited
        transactionOptions.IsolationLevel = IsolationLevel.ReadUncommitted;
        //create the transaction scope, passing our options in
        using (var transactionScope = new TransactionScope(TransactionScopeOption.Required, transactionOptions))
        {
            //declare our context
            using (var scope = new TransactionScope())
            {
                args.Proceed();
                scope.Complete();
            }
        }
    }
} 
```

然后在你需要的时候，

```
 [ReadUncommitedTransactionScope()]
    public static SomeEntities[] GetSomeEntities()
    {
        using (var context = new MyEntityConnection())
        {
            //any reads we do here will also read uncomitted data
            //...
            //...

        }
    } 
```

能够使用拦截器添加“NOLOCK”也很好，但在连接到其他数据库系统（如 Oracle）时将不起作用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-12-07T19:42:21.593

为了解决这个问题，我在数据库上创建了一个视图，并对视图的查询应用 NOLOCK。然后我将视图视为 EF 中的一个表。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2018-04-05T20:14:25.207

随着 EF6 的引入，Microsoft 建议使用 BeginTransaction() 方法。

您可以在 EF6+ 和 EF Core 中使用 BeginTransaction 而不是 TransactionScope

```
using (var ctx = new ContractDbContext())
using (var transaction = ctx.Database.BeginTransaction(System.Data.IsolationLevel.ReadUncommitted))
{
    //any reads we do here will also read uncommitted data
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-29T20:49:18.393

不，不是真的 - 实体框架基本上是您实际数据库之上的一个相当严格的层。您的查询是在 ESQL（实体 SQL）中制定的，它首先针对您的实体模型，并且由于 EF 支持多个数据库后端，因此您不能真正将“本机”SQL 直接发送到您的后端。

NOLOCK 查询提示是特定于 SQL Server 的东西，不适用于任何其他受支持的数据库（除非它们也实现了相同的提示 - 我强烈怀疑）。

马克

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-07T16:21:31.383

一种选择是使用存储过程（类似于 Ryan 提出的视图解决方案），然后从 EF 执行存储过程。这样，存储过程执行脏读，而 EF 只是通过管道传输结果。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-02-09T15:40:36.567

删除这个线程，因为它是谷歌搜索中出现的第一个。EF 构建查询的方式发生了变化。此正则表达式还将涵盖连接。

*顺便说一句，事务级别读取未提交的作品（上面的例子是事务范围），但它仍然会阻止更新。使用表级 nolock 将允许更新继续。在执行此操作之前，请务必注意并研究使用脏读的影响*

```
(?<tableAlias>((FROM)|(JOIN))\s\[([^\s]+)\]\sAS\s\[([^\s]+)\](?!\sWITH\s\(NOLOCK\))) 
```

您可以使用任何正则表达式在线测试器（如[regex101.com](https://regex101.com)）使用此示例对其进行测试

```
FROM [table1] AS [t]
INNER JOIN [table2] AS [t2] ON ([t].[ID] = [t2].[ID])
INNER JOIN [table3] AS [t3] WITH (NOLOCK) ON ([t].[ID] = [t3].[ID]) 
```

我还清理了示例，但省略了触发器的 bool 标志。如果需要，请随时添加

```
public class NoLockInterceptor : DbCommandInterceptor
    {       

        public override InterceptionResult<DbDataReader> ReaderExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<DbDataReader> result)
        {           

            var finishedresult = base.ReaderExecuting(command.NoLockCommand(), eventData, result);    
            return finishedresult;  
        }

        public override ValueTask<InterceptionResult<DbDataReader>> ReaderExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<DbDataReader> result, CancellationToken cancellationToken = default)
        {

            var finishedresult = base.ReaderExecutingAsync(command.NoLockCommand(), eventData, result, cancellationToken);
            return finishedresult; 
        }

        public override InterceptionResult<object> ScalarExecuting(DbCommand command, CommandEventData eventData, InterceptionResult<object> result)
        {
            var finishedresult = base.ScalarExecuting(command.NoLockCommand(), eventData, result);
            return finishedresult;
        }

        public override ValueTask<InterceptionResult<object>> ScalarExecutingAsync(DbCommand command, CommandEventData eventData, InterceptionResult<object> result, CancellationToken cancellationToken = default)
        {
            var finishedresult = base.ScalarExecutingAsync(command.NoLockCommand(), eventData, result, cancellationToken);
            return finishedresult;
        }

    } 

    public static class DbCommandExtensions
    {
        private static Regex _tableAliasRegex = new Regex(@"(?<tableAlias>((FROM)|(JOIN))\s\[([^\s]+)\]\sAS\s\[([^\s]+)\](?!\sWITH\s\(NOLOCK\)))",
                RegexOptions.Multiline | RegexOptions.IgnoreCase);

        public static DbCommand NoLockCommand(this DbCommand command)        {          

            string updatedCommandText = _tableAliasRegex.Replace(command.CommandText, "${tableAlias} WITH (NOLOCK)");

            command.CommandText = updatedCommandText;
            return command;
        }
    } 
```

# css - 我如何管理这个嵌套标记和 CSS 以使事情变得简单易用？

> ID：926659
> 
> 赞同：2
> 
> 时间：2009-05-29T15:39:30.903
> 
> 标签：css, markup

我有以下标记，用于生成弹出式超级菜单（.column div 允许在每个弹出窗口中包含多个列，尽管下面的示例只有一个列）...

```
<ul id="mainmenu">
    <li class="mega">
        <h2><a href="/">Menu 1</a></h2>
        <div class="submenu col1 leftmenu">
            <div class="column">
                <ul>
                    <li><h3>Sub Menu Heading</h3></li>
                    <li><a class="hilight" href="#">Do Something</a></li>    
                    <li><a class="hilight" href="#">More great stuff</a></li>
                    <li><a href="#">Another Item</a></li>
                </ul>
            </div>
        </div>
    </li>
    <li class="mega">
        <h2><a href="#">Second Menu</a></h2>
        <div class="submenu col3 leftmenu">
               blar blar blar
        </div>
    </li>
    // more menus here    
</ul> 
```

由于这与很多类似的标签（`<li>` `<a>`）嵌套得很深，我最终需要一个相当可怕的选择器列表来在 css 中设置它的样式，例如。

```
#mainmenu li h2 a {}
#mainmenu li.mega .column li h3 a {} 
```

任何人都可以建议对标记进行任何改进，以便更简单地使用 CSS 和 jQuery 定位吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:44:27.783

如果是我，我会在有问题的最终实体上放置很好的目标类，然后改变

```
#mainmenu li h2 a {} 
```

到

```
#mainmenu .section {} 
```

和

```
#mainmenu li.mega .column li h3 a {} 
```

到

```
#mainmenu .subsection {} 
```

等等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:51:08.740

就我个人而言，我认为您的 html 看起来不错，它没有被无尽的 id 所困扰，并且没有一个类看起来是多余的或无用的。

如果您在除 li 内部、列内部、父 li 内部之外的任何地方都没有使用 h3，那么您可以这样做`#mainmenu h3 a`：我真的认为你可以在你的选择器中不那么明确。

我尝试真正利用独特的 html 标签，这样我只需要最顶层元素上的 id 和下面的几个类（如果需要）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T15:51:21.093

您总是可以使用更具体的选择器名称。代替：

```
#mainmenu li.mega .column li h3 a {}
and
<ul id="mainmenu"><li class="mega"><div class="column"><li><h3><a> 
```

采用

```
h3.mega_column a {}
and
<ul id="mainmenu"><li class="mega"><div class="column"><li><h3 class="mega_column"><a> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T15:45:27.193

并非没有真正看到你的 CSS 的其余部分，但我认为你的动机是错误的。您的目标应该是让您的标记准确反映所需的内容。如果需要*将此事物定义为与**该事物*分开，则它们需要作为不同的元素存在，如果不是，则不是。*分离关注点，甚至在您的标记符合需要*之前不要考虑 CSS 。

我会说，看起来你可以将 div.column 和 ul 子级折叠成 ul.column，并且 h2 中的锚点可能会移动到 div.submenu 内部并给出一个“标题”类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-30T05:17:45.683

除了确保您的结构真正适合您的内容的语义，而不仅仅是出于设计原因之外，我还可以建议以下几点：

1.  如果 div 中没有其他内容，则不需要将 <ul> 包装在 <div> 中。它们都是块级元素，您可以编写 <ul class="column"> 并为自己节省一些不必要的标记。它是多余的。

2.  如果你不使用类名在不同的地方表示不同的东西，你可能会大大简化你的 CSS。例如，如果您只在#mainmenu .mega 下使用“column”类，那么实际上不需要每次都指定它。只是说`.column h3 a`会到达那里。

3.  如果你想要 jquery 的简单性，你也可以利用 CSS3 选择器，比如 :not() 来为你整理东西。例如，`$("#mainmenu li.mega .column li")`您可以代替`$("#mainmenu li:not(.mega)")`

这些是我的想法。

# javascript - JScript 语法验证器？

> ID：926663
> 
> 赞同：3
> 
> 时间：2009-05-29T15:40:09.233
> 
> 标签：javascript, syntax

我是来自 C++ 世界的 JScript 新手。

我很惊讶表达式在运行时被评估。我的意思是，如果我添加了一个函数但没有提供它的定义，那么当我运行它时，程序会“崩溃”（在调试器中）。

这也很有趣，我可以在任何地方输入胡言乱语，而且只有在运行时调试器才会抱怨。

但是“实时”页面不会！

是否有任何 JScript 附加工具可以在我们键入时检查其语法？我目前正在使用 Aptana Studio。

还是调试按钮相当于在网络世界中编译？但是，如果你有数百万行代码并且一些小函数没有定义或拼写错误怎么办？这对我来说是一个可怕的想法。=S

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T15:41:17.673

[JSLint](http://www.jslint.com/)被许多人认为是最好的语法检查器。我不知道是否有针对您的特定情况的加载项，但您应该能够很容易地将其添加到您的构建过程中。

更新：显然有一些[成熟的技术](http://www.google.ca/search?q=jslint+Aptana+&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)可以将其与 Aptana 集成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:53:16.243

欢迎来到脚本世界！

# .net - 任何 .NET ORM 是否“正确”使用构造函数？

> ID：926668
> 
> 赞同：7
> 
> 时间：2009-05-29T15:41:03.790
> 
> 标签：.net, orm

这在概念上与我的问题[有关](https://stackoverflow.com/questions/826872/orms-and-constructors)。但是，我一直在玩 NHibernate，并意识到我的问题的真正核心是什么。

在经典的 OO 设计中，为了正确封装数据，将值传递给对象的构造函数并存储在数据成员（字段）中是一种常见模式。那些不应更改的值*仅*通过访问器（只读属性）公开。那些允许更改的有访问器和修改器（读写属性）。在我看来，**正确的**O/RM 应该尊重这些约定，并在创建对象时使用可用的构造函数。依赖读写属性、反射或其他骇人听闻的（恕我直言）方法似乎……是错误的。

有没有 .NET O/RM 解决方案可以做到这一点？

**编辑**

为了解决 Praveen 的观点，我知道有些项目具有用于选择构造函数的“默认”算法 - 例如，StructureMap 始终使用具有最多参数的构造函数，*除非*您使用自定义属性标记构造函数。我可以看到这是处理这种情况的有效方法。*除了*ORM 之外，也许使用 IoC 容器会提供我需要的那种解决方案——尽管在我看来，这虽然不是天生的坏事，但对于使用 ORM 来说是一个不必要的额外步骤。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T15:55:11.407

我认为大多数 ORM 实际上都支持这个概念，至少 DataObject.Net 支持。此代码按预期工作：

```
[HierarchyRoot(typeof(KeyGenerator), "Id")]
public class Message : Entity
{
  [Field]
  public int Id { get; private set; }

  [Field(Length = 100)]
  public string Text { get; private set; }

  public Message(string Text)
  {
    Text = text;
  }
} 
```

**编辑：** DataObjects 以内部事务状态存储数据，并使用 PostSharp 生成的特殊实现构造函数。当然，如果 ORM 使用 poco 对象也不是那么简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:55:10.173

不幸的是，如果不以某种方式标记构造函数，这在 .NET 中是不可能的。

在程序集元数据中为每个构造函数存储的方法签名仅包含构造函数的每个参数的类型。任何 .NET ORM 都无法真正知道要使用哪个构造函数。ORM 看到的都是这样的：

```
.ctor()
.ctor(string, string)
.ctor(string, string, string) 
```

例如，ORM 无法知道哪个 .ctor 参数对应于您的 Customer 对象的 FirstName、LastName 和 MiddleName。

为了提供这种支持，.NET ORM 必须支持读取您为每个参数定义的自定义属性。您需要像这样标记您的构造函数：

公共客户（[Property("FirstName")] string FirstName, [Property("LastName")] string LastName, [Property("MiddleName")] string MiddleName)

这有两个缺点：

1.  没有办法（我能想到，有人可能会纠正我），这可以进入映射文件。
2.  您仍然需要像往常一样编写相同的映射，因为 ORM 仍然需要能够为每个属性获取单独的值。

所以你需要做所有这些额外的工作来标记构造函数，同时你仍然需要像以前一样映射你的类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T16:38:05.377

为什么你觉得这感觉不对？您是否希望您的 OR/M 在重构对象时执行业务逻辑？恕我直言，不。

当您从数据库加载对象时，无论如何，OR/M 都应该能够重构该对象。在重新构造时设置一些值，不应导致触发某种改变另一个值的逻辑（可能也应该由 ORM 赋予一个值......）

即便如此，我认为构造函数应该只包含那些在创建对象时必须使对象处于“有效”状态的字段的参数。除此之外，您可能有一些公共只读属性，这些属性已通过某种计算获得了值，并且也需要持久化。
如果您觉得反射是重构对象的“气味”，您将如何处理这种情况？您必须以某种方式创建一个能够设置“只读”值的公共方法，但这会破坏封装，您也不希望那样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T21:39:36.013

我同意之前的一张海报，即构造函数应该用于在其生命周期开始时创建一个对象。使用构造函数来水合当前处于存档状态的现有对象充其量是违反直觉的。

需要考虑的是，所有主要的 ORM 在这一点上似乎都缺少的是，从存储在数据库或任何其他数据存储中的最后一个已知状态重构域对象，本质上不是构造或修改操作；因此不应使用构造函数或属性设置器。相反，与这种操作最紧密对应的框架机制是序列化！已经有一些公认的模式用于存储对象的状态，然后通过 ISerializable 接口、标准序列化构造函数等对其进行重构。将对象持久化到数据库与将对象持久化到流基本上没有区别；事实上，在序列化期间使用的 StreamingContextStates 枚举的值之一是 Persistence!。恕我直言，这应该是设计任何持久性机制时的标准方法。不幸的是，我不知道有任何开箱即用的 ORM 支持这一点。

还需要注意的是，已经为序列化而设计的对象仍然是 POCO；没有违反持久性无知。这里的关键点是域对象应该最清楚地知道需要哪些数据来持久化和恢复它，以及应该以什么顺序恢复数据（这通常很重要）。对象不必知道存储它的特定机制：关系数据库、平面文件、二进制 blob 等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-01T16:32:26.793

天哪，我想我明白了！

感谢大家的意见，但我将不得不回答我自己的问题。我只花了一个小时左右浏览[PoEAA 目录](http://martinfowler.com/eaaCatalog/)，思考 OO 原则，并将其与对 C# 语言和 .NET 框架的深入思考相结合。

我想出的答案是**，**我无法使用构造函数正确解决的需求，最终与构造函数本身无关。这是[延迟加载](http://en.wikipedia.org/wiki/Lazy_loading)！

基本上，如果没有在你的域类中实现延迟加载（对于持久性无知和灵活性的主要禁忌），没有子类化域类就没有办法做到这一点。这种子类化是 NHibernate 需要虚拟属性的原因。

我仍然认为使用构造函数而不是反射或其他方法来填充父类的字段会更好（至少对于非集合......延迟加载确实有它的位置），但我肯定看到没有-arg 构造函数有它的位置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T15:55:38.193

这取决于您认为不应更改的值。自动增量、计算列等都是很好的选择。

这当然是*可能的*，我使用我编写的 ORM，如果您尝试设置只读属性的值，它会引发异常。

**更新：**

请记住，构造函数也用于持久化数据。让你的对象在构造函数中接受 PK(s) 是一种常见的模式，它会自动获取该记录。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-29T15:56:18.413

在一般情况下，OR 映射器不可能只使用构造函数。假设一个对象由传递给构造函数的值初始化，然后通过方法调用修改状态。在这种情况下，对象可能会以没有有效初始状态的状态持续存在，因此被构造函数拒绝。

因此，这样的 OR 映射器可能存在，但它肯定有局限性。如给定示例所示，我不会将 OR 映射器绕过对象封装视为糟糕的设计，而是在某些情况下作为要求。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-29T16:57:52.357

斯基特先生不久前提出了一种“建造者”模式。我将它设为 POCO 类中的公共类。它具有与 POCO 相同的属性，但都是读/写的。POCO 在必要时是只读的，但 PRIVATE SET。这样，构建器可以在实例化 POCO 时设置属性，并且构造函数没有时髦的参数。那里有一种'popcicle不变性'。

# django - django -- 应用程序子目录 site/app1/app2/app3

> ID：926669
> 
> 赞同：1
> 
> 时间：2009-05-29T15:41:04.680
> 
> 标签：django, web-applications, django-urls

如果你要为一个网站编写一个应用程序，但想让应用程序即插即用，这样你就可以将它放到任何 Django 项目中，设置主 URL 就可以了，如果你想保留所有便携式应用程序中包含的其他必需实用程序应用程序。

例子：

```
site/
site/site-app1
site/templates/site-app1
site/util-app1
site/util-app2
site/util-app3 
```

注意：site-app1 使用了所有三个 util-apps。它以这种方式工作得很好。但是现在，您决定将应用程序发送给某人，但只是发送给该应用程序及其所有依赖项。

如果我们可以像这样打包和发送应用程序？：

```
site/site-app1
site/site-app1/template
site/site-app1/util-app1
site/site-app1/util-app2
site/site-app1/util-app3 
```

然后你只需发送 site-app1 ，一切都会随之而来。

有没有办法将实用程序应用程序作为子目录进行便携？

注意：我们的想法是我们不想发送整个项目，而是只发送项目中的一个站点应用程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T18:42:18.337

有一些关于可重用 django 应用程序的演示，所以到处搜索。这些应该可以帮助您：

*   开发可重用的应用程序。[pdf](http://us.pycon.org/common/2008/talkdata/PyCon2008/050/reusable_apps.pdf)和[视频](http://www.youtube.com/watch?v=A-S0tqpPga4)
*   [Django 模板：继承的力量](http://jeffcroft.com/blog/2006/feb/25/django-templates-the-power-of-inheritance/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-30T02:17:31.803

@Gerry 链接到的演示文稿是一般信息的良好来源。为了更直接地回答您的问题~~，没有办法将一个应用程序打包到另一个应用程序中~~（**编辑**抱歉，这完全是错误的。您可以将一个应用程序放在另一个应用程序的命名空间中，它工作得很好。这是一个奇怪的事情是：你暗示一个应用程序是另一个应用程序的一部分；如果这是真的，它们会更容易作为一个应用程序使用。所以我仍然推荐以下选项之一）。AFAICT 您的选择是：

1.  如果可能，将这些外部依赖项设为可选（即，如果 util_app1 可用，则增强功能，如果不可用，则回退行为）。这是有多少应用程序相对于 django-tagging 或 django-mailer 的行为。

2.  将所有功能整合到一个应用程序中。根据您实际依赖实用程序应用程序的代码量，如果依赖项对于您的应用程序运行是绝对必要的，那么这可能是让您的用户轻松使用的最佳选择。

3.  分别打包和分发所有应用程序，并注意文档和 setup.py install_requires 中的依赖关系。如果所有应用程序都是独立有用的，那么这种方法可能是最好的。如果它们都不是独立有用的，为什么它们都是独立的应用程序？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-30T05:02:43.143

遵循某些惯例，可以使 Django 应用程序具有可移植性。当然，这些不是强制性的

## 申请地点

约定是在 apps/ 目录中添加应用程序，并修改 manage.py（最终是 apache 配置）以包含

```
import sys
from os.path import abspath, dirname, join
PROJECT_ROOT = abspath(dirname(__file__))
sys.path.insert(0, join(PROJECT_ROOT, "apps")) 
```

您的目录结构将类似于

```
site
site/apps/
site/apps/app1/
site/apps/app2/ 
```

## 模板

模板位于应用程序的模板目录中。惯例是不强制用户将它们复制到任何其他位置。最终，用户可以拥有全局模板来覆盖应用程序中的模板。

## 设置

将所有默认设置保存在 app 目录中的本地文件中。这些设置将被全局设置覆盖。本地设置文件将具有以下结构..

```
from django.conf import settings

def get(key, default):
    return getattr(settings, key, default)

SETTING_1 = get('SETTTING_1', 10) 
```

这些约定应涵盖大多数主要问题。

# c# - 从 Process.Exited 处理程序抛出异常

> ID：926676
> 
> 赞同：0
> 
> 时间：2009-05-29T15:42:12.230
> 
> 标签：c#, exception, synchronization, process

我有一个运行外部命令行实用程序并读取标准输出（PNG 图像）的程序。最初在测试期间，我让命令行程序将图像写入临时文件，然后将文件加载到程序中。我有一个 Process.Exited 的处理程序，如果退出代码非零，它会引发异常。我在加载临时图像之前调用了 WaitForExit 以确保该过程已完成。如果引发异常，则会在读取临时图像文件的代码中进行处理。现在，我在调用 Process.Start 后直接调用创建图像文件，如果没有错误，它可以正常工作。如果外部程序异常退出，退出处理程序抛出的异常不再被我的代码捕获。如果我在读取标准输出之前调用 WaitForExit，程序就会挂起。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T15:46:04.447

听起来你的命令行实用程序没有正确退出。你有没有通过显示进程窗口来检查它是否做错了什么？

我的第二个赌注是不读取标准输出会导致程序不退出（它正在等待能够清除它的输出），因此您必须先读取标准输出，然后等待实用程序停止。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T17:16:40.913

Process.Exited 处理程序在与启动进程的函数不同的上下文中执行。您可以通过两种方式解决此问题。

1.  开始该过程后编写一个循环。（使用进程的句柄，在循环中调用WaitOne(100)。如果遇到异常，则句柄已经消失，您应该像进程已经完成一样。如果您没有收到异常，则结果为true表示该过程已关闭。）
2.  在开始该过程之前创建一个您 Reset() 的 ManualResetEvent。启动该过程后，对该事件调用 WaitOne()。在 Process.Exited 处理程序中，Set() 那个事件，然后 main 方法将继续。

# python - 如何在 python 中创建一个类支持 __getitem__，但不允许迭代？

> ID：926688
> 
> 赞同：3
> 
> 时间：2009-05-29T15:45:35.040
> 
> 标签：python, operator-overloading, iteration

我想定义一个支持`__getitem__`但不允许迭代的类。例如：

```
class B:
   def __getitem__(self, k):
      return k

cb = B()

for x in cb:
   print x 
```

我可以在课堂上添加什么`B`来强制`for x in cb:`失败？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-29T16:11:20.693

我认为更好的解决方案是引发 TypeError 而不是普通的异常（这是不可迭代的类通常会发生的情况：

```
class A(object):
    # show what happens with a non-iterable class with no __getitem__
    pass

class B(object):
    def __getitem__(self, k):
        return k
    def __iter__(self):
        raise TypeError('%r object is not iterable'
                        % self.__class__.__name__) 
```

测试：

```
>>> iter(A())
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: 'A' object is not iterable
>>> iter(B())
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "iter.py", line 9, in __iter__
    % self.__class__.__name__)
TypeError: 'B' object is not iterable 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T15:48:07.647

从这个[问题](https://stackoverflow.com/questions/926574/why-does-defining-getitem-on-a-class-make-it-iterable-in-python)的答案可以看出，如果存在，__iter__ 会在 __getitem__ 之前被调用，所以简单定义 B 为：

```
class B:
   def __getitem__(self, k):
      return k

   def __iter__(self):
      raise Exception("This class is not iterable") 
```

然后：

```
cb = B()
for x in cb: # this will throw an exception when __iter__ is called.
  print x 
```

# c# - 以编程方式从 gmail 下载电子邮件（备份）

> ID：926694
> 
> 赞同：6
> 
> 时间：2009-05-29T15:46:16.240
> 
> 标签：c#, email, backup, gmail, imap

有谁知道批量转储gmail帐户的每封电子邮件并将电子邮件写入文件的方法？

我正在寻找一个程序，让用户在那里备份 gmail（可能通过 imap）并将其备份到单个文件或作为 pst（我知道 pst 可能会更难）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-09-24T00:16:37.627

前段时间我写了一篇关于完全相同主题的博客文章。有关详细信息，请参阅[HOWTO：从 C#](http://blog.rebex.net/news/archive/2007/05/14/howto-download-emails-from-gmail-account-in-csharp.aspx)中的 GMail 帐户下载电子邮件。

代码使用我们的[Rebex Mail 组件](http://www.rebex.net/secure-mail.net/)：

```
using Rebex.Mail;
using Rebex.Net;
...
// create the POP3 client
Pop3 client = new Pop3();
try
{

   // Connect securely using explicit SSL. 
   // Use the third argument to specify additional SSL parameters. 
   Console.WriteLine("Connecting to the POP3 server...");
   client.Connect("pop.gmail.com", 995, null, Pop3Security.Implicit);

   // login and password
   client.Login(email, password);

   // get the number of messages
   Console.WriteLine("{0} messages found.", client.GetMessageCount());

   // -----------------
   // list messages
   // -----------------

   // list all messages
   ListPop3MessagesFast(client); // unique IDs and size only   
   //ListPop3MessagesFullHeaders(client); // full headers
}
finally
{
   // leave the server alone
   client.Disconnect();      
}

public static void ListPop3MessagesFast(Pop3 client)
{
   Console.WriteLine("Fetching message list...");

   // let's download only what we can get fast
   Pop3MessageCollection messages = 
      client.GetMessageList(Pop3ListFields.Fast);

   // display basic info about each message
   Console.WriteLine("UID | Sequence number | Length");
   foreach (Pop3MessageInfo messageInfo in messages)
   {
      // display header info
      Console.WriteLine
      (
         "{0} | {1} | {2} ",
         messageInfo.UniqueId,
         messageInfo.SequenceNumber,
         messageInfo.Length
      );

      // or download the whole message
      MailMessage mailMessage = client.GetMailMessage(messageInfo.SequenceNumber);
   }   
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-29T15:51:11.813

Gmail 提供[POP](http://en.wikipedia.org/wiki/Post_Office_Protocol) [访问](http://mail.google.com/support/bin/answer.py?hl=en&answer=13273)。因此，只需使用任何允许您使用 POP 进行通信的[库，您就可以了。](http://sourceforge.net/projects/hpop/)

**编辑：**我刚刚注意到你提到了 IMAP；我建议您使用 POP 而不是批量转储。IMAP 对于您想要做的事情来说太健谈了。

如果您必须使用 IMAP，这里[有一个库](http://sourceforge.net/projects/imapnet/)供您使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T15:49:11.000

您可以使用 Unix 环境中的 fetchmail 创建 mbox 文件。

[http://lifehacker.com/software/gmail/geek-to-live--back-up-gmail-with-fetchmail-235207.php](http://lifehacker.com/software/gmail/geek-to-live--back-up-gmail-with-fetchmail-235207.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-31T17:49:14.467

[在https://github.com/jay0lee/got-your-back/wiki](https://github.com/jay0lee/got-your-back/wiki)有一个编译到 Windows 的开源 Python 程序（使用 py2exe）

但是 Mac 用户需要编译它（由于 py2exe 错误，我还没有完全弄清楚）。

无论哪种方式，您还需要一种按计划自动执行程序的方法。

# c# - 将集合传递给方法的格式

> ID：926695
> 
> 赞同：1
> 
> 时间：2009-05-29T15:46:17.630
> 
> 标签：c#, collections

我正在使用一个 API，它的方法需要这种类型的参数：

```
System.Collections.ObjectModel.Collection<GenericTickType> genericTickList 
```

如何为该参数实例化一个对象？这是我尝试过的，但它一直说方法调用有一些无效的参数。

```
List<TickType> ticks_to_get = new List<TickType> { TickType.Price }; 
```

我试过直接实例化一个集合而不是一个列表，但这似乎不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T18:00:20.450

> “我尝试过直接实例化 Collection 而不是 List，但这似乎不起作用。”

你得到什么错误？你绝对可以`Collection<T>`直接创建一个实例，它不是一个抽象类，它有几个公共构造函数，包括一个无参数的构造函数。您可以这样做，例如：

```
var values = new System.Collections.ObjectModel.Collection<int> { 1,2,3,4 }; 
```

我注意到您的示例代码有 a`GenericTickType`和 a `TickType`。这是一个错误还是您实际上有两个课程？你说它是一个枚举（哪个？），所以一个不可能从另一个派生。如果它们是两种枚举类型，`Collection<GenericTickType>`并且`Collection<TickType>`是两个不同的类，并且一个不能分配给另一个。

现在，如果`TickType`可以*转换*为`GenericTickType`（如果它们都是枚举，并且假设它们共享相同的数值，它们可能是），您仍然不能`Collection<TickType>`转换为`Collection<GenericTickType>`. 对于大多数类（在 C# 4 中出现），C# 中还没有相反/协变。但是您可以通过执行以下操作来投射*每个：* `TickType`

```
List<GenericTickType> list = new List<GenericTickType> { (GenericTickType)TickType.Price };
list.Add((GenericTickType)TickType.Price); // add more...
Collection<GenericTickType>genericTicks = new Collection<GenericTickType>(list); 
```

如果您已经拥有`List<TickType>`并可以访问 C# 3.0 和 LINQ，则可以执行以下操作：

```
List<TickType> ticks = new List<TickType> { TickType.Price };
list.Add(TickType.Price); // add more...
List<GenericTickType> castedList = ticks.Cast<GenericTickType>().ToList();
Collection<GenericTickType>genericTicks = new Collection<GenericTickType>(castedList); 
```

这使用 LINQ`Cast<T>()`和`ToList<T>()`扩展方法将原始列表中的*每个* 转换为并创建一个用于实例化. （我避免使用，所以你可以看到每个步骤中的类型）。`TickType``GenericTickType``List<GenericTickType>``Collecion<GenericTickType>``var`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T15:51:05.947

你不能通过 a`List<>`作为`Collection<>`

也许你有协方差/逆变的问题？你必须自己做演员：

```
List<TickType> ticks_to_get = new Collection<TickType> { TickType.Price };

genericTickList = (Collection<GenericTickType>) ticks_to_get; 
```

看看 Dave Bauman 的回答……除非 TickType.Price 不返回 TickType 类型的对象，否则它将不起作用

**编辑：**由于 GenericTickType 是一个枚举 - 您使用的是哪个 API？是你公司的吗——你能改变它吗？要求您传递枚举值的集合似乎很奇怪。看，如果您可以将枚举更改为[标记的枚举](http://msdn.microsoft.com/en-us/library/cc138362.aspx)......然后通过将它们与或运算符组合来传递所需的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T15:57:25.947

是什么类型的`GenericTickType`？它是枚举还是类？我假设枚举。如果是这种情况，请修改您的代码：

```
Collection<GenericTickType> ticks_to_get = new Collection<GenericTickType>() { GenericTickType.Price }; 
```

以上适用于 3.5 框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T15:56:12.233

您不能使用 {} 来初始化集合。但是，您可以执行以下操作：

```
List<TickType> ticks_to_get = 
    new List<TickType>( new TickType[] { TickType.Price }); 
```

或者

```
List<TickType> ticks_to_get = new List<TickType>();
ticks_to_get.Add(TickType.Price); 
```

# console-application - 使用选项自动化 DOS 程序的批处理脚本

> ID：926696
> 
> 赞同：4
> 
> 时间：2009-05-29T15:46:18.957
> 
> 标签：console-application

我有一个需要交互式输入的控制台程序（一个 DOS 程序）。在命令行中输入后，例如

```
commandline.exe /ShowReport 
```

DOS 提示符将提示用户键入一些值，然后进行下一个交互式输入。

例如，当我输入上述命令时，控制台会提示我以下选项：

```
press '1' to show Report A
press '2' to Show Report B 
```

如果我想显示报告 A，我会按“1”。

现在的问题是我想通过在脚本文件中预设所有输入值来自动化所有这些事情。也许是这样的（我不知道）

```
commandline.exe /ShowReport <1<'abc' 
```

我想为此编写一个批处理脚本。有什么工具可以让我这样做吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T15:50:28.940

您可以将所有输入写入文件（例如“input.txt”）并使用重定向为您的程序提供这些输入：

```
commandline.exe /ShowReport < input.txt 
```

'<' 告诉命令提示符使用右侧文件的内容作为标准输入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:56:13.437

严格来说不是批处理解决方案，但这可能会奏效： [Expect](http://expect.nist.gov/)

另请参阅[Wikipedia 条目](http://en.wikipedia.org/wiki/Expect)。

# html - 是否有工具可以采用正确的 HTML + CSS 并生成内联样式的 HTML？或者：将其转换为与电子邮件兼容的 HTML

> ID：926699
> 
> 赞同：6
> 
> 时间：2009-05-29T15:47:16.350
> 
> 标签：html, css, email

**可能重复**：有[哪些工具可以自动内联 CSS 样式来创建电子邮件 HTML 代码？](https://stackoverflow.com/questions/791070/what-tools-to-automatically-inline-css-style-to-create-email-html-code)

**作者注**：哦，是的，肯定是重复的。对不起。

通常，HTML 电子邮件不支持适当的 CSS 技术。

但是，使用这些技术进行开发很不错，因为它可以更快地进行更改等。（我不需要向大家推销 CSS 的好处！）

有没有一种工具可以将可爱的 HTML 转换成讨厌的电子邮件兼容 HTML，所有样式都是从 CSS 文件中推断出来并内联放置的？

* * *

尽管由于电子邮件客户端的众多差异而无法实现 100% 的兼容性，但*帮助*该过程的工具将非常有用，即使它只是采用 CSS 并将其内联。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:01:35.310

[Campaign Monitor 有一个关于 2008年电子邮件客户端 CSS 支持](http://www.campaignmonitor.com/css/)的优秀指南。它非常全面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T15:52:25.573

“与电子邮件兼容”的 CSS 或 HTML 没有标准，因此不太可能存在执行此任务的工具。不同的客户端会去除不同的标签和属性，尤其是基于 Web 的标签和属性。很多都是反复试验。反复试验很难自动化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T16:23:11.960

不幸的是，我不知道任何工具，但我认为这可以使用 javascript（使用 jQuery、原型或其他 js 框架）来完成，通过**渲染的**DOM 并发现应用的样式并基于它创建新的 HTML

一个好的开始是有一个源 div 标签和一个目标 div 标签，并看到目标中的 HTML 最终看起来像源。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T16:01:19.957

我想你可以通过一个脚本运行页面的文本，该脚本将发现 CSS 类和 id 并将它们的样式存储在一个数组中，然后通过并将 class="class" 替换为 style="style" 和 id=" id" 与 style="style" 等。这只是编程的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-27T20:29:26.383

是的，根据我的经验，最好的是：

[http://premailer.dialect.ca/](http://premailer.dialect.ca/)

[http://beaker.mailchimp.com/inline-css](http://beaker.mailchimp.com/inline-css)

[http://zurb.com/ink/inliner.php](http://zurb.com/ink/inliner.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-31T22:58:20.900

刚刚写了一篇关于将“好”的 HTML/CSS 转换为坏但兼容的 HTML/内联 CSS 的博客文章。

我个人使用[Premailer](http://premailer.dialect.ca/)来完成这项任务，您可以在我的帖子中了解更多信息：[http ://www.versapay.com/developer-blog/the-art-and-science-of-email-rendering-across-email-客户/](http://www.versapay.com/developer-blog/the-art-and-science-of-email-rendering-across-email-clients/)

# sql - 维护客户数据

> ID：926701
> 
> 赞同：1
> 
> 时间：2009-05-29T15:47:46.523
> 
> 标签：sql, database, excel, agile

我们所有的应用程序都依赖于一定数量的客户端数据，即查找组合框、用户、角色、用户角色......

我们目前使用电子表格来映射数据并生成插入脚本，然后将其导入 SQL 服务器。似乎对我们有用，但是当有很多变化时更新和维护非常困难（excel不擅长合并数据），当有很多数据时它很慢。

我确信这是一个常见问题，并且想听听其他人是如何解决它的，以便我们可以借鉴一些想法并改进我们的流程。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T17:50:09.580

Excel 用于导入数据。您可以快速编辑、排除故障，并且它有很多选项来组织数据。

我公司的几个开发人员试图逐步淘汰 Excel 数据导入表，但都失败了（一个在 6 个人工月之后）。构建一个专门的数据输入网站或 Windows 应用程序并不总是值得的。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T19:53:48.363

Infopath 和 SharePoint？（只是把它扔在那里。设置好需要一些技巧，我通常怀疑你在你的公司有）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T15:54:43.513

对于任何基于断开连接的文件的方法，您可能会遇到同样的问题。我的建议是使用您的查找来构建一个网页，该网页会发生变化并让您的客户访问它。让他们维护数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-30T07:11:23.517

我也建议使用 SharePoint。具体来说，Windows SharePoint Services 3.0。启动和运行它非常简单，它包含在 Windows Server 中。您可以轻松创建自定义列表（甚至可以从 Excel 导入），最重要的是，您可以将其链接到 Outlook 并在其上进行邮件合并。好东西。

# .net - 使用两个 Https 页面之间的 Response.Redirect 可以看到查询字符串变量吗？

> ID：926709
> 
> 赞同：0
> 
> 时间：2009-05-29T15:49:12.967
> 
> 标签：.net, ssl, https, response.redirect

我正在查看一个在两个 Https 页面之间具有 Response.Redirect 的 Web 应用程序。由于安全连接，我通常会假设查询字符串参数对于 https 请求不可见。但是，由于 Response.Redirect 在两个页面之间发回 302 - Object Moved 响应以及查询字符串变量，我担心此消息根本没有加密。

我用 HttpAnalyzer 查看了数据，但我相信它会自动解密 Https 流量。我对 Https 请求的一般工作方式有错误的想法吗？如果有人对如何进行此操作有任何建议，我将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T16:11:02.457

“可见”是什么意思？对入侵者？

您要连接的主机以未加密的形式可见，但不是完整的 URL 本身，除非存在中间人攻击（这要求用户信任攻击者的证书）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:49:00.933

尽管使用 HTTPS 在网络上不可见查询字符串，但对于包含查询字符串的 URL 可能存储或传输的位置还有其他问题：

[http://blog.httpwatch.com/2009/02/20/how-secure-are-query-strings-over-https/](http://blog.httpwatch.com/2009/02/20/how-secure-are-query-strings-over-https/)

# spring - 当没有用户通过身份验证时，方法 @Secured 应该抛出错误

> ID：926718
> 
> 赞同：1
> 
> 时间：2009-05-29T15:51:25.133
> 
> 标签：spring, gwt, spring-mvc, spring-security

我的服务代码如下...

```
@Controller
@GwtRpcEndPoint
public class ServerServiceImpl implements ServerService {

  @org.springframework.security.annotation.Secured("ROLE_ADMIN")
  public String runGwtSprMvcHibJpaDemo(String s) {

        System.out.println("SecurityContextHolder.getContext()="+SecurityContextHolder.getContext());
        System.out.println("SecurityContextHolder.getContext().getAuthentication()="+SecurityContextHolder.getContext().getAuthentication());
  }

} 
```

我的 applicationContext.xml

```
<security:global-method-security secured-annotations="enabled" jsr250-annotations="disabled" /> 
```

但是当我通过 gwt-rpc 调用 serviceImpl 时，由于用户尚未通过身份验证，runGwtSprMvcHibJpaDemo 是否应该打印出安全错误？相反，runGwtSprMvcHibJpaDemo 方法是通过输出执行的

```
 SecurityContextHolder.getContext()=org.springframework.security.context.SecurityContextImpl@ffffffff: Null authentication  SecurityContextHolder.getContext().getAuthentication()=null 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T18:10:15.687

添加

```
<security:http auto-config="true">
        <security:intercept-url pattern="/**" access="ROLE_ADMIN" />
</security:http> 
```

到您的 xml 配置，看看是否可以修复它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-03T07:47:08.333

在你的 spring 上下文中定义 bean，例如：

> bean id=" **userDetailsS​​ervice** " 类="packagename.MyUserService">。

请注意，bean 名称应该完全相同。Spring 在内部使用这个 bean 来启动这个服务。

MyUserService 是 UserDetailsS​​ervice 的实现。

# java - 如何在java中轻松删除链表中的重复项？

> ID：926721
> 
> 赞同：0
> 
> 时间：2009-05-29T15:51:54.370
> 
> 标签：java, linked-list

如何在java中轻松删除链表中的重复项？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-29T15:55:12.500

请改用[LinkedHashSet](http://java.sun.com/javase/6/docs/api/index.html?java/util/LinkedHashSet.html)，这样一开始就不会出现重复项。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-29T15:55:40.410

我不知道您的要求是否是使用链接列表，但如果不是，请使用 Set 而不是 List（您将问题标记为“最佳实践”）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T15:55:11.283

容易在什么方面？如果它是一个相当短的列表，最简单的解决方案是将其转储到一个 Set 中，然后返回到一个 List 中。

```
myList = new LinkedList<Whatever>(new HashSet<Whatever>(myList)); 
```

但是为什么要为此烦恼呢？如果你不想重复，你应该使用[`Set`](http://java.sun.com/javase/6/docs/api/java/util/Set.html); 如果您只想要一个列表，以便您可以将元素保持在它们插入时的相同顺序，您可以使用 a[`LinkedHashSet`](http://java.sun.com/javase/6/docs/api/java/util/LinkedHashSet.html)来获得两全其美： a`Set`像 a 一样可预测地迭代`LinkedList`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T15:56:15.400

搜索它们，如果两个代表相同的东西，删除其中一个。

你还想要什么？您需要有关如何快速执行此操作的建议吗？如果是这种情况，请将节点存储在哈希表中，以便在查找重复项时轻松匹配。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-19T06:22:44.783

```
import java.util.*;
import java.lang.*;

class Main
{
    public static void main (String[] args) throws java.lang.Exception
    {
        Collection<String> c = new LinkedList<String>();
        c.add("JAR");c.add("BDK");c.add("JDK");c.add("JAR");c.add("WAR");c.add("APK");c.add("BDK");
        c=new HashSet(c);
        c=new ArrayList(c);
        for(String s : c)
        {
            System.out.println(s);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-10-21T13:09:37.060

你可以使用`distinct()`Stream的方法。该`distinct()`方法基于 Stream 工作并返回仅包含唯一元素的流。此方法在内部调用该`equals()`方法。

```
duplicateElements.stream().distinct().collect(Collectors.toList()); 
```

# html - 文本区域内的标签

> ID：926723
> 
> 赞同：1
> 
> 时间：2009-05-29T15:52:03.917
> 
> 标签：html, textarea

我有一个包含一些元素的管理区域（2 个字段文本和 ID 以及排序字段），每个元素都可以通过创建/编辑/删除操作进行管理

而且我认为我可以通过使用 textarea 来简化它，管理员可以在其中将项目作为文本进行操作

```
<textarea>
  <item1:1>
  <item2:3>
</textarea> 
```

其中每个项目都包含在 < 和 > 中，并且在冒号后具有标识符，因此管理员可以轻松地对元素进行排序和重命名。

我刚刚测试了一位用户，他说数字让他感到困惑。

可以将带冒号的数字放入 span 标签中，并使其具有不同的颜色....

你怎么看？textarea 允许标签吗？它比使用物品更简单吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-29T15:57:38.460

textarea 的内容模型是#PCDATA（已处理的字符数据）。这意味着里面的元素将不被接受。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-04-13T02:50:09.253

遇到这种情况的任何人都可能想要使用“内容可编辑的 div”，例如

```
<div contenteditable="true"></div> 
```

这是一个例子[http://jsfiddle.net/mekwall/XNkDx/](http://jsfiddle.net/mekwall/XNkDx/)

感谢[https://stackoverflow.com/a/4705882/194309](https://stackoverflow.com/a/4705882/194309)

# php - 为什么我在 Symfony 1.2 上使用 Doctrine 保存“验证器失败”？

> ID：926725
> 
> 赞同：3
> 
> 时间：2009-05-29T15:52:30.127
> 
> 标签：php, symfony1, doctrine

假设我的 YAML 方案看起来像这样：

```
Note:
  options:
    type: MyISAM
    collate: utf8_unicode_ci
    charset: utf8
  actAs: { Timestampable: ~ }
  columns:
    content: { type: string, notnull: true}
    order_id: int(5)
    user_id : int
  relations:
    User:
      foreignAlias: Notes
      local: user_id
      foreign: id
      type: one
      foreignType: man
      onDelete: CASCADE 
```

执行时：

```
$note->setOrderId(0);
$note->save(); 
```

我收到以下错误：

```
1 validator failed on order_id (type) 
```

MySQL 将 order_id 存储为 bigint(20)。

我正在使用 Ubuntu 9.10、Symfony 1.2、PHP 5 和 MySQL 5。

编辑 ：

得到提示，如果我在 YAML 文件中删除所有提到的大小，我会收到 order_id (lenght) 的第二个验证器错误:-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-30T10:40:49.273

我知道了。用“integer”替换“int”并去掉大小就可以了。现在 YAML 文件看起来像：

```
Note:
  options:
    type: MyISAM
    collate: utf8_unicode_ci
    charset: utf8
  actAs: { Timestampable: ~ }
  columns:
    content: { type: string, notnull: true}
    order_id: integer
    user_id : integer
  relations:
    User:
      foreignAlias: Notes
      local: user_id
      foreign: id
      type: one
      foreignType: man
      onDelete: CASCADE 
```

我试过了，因为网上的其他人也有类似的错误，解决了用“string”替换“varchar”的问题。

如果有人陷入其中并阅读了此答案，请以他们的名义喝啤酒:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-28T21:55:53.027

我知道这是老...

我只是想我可以澄清一下有效的学说类型是“整数”、“字符串”、“浮点数”、“十进制”、“对象”、“clob”、“blob”、“enum”、“array”。

然后，Doctrine 将教义类型转换为所选后端的正确数据库类型。

这就是为什么“int”未能通过类型验证器，但“integer”有效。

# c++ - 如果我将 Objective-C 用于低级代码，我的 iPhone 应用程序会受到性能影响吗？

> ID：926728
> 
> 赞同：69
> 
> 时间：2009-05-29T15:53:36.803
> 
> 标签：c++, iphone, objective-c, performance, optimization

在 iPhone 或其他便携式硬件上编写 CPU 密集型或 GPU 密集型应用程序时，您必须做出明智的算法决策以使您的代码更快。

但是，如果您使用的语言比另一种语言表现更差，那么即使是出色的算法选择也可能会很慢。

是否有任何比较 Objective-C 和 C++ 的硬数据，特别是在 iPhone 上，但可能只是在 Mac 桌面上，用于各种类似语言方面的性能？我非常熟悉[这篇比较 C 和 Objective-C 的文章](https://stackoverflow.com/questions/826281/better-performance-with-libxml2-or-nsxmlparser-on-the-iphone)，但这是比较两种面向对象语言的更大问题。

例如，C++ vtable 查找真的比 Obj-C 消息快吗？快多少？线程、多态性、排序等。在我着手构建一个具有重复对象模型和各种测试代码的项目之前，我想知道是否有人已经这样做了，结果在哪里。这种类型的测试和比较本身就是一个项目，可能需要相当长的时间。也许这不是一个项目，而是两个并且只有输出可以比较。

我在寻找**硬数据**，而不是传福音。像你们中的许多人一样，出于各种原因，我喜欢和讨厌这两种语言。此外，如果有人在那里积极追求同样的事情，我会很有趣地投入一些代码来查看最终结果，我相信其他人也会提供帮助。我的猜测是它们都有优点和缺点，我的目标是准确找出它们是什么，以便在现实世界的场景中可以避免/利用它们。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-05-30T00:45:26.497

[Mike Ash 在他的帖子“常用操作的性能比较”](http://www.mikeash.com/?page=pyblog/performance-comparisons-of-common-operations.html)中对各种 Objective-C 方法调用与 C 和 C++ 的性能进行了一些硬性数字。此外， 当谈到使用 Objective-C++ 调整 iPhone 应用程序的性能时，Savoy Software 的[这篇文章很有趣。](http://savoysoftware.com/blog/?p=114)

比起 Objective-C++，我更喜欢 Objective-C 的简洁、描述性语法，并且没有发现语言本身是我性能瓶颈的根源。如果它们使我的代码更易于维护，我什至倾向于做一些我知道会牺牲一点性能的事情。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2012-04-10T21:27:54.530

是的，写得好的 C++ 速度要快得多。如果您正在编写性能关键的程序并且您的 C++ 不如 C 快（或在几个百分点之内），那么就有问题了。如果您的 ObjC 实现与 C 一样快，那么*通常*是有问题的 - 即该程序可能是 ObjC OOD 的一个坏例子，因为它可能使用一些“肮脏”的技巧来低于它正在运行的抽象层，例如直接ivar 访问。

Mike Ash 的“比较”非常具有误导性——我永远不会推荐这种方法来比较您编写的程序的执行时间，或者推荐它来比较 C、C++ 和 ObjC。呈现的结果来自*禁用*编译器优化的测试。当您测量执行时间时，在禁用优化的情况下编译的程序很少相关。将其视为将 C++ 与 Objective-C 进行比较的基准是有缺陷的。该测试还比较了单个功能，而不是整个、现实世界优化的实现——单个功能以非常不同的方式与两种语言结合在一起。这远非优化实现的现实性能基准。示例：*启用*优化后，`IMP`缓存与虚函数调用一样慢。静态分派（与动态分派相反，例如使用`virtual`）和对已知 C++ 类型的调用（可以绕过动态分派）可以积极优化。这个过程称为去虚拟化，使用时，声明的成员函数`virtual`甚至可能是`inline`d。在 Mike Ash 测试的情况下，对已声明且具`virtual`有空主体的成员函数进行了许多调用：当类型已知时，这些调用被*完全*优化掉，因为编译器看到了实现并且能够确定动态调度是不必要。编译器还可以消除对`malloc`在优化的构建中（有利于堆栈存储）。因此，在任何 C、C++ 或 Objective-C 中启用编译器优化都会在执行时间上产生巨大差异。

这并不是说呈现的结果完全没有用。`pthread_create`如果您想确定外部 API 在一个平台或架构上或`+[NSObject alloc]`在一个平台或架构上花费的时间与另一个之间是否存在可测量的差异，您可以获得一些关于外部 API 的有用信息。当然，这两个示例将在您的测试中使用优化的实现（除非您碰巧正在开发它们）。但是对于在您编译的程序中将一种语言与另一种语言进行比较……所呈现的结果在禁用优化的情况下毫无用处。

**对象创建**

还要考虑在 ObjC 中创建对象——每个对象都是动态分配的（例如在堆上）。使用 C++，对象可以在堆栈上创建（例如，在许多情况下与创建 C 结构和调用简单函数的速度差不多）、在堆上或作为抽象数据类型的元素。每次你分配和释放（例如通过 malloc/free），你可能会引入一个锁。当您在堆栈上创建 C 结构或 C++ 对象时，不需要锁（尽管内部成员可能使用堆分配），并且通常只需要几条指令或几条指令加上一个函数调用。

同样，ObjC 对象是引用计数的实例。对象在性能关键 C++ 中的实际需求`std::shared_ptr`是非常罕见的。在 C++ 中，使每个实例都成为共享的、引用计数的实例是不必要或不可取的。使用 C++，您可以更好地控制所有权和生命周期。

**数组和集合**

C 和 C++ 中的数组和许多集合也使用强类型容器和连续内存。由于下一个元素的成员的地址通常是已知的，优化器可以做更多的事情，并且你有很好的缓存和内存局部性。`NSObject`使用 ObjC，这对于标准对象（例如）来说远非现实。

**派遣**

关于方法，许多 C++ 实现很少使用虚拟/动态调用，特别是在高度优化的程序中。这些是优化器的静态方法调用和素材。

使用 ObjC 方法，每个方法调用（objc 消息发送）都是动态的，因此是优化器的防火墙。最终，这会导致许多限制或不便，即在编写性能关键的 ObjC 时，您可以做什么和不可以做什么以将性能保持在最低水平。这可能会导致更大的方法、IMP 缓存、频繁使用 C。

一些实时应用程序无法在其渲染路径中使用**任何**ObjC 消息传递。无——音频渲染就是一个很好的例子。ObjC 调度根本不是为实时目的而设计的；消息传递对象时可能会在幕后发生分配和锁定，从而使 objc 消息传递的复杂性/时间难以预测，以至于音频渲染可能会错过其截止日期。

**其他特性**

C++ 还为其许多库提供泛型/模板实现。这些优化得很好。它们是类型安全的，并且可以使用模板进行许多内联和优化（考虑它在编译时发生的多态性、优化和特化）。C++ 增加了一些在严格的 ObjC 中不可用或可比的特性。试图直接比较非常不同的语言、对象和库并不是那么有用——它只是实际实现的一小部分。考虑到设计和实现的许多方面，最好将问题扩展到库/框架或实际程序。

**其他要点**

C 和 C++ 符号可以在构建的各个阶段（剥离、死代码消除、内联和早期内联以及链接时间优化）更容易地删除和优化。这样做的好处包括减少二进制文件大小、减少启动/加载时间、减少内存消耗等。对于单个应用程序来说，这可能没什么大不了的；但是如果你重用了很多代码，而且你应该重用，那么如果实现了 ObjC，那么你的共享库可能会给程序增加很多不必要的重量——除非你准备好跳过一些燃烧的箍。因此，可扩展性和重用也是大中型项目和重用率高的组的因素。

**包含的库**

ObjC 库实现者也针对环境进行了优化，因此其库实现者可以利用一些语言和环境特性来提供优化的实现。尽管在纯 ObjC 中编写优化程序时存在一些相当大的限制，但 Cocoa 中存在一些高度优化的实现。这是 Cocoa 的强项之一，尽管 C++ 标准库（有些人称之为 STL）也没有懈怠。Cocoa 在比 C++ 高得多的抽象级别上运行——如果你不太清楚自己在做什么（或应该做什么），那么在*更接近金属的地方运行真的会让你付出代价*. 如果你不是某个领域的专家，回到一个好的库实现是一件好事，除非你真的准备好学习。同样，Cocoa 的环境也是有限的。您可以找到更好地利用操作系统的实现/优化。

如果您正在编写优化程序并且在 C++ 和 ObjC 中都有这样做的经验，那么*干净的 C++ 实现通常会比**干净*的 ObjC快两倍或更快（是的，您可以与 Cocoa 进行比较）。如果您知道如何优化，您通常可以比更高级别的通用抽象做得更好。虽然，一些优化的 C++ 实现将与 Cocoa 的一样快或慢（例如，我最初在文件 I/O 上的尝试比 Cocoa 的慢——主要是因为 C++ 实现初始化了它的内存）。

很多都归结为您熟悉的语言功能。我使用两种语言，它们都有不同的优势和模型/模式。它们很好地互补，并且两者都有很好的库。如果您正在实现一个复杂的、性能关键的程序，正确使用 C++ 的特性和库将为您提供更多的控制权并为优化提供显着优势，因此在正确的手中，“快几倍”是一个很好的默认期望（但是，不要期望每次都赢，或者不做一些工作）。请记住，要充分理解 C++ 才能真正达到这一点需要数年时间。

我将大部分性能关键路径保留为 C++，但也认识到 ObjC 对于某些问题也是一个非常好的解决方案，并且有一些非常好的库可用。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-05-29T16:11:11.210

很难为此收集“硬数据”，这不会产生误导。

像您建议的那样进行功能与功能比较的最大问题是这两种语言鼓励非常不同的编码风格。Objective-C 是一种带有鸭子类型的动态语言，其中典型的 C++ 用法是静态的。使用 C++ 或 Objective-C 时，相同的面向对象架构问题可能会有非常不同的理想解决方案。

我的感觉（因为我用两种语言编写了很多程序，主要是在大型项目中）：为了最大限度地提高 Objective-C 的性能，它必须非常接近于 C 编写。而使用 C++，可以在不使用 C++ 的情况下更多地使用该语言与 C 相比的任何性能损失。

哪一个更好？我不知道。对于纯粹的性能，C++ 将始终具有优势。但是 Objective-C 的 OOP 风格肯定有它的优点。我绝对认为用它来保持一个理智的架构更容易。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-11-25T13:44:05.370

这确实不是一般可以回答的问题，因为它实际上取决于您如何使用语言功能。两种语言都会有他们擅长的事情，他们擅长的事情，以及有时快有时慢的事情。这实际上取决于您使用什么以及如何使用它。唯一可以确定的方法是分析您的代码。

在Objective C中你也可以写c++代码，所以大部分情况下在Objective C中写代码可能更容易，如果你发现一些在其中表现不佳的东西，那么你可以尝试编写一个c++版本看看它是否有帮助（C++ 倾向于在编译时更好地优化）。如果你正在与之交互的 API 也写在 Objective C 中，它会更容易使用，而且你可能会发现它的 OOP 风格更容易或更灵活。

最后，您应该使用您知道可以编写安全、健壮代码的内容，如果您发现需要其他语言特别关注的领域，那么您可以切换到该领域。X-Code 确实允许您在同一个项目中编译两者。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-01-08T16:37:18.150

我没有关于 Objective C 的硬数据，但我确实有一个寻找 C++ 的好地方。

根据 Bjarne Stroustroup 在对 C++ 早期的反思（[http://www2.research.att.com/~bs/hopl2.pdf](http://www2.research.att.com/~bs/hopl2.pdf)）中，C++ 以 C with Classes 开始，因此可以考虑 C++（如 Objective C ) 将 C 推向其面向对象的极限。

这些限制是什么？在 1994-1997 年期间，许多研究人员发现，由于动态绑定，面向对象是有代价的，例如，当 C++ 函数被标记为虚拟并且可能/可能没有子类覆盖这些函数时。（在 Java 和 C# 中，所有函数都期望 ctor 本质上是虚拟的，对此您无能为力。）在 IBM Research Tokyo 研究人员的“Java 即时编译器的去虚拟化技术研究”中，他们对比了用于处理此问题的技术，包括 Urz Hölzle 和 Gerald Aigner 的一种技术。Urz Hölzle 在与 Karel Driesen 合作的另一篇论文中表明，在 C++ 程序中平均 5.7% 的时间（最高约 50%）用于调用虚函数（例如 vtables + thunk）。后来，他与一些 Smalltalk 研究人员合作，最终开发了 Java HotSpot VM，以解决 OO 中的这些问题。其中一些功能正在向后移植到 C++（例如“受保护”和异常处理）。

正如我所提到的，C++ 是静态类型的，而 Objective C 是鸭子类型的。执行（但不是代码行）的性能差异可能是这种差异的结果。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-02-06T18:41:25.603

大约 2 年前，我在 iPhone 3G 上进行了几次测试，当时没有文档或硬数字。不确定它们仍然有效，但源代码已发布并附加。

这不是一个非常广泛的测试，我主要对 NSArray 与 C Array 对迭代大量对象感兴趣。

[http://memo.tv/nsarray_vs_c_array_performance_comparison](http://memo.tv/nsarray_vs_c_array_performance_comparison)

[http://memo.tv/nsarray_vs_c_array_performance_comparison_part_ii_makeobjectsperformselector](http://memo.tv/nsarray_vs_c_array_performance_comparison_part_ii_makeobjectsperformselector)

您可以看到 C 数组在高迭代时要快得多。从那时起，我意识到瓶颈可能不是 NSArray 的迭代，而是消息的发送。我想尝试 methodForSelector 并直接调用方法以查看差异有多大，但从未考虑过。根据 Mike Ash 的基准测试，它的速度快了 5 倍多一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-09-07T19:14:24.940

[这项研究](http://www.vellios.com/2010/08/22/why-game-devs-dont-use-objective-c/)表明，要真正在 CPU 密集型游戏中获得性能，您必须使用 C。链接的文章包含一个可以运行的 XCode 项目。

我相信**底线**是：在必须与 iPhone 的功能交互的地方使用 Objective-C（毕竟，[到处都放蹦床对任何人都没有好处](https://stackoverflow.com/questions/1061005/calling-objective-c-method-from-c-method/1061576#1061576)），但是当涉及到循环时，比如矢量对象类或密集的数组访问，坚持使用 C++ STL 或 C 数组以获得良好的性能。

我的意思是这完全是愚蠢的`position = [[Vector3 alloc] init] ;`。如果您对基本对象（如位置向量）使用引用计数，您只是要求性能下降。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-06-09T13:20:37.397

是的。c++ 在性能/表现力/资源权衡方面占主导地位。

“我在寻找确凿的数据，而不是传福音”。谷歌是你最好的朋友。

1.  苹果工程师将 obj-c nsstring 与 c++ 交换以提高性能。在资源受限的设备中，只有 c++ 将其切割为 MAINSTREAM oop 语言。 [NSString stringWithFormat 很慢](https://stackoverflow.com/questions/13568822/nsstring-stringwithformat-is-slow)

2.  obj-c oop 抽象被解构为基于过程的 c-structs 以提高性能，否则 MAGNITUDE 顺序比 java 慢！作者也知道消息缓存 - 但不行。因此，对许多小型玩家/敌人对象进行建模是在 oop 中使用 c++ 完成的，或者使用 obj-c 在其周围使用简单的 OOP 包装器来完成许多过程结构。可以有一种范式等同于过程 + 面向对象编程 = obj-c。 [http://ejourneyman.wordpress.com/2008/04/23/writing-a-ray-tracer-for-cocoa-objective-c/](http://ejourneyman.wordpress.com/2008/04/23/writing-a-ray-tracer-for-cocoa-objective-c/)

# asp.net - Activator.CreateInstance 为参数“类型”抛出 ArgumentNullException

> ID：926729
> 
> 赞同：2
> 
> 时间：2009-05-29T15:53:49.830
> 
> 标签：asp.net, profile, web-deployment-project, activator

我最近遇到了我的个人资料提供程序的问题：它无法正确检索个人资料（请参阅下面的错误）。它在本地工作，但是当我将 Web 部署项目编译的代码放在服务器上时，它会崩溃。

> 值不能为空。参数名称：type 说明：当前web请求执行过程中发生了未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。
> 
> **Strack Trace：**
> [ArgumentNullException：值不能为空。参数名称：type] System.Activator.CreateInstance(Type type, Boolean nonPublic) +2796915 System.Web.Profile.ProfileBase.CreateMyInstance(String username, Boolean isAuthenticated) +76 System.Web.Profile.ProfileBase.Create(String username,布尔值已验证）+312

![由 imgur.com 主办](https://imgur.com/WJNkO.png)

* * *

我找到了解决方案，但远非显而易见（请参阅下面的答案）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T15:55:00.487

我的错误的解决方案是从 Web 部署项目中**取消选中此选项：**

> 视为库组件（删除 App_Code.Compiled 文件）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-03T15:59:48.077

在复选框更改后简单地再次构建 Web 部署项目有时是不够的。

您应该重建网站，或清理 ASP.NET 临时 ASP.NET 文件文件夹，该文件夹通常位于“%WINDIR%Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-31T09:23:09.167

我最近遇到了这个问题，结果证明是缺少依赖项。使用visual studio自带的fuslogvw.exe工具，终于确定了问题所在。

# infopath - 以编程方式生成 InfoPath 表单模板？

> ID：926733
> 
> 赞同：3
> 
> 时间：2009-05-29T15:54:42.717
> 
> 标签：infopath

是否可以以编程方式生成信息路径 2007 表单模板（xsn 文件=表单定义）？

我知道 infopath 2007 表单设计器没有对象模型，但有人知道任何第三方库吗？

表单视图本身是一个 xsl 文件，所以它应该是可能的。我会认为它也是一个常见的用例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-08T06:54:51.267

没有库或 API 可以做到这一点。虽然可以生成模板，但您需要自己编写。显然，这不是一件容易的事，而且容易出错。我建议您检查您的要求，以确保这是真正必要的。InfoPath 非常灵活，在不了解项目细节的情况下，您很有可能通过单个模板获得所需的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-04T09:20:15.367

可以从结构化源（假设是 xml）生成 manifest.xsf、xsl 和 xml 文件，然后将其打包（作为 .cab），扩展名为 .xsn
（.xsn 文件只不过是重新命名的 .cab ！）

*这只是一个原始概念——如果目的更明确一点，它可以被改进。为什么要生成？你要创建一堆不同的文件吗？做什么的？*

# matlab - 如何以给定格式将数据保存到文本文件中？

> ID：926741
> 
> 赞同：3
> 
> 时间：2009-05-29T15:55:34.887
> 
> 标签：matlab, file-io, text-files, number-formatting

我想将矩阵保存到文本文件中，以便我可以通过另一个程序读取它。现在我使用：

```
save('output.txt', 'A','-ascii'); 
```

但这会将我的文件保存为

```
6.7206983e+000  2.5896414e-001
6.5710723e+000  4.9800797e-00
6.3466334e+000  6.9721116e-001
5.9975062e+000  1.3346614e+000
6.0224439e+000  1.8127490e+000
6.3466334e+000  2.0517928e+000
6.3965087e+000  1.9721116e+000 
```

但我想让它们在没有“电子符号”的情况下保存，而不是所有数字。是否有捷径可寻？

编辑：谢谢！这工作得很好。抱歉，但我想我使用回滚弄乱了您的编辑。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-29T16:00:29.710

我将使用该[`fprintf`](https://www.mathworks.com/help/matlab/ref/fprintf.html)函数，它允许您自己定义输出数据的格式。例如：

```
fid = fopen('output.txt', 'wt');
fprintf(fid,'%0.6f %0.6f\n', A.');
fclose(fid); 
```

这将输出小数点后 6 位精度的矩阵 A。请注意，您还必须使用函数[`fopen`](https://www.mathworks.com/help/matlab/ref/fopen.html)和[`fclose`](https://www.mathworks.com/help/matlab/ref/fclose.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T16:42:42.877

Ditto gnovice 的解决方案，如果您需要性能和自定义格式。

[`dlmwrite`](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/dlmwrite.html)为您提供一些格式控制（全局，而不是基于每个字段）。但它的性能较低。几年前我进行了一次测试，dlmwrite 比 fopen/fprintf/fclose 解决方案慢 5-10 倍。（编辑：我指的是大矩阵，比如 15x10000 矩阵）

# sql - 从表中获取 TIME 数据类型 (MSSQL08) 的总和

> ID：926744
> 
> 赞同：7
> 
> 时间：2009-05-29T15:55:44.653
> 
> 标签：sql, sql-server, tsql, sql-server-2008

我有下表 TIME 数据类型

澄清：我代表小时/分钟/秒的视频，并想弄清楚视频的时长。

```
runtime
----------------
01:27:19.0000000
01:26:09.0000000
01:00:56.0000000
01:09:59.0000000
01:25:43.0000000
01:16:01.0000000
01:27:12.0000000
01:22:00.0000000
01:17:47.0000000
01:31:07.0000000
01:36:23.0000000
01:13:29.0000000
01:20:12.0000000
01:03:24.0000000
00:58:42.0000000 
```

我想得到所有这些时间的总和。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T16:14:56.093

我还没有太多使用 2008 并且我没有一个方便的实例来检查这个，但是这样的事情可能会起作用：

```
SELECT
     DATEADD(ms, SUM(DATEDIFF(ms, '00:00:00.000', my_time)), '00:00:00.000')
FROM
     dbo.My_Table 
```

正如 le dorfier 指出的那样，添加时间有点毫无意义，因为它们应该代表一天中的某个时间。我假设您使用它们来指示小时/分钟/秒。

哦，我不知道如果超过 24 小时会发生什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:33:41.527

的一些变化

从时间表中选择 SUM(DATEDIFF(MINUTE, '0:00:00', TimeCol))

会工作，但

您必须通过从每个日期时间中减去日期部分来进行标准化，并且您必须将总分钟数转换为时间

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T16:20:46.873

我能想到的最好方法是将时间跨度解析为小时、分钟、秒和毫秒分量，将其全部转换为毫秒（通过加法和乘法），然后将它们相加并使用模和减法将其转换回时间跨度.

例如

```
create function dbo.GetMilliseconds (@timespan varchar (16))
    returns int
as
begin
declare @ms int
declare @seconds int
declare @min int
declare @hour int
set @ms = cast(substring(@timespan, 10, 7) as int)
set @seconds = cast(substring(@timespan, 7, 2) as int)
set @min = cast(substring(@timespan, 4,2) as int)
set @hour = cast(substring(@timespan, 1, 2) as int)
return @ms + (@seconds * 1000) + (@min * 60000) + (@hour * 3600000)
end
go

create function dbo.ParseMilliseconds (@timespan int)
    returns varchar (16)
as
begin
declare @hour int
declare @min int
declare @seconds int
declare @ms int
declare @leftover int
set @hour = @timespan / 3600000 /* this will round down */  
set @leftover = @timespan % 3600000
set @min = @leftover / 60000
set @leftover = @leftover % 60000
set @seconds = @leftover / 1000
set @ms = @leftover % 1000
return 'You''ll have to the string conversion yourself'
end
go 
```

接着`SELECT dbo.ParseMilliseconds(sum(dbo.GetMilliseconds(timespan))) as added_timespan`

我还没有测试所有这些，可能有更简单的方法，但我知道这会奏效。

# c++ - 为什么我更喜欢使用成员初始化列表？

> ID：926752
> 
> 赞同：252
> 
> 时间：2009-05-29T15:56:23.763
> 
> 标签：c++, oop, object-construction

我偏爱在我的构造函数中使用成员初始化列表......但我早就忘记了这背后的原因......

您在构造函数中使用成员初始化列表吗？如果是这样，为什么？如果不是，为什么不呢？

* * *

## 回答 #1

> 赞同：302
> 
> 时间：2009-05-29T16:03:53.937

对于[POD](https://stackoverflow.com/a/146454/626796)类成员来说，这没有什么区别，只是风格问题。对于作为类的类成员，它避免了对默认构造函数的不必要调用。考虑：

```
class A
{
public:
    A() { x = 0; }
    A(int x_) { x = x_; }
    int x;
};

class B
{
public:
    B()
    {
        a.x = 3;
    }
private:
    A a;
}; 
```

在这种情况下， for 的构造函数`B`会调用 的默认构造函数`A`，然后初始化`a.x`为 3。更好的方法是让`B`的构造函数直接`A`在初始化列表中调用 的构造函数：

```
B()
  : a(3)
{
} 
```

这只会调用`A`' 的`A(int)`构造函数，而不是它的默认构造函数。在此示例中，差异可以忽略不计，但想象一下，如果您将`A`默认构造函数做得更多，例如分配内存或打开文件。您不会不必要地这样做。

此外，如果一个类没有默认构造函数，或者您有`const`成员变量，则*必须*使用初始化列表：

```
class A
{
public:
    A(int x_) { x = x_; }
    int x;
};

class B
{
public:
    B() : a(3), y(2)  // 'a' and 'y' MUST be initialized in an initializer list;
    {                 // it is an error not to do so
    }
private:
    A a;
    const int y;
}; 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-05-29T16:05:15.107

除了上面提到的性能原因之外，如果您的类存储对作为构造函数参数传递的对象的引用，或者您的类具有 const 变量，那么除了使用初始化列表之外，您别无选择。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2016-12-02T02:51:02.690

1.  **基类的初始化**

使用此处答案中未提及的构造函数初始化器列表的一个重要原因是基类的初始化。

按照构建顺序，基类应该在子类之前构建。如果没有构造函数初始化程序列表，如果您的基类具有默认构造函数，它将在进入子类的构造函数之前被调用，则这是可能的。

但是，如果你的基类只有参数化的构造函数，那么你必须使用构造函数初始化列表来确保你的基类在子类之前被初始化。

2.  **仅具有参数化构造函数的子对象的初始化**

3.  **效率**

使用构造函数初始化器列表，您可以将数据成员初始化为代码中所需的确切状态，而不是首先将它们初始化为默认状态，然后将它们的状态更改为代码中所需的状态。

4.  **初始化非静态 const 数据成员**

如果您的类中的非静态 const 数据成员具有默认构造函数并且您不使用构造函数初始化程序列表，则您将无法将它们初始化为预期状态，因为它们将被初始化为其默认状态。

5.  **引用数据成员的初始化**

当编译器进入构造函数时，引用数据成员必须初始化，因为引用不能在以后声明和初始化。这只有在构造函数初始化列表中才有可能。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-08-21T11:15:58.370

除了性能问题，还有一个非常重要的问题，我称之为代码可维护性和可扩展性。

如果 a`T`是 POD 并且您开始更喜欢初始化列表，那么如果有一次`T`将更改为非 POD 类型，则您无需更改初始化周围的任何内容以避免不必要的构造函数调用，因为它已经过优化。

如果类型`T`确实有默认构造函数和一个或多个用户定义的构造函数，并且有一次您决定删除或隐藏默认构造函数，那么如果使用了初始化列表，则不需要更新用户定义的构造函数的代码，因为它们已经正确实施。

与`const`成员或引用成员相同，假设最初`T`定义如下：

```
struct T
{
    T() { a = 5; }
private:
    int a;
}; 
```

接下来，您决定限定`a`为`const`，如果您从一开始就使用初始化列表，那么这是一个单行更改，但是`T`按照上面的定义，它还需要挖掘构造函数定义以删除分配：

```
struct T
{
    T() : a(5) {} // 2\. that requires changes here too
private:
    const int a; // 1\. one line change
}; 
```

如果代码不是由“代码猴子”编写，而是由工程师根据对自己正在做的事情进行更深入的考虑做出决定，那么维护会容易得多且不易出错，这已经不是什么秘密了。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-06-10T06:41:01.377

在运行构造函数的主体之前，将调用其父类的所有构造函数，然后调用其字段的构造函数。默认情况下，调用无参数构造函数。初始化列表允许您选择调用哪个构造函数以及构造函数接收哪些参数。

如果您有引用或 const 字段，或者使用的类之一没有默认构造函数，则必须使用初始化列表。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-11-25T02:49:57.617

```
// Without Initializer List
class MyClass {
    Type variable;
public:
    MyClass(Type a) {  // Assume that Type is an already
                     // declared class and it has appropriate 
                     // constructors and operators
        variable = a;
    }
}; 
```

这里编译器按照以下步骤创建类型的对象`MyClass`：

1.  `Type`的构造函数首先为“<code>a”调用。
2.  “<code>Type”的赋值运算符在构造函数体内被调用`MyClass()`进行赋值。

```
variable = a; 
```

3.  最后“<code>Type”的析构函数被“<code>a”调用，因为它超出了范围。

`MyClass()`现在考虑使用带有初始化列表的构造函数的相同代码：

```
 // With Initializer List
    class MyClass {
    Type variable;
    public:
    MyClass(Type a):variable(a) {   // Assume that Type is an already
                     // declared class and it has appropriate
                     // constructors and operators
    }
    }; 
```

使用初始化列表，编译器将遵循以下步骤：

1.  调用“<code>Type”类的复制构造函数来初始化 : `variable(a)`。初始化列表中的参数用于直接复制构造“<code>variable”。

2.  为“<code>a”调用“<code>Type”的析构函数，因为它超出了范围。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-07-28T12:39:24.853

句法：

```
 class Sample
  {
     public:
         int Sam_x;
         int Sam_y;

     Sample(): Sam_x(1), Sam_y(2)     /* Classname: Initialization List */
     {
           // Constructor body
     }
  }; 
```

需要初始化列表：

```
 class Sample
 {
     public:
         int Sam_x;
         int Sam_y;

     Sample()     */* Object and variables are created - i.e.:declaration of variables */*
     { // Constructor body starts 

         Sam_x = 1;      */* Defining a value to the variable */* 
         Sam_y = 2;

     } // Constructor body ends
  }; 
```

在上述程序中，当执行类的构造函数时，会创建**Sam_x**和**Sam_y**。然后在构造函数体中，定义那些成员数据变量。

用例：

1.  类中的常量和引用变量

**在 C 中，必须**在创建期间定义变量。与 C++ 中的相同方式，我们必须在对象创建期间使用初始化列表来初始化 Const 和 Reference 变量。如果我们在对象创建后进行初始化（在构造函数体内部），我们将得到编译时错误。

2.  没有默认构造函数的 Sample1（基）类的成员对象

    ```
     class Sample1 
     {
         int i;
         public:
         Sample1 (int temp)
         {
            i = temp;
         }
     };

      // Class Sample2 contains object of Sample1 
     class Sample2
     {
      Sample1  a;
      public:
      Sample2 (int x): a(x)      /* Initializer list must be used */
      {

      }
     }; 
    ```

在为派生类创建对象时，它将在内部调用派生类构造函数并调用基类构造函数（默认）。如果基类没有默认构造函数，用户将得到编译时错误。为了避免，我们必须有

```
 1\. Default constructor of Sample1 class
 2\. Initialization list in Sample2 class which will call the parametric constructor of Sample1 class (as per above program) 
```

3.  类构造函数的参数名称和类的数据成员相同：

    ```
     class Sample3 {
        int i;         /* Member variable name : i */  
        public:
        Sample3 (int i)    /* Local variable name : i */ 
        {
            i = i;
            print(i);   /* Local variable: Prints the correct value which we passed in constructor */
        }
        int getI() const 
        { 
             print(i);    /*global variable: Garbage value is assigned to i. the expected value should be which we passed in constructor*/
             return i; 
        }
     }; 
    ```

众所周知，如果两个变量具有相同的名称，则局部变量具有最高优先级，然后是全局变量。在这种情况下，程序考虑“i”值{左右两侧变量。即： i = i} 作为 Sample3() 构造函数中的局部变量，类成员变量(i) 被覆盖。为避免，我们必须使用

```
 1\. Initialization list 
  2\. this operator. 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-09-03T19:17:13.953

**只是为了添加一些额外的信息来演示成员初始化列表可以产生多大的差异**。在 leetcode 303 Range Sum Query - Immutable, [https://leetcode.com/problems/range-sum-query-immutable/](https://leetcode.com/problems/range-sum-query-immutable/)中，您需要构造一个具有一定大小的向量并将其初始化为零。这是两种不同的实现和速度比较。

**如果没有成员初始化**列表，要获得 AC，我花了大约**212 ms**。

```
class NumArray {
public:
vector<int> preSum;
NumArray(vector<int> nums) {
    preSum = vector<int>(nums.size()+1, 0);
    int ps = 0;
    for (int i = 0; i < nums.size(); i++)
    {
        ps += nums[i];
        preSum[i+1] = ps;
    }
}

int sumRange(int i, int j) {
    return preSum[j+1] - preSum[i];
}
}; 
```

现在**使用成员初始化列表**，得到AC的时间大约是**108 ms**。通过这个简单的例子，很明显，**成员初始化列表更有效**。所有测量均来自 LC 的运行时间。

```
class NumArray {
public:
vector<int> preSum;
NumArray(vector<int> nums) : preSum(nums.size()+1, 0) { 
    int ps = 0;
    for (int i = 0; i < nums.size(); i++)
    {
        ps += nums[i];
        preSum[i+1] = ps;
    }
}

int sumRange(int i, int j) {
    return preSum[j+1] - preSum[i];
}
}; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-06-12T13:15:05.980

正如 C++ 核心指南[C.49：在构造函数中优先初始化而不是赋值中](http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#c49-prefer-initialization-to-assignment-in-constructors)所解释的那样， 它可以防止对默认构造函数的不必要调用。

# .net - WPF 中的窗口 StateChanging 事件

> ID：926758
> 
> 赞同：14
> 
> 时间：2009-05-29T15:57:20.457
> 
> 标签：.net, wpf, user-interface, xaml

我需要在 WPF 应用程序最小化之前处理它，而不是当它已经存在时。我在 Window 对象 StateChanged 上找到了，但是当 Window 对象已经处于最小化状态时它会触发，那么为时已晚。

所以，我需要像“StateChanging”这样的事件来处理，而 Window 对象仍处于以前的状态。

是否可以创建这样的事件？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-30T02:18:31.053

在使用 Spy++ 最小化之前找到在窗口上调用的 windows 消息。第一个被调用的是 WM_WINDOWPOSCHANGING。当最小化寡妇时，我不知道 Windows 在 -32000、-32000 位置点上移动窗口，这些是 WM_WINDOWPOSCHANGING 中的参数。虽然，我测试过的只是在 Vista 上。[http://blogs.msdn.com/oldnewthing/archive/2004/10/28/249044.aspx](http://blogs.msdn.com/oldnewthing/archive/2004/10/28/249044.aspx)

这里使用的代码是由 Nir[​​在这里发布的](https://stackoverflow.com/questions/386484/how-can-i-only-allow-uniform-resizing-in-a-wpf-window/696266#696266)

这是示例代码

**xml**：

```
<Window x:Class="WindowStateTest2.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1" Height="300" Width="300">
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"></RowDefinition>

        <RowDefinition Height="*"></RowDefinition>
    </Grid.RowDefinitions>
        <Button Click="btnClear_Click" Grid.Row="0" x:Name="btnClear">Clear</Button>            

        <TextBox Name="txt" VerticalScrollBarVisibility="Visible" Grid.Row="2"></TextBox>
</Grid>
</Window> 
```

**C＃**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Interop;
using System.Runtime.InteropServices;

namespace WindowStateTest2
{
/// <summary>
/// Interaction logic for Window1.xaml
/// </summary>
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();

        this.StateChanged += new EventHandler(Window1_StateChanged);
        this.SourceInitialized += new EventHandler(Window1_SourceInitialized);

    }

    #region Event handlers

    void btnClear_Click(object sender, RoutedEventArgs e)
    {
        this.txt.Text = string.Empty;
    }
    void Window1_SourceInitialized(object sender, EventArgs e)
    {
        AttachWndProc();
    }

    void Window1_StateChanged(object sender, EventArgs e)
    {
        if (this.WindowState == WindowState.Minimized)
            Console.WriteLine("SC: " + this.WindowState);
    } 

    #endregion

    #region Const

    private int SYSCOMMAND = 0x0112;
    private int SC_MINIMIZE = 0xf020;
    private int WINDOWPOSCHANGING = 0x0046;

    #endregion

    private void AttachWndProc()
    {
        HwndSource source = HwndSource.FromHwnd(new WindowInteropHelper(this).Handle);
        source.AddHook(new HwndSourceHook(WndProc));
    }

    [StructLayout(LayoutKind.Sequential)]
    internal struct WINDOWPOSPARAMS
    {
        public IntPtr hwnd;
        public IntPtr hwndInsertAfter;
        public int x;
        public int y;
        public int cx;
        public int cy;
        public int flags;
    }

    private IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
    {
        if (msg == WINDOWPOSCHANGING)               
        {
            WINDOWPOSPARAMS param = (WINDOWPOSPARAMS)Marshal.PtrToStructure(lParam, typeof(WINDOWPOSPARAMS));
            if (param.x == -32000 && param.y == -32000)
            {
                Output("");

                                    // EVENT WOULD BE RAISED HERE

                Output("State before minimize:");
                Output(string.Format("CurrentState: {0}", this.WindowState));
                Output(string.Format("Location {0} {1}: ", this.Top, this.Left));
                Output("");
            }
        }

        // process minimize button
        if (msg == SYSCOMMAND && SC_MINIMIZE == wParam.ToInt32())
        {
            Output("Minimize clicked");             
        }

        handled = false;
        return IntPtr.Zero;
    }

    public void Output(object output)
    {
        this.txt.Text += output.ToString();
        this.txt.Text += Environment.NewLine;           
    }       

}
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T23:49:51.540

我不认为你将能够直接做到这一点。

对窗口的最小化调用可以从许多地方发生，而不仅仅是 Window Chrome 上的最小化按钮（例如，右键单击任务栏，或从 Windows 任务管理器）和 AFAIK，没有办法直接处理按钮事件从 Window Chrome 触发（如果有人知道如何执行此操作，请告诉我！）。

**好消息**是你可以伪造它，但这不是微不足道的，所以你必须决定它是否值得。首先，您必须将标准的 Window Chrome 替换为您自己的。**[你可以在这里](http://blogs.msdn.com/wpfsdk/archive/2008/09/08/custom-window-chrome-in-wpf.aspx)**找到如何做到这一点。

其次，您必须创建自己的“最大化/最小化/关闭”按钮并将事件连接到适当的行为。由于这是您自己的 UI，因此您可以随意收听和取消 Button 事件。

请记住，您仍然无法通过任务栏/Windows 任务管理器检测或阻止用户最小化，因此它可能不是您想要的。

# ruby-on-rails - 在 Rails 中使用 partials 的最佳实践

> ID：926761
> 
> 赞同：10
> 
> 时间：2009-05-29T15:57:33.810
> 
> 标签：ruby-on-rails, dry, partial

为了与 DRY 原则保持一致，我尝试在重复特定模式超过一次或两次时立即使用分音。结果，我的一些观点由十个或更多不同的部分组成。我担心这可能会对整体性能产生负面影响。一些编程书籍将部分的使用与方法的使用进行了比较。那么我应该使用相同的理由来确定何时使用它们吗？

**关于 Rails 项目中部分的大小和数量的最佳实践是什么？**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T16:35:08.283

我已经喜欢你的做法了：一旦你重复了两次查看代码，就将其重构为部分代码。*蒂姆说得对，您可以在*对其进行分析和证明有必要*之后*根据需要加快它的速度。

 *这是我的一个警告：如果您与处理视图的专业设计师合作，从长远来看，拥有相当重复的视图代码可能会更容易。有些人很难通过局部搜索并“看到”它们如何组合在一起。我发现这些人更容易让他们管理整个 shebang 并在需要时更新多个文件。最佳？对我们这些程序员来说不是，但设计师更习惯于在一到三个文件中而不是 20 个文件中查看大部分 HTML。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-29T16:05:12.067

记住[优化规则](https://stackoverflow.com/questions/226465/should-i-use-multiplication-or-division/226610#226610)！

如果在您的应用程序完成后，您的视图太慢，请使用 New Relic 之类的工具来找出减速发生的位置。可能有很多地方，但不太可能在您的部分中。

# cocoa - 创建捆绑包 - 出了什么问题？

> ID：926766
> 
> 赞同：1
> 
> 时间：2009-05-29T15:58:13.093
> 
> 标签：cocoa, macos, bundle, info.plist

我这里有一个比较简单的。我正在制作捆绑包以存在于我的应用程序的 Resources 文件夹中（并且可能在 Application Support 文件夹中）。这些包将包含应用程序处理的数据的模板信息。我构建了一个包，扩展名为“booksprintstyle”，目录结构符合规范。我已经设置了一个 Info.plist，我想我已经填写了我需要的所有值。我是否需要更改我的应用程序中的某些内容以将这些带有扩展名的文件夹识别为捆绑文件，还是我的捆绑结构中缺少某些内容？我注意到有些包有一个名为 PkgInfo 的文件；那很重要吗？

下面是我的包中的 Info.plist。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>CFBundleDevelopmentRegion</key>
    <string>English</string>
    <key>CFBundleGetInfoString</key>
    <string>1.0, Copyright © 2009 Joey Lange</string>
    <key>CFBundleIdentifier</key>
    <string>net.atherial.books.exporter.printingpress.printstyle</string>
    <key>CFBundleInfoDictionaryVersion</key>
    <string>6.0</string>
    <key>CFBundleName</key>
    <string>Books Print Style - Generic</string>
    <key>CFBundlePackageType</key>
    <string>BNDL</string>
    <key>CFBundleShortVersionString</key>
    <string>1.0</string>
    <key>CFBundleSignature</key>
    <string>????</string>
    <key>CFBundleDisplayName</key>
    <string>Books Print Style - Generic</string>
    <key>NSHumanReadableCopyright</key>
    <string>Copyright © 2009 Joey Lange</string>
    <key>CFBundleVersion</key>
    <string>1.0</string>
</dict>
</plist> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T18:14:05.600

> 我是否需要更改我的应用程序中的某些内容才能将这些带有扩展名的文件夹识别为捆绑文件...</p>

是的。在应用的 Info.plist 中为这些捆绑包的类型导出 UTI 声明。您将声明 UTI 符合`com.apple.package`. 有关更多信息，请参阅[了解统一类型标识符](http://developer.apple.com/mac/library/documentation/FileManagement/Conceptual/understanding_utis/)。

> 下面是我的包中的 Info.plist。

那不相关。必要的声明放在您的*应用程序包*中，而不是您的文档/插件包中。

> 我注意到有些包有一个名为 PkgInfo 的文件；那很重要吗？

[不。](http://developer.apple.com/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/ConfigApplications.html#//apple_ref/doc/uid/20002094-98415)

# java - 扩展 Android 的默认 Gmail/电子邮件应用程序

> ID：926770
> 
> 赞同：4
> 
> 时间：2009-05-29T15:58:57.447
> 
> 标签：java, android, gmail

我想通过插入它们的 ContentProvider 或使用意图过滤器来扩展 Android 平台的默认 Gmail/电子邮件应用程序。本质上，我希望能够扫描传入的电子邮件以查找将在我的 Android 应用程序中触发事件的特殊规则。如果无法自动扫描电子邮件，那么我至少想在电子邮件查看器屏幕上添加一个菜单项，允许用户将电子邮件内容标记为需要扫描。

1.  应用程序是否`Gmail/Email`允许您以这种方式扩展它们？
2.  为了将来参考，除了查找示例代码或阅读应用程序作者提供的文档之外，是否有一种标准方法可以找出我的应用程序可以使用哪些意图？也许像一个工具？

谢谢，马克

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-31T16:26:54.753

> Gmail/电子邮件应用程序是否允许您以这种方式扩展它们？

Gmail 是封闭源代码，因此很难知道它支持或不支持什么。

电子邮件应用程序不是公共 SDK 的一部分，因此试图依赖它可能拥有的任何 ContentProvider（我不知道它是否有）将是一个错误，因为您的应用程序可能会因后续的 Android 更新而中断。

> 我至少想在电子邮件查看器屏幕上添加一个菜单项，允许用户将电子邮件内容标记为需要扫描。

这样做的唯一方法是假设 Gmail/Email 使用 Menu#addIntentOptions()，并且通过 Google 代码搜索，情况似乎并非如此。

您可以考虑联系 K9 的开发人员，看看您是否可以连接到他们的 Android 电子邮件应用程序。

> 是否有一种标准方法可以找出我的应用程序可以使用哪些意图？也许像一个工具？

并不真地。意图操作只是字符串。

# c# - 将列表的一部分复制到新列表

> ID：926771
> 
> 赞同：15
> 
> 时间：2009-05-29T15:59:09.240
> 
> 标签：c#, list, string

大家好。有没有办法将单个（或者更好的是，二维）字符串列表的一部分复制到一个新的临时字符串列表中？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-29T16:05:44.483

尽管 LINQ 确实比列表（使用`Skip`and `Take`）更容易和更通用，但它`List<T>`的[`GetRange`](http://msdn.microsoft.com/en-us/library/21k0e39c.aspx)方法使它变得轻而易举：

```
List<string> newList = oldList.GetRange(index, count); 
```

`index`（要复制的第一个元素的索引在哪里，以及`count`要复制的项目数。）

当您说“二维字符串列表”时-您是指数组吗？如果是这样，您是指锯齿状数组（`string[][]`）还是矩形数组（`string[,]`）？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:07:24.953

我不确定我得到了这个问题，但我会看看**Array.Copy**函数（**如果你指的是数组的字符串列表**）

以下是在 .NET 2.0 框架中使用 C# 的示例：

```
String[] listOfStrings = new String[7] 
                              {"abc","def","ghi","jkl","mno","pqr","stu"};
String[] newListOfStrings = new String[3];

// copy the three strings starting with "ghi" 
Array.Copy(listOfStrings, 2, newListOfStrings, 0, 3);

// newListOfStrings will now contains {"ghi","jkl","mno"} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-29T16:09:07.433

FindAll 将让您编写一个 Predicate 来确定要复制哪些字符串：

```
List<string> list = new List<string>();
list.Add("one");
list.Add("two");
list.Add("three");

List<string> copyList = list.FindAll(
    s => s.Length >= 5
);

copyList.ForEach(s => Console.WriteLine(s)); 
```

这会打印出“三”，因为它有 5 个或更多字符长。其他的被忽略。

# c - 从进程 ID 获取 Winstation 名称

> ID：926772
> 
> 赞同：0
> 
> 时间：2009-05-29T15:59:21.627
> 
> 标签：c, windows, winapi, msdn

我正在尝试获取单独的进程仅使用其进程 ID 打开的 winstation 的名称（例如“winsta0”）。我在 MSDN 上找不到任何可以做到这一点的东西。他们似乎只有 GetProcessWindowStation() 仅适用于您自己的进程。

有任何想法吗？

更新：也许这是难题的一部分......

BOOL ProcessIdToSessionId( __in DWORD dwProcessId, __out DWORD *pSessionId );

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-03T23:40:52.783

您可能必须使用 EnumWindowStations()、EnumDesktops()、EnumDesktopWindows() 和 GetWindowThreadProcessId() 来查看所有正在运行的窗口，直到找到与所需进程 ID 匹配的窗口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T13:15:58.603

好吧，我查看了 API 函数，但遇到了和你一样的死胡同。只要目标进程创建一个或多个顶级窗口，Remy 的建议就应该有效。我也想到了以下疯狂的想法：

1.  使用 VirtualAllocEx() 在目标进程中分配一些可执行内存
2.  使用 WriteProcessMemory() 将一些代码写入该内存
3.  使用 CreateRemoteThread() 执行该进程中的代码

注入的代码将调用 GetProcessWindowStation()，然后使用 IPC 机制将其发送回您的进程。获取后，使用 VirtualFreeEx() 恢复目标进程的原始地址空间。在其他用户的进程中使用它会产生一些额外的问题，但如果您以管理员身份运行，它应该仍然可以工作。

# javascript - 在 textarea 之前移动 Tiny MCE

> ID：926776
> 
> 赞同：2
> 
> 时间：2009-05-29T16:00:24.357
> 
> 标签：javascript, html, tinymce

我想根据我的需要定制微型 mce。如果有人对此有任何想法，请帮助我。

问题是当您向页面添加微小的 mce 时，它​​位于 HTML dom 中的 textarea 之后。IE。

```
<textarea class="fckEditor required" name="data[Banneramend][summary]" id="data[Banneramend][summary]" style="display: none;"/>
<span id="data[Banneramend][summary]_parent" class="mceEditor defaultSkin"><table cellspacing="0" cellpadding="0" id="data[Banneramend][summary]_tbl" class="mceLayout" style="width: 450px; height: 170px;">......... 
```

我想要的是，当创建微小的 mce 时，它​​应该看起来像。

```
<span id="data[Banneramend][summary]_parent" class="mceEditor defaultSkin"><table cellspacing="0" cellpadding="0" id="data[Banneramend][summary]_tbl" class="mceLayout" style="width: 450px; height: 170px;">.........<textarea class="fckEditor required" name="data[Banneramend][summary]" id="data[Banneramend][summary]" style="display: none;"/> 
```

是否有任何功能可以做到这一点，或者做一个明确的黑客将是最好的主意。

高拉夫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-30T13:03:36.067

您可以`theme_advanced_toolbar_location`在 TinyMCE 的`init`功能中使用

```
tinyMCE.init({
...
    theme_advanced_toolbar_location : "top"
}); 
```

[维基参考](http://wiki.moxiecode.com/index.php/TinyMCE:Configuration/theme_advanced_toolbar_location)

# .net - .NET 资源泄漏陷阱

> ID：926779
> 
> 赞同：13
> 
> 时间：2009-05-29T16:00:39.367
> 
> 标签：.net, memory, memory-leaks, resource-leak

开发人员可以通过多种方式被 .NET 中的无意资源泄漏所困扰。我认为将它们聚集在一个地方会很有用。

请为每个项目添加一个答案，以便获得最佳投票:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-29T16:09:02.270

未能删除事件处理程序。

注册活动应与取消注册配对：

```
 this.myObject.MyEvent += new EventHandler(myObject_MyEvent);
   this.myObject.MyEvent -= new EventHandler(myObject_MyEvent); 
```

有一个发生在[CodeProject](http://www.codeproject.com/KB/showcase/IfOnlyWedUsedANTSProfiler.aspx)上的系统示例。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-29T16:07:39.680

P/Invoking 到非托管代码，而不是清理它们，或者不实现 IDisposable 来清理它们。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-29T17:10:55.210

不使用`Using`.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-29T16:02:12.330

保持数据库连接打开。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-29T16:04:12.487

未能实现 Dispose 并因此不释放子对象。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-29T17:09:57.070

WCF 客户端对象不像其他 IDisposable 对象那样执行。如果操作处于错误状态，则必须中止 WCF 服务的客户端，否则它将保持连接打开。这通常是通过艰难的方式学习的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-29T17:25:15.677

使用 Wea​​kReference 可能会导致细微的泄漏，其中 WeakReference 持有的对象被清理，因为它没有强引用，但 WeakReference 本身并不是因为你保持对它的强引用。

如果你有一个你从不修剪的弱引用列表或字典之类的东西，你可能会遇到这种情况。即使在收集了目标之后，您最终也会泄漏 WeakReference 对象。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-29T16:24:42.430

几乎所有使用 Office API 的东西。由于它们都是 COM 对象，因此必须释放它们。如果要使用事件处理程序，还必须保留对它们的类​​引用，否则它们会丢失引用。在很多情况下，你甚至不得不手动调用 GC 来清理对象

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-30T00:08:14.217

容易内存泄漏：在 List 类型的类中创建一个静态字段。将项目添加到列表。它们永远不会被垃圾收集，所以除非你记得在完成它们时手动删除你的项目，否则内存会永远被占用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-29T16:11:06.263

未能在 System.Windows.Window 对象上调用“关闭”方法。

确保对 System.Windows.Window 对象的所有托管资源进行垃圾回收的唯一方法是调用 Window 对象的“Close()”方法。调用 Dispose 或将对象引用设置为 null 不会破坏对象。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-29T16:16:33.630

在启动代码之外填充的静态列表、字典和基于集合的资源。

如果您将字典用作全局缓存而不是适当的基于 LRU 的缓存，则可能会发生这种情况。

任何**静态**的东西都需要格外小心！

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-29T16:12:58.183

如果您将托管内存视为“资源” - 未能取消挂钩事件处理程序是内存泄漏（以及各种其他更严重的错误）的常见来源。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-29T17:30:49.757

未能在 .NET Compact Framework 上处理任何与绘图相关的对象（图形、字体、SolidBrush、笔等）。当您不想要时，这可能会导致一些严重的内存泄漏（移动设备 = 内存有限）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-29T16:06:49.680

模拟令牌句柄保持打开状态。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-11-26T12:15:55.240

WPF 资源字典泄漏。一些有用的链接：

*   [WPF Memory Leak，懒惰补水资源的故事](http://i-zaak.eu/Lists/Posts/Post.aspx?ID=11)
*   [DynamicResource\StaticResource 导致内存泄漏](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/b97a5f83-5394-430e-9a78-9d3a957e3537/)
*   [ResourceDictionary 和 MergedDictionaries 的内存泄漏问题](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/88cb33bb-a907-40a9-af3d-7d212b10b4c2)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-26T12:20:48.643

错误配置 Spring.NET 以创建应该是单例的东西的多个实例。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-09-28T02:27:39.840

[在Timer](http://msdn.microsoft.com/query/dev10.query?appId=Dev10IDEF1&l=EN-US&k=k%28SYSTEM.TIMERS.TIMER%29;k%28TargetFrameworkMoniker-%22.NETFRAMEWORK,VERSION=V3.5%22%29;k%28DevLang-CSHARP%29&rd=true)上调用 Dispose() 失败

# sql - 如果存在子级，如何仅显示 TreeView 展开符号 [+]

> ID：926781
> 
> 赞同：1
> 
> 时间：2009-05-29T16:01:15.700
> 
> 标签：sql, database, treeview, lazy-loading

我开发了一个从数据库中的分层数据填充树视图的应用程序。

我将它设计为使用延迟加载，因此它仅在扩展节点时获取子节点。

我的问题是，除非我调用数据库并查看，否则显然我不知道节点是否有子节点。目前我已经实现了一个虚拟子节点，因此所有节点都会出现 [+] 图标，然后我删除这个虚拟节点并在`BeforeExpand`事件中获取真正的子节点。

这意味着对于没有子节点的节点，我会得到一个 [+] 图标，因此用户单击展开图标并且没有任何显示看起来有点粗制滥造。

在延迟加载树视图中处理子节点的首选方法是什么？如果我调用数据库以查看是否有子节点，那么我还不如只加载子节点而忘记延迟加载对吧？

*我的一个想法是在数据库中存储一个“HasChildren”标志，这样我就可以有选择地只为实际上有*子节点的节点创建我的虚拟子节点。

不好意思扯远了，我很想看看其他人的想法……

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T16:18:17.203

当您拨打电话时，请检查子节点以及节点数据：

```
SELECT  tp.*, 
        (
        SELECT  1
        FROM    table tc
        WHERE   tc.parent = tp.id
        LIMIT 1
        ) AS has_children
FROM    table tp 
```

你不必数，它可能很长。

只需检查是否存在至少一个孩子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T16:06:02.067

更改您的初始查询以返回所有相同的数据，但还要计算子项。当儿童计数不为零时，显示 [+]。发布您的架构和查询以获取计数

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T16:26:15.783

我对这个问题的首选解决方案是在您的分层数据集上实现预先排序的树遍历。有关示例实现，请参见[http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/ 。](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

关键是，如果您为每个节点维护一个左右值，那么如果左右值相差一个以上，则该节点有子节点。

这种方法唯一值得注意的缺点是在更改节点结构时必须主动维护这些左右值。

# html - 如何从 HTML 链接中提取 HREF 值？

> ID：926788
> 
> 赞同：3
> 
> 时间：2009-05-29T16:01:42.407
> 
> 标签：html, regex, perl

我的文本文件包含 2 行：

```
<IMG SRC="/icons/folder.gif" ALT="[DIR]"> <A HREF="yahoo.com.jp/">yahoo.com.jp/</A>
</PRE><HR> 
```

在我的 Perl 脚本中，我有：

```
my $String =~ /.*(HREF=")(.*)(">)/;
print "$2"; 
```

我的输出如下：

```
Output 1: yahoo.com.jp

Output 2: ><HR> 
```

我想要实现的是让我的 Perl 脚本自动提取字符串中的`<A Href="">`

由于我对正则表达式很陌生，所以我想问一下我的正则表达式是否格式错误？如果是这样，有人可以提供一些建议让它看起来更好吗？

其次，我不知道为什么我的第二个输出是`"><HR>"`，我认为预期的行为是 output2 将被跳过，因为它不包含 HREF="。显然我错了。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-29T16:14:33.503

使用正则表达式解析 HTML 的效果往往足以让您陷入一种虚假的安全感。对于控制输入的简单情况，您可以摆脱它，但最好使用[HTML::Parser](http://search.cpan.org/perldoc?HTML::Parser)之类的东西。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-29T16:38:18.717

为了回答您关于为什么您的正则表达式不起作用的具体问题，您正在使用`.*`“贪婪” - 默认情况下它会尽可能多地匹配。替代方案将使用非贪婪形式，`.*?`或者对您要匹配的内容更加严格。例如，`[^"]*`将匹配任何不是双引号的内容，这似乎是您正在寻找的内容。

但是，是的，其他海报是正确的 - 使用正则表达式在 HTML 解析中做任何重要的事情都是灾难的根源。从技术上讲，您可以正确地做到这一点，尤其是在 Perl 5.10（它具有更高级的正则表达式功能）中，但通常不值得头疼。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T21:34:14.667

如果可以的话，我想建议*最简单*的方法（它可能不是最快或最轻的方法）：[HTML::TreeBuilder::XPath](http://search.cpan.org/perldoc?HTML::TreeBuilder::XPath)

它在非格式良好的 HTML 中为您提供了 XPath 的强大功能。

```
use HTML::TreeBuilder::XPath;

my $tree= HTML::TreeBuilder::XPath->new_from_file( 'D:\Archive\XPath.pm.htm' );
my @hrefs = $tree->findvalues( '//div[@class="noprint"]/a/@href');
print "The links are: ", join( ',', @hrefs ), "\n"; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-29T16:33:25.943

当尝试使用正则表达式匹配 HTML（或 XML）时，您必须小心使用*. 你很少想要一个 .* 因为 start 是一个贪婪的修饰符，它会尽可能匹配。正如 Gumbo 所示，使用字符类说明符 [^"]* 来匹配除引号之外的所有字符。这将匹配到结束引号。您可能还想使用类似的东西来匹配尖括号。试试这个：

```
/HREF="([^"]*)"[^>]*>/i 
```

这应该更加一致。

# jquery - 我在使用 Jquery 更改点击事件时遇到问题

> ID：926790
> 
> 赞同：0
> 
> 时间：2009-05-29T16:02:28.943
> 
> 标签：jquery, image, onclick, swap, src

我正在尝试在单击图像时交换图像......到目前为止，这是我的 jquery，但它不工作。

```
$(document).ready(function(){
imgFldr = '../../App_Themes/Default/Images/';
    $('#smallImg1').click(function(){

        $('#smallImg1').attr('src', imgFlder+'belkinSmall4.png');
    });
}); 
```

下面是我的 HTML 示例

```
<div>
     <img id="smallImg1" src="../../App_Themes/Default/Images/belkinSmall1.png" />
</div> 
```

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:09:07.603

我会这样写：

```
$(function() {
  var imageFolder = '../../App_Themes/Default/Images/';
  $('#smallImg1').click(function(){
    $(this).attr('src', imageFolder + "belkinSmall4.png");
  });
}); 
```

*   `$(function() { ... })`是简写`$(document).ready(function() { ... })`
*   `imageFolder`而不是`imgFldr`. 没有意义的缩写imo。
*   `var imageFolder`, 也是（`var`这里的关键），所以它是一个局部变量，而不是全局变量。
*   `$(this)`而不是`$('#smallImg1')`, 以避免重复。结果是一样的。

但是，这只是对您的代码的重构——您的代码段和我的代码段都应该可以工作。

那么，“不起作用” - 图像会改变吗？路径无效吗？你有任何 JS 运行时错误吗？如果你`'../../App_Themes/Default/Images/belkinSmall4.png'`手动设置 src 怎么办——图像存在吗？

# php - 我是否以错误的方式使用 Symfony flash 变量？

> ID：926791
> 
> 赞同：3
> 
> 时间：2009-05-29T16:03:21.003
> 
> 标签：php, symfony1

在一个动作中，我为用户设置了一些反馈：

```
 $this->getUser()->setFlash('message', array(
    "type" => "notice",
    "content" => "Well done buddy, you did it."
    ));

    $this->redirect('home/index'); 
```

在视图中，我只使用以下代码：

```
<?php if ($sf_user->hasFlash('message')): $message = $sf_user->getFlash('message') ?>
  <p class="<?php echo $message["type"] ?>" ><?php echo $message["content"]?></p>
<?php endif; ?> 
```

但该消息从未出现。

并不是说问题不是“它出现一次然后消失”，因为这意味着它可以工作。问题是它永远不会出现。不止一次。

我使用的是 Symfony 1.2，这就是为什么 flash var 现在绑定到用户对象的原因。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-08-08T14:42:07.507

`setFlash`用两个字符串（不是数组）尝试相同的操作。我认为这会奏效。Symfony 在模板中访问数组时会转义数组。试着`var_dump($sf_user->getFlash('message'));`确定你得到了什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T16:31:52.150

Symfony 中的 Flash 用于在页面上仅显示一次响应，即“闪烁”一条消息。如果页面被刷新，该闪存将不再存在。

所以假设用户提交了一个表单，并且动作执行了以下代码

```
$this->getUser()->setFlash( 'message', 'Some message here' ); 
```

并且视图具有以下内容

```
# Note: getFlash returns "" if flash is not set
echo $sf_user->getFlash('message'); 
```

然后这个用户在提交表单后对视图的第一个请求，因此设置该 flash 将导致 getFlash 返回“ *Some message here* ”并删除/取消设置 flash。因此，该用户对同一消息的任何请求现在都将返回一个空字符串。

这意味着，一个闪光只持续一个请求。这是在与表单相同的页面上显示表单响应的好方法。

# jquery - 如何更改此 jQuery 插件的显示？

> ID：926796
> 
> 赞同：1
> 
> 时间：2009-05-29T16:03:58.197
> 
> 标签：jquery

这个文本计数器和限制器效果很好，但我希望能够将“剩余字符”的显示更改为文本区域之前，而不是之后。开发人员不回复电子邮件，所以我想知道：如何更改它以显示剩余的字符到 textarea 之前，而不是之后？谢谢...

的HTML：

```
<p>Message (less than 1000 characters):</p> (would like the remaining character count to display here)

<script type="text/javascript"> jQuery(function($){ $("textarea.text").dodosTextCounter(1000, {counterDisplayElement: "span",counterDisplayClass: "textCounterDisplay"}); });</script>

<textarea class="text" name="comment" id="comment" rows="10" cols="60"></textarea>
(Character count is now displayed here) 
```

jQuery：

```
jQuery.fn.dodosTextCounter = function(max, options) {
    // if the counter display doesn't exist, the script will attempt to create it
    options = $.extend({
        counterDisplayElement: "span",                  // tag for the counter display
        counterDisplayClass: "dodosTextCounterDisplay", // class for the counter display
        addLineBreak: true                              // whether to add <br /> after the input element before the counter display
    }, options);

    $(this).each(function(i) {
        updateCounter(this, max, options, i);
        $(this).keyup(function() {
            updateCounter(this, max, options, i);
            return this;
        });
    });
    return this;
};

function updateCounter(input, max, options, index) {
    var currentLength = 0;
    var val = $(input).val();
    if(val) {
        currentLength = val.length;
    }
    if(currentLength > max) {
        $(input).val(val.substring(0, max));
    } else {
        var charLeft = max - currentLength;
        var counterDisplay = options.counterDisplayElement + "." + options.counterDisplayClass + ":eq("+index+")";
        var createNew = $(counterDisplay).length == 0;
        if(createNew) {
            var element = document.createElement(options.counterDisplayElement);
            if(options.counterDisplayElement == 'input') {
                $(element).val(charLeft.toString());
            } else {
                $(element).html(charLeft.toString());
            }
            $(element).addClass(options.counterDisplayClass).insertAfter($(input));
            if(options.addLineBreak) {
                $(input).after("<br />");
            }
        } else {
            if(options.counterDisplayElement == 'input') {
                $(counterDisplay).val(charLeft.toString());
            } else {
                $(counterDisplay).html(charLeft.toString());
            }
        }

    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T16:22:31.400

确定计数显示位置的行是：

```
$(element).addClass(options.counterDisplayClass).insertAfter($(input)); 
```

您可以将其更改为：

```
$(element).addClass(options.counterDisplayClass).insertBefore($(input)); 
```

* * *

如果您在脚本之前绝对需要它，我认为您需要向函数添加另一个参数，以便您可以控制元素的插入位置。

# javascript - jQuery UI 数字微调器事件问题

> ID：926798
> 
> 赞同：1
> 
> 时间：2009-05-29T16:04:18.117
> 
> 标签：javascript, jquery, html, events, jquery-ui

我已经被这个问题难住了一个多星期:(任何对此问题的见解将不胜感激！

如何链接 jQuery UI 数字微调器/步进器 ( [http://wiki.jqueryui.com/Spinner](http://wiki.jqueryui.com/Spinner) ) 以便标签文本值随着微调器值的增加或减少而变化？

```
 ...
        <script type="text/javascript">

                $(document).ready(function() {

                    $("#s1").spinner({max: 100, min: -100});

                    $("#s1").bind("spin", function() {
                      $("label1").innerText = $("#s1").spinner("value");
                    });
                });
        </script>
    ...

<body>
...
    <p><label for="s1">Basic:</label> <input id="s1" name="value"/></p>
    <p><label for="label1"></label></p>
...
</body> 
```

谢谢！

编辑：除了输出问题外，处理程序本身似乎也存在问题。当我旋转/更改微调器时，处理程序不会执行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T08:22:35.953

根据 UI/Spinner 文档，微调器更改事件的名称不是“spin”，而是“spinchange”。如果您相应地更改 .bind 方法的参数，事情应该会起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T17:30:37.107

试试这个 - 从你上面的示例中，我将你的标签更改为一个跨度，以便文本可以去某个地方，在自旋处理程序中使用 this.value，并使用 jQuery 的 .html() 来转储值。

```
<script type="text/javascript">
        $(document).ready(function() {

            $("#s1").spinner({max: 100, min: -100});

            $("#s1").bind("spin", function() {
              $("#label1").html(this.value);
            });
        });
</script>

<body>
  <p><label for="s1">Basic:</label> <input id="s1" name="value"/></p>
   <p><span id="label1"></span></p>
</body> 
```

# xslt - XSL Rookie - 我能否在不重复整个“if test”块的情况下制作一个匹配“this phrase”的 XSL 也匹配“ths fraze”？

> ID：926799
> 
> 赞同：2
> 
> 时间：2009-05-29T16:04:45.920
> 
> 标签：xslt, pattern-matching

我是一个完整的 XSL 新手，正在编写一个 XSL 文件来将可能出现在应用程序创建的输出日志中的许多不同的错误消息格式化为 CSV 格式。

这些输出日志中的可匹配标签可能会略有不同。例如，日志中的一个句子可能包含短语“Service Month/Year:”，但来自应用程序不同区域的另一个句子将包含“Svc Month/Yr:”。

有没有办法将该短语的这两种变体放在我的 XSL 的一行中？或者我是否必须重复整个 If 块，以及我想在其自己的 If 块中匹配的短语中的每个变体？

我尝试在此处发布被反引号包围的 XSL，但它在一个无法阅读的大块中运行。如果有人可以帮助解决这个问题，如果您告诉我如何使其可读，我很乐意发布。:-)

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T17:41:22.173

XSL 允许像其他语言一样组合条件语句。每个都不需要其 on if 语句。您是否在考虑这些方面的事情？

```
<xsl:choose>
  <xsl:when test="contains(text(), 'Service Month/Year:')
               or contains(text(), 'Svc Month/Yr:')
               ">
    <!-- do something -->
  </xsl:when>
</xsl:choose> 
```

请记住 xml/xsl 区分大小写。为了使其更灵活，它更加冗长：

```
<xsl:variable name="lower" select="'abcdefghijklmnopqrstuvwxyz'"/>
<xsl:variable name="upper" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/>
<xsl:choose>
  <xsl:when test="contains(translate(text(), $upper, $lower), 'service month/year:')
               or contains(translate(text(), $upper, $lower), 'svc month/yr:')
               ">
    <!-- do something -->
  </xsl:when>
</xsl:choose> 
```

编辑：我提出了一个更好的答案

```
<xsl:template name="containsToken">
  <xsl:param name="inputString"/>
  <xsl:param name="tokens"/>
  <xsl:param name="delimiter"/>
  <xsl:variable name="lower" select="'abcdefghijklmnopqrstuvwxyz'"/>
  <xsl:variable name="upper" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/>

  <xsl:choose>
    <xsl:when test="contains($tokens, $delimiter)">
      <xsl:variable name="token">
        <xsl:value-of select="substring-before($tokens, $delimiter)"/>
      </xsl:variable>
      <xsl:choose>
        <xsl:when test="contains(translate($inputString, $upper, $lower), translate($token, $upper, $lower))">
          <xsl:text>True</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <!-- loop -->
          <xsl:call-template name="containsToken">
            <xsl:with-param name="inputString" select="$inputString"/>
            <xsl:with-param name="tokens" select="substring-after($tokens, $delimiter)"/>
            <xsl:with-param name="delimiter" select="$delimiter"/>
          </xsl:call-template>
        </xsl:otherwise>
      </xsl:choose>
    </xsl:when>
    <xsl:otherwise>
      <xsl:choose>
        <xsl:when test="contains(translate($inputString, $upper, $lower), translate($tokens, $upper, $lower))">
          <xsl:text>True</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:text>False</xsl:text>
        </xsl:otherwise>
      </xsl:choose>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template> 
```

**用法：**

```
<xsl:variable name="found">
  <xsl:call-template name="containsToken">
    <xsl:with-param name="inputString" select="text()"/>
    <xsl:with-param name="tokens" select="'Service Month/Year:|Svc Month/Yr:'"/>
    <xsl:with-param name="delimiter" select="'|'"/>
  </xsl:call-template>
</xsl:variable>

<xsl:if test="$found = 'True'">
  <!-- process -->
</xsl:if> 
```

分隔符可以是您想要的任何字符或字符。标记是要搜索的事物列表，每个事物之间都有分隔符。享受！

# c# - 重载将不同类型的泛型列表作为参数的方法

> ID：926801
> 
> 赞同：0
> 
> 时间：2009-05-29T16:05:15.047
> 
> 标签：c#, .net, generics, overloading

如何重载将具有不同类型的通用列表作为参数的方法？

例如：

我有两种方法：

```
private static List<allocations> GetAllocationList(List<PAllocation> allocations)
{
    ...
}

private static List<allocations> GetAllocationList(List<NPAllocation> allocations)
{
    ...
} 
```

有没有办法可以将这两种方法合二为一？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T16:14:53.300

当然可以......使用泛型！

```
private static List<allocations> GetAllocationList<T>(List<T> allocations) 
   where T : BasePAllocationClass
{

} 
```

这假设您的“allocations”、“PAllocation”和“NPAllocation”都共享一些名为“BasePAllocationClass”的基类。否则，您可以删除“where”约束并自己进行类型检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T16:15:19.527

如果您的 PAllocation 和 NPAllocation 共享一个公共接口或基类，那么您可以创建一个只接受这些基对象列表的方法。

但是，如果他们不这样做，但您仍然希望将两个（或多个）方法组合成一个，您可以使用泛型来做到这一点。如果方法声明类似于：

```
private static List<allocations> GetCustomList<T>(List<T> allocations)
{
    ...
} 
```

那么您可以使用以下方法调用它：

```
GetCustomList<NPAllocation>(listOfNPAllocations);
GetCustomList<PAllocation>(listOfPAllocations); 
```

# apache-flex - Flex：是否可以在不发疯的情况下为 Flex 应用程序设计样式？

> ID：926807
> 
> 赞同：0
> 
> 时间：2009-05-29T16:06:44.233
> 
> 标签：apache-flex

是否有任何库可以帮助我为 Flex 应用程序设计样式而不会发疯？

例如，是否有任何“可接受”的方式来设置元素的大小/位置而不将其硬编码到每个元素中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T17:23:36.007

元素的宽度、高度和位置不是样式，它们是属性。不幸的是，它们不能通过样式表进行设置。

您可以做的是扩展 Container 类之一并覆盖 childrenCreated() 方法，访问“children”数组中的元素并设置所需的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:25:30.370

您可以使用垂直或水平布局子级的 VBox 和 HBox 组件。我会避免嵌套太多，因为它会影响您的应用程序性能。

# versioning - 完全新手的版本控制

> ID：926808
> 
> 赞同：22
> 
> 时间：2009-05-29T16:06:49.600
> 
> 标签：versioning

我对编程世界完全陌生，对行话和典型方法知之甚少。

前段时间我在写一些代码，但在删除坏代码时不小心删除了一些好代码。从那时起，我开始创建文件的版本，我会用日期和版本号命名每个文件。

但是，这很麻烦，必须为每个文件指定一个唯一的名称，然后转到我的核心文件并更改对新文件名称的引用。

然后，就在前几天，我不小心用这种方法写了一些重要的东西，可能是因为命名错误。

不用说，这种方法很糟糕。

我正在寻找有关更好做法、更好工具的建议。我一直在研究版本控制，但其中很多，git svn 看起来真的很复杂。这个想法是为了加快整个版本控制过程，而不是通过命令行使其变得更难。

现在我希望有一个工具可以在我每次按 ctrl-s 时保存文件的唯一版本，并给我一个按钮来创建最终版本。

当然，如果有关于完全不同的做事方式的建议，那就更棒了。

谢谢大家。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-29T16:41:34.810

这个问题有两种方法：

1.  **按需版本控制**。这是*subversion、CVS*等所使用的模型。当您进行了“重大”更改时，您决定告诉系统“保留此版本”。
2.  **自动版本控制**。这是一些旧的*VAXen、Eclipse、IDEA*、每个*wiki*以及一些作家的工具所使用的模型。每次保存时，都会隐式创建一个新版本。在某些删除时，旧版本可能会被剔除（例如，一周前执行的工作只保留一个版本，而不是每次保存）。

听起来您更喜欢＃2，因为它是“万无一失的”——您永远不必去，“哎呀，在进行此更改之前，我应该'签入'/'保留'我的工作。” 您可以随时回滚。一个缺点是您必须手动逐步浏览旧版本才能找到某些内容，因为与 #1 不同，您通常不会对每个更改进行描述。

另一个缺点是，对于大文件，或者不容易区分/修补的文件（即二进制文件），您将开始快速消耗磁盘空间。

顺便说一句，听起来你不需要标准 SCM 系统中 90% 的功能——分支、标签等——但你最终可能会找到它们的用途。因此，从长远来看，学习一个可能是一种胜利。您可以使用 svn 等来做到这一点，但这需要一些定制。如果您使用脚本编辑器（emacs、vi、TextMate 等），您可以将“保存”命令重新定义为“保存并制作新版本”。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-29T16:09:05.950

颠覆或多或少是黄金标准。

我建议（特别是对于新手）你检查 BeanStalk (www.Beanstalkapp.com) 来为你的客户端运行你的 subversion 服务器和 TortoiseSVN。

祝你好运！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-29T16:47:37.907

无论您做什么，如果有人提到 Visual SourceSafe，请尽可能快地运行。VSS 是由撒旦自己创建的，并流传下来折磨全世界的开发人员。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-29T18:12:58.443

我认为你处于一个必须稍微走出舒适区并花一些时间学习 git 的位置。它很容易学习和使用。

相信我，这真的很值得。花在学习 git 上的时间是值得的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-29T16:12:04.157

如果您不是在团队中工作，则可以使用 Eclipse 的本地历史功能之类的东西。它在本地存储文件的版本，您可以随时恢复到以前的版本。更多细节在这里：[http](http://help.eclipse.org/ganymede/index.jsp) ://help.eclipse.org/ganymede/index.jsp （搜索“本地历史”）。我很确定其他 IDE 也有这样的功能。

如果您正在与他人合作编写代码，则可能无法学习其中一种标准工​​具，例如 SVN、CVS 或 git。对于其中大多数，有许多可用的 IDE 插件，因此您不必*使用*命令行。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-29T16:13:07.357

我目前使用 Subversion，但我的源代码管理经验有限。

不过，我建议阅读 Eric Sink 的教程。

[http://www.ericsink.com/scm/source_control.html](http://www.ericsink.com/scm/source_control.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-29T16:17:57.123

最好学习如何使用现有的“行业标准”版本控制工具，如 Subversion。即使您是编程和版本控制的新手，SVN 也不难学习，并且会很好地为您服务。我个人使用并推荐适用于 Windows 的[VisualSVN Server](http://www.visualsvn.com/server)和[TortoiseSVN](http://tortoisesvn.tigris.org)。两者都是免费的，而且使用起来非常简单。

对于在每次保存时创建修订的系统，也许您应该查看[版本控制文件系统](http://en.wikipedia.org/wiki/Versioning_file_system)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-29T16:18:22.083

如果您在 Windows 中，我认为 TortoiseSVN 将是一个很好的 Subversion 客户端供您尝试。它不会做你正在寻找的每次我保存我得到一个新版本 - 你必须手动将版本“提交”到存储库。当您进行提交时，会创建一个新版本，实质上会保存您当时的进度。TortoiseSVN 对用户非常友好，它是一个 GUI，所以你不会在命令行上工作。您将能够执行诸如右键单击 Windows 资源管理器中的文件并选择提交以保存进度等操作。另外，TortoiseSVN 是免费和开源的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-29T16:21:09.357

颠覆并不复杂。如果你使用的是 Windows，TortiseSVN 会很有帮助，如果你使用的是 Eclipse，subclipse 插件很棒。（不管怎样，你可能应该使用 eclipse :)）

其他一些有点复杂，但你只需要知道 eclipse 的模式。也许你可以用一个开源项目或一些现有的颠覆服务器“试试看”。

循环将是：

首先，您“签出”一个存储库。这将使用存储库中的内容填充您指定的目录。

如果你是从命令行做的——它是“svn co”——那里有足够的帮助来解决剩下的问题。

其次，您编辑文件。您不必锁定它们或任何东西。

如果你添加一个新文件，你一添加它就使用“svn add filename”。在您提交更改之前，这实际上不会更改存储库。

完成一组编辑后，您可以使用“svn ci”将它们签入（svn commit 也可以）。这个有一点你会永远忘记的转折——每次提交都需要注释。您不必指定要提交的文件或任何内容，但您确实需要位于项目的顶层（它将提交您目录下的所有内容。

所以这里的过程是，转到项目树的“根”并键入：

svn ci -m "评论"

小菜一碟。

最后，如果其他人正在检查东西，事情就会变得有点陌生。在您提交之前，您应该“更新”并获取他们的更改。只需要“svn up”，但它可能会警告您存在合并。这只发生在你们俩都编辑了同一个文件时，并且 90% 的时间，合并会顺利进行。其余时间，它会在您的文件中放置一些小标记，告诉您更改了什么以及它们更改了什么。“up”命令将告诉您它对哪些文件执行此操作。在签入文件之前，请先查看它们并清理文件。

总是在“svn up”和“svn ci”之间进行测试，你永远不知道他们糟糕的更改是否破坏了你的原始代码。

就是这样。从 CLI 很容易，图形环境几乎不值得（但是如果你在 eclipse 中，subclipse 真的很好，因为它会直观地显示你需要签入的修改文件）。

如果你忘记了，svn 的命令行帮助非常简洁和有用，它告诉你你需要知道的内容，并且对所有的子命令和选项都有帮助。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-29T18:11:30.100

如果你正在寻找一个易于设置的 Windows 版本控制系统，我强烈推荐[TortoiseHg](http://bitbucket.org/tortoisehg/)，一个易于使用的 Windows [Mercurial](http://selenic.com/mercurial/)前端。您不必担心设置和跟踪与文件分开的存储库，但如果您愿意，您始终可以这样做。Mercurial 是一个很棒的工具，因为它可以随着您的需求而增长。它具有所有常用功能，例如轻松合并等，并且根据我的经验，它比 Git 更容易理解。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-05-29T16:16:33.537

我认为 Git 真的很容易使用，尤其是当您使用 GitHub 时。他们还提供了许多很好的启动和运行指南。

```
http://github.com
http://github.com/guides/home 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-29T18:05:38.957

我使用过 Git、SVN、CVS 和 Perforce。在 Windows 和 Unix 环境中。

我的投票绝对是 SVN，因为它易于使用和灵活。我现在更喜欢使用命令行，但有一次我在 Windows 上使用 TortoiseSVN，我们能够让非技术人员轻松使用它。

使用 SVN。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-05-29T20:53:57.167

认识到版本控制的必要性，您肯定走在正确的轨道上，但听起来不确定这对您和您的工作可能意味着什么。一旦你了解了版本控制系统背后的概念，你就会真正体会到它们。

概念很简单：源代码控制系统是一款旨在帮助您存储和管理代码的软件。根据您选择的系统，将代码输入和输出的方式会有所不同：一种范例是您故意“签出”文件，对其进行更改，对其进行测试并确保它是好的，然后再将其签入。另一个是您只需保存所做的每一个更改，因为磁盘空间非常便宜，比您最初创建源所花费的时间和精力要便宜得多。

另一个重要的概念是“基线”或“标签”。当您的产品处于准备发货状态时，您告诉源代码控制系统创建一个“标签”并用该标签标记您的整个源代码库中的每个当前项目。这样，当有人报告 4.1 版中的错误时，您可以访问您的系统，请求所有带有“4.1 版”标签的文件，并准确获取他们遇到问题的源代码。

将源代码控制工具与您的开发环境集成在一起，使整个过程比乱用命令行要容易得多。（不要因为命令行的复杂性而忽视命令行，它们为有经验的用户提供了优雅的控制，你最终会成为有经验的用户。）但是现在，我推荐一个源代码工具，它可以尽可能地自动化这个过程尽可能。

需要考虑的一些事项：您是现在，还是打算与其他开发人员共享开发？这可能会对您设置服务器的方式产生影响。如果您在自己的盒子上单独开发，您可以在本地进行设置，但这可能不是团队的最佳方法。（如果你不确定，git 在那个领域非常灵活。）你打算存储大型多媒体文件，还是只存储源代码？一些源代码系统被设计为只有效地存储文本文件，并且不能很好地处理电影、声音或图像文件。

还有一点需要知道的是，大多数较新的源代码控制系统需要在服务器上运行某种“守护程序”程序（Subversion、git、Perforce、Microsoft Team Foundation Server），而较旧、更简单的系统只直接使用文件系统（Visual Source安全，cvs）并且不需要服务器程序。

如果您不想学习太多并且您的要求很低，那么更简单的解决方案就足够了。Microsoft 的 Visual Source Safe 曾经与他们的 Visual Studio 产品一起提供，并且是一个非常简单易用的工具。它不是很健壮，它只是微软的，它不能很好地处理大文件，但它非常非常容易设置和使用。如果您不想花钱，Subversion 和 git 是两个出色的开源解决方案，并且在网络上有很多关于这两个的文档。

如果你喜欢花钱，Perforce 被认为是专业开发团队的绝佳选择（而且我相信他们有免费的单开发者版本。）如果你真的喜欢花钱并想让比尔盖茨开心，微软的团队Foundation Server是一个完整的软件开发生命周期管理器，在Windows环境下非常好用，功能非常强大；但是您可能希望使用整个 Windows 服务器（加上 SQL Server）实例来托管它，而且仅在许可证上就需要花费数千美元。不幸的是，它不适合单人商店，或者如果您没有 Windows 管理员经验。

如果您有预算或人脉，请一位经验丰富的软件工程师帮助您开始工作，这可能是通往成功的最快途径。否则，您将不得不做更多的研究来了解哪些系统最适合您的情况。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-11-22T16:42:45.947

无论您使用哪种 VCS，如果您选择按需版本控制而不是自动版本控制（借用 Alex 的帖子中的术语），您将不得不通过一些仪式来：-create、-rename、-move、-copy 或 -delete受源代码控制的文件。

创建新文件时，必须先将其添加到源代码管理，然后再将更改提交到存储库。

当您重命名、移动、复制或删除受源代码控制的文件时，请使用您的 VCS 客户端执行此操作。在 TortoiseSVN 和 TortoiseGit 中，移动和复制操作是通过右键单击和拖动来完成的，而重命名和删除操作是通过右键单击来完成的。

可以想象，更改项目名称等内容可能会非常麻烦，因此需要自动版本控制。

*普通文件编辑和对不受*源代码控制的文件的任何更改都不需要您告诉您的 VCS 客户端。

最后，对于单人项目，我更喜欢 git 而不是 SVN，因为 SVN 至少需要 2 个副本：一个存储库（文件和历史的“主”副本）和一个工作副本（你工作的副本） . 使用 git，存储库和工作副本是一回事，这让我的体验更简单。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-29T16:12:39.713

我们使用[SourceGear Vault](http://www.sourcegear.com/vault/)，它与 Visual Studio 有很好的集成，并且对单个用户免费。不过，根据您使用的框架和语言，[Subversion](http://subversion.tigris.org/)是一个很棒的免费解决方案。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-05-29T16:14:25.390

首先，请阅读 Eric Sink 的这些文章。Eric sink 经营着一家公司，该公司创建了一个名为 Vault 的源代码控制系统。他以对新手友好的方式解释了如何进行源代码控制、最佳实践等：

[源代码管理简介](http://www.ericsink.com/scm/source_control.html)

当我第一次想了解源代码控制时，我发现它非常宝贵。

SourceGear Vault 对单个用户免费。它的界面很直观，并与 Visual Studio 很好地集成在一起。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-05-29T16:16:37.153

如果只有您，您可能想尝试 Bazaar。它像 Git 一样分发（因此对于一个人来说会很好——无需处理服务器），但他们的主要目标之一是让它比 Git 更容易使用。

此外，还有一个名为 ToroiseBzr 的方便的 gui 工具，它应该非常容易使用。[http://bazaar-vcs.org/TortoiseBzr](http://bazaar-vcs.org/TortoiseBzr)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-05-29T16:40:46.183

实际上有这样的工具。它被称为[emacs](http://www.gnu.org/software/emacs/manual/html_node/emacs/Distrib.html#Distrib)。

只需为自己创建一个“~/.emacs”文件并将以下行放入其中：

```
(setq kept-new-versions 5)
(setq kept-old-versions 5) 
```

然后重启emacs。

这告诉 emacs 保存该文件的 5 个最旧版本和 5 个最新版本。它们将保存在名为 filename~n~ 的文件中，其中“filename”是您文件的正常名称，“n”是备份编号。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-05-29T18:21:28.863

如果您单独开发项目（不需要服务器进行协作），Mercurial 可能是您的首选系统。我个人很看重它的一个特性：它只使用一个地方来保存它的信息，那就是你项目根目录下的**.hg**目录。它不会将其数据放入每个目录（如 SVN）。这样存档和项目目录很容易管理。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-05-29T17:55:26.233

我使用过 Visual Source Safe、Perforce 和 Subversion。它们都很好，但我不得不说对 Subversion 的支持和扩展似乎稍微好一点。如果您打算进入/留在软件行业，您必须了解源代码控制的基础知识，我强烈建议您设置其中一项源代码控制服务。Subversion 是我的推荐，也是免费的。一开始会很复杂，但您确实应该使用 SVN 客户端添加 GUI 以增加实用程序并减少您观察到的所有复杂性。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-05-29T18:13:10.940

我在“dreamweaver svn”的快速谷歌搜索显示，许多人正在 Dreamweaver 中使用 Subversion。我是版本控制的拥护者，尤其是 SVN，所以我建议你研究一下 :)

如果您不想使用完整的版本控制系统（如上所述），您可以通过改进和自动化您最初描述的过程来改进您的工作。根据您对工具的舒适度，您应该能够在 DreamWeaver 本身或 Windows 脚本（Powershell、VBA、Perl 等）中编写一个脚本，该脚本至少会为您正在工作的文件夹制作以日期命名的副本。经常。这将使您不必这样做，并确保没有任何与错字相关的问题。再往下走，您可以让脚本将您的工作副本放在备份驱动器或远程服务器上，然后您也可以进行备份。

恐怕我对 DreamWeaver 了解不多，但如果它内置了很多脚本支持，您甚至可以“挂钩”到保存/自动保存功能，让它们完全按照您的意愿行事。

希望这有帮助，adricnet

# python - python-memcache 是否使用一致的哈希？

> ID：926814
> 
> 赞同：1
> 
> 时间：2009-05-29T16:07:57.760
> 
> 标签：python, memcached

我正在使用 python-memcache 库，我想知道是否有人知道该客户端是否从 1.44 开始使用一致哈希。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T19:10:33.617

如果您需要类似的东西，您可能会对[hash_ring感兴趣](http://amix.dk/blog/viewEntry/19367)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T17:03:10.183

从快速查看源代码：不，它没有。如果遇到离线/完整服务器，它会使用`server = hash_key % len(servers)`和循环。

# javascript - 如何防止表单从客户端多次提交？

> ID：926816
> 
> 赞同：104
> 
> 时间：2009-05-29T16:08:45.357
> 
> 标签：javascript, submit

有时当响应缓慢时，可能会多次单击提交按钮。

如何防止这种情况发生？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-05-29T16:16:35.423

在表单已经提交后，使用不显眼的 javascript 禁用表单上的提交事件。这是一个使用 jQuery 的示例。

编辑：修复了在不单击提交按钮的情况下提交表单的问题。谢谢，一番。

```
$("body").on("submit", "form", function() {
    $(this).submit(function() {
        return false;
    });
    return true;
}); 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2012-10-17T13:25:08.623

我尝试[了 vanstee 的解决方案](https://stackoverflow.com/a/926863/3536236)以及 asp mvc 3 不显眼的验证，如果客户端验证失败，代码仍然运行，并且表单提交被永久禁用。更正字段后，我无法重新提交。（见bjan的评论）

所以我像这样修改了vanstee的脚本：

```
$("form").submit(function () {
    if ($(this).valid()) {
        $(this).submit(function () {
            return false;
        });
        return true;
    }
    else {
        return false;
    }
}); 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-05-29T22:19:19.943

通过让 onsubmit 处理程序隐藏提交按钮并用加载动画替换它，可以非常优雅地实现客户端表单提交控制。这样，用户在他的动作（点击）发生的同一地点获得即时的视觉反馈。同时，您可以防止再次提交表单。

如果您通过 XHR 提交表单，请记住您还必须处理提交错误，例如超时。您必须再次显示提交按钮，因为用户*需要*重新提交表单。

另一方面，llimllib 提出了一个非常有效的观点。**所有**表单验证都必须发生在服务器端。这包括多次提交检查。**永远不要相信客户！**这不仅是禁用 javascript 的情况。您必须记住，所有客户端代码都可以修改。有点难以想象，但与您的服务器对话的 html/javascript 不一定是您编写的 html/javascript。

正如 llimllib 建议的那样，使用该表单唯一的标识符生成表单并将其放在隐藏的输入字段中。存储该标识符。接收表单数据时，仅在标识符匹配时处理它。（还将标识符链接到用户会话并与之匹配，以提高安全性。）数据处理后删除标识符。

当然，有时，您需要清理从未提交过任何表单数据的标识符。但很可能您的网站已经采用了某种“垃圾收集”机制。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-05-29T16:16:08.980

这是执行此操作的简单方法：

```
<form onsubmit="return checkBeforeSubmit()">
  some input:<input type="text">
  <input type="submit" value="submit" />
</form>

<script type="text/javascript">
  var wasSubmitted = false;    
    function checkBeforeSubmit(){
      if(!wasSubmitted) {
        wasSubmitted = true;
        return wasSubmitted;
      }
      return false;
    }    
</script> 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-05-29T16:10:27.777

```
<form onsubmit="if(submitted) return false; submitted = true; return true"> 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-05-28T13:41:39.333

对这个问题的最简单的回答是：“有时响应速度很慢，可能会多次单击提交按钮。如何防止这种情况发生？”

只需禁用表单提交按钮，如下面的代码。

```
<form ... onsubmit="buttonName.disabled=true; return true;">
  <input type="submit" name="buttonName" value="Submit">
</form> 
```

它将禁用提交按钮，第一次点击提交。此外，如果您有一些验证规则，那么它会正常工作。希望它会有所帮助。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-05-29T16:11:14.767

创建一个唯一标识符（例如，您可以散列当前时间），并使其成为表单上的隐藏输入。在服务器端，检查每个表单提交的唯一标识符；如果您已经收到了该哈希，那么您已经收到了重复提交。用户重新提交的唯一方法是重新加载表单页面。

编辑：依赖javascript不是一个好主意，所以你们都可以继续支持这些想法，但有些用户不会启用它。正确的答案是不信任服务器端的用户输入。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-05-29T16:10:45.250

单击后立即禁用提交按钮。确保正确处理验证。还要为所有处理或数据库操作保留一个中间页面，然后重定向到下一页。这确保刷新第二页不会进行其他处理。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-05-29T16:14:48.573

您还可以显示进度条或微调器以指示表单正在处理。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-05-29T16:16:01.960

使用 JQuery，您可以：

```
$('input:submit').click( function() { this.disabled = true } ); 
```

&

```
 $('input:submit').keypress( function(e) {
     if (e.which == 13) {
        this.disabled = true 
     } 
    }
   ); 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2012-09-29T23:22:14.027

您可以简单地防止多次提交：

```
var Workin = false;

$('form').submit(function()
{
   if(Workin) return false;
   Workin =true;

   // codes here.
   // Once you finish turn the Workin variable into false 
   // to enable the submit event again
   Workin = false;

}); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-05-29T22:32:16.877

我知道您用“javascript”标记了您的问题，但这是一个完全不依赖于 javascript 的解决方案：

这是一个名为**PRG**的 webapp 模式，这里有[一篇很好的文章](http://www.theserverside.com/tt/articles/article.tss?l=RedirectAfterPost)来描述它

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-07-20T11:59:29.977

你可以试试[safeform](https://github.com/caxap/jquery-safeform) jquery 插件。

```
$('#example').safeform({
    timeout: 5000, // disable form on 5 sec. after submit
    submit: function(event) {
        // put here validation and ajax stuff...

        // no need to wait for timeout, re-enable the form ASAP
        $(this).safeform('complete');
        return false;
    }
}) 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-11-13T16:02:14.427

**在客户端**，您应该在使用 javascript 代码提交表单后禁用提交按钮，就像 @vanstee 和 @chaos 提供的方法一样。

但是存在网络延迟或禁用 javascript 的情况的问题，您不应该依赖 JS 来防止这种情况发生。

因此，**在服务器端**，您应该检查来自相同客户端的重复提交，并省略重复提交，这似乎是用户的错误尝试。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-04-11T12:24:21.043

这允许每 2 秒提交一次。在前面验证的情况下。

```
$(document).ready(function() {
    $('form[debounce]').submit(function(e) {
        const submiting = !!$(this).data('submiting');

        if(!submiting) {
            $(this).data('submiting', true);

            setTimeout(() => {
                $(this).data('submiting', false);
            }, 2000);

            return true;
        }

        e.preventDefault();
        return false;
    });
}) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-09-19T09:36:04.873

在您的表单中使用此代码。它将处理多次点击。

```
<script type="text/javascript">
    $(document).ready(function() {
        $("form").submit(function() {
            $(this).submit(function() {
                return false;
            });
            return true;
        });     
    }); 
</script> 
```

它肯定会起作用。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-09-15T12:51:16.007

对我来说最简单和优雅的解决方案：

```
function checkForm(form) // Submit button clicked
{
    form.myButton.disabled = true;
    form.myButton.value = "Please wait...";
    return true;
}

<form method="POST" action="..." onsubmit="return checkForm(this);">
    ...
    <input type="submit" name="myButton" value="Submit">
</form> 
```

[链接更多...](http://www.the-art-of-web.com/javascript/doublesubmit/)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-07-08T08:28:18.620

防止多次提交的最佳方法是在方法中传递按钮 ID。

```
 function DisableButton() {
        document.getElementById("btnPostJob").disabled = true;
    }
    window.onbeforeunload = DisableButton; 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-03-08T07:07:28.267

最简单的解决方案是禁用单击按钮，在操作完成后启用它。要检查 jsfiddle 上的类似解决方案：

```
[click here][1] 
```

您可以在此[答案](https://stackoverflow.com/questions/16715075/preventing-multiple-clicks-on-button/42664936#42664936)上找到其他一些解决方案。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-12-18T14:04:50.363

```
<h3>Form</h3>
<form action='' id='theform' >
<div class='row'>
    <div class="form-group col-md-4">
            <label for="name">Name:</label>
            <input type='text' name='name' class='form-control'/>
    </div>
</div>  
<div class='row'>
    <div class="form-group col-md-4">
            <label for="email">Email:</label>
            <input type='text' name='email' class='form-control'/>
    </div>
</div>  
<div class='row'>
    <div class="form-group col-md-4">
         <input class='btn btn-primary pull-right' type="button" value="Submit" id='btnsubmit' />   
    </div>
</div>
</form>

<script>

    $(function()
    {
      $('#btnsubmit').on('click',function()
      {
        $(this).val('Please wait ...')
          .attr('disabled','disabled');
        $('#theform').submit();
      });

    });

</script> 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-09-08T06:41:10.717

这对我来说很好。它提交农场并禁用按钮，并在 2 秒后激活按钮。

```
<button id="submit" type="submit" onclick="submitLimit()">Yes</button>

function submitLimit() {
var btn = document.getElementById('submit')
setTimeout(function() {
    btn.setAttribute('disabled', 'disabled');
}, 1);

setTimeout(function() {
    btn.removeAttribute('disabled');
}, 2000);} 
```

在 ECMA6 Syntex 中

```
function submitLimit() {
submitBtn = document.getElementById('submit');

setTimeout(() => { submitBtn.setAttribute('disabled', 'disabled') }, 1);

setTimeout(() => { submitBtn.removeAttribute('disabled') }, 4000);} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-11-24T08:42:01.847

只是在不绕过浏览器输入验证的情况下添加可能的答案

```
$( document ).ready(function() {
    $('.btn-submit').on('click', function() {
        if(this.form.checkValidity()) {
            $(this).attr("disabled", "disabled");
            $(this).val("Submitting...");
            this.form.submit();
        }
    });
}); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-07-20T12:12:05.433

使用 javascript 做到这一点有点容易。以下是提供所需功能的代码：

```
$('#disable').on('click', function(){
    $('#disable').attr("disabled", true);
  });
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<button id="disable">Disable Me!</button>
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-05-27T06:38:44.783

之前提出的替代方案是：

```
jQuery('form').submit(function(){
     $(this).find(':submit').attr( 'disabled','disabled' );
     //the rest of your code
}); 
```

# java - java：无法从静态上下文错误中引用非静态变量

> ID：926822
> 
> 赞同：8
> 
> 时间：2009-05-29T16:10:02.910
> 
> 标签：java, jtds

下面的代码在变量上生成一个错误，`con2`说 `"non-static variable con2 cannot be referenced from a static context Error."`我用谷歌搜索了一个解决方案，他们建议该变量尚未初始化以使方法可用。我初始化不正确吗？我也尝试将事情更改为公开，但这也无济于事。

```
import java.io.*;
import java.net.*;

import java.sql.*;
import java.sql.CallableStatement;
import java.sql.ResultSet;
import java.sql.PreparedStatement;
import net.sourceforge.jtds.jdbcx.JtdsDataSource;
import net.sourceforge.jtds.jdbc.Driver;

class testconnect { 

     private java.sql.Connection con2 = null;

     private final String url2 = "jdbc:jtds:sqlserver://";
     private final String serverName= "SQL01";
     private final String portNumber = "2677";
     private final String databaseName= "App";
     private final String userName = "bob";
     private final String password = "boob";
     private final String selectMethod = "cursor";  

     private String getConnectionUrl2(){
        System.out.println("initalizing jtds");
          //String returnVal = url+serverName+":"+portNumber+";databaseName="+databaseName+";user="+userName+";password="+password+";instance="+instance+";";
          String returnVal = url2+serverName+":"+portNumber+"/"+databaseName+";user="+userName+";password="+password;
          System.out.println("url2: " + returnVal);
          return returnVal;
     }

     public static void main (String[] args) { 
         con2 = java.sql.DriverManager.getConnection(getConnectionUrl2());

     } 

} //end class 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-29T16:17:58.387

您可能想在 con2 的声明中添加“静态”。

在 Java 中，事物（变量和方法）可以是类的属性（这意味着它们被该类型的所有对象共享），也可以是对象的属性（同一类的每个对象中的不同属性） ）。关键字“static”用于表示某些东西是类的属性。

“静态”的东西一直存在。其他东西只有在你创建了一个对象之后才存在，即使这样，每个单独的对象也有它自己的副本。在这种情况下，这一点的另一面是关键：静态的东西不能访问非静态的东西，因为它不知道要查看哪个对象。如果你传递一个对象引用，它可以做类似“thingie”的事情.con2”，但不允许简单地说“con2”，因为你还没有说哪个对象的 con2 是指。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-29T16:11:49.883

不，实际上，您必须将 con2 字段声明为静态：

```
private static java.sql.Connection con2 = null; 
```

编辑：更正，实际上这还不够，您会遇到同样的问题，因为您的 getConnection2Url 方法也不是静态的。更好的解决方案可能是进行以下更改：

```
 public static void main (String[] args) { 
     new testconnect().run();
 } 

 public void run() {
     con2 = java.sql.DriverManager.getConnection(getConnectionUrl2());
 } 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-29T16:52:16.687

Java有两种变量

a）
类级别（静态）：
每个类一个。假设您有学生类并将**名称**定义为静态变量。现在无论您创建多少学生对象都将具有相同的名称。

对象级别：
它们属于每个对象。如果名称是非静态的，那么所有学生都可以有不同的名称。

b）
类级别：
此变量在类加载时初始化。因此，即使没有创建学生对象，您仍然可以访问和使用静态名称变量。

对象级别：当你创建一个新对象时，它们将被初始化，比如 new();

C）
您的问题：您的类刚刚加载到 JVM 中，并且您已经调用了它的主要（静态）方法：法律允许。

现在你想调用一个对象变量：对象在哪里？

您必须创建一个对象，然后只有您可以访问对象级别的变量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-29T16:15:39.777

您的 main() 方法是静态的，但它引用了两个非静态成员：con2 和 getConnectionUrl2()。您需要做以下三件事之一：

1) 将 con2 和 getConnectionUrl2() 设为静态。

2) 在 main() 中，创建类 testconnect 的实例并从中访问 c​​on2 和 getConnectionUrl2()。

3) 分出一个不同的类来保存 con2 和 getConnectionUrl2() ，这样 testconnect 里面只有 main 。它仍然需要实例化不同的类并调用方法。

选项#3 是最好的选择。#1 是最糟糕的。

但是，您不能从静态方法中访问非静态成员。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-29T16:37:48.497

最简单的改变是这样的：

```
public static void main (String[] args) throws Exception {
  testconnect obj = new testconnect();
  obj.con2 = DriverManager.getConnection(obj.getConnectionUrl2());
  obj.con2.close();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-05T17:29:38.110

这是一个有趣的问题，我只是想通过添加更多信息来提供另一个角度。如果您了解静态方法的操作方式，您就可以理解为什么会抛出异常。这些方法可以操作静态数据、本地数据或作为参数发送给它的数据。为什么？因为静态方法可以被任何对象从任何地方访问。因此，如果它可以使用实例变量，则可能存在安全问题或信息泄漏。因此编译器必须不考虑这种情况。

# c# - 错误消息的查找结构

> ID：926825
> 
> 赞同：0
> 
> 时间：2009-05-29T16:10:42.817
> 
> 标签：c#, data-structures

我需要将库中的结果字符串转换为异常。每个字符串都有一个数字结果代码，后跟一个管道字符，然后是附加的代码特定数据。我正在考虑使用带有 ResultCode 属性的自定义异常，并存储一个由结果代码键入的消息字符串的查找表，我将在抛出异常之前使用一组消息信息对其进行格式化。存储这个 int-string 值表的好方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:28:11.230

如果你需要存储这些你已经拥有的字符串，你应该使用一个简单的[`Dictionary<int,string>`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)，其中错误代码是键，字符串是值。

如果您自己键入字符串，则应考虑使用资源文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-20T16:52:30.253

在用于决定引发哪个错误的数据从未在单个类之外使用的情况下，最佳方法是[实际对决定进行硬编码](http://thedailywtf.com/articles/soft_coding.aspx)。与系统或框架编程相比，这就是应用程序编程的全部内容。我遭受了足够的自恋，没有想象自己是完美业务编程框架的神圣提供者，以至于我认识到有时，我的代码只会在我开发它的一个地方使用。

因此，我为这个问题开发了两个候选解决方案： 1\. 建议的字符串（代码）字典作为各种异常类型的键，在构造函数中初始化；或 2\. 一个中等大小的“switch”语句，与上面的构造函数具有相同的硬编码。

在很可能在应用程序的生命周期内保持单次使用的单次使用场景中，以上任何一种都不仅仅是可接受的解决方案；它是一种具有成本效益、基于 YAGNI 的解决方案，让我能够将更多的精力投入到实际需要关注的问题上。

# pdf - 如何将 FormCalc 设置为最近的一刻钟？

> ID：926829
> 
> 赞同：1
> 
> 时间：2009-05-29T16:11:07.450
> 
> 标签：pdf, adobe, acrobat, livecycle, adobe-reader

我有这个有四个“In”和四个“Out”列的时间表，并计算了两周工资期内的工作时间。右侧有一列计算当天的工作时间（见下面的脚本）。我需要它四舍五入到最近的一刻钟，即

如果员工在以下时间到达或离开：

```
小时后的“:00”到“:07”分钟，从整点开始计算
":08" 到 ":22" 小时后的分钟，从小时后的一刻钟开始计算
小时后的“:23”到“:37”分钟，从半小时开始计算
小时后的“:38”到“:52”分钟，从整点四分之三开始计算
整点后的“:53”到“:60”分钟，从整点开始计算

```

例子：

```
员工记录他们在上午 8:07 到达的时间 从 8:00 开始计算
员工记录他们在上午 8 点 08 分到达的时间 从 8 点 15 分开始计算
员工记录他们在上午 8 点 22 分到达 从 8 点 30 分开始计算
员工记录他们在上午 8 点 37 分到达的时间 从 8 点 45 分开始计算
员工记录他们在上午 8:53 到达的时间 从 9:00 开始计算

```

“工作时间”列中的脚本

```
// compute block 0
var StartInterval = 0
if(HasValue(OUTA1[0]) and HasValue(INA1[0])) then
StartInterval = Time2Num(OUTA1[0].formattedValue, "HH:MM") - Time2Num(INA1[0].formattedValue, "HH:MM")
endif

// compute block 1
var LunchInterval = 0
if(HasValue(OUTA1[1]) and HasValue(INA1[1])) then
LunchInterval = Time2Num(OUTA1[1].formattedValue, "HH:MM") - Time2Num(INA1[1].formattedValue, "HH:MM")
endif

// compute block 2
var EndInterval = 0
if(HasValue(OUTA1[2]) and HasValue(INA1[2])) then
EndInterval = Time2Num(OUTA1[2].formattedValue, "HH:MM") - Time2Num(INA1[2].formattedValue, "HH:MM")
endif

// compute total time in hours from the millisecond value
Round(Sum(StartInterval, LunchInterval, EndInterval) / 3600000,2) 
```

# oop - 面向对象的 TCL

> ID：926834
> 
> 赞同：2
> 
> 时间：2009-05-29T16:11:31.817
> 
> 标签：oop, tcl

TCL 中哪个面向对象系统被认为是标准？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T17:35:18.333

包含在 Tcl 中的对象系统实际上是一个 oo 框架。虽然可以直接使用它，但它的目标是成为可以在其上构建其他 OO 系统的框架。Nathan 提供的链接中提到了可能最广为人知的 Tcl 的三个对象系统（itcl、xotcl、snit）。

我用过itcl，如果你习惯了C/C++/Java/etc，它很容易使用。

我发现 XOTcl 使用起来有点烦人，但很多人喜欢它的强大功能，所以请谨慎对待。

Snit 是一个纯 tcl OO 系统（包含在 tcllib 中，因此很容易获得并包含在包含 dist 的任何电池中）

简短摘要： 本身没有标准。如果您想要的东西无论您走到哪里都可以安装，那么 Snit 可能是最佳选择。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-02T20:16:25.240

Tcl 8.6 带有内置的 TclOO（它衍生自相当多的其他 OO 系统）和一个版本的 [incr Tcl] 作为贡献的扩展包。虽然我预计人们最终会迁移到 TclOO 来满足他们的大部分需求，但 Tcl 程序员作为一个群体往往不喜欢对工作系统进行过多的修补，因此通常不会那么快地采用新特性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T20:02:18.253

查看[Tcl Wiki](http://wiki.tcl.tk/970)以获取 Tcl 的 OO 系统的完整列表。看起来人们投票赞成将[Incr Tcl](http://www.tcl.tk/cgi-bin/tct/tip/50)合并到 Tcl 核心中，这告诉我 Incr Tcl 非常接近标准。虽然核心中的 oo 系统是基于其他 oo 语言的，但我相信命名空间系统是从 Incr Tcl 派生的。

[http://www.tcl.tk/cgi-bin/tct/tip/50](http://www.tcl.tk/cgi-bin/tct/tip/50)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T17:02:02.633

Tcl 似乎还没有一个单一的对象系统作为标准脱颖而出**，**但 XOTcl 和 Snit 非常接近；在 8.6 版中添加到核心的对象系统是基于它们的（参见[此处](http://www.tcl.tk/about/oo.html)）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-26T10:39:00.280

Tcl8.6 内部有 TclOO 包。iTcl 对此有一个新的实现。TclOO 为 iTcl 等其他包提供了 OO 架构/机制，它不应该直接在您的代码中使用。

# .net - asp.net 中的日期差异

> ID：926839
> 
> 赞同：1
> 
> 时间：2009-05-29T16:12:43.113
> 
> 标签：.net, datetime

谁能告诉我如何在不使用 .net datetime 和 timestamp 类的情况下计算两个日期之间的差异？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T16:21:15.690

如果我不能使用内置类型，我会尝试寻找另一个 .NET 日期/时间 API。我怀疑我不会找到一个，因为任何理智的人都会使用内置的。

如果它*真的*只是一个日期的情况，我想一个完整的日期/时间 API 并不是真正需要的。解析你进入“自某个时代以来的日子”（例如 1970 年 1 月 1 日）的任何内容，然后进行正常的减法。

不过要小心闰年——如果你需要应对几个世纪前奇怪的日历变化，事情会变得更加有趣。

假设格式为“yyyyMMdd”的示例代码，不做任何错误检查，不处理 1900 年之前的日期，根本不担心效率：

```
using System;

struct Date
{
    readonly int year;
    readonly int month;
    readonly int day;

    public Date(int year, int month, int day)
    {
        this.year = year;
        this.month = month;
        this.day = day;
    }

    public static Date Parse(string text)
    {
        return new Date(int.Parse(text.Substring(0, 4)),
                        int.Parse(text.Substring(4, 2)),
                        int.Parse(text.Substring(6, 2)));
    }

    // Days since first Jan 1st 1900
    public int DaysSinceEpoch
    {
        get
        {
            int days = 0;
            for (int i = 1900; i < year; i++)
            {
                days += IsLeapYear(i) ? 366 : 365;
            }
            for (int i = 1; i < month; i++)
            {
                days += GetMonthLength(i, year);
            }
            days += day - 1;
            return days;
        }
    }

    private static readonly int[] MonthLengths = 
    { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};

    private static int GetMonthLength(int month, int year)
    {
        return MonthLengths[month-1] + 
            ((IsLeapYear(year) && month == 2) ? 1 : 0);
    }

    private static bool IsLeapYear(int year)
    {
        // http://en.wikipedia.org/wiki/Leap_year
        if ((year % 4) != 0) return false;
        if ((year % 400) == 0) return true;
        if ((year % 100) == 0) return false;
        return true;
    }
}

class Test
{
    static void Main(string[] args)
    {
        Console.WriteLine(DateDiff("19040301", "19050301")); // 365
        Console.WriteLine(DateDiff("19040201", "19050201")); // 366
        Console.WriteLine(DateDiff("19760619", "20090529")); // I feel old
    }

    static int DateDiff(string first, string second)
    {
        Date firstDate = Date.Parse(first);
        Date secondDate = Date.Parse(second);
        return secondDate.DaysSinceEpoch - firstDate.DaysSinceEpoch;
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T16:15:53.973

如果你不能使用 DateTime，你有什么？字符串？在这种情况下，请使用 DateTime.Parse() 变体^*或 Convert.ToDateTime() 之一并在那里进行比较。这是唯一正确的方法。还有什么，我们需要更多信息。

`* DateTime.Parse(), DateTime.TryParse(), DateTime.ParseExact(), or DateTime.TryParseExact().`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T16:19:46.500

根据评论，我选择将日期时间存储为自 1901 年 1 月 1 日以来的时钟周期数。现在，只需从另一个中减去一个，除以每秒的时钟周期，然后再除以适合您要测量的时间单位的系数（60 分钟，3600 小时，3600 * 24 天等）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T16:26:21.073

我敢打赌，面试您的人是 VB 开发人员，并希望您使用内置的 VB datediff 函数 (Microsoft.VisualBasic.DateAndTime.DateDiff) 来回答。我不是 100%，但我相信该函数对字符串或对象日期参数有重载。

# windows-ce - Windows CE 的 kbhit 等价物是什么？

> ID：926844
> 
> 赞同：2
> 
> 时间：2009-05-29T16:13:36.263
> 
> 标签：windows-ce

Windows CE 的 kbhit 等价物是什么？特别是，我想知道 Windows CE 6.0。我想更一般地说，有没有办法从标准输入进行非阻塞读取？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-29T16:49:53.053

您需要在 Windows CE 中处理 WM_KEYDOWN 消息。[在这里](http://msdn.microsoft.com/en-us/library/ms910665.aspx)查看有关如何执行此操作的一些详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-11T22:37:41.423

如果您所做的只是寻找密钥，则可以使用[GetKeyState](http://msdn.microsoft.com/en-us/library/aa932743.aspx)或[GetAsyncKeySytate](http://msdn.microsoft.com/en-us/library/aa929803.aspx)进行轮询。

# delphi - 如何在 Delphi 中将常量字符串组合在一起

> ID：926845
> 
> 赞同：11
> 
> 时间：2009-05-29T16:13:42.660
> 
> 标签：delphi

我的应用程序使用字符串表示项目在其生命周期中可能处于的不同状态。

IE

打开、激活、关闭、删除、

等等，目前它们都被硬编码成这样的代码

```
MyVar := 'OPEN'; 
```

我正在努力改变它，因为它可能是一个维护问题，所以我想将它们全部更改为常量，我打算这样做

```
MyVar := STATUS_OPEN; 
```

但我想将它们组合成一个数据结构，就像这样

```
MyVar := TStatus.Open; 
```

在 delphi 2007 中执行此操作的最佳方法是什么？

我知道我可以为此进行记录，但是如何使用值填充它，以便系统中的所有对象都可以使用它，而不必每次都创建变量并填充值？

理想我希望为数据结构和值提供一个中心位置，并让它们易于访问（如 TStatus.Open），而不必在每次使用时将其分配给变量或创建对象。

我确信有一个我只是缺少的简单解决方案。有任何想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-29T16:23:44.973

正如 Jim 提到的，您可以使用类常量或枚举类型：

```
type
  TItemStatus = (isOpen, isActive, isClosed);
const
  ItemStatusStrings: array[TItemStatus] of string = ('Open', 'Active', 'Closed'); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-29T16:22:26.377

请参阅[http://edn.embarcadero.com/article/34324](http://edn.embarcadero.com/article/34324)（“自 Delphi 7 以来的新 Delphi 语言功能”。

一个类常量会很好。从上面的链接：

```
type
    TClassWithConstant = class
      public 
        const SomeConst = 'This is a class constant';
    end;

 procedure TForm1.FormCreate(Sender: TObject);
 begin
   ShowMessage(TClassWithConstant.SomeConst);
 end; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-30T02:19:54.747

我个人在几个大型任务关键数据处理平台中广泛使用了 TOndrej 的方法。枚举的好处是它们可以很容易地在应用程序中传递，非常紧凑（序数类型），在 case 语句中完美地工作并且是完全类型安全的。后一点对于维护很重要，因为删除或更改枚举值会导致编译错误（恕我直言）。

使用这种方法需要注意一些问题：

*   更改枚举值的声明顺序将阻止 enum->string 查找数组。

*   如果您在 case 语句中使用枚举（一个不错的功能），请务必考虑添加的新值。我通常会在案例中添加一个 else 并在未知值上抛出异常。比从箱子里掉下来要好得多。

如果您非常关心第一个问题，您可以使用查找数组中的一条记录，并在每条记录中包含枚举值，并从单元初始化开始验证排序。这在维护频繁的关键任务系统中多次保存了我的培根。这种方法也可以用来为每个值添加额外的元数据（一个非常方便的特性）。

祝你好运！

```
unit Unit1;

interface

type
  TItemStatusEnum = (isOpen, isActive, isClosed);

  TItemStatusConst = class
    class function EnumToString(EnumValue : TItemStatusEnum): string;
    property OPEN: string index isOpen read EnumToString;
    property CLOSED: string index isClosed read EnumToString;
    property ACTIVE: string index isActive read EnumToString;
  end;

var
  ItemStatusConst : TItemStatusConst;

implementation

uses
  SysUtils;

type
  TItemStatusRec = record
    Enum  : TItemStatusEnum;
    Value : string;
  end;

const
  ITEM_STATUS_LOOKUP : array[TItemStatusEnum] of TItemStatusRec =
    ((Enum: isOpen;   Value: 'OPEN'),
     (Enum: isActive; Value: 'ACTIVE'),
     (Enum: isClosed; Value: 'CLOSED'));

procedure ValidateStatusLookupOrder;
  var
    Status : TItemStatusEnum;
  begin
    for Status := low(Status) to high(Status) do
      if (ITEM_STATUS_LOOKUP[Status].Enum <> Status) then
        raise Exception.Create('ITEM_STATUS_LOOKUP values out of order!');
  end;

class function TItemStatusConst.EnumToString(EnumValue: TItemStatusEnum): string;
  begin
    Result := ITEM_STATUS_LOOKUP[EnumValue].Value;
  end;

initialization
  ValidateStatusLookupOrder;
end. 
```

更新：

感谢您的批评-您是绝对正确的，因为我正在解决我*认为*是问题背后的问题。如果您可以忍受只能在 Delphi 2007 或更高版本中工作（可能在 D2006 中工作？）的约束，下面是一个*更简单的方法。*很难摆脱那些向后兼容的唠叨想法；）

```
type
  ItemStatusConst = record
    const OPEN   = 'OPEN';
    const ACTIVE = 'ACTIVE';
    const CLOSED = 'CLOSED';
  end; 
```

这种方法很简单，并且感觉类似于在 Java 或 .Net 应用程序中所做的事情。使用语义符合预期，将与代码完成一起使用。一个很大的优点是常量的范围是记录级别，因此不会像单元范围类型那样与其他定义发生冲突。

```
Sample usage:

    ShowMessage(ItemStatusConst.ACTIVE);
    ShowMessage(ItemStatusConst.CLOSED); 
```

只是为了好玩，我还修改了我之前的方法，以直接解决原始问题并获得类似的结果。这次我使用了带有属性索引器的“模拟类属性”（参见[此处）。](http://delphi.about.com/library/weekly/aa031505a.htm)这显然比记录方法更复杂，但保留了使用枚举值、集合、字符串的能力，并且还可以在需要时扩展以实现其他元数据功能。我相信这适用于可以追溯到 Delphi 5 IIRC 的 Delphi 版本。

我在 Delphi 中创建了一个解析框架来处理*完整的* [IBM AFPDS](http://publib.boulder.ibm.com/infocenter/printer/v1r1/index.jsp?topic=/com.ibm.printers.afpproducts/com.ibm.printers.ppfaug/ib6p8mst26.htm)打印数据流语法，这就是我使用这种技术取得巨大效果的一个例子。这种灵活性是我喜欢在德尔福工作的原因——它就像一把瑞士军刀；）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-29T18:11:11.147

或者你可以结合[@Jim](https://stackoverflow.com/questions/926845/how-to-group-constant-strings-together-in-delphi/926888#926888)和[@TOndrej](https://stackoverflow.com/questions/926845/how-to-group-constant-strings-together-in-delphi/926891#926891)

```
TGlobalConsts = class
type
  TItemStatus = (isOpen, isActive, isClosed);
const
  ItemStatusStrings: array[TItemStatus] of string = ('Open', 'Active', 'Closed');
end; 
```

虽然你真的可以让它成为一**堂课**或一个**记录**。虽然如果它是一个**类**，您可以添加 @mghie 建议的类**函数**[，](https://stackoverflow.com/questions/926845/how-to-group-constant-strings-together-in-delphi/926940#926940)而只需从**const array**获取值。就我个人而言，我更喜欢将所有字符串放在**接口中的****const 数组**中，而不是在**实现中的****函数**体中添加。

 ******```
class function TGlobalConsts.Active: string;
begin
  Result := ItemStatusStrings[itsActive];
end;

class function TGlobalConsts.Open: string;
begin
  Result := ItemStatusStrings[itsOpen];
end; 
```

有很多方法可以做到这一点，这是肯定的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-29T16:34:57.317

这是您可以在所有版本的 Delphi 中执行的操作：

```
type
  TStatus = class
    class function Active: string;
    class function Open: string;
    ...
  end;

  class function TStatus.Active: string;
  begin
    Result := 'ACTIVE';
  end;

  class function TStatus.Open: string;
  begin
    Result := 'OPEN';
  end; 
```

您可以根据需要完全使用它：

```
MyVar := TStatus.Open; 
```

只有一个地方可以更改字符串，并且只涉及代码，没有运行时实例化。最近的 Delphi 版本的新功能并不总是需要做这样的事情......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-30T09:50:17.627

除了 TOndrej 所说的：

也可以声明一个记录常量：

```
type
  TRecordName = record
    Field1: Integer;
    Field2: String
  end;

const
  itemstatus : TRecordName = (
    Field1: 0;
    Field2: 'valueoffield2'
  ); 
```

`const`通过结合上面的记录语法和 TOndrej 显示的数组语法，记录数组也是可能的。

但是，我通常喜欢的方式需要初始化：

*   `TStringDynArray`通过 RTTI 用枚举的名称填充 a
*   如果事实证明名称应该是可配置的，则持久性（无论其排列方式如何）可以简单地加载/存储 dynarray。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-29T16:21:58.187

你可以有一个记录类型的全局变量。记录类型必须为您拥有的每个状态提供一个字段。

***您可以在任何单元的Initialize***部分填充记录，调用在该单元中声明的过程或函数。你可以有一个单独的单元来专门完成这项工作，比如 StatusTypes.pas。

在接口部分，您可以声明如下内容：

```
type 
  TStatus = record
    OPEN: string;
  end;

var
  Status: TStatus; 
```

# algorithm - 什么是获得树的最小顶点覆盖的好算法？

> ID：926847
> 
> 赞同：20
> 
> 时间：2009-05-29T16:13:49.743
> 
> 标签：algorithm, tree, dynamic-programming

什么是获得树的最小顶点覆盖的好算法？

### 输入：

节点的邻居。

### 输出：

最小顶点数。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-11-13T23:34:13.430

看了这里的答案后我并没有完全理解，所以我想我会从[这里发布一个](http://courses.csail.mit.edu/6.006/spring11/lectures/lec21.pdf)

一般的想法是，您将树的根放在任意节点上，并询问该根是否在封面中。如果是，则通过递归计算以其子树为根的子树的最小顶点覆盖。如果不是，那么根的每个孩子都必须在顶点覆盖中，这样根和它的孩子之间的每条边都被覆盖。在这种情况下，您对根的孙子进行递归。

例如，如果您有以下树：

```
 A
   / \
  B   C
 / \ / \
D  E F  G 
```

请注意，通过检查，您知道最小顶点覆盖是`{B, C}`。我们会找到这个最小封面。

在这里，我们从`A`.

## A在封面

我们向下移动到 和 的两个子树，`B`并`C`递归该算法。我们不能简单地声明`B`并且`C`不在封面中，因为即使`AB`和`AC`被覆盖，我们也不能说我们是否需要`B`以及是否`C`在封面中。

（想想下面的树，它的根和它的一个孩子都在最小覆盖（`{A, D}`）

```
 A
 /|\___
B C    D
      /|\
     E F G 
```

)

## A不在封面

但是我们知道这一点`AB`并且`AC`必须被覆盖，所以我们必须在封面上添加`B`和。`C`由于`B`and`C`在封面中，我们可以递归他们的孩子而不是递归`B`and `C`（即使我们这样做了，它也不会给我们更多信息）。

## “正式”

设`C(x)`为根于 的最小覆盖的大小`x`。

然后，

```
C(x) = min ( 
            1 + sum ( C(i) for i in x's children ),                    // root in cover
            len(x's children) + sum( C(i) for i in x's grandchildren)  // root not in cover
            ) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-01T14:17:46.687

T(V,E) 是一棵树，这意味着对于任何叶子，任何最小顶点覆盖都必须包括叶子或与叶子相邻的顶点。这为我们提供了以下算法来找到 S，即顶点覆盖：

1.  在树中找到树的所有叶子（BFS 或 DFS），O(|V|)。
2.  如果 (u,v) 是一条边，使得 v 是叶子，则将 u 添加到顶点覆盖，并修剪 (u,v)。这将为您留下一个森林 T_1(V_1,E_1),...,T_n(U_n,V_n)。
3.  现在，如果 V_i={v}，意味着 |V_i|=1，则可以删除该树，因为所有与 v 相关的边都被覆盖了。这意味着我们有一个递归的终止条件，我们有一个或没有顶点，我们可以计算*S_i*作为每个*T_i*的覆盖，并将 S 定义为步骤 2 中的所有顶点联合每个*T_i*的覆盖。

现在，剩下的就是验证如果原始树只有一个顶点，我们返回 1 并且永远不会开始递归，并且可以计算最小顶点覆盖。

**编辑：**

其实想了想，用一个简单的DFS变种就可以完成。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-29T17:09:10.253

我希望[在这里](http://books.google.co.il/books?id=NSfIWxqPlbcC&pg=PA337&lpg=PA337&dq=tree+vertex+cover&source=bl&ots=xZog0E6LaL&sig=QluBgt6OcdY0UDh2qPQiA68CCO0&hl=en&ei=axYgSp2VHcuvsgbEpti5Bg&sa=X&oi=book_result&ct=result&resnum=1)您可以找到与您的问题相关的更多答案。

* * *

我在考虑我的解决方案，可能您需要完善它，但只要动态编程在您的标签之一中，您可能需要：

1.  对于每个 u 顶点，定义 S+(u) 是具有顶点 u 的覆盖大​​小，而 S-(u) 是不具有顶点 u 的覆盖。
2.  对于 u 的每个子 v，S+(u)= 1 + Sum(S-(v))。
3.  对于 u 的每个子 v，S-(u)=Sum(max{S-(v),S+(v)})。
4.  答案是 max(S+(r), S-(r)) 其中 r 是树的根。

* * *

看完[这篇](http://en.wikipedia.org/wiki/Maximum_independent_set)。更改了上述算法以找到最大独立集，因为在 wiki 文章中声明

> 一个集合是独立的当且仅当它的补集是一个顶点覆盖。

因此，通过将 min 更改为 max，我们可以找到最大独立集并通过补充最小顶点覆盖，因为这两个问题是等价的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-30T17:17:13.443

```
{- Haskell implementation of Artem's algorithm -}

data Tree = Branch [Tree]
    deriving Show

{- first int is the min cover; second int is the min cover that includes the root -}
minVC :: Tree -> (Int, Int)
minVC (Branch subtrees) = let
    costs = map minVC subtrees
    minWithRoot = 1 + sum (map fst costs) in
    (min minWithRoot (sum (map snd costs)), minWithRoot) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-05-18T06:21:15.227

我们可以使用基于 DFS 的算法来解决这个问题：

```
DFS(node x)
{

    discovered[x] = true;

    /* Scan the Adjacency list for the node x*/
    while((y = getNextAdj() != NULL)
    {

        if(discovered[y] == false)
        {

            DFS(y);

           /* y is the child of node x*/
           /* If child is not selected as a vertex for minimum selected cover
            then select the parent */ 
           if(y->isSelected == false)
           {
               x->isSelected = true;
           }
        }
   }
} 
```

永远不会为顶点覆盖选择叶节点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-07-14T10:27:46.077

我们需要为必须选择的每个节点找到最小的顶点覆盖，要么包含它，要么不包含它。但是根据每条边（u，v）的问题，'u'或'v'中的任何一个都应该在封面中，所以我们需要注意如果当前顶点不包括在内，那么我们应该包括它的孩子，并且如果我们包含当前顶点，那么我们可能会也可能不会根据最佳解决方案包含其子节点。

在这里，任何顶点 v 的 DP1[v] = 当我们包含它时。DP2[v] 对于任何顶点 v = 当我们不包含它时。

DP1[v] = 1 + sum(min(DP2[c], DP1[c])) - 这意味着包括当前并且可能包括也可能不包括其子级，具体取决于最佳情况。

DP2[v] = sum(DP1[c]) - 这意味着不包括当前，那么我们需要包括当前顶点的孩子。这里，c 是顶点 v 的子节点。

然后，我们的解决方案是 min(DP1[root], DP2[root])

```
#include <bits/stdc++.h>
using namespace std;

vector<vector<int> > g;

int dp1[100010], dp2[100010];

void dfs(int curr, int p){
    for(auto it : g[curr]){
        if(it == p){
            continue;
        }
        dfs(it, curr);
        dp1[curr] += min(dp1[it], dp2[it]);
        dp2[curr] += dp1[it];
    }
    dp1[curr] += 1;
}

int main(){
    int n;
    cin >> n;
    g.resize(n+1);
    for(int i=0 ; i<n-1 ; i++){
        int u, v;
        cin >> u >> v;
        g[u].push_back(v);
        g[v].push_back(u);
    }
    dfs(1, 0);
    cout << min(dp1[1], dp2[1]);
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-17T10:56:27.023

我会简单地使用线性程序来解决最小顶点覆盖问题。作为整数线性程序的公式可能看起来像这里给出的公式：[ILP公式](http://en.wikipedia.org/wiki/Vertex_cover#ILP_formulation)

我认为您自己的实现不会比这些高度优化的 LP 求解器更快。

# iphone - UIScrollView - 添加/删除标签

> ID：926851
> 
> 赞同：0
> 
> 时间：2009-05-29T16:14:49.883
> 
> 标签：iphone, cocoa-touch, uiscrollview, uilabel

我正在尝试将 UILabel 添加/删除到 ScrollView。添加进行得很好，但在添加新标签之前，我似乎无法删除标签。任何人都可以对这种情况有所了解吗？

```
-(void)setMessage:(MessageData *)m{

    //Attempting to remove any previous labels

    iPhone_PNPAppDelegate *mainDelegate = (iPhone_PNPAppDelegate *)[[UIApplication sharedApplication] delegate];
    UILabel *l;
    for (NSInteger i=0; i<[[scrollView subviews] count]; i++){
        l=[[scrollView subviews] objectAtIndex:0];
        [l removeFromSuperview];
        l=nil;
    }

    //Adding my new Labels

    CGPoint pt=CGPointMake(5,5);
    if ([[[mainDelegate messageFieldCaptions] objectAtIndex:0] length]>0){
        NSArray *p=[[[mainDelegate messageFieldCaptions] objectAtIndex:0] componentsSeparatedByString:@"|"];
        l= [self newLabelWithPrimaryColor:[mainDelegate navColor] selectedColor:[UIColor whiteColor] fontSize:12.0 bold:YES];
        if (m.sValue0.length>0) 
            l.text=[NSString stringWithFormat:@"%@ %@",[p objectAtIndex:0], m.sValue0];
        else
            l.text=[NSString stringWithFormat:@"%@ None",[p objectAtIndex:0]];

        [l setFrame:CGRectMake(pt.x,pt.y,310,20)];
        [scrollView addSubview:l];
        [l release];
        pt.y+=20;       
    }

    //This is done about 10 more times to add new labels.

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T16:26:36.830

问题出在你的 for 循环中。当您删除标签时，[[scrollView subviews] count] 会减少，这意味着您不会获得所有标签，因为循环运行的次数少于标签的运行次数。

假设您有 5 个标签：

```
（比较时）
我 | [[scrollView 子视图] 计数]
==================================
0 | 5
1 | 4
2 | 3 <-- 循环在这里结束，因为 i+1 >= [[scrollView subviews] count]
3 | 2

```

您应该将初始计数保存到变量中并在 for 循环条件中使用它。由于您总是删除索引 0，因此您不必担心超出数组范围。

# windows-ce - Windows CE 上的 isatty

> ID：926865
> 
> 赞同：2
> 
> 时间：2009-05-29T16:16:44.270
> 
> 标签：windows-ce

`isatty()`Windows CE 上是否有等价物？换句话说，有没有办法在代码中检测 stdin/stdout/stderr 是否已被重定向？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T19:36:42.330

您可以调用 GetStdIoPath （它在 coredll.dll 中 - 它在 MSDN 中没有记录，我不确定它是否在任何 SDK 标头中，但您始终可以手动将其声明为 extern 并且链接器会找到它）。

这是我的 C# 版本 - 如果需要，您可以轻松地将其移植回 C：

```
[DllImport("coredll.dll", SetLastError = true)]
public static extern int GetStdioPath(StdIoStream id, StringBuilder pwszBuf, int lpdwLength);

public enum StdIoStream
{
    Input = 0,
    Output = 1,
    ErrorOutput = 2
} 
```

# jquery - jQuery US Currency 验证正则表达式也允许整数

> ID：926866
> 
> 赞同：10
> 
> 时间：2009-05-29T16:16:54.503
> 
> 标签：jquery, regex, validation

我有这个正则表达式，但现在也需要允许没有小数点的数字

```
// Validate for 2 decimal for money
jQuery.validator.addMethod("decimalTwo", function(value, element) {
    return this.optional(element) || /^(\d{1,3})(\.\d{2})$/.test(value);
}, "Must be in US currency format 0.99"); 
```

目前，这迫使用户至少将 .00 添加到数字中，希望它允许当前的正则表达式和不带小数的整数。

我要添加吗？在 RegEx 的后半部分结束时？

```
// Validate for 2 decimal for money
jQuery.validator.addMethod("decimalTwo", function(value, element) {
    return this.optional(element) || /^(\d{1,3})(\.\d{2})?$/.test(value);
}, "Must be in US currency format 0.99"); 
```

编辑：

好的，但是如果有人进入 1.2 怎么办？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-29T16:49:15.347

如果您想要 1、1.2 和 1.20 全部工作：

```
/^(\d{1,3})(\.\d{1,2})?$/ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T16:20:04.380

是的，只需添加一个 ? 到第二组的末尾以使其可选。那应该很好用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-30T21:05:49.013

```
$.validator.addMethod("money", function (value, element) {
     if ($("#<%= rdOtherAmt.ClientID %> input:checked")) {
         return this.optional(element) || /^((\d{1,5})+\.\d{2})?$|^\$?[\.]([\d][\d]?)$/.test(value);
     }                 
}); 
```

这将完美地工作，需要两位小数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-06T20:53:59.650

这是我们用于正则表达式货币输入的最佳整体答案，包含我们需要的所有内容：/(?=.)^\$?(([1-9][0-9]{0,2}(, [0-9]{3})*)|[0-9]+)?(.[0-9]{1,2})?$/

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-24T15:26:37.483

我想测试keyup。因此，我需要接受 999,999。在输入第一个小数位（十分位）之前。但是，我仍然想在 2 个小数点（百分之一）位置上达到最大值 - 假设在我的代码中输入 999.1 == 999.10。

```
var currencywithcommas = /^(\d+|\d{1,3}(,\d{3})*)+(\.\d{2})?$/;
if ($("#yourelement").val().match(currencywithcommas)) {
  // positive match code
} 
```

更新：由于实施，我最终使用了 jQuery Validation Plugin。

原型代码：

```
jQuery.validator.addMethod("currencywithcommas", function (value, element) {
    var currencywithcommasReg = /^(\d+|\d{1,3}(,\d{3})*)+(\.\d{2})?$/;
    return this.optional(element) || value.match(currencywithcommasReg);
}, "Must be in US currency format 9.99"); 
```

执行：

```
 $("#form1").validate({
        rules: {
            amount1: {
                required: true,
                currencywithcommas: true
            },
... 
```

相同的概念，但扩展为使用验证功能。

```
$(".reqField1").each(function () {
    $(this).keyup(function () {
        $("#submitButton").prop("disabled", CheckInputs(".reqField1"));
    });
});

function CheckInputs(reqfldclass) {
    var valid = false;
    $(".reqField1").each(function () {
        if (valid) { return valid; }
        var input = $.trim($(this).val());
        valid = !input;
    });
    return valid;
} 
```

而且，鲍勃是你的叔叔...

# svn - 当我使用 VisualSVN 提交 svn 时，为什么授权失败？

> ID：926873
> 
> 赞同：0
> 
> 时间：2009-05-29T16:18:54.067
> 
> 标签：svn

我已经设置了 svnserve，现在我正在测试一个没有凭据的存储库，所以在 svnserve.config 我有

```
[general]
# anon-access = write
### auth-access = write

# use-sasl = false 
```

并重启了服务

我已经使用 VisualSVN 和 svn://server/repos 在单独的机器上成功获得了一个项目的工作副本，但是当我使用 VisualSVN 提交时，我获得授权失败

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T16:25:03.820

取消注释该`anon-access = write`行；默认为只读。

# c# - FXCop：“拥有一次性字段的类型应该是一次性的”

> ID：926883
> 
> 赞同：1
> 
> 时间：2009-05-29T16:20:58.387
> 
> 标签：c#, fxcop

我开始对我的一些程序集使用 FXCop，并注意到一些有趣的东西，我正试图绕开我的脑袋。

> “声明一次性成员的类型也应该实现 IDisposable。如果该类型不拥有任何非托管资源，请不要在其上实现终结器。”

我有自己的类，其中包含一些控件，这些控件又继承自 System.Web.UI.WebControls.Button。它不是抱怨我继承的按钮，而是包装它们的类。

这里有什么影响或危险？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T16:24:59.200

如果您的类包含 IDisposable 类型，但您的类不是 IDisposable，那么当不再需要您的类的实例时，您的类中的 IDisposable 类型可能没有按时释放/释放。Dispoble 类型应该在您不再需要它们时立即释放，以便释放资源。如果你不这样做，你将不得不等到 GC 启动，然后资源也将被释放。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T16:26:38.327

如您所知，当您使用完一次性对象时，您应该调用它的`Dispose`方法。

当您从这些控件继承时，仍然可以调用该`Dispose`方法。但是如果你制作了一个包装器，那么你的包装器类的用户应该能够调用`Dispose`.

```
public void Dispose() {
    button.Dispose();
    // any other thing that is disposable
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T17:10:35.943

包含按钮的类的性质是什么？

通常，我只希望作为复合控件的类具有其他控件作为成员。这样的类通常会直接或间接地从 System.Web.UI.CompositeControl 或 System.Web.UI.WebControl 继承，并且您作为成员拥有的控件应添加到 Controls 集合中。

这样做将确保它们被正确处理，并且应该摆脱 FxCop 警告。

如果这没有帮助，请发布有关课程的更多详细信息。

# ms-access - 检测 Microsoft Access 数据库表的最后更改时间

> ID：926897
> 
> 赞同：1
> 
> 时间：2009-05-29T16:25:28.780
> 
> 标签：ms-access, oledb, ado

有谁知道一种方法来检测 Microsoft Access 表上次更改（插入或更新）的时间？我们通过 ADO COM 使用 OLEDB 以编程方式与访问数据库进行通信，并正在寻找一种检测特定表更改的方法。我们不需要知道这些变化是什么，只需要知道这些变化已经发生了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T16:30:46.957

检测表中的数据是否已更改的唯一方法是对表执行查询。

您必须在表中添加一个类型列，`DATETIME`例如命名`LastUpdatedDate`的，表示每行的最后更新日期/时间。这样做，`NOT NULL`以便您必须`DATETIME`为每个`INSERT`或写入该列的更新值`UPDATE`。此外，将该列设置`DATE()`为当前日期戳或`NOW()`当前日期/时间戳的默认值。然后添加一个验证规则或`CHECK`约束，例如`CHECK (LastUpdatedDate = NOW())`确保列在每个`UPDATE`and上实际更新`INSERT`。

最后，运行一个`MAX(LastUpdatedDate)`查询，你会得到你需要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:27:23.100

每次访问表时都没有“手动”写入列的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T21:57:05.183

正如其他人所指出的，如果不自己编码，就无法跟踪更改。

ACC2000 上有一个简单的示例：如何在表单中创建记录更改的审计跟踪 [http://support.microsoft.com/default.aspx?scid=kb;en-us;Q197592](http://support.microsoft.com/default.aspx?scid=kb;en-us;Q197592)

审计跟踪 - 在记录级别记录更改：http: [//allenbrowne.com/AppAudit.html](http://allenbrowne.com/AppAudit.html) 本文介绍了表单和子表单的编辑、插入和删除。

模块：维护更改历史 [http://www.mvps.org/access/modules/mdl0021.htm](http://www.mvps.org/access/modules/mdl0021.htm) History Table 例程旨在编写跟踪对一个或多个表中的字段所做的更改的历史记录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T21:59:14.803

您需要在表中实现时间戳列，并在数据更改期间更新值。

# java - Java 日历调度事件

> ID：926907
> 
> 赞同：0
> 
> 时间：2009-05-29T16:27:09.327
> 
> 标签：java, events, calendar, schedule

在我的应用程序中，我想安排开始处理。有两种方式，首先是在预设日期，或者说像每周一。在单个日期的情况下，我可以查看胎面的时间并开始处理，但是当两个日期混合时，我无法想出一个好的解决方案。

我最初的想法是，当应用程序启动时，我可以将事件安排到日历并检查是否每分钟左右都有工作要做，这适用于单个日期和每周的情况，结果我不能那样使用日历。

解决这个问题的好方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T18:41:09.417

[Quartz](http://www.quartz-scheduler.org/)是一个用 Java 编写的开源作业调度组件，您可能想检查一下。
它的功能范围从简单的计时器到成熟的[CRON 表达式](http://en.wikipedia.org/wiki/CRON_expression)，它被 JBoss AS 广泛使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T16:42:14.827

查看 java.util.Timer。它允许您安排任务在后台线程上的指定时间执行，并且它支持重复事件。

# c# - 查找虚方法的原始实现

> ID：926910
> 
> 赞同：5
> 
> 时间：2009-05-29T16:27:24.443
> 
> 标签：c#, .net, reflection, polymorphism

我正在尝试使用反射来确定派生类从基类覆盖哪些方法。确定方法是否*未被*覆盖相当容易，但尝试确定方法是否在基类中被覆盖，或者只是在派生类中创建为虚拟方法是我想要完成的。

所以，如果 A 类有虚方法 Process 和 Export，而 B 类有虚方法 Process(overridden) 和 Display(新虚方法)，那么在检查 B 类时，我希望得到以下结果；

*   方法被覆盖：过程
*   未覆盖的方法：导出

在检查从 B 类派生的类时，我只想处理 Display 方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T16:52:18.837

[`GetBaseDefinition`](http://msdn.microsoft.com/en-us/library/system.reflection.methodinfo.getbasedefinition.aspx)你追求的是什么？

基本上

```
if (method.GetBaseDefinition() == method)
{
    // Method was declared in this class
} 
```

这是一个显示您感兴趣的案例的示例：

```
using System;
using System.Reflection;

class Base
{
    public virtual void Overridden() {}
    public virtual void NotOverridden() {}
}

class Derived : Base
{
    public override void Overridden() {}
    public virtual void NewlyDeclared() {}
}

public class Test
{
    static void Main()
    {
        foreach (MethodInfo method in typeof(Derived).GetMethods())
        {
            Console.WriteLine("{0}: {1} {2} {3}",
                              method.Name,
                              method == method.GetBaseDefinition(),
                              method.DeclaringType,
                              method.GetBaseDefinition().DeclaringType);
        }
    }
} 
```

输出：

```
Overridden: False Derived Base
NewlyDeclared: True Derived Derived
NotOverridden: False Base Base
ToString: False System.Object System.Object
Equals: False System.Object System.Object
GetHashCode: False System.Object System.Object
GetType: True System.Object System.Object 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T16:52:38.197

我希望与 Type.GetMethods() 一起使用的 BindingFlags.DeclaredOnly 会给您带来您正在寻找的效果：

[http://msdn.microsoft.com/en-us/library/4d848zkb(loband).aspx](http://msdn.microsoft.com/en-us/library/4d848zkb(loband).aspx)

# c++ - 32 位应用程序无法在 x64 Win2003 上运行，原因是

> ID：926913
> 
> 赞同：0
> 
> 时间：2009-05-29T16:29:19.763
> 
> 标签：c++, windows, 64-bit, 32-bit

这是我的问题：

我开发了一个可以在各种平台上运行的应用程序，包括 Windows 和 Unix。此应用程序在纯 Win32 机器（WinXP）或纯 Win64（Win2K3 x64 版）和其他 unix 平台上运行良好。

只有在 32 位模式下在 64 位 Win2K3 上运行时才会失败。此应用程序在运行时调用第三方 dll。并且第三方dll没有正式安装，只是复制到同一个环境中的一个位置。我也确定我拥有这些 3rd 方 dll 的正确版本（我的意思是 32 位模式的 32 位版本）。即使我在这个测试框中手动设置了“路径”，它仍然不起作用。该应用程序在此 Win2K3 框中以 32 位模式编译和构建。

我运行dependency walker 并看到同样的错误。找不到该第 3 方 dll。

任何人都可以对此有所了解吗？如何使第 3 方 dll 路径对我的应用程序或系统可见？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:44:03.637

我建议您执行以下操作：

*   确保您在 32 位应用程序中使用有问题的 DLL 的 32 位版本
*   使用 filemon 查看您的应用程序在加载该 DLL 时尝试的路径
*   如果将该 DLL 放入这些路径之一，请检查它是否有效
*   对该 DLL 本身使用依赖项walker - 它可能有自己的未解决依赖项

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-31T04:02:49.933

WOW64 将 32 位应用程序的所有调用重定向到 System32 文件夹到 SysWOW64 文件夹。第三方DLL是否在system32文件夹中？因为与您所期望的相反，system32 文件夹在 Windows x64 上仅包含 64 位 DLL。

# c# - 文本差异应用程序如何工作？

> ID：926915
> 
> 赞同：7
> 
> 时间：2009-05-29T16:30:05.567
> 
> 标签：c#, c++, diff, text-files

[诸如DiffMerge](http://www.sourcegear.com/diffmerge/)之类的应用程序如何检测文本文件中的差异，以及它们如何确定新行何时是新行，而不仅仅是在与被检查文件不同的行上？

这是相当容易实现的东西吗？是否已经有图书馆可以做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T16:55:00.287

这是作为 UNIX 命令行工具**diff基础**[的论文](http://www.xmailserver.org/diff2.pdf)。

 *** * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-29T16:56:16.477

其实很简单；DIFF 程序 - 大多数时候 - 基于[最长公共序列](http://en.wikipedia.org/wiki/Longest_common_subsequence_problem)，可以使用图形算法解决。

[该网页](http://en.wikipedia.org/wiki/Longest_common_subsequence_problem)提供了 C# 中的示例实现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-29T16:56:53.637

这是一个复杂的问题。执行差异意味着找到两个文件之间的最小编辑距离。也就是说，将一个文件转换为另一个文件所必须进行的最少更改次数。这相当于找到两个文件之间最长的公共行子序列，这是各种 diff 程序的基础。最长公共子序列问题是众所周知的，你应该可以在google上找到动态规划的解决方案。

动态编程方法的问题在于它是 O(n^2)。因此，它在大文件上非常慢，并且对于大的二进制字符串不可用。编写 diff 程序的难点在于针对您的问题域优化算法，以便获得合理的性能（和合理的结果）。Hunt 和 McIlroy 的论文“差分文件比较算法”很好地描述了 Unix diff 实用程序的早期版本。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-29T17:01:22.540

有图书馆。这是一个：[http ://code.google.com/p/google-diff-match-patch/](http://code.google.com/p/google-diff-match-patch/)

StackOverflow 使用 Beyond Compare 进行比较。我相信它可以通过从命令行调用 Beyond Compare 来工作。

# javascript - 如何在 Javascript 中获取 iframe 的正文内容？

> ID：926916
> 
> 赞同：173
> 
> 时间：2009-05-29T16:30:12.510
> 
> 标签：javascript, html, iframe

```
<iframe id="id_description_iframe" class="rte-zone" height="200" frameborder="0" title="description">
  <html>
    <head></head>
    <body class="frameBody">
      test<br/>
    </body>
  </html>
</iframe> 
```

我想要得到的是：

```
test<br/> 
```

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2012-06-19T19:26:52.547

确切的问题是如何使用纯 JavaScript 而不是 jQuery 来做到这一点。

但我总是使用可以在 jQuery 的源代码中找到的解决方案。它只是一行原生 JavaScript。

对我来说，这是获取 iframe 内容的最佳、易读甚至是*最短的方法。*

**首先获取您的 iframe**

```
var iframe = document.getElementById('id_description_iframe');

// or
var iframe = document.querySelector('#id_description_iframe'); 
```

**然后使用jQuery的解决方案**

```
var iframeDocument = iframe.contentDocument || iframe.contentWindow.document; 
```

> 它甚至可以在 Internet Explorer 中工作，它在对象的`contentWindow`属性期间执行此技巧`iframe`。大多数其他浏览器都使用该`contentDocument`属性，这就是我们首先在 OR 条件中证明该属性的原因。如果没有设置试试`contentWindow.document`。

**选择 iframe 中的元素**

然后您通常可以使用`getElementById()`甚至`querySelectorAll()`从以下位置选择 DOM-Element `iframeDocument`：

```
if (!iframeDocument) {
    throw "iframe couldn't be found in DOM.";
}

var iframeContent = iframeDocument.getElementById('frameBody');

// or
var iframeContent = iframeDocument.querySelectorAll('#frameBody'); 
```

**在 iframe 中调用函数**

仅获取`window`元素`iframe`以调用一些全局函数、变量或整个库（例如`jQuery`）：

```
var iframeWindow = iframe.contentWindow;

// you can even call jQuery or other frameworks
// if it is loaded inside the iframe
iframeContent = iframeWindow.jQuery('#frameBody');

// or
iframeContent = iframeWindow.$('#frameBody');

// or even use any other global variable
iframeWindow.myVar = window.myVar;

// or call a global function
var myVar = iframeWindow.myFunction(param1 /*, ... */); 
```

**笔记**

[如果你遵守同源政策](http://en.wikipedia.org/wiki/Same-origin_policy)，这一切都是可能的。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2010-01-26T17:05:19.490

使用 JQuery，试试这个：

```
$("#id_description_iframe").contents().find("body").html() 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2012-05-27T05:51:58.893

它非常适合我：

```
document.getElementById('iframe_id').contentWindow.document.body.innerHTML; 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-05-29T16:52:12.847

AFAIK，不能那样使用 Iframe。您需要将其 src 属性指向另一个页面。

这是使用平面旧 javascript 获取其正文内容的方法。这适用于 IE 和 Firefox。

```
function getFrameContents(){
   var iFrame =  document.getElementById('id_description_iframe');
   var iFrameBody;
   if ( iFrame.contentDocument ) 
   { // FF
     iFrameBody = iFrame.contentDocument.getElementsByTagName('body')[0];
   }
   else if ( iFrame.contentWindow ) 
   { // IE
     iFrameBody = iFrame.contentWindow.document.getElementsByTagName('body')[0];
   }
    alert(iFrameBody.innerHTML);
 } 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-11-19T14:07:13.427

use `content` in iframe with JS:

```
document.getElementById('id_iframe').contentWindow.document.write('content'); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-29T16:37:55.237

我认为在标签之间放置文本是为无法处理 iframe 的浏览器保留的，即..

```
<iframe src ="html_intro.asp" width="100%" height="300">
  <p>Your browser does not support iframes.</p>
</iframe> 
```

您使用 'src' 属性来设置 iframe html 的来源...

希望有帮助**:)**

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-29T16:48:47.593

Chalkey 是正确的，你需要使用 src 属性来指定要包含在 iframe 中的页面。如果你这样做，并且 iframe 中的文档与父文档在同一个域中，你可以使用这个：

```
var e = document.getElementById("id_description_iframe");
if(e != null) {
   alert(e.contentWindow.document.body.innerHTML);
} 
```

显然，您可以对内容做一些有用的事情，而不仅仅是将它们放在警报中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-02T00:00:11.297

以下代码是跨浏览器兼容的。它适用于 IE7、IE8、Fx 3、Safari 和 Chrome，因此无需处理跨浏览器问题。没有在 IE6 中测试。

```
<iframe id="iframeId" name="iframeId">...</iframe>

<script type="text/javascript">
    var iframeDoc;
    if (window.frames && window.frames.iframeId &&
        (iframeDoc = window.frames.iframeId.document)) {
        var iframeBody = iframeDoc.body;
        var ifromContent = iframeBody.innerHTML;
    }
</script> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-01-16T06:05:06.007

要从 javascript 获取正文内容，我尝试了以下代码：

```
var frameObj = document.getElementById('id_description_iframe');

var frameContent = frameObj.contentWindow.document.body.innerHTML; 
```

其中“id_description_iframe”是您的 iframe 的 ID。这段代码对我来说很好用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-07-30T15:16:09.877

如果您不仅要选择 iframe 的正文，还要向其中插入一些内容，并使用纯 JS、没有 JQuery 和没有 document.write()，我有一个没有其他答案提供的解决方案.

您可以使用以下步骤

1.选择您的 iframe：

```
var iframe = document.getElementById("adblock_iframe"); 
```

2.创建一个要插入框架的元素，比如说一个图像：

```
var img = document.createElement('img');
img.src = "https://server-name.com/upload/adblock" + id + ".jpg";
img.style.paddingLeft = "450px";
//scale down the image is we have a high resolution screen on the client side
if (retina_test_media == true && high_res_test == true) {
    img.style.width = "200px";
    img.style.height = "50px";
} else {
    img.style.width = "400px";
    img.style.height = "100px";
}
img.id = "image"; 
```

3.将图片元素插入iframe：

```
iframe.contentWindow.document.body.appendChild(img); 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2021-04-23T17:11:38.183

您可以在一行代码中获取 iframe 正文的内容：

```
document.getElementsByTagName('iframe')[0].contentWindow.document.body.innerText; 
```

# c# - 序列化程序集。是否需要？

> ID：926919
> 
> 赞同：20
> 
> 时间：2009-05-29T16:31:15.630
> 
> 标签：c#, web-services, serialization, assemblies, clickonce

我有一个 .net 2.0 c# ClickOnce 应用程序，它通过 Web 服务连接到它的数据。有人告诉我，一种可能加速应用程序的方法是预先生成一个序列化程序集。在这方面我有几个问题。

1.  是否生成序列化程序集的默认设置是 Auto。VS2005 使用什么标准来决定是否生成序列化程序集？似乎它不会在 Debug 配置下生成，但它会在 Release 配置下生成，但我无法确定，也无法在任何地方提供信息。

2.  序列化组装真的能改善应用的启动吗？具体有哪些改进？我真的需要序列化程序集吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-29T17:22:43.747

它真的是在问“我应该预先生成序列化程序集并将其包含在部署的项目中，还是应该退回到动态生成程序集的默认设置？” 一般来说，在第一次击球后不会受到太大伤害。它可以发挥作用的地方是序列化程序集是在`%SYSTEMROOT%\TEMP`. 在某些情况下，进程无法访问，在大多数情况下会导致致命异常。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-29T17:41:38.367

这与您的情况无关，但预先生成序列化程序集还有另一个很好的理由 - 在 SQL Server（即 SQLCLR）中托管您的代码时这是必要的。SQL Server 不允许动态生成这些程序集，因此您的序列化代码将在 SQL Server 中失败。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-29T17:24:48.843

在大多数情况下，您不太可能从中看到巨大的好处，特别是如果您将应用程序保持打开一段时间。预生成序列化程序集主要有助于*第*一次（在 exe 生命周期中）将特定类型序列化为 xml。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-17T19:48:08.403

根据 Intellitrace，只有第一次对类型进行 XML 序列化时，才会抛出 FileNotFoundException 然后被捕获。这意味着 CLR 期望加载一个包含该特定程序集的所有 XML-Serializer 的程序集，当找不到它时，抛出 FileNotFoundException 以向 XmlSerializer 发出信号：“嘿！生成该死的程序集！” 这就是在“Catch”期间发生的事情，然后存在以前未找到的文件。

I've read somewhere that using try-catch for logic is a bad exercise. IDK why Microsoft has used this approach...

# c# - 如何获取用户网络登录名？

> ID：926920
> 
> 赞同：10
> 
> 时间：2009-05-29T16:31:19.623
> 
> 标签：c#, windows, networking

我正在构建一个 C# 应用程序，我想通过用户名来识别用户。例如，如果我以用户 myusername 的身份登录域 mydomain，我希望获取 mydomain\myusername，以便识别用户。

我怎样才能用 C# 做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-29T16:32:58.937

确实很简单：

```
Environment.UserName 
```

从[MSDN 页面](http://msdn.microsoft.com/en-us/library/system.environment.username.aspx)：

> UserName 属性提供与计算机域名关联的部分凭据，由 UserDomainName 属性返回。此信息通常表示为 DOMAIN\username。
> 
> 出于安全或访问目的，此属性可用于向系统和应用程序标识当前用户。它还可用于为每个用户定制特定的应用程序。

您也可以使用[`Environment.UserDomainName`](http://msdn.microsoft.com/en-us/library/system.environment.userdomainname.aspx).

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-29T16:33:40.700

尝试**User.Identity.Name**或**Environment.UserName**。

编辑：

Environment.UserDomainName - 域

Environment.UserName - 用户名

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T16:54:26.887

`Environment.UserDomainName`将获得[域](http://msdn.microsoft.com/en-us/library/system.environment.userdomainname.aspx)并将`Environment.UserName`获得[用户名](http://msdn.microsoft.com/en-us/library/system.environment.username.aspx)。

# c# - Ado.Net 实体框架，linq：选择多个表

> ID：926922
> 
> 赞同：2
> 
> 时间：2009-05-29T16:31:38.703
> 
> 标签：c#, entity-framework, ado.net, linq-to-entities

我在 C# 中使用这些句子从 DetalleContenido 和 Archivo 表中检索数据：

```
var detallesContenido =
   from contenido in guiaContext.Contenido
      where contenido.PuntoInteres.id_punto == puntoInteresID
   from dc in contenido.DetalleContenido
      where dc.Idioma.ds_idioma == idiomaCliente
  select dc; 
```

表之间的关系是这样的：

[![数据库模型](https://i.stack.imgur.com/r7gBr.png)](https://i.stack.imgur.com/r7gBr.png)

我使用 puntoInteresID 和 idiomaCliente 从 DetalleContenido 和 Archivo 检索属于 PuntoInteres 的所有行，但是这句话 Archivo 始终为空！！

sql语句等价是：

```
Select dc.ds_nomDetContenido, dc.ds_descDetContenido, ar.archivo
from Contenido c, DetalleContenido dc, Archivo ar, Idioma i
where c.id_punto = puntoInteresID
  and c.id_contenido = dc.id_contenido
  and dc.id_idioma = i.id_idioma
  and i.ds_idioma = idiomaCliente
  and dc.id_archivo = ar.id_archivo; 
```

我如何也可以检索 Archivo？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T19:47:45.817

你也可以做

```
.Load() 
```

关于所选对象的“参考”属性（当您使用它们时）。

但是对于您的查询，您的 Archivo 表似乎是一对多的，您不能“包含”或“加载”等式的“多”方面。我认为您必须执行“选择 dc.Archivo”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T17:52:53.913

您是否尝试过使用 Include() 语句？我认为它看起来像这样

```
var detallesContenido =
       from contenido in guiaContext.Contenido.Include("DetalleContenido")
          where contenido.PuntoInteres.id_punto == puntoInteresID
       from dc in contenido.DetalleContenido
          where dc.Idioma.ds_idioma == idiomaCliente
      select dc; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T20:11:55.380

怎么样：

```
var detallesContenido =
  from contenido in guiaContext.Contenido
      where contenido.PuntoInteres.id_punto == puntoInteresID && contenido.DetalleContenido.Any(c=>c.Idioma.ds_idioma == idiomaCliente)
  select contenido.DetalleContenido; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-30T05:14:39.383

我的解决方案：

```
var detallesContenido =
   from contenido in guiaContext.Contenido
      where contenido.PuntoInteres.id_punto == puntoInteresID
   from detalleContenido in contenido.DetalleContenido
      where detalleContenido.Idioma.ds_idioma == idiomaCliente
   select new { detalleContenido, detalleContenido.Archivo }; 
```

谢谢！

# java - 使用迭代器查看 Tree 集中的下一个元素

> ID：926928
> 
> 赞同：4
> 
> 时间：2009-05-29T16:32:47.940
> 
> 标签：java, data-structures

我想知道是否有办法做到这一点，或者是否有替代的数据结构。它必须被排序，没有重复，并且有一个迭代器。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-29T16:38:30.120

[`TreeSet`](http://java.sun.com/javase/6/docs/api/java/util/TreeSet.html)有[`iterator`](http://java.sun.com/javase/6/docs/api/java/util/TreeSet.html#iterator()), 已排序，不会有重复项，并且能够通过使用 . 查看下一个更高的元素[`higher`](http://java.sun.com/javase/6/docs/api/java/util/TreeSet.html#higher(E))。

例如：

```
TreeSet<Integer> ts = new TreeSet<Integer>();
ts.add(1);
ts.add(4);
ts.add(4);
ts.add(3);

for (Integer i : ts) {
  System.out.println("current: " + i + " next:  " + ts.higher(i));
} 
```

输出是：

```
current: 1  next: 3
current: 3  next: 4
current: 4  next: null 
```

# sql - Oracle 与 Hypersonic SQL

> ID：926933
> 
> 赞同：0
> 
> 时间：2009-05-29T16:34:00.827
> 
> 标签：sql, database, oracle, hsqldb

例如，我需要在 SQL 查询中按日期选择

```
SELECT * FROM foo WHERE date = '2009-09-09' 
```

该查询适用于我的 Hypersonic 测试数据库，但不适用于 Oracle，这似乎需要：

```
SELECT * FROM foo WHERE date = TO_DATE('2009-09-09', 'yyyy-mm-dd') 
```

有没有办法在这两个数据库中统一按日期选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T17:28:34.940

我找到了答案 - 您可以在 HyperSonic 中创建 TO_DATE 函数，然后第二个查询在两者中都有效。例如，创建类：

```
public class Date {
    public static String toDate( String value, String format ) {
        return value;
    }
} 
```

和查询

```
SELECT * FROM foo WHERE date = TO_DATE('2009-09-09', 'yyyy-mm-dd') 
```

两者都适用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T16:55:48.273

您可以尝试将 H2 数据库作为您的内存数据库（[http://www.h2database.com](http://www.h2database.com)）。它应该有不错的[Oracle 兼容模式](http://www.h2database.com/html/features.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-21T16:14:20.237

HSQLDB 2.0 与 Oracle 一样支持 ANSI 日期文字。所以如果你可以升级到 HSQLDB 2.0，你可以使用：

```
选择 *
来自 foo
WHERE date_column = DATE '2009-09-09'

```

在两个数据库中（实际上甚至更多的数据库）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T17:24:33.603

通常不建议在 Oracle 中使用“date = 'literal string'”谓词 - 它对 NLS_DATE_FORMAT 设置很敏感，并且经常导致对您在结果集中查找的内容产生误解（在上面的示例中，您是否想要所有记录那天或只是那些恰好在午夜创建的？）

如果您需要两个数据库的统一查询字符串，您可以在 Oracle 中重命名表并创建一个名称为 foo 的视图，并在视图逻辑中将日期数据类型转换为 varchar2。您可能需要向表中添加基于函数的索引，以允许对重铸值进行有效搜索。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-31T00:55:19.733

如果可以，您可以在 Oracle 会话中设置 NLS_DATE_FORMAT，这样您就不需要使用 TO_DATE 函数，oracle 会在幕后为您执行此操作。

```
SQL> select value from v$nls_parameters where parameter = 'NLS_DATE_FORMAT';

VALUE
----------------------------------------------------------------
DD/MM/YYYY

SQL> create table nls_date_test ( id number(10) , date_entered date );

Table created.

SQL> insert into nls_date_test values ( 1 , '31/05/2009' );

1 row created.

SQL> insert into nls_date_test values ( 2 , '30/05/2009' );

1 row created.

SQL> select * from nls_date_test where date_entered = '2009-09-09';
select * from nls_date_test where date_entered = '2009-09-09'
                                                  *
ERROR at line 1:
ORA-01861: literal does not match format string

SQL> alter session set nls_date_format = 'YYYY-MM-DD';

Session altered.

SQL> select * from nls_date_test where date_entered = '2009-05-30';

        ID DATE_ENTER
---------- ----------
         2 2009-05-30

SQL> select value from v$nls_parameters where parameter = 'NLS_DATE_FORMAT';

VALUE
----------------------------------------------------------------
YYYY-MM-DD

SQL> 
```

# asp.net-mvc - ASP.NET MVC 中的动态（运行时生成）表单

> ID：926934
> 
> 赞同：24
> 
> 时间：2009-05-29T16:34:01.793
> 
> 标签：asp.net-mvc, dynamic-data

这是一个通用的设计问题： **您将如何在 ASP.NET MVC 中实现动态（运行时生成）表单？**

情况如下：

1.  站点管理员可以使用 GUI（MVC 视图）定义表单参数（字段、字段类型、验证）。
2.  根据需要，运行时会根据管理员配置为最终用户生成表单。我假设所有这些逻辑都将驻留在控制器中——或者可能是扩展方法、动作过滤器或类似的东西。
3.  最终用户填写表格，点击提交，信息被捕获到数据库中。

自定义不需要支持嵌套控件、第 3 方控件等，但我怀疑一个非常优雅的设计会允许这样做。大多数情况下，我只需要管理员能够将其他字段指定为文本框、复选框、单选按钮和组合框。我还需要应用程序为要保存在数据库中的这些数据分配空间，但我相信我已经弄清楚了这部分。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-02-01T00:33:56.150

我在最近的一个项目中也有同样的需求。我为此创建了一个类库。我刚刚发布了一个新版本的库。

也许它可以帮助你： [ASP.NET MVC 动态表单](http://mvcdynamicforms.codeplex.com)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-07-11T14:18:55.003

您可以使用我的[FormFactory](https://github.com/mcintyre321/FormFactory)库非常轻松地做到这一点。

默认情况下，它会根据视图模型反映以生成`PropertyVm[]`数组，但您也可以通过编程方式创建属性，因此您可以从数据库加载设置然后创建`PropertyVm`.

这是来自 Linqpad 脚本的片段。

```

```
//import-package FormFactory
//import-package FormFactory.RazorGenerator

void Main()
{
    var properties = new[]{
        new PropertyVm(typeof(string), "username"){
            DisplayName = "Username",
            NotOptional = true,
        },
        new PropertyVm(typeof(string), "password"){
            DisplayName = "Password",
            NotOptional = true,
            GetCustomAttributes = () => new object[]{ new DataTypeAttribute(DataType.Password) }
        }
    };
    var html = FormFactory.RazorEngine.PropertyRenderExtension.Render(properties, new FormFactory.RazorEngine.RazorTemplateHtmlHelper());   

    Util.RawHtml(html.ToEncodedString()).Dump(); //Renders html for a username and password field.
} 
```

```

有一个[演示站点](http://formfactory.apphb.com/)，其中包含您可以设置的各种功能的示例（例如嵌套集合、自动完成、日期选择器等）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T17:30:46.823

另一种选择是拥有一个非常松散耦合的数据库模式。

```
//这将包含管理员用户设置的所有字段和类型
**应用领域**
字段名
字段类型
...

//这些都是映射到 ParentObjectID 的所有值
**表单值**
父对象 ID
字段名
字段值

```

当您提交运行时生成的视图（来自 ApplicationFields）时，只需遍历您的 FormCollection 并尝试将其设置在您需要更新的 ParentObject 上。

```
public ActionResult MyForm(FormCollection 表单)
{
    //这是包含所有字段的主要对象
    变种父对象；

    foreach（表单中的字符串键）
    {
        parentObject.SetValue(key, form[key]);
    }
    ...

```

那么你的 parentObject 可能是这样的......

```
公共部分类 ParentObject
{
    IList _FormValues;

    public void SetValue(字符串键，字符串值)
    {
        //尝试查找该值是否已经存在
        FormValue v = _FormValues.SingleOrDefault(k => k.Key == key);

        //如果它只是设置它
        如果 (v != null)
        {
            v.价值=价值；
            返回;
        }

        //否则这可能是添加的新表单字段，因此会创建一个新值
        v = 新的表单值
        {
            ParentObjectID = this.ID,
            钥匙=钥匙，
            价值=价值
        };

        _FormValues.Add(v);
    }
}

```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T17:04:17.967

一种方法是创建您自己的`ModelBinder`，这将是您生成的表单的核心。模型绑定器负责验证`ModelState`和重建类型`ViewDataModel`（假设您的视图是类型化的）。

[DataAnnotations](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471)模型绑定器可能是一个很好的参考，此自定义模型绑定器允许您通过`Attributes`描述`ViewDataModel`属性的验证（并提示 UI 呈现）来执行此操作。然而，这都是定义的编译时间，但对于开始编写自定义模型绑定器将是一个很好的参考。

在您的情况下，您的模型绑定器应该在运行时从 xml 文件/字符串中获取字段的验证。

如果你有这样的路线：

```
routes.MapRoute(null, "Forms/{formName}/", new { action = "Index", controller = "Forms", formName = ""}), 
```

然后您可以在其中找到正确的表单 xml`FormsController.Index(string formName)`并将其传递给视图。

应该包含所有可能的`FormsModel`方法来获取数据，我看不到任何其他方式。Xml 可以映射到一个函数名（甚至可能是参数），您可以使用反射调用该函数名`FormsModel`来填充`ViewData`或键入`ViewDataModel`数据。

表单索引的视图可以通过一个`HtmlHelper`扩展从该 xml 生成一个表单，该扩展采用`XmlDocument`.

然后，当您（或 asp.net mvc）将您的表单绑定到您`ViewData`的自定义模型绑定器时，它可以检查当前控制器值以查找 formName 并查找包含所有验证规则的相应 xml。然后`ModelBinder`负责填充`ModelState`任何运行时定义的错误。

这是一项艰巨的任务，但在我看来，成功完成后非常值得:)

**正如 David Liddle 所建议的那样，更新**模型数据的更好替代方案将是一个非常松散的数据库模式。我仍然会遇到将其保存为 xml（或其他序列化格式）并使用它来生成视图并为自定义保存验证规则的麻烦，`ModelBinder`以便您可以更好地控制每个字段的布局和验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-30T18:29:26.307

cottsak 的回答很吸引人。

至少有两个客户端 XForms 引擎。这是一个：

[https://community.emc.com/community/edn/xmltech](https://community.emc.com/community/edn/xmltech)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-08-24T14:33:53.787

与直接生成带有“Web Forms 2.0”模型的 HTML 控件列表（如`List<Tuple<Meta, Value>>`. 注意：在服务器端，无论如何您都必须手动解析结果以使其适合您的结构。

搜索“下一层抽象”有利于快速开发，但请注意，“生成代码”（运行时或构建时）有其自身的特点。通常“较低层”的生成代码是比“较高抽象层”代码更好的解决方案。

因此，只需编写在 @Foreach 循环中生成 Web 2 控件的代码。

# ruby-on-rails - Rails：将二进制字段的内容保存到文件中

> ID：926935
> 
> 赞同：2
> 
> 时间：2009-05-29T16:34:31.433
> 
> 标签：ruby-on-rails, binary-data

我有一个带有包含文件的二进制字段的模型。我想将此文件保存到磁盘作为我需要做的过程的一部分。出于某种原因，我找不到有关如何执行此操作的任何信息。

该模型包含一个文件名字段和一个文件内容字段。我想做这样的事情：

```
model = SomeModel.find :first
model.file_contents.save_to_file(model.filename) 
```

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T20:50:47.890

在 ActiveRecord 中，`:binary`用于在迁移中定义列类型的类型将映射到`blob`数据库中的类型。所以这不允许你保存到文件中。

我认为您需要定义一个不是子类的模型类，并使用 Ruby 中的文件 i/o 支持（类及其子类）为该类`ActiveRecord::Base`定义一个自定义`save_to_file`方法。`IO``File`

```
class SomeModel
 attr_accessor :file
 attr_accessor :contents

 def initialize
  @file = File.new("file.xyz", "w")
 end

 def save_and_close
  @file << contents
  @file.close
 end
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-30T03:01:45.770

我不知道您为什么要对文件内容而不是模型调用#save_to_file。由于您将*file_contents*定义为 AR 属性，我猜您想将其保存到数据库**并将**其保存到磁盘。如果是这种情况，您可以简单地将这样的方法添加到您的模型中：

```
 class YourModel < ActiveRecord::Base
   # ... your stuff ...
   def save_to_file
     File.open(filename, "w") do |f|
       f.write(file_contents)
     end
   end
 end 
```

然后您只需执行以下操作：

```
obj = YourModel.find(:first)
obj.save_to_file 
```

# java - 如何在java中从网络加载图像

> ID：926938
> 
> 赞同：25
> 
> 时间：2009-05-29T16:34:44.960
> 
> 标签：java, image

我需要在一个简单的 Java 独立应用程序中从网络加载图像。有任何想法吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-05-29T16:50:49.277

您可以使用加载图像

```
BufferedImage img = ImageIO.read(new URL("http://stackoverflow.com/content/img/so/logo.png")); 
```

有关如何显示加载图像的方法，请参阅 Sun [“使用图像”教程](http://java.sun.com/docs/books/tutorial/2d/images/index.html)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-29T16:44:41.093

```
URL url = new URL("http://host/theimage.jpg");
URLConnection conn = url.openConnection();
InputStream in = conn.getInputStream(); 
```

这足以让你开始吗？不知道你想从那里做什么。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-29T16:49:09.637

请参阅位于 的文档[`ImageIO.read(URL)`](https://docs.oracle.com/javase/10/docs/api/javax/imageio/ImageIO.html#read(java.net.URL))。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-29T16:40:57.697

我会看看[HTTPClient](http://hc.apache.org/httpclient-3.x/index.html)。

找到图像的 URL，您可以获得一个输入流，为您提供图像数据，此外您还将获得内容类型等，因此您可以在下载后正确处理它。

[这是](http://hc.apache.org/httpclient-3.x/tutorial.html)一些示例代码。您可能还需要在[GetMethod](http://hc.apache.org/httpclient-3.x/apidocs/org/apache/commons/httpclient/methods/GetMethod.html)上调用 getResponseHeaders()来识别图像类型。

# xml - X509证书加密/解密

> ID：926939
> 
> 赞同：7
> 
> 时间：2009-05-29T16:34:54.647
> 
> 标签：xml, encryption-asymmetric

我刚刚开始学习 XML 安全性。我们有 VS-2005 和 ASP.Net 2.0。我想将 XML 发送到外部 URL，并且需要对其进行加密。我正在做 MSDN 文章[ms229744](http://msdn.microsoft.com/en-us/library/ms229744.aspx)和[ms229943](http://msdn.microsoft.com/en-us/library/ms229943.aspx)正在做的事情，但是在执行 DecryptDocument() 方法时，我不断收到“无法检索解密密钥”。我正在使用我们的 SSL 网络证书，我目前使用 X509Certificate 对 XML 进行数字签名，它工作正常。

我还要求其他人从不同的商店尝试这个，他们得到了同样的错误。X509 解密方法是否存在记录在案的问题？在下面的测试代码中，我将 XML 发布到另一个试图解密 XML 的网页。我不明白的是，如果 DecryptDocument() 方法甚至不检查是否嵌入了公钥，它是如何工作的。这是问题吗？如果是这样，我如何检查以确保它嵌入在 XML 中？任何帮助表示赞赏。谢谢！

```
Private Function EncryptXml(ByVal xmlDoc As XmlDocument, ByVal Cert As X509Certificates.X509Certificate2) As XmlDocument

   Dim dataNodes As XmlNodeList = xmlDoc.SelectNodes("Agency")
   If dataNodes.Count <> 1 Then
       Return Nothing 
   End If  
   Dim elementToEncrypt As XmlElement = CType(xmlDoc.GetElementsByTagName("Agency")(0), XmlElement)
   Dim eXml As New EncryptedXml()
   Dim Key As RSACryptoServiceProvider = CType(Cert.PrivateKey, RSACryptoServiceProvider)
   Dim edElement As EncryptedData = eXml.Encrypt(elementToEncrypt, Cert)
   EncryptedXml.ReplaceElement(elementToEncrypt, edElement, False)
   Return xmlDoc 
End Function

Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load 
If Not IsPostBack Then
   If Request.Form("hdnSignedXML") IsNot Nothing Then
   Dim strXML As String = Request.Form("hdnSignedXML")
   Dim xmlDoc As New XmlDocument
   xmlDoc.LoadXml(strXML)
   xmlDoc.PreserveWhitespace = True
   Response.ContentType = "text/plain"
   Response.Write(strXML)

   Dim exml As New Xml.EncryptedXml(xmlDoc)
   exml.DecryptDocument()
   xmlDoc.Save("C:/inetpub/TestExampleDecrypted.xml")

   Response.End()

End If

End Sub 
```

J.P

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-09-01T19:20:01.370

很有可能，您的 Web 进程无法访问私钥。我曾经遇到过同样的事情，并在此项目中发布了答案：

[从命令行设置证书的读取权限](https://stackoverflow.com/questions/7255747/set-read-permission-for-certificate-from-command-line/7264187#7264187)

如果您仍然有问题，对于我们的加密例程，我们参考了[http://msdn.microsoft.com/en-us/magazine/cc163454.aspx](http://msdn.microsoft.com/en-us/magazine/cc163454.aspx)

# python - 检查一个列表是否存在于另一个列表中？

> ID：926946
> 
> 赞同：3
> 
> 时间：2009-05-29T16:35:44.973
> 
> 标签：python, list

好的，我正在尝试一种更 Pythonic 的做事方法。

我该怎么做：

```
required_values = ['A','B','C']
some_map = {'A' : 1, 'B' : 2, 'C' : 3, 'D' : 4}

for required_value in required_values:
    if not required_value in some_map:
        print 'It Doesnt Exists'
        return False
return True 
```

我查看了内置函数`all`，但我真的不知道如何将其应用于上述场景。

有什么建议可以让这个更pythonic吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-29T16:42:12.690

```
all(value in some_map for value in required_values) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T16:42:39.413

```
return set(required_values).issubset(set(some_map.keys())) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T16:55:04.513

尝试列表理解：

return not bool([x for x in required_values if x not in some_map.keys()]) （为清楚起见进行布尔转换）

或返回 not [x for x in required_values if x not in some_map.keys()] （我认为更pythonic的方式）

如果列表为空，则 inside [] 语句构建一个不在映射键中的所有必需值的列表，它评估为 False，否则为 True。

因此，如果地图没有所有必需的值，则至少一个元素将在列表推导表达式构建的列表中。这将评估为 True，因此我们否定结果以满足您的代码要求（所有必需的值都应该出现在地图中）

# c# - 在多线程 C# 应用程序中检测到 LoaderLock

> ID：926947
> 
> 赞同：2
> 
> 时间：2009-05-29T16:36:17.750
> 
> 标签：c#, .net, multithreading

我正在用 C# 编写一个 WinForms 应用程序。

在应用程序的某一时刻，我生成了一个新的 STA 线程（创建线程，然后`SetApartmentState`是 ），它创建一个新表单，然后用普通的 old 显示它`Show()`。表单本身仅包含一个停靠点，`DataGrid`其`DataSource`指向`DataTable`从新打开的 检索到的`SqlConnection`。所有数据和 UI 对象都在同一个线程上创建。

当我执行该代码`LoaderLock`时，出现以下（有用的）文本异常：

> 尝试在 OS Loader 锁内进行托管执行。不要尝试在 DllMain 或图像初始化函数中运行托管代码，因为这样做会导致应用程序挂起。

我没有做这种事，至少不是故意的！堆栈跟踪的头部只有非托管代码，我无法使用 C# Express 2008 对其进行调试。

环顾 Internet，人们通常只是在 VisualStudio 中禁用该异常。这是微软的另一个例子，还是我真的应该花时间弄清楚发生了什么？

**更新**该错误似乎是由于快速打开**多个**表单（每个都有数据网格等）引起的。如果我切换`Show()`到`ShowDialog()`并一次查看一个表单，那么错误就会消失。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T16:49:30.993

我以前在将 P/Invoke 与构建不完全正确的 DLL 一起使用时看到过这种情况。我认为我们确定它在我们的特定情况下并不危险，并且会花费更多的精力来修复而不是禁用警告。

您的应用程序中有任何本机代码吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T18:31:31.527

我在使用托管 DirectX 时遇到过这种情况。我的解决方案是禁用 Loader Lock 调试助手，尽管这可能不是适用于*所有*情况的最佳解决方案。这当然不是生产代码的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T16:52:52.630

我之前在使用多线程 C# 表单时遇到过这个确切的问题。有一段时间了，所以我很难记住细节，但我记得这个问题与不拥有它们的线程对表单或控件执行操作有关——例如从错误的线程调用 Show()。如果您将消息传递给拥有线程并让它处理此类操作，那么这可能会解决您的问题。

# hibernate - HQL：按月分组

> ID：926948
> 
> 赞同：3
> 
> 时间：2009-05-29T16:36:51.947
> 
> 标签：hibernate, postgresql, group-by

我正在尝试使用 HQL 按月对一些行进行分组，但我对该 API 有点陌生，似乎无法让它工作。

这是我的代码：

```
 Criteria query = getHibernateSession().createCriteria(SalesPerformance.class);

        // summary report is grouped by date
        query.setProjection(Projections.projectionList().add(
                Projections.groupProperty("effectiveDate"), "effectiveDate").add(
                Projections.groupProperty("primaryKey.seller", "seller").add(
                Projections.sum("totalSales"))));

        // sub-select based on seller id
        query.add(Property.forName("primaryKey.seller.id").eq(sellerId)).setFetchMode(
                "primaryKey.seller", FetchMode.SELECT);

        query.add(Property.forName("primaryKey.effectiveDate").le(new Date()));
        query.add(Property.forName("primaryKey.effectiveDate").ge(DateUtils.truncate(new Date(), Calendar.MONTH)));
        query.addOrder(Order.desc("primaryKey.effectiveDate"));

        return query.list(); 
```

我对这个查询的问题是，由于 Projections.groupProperty("effectiveDate")，当我每月需要一行时，它将每天返回一行。

我考虑过使用 Projections.sqlGroupProjection 而不是 Projections.groupProperty 并添加一些 HQL，但是我发现的文档和几个示例并没有真正帮助我理解如何将正确的 postresql 语句放入该方法中。

任何了解 Postgres 和 HQL 的人都可以在这里给出一些提示吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-01T13:39:18.060

找到了解决方案：

```
Criteria query = getHibernateSession().createCriteria(SalesPerformance.class);

    // summary report is grouped by date
            query.setProjection(Projections.projectionList().add(Projections.sqlGroupProjection("date_trunc('month', eff_dt) as eff_dt_value", "eff_dt_value", new String[] {"eff_dt_value"}, new Type[] {Hibernate.DATE})).add(
                            Projections.groupProperty("primaryKey.seller", "seller").add(
                            Projections.sum("totalSales"))));

            // sub-select based on seller id
            query.add(Property.forName("primaryKey.seller.id").eq(sellerId)).setFetchMode(
                            "primaryKey.seller", FetchMode.SELECT);

            query.add(Property.forName("primaryKey.effectiveDate").le(new Date()));
            Date beginningOfLastMonth = DateUtils.truncate(DateUtils.addMonths(new Date(), -1) , Calendar.MONTH);
            Date endOfLastMonth = DateUtils.addDays(DateUtils.truncate(new Date(), Calendar.MONTH), -1);
            query.add(Property.forName("primaryKey.effectiveDate").between(beginningOfLastMonth, endOfLastMonth));

            return query.list(); 
```

请注意，就我而言，我需要使用上个月的有效日期获取值。

希望这将帮助其他人在同一条船上！:)

# sql - DB2 临时表：不存储或不检索信息

> ID：926950
> 
> 赞同：1
> 
> 时间：2009-05-29T16:37:44.193
> 
> 标签：sql, db2, temp-tables

我是一名 MSSQL 专家，但我正在处理一个 DB2 查询，该查询需要创建一个临时表、插入其中并使用它进行处理。作为一个大大缩短的测试，我正在使用以下查询，它提供了相同的结果..

```
declare global temporary table tt_testingSyntax (id int);
insert into session.tt_testingSyntax (id) values (1);
insert into session.tt_testingSyntax (id) values (2);
insert into session.tt_testingSyntax (id) values (3);
insert into session.tt_testingSyntax (id) values (4);
select * from session.tt_testingSyntax; 
```

返回零行。为什么会这样？我已经创建了表空间并验证了该表在整个查询范围内。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-30T02:20:48.210

尝试：

```
declare global temporary table tt_testingSyntax (id int) 
ON COMMIT PRESERVE ROWS NOT LOGGED;

insert into session.tt_testingSyntax (id) values (1);
insert into session.tt_testingSyntax (id) values (2);
insert into session.tt_testingSyntax (id) values (3);
insert into session.tt_testingSyntax (id) values (4);
select * from session.tt_testingSyntax; 
```

有两个选项... ON COMMIT DELETE ROWS（默认）或 ON COMMIT PRESERVE ROWS。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-30T22:15:20.227

我最终在不知不觉中有权创建自己的表（即，对于用户 X，我可以创建 X.temp1）。由于此查询只需要运行一次，因此可以正常工作。谢谢。

# cocoa - 可以从不受信任的来源安全地读取 plist 吗？

> ID：926956
> 
> 赞同：2
> 
> 时间：2009-05-29T16:38:10.807
> 
> 标签：cocoa, security, plist

我需要与 iPhone 应用程序进行简单的客户端-服务器通信，而 XML 属性列表似乎是一种非常简单的解决方案，它省去了我处理 XML 解析器委托和自己构建这些结构的麻烦。

我只是想知道将 NSPropertyListSerialization 类与外部数据一起使用是否明智？是否有任何可以利用的晦涩的 plist 功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-30T21:44:53.610

是的，将 NSPropertyListSerialization 与不受信任的数据一起使用是安全的，但是在将字节包转换为 plist 类型的层次结构之后，您必须验证这些类型以确保它们与您预期的数据格式匹配。

例如，如果您希望字典具有字符串键和 NSNumbers 作为值，则必须使用以下内容进行验证：

```
NSString *errorDescription = nil;
NSPropertyListFormat format = 0;
id topObject = [NSPropertyListSerialization propertyListFromData:plistData mutabilityOption:NSPropertyListImmutable format:&format errorDescription:&errorDescription];
NSDictionary *validDictionary = nil;
if ([topObject isKindOfClass:[NSDictionary class]]) {
    BOOL allNumbers = YES;
    for(id value in [topObject allValues]) {
        allNumbers = allNumbers && [value isKindOfClass:[NSNumber class]];
    }
    if (allNumbers) {
        validDictionary = topObject;
    }
}
return validDictionary; 
```

如果您不这样做，则数据源可能已将 plist 值放入存档中，其类型不匹配，或者可能导致您的客户端行为不端并最终成为安全漏洞的非法值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T16:46:06.823

@乔恩赫斯：谢谢。我创建了`NSDictionary`类别以减少所需的`isKindOfClass`es 数量。

```
@interface NSDictionary (TypedDictionary)

-(NSArray *)arrayForKey:(NSString*)key;
-(NSString *)stringForKey:(NSString*)key;
-(NSDictionary *)dictionaryForKey:(NSString*)key;

@end

@implementation NSDictionary (TypedDictionary)

-(NSArray *)arrayForKey:(NSString*)key {
    NSArray *obj = [self objectForKey:key];
    return [obj isKindOfClass:[NSArray class]] ? obj : nil;
}
-(NSString *)stringForKey:(NSString*)key {
    NSString *obj = [self objectForKey:key];
    return [obj isKindOfClass:[NSString class]] ? obj : nil;
}
-(NSDictionary *)dictionaryForKey:(NSString*)key {
    NSDictionary *obj = [self objectForKey:key];
    return [obj isKindOfClass:[NSDictionary class]] ? obj : nil;
}
@end 
```

# asp.net - 如何将 ASP.NET 中继器控件绑定到 IList ?

> ID：926961
> 
> 赞同：4
> 
> 时间：2009-05-29T16:39:07.123
> 
> 标签：asp.net, data-binding, repeater

我从来没有这样做过，但我将转发器绑定到字符串的通用列表，我不确定正确的语法。

如果我绑定到一个 IList 并且 myType 有一个属性 LayerName 我会使用这个：

```
<asp:Repeater ID="rptChecks" runat="server">
     <ItemTemplate>
          <input type="checkbox" id="<%#Eval("LayerName") %>"/>
     </ItemTemplate>
</asp:Repeater> 
```

当我只绑定到没有任何属性要使用的字符串时，我该怎么做？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-29T16:41:14.250

试试这个：

```
<asp:Repeater ID="rptChecks" runat="server">
     <ItemTemplate>
          <input type="checkbox" id="<%# Container.DataItem %>"/>
     </ItemTemplate>
</asp:Repeater> 
```

# mysql - 查找所有 MySQL 存储过程调用？

> ID：926967
> 
> 赞同：17
> 
> 时间：2009-05-29T16:40:49.210
> 
> 标签：mysql, stored-procedures

对于我偶尔使用和修改的给定 MySQL DB，我最近不得不对一些表和存储过程进行一些更改。在这个数据库中有一些地方，程序调用其他程序。我发现到处寻找我需要修改这些修改过的程序的参数的任务很麻烦，因此转储数据库并对转储文件进行文本搜索以查找所有 CALL 语句。

我想知道是否有更好更简单的方法来做到这一点。我在这里做了一些粗略的搜索，也搜索了一个解决方案，但真的没有找到答案。我怀疑有一种方法可以列出所拨打的电话或一些实用程序，使其变得简单，但我还没有找到这个解决方案。

有任何想法吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-05-29T17:55:47.277

好吧，我终于偶然发现了以下解决方案：

INFORMATION_SCHEMA.ROUTINES 表包含的信息在尝试追踪从一个 SP 到另一个 SP 的 CALL 时非常有用。我使用了以下内容：

```
SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_DEFINITION LIKE "%SomeProc%"; 
```

这检索了所有包含 SomeProc 的存储过程。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-11T08:09:50.250

哇，这太棒了！我正在使用它在我的 MySQL 数据库中搜索文本：

```
SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_DEFINITION LIKE "%search_string%"; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-05-16T11:35:17.357

我发现这是一个更简洁的列表。我使用 '_sp' 对所有存储的过程进行后修复，这在搜索它们时会有所帮助：

```
SELECT ROUTINE_NAME FROM information_schema.ROUTINES WHERE ROUTINE_NAME LIKE "%_sp"; 
```

# iphone - Iphone SDK - 动画子视图

> ID：926971
> 
> 赞同：4
> 
> 时间：2009-05-29T16:41:13.953
> 
> 标签：iphone, animation, uiview, uiviewcontroller

我有一个具有 UIWebView 和 OptionsPane 的视图（带有自定义视图的自定义 UIViewController）。

我希望在显示视图时，将选项窗格（位于主视图的顶部）翻转到位。我正在使用代码，我得到了一个奇怪的结果。

第一次显示视图时，选项窗格似乎已经可见...当我在导航控制器上按 BACK 并再次拉起视图时，动画效果完美。

任何人都可以对这个话题有所了解吗？

```
- (void)viewDidLoad {
    [super viewDidLoad];
    optionsPane=[[OptionsPaneController alloc] initWithNibName:@"OptionsPane" bundle:nil];
}

- (void)viewWillAppear:(BOOL)animated {

    [optionsPane.view removeFromSuperview];
    [self checkOptionsVisible];
}

-(void)checkOptionsVisible{
    [UIView beginAnimations:nil context:nil];
    [UIView setAnimationDuration:0.5]; 
    [UIView setAnimationTransition:UIViewAnimationTransitionFlipFromRight forView:[optionsPane view] cache:YES];
    [[self view] addSubview:[optionsPane view]];
    [theWebView setFrame:CGRectMake(0,87,320,230)];
    [[optionsPane view] setFrame:CGRectMake(0,0,320,87)];
    [UIView commitAnimations];      
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T17:02:19.450

嗯，我不认为 viewWillAppear 消息是第一次发送的。我在[SDK](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIViewController_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40006926-CH3-SW20)中读到了两件事。您应该在该消息中调用 super 并且有一个重大警告可能适用于您的第一次：

> 警告：如果属于视图控制器的视图直接添加到视图层次结构中，视图控制器将不会收到此消息。如果您将视图插入或添加到视图层次结构中，并且它具有视图控制器，则应直接向关联的视图控制器发送此消息。未能向视图控制器发送此消息将阻止显示任何关联的动画。

最终，我将运行调试器并确保 viewWillAppear 消息在您认为发送时发送。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T22:17:45.750

根据您的情况更新：

而是有四个视图：

1.  支持视图

2.  主视图

3.  后视图（选项窗格） 100 像素

4.  前视图（空白视图） 100 像素

像往常一样将主视图添加到后备视图。

将前视图添加到您希望选项窗格出现的后视图。

确保前视图和后视图具有相同的框架。

使用与下面相同的代码，使用翻转前视图和后视图的方法。

* * *

原始答案

您需要 3 个视图：

1.  支持视图

2.  前视图

3.  后视图

后备视图只保留其他 2 个，因为它们来回翻转以下是翻转方法。我将它们都放在 backingViewController 中：

```
- (void)displayBack{

    //parent controller is an ivar so the sub-view controllers know who their daddy is
    backController.parentController = self;

    [UIView beginAnimations:nil context:@"flipTransitionToBack"];
    [UIView setAnimationDuration:1.2];

    //note self.view IS the backing view
    [UIView setAnimationTransition:UIViewAnimationTransitionFlipFromRight forView:self.view cache:YES];

    //remove the front view
    [[frontController view] removeFromSuperview];
    //add the back view view
    [self.view addSubview:[backController view]];
    [UIView commitAnimations];

    //giving a heads up to the view that is about to come on screen
    [backController viewWillAppear:YES];

}

- (void)displayFront{

    [UIView beginAnimations:nil context:@"flipTransitionToFront"];
    [UIView setAnimationDuration:1.2];

    [UIView setAnimationDelegate:self];

    //I'm interested in knowing this has happened
    [UIView setAnimationDidStopSelector:@selector(flipAnimationDidEndWithID:finished:context:)];

    [UIView setAnimationTransition:UIViewAnimationTransitionFlipFromLeft forView:self.view cache:YES];
    //remove back view
    [[backController view] removeFromSuperview];
    //add the front view
    [self.view addSubview:[frontController view]];
    [UIView commitAnimations];

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T19:14:36.533

如果我理解你的解释，前几天我遇到了一个非常相似的问题。

第一次加载时发生的是 viewDidLoad 首先触发。加载 nib 文件所花费的时间比 viewWillAppear 自身触发所花费的时间要多一些。

我们得到的是在 viewWillApper 已经退休后加载的 nib。

在那之后的任何负载上，viewDidLoad 都不会触发，让 viewWillAppear 完成它忠实的翻转工作。

该怎么办？
首先，尝试更改您的代码以使用“viewDidAppear”。这应该会有所帮助，但你必须看看它是否看起来不错。

另一种选择（丑陋的，我知道）是也调用 viewDidLoad 上的 checkOptionsVisible 。
如果没有这种帮助，我会考虑将计时器视为一种技巧——如果要求允许的话。

我希望这能让你更接近解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-03T20:08:03.167

UIViewController 上的视图属性是延迟加载的——即使您在这里使用 nib 进行初始化，直到第一次访问该属性时，视图本身才真正被实例化。

如果不查看更多代码，很难确切知道发生了什么，但是如果您在 viewDidLoad 中访问 optionsPane.view，您可能会得到您想要的结果（您不需要对它做任何事情，只需访问该属性以强制加载）。

# excel - 排序列表时保留单元格地址

> ID：926983
> 
> 赞同：0
> 
> 时间：2009-05-29T16:43:00.677
> 
> 标签：excel

这是我需要的简化版本。本质上，我们有一个组件列表及其状态（想象它们已经过测试）。组件 BBB 有两个子组件，BBB1 和 BBB2。我希望他们的状态能够反映 BBB 组件“父级”的状态。轻松搞定，除了列表很长，我还需要保留选项，按自己的意愿排序。如果我使用对“=B3”的简单单元格引用，那么一旦对列表进行排序，这将是无效的。类似地，命名范围为 B3；命名范围地址是静态的，并且在列表排序时不会动态改变。

我*可以*通过在排序区域之外的某个地方设置一个“静态”BBB 状态来解决这个问题，但这是不优雅的，我不喜欢不优雅！

有任何想法吗？

[http://FileHost.JustFreeSpace.Com/158complist.xls](http://FileHost.JustFreeSpace.Com/158complist.xls)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T17:14:36.210

我不完全确定您的使用和需求，但试试这个小公式：

`=ADDRESS(MATCH("BBB",A:A,0),1)`

它将返回 BBB 所在的单元格地址。如果删除公式的 ADDRESS 部分，它将返回行号。

也可以修改它以在“状态”列中提取值。

如果将此公式放在 BBB1 和 BBB2 行的“状态”列中，那么它将在 BBB 更改时更新：

`=INDEX(A:C,MATCH(LEFT(A2,3),A:A,0),2)`

让我知道我是否只是温暖，或者如果我得到它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T23:56:44.957

也许 VLOOKUP 工作表功能可以满足您的需求？请参阅[http://office.microsoft.com/en-us/excel/HP052093351033.aspx](http://office.microsoft.com/en-us/excel/HP052093351033.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T00:09:56.773

有一个非常简单的解决方案。只是使用了绝对引用，例如 =$B3 或 =B$3 或 =$B$3

> 如果我使用对“=B3”的简单单元格引用，那么一旦对列表进行排序，这将是无效的。

排序不会使这些绝对引用无效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T15:10:06.223

如果您只是使用 =B3，则在排序时 Excel 会在您排序时自行更新，只要您不使用 VBA 进行排序。如果您想保留该单元格的句柄，您可能需要手动再次找到它，或者在移动它时密切关注它的去向。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-31T15:47:34.240

对于同一行内的引用，请使用相对引用。（这不是你的问题。）

对于对其他行的引用，如果您可以识别每一行的唯一键，请使用 VLOOKUP（最后一个参数为 FALSE）。如果没有自然键，则构建一个代理并确保它是唯一的并且保持唯一。[我在表头中显示下一个要使用的值，并使用条件格式突出显示非唯一值。例如，如果您插入复制的行，这很容易中断。]

绝对引用不起作用。他们保留了准确的单元格引用——但在排序之后，现在指向被排序到该位置的任何值。我相信这是 Excel 中的一个错误，无论是在代码中还是在规范中。人们期望的行为是元组中的值保持不变，即使该元组被排序移动。对于绝对引用，具有绝对引用的单元格中的值会发生变化，即使 - 或者更确切地说是因为 - 引用本身保持不变。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-08-16T07:10:06.440

如果单元格引用指向另一个 ROW 中的单元格，则即使使用 $ 符号锁定单元格引用，它也会在排序后更改。

# php - 检查用户名是否存在

> ID：926989
> 
> 赞同：2
> 
> 时间：2009-05-29T16:44:22.920
> 
> 标签：php, mysql

检查用户名是否存在于 MySQL 表中的最佳方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T16:47:48.750

```
SELECT COUNT(*) as count FROM users WHERE username='whatever' 
```

读出第一个结果行 - 如果“计数”列 > 0，则用户名存在。

或者，在 php 中，您可以使用：

```
SELECT * FROM users WHERE username='whatever' 
```

然后使用 mysql_num_rows （或等效的）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-29T17:01:30.480

如果您试图确定 MySQL 中是否存在用户（即存在可以登录 MySQL 本身的用户名）。

```
select user,host from mysql.user where user = 'username'; 
```

如果需要按主机过滤：

```
select user,host from mysql.user where user = 'username' and host = 'localhost'; 
```

这些查询可让您查看谁有权访问 MySQL 数据库服务器，并且只有当您是 MySQL 服务器的管理员时才能访问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-29T16:50:58.763

```
SELECT 1 FROM `users` WHERE `username` = 'whatever' LIMIT 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T16:47:47.410

创建一个存储过程来完成它。它比通过代码运行 SQL 更快。我只能将它与您表中保存的数据进行比较。;-)

# tfs - 你如何获得多个 \_来自 TFSBuild 的已发布网站

> ID：926992
> 
> 赞同：0
> 
> 时间：2009-05-29T16:45:29.017
> 
> 标签：tfs, msbuild

配置部分指定执行 2 个配置构建，但我只获得 TFSBuild 生成的 Release_PublishedWebsites。

以下是配置：（我从两个开始，但实际上会有 5 个）

... 释放任何 CPU

```
 <ConfigurationToBuild Include="Release|Any CPU">
        <FlavorToBuild>Release</FlavorToBuild>
        <PlatformToBuild>Any CPU</PlatformToBuild>
    </ConfigurationToBuild>
</ItemGroup> 
```

提前感谢任何知道这一点的人！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T19:46:00.580

问题是 FlavorToBuild 在两个 ConfigurationToBuild 节点中被错误地指定为 Release。这是修复：（注意从发布修订为培训）

```
<ConfigurationToBuild Include="Training |Any CPU">
        <FlavorToBuild>Training</FlavorToBuild>
        <PlatformToBuild>Any CPU</PlatformToBuild>
    </ConfigurationToBuild>

    <ConfigurationToBuild Include="Release|Any CPU">
        <FlavorToBuild>Release</FlavorToBuild>
        <PlatformToBuild>Any CPU</PlatformToBuild>
    </ConfigurationToBuild>
</ItemGroup> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T18:15:18.047

在您发布的代码中，只有 1 个要构建的配置：Release|Any CPU。

请注意，在您的示例中，配置是“Release”，“Any CPU”是您正在构建的平台。

关于您的问题，您是否正在尝试为发布和调试构建项目？如果是这样，你可以尝试这样的事情：

```
<ConfigurationToBuild Include="Release|Any CPU">
                <FlavorToBuild>Release</FlavorToBuild>
                <PlatformToBuild>Any CPU</PlatformToBuild>
</ConfigurationToBuild>
<ConfigurationToBuild Include="Debug|Any CPU">
                <FlavorToBuild>Debug</FlavorToBuild>
                <PlatformToBuild>Any CPU</PlatformToBuild>
</ConfigurationToBuild> 
```

在该代码中，我们包括为平台构建的配置发布和调试任何 CPU

# css - 在 ol 的 li 内浮动图像，向左显示文本，适用于 Chrome，而不是 IE/FF

> ID：926994
> 
> 赞同：2
> 
> 时间：2009-05-29T16:45:46.023
> 
> 标签：css, image, html-lists, css-float, listitem

我想要一个有序列表，左侧有文本，右侧有每个 li 的图像。所以我将图像浮动到右边，它把图像正确地放在右边，把文本放在左边，但是在 IE 和 FF 中图像太低了 14 像素。Chrome 做得对。在我看来，这似乎是 IE 和 FF 将浮动放在每个 LI 的外部或下方，而不是放在它应该在的内部（如 Chrome）。如果我为 IE 和 FF 调整位置 -14px（向上），它对它们来说效果很好，但是 Chrome 就搞砸了。14px 是每个 LI 的高度，这就是该技巧有效的原因。

除非绝对需要（即，为 IE/FF 设置 -14px 偏移量并告诉 Chrome 忽略它），否则我不想要单个浏览器 hack。

```
#top25list{
       width:185px;
       cursor:n-resize;
       list-style:
       decimal inside;
       padding:0;
       margin:0
}
#top25list li{
       margin:0;
       padding:0 3px;
       background-color:#FFF;
       border-top:1px solid #990100;
       border-bottom:1px solid #990100
}
#top25list img{
       border:none;
       height:13px;
       width:13px;
       float:right
}
#top25list li:hover{
       background-color:#990100;
       color:#FFF
} 
```

li 没什么特别的：

```
<li id=##>Name <a href="#" rel="##" class="removeTeam"><img src="/images/button-x.png" alt="Remove Name"></a></li> 
```

请参阅第一个 LI 没有 FF/IE 的图像，因为它在下方（看起来像是在 #2 的位置），并且 #25 图像不在列表的底部。

我希望所有 3 看起来都像 Chrome。有一些 JavaScript 生成 OL/LI，并且`class=removeTeam`仅用于 jQuery 操作。此列表在 jQuery 可排序中，并且我确实使用 jQuery ( `.disableSelection();`) 禁用了列表选择。我认为这与 jQuery 或 JavaScript 无关，只是简单的 CSS。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-29T16:56:00.783

这是 IE 和 Firefox 共享的错误。要解决它，您必须将图像移动到其行中的任何非浮动文本之前。

```
<li id=##>
   <a href="#" rel="##" class="removeTeam">
      <img src="/images/button-x.png" alt="Remove Name">
   </a> 

   Name
</li> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T17:27:23.460

如果您无法更改 HTML，您可以尝试定位而不是浮动。

```
 #top25list li{
  margin:0;
  padding:0 3px 10px 3px; /* add padding-right to make room for the image */
  background-color:#FFF;
  border-top:1px solid #990100;
  border-bottom:1px solid #990100;
  position: relative; /* for img to have position  */
}

#top25list img{
  border:none;
  height:13px;
  width:13px;
  position: absolute;
  top: 0;  
  right: 0; 
} 

```

我没有测试过，如果我错了，请告诉我。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T03:38:52.430

list-style: inside 搞砸了。

下面是有效的代码。我将浮点数移至 #top25list a 并将其移至名称之前。

```
#top25list{
       width:185px;
       cursor:n-resize;
       padding:0;
       margin:0
}
#top25list li{
       margin:0;
       padding:0 3px;
       background-color:#FFF;
       border-top:1px solid #990100;
       border-bottom:1px solid #990100
}
#top25list a{float:right;}
#top25list img{
       border:none;
       height:13px;
       width:13px;
}
#top25list li:hover{
       background-color:#990100;
       color:#FFF
}

<ul id="top25list">
    <li><a href="#" rel="##" class="removeTeam"><img src="/images/button-x.png" alt="Remove Name"></a>Name </li>
    <li><a href="#" rel="##" class="removeTeam"><img src="/images/button-x.png" alt="Remove Name"></a>Name </li>
    <li><a href="#" rel="##" class="removeTeam"><img src="/images/button-x.png" alt="Remove Name"></a>Name </li>
    <li><a href="#" rel="##" class="removeTeam"><img src="/images/button-x.png" alt="Remove Name"></a>Name </li>
</ul> 
```*******************