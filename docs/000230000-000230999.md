# StackOverflow 问答 000230000-000230999

# .net - 线程与线程池

> ID：230003
> 
> 赞同：147
> 
> 时间：2008-10-23T14:41:52.283
> 
> 标签：.net, multithreading, architecture, threadpool

使用新线程和使用线程池中的线程有什么区别？有哪些性能优势，为什么我应该考虑使用池中的线程而不是我明确创建的线程？我在这里专门考虑.NET，但一般示例很好。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-10-23T14:48:06.343

线程池将通过以下方式为频繁且相对较短的操作提供好处

*   重用已经创建的线程而不是创建新的线程（一个昂贵的过程）
*   当对新工作项的请求激增时限制线程创建速率（我相信这仅在 .NET 3.5 中）
    *   如果您将 100 个线程池任务排队，它只会使用已创建的线程数来服务这些请求（例如 10 个）。线程池会进行频繁的检查（我相信在 3.5 SP1 中每 500 毫秒），如果有排队的任务，它会创建一个新线程。如果您的任务很快，那么新线程的数量将很少，并且为短任务重用 10 个左右的线程将比预先创建 100 个线程更快。

    *   如果您的工作负载始终有大量线程池请求进入，那么线程池将通过上述过程在池中创建更多线程来调整自己以适应您的工作负载，以便有更多线程可用于处理请求

    *   [在此处](http://blogs.msdn.com/pedram/archive/2007/08/05/dedicated-thread-or-a-threadpool-thread.aspx)查看有关线程池如何在后台运行的更多深入信息

如果作业运行时间相对较长（可能大约一两秒，但取决于具体情况），您自己创建一个新线程会更合适

@Krzysztof - 线程池线程是后台线程，将在主线程结束时停止。手动创建的线程默认为前台（将在主线程结束后继续运行），但可以在对其调用 Start 之前将其设置为后台。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-23T14:56:59.570

.NET 托管线程池：-

*   根据当前工作负载和可用硬件调整自身大小
*   包含工作线程*和*完成端口线程（专门用于服务 IO）
*   针对大量相对短暂的操作进行了优化

存在可能更适合长时间运行的操作的其他线程池实现。

具体来说，使用线程池来防止您的应用程序创建*太多*线程。线程池最重要的特性是工作队列。也就是说，一旦你的机器足够繁忙，线程池会将请求排队，而不是立即产生更多线程。

因此，如果您要创建少量有限数量的线程，请自行创建它们。如果您无法预先确定可以创建多少线程（例如，它们是为了响应传入的 IO 而创建的），并且它们的工作将是短暂的，请使用线程池。如果您不知道有多少，但他们的工作将长期运行，那么平台中没有什么可以帮助您 - 但您可能能够找到适合的替代线程池实现。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-23T14:52:26.523

还

> `new Thread().Start()`

如果关闭程序，生成不会死的前台线程。ThreadPool 线程是在您关闭应用程序时终止的后台线程。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2016-02-01T06:56:09.230

我很好奇这些资源的相对使用情况，并在我的 2012 双核 Intel i5 笔记本电脑上使用 Windows 8 上的 .net 4.0 版本运行了基准测试。线程池平均需要 0.035 毫秒才能启动，而线程平均需要 5.06 毫秒小姐。换句话说，对于大量短期线程，池中的线程启动速度大约快 300 倍。至少在测试范围（100-2000）线程中，每个线程的总时间似乎相当稳定。

这是进行基准测试的代码：

```
 for (int i = 0; i < ThreadCount; i++) {
        Task.Run(() => { });
    }

    for (int i = 0; i < ThreadCount; i++) {
        var t = new Thread(() => { });
        t.Start();
    } 
```

[![在此处输入图像描述](https://i.stack.imgur.com/6RGMr.png)](https://i.stack.imgur.com/6RGMr.png)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-23T14:48:31.040

在此处查看较早的线程：

[什么时候不应该在 .Net 中使用 ThreadPool？](https://stackoverflow.com/questions/10274/when-should-i-not-use-the-threadpool-in-net)

总结是，如果您需要生成许多短期线程，Threadpool 是很好的选择，而使用 Threads 可以为您提供更多控制。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-23T14:50:09.227

如果你需要很多线程，你可能想要使用 ThreadPool。他们重用线程，为您节省创建线程的开销。

如果你只需要一个线程来完成某件事，线程可能是最简单的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-23T14:46:50.620

线程本地存储对于线程池来说不是一个好主意。它赋予线程一个“身份”；不再是所有线程都是平等的。现在，如果您只需要一堆相同的线程，准备好在没有创建开销的情况下完成您的工作，线程池就特别有用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-02-21T21:25:34.993

对 theadpool 线程的主要需求是处理预期几乎立即完成的短小任务。硬件中断处理程序通常在不适合非内核代码的堆栈上下文中运行，但硬件中断处理程序可能会发现应该尽快运行用户模式 ​​I/O 完成回调。为了运行这样的事情而创建一个新线程将是巨大的矫枉过正。有一些预先创建的线程可以被分派来运行 I/O 完成回调或其他类似的事情会更有效。

此类线程的一个关键方面是，如果 I/O 完成方法总是基本上即时完成并且从不阻塞，并且当前运行此类方法的此类线程的数量至少等于处理器的数量，那么任何其他线程的唯一方法如果其他方法之一阻塞或其执行时间超过正常的线程时间片，则可以在上述方法之一完成之前运行；如果按预期使用线程池，那么这些都不应该经常发生。

如果一个方法不能在它开始执行的 100ms 左右内退出，则该方法应该通过主线程池以外的其他方式执行。如果有很多任务要执行，这些任务是 CPU 密集型但不会阻塞，使用与“主”线程池分开的应用程序线程池（每个 CPU 核心一个）调度它们可能会有所帮助，因为使用在运行非阻塞 CPU 密集型任务时，线程多于内核将适得其反。但是，如果一个方法需要一秒钟或更长时间才能执行，并且大部分时间都被阻塞，那么该方法应该可能在专用线程中运行，并且几乎可以肯定不应该在主线程池线程中运行。如果需要通过 I/O 回调等触发长时间运行的操作，

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-23T14:54:29.310

通常（我从未使用过 .NET），线程池将用于资源管理目的。它允许将约束配置到您的软件中。它也可能出于性能原因而完成，因为创建新线程可能很昂贵。

也可能有系统特定的原因。在 Java 中（同样我不知道这是否适用于 .NET），线程的管理器可能会在每个线程从池中拉出时应用线程特定的变量，并在返回时取消设置它们（传递类似一个身份）。

示例约束：我只有 10 个数据库连接，所以我只允许 10 个工作线程访问数据库。

这并不意味着您不应该创建自己的线程，但在某些情况下使用池是有意义的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-02-01T13:19:13.970

***主题***：

1.  创建线程远比使用线程池慢。
2.  您可以更改线程的优先级。
3.  与资源相关的进程中的最大线程数。
4.  线程处于操作系统级别，由操作系统控制。
5.  当任务运行时间相对较长时，使用 Thread 是更好的选择

***线程池***：

1.  在线程池上运行线程比直接创建线程要快得多。
2.  您不能更改基于线程池运行的线程的优先级。
3.  每个进程只有一个线程池。
4.  线程池由 CLR 管理。
5.  线程池对于短期操作很有用。
6.  线程池中的线程数与应用程序负载有关。
7.  TPL 任务基于线程池运行

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-08T16:58:31.893

如果您不知道或无法控制将创建多少线程，则使用池是一个好主意。

只是使用线程在`positionchanged`列表控件事件上更新数据库中的某些字段的表单存在问题（避免冻结）。我的用户花了 5 分钟从数据库中收到错误（与 Access 的连接太多），因为他更改列表位置的速度太快了......

我知道还有其他方法可以解决基本问题（包括不使用访问权限），但池化是一个好的开始。

# sql - 重新编号主键

> ID：230006
> 
> 赞同：8
> 
> 时间：2008-10-23T14:42:49.910
> 
> 标签：sql, primary-key

如何重置 sql 表上的主键计数器并使用新的主键更新每一行？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-23T14:45:46.957

我会先在表中添加另一列，用新的 PK 填充它。

然后我会使用更新语句来更新所有相关表中的新 fk 字段。

然后你可以删除旧的 PK 和旧的 fk 字段。

**编辑：**是的，正如伊恩所说，您将不得不删除然后重新创建所有外键约束。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-23T15:07:35.430

不确定您使用的是哪个 DBMS，但如果它恰好是 SQL Server：

```
SET IDENTITY_INSERT [MyTable] ON 
```

允许您更新/插入主键列。然后当您完成更新密钥时（如果逻辑复杂，您可以使用[CURSOR ）](http://msdn.microsoft.com/en-us/library/ms180169.aspx)

```
SET IDENTITY_INSERT [MyTable] OFF 
```

希望有帮助！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T14:51:33.403

这可能是也可能不是 MS SQL 特定的，但是：TRUNCATE TABLE 重置身份计数器，因此一种快速而肮脏的方法是 1）执行备份 2）将表内容复制到临时表：3）复制临时表内容返回表（具有标识列）：

```
SELECT Field1, Field2 INTO #MyTable FROM MyTable

TRUNCATE TABLE MyTable

INSERT INTO MyTable
(Field1, Field2)
SELECT Field1, Field2 FROM #MyTable

SELECT * FROM MyTable
-----------------------------------
ID    Field1    Field2
1     Value1    Value2 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T15:20:49.570

你为什么还要打扰？基于计数器的“身份”主键的全部意义在于数字是任意且无意义的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T15:41:59.777

您可以按照以下步骤进行操作：

*   使用额外的列 new_key 创建 yourTable 的副本
*   使用 yourTable 中受影响的行以及所需的 new_key 值填充 copyOfYourTable
*   [暂时禁用约束](https://stackoverflow.com/questions/159038/can-foreign-key-constraints-be-temporarily-disabled-using-tsql#161410)
*   更新所有相关表以指向 new_key 的值而不是 old_key
*   从 yourTable 中删除受影响的行
*   SET IDENTITY_INSERT [yourTable] ON
*   使用键的新正确值（来自复制表）再次插入受影响的行
*   SET IDENTITY_INSERT [yourTable] 关闭
*   种子身份
*   [重新启用约束](https://stackoverflow.com/questions/159038/can-foreign-key-constraints-be-temporarily-disabled-using-tsql#161410)
*   删除copyOfYourtable

但正如其他人所说，不需要所有这些工作。我倾向于将身份类型主键视为等同于 C 中的指针，我使用它们来引用其他对象，但从不显式修改或访问它们

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-23T16:10:15.053

如果这是 Microsoft 的 SQL Server，您可以做的一件事是使用**[dbcc checkident]( [http://msdn.microsoft.com/en-us/library/ms176057(SQL.90).aspx)](http://msdn.microsoft.com/en-us/library/ms176057(SQL.90).aspx))**

假设您有一个要在其中移动数据并重新编号主键的表。例如，表的名称是**ErrorCode**。它有两个字段，**ErrorCodeID**（主键）和**Description**。

## 使用 dbcc checkident 的示例代码

```
-- Reset the primary key counter
dbcc checkident(ErrorCode, reseed, 7000)

-- Move all rows greater than 8000 to the 7000 range
insert into ErrorCode
select Description from ErrorCode where ErrorCodeID >= 8000

-- Delete the old rows
delete ErrorCode where ErrorCodeID >= 8000

-- Reset the primary key counter
dbcc checkident(ErrorCode, reseed, 8000) 
```

在这个示例中，您将有效地将所有行移动到不同的主键，然后重置，以便下一次插入采用 8000 ID。

希望这个对你有帮助！

# .net - Drools.NET 与 Windows Workflow Foundation (WF)

> ID：230011
> 
> 赞同：19
> 
> 时间：2008-10-23T14:44:25.273
> 
> 标签：.net, workflow-foundation, drools

我目前正在寻找适用于 .NET 的规则引擎。我们的逻辑很简单，+, -, *, /, and, or, 基本的操作顺序。但是，我们需要将此信息存储在数据库中，然后在从数据库中提取新版本时生成规则文件。所以普通的 UI 编辑器对我们来说毫无用处，除非其中一个有网页版 UI 编辑器。

所以我的问题是，鉴于我所说的，就编程配置和与 ASP.NET 的集成而言，这将是我们最好的规则引擎。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-23T17:20:53.993

我在 WWF 的经历非常糟糕。它非常适合开发您知道将存在的工作流程（例如“此文档发送给某个人的经理，然后发送给 HR，如果它无效，它会返回给提交者”）但如果您想要动态配置，那就真的很痛苦了。正如你所知道的，我们试图将它用于完全可配置的系统，BizTalk 做得非常好，而且看起来 MS 并不热衷于让开发人员如此便宜地替换 BizTalk。

我们还研究了使用[Acumen 规则引擎和工具](http://www.acumenbusiness.com/products.htm)，它们看起来非常适合我们的需求，尽管我们从来没有时间删除 WWF 并替换它。

我强烈建议，如果您的规则相对简单，您要么使用拥有源代码的规则引擎，要么自己编写。 [Justin Etheredge](http://www.codethinked.com/)有一篇关于使用[域驱动设计](https://rads.stackoverflow.com/amzn/click/com/0321125215)(Evans) 中确定的模式通过自定义规则执行域验证的[两](http://www.codethinked.com/post/2008/10/12/Thoughts-On-Domain-Validation-Part-1.aspx) [部分](http://www.codethinked.com/post/2008/10/16/Thoughts-On-Domain-Validation-Part-2.aspx)文章。

我按照相同的准则在我当前的项目中实现了一个类似的系统，并从数据库中序列化/反序列化规则。我将不得不看看[Drools.NET](http://droolsdotnet.codehaus.org/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-18T10:01:15.297

biztalk 不会轻易被 wwf 取代的事实是真实的。它们之间的目标非常不同，drools 与 biztalk 相比，而不是与 wwf 相比，原因，两者都使用相同的算法（rete）！

现在，使用 drools 是另外一回事，biztalk 也可以作为 ESB，drools 可以做到吗？

# asp.net-mvc - 回发不适用于 ASP.NET 路由（视图状态 MAC 验证失败）

> ID：230014
> 
> 赞同：5
> 
> 时间：2008-10-23T14:45:01.590
> 
> 标签：asp.net-mvc, routing, viewstate, mac-address

我正在使用带有经典 WebForms 的 ASP.NET 3.5 SP1 System.Web.Routing，如[http://chriscavanagh.wordpress.com/2008/04/25/systemwebrouting-with-webforms-sample/中所述](http://chriscavanagh.wordpress.com/2008/04/25/systemwebrouting-with-webforms-sample/)

**一切正常**，我有自定义的 SEO 网址，甚至回发也可以。**但是有一种情况，回发总是失败**，我得到：

*视图状态 MAC 验证失败。如果此应用程序由 Web Farm 或集群托管，请确保配置指定相同的 validationKey 和验证算法。AutoGenerate 不能在集群中使用。*

这是重现错误的场景：

1.  使用按钮创建标准 webform mypage.aspx
2.  创建一个将“a/b/{id}”映射到“~/mypage.aspx”的路由
3.  当您执行该站点时，您可以浏览[http://localhost:XXXX/a/b/](http://localhost:XXXX/a/b/something)页面工作的东西。但是当您按下按钮时，您会收到错误消息。当 Route 只是“a/{id}”时，不会发生错误。

它似乎与url中的子路径数有关。如果至少有 2 个子路径，则视图状态验证失败。

即使 EnableViewStateMac="false" 也会出现错误。

有任何想法吗？它是一个错误吗？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T16:22:03.463

我通过让我的视图用户控件继承自此类而不是`ViewUserControl<T>`（它是 RenderView 的一种补丁）来解决此问题。它对我有用，希望它也对你有用。

```
public class ViewUserControlWithoutViewState<T> : ViewUserControl<T> where T : class {
    protected override void LoadViewState(object savedState) {}

    protected override object SaveControlState() {
        return null;
    }

    protected override void LoadControlState(object savedState) {}

    protected override object SaveViewState() {
        return null;
    }

    /// <summary>
    /// extracted from System.Web.Mvc.ViewUserControl
    /// </summary>
    /// <param name="viewContext"></param>
    public override void RenderView(ViewContext viewContext) {
        viewContext.HttpContext.Response.Cache.SetExpires(DateTime.Now);
        var containerPage = new ViewUserControlContainerPage(this);
        ID = Guid.NewGuid().ToString();
        RenderViewAndRestoreContentType(containerPage, viewContext);
    }

    /// <summary>
    /// extracted from System.Web.Mvc.ViewUserControl
    /// </summary>
    /// <param name="containerPage"></param>
    /// <param name="viewContext"></param>
    public static void RenderViewAndRestoreContentType(ViewPage containerPage, ViewContext viewContext) {
        string contentType = viewContext.HttpContext.Response.ContentType;
        containerPage.RenderView(viewContext);
        viewContext.HttpContext.Response.ContentType = contentType;
    }

    /// <summary>
    /// Extracted from System.Web.Mvc.ViewUserControl+ViewUserControlContainerPage
    /// </summary>
    private sealed class ViewUserControlContainerPage : ViewPage {
        // Methods
        public ViewUserControlContainerPage(ViewUserControl userControl) {
            Controls.Add(userControl);
            EnableViewState = false;
        }

        protected override object LoadPageStateFromPersistenceMedium() {
            return null;
        }

        protected override void SavePageStateToPersistenceMedium(object state) {}
    }
} 
```

前段时间我[在博客上写过这个。](http://bugsquash.blogspot.com/2009/02/aspnet-mvc-postback-support.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T16:18:32.803

Microsoft Connect 上的此问题：

[http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=393619](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=393619)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T22:02:39.420

我还在 asp.net mvc beta 中发现了这个错误。它可以非常重现。使用默认模板创建asp.net mvc应用程序后，在设计视图的home.aspx页面中添加一个asp:button控件，按f5，主页正常显示。单击按钮，将显示此错误。对mvc源码进行了一些调试，发现是site.master页面中的ViewUserControl引起的，只需注释掉<%Html.RenderPartial("LoginUserControl"); %>，那么点击事件就可以正常处理了。

我还发现像 enableViewStateMac="false" enableEventValidation="false" viewStateEncryptionMode="Never" 这样的设置没有用。

在 mvc 源代码中，以下部分处理 ViewUserControl 渲染

公共虚拟无效渲染视图（ViewContext viewContext）{

```
// TODO: Remove this hack. Without it, the browser appears to always load cached output
viewContext.HttpContext.Response.Cache.SetExpires(DateTime.Now);
**ViewUserControlContainerPage containerPage = new ViewUserControlContainerPage(this);**
// Tracing requires Page IDs to be unique.
ID = Guid.NewGuid().ToString();
containerPage.RenderView(viewContext); 
```

}

私有密封类 ViewUserControlContainerPage : ViewPage {

```
public ViewUserControlContainerPage(ViewUserControl userControl) {
    Controls.Add(userControl);
} 
```

}

ViewUserControl 始终呈现在新创建的容器页面中，此页面不会选择您的设置。事实上，如果进入本节，手动将 container.enableViewStateMac 更改为 false，确实有助于消除错误。所以解决它的唯一方法是要求微软更改 mvc 代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T03:44:27.183

我有同样的问题，我有一些流氓

```
<form></form> 
```

标签，一旦我将它们从我的页面中删除，错误就不再出现了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-27T13:33:17.407

只需尝试清除本地计算机上的 cookie。有同样的问题，这有帮助。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-23T14:47:58.013

您是否将 Safari 用作浏览器？如果是这样，那么这可能是大浮动的问题。去掉那个浮子，一切都会好起来的。

# asp-classic - 错误：HTTP 标头已写入客户端浏览器

> ID：230025
> 
> 赞同：3
> 
> 时间：2008-10-23T14:48:30.163
> 
> 标签：asp-classic, http-headers, response.redirect

我收到此错误响应对象错误“ASP 0156：80004005”

标头错误

/ordermgmt/updateorderstatus.asp，第 1390 行

HTTP 标头已写入客户端浏览器。在写入页面内容之前，必须进行任何 HTTP 标头修改。

我把 Response.Buffer=true; 仍然显示错误。

我已经把响应，重定向@这个行号，这将被执行多次（它在一个循环中）。，在第一次迭代之后它显示这个错误

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T15:04:10.710

是的，伙计们，它的固定。在 Response.Buffer 之前，我包含了另一个文件。现在我将其更改为 Response.Buffer=True 行下方。它现在可以工作了。谢谢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T14:51:59.957

检查您根本没有输出任何东西——即使是在您的开始 ASP 标记之前的空行也会导致此问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T14:51:20.190

第一个 Response.Redirect 更改标头（并且可能强制刷新，因为使用重定向，可能没有内容）。

第二个 Response.Redirect 再次更改标头（可能是同一件事，但这没关系，因为标头是在 Flush() 期间写入的）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-25T06:28:10.003

您必须在特定页面上启用缓冲，然后您可以删除此错误，例如：

`<% Response.Buffer = True %>`

在 ASP 表单之上

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-22T17:36:17.270

如果您使用的是 Response.Flush()，这同样适用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-27T17:43:49.523

在 IIS > ASP > Storage enabled 中设置属性 storage enabled = true

# c# - 网格视图 ASP .NET 中标题文本的垂直显示

> ID：230035
> 
> 赞同：4
> 
> 时间：2008-10-23T14:50:20.847
> 
> 标签：c#, asp.net

有没有办法垂直显示网格视图的 headerText？

[http://img371.imageshack.us/img371/4813/testyk6.jpg](http://img371.imageshack.us/img371/4813/testyk6.jpg)

我希望上面的链接有效

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:01:44.490

我相信你必须使用图像。要么在设计时创建，要么使用 HttpHandler 在运行时生成图像（如果它们需要是动态的）。使您的所有字段都使用 TemplateFields 并将图像放在 HeaderTemplate 中。有点乏味，但这是我能想到的唯一方法。也许一些第三方网格控件可以处理这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T15:05:18.040

Silverlight 可以做到这一点（我敢肯定，Flash 也可以）。CSS3 将支持它。但是图形文本是现在要走的路。

您可以使用 CSS 中的多种文本隐藏技术中的任何一种来为可访问的浏览器显示文本，同时为有视力的用户显示图形（文本垂直排列）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T16:24:59.847

我已经使用以下 CSS 完成了 IE，尽管它可能仅限于浏览器、版本等......

写作模式：tb-rl；过滤器：翻转翻转

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T15:11:13.100

[Stu Nicholls](http://www.cssplay.co.uk/menus/vertical.html)有一个有趣的 HTML/CSS 技术，虽然 HTML 有点冗长。但是，它不会执行您要查找的单词轮换。只是抛出另一个选择。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T15:20:49.897

如果您不介意仅使用 IE 的解决方案，您可以使用 IE 支持的一些 css 过滤器。像这样的东西：

```
<div style="width:100%; filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);">
    This text is rotated 90 degrees.
</div> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-24T11:50:18.043

在 IE7+ 中，您可以使用 DX 转换：

```
writing-mode: tb-rl;
filter: flipv fliph; 
```

在较旧的 IE 中（对于仍然坚持使用它的可怜的灵魂）：

```
filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3); 
```

在 Safari/Chrome（基于任何 webkit）中，您可以使用转换：

```
-webkit-transform: rotate(270deg); 
```

最新的 FX 版本有一个等价物：

```
-moz-transform: rotate(270deg); 
```

但这还不是主流。

我一直在尝试用图形文本来做到这一点，但有[一些问题](https://stackoverflow.com/questions/388677)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-12T19:11:55.747

我在每个字母之间使用了一个 break (br) 命令

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-25T12:56:45.193

```
/*Do this in a loop for each header cell so Cells[0] to cells[however many] and however long the string is so use length properties to get the actual length of the text string */ 

protected void GridView1_SelectedIndexChanged(object sender, EventArgs e)
        {
         StringBuilder vtxt = new StringBuilder();
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(0,1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(1, 1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(2, 1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(3, 1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(4, 1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(5, 1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(6, 1));
            vtxt.Append("<br />");
            vtxt.Append(GridView1.HeaderRow.Cells[0].Text.ToString().Substring(7, 1));

            GridView1.HeaderRow.Cells[2].Text = vtxt.ToString();
        } 
```

# java - 使用 Ant 预编译 JSP 的最佳方法是什么

> ID：230037
> 
> 赞同：5
> 
> 时间：2008-10-23T14:50:29.473
> 
> 标签：java, oracle, jsp, ant

我试图找出使用 Ant 预编译将部署到 Oracle 应用程序服务器的 JSP 的最佳方法。即使我正在部署到 Oracle 应用服务器，我也想避免使用 Oracle 版本的 Ant。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-25T01:33:10.287

在 ORACLE_HOME/j2ee/home/jsp/bin/ojspc 的 oc4j 安装中可以使用 Oracle 的 JSP 编译器

假设您的类路径在您将运行的 compand 行中是正确的：

ojspc your.war

战争将得到更新，并在包含预编译 JSP 的 WEB-INF/lib 中放置一个 jar。请注意，如果您预编译 JSP，您还应该将 MAIN_MODE 设置为“JUSTRUN”，以获得预编译 JSP 的额外性能优势。JUSTRUN 设置正如它所暗示的那样，OC4J 容器将不再检查更新的 .jsp 文件。

```
<servlet>
    <servlet-name>jsp</servlet-name>
    <servlet-class>oracle.jsp.runtimev2.JspServlet</servlet-class>
    <init-param>
      <param-name>main_mode</param-name>
      <param-value>justrun</param-value>
    </init-param>
</servlet> 
```

一旦您对从命令行调用 ojspc 感到满意，您就可以开始使用 Oracle 提供的 ANT 任务了。

**ANT内**

```
<oracle:compileJsp file="dist/war/before-${app}war"
        verbose="false"
        output="dist/war/${app}.war" /> 
```

**您的项目标签应引用 oracle 任务：**

```
<project name="your-name" default="compile" basedir="."  xmlns:oracle="antlib:oracle">
...
</project> 
```

**更新 02.22.2011** 您也可以直接使用 ojspc jar 并避免尝试配置 oracle:compileJsp 任务，下面的代码需要一个 war 文件并在其中预编译 JSPS。

```
 <!-- Now Precompile the War File (see entry in <project> tag ) -->
    <java jar="${env.ORACLE_HOME}/j2ee/home/ojspc.jar" classpathref="jspPreCompileClassPath" fork="true">
        <arg value="-addClasspath"/>
        <arg pathref="classpath"/>
        <arg line="'${dist}/war/a-war-file.war'"/>
    </java> 
```

jspPreCompileClassPath 定义如下所示：

```
 <path id="jspPreCompileClassPath">
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/pcl.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/ojsp.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/oc4j-internal.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/servlet.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/commons-el.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/bcel.jar"/>
    <path location="${env.ORACLE_HOME}/lib/xmlparserv2.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/lib/oc4j-schemas.jar"/>
    <path location="${env.ORACLE_HOME}/j2ee/home/jsp/lib/taglib/ojsputil.jar"/>
  </path> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T15:12:13.067

我不确定您所说的 Oracle 版本的 Ant 是什么意思，但据我了解，您将需要 oracle 的 ant 任务来完成这项工作。[这个](http://download-west.oracle.com/docs/cd/B32110_01/web.1013/b28961/ojspc.htm)页面解释了如何做到这一点。您将使用从 apache 网站下载的 apache ant，但您需要使用 Oracle 的 Oracle ant 任务库来为 Oracle 预编译 JSP。

# svn - 强制在 TortoiseSVN 中手动合并某些文件

> ID：230044
> 
> 赞同：4
> 
> 时间：2008-10-23T14:52:40.780
> 
> 标签：svn, tortoisesvn

**将分支合并回主树时，是否有某种方法可以强制某些文件不自动合并（强制我管理合并）？**

例如，我的 web.config 文件具有基于我是在开发系统还是生产系统中的特定路径。因此，当我需要将我的 dev 分支合并回 main 时，我不想修改某些标签，但可能需要更新其他信息。

问题是合并可能会自动更新需要保持不变的设置。我可以很容易地恢复到原来的状态，但是任何新设置都会丢失。在这种情况下，对我来说，似乎最简单的处理方法是手动合并更改。

由于我是 Tortoise 和 SVN 的新手，因此我可能是从错误的方向来的。

除了下面有一些很好答案的配置示例。**有没有办法强制在合并期间手动处理所有文件？**似乎应该有一个可以应用于文件的标志，以简单地使其看起来与标记的文件存在冲突并相应地处理合并。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:06:45.540

我见过的一种处理方法是：

1.  将您的配置保存在单独的目录中（dev、uat、prod 等）
2.  将这些签入到 SVN
3.  修改您的构建过程，以便它根据命令行参数将适当的配置复制到 bin/ 目录中

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T15:08:28.923

我建议根据您的构建或部署过程来查看问题，而不是版本控制过程。

就我个人而言，我已经将 ANT 与平台/环境特定属性一起使用，以允许 SVN（或任何其他 SCMS）中的一个配置文件在本地环境中被覆盖，或者具有在构建期间由平台/环境特定值替换的*占位符*.

我不相信有一种简单或自动化的方法可以完成您在 TortoiseSVN 中的要求

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T15:26:15.940

如果您不关心共享配置信息（例如数据库访问），您可以轻松地将 dev/prod 特定部分包装在 if->then 中。

```
if (production) {
   db = prod
} else {
   db = dev
} 
```

我见过一些确定环境的方法，从机器的物理名称（有利于限制未经授权的代码使用）到 IP 地址、主机名等。

提供一点安全性并且不会*过多*影响构建过程的替代方法是使用分支。将生产 web.config 保存在其自己的具有匹配目录结构的分支中，并将其合并到具有最新生产就绪代码的第三个分支中。所以：

```
/trunk <-- development (or its own branch)
/branches/
/branches/production-pre <-- latest stable
/branches/production-config <-- web.config and related only
/branches/production-post <-- final merged 
```

是的，它在部署上投入了更多工作，但如果这是所需的效果，它确实提供了安全性。

# testing - 你在 Scrum 中验证一个任务多少次？

> ID：230048
> 
> 赞同：2
> 
> 时间：2008-10-23T14:53:18.860
> 
> 标签：testing, scrum

在我们的 Scrum 板上，任务从“待办事项”开始，转到“进行中”，当您完成任务后，它们会转到“待验证”，然后才进入“完成”。“待验证”列是当您完成一项任务时，其他人可以查看、测试和评论它。

事实证明，这有助于错误、更好的代码等。

对于有类似做法的人：在开发人员解决了评论/错误之后，您是否再次验证它，或者您是否假设问题已经解决并将任务移至“完成”？

我希望这很清楚，并想听听您的想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T14:58:02.220

在我的期限内，错误的修复有 50 - 75% 的机会引入新的错误，特别是如果代码没有被测试用例覆盖。我肯定会再次验证它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T15:02:48.950

这个问题不是 Scrum 特有的，我在敏捷流程之外也看到过这个问题。

答案原来是：这取决于验证中提出的问题。如果提出了一些小问题，并且负责的开发人员足够资深，那么相信他会在第一时间解决问题。但是，如果进行验证的人认为项目过于复杂，或者 Scrum Master 缺乏信心相信开发人员第二次就能把它做好，那么你就把便利贴移回 In Progress。

一个简单的拼写错误就是你不去检查的错误的一个很好的例子。当有许多相互依赖的边界条件时，您将再次检查的一个很好的例子是边界条件中的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T15:03:33.723

**在独立（即不是由修复它的人）验证之前，**切勿假设该问题已得到解决。****

 *** * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T15:14:32.280

我们没有要验证的列。**任务在执行和**测试之前一直在进行。无法完成未经测试的任务，为什么其他人要对其进行测试，向程序员报告，然后程序员必须修复它？这只会增加工作流程的延迟。程序员应该测试自己的代码，尽可能为它编写单元测试，并尽可能将其集成到应用程序中，并在此处作为自然工作流程的一部分对其进行测试。这样他就可以找到自己的错误并立即修复它们。当他将任务设置为“完成”时，他不仅确信已完全实施该任务，而且该任务没有错误。

好吧，我们都知道，这意义不大。有时错误会在很久以后才被发现，但这些错误并不是那么明显，通常它们的修复将是它自己的任务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T13:27:18.863

在我参与的项目中（敏捷和非敏捷），错误修复总是由其他人验证。经常会引入新的错误，因此需要围绕修复进行一些探索。我什至看到在构建中忘记了一些调试代码——一切正常，但额外的文件不知从何而来。

也有可能开发人员没有找到错误的所有路径，或者错误报告太不清楚以至于开发人员进行了错误的修复 - 例如，如果某些内容被误解，并且正确的功能被报告为错误。

To ensure things stay done when they are done, tests for the fix should also be added to your automated tests - otherwise some embarrassing corner-case bug will re-appear months later.

# php - 就内存使用而言，PHP 作为 thttpd 模块 vs CGI

> ID：230054
> 
> 赞同：3
> 
> 时间：2008-10-23T14:55:13.567
> 
> 标签：php, module, cgi, sapi, thttpd

我打算在嵌入式环境中使用 php。我们当前的网络服务器是 thttpd。我现在正在考虑两种选择：是将其作为 cgi 还是作为 SAPI 模块运行。我知道 cgi 在安全性方面具有优势。但是如果我们将 php 用作 cgi，则应该为每个请求将 php 的实例加载到内存中。

我尝试将它编译为 thttpd 的 SAPI 模块，并且我观察到 thttpd 的内存使用量，特别是 rss，不会随着请求数量的增加而增加。

谁能解释 thttpd 如何加载 php？它是否只加载一次并在 thttpd 运行时一直驻留在内存中？如果是这样，我们可以将其视为 cgi 的替代方案。

它是否执行多线程，即如果同时有多个http请求？还是一次处理一个请求？

是否有一个很好的文档来讨论 php 作为 thttpd 的模块的行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T08:13:07.373

我没有使用 thttpd 的经验，但这里有一些提示：

*   PHP 引擎是线程安全的，但某些扩展不是，因此人们通常会回避在多线程环境中使用它，而是采用单进程 - 单请求方法
*   是的，通常网络服务器模块（如 Apache mod_* 的东西）通过保持常驻来工作，但 PHP 的大减速是它需要为每个请求解析源文件（或者甚至是多个源文件，如果你使用 include / require）。[您可以通过使用APC](http://www.php.net/apc)之类的东西来减少这种情况，它缓存文件的解析版本
*   还有一个称为 FastCGI 的协议，您可能想看看它——它基本上是模块和 CGI​​ 解决方案之间的交叉——它启动了几个进程，每个进程承载一个 CGI 问题的实例（在这种情况下是 PHP ) 并使用它们来处理请求。实例被回收（即它们可以一个接一个地处理多个请求）。

# sql-server-2005 - 在 SQL Server 2005 中使用 ROW_NUMBER() OVER () 对不同列进行排序的分页查询

> ID：230058
> 
> 赞同：8
> 
> 时间：2008-10-23T14:56:26.997
> 
> 标签：sql-server-2005, pagination

假设我正在使用 Northwind 数据库，并且我想通过包含以下参数的存储过程运行查询：

*   `@Offset`指示分页从哪里开始，
*   `@Limit`指示页面大小，
*   `@SortColumn`指示用于排序目的的列，
*   `@SortDirection`, 表示升序或降序排序。

这个想法是在数据库上进行分页，因为结果集包含数千行，所以缓存不是一种选择（并且使用 VIEWSTATE 甚至不被认为是，IMO，很烂）。

如您所知，SQL Server 2005 提供了函数[ROW_NUMBER](http://msdn.microsoft.com/en-us/library/ms186734.aspx)，它*返回结果集分区内行的序号，每个分区的第一行从 1 开始*。

我们需要对每个返回的列（本例中为 5 个）进行排序，并且动态 SQL 不是一个选项，因此我们有两种可能性：使用大量`IF ... ELSE ...`且有 10 个查询，这很难维护，或者具有如下查询：

```
WITH PaginatedOrders AS (
    SELECT
        CASE (@SortColumn + ':' + @SortDirection)
            WHEN 'OrderID:A' THEN ROW_NUMBER() OVER (ORDER BY Orders.OrderID ASC)
            WHEN 'OrderID:D' THEN ROW_NUMBER() OVER (ORDER BY Orders.OrderID DESC)
            WHEN 'CustomerID:A' THEN ROW_NUMBER() OVER (ORDER BY Orders.CustomerID ASC)
            WHEN 'CustomerID:D' THEN ROW_NUMBER() OVER (ORDER BY Orders.CustomerID DESC)
            WHEN 'EmployeeID:A' THEN ROW_NUMBER() OVER (ORDER BY Orders.EmployeeID ASC)
            WHEN 'EmployeeID:D' THEN ROW_NUMBER() OVER (ORDER BY Orders.EmployeeID DESC)
            WHEN 'OrderDate:A' THEN ROW_NUMBER() OVER (ORDER BY Orders.OrderDate ASC)
            WHEN 'OrderDate:D' THEN ROW_NUMBER() OVER (ORDER BY Orders.OrderDate DESC)
            WHEN 'ShippedDate:A' THEN ROW_NUMBER() OVER (ORDER BY Orders.OrderID ASC)
            WHEN 'ShippedDate:D' THEN ROW_NUMBER() OVER (ORDER BY Orders.OrderID DESC)
        END AS RowNumber,
        OrderID, CustomerID, EmployeeID, OrderDate, ShippedDate
    FROM Orders
    -- WHERE clause goes here
)
SELECT
    RowNumber, OrderID, CustomerID, EmployeeID, OrderDate, ShippedDate,
    @Offset, @Limit, @SortColumn, @SortDirection
FROM PaginatedOrders
WHERE RowNumber BETWEEN @Offset AND (@Offset + @Limit - 1)
ORDER BY RowNumber 
```

我已经多次尝试查询，使用不同的参数，它的性能实际上非常好，但它仍然看起来可能会以其他方式进行优化。

这个查询有什么问题，或者你会这样做吗？你提出不同的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T15:21:10.707

简单的：

```
SELECT
  OrderID, CustomerID, EmployeeID, OrderDate, ShippedDate,
  @Offset, @Limit, @SortColumn, @SortDirection
FROM
  Orders
WHERE
  ROW_NUMBER() OVER 
  (
    ORDER BY
      /* same expression as in the ORDER BY of the whole query */
  ) BETWEEN (@PageNum - 1) * @PageSize + 1 AND @PageNum * @PageSize 
  /* AND more conditions ... */
ORDER BY
  CASE WHEN @SortDirection = 'A' THEN
    CASE @SortColumn 
      WHEN 'OrderID'    THEN OrderID
      WHEN 'CustomerID' THEN CustomerID
      /* more... */
    END
  END,
  CASE WHEN @SortDirection = 'D' THEN
    CASE @SortColumn 
      WHEN 'OrderID'    THEN OrderID
      WHEN 'CustomerID' THEN CustomerID
      /* more... */
    END 
  END DESC 
```

如果选择 ASC 顺序，这将按 NULL (DESC) 排序，反之亦然。

让 ROW_NUMBER() 函数处理相同的 ORDER BY 表达式。

# c - 检查 C 中是否存在文件的最佳方法是什么？

> ID：230062
> 
> 赞同：515
> 
> 时间：2008-10-23T14:57:24.967
> 
> 标签：c, filesystems, cross-platform

有没有比简单地尝试打开文件更好的方法？

```
int exists(const char *fname)
{
    FILE *file;
    if ((file = fopen(fname, "r")))
    {
        fclose(file);
        return 1;
    }
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：707
> 
> 时间：2008-10-23T14:59:32.250

查找`access()`函数，在`unistd.h`. 您可以将您的功能替换为

```
if( access( fname, F_OK ) == 0 ) {
    // file exists
} else {
    // file doesn't exist
} 
```

您还可以使用`R_OK`,`W_OK`和`X_OK`代替`F_OK`来检查读取权限，写入权限和执行权限（分别）而不是存在，您可以将它们中的任何一个放在一起（即使用 来检查读取*和*写入权限`R_OK|W_OK`）

*更新*：请注意，在 Windows 上，您不能使用`W_OK`可靠地测试写入权限，因为访问功能不考虑 DACL。`access( fname, W_OK )`可能会返回 0（成功），因为该文件没有设置只读属性，但您仍然可能没有写入该文件的权限。

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2008-10-23T15:00:53.727

像这样使用`stat`：

```
#include <sys/stat.h>   // stat
#include <stdbool.h>    // bool type

bool file_exists (char *filename) {
  struct stat   buffer;   
  return (stat (filename, &buffer) == 0);
} 
```

并这样称呼它：

```
#include <stdio.h>      // printf

int main(int ac, char **av) {
    if (ac != 2)
        return 1;

    if (file_exists(av[1]))
        printf("%s exists\n", av[1]);
    else
        printf("%s does not exist\n", av[1]);

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2008-10-23T17:14:05.050

通常，当您要检查文件是否存在时，是因为如果不存在则要*创建*该文件。 **如果您不想创建该文件，** [Graeme Perrow 的答案](https://stackoverflow.com/questions/230062/whats-the-best-way-to-check-if-a-file-exists-in-c/230068#230068)很好，但如果您这样做，它很容易受到竞争条件的影响：另一个进程可能会在您检查它是否存在之间创建该文件，然后您实际上打开它来写入它. （别笑……如果创建的文件是符号链接，这可能会带来**不好的安全隐患！）**

 ****如果要检查是否存在*并*在文件不存在时**以原子**方式创建文件以便没有竞争条件，请使用以下命令：

```
#include <fcntl.h>
#include <errno.h>

fd = open(pathname, O_CREAT | O_WRONLY | O_EXCL, S_IRUSR | S_IWUSR);
if (fd < 0) {
  /* failure */
  if (errno == EEXIST) {
    /* the file already existed */
    ...
  }
} else {
  /* now you can use the file */
} 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2008-10-23T14:59:16.070

是的。使用`stat()`. 请参阅手册页[`stat(2)`](http://linux.die.net/man/2/stat)。

`stat()`如果文件不存在将失败，否则很可能成功。如果它确实存在，但您对它所在的目录没有读取权限，它也会失败，但在这种情况下，任何方法都会失败（如何根据访问权限检查您可能看不到的目录的内容？简单地说，你不能）。

哦，正如其他人提到的，您也可以使用`access()`. 但是我更喜欢`stat()`，好像文件存在一样，它会立即为我提供很多有用的信息（上次更新时间、文件大小、拥有文件的所有者和/或组、访问权限等）。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2015-04-08T09:08:01.523

```
FILE *file;
    if((file = fopen("sample.txt","r"))!=NULL)
        {
            // file exists
            fclose(file);
        }
    else
        {
            //File not found, no memory leak since 'file' == NULL
            //fclose(file) would cause an error
        } 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-23T15:07:01.343

从 Visual C++ 帮助中，我倾向于使用

```
/* ACCESS.C: This example uses _access to check the
 * file named "ACCESS.C" to see if it exists and if
 * writing is allowed.
 */

#include  <io.h>
#include  <stdio.h>
#include  <stdlib.h>

void main( void )
{
   /* Check for existence */
   if( (_access( "ACCESS.C", 0 )) != -1 )
   {
      printf( "File ACCESS.C exists\n" );
      /* Check for write permission */
      if( (_access( "ACCESS.C", 2 )) != -1 )
         printf( "File ACCESS.C has write permission\n" );
   }
} 
```

还值得注意的模式值：`_access(const char *path,`**`int mode`**`)`

*   00：仅存在

*   02：写权限

*   04：读取权限

*   06：读写权限

`fopen`因为在文件存在但无法按要求打开的情况下，您可能会失败。

编辑：只需阅读 Mecki 的帖子。 `stat()`看起来确实是一个更整洁的方法。哼哼。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-12-09T17:14:28.353

我认为在中找到的[access()](http://www.gnu.org/software/libc/manual/html_node/Testing-File-Access.html)函数`unistd.h`是一个不错的选择`Linux`（您也可以使用[stat](http://pubs.opengroup.org/onlinepubs/009695399/functions/stat.html)）。

你可以像这样使用它：

```
#include <stdio.h>
#include <stdlib.h>
#include<unistd.h>

void fileCheck(const char *fileName);

int main (void) {
    char *fileName = "/etc/sudoers";

    fileCheck(fileName);
    return 0;
}

void fileCheck(const char *fileName){

    if(!access(fileName, F_OK )){
        printf("The File %s\t was Found\n",fileName);
    }else{
        printf("The File %s\t not Found\n",fileName);
    }

    if(!access(fileName, R_OK )){
        printf("The File %s\t can be read\n",fileName);
    }else{
        printf("The File %s\t cannot be read\n",fileName);
    }

    if(!access( fileName, W_OK )){
        printf("The File %s\t it can be Edited\n",fileName);
    }else{
        printf("The File %s\t it cannot be Edited\n",fileName);
    }

    if(!access( fileName, X_OK )){
        printf("The File %s\t is an Executable\n",fileName);
    }else{
        printf("The File %s\t is not an Executable\n",fileName);
    }
} 
```

你得到以下输出：

```
The File /etc/sudoers    was Found
The File /etc/sudoers    cannot be read
The File /etc/sudoers    it cannot be Edited
The File /etc/sudoers    is not an Executable 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-04-08T06:14:20.627

您可以使用 realpath() 函数。

```
resolved_file = realpath(file_path, NULL);
if (!resolved_keyfile) {
   /*File dosn't exists*/
   perror(keyfile);
   return -1;
} 
```

# perl - Perl 有哪些代码覆盖工具？

> ID：230065
> 
> 赞同：19
> 
> 时间：2008-10-23T14:58:56.260
> 
> 标签：perl, code-coverage, cpan

Perl 有没有好的（最好是免费的）代码覆盖工具？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-23T15:05:21.253

像往常一样，CPAN 是你的朋友：看看[Devel::Cover](https://metacpan.org/pod/Devel::Cover)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-23T15:20:51.317

是的，[Devel::Cover](https://metacpan.org/pod/Devel::Cover)是要走的路。

如果你开发一个模块，并使用[Module::Build](https://metacpan.org/pod/Module::Build)来管理安装，你甚至有一个`testcover`目标：

```
 perl Build.PL
 ./Build testcover 
```

它运行整个测试套件，并在漂亮的 HTML 中生成一个组合覆盖率报告，您可以在其中浏览您的模块并查看它们的覆盖率。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-24T07:23:52.713

如前所述，Devel::Cover 是您的朋友，但您也需要在 google 上搜索它。它的文档有点稀疏，如果你彻底改变你的环境，你需要重新安装它，因为它构建了 Devel::Cover::Inc，在你安装它时会从你的环境中提取大量信息。这给我们在工作中带来了很多问题，因为我们有一个共享的 CPAN 环境，如果一个开发人员安装了 Devel::Cover 并且另一个开发人员尝试运行它，奇怪（和不正确）的结果很常见。

如果您使用此模块，还请查看[Devel::CoverX::Covered](https://metacpan.org/pod/Devel::CoverX::Covered)。该模块将捕获 Devel::Cover 丢弃的大部分信息。它非常方便。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-25T08:59:47.297

Moritz 讨论了使用 Module::Build 构建的模块如何轻松使用 Devel::Cover。

对于使用 ExtUtils::MakeMaker 的模块，存在一个扩展模块来调用相同的功能。在调用 WriteMakefile() 之前添加以下代码：

```
eval "use ExtUtils::MakeMaker::Coverage";
if( !$@ ) {
    print "Adding testcover target\n";
} 
```

... 将允许运行命令“make testcover”并让 Devel::Cover 发挥它的魔力。

# asp.net-mvc - IModelBinder 和 ASP.NET MVC 测试版

> ID：230077
> 
> 赞同：5
> 
> 时间：2008-10-23T15:03:40.197
> 
> 标签：asp.net-mvc, imodelbinder

有没有人有关于asp.net mvc beta 中新的IModelBinder 教程的链接？

我无法正确理解它，已经发生了很多变化。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-09T01:39:13.360

正如 Haacked 指出的，[DefaultModelBinder](http://aspnet.codeplex.com/SourceControl/changeset/view/23011#266460)的来源是一个很好的资源。很高兴在[http://www.asp.net/mvc](http://www.asp.net/mvc)上看到相关教程（提示...提示...在 Haacked）。

为了您的方便，这里是相关来源的直接链接：http: [//aspnet.codeplex.com/SourceControl/changeset/view/23011#266460](http://aspnet.codeplex.com/SourceControl/changeset/view/23011#266460)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T21:17:45.980

看一下 DefaultModelBinder 的源码。这会给你一些线索。

# sql-server - ntext列中的数据长度？

> ID：230081
> 
> 赞同：49
> 
> 时间：2008-10-23T15:05:16.387
> 
> 标签：sql-server

如何找出 SQL 中 ntext 列中数据的长度/大小？- 它超过 8000 字节，所以我不能将它转换为 varchar。谢谢。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-23T15:08:51.340

使用[数据长度（）](http://msdn.microsoft.com/en-us/library/ms173486(SQL.90).aspx)

```
SELECT * FROM YourTable WHERE DataLength(NTextFieldName) > 0 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-24T08:27:03.913

线索就在问题中：使用`DATALENGTH()`. 请注意，它具有不同的行为`LEN()`：

```
SELECT LEN(CAST('Hello   ' AS NVARCHAR(MAX))), 
       DATALENGTH(CAST('Hello   ' AS NVARCHAR(MAX))), 
       DATALENGTH(CAST('Hello   ' AS NTEXT)) 
```

返回 5、16、16。

换句话说，`DATALENGTH()`不删除尾随空格并返回字节数，而`LEN()`修剪尾随空格并返回字符数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-08-15T20:49:52.797

```
Select Max(DataLength([NTextFieldName])) from YourTable 
```

# java - Spring Framework 和其他 IoC 容器的内部结构

> ID：230084
> 
> 赞同：23
> 
> 时间：2008-10-23T15:05:36.137
> 
> 标签：java, spring, jvm, internals

我使用 spring 已经有一段时间了，但我一直想知道它是如何工作的，更具体地说，它们如何加载和编织仅使用接口或*@annotation*标记的 bean/类。

对于 xml 声明，很容易看到 spring 如何预处理我的 bean（它们是在 spring 读取的 xml 上下文中声明的），但是对于仅用注释标记的类，我看不到它是如何工作的，因为我没有将任何代理传递给 jvm 左右。

我相信有一些 Java/JVM 钩子允许您通过某种标准预处理类，但我无法在文档中找到任何内容。

有人可以指点我一些文档吗？这与*java.lang.instrument.ClassFileTransformer* API 有关吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-23T20:50:20.230

实际上，默认情况下，Spring 不会对 XML 和注解配置的 bean 进行任何字节码后处理。相反，相关的 bean 被包装到动态代理中（参见 `java.lang.reflect.Proxy`Java SDK 中的例子）。动态代理包装您使用的实际对象并拦截方法调用，从而允许应用 AOP 建议。不同之处在于代理本质上是由框架创建的新的人工类，而编织/字节码后处理改变了现有的。如果不使用您提到的 Instrumentation API，后者是不可能的。

至于注解，`<context:component-scan>`标签的实现将扫描所有带有 Spring 注解的类的类路径，并为它们创建 Spring 元数据占位符。之后，它们被视为通过 XML 配置（或者更具体地说，两者被视为相同）。

尽管 Spring 本身不进行字节码后处理，但如果代理不满足您的要求，您可以配置 AspectJ 编织代理，它应该可以与 Spring 正常工作。

# oracle - 网格控制随着时间的推移变慢

> ID：230085
> 
> 赞同：1
> 
> 时间：2008-10-23T15:05:39.320
> 
> 标签：oracle

我们使用 Grid Control 10.2.0.4，目录库数据库也在 10.2.0.4。似乎在一两个星期后，Web 界面的响应时间变得很差（导航到新页面需要 20 多秒，而通常是 2-3 秒）。我们发现克服它的唯一方法是重新启动目录数据库和 GC/OMS。警报日志中没有报告错误，只是速度慢得无法忍受。是否有任何使用 GC 的 Oracle DBA 看到了这一点（并希望找到解决方案）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-24T13:54:13.537

大约一个月前，我们迁移到了与您相同的版本，并且没有遇到您遇到的问题。至少现在还没有。你检查过 OMS 日志吗？是否有过多的 CPU 使用率和/或磁盘使用率？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T21:07:03.273

该问题似乎是 OMS 存在较大问题的征兆。直接原因似乎是 OMS_HOME/sysman/recv/clob 目录包含近 10 万个文件。为什么会发生这种情况是与 Oracle 的开放式 SR 的主题。在 Oracle 的指导下，我几乎删除了该目录中的所有内容，性能有了显着提高。

更新，2009 年 1 月 15 日：Oracle 已为此问题打开错误报告。运行 GC 10.2.0.4 的 Windows 平台上的任何人都应该密切关注此目录，如果它没有自动发生，请定期清除它。

# java - 将不同的 csv 文件保存为单个 Excel 工作簿中的不同工作表

> ID：230094
> 
> 赞同：3
> 
> 时间：2008-10-23T15:08:05.790
> 
> 标签：java, excel, csv

与这个[问题](https://stackoverflow.com/questions/59075/how-do-i-save-each-sheet-in-an-excel-workbook-to-seperate-csv-files-with-a-macro)相关，如何将许多不同的 csv 文件保存到一个 excel 工作簿中，每个 csv 一张表？我想知道如何在 Java 中以编程方式执行此操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:11:51.380

您需要某种形式的库来从 Java 访问 Excel。谷歌搜索打开了这个：

[http://j-integra.intrinsyc.com/support/com/doc/excel_example.html](http://j-integra.intrinsyc.com/support/com/doc/excel_example.html)

另一种方法是使用 Office 2003 中出现的 XML Excel 格式。您最终会得到一个 XML 文件，但您可以在 Excel 中打开它并查看不同的工作表。

[http://www.javaworld.com/javaworld/jw-07-2004/jw-0712-officeml.html](http://www.javaworld.com/javaworld/jw-07-2004/jw-0712-officeml.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T04:08:04.413

如果要开源，可以使用[POI 库生成 Excel 文件。](http://poi.apache.org/)

一个不错的 CSV 解析器是[Open CSV](http://opencsv.sourceforge.net/)

这应该为您尝试做的事情做好准备（基本上使用 CSV 解析器获取数据，然后将数据写入 XLS 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T15:27:59.070

看看 Aspose 产品，我以前在使用 Excel 时使用过它们，它们为我节省了大量的头痛和时间。Excel 有几个怪癖可以使导入和导出电子表格变得痛苦。

[假设细胞](http://www.aspose.com/categories/file-format-components/aspose.cells-for-.net-and-java/default.aspx)

# postscript - 使用 PostScript 交叉影线

> ID：230098
> 
> 赞同：3
> 
> 时间：2008-10-23T15:08:52.167
> 
> 标签：postscript

我正在寻找一种交叉影线各种基本形状的方法。是否有我找不到的填充样式或者我应该使用剪裁？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T15:30:02.157

检查第 4.9 章：PostScript 语言参考手册 v.3 的模式，可在 Adob​​e 网站上找到

# .net - .NET 十进制 = SQL 中的什么？

> ID：230105
> 
> 赞同：16
> 
> 时间：2008-10-23T15:11:18.277
> 
> 标签：.net, sql

SQL 中表示 .NET 中十进制的最佳数据类型是什么？

我们希望存储小数点后最多 9 位精度的小数，并希望在前端避免舍入错误等。

阅读有关数据类型的信息，在 .NET 中使用 Decimal 似乎是最佳选择，因为您不会出现舍入错误，尽管它比 Double 慢一点。

我们希望将其贯彻到数据库中，并希望在通过层移动数据时将转换问题降到最低。有什么建议么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2010-03-08T23:03:04.170

所以我们在 SQL Server 上做了一些测试。看起来 sql 类型`decimal`不能完全存储任何 .net 小数。

SQL Server 最多可以存储[38 位十进制数字](http://msdn.microsoft.com/en-us/library/ms187746.aspx)。那是小数点左右的位数的总和。您设置了一个“比例”，它告诉 SQL Server 为小数点右边的数字保留多少小数位数。如果您设置一个比例，那么它会从小数点左侧的位数中扣除。（精度 - 比例 = 小数点左侧的小数位数）

.NET 最多可以表示小数点右侧的 28 位和左侧的 29 位。这将要求 SQL Server 中的精度为 57，但可用的最大值为 38。

因此，如果您想获得尽可能高的*精度*并且您的数字足够小，那么您可以这样做：

```
decimal(38, 28) 
```

这将使您左边有 10 位数字，右边有 28 位数字。因此，任何大于 9999999999 的数字都无法表示，但在进行货币类型交易时不会丢失精度。

另一方面，如果您的数字*非常大*，您可以使用以下声明存储它们：

```
decimal(38, 9) 
```

这将让您存储 .net Decimal 可以存储的最大数字，即 29 位长。它只会给你留下 8 位小数的精度。

如果这些听起来都不吸引人，那么您可以将它们存储为`varchar`. 那将允许您保存任何 .net 小数，但它不会让您在 SQL 中对它们执行任何计算。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-23T15:14:00.440

我会在 SQL Server 中使用小数类型

查看[SQL Server 数据类型映射 (ADO.NET)](http://msdn.microsoft.com/en-us/library/cc716729.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T15:15:39.690

如果您使用的是 SQL Server，[此表](http://msdn.microsoft.com/en-us/library/ms131092.aspx)可能有助于数据类型映射。

# c# - 关于 ASP.NET 2.0 到 ASP.NET 3.5 MVC 差异的问题

> ID：230109
> 
> 赞同：3
> 
> 时间：2008-10-23T15:11:51.850
> 
> 标签：c#, sql, asp.net-mvc, ajax, visual-studio-2008

我们正在从没有测试的常规 2.0 网络表单转移到 TDD MVC

我正在寻找从 2.0 跳转到 3.5 MVC 的所有要求。

*   SQL Server 2000 是否适用于 .net 3.5？
*   MVC 框架是否随 .net 3.5 一起提供？
*   AJAX 如何处理所有这些东西？
*   视觉工作室团队套件值得花时间/金钱吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T15:19:23.567

ASP.NET MVC 是 ASP.NET 3.5 的扩展，它仍处于测试阶段，并且有声音说它将在今年年底之前可用。

对于您的其他问题： - .NET 3.5 在 SQL Server 2000 上运行良好 - MVC 框架不是 .NET 3.5 的一部分 - 对于将 AJAX 与 ASP.NET MVC 一起使用，最好看看 JQuery（或其他框架）。对 ASP.NET Ajax 的支持并不完全可用。

恕我直言，ASP.NET MVC 的真正优势是：

*   可测试性
*   可测试性:-)
*   生成您真正想要的 HTML 的能力！没有视图状态！没有其他噪音！:-)

顺便说一句，使用 MVC 跳转到 TDD 并不简单……它需要时间。

高温高压

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T15:28:24.610

要回答您的其他一些问题：

*视觉工作室团队套件值得花时间/金钱吗？*

你有多少？如果您是一家拥有大量预算和开发人员的大公司，并且您专注于 Microsoft 技术，那么我会说是的。如果您对这些问题中的任何一个回答“否”，我会选择开源路线（Svn 或 GIT、Cruise Control 或 Team City、MsBuild 等）

*我们正在从没有测试的常规 2.0 网络表单转移到 TDD MVC，我需要了解其中的内幕，因为我以前从未做过这样的跳跃（不是说它是一个巨大的跳跃，但我是一个刚刚大学毕业的小白程序员）。*

这是您学习 MVC 的好时机，因为您没有对 Web 表单知识进行深入投资，而 MVC 对于像您这样的人来说是一个更好的模型来掌握。TDD 不是你可以在一夜之间学会的东西，但坚持下去，你会因为它而成为一个更好的程序员。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T15:20:17.853

我绝不是 MVC 方面的专家，我自己刚刚开始使用它，但让我们看看我是否可以解决你的几个问题。

*   您绝对可以将 SQL 2000 与 .NET Framework 3.5 一起使用。我相信 SqlProvider 仍然可以使用它。（就个人而言，我认为至少在 2005 年工作更可取——我还没有在 2008 年工作过，所以我对此无话可说。）
*   3.5 和 Visual Studio 2008 都没有 MVC 框架。在[ASP.NET](http://www.asp.net/mvc/default.aspx?wwwaspnetrdirset=1)下载它。我相信它目前处于 beta 1。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T15:20:40.380

MVC 仍然是一个单独的下载。 [jQuery 已经宣布它将成为 MVC 框架的一部分](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx)。（还有 MS Ajax）

SQL Server 2000 只是您的持久性位置。它适用于任何 .Net 框架，并且不依赖于特定版本。

我认为，如果您从 Webforms 迁移到 MVC，那将更像是重写而不是转换。两者之间的发展存在很大差异，我认为跳跃比您预期的要大。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-26T06:09:24.033

Anybody aware of a best practices or example project out there that uses ASP.NET MVC and LLBLGEN (selfservicing or adaptor)? Possibly something similar to S#arp Architecture.

I'm new to MVC and I'm constrained to using LLBLGEN.

# string - Jython 拆分字符串

> ID：230111
> 
> 赞同：0
> 
> 时间：2008-10-23T15:12:04.313
> 
> 标签：string, jython

我正在尝试使用 Jython 操作字符串，我在下面包含了一个示例字符串：

这将是网站的标题 :: SiteName
这将是网站的标题 :: SiteName :: SiteName

如何删除“:: Sitename”或“:: SiteName :: SiteName”的所有实例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:40:19.047

与常规 Python 没有什么不同：

```
>>> str="This would be a title for a website :: SiteName"
>>> str.replace(":: SiteName","")
'This would be a title for a website '
>>> str="This would be a title for a website :: SiteName :: SiteName"
>>> str.replace(":: SiteName","")
'This would be a title for a website ' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-03T18:15:14.303

对于这样简单的示例，它是不必要的，但通常您可以使用`re`模块。

```
import re

sitename = "sitename" #NOTE: case-insensitive
for s in ("This would be a title for a website :: SiteName :: SiteName",
          "This would be a title for a website :: SiteName"):
    print(re.sub(r"(?i)\s*::\s*%s\s*" % sitename, "", s)) 
```

# java - 如何使用 Java 处理日历时区？

> ID：230126
> 
> 赞同：95
> 
> 时间：2008-10-23T15:15:48.877
> 
> 标签：java, calendar, timezone

我有一个来自我的应用程序的时间戳值。用户可以在任何给定的本地时区。

由于此日期用于假定给定时间始终为 GMT 的 WebService，因此我需要将用户的参数从（EST）转换为（GMT）。这是踢球者：用户忘记了他的 TZ。他输入了他想发送给 WS 的创建日期，所以我需要的是：

**用户输入：** 5/1/2008 6:12 PM (EST)
**WS 的参数需要是**：5/1/2008 6:12 PM (GMT)

我知道默认情况下 TimeStamps 总是应该在 GMT 中，但是在发送参数时，即使我从 TS（应该在 GMT 中）创建了我的日历，除非用户在 GMT 中，否则时间总是关闭的。我错过了什么？

```
Timestamp issuedDate = (Timestamp) getACPValue(inputs_, "issuedDate");
Calendar issueDate = convertTimestampToJavaCalendar(issuedDate);
...
private static java.util.Calendar convertTimestampToJavaCalendar(Timestamp ts_) {
  java.util.Calendar cal = java.util.Calendar.getInstance(
      GMT_TIMEZONE, EN_US_LOCALE);
  cal.setTimeInMillis(ts_.getTime());
  return cal;
} 
```

使用前面的代码，这就是我得到的结果（便于阅读的短格式）：

[2008 年 5 月 1 日晚上 11:12]

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-23T16:17:38.410

```
public static Calendar convertToGmt(Calendar cal) {

    Date date = cal.getTime();
    TimeZone tz = cal.getTimeZone();

    log.debug("input calendar has date [" + date + "]");

    //Returns the number of milliseconds since January 1, 1970, 00:00:00 GMT 
    long msFromEpochGmt = date.getTime();

    //gives you the current offset in ms from GMT at the current date
    int offsetFromUTC = tz.getOffset(msFromEpochGmt);
    log.debug("offset is " + offsetFromUTC);

    //create a new calendar in GMT timezone, set to this date and add the offset
    Calendar gmtCal = Calendar.getInstance(TimeZone.getTimeZone("GMT"));
    gmtCal.setTime(date);
    gmtCal.add(Calendar.MILLISECOND, offsetFromUTC);

    log.debug("Created GMT cal with date [" + gmtCal.getTime() + "]");

    return gmtCal;
} 
```

如果我将当前时间（“12:09:05 EDT” from `Calendar.getInstance()`）传递到以下位置，则输出如下：

> 调试 - 输入日历的日期 [Thu Oct 23 12:09:05 EDT 2008]
> 调试 - 偏移量为 -14400000
> 调试 - 使用日期创建 GMT 校准 [Thu Oct 23 08:09:05 EDT 2008]

格林威治标准时间 12:09:05 是美国东部时间 8:09:05。

这里令人困惑的部分是它会在您当前的时区中`Calendar.getTime()`返回 a `Date`，并且没有任何方法可以修改日历的时区并滚动基础日期。根据您的 Web 服务采用哪种类型的参数，您可能只想让 WS 以从纪元开始的毫秒数为单位进行处理。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-23T18:03:18.260

谢谢大家的回复。经过进一步的调查，我得到了正确的答案。正如 Skip Head 所提到的，我从应用程序中获得的时间戳正在调整为用户的时区。因此，如果用户输入 6:12 PM (EST) 我会得到 2:12 PM (GMT)。我需要的是一种撤消转换的方法，这样用户输入的时间就是我发送到 WebServer 请求的时间。以下是我如何做到这一点：

```
// Get TimeZone of user
TimeZone currentTimeZone = sc_.getTimeZone();
Calendar currentDt = new GregorianCalendar(currentTimeZone, EN_US_LOCALE);
// Get the Offset from GMT taking DST into account
int gmtOffset = currentTimeZone.getOffset(
    currentDt.get(Calendar.ERA), 
    currentDt.get(Calendar.YEAR), 
    currentDt.get(Calendar.MONTH), 
    currentDt.get(Calendar.DAY_OF_MONTH), 
    currentDt.get(Calendar.DAY_OF_WEEK), 
    currentDt.get(Calendar.MILLISECOND));
// convert to hours
gmtOffset = gmtOffset / (60*60*1000);
System.out.println("Current User's TimeZone: " + currentTimeZone.getID());
System.out.println("Current Offset from GMT (in hrs):" + gmtOffset);
// Get TS from User Input
Timestamp issuedDate = (Timestamp) getACPValue(inputs_, "issuedDate");
System.out.println("TS from ACP: " + issuedDate);
// Set TS into Calendar
Calendar issueDate = convertTimestampToJavaCalendar(issuedDate);
// Adjust for GMT (note the offset negation)
issueDate.add(Calendar.HOUR_OF_DAY, -gmtOffset);
System.out.println("Calendar Date converted from TS using GMT and US_EN Locale: "
    + DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT)
    .format(issueDate.getTime())); 
```

代码的输出是：（用户输入 5/1/2008 6:12PM (EST)

当前用户的时区：EST
当前与 GMT 的偏移量（以小时为单位）：-4（通常为 -5，DST 调整除外）
ACP 的 TS：2008-05-01 14:12:00.0
使用 GMT 和 US_EN 区域设置从 TS 转换的日历日期: 2008 年 5 月 1 日下午 6:12（格林威治标准时间）

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-02-02T12:41:36.283

您说日期与 Web 服务一起使用，所以我假设它在某个时候被序列化为字符串。

如果是这种情况，您应该查看 DateFormat 类的[setTimeZone 方法](http://java.sun.com/j2se/1.4.2/docs/api/java/text/DateFormat.html#setTimeZone(java.util.TimeZone))。这决定了在打印时间戳时将使用哪个时区。

一个简单的例子：

```
SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSS'Z'");
formatter.setTimeZone(TimeZone.getTimeZone("UTC"));

Calendar cal = Calendar.getInstance();
String timestamp = formatter.format(cal.getTime()); 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-12-25T04:03:48.943

您可以使用[Joda Time](http://joda-time.sourceforge.net/)解决它：

```
Date utcDate = new Date(timezoneFrom.convertLocalToUTC(date.getTime(), false));
Date localDate = new Date(timezoneTo.convertUTCToLocal(utcDate.getTime())); 
```

爪哇 8：

```
LocalDateTime localDateTime = LocalDateTime.parse("2007-12-03T10:15:30");
ZonedDateTime fromDateTime = localDateTime.atZone(
    ZoneId.of("America/Toronto"));
ZonedDateTime toDateTime = fromDateTime.withZoneSameInstant(
    ZoneId.of("Canada/Newfoundland")); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-23T16:01:23.013

看起来您的时间戳被设置为原始系统的时区。

这已被弃用，但它应该可以工作：

```
cal.setTimeInMillis(ts_.getTime() - ts_.getTimezoneOffset()); 
```

不推荐使用的方法是使用

```
Calendar.get(Calendar.ZONE_OFFSET) + Calendar.get(Calendar.DST_OFFSET)) / (60 * 1000) 
```

但这需要在客户端完成，因为该系统知道它所在的时区。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-06T09:42:02.693

从一个 timeZone 转换为另一个 timeZone 的方法（可能有效:)）。

```
/**
 * Adapt calendar to client time zone.
 * @param calendar - adapting calendar
 * @param timeZone - client time zone
 * @return adapt calendar to client time zone
 */
public static Calendar convertCalendar(final Calendar calendar, final TimeZone timeZone) {
    Calendar ret = new GregorianCalendar(timeZone);
    ret.setTimeInMillis(calendar.getTimeInMillis() +
            timeZone.getOffset(calendar.getTimeInMillis()) -
            TimeZone.getDefault().getOffset(calendar.getTimeInMillis()));
    ret.getTime();
    return ret;
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-02-06T11:28:47.217

**Date**和**Timestamp**对象与时区无关：它们表示自纪元以来的特定秒数，而无需将该时刻的特定解释为小时和天。时区仅在**GregorianCalendar**（此任务不直接需要）和**SimpleDateFormat**中输入图片，它们需要时区偏移量才能在单独的字段和 Date （或*long*）值之间进行转换。

OP 的问题就在他的处理开始时：用户输入的小时数不明确，并且在本地非 GMT 时区进行解释；此时值为*"6:12 EST"*，可以轻松打印为*"11.12 GMT"*或任何其他时区，但永远不会*更改*为*"6.12 GMT"*。

无法使将*“06:12”*解析为*“HH:MM”*（默认为本地时区）的**SimpleDateFormat改为默认为 UTC；****SimpleDateFormat**本身就有点太聪明了。

 ****但是，您可以说服任何**SimpleDateFormat**实例使用正确的时区，如果您将它明确地放在输入中：只需将一个固定字符串附加到接收（并充分验证）*“06:12”以将**“06:12 GMT”*解析为*“HH:MM z”*。

不需要显式设置**GregorianCalendar**字段或检索和使用时区和夏令时偏移。

真正的问题是分离默认为本地时区的输入、默认为 UTC 的输入以及真正需要明确时区指示的输入。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-23T15:59:25.107

过去对我有用的是确定用户时区和 GMT 之间的偏移量（以毫秒为单位）。获得偏移量后，您可以简单地加/减（取决于转换的方式）以获得任一时区的适当时间。我通常会通过设置 Calendar 对象的毫秒字段来完成此操作，但我相信您可以轻松地将其应用于时间戳对象。这是我用来获取偏移量的代码

```
int offset = TimeZone.getTimeZone(timezoneId).getRawOffset(); 
```

timezoneId 是用户所在时区的 id（如 EST）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-01-26T06:43:50.537

# c# - 如何将一个流的内容复制到另一个流？

> ID：230128
> 
> 赞同：549
> 
> 时间：2008-10-23T15:16:13.743
> 
> 标签：c#, stream, copying

将一个流的内容复制到另一个流的最佳方法是什么？有没有标准的实用方法？

* * *

## 回答 #1

> 赞同：726
> 
> 时间：2008-10-23T15:19:32.957

**从 .NET 4.5 开始，就有了[`Stream.CopyToAsync`方法](http://msdn.microsoft.com/en-us/library/system.io.stream.copytoasync.aspx)**

```
input.CopyToAsync(output); 
```

这将返回一个[`Task`](http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.aspx)可以在完成后继续的，如下所示：

```
await input.CopyToAsync(output)

// Code from here on will be run in a continuation. 
```

请注意，根据调用的位置，后面`CopyToAsync`的代码可能会或可能不会在调用它的同一线程上继续。

[`SynchronizationContext`](http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.aspx)调用时捕获的[`await`](http://msdn.microsoft.com/en-us/library/vstudio/hh191443.aspx)将确定继续将在哪个线程上执行。

此外，此调用（这是一个可能会更改的实现细节）仍然对读取和写入进行排序（它只是不会浪费线程在 I/O 完成时阻塞）。

**从 .NET 4.0 开始，就有了[`Stream.CopyTo`方法](http://msdn.microsoft.com/en-us/library/system.io.stream.copyto.aspx)**

```
input.CopyTo(output); 
```

**对于 .NET 3.5 及之前版本**

框架中没有任何东西可以帮助解决这个问题。您必须手动复制内容，如下所示：

```
public static void CopyStream(Stream input, Stream output)
{
    byte[] buffer = new byte[32768];
    int read;
    while ((read = input.Read(buffer, 0, buffer.Length)) > 0)
    {
        output.Write (buffer, 0, read);
    }
} 
```

注 1：此方法将允许您报告进度（到目前为止已读取 x 个字节...）
注 2：为什么使用固定缓冲区大小而不是`input.Length`？因为该长度可能不可用！从[文档](https://docs.microsoft.com/en-us/dotnet/api/system.io.stream.canseek)：

> 如果从 Stream 派生的类不支持查找，则对 Length、SetLength、Position 和 Seek 的调用将引发 NotSupportedException。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2010-06-22T02:41:36.977

`MemoryStream`拥有`.WriteTo(outstream);`

并且 .NET 4.0 具有`.CopyTo`正常的流对象。

.NET 4.0：

```
instream.CopyTo(outstream); 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-08-10T03:54:43.533

我使用以下扩展方法。当一个流是 MemoryStream 时，它们已经优化了重载。

```
 public static void CopyTo(this Stream src, Stream dest)
    {
        int size = (src.CanSeek) ? Math.Min((int)(src.Length - src.Position), 0x2000) : 0x2000;
        byte[] buffer = new byte[size];
        int n;
        do
        {
            n = src.Read(buffer, 0, buffer.Length);
            dest.Write(buffer, 0, n);
        } while (n != 0);           
    }

    public static void CopyTo(this MemoryStream src, Stream dest)
    {
        dest.Write(src.GetBuffer(), (int)src.Position, (int)(src.Length - src.Position));
    }

    public static void CopyTo(this Stream src, MemoryStream dest)
    {
        if (src.CanSeek)
        {
            int pos = (int)dest.Position;
            int length = (int)(src.Length - src.Position) + pos;
            dest.SetLength(length); 

            while(pos < length)                
                pos += src.Read(dest.GetBuffer(), pos, length - pos);
        }
        else
            src.CopyTo((Stream)dest);
    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-07-27T08:42:23.447

.NET Framework 4 引入了 System.IO 命名空间的 Stream 类的新“CopyTo”方法。使用这种方法，我们可以将一个流复制到不同流类的另一个流。

这是一个例子。

```
 FileStream objFileStream = File.Open(Server.MapPath("TextFile.txt"), FileMode.Open);
    Response.Write(string.Format("FileStream Content length: {0}", objFileStream.Length.ToString()));

    MemoryStream objMemoryStream = new MemoryStream();

    // Copy File Stream to Memory Stream using CopyTo method
    objFileStream.CopyTo(objMemoryStream);
    Response.Write("<br/><br/>");
    Response.Write(string.Format("MemoryStream Content length: {0}", objMemoryStream.Length.ToString()));
    Response.Write("<br/><br/>"); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-10T03:38:01.507

实际上，有一种不太严格的方式来进行流复制。但是请注意，这意味着您可以将整个文件存储在内存中。如果您正在处理数百兆字节或更多的文件，请不要尝试使用它，不要小心。

```
public static void CopySmallTextStream(Stream input, Stream output)
{
  using (StreamReader reader = new StreamReader(input))
  using (StreamWriter writer = new StreamWriter(output))
  {
    writer.Write(reader.ReadToEnd());
  }
} 
```

*注意：也可能存在一些关于二进制数据和字符编码的问题。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T15:29:53.700

区分“CopyStream”实现的基本问题是：

*   读取缓冲区的大小
*   写入的大小
*   我们可以使用多个线程（阅读时写作）。

这些问题的答案会导致 CopyStream 的完全不同的实现，并且取决于您拥有什么样的流以及您要优化什么。“最佳”实现甚至需要知道流正在读取和写入的特定硬件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T15:26:28.293

不幸的是，没有真正简单的解决方案。你可以尝试这样的事情：

```
Stream s1, s2;
byte[] buffer = new byte[4096];
int bytesRead = 0;
while (bytesRead = s1.Read(buffer, 0, buffer.Length) > 0) s2.Write(buffer, 0, bytesRead);
s1.Close(); s2.Close(); 
```

但是，如果没有可读取的内容，则 Stream 类的不同实现可能会表现出不同的问题。从本地硬盘读取文件的流可能会阻塞，直到读取操作从磁盘读取足够的数据以填充缓冲区，并且只有在到达文件末尾时才返回较少的数据。另一方面，从网络读取的流可能会返回更少的数据，即使还有更多的数据需要接收。

在使用通用解决方案之前，请务必检查您正在使用的特定流类的文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T17:24:29.383

可能有一种方法可以更有效地执行此操作，具体取决于您使用的流类型。如果可以将一个或两个流转换为 MemoryStream，则可以使用 GetBuffer 方法直接处理表示数据的字节数组。这使您可以使用 Array.CopyTo 之类的方法，这些方法可以抽象掉由 fryguybob 提出的所有问题。您可以相信 .NET 知道复制数据的最佳方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-22T16:44:40.327

如果您想要一个程序将流复制到另一个 nick 发布的流很好但它缺少位置重置，它应该是

```
public static void CopyStream(Stream input, Stream output)
{
    byte[] buffer = new byte[32768];
    long TempPos = input.Position;
    while (true)    
    {
        int read = input.Read (buffer, 0, buffer.Length);
        if (read <= 0)
            return;
        output.Write (buffer, 0, read);
    }
    input.Position = TempPos;// or you make Position = 0 to set it at the start
} 
```

但是如果它在运行时不使用你应该使用内存流的过程

```
Stream output = new MemoryStream();
byte[] buffer = new byte[32768]; // or you specify the size you want of your buffer
long TempPos = input.Position;
while (true)    
{
    int read = input.Read (buffer, 0, buffer.Length);
    if (read <= 0)
        return;
    output.Write (buffer, 0, read);
 }
    input.Position = TempPos;// or you make Position = 0 to set it at the start 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-11-07T21:05:55.557

由于没有一个答案涵盖了从一个流复制到另一个流的异步方式，因此这是我在端口转发应用程序中成功使用的一种模式，用于将数据从一个网络流复制到另一个。它缺乏异常处理来强调模式。

```
const int BUFFER_SIZE = 4096;

static byte[] bufferForRead = new byte[BUFFER_SIZE];
static byte[] bufferForWrite = new byte[BUFFER_SIZE];

static Stream sourceStream = new MemoryStream();
static Stream destinationStream = new MemoryStream();

static void Main(string[] args)
{
    // Initial read from source stream
    sourceStream.BeginRead(bufferForRead, 0, BUFFER_SIZE, BeginReadCallback, null);
}

private static void BeginReadCallback(IAsyncResult asyncRes)
{
    // Finish reading from source stream
    int bytesRead = sourceStream.EndRead(asyncRes);
    // Make a copy of the buffer as we'll start another read immediately
    Array.Copy(bufferForRead, 0, bufferForWrite, 0, bytesRead);
    // Write copied buffer to destination stream
    destinationStream.BeginWrite(bufferForWrite, 0, bytesRead, BeginWriteCallback, null);
    // Start the next read (looks like async recursion I guess)
    sourceStream.BeginRead(bufferForRead, 0, BUFFER_SIZE, BeginReadCallback, null);
}

private static void BeginWriteCallback(IAsyncResult asyncRes)
{
    // Finish writing to destination stream
    destinationStream.EndWrite(asyncRes);
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-29T16:52:36.307

对于 .NET 3.5 及之前的尝试：

```
MemoryStream1.WriteTo(MemoryStream2); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-04-30T12:47:48.820

简单安全 - 从原始来源制作新流：

```
 MemoryStream source = new MemoryStream(byteArray);
    MemoryStream copy = new MemoryStream(byteArray); 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2020-08-06T02:52:11.443

以下代码解决了使用 CopyTo 将 Stream 复制到 MemoryStream 的问题

```
Stream stream = new MemoryStream(); 
```

//任何函数都需要输入流。在 mycase 中将 PDF 文件保存为流 document.Save(stream);

```
MemoryStream newMs = (MemoryStream)stream;

byte[] getByte = newMs.ToArray(); 
```

//注意 - 请将流放在 finally 块中，而不是在 using 块中，因为它会抛出错误 'Access denied as the stream is closed'

# mysql - MySQL全文搜索分数解释

> ID：230129
> 
> 赞同：14
> 
> 时间：2008-10-23T15:16:24.010
> 
> 标签：mysql, full-text-search

我最近一直在尝试全文搜索，并对 Score 值的含义感到好奇。例如，我有以下查询：

```
SELECT table. * ,
MATCH (
col1, col2, col3
)
AGAINST (
'+(Term1) +(Term1)'
) AS Score
FROM table
WHERE MATCH (
col1, col2, col3
) 
AGAINST (
'+(Term1) +(Term1)'
) 
```

在 Score 的结果中，我看到一个查询的结果在 0.4667041301727 到 11.166275978088 之间。我知道这是 MySQL 的相关性概念（权重越高）。

我不明白 MySQL 是如何得出这个分数的。为什么数字不作为小数或其他东西返回？

如果我运行查询“IN BOOLEAN MODE”，分数总是返回 1 还是 0 怎么办？不是所有的结果都是1吗？

只是希望得到一些启示。谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-24T11:57:54.770

以查询“word1 word2”为例。

BOOLEAN 模式表示您的整个查询与文档匹配（例如，它同时包含 word1 和 word2）。布尔模式是严格匹配的。

通常使用的公式是基于搜索的向量空间模型。非常简化，它找出了两种衡量一个词对查询的重要性的方法。词频（文档中经常出现的词比其他词更重要）和逆文档频率（出现在许多文档中的词的权重低于出现在少数文档中的词）。这称为[tf-idf](http://en.wikipedia.org/wiki/Tf-idf)，用作向量空间模型的基础。这些分数构成了[向量空间模型](http://en.wikipedia.org/wiki/Vector_space_model)的基础，其他人可以彻底解释。:)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-23T15:36:41.377

一般来说，相关性是基于每行与搜索的单词有多少匹配。确切的值将取决于很多事情，但它只在与同一查询中的其他相关值进行比较时才有意义。

如果你真的想要它背后的数学，你可以在[内部手册](https://dev.mysql.com/doc/refman/5.7/en/fulltext-search.html)中找到它。

# sql - SQL Server：将所有大写字母变为正确大小写/标题大小写

> ID：230138
> 
> 赞同：111
> 
> 时间：2008-10-23T15:19:03.007
> 
> 标签：sql, sql-server, uppercase, title-case

我有一张作为全部大写字母导入的表格，我想将其转换为正确大小写。你们中的任何人用什么脚本来完成这个？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-23T15:37:32.827

这个功能：

*   "Proper Cases" 所有由空格分隔的 "UPPER CASE" 单词
*   单独留下“小写单词”
*   即使对于非英文字母也能正常工作
*   是可移植的，因为它不使用最新 SQL Server 版本的花哨功能
*   可以轻松更改为使用 NCHAR 和 NVARCHAR 来支持 unicode，以及您认为合适的任何参数长度
*   可以配置空白定义

```
CREATE FUNCTION ToProperCase(@string VARCHAR(255)) RETURNS VARCHAR(255)
AS
BEGIN
  DECLARE @i INT           -- index
  DECLARE @l INT           -- input length
  DECLARE @c NCHAR(1)      -- current char
  DECLARE @f INT           -- first letter flag (1/0)
  DECLARE @o VARCHAR(255)  -- output string
  DECLARE @w VARCHAR(10)   -- characters considered as white space

  SET @w = '[' + CHAR(13) + CHAR(10) + CHAR(9) + CHAR(160) + ' ' + ']'
  SET @i = 1
  SET @l = LEN(@string)
  SET @f = 1
  SET @o = ''

  WHILE @i <= @l
  BEGIN
    SET @c = SUBSTRING(@string, @i, 1)
    IF @f = 1 
    BEGIN
     SET @o = @o + @c
     SET @f = 0
    END
    ELSE
    BEGIN
     SET @o = @o + LOWER(@c)
    END

    IF @c LIKE @w SET @f = 1

    SET @i = @i + 1
  END

  RETURN @o
END 
```

结果：

```
dbo.ToProperCase('ALL UPPER CASE and    SOME lower ÄÄ ÖÖ ÜÜ ÉÉ ØØ ĈĈ ÆÆ')
-----------------------------------------------------------------
All Upper Case and      Some lower Ää Öö Üü Éé Øø Cc Ææ 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-10-23T15:27:16.747

这是一个可以解决问题的UDF...

```
create function ProperCase(@Text as varchar(8000))
returns varchar(8000)
as
begin
  declare @Reset bit;
  declare @Ret varchar(8000);
  declare @i int;
  declare @c char(1);

  if @Text is null
    return null;

  select @Reset = 1, @i = 1, @Ret = '';

  while (@i <= len(@Text))
    select @c = substring(@Text, @i, 1),
      @Ret = @Ret + case when @Reset = 1 then UPPER(@c) else LOWER(@c) end,
      @Reset = case when @c like '[a-zA-Z]' then 0 else 1 end,
      @i = @i + 1
  return @Ret
end 
```

不过，您仍然必须使用它来更新您的数据。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2013-12-18T14:24:47.603

```
UPDATE titles
  SET title =
      UPPER(LEFT(title, 1)) +
        LOWER(RIGHT(title, LEN(title) - 1)) 
```

[http://sqlmag.com/t-sql/how-title-case-column-value](http://sqlmag.com/t-sql/how-title-case-column-value)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-10-23T22:05:43.357

如果您可以在 SQL Server 中启用 CLR（需要 2005 或更高版本），那么您可以[创建一个](http://msdn.microsoft.com/en-us/library/w2kae45k.aspx)使用[TextInfo.ToTitleCase 内置](http://msdn.microsoft.com/en-us/library/system.globalization.textinfo.totitlecase.aspx)函数的 CLR 函数，这将允许您创建一种文化感知方式来执行此操作代码行。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-02-25T06:29:16.873

我知道这是该线程中的后期帖子，但值得一看。这个功能对我有用。于是想到分享。

```
CREATE FUNCTION [dbo].[fnConvert_TitleCase] (@InputString VARCHAR(4000) )
RETURNS VARCHAR(4000)
AS
BEGIN
DECLARE @Index INT
DECLARE @Char CHAR(1)
DECLARE @OutputString VARCHAR(255)

SET @OutputString = LOWER(@InputString)
SET @Index = 2
SET @OutputString = STUFF(@OutputString, 1, 1,UPPER(SUBSTRING(@InputString,1,1)))

WHILE @Index <= LEN(@InputString)
BEGIN
    SET @Char = SUBSTRING(@InputString, @Index, 1)
    IF @Char IN (' ', ';', ':', '!', '?', ',', '.', '_', '-', '/', '&','''','(')
    IF @Index + 1 <= LEN(@InputString)
BEGIN
    IF @Char != ''''
    OR
    UPPER(SUBSTRING(@InputString, @Index + 1, 1)) != 'S'
    SET @OutputString =
    STUFF(@OutputString, @Index + 1, 1,UPPER(SUBSTRING(@InputString, @Index + 1, 1)))
END
    SET @Index = @Index + 1
END

RETURN ISNULL(@OutputString,'')
END 
```

测试调用：

```
select dbo.fnConvert_TitleCase(Upper('ÄÄ ÖÖ ÜÜ ÉÉ ØØ ĈĈ ÆÆ')) as test
select dbo.fnConvert_TitleCase(upper('Whatever the mind of man can conceive and believe, it can achieve. – Napoleon hill')) as test 
```

结果：

![在此处输入图像描述](https://i.stack.imgur.com/BdUzW.jpg)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2016-07-28T21:22:56.143

我在游戏中有点晚了，但我相信这更实用，它适用于任何语言，包括俄语、德语、泰语、越南语等。它会在 ' 或 - 或 之后将任何内容变为大写。或（或）或空格（显然是:)。

```
CREATE FUNCTION [dbo].[fnToProperCase]( @name nvarchar(500) )
RETURNS nvarchar(500)
AS
BEGIN
declare @pos    int = 1
      , @pos2   int

if (@name <> '')--or @name = lower(@name) collate SQL_Latin1_General_CP1_CS_AS or @name = upper(@name) collate SQL_Latin1_General_CP1_CS_AS)
begin
    set @name = lower(rtrim(@name))
    while (1 = 1)
    begin
        set @name = stuff(@name, @pos, 1, upper(substring(@name, @pos, 1)))
        set @pos2 = patindex('%[- ''.)(]%', substring(@name, @pos, 500))
        set @pos += @pos2
        if (isnull(@pos2, 0) = 0 or @pos > len(@name))
            break
    end
end

return @name
END
GO 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-11-19T15:20:00.743

这是一个使用序列或数字表而不是循环的版本。您可以修改 WHERE 子句以适应您的个人规则，以便将字符转换为大写。我刚刚包含了一个简单的集合，它将大写任何以非字母开头的字母，撇号除外。这确实意味着 123apple 将在“a”上匹配，因为“3”不是字母。如果您只需要空格（空格、制表符、回车、换行），您可以将模式替换`'[^a-z]'`为`'[' + Char(32) + Char(9) + Char(13) + Char(10) + ']'`.

* * *

```
CREATE FUNCTION String.InitCap( @string nvarchar(4000) ) RETURNS nvarchar(4000) AS
BEGIN

-- 1\. Convert all letters to lower case
    DECLARE @InitCap nvarchar(4000); SET @InitCap = Lower(@string);

-- 2\. Using a Sequence, replace the letters that should be upper case with their upper case version
    SELECT @InitCap = Stuff( @InitCap, n, 1, Upper( SubString( @InitCap, n, 1 ) ) )
    FROM (
        SELECT (1 + n1.n + n10.n + n100.n + n1000.n) AS n
        FROM       (SELECT 0 AS n UNION SELECT    1 UNION SELECT    2 UNION SELECT    3 UNION SELECT    4 UNION SELECT    5 UNION SELECT    6 UNION SELECT    7 UNION SELECT    8 UNION SELECT    9) AS    n1
        CROSS JOIN (SELECT 0 AS n UNION SELECT   10 UNION SELECT   20 UNION SELECT   30 UNION SELECT   40 UNION SELECT   50 UNION SELECT   60 UNION SELECT   70 UNION SELECT   80 UNION SELECT   90) AS   n10
        CROSS JOIN (SELECT 0 AS n UNION SELECT  100 UNION SELECT  200 UNION SELECT  300 UNION SELECT  400 UNION SELECT  500 UNION SELECT  600 UNION SELECT  700 UNION SELECT  800 UNION SELECT  900) AS  n100
        CROSS JOIN (SELECT 0 AS n UNION SELECT 1000 UNION SELECT 2000 UNION SELECT 3000)                                                                                                             AS n1000
        ) AS Sequence
    WHERE 
        n BETWEEN 1 AND Len( @InitCap )
    AND SubString( @InitCap, n, 1 ) LIKE '[a-z]'                 /* this character is a letter */
    AND (
        n = 1                                                    /* this character is the first `character` */
        OR SubString( @InitCap, n-1, 1 ) LIKE '[^a-z]'           /* the previous character is NOT a letter */
        )
    AND (
        n < 3                                                    /* only test the 3rd or greater characters for this exception */
        OR SubString( @InitCap, n-2, 3 ) NOT LIKE '[a-z]''[a-z]' /* exception: The pattern <letter>'<letter> should not capatolize the letter following the apostrophy */
        )

-- 3\. Return the modified version of the input
    RETURN @InitCap

END 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-07-02T17:53:30.410

如果您在 SSIS 中导入混合大小写的数据并且需要对具有正确大小写的列进行查找，您会注意到在源混合且查找源正确的情况下查找失败。您还会注意到您不能使用 right 和 left 函数是 SSIS for SQL Server 2008r2 的派生列。这是一个适合我的解决方案：

```
UPPER(substring(input_column_name,1,1)) + LOWER(substring(input_column_name, 2, len(input_column_name)-1)) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-04-11T11:10:41.437

对@Galwegian 的回答稍作修改——例如`St Elizabeth's`变成`St Elizabeth'S`.

此修改将撇号-s 保持为小写，其中 s 位于提供的字符串的末尾，或者 s 后跟一个空格（并且仅在这些情况下）。

```
create function properCase(@text as varchar(8000))
returns varchar(8000)
as
begin
    declare @reset int;
    declare @ret varchar(8000);
    declare @i int;
    declare @c char(1);
    declare @d char(1);

    if @text is null
    return null;

    select @reset = 1, @i = 1, @ret = '';

    while (@i <= len(@text))
    select
        @c = substring(@text, @i, 1),
        @d = substring(@text, @i+1, 1),
        @ret = @ret + case when @reset = 1 or (@reset=-1 and @c!='s') or (@reset=-1 and @c='s' and @d!=' ') then upper(@c) else lower(@c) end,
        @reset = case when @c like '[a-za-z]' then 0 when @c='''' then -1 else 1 end,
        @i = @i + 1
    return @ret
end 
```

事实证明：

*   `st elizabeth's`进入`St Elizabeth's`
*   `o'keefe`进入`O'Keefe`
*   `o'sullivan`进入`O'Sullivan`

其他人认为不同的解决方案更适合非英语输入的评论仍然如此。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-10-19T22:34:32.540

在 Server Server 2016 及更高版本上，您可以使用[STRING_SPLIT](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-split-transact-sql?view=sql-server-ver15)

```
 with t as (
    select 'GOOFYEAR Tire and Rubber Company' as n
    union all
    select 'THE HAPPY BEAR' as n
    union all
    select 'MONK HOUSE SALES' as n
    union all
    select 'FORUM COMMUNICATIONS' as n
)
select
    n,
    (
        select ' ' + (
            upper(left(value, 1))
            + lower(substring(value, 2, 999))
        )
        from (
            select value
            from string_split(t.n, ' ')
        ) as sq
        for xml path ('')
    ) as title_cased
from t 
```

## [例子](https://dbfiddle.uk/?rdbms=sqlserver_2019&fiddle=97cc48b466d259ea8f599541646e4c4b)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-23T21:56:45.480

我在上面发布的链接是解决主要问题的一个很好的选择：我们永远无法以编程方式解释所有情况（Smith-Jones、von Haussen、John Smith MD），至少不能以一种优雅的方式。Tony 引入了异常/中断字符的概念来处理这些情况。无论如何，基于 Cervo 的想法（上面所有低位字符都以空格开头），替换语句可以包含在基于单个表的替换中。实际上，任何低/高字符组合都可以插入@alpha，并且语句不会改变：

```
declare @str    nvarchar(8000)
declare @alpha  table (low nchar(1), up nchar(1))

set @str = 'ALL UPPER CASE and    SOME lower ÄÄ ÖÖ ÜÜ ÉÉ ØØ ĈĈ ÆÆ'

-- stage the alpha (needs number table)
insert into @alpha
    -- A-Z / a-z
    select      nchar(n+32),
                nchar(n)
    from        dbo.Number
    where       n between 65 and 90 or
                n between 192 and 223

-- append space at start of str
set @str = lower(' ' + @str)

-- upper all lower case chars preceded by space
select  @str = replace(@str, ' ' + low, ' ' + up) 
from    @Alpha

select @str 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-07-06T21:01:54.037

保持对异常的查找以照顾冯诺依曼、麦凯恩、德古兹曼和约翰逊史密斯的情况是有意义的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-11-09T18:11:41.890

借用并改进了@Richard Sayakanit 的答案。这处理多个单词。就像他的回答一样，这不使用任何 UDF，只使用内置函数 ( `STRING_SPLIT`and `STRING_AGG`)，而且速度非常快。`STRING_AGG`需要 SQL Server 2017，但您始终可以使用该`STUFF/XML`技巧。不会处理所有异常，但可以很好地满足许多要求。

```
SELECT StateName = 'North Carolina' 
INTO #States
UNION ALL
SELECT 'Texas'

;WITH cteData AS 
(
    SELECT 
        UPPER(LEFT(value, 1)) +
            LOWER(RIGHT(value, LEN(value) - 1)) value, op.StateName
    FROM   #States op
    CROSS APPLY STRING_SPLIT(op.StateName, ' ') AS ss
)
SELECT 
    STRING_AGG(value, ' ')
FROM cteData c 
GROUP BY StateName 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-02-28T18:43:56.357

如果您知道所有数据只是一个单词，这里有一个解决方案。首先将列更新为 all lower，然后运行以下命令

```
 update tableName set columnName = 
    upper(SUBSTRING(columnName, 1, 1)) + substring(columnName, 2, len(columnName)) from tableName 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-23T15:51:03.703

我想你会发现以下更有效：

```
IF OBJECT_ID('dbo.ProperCase') IS NOT NULL
    DROP FUNCTION dbo.ProperCase
GO
CREATE FUNCTION dbo.PROPERCASE (
    @str VARCHAR(8000))
RETURNS VARCHAR(8000)
AS
BEGIN
    SET @str = ' ' + @str
    SET @str = REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( @str, ' a', ' A'), ' b', ' B'), ' c', ' C'), ' d', ' D'), ' e', ' E'), ' f', ' F'), ' g', ' G'), ' h', ' H'), ' i', ' I'), ' j', ' J'), ' k', ' K'), ' l', ' L'), ' m', ' M'), ' n', ' N'), ' o', ' O'), ' p', ' P'), ' q', ' Q'), ' r', ' R'), ' s', ' S'), ' t', ' T'), ' u', ' U'), ' v', ' V'), ' w', ' W'), ' x', ' X'), ' y', ' Y'), ' z', ' Z')
    RETURN RIGHT(@str, LEN(@str) - 1)
END
GO 
```

替换语句可以直接剪切并粘贴到 SQL 查询中。它非常难看，但是通过将 @str 替换为您感兴趣的列，您不会像使用这样发布的 udf 那样为隐式游标付出代价。我发现即使使用我的 UDF，它的效率也要高得多。

哦，不要手动生成替换语句，而是使用这个：

```
-- Code Generator for expression
DECLARE @x  INT,
    @c  CHAR(1),
    @sql    VARCHAR(8000)
SET @x = 0
SET @sql = '@str' -- actual variable/column you want to replace
WHILE @x < 26
BEGIN
    SET @c = CHAR(ASCII('a') + @x)
    SET @sql = 'REPLACE(' + @sql + ', '' ' + @c+  ''', '' ' + UPPER(@c) + ''')'
    SET @x = @x + 1
END
PRINT @sql 
```

无论如何，这取决于行数。我希望你可以只做 s/\b([az])/uc $1/，但是哦，我们使用我们拥有的工具。

注意您必须使用它，因为您必须将其用作....SELECT dbo.ProperCase(LOWER(column))，因为该列是大写的。它实际上在我的 5,000 个条目（甚至不到一秒）的表格上运行得非常快，即使是较低的条目也是如此。

为了回应关于国际化的大量评论，我提出了以下实现，它处理每个 ascii 字符，仅依赖于 SQL Server 的上层和下层实现。请记住，我们在这里使用的变量是 VARCHAR，这意味着它们只能保存 ASCII 值。为了使用更多的国际字母，您必须使用 NVARCHAR。逻辑将相似，但您需要使用 UNICODE 和 NCHAR 代替 ASCII AND CHAR 并且替换语句会更大......

```
-- Code Generator for expression
DECLARE @x  INT,
    @c  CHAR(1),
    @sql    VARCHAR(8000),
    @count  INT
SEt @x = 0
SET @count = 0
SET @sql = '@str' -- actual variable you want to replace
WHILE @x < 256
BEGIN
    SET @c = CHAR(@x)
    -- Only generate replacement expression for characters where upper and lowercase differ
    IF @x = ASCII(LOWER(@c)) AND @x != ASCII(UPPER(@c))
    BEGIN
        SET @sql = 'REPLACE(' + @sql + ', '' ' + @c+  ''', '' ' + UPPER(@c) + ''')'
        SET @count = @count + 1
    END
    SET @x = @x + 1
END
PRINT @sql
PRINT 'Total characters substituted: ' + CONVERT(VARCHAR(255), @count) 
```

基本上，我的方法的前提是用预先计算来换取效率。完整的 ASCII 实现如下：

```
IF OBJECT_ID('dbo.ProperCase') IS NOT NULL
    DROP FUNCTION dbo.ProperCase
GO
CREATE FUNCTION dbo.PROPERCASE (
    @str VARCHAR(8000))
RETURNS VARCHAR(8000)
AS
BEGIN
    SET @str = ' ' + @str
SET @str =     REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@str, ' a', ' A'), ' b', ' B'), ' c', ' C'), ' d', ' D'), ' e', ' E'), ' f', ' F'), ' g', ' G'), ' h', ' H'), ' i', ' I'), ' j', ' J'), ' k', ' K'), ' l', ' L'), ' m', ' M'), ' n', ' N'), ' o', ' O'), ' p', ' P'), ' q', ' Q'), ' r', ' R'), ' s', ' S'), ' t', ' T'), ' u', ' U'), ' v', ' V'), ' w', ' W'), ' x', ' X'), ' y', ' Y'), ' z', ' Z'), ' š', ' Š'), ' œ', ' Œ'), ' ž', ' Ž'), ' à', ' À'), ' á', ' Á'), ' â', ' Â'), ' ã', ' Ã'), ' ä', ' Ä'), ' å', ' Å'), ' æ', ' Æ'), ' ç', ' Ç'), ' è', ' È'), ' é', ' É'), ' ê', ' Ê'), ' ë', ' Ë'), ' ì', ' Ì'), ' í', ' Í'), ' î', ' Î'), ' ï', ' Ï'), ' ð', ' Ð'), ' ñ', ' Ñ'), ' ò', ' Ò'), ' ó', ' Ó'), ' ô', ' Ô'), ' õ', ' Õ'), ' ö', ' Ö'), ' ø', ' Ø'), ' ù', ' Ù'), ' ú', ' Ú'), ' û', ' Û'), ' ü', ' Ü'), ' ý', ' Ý'), ' þ', ' Þ'), ' ÿ', ' Ÿ')
    RETURN RIGHT(@str, LEN(@str) - 1)
END
GO 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-23T17:44:11.713

回去获取未大写的数据是否为时已晚？

您的客户群中的冯诺依曼、麦凯恩、德古兹曼和约翰逊-史密斯可能不喜欢您处理的结果……

另外，我猜这是为了一次性升级数据？导出、过滤/修改并将更正后的名称重新导入数据库可能更容易，然后您可以使用非 SQL 方法进行名称修复...

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-06-17T15:32:38.977

这是我在 SQLTeam.com 论坛 @ [http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=47718上找到的另一个变体](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=47718)

```
create FUNCTION PROPERCASE
(
--The string to be converted to proper case
@input varchar(8000)
)
--This function returns the proper case string of varchar type
RETURNS varchar(8000)
AS
BEGIN
IF @input IS NULL
BEGIN
--Just return NULL if input string is NULL
RETURN NULL
END

--Character variable declarations
DECLARE @output varchar(8000)
--Integer variable declarations
DECLARE @ctr int, @len int, @found_at int
--Constant declarations
DECLARE @LOWER_CASE_a int, @LOWER_CASE_z int, @Delimiter char(3), @UPPER_CASE_A int, @UPPER_CASE_Z int

--Variable/Constant initializations
SET @ctr = 1
SET @len = LEN(@input)
SET @output = ''
SET @LOWER_CASE_a = 97
SET @LOWER_CASE_z = 122
SET @Delimiter = ' ,-'
SET @UPPER_CASE_A = 65
SET @UPPER_CASE_Z = 90

WHILE @ctr <= @len
BEGIN
--This loop will take care of reccuring white spaces
WHILE CHARINDEX(SUBSTRING(@input,@ctr,1), @Delimiter) > 0
BEGIN
SET @output = @output + SUBSTRING(@input,@ctr,1)
SET @ctr = @ctr + 1
END

IF ASCII(SUBSTRING(@input,@ctr,1)) BETWEEN @LOWER_CASE_a AND @LOWER_CASE_z
BEGIN
--Converting the first character to upper case
SET @output = @output + UPPER(SUBSTRING(@input,@ctr,1))
END
ELSE
BEGIN
SET @output = @output + SUBSTRING(@input,@ctr,1)
END

SET @ctr = @ctr + 1

WHILE CHARINDEX(SUBSTRING(@input,@ctr,1), @Delimiter) = 0 AND (@ctr <= @len)
BEGIN
IF ASCII(SUBSTRING(@input,@ctr,1)) BETWEEN @UPPER_CASE_A AND @UPPER_CASE_Z
BEGIN
SET @output = @output + LOWER(SUBSTRING(@input,@ctr,1))
END
ELSE
BEGIN
SET @output = @output + SUBSTRING(@input,@ctr,1)
END
SET @ctr = @ctr + 1
END

END
RETURN @output
END

GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-07-18T13:27:27.573

刚刚了解到`InitCap()`。

这是一些示例代码：

```
SELECT ID
      ,InitCap(LastName ||', '|| FirstName ||' '|| Nvl(MiddleName,'')) AS RecipientName
FROM SomeTable 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-07-24T12:41:25.283

这在 SSMS 中有效：

```
Select Jobtitle,
concat(Upper(LEFT(jobtitle,1)), SUBSTRING(jobtitle,2,LEN(jobtitle))) as Propercase
From [HumanResources].[Employee] 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-10-08T15:33:16.930

最近不得不解决这个问题，并在没有什么能完全满足我想要的一切之后想出了以下问题。这将做一个完整的句子，特殊单词处理的案例。我们还遇到了许多简单方法处理的单字符“单词”问题，但更复杂的方法却没有。单个返回变量，也没有循环或游标。

```
CREATE FUNCTION ProperCase(@Text AS NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS BEGIN

    DECLARE @return NVARCHAR(MAX)

    SELECT @return = COALESCE(@return + ' ', '') + Word FROM (
         SELECT CASE
            WHEN LOWER(value) = 'llc' THEN UPPER(value)
            WHEN LOWER(value) = 'lp' THEN UPPER(value) --Add as many new special cases as needed
            ELSE
               CASE WHEN LEN(value) = 1
               THEN UPPER(value)
               ELSE UPPER(LEFT(value, 1)) + (LOWER(RIGHT(value, LEN(value) - 1)))
              END
            END AS Word
         FROM STRING_SPLIT(@Text, ' ')
     ) tmp

     RETURN @return
END 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-02-02T22:31:04.640

将您的数据复制并粘贴到 MS Word 中，并使用内置的文本转换来“大写每个单词”。与您的原始数据进行比较以解决异常。看不到任何手动回避“MacDonald”和“IBM”类型异常的方法，但这就是我完成FWIW的方式。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-03-26T23:23:51.810

可悲的是，我提出了另一个功能。这似乎比大多数更快，但只大写由空格分隔的单词的第一个字母。我检查了输入不为空，并且如果字符串中间的某个位置有多个空格，它可以工作。我正在交叉应用长度函数，所以我不必调用它两次。我原以为 SQL Server 会缓存该值。买者自负。

```
CREATE OR ALTER FUNCTION dbo.ProperCase(@value varchar(MAX)) RETURNS varchar(MAX) AS  
 BEGIN

     RETURN (SELECT STRING_AGG(CASE lv WHEN 0 THEN '' WHEN 1 THEN UPPER(value) 
      ELSE UPPER(LEFT(value,1)) + LOWER(RIGHT(value,lv-1)) END,' ')  
     FROM STRING_SPLIT(TRIM(@value),' ') AS ss 
      CROSS APPLY (SELECT LEN(VALUE) lv) AS reuse 
     WHERE @value IS NOT NULL)

 END 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-09-14T20:33:31.733

### 这个功能对我有用

```
create function [dbo].Pascal (@string varchar(max))
returns varchar(max)
as
begin
    declare @Index int
        ,@ResultString varchar(max)

    set @Index = 1
    set @ResultString = ''

    while (@Index < LEN(@string) + 1)
    begin
        if (@Index = 1)
        begin
            set @ResultString += UPPER(SUBSTRING(@string, @Index, 1))
            set @Index += 1
        end
        else if (
                (
                    SUBSTRING(@string, @Index - 1, 1) = ' '
                    or SUBSTRING(@string, @Index - 1, 1) = '-'
                    or SUBSTRING(@string, @Index + 1, 1) = '-'
                    )
                and @Index + 1 <> LEN(@string) + 1
                )
        begin
            set @ResultString += UPPER(SUBSTRING(@string, @Index, 1))
            set @Index += 1
        end
        else
        begin
            set @ResultString += LOWER(SUBSTRING(@string, @Index, 1))
            set @Index += 1
        end
    end

    if (@@ERROR <> 0)
    begin
        set @ResultString = @string
    end

    return replace(replace(replace(@ResultString, ' ii', ' II'), ' iii', ' III'), ' iv', ' IV')
end 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2016-09-08T14:50:09.863

我知道魔鬼在细节中（尤其是在涉及人们的个人数据的地方），并且拥有正确大写的名字会非常好，但上述麻烦是为什么我们当中务实、有时间意识的人使用以下：

`SELECT UPPER('Put YoUR O'So oddLy casED McWeird-nAme von rightHERE here')`

以我的经验，人们很高兴看到他们的名字……即使是在句子进行到一半的时候。

参考：俄罗斯人用铅笔！

# c# - 是否可以将属性添加到类中，以便将其作为代码而不是在设计器中进行编辑？

> ID：230146
> 
> 赞同：17
> 
> 时间：2008-10-23T15:20:42.580
> 
> 标签：c#, .net, visual-studio-2008

我创建了一个继承自 UserControl 的类，但我只想将其用作子类的基础。有没有一种方法可以阻止 VS2008 尝试在设计器中对其进行编辑，而不会阻止子类在设计器中进行编辑？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-23T15:26:03.193

有。我相信如果您在一个文件中有多个类，VS 只会查看第一个类，但我可能弄错了。无论如何，这应该可以解决问题：

```
[System.ComponentModel.DesignerCategory("Code")]
public class SomeBaseClass : UserControl
{
 //...
} 
```

请注意，在 2017 之前的 Visual Studio 版本中，您必须使用属性的全名，如上所示。如果您尝试在其上方放置 using 语句并简单地尝试“DesignerCategory”视觉工作室可能不会尊重它。

# .net - 新的 Web 应用项目无法识别 带有 Sp1 的 Visual Studio 2008 为了重现我的问题，我只需创建一个新的 .Net 2.0 Web 应用程序并添加一个带有以下标记的页面： <%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits=" 问问题 Chris Lively 问问题 2008-10-23T15:20:57.277 422 次 This question shows research effort; it is useful and clear 1 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 带有 Sp1 的 Visual Studio 2008 为了重现我的问题，我只需创建一个新的 .Net 2.0 Web 应用程序并添加一个带有以下标记的页面： <%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication5._Default" %> <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" > <head runat="server"> <title></title> </head> <body> <form id="form1" runat="server"> <div> <asp:button id="button1" runat="server" /> </div> </form> </body> </html> 发生的情况是在 :button 下画了一条线，并带有声明“验证（）：不支持元素'按钮'”。 我试过修复 .net 框架；但是，这没有影响。这开始发生在两台不同的机器上，一台是 vista，另一台是过去一周内的 XP。 更新：我关闭了这个问题，因为在花了 2 天时间试图修复它后，我放弃并重新安装了 Visual Studio 2008。这解决了所有问题，现在有问题的机器可以正常工作。我赞成你们每个人的帮助。 试试“按钮”（大写 B）： <body> <form id="form1" runat="server"> <div> <asp:Button id="button1" runat="server" /> </div> </form> </body> .netvisual-studioide 4 2 回答 2 This answer is useful 1 因为这是 Visual Studio 创建的标准页面，除了您添加了一个按钮。我们可以排除代码有什么问题。 我将从您所说的“修复 .NET 框架”开始。一开始就坏了？也许您的维修没有解决您遇到的问题。 因此，从那里，我会检查您的计算机上最近安装的内容。 然后我会检查 web.config 文件以确保它引用了所有正确的程序集。 如果您可以提供更多信息，这将有助于很多。 于 2008-10-23T19:51:48.273 回答 This answer is useful 1 试试“按钮”（大写 B）： <body> <form id="form1" runat="server"> <div> <asp:Button id="button1" runat="server" /> </div> </form> </body> 于 2008-10-23T15:51:15.280 回答 Related 1 proxy - 为什么 CNTLM 要求输入密码？ 1 c# - WPF：在 GridView 模式下将 ListView 与集合绑定。错误 0 xml - 带有文本节点的 IBM DB2 XMLEXISTS 1 c# - 如何为 Html Agility Pack 设置应用程序池 1 selenium - phpunit 的代码覆盖率 1 powershell - 即使没有网络连接，签名脚本如何工作？ 1 c# - 带有浏览器的 TabControl 0 jquery - 精彩的弹出式视频 - 看不到 2 android - 徽章图标位于 TextView 长度 Android 的右下角 0 java - libGDX：变形现有的 3d 模型 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：230150
> 
> 赞同：1
> 
> 时间：
> 
> 标签：.net, visual-studio, ide

带有 Sp1 的 Visual Studio 2008

为了重现我的问题，我只需创建一个新的 .Net 2.0 Web 应用程序并添加一个带有以下标记的页面：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication5._Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <asp:button id="button1" runat="server" />
    </div>
    </form>
</body>
</html> 
```

发生的情况是在 :button 下画了一条线，并带有声明“验证（）：不支持元素'按钮'”。

我试过修复 .net 框架；但是，这没有影响。这开始发生在两台不同的机器上，一台是 vista，另一台是过去一周内的 XP。

**更新：**我关闭了这个问题，因为在花了 2 天时间试图修复它后，我放弃并重新安装了 Visual Studio 2008。这解决了所有问题，现在有问题的机器可以正常工作。我赞成你们每个人的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T19:51:48.273

因为这是 Visual Studio 创建的标准页面，除了您添加了一个按钮。我们可以排除代码有什么问题。

我将从您所说的“修复 .NET 框架”开始。一开始就坏了？也许您的维修没有解决您遇到的问题。

因此，从那里，我会检查您的计算机上最近安装的内容。

然后我会检查 web.config 文件以确保它引用了所有正确的程序集。

如果您可以提供更多信息，这将有助于很多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T15:51:15.280

试试“按钮”（大写 B）**：**

```
<body>
    <form id="form1" runat="server">
    <div>
        <asp:Button id="button1" runat="server" />
    </div>
    </form>
</body> 
```

# asp.net - ASP.NET 2.0 中的 Page.Load 问题

> ID：230186
> 
> 赞同：3
> 
> 时间：2008-10-23T15:29:17.570
> 
> 标签：asp.net, asp.net-2.0

我正在尝试使用带有代码隐藏部分的名为 Default.aspx 的页面来帮助另一个程序员，不幸的是我有点不知所措。

```
 Partial Class _Default
 Inherits OverheadClass
 'A bunch of global variables here'

 Private Sub page_load(ByVal sender As Object, ByVal e As System.Eventarts) Handles Me.Load
 'Function goes here' 
```

在 OverheadClass 我们有

```
 Public Sub Sub_OverheadClass_Load(ByVal sender As Object, ByVal e as System.EventArgs) Handles MyClass.Load 
```

期望的效果是当 OverheadClass 被继承时，我们希望它的加载在页面上的 load 事件运行之前运行。我可能缺少一个非常简单的答案。

编辑：我忘了注意我们是用 VB 编写的，而不是像你们许多人习惯的 ASP 那样用 C# 编写。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-23T15:32:22.480

您应该能够覆盖 OnLoad 并首先调用基类的 OnLoad，然后是您的类，例如：

C#版本

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);

    // Do some stuff here
} 
```

VB版

```
Protected Overrides Sub OnLoad(ByVal e As System.EventArgs)

    MyBase.OnLoad(e)

    ' Do some stuff here

End Sub 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T15:36:18.010

在VB中它将是：

```
Private Sub page_load(ByVal sender As Object, ByVal e As System.Eventarts) Handles Me.Load
  Mybase.Sub_OverheadClass_Load(e)
End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T16:15:32.423

你的默认页面应该继承 OverheadClass

```
 Partial Public Class _Default
        Inherits OverheadClass

        Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
            'Do some page stuff'
        End Sub
    End Class 
```

并且 OverheadClass 应该继承 System.Web.UI.Page

```
Public Class OverheadClass
    Inherits System.Web.UI.Page
    Public Sub Sub_OverheadClass_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles MyClass.Load
        'Do some base stuff'
    End Sub
End Class 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T16:32:50.907

```
 Partial Class OverheadClass
    Inherits System.Web.UI.Page

    Protected Overrides Sub OnLoad(ByVal e As System.EventArgs) 
       MyBase.OnLoad(e)
    End Sub
End Class

Partial Class _Default
    Inherits OverheadClass

    Protected Overrides Sub OnLoad(ByVal e As System.EventArgs) 
       MyBase.OnLoad(e)
    End Sub
End Class 
```

# java - 在 Dalvik VM（Android 的 VM）上，您不能在 Sun VM 中做什么？

> ID：230193
> 
> 赞同：57
> 
> 时间：2008-10-23T15:30:13.280
> 
> 标签：java, android, jvm, dalvik

我知道你可以在*Dalvik 的 VM*中运行几乎所有的 Java，你可以在*Java 的 VM*中运行，但是限制不是很清楚。有没有人遇到任何主要的绊脚石？有什么大图书馆有问题吗？任何编译成 Java 字节码的语言（**Scala**、**Jython**等）都不能按预期工作？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-23T20:07:23.890

有很多东西是 Dalvik 不会处理或不会以与标准 Java 字节码完全相同的方式处理的，尽管它们中的大多数都非常先进。

最**严重的例子是运行时字节码生成**和自定义类加载。假设您想创建一些字节码，然后使用类加载器为您加载它，如果该技巧在您的普通机器上有效，则保证在 Dalvik 上无效，除非您更改字节码生成。

这会阻止您使用某些依赖注入框架，最著名的例子是 Google Guice（尽管我相信有些人在做这件事）。另一方面，AspectJ 应该可以工作，因为它使用字节码检测作为编译步骤（尽管我不知道是否有人尝试过）。

至于其他 jvm 语言——最终编译为标准字节码并且在运行时不使用字节码检测的任何东西都可以转换为 Dalvik 并且应该可以工作。我知道人们确实在 Android 上运行了 Jython，而且运行良好。

需要注意的另一件事是**没有及时编译**。这不是严格意义上的 Dalvik 问题（如果你愿意，你可以随时编译任何字节码），但 Android 不支持，而且不太可能这样做。实际上，虽然标准 Java 的微基准测试毫无用处——组件在测试中的运行时特性与作为大型系统的一部分不同——但 Android 手机的微基准测试完全有意义。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-03-05T19:06:21.103

如果您看到“ [Dalvik Virtual Machine internals](http://www.youtube.com/watch?v=ptjedOZEXPM) ”Google IO 会话，您会发现 Dalvik 不支持分[代 GC](http://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29#Generational_GC_.28aka_Ephemeral_GC.29)。

因此，它可能会降低频繁创建和删除对象的性能。Java VM 支持分代 GC，因此在相同情况下它会表现出更好的 GC 性能。

此外，Dalvik 使用[跟踪粒度 JIT](http://dl.google.com/googleio/2010/android-jit-compiler-androids-dalvik-vm.pdf)代替方法粒度 JIT。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-14T16:36:18.037

我想可以在这里添加的另一件事是，Dalvik 在使用反射 API 列出类的字段时显然不保留字段顺序。现在，反射 API 无论如何都不会对它做出任何保证（所以理想情况下，无论如何你都不应该依赖它），但大多数其他 VM*确实*保留了顺序。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2014-03-15T04:04:28.843

只是为了增加对话，而不是为了恢复旧线程。我刚刚在搜索中遇到了这个问题，并想补充一点，Jython 也不能与 Dalvik 一起使用。简单地尝试做一个 hello world 示例将产生以下结果：

# sql - 在 Oracle 更新语句中使用子查询而不是表名

> ID：230196
> 
> 赞同：13
> 
> 时间：2008-10-23T15:30:37.973
> 
> 标签：sql, oracle

我需要编写一个使用多个表来确定要更新哪些行的更新语句，因为在 Oracle 中，不允许多个表。以下查询将返回“ORA-00971：缺少 SET 关键字”错误

```
UPDATE
  TABLE1 a,
  TABLE2 b
SET
  a.COL1 = 'VALUE'
WHERE
  a.FK = b.PK
  AND b.COL2 IN ('SET OF VALUES') 
```

在 oracle 上查找 UPDATE 语句语法，我找到了以下[链接](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/update_statement.htm)，这表明您可以使用子查询来代替表名。

当我尝试编写这样的查询时，我得到了“ORA-01779：无法修改映射到非键保留表的列”

```
UPDATE
  (
    SELECT
      a.COL1
    FROM
      TABLE1 a,
      TABLE2 b
    WHERE
      a.FK = b.PK
      AND b.COL2 IN ('SET OF VALUES')
  ) update_tbl
SET
  update_tbl.COL1 = 'VALUE' 
```

我确实使用 EXISTS 语句重写了查询（如下所示），它工作正常，但仍然想知道这是如何完成的。

```
UPDATE
  TABLE1 update_tbl
SET
  update_tbl.COL1 = 'VALUE'
WHERE
  EXISTS (
    SELECT
      1
    FROM
      TABLE1 a
      TABLE2 b
    WHERE
      a.FK = b.PK
      AND b.COL2 IN ('SET OF VALUES')
      AND update_tbl.PK = a.PK
  ) 
```

谢谢！-内特

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-23T15:41:43.973

另外一个选项：

```
UPDATE TABLE1 a
SET a.COL1 = 'VALUE'
WHERE a.FK IN
( SELECT b.PK FROM TABLE2 b
  WHERE b.COL2 IN ('SET OF VALUES')
) 
```

如果（a）视图包含TABLE1的**声明PK，则您的第二个示例将起作用：**

```
UPDATE
  (
    SELECT
      a.COL1, a.PKCOL
    FROM
      TABLE1 a,
      TABLE2 b
    WHERE
      a.FK = b.PK
      AND b.COL2 IN ('SET OF VALUES')
  ) update_tbl
SET
  update_tbl.COL1 = 'VALUE' 
```

...和 ​​(b) TABLE1.FK 是 TABLE2 的**声明**外键

（通过声明，我的意思是约束存在并且已启用）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-24T10:53:00.950

我发现将 SELECT 语句转换为 UPDATE 的一种很好、快速、一致的方法是根据 ROWID 进行更新。

```
UPDATE
  TABLE1
SET
  COL1 = 'VALUE'
WHERE
  ROWID in
    (
    SELECT
      a.rowid
    FROM
      TABLE1 a,
      TABLE2 b
    WHERE
      a.FK = b.PK
      AND b.COL2 IN ('SET OF VALUES')
    ) 
```

因此，您的内部查询正在定义要更新的行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T18:24:05.347

您的示例的语法很好，但 Oracle 要求子查询包含主键。这是一个非常重要的限制。

在相关说明中，您还可以使用括号在 IN 语句中使用 2 个或更多字段，如下所示：

```
UPDATE
  TABLE1 update_tbl
SET
  update_tbl.COL1 = 'VALUE'
WHERE
  (update_tbl.PK1, update_tbl.pk2) in(
                      select some_field1, some_field2
                      from some_table st
                      where st.some_fields = 'some conditions'
                      ); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T18:05:41.843

当您执行更新时，您显然只能告诉系统将值更新为一个新值——告诉它将“X”更新为“Y”和“Z”是没有意义的。因此，当您基于内联视图的结果进行更新时，Oracle 会检查是否有足够的约束来防止修改的列可能被更新两次。

在您的情况下，我希望 TABLE2.PK 实际上不是已声明的主键。如果您在该列上放置主要或唯一约束，那么您会很高兴。

有一个未记录的提示可以绕过 Oracle 内部使用的更新连接基数检查，但我不建议使用它。

一种解决方法是使用 MERGE 语句，该语句不受相同的测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-27T04:34:31.120

我在这里找到了我需要的东西： [有用的 SQL 命令](http://infolab.stanford.edu/~ullman/fcdb/oracle/or-plsql.html)

我需要用连接结果更新一个表
我尝试了上述解决方案但没有成功:(

这是我在上面指出的页面的摘录
使用游标我能够成功完成任务
我确信还有另一种解决方案但是这个解决方案很有效......

```
DECLARE

 /* Output variables to hold the result of the query: */
 a T1.e%TYPE;
 b T2.f%TYPE;
 c T2.g%TYPE;

 /* Cursor declaration: */
 CURSOR T1Cursor IS
   SELECT T1.e, T2.f, T2.g
   FROM T1, T2
   WHERE T1.id = T2.id AND T1.e <> T2.f

 FOR UPDATE;

BEGIN

  OPEN T1Cursor;

  LOOP

    /* Retrieve each row of the result of the above query
    into PL/SQL variables: */
    FETCH T1Cursor INTO a, b;

    /* If there are no more rows to fetch, exit the loop: */
    EXIT WHEN T1Cursor%NOTFOUND;

    /* Delete the current tuple: */
    DELETE FROM T1 WHERE CURRENT OF T1Cursor;

    /* Insert the reverse tuple: */
    INSERT INTO T1 VALUES(b, a);

    /* Here is my stuff using the variables to update my table */
    UPDATE T2
    SET T2.f = a
    WHERE T2.id = c;

  END LOOP;

  /* Free cursor used by the query. */
  CLOSE T1Cursor;

END;
.
run; 
```

注意：不要忘记提交 ;-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T15:35:18.963

UPDATE 子句中查询结果集中的每一行都必须映射回您尝试更新的表中的一行且只有一行，并且 Oracle 可以自动更新。由于查询实际上是一个视图，因此考虑它的一种方式是 Oracle 需要能够将视图连接回目标表，以便知道要更新哪一行。

这实质上意味着您需要在该查询中包含目标表的主键。您也可以使用其他一些唯一索引字段，但我不能保证 Oracle DBMS 足够聪明以允许这样做。

# java - 按文件名过滤eclipse中的警告

> ID：230199
> 
> 赞同：3
> 
> 时间：2008-10-23T15:32:02.900
> 
> 标签：java, eclipse, development-environment

我们使用 Eclipse 进行 Java 开发，并且我们让 Maven 将我们的 JSP 编译成 servlet，以便在我们的嵌入式 Jetty 实例中使用。这意味着要从 Eclipse 运行项目，我必须将 ./target/jsp-source 作为源文件夹包含在内，这非常有用。但是，为生成的代码显示的警告无处不在，我想将它们过滤掉。

mainMenu_jsp.java 有关于未使用局部变量的警告。它是生成的代码，所以我不关心它，但我不知道如何通过文件名模式过滤掉任何警告。

**我知道我可以定义一个工作集**，但因为我总是在打开、关闭，有时还会添加和删除项目，所以我不想要另一个我必须保持最新的手动簿记点。如果我添加一个新项目并忘记将其添加到工作集中，我将不会收到任何警告，对于所有其他项目，我可能不会注意到。工作集只有在有办法将它们设置为动态扩展以包括所有项目（不仅仅是现在），并且在添加时自动将其过滤应用于每个新项目时才能真正起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T04:21:05.157

只需使用工作集。有关如何在此处执行此操作的详细信息： [Excluding Unfixables from Eclipse Problem View](https://stackoverflow.com/questions/783902/excluding-disabling-validation-in-eclipse)

在这里： [Eclipse 问题视图](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/cprbview.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-14T20:46:34.620

[使用工作集] 在很多情况下都不起作用。

例如，Android Eclipse 插件将代码生成到*同一个*项目中。

工作集由一个或多个项目组成，因此工作集无法过滤掉项目内生成的警告。

* * *

**编辑：**

我学到了一些非常有用的东西：工作集可以过滤掉部分项目。这很简单——单击工作集编辑器左窗格中的项目并展开它。然后只添加你想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T06:47:34.817

一个工作集适用于多个项目。我建议你尝试使用一个。

# javascript - 如何从 Javascript 调用打印预览？

> ID：230205
> 
> 赞同：63
> 
> 时间：2008-10-23T15:33:57.513
> 
> 标签：javascript, printing

我有一个页面应该在加载时启动打印预览页面。

我找到了这个：

```
var OLECMDID = 7;
/* OLECMDID values:
* 6 - print
* 7 - print preview
* 1 - open window
* 4 - Save As
*/
var PROMPT = 1; // 2 DONTPROMPTUSER
var WebBrowser = '<OBJECT ID="WebBrowser1" WIDTH=0 HEIGHT=0 CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2"></OBJECT>';
document.body.insertAdjacentHTML('beforeEnd', WebBrowser);
WebBrowser1.ExecWB(OLECMDID, PROMPT);
WebBrowser1.outerHTML = ""; 
```

但...

1.  它在 FireFox 中不起作用。
2.  这有点丑。

是否有更好的 IE 方式或适用于 FireFox 的方式？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-23T15:38:38.707

你不能，打印预览是浏览器的一项功能，因此应该防止被 JavaScript 调用，因为这会带来安全风险。

这就是您的示例使用 Active X 的原因，它绕过了 JavaScript 安全问题。

因此，请改为使用您已经拥有的打印样式表并将其显示为 media=screen,print 而不是 media=print。

阅读[Alist Apart: Going to Print](http://www.alistapart.com/articles/goingtoprint/)以获取有关打印样式表主题的好文章。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-23T15:40:27.580

我认为跨浏览器 JavaScript 中最好的可能是`window.print()`，它（在 Firefox 3 中，对我来说）显示了“打印”对话框，而不是打印预览对话框。

仅供参考，*打印对话框*是您计算机的打印弹出窗口，当您执行 Ctrl-p 时会得到什么。*打印预览*是 Firefox 自己的预览窗口，它有更多的选项。这就是您使用 Firefox 菜单 > 打印...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-05-21T05:19:25.010

可以使用 javascript 来完成。假设您的 html/aspx 代码是这样的：

```
<span>Main heading</span>
<asp:Label ID="lbl1" runat="server" Text="Contents"></asp:Label>
<asp:Label Text="Contractor Name" ID="lblCont" runat="server"></asp:Label>
<div id="forPrintPreview">
  <asp:Label Text="Company Name" runat="server"></asp:Label>
  <asp:GridView runat="server">

      //GridView Content goes here

  </asp:GridView
</div>

<input type="button" onclick="PrintPreview();" value="Print Preview" /> 
```

在这里单击“打印预览”按钮，我们将打开一个包含打印数据的窗口。观察“forPrintPreview”是一个 div 的 id。打印预览的功能是这样的：

```
function PrintPreview() {
 var Contractor= $('span[id*="lblCont"]').html();
 printWindow = window.open("", "", "location=1,status=1,scrollbars=1,width=650,height=600");
 printWindow.document.write('<html><head>');
 printWindow.document.write('<style type="text/css">@media print{.no-print, .no-print *{display: none !important;}</style>');
 printWindow.document.write('</head><body>');
 printWindow.document.write('<div style="width:100%;text-align:right">');

  //Print and cancel button
 printWindow.document.write('<input type="button" id="btnPrint" value="Print" class="no-print" style="width:100px" onclick="window.print()" />');
 printWindow.document.write('<input type="button" id="btnCancel" value="Cancel" class="no-print"  style="width:100px" onclick="window.close()" />');

 printWindow.document.write('</div>');

 //You can include any data this way.
 printWindow.document.write('<table><tr><td>Contractor name:'+ Contractor +'</td></tr>you can include any info here</table');

 printWindow.document.write(document.getElementById('forPrintPreview').innerHTML);
 //here 'forPrintPreview' is the id of the 'div' in current page(aspx).
 printWindow.document.write('</body></html>');
 printWindow.document.close();
 printWindow.focus();
} 
```

观察按钮 'print' 和 'cancel' 有 css 类 'no-print'，所以这些按钮不会出现在打印中。

# visual-studio-2008 - Visual Studio 2008 中的颜色

> ID：230226
> 
> 赞同：7
> 
> 时间：2008-10-23T15:38:01.703
> 
> 标签：visual-studio-2008, colors

我在 Visual Studio 2008 上苦苦挣扎。我使用某种形式的“Zen”颜色的次数超出了我的记忆范围。在 VS2008 中，我不断得到一种我无法阅读且无法识别的颜色；问题的目的是避免试错（VS颜色界面真的很难看，没有“实时”应用按钮）。

如果你看下图，我正在调试，上面的函数调用了下面的函数。问题是上部函数中的调用行变成白色（背景）并且难以阅读。

问题是：有人知道什么确切的设置可以让我改变吗？

提前致谢。

![射击](https://i.stack.imgur.com/mb5Bi.jpg)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T15:42:32.240

这描述了所有这些颜色选项的含义。

我认为您正在寻找的是“回电”

[http://msdn.microsoft.com/en-us/library/kw7t0545.aspx](http://msdn.microsoft.com/en-us/library/kw7t0545.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T15:44:36.447

我认为这是您在文本编辑器下的回电。

# actionscript - 在 swf 中使用的神秘资产，在 fla 的任何地方都找不到？

> ID：230230
> 
> 赞同：2
> 
> 时间：2008-10-23T15:38:38.660
> 
> 标签：actionscript, flash, fla

在代码顶部附近，我看到了类似的东西，

btn_dropdown._visible = false; mcMenuBkg._visible = false;

但是我在库或任何代码中的任何地方都找不到这些资产，这有什么意义？

库中看起来相同的影片剪辑具有不同的名称，我可以将它们完全删除，并且在我编译和运行时它们仍然会显示出来，或者我可以将跟踪语句添加到它们的代码中并且它们永远不会被调用。

这些资产到底是在哪里定义的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T02:55:20.090

理论上，您在运行时看到的任何剪辑都可以通过创建一个空的 MC 并使用绘图 API 绘制您喜欢的任何内容来动态创建。但是，如果您在库中看到与运行时显示的内容相似的剪辑，那么这种情况不太可能发生。

您的第一步可能应该是再次浏览库。请记住，实例名称不必与 MC 名称相同；即使库中的某些东西被称为“菜单持有者”，也可能在某个地方有一个名为“mcMenuBkg”或其他名称的实例。但是你可以在不改变输出的情况下删除东西的事实是神秘的。

因此，还有其他可能性：内容正在外部加载，或通过运行时共享导入。如果可行，请尝试将您的 SWF 移动到临时目录并从那里运行它；这应该会破坏所有负载（除非内容是从远程 URL 加载的）。

或者，您正在查看库中的错误剪辑。如果这是一个粗鲁的项目，那里可能会有未使用的东西。尝试将库扩展得足够宽以查看“使用计数”列，然后从库菜单中选择“更新使用计数”。任何计数为 1 或更高的内容都是您的 FLA 舞台内容的一部分——它要么位于主舞台上，要么是某个东西的子级。使用计数为 0 的剪辑如果具有链接 ID，则仍可使用；它们可以在运行时使用`attachMovie()`. 但是，对于使用计数为 0 且没有链接 ID 的任何剪辑，可以安全地假设它未使用，并且与运行时发生的情况无关。

如果这些都没有帮助，唯一能想到的就是健全性检查……打开舞台上的所有东西和每个带有链接 ID 的剪辑，并检查空/不可见的 MC。检查电影的导出设置，以确保您检查的 SWF 与正在发布的 SWF 相同。只是为了笑，打开“场景”面板并确保某些恶魔没有将重要内容放在没有理智的人会寻找的单独场景中。

模糊问题的模糊答案。:D 希望对你有帮助...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T21:21:17.640

您可以使用代码动态创建影片剪辑。

这意味着如果您无法找到它们，您的资产中可能没有它们。

您可以仅使用 actionscript 凭空使用构造函数创建任何类型的符号。

我会搜索其中之一的代码

```
var mybutton:SimpleButton=new SimpleButton(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T09:03:55.447

如果他们被设置为

```
_visible = false 
```

无论如何您都不会看到它们 - 由于 ActionScript 1/2 不进行运行时错误报告，因此如果它们实际上不在舞台上，Flash 播放器将不会抱怨。如果它们没有被使用，只需删除它们。

# sql - MS access(2003) 是否有任何可与存储过程相媲美的东西。我想在 MS 访问中运行一个复杂的查询

> ID：230241
> 
> 赞同：9
> 
> 时间：2008-10-23T15:40:24.583
> 
> 标签：sql, ms-access, stored-procedures, ms-office

我有一张桌子，叫它 TBL。它有两列，分别称为 A 和 B。现在在查询中，我需要一列作为 A，另一列应该是一个逗号分隔的列表，其中包含 TBL 中与 A 对抗的所有 B。比如TBL是这样的

1 阿尔法

2 测试版

1 伽玛

1 三角洲

查询结果应该是

1 阿尔法，伽马，三角洲

2 测试版

这种类型的事情很容易用存储过程中的游标来完成。但我无法通过 MS Access 来完成，因为显然它不支持存储过程。有没有办法在 MS 访问中运行存储过程？或者有没有办法通过 SQL 来运行这种类型的查询

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-23T21:17:08.493

您可以使用用户定义函数 (UDF) 连接记录。

下面的代码可以“按原样”粘贴到标准模块中。您的示例 SQL 将是：

```
SELECT tbl.A, Concatenate("SELECT B  FROM tbl
        WHERE A = " & [A]) AS ConcA
FROM tbl
GROUP BY tbl.A 
```

此代码由 Access MVP DHookom 提供，取自[http://www.tek-tips.com/faqs.cfm?fid=4233](http://www.tek-tips.com/faqs.cfm?fid=4233)

```
Function Concatenate(pstrSQL As String, _
        Optional pstrDelim As String = ", ") _
            As String
    'example
    'tblFamily with FamID as numeric primary key
    'tblFamMem with FamID, FirstName, DOB,...
    'return a comma separated list of FirstNames
    'for a FamID
    '    John, Mary, Susan
    'in a Query
    '(This SQL statement assumes FamID is numeric)
    '===================================
    'SELECT FamID,
    'Concatenate("SELECT FirstName FROM tblFamMem
    '     WHERE FamID =" & [FamID]) as FirstNames
    'FROM tblFamily
    '===================================
    '
    'If the FamID is a string then the SQL would be
    '===================================
    'SELECT FamID,
    'Concatenate("SELECT FirstName FROM tblFamMem
    '     WHERE FamID =""" & [FamID] & """") as FirstNames
    'FROM tblFamily
    '===================================

    '======For DAO uncomment next 4 lines=======
    '======     comment out ADO below    =======
    'Dim db As DAO.Database
    'Dim rs As DAO.Recordset
    'Set db = CurrentDb
    'Set rs = db.OpenRecordset(pstrSQL)

    '======For ADO uncomment next two lines=====
    '======     comment out DAO above     ======
    Dim rs As New ADODB.Recordset
    rs.Open pstrSQL, CurrentProject.Connection, _
            adOpenKeyset, adLockOptimistic
    Dim strConcat As String 'build return string
    With rs
        If Not .EOF Then
            .MoveFirst
            Do While Not .EOF
                strConcat = strConcat & _
                    .Fields(0) & pstrDelim
                .MoveNext
            Loop
        End If
        .Close
    End With
    Set rs = Nothing
    '====== uncomment next line for DAO ========
    'Set db = Nothing
    If Len(strConcat) > 0 Then
        strConcat = Left(strConcat, _
            Len(strConcat) - Len(pstrDelim))
    End If
    Concatenate = strConcat
End Function 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T16:32:48.783

我相信您可以创建 VBA 函数并在访问查询中使用它们。那可能对你有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T15:47:45.957

据我所知，没有一种方法可以在 Access 数据库中运行存储过程。但是，如果将 Access 用于 SQL 后端，则它可以执行存储过程。如果您不能将 UI 拆分为 Access 并将数据拆分为 SQL，那么您最好的选择可能是编写一个 VBA 模块来为您提供所需的输出。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T18:17:55.173

要完成您的任务，您将需要使用代码。一种使用更有意义的名称的解决方案如下：

具有两个适用列的主表：

> 表名：小部件
> 
> 字段 1：ID（长）
> 
> 字段 2：颜色（文本 32）

添加具有两列的表：

> 表名：ColorListByWidget
> 
> 字段 1：ID（长）
> 
> 字段 2：颜色列表（文本 255）

将以下代码添加到模块并根据需要调用以更新 ColorListByWidget 表：

```
Public Sub GenerateColorList()

Dim cn As New ADODB.Connection
Dim Widgets As New ADODB.Recordset
Dim ColorListByWidget As New ADODB.Recordset
Dim ColorList As String

Set cn = CurrentProject.Connection

cn.Execute "DELETE * FROM ColorListByWidget"
cn.Execute "INSERT INTO ColorListByWidget (ID) SELECT ID FROM Widgets GROUP BY ID"

With ColorListByWidget
   .Open "ColorListByWidget", cn, adOpenForwardOnly, adLockOptimistic, adCmdTable
   If Not (.BOF And .EOF) Then
      .MoveFirst
      Do Until .EOF
         Widgets.Open "SELECT Color FROM Widgets WHERE ID = " & .Fields("ID"), cn
         If Not (.BOF And .EOF) Then
            Widgets.MoveFirst
            ColorList = ""
            Do Until Widgets.EOF
               ColorList = ColorList & Widgets.Fields("Color").Value & ", "
               Widgets.MoveNext
            Loop
         End If
         .Fields("ColorList") = Left$(ColorList, Len(ColorList) - 2)
         .MoveNext
         Widgets.Close
      Loop
   End If
End With

End Sub 
```

ColorListByWidget 表现在包含您想要的信息。注意列表（本例中的颜色）不超过 255 个字符。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T16:04:03.897

没有存储过程，没有临时表。

如果您需要将查询作为记录集返回，您可以使用断开连接的记录集。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T02:58:12.843

也许与其询问 Jet 是否有存储过程，不如说明您想要完成什么，然后我们可以解释如何使用 Jet 来完成它（不清楚您是使用 Access 作为您的应用程序，还是仅使用 Jet MDB 作为您的数据存储）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T15:49:29.653

好吧，您可以使用 Recordset 对象在 VBA 中循环查询，根据您需要的任何条件连接字段值。

如果你想将结果作为字符串返回，你会没事的。如果您想将它们作为查询返回，那将更加复杂。您可能必须创建一个临时表并将结果存储在其中，以便您可以将它们作为表或查询返回。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T21:28:29.437

您可以在 VBA 中使用 GetString，它将返回由您喜欢的任何值分隔的记录集（例如逗号、破折号、表格单元格等），尽管我必须承认我只在 VBScript 中使用过它，而不是在 Visual Basic 中使用它。[W3Schools 有一个很好的教程，希望能满足您的需要](http://www.w3schools.com/ADO/met_rs_getstring.asp)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T22:30:52.557

您可以将存储过程编写为文本并将其发送到数据库：

```
Dim sp as string
sp = "your stored procedure here" (you can load it from a text file or a memo field?)

Access.CurrentProject.AccessConnection.Execute sp 
```

这假设您正在使用 ADODB 对象（ActiveX 数据对象库在您的应用程序中被 coorectly 引用）。

我确信DAO有类似的东西......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-24T08:00:21.300

@Remou 谈 DHookom 的 Concatenate 函数：SQL 标准和 Jet 都没有`CONCATENATE()`set 函数。简单地说，这是因为它违反了 1NF。我更愿意在应用程序端执行此操作，而不是尝试强制 SQL 执行它不打算执行的操作。也许 ACE (Access2007) 的多值类型更合适：仍然是 NFNF，但至少有引擎级别的支持。请记住，问题与*存储*对象有关：用户如何使用 SQL 查询非标量列...？

@David W. Fenton 关于 Jet 是否有存储过程：几年前你和我没有在新闻组中讨论过这个问题。从 4.0 版开始，Jet/ACE 在 ANSI-92 查询模式中支持以下语法：

```
CREATE PROCEDURE procedure (param1 datatype[, param2 datatype][, ...]) AS sqlstatement;

EXECUTE procedure [param1[, param2[, ...]]; 
```

所以 Jet 正在创建和执行它知道的东西（至少在一种模式下）作为“存储”在 MDB 文件中的“过程”。然而，Jet/ACE SQL 是纯粹而简单的：它没有控制流的语法，并且`PROCEDURE`只能包含一条 SQL 语句，因此任何*过程*代码都是不可能的。因此，Jet 是否有存储过程的答案是主观的。

# php - __destruct PHP 的可见性

> ID：230245
> 
> 赞同：21
> 
> 时间：2008-10-23T15:40:46.143
> 
> 标签：php, oop, visibility

该功能的“可见性”应该`__destruct()`是公开的还是其他的？我正在尝试为我的团队编写标准文档，但出现了这个问题。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-23T16:13:55.220

除了 Mark Biek 的回答：

__destruct() 函数必须声明为 public。否则，该函数将不会在脚本关闭时执行：

```
Warning: Call to protected MyChild1::__destruct() from context '' during shutdown ignored in Unknown on line 0
Warning: Call to private MyChild2::__destruct() from context '' during shutdown ignored in Unknown on line 0 
```

这可能不是有害的，而是不洁的。

但最重要的是：如果析构函数被声明为私有或受保护的，则运行时将在垃圾收集器尝试释放对象的那一刻抛出一个致命错误：

```
<?php
class MyParent
{
    private function __destruct()
    {
        echo 'Parent::__destruct';
    }
}

class MyChild extends MyParent
{
    private function __destruct()
    {
        echo 'Child::__destruct';
        parent::__destruct();
    }
}

$myChild = new MyChild();
$myChild = null;
$myChild = new MyChild();

?> 
```

输出

```
Fatal error: Call to private MyChild::__destruct() from context '' in D:\www\scratchbook\destruct.php on line 20 
```

（感谢 Mark Biek 提供的出色示例！）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-23T15:43:42.767

我认为在子类需要显式调用父类的**__destruct**方法的情况下，它需要是公共的。

这样的事情会引发错误：

```
<?php
class MyParent
{
    private function __destruct()
    {
        echo 'Parent::__destruct';
    }
}

class MyChild extends MyParent
{
    function __destruct()
    {
        echo 'Child::__destruct';
        parent::__destruct();
    }
}

$myChild = new MyChild();
?> 
```

# oracle - 如何读取 Oracle Forms .FMT 文件中的 PL/SQL 代码？

> ID：230248
> 
> 赞同：4
> 
> 时间：2008-10-23T15:41:27.157
> 
> 标签：oracle, oracle10g, oracleforms

Oracle Forms10g 提供了一个工具来将 Oracle Forms 模块从 Oracle Forms Builder 使用的二进制格式 (.FMB) 转换为文本格式 (.FMT)。

例如，如果您使用 Oracle Forms Builder 创建一个名为*mymodule.fmb*的模块，然后调用

```
frmcmp module=mymodule.fmb script=yes batch=yes logon=no 
```

从命令行，Oracle Forms Convert 实用程序将从文件 mymodule.fmb 创建一个名为*mymodule.fmt**的*文件。这个文本文件应该是人类“可读的”，除了触发器和程序单元的 PL/SQL 代码，这是编码的。

 *例如，这是一个 .FMT 文件的片段，其中包含一段编码的 PL/SQL 代码

```
DEFINE  F50P
BEGIN
   PP = 10
   PI = 3
   PN = 464
   PL = 1138
   PV = (BLONG)
<<"
00000049 00800000 00440000 00000000 00000031 0000000d 00000002 a0011519 
00002420 0000045e 001f0000 00165030 5f32335f 4f43545f 32303038 31365f33 
375f3039 00000006 42454749 4e0a0000 0042676f 5f626c6f 636b2820 27504149 
53455327 20293b0a 69662066 6f726d5f 73756363 65737320 7468656e 0a096578 
65637574 655f7175 6572793b 0a656e64 2069663b 00000005 0a454e44 3b000000 
1d574845 4e2d4e45 572d464f 524d2d49 4e535441 4e434520 28466f72 6d290000 
```

您是否曾尝试解码此类文件，以便能够提取表单的 PL/SQL 代码？

如果能够在大量 .FMT 文件的 PL/SQL 代码中搜索字符串，而不是使用 Oracle Forms Builder 手动打开每个对应的 .FMB 文件，并在每个文件中搜索字符串，这将非常有用其中。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-24T20:55:48.600

除了 API 之外，请注意，如果您在此过程的开始工作，则生成 XML 版本可能会比 FMT 版本更好。FMT 是一种较旧的格式，为了向后兼容而保留，最近发布的 Forms -> Oracle APEX 转换器等工具将需要 XML。它也更容易阅读。

在“Forms 10g release 1”（9.0.4）中，XML 转换器是一个单独的命令行程序。表单2xml。我认为对于 10.1 来说仍然如此

此外，XML 更易于阅读和解释。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T19:46:57.193

字节只是字符的十六进制值。例如：取第 4 行并将其放入以下 ​​python 代码中：

```
[chr(x) for x in [0x53,0x45,0x53,0x27 ,0x20,0x29,0x3b,0x0a ,0x69,0x66,0x20,0x66 ,0x6f,0x72,0x6d,0x5f ,0x73,0x75,0x63,0x63 ,0x65,0x73,0x73,0x20 ,0x74,0x68,0x65,0x6e ,0x0a,0x09,0x65,0x78]] 
```

给出以下输出：

```
['S', 'E', 'S', "'", ' ', ')', ';', '\n', 'i', 'f', ' ', 'f', 'o', 'r', 'm', '_', 's', 'u', 'c', 'c', 'e', 's', 's', ' ', 't', 'h', 'e', 'n', '\n', '\t', 'e', 'x'] 
```

这是可识别的形式 pl/sql。因此，创建一个脚本来获取 FMT 文件目录并生成带有可搜索文本的相应文件似乎不会有太多工作。
玩得开心！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T18:19:15.920

Oracle Forms 9i 及更高版本有一个编程 API，允许您完全按照您的描述进行操作。您需要查看您的 Forms 文档才能执行此操作，但它可能比尝试提取二进制字符串更快。

如果您愿意为现有工具付费，请使用以下工具：

[http://www.orcl-toolbox.com/](http://www.orcl-toolbox.com/)

他们的 formsAPI 和 FormsTools 允许您对表单进行提取、比较、更改和更新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T19:25:40.307

根据[this](http://www.orafaq.com/usenet/comp.databases.oracle.tools/2004/03/31/0352.htm) page作者有一个perl脚本将十六进制转换回ascii文本（他说给他发一封电子邮件，他会发送）

# c# - SelectedValue 无效 - 列表中不存在 - C#/ASP.NET

> ID：230250
> 
> 赞同：1
> 
> 时间：2008-10-23T15:41:31.353
> 
> 标签：c#, asp.net

例外情况是：“国家/地区”的 SelectedValue 无效，因为它不存在于项目列表中。参数名称：值

```
UserService.DsUserAttributes dsCountry = us_service.GetUserAttributeDropDown(systemId, "Country");
Country.DataSource = dsCountry.tblDropDownValues;
Country.DataTextField = "AttrValue";
Country.DataValueField = "Id";
Country.DataBind(); 
```

dsCountry.tblDropDownValues 中保存的值是：

```
Id                                      AttrValue       AttrName
aefa28e0-a118-11dd-ad8b-080c210c9a66    PLEASE SELECT   Country
213a743e-ea0b-419c-bd44-03b1c35241b3    USA         Country
eefa1387-8dc0-11d8-975f-13da67a41a5d    CANADA          Country 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:49:40.337

尝试在回发时绑定数据。听起来当事件处理程序访问 DropDownList 时，它没有被重新填充您最初绑定到 DropDownList 的值。

另外，请记住要尽早绑定，以便在事件处理程序开始处理之前绑定它。OnInit 或 OnLoad 应该足够好。

否则，可能需要更多详细信息：

1.  什么时候发生异常？在渲染期间，还是在事件处理程序中的回发？
2.  您是否有关于错误的堆栈跟踪，可能指向代码中访问所选值的点？
3.  什么时候绑定数据？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T16:13:03.537

每次我收到此错误时，都是因为我为绑定数据而匹配的键不匹配。

您显示的线条可能不是问题。查看您何时可能从另一个表加载记录并将它们的值绑定到下拉列表中。

例如，如果您的页面上有一个下拉列表，其中包含您的所有国家名称，国家 ID 作为 Value-behinds 这些值都存储在表 CountryTbl 中。您在页面上还有一个网格，用户可以在其中从另一个表中选择他们想要编辑的记录。假设这条记录包含姓名、电话号码和国家/地区等信息，并且它们都存储在另一个表 UserTbl 中。当表单试图绑定来自 UserTbl 的数据时，它试图将 Country DropDownList 设置为等于来自 UserTbl 的绑定值。

但是可能发生的事情，并且发生在我身上很多次，是您的 UserTbl 中有错误的数据，例如不再存在的 Country，或者其 Country 字段中的另一个值与您的任何值都不匹配国家下拉菜单。

查看您的数据库表，看看您的“UserTbl”中是否有任何 CountryIds 与“CountryTbl”中的任何 ContryIds 都不匹配。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T15:57:48.153

这也可能是由于您绑定到下拉列表的源数据中有空值。

# java - Mac OS 10.5 上的 Java 1.6 SDK

> ID：230253
> 
> 赞同：6
> 
> 时间：2008-10-23T15:42:16.623
> 
> 标签：java, macos

Java 1.6 SDK 是否已发布用于 mac？我好像找不到...

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-23T15:46:55.320

可以，但仅适用于基于 Intel 的 64 位 Mac，即使用 Core 2（双核或单核）或 Xeon 芯片的 Mac。不支持原装Core芯片，也不支持任何PPC芯片。此外，Java 6 目前仅支持 Leopard。如果您有兼容的 Mac 和足够新的操作系统版本，则更新应该出现在软件更新中。

这是第[一次更新](http://developer.apple.com/releasenotes/Java/JavaLeopardUpdate1RN/Introduction/chapter_1_section_1.html)的发行说明。这是[第二个更新](http://developer.apple.com/releasenotes/Java/JavaLeopardUpdate2RN/Introduction/chapter_1_section_1.html)的发行说明。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-23T16:00:04.920

如果您没有基于 Intel 的 64 位 Mac，您可能还会对[SoyLatte](http://landonf.bikemonkey.org/static/soylatte/)感兴趣，它是基于 FreeBSD 版本的 Java 1.6 的基于 X11 的独立端口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T15:55:38.797

大约一个月前，Apple 发布了 1.6_07。考虑到他们花了多长时间才把 07 拿出来，在 2010 年左右寻找 1.6_10。如前所述，它仅适用于 64 位 Mac。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T15:57:13.630

如果您没有看到它，您可能需要前往[Apple 的 Developers Connection](http://developer.apple.com/referencelibrary/Java/)。如果您想下载 Java，您可能需要注册一个免费帐户。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T19:03:45.983

正如 msanders 所说，SoyLatte 在紧要关头可能会很好，但请注意，SoyLatte 的最新版本 1.0.3 是 Java 1.6.0_03。Sun 的最新版本是 1.6_10。这可能与您正在做的事情无关，但您应该牢记这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-29T20:39:39.707

[您可以在此处](http://www.intricatesoftware.com/OpenJDK/macppc/openjdk7u2-macppc-fcs-2012-03-14.tar.bz2)下载 OpenJDK 1.7 版本

I'm running it on 10.5.8, on a PPC ("cheese grater",) with Eclipse 4.3.2 / Kepler, and it all seems to work fine. :-)
(though, in honesty, a new configuration on the box, so we'll see how it goes over time)

# scripting - 随机图像作为与图像关联的链接

> ID：230257
> 
> 赞同：0
> 
> 时间：2008-10-23T15:43:39.773
> 
> 标签：scripting, random

我正在寻找一个脚本，该脚本将在页面加载时调用链接到其相应站点的随机图像。任何人都知道一个javascript或php的方式来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T16:48:36.803

```
<?php

$random = array(
  array('image' => 'http://example.com/image1.jpg', 'url' => 'http://example1.com/'),
  array('image' => 'http://example.com/image2.jpg', 'url' => 'http://example2.com/'),
  array('image' => 'http://example.com/image3.jpg', 'url' => 'http://example3.com/'),
  array('image' => 'http://example.com/image4.jpg', 'url' => 'http://example4.com/'),
);

$current = rand(0, count($random) - 1);
print "<a href=\"" . $random[$current]['url'] . "\"><img src=\"" . $random[$current]['image'] . "\" alt=\"\" /></a>\n";

?> 
```

快捷方便。可能不是最好的方法——我会亲自将它连接到数据库而不是静态数组中——但它会让你在几秒钟内启动并运行。

# sql - 是否有用于定义/创作 SQL 数据库模式的 XML 语言？

> ID：230262
> 
> 赞同：0
> 
> 时间：2008-10-23T15:44:37.680
> 
> 标签：sql, xml, database, xslt

是否有用于定义关系数据库的表、索引和关系的 XML 方言，以及将定义转换为 SQL CREATE 语句 (DDL) 的“编译器”或样式表？

EG，可能看起来像：

```
<Table Name="orders">
    <Column Name="order_id" Type="varchar" Size="20"/>
    ... etc ...
</Table> 
```

我想将服务的配置及其依赖项都保存在一个地方，而 XML 看起来是最佳选择，因为它具有广泛的支持和混合命名空间的能力。有了它，我可以编写一个安装程序来安装这个服务并创建数据库、它的表、索引、关系等，而不需要绑定到特定的 SQL 实现。

**编辑：**这与 ORM 无关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T15:59:19.007

像[xml2ddl 之](http://xml2ddl.berlios.de/)类的东西？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T15:51:12.847

听起来像是基于 XML 的迁移，但从未见过。

如果你喜欢 OR/M，你可以看看 (N)Hibernate 的[hbm2ddl](http://www.hibernate.org/hib_docs/reference/en/html/toolsetguide.html)工具。它根据 XML 定义为各种数据库方言的模式生成适当的创建命令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T08:35:27.280

我已经为不同的项目写了几次。如果您擅长 XSLT、了解 DDL 并拥有良好的开发环境，那么将用于表示元数据的模式和生成数据库创建脚本的转换组合在一起非常容易（例如，2 或 3 小时的工作）。

这具有自己做的所有通常的优点和缺点：一方面，您控制功能集，但另一方面，您对功能集负责。在我的项目中，功能集足够小，因此自己构建它比学习如何使用其他人的应用程序框架更容易。

# sql - 如何将可视选择的文本通过管道传输到 UNIX 命令并将输出附加到 Vim 中的当前缓冲区

> ID：230266
> 
> 赞同：7
> 
> 时间：2008-10-23T15:45:30.847
> 
> 标签：sql, vim, editor, vi

使用 Vim，我试图将在可视模式下选择的文本通过管道传输到 UNIX 命令，并将输出附加到当前文件的末尾。例如，假设我们有一个 SQL 命令，例如：

```
SELECT * FROM mytable; 
```

我想做如下的事情：

```
<ESC>
V                 " select text
:'<,'>!mysql -uuser -ppass mydb 
```

但是，我不想让输出覆盖当前选定的文本，而是希望将输出附加到文件的末尾。您可能会看到这是怎么回事。我正在使用 Vim 作为一个简单的 SQL 编辑器。这样，我不必离开 Vim 来编辑、调整、测试 SQL 代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-23T16:51:51.430

如何将选定的文本复制到文件末尾，选择复制并运行命令？如果您不想一遍又一遍地重复相同的命令，您可以通过使用`q`或添加新命令来记录序列。我尝试了后者，如下所示：

```
:com -range C <line1>,<line2>yank | $ | put | .,$ !rev 
```

有了它，您可以选择一些行，然后键入`:C`. 这将首先拉出所选内容，然后转到文件末尾，粘贴拉出的文本并`rev`在新文本上运行命令（在本例中）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-13T22:42:16.847

如果你更喜欢程序化的方法，你可以有

```
:call append(line("$"), system("command", GetSelectedText())) 
```

`GetSelectedText`可重用函数在哪里：

```
func! GetSelectedText()
  normal gv"xy
  let result = getreg("x")
  normal gv
  return result
endfunc 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-08T15:02:19.527

尝试

```
:r | YourCommand 
```

例如：

```
:r ! echo foo 
```

添加`foo`到您的缓冲区。

# php - PHP 语法高亮

> ID：230270
> 
> 赞同：39
> 
> 时间：2008-10-23T15:46:20.657
> 
> 标签：php, syntax-highlighting

我正在寻找一个可以定制的**PHP 语法高亮引擎**（即我可以为新语言提供我**自己的标记器）并且可以***同时*处理多种语言（即在同一个输出页面上）。**这个引擎必须与CSS 类**一起很好地工作，即它应该通过插入带有属性的`<span>`元素来格式化输出。`class`可扩展模式的奖励积分。

我*不*搜索客户端语法突出显示脚本 (JavaScript)。

到目前为止，我坚持使用[GeSHi](http://qbnz.com/highlighter/)。不幸的是，GeSHi 的失败有几个原因。主要原因是不同的语言文件定义了完全不同的、不一致的样式。我已经工作了好几个小时，试图将不同的语言定义重构为一个共同点，但是由于大多数定义文件本身都很糟糕，所以我最终想切换。

理想情况下，我希望有一个类似于[CodeRay](http://coderay.rubychan.de/)、[Pygments](http://pygments.org/)或 JavaScript [dp.SyntaxHighlighter](http://code.google.com/p/syntaxhighlighter/)的 API 。

## 澄清：

我正在寻找用 PHP 编写的代码突出显示软件*，**而*不是PHP（因为我需要从 PHP 内部使用它）。

 ** * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-05-04T12:36:16.727

由于没有现有的工具能满足我的需求，我自己写了。瞧：

## [超光](https://github.com/klmr/hyperlight)

使用非常简单：只需使用

```
 <?php hyperlight($code, 'php'); ?> 
```

突出显示代码。编写新的语言定义也相对容易——使用正则表达式和功能强大但简单的状态机。顺便说一句，我仍然*需要*很多定义，所以请随意贡献。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-23T16:25:13.527

[我将此答案标记为*社区 Wiki*，因为您不是专门*寻找*Javascript]

**[http://softwaremaniacs.org/soft/highlight/](http://softwaremaniacs.org/soft/highlight/)**是一个 PHP（*加上以下支持的其他语言列表*）语法高亮库：

> *Python、Ruby、Perl、PHP、XML、HTML、CSS、Django、Javascript、VBScript、Delphi、Java、C++、C#、Lisp、RenderMan（RSL 和 RIB）、Maya 嵌入式语言、SQL、SmallTalk、Axapta、1C、Ini , 差异, DOS .bat, Bash*

它使用*<span class="keyword">*样式标记。

它还被集成在[dojo 工具包](http://dojotoolkit.org/)中（作为一个 dojox 项目：[dojox.lang.highlight](http://trac.dojotoolkit.org/browser/dojox/trunk/lang/tests/test_highlight.html?rev=11623&format=txt)）

虽然不是最流行的运行网络服务器的方式，但严格来说，Javascript 不仅在客户端实现，而且还有[服务器端 Javascript 引擎/平台组合](http://en.wikipedia.org/wiki/Server-side_JavaScript)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-03-03T04:57:43.320

[我在这里](http://phoboslab.org/log/2007/08/generic-syntax-highlighting-with-regular-expressions)找到了这个用 PHP 编写的简单通用语法荧光笔，并对其进行了一些修改：

```
<?php

/**
 * Original => http://phoboslab.org/log/2007/08/generic-syntax-highlighting-with-regular-expressions
 * Usage => `echo SyntaxHighlight::process('source code here');`
 */

class SyntaxHighlight {
    public static function process($s) {
        $s = htmlspecialchars($s);

        // Workaround for escaped backslashes
        $s = str_replace('\\\\','\\\\<e>', $s); 

        $regexp = array(

            // Comments/Strings
            '/(
                \/\*.*?\*\/|
                \/\/.*?\n|
                \#.[^a-fA-F0-9]+?\n|
                \&lt;\!\-\-[\s\S]+\-\-\&gt;|
                (?<!\\\)&quot;.*?(?<!\\\)&quot;|
                (?<!\\\)\'(.*?)(?<!\\\)\'
            )/isex' 
            => 'self::replaceId($tokens,\'$1\')',

            // Punctuations
            '/([\-\!\%\^\*\(\)\+\|\~\=\`\{\}\[\]\:\"\'<>\?\,\.\/]+)/'
            => '<span class="P">$1</span>',

            // Numbers (also look for Hex)
            '/(?<!\w)(
                (0x|\#)[\da-f]+|
                \d+|
                \d+(px|em|cm|mm|rem|s|\%)
            )(?!\w)/ix'
            => '<span class="N">$1</span>',

            // Make the bold assumption that an
            // all uppercase word has a special meaning
            '/(?<!\w|>|\#)(
                [A-Z_0-9]{2,}
            )(?!\w)/x'
            => '<span class="D">$1</span>',

            // Keywords
            '/(?<!\w|\$|\%|\@|>)(
                and|or|xor|for|do|while|foreach|as|return|die|exit|if|then|else|
                elseif|new|delete|try|throw|catch|finally|class|function|string|
                array|object|resource|var|bool|boolean|int|integer|float|double|
                real|string|array|global|const|static|public|private|protected|
                published|extends|switch|true|false|null|void|this|self|struct|
                char|signed|unsigned|short|long
            )(?!\w|=")/ix'
            => '<span class="K">$1</span>',

            // PHP/Perl-Style Vars: $var, %var, @var
            '/(?<!\w)(
                (\$|\%|\@)(\-&gt;|\w)+
            )(?!\w)/ix'
            => '<span class="V">$1</span>'

        );

        $tokens = array(); // This array will be filled from the regexp-callback

        $s = preg_replace(array_keys($regexp), array_values($regexp), $s);

        // Paste the comments and strings back in again
        $s = str_replace(array_keys($tokens), array_values($tokens), $s);

        // Delete the "Escaped Backslash Workaround Token" (TM)
        // and replace tabs with four spaces.
        $s = str_replace(array('<e>', "\t"), array('', '    '), $s);

        return '<pre><code>' . $s . '</code></pre>';
    }

    // Regexp-Callback to replace every comment or string with a uniqid and save
    // the matched text in an array
    // This way, strings and comments will be stripped out and wont be processed
    // by the other expressions searching for keywords etc.
    private static function replaceId(&$a, $match) {
        $id = "##r" . uniqid() . "##";

        // String or Comment?
        if(substr($match, 0, 2) == '//' || substr($match, 0, 2) == '/*' || substr($match, 0, 2) == '##' || substr($match, 0, 7) == '&lt;!--') {
            $a[$id] = '<span class="C">' . $match . '</span>';
        } else {
            $a[$id] = '<span class="S">' . $match . '</span>';
        }
        return $id;
    }
}

?> 
```

**演示： http:** [//phpfiddle.org/lite/code/1sf-htn](http://phpfiddle.org/lite/code/1sf-htn)

* * *

### 更新

我刚刚在这里创建了我自己的 JavaScript 通用语法荧光笔的 PHP 端口 → [https://github.com/taufik-nurrohman/generic-syntax-highlighter/blob/master/generic-syntax-highlighter.php](https://github.com/taufik-nurrohman/generic-syntax-highlighter/blob/master/generic-syntax-highlighter.php)

如何使用：

```
<?php require 'generic-syntax-highlighter.php'; ?>
<pre><code><?php echo SH('&lt;div class="foo"&gt;&lt;/div&gt;'); ?></code></pre> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T12:31:05.267

可能值得一看[Pear_TextHighlighter](http://pear.php.net/package/Text_Highlighter/) ([文档](http://pear.php.net/manual/en/package.text.text-highlighter.php))

我认为默认情况下它不会完全按照您想要的方式输出 html，但它确实提供了广泛的自定义功能（即您可以创建不同的渲染器/解析器）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-20T00:03:45.780

我遇到了完全相同的问题，但是由于我的时间很短并且需要非常好的代码覆盖率，所以我决定围绕[Pygments](http://pygments.org/)库编写一个 PHP 包装器。

它被称为[PHPygmentizator](https://github.com/igorpan/PHPygmentizator)。使用起来真的很简单。我写了一本非常基础的[手册](https://github.com/igorpan/PHPygmentizator/blob/master/doc/contents.md)。由于 PHP 主要是 Web 开发语言，因此我将结构从属于这一事实，并使其在几乎任何类型的网站中都非常容易实现。

它支持[配置文件](https://github.com/igorpan/PHPygmentizator/blob/master/doc/basic_usage.md)，如果这还不够，有人需要修改过程中的东西，它也会触发[事件](https://github.com/igorpan/PHPygmentizator/blob/master/doc/advanced_usage.md)。

基本上可以在我的博客的任何包含源代码的帖子上找到它的工作原理演示，[例如这个](http://www.pantovic.com/article/4/piflex-dependencyinjection)。

使用默认配置，您只需提供以下格式的字符串：

```
Any text here.

[pygments=javascript]
var a = function(ar1, ar2) {
    return null;
}
[/pygments]

Any text. 
```

因此它突出显示标签之间的代码（标签可以在配置文件中自定义），其余部分保持不变。

此外，我已经制作了一个语法识别*库*（它使用可能被归类为[贝叶斯概率](http://en.wikipedia.org/wiki/Bayesian_probability)的算法），它可以自动识别编写的语言代码块，并且可以轻松地连接到**PHPygmentizator**事件之一以提供自动语言识别。我可能会在本周的某个时间将其公开，因为我需要稍微美化结构并编写一些基本文档。如果你为它提供足够的“学习”数据，它可以非常好地识别语言，我甚至测试了缩小的 javascript 和具有相似关键字和结构的语言，它从来没有犯过错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T18:14:33.930

另一种选择是使用 Andre Simon 的 GPL **[Highlight GUI](http://www.andre-simon.de/zip/download.html)**程序，该程序可用于大多数平台。它将 PHP（和其他语言）转换为 HTML、RTF、XML 等，然后您可以将其剪切并粘贴到您想要的页面中。这样，处理只进行一次。

HTML 也是基于 CSS 的，因此您可以随意更改样式。

就个人而言，我使用**[dp.SyntaxHighlighter](http://www.dreamprojections.com/syntaxhighlighter)**，但它使用客户端 Javascript，所以它不能满足您的需求。它确实有一个不错的 Windows Live 插件，但我觉得它很有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-16T03:33:28.720

在这里加入有点晚了，但我一直在研究我自己的 PHP 语法高亮库。它仍处于早期阶段，但我将它用于我博客上的所有代码示例。

刚刚检查了超光。它看起来很酷，但它正在做一些非常疯狂的事情。嵌套循环，逐行处理等。核心类1000多行代码。

如果您对简单轻量级的东西感兴趣，请查看 Nijikodo： [http ://www.craigiam.com/nijikodo](http://www.craigiam.com/nijikodo)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-15T13:59:30.117

为什么不使用 PHP 的内置语法荧光笔？

[http://php.net/manual/en/function.highlight-string.php](http://php.net/manual/en/function.highlight-string.php)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-11-07T17:52:15.013

[PHP Prettify](https://github.com/Ghostff/php_prettify)到目前为止运行良好，并且比[highlight_string有更多的自定义](http://php.net/manual/en/function.highlight-string.php)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-02T11:43:05.670

Krijn Hoetmer 的[PHP Highlighter](http://krijnhoetmer.nl/stuff/php/php-highlighter/)提供了一个完全可定制的 PHP 类来突出 PHP 语法。它生成的 HTML 在严格的 doctype 下进行验证，并且完全可以使用 CSS 进行样式设置。

# c# - AutoEventWireup 应该在 ASP.Net 的页面指令中设置为什么值？

> ID：230285
> 
> 赞同：2
> 
> 时间：2008-10-23T15:50:03.503
> 
> 标签：c#, asp.net, vb.net

我正在使用 C#。默认情况下，当我在 Visual Studio 2008 中添加带有或不带有母版页的 Web 表单时，页面指令中的 AutoEventWireup 属性设置为 true。此属性在母版页主指令内也设置为 true。

我应该将 AutoEventWireup 设置为什么值（真/假）？

两种价值观的优缺点是什么？

任何帮助是极大的赞赏。

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T15:58:35.763

这是一种根据 Microsoft 设置的命名约定自动将事件处理程序连接到事件的方法。

如果我没记错的话，这是通过反射实现的。在运行时，ASP.NET 将检查您的类，查找具有与预期命名约定匹配的签名的方法，然后将它们连接起来作为它们各自事件的处理程序。

也就是说，优点是它是一种标准方法，可以省去您自己连接事件处理程序的麻烦。一个明显的“骗局”是它需要一个额外的步骤（反思），这比你自己做的成本要高一些。

在大多数情况下，反射“成本”是如此之少，以至于它真的不值得一提，但重要的是要了解幕后发生的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T21:53:26.437

这只会导致运行时自动将传统的页面生命周期方法（如 Page_Load）连接到它们的等效事件处理程序 (Page.Load)。如果您将 AutoEventWireup 设置为 false，那么您需要类似以下内容：

```
protected override void OnLoad(EventArgs e)
{
   base.OnLoad(e); 
} 
```

而不是 MS 约定：

```
protected void Page_Load(object sender, EventArgs e)
{
} 
```

您也不必担心调用base.OnLoad，因为wireup 会自动执行此操作。但是，将其设置为 false 可能会带来一点性能优势——尽管我从未验证过。

——内特戴维斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T15:52:38.337

如果它设置为 false，那么如果您有 Page_Load 或 Page_PreInit 之类的方法，它们将永远不会触发。AutoEventWireup 意味着如果有这样命名的事件，它们应该将事件处理程序连接到这些事件。

# asp.net - 对工作流架构的建议？

> ID：230293
> 
> 赞同：1
> 
> 时间：2008-10-23T15:51:20.210
> 
> 标签：asp.net, workflow

我们为客户建立了一个拨款申请系统。他们现在要求提供一些简单的工作流功能（在提交申请之前需要两次批准）。

我已经对数据库设计进行了一些思考，我将使用该数据库设计以提供最大灵活性和可重用性的方式对工作流程要求进行编码，并且我很想知道是否有任何现有的设计模式或最佳实践有这种类型的系统。有什么建议么？

**注意：**这是一个自定义的 ASP.NET 应用程序，我们肯定会推出我们自己的工作流解决方案。我对购买一个组件不感兴趣，或者更不用说将整个事情转移到像 SharePoint 这样的平台上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T15:53:38.410

不看[Windows Workflow Foundation](http://msdn.microsoft.com/en-us/netframework/aa663328.aspx)将是愚蠢的。它完全符合您的要求。

这是一个[ASP.NET 特定链接](http://www.devx.com/dotnet/Article/29992)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T17:28:46.237

如果工作流功能如此简单，那么您的方法就足够了。但是，如果您想要（或者如果客户稍后要求）更多功能，例如：

*   对审批者的提醒
*   给管理员的警报
*   任务的升级和重新分配
*   取消作业
*   基于规则的分配
*   跟踪分配

那么您可能必须考虑像[Workflow Foundation](http://msdn.microsoft.com/en-us/netframework/aa663328.aspx)这样的工作流组件。

可以在[此处](http://www.workflowpatterns.com/patterns/index.php)找到工作流模式的学术方法，它们分为四类：

*   [控制流模式](http://www.workflowpatterns.com/patterns/control/index.php)
*   [工作流数据模式](http://www.workflowpatterns.com/patterns/data/index.php)
*   [异常处理模式](http://www.workflowpatterns.com/patterns/exception/index.php)
*   [工作流资源模式](http://www.workflowpatterns.com/patterns/resource/index.php)

我认为您的案例中更有趣的类别是资源模式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T16:02:27.287

过去运作良好的一种解决方案是创建具有成员的批准组，批准代码作为一个简单的查找表，并对批准状态机进行软编码，以便每个步骤都由通过以下方式将批准代码分配给项目产生一个小组成员。这允许更改组成员身份并更改批准路径，而无需重新编码任何内容。您还可以添加代码触发器和端点（通过反射，例如程序集名称 + 类名称 + 方法名称）以在每个步骤执行副作用和提交/通知操作

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T03:55:09.810

我有一个类似的查询。有一组相互依赖的批处理。我正在为这些批处理流程开发类似系统的工作流程。

以下两种设计哪个更好：

1.  数据库驱动设计，其中每个进程在数据库表中更新其状态和其他详细信息，其他进程查询这些表，或

2.  一种基于 JMS 或消息传递的方法，其中进程使用消息传递队列相互通信。

# visual-studio-2008 - 使用 #import 的多核构建 (/MP) 策略

> ID：230298
> 
> 赞同：22
> 
> 时间：2008-10-23T15:53:58.193
> 
> 标签：visual-studio-2008, visual-c++, build-process, multicore

我正在使用 VS 2008 为我们的大型 VC++ 项目开发新的解决方案配置。我希望此配置使用多核构建标志[/MP](http://msdn.microsoft.com/en-us/library/bb385193.aspx)。

但是，生成 COM 包装类的“#import”功能遍布整个代码库，使用 /MP 时不支持此功能。

我明白为什么#import 不起作用，**我想知道是否有人遇到过这个问题以及他们是如何解决这个问题的？**

我正在执行以下操作：

*   ***不要在小型或无用***的项目上使用 /MP 标志。（也许我稍后会回到他们身边）
*   删除了 #import 并将其替换为更标准的 MIDL 生成的标头 (#include)。这只是在几个容易转换为老式 COM 的地方的一个选项。
*   创建一个#imports 剩余库的新项目。先做那个构建。#包括它在之前#imported 的所有位置创建的.tlh 文件。

我很好奇是否有人有**其他建议？**另外，关于**最后一点**（创建一个新项目并仅在此处使用#import） - 如果你做了这样的事情，**你是怎么做到的？**什么类型的项目，“源”是什么样的，你在哪里输出文件？你是如何包括他们的？（你知道，为我做所有的思考！）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-12T15:20:31.507

我有一个带有两个源文件的项目，它们#import 相同的文件。使用 /MP 编译时，它偶尔会收到拒绝访问错误，因为两个源文件都试图同时创建 .tlb。我通过启用预编译头文件并将#import 添加到预编译头文件源文件中来纠正此问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-05T12:36:46.400

您可以对整个项目使用 /MP 选项，然后使用***/MP1***选项对单个文件进行例外处理。

# .net - 我可以定位 .net 的（表单）消息框或通用对话框吗？

> ID：230299
> 
> 赞同：6
> 
> 时间：2008-10-23T15:54:14.370
> 
> 标签：.net

我试图获得父表单的中心，而不是屏幕行为的中心。传入父窗体似乎只控制窗口的所有权。这些类是密封的，所以我看不出我怎么能做任何 WinProc 技巧。重写类不是一个吸引人的选择。还有其他想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T16:49:07.957

正如上面 HTH 所解释的，有一些丑陋的方法可以做到这一点。这是一个简单的类，它将包装对话框并在父应用程序/表单中居中。

它采用丑陋的方式并将它们包装成更简单的东西。

虽然我还没有实现这个或真正深入研究源代码，但这是一个很好的起点。[代码项目中心对话框](http://www.codeproject.com/KB/dialog/CenterDialog.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T16:20:28.967

如果不深入研究一些丑陋的 P/invoke 代码来**查找**并在显示窗口后**移动**它，这根本不可能。如果你追求这个，消息框会“跳”到新的位置，这通常比没有居中更糟糕。如果这个职位真的那么重要，你最好创建自己的消息框，或者采用[CodeProject](http://www.codeproject.com/KB/dialog/)中的一个。

高温高压

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T17:43:14.900

经过一番挖掘，我找到了[http://support.microsoft.com/kb/180936](http://support.microsoft.com/kb/180936)。这行得通。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T16:16:06.337

我对对话框或消息框了解不多，但是，您可以使用 StartPosition 属性来定位您正在寻找的新表单。

```
System.Windows.Forms.Form f = new Form();
f.StartPosition = FormStartPosition.CenterParent; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T16:53:55.153

您可以使用 VB.NET`Interaction.InputBox`方法。如果您使用 C#，只需添加对 Microsoft.VisualBasic 的引用，然后调用它。此方法允许您指定 X 和 Y 坐标。您必须满足于具有输入框的对话框，但这可能比滚动您自己的对话框更可取。

我认为这是您唯一的其他选择——就像您说的那样，MessageBox 等是`sealed`类，因此您必须备份到 CommonDialog 并从中派生您自己的（可指定位置的）类。当然，这应该*不难*，但是如果您不想编写/维护它，我可以理解。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T17:12:26.397

> 你最好创建自己的消息框

OT，但这是我最讨厌的事情之一。Office 团队这样做了，他们的 MessageBox 缺少标准 MessageBox 的功能 - 使用 Ctrl-C 将 MessageBox 作为文本复制到剪贴板的能力（对于错误报告等很有用）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-18T15:12:01.043

[扩展 MessageBox .NET 库（程序集）](http://www.news2news.com/vfp/?solution=5)

在其他有用的功能中，包括两种定位模式：通过绝对坐标，通过对齐活动监视器的指定边界。

这不是 MessageBox.Show 的替代品，而是它的扩展。其他功能：消息字体和字体颜色选择、可调节背景颜色、用户定义的按钮标题和按钮字体、捕获用户输入的文本等。

# regex - 在什么情况下，正则表达式真的是解决问题的最佳方式？

> ID：230304
> 
> 赞同：3
> 
> 时间：2008-10-23T15:57:15.253
> 
> 标签：regex

我不确定 Jeff 是否创造了它，但这是一个笑话/说那些说“哦，我知道我会使用正则表达式！”的人。现在有[两个问题](http://www.codinghorror.com/blog/archives/001016.html)。我一直认为这意味着人们在非常[不恰当的上下文中](http://thedailywtf.com/Articles/The-Clbuttic-Mistake-.aspx)使用正则表达式。

但是，在什么情况下，正则表达式真的是最好的答案？哪些问题真的是解决问题的最佳或唯一方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T16:06:25.077

RexExprs 适用于：

*   文本格式验证（电子邮件、网址、数字）
*   文本搜索/替换。
*   映射（例如 url 模式到函数调用）
*   过滤一些文本（与替换有关）
*   解析期间的词法分析。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T16:06:29.680

它们可用于验证具有以下模式的任何内容：

*   社会安全号码
*   电话号码 ( 555-555-5555 )
*   电子邮件地址 (something@example.com)
*   IP 地址（但要确保其有效更复杂）

所有这些都有模式，并且可以通过 RegEx 轻松验证。

它们很难用于具有逻辑而不是像信用卡号这样的模式的条目，但它们仍然可以用于进行一些客户端验证。

那么最好的方法呢？

*   在对服务器上的数据输入进行消毒之前，在客户端对数据输入进行消毒。
*   对一些包含模式的字符串进行“搜索和替换”

我确定我错过了很多其他案例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T15:59:22.003

正则表达式是解析尚无解析器（即 XML）的文本的好方法。我已使用它为 .htaccess 文件或我的 URL 重写器项目[http://www 中的 mod_rewrite 语法创建解析器。](http://www.codeplex.com/urlrewriter)例如[codeplex.com/urlrewriter](http://www.codeplex.com/urlrewriter)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T16:00:15.560

当您想要比“*”或“？”更具体时，它们真的很好。像“3个字母然后2个数字然后一个$符号然后一个句点”

引用来自 Jamie Zawinski 的反 Perl 咆哮。我认为 Perl 过去做 regex 真的很糟糕，但现在它似乎是很多程序的标准引擎。

但同样的情绪仍然适用。如果你不知道如何使用正则表达式，你最好不要尝试真正花哨的东西，否则你也会得到这些标签之一（见青铜列表）;o）

[https://stackoverflow.com/users/730/keng](https://stackoverflow.com/users/730/keng)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T16:04:01.883

它们非常适合匹配或查找采用非常*具体*和*简单*格式的文本。例如，“简单”是指不嵌套且小于整个 html 规范。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T16:06:31.850

它们主要对高度结构化的文本解析有价值。如果您使用命名组（以及大多数成熟的正则表达式系统中的选项），您将拥有一种非常强大且清晰的方式来处理字符串。

这是一个例子。考虑 netstat 在不同 Linux 操作系统上的各种迭代，并且不同版本的 netstat 可以返回不同的结果。有时会有一个额外的列，有时如果日期/时间格式会发生变化。正则表达式为您提供了一种通过单个表达式来处理它的强大方法。将其与命名组相结合，您可以在没有黑客攻击的情况下检索数据，例如：
1）在空格上拆分
2）好的，netstat 版本是 X，所以添加我需要在第 5 列之后的所有数组引用中添加 1。3
）好的， netstat 版本是 Y，所以我需要确保对日期信息使用多个数组引用。

呸。很容易在正则表达式中修复:-)

# python - Cherrypy 有什么好的“联系我们”食谱吗？

> ID：230310
> 
> 赞同：3
> 
> 时间：2008-10-23T15:59:07.993
> 
> 标签：python, cherrypy, contactus

我希望用 Cherrypy 实现一个“联系我们”表单，并且想知道：是否有一个好的方法（或 BSD 许可的代码集）可以用来代替重新发明轮子？

理想情况下，这将与 Cherrpy 3.1 兼容。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T05:31:27.137

好吧，我不得不寻找解决方案。这有效（丑陋，并且没有 Javascript 验证）——使用 smtplib 库。另外，请注意，我为这个示例窃取了 Jeff 的验证码。任何使用它的人都需要更改它。

**编辑：**我添加了验证。

```
#!/usr/local/bin/python2.4 
import smtplib 
import cherrypy

class InputExample:
   @cherrypy.expose
   def index(self):
       return "<html><head></head><body><a href="contactus">Contact Us</a></body></html>"

        @cherrypy.expose
        def contactus(self,message=''):
                return """
<html>
<head><title>Contact Us</title>
<script type="text/javascript">

   function isNotEmpty(elem)
   {
      var str = elem.value;
      var re = /.+/;
      if (!str.match(re))
      {
         elem.focus();
         return false;
      }
      else
      {
         return true;
      }

   }

   function isEMailAddr(elem)
   {
      var str = elem.value;
      var re = /^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/;
      if (!str.match(re))
      {
         return false;
      }
      else
      {
         return true;
      }
   }

   function validateForm(form)
   {
      if (isNotEmpty(form.firstName) && isNotEmpty(form.lastName))
      {
         if (isNotEmpty(form.email))
         {
         if (isEMailAddr(form.email))
         {
            if (isNotEmpty(form.captcha))
            {
               if ( form.captcha.value=='egnaro'.split("").reverse().join(""))
               {
                   if (isNotEmpty(form.subject))
                     {
                        alert("All required fields are found.  We will respond shortly.");
                        return true;
                     }
               }
               else
               {
                   alert("Please enter the word as displayed in the image.");
                   return false;
               }
            }//captcha empty
            }
         else
         {
            alert("Please enter a valid email address.");
            return false;
         } //email
         } //email
      } //first and last name
      alert("Please fill in all required fields.");
      return false;
   }

</script>
</head>
<body>
<p>%(message)s</p>
<form method='POST' action='contactUsSubmitted' onsubmit='return validateForm(this)'>
   <label for="firstName">First Name: </label>
   <input type="text" id="firstName" name="firstName" /> (required)<br/>
   <label for="lastName">Last Name: </label>
   <input type="text" id="lastName" name="lastName" /> (required)<br/>
   <label for="email">E-mail address: </label>
   <input type="text" id="email" name="email" /> (required)<br/>
  <label for="phone">Phone number: </label>
   <input type="text" id="phone" name="phone" /> <br/><br/>

   <!--THIS NEEDS TO BE CHANGED TO MATCH YOUR OWN CAPTCHA SCHEME!! -->
   <label for="captcha">Enter the word<br /><img alt="rhymes with.." src="http://www.codinghorror.com/blog/images/word.png" width="99" height="26" border="0" /></label><br />
(<a href="http://www.codinghorror.com/blog/sounds/captcha-word-spoken.mp3">hear it spoken</a>)<br />
   <input tabindex="3" id="captcha" name="captcha" /><br /><br />

   <label for="subject">Subject: </label>
   <input type="text" id="subject" name="subject" /> (required)<br/>
   <label for="body">Details: </label>
   <textarea id="body" name="body"></textarea><br/>

<input type='submit' value='Contact Us' />
</form>
</body>
</html>
"""%{'message':message}

        @cherrypy.expose
        def contactUsSubmitted(self, firstName, lastName, email, phone, captcha, subject, body ):
                if captcha[::-1] != 'egnaro':
                        return self.contactus("Please reenter the word you see in the image." )
                self.sendEmail('mail2.example.com','mailbox_account','mailbox_pwd','me@example.com',email,
                     'Website Contact: '+subject, 'Sender Email: ' + email + '\r\n'
                     'Name: ' + firstName + ' ' + lastName + '\r\n' + 'Phone: ' + phone + '\r\n' + body)
                return self.index()

        def sendEmail(self,smtpServer, mailboxName, mailboxPassword, contactEmail,senderEmail,subject,body):
                server = smtplib.SMTP(smtpServer) #'smtp1.example.com')
                server.login(mailboxName, mailboxPassword)

                msg = "To: %(contactEmail)s\r\nFrom: %(senderEmail)s\r\nSubject: %(subject)s\r\nContent-type: text/plain\r\n\r\n%(body)s"
                msg = msg%{'contactEmail':contactEmail,'senderEmail':mailboxName + '@example.com','subject':subject,'body':body}

                server.sendmail(contactEmail, contactEmail, msg) #This is to send it from an internal account to another internal account.
                server.quit()

cherrypy.root = InputExample()
cherrypy.config.update ( file = 'development.conf' )
cherrypy.server.start() 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-14T20:07:20.490

我意识到这个问题已经有四年了，但对于那些仍在寻找的人：

我推荐使用 python 库[Marrow Mailer](https://github.com/marrow/marrow.mailer)。它抽象了整个 smtp vs sendmail 等，还提供了出色的服务器端验证。该代码在 MIT 许可下（与 BSD-esque 和 GPL 兼容），这正是您所寻找的。github 上的自述文件提供了如何使用的示例。该库与 Python 2.6+ 和 3.1+ 兼容。

Marrow Mailer, combined with the answer by *torial*, provides a simple "contact us" form for CherryPy/python. I've found [Voluptuous](http://pypi.python.org/pypi/voluptuous) to be a very simple validator (that you can use for the form server side; BSD license), or the WIP [Validator](https://github.com/wilhelm-murdoch/Validator). There's also several Javascript/jQuery plugins for validating client side (such as [http://docs.jquery.com/Plugins/Validation](http://docs.jquery.com/Plugins/Validation)).

# .net - 有没有办法欺骗 .NET JIT 编译器运行另一种方法？

> ID：230321
> 
> 赞同：7
> 
> 时间：2008-10-23T16:02:01.373
> 
> 标签：.net, security, clr, jit, dynamic-execution

好的，假设我的应用程序正在将（x86）指令发送到内存中，使页面可执行等。有没有办法改变非 JIT 方法的方法存根以指向我发出的指令流？

例如：

假设我在内存中创建了一个 x86 指令流，它可以做一些任意的事情。现在，进一步假设我有一个方法'int Target()'。我还没有调用它，所以它还没有编译。有没有办法：

1.  获取指向 Target 存根的指针
2.  让它指向我发出的指令流。

我意识到.NET 的几乎每一个安全特性都是为了*防止*这样的劫持而设计的。但是可以通过托管 API 来实现吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-23T16:03:28.033

这可以通过 Profiling API 实现。我从未使用过它，但它在 TypeMock 中用于类似目的。

编辑：我认为 MSDN 博客上有一篇不错的帖子，会去寻找它。

编辑2：Doh，[第一击](http://blogs.msdn.com/davbr/archive/2007/03/06/creating-an-il-rewriting-profiler.aspx)！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T07:27:26.773

是的，你可以做到！

钩住 mscorjit 的 getJit 方法。并且每次都会询问您是否有任何方法需要jitting。你可以通过任何你想要的。

一些 .NET 保护程序就是这样工作的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T12:55:13.980

正如你所说，这并不容易，甚至不可能。如果我没记错的话，代码将包含一个方法的 JIT 编译器的地址，该方法尚未编译。因此，当您尝试调用此方法时，JIT 编译器将完成其工作并将地址插入新编译的方法。如果您可以更改此地址，则可以插入对您自己的代码的调用。你如何在不被发现的情况下做到这一点超出了我的范围。我当然希望 CLR 能够检测到这种篡改。

在这种情况下，我认为 Profiling API 不会对您有所帮助（正如 Leppie 所建议的那样），因为您没有尝试修改 MSIL。如果您不这么认为[，这篇文章](http://msdn.microsoft.com/en-us/magazine/cc188743.aspx)可能会有所帮助，因为它描述了实现 TypeMock 所做的事情必须做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T02:44:15.537

除了能够使用 ICorProfiler 并在它运行前重写您的方法之外，您还可以使用[ICorDebug](http://blogs.msdn.com/jmstall/archive/2004/10/22/246151.aspx)（MDBG 已托管接口）。设置断点，当断点命中时，将下一条语句设置为您的拦截代码。所有这些过程都可以从代码中完成，但非常具有侵入性，您将需要一个“观察者”过程来协调这一点。

另一件值得关注的事情是[PostSharp](http://www.postsharp.org/)项目，如果您应用属性，它会为您提供进入和退出方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T07:15:34.130

我不会尝试直接弄乱内存，我什至不确定它是否可能，而是您可以使用分析器 API - 那里有一些示例，但没有真正的文档。查看 MSDN 杂志文章 - [Rewrite MSIL Code on the Fly with the .NET Framework Profiling API](http://msdn.microsoft.com/en-us/magazine/cc188743.aspx)

# objective-c - 获取字体的最大高度

> ID：230332
> 
> 赞同：0
> 
> 时间：2008-10-23T16:04:29.263
> 
> 标签：objective-c, cocoa, fonts, rendering

所以我有一个 NSFont，我想获得任何字符的最大尺寸，即。间距和字母高度。[font maximumAdvancement] 似乎返回 {pitch, 0} 的 NSSize，所以这没有帮助。边界矩形似乎也不起作用，并且[jwz 的](http://jwz.livejournal.com/628853.html)创建贝塞尔路径、附加字形和获取边界矩形的类似问题的建议也让我返回 {0, 0}。这里给出了什么？

**更新**：我用来获取贝塞尔大小的代码是这样的：

```
NSBezierPath *bezier = [NSBezierPath bezierPath];
NSGlyph g;
{
    NSTextStorage *ts = [[NSTextStorage alloc] initWithString:@" "];
    [ts setFont:font];
    NSLayoutManager *lm = [[NSLayoutManager alloc] init];
    NSTextContainer *tc = [[NSTextContainer alloc] init];
    [lm addTextContainer:tc];
    [tc release]; // lm retains tc
    [ts addLayoutManager:lm];
    [lm release]; // ts retains lm
    g = [lm glyphAtIndex:0];
    [ts release];
}
NSPoint pt = {0.0f};
[bezier moveToPoint:pt];
[bezier appendBezierPathWithGlyph:g inFont:font];
NSRect bounds = [bezier bounds]; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T17:07:25.250

空格字符的字形没有任何子路径，所以它的边界当然有 size `NSZeroSize`。试试`-[NSFont boundingRectForFont]`吧。

# ruby-on-rails - 为什么我需要更加努力地使我的 Rails 应用程序适合 RESTful 架构？

> ID：230335
> 
> 赞同：29
> 
> 时间：2008-10-23T16:05:28.840
> 
> 标签：ruby-on-rails, ruby, model-view-controller, rest

我最近开始了一个 Rails 项目，并决定使用 RESTful 控制器。我为我的关键实体（例如 Country）创建了控制器并添加了`index`、`new`、`edit`、`create`、`show`和. 我将我的添加到我的路线文件中，生活很好。`update``delete``map.resources :country`

开发有点进展后，我开始遇到问题。我有时需要在我的控制器中执行额外的操作。首先是`search`为我喜欢的自动完成搜索框返回选项的操作。然后需要在应用程序的不同位置以两种不同的方式显示国家/地区（显示的数据也不同，因此不仅仅是两个视图） - 我添加了`index_full`动作。然后我想在 URL 中按名称而不是 id 显示国家/地区，因此我添加了`show_by_name`操作。

当您需要在 Rails 的 RESTful 控制器中超出标准`index`, `new`, `edit`, `create`, `show`, `update`,的操作时，您会怎么做？`delete`我是否需要在 routes.rb 文件中添加（和维护）手动路由（这很痛苦），它们是否进入不同的控制器，我是否变得不稳定或我错过了一些基本的东西？

我想我在问，我是否需要更加努力地工作并将操作添加到我的 routes.rb 文件中以获得 RESTful 的特权？如果我不使用`map.resources`添加 REST 好东西，标准`:controller/:action, :controller/:action/:id`路由将自动处理几乎所有内容。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-23T17:44:42.510

I would treat `search` as a special case of `index`. Both actions return a collection of resources. The request parameters should specify things like page, limit, sort order, and search query.

For example:

```
/resources/index # normal index
/resources/index?query=foo # search for 'foo' 
```

And in resources_controller:

```
before_filter :do_some_preprocessing_on_parameters

def index
  @resources = Resource.find_by_param(@preprocessed_params)
end 
```

As for `index_full` and `search_by_name`, you might look at splitting your current controller into two. There's a smell about what you've described.

Having said that, you're absolutely right that there's no point in forcing your app to user restful routes when it doesn't deliver anything over `/:controller/:action/:id`. To make the decision, look how frequently you're using the restful resource route helpers in forms and links. If you're not using them, I wouldn't bother with it.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-23T16:58:21.853

如果我的模型超出了标准 CRUD 操作，我通常只根据需要添加方法。搜索是我添加到许多控制器的东西，但不是每个控制器，所以我添加它并正常维护路由：

```
map.resources :events, :collection => { :search => :get } 
```

将这些操作移动到一个完全独立的控制器可能会使您的一些控制器保持 RESTful，但我发现将它们保持在上下文中更有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-23T17:01:33.640

REST 未指定您不能拥有其他视图。没有现实世界的应用程序将能够仅使用提供的操作；这就是为什么您可以添加自己的操作。

REST 是关于能够对服务器进行无状态调用。每次返回数据时，您的搜索操作都是无状态的，对吗？您的备用显示操作也是无状态的，只是视图不同。

As to if they should be manual routes or a new controller, that depends on how distinct the activity is. Your alternate view, if it provides a full set of CRUD (create, read, update, delete) operations would do well to be in a new controller. If you only have an alternate *view* to the data, I would just add an alternate view action.

In other words, it doesn't sound like your application is failing to be RESTful, it is more an issue of realizing that the automatically generated feature set is a starting point, not a conclusion.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T16:46:10.437

In my opinion they may have gone a bit off the rails here. What happened to DRY?

I'm just getting back into Rails not having done much development with it since beta and I'm still waiting for the light-bulb to come on here. I'm still giving it a chance but if it hasn't happened for me by the end of my current project I'll probably just drop-back to the old standard routes and define the methods as I actually need them for the next one.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-07T13:51:05.597

I won't go on to explain more about REST since I think that has been answered in this question, however I will talk a little bit about the default route.

My main problem with the default route is that if you have multiple sites using the same Rails app it can look horrible.

For example there may be controllers that you don't want people to be able to see on one app:

```
http://example1.somesite.com/example_2/foo/bar/1 
```

compare this to

```
/:controller/:action/:id 
```

This would go to the controller example_2/foo, action bar and id 1

I consider this to be the main flaw of Rails' default route and this is something that RESTful routes (with subdomain extensions) or only named routes (`map.connect 'foo'` ... ) can fix.

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-25T03:38:55.027

To remain RESTful in your design, you need to rethink what you call a resource.

In your example a show action for a search controller, (search resource) is the direction to remain restful.

In mine, I have a dashboard controller (show) and controllers for single fields of in-place ecditors (show and update)

# c# - 使另一个应用程序的窗口位于最上方后失去焦点

> ID：230337
> 
> 赞同：0
> 
> 时间：2008-10-23T16:06:10.227
> 
> 标签：c#, winapi, focus, z-order, topmost

我正在将另一个应用程序的窗口置于最顶层，以确保在我的应用程序中单击会将另一个应用程序的对话框带入视图。我遇到的问题是通话后我没有将注意力重新集中到我的应用程序上。如果另一个应用程序有更多窗口，则其中一个最终获得焦点，否则没有窗口（仅查看任务栏）获得焦点。我应该从哪里开始调查这个问题？

我将另一个应用程序置于最高位置的代码是：

```
Process p = Process.GetProcessById(trackedProcessID);
IntPtr h = p.MainWindowHandle;
uint TOPMOST_FLAGS = SWP_NOMOVE | SWP_NOSIZE | SWP_ASYNCWINDOWPOS;
SetWindowPos(h, HWND_TOPMOST, 0, 0, 0, 0, TOPMOST_FLAGS); 
```

常数为

```
public static readonly uint SWP_NOMOVE = 0x0002;
public static readonly uint SWP_NOSIZE = 0x0001;
public static readonly uint SWP_ASYNCWINDOWPOS = 0x4000;
public static readonly IntPtr HWND_TOPMOST = new IntPtr(-1); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T16:11:39.887

相关：[Process.MainWindowHandle 的意外行为](https://stackoverflow.com/questions/48288/unexpected-behaviour-of-processmainwindowhandle)

基本上 MainWindowHandle 为您提供了该过程的当前最顶层窗口，尽管文档说了什么。

这就解释了为什么您的其他进程的主窗口不一定获得焦点。

您的另一个问题是因为您在放弃后没有将焦点返回到您的应用程序。

实际上，您所做的正确术语是建立[z-order](http://en.wikipedia.org/wiki/Z-order)。

与其尝试控制 z 顺序（这无法保证），不如将消息发送到其他进程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T17:25:36.853

你试过 SWP_NOACTIVATE 吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T21:58:33.737

[实际使用的解决方案]

到目前为止，我正在将调用窗口的窗口句柄发送到目标应用程序，并在完成后将其推回顶部。这是一个真正的痛苦，因为我要处理大约 50 个窗口，但它看起来很稳定。下一个方法，如果这有问题，将回调调用应用程序并要求它将窗口推到前台，但我宁愿不这样做，因为它引入了用户可以做某事的可能性消息传输时调用的应用程序（如果有大量消息以相同的传输协议进入，这很可能会发生）

不要尝试使用传入的窗口句柄并将目标应用程序中显示的任何窗口的父级设置为该句柄，它只会使显示的对话框出现在调用应用程序窗口的边界内，并在必要时裁剪 - 没用

非常感谢上述问题的答案

# bug-tracking - 如何获得最终用户（客户）对自定义开发项目的反馈

> ID：230343
> 
> 赞同：6
> 
> 时间：2008-10-23T16:07:52.423
> 
> 标签：bug-tracking, user-feedback, end-user

我的公司是一些项目的定制开发商店，有些较大，有些较小。目前，我们通过电子邮件处理所有客户通信。所以我们通过电子邮件发送设计文档，他们将其标记并发送回去。然后我们推出了他们产品的测试版，他们通过电子邮件向我们发送任何错误、新功能等。等等....

当我正在实施一个新的错误跟踪系统时（现在看起来它将是 Mantis），我想知道我们如何才能最好地让我们的客户与我们的开发过程建立一个接口，以便更好地跟踪功能请求和客户提交错误并将我们的回复传达给客户。

如果有人知道一个在这方面做得非常好的错误跟踪系统，我很想听听。否则，我只是在寻找一些通用的指导方针或良好的商业实践，使您的公司能够有效地与您的客户进行互动。

**更新：**我的公司使用 LAMPP 堆栈，由于我们是一家预算有限的小商店，我们倾向于坚持使用开源和免费的工具。

大多数人要么使用 Team Foundation Server 来处理此问题，要么使用来回发送电子邮件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T18:11:06.637

我认为关键是要有专门的错误/请求跟踪系统，并建立一套沟通流程。至少，您将开始获得一致的反馈。从那里您可以对其进行调整以满足您的特定需求。

[顺便说一句，我强烈建议您使用BaseCamp](http://www.basecamphq.com/?referrer=MITCHELSELLERS)之类的项目管理工具，而不仅仅是使用电子邮件进行交流。我发现它有助于将消息、文档和时间表传达给客户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T16:13:01.727

如果您使用的是 Team Foundation Server，我建议您安装[TeamPlain Web Access](http://www.devbiz.com/teamplain/webaccess/default.aspx)。它们允许您向 TFS 项目公开 Web 界面。剩下要做的唯一事情就是授予您的客户权限以及用户名和密码。

否则，有一些付费工具，如[FogBugz](http://www.fogcreek.com/FogBUGZ/)。当然，主要是必须将错误报告工具直接链接到您的源代码管理，以便开发人员可以轻松修复错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T19:02:27.093

虽然我不知道具体的工具（至少没有开源工具），但我建议您设置一个涵盖您的整体需求收集和实施过程的系统。可以在系统中跟踪需求，该系统还包含设计文档（可以从系统中“签出”并“提交给”系统）。这样，您就可以解决设计文档的多次修订问题。此外，可以轻松跟踪设计文件和需求。如果该系统链接到您的源代码管理系统，您将额外简化您的开发过程/需求跟踪。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T15:54:42.337

另一种可能性是同时使用两种产品，这是我们目前由 12 人组成的团队的设置：

**[osTicket](http://osticket.com/)**来自客户端的传入请求

*   允许支持人员处理问题并验证错误
*   仅使用电子邮件地址和票证 ID 即可检查状态
*   通常用户不会提交足够详细的错误报告，所以这是一个很好的第一步

**[redmine](http://www.redmine.org/)**开发票

*   如果问题是真正的错误，则由 QA 或开发人员创建的票证
*   提供足够可靠的项目和发布管理
*   从[trac](http://trac.edgewall.org/)和[mantis](http://www.mantisbt.org/)迈出坚实的一步（并提供[迁移](http://www.redmine.org/wiki/redmine/RedmineMigrate)工具）

# oracle - Oracle存储过程中的“AS”和“IS”有什么区别？

> ID：230348
> 
> 赞同：101
> 
> 时间：2008-10-23T16:11:11.980
> 
> 标签：oracle, stored-procedures, keyword

我看到 Oracle 程序有时用“AS”编写，有时用“IS”关键字编写。

```
CREATE OR REPLACE Procedure TESTUSER.KILLINSTANCE (INSTANCEID integer) **AS**
... 
```

对比

```
CREATE OR REPLACE Procedure TESTUSER.KILLINSTANCE (INSTANCEID integer) **IS**
... 
```

两者有什么区别吗？

* * *

编辑：显然，两者在功能上没有区别，但是有些人遵循约定，当 SP 是包的一部分时使用“AS”，而不是包时使用“IS”。或者反过来。嗯。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-23T16:18:46.597

什么都没有。它们是为使您的代码更具可读性而提供的同义词：

功能 f 是...

创建视图 v AS SELECT ...

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-10-27T07:10:24.560

一个细微的差别...

它们是包和过程的同义词，但不是游标：

这有效...

```
cursor test_cursor
is
select * from emp; 
```

...但这不会：

```
cursor test_cursor
as
select * from emp; 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2014-06-18T10:07:36.650

“IS”和“AS”在创建过程和包时充当同义词，但不适用于游标、表或视图。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-04-15T11:43:40.223

这是另一个区别（至少 10 克）

给定一个松散的对象类型：

```
CREATE TYPE someRecordType AS OBJECT
(
   SomeCol VARCHAR2(12 BYTE)
); 
```

您可以使用或创建`loose`此对象类型的表类型`AS``IS`

```
CREATE OR REPLACE TYPE someTableType
        IS {or AS} TABLE OF someRecordType; 
```

但是，如果您在包中创建相同的表类型，则必须使用`IS`：

```
CREATE OR REPLACE PACKAGE SomePackage IS
    TYPE packageTableType IS TABLE OF someRecordType;
END SomePackage; 
```

在包中使用会`AS`产生以下错误：

> 错误（2,30）：PLS-00103：在预期以下情况之一时遇到符号“TABLE”：对象不透明

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-03-19T18:13:01.503

根据[TutorialsPoint](https://www.tutorialspoint.com/plsql/plsql_procedures.htm)

> 使用 AS 关键字代替 IS 关键字来创建独立过程。

并考虑到以前的答案，

我猜

`AS`用于独立（在任何块、子程序、包之外）实体

和

`IS`用于嵌入（在块、子程序或包中）实体。

.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-06-21T06:15:22.343

使用**AS**关键字代替**IS**关键字来创建**独立函数**。

[**独立**存储函数是存储在数据库中的函数（**返回单个值的子程序）。**注意：您使用 CREATE FUNCTION 语句创建的独立存储函数**不同于**您在 PL/SQL 块或包中声明和定义的函数。]

有关更多说明，[请阅读此](https://docs.oracle.com/cd/B28359_01/appdev.111/b28370/function.htm#LNPLS01322)...

# language-agnostic - 如何在网页中添加动态天气代码

> ID：230350
> 
> 赞同：0
> 
> 时间：2008-10-23T16:11:46.020
> 
> 标签：language-agnostic

我发现的所有天气代码都是静态的，如果用户想要选择邮政编码，它会将您链接到不同的页面。

您是否知道任何在同一页面中获取新信息的天气自动收报机？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T16:14:30.770

[RICO](http://demos.openrico.org/weather_demo)有一个 AJAX 天气小部件，它似乎符合您的要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T16:41:27.347

您可以自己执行此操作 - 您通常可以从[National Weather Service 的 METARs](http://weather.noaa.gov/weather/metar.shtml)获取此数据。 [这是纽约州罗切斯特机场的 METAR](http://weather.noaa.gov/cgi-bin/mgetmetar.pl?cccc=KROC)。它们以各种方式（XML、FTP）可用，并且有很多解析器。

# sql - 为我的主键选择数据类型时应该考虑什么？

> ID：230351
> 
> 赞同：6
> 
> 时间：2008-10-23T16:11:55.440
> 
> 标签：sql, database-design

在新建数据库表时，选择主键的数据类型应该考虑哪些因素？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-24T10:10:54.280

很抱歉这样做，但我发现我对相关问题的回答（你可以检查[这个](https://stackoverflow.com/questions/159087/composite-primary-keys-versus-unique-object-id-field#164338)和[这个](https://stackoverflow.com/questions/224576/will-sql-server-2005-penalize-me-for-using-an-nvarchar50-as-a-primary-key-inste#225407)）可能适用于这个问题。我对它们进行了一些改造......

你会发现很多帖子都在讨论这个问题，你做出的每一个选择都有其优点和缺点。这些论点通常是指关系数据库理论和数据库性能。

关于这个问题，我的观点很简单：***代理主键总是有效***，而***自然键可能不总是有效***，这有多种原因：字段太短，规则改变等。

至此，您已经猜到我基本上是 uniqueIdentifier/surrogate 主键团队的成员，即使我欣赏和理解此处提出的论点，我仍在寻找“自然”的情况关键比代理好...

除此之外，支持这一基本规则的最重要但总是被遗忘的论点之一与**代码规范化和生产力**有关：

每次我创建一个表，**我是否会浪费时间**

1.  识别其主键及其物理特征（类型、大小）
2.  每次我想在我的代码中引用它时记住这些特征？
3.  向团队中的其他开发者解释我的 PK 选择？

**我**对所有这些问题的回答是否定的：

1.  当代理选项为我提供了一个防弹解决方案时，我没有时间浪费在尝试识别“最佳自然主键”上。
2.  当我编写代码时，我不想记住我的 Table_whatever 的主键是一个 10 个字符长的字符串。
3.  我不想浪费时间来协商自然密钥长度：“好吧，如果你需要 10 个，为什么不拿 12 个***来保证安全***？”。这种***“偏安全”的***说法着实让我恼火：如果你想留在安全的一边，就说明你真的离不安全的不远了！选择代理人：它是防弹的！

所以在过去的五年里，我一直在遵循一个非常基本的规则：每个表（我们称之为“myTable”）都有其第一个名为 uniqueIdentifier`'id_MyTable'`类型的字段。即使此表支持“多对多”关系，其中字段组合提供了非常可接受的主键，我更喜欢将此`'id_myManyToManyTable'`字段创建为 uniqueIdentifier，只是为了遵守规则，因为最后，它确实不疼。

主要优点是您不必再关心代码中主键和/或外键的使用。获得表名后，您就知道 PK 名称和类型。一旦您知道在数据模型中实现了哪些链接，您就会知道表中可用外键的名称。

而且，如果您仍然想在桌子上的某处放置“自然键”，我建议您按照标准模型构建它，例如

```
Tbl_whatever

   id_whatever, unique identifier, primary key
   code_whatever, whateverTypeYouWant(whateverLengthYouEstimateTheRightOne), indexed
   ..... 
```

其中 id_ 是主键的前缀，而 code_ 用于“自然”索引字段。有些人会争辩说应该将 code_ 字段设置为唯一的。确实如此，并且可以通过 DDL 或外部代码轻松管理它。请注意，许多“自然”键是计算出来的（发票编号），因此它们已经通过代码生成

我不确定我的规则是不是最好的。但它是一个非常有效的！如果每个人都在应用它，我们将避免浪费时间回答这类问题！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-23T16:14:51.800

如果使用数字键，请确保数据类型足够大以容纳您可能希望表增长到的行数。

如果使用 guid，是否需要考虑存储 guid 所需的额外空间？对于应用程序的开发人员或用户来说，针对 guid PK 进行编码是否会很痛苦。

如果使用复合键，您确定组合列将始终是唯一的吗？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-23T16:34:34.583

我真的不喜欢他们在学校教的东西，即使用“自然键”（例如书籍数据库上的 ISBN），甚至使用由 2 个或更多字段组成的主键。我永远不会那样做。所以这是我的小建议：

*   **在每个表中始终为您的主键提供一个专用列。**
*   **它们在所有表中都应该具有相同的列名，即“ID”或“GUID”**
*   **尽可能使用 GUID（如果您不需要性能），否则增加 INT**

编辑：
好的，我想我需要稍微解释一下我的选择。

*   为您的主键在所有表中使用相同的专用列名称，只会使您的 SQL 语句更易于构建，并且对其他人（可能不熟悉您的数据库布局）更容易理解。尤其是当你做很多 JOINS 之类的事情时。您不需要查找特定表的主键，您已经知道，因为它在任何地方都是相同的。

*   GUID 与 INT 在大多数情况下并不那么重要。除非您达到 GUID 的性能上限或进行数据库合并，否则您不会遇到任何重大问题。**但**我更喜欢 GUID 是有原因的。GUID 的全局唯一性总有一天会派上用场。也许您现在看不到它的需要，但是诸如将部分数据库同步到笔记本电脑/手机，甚至在不需要知道它们在哪个表中的情况下查找数据记录之类的事情，都是 GUID 优势的很好例子提供。Integer 仅在一个表的上下文中标识一条记录，而 GUID 则在任何地方标识一条记录。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-23T16:16:20.177

在大多数情况下，我使用 identity int 主键，除非场景需要大量复制，在这种情况下我可能会选择 GUID。

我（几乎）从未使用过有意义的键。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-23T22:51:58.770

除非您有一个非常方便的可用自然键，否则请始终使用数字类型的合成（又名代理）键。即使您确实有可用的自然键，您也可能需要考虑使用合成键并在您的自然键上放置一个额外的唯一索引。考虑一下当联邦法律发生变化时使用社会安全号码作为 PK 的高级数据库发生了什么，转换为合成密钥的成本是巨大的。

另外，我不同意将每个主键命名为相同的做法，例如“id”。这使得查询更难理解，而不是更容易。主键应以表命名。例如employee.employee_id、affiliate.affiliate_id、user.user_id 等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-23T16:17:05.260

不要使用浮点数值类型，因为无法正确比较浮点数是否相等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-23T16:17:07.850

*   你在哪里生成它？递增数字不适合客户端生成的密钥。
    *   你想要一个数据相关或独立的密钥（有时你可以使用业务数据中的 ID，不能说这是否总是有用的）？
    *   您的数据库对这种类型的索引有多好？

到目前为止，我已经使用了唯一标识符 (GUID) 或递增整数。

干杯马蒂亚斯

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T16:57:54.770

在现实世界中有意义的数字通常是个坏主意，因为现实世界时不时地改变关于如何使用这些数字的规则，特别是允许重复，然后你手上就会一团糟。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T16:15:45.760

我通常总是使用整数，但这是一个有趣的观点。

[https://blog.codinghorror.com/primary-keys-ids-versus-guids/](https://blog.codinghorror.com/primary-keys-ids-versus-guids/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-23T16:16:02.047

我偏爱使用生成的整数键。如果您希望数据库变得非常大，您可以使用 bigint。

有些人喜欢使用指南。优点是您可以在不更改任何键的情况下合并数据库的多个实例，但缺点是性能可能会受到影响。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-23T16:16:16.993

对于“自然”键，任何适合列的数据类型。人工（代理）键通常是整数。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-23T16:16:17.930

这一切都取决于。

a）您可以将唯一的连续数字作为主键吗？如果是，那么选择 UniqueIdentifier 作为主键就足够了。b）如果您的业务需求是您需要具有字母数字主键，那么您必须选择 varchar 或 nvarchar。

这是我能想到的两个选择。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-23T16:18:12.840

一个重要的因素是您要存储多少数据。我在一家网络分析公司工作，我们有大量数据。因此，由于大小，我们的 pageviews 表上的 GUID 主键会杀死我们。

经验法则：为了获得高性能，您应该能够将整个索引存储在内存中。向导很容易打破这个！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-23T19:32:02.183

在可以信任的情况下使用自然密钥。自然密钥的某些来源是不可信的。多年前，社会保障局过去常常将同一个 SSN 分配给两个不同的人。他们现在可能已经解决了这个问题。

您可能可以信任车辆的 VIN 和书籍的 ISBN（但不能信任可能没有 ISBN 的小册子）。

如果使用自然键，自然键将确定数据类型。

如果您不能信任任何自然密钥，请创建合成密钥。为此，我更喜欢整数。留出足够的空间进行合理的扩展。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-23T23:19:16.983

我通常使用所有表的 GUID 列主键（mssql 中的 rowguid）。什么可能是自然键我制作了独特的约束。一个典型的例子是用户必须填写并确保其唯一性的产品标识号。如果我需要一个序列，比如在发票中，我会构建一个表来保存最后一个数字和一个存储过程以确保序列化访问。或者 Oracle 中的序列 :-) 我讨厌自然键的“社会安全号码”示例，因为该号码在注册过程中永远不会出现。导致需要一种生成虚拟数字的方案。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-10-23T16:16:28.787

只要有可能，尽量使用作为自然键的主键。例如，如果我有一张每天记录一条记录的表，那么 logdate 将是一个很好的主键。否则，如果没有自然键，只需使用 int。如果您认为您将使用超过 20 亿行，请使用 bigint。有些人喜欢使用 GUID，这很好用，因为它们是独一无二的，而且你永远不会用完空间。但是，如果您只是进行临时查询，它们不必要地冗长，并且难以输入。

# winforms - Winforms csv文件生成，想要生成文件然后要求用户保存或打开它

> ID：230359
> 
> 赞同：1
> 
> 时间：2008-10-23T16:14:12.333
> 
> 标签：winforms, file, csv

当用户单击 winforms 应用程序上的按钮时，我将生成一个 CSV 文件。

然后我想要求用户将文件保存到磁盘或打开文件。

我怎样才能做到这一点？

注意：我只是在内存中生成文件，在用户选择保存路径之前不会将其写入磁盘。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T18:06:38.673

如果您希望在用户机器上的默认 CSV 应用程序中为用户打开此文件，则需要将其写入磁盘以实现此目的。

我会做的是，如果他们想保存它，只需将其保存到他们的位置！

如果他们想打开它，请将其保存到 temp 目录，然后使用 System.Diagnostics.Process.Start(path) 在默认应用程序中打开它。

# command-line - 如何使用 $ORIGIN 获取 RPATH 以在 Code::Blocks GCC 上工作？

> ID：230364
> 
> 赞同：17
> 
> 时间：2008-10-23T16:15:35.090
> 
> 标签：command-line, gcc, linker, codeblocks, rpath

我正在尝试将包含特殊字符串 $ORIGIN 的 RPATH 链接到使用 GCC 和 Code::Blocks IDE 构建的可执行文件中。我已经指定

```
-Wl,-R$ORIGIN 
```

在项目的链接器选项中，但到 GCC 的命令行输出是错误的（为了清楚起见已删除）：

```
g++ -Wl,-R 
```

为 Code::Blocks 指定此参数的正确方法是什么？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-23T16:16:21.173

决定制作令牌 $ORIGIN 的人是一个邪恶的混蛋，他应该在程序员地狱中占有一席之地。由于 '$' 是 bash 和其他脚本语言（如 make）的特殊字符，因此除非小心转义，否则它会搞砸一切。更糟糕的是，根据您使用的构建环境，如何正确逃脱的细节可能会发生变化。

在 bash 中，您需要在 $ 前面加上一个反斜杠：

```
-Wl,-R\$ORIGIN 
```

Code::Blocks 显然也将 $ 视为特殊的。然后，无论子进程控制器 Code::Blocks 发送命令以将反斜杠视为特殊的。因此，反斜杠和 $ 都需要加倍才能正确转义。因此，在 Code::Blocks 链接器设置中，您需要指定：

```
-Wl,-R\\$$ORIGIN 
```

...输出：

```
-Wl,-R\\$ORIGIN 
```

...到构建日志，但实际上发送了 shell：

```
-Wl,-R\$ORIGIN 
```

...如上所述会产生所需的结果。

多么痛苦。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-09-30T22:29:47.323

除了解决 Code:Blocks 问题的 kblucks 答案之外。对于像我这样偶然发现此页面并寻找如何使用 Make 执行此操作的人。诀窍是使用额外的 $ 符号作为转义字符并用引号将其括起来：

```
-Wl,-R,'$$ORIGIN/../lib' 
```

完整的解释可以在这里： [使用 ORIGIN for a dynamic runtime library search path](http://wayback.archive.org/web/20130915172134/http://itee.uq.edu.au/~daniel/using_origin/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-17T18:01:46.797

如果您的可执行文件是由一个不是您创建的巨大复杂脚本环境构建的，并且您不想深入研究它，请尝试运行`setenv LD_RUN_PATH='$ORIGIN/../lib'`; 如果这不起作用，一种实用的方法是为 ld 创建一个包装器：

```
#!/bin/sh
exec /usr/bin/ld -R '$ORIGIN/../lib' "$@" 
```

...然后在路径上使用该存根进行构建。在实践中，可能会调用它来构建 .so 文件或其他可执行文件，因此您可能需要将其设为更复杂的脚本，以决定是否插入 RPATH。或者，在没有这个的情况下运行构建，并且使用樱桃挑选。

（这里“/usr/bin/ld”是正常运行的 ld，可能在其他地方。gcc 可能无法从路径中获取 ld，请参阅 gcc 环境变量以覆盖它。里程可能会有所不同。单次使用仅。不保证比任何其他方法都更糟糕）。

# vba - 在 Excel 中打印更快

> ID：230382
> 
> 赞同：3
> 
> 时间：2008-10-23T16:17:11.280
> 
> 标签：vba, excel, printing

Excel 的打印功能（使用 VBA）非常慢。我希望有人能加快打印速度（不使用 Excel 4 宏技巧）。这是我现在的做法：

```
Application.ScreenUpdating = False

With ActiveSheet.PageSetup

  -various setup statements which I've already minimized-

End With   
ActiveSheet.PrintOut

Application.ScreenUpdating = True 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-23T19:38:03.043

是的，PageSetup 属性在设置时非常慢。

您已经设置了`Application.ScreenUpdating = False`，这很好，但在这种情况下，同样（或更重要）的一步是设置`Application.Calculation = xlCalculationManual`。（最好保存这些设置，然后在最后将它们恢复为原始设置。）

此外，每个 PageSetup 属性的属性获取都非常快，而只有属性集如此缓慢。因此，您应该测试新的属性设置以确保它与现有的属性值不同，以防止不必要的（和昂贵的）调用。

考虑到所有这些，您应该能够使用如下所示的代码：

```
Dim origScreenUpdating As Boolean
origScreenUpdating = Application.ScreenUpdating
Application.ScreenUpdating = False

Dim origCalcMode As xlCalculation
origCalcMode =  Application.Calculation
Application.Calculation = xlCalculationManual

With ActiveSheet.PageSetup
    If .PrintHeadings <> False Then .PrintHeadings = False
    If .PrintGridlines <> False Then .PrintGridlines = False
    If .PrintComments <> xlPrintNoComments Then .PrintComments = xlPrintNoComments
    ' Etc...
End With

Application.ScreenUpdating = origScreenUpdating
Application.Calculation = origCalcMode 
```

*编辑：几个更新：*

1.  对于 Excel 2010 及更高版本，您可以使用“Application.PrintCommunication”属性，而对于 Excel 2007 及更低版本，您可以使用“ExecuteExcel4Macro”。有关更多详细信息，请参阅将[Excel 4 宏迁移到 VBA](http://blogs.msdn.com/excel/archive/2010/02/16/migrating-excel-4-macros-to-vba.aspx)。

2.  对于 Excel 2007 及更低版本，另一个有趣的技巧是将打印机驱动程序临时分配给“Microsoft XPS 文档编写器”，然后将其重新设置。打印速度可提高 3 倍。请参阅：[慢速 Excel PageSetup 方法](http://social.msdn.microsoft.com/Forums/en-US/vsto/thread/8b2a0988-7d09-4abf-a4d3-76e81f708d40)。

希望这可以帮助...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T23:33:27.207

在推进 Michael 的帖子并回答 @rhc 的问题时，如果需要将页面设置自定义项从单个工作表复制到工作簿中的多个工作表，以下代码也可以帮助您：

```
Public Sub CopyPageSetupToAll(ByRef SourceSheet As Worksheet)
    ' Raise error if invalid source sheet is passed to procedure
    '
    If (SourceSheet Is Nothing) Then
        Err.Raise _
            Number:=vbErrorObjectVariableNotSet, _
            Source:="CopyPageSetupToAll", _
            Description:="Unable to copy Page Setup settings: " _
                 & "invalid reference to source sheet."
        Exit Sub
    End If

    SourceSheet.Activate

    With SourceSheet.PageSetup
        ' ...
        ' place PageSetup customizations here
        ' ...
    End With

    SourceSheet.Parent.Worksheets.Select
    Application.SendKeys "{ENTER}", True
    Application.Dialogs(xlDialogPageSetup).Show
End Sub 
```

或者，您也可以修改该过程以创建临时工作表来托管您的页面设置更改，然后将这些更改传播到工作簿中的其他工作表：

```
Public Sub CopyPageSetupToAll(ByRef SourceBook As Workbook)
    Dim tempSheet As Worksheet

    ' Raise error if invalid workbook is passed to procedure
    '
    If (SourceBook Is Nothing) Then
        Err.Raise _
            Number:=vbErrorObjectVariableNotSet, _
            Source:="CopyPageSetupToAll", _
            Description:="Unable to copy Page Setup settings: " _
                 & "invalid reference to source workbook."
        Exit Sub
    End If

    Set tempSheet = SourceBook.Worksheets.Add

    tempSheet.Activate

    With tempSheet.PageSetup
        ' ...
        ' place PageSetup customizations here
        ' ...
    End With

    SourceBook.Worksheets.Select
    Application.SendKeys "{ENTER}", True
    Application.Dialogs(xlDialogPageSetup).Show
    tempSheet.Delete

    Set tempSheet = Nothing
End Sub 
```

由于`SendKeys()`函数和`Application.Dialogs`功能的使用，此代码不能提供最简洁的解决方案。但是，它可以完成工作。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T16:52:10.490

如果您想为工作簿中的每个选项卡设置基本相同的页面设置，您可以通过设置一个工作表然后将该工作表的设置以某种方式复制到其他工作表来加快速度吗？这可能吗？

# java - Jmock 如何与 HttpSession 和 HttpServletRequest 一起使用

> ID：230389
> 
> 赞同：0
> 
> 时间：2008-10-23T16:18:55.850
> 
> 标签：java, junit, mocking, jmock

我是 jmock 的新手，并试图模拟一个 HttpSession。我正进入（状态：

java.lang.AssertionError：意外调用：httpServletRequest.getSession() 未指定期望：您是否... - 忘记以基数从句开始期望？- 调用模拟方法来指定期望的参数？

测试方法：

@测试

```
public void testDoAuthorization(){

    final HttpServletRequest request = context.mock(HttpServletRequest.class);
    final HttpSession session = request.getSession();

    context.checking(new Expectations(){{
       one(request).getSession(true); will(returnValue(session));
   }});

    assertTrue(dwnLoadCel.doAuthorization(session));
} 
```

我做了一些搜索，但我仍然不清楚这是如何完成的。感觉就像我错过了一些小块。任何有这方面经验的人都可以为我指明正确的方向。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T19:34:08.967

您不需要模拟请求对象。由于您正在测试的方法 ( `dwnLoadCel.doAuthorization()`) 仅依赖于一个`HttpSession`对象，因此您应该模拟它。所以你的代码看起来像这样：

```
public void testDoAuthorization(){
    final HttpSession session = context.mock(HttpSession.class);

    context.checking(new Expectations(){{
        // ???
    }});

    assertTrue(dwnLoadCel.doAuthorization(session)); 
```

}

问题变成了：您希望 SUT 实际对会话对象*做什么？*您需要在期望中表达对的调用`session`及其相应的返回值，这些返回值应该会导致`doAuthorization`返回`true`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T16:40:32.293

我认为您需要告诉 JMock 上下文您希望该方法被调用多少次，然后才能真正继续调用它。

```
final HttpServletRequest request = context.mock(HttpServletRequest.class);

context.checking(new Expectations(){{
  one(request).getSession(true); will(returnValue(session));
}});

final HttpSession session = request.getSession(); 
```

我对 JMock 不是很熟悉，但你真的关心在你的`dwnLoadCel`单元测试中被模拟对象中的某些方法被调用了多少次吗？或者你只是想测试你的类，它依赖于一个没有实际会话的 HttpSession？如果是后者，我认为 JMock 对你来说太过分了。

您可能想考虑创建一个`HttpSession`自己实现接口的类，仅用于单元测试（存根），然后运行您的测试，或者您应该查看`dwnLoadCel`并确定它是否*真的*需要对 HttpSession 的引用，或者它只需要 HttpSession 中的一些属性。重构`dwnLoadCel`只依赖于它实际需要的东西（`Map`会话对象中的一个或某个参数值）——这将使您的单元测试更容易（对 servlet 容器的依赖关系消失）。

我认为你已经在你的类中进行了某种程度的依赖注入，但是你可能依赖于一个过于广泛的对象。[谷歌测试博客](http://googletesting.blogspot.com/)最近有[很多关于 DI](http://googletesting.blogspot.com/2008/10/dependency-injection-myth-reference.html) [的优秀](http://misko.hevery.com/2008/07/08/how-to-think-about-the-new-operator/) [文章](http://misko.hevery.com/2008/09/10/where-have-all-the-new-operators-gone/)，你可能会觉得有用（我当然有）。

# sql-server - 是否有一个干净的 T-SQL 查询可用于验证索引是否具有正确的列？

> ID：230397
> 
> 赞同：5
> 
> 时间：2008-10-23T16:21:50.383
> 
> 标签：sql-server, tsql, indexing

我正在编写一个数据库升级脚本，它将检查索引是否定义了正确的两列。如果没有，或者只有其中一个，那么我将删除它（有没有办法改变索引？）然后用两者重新创建它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-23T16:35:34.147

我没有立即可用的数据库来测试这一点，但是您应该能够通过使用以下 IF EXISTS 语句来查看索引中是否存在列。

我不确定您是否可以即时更改索引。

```
IF EXISTS
(
   SELECT MyIndex.Name AS IndexName, 
          Columns.name AS ColumnName 
   FROM sys.indexes MyIndex
   INNER JOIN sys.index_columns IndexColumns 
      ON  MyIndex.index_id = IndexColumns.index_id
      AND MyIndex.object_id = IndexColumns.object_id 
   INNER JOIN sys.columns Columns
      ON  Columns.column_id = IndexColumns.column_id 
      AND IndexColumns.object_id = Columns.object_id 
   WHERE Columns.name = 'ColumnName'
   AND MyIndex.Name='IX_MyIndexName'
) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T17:11:06.743

谢谢你的帮助，埃德。这是我使用您的解决方案作为开始编写的解决方案。已经过验证。基本上它具有所有正确的连接。

```
 IF EXISTS
(
    SELECT i.Name AS IndexName, c.Name AS ColumnName
    FROM sys.indexes i
        JOIN sys.index_columns ic
            ON i.object_id = ic.object_id AND i.index_id = ic.index_id
        JOIN sys.columns c
            ON ic.object_id = c.object_id AND c.column_id = ic.column_id
    WHERE c.Name = 'MyColumnName' AND i.Name='MyIndexName'
) 

```

# asp.net - 如何使用 jQuery 调用 ASP.NET Web 服务？

> ID：230401
> 
> 赞同：64
> 
> 时间：2008-10-23T16:22:58.367
> 
> 标签：asp.net, jquery, web-services

我正在尝试使用 jQuery 从 ASP.NET Web 服务 (SharePoint Server 2007 lists.asmx) 中获取数据，但是任何对 Web 服务的调用都将有助于作为朝着这个方向迈出的第一步。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-01-27T22:08:48.270

我将此方法用作包装器，以便可以发送参数。同样使用方法顶部的变量可以使其以更高的比率最小化，并在进行多次类似调用时允许某些代码重用。

```
function InfoByDate(sDate, eDate){
    var divToBeWorkedOn = "#AjaxPlaceHolder";
    var webMethod = "http://MyWebService/Web.asmx/GetInfoByDates";
    var parameters = "{'sDate':'" + sDate + "','eDate':'" + eDate + "'}";

    $.ajax({
        type: "POST",
        url: webMethod,
        data: parameters,
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(msg) {
            $(divToBeWorkedOn).html(msg.d);
        },
        error: function(e){
            $(divToBeWorkedOn).html("Unavailable");
        }
    });
} 
```

我希望这会有所帮助。

请注意，这需要 3.5 框架公开可以以这种方式使用的 JSON 网络方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-23T16:26:28.687

下面是一个使用 jQuery.get 调用 Web 服务的示例：

```
$.get("http://domain.com/webservice.asmx", { name: "John", time: "2pm" },
  function(data){
    alert("Data Loaded: " + data);
  }); 
```

在上面的示例中，我们调用“webservice.asmx”，传递两个参数：名称和时间。然后，在回调函数中获取服务输出。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T17:21:19.717

我不知道特定的 SharePoint Web 服务，但您可以使用`<WebMethod()>`（在 VB.NET 中）装饰页面方法或 Web 服务，以确保它序列化为 JSON。您可能只需将 webservice.asmx 内部使用的方法包装在您自己的 Web 服务中。

Dave Ward 对此[进行了很好的演练](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-03T04:30:58.547

```
$.ajax({
 type: 'POST',
 url: 'data.asmx/getText',
 data: {'argInput' : 'input arg(s)'},
 complete: function(xData, status) {
 $('#txt').html($(xData.responseXML).text()); // result
 }
}); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T21:58:33.157

我在*[jQuery AJAX 和 ASMX](http://www.sonerdy.com/jquery-ajax-and-asmx/)*中有一个不错的例子，关于将 jQuery AJAX 调用与 asmx Web 服务一起使用...

为了让它返回 JSON，有一行代码需要取消注释。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-05-06T07:59:56.493

[SPServices](http://spservices.codeplex.com/)是一个 jQuery 库，它抽象了 SharePoint 的 Web 服务并使它们更易于使用

它已[通过](http://spservices.codeplex.com/wikipage?title=Glossary#Certification)SharePoint 2007认证

Lists.asmx 支持的操作列表可以在[这里找到](http://spservices.codeplex.com/wikipage?title=Lists&referringTitle=%24%28%29.SPServices)

## 例子

在此示例中，我们将获取 Announcements 列表中的所有项目，并在 tasksUL div 的项目符号列表中显示标题：

```
<script type="text/javascript" src="filelink/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="filelink/jquery.SPServices-0.6.2.min.js"></script>
<script language="javascript" type="text/javascript">

$(document).ready(function() {
  $().SPServices({
    operation: "GetListItems",
    async: false,
    listName: "Announcements",
    CAMLViewFields: "<ViewFields><FieldRef Name='Title' /></ViewFields>",
    completefunc: function (xData, Status) {
      $(xData.responseXML).SPFilterNode("z:row").each(function() {
        var liHtml = "<li>" + $(this).attr("ows_Title") + "</li>";
        $("#tasksUL").append(liHtml);
      });
    }
  });
});
</script>
<ul id="tasksUL"/> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-04T16:14:29.600

我经常使用 ajaxpro 和 jQuery。ajaxpro 让我可以从 JavaScript 调用 .NET 函数，其余部分使用 jQuery。

# sharepoint - 在 MOSS '07 布局页面中使用 MulitpleLookupField

> ID：230402
> 
> 赞同：1
> 
> 时间：2008-10-23T16:24:37.350
> 
> 标签：sharepoint, moss

我的 MOSS '07 网站有一个页面布局，我想在其中放置一个 MultipleLookupField。该字段将指向我的自定义内容类型中的多个查找列，该列指向页面库，因此我可以拥有一个“相关文章”字段.

我已经让该字段正确显示——当页面处于编辑模式时，它甚至是可编辑的！但是，当您单击那里显示的链接时，它会显示页面的属性视图而不是页面本身。

控件上有很多属性，但 MSFT 几乎没有关于它们的作用的文档。

有谁知道如何将链接的 URL 更改为实际页面而不是属性视图？

这是我正在使用的标签：

> <SharePointWebControls:MultipleLookupField ID="MultipleLookupField1" FieldName="RelatedIssues" runat="server"></SharePointWebControls:MultipleLookupField>

该链接将我带到这里：/Pages/Forms/DispForm.aspx?ID=6&RootFolder=*

我希望它带我到这里：/Pages/faq1.aspx

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-23T20:12:56.483

不幸的是，查找控件被设计为与通用列表兼容，并且不理解文档库具有与特定 url 关联的文件。

您可能必须在 Web 上找到自定义查找控件或自己滚动。

# unix - 什么是查看有多少磁盘空间以及剩余多少的 unix 命令？

> ID：230407
> 
> 赞同：22
> 
> 时间：2008-10-23T16:26:24.320
> 
> 标签：unix, aix, diskspace

我正在寻找相当于在 Windows 中右键单击驱动器并查看已用磁盘空间和剩余信息的方法。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-23T16:27:36.113

查找命令`du`（磁盘使用情况）和`df`（磁盘空闲）

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-23T16:28:02.163

使用 df 命令：

df -h

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-04-09T04:42:27.033

```
df -g . 
```

以 GB 为单位的大小的选项 g 块和 . 对于当前工作目录。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-23T17:41:20.160

我喜欢先按`du -sh * | sort -nr | less`最大的文件排序

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-23T17:21:37.923

如果您想查看每个文件夹占用多少空间：

杜 -sh *

*   `s`——总结
*   `h`- 人类可读
*   `*`- 文件夹列表

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-01-11T11:58:14.953

注意：最初的问题已经回答了，但我想用一些与该主题相关的附加内容来扩展它。

您的 AIX 安装将首先放入卷组中。这是在安装时完成的。

它将首先创建 rootvg（如在根卷组中）。这有点像您映射的实际硬盘驱动器。

这相当于 Windows 中的光盘管理。AIX 不会像我们在消费类 Windows 机器中那样使用它的文件系统的所有空间。相反，会有大量未分配的空间。

要检查您的 rootvg 需要多少空间，请使用以下命令。

```
lsvg rootvg 
```

那将代表列表卷组 rootvg。这将为您提供诸如物理分区 (PP) 的大小、分配给卷组的总 PP、卷组中的空闲 PP 等信息。无论如何，输出应该相当全面。

您可能感兴趣的下一件事是卷组上的文件系统。每个文件系统都会在它所属的卷组中分配一定数量的空间。

要检查卷组上的文件系统，请使用以下命令。

```
lsvgfs rootvg 
```

与列出 rootvg 的卷组文件系统一样。

您可以使用以下命令检查每个文件系统有多少空间。

```
df 
```

我个人喜欢用 -m 和 -g 之类的标志来改进它（分别以兆字节和千兆字节为单位）

如果您的卷组中有可用空间，您可以使用以下命令将其分配给您的文件系统。

```
chfs -a size=+1G /home 
```

就像在文件系统为 /home 的地方添加 1 G 来更改文件系统属性大小一样。使用 man chfs 获取更多说明。这是一个强大的工具。此示例用于调整大小，但是您可以使用此命令执行更多操作。

资料来源： [http](http://www.ibm.com/developerworks/aix/library/au-rootvg/) ://www.ibm.com/developerworks/aix/library/au-rootvg/ + 我自己使用 AIX 的经验。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-05-02T15:00:45.013

所有这些答案表面上都是正确的。然而，正确的答案是

```
 apropos disk   # And pray your admin maintains the whatis database 
```

因为提出问题，而手册中的答案就在您的指尖，这会浪费每个人的时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-01-25T18:17:33.827

`su -sm ./*`

您可以像列表一样查看当前目录中的每个文件和文件夹大小 (-sm=Mb ; -sk=Kb)。这种方式在所有 Unix/Linux 环境中运行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-18T02:47:16.317

du -sm * => RULLLLLEZ

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-07-23T17:05:02.040

```
df -tk 
```

用于 1024 字节块的磁盘空闲大小

# sql-server - SET IDENTITY_INSERT OFF 的数据库范围等效项

> ID：230409
> 
> 赞同：1
> 
> 时间：2008-10-23T16:26:39.250
> 
> 标签：sql-server, identity, identity-insert

在我从 SQL 脚本插入 140 万行数据的[永恒](https://stackoverflow.com/questions/222442/sql-server-running-large-script-files) [传奇](https://stackoverflow.com/questions/224830/how-do-i-set-a-sql-server-scripts-timeout-from-within-the-script)中，我编写了一个基本的 WinForms 应用程序，它获取脚本的每一行并单独执行它。

但是，由于原始脚本包含

```
SET IDENTITY_INSERT [Table] OFF 
```

并且 SET 是一个会话范围的命令，这个设置在每次 SQL 调用时都会丢失，这意味着每一行都失败了。有没有办法在整个数据库范围内为整个表设置 IDENTITY_INSERT 以便我可以在不失败的情况下进行这些单独的调用？或者我可以通过在每一行附加一个命令来告诉它忽略身份规范？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T16:30:10.397

[批量插入](http://msdn.microsoft.com/en-us/library/ms188365.aspx)对您不起作用？还是 SQL Server 导入/导出向导（[此处](http://www.databasejournal.com/features/mssql/article.php/3580216)或[此处](http://technet.microsoft.com/en-us/library/ms141209.aspx)）？我知道导入/导出可以关闭整个导入的身份插入。我有理由确定您可以在 BULK INSERT 之前做到这一点

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T16:46:38.147

我相信 IDENTITY INSERT 一次只能覆盖一个表，每个会话。

您可能必须一次批处理 2 或 300 个插入语句，并在每个批处理之前使用 ident 插入。

所以应用程序将执行这样的块......

```
SET IDENTITY_INSERT [Table] OFF;
INSERT INTO TABLE VALUES (1, 'a');
INSERT INTO TABLE VALUES (2, 'b');
INSERT INTO TABLE VALUES (3, 'c');
INSERT INTO TABLE VALUES (4, 'd');
INSERT INTO TABLE VALUES (5, 'e');
SET IDENTITY_INSERT [Table] ON; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T17:47:28.103

在进行 140 万个插入作业时，是否还有其他内容要访问/插入到表中。

如果没有，您可以在工作期间简单地禁用 PK 列上的身份？

# xml - XSLT Xalan dyn：评估示例

> ID：230411
> 
> 赞同：2
> 
> 时间：2008-10-23T16:27:14.660
> 
> 标签：xml, xslt, xalan, exslt, xslt-extension

我希望你在样式表中使用 EXSLT - DYN:EVALUATE。我已经添加了名称速度，但我不知道我需要导入的 .xsl 文件在哪里。我不相信我安装了 XALAN 来指向导入。我将如何安装它？安装后，我将其指向 .xsl，它会获取该功能并应用它吗？我正在运行 Windows。XSLT 文件包含在 XML 文档的顶部。

谢谢

皮特

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-24T05:11:49.890

Xalan 具有内置的 EXSL dyn:evaluate 函数，您无需导入任何内容即可使用它。您只需要声明命名空间。我举一个小例子：

*输入.xml*：

```
<root>
<foo>I am foo</foo>    
<bar>I am bar</bar>    
</root> 
```

*dyn_evaluate.xsl*：

```
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:dyn="http://exslt.org/dynamic"
    extension-element-prefixes="dyn">

  <xsl:param name="path"/>

  <xsl:output method="text"/>

  <xsl:template match="/">
    <xsl:value-of select="dyn:evaluate($path)"/>
  </xsl:template>

</xsl:stylesheet> 
```

跑步

```
xalan.exe -p path '/root/foo' input.xml dyn_evaluate.xsl 
```

给

```
I am foo 
```

跑步

xalan.exe -p path '/root/bar' input.xml dyn_evaluate.xsl

给

```
I am bar 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-24T08:13:21.383

您将如何从 JSP 页面调用它？JSP 提供 XML 并且当前将样式表附加到 XML 页面并提供结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-28T19:40:18.483

您不能，因为如果您使用带有附加样式表的 XML 页面为客户端提供服务，这将行不通。浏览器不支持 exslt。

但是，如果您在服务器上进行 XSLT 处理（使用 xalan），您可以让它工作，但我不明白您如何将 xslt 与 jsp 结合使用。

# c# - 以编程方式删除 Sql Ce 系统表？

> ID：230421
> 
> 赞同：0
> 
> 时间：2008-10-23T16:29:41.473
> 
> 标签：c#, sql-server-ce, microsoft-sync-framework

我正在使用 SQL Server Compact (SQL CE) 和同步框架。但是，同步框架在调用 SqlCeClientSyncProvider 的 CreateSchema() 方法时会创建一些系统表（例如 __sysSyncArticle、__sysSyncSubscription，...）。

我无法在 Visual Studio 中使用 SQL 语句删除这些表（声明“不支持删除表”），并且在尝试创建 SqlCeCommand 时收到一条消息，指出指定的表不存在。

以编程方式删除 SQL CE 系统表需要什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-03T12:30:48.923

Joachim，您需要使用 Sync Framework 来解决这个问题，而不是反对它。数据库的重点是跟踪同步元数据。如果您希望它是不同的副本（不同的锚点、客户端 ID 等），请将其设置为不同的副本。

我建议您查看新的 MSF 2.0，特别是供应和管理 API。它们似乎提供了您需要的更多灵活性。 [同步框架 v2](http://www.microsoft.com/downloads/details.aspx?FamilyID=89adbb1e-53ff-41b5-ba17-8e43a2e66254&displaylang=en)

# wcf - WCF 在企业中，您的经验有什么建议吗？

> ID：230427
> 
> 赞同：8
> 
> 时间：2008-10-23T16:32:22.170
> 
> 标签：wcf, performance, enterprise

希望听到在企业环境中使用 WCF 的人的意见。

推出的主要障碍是什么？性能问题？任何和所有提示表示赞赏！

如果可以，请提供一些一般统计数据和服务器配置！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-23T16:36:28.933

WCF 可以是[配置地狱](http://msdn.microsoft.com/en-us/library/ms731734.aspx "WCF 配置架构")。一定要熟悉它的[诊断和 svcTraceViewer](http://msdn.microsoft.com/en-us/library/ms732023.aspx)，以免你得到神秘的、无用的异常。并注意生成的客户端[对一次性模式的破坏实现](http://www.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T01:08:14.930

我最近被一家公司聘用，该公司以前使用传统的 asp.net Web 服务处理他们的客户端/服务器通信并来回传递数据集。

我重新编写了核心，所以现在有一个 Net.Tcp “连接”客户端......一切都通过那里完成。这是一个值得“生产中发现”的一周……但非常值得。

我们必须在游戏后期发现的痛点是：1）默认限制阻止了第 11 个用户（默认只允许 10 个）。2) 默认“maxBufferSize”设置为 65k，因此需要下载的第一个位图使服务器崩溃:) 3) 其他默认配置（最大并发连接数、最大并发调用数等）。

总而言之，这绝对是值得的……只需更改其基础结构，应用程序就更快了，现在我们已经“连接”了用户……服务器可以将消息向下发送到客户端。

其他美妙的收获是，由于我们 100% 知道谁是连接的，我们实际上可以在应用程序级别执行我们的许可政策。在此之前（以及在我被聘用之前），我的公司必须简单地登录，然后在月底向客户收取额外的费用，以连接太多次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T16:58:47.843

如前所述，配置噩梦和异常可能很神秘。您可以启用跟踪并使用跟踪日志查看器对问题进行一般性故障排除，但这绝对是对 WCF 服务进行故障排除的一种方式，尤其是在您部署它并且在代码执行之前遇到问题时。

对于我组织内的组件之间的通信，我最终`[NetDataContract]`在我的服务和代理上使用了建议反对（你不​​能与.NET 之外的平台集成并且集成你需要具有合同的程序集），尽管我发现性能变得出色，使用它可以减少我的整体开发时间。对我们来说，这是正确的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T16:49:59.903

WCF 绝对适合企业级产品，因为它在设计时考虑到了可伸缩性、可扩展性、安全性等……。

正如 maxidad 所说，这可能非常困难，因为异常通常几乎不会告诉您任何信息，如果您使用安全性（显然对于企业场景），您必须处理证书、无意义的 MessageSecurityExceptions 等等。

处理 WCF 服务肯定比使用旧的 asmx 服务更难，但是一旦你进入，就值得付出努力。

提供服务器配置对您没有用处，因为它必须适合您的场景。使用正确的绑定非常重要，以及安全性、并发性。使用 wcf 时没有单一的方法。想想你的要求。你需要回调，你的用户是什么？你需要什么样的安全？

但是，WCF 绝对是企业级应用程序的正确技术。

# sharepoint - 促进 MOSS '07 网站从开发到生产

> ID：230429
> 
> 赞同：5
> 
> 时间：2008-10-23T16:32:38.613
> 
> 标签：sharepoint, moss, migration, administration

所以，也许我有点老派，但是当我们过去创建网站时，我们会在开发服务器上开发网站，然后将页面和文件发布或推广到生产服务器。这似乎一直是一个好方法，这样用户就不会看到混乱的页面或（上帝保佑）因为我们中的一个人搞砸了而宕机的服务器。

但微软在创建 SharePoint 时似乎并没有想到这个想法……至少，我无法在定义的基础架构中找到实现这一点的方法。

有谁知道是否有针对 SharePoint 开发的管理策略？我在网上看到我们可以备份开发环境并恢复到生产服务器。这可能是第一次工作，但是对生产服务器的任何更新都无法做到这一点，而不会冒生产服务器上的数据丢失的风险。我已经看到了一些用于将列表内容、页面和文档从一台服务器迁移到另一台服务器的工具——尽管不可否认，我还没有研究过它们。

但是，我关心的另一个问题是自定义内容类型。似乎一旦列表使用了内容类型，您就无法在不从列表中删除项目、取消关联内容类型并重新关联内容类型的情况下对其进行更新。不应该有一些方法来升级内容类型吗？

无论如何，如果您对当前的这些困境有任何建议，我很乐意听取您的意见。

提前致谢，

担

* * *

感谢您的快速答复。

我们已经为我们的网站创建了几个功能和一个针对基础（内容类型、列等）的解决方案包捆绑功能，以及与品牌相关的功能（页面布局、母版页等）的另一个解决方案。

但这似乎是一次性的……基本上，它可以设置我们的服务器，对吗？一旦人们开始使用生产环境，我们的内容数据库中就会有文档、页面、列表项，并且不可能更新内容类型、列等内容。

您必须先停用和卸载功能，然后才能安装和激活新功能，对吧？我在功能定义上看到了 Version 属性，但据我所知，这没有任何作用。解决方案似乎可以通过增加版本号来升级，但它似乎并没有修改内容类型和列之类的东西——尤其是在它们正在使用的情况下。另外，我不确定解决方案升级的范围有多大。

这类事情几乎没有什么珍贵的文档。似乎我正在阅读的所有内容都是如何在最初设置您的 SharePoint 服务器......而不是长期管理它。

你有什么意见或建议吗？

* * *

谢谢大家的建议。

但是我们已经在这个网站上工作了一年多。我非常有信心，我们已经按照你们大多数人的建议进行了设置。我们已经有几个功能可以安装内容类型、列、母版页、页面布局和工作流等内容。大多数这些功能都包含在解决方案包中。我们将所有开发环境都设置为 VPC 服务器。

所以，我已经基本完成了初始部署。我真正希望找出的是如何升级内容类型和列之类的东西以及未来的东西。内容类型在使用后是否可以更改？因为根据我的初步测试，这似乎是不可能的。我不担心这些程序集，因为看起来它们交换得很好，但是我更新内容类型的唯一方法是删除引用它们的任何项目（即我的页面库中的所有页面），删除内容类型，然后重新添加它。

你们中的任何人都知道是否有办法在初始部署后更新内容类型？...当用户已经根据我们已经部署的内容类型创建了项目时？

（我的问题的另一部分实际上是将现有页面从开发服务器移动到生产服务器，但我可以没有它。我主要担心的是内容类型。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T16:36:42.600

最好的方法是开发功能。完成这些功能后，您可以使用解决方案包（称为 WSP）部署它们。

剩下要做的就是重新激活这些功能。这样，您就可以逐步推出新功能，而无需在生产中进行所有操作。

[WSPBuilder](http://www.codeplex.com/wspbuilder)是一个帮助您构建 WSP 的应用程序。

为了使所有这些自动化......祝你好运。涉及很多工作。

**更新：** 部署内容类型和列很棘手。创建网站后，您将无法再通过功能对其进行更新。您需要遍历代码并递归遍历所有站点并修改与名称匹配的特定内容类型。

我们已经尝试过，但使用功能通常无法做到这一点。这需要经历我称之为“使用代码部署”的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T20:27:59.543

你真的需要使用一个特性来定义你的内容类型，因为这样每个内容类型都将有一个设置的 GUID，并将使用相同的名称存储在数据库中。这在在站点上运行 CAML 查询时变得很重要，并且如果您愿意的话，当内容类型被创建时，还有一些其他的小问题。

我更喜欢[STSDev](http://www.codeplex.com/stsdev)来推出使用自定义内容类型的解决方案。

有两种方法可以在服务器上编辑页面。您可以将页面库定义为具有主要和次要版本。这允许编辑者编辑页面和定义的发布者来发布它们。这在内部站点上很好，但不建议用于面向公众的站点。

对于面向公众的站点，您将需要使用[内容部署](http://blogs.msdn.com/sharepoint/archive/2006/05/02/588140.aspx)

我再怎么强调都不过分，在继续发布产品之前，请确保您拥有内容类型的功能。

正如这里提到的，[Chris O'Brian](http://www.sharepointnutsandbolts.com/2008/09/sharepoint-dev-strategies-it-not-all.html)有一篇文章说除非必要，否则不应使用功能。他的原因之一是它减缓了发展。

我不同意这一点。如果您不熟悉功能，开发速度*会较慢，但是一旦达到一定的知识水平，这并不是主要因素。*

听听他关于移动内容的备份和恢复方法。如果您这样做，您在开发过程中可能创建的内容类型、字段和网站中的所有混乱（对我来说总是相当多）将被转移到您的生产站点。

与其拥有一个一切都一致的漂亮干净的网站，您最终会遇到一些小错误，并且网站的某些区域由于旧的开发问题而与其他区域的行为不同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T19:53:30.970

我建议看一下 Chris O'Briens 最近的帖子，以及他出色的内容部署向导：[不仅仅是功能！](http://www.sharepointnutsandbolts.com/2008/09/sharepoint-dev-strategies-it-not-all.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T20:20:10.463

Maxim 的正确之处在于，大多数项目应该通过包装在解决方案（WSP 文件）中的特性来部署。您的策略应该是确保您的解决方案和程序集被分解为相关的功能。这也是有益的，因为可以在某些级别（例如站点和网站）上隔离功能。更新任何内容更新时应使用功能激活码、停用码和功能装订。内容部署也很有意义。

要记住的是，如果仅在代码中进行更新，则可以更新程序集，而无需重新激活该功能或收回并重新部署解决方案。所需要的只是要重置的应用程序池。

微软有几篇关于开发环境的文章，你可以在谷歌上搜索许多推荐环境的人。我们在虚拟机上进行开发，并将大多数项目部署到虚拟集成服务器。一旦我们对它进行烟雾测试，我们就会将我们的解决方案部署到 QA 等等。好处是功能和解决方案很容易收回。一旦投入生产，就应该对其进行彻底的测试。

在 SharePoint 中开发有它的问题，这是不言而喻的，但**到目前为止**，我发现好处超过了问题。

[Microsoft Office SharePoint Server 2007 中基于团队的开发](http://msdn.microsoft.com/en-us/library/bb428899.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-06T18:14:36.253

我们开发了一个自定义解决方案，可以更新网站集的内容类型和字段。在幕后，通过代码，SharePoint 允许我们修改字段以及字段和站点/列表内容类型中的值。

为了将实际内容从 QA 转移到 Prod，我们使用 Echo

# sql-server - 从存储过程中调用存储过程并返回记录集

> ID：230449
> 
> 赞同：2
> 
> 时间：2008-10-23T16:36:18.183
> 
> 标签：sql-server, tsql

我有一个回滚一系列操作的存储过程。我想从另一个 SP 中调用它。

问题是内部 SP 返回一个记录集，其中包含一个表示成功程度的值。

这种方法效果很好，并且在我们的上下文中具有一些优势，但回想起来，我会以传统方式使用返回值或输出参数来完成它。

我总是*可以*更改此 SP 以使用这种方法并修改调用代码，但是 a）我不想涉足任何我必须做的代码，并且 b）在知识层面，我很想知道什么如果有的话，可能有替代解决方案。

我如何（如果有的话）调用这个 SP 并确定返回的单例记录集的值？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-23T16:40:15.290

存储过程像任何其他存储过程一样返回记录集，因此您实际上可以这样做：

插入 MyTable ( MyValue )

执行 dbo.MyStoredProcedure

EXEC 代替了 SELECT 语句。要获取该值，只需从您插入的表中选择。通常，这将是一个临时表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T16:46:43.717

另一种选择是将返回记录集的存储过程转换为返回表的函数。

如果您想尽量减少对系统的更改，Ant 的方法可能是最好的。

通常，您会为该方法使用临时表，因为您不能使用 exec 语句插入表变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T18:17:33.970

如果您需要将其用于 MULTIPLE 记录集，这是一个很好的变体。

```
CREATE TABLE #outsidetable (...)
exec spInsideProcedure
SELECT * FROM #outsidetable 
```

在 spInsideProcedure 里面

```
INSERT INTO #outsidetable SELECT <blah blah blah> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T09:54:42.440

我尝试了 Ant 的方法，它奏效了：

```
声明@Success tinyint
声明@Response 表（Success int）
插入@Response（成功）
Exec Fix_RollbackReturn 12345, 15
从@Response 中选择@Success=Success

```

如您所见，我使用了表变量而不是临时表，因为它比临时表更有效。

感谢您的所有帮助。

编辑：看来戴夫毕竟是对的。也就是说，我的 Exec-into-Table-variable 方法在我的 SQL2005 开发机器上工作，但是当移动到 Live (SQL2000) 机器时它反对，所以我不得不更改为临时表方法。

这有点烦人，特别是因为在几周内我们将全面升级到 SQL2005（！）。

# c# - 如何从用户输入 C# 填充数组？

> ID：230454
> 
> 赞同：17
> 
> 时间：2008-10-23T16:37:23.503
> 
> 标签：c#

从用户输入填充数组的最佳方法是什么？

解决方案是否会显示提示消息，然后从用户那里获取值？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-23T16:39:22.547

```
string []answer = new string[10];
for(int i = 0;i<answer.length;i++)
{
    answer[i]= Console.ReadLine();
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-23T17:14:21.400

你能稍微澄清一下这个问题吗？您是否试图从用户那里获得固定数量的答案？您期望什么数据类型——文本、整数、浮点十进制数？这有很大的不同。

例如，如果您想要一个整数数组，您可以要求用户输入它们，用空格或逗号分隔，然后使用

```
string foo = Console.ReadLine();
string[] tokens = foo.Split(",");
List<int> nums = new List<int>();
int oneNum;
foreach(string s in tokens)
{
    if(Int32.TryParse(s, out oneNum))
        nums.Add(oneNum);
} 
```

当然，您不一定需要额外的转换为整数的步骤，但我认为这可能有助于展示您的做法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-23T19:51:55.340

[将其添加为arin 代码](https://stackoverflow.com/questions/230454/how-to-fill-an-array-from-user-input-c#231047)的答案比在评论中继续这样做更有意义......

1）考虑使用十进制而不是双精度。它更有可能给出用户期望的答案。请参阅[http://pobox.com/~skeet/csharp/floatingpoint.html](http://pobox.com/~skeet/csharp/floatingpoint.html)和[http://pobox.com/~skeet/csharp/decimal.html](http://pobox.com/~skeet/csharp/decimal.html)了解原因。基本上十进制比双精度更接近人类对数字的看法。Double 的工作方式更像是计算机“自然”地思考数字的方式，这就是它更快的原因——但这在这里无关紧要。

2) 对于用户输入，通常值得使用一种不会在错误输入时引发异常的方法——例如decimal.TryParse 和int.TryParse。这些返回一个布尔值来说明解析是否成功，并使用一个`out`参数来给出结果。如果您还没有开始学习`out`参数，那么目前可能值得忽略这一点。

3）这只是一点点，但我认为在所有“for”/“if”（etc）主体周围都有大括号是明智的，所以我会改变这个：

```
for (int counter = 0; counter < 6; counter++)
    Console.WriteLine("{0,5}{1,8}", counter, array[counter]); 
```

对此：

```
for (int counter = 0; counter < 6; counter++)
{
    Console.WriteLine("{0,5}{1,8}", counter, array[counter]);
} 
```

它使块更清晰，并且意味着您不会意外编写：

```
for (int counter = 0; counter < 6; counter++)
    Console.WriteLine("{0,5}{1,8}", counter, array[counter]);
    Console.WriteLine("----"); // This isn't part of the for loop! 
```

4）您的 switch 语句没有`default`大小写 - 因此，如果用户键入“yes”或“no”以外的任何内容，它将忽略它们并退出。你可能想要这样的东西：

```
bool keepGoing = true;
while (keepGoing)
{
    switch (answer)
    {
        case "yes":
            Console.WriteLine("===============================================");
            Console.WriteLine("please enter the array index you wish to get the value of it");
            int index = Convert.ToInt32(Console.ReadLine());
            Console.WriteLine("===============================================");
            Console.WriteLine("The Value of the selected index is:");
            Console.WriteLine(array[index]);
            keepGoing = false;
            break;

        case "no":
            Console.WriteLine("===============================================");
            Console.WriteLine("HAVE A NICE DAY SIR");
            keepGoing = false;
            break;

        default:
            Console.WriteLine("Sorry, I didn't understand that. Please enter yes or no");
            break;
    }
} 
```

5）当您开始学习 LINQ 时，您可能希望回到这一点并替换您的 for 循环，该循环将输入求和为：

```
// Or decimal, of course, if you've made the earlier selected change
double sum = input.Sum(); 
```

同样，这是相当先进的 - 现在不要担心！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T16:45:49.833

C# 没有用于收集输入的消息框，但您可以改用 Visual Basic 输入框。

如果添加对“Microsoft Visual Basic .NET Runtime”的引用，然后插入：

```
using Microsoft.VisualBasic; 
```

您可以执行以下操作：

```
List<string> responses = new List<string>();
string response = "";

while(!(response = Interaction.InputBox("Please enter your information",
                                        "Window Title",
                                        "Default Text",
                                        xPosition,
                                        yPosition)).equals(""))
{
   responses.Add(response);
}

responses.ToArray(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-23T18:07:09.513

尝试：

```
array[i] = Convert.ToDouble(Console.Readline()); 
```

您可能还想使用 double.TryParse() 来确保用户没有输入虚假文本并以某种方式进行处理。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-23T19:12:53.313

# 我已经完成了，最后检查一下，如果有更好的方法告诉我

```
 static void Main()
    {
        double[] array = new double[6];
        Console.WriteLine("Please Sir Enter 6 Floating numbers");
        for (int i = 0; i < 6; i++)
        {
            array[i] = Convert.ToDouble(Console.ReadLine());
        }

        double sum = 0;

        foreach (double d in array)
        {
            sum += d;
        }
        double average = sum / 6;
        Console.WriteLine("===============================================");
        Console.WriteLine("The Values you've entered are");
        Console.WriteLine("{0}{1,8}", "index", "value");
        for (int counter = 0; counter < 6; counter++)
            Console.WriteLine("{0,5}{1,8}", counter, array[counter]);
        Console.WriteLine("===============================================");
        Console.WriteLine("The average is ;");
        Console.WriteLine(average);
        Console.WriteLine("===============================================");
        Console.WriteLine("would you like to search for a certain elemnt ? (enter yes or no)");
        string answer = Console.ReadLine();
        switch (answer)
        {
            case "yes":
                Console.WriteLine("===============================================");
                Console.WriteLine("please enter the array index you wish to get the value of it");
                int index = Convert.ToInt32(Console.ReadLine());
                Console.WriteLine("===============================================");
                Console.WriteLine("The Value of the selected index is:");
                Console.WriteLine(array[index]);
                break;

            case "no":
                Console.WriteLine("===============================================");
                Console.WriteLine("HAVE A NICE DAY SIR");
                break;
        }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T17:21:53.537

将输入值添加到 List 中，完成后使用 List.ToArray() 获取包含这些值的数组。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T12:09:21.710

当然....Console.ReadLine 总是返回字符串....所以你必须将类型字符串转换为双精度

数组[i]=double.Parse(Console.ReadLine());

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-07T19:22:39.730

readline 用于字符串.. 只需使用 read

# actionscript - 通过动作脚本中的鼠标悬停位置滚动 ScrollPane 的最佳方法？

> ID：230461
> 
> 赞同：0
> 
> 时间：2008-10-23T16:38:23.483
> 
> 标签：actionscript, mouseover, scrollpane

当鼠标接近滚动窗格的顶部边缘时，它会向上滚动直到到达顶部，只有当鼠标离开顶部边缘区域时才会中断。

底边也一样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T17:00:37.387

您需要制作一个可以在其上编写 AS 代码的符号，该符号是不可见的（将 alpha 设置为 0），并且位于您希望发生所需行为的区域中。

确保它是一个按钮符号

在隐藏符号的鼠标悬停上，您告诉窗格滚动。在隐藏符号的鼠标悬停上，您告诉窗格停止滚动。

将隐藏符号放在比滚动窗格更高的层上。

# regex - 正则表达式工具（如 RegexBuddy）是个好主意吗？

> ID：230467
> 
> 赞同：11
> 
> 时间：2008-10-23T16:40:03.450
> 
> 标签：regex

我的一位开发人员已经开始使用 RegexBuddy 来帮助解释遗留代码，这是我完全理解和支持的用法。我担心的是使用正则表达式工具来编写新代码。实际上，我不鼓励在我的团队中将其用于新代码。想到两句：

> **有些人在遇到问题时会想“我知道，我会使用正则表达式”。现在他们有两个问题。**- 杰米扎温斯基

和：

> **首先，调试的难度是编写代码的两倍。因此，如果您尽可能巧妙地编写代码，那么根据定义，您还不够聪明，无法对其进行调试。**- 布赖恩·克尼汉

我的担忧是（分别：）

*   该工具可以使用真正不需要的复杂正则表达式来解决问题。（另见[这个问题](https://stackoverflow.com/questions/230304/under-what-situations-are-regular-expressions-really-the-best-way-to-solve-the)）。

*   我的一位开发人员使用正则表达式工具将开始编写正则表达式（即使带有注释），任何没有（并且知道如何使用）正则表达式工具的人都无法维护。

我应该鼓励还是不鼓励使用正则表达式工具，特别是在生成新代码方面？我的担忧是否合理？还是我偏执？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-23T16:42:31.137

糟糕的编程很少是工具的错误。这是开发人员不了解该工具的错。对我来说，这就像说木匠不应该拥有螺丝刀，因为他可能会在更适合钉子的地方使用螺丝。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-23T17:43:50.483

正则表达式只是您可用的众多工具之一。我一般不同意经常被引用的 Zawinski 名言，就像任何技术或技巧一样，应用它们的方式有好有坏。

就个人而言，我将 RegexBuddy 和免费的[Regex Coach](http://www.weitz.de/regex-coach/)之类的东西主要视为学习工具。有时它们可​​以帮助调试或理解现有的正则表达式，但一般来说，如果您使用工具编写了正则表达式，那么维护它将非常困难。

作为一名 Perl 程序员，我对正则表达式的好坏都非常熟悉，并且多年来一直在生产代码中成功使用复杂的正则表达式。以下是我从不同地方收集到的一些我喜欢坚持的准则：

*   **当字符串匹配时不要使用正则表达式。**我经常看到人们使用正则表达式来匹配字符串不区分大小写的代码。只需将字符串小写或大写并执行标准字符串比较。
*   **不要使用正则表达式来查看字符串是否是几个可能值之一。**这不必要地难以维护。而是将可能的值放在一个数组中，散列（无论您的语言提供什么）并针对这些值测试字符串。
*   **写测试！**拥有一组专门针对您的正则表达式的测试可以大大简化开发，特别是如果它是一个模糊复杂的测试。另外，一些测试通常可以回答维护程序员可能对您的正则表达式提出的许多问题。
*   **用较小的部分构建您的正则表达式。**如果你真的需要一个大而复杂的正则表达式，那就用更小的、可测试的部分来构建它。这不仅使开发更容易（因为您可以单独获得每个较小的部分），而且还使代码更具可读性、灵活性并允许进行彻底的注释。
*   **将您的正则表达式构建到专用的子例程/函数/方法中。***这使得为​​正则表达式（并且只有*正则表达式）编写测试变得非常容易。它还使使用正则表达式的代码更易于阅读（一个命名良好的函数调用比一个随机标点符号块要可怕得多！）。将巨大的正则表达式放到代码块的中间（它们不能轻易地单独测试）是非常常见的，而且通常很容易避免。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-23T16:43:59.697

您应该鼓励使用使您的开发人员更有效率的工具。话虽如此，重要的是要确保他们使用*正确*的工具来完成这项工作。您需要教育所有团队成员何时适合使用正则表达式，以及何时`(less|more)`需要强大的方法。最后，任何正则表达式（恕我直言）都应该彻底注释，以确保下一代开发人员可以维护它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-23T16:50:17.173

我不确定为什么对正则表达式有这么大的差异。

是的，它们可能会变得混乱和晦涩，就像某人可能编写的任何其他代码一样，但它们比代码具有优势：它们以正式指定的方式表示人们感兴趣的字符串集（至少通过您的语言，如果有是扩展）。了解一段代码接受哪一组字符串将需要对代码进行“逆向工程”。

当然，您可以像递归和 goto 一样反对使用正则表达式，但只有在有一个好的替代方案时，这对我来说才是合理的。

我宁愿维护单行正则表达式代码，也不愿尝试捕获一组字符串的复杂手工函数。

关于使用工具来理解正则表达式（或编写新的），我认为这很好！如果有人用工具写了它，其他人可以用工具理解它！实际上，如果您对此感到担心，我会看到 RegexBuddy 之类的工具是您最好的保证，即代码不会因为正则表达式而无法维护

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T16:46:12.907

正则表达式测试工具非常宝贵。我一直在使用它们。我的工作甚至不是特别繁重的正则表达式，所以在我建立知识库时有一个程序来指导我了解细微差别是至关重要的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T16:53:30.490

正则表达式是解决许多文本处理问题的好工具。如果你的团队中有一个人正在编写团队其他人不理解的正则表达式，为什么不让他们教你其他人他们是如何工作的呢？您可能会将其视为机会，而不是威胁。这样，您就不必感到未知的威胁，并且您的武器库中将拥有另一个非常有价值的工具。

Zawinski 的评论虽然很有趣，但从根本上说是无知的表现，编写正则表达式并不是编码的全部，所以我不会担心那些引用。无论如何，没有人将整个论点变成一个单行字。

如果您遇到一个即使带有注释也太复杂而无法理解的正则表达式，那么正则表达式可能不是解决该特定问题的好方法，但这并不意味着它们没有用处。我敢打赌，如果您故意避免使用它们，那么您的代码库中就会有很多行代码，而一个简单的正则表达式也可以完成同样的工作。

Regexbuddy 是一个有用的快捷方式，可以确保您编写的正则表达式符合您的预期 - 它确实让生活更轻松，但对于我来说，您的问题似乎很重要，这就是使用它们的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-23T17:12:00.203

正如其他人所说，我认为使用或不使用这样的工具是一个中立的问题。更重要的是：如果正则表达式复杂到需要内联注释，那就太复杂了。我从不评论我的正则表达式。我通过将其分解为多个匹配步骤来处理大型或复杂的匹配问题，或者使用多个匹配语句 (=~)，或者通过使用子正则表达式构建正则表达式。

说了这么多，我认为任何称职的开发人员都应该相当精通正则表达式的编写和阅读。多年来，我一直在使用正则表达式，从未遇到过需要编写或阅读非常复杂的正则表达式的情况。但是一个中等大小的可能是进行验证或匹配的最优雅和简洁的方式，并且不应该仅仅因为没有经验的开发人员可能无法阅读正则表达式而回避它 - 更好地教育那个开发人员。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T17:30:51.537

您*应该*做的是让您的其他开发人员与 RB 挂钩。

不要担心整个“2 probs”引用；似乎这可能是对 Perl（早在 1997 年说）而不是正则表达式的爆炸。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T17:14:00.260

我不喜欢使用正则表达式工具。如果我不能手写，那么这意味着该工具的输出是我不理解的，因此无法维护。我宁愿花时间阅读一些正则表达式功能，也不愿学习正则表达式工具。我不理解许多程序员的态度，即正则表达式是一种需要避免/隔离的黑魔法。它只是另一种需要学习的编程语言。

完全有可能一个正则表达式工具可以为我节省一些时间来实现我知道的正则表达式功能，但我对此表示怀疑......我可以打字很快，如果你很好地理解语法（使用正则表达式的文本编辑器是惯用的帮助——我使用 gVim），大多数正则表达式真的没有那么复杂。我认为通过更好地学习技术而不是学习拐杖几乎总是能更好地为您服务，除非该工具是您可以输入简单信息并获得大量样板代码的工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-24T02:46:52.523

好吧，听起来解决这个问题的方法是让一些聪明的人引入一个正则表达式工具，该工具在匹配时对其进行注释。这表明*使用*工具并不像工具所理解的内容与程序员所理解的内容之间是否存在很大差距那样重要。

因此，文档可以提供帮助。

这是一个真正的微不足道的例子是如下表（只是一个建议）

```
Expression        Match     Reason
^                 Pos 0     Start of input
\s+               "      "  At least one space
(abs|floor|ceil)  ceil      One of "abs", "floor", or "ceil"
... 
```

不过，我看到了这个问题。您可能希望阻止人们构建比他们无法解析的更复杂的正则表达式。我认为标准可以通过始终要求扩展的 RE 并检查注释是否正确来解决这个问题。

但是，如果他们只是想调试 RE，以确保它按照他们认为的那样运行，那么它与编写必须调试的代码并没有太大区别。

是相对的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-08-05T21:10:58.620

我制作的（用于其他一些项目）的几个正则表达式工具（用于**Node/JS**、**PHP**和**Python**）可在线玩和试验。

[正则表达式分析器](http://foo123.github.io/examples/regex-analyzer/)和[正则表达式作曲家](http://foo123.github.io/examples/regex-composer/)

[github 仓库](https://github.com/foo123/RegexAnalyzer)

# java - 通过在服务器上使用 java 程序来限制来自 java 客户端的 postges 访问

> ID：230478
> 
> 赞同：1
> 
> 时间：2008-10-23T16:42:25.160
> 
> 标签：java, postgresql, transactions

也许这个问题不是很清楚，但我没有找到更好的标题，它描述了我想很快处理的问题。

我想限制从 java 桌面应用程序对 postgres 的访问。

**的背景：**

假设您有 2 个应用程序正在运行，第一个应用程序必须根据数据库中的数据进行一些复杂的计算。为了确定数据库中数据的不变性，我想锁定数据库以进行插入、更新和删除操作。在客户端，我认为不可能令人满意地处理这种行为。所以我想在服务器端使用一个像代理一样工作的小 java-app。所以任务是交出CRUD（创建读更新删除）操作，直到它得到一个锁定命令。在锁定之后，它会拒绝所有 CUD 操作，直到它从锁定客户端获得解锁命令或达到超时。

**问题：**

您如何看待这种方法？

使用这种方法时是否可以锁定数据库？

您更喜欢 Java SE 还是 Java EE 作为服务器端 Java 应用程序？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T16:50:47.110

为什么不在您的操作中使用[事务](http://www.postgresql.org/docs/8.3/static/mvcc.html)？数据库本身具有维护数据完整性的功能，而不是求助于诸如数据库总锁定之类的粗暴操作。

您描述的这种锁定机制听起来对用户来说是一种痛苦。是用户启动锁定还是软件本身？如果是用户，当 Bob 锁定然后去吃午饭 2 小时，忘记先解锁数据库时，您可能会遇到一些问题......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T19:26:58.713

确实......有一些适当的方法可以解决这个问题。

1.  只需锁定代码中的表格。Postgresql 具有用于锁定整个表的命令，您可以从客户端应用程序运行这些命令
2.  选择一个事务隔离级别，该级别不存在读取 txn 启动后提交的数据的问题（BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ）。

其中，到目前为止，最有效的是使用可重复读取作为隔离级别。Postgres 非常有效地支持这一点，它将为您提供一致的数据视图，而无需对数据库进行如此重的锁定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T08:59:57.730

那一年我考虑过交易，但在这种情况下我不能使用它们。对不起，我没有准确地提到它。所以假设以下简单的情况：计算关闭了一个责任范围。在 calc 之后打开一个新的，并专门为它插入新的插入。但是，在计算过程中，不允许对（当前计算的）责任区域的数据进行插入、更新或删除。由于必须存档数据，因此严格禁止删除更多内容。

所以imo使用事务不符合这个要求。还是我错过了什么？

ps：（题外话）@jsight：我目前读到，postgres 将“可重复读取”映射到“可序列化”，因此使用“可重复读取”会给您带来比您可能期望的更多限制。

# iphone - 如何创建一个简单的两屏 iPhone 应用程序？

> ID：230507
> 
> 赞同：1
> 
> 时间：2008-10-23T16:52:58.243
> 
> 标签：iphone, cocoa-touch

我已经浏览了大部分示例代码，但我仍然需要一些帮助。我想做一个超级简单的应用程序：在启动时显示一个带有标签和按钮的屏幕。单击按钮，我们滑到另一个屏幕（我想这些称为视图），它有另一个标签和顶部菜单栏中的“后退”按钮。我只想在两个屏幕之间来回点击。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T17:02:25.027

查看 Apple 开发人员网站上的 NavBar 示例。[http://developer.apple.com/iphone/library/samplecode/NavBar/index.html](http://developer.apple.com/iphone/library/samplecode/NavBar/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T17:00:20.740

您需要使用 UINavigationController 来完成您正在谈论的“滑动”/“后退按钮”行为。只要应用程序设置正确，它就像您想象的那样简单。从本质上讲，UINavigationControllers 允许您推送和弹出 UIViewController 或其子类的实例，并为您处理动画和视图历史跟踪。

到目前为止，最好的入门方式就是打开 XCode，选择“New Project”，然后从“Navigation-Based Application”开始。围绕那个项目研究一段时间，我想你会开始清楚地看到需要做什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T17:39:16.347

您可以使用本教程查看如何开始使用它：[at wattz.net](http://www.wattz.net/article/creating_a_simple_view_transitions_app/)

# regex - 什么时候问题对于正则表达式来说太复杂了？

> ID：230517
> 
> 赞同：20
> 
> 时间：2008-10-23T16:55:55.290
> 
> 标签：regex

请不要回答显而易见的问题，但有哪些限制标志告诉我们不应该使用正则表达式解决问题？

例如：为什么完整的电子邮件验证对于正则表达式来说过于复杂？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-23T17:03:40.657

正则表达式是[有限状态自动机](http://en.wikipedia.org/wiki/Finite_state_automata)的文本表示。也就是说，它们仅限于非递归匹配。这意味着您的正则表达式中不能有任何“范围”或“子匹配”的概念。考虑以下问题：

```
(())() 
```

所有的开括号都与闭括号匹配吗？

显然，当我们将其视为人类时，我们很容易看出答案是“是”。但是，没有正则表达式能够可靠地回答这个问题。为了进行这种处理，您将需要一个完整的[下推自动机](http://en.wikipedia.org/wiki/Pushdown_automaton)（如带有堆栈的 DFA）。这最常见于解析器的伪装，例如由 ANTLR 或 Bison 生成的解析器。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-24T06:10:57.930

需要注意的几点：

1.  开始和结束标签检测——匹配配对
2.  递归
3.  需要倒退（虽然你可以反转字符串，但这是一个黑客）

正则表达式，尽管我很喜欢它们，但并不擅长这三件事。请记住，**保持简单！**如果您正在尝试构建一个执行“一切”的正则表达式，那么[您可能做错了](http://www.codinghorror.com/blog/archives/001016.html)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-23T17:01:46.200

当您需要解析不是由[常规语言](http://en.wikipedia.org/wiki/Regular_language)定义的表达式时。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-23T17:13:48.157

它归结为使用常识。如果您尝试匹配的内容变成了一个难以管理的怪物正则表达式，那么您要么需要将其分解为小的、符合逻辑的子正则表达式，要么您需要开始重新考虑您的解决方案。

以电子邮件地址（根据您的示例）。这个简单的正则表达式（取自 RegEx buddy）匹配 99% 的所有电子邮件：

```
\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b 
```

它简短而中肯，您很少会遇到问题。但是，正如 RegEx buddy 的作者所指出的，如果您的电子邮件地址位于罕见的顶级域“.museum”中，则不会被接受。

要真正匹配所有电子邮件地址，您需要遵守称为[RFC 2822](https://www.rfc-editor.org/rfc/rfc2822#section-3.4.1)的标准。它概述了电子邮件地址格式化的多种方式，而且非常复杂。

这是一个尝试遵守 RFC 2822 的示例正则表达式：

> ```
> (?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"
> (?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x
> 0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]
> (?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)
> {3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08
> \x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]) 
> ```

这显然变成了收益递减问题。最好使用匹配 99% 的电子邮件地址的易于维护的实现，而不是接受 99.9% 的电子邮件地址。

正则表达式是您的程序员工具箱中的一个很好的工具，但它们并不是您所有解析问题的解决方案。如果您发现您的 RegEx 解决方案开始变得非常复杂，您需要尝试在逻辑上将其分解为更小的正则表达式以匹配您的文本部分，或者您需要开始寻找其他方法来解决您的问题。同样，由于其性质，正则表达式无法解决一些简单的问题（正如一位海报所说，不遵守[正则语言](http://en.wikipedia.org/wiki/Regular_language)）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-20T07:29:53.983

正则表达式适用于标记、查找或识别文本的各个位，例如在源代码中查找关键字、字符串、注释等。

正则表达式不适合确定多位文本之间的关系，例如查找带有正确配对的大括号的源代码块。你需要一个解析器。解析器可以使用正则表达式来标记输入，而解析器本身确定不同的正则表达式匹配如何组合在一起。

本质上，如果您开始考虑“平衡组”（.NET 的捕获组减法功能）或“递归”（Perl 5.10 和 PCRE），那么您的正则表达式就会走得更远。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-23T17:01:57.277

这是 Raymond Chen 的一句名言：

> 不要让正则表达式做他们不擅长的事情。如果你想匹配一个简单的模式，那就匹配一个简单的模式。如果你想做数学，那就做数学。正如评论者 Maurits 所说，“诀窍不是花时间开发组合锤子/螺丝刀，而只是使用锤子和螺丝刀。

[来源](http://blogs.msdn.com/oldnewthing/archive/2006/05/22/603788.aspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-23T17:01:03.533

用正则表达式解决问题，然后把它交给其他熟悉正则表达式的人。如果他们不能在大约 10 分钟内告诉你它的作用（或者至少可以自信地说他们理解），那就太复杂了。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-23T17:02:18.523

停止使用正则表达式的肯定标志是：如果您有许多分组大括号 '()' 和许多替代方案 '|' 那么这是一个确定的信号，表明您尝试使用正则表达式进行（复杂）**解析。**

再加上 Perl 扩展、反向引用等，很快你就拥有了一个难以阅读、难以修改和难以推理其属性的解析器（例如，是否有一个输入，该解析器将在指数时间内工作）。

这是停止正则表达式并开始解析（使用手工解析器、解析器生成器或解析器组合器）的时候。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-23T17:03:11.953

除了大量的表达式外，单词也存在主要限制，可以通过正则表达式处理。例如，你不能不为 n chars a，然后 n chars b 描述的单词编写正则表达式，其中 n 可以是任何，更严格地说![替代文字](https://upload.wikimedia.org/math/9/a/4/9a46036f719dfff25a0b03818ccef3d4.png)。

在不同的语言中，正则表达式是[正则语言](http://en.wikipedia.org/wiki/Regular_language)的扩展，但解析时间可能非常大，并且此代码不可移植。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-23T17:04:10.500

每当您无法确定它是否真的解决了问题时，例如：

*   HTML解析
*   电子邮件验证
*   语言解析器

尤其是当已经存在以完全可以理解的方式解决问题的工具时。

正则表达式可以在我提到的领域中使用，但只能作为整个问题的一个子集和特定的简单案例。

这超出了正则表达式（常规语言 + 扩展）的技术限制，在大多数情况下，可维护性和可读性限制比技术限制要早得多。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-23T16:59:23.397

当问题的约束在编写解决方案后可能发生变化时，对于正则表达式来说问题太复杂了。因此，在您的示例中，当您无权访问目标邮件系统以验证电子邮件地址是否附加到有效用户时，如何确保电子邮件地址有效？你不能。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-23T16:58:28.233

我的限制是大约 30-50 个字符长的正则表达式模式（取决于固定文本的数量和正则表达式命令的数量）

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-10-23T17:12:42.713

这听起来可能很愚蠢，但我经常感叹无法使用正则表达式进行数据库类型的查询。现在尤其比以前更多，因为我一直在搜索引擎上输入这些类型的搜索字符串。它非常困难，如果不是不可能的话`+complex AND +"regular expression"`

例如，如何在 emacs 中搜索名称中同时包含 Buffer 和 Window 的命令？我需要单独搜索`.*Buffer.*Window and .*Window.*Buffer`

# jquery - JQuery 有条件地提交表单

> ID：230522
> 
> 赞同：0
> 
> 时间：2008-10-23T16:58:03.290
> 
> 标签：jquery

我有一个多行的表。每一行都是一个表格。我想使用 JQuery 提交所有选中复选框的表单。该表单发布到 IFrame，因此不需要 AJAX。

到目前为止，我有：

```
 $("form").submit(); 
```

提交表单。但所有形式。有任意行数，可以是80-100。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T17:04:40.373

在我的脑海中，你可能想要这样的东西

```
$("input:checked").parent("form").submit(); 
```

这将找到已检查的表单字段，向上遍历以找到父表单对象并提交。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T17:13:59.513

我不确定提交，因为我已经在 .post() 中完成了此操作，但这是我用来获取我想要在提交时发送的内容：

```
var formElements = $("form").find("input:checked").parent("td").serialize(); 
```

您应该能够发回该变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T17:02:08.553

这是一个猜测，因为我不确定你的布局，但这里是......

```
$("td > input:checked > form").submit(); 
```

# sql - 将项目价格相加以获得总计

> ID：230525
> 
> 赞同：1
> 
> 时间：2008-10-23T16:58:39.857
> 
> 标签：sql, ms-access, add

我已经开始创建一个数据库，并且我有一个“订购商品”和一个“发票”表。我想知道如何将客户挑选的商品的价格相加。以及您将这个“规则”放在数据库的什么位置。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T17:02:58.803

您需要 SQL“Sum()”函数。例如，看[这里](http://www.techonthenet.com/access/functions/numeric/sum.php)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T17:12:19.250

我必须做出很多假设（最大的假设是您使用的是 MS SQL），因为您的帖子缺乏细节，但我会尝试一下。如果此设置未关闭，请发布表格创建和一些示例数据供我们使用。这会对我们有很大帮助。

```
declare @Item table (ItemId int, ItemDesc varchar(50), Price money)
declare @Invoice table (InvoiceId int, CustomerName varchar(50), ShipDate datetime)
declare @OrderedItem table (InvoiceId int, ItemId int, Quantity int)

insert into @Item
    select 1, 'Hat', '10.99' union
    select 2, 'Shirt', '12.50' union
    select 3, 'Belt', '5.99'

insert into @Invoice
    select 1, 'Nathan', '01-01-2009'

insert into @OrderedItem
    select 1, 1, 2 union    -- 2 hats
    select 1, 2, 3          -- 3 shirts

select  i.InvoiceId,
        sum(Quantity) [TotalItems],
        sum(Price * Quantity) [TotalPrice]
from    @Invoice i
inner
join    @OrderedItem oi on
        i.InvoiceId = oi.InvoiceId
inner
join    @Item it on
        oi.ItemId = it.ItemId
group
by      i.InvoiceId 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T19:17:06.973

您会在每个 Access 版本附带的 Northwind 示例数据库中找到很多有用的示例，也可以[从此处下载](http://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&displaylang=EN)。我想你会找到订单、销售分析表和特定兴趣的发票报告。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T07:30:43.900

SQL 语言只有一种数据结构是表。因此，您可以将用户选择的商品放入一个表中，然后从该表连接到包含价格的表，然后使用集合函数 SUM() 获取总价格。听起来您对 SQL 语言不太熟悉，如果您确实在使用 MS Access，那么它有向导可以提供帮助：它将这种构造称为“总计查询”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T17:07:10.183

基本上，您将进行查询并使用该查询的结果填充发票表。正如 Coderer 所说，使用 sum() 函数。如果您使用图形查询编辑器，则需要启用总计（查看->总计），然后将总计类型设置为“Sum”而不是默认的“Group By”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T17:07:29.057

如果您使用的是 MS Access，则 SUM 函数通常用作显示字段之一的报告的一部分。

# ruby-on-rails - Mongrel::DirHandler 等效于乘客

> ID：230534
> 
> 赞同：3
> 
> 时间：2008-10-23T17:00:38.620
> 
> 标签：ruby-on-rails, ruby, apache, passenger, mongrel

我正在使用 Mongrel::DirHandler 来控制静态文件的响应头 - 这在我的开发机器上非常有用。我的生产机器使用Passenger，所以我的标题没有设置。使用Passenger时如何控制静态文件的标题？

我的 environment.rb 片段：

```
if defined? Mongrel::DirHandler
  module Mongrel
    class DirHandler
      def send_file_with_expires(req_path, request, response, header_only=false)

        if req_path =~ /((\/images)|javascripts|stylesheets)/
          response.header['Cache-Control'] = 'max-age=315360000'
          response.header['Expires'] = (Time.now + 10.years).rfc2822
        else
          response.header["Last-Modified"] = Time.now.httpdate
          response.header["Expires"] = 0
          # HTTP 1.0
          response.header["Pragma"] = 'no-cache'
          # HTTP 1.1 ‘pre-check=0, post-check=0′ (IE specific)
          response.header["Cache-Control"] = 'no-store, no-cache, must-revalidate, max-age=0, pre-check=0, post-check=0'
        end

        send_file_without_expires(req_path, request, response, header_only)
      end
      alias_method :send_file_without_expires, :send_file
      alias_method :send_file, :send_file_with_expires
    end
  end
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T17:11:04.993

由于您使用的是Passenger，我假设您使用的是apache，因此您的请求不再通过Mongrel。如果是这样，您可以在应用程序目录`.htaccess`内的文件上建立规则。`public`

[这是有关如何执行此操作的说明。](http://forum.powweb.com/showthread.php?t=70536)

# javadoc - 将 Javadoc 附加到 NetBeans 中的库

> ID：230552
> 
> 赞同：3
> 
> 时间：2008-10-23T17:05:24.787
> 
> 标签：javadoc, netbeans6.1

我是使用 NetBeans IDE 的新手。当我尝试查看说 java API（示例、`System`类）的文档时，它说没有安装 javadoc。如何安装文档？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T17:17:46.620

首先你下载javadoc。

其次转到 Tools-->Java Platforms 并从 Java Platform Manager 中选择 Javadoc 选项卡。单击添加 ZIP/文件夹。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T17:20:27.363

1.  右键单击项目
2.  选择属性
3.  选择“Java 源
4.  类路径”单击“管理 Java 平台...”
5.  单击项目正在使用的平台
6.  单击 Javadoc 选项卡
7.  单击“添加 ZIP/文件夹...”按钮
8.  选择您已下载到计算机的 Javadoc

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-07T21:57:54.597

对于网豆 7.0

1.  下载 javadoc
2.  右键项目
3.  特性
4.  图书馆
5.  管理平台
6.  添加邮编/文件夹

如果您希望添加特定的 libray api 文档（例如 JavaFX）

1.  图书馆
2.  编译选项卡 - 编辑
3.  浏览并提供 javadoc

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T17:07:48.993

不确定，但您可以在以下网址引用它：http: [//java.sun.com/javase/reference/api.jsp](http://java.sun.com/javase/reference/api.jsp)，直到有人能够回答您真正的问题！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-02T02:08:08.407

在 NetBeans 中右键单击您的项目，然后：

*   特性
*   图书馆

然后选择您添加的库并选择编辑，有一个窗口供您在那里添加您的 javadocs。您必须先添加 .jar 文件，否则我被告知您可以添加整个文件夹，它会为您添加 javadocs。我从来没有用这种方法运气。

# testing - 自动化测试是否仍称为冒烟测试？

> ID：230571
> 
> 赞同：3
> 
> 时间：2008-10-23T17:12:03.387
> 
> 标签：testing, smoke-testing

如果没有，是否仍在使用[烟雾测试？](http://en.wikipedia.org/wiki/Smoke_test#Smoke_testing_in_software_development)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-23T17:18:00.237

这有点像维恩图。一些自动化测试是冒烟测试，而一些冒烟测试是自动化的（因为它们是由计算机程序运行的）。烟雾测试（如果我没记错的话）是对“有烟的地方，通常会有火”这一术语的起飞（如果我没记错的话）。这是程序必须通过的一组初步测试，才能考虑进行“真实”（即火灾）测试。

冒烟测试可以是手动的，因为测试人员有一个他遵循的步骤列表，但这些不是通过计算机程序自动化的。

烟雾测试仍在使用——在我工作过的地方，它通常是自动化的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T17:26:51.140

自动化测试可以进行冒烟测试（浅的、宽的），但它也可以进行其他测试，如[回归测试](http://en.wikipedia.org/wiki/Regression_testing)和[单元测试](http://en.wikipedia.org/wiki/Unit_testing)。基本上自动化测试可以是任何可重复的测试。

是的，烟雾测试仍在使用中。我通常看到两种情况。首先是确定软件是否已准备好进行更深入的测试。第二个，也是 IMO 更常见的方法，是跳过不应该受到新版本更改影响的全面测试功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T17:20:19.907

我不认为烟雾测试通常是自动化的。根据我的经验，冒烟测试实际上只是一个基本的健全性测试，以确保后续测试可以实际运行，并且没有任何基本的东西像启动代码或菜单条目那样被破坏。这通常由人手动完成。我想它可以是自动化的，但通常它涉及添加新功能，因此自动化测试也必须更改，并且您仍然会遇到同样的问题，您需要一个人来验证自动化测试是否正确修改以正确测试新功能。相比之下，自动化测试（如单元测试）代表了一个回归测试套件，并被创建用于测试完善的功能，这些功能在不同版本之间应该不会有太大变化，当然您也可以添加单元测试来涵盖新功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T17:23:00.947

可能更多来自硬件背景的公司，其中烟雾测试是按字面意思进行的。很少有人这样称呼他们了。它通常只是一个较大的验收或系统测试套件的一个小而广泛的子集。这些 tet 是自动化的，并在代码提交之前或提交到源代码控制时自动针对代码运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-24T07:44:51.207

我不确定我们是否可以比较烟雾测试和自动化测试。冒烟测试是一种在构建上运行一组基本测试的方法，涵盖所有基本功能，但不深入任何内容。目的是确定构建是否可用于更详细的测试。它也是一组步骤，即使在开发人员构建中也可以快速运行，以确定是否存在由于即将在构建中进行的一些重大或核心更改而导致的任何问题。我们认为冒烟测试是我们的“测试计划”之一，但在每次构建时都会运行。

自动化测试并不特定于冒烟测试，但也可以应用在那里。这样做是为了“自动化”测试人员为了节省时间而经常执行的冗余或重复步骤。这是自动化的主要目的。它允许测试人员花更多时间进行其他测试。

它永远不能用真正的大脑代替测试，也不能一切都自动化。这是一项补充现有测试过程的活动，而不是取代它。

由于冒烟测试可能会在每个构建上运行，因此自动化它具有很好的价值。如果手动运行冒烟测试需要 4 小时，自动化之后需要 1 小时，那么您节省了 3 工时 * 构建次数。

市场上有几种自动化测试工具——AutoIT 和 SilkTest 等等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-23T17:30:38.480

简单来说，我们可以说冒烟测试可以自动化，但自动化测试并不总是冒烟测试。

是的，冒烟测试是测试任何应用程序/软件的流行方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T17:18:43.933

我对“冒烟测试”的理解与维基百科的文章不同。我理解冒烟测试是开发人员打开应用程序并测试基本功能以验证应用程序看起来正确并且正在做基础。所以我一直认为这是一个手动过程，而不是自动化过程。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-26T17:35:41.363

测试自动化套件包含各种级别，如冒烟测试、验收测试、夜间构建等。由测试人员决定每个级别需要运行哪个测试用例。每个测试用例都根据它们应该运行的级别进行编号。假设有 2 个自动化测试用例，分别用 1 和 2 编号表示级别，并且您在配置文件中将测试级别定义为 2，它只会运行第二个测试用例并给出结果。与验收测试相比，冒烟测试通常具有较少数量的测试用例。

冒烟测试可以自动化，但并非所有自动化测试都是冒烟测试。

# java - Javascript 类和 DWR

> ID：230573
> 
> 赞同：2
> 
> 时间：2008-10-23T17:12:20.623
> 
> 标签：java, javascript, ajax, dwr

我一直在使用 DWR 和转换器，我真的很想将我的 Java 类映射到 JavaScript 类。使用 DWR 转换器，我可以选择指出给定 Java 类的 JS 构造函数的名称。到目前为止一切顺利...当我的 JS 构造函数位于类似 JS 包的名称中时（就像 YUI 的包系统，例如`my.beautiful.package.MyClass`），问题就出现了。DWR 当前的实现不允许我使用这种构造，`SyntaxError`当我尝试使用它时给了我一个。有没有一种优雅的方式来解决这个限制？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T10:45:48.417

据我所知，这是不可能直接的。在我当前的工作项目中，我尝试使用 Javascript 类中的方法增强客户端的每个返回对象，这得到了我认为您感兴趣的结果。

```
DwrService.getThings({
  callback:function(things){
    for(thing in things){
      YAHOO.augmentProto(thing, my.beautiful.package.MyClass);
    }
    // do your stuff here
  }
}); 
```

我必须在周一（现在是周日）上班时检查 augmentProto 是否正确，但我认为它是正确的。甚至可能有一个更好的 DWR 挂钩，可以让您在运行中自动执行此操作。

# agile - 你觉得 Scrum Nokia Test 有用吗？

> ID：230582
> 
> 赞同：3
> 
> 时间：2008-10-23T17:14:10.793
> 
> 标签：agile, scrum

似乎 Scrum 和敏捷测试/断言在今年变得流行起来。例如，[诺基亚测试 Scrum](http://www.cedur.se/nokia_test2.html)。[我认为进行这样的测试根本不是一个好主意](http://www.targetprocess.com/blog/2008/10/are-we-agile-yet-grrrrr.html)。你怎么看？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T19:03:33.690

一方面，越来越多的人声称他们是敏捷的，所以这样的测试可以让我们整理出“我们在做 XP，我们不评论我们的代码”这一行。

但是我们如何才能确保人们会以正确的方式理解这个问题，而不是回答“嗯，我们有迭代。我们经常不得不稍微扩展它们来满足我们的承诺，但我们确实有四个星期的迭代。” ?

另一方面，您提供的链接很有趣，因为它不是初始版本，它得到了 Jeff Sutherland 的支持。

关键是：你不能用八个问题来概括一个开发方法。因此，恕我直言，如果在正确理解问题的情况下回答，则单独的测试很有趣。这对想要改进的团队很有帮助。对于通过此测试收集的结果，我不会说同样的话。

这篇 infoQ 文章以更好的方式说明了这一点：[简单的清单可以提供有用的快速评估。他们不会告诉你这些做法是否真的产生了效果。](http://www.infoq.com/news/2008/10/Nokia-Test-Value)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T17:46:59.463

我很快就参加了测试，发现这些问题对于任何声称正在做 Scrum 的人来说都是很好的问题。我还会问一些问题，例如：

*   你有一个自动化的构建过程吗？
*   它多久运行一次？
*   当构建中断时会发生什么？

OTOH，像这样的测试作为自我评估很有用，但我不会根据测试“评价”一个团队。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-24T11:04:33.420

我看到诺基亚测试可用于快速概览。

为了进一步调查，我建议使用**Henrik Kniberg 编写的更详细的 Scrum Checklist，**它有助于教练**和**Scrum Master 快速发现敏捷团队在大多数领域的差距。即使有 70 个问题，团队成员也会回答是/否。我们能够在 20 分钟内完成这项调查。特别是如果你在几个月后重复它，你可能会对你的团队的回答感到惊讶。

如果您需要对敏捷实现进行深入分析，我建议使用由**Mike Cohn创建的 C****比较敏捷**y 评估。它有助于**您的公司与行业的相对比较**。我们在对适应过程质量有直接影响的企业组织中使用它。多亏了这家企业公司的适应过程要好得多

 ****[在此处](http://www.scrumdesk.com/agile-adaption-gaps-identification/)查看有关 Scrum 清单和比较敏捷性的更多信息。

# c++ - C ++中的变量存储在哪里？

> ID：230584
> 
> 赞同：17
> 
> 时间：2008-10-23T17:14:55.597
> 
> 标签：c++, architecture, memory, computer-architecture

C ++中的变量存储在哪里？

在 RAM 或处理器的缓存内？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-23T17:22:29.060

命名变量被存储：

*   在堆栈上，如果它们是函数局部变量。
    C++ 称之为“自动存储” ¹并且并不要求它实际上是 asm 调用堆栈，在一些罕见的实现中它不是。但在主流实现中确实如此。
*   如果它们是全局的或`static`.
    C++ 称之为“静态存储类”；`section .data`它是在 asm 中通过在、`.bss`、`.rodata`或类似文件中放置/保留字节来实现的。

如果变量是用`int *p = new int[10];`或类似初始化的指针，则指针变量`p`将如上所述进入自动存储或静态存储。内存中*指向的*对象是：

*   在堆上（C++ 称为动态存储），使用`new`or`malloc`等​​进行分配。
    在 asm 中，这意味着调用分配器函数，如果空闲列表为空，则该函数最终可能通过某种系统调用从操作系统获取新内存。“堆”不是现代操作系统/C++ 实现中的单个连续区域。

C 和 C++ 不进行自动垃圾回收，命名变量本身不能在动态存储（“堆”）中。动态存储中的对象是匿名的，除了被其他对象指向之外，其中一些可能是适当的变量。（结构或类类型的对象，与 类似的原始类型相反`int`，可以让您引用此匿名对象中的命名类成员。在成员函数中，它们甚至看起来相同。）

这就是为什么您不能（安全/有用地）返回指针或对局部变量的引用。

* * *

**当然，这一切都在 RAM 中**。缓存对用户空间进程是透明的，尽管它可能会明显影响性能。

编译器可以优化代码以将变量存储在寄存器中。这是高度依赖编译器和代码的，但是好的编译器会积极地这样做。

* * *

脚注 1：有趣的事实：`auto`在 C++03 和更早版本中，仍然在 C 中，[表示自动存储类](https://en.cppreference.com/w/cpp/language/storage_duration)，但现在（C++11）它推断类型。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-23T17:48:56.477

一般来说，对于 C++，正确的答案是“无论你的编译器决定把它们放在哪里”。除非您以其他方式指示编译器，否则您不应做出假设。有些变量可以完全存储在寄存器中，有些可能会被完全优化掉并在某处被文字替换。对于某些平台上的某些编译器，常量实际上可能最终在 ROM 中。

您关于“处理器的缓存”的部分问题有点混乱。有一些工具可以指导处理器如何处理其缓存，但一般来说，这是处理器的事情，您应该不可见。您可以将缓存视为 CPU 进入 RAM 的窗口。几乎*所有*内存访问都通过缓存。

另一方面，在大多数操作系统上，未使用的 RAM 有时会被换出到磁盘上。所以它可能（但不太可能）在某些时候你的变量实际上存储在磁盘上。:-)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-23T17:34:21.280

变量通常存储在 RAM 中。这要么在堆上（例如全局变量、方法/函数中的静态变量），要么在堆栈上（例如在方法/函数中声明的非静态变量）。Stack 和 Heap 都是 RAM，只是位置不同。

指针有点特别。指针本身遵循上述规则，但它们指向的数据通常存储在堆上（使用 创建的内存块，使用创建的`malloc`对象`new`）。但是您可以创建指向堆栈内存的指针`int a = 10; int * b = &a;`：`b`指向的内存`a`并`a`存储在堆栈中。

进入 CPU 缓存的内容超出了编译器的控制范围，CPU 自行决定缓存什么以及缓存多长时间（取决于“*最近是否使用过此数据？* ”或“*是否可以预期使用该数据很快又了吗？* ”）当然，缓存的大小也有很大的影响。

编译器只能决定哪些数据进入 CPU 寄存器。通常，如果经常连续访问数据，则数据会保留在那里，因为寄存器访问速度比缓存快，而且比 RAM 快得多。某些系统上的某些操作实际上只有在数据在寄存器中时才能执行，在这种情况下，编译器必须在执行操作之前将数据移动到寄存器，并且只能决定何时将数据移回 RAM。

编译器将始终尝试将最常访问的数据保存在寄存器中。当一个方法/函数被调用时，通常所有的寄存器值都会被写回 RAM，除非编译器可以确定被调用的函数/方法不会访问数据来自的内存。同样在返回方法/函数时，它必须将所有寄存器数据写回 RAM，否则新值将丢失。返回值本身在某些 CPU 架构上的寄存器中传递，否则通过堆栈传递。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-23T18:25:58.120

C++ 不知道处理器的缓存。

当你运行一个用 C++ 或任何其他语言编写的程序时，你的 CPU 会在缓存中保存一份“流行”的 RAM 块的副本。这是在硬件级别完成的。

不要将 CPU 缓存视为“其他”或“更多”内存……它只是一种将一些 RAM 块保持在附近的机制。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-23T17:20:43.727

C++ 中的变量要么存储在堆栈上，要么存储在堆上。

堆：

```
int x; 
```

堆：

```
int *p = new int; 
```

话虽如此，两者都是内置在 RAM 中的结构。

如果您的 RAM 使用率很高，但 Windows 可以将其交换到磁盘。

当对变量进行计算时，内存将被复制到寄存器中。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-23T18:14:55.770

我认为你混淆了两个概念。一、C++语言如何在内存中存储变量。第二，计算机和操作系统如何管理该内存。

在 C++ 中，变量可以在堆栈上分配，堆栈是保留给程序使用的内存，并且在线程启动时大小固定，或者在动态内存中可以使用 new 动态分配。如果代码分析允许，编译器还可以选择将变量存储在处理器中的寄存器上。这些变量永远不会看到系统内存。

如果变量最终进入内存，操作系统和处理器芯片组就会接管。基于堆栈的地址和动态地址都是虚拟的。这意味着它们可能在任何给定时间都驻留在系统内存中，也可能不驻留在系统内存中。in memory 变量可以存储在系统内存中，分页到磁盘上，或者可以驻留在处理器上或处理器附近的高速缓存中。因此，很难知道这些数据实际存在于何处。如果一个程序有一段时间没有空闲，或者两个程序正在竞争内存资源，则可以将该值保存在页面文件中的磁盘中，并在程序轮到运行时恢复。如果变量对于正在完成的某些工作是本地的，则可以在处理器缓存中对其进行多次修改，然后最终将其刷新回系统内存。您编写的代码永远不会知道发生了这种情况。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-23T17:20:08.847

变量可以保存在许多不同的地方，有时甚至不止一个地方。加载程序时，大多数变量都放在 RAM 中；有时，声明的变量会`const`放在 ROM 中。每当访问一个变量时，如果它不在处理器的缓存中，就会导致缓存未命中，并且当变量从 RAM/ROM 复制到缓存中时，处理器将停止。

如果您有任何不错的优化编译器，则局部变量通常会存储在处理器的寄存器文件中。变量将在 RAM、缓存和寄存器文件之间来回移动，因为它们被读取和写入，但它们通常总是在 RAM/ROM 中有一个副本，除非编译器认为没有必要。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-01-17T14:38:04.020

C++ 语言通过 C++ 程序中的变量支持两种内存分配：

静态分配是在声明静态或全局变量时发生的。每个静态或全局变量定义一个固定大小的空间块。当您的程序启动（执行操作的一部分）时，空间被分配一次，并且永远不会被释放。当您声明一个自动变量（例如函数参数或局部变量）时，就会发生自动分配。自动变量的空间在输入包含声明的复合语句时分配，并在退出该复合语句时释放。自动存储的大小可以是变化的表达式。在其他 CPP 实现中，它必须是一个常数。第三种重要的内存分配，动态分配，不受 C++ 变量支持，但可用的库函数。动态内存分配

动态内存分配是一种技术，程序在运行时确定在哪里存储一些信息。当您需要的内存量或继续需要多长时间取决于程序运行之前未知的因素时，您需要动态分配。

例如，您可能需要一个块来存储从输入文件中读取的行；由于一行的长度没有限制，因此您必须动态分配内存，并在您阅读更多行时使其动态变大。

或者，您可能需要为输入数据中的每条记录或每个定义设置一个块；由于您无法提前知道会有多少，因此您必须在阅读时为每条记录或定义分配一个新块。

当您使用动态分配时，内存块的分配是程序明确请求的操作。当您想要分配空间时调用函数或宏，并使用参数指定大小。如果要释放空间，可以通过调用另一个函数或宏来实现。你可以随时随地做这些事情。

CPP 变量不支持动态分配；没有“动态”存储类，也永远不可能有一个 CPP 变量的值存储在动态分配的空间中。获得动态分配内存的唯一方法是通过系统调用，而引用动态分配空间的唯一方法是通过指针。因为不太方便，而且动态分配的实际过程需要更多的计算时间，程序员通常只在静态分配和自动分配都不起作用时才使用动态分配。

例如，如果要动态分配一些空间来保存 struct foobar，则不能声明其内容是动态分配的空间的 struct foobar 类型的变量。但是您可以声明一个指针类型的变量 struct foobar * 并为其分配空间地址。然后你可以在这个指针变量上使用运算符'*'和'->'来引用空间的内容：

```
 {
   struct foobar *ptr
      = (struct foobar *) malloc (sizeof (struct foobar));
   ptr->name = x;
   ptr->next = current_foobar;
   current_foobar = ptr;
 } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T17:21:07.347

根据它们的声明方式，它们将存储在“[堆](http://en.wikipedia.org/wiki/Heap_(data_structure))”或“[堆栈](http://en.wikipedia.org/wiki/Stack_(data_structure))”中

堆是应用程序可以使用的[动态数据结构。](http://en.wikipedia.org/wiki/Dynamic_memory_allocation)

当应用程序使用数据时，必须在它们被使用之前将其移动到 CPU 的寄存器中，但是这是非常易失的临时存储。

# java - HashSet 问题——equals 和 hashCode 与 contains 的工作方式与我预期的不同

> ID：230585
> 
> 赞同：3
> 
> 时间：2008-10-23T17:16:39.210
> 
> 标签：java, collections, jython, hashset

我有以下代码：

```
class IncidentTag:
     def __init__(self,tag):
        self.tag = tag
     def equals(self,obj):
        return self.tag.equals(obj.tag)
     def hashCode(self):
        return self.tag.hashCode()

from java.lang import String
from java.util import HashMap
from java.util import HashSet

tag1 = IncidentTag(String("email"))
tag1copy = IncidentTag(String("email"))
tag2 = IncidentTag(String("notemail"))

print tag1.equals(tag1copy)
print tag2.equals(tag2)

print "Now with HashSet:"

hSet = HashSet()
hSet.add(tag1)
hSet.add(tag2)

print hSet.contains(tag1)
print hSet.contains(tag2)
print hSet.contains(tag1copy) 
```

输出是：1 1 现在使用 HashSet：1 1 0

但是，我本来希望最后一行也是`true`（1）。有什么明显的东西我失踪了。

（是的，我知道我的`equals`方法和`hashcode`方法没有考虑到一些问题......它们故意简单，但如果有问题导致这个问题，请告诉我。）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-23T18:16:54.130

你不应该实现 Java 风格的 equals 和 hashCode 方法，而是 Python equivaltents`__eq__`和`__hash__`. 添加

```
def __hash__(self):
    return self.hashCode()
def __eq__(self, o):
    return self.equals(o) 
```

有帮助。据我所知，这些 python 方法是由 Jython 动态绑定到 hashCode 和 equals() 的。这确保您可以将 Python 类放入 Java 的集合中。

现在代码打印出五个“1”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T17:33:01.753

我用 Java 编写了等效的代码，它确实对所有三个 contains() 调用都产生了 true。所以我认为这在 Jython 中一定是个怪事。也许底层的 Java 对象并不完全是你在 Python 中看到的那样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T22:18:48.697

我不了解 Python，但它确实看起来底层 Java 对象的 equals() 和 hashcode() 没有遵守所需的合同。

*   两个对象 if equals() 必须返回相同的 hashcode()。

好像违反了。HashSets 首先将在查找中使用哈希码来获取匹配对象所在的列表，然后遍历列表以找到相等的对象。如果您的哈希码不遵守合同并且他们返回不同的哈希码，那么即使它们是 equals() 可比的，它也不会在哈希集中找到它。

默认的 Java Object.hashcode() 不会为 2 个对象返回相同的哈希码。你必须覆盖它。

# c# - 使用委托对列表进行排序问题

> ID：230588
> 
> 赞同：20
> 
> 时间：2008-10-23T17:17:55.870
> 
> 标签：c#, .net, closures

我正在尝试使用委托对列表进行排序，但出现签名匹配错误。编译器说我无法从“匿名方法”转换

```
List<MyType> myList = GetMyList();
myList.Sort( delegate (MyType t1, MyType t2) { return (t1.ID < t2.ID); } ); 
```

我错过了什么？

以下是我找到的一些参考资料，他们也是这样做的。

[开发者融合参考](http://www.developerfusion.com/code/5513/sorting-and-searching-using-c-lists/)

[微软参考](http://blogs.msdn.com/devdev/archive/2006/06/30/652802.aspx)

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-23T17:23:10.570

我想你想要：

```
myList.Sort( delegate (MyType t1, MyType t2) 
    { return (t1.ID.CompareTo(t2.ID)); } 
); 
```

要进行排序，您需要“真/假”以外的其他内容，您需要知道它是等于、大于还是小于。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-23T17:20:11.577

Sort 不采用二元谓词，它采用返回not a的`Comparison<T>`委托。`int``bool`

返回值`0`用于当项目相等时，`<0`当第一项小于第二项时，以及`>0`当第一项大于第二项时。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T18:18:00.570

将来，如果您想调试这样的问题，我建议从 Sort 调用中分离委托定义，如下所示：

```
Comparison<MyType> c = delegate(MyType t1, MyType t2){ ... };
myList.Sort(c); 
```

这样，您可以查看问题是在您的方法调用中，还是在您的委托定义中。有些人更喜欢这样保留它（显然，名称比“c”更具描述性）以使代码更具可读性。我可以接受或离开它=-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T19:49:26.813

obj.Sort(delegate(...)); 的方式 是在一个地方进行动态排序。如果您有多个地方进行相同的排序或者您需要更灵活的排序，您可以考虑创建一个实现 IComparer<T> 的类。这是一个例子：

```
public class MyTypeComparer : IComparer<MyType>
{
  public MyTypeComparer() // default comparer on ID
  { ... }

  public MyTypeComparer(bool desc) // default with order specified

  public MyTypeComparer(string sort, bool desc) // specified sort and order such as property name, true or false.
  { ... }

  public int Compare(MyType a, MyType b) // implement IComparer interface
  { ... } // this is real sorting codes
} 
```

这是使用它的示例：

```
List<MyType> myList = GetList();
myList.Sort(new MyTypeComparer());
// myList.Sort(new MyTypeComparer(false));
// myList.Sort(new MyTypeComparer("FirstName", true)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T18:04:07.697

确保您的 ID 属性是默认值数据类型，例如 Int 或 String。如果 ID 是对象引用类型，则该对象应实现 IComparer 或 IComparer。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T18:08:52.133

抱歉之前的帖子。编辑器不带 < 和 > 字符，我没有注意到编辑器正下方的预览。如果 ID 属性是对象类型，则该对象应实现 IComparer 或 IComparer<T>。

# php - 使用 PHP 进行 XPath 查询

> ID：230592
> 
> 赞同：18
> 
> 时间：2008-10-23T17:19:05.243
> 
> 标签：php, xml, xpath

这是我正在使用的 XML 代码：

```
<inventory>
    <drink>
        <lemonade supplier="mother" id="1">
            <price>$2.50</price>
            <amount>20</amount>
        </lemonade>
        <lemonade supplier="mike" id="4">
            <price>$3.00</price>
            <amount>20</amount>
        </lemonade>
        <pop supplier="store" id="2">
            <price>$1.50</price>
            <amount>10</amount>
        </pop>
    </drink>
</inventory> 
```

然后我写了一个简单的代码来练习使用 XPath：

```
<?php
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml');

    $xpathvar = new Domxpath($xmldoc);

    $queryResult = $xpathvar->query('//lemonade/price');
    foreach($queryResult as $result) {
        echo $result->textContent;
    }
?> 
```

该代码运行良好，可以按预期输出所有柠檬水的价格值。现在，当我更改查询字符串以仅选择属性设置为某个值的元素时，例如

> //柠檬水[供应商=“母亲”]/价格

或者

> //柠檬水[id="1"]/价格

它不起作用，根本没有输出。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-23T17:21:47.330

试试这个：

```
//lemonade[@id="1"]/price 
```

或者

```
//lemonade[@supplier="mother"]/price 
```

如果没有“@”，它会查找具有该名称而不是属性的子元素。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-11T12:33:32.453

这只是切线相关的，但是当您在知道其结构的文档上使用 XPath 时，*不要*使用“//some-element-name”。一个简单的示例非常好，但是当您使用该查询访问一个巨大的 xml 文件时，特别是如果它后面跟着一些复杂的东西，您将很快遇到性能问题。

库存/饮料/柠檬水[@supplier="mother"]/价格

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-23T17:23:10.493

您必须使用 @ 符号来指示谓词中的属性，如下所示：`//lemonade[@supplier="mother"]/price`，仅此而已。

# apache - 根据国家/地区重定向？

> ID：230594
> 
> 赞同：3
> 
> 时间：2008-10-23T17:19:24.993
> 
> 标签：apache, web-applications, geolocation, geotargetting

我们基本上有 2 个站点（Java /JSP / Apache Webserver）：something.ca & something.com

.ca 是加拿大内容，.com 是美国内容。

我们需要根据 IP 地址重定向用户。我们希望美国用户获得 .com 网站，而加拿大用户获得 .ca 网站。

最好的方法是什么（在网络服务器级别或其他级别）？

请详细说明。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T17:22:10.183

在我的网上冲浪体验中，大多数网站 - 例如 UPS.com - 要求用户选择他们的国家网站，而不是试图自己弄清楚。他们记得 cookie 中的选择。很大程度上取决于您的用例需要这种重定向的自愿程度。

在实现方面，我会使用一个过滤器来检查设置并在需要时触发重定向。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T18:04:48.833

我使用了 Maxmind 的 GeoIP，它运行良好。他们有一个[免费版本的 GeoCountry Lite](http://www.maxmind.com/app/geolitecity)，准确率为 99.3%。[Java API 就在这里](http://www.maxmind.com/app/java)，如果您进行重定向， 我将遵循谷歌的做法，将链接返回到原始版本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T17:23:22.520

查看地理方向。它可以通过javascript处理你想要的。

[http://www.geobytes.com/GeoDirection.htm](http://www.geobytes.com/GeoDirection.htm)

另一种选择是从浏览器环境设置中获取文化并将这些文化映射到应用程序中的国家/地区。根据您实际尝试执行的操作，这可能对您不起作用，因为这不会为您提供用户的实际位置，但会为您提供他们喜欢的文化。因此，如果加拿大人去美国旅行，除非他们出于某种原因更改了浏览器设置，否则他们仍然会访问加拿大网站。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T17:30:04.847

那里有很多[IP 地理定位 API](http://www.google.com/search?q=ip+location+lookup+api) - 我不知道那里是否有什么好东西不需要您付费：

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T17:59:46.627

使用文化设置是一种选择，但在某些情况下不起作用。如果您在美国有一个德国用户喜欢他的日期等以他喜欢的格式显示怎么办？改变不了他在美国的事实。

我认为这就是为什么大多数公司只是简单地询问用户然后将该信息存储在 cookie 中的原因之一（UPS、FedEx 和大多数主要航空公司都这样做）。查看 www.lufthansa.com。他们实际上要求提供位置和语言（以考虑到像瑞士这样拥有不止一种官方语言的国家）。

# build-process - 为每晚构建保存哪些工件？

> ID：230595
> 
> 赞同：5
> 
> 时间：2008-10-23T17:19:37.723
> 
> 标签：build-process, build-automation, nightly-build

假设我设置了一个[自动夜间构建](https://stackoverflow.com/questions/204603/nightly-builds-why-should-i-do-it)。我应该保存哪些构建工件？

例如：

*   输入源代码
*   输出二进制文件

另外，我应该保存它们多长时间，在哪里保存？

如果我进行持续集成，你的答案会改变吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-23T17:24:45.513

你不应该为了保存而保存任何东西。您应该保存它，因为您需要它（即，QA 使用每晚构建来测试）。在这一点上，“保存多长时间”变成了 QA 希望它们多长时间。

我不会像标记/标记它那样“保存”源代码。我不知道您使用的是什么源代码控制，但对于任何质量源代码控制系统来说，标记都是微不足道的（性能和磁盘空间）。一旦您的构建被标记，除非您需要二进制文件，否则将它们放在身边并没有任何好处，因为您可以在必要时从源代码重新编译。

大多数 CI 工具允许您标记每个成功的构建。这对于某些系统来说可能会成为问题，因为您每天可以轻松拥有 100 多个标签。对于这种情况，我建议仍然运行每晚构建并且只标记它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T14:15:08.080

以下是我用于在每次构建时保留的一些工件/信息：

*   **您正在构建的快照的标记名称（在构建之前**标记并进行干净的检查）
*   构建脚本本身或其版本号（如果您将它们视为具有自己的版本控制的单独项目）
*   构建脚本的输出：日志和最终产品
*   您的环境快照：
    *   编译器版本
    *   构建工具版本
    *   库和 dll/libs 版本
    *   数据库版本（客户端和服务器）
    *   IDE版本
    *   脚本解释器版本
    *   操作系统版本
    *   源代码控制版本（客户端和服务器）
    *   过程中使用的其他工具的版本以及**可能**影响构建产品内容的所有其他内容。我通常使用一个脚本来执行此操作，该脚本查询所有这些信息并将其记录到应该与其他构建工件一起存储的文本文件中。

问自己这个问题：“如果某些东西完全破坏了我的构建/开发环境，我需要什么信息来创建一个新环境，以便我可以重做我的构建 #6547 并最终得到与第一次完全相同的结果？”

你的答案是你应该在每次构建时保留的内容，它将是我已经提到的内容的子集或超集。

您可以将所有内容存储在 SCM 中（我建议使用单独的存储库），但在这种情况下，您应该将这些项目保留多长时间的问题失去意义。或者您应该将其存储到压缩文件夹或刻录带有构建结果和工件的 cd/dvd。无论您选择什么，都有一个备份副本。

只要您可能需要它们，就应该存储它们。多长时间，将取决于您的开发团队的步伐和您的发布周期。

不，如果您进行持续集成，我认为它不会改变。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-30T01:55:42.227

这不是您问题的直接答案，但不要忘记对每晚构建设置本身进行版本控制。当项目结构发生变化时，您可能必须更改构建过程，这将从那时起破坏较旧的构建。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-23T20:19:46.173

除了其他人提到的二进制文件之外，我还建议设置一个[符号服务器](http://msdn.microsoft.com/en-us/library/ms680693(VS.85).aspx)和一个[源服务器](http://msdn.microsoft.com/en-us/library/ms680641.aspx)，并确保您从这些文件中获取正确的信息。它将极大地帮助调试。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-23T17:24:06.153

我们保存二进制文件，剥离和未剥离（所以我们有完全相同的二进制文件，一次有调试符号，一次没有调试符号）。此外，我们将所有内容构建两次，一次启用调试输出，一次不启用（再次，剥离和未剥离，因此每次构建都会产生 4 个二进制文件）。构建根据 SVN 修订号存储到目录中。这样，我们就可以通过简单地检查这个版本来始终保留来自 SVN 存储库的源代码（这样源代码也被归档）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-15T16:10:31.823

我最近了解到的一个令人惊讶的问题：如果您处于可能被审计的环境中，您将希望保存构建的所有输出、脚本输出、编译器输出等。

这是您验证编译器设置、构建步骤等的唯一方法。

> 另外，保存多久，保存在哪里？

保存它们，直到你知道构建不会投入生产，只要你有编译的位。

保存它们的一个合乎逻辑的地方是您的 SCM 系统。另一种选择是使用会自动为您保存它们的工具，例如 AnthillPro 及其同类工具。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-20T17:57:53.413

我们正在做一些接近“嵌入式”开发的事情，我可以告诉你我们节省了什么：

*   SVN 修订号和时间戳，以及它所构建的机器和由谁构建（也烧录到构建二进制文件中）
*   完整的构建日志，显示它是否是完整/增量构建，任何有趣的 (STDERR) 输出生成的数据烘焙工具，编译的文件列表和任何编译器警告（这压缩得很好，是文本）
*   实际的二进制文件（适用于 1-8 个构建配置）
*   作为链接的副作用产生的文件：链接器命令文件、地址映射和一种“清单”文件，指示最终二进制文件中的内容（CRC 和每个文件的大小），以及调试数据库（.pdb相等的）

我们还将在“副作用”文件上运行一些工具的结果邮寄给感兴趣的用户。我们实际上并没有存档这些，因为我们可以稍后再复制它们，但这些报告包括：

*   文件系统大小的总数和增量，按文件类型和/或目录细分
*   代码段大小的总数和增量（.text、.data、.rodata、.bss、.sinit 等）

当我们运行单元测试或功能测试（例如冒烟测试）时，这些结果会显示在构建日志中。

我们还没有扔掉任何东西——考虑到，我们的目标构建通常最终每个配置大约 16 或 32 MiB，而且它们是相当可压缩的。

为了便于访问，我们确实将二进制文件的未压缩副本保留了 1 周；之后我们只保留轻微压缩的版本。大约每月一次，我们有一个脚本提取构建过程生成的每个 .zip，并将整个月的构建输出 7-zip 压缩在一起（这利用了每个构建只有很小的差异）。

每个项目平均每天可能有十几个或两个构建......构建服务器大约每 5 分钟唤醒一次，以检查相关差异和构建。一个非常活跃的大型项目一个月的完整 0.7z 可能是 7-10GiB，但它肯定是负担得起的。

在大多数情况下，我们已经能够以这种方式诊断一切。构建系统偶尔会出现问题，文件实际上并不是构建发生时应该是的版本，但日志中通常有足够的证据证明这一点。有时我们必须挖掘出一个能够理解调试数据库格式的工具，并为其提供一些地址来诊断崩溃（我们在产品中内置了自动堆栈转储）。但通常所有需要的信息都在那里。

值得一提的是，我们还没有破解 .7z 档案。但是我们那里有信息，我有一些关于如何从中挖掘有用数据的有趣想法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-18T22:00:47.603

保存不能轻易复制的东西。我在 FPGA 上工作，其中只有 FPGA 团队拥有工具，并且设计的一些内核（库）被许可仅在一台机器上编译。所以我们保存输出比特流。但是请尝试将它们相互检查，而不是使用日期/时间/版本标记。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T17:28:35.100

另存为签入源代码控制或仅在磁盘上？什么都不保存到源代码控制。所有派生文件都应该在文件系统中可见并且可供开发人员使用。不要签入二进制文件、从 XML 文件生成的代码、消息摘要等。单独的打包步骤将使这些最终产品可用。由于您拥有更改编号，因此您始终可以在必要时重现构建，当然前提是您需要进行构建的所有内容都完全在树中，并且可通过同步对所有构建进行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-18T15:35:20.323

只要您构建的二进制文件有机会投入生产或被其他团队（如质量保证小组）使用，我就会保存它们。一旦某样东西离开生产，你用它做的事情可能会有很大的不同。对于很多团队来说，他们只会保留他们最近的先前构建（用于回滚），否则会丢弃他们的构建。

其他人则有监管要求，将任何投入生产的东西保存长达七年（银行）。如果您是一家产品公司，我会保留客户可能安装的任何二进制文件，以防技术支持人员想要安装相同的版本。

# .net - 使用线程实现等待条件或取消

> ID：230636
> 
> 赞同：1
> 
> 时间：2008-10-23T17:27:31.233
> 
> 标签：.net, multithreading

我正在尝试实现以下功能：

```
class WeightResolver {
  WeightMonitor _source;
  bool _cancelled;
  Weight _threshold;

  public Cancel() {
      _cancelled = true;
  }
  public Weight Resolve(){
      _cancelled = false;
      while(_source.CurrentWeight < threshold ) {
         if(_cancelled)
             throw new CancelledOperationException();
         // Wait until one of the above conditions is met
      }
      return _source.CurrentWeight
  }
} 
```

但是我在管理我的线程时遇到了麻烦。例如，通过事件注册 Cancel 方法并调用 Resolve，如下所示：

```
 _activity_timeout_manager.TimeoutHandler += new Action(_weight_resolver.Cancel())l
  try {
      var weight = _weight_resolver.Resolve();
  }
  catch(CancelledOperationException) { .... } 
```

活动管理器正在运行一个计时器，它使用 TimeoutHandler.Invoke() 调用事件；

问题是，即使它已正确注册到事件中，Cancel() 也永远不会被调用。我相信这是因为它正在调用的线程当前正在旋转，因此它永远不会在 CPU 上获得机会。

除了异步调用 Resolve() 之外，我能做些什么来补救这种情况？WeightResolver.Resolve() 保持同步是非常可取的，因为调用它的代码应该旋转，除非无论如何都提供了一些返回。

**编辑：**澄清我的要求。这似乎是一个相当常见的设置，如果没有简单的标准方法来处理它，我会感到惊讶。我以前从未遇到过这种情况，也不知道它到底是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T17:32:15.450

这可能对您不起作用，但根据您提供的信息，我建议查看 thread.Join(XXX)，其中 XXX 是等待的毫秒数。它将大大简化您的代码。

[http://msdn.microsoft.com/en-us/library/6b1kkss0.aspx](http://msdn.microsoft.com/en-us/library/6b1kkss0.aspx)

您可以将调用线程阻塞到新线程一段指定的时间，之后您可以中止 Resolve 线程。

```
resolveThread.Start();
resolveThread.Join(2000); //this will block the main thread, thus making resolve synchronous
resolveThread.Abort(); //timeout has expired 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T17:35:00.063

这个while循环是否曾经放弃CPU？

```
while(_source.CurrentWeight < threshold ) 
```

如果没有，那么您的不活动计时器将没有机会运行。您可能想要使用 ManualResetEvents （而不是循环......有任何设置 _source.CurrentWeight 设置事件）或每隔一段时间抛出一个 Thread.yield() 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T17:53:53.067

您需要的是条件变量。我不知道专门针对.NET，但一般来说你会有这样的东西

```
Condition cond;
Mutex lock;

public Cancel() {
      lock.lock()
      _cancelled = true;
      cond.signal(lock);
      lock.unlock();
  }
  public Weight Resolve(){
      _cancelled = false;
      lock.lock();
      while(_source.CurrentWeight < threshold) {
         if(_cancelled)
          {
             lock.unlock();
             throw new CancelledOperationException();
           }
          cond.timedWait(lock, 100);
         // Wait until one of the above conditions is met
      }
      lock.unlock();
      return _source.CurrentWeight
  } 
```

如果您的 WeightResolver 在重量变化时在相同的条件下发出信号，那就更好了。例如

```
Condition cond;
Mutex lock;

public Cancel() {
      lock.lock()
      _cancelled = true;
      cond.signal(lock);
      lock.unlock();
  }
  public Weight Resolve(){
      _cancelled = false;
      lock.lock();
      while(_source.CurrentWeight < threshold) {
         if(_cancelled)
          {
             lock.unlock();
             throw new CancelledOperationException();
           }
          cond.wait(lock);
         // Wait until one of the above conditions is met
      }
      lock.unlock();
      return _source.CurrentWeight
  } 
```

在 WeightMonitor 类中，你有这样的东西。

```
public void updateWeight()
{
    lock.lock();
    ...update weight;
    cond.signal(lock);
    lock.unlock();
} 
```

其中 Conditionvariable 和 lock 是相同的。在两个班级。

这是条件变量的一个非常标准的用法，这也是连接的一般实现方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T17:56:02.673

您应该使用 a`ManualResetEvent`而不是 a`bool`来取消。

```
class WeightResolver {
  WeightMonitor _source;
  ManualResetEvent _cancelled = new ManualResetEvent(false);
  Weight _threshold;

  public Cancel() {
      _cancelled.Set();
  }
  public Weight Resolve(){
      _cancelled = false;
      while(_source.CurrentWeight < threshold ) {
         if(_cancelled.WaitOne(100))
             throw new CancelledOperationException();
         // Wait until one of the above conditions is met
      }
      return _source.CurrentWeight
  }
} 
```

# ruby-on-rails - 使用 Apache 和 Mongrel 的多个铁路应用程序

> ID：230638
> 
> 赞同：1
> 
> 时间：2008-10-23T17:28:07.347
> 
> 标签：ruby-on-rails, mongrel

我实际上正在开发和应用程序，它有大约 15 个模块，它们都使用相同的数据库。

我正在使用 Apache + Mongrel，我无法使用Passenger，因为我在 Windows 上工作（请原谅我犯了这个致命的罪过！）

以下哪个是更好的方法？

1.  使用虚拟服务器和每个应用程序的一对混合器部署多个小型 Rails 应用程序。
2.  仅部署大型 Rails 应用程序

我担心正在运行的 mongrel 的数量和内存/cpu 负载。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T20:31:26.947

我建议部署一个单一的 Rails 应用程序。

我使用[request_routing](http://agilewebdevelopment.com/plugins/request_routing)插件来驱动 3 个域从一个大型 Rails 应用程序共享同一个数据库。

我正在运行 4 个杂种，现在似乎已经足够了，但是 YMMV。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T20:26:53.773

这取决于您希望同时拥有多少客户。一个杂种，一次一个客户端（直到 Rails 2.2），因为 Rails 目前没有线程化。

如果您不希望同时有几个用户，那么两个就足够了。对于没有用户特定动态内容的页面，您可以通过使用页面缓存绕过 mongrel 来提高该数字。

真正确定的唯一方法是测试系统。

以我的经验，对于一次只有几个用户的中等活跃站点，您至少需要 4 个杂种。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-24T14:13:17.430

似乎一个应用程序最适合您的场景......正如其他人所说......

一个好的经验法则是，平均行为杂种将消耗 60mb 的内存（或更少）......取你的总可用 RAM，减去任何其他服务（数据库、memcache 等），然后计算出多少块你可以从剩余的记忆中留下的馅饼。

你总是可以从那里放大或缩小它们......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T14:06:57.990

听起来将所有模块集成到一个全面的 Rails 应用程序中会更好地利用您的硬件。

恕我直言，Rails 的主要弱点是运行低流量或非常低流量的应用程序所需的资源量。另一方面，一些杂种可以为大量流量提供服务。

# sql - 在 SQL Server 2005 上创建触发器需要 30 多分钟

> ID：230642
> 
> 赞同：2
> 
> 时间：2008-10-23T17:28:57.267
> 
> 标签：sql, sql-server, triggers

在我们的实时/生产数据库中，我正在尝试向表中添加触发器，但没有成功。我尝试了几次，但是创建触发器语句完成需要 30 多分钟，我已经取消了它。

该表是一个经常由几个不同的进程读取/写入的表。我已禁用更新表的计划作业，并在表上的活动较少时尝试，但我无法停止访问表的所有内容。

我不相信 create trigger 语句本身有问题。create trigger 语句在测试环境中成功且快速，并且当向表中插入/更新行时，触发器可以正常工作。虽然当我在测试数据库上创建触发器时，表上没有负载并且它的行数要少得多，这与实时/生产数据库上的不同（100 对 13,000,000+）。

这是我试图运行的创建触发器语句

```
CREATE TRIGGER [OnItem_Updated] 
    ON  [Item]
   AFTER UPDATE
AS 
BEGIN
    SET NOCOUNT ON;

    IF update(State)
    BEGIN
        /* do some stuff including for each row updated call a stored 
          procedure that increments a value in table based on the 
          UserId of the updated row */
    END
END 
```

在更新行或有很多行时在表上创建触发器会不会有问题？

在 SQLServer 中，触发器的创建默认启用。是否可以创建默认禁用的触发器？

还有其他想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T19:52:47.133

问题可能不在于表本身，而在于必须更新才能创建触发器的系统表。如果您在正常流程中执行任何其他类型的 DDL，他们可能会阻止它。

使用 sp_who 找出块的来源，然后从那里进行调查。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T17:52:09.140

我相信 CREATE 触发器会尝试在整个表上加锁。

如果您在该表上有很多活动，则可能需要等待很长时间，并且您可能会造成死锁。

对于任何架构更改，您应该真正获得数据库的每个人。

也就是说，通过活动连接进行“小”更改是很诱人的。您应该查看锁/连接以了解锁争用的位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T17:50:42.450

这很奇怪。`AFTER UPDATE`触发器不需要检查表中的现有行。我想您可能无法获得表上的锁来添加触发器。

您可以尝试创建一个基本上什么都不做的触发器。如果你不能创建它，那么这是一个锁定问题。如果可以，那么您可以禁用该触发器，将您的预期代码添加到正文中，然后启用它。（我不相信您可以在创建期间禁用触发器。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T13:40:56.077

部分问题也可能是触发器本身。您的触发器是否会意外更新表的所有行？测试数据库中的 100 行与 13,000,000 行之间存在很大差异。当您拥有如此庞大的数据集以致无法预测性能时，针对如此小的集合开发代码是一个非常糟糕的主意。对 100 条记录运行良好的 SQL 可以完全锁定数百万个系统数小时。你真的想在 dev 中知道这一点，而不是在你晋升为 prod 的时候。

在触发器中调用存储过程通常是一个非常糟糕的选择。这也意味着您必须遍历记录，这在触发器中是一个更糟糕的选择。触发器必须始终考虑多个记录插入/更新或删除。如果有人插入 100,000 行（如果您有 13,000,000 条记录，这不太可能），那么循环通过基于记录的存储过程可能需要几个小时，锁定整个表并导致所有用户想要追捕开发人员并杀死（或至少致残）他，因为他们无法完成他们的工作。

在您针对与 prod 大小相似的记录集进行测试之前，我什至不会考虑将此触发器放在 prod 上。

我的朋友丹尼斯（Dennis）写了这篇文章，说明了为什么当你有大量信息时测试少量信息会在 prd 上造成你在 dev 上没有注意到的困难：http: [//blogs.lessthandot.com/index.php /DataMgmt/?blog=3&title=your-testbed-has-to-have-the-same-volume&disp=single&more=1&c=1&tb=1&pb=1#c1210](http://blogs.lessthandot.com/index.php/DataMgmt/?blog=3&title=your-testbed-has-to-have-the-same-volume&disp=single&more=1&c=1&tb=1&pb=1#c1210)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-06-01T11:14:11.320

`DISABLE TRIGGER triggername ON tablename`在更改触发器之前运行，然后使用`ENABLE TRIGGER triggername ON tablename`

# java - 用于从内置摄像头和麦克风检测新媒体的 Android API

> ID：230643
> 
> 赞同：19
> 
> 时间：2008-10-23T17:29:07.097
> 
> 标签：java, android, api, multimedia

在将新媒体写入设备时，Android API 中是否有任何优雅的方式来检测新媒体？我主要对相机拍摄的照片、相机拍摄的视频和麦克风录制的音频感兴趣。

我目前的想法是定期扫描每个媒体内容提供商并根据上次扫描时间进行过滤。

我只是想知道是否有一些服务可以让我获得实时通知。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-25T17:54:42.560

每次应用程序向媒体存储写入任何新内容时，都会调用一个特殊的广播 Intent：

```
Intent.ACTION_MEDIA_SCANNER_SCAN_FILE 
```

广播意图包括新文件的路径，可通过该`Intent.getDataString()`方法访问。

要收听它，只需创建一个`BroadcastReceiver`并使用`IntentFilter`如下所示注册它：

```
registerReceiver(new BroadcastReceiver() {
    @Override
    public void onReceive(Context context, Intent intent) {
      String newFileURL = intent.getDataString();
      // TODO React to new Media here.  
    }    
  }, new IntentFilter(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE)); 
```

这仅适用于插入到媒体存储内容提供程序之一的文件。此外，它取决于将其放在那里广播意图的应用程序，所有本机（谷歌）应用程序都会这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-24T00:43:16.017

啊哈！

我需要一个[内容观察者！](http://code.google.com/android/reference/android/database/ContentObserver.html)

[这是我发现它的地方](http://mylifewithandroid.blogspot.com/2008/03/observing-content.html)

# apache - 如何将我的 tomcat 应用程序连接到 apache 2，这样路径就不会跛脚？

> ID：230644
> 
> 赞同：0
> 
> 时间：2008-10-23T17:29:24.507
> 
> 标签：apache, tomcat, proxy, ajp

我有一个 tomcat 实例，上面运行着几个应用程序......我希望我的新域的根目录转到这些应用程序之一（等等的上下文路径）......所以我有以下设置：

```
<Location />
    ProxyPass ajp://localhost:8025/blah
    ProxyPassReverse ajp://localhost:8025/blah
</Location> 
```

它有点工作......去 mydomain.com/index.jsp 工作除了应用程序仍然认为它需要将 /blah/ 添加到 css 和 js 之类的所有内容中......有没有我可以做的事情而不将应用程序部署到 ROOT 或更改tomcat服务器配置？如果可能的话，我想把所有这些东西都放在 apache 端。

我在想我可能不理解 proxypassreverse 指令..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T07:38:15.797

如果您想将应用程序服务于 /，则 Tomcat 期望应用程序安装在 / 上，并具有 ROOT 的名称。至少我个人一直是这样处理这种情况的。即使您只是将应用程序符号链接到 ROOT，也应该可以缓解您的问题。如果您有一个应用程序放置在 ${tomcat_home}/webapps/newapp 中，那么 Tomcat 会使用 /newapp 的上下文部署它。至少，在我的历史上是这样的。另外，不确定是否重要，但我一直使用：

```
ProxyPass / ajp://localhost:8025/blah
ProxyPassReverse / ajp://localhost:8025/blah 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T22:03:17.323

看起来这是一种[背部疼痛](http://dltj.org/article/apache-httpd-and-tomcat/)。

apache实际上是在为它们提供服务时重写页面......

我想我会走另一条路。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T22:09:44.117

如果您也在 Tomcat 端配置主机，那么您可以代理它们并消除非 root webapps 的上下文路径——在 Tomcat server.xml 中：

```
<Host name="myhost">
  <Context path="" docBase="/path/to/files" />
</Host> 
```

在 Apache 方面：

```
<VirtualHost *:80>
  ServerName myhost
  ProxyPass / ajp://myhost:8009/
  ProxyPassReverse / ajp://myhost:8009/
</VirtualHost> 
```

希望有帮助。

# java - 轻量级 Java 对象缓存 API

> ID：230649
> 
> 赞同：100
> 
> 时间：2008-10-23T17:30:51.680
> 
> 标签：java, caching

## 问题

我正在寻找一个 Java 内存对象缓存 API。有什么建议吗？您过去使用过哪些解决方案？

## 当前的

现在，我只是在使用地图：

```
Map cache = new HashMap<String, Object>();
cache.put("key", value); 
```

## 要求

我需要扩展缓存以包含基本功能，例如：

*   最大尺寸
*   活着的时间

但是，我不需要更复杂的功能，例如：

*   从多个进程访问（缓存服务器）
*   持久性（到磁盘）

## 建议

内存缓存：

*   [Guava](http://guava-libraries.googlecode.com) CacheBuilder - 积极开发。请参阅此[演示文稿](https://github.com/liubo404/it-ebooks/blob/master/pdf/JavaCachingwithGuava.pdf)。
*   [LRUMap](http://commons.apache.org/collections/apidocs/org/apache/commons/collections/map/LRUMap.html) - 通过 API 配置。没有 TTL。不是专为缓存而构建的。
*   [whirlycache](http://whirlycache.dev.java.net/) - XML 配置。邮件列表。最后更新于 2006 年。
*   [cache4j](http://cache4j.sourceforge.net/) - XML 配置。俄语文档。最后更新于 2006 年。

企业缓存：

*   [JCS](http://jakarta.apache.org/jcs) - 属性配置。广泛的文档。
*   [Ehcache](http://ehcache.sourceforge.net) - XML 配置。广泛的文档。到目前为止，根据谷歌点击最受欢迎。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-10-23T17:34:05.260

[EHCache](http://ehcache.sourceforge.net/)非常好。您可以创建内存缓存。查看他们的[代码示例](http://ehcache.sourceforge.net/documentation/samples.html)，了解创建内存缓存的示例。您可以指定最大大小和生存时间。

EHCache 确实提供了一些高级功能，但如果您对使用它们不感兴趣，请不要使用它们。但是，如果您的要求发生变化，很高兴知道它们在那里。

这是一个内存缓存。在代码中创建，没有配置文件。

```
CacheManager cacheManager = CacheManager.getInstance();
int oneDay = 24 * 60 * 60;
Cache memoryOnlyCache = new Cache("name", 200, false, false, oneDay, oneDay);
cacheManager.addCache(memoryOnlyCache); 
```

创建一个可以容纳 200 个元素的缓存，并且 ttl 为 24 小时。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-09-02T13:22:17.073

我真的很喜欢[Google Guava](https://github.com/google/guava) ( [API](https://google.github.io/guava/releases/snapshot/api/docs/) )[`MapMaker`](https://google.github.io/guava/releases/snapshot/api/docs/com/google/common/collect/MapMaker.html)附带的

JavaDoc 有一个非常简洁的示例，展示了它的易用性和强大的功能：

```
ConcurrentMap<Key, Graph> graphs = new MapMaker()
   .concurrencyLevel(32)
   .softKeys()
   .weakValues()
   .expiration(30, TimeUnit.MINUTES)
   .makeComputingMap(
       new Function<Key, Graph>() {
         public Graph apply(Key key) {
           return createExpensiveGraph(key);
         }
       }); 
```

此外，Guava 10.0 版引入了更广泛的[`com.google.common.cache`包](https://google.github.io/guava/releases/snapshot/api/docs/com/google/common/cache/package-summary.html)（有一个[很好的 wiki entry on how to use them](https://github.com/google/guava/wiki/CachesExplained)）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-08-03T03:17:21.970

您还可以在以下位置查看我的名为 KittyCache 的小缓存库：

[https://github.com/treeder/kitty-cache](https://github.com/treeder/kitty-cache)

有一些与 ehcache 相比的性能基准。

它在[SimpleJPA](http://code.google.com/p/simplejpa/)项目中用作二级缓存。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-23T17:53:11.570

您可以查看 LinkedHashMap 以实现没有第三方 jar 的简单缓存：

```
 Map <String, Foo> cache = new LinkedHashMap<String, Foo>(MAX_ENTRIES + 1, .75F, true) {

        public boolean removeEldestEntry(Map.Entry<String, Foo> eldest) {
            return size() > MAX_ENTRIES;
        }
    }; 
```

然后你可以从缓存中获取

```
 Foo foo = cache.get(key);
    if (foo == null && !cache.containsKey(key)) {
        try {
            FooDAO fooDAO = DAOFactory.getFooDAO(conn);
            foo = fooDAO.getFooByKey(key);
            cache.put(key, foo);
        } catch (SQLException sqle) {
            logger.error("[getFoo] SQL Exception when accessing Foo", sqle);
        }
    } 
```

剩下的留给读者练习:)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-09-06T04:31:26.693

Guava 的[MapMaker](https://google.github.io/guava/releases/18.0/api/docs/com/google/common/collect/MapMaker.html)已被他们的[CacheBuilder](https://google.github.io/guava/releases/21.0/api/docs/com/google/common/cache/CacheBuilder.html)类取代。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-23T17:37:37.140

[JCS 久经考验](http://jakarta.apache.org/jcs/)。尽管就缓存机制而言它很简单，但您可能会深入研究实际代码并模仿它们在幕后对 HashMap 所做的事情，以完全满足您的需求，仅此而已。你似乎很清楚你在寻找什么。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-09-02T15:28:40.720

memcached 有 Java 客户端。[http://www.danga.com/memcached/](http://www.danga.com/memcached/)需要单独的进程作为缓存服务器，但功能强大。

# sql - SQL - 调用“reader.NextResult”会导致长时间延迟

> ID：230652
> 
> 赞同：1
> 
> 时间：2008-10-23T17:31:32.193
> 
> 标签：sql

我们的应用程序执行一个包含多个结果集的长而复杂的存储过程。用户对此查询的等待时间很长，因此我着手确定导致延迟的原因。

我在执行和读取数据时放了一个秒表，每次需要 6-7 秒。我对存储过程的执行进行了计时，预计这会一直持续下去。不是——它花了 30 毫秒左右。

所以我在大约 20 个结果集的每一个周围放置了计时器。每个“块”花费的时间非常短（< 10ms），除了处理中间的一个，需要 5-6 秒。经过进一步研究，我发现它一直是“reader.NextResult()”调用。这种长时间的延迟每次都发生在同一个地方。

如果我只是执行存储过程，它似乎运行得非常快，所以查询不会出现问题 - 但我不知道......

我如何解释这个？SQL 是否在获得结果集时向我发送了结果集，有问题的结果集是否可能是我的 SQL 查询中的问题区域？还是其他原因可能导致延迟？

编辑：

感谢您的回答和评论 - 我正在使用 SQL Server 和 .NET

我最好奇的是为什么我的延迟发生在“NextResult()”调用上。作为 SQL 开发的新手，我假设在等待“ExecuteReader()”调用返回时，由于长时间执行存储过程而导致的延迟会出现在我的应用程序中。现在似乎 SQL 将在查询完成之前开始返回数据，如果有延迟，它将延迟 NextResult() 调用。

我开始认为我的延迟是在存储过程中。当 ExecuteReader() 调用很快返回时，我认为我的延迟是在我的代码对阅读器的处理中。当延迟最终出现在 NextResult() 调用上时，我很困惑。我现在回到查看存储过程。

感谢那些花时间审查我的问题并提供帮助的人。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T11:00:58.337

当您从 .Net 命令执行存储过程时，一旦 SQL 准备好结果，结果就会开始流式传输。

这意味着您可能会在执行整个存储过程之前开始在 .Net 应用程序中看到结果。

您的瓶颈可能在存储过程中，运行 sql server 跟踪，并跟踪存储过程中运行的所有语句（获取持续时间）。您将能够追踪 proc 中缓慢的确切语句，并且您还能够了解传递给 proc 的参数，以便您可以在 Query Analyzer 中对其进行测试并查看计划。

问题中缺少的另一点似乎是您正在移动的数据量，虽然不太可能，但可能是您正在发送一些非常大的数据块（如 blob）并且时间花费在金属丝。您确实需要稍微扩展问题以帮助诊断。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T17:49:28.567

答案将取决于您使用的 RDBMS。

如果它是 SQL Server 和 .NET，那么根据我的经验：

1.  检查用于调用存储过程的同一连接上的其他打开事务。他们可能在您的选择之一正在执行的表上具有行锁。您可以尝试将“MultipleActiveResultSets=false”添加到您的 SQL Server 连接字符串中，看看您是否得到了改进，或者更有可能是异常（并且您可以从异常中找出问题）。[这也可能是返回到连接池的未重置连接的影响（自从我开始使用MARS](http://www.devx.com/dbzone/Article/30132/1954)以来我就遇到过这种情况）。
2.  [如果脏读是可以接受](http://msdn.microsoft.com/en-us/library/ms190805.aspx)的，您可能需要在 SELECT 查询中指定 NOLOCK（或 READUNCOMMITTED，同样的东西）表提示。

    SELECT * FROM [table] WITH NOLOCK

# sql - 当参数为空时插入默认值

> ID：230662
> 
> 赞同：46
> 
> 时间：2008-10-23T17:34:49.877
> 
> 标签：sql, sql-server, tsql, stored-procedures, null

我有一个表，其中有一列具有默认值：

```
create table t (
    value varchar(50) default ('something')
) 
```

我正在使用存储过程将值插入此表：

```
create procedure t_insert (
    @value varchar(50) = null
)
as 
insert into t (value) values (@value) 
```

问题是，我如何让它使用默认值 when `@value`is `null`？我试过了：

```
insert into t (value) values ( isnull(@value, default) ) 
```

那显然行不通。还尝试了一个`case`声明，但这也不公平。还有其他建议吗？我会以错误的方式解决这个问题吗？

更新：我试图做到这一点**而**不必：

1.  `default`在多个地方保持价值，以及
2.  使用多个`insert`语句。

如果这是不可能的，那么我想我只能忍受它。似乎这应该是可以实现的。

注意：我的实际表格不止一列。我只是在快速写一个例子。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-23T18:34:42.737

克里斯托夫，

仅当您未在 INSERT 语句中指定列时，才会应用列的默认值。

由于您在插入语句中明确列出该列，并明确将其设置为 NULL，这将覆盖该列的默认值

您需要做的是“如果将 null 传递到您的存储过程中，则不要尝试为该列插入”。

这是一个快速而讨厌的例子，说明如何使用一些动态 sql 来做到这一点。

创建一个包含一些具有默认值的列的表...

```
CREATE TABLE myTable (
    always VARCHAR(50),
    value1 VARCHAR(50) DEFAULT ('defaultcol1'),
    value2 VARCHAR(50) DEFAULT ('defaultcol2'),
    value3 VARCHAR(50) DEFAULT ('defaultcol3')
) 
```

创建一个基于输入参数动态构建和执行插入语句的 SPROC

```
ALTER PROCEDURE t_insert (
    @always VARCHAR(50),
    @value1 VARCHAR(50) = NULL,
    @value2 VARCHAR(50) = NULL,
    @value3 VARCAHR(50) = NULL
)
AS 
BEGIN
DECLARE @insertpart VARCHAR(500)
DECLARE @valuepart VARCHAR(500)

SET @insertpart = 'INSERT INTO myTable ('
SET @valuepart = 'VALUES ('

    IF @value1 IS NOT NULL
    BEGIN
        SET @insertpart = @insertpart + 'value1,'
        SET @valuepart = @valuepart + '''' + @value1 + ''', '
    END

    IF @value2 IS NOT NULL
    BEGIN
        SET @insertpart = @insertpart + 'value2,'
        SET @valuepart = @valuepart + '''' + @value2 + ''', '
    END

    IF @value3 IS NOT NULL
    BEGIN
        SET @insertpart = @insertpart + 'value3,'
        SET @valuepart = @valuepart + '''' + @value3 + ''', '
    END

    SET @insertpart = @insertpart + 'always) '
    SET @valuepart = @valuepart + + '''' + @always + ''')'

--print @insertpart + @valuepart
EXEC (@insertpart + @valuepart)
END 
```

以下 2 个命令应该为您提供一个示例，说明您想要什么作为输出......

```
EXEC t_insert 'alwaysvalue'
SELECT * FROM  myTable

EXEC t_insert 'alwaysvalue', 'val1'
SELECT * FROM  myTable

EXEC t_insert 'alwaysvalue', 'val1', 'val2', 'val3'
SELECT * FROM  myTable 
```

我知道这是一种非常复杂的方式来做你需要做的事情。您可能同样可以从 InformationSchema 中为相关列选择默认值，但老实说，我可能会考虑将默认值添加到过程顶部的 param

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-23T18:04:24.373

试试 if 语句...

```
if @value is null 
    insert into t (value) values (default)
else
    insert into t (value) values (@value) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-23T17:39:26.403

据我所知，只有在插入语句中没有指定值时才会插入默认值。因此，例如，您需要在具有三个字段的表中执行以下操作（默认值为 value2）

```
INSERT INTO t (value1, value3) VALUES ('value1', 'value3') 
```

然后 value2 将被默认。也许有人会插话如何为具有单个字段的表完成此操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-08-31T09:59:52.757

黑桃，

据我所知，该行为与 db 引擎的工作方式不兼容，但是有一个简单的（我不知道是否优雅，但性能良好）的解决方案可以实现您的两个**目标**

1.  在多个位置保持默认值，并且
2.  使用多个插入语句。

解决方案是使用两个字段，一个可以为空插入，另一个计算选择：

```
CREATE TABLE t (
    insValue VARCHAR(50) NULL
    , selValue AS ISNULL(insValue, 'something')
)

DECLARE @d VARCHAR(10)
INSERT INTO t (insValue) VALUES (@d) -- null
SELECT selValue FROM t 
```

这种方法甚至可以让您在参数表中集中管理业务默认值，放置一个临时函数来执行此操作，vg 更改：

```
selValue AS ISNULL(insValue, 'something') 
```

为了

```
selValue AS ISNULL(insValue, **getDef(t,1)**) 
```

我希望这有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-23T22:34:02.800

可能不是对性能最友好的方式，但您可以创建一个标量函数，该函数使用表名和列名从信息模式中提取，然后使用您之前尝试的 isnull 逻辑调用它：

```
 CREATE FUNCTION GetDefaultValue
    (
        @TableName VARCHAR(200),
        @ColumnName VARCHAR(200)
    )
    RETURNS VARCHAR(200)
    AS
    BEGIN
        -- you'd probably want to have different functions for different data types if
        -- you go this route
    RETURN (SELECT TOP 1 REPLACE(REPLACE(REPLACE(COLUMN_DEFAULT, '(', ''), ')', ''), '''', '') 
            FROM information_schema.columns
            WHERE table_name = @TableName AND column_name = @ColumnName)

    END
    GO 
```

然后这样称呼它：

```
INSERT INTO t (value) VALUES ( ISNULL(@value, SELECT dbo.GetDefaultValue('t', 'value') ) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-25T20:03:33.630

这是我能想到的最好的。它可以防止 sql 注入只使用一个插入语句，并且可以使用更多的 case 语句进行扩展。

```
CREATE PROCEDURE t_insert (     @value varchar(50) = null )
as
DECLARE @sQuery NVARCHAR (MAX);
SET @sQuery = N'
insert into __t (value) values ( '+
CASE WHEN @value IS NULL THEN ' default ' ELSE ' @value ' END +' );';

EXEC sp_executesql 
@stmt = @sQuery, 
@params = N'@value varchar(50)',
@value = @value;

GO 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-04-14T11:44:16.130

到目前为止，最好的选择是为您的表创建一个 INSTEAD OF INSERT 触发器，从您的表中删除默认值，并将它们移动到触发器中。

这将如下所示：

```
create trigger dbo.OnInsertIntoT
ON TablenameT
INSTEAD OF INSERT
AS
insert into TablenameT
select
   IsNull(column1 ,<default_value>)
  ,IsNull(column2 ,<default_value>)
  ...
from inserted 
```

这使得无论什么代码尝试将 NULL 插入到您的表中，避免存储过程，完全透明，并且您只需要在一个地方维护您的默认值，即此触发器，它都可以工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T17:39:52.783

您可以为存储过程的参数使用默认值：

```
CREATE PROCEDURE MyTestProcedure ( @MyParam1 INT,
@MyParam2 VARCHAR(20) = ‘ABC’,
@MyParam3 INT = NULL)
AS
BEGIN
    -- Procedure body here

END 
```

如果未提供 @MyParam2，它将具有 'ABC' 值...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T17:40:13.640

插入时不要指定列或值，DEFAULT 常量的值将替换缺失值。

我不知道这将如何在单列表中工作。我的意思是：它会，但它不会很有用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-23T21:32:28.367

您可以在 MS SQL 中使用 COALESCE 函数。

插入 t ( 值 ) 值( COALESCE(@value, 'something') )

就个人而言，我对这个解决方案并不感兴趣，因为如果你想更改默认值，这将是一场维护噩梦。

我的偏好是 Mitchel Sellers 提案，但这在 MS SQL 中不起作用。无法与其他 SQL dbms 对话。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-05-31T09:51:26.637

表上有足够的默认值，您可以简单地说：

```
INSERT t DEFAULT VALUES 
```

但是请注意，这种情况不太可能发生。

我只需要在生产环境中使用一次。我们有两个密切相关的表，并且需要保证两个表都没有相同的 UniqueID，所以我们有一个单独的表，它只有一个标识列，最好的插入方法是使用上面的语法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-02-20T12:47:19.990

希望能帮助 - 像我一样的新手 - 在 MSSQL 中使用 Upsert 语句的人 ..（我在 MSSQL 2008 R2 的项目中使用的这段代码非常完美..可能不是最佳实践.. 执行时间统计显示执行插入语句的时间为 15 毫秒）

只需将列的“默认值或绑定”字段设置为您决定用作列的默认值的值，并将列设置为不接受设计菜单中的空值并创建此存储过程。

```
`USE [YourTable]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROC [dbo].[YourTableName]

    @Value smallint,
    @Value1 bigint,
    @Value2 varchar(50),
    @Value3 varchar(20),
    @Value4 varchar(20),
    @Value5 date,
    @Value6 varchar(50),
    @Value7 tinyint,
    @Value8 tinyint,
    @Value9 varchar(20),
    @Value10 varchar(20),
    @Value11 varchar(250),
    @Value12 tinyint,
    @Value13 varbinary(max) 
```

-- 在我的项目中@Value13 是一个照片列，它存储为字节数组.. --而且我计划在没有照片传递时使用默认照片 -- 到 sp 存储在数据库中..

```
AS
--SET NOCOUNT ON
IF @Value = 0 BEGIN
    INSERT INTO YourTableName (
        [TableColumn1],
        [TableColumn2],
        [TableColumn3],
        [TableColumn4],
        [TableColumn5],
        [TableColumn6],
        [TableColumn7],
        [TableColumn8],
        [TableColumn9],
        [TableColumn10],
        [TableColumn11],
        [TableColumn12],
        [TableColumn13]
    )
    VALUES (
        @Value1,
        @Value2,
        @Value3,
        @Value4,
        @Value5,
        @Value6,
        @Value7,
        @Value8,
        @Value9,
        @Value10,
        @Value11,
        @Value12,
        default
    )
    SELECT SCOPE_IDENTITY() As InsertedID
END
ELSE BEGIN
    UPDATE YourTableName SET 
        [TableColumn1] = @Value1,
        [TableColumn2] = @Value2,
        [TableColumn3] = @Value3,
        [TableColumn4] = @Value4,
        [TableColumn5] = @Value5,
        [TableColumn6] = @Value6,
        [TableColumn7] = @Value7,
        [TableColumn8] = @Value8,
        [TableColumn9] = @Value9,
        [TableColumn10] = @Value10,
        [TableColumn11] = @Value11,
        [TableColumn12] = @Value12,
        [TableColumn13] = @Value13
    WHERE [TableColumn] = @Value

END
GO` 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2018-09-26T16:06:15.513

我通常使用的模式是创建没有具有默认约束的列的行，然后更新列以用提供的值替换默认值（如果不是 null）。

假设 col1 是主键并且 col4 和 col5 具有默认约束

```
-- create initial row with default values
insert table1 (col1, col2, col3)
    values (@col1, @col2, @col3)

-- update default values, if supplied
update table1
    set col4 = isnull(@col4, col4),
        col5 = isnull(@col5, col5)
    where col1 = @col1 
```

如果您希望将实际值默认到表中...

```
-- create initial row with default values
insert table1 (col1, col2, col3)
    values (@col1, @col2, @col3)

-- create a container to hold the values actually inserted into the table
declare @inserted table (col4 datetime, col5 varchar(50))

-- update default values, if supplied
update table1
    set col4 = isnull(@col4, col4),
        col5 = isnull(@col5, col5)
    output inserted.col4, inserted.col5 into @inserted (col4, col5)
    where col1 = @col1

-- get the values defaulted into the table (optional)
select @col4 = col4, @col5 = col5 from @inserted 
```

干杯...

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-02-24T21:41:51.470

我能想到的最简洁的解决方案是在插入之后使用默认值更新列：

```
IF OBJECT_ID('tempdb..#mytest') IS NOT NULL DROP TABLE #mytest
CREATE TABLE #mytest(f1 INT DEFAULT(1), f2 INT)
INSERT INTO  #mytest(f1,f2) VALUES (NULL,2)
INSERT INTO  #mytest(f1,f2) VALUES (3,3)

UPDATE #mytest SET f1 = DEFAULT WHERE f1 IS NULL

SELECT * FROM #mytest 
```

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-10-23T17:50:12.637

最简单的方法是将表声明修改为

```
CREATE TABLE Demo
(
    MyColumn VARCHAR(10) NOT NULL DEFAULT 'Me'
) 
```

现在，在您的存储过程中，您可以执行类似的操作。

```
CREATE PROCEDURE InsertDemo
    @MyColumn VARCHAR(10) = null
AS
INSERT INTO Demo (MyColumn) VALUES(@MyColumn) 
```

但是，此方法仅在您不能有 null 时才有效，否则，您的存储过程将不得不使用不同形式的插入来触发默认值。

* * *

## 回答 #16

> 赞同：-4
> 
> 时间：2008-10-23T20:32:12.123

提问者需要了解提供的空值和 null 之间的区别。

其他人发布了正确的基本答案：提供的值（包括空值）是*某种东西*，因此它被使用。默认仅在未提供值时提供值。但这里真正的问题是对 null 的值缺乏了解。

.

# c# - 在 C# 中的通用 FillDataSet 方法中映射强类型数据集？

> ID：230677
> 
> 赞同：1
> 
> 时间：2008-10-23T17:39:40.287
> 
> 标签：c#, sql, oop, n-tier-architecture

**编辑：**我正在使用 SqlDataAdapters 来填充数据集。抱歉——我应该更清楚。

我正在做一个项目，我需要用来自存储过程的信息填充许多强类型数据集。现在，我的数据访问层中有一个通用方法：

```
public static DataSet FillDataSet(DataSet dataSet, string storedProcedureName, Dictionary<string, string> parameters); 
```

这样做的问题是我需要在存储过程返回的记录集和我的数据集中的表之间建立映射。为此，我提出了两种选择：

*   `FillDataSet`向我的方法 ( )添加一个新的形式`KeyValuePair<string, string>[] mappings`，它将提供表映射的信息。
*   创建一个`DataSetMappingFactory`将 DataSet 作为参数的，然后根据其类型添加适当的映射。如果它是未知类型，则不会添加任何映射。然后，它将返回`DataSet`到该`FillDataSet`方法。

你们中有人对我如何解决这个问题有其他想法吗？此外，是否有人想权衡一种在面向对象设计方面最好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T20:41:20.140

我要问的第一个问题是：我真的需要这样做吗？类型化的 DataSet 设计器已经为您提供了一个用于定义存储过程和 DataTable 之间的映射的工具。如果您仔细设计您的 DataSet，那么您已经为每个 DataTable 提供了一个 Fill 方法。重新发明那个轮子有意义吗？

我认为可能。有一种方法可以维护该映射真的很酷，但是该映射中的所有内容在编译时都被冻结了。如果要更改映射，则需要重建程序集。此外，类型化的 DataSet 设计不处理返回多个结果集的存储过程。如果要一般映射参数和值，则必须使用反射从 Fill 方法中获取参数列表。如果您考虑这些因素（以及我没有想到的其他因素），可能会发现使用现有工具不是要走的路。

在这种情况下，在我看来，您的目标是能够从一系列存储过程中使用尽可能少地了解实现细节的代码填充 DataSet。所以这是一个将由元数据驱动的过程。当您拥有由元数据驱动的流程时，从长远来看，对您而言最重要的是维护流程使用的元数据的难易程度。一旦你让代码工作，你可能不会接触太多。但是你会不断地调整元数据。

如果我从这个角度来看问题，我认为要做的第一件事就是设计一个类型化的 DataSet 来包含元数据。这给了我们很多东西，否则我们必须弄清楚：

*   持久性格式
*   构建绑定 UI 的直接途径
*   如果我们决定走这条路，那么将元数据保存在数据库中的同样简单的方法
*   用于导航数据的对象模型。

在此 DataSet 中，您将有一个 DataSetType 表，以您打算能够填充的每个类型化 DataSet 的类型为键。它将有一个子 StoredProcedures 表，每个被调用的 SP 都有一行。那将有两个子表，Parameter 和 DataTableType。对于 SP 预期返回的每个结果集，将有一个 DataTableType 行，按序号位置排序。DataTableType 表将有一个子 ColumnMapping 表。您将在该表中维护结果集中的列与您正在填充的表中的列之间的映射。

确保您的所有 DataRelations 都是嵌套的，并且您已经为关系指定了合理的名称。（我喜欢`FK_childtablename_parenttablename`。）

一旦你有了这个，类的设计就变得非常简单了。该类具有对元数据 DataSet、Connection 等的引用，并且它公开了一个具有此签名的方法：

```
public void FillDataSet(DataSet targetDs, Dictionary<string, Dictionary<string, KeyValuePair<string, string>> parameterMap); 
```

您首先使用 targetDs 的 Type 来查找顶级 DataSetType 行。然后所有私有方法遍历 DataTable.GetChildRows() 返回的 DataRows 列表。并且您在类设计中添加一个或两个事件，以便在它执行操作时可以引发事件，让调用应用程序知道它是如何进行的。

可能我希望重构此设计的第一个地方是让我对填充过程进行更细粒度的控制。例如，按照设计，每个类型化的 DataSet 只有一组 SP。如果我只想填充 DataSet 的一个子集怎么办？按照设计，我不能。但是您可以轻松地将 DataSetType 表的主键分为两部分，其中部分是 DataSet 类型和一些字符串键（名称如 SPSetName 或 OperationName），然后将键的第二部分添加到 FillDataSet 参数列表.

# c++ - C/C++ 中 PHP isset() 的对应物

> ID：230687
> 
> 赞同：6
> 
> 时间：2008-10-23T17:42:28.020
> 
> 标签：c++, c, compiler-construction

PHP 有一个非常好的函数，isset($variableName)。它检查 $variableName 是否已经在程序中定义。

我们可以为 C/C++（某种符号表查找）构建类似的功能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-23T17:53:37.373

我是一个 C++ 人，但我记得在 PHP 中 isset 用于检查通过 get/post 请求传入时变量是否包含值（我确信还有其他用途，但我相信这是一个常见的用途） .

您在 C++ 中并没有真正的动态类型。所以你不能突然使用一个你以前没有明确定义过的变量名。C++ 中确实没有“未设置”变量之类的东西。

即使你说“int var;” 并且不要初始化它，变量有一个值，通常是垃圾，但它仍然是 PHP 意义上的“设置”。

我想关闭是预处理器的#ifdef 和#ifndef，它们只检查你是否使用#define 定义了一个变量。但根据我的经验，这主要用于省略或添加基于标志的代码。例如：

```
// code code code
#ifdef DEBUG
// debug only code that will not be included in final product.
#endif
// more code more code 
```

您可以使用#define 定义DEBUG 来确定现在是否包含“DEBUG”代码。

也许更多地讲述您尝试使用与 isset 等效的 C++ 所做的事情，会让您更好地了解如何以“C++ 方式”进行操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-23T18:17:09.713

在语言中没有直接的方法可以做到这一点。但是，可以通过使用如下映射来执行此类操作：

```
typedef std::map<std::string, int> variables_type;
variables_type variables;

variables["var"] = 1;
if(variables.find("jon") == variables.end())
   std::cout << "variable, \"jon\" not set\n"; 
```

为了使它成为像 PHP 或 javascript 中使用的变量，实现需要使用某种变体类型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T17:46:04.223

并不真地。您不能在 C 中动态创建变量（尽管您可以使用 malloc() 等人或 C++ 中的 new 等人动态创建存储）。我想动态加载的库会模糊图片，但即使在那里，您建立是否变量的存在是通过查找其名称。如果名称不存在，那么，如果没有运行编译器来创建动态加载的模块然后加载它，您可能会被卡住。这个概念实际上不适用于 C 或 C++。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T19:18:54.940

正如在其他答案中所说，在 C++ 中，变量永远不会未定义。但是，变量可以未初始化，在这种情况下，它们的内容未在语言标准中指定（并且大多数编译器将其实现为恰好存储在该内存位置的任何内容）。

通常，编译器会提供一个标志来检测可能未初始化的变量，如果启用，则会生成警告。

isset 的另一种用法可能是处理不同的代码。请记住，C++ 是一种静态编译的语言，尝试重新定义符号会导致编译时错误，因此不再需要 isset。

最后，您可能正在寻找的是一个空指针。为此，只需使用一个简单的比较：

```
int * x(getFoo());
if (x) {
  cout << "Foo has a result." << endl;
} else {
  cout << "Foo returns null." << endl;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T19:47:31.467

那么总会有 Boost.Optional

[http://www.boost.org/doc/libs/1_36_0/libs/optional/doc/html/index.html](http://www.boost.org/doc/libs/1_36_0/libs/optional/doc/html/index.html)

这几乎应该做你想要的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T19:33:33.180

简短的回答：**否**

标准后续问题：你**真正**想解决什么问题？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T19:51:08.057

你必须在这里分开两件事：变量*声明*和变量*内容*。

正如在其他答案中所说，与 PHP 不同，C++ 不允许在声明变量之前使用它。

但除此之外，它可以是未初始化的。

我认为 PHP isset 函数试图找出变量是否具有可用值。在 C++ 中，这最好对应于指针为 NULL 或有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T21:36:18.750

我能想到的最接近的事情是使用指针而不是实际变量。然后你可以检查NULL。

但是，您似乎在为该语言解决错误的问题，或者使用错误的语言来解决您的问题。

# java - 在 JNI 代码中抛出异常的最佳方法？

> ID：230689
> 
> 赞同：64
> 
> 时间：2008-10-23T17:43:41.060
> 
> 标签：java, exception-handling, java-native-interface

我想要一种在 JNI 代码中抛出异常的一致且简单的方法；处理链式异常的东西（隐含地来自 env->ExceptionOccurred 方法，或显式地通过参数，无论哪种方式都很好）并且每次我想这样做时都可以节省我查找构造函数的时间。以上所有内容最好用 C 语言编写，尽管我可以根据需要从 C++ 翻译它。

SO上有没有人可以分享这样的东西？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-27T16:29:00.703

我们只是为我们想要抛出的每种异常类型编写实用方法。这里有些例子：

```
jint throwNoClassDefError( JNIEnv *env, char *message )
{
    jclass exClass;
    char *className = "java/lang/NoClassDefFoundError";

    exClass = (*env)->FindClass( env, className);
    if (exClass == NULL) {
        return throwNoClassDefError( env, className );
    }

    return (*env)->ThrowNew( env, exClass, message );
}

jint throwNoSuchMethodError(
        JNIEnv *env, char *className, char *methodName, char *signature )
{

    jclass exClass;
    char *exClassName = "java/lang/NoSuchMethodError" ;
    LPTSTR msgBuf;
    jint retCode;
    size_t nMallocSize;

    exClass = (*env)->FindClass( env, exClassName );
    if ( exClass == NULL ) {
        return throwNoClassDefError( env, exClassName );
    }

    nMallocSize = strlen(className) 
            + strlen(methodName)
            + strlen(signature) + 8;

    msgBuf = malloc( nMallocSize );
    if ( msgBuf == NULL ) {
        return throwOutOfMemoryError
                ( env, "throwNoSuchMethodError: allocating msgBuf" );
    }
    memset( msgBuf, 0, nMallocSize );

    strcpy( msgBuf, className );
    strcat( msgBuf, "." );
    strcat( msgBuf, methodName );
    strcat( msgBuf, "." );
    strcat( msgBuf, signature );

    retCode = (*env)->ThrowNew( env, exClass, msgBuf );
    free ( msgBuf );
    return retCode;
}

jint throwNoSuchFieldError( JNIEnv *env, char *message )
{
    jclass exClass;
    char *className = "java/lang/NoSuchFieldError" ;

    exClass = (*env)->FindClass( env, className );
    if ( exClass == NULL ) {
        return throwNoClassDefError( env, className );
    }

    return (*env)->ThrowNew( env, exClass, message );
}

jint throwOutOfMemoryError( JNIEnv *env, char *message )
{
    jclass exClass;
    char *className = "java/lang/OutOfMemoryError" ;

    exClass = (*env)->FindClass( env, className );
    if ( exClass == NULL ) {
        return throwNoClassDefError( env, className );
    }

    return (*env)->ThrowNew( env, exClass, message );
} 
```

这样，很容易找到它们，您的代码完成编辑器将帮助您输入它们，并且您可以传递简单的参数。

我相信您可以扩展它以处理链式异常或其他更复杂的方法。这足以满足我们的需求。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2012-03-21T21:01:22.577

我只使用 2 行：

```
 sprintf(exBuffer, "NE%4.4X: Caller can %s %s print", marker, "log", "or");
 (*env)->ThrowNew(env, (*env)->FindClass(env, "java/lang/Exception"), exBuffer); 
```

产生：

```
 Exception in thread "main" java.lang.Exception: NE0042: Caller can log or print. 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-08-31T12:56:22.080

我的代码从 Java 开始，调用 C++，然后再次调用 Java 以执行查找、获取和设置字段值等操作。

如果有人在寻找 C++ 方法找到这个页面，我会继续努力：

我现在正在做的是用 C++ try/catch 块包装我的 JNI 方法体，

```
JNIEXPORT void JNICALL Java_com_pany_jni_JNIClass_something(JNIEnv* env, jobject self)
{
    try
    {
        ... do JNI stuff
        // return something; if not void.
    }
    catch (PendingException e) // (Should be &e perhaps?)
    {
        /* any necessary clean-up */
    }
} 
```

其中 PendingException 被简单地声明：

```
class PendingException {}; 
```

并且我在从 C++ 调用任何 JNI 后调用以下方法，因此如果 Java 异常状态指示错误，我将立即保释并让正常的 Java 异常处理将 (Native method) 行添加到堆栈跟踪，而让 C++ 有机会在展开时进行清理：

```
PendingException PENDING_JNI_EXCEPTION;
void throwIfPendingException(JNIEnv* env)
{
    if (env->ExceptionCheck()) {
        throw PENDING_JNI_EXCEPTION;
    }
} 
```

对于失败的 env->GetFieldId() 调用，我的 Java 堆栈跟踪如下所示：

```
java.lang.NoSuchFieldError: no field with name='opaque' signature='J' in class Lcom/pany/jni/JniClass;
  at com.pany.jni.JniClass.construct(Native Method)
  at com.pany.jni.JniClass.doThing(JniClass.java:169)
  at com.pany.jni.JniClass.access$1(JniClass.java:151)
  at com.pany.jni.JniClass$2.onClick(JniClass.java:129)
  at android.view.View.performClick(View.java:4084) 
```

如果我调用一个抛出的 Java 方法，则非常相似：

```
 java.lang.RuntimeException: YouSuck
  at com.pany.jni.JniClass.fail(JniClass.java:35)
  at com.pany.jni.JniClass.getVersion(Native Method)
  at com.pany.jni.JniClass.doThing(JniClass.java:172) 
```

我不能谈论将 Java 异常包装在 C++ 中的另一个 Java 异常中，我认为这是你问题的一部分——我没有发现需要这样做——但如果我这样做了，我要么这样做围绕本机方法的 Java 级包装器，或者只是扩展我的异常抛出方法以采用 jthrowable 并将 env->ThrowNew() 调用替换为丑陋的东西：不幸的是 Sun 没有提供 ThrowNew 的版本jthrowable。

```
void impendNewJniException(JNIEnv* env, const char *classNameNotSignature, const char *message)
{
    jclass jClass = env->FindClass(classNameNotSignature);
    throwIfPendingException(env);
    env->ThrowNew(jClass, message);
}

void throwNewJniException(JNIEnv* env, const char* classNameNotSignature, const char* message)
{
    impendNewJniException(env, classNameNotSignature, message);
    throwIfPendingException(env);
} 
```

我不会考虑缓存（异常）类构造函数引用，因为异常不应该是通常的控制流机制，所以它们是否很慢并不重要。我想查找无论如何都不会很慢，因为Java大概会为这类事情做自己的缓存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-12-28T16:32:56.280

对于需要像我以前需要的更多解释的人，我将给出一个更完整和更一般的答案。

首先很高兴用 a 设置您的方法，`Throw Exception`这样 IDE 会要求 try/catch。

```
public native int func(Param1, Param2, Param3) throws IOException; 
```

[我](https://stackoverflow.com/a/5899901/3117650)因此决定`IOException`结束。`Exception`

```
JNIEXPORT int JNICALL Java_YourClass_func
(int Param1, int Param2, int Param3) {
    if (Param3 == 0) { //something wrong
        jclass Exception = env->FindClass("java/lang/Exception");
        env->ThrowNew(Exception, "Can't divide by zero."); // Error Message
    }
    return (Param1+Param2)/Param3;
} 
```

# xslt - 节省内存的 XSLT 处理器

> ID：230702
> 
> 赞同：5
> 
> 时间：2008-10-23T17:46:15.220
> 
> 标签：xslt

我需要一个工具来针对**非常大**的XML 文件执行 XSLT。需要明确的是，我不需要任何东西来设计、编辑或调试 XSLT，只需执行它们即可。我正在使用的转换已经得到很好的优化，但是大文件导致我尝试过的工具（Saxon v9.1）内存不足。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T19:24:35.427

我找到了一个很好的解决方案：Apache 的[Xalan C++](http://xml.apache.org/xalan-c/index.html)。它提供了一个[可插入的内存管理器](http://xml.apache.org/xalan-c/programming.html#memory)，允许我根据输入和转换调整分配。

在多种情况下，它消耗的内存（我正在查看私有字节）比我尝试过的其他内存少约 60%。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-24T18:56:30.650

您可能希望研究[STX](http://stx.sourceforge.net/)以进行基于流的 XSLT 类转换。或者，我相信[StAX](http://en.wikipedia.org/wiki/StAX)可以通过 Transformer 接口[很好地与 XSLT 集成。](http://javaboutique.internet.com/tutorials/staxxsl/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T23:34:06.820

听起来您已排序 - 但通常，另一种潜在方法是首先拆分数据。显然，这仅适用于某些转换（即可以将不同的数据块与整体隔离处理） - 但是您可以使用简单的解析器（而不是 DOM）将其拆分为可管理的部分，然后处理每个块分开并重新组装。

由于我是 .NET 开发人员，`XmlReader`因此无需 DOM 就可以进行分块；我确信每种语言都有对应的。

再次 - 只是为了完整性。

[编辑重新问题] 我不知道任何具体名称；也许[分而治之](http://www.cag.lcs.mit.edu/~rinard/divide_and_conquer/)。举个例子；如果您的数据实际上是类似对象的平面列表，那么您可以简单地拆分第一级子级 - 即，您将其拆分为 10 批 200K 行或 100 批 20K 行，而不是 2M 行。在处理批量数据之前，我已经做过很多次了（例如，上传数据块 [所有有效] 并在服务器上重新组装，以便每个单独的上传足够小以保持稳健）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-24T19:06:56.630

对于它的价值，我怀疑对于 Java，如果您需要使用 XSLT，Saxon 会尽可能好。对于较大的文档，它非常有效（cpu 和内存），但是 XSLT 本身本质上强制创建和保留完整的内存中内容树，除了有限的情况。Saxon-SA（收费版）据说有扩展以允许利用这种“流媒体”案例，所以这可能值得一试。

但是拆分内容的建议是最好的：如果您正在处理独立记录，只需使用其他技术拆分输入（例如，使用 Stax！:-)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T17:57:44.167

我发现使用早期版本的 MSXML 构建用于运行 XSLT 的自定义工具使其速度*非常*快，但也会消耗大量内存，并且如果它太大，实际上将无法完成。您还失去了一些高级 XSLT 功能，因为早期版本的 MSXML 不支持完整的 xpath 内容。

如果您的其他选项花费的时间太长，则值得一试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T19:05:27.760

这是一个有趣的问题。XSLT 可能会针对空间进行优化，但我希望除了最晦涩的实现之外，所有的实现都是从将源文档解析为 DOM 开始的，这必然会使用内存中文档大小的低倍数。

除非样式表是专门为支持单次转换而设计的，否则合理的时间性能可能需要将源文档解析为基于磁盘的分层数据库。

不过，我没有答案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-12T15:39:42.543

Saxon 9.2 似乎可以为您的问题提供答案。如果您的文档可以在不使用谓词的情况下进行转换（不引用当前节点的任何同级节点），则您可以使用 Streaming XSLT。看到[这个链接](http://www.w3.org/TR/xslt-21/#streaming-concepts)

我自己没有尝试过，我只是在阅读它。但我希望它有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-24T18:37:13.903

您使用的是 Java 版本的 Saxon 还是 .Net 端口？如果内存不足（使用 -Xms 命令行参数），可以为运行 Saxon 的 Java VM 分配更多内存。

我还发现 Saxon 的 .Net 版本比 Java 版本更不容易耗尽内存。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-05-04T09:21:53.050

对于 .NET，您可以使用 Microsoft 知识库中的解决方案建议：http: [//support.microsoft.com/kb/307494](http://support.microsoft.com/kb/307494)

```
XPathDocument srcDoc = new XPathDocument(srcFile);
XslCompiledTransform myXslTransform = new XslCompiledTransform();
myXslTransform.Load(xslFile);
using (XmlWriter destDoc = XmlWriter.Create(destFile))
{
    myXslTransform.Transform(srcDoc, destDoc);
} 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-10-23T17:51:42.900

看看[Xselerator](http://www.marrowsoft.co.uk/Products.htm)

# language-agnostic - 解释重构

> ID：230706
> 
> 赞同：8
> 
> 时间：2008-10-23T17:46:59.633
> 
> 标签：language-agnostic, refactoring

### 问题

我的问题是如何教授整理和重构代码的方法和重要性？

### 背景

我最近正在为一位同事进行代码审查。他们对久违的同事作品进行了一些修改。在新更改期间，我的同事曾尝试重构项目，但一旦遇到崩溃或其他问题就放弃了（而不是追着兔子往洞里找问题的根源），因此重新实现了问题代码和在此基础上构建更多。这让代码陷入了一堆变通办法和幻数之中，所以我和他们坐下来进行重构。

我试图解释我是如何确定我们可以重构的地方，以及每次重构通常如何突出新领域。例如，有两个变量存储了相同的信息——为什么？我猜想这是解决更大问题的一种解决方法，所以我取出一个变量并把兔子追到洞里，在我们进行的过程中发现了其他问题。这最终导致我们发现了一个问题，即我们多次循环相同的东西。这在很大程度上是由于使用了幻数大小的数组混淆了正在做的事情——修复最初的“双变量”问题导致了这一发现（和其他发现）。

当我和同事一起进行重构之旅时，很明显她并不总是能够理解我们为什么要进行某些更改以及我们如何确保新功能与原始功能相匹配，所以我花时间解释和证明通过与早期版本进行比较并在纸上逐步完成每个更改。我还通过示例解释了如何判断重构选择是否是一个坏主意，何时选择注释而不是代码更改，以及如何选择好的变量名。

我觉得坐在一起做这件事的过程对我自己（我必须了解更多关于如何最好地向他人解释事物）和我的同事（他们必须了解更多我们的代码和我们的编码实践）都是值得的但是，这段经历让我想知道是否有更好的方法来教授重构过程。

### ……最后……

我知道什么需要或不需要重构，以及如何重构它是非常主观的，所以我想避开那个讨论，但我有兴趣了解其他人将如何应对教授这项重要技能的挑战，如果其他人这里有类似的经历以及他们从他们身上学到的东西（无论是作为老师还是学生）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T18:06:25.053

像大多数编程一样，重构技能伴随着实践和经验。认为可以教授它会很好，但它必须被学习——并且在不同环境中可以完成的学习量存在显着差异。

要回答您的问题，您可以以教学方式教授重构方法和良好的设计，这很好。但是，归根结底，你我都知道，只有通过长期的艰苦经验才能达到一定的水平。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T17:50:53.090

我不是 100% 理解您的问题，但我认为您可以参考需要重构的[Code Smell 。它包含很多示例，您可以向其他人展示。](http://martinfowler.com/bliki/CodeSmell.html)

这是应该使用重构的列表（代码异味列表[）](http://wiki.java.net/bin/view/People/SmellsToRefactorings)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T17:59:34.490

如果您还没有阅读过，Martin Fowler 有一本关于该主题的优秀书籍，名为[Refactoring: Improvement the Design of Existing Code](https://rads.stackoverflow.com/amzn/click/com/0201485672)。他详细介绍了如何以及为什么要重构一段特定的代码。

我什至不愿提及它，因为担心有人询问重构时会假定您对这本书的了解，并且您会认为，“呃，我的意思是*除了*Fowler 的书。” 但是，嘿，你去吧。:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T18:00:24.677

你没有提到测试。要“证明”重构不会破坏现有功能，您需要在进行重构之前进行现有测试或编写测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T17:53:06.517

结对编程似乎是我理解这一点的最佳方式。这样，当我们在处理真实的生产代码时，我们都遇到了一些味道不对的代码，我们一起解决了代码重构问题。这对作为司机的良心说做正确的事而不是快速修复，反过来，他们都知道在这个过程中好的代码是什么样的。

重构可以是一门艺术，只需要练习。你做的越多，你就越擅长。继续研究 Martin Fowler 的 Ractoring 书中描述的方法，并使用你的工具（Resharper for Visual Studio 民间）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T18:13:56.350

一种构想重构的简单方法就在名称中——就像你从等式中分解出一个公共变量一样：

```
xy + xz 
```

变成

```
x(y + z) 
```

x 已被分解。重构代码是一回事，因为您要找到重复的代码或逻辑并将其分解。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-23T18:16:27.560

听起来你的方法是一个非常好的方法。在这个过程的最后，你展示了你是如何发现和解决很多问题的。出于教育目的，发明新的更改/增强/修复可能会很有趣。然后，您可以询问您的导师，他们将如何使用旧的新代码库进行更改。希望他们会看到使用重构的代码进行新的更改要容易得多（或者如何进行更多的重构是为假设的更改做准备的最简单方法）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T18:22:33.260

我看到了几种不同的方法，你可以尝试教授重构：

给出类似教科书的例子。这里的一个缺点是您可能有人为或简单化的示例，其中重构有用的原因并不一定像在其他情况下那样突出。

重构现有代码。在这种情况下，您可以使用您要清理的现有遗留代码，或您自己的开发代码，并显示之前和之后的各种位，以查看之后在可读性和易于维护方面有多好。这可能是一个更好的练习，因为这是在某种程度上改进和增强实时代码。

这不是某人可以立即掌握的东西，它需要时间、练习、努力和耐心，因为一些重构可能是出于个人喜好，而不是因为代码以一种或另一种方式以最佳方式运行。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-23T18:23:24.677

教别人在不自然时进行重构是一项艰巨的工作。以我的经验，你最好的选择是在办公室和他们坐下来重构一些代码。当您这样做时，请保持“意识流”对话。谈论你所看到的，为什么代码闻起来不对，重构的选项等等。你还应该确保他们在做同样的事情。最重要的是说明为什么而不是如何更改代码。任何体面的程序员都可以做出改变并让它发挥作用，但是需要技巧和经验才能说明为什么新解决方案比以前的解决方案更好。

# mixed-mode - 混合模式库和 CRT 依赖项 - 帮助

> ID：230715
> 
> 赞同：1
> 
> 时间：2008-10-23T17:49:39.190
> 
> 标签：mixed-mode, dependencies, c++, c#, .net

好吧，在进行了大量研究并尝试了几乎所有我能找到的托管 CPP Redist 以及尝试将我的 DLL 本地复制到应用程序的执行目录之后，我无法弄清楚这个混合模式库缺少哪些依赖项。

基本上我有一个大型 C# 应用程序，我正在尝试使用我制作的混合模式库。在开发机器上它可以完美运行（当然），但是在需要加载库以使用它时部署它，因为缺少 CRT 依赖项（我假设）。

我已经使用依赖遍历器检查所有引用的 DLL，并确保它们存在于部署机器上，但没有运气，我想知道是否可能缺少一些需要注册的依赖项，但我不知道是什么.

当代码尝试从混合模式库中实例化一个类时，出现以下异常。

> 异常详细信息：System.IO.FileLoadException：无法加载文件或程序集“USADSI.MAPI，版本=1.0.3174.25238，文化=中性，PublicKeyToken=null”或其依赖项之一。此应用程序无法启动，因为应用程序配置不正确。重新安装应用程序可能会解决此问题。（来自 HRESULT 的异常：0x800736B1）

我正在使用指定了 /clr:oldSyntax 的 VS2008 SP1 编译库。

中间清单如下所示：

```
<assembly xmlns='urn:schemas-microsoft-com:asm.v1' manifestVersion='1.0'>
  <trustInfo xmlns="urn:schemas-microsoft-com:asm.v3">
    <security>
      <requestedPrivileges>
        <requestedExecutionLevel level='asInvoker' uiAccess='false' />
      </requestedPrivileges>
    </security>
  </trustInfo>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type='win32' name='Microsoft.VC90.CRT' version='9.0.21022.8' processorArchitecture='x86' publicKeyToken='1fc8b3b9a1e18e3b' />
    </dependentAssembly>
  </dependency>
</assembly> 
```

我可以根据需要提供更多信息，不幸的是我并不精通制作混合模式库，所以这让我很失望。

如果有人可以提供任何建议，我将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T19:29:54.793

您是否在目标机器上部署了[CRT 库？](http://www.microsoft.com/downloads/details.aspx?familyid=A5C84275-3B97-4AB7-A40D-3802B2AF5FC2&displaylang=en)远景：由于您依赖于 32 位代码，因此您应该将 Build 属性选项卡中的 Target Platform 设置为 x86。

编辑：使用 Vista 上提供的[Sxstrace.exe 实用程序](http://blogs.msdn.com/junfeng/archive/2006/04/14/576314.aspx)对问题进行并排解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T07:50:16.627

通常，从开发人员维护和整体构建操作的角度来看，我发现[pragma 注释](http://blogs.msdn.com/oldnewthing/archive/2007/05/31/2995284.aspx)样式清单 decleration 更加无错误。XML 清单非常[混乱](http://blogs.msdn.com/vcblog/archive/2008/08/12/bugs-fixed-in-mfc-in-visual-studio-2008-sp1.aspx)。

对链接器的操作方式和 C 代码的常规编译的熟悉程度，以及您只需将其放入您的一个源文件这一事实，让一切都感觉更加“在一起”；

```
#pragma comment(linker, \
    "\"/manifestdependency:type='Win32' "\
    "name='Microsoft.Windows.Common-Controls' "\
    "version='6.0.0.0' "\
    "processorArchitecture='*' "\
    "publicKeyToken='6595b64144ccf1df' "\
    "language='*'\"") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T20:38:38.477

我第一次在目标机器上部署 VS 2005 应用程序时遇到了类似的问题——必须引入 MSVCRT80 DLL。你是说你已经有了 2008 VS 运行时库吗？

ETA：另外，愚蠢的问题，但你确定你有 CRT 运行时（链接到上面）*和*.NET 运行时，与你编译的版本相同（可能是 3.5）？您可能已经知道这一点（尤其是考虑到您的分数），但它们是两件不同的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T20:42:58.360

我找到了一个似乎可行的解决方案，尽管我不太喜欢它。

我不得不复制文件夹：

Microsoft.VC90.CRT & Microsoft.VC90.MFC

来自：Program Files\Microsoft Visual Studio 9.0\VC\redist\x86

进入已部署的应用程序目录，我只是不明白为什么这似乎有效并且可再发行组件什么也没做。

编辑：查看清单我可能不需要复制 MFC 目录

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-03T23:39:14.977

解决此问题的最佳方法是下载免费的进程监视器： [http ://technet.microsoft.com/en-us/sysinternals/bb896645.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

添加一个过滤器以仅监视您的进程，它将向您显示该进程尝试的所有文件访问。这将准确地告诉你它找不到哪个 dll。

当遇到同样的问题时，我总是使用它——如果只有微软在抛出的异常中填写文件名，那一切都会更容易。

# c# - lock(locker) 和 lock(variable_which_I_am_using) 的区别

> ID：230716
> 
> 赞同：32
> 
> 时间：2008-10-23T17:50:11.017
> 
> 标签：c#, .net, multithreading

我正在使用 C# & .NET 3.5。OptionA 和 OptionB 有什么区别？

```
class MyClass
{
    private object m_Locker = new object();
    private Dicionary<string, object> m_Hash = new Dictionary<string, object>();

    public void OptionA()
    {
        lock(m_Locker){ 
          // Do something with the dictionary
        }
    }

    public void OptionB()
    {
        lock(m_Hash){ 
          // Do something with the dictionary
        }
    }       
} 
```

我开始涉足线程（主要是为多线程应用程序创建缓存，不使用 HttpCache 类，因为它没有附加到网站），并且我在很多示例中都看到了 OptionA 语法在线查看，但我不明白通过 OptionB 完成的原因（如果有的话）。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-23T17:59:45.957

选项 B 使用要保护的对象来创建临界区。在某些情况下，这更清楚地传达了意图。如果一致使用，它保证一次只有一个受保护对象的关键部分处于活动状态：

```
lock (m_Hash)
{
    // Across all threads, I can be in one and only one of these two blocks
    // Do something with the dictionary
}
lock (m_Hash)
{
    // Across all threads, I can be in one and only one of these two blocks
    // Do something with the dictionary
} 
```

选项 A 限制较少。它使用辅助对象为要保护的对象创建临界区。如果使用了多个次要对象，则一次可能有多个受保护对象的关键部分处于活动状态。

```
private object m_LockerA = new object();
private object m_LockerB = new object();

lock (m_LockerA)
{
    // It's possible this block is active in one thread
    // while the block below is active in another
    // Do something with the dictionary
}
lock (m_LockerB)
{
    // It's possible this block is active in one thread
    // while the block above is active in another
    // Do something with the dictionary
} 
```

如果您只使用一个次要对象，则选项 A 等效于选项 B。就阅读代码而言，选项 B 的意图更加清晰。如果您要保护多个对象，则选项 B 并不是一个真正的选项。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-23T18:25:32.973

重要的是要了解 lock(m_Hash) 不会*阻止*其他代码使用散列。它只会阻止其他也使用 m_Hash 作为其锁定对象的代码运行。

使用选项 A 的一个原因是因为类可能具有您将在 lock 语句中使用的私有变量。只使用一个对象来锁定对所有对象的访问，而不是尝试使用更细粒度的锁来锁定对您需要的成员的访问，要容易得多。如果您尝试使用更细粒度的方法，在某些情况下您可能需要使用多个锁，然后您需要确保始终以相同的顺序使用它们以避免死锁。

使用选项 A 的另一个原因是，对 m_Hash 的引用可能会在您的类之外访问。也许您有一个公共属性提供对它的访问，或者您将其声明为受保护并且派生类可以使用它。在任何一种情况下，一旦外部代码引用了它，外部代码就有可能将它用于锁定。这也打开了死锁的可能性，因为您无法控制或知道锁的顺序。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-01-19T07:25:32.417

实际上，如果您正在使用它的成员，那么锁定对象并不是一个好主意。Jeffrey Richter 在他的《通过 C# 的 CLR》一书中写道，不能保证您用于同步的一类对象不会`lock(this)`在其实现中使用（这很有趣，但一段时间以来，这是微软推荐的同步方式...然后，他们发现这是一个错误），因此使用特殊的单独对象进行同步总是一个好主意。因此，如您所见，OptionB 不会为您提供死锁保证 - 安全性。因此，OptionA 比 OptionB 更安全。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-23T17:59:45.257

这不是您要“锁定”的内容，而是包含在 lock { ... } 之间的代码，这很重要，并且您正在阻止执行。

如果一个线程在任何对象上取出 lock()，它会阻止其他线程获得同一对象上的锁，从而阻止第二个线程执行大括号之间的代码。

所以这就是为什么大多数人只是创建一个垃圾对象来锁定，它可以防止其他线程获得对同一个垃圾对象的锁定。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-23T18:30:07.410

我认为您“传递”的变量的范围将决定锁的范围。即，一个实例变量将与类的实例有关，而一个静态变量将针对整个 AppDomain。

查看集合的实现（使用反射器），该模式似乎遵循一个名为 SyncRoot 的实例变量被声明并用于与集合实例相关的所有锁定操作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T18:03:22.753

好吧，这取决于您要锁定的内容（使其成为线程安全的）。

通常我会选择 OptionB 来仅提供对 m_Hash 的线程安全访问。作为OptionA，我将用于锁定值类型，它不能与锁一起使用，或者我有一组需要同时锁定的对象，但我不使用什么来锁定整个实例`lock(this)`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T18:08:57.733

锁定您正在使用的对象只是为了方便。外部锁对象*可以*使事情变得更简单，如果共享资源是私有的，也需要使用外部锁对象，例如集合（在这种情况下您使用该`ICollection.SyncRoot`对象）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-21T14:11:53.900

OptionA is the way to go here as long as in all your code, when accessing the m_hash you use the m_Locker to lock on it.

Now Imagine this case. You lock on the object. And that object in one of the functions you call has a `lock(this)` code segment. In this case that is a sure unrecoverable deadlock

# linux - 重定向和vim

> ID：230718
> 
> 赞同：25
> 
> 时间：2008-10-23T17:50:35.523
> 
> 标签：linux, vim

我想知道是否有办法直接在 vim 中查看任何命令的输出，而不是先将其重定向到文件中然后打开该文件。

例如，我需要类似 $ gvim <`diff -r dir1/ dir2/`

这给出了模棱两可的重定向错误消息

我只想直接在 gvim 中查看 dir1 和 dir2 之间的差异。

任何人都可以提供一个不错的技巧吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-23T17:57:24.213

```
diff file1 file2 | vim -R - 
```

这`-R`使它成为只读的，因此您不会意外修改输入（这可能是您想要的行为，也可能不是您想要的行为）。单个破折号告诉`vim`通过标准输入读取其输入。也适用于其他命令。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-23T18:45:55.427

此外，当已经在 Vim 中时：

```
:r! diff file1 file2 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-23T18:12:55.837

`vim -d file1 file2`

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-23T19:30:19.050

尽管我也建议`vimdiff`或`vim -d`查看差异的情况，但我只需要分享这种（更通用的）在管道中使用 vim 的方法：vipe（来自`moreutils`Ubuntu 中的包）。

例如：

> 查找 -name '*.png' | 毒蛇 | xargs rm

将允许您首先编辑（在 vim 中）找到的 .png 文件列表，然后再将其传递给`xargs rm`.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-23T17:53:57.013

jst 使用 gvimdiff
或 vimdiff
将命令的输出直接粘贴到 vim 中，例如 ls，尝试
:%r!ls

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-23T22:22:21.950

顺便说一句，有一个[DirDiff 插件](http://www.vim.org/scripts/script.php?script_id=102)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-02T20:09:33.950

你可以这样做

```
diff -r dir1/ dir2/ | gvim - 
```

vim（或 gvim）的 ' `-`' 选项告诉 vim 打开 STDIN

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-20T15:54:29.283

我经常用`vimdiff -g <file1> <file2>`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-02T21:15:37.353

您正在寻找的是所谓的[过程替换](http://wiki.bash-hackers.org/syntax/expansion/proc_subst)：

`vim <(diff -r dir1/ dir2/)`

但是 Luc 提到的 DirDiff 插件对于比较目录更有用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-12-20T10:57:06.590

最简单方便的方法之一是这样做：

```
vimdiff -R <file1> <file2> 
```

'-R' 标志再次将其打开为只读模式以避免任何意外更改。

# php - 使用 PHP 取消 web 表单提交

> ID：230724
> 
> 赞同：1
> 
> 时间：2008-10-23T17:52:19.060
> 
> 标签：php, html, web-services

我正在使用一个小型网站来尝试上传图片并显示它们。

当有人点击“添加图片”时，他们会被带到一个带有表单的页面。他们可以选择一个文件并单击提交按钮。

但我现在要做的是：在正常确认按钮旁边放一个标有“取消”的第二个提交按钮。如果有人然后选择上传，选择并点击提交，如果他们在文件完全上传之前按下取消按钮，PHP应该停止上传文件并将其删除。然后回到概述。

没有使用任何Javascript。

我只有本地主机，所以测试这是不可能的，因为我只是在按下提交按钮的毫秒内复制一个文件。本地主机没有上传时间，我不会为此购买服务器。

基本上现在发生的事情是 PHP 检测到哪个按钮被发送。如果发送了提交按钮，则上传文件，如果发送了取消按钮，则返回概览。

但是 PHP 会连续完成它的任务。所以我认为这不会奏效。如何告诉 PHP 停止上传？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T17:59:21.730

您无法使用 php 查看按钮 - 在 PHP 获取该信息之前，整个请求都已发送。

您可以做的是将取消按钮放在不同的`<form>`中，如下所示：

```
<form> <input type="file> <input type="submit" value="upload"> </form>
<form> <input type="submit" value="cancel"> </form> 
```

（这当然只是一个例子——缺少一些东西）。

当他们点击取消时，浏览器应该放弃它的请求并开始一个新的请求，取消上传。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-04T09:43:26.503

格雷格的想法是正确的。与其追随大多数人，或者看事情是如何完成的，不如看聪明的替代方案，比如上面格雷格的解释。

如果客户端和服务器之间没有有效的链接，任何上传都无法进行；因此，如果您关闭浏览器窗口，或将其重定向到其他地方，则上传将被终止。

使用 iframe 并将其命名，例如：“myframe”。您可以轻松地将其隐藏在 div 中。有一个带有你的 action="somefile.php" 和 target="myframe" 的表单。将 lil Javascript 添加到表单的“文件”字段：onFocus="uploadlistener()"。你可以为这个函数命名任何你喜欢的名字，但是用它来检查这个人是否“打开”了任何东西。浏览器将自动交换焦点，无论用户是否点击了“浏览”，或者他是否打开了一个文件。不同之处在于，在“选择”文件后，输入字段会再次获得焦点，但请记住您在“onFocus()”事件上有一个侦听器。所以：如果该字段不为空，请调用：document.uploadform.submit()

使用这种方法，您甚至不需要提交按钮。如果你想为“浏览”按钮设置皮肤，只需使用 CSS 使其透明，例如：input name="myfile" type="file" style="width: 40px; -moz-opacity: 0; filter: alpha(opacity =0)" onFocus="somefunction()" 取消上传只需将 iframe 重定向到其他地方，例如： input type="button" value="cancel" onClick="document.uploadform.action='blank.php '; document.uploadform.submit()"

如果上面的 html 跨越多行，请原谅，这是我第一次在这里发布。

要跟踪进度，您需要使用 PHP-5.2 或一些 Perl 脚本添加服务器端侦听器，以检查在开始上传之前检查的总文件大小到目前为止已加载了多少字节。这个检查间隔可以通过一些 AJAX 来实现，或者如果您不知道该术语，请查找：HTTP-REQUEST。这会在后台运行服务器端代码并​​输出一个响应，就像您在浏览器中看到的那样，但在这里您可以将它捕获到一个变量中，然后做您的事情。我希望这对任何人都有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T21:43:25.507

PHP 无法停止正在进行的文件上传。在文件上传完成之前，您的 PHP 代码甚至不会启动，所以当它运行时，为时已晚。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T14:39:56.473

如果确实无法取消上传，您可以考虑实现一个简单易用的撤消或删除功能，以便用户可以立即撤消上传图片（即删除图片）。这在您的实验中可能没有用，但也许您可以在生产应用程序中使用它？

# c# - C# 泛型可以有特定的基类型吗？

> ID：230736
> 
> 赞同：42
> 
> 时间：2008-10-23T17:56:50.330
> 
> 标签：c#, generics

泛型接口的类型是否可以基于特定的父类？

例如：

```
public interface IGenericFace<T : BaseClass>
{
} 
```

显然上面的代码不起作用，但如果它起作用了，我想告诉编译器的是它`T`必须是`BaseClass`. 可以做到吗，是否有计划等？

我认为它对于特定项目很有用，确保在编译时不会将通用接口/类与非预期类型一起使用。或者也对自我文档进行排序：显示预期的类型。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-10-23T17:58:33.620

```
public interface IGenericFace<T> where T : SomeBaseClass 
```

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2008-10-23T18:15:25.350

您所指的是“通用约束”。可以对泛型类型施加许多约束。

一些基本示例如下：

*   `where T: struct`- 类型参数必须是值类型。`Nullable`可以指定除 - 之外的任何值类型。有关更多信息，请参阅[使用 Nullable 类型（C# 编程指南）](http://msdn.microsoft.com/en-us/library/2cf62fcy.aspx)。

*   `where T : class`- 类型参数必须是引用类型；这也适用于任何类、接口、委托或数组类型。

*   `where T : new()`- 类型参数必须有一个公共的无参数构造函数。与其他约束一起使用时，`new()`必须最后指定约束。

*   `where T : <base class name>`- 类型参数必须是或派生自指定的基类。

*   `where T : <interface name>`- 类型参数必须是或实现指定的接口。可以指定多个接口约束。约束接口也可以是通用的。

*   `where T : U`- 提供的类型参数`T`必须是或派生自提供的参数`U`。这称为裸类型约束。

这些也可以像这样链接在一起：

C＃

```
public class TestClass<T> where T : MyBaseClass, INotifyPropertyChanged, new() { }
public interface IGenericFace<T> where T : SomeBaseClass 
```

VB

```
Public Class TestClass(Of T As {MyBaseClass, INotifyPropertyChanged, New})
Public Interface IGenericInterface(Of T As SomeBaseClass) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-23T17:59:27.207

是的。

```
public interface IGenericFace<T>
    where T : BaseClass
{
} 
```

# python - 如何刷新打印函数的输出（取消缓冲 python 输出）？

> ID：230751
> 
> 赞同：1458
> 
> 时间：2008-10-23T17:59:39.063
> 
> 标签：python, python-3.x, printing, flush

如何强制 Python 的`print`函数输出到屏幕？

* * *

## 回答 #1

> 赞同：1716
> 
> 时间：2008-10-23T18:04:59.083

在 Python 3 中，[`print`](https://docs.python.org/library/functions.html#print)可以采用可选`flush`参数：

```
print("Hello, World!", flush=True) 
```

在 Python 2 中你必须做

```
import sys
sys.stdout.flush() 
```

打电话后`print`。默认情况下，[`print`](https://docs.python.org/2/reference/simple_stmts.html#the-print-statement)打印到[`sys.stdout`](https://docs.python.org/2/library/sys.html#sys.stdout)（有关[文件对象](https://docs.python.org/2/library/stdtypes.html#file-objects)的更多信息，请参阅文档）。

* * *

## 回答 #2

> 赞同：396
> 
> 时间：2008-10-23T18:06:49.377

运行`python -h`，我看到一个*命令行选项*：

> -u ：无缓冲的二进制标准输出和标准错误；也 PYTHONUNBUFFERED=x 有关与“-u”相关的内部缓冲的详细信息，请参见手册页

这是[相关文档](http://docs.python.org/using/cmdline.html#cmdoption-u)。

* * *

## 回答 #3

> 赞同：336
> 
> 时间：2014-04-17T20:10:31.917

从 Python 3.3 开始，您可以强制普通`print()`函数刷新，而无需使用`sys.stdout.flush()`; 只需将“flush”关键字参数设置为 true。从[文档中](https://docs.python.org/3.3/library/functions.html#print)：

> **print(*objects, sep=' ', end='\n', file=sys.stdout, flush=False)**
> 
> 将对象打印到流文件中，以 sep 分隔，后跟 end。sep、end 和 file（如果存在）必须作为关键字参数给出。
> 
> 所有非关键字参数都像 str() 一样转换为字符串并写入流，由 sep 分隔，后跟 end。sep 和 end 都必须是字符串；它们也可以是 None，这意味着使用默认值。如果没有给出对象， print() 将只写 end。
> 
> 文件参数必须是一个带有 write(string) 方法的对象；如果它不存在或无，将使用 sys.stdout。**输出是否缓冲通常由文件决定，但如果flush关键字参数为真，则流被强制刷新。**

* * *

## 回答 #4

> 赞同：244
> 
> 时间：2016-02-17T21:01:03.190

> # 如何刷新 Python 打印的输出？

我建议五种方法来做到这一点：

*   在 Python 3 中，调用`print(..., flush=True)`（flush 参数在 Python 2 的 print 函数中不可用，并且 print 语句没有类似物）。
*   调用`file.flush()`输出文件（我们可以包装 python 2 的 print 函数来执行此操作），例如，`sys.stdout`
*   将此应用于模块中具有部分函数的每个打印函数调用，
    `print = partial(print, flush=True)`应用于模块全局。
*   `-u`将其应用于带有传递给解释器命令的标志 () 的进程
*   将此应用于您环境中的每个python进程`PYTHONUNBUFFERED=TRUE`（并取消设置变量以撤消此操作）。

## Python 3.3+

使用 Python 3.3 或更高版本，您可以只提供`flush=True`作为`print`函数的关键字参数：

```
print('foo', flush=True) 
```

## Python 2（或 < 3.3）

他们没有将`flush`参数反向移植到 Python 2.7 因此，如果您使用的是 Python 2（或低于 3.3），并且想要与 2 和 3 兼容的代码，我建议您使用以下兼容性代码。（注意`__future__`导入必须在/非常“靠近[模块顶部](https://docs.python.org/2/reference/simple_stmts.html#future-statements)”）：

```
from __future__ import print_function
import sys

if sys.version_info[:2] < (3, 3):
    old_print = print
    def print(*args, **kwargs):
        flush = kwargs.pop('flush', False)
        old_print(*args, **kwargs)
        if flush:
            file = kwargs.get('file', sys.stdout)
            # Why might file=None? IDK, but it works for print(i, file=None)
            file.flush() if file is not None else sys.stdout.flush() 
```

上面的兼容性代码将涵盖大多数用途，但要进行更彻底的处理，[请参阅`six`模块](https://bitbucket.org/gutworth/six/src/3deee854df8a5f1cc04dd721c18dee2128584f8c/six.py?at=default#six.py-721)。

或者，您可以`file.flush()`在打印后调用，例如，使用 Python 2 中的 print 语句：

```
import sys
print 'delayed output'
sys.stdout.flush() 
```

## 将一个模块中的默认值更改为`flush=True`

您可以通过在模块的全局范围内使用 functools.partial 来更改打印功能的默认值：

```
import functools
print = functools.partial(print, flush=True) 
```

如果您查看我们的新部分函数，​​至少在 Python 3 中：

```
>>> print = functools.partial(print, flush=True)
>>> print
functools.partial(<built-in function print>, flush=True) 
```

我们可以看到它正常工作：

```
>>> print('foo')
foo 
```

我们实际上可以覆盖新的默认值：

```
>>> print('foo', flush=False)
foo 
```

再次注意，这只会更改当前全局范围，因为当前全局范围上的打印名称将遮盖内置`print`函数（或取消引用兼容性函数，如果在 Python 2 中使用，则在当前全局范围内）。

如果您想在函数内部而不是在模块的全局范围内执行此操作，您应该给它一个不同的名称，例如：

```
def foo():
    printf = functools.partial(print, flush=True)
    printf('print stuff like this') 
```

如果你在函数中声明它是全局的，你就是在模块的全局命名空间中改变它，所以你应该把它放在全局命名空间中，除非那个特定的行为正是你想要的。

## 更改进程的默认值

我认为这里最好的选择是使用`-u`标志来获得无缓冲的输出。

```
$ python -u script.py 
```

或者

```
$ python -um package.module 
```

从[文档](https://docs.python.org/2/using/cmdline.html#cmdoption-u)：

> 强制标准输入、标准输出和标准错误完全无缓冲。在重要的系统上，还将标准输入、标准输出和标准错误置于二进制模式。
> 
> 请注意，file.readlines() 和文件对象（用于 sys.stdin 中的行）中有内部缓冲，不受此选项的影响。要解决这个问题，您需要在 while 1: 循环中使用 file.readline()。

## 更改 shell 操作环境的默认值

如果将环境变量设置为非空字符串，则可以为环境中的所有 python 进程或从环境继承的环境获取此行为：

例如，在 Linux 或 OSX 中：

```
$ export PYTHONUNBUFFERED=TRUE 
```

或窗口：

```
C:\SET PYTHONUNBUFFERED=TRUE 
```

来自[文档](https://docs.python.org/2/using/cmdline.html#envvar-PYTHONUNBUFFERED)：

> **Python无缓冲**
> 
> 如果将其设置为非空字符串，则等效于指定 -u 选项。

* * *

## 附录

这是 Python 2.7.12 中有关 print 函数的帮助 - 请注意，*没有* `flush`参数：

```
>>> from __future__ import print_function
>>> help(print)
print(...)
    print(value, ..., sep=' ', end='\n', file=sys.stdout)

    Prints the values to a stream, or to sys.stdout by default.
    Optional keyword arguments:
    file: a file-like object (stream); defaults to the current sys.stdout.
    sep:  string inserted between values, default a space.
    end:  string appended after the last value, default a newline. 
```

* * *

## 回答 #5

> 赞同：70
> 
> 时间：2012-02-27T08:38:27.307

此外，正如[这篇博文中所建议的](http://algorithmicallyrandom.blogspot.com/2009/10/python-tips-and-tricks-flushing-stdout.html)，可以`sys.stdout`在无缓冲模式下重新打开：

```
sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', 0) 
```

之后会自动刷新每个`stdout.write`and操作。`print`

* * *

## 回答 #6

> 赞同：67
> 
> 时间：2015-10-21T17:23:32.100

在 Python 3.x 中，该`print()`功能得到了扩展：

```
print(*objects, sep=' ', end='\n', file=sys.stdout, flush=False) 
```

所以，你可以这样做：

```
print("Visiting toilet", flush=True) 
```

* * *

[Python 文档条目](https://docs.python.org/3.3/library/functions.html?highlight=print#print)

* * *

## 回答 #7

> 赞同：39
> 
> 时间：2008-10-23T19:54:26.740

使用`-u`命令行开关有效，但有点笨拙。这意味着如果用户在没有`-u`选项的情况下调用脚本，程序可能会出现错误的行为。我通常使用 custom `stdout`，如下所示：

```
class flushfile:
  def __init__(self, f):
    self.f = f

  def write(self, x):
    self.f.write(x)
    self.f.flush()

import sys
sys.stdout = flushfile(sys.stdout) 
```

...现在您的所有`print`调用（`sys.stdout`隐式使用）将被自动`flush`编辑。

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2009-04-12T10:57:58.520

使用无缓冲文件：

```
f = open('xyz.log', 'a', 0) 
```

*或者*

```
sys.stdout = open('out.log', 'a', 0) 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2016-05-15T19:13:34.027

在 Python 3 中，您可以使用默认设置覆盖*print函数*`flush = True`

```
def print(*objects, sep=' ', end='\n', file=sys.stdout, flush=True):
    __builtins__.print(*objects, sep=sep, end=end, file=file, flush=flush) 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2008-11-13T22:15:25.260

[丹的想法](https://stackoverflow.com/questions/230751/how-can-i-flush-the-output-of-the-print-function/231216#231216)并不完全奏效：

```
#!/usr/bin/env python
class flushfile(file):
    def __init__(self, f):
        self.f = f
    def write(self, x):
        self.f.write(x)
        self.f.flush()

import sys
sys.stdout = flushfile(sys.stdout)

print "foo" 
```

结果：

```
Traceback (most recent call last):
  File "./passpersist.py", line 12, in <module>
    print "foo"
ValueError: I/O operation on closed file 
```

我认为问题在于它继承自文件类，这实际上是没有必要的。根据 sys.stdout 的文档：

> stdout 和 stderr 不必是内置文件对象：任何对象都是可以接受的，只要它有一个带有字符串参数的 write() 方法。

如此变化

```
class flushfile(file): 
```

到

```
class flushfile(object): 
```

让它工作得很好。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2011-05-19T08:20:36.630

这是我的版本，它也提供了 writelines() 和 fileno()：

```
class FlushFile(object):
    def __init__(self, fd):
        self.fd = fd

    def write(self, x):
        ret = self.fd.write(x)
        self.fd.flush()
        return ret

    def writelines(self, lines):
        ret = self.writelines(lines)
        self.fd.flush()
        return ret

    def flush(self):
        return self.fd.flush

    def close(self):
        return self.fd.close()

    def fileno(self):
        return self.fd.fileno() 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2015-06-06T11:10:54.547

我在 Python 3.4 中这样做了：

```
'''To write to screen in real-time'''
message = lambda x: print(x, flush=True, end="")
message('I am flushing out now...') 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2019-11-07T02:49:50.060

我首先努力理解冲洗选项是如何工作的。我想做一个“加载显示”，这是我找到的解决方案：

```
for i in range(100000):
    print('{:s}\r'.format(''), end='', flush=True)
    print('Loading index: {:d}/100000'.format(i+1), end='') 
```

第一行刷新先前的打印，第二行打印一条新的更新消息。我不知道这里是否存在单行语法。

# asp.net - 控制重用和更新面板

> ID：230755
> 
> 赞同：0
> 
> 时间：2008-10-23T18:00:05.193
> 
> 标签：asp.net

我有一个非常基本的用户控件。它包含几个TextBox 控件、几个DropDownList 控件、一个保存按钮和一个取消按钮。我想在两种不同的模式下使用这个控件。第一种模式是在正常回发模式下执行保存和取消操作。第二种模式将使用 AJAX 来执行保存和取消操作。

是否可以将控件的内容包装在 UpdatePanel 中，然后能够打开/关闭 UpdatePanel 是否为控件事件执行 AJAX 或 PostBack？还是只创建两个新控件（1 个带有 UpdatePanel，1 个不带）来容纳一个旧控件会更好吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T18:06:16.973

在此处查看**刷新 UpdatePanel 内容**部分：[UpdatePanel 类](http://msdn.microsoft.com/en-us/library/system.web.ui.updatepanel.aspx)。

但我个人会做的只是创建没有 UpdatePanel 的 UserControl，然后在需要时将其包含在一个中。不那么混乱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T18:04:41.703

'关闭' UpdatePanel 的最简单方法是在 ScriptManager 中将 EnablePartialRendering 设置为 false。我不确定这是最好的解决方案。我建议您将控件添加到基于布尔标志的代码隐藏 Page_Load 事件处理程序中的更新面板。

```
void Page_Load() {
    if(IsAjaxy) {
     upAnUpdatePanel.Controls.Add(tbSomeTextBox);
    }
    else {
     this.Controls.Add(tbSomeTextBox);
    } 
```

这些方面的东西应该可以正常工作。

# logging - 使用 DB/应用程序服务器日志分析 Web 应用程序使用情况和用户模式？

> ID：230759
> 
> 赞同：2
> 
> 时间：2008-10-23T18:01:36.593
> 
> 标签：logging, analytics

我假设大部分分析和跟踪都是基于从浏览器操作（如页面请求）收集的数据完成的。AWSStats、Google Analytics 和 Omniture 等工具都在其中使用。

但数据库或服务级别日志中也有大量可用数据。例如，基于 GWT 的应用程序可能有点难以分析。或者在金融应用程序客户可能对可疑转账感兴趣的情况下。

所以，请分享您的最佳实践：

*   您为数据库或日志分析实施了哪些方法？
*   您是否使用一些现有的工具或您自己的内部产品？
*   您是否乐于关注使用最多的功能以及处理速度有多快？
*   还是您实际上存储用户操作路径并使用它们来发现异常模式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T20:54:48.880

我知道在 Oracle 中，您可以以 sql 注释的形式输入提示。有优化器会看到注释并尝试使用提示来使 sql 运行得更快或其他各种功能。

当涉及到数据库日志时，如果您尝试记录用户做了什么，您只会降低数据库的性能，因为您现在正在创建更多开销来构建日志文件或表行来存储用户相关信息。

还有其他用于企业数据库的工具，例如 oracle，可以让您查看并发事务，从而在发生减速时帮助您找到瓶颈。

您可以获得的用于分析网络流量的最佳元数据是您上面列出的技术。

当涉及到银行交易以及大量数据的移动和存储时，您为记录用户在您的站点或数据库中的移动方式所做的任何事情都会产生更多的开销。您可以编写代码来检查可疑行为，但最终会以降低性能为代价。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T12:06:07.660

我们的应用程序在内存中保存了已进行的 SQL 调用列表，存储了每个进行调用的类、执行次数、最大执行时间和总执行时间。自服务器启动以来，我们可以访问一个页面以查看信息。

这主要用于性能监控，但我也用于查看特定查询运行了多少次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T21:56:24.120

在工具方面，对于 Windows，您可以使用[MS LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)工具：

基本上将您的平面日志文件变成一个“数据库”，您可以在其上运行类似 SQL 的查询。您甚至可以以表格、图表和图形的形式输出。

# java - 在 Spring 应用程序中从 FreeMarker 获取模板文本

> ID：230763
> 
> 赞同：18
> 
> 时间：2008-10-23T18:02:59.820
> 
> 标签：java, spring, templates, freemarker

在我的 Spring 应用程序中，我想使用 FreeMarker 生成将由我的应用程序发送的电子邮件文本。生成的文本永远不会返回到视图中，因此我不需要配置 FreeMarker 视图解析器。文档似乎表明我应该像这样配置 FreeMarkerConfigurationFactoryBean

```
<bean id="freemarkerConfiguration" class="org.springframework.ui.freemarker.FreeMarkerConfigurationFactoryBean">
   <property name="templateLoaderPath" value="/WEB-INF/freemarker/"/>
</bean> 
```

一旦我配置了这个 bean，我如何实际获取为特定模板生成的文本，以及特定的变量映射。换句话说，后面是什么代码：

```
String templateName = "email"
Map templateVars = new HashMap();
templateVars.put("firstName", "john");
templateVars.put("surname", "doe");    
// Now how do I get the template text? 
```

[Spring 模块](https://springmodules.dev.java.net/)似乎提供了 Spring 和 FreeMarker 之间的替代集成，这使得检索模板文本非常明显，但除非绝对必要，否则我不希望向我的应用程序添加额外的依赖项。

另外，我是否需要向 FreeMarkerConfigurationFactoryBean 添加一些额外的配置以确保模板被缓存？

干杯，唐

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-23T18:23:43.397

像这样的东西应该工作

在您提供的代码之前，初始化：

```
MailSender mailSender = new JavaMailSenderImpl();
SimpleMailMessage message = new SimpleMailMessage(); 
```

然后，在您的代码之后，添加：

```
StringBuffer content = new StringBuffer();
try {
    content.append(FreeMarkerTemplateUtils.processTemplateIntoString(
        configuration.getTemplate(templateName), templateVars));
} catch (IOException e) {
    // handle
} catch (TemplateException e) {
    // handle
}

message.setFrom(getMailFromName() + " <" + getMailFromAddr() + ">");
message.setTo(getMailTo());
if (getCcTo() != null)
    message.setCc(getCcTo());
message.setSubject(getSubject());
message.setText(content.toString());

mailSender.send(message); 
```

这是我的 applicationContext.xml：

```
<bean id="freemarkerMailConfiguration"
  class="org.springframework.ui.freemarker.FreeMarkerConfigurationFactoryBean">
    <property name="templateLoaderPath" value="/WEB-INF" />
</bean>
<bean id="yourEmailServiceClass" class="YourEmailServiceClass">
    <property name="mailSender" ref="mailSender" />
    <property name="freemarkerMailConfiguration" ref="freemarkerMailConfiguration" />
    <property name="freemarkerTemplate" value="email.ftl" />
    <property name="mailFromName" value="John Q. Programmer" />
    <property name="mailFromAddr" value="john.q.programmer@mail.com" />
    <property name="subject" value="Email Subject" />
</bean> 
```

还有你的缓存问题......

我只在'viewResolver' bean 中看到了一个bean 属性'cache'，你说你不会使用它。

另请参阅：[第 14 章。集成视图技术](http://static.springframework.org/spring/docs/2.0.x/reference/view.html)

# sql-server-2005 - 在 sql server 2005 中将 nchar(20) 字段转换为日期时间数据类型

> ID：230788
> 
> 赞同：0
> 
> 时间：2008-10-23T18:11:29.100
> 
> 标签：sql-server-2005

我需要从表中选择并过滤大于指定日期的日期。

我遇到的问题是日期存储为 nchar(20) 并且我似乎无法在 where 子句中将其转换为日期。

```
SELECT CONVERT(DATETIME,log_time,20) from dbo.logs 
where CONVERT(DATETIME,log_time,20) > '10/20/2008' 
```

消息 241，级别 16，状态 1，第 1 行从字符串转换日期时间时转换失败。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T18:24:49.120

这应该有效。

```
select convert(datetime, cast(rtrim(log_time), nvarchar)) from dbo.logs
where convert(datetime, cast(rtrim(log_time), nvarchar)) > '10/20/2008' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T20:45:47.587

我与我们的 SQL Server DBA 进行了交谈。他说问题出在不良数据上。他说在某些日期上午或下午省略了 m。他给我写了一个他为我处理问题的视图，现在我可以从视图中选择，日期也是日期时间数据类型。

感谢大家的帮助。

比利

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T18:29:17.270

消息 1035，级别 15，状态 10，第 1 行“cast”附近的语法不正确，应为“AS”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T20:28:28.097

尝试

从 dbo.logs 中选择转换（日期时间，演员（rtrim（log_time）AS nvarchar））转换（日期时间，演员（rtrim（log_time）AS nvarchar））>'10/20/2008'

或者干脆

从 dbo.logs 中选择 CAST(log_time AS DATETIME) 其中 CAST(log_time AS DATETIME) > '10/20/2008'

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T18:14:55.413

尝试这个：

```
select convert(datetime, cast(trim(log_time), nvarchar)) from dbo.logs
where convert(datetime, cast(trim(log_time), nvarchar)) > '10/20/2008' 
```

我认为诀窍是您需要修剪字符串并转换为 nvarchar

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T18:17:05.517

Msg 195, Level 15, State 10, Line 1 'trim' 不是公认的内置函数名称。

# c++ - 可以在模板类中使用构造函数中的初始化列表吗？

> ID：230790
> 
> 赞同：2
> 
> 时间：2008-10-23T18:11:40.707
> 
> 标签：c++, templates, constructor, initialization

我发现大多数关于 C++ 模板的书籍都没有说明是否可以在模板类的构造函数中使用初始化列表。

例如，我有这样的代码：

```
template <class T>
class Stack {
    T* data;
    std::size_t count;
    std::size_t capacity;
    enum {INIT = 5};
public:
    Stack() {
        count = 0;
        capacity = INIT;
        data = new T [INIT];
    } 
```

我可以将构造函数替换为

```
Stack(): count(0), capacity(INIT), data(new T [INIT]) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T18:15:35.973

是的。编译器是否另有说明？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T18:21:32.467

我刚刚尝试过，VS2008 说没问题，但这似乎有点奇怪，因为一些伟大的作者不这样做（例如，Eckel 在他的“Thinking in C++”中）。

# php - 在 PHP 中获取精确时间

> ID：230792
> 
> 赞同：2
> 
> 时间：2008-10-23T18:12:35.150
> 
> 标签：php, logging, date, timestamp

我注意到，无论给定脚本的执行时间如何，每个 date() 调用都将返回相同的时间戳，而不管脚本中调用函数的位置。看起来它只是返回脚本首次开始执行的时间。

出于日志记录的目的，能够从脚本中获取增量时间戳将非常有用。这可能吗？有没有一种相对轻量级的方法来做到这一点？

**编辑：**[microtime()](http://us.php.net/microtime)函数的示例是否表明它可能会这样做。任何人都可以确认吗？

**更新：** microtime() 确实有效，但我无法使用 date() 函数对其进行格式化，因为 date() 仅接受时间戳作为整数（因此没有微秒）。如何从 microtime() 返回的值中获取格式正确的日期？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T19:04:20.693

我在我的机器上运行了这段代码：

```
<?php
$time_start = time();

sleep(2);

$time_end = time();

print 'Start: ' . date("m/d/Y @ g:i:sA", $time_start) . '<br>';
print 'End: ' . date("m/d/Y @ g:i:sA", $time_end);
?> 
```

它输出：

```
Start: 10/23/2008 @ 3:12:23PM
End: 10/23/2008 @ 3:12:25PM 
```

让我相信`time()`不只是返回执行开始的时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T19:04:35.903

首先，[date()](http://de2.php.net/manual/en/function.date.php)用于格式化时间戳 - 它只是默认行为，它会在`date()`没有第二个参数的情况下调用当前时间戳。使用的时间戳将是调用函数时的时间戳 - 调用`date('Y-m-d')`与调用相同，`date('Y-m-d', time())`其中[time()](http://de2.php.net/manual/en/function.time.php)将为您提供

> [...] 自 Unix 纪元（格林威治标准时间 1970 年 1 月 1 日 00:00:00）以来的秒数测量的当前时间。

每次调用时您只能获得相同的时间戳，`date()`因为您的脚本太快并且在一秒钟内运行，导致没有时间戳更改。

要解决格式化[microtime()](http://de2.php.net/manual/en/function.microtime.php)返回值的第二个问题，您可以执行以下操作（未经测试）

```
function formatTime($microtime, $format)
{
    list($timestamp, $fraction) = explode('.', $microtime);
    return date($format, (int)$timestamp) . '.' . $fraction;
} 
```

给定的值`$microtime`应该是 a `float`，当您将`true`其作为参数传递给`microtime()`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T18:15:41.993

[http://us.php.net/microtime](http://us.php.net/microtime)在同一个脚本中给了我不同的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T18:24:50.820

您可以使用[Pear Benchmarking 包](http://pear.php.net/package/Benchmark)来获取时间和分析信息。

# asp.net - 手动和自动回收应用程序池有什么区别？

> ID：230793
> 
> 赞同：1
> 
> 时间：2008-10-23T18:12:48.333
> 
> 标签：asp.net, iis, application-pool

我注意到您可以通过 IIS 手动回收应用程序池，与更改 App_Code 或 web.config 文件中的文件相比，这样做似乎会大大降低我的 Web 应用程序的速度。这是因为通过 IIS 回收应用程序池不会强制重新编译临时 Internet 文件，而是更改 App_Code 或 web.config 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T18:16:10.480

[是](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/f11b8294-cc42-4e9c-8482-6257bf3b80f2.mspx?mfr=true)的... :)

回收只是重新启动工作进程以消除任何内存泄漏等。更改任何内容都会强制重新编译。

# .net - XP 和 Vista 在桌面上显示什么分辨率的 .ico 文件？

> ID：230795
> 
> 赞同：0
> 
> 时间：2008-10-23T18:13:07.007
> 
> 标签：.net, windows, winforms, windows-xp

.ico 文件有很多选择，但我看不出 Windows 如何选择要显示的分辨率/位深度的任何逻辑

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T18:19:27.463

我捆绑了各种尺寸的图标，这是 XP 和 Vista 可能需要的所有尺寸的结合，具体取决于用户选择的设置：

*   16x16
*   22x22
*   24x24
*   32x32
*   40x40
*   48x48
*   64x64
*   96x96
*   128x128
*   256x256

# sql - 如何确保一列包含一组值中的一个？

> ID：230796
> 
> 赞同：2
> 
> 时间：2008-10-23T18:13:27.397
> 
> 标签：sql, sql-server

我正在创建一个看起来像这样的表。

```
CREATE TABLE packages
(
  productCode char(2)
  , name nvarchar(100) 
  , ...
) 
```

如何确保 productCode 始终是两个值之一`XJ`或`XD`？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-23T18:17:22.350

```
ALTER TABLE packages
ADD CONSTRAINT constraintname CHECK (productCode in ('XJ', 'XD')) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-23T18:18:32.330

要么使其成为查找表的[外键](http://en.wikipedia.org/wiki/Foreign_key)，要么添加[检查约束](http://en.wikipedia.org/wiki/Check_constraint)来强制执行它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T18:20:26.900

```
CREATE TABLE packages
(
  productCode char(2)
  , name nvarchar(100) 
  , ...
  ,CONSTRAINT productCode CHECK (productCode in ('XJ','XD') )
) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T19:27:03.940

在这种情况下，听起来 ProductCode 的值集非常有限，并且您不希望它在可预见的未来增长，所以我倾向于同意 checkconstraint 的答案。但是，在大多数情况下，我会按照格兰特先生的建议实施外键解决方案，因为我的客户有一个讨厌的习惯，即每天大约改变一次想法（以及要求）。在那种情况下，我认为 FK 版本更容易维护。

# html - 什么是好的非所见即所得的 HTML 编辑器？

> ID：230829
> 
> 赞同：3
> 
> 时间：2008-10-23T18:19:41.283
> 
> 标签：html, editor

我不喜欢所见即所得的编辑器，我要负责每个标签和属性的选择和放置！是否有一个好的编辑器可以让您完全控制 HTML，但提供有用的功能，例如：

*   语法高亮（当然）
*   标签、属性等的建议，例如下拉列表
*   验证和可访问性检查
*   预览 HTML

目前我使用带有语法突出显示的 TextPad，但我觉得我可以做得更好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-23T18:29:42.217

我是通用 HTML/CSS/Javascript 编辑的[Aptana](http://www.aptana.com/)的忠实粉丝。基于 Eclipse，但更好的可用性。自动格式化、代码建议（原生支持 jQuery 和 ExtJs）和用于检查您的工作的嵌入式浏览器选项卡。

它也是跨平台的，支持 Windows Mac 和 Linux。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-23T18:32:22.710

我喜欢记事本++；它没有嵌入式预览，但它很轻巧，具有良好的用户界面，可靠的语法高亮...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-23T18:21:36.520

Microsoft Visual Studio 2008 可能适合您的需要（并且有免费下载的“快速”版本）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-23T18:27:18.553

其他人提到了 Visual Studio 和 HTML Kit。您还可以考虑[DreamWeaver](http://www.adobe.com/products/dreamweaver/)或[Microsoft Expression Web](http://www.microsoft.com/expression/products/overview.aspx?key=web)。从技术上讲，这两个（甚至 Visual Studio）都具有 WYSIWYG 模式，但它们还提供拆分源/所见即所得和仅源模式。都有验证、标准检查和全部九项。如果您想要的话，所有这些都允许**完全控制代码**而不会大惊小怪。Expression 和 DreamWeaver 不仅支持 HTML/ASP 语法高亮；两者也都原生支持 PHP。

这是[Visual Web Developer Express 的链接](http://www.microsoft.com/express/vwd/)（Brian 提到的免费 Visual Studio）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-23T18:36:26.383

我真的很喜欢 Mac 上的 Coda [http://www.panic.com/coda/](http://www.panic.com/coda/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-23T18:21:39.953

[HTMLKit](http://www.chami.com/HTML-Kit/)相当不错而且免费。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-23T18:26:14.437

我真的很喜欢 Microsoft Expression Web 2.0 或 Microsoft SharePoint Designer 2007，这取决于我的需要。

具体来说，Microsoft Expression Web 2.0 支持基础开发（HTML、CSS 等），同时包括用于 ASP.NET 和 PHP 的 Intellisense。

Microsoft SharePoint Designer 2007 包括对 SharePoint Services 和 MOSS 的支持。

我听说有人说他们喜欢 Dreamweaver，但我觉得它有点臃肿。我上面提到的两种工具都允许所见即所得的编辑，但它们也支持您列出的所有功能。它们还允许文档类型支持和可访问性验证等。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-23T18:37:06.130

我推荐[Programmer's Notepad](http://pnotepad.org/)用于轻量级代码编辑，但我有偏见:)

公平地说，这些也都有好处： [Notepad++](http://notepad-plus.sourceforge.net/)、 [SciTE](http://www.scintilla.org/)、 [Notepad2](http://www.flos-freeware.ch/notepad2.html)。

但是，这些（包括 PN）都没有您要求的预览等功能。对于这些功能，您需要功能更全面的东西，比如已经推荐的优秀的 Expression Web，甚至可能是 Visual Web Developer。

我还应该指出，已经有大量关于 SO 的编辑讨论：

[https://stackoverflow.com/search?q=html+editor](https://stackoverflow.com/search?q=html+editor)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-07T02:01:20.227

我仍然使用旧版本 (4.0) 的[Homesite](http://www.adobe.com/products/homesite/)，它几乎可以满足我的所有需求。它最初由[Nick Bradbury](http://nick.typepad.com/)编写，并不太重，具有恰到好处的功能集，并且非常受欢迎。

Nick 将 Homesite 卖给了 Allaire，然后被越来越大的鱼吃掉了。但它仍然得到维护，现在作为 Macromedia（现在是 Adob​​e）的基于文本的 HTML 替代品[与 Dreamweaver 一起出售。](http://www.adobe.com/products/homesite/resources/dreamweaver/)

他们为此收取 99 美元。

我会升级的，但他们只有 4.5 版及更高版本的升级价格。很抱歉以下情绪化的评论，但我说软件供应商不应该忽视他们程序的早期采用者。排在第一位的人应该得到特殊和终生的待遇。如果您愿意，他们将成为您最好的客户和软件的最佳代言人。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-07T02:38:53.660

我意识到你在 Windows 上（根据你描述的工具）但是，对于下一个 Mac 人来阅读这个问题：

TextMate 真的不适合编辑各种东西，尤其是东西的集合（如 C、ruby、java、html、perl、bash 等项目）。如果它有 SubEthaEdit 进行协作编辑的能力，它会成为我唯一使用过的编辑器。

[文本伴侣](http://macromates.com)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-23T18:24:03.037

根据您将使用的代码（ASP v. php v. ruby​​ 等），我建议使用 Dreamweaver。它是 WYSIWYG，但您会发现许多最好的编辑器，包括 VS 2008。当然，这并不意味着您必须使用它！我在上一份工作中经常使用 Dreamweaver，它非常适合编辑代码和快速预览。

编辑：我应该提到 Dreamweaver 最适合 html、css、javascript、coldfusion 和 php。这些是我使用过的技术。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-23T18:50:45.213

我真的很喜欢Kate，因为它是一个KPart，其他KDE程序都用它作为编辑器，所以它无处不在！

（为什么其他人都假设您使用 Windows？）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-24T17:46:41.320

您可能想研究[Bluefish](http://bluefish.openoffice.nl/) - 这是我在家中用于 php 的。它对许多语言的语法高亮以及许多其他 HTML 方面的好东西都有很好的支持。

我在这里工作时使用 Eclipse，用于 J2EE 的东西。它为 html/css/etc 提供了一些很棒的工具和语法高亮。

# data-structures - 维基百科的不平衡 AVL 树的例子是如何真正不平衡的？

> ID：230831
> 
> 赞同：10
> 
> 时间：2008-10-23T18:20:08.973
> 
> 标签：data-structures, binary-tree, avl-tree

![替代文字](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/Unbalanced_binary_tree.svg/251px-Unbalanced_binary_tree.svg.png)

上图来自[“维基百科关于 AVL 树的条目”](http://en.wikipedia.org/wiki/AVL_tree)，维基百科指出它是不平衡的。这棵树怎么还不平衡？这是文章的引述：

> 节点的平衡因子是其右子树的高度减去其左子树的高度，平衡因子为 1、0 或 -1 的节点被认为是平衡的。具有任何其他平衡因子的节点被认为是不平衡的，需要重新平衡树。平衡因子要么直接存储在每个节点上，要么根据子树的高度计算。

左子树和右子树的高度均为 4。左树的右子树的高度为 3，但仍然比 4 小 1。有人可以解释我缺少什么吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-23T18:22:00.670

例如，节点 76 是不平衡的，因为它的右子树的高度为 0，而左子树的高度为 3。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-23T18:51:07.273

为了平衡，树中的每个节点都必须，

*   没有孩子，（成为“叶”节点）
*   有两个孩子。
*   或者，如果它只有一个孩子，那么那个孩子一定是一片叶子。

    在您发布的图表中，9、54 和 76 违反了最后一条规则。

适当平衡，树看起来像：

```
Root: 23
(23) -> 14 & 67
(14) -> 12 & 17
(12) -> 9
(17) -> 19
(67) -> 50 & 72
(50) -> 54
(72) -> 76 
```

更新：（将近 9 年后，我在[draw.io](https://www.draw.io/?lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=SO_Balanced_AVL_Tree%20.xml#Uhttps%3A%2F%2Fraw.githubusercontent.com%2Fjamescurran%2FHonestIllusion%2Fmaster%2FSO_Balanced_AVL_Tree%2520.xml)上为图表创建了一个很酷的在线图表）[![在此处输入图像描述](https://i.stack.imgur.com/n6KwW.png)](https://i.stack.imgur.com/n6KwW.png)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T18:22:29.890

直观地说，这是因为它不是越小越好。例如，12 应该是 9 和 14 的父节点。事实上，9 没有左子树，所以它不平衡。树是一种分层数据结构，因此像“平衡”这样的规则通常适用于每个节点，而不仅仅是根节点。

您是正确的，根节点是平衡的，但并非树的所有节点都是平衡的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-04-23T00:00:57.713

另一种看待这一点的方法是，`h`任何节点的高度由下式给出：

`h = 1 + max( left.height, right.height )`

并且节点在以下情况下不平衡：

`abs( left.height - right.height ) > 1`

看上面的树：

```
- Node 12 is a leaf node so its height = 1+max(0,0) = 1
- Node 14 has one child (12, on the left), so its height is = 1+max(1,0) = 2
- Node 9 has one child (14, on the right), so its height is = 1+max(0,2) = 3 
```

要确定节点 9 是否平衡，我们查看其子节点的高度：

```
- 9's left child is NULL, so 9.left.height = 0
- 9's right child (14) has height 2, so 9.right.height = 2 
```

现在求解以显示节点 9 不平衡：

```
9.unbalanced = abs( 9.left.height - 9.right.height ) > 1
9.unbalanced = abs( 0 - 2 ) > 1
9.unbalanced = abs( -2 ) > 1
9.unbalanced = 2 > 1
9.unbalanced = true 
```

可以对每个其他节点进行类似的计算。

# winforms - 如何使用 SaveFileDialog 将字符串生成器的内容保存到文本文件？

> ID：230834
> 
> 赞同：8
> 
> 时间：2008-10-23T18:21:02.857
> 
> 标签：winforms, save

这是一个winforms应用程序。

在 Windows 中，我希望用户单击和按钮，然后弹出窗口应该让用户选择他们想要保存文件的路径。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-23T18:27:42.873

您需要[WriteAllText](http://msdn.microsoft.com/en-us/library/system.io.file.writealltext.aspx)函数。

```
using (SaveFileDialog dialog = new SaveFileDialog()) {
    if (dialog.ShowDialog(this) == DialogResult.OK) {
        File.WriteAllText(dialog.FileName, yourStringBuilder.ToString());
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-23T18:36:01.767

不再想...

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication2 {
public partial class Form1 : Form {

    StringBuilder sb = new StringBuilder();

    public Form1() {
        InitializeComponent();

        sb.Append("This is going ");
        sb.Append("to be saved to a text file");
    }

    private void button1_Click(object sender, EventArgs e) {
        using (SaveFileDialog dlg = new SaveFileDialog()) {
            if (dlg.ShowDialog() == DialogResult.OK) {
                string fileName = dlg.FileName;
                SaveToFile(fileName);
            }
        }
    }

    private void SaveToFile(string fileName) {
        System.IO.TextWriter w = new System.IO.StreamWriter(fileName);
        w.Write(sb.ToString());
        w.Flush();
        w.Close();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T18:26:33.907

`StringBuilder.ToString()`可以`TextStream.Write()`在创建文件后传递给方法。

使用[SaveFileDialog 类](http://msdn.microsoft.com/en-us/library/system.windows.forms.savefiledialog(VS.80).aspx)，您可以让用户以标准方式选择路径和文件名。[文档](http://msdn.microsoft.com/en-us/library/system.windows.forms.filedialog(VS.80).aspx)中的详细示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T18:29:20.547

[StringBuilder.ToString()](http://msdn.microsoft.com/en-us/library/4b1063zt.aspx) 将为您提供字符串。

[此链接](http://msdn.microsoft.com/en-us/library/6ka1wd3w.aspx)将向您展示如何将文本写入文件。

[此链接](http://msdn.microsoft.com/en-us/library/system.windows.forms.savefiledialog.aspx)将向您展示如何调用 SaveFileDialog 并将流传递给它以进行保存。

希望有帮助。

# php - foreach 是否总是在 PHP 中的无引用上创建副本？

> ID：230840
> 
> 赞同：1
> 
> 时间：2008-10-23T18:21:53.837
> 
> 标签：php, optimization, reference, foreach

我想知道 PHP 是否内置了这种优化。通常，当您在不使用引用的情况下调用 foreach 时，它会复制传递的数组并对其进行操作。如果对该数组的引用计数仅为 1 会发生什么？

例如，如果 getData 返回一些数据数组。

```
foreach(getData() as $data)
    echo $data; 
```

由于 getData() 返回的数组只有一个引用，它不应该只是被引用使用而不是先复制还是 php 没有这种优化？

这似乎是一个简单的优化，可以帮助很多写得不好的代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T18:34:18.913

我不能肯定地说，但 PHP 通常使用“写入时复制”，所以在您尝试写入之前，所有内容都是参考，此时会制作副本并写入副本。

# php - 我可以有多个案例做同样的事情吗？

> ID：230842
> 
> 赞同：2
> 
> 时间：2008-10-23T18:22:02.853
> 
> 标签：php, switch-statement

第一个肯定是可行的，但下面哪一个是有效的方法？

```
switch($type) {
    case 1:
        print 'success';
    break;

    case 2:
        print 'success';
    break;

    case 3:
        print 'success';
    break;

    case 4:
        print 'success for type 4';
    break;
} 
```

由于 1、2 和 3 打印的效果相同，我可以这样做吗？

```
switch($type) {
    case 1, 2, 3:
        print 'success';
    break;

    case 4:
        print 'success for type 4';
    break;
} 
```

或者

```
switch($type) {
    case 1:
    case 2:
    case 3:
        print 'success';
    break;

    case 4:
        print 'success for type 4';
    break;
} 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-23T18:24:56.857

```
 switch($type) 
 {
     case 1:
     case 2:
     case 3:
         print 'success';
     break;
     case 4:
         print 'success for type 4';
     break;
 } 
```

是要走的路！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T18:24:58.760

PHP手册列出了一个示例，例如您的第三个 for [switch](http://us3.php.net/manual/en/control-structures.switch.php)：

```
<?php
switch ($i) {
case 0:
case 1:
case 2:
    echo "i is less than 3 but not negative";
    break;
case 3:
    echo "i is 3";
}
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T21:44:56.127

我同意其他人对以下用途的看法：

```
switch ($i) {
   case 0: //drop
   case 1: //drop
   case 2: //drop
      echo "i is 0, 1, or 2";
   break;
   // or you can line them up like this.
   case 3: case 4: case 5:
      echo "i is 3, 4 or 5";
   break;
} 
```

我要添加的唯一内容是多行删除 case 语句的注释，这样当您（或其他人）在最初编写代码后查看代码时，您就知道这不是错误。

# python - 运行 csh 脚本时让 python 输入密码

> ID：230845
> 
> 赞同：5
> 
> 时间：2008-10-23T18:22:33.867
> 
> 标签：python, scripting, passwords, root, csh

我正在编写一个在 Solaris 10 中执行 csh 脚本的 python 脚本。csh 脚本提示用户输入 root 密码（我知道），但我不确定如何让 python 脚本用密码回答提示。这可能吗？这是我用来执行 csh 脚本的内容：

```
import commands

commands.getoutput('server stop') 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-23T18:58:34.357

看看[pexpect](http://www.noah.org/wiki/Pexpect)模块。它旨在处理交互式程序，这似乎是您的情况。

哦，请记住，在 shell 或 python 脚本中硬编码 root 的密码可能是一个安全漏洞：D

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-23T18:25:33.597

使用[子进程](http://www.python.org/doc/2.5.2/lib/module-subprocess.html)。调用 Popen() 来创建您的进程并使用communicate() 向它发送文本。对不起，忘了包括管道..

```
from subprocess import Popen, PIPE

proc = Popen(['server', 'stop'], stdin=PIPE)

proc.communicate('password') 
```

您最好避免使用密码并尝试像 sudo 和 sudoers 这样的方案。在别处提到的 Pexpect 不是标准库的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T19:58:36.107

```
import pexpect
child = pexpect.spawn('server stop')
child.expect_exact('Password:')

child.sendline('password')

print "Stopping the servers..."

index = child.expect_exact(['Server processes successfully stopped.', 'Server is not running...'], 60)
child.expect(pexpect.EOF) 
```

成功了！期待规则！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T21:24:48.800

`input=`为喜欢使用标准库的人添加`proc.communicate()`让它运行。

```
from subprocess import Popen, PIPE
proc = Popen(['server', 'stop'], stdin=PIPE)
proc.communicate(input='password') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T18:24:49.340

应该可以将其作为参数传递。就像是：

```
commands.getoutput('server stop -p password') 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T18:57:21.177

这似乎效果更好：

```
import popen2

(stdout, stdin) = popen2.popen2('server stop')

stdin.write("password") 
```

但这还不是 100%。即使“密码”是正确的密码，我仍然得到 su: 对不起，当它试图 su 到 root 时，从 csh 脚本返回。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T16:39:21.160

为避免在 python 脚本中回答密码问题，我将以 root 身份运行脚本。这个问题仍然没有答案，但我想我现在就这样做。

# vb.net - 在 VB.Net 中将 byte() 数组转换为 double

> ID：230869
> 
> 赞同：1
> 
> 时间：2008-10-23T18:26:57.573
> 
> 标签：vb.net, arrays, double, decimal, byte

我有这种情况。我有一个真实的存储在 sql 2005 数据库的 varbinary 字段中。由于我无法在 sql 2005 中将 varbinary 转换为实数，因此我正在尝试在 vb.net 中执行此操作。

该字段作为 byte() 数组存储在 DataTable 中。

现在我想将该 byte() 读入一个双精度或十进制变量。但我对如何做到这一点没有太多线索......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T20:03:51.790

这实际上取决于它的存储方式，但[BitConverter.ToDouble](http://msdn.microsoft.com/en-us/library/system.bitconverter.todouble.aspx)可能是您的朋友。假设它是 IEE754 格式。您首先从哪里获取数据？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T20:09:49.703

我不太了解 VB.net，但知道 .NET 库。

将 byte[] 包装在 MemoryStream 中并将其包装在 BinaryReader 中。然后使用 BinaryReader.ReadDouble() 方法。有关 MSDN 页面，请参见[此处](http://msdn.microsoft.com/en-us/library/system.io.memorystream.aspx)和[此处](http://msdn.microsoft.com/en-us/library/system.io.binaryreader.aspx)。

**[对此](https://stackoverflow.com/questions/230869/converting-a-byte-array-to-a-double-in-vb-net#240587)进行编辑**

您正在寻找如下所示的一段代码：

```
'declare a test array
Dim testArray As Byte() = {0, 0, 0, 0}
'wrap it into a memory stream
Dim memStream As MemoryStream = new MemoryStream(testArray)
'wrap the stream in a binary reader
Dim bReader As BinaryReader = new BinaryReader(memStream)
'read a 32bit integer from the stream using the reader
Dim count As Integer = bReader.ReadInt32() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T11:43:19.733

```
Public Function GetDateFromBytes(ByRef value() As Byte, _
                                    ByRef startindex As Int32) As Date
    'create a aray of Ints
    Dim IntValues() As Int32 = {BitConverter.ToInt32(value, startindex), _
                                    BitConverter.ToInt32(value, (startindex + 7)), _
                                    BitConverter.ToInt32(value, startindex + 15), _
                                     BitConverter.ToInt32(value, startindex + 31)}

    Return Date.FromBinary(New Decimal(IntValues))

End Function 
```

# visual-studio-2005 - 调用 gacutil 的 Visual Studio 构建后脚本错误

> ID：230872
> 
> 赞同：0
> 
> 时间：2008-10-23T18:27:35.090
> 
> 标签：visual-studio-2005, gacutil, build-script

我在 vista 上，VS2005 以管理员身份运行。vs2005 和 vs2008 都安装了。如果我明确使用 gacutil 的路径，它可以工作，但如果我只像这样调用 gacutil 则不行：

```
if NOT $(ConfigurationName) == Release gacutil /f /i "$(TargetPath)" 
```

我只想更新构建后的脚本，但我被要求不要管它。这是一个姐妹公司的项目。gacutil 的路径在 Visual Studio 环境变量中，所以它应该能够找到它。（工具 -> 选项 -> 项目和解决方案 -> VC++ 目录）

是否有某种方法可以调整 Visual Studio 或 Windows 环境变量以使上述构建后脚本正常工作？我需要它来构建，因为它是我需要编码的项目的依赖项。

TIA，-j

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T19:19:26.187

正如您所建议的，调整 Windows PATH 环境变量应该可以正常工作。将包含 GACUTIL 的目录附加到 PATH 的末尾。例如，使用我计算机上的位置，将（不带引号）“;C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin”附加到 PATH 系统环境变量的现有值。重新启动 Visual Studio 以获取新值。

戴夫

# actionscript - 你如何告诉 ScrollPane 使用 actionscript 向上或向下滚动？

> ID：230885
> 
> 赞同：0
> 
> 时间：2008-10-23T18:30:42.977
> 
> 标签：actionscript, scrollpane

我想触发一个导致 ScrollPane 开始向上或向下滚动的事件。

理想情况下，ScrollPane 将滚动继续向上或向下滚动，除非被另一个事件取消。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-04T09:55:46.243

会是这样的：

```
this.createClassObject(mx.containers.ScrollPane, "my_sp", 10);
my_sp.setSize(360, 280);
this.createEmptyMovieClip("button_up",this.getNextHighestDepth());
this.createEmptyMovieClip("button_down",this.getNextHighestDepth());
this.createEmptyMovieClip("button_left",this.getNextHighestDepth());
this.createEmptyMovieClip("button_right",this.getNextHighestDepth());

button_up.onPress=function(){
     my_sp.onEnterFrame=function(){
          this.vPosition -= 5;
     }
}

button_down.onPress=function(){
     my_sp.onEnterFrame=function(){
          this.vPosition += 5;
     }
}
button_left.onPress=function(){
     my_sp.onEnterFrame=function(){
          this.hPosition -= 5;
     }
}

button_right.onPress=function(){
     my_sp.onEnterFrame=function(){
          this.hPosition += 5;
     }
}

//replace this with whatever event you want to use to make the scrolling stop
button_right.onRollOut = button_left.onRollOut = button_up.onRollOut = button_down.onRollOut = function(){
      my_sp.onEnterFrame=undefined;
} 
```

您必须检查 _hmax 和 _vmax 以确保您不会滚动到内容的末尾，滚动条会自然停止。我不记得这些变量的名称是什么，但是如果您在调试模式下运行程序并浏览滚动窗格实例，您应该会找到它。如果您将内置滚动条移到底部并查看哪些变量发生了变化，然后找到匹配且是静态的，这可能会更容易。

# coding-style - 这种奇特的格式有什么好处？

> ID：230886
> 
> 赞同：5
> 
> 时间：2008-10-23T18:31:31.633
> 
> 标签：coding-style

我已经在一些 C++ 代码中看到了这种用于逗号分隔列表的格式（尽管这可能适用于任何语言）：

```
void function(  int a
              , int b
              , int c
             ) 
```

我想知道为什么有人会在更常见的格式上使用它，例如：

```
void function (int a,
               int b,
               int c
              ) 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-23T18:41:33.830

这是编写 SQL 语句时非常常见的编码风格：

```
SELECT field1
     , field2
     , field3
--   , field4
     , field5
FROM tablename 
```

好处：

*   让您轻松添加、删除或重新排列字段，而不必担心最后的尾随逗号。
*   让您可以轻松地注释掉一行（TSQL 使用“--”），而不会弄乱语句的其余部分。

我认为您不会像在 SQL 中那样频繁地重新排列函数中的参数顺序，所以这可能只是某人的习惯。

评论其中一个的能力将取决于所使用的特定语言。不确定C++。我知道 VB.Net 不允许这样做，但那是因为它需要一个连续字符 ( _ ) 来跨行拆分语句。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-23T18:33:50.273

通过复制前一个参数（行）开始，在末尾添加参数更容易。

当您确定第一个参数永远不会改变时才有意义，这通常是这种情况。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T18:34:50.457

恶意？

说真的，有时很难解释格式化样式。这在很大程度上是个人品味的问题。就个人而言，我认为这*两种*形式都有点讨厌，除非你在行长方面受到严重限制。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T18:43:43.483

另一个优点是，在第一个示例中，您可以注释掉 B 或 C 行，并且它将保持语法正确。在第二个示例中，如果您尝试注释掉 C 行，则会出现语法错误。

如果你问我，真的不值得把它弄得那么丑。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T18:34:26.807

我会看到的唯一好处是，当您添加参数时，您只需复制并粘贴最后一行，为您节省编辑逗号位置等额外的几个键击。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T18:35:21.300

在我看来，这是个人选择。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-23T18:37:13.683

快速扫描文件时，很明显以逗号开头的每一行都是它上面一行的延续（与比上面一行缩进更远的行相比）。它是以下风格的概括：

```
std::cout << "some info "
    << "some more info " << 4
    + 5 << std::endl; 
```

（请注意，在这种情况下，分解 4 + 5 是愚蠢的，但如果你有一个复杂的数学语句，它可能是必要的）。

我经常使用它，尤其是在处理 if、for 和 while 语句等条件时。因为单行条件句省略花括号也很常见。

```
 std::vector<int> v = ...;
 std::vector<int> w = ...;
 for (std::vector<int>::iterator i = v.begin()
       , std::vector<int>::iterator j = w.begin()
       ; i != v.end() && j != w.end()
       ; ++i, ++j)
           std::cout << *i + *j << std::endl; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T18:42:14.843

没有理由，我怀疑这只是个人喜好的问题。

我个人更喜欢第二种。

```
void function (int a,
               int b,
               int c
              ) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-23T18:43:46.273

> 我会看到的唯一好处是，当您添加参数时，您只需复制并粘贴最后一行，为您节省编辑逗号位置等额外的几个键击。

如果您要删除最后一个参数，情况也是如此。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-23T20:18:53.803

当您将另一个字段添加到末尾时，您添加的单行包含新的逗号，产生单行添加的差异，使得在将来查看更改日志时更容易查看更改的内容。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-26T12:19:31.860

似乎大多数答案都围绕着轻松注释或添加新参数的能力。但是，将逗号放在行尾而不是开头似乎可以获得相同的效果：

```
function(
          int a,
          int b,
//          int c,
          int d
        ) 
```

你可能会说你不能对最后一个参数这样做，你是对的，但是对于另一种形式，你不能对第一个参数这样做：

```
function (
//             int a
           , int b
           , int c
           , int d
          ) 
```

因此，权衡是能够注释掉第一个参数与能够注释掉最后一个参数 + 能够添加新参数而不在前一个最后一个参数中添加逗号。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-23T18:34:51.177

我知道当我将 and 包装在 sql 或 if 语句中时，我会尝试确保 and 是下一行的开头。

如果 A 和 B
和 C

我认为这清楚地表明 C 仍然是 if 的一部分。您显示的第一种格式可能就是这样。但与大多数风格问题一样，简单的问题是，如果团队决定采用一种风格，那么就应该坚持下去。

# c# - ASP.NET 2.0 中的成员资格和角色提供程序与非 SQL Server 提供程序？

> ID：230892
> 
> 赞同：0
> 
> 时间：2008-10-23T18:33:45.700
> 
> 标签：c#, .net, asp.net, .net-2.0

我已经快速阅读（并且很快会更仔细地阅读）Scott Allen 关于使用默认 SQL Express 或 SQL Server 数据库的其他提供程序来使用ASP.NET的“[成员资格和角色提供程序”的可能性的文章。](http://weblogs.asp.net/scottgu/archive/2006/02/24/ASP.NET-2.0-Membership_2C00_-Roles_2C00_-Forms-Authentication_2C00_-and-Security-Resources-.aspx)

我们很快需要通过网络向一些客户开放我们项目的一部分，我考虑使用“[成员资格和角色提供者](http://weblogs.asp.net/scottgu/archive/2006/02/24/ASP.NET-2.0-Membership_2C00_-Roles_2C00_-Forms-Authentication_2C00_-and-Security-Resources-.aspx)”，但我们的数据库是 PostGreSql。

是否有人对“[成员资格和角色提供程序](http://weblogs.asp.net/scottgu/archive/2006/02/24/ASP.NET-2.0-Membership_2C00_-Roles_2C00_-Forms-Authentication_2C00_-and-Security-Resources-.aspx)以及其他数据库类型（不是 SQL Server）有一些经验？值得还是很痛苦？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T18:37:49.470

它实际上相当简单。它基本上只是一个带有少数需要实现的方法的接口，并且大多数方法都相当简单。

我在 MSSQL 中实现了一个，但使用来自另一个应用程序的现有成员数据库。您可以在[http://www.codeplex.com/SnitzMember找到它](http://www.codeplex.com/SnitzMember)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T18:59:28.800

我在 MySQL 上试了一下，发现这是不可能的。这可能归因于我的技能相对较低，以及我在 2.0 发布后大约 5 个月完成的事实。自己编写简单的安全系统是不是太过分了？

有一个备用会员提供商： http: [//www.codeplex.com/SnitzMember](http://www.codeplex.com/SnitzMember)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T10:58:56.343

您应该能够轻松编写使用 PostgreSQL 作为数据存储的自定义成员资格提供程序

1.  创建一个继承自 MembershipProvider 的类（例如 PostgreSqlMembershipProvider）
2.  使用 System.Data.Odbc 中的类实现方法和属性，或者使用 Npgsql ( [http://pgfoundry.org/projects/npgsql](http://pgfoundry.org/projects/npgsql) )

# mysql - 将平面文件加载到规范化的 MySQL 数据库中

> ID：230893
> 
> 赞同：4
> 
> 时间：2008-10-23T18:33:48.743
> 
> 标签：mysql, performance, normalization, load-data-infile

将数据从平面文件加载到 MySQL 数据库中，然后通过外键创建表之间关系的最快方法是什么？

例如......我有一个格式为：

```
[INDIVIDUAL]   [POP]  [MARKER]  [GENOTYPE]

"INDIVIDUAL1", "CEU", "rs55555","AA"  
"INDIVIDUAL1", "CEU", "rs535454","GA"  
"INDIVIDUAL1", "CEU", "rs555566","AT"  
"INDIVIDUAL1", "CEU", "rs12345","TT"  
...  
"INDIVIDUAL2", "JPT", "rs55555","AT" 
```

我需要将其加载到四个表中：

```
IND (id,fk_pop,name)  
POP (id,population)  
MARKER (id,rsid)  
GENOTYPE (id,fk_ind,fk_rsid,call) 
```

具体来说，如何以一种可扩展的方式填充外键？这些数字在 1000 多个人的范围内，每个人都有 100 万多个基因型。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-23T18:36:36.587

我会采取多步骤的方法来做到这一点。

1.  将数据加载到与您拥有的文件格式匹配的临时表中
2.  编写查询以执行其他插入，启动通用表，然后执行连接以获取 FK 值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T03:05:15.700

有一个更简单的方法。

首先，确保您对那些应该有一个（名称、人口、rsid）的列有一个唯一约束。

然后使用类似下面的东西：

```
 LOAD DATA INFILE 'data.txt' IGNORE INTO TABLE POP FIELDS TERMINATED BY ','
    ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES 
    (@name, population, @rsid, @call);
 LOAD DATA INFILE 'data.txt' IGNORE INTO TABLE MARKER FIELDS TERMINATED BY ',' 
    ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES 
    (@name, @population, rsid, @call);
 LOAD DATA INFILE 'data.txt' IGNORE INTO TABLE IND FIELDS TERMINATED BY ',' 
    ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES 
    (name, @population, @rsid, @call) 
    SET fk_pop = (SELECT id FROM POP WHERE population = @population);
 LOAD DATA INFILE 'data.txt' IGNORE INTO TABLE GENOTYPE FIELDS TERMINATED BY ',' 
    ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES 
    (@name, @population, @rsid, call)
    SET fk_ind = (SELECT id FROM IND where name = @name),
    fk_rsid = (SELECT id FROM MARKER where rsid = @rsid); 
```

请注意 @ 用于指示变量而不是列名的位置。在前 2 个 LOAD DATA 中，这些仅用于忽略数据。在第二个 2 中，它们用于查找外键。

可能不是很快，请注意:)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-01T08:56:12.653

您可以从没有外键的基表开始。然后，您将在其他表中插入数据时查找 ID。

另一个想法是您可以用 GUIDs 替换平面文件（INDIVIDUAL1，CEU，...等）中的 ID。然后直接将它们用作 ID 和外键（我注意到这是标记的性能，这可能不会提供最佳的“性能”）。

# python - 给定 Python 中的变量名列表，我如何创建一个以变量名作为键的字典（到变量的值）？

> ID：230896
> 
> 赞同：16
> 
> 时间：2008-10-23T18:33:51.893
> 
> 标签：python, list, dictionary

我有一个变量名列表，如下所示：

```
['foo', 'bar', 'baz'] 
```

（我最初问我如何转换变量列表。请参阅下面的 Greg Hewgill 的回答。）

如何将其转换为字典，其中键是变量名（作为字符串），值是变量的值？

```
{'foo': foo, 'bar': bar, 'baz': baz} 
```

现在我重新提出这个问题，我想出了：

```
d = {}
for name in list_of_variable_names:
    d[name] = eval(name) 
```

可以改进吗？

**更新**，回答我为什么要这样做的问题（在评论中）：

我经常发现自己使用 % 运算符对带有名称和值字典的字符串进行插值。通常字符串中的名称只是局部变量的名称。所以（下面的答案）我可以做这样的事情：

```
message = '''Name: %(name)s
ZIP: %(zip)s

Dear %(name)s,
...''' % dict((x, locals()[x]) for x in ['name', 'zip']) 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-23T20:29:33.377

忘记过滤`locals()`！您提供给格式化字符串的字典允许包含未使用的键：

```
>>> name = 'foo'
>>> zip = 123
>>> unused = 'whoops!'
>>> locals()
{'name': 'foo', 'zip': 123, ... 'unused': 'whoops!', ...}
>>> '%(name)s %(zip)i' % locals()
'foo 123' 
```

使用Python 3.6 中的新[f-string 功能](https://www.python.org/dev/peps/pep-0498/)`locals()`，不再需要 using：

```
>>> name = 'foo'
>>> zip = 123
>>> unused = 'whoops!'
>>> f'{zip: >5} {name.upper()}'
'  123 FOO' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-23T18:49:48.057

您可以使用列表或生成器推导来构建用于直接实例化 dict 的键、值元组的列表。最好的方法如下：

```
dict((name, eval(name)) for name in list_of_variable_names) 
```

此外，例如，如果您知道变量存在于本地符号表中，您可以通过直接从本地查看变量来避免危险的 eval：

```
dict((name, locals()[name]) for name in list_of_variable_names) 
```

在您最终更新之后，我认为下面的答案确实是您想要的。如果您只是将它用于使用您控制的字符串进行字符串扩展，只需将 locals() 直接传递给字符串扩展，它就会挑选出所需的值

但是，如果这些字符串可能来自外部源（例如翻译文件），那么过滤 locals() 是个好主意

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-23T18:35:35.370

您的原始列表`[foo, bar, baz]`不包含变量*名称*，它只包含引用与您列出的变量相同的*值的元素。*这是因为您可以有两个不同的变量名称来引用相同的值。

因此，列表本身不包含有关其他名称引用对象的信息。数组中的第一个元素具有名称`foo`，但它也具有名称`a[0]`（假设您的数组称为`a`）。执行以下代码后，`quux`也引用同一个对象：

```
quux = a[0] 
```

更新：您可以使用`eval()`它是对的，但通常不鼓励使用它。Python 提供了一个名为的特殊成员[`__dict__`](http://www.python.org/doc/1.5.2p2/lib/typesother.html)，其中包含当前模块的符号表。这样你就可以：

```
import __main__
d = dict((x, __main__.__dict__[x]) for x in list_of_variable_names) 
```

`import __main__`当您的代码位于未命名的主模块中时，必须这样做是 Python 的一个怪癖。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T18:54:33.553

效率不高，但没有调用`eval`：

```
dict((k,v) for (k,v) in globals().iteritems() if k in list_of_variable_names) 
```

或者

```
dict((k,v) for (k,v) in vars().iteritems() if k in list_of_variable_names) 
```

取决于你想要什么。

# visual-studio-2008 - VS2008项目中的System.Web.UI.WebControls.WebControl

> ID：230919
> 
> 赞同：0
> 
> 时间：2008-10-23T18:38:15.647
> 
> 标签：visual-studio-2008, web-controls

我在 VS2008 中创建了一个网站项目，并在 appcode 文件夹中创建了一个派生自 System.Web.UI.WebControls.WebControl 的类。我需要在我的一个网络表单中使用此控件。我不知道该怎么做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-23T18:48:46.887

看看这个例子：[创建和使用用户控制库](http://webproject.scottgu.com/VisualBasic/UserControls/UserControls.aspx)

你想要完成的是：

![从 Scott Gu 的网站调整图像大小以适合 StackOverflow.comt](https://i488.photobucket.com/albums/rr249/djfloetic/step11-1.png)

您有一个 Register 指令来提供指向控件的 ascx 源页面的链接，并提供 TagPrefix 和 TagName 来引用页面中的控件。此外，您还可以设置为用户控件提供的任何属性（如果有）。

如果这只是您想从程序集中引用的用户控件，请查看此链接：[为 .NET 程序集提供强名称](http://www.codeguru.com/columns/experts/article.php/c4643)

# winforms - 生成要导入 Excel 的 CSV 文件，我应该使用什么换行符？

> ID：230921
> 
> 赞同：0
> 
> 时间：2008-10-23T18:40:15.347
> 
> 标签：winforms, csv

在 winforms 应用程序中创建 CSV 文件，将其导入 Excel。

文件输出如下所示：

“标头 1”、“标头 2”、“标头 3”、1、2、3、4、5、6

**生成 CSV 文件时应该使用什么来表示换行符？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T18:42:51.020

我建议使用[Environment.NewLine](http://msdn.microsoft.com/en-us/library/system.environment.newline.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T18:48:57.793

[RFC 4108](http://www.rfc-editor.org/rfc/rfc4180.txt)

> 虽然 CSV 格式有各种规范和实现（例如 [4]、[5]、[6] 和 [7]），但没有正式的规范存在，它允许对 CSV 进行多种解释文件。本节记录了大多数实现似乎遵循的格式：
> 
> 1.  每条记录位于单独的行上，由换行符 (CRLF) 分隔。例如：
>     
>     
>     
>     aaa,bbb,ccc CRLF
>     zzz,yyy,xxx CRLF

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T18:41:38.837

使用 \r\n 虽然它只适用于 \n

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-23T18:42:55.543

我通常坚持使用“\n”——因为它对于使用它的平台来说是“正确的”。

# .net - 以编程方式检索 xml 文档注释

> ID：230925
> 
> 赞同：3
> 
> 时间：2008-10-23T18:41:59.257
> 
> 标签：.net, xml, documentation

Visual Studio 做到了；反射器做到了；现在我也想要:)

我想检索某些框架程序集中的某些成员的 XML 文档（即`mscorlib.dll`，`System.dll`等）。我认为这将涉及：

*   查找程序集的 XML 文件，
*   导航到适当命名的子元素，以及
*   检索所需的项目 ( `<summary>`, `<remarks>`, 等)

框架程序集的 XML 文件保存在哪里？关于破译 XMLDOC 命名方案的任何要点？是否有任何图书馆可以使这个过程更容易？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-23T19:03:19.013

**查找 xml**

对于 assembly.dll，它被命名为 assembly.xml，但由 Framework SDK 安装，运行时本身不包含 .xml 文件。用户不需要 API 文档。

位置有点复杂。它可以与 dll 并排放置在以当前语言环境命名的子目录中（例如 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\en），甚至在附近一些奇怪的目录中。我建议以运行时查找附属程序集的方式搜索它。

**查找元素**

要查找元素，您应该从元数据中准备所谓的“xml-doc ID”。AFAIR 它记录在 C# 语言规范中，并在 MSDN 中有所记录。请参阅[处理 XML 文档](http://msdn.microsoft.com/en-us/library/fsbx0t7x.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T14:18:24.587

根据[伊利亚的回应](https://stackoverflow.com/questions/230925/retrieve-xml-doc-comments-programmatically#231005)：

**查找 xml**

[.NET 后备位置](http://msdn.microsoft.com/en-us/library/sb6a8618.aspx#cpconpackagingdeployingresourcesanchor1)（忽略 GAC 和其他不相关的子目录）

```
static FileInfo GetXmlDocFile( Assembly assembly ) {
  string assemblyDirPath = Path.GetDirectoryName( assembly.Location );
  string fileName = Path.GetFileNameWithoutExtension( assembly.Location ) +".xml";

  return GetFallbackDirectories( CultureInfo.CurrentCulture )
    .Select( dirName => CombinePath( assemblyDirPath, dirName, fileName ) )
    .Select( filePath => new FileInfo( filePath ) )
    .Where( file => file.Exists )
    .First( );
}

static IEnumerable<string> GetFallbackDirectories( CultureInfo culture ) {
  return culture
    .Enumerate( c => c.Parent.Name != c.Name ? c.Parent : null )
    .Select( c => c.Name );
}

static IEnumerable<T> Enumerate<T>( this T start, Func<T, T> next ) {
  for( T item = start; !object.Equals( item, default(T) ); item = next( item ) )
    yield return item;
}

static string CombinePath( params string[] args ) {
  return args.Aggregate( Path.Combine );
} 
```

**查找元素**

[处理 XML 文档](http://msdn.microsoft.com/en-us/library/fsbx0t7x.aspx)

```
static XElement GetDocMember( XElement docMembers, MemberInfo member ) {
  string memberId = GetMemberId( member );
  return docMembers.Elements( "member" )
    .Where( e => e.Attribute( "name" ).Value == memberId )
    .First( );
}

static string GetMemberId( MemberInfo member ) {
  char memberKindPrefix = GetMemberPrefix( member );
  string memberName = GetMemberFullName( member );
  return memberKindPrefix + ":" + memberName;
}

static char GetMemberPrefix( MemberInfo member ) {
  return member.GetType( ).Name
    .Replace( "Runtime", "" )[0];
}

static string GetMemberFullName( MemberInfo member ) {
  string memberScope = "";
  if( member.DeclaringType != null )
    memberScope = GetMemberFullName( member.DeclaringType );
  else if( member is Type )
    memberScope = ((Type)member).Namespace;

  return memberScope + "." + member.Name;
} 
```

**示例使用**

```
Type type = typeof( string );

var file = GetXmlDocFile( type.Assembly );
var docXml = XDocument.Load( file.FullName );
var docMembers = docXml.Root.Element( "members" );

var member = type.GetProperty( "Length" );
var docMember = GetDocMember( docMembers, member ); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-07T04:44:47.223

我在 CodePlex 上维护[Jolt.NET](http://jolt.codeplex.com)项目，并实现了执行此任务的功能。有关更多信息，请参阅[Jolt](http://jolt.codeplex.com/Wiki/View.aspx?title=Jolt)库。

本质上，该库允许您以编程方式定位和查询 XML 文档注释文件，以使用元数据类型`System.Reflection`（即`MethodInfo`，`PropertyInfo`等）中的程序集。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-04-26T15:25:57.963

试试[DocsByReflection](https://github.com/giacomelli/DocsByReflection)。

```
// From method.
var methodInfo = typeof(Stub).GetMethod("MethodWithGenericParameter");
var methodDoc = DocsService.GetXmlFromMember(methodInfo); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-11T20:26:39.023

这是一个现成的库，可以让你做到这一点：NuDoc [http://kzu.to/nudoc](http://kzu.to/nudoc)

例如，阅读有关 mscorlib 的整个文档将非常简单：

```
var members = Reader.Read(typeof(string).Assembly); 
```

您可以稍后使用简单的访问者处理结果，如网站上所示。

我正在利用该库生成一个 API 站点，使用 Markdown 托管在 GitHub 中，理想情况下在每次构建时自动生成，甚至可能用于 wiki，以便它可以更新和往返代码:)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T18:54:20.887

XML 文件的命名与程序集的文件完全一样，除了不同的“xml”扩展名，并且必须与程序集本身位于同一目录中。

但是，无法帮助您解决其他两个问题。AFAIK，你自己一个人……

# c# - 将 Visual Studio 2005 (C#) 连接到 Oracle8 最方便的方法是什么？

> ID：230927
> 
> 赞同：4
> 
> 时间：2008-10-23T18:42:28.897
> 
> 标签：c#, .net, visual-studio, winforms, oracle

我正在寻找在 Oracle 8 和 Visual Studio 2005 应用程序之间建立连接的最佳实践。目标是用 C# 编写的 Windows 窗体应用程序，该应用程序每秒访问一次数据库以监视表以查找其最后插入的记录。我正在考虑使用“应用程序设置”将连接字符串存储在那里，但我很想听听你们的意见。提前致谢！

这是一个非常基本的草稿：

```
using System.Data;
using System.Data.OracleClient;

        try
        {
            StringBuilder str = new StringBuilder();
            string ora = Properties.Settings.Default.OracleConnectionString;

            OracleConnection con = new OracleConnection(ora);
            OracleCommand cmd = new OracleCommand();

            cmd.Connection = con;
            cmd.CommandText = "SELECT timestamp FROM jde_out WHERE rownum = 1";
            cmd.CommandType = CommandType.Text;

            con.Open();
            OracleDataReader rdr = cmd.ExecuteReader();
            rdr.Read();

            str.AppendLine(cmd.ExecuteScalar().ToString());
            this.lblJDEtime.Text = str.ToString();
            rdr.Close();
            con.Close();
        }
        catch (OracleException err)
        {
            MessageBox.Show("Exception caught:\n\n" + err.ToString());
        } 
```

我刚刚更新了执行连接所需的代码。将异常类型更改为更具体的 OracleException。通过 Properties.Settings 添加了连接字符串。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T21:09:52.110

[ConnectionStrings.com](http://www.connectionstrings.com/)拥有几乎所有您想要的连接字符串类型，包括[Oracle](http://www.connectionstrings.com/?carrier=oracle)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T20:55:27.087

这是我们环境中的一个示例：

```
<add key="ODP.NET.ConnectionString" value="Password=abcdefg;Persist Security Info=True;User ID=abc123;Data Source=blah;"/> 
```

用户名和密码设置得当，数据源是我们连接到的 Oracle 的 TNSNAMES.ORA 条目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T19:19:36.263

根据我对 Oracle 10g 的经验......

根据我对 Oracle 10g 的经验，我建议使用 Oracle 数据提供程序 (ODP.Net)，而不是使用 Microsoft for Oracle 数据提供程序。微软多年来没有更新，也不支持 Oracle 10g 中的所有内容，所以我肯定会检查一下 Oracle 8。

按照[Microsoft](http://msdn.microsoft.com/en-us/library/ms254494.aspx)关于 app.config 文件中连接字符串的指南，您应该将其存储为：

```
<?xml version='1.0' encoding='utf-8'?>
  <configuration>
    <connectionStrings>
      <clear />
      <add name="Name" 
       providerName="System.Data.ProviderName" 
       connectionString="Valid Connection String;" />
    </connectionStrings>
  </configuration> 
```

我还使用存储在应用程序设置中的连接信息来处理应用程序，这对我们的应用程序来说效果很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T12:27:37.283

@Loscas AFAIK ODP.NET 数据提供程序仅在 Oracle 9i 上受支持。 [MS Oracle 数据提供程序](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx)适用于 8.1.7 及更高版本。

@BQ

> 每秒打开一个到数据库的新连接以轮询更改是一项昂贵的操作。

实际上连接没有在 con.Open() 上打开。它只是从打开的连接池中获取的。con.Close() 返回到池的连接。所以，这个连接处理真的没有错。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T19:27:39.367

我会警告不要像您建议的那样构建架构。每秒打开一个到数据库的新连接以轮询更改是一项昂贵的操作。如果您尝试将此 Windows 窗体应用程序扩展到几个用户之外，情况会变得更糟。

相反，您应该研究可以支持监视此类活动的内置 Oracle 包。

编辑：您的示例中的“WHERE ROWNUM=1”在这里没有用。Oracle 不保证根据您的查询以任何特定方式对结果进行排序。

您的问题实际上是一个架构问题。按照您的建议轮询数据库表并不是进行应用程序运行状况监控的好方法。至少，您最好在中间层甚至数据库中拥有一个组件，定期写入日志文件、Windows 事件日志、表等，基本上说“我仍在听”，并且只轮询那个单一的来源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-08T09:58:45.397

如果要监控表，是否考虑过使用触发器？一个例子可能是：

*   您的应用程序侦听 TCP 端口
*   在 Oracle 表上安装触发器
*   触发器调用一些 Oracle Java 代码...
*   ... 向您的应用程序的 TCP 端口发送一条简单的消息
*   该消息可能只是一个通知，然后您可以从表格中读取。或者，您可以将影响表的整个 SQL 作为消息负载发送。

这可能会更好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-08T10:07:48.327

关于连接字符串，由于您使用的是 System.Data.OracleClient，我还建议格式化 Oracle 连接字符串以使其独立于 tnsname.ora：

```
string connectionString = @"
SERVER=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP
(HOST=OracleHost)(PORT=OraclePort))
(CONNECT_DATA=(SERVICE_NAME=OracleServiceName)))
;uid=UserID;pwd=Password;"; 
```

您可以将其存储在 App.config 文件中，如下所示：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <appSettings>
  <add key="My.Database.Connection" value="SERVER=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP
    (HOST=OracleHost)(PORT=OraclePort))
    (CONNECT_DATA=(SERVICE_NAME=OracleServiceName)))
    ;uid=UserID;pwd=Password;" />
  </appSettings>
</configuration> 
```

然后通过以下方式访问它：

```
connectionString = ConfigurationSettings.AppSettings["My.Database.Connection"]; 
```

仅供参考，这是我关于这个主题的博客文章： [使用 ADO.NET 与 Oracle 快速而肮脏的连接](http://mishandledexception.blogspot.com/2008/11/quick-and-dirty-connection-to-oracle.html)

# javascript - 需要一个示例来解释为什么在 JavaScript 中使用比较操作数 != 和 == 被认为是不好的做法

> ID：230931
> 
> 赞同：16
> 
> 时间：2008-10-23T18:43:08.037
> 
> 标签：javascript

正如我在某处所读到的，建议改用 !== 和 === 。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-23T18:46:29.780

“当你想检查两个操作数的类型和值是否相同时，使用严格相等运算符 (===)。如果你只关心值并且类型无关紧要，请使用常规相等运算符 (==) . 例如，如果一个操作数是数字 5，而另一个操作数是字符串“5”，则标准相等运算符将返回 true，但由于它们不是同一类型，因此严格相等运算符将返回 false。 [http://www.webreference.com/js/column26/stricteq.html](http://www.webreference.com/js/column26/stricteq.html)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-23T18:47:01.337

这取决于你想要做什么。

!== 和 === 比较值*和*类型。

```
5 == "5" 
```

以上将返回true。如果这不是你想要的，你应该这样做：

```
5 === "5" 
```

那将返回错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-23T18:50:39.020

> **=== 和 !== 运算符。**
> 
> 使用 === 和 !== 运算符几乎总是更好。== 和 != 运算符会进行类型强制。特别是，不要使用 == 与虚假值进行比较。

来自[Douglas Crockford 的 JavaScript 编程语言代码约定](http://javascript.crockford.com/code.html)

有关这方面的更多信息，请参阅 Totty 的回答，或阅读[Douglas Crockford 的 JavaScript 风格元素，第二部分：惯用语](http://javascript.crockford.com/style2.html)，它更详细地处理了真实性、虚假性和 JavaScript 类型强制的概念。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-23T18:49:55.280

避免它们的基本原因是，`==`并且`!=`比严格的`===`和`!==`运算符更昂贵。这是因为其他主要问题，如果要比较的两个值的类型不同`==`，`!=`两者都会执行隐式 toString 转换。

一个简单的例子是

alert({toString:function (){return "1"} == 1)

这将产生 true -- 因为将在两个值上调用 toString，然后将比较字符串结果。在这种特殊情况下，这显然是荒谬的，但这在更现实的情况下也可能是一个问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-23T19:27:54.423

`===`和的语义`!==`几乎总是你的*意思*。当您将一个基元与另一个基元进行比较时，您想检查它们是否具有相同的值。当您将一个对象与另一个对象进行比较时，您想检查它们是否引用了完全相同的东西。

**编辑：**删除了有关比较“虚假”值的错误信息。我会简单地说，`==`操作员无法区分`null`from `undefined`，或`0`from `""`，或`[0]`from `0`。是的，我对最后一个是认真的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-23T18:50:05.637

好吧，我认为您收到的“建议”可能是善意的，但并不是一个完整的评论。

JavaScript 是动态类型的，这意味着变量可以动态更改类型（字符串、数字、布尔值）而无需强制转换。如果你这样做，解析器不会抱怨

```
var int = 3;    // Is typeof Number
int = 'haha!';  // is typeof String 
```

但是，这并不是说 JavaScript 是完全无类型的。等式和不等式运算符（== 和 !=）比较评估值，并忽略类型。

严格相等和严格不等式运算符（=== 和 !==）确实关心类型。所以他们会在确定返回值之前比较值和类型。

在这里阅读更多

[http://devedge-temp.mozilla.org/library/manuals/2000/javascript/1.5/guide/expr.html#1010037](http://devedge-temp.mozilla.org/library/manuals/2000/javascript/1.5/guide/expr.html#1010037)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T19:38:45.850

就个人而言，除了其他人所说的非常正当的理由外，我只是想知道我所比较的正是我想要的。对我来说，以下两者之间的区别很重要，即使它们都评估为`!myVar`：

```
false === myVar
'undefined' === typeof myVar 
```

# c# - 如何转换列表中的所有字符串 使用 LINQ 小写？

> ID：230973
> 
> 赞同：103
> 
> 时间：2008-10-23T18:54:03.103
> 
> 标签：c#, linq, lambda, foreach

昨天我在 StackOverflow 上的一个回复中看到了一个代码片段，这让我很感兴趣。是这样的：

```
 List<string> myList = new List<string> {"aBc", "HELLO", "GoodBye"};

 myList.ForEach(d=>d.ToLower()); 
```

我希望我可以使用它将 myList 中的所有项目转换为小写。但是，它不会发生......运行后， myList 中的大小写没有改变。

所以我的问题是是否有一种方法，使用 LINQ 和 Lambda 表达式以类似于此的方式轻松迭代和修改列表的内容。

谢谢，马克斯

* * *

## 回答 #1

> 赞同：201
> 
> 时间：2008-10-23T19:05:41.130

最简单的方法：

```
myList = myList.ConvertAll(d => d.ToLower()); 
```

与您的示例代码没有太大不同。`ForEach`循环原始列表，同时`ConvertAll`创建一个您需要重新分配的新列表。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-10-23T19:00:56.443

这是因为 ToLower**返回**的是小写字符串，而不是转换原始字符串。所以你想要这样的东西：

```
List<string> lowerCase = myList.Select(x => x.ToLower()).ToList(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-23T19:05:23.657

`ForEach`uses `Action<T>`，这意味着`x`如果它不是不可变的，你可以影响它。因为`x`是 a `string`，所以它是不可变的，所以你在 lambda 中对它所做的任何事情都不会改变它的属性。Kyralessa 的解决方案是您的最佳选择，除非您想实现自己的扩展方法以允许您返回替换值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-23T19:00:17.100

```
[TestMethod]
public void LinqStringTest()
{
    List<string> myList = new List<string> { "aBc", "HELLO", "GoodBye" };
    myList = (from s in myList select s.ToLower()).ToList();
    Assert.AreEqual(myList[0], "abc");
    Assert.AreEqual(myList[1], "hello");
    Assert.AreEqual(myList[2], "goodbye");
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-03-07T08:13:02.490

```
var _reps = new List(); // with variant data

_reps.ConvertAll<string>(new Converter<string,string>(delegate(string str){str = str.ToLower(); return str;})).Contains("invisible")) 
```

# iis-7 - IIS v7 禁用 SSL v 2.0

> ID：230974
> 
> 赞同：22
> 
> 时间：2008-10-23T18:54:11.230
> 
> 标签：iis-7, ssl

我试图在 IIS 7 上禁用 SSL v2.0 协议。

以下文章参考 IIS v6：http: [//support.microsoft.com/kb/187498](http://support.microsoft.com/kb/187498)

它似乎不适用，因为注册表中列出的唯一协议是 SSL 2.0（不是所有其他协议），并且设置“DisabledByDefault=1”已经存在，这似乎意味着它已被禁用。

但是，以下文章似乎表明它仍然适用并关闭“DisabledByDefault”，这看起来很奇怪。 [http://forums.iis.net/t/1151822.aspx](http://forums.iis.net/t/1151822.aspx)

我只需要禁用 SSL v2.0，但我想相对自信地做正确的事。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-02-20T12:29:17.320

本文介绍如何在 IIS 7 中禁用 SSL 2.0：

*   [如何在 IIS 7 中禁用 SSL 2.0](http://www.sslshopper.com/article-how-to-disable-ssl-2.0-in-iis-7.html)

> 1.  单击**开始**，单击**运行**，键入**regedit**，然后单击**确定**。
> 2.  在注册表编辑器中，找到以下注册表项/文件夹：
>     `HKey_Local_Machine\System\CurrentControlSet\Control\SecurityProviders`
>     `\SCHANNEL\Protocols\SSL 2.0`
> 3.  右键单击 SSL 2.0 文件夹并选择**新建**，然后单击**密钥**。将新文件夹命名为**Server**。
> 4.  在 Server 文件夹中，单击**Edit**菜单，选择**New**，然后单击**DWORD (32-bit) Value**。
> 5.  输入**Enabled**作为名称，然后按 Enter。
> 6.  确保它在“数据”列下显示**0x00000000 (0)**（默认情况下应该如此）。如果不是，请右键单击并选择修改并输入 0 作为值数据。
> 7.  重新启动计算机。
> 8.  [验证ServerSniff.net](http://www.serversniff.net/content.php?do=ssl)或[公共 SSL 服务器数据库](https://www.ssllabs.com/ssldb/index.html)中没有可用的 SSL 2.0 密码

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-04-22T17:42:40.117

我知道这是一个非常古老的线程，但是当我部署新服务器时我开始依赖它。我今天发现了这个程序，它可以在 IIS 上轻松设置 SSL。它是免费的，我今天在我的一台服务器上运行它，效果很好。

[IIS 加密](https://www.nartac.com/Products/IISCrypto/Default.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-28T20:24:49.573

向 SSL 2.0 键添加一个名为“已启用”且值为 0x0（默认）的 DWORD

# regex - 格式化/解析 Vb 中的字符串

> ID：230981
> 
> 赞同：-1
> 
> 时间：2008-10-23T18:56:42.957
> 
> 标签：regex, vb6, parsing, printing

我正在处理一些可能形式的输入

```
$1,200
20 cents/ inch
$10 
```

有没有办法将这些解析为VB中的数字？还打印这些数字？

**编辑：**正则表达式会很棒。

**编辑：**特别是 VB 6

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T19:24:18.703

你是说 VB6/VBA 还是 VB.net？在 VB6 或 VBA 中，您可以执行`CLng()` 或`CDec()`取决于您想要的数字类型。他们会很好地处理开头的美元符号和逗号。为了处理 20 美分/英寸，您可能应该做类似的事情

```
CLng(split("20 cents / inch", " ")(0)) 
```

如果无法转换，这些函数会引发类型转换错误。如果它们失败，您可以捕获它并尝试以另一种方式转换它。

还有一个名为 Val 的函数，它返回数字部分。它不会生成类型转换错误，例如`CDec`. 但它也不处理任何非数字输入。只要字符串以数字开头，它就会为您提供字符串中数字的十进制值。它忽略任何尾随字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T19:07:07.477

嗯......假设你想要的只是数字，我会使用正则表达式来简单地用“”替换任何非数字。

您需要在项目中引用 Microsoft VBScript 正则表达式。然后假设您的文本位于名为 strTest 的变量中。这是一些未经测试的即兴代码：

```
Dim oRE As Object
Set oRE = New VBScript_RegExp.RegExp
oRe.Pattern = "\D"
strTest = oRE.Replace(strTest, "") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T22:01:34.067

有时它只需要蛮力！

这是一个例程，它接收一个带有数字的字符串，并返回一个用分数、M 或 B 后缀等正确处理的数字。您可以修改 i 以处理任何特殊条件或文本代数（英里/小时、美分/英寸等）

这是从我们的一个生产应用程序中获取的，因此是我们在错误处理程序 (ERHandler) 中使用的行号，以及标准退出例程。

```
Function GetNumberFromString(s As String) As Currency
12800 Const ProcID = "GetNumberFromString"
12810 Dim c                                   As String
12820 Dim d                                   As Integer
12830 Dim Denominator                         As Double ' currency only handles 4 places
12840 Dim HaveDec                             As Boolean
12850 Dim HaveSlash                           As Boolean
12860 Dim HaveSpace                           As Boolean
12870 Dim i                                   As Integer
12880 Dim LenV                                As Integer
12890 Dim NegMult                             As Integer
12900 Dim Numerator                           As Currency
12910 Dim TempVal                             As Currency
12920 Dim v                                   As String

      'Provides the functionality of VAL, but handles commas, fractions
      ' also million and billion

12930 On Error GoTo ErrLbl
12940 oLog.LogProcEntry ModuleID, ProcID, "v=" & v

12950 v = Trim(s)
12960 LenV = Len(v)
12970 If LenV = 0 Then
12980     GetNumberFromString = 0
12990     GoTo ExitProc
13000 End If
13010 TempVal = 0
13020 d = 0
13030 NegMult = 1
      '
13040 For i = 1 To LenV
13050     c = Mid(v, i, 1)
13060     Select Case c
          Case "0" To "9"
13070         If HaveSpace Then
13080             If Not HaveSlash Then
13090                 Numerator = 10 * Numerator + Asc(c) - 48
13100             Else
13110                 Denominator = 10 * Denominator + Asc(c) - 48
13120             End If
13130         ElseIf Not HaveDec Then
13140             TempVal = 10 * TempVal + Asc(c) - 48
13150         Else
13160             TempVal = TempVal + ((Asc(c) - 48)) / (10 ^ d)
13170             d = d + 1
13180         End If
13190     Case ",", "$"
          ' do nothing
13200     Case "-" 'let handle negatives ns 12/20/96
13210         NegMult = -1 * NegMult
13220     Case "(" 'let handle negatives mt 6/9/99
13230         NegMult = -1 * NegMult
13240     Case "."
13250         HaveDec = True
13260         d = 1
13270     Case " "
13280         HaveSpace = True
13290         d = 1
13300     Case "/"
13310         HaveSlash = True
13320         If Not HaveSpace Then
13330             HaveSpace = True
13340             Numerator = TempVal
13350             TempVal = 0
13360         End If
13370     Case "b", "B"
13380         If UCase(Mid(v, i, 7)) = "BILLION" Then
13390             TempVal = TempVal * 1000000000#
13400             Exit For
13410         End If
13420     Case "m", "M"
13430         If UCase(Mid(v, i, 7)) = "MILLION" Then
13440             TempVal = TempVal * 1000000#
13450             Exit For
13460         End If
13470     Case Else
          ' ignore character/error
13480     End Select
13490 Next i

13500 If HaveSlash And Denominator <> 0 Then
13510     TempVal = TempVal + Numerator / Denominator
13520 End If

13530 GetNumberFromString = TempVal * NegMult

ExitProc:
13540 oLog.LogProcExit ModuleID, ProcID
13550 Exit Function

ErrLbl:
13560 Debug.Print Err.Description, Err.Number
13570 Debug.Assert False
13580 ERHandler ModuleID, ProcID
13590 Resume
End Function 
```

# iphone - iPhone 上的压缩 API

> ID：230984
> 
> 赞同：31
> 
> 时间：2008-10-23T18:57:53.517
> 
> 标签：iphone, compression

是否有可在 iPhone 上使用的压缩 API？我们正在为我们的 iPhone 应用程序构建一些 RESTful Web 服务来与之对话，但我们希望至少压缩一些对话以提高效率。

我不在乎格式（ZIP、LHA 等等）是什么，它也不需要是安全的。

一些受访者指出，服务器可以压缩其输出，iPhone 可以使用它。我们的情况正好相反。我们将 POST 压缩内容**到**Web 服务。我们不关心压缩会以另一种方式进行。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-24T15:50:13.193

如果您将对话的数据存储在 NSData 对象中，CocoaDev wiki 上的人们发布了一个[NSData 类别](http://www.cocoadev.com/index.pl?NSDataCategory)，其中添加了 gzip 和 zlib 压缩/解压缩作为简单方法。这些在[我的 iPhone 应用程序](http://www.sunsetlakesoftware.com/2008/10/02/molecules-source-code-now-available)中对我很有效。

由于在将 CocoaDev wiki 移至新主机时上述链接已失效，因此我在下面完整地复制了此类别。

界面：

```
@interface NSData (NSDataExtension)

// Returns range [start, null byte), or (NSNotFound, 0).
- (NSRange) rangeOfNullTerminatedBytesFrom:(int)start;

// Canonical Base32 encoding/decoding.
+ (NSData *) dataWithBase32String:(NSString *)base32;
- (NSString *) base32String;

// COBS is an encoding that eliminates 0x00.
- (NSData *) encodeCOBS;
- (NSData *) decodeCOBS;

// ZLIB
- (NSData *) zlibInflate;
- (NSData *) zlibDeflate;

// GZIP
- (NSData *) gzipInflate;
- (NSData *) gzipDeflate;

//CRC32
- (unsigned int)crc32;

// Hash
- (NSData*) md5Digest;
- (NSString*) md5DigestString;
- (NSData*) sha1Digest;
- (NSString*) sha1DigestString;
- (NSData*) ripemd160Digest;
- (NSString*) ripemd160DigestString;

@end 
```

执行：

```
#import "NSData+CocoaDevUsersAdditions.h"
#include <zlib.h>
#include <openssl/md5.h>
#include <openssl/sha.h>
#include <openssl/ripemd.h>

@implementation NSData (NSDataExtension)

// Returns range [start, null byte), or (NSNotFound, 0).
- (NSRange) rangeOfNullTerminatedBytesFrom:(int)start
{
    const Byte *pdata = [self bytes];
    int len = [self length];
    if (start < len)
    {
        const Byte *end = memchr (pdata + start, 0x00, len - start);
        if (end != NULL) return NSMakeRange (start, end - (pdata + start));
    }
    return NSMakeRange (NSNotFound, 0);
}

+ (NSData *) dataWithBase32String:(NSString *)encoded
{
    /* First valid character that can be indexed in decode lookup table */
    static int charDigitsBase = '2';

    /* Lookup table used to decode() characters in encoded strings */
    static int charDigits[] =
    {   26,27,28,29,30,31,-1,-1,-1,-1,-1,-1,-1,-1 //   23456789:;<=>?
        ,-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14 // @ABCDEFGHIJKLMNO
        ,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1 // PQRSTUVWXYZ[\]^_
        ,-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14 // `abcdefghijklmno
        ,15,16,17,18,19,20,21,22,23,24,25                // pqrstuvwxyz
    };

    if (! [encoded canBeConvertedToEncoding:NSASCIIStringEncoding]) return nil;
    const char *chars = [encoded cStringUsingEncoding:NSASCIIStringEncoding]; // avoids using characterAtIndex.
    int charsLen = [encoded lengthOfBytesUsingEncoding:NSASCIIStringEncoding];

    // Note that the code below could detect non canonical Base32 length within the loop. However canonical Base32 length can be tested before entering the loop.
    // A canonical Base32 length modulo 8 cannot be:
    // 1 (aborts discarding 5 bits at STEP n=0 which produces no byte),
    // 3 (aborts discarding 7 bits at STEP n=2 which produces no byte),
    // 6 (aborts discarding 6 bits at STEP n=1 which produces no byte).
    switch (charsLen & 7) { // test the length of last subblock
        case 1: //  5 bits in subblock:  0 useful bits but 5 discarded
        case 3: // 15 bits in subblock:  8 useful bits but 7 discarded
        case 6: // 30 bits in subblock: 24 useful bits but 6 discarded
            return nil; // non-canonical length
    }
    int charDigitsLen = sizeof(charDigits);
    int bytesLen = (charsLen * 5) >> 3;
    Byte bytes[bytesLen];
    int bytesOffset = 0, charsOffset = 0;
    // Also the code below does test that other discarded bits
    // (1 to 4 bits at end) are effectively 0.
    while (charsLen > 0)
    {
        int digit, lastDigit;
        // STEP n = 0: Read the 1st Char in a 8-Chars subblock
        // Leave 5 bits, asserting there's another encoding Char
        if ((digit = (int)chars[charsOffset] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        lastDigit = digit << 3;
        // STEP n = 5: Read the 2nd Char in a 8-Chars subblock
        // Insert 3 bits, leave 2 bits, possibly trailing if no more Char
        if ((digit = (int)chars[charsOffset + 1] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        bytes[bytesOffset] = (Byte)((digit >> 2) | lastDigit);
        lastDigit = (digit & 3) << 6;
        if (charsLen == 2) {
            if (lastDigit != 0) return nil; // non-canonical end
            break; // discard the 2 trailing null bits
        }
        // STEP n = 2: Read the 3rd Char in a 8-Chars subblock
        // Leave 7 bits, asserting there's another encoding Char
        if ((digit = (int)chars[charsOffset + 2] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        lastDigit |= (Byte)(digit << 1);
        // STEP n = 7: Read the 4th Char in a 8-chars Subblock
        // Insert 1 bit, leave 4 bits, possibly trailing if no more Char
        if ((digit = (int)chars[charsOffset + 3] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        bytes[bytesOffset + 1] = (Byte)((digit >> 4) | lastDigit);
        lastDigit = (Byte)((digit & 15) << 4);
        if (charsLen == 4) {
            if (lastDigit != 0) return nil; // non-canonical end
            break; // discard the 4 trailing null bits
        }
        // STEP n = 4: Read the 5th Char in a 8-Chars subblock
        // Insert 4 bits, leave 1 bit, possibly trailing if no more Char
        if ((digit = (int)chars[charsOffset + 4] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        bytes[bytesOffset + 2] = (Byte)((digit >> 1) | lastDigit);
        lastDigit = (Byte)((digit & 1) << 7);
        if (charsLen == 5) {
            if (lastDigit != 0) return nil; // non-canonical end
            break; // discard the 1 trailing null bit
        }
        // STEP n = 1: Read the 6th Char in a 8-Chars subblock
        // Leave 6 bits, asserting there's another encoding Char
        if ((digit = (int)chars[charsOffset + 5] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        lastDigit |= (Byte)(digit << 2);
        // STEP n = 6: Read the 7th Char in a 8-Chars subblock
        // Insert 2 bits, leave 3 bits, possibly trailing if no more Char
        if ((digit = (int)chars[charsOffset + 6] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        bytes[bytesOffset + 3] = (Byte)((digit >> 3) | lastDigit);
        lastDigit = (Byte)((digit & 7) << 5);
        if (charsLen == 7) {
            if (lastDigit != 0) return nil; // non-canonical end
            break; // discard the 3 trailing null bits
        }
        // STEP n = 3: Read the 8th Char in a 8-Chars subblock
        // Insert 5 bits, leave 0 bit, next encoding Char may not exist
        if ((digit = (int)chars[charsOffset + 7] - charDigitsBase) < 0 || digit >= charDigitsLen || (digit = charDigits[digit]) == -1)
            return nil; // invalid character
        bytes[bytesOffset + 4] = (Byte)(digit | lastDigit);
        //// This point is always reached for chars.length multiple of 8
        charsOffset += 8;
        bytesOffset += 5;
        charsLen -= 8;
    }
    // On loop exit, discard the n trailing null bits
    return [NSData dataWithBytes:bytes length:sizeof(bytes)];
}

- (NSString *) base32String
{
    /* Lookup table used to canonically encode() groups of data bits */
    static char canonicalChars[] =
    {   'A','B','C','D','E','F','G','H','I','J','K','L','M' // 00..12
        ,'N','O','P','Q','R','S','T','U','V','W','X','Y','Z' // 13..25
        ,'2','3','4','5','6','7'                             // 26..31
    };
    const Byte *bytes = [self bytes];
    int bytesOffset = 0, bytesLen = [self length];
    int charsOffset = 0, charsLen = ((bytesLen << 3) + 4) / 5;
    char chars[charsLen];
    while (bytesLen != 0) {
        int digit, lastDigit;
        // INVARIANTS FOR EACH STEP n in [0..5[; digit in [0..31[;
        // The remaining n bits are already aligned on top positions
        // of the 5 least bits of digit, the other bits are 0.
        ////// STEP n = 0: insert new 5 bits, leave 3 bits
        digit = bytes[bytesOffset] & 255;
        chars[charsOffset] = canonicalChars[digit >> 3];
        lastDigit = (digit & 7) << 2;
        if (bytesLen == 1) { // put the last 3 bits
            chars[charsOffset + 1] = canonicalChars[lastDigit];
            break;
        }
        ////// STEP n = 3: insert 2 new bits, then 5 bits, leave 1 bit
        digit = bytes[bytesOffset + 1] & 255;
        chars[charsOffset + 1] = canonicalChars[(digit >> 6) | lastDigit];
        chars[charsOffset + 2] = canonicalChars[(digit >> 1) & 31];
        lastDigit = (digit & 1) << 4;
        if (bytesLen == 2) { // put the last 1 bit
            chars[charsOffset + 3] = canonicalChars[lastDigit];
            break;
        }
        ////// STEP n = 1: insert 4 new bits, leave 4 bit
        digit = bytes[bytesOffset + 2] & 255;
        chars[charsOffset + 3] = canonicalChars[(digit >> 4) | lastDigit];
        lastDigit = (digit & 15) << 1;
        if (bytesLen == 3) { // put the last 1 bits
            chars[charsOffset + 4] = canonicalChars[lastDigit];
            break;
        }
        ////// STEP n = 4: insert 1 new bit, then 5 bits, leave 2 bits
        digit = bytes[bytesOffset + 3] & 255;
        chars[charsOffset + 4] = canonicalChars[(digit >> 7) | lastDigit];
        chars[charsOffset + 5] = canonicalChars[(digit >> 2) & 31];
        lastDigit = (digit & 3) << 3;
        if (bytesLen == 4) { // put the last 2 bits
            chars[charsOffset + 6] = canonicalChars[lastDigit];
            break;
        }
        ////// STEP n = 2: insert 3 new bits, then 5 bits, leave 0 bit
        digit = bytes[bytesOffset + 4] & 255;
        chars[charsOffset + 6] = canonicalChars[(digit >> 5) | lastDigit];
        chars[charsOffset + 7] = canonicalChars[digit & 31];
        //// This point is always reached for bytes.length multiple of 5
        bytesOffset += 5;
        charsOffset += 8;
        bytesLen -= 5;
    }
    return [NSString stringWithCString:chars length:sizeof(chars)];
}

#define FinishBlock(X) \
(*code_ptr = (X), \
code_ptr = dst++, \
code = 0x01)

- (NSData *) encodeCOBS
{
    if ([self length] == 0) return self;

    NSMutableData *encoded = [NSMutableData dataWithLength:([self length] + [self length] / 254 + 1)];
    unsigned char *dst = [encoded mutableBytes];
    const unsigned char *ptr = [self bytes];
    unsigned long length = [self length];
    const unsigned char *end = ptr + length;
    unsigned char *code_ptr = dst++;
    unsigned char code = 0x01;
    while (ptr < end)
    {
        if (*ptr == 0) FinishBlock(code);
        else
        {
            *dst++ = *ptr;
            code++;
            if (code == 0xFF) FinishBlock(code);
        }
        ptr++;
    }
    FinishBlock(code);

    [encoded setLength:((Byte *)dst - (Byte *)[encoded mutableBytes])];
    return [NSData dataWithData:encoded];
}

- (NSData *) decodeCOBS
{
    if ([self length] == 0) return self;

    const Byte *ptr = [self bytes];
    unsigned length = [self length];
    NSMutableData *decoded = [NSMutableData dataWithLength:length];
    Byte *dst = [decoded mutableBytes];
    Byte *basedst = dst;

    const unsigned char *end = ptr + length;
    while (ptr < end)
    {
        int i, code = *ptr++;
        for (i=1; i<code; i++) *dst++ = *ptr++;
        if (code < 0xFF) *dst++ = 0;
    }

    [decoded setLength:(dst - basedst)];
    return [NSData dataWithData:decoded];
}

- (NSData *)zlibInflate
{
    if ([self length] == 0) return self;

    unsigned full_length = [self length];
    unsigned half_length = [self length] / 2;

    NSMutableData *decompressed = [NSMutableData dataWithLength: full_length + half_length];
    BOOL done = NO;
    int status;

    z_stream strm;
    strm.next_in = (Bytef *)[self bytes];
    strm.avail_in = [self length];
    strm.total_out = 0;
    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;

    if (inflateInit (&strm) != Z_OK) return nil;

    while (!done)
    {
        // Make sure we have enough room and reset the lengths.
        if (strm.total_out >= [decompressed length])
            [decompressed increaseLengthBy: half_length];
        strm.next_out = [decompressed mutableBytes] + strm.total_out;
        strm.avail_out = [decompressed length] - strm.total_out;

        // Inflate another chunk.
        status = inflate (&strm, Z_SYNC_FLUSH);
        if (status == Z_STREAM_END) done = YES;
        else if (status != Z_OK) break;
    }
    if (inflateEnd (&strm) != Z_OK) return nil;

    // Set real length.
    if (done)
    {
        [decompressed setLength: strm.total_out];
        return [NSData dataWithData: decompressed];
    }
    else return nil;
}

- (NSData *)zlibDeflate
{
    if ([self length] == 0) return self;

    z_stream strm;

    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;
    strm.opaque = Z_NULL;
    strm.total_out = 0;
    strm.next_in=(Bytef *)[self bytes];
    strm.avail_in = [self length];

    // Compresssion Levels:
    //   Z_NO_COMPRESSION
    //   Z_BEST_SPEED
    //   Z_BEST_COMPRESSION
    //   Z_DEFAULT_COMPRESSION

    if (deflateInit(&strm, Z_DEFAULT_COMPRESSION) != Z_OK) return nil;

    NSMutableData *compressed = [NSMutableData dataWithLength:16384];  // 16K chuncks for expansion

    do {

        if (strm.total_out >= [compressed length])
            [compressed increaseLengthBy: 16384];

        strm.next_out = [compressed mutableBytes] + strm.total_out;
        strm.avail_out = [compressed length] - strm.total_out;

        deflate(&strm, Z_FINISH);

    } while (strm.avail_out == 0);

    deflateEnd(&strm);

    [compressed setLength: strm.total_out];
    return [NSData dataWithData: compressed];
}

- (NSData *)gzipInflate
{
    if ([self length] == 0) return self;

    unsigned full_length = [self length];
    unsigned half_length = [self length] / 2;

    NSMutableData *decompressed = [NSMutableData dataWithLength: full_length + half_length];
    BOOL done = NO;
    int status;

    z_stream strm;
    strm.next_in = (Bytef *)[self bytes];
    strm.avail_in = [self length];
    strm.total_out = 0;
    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;

    if (inflateInit2(&strm, (15+32)) != Z_OK) return nil;
    while (!done)
    {
        // Make sure we have enough room and reset the lengths.
        if (strm.total_out >= [decompressed length])
            [decompressed increaseLengthBy: half_length];
        strm.next_out = [decompressed mutableBytes] + strm.total_out;
        strm.avail_out = [decompressed length] - strm.total_out;

        // Inflate another chunk.
        status = inflate (&strm, Z_SYNC_FLUSH);
        if (status == Z_STREAM_END) done = YES;
        else if (status != Z_OK) break;
    }
    if (inflateEnd (&strm) != Z_OK) return nil;

    // Set real length.
    if (done)
    {
        [decompressed setLength: strm.total_out];
        return [NSData dataWithData: decompressed];
    }
    else return nil;
}

- (NSData *)gzipDeflate
{
    if ([self length] == 0) return self;

    z_stream strm;

    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;
    strm.opaque = Z_NULL;
    strm.total_out = 0;
    strm.next_in=(Bytef *)[self bytes];
    strm.avail_in = [self length];

    // Compresssion Levels:
    //   Z_NO_COMPRESSION
    //   Z_BEST_SPEED
    //   Z_BEST_COMPRESSION
    //   Z_DEFAULT_COMPRESSION

    if (deflateInit2(&strm, Z_DEFAULT_COMPRESSION, Z_DEFLATED, (15+16), 8, Z_DEFAULT_STRATEGY) != Z_OK) return nil;

    NSMutableData *compressed = [NSMutableData dataWithLength:16384];  // 16K chunks for expansion

    do {

        if (strm.total_out >= [compressed length])
            [compressed increaseLengthBy: 16384];

        strm.next_out = [compressed mutableBytes] + strm.total_out;
        strm.avail_out = [compressed length] - strm.total_out;

        deflate(&strm, Z_FINISH);

    } while (strm.avail_out == 0);

    deflateEnd(&strm);

    [compressed setLength: strm.total_out];
    return [NSData dataWithData:compressed];
}

// --------------------------------CRC32-------------------------------
static const unsigned long crc32table[] =
{
    0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3,
    0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988, 0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91,
    0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de, 0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7,
    0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5,
    0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172, 0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b,
    0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59,
    0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423, 0xcfba9599, 0xb8bda50f,
    0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924, 0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d,
    0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a, 0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,
    0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01,
    0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e, 0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457,
    0x65b0d9c6, 0x12b7e950, 0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65,
    0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2, 0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb,
    0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0, 0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9,
    0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086, 0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,
    0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17, 0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad,
    0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a, 0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683,
    0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8, 0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,
    0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7,
    0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc, 0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5,
    0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252, 0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b,
    0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60, 0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79,
    0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236, 0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f,
    0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d,
    0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 0x9c0906a9, 0xeb0e363f, 0x72076785, 0x05005713,
    0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38, 0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21,
    0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,
    0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45,
    0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2, 0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db,
    0xaed16a4a, 0xd9d65adc, 0x40df0b66, 0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,
    0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf,
    0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94, 0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d
};

- (unsigned int)crc32
{
    unsigned int    crcval;
    unsigned int    x, y;
    const void      *bytes;
    unsigned int    max;

    bytes = [self bytes];
    max = [self length];
    crcval = 0xffffffff;
    for (x = 0, y = max; x < y; x++) {
        crcval = ((crcval >> 8) & 0x00ffffff) ^ crc32table[(crcval ^ (*((unsigned char *)bytes + x))) & 0xff];
    }

    return crcval ^ 0xffffffff;
}

// Hash function, by [[DamienBob]]

#define HEComputeDigest(method)                     \
method##_CTX ctx;                               \
unsigned char digest[method##_DIGEST_LENGTH];       \
method##_Init(&ctx);                            \
method##_Update(&ctx, [self bytes], [self length]);     \
method##_Final(digest, &ctx);

#define HEComputeDigestNSData(method)               \
HEComputeDigest(method)                     \
return [NSData dataWithBytes:digest length:method##_DIGEST_LENGTH];

#define HEComputeDigestNSString(method)             \
static char __HEHexDigits[] = "0123456789abcdef";       \
unsigned char digestString[2*method##_DIGEST_LENGTH];\
unsigned int i;                                 \
HEComputeDigest(method)                     \
for(i=0; i<method##_DIGEST_LENGTH; i++) {               \
    digestString[2*i]   = __HEHexDigits[digest[i] >> 4];    \
    digestString[2*i+1] = __HEHexDigits[digest[i] & 0x0f];\
}                                           \
return [NSString stringWithCString:(char *)digestString length:2*method##_DIGEST_LENGTH];

#define SHA1_CTX                SHA_CTX
#define SHA1_DIGEST_LENGTH      SHA_DIGEST_LENGTH

- (NSData*) md5Digest
{
    HEComputeDigestNSData(MD5);
}

- (NSString*) md5DigestString
{
    HEComputeDigestNSString(MD5);
}

- (NSData*) sha1Digest
{
    HEComputeDigestNSData(SHA1);
}

- (NSString*) sha1DigestString
{
    HEComputeDigestNSString(SHA1);
}

- (NSData*) ripemd160Digest
{
    HEComputeDigestNSData(RIPEMD160);
}

- (NSString*) ripemd160DigestString
{
    HEComputeDigestNSString(RIPEMD160);
}

@end 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-23T19:34:25.237

zlib 和 bzip2 可用。你可以随时添加其他人，只要他们（通常）在 OS X 下编译。

bzip2 是最小文件大小的更好选择，但需要更多的 CPU 能力来压缩和解压缩。

此外，由于您正在与 Web 服务通信，因此您可能不需要做太多事情。NSURLRequest在服务器响应中透明地**接受 gzip 编码。**

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-08-11T06:02:15.637

Apple 内置的 libcompression 现在可用于 iOS 9。压缩 NSData 的压缩编码缓冲区的简短示例如下所示。

```
@import Compression;

NSData *theData = [NSData dataWithContentsOfFile:[<some file> path]];
size_t theDataSize = [theData length];
const uint8_t *buf = (const uint8_t *)[theData bytes];
uint8_t *destBuf = malloc(sizeof(uint8_t) * theDataSize);
size_t compressedSize = compression_encode_buffer(destBuf, theDataSize, buf, theDataSize, NULL, COMPRESSION_LZFSE);
self.<NSData item> = [NSData dataWithBytes:destBuf length:compressedSize];

NSLog(@"originalsize:%zu compressed:%zu", theDataSize, compressedSize);
free(destBuf); 
```

有许多不同的算法可用：

*   LZMA
*   LZ4
*   ZLIB
*   伦敦证监会

都支持块压缩或流压缩。

请参阅[https://developer.apple.com/library/mac/documentation/Performance/Reference/Compression/](https://developer.apple.com/library/mac/documentation/Performance/Reference/Compression/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-06-08T11:14:21.957

如果您只有压缩数据并且知道未压缩的大小，您可以使用：

```
#import "zlib.h"

int datal = [zipedData length];
Bytef *buffer[uncompressedSize];
Bytef *dataa[datal];

[zipedData getBytes:dataa];

Long *ld;

uLong sl = datal;
*ld = uncompressedSize;
if(uncompress(buffer, ld, dataa, sl) == Z_OK)
{
NSData *uncompressedData = [NSData dataWithBytes:buffer length:uncompressedSize];
NSString *txtFile = [[NSString alloc] initWithData:uncompressedData encoding:NSUTF8StringEncoding];
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T19:05:30.427

我相信[zlib](http://www.zlib.net)可以在手机上使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-03T07:04:41.597

相信我，最好的选择是使用 ZipArchive，请参阅：[如何解压缩 AES-256 加密的 Zip 文件？](https://stackoverflow.com/questions/4063725/what-compression-library-to-use-for-iphone-application)

如果需要，准备好寻求帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-06T05:55:54.373

[Objective-Zip](http://code.google.com/p/objective-zip/downloads/list)是另一种选择。请参阅这些出色的[说明](http://www.hindsightlabs.com/blog/2010/12/23/reading-and-writing-zip-files-on-the-iphone/)。

注意我必须通过使用 XCode->Edit->Refactor->Convert to Objective C ARC 将源代码转换为使用 ARC。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T20:32:20.580

NSURL 表示它支持 gzip 编码，因此您只需让 RESTful Web 服务在适当时返回 gzip 编码的内容，您无需做任何事情。所有的解码都将在幕后完成。

# web-services - 从 Delphi Web 服务中查找客户端 IP 和 SOAP 调用信息

> ID：230985
> 
> 赞同：2
> 
> 时间：2008-10-23T18:57:55.903
> 
> 标签：web-services, delphi, soap

我有一个 Delphi Web Server 设置和运行，发布 Web 服务，我想知道一些关于调用 Web 服务的内容：

*   调用 Web 服务的客户端的 IP 地址。
*   关于调用的一些 SOAP 信息，例如用户名和密码。

如何从服务代码中获取此信息？我的类继承自 TSoapDataModule，所以我认为有一种方法可以通过它获取该信息。不过，我找不到怎么做。

```
TMyAppServerDataModule = class(TSoapDataModule, ITMyAppServerDataModule ,
            IAppServerSOAP, IAppServer, ITMySOAPWebService)
// ...my working components and methods... //
end; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T20:46:37.807

您应该能够从调用 GetSOAPWebModule 获得的 TWebModule 对象的 Request 属性中[获得](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate3/EN/html/delphivclwin32/HTTPApp_TWebRequest.html)[TWebRequest](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate3/EN/html/delphivclwin32/WebBrokerSOAP_GetSOAPWebModule.html)。TWebRequest 会告诉你很多关于请求的事情。像 RemoteAddr

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T13:28:09.210

请参阅 GetSOAPWebModule.Request（使用 WebBrokerSoap；）。

# sql-server - 如何持久化计算的 GEOMETRY 或 GEOGRAPHY 列

> ID：230992
> 
> 赞同：10
> 
> 时间：2008-10-23T19:00:30.610
> 
> 标签：sql-server, sql-server-2008, spatial

我正在尝试在 SQL Server 2008 下创建一个包含**GEOMETRY**列及其计算变化的表。

考虑下表，其中计算列返回缓冲几何：

```
CREATE TABLE [dbo].[Test] (
    [Geometry]      GEOMETRY    NOT NULL,
    [Buffer]        FLOAT       NOT NULL,
    [BufferedGeometry] AS ([Geometry].STBuffer([Buffer])) PERSISTED
); 
```

问题在于它会导致以下错误：

> 消息 4994，级别 16，状态 1，行 2 表 'Test' 中的计算列 'BufferedGeometry' 无法持久化，因为列类型 'geometry' 是非字节排序的 CLR 类型。

我搜索了 BOL 和网络，但似乎无法找到解决问题的方法。我真的希望它能够被持久化，这样我就可以有效地索引它。我可以在代码中设置它，但是我可能会出现不一致的数据，因为我在某个时间点需要这两个值。

有人玩过这个并且知道解决方案或解决方法吗？

**更新：Microsoft 在 SQL Server 2012 中添加了此功能。**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T22:18:13.673

我想您可以使用触发器来计算它并将其存储到 [BufferedGeometry] 字段

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-24T12:12:44.890

谁仍然有这样的问题：SQL Server 2012 现在允许它

# security - 使用共享网络搬到办公室 - 我应该注意什么？

> ID：230994
> 
> 赞同：-1
> 
> 时间：2008-10-23T19:00:45.117
> 
> 标签：security, networking

我们正在搬到提供很多东西的廉价办公空间：接待员、复印机、打印机、微波炉和互联网接入——所有这些都与陌生人共享。

我应该问什么来确定网络是否可以安全使用，如果它本身不安全，我该怎么做才能使其安全？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T19:13:12.457

如果您与陌生人共享它，则认为它是一个敌对网络。

您可以将自己的网络部分放在防火墙后面，这样办公室的其余部分就在外面。不过，您可能必须拥有自己的打印机。

要设置这样的防火墙，您只需要使用一个办公室网络连接，并运行您自己的网络连接到您的防火墙机器。通常，墙上的网络端口会回到中央房间，在那里它们被修补到路由器或其他东西中。如果你不信任这个网络，你可以把它当作“外部”网络的另一部分，在你的办公室里运行你自己的内部网络。

不过要注意。如果有人可以实际进入您的办公室，他们就可以访问您的计算机，或者使用您的网线连接笔记本电脑并执行您不允许的操作。您可能不想在办公室计算机上存储任何信息，可能只使用 VNC 会话。或者您可以使用笔记本电脑，而不是将它们留在办公室。如果您可以在物理上锁定您的办公室部分，那将是一个好主意。

除非您使用加密连接，否则切勿通过此网络连接到服务器。SSH 隧道应用于通常未加密的任何内容。

您可以做更多的事情来提高安全性。基本上认为网络是敌对的，并假设有人总是在窃听将是最安全的态度。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-23T19:23:42.527

你会被分配静态办公桌/办公空间吗？或者它更像是一种先到先得的“酒店”安排？

如果您能够拥有一个静态（且安全）的位置，只需将您自己的防火墙路由器粘贴在端口上即可。这样可以排除大部分问题。

* * *

编辑添加：

我不知道您的共享办公室提供商有多复杂，但您可能想问他们是否可以为您和您的同事分配一个虚拟 LAN (VLAN) 组，然后将该 VLAN 放在防火墙后面。这将是最简单的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T19:11:46.187

简而言之：与任何其他公共/共享互联网连接一样小心！

考虑在您自己的电脑和建筑物网络之间连接一些不错的防火墙/路由器（就像您使用互联网上行链路一样）。通过这种方式，您可以控制自己机器之间的所有流量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T19:20:04.610

关于 OP 对 thijs 回答的评论（我还不能添加评论）：

与负责新办公空间的人交谈。与办公室的现有连接必须回到某个地方的接线板/路由器。您也许可以通过他们现有的基础设施将您的特定办公室/设备放到单独的网络上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T19:19:40.337

一个好的硬件防火墙对公司来说是一项极好的投资，但对一个人来说可能有点富有。[Comodo](http://www.download.com/Comodo-Firewall-Pro/3000-10435_4-10750532.html)防火墙可以设置为偏执级别，甚至锁定注册表，并且是免费的。

在您的计算机上安装[Wireshark](http://www.download.com/Wireshark-Network-Protocol-Analyzer/3000-2112_4-10786758.html)，它可以让您查看计算机上的所有网络流量，并且在第二个注释中，您可以看到有多少喋喋不休并关闭不需要的服务。

关闭所有不需要的服务，每个开放的端口都是攻击者可以通过的另一个地方。

使用带有特殊字符的释义而不是密码。除了释义之外，最好有通行卡或指纹读取器，而不是代替。

如果可能，将所有计算机塔、交换机和路由器物理上锁在机柜中。

检查网络并用交换机更换任何集线器（如果发现）。集线器很**糟糕**。

如果扫描仪或复印机在网络上，请确保它们被路由器中的 ACL 覆盖。众所周知，攻击者通过复印机上的调制解调器拨号访问网络。

最后，确保您的网络上没有调制解调器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T19:58:19.807

检查以确保他们没有任何不安全的无线网络。在我的上一份办公室/工作中，不是我们共享空间，而是在我决定将我们的办公室切换到无线路由器的那一天，我发现已经有一个无线局域网从医疗保健设施“向世界开放”我们隔壁办公室的墙。鉴于所有 HIPPA 规则等，我立即告诉他们他们的问题。我记录了与他们的办公室经理的谈话，并向他们发送了一份我们在记录中归档的书面文件......不是因为我是一个好人，而是因为我不想让他们回来说我们在他们的网络上做了一些事情。如果他们的系统不安全，您需要保护自己免受他们在出现问题时将任何事情归咎于您的能力。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-23T20:10:58.923

如果你真的很偏执，你可以在每台计算机上安装 VPN 客户端，并在数据中心拥有一个异地 VPN 服务器......但这会占用你的带宽，并且可能比你想忍受的更复杂.

# svn - 如何将部署到多台服务器的现有网站转换为 SVN 管理且不破坏用户文件？

> ID：230997
> 
> 赞同：0
> 
> 时间：2008-10-23T19:01:12.090
> 
> 标签：svn, deployment

我有一个使用相同代码库的现有网站，但部署在不同服务器上的许多不同配置中。每个配置都有一组用户，他们可以上传个人文件。这些文件存储在每台服务器上的“上传文件”目录中，该目录紧挨着运行该站点的代码。

我正在尝试将代码库引入 Subversion，以便我们可以更好地管理事情，并且还使用 SVN 来简化部署，但是，在每台服务器上，用户文件会有所不同。我知道处理此问题的最佳方法是将用户文件存储在其他地方，但此时，这不是一个选项。

那么，考虑到这一点，鉴于这种情况，我该如何使用 Subversion？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T20:17:55.710

不要以那种方式检查它，你不能覆盖任何东西。对于 config.ini 文件等，您可以在存储库中存储具有不同名称（即 config.ini.tmpl）的模板版本，而不会覆盖实际文件。

将文件夹/文件添加到您的 svn 忽略中，这样您就不会意外签入它们。

导出到新文件夹然后快速编辑 mv 或 httpd.conf 也是很好的做法，apache 重新启动以立即更改为新版本。如果您这样做，您可以复制上传文件和/或保留旧版本作为备份，以防您的部署或新版本的代码出现问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T19:07:19.177

只是不要将该文件夹存储在您的存储库中，例如。永远不要检查那个文件夹。我在这里真的没有看到问题......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-21T13:31:11.063

这是我最终使用的方法：

我检查了开发服务器上的所有内容，包括那里的用户文件。这允许检出整个开发服务器，因此每个人都拥有相同批次的代码。

然后，对于除开发服务器之外的服务器，我复制了服务器上的用户文件，进行干净签出，通过将该目录更新为修订版并将其从工作副本，然后从该服务器复制原始文件。

这似乎工作得很好，虽然它并不理想，但它还没有引起任何问题，因为 Subversion 只是将这些文件视为未版本化。

此外，对于配置文件，我们确实将 .template 附加到这些少量文件中。****************