# StackOverflow 问答 000632000-000632999

# .net - IDisposable 接口如何工作？

> ID：632004
> 
> 赞同：9
> 
> 时间：2009-03-10T19:55:00.220
> 
> 标签：.net, garbage-collection, dispose, idisposable

我知道它用于释放非托管资源，但是，我对何时`Dispose`实际调用感到困惑。我知道它在块的末尾被`using`调用，但是当对象被垃圾收集时它也会被调用吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T20:01:39.737

如果你正确地实现了 IDisposable，你还应该包含一个终结器，它将在你的对象上调用 Dispose()。

如果你这样做，它将被 GC 调用。但是，尝试始终自己处理这些物品仍然是一个非常好的主意。

依赖终结器调用 Dispose 的最大问题是它会发生在您无法控制的另一个线程中。在某些情况下，这可能会产生令人讨厌的后果，包括导致 GC 线程中发生的异常，这是不好的，以及检查一个已处置的字段。这也是为什么在 Dispose() 方法中包含 GC.SuppressFinalize(this) 很重要的部分原因 - 一旦对象被释放，您就不想重新释放它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T19:59:05.187

Dispose 在几个地方被调用：

1.  在 using 块的末尾。
2.  当显式调用时（例如在 try{} finally{} 中。）

建议您在使用完资源后自己调用它，以更好地管理资源。

编辑：我错了。在垃圾收集期间不会调用 Dispose。见[这篇](http://blogs.msdn.com/irenak/archive/2006/10/05/SYSK-212_3A00_--Does-.NET-Garbage-Collector-call-Dispose_3F00_--Dispose-_1320_-Best-Practices_2E00_.aspx)文章。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:58:06.050

Dispose() 在 Using 块的末尾被调用，以便您可以指望在对象超出范围时发生 Dispose 操作（例如关闭数据库连接）。就那么简单。

更新：在对 Dispose 的调用中 没有特定于*非托管资源的内容（尽管这是一种常见用法）。*

**更新 2**：关于 Reed Copsey 开始的线程有一些争论，这对于理解 IDisposable 很有用。我强烈推荐[这篇文章](http://www.devx.com/dotnet/Article/33167/0/page/1)给想要了解更多的人。

简而言之，IDisposable 类允许您通过 Dispose() 方法显式处理资源的释放（通常是非托管资源或数据库连接）。IDisposable 类实例应在“Using”块中创建，以确保实际调用 Dispose 方法。如果您没有这样做（或在“finally”块中显式调用它等），那么您的 Dispose 方法将不会被调用，并且您将孤立您想要清理的对象。在*所有*情况下，我都将 Disposable 类放在 Using blocks 中，你也应该这样做。

作为替代方案，您可以在终结器（类析构函数）中处理资源的清理。这将在类被 GC 时自动调用。这种方法的缺点是您不会明确控制*何时*清理对象并且需要处理一些线程问题。因此，例如，析构函数中的问题很难调试，因为它们是在不同的线程中异步调用的。唯一的好处是你不必像 Dispose 那样记住调用你的析构函数。当然，如果您总是使用 Using 块，这不是问题。

*注意：我 ktrauberman、Reed 和 Pontus 已经提出了一些关于如何绕过我在下面提出的观点的好观点。这就是我所做的，但我不能说这是做事的唯一方法。实际上，Microsoft 甚至建议在某些情况下从您的 Finalizer 调用 Dispose()。但是，我将在此处留下讨论，以说明为什么遵循 Reed 的建议很重要：混合使用 Destructors 和 Dispose() 时要小心。*

我不同意 Reed 的回答的地方在于，您应该通过在终结器中调用 Dispose() 来实现 IDisposable 类。这只是将两种不同的结构混为一谈，很可能会导致问题。例如，如果您确实在 Using 块中创建了 IDisposable 类实例*并*在 Destructor 中调用了 Dispose()，它将被调用两次 - 可能会出现令人讨厌且难以调试的崩溃（同样 - 您无法控制GC）。（旁注：这实际上适用于一般的析构函数——在某些情况下，它们可以被多次调用！）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T19:59:23.660

不，当对象被垃圾收集时，它不会被调用。如果你想要这种行为，你可以使用析构函数（终结器）和`Dispose()`从那里调用。

正如您所说，它被自动调用并结束了一个`using`块。

# web-services - 构建 HTTP 请求的工具

> ID：632007
> 
> 赞同：3
> 
> 时间：2009-03-10T19:56:20.217
> 
> 标签：web-services, http, http-headers

我正在寻找允许我构建自己的 http 请求的最佳工具。就像 Firefox 插件海报一样。

有什么建议么。我正在考虑对 Web 服务进行一些安全测试。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:15:05.213

[Fiddler2](http://fiddler2.com/fiddler2/)是我所知道的用于此类工作的最佳工具 .. 用于编写脚本构建请求以及存储会话以供以后分析的大量功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T20:43:24.083

[cURL](http://curl.haxx.se/)是一个不错的命令行工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T19:58:16.873

[篡改数据](https://addons.mozilla.org/en-US/firefox/addon/966)
[Apache JMeter](http://jakarta.apache.org/jmeter/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:59:37.323

[soapUI](http://www.soapui.org/)非常适合测试 Web 服务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:45:27.400

来自[开放 Web 应用程序安全项目的](http://www.owasp.org/)[WebScarab](http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)。

# .net - .NET WPF XAML“BindingExpression 路径错误：...找不到属性”

> ID：632012
> 
> 赞同：4
> 
> 时间：2009-03-10T19:56:59.233
> 
> 标签：.net, wpf, xaml, binding, properties

我试图将我的 W3CError 类型对象的集合绑定到 WPF ListView 控件。

这是一个不错的 13 行小班...

```
类 W3CError

    公共类型为 ErrorOrWarning
    公共线路为整数
    公共列作为整数
    公共消息作为字符串
    公共 MessageId 作为字符串
    作为字符串的公共解释
    公共源作为字符串

    枚举错误或警告
        验证错误
        验证警告
    结束枚举

结束类

```

它没有用。我在 Visual Studio 的输出窗口中遇到了这些绑定错误：

> System.Windows.Data 错误：39：BindingExpression 路径错误：在 'object' ''W3CError' (HashCode=...)' 上找不到 'Line' 属性。绑定表达式：路径=线；DataItem='W3CError' (HashCode=...); 目标元素是'TextBlock'（名称=''）；目标属性是“文本”（类型“字符串”）

嗯，不，这不是一个属性。它只是公共的。我想这对于 WPF 绑定还不够好？

我通过将我的课程延长到丑陋的 69 行属性样板来让它工作......

```
类 W3CError

    Private _Type 为 ErrorOrWarning
    Private _Line 作为整数
    私有 _Col 作为整数
    私有 _Message 作为字符串
    私有 _MessageId 作为字符串
    Private _Explanation 作为字符串
    私有 _Source 作为字符串

    枚举错误或警告
        验证错误
        验证警告
    结束枚举

    公共属性类型（）作为 ErrorOrWarning
        得到
            返回 _Type
        结束获取
        设置（ByVal 值作为 ErrorOrWarning）
            _Type = 值
        结束集
    结束属性

    公共财产线（）作为整数
        得到
            返回_行
        结束获取
        设置（ByVal 值作为整数）
            _Line = 值
        结束集
    结束属性

    公共属性 Col() 作为整数
        得到
            返回_Col
        结束获取
        设置（ByVal 值作为整数）
            _Col = 值
        结束集
    结束属性

    公共属性 Message() 作为字符串
        得到
            返回_Message
        结束获取
        设置（ByVal 值作为字符串）
            _Message = 价值
        结束集
    结束属性

    公共属性 MessageId() 作为字符串
        得到
            返回_MessageId
        结束获取
        设置（ByVal 值作为字符串）
            _MessageId = 值
        结束集
    结束属性

    公共属性说明（）作为字符串
        得到
            返回_说明
        结束获取
        设置（ByVal 值作为字符串）
            _解释=价值
        结束集
    结束属性

    公共属性 Source() 作为字符串
        得到
            返回_Source
        结束获取
        设置（ByVal 值作为字符串）
            _来源 = 价值
        结束集
    结束属性

结束类

```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T20:00:24.997

如果您使用的是 C#，我会说使用自动属性，但我认为它们不在 VB 中。

所以可能不会。您甚至可能想要更进一步，让您的类实现 INotifyPropertyChanged，以便您的 UI 知道属性是否更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T02:03:24.767

我不会称其为**更好**的方法，但是您可以[`ICustomTypeDescriptor`](http://msdn.microsoft.com/en-us/library/system.componentmodel.icustomtypedescriptor.aspx)通过该方法将字段实现并公开为假属性[`GetProperties`](http://msdn.microsoft.com/en-us/library/system.componentmodel.icustomtypedescriptor.getproperties.aspx)。不过，如果你有几十个字段，它最终只会减少代码。

* * *

*最初由 Robert Macnee 发布，但后来被删除。在这里恢复是因为它让我感兴趣...*

# jquery - 如何使用 jquery 获取没有 Id 的动态创建的子元素的高度

> ID：632022
> 
> 赞同：6
> 
> 时间：2009-03-10T19:58:50.057
> 
> 标签：jquery, html, height

我有一个 div，它总是动态加载两个图像，并且可能在两者之间加载一个 div。图像或 div 都没有与它们关联的 id（我不能让它们有 Id）。用萤火虫检查它们，它们只是显示为`<IMG>`和`<DIV>`。当它存在时，我需要获取这个子 div 的高度。

我希望我能做这样的事情......

```
$("#parentDiv > DIV").height(); 
```

或这个...

```
$("#parentDiv > DIV")[0].height(); 
```

由于 jquery $ 返回一个数组。第二个给出了 javascript 错误，所以我知道我已经离开了。我认为这些应该很接近。有任何想法吗？

**编辑：** 这是我正在运行的 html。

```
<DIV id="parentDiv" name="parentDiv">
    <IMG style="DISPLAY: block; VERTICAL-ALIGN: bottom; CURSOR: pointer" height="17" src="..." />

    <!-- this div may or may not be here -->
    <DIV style="DISPLAY: block; BACKGROUND-IMAGE: url(...); WIDTH: 16px; CURSOR: pointer; BACKGROUND-REPEAT: repeat-y; POSITION: relative; HEIGHT: 144px; outline: none">
        <DIV style="LEFT: 0px; OVERFLOW: hidden; WIDTH: 16px; POSITION: absolute; TOP: 128px; HEIGHT: 8px">
             <IMG style="LEFT: 0px; POSITION: absolute; TOP: 0px" height="8" src="..." />
        </DIV>
    </DIV>

    <IMG style="DISPLAY: block; VERTICAL-ALIGN: bottom; CURSOR: pointer" height="17" src="..." />
</DIV> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T20:30:33.740

要获取索引的 jQuery 元素，请使用以下`eq()`函数：

```
$("#parentDiv > DIV").eq(0).height(); 
```

或者

```
$($("#parentDiv > DIV")[0]).height(); 
```

或者

```
$("#parentDiv > DIV:eq(0)").height(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T23:24:36.380

只是添加到所有其他方式：

```
$("#parentDiv > div:first").height(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:05:12.833

只要您的选择器没问题，您的第一个就可以工作。试试下面的，看看你得到了什么：

```
$("#parentDiv > DIV").css("background", "pink"); 
```

如果您没有得到预期的粉红色背景，请修复您的选择器，它也可以与高度语句一起使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T23:20:53.940

尝试

```
$($("#parentDiv > div")[0]).height(); 
```

这应该够了吧

# sql-server - 如何撤销 system_views 的 SELECT 权限公开

> ID：632029
> 
> 赞同：0
> 
> 时间：2009-03-10T20:00:24.297
> 
> 标签：sql-server, sql-server-2005, tsql

我有以下 T-SQL 来显示授予我的 SQL Server 2005 上的主体的所有权限：

```
select dp.NAME AS principal_name, --1
  dp.type_desc AS principal_type_desc, --2
  o.NAME AS object_name, --3
  p.permission_name, --4
  p.state_desc AS permission_state_desc --5
from    sys.database_permissions p
  left    OUTER JOIN sys.all_objects o
  on     p.major_id = o.OBJECT_ID
  inner   JOIN sys.database_principals dp
  on     p.grantee_principal_id = dp.principal_id
order by principal_name, object_name 
```

结果显示 public 并授予 SELECT：

```
 1      2             3            4      5
 ...
 public DATABASE_ROLE system_views SELECT GRANT
 .... 
```

我认为 object_name system_views 适用于我的数据库 Views|system_views 文件夹中的所有视图。我尝试了以下 T-SQL （只是为了看看它是否再次被 GRANT 工作）：

```
GRANT SELECT ON system_views TO public 
```

我收到错误“找不到对象'system_views'，因为它不存在或您没有权限”。我确实将 SQL 服务器连接为 sa。

我的问题是如何为公共（用户或主体？）撤销对 system_views 的 SELECT 权限，并在必要时回滚权限。第二个问题是，撤销 system_views for public 是否对其他用户有任何副作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T04:24:44.977

没有理由撤销查看系统视图的权限。用户只能看到他们已经有权访问的对象，因此他们已经知道这些对象存在。

如果您想授予用户查看数据库中所有对象的权限，则授予他们查看架构或数据库的定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T23:28:47.320

从 sys.system_views 中选择 *

公众是否对其中任何一个有查看定义？

我强烈建议不要乱搞这些。

你可以

```
DENY VIEW DEFINITION ON SCHEMA::DBO TO PUBLIC 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T04:30:59.390

公众是一个“[特殊](http://msdn.microsoft.com/en-us/library/ms189121(SQL.90).aspx)”的角色。不要惹它。例如，默认情况下，每个用户都是公共成员。

[元数据可见性](http://msdn.microsoft.com/en-us/library/ms187113(SQL.90).aspx)实际上决定了用户看到的内容。因此，即使有人这样做`SELECT * FROM sys.columns`，他们也只会看到他们拥有权限的对象的列。没有其他权限 = 只有系统视图列的信息。

如果你这样做，你可能会破坏一些东西，尤其是在 SSMS 或直接访问客户端（Access、Excel 等）中

# java - 覆盖 Java 泛型方法

> ID：632033
> 
> 赞同：3
> 
> 时间：2009-03-10T20:01:56.897
> 
> 标签：java, generics, contravariance

我想创建一个用于将对象复制到同一类的目标对象的接口。简单的方法是使用强制转换：

```
import org.junit.Test;
import org.junit.internal.runners.JUnit4ClassRunner;
import org.junit.runner.RunWith;

@RunWith(JUnit4ClassRunner.class)
public class TestGenerics {
public static interface Copyable {
    public void copy(Copyable c);
}

public static class A implements Copyable {
    private String aField = "--A--";
    protected void innerCopy(Copyable c) {
        A a = (A)c;
        System.out.println(a.aField);
    }
    public void copy(Copyable c) {
        innerCopy(c);
    }
}

public static class B extends A {
    private String bField = "--B--";
    protected void innerCopy(Copyable c) {
        B b = (B)c;
        super.innerCopy(b);
        System.out.println(b.bField);
    }
}

@Test
public void testCopy() {
    Copyable b1 = new B();
    Copyable b2 = new B();
    b1.copy(b2);
}
} 
```

但我也找到了一种可以使用泛型完成的方法：

```
import org.junit.Test;
import org.junit.internal.runners.JUnit4ClassRunner;
import org.junit.runner.RunWith;

@RunWith(JUnit4ClassRunner.class)
public class TestGenerics {
    public static interface Copyable<T> {
        public void copy(T t);
    }

    public static class A<T extends A<?>> implements Copyable<T> {
        private String a = "--A--";
        public void copy(T t) {
            System.out.println(t.a);
        }
    }

    public static class B<T extends B<?>> extends A<T> {
        private String b = "--B--";
        public void copy(T t) {
            super.copy(t);
            System.out.println(t.b);
        }
    }

    @Test
    @SuppressWarnings("unchecked")
    public void testCopy() {
        Copyable b1 = new B();
        Copyable b2 = new B();
        b1.copy(b2);
    }
} 
```

虽然我发现摆脱警告的唯一方法是注释。而且感觉好像出了点问题。那么有什么问题呢？我可以接受问题的根源有问题。因此，欢迎任何形式的澄清。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-11T04:16:15.197

您的接口定义：

```
public interface Copyable<T extends Copyable<T>> {
    void copy(T copyFrom);
} 
```

您的实施：

```
public class Example implements Copyable<Example> {
    private Object data;
    void copy(Example copyFrom) {
        data = copyFrom.data;
    }
    //nontrivial stuff
} 
```

那应该照顾你的警告。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T20:05:06.373

假设您不想进一步子类化，您只需要：

```
public static /*final*/ class AClass implements Copyable<AClass> { 
```

对于一个抽象类，你做“枚举”的事情：

```
public static abstract class AClass<T extends AClass<T>> implements Copyable<T> { 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-11T03:59:04.927

在 testCopy 中，警告之一是因为您正在实例化 Copyable 的“原始类型”，而不是一些具体的 Copyable<T>。实例化 Copyable 后，它只能应用于 Ts（包括 T 的子类型）。为了使用正式类型进行实例化，需要稍微更改类定义：

```
public static class A<T extends A> implements Copyable<T>
public static class B<T extends B> extends A<T> 
```

下一个问题是 Copyable<B> 只能传递 B 的编译时类型（基于 Copyable 的定义）。上面的 testCopy() 传递了一个可复制的编译时类型。以下是一些可行的示例，并附有简要说明：

```
public void testExamples()
{
    // implementation of A that applies to A and subtypes
    Copyable<A> aCopier = new A<A>();

    // implementation of B that applies to B and subtypes
    Copyable<B> bCopier = new B<B>();

    // implementation of A that applies to B and subtypes
    Copyable<B> bCopier2 = new A<B>();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T02:53:01.107

我一直在尝试找出一种方法来消除您第一种方法中的警告，但我想不出任何可行的方法。即便如此，我认为第一种方法是两害相权取其轻。一个不安全的演员比需要给你的类一个如此复杂的 api 更好。

一种完全独立的方法是覆盖 Object.clone() 并实现 Cloneable。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-11T08:53:34.437

这是第二种方法的最佳代码。它编译时没有任何警告。

```
import static org.junit.Assert.fail;

import org.junit.Test;
import org.junit.internal.runners.JUnit4ClassRunner;
import org.junit.runner.RunWith;

@RunWith(JUnit4ClassRunner.class)
public class TestGenerics {
    public static interface Copyable<T> {
        public void copy(T t);
    }

    public static class A<T extends A<T>> implements Copyable<T> {
        private String a = "--A--";
        public void copy(T t) {
            System.out.println(t.a);
        }
        @SuppressWarnings("unchecked")
        public static Copyable<Object> getInstance() {
            return new A();
        }

    }

    public static class B<T extends B<T>> extends A<T> {
        private String b = "--B--";
        public void copy(T t) {
            super.copy(t);
            System.out.println(t.b);
        }
        @SuppressWarnings("unchecked")
        public static Copyable<Object> getInstance() {
            return new B();
        }
    }

    @Test
    public void testCopy() {
        Copyable<Object> b1 = B.getInstance();
        Copyable<Object> b2 = B.getInstance();
        Copyable<Object> a = A.getInstance();
        b1.copy(b2); // this works as intended
        try {
            b1.copy(a); // this throws ClassCastException
            fail();
        } catch (ClassCastException cce) {
        }
    }
} 
```

而且我还通过反思弄清楚了这个程序中发生的所有事情：

```
 for (Method method : A.class.getMethods()) {
               if (method.getName().equals("copy")) {
                       System.out.println(method.toString());
               }

       }
       for (Method method : B.class.getMethods()) {
               if (method.getName().equals("copy")) {
                       System.out.println(method.toString());
               }

       } 
```

这是输出：

```
public void com.sbp.core.TestGenerics$A.copy(com.sbp.core.TestGenerics$A)
public void com.sbp.core.TestGenerics$A.copy(java.lang.Object)

public void com.sbp.core.TestGenerics$B.copy(com.sbp.core.TestGenerics$B)
public void com.sbp.core.TestGenerics$B.copy(com.sbp.core.TestGenerics$A)
public void com.sbp.core.TestGenerics$A.copy(java.lang.Object) 
```

代表着：

1.  A 和 B 中的 copy(...) 方法使编译器生成“桥” - 每种方法有 2 种不同的方法，一种具有来自祖先的 reifed 参数类型（来自 Copyable 的 reified T 变为 Object，来自 A 的 reified “T extends A”变为 A ) 这就是为什么它是覆盖而不是重载的原因，而另一个具有用于定义类的具体参数类型的原因。第一种方法（带有自动生成的主体）*向下转换*其参数以调用第二种方法（他们称其为桥）。由于这种向下转换，如果我们调用 b1.copy(a)，我们会在运行时得到 ClassCastException。

2.  看起来直接类型转换对于我的问题来说是更清洁和更好的工具，并且泛型更好地用于其直接目的 - 强制编译时类型检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-22T06:57:56.217

我已经学习了 Scala，现在我知道 2 年前我想要的东西可以通过**逆变类型参数**和 Scala 的类型系统来实现：

```
trait CopyableTo[-T] {
  def copyTo(t: T)
}

class A(private var a: Int) extends CopyableTo[A] {
  override def copyTo(t: A) {
    println("A:copy")
    t.a = this.a
  }
}

class B(private var a: Int, private var b: Int) extends A(a) with CopyableTo[B] {
  def copyTo(t: B) {
    println("B:copy")
    super.copyTo(t)
    t.b = this.b
  }
}

@Test
def zzz {
  val b1 = new B(1, 2)
  val a1 = new A(3)
  val b2 = new B(4, 5)
  b1.copyTo(a1)
  a1.copyTo(b1)
  b1.copyTo(b2)
} 
```

Java 类型系统对此太弱了。

# .net - 相当于.net中的SoftReference？

> ID：632039
> 
> 赞同：6
> 
> 时间：2009-03-10T20:04:24.800
> 
> 标签：.net, garbage-collection, weak-references, soft-references

我熟悉`WeakReference`，但我正在寻找一种*仅*在内存不足时才清除的引用类型，而不仅仅是每次 gc 运行时（就像 Java 一样`SoftReference`）。我正在寻找一种实现内存敏感缓存的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T20:36:32.523

ASP.NET 缓存为您提供所需的内存敏感行为，但缺点是所有内容都需要唯一键。但是，您应该能够持有对已放置在 ASP.NET 缓存中的对象的 WeakReference。缓存的强引用将阻止 GC，直到缓存决定需要清除它以释放内存。WeakReference 使您可以访问对象，而无需使用缓存键进行查找。

```
Foo cachedData = new Foo();
WeakReference weakRef = new WeakReference( cachedData );
HttpRuntime.Cache[Guid.NewGuid().ToString()] = cachedData;

...

if ( weakRef.IsAlive )
{
    Foo strongRef = weakRef.Target as Foo;
} 
```

您可以通过沿以下行扩展 WeakReference 来创建 SoftReference 类

```
class SoftReference : WeakReference
{
    public SoftReference( object target ) : base( target )
    {
        HttpRuntime.Cache[Guid.NewGuid().ToString()] = target; 
    }
} 
```

您还需要覆盖 Target 上的设置器，以确保任何新目标都进入缓存。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T20:12:23.143

也许 ASP.NET 缓存类 ( [System.Web.Caching.Cache](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx) ) 可能有助于实现您想要的？如果内存不足，它会自动删除对象：

*   [ASP.NET 缓存概述](http://msdn.microsoft.com/en-us/library/ms178597.aspx)

[这是一篇文章](http://www.codeproject.com/KB/cs/cacheinwinformapps.aspx)，展示了如何在 Windows 窗体应用程序中使用 Cache 类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T20:14:36.773

除了 ASP.NET 缓存之外，还有来自 Microsoft 模式和实践组的缓存应用程序块。

[http://msdn.microsoft.com/en-us/library/cc309502.aspx](http://msdn.microsoft.com/en-us/library/cc309502.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-09T18:49:33.327

尽管 a`SoftReference`似乎是一种实现内存缓存的便捷方式，但它需要 Java 运行时做出一些武断的决定，以确定保留对象的好处是否超过存储它的成本。不幸的是，运行时有关保留对象的实际成本的信息有限（请记住，实际成本可能包括应用程序的内存使用对其他应用程序的影响），并且实际上没有关于保留对象的好处的信息.

如果即使不存在对它的外部强引用，也值得保留一个对象，那么缓存应该保留对它的强引用（至少只要它看起来有价值）。如果将对象保存在缓存中的好处只会在外部引用存在的情况下扩展（例如，因为生成实例很便宜，但是拥有两个保存相同数据的逻辑实体使用相同的实例来保存它们将有助于这些实体之间的比较)，应该使用`WeakReference`.

顺便说一句，如果我有我的 druthers，.net 将支持另一种我在任何平台上都没有见过的引用：“其他人感兴趣的”引用，它将与`WeakReference`. “其他人感兴趣”的引用可以用作强引用，但`WeakReference`如果对其目标的唯一强引用是“其他人感兴趣”，则适当配置的引用将无效。在使用并发 GC 时，这样的概念可以提高效率，在弱事件处理程序会重复生成对其目标的强引用的情况下。如果没有人真正对事件处理程序对其目标所做的事情感兴趣，那么如果处理程序可以取消订阅，那将是可取的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:11:05.470

不，没有等价物。有没有什么特别的原因为什么`WeakReference`不做这项工作？

这是一个与您类似的问题：

[为什么 .NET 没有像 Java 那样的 SoftReference 和 WeakReference？](https://stackoverflow.com/questions/324633/why-doesnt-net-have-a-softreference-as-well-as-a-weakreference-like-java)

# java - 如何从 XML 中提取子元素到 Java 中的字符串？

> ID：632043
> 
> 赞同：8
> 
> 时间：2009-03-10T20:05:15.533
> 
> 标签：java, xml

如果我有一个 XML 文档

```
<root>   
   <element1>
        <child attr1="blah">
           <child2>blahblah</child2>
        <child>   
   </element1> 
</root> 
```

我想获得一个带有第一个子元素的 XML 字符串。我的输出字符串是

```
<element1>
    <child attr1="blah">
       <child2>blahblah</child2>
    <child>
</element1> 
```

方法有很多，希望看到一些思路。我一直在尝试为此使用 Java XML API，但尚不清楚是否有一种好方法可以做到这一点。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T21:04:09.290

你是对的，使用标准 XML API，没有一个好方法 - 这是一个例子（可能是 bug 缠身；它运行，但我很久以前写过它）。

```
import javax.xml.*;
import javax.xml.parsers.*;
import javax.xml.transform.*;
import javax.xml.transform.dom.*;
import javax.xml.transform.stream.*;
import org.w3c.dom.*;
import java.io.*;

public class Proc
{
    public static void main(String[] args) throws Exception
    {
        //Parse the input document
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document doc = builder.parse(new File("in.xml"));

        //Set up the transformer to write the output string
        TransformerFactory tFactory = TransformerFactory.newInstance();
        Transformer transformer = tFactory.newTransformer();
        transformer.setOutputProperty("indent", "yes");
        StringWriter sw = new StringWriter();
        StreamResult result = new StreamResult(sw);

        //Find the first child node - this could be done with xpath as well
        NodeList nl = doc.getDocumentElement().getChildNodes();
        DOMSource source = null;
        for(int x = 0;x < nl.getLength();x++)
        {
            Node e = nl.item(x);
            if(e instanceof Element)
            {
                source = new DOMSource(e);
                break;
            }
        }

        //Do the transformation and output
        transformer.transform(source, result);
        System.out.println(sw.toString());
    }
} 
```

看起来你可以通过使用 doc.getDocumentElement().getFirstChild() 来获得第一个子元素，但问题是如果根元素和子元素之间有任何空格，则会在树，您将获得该节点而不是实际的元素节点。该程序的输出是：

```
D:\home\tmp\xml>java Proc
<?xml version="1.0" encoding="UTF-8"?>
<element1>
        <child attr1="blah">
           <child2>blahblah</child2>
       </child>
   </element1> 
```

我认为如果你不需要它，你可以抑制 xml 版本字符串，但我不确定。如果可能的话，我可能会尝试使用第三方 XML 库。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-15T16:47:43.963

因为这是谷歌的最佳答案，对于那些只想要基本的人来说：

```
 public static String serializeXml(Element element) throws Exception
{
    ByteArrayOutputStream buffer = new ByteArrayOutputStream();
    StreamResult result = new StreamResult(buffer);

    DOMSource source = new DOMSource(element);
    TransformerFactory.newInstance().newTransformer().transform(source, result);

    return new String(buffer.toByteArray());
} 
```

我用它来调试，这很可能是你需要的

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T20:07:59.690

我会推荐[JDOM](http://www.jdom.org/)。它是一个 Java XML 库，它使处理 XML 比标准的 W3C 方法容易得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T22:16:22.097

[XMLBeans](http://xmlbeans.apache.org/)是一个易于使用（一旦你掌握了它）的工具来处理 XML，而不必处理解析的烦恼。

它要求您有 XML 文件的架构，但它还提供了一个工具来从现有的 XML 文件生成架构（取决于您的需要，生成的可能很好）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-08-09T10:59:27.307

```
public String getXML(String xmlContent, String tagName){

    String startTag = "<"+ tagName + ">";
    String endTag = "</"+ tagName + ">";
    int startposition = xmlContent.indexOf(startTag);
    int endposition = xmlContent.indexOf(endTag, startposition);
    if (startposition == -1){
        return "ddd";
    }
    startposition += startTag.length();
    if(endposition == -1){ 
        return "eee";
    }
    return xmlContent.substring(startposition, endposition);
} 
```

将您的 xml 作为字符串传递给此方法，在您的情况下将“元素”作为参数标记名传递。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T20:11:00.603

如果您的 xml 有支持它的架构，您可以使用 xmlbeans 或 JAXB 生成帮助您编组/解组 xml 的 pojo 对象。

[http://xmlbeans.apache.org/](http://xmlbeans.apache.org/) [https://jaxb.dev.java.net/](https://jaxb.dev.java.net/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-18T08:29:32.527

由于问题实际上是关于另一个字符串中第一次出现的字符串，我会使用 String 类方法，而不是 XML 解析器：

```
public static String getElementAsString(String xml, String tagName){
    int beginIndex = xml.indexOf("<" + tagName);
    int endIndex = xml.indexOf("</" + tagName, beginIndex) + tagName.length() + 3;
    return xml.substring(beginIndex, endIndex);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-09-14T13:00:32.340

您可以使用以下函数通过传递正确的 xpath 表达式将 xml 块提取为字符串，

```
 private static String nodeToString(Node node) throws TransformerException
{
    StringWriter buf = new StringWriter();
    Transformer xform = TransformerFactory.newInstance().newTransformer();
    xform.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
    xform.transform(new DOMSource(node), new StreamResult(buf));
    return(buf.toString());
}

    public static void main(String[] args) throws Exception
{
        DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
        DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
        Document doc = dBuilder.parse(inputFile);

        XPath xPath = XPathFactory.newInstance().newXPath();
        Node result = (Node)xPath.evaluate("A/B/C", doc, XPathConstants.NODE); //"A/B[id = '1']" //"//*[@type='t1']"

        System.out.println(nodeToString(result));

} 
```

# php - 希望在新的 Mac 上开始使用 Apache、PHP、MySQL、Python、Django

> ID：632046
> 
> 赞同：1
> 
> 时间：2009-03-10T20:07:13.810
> 
> 标签：php, python, django, macos, osx-leopard

我一直在寻找其他问题，但找不到任何问题...

我刚刚安装了带有 OSX 10.5 的 Mac。我需要为一份新工作学习 Python/Django，所以想要正确设置它，准备好使用[http://localhost/从我的浏览器开发和运行](http://localhost/)

我来自 PHP 背景，之前一直使用 MAMP。但我想让所有东西一起工作……Apache、PHP、MySQL、Python、Django。使用 MAMP 很容易安装本地开发服务器，但我也想让 Python 和 Django 运行良好。所以我可以开始开发并遵循 Python/Django 的教程。

请给我一些步骤（无论是否使用 MAMP），以便为 Apache、PHP、MySQL、Python 和 Django 获得一个良好的工作环境。谢谢大家，祝大家天天开心！

詹姆士

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T20:19:07.963

为什么不试试[官方安装说明](http://docs.djangoproject.com/en/dev/intro/install/#intro-install)？实际上，您需要做的就是安装 Django。您可以使用其内置服务器（`http://localhost:8000`默认情况下）进行测试：

```
./manage.py runserver 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T20:15:16.040

你的 Mac 应该预装 Python 2.4（或更高版本），这对于 Django 1.0.2 来说很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T16:04:48.970

I also came from PHP a few months ago. I'm not sure if this will get moderated up or down because my answer changes your question:

1.  Do not use MySQL and Apache for local development on your Mac. Use Sqlite3 and the development server that is bundled with Django - this allows for inline debugging, etc...
2.  Sqlite3 is basically the same as MySQL except you need to use .schema instead of describe.
3.  If you start having problems, get [MacPython](http://wiki.python.org/moin/MacPython/Leopard). This has helped me instantly solve problems faster than trying to work with the stock Python on Leopard.
4.  Try to use [pip](http://pypi.python.org/pypi/pip) instead of easy_install where possible.

When you are ready for real deployment, then you'll need MySQL/Apache/Nginx, etc... but those will be on a Linux system and you'll be better prepared at that point to make a good production installation than you are now. Getting a production-quality stack running on the Mac is more of a pain than it's worth.

BTW, when you do install Apache, use wsgi, not mod_python.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T20:25:13.020

10.5 附带默认安装的 Apache 系统偏好设置 > 共享 > Web 共享。

要启用 Apache php 模块，请编辑 Apache conf (/etc/Apache/httpd.conf) 文件并取消注释 php 模块行。

```
LoadModule php5_module libexec/apache2/libphp5.so. 
```

通过禁用和启用网络共享重新启动 Apache

Mysql包可以从官网下载，安装方便

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:34:50.330

开始使用 Django 的最快方法是使用 TurnKey linux Django 设备。

链接：[http ://www.turnkeylinux.org/appliances/django](http://www.turnkeylinux.org/appliances/django)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-10T20:26:55.620

好的。我只是从他们的站点安装 MySQL 并坚持使用 10.5 版本的 Mac 上已有的内容，然后安装 Django 和 Python MySQL 驱动程序。但既然你喜欢 MAMP，请安装[MAMP](http://www.mamp.info/)或[XAMPP](http://www.apachefriends.org/en/xampp.html)并阅读类似[这样](http://antoniocangiano.com/2007/12/22/how-to-install-django-with-mysql-on-mac-os-x/)的总结：

*Mac OS X 10.5 附带“Python 2.5.1*，因此您不必安装它。您可以通过在终端中运行 python 来验证这一点。”

*结帐 Django* `cd $HOME/Code; svn co http://code.djangoproject.com/svn/django/trunk django_trunk`

*告诉 Python Django 在哪里* `echo "$HOME/Code/django_trunk">/Library/Python/2.5/site-packages/django.pth`

*将 django-admin.py 添加到您的 PATH*

*从[sf.net](http://sourceforge.net/project/showfiles.php?group_id=22307)*安装 MySQLdb 驱动程序*，这可能需要 GCC，这意味着您可能需要使用 Apple 开发工具中的 Xcode 设置。*

 **进行源代码编辑*

“此时，编辑_mysql.c文件，将第37、38、39行注释掉如下：”

```
//#ifndef uint
//#define uint unsigned int
//#endif 
```

跑

```
python setup.py build
sudo python setup.py install 
```

*验证安装*

# iphone - UITableViewCell 表格滚动出视图时的奇怪行为

> ID：632053
> 
> 赞同：2
> 
> 时间：2009-03-10T20:09:02.030
> 
> 标签：iphone, objective-c, cocoa-touch

我有一个扩展 UITableViewCell 的类。出于本练习的目的，我们将其称为“CustomCell”。在 CustomCell 中，我有一个 UIImageView IBOutlet 设置。在这种情况下，图像实例名称是 myImage。我希望根据从服务器返回的某些标准显示此图像。该数据是一个字典，在本练习中我们将其称为“serverData”。起初，UITableView 渲染得很好，UIImageView 显示在它应该显示的单元格中。当我开始滚动实际的 UITableView 时，会出现问题，图像会丢失。不知何故，它没有被正确地缓存或出列。不确定问题出在哪里或如何更好地改进此代码。这是一段摘录：

```
- (UITableViewCell *)tableView:(UITableView *)tableView
    cellForRowAtIndexPath:(NSIndexPath *)indexPath 
{
    static NSString *CustomCellIdentifier = @"CustomCellIdentifier";
    CustomCell *cell = (CustomCell *)[tableView dequeueReusableCellWithIdentifier:CustomCellIdentifier];
    if (cell == nil)  {
        NSArray *nib = [[NSBundle mainBundle] loadNibNamed:@"CustomCell" 
                                                     owner:self options:nil];

        cell = (CustomCell *)[nib objectAtIndex:0];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
    }      

        NSDictionary *serverData = myData // previously defined.
        if ([[serverData valueForKey:@"foo"] isEqualToString:@"0"]) 
            cell.myImage.hidden = YES;
        cell.accessoryType = UITableViewCellAccessoryDetailDisclosureButton;
        return cell;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T20:24:44.283

出于内存原因，UITableView 在滚动时重用单元格（例如 dequeueReusableCellWithIdentifier）调用。

这意味着您收到的单元格可能已配置为可与该标识符一起有效使用，因此您必须重置所有这些属性。

在您的情况下，我怀疑您正在获得一个带有隐藏图像的单元格，因此这将解决它：

```
 NSDictionary *serverData = myData // previously defined.
  if ([[serverData valueForKey:@"foo"] isEqualToString:@"0"]) 
    cell.myImage.hidden = YES;
  else
    cell.myImage.hidden = NO; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T20:27:49.550

请记住，您的单元格正在被重复使用，因此您需要在每次使用该单元格时重置 cell.myImage.hidden 值

```
 if (cell == nil)  {
            NSArray *nib = [[NSBundle mainBundle] loadNibNamed:@"CustomCell" 
                                                                                                     owner:self options:nil];

            cell = (CustomCell *)[nib objectAtIndex:0];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
    } else {
            cell.myImage.hidden = NO;
    } 
```

# flash - Flash/AS3 将方法传递给方法

> ID：632061
> 
> 赞同：0
> 
> 时间：2009-03-10T20:11:59.697
> 
> 标签：flash, actionscript-3, methods

我正在尝试制作一个转换管理器，并且我希望将一个方法传递给一个方法，因为我想制作一堆不同的单独转换方法，我将它们作为公共静态函数从转换类中获取。

例子

在 TransitionController 类中：

```
public function doTransition(mc:MovieClip, transition:Function = Transitions.Basic):void {
        transition(mc);
    } 
```

在过渡类中：

```
public class Transitions
{

    public static function Basic(mc:MovieClip = null):void {
        // a whole lot of transitional stuff here
        trace("Transitions.Basic:" + mc);
    }

} 
```

这有意义吗？我无法让它工作

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T22:03:13.110

没关系它在其他地方出错了:) 它的工作原理忘记添加冒号 Transition.Basic()

# javascript - 检测 CTRL-N 或用户打开新窗口时的方法

> ID：632062
> 
> 赞同：-1
> 
> 时间：2009-03-10T20:12:01.833
> 
> 标签：javascript, html, new-window

我们如何检测用户何时打开新窗口。用户已经通过身份验证，我们大量使用会话。

我们试图避免`Ctrl`+ `N`javascript 挂钩，但也许这是一种选择。

我假设请求是完全相同的 URL ......与`Ctrl`+ `N`？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-10T20:39:47.523

> 我们试图避免 ctrl-n javascript 钩子

忘了它。虽然理论上您可以尝试使用 Control 键修饰符捕获“n”的按键事件，但还有许多其他方法可以打开更可能使用的新窗口或选项卡，但您将无法去抓。文件->新窗口/选项卡，中键单击或Shift单击链接，中键单击后退/前进按钮，右键单击-在新窗口中打开，在新选项卡中打开书签，双击浏览器图标...

> 用户已经通过身份验证，我们大量使用会话。

这本身不应该是一个问题。我猜你的意思是你的应用程序在会话中转储了它不应该有的各种特定于页面的数据，现在你发现当你打开多个窗口时应用程序会中断？好吧，同情和快乐的重写。

与此同时，你所能做的就是告诉用户“请不要尝试在同一个应用程序上打开两个浏览器窗口”。有一些潜在的方法可以让 JavaScript 在一个页面上通知 JavaScript 同时在同一域中的另一个页面上运行，通常涉及使用 document.cookie 作为页面间通信管道。但这也有点脆弱。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T20:51:23.080

如果打开一个新窗口导致您的应用程序出现问题，那么您应该修复应用程序代码来处理它，而不是尝试应用不一致且不可靠的客户端“绷带”。这是我的意见。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T20:31:44.190

为什么？

无论如何，您无法检测到它。用户不仅可以使用`Ctrl`+打开新窗口，`N`还可以使用**File->New Window**。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T21:04:36.293

您可以将窗口计数放入会话中，然后将其递增`window.onload`和递减`window.onunload`。

想象一下，如果你使用它，我会吐口水，用牙齿吸空气，然后“你比我好，老兄”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-15T15:13:09.070

我为解决此问题所做的工作是在用户进行身份验证时在有效登录时设置窗口名称。

```
<script>

window.name = 'oneWindow';

</script> 
```

然后在母版页上做一个 javascript 检查：

```
<script>

if (window.history.length == 0 || window.name != 'oneWindow') 

//history length to see if it's a new tab or opened in a new window  0 for IE, 1 for FF

//window name to see if it's a CTRL + N new window

</script> 
```

如果检查为真，则隐藏/删除页面的主要内容并显示一条消息，说明他们正在做一些不受支持的事情。

当您的登录页面未绑定到母版页时，此方法有效。

如果您没有母版页，那么我建议您检查所有页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T20:36:15.457

是与否，

如果控件具有焦点，您将始终看到它，否则事件将直接发送到浏览器并且页面上的代码永远不会听到它。

根据我的经验，您无法劫持浏览器的快捷方式，您的里程可能会有所不同。您可能知道它发生了，但浏览器会做它的事情（原因很明显）

在大多数浏览器中，`Ctrl`-的效果`N`是在与旧窗口相同的 URL 处打开一个新窗口，并将其与相同的 sessionID 相关联。

如果可能的话，最好的办法是修改后端代码并允许这样的事情。破坏浏览器的功能从来都不是一件好事。

# mysql - 如何在不锁定的情况下将索引应用于 MySQL / MyISAM 表？

> ID：632067
> 
> 赞同：2
> 
> 时间：2009-03-10T20:12:53.547
> 
> 标签：mysql, myisam

有一个生产表，其中一个非常关键的列（日期）缺少索引，有什么方法可以在不影响用户的情况下应用所述索引？

该表目前每秒大约有 5-10 次插入，因此全表锁定已失效；将这些插入重定向到替代表/数据库，即使是暂时的，也被拒绝（出于公司政治原因）。还有其他方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:15:30.000

据我所知，这对于 MyISAM 是不可能的。每秒插入 5-10 次，你应该考虑 InnoDB，除非你没有读那么多。

您是否使用复制，最好在 Master-Master 设置中使用？（您应该！）如果是这种情况，您可以`CREATE INDEX`在备用服务器上切换角色并执行相同操作，然后再切换回来。请务必暂时禁用复制（使用主-主时）以避免复制`CREATE INDEX`到活动节点。

根据您是否主要使用该表来归档日志或类似的，您还可以查看归档存储引擎。

# c# - FileUpload - 验证是否上传了实际文件

> ID：632074
> 
> 赞同：1
> 
> 时间：2009-03-10T20:14:05.450
> 
> 标签：c#, .net, file-upload

我的 Web 表单上有一个 FileUpload 控件 (FileUpload1)，还有一个“Sumbit”按钮、一个标签和一个包含 UserID 的隐藏字段。我在按钮的单击事件中有以下代码：

```
string path = Server.MapPath("~/userfiles/");

if (FileUpload.HasFile)
{
    try 
    {
        FileUpload1.SaveAs(path + UserID.Value + "/image.jpg");
    }
    catch 
    {
        Label1.Text = "* unable to upload file";
        Label1.Visible = true; 
    }
} 
```

如果我上传一个实际的文件，它会很好。但是，如果我在 FileUpload 的文本框中键入一个不存在的文件名（例如，“c:\a.jpg”，它在我的计算机上不存在），然后单击 Sumbit 按钮，HasFile 仍然返回 true。此外，SaveAs() 不会抛出任何异常，它是一个 void 函数，不返回指示成功或失败的值。如何判断文件是否实际上传？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T20:17:13.897

只需检查它是否存在。

```
if(File.Exists(myFile)){
  //it was uploaded.
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T20:30:09.560

您可以检查 FileUpload.PostedFile.ContentLength 属性

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T20:17:21.447

您可以在调用 SaveAs 之前使用 File.Exists 检查文件是否存在。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T20:32:03.393

嗯……

不确定我是否理解。首先，在您的代码中， FileUpload.HasFile 不会编译。如果应该是 FileUpload1.HasFile。

当我更正此问题并运行您的代码时，如果文件不存在，此行将返回 false ...

您可以使用 File.Exists(path); 上传后检查文件是否存在；文件对象是 System.IO 的一部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T21:06:08.227

这与您的实际问题无关，但您应该验证任何用户输入，特别是如果您希望用户将文件上传到您的网络服务器上的虚拟文件夹。您至少应该检查文件的内容类型是否符合您的预期，或者 - 更好的是，使用 .NET 框架中可用的类过滤（调整大小）图像。

如果您不这样做，用户可能会通过您的站点共享任意内容或在您的服务器上放置恶意文件（例如，包含可能被某些 Web 浏览器执行的脚本的图像）。

通过额外的验证，您还可以验证是否确实发送了内容。

并且：当您通过连接来自表单字段的输入来构建保存路径时，会出现一个非常严重的漏洞（我假设`UserID.Value`是您提到的 POST 参数？）。这允许用户决定在您的服务器上存储内容的位置，更糟糕的是，能够覆盖现有文件！！！

# http - 什么是 WSS 扩展？

> ID：632075
> 
> 赞同：4
> 
> 时间：2009-03-10T20:14:05.557
> 
> 标签：http

我浏览到由 IBM 托管的页面，该页面具有 WSS 扩展...这是 IBM WebSphere 页面吗？

[http://www-03.ibm.com/press/us/en/presskit/23540.wss](http://www-03.ibm.com/press/us/en/presskit/23540.wss)

WebSphere 与托管 JSP（Java 脚本页面）的 TomCat 非常相似。我认为它是 IBM 的 JSP 替代品……但仍然不知道。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-15T21:14:59.127

这代表：WebSphere Application Server Standard

这正是我所认为的。非常类似于 JSP/Tomcat。

# css - 将 CSS 样式应用于子元素

> ID：632100
> 
> 赞同：270
> 
> 时间：2009-03-10T20:19:35.403
> 
> 标签：css, css-selectors

我只想将样式应用于具有特定类的 DIV 内的表：

注意：我宁愿为子元素使用 css-selector。

为什么#1 有效而#2 无效？

1：

```
div.test th, div.test td, div.test caption {padding:40px 100px 40px 50px;} 
```

2：

```
div.test th, td, caption {padding:40px 100px 40px 50px;} 
```

HTML：

```
<html>
    <head>
        <style>
            div.test > th, td, caption {padding:40px 100px 40px 50px;}
        </style>
    </head>
    <body>
        <div>
            <table border="2">
                <tr><td>some</td></tr>
                <tr><td>data</td></tr>
                <tr><td>here</td></tr>
            </table>
        </div>
        <div class="test">
            <table  border="2">
                <tr><td>some</td></tr>
                <tr><td>data</td></tr>
                <tr><td>here</td></tr>
            </table>
        </div>
    </body>
</html> 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：354
> 
> 时间：2009-03-10T20:21:27.850

除了**所有**元素和**所有**元素之外，此代码“ `div.test th, td, caption {padding:40px 100px 40px 50px;}`”将规则应用于类名为`th`的元素所包含的所有元素。`div``test` **`td` **`caption`****

 ****它与“all `td`, `th`and `caption`elements 包含`div`在类为`test`”的元素中的元素不同。为此，您需要更改选择器：

' `>`' 不受某些旧浏览器的完全支持（我在看着你，Internet Explorer）。

```
div.test th,
div.test td,
div.test caption {
    padding: 40px 100px 40px 50px;
} 
```

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2012-05-24T19:23:46.057

```
.test * {padding: 40px 100px 40px 50px;} 
```

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2009-03-10T20:22:54.337

选择`>` [器](http://www.w3.org/TR/CSS2/selector.html#descendant-selectors)仅匹配直接子代，不匹配后代。

你要

```
div.test th, td, caption {} 
```

或更可能

```
div.test th, div.test td, div.test caption {} 
```

编辑：

第一个说

```
 div.test th, /* any <th> underneath a <div class="test"> */
  td,          /* or any <td> anywhere at all */
  caption      /* or any <caption> */ 
```

而第二个说

```
 div.test th,     /* any <th> underneath a <div class="test"> */
  div.test td,     /* or any <td> underneath a <div class="test"> */
  div.test caption /* or any <caption> underneath a <div class="test">  */ 
```

在你原来的`div.test > th`说`any <th> which is a **direct** child of <div class="test">`，这意味着它会匹配`<div class="test"><th>this</th></div>`但不会匹配`<div class="test"><table><th>this</th></table></div>`

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-05-02T06:55:15.287

如果您想在所有子项中添加样式并且没有指定 html 标记，请使用它。

父标签`div.parent`

div.parent 中的子标签，例如,`<a>`等。`<input>``<label>`

代码 ：`div.parent * {color: #045123!important;}`

您也可以删除重要的，它不是必需的

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-11-26T15:32:59.927

这是我最近写的一些代码。我认为它提供了将类/ID 名称与伪类结合的基本解释。

```
.content {
  width: 800px;
  border: 1px solid black;
  border-radius: 10px;
  box-shadow: 0 0 5px 2px grey;
  margin: 30px auto 20px auto;
  /*height:200px;*/

}
p.red {
  color: red;
}
p.blue {
  color: blue;
}
p#orange {
  color: orange;
}
p#green {
  color: green;
}
```

```
<!DOCTYPE html>
<html>

<head>
  <title>Class practice</title>
  <link href="wrench_favicon.ico" rel="icon" type="image/x-icon" />
</head>

<body>
  <div class="content">
    <p id="orange">orange</p>
    <p id="green">green</p>
    <p class="red">red</p>
    <p class="blue">blue</p>
  </div>
</body>

</html>
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-10T20:32:18.167

```
div.test td, div.test caption, div.test th 
```

为我工作。

子选择器 > 在 IE6 中不起作用。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2020-05-06T04:54:53.800

这段代码也可以解决问题，使用 SCSS 语法

```
.parent {
  & > * {
    margin-right: 15px;
    &:last-child {
      margin-right: 0;
    }
  }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-10T20:22:08.707

据我所知：

```
div[class=yourclass] table {  your style here; } 
```

或者在你的情况下，甚至这样：

```
div.yourclass table { your style here; } 
```

（但这适用于`yourclass`可能不是`div`s 的元素）只会影响`yourclass`. 而且，正如 Ken 所说，并非所有地方都支持 > （`div[class=yourclass]`同样，因此对类使用点符号）。

# nhibernate - NHibernate - 为属性/列设置长度属性有什么意义吗？

> ID：632107
> 
> 赞同：3
> 
> 时间：2009-03-10T20:21:46.477
> 
> 标签：nhibernate, nhibernate-mapping

属性/列的定义通常如下所示：

```
<property name="DocumentSummary" column="DocumentSummary" length="100" type="String">
   <column name="DocumentSummary" />
</property> 
```

我假设 NHibernate 将在插入/更新行之前使用长度属性验证数据。不幸的是，这似乎是无效的假设。所以问题是 NHibernate 是否对任何东西使用长度属性？为每个属性设置它是否有意义？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T20:27:04.310

它使用它来创建数据库定义sql。查看 SchemaExport 类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T20:30:04.163

此外，您可能能够以编程方式从映射中提取长度，请参阅[此](https://stackoverflow.com/questions/516906/getting-column-length-from-hibernate-mappings)问题。请注意，这是针对 Java Hibernate，但我相信您可以将其转换为 NHibernate。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-06-09T04:08:18.643

是的，在字符串列的长度超过默认最大长度的情况下，设置`Length`属性会有所不同。

我们有一列 type `NVARCHAR(MAX)`。如果我们没有设置该`length`属性，如果字符串值的长度大于 4096 个字符，NHibernate 将无法设置字符串值。

（此示例使用 Mapping-By-Code，因为我们在 2017 年 :-)

```
classMapper.Property(
                        tickerFeed => tickerFeed.StaticTickerText,
                        propertyMapper =>
                        {
                             propertyMapper.Column("StaticTickerText");
                             propertyMapper.Length(int.MaxValue);
                        }
                    ); 
```

但是，我们发现我们可以使用`IPropertyMapper.Type`规定它是一个大字符串来获得相同的结果。

```
classMapper.Property(
                        tickerFeed => tickerFeed.StaticTickerText,
                        propertyMapper =>
                        {
                             propertyMapper.Column("StaticTickerText");
                             propertyMapper.Type(NHibernateUtil.StringClob);
                        }
                    ); 
```

我们最终选择了这个`propertyMapper.Type`选项，因为它更明确。

# visual-studio-2008 - 是否有一种干净的方法来证明 Reporting Service 中的文本是正确的？

> ID：632110
> 
> 赞同：4
> 
> 时间：2009-03-10T20:22:02.513
> 
> 标签：visual-studio-2008, text, reporting-services

我正在使用 SQL Reporting Services 创建一个报告，我需要证明文本框中的文本。通过证明将文本与左右边距对齐的平均值。就像在 MS Word 中对齐文本一样。

我浏览了很多，发现只有几个臭的解决方案。

有没有一种干净的方法可以做到这一点？

谢谢，

佩德罗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-11T00:59:24.967

我的理解是，目前还没有直接的方法可以做到这一点，尽管它在开发团队的雷达上。

# wcf - 将 WCF 调用转换为异步 WCF 调用的最佳实践

> ID：632123
> 
> 赞同：3
> 
> 时间：2009-03-10T20:26:14.500
> 
> 标签：wcf, asynchronous

尝试将所有正常的 WCF 调用转换为异步 WCF 调用时，我遇到了问题。我发现我重构了很多代码，但不确定到底该怎么做。我使用了我在[这里](https://stackoverflow.com/questions/537786/calling-wcf-service-asyncronously-in-a-loop)找到的方法，但遇到了我需要按顺序发生的问题。

```
private void btnSave_Click(object sender, RoutedEventArgs e)
{

  List<Item> itemList = GetList();
  foreach(Item i in itemList)
  {
    DoSomeWork(i);

    if(i.SomeID == 0)
    {      
       DoSomeMoreWork(i);  
    }

    UpdateRecord(i)  // this can't execute until the above code is complete

  }
}

private void DoSomeWork(Item i)
{
  // call async method
}

private void DoSomeMoreWork(i)
{
  // call async method
}

private void UpdateRecord(item i)
{
  // call async method
} 
```

重构代码以异步方式工作的最佳方法是什么，或者我是否需要完全重新考虑我的逻辑？我真的必须在任何地方插入计数器和开关以确保在执行其他事情之前完成某些事情吗？

编辑：我这样做的原因是在接下来的几个月中，我们正在将此 WPF 应用程序转换为 Silverlight，这需要异步调用。因此，我正在尝试将我们的常规 WCF 调用转换为 async 以备不时之需。我发现它需要一种不同的思维方式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-08T08:25:03.503

对于您正在做的事情，我想说处理事情的真正地方是对每个项目的服务进行一次调用，而不是 3。

最好，如果项目列表不是很大，请使用整个列表对服务进行一次调用......

```
private void btnSave_Click(object sender, RoutedEventArgs e)
{  
    List<Item> itemList = GetList();  
    foreach(Item i in itemList)  
    {    
        DoAllTheWorkAndUpdate(i);    
    }
} 
```

或者...

```
private void btnSave_Click(object sender, RoutedEventArgs e)
{  
    List<Item> itemList = GetList();  
    foreach(Item i in itemList)  
    {    
        if(i.Id == 0)
        {
            DoLotsOfWorkAndUpdate(i);
        }
        else
        {
            DoSomeWorkAndUpdate(i);
        }

    }
} 
```

或者...

```
private void btnSave_Click(object sender, RoutedEventArgs e)
{  
    List<Item> itemList = GetList();  
    DoTheWorkOnTheWholeList(itemList);
} 
```

换句话说，感觉您的某些职责可能放错了位置-我通常更喜欢提供可以给他们打一个电话的服务。然后，异步性质是无关紧要的，因为您没有执行一系列事件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T03:52:40.853

查看 Juval Lowy（[Programming WCF Services](https://rads.stackoverflow.com/amzn/click/com/0596526997)的作者）的[网站](http://idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11#ConcurrencyManagement)，了解如何在 WCF 中实现异步编程的示例。下载是免费的；您只需提供您的电子邮件地址。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:46:37.303

当您需要在循环内同步时，为什么需要使用异步 WCF 操作，我可能有点困惑。

如果您只是使用异步方法来帮助防止 UI 挂起，那么您可以只使用支持进度更新的 BackgroundWorker 以使 UI 保持最新，而不使用异步 WCF 调用。

您还应该能够从 Async 方法的 Completed 事件中调用各种函数。

只需将事件处理程序连接到已完成的事件，然后在启动异步 WCF 调用时将您的 Item 对象作为 userState 参数传递。这样，您将在每个 Completed 事件触发时将其作为参数。这样，您只会在前一个异步调用完成时执行下一步的处理。

我不知道这是否真的回答了你的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-14T09:13:06.533

尝试使用这个

[http://ayende.com/Blog/archive/2008/03/29/WCF-Async-without-proxies.aspx](http://ayende.com/Blog/archive/2008/03/29/WCF-Async-without-proxies.aspx)

绝对有效的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-08T06:24:06.540

如果您不使用 Silverlight，您可以在一个方法中阻止您的线程，直到其他方法完成，例如使用 ManualResetEvent。但这在 Silverlight 中不起作用，因为所有 WCF 调用都发生在主 UI 线程上，因此如果您阻止该线程，那么*一切都会*阻塞。更好的方法是使用回调来做这样的事情：

```
 public delegate void OperationCallback();

    private void btnSave_Click(object sender, RoutedEventArgs e)
    {

        List<Item> itemList = GetList();
        foreach (Item i in itemList)
        {
            DoSomeWork(i, () =>
            {
                if (i.SomeID == 0)
                {
                    DoSomeMoreWork(i, () =>
                    {
                        UpdateRecord(i);
                    });
                }
                else
                {
                    UpdateRecord(i);
                }
            });

        }
    }

    private void DoSomeWork(Item i, OperationCallback callback)
    {
        // call async method then callback when it completes.
        callback();
    }

    private void DoSomeMoreWork(Item i, OperationCallback callback)
    {
        // call async method, then callback when it completes.
        callback();
    }

    private void UpdateRecord(Item i)
    {
        // call async method
    } 
```

它当然不如同步版本那么清晰，但是如果尽可能多地使用 lambda 表达式，仍然可以保持控制流的可读性。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-07-08T14:57:45.417

将 2 个属性添加到 Item 称为 SomeWorkDone 和 SomeMoreWorkDone 都作为布尔值。创建处理 DoSomeWorkCompleted 和 DoSomeMoreWorkCompleted 的方法。在这些方法中，将相应的布尔属性设置为 true 并调用 UpdateRecord。在 UpdateRecord 中，确保两个 Done 属性都为真，然后完成调用。

您将遇到一些可能的争用问题，但这应该可以帮助您。

# c# - 您预计 CLR 会很快适应 NUMA 吗？

> ID：632131
> 
> 赞同：5
> 
> 时间：2009-03-10T20:28:37.457
> 
> 标签：c#, .net, clr, numa

似乎 NUMA 有望用于并行编程，如果我没记错的话，当前最新的 cpus 已经内置了对它的支持，比如 i7。

您预计 CLR 会很快适应 NUMA 吗？

编辑：我的意思是支持它，并利用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:37:45.750

NUMA 是一种硬件架构，不一定需要直接在 CLR 中采用。有关详细信息，请参阅[NUMA 常见问题解答。](http://lse.sourceforge.net/numa/faq/)

话虽如此，让软件意识到它的架构是有好处的。CLR 团队的人似乎确实意识到缓存一致性等问题，所以我敢打赌，对此有一些优化。此外，C# 4 中任务并行库中调度程序的设计似乎有望更好地利用 NUMA 架构。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T21:04:18.183

使用 NUMA，您基本上拥有每个处理器的内存控制器。您可以使用 Intel QuickPath 和 AMD HyperTransport。问题是，据我所知，目前无论是 i7 还是 Phenom 都没有支持多个 CPU 的主板。

无论如何，这是非常低级的，与CLR无关。操作系统可以利用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:38:51.550

从某种意义上说，NUMA 与 CLR 的内存模型是正交的。换句话说，硬件/操作系统有它的访问方法，CLR 有它的内存模型需求，这取决于 CLR 的实现者来让它们一起玩得很好。在实践中，这很困难，[目前的实现也存在缺陷](http://www.bluebytesoftware.com/blog/2008/07/20/ABitMoreFormalismAsToWhyCLRsMMIsBrokenOnX86x64.aspx "关于为什么 CLR 的 MM 在 x86/x64 上被破坏的更形式主义")。但是由于 CLR 已经在支持 NUMA 的硬件上运行，我不太确定您所说的“尽快适应 NUMA 是什么意思。？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T20:41:09.657

到目前为止，这里的所有答案在强调 NUMA 作为硬件架构方面都是正确的。Joe Duffy 的这篇关于并发和 CLR 的[文章是](http://msdn.microsoft.com/en-us/magazine/cc163552.aspx)一个有趣的读物。

# jboss - 来自 servlet 的 JBoss 5 AS 和 EJB3 bean 注入？

> ID：632139
> 
> 赞同：1
> 
> 时间：2009-03-10T20:31:49.010
> 
> 标签：jboss, ejb-3.0, java-ee-5

我的理解是 JBossAS 5.x 支持在带有 @EJB3 注释的 servlet 中注入 EJB3 bean。我正在使用 JBossAS 5.0.1.GA 的默认配置，但它不起作用。我已经将 mappedName 参数添加到带有会话 bean JNDI 名称的 @EJB 注释中，它只是没有做任何事情。没有明显的错误，只是从未注入过 bean。

会话 bean 在 ejb-jar 中，servlet 在一个战争中，一切都打包在一个耳朵里。手动 JNDI 查找工作得很好。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-11T04:06:34.783

如果您的 web.xml 指向旧版本的规范，则可能会发生这种情况。理想情况下，它应该类似于

```
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.5" 
         xmlns="http://java.sun.com/xml/ns/j2ee" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_5.xsd"> 
```

此[链接](http://java.sun.com/developer/technicalArticles/J2EE/injection/)也可能有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T04:53:20.320

您还应该在 classpath.JAr 文件中检查 EJB3 部署所需的 jar 文件是 jboss-ejb3-ext-api.jar。

# c# - 在 C# 中生成地理参考图像

> ID：632141
> 
> 赞同：3
> 
> 时间：2009-03-10T20:32:16.043
> 
> 标签：c#, geospatial, openlayers, heatmap, geoserver

我想使用 Open Layers 创建一些热图样式的图块以覆盖我们的基本图。基本上，我想将一些边界框划分为一个网格，并根据样本中有多少点落在该网格正方形内，使用不同的颜色显示网格的每个正方形。

涉及的技术有 C#、OpenLayers、SQL Server 2008 和 GeoServer。

我的问题基本上是一种通用方法，我不确定将凿子的尖端放在哪里。

我的最终目标是能够采用任意边界框，计算适合该边界框的 x 英里 x 英里网格，迭代单个点的集合并将它们分配给一个网格正方形或另一个网格可以计算每个网格正方形的点密度，然后根据密度为网格着色，然后使用 Open Layers 将其覆盖在 CloudMade 底图上。

任何帮助都将不胜感激，无论是整个事情还是其中的任何一部分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T20:41:11.343

如果您的边界框是轴对齐的，这相当简单。只需制作您的图像，然后手动为其创建一个世界文件。世界文件只有 6 行文本，您已经知道所需的一切（x 和 y 像素大小，左上角的坐标）。

只要确保您使用左上角像素的中心，而不是框的角。

------ 以下是制作世界文件的方法 -------

假设您的边界框的左上角位于 203732x598374，并且您想要一个具有 200 米宽的东 <-> 西和 300 米高的北 <-> 南矩形的图像。

您将制作一个具有适当像素数的图像，然后制作一个包含以下 6 行的世界文件：

```
200
0
0
-300
203632
598524 
```

这对应于：

```
200 == size of one pixel in X
0 == shear1
0 == shear2
-300 == size of one pixel in Y (from top down)
203632 == left edge - 1/2 pixel size (to center on pixel instead of edge of box)
598524 == top edge - 1/2 pixel size (to center on pixel instead of edge of box) 
```

如果您使用 .png 图像，您需要使用相同的名称保存它，但保存为 .pgw。如果您使用 .jpg，它将是 .jgw 等。

有关完整的详细信息，请参阅： [世界文件上的 Wiki](http://en.wikipedia.org/wiki/World_file)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T09:57:37.770

“将一些边界框划分为网格，并根据样本中有多少点落在该网格正方形内，使用不同的颜色显示网格的每个正方形。” 这是一个**栅格**，GeoServer 中有一些[功能](http://geoserver.org/display/GEOSDOC/RasterSymbolizer)可以用颜色阴影、图例等来显示这些。我认为使用这些功能会比在 C# 中创建图像图块更灵活。

从 GeoServer 文档：

> 栅格数据不仅仅是一张图片，它还可以被认为是地理参考信息的网格，就像图形是视觉信息的网格（红色、绿色和蓝色的组合）。与仅包含视觉数据的图形不同，栅格网格中的每个点/像素都可以具有许多不同的属性，其中可能没有一个具有固有的视觉组件。

这在其他 GIS 软件包中也称为专题图或等高线图或热图或 2.5D 图。

您可以使用像[Grass](http://grass.osgeo.org/)这样的免费 G​​IS来[创建](http://grass.osgeo.org/gdp/html_grass63/r.resamp.interp.html)栅格网格，但根据您的描述，您不需要插值（因为每个单元格至少包含一个点），因此滚动您自己的代码可能同样容易。

编辑：有一个开源库[GDAL](http://www.gdal.org/)，您可以使用它来编写[各种格式](http://www.gdal.org/formats_list.html)的光栅文件。有 C# 绑定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T19:11:29.327

我认为计算左上角像素中心的公式是错误的。在该示例中，左上角像素的中心将位于 (203732,598374) 的右下方。那么不应该是下面这个吗？

```
203832 == left edge + 1/2 pixel size (to center on pixel instead of edge of box)
598224 == top edge - 1/2 pixel size (to center on pixel instead of edge of box) 
```

# windows-vista - 在 Vista 上启用/禁用没有管理员权限的硬件？

> ID：632143
> 
> 赞同：0
> 
> 时间：2009-03-10T20:32:21.520
> 
> 标签：windows-vista, admin, device, access-control

我被要求提供一个程序/脚本/任何启用或禁用

*   CD/DVD 驱动器
*   USB 端口
*   软盘 (!) 驱动器

*不需要*管理员权限的设备，也就是说，可以由“普通”用户运行。

理想情况下，类似于命令行实用程序：C:> foobar cdrom /disable

任何指针，提示或线索都非常感激地接受！

谢谢，

罗尼

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:35:37.253

如果没有发现 Vista 中的安全漏洞，就无法做到这一点。他们需要管理员权限是有原因的——这是只有管理员才应该做的事情。

有一个命令行实用程序（devcon.exe，[在此处](http://support.microsoft.com/default.aspx/kb/311272)可用），它将启用/禁用设备，但它仍然需要管理员权限。它的语法是：

`DEVCON disable {device id}` 其中 {device id} 是设备“设备管理器”属性页的“详细信息”选项卡下列出的“硬件 id”之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T20:50:12.350

如果您碰巧在域中，我*认为*您可以通过组策略禁用所有这些。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:55:06.410

您可以编写一个作为特权帐户（例如本地系统）运行的服务，并编写一个与服务器通信的 GUI 前端应用程序。然后，非管理员用户可以运行前端。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T20:35:49.220

首先，您应该检查没有管理员权限的用户是否可以使用设备管理器从 windows ui 执行此操作。我真的很怀疑。

# history - 将 WordStar 从 CP/M 移植到 DOS 的单字节变化是什么？

> ID：632145
> 
> 赞同：15
> 
> 时间：2009-03-10T20:32:35.590
> 
> 标签：history

我在重读 Joel 的[战略信函 II：鸡和蛋的问题](http://www.joelonsoftware.com/articles/fog0000000054.html)时，偶然发现了这个有趣的引述：

> 事实上，WordStar 是通过更改代码中的一个字节来移植到 DOS 的。（真正的程序员可以告诉你那个字节是什么，我早就忘记了）。

通过快速谷歌搜索，我找不到任何其他参考。这是真的还是只是比喻？为了成为“真正的程序员”，单字节变化是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T20:40:47.710

听起来有点夸张，在[这里找到了一些WordStar的历史](http://www.wordstar.org/index.php/wordstar-history)

> **用于 MS-DOS 的 WordStar 3.0**
> 
> 1982年4月
> 
> 在一次通宵的会议中，Jim Fox 修补了 WordStar 的 CP/M-86 版本，使其在 IBM PC 上的 MS-DOS 下运行，以便向 Rubenstein 演示。实际移植是由一群爱尔兰程序员使用英特尔开发系统完成的，该系统运行 ISIS II 操作系统。软件构建在 8" 软盘上完成，然后通过串行电缆将二进制（可执行）文件传输到 IBM PC。

但是......乔尔可能意味着[MS-DOS 1.0 / QDOS](http://www.linfo.org/ms-dos.html)

> MS-DOS 1.0 实际上是 QDOS（Quick and Dirty Operating System）的重命名版本，它是微软于 1981 年 7 月从西雅图的一家公司（恰当地命名为西雅图计算机产品公司）购买的。QDOS 是作为 CP/M 8 的克隆而开发的。 -bit 操作系统，以提供与当今流行的商业应用程序（如 WordStar 和 dBase）的兼容性。CP/M（微型计算机控制程序）是由 Digital Research 的 Gary Kildall 几年前编写的，已成为第一个普遍使用的微型计算机操作系统。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T19:37:02.807

您必须更改多个字节。CP/M-86 可执行文件[(.CMD)](http://en.wikipedia.org/wiki/CMD_file_(CP/M))都有一个 128 字节的标头，这与 .EXE 标头不同。

如果将所有 API 调用限制为 CP/M 和 DOS 的公共子集，则可以使用条件汇编从同一源构建 CP/M 和 DOS 版本：

```
bdos:
       if CPM86
         int 0E0h
       else
         mov ah, cl
         int 21h
       endif 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T20:46:33.687

[这个 Wikipedia 条目](http://en.wikipedia.org/wiki/DOS_COM_executable#MS-DOS_binary_format)声称 CP/M 和 MS-DOS 共享二进制格式。它接着说：

> 虽然文件格式在 MS-DOS 和 CP/M 下是一样的，但这并不意味着 CP/M 程序可以在 MS-DOS 下直接执行，反之亦然；MS-DOS COM 文件包含 x86 指令，而 CP/M COM 文件包含 8080、8085 或 Z80 指令。
> 
> 在 CP/M 3 下，如果 COM 文件的第一个字节是 0xC9，那么这表明存在 256 字节的头；由于 0xC9 对应于 8080 指令 RET，这意味着如果在不支持此扩展的早期版本的 CP/M 上运行 COM 文件将立即终止。

这意味着也许修复/端口正在将第一条指令更改为其他指令，从而允许其余指令执行。不过不确定，这似乎暗示二进制文件一定是“胖”的，这对于遗留二进制文件来说似乎是不合理的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:13:11.750

WordStar 是用 8080 汇编器编写的，如果所有代码都可以放在一个段中，那么当时有工具可以将 8080 转换为 8086 汇编器（8086 指令集旨在允许这样做），所以这是很有可能的。

我在 1979 年首次在 Z80 CP/M 盒子上使用 WordStar。今天的人们可能没有意识到他们是多么幸运——有多少 MS Word 用户会准备好作为安装他们的文字处理器的第一个任务来编写几个小的汇编程序（十六进制！）以有效地连接文字处理器（你*可以*在屏幕和键盘上使用 CP/M 例程，但它们速度慢且无法正常工作）？快乐的时光...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-08T22:41:05.537

“事实上，WordStar 是通过更改代码中的一个字节来移植到 DOS 的。（真正的程序员可以告诉你那个字节是什么，我早就忘记了）。”

2009 年 6 月 8 日星期一下午 6:27。我的假设是 Spolsky 是在谈论 8080 CP/M 到 8086 MSDOS，而这个故事可能是假的。8086 CP/M 从来都不是一个大项目——我的意思是，它*被*MSDOS 彻底粉碎了——有人可能已经将 WordStar 从 8080-CPM 转换为 8086-CPM——正如其他人所指出的那样，使用特殊的8080 到 8086 转换器的东西——*然后*可能只需要更改一个字节。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T20:44:38.887

我不确定乔尔的说法是否准确。也许他的意思是吉姆福克斯制作的演示版本？

见[http://www.wordstar.org/wordstar/history/history.htm](http://www.wordstar.org/wordstar/history/history.htm)

我将引用相关部分：

> 用于 MS-DOS 的 WordStar 3.0
> 
> 1982年4月
> 
> 在一次通宵的会议中，Jim Fox 修补了 WordStar 的 CP/M-86 版本，使其在 IBM PC 上的 MS-DOS 下运行，以便向 Rubenstein 演示。实际移植是由一群爱尔兰程序员使用英特尔开发系统完成的，该系统运行 ISIS II 操作系统。软件构建在 8" 软盘上完成，然后通过串行电缆将二进制（可执行）文件传输到 IBM PC。

（编辑：哎呀，太晚了。其他人已经发现了完全相同的东西：-/请随意忽略我。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-28T21:38:24.687

需要了解的重要一点是，当时 16 位 8086 机器刚刚问世，以取代当前的 8 位机器，CP/M 操作系统是当时的 Windows。 带有用于工作的磁盘驱动器的*所有东西都运行 CP/M。*该版本后来被称为 CP/M-80，以区别于用于 8086 处理器的 CP/M-86。

不幸的是，上市花了很长时间，以至于 QDOS 被编写为有一些东西可以运行程序，这本质上是对 CP/M 功能的快速重新实现（但使用不同的语法）。QDOS后来被微软收购并制成MS-DOS。因此，MS-DOS 实际上有一个深入内部的 CP/M 内核，因此使 CP/M-86 程序在 MS-DOS 下运行所需的工作量是有限的（不是单个字节，而是可管理的）。

我有幸与 CCP/M-86 一起工作了几年，它允许多任务处理，这与今天的 Linux 文本模式（带有虚拟控制台）所允许的非常相似。不幸的是，它从未流行起来。哦，好吧，我们有 Linux :)

# c# - 有没有办法确保我的程序产生的后台进程在我的进程终止时被杀死？

> ID：632148
> 
> 赞同：7
> 
> 时间：2009-03-10T20:33:42.203
> 
> 标签：c#, child-process

基本上，子进程无限期地运行，直到在后台被杀死，当我的程序因任何原因终止时，我想清理它，即通过任务管理器。

目前我有一个 while (Process.GetProcessesByName("ParentProcess").Count() > 0) 循环并在父进程没有运行时退出，但它看起来很脆弱，如果我希望它在 Visual 中的调试器下工作工作室我必须添加“ParentProcess.vshost”或其他东西。

有没有办法确保子进程结束而不需要子进程知道父进程？我更喜欢托管代码中的解决方案，但如果没有，我可以 PInvoke。

编辑：传递 PID 似乎是一个更强大的解决方案，但出于好奇，如果子进程不是我的代码而是我无法控制的某个 exe 怎么办？有没有办法防止可能创建孤立的子进程？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T20:37:09.060

如果子进程是您自己的代码，您可以在启动它时将父进程的 PID 传递给它。然后，子进程可以使用处理程序获取该进程[`Process.GetProcessById`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.getprocessbyid.aspx)并订阅其[`Exited`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.exited.aspx)事件，该处理程序优雅地关闭（子）进程的其余部分。请注意，您需要将[`EnableRaisingEvents`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.enableraisingevents.aspx)进程上的属性设置为`true`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-02-22T16:52:56.557

如果子进程不是您自己的代码，您可以使用此代码查找并杀死所有子进程：

```
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Runtime.InteropServices;

namespace Util {
    public static class ProcessExtensions {
        public static void KillDescendants(this Process processToNotKillYet) {
            foreach (var eachProcess in Process.GetProcesses()) {
                if (eachProcess.ParentPid() == processToNotKillYet.Id) {
                    eachProcess.KillTree();
                }
            }
        }

        public static void KillTree(this Process processToKill) {
            processToKill.KillDescendants();
            processToKill.Kill();
        }

        public static PROCESS_BASIC_INFORMATION Info(this Process process) {
            var processInfo = new PROCESS_BASIC_INFORMATION();
            try {
                uint bytesWritten;
                NtQueryInformationProcess(process.Handle,
                                          0,
                                          ref processInfo,
                                          (uint)Marshal.SizeOf(processInfo),
                                          out bytesWritten); // == 0 is OK
            }
            catch (Win32Exception e) {
                if (!e.Message.Equals("Access is denied")) throw;
            }

            return processInfo;
        }

        public static int ParentPid(this Process process) {
            return process.Info().ParentPid;
        }

        [DllImport("ntdll.dll")]
        private static extern int NtQueryInformationProcess(
            IntPtr hProcess,
            int processInformationClass /* 0 */,
            ref PROCESS_BASIC_INFORMATION processBasicInformation,
            uint processInformationLength,
            out uint returnLength);

        [StructLayout(LayoutKind.Sequential)]
        public struct PROCESS_BASIC_INFORMATION {
            public int ExitStatus;
            public int PebBaseAddress;
            public int AffinityMask;
            public int BasePriority;
            public int Pid;
            public int ParentPid;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T20:38:11.007

此类子进程的通用术语为[孤儿进程](http://en.wikipedia.org/wiki/Orphan_process)。有关一些可能的解决方案，请参阅链接文章。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-23T01:26:28.140

这是我构建的一个小型实用程序应用程序的源代码（它基于 Alan Hensel 解决方案，我发现它非常有用）。

它被称为 ChildrenProcessKiller，它是一个观察者，可以在父进程退出时杀死给定父进程的所有后代进程（即使父进程崩溃）

用法 ：

```
ChildrenProcessKiller.exe parentProcessId 
```

警告：此代码按“原样”提供，可能会杀死小婴儿；-)

ChildrenProcessKiller.cs

```
using System;
using System.Collections.Generic;
using System.Diagnostics;

namespace ChildrenProcessKiller
{
  static class ChildrenProcessKiller
  {
    [STAThread]
    static void Main(string[] args)
    {
      Application.EnableVisualStyles();
      Application.SetCompatibleTextRenderingDefault(false);

      string message = "This is a watcher that enables to kill all descendants process of a given parent process\n";
      message += "when the parent process exits (even if the parent process crashes) \n\n";
      message += "Usage : " + Application.ExecutablePath + " parentProcessId";

      if (args.Length != 1)
      {
        MessageBox.Show(message);
        System.Environment.Exit(1);
      }

      int parentProcessId;
      if (!Int32.TryParse(args[0], out parentProcessId))
      {
        MessageBox.Show(message);
        System.Environment.Exit(1);
      }

      try
      {
        mParentProcess = Process.GetProcessById(parentProcessId);
      }
      catch (System.ArgumentException ex)
      {
        //Parent process cannot be found!
        System.Environment.Exit(2);
      }
      Run();
    }

    private static List<Process> mChildrenProcesses;
    private static Process mParentProcess;

    private static void Run()
    {
      int thisProcessId = Process.GetCurrentProcess().Id;
      while ( ! mParentProcess.HasExited )
      {
        RefreshChildrenProcesses();
        System.Threading.Thread.Sleep(1000);
      }

      foreach (Process childProcess in mChildrenProcesses)
      {
        if ((!childProcess.HasExited) && (childProcess.Id != thisProcessId))
        {
          KillGracefullyThenViolently(childProcess);
        }
      }
    }

    private static void KillGracefullyThenViolently(Process process)
    {
      if (process.HasExited)
        return;

      try
      {
        process.CloseMainWindow();
      }
      catch (PlatformNotSupportedException)
      {}
      catch (InvalidOperationException)
      {}//do nothing : this app is meant to be "unstoppable", unless the parent process has exited

      for (int i = 0; i < 15; i++)
      {
        System.Threading.Thread.Sleep(100);
        if (process.HasExited)
          return;
      }

      try
      {
        process.Kill();
      }
      catch (System.ComponentModel.Win32Exception)
      {}
      catch(NotSupportedException)
      {}
      catch(InvalidOperationException)
      {} //same comment here
    }

    private static void RefreshChildrenProcesses()
    {
      if (mParentProcess.HasExited)
        return;
      List<Process> newChildren;
      try
      {
        newChildren = Utils.ProcessTree.GetProcessDescendants(mParentProcess);
        mChildrenProcesses = newChildren;
      }
      catch (System.Exception ex)
      {
        ; 
      }
    }

  }
} 
```

进程树.cs

```
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Collections.Generic;
using System.IO;
using System.Windows.Forms;

namespace Utils
{
  public static class ProcessTree
  {

    public static List<Process> GetProcessDescendants(Process process)
    {
      List<Process> result = new List<Process>();
      foreach (Process eachProcess in Process.GetProcesses())
      {
        if (ParentPid(eachProcess) == process.Id)
        {
          result.Add(eachProcess);
        }
      }
      return result;
    }

    public static void KillDescendants(Process processToNotKillYet) 
    {
      foreach (Process eachProcess in Process.GetProcesses()) 
      {
        if (ParentPid(eachProcess) == processToNotKillYet.Id) 
        {
          if (eachProcess.Id != Process.GetCurrentProcess().Id)
            KillTree(eachProcess);
        }
      }
    }

    public static void KillTree(Process processToKill) 
    {
      KillDescendants(processToKill);
      processToKill.Kill();
    }

    public static PROCESS_BASIC_INFORMATION Info(Process process) 
    {
      PROCESS_BASIC_INFORMATION processInfo = new PROCESS_BASIC_INFORMATION();
      try
      {
        uint bytesWritten;
        NtQueryInformationProcess(process.Handle,
                        0,
                        ref processInfo,
                        (uint)Marshal.SizeOf(processInfo),
                        out bytesWritten); // == 0 is OK
      }
      catch (Win32Exception e) 
      {
        if (!e.Message.Equals("Access is denied")) throw;
      }

      return processInfo;
    }

    public static int ParentPid(Process process) 
    {
      return Info(process).ParentPid;
    }

    [DllImport("ntdll.dll")]
    private static extern int NtQueryInformationProcess(
      IntPtr hProcess,
      int processInformationClass /* 0 */,
      ref PROCESS_BASIC_INFORMATION processBasicInformation,
      uint processInformationLength,
      out uint returnLength);

    [StructLayout(LayoutKind.Sequential)]
    public struct PROCESS_BASIC_INFORMATION 
    {
      public int ExitStatus;
      public int PebBaseAddress;
      public int AffinityMask;
      public int BasePriority;
      public int Pid;
      public int ParentPid;
    }
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:39:38.180

将父进程 ID 作为命令行参数传递给子进程。

在子进程中使用通过 id 获取进程并订阅它的退出事件或创建一个线程并调用 Process.WaitForExit

# visual-c++ - MFC - 检查 Microsoft Word 程序是否存在

> ID：632158
> 
> 赞同：1
> 
> 时间：2009-03-10T20:36:21.713
> 
> 标签：visual-c++

我想知道是否有任何方法可以通过编程方式确定目标 PC 上是否存在 Microsoft Word（Word 2003）。在 VS2005、C++ 上创建这个应用程序。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T20:43:54.720

您可以创建一个新的`Word.Application`COM 对象并读取该`Version`属性。不幸的是，这需要几秒钟才能加载 Word。（即如果*已*安装）

如果您无法创建对象，则说明没有安装 Word。如果可以创建并且版本号较低，则只有旧版本可用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T20:40:22.407

循环遍历注册表项是一个选项，例如：所有条目下`HKEY_CURRENT_USER\Software\Microsoft\Office`并查看最新版本是什么。取决于您的性能和确切要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:45:41.097

最简单的方法可能是检查`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office`注册表项。

在此树下，每个版本的 Office 都有一个节点，并且在每个版本下，安装的项目都有自己的子项（Excel、Outlook、Word 等），用于指定安装到的路径。

请注意，一台 PC 上可能安装了多个版本。例如我有；

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\9.0
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\11.0
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\12.0 
```

# passwords - 应该允许用户输入开头或结尾有空格的密码吗？

> ID：632167
> 
> 赞同：33
> 
> 时间：2009-03-10T20:37:51.413
> 
> 标签：passwords

用户是否可以输入诸如“12345”或“12345”之类的密码——开头或结尾的空格？或者您是否会修剪密码以删除前导或尾随空格，因为它可能只是输入错误。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-10T20:40:08.537

是的，他们应该。

*   当人们决定我的密码应该如何表现时，尤其是当它是无意义的时候，这让我非常恼火。我想要超过 8 个字符。
*   您应该对密码进行哈希处理，因此最后的最大字符长度和空格无关紧要。

不，你不应该修剪它。

*   您需要用户输入两次密码（在创建密码时）以消除输入错误。因此，空间无关紧要。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-03-10T20:43:42.070

让我告诉你一个故事。

我需要在电子商务网站上创建一个帐户，所以我运行我的随机密码生成器来制作一个 8 个字符的大/小/数字/标点密码，粘贴两次以确认它，完成了我所有个人信息的注册，并且将随机密码保存在本地 PGP 加密文件中以供以后使用。

后来我尝试登录，但再次粘贴密码不起作用。经过一番测试，我惊恐地发现该网站已经从原始密码中删除了所有标点符号，这是在一些错误的清理尝试中，将我的密码减少到三个容易暴力的字母。

不要修剪或清理用户的密码。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-03-10T20:45:34.500

永远不要仅仅为了解决“输入错误”而“清理”密码。这会使用户感到困惑，并且在某些情况下使他们无法登录。事实上，永远不要在用户背后更改密码......总是警告他们密码无效并让他们尝试新密码。

我最近遇到的一个很好的例子是 3Com 交换机。Web 界面允许我更改管理员密码，但没有警告我密码限制为八个字符。我输入了一个超过八个字符的密码。当我在更改后尝试登录时，它只是拒绝了我的密码。但是，如果我只使用前八个字符，我就能够登录（我的尝试和错误，不好玩）。

这些天的密码看起来不像以前那样了。例如，我的密码通常如下所示：

```
Man, this program is really ticking me off! 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-10T20:40:26.180

无论如何，您都应该使用确认字段来验证密码。如果他们打错了两次 - 那么你希望有一个忘记密码或重置功能。

空间无关紧要，因为您不应该将其存储为纯文本。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-10T20:46:06.027

你做出这样的决定的那一刻就是你开始走上微观管理道路的那一刻（在这种情况下是你的用户）。

包含空格的密码会破坏您的系统吗？还是存在安全风险？然后别担心。让您的用户处理他们自己的错误，即使这意味着他们必须感到沮丧。他们的错字永远不应该是你的问题。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-10T21:01:11.357

空格是常规密码字符，您不应删除它。

由于您可能在将密码存储到数据库之前对其进行哈希处理，因此该空间将被视为任何其他字符。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-17T22:10:49.840

我不止一次参加过一个会议，在电脑显示屏已经出现在大屏幕上之后，有人登录他们的帐户进行演示，没有正确地将焦点更改为密码字段，因此他们的密码被泄露给全体观众。

任何可能需要在其他人面前输入凭据的人都应该考虑在密码中保留一个或三个空格，以防万一。在构建身份验证系统时，您*永远不*应该修剪这些空间。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-10T20:47:48.130

我不在乎。只要您在设置密码时对密码执行的任何操作，在稍后输入时也会对其执行。修剪、截断、更改大小写、加盐、散列等等 - 只需始终如一地执行即可。

大概你没有存储实际密码，所以......

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-10T21:06:21.220

如前所述，密码包含它很好，但是我要补充一点，在生成新的随机密码时（例如，对于一个合理的重置丢失密码系统），您应该避免生成包含此类棘手字符的密码。

如果密码足够长且随机，那么这将弥补一些棘手字符的限制，将使最终用户的生活变得更加轻松......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-04-03T17:32:12.430

我投票支持：**不**，他们不应该：

**不允许**用户在密码的开头和结尾使用空格有一个很大的好处，那就是它消除了用户复制和粘贴密码（例如从电子邮件中）时经常出现的问题，它包括空格，这是不是密码的一部分。

然后用户感到沮丧，认为系统已损坏并联系支持。开发人员立即被拉到项目中以检查“错误”的登录过程，结果却花了一天时间拔掉他/她的头发，直到他/她意识到问题所在。

我认为在创建密码时执行此策略解决的问题多于它造成的问题。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-10T20:44:46.793

由于将密码存储为文本是不好的 juju，因此无需 trim() 密码，因为它会立即被散列。

...在类似的说明中，我是否正确地认为密码不需要进行正则表达式验证以进行 sql 注入，因为它们将被散列并且不会作为纯文本插入数据库中？

# python - 导入时自动获取文件的最新版本

> ID：632171
> 
> 赞同：1
> 
> 时间：2009-03-10T20:38:28.057
> 
> 标签：python, version-control, visual-sourcesafe

我有一个我想保持最新的模块，我想知道这是否是一个坏主意：

> 在 site-packages 目录中有一个模块 (mod1.py)，它将另一个模块从其他位置复制到 site-packages 目录，然后从该模块导入 *。

```
import shutil
from distutils.sysconfig import get_python_lib
p_source = r'\\SourceSafeServer\mod1_current.py'
p_local = get_python_lib() + r'\mod1_current.py'
shutil.copyfile(p_source, p_local)
from mod1_current import * 
```

现在我可以在任何模块中执行此操作，并且它始终是最新版本：

```
from mod1 import function1 
```

这行得通....但是有更好的方法吗？

**更新**

这是当前的过程...在源代码控制下有一个具有单个模块的项目：站点包目录 `mod1.py` 中还有一个正在`setup.py` 运行的`setup.py`副本。`mod1.py`

使用该模块的开发人员必须运行`setup.py`以更新该模块。有时，他们没有并且没有最新版本会导致问题。

我希望能够签入新版本，并且导入该模块的任何代码每次都会自动获取最新版本，而无需任何人运行`setup.py`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:45:11.863

你*真的*想这样做吗？这意味着您只需提交源代码控制即可非常轻松地将代码滚动到生产应用程序。对于不了解您的设置的人来说，我认为这是一个令人讨厌的副作用。

话虽如此，这似乎是一个很好的解决方案——您可能希望在网络文件调用周围添加一些异常处理，因为这些调用很容易失败。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T22:49:36.697

In some cases, we put `.pth` files in the Python site-packages directory. The `.pth` files name our various SVN checkout directories.

No install. No copy.

`.pth` files are described [here](http://docs.python.org/library/site.html#module-site).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T02:03:18.573

The original strategy of having other developers copy mod1.py into their site-packages in order to use the module sounds like it's the real problem. Why aren't they just using the same source control are you are?

This auto-copying will make it hard to do rollbacks, especially if other developers copy your strategy. Imagine this same system used for dozens and dozens of files. And then imagine you actually *do* want to use a version of mod1.py that is not the latest for something.

# sharepoint - Sharepoint 任务列表不会在创建项目时发送电子邮件

> ID：632181
> 
> 赞同：2
> 
> 时间：2009-03-10T20:40:28.037
> 
> 标签：sharepoint, email, task

我创建了一个自定义工作流，它在工作流启动时创建一个任务项。 [替代文字 http://img19.imageshack.us/img19/2862/screenshot310200942100p.png](http://img19.imageshack.us/img19/2862/screenshot310200942100p.png)

我还为文档库和任务列表创建了一些自定义内容类型。

对于文档库：首先，我添加一个文档库并将其配置为允许自定义内容类型。然后我添加我的内容类型，它基于文档内容类型。之后，我在工作流设置下添加了一个工作流。在这里，我选择了我的自定义工作流程，给它一个名字并告诉 sharepoint 创建一个新任务列表来存储任务。

对于任务列表：现在我有一个共享点创建的任务列表，我去那里并允许自定义内容类型并确保“在分配所有权时发送电子邮件？” 设置为是。然后我添加了我的两个自定义内容类型，它们都基于工作流任务内容类型。这就是我应该做的。

当我启动我的工作流时，它确实添加了批准任务（我正在使用名为 createApprovalTask​​ 的 CreateTaskWithContentType 活动），但没有为创建的任务发送电子邮件。

我在 createApprovalTask​​ 活动中使用的代码是：

```
// make a new GUID for this task
createApprovalTask_TaskId = Guid.NewGuid();
// set simple properties of task
createApprovalTask.TaskProperties.AssignedTo = "a valid domain\user";
createApprovalTask.TaskProperties.Title = "Review Contract: " + approvalWorkflowActivated_WorkflowProperties.Item.DisplayName;
createApprovalTask.TaskProperties.SendEmailNotification = true; 
```

如果我创建一个文档库并使用 Sharepoint 的内置工作流之一（例如 Approval），并告诉它为其创建一个任务列表，当一个项目添加到该列表时，它会正确发送电子邮件。因此，发送邮件服务器的设置是正确的，因为我们可以正常接收其他电子邮件。

我在 createApprovalTask​​ 活动之后立即使用 SendEmail 活动向提交者发送一封电子邮件，告诉他们我们已收到他们的批准请求。代码类似于：

```
sendApprovalRecievedEmail.Body = emailBody;
sendApprovalRecievedEmail.Subject = emailSubject;
sendApprovalRecievedEmail.To = emailTo;
sendApprovalRecievedEmail.From = emailFrom; 
```

这可行，因此提交者会收到他们的自定义电子邮件，但任务所有者永远不会收到任务项电子邮件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T15:33:56.247

不幸的是，我们的邮件服务器出于某种原因阻止了这些电子邮件。我浪费了 2 1/2 天的时间来寻找这个问题......结果我们的 IT 部门并没有把他们的狗屎放在一起。

谢谢大家。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T20:51:15.590

您必须正确设置共享点外发电子邮件。示例如下面的链接所示

[http://sharepoint-amila.blogspot.com/2008/02/outgoin-email-settings.html](http://sharepoint-amila.blogspot.com/2008/02/outgoin-email-settings.html)

如果您需要通过 c#.net 代码发送电子邮件，您可以使用以下方法在自定义工作流程中发送电子邮件。SPUtility.SendEmail 方法 (Microsoft.SharePoint.Utilities)

示例显示在下面的链接 [http://www.sharepoint-amila.blogspot.com/](http://www.sharepoint-amila.blogspot.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T20:46:10.830

是否可以像使用 createApprovalTask​​.TaskProperties.AssignedTo 一样通过“域\用户”指出 SharePoint 用户？不需要身份证吗？

“id;#域\用户名”

# asp-classic - asp中的FCKeditor工具栏

> ID：632189
> 
> 赞同：1
> 
> 时间：2009-03-10T20:43:04.693
> 
> 标签：asp-classic, fckeditor

我在 FCKeditor 的 config.js 文件中定义了一个自定义工具栏。我不确定如何在 asp 中实现这个工具栏。任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T20:47:17.803

我无法查看该站点（我的工作认为它是免费软件并且对网络构成危险），但您可以指定在创建 COM 实例时使用的工具栏。

[http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Integration/ASP](http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Integration/ASP)

**编辑：就是这样！** [http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Configuration/Toolbar](http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Configuration/Toolbar)

```
<%
Dim oFCKeditor
Set oFCKeditor = New FCKeditor
oFCKeditor.BasePath = "/fckeditor/"
oFCKeditor.ToolbarSet = "MyToolbar"
oFCKeditor.Value = "<p>This is some <strong>sample text</strong>. You are using <a href=""http://www.fckeditor.net/"">FCKeditor</a>."
oFCKeditor.Create "FCKeditor1"
%> 
```

# pdf - 有没有好的 PDF 到 XHTML 严格的转换器

> ID：632202
> 
> 赞同：3
> 
> 时间：2009-03-10T20:46:03.233
> 
> 标签：pdf, xhtml

基本上都在标题中，我需要获取一堆大的 PDF 并严格按照 XHTML 1.0 进行处理，关闭就足够了，然后我可以清理它。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T21:01:31.107

这是一个复杂的请求，因为它是否可以完成取决于 PDF 本身（以及它是如何创建的）。作为第一次尝试，我会尝试使用 adobe 自己的在线 PDF 到 HTML 转换器

[http://www.adobe.com/products/acrobat/access_onlinetools.html](http://www.adobe.com/products/acrobat/access_onlinetools.html)

然后尝试使用 tidy 之类的东西在事后修复 HTML

[http://tidy.sourceforge.net/](http://tidy.sourceforge.net/)

如果 PDF 是通过扫描图像创建的，那么可能根本没有与之相关的文本 - 那么您能做的最好的事情就是将页面切开并将它们转换为 JPG 文档，或者在 PDF 上使用某种 OCR 软件本身。

我警告您，即使 PDF 是手动创建的，因此其中包含文本信息，在转换过程中也可能存在*许多*必须手动修复的错误。我开发的产品基本上为公司年度报告/等执行此过程，我们最终决定将页面切割成 JPG/GIF 图像和 HTML，因为我们尝试的其他过程引入了太多错误，而且劳动强度太大修复它们。

# java - 爪哇；字符串替换（使用正则表达式）？

> ID：632204
> 
> 赞同：172
> 
> 时间：2009-03-10T20:46:09.287
> 
> 标签：java, regex

作为学校项目的一部分，我需要替换表单中的一个字符串：

```
5 * x^3 - 6 * x^1 + 1 
```

类似于：

```
5x<sup>3</sup> - 6x<sup>1</sup> + 1 
```

我相信这可以用正则表达式来完成，但我还不知道该怎么做。

你能帮我一把吗？

PS 实际的任务是实现一个多项式处理 Java 应用程序，我正在使用它来将 polynomial.toString() 从模型传递到视图，并且我想以一种漂亮的方式使用 html 标记来显示它。

* * *

## 回答 #1

> 赞同：219
> 
> 时间：2009-03-10T20:50:14.863

```
str.replaceAll("\\^([0-9]+)", "<sup>$1</sup>"); 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2013-11-20T13:06:00.430

```
private String removeScript(String content) {
    Pattern p = Pattern.compile("<script[^>]*>(.*?)</script>",
            Pattern.DOTALL | Pattern.CASE_INSENSITIVE);
    return p.matcher(content).replaceAll("");
} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-09-08T11:29:23.453

```
String input = "hello I'm a java dev" +
"no job experience needed" +
"senior software engineer" +
"java job available for senior software engineer";

String fixedInput = input.replaceAll("(java|job|senior)", "<b>$1</b>"); 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2016-07-23T21:52:29.503

```
"5 * x^3 - 6 * x^1 + 1".replaceAll("\\W*\\*\\W*","").replaceAll("\\^(\\d+)","<sup>$1</sup>"); 
```

请注意，在单个正则表达式/替换中加入两个替换将是一个糟糕的选择，因为更通用的表达式`x^3 - 6 * x`会失败。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-10T20:54:48.503

```
import java.util.regex.PatternSyntaxException;

// (:?\d+) \* x\^(:?\d+)
// 
// Options: ^ and $ match at line breaks
// 
// Match the regular expression below and capture its match into backreference number 1 «(:?\d+)»
//    Match the character “:” literally «:?»
//       Between zero and one times, as many times as possible, giving back as needed (greedy) «?»
//    Match a single digit 0..9 «\d+»
//       Between one and unlimited times, as many times as possible, giving back as needed (greedy) «+»
// Match the character “ ” literally « »
// Match the character “*” literally «\*»
// Match the characters “ x” literally « x»
// Match the character “^” literally «\^»
// Match the regular expression below and capture its match into backreference number 2 «(:?\d+)»
//    Match the character “:” literally «:?»
//       Between zero and one times, as many times as possible, giving back as needed (greedy) «?»
//    Match a single digit 0..9 «\d+»
//       Between one and unlimited times, as many times as possible, giving back as needed (greedy) «+»
try {
    String resultString = subjectString.replaceAll("(?m)(:?\\d+) \\* x\\^(:?\\d+)", "$1x<sup>$2</sup>");
} catch (PatternSyntaxException ex) {
    // Syntax error in the regular expression
} catch (IllegalArgumentException ex) {
    // Syntax error in the replacement text (unescaped $ signs?)
} catch (IndexOutOfBoundsException ex) {
    // Non-existent backreference used the replacement text
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-10T20:56:14.863

如果这是针对任何一般的数学表达式并且允许使用括号表达式，那么使用正则表达式执行此操作将非常困难（也许是不可能的）。

如果唯一的替代品是您展示的替代品，那并不难做到。首先`*`去掉 's，然后像 Can Berk Güder 展示的那样使用捕获来处理`^`'s。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-10T21:05:04.623

你的多项式是什么？如果您正在“处理”它，我正在设想在某个时候生成某种子表达式树，并且认为使用它来生成字符串比重新解析原始字符串要简单得多用正则表达式表达。

只是抛出了一种不同的思维方式。我不确定您的应用程序中还发生了什么。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-09-16T11:57:19.637

```
class Replacement 
{
    public static void main(String args[])
    {
        String Main = "5 * x^3 - 6 * x^1 + 1";
        String replaced = Main.replaceAll("(?m)(:?\\d+) \\* x\\^(:?\\d+)", "$1x<sup>$2</sup>");
        System.out.println(replaced);
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-10T20:57:37.497

尝试这个：

```
String str = "5 * x^3 - 6 * x^1 + 1";
String replacedStr = str.replaceAll("\\^(\\d+)", "<sup>\$1</sup>"); 
```

请务必导入 java.util.regex。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-10T20:50:34.470

您需要研究在正则表达式中捕获以处理将 3 包装在 ^3 中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-04-12T14:16:50.180

看看antlr4。与单独的正则表达式相比，它会让您在创建树结构方面走得更远。

[https://github.com/antlr/grammars-v4/tree/master/calculator（calculator.g4](https://github.com/antlr/grammars-v4/tree/master/calculator) 包含你需要的语法）

简而言之，您定义语法来解析表达式，使用 antlr 生成 java 代码，并在构建树时添加回调来处理评估。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-02-11T18:30:44.347

试试这个，可能不是最好的方法。但它有效

```
String str = "5 * x^3 - 6 * x^1 + 1";
str = str.replaceAll("(?x)(\\d+)(\\s+?\\*?\\s+?)(\\w+?)(\\^+?)(\\d+?)", "$1$3<sup>$5</sup>");
System.out.println(str); 
```

# javascript - JQuery：如何克隆自动完成字段？

> ID：632212
> 
> 赞同：3
> 
> 时间：2009-03-10T20:47:44.977
> 
> 标签：javascript, jquery

我正在使用 Jörn Zaefferer 的 jquery 自动完成插件，当我克隆一个自动完成字段时，我似乎无法弄清楚如何使它工作。它几乎可以工作，因为当我输入文本时，克隆的自动完成字段会显示选择，但我无法选择项目。起初我以为这是浏览器兼容性问题，但在 FF3 和 Safari 中都会出现，所以我猜我错过了一个陷阱。

这是我正在做的一个工作示例：

```
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>Autocomplete Clone Demo</title>
<style>
body {
margin: 40px;
}
.hide_element {
display: none;
}
</style>
<link rel="stylesheet" href="http://dev.jquery.com/view/trunk/plugins/autocomplete/jquery.autocomplete.css" type="text/css" />
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript" src="http://dev.jquery.com/view/trunk/plugins/autocomplete/jquery.autocomplete.js"></script>
<script type="text/javascript">
    function setAutocomplete()
    {
        var users = [
          { name: "Fred", id: "1" },
          { name: "Barney", id: "2" },
          { name: "Wilma", id: "3" }
        ];

        $(".user_selector").autocomplete(users, 
            {
                mustMatch: true,
                matchContains: true,
                minChars: 2,
                formatResult: function(row) { return row.name; },
                formatItem: function(row, i, max) { return row.name; }
            }
        );
    }

    var current= 0;

    var addParticipantFields = function() 
    {
        current++;
        $newParticipant = $("#template").clone(true);
        $newParticipant.removeAttr("id");
        $newParticipant.removeClass("hide_element");
        $prefix = "extra" + current;
        $newParticipant.children("div").children(":input").each(function(i) {
            var $currentElem= $(this);
            $currentElem.attr("name",$prefix+$currentElem.attr("name"));
        });
        $newParticipant.appendTo("#participantsField");
        setAutocomplete();
    }

    $(document).ready(function() {
        setAutocomplete();
        $("#addParticipant").live("click", addParticipantFields);

    });
</script>

</head>
<body>
<h1>Test Autocomplete Cloning</h1>
<form id="demo" method="post" action="">
<fieldset id="participantsField">
<label>Participants</label>
<div class="participant">
    <input class="user_selector" name="user" size="30"/>
</div>
</fieldset>

<!-- This is the template for adding extra participants -->
<div class="participant hide_element" id="template">
    <input class="user_selector" name="_user" size="30"/>
</div>

<p><input type="button" id="addParticipant" value="Add Another Participant"></p>
<p><input class="button" type="submit" value="Submit"/></p>
</form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T23:31:32.463

制作

```
$newParticipant = $("#template").clone(true); 
```

像这样

```
$newParticipant = $("#template").clone(); 
```

当您不在 #template 上克隆事件时，您的示例在 FF 中适用于我。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T08:32:25.877

首先：

```
$newParticipant.children("div").children(":input").length == 0 
```

所以这条线没有返回任何孩子。采用

```
$newParticipant.children() 
```

反而。它改为返回 1 个子项。但是钢铁对我不起作用。不得不多想。

# sql-server-2008 - Reporting Services - 页眉中的组名称

> ID：632215
> 
> 赞同：4
> 
> 时间：2009-03-10T20:49:18.360
> 
> 标签：sql-server-2008, reporting-services

我有一个包含一组（办公室名称）的报告，每个组之间有分页符 - 因此只有一个办公室的数据可以出现在给定页面上。如何让该办公室名称出现在页眉中？

我尝试在报告的详细信息部分中创建一个隐藏的文本框，该文本框具有办公室名称值，然后在页眉中引用该值，但我在第 1 页上获得了最后一个办公室名称值，然后在所有其他页面上它都是空白的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2014-03-11T09:56:25.343

今天，我终于找到了另一种方法来做到这一点。

在您指定分页符的组上，在属性窗口中展开该`Group`部分。请参阅[Reporting Services 中的分页（报表生成器和 SSRS）](http://msdn.microsoft.com/en-us/library/dd255278.aspx)

> 您可以在 Tablix 属性、矩形属性或组属性对话框中设置 BreakLocation 属性，**但必须在报表生成器属性窗格中设置 Disabled、ResetPageNumber 和 PageName 属性**。

你应该看到一个`PageName`字段。此字段可以设置为 tablix 使用的数据集中的字段数据值之一。

设置`PageName`字段后，您可以将文本框添加到页眉/页脚并设置表达式以使用该`PageName`字段。[内置全局变量和用户引用（报表生成器和 SSRS）](http://msdn.microsoft.com/en-us/library/dd255216.aspx)

```
=Globals!PageName 
```

然后，这应该在每个组更改时更改，并且在每个页面上都可见。

我真的很难找到一个好的解决方案，所以如果我需要澄清答案，请随时提出建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T20:54:36.460

我让它工作，如果其他人遇到这个问题，我会发布答案。

由于某种原因，引用文本框不起作用，但是当我在表中放置一个具有相同值的隐藏列时，我可以在页眉中引用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-04-29T15:47:28.320

我实际上是在页脚中执行此操作，并且有效！谢谢！只是想添加，如果您尝试在页眉或页脚中显示多个值，您可以将它们与页面名称表达式中的分隔符串在一起，例如

```
=Fields!FIELD1.Value + "|" + Fields!FIELD2.Value + "|" + Fields!FIELD3.Value + "|" + Fields!FIELD4.Value 
```

然后您可以创建新字段（每个值一个）并解析出每个字段，例如

```
=(Split(Globals!PageName, "|")).GetValue(0)
=(Split(Globals!PageName, "|")).GetValue(1)
=(Split(Globals!PageName, "|")).GetValue(2)
=(Split(Globals!PageName, "|")).GetValue(3) 
```

# abap - ABAP OO 过时的语句：这些如何影响您现有的代码库？

> ID：632216
> 
> 赞同：2
> 
> 时间：2009-03-10T20:49:32.803
> 
> 标签：abap

自从从 4.7 升级到 ECC6 以来，ABAP 编译器在 OO 上下文中对某些语句的使用变得更加严格。

例如，您不允许使用 LIKE 语句，而是必须使用 TYPE 并且内部表没有隐式标题行等。

[这些限制在此处](http://help.sap.com/abapdocu/en/ABENABAP_OBJECTS_DIFF_TYPES_DATA.htm)进行了更详细的说明

**我的问题：**此限制在多大程度上影响您现有的代码库？

自 1998 年以来，我们在 OO 中编写了超过一千个“类”，只要它当时可用。大多数情况下，每个类在 SE38 中都是它自己的包含，类定义和实现一起包含在这个包含中。

到目前为止，*只要主程序在 4.7 中预先存在*，我们就可以成功更改和激活这些类。现在我们试图在一个新的主程序中使用这些旧类之一进行回归测试，我们得到以下错误：

**“在类和接口中，您只能使用“TYPE”来引用 ABAP 字典类型（而不是“LIKE”或“STRUCTURE”）。”**

*根据 SAP 语言的当前定义，此错误有效。*

我想知道 SAP 解释器是否继续故意运行带有过时语句的旧代码，或者未来的补丁是否可能更正此“功能”并导致这些类停止编译。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-08T13:42:02.247

每个开发对象都标记有与开发它的 SAP 版本相对应的版本。您可以在版本管理或表 VRSD 中看到这一点。

据我了解，这是专门用于在以后的版本中包含非法语句的代码将在升级后继续运行并继续运行。

这就是为什么当您将在 4.5b 中开发的包含附加到在 NW700 中开发的类时，它不会编译。编译器知道这是新开发，并相应地应用规则。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T21:30:30.217

ABAP 社区已经知道 LIKE、工作区、RANGE 等已经过时了很长时间（几年）。

我不认为 SAP 会杀死任何旧代码，但如果我负责的话，我不会指望它。

那么他们能否使其停止编译：是的，他们会：可能不会。

# asp.net - ASP.NET WebForms - 会话变量为空

> ID：632219
> 
> 赞同：3
> 
> 时间：2009-03-10T20:50:26.530
> 
> 标签：asp.net, session, webforms

我有一个 iframe 保持活动状态（每隔几分钟在我的网站上点击一个页面 defibrillator.aspx 的 iframe 以保持会话活动）在我的 asp.net 应用程序的母版页上。这在大多数情况下都有效，但在我的除颤器页面上的页面加载期间，我的会话变量经常返回 null。起初，我认为会话由于某种原因被服务器超时，所以我将一些日志记录到 global.asax 中的 Session_End 事件中，但它从未被命中。

任何可能导致会话丢失的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:53:59.533

许多事情都可能导致会话丢失。AppPool 回收、iisreset、客户端可能会丢失其会话 cookie 等。如果不了解更多信息，很难说出问题所在。

如果会话非常重要，以至于您轮询应用程序以防止工作进程进入休眠状态，那么您应该考虑将会话[状态持久化到 SQL Server](http://support.microsoft.com/kb/311209)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T20:54:08.473

Peter Bromberg在他的博客中[概述了 ASP.NET 会话超时的主要原因。](http://petesbloggerama.blogspot.com/2007/10/losing-aspnet-sessions-why-application.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T19:53:12.657

我遇到了同样的问题，将购物车状态存储在 Session 中，但让它随机返回 null 。我想我在 Bertrand Le Roy 的博客上找到了答案，这似乎对我有用：

> 错误配置的应用程序池也可能导致会话丢失问题。例如，如果您的站点正在运行的应用程序池被配置为网络场或网络花园（通过将工作进程的最大数量设置为一个以上），并且如果您不使用会话服务或 SQL 会话，传入的请求将不可预知地转到其中一个工作进程，如果它不是创建会话的那个，它就会丢失。此问题的解决方案是，如果您不需要性能提升，则不使用网络花园，或者使用进程外会话提供程序之一。

[博客](http://weblogs.asp.net/bleroy/archive/2004/08/03/Don_2700_t-redirect-after-setting-a-Session-variable-_2800_or-do-it-right_2900_.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T23:31:00.110

如果选择的持久性机制是 InProc，那么它可以被很多事情触发。完全不推荐用于生产环境。

# php - PHP 嵌套循环行为异常

> ID：632227
> 
> 赞同：0
> 
> 时间：2009-03-10T20:52:25.870
> 
> 标签：php, mysql, loops, nested-loops

我有一个数组，其中包含特定文章 ($link_cat) 的类别。然后，我使用 mysql_fetch_array 将**所有**可用的类别打印到带有复选框的列表中。在执行此操作时，我希望它将其所在的值与另一个数组中的值进行比较。如果匹配，则表示其中一个类别适用于这篇文章，它应该打印出一行代码来应用选中的属性。伟大的！除了它不工作=[

```
 while ( $row = mysqli_fetch_array($results, MYSQLI_ASSOC) ){
    $cat[$i] = $row['category'];
    $cat_id[$i] = $row['cat_id'];

    echo '<li><input type="checkbox" ';

    $catCount = count($link_cat);
    for ($ct = 0; $ct < $catCount; $ct++){
        if ($cat_id[$i] == $link_cat[$ct]){ 
            echo 'checked="checked" ';
        }
    }

    echo 'name="' . $cat_id[$i] . '" />' . $cat[$i] . '</li>';

    $i++;
} 
```

我以前从未真正做过嵌套循环（我怀疑这就是问题所在）。

问题似乎是，当它运行时， $link_cat[0] 将在其中检查第一个类别 - 没有注册。它出现空白。在 for 循环中打印出变量证实了这一点。任何其他 [1] [2] 等都可以。它只是 [0]。但为什么？这似乎没有任何意义。我知道里面有东西，因为我在填充数组时打印了它的内容，只是为了检查。然而，它不仅仅在循环期间显示。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T21:07:32.370

轻微的错误修复（和明显的样式更改）：您的版本可以打印出checked="checked" 多次。是否需要是数组`$cat`？`$cat_id`

```
while ( $row = mysqli_fetch_array($results, MYSQLI_ASSOC) ) {
    $cat = $row['category'];
    $cat_id = $row['cat_id'];

    echo '<li><input type="checkbox" ';
    if ( in_array($cat_id, $link_cat) ) {
        echo 'checked="checked" ';
    }
    echo "name='$cat_id' />$cat</li>";
} 
```

对于通常会在问题上抛出调试器的情况，我喜欢在注释块中放入一个不错的[print_r](http://ca.php.net/manual/en/function.print-r.php)（查看源代码用于调试输出，在实时站点上更安全）。

```
echo '<!-- ' . print_r($link_cat, TRUE) . ' -->'; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T21:02:28.360

虽然我最初对需要重置的数组循环非常错误，但我无法摆脱这样一种感觉，即循环通过该数组并不是完成您所追求的最快方法。

也许[array_search](http://us2.php.net/array_search)会做，或者[array_key_exists](http://us2.php.net/manual/en/function.array-key-exists.php)。 [in_array](http://us2.php.net/manual/en/function.in-array.php)看起来像个赢家，但我没想到

# java - 如何计算 java BufferedImage 文件大小

> ID：632229
> 
> 赞同：19
> 
> 时间：2009-03-10T20:53:52.967
> 
> 标签：java, bufferedimage

我有一个基于 servlet 的应用程序，它从本地存储的文件中提供图像。我添加了逻辑，允许应用程序将图像文件加载到 BufferedImage，然后调整图像大小，在图像顶部添加水印文本，或两者兼而有之。

我想在写出图像之前设置内容长度。除了将图像写入临时文件或字节数组之外，有没有办法找到 BufferedImage 的大小？

如果这有助于计算大小，所有文件都被写为 jpg。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-02-09T11:57:01.987

```
 BufferedImage img = = new BufferedImage(500, 300, BufferedImage.TYPE_INT_RGB);

    ByteArrayOutputStream tmp = new ByteArrayOutputStream();
    ImageIO.write(img, "png", tmp);
    tmp.close();
    Integer contentLength = tmp.size();

    response.setContentType("image/png");
    response.setHeader("Content-Length",contentLength.toString());
    OutputStream out = response.getOutputStream();
    out.write(tmp.toByteArray());
    out.close(); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-10T20:56:34.583

不可以，您必须将文件写入内存或临时文件。

原因是无法预测 JPEG 编码将如何影响文件大小。

此外，“猜测”文件大小还不够好。`Content-Length`标题必须是正确的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-10T20:56:44.287

嗯，BufferedImage 不知道它被写为 JPEG - 就它而言，它可能是 PNG 或 GIF 或 TGA 或 TIFF 或 BMP ......所有这些都有不同的文件大小。所以我不相信 BufferedImage 可以直接给你一个文件大小。您只需将其写出来并计算字节数。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-04-14T15:47:35.373

您可以非常轻松地计算内存中 BufferedImage 的大小。这是因为它是 WritableRaster 的包装器，它使用 DataBuffer 作为支持。如果要计算它在内存中的大小，可以使用 getData() 获取图像光栅的副本，然后测量光栅中数据缓冲区的大小。

```
DataBuffer dataBuffer = bufImg.getData().getDataBuffer();

// Each bank element in the data buffer is a 32-bit integer
long sizeBytes = ((long) dataBuffer.getSize()) * 4l;
long sizeMB = sizeBytes / (1024l * 1024l);` 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T21:07:15.663

除非它是一个非常小的图像文件，否则最好使用分块编码而不是指定内容长度。

在最近的一两个 stackoverflow 播客中指出，HTTP 代理经常报告它们只支持 HTTP/1.0，这可能是一个问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-03-21T00:44:00.020

在将图像文件加载为 BufferedImage 之前，请通过 File 对象引用图像文件。

```
File imgObj = new File("your Image file path");
int imgLength = (int) imgObj.length(); 
```

imgLength 将是您的近似图像大小，尽管它在调整大小以及您对其执行的任何操作后会有所不同。

# visual-c++ - Visual Studio 2005 - Windows 7 上的 VC++ 编译器 C1001

> ID：632235
> 
> 赞同：1
> 
> 时间：2009-03-10T20:55:01.123
> 
> 标签：visual-c++, visual-studio-2005, windows-7, c1001

当我尝试使用 Visual Studio 2005 (VC++2005) 在 Windows 7 Beta 上构建一个简单的“Hello World”C++ 应用程序时，我得到一个相当普遍的错误

> C1001 错误（内部编译器错误）

编译器似乎只是崩溃了，Windows 会弹出它的（无用）有用的`This program has stopped working`对话框。它抱怨的文件是 mcp1.cpp。

有没有人遇到过这个？

干杯，弗里茨

编辑：代码是：

```
#include <iostream>

int main(int argc, char** argv) {
    std::cout << "Hello!";
    return 0;
} 
```

编辑 2：我已经为 Vista 安装了 SP1 和 SP1。VS弹出一个警告说它需要SP1 for Vista，但安装它没有区别。不知道我可以做些什么来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T21:00:30.890

是的，这是编译器遇到未知条件或崩溃时的一般错误。这是编译器中的错误，而不是您的代码。将错误报告发送给 MS，希望问题可以得到解决。如果您还没有升级到 VS 2005 的 SP1，请尝试升级。或切换到 2008，如果这是一个选项。

除此之外，如果不查看相关代码，我们将无法提供太多帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T22:12:51.100

原来它是项目中包含的 .NCB 文件 - 它是从 Windows XP 设置中复制的，删除该 .NCB 文件后，该项目在 Windows 7 下构建良好 - 此后没有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T21:06:20.067

它甚至在 Windows 7 上受支持吗？查看产品信息。例如，我查看了 VS2005 Express 版[自述文件](http://msdn.microsoft.com/hi-in/express/aa718403(en-us).aspx)，它在操作系统列表中仅列出了 Vista。您必须根据您的确切设置进行检查。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T21:23:13.660

当我（向上？向下？）升级到 Vista 时，VS 2005 有一长串轻微的不兼容性和烦恼。所有早期版本都被列为不受支持（VB 6 除外）。您可能必须升级 VS 版本。

# windows-server-2008 - 如何以编程方式检查 Windows Server 2008 中是否安装了服务器功能？

> ID：632241
> 
> 赞同：7
> 
> 时间：2009-03-10T20:56:52.617
> 
> 标签：windows-server-2008

具体来说，如果安装了“桌面体验”功能，我正在使用仅在 Server 2008 上运行的应用程序，并且我希望该应用程序的安装程序验证它是否存在。

我目前知道的唯一方法是运行`ServerManagerCmd -query`和解析输出；我更喜欢更轻量级的东西（比如检查注册表项）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-07-27T21:41:38.020

这是我在运行时使用的代码片段。

```
public static bool isServerFeatureInstalled(Win32_ServerFeature_ID id)
{
    bool idFound = false;
    ConnectionOptions connectionOptions = new ConnectionOptions();
    ManagementScope managementScope =
        new ManagementScope(
            @"\\localhost\root\cimv2", connectionOptions);

    ObjectQuery oQuery =
        new ObjectQuery("SELECT Id FROM Win32_ServerFeature");
    ManagementObjectSearcher oSearcher =
        new ManagementObjectSearcher(managementScope, oQuery);
    ManagementObjectCollection oReturnCollection = oSearcher.Get();

    foreach (ManagementObject oReturn in oReturnCollection)
    {
        if ((uint) (oReturn["ID"]) == (uint) id)
        {
            return true;
        }
    }
    return idFound;
}

// short list of names and values taken from MSDN. 
public enum Win32_ServerFeature_ID
{
    Application_Server = 1,
    Web_Server = 2,
    Media_Server = 3,
    Windows_Sharepoint_Services = 4,
    Fax_Server = 5,
    File_Services = 6,
    Print_Services = 7,
    Active_Directory_Federation_Services = 8,
    Active_Directory_Lightweight_Directory_Services = 9,
    Active_Directory_Domain_Services = 10,
    UDDI_Services = 11,
    DHCP_Server = 12,
    DNS_Server = 13,
    Network_Policy_and_Access_Services = 14,
    Certificate_Server = 16,
    Active_Directory_Rights_Management_Services = 17,
    Terminal_Services = 18,
    Windows_Deployment_Services = 19,
    Failover_Clustering = 33,
    Network_Load_Balancing = 34,
    Desktop_Experience = 35,
    DOTNET_Framework_30 = 36,
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-27T13:44:30.897

在我运行此命令的测试 Windows 2008 x64 std 服务器上（添加角色）：

```
ServerManagerCmd.exe -install AS-AppServer-Foundation 
```

添加此注册表项：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\AppServer 
```

此命令（删除角色）：

```
ServerManagerCmd.exe -remove AS-AppServer-Foundation 
```

删除密钥。所以我认为这是一个足够好的指标。这些只是我自己的研究/实验的结果，并不是检测是否配置了 AppServer 角色的官方/支持的方法。

# regex - 正则表达式检测几个字符串之一

> ID：632244
> 
> 赞同：76
> 
> 时间：2009-03-10T20:57:38.293
> 
> 标签：regex

我有一个属于多个域的电子邮件地址列表。我想要一个匹配属于三个特定域的地址的正则表达式（例如：foo、bar 和 baz）

所以这些会匹配：

1.  一个@foo
2.  一间酒吧
3.  b@baz

这不会：

1.  @fnord

理想情况下，这些也不匹配（尽管对于这个特定问题并不重要）：

1.  一个@foobar
2.  b@foofoo

稍微抽象一下问题：我想匹配一个至少包含给定子字符串列表之一的字符串。

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2009-03-10T21:00:04.027

使用管道符号表示“或”：

```
/a@(foo|bar|baz)\b/ 
```

如果您不想要捕获组，请使用非捕获分组符号：

```
/a@(?:foo|bar|baz)\b/ 
```

（当然我假设`a`电子邮件地址前面的“”是可以的！你应该用合适的正则表达式替换它。）

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-10T21:02:05.707

```
^(a|b)@(foo|bar|baz)$ 
```

如果你有这个强烈定义的列表。开始和结束字符将只搜索这三个字符串。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T21:10:42.677

采用：

```
/@(foo|bar|baz)\.?$/i 
```

注意与其他答案的区别：

*   `\.?`- 匹配 0 或 1 个点，以防电子邮件地址中的域是“完全合格”
*   `$`- 表示字符串*必须*以此序列结尾，
*   `/i`- 使测试用例不敏感。

请注意，这假定每个电子邮件地址都单独一行。

如果要匹配的字符串可以在字符串中的任何位置，则删除`$`，并将其替换为`\s+`（匹配一个或多个空白字符）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:01:59.653

应该更通用，a 不应该算在内，尽管 @ 应该。

```
/@(foo|bar|baz)(?:\W|$)/ 
```

[这](http://en.wikipedia.org/wiki/Regular_expression)是关于正则表达式的一个很好的参考。

编辑：更改结尾以允许模式结束或分词。现在假设 foo/bar/baz 是完整的域名。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T22:15:37.153

如果先前（和合乎逻辑的）关于“|”的答案 不适合你，看看

[http://metacpan.org/pod/Regex::PreSuf](http://metacpan.org/pod/Regex::PreSuf)

模块描述：从单词列表创建正则表达式

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T22:16:22.050

您不需要正则表达式来查找字符串是否至少包含给定子字符串列表中的一个。在 Python 中：

```
def contain(string_, substrings):
    return any(s in string_ for s in substrings) 
```

对于大`string_`而多的子字符串，上述内容很慢。[GNU fgrep](http://directory.fsf.org/project/grep/)可以同时高效地搜索多个模式。

### 使用正则表达式

```
import re

def contain(string_, substrings):
    regex = '|'.join("(?:%s)" % re.escape(s) for s in substrings)
    return re.search(regex, string_) is not None 
```

### 有关的

*   [多跳多模式匹配算法 (MSMPMA)](http://www.iaeng.org/IJCS/issues_v34/issue_2/IJCS_34_2_03.pdf) [pdf]

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T22:20:40.823

好的，我知道您要求提供正则表达式答案。但是您是否考虑过仅使用“@”字符拆分字符串并获取第二个数组值（域）并进行简单的匹配测试

```
if (splitString[1] == "foo" && splitString[1] == "bar" && splitString[1] == "baz")
{
   //Do Something!
} 
```

在我看来，RegEx 是矫枉过正。当然，我的假设是您的情况确实像您列出的那样简单。

# php - 我的 PHP 脚本如何判断服务器是否繁忙？

> ID：632245
> 
> 赞同：8
> 
> 时间：2009-03-10T20:58:00.757
> 
> 标签：php, mysql, load

我想运行一个需要大量 CPU 和 Mysql 资源的清理工作。我希望它仅在服务器不是相对繁忙的情况下运行。

从 PHP 确定它的最简单方法是什么？（例如，是否有一个查询返回最后一分钟完成了多少查询？...）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-10T21:05:23.127

```
if (function_exists('sys_getloadavg')) {
    $load = sys_getloadavg();
    if ($load[0] > 80) {
       header('HTTP/1.1 503 Too busy, try again later');
       die('Server too busy. Please try again later.');
    }
} 
```

尝试根据您的需要更新此功能

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T21:01:45.927

如果这是 Unix 系统，则解析`uptime`. 这显示了 CPU 负载，这通常被认为是衡量“忙碌”的好方法。任何接近或超过`1.0`意味着“完全忙”。

该输出中有三个 CPU“加载”时间，给出了 1、5 和 15 分钟的平均负载。选择对您的脚本有意义的。“负载”[的定义在这里](http://www.usenet-forums.com/linux-general/88308-what-does-uptimes-load-average-mean.html)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T21:12:39.380

在 Linux 上，您可以从`/proc/loadavg`文件中获取负载。

```
$load = split(' ',file_get_contents('/proc/loadavg'))
$loadAvg = $load[0] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:07:07.507

您可能可以使用[Mysql List Processes](http://us2.php.net/manual/en/function.mysql-list-processes.php)函数中的信息来查看有多少活动与睡眠，这是一个关于数据库负载的体面指标。

如果您使用的是 Linux，则可以使用[Sys GetLoadAvg](http://us3.php.net/sys_getloadavg)函数来查看整体系统负载。

# sql - 千库合一的思路

> ID：632251
> 
> 赞同：3
> 
> 时间：2009-03-10T21:00:56.037
> 
> 标签：sql, sql-server

我们有一个 SQL 服务器，每个客户端都有一个数据库，我们有数百个客户端。所以想象一下：database001、database002、database003、...、database999。我们希望将所有这些数据库合并到一个数据库中。

我们的想法是添加一个 siteId 列，001、002、003、...、999。

我们正在探索使这一过渡尽可能顺利的选项。我们很想听听您的任何想法。事实证明这是一个非常具有挑战性的问题。

我听说过一种技术可以创建一个匹配然后过滤的视图。

有什么想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T21:07:24.477

为每个客户端数据库创建一个客户端数据库 ID。您将使用此 id 来保持数据在逻辑上分离。这是“站点 ID”概念，但您可以使用派生密钥（身份字段）而不是手动创建这些数字。创建一个具有数据库名称和 ID 的表，以及您需要的任何其他元数据。

下一步将是创建一个 SSIS 包，该包获取相关数据库的 ID，并将其添加到必须在逻辑上分离其数据的表中。然后，您可以在每个数据库上运行相同的包，并查找相关数据库的 ID。

在您拥有唯一数据的唯一 ID 并导入数据后，您将不得不更改您的应用程序以适应新架构（实际上是之前，或者您几乎搞砸了）。

如果您想分步执行此操作，您可以在不同的“数据库”中创建视图或函数，以便旧客户端仍然可以访问客户端的数据，即使它已被移动。如果您部署时有一些停机时间，则可能不需要此步骤。

我建议的方法相当灵活，可以一次应用于一个客户端，具体取决于您的客户端应用程序部署方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T21:19:57.613

你为什么要这样做？
您可以阅读有关[多租户数据架构的信息](http://msdn.microsoft.com/en-us/library/aa479086.aspx)，也可以收听关于此设计的[SO #19（大约 40-50 分钟） 。](https://blog.stackoverflow.com/2008/08/podcast-19/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T21:08:34.303

“site-id”解决方案已经完成。

另一种可能效果不佳（但仍然很有吸引力）的可能性是单个数据库中的多个模式。您可以将公用表拉入“公用”模式，并将客户特定的内容留在客户特定的模式中。然而，在某些数据库产品中，每个模式实际上是一个单独的数据库。在其他产品（例如 Oracle、DB2）中，您可以轻松编写在多个模式中工作的查询。

另请注意——作为一种优化——您可能不需要`siteId`向每个表添加列。

有时你有一个“包含”的关系。它是一个主从 FK，通常使用级联删除定义，因此没有父级，细节就不能存在。在这种情况下，孩子不需要siteId，因为他们没有独立的存在。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-10T21:17:40.147

您的第一步将是确定这些数据库是否具有相同的结构。即使您认为他们这样做，您也需要比较它们以确保他们这样做。可能会有一些是定制的或错过一两个升级周期。

现在，根据客户端的数量和每个客户端的记录数，您的表可能会变得很大。您确定这不会造成性能问题吗？无论如何，您可能需要重新审视索引。您可能需要一组更强大的服务器，并且可能还需要按客户端进行分区以提高性能。

接下来，是的，每个表都需要某种站点 ID。此外，根据您的设计，您可能拥有现在不再唯一的主键。您可能需要重新定义所有主键以包含 siteid。添加时始终索引此字段。

现在您的所有查询、存储过程、视图、udf 都需要重写，以确保 siteid 是其中的一部分。请特别注意任何动态 SQL。否则，您可能会向客户 B 显示客户 A 的信息。客户往往不喜欢这样。有一次，我们将一个客户端从一个单独的数据库引入到主应用程序中（当他们决定仍然不想为单独的服务器付费时）。开发人员只错过了一个必须添加 client_id 的地方。不幸的是，这向每个客户发送了有关该客户专有信息的电子邮件，更糟糕的是，这是一个在半夜运行的夜间流程，因此直到第二天才知道。（开发人员很幸运没有被解雇。）当你这样做并测试、测试、测试时要非常小心，并测试更多。确保测试所有自动化的幕后工作以及 UI 工作。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T22:22:05.780

去年年底我在佛罗伦萨的解释是，如果您必须为应用程序保持数据库名称和数据库的逻辑层相同。在这种情况下，您将执行以下操作：

*   将所有数据合并到一个统一的表中，形成一个主统一数据库（以下简称为统一数据库）。
*   这些表必须具有类似 SiteID 的标识符。
*   使用现有名称创建新数据库。
*   使用旧表名创建视图，这些视图使用行级安全性来查询统一数据库中的表，但使用 SiteID 进行过滤。
*   为跨数据库所有权链接设置数据库，以便服务帐户不会“意外”查询统一数据库中的基表。访问必须通过视图或存储过程和其他强制行级安全性的结构进行。现在，如果它是所有站点的相同服务帐户，您可以避免跨数据库所有权链接并分配统一数据库中对象的权限。
*   重写存储过程以处理更改（因为它们现在指的是视图并且它们不知道命中基表并包含 SiteID）或在视图上使用替代触发器来拦截更新请求并放置适当的站点特定信息进入基表。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T21:07:44.197

如果数据很大，您可以查看使用分区视图。这将简化您的访问代码，因为您只需要维护视图即可；但是，如果数据不大，只需添加一列来识别客户即可。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-10T21:48:40.120

根据数据的内容和您的安全要求，交叉污染的威胁可能会成为阻碍因素。

假设您已经考虑过这一点并认为它“足够安全”。您可能需要/想要创建 VIEWS 或施加其他一些访问控制以防止客户看到彼此的数据。

IIRC 一个名为“Trusted Oracle”的产品能够基于这样的密钥对数据进行分区（大约在 Oracle 7 或 8 出现的时候）。这个想法是任何给定的查询都会自动附加“and sourceKey = @userSecurityKey”（或一些这样的）。该功能可能已被纳入流行商业产品的更高版本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T23:13:17.157

要扩展 Gregory 的答案，您还可以创建一个父 ssis，它调用包在 foreach 循环容器中进行实际移动。

父包查询配置表并将其放入对象变量中。然后 foreach 循环使用此记录集将变量传递给包，例如您的数据库名称和包可能需要的任何其他详细信息。

您的表格可以列出您的所有客户端数据库，并在您准备好移动它们时标记一个标志。这样您就不会坐在那里在[32,767](http://msdn.microsoft.com/en-us/library/ms143432.aspx)个数据库上运行 ssis 包。我迷上了 ssis 中的 foreach 循环。

# nhibernate - Nhibernate ICriteria API 参考

> ID：632261
> 
> 赞同：3
> 
> 时间：2009-03-10T21:03:19.683
> 
> 标签：nhibernate, icriteria

有没有好的 ICriteria API 概述？来自官方 NHibernate 参考的第 12 章太短了，我仍然没有清楚地了解 ICriteria 的用法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T21:23:17.200

NHibernate 中的 Criteria 内容与 Hibernate（Java 版本）几乎相同。尝试以这种方式扩大您的搜索范围。

事实上，我使用[Java Persistence with Hibernate](http://www.manning.com/bauer2/)作为参考。

# javascript - 这个 JQuery 哪里错了？

> ID：632263
> 
> 赞同：1
> 
> 时间：2009-03-10T21:03:29.887
> 
> 标签：javascript, jquery, css-selectors

我想将点击事件添加到 `id="violacao" 的所有元素：

```
$(document).ready(function () {
    jQuery('#violacao').click(function() {
        alert('teste');
    });
}); 
```

但只有第一个链接响应点击。这是生成的 HTML：

```
<tr>
  <td><a href="#" id="violacao">40954589</a></td>
  <td>Perda de Comunicação</td>
</tr>

<tr>
  <td><a href="#" id="violacao">88692020503</a></td>
  <td>Perda de Comunicação</td>
</tr> 
```

当我尝试这种方式时：

```
jQuery("a").click(function() {
    alert('teste');
}); 
```

它工作正常，除了所有链接都受到影响。怎么了？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-10T21:06:02.937

HTML 中的 ID 是唯一的（每个文档一个）。将 ID 更改为一个类（并使用 . 而不是 #），它应该可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T10:56:31.240

虽然史蒂夫梅森所说的是真的，但实际问题并非如此。

如果您将 ID 更改为类，问题仍然存在：所有链接都会受到影响。

相反，如果您的目标是影响单个 <A>，您应该执行以下操作之一：

a) 为每个 <A> 分配唯一的 ID，然后像你之前那样做；或者

b) 分配类并使用 :first 选择器：

```
jQuery("a.violacao:first").click( function (){
  alert('teste');
} ); 
```

这将适用于具有 violacao 类的第一个匹配锚。或者，如果你想影响一个特定的锚，你可以使用 :eq(index)。

有关选择器的完整列表，请访问[http://docs.jquery.com/Selectors](http://docs.jquery.com/Selectors)。

# css - CSS 类合并

> ID：632265
> 
> 赞同：1
> 
> 时间：2009-03-10T21:03:45.487
> 
> 标签：css, html

有人可以阐明这个问题吗？预期的结果似乎没有发生......我的假设是否正确？

```
.float-right{
  float:right;
}

.header{
   (stuff we don't care about)
}

.header img .float-right {
  display:inline;
  margin:0 0 0 0.5em;
} 
```

我*认为*这意味着 < div class="header" > 内的 < img > 标签会得到：

```
float:right;
display:inline;
margin:0 0 0 0.5em; 
```

*如果*<img> 标签是 class="float-right"

它是否正确？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T21:06:26.337

为了得到你想要的结果，它应该是

```
.header img.float-right 
```

（没有空间）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T21:06:02.360

No.`.header img .float-right`表示任何带有 float-right 类的标签，它是 img 标签的后代，而 img 标签又是带有 header 类的标签的后代。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T21:06:32.640

> 如果 <img> 标签是 class="float-right"

实现不应该有空间

```
 .header img.float-right { 
```

就像现在一样，它正在寻找

```
 [an element with class "float-right"] [inside an img] [inside an element with class header] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T21:13:14.980

如果您在样式表中删除 img 和 .float-right 之间的空格，就会发生这种情况。

# c# - 如何远程调试网站的客户问题

> ID：632271
> 
> 赞同：0
> 
> 时间：2009-03-10T21:05:54.403
> 
> 标签：c#, jquery, asp.net-mvc

最近刚刚上线了一个新网站，面向互联网。该站点主要基于 ASP.NET MVC 和 JQuery 构建。我们在 IE6/7/8、Firefox、Safari、Opera 和 Chrome 中对该站点进行了相当严格的测试。我们确实捕获异常并记录它们。

我们刚刚收到了几起用户无法在网站上注册的投诉。.NET 层没有抛出异常，只是显然“注册”按钮不起作用。

调试此类问题的最佳实践是什么？有没有一种远程记录客户端事件的好方法？我们是否需要联系该用户并使用 webex 或 copilot 或类似工具来查看正在发生的事情？

编辑/更新：这个领域的大事——你现在可以通过利用[Weinre](https://github.com/apache/incubator-cordova-weinre)来远程使用 webkit 开发者工具——太棒了。同样对于这类问题，Glimpse 也是一个很大的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T21:12:59.970

如果您在服务器上没有看到任何错误，则问题出在客户端。如果用户无法关联任何更多信息，则表明该按钮不起作用，那么您很可能会浪费时间尝试通过电子邮件解决此问题。我将与他们启动远程会话（使用您选择的工具），以便您可以查看他们的浏览器并实际能够亲自调试问题。

您可能会发现浏览器禁用了 javascript 或类似的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T21:11:24.297

可能最快的事情是与用户的机器进行某种远程会话。他们的机器上可能存在各种奇怪的配置怪癖，否则你永远不会发现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T21:17:27.900

我猜登录按钮是用户可以点击的第一个按钮。

您可能使用 jquery 绑定 onclick 事件，因此用户将禁用 javascript。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T21:11:04.190

询问用户您认为他正在使用的操作系统/浏览器/防火墙/其他任何您认为可能相关的东西，并尝试在开发人员的计算机上重现该错误。

调试用户问题的最佳方法是在开发计算机上重现它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T21:16:39.697

这些类型的问题必须重现，这是后方的皇家痛苦。在下一个版本的 Team System 中，在这里不会帮助你，有一个可以记录错误的工具，但我预计最早要到今年晚些时候才能发布。

如果这是客户端问题，您将无法通过仪器找到任何错误，因此您在服务器端无能为力。浏览器很可能抛出并捕获了 JavaScript 错误。用户甚至可能看不到它，因此他们甚至可能不知道该告诉您什么来帮助修复它。

您可以在一定程度上检测 JavaScript，但它可能有点矫枉过正。

# sql-server - linq to sql Insert 在部署的服务器（IIS）上不起作用

> ID：632277
> 
> 赞同：1
> 
> 时间：2009-03-10T21:06:22.030
> 
> 标签：sql-server, asp.net-mvc, linq-to-sql, iis, insert

标题不言自明，

```
db.ExecuteCommand("INSERT INTO tCSVFile(fileName, fileContent, mimetype, timeCreated) VALUES({0}, {1}, {2}, {3})", filename, EncodeTo64(CreateCSVFile(header, rows)), "text/csv", DateTime.Now ); 
```

这在虚拟服务器上工作正常，但在 iis 插入时不会发生任何事情。

这个也试过了。。

```
 tCSVFile c = new tCSVFile
            {
                fileContent = EncodeTo64(CreateCSVFile(header, rows)),
                fileName = filename,
                mimetype = "text/csv",
                timeCreated = DateTime.Now
            };

 db.tCSVFiles.InsertOnSubmit(c);
 db.SubmitChanges(); 
```

再次在虚拟服务器上工作，但在 iis 上没有运气。任何帮助将不胜感激，因为我在网上查看并没有发现任何有用的东西。我的选择工作正常，可以毫无问题地选择。

连接字符串是

```
<add name="db_ac_motors_testConnectionString" connectionString="Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\db_ac_motors_test.mdf;Integrated Security=True;User Instance=True"
      providerName="System.Data.SqlClient" /> 
```

插入是来自 MVC Partial 视图的调用，并通过 ajax.beginform() 完成

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T21:11:21.677

您确定数据库是否正确附加。许多 ISP 都设置了它，因此您无法使用您使用的连接字符串方法附加数据库。那是你应该看的第一个地方。我认为你会得到一个错误，但它可能会在堆栈中的某个地方被吞没。

如果您需要将 SQL 移动到 SQL 实例（不一定是 SQL Express）而不是附加，这可能会有所帮助： [http ://gregorybeamer.spaces.live.com/blog/cns!B036196EAF9B34A8!630.entry?sa=214268831](http://gregorybeamer.spaces.live.com/blog/cns!B036196EAF9B34A8!630.entry?sa=214268831)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T21:13:19.660

函数/方法`CreateCSVFile()`有什么作用？如果它将文件写入文件系统，那么看起来您有权限问题。即站点的匿名用户可能没有写权限。

只是一个想法。

凯夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T15:04:02.020

最后花了几个小时寻找某种异常后，我将堆栈跟踪保存在事件日志中并发现了这个错误

```
System.Data.SqlClient.SqlException: Failed to update database "(database directory)" because the database is read-only. 
```

因此，在互联网上进行一些钓鱼时，它与用户权限限制有关。

如果有人遇到同样的问题，这里是一个链接。我猜调试虚拟服务器读取文件夹权限的方式不同，因此仅限制部署（IIS 在权限方面有点挑剔）。而且我很惊讶没有返回异常......我不得不做很多事情来访问堆栈跟踪，我什至不想开始......无论如何，链接就是这个只是按照步骤操作，它应该指向你在正确的方向。

[http://social.msdn.microsoft.com/forums/en-US/sqldataaccess/thread/2e776fb4-6df9-4a11-96f1-948b8a2f839a/#page:2](http://social.msdn.microsoft.com/forums/en-US/sqldataaccess/thread/2e776fb4-6df9-4a11-96f1-948b8a2f839a/#page:2)

# asp.net - 基于 Web 的 .resx 文件编辑器？

> ID：632290
> 
> 赞同：7
> 
> 时间：2009-03-10T21:10:35.907
> 
> 标签：asp.net, sharepoint, localization, internationalization

我正在开发一个 SharePoint 网站，该网站最终需要本地化为多种不同的语言。我们可以使用资源文件，但我们希望翻译人员能够在站点运行时更新这些文件，而无需开发人员协助重新编译、重新部署等。

对我来说，我认为最简单的方法是提供一个 Web 应用程序来编辑位于 App_GlobalResources 目录中的 .resx 文件。有谁知道像这样的某种基于网络的 .resx 编辑器？我[从 LavaBlast](http://blog.lavablast.com/post/2008/02/RESX-file-Web-Editor.aspx)中找到了一个，但它同时显示了所有语言的值。随着我们计划拥有的语言数量，我认为这最终会变得笨拙。

任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-08T21:30:22.227

我使用了你找到的那个：[http](http://blog.lavablast.com/post/2008/02/RESX-file-Web-Editor.aspx) ://blog.lavablast.com/post/2008/02/RESX-file-Web-Editor.aspx 花了几个小时，但它很有效。我认为同时编辑多种语言非常有助于避免您的 resx 文件不同步，并轻松查看空白条目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T21:13:34.760

不是直接的解决方案，但[DotNetNuke](http://www.dotnetnuke.com)包含一个完整的语言文件编辑器，您可以从中提取逻辑供自己使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T21:13:40.687

Microsoft 发布了一个名为 Enterprise Localization Toolkit 的工具，您可能会看到：http: [//msdn.microsoft.com/en-us/library/aa479334.aspx](http://msdn.microsoft.com/en-us/library/aa479334.aspx)

自从我玩它以来已经有很长时间了，但它至少应该满足你的一些要求。对于非技术人员来说，这很容易使用。但是，您不直接编辑 RESX，因此它可能不是您所需要的。你生成它们然后部署。

# asp.net - 是否有一个控件将提前输入/自动建议功能与多选结合起来？乙

> ID：632292
> 
> 赞同：0
> 
> 时间：2009-03-10T21:10:53.020
> 
> 标签：asp.net, ajax, autocomplete

基本上，我正在尝试输入某些内容（例如在国家/地区字段中输入“United”）。例如，我希望自动建议功能建议“美国”和“英国”。最重要的是，我想通过单击缩小搜索结果上直接可用的链接或按钮来选择“美利坚合众国”和“英国”（在“美利坚合众国”和“英国”旁边） '）。请让我知道这是否可能以及是否有现有的示例？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T21:24:21.847

我的建议是查看控制供应商的网站。例如，我知道 Telerik 有一个 AJAX 套件，其中包括一个多选组合框，具有自动填充功能。但是，我不确定它是否完全适合您想要做的事情。看看它：

[http://www.telerik.com/products/aspnet-ajax/combobox.aspx](http://www.telerik.com/products/aspnet-ajax/combobox.aspx)

其他组件供应商：

```
http://www.devexpress.com
http://www.componentone.com
http://www.componentart.com
http://www.syncfusion.com 
```

我相信其他人可以举出更多的名字。

# c# - 如何配置我的设置文件以使用单元测试？

> ID：632297
> 
> 赞同：2
> 
> 时间：2009-03-10T21:12:27.617
> 
> 标签：c#, .net, nunit, app-config

我有一个正在为其编写单元测试的库。该库由两个应用程序使用：一个是 Windows 服务，另一个是执行一些注册表读写操作的命令行应用程序。每个都有一个略有不同的 App.config 文件，该文件在启动时从库中加载。例如：

```
 public RetentionService()
    {
        SettingHive = new Hive();
        TimingService = new RetentionTimingService(SettingHive);

        AppSettingsReader asr = new AppSettingsReader();
        object appsListObj = asr.GetValue(@"blocking-process-list", Type.GetType(@"System.String"));
        string appsList = appsListObj.ToString();
        _BlockingAppNames = RetentionService.ListFromList(appsList);

        string targetList = asr.GetValue(@"target-files", Type.GetType(@"System.String")).ToString();
        _TargetLogs = RetentionService.ListFromList(targetList);
    } 
```

当我尝试从单元测试中使用这个库时，它无法加载，因为加载库的应用程序（可能是 nunit）没有带有适当键的 *.exe.config 文件。

有什么更好的方法来做到这一点？我希望库在生产中从每个应用程序的 *.exe.config 加载设置，但如果运行单元测试，则从第三个位置加载。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T21:35:16.313

或者，只需将 app.config 文件添加到包含相关信息的单元测试项目中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T21:32:27.927

如果您的单元测试旨在测试代码，那么根本不要依赖配置文件。从类中提取依赖项并使用依赖项注入将数据注入。这样，您可以存根配置类。

如果您*实际上*只是在测试配置文件，您应该能够使用[ConfigurationManager](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.aspx)显式加载它，尽管我不建议对配置数据进行单元测试。它是烟雾测试的更好候选者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T21:26:16.163

您最好的选择可能是将对配置数据的访问封装在一个代理类中，您可以在运行时根据需要重定向它——不要直接使用内置 API。

# svn - 如何使用版本控制标签？

> ID：632298
> 
> 赞同：1
> 
> 时间：2009-03-10T21:12:32.233
> 
> 标签：svn, version-control, tags

我开发了一种宣传册网站模板，我的大多数客户网站都以此为基础。模板和派生站点一起存储在 Subversion 存储库中。前沿（但稳定）代码存在于`/trunk`; 每个网站都有自己的分支，使定制更容易。现在我即将发布 2.0 版本，我觉得我需要接受标签。

据我了解，应该标记重要的版本。标签只是一个指向特定版本的指针，**永远**不应该被修改。所以假设我的模板有一个 2.0 版的标签，并且主干中已经有新代码。如果我想创建一个基于 2.0 代码的新分支，我该怎么做呢？

我要分支`/tags/2.0`吗？这不可能。我将在哪里提交我的更改？我不得不故意绕开我的分支的祖先。我是否必须手动查找`/tags/2.0`对应的主干修订，然后在主干中分支该修订？这似乎……很麻烦。我相信直到最近 Subversion 甚至都没有存储这些信息！

显然，我缺少一些基本的东西。快速了解标签的*实际**使用* *方式*（而不是*它们**的*用途）会有所帮助。谢谢。

 ***编辑：在我说“分支`/tags/2.0`”的地方，我的意思是“签出`/tags/2.0`”。但那个错误也是我问题的答案。出于某种原因，我从未想过*复制*标签。愚蠢，对吧？但在我看来，标签是“最终的”。

顺便说一句，我完全明白标签只是一种约定。我感到困惑的是约定本身，而不是它的底层实现。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T21:16:09.683

始终从主干创建分支，除非您想从过去的某个点（过去的标签、分支或旧主干修订）进行分支。
此外，您不能轻易地将任何内容提交到标签上；至少 TortoiseSVN 客户端会通过消息保护您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T21:18:52.657

我将前沿（但稳定）放入/trunk。当一个版本的功能完成后，我将 /trunk 复制到 /branches/Foobar-1.2.3.X。我立即将 /branches/Foobar-1.2.3.X 复制到 /tags/Foobar-1.2.3.0 （这使以后的差异更容易，我可以将 /branches/Foobar-1.2.3.X 差异到 /tags/Foobar-1.2。 3.0 看看我的分支发生了什么变化，因为到那时 /trunk 可能会有所不同）。对 /branches/Foobar-1.2.3.X 中的功能进行最终开发，当我发布版本时，我复制到 /tags/Foobar-1.2.3.1、/tags/Foobar-1.2.3.2 等。我的构建系统是旨在仅从 /tags/Foobar-???? 中提取代码。

这也适用于“特殊”分支：/branches/Foobar-WhizzBangFeature-1.2.X

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T21:15:19.857

是的，在存储库的文件夹中为您要分支的版本创建一个[`svn copy`](http://svnbook.red-bean.com/en/1.0/re07.html)分支`/branch`。

例如：

```
/branch
/tags
  /1.0
  /2.0
/trunk 
```

然后对于 2.0 上的分支：

```
/branch
  /something2.0
/tags
  /1.0
  /2.0
/trunk 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T21:20:52.713

您在 /branches（或存储分支的任何位置）下制作标签目录的副本（使用 'svn copy'），可能使用 2.0-hotfix 或类似于分支名称的名称（与标签名称不同）。

它很简单。SVN 没有真正的标签和分支，只有目录和文件。这完全取决于您的政策。

可能更自然的方法是先创建 2.0 分支，稳定分支中的代码，然后从分支创建标签。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T21:30:30.740

我假设您使用的是 Tortoise SVN。假设您有以下情况：

```
/trunk
/braches
   /branch1
   /branch2
/tags
   /1.0
   /2.0 
```

那么你需要做的就是：

*   打开乌龟回购浏览器
*   转到根目录并扩展内容，以便您可以看到自己在做什么
*   选择 /tag/2.0 文件夹
*   按住 Ctrl 键将其复制到 /branches 文件夹
*   重命名新文件夹（或不重命名）

就是这样。然后，您需要查看 /branches/tag/2.0 （或您所称的任何名称）来处理它。

您需要做的是始终将 SVN 视为简单的文件系统。您在该文件系统中赋予事物的名称和含义取决于您。例如，您不能编辑“标签”这一事实只是一种约定——底层文件系统并不关心您是否编辑它们。

# encryption - 三重DES和RC4哪个是最好的加密机制？

> ID：632300
> 
> 赞同：5
> 
> 时间：2009-03-10T21:12:54.183
> 
> 标签：encryption, cryptography, comparison

[三重 DES](http://en.wikipedia.org/wiki/Triple_des)还是[RC4](http://en.wikipedia.org/wiki/RC4)？

我可以选择使用其中任何一个。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-10T21:18:59.537

作为高级视图，以下对两者的评论应该是有用的。

*   创建基于 RC4（例如 WEP）的协议非常容易，但强度极低（可在几分钟内被商用硬件破解，算作极弱）。

*   三重 DES 并不是很好，因为它的强度来自过多的 cpu 工作，但它比 RC4 的强度要大得多（理论上都是在现实世界的攻击中），因此应该是默认选择。

再深入一点：

在没有明确定义目标应用的加密领域，“最佳”的定义本质上是困难的，因为算法的“适合度”是多变的。

*   易于实施
    *   您可以在商品硬件上运行它吗？
    *   实现是否存在意外缺陷，这些缺陷会显着降低安全性，同时仍允许行为“正确”。
*   实施成本
    *   功率/硅/时间来编码/解码。
*   努力打破
    *   蛮力复原力。相当可量化
    *   对密码分析的抵抗力，难以量化，您可能会这么认为，但也许合适的人还没有尝试过：)
*   灵活性
    *   你能用上述一种换取另一种吗
    *   最大密钥大小是多少（因此是蛮力的上限）
    *   获得体面的加密需要什么样的输入大小，是否需要加盐。

实际上，努力破解自身需要大量的时间和精力，这就是为什么您（作为非密码学家）要使用已经完成的事情而不是自己动手。它也会随着时间的推移而发生变化，希望仅仅是由于可用硬件的改进而不是被发现的算法中的基本缺陷。

当然，最重要的核心问题就是，它安全吗？应该注意的是，许多以前被认为是安全的旧算法不再属于该类别。有些被如此有效地破坏，以至于它们的使用根本毫无意义，你没有任何安全性，只是*默默无闻*（有用但绝不可与真正的安全性相提并论）。

目前，RC4 和 TDES 的核心算法都不属于该类别，但 RC4 的幼稚实现在可以强制重复消息数据的协议中被认为存在极大缺陷。RC4 有几个比 TDES 更重要的理论缺陷。

也就是说，在上面列出的所有领域中，TDES 并不比 RC4 好。它的计算成本要高得多（而且这种昂贵是不合理的，存在其他成本较低的加密系统，其安全性与 TDES 相当）

一旦你有了一个真实世界的应用程序，你通常会得到以下一项或两项：

*   限制您的硬件来完成任务
*   施加的约束是您正在加密的数据（这用于传输仅需要保密 X 天的数据......例如）

然后，您可以通过容差和假设说明什么可以实现这一点（或者如果您根本做不到）并坚持下去。

在没有任何此类限制的情况下，我们只能为您提供以下信息：

### 易于实施

两者都为几乎所有可用的架构和平台提供公开可用的安全免费实现。如果可以强制重复消息，RC4 实现可能不像您想象的那么安全（请参阅 WEP 问题）。明智地使用加盐可能会降低这种风险，但这不会受到原始实施的严格分析，因此应该怀疑。

### 实施成本

我对 RC4 没有有用的基准（它是旧的）[http://www.cryptopp.com/benchmarks.html](http://www.cryptopp.com/benchmarks.html)有一些有用的指南可以将 TDES 与比 RC4 慢的 RC5 结合起来（TDES 至少是一个数量级比 RC4 慢）RC4 可以在现代 x86 处理器上以大约 7 个周期/字节加密流，以便进行比较。

### 努力打破

目前认为 TDES 的蛮力弹性很高，即使存在许多加密输出。RC4 蛮力弹性比 TDES 低几个数量级，并且在某些操作模式下*极低*（未能丢弃流的初始位）

对密码分析的抵抗力，Triple DES 存在众所周知的缺陷，但它们不会降低它在未来十年或两年内对实际攻击的有效性，对于 RC4 来说情况并非如此，因为已知多个缺陷并结合起来它们产生了可靠的攻击基于它的几个协议。

### 灵活性

TDES 的灵活性很小（而且您的库可能无论如何也不会公开它们）RC4 具有更大的灵活性（用于初始化它的密钥在理论上可以任意长，尽管库可能会限制这一点。

基于这一点以及您必须使用其中一个或另一个的声明，只有在 TripleDES 的 CPU 成本使其在您的环境中实现不切实际或 RC4 提供的低级别安全性仍然远高于您的安全性时，您才应考虑 RC4 实现要求指定。

我还应该指出，存在的系统在所有领域都比 RC4 和 TDES 在经验上更好。[eSTREAM](http://www.ecrypt.eu.org/stream/)项目正在以每个字节 5 个或更少周期的顺序评估各种流密码，尽管对它们的密码分析工作还没有真正完成。存在许多更快、更强的块密码来与 TDES 竞争。[AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)可能是最知名的，并且将成为候选者，因为它具有可比（如果不是更好）的安全性，但速度更快。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-10T21:24:30.803

抱歉 - 三重 DES 不再被视为最佳做法。AES 只是一种更好的算法，所以如果你*可以*使用它，那么你应该使用它。为了便于实施，请转到[此处](https://stackoverflow.com/questions/165808/simple-2-way-encryption-for-c/212707#212707)。

我强烈建议您通过阅读[Wikipedia](http://en.wikipedia.org/wiki/Triple_DES)上的 TDES 来了解更多信息。金钱报价是：

> “TDES 正在慢慢从使用中消失，很大程度上被高级加密标准 (AES) 所取代。”

老实说，对于安全性很重要的任何应用程序，RC4 都是不可接受的选择。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T21:46:05.447

同意——DES 在很大程度上已经过时了，所以除非有充分的理由使用它，否则请使用 AES。如果这不是一个选项，TDES 将是更好的选择，除非您正在处理流数据（即，不能分成块的数据），那么 RC4 是要走的路（在给定的选项之外）。

当然，我觉得我应该提一下……密码学真的很难做到正确，即使是最强大的算法也很容易被破坏，如果你有一点点错误（参见，例如，较旧的 Kerberos 或 WEP）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:17:08.790

这可能不是最有用的答案，但在我在一家大型电信公司工作的 4 年期间，Triple DES 是所有敏感应用程序的加密标准，其他应用程序根本不允许使用。它是三重 DES 或应用程序*未*上线。希望有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T21:19:47.757

两者都是安全的，嗯......足够了。RC4 更快，所以如果这对你很重要......

在阅读了其他人的答案（都是正确的）之后，很明显这真的取决于你的上下文。还有很多其他问题可能会影响您的决定。如果它只是需要万无一失，如果它不是真正敏感的东西，并且你有很多数据并且速度是因素，那就选择 RC4。

否则，如果您需要更安全且更易于实施的东西，或者正如您所说的“更难搞砸”:) 那就选择 3DES，据我所知，在 2020-2030 年之前足够安全（！），或类似的东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-30T16:00:07.530

那是你仅有的两个选择吗？如果您可以使用 AES（也称为 Rijndael），请改用它。DES 很慢，现在被认为已经过时（AES 是它的替代品）。RC4很烂，别用了。这是一个流密码，但您可以使用分组密码，只需填充最后的数据块（Google PKCS#5 填充方案）。最近我只看到嵌入式设备（固件）中使用了 DES，因为实现很简单，而且它使用的内存非常少。即使在 JavaME 中，您也可以使用 AES。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-18T15:08:28.053

在 3DES 和 RC4 之间做出决定的一个因素是语言支持。Java 本身并不支持 RC4，您需要获取诸如 BouncyCastle 之类的开源库来实现。MS没有同样的挑战。

# sql-server - 根据视图的存在，不能使用 IF 来创建或更改视图

> ID：632307
> 
> 赞同：19
> 
> 时间：2009-03-10T21:14:19.483
> 
> 标签：sql-server

我正在尝试实现以下代码的建议，但是`Incorrect syntax near the keyword 'view'`在创建和更改行上都出现错误。

```
IF Object_ID('TestView') IS NULL
    BEGIN
        create view TestView
        as
        . . .
    END
ELSE
    BEGIN
        ALTER view TestView
        as
        . . .   
    END 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-10T21:20:00.797

因为 ALTER/CREATE 命令不能在 BEGIN/END 块内。您需要在创建之前测试是否存在并删除它

```
IF Object_ID('TestView') IS NOT NULL
    DROP VIEW TestView

GO

CREATE VIEW TestView
   as
   . . .

GO 
```

如果您担心权限丢失，您也可以编写 GRANT 语句并在最后重新运行这些语句。

您可以将 create/alter 包装成一个字符串并执行 EXEC - 这对于大视图可能会变得很难看

```
DECLARE @SQL as varchar(4000)

-- set to body of view
SET @SQL = 'SELECT X, Y, Z FROM TABLE' 

IF Object_ID('TestView') IS NULL
    SET @SQL = 'CREATE VIEW TestView AS ' + @SQL
ELSE    
    SET @SQL = 'ALTER VIEW TestView AS ' + @SQL

EXEC(@SQL) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-07-26T12:56:55.897

我打算对 ProfK 的答案发表评论，但无法弄清楚如何在评论中格式化代码，所以这是一个答案。

* * *

使用 sp_executesql 更好，但您不需要指出它是一个 nvarchar 吗？否则我得到这个错误：过程需要'ntext/nchar/nvarchar'类型的参数'@statement'。

这是我用作视图模板的内容：

```
If not exists (Select Table_Name from INFORMATION_SCHEMA.VIEWS where Table_Name = 'vMessage') begin 
    exec sp_executesql N'create view vMessage as select test = 1'
    print 'Creating view vMessage'
end 

print 'Altering view vMessage'
go
Alter view vMessage 
as
Select 
* 
from Message 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-12T15:21:51.923

一位尊敬的同事在这方面帮助了我：

```
if object_id('demoView') is null
    sp_executesql 'create view demoView as select * from demoTable' 
```

工作得很好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-02-26T17:57:51.227

工作和简单的解决方案：

只需使用 EXEC 关键字包装您的 sql。请注意，即使在多行 sql 中，您也只需提供一次引号：

```
IF NOT EXISTS(select * FROM sys.views where name = 'TestView')
  BEGIN    
    EXEC ('
      CREATE VIEW [dbo].[TestView]
      AS
        SELECT
          *
        FROM
          dbo.SomeTable
    ')
  END
ELSE
  BEGIN
    EXEC ('
      ALTER VIEW [dbo].[TestView]
      AS
        SELECT
          *
        FROM
          dbo.SomeTable
    ')
  END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T21:20:57.457

如果创建了视图，则应该删除它，然后只进行更改

```
IF OBJECT_ID('TestView') IS NOT NULL
BEGIN 

DROP VIEW TestView
END

GO

CREATE VIEW TestView

AS 

SELECT * FROM TestTable 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-02T15:34:52.810

这是一种避免的方法`sp_execute_sql`：

```
 IF EXISTS ( SELECT  1
                FROM    sysobjects
                WHERE   type = 'V'
                        AND name = 'vwTradeEventTemp' )
        BEGIN
            DROP VIEW [dbo].[vwTradeEventTemp];
        END;
    GO

    CREATE VIEW [dbo].[vwTradeEventTemp]
    WITH SCHEMABINDING
    AS
    select col1, col2 from table
IF NOT EXISTS ( SELECT  1
                FROM    sysobjects
                WHERE   type = 'V'
                        AND name = 'vwTradeEvent' )
        BEGIN
            PRINT 'vwTradeEvent does not exist, renaming vwTradeEventTemp to vwTradeEvent to work around not being able to check for view existence before creating';
            EXEC sp_rename @objname = 'vwTradeEventTemp',
                @newname = 'vwTradeEvent', @objtype = 'object';
        END;
    ELSE
        BEGIN
            PRINT 'vwTradeEvent already exists, dropping vwTradeEventTemp';
            DROP VIEW dbo.vwTradeEventTemp;
        END; 
```

我不喜欢使用 sp_executesql，因为你失去了语法高亮和解析也不起作用......这也很方便，因为它避免了删除视图。在我的例子中，视图用于复制，所以删除它会失败，除非复制被删除并重新创建。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-10T21:26:31.170

如果您阅读了错误消息的其余部分，它将指出 create view 必须是第一个语句或类似的内容。

尝试：

```
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[testView]'))
    DROP VIEW [dbo].[testView]
GO

CREATE VIEW [dbo].[testView]
AS 
```

# c# - 在 Fluent NHibernate 中回滚由 PersistenceSpecifications 创建的记录

> ID：632308
> 
> 赞同：7
> 
> 时间：2009-03-10T21:15:07.283
> 
> 标签：c#, fluent-nhibernate

我正在学习一些 Fluent NHibernate，并且遇到了半真棒 PersistenceSpecification 类。

我已经在单元测试中设置它来验证我的映射并且效果很好。但是，它在完成后将记录留在数据库中。我尝试将其放入事务中，以便回滚更改，但出现错误：

System.ObjectDisposedException：无法访问已处置的对象。对象名称：'AdoTransaction'..

如果没有事务，我必须找出记录的 ID，检索它们并删除它们，这似乎不太优雅。

有什么想法吗？

编辑：

这是代码片段：

```
 var factory = GetSessionFactory();
            using (var session = factory.OpenSession())
            using (var transaction = session.BeginTransaction())
            {
                new PersistenceSpecification<TimePeriod>(session)
                        .CheckProperty(x => x.EndDate, DateTime.Today)
                        .VerifyTheMappings();
                transaction.Rollback();
            } 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-01-03T10:27:02.197

尝试在事务上设置 IsolationLevel。这个片段对我有用：

```
using (var trans = _session.BeginTransaction(IsolationLevel.ReadUncommitted))
{
    new PersistenceSpecification<Event>(_session)
        .CheckProperty(p => p.StartTime, new DateTime(2010, 1, 1))
        .VerifyTheMappings();
    trans.Rollback();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T08:53:40.053

`PersistenceSpecification`通常与 SQLite 等内存数据库一起使用，这就是它不回滚任何内容的原因。我相信有一个构造函数重载需要一个`ISession`实例，您是否尝试过从那里获取事务然后将其回滚？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T01:19:07.307

我认为这里的问题是 VerifyTheMappings() 调用 TransactionSave() 对数据库执行 tx.Commit() 。正如 James 所指出的，这种技术似乎非常适合丢弃内存测试技术。这在针对遗留数据库测试映射的情况下*不起作用*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-09T03:06:26.050

设置`IsolationLevel.ReadUncommitted`将起作用，但只是顺便说一句，因为它所做的只是告诉会话它可以在不需要新事务的情况下读取（用 DBMS 的说法是脏读） - 因此`Session.Transaction.Commit ()`不必在验证读取之前提交数据库事务. 这也意味着它不一定是在测试你认为它正在测试的东西！（我也认为这在非​​ MS SQL 数据库中可能有问题的支持）。leebrandt 的答案之所以有效，是因为显式回滚，而不是隔离级别（注意。在回答时，这比现在更有帮助，请参见下面的注释）。

好消息是正确的方法是手动回滚事务。`Session.Transaction`每当提交事务时都会自动替换，因此您需要保留对它的引用，并且无论如何您都必须显式打开一个，因为`TransactionalSave ()`检查当前事务是否处于活动状态并创建（并处置！）它自己的 if不是。我通常在同一个夹具中测试我的所有映射，在那里我还验证了工厂创建和其他一些基础设施持久性的东西，所以我喜欢下面的模式来减少管道：

```
class TestFixture {
    static ISessionFactory factory = CreateMyFactorySomehowHere();

    ISession session;
    ITransaction tx;

    public void Setup ()
    {
        session = factory.OpenSession ();
        tx = session.BeginTransaction ();
    }

    public void Cleanup ()
    {
        tx.Rollback ();
        tx.Dispose ();
        session.Close ();
    }

    public void TestAMappingForSomething ()
    {
        var spec = new PersistenceSpecification<Something> (session);
        spec.VerifyTheMappings ();
    }
} 
```

显然，在任何地方插入您自己的特定于测试框架的术语和属性/注释，但您明白了。

* * *

我刚刚注意到这个问题有多老了：此行为已在 7 月 9 日的[此提交](https://github.com/jagregory/fluent-nhibernate/commit/3bc49e5f25efc0cc38072e09ca41aad7cecbe962#src/FluentNHibernate/Testing/PersistenceSpecification.cs)中修复，以很好地处理现有事务，以便上述工作！显然，无论如何，这就是您最初所做的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-15T14:29:04.467

我认为使用您的真实数据库进行此测试非常重要，以查看他的表定义是否正常，因此我开发了一个非常简单的类，该类对映射实体执行粗略测试并在最后回滚；

```
 internal class GenericMappingTesterWithRealDB<T> where T : IIdentifiable
{
    public T EntityToTest { get; set; }
    public Func<T, object> PerformEntityManipulationBeforeUpdate { get; set; }
    public GenericMappingTesterWithRealDB()
    {
        Assume.That(SessionFactoryProvider.NewSession,Is.Not.Null);
    }

    public void RunTest()
    {
        using (ISession session = SessionFactoryProvider.NewSession)
        using (ITransaction transaction = session.BeginTransaction())
        {
            try
            {
                session.Save(EntityToTest);
                var item = session.Get<T>(EntityToTest.ID);
                Assert.IsNotNull(item);
                if (PerformEntityManipulationBeforeUpdate != null)
                {
                    PerformEntityManipulationBeforeUpdate.Invoke(EntityToTest);
                }
                session.Update(EntityToTest);
                session.Delete(EntityToTest);
                session.Save(EntityToTest);
            }
            catch (Exception e)
            {
                Assert.Fail(e.Message, e.StackTrace);
            }
            finally
            {
                transaction.Rollback();
            }
        }
    }
} 
```

在我的项目中可以识别的是我的实体的最基本的接口

该课程正在使用 nunit.framework 但您可以使用您想要的每个测试框架来完成

sessionfactoryprovider 需要提供 isession obj

这是一个使用示例

```
/// <summary>
/// Testing the mapping of our entities.
/// there must be a server connection for this kind of test.
/// </summary>
[TestFixture]
internal class someMappingTest
{
    [Test(Description = "Check the Encoding Profile FluentNHibernate Mapping")]
    [Timeout(20000)]
    public void checkthatMappingWorks()
    {
        // creatw the new entity
        TestedType testOn = new TestedType();

        // set the initialization values
        testOn.Name = "TestProfileExecution";

        // create the test object
        new GenericMappingTesterWithRealDB<TestedType>
        {
            // assign an entity
            EntityToTest = testOn,

            // assign new values for update check
            PerformEntityManipulationBeforeUpdate =
                delegate(TestedType testedTypeBeingTested)
                    {
                        return testedTypeBeingTested.Name = "Updateing Test";
                    }
        }.
        // call run test to perform the mapping test.
        RunTest();

    }
} 
```

# iphone - iPhone SDK：IBAction

> ID：632309
> 
> 赞同：0
> 
> 时间：2009-03-10T21:15:10.777
> 
> 标签：iphone, uikit, interface-builder

我有一种情况，我想要一个按钮来响应两种不同的 IBAction 方法。有没有办法可以先强制使用特定方法？当我查看 IB 中的按钮连接时，它们的顺序是正确的，但它们始终以相反的顺序执行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T21:22:44.847

我不这么认为，但为什么不直接调用另一个动作呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T22:03:41.160

删除 IB 中的所有连接，然后按照我需要的顺序重新连接似乎可行。

# c# - 确定文件中更改的字节的开始和结束范围

> ID：632317
> 
> 赞同：2
> 
> 时间：2009-03-10T21:17:21.023
> 
> 标签：c#, diff, postgresql, pervasive, btrieve

我正在开发一个在我们公司内部使用的小型实验实用程序，它可以索引存储在我们的自定义 CRM 软件中的笔记以进行全文搜索。这些笔记存储在 Btrieve 数据库（一个名为 NOTES.DAT 的文件）中。可以使用 Pervasive 的 ADO.NET 提供程序连接到数据库并检索注释以进行索引。但是，索引器当前循环遍历每个注释并每 5 分钟重新索引一次。这似乎非常低效。

不幸的是，我们的 CRM 软件无法向索引服务发出通知已更改注释，因为数据库可能存在于远程计算机上（并且开发人员不会编写与我的通信的过程）通过网络提供服务，因为它现在只是一个爱好项目）。

与其放弃，我想借此机会了解更多关于原始 Btrieve 数据库的知识。所以，这是我的计划...

NOTES.DAT 文件必须共享，因为我们的 CRM 软件使用 Btrieve API 而不是 ODBC 驱动程序（这意味着客户端安装必须能够在网络上看到文件本身）。我想监视这个文件（使用 FileSystemWatcher 之类的东西？），然后确定被更改的字节。使用该信息，我将尝试计算该位置的记录并获取其主键。然后索引器将使用 Pervasive 的 ADO.NET 提供程序仅更新该记录。

问题（除了我不太了解 Btrieve 文件的结构，或者是否可以从原始数据确定主键）是我不知道如何确定字节的开始和结束范围在 NOTES.DAT 中进行了更改。

我可以区分两个版本，但这意味着在某处存储 NOTES.DAT 的副本（它可能非常大，因此需要全文索引服务）。

最有效的方法是什么？

谢谢！

编辑：在一个事务中添加、编辑或删除多个注释是可能的，因此如果可能，该方法需要能够确定多个单独的字节范围。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T23:25:44.600

如果您的`NOTES.DAT`文件存储在[NTFS 分区](http://en.wikipedia.org/wiki/NTFS)上，那么您应该能够执行以下操作之一：

*   使用[USN 日志](http://en.wikipedia.org/wiki/USN_Journal)来识别对文件的[更改](http://www.microsoft.com/msj/0999/journal/journal.aspx)（首选）
*   使用[卷影复制服务](http://en.wikipedia.org/wiki/Shadow_Copy)通过 VSS（非常快）拍摄定期快照来跟踪文件的更改，然后：
    *   `diff`版本`N`和`N-1`（可能没有重新索引那么慢，但仍然很慢），或者
    *   深入研究并尝试确定哪些块在感兴趣的文件的哪些偏移处发生`diff`了`$Mft`变化（更复杂，但也更快 - 但仍然不如使用 USN 期刊那么快、可靠和简单）

使用 USN 期刊应该是您的首选方法。您可以使用该[`FSUTIL`](http://technet.microsoft.com/en-us/library/cc788042.aspx)实用程序创建和截断 USN 日志。

# c# - C# 中包含内部空格的姓氏的正则表达式

> ID：632322
> 
> 赞同：6
> 
> 时间：2009-03-10T21:18:06.277
> 
> 标签：c#, regex, spaces

我想要一个匹配“Johnson”、“Del Sol”或“Del La Range”的 C# 正则表达式；换句话说，它应该匹配中间有空格但开头或结尾没有空格的单词。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T21:33:49.033

```
^\p{L}+(\s+\p{L}+)*$ 
```

此正则表达式具有以下功能：

*   将匹配一个字母的姓氏（例如 Malcolm X 的姓氏）
*   将不匹配包含数字的姓氏（如带有 a`\w`或 a `[^ ]`will 的任何东西）
*   匹配 unicode 字母

但是像“O'Connor”这样的姓氏或连字符的姓氏呢......嗯......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T21:26:39.330

这应该做的工作：

```
^[a-zA-Z][a-zA-Z ]*[a-zA-Z]$ 
```

**编辑：**这是一个轻微的改进，允许在名称中使用后一个名称和连字符/撇号：

```
^[a-zA-Z'][a-zA-Z'- ]*[a-zA-Z']?$ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T21:46:38.317

在名称“Ṣalāḥ ad-Dīn Yūsuf ibn Ayyūb”（参见[http://en.wikipedia.org/wiki/Saladdin](http://en.wikipedia.org/wiki/Saladdin)）中，哪个是名字，哪个是最后一个？以“Roberto Garcia y Vega”（发明）的名义怎么样？“蒋介石”（见[http://en.wikipedia.org/wiki/Chang_Kai-shek](http://en.wikipedia.org/wiki/Chang_Kai-shek)）？

名称中的空格是您最少的问题！请参阅[全局应用程序中的个人姓名：要存储的内容](https://stackoverflow.com/questions/620118/personal-names-in-a-global-application-what-to-store)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T21:21:33.727

这 ？限定符是你的朋友。进行最短可能匹配而不是贪婪匹配。将其用作名字，如下所示：

```
^(.+?) (.+)$ 
```

第 1 组抓取第一个空间之前的所有内容，第 2 组获得其余部分。

当然，现在如果*名字*包含空格怎么办？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T21:25:20.630

尝试这样的事情：

```
^[^\s][\w\s]*[^\s]$ 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-10T16:31:54.387

这是一个更好的：

```
/^[a-zA-Z]+(([\'\,\.\- ][a-zA-Z ])?[a-zA-Z]*)*$/ 
```

允许标准标点符号和空格，但不能以标点符号开头。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-10T21:35:16.313

我认为这更符合您的要求：

```
^[^ ][a-zA-Z ]+[^ ]$ 
```

这应该匹配行的开头，没有空格、字母字符或空格，并且结尾没有空格。

这适用于 irb，但上次我使用 C# 时，我使用了类似的正则表达式：

（零表示好，nil 表示失败）

```
>> "Di Giorno" =~ /^[^ ][a-zA-Z ]+[^ ]$/
=> 0
>> "DiGiorno" =~ /^[^ ][a-zA-Z ]+[^ ]$/
=> 0
>> " DiGiorno" =~ /^[^ ][a-zA-Z ]+[^ ]$/
=> nil
>> "DiGiorno " =~ /^[^ ][a-zA-Z ]+[^ ]$/
=> nil
>> "Di Gior no" =~ /^[^ ][a-zA-Z ]+[^ ]$/
=> 0 
```

# sql-server - SQL Server - 空列的性能/大小缺点

> ID：632332
> 
> 赞同：11
> 
> 时间：2009-03-10T21:21:50.793
> 
> 标签：sql-server, sql-server-2005, database-design, null

我正在研究一个表设计，它可能在大约 10 个字段中涉及许多 NULL 值，可能有 75% 的时间字段将未被使用。

我刚刚生成了一些假数据（一百万条记录），感觉不到对 SQL Server 2005 的任何影响。大小差异在 KB 中。性能 - 向 3 个不可为空的列添加索引后没有可测量的差异。

我知道 SQL Server 2008 具有稀疏列功能（我假设将在下一个 SharePoint 的 UserData 表中使用该功能）。我希望我的代码可以在 2005 年运行。但是当前 SharePoint UserData 表的设计中存在大量 NULL 值。所以如果它对微软来说足够好......

关于 SQL Server 表中许多 NULL 值的缺点或痛点的任何好的文章、链接、白皮书？当您扩展到 1000 万或 10000 万条记录时，任何人都知道会发生什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T21:28:16.050

我从来没有遇到过多个空列的性能问题，即使是在 100 多个演出大小的数据库上也是如此。如果您在这些字段上运行索引然后在查询中使用 null，我想您最终可能会遇到问题，但我个人认为这不是问题。再说一次，我没有创建除 3 之外的每个字段都可以为空的数据库表。

另一方面，当大部分数据为空时，我看到了架构问题。一般原因是 a) 不正确的规范化数据库或 b) 试图允许用户在最终表中暂存数据，而不是在提交到数据库之前创建单独的表来“构建”数据。

由您决定数据库的最佳架构。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-10T21:28:57.030

在这种很常见的情况下，我所做的是将数据拆分为两个表：

*   所需数据
*   可选数据

例如，我目前正在编写一个社区网站，其中一张表显然是用户表。我正在记录大量有关用户的信息，因此我将收集的数据拆分为两个表：

*   用户
*   用户详情

*用户*表包含我一直需要的基本信息，例如用户名、名称和会话信息。

*UserDetails*表包含我不需要的额外信息，例如个人资料页面、电子邮件地址、密码、网站地址、出生日期等。

这称为[垂直分区](http://en.wikipedia.org/wiki/Partition_(database))。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T21:26:03.217

我过去遇到的问题涉及具有 NULL 值的编程含义。例如，客户端的问题，或者由于存在空值而不期望返回数据的查询中的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:26:16.867

好吧，NULL 在数据库中总是有点奇怪。我认为它不会对您的情况产生太大的性能影响 - 但当然，您必须分别处理所有 NULL 值。

只要有可能，我尽量使用默认值，因此如果您有一些 INT 类型的 ID 值，您可以使用 0 或 -1 作为“无值存在”指示符。这样，您可以避免必须检查值（字段 < 0）并单独检查 NULL（字段 IS NULL 或 IS NOT NULL）。

马克

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-22T08:57:26.283

列中 NULL 的概率越高，该列应该在表中越接近记录末尾（到表中的 lat 列）。
行尾的 NULLS 没有分配任何空间，它们由链接到每条记录的 NULL BITMAP 确定（它是 2 个字节，每个位都说明记录中的一个列值的（非）NULL-ness ）。

现在，NULL 值不是从列中读取的，而是从 NULL 位图中读取的。当检测到 NULL 时，会跳过实际值读取

应谨慎使用稀疏特性，因为它会为非空值调用时间和空间开销为了提高性能，您可以对[列的非空部分使用过滤索引](http://blogs.technet.com/b/andrew/archive/2008/02/21/sql-server-2008-filtered-indexes.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T21:26:17.320

只有一种方法可以确定。继续插入 1 亿条记录，然后测量端到端性能。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-10T21:25:40.987

不要创建一个包含 75% 未使用列的表。使用您将一直使用的列，并考虑将[EAV](http://en.wikipedia.org/wiki/Entity-Attribute-Value_model)之类的东西用于其他列，或者将它们放在不同的表中。

# mysql - 从查询结果填充表（mysql）

> ID：632343
> 
> 赞同：13
> 
> 时间：2009-03-10T21:24:33.923
> 
> 标签：mysql

我想用现有表的查询结果填充一个表。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-10T21:29:06.297

（您不需要匹配表模式）

```
INSERT tbl_name (col1, col2)
    SELECT value1, value2
    FROM othertable 
```

请参阅[INSERT ... SELECT 语法的参考](http://dev.mysql.com/doc/refman/5.5/en/insert-select.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T21:27:31.497

```
insert into table_name ...
select * from table_name where .... 
```

目标表和源查询的列数和数据类型必须匹配

看到这个[链接](http://www.1keydata.com/sql/sqlinsert.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-11T00:02:22.357

您甚至可以通过这种方式创建表，但列名必须匹配，或者选择结果被放入自动添加的列中：

```
mysql> create table foo ( id int primary key auto_increment, bar datetime )
    -> select now() as bar, now() as baz from dual;
Query OK, 1 row affected, 1 warning (0.06 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql> select * from foo;
+----+---------------------+---------------------+
| id | bar                 | baz                 |
+----+---------------------+---------------------+
|  1 | 2009-03-10 17:01:35 | 2009-03-10 17:01:35 |
+----+---------------------+---------------------+
1 row in set (0.00 sec) 
```

# wpf - WPF 用户控件样式

> ID：632356
> 
> 赞同：5
> 
> 时间：2009-03-10T21:27:13.650
> 
> 标签：wpf, user-controls, styles

我想设置我项目的所有用户控件的背景属性。

我试过了

```
<style TargetType={x:Type UserControl}>
    <setter property="Background" Value="Red" />
</style> 
```

它编译但没有工作。

任何想法？谢谢！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-11T10:38:57.117

您只能将 aa 样式设置为特定类，因此这将起作用（创建一个 UserControl 对象，不是很有用）：

```
<Window.Resources>
    <Style TargetType="{x:Type UserControl}">
        <Setter Property="Background" Value="Red" />
    </Style>
</Window.Resources>
<Grid>
    <UserControl Name="control" Content="content"></UserControl>
</Grid> 
```

但这不是（创建一个派生自 UserControl 的类）：

```
<Window.Resources>
    <Style TargetType="{x:Type UserControl}">
        <Setter Property="Background" Value="Red" />
    </Style>
</Window.Resources>
<Grid>
    <l:MyUserControl Name="control" Content="content"></l:MyUserControl>
</Grid> 
```

您可以做的是使用 Style 属性显式设置样式：

```
<Window.Resources>
    <Style TargetType="{x:Type UserControl}" x:Key="UCStyle">
        <Setter Property="Background" Value="Red" />
    </Style>
</Window.Resources>
<Grid>
    <l:MyUserControl Name="control" Content="content" Style="{StaticResource UCStyle}"></l:MyUserControl>
</Grid> 
```

或者为每个派生类创建一个样式，可以使用 BasedOn 避免重复样式内容：

```
<Window.Resources>
    <Style TargetType="{x:Type UserControl}" x:Key="UCStyle">
        <Setter Property="Background" Value="Red" />
    </Style>
    <Style TargetType="{x:Type l:MyUserControl}" BasedOn="{StaticResource UCStyle}" />
</Window.Resources>
<Grid>
    <l:MyUserControl Name="control" Content="content"></l:MyUserControl>
</Grid> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T02:09:42.613

我认为您缺少一些双引号：

尝试这个：

```
<Window.Resources>
    <Style TargetType="{x:Type UserControl}">
        <Setter Property="Background" Value="Red" />
    </Style>
</Window.Resources>
<Grid>
    <UserControl Name="control" Content="content"></UserControl>
</Grid> 
```

# regex - 如何重定向子文件夹以在 IIS 7.0 的 Mod Rewrite 中查询？

> ID：632360
> 
> 赞同：0
> 
> 时间：2009-03-10T21:28:14.180
> 
> 标签：regex, iis, iis-7, rewrite

我正在使用来自 iis.net 的 Mod Rewrite for IIS 7.0 并希望重定向请求：

*   *[http://example.com/users/](http://example.com/users/) **foo***到*[http://example.com/User.aspx](http://example.com/User.aspx)？**名称=foo***
*   *[http://example.com/users/](http://example.com/users/) **1***到*[http://example.com/User.aspx](http://example.com/User.aspx)？**id=1***

我创建了 2 条规则：

```
<rule name="ID">
   <match url="/users/([0-9])" />
   <action type="Rewrite" url="/User.aspx?id={R:1}" />
</rule>
<rule name="Name">
   <match url="/users/([a-z])" ignoreCase="true" />
   <action type="Rewrite" url="/User.aspx?name={R:1}" />
</rule> 
```

它通过测试进入 iis mmc 测试对话框，但不在调试中（URL 像*[http://localhost:9080/example.com/users/1](http://localhost:9080/example.com/users/1)*或*.../users/foo*）并且不在真正的 IIS 上！

我做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-06T12:49:52.253

明显的问题是您当前的正则表达式仅匹配用户名中的一个字符或一个数字。您需要在括号内添加一个加号量词以匹配多个字母或数字。有关正则表达式量词的更多信息，请参阅[此页面。](http://www.regular-expressions.info/repeat.html)请注意，您不会匹配像“/users/”这样的普通 URL（没有 ID 或名称）。确保这是您想要的。

您遇到的另一个问题是 IIS 从初始斜杠后的第一个字符开始评估重写规则。因此，您要匹配的规则`/users/([0-9])`不会匹配任何内容，因为当正则表达式评估发生时，URL 看起来像`users/foo`not `/users/foo`。解决方案是在模式的开头使用`^`（这是表示“字符串开头”的正则表达式字符）而不是斜杠。像这样：

```
<rule name="ID">
    <match url="^users/([0-9]+)" />
    <action type="Rewrite" url="/User.aspx?id={R:1}" />
</rule>
<rule name="Name">
    <match url="^users/([a-z]+)" ignoreCase="true" />
    <action type="Rewrite" url="/Users.aspx?name={R:1}" />
</rule> 
```

请注意，您选择`Users.aspx`其中一个 URL 并选择另一个`User.aspx`（非复数形式）。确保这是您想要的。

顺便说一句，我解决这些问题的方法是使用[IIS Failed Request Tracing 对重写规则进行故障排除](http://learn.iis.net/page.aspx/467/using-failed-request-tracing-to-trace-rewrite-rules/)。这使得诊断变得非常容易。我能够发出测试请求并查看跟踪以找到正在评估每个重写规则的位置（它位于跟踪的一个名为“PATTERN_MATCH”的部分中。对于您的一个规则的特定 PATTERN_MATCH，我看到了这个：

> -PATTERN_MATCH
> 模式 /users/([0-9]+?)
> InputURL users/1 否定
> false
> 匹配 false

请注意缺少开头的斜线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-06T12:06:48.580

您应该分别使用`<match url="/users/([0-9]+)" />`和`<match url="/users/([a-z]+)" ignoreCase="true" />`来匹配完整的 id/用户，而不仅仅是他们的第一个字母/数字。但我不知道为什么你的正则表达式会在一位数上失败，所以肯定还有另一个问题。

至于你的第二个问题，我不确定我是否完全理解。如何区分文件夹名和用户名？文件夹总是有斜杠吗？

# java - 找不到标志

> ID：632370
> 
> 赞同：2
> 
> 时间：2009-03-10T21:32:10.813
> 
> 标签：java

我创建了一个小型 Java 应用程序来自动测试一些表达式的真/假条件。

我在 jGRASP 和 javac 命令中都遇到了两个编译器错误。

代码如下：

```
public class MathTest {
    public static void main(String[] args) {

        int x = 10;
        int y = 20;
        int z = 30;
        String string1 = "six";
        String string2 = "six";

        if (x < 10 || x > 10)
            System.out.print("True");
        else
            System.out.print("False");

        if (z - y == x && Math.abs(y - z) == z)
            System.out.print("True");
        else
            System.out.print("False");

        if (x < 10 && x < 10)
            System.out.print("True");
        else
            System.out.print("False");

        if (string1.equals(string2))
            System.out.print("True");
        else
            System.out.print("False");
        if (x > y || y > x)
            System.out.print("True");
        else
            System.out.print("False");

        if (!(x < y + z) || !(x + 10 <= 20))
            System.out.print("True");
        else
            System.out.print("False");

        if (string1 == string2)
            System.out.print("True");
        else
            System.out.print("False");

    }
} 
```

错误信息是：

```
    MathTest.java:14：找不到符号
    符号：方法 abs(int)
    地点：数学课
    if(z - y == x && Math.abs(y - z) == z)
                     ^
    ./Math.java:13：找不到符号
    符号：方法 abs(int)
    地点：数学课
    if(z - y == x && Math.abs(y - z) == z)
                     ^
    2 个错误

```

我究竟做错了什么？

万一我的导师或盐湖社区学院的任何管理员遇到这个问题，让我明确表达我的意图。这个问题是本着学术诚信的最大精神发布的。我问这个问题是为了寻求一般建议和帮助，以了解使用 Java 编程语言的正确方法。我绝不会使用他人的作品并将其视为我自己的作品。我使用此处提供的答案作为我理解的一般帮助。我自己做所有的工作，不会复制回答我问题的人提供的工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T21:34:14.430

您有一个 Math 类，并且您正在尝试使用 abs() 方法。

问题是：您是打算提供此功能还是尝试使用 java.lang.Math 中的功能？

首先，您必须确保声明了该功能。

其次，您必须确保使用正确的参数类型；见[数学](http://java.sun.com/javase/6/docs/api/java/lang/Math.html)。

你的数学课有 abs 方法吗？

似乎您的 Math 课程正在掩盖语言核心中的 Math 课程。

您的 Math 类已加载，但找不到 abs 方法（因此出现“找不到符号”消息）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T21:44:41.330

如果您希望您的程序使用 Java 的 Math.abs（而不是您编写的 Math 类中的 abs() 方法），您可以说：

```
if(z - y == x && java.lang.Math.abs(y - z) == z) 
```

...这不是很漂亮。一般来说，尽量不要将类命名为与 java.lang（或 java.anything，真的）中的类相同。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T21:43:48.930

在您的编译器输出中，您有：

```
./Math.java:13: cannot find symbol 
```

看起来您正在尝试编写自己的类，并且它是内置`Math`的 shadowing 。`java.lang.Math`

你必须有一个你自己的班级`Math`吗？如果没有，那么只需删除`Math.java`并尝试再次编译它。如果您**确实**需要`Math.java`，请尝试将其重命名为其他名称（例如，`MyMath.java`在`public class MyMath`内部定义）。

# sql-server - 准备迁移到单个数据库

> ID：632373
> 
> 赞同：1
> 
> 时间：2009-03-10T21:32:49.143
> 
> 标签：sql-server, database, database-design

我们有一个拥有 1000 多个数据库和 600 多个存储过程的应用程序。每个数据库代表一个不同的客户端。

问题：我们需要将其移动到单个数据库，同时尽可能少地对 ui 产生影响，这意味着不要一次更改所有 sproc 签名。

连接字符串当前设置数据库属性，建议将其移至用户属性。此属性（使用 SYSTEM_USER）可用于确定将在 where 子句中使用的站点标识符。

以上不是最终解决方案，但允许我们以缓慢可控的速度更改存储过程签名。完成所有操作后，我们可以更正 connstring 并获得一些连接池。

我们在 sqlserver 2005/8 上可以拥有的登录名/用户数是否有任何限制。或者有没有人沿着这条路走下去，可以为更好的选择提供一些启示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T21:36:47.323

在这里查看我的答案 [将千库合并为一个数据库的想法](https://stackoverflow.com/questions/632251/ideas-for-combining-thousand-databases-into-one-database/632319#632319)

听起来你们两个在做同一个项目。您将需要更改每个 proc，然后才能移动到一个数据库，否则每个客户端都会看到其他客户端的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T21:39:27.147

至于 SQL Server 2005 / 08 上的登录次数 - 我认为没有人在这里遇到过硬限制。几千根本*不会*有任何问题。

对于这种情况，您可以考虑的可能是每个客户在单个数据库中的一个模式，例如，客户“Miller”有一个“miller”模式，其中包含其对象，而客户“Brown”将有一个“棕色”模式。

与 HLGEM 刚刚回应的相反 - 不，客户不会看到彼此的数据，如果您指定适当的权限 - 每个客户（及其用户）仅进入其自己的模式 - 应该可以正常工作。

马克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T21:44:36.637

您还可以考虑在连接字符串中设置一个独特的应用程序名称，而不是使用一个独特的用户，您可以使用 APP_NAME() 进入您的 where 子句。我确信 SQL Server 不会有成千上万的登录问题，但您可能更愿意不必创建它们。

# java - 如何更改 JButton 的图像？

> ID：632376
> 
> 赞同：0
> 
> 时间：2009-03-10T21:33:26.770
> 
> 标签：java, swing, jbutton

我正在开发一个记忆游戏程序。我在 JPanel 上有 30 个 JButton。当用户单击并找到匹配项（意味着具有相同图像的两个按钮）时，我想将 JButton 上的图像更改为不同的图像。但是，在程序运行时不会发生这种情况。

我怎样才能做到这一点？

我正在这样做：

```
cards[i].setIcon(cardBack); 
```

其中 cardBack 是我已经拥有的 ImageIcon 。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2014-08-11T07:59:04.767

您可以使用以下代码：

`Icon i=new ImageIcon("image.jpg"); jButton1.setIcon(i);`

并将您的图像（image.jpg）复制到您的项目文件夹中！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-03-08T15:43:40.173

使用 JToggleButton。更具体地说，使用 setIcon 和 setSelectedIcon 方法。使用这种方法，您将避免重新发明轮子。

例子：

```
import java.awt.FlowLayout;
import javax.swing.JFrame;
import javax.swing.JToggleButton;
import javax.swing.SwingUtilities;
import javax.swing.UIManager;

final class JToggleButtonDemo {
    public static final void main(final String[] args) {
    SwingUtilities.invokeLater(new Runnable(){
        @Override
        public void run() {
            createAndShowGUI();
        }
    });
}
private static final void createAndShowGUI(){
    final JFrame frame = new JFrame();
    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    frame.setLayout(new FlowLayout()); // For presentation purposes only.
    final JToggleButton button = new JToggleButton(UIManager.getIcon("OptionPane.informationIcon"));
    button.setSelectedIcon(UIManager.getIcon("OptionPane.errorIcon"));
    frame.add(button);
    frame.pack();
    frame.setLocationRelativeTo(null);
    frame.setVisible(true);
 }
} 
```

# c# - 如何制作对象的副本？

> ID：632383
> 
> 赞同：5
> 
> 时间：2009-03-10T21:36:09.010
> 
> 标签：c#, asp.net

我创建了一个名为 Colors 的类。我在 Colors 对象上设置某些属性并将其设置在 Session 变量中。当我在另一个页面上访问 Session 变量时，我注意到如果我更改下面 objColors 上的属性，它会更改 Session 并且不会保留我想要它做的原始属性。这是一个例子：

```
Session["Colors"] = Colors;

Colors objColors = Session["Colors"];

//If I change objColors, it changes the Session.  I don't want this to happen. 
```

有没有更好的方法来保留原始属性？为什么这样做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T21:39:26.880

为颜色创建一个复制构造函数。然后，这样做。

```
Colors objColors = new Colors((Colors)Session["Colors"]); 
```

在您的新构造函数中，只需复制您需要的值并执行其他与构造函数相关的事情。

您的代码中发生的事情是您获得了***指向***Colors 对象的指针。Session["Colors"] 和 objColors 指向内存中的同一个对象，因此当您修改一个对象时，更改会反映在两者中。您想要一个品牌新的 Colors 对象，其值从 objColors 或 Session["Colors"] 初始化。

编辑：复制构造函数可能如下所示：

```
public Colors(Colors otherColors)
{
    this.privateVar1 = otherColors.privateVar1;
    this.publicVar2 = otherColors.publicVar2;
    this.Init();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T21:40:02.013

您可以实现自己的克隆方法来制作对象的“副本”。发生这种情况的原因是因为分配`Colors objColors = Session["Colors"];`是参考分配，这是设计使然。您所做的只是对已存在的对象进行本地范围引用。查看[IClonable](http://msdn.microsoft.com/en-us/library/system.icloneable.aspx)以进行实际的对象克隆。这不是必需的，您可以实现自己的复制方法。您可能还想查看[MemberwiseClone](http://msdn.microsoft.com/en-us/library/system.object.memberwiseclone.aspx) ，具体取决于您的对象的深度。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T21:40:38.500

尝试复制构造函数。

示例：[链接](http://msdn.microsoft.com/en-us/library/ms173116(VS.80).aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:40:16.270

对象是通过引用而不是值来访问的。[见这里](http://csharptuning.blogspot.com/2007/09/c-copy-semantics.html)。有几种方法可以改变这一点。查看网站了解详细信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T21:44:11.347

其他答案都建议以一种或另一种方式进行克隆。另一种可能适合也可能不适合您的特定情况的替代方法是使您的类型不可变。之前改变您的类型的操作现在将返回该类型的新实例，从原始对象中获取数据并进行适当的更改，并使原始实例保持不变。例如，这是该`String`课程所采用的方法。

当然，您仍然必须编写适当的代码来复制实例中的数据 - 但使用该类型的代码*最终*可能会更简单。

这可能不适合您的情况，但它至少是一种需要考虑的技术。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T21:40:38.580

默认情况下没有内置和实现的方法，但您可以通过实现 ICloneable 并调用 MemberwiseClone 来获得它。这仅适用于浅拷贝——如果您的对象包含其他对象，您也需要克隆它们。一个简单的实现是：

```
public class Bla : ICloneable
{
    string _someFieldToClone;

    object ICloneable.Clone()
    {
        return this.Clone();
    }

    public Bla Clone()
    {
        return (Bla)MemberwiseClone();
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-10T21:40:40.093

这样做是因为您实际上并没有复制对象，而是复制了对该对象的引用。您可以使用二进制序列化轻松地在 C# 中进行深层复制：

```
 public static MemoryStream Serialize(object data)
    {

        MemoryStream streamMemory = new MemoryStream();
        BinaryFormatter formatter = new BinaryFormatter();
        formatter.AssemblyFormat = FormatterAssemblyStyle.Simple;

        formatter.Serialize(streamMemory, data);

        return streamMemory;

    }

   public static Object Deserialize(MemoryStream stream)
    {

        BinaryFormatter formatter = new BinaryFormatter();
        formatter.AssemblyFormat = FormatterAssemblyStyle.Simple;
        return formatter.Deserialize(stream);

    } 
```

您可以调用这两个方法，第一个获取一个对象并将其数据写入 MemoryStream。然后，您可以调用 Deserialize 以获取基于该数据的对象的新副本。

您的对象需要可序列化的最后一件事是通过将 Serializable 属性放在每个对象上来做到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T21:40:57.703

这是因为 objColors 和 Session["Colors"] 对象是同一个对象。如果要存储副本并保留原件，则需要使对象可克隆。

有关正确方向的指针，请参阅以下 SO Q&A：

[深度克隆对象](https://stackoverflow.com/questions/78536/cloning-objects-in-c)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-10T21:53:22.060

由于 Colors 类是您创建的，并且我假设您对面向对象编程相当陌生，因此您可以像 Stuart 所说的那样创建一个复制构造器，其内容类似于以下内容：

```
public class Colors
{
  public int Property1;
  public int Property2;
  public int Property3;
  public Colors()
  {
    //Do your regular constructor here
  }
  public Colors(Colors colorToCopy)
  {
    this.Property1 = colorToCopy.Property1;
    this.Property2 = colorToCopy.Property2;
    this.Property3 = colorToCopy.Property3;
  }
} 
```

通过序列化克隆是一种更通用的解决方案，并确保深度复制（这意味着它会复制属性以及属性的属性），但更难理解 imo。使用此解决方案，如果属性不是原始数据类型，则除非您明确复制它们，否则它们不会是副本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-11-10T13:23:10.183

当您有一个变量并为其分配一个会话值时，您将获得一个指向它们的指针。

```
Colors objColors = (Colors)Session["Colors"]; 
```

Session["Colors"] 和 objColors 指向内存中的同一个对象，然后当您对其中一个对象进行更改时，更改会同时反映在两者中。

如果您想要独立，则需要获取您对象的*深层副本*。您必须为 Invoice 及其所有相关类实现 IClonable 接口：

```
public class Colors: IClonable
{
  public int Red;
  public int Green;
  public int Blue;

  public object Clone()
  {
    return this.MemberwiseClone();
  }
} 
```

现在您拥有发票对象的真实深层副本。

```
Colors objColors = (Colors)((Colors)Session["Colors"]).Clone(); 
```

更多信息请参见：使用[IClonable](https://msdn.microsoft.com/en-us/library/system.icloneable.aspx "可克隆")和[MemberwiseClone](https://msdn.microsoft.com/en-us/library/system.object.memberwiseclone.aspx "会员克隆")进行对象克隆，具体取决于对象的深度。

# excel - 如何最好地在 Access 或 Excel 中使用 VBA 来测试 ODBC 连接？

> ID：632385
> 
> 赞同：2
> 
> 时间：2009-03-10T21:37:59.163
> 
> 标签：excel, ms-access, vba, odbc

给定一个预配置的 ODBC 系统 DSN，我想编写一个函数，使用 VBA 优雅地**测试**该连接。

```
Private Function TestConnection(ByVal dsnName As String) As Boolean

    ' What goes here?? '

End Function 
```

编辑：为了澄清，系统 DSN 指向外部 SQL Server 2005 数据库，具有 Windows NT 身份验证。

我尝试过的一种方法是向目标数据库发送一些随机查询并捕获错误。如果查询有效，则返回 true。如果有错误，则返回 false。这工作得很好，但感觉......笨拙。有没有更优雅的方式，尤其是不依赖*On Error Goto*的方式？

注意：这是我正在处理的旧版 Access 2000 数据库，因此任何解决方案都不能有任何 Access 2007 或 2003 依赖项。我想让它对 VBA 通用，但如果 Access 中有一种简单的方法也可以。

非常感谢任何建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T21:56:33.783

```
 Dim cnn As ADODB.Connection
Dim canConnect as Boolean
Set cnn = New ADODB.Connection

cnn.Open "DSN HERE"
If cnn.State = adStateOpen Then
    canConnect = True
    cnn.Close
End If

Msgbox canConnect 

```

编辑：DSN 格式可以是“DSN=MyDSN;UID=myuser;PWD=myPwd;”
查找[连接](http://www.connectionstrings.com/dsn)字符串

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-24T11:20:18.830

我来不及给你一个有用的答案来回答你的问题，但我来*这里*是因为我想看看 StaCkOverflow 是否比我目前用来测试 ADODB 连接的代码有更好的答案。

...事实证明答案是“否”，所以我将发布代码以供参考：其他人会发现它很有用。

编码说明：这不是一个通用的答案：它是一个封装 ADODB.Connection 对象的类的方法，它假定对象“m_objConnect”的存在。

**TestConnection：用于发布 ADODB.Connection 对象的调试信息的 VBA 类方法**

这将打印出连接字符串、当前状态、ADODB 错误列表（如果有）以及连接的命名属性的完整列表。

```
公共子 TestConnection()
出错时转到 ErrTest

将 i 调暗为整数

如果 m_objConnect 什么都没有，那么

```
Debug.Print "Object 'm_objConnect' not instantiated." 
```

别的

```
Debug.Print m_objConnect.ConnectionString
Debug.Print "Connection state = " & ObjectStateString(m_objConnect.State)

Debug.Print

If m_objConnect.Errors.Count > 0 Then
    Debug.Print "ADODB ERRORS (" & m_objConnect.Errors.Count & "):"
    For i = 0 To m_objConnect.Errors.Count
        With m_objConnect.Errors(i)
            Debug.Print vbTab & i & ":"  _ 
                      & vbTab & .Source & " Error " & .Number & ": " _ 
                      & vbTab & .Description & " " _ 
                      & vbTab & "(SQL state = " & .SqlState & ")"
        End With
    Next i
End If

Debug.Print

Debug.Print "CONNECTION PROPERTIES (" & m_objConnect.Properties.Count & "):"
For i = 0 To m_objConnect.Properties.Count - 1
    Debug.Print vbTab & i & ":" _ 
              & vbTab & m_objConnect.Properties(i).Name & " = " _ 
              & vbTab & m_objConnect.Properties(i).Value
Next i 
```

万一

退出测试：
    退出子
错误测试：
    Debug.Print "Error " & Err.Number & " 引发的 " & Err.Source & ": " & Err.Description
    继续下一步

结束子

私有函数 ObjectStateString(ObjectState As ADODB.ObjectStateEnum) As String

选择案例对象状态
案例 ADODB.ObjectStateEnum.adStateClosed
    ObjectStateString = "关闭"
案例 ADODB.ObjectStateEnum.adStateConnecting
    ObjectStateString = "正在连接"
案例 ADODB.ObjectStateEnum.adStateExecuting
    ObjectStateString = "正在执行"
案例 ADODB.ObjectStateEnum.adStateFetching
    ObjectStateString = "正在获取"
案例 ADODB.ObjectStateEnum.adStateOpen
    ObjectStateString = "打开"
其他情况
    ObjectStateString = "State" & CLng(ObjectState) & ": 未知状态号"
结束选择

结束功能

分享和享受：并注意换行符，这些换行符会被您的浏览器（或 StackOverflow 的格式化函数）有效地插入到它们会破坏代码的位置。

            回答 #3

赞同：0

时间：2009-03-10T21:54:26.563

在没有实际连接和尝试操作的情况下，没有任何神奇的功能可以对此进行测试。

如果您对随机查询部分感觉不好 - 您可以查询系统表

访问

```
SELECT TOP 1 NAME FROM MSysObjects 
```

对于 SQL 服务器

```
SELECT TOP 1 NAME FROM sysobjects 
```

            回答 #4

赞同：0

时间：2014-12-02T08:58:01.003

如果您只需要测试数据库服务器是否实际可用，则可以这样做，尽管这里说它不能。

在这种情况下，您可以尝试打开到特定服务器和端口的 TCP 连接。例如，SQL Server 的默认实例侦听 TCP 端口 1433。在 VBA 中尝试简单的 TCP 连接将告诉您它是否成功。只有在成功的情况下，我才会使用 ODBC 连接进行查询。

这更加优雅和高效。它会从您的 ODBC 测试代码中删除任何“严重”错误。但是，正如我所说，仅当您需要测试数据库服务器实例的存在/可用性时才适用。

        .net - .NET 的状态机框架

ID：632391

赞同：24

时间：2009-03-10T21:40:15.257

标签：.net, design-patterns, frameworks, state-machine

在我的工作中，我们有一个系统，它基本上是一个消息驱动的状态机。它接收各种类型的消息，根据消息查找一些上下文/状态，然后根据消息和当前状态决定要做什么。通常，结果是一条消息被发送出系统。

有没有什么好的开源框架可以在 .NET 中实现状态机？我查看了最新版本的 Windows Workflow，它似乎是一个不错的选择；但是，我对默认的持久性机制（我们需要报告状态转换数据）、可测试性以及 WF 团队在我们所说的（假设）重新构建框架这一事实有些担忧。

而不是WF，我正在考虑尝试实现一个普通的GoF“状态”模式，并使用Spring.NET将所有东西连接在一起。有没有什么东西已经这样做了，或者类似的东西？

            回答 #1

赞同：14

时间：2009-03-10T22:03:33.720

根据您的具体要求，您可能会发现[状态机编译器](http://smc.sourceforge.net/)足以实现 GoF“状态”模式。它可以生成 C# 以及可以使用[Graphviz](http://www.graphviz.org/)转换为多种图像格式的点。我在以前的项目中使用过它，发现它足以生成“简单”状态机。我希望这有帮助。

            回答 #2

赞同：8

时间：2015-06-20T06:41:52.290

.NET 的两个很棒的状态机

*   [无状态](https://github.com/nblumhardt/stateless)- 直接在 .NET 代码中创建状态机和基于轻量级状态机的工作流
*   [Automatonymous](https://github.com/MassTransit/Automatonymous) - .Net 的状态机库 - 允许您编写流畅的状态机

            回答 #3

赞同：4

时间：2013-03-30T13:01:52.257

看看 NState

[https://github.com/benaston/NState](https://github.com/benaston/NState)

[https://nuget.org/packages/NState/](https://nuget.org/packages/NState/)。

免责声明：我维护它。

            回答 #4

赞同：1

时间：2009-12-07T20:42:05.703

我维护了一个开源项目，它实现了（除其他外）.NET 的通用有限状态机。它建立在[QuickGraph](http://quickgraph.codeplex.com)之上，因此您可以免费获得许多图形分析算法。请参阅[此页面](http://jolt.codeplex.com/wikipage?title=Jolt.Automata&referringTitle=Documentation)了解更多信息。

            回答 #5

赞同：1

时间：2012-01-23T23:19:07.200

查看[StateBuilderDotNet](http://www.stateforge.com)，这是一个状态机代码生成器，可将状态机的 XML 描述转换为 C# 状态模式的扩展版本。它支持所有 UML 语义：状态机可以是分层的、并发的和异步的。图形工具也可用于创建状态机。

免责声明：我是这些软件的作者。

            回答 #6

赞同：1

时间：2012-01-31T01:48:49.537

您可以考虑[C# 中的 North State 框架](http://www.northstatesoftware.com/uml-state-machine-code-generation-framework.html)。虽然它不是开源的，但它的许可相对便宜。它是我所知道的唯一允许通过状态机组合和继承重用的框架。换句话说，您可以只用几行代码从基本状态机继承，并添加状态、转换、动作等。您还可以获取现有状态机类并将其“插入”另一个状态机。相对于 GOF 或其他模式，您不会相信使用这个框架来实现和使用状态机是多么容易。

            回答 #7

赞同：0

时间：2016-07-07T14:39:32.317

我创建了[Staty](https://bitbucket.org/apacha/staty)，它是.NET 的智能状态机。作为 C# 可移植类库 (PCL) 编写，Staty 是一个富有表现力的事件驱动状态机，具有以下功能

*   并发安全
*   外部和内部事件
*   每个州单独的班级
*   进入和退出动作和
*   用于配置状态机的流畅语法。

它是免费的、开源的，可在[NuGet](https://www.nuget.org/packages/Staty)上获得，并基于[David Lafreniere 的 C++ 状态机的](http://www.drdobbs.com/cpp/state-machine-design-in-c/184401236)想法，这是 C++ 中最著名的状态机。

        web-services - 如何从 ASMX Web 服务返回 HTTPResponse 到消费者网页

ID：632397

赞同：2

时间：2009-03-10T21:41:17.923

标签：web-services, download, httpresponse

我正在开发一个 ASMX Web 服务；试图创建一种方法，该方法将从服务器下载文档并在浏览器中显示该文档（调用 .aspx 网页）。我的服务构建没有错误，但是当我尝试在代理类项目中“添加 Web 引用”时出现以下错误：

**System.Web.HttpResponse 无法序列化，因为它没有无参数构造函数。** 

这是 .ASMX 文件中的代码片段：

```
public class FileService : System.Web.Services.WebService
{
    [WebMethod]
    public void DownloadDocument(string URI, HttpResponse httpResponse)
    {
        int DownloadChunkSize = (int)Properties.Settings.Default.DownloadChunkSize;
        // some more code here....
        using (httpResponse.OutputStream)
        {
            // more code here...
        }
    }
} 
```

我看到我对如何将 HttpResponse 从 Web 服务发送回请求网页感到困惑。有人可以给我一个关于如何做到这一点的提示吗？谢谢。

            回答 #1

赞同：4

时间：2009-03-10T22:43:21.020

您应该查看 Web 处理程序 (.ashx)。它们非常适合您想要实现的目标。

例如：

```
public class Download : IHttpHandler, IRequiresSessionState {

    public void ProcessRequest(HttpContext context) {
        var pdfBytes = /* load the file here */
        context.Response.ContentType = @"Application/pdf";
        context.Response.BinaryWrite(pdfBytes);
        context.Response.End();
    }
} 
```

**更新：** 
ashx 处理程序实际上是 aspx 的替代品。基本上，它没有 UI，但仍然像 aspx 页面一样处理获取/发布请求。关键是要减少运行常规 aspx 页面所产生的开销，因为您需要做的就是返回一些简单的内容（如文件...）或执行快速操作。  

IRequiresSessionState 接口允许您像站点中的任何其他页面一样使用 SESSION 对象。如果您不需要它，请不要使用它。

[这个网站](http://dotnetperls.com/Content/ASHX-Handler.aspx)有一个有趣的演练如何创建一个。忽略第 4 步，因为您可能不关心这一点。

假设您有一个常规页面 (aspx)，其中包含指向您的文档的链接： aspx 文件中的链接实际上将直接指向您的 ashx 处理程序。例如：

```
<a href="/document.ashx?id=blah">Click Here</a> 
```

然后，ashx 处理程序的 ProcessRequest 方法中的代码将执行所需的任何调用（例如与您的 DLL 对话）以定位文档，然后通过 context.Response.BinaryWrite 方法调用将其流式传输回浏览器。

            回答 #2

赞同：1

时间：2009-03-10T21:49:27.433

这不是标准 ASMX Web 服务的工作方式。如果您想创建自己的处理程序，或者甚至使用 ASPX 页面来传递文档，那么您很好，但是执行此操作的标准 ASMX Web 服务方法实际上是将文档的位作为编码的 blob 返回。

如果您想自己动手，请考虑这篇文章：http:
 [//msdn.microsoft.com/en-us/magazine/cc163879.aspx](http://msdn.microsoft.com/en-us/magazine/cc163879.aspx)

            回答 #3

赞同：0

时间：2009-03-10T21:54:40.900

web 方法（来自 asmx）返回一个可以序列化的对象。

您需要创建您的方法，如：

[WbeMethod] public byte[] 下载文档（字符串 URI）

或者如果内容是一些文本 - 返回字符串。

        c# - 为什么我不能通过 IList
到 F(IEnumerable
)?

ID：632399

赞同：1

时间：2009-03-10T21:41:52.553

标签：c#

我想我可以将 an`IList<ChildClass>`作为传递`IEnumerable<ParentClass>`，因为显然 ChildType 列表中的每个对象也是 ParentType 的一个实例。但我对编译器没有兴趣。我错过了什么？

编辑：添加了我想要的功能 Foo3 。谢谢！

```
namespace StackOverflow
{
    public class ParentClass
    {
    }

    public class ChildClass : ParentClass
    {
    }

    public class Test
    {
        // works
        static void Foo(ParentClass bar2)
        {
        }

        // fails
        static void Foo2(IEnumerable<ParentClass> bar)
        {
        }

        // EDIT: here's the right answer, obtained from the 
        // Charlie Calvert blog post 
        static void Foo3<T>(IEnumerable<T> bar) where T : ParentClass
        {
        }

        public static void Main()
        {
            var childClassList = new List<ChildClass>();

            // this works as expected
            foreach (var obj in childClassList)
                Foo(obj);

            // this won't compile
            // Argument '1': cannot convert from 
            // 'System.Collections.Generic.List<ChildClass>' 
            // to 'System.Collections.Generic.IEnumerable<ParentClass>' 
            Foo2(childClassList);

            // EDIT: this works and is what I wanted
            Foo3(childClassList);
        }
    }
} 
```

            回答 #1

赞同：5

时间：2009-03-10T21:45:06.960

因为泛型不是 co/contra 变体：

[Eric Lippert 的博客](http://blogs.msdn.com/ericlippert/archive/2007/10/16/covariance-and-contravariance-in-c-part-one.aspx)对此有一篇很棒的文章。

Charlie Calvert 的另一篇文章在[这里](http://blogs.msdn.com/charlie/archive/2008/10/28/linq-farm-covariance-and-contravariance-in-visual-studio-2010.aspx)。

            回答 #2

赞同：2

时间：2009-03-10T21:45:02.233

您缺少通用方差，目前 C# 中不存在该*方差*。我相信您的代码可以在 C# 4.0 中运行。

虽然这是其他问题的重复...

看：

*   [为什么不能`List<string>`存储在`List<object>`变量中](https://stackoverflow.com/questions/6557/in-c-why-cant-a-liststring-object-be-stored-in-a-listobject-variable)
*   [C# 4.0 Generic Covariance 和 Contra-Variance 是如何实现的](https://stackoverflow.com/questions/245607/how-does-c-4-0-generic-covariance-contra-variance-implmeneted)
*   [有没有办法将通用列表转换为接口/基类类型列表](https://stackoverflow.com/questions/188769/is-there-a-way-to-cast-generic-lists-to-lists-of-interface-base-class-types)
*   [C# .NET 将 InterfaceImplementingClass 对象的集合传递给采用 Interface 对象集合的例程](https://stackoverflow.com/questions/584319)
*   [铸造从`IEnumerable<Object>`到`IEnumerable<String>`](https://stackoverflow.com/questions/609608)

            回答 #3

赞同：1

时间：2009-03-10T21:45:51.390

[您应该在Eric Lippert 的 Covariance and Contravariance 系列](http://blogs.msdn.com/ericlippert/archive/tags/Covariance+and+Contravariance/default.aspx)中找到您要查找的所有内容。这是相当多的阅读，但回答了 (a) 为什么你不能在 C# 3.0 中做到这一点，以及 (b) 为什么你将能够在 C# 4.0 中做到这一点。

            回答 #4

赞同：0

时间：2009-03-10T21:46:09.893

恐怕没有对泛型参数类型的隐式转换（没有“泛型方差”似乎是技术术语）。不确定我能否给你更深入的解释，但我会接受它作为 CLR 的工作方式......

您只需使用childClassList 上的*Cast扩展方法将列表转换为 IEnumerable。*

            回答 #5

赞同：0

时间：2009-03-10T21:47:26.083

虽然在 IList 和 IEnumerable 的情况下一切正常，但当您将其视为集合和集合时，编译器无法真正知道这一点。

如果您可以将集合用作集合，则有人可以尝试将 Parent 添加到集合中……编译器必须阻止这种情况。

        asp.net - asp.net 元标签的 SEO

ID：632400

赞同：0

时间：2009-03-10T21:42:12.040

标签：asp.net, search-engine

只是想知道是否有任何 SEO 专家知道 Google 或其他搜索提供商是否会因为 asp.net 生成的 id 而对 meta 进行不同的索引

            回答 #1

赞同：1

时间：2009-03-10T21:45:35.243

通常不会，他们会忽略元标记并为所欲为。

正如[stevemegson 所](https://stackoverflow.com/users/25028/stevemegson)指出的，描述元标记对于提供您自己的描述以显示在 SERP 上很有用（不保证会使用它）。

[这是 Meta_Tag Wiki 页面上的](http://en.wikipedia.org/wiki/Meta_tag#The_description_attribute)一个很好的引用：

主要搜索引擎机器人更有可能量化诸如来自相关网站的传入链接量、内容的数量和质量、源代码的技术精度、拼写、功能性与损坏的超链接、搜索量和一致性和/或观众流量、网站停留时间、页面浏览量、重访次数、点击率、技术用户特征、唯一性、冗余度、相关性、广告收入、新鲜度、地理、语言和其他内在特征。

        user-interface - Web 或桌面应用程序中最有用的动画

ID：632404

赞同：3

时间：2009-03-10T21:43:43.580

标签：user-interface, animation, usability, effects

许多动画效果只是无缘无故的赏心悦目——然而，在某些情况下，动画可以有效地向用户传达正在发生的事情。你最喜欢动画的哪些用途，你会使用什么特定的动画类型？

例如：将新项目插入列表时向下动画项目

            回答 #1

赞同：2

时间：2009-03-10T21:53:26.537

来自[enjoy3d.com](http://enjoy3d.com/art)

[enjoy3d.com http://worldsware.com/images/mouse.gif](http://worldsware.com/images/mouse.gif)

按下鼠标按钮

并四处张望。

            回答 #2

赞同：2

时间：2009-03-10T22:16:19.897

我能想到的一个例子是操作系统在最小化窗口时使用的动画。

Microsoft Windows 和 Apple OS X 都为向下移动到任务栏（或 OS X 中的 Dock）的窗口设置动画，以向用户显示窗口所在的位置。否则，意外点击最小化的新手用户可能无法恢复窗口。

我不使用linux，但我很确定它也是如此。我没有歧视=）

            回答 #3

赞同：2

时间：2009-03-10T22:19:29.720

我真的很喜欢谷歌浏览器在下载文件时的使用。很难描述，但是，随着下载的进行，它是一个像饼图一样填充的圆圈，并且该圆圈与您正在下载的文件的图标重叠。非常光滑。

            回答 #4

赞同：1

时间：2009-04-02T15:37:25.150

我相信所有的视觉变化都不应该很快。无论是状态通知、窗口最大化/最小化，还是数据删除/添加。我找不到参考，但通常建议所有动画不应在 1-2 秒左右，与人类的响应时间相匹配。

我最喜欢的动画用途不是在商业软件中（尽管 Apple 很擅长），而是在一篇名为[Phosphor](http://vis.berkeley.edu/papers/phosphor/)的研究论文中，我认为这是尚未在主要操作系统中实现的伟大 UI 创意之一。

            回答 #5

赞同：1

时间：2009-04-02T15:40:34.787

[**AJAX 加载 gifs**](http://www.ajaxload.info/) - 你必须有一个指标，表明你确实注册了一个事件并且你正在做一些事情

            回答 #6

赞同：1

时间：2009-06-16T10:28:29.843

Ben Bederson 和 Angela Boltman 有一篇非常好的论文，他们在其中评估了动画对用户构建空间信息思维导图能力的影响：动画
[是否帮助用户构建空间信息思维导图？](http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=C9F5FE8D978E8EB2134BB4B799895152?doi=10.1.1.63.4244&rep=rep1&type=url&i=0)

            回答 #7

赞同：0

时间：2009-03-10T22:42:54.687

进度条适用于需要一两分钟以上的事情，但前提是它们是准确的。在我看来，一个不准确的进度条比没有更糟糕。

        .net - .NET Remoting 服务器端挂起

ID：632417

赞同：4

时间：2009-03-10T21:46:30.763

标签：.net, remoting

我们有一个位于 Web 应用程序和数据库之间的 .net 远程处理应用程序。偶尔我们会遇到奇怪的问题。远程调用只是挂起并且永远不会返回。我们使用包嗅探器来检查流量。这似乎是服务器端的问题。如果我们停止服务器应用程序，将立即抛出网络异常。但是，当我们调试服务器代码时，它不会命中任何代码。似乎该请求在远程堆栈内的某处被阻止。有没有人有类似的经历？

            回答 #1

赞同：1

时间：2009-05-12T15:01:56.363

事实证明，我们使用的 CMS 系统也使用 .NET Remoting，它会覆盖我们的安全设置。我们关闭了远程应用程序上的安全设置，现在一切正常。

            回答 #2

赞同：1

时间：2009-03-11T00:00:40.567

不久前，我在使用 IPC 的 .Net 远程处理中确实遇到了类似的问题。我不记得所有的细节，所以请原谅我。我发现的问题是我的客户端应用程序正在对服务器应用程序进行远程调用，这需要很长时间（几分钟）才能完成。在将客户端和服务器都连接到调试器并捕获所有抛出的异常之后，我发现远程调用实际上最终抛出了某种超时异常（我的记忆想说内部消息与 COM 相关），因为没有活动在超时期间通过 IPC 通道发生。显然，当这些远程连接超时时，双方的链接本质上是死人行走。奇怪的是，我只能通过调试器看到这个异常——在发布模式下，我的申请就像你的一样挂了，没有任何说明为什么。我找到了远程超时设置，然后简单地关闭了超时（或者让它变得非常大，我也记不清了），这就解决了问题。

        port - VHDL端口映射问题

ID：632422

赞同：4

时间：2009-03-10T21:47:27.767

标签：port, vhdl, circuit

我对 VHDL 比较陌生。我正在尝试编写代码来使用全加器的组合进行无符号乘法。编译时将其传递给端口映射。我已经解决了第一张地图中的错误，但所有其他地图都给我带来了问题。

我得到相同的错误：“端口映射方面的表达式实际值必须是静态的”

这是我的代码。任何帮助表示赞赏。此外，如果您有基于查看我的代码的一般提示，我将不胜感激。

谢谢，布兹基

```
library  ieee;
use  ieee.std_logic_1164.all;

entity fulladder is

     port (a, b, c: in std_logic;
           sout, cout: out std_logic);

     end fulladder;

architecture behav of fulladder is
begin

sout <= (a xor b) xor c ;
cout <= (a and b) or (c and (a xor b));

     end behav;

library ieee;
use ieee.std_logic_1164.all;

entity unsignedmult is 
port (a,b: in     std_logic_vector (3 downto 0);
       pro: out std_logic_vector (7 downto 0)); 

end unsignedmult;     

architecture synth of unsignedmult is

    --Declarations
    signal c1,c2,c3,c4,c5: std_logic_vector (3 downto 0);
    signal s1,s2,s3,s4: std_logic_vector (2 downto 0);
    component fulladder
        port (a,b,c:in std_logic;
           sout,cout:out std_logic);
    end component;

begin  

    --Row 0                    ----Sin-----A&B-------Cin--Sout---Cout
    Fand00: fulladder port map('0',(a(0) and b(0)),'0',pro(0),c1(0));   
    Fand01: fulladder port map('0',(a(1) and b(0)),'0',s1(0),c1(1));
    Fand02: fulladder port map('0',(a(2) and b(0)),'0',s1(1),c1(2));
    Fand03: fulladder port map('0',(a(3) and b(0)),'0',s1(2),c1(3));

    --Row 1
    Fand10: fulladder port map(s1(0),(a(0) and b(1)),c1(0),pro(1),c2(0));
    Fand11: fulladder port map(s1(1),(a(1) and b(1)),c1(1),s2(0),c2(1));
    Fand12: fulladder port map(s1(2),(a(2) and b(1)),c1(2),s2(1),c2(2));
    Fand13: fulladder port map('0',(a(3) and b(1)),c1(3),s2(2),c2(3));

    --Row 2
    Fand20: fulladder
         ----Sin------A&B------Cin-Sout-Cout
       port map(s2(0),(a(0) and b(2)),c2(0),pro(2),c3(0));
    Fand21: fulladder
         ----Sin--A&B------Cin-Sout-Cout
       port map(s2(1),(a(1) and b(2)),c2(1),s3(0),c3(1));
    Fand22: fulladder
         ----Sin--A&B------Cin-Sout-Cout
       port map(s2(2),(a(2) and b(2)),c2(2),s3(1),c3(2));
    Fand23: fulladder
         ----Sin--A&B------Cin-Sout-Cout
       port map('0',(a(3) and b(2)),c2(3),s3(2),c3(3));

    --Row 3
    Fand30: fulladder
         ----Sin------A&B------Cin-Sout-Cout
       port map(s3(0),(a(0) and b(3)),c3(0),pro(3),c4(0));
    Fand31: fulladder
         ----Sin--A&B------Cin-Sout-Cout
       port map(s3(1),(a(1) and b(3)),c3(1),s4(0),c4(1));
    Fand32: fulladder
         ----Sin--A&B------Cin-Sout-Cout
       port map(s3(2),(a(2) and b(3)),c3(2),s4(1),c4(2));
    Fand33: fulladder
         ----Sin--A&B------Cin-Sout-Cout
       port map('0',(a(3) and b(3)),c3(3),s4(2),c4(3));

    --Row 4
    F40: fulladder
       port map(s4(0),c4(0),'0',pro(4),c5(0));
    F41: fulladder
       port map(s4(1),c4(1),c5(0),pro(5),c5(1));
    F42: fulladder
       port map(s4(2),c4(2),c5(1),pro(6),c5(2));
    F43: fulladder
       port map('0',c4(3),c5(2),pro(7),c5(3));

end synth; 
```

            回答 #1

赞同：4

时间：2009-03-10T22:44:39.800

我生疏了，但你可能需要明确的`a(_) and b(_)`条目和门。我听说过线或，但不是线与（至少在正逻辑中）。

至少，尝试只用`a(_)`部分替换其中的每一个，看看错误是否消失。它不会是正确的电路，但它会确认我是否正确了解导致编译问题的原因。

            回答 #2

赞同：2

时间：2009-03-10T23:07:42.833

如果我没记错的话，您不能将逻辑表达式（例如 a(0) 和 b(0)）映射到端口（但我认为常量是可以的）。如果这是正确的，您必须为所有输入和输出创建显式信号。

另外： 1) 我不认为 fulladder 架构是行为的，所以我将其命名为别的。我已经（正确与否）为这些架构使用了名称 rtl。

2）应该可以在不声明组件的情况下实例化全加法器。使用类似的语法

```
Fand00: entity fulladder port map(...) 
```

我还发现通常总是指定正式的端口名称（cout => c1(0)，对箭头方向等有所保留）

3）我想你知道任何最近新的合成器都能够合成一个乘法，你这样做只是为了了解它是如何工作的，否则我只是告诉你:)

            回答 #3

赞同：0

时间：2009-05-05T09:29:46.310

一些合成器在端口映射不是静态表达式方面存在问题。

无论合成器抱怨什么，您可能都必须用信号替换端口映射中的表达式。例如：

`Fand00: fulladder port map('0',(a(0) and b(0)),'0',pro(0),c1(0));`

和：

`signal t: std_logic;`

`...`

`t <= a(0) and b(0);`

`...`

`Fand00: fulladder port map('0',t,'0',pro(0),c1(0));`

如果可能，请更改为不同的合成器软件。不要折磨自己。

        c# - 日期时间和货币全球化

ID：632423

赞同：1

时间：2009-03-10T21:47:44.380

标签：c#, asp.net

我正在为英国客户转换一个应用程序以部署在他们的服务器上。我正在尝试找出对应用程序进行尽可能少更改但仍将 DateTime 和货币值转换为英国格式的最佳方法？

有任何想法吗？我正在寻找快速轻便的东西？

            回答 #1

赞同：4

时间：2009-03-10T21:48:36.220

我会用**[DateTime.ParseExact替换所有日期引用，用](http://msdn.microsoft.com/en-us/library/w2sa9yss.aspx)****[moneyDouble.ToString("c")](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx)**替换Currency 引用。

```
//I would use ParseExact over Parse when dealing with global date conversions
DateTime dt = DateTime.ParseExact(date, format, CultureInfo.InvariantCulture);

Double money = 100.00;
money.ToString("c"); 
```

显然有更优雅的解决方案，但如果您正在寻找快速且低影响的东西......  

[如果需要，关于System.Globalization](http://msdn.microsoft.com/en-us/library/system.globalization.aspx)的额外阅读应该会给你一些额外的信息。

            回答 #2

赞同：1

时间：2009-03-10T21:51:02.127

确保您的应用程序设置了正确的文化。再加上 BTHB 提出的建议，您在这里几乎步入正轨。

如果你想研究，MSDN 有一些关于全球化/本地化的好文章。更多地关注本地化部分。

        user-interface - 使用渐变/图案来提高可用性？

ID：632424

赞同：2

时间：2009-03-10T21:47:55.630

标签：user-interface, usability

渐变和图案为应用程序提供了一定的视觉“深度”，但除此之外，它们是否会产生任何明显的可用性改进？

            回答 #1

赞同：2

时间：2009-03-10T22:32:54.133

我不这么认为。这是视觉上的美好，仅此而已。

从我多年的编程经验中，我发现大多数可用性改进都围绕着为用户提供他们想要的功能。键盘快捷键、简单直观的应用程序导航、高效（最少的击键）数据输入和丰富的报告功能似乎在大多数用户的列表中都很重要，以提高可用性。

        algorithm - 检查关系传递性的算法？

ID：632429

赞同：1

时间：2009-03-10T21:48:59.993

标签：algorithm, discrete-mathematics

我需要检查关系是否传递？

您能否建议一些算法来检查关系的传递性？

我将关系存储为**布尔矩阵**，如果元素相关，则为**1 ，否则为****0**，如图形中。

谢谢。

            回答 #1

赞同：3

时间：2009-03-10T23:45:11.930

比我的 Map/Set 版本（已删除）更简单的算法，现在使用布尔矩阵。也许这更容易理解，即使您不了解 Java？

```
public class Trans
{

  final static int SIZE = 4;

  static boolean isTransitive(boolean[][] function)
  {
    for (int i = 0; i < SIZE; i++)
    {
      for (int j = 0; j < SIZE; j++)
      {
        if (function[i][j])
        {
          for (int k = 0; k < SIZE; k++)
          {
            if (function[j][k] && !function[i][k])
            {
              return false;
            }
          }
        }
      }
    }
    return true;
  }

  public static void main(String[] args)
  {
    boolean[][] function = new boolean[SIZE][SIZE];
    for (int i = 0; i < SIZE; i++)
    {
      function[i] = new boolean[SIZE];
    }
    function[0][1] = true;
    function[1][2] = true;
    function[0][2] = true;
    function[0][3] = true;
    function[1][3] = true;   
    System.out.println(isTransitive(function));
  }
} 
```

            回答 #2

赞同：1

时间：2009-03-10T21:58:43.247

尽管这听起来完全像家庭作业......

您需要存储您的关系，以便您可以通过先行词快速查找它们。然后你可以发现 A->B->C 类型的传递关系，将它们添加到同一个存储中，然后继续查找 A->B->C->D 等...

            回答 #3

赞同：1

时间：2009-03-10T22:00:32.870

拓扑排序可能是正确的方向。如果其有向图表示中没有循环，则该关系是可传递的。如果你关心速度，图算法可能是要走的路。

        apache - 模组重写问题

ID：632432

赞同：0

时间：2009-03-10T21:49:41.053

标签：apache, mod-rewrite

我有一个无法解决的问题。

我正在使用 Apache 和 PHP

我需要得到：

[http://localhost.com/cat_ap.php?nid=5964](http://localhost.com/cat_ap.php?nid=5964)

从

[http://localhost.com/cat_ap~nid~5964.htm](http://localhost.com/cat_ap~nid~5964.htm)

我该如何改变呢？我做了更简单的 mod 重写，但这稍微复杂一些。谁能给我一条腿或指出我正确的方向

            回答 #1

赞同：4

时间：2009-03-10T21:54:14.927

```
RewriteRule ^/cat_ap~nid~(.*)\.htm$ /cat_ap?nid=$1 [R] 
```

最后`[R]`的是可选的。如果您省略它，Apache 将不会重定向您的用户（它仍然会提供正确的页面）。

如果`nid`零件也是一个变量，你可以试试这个：

```
RewriteRule ^/cat_ap~([^~]+)~(.*)\.htm$ /cat_ap?$1=$2 [R] 
```

**编辑：**正如 Ben Blank 在他的评论中所说，您可能想要限制有效 URL 的集合。例如，您可能想确保一个 nid 存在，并且它是数字的：

```
RewriteRule ^/cat_ap~nid~([0-9]+)\.htm$ /cat_ap?nid=$1 
```

或者如果 nid 部分是一个变量，它只包含字母字符：

```
RewriteRule ^/cat_ap~([A-Za-z]+)~([0-9]+)\.htm$ /cat_ap?$1=$2 
```

            回答 #2

赞同：1

时间：2009-03-10T21:57:24.793

假设这里的可变部分是“nid”和 5964，你可以这样做：

```
RewriteRule ^/cat_ap~(.+)~(.+).htm$ ^/cat_ap?$1=$2 
```

第一个“(.+)”匹配“nid”，第二个匹配“5964”。

            回答 #3

赞同：0

时间：2009-03-10T22:36:02.830

如果你想要一切都是任意的：

```
RewriteRule ^/(\w+)~(\w+)~(\w+)\.htm$ $1?$2=$3 [L] 
```

哪里`\w`等于`[A-Za-z0-9_]`。如果您想在 .htaccess 文件中使用此规则，请`/`从模式中删除前导。

        c# - LINQ to SQL Where 子句可选条件

ID：632434

赞同：72

时间：2009-03-10T21:50:08.820

标签：c#, asp.net, linq, linq-to-sql

我正在使用 LINQ to SQL 查询，遇到了一个问题，我有 4 个可选字段来过滤数据结果。通过可选，我的意思是可以选择输入或不输入值。具体来说，一些可能有一个值或有一个空字符串的文本框和一些可能有一个值被选择或可能没有的下拉列表......

例如：

```
 using (TagsModelDataContext db = new TagsModelDataContext())
     {
        var query = from tags in db.TagsHeaders
                    where tags.CST.Equals(this.SelectedCust.CustCode.ToUpper()) 
                    && Utility.GetDate(DateTime.Parse(this.txtOrderDateFrom.Text)) <= tags.ORDDTE
                    && Utility.GetDate(DateTime.Parse(this.txtOrderDateTo.Text)) >= tags.ORDDTE
                    select tags;
        this.Results = query.ToADOTable(rec => new object[] { query });
    } 
```

现在我需要添加以下字段/过滤器，但前提是它们由用户提供。

1.  产品编号 - 来自另一个可以连接到 TagsHeaders 的表。
2.  PO 编号 - TagsHeaders 表中的一个字段。
3.  订单号 - 类似于 PO #，只是不同的列。
4.  产品状态 - 如果用户从下拉列表中选择此项，则需要在此处应用所选值。

我已经有的查询很好用，但是要完成功能，需要能够在 where 子句中添加这 4 个其他项目，只是不知道如何！

            回答 #1

赞同：124

时间：2009-03-10T22:14:30.073

您可以对原始查询进行编码：

```
var query = from tags in db.TagsHeaders
                where tags.CST.Equals(this.SelectedCust.CustCode.ToUpper()) 
                && Utility.GetDate(DateTime.Parse(this.txtOrderDateFrom.Text)) <= tags.ORDDTE
                && Utility.GetDate(DateTime.Parse(this.txtOrderDateTo.Text)) >= tags.ORDDTE
                select tags; 
```

然后根据一个条件，添加额外的 where 约束。

```
if(condition)
    query = query.Where(i => i.PONumber == "ABC"); 
```

我不确定如何使用查询语法对此进行编码，但 id 确实适用于 lambda。也适用于初始查询的查询语法和二级过滤器的 lambda。

您还可以包含我不久前编写的扩展方法（如下），以包含条件 where 语句。（不适用于查询语法）：

```
 var query = db.TagsHeaders
            .Where(tags => tags.CST.Equals(this.SelectedCust.CustCode.ToUpper()))
            .Where(tags => Utility.GetDate(DateTime.Parse(this.txtOrderDateFrom.Text)) <= tags.ORDDTE)
            .Where(tags => Utility.GetDate(DateTime.Parse(this.txtOrderDateTo.Text)) >= tags.ORDDTE)
            .WhereIf(condition1, tags => tags.PONumber == "ABC")
            .WhereIf(condition2, tags => tags.XYZ > 123); 
```

扩展方法：

```
public static IQueryable<TSource> WhereIf<TSource>(
    this IQueryable<TSource> source, bool condition,
    Expression<Func<TSource, bool>> predicate)
{
    if (condition)
        return source.Where(predicate);
    else
        return source;
} 
```

这是 IEnumerables 的相同扩展方法：

```
public static IEnumerable<TSource> WhereIf<TSource>(
    this IEnumerable<TSource> source, bool condition,
    Func<TSource, bool> predicate)
{
    if (condition)
        return source.Where(predicate);
    else
        return source;
} 
```

            回答 #2

赞同：31

时间：2009-03-10T21:55:48.137

只需要使用条件检查参数的存在。例如：

```
where (string.IsNullOrEmpty(ProductNumber) || ProductNumber == tags.productNumber) 
```

这样，如果没有输入产品编号，该表达式将在所有情况下都返回 true，但如果输入了它，它只会在匹配时返回 true。

            回答 #3

赞同：0

时间：2009-03-10T21:57:48.180

您可以使用 || 进行 OR。

看看这个线程，因为它可能会给你一些很好的指示：
 [C# LINQ 等价于一个有点复杂的 SQL 查询](https://stackoverflow.com/questions/403505/c-linq-equivalent-of-a-somewhat-complex-sql-query)

        wpf - 在 WPF 中测量文本

ID：632445

赞同：22

时间：2009-03-10T21:54:32.133

标签：wpf, formatting

使用 WPF，测量大量短字符串的最有效方法是什么？具体来说，我想确定每个字符串的显示高度，给定统一的格式（相同的字体、大小、粗细等）以及字符串可能占据的最大宽度？

            回答 #1

赞同：14

时间：2009-03-11T00:29:35.100

最底层的技术（因此为创造性优化提供了最大的空间）是使用 GlyphRuns。

它没有很好的记录，但我在这里写了一个小例子：

[http://smellegantcode.wordpress.com/2008/07/03/glyphrun-and-so-forth/](http://smellegantcode.wordpress.com/2008/07/03/glyphrun-and-so-forth/)

该示例将字符串的长度作为渲染之前的必要步骤。

            回答 #2

赞同：7

时间：2012-11-30T11:43:20.460

***在 WPF 中：***

请记住在读取 DesiredSize 属性之前调用 TextBlock 上的 Measure()。

如果 TextBlock 是即时创建的，但尚未显示，则必须先调用 Measure()，如下所示：

```
MyTextBlock.Measure(new Size(Double.PositiveInfinity, Double.PositiveInfinity));

return new Size(MyTextBlock.DesiredSize.Width, MyTextBlock.DesiredSize.Height); 
```

***在 Silverlight 中：***

无需测量。

```
return new Size(TextBlock.ActualWidth, TextBlock.ActualHeight); 
```

完整的代码如下所示：

```
public Size MeasureString(string s) {

    if (string.IsNullOrEmpty(s)) {
        return new Size(0, 0);
    }

    var TextBlock = new TextBlock() {
        Text = s
    };

#if SILVERLIGHT
    return new Size(TextBlock.ActualWidth, TextBlock.ActualHeight);
#else
    TextBlock.Measure(new Size(Double.PositiveInfinity, Double.PositiveInfinity));

    return new Size(TextBlock.DesiredSize.Width, TextBlock.DesiredSize.Height);
#endif
} 
```

            回答 #3

赞同：6

时间：2012-03-03T06:38:04.237

它非常简单，由 FormattedText 类完成！尝试一下。

            回答 #4

赞同：3

时间：2009-03-11T00:26:43.983

您可以在呈现的 TextBox 上使用 DesiredSize 属性来获取高度和宽度

```
using System.Windows.Threading;

...

Double TextWidth = 0;
Double TextHeight = 0;
...

MyTextBox.Text = "Words to measure size of";
this.Dispatcher.BeginInvoke(
    DispatcherPriority.Background,
    new DispatcherOperationCallback(delegate(Object state) {
        var size = MyTextBox.DesiredSize;
        this.TextWidth = size.Width;
        this.TextHeight = size.Height;
        return null; 
    }
) , null); 
```

如果您有大量字符串，则首先预先计算给定字体中每个单个字母和符号的高度和宽度可能会更快，然后根据字符串字符进行计算。由于字距调整等原因，这可能不是 100% 准确的

        wpf - FlowDocument 中的波浪下划线

ID：632450

赞同：15

时间：2009-03-10T21:56:49.570

标签：wpf, flowdocument, underline

在 WPF 中，是否有一种简单的方法可以向`FlowDocument`元素添加波浪下划线（如 Word 中的拼写错误）？有`Underline`类，但似乎没有办法设置它的样式。

            回答 #1

赞同：30

时间：2009-03-11T07:58:36.863

您可以使用 Robert Macne 解决方案的以下更改来创建波浪效果

向 Grid.Resources 部分添加一个可视画笔：

```
<VisualBrush x:Key="WavyBrush" Viewbox="0,0,3,2" ViewboxUnits="Absolute" Viewport="0,0.8,6,4" ViewportUnits="Absolute" TileMode="Tile">
    <VisualBrush.Visual>
        <Path Data="M 0,1 C 1,0 2,2 3,1" Stroke="Red" StrokeThickness="0.2" StrokeEndLineCap="Square" StrokeStartLineCap="Square" />
    </VisualBrush.Visual>
</VisualBrush> 
```

并将笔更改为：

```
<Pen Brush="{StaticResource WavyBrush}" Thickness="6" /> 
```

            回答 #2

赞同：6

时间：2009-03-10T22:10:30.473

红色下划线很简单：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid.Resources>
        <FlowDocument x:Key="doc">
            <Paragraph>
                <Run Text="This text is underlined in red.">
                    <Run.TextDecorations>
                        <TextDecoration Location="Underline">
                            <TextDecoration.Pen>
                                <Pen Brush="Red" Thickness="1" DashStyle="{x:Static DashStyles.Dot}"/>
                            </TextDecoration.Pen>
                        </TextDecoration>
                    </Run.TextDecorations>
                </Run>
            </Paragraph>
        </FlowDocument>
    </Grid.Resources>
    <FlowDocumentReader Document="{StaticResource doc}"/>
</Grid> 
```

**波浪形**的红色下划线会涉及更多，但我认为您可以创建一个带有波浪形红色东西的 VisualBrush，并将其设置为您为下划线 TextDecoration 指定的笔刷。  *编辑：请参阅**bstoney**的帖子。*

            回答 #3

赞同：5

时间：2015-12-04T15:33:29.440

这是@bstoney 在代码中实现的解决方案。

```
Pen path_pen = new Pen(new SolidColorBrush(Colors.Red), 0.2);
path_pen.EndLineCap = PenLineCap.Square;
path_pen.StartLineCap = PenLineCap.Square;

Point path_start = new Point(0, 1);
BezierSegment path_segment = new BezierSegment(new Point(1, 0), new Point(2, 2), new Point(3, 1), true);
PathFigure path_figure = new PathFigure(path_start, new PathSegment[] { path_segment }, false);
PathGeometry path_geometry = new PathGeometry(new PathFigure[] { path_figure });

DrawingBrush squiggly_brush = new DrawingBrush();
squiggly_brush.Viewport = new Rect(0, 0, 6, 4);
squiggly_brush.ViewportUnits = BrushMappingMode.Absolute;
squiggly_brush.TileMode = TileMode.Tile;
squiggly_brush.Drawing = new GeometryDrawing(null, path_pen, path_geometry);

TextDecoration squiggly = new TextDecoration();
squiggly.Pen = new Pen(squiggly_brush, 6);
text_box.TextDecorations.Add(squiggly); 
```

            回答 #4

赞同：1

时间：2014-06-13T06:48:21.803

我知道这是一个老问题，但我更喜欢这个刷子。它有点棱角，但很干净。

```
 <VisualBrush x:Key="WavyBrush">
        <VisualBrush.Visual>
            <Path Data="M 0,2 L 2,0 4,2 6,0 8,2 10,0 12,2" Stroke="Red"/>
        </VisualBrush.Visual>
    </VisualBrush> 
```

            回答 #5

赞同：0

时间：2022-01-12T10:33:17.303

另一种方法可以是：创建一个带有两条线的绘图组（有点倒 V），并将该绘图组作为绘图刷的内容传递，并将 Tile 作为模式，以便它可以重复。但是，当我们画两条线时，这里会指出峰，一条从另一条开始。
示例将如下所示：
[![在此处输入图像描述](https://i.stack.imgur.com/0GerO.png)](https://i.stack.imgur.com/0GerO.png)

```
 // Configuring brush.
        DrawingGroup dg = new DrawingGroup();
        using (DrawingContext dc = dg.Open())
        {
            Pen pen = new Pen(Brushes.Red, 1);
            dc.DrawLine(pen, new System.Windows.Point(0.0, 0.0), new System.Windows.Point(3.0, 3.0));
            dc.DrawLine(pen, new System.Windows.Point(3.0, 3.0), new System.Windows.Point(5.0, 0.0));
        }
        public DrawingBrush brush = new DrawingBrush(dg);
        brush.TileMode = TileMode.Tile;
        brush.Viewport = new Rect(0, 0, 4, 4);
        brush.ViewportUnits = BrushMappingMode.Absolute;

        // Drawing line on VisualCollection
        private VisualCollection visualCollection = new VisualCollection(this);
        DrawingVisual dv = new DrawingVisual();
        using (DrawingContext drawingContext = dv.RenderOpen())
        {
            drawingContext.DrawLine(new Pen(brush, 2), new Point(50, 100), new Point(200, 100));
            base.OnRender(drawingContext);
        }
        this.visualCollection.Add(dv); 
```

        msmq - 与 MSMQ“如何处理消息”相关的问题

ID：632459

赞同：1

时间：2009-03-10T22:02:02.583

标签：msmq

我使用 MSMQ 作为提供异步 SOA 的一种方式。请参考下面的代码，因为它很难解释。我试图找出最好的方法来做到这一点。

```
//another method reads off MSMQ and passes the Message into this method
public void ReadMSMQAndAction(Message m)
{
  var e = m.Entity;

  /* this is really bad, but i some how still need some 
   * kind of traffic cop to direct action */
  switch typeof(m.Entity)
    case Order.GetType()
      switch e.Action
        case "SAVE"
          //todo OrderRepo Save
}

//Message gets searlized and put into MSMQ
public class Message<T>
{
  public T Entity { get;set; }

  /* should this be string?
   * or some kind of rule i.e. "ClassName:MethodName" etc? */
  public string Action { get;set; } 
}

public class OrderRepo
{
  public void Save(Order o) { /* todo */ }
  public void Delete(Order o) { /* todo */ }
  public void Update(Order o) { /* todo */ }
} 
```

随着代码变得越来越复杂，将很难管理。欢迎任何建议！

            回答 #1

赞同：1

时间：2009-03-11T08:27:56.683

研究使用代表。它们将允许您将实际的方法调用传递到 MSMQ，以便您可以在从队列中检索委托/操作时触发它。

            回答 #2

赞同：0

时间：2009-03-11T08:54:35.463

使用 WCF。Microsoft 已将其包装起来，以便服务（在 SOA 的意义上）呈现为方法调用，传输是 MSMQ。

契约必然是一种方式，而传输恰好是 MSMQ 的事实完全是服务及其客户端的附带条件（除非这种选择强制采用一种方式契约）。

另一方面，我觉得有必要评论一下：除非你能清楚简洁地表达意图和实施策略，否则你对你正在创造的东西没有一个清晰和完整的想法，你成功的机会充其量是渺茫的。

软件开发始于对管理人员和销售人员的模糊理解，并代表他们应用常识，循环反馈，直到一方失去兴趣，预算用完，或者你生产出项目发起人认为清晰简洁的东西他们想象他们在第一次兴奋的手臂挥动时所说的话。

如果你不能解释你在做什么，那么你就不*知道*你在做什么。是时候停下来思考了，直到你这样做。

        wpf - WPF 替代品

ID：632466

赞同：6

时间：2009-03-10T22:06:08.533

标签：wpf, user-interface

WPF 被定位为 WinForms 的继任者，但鉴于 Microsoft 放弃工具包的做法（以及我认为 WPF 中的“臃肿”），是否有任何推荐的替代方案？

            回答 #1

赞同：14

时间：2009-03-10T22:22:15.127

我认为您不必担心 WPF 被放弃。WinForm 已经存在了很长时间，而 WPF 是**替代**品。
膨胀？我不知道。对我来说，这似乎是 WinForms 的一次巨大升级。如果有膨胀，它总是会在那里，因为在所有东西的下面都是 Win32 API。在从头开始重写之前，我认为没有什么是完美的。由于每个针对 Windows 平台的工具包都必须处理这个问题，我宁愿选择 WPF 和 ReSharper。

            回答 #2

赞同：7

时间：2009-03-11T00:10:57.050

Microsoft 认真对待 WPF 的另一个迹象是，它已经习惯于制作 Visual Studio 2010。XAML 似乎不仅仅被 WPF（工作流基础、通信基础）所使用。

在过去的 5 年里，我一直在 WinForms 中进行编码，起初我也对 WPF 持怀疑态度。但是在阅读了几本书并尝试了我在 WPF 中的第一个应用程序之后，我开始看到它的美妙之处！

与我在 WinForms 中完成的方式相比，WPF 应用程序中只需要很少的“胶水”代码，我对此感到非常惊讶。这是一个例子：我必须展示一个简单的直方图。在 WinForms 中，我会编写一个自定义控件并自己处理渲染。在 WPF 中，我在没有一行代码的情况下从 xaml 完成了这一切！我只是将数据样本绑定到列表框，将列表框的布局模板替换为水平堆栈面板，并将项目模板替换为高度绑定到样本值的矩形！

            回答 #3

赞同：6

时间：2009-03-11T09:30:17.390

MS 没有放弃工具包的做法（WinForms、MFC、ActiveX 和 Win32 仍在积极开发中），“膨胀”实际上是您现在可能不需要的新功能，但很有可能您需要未来。

如果您不想膨胀并且只使用 MS 无法停止支持您的 API，那么欢迎直接使用 Win32 API。

            回答 #4

赞同：4

时间：2011-10-05T11:24:39.180

我相信五分之四的开发人员永远不会超越技术的表面，他们只想拖放一些控件，编写几行代码并启动并运行某些东西，也许会在谷歌上搜索一些示例来帮助解决问题一些扭结，就是这样。对于这些人来说，膨胀不是他们字典中的一个词。

一方面，我更喜欢在开始使用该技术编写代码之前深入了解并真正弄清楚该技术是如何工作的。今天，我花了大约一个小时来研究 WPF 内置命令是如何工作的，并在反射器的帮助下，我设法追踪了一个简单的内置 Cut 命令是如何为普通文本框控件执行的，并猜测什么，当为剪切操作引发文本更改事件时，调用堆栈上大约有 30 个调用，这不是代码膨胀吗？

WPF 当然有许多强大的功能，但它们确实是有代价的。在某些方面，我觉得 WPF 之于 WinForms 就像 MFC 之于 Win32 API；WPF 和 MFC 至少都有“基础”这个词 :)，但如果 WPF 会遇到与 MFC 相同的命运，那将会很有趣。

            回答 #5

赞同：3

时间：2009-03-10T22:16:12.330

这取决于你最喜欢的编程语言，但[Qt](http://www.qtsoftware.com/products)是一个很好的 C++ Gui 工具包。它具有令人印象深刻的功能，是免费的，并且与 GUI 工具包一样独立于平台。

            回答 #6

赞同：3

时间：2011-03-21T01:50:57.403

Qt Quick (QML) 是要走的路。它的设计极为犀利，不会被XML 的不可读性所污染。

            回答 #7

赞同：1

时间：2009-07-28T05:15:56.937

[Adobe AIR](http://www.adobe.com/products/air/)是强大的竞争对手。如果您的目标是创建具有丰富用户界面的跨平台应用程序，请查看这个。

            回答 #8

赞同：-1

时间：2010-11-12T20:52:28.140

首先，我喜欢WPF！我没有看到任何优雅/直接的方式来实现在 WinForms 中设计界面的相同功能和灵活性......也就是说，很遗憾看到 WPF 在 Microsoft 内部不再受到青睐。实际上，包括“内部人员”在内的一些人表示，MS 已将重点从 WPF 转移，Silverlight 现在是 Windows Phone 7 应用程序框架（不再是取代 Flash 的东西）：

[http://www.theregister.co.uk/2010/09/09/microsoft_html_5/](http://www.theregister.co.uk/2010/09/09/microsoft_html_5/)

很多人，包括现任 WPF Leader 都否认了这一点，但我看到这背后可能有一些道理。HTML5 肯定会成为富（网络）客户端界面的“事实上的”标准。它与 WPF 有很多重叠，并且还可以做许多其他事情。它可以“轻松”扩展为适用于非 Web 富客户端应用程序，我相信 MS 将在这方面进行投资，以便在 Web、移动和 Windows 目标的开发工具方面处于领先地位。

如果我已经在 WPF 项目中，我不会害怕被放弃，但我也不会在 WPF 中启动一个，正如许多人已经说过的那样：在没有提供迁移路径和支持的情况下放弃 WPF 之类的东西并不是那么简单它已经很多年了。

那么，MS 世界中 WPF 的当前替代方案？我不认为我们已经有一个，也许在 Silverlight 中使用它的子集是目前要走的路。但是，在接下来的几年中，HTML5 可能会成为 WPF 的替代品。

        javascript - BASE HREF、javascript 和 Internet Explorer 与 Firefox

ID：632471

赞同：18

时间：2009-03-10T22:08:46.937

标签：javascript, html, href

**问题：**

IE 和 Firefox / Safari 处理 BASE HREF 和 Javascript window.location 类型请求的方式似乎不同。首先，这是对问题的准确描述吗？这是怎么回事？处理这种情况的最佳跨浏览器解决方案是什么？

**语境：**

我有一个小的 PHP 平面文件 sitelet（它实际上是一个可用性测试原型）。

我在 PHP 中动态生成 BASE 标签的 HREF 值，即如果它在我们公司的服务器上运行，它是：

```
$basehref = 'http://www.example.com/alpha/bravo/UsabilityTest/'; 
```

在我的本地开发机器上，它是：

```
$basehref = 'http://ellen.local/delta/echo/foxtrot/UsabilityTest/'; 
```

对于其中一项任务，我收集一些用户输入，在 Javascript 中对其进行一些转换，然后使用如下代码发送到服务器：

```
function allDone() {
    // elided code for simplicity of stackoverflow question
    var URI = "ProcessUserInput.php?";
    URI = URI + "alphakeys=" + encodeURI( keys.join(",") );
    URI = URI + "&sortedvalues=" + encodeURI( values.join(",") );
    window.location = URI;
} 
```

javascript 文件（包含函数**allDone()**）和处理 PHP 脚本（**ProcessUserInput.php**）都位于 UsabilityTest 的子目录中。换句话说，他们的实际 URL 是

[http://www.example.com/alpha/bravo/UsabilityTest/foxtrot/ProcessUserInput.php](http://www.example.com/alpha/bravo/UsabilityTest/)
    又名**_**

`$basehref . '/foxtrot/ProcessUserInput.php'`

**问题**

IE 的 JavaScript 基本上似乎忽略了 BASE HREF。javascript 和 PHP 处理器位于同一目录中，因此对**ProcessUserInput.php**的调用运行良好。输入得到处理，一切正常。

但是当我在 Firefox 上测试时，JavaScript*似乎确实*使用了 BASE HREF，因为脚本的输出被发送到

```
$basehref . '/ProcessUserInput.php' 
```

这会中断，因为**ProcessUserInput.php**位于 basehref 的子目录中。但是，如果我将子目录名称添加到 javascript，它不再适用于 IE。

**解决方案？**

我可以想出几种方法来解决这个问题：

*   在 Javascript 中，读取 BASE 标记的 HREF 属性并手动添加到`var URI`javascript 中，调用完全解析的绝对 URL
*   用 PHP处理**.js**文件并将`$basehref`变量插入到脚本中
*   移动文件
*   还有什么？

我相信也必须有其他方法来解决这个问题。当 IE 和 Firefox 在 JavaScript 中以不同方式应用它时，在 JavaScript 中处理 BASE HREF 的最佳方法是什么？

            回答 #1

赞同：7

时间：2009-03-11T21:48:32.263

使用`assign`window.location 的方法似乎是最直接的答案。

代替

```
window.location = URI; 
```

我正在使用这个：

```
window.location.assign( URI ); 
```

这在 IE 和 Firefox 中都是正确的。

            回答 #2

赞同：6

时间：2009-03-10T23:11:49.763

IE 和 Firefox / Safari 处理 BASE HREF 和 Javascript window.location 类型请求的方式似乎不同。

是的，这是一个可以追溯到 Netscape-vs-IE 早期的长期差异。

IE 仅在与文档元素交互时强制执行 base-href。因此，您可以`createElement('a')`设置一个相对值`href`和`click()`它*，但 base-href 将被忽略；appendChild 将它添加到包含 base-href 的文档中，它会起作用。

在其他浏览器上，base-href 被视为全局每个窗口并始终应用。哪个是对的？似乎未指定。原始的 JavaScript 文档只说`location.hash`（因此，`location`作为字符串应用）：

代表一个完整的 URL

因此，将其设置为相对 URL 似乎是一个未定义的操作。

（*：link.click() 是 IE 和 Opera 支持的非标准方法）

读取 BASE 标记的 HREF 属性并手动添加

可能我会做，是的，如果你死心塌地使用 <base>。

            回答 #3

赞同：3

时间：2009-03-10T22:14:39.247

我相信你想修改window.location.pathname，而不是window.location。window.location 是一个 Location 对象，它有多个变量。因此，改变它的影响并没有很好的定义。但是，window.location.pathname 被定义为相对于主机的路径，这是您想要的。

如果您想详细了解可以在 window.location 中更改的许多变量，我会[在此处查看](https://developer.mozilla.org/en/DOM/window.location)。根据 Mozilla 的文档，更改 window.location 中的任何变量都应该使用与这些更改对应的新 URL 重新加载页面。

            回答 #4

赞同：3

时间：2014-09-05T09:17:57.067

我今天遇到了同样的问题，经过一番研究，在 IE9 中找不到任何方法来覆盖这个问题，我的项目有什么要求，所以，我做了以下方法（基于 jquery，但它真的很容易用简单的javascript制作）。

```
href = function(url){
    if ($("base").length > 0 ){
        location.href= $("base").attr("href")+url;
    }else{
        location.href = url;
    }
} 
```

然后，改变

```
location.href= 'emp/start' 
```

到

```
href('emp/start'); 
```

            回答 #5

赞同：2

时间：2012-04-29T22:36:45.063

只需`$('base').attr('href')`在链接之前添加。（使用 jquery）或

```
document.getElementBytagname('base').href 
```

            回答 #6

赞同：0

时间：2017-02-07T23:20:08.710

你总是可以使用 Vanilla JS :)

```
var href = document.getElementBytagname('base')[0].href 
```

我希望这有帮助。

        regex - 正则表达式选择一对引号之外的字符

ID：632475

赞同：42

时间：2009-03-10T22:09:41.397

标签：regex

我想找到一个正则表达式，它会挑选出所有引号之外的逗号。

例如：

```
'foo' => 'bar',
'foofoo' => 'bar,bar' 
```

这将挑出第 1 行上的单个逗号，之后`'bar',`

我真的不在乎单引号和双引号。

有没有人有任何想法？我觉得这应该可以通过预读来实现，但是我的正则表达式 fu 太弱了。

            回答 #1

赞同：97

时间：2009-03-10T22:32:36.427

这将匹配直到并包括第一个未引用的“，”的任何字符串。那是你想要的吗？

```
/^([^"]|"[^"]*")*?(,)/ 
```

如果你想要所有这些（并且作为那个说不可能的人的反例）你可以写：

```
/(,)(?=(?:[^"]|"[^"]*")*$)/ 
```

这将匹配所有这些。因此

```
'test, a "comma,", bob, ",sam,",here'.gsub(/(,)(?=(?:[^"]|"[^"]*")*$)/,';') 
```

用分号替换所有*不在*引号内的逗号，并产生：

```
'test; a "comma,"; bob; ",sam,";here' 
```

如果您需要它跨换行符工作，只需添加 m （多行）标志。

            回答 #2

赞同：17

时间：2014-08-28T08:41:29.603

下面的正则表达式将匹配所有出现在双引号之外的逗号，

```
,(?=(?:[^"]*"[^"]*")*[^"]*$) 
```

[演示](http://regex101.com/r/vW2pQ7/4)

**或**（仅限 PCRE）

```
"[^"]*"(*SKIP)(*F)|, 
```

`"[^"]*"`匹配所有双引号块。也就是说，在这个`buz,"bar,foo"`输入中，这个正则表达式只会匹配`"bar,foo"`。现在以下内容`(*SKIP)(*F)`使匹配失败。然后它移动到`|`符号旁边的模式并尝试匹配剩余字符串中的字符。也就是说，在我们的输出`,`中，模式旁边`|`将仅匹配 to 之后的逗号`buz`。请注意，这与双引号内的逗号不匹配，因为我们已经使双引号部分跳过。

[演示](http://regex101.com/r/vW2pQ7/5)

下面的正则表达式将匹配双引号内的所有逗号，

```
,(?!(?:[^"]*"[^"]*")*[^"]*$) 
```

[演示](http://regex101.com/r/vW2pQ7/3)

            回答 #3

赞同：3

时间：2015-04-05T19:11:44.910

虽然可以用正则表达式破解它（我喜欢滥用正则表达式和下一个人一样多），但你迟早会在没有更高级的解析器的情况下处理子字符串时遇到麻烦。惹上麻烦的可能方式包括混合引号和转义引号。

此函数将使用逗号分割字符串，但不会分割单引号或双引号字符串中的逗号。它可以很容易地用额外的字符扩展以用作引号（尽管像 « » 这样的字符对需要更多的代码行），甚至会告诉您是否忘记关闭数据中的引号：

```
function splitNotStrings(str){
  var parse=[], inString=false, escape=0, end=0

  for(var i=0, c; c=str[i]; i++){ // looping over the characters in str
    if(c==='\\'){ escape^=1; continue} // 1 when odd number of consecutive \
    if(c===','){
      if(!inString){
        parse.push(str.slice(end, i))
        end=i+1
      }
    }
    else if(splitNotStrings.quotes.indexOf(c)>-1 && !escape){
      if(c===inString) inString=false
      else if(!inString) inString=c
    }
    escape=0
  }
  // now we finished parsing, strings should be closed
  if(inString) throw SyntaxError('expected matching '+inString)
  if(end<i) parse.push(str.slice(end, i))
  return parse
}

splitNotStrings.quotes="'\"" // add other (symmetrical) quotes here 
```

            回答 #4

赞同：1

时间：2009-03-10T22:45:29.233

试试这个正则表达式：

```
(?:"(?:[^\\"]+|\\(?:\\\\)*[\\"])*"|'(?:[^\\']+|\\(?:\\\\)*[\\'])*')\s*=>\s*(?:"(?:[^\\"]+|\\(?:\\\\)*[\\"])*"|'(?:[^\\']+|\\(?:\\\\)*[\\'])*')\s*, 
```

这也允许像“<code>'foo\'bar' => 'bar\\',”这样的字符串。

            回答 #5

赞同：1

时间：2011-05-10T00:46:49.323

MarkusQ 的回答对我有用了大约一年，直到没有。我刚刚在一行中出现堆栈溢出错误，总共大约 120 个逗号和 3682 个字符。在 Java 中，像这样：

```
 String[] cells = line.split("[\t,](?=(?:[^\"]|\"[^\"]*\")*$)", -1); 
```

这是我非常不雅的替代品，不会堆栈溢出：

```
private String[] extractCellsFromLine(String line) {
    List<String> cellList = new ArrayList<String>();
    while (true) {
        String[] firstCellAndRest;
        if (line.startsWith("\"")) {
            firstCellAndRest = line.split("([\t,])(?=(?:[^\"]|\"[^\"]*\")*$)", 2);
        }
        else {
            firstCellAndRest = line.split("[\t,]", 2);                
        }
        cellList.add(firstCellAndRest[0]);
        if (firstCellAndRest.length == 1) {
            break;
        }
        line = firstCellAndRest[1];
    }
    return cellList.toArray(new String[cellList.size()]);
} 
```

            回答 #6

赞同：1

时间：2011-05-10T11:43:56.203

*@SocialCensus，您在对 MarkusQ 的评论中给出的示例，您在 " 旁边输入 '，如果我们将sam*更改为*sam's*，则不适用于 MarkusQ 在上面给出的示例：（测试，“逗号”， bob, ",sam's,",here) 与 (,)(?=(?:[^"']|["|'][^"'] *")不匹配*美元）。事实上，“我并不真正关心单引号和双引号”这个问题本身是模棱两可的。你必须清楚你的意思是用“或'引用。例如，是否允许嵌套？如果允许，到多少层？如果只有1个嵌套层，内部嵌套引号之外的逗号会发生什么但在外部嵌套引号内？您还应该考虑单引号本身作为撇号出现（即，就像我之前用 sam's 给出的反例）。最后，您制作的正则表达式并没有真正对待单引号双引号，因为它假定最后一种引号必须是双引号 - 如果文本没有正确引用（或者如果使用撇号），用 ['|"] 替换最后一个双引号也会有问题),

MarkusQ 的正则表达式回答了这个问题：查找其后有偶数个双引号的所有逗号（即，在双引号之外）并忽略其后有奇数个双引号的所有逗号（即，在双引号内）。这通常与您可能想要的解决方案相同，但让我们看看一些异常情况。首先，如果有人在末尾留下引号，则此正则表达式会找到所有错误的逗号，而不是找到所需的逗号或无法匹配任何逗号。当然，如果缺少双引号，则所有赌注都将关闭，因为可能不清楚丢失的双引号是属于最后还是属于开头；但是，有一种情况是合法的，并且正则表达式可能会失败（这是第二个“异常”）。如果您调整正则表达式以跨越文本行，那么您应该知道，引用多个连续段落需要在每个段落的开头放置一个双引号，并在每个段落的末尾省略引号，最后一段的末尾除外。这意味着在这些段落的空间中，正则表达式将在某些地方失败而在其他地方成功。

段落引用和嵌套引用的示例和简要讨论可以在这里找到[http://en.wikipedia.org/wiki/Quotation_mark](http://en.wikipedia.org/wiki/Quotation_mark)。

        iphone - 从顶部/底部翻转 UIView

ID：632480

赞同：7

时间：2009-03-10T22:11:37.320

标签：iphone, animation, uiview, transition

我很清楚只有两个可用的 UIView 转换，UIViewAnimationTransitionFlipFromLeft 和 UIViewAnimationTransitionFlipFromRight。我想知道是否有任何方法可以实现/模拟 UIViewAnimationTransitionFlipFromTop 或 UIViewAnimationTransitionFlipFromBottom。

我能想到的唯一方法是用 y 轴翻转 x 轴，但我还没有看到有关如何执行此操作的任何信息。仅设置每个轴的坐标并不能解决问题，因为 x 轴仍然是 x 轴。  

有谁知道如何做到这一点？

            回答 #1

赞同：4

时间：2009-03-12T02:43:48.170

您可以通过将 CATransform3D 应用到主视图的 CALayer 来实现此目的，而辅助视图的 CALayer 位于其后面。在[这个回复](https://stackoverflow.com/questions/372018/widget-flip-behavior-in-core-animation-cocoa/372419#372419)中，我指出了 Mike Lee 对这个动画的 Mac 实现。您应该能够重用该代码的重要部分来在 iPhone 上重新创建这种效果。

            回答 #2

赞同：3

时间：2009-03-10T23:50:07.643

猜猜你必须使用具有 90 度旋转变换的 UIView 动画块，完成后让 Core Animation 代理调用你，将视图与新视图交换（另一侧为 3D 旋转）并与最后 90 度为新视图...

            回答 #3

赞同：1

时间：2009-03-22T20:11:09.800

尽管它不完全是您想要的，但有两个您没有提到的内置动画：UIViewAnimationTransitionCurlDown 和 UIViewAnimationTransitionCurlUp。

CurlUp 看起来像是有人正在从下到上剥离视图，而 CurlDown 看起来像是在屏幕顶部从上到下展开视图。你至少应该看看它们，因为它们很容易使用。

        security - 使 SharePoint 自定义快速启动链接具有与列表链接相同的可见性/权限的方法

ID：632503

赞同：2

时间：2009-03-10T22:17:24.420

标签：security, sharepoint, wss-3.0

当我在任何站点的快速启动栏中创建新链接时，该链接是静态的并且始终可见，即使用户可能无权查看该文档或其所在的文档库。当任何文档库有链接时在快速启动中（通过文档库的“标题、描述和导航”设置），快速启动链接受权限限制，如果用户无权查看该文档库，则不会显示在快速启动中。

有没有办法实现相同的功能，让我的文档的静态 URL 受到相同的“如果用户有权查看该文档”操作则可见？可能以某种方式在文档的 SharePoint 快速启动上添加链接，就像我可以添加带有文档库的快速启动链接一样？

            回答 #1

赞同：3

时间：2009-03-11T13:01:40.987

您应该使用[受众](http://office.microsoft.com/en-us/sharepointserver/HA101690531033.aspx#3)来实现这一目标。受众允许您针对具有特定内容的用户组。此功能仅在 Microsoft Office SharePoint 2007 中可用，在 Windows SharePoint Services 中不存在。

如果可能，您应该坚持受众，但您也可以通过以下方式解决问题：

*   创建自定义快速启动作为服务器端控件
*   创建一个 JQuery 脚本来检查权限和更新快速启动（不推荐）

        c# - 滚动条在应该被移除后仍然被绘制

ID：632504

赞同：1

时间：2009-03-10T22:17:51.390

标签：c#, winforms, controls, scrollbar

我有以下自定义控件，可以放置在表单上（AutoScroll 设置为 true，控件锚定在左侧、顶部和右侧）。

如果窗体对于控件来说太短，窗体会正确调整控件的大小（为滚动腾出空间）并显示滚动条。

当使用关闭字形关闭控件时，会调整控件的大小并移除滚动条，但有时滚动条似乎仍保持绘制状态。如果表单被最小化或移出屏幕，剩余的油漆将被移除。

我已经尝试过 Parent.Invalidate 并以多种方式玩弄它，但无济于事。有什么建议么？

（使用 VS 2008 标准）

[替代文字 http://waltware.homedns.org/screenshot.jpg](http://waltware.homedns.org/screenshot.jpg)

```
using System;
using System.ComponentModel;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Windows.Forms;

namespace GroupPanelTest
{
    public class GroupPanel : GroupBox
    {
        #region Members
        private const Int32 iHeaderHeight = 20;
        private Int32 iFullHeight = 200;

        private Boolean bClosed = false;
        private Rectangle rectCloseGlyphBounds = Rectangle.Empty;
        private Boolean bIsMoveOverCloseGlyph = false;
        #endregion

        #region Properties
        [DefaultValue(false)]
        public Boolean Closed
        {
            get
            {
                return (this.bClosed);
            }
            set
            {
                if (this.bClosed != value)
                {
                    this.bClosed = value;
                    if (this.bClosed)
                    {
                        this.iFullHeight = base.Height;
                        base.Height = GroupPanel.iHeaderHeight;
                    }
                    else
                    {
                        base.Height = this.iFullHeight;
                    }

                    foreach (Control con in base.Controls)
                        con.Visible = !this.bClosed;

                    this.Invalidate();
                }
            }
        }

        public new Int32 Height
        {
            get
            {
                return (base.Height);
            }
            set
            {
                if (value != base.Height)
                {
                    if (this.Closed)
                    {
                        this.iFullHeight = value;
                    }
                    else
                    {
                        Int32 iOldHeight = base.Height;
                        base.Height = value;
                    }
                }
            }
        }

        [DefaultValue(typeof(Size), "350,200")]
        public new Size Size
        {
            get
            {
                return (base.Size);
            }
            set
            {
                if (base.Size != value)
                {
                    base.Size = value;
                    if (!this.Closed)
                        this.iFullHeight = value.Height;
                }
            }
        }

        [DefaultValue(typeof(Padding), "0,7,0,0")]
        public new Padding Padding
        {
            get
            {
                return (base.Padding);
            }
            set
            {
                base.Padding = value;
            }
        }
        #endregion

        #region Construction
        public GroupPanel ()
        {
            SetStyle(ControlStyles.UserPaint, true);
            SetStyle(ControlStyles.ResizeRedraw, true);
            SetStyle(ControlStyles.AllPaintingInWmPaint, true);
            SetStyle(ControlStyles.OptimizedDoubleBuffer, true);
            SetStyle(ControlStyles.Selectable, true);

            this.Size = new Size(350, 200);
            this.Padding = new Padding(0, 7, 0, 0); // the groupbox will add to that
            this.rectCloseGlyphBounds = new Rectangle(base.ClientSize.Width - 24, 2, 16, 16);
        }
        #endregion

        #region Overrides
        protected override void OnSizeChanged (EventArgs e)
        {
            this.rectCloseGlyphBounds = new Rectangle(base.ClientSize.Width - 24, 2, 16, 16);
            base.OnSizeChanged(e);
        }

        protected override void OnPaint (PaintEventArgs e)
        {
            base.OnPaint(e); // we want all the delegates to receive the events, but we do this first so we can paint over it

            Graphics g = e.Graphics;

            g.FillRectangle(SystemBrushes.Window, this.ClientRectangle);
            Rectangle rectTitle = new Rectangle(0, 0, this.ClientRectangle.Width, GroupPanel.iHeaderHeight);
            g.FillRectangle(SystemBrushes.Control, rectTitle);
            g.DrawString(this.Text, this.Font, SystemBrushes.ControlText, new PointF(5.0f, 3.0f));

            if (this.bIsMoveOverCloseGlyph)
            {
                g.FillRectangle(SystemBrushes.ButtonHighlight, this.rectCloseGlyphBounds);
                Rectangle rectBorder = this.rectCloseGlyphBounds;
                rectBorder.Inflate(-1, -1);
                g.DrawRectangle(SystemPens.Highlight, rectBorder);
            }

            using (Pen pen = new Pen(SystemColors.ControlText, 1.6f))
            {
                if (this.Closed)
                {
                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 3, this.rectCloseGlyphBounds.Top + 3, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 8);
                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 13, this.rectCloseGlyphBounds.Top + 3, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 8);

                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 3, this.rectCloseGlyphBounds.Top + 7, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 12);
                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 13, this.rectCloseGlyphBounds.Top + 7, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 12);
                }
                else
                {
                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 3, this.rectCloseGlyphBounds.Top + 8, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 3);
                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 13, this.rectCloseGlyphBounds.Top + 8, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 3);

                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 3, this.rectCloseGlyphBounds.Top + 12, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 7);
                    g.DrawLine(pen, this.rectCloseGlyphBounds.Left + 13, this.rectCloseGlyphBounds.Top + 12, this.rectCloseGlyphBounds.Left + 8, this.rectCloseGlyphBounds.Top + 7);
                }
            }
        }

        protected override void OnMouseDown (MouseEventArgs e)
        {
            if (e.Button == MouseButtons.Left && this.rectCloseGlyphBounds.Contains(e.Location))
                this.Closed = !this.Closed; // close will call invalidate
            base.OnMouseDown(e);
        }

        protected override void OnMouseMove (MouseEventArgs e)
        {
            this.bIsMoveOverCloseGlyph = this.rectCloseGlyphBounds.Contains(e.Location);
            this.Invalidate(this.rectCloseGlyphBounds);
            base.OnMouseMove(e);
        }
        #endregion
    }
} 
```

            回答 #1

赞同：0

时间：2009-03-14T09:21:08.170

您必须在 Control.Invalidate() 之后调用 Control.Update() 才能获得所需的效果。或者通过调用 .Refresh() 让您的生活稍微轻松一些。

        linux - XDG_SESSION_COOKIE 环境变量有什么用？

ID：632515

赞同：6

时间：2009-03-10T22:21:35.110

标签：linux, bash, cron

我最近一直在使用 crontab，因为在 Intrepid 中，gconftool 使用 dbus 后端，这意味着从 crontab 中使用时它不起作用。

为了使它工作，我必须在登录时导出相关的环境变量，以便在 cron 运行时找到 dbus 会话地址。

出于好奇，我想知道 cron*可以*看到什么环境，结果发现我只有`HOME`, `LOGNAME`, `PATH`, `SHELL`,`CWD`以及我身上的这个新环境, `XDG_SESSION_COOKIE`. 这看起来很奇怪，一些谷歌搜索已经提出了一些涉及它的错误或其他功能请求，但没有任何东西告诉我它做了什么。

我的直觉是，这个变量可用于查找在 cron 作业运行之前我必须导出到源文件的所有内容。

因此，我的问题是 a) 我可以吗？b) 如果是，怎么做？c) 它有什么（其他）作用？

谢谢大家

            回答 #1

赞同：6

时间：2009-03-10T22:43:35.620

这很有趣。我发现这是显示管理器设置了一个 cookie。它可以用于注册进程以属于一个“会话”，该会话由一个名为[`ConsoleKit`](http://freedesktop.org/wiki/Software/ConsoleKit). 即支持快速用户切换。我的 KDE4.2.1 系统显然也支持它。

阅读[这个](http://fedoraproject.org/wiki/Desktop/FastUserSwitching#ConsoleKit)fedora wiki 条目。

所以这个环境变量就像`DBUS_SESSION_BUS_ADDRESS`授予对某些实体的访问权限（在`XDG_SESSION_COOKIE`由 ConsoleKit 管理的登录会话的情况下）。例如，有了该环境变量，您可以向经理询问您当前的会话：

```
$ dbus-send --print-reply --system --type=method_call \
    --dest=org.freedesktop.ConsoleKit \
    /org/freedesktop/ConsoleKit/Manager \
    org.freedesktop.ConsoleKit.Manager.GetCurrentSession

method return sender=:1.1 -> dest=:1.34 reply_serial=2
   object path "/org/freedesktop/ConsoleKit/Session1"
$ 
```

Manager 还支持查询某个进程所属的会话

```
$ [...].Manager.GetSessionForUnixProcess uint32:4494

method return sender=:1.1 -> dest=:1.42 reply_serial=2
   object path "/org/freedesktop/ConsoleKit/Session1" 
```

但是，它没有列出或以某种方式包含与某些`cron`工作相关的变量。但是，文档`dbus-launch`说`libdbus`会自动找到正确的 DBUS 总线地址。例如，文件存储在`/home/js/.dbus/session-bus`其中包含正确的当前 dbus 会话地址。

        .net - 如何隐藏 WPF ListView 的标题？

ID：632519

赞同：92

时间：2009-03-10T22:22:19.523

标签：.net, wpf, gridview, listview, wpf-controls

我希望能够隐藏 WPF ListView 中每个网格列顶部的标题。

这是我的 ListView 的 XAML：

```
 <Window x:Class="ListViewTest.Test0.ListViewTest"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   Title="Empty ListView Grid" Height="216" Width="435" FlowDirection="LeftToRight" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.IsSharedSizeScope="False">
    <Window.Resources>
        <XmlDataProvider x:Key="CustomersDS" Source="C:\data.xml"/>
    </Window.Resources>

    <ListView Margin="0,0,0,50" ItemTemplate="{DynamicResource CustomerTemplate}" ItemsSource="{Binding Source={StaticResource CustomersDS}, XPath=/Customers/Customer}">
        <ListView.View>
            <GridView>
                <GridViewColumn  DisplayMemberBinding="{Binding XPath=Code}"/>
                <GridViewColumn  DisplayMemberBinding="{Binding XPath=Name}"/>
                <GridViewColumn  DisplayMemberBinding="{Binding XPath=Country}"/>
            </GridView>
        </ListView.View>
    </ListView>

</Window> 
```

我绑定到的数据是：

```
 <Customers>
  <Customer>
 <Code>1234</Code>
 <Name>EPI</Name>
 <Country>Sesame Street</Country>
  </Customer>
  <Customer>
 <Code>3234</Code>
 <Name>Paul</Name>
 <Country>United Kingdom</Country>
  </Customer>
 <Customer>
 <Code>3344</Code>
 <Name>Juan</Name>
 <Country>Spain</Country>
  </Customer>
 <Customer>
 <Code>4321</Code>
 <Name>Dodo</Name>
 <Country>Mars</Country>
  </Customer>
</Customers> 
```

            回答 #1

赞同：152

时间：2009-03-10T22:34:36.657

像这样定义样式

```
<Window.Resources>
    ....
    <Style x:Key="myHeaderStyle" TargetType="{x:Type GridViewColumnHeader}">
        <Setter Property="Visibility" Value="Collapsed" />
    </Style>
</Window.Resources> 
```

像这样应用它

```
<GridView ColumnHeaderContainerStyle="{StaticResource myHeaderStyle}">
    ....
</GridView> 
```

            回答 #2

赞同：60

时间：2013-07-09T06:26:32.363

您也可以`Style`像这样放置内联：

```
<ListView>
    <ListView.Resources>
        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Visibility" Value="Collapsed" />
        </Style>
    </ListView.Resources>
    <ListView.View>
        <GridView>
            <!-- ... -->
        </GridView>
    </ListView.View>
</ListView> 
```

这确保样式将仅应用于所需的控件（*即*，不会无意影响可能在**XAML**范围内的任何其他控件）。

            回答 #3

赞同：22

时间：2015-08-11T09:26:28.493

您可以应用 Ray 的解决方案的另一种方法是：

```
<ListView>
    <ListView.View>
        <GridView>
            <GridView.ColumnHeaderContainerStyle>
                <Style TargetType="GridViewColumnHeader">
                    <Setter Property="Visibility" Value="Collapsed" />
                </Style>
            </GridView.ColumnHeaderContainerStyle>
        </GridView>
    </ListView.View>
</ListView> 
```

该解决方案直接设置样式属性，而不是创建自动应用的资源。不是说更好，只是另一种方式...

        objective-c - iPhone SDK：UIWebView

ID：632520

赞同：1

时间：2009-03-10T22:22:29.803

标签：objective-c, iphone, uiwebview

我正在开发一个使用 UIWebView 来显示其帮助文件的应用程序。webView 存在于它自己的视图中，DocViewController ......当它被称为

```
- (void)viewDidLoad { 
```

方法使用

```
[webView loadRequest:[NSURLRequest requestWithURL:[NSURL fileURLWithPath:   [[NSBundle mainBundle] pathForResource:docPage ofType:@"html"]isDirectory:NO]]]; 
```

加载正确的文档页面。但是，一旦加载了第一页，当 docPage 更改并切换视图时，视图将变为静态并且不会加载新页面。有没有办法清除 webView 以便在请求时加载新页面？  

编辑：

第一个答案让我感到困惑。正如下面的例程一样。只是它只工作*一次*。第一次加载视图后，当再次打开该视图并且请求的 html 页面不同时，它不会更改。该视图始终显示请求的第一个 html 页面，并且不会加载新请求。

```
 - (void)viewDidLoad {

     docPage = [NSString stringWithFormat: @"%d", hexpage];

     [webView loadRequest:[NSURLRequest requestWithURL:[NSURL fileURLWithPath:[NSBundle mainBundle] pathForResource:docPage ofType:@"html"]isDirectory:NO]]];

 } 
```

            回答 #1

赞同：3

时间：2009-03-13T20:22:20.930

`viewDidLoad`只调用一次，除非视图被释放并且需要重新加载。这通常仅在视图控制器收到内存不足警告时才会发生。而不是`viewDidLoad`，尝试将该代码放入`viewWillAppear:`，每次视图显示在屏幕上时都会调用该代码。

            回答 #2

赞同：2

时间：2009-03-10T22:51:13.760

尝试使用

```
- (void)loadHTMLString:(NSString *)string baseURL:(NSURL *)baseURL 
```

将 NSURL 对象传递给包含您的 HTML 作为 baseURL 的目录，并使用类似的内容加载 HTML 字符串

```
NSString *path = [[NSBundle mainBundle] pathForResource:@"myfile" 
                                                 ofType:@"html"];
NSString *html = [NSString stringWithContentsOfFile:path 
                                           encoding:NSUTF8StringEncoding
                                              error:nil]; 
```

编辑：另外，请确保您的超链接没有尝试在新窗口中打开类似 target="_blank" 的内容，您的 webview 不会打开那些

        c# - Linq 选择 IList

ID：632521

赞同：2

时间：2009-03-10T22:22:37.900

标签：c#, linq, ilist

```
 List<MyParentClass> parents = new List<MyParentClass>();
    var parent1 = new MyParentClass("parent1");
    var parent2 = new MyParentClass("parent2");
    parents.Add(parent1);
    parents.Add(parent2);
    var child1 = new MyChildClass("child1");
    parent1.children.Add(child1);
    var child2 = new MyChildClass("child2");
    var child3 = new MyChildClass("child3");
    parent2.children.Add(child2);
    parent2.children.Add(child3);
    var foo = from p in parents
              select from c in p.children
                     select c;
    Assert.IsNotNull(foo);
    Assert.AreEqual(3, foo.Count());

NUnit.Framework.AssertionException: 
    expected: <3>
     but was: <2> 
```

我想我得到了一个 IList 的 IList，但我希望只有三个孩子。我怎么得到它？

            回答 #1

赞同：6

时间：2009-03-10T22:25:33.480

我对查询语法并不太自信，但我认为这会使子列表变平：

```
var foo = from p in parents
          from c in p.children
          select c; 
```

使用扩展方法语法，它看起来像这样：

```
var foo = parents.SelectMany(p => p.children); 
```

            回答 #2

赞同：4

时间：2009-03-10T22:26:40.387

您实际上是在取回一个 IEnumerable<IEnumerable<MyChildClass>>。为了获得一个简单的 IEnumerable<MyChildClass> 您可以进行以下调用

```
var bar = foo.SelectMany(x => x); 
```

        .net - 检测程序的运行实例并传递信息

ID：632522

赞同：2

时间：2009-03-10T22:22:54.483

标签：.net

在 .NET 中，检测同一程序的实例是否已在运行的最可靠方法是什么？此外，将命令行参数传递给已经运行的实例（例如打开特定文档）的最佳方式是什么？

            回答 #1

赞同：3

时间：2009-03-10T23:11:33.820

在 .NET 程序中实现单实例应用程序似乎有三种众所周知的方法：process 方法、Mutex 方法和 Visual Basic 方法。

Michael Covington 在他的提示中讨论了前两个，[确保只有一个 .NET 应用程序实例正在运行](http://www.ai.uga.edu/~mc/SingleInstance.html)。

有一篇[CodeProject 文章](http://www.codeproject.com/KB/cs/SingleInstanceAppMutex.aspx)更详细地讨论了 Mutex 方法，包括获取现有应用程序的窗口句柄，以便您可以（以某种方式）与其通信。

另[一篇 CodeProject 文章](http://www.codeproject.com/KB/cs/CSSIApp.aspx)描述了如何使用 Microsoft.VisualBasic 命名空间（可从 C# 访问）中的类来实现单实例应用程序。

我对第三种方法一点也不熟悉。在前两个中，它们都有效，但正如链接文章中指出的那样，Mutex 方法似乎更健壮。我不知道为什么选择 Mutex 作为要使用的命名对象。任何命名的同步对象（EventWaitHandle、Mutex、Semaphore 等）都可以工作。

与现有应用程序通信会带来更多问题。如果您需要做的只是向正在运行的应用程序发送一条相对较小的消息，我建议您考虑使用命名管道。查看[System.IO.Pipes.NamedPipeClientStream](http://msdn.microsoft.com/en-us/library/system.io.pipes.namedpipeclientstream.aspx)了解更多信息。

我还应该注意，如果您担心安全性，则需要保护您使用的任何通信方法。任何具有足够权限的应用程序都可以通过命名管道向正在运行的应用程序发送信息。

            回答 #2

赞同：1

时间：2009-03-10T22:37:52.577

您可以使用 .Net remoting(.Net 2.0) 或 WCF(.Net 3.5) 在相同或不同计算机上的程序之间进行通信。

您不能将命令行参数传递给已经运行的程序。您可以使用任何您想要的方法向它传递您想要的任何数据，但它必须有意识地处理这些数据。它不会神奇地用作命令行参数

            回答 #3

赞同：0

时间：2009-03-10T22:26:02.603

我不知道这是否是最好的方法。我使用了一个单例对象，它基本上只是一个存放命名互斥锁的地方。如果应用程序尝试运行两次，它会检查互斥锁是否正在使用，如果是，它会停止执行，因此它不能运行两次。

但是，我不确定如何与已经运行的应用程序对话。

            回答 #4

赞同：0

时间：2009-03-10T22:42:54.827

"**将命令行参数传递给已经运行的实例（例如打开特定文档）的最佳方式是什么？**

不幸的是，我不相信这是可能的。应用程序可以使用 Console.ReadLine() 从标准输入中获取输入，但这与传递命令行参数不同。

通过 .NET 进行进程间通信还有其他几种方法。.NET Remoting 和 WCF，以及您自己的自定义套接字协议。

您可以使用 System.Diagnostics 命名空间来收集正在运行的进程列表。

            回答 #5

赞同：-1

时间：2009-03-10T22:44:31.030

要确定应用程序是否正在运行，请不要使用 Mutex，因为它的开销很大。采用

```
using System.Diagnostics;

public bool IsProcessOpen(string name)
{
    foreach (Process clsProcess in Process.GetProcesses) {
        if (clsProcess.ProcessName.Contains(name)) return true;
    }
    return false;
} 
```

您提供的有关此“其他应用程序”的信息越多越好。如果您开发了“其他应用程序”，您可以将一些数据序列化到其他应用程序，让它知道您希望它获取哪些其他信息。查看 .NET 框架 XMLSerializer。您甚至可以做一些简单的事情，例如使用数据库条目。您可以使用 UDP 数据包。有很多方法可以与另一个程序通信。问题是，另一个程序是什么？

        java - 处理 JNI 异常的简单代码

ID：632546

赞同：1

时间：2009-03-10T22:31:02.920

标签：java, java-native-interface

我想用一种很好、整洁的方式将以下 java 代码表示为 JNI：

```
try {
    SomeMethod ();
}
catch (ExceptionType1 e) {
    SomeAction ();
}
catch (ExceptionType2 e) {
    SomeAction ();
}
catch (ExceptionType3 e) {
    SomeAction ();
} 
```

这样做是否有一个整洁的 JNI 模式？目前，我有这个：

```
java_class = (*env)->FindClass (env, EXCEPTION_CLASS_NAME);
if (java_class == NULL) {
    *error_type_ref = ERROR_TYPE_FATAL;
    *exception_code_ref = EU_StrSprintf ("Class not found: %s", EXCEPTION_CLASS_NAME);
    cleanup ();
}
if ((*env)->IsInstanceOf (env, exception, java_class)) {
    SomeAction ();
    cleanup ();
} 
```

当然，这样处理的每个异常都会再次发生这种情况。一定有更好的方法。有什么建议吗？我对将所有现有代码移植到 JNA 不感兴趣，所以我想要一种可以在本土实现的模式，可以这么说。

            回答 #1

赞同：1

时间：2009-03-10T23:40:08.603

扩展我对 C 与 C++ 的评论。

我会在 C++ 中尝试这样的事情（nb：*完全未经测试，可能无法按原样编译！*）

```
class JavaClass {

    private:
        jclass cls;
        JNIEnv *env;

    public:
        JavaClass(JNIEnv *env, const char *className) {
            this.env = env;
            cls = env->FindClass(className);
            // handle errors
        }

        ~JavaClass() {
            env->DeleteLocalRef(cls);
        }

        bool isInstanceOf(jobject obj) {
            return env->IsInstanceOf(obj, cls);
        }
}; 
```

客户端代码将如下所示：

```
JavaClass ext1(env, "ExceptionType1");
JavaClass ext2(env, "ExceptionType2");
JavaClass ext3(env, "ExceptionType3");

SomeMethod();

if (ex = env->ExceptionOccurred()) {
    if (ext1.isInstanceOf(ex)) {
        doSomething();
    } else if (ext2.isInstanceOf(ex)) {
        doSomething();
    } else if (ext3.isInstanceOf(ex)) {
        doSomething();
    }
} 
```

(Note that the semantics of this `isInstanceOf()` function are bass-ackwards - in this one it's "`class.instanceof(object)`", instead of "`object instanceof class`").

            回答 #2

赞同：-1

时间：2009-03-10T23:09:22.330

一定有更好的方法

模板模式，可能是？

        .net - 用于并发数据库访问的 IO 完成端口

ID：632559

赞同：2

时间：2009-03-10T22:35:13.940

标签：.net, concurrency

我有一个需要一次处理多个客户端请求的 .NET WCF 服务。

该服务为每个客户端请求进行数据库调用（读取和写入）。

IO 完成端口是否可以用于此代码的数据库访问部分以提高并发性能？在这种情况下如何使用它们？

            回答 #1

赞同：2

时间：2009-12-10T22:44:59.197

ADO.NET 2.0 支持内部使用 IO 完成端口的异步命令执行。（BeginXXX 和 EndXXX 方法）

查看[http://msdn.microsoft.com/en-us/library/ms379553(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms379553(VS.80).aspx)

            回答 #2

赞同：0

时间：2009-03-24T04:09:05.027

这取决于您如何进行数据库读取和写入。如果您使用某种直接套接字或文件输入/输出调用，那么您可以增加可以同时服务的调用数量。但是，实际执行数据库读/写的时间取决于服务器。

但是很可能您正在通过 ODBC/OLEDB/ADO/ADO.NET 访问数据库，在这种情况下，这些库不使用 IO 完成端口。而且你不能让他们使用 IO 完成端口。

IO 完成端口用于防止线程在等待 IO 完成时阻塞。把它想象成异步读/写。

        wpf - WPF：动画完成后返回方法

ID：632565

赞同：0

时间：2009-03-10T22:40:28.450

标签：wpf, animation, callback

*参考我目前正在构建的[这个编程游戏。](https://stackoverflow.com/questions/505040/developing-a-robocode-type-game-with-net-for-a-school-assignment)*

我有一个类库（dll），它将有一个方法，该方法`Run`由以下内容组成：

```
public class MyRobot : Robot 
{
    public void Run(} 
    {
        while (true) 
        {
           Ahead(200); //moves the bot 200pixels
           TurnLeft(90); //turns the bot by 90deg 
        }
    }
} 
```

在这些方法中（继承自`Robot`），系统将使用 WPF（使用`BeginAnimation`或`DispatcherTimer`）为机器人设置动画。

现在，问题是在完成当前方法之前我没有返回方法（即继续下一个方法），因为这将导致动画一起发生，并且在无限循环中时（如上面一个），这尤其不好。

我的问题是，**在完成动画之前防止方法返回的最佳方法是什么**？

我目前`bool`在`Robot`类 ( `isActionRunning`) 中有一个标记为何`true`时开始运行动作，然后`false`在动画回调中更改为（`Completed`如果使用则使用事件`BeginAnimation`）。

在每个方法结束时（调用后`BeginAnimation`），我放置了以下循环：

```
while (isActionRunning) 
{
    Thread.Sleep(200); //so that the thread sleeps for 200ms and then checks again if the animation is still running 
} 
```

这样该方法就不会在动画结束之前返回。

但我觉得这不是正确的做法。

谁能指导我实现这一目标的最佳方法？

            回答 #1

赞同：5

时间：2010-04-01T14:48:52.093

用锁建造信号装置是疯狂的。只需使用框架中已经存在的信号设备。

[http://msdn.microsoft.com/en-us/library/system.threading.autoresetevent.aspx](http://msdn.microsoft.com/en-us/library/system.threading.autoresetevent.aspx)

那就是：线程一说“嘿，线程二，开始这个动画，当你完成后，在这个等待句柄上给我发信号。” 然后线程一在等待句柄上等待。线程 2 启动动画，并在其完成事件中向等待句柄发出信号。线程一然后再次醒来并说“嘿线程二，开始另一个动画......”

            回答 #2

赞同：3

时间：2009-03-11T09:18:17.340

这是一个选项，它仅在 Robot.Run 代码运行在与执行动画的 UI 线程不同的线程中时才有效。

在 Robot.Ahead 方法中（例如），使用 Dispatcher.Invoke（而不是 BeginInvoke）来调用启动动画的方法，而不是在机器人上添加一个带有空块的锁（ lock(this) { } ）。

在启动动画的方法中调用 Monitor.Enter(robot) 在启动动画之前

在动画完成处理程序调用 Monitor.Leave(robot)

结果将是

```
time      robot thread          UI thread  
  |       ---------------       --------------  
  |       call Invoke    --->  
  |                             lock robot (Monitor.Enter)  
  |                             begin animation  
  |       Invoke returns <---   return  
  |       lock(this)            (animation running)  
  |       (wait for lock  
  |       to become available)  
  |  
  |                             Animation complete  
  |                             release lock (Monitor.Exit)  
  |       (lock available,  
  |       continue running)  
  |       Release lock (exit lock block)  
  |       Return and start next  
  |       movement  
  \/ 
```

            回答 #3

赞同：0

时间：2009-03-10T23:01:26.590

我会做类似于你描述的事情。我最近在做一些事情，我调用了一堆异步操作，我想在调用另一个操作之前等待它们全部完成。我创建了一个集合来表示当前正在执行的所有操作，而不是直接将项目添加到集合中，我创建了用于添加和删除的方法。remove 方法的逻辑是“锁定集合，删除提供的密钥，如果为空则调用下一个操作”。您可以创建一个类似的机制，其中以应用程序或窗口为范围的集合跟踪正在执行的操作。您向集合添加一个密钥并将此密钥传递给您的异步操作。异步操作完成后，锁定集合并移除密钥。

这可能是矫枉过正，但我​​自己在这个问题上的经验有限。据我所知，.Net 甚至可能有一个针对这个问题的固定解决方案，它可以使用一两行代码。

        java - XML 块是否有效？

ID：632567

赞同：0

时间：2009-03-10T22:41:05.063

标签：java, xml, validation

我想将 XML 文件的一些片段存储在单独的文件中。看来，没有办法直接做到这一点：读取块失败。

我总是得到异常“javax.xml.transform.TransformerException：org.xml.sax.SAXParseException：根元素之后的文档中的标记必须格式正确。”

它仅在只有一个“根”元素（不是正常意义上的根元素）时才有效。

我了解具有多个“根”的 XML 格式不正确，但应将其视为一个块。

请在提出一些变通解决方案之前告诉我：XML 块是否有效？

如果是这样，可以使用标准 JDK6 API 读取它们吗？

测试代码：

```
String testChunk1 = "<e1>text</e1>";
String testChunk2 = "<e1>text</e1><e2>text</e2>";

// the following doesn't work with 'testChunk2'
StringReader sr = new StringReader(testChunk1);
StringWriter sw = new StringWriter();

TransformerFactory.newInstance().newTransformer().transform(
    new StreamSource(sr), new StreamResult(sw));

System.out.println(sw.toString()); 
```

            回答 #1

赞同：2

时间：2009-03-10T23:08:02.863

W3C 一直致力于定义[XML 片段交换](http://www.w3.org/TR/xml-fragment)的标准。我提到它并不是因为它可以解决您的问题，但看到关于如何处理此类事情的讨论肯定是相关的。

在 .NET 世界中，您可以使用 XML 片段，例如，[根据模式验证它们](http://support.microsoft.com/kb/318504)。这表明值得在 Java 库中搜索类似的支持。

如果您想使用 XSLT 转换此类片段，一种非常常见的方法是在它们周围放置一个包装器元素，然后它可以充当 DOM 的根。

            回答 #2

赞同：1

时间：2009-03-10T22:52:21.900

虽然我认为必须有某种方法，也许是笨拙的，来做你想做的事，但我不知道有什么方法可以做到。正如您所发现的，标准 XML 解析器需要格式良好的 XML。

如果您想将您的 XML 作为多个单独的片段存储在不同的文件中，那么最好的方法可能是创建您自己的 Reader 或 InputStream 实际（在幕后）按顺序读取所有片段，然后将包装好的 Reader 或 InputStream 提供给转换器。这样，XML 解析器会看到单个 XML 文档，但您可以随意存储它。

如果你这样做，片段（除了第一个片段）不能以标准 XML 标头开头：

```
<?xml version="1.0" encoding="UTF-8" ?> 
```

            回答 #3

赞同：1

时间：2009-03-10T23:31:35.270

请在提出一些变通解决方案之前告诉我：XML 块是否有效？

不是他们自己的权利。

您可以通过实体引用等方法将它们（作为 XML 外部解析实体）包含在其他文档中，并且可以使用诸如 DOM Level 3 LS 的 parseWithContext() 之类的方法将它们作为块解析到现有文档中（Java 没有给你，对不起），但它们不是文档，因此任何需要完整文档的界面都不能接受它们。

Transformer 需要完整的文档作为输入，因为 XSLT 可以处理完整的文档，并且会被包含零个或多个根元素的内容混淆。通常的技巧是通过将文档包装在开始和结束标记中来创建单个根元素，但这确实意味着您不能拥有 XML 声明（*），正如 Eddie 所提到的。

（*：实际上，当包含在外部解析实体中时，它被称为“文本声明”，但语法完全相同。）

        .net - 通知区域（AKA 系统托盘）中的大项目？

ID：632568

赞同：2

时间：2009-03-10T22:41:10.883

标签：.net, windows-xp, taskbar, system-tray, trayicon

我想在 XP 系统托盘中放置一些大件物品。（时钟旁边的那个）

我的意思是占用超过标准图标空间的项目。

我知道这是可以做到的，因为我见过几个具有此功能的天气和时间应用程序。

例如[http://www.respectsoft.com/weather-clock-screenshots.php](http://www.respectsoft.com/weather-clock-screenshots.php)（见时钟屏幕截图）

但我找不到任何关于如何做到这一点的文档。

虽然 .net 代码将是其他技术的首选指令，但也会有所帮助。

谢谢

西蒙

            回答 #1

赞同：2

时间：2009-03-10T22:50:19.427

我相信系统托盘中唯一比图标大的东西是时钟。有几十个应用程序可以替代标准时钟，包括至少一个开源选项，您可以从中获取一些相关代码。

[WinCalendartime](http://sourceforge.net/projects/wincalendartime/)

            回答 #2

赞同：0

时间：2012-01-27T19:58:40.040

我猜你需要使用 Band Objects。你不会使用系统托盘，但是你会得到你需要的功能（我猜是 Windows Quick Launch 或 Windows Media Player 之类的东西）。

这是一篇关于它的好文章。我现在正在研究它。[http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx?msg=3230393#xx3230393xx](http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx?msg=3230393#xx3230393xx)

[]的

        c# - 将接收到的对象投射到列表中 or IEnumerable
I'm trying to perform the following cast
private void MyMethod(object myObject) { if(myObject is IEnumerable) { List<object> collection = (List&lt
问问题
Sergio Romero
问问题 2009-03-10T22:42:38.103
241640 次
This question shows research effort; it is useful and clear
78
This question does not show any research effort; it is unclear or not useful
Bookmark this question.
Show activity on this post.
I'm trying to perform the following cast
private void MyMethod(object myObject) { if(myObject is IEnumerable) { List<object> collection = (List<object>)myObject; ... do something } else { ... do something } }
But I always end up with the following excepction:
Unable to cast object of type 'System.Collections.Generic.List1[MySpecificType]' to type 'System.Collections.Generic.List1[System.Object]'
I really need this to work because this method needs to be very generic to receive single objects and collections both of unspecified types.
Is this possible, or is there another way of accomplishing this.
Thank you.
How about
List<object> collection = new List<object>((IEnumerable)myObject);
c#.net
4
9 回答 9
This answer is useful
95
C# 4 will have covariant and contravariant template parameters, but until then you have to do something nongeneric like
IList collection = (IList)myObject;
于 2009-03-10T22:51:18.143 回答
This answer is useful
77
You can't cast an IEnumerable<T> to a List<T>.
But you can accomplish this using LINQ:
var result = ((IEnumerable)myObject).Cast<object>().ToList();
于 2009-03-10T22:50:26.510 回答
This answer is useful
11
Problem is, you're trying to upcast to a richer object. You simply need to add the items to a new list:
if (myObject is IEnumerable) { List<object> list = new List<object>(); var enumerator = ((IEnumerable) myObject).GetEnumerator(); while (enumerator.MoveNext()) { list.Add(enumerator.Current); } }
于 2009-03-10T22:57:32.780 回答
This answer is useful
10
Do you actually need more information than plain IEnumerable gives you? Just cast it to that and use foreach with it. I face exactly the same situation in some bits of Protocol Buffers, and I've found that casting to IEnumerable (or IList to access it like a list) works very well.
于 2009-03-10T22:54:44.220 回答
This answer is useful
9
This Code worked for me
List<Object> collection = new List<Object>((IEnumerable<Object>)myObject);
于 2016-11-29T13:33:23.150 回答
This answer is useful
6
怎么样
List<object> collection = new List<object>((IEnumerable)myObject);
于 2009-03-10T22:48:31.147 回答
This answer is useful
3
Have to join the fun...
private void TestBench() { // An object to test string[] stringEnumerable = new string[] { "Easy", "as", "Pi" }; ObjectListFromUnknown(stringEnumerable); } private void ObjectListFromUnknown(object o) { if (typeof(IEnumerable<object>).IsAssignableFrom(o.GetType())) { List<object> listO = ((IEnumerable<object>)o).ToList(); // Test it foreach (var v in listO) { Console.WriteLine(v); } } }
于 2017-03-08T20:26:55.417 回答
This answer is useful
1
Nowadays it's like:
var collection = new List<object>(objectVar);
于 2020-12-24T09:26:55.987 回答
This answer is useful
0
You need to type cast using as operator like this.
private void MyMethod(object myObject) { if(myObject is IEnumerable) { List<object> collection = myObject as(List<object>); ... do something } else { ... do something } }
于 2017-05-15T07:49:28.737 回答
Related
2
javascript - 第二张图片滑动不适用于javascript
1
javascript - 页面刷新后对话框显示为 div
6
android - 在命令行过滤 Logcat 日志
1
objective-c - 更改模态 UIActivityViewController 的外观
3
php - Laravel 中的模板登录视图
1
.net - .NET JsonReaderWriterFactory 读取错误
2
ajax - 无法序列化包含用于 Ajax 调用的 tinymce 编辑器的表单
2
c# - 从 C# 在 Outlook 中打开特定的 MailItem
1
multicast - 使用 UPnP 的多播事件
1
php - 选中 PHP MYSQL 复选框
Reference
php × 1429865
c/c++ × 756500
nginx × 49975
mongodb × 159057
mybatis × 3233
anaconda × 13410
pycharm × 14671
python × 1902243
vscode × 56040
docker × 110988
github × 49000
flask × 49129
ffmpeg × 24037
jmeter × 16910
matplotlib × 63493
bootstrap × 54641

ID：632570

赞同：78

时间：

标签：c#, .net

I'm trying to perform the following cast  

```
private void MyMethod(object myObject)  
{  
    if(myObject is IEnumerable)  
    {
        List<object> collection = (List<object>)myObject;  
        ... do something   
    }  
    else  
    {  
        ... do something  
    }  
} 
```

But I always end up with the following excepction:  

Unable to cast object of type 'System.Collections.Generic.List`1[MySpecificType]' to type 'System.Collections.Generic.List`1[System.Object]'  

I really need this to work because this method needs to be very generic to receive single objects and collections both of unspecified types.  

Is this possible, or is there another way of accomplishing this.  

Thank you.

            回答 #1

赞同：95

时间：2009-03-10T22:51:18.143

C# 4 will have covariant and contravariant template parameters, but until then you have to do something nongeneric like

```
IList collection = (IList)myObject; 
```

            回答 #2

赞同：77

时间：2009-03-10T22:50:26.510

You can't cast an IEnumerable<T> to a List<T>.

But you can accomplish this using LINQ:

```
var result = ((IEnumerable)myObject).Cast<object>().ToList(); 
```

            回答 #3

赞同：11

时间：2009-03-10T22:57:32.780

Problem is, you're trying to upcast to a richer object. You simply need to add the items to a new list: 

```
if (myObject is IEnumerable)
{
   List<object> list = new List<object>();
   var enumerator = ((IEnumerable) myObject).GetEnumerator();
   while (enumerator.MoveNext())
   {
      list.Add(enumerator.Current);
   }
} 
```

            回答 #4

赞同：10

时间：2009-03-10T22:54:44.220

Do you actually need more information than plain `IEnumerable` gives you? Just cast it to that and use `foreach` with it. I face exactly the same situation in some bits of Protocol Buffers, and I've found that casting to `IEnumerable` (or `IList` to access it like a list) works very well.

            回答 #5

赞同：9

时间：2016-11-29T13:33:23.150

This Code worked for me

```
List<Object> collection = new List<Object>((IEnumerable<Object>)myObject); 
```

            回答 #6

赞同：6

时间：2009-03-10T22:48:31.147

怎么样

```
List<object> collection = new List<object>((IEnumerable)myObject); 
```

            回答 #7

赞同：3

时间：2017-03-08T20:26:55.417

Have to join the fun...

```
 private void TestBench()
    {
        // An object to test
        string[] stringEnumerable = new string[] { "Easy", "as", "Pi" };

        ObjectListFromUnknown(stringEnumerable);
    }

    private void ObjectListFromUnknown(object o)
    {
        if (typeof(IEnumerable<object>).IsAssignableFrom(o.GetType()))
        {
            List<object> listO = ((IEnumerable<object>)o).ToList();
            // Test it
            foreach (var v in listO)
            {
                Console.WriteLine(v);
            }
        }
    } 
```

            回答 #8

赞同：1

时间：2020-12-24T09:26:55.987

Nowadays it's like:

```
var collection = new List<object>(objectVar); 
```

            回答 #9

赞同：0

时间：2017-05-15T07:49:28.737

You need to type cast using **as** operator like this.

```
private void MyMethod(object myObject)  
{  
if(myObject is IEnumerable)  
{
    List<object> collection = myObject as(List<object>); 
    ... do something   
}  
else  
{  
    ... do something  
}  
} 
```

        python - 如何调试文件上传？

ID：632577

赞同：1

时间：2009-03-10T22:43:51.440

标签：python, post, upload, urllib2

我正在尝试使用 Python 脚本使用 Hot Banana 的内容管理系统将 PDF 文件上传到网站。我已成功登录该站点并可以注销，但我似乎无法正常上传文件。  

文件上传是大型复杂网络表单的一部分，该表单通过 POST 提交表单数据和 PDF 文件。使用 Firefox 以及 Firebug 和 Tamper Data 扩展，我查看了浏览器在 POST 中发送的内容以及它的去向。我相信我模仿了浏览器在代码中发送的数据，但我仍然遇到问题。  

我正在导入 cookielib 来处理 cookie、poster 来编码 PDF，以及 urllib 和 urllib2 来构建请求并将其发送到 URL。  

注册海报开瓶器是否有可能破坏 cookie 处理器开瓶器？我这样做完全错了吗？

编辑：调试过程的好方法是什么？目前，我只是将 urllib2 响应转储到文本文件并检查输出以查看它是否与我手动上传文件时得到的匹配。  

编辑 2：Chris Lively 建议我发布我遇到的错误。来自 urllib2 的响应不会产生异常，而只是返回：

```
<script>
    if (parent != window) { 
        parent.document.location.reload(); 
    } else { 
        parent.document.location = 'login.cfm'; 
    }
</script> 
```

我会坚持下去的。  

            回答 #1

赞同：1

时间：2009-03-11T03:42:05.747

像[WireShark](http://www.wireshark.org/)这样的工具将在比 firefox 插件低得多的级别上为您提供更完整的跟踪。

通常这可能很简单，比如没有正确设置内容类型，或者没有包含内容长度。

            回答 #2

赞同：0

时间：2009-03-11T01:54:55.677

您最好对服务器进行检测以查看失败的原因，而不是尝试在客户端进行调试。

            回答 #3

赞同：0

时间：2009-03-11T13:09:28.190

**“调试 [Web 服务] 进程的好方法是什么？”**

*目前，我只是将 urllib2 响应转储到文本文件并检查输出以查看它是否与我手动上传文件时得到的匹配。*

正确的。这就是全部。

HTTP 是一个非常简单的协议——你发出一个请求（在这种情况下是 POST），服务器就会响应。在调试时没有太多其他事情可以做。

你还想要什么？严重地。您认为这种无状态协议可能存在什么样的调试器？  

        c# - 类设计——属性还是参数？

ID：632583

赞同：5

时间：2009-03-10T22:47:29.777

标签：c#, class-design

我正在设计一个类...

有些关键方法需要将对象传递给它们，或者它们需要能够“获取”对象。

所以问题是，您应该使用 getter/setter 还是直接将对象作为参数发送给方法 - 以便方法正常工作。还是应该通过构造函数设置对象，如果它们对类的正确运行非常重要？

            回答 #1

赞同：8

时间：2009-03-10T22:52:02.777

如果在没有特定对象的情况下拥有此类的实例没有意义（例如，在没有与数据库的连接的情况下构造数据访问类可能没有意义），那么它是一个“依赖关系”并且应该是一部分的构造函数。

如果您的类可以在没有它的情况下生存，或者可以使用一些默认值，那么您可以改为将其设为属性并在使用之前检查它是否已分配。

在大多数情况下，我强烈主张构造函数依赖注入。

            回答 #2

赞同：5

时间：2009-03-10T22:54:23.643

问题不在于它们有多“关键”（根据定义，每种方法都需要拥有所需的数据）。一个更好的问题是它们多久改变一次。如果每次调用方法时它们都不同（或至少合理地可能）它们应该是参数。如果预计它们在对象的生命周期（或其中很大一部分）内通常是相同的，则它们应该与对象一起存储。

在后一种情况下，不要*仅仅*依赖于调用 setter 的用户。如果需要它们，即使它们可以通过设置器更改，也应该在构造函数中设置它们。

            回答 #3

赞同：3

时间：2009-03-11T11:28:59.477

正如您所提到的，您有以下三个选项：

**使用 getter/setter**

As you might know, get/set will indicate a state of the object, that is accessed multiple times(generally) during the object lifetime. So if you have a scenario like 'CrucialMethod1' to 'CrucialMethodN' consuming this state then this could be used. Additionally, this will also help in exposing the state externally. 

**Use as parameter to constructor**

Generally, a parameter to the constructor will 'dictate' the state into which the object will be initialized. So if you have a scenario where the 'CrucialMethod' may or may not be called, then this would not be most appropriate.

**Use as parameter to the method**

This would be useful in the scenario when the 'CrucialMethod' acts/transforms(depends) on the parameters passed. This facilitates calling the method without dependency on the state of the parameter being.

Your call!

            回答 #4

赞同：1

时间：2009-03-10T22:52:58.453

如果类正确运行需要它们，则应在构造函数中要求它们或将它们设置在其中。

至于通过与否。我更喜欢当班级可以照顾自己的时候，让它完成工作并得到它需要的东西。

        .net - 如何与 .NET 3.5 SP1 引导程序通信

ID：632587

赞同：2

时间：2009-03-10T22:47:51.803

标签：.net, .net-3.5, deployment

我正在为我的 .NET 3.5 SP1 WPF 应用程序构建一个自定义 Windows 安装程序包。我希望它检测客户端计算机上安装的 .NET 框架的版本（如果有），然后如果他们没有，则自动从 Microsoft 下载它。

现在，我已经阅读了有关 .NET 引导程序的信息，甚至在我制作的 ClickOnce 安装程序中看到了它的运行情况。它似乎正是我需要的。

问题是，我不想使用 ClickOnce。我偏爱NSIS。所以基本上我正在寻找一些关于如何以某种方式与引导程序进行通信或集成的文档，以便我可以在我自己的安装程序中利用它。但我没有找到太多。

任何帮助将不胜感激。

谢谢，史蒂夫

            回答 #1

赞同：3

时间：2009-03-10T22:53:41.213

你会想要这样的东西[，](http://nsis.sourceforge.net/Get_.NET_Version)除非我用过它，它最多只能正确检测到 2 个。我现在在家，但是当我开始工作时，我会发布我对这段代码的破解，以使其能够在 3.5 SP1 中运行。他们稍微改变了版本号的位置。

编辑：[在 pastebin 上发布我的版本](http://pastebin.com/f74773cf4)

            回答 #2

赞同：0

时间：2009-03-10T22:53:23.787

我认为您实际上无法与引导程序进行交流。我的理解是你定义了先决条件，它会根据需要安装它们。我一直使用 MSbuild [GenerateBootstrapper](http://msdn.microsoft.com/en-us/library/ms164294.aspx)来做到这一点。

```
<ItemGroup>
    <BootstrapperFile Include="Microsoft.Net.Framework.2.0">
        <!--This requires the either the Platform SDK or VS.Net to be installed-->
        <ProductName>Microsoft .NET Framework 2.0</ProductName>
    </BootstrapperFile>
</ItemGroup>

    <!--Create the bootstrapper-->
    <GenerateBootstrapper
         ApplicationName="MyApp"
         ApplicationFile="MyApp.msi"
         ApplicationUrl="$(ApplicationUrl)"
         BootstrapperItems="@(BootstrapperFile)"
         Culture="en"
         CopyComponents="True"

         ComponentsLocation="Relative"
         OutputPath="$(InstallationPath)\"/> 
```

        ruby-on-rails - Rails：无法访问日志文件

ID：632592

赞同：14

时间：2009-03-10T22:49:01.333

标签：ruby-on-rails, linux, capistrano, mongrel

重新启动我的 Rails 应用程序时出现以下错误。我以前遇到过这个问题，在另一台服务器上使用另一个应用程序，但不记得问题是什么，或者我是如何解决的。

```
Rails Error: Unable to access log file. Please ensure that /apps/staging/releases/20090310162127/log/staging.log exists and is chmod 0666\. The log level has been raised to WARN and the output directed to STDERR until the problem is fixed. 
```

我正在 Ubuntu 上使用 capistrano 部署到一个杂种集群。

当我做`ls -l /apps/staging/releases/20090310162127/log/staging.log`

结果是：

```
-rw-rw-rw- 1 me grp 51 Mar 10 16:07 /apps/staging/releases/20090310162127/log/staging.log 
```

日志目录是`link`/apps/staging/shared/log 的一个目录。

这是怎么回事？

            回答 #1

赞同：27

时间：2009-03-11T00:56:52.977

原来是一个微妙的 rails 错误：

在这两行中引发异常时

```
logger = ActiveSupport::BufferedLogger.new(configuration.log_path)
logger.level = ActiveSupport::BufferedLogger.const_get(configuration.log_level.to_s.upcase) 
```

rails 假定它找不到日志文件。然而，实际的错误发生在第二行：一个 NameError 因为常量不正确。原因是我的配置文件中有一个旧的日志级别：

```
config.log_level = Logger::INFO 
```

Rails 2.2 使用自己的记录器，不理解上面的行。

解决方案：删除线，或使用：

```
config.log_level = :info 
```

            回答 #2

赞同：0

时间：2009-03-10T23:05:33.553

Rails 是否运行`me`？如果不是，它以什么用户身份运行？是那个用户`jail`吗？`/apps/staging/shared/log`用户是否对 的所有组件以及 的所有组件具有遍历权限`/apps/staging/releases/20090310162127/log`？

        c# - Linq to Sql - 日期时间格式 - YYYY-MMM（2009 年 3 月）

ID：632606

赞同：4

时间：2009-03-10T22:52:08.877

标签：c#, sql-server, linq

我想编写一个 Linq to Sql 查询，它按用户名和日期时间进行计数和分组。我希望 DateTime 的格式类似于“YYYY-MMM”（即 2009-Mar）。

我认为这可行，但 Linq to Sql 无法解析 ToString“格式”参数。

```
 dc.MyTable
              .GroupBy(r => new
              {
                  Name = r.UserName,
                  YearMonth = r.SomeDateTime.ToString("yyyy-MMM")
              })
              .Select(r => new
              {
                  Name = r.UserName,
                  YearMonth = r.YearMonth,
                  Count = r.Count()
              })
              .OrderBy(r => r.YearMonth)
              .ThenBy(r => r.Name); 
```

有没有人有任何想法/建议？

谢谢。

            回答 #1

赞同：5

时间：2009-03-10T23:01:07.793

我想知道你是否不应该这样做“漫长”的方式......

```
 dc.MyTable
          .GroupBy(r => new
          {
              Name = r.UserName,
              Year = r.SomeDateTime.Year,
              Month = r.SomeDateTime.Month
          })
          .Select(r => new
          {
              Name = r.UserName,
              Year = r.Year,
              Month = r.Month,
              Count = r.Count()
          })
          .OrderBy(r => r.Year)
          .ThenBy(r => r.Month)
          .ThenBy(r => r.Name); 
```

如果您需要将格式作为字符串，请稍后在 UI 中执行此操作。通过重建`DateTime`等，或使用`CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(...)`.

            回答 #2

赞同：3

时间：2009-03-10T22:59:05.847

我会避免在数据库中将任何内容变成字符串。`r.SomeDateTime.Year`按and分组`r.SomeDateTime.Month`，按年、月和名称排序，分别选择年和月（连同计数），然后如果您需要在客户端代码中进行字符串格式的投影。

顺便说一句，我怀疑你的第二个`OrderBy`应该是`ThenBy`- 目前`Name`实际上是你订购的*最重要的东西。*

        mod-rewrite - 更多 Mod_rewrite 问题

ID：632608

赞同：0

时间：2009-03-10T22:52:27.360

标签：mod-rewrite

好的，有一个客户拥有来自搜索营销的现有链接。我正在将程序从 Cold Fusion 迁移到 PHP。

```
RewriteEngine on
RewriteRule ^cat_ap~([^~]+)~(.*)\.htm$ /urban/cat_ap.php?$1=$2 [R] 
```

目前我有一个 URL 结构：

```
http://www.test.com/urban/cat_ap~nid~5964.htm 
```

上面的重写规则更改为

```
http://www.test.com/urban/cat_ap.php?nid=5964 
```

现在我希望能够从查询字符串中获取变量，但将浏览器中的 url 保持为原始[http://www.test.com/urban/cat_ap~nid~5964.htm](http://www.test.com/urban/cat_ap~nid~5964.htm)但仍然可以访问PHP 页面。

这样当有人去`http://www.test.com/urban/cat_ap~nid~5964.htm`  它实际上去`http://www.test.com/urban/cat_ap.php?nid=5964`但仍然显示`http://www.test.com/urban/cat_ap~nid~5964.htm`。

关于如何做到这一点的任何想法？

谢谢

麦克风

            回答 #1

赞同：0

时间：2009-03-10T23:01:25.983

您已经在此行执行此操作（但将 R 标志更改为 L）：

```
RewriteRule ^/urban/cat_ap~([^~]+)~(.*).htm$ /urban/cat_ap.php?$1=$2 [L] 
```

用户点击的 URL 仍将显示为 .htm 版本，而服务器将其处理为 .php

            回答 #2

赞同：0

时间：2009-03-10T23:10:50.843

该[`R`标志](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriteflags)显式诱导外部重定向。所以只需删除`R`标志。

            回答 #3

赞同：0

时间：2009-03-10T23:12:10.917

我认为您需要设置反向代理以实现所需的行为，并将 P 标志与您的重写规则一起使用。我以前用过这种配置的网站，所以可以说它可以工作，但恐怕我自己从来没有配置过:-(

一个好的第一步至少是安装 mod_proxy 并让它加载和运行。P 标志上的[mod_rewrite 食谱页面](http://rewrite.drbacchus.com/rewritewiki/Flags_2fP)有少量关于代理 RewriteRules 的详细信息，并链接到 apache.org 上的 ProxyPassReverse 指令文档。  

        winapi - Win32：判断stdout句柄是char还是wchar流

ID：632611

赞同：3

时间：2009-03-10T22:53:30.027

标签：winapi, char, pipe, wchar-t

我正在为我们的产品编写一个 win32 实用程序函数，该函数需要通过 shell 调用任意程序并记录其输出。我们通过将标准输出从子进程重定向到管道来做到这一点：

```
 saAttr.nLength = sizeof(SECURITY_ATTRIBUTES); 
    saAttr.bInheritHandle = TRUE; 
    saAttr.lpSecurityDescriptor = NULL; 

    CreatePipe(&hReadPipe, &hWritePipe, &saAttr, 0);

    // Redirect the first process stdout to our write pipe
    // so that we can read its output from the read pipe.
    startUpInfo.dwFlags = STARTF_USESTDHANDLES;
    startUpInfo.hStdInput = GetStdHandle(STD_INPUT_HANDLE);
    startUpInfo.hStdOutput = hWritePipe;
    startUpInfo.hStdError = GetStdHandle(STD_ERROR_HANDLE);

    CreateProcessA(NULL, szCmdLine, NULL, NULL, TRUE, NORMAL_PRIORITY_CLASS, NULL, NULL, &startUpInfo[i], &procInfo); 
```

可以这样调用的程序种类繁多，其中许多不在我们的控制之下。目前我们看到一个问题，许多程序的输出在第一个字符之后似乎被截断——通常是一个确定的信号，表明 WCHAR 字符串被错误地用作 CHAR。

如何判断子进程是作为 CHAR 还是 WCHAR 写入其 stdout 管道？

            回答 #1

赞同：3

时间：2009-03-11T00:03:46.020

底线是没有 100% 可靠的方法来做到这一点。进程的输入/输出句柄不是特定于编码的。它们只是对字节流进行操作。一个进程完全有可能先写一段 ASCII，然后再切换到 Unicode。  

不幸的是，不可能以 100% 的准确率从字节流中分辨出底层编码是什么。确定这一点的唯一方法是有一个握手协议，该过程会告诉您它将使用什么编码。在这种情况下可能不是一个选择。  

关于主题的链接

*   [如何检测文本文件的编码/代码页](https://stackoverflow.com/questions/90838/how-can-i-detect-the-encodingcodepage-of-a-text-file)
*   [http://blogs.msdn.com/oldnewthing/archive/2004/03/24/95235.aspx](http://blogs.msdn.com/oldnewthing/archive/2004/03/24/95235.aspx)

            回答 #2

赞同：1

时间：2009-03-10T23:05:16.050

我认为您必须在连接时进行协商。您可以使用[PeekNamedPipe()](http://msdn.microsoft.com/en-us/library/aa365779(VS.85).aspx)并根据它是否看起来像 unicode 字符进行猜测...

        symfony1 - 如何从 Symfony 1.0 中的夹具 YML 生成 SQL？

ID：632617

赞同：1

时间：2009-03-10T22:56:35.370

标签：symfony1

我正在尝试构建一个脚本来自动化 symfony 项目的更新过程。例如，将任何补丁从一个修订版应用到另一个修订版，包括任何可能的模型更新和新夹具，而无需重新加载整个数据库。

我已经完成了大部分工作，但是我一直无法找到一种方法来生成包含 INSERT 语句的 SQL 文件，这些语句在插入夹具时由推进加载数据执行。

我知道我可以转储数据库以获取信息，但这不是重点，这在我的情况下不起作用，因为我需要一个没有其他数据的空数据库。

简而言之，我的问题是：有没有办法采用夹具 YML 并生成必要的 SQL 插入？

我知道这可以通过处理 yml 和构建逻辑来完成，但是构建过程它在某处完成它并且没有理由再次编写它..

任何帮助将非常感激。

            回答 #1

赞同：0

时间：2009-03-16T07:04:41.270

也许我没有正确理解您的问题，但是您不能只调用将固定装置加载到数据库中的任务，或者编写调用 sfPropelData::loadData() 的代码（我在这里假设 Propel）。

```
$loader = new sfPropelData();
$loader->loadData(sfConfig::get('sf_data_dir').'/fixtures'); 
```

即使 sfPropelData 及其父 sfData 在加载夹具时也不会生成 sql 代码，而是使用 ORM 来生成（如[sfPropelData::loadDataFromArray()](http://trac.symfony-project.org/browser/branches/1.0/lib/addon/propel/sfPropelData.class.php#L60)所示。

如果您更多地解释您的问题，以及为什么这个解决方案还不够，我可能会提供帮助。

        windows - Listviews上的ImageList透明度？

ID：632622

赞同：3

时间：2009-03-10T23:00:14.380

标签：windows, winapi, transparency

**编辑：**我提供了赏金，因为我怀疑否则我会得到任何答案。

最近我一直在使用列表视图，我决定为每个项目添加一个**图标**，指示它是输入还是输出。图标添加得很好，但它们不透明：

![图标不透明的示例](https://i.stack.imgur.com/o9Gzq.png)

可以看出，图标显然不是透明的。我目前正在做这样的事情加载图标：

```
 hImageList = ImageList_Create(16, 16, ILC_MASK | ILC_COLOR32, 2, 2);
  if (hImageList != NULL)
  {
    iIN  = ImageList_AddIcon(hImageList, LoadIcon(hInstance, MAKEINTRESOURCE(101)));
    iOUT = ImageList_AddIcon(hImageList, LoadIcon(hInstance, MAKEINTRESOURCE(102)));
  } 
```

我试过弄乱`ImageList_Create`& `LoadIcon`/的标志，`LoadImage`但没有运气，老实说我已经没有想法了。

任何帮助将不胜感激。

            回答 #1

赞同：13

时间：2009-03-13T08:36:11.890

首先，ImageList_ReplaceIcon 在将图标数据添加到图像列表时复制它。所以HICON需要事后发布。

接下来，图像列表本身就是位图，而不是图标。而且您创建图像列表的方式使图标到位图的转换非常模糊。ILC_COLOR32 意味着图像列表应创建为 32 位 dib 部分，通常包含通过嵌入的 alpha 通道的透明度信息。ILC_MASK 暗示内部位图是 DDB 位图，透明度信息存储为 1bpp 掩码位图。

解决您问题的最快方法 - 带上您的两个图标：

*   将它们合并成一个 32 像素宽 x 16 高像素的位图资源。用蒙版颜色填充背景： - 紫色或其他东西。
*   使用 ILC_COLOR|ILC_MASK 创建位图
*   加载位图确保不使用 LR_TRANSPARENT。
*   使用 ImageList_AddMasked 添加位图，传入一个表示遮罩颜色的 COLORREF。

或者，为了更好的视觉效果...

*   将您的 PNG 数据导出为 32x16 32bpp 位图文件，其中包含预乘的 Alpha 通道数据。
*   使用 ILC_COLOR32 值创建图像列表。
*   带有 LR_CREATEDIBSECTION 的 LoadImage() 将位图加载为 32bpp dib 部分。
*   使用 ImageList_Add() 添加图像

（最后一个选项有点棘手，因为支持写出具有适当预乘 Alpha 通道的 32 位 bmp 文件的工具数量相当少）。

编辑添加以下代码示例。使用在开发环境中创建的 4bpp 位图效果很好：-

```
HWND hwndCtl = CreateWindowEx(0,WC_LISTVIEW,TEXT("ListView1"),WS_CHILD|WS_VISIBLE|WS_HSCROLL|WS_VSCROLL,0,0,cx,cy,hWnd,(HMENU)101,hModule,NULL);
HBITMAP hbm = (HBITMAP)LoadImage(hModule,MAKEINTRESOURCE(IDB_BITMAP1),IMAGE_BITMAP,0,0,0);
COLORREF crMask=RGB(255,0,255);
HIMAGELIST himl = ImageList_Create(16,16,ILC_COLOR|ILC_MASK,2,0);
ImageList_AddMasked(himl,hbm,crMask);
ListView_SetImageList(hwndCtl,himl,LVSIL_NORMAL); 
```

            回答 #2

赞同：0

时间：2009-03-10T23:02:54.700

您想让您的图标具有图标中其他任何地方都没有使用的背景颜色，例如非常难看的紫色，然后使用 LoadImage(..., LR_LOADTRANSPARENT); 标志说查看 0,0 处的第一个像素并使所有颜色透明。

            回答 #3

赞同：0

时间：2009-03-13T05:00:10.007

您的代码对我来说看起来不错，我总是使用 LoadImage 而不是 LoadIcon 但我怀疑这并不重要。您是否检查过图标确实具有透明区域并且本身没有纯色背景？

我的 LoadImage 调用如下所示：

```
HICON hIcon = (HICON)LoadImage(hinstResources,MAKEINTRESOURCE(IDI_ICON),IMAGE_ICON,16,16,LR_DEFAULTCOLOR); 
```

            回答 #4

赞同：0

时间：2009-03-18T22:03:54.063

在这里...按照建议创建一个 ImageList，将您的图标制作成一个 16 像素高、16*n 长的位图，其中 n= 图标的数量...

将背景颜色设置为 255、0、255，就像您所做的那样。

然后，加载它，并将其添加到图像列表中，就像我在这里所做的那样：

```
 m_ImageList.Create(16, 16, ILC_COLOR16 | ILC_MASK, 7, 1);
 CBitmap bm;
 bm.LoadBitmap(IDB_SUPERTREEICONS);
 m_ImageList.Add(&bm, RGB(255, 0, 255));
 GetTreeCtrl().SetImageList(&m_ImageList, TVSIL_NORMAL); 
```

当然，这是用 MFC 编写的，但如您所知，它只是 Win32 的包装器......

除此之外，您将不得不使用自定义绘制控件，在该控件中，您可以在图标恰好位于的任何背景上绘制图标。据我所知，在这些控件中实际上没有任何神奇的“透明”颜色。

在自定义绘图的情况下，您需要使用如下代码：

```
#define TRANSPARENT_COLOR (255,0,255)

UINT iBitmap = IDB_ICON_UP
CDC *dc = GetDC();
int x = 0, y = 0;

    CDC *pDisplayMemDC = new CDC;
    CDC *pMaskDC = new CDC;
    CDC *pMemDC = new CDC;
    CBitmap *pBitmap = new CBitmap;
    CBitmap *pMaskBitmap = new CBitmap;
    CBitmap *pMemBitmap = new CBitmap;
    int cxLogo, cyLogo;
    BITMAP bm;

    pBitmap->LoadBitmap(iBitmap);
    pDisplayMemDC->CreateCompatibleDC(dc);
    CBitmap *pOldBitmap = (CBitmap *)pDisplayMemDC->SelectObject(pBitmap);

    pBitmap->GetObject(sizeof(bm), &bm);
    cxLogo = bm.bmWidth;
    cyLogo = bm.bmHeight;

    pMaskBitmap->CreateBitmap(cxLogo, cyLogo, 1, 1, NULL);
    pMaskDC->CreateCompatibleDC(dc);
    CBitmap *pOldMask = (CBitmap *)pMaskDC->SelectObject(pMaskBitmap);
    COLORREF oldBkColor = pDisplayMemDC->SetBkColor(TRANSPARENT_COLOR);
    pMaskDC->BitBlt(0, 0, cxLogo, cyLogo, pDisplayMemDC, 0, 0, SRCCOPY);

    pMemBitmap->CreateCompatibleBitmap(dc, cxLogo, cyLogo);
    pMemDC->CreateCompatibleDC(dc);
    CBitmap *pOldMem = (CBitmap *)pMemDC->SelectObject(pMemBitmap);

    pMemDC->BitBlt(0, 0, cxLogo, cyLogo, dc,            x, y, SRCCOPY);
    pMemDC->BitBlt(0, 0, cxLogo, cyLogo, pDisplayMemDC, 0, 0, SRCINVERT);
    pMemDC->BitBlt(0, 0, cxLogo, cyLogo, pMaskDC,       0, 0, SRCAND);
    pMemDC->BitBlt(0, 0, cxLogo, cyLogo, pDisplayMemDC, 0, 0, SRCINVERT);
        dc->BitBlt(x, y, cxLogo, cyLogo, pMemDC,        0, 0, SRCCOPY);

    delete pMemDC->SelectObject(pOldMem);
    delete pMemDC;

    delete pMaskDC->SelectObject(pOldMask);
    delete pMaskDC;

    delete pDisplayMemDC->SelectObject(pOldBitmap);
    delete pDisplayMemDC; 
```

此代码决定在哪里绘制图标，并拍摄背景快照，为图标创建蒙版，然后将其绘制在背景上，使其成为完全透明的背景......

希望能有所帮助。如果没有，请更详细地解释您要实现的目标，以及您所看到的或未看到的...

        firefox - cookie 还是缓存？如果没有重新启动 FF，我自己的网站将无法加载到 FF

ID：632623

赞同：0

时间：2009-03-10T23:00:38.370

标签：firefox

在过去的几天里，我注意到（偶尔）在 FF 中测试我自己的网站时，它会在第一次打开 FF 时加载，但它似乎在后续加载时挂起（仅限 Windows - 我没有注意到mac 上的这种行为，但我不经常使用我的 mac）。

网址是[http://HearWhere.com](http://HearWhere.com)

当然，我担心的是，有时人们会尝试访问该站点但无法访问（根据我所看到的，这是一种明显的可能性，因为我已经看到过去几次统计数据显着下降天，所以我怀疑这可能会发生）。

知道为什么吗？我似乎无法弄清楚这一点。

我在尚未加载的页面上查看源代码，并且似乎所有源代码都在那里。

我能想到的可能导致问题的一件事是，在我的页眉和页脚中，我有一点 PHP，它根据访问域附加了正确的 API 密钥（这样我就不必费劲-将 api 密钥编码到页面中并将其从 dev 更改为 prod）。我用一个相当简单的

```
$domain=$_SERVER['SERVER_NAME'];
if($domain=='dev'){
    $apiKey='apikey';
}别的 {
    $apiKey='apikey2';
}

```

但是在查看源代码时，该节目似乎没有问题。我在页面底部做了一些类似的代码，所以我只在域不是 dev 时包含跟踪代码。

有任何想法吗？

更新  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - - ------------------- 在 Firebug 中检查后（不知道为什么我之前没有检查），以下两个 google 脚本失败，一切都停在那里. 该网站以地图/位置为中心，所以我需要谷歌的东西。知道为什么它会失败吗？这些是失败的脚本
[http://gg.google.com/csiv=2&s=mapsapi&action=jsloaderjslinker&rt=jsload.69,jseval.103,jsdone.105](http://gg.google.com/csiv=2&s=mapsapi&action=jsloaderjslinker&rt=jsload.69,jseval.103,jsdone.105) 
[http://gg.google.com/csi?v=2&s= mapsapi&action=apiboot&rt=d.2,e.316,ab1.336](http://gg.google.com/csi?v=2&s=mapsapi&action=apiboot&rt=d.2,e.316,ab1.336)

            回答 #1

赞同：2

时间：2009-03-11T01:04:58.680

你试过Firefox 的[Firebug](http://getfirebug.com/)插件吗？它可以帮助您调试一些脚本/网络/html 问题。

您可以[监控](http://getfirebug.com/net.html)脚本、图像和其他资源的加载时间。

祝你好运。

            回答 #2

赞同：0

时间：2009-03-11T19:52:00.283

看来这是/现在是 Firebug 的错误。禁用萤火虫解决了这个问题，所以它不应该影响太多的访问者。

谢谢你的帮助，皮特

        python - python服务器页面中的嵌套循环语法

ID：632624

赞同：1

时间：2009-03-10T23:00:48.510

标签：python, python-server-pages

我只是想写一个可以使用正则表达式解析一些文本并在表格中返回结果匹配的小网页。这是我第一次使用 python 进行 web 开发，不得不说，它看起来很乱。

我的问题是为什么我只获得数据集中最后一场比赛的输出？我认为这必须是因为嵌套循环的格式不正确。

这是我提供的数据：

groups 只是一个与正则表达式组相对应的 id，它的名称是为表提供标题。

模式类似于：

```
(\d+)\s(\S+)\s(\S+)$ 
```

和数据：

```
12345 SOME USER
09876 SOMEONE ELSE
54678 ANOTHER USER 
```

我的简单页面：

```
<%
import re
pattern = form['pattern']
p = re.compile(pattern)
data = form['data']

matches = p.finditer(data)

lines = form['groups'].split("\n")
groupids ={}
for line in lines:
  key, val = line.split(' ')
  groupids[int(key.strip())] = val.strip()

%>
<html>
<table style="border-width:1px;border-style:solid;width:60%;">
<tr>
<%
for k,v in groupids.iteritems():%>
<th style="width:30px;text-align:center"><%= v %></th>
<%
# end
%>
</tr>
<%
for match in matches:
  #begin
%><tr>
<%
for i in range(1, len(match.groups())+1):
  #begin
%>
  <td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;"><%= match.group(i) %></td>
<%
  #end
# end
%>
</tr>

</table>
</html> 
```

编辑

下面是我跑的测试

代码：

```
import re
pattern = "(\d\d\d\d\d)\s(\S+)\s(\S+)"

p = re.compile(pattern)

data = """12345 TESTS USERS
34567 TESTS USERS
56789 TESTS USERS"""

groups = """1 PIN
2 FNAME
3 LNAME"""

matches = p.finditer(data)

lines = groups.split("\n")

print lines
groupids ={}
for line in lines:
  key, val = line.split(' ')
  groupids[int(key.strip())] = val.strip()

for k,v in groupids.iteritems():
  print "%s\t" % v,
print ''

for match in matches:
  for i in range(1, len(match.groups())+1):
    print "%s\t" % match.group(i),
  print '' 
```

输出：

```
PIN     FNAME   LNAME
12345   TESTS   USERS
34567   TESTS   USERS
56789   TESTS   USERS 
```

            回答 #1

赞同：1

时间：2009-03-10T23:47:44.373

```
<%
for match in matches:
  #begin
%><tr>
<%
for i in range(1, len(match.groups())+1):
  #begin
%>
  <td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;"><%= match.group(i) %></td>
<%
  #end
# end
%> 
```

是的，你那里没有嵌套循环。相反，你有一个循环`matches`输出“<tr>\n”，然后是第二个循环`range(...)`，它只在第一个循环完成后运行。第二个不在第一个内部，因为它没有缩进这样说。

从[文档](http://www.modpython.org/live/mod_python-3.1.2b/doc-html/pyapi-psp.html)中，我*认为*您需要说的是：

```
<%
for match in matches:
    # begin
%><tr><%
    for group in match.groups():
        # begin
%><td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;"><%= group %></td><%
    # end
%></tr><%
# end
%> 
```

但我只能同意你的“混乱”评论：如果 PSP 要求你像这样折磨你的 HTML 的缩进以适应你的 Python 的结构，那真的是做错了，你应该寻找另一个不那么糟糕的模板句法。Python 有很多很多的模板语言，它们对控制结构有更合理的语法。作为一个例子，在我使用上面的那个看起来像：

```
<px:for item="match" in="matches"><tr>
    <px:for item="group" in="match.groups()">
        <td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;">
            <?_ group ?>
        </td>
    </px:for>
</tr></px:for> 
```

            回答 #2

赞同：0

时间：2009-03-10T23:15:05.123

我不确定与模板引擎的交互，但 python 会期望内部循环在包含循环下缩进。

尝试以这种方式格式化它，看看它是否有效。

```
<%
for match in matches:
    %><tr><%
    for i in range(1, len(match.groups())+1):
        %><td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;"><%= match.group(i) %></td><%
%> 
```

或者一些这样的。以上产生“IndentationError: unindent does not match any external indentation level”所以尝试：

```
<%
for match in matches:
    %><tr><%
    for i in range(1, len(match.groups())+1):
        %><td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;"><%= match.group(i) %></td><%

%> 
```

或者

```
<%
for match in matches:
    %><tr><%
    for i in range(1, len(match.groups())+1):
        %><td style="border-style:solid;border-width:1px;border-spacing:0px;text-align:center;"><%= match.group(i) %></td><%
pass
%> 
```

或某种组合。您的问题在于向 python 指示循环结束的位置。为此，您必须想办法让模板引擎生成具有正确缩进的有效 python。

此外，如果您可以获取生成的代码，您可以将问题分成两半：首先修改生成的代码以找出 python 将接受什么，然后修改模板以使其生成。

        c# - 对LINQ参数感到困惑

ID：632629

赞同：5

时间：2009-03-10T23:01:37.760

标签：c#, linq

我正在尝试了解 LINQ 并对使用它充满信心。我正在努力解决的是要求的参数。例子：

```
var sortedWords = words.OrderBy(a=>a.Length) 
```

`words`是一个数组集合。`OrderBy`的智能感知 说：

```
Func<string, TKey> keyselector 
```

A`func`执行一个方法，a`string`是值，`TKey`一个键。

在示例[http://msdn.microsoft.com/en-us/vcsharp/aa336756.aspx#thenBySimple（-Comparer](http://msdn.microsoft.com/en-us/vcsharp/aa336756.aspx#thenBySimple)）`ThenBy`中，我们通过说来比较长度`a => a.Length`。我理解这种语法，但这与智能感知的要求有什么关系？

由于所有泛型，我倾向于发现方法签名和智能感知不可读。

谢谢。

            回答 #1

赞同：6

时间：2009-03-10T23:18:39.297

如果您了解.NET/C#中[lambda 表达式](http://msdn.microsoft.com/en-us/library/bb397687.aspx)的性质，则该类型（由 Intellisense 显示）是有意义的。否则，对于新人来说，确实有点奇怪。首先考虑 keySelector 的类型*Func<TSource, TKey>*只是一个委托。在 C# 3.0 之前，您可以通过将委托作为参数传递来调用此类方法，例如：

```
IEnumerable<string> sortedWords = words.OrderBy(new Func<string, int>(mySelectorMethod)); 
```

其中 mySelectorMethod 是一个普通方法的名称，它接受一个*字符串*作为参数并返回一个*int*。（顺便说一句，我想你可以使用匿名委托，但我们现在不要去那里。）另外，请注意，这个例子纯粹是说明性的，因为 LINQ 几乎总是与 .NET 3.5/C# 3.0 一起使用（尽管我相信它可以与 .NET 2.0/C# 2.0 中的一个/两个一起使用——如果我错了，请有人纠正我）。从 C# 3.0 开始，可以将方法内联定义为 lambda 表达式，这些表达式旨在精确地用于此类情况。如果您想获得适当的介绍，请阅读有关 lambda 表达式的 MSDN 文章（上面链接），但在这里我将简单地描述在此特定上下文中的使用。正如您所说，您的代码（在 C# 3.0 中）类似于以下内容：

```
var sortedWords = words.OrderBy(a => a.Length); 
```

表达式的一部分`a => a.Length`是*lambda 表达式*，它实际上只是声明内联函数的简写。大多数情况下，lambda 表达式的语法非常简单。=> 左边的参数是指定的，通常形式为*(arg1, arg2, arg3)*，但由于在这种情况下只有一个，您可以省略括号。=> 的右侧是作为函数返回值的表达式（更准确地说是 lambda 表达式）。或者，您可以在 { 和 } 中使用 return 语句将实际代码括起来，尽管这通常是不必要的。我相信 C# 编译器所做的是将传递给 OrderBy 的参数识别为 lambda 表达式，然后将其编译为函数并为您创建和传递委托。请注意，lambda 表达式也可以转换为*System.Linq.Expressions.Expression*对象（可访问的表达式树）而不是委托，但这是一种不太常见的用法。无论如何，这里的幕后发生了很多事情，但希望这至少应该澄清为什么类型是*Func<TSource, TKey>*以及它与 lambda 表达式的关系。正如我所说，如果您想更深入地了解 LINQ/lambdas/delegates，请阅读 MSDN...

            回答 #2

赞同：5

时间：2009-03-11T02:36:28.150

```
a => a.Length 
```

我理解这种语法，但这与智能感知的要求有什么关系？

这段代码是一个 lambda 表达式。lambda 表达式是生成**Anonymous 方法**（在本例中）或 System.Linq.Expressions.Expression 的便捷方式。让我们按部分分解它。

*   最引人注目的特性是**=>**，它将参数与方法体分开。
*   **在=>**的左侧，有一个符号：**a**。这是我们匿名方法的参数声明。编译器知道我们正在调用 OrderBy()，并且 OrderBy 需要一个`Func<string, object>`. 此类函数的参数是字符串，因此编译器确定**a**必须是字符串。程序员唯一需要提供的是名字。
*   **在=>**的右侧，有方法体。由于这是单行代码，因此隐含了**return**关键字。IDE 提供针对**a**作为字符串的智能感知，它允许您使用 Length 属性。

现在，考虑一下这个 C# 2.0 ...

```
IEnumerable<string> sortedWords = 
  Enumerable.OrderBy(words, delegate(string a) {return a.Length;}); 
```

使用 C# 3.0

```
IEnumerable<string> sortedWords = words
  .OrderBy(a => a.Length); 
```

            回答 #3

赞同：1

时间：2009-03-10T23:20:16.373

我认为 IntelliSense 实际上非常有用，尤其是对于将`Func<..>`类型作为参数的泛型方法，因为您可以看到类型和类型指导您了解该方法可能会做什么。

例如，参数为`OrderBy`“ `IEnumerable<string>`this”参数，这意味着我们有一些包含字符串集合的输入。第一个参数`keySelector`有一个 type `Func<string, TKey>`，这意味着它是您提供的某个 lambda 表达式，用于指定如何`TKey`从`string`.

这已经表明该方法可能会枚举集合中的所有项目（字符串），并且它可以使用从集合中的每个元素`keySelector`获取类型的值。`TKey`该名称`TKey`已经表明它将使用此值来比较使用此计算键的元素（字符串）。但是，如果您查看另一个重载，`IComparer<TKey>`那么您可以确定这一点 - 此参数指定有关如何比较两个 type 值的更多详细信息`TKey`，因此该函数*必须*使用此键比较元素。

...这种对类型的思考需要一些时间来适应，但是一旦你学会了它，它就会非常有帮助。它在“函数式”代码风格中更有用，它经常在 C# 3.0 中使用大量泛型和 lamdba 表达式（以及 F# 或其他函数式语言中的类似内容）

            回答 #4

赞同：0

时间：2009-03-10T23:12:05.647

老实说，我从不真正担心 Intellisense。在我的 Linqage 中，我很早就搞砸了。随着我花更多时间在泛型和表达式上，它开始变得有意义，但在此之前我只是在语法上抽筋。

它需要的是一个 lambda 表达式，它告诉 Linq 为了对集合进行排序而查找什么。

我觉得你，我的兄弟，坚持下去，很快就会有意义。

            回答 #5

赞同：0

时间：2009-03-10T23:48:08.337

*`OrderBy()`*接受一个接受单个参数（在您的情况下是 a *`string`*）的函数的委托并返回一个被替换的类型的值*`TKey`*。可能是参数类型（字符串）已经确定，因为您在 an 上调用了该方法，但委托类型只有在完全指定时（即 ）从 lambda 表达式推断它*之后*`IEnumerable<string>`才会被解析。如果您没有向解析器提供任何关于您想要什么作为排序键的线索，它只会在 IntelliSense 中显示*TKey*，直到它可以确定预期的类型。`Func<string,` **`int`**`>` *`a => a.Length`* **# nhibernate - 枚举和休眠

> ID：632644
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-10T23:08:45.920
> 
>         
> 
> 标签：nhibernate

是否可以在 Nhibernate 中使用枚举？如果有怎么办？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-10T23:09:59.067

是的你可以。

在您的 XML 映射文件中

```
<property type="Namespace.EnumClass, Namespace" 
                            name="EnumValue" column="columnName"></property> 
```

[示例 1](http://codebetter.com/blogs/jeremy.miller/archive/2006/02/20/138732.aspx)

[示例 2](http://orand.blogspot.com/2006/12/generic-nhibernate-enum-string-mapping.html)

# c# - Quartz.net + NHibernate + Windsor.Castle + CommonServiceLocator

> ID：632649
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-10T23:10:29.410
> 
>         
> 
> 标签：c#, nhibernate, castle-windsor, quartz-scheduler

我有一个基于[Sharp-architecture](http://code.google.com/p/sharp-architecture/)框架的Web 应用程序。它实际上使用 NHibernate 作为 dal，并且我在 (VIEW-CONTROLLER) 和 DAL 之间添加了一个服务层。

我实际上需要实现一个调度程序来频繁地运行我的工作。我将使用**Quartz.net**来完成这项任务。其实我面临一个问题。因为我会有很多工作以不同的时间表运行，比如每 30 秒、每天、每周。

我想知道是否有办法在 Quartz 中使用服务注入来运行**NHibernate**，以及它是否支持作业并发，我的意思是如果两个作业**同时**运行，NHibernate 是否不会出现问题。**我知道 NHibernate 和multithreading**存在一些问题。

我找到了一个 Quartz.Net for Spring 的实现（[http://www.zorched.net/2009/03/07/using-quartznet-springnet-and-nhibernate-to-run-scheduled-tasks-in-aspnet/](http://www.zorched.net/2009/03/07/using-quartznet-springnet-and-nhibernate-to-run-scheduled-tasks-in-aspnet/)）以及 Castle-Windsor 的实现（[http://bugsquash.blogspot.com/2009/03/windsor-facility-for-quartznet.html](http://bugsquash.blogspot.com/2009/03/windsor-facility-for-quartznet.html)）。

问题是，我认为这个例子没有考虑到作业可以同时运行的情况，这是一个 Nhibernate 问题。而且我想使用更高级别的**CommonServiceLocator ，而不是将自己限制在一个****IoC**框架中。

**解决这个问题的最佳方法是什么？**

谢谢你的帮助

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T22:21:27.740

使用[NHibernate 设施](http://www.castleproject.org/container/facilities/trunk/nhibernate/index.html)，然后注入`ISessionManager`你`IJob`的 s. 这应该给你每个线程一个 ISession 并且你应该没有问题。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2011-11-21T07:59:09.997

请参阅此[http://docs.castleproject.org/Contrib.Quartz-Net-integration.ashx](http://docs.castleproject.org/Contrib.Quartz-Net-integration.ashx)

# design-patterns - 集合是否也应该负责创建对象？（单一职责模式）

> ID：632658
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-10T23:11:54.880
> 
>         
> 
> 标签：design-patterns, collections

对象集合是否也应该负责创建新对象？  

让我解释。我有两个类，PhoneCall 和 PhoneCallList。PhoneCallList 是 PhoneCall 对象的集合。我们的架构师和我在如何创建新的 PhoneCall 对象上存在分歧。目前，PhoneCall 对象有一个名为 Create 的方法，可以将记录添加到数据库中，而 PhoneCallList 对象有一个名为 Add 的方法，可以将一个 PhoneCall 添加到列表中。  

架构师希望 PhoneCallList 中的 Add 方法也在数据库中创建新记录并将其添加到集合中。这样做是否违反了单一责任原则？对我来说，感觉这不是解决这个问题的最佳方式。

最好的方法是什么？

*两个对象都不知道数据库。负责所有数据访问的呼叫服务。问题是 PhoneCall 或 PhoneCallList 对象是否应该调用进行数据访问的服务？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-10T23:25:31.620

关于上下文，我有很多不确定，但它看起来像两个问题。谁应该创建一个 PhoneCall 对象以及谁应该将一个 PhoneCall 添加到数据库中。我建议 PhoneCall 对象由操作 PhoneCallList 的任何更高级别的模块创建，并将其传递给 PhoneCallList 的“添加”函数。我也倾向于两个班级都没有做数据库条目。这听起来像是上三等课的一个很好的理由。

# gwt - gwt 文件上传

> ID：632669
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-10T23:18:11.653
> 
>         
> 
> 标签：gwt, file-upload

我想触发对隐藏 FileUpload 小部件上的浏览按钮的点击。以下代码在 IE 6+ 上运行良好，但在 FireFox 中不起作用。

```
final FileUpload upload = new FileUpload(); 

upload.setVisible(false);
upload.setName("uploadFormElement"); 
panel.add(upload);

panel.add( new Button("Select File", new ClickListener()
{ public void onClick(Widget pSender) 
{ jsClickUpload( upload.getElement() ); } }));

native void jsClickUpload( Element pElement ) /*-{ pElement.click(); }-*/; 
```

如何在 FireFox（可能还有其他浏览器）中实现相同的功能？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T12:45:40.103

解决方案可以在这里阅读：

[http://www.quirksmode.org/dom/inputfile.html](http://www.quirksmode.org/dom/inputfile.html)

在最后一段中：

> click() 方法允许您模拟对表单字段的单击。复选框被切换，收音机被选中，等等。不幸的是，Mozilla 和 Opera 没有将此方法添加到文件上传字段。我想知道为什么，添加它并不是真正的安全风险，因为可能发生的最坏情况是弹出文件选择窗口。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-10T23:38:01.060

您是否尝试过直接调用 onClick() 方法？

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2010-10-05T17:41:29.567

click 方法目前正在 FF 4 中实现。正在讨论将实现哪些安全规则，听起来它类似于 Window.open 并且必须是用户操作的直接结果，而不是定时器或负载。

# sql - 如何强制 MS SQL Server 执行索引连接？

> ID：632670
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-10T23:18:15.490
> 
>         
> 
> 标签：sql, sql-server, join, indexing, join-hints

我正在做一个任务，我应该比较 SQL Server 中的不同连接方法，即散列连接、合并连接和索引连接。

我很难让 SQL Server 执行索引连接。谁能告诉我如何强制它使用索引连接（使用连接提示或类似方法），或者只是简单地提供一个简单的查询，其中 SQL 服务器使用索引连接方法？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-11T04:42:17.863

您只有[循环、散列和合并连接 (BOL)](http://msdn.microsoft.com/en-us/library/ms173815(SQL.90).aspx)。没有索引连接。

[克雷格·弗里德曼 ( Craig Friedman) 关于 JOIN 的系列](http://blogs.msdn.com/craigfr/archive/2006/07/26/679319.aspx)比您需要知道的更多（他是为 SQL Server 设计关系引擎的团队之一）

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:03:22.840

您可以在直接选择上获得索引提示，但我不确定相同的语法是否可用于连接。

```
SELECT blah FROM table WITH (INDEX (index_name)) 
```

您可以在非 ansi (?) 连接中使用它

```
SELECT blah FROM TABLE1, TABLE2
WHERE TABLE2.ForiegnKeyID = TABLE1.ID
WITH (INDEX (index_name)) 
```

加入索引提示：

```
SELECT
    ticket.ticket_id
FROM
    purchased_tickets
JOIN   ticket WITH (INDEX ( ticket_ix3))
    ON ticket.original_ticket_id = purchased_tickets.ticket_id
       AND ticket.paid_for = 1
       AND ticket.punched = 0
WHERE  purchased_tickets.seller_id = @current_user
OPTION (KEEPFIXED PLAN); 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-10T23:53:45.670

我在 SQL Server 中找不到这样的术语。  

[http://en.wikipedia.org/wiki/Join_(SQL)#Join_algorithms](http://en.wikipedia.org/wiki/Join_(SQL)#Join_algorithms)

您是否只是在寻找使用索引的嵌套循环，从而导致索引查找？

# java - 为什么我在 Java 中会出现此编译错误？

> ID：632678
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-03-10T23:21:47.430
> 
>         
> 
> 标签：java

在java中为什么编译器不允许以下代码？

```
public class Test {

    public static void main(String[] args) {

        int x;
        int x = 4;// the error is generated here

    }

} 
```

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-03-10T23:25:33.897

因为第二

```
int x = 4; 
```

正在尝试创建一个 int 类型的变量名称“x”，但该变量已经存在（在上一行中创建）

可能你想做：

```
int x;
x = 4; 
```

（不使用 int 在第二行）

这将值 4 分配给 x。

甚至更好：

```
int x = 4; 
```

这将创建 int 类型的变量 x 并赋值为 4。

* * *

## 回答 #2

> 赞同：11
> 
>             
> 
> 时间：2009-03-10T23:22:52.063

您已经声明了两个`int`变量；两者都命名为`x`. 这是不允许的。

尝试：

```
public static void main(String[] args) {
    int x;
    x = 4;
} 
```

# tracking - Google 如何跟踪搜索结果的点击次数？这是最好的方法吗？

> ID：632683
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-10T23:23:10.517
> 
>         
> 
> 标签：tracking, ads, user-tracking

正如问题所述，我试图弄清楚谷歌如何跟踪搜索结果的点击。查看源代码时，您会发现以下内容：

```
 <a href="http://www.yahoo.com/" class=l onmousedown="return rwt(this,'','','res','1','AFQjCNG7Ba-stir4109vlLygPQX7QGf8bg','&amp;sig2=Vx5PLxf04C-yJYZTZfvk8w')"><em>Yahoo</em>!</a> 
```

该功能`rwt`是非常混乱的：

```
windows.rwt=function(b,d,e,g,h,f,i,j){
var a=encodeURIComponent||escape,c=b.href.split("#");
b.href=["/url?sa=t\x26source\x3dweb",d?"&oi="+a(d):"",e?"&cad="+a(e):"","&ct=",a(g),"&cd=",a(h),"&url=",a(c[0]).replace(/\+/g,"%2B"),"&ei=7_C2SbqXBMW0-AbU4OWnCw",f?"&usg="+f:"",i,c[1]?"#"+c[1]:""].join("");
b.onmousedown="";
return true}; 
```

所以看起来谷歌正在改变`/url?...`我假设的 a 标签的 href 是他们跟踪的地方。从 Firefox 中的 LiveHeaders 来看，此页面似乎正在将浏览器重定向到 a 标签的原始 href。

这是正确的吗？这是跟踪您网站上的链接（例如广告）点击的最佳方法吗？

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-03-10T23:56:17.927

它实际上是在更改链接的 href 而不是窗口位置。它正在设置 b.href，而 b 指的是链接本身。这在 onmousedown 中运行，因此当您释放鼠标并处理单击时，您会神奇地被发送到新的 href。

任何点击跟踪几乎都归结为将用户发送到相当于 Google 的 /url?... 脚本，计算点击次数，并执行 302 重定向到真实目的地。

这种 javascript href 替换具有自动过滤掉任何不运行脚本的机器人的优点。缺点是它还会过滤掉任何禁用 javascript 的真实人。如果像 Google 一样，您只关心哪个链接最受您的真实人类用户欢迎，那么效果很好。您记录的点击应该代表真实的人类流量，您可以放心地忽略来自非 JavaScript 用户的点击，因为他们可能有相同的偏好。

大多数广告只是直接链接到计数 URL，没有 javascript 替换。这意味着您肯定会计算链接上的每一次实际点击，但您需要担心过滤掉来自机器人的请求，因为它们现在也会看到您的计数 URL。

您更喜欢哪个实际上取决于您要跟踪点击的原因。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-10T23:54:50.753

我认为大多数人希望广告通过某种跟踪系统点击，所以我不应该太担心遵循这个特定的 javascript 实现 - 尽可能多地确保用户在浏览器中看到正确的链接状态栏，各种其他有趣的信息（搜索词，当时在结果集上的位置，你是谁等）被发送（你没有意识到），并且如果 JavaScript 被禁用，链接仍然有效。

一般来说，是的，使用他们点击的广告的 ID 引导用户通过一些跟踪页面，并且可能一些额外的指示他们来自哪里是明智的 - 这样你就不会依赖其他机制（例如 JS 事件处理程序）来跟踪链接的点击，这当然是我使用过的大多数广告系统的工作方式。

# php - 如何在 PHP 中检查文件是 ASCII 还是二进制

> ID：632685
> 
>         
> 
> 赞同：17
> 
>         
> 
> 时间：2009-03-10T23:24:21.153
> 
>         
> 
> 标签：php

有没有一种快速、简单的方法来使用 PHP 检查文件是 ASCII 还是二进制文件？

* * *

## 回答 #1

> 赞同：23
> 
>             
> 
> 时间：2009-03-11T00:08:34.480

这仅适用于 PHP>=5.3.0，并且不是 100% 可靠，但是嘿，它非常接近。

```
// return mime type ala mimetype extension
$finfo = finfo_open(FILEINFO_MIME);

//check to see if the mime-type starts with 'text'
return substr(finfo_file($finfo, $filename), 0, 4) == 'text'; 
```

[http://us.php.net/manual/en/ref.fileinfo.php](http://us.php.net/manual/en/ref.fileinfo.php)

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-10T23:27:19.103

由于 ASCII 只是文本的编码，具有二进制表示，并不是真的。您可以检查所有字节是否小于 128，但即使这样也不能保证它打算被解码为 ASCII。就你所知，这是一些疯狂的图像格式，或者是完全不同的文本编码，也没有使用所有八位。不过，它可能足以满足您的使用需求。如果您只想检查文件是否为有效的 ASCII，即使它不是“文本文件”，也绝对足够。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2013-07-16T15:22:47.817

您可能应该检查文件的 mimetype，但如果您愿意将文件加载到内存中，也许您可​​以使用以下内容检查缓冲区是否包含所有可打印字符：

```
<?php
$probably_binary = (is_string($var) === true && ctype_print($var) === false); 
```

不完美，但在某些情况下可能会有所帮助。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2018-05-30T15:15:42.340

这样在我的项目中似乎没问题：

```
function probably_binary($stringa) {
    $is_binary=false;
    $stringa=str_ireplace("\t","",$stringa);
    $stringa=str_ireplace("\n","",$stringa);
    $stringa=str_ireplace("\r","",$stringa);
    if(is_string($stringa) && ctype_print($stringa) === false){
        $is_binary=true;
    }
    return $is_binary;
} 
```

PS：对不起，我的第一篇文章，我想在上一篇文章中添加评论:)

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2020-03-26T04:46:10.503

在我的一个较旧的 PHP 项目中，我使用 ASCII / 二进制压缩。当用户上传他们的文件时，他们需要指定该文件是 ASCII 还是二进制文件。我决定修改我的代码，让服务器自动决定文件模式是什么，因为依赖用户的决定可能会导致压缩失败。我决定我的代码必须是绝对的，并且不使用可能导致我的程序失败的技巧。我迅速编写了一些代码，进行了一些速度测试，然后决定在互联网上搜索，看看是否有更快的代码示例来完成这项任务。

* * *

Devin 非常含糊的回答与我为完成此任务而编写的第一个代码有关。结果马马虎虎。我发现在许多情况下，逐字节搜索二进制文件的速度更快。如果您发现大于 127 的字节，则文件的其余部分可能会被忽略，整个文件将被视为二进制文件。话虽如此，您必须读取文件的每个最后一个字节以确定文件是否为 ASCII。对于许多二进制文件来说，它看起来更快，因为二进制字节可能会比文件的最后一个字节更早出现，有时甚至第一个字节也是二进制的。

```
<?php
$filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'ASCII',
    2 => 'Binary'
);

function filemode($filename) {
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            $handle = fopen($filename, 'rb');
            for($i = 0; $i < $size; ++$i) {
                $byte = fread($handle, 1);
                if(ord($byte) > 127) {
                    fclose($handle);
                    return 2; // Binary
                }
            }
            fclose($handle);
            return 1; // ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
}

// ==========

$filename = 'e:\test.txt';

$loops = 1;
$x = 0;
$i = 0;
$start = microtime(true);

for($i = 0; $i < $loops; ++$i)
    $x = filemode($filename);

$stop = microtime(true);
$duration = $stop - $start;

echo
    'Filename: ', $filename, "\n",
    'Filemode: ', $filemodes[filemode($filename)], "\n",
    'Duration: ', $duration; 
```

我的处理器不是很现代，但我发现一个 600Kb 的 ASCII 文件大约需要 0.25 秒才能完成。如果我要在数百或数千个大文件上使用它，可能需要很长时间。我决定尝试通过使缓冲区大于单个字节来将文件读取为块而不是一次一个字节来加快速度。使用块将允许我一次处理更多文件，但不会加载太多到内存中。如果我们正在测试的文件很大并且我们要将整个文件加载到内存中，它可能会占用太多内存并导致程序失败。

```
<?php
$filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'ASCII',
    2 => 'Binary'
);

function filemode($filename) {
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            $buffer_size = 256;
            $chunks = ceil($size / $buffer_size);
            $handle = fopen($filename, 'rb');
            for($chunk = 0; $chunk < $chunks; ++$chunk) {
                $buffer = fread($handle, $buffer_size);
                $buffer_length = strlen($buffer);
                for($byte = 0; $byte < $buffer_length; ++$byte) {
                    if(ord($buffer[$byte]) > 127) {
                        fclose($handle);
                        return 2; // Binary
                    }
                }
            }
            fclose($handle);
            return 1; // ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
}

// ==========

$filename = 'e:\test.txt';

$loops = 1;
$x = 0;
$i = 0;
$start = microtime(true);

for($i = 0; $i < $loops; ++$i)
    $x = filemode($filename);

$stop = microtime(true);
$duration = $stop - $start;

echo
    'Filename: ', $filename, "\n",
    'Filemode: ', $filemodes[filemode($filename)], "\n",
    'Duration: ', $duration; 
```

速度上的差异相当显着，只用了 0.15 秒，而不是前一个函数的 0.25 秒，读取我的 600Kb ASCII 文件快了近十分之一秒。

* * *

既然我的文件是分块的，我认为最好找到替代方法来测试我的块中的二进制字符。我的第一个想法是使用正则表达式来查找非 ascii 字符。

```
<?php
$filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'ASCII',
    2 => 'Binary'
);

function filemode($filename) {
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            $buffer_size = 256;
            $chunks = ceil($size / $buffer_size);
            $handle = fopen($filename, 'rb');
            for($chunk = 0; $chunk < $chunks; ++$chunk) {
                $buffer = fread($handle, $buffer_size);
                if(preg_match('/[\x80-\xFF]/', $buffer) === 1) {
                    fclose($handle);
                    return 2; // Binary
                }
            }
            fclose($handle);
            return 1; // ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
}

// ==========

$filename = 'e:\test.txt';

$loops = 1;
$x = 0;
$i = 0;
$start = microtime(true);

for($i = 0; $i < $loops; ++$i)
    $x = filemode($filename);

$stop = microtime(true);
$duration = $stop - $start;

echo
    'Filename: ', $filename, "\n",
    'Filemode: ', $filemodes[filemode($filename)], "\n",
    'Duration: ', $duration; 
```

惊人的！0.02 秒将我的 600Kb 文件视为 ASCII 文件，并且此代码似乎 100% 可靠。

* * *

现在我已经到了这里，我有机会检查其他用户部署的其他几种方法。

今天最受欢迎的答案，由 davethegr8 编写，使用 mimetype 扩展。首先，我需要在 php.ini 文件中启用此扩展。接下来，我针对一个没有文件扩展名的实际 ASCII 文件和一个没有文件扩展名的二进制文件测试了这段代码。

这是我创建两个测试文件的方式。

```
<?php
$handle = fopen('E:\ASCII', 'wb');
for($i = 0; $i < 128; ++$i) {
    fwrite($handle, chr($i));
}
fclose($handle);

$handle = fopen('E:\Binary', 'wb');
for($i = 0; $i < 256; ++$i) {
    fwrite($handle, chr($i));
}
fclose($handle); 
```

这是我测试这两个文件的方法...

```
<?php
$filename = 'E:\ASCII';
$finfo = finfo_open(FILEINFO_MIME);
echo (substr(finfo_file($finfo, $filename), 0, 4) == 'text') ? 'ASCII' : 'Binary'; 
```

哪个输出：

> 二进制

和...

```
<?php
$filename = 'E:\Binary';
$finfo = finfo_open(FILEINFO_MIME);
echo (substr(finfo_file($finfo, $filename), 0, 4) == 'text') ? 'ASCII' : 'Binary'; 
```

哪个输出：

> 二进制

这段代码显示我的 ASCII 和二进制文件都是二进制的，这显然是不正确的，所以我必须找到导致 mimetype 为“文本”的原因。对我来说很明显，也许文本只是可打印的 ASCII 字符。所以我限制了我的 ASCII 文件的范围。

```
<?php
$handle = fopen('E:\ASCII', 'wb');
for($i = 32; $i < 127; ++$i) {
    fwrite($handle, chr($i));
}
fclose($handle); 
```

并再次测试。

```
<?php
$filename = 'E:\ASCII';
$finfo = finfo_open(FILEINFO_MIME);
echo (substr(finfo_file($finfo, $filename), 0, 4) == 'text') ? 'ASCII' : 'Binary'; 
```

哪个输出：

> ASCII

如果我降低范围，它会将其视为二进制。如果我再次增加范围，它会将其视为二进制。

所以最被接受的答案不会告诉你你的文件是否是 ASCII，而是它是否只包含可读文本。

* * *

最后，我需要针对我的文件测试使用 ctype_print 的另一个答案。我决定最简单的方法是使用我制作的代码并在 MarcoA 的代码中进行补充。

```
<?php
$filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'ASCII',
    2 => 'Binary'
);

function filemode($filename) {
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            $buffer_size = 256;
            $chunks = ceil($size / $buffer_size);
            $handle = fopen($filename, 'rb');
            for($chunk = 0; $chunk < $chunks; ++$chunk) {
                $buffer = fread($handle, $buffer_size);
                $buffer = str_ireplace("\t", '', $buffer);
                $buffer = str_ireplace("\n", '', $buffer);
                $buffer = str_ireplace("\r", '', $buffer);
                if(ctype_print($buffer) === false) {
                    fclose($handle);
                    return 2; // Binary
                }
            }
            fclose($handle);
            return 1; // ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
}

// ==========

$filename = 'e:\test.txt';

$loops = 1;
$x = 0;
$i = 0;
$start = microtime(true);

for($i = 0; $i < $loops; ++$i)
    $x = filemode($filename);

$stop = microtime(true);
$duration = $stop - $start;

echo
    'Filename: ', $filename, "\n",
    'Filemode: ', $filemodes[filemode($filename)], "\n",
    'Duration: ', $duration; 
```

哎哟! 0.2 秒告诉我我的 600Kb 文件是 ASCII。我知道，我的大型 ASCII 文件只包含可见的 ASCII 字符。它似乎知道我的二进制文件是二进制的。还有我的纯 ASCII 文件……二进制！

我决定阅读[ctype_print](https://www.php.net/manual/en/function.ctype-print.php)的文档，它的返回值定义为：

> 如果文本中的每个字符都将实际创建输出（包括空格），则返回 TRUE。如果文本包含控制字符或根本没有任何输出或控制功能的字符，则返回 FALSE。

这个函数，就像 davethegr8 的回答一样，只会告诉你你的文本是否包含可打印的 ASCII 字符，而不会告诉你你的文本是否真的是 ASCII。这并不一定意味着 MacroA 完全错误，它们只是不完全正确。str_ireplace 比 str_replace 慢，仅替换这三个控制字符来测试 ctype_print 不足以知道字符串是否为 ASCII。为了使这个示例适用于 ASCII，我们必须替换每个控制字符！

```
<?php
$filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'ASCII',
    2 => 'Binary'
);

function filemode($filename) {
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            $buffer_size = 256;
            $chunks = ceil($size / $buffer_size);
            $replace = array(
                "\x00", "\x01", "\x02", "\x03",
                "\x04", "\x05", "\x06", "\x07",
                "\x08", "\x09", "\x0A", "\x0B",
                "\x0C", "\x0D", "\x0E", "\x0F",
                "\x10", "\x11", "\x12", "\x13",
                "\x14", "\x15", "\x16", "\x17",
                "\x18", "\x19", "\x1A", "\x1B",
                "\x1C", "\x1D", "\x1E", "\x1F",
                "\x7F"
            );
            $handle = fopen($filename, 'rb');
            for($chunk = 0; $chunk < $chunks; ++$chunk) {
                $buffer = fread($handle, $buffer_size);
                $buffer = str_replace($replace, '', $buffer);
                if(ctype_print($buffer) === false) {
                    fclose($handle);
                    return 2; // Binary
                }
            }
            fclose($handle);
            return 1; // ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
} 
```

这花了 0.04 秒告诉我我的 600Kb 文件是 ASCII。

* * *

我相信所有这些测试并没有完全没用，因为它确实给了我更多的想法。为什么不在我的原始函数中添加可打印的文件模式！虽然在我的 600Kb 可打印 ASCII 文件上看起来确实慢了 0.018 秒，但就是这样。

```
<?php
$filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'Printable',
    2 => 'ASCII',
    3 => 'Binary'
);

function filemode($filename) {
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            $printable = true;
            $buffer_size = 256;
            $chunks = ceil($size / $buffer_size);
            $handle = fopen($filename, 'rb');
            for($chunk = 0; $chunk < $chunks; ++$chunk) {
                $buffer = fread($handle, $buffer_size);
                if(preg_match('/[\x80-\xFF]/', $buffer) === 1) {
                    fclose($handle);
                    return 3; // Binary
                }
                else
                    if($printable === true)
                        $printable = ctype_print($buffer);
            }
            fclose($handle);
            return $printable === true ? 1 : 2; // Printable or ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
}

// ==========

$filename = 'e:\test.txt';

$loops = 1;
$x = 0;
$i = 0;
$start = microtime(true);

for($i = 0; $i < $loops; ++$i)
    $x = filemode($filename);

$stop = microtime(true);
$duration = $stop - $start;

echo
    'Filename: ', $filename, "\n",
    'Filemode: ', $filemodes[filemode($filename)], "\n",
    'Duration: ', $duration; 
```

我还针对正则表达式测试了 ctype_print，发现 ctype_print 更快一些。

```
$printable = preg_match('/[^\x20-\x7E]/', $buffer) === 0; 
```

* * *

这是我的最终功能，其中查找可打印文本是可选的，缓冲区大小也是如此。

```
<?php
const filemodes = array(
    -2 => 'Unreadable',
    -1 => 'Missing',
    0 => 'Empty',
    1 => 'Printable',
    2 => 'ASCII',
    3 => 'Binary'
);

function filemode($filename, $printable = false, $buffer_size = 256) {
    if(is_bool($printable) === false || is_int($buffer_size) === false)
        return false;
    $buffer_size = floor($buffer_size);
    if($buffer_size <= 0)
        return false;
    if(is_file($filename)) {
        if(is_readable($filename)) {
            $size = filesize($filename);
            if($size === 0)
                return 0; // Empty
            if($buffer_size > $size)
                $buffer_size = $size;
            $chunks = ceil($size / $buffer_size);
            $handle = fopen($filename, 'rb');
            for($chunk = 0; $chunk < $chunks; ++$chunk) {
                $buffer = fread($handle, $buffer_size);
                if(preg_match('/[\x80-\xFF]/', $buffer) === 1) {
                    fclose($handle);
                    return 3; // Binary
                }
                else
                    if($printable === true)
                        $printable = ctype_print($buffer);
            }
            fclose($handle);
            return $printable === true ? 1 : 2; // Printable or ASCII
        }
        else
            return -2; // Unreadable
    }
    else
        return -1; // Missing
}

// ==========

$filename = 'e:\test.txt';
echo
    'Filename: ', $filename, "\n",
    'Filemode: ', filemodes[filemode($filename, true)], "\n"; 
```

# .net - 即使设置了 GridView.DataKeyNames，Gridview.DataKeys[] 仍然为空

> ID：632689
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-10T23:24:52.027
> 
>         
> 
> 标签：.net, asp.net

GridView.DataKeynames 存储 GridView 控件中显示的项目的主键字段的名称。

1) 即使我设置了 DataKeyNames，GridView 仍然不会在 DataKey 对象中存储记录的主键值：

```
 protected void SqlDataSource1_Selected(object sender, 
          SqlDataSourceStatusEventArgs e)
{
      Label2.Text = GridView2.DataKeys[0].Value.ToString();//exception
} 
```

为什么不？

2）我假设在设置 DataKeyNames 时，DataKey 对象存储主键的原始值和新值（假设我们发出更新命令），并且当更新完成时，DataKey 对象丢弃原始值？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-14T21:18:00.907

我想这为时已晚......但首先，您试图在数据检索后而不是数据绑定后立即获取数据键。在 DataBind 之前不会填充 DataKey。

其次，数据键不存储新的更新后值。它们是绑定期间可用内容的副本，存储在视图状态中，主要用于在回发后定位记录而无需进行另一次绑定。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2010-02-02T20:03:55.173

我在 asp:PlaceHolder 中的 GridView 遇到了这个问题，该问题在页面加载时设置为 Visible=false。数据绑定发生在 OnLoad for !IsPostBack 中的整个页面上。单击按钮时，PlaceHolder 将设置为 Visible=true。所有数据都会显示，但 GridView 上的 DataKeys[] 将始终为空。

当控件不可见时，似乎 GridView ViewState 无法正确保留。我的补救措施是在显示之前对 GridView 进行 DataBind()。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2011-03-13T19:36:31.397

以某种方式相关的答案可能对 2 年以上的人有所帮助.. （确切地说是 2 年零 2 天）我有一个绑定到**GridView的****EntityDataSource**，我想根据实体的 Id（DataKey 值）在网格视图中隐藏选定的 CommandButton，我在 RowDataBound 事件中做到了，但我得到了一个带有此代码的**indexOutOfBoundException**（尽管 DataKeys 应该在 RowDataBound 中可用）：

 ****```
protected void GridView_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        int id = (Int32)GridView.DataKeys[e.Row.RowIndex].Value;//<==Here
        if (FilterList.Contains(id))
        {
            e.Row.Cells[3].Visible= false;
        }
    }          
} 
```

解决方法是在 Grid 视图标记中添加 Id 作为模板字段集（它可见！），然后检查单元格值中的 id 而不是 DataKeys，如下所示：

```
if (e.Row.RowType == DataControlRowType.DataRow)
{

     TableCell cell =e.Row.Cells[0];
     Label s = (Label)cell.Controls[1];

     int id = Convert.ToInt32(s.Text);              
     if (FilterList.Contains(id))
     {
         //hide the Select CommandButton
         e.Row.Cells[3].Visible = false;
     }

     //Hide the id cell
     e.Row.Cells[0].Visible = false;
}

if (e.Row.RowType == DataControlRowType.Header)
{
    //Hide the Id header cell
    e.Row.Cells[0].Visible = false;
} 
```

希望这可以帮助某人

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2012-06-25T00:35:08.507

您还可以通过在 RowDataBound 中使用 e.Row.DataItem 来解决此问题，而无需在 GridView 中显示 id 字段，如下所示：

```
protected void GridView_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        DataRowView drv =  e.Row.DataItem as DataRowView // Cast to correct type
        if (drv != null)
        {
            int id = Convert.ToInt32(drv["Id"]);
            if (FilterList.Contains(id))
            {
                e.Row.Cells[3].Visible= false;
            }
        }
    }          
} 
```

请注意，您需要将 DataItem 设置为用于 DataBind 到 GridView 的正确类型。例如，如果您将 GridView 数据绑定到 DataGrid，则 DataItem 应该是 DataRowView，如果您将数据绑定到 CustomObject 类型的对象数组，那么您可以将 DataItem 转换为 CustomObject 类型

# embedded - 如何制作自己的微控制器？

> ID：632698
> 
>         
> 
> 赞同：48
> 
>         
> 
> 时间：2009-03-10T23:29:14.450
> 
>         
> 
> 标签：embedded, microcontroller

如何制作自己的微控制器？我已经使用 GAL 芯片完成了一些工作，并对芯片进行了编程以执行简单的命令，例如添加、加载、移动、异或和输出，但我想做一些更像真正的微控制器的东西。

我该怎么做呢？我已经阅读了一些关于 FPGA 和 CPLD 的内容，但不是很多，因此正在寻找一些关于获得什么以及如何开始开发它的建议。

* * *

## 回答 #1

> 赞同：29
> 
>             
> 
> 时间：2009-03-11T05:54:16.317

[在这里](http://en.wikibooks.org/wiki/Microprocessor_Design)寻找一本好的维基书。我在教电子工程时写了一些课程作业，但我找不到。在我教学时，大多数学生都乐于使用 Xilinx Foundation 软件包中的原理图捕获工具。他们现在已经转向 ISE 和 WebPACK。您可以免费下载 WebPack，它很有用，其中包含原理图捕获和仿真。

如果您真的想大放异彩，请学习 VHDL 或 Verilog（VHDL 似乎在我工作过的地方更常见，但这只是一小部分地方）并对设计进行编码，而不是通过 GUI 输入。

如果您对数字逻辑设计（和一些 HDL）一无所知，我认为您可以在大约 2 天内拥有一个在 VHDL 中模拟的功能性 8 位微处理器。在那段时间里，你不会构建任何非常快速或非常强大的东西，但这是一个很好的成长起点。如果您必须学习数字设计，请花几天时间了解这些工具的工作原理并模拟一些基本的逻辑电路，然后再进行 uP 设计。

开始学习数字系统的基础知识，以及如何构建二进制加法器。继续构建一个 ALU 来处理加法、减法和、或、异或等，然后构建一个序列器来从 RAM 读取操作码并将它们提供给执行单元。

您可以对指令集设计感兴趣，但我建议您从真正简单的开始，直到您了解正在发生的事情，然后将其扔掉并从更复杂的东西重新开始。

一旦您对设计进行了很好的模拟，您就可以衡量其复杂性并购买适合的设备。您应该查看您选择的设备系列的开发系统。选择一个比您开发所需更大的设备，因为能够在它运行时添加额外的工具来调试它是件好事，而且您几乎肯定不会在设备上安装它的早期阶段优化您的设计。

编辑：[Colin Mackenzie](http://www.colinmackenzie.net/)有一个关于 uC 设计和一些 FPGA 板以及其他一些东西的很好的教程。

* * *

## 回答 #2

> 赞同：13
> 
>             
> 
> 时间：2009-03-10T23:38:16.363

您可能想看看[OpenCores.org](http://opencores.org)，这是一个用于开源 IP 内核开发的“伪造”站点。另外，请考虑为自己准备一个类似[其中之一](http://www.easyfpga.com/)的开发板来玩。

尽管[Avalda](http://www.avalda.com/)正在开发用于为 FPGA 编译 F# 的工具，但大部分工具生态系统都围绕[VHDL展开。](http://en.wikipedia.org/wiki/VHDL)

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2009-03-11T16:29:47.897

我曾经看过一本教科书，它逐步介绍了如何使用 TTL 芯片构建机器。它具有与 PDP-8 相同的指令集，非常简单——我的意思是***非常***简单，因此实际的机器架构很容易以这种方式实现。

[PDP-8 FAQ](http://www.faqs.org/faqs/dec-faq/pdp8/)提到了一本书：“数字设计的[艺术](https://rads.stackoverflow.com/amzn/click/com/0130467804)”，第二版，由 Franklin Prosser 和 David Winkel 编写（Prentice-Hall，1987，ISBN 0-13-046780-4）。它还提到人们在 FPGA 中实现它。

鉴于这种 CPU 架构的极其简单性和 PDP-8 代码或参考实现的可用性，它可能是一个很好的热身起点。

或者，我的一个熟人在 FPGA 上实现了一个拇指（削减 ARM）作为一个由 Steve Furber（一位著名的 Acorn 校友）运行的大学项目。鉴于这可以压缩成足够小的格式用于大学项目，它也可能是一个好的开始。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-03-12T16:03:09.593

为了玩软核微处理器，我喜欢 Digilent 的[Spartan 3 Starter Board](http://www.digilentinc.com/Products/Detail.cfm?Prod=S3BOARD)   ，因为它有 1M 的静态 RAM。你知道，SDRAM 和 DDR RAM 更难发展。

LED、开关和简单的串行接口是调试和通信的优势。

正如有人已经指出的那样，[OpenCores.org](http://www.opencores.org)是查找工作示例的好地方。我在大学时使用[Plasma uC](http://www.opencores.org/?do=project&who=mips)写了一些论文。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-10T23:38:44.833

微控制器可以像 ROM 一样简单（指令*2^x +（时钟相位）是地址，输出是控制信号，你可以开始了）。或者它可以是具有三臂和分支预测支持硬件的复杂哈利野兽。

你能提供更多关于你的愿望的细节吗？

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T16:19:32.553

在大家搜索了一些非常有用的链接之后，我遇到了[这个](http://en.wikiversity.org/wiki/Computer_Architecture_Lab)Wikiversity 课程。

第一句话是，“你有没有想过构建自己的微处理器？”

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-04-18T19:56:02.120

[Xilinx](http://www.xilinx.com)为其 FPGA配备了[MicroBlaze](http://www.xilinx.com/support/documentation/sw_manuals/mb_ref_guide.pdf)和[PicoBlaze软控制器。](http://www.xilinx.com/support/documentation/ip_documentation/ug129.pdf)后者是免费的，而 IIRC，Microblaze 需要付费。

顾名思义，PicoBlaze 是一个小型处理器，有其局限性，但 OTOH 足够紧凑，[可以在 CPLD 上运行](http://www.xilinx.com/support/documentation/application_notes/xapp387.pdf)。无论如何，一个不错的处理器可以帮助您入门。

Pablo Bleyer 有一个与 PicoBlaze 兼容的[PacoBlaze](http://bleyer.org/pacoblaze/)。PacoBlaze 是用 Verilog 编写的（正如 Adam 所说，它不如 VHDL 常见）。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T06:04:40.363

你需要一个大 fpga 来换一个小 mcu。

如果你需要像 AD 这样的东西，你需要一个具有正确硬件块的 fpga。

您需要一个软核才能放入 fpga。

但是在这个项目之前只玩一个普通的 MCU 怎么样，所以你知道你要去哪里吗？一些来自 Atmel 的 AVR:s 怎么样。

* * *

## 回答 #9

> 赞同：-5
> 
>             
> 
> 时间：2009-03-10T23:39:19.370

您可以在此站点获得 pic 微控制器的免费样品。最后我知道，你甚至不必支付运费。

[http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=64](http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=64)

# video - DirectShow：BITMAPINFOHEADER 和 ISampleGrabber 返回不同的大小

> ID：632708
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-10T23:35:36.930
> 
>         
> 
> 标签：video, directshow

我有一个特定的 FLV (VP6/LAME) 文件，它是 400 x 171 像素，由`BITMAPINFOHEADER`结构报告并由许多 FLV 元数据编辑器（如 RichFLV）验证。

但是，当使用`ISampleGrabber`生成的样本（每像素 3 个字节）从中获取样本时，只有 204,000 字节（400 x 170 x 3），而不是我期望的 205,200 字节（400 x 171 x 3）。

当我试图仅将 400 x 170 的数据推送到 400 x 171`Bitmap`对象的构造函数中时，它变得相当不安并导致 A/V 异常。

我可以破解它来检测“接近但不完全符合预期”的样本大小，但我真的很想知道 1px 的垂直高度在这个过程中去了哪里。我的猜测是一个狡猾的过滤器，它不支持宽度/高度的奇数值并且正在删除它，但我不确定检查这个的简单方法。

有人知道会发生什么以及如何验证吗？

（PS：我不是一个好的C/C++开发者，所以请不要涉及过度使用它的解决方案）

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-08-29T03:32:47.203

我最好的猜测是一个狡猾/有缺陷的 FLV 过滤器。当您尝试不同的 FLV 过滤器时会发生什么？其他 FLV 文件是否报告不正确的视频尺寸？

# javascript - Javascript clientHeight 和替代品

> ID：632709
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-10T23:35:49.893
> 
>         
> 
> 标签：javascript, html, css

我目前正在尝试修改“滑入”<div> 的 Javascript 函数。脚本本身要求您定义 div 的高度，因此它在动态填充的 <div> 中几乎没有用处。我在 javascript 中的 clientHeight 属性上找到了一些文本，但它似乎不支持 <div>s 并将 display 设置为 none （这是用于将 div 滑入的方法）。这是有道理的，因为客户端窗口中该 div 的高度什么都不是。

基本上我想知道你们都知道哪些其他方法，或者是否有办法在 display: none 时绕过 clientHeight = 0。

谢谢！

哦，这是我正在使用的功能：

```
function getDivHeight(objName) {
    return boxHeight = document.getElementById(objName).clientHeight;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T00:45:01.757

一个简单的解决方案是将其可见性设置为“隐藏”，并将其显示设置为“阻止”并对其进行测量。然而，一些现代浏览器会在短时间内更新页面布局，你会得到一个讨厌的闪烁。克服这个问题的最简单方法是将元素放置在一个绝对定位的容器中，并将溢出设置为“隐藏”。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:02:39.050

我很幸运地克隆了元素，将其移出屏幕，然后显示它以获得客户端高度：

```
var original = document.getElementById(some_id);
var new_item = original.cloneNode(true);
document.body.appendChild(new_item);  // item already hidden, so it won't show yet.
                                      // you may wish to validate it is hidden first
new_item.style.position = "absolute";
new_item.style.left = "-1000px";
new_item.style.display = "block";
var height = new_item.clientHeight; 
```

**编辑：**查看 jQuery 代码，他们完全按照 Tsvetomir Tsonev 的建议行事。jQuery 临时将样式设置为“显示：块；位置：绝对；可见性：无”，然后测量高度，测量后交换属性。

所以，看起来你不得不做一些骇人听闻的事情，无论是克隆节点还是冒着让它在某些浏览器中闪烁的风险......我更喜欢 Tsvetomir 的建议而不是我最初的 hack，因为它至少没有涉及将一个节点克隆到您不需要的 DOM 中。无论哪种方式，都不得将元素设置为“显示：无”以测量其高度。DOM 不是很棒吗？:-)

**编辑 2：**还值得注意的是，在 jQuery 收集高度之后，它增加了填充、边距和边框大小的余量，因此您可能也需要这样做。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:29:19.190

是的，页面上未显示的元素没有维度。

这有点道理。考虑一个已创建并填充了一堆文本但尚未添加到文档树中的元素。有多高？取决于字体大小。字体大小有多大？取决于在文档中插入 div 的位置；它的父字体大小将继承。

对于具有“显示：无”的元素也是如此。它没有被渲染，所以它没有尺寸。难道我们不能问“如果它是'display：block'，这会有多高”？结果不是，因为如果它*被*显示，它本身可能会改变其父块的尺寸，然后显示元素的尺寸将与非显示元素的尺寸不一致！

典型的解决方案是取消设置“display:none”，测量元素的高度，然后立即重新设置“display:none”。浏览器不会在一点 JavaScript 的中间重绘，因此您不会在页面上看到闪烁。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-07-31T08:03:40.553

我知道你们很久以前就解决了这个问题，但我想我应该分享这个，因为获取隐藏 div 标签的高度非常棘手。这是我在阅读您的帖子后所做的，我将要滑动的 div 放置在一个 1px 高度的 div 中，并将溢出设置为隐藏。您甚至不需要将内部 div 的显示设置为 none，因为它已经存在，如果您使用 offsetHeight，它应该为所有浏览器返回正确的高度，您可以使用该高度将您的 div 向上向下滑动。

和平！！！

* * *

## 回答 #5

> 赞同：-2
> 
>             
> 
> 时间：2009-03-10T23:44:24.430

在 IE 中，您可以尝试使用 scrollHeight，但我不确定它是否可以工作，或者它是否是跨浏览器。  

# wpf - 列表框中的文本框、按钮和列表框

> ID：632713
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-10T23:38:50.917
> 
>         
> 
> 标签：wpf, listbox

我有一个列表框，每个列表项中有一堆控件。

```
<ListBox x:Name="projectList" IsSynchronizedWithCurrentItem="True">
    <ListBox.ItemTemplate>
        <DataTemplate>
            <StackPanel>
                <TextBlock Text="{Binding Name}" />
                <ListBox x:Name="taskList" ItemsSource="{Binding Tasks}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding Name}" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <TextBox x:Name="textBoxTask" />
                <Button
                    x:Name="ButtonAddNewTask"
                    Content="Test"
                    CommandParameter="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=DataContext}"
                    Click="ButtonAddNewTask_Click"
                    />
            </StackPanel>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

当我单击列表框中的按钮时，我想向列表框中的列表框添加一个新项目。我已经走到这一步了。所以我的问题是如何获取文本框以及如何更新列表框？

这是我的点击事件

```
private void ButtonAddNewTask_Click(object sender, RoutedEventArgs e)
{
    Button button = (Button)sender;
    Project proj = button.DataContext as Project;
    if(proj.Tasks == null)
        proj.Tasks = new List<Task>();

    proj.Tasks.Add(new Task("Added Task"));
} 
```

谢谢

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-03-11T00:13:56.840

最简单的解决方案可能是让一个对象代表外部 ListBox 中的每个项目。然后它将具有表示项目中每个控件的属性 - TextBox 中的文本和 ListBox 中的项目（我认为，基于您的 Click 处理程序的任务列表）。

在您的 Click 处理程序中，您可以获得 Button 的 DataContext（它应该是外部列表集合中的一个项目），并将一个新任务添加到该对象的任务列表中。由于内部 ListBox 绑定到该列表，因此应该使用新项目对其进行更新（假设它在添加项目时发送事件，例如使用 ObservableCollection）。

**更新**：根据您的评论，以下应该有效。

你的`Project`类应该有两个属性：

```
class Project
{
    public string Name { get; set; }

    private ObservableCollection<Task> tasks =
        new ObservableCollection<Task>();
    public IList<Task> Tasks
    {
        get { return this.tasks; }
    }
} 
```

该类`Task`只有一个属性——任务的名称。

该类`ProjectView`是该类的包装器`Project`（我从@timothymcgrath 的回答中得到了这个想法）。它跟踪新任务的名称和当前`Project`：

```
class ProjectView : INotifyPropertyChanged
{
    public Project Project { get; set; }

    private string newTaskName = string.Empty;
    public string NewTaskName
    {
        get { return this.newTaskName; }
        set
        {
            this.newTaskName = value;
            this.OnPropertyChanged("NewTaskName");
        }
    }

    public event PropertyChangedEventHandler PropertyChanged;
    private void OnPropertyChanged(string propName)
    {
        PropertyChangedEventHandler eh = this.PropertyChanged;
        if(null != eh)
        {
            eh(this, new PropertyChangedEventArgs(propName));
        }
    }
} 
```

您将需要一个新类，该类将用作`DataContext`. 像这样的东西：

```
class Model
{
    private ObservableCollection<ProjectView> projects =
        new ObservableCollection<ProjectView>();
    public IList<ProjectView> Projects
    {
        get { return this.projects; }
    }
} 
```

在后面的代码中，`DataContext`将对象的 设置为上述类的实例：

```
public class Window1
{
    public Window1()
    {
        this.InitializeComponent();

        this.DataContext = this.model;
    }

    private Model model = new Model();
} 
```

在 XAML 中，应修改绑定以绑定到上述属性：

```
<ListBox x:Name="projectList" IsSynchronizedWithCurrentItem="True"
    ItemsSource="{Binding Path=Projects}">
    <ListBox.ItemTemplate>
        <DataTemplate>
            <StackPanel>
                <TextBlock Text="{Binding Project.Name}" />
                <ListBox x:Name="taskList"
                    ItemsSource="{Binding Project.Tasks}"
                    DisplayMemberPath="Name" />
                <TextBox x:Name="textBoxTask"
                    Text="{Binding Path=NewTaskName, UpdateSourceTrigger=PropertyChanged}"/>
                <Button x:Name="ButtonAddNewTask" Content="Test"
                    Click="ButtonAddNewTask_Click" />
            </StackPanel>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

最后，在按钮的单击处理程序中，创建任务。的`DataContext`将`Button`是该`ProjectView`项目的。

```
private void ButtonAddNewTask_Click(object sender, RoutedEventArgs e)
{
    Button btn = (Button)sender;
    ProjectView curProject = btn.DataContext as Project;
    if(null != curProject)
    {
        curProject.Project.Tasks.Add(new Task()
        {
            Name = curProject.NewTaskName
        });
    }
} 
```

由于所有控件都通过绑定获取它们的值，因此您无需访问控件本身即可获取数据 - 只需使用已经提供控件的数据结构即可。

将创建任务的代码移动到另一个类（可能`Project`）中可能会更好，但我只是将它留在事件处理程序中以便于我的输入。

**更新 2**：修改了上面的代码以将属性移动到一个单独的类中，该类包装一个用于 UI`NewTaskName`的实例。`Project`这对你更有效吗？

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T03:14:09.527

我假设您的项目列表框填充了项目对象的集合。我会将 AddNewTask ICommand 添加到 Project 类并通过属性公开它。然后将 Add New Task 按钮绑定到新的 AddNewTask ICommand。对于CommandParameter，输入TaskName，它将被传递到命令中。

尝试阅读一些 MVVM（模型视图视图模型）以了解其工作原理的一些示例。它非常干净，效果很好。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T19:41:06.470

可以说，该解决方案适用于手头的任务。

```
 private void ButtonAddNewTask_Click(object sender, RoutedEventArgs e)
    {
        Button button = (Button)sender;
        DependencyObject obj = LogicalTreeHelper.GetParent(button);
        StackPanel item = obj as StackPanel;
        TextBox textBox = item.FindName("textBoxTask") as TextBox;
        ListBox listBox = item.FindName("taskList") as ListBox;

        Project proj = button.DataContext as Project;
        if(proj.Tasks == null)
            proj.Tasks = new List<Task>();

        listBox.ItemsSource = proj.Tasks;
        listBox.Items.Refresh();
    } 
```

# java - 如何修复 Java 堆的大小

> ID：632716
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-10T23:40:17.060
> 
>         
> 
> 标签：java, heap-memory, strict, sizing

我知道 Java VM 有“-XMx”和“-XMs”来设置堆的大小。它还有一个叫做“人机工程学”的特性，可以智能地调整堆的大小。但是，我手头有一个问题，需要严格固定大小的堆。

这是命令行参数：

```
"-Xms2m -Xmx2m -XX:+PrintGCDetails" 
```

但是，通过观察 GC 日志，似乎堆的大小并没有固定在 2048K。参见，例如 2368K、2432K、2176K 等：  

```
[GC [PSYoungGen: 480K->72K(704K)] 1740K->1332K(2368K), 0.0032190 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] 
[GC [PSYoungGen: 560K->64K(768K)] 2094K->1598K(2432K), 0.0033090 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] 
[GC [PSYoungGen: 544K->32K(768K)] 1675K->1179K(2176K), 0.0009960 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
```

有没有办法对 Java 堆进行“*严格的* *大小调整*”（不多不少）？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T20:39:40.463

I believe the JVM will manage the heap as you intend, but the problem in your example is that the max heap size is effectively ignored as too low.

On Sun's Windows JVM version 1.6.0_06 I believe the minimum 'max heap size' is approximately 6MB (i.e. -Xmx6m). If you attempt a setting lower then this the heap may actually grow larger. (I had thought the minimum was 16m but a little experimentation shows that values as low as 6m appear to work.)

If you set -Xms8m and -Xmx8m, however, I think you'll find the heap stays at that size.

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T02:59:47.923

除了 -Xmx 和 -Xms 之外，还有其他选项可以确定初始堆大小。查看 jvm[调优指南](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html#0.0.0.%20Total%20Heap|outline)了解详细信息。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-19T09:43:28.307

我想它太小了。尝试更高的高度，例如 16m 或 64m。此外，内部和外部尺寸是不同的鞋子。堆不会一直是满的，所以小于 Xmx 总是可能的，甚至在程序刚刚启动的情况下小于 Xms。但在外部，您会看到已分配 Xms 量的内存。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-05-19T19:21:41.913

当我第一次阅读时，我认为它说的是 2 GB ;)

不要忘记 Java 使用至少 10 - 30 MB 的非堆空间，因此您节省的几百 K 可能不会像您想象的那么大。

* * *

## 回答 #5

> 赞同：-1
> 
>             
> 
> 时间：2009-03-10T23:42:49.613

据我所知，使用标准虚拟机是不可能的。不幸的是，我现在手头没有参考资料。

# iphone - 原生 iPhone 音频格式

> ID：632718
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-03-10T23:41:16.963
> 
>         
> 
> 标签：iphone, audio

我目前在 iPhone 设置上获得了输出音频，如下所示：

```
AudioStreamBasicDescription audioFormat;

audioFormat.mSampleRate = 48000;

audioFormat.mFormatID   = kAudioFormatLinearPCM;

audioFormat.mFormatFlags = kAudioFormatFlagIsSignedInteger | kAudioFormatFlagIsPacked;

audioFormat.mFramesPerPacket = 1;

audioFormat.mChannelsPerFrame = 2;

audioFormat.mBitsPerChannel = 16;

audioFormat.mBytesPerPacket = 4;

audioFormat.mBytesPerFrame = 4; 
```

但是，当我通过鲨鱼检查我的性能数据时，我看到了以下功能： 
`SRC_Convert_table_i32_scalar_stereo`

花很多时间。

这让我想到 - iPhone 的理想和建议输出格式是什么？设备播放所需的工作量很少。  

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-04-01T08:18:05.923

Shark 确实适用于 iPhone。您可以通过在菜单中选择“Sampling > Network/iPhone Profiling...”来启用 iPhone 分析。

绝对尝试使用 44100 Hz 采样率。对于 48000，我在调用堆栈中看到您发布的相同功能 - 使用 44100 时没有显示此类功能。iPhone 上音频单元的规范音频格式是非交错 8.24 线性 PCM：

```
streamFormat.mFormatID         = kAudioFormatLinearPCM;
streamFormat.mFormatFlags      = 
                  kAudioFormatFlagIsSignedInteger
                | kAudioFormatFlagsNativeEndian
                | kLinearPCMFormatFlagIsNonInterleaved
                | (24 << kLinearPCMFormatFlagsSampleFractionShift);
streamFormat.mSampleRate       = mixing_rate;
streamFormat.mBitsPerChannel   = 32;
streamFormat.mChannelsPerFrame = 2;
streamFormat.mFramesPerPacket  = 1;
streamFormat.mBytesPerFrame    = ( streamFormat.mBitsPerChannel / 8 );
streamFormat.mBytesPerPacket   = streamFormat.mBytesPerFrame *
                                 streamFormat.mFramesPerPacket; 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:08:43.327

从[iphone 开发中心](http://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/AudioandVideoTechnologies/chapter_9_section_2.html#//apple_ref/doc/uid/TP40007072-CH19-SW32)（需要登录），硬件支持的编解码器是

> **iPhone 音频硬件编解码器**
> 
>   
>   
> 
> iPhone OS 应用程序可以使用多种音频数据格式，如下一节所述。其中一些格式使用基于软件的编码和解码。您可以同时播放这些格式的多种声音。此外，您的应用程序和后台应用程序（尤其是 iPod 应用程序）可以同时播放这些格式的声音。
> 
>   
>   
> 
> 其他 iPhone OS 音频格式使用硬件编解码器进行播放。这些格式是：
> 
>   
>   
> 
> *   AAC
> 
> *   ALAC（苹果无损）
> 
> *   MP3

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:15:04.230

48000 通常是一种奇怪的音频格式。虽然它比 CD 标准 44.1Khz 稍微好一点（并且难以察觉），但它不值得这么大。

您的应用程序中是否有任何令人信服的理由来使用高质量的立体声？换句话说，该应用程序可能会在扬声器或优质耳机上播放吗？

LinearPCM 格式是硬件原生的，因此它应该是最佳的。（无需解压。）因此该调用可能是 44.1Khz 的下采样。

# .net - 删除记录（使用 GridView ）

> ID：632721
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-10T23:43:09.487
> 
>         
> 
> 标签：.net, asp.net, sql

1）为什么不设置GridView.DataKeyNames属性就可以更新数据记录（通过数据源控件），但删除时（如果ConflictDetection属性设置为OverwriteChanges），必须设置DataKeyNames，否则GridView不会传参数给数据源控制？  

谢谢

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T08:20:59.600

GridView 使用**DataKeyNames**作为要操作的记录的标识符。就像你桌子上的主键一样。它们大致用于您操作的 WHERE 子句。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T04:44:29.090

我认为[文档](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.datakeynames.aspx)解释得最好。它指出 DataKeyNames 属性是“一个包含主键字段名称的数组”。

当您修改 gridview 时，动态构建行中的值并将它们传递到数据源中。当您删除时，它假定所需要的只是主键。方便地这些存储在该行的 DataKeys 中，因此它们是您获得的唯一值。

# git - svn 到 git 的转换

> ID：632724
> 
>         
> 
> 赞同：14
> 
>         
> 
> 时间：2009-03-10T23:44:28.000
> 
>         
> 
> 标签：git, ubuntu, svn, git-svn

我正在尝试将 SourceForge 项目从 Subversion 转换为 Git。根据一些谷歌搜索，应该可以使用这个命令：

```
git svn clone http://PROJECT.svn.sourceforge.net/ PROJECT.git 
```

SourceForge 的项目名称在哪里`PROJECT`，用于将 SVN 项目签出到本地 git 存储库。

但是，这只会给出以下错误消息：

> ```
> Initialized empty Git repository in /home/user/git/PROJECT.git/.git/
> Use of uninitialized value in concatenation (.) or string at /usr/lib/perl5/SVN/Core.pm line 584.
> XML data was not well-formed:  at /usr/bin/git-svn line 1385 
> ```

我使用的是 Kubuntu 8.10，而 Git 是 1.5.6.3 版。

我在Fedora上发现了一个貌似类似的[bug](https://bugzilla.redhat.com/show_bug.cgi?id=464797)，但是一直没有解决，所以不知道问题出在哪里。我是否错误地使用了该命令，或者它是一个错误？

* * *

## 回答 #1

> 赞同：16
> 
>             
> 
> 时间：2009-03-11T00:17:05.333

从[svn 项目页面](http://sourceforge.net/scm/?type=svn&group_id=234930)看起来您使用了错误的 URL - 尝试：

```
git svn clone http://PROJECT.svn.sourceforge.net/svnroot/PROJECT PROJECT.git 
```

我刚刚成功检查了一个（在 OS X 10.5 上使用 git 1.6.2）：

```
git svn clone http://javaautoupdater.svn.sourceforge.net/svnroot/javaautoupdater ok.git 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-05-03T15:29:26.337

我遇到了同样的问题，事实证明我刚刚重新启动并需要重新添加我的密钥。尝试 ssh'ing 进入 git-svn 尝试连接的框，看看你得到了什么错误。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2012-08-25T05:09:28.930

尝试一个名为 svn2git 的工具。阅读此处了解详细信息：[https](https://help.github.com/articles/importing-from-subversion) ://help.github.com/articles/importing-from-subversion 。

# powershell - 如何组合和压缩多个脚本和 css 文件以供生产使用？

> ID：632725
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-03-10T23:45:10.090
> 
>         
> 
> 标签：powershell, build-process, yui-compressor

我想在编译我的项目时使用[YUI Compressor](http://developer.yahoo.com/yui/compressor/)来*组合和压缩我的 css 和 js 文件集。*YUI Compressor 仅将单个文件作为输入。我尝试使用以下（Windows）命令附加到输出文件，但奇怪的字符出现在出现附加的输出中。如何使用 windows 命令行或 powershell 来实现这一点？

```
java -jar yuicompressor-2.4.2.jar --charset utf-8 jquery-1.3.2.js > scripts-all.min.js
java -jar yuicompressor-2.4.2.jar --charset utf-8 jquery.superfish.js >> scripts-all.min.js 
```

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2010-06-02T20:58:13.587

我的简单解决方案（在了解 YUI Compressor 的 .NET 端口之前）是：

```
copy /b jquery.js+jquery.superfish.js+jquery.qtip.js+NOTICE core.js
java -jar yuicompressor-2.4.2.jar --charset utf-8 -o core-min.js core.js 
```

这对我来说一直很好，即使我不太明白为什么 /b （二进制）标志是摆脱奇怪字符的伎俩。如果有人想在评论中启发我，我将不胜感激。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-07-06T14:58:03.340

如果你在 Windows 上开发，别忘[了 YUI Compressor 有一个 .NET 端口](http://yuicompressor.codeplex.com/)。您可以将所有这些作为 Visual Studio 中的构建后事件，作为 TFS 构建的一部分，或者只是将 dll 导入您的应用程序并在其中使用它（例如，即时压缩）。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T15:23:53.610

您可以尝试 Invoke-Expression cmdlet（iex 是别名）：

```
PS > $cmd = 'java -jar yuicompressor-2.4.2.jar --charset utf-8 jquery-1.3.2.js > scripts-all.min.js'
PS > iex $cmd 
```

# svn - cvs2svn 和合并信息

> ID：632729
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-10T23:46:10.727
> 
>         
> 
> 标签：svn, cvs, cvs2svn

我想使用 cvs2svn 将 CVS 项目转换为 Subversion。它有一个主干（HEAD），以及从主干创建的几个临时开发分支。

在我们转换它之前，我们会将主干中的最新更改合并到所有开发分支中。但它们也会有尚未合并回主干的更改。

当我将项目转换为 SVN 时，它不会有任何合并历史属性。那么如何初始化这些属性，以便随后可以合并到分支和从分支合并？

换句话说，在转换之后，主干和任何给定的分支之间都会有许多差异。下次我从主干合并到分支时，我不想将这些差异视为需要合并的更改。但是当我从分支合并到主干时，我会这样做。这可能吗？

**更新**：我接受了 mhagger 的建议，并告诉 SVN 分支已经从主干合并了所有更改：

```
svn co [branch URL] .
svn merge --record-only [trunk URL]
svn commit -m '' 
```

这行得通，所以下次我尝试从主干合并到分支时，它没有显示新的更改。

但是我仍然对从分支回到主干的 --reintegrate 合并有问题。它最终显示了很多“R”替换的文件，这意味着主干有一个文件 X，分支有一个文件 X，但它们不被认为是同一个文件。这使得合并有点混乱，尽管它似乎最终得到了正确的结果。

我认为发生这种情况是因为以下一系列事件：

*   已创建分支（在 CVS 中）

*   将文件 X 添加到主干（在 CVS 中）

*   X 被合并到分支中（也在 CVS 中）

*   项目已转换为 Subversion

*   Subversion 不知道 branch/X 是从 trunk/X 复制而来的。所以它认为它是一个替代品。

SVN 历史看起来像这样：

```
r100: create branch (copied from trunk)
r200: add trunk/X
r300: add branch/X (because of a CVS merge, but it's not a SVN copy) 
```

那么，我有没有办法告诉 Subversion 在进行 --reintegrate 合并时忽略文件的祖先？还是转换这些文件的更好方法？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T04:29:03.963

您可能知道，cvs2svn 不会生成任何合并元数据，除了关于分支从何处发芽的隐含信息。（它不能，因为 CVS 不记录此类信息。）因此，在转换之后，您必须明确告诉 Subversion 在 CVS 下完成的合并。

最简单的方法是使用“ `svn merge --record-only ...`”，如[Subversion book 中所述](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.advanced.html#svn.branchmerge.advanced.blockchanges)。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-07-10T04:46:06.337

好的，我想我有一个解决上述 --reintegrate 问题的方法，以防万一有人感兴趣。

根据[此文档](http://blogs.open.collab.net/svn/2008/07/subversion-merg.html)，如果我已将最新版本的主干合并到分支中，则执行 --reintegrate 与对主干执行此操作基本相同：

```
svn merge [trunk URL] [branch URL] 
```

但是这种语法允许 --ignore-ancestry，而 --reintegrate 不允许。所以我可以这样做：

```
svn merge --ignore-ancestry [trunk URL] [branch URL] 
```

这向我显示了与 --reintegrate 相同的结果，但没有所有“R”替换文件。唯一的其他区别似乎是 mergeinfo 属性。我不确定这些是否正确，所以最好在之后删除分支，就像在 --reintegrate 之后一样。

# python - 将遗留的 C 程序移植到 Python 的可行性是什么？

> ID：632730
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-10T23:47:15.280
> 
>         
> 
> 标签：python, c

我有一个 C 程序，它通过 UDP 与另一个程序（Java）通信，然后基于 UDP pkt 交换进行进程操作（启动/停止）。现在这个 C 程序已经遗留下来了，我想把它转换成 Python——你认为 Python 会是上述任务的一个不错的选择吗？

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-03-10T23:50:47.673

是的，我确实认为 Python 会是一个很好的替代品。我知道[Twisted](http://twistedmatrix.com/trac/ "扭曲的") Python 框架非常流行。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T00:09:10.453

我会说，如果：

*   您的 C 代码不包含特定于平台的要求

*   你确定速度不会成为从 C 到 python 的问题

*   你有一个不再编译的愿望

*   您想尝试利用异常处理

*   你想涉足 OO

*   您可能会选择在许多平台上运行而无需移植

*   你对动态类型很好奇

*   你想为你处理内存

*   你知道或想学python

那当然，为什么不呢。  

似乎没有任何技术原因你不应该在这里使用 python，所以在这种情况下这是一个偏好。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:53:28.007

还要记住，您可以将程序的一部分保留在 C 中，将它们转换为 Python 模块并围绕它们构建 Python 代码——您无需预先重新编写所有内容。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:29:27.533

如果我遇到类似的情况，我会问自己几个问题：

*   我还有什么更重要的事情可以做吗？

*   Python 是否带来了当前应用程序当前处理不佳的任何内容？

*   这是否允许我添加以前难以实现的功能？

*   这会以任何方式破坏服务吗？

如果我不能令人满意地回答这些问题，那么我会推迟重写。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:57:10.213

是的，如果您的所有平台都支持它，我认为 Python 是一个不错的选择。由于这是一个网络程序，我假设网络是您的运行时瓶颈？在 Python 中可能仍然是这种情况。如果您确实需要加快速度，您可以将调试已久的快速 C 语言作为 Python 模块包含在内。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-10T23:51:08.860

假设您可以控制此应用程序将运行的环境，并且可以忽略解释语言 (python) 与编译语言 (C) 相比的性能，我相信 Python 是一个很好的选择。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T11:08:30.837

如果这是一个嵌入式程序，那么移植它可能是个问题，因为 Python 程序通常依赖于 Python 运行时和库，而且它们相当大。尤其是与执行定义明确的任务的 C 程序相比。当然，您可能已经考虑过这一方面，但无论如何我还是想在问题的上下文中提及它，因为我觉得在进行此类比较时这是一个重要方面。

# javascript - 你可以异步通知网络浏览器吗？

> ID：632731
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-10T23:47:44.310
> 
>         
> 
> 标签：javascript, ajax

我试图弄清楚是否有办法以某种方式通知网络浏览器来自网络服务器的事件。

我知道 Ajax 允许您异步发出更新页面部分的请求。我想我可以有一个计时器定期要求更新。但是，如果可能的话，我宁愿避免使用轮询方案。有没有更好的方法可以继续使用基于浏览器的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-10T23:55:42.357

查看[“彗星”](http://en.wikipedia.org/wiki/Comet_(programming))技术，您基本上保持与服务器的连接，该服务器将数据推回给您。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-10T23:54:54.730

好吧，您可以尝试设置“ignore-user-abort”标志，并确保脚本不会终止（条件时） sleep()）。回显需要传输的信息后，将文本flush() 到浏览器。

但我不会推荐这个解决方案。相反：使用 ajax，并使用轮询方案。大多数最新的框架开箱即用地支持它。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:47:25.213

彗星是您正在寻找的东西。有一些 js 库和 http 服务器使其更易于使用。它基于这样的想法：通过某个请求保持连接打开，并在服务器有内容要流式传输时流回浏览器。您应该知道，浏览器通常可以打开一个非常有限数量的连接到一个域（我认为通常是一个）。如果您想尝试一下，请查看：

[道场彗星](http://cometdproject.dojotoolkit.org/)

[js io](http://js.io/)

[轨道的](http://www.orbited.org/)

[apache tomcat 高级io](http://www.mbaworld.com/docs/aio.html)

如果您喜欢 erlang，请检查以下内容：

[http://yoan.dosimple.ch/blog/2008/05/15/](http://yoan.dosimple.ch/blog/2008/05/15/)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-10T23:59:08.340

> 我想我可以有一个计时器定期要求更新。但是，如果可能的话，我宁愿避免使用轮询方案。

运气不好：这就是你必须做的。Web 建立在请求/响应模型之上：来自浏览器的 1 个请求，来自服务器的 1 个响应，并且始终按此顺序排列。

也就是说，您不必（并且可能不应该）自己构建该轮询方案。您可能会找到一个现有的实现，它抽象出细节并使其看起来像是服务器正在通知客户端。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-10T23:53:24.097

您可以使用部分渲染。我会查看[这篇文章](http://www.articlealley.com/article_163737_11.html)以获取更多信息。

这是关于该主题的[另一篇文章。](http://www.webreference.com/authoring/iframe/)

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:05:14.613

有来自 WHATWG Web Applications 1.0 规范的[服务器发送事件](http://labs.opera.com/news/2006/09/01/)被添加到 Opera 9。Mozilla/Firefox 似乎[正在](https://bugzilla.mozilla.org/show_bug.cgi?id=338583)处理它。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T17:22:17.287

过去我发现了一篇关于 HTML 中流式数据的好文章：

[http://ajaxpatterns.org/HTTP_Streaming](http://ajaxpatterns.org/HTTP_Streaming)

可能有用:)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-08-06T15:05:03.793

[还可以在这里](http://juggernaut.rubyforge.org)查看 RubyOnRails 的主宰

# c# - C# 读取 SQL 表和视图

> ID：632735
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-10T23:49:34.493
> 
>         
> 
> 标签：c#, sql, views

我目前正在读取 SQL 数据库中的表列表并使用表名填充组合框。我想在同一个列表中包含 SQL 视图。表的 sysobjects 类型是“U”，视图是“V”。我将如何更改 OdbcCommand 行以检索 U 和 V？谢谢。

```
OdbcConnection cn=getConnection(); 
OdbcCommand cmdList; 
cmdList = new OdbcCommand("select name, user_name(uid) from sysobjects where type='U'",cn);
cn.Open();

        OdbcDataReader reader = cmdList.ExecuteReader();
        while (reader.Read())
        {
            for (int i=0;i<reader.FieldCount;i++)
            {
                if (!reader.IsDBNull(i))
                {
                    if (reader.GetName(i).ToUpper()=="NAME")
                    {
                            comboBoxTables.Items.Add(reader.GetString(i));
                    }
                }
            }
        }
cn.Close(); 
```

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-10T23:51:09.047

尝试：

```
"... where type='U' or type='V'" 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:08:03.373

您使用的是什么版本的 SQL Server？如果是 Sql 2000 之后的版本，请不要使用 sysobjects，因为它已被弃用。请改用 sys.objects。

此外，您可能应该使用 SMO（SQL Server 管理对象）而不是编写自己的查询。

# ruby-on-rails - 如何避免运行 ActiveRecord 回调？

> ID：632742
> 
>         
> 
> 赞同：153
> 
>         
> 
> 时间：2009-03-10T23:52:22.537
> 
>         
> 
> 标签：ruby-on-rails, ruby, rails-activerecord

我有一些具有 after_save 回调的模型。通常这很好，但在某些情况下，例如在创建开发数据时，我想保存模型而不运行回调。有没有一种简单的方法可以做到这一点？类似于...的东西

```
Person#save( :run_callbacks => false ) 
```

或者

```
Person#save_without_callbacks 
```

我查看了 Rails 文档并没有找到任何东西。然而，根据我的经验，Rails 文档并不总是能说出整个故事。

更新

我发现[一篇博客文章](http://web.archive.org/web/20120701221754/http://blog.viarails.net/2009/1/29/disabling-callbacks-in-an-activerecord-data-migration)解释了如何从这样的模型中删除回调：

```
Foo.after_save.clear 
```

我找不到该方法的记录位置，但它似乎有效。

* * *

## 回答 #1

> 赞同：238
> 
>             
> 
> 时间：2011-09-12T10:08:18.910

使用`update_column`(Rails >= v3.1) 或`update_columns`(Rails >= 4.0) 跳过回调和验证。也用这些方法，**不**`updated_at`更新。

 **```
#Rails >= v3.1 only
@person.update_column(:some_attribute, 'value')
#Rails >= v4.0 only
@person.update_columns(attributes) 
```

[http://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update_column](http://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update_column)

**#2：跳过在创建对象时也有效的回调**

```
class Person < ActiveRecord::Base
  attr_accessor :skip_some_callbacks

  before_validation :do_something
  after_validation :do_something_else

  skip_callback :validation, :before, :do_something, if: :skip_some_callbacks
  skip_callback :validation, :after, :do_something_else, if: :skip_some_callbacks
end

person = Person.new(person_params)
person.skip_some_callbacks = true
person.save 
```

**更新（2020）**

显然 Rails[一直支持`:if`和`:unless`options](https://github.com/rails/rails/blob/aae37bb4f7edd6a1820e420a60560369c6064f33/activesupport/lib/active_support/callbacks.rb#L50)，所以上面的代码可以简化为：

```
class Person < ActiveRecord::Base
  attr_accessor :skip_some_callbacks

  before_validation :do_something, unless: :skip_some_callbacks
  after_validation :do_something_else, unless: :skip_some_callbacks
end

person = Person.new(person_params)
person.skip_some_callbacks = true
person.save 
```

* * *

## 回答 #2

> 赞同：71
> 
>             
> 
> 时间：2009-03-11T04:29:37.333

此解决方案仅适用于 Rails 2。

我刚刚对此进行了调查，我想我有一个解决方案。您可以使用两种 ActiveRecord 私有方法：

```
update_without_callbacks
create_without_callbacks 
```

您将不得不使用 send 来调用这些方法。例子：

```
p = Person.new(:name => 'foo')
p.send(:create_without_callbacks)

p = Person.find(1)
p.send(:update_without_callbacks) 
```

这绝对是您真正想在控制台中或在进行一些随机测试时使用的东西。希望这可以帮助！

* * *

## 回答 #3

> 赞同：30
> 
>             
> 
> 时间：2011-11-30T02:59:48.790

* * *

更新：

@Vikrant Chaudhary 的解决方案似乎更好：

```
#Rails >= v3.1 only
@person.update_column(:some_attribute, 'value')
#Rails >= v4.0 only
@person.update_columns(attributes) 
```

* * *

我原来的答案：

请参阅此链接：  [如何跳过 ActiveRecord 回调？](https://stackoverflow.com/questions/1342761/how-to-skip-activerecord-callbacks)

在 Rails3 中，

假设我们有一个类定义：

```
class User < ActiveRecord::Base
  after_save :generate_nick_name
end 
```

方法1：

```
User.send(:create_without_callbacks)
User.send(:update_without_callbacks) 
```

方法 2：当您想在 rspec 文件或其他文件中跳过它们时，请尝试以下操作：

```
User.skip_callback(:save, :after, :generate_nick_name)
User.create!() 
```

注意：一旦完成，如果您不在 rspec 环境中，您应该重置回调：

```
User.set_callback(:save, :after, :generate_nick_name) 
```

在rails 3.0.5上对我来说很好

* * *

## 回答 #4

> 赞同：26
> 
>             
> 
> 时间：2015-12-09T22:41:27.893

如果目标是在没有回调或验证的情况下简单地插入记录，并且您希望在不使用其他 gem、添加条件检查、使用 RAW SQL 或以任何方式处理现有代码的情况下执行此操作，请考虑使用“影子对象”指向您现有的数据库表。像这样：

```
class ImportedPerson < ActiveRecord::Base
  self.table_name = 'people'
end 
```

这适用于 Rails 的每个版本，是线程安全的，并且完全消除了所有验证和回调，而无需修改现有代码。您可以在实际导入之前将该类声明扔掉，您应该一切顺利。只要记住使用你的新类来插入对象，比如：

```
ImportedPerson.new( person_attributes ) 
```

* * *

## 回答 #5

> 赞同：21
> 
>             
> 
> 时间：2010-11-26T08:03:40.230

导轨 3：  

```
MyModel.send("_#{symbol}_callbacks") # list  
MyModel.reset_callbacks symbol # reset 
```

* * *

## 回答 #6

> 赞同：17
> 
>             
> 
> 时间：2009-03-11T00:02:55.663

你可以在你的 Person 模型中尝试这样的事情：

```
after_save :something_cool, :unless => :skip_callbacks

def skip_callbacks
  ENV[RAILS_ENV] == 'development' # or something more complicated
end 
```

**编辑：** after_save 不是一个符号，但这至少是我第 1000 次尝试将其变为一个符号。

* * *

## 回答 #7

> 赞同：11
> 
>             
> 
> 时间：2013-04-02T23:05:06.450

您可以使用`update_columns`：

```
User.first.update_columns({:name => "sebastian", :age => 25}) 
```

> 更新对象的给定属性，而不调用 save，因此跳过验证和回调。

* * *

## 回答 #8

> 赞同：7
> 
>             
> 
> 时间：2009-03-11T03:07:06.453

防止所有 after_save 回调的唯一方法是让第一个回调返回 false。

也许您可以尝试类似（未经测试）：

```
class MyModel < ActiveRecord::Base
  attr_accessor :skip_after_save

  def after_save
    return false if @skip_after_save
    ... blah blah ...
  end
end

...

m = MyModel.new # ... etc etc
m.skip_after_save = true
m.save 
```

* * *

## 回答 #9

> 赞同：6
> 
>             
> 
> 时间：2010-04-13T05:27:26.520

看起来在 Rails 2.3 中处理此问题的一种方法（因为 update_without_callbacks 已经消失等），将使用 update_all，这是[根据 Rails Guide to validations and callbacks 的第 12 节](http://guides.rubyonrails.org/active_record_validations_callbacks.html#skipping-callbacks)跳过回调的方法之一。

另外，请注意，如果您在 after_ 回调中执行某些操作，它会基于许多关联进行计算（即 has_many assoc，您也可以在其中执行 accept_nested_attributes_for），您将需要重新加载关联，以防作为保存的一部分，其中一名成员被删除。

* * *

## 回答 #10

> 赞同：5
> 
>             
> 
> 时间：2017-02-23T09:57:23.197

`up-voted`在某些情况下，大多数答案可能看起来令人困惑。

`if`如果您想跳过回调，您可以只使用一个简单的检查，如下所示：

```
after_save :set_title, if: -> { !new_record? && self.name_changed? } 
```

* * *

## 回答 #11

> 赞同：3
> 
>             
> 
> 时间：2012-02-24T23:26:42.190

[https://gist.github.com/576546](https://gist.github.com/576546)

只需将此猴子补丁转储到 config/initializers/skip_callbacks.rb

然后

 `Project.skip_callbacks { @project.save }` 

之类的。

所有功劳归于作者

* * *

## 回答 #12

> 赞同：3
> 
>             
> 
> 时间：2013-02-08T18:02:40.113

在不使用 gem 或插件的情况下应该在所有版本的 Rails 中工作的解决方案是直接发出更新语句。例如

```
ActiveRecord::Base.connection.execute "update table set foo = bar where id = #{self.id}" 
```

这可能（也可能不是）是一个选项，具体取决于您的更新有多复杂。这适用于例如从 after_save 回调中更新记录上的标志***（***无需重新触发回调）。

* * *

## 回答 #13

> 赞同：2
> 
>             
> 
> 时间：2014-04-14T08:39:12.737

当我需要完全控制回调时，我会创建另一个用作开关的属性。简单有效：

模型：

```
class MyModel < ActiveRecord::Base
  before_save :do_stuff, unless: :skip_do_stuff_callback
  attr_accessor :skip_do_stuff_callback

  def do_stuff
    puts 'do stuff callback'
  end
end 
```

测试：

```
m = MyModel.new()

# Fire callbacks
m.save

# Without firing callbacks
m.skip_do_stuff_callback = true
m.save

# Fire callbacks again
m.skip_do_stuff_callback = false
m.save 
```

* * *

## 回答 #14

> 赞同：2
> 
>             
> 
> 时间：2016-08-12T15:05:02.940

我需要 Rails 4 的解决方案，所以我想出了这个：

应用程序/模型/关注/save_without_callbacks.rb

```
module SaveWithoutCallbacks

  def self.included(base)
    base.const_set(:WithoutCallbacks,
      Class.new(ActiveRecord::Base) do
        self.table_name = base.table_name
      end
      )
  end

  def save_without_callbacks
    new_record? ? create_without_callbacks : update_without_callbacks
  end

  def create_without_callbacks
    plain_model = self.class.const_get(:WithoutCallbacks)
    plain_record = plain_model.create(self.attributes)
    self.id = plain_record.id
    self.created_at = Time.zone.now
    self.updated_at = Time.zone.now
    @new_record = false
    true
  end

  def update_without_callbacks
    update_attributes = attributes.except(self.class.primary_key)
    update_attributes['created_at'] = Time.zone.now
    update_attributes['updated_at'] = Time.zone.now
    update_columns update_attributes
  end

end 
```

在任何模型中：

```
include SaveWithoutCallbacks 
```

那么你就可以：

```
record.save_without_callbacks 
```

或者

```
Model::WithoutCallbacks.create(attributes) 
```

* * *

## 回答 #15

> 赞同：2
> 
>             
> 
> 时间：2021-05-26T08:57:30.493

使用 Rails 6，您现在可以使用[插入方法](https://api.rubyonrails.org/classes/ActiveRecord/Persistence/ClassMethods.html#method-i-insert_all)

从文档中：

> 在单个 SQL INSERT 语句中将多条记录插入数据库。它不会实例化任何模型，也不会触发 Active Record 回调或验证。尽管传递的值通过 Active Record 的类型转换和序列化。

* * *

## 回答 #16

> 赞同：1
> 
>             
> 
> 时间：2010-10-15T15:26:49.413

这些都没有指向`without_callbacks`只做你需要的插件......

```
class MyModel < ActiveRecord::Base
  before_save :do_something_before_save

  def after_save
    raise RuntimeError, "after_save called"
  end

  def do_something_before_save
    raise RuntimeError, "do_something_before_save called"
  end
end

o = MyModel.new
MyModel.without_callbacks(:before_save, :after_save) do
  o.save # no exceptions raised
end 
```

[http://github.com/cjbottaro/without_callbacks](http://github.com/cjbottaro/without_callbacks)适用于 Rails 2.x

* * *

## 回答 #17

> 赞同：1
> 
>             
> 
> 时间：2010-12-17T07:21:17.203

```
# for rails 3
  if !ActiveRecord::Base.private_method_defined? :update_without_callbacks
    def update_without_callbacks
      attributes_with_values = arel_attributes_values(false, false, attribute_names)
      return false if attributes_with_values.empty?
      self.class.unscoped.where(self.class.arel_table[self.class.primary_key].eq(id)).arel.update(attributes_with_values)
    end
  end 
```

* * *

## 回答 #18

> 赞同：1
> 
>             
> 
> 时间：2011-10-26T03:47:24.943

您可以使用偷偷摸摸的保存宝石：[https](https://rubygems.org/gems/sneaky-save) ://rubygems.org/gems/sneaky-save 。

请注意，这无助于在没有验证的情况下保存关联。它会抛出错误“created_at cannot be null”，因为它与模型不同，它直接插入 sql 查询。为了实现这一点，我们需要更新 db 的所有自动生成的列。

* * *

## 回答 #19

> 赞同：1
> 
>             
> 
> 时间：2012-04-13T14:59:38.227

我在 Rails 3 中编写了一个实现 update_without_callbacks 的插件：

[http://github.com/dball/skip_activerecord_callbacks](http://github.com/dball/skip_activerecord_callbacks)

我认为正确的解决方案是重写你的模型以避免回调，但如果这在短期内不切实际，这个插件可能会有所帮助。

* * *

## 回答 #20

> 赞同：1
> 
>             
> 
> 时间：2012-08-31T11:31:13.770

如果您使用的是 Rails 2。您可以使用 SQL 查询来更新您的列，而无需运行回调和验证。

```
YourModel.connection.execute("UPDATE your_models SET your_models.column_name=#{value} WHERE your_models.id=#{ym.id}") 
```

我认为它应该适用于任何 Rails 版本。

* * *

## 回答 #21

> 赞同：1
> 
>             
> 
> 时间：2014-05-29T16:15:54.443

要在 Rails 中创建测试数据，您可以使用以下 hack：

```
record = Something.new(attrs)
ActiveRecord::Persistence.instance_method(:create_record).bind(record).call 
```

[https://coderwall.com/p/y3yp2q/edit](https://coderwall.com/p/y3yp2q/edit)

* * *

## 回答 #22

> 赞同：1
> 
>             
> 
> 时间：2020-01-16T20:16:52.717

### 对于自定义回调，在回调中使用 an`attr_accessor`和 an `unless`。

如下定义您的模型：

```
class Person << ActiveRecord::Base

  attr_accessor :skip_after_save_callbacks

  after_save :do_something, unless: :skip_after_save_callbacks

end 
```

然后，如果您需要在不点击`after_save`您定义的回调的情况下保存记录，请将`skip_after_save_callbacks`virtual 属性设置为`true`.

```
person.skip_after_save_callbacks #=> nil
person.save # By default, this *will* call `do_something` after saving.

person.skip_after_save_callbacks = true
person.save # This *will not* call `do_something` after saving.

person.skip_after_save_callbacks = nil # Always good to return this value back to its default so you don't accidentally skip callbacks. 
```

* * *

## 回答 #23

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T09:18:13.440

为什么您希望能够在开发中做到这一点？当然，这意味着您正在使用无效数据构建应用程序，因此它的行为会很奇怪，而不是您在生产中所期望的那样。

如果您想用数据填充您的开发数据库，​​更好的方法是构建一个 rake 任务，该任务使用 faker gem 来构建有效数据并将其导入到数据库中，创建任意多或少的记录，但如果您是脚后跟坚持下去并有充分的理由我想 update_without_callbacks 和 create_without_callbacks 可以正常工作，但是当您尝试按照自己的意愿弯曲轨道时，请问问自己您有充分的理由，以及您正在做的事情是否真的是个好主意。

* * *

## 回答 #24

> 赞同：0
> 
>             
> 
> 时间：2009-08-14T21:44:58.207

另一种方法是使用验证钩子而不是回调。例如：

```
class Person < ActiveRecord::Base
  validate_on_create :do_something
  def do_something
    "something clever goes here"
  end
end 
```

这样，您可以默认获取 do_something，但您可以轻松地使用以下命令覆盖它：

```
@person = Person.new
@person.save(false) 
```

* * *

## 回答 #25

> 赞同：0
> 
>             
> 
> 时间：2011-06-06T19:00:06.317

一种选择是为此类操作使用单独的模型，使用同一个表：

```
class NoCallbacksModel < ActiveRecord::Base
  set_table_name 'table_name_of_model_that_has_callbacks'

  include CommonModelMethods # if there are
  :
  :

end 
```

（同样的方法可能会使绕过验证的事情变得更容易）

斯蒂芬

* * *

## 回答 #26

> 赞同：0
> 
>             
> 
> 时间：2016-03-07T05:17:11.590

应该适用于所有版本的东西，`ActiveRecord`而不取决于可能存在或不存在的选项或 activerecord 方法。

```
module PlainModel
  def self.included(base)
    plainclass = Class.new(ActiveRecord::Base) do
      self.table_name = base.table_name
    end
    base.const_set(:Plain, plainclass)
  end
end

# usage
class User < ActiveRecord::Base
  include PlainModel

  validates_presence_of :email
end

User.create(email: "")        # fail due to validation
User::Plain.create(email: "") # success. no validation, no callbacks

user = User::Plain.find(1)
user.email = ""
user.save 
```

TLDR：在同一张表上使用“不同的活动记录模型”

* * *

## 回答 #27

> 赞同：0
> 
>             
> 
> 时间：2020-08-14T00:24:38.383

当我想运行 Rake 任务但没有为我保存的每条记录运行回调时，我遇到了同样的问题。这对我有用（Rails 5），它必须适用于几乎所有版本的 Rails：

```
class MyModel < ApplicationRecord
  attr_accessor :skip_callbacks
  before_create :callback1
  before_update :callback2
  before_destroy :callback3

  private
  def callback1
    return true if @skip_callbacks
    puts "Runs callback1"
    # Your code
  end
  def callback2
    return true if @skip_callbacks
    puts "Runs callback2"
    # Your code
  end
  # Same for callback3 and so on....
end 
```

它的工作方式是它只在方法的第一行返回 true，它的 skip_callbacks 为 true，因此它不会运行方法中的其余代码。要跳过回调，您只需在保存、创建、销毁之前将 skip_callbacks 设置为 true：

```
rec = MyModel.new() # Or Mymodel.find()
rec.skip_callbacks = true
rec.save 
```

* * *

## 回答 #28

> 赞同：-7
> 
>             
> 
> 时间：2009-03-10T23:59:26.513

不是最干净的方法，但您可以将回调代码包装在检查 Rails 环境的条件中。

```
if Rails.env == 'production'
  ... 
```

# django-models - Django 模型 - 在保存之前有条件地将对象添加到 ManyToManyField

> ID：632744
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-10T23:53:19.540
> 
>         
> 
> 标签：django-models

下面的不太行，它的目的是：

保存后，检查'operators'中是否存在'supervisor'，如果没有则添加。

```
class JobRecord(models.Model):
    """JobRecord model"""

    project             = models.ForeignKey(Project)
    date                = models.DateField()
    supervisor          = models.ForeignKey(User, related_name='supervisor_set')

    operators           = models.ManyToManyField(User, related_name='operators_set', help_text='Include the supervisor here also.')

    vehicles            = models.ManyToManyField(Vehicle, blank=True, null=True)

    def __unicode__(self):
        return u"%s - %s" % (self.project.name,  self.date.strftime('%b %d'))

    # --- over ride methods ---- #

    def save(self, **kwargs):
        # this must be done to get a pk
        super(JobRecord, self).save(**kwargs)

        # which makes this comparison possible
        if self.supervisor not in self.operators.__dict__:
            self.operators.add(self.supervisor)

        # it seems to get this far ok, but alas, the second save attempt
        # does not seem to work!
        print self.operators.values()
        super(JobRecord, self).save(**kwargs) 
```

感谢您的专业知识，将是“专家”！

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T03:27:45.157

您可以执行以下操作来检查主管是否在操作员中：

```
if self.operators.filter(id=self.supervisor.id).count() == 0: 
```

并且您不需要在修改多对多字段后再次保存。（多对多关系存储在它们自己的表中。）

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T03:55:08.133

好的，我已经修改了以下内容。实际上，任何一个条件似乎都可以解决问题。现在的问题是 add() 方法对我不起作用。

```
#...

def save(self, **kwargs):
    super(JobRecord, self).save(**kwargs)

    if self.operators.filter(id=self.supervisor.id).count() == 0:
    #if self.supervisor not in self.operators.values():

        # either conditional will get to this point
        self.operators.add(self.supervisor) # <-- this line doesn't save proper? 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-26T15:05:00.240

我有同样的问题。如果您使用的是 django 表单，请在保存表单后进行检查，然后在其中添加多对多。这是我能绕过它的唯一方法。

# windows - NAT 后网络的命令行/Powershell 管理

> ID：632754
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-10T23:56:26.037
> 
>         
> 
> 标签：windows, powershell, remoting, system-administration, remote-administration

设想。第 3 方管理员希望通过 PS 远程处理/直接登录 NAT 网关后面的客户端和服务器来管理系统。

这些系统是 SBS 2003 或 W2K3。所有这些都位于具有不同 RFC1918 子网的 NAT 防火墙后面，并且没有站点到站点的 VPN（尽管解决方案可能需要这样做。）每个站点都有自己不相关的 AD 设置。

第 3 方管理网络（也在 NAT 之后）与目标站点没有信任关系（显然 SBS 站点默认存在此问题，如果双方使用相同的 RFC1918 子网地址范围，VPN 似乎会出现问题。

跨 VPN 的名称解析将是先决条件。建议

是否有一些“反射”方法（类似于 Ultra VNC 可以序列化 PS 对象并通过 NAT 传递它们而无需重新配置路由器？或者直接远程登录需要端口转发到 SSH 或类似方法？这些都可以在不使用的情况下完成或自动化吗？一只老鼠？

什么 .NET 远程处理方法可能有助于解决这个问题？

nsoftware Powershell 服务器解决方案似乎适用于 SSH，但仅适用于可公开寻址的机器，并且由于其每个 CPU 许可方案而打折。还有其他类似的替代品吗？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:15:38.410

您可能最好找到一种方法通过隧道连接到一台机器，然后从那里跳到您要管理的机器。您需要将端口转发到第一台机器。

你的网络安全人员应该很关心这台机器；如果不是，他们就不知道自己的工作。  

我的第一种方法是对两个跃点都使用 PowerShell V2 的远程处理。  

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T19:59:11.250

我同意@JayBazuz，i Powershell V2（目前在 CTP3 中）使用 WinRM，它可以配置为通过 HTTPS（实际上是您选择的任何端口）工作，从而通过防火墙和 NATS 工作。

詹姆士

# algorithm - 广告轮播：确定何时以及应该在页面上显示什么广告的最佳方法是什么？

> ID：632760
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-11T00:00:12.923
> 
>         
> 
> 标签：algorithm, random

我正在为其创建网站的客户想要一个自定义广告“引擎”。计划是在网站上放一些广告，然后用 Google Adsense 填充其余的广告，直到所有广告位都满了。

我的问题是如何确定要展示的广告。（现在假设我只有 1 个广告展示位置。）我的想法是我会有一张桌子：

*   年

*   月

*   本月展示次数（0 表示无限制）

*   使用过的印象

*   客户

*   展示广告的 HTML 代码

我可以做一些事情来获取广告：

```
SELECT * 
FROM ad 
WHERE impressions > used_impressions 
    OR impressesions = 0 
ORDER BY RAND() 
LIMIT 1 
```

但是，假设我有 3 个广告：

*   1 个广告 -- 5000 次展示

*   1 个广告 -- 5000 次展示

*   Google Adsense 填补了网站点击次数的提醒

从统计上讲，所有 3 个广告都将显示相同的次数。到第一周结束时，网站上的点击量达到 15000 次，前 2 个广告将用完所有展示次数以及该月剩余的 3 周以上，并且不会再次展示；只会显示 Google Adsense。

我如何隔开广告，以便它们在一个月内分布？

我正在使用灯。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:23:03.383

达里尔，

我建议按天分解广告展示次数，以便

1 个广告 -- 5000/(monthsToDisplay/30)

这将为您提供每天需要投放的一些展示次数，并且应该有助于在几周内很好地分发内容。因此，假设您有这些变量或数据库字段：

总印象数 = 5000；

dailyImpressions = totalImpressions/(monthsToDisplay/30)

然后你可以做类似的事情：

```
SELECT * FROM ad WHERE (totalImpressions > used_impressions AND dailyImpressions > used_dailyImpressions) OR impresses = 0 ORDER BY RAND() LIMIT 1
```

希望这是有道理的——现在是清晨，但我稍后再回来看看！

贝尔蒂

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-29T00:26:57.927

您正在谈论 AdServing 类型的技术。有多种方法可以确定应该展示哪个广告。

上面描述的 Event 传递场景通常被称为“Even Flighting”。这意味着，广告将在活动期间均匀投放。这并不总是最好的。有时广告商只想要交付。

“偶数飞行”不应单独实施。您应该首先实施“频率上限”。这意味着向同一个人投放同一广告的次数不会超过设定的次数。例如，如果用户在看到广告 5 次后没有点击它，那么他们就不会点击。在这种情况下，您应该投放另一个广告。

结合此方法，您将确定一天需要提供多少展示次数。然后以每个用户为基础。确定用户看到广告的次数。如果他们有资格再次看到它，则显示它.. 否则.. 显示 adsense。

但是，您最好建议使用免费的广告服务器，例如 Google Ad Manager 或 OpenX。他们已经解决了所有这些问题，没有必要重新发明轮子。

# visual-studio-2008 - VS2008：调试时断点窗口消失了？

> ID：632761
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-11T00:00:40.020
> 
>         
> 
> 标签：visual-studio-2008, breakpoints

这可能很愚蠢，但非常令人沮丧。

将VS2008与C++项目一起使用，当我正常工作时，断点窗口可见且处于活动状态，但是当我调试时它消失并且无法显示。如果我想在运行时编辑断点的条件，这是一个问题。按断点窗口按钮不执行任何操作，按 Ctrl+Alt+B 也不执行任何操作

这会发生在其他人身上吗？这是一个全新的安装，带有 Visual Assist 和 QT 集成作为扩展。与VS2005相同的配置没有任何问题。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:18:03.880

您可以尝试通过使用以下命令行启动 Visual Studio 来重置 Visual Studio 布局：

```
devenv.exe /resetuserdata 
```

[MSDN 上的](http://msdn.microsoft.com/en-us/library/bb245788(vs.80).aspx#vs05idetips_topic6)更多信息

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-04-16T20:05:44.097

解决方案是使用“然后”导出设置`"Tools->Import and Export Settings"`，使用相同的向导将设置重置为默认值，然后在重新导入保存的设置文件时取消选中导入列表中的“Windows 布局”项。

这使我可以保存我以前的所有设置并仅重置窗口布局，而不是断点窗口最终可见。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-10-28T09:25:29.860

[调试] -> [Windows] -> [断点]

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2012-05-15T19:10:17.417

转到工具-> 自定义。选择命令选项卡 单击底部的“重新排列命令”按钮。选择顶部单选按钮上的“菜单栏”。在它前面的下拉菜单中，选择“调试 | 视窗'。单击右侧的“添加”按钮，将打开“添加命令”提示。选择左侧的“调试”，右侧的断点，然后单击“确定”按钮。现在您应该能够在“Debug->Windows”菜单中看到“Breakpoints”。选择它以弹出窗口。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-04-15T12:24:41.640

有一个菜单项 Window->Reset Window Layout。

# c# - 将 System.Web.Mail 功能移植到 System.Net.Mail

> ID：632763
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-11T00:00:44.203
> 
>         
> 
> 标签：c#, system.net.mail, system.web.mail

以下功能完美运行：

```
 protected void SendWebMailMessage(string DisplayName, string From, string ReplyTo,
        string To, string Subject, string Body, string Attachments)
    {
        System.Web.Mail.MailMessage msg = new System.Web.Mail.MailMessage();
        msg.Fields.Add("http://schemas.microsoft.com/cdo/configuration/smtpserver",
             "smtpout.secureserver.net");
        msg.Fields.Add(
             "http://schemas.microsoft.com/cdo/configuration/smtpserverport", 25);
        msg.Fields.Add("http://schemas.microsoft.com/cdo/configuration/sendusing", 
             2);
        msg.Fields.Add(
             "http://schemas.microsoft.com/cdo/configuration/smtpauthenticate", 1);
        msg.Fields.Add(
             "http://schemas.microsoft.com/cdo/configuration/sendusername", From);
        msg.Fields.Add(
             "http://schemas.microsoft.com/cdo/configuration/sendpassword",
             mailpassword);
        msg.To = To;
        msg.From = DisplayName + "<" + From + ">";
        msg.BodyFormat = MailFormat.Html;
        msg.Subject = Subject;
        msg.Body = Body;
        msg.Headers.Add("Reply-To", ReplyTo);
        SmtpMail.SmtpServer = "smtpout.secureserver.net";
        SmtpMail.Send(msg);
    } 
```

但是，我收到一个构建警告，告诉我 System.Web.Mail 已过时，我应该使用 System.Net.Mail。所以我使用了 System.Net.Mail，我想出了以下函数来替换我的旧函数：

```
 protected void SendNetMailMessage(string DisplayName, string From, string ReplyTo, 
        string To, string Subject, string Body, string Attachments)
    {
        MailAddress addrfrom = new MailAddress(From, DisplayName);
        MailAddress addrto = new MailAddress(To);
        MailAddress replytoaddr = new MailAddress(ReplyTo);
        System.Net.Mail.MailMessage msg = new System.Net.Mail.MailMessage();
        msg.From = addrfrom;
        msg.To.Add(addrto);
        msg.ReplyTo = replytoaddr;
        msg.IsBodyHtml = true;
        SmtpClient smtp = new SmtpClient("smtpout.secureserver.net");
        smtp.Credentials = new NetworkCredential(From, mailpassword);
        smtp.Send(msg);
    } 
```

我没有收到任何异常或错误，但我的消息永远不会通过。谁能告诉我我可能做错了什么？提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T02:01:25.847

我在上面测试了你的代码，它工作正常。我必须添加正文和主题属性，但即使没有它们，我仍然收到一封空白电子邮件。我也尝试过提供和不提供凭据，两者都有效。

最初，我没有更改您的主机字符串，但确实收到了异常消息“发送邮件失败”。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T02:14:20.823

如果我没记错的话……您正在使用 Goddaddy 托管。我也在使用它......我有`**relay-hosting.secureserver.net**`作为 SMTP 服务器。我不知道......可能是这样的......或者你没有在你的控制台中设置中继。

# javascript - 静态图像的图像加载

> ID：632765
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-11T00:00:48.133
> 
>         
> 
> 标签：javascript, events

我知道要使图像 onload 工作，您必须在附加 onload 处理程序后设置 src 。但是，我想将 onload 处理程序附加到我的 HTML 中的静态图像。现在我通过以下方式执行此操作（使用 jQquery）：

```
<img id='img1' src='picture.jpg'> 
```

```
$('#img1').load( function() {
 alert('foo');
})
.attr('src', $('img1').attr('src')); 
```

但这相当难看，并且有明显的流程，它只能用于只匹配一个图像的选择器。还有其他更好的方法吗？

**编辑**

我的意思是，它只能用于只匹配一个图像的选择器是这样做时：

```
<img class='img1' src='picture.jpg'>
<img class='img1' src='picture2.jpg'> 
```

```
$('.img1').load( function() {
 alert('foo');
})
.attr('src', $('.img1').attr('src')); 
```

这两个图像都将具有 src='picture.jpg'

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-03-11T01:55:15.690

`.trigger()`您可以通过调用或直接触发事件（或它的处理程序）`.load()`。

如果你知道你想要这个事件，因为你知道图像已经加载，那么你可以这样做：

```
$('#img1').load(function() {
    alert('foo');
  })
  .trigger('load');  // fires the load event on the image 
```

如果您在准备好文档或某个时刻尚不清楚图像是否存在的情况下运行脚本，那么我将使用以下内容：

```
$('img.static')
  .load(function(){
    alert('foo');
    return false; // cancel event bubble
  })
  .each(function(){
    // trigger events for images that have loaded,
    // other images will trigger the event once they load
    if ( this.complete && this.naturalWidth !== 0 ) {
      $( this ).trigger('load');
    }
  }); 
```

请注意，加载事件会冒泡（jQuery 1.3），如果您不取消 img 处理程序中的气泡，您可能会过早地触发文档上的加载处理程序。

记录在案：`img.src=img.src`不幸的是，触发解决方案在 Safari 上无法正常工作。您需要将其设置`src`为其他内容（例如 # 或 about:blank），然后返回以进行重新加载。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-17T19:47:05.633

好的，我把 Borgars 的回答变成了一个插件，这里是：

```
$.fn.imageLoad = function(fn){
    this.load(fn);
    this.each( function() {
        if ( this.complete && this.naturalWidth !== 0 ) {
            $(this).trigger('load');
        }
    });
} 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:04:08.767

我想这确实是一个关于 jQuery 选择器的问题。如果您想匹配所有图像元素，则可以使用`img`而不是`#img1`作为选择器。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:08:25.680

在需要此功能的图像中添加一个类，并在 jQuery 选择器中使用该类。

```
$('.static-image').load( function(){ ... } ); 
```

# javascript - XMLHttpRequest 中不同的就绪状态是什么意思，我该如何使用它们？

> ID：632774
> 
>         
> 
> 赞同：113
> 
>         
> 
> 时间：2009-03-11T00:03:48.657
> 
>         
> 
> 标签：javascript, ajax, xmlhttprequest, readystate

`XMLHttpRequest`有 5`readyState`秒，我只使用其中的 1 个（最后一个，`4`）。

其他的有什么用，我可以在哪些实际应用中使用它们？

* * *

## 回答 #1

> 赞同：173
> 
>             
> 
> 时间：2009-03-11T00:14:35.027

值的完整列表`readyState`是：

```
State  Description
0      The request is not initialized
1      The request has been set up
2      The request has been sent
3      The request is in process
4      The request is complete 
```

（来自[https://www.w3schools.com/js/js_ajax_http_response.asp](https://www.w3schools.com/js/js_ajax_http_response.asp)）

在实践中，除了 4 之外，您几乎从不使用它们中的任何一个。

*一些*`responseText`XMLHttpRequest 实现可能会让您在when中看到部分接收到的响应`readyState==3`，但这不是普遍支持的，也不应该依赖。

* * *

## 回答 #2

> 赞同：32
> 
>             
> 
> 时间：2014-04-17T09:28:31.927

[kieron](https://stackoverflow.com/users/588/kieron)的答案包含 w3schools 参考。没有人依赖，
 [bobince](https://stackoverflow.com/users/18936/bobince)的答案给出了链接，它实际上告诉了 IE 的本机实现，

所以这里是引用的原始文档，以正确理解 readystate 代表什么：

> XMLHttpRequest 对象可以处于多种状态。readyState 属性必须返回当前状态，该状态必须是以下值之一：
> 
>   
>   
> 
> UNSENT (数值 0)
> 
>      对象已被构造。
> 
>   
>   
> 
> OPENED（数值 1）
> 
>      open() 方法已成功调用。在此状态期间，可以使用 setRequestHeader() 设置请求标头，并且可以使用 send() 方法发出请求。
> 
>   
>   
> 
> HEADERS_RECEIVED（数值 2）
> 
>      已遵循所有重定向（如果有）并且已收到最终响应的所有 HTTP 标头。该对象的几个响应成员现在可用。
> 
>   
>   
> 
> LOADING（数值 3）
> 
>      正在接收响应实体主体。
> 
>   
>   
> 
> DONE（数值 4）
> 
>      数据传输已完成或传输过程中出现问题（例如无限重定向）。

请在此处阅读：[W3C 对 ReadyState 的解释](https://xhr.spec.whatwg.org/#dom-xmlhttprequest-readystate)

* * *

## 回答 #3

> 赞同：22
> 
>             
> 
> 时间：2009-03-11T00:15:27.863

[原始权威文档](http://msdn.microsoft.com/en-us/library/ms534361(VS.85).aspx)

`0`，`1`并且`2`只跟踪到目前为止您调用了多少必要的方法来发出请求。

`3`告诉您服务器的响应已经开始进入。但是当您使用`XMLHttpRequest`网页中的对象时，您几乎无法使用该信息（*），因为您无权访问允许的扩展属性您读取部分数据。

readyState`4`是唯一具有任何意义的状态。

（*：我能想到的用于检查 readyState 的唯一可能用途`3`是它在服务器端发出某种生命形式的信号，因此您可能会增加在收到完整响应时等待完整响应的时间。）

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2015-08-06T10:27:31.303

onreadystatechange 存储每次 readyState 属性更改时自动调用的函数（或函数名称） readyState 保存 XMLHttpRequest 的状态。从 0 到 4 的变化：

0：请求未初始化

1：服务器连接建立

2：收到请求

3：处理请求

4：请求完成，响应就绪

状态 200：“确定”

404页面不存在

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2018-01-09T09:55:52.693

*   0 : UNSENT 客户端已创建。open() 尚未调用。

*   1：已调用 OPENED open()。

*   2 : HEADERS_RECEIVED send() 已被调用，并且标头和状态可用。

*   3 : LOADING 下载；responseText 保存部分数据。

*   4 : DONE 操作完成。

（来自 https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState）

# jquery - jquery get() 咀嚼数据？

> ID：632780
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T00:06:37.650
> 
>         
> 
> 标签：jquery, ajax

我正在尝试使用 get() 和 filter() 检索整个网页的特定部分。当页面仅包含我要过滤的部分时，这可以正常工作，但如果我输入整个页面，则它不起作用。

例子：

```
 $(document).ready(function() {
        $.get("source.html", function(data) {

            $(data).filter(".spad").appendTo("#loadArea");
        });         
    }); 
```

如果来源是：

```
<table class="spad" border="0" cellpadding="0" cellspacing="0"><thead><tr class="head"><th>&nbsp;</th><th class="sep">&nbsp;</th><th class="sep">&nbsp;</th><th id="h_a_5_0" colspan="2" class="sep">Length of day</th><th id="h_a_8_0" colspan="3" class="sep">Solar noon</th></tr><tr class="head"><th rowspan="2">Date</th><th class="sep" rowspan="2">Sunrise</th><th class="sep" rowspan="2">Sunset</th><th class="sep" rowspan="2">This day</th><th class="sep" rowspan="2">Difference</th><th class="sep" rowspan="2">Time</th><th class="sep" rowspan="2">Altitude</th><th class="sep NULL">Distance</th></tr><tr class="head"><th class="sep smaller">(10<sup>6</sup> km)</th></tr></thead><tbody><tr class="c0"><td>Mar 2, 2009</td><td>5:41 AM</td><td>6:19 PM</td><td>12h 37m 36s</td><td>&#8722; 1m 37s</td><td>12:00 Noon</td><td>69.7° </td><td>148.258</td></tr><tr class="c1"><td>Mar 3, 2009</td><td>5:42 AM</td><td>6:18 PM</td><td>12h 35m 58s</td><td>&#8722; 1m 37s</td><td>12:00 Noon</td><td>69.4° </td><td>148.294</td></tr><tr class="c0"><td>Mar 4, 2009</td><td>5:42 AM</td><td>6:17 PM</td><td>12h 34m 20s</td><td>&#8722; 1m 38s</td><td>12:00 Noon</td><td>69.0° </td><td>148.331</td></tr><tr class="c1"><td>Mar 5, 2009</td><td>5:43 AM</td><td>6:16 PM</td><td>12h 32m 42s</td><td>&#8722; 1m 38s</td><td>11:59 AM</td><td>68.6° </td><td>148.367</td></tr><tr class="c0"><td>Mar 6, 2009</td><td>5:43 AM</td><td>6:15 PM</td><td>12h 31m 03s</td><td>&#8722; 1m 38s</td><td>11:59 AM</td><td>68.2° </td><td>148.405</td></tr><tr class="c1"><td>Mar 7, 2009</td><td>5:44 AM</td><td>6:13 PM</td><td>12h 29m 25s</td><td>&#8722; 1m 38s</td><td>11:59 AM</td><td>67.8° </td><td>148.442</td></tr><tr class="c0"><td>Mar 8, 2009</td><td>5:45 AM</td><td>6:12 PM</td><td>12h 27m 46s</td><td>&#8722; 1m 38s</td><td>11:59 AM</td><td>67.4° </td><td>148.480</td></tr></tbody></table> 
```

它工作正常。

如果我将脚本指向（或在本地下载，这不是跨域 ajax 请求）[http://www.timeanddate.com/worldclock/astronomy.html?n=47](http://www.timeanddate.com/worldclock/astronomy.html?n=47)什么都没有出现。

关于我可能会出错的任何提示？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:19:44.017

你不想要[`filter()`](http://docs.jquery.com/Traversing/filter)；`filter()`从集合中删除与给定表达式不匹配的元素。你想要[`find()`](http://docs.jquery.com/Traversing/find)：

```
$(data).find(".spad").appendTo("#loadArea"); 
```

# asp.net - 用户控制从内容页面的母版页访问 Javascript

> ID：632781
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-11T00:07:08.977
> 
>         
> 
> 标签：asp.net, javascript, user-controls, master-pages

大家好，我有问题。我有一个母版页，我的所有内容页面都继承自该母版页。在此母版页中，我有一个指向 Javascript 文件夹的脚本标记`~/Scripts/validation.js`

在我的内容页面上，我使用了不同的用户控件，这些用户控件需要使用`validation.js`文件中的许多功能，但是如果我没有将`<script>`标签和 Javascript 函数放在内容页面上的内容持有者中，则用户控件看不到这些功能，我会收到错误，`OnNameValidation`例如没有定义的。

当然，我可以将 Javascript 代码复制到所有页面中，但如果我在其中一个 Javascript 函数中发现错误，那就是 30 多页和维护噩梦。

所以问题（如果你还没有从我的长论文中弄清楚的话）是我如何用validation.js文件的路径声明脚本标签，以便内容页面及其用户控件等可以访问函数/代码。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2011-10-13T19:42:44.263

我目前正在我的站点中执行此操作，方法是转到母版页上的源代码并将以下内容放在 ContentPlaceHolder 的头部和外部。

```
<head>
    <asp:ContentPlaceHolder ID="HeadContent" runat="server">
    </asp:ContentPlaceHolder>

    <script src="CP.js" type="text/javascript"></script>
</head> 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-04-15T23:38:24.720

您正在尝试做的事情应该有效，所以我怀疑您的 javascript 文件的路径是错误的（我只能假设没有看到您的 html 代码）。请记住，如果您在 HEAD runat="server" 标记中有链接，则只能像这样引用 javascript 文件：“~/Scripts/validation.js”。没有 runat="server" 它将找不到文件。你必须做类似“../scripts/validation.js”的事情

作为测试，我会尝试在母版页中调用您的 javascript 函数，这样您就可以排除错误的文件引用。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-12-31T07:30:24.373

您为 js 文件分配的路径可能在所有页面中都不匹配。

```
script src="../JavaScript/Scriptaculous/scriptaculous.js" 
```

如果您有单独的 Scripts、MasterPages、Pages & Controls 文件夹，它应该有类似上面的内容。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-12-23T20:03:22.990

我从 ScottGu[那里](http://weblogs.asp.net/scottgu/archive/2008/11/21/jquery-intellisense-in-vs-2008.aspx)得到了这个提示。

将此添加到您的用户控件中，该控件在用户控件中启用 Intellisense，但始终评估为 false：

```
<% if (false) { %>
   <script src="/Scripts/validation.js" type="text/javascript"></script>
<% } %> 
```

# java - 多人游戏的服务器架构？

> ID：632793
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-03-11T00:10:47.300
> 
>         
> 
> 标签：java, architecture, multiplayer

我正计划构建一个小型多人游戏，可以在 Web 浏览器中作为 Java 小程序或 Flash 文件运行。我以前没有做过任何服务器编程，所以我想知道我应该拥有什么样的服务器架构。

我很容易在服务器上创建 perl/php 文件，java/flash 代码会联系这些文件以更新玩家位置/动作等。但我正在考虑是否应该获得一个专用的网络主机，哪个操作系统使用哪个数据库等。此外，使用的带宽量和可扩展性也是一个考虑因素。

另一种选择可能是使用云托管系统（而不是专用服务器），因此他们会随着游戏的发展增加额外的机器。只要每台服务器都运行核心 perl/php 文件来更新数据库，它就可以正常工作。

另一种选择可能是使用谷歌应用引擎。

关于服务器架构、操作系统/数据库选择以及我使用 perl/php/python 脚本进行服务器端编程的方法是否是好的方法，我们将不胜感激！

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-03-11T00:24:21.290

你需要更清楚地了解游戏，更多地考虑架构而不是具体的实现细节。

主要问题是您的游戏是实时的、基于回合的还是基于长延迟的（例如，电子邮件国际象棋）。另一个问题是您是否要冻结状态以进行后续重新加载。

我强烈建议提前弄清楚同一游戏中的所有玩家是否都将托管在同一服务器上（例如，4 场比赛中的 1000 场比赛与每场 1000 名球员的 4 场比赛相比）。如果可能，请先使用同一服务器下同一游戏中的每个人。您将很难将多个客户端同步到一个服务器，而不是让多个服务器同步播放器。否则，一致性的定义是有问题的。

如果可能，让每个客户端与服务器通信，然后服务器将更新分发给客户端。这样您就拥有了一个“官方状态”，并且可以进行各种冲突解决、幻像等。点对点在更快的游戏（例如，FPS）中提供更好的性能，但会带来大量问题。

我一辈子都看不到任何令人信服的理由来做这件事和 perl 或 PHP。你的游戏不是基于网络的，为什么要用面向网络的语言编写它？为服务器使用良好的旧 J2EE，并通过 XML 和 AJAX 与您的客户端交换数据。如果可能，请在客户端而不是 servlet 上运行真正的 Java 应用程序。然后，您可以从使用 JMS 中受益，它可以通过为您抽象出大量通信细节来减轻您的负担。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-03-11T00:18:56.967

对于您的服务器架构，您可以查看[三环的代码](http://www.threerings.net/code/)。他们用 Java（客户端和服务器端）编写了许多非常可扩展的游戏。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2011-08-20T14:29:29.023

我也不鼓励使用 PHP，HTTP 也不是最好的主意，因为它是无状态且健谈的。我在公司工作了一段时间，目前正在开发大型多人游戏。后端是普通的 JVM（由多个客户端通过 tomcat 连接，每个客户端从手机连接）。因此，我知道您传输的数据越少，服务器上所需的缓冲区就越小 -> 一台机器上的客户端越多，响应速度也就越快。还要考虑安全性，https 是相当昂贵的，尤其是如果您需要传输图形和声音。您自己的带有非浏览器客户端容器的二进制协议会做得最好（好的选择是开发调试时间的可切换协议）。也许听起来很复杂，但事实并非如此。

@Sarah 很好的提示，也谢谢 ;)

# regex - 你如何评论 Perl 正则表达式？

> ID：632795
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2009-03-11T00:12:13.287
> 
>         
> 
> 标签：regex, perl, comments

如何在 Perl 正则表达式中添加注释？

* * *

## 回答 #1

> 赞同：24
> 
>             
> 
> 时间：2009-03-11T00:12:56.217

使用 /x 修饰符：

```
my $foo = "zombies are the bombies";
if ($foo =~ /
             zombie  # sorry pirates
            /x ) {
    print "urg. brains.\n";
} 
```

另请参阅 perlfaq6 中的[第一个问题](http://perldoc.perl.org/perlfaq6.html#How-can-I-hope-to-use-regular-expressions-without-creating-illegible-and-unmaintainable-code%3f)。  

[此外，在您阅读perlre](http://perldoc.perl.org/perlre.html)时阅读所有内容也不会有什么坏处。

* * *

## 回答 #2

> 赞同：18
> 
>             
> 
> 时间：2009-03-11T00:30:24.537

即使没有 /x 修饰符，您也可以在 (?# ... ) 中包含注释：

```
my $foo = "zombies are the bombies";
if ( $foo =~ /zombie(?# sorry pirates)/ ) {
    print "urg. brains.\n";
} 
```

# apache-flex - 如何处理 Actionscript 中的数字精度？

> ID：632802
> 
>         
> 
> 赞同：18
> 
>         
> 
> 时间：2009-03-11T00:15:24.480
> 
>         
> 
> 标签：apache-flex, actionscript-3, actionscript

我使用 BlazeDS 将 BigDecimal 对象序列化为 Actionscript。一旦它们将 Actionscript 作为 Number 对象命中，它们的值如下：

`140475.32`变成`140475.31999999999998`

我该如何处理？问题是，如果我使用精度为 2的[NumberFormatter](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/globalization/NumberFormatter.html)`140475.31` ，则该值将被截断为. 有任何想法吗？

* * *

## 回答 #1

> 赞同：33
> 
>             
> 
> 时间：2009-03-11T00:47:48.363

这是我对这个问题的通用解决方案*（我[在这里写过关于这个的博客](http://fraserchapman.blogspot.com/2007/05/rounding-to-specific-decimal-places.html)）*：

```
var toFixed:Function = function(number:Number, factor:int) {
  return Math.round(number * factor)/factor;
} 
```

*例如：*

```
trace(toFixed(0.12345678, 10)); //0.1 
```

*   乘以; `0.12345678`_ `10`这给了我们`1.2345678`。

*   当我们四舍五入时，`1.2345678`我们得到`1.0`

*   最后，`1.0`除以`10`equals `0.1`。

*另一个例子：*

```
trace(toFixed(1.7302394309234435, 10000)); //1.7302 
```

*   乘以; `1.7302394309234435`_ `10000`这给了我们`17302.394309234435`。

*   当我们四处走动时，`17302.394309234435`我们得到`17302`，

*   最后，`17302`除以`10000`equals `1.7302`。

* * *

**编辑**

根据[下面](https://stackoverflow.com/a/1541929/74861)的匿名答案，方法上的参数有一个很好的简化，使精度更加直观。*例如：*

```
var setPrecision:Function = function(number:Number, precision:int) {
 precision = Math.pow(10, precision);
 return Math.round(number * precision)/precision;
}

var number:Number = 10.98813311;
trace(setPrecision(number,1)); //Result is 10.9
trace(setPrecision(number,2)); //Result is 10.98
trace(setPrecision(number,3)); //Result is 10.988 and so on 
```

注意我在这里添加了这个，以防万一有人认为这是答案并且不向下滚动......

* * *

## 回答 #2

> 赞同：20
> 
>             
> 
> 时间：2009-10-09T05:17:56.883

[对于任何感兴趣的人来说，只是对Frasers](https://stackoverflow.com/a/632914/3709765) Function稍作改动。

```
function setPrecision(number:Number, precision:int) {
 precision = Math.pow(10, precision);
 return (Math.round(number * precision)/precision);
} 
```

所以要使用：

```
var number:Number = 10.98813311;
trace(setPrecision(number,1)); //Result is 10.9
trace(setPrecision(number,2)); //Result is 10.98
trace(setPrecision(number,3)); //Result is 10.988 and so on 
```

* * *

## 回答 #3

> 赞同：10
> 
>             
> 
> 时间：2009-09-22T20:29:17.240

我`Number.toFixed(precision)`在 ActionScript 3 中使用过：http:   [//livedocs.adobe.com/flex/3/langref/Number.html#toFixed%28%29](http://livedocs.adobe.com/flex/3/langref/Number.html#toFixed%28%29)

它正确处理舍入并指定要显示的小数点后的位数 - 与`Number.toPrecision()`限制显示的总位数不同，无论小数点的位置如何。

```
var roundDown:Number = 1.434;                                             
// will print 1.43                                                        
trace(roundDown.toFixed(2));                                              

var roundUp:Number = 1.436;                                               
// will print 1.44                                                        
trace(roundUp.toFixed(2)); 
```

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-10-08T19:37:23.027

我将 BigDecimal 的 Java 转换为 ActionScript。自从我们为金融应用计算以来，我们别无选择。

[http://code.google.com/p/bigdecimal/](http://code.google.com/p/bigdecimal/)

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-08-24T05:13:02.570

您可以使用属性：rounding = "nearest"

在 NumberFormatter 中，舍入有 4 个值可供您选择：rounding="none|up|down|nearest"。我认为根据您的情况，您可以选择舍入 =“最近”。

-- 查利 --

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2010-06-29T19:09:29.080

我发现 BlazeDS 也支持将 Java BigDecimal 对象序列化为 ActionScript 字符串。因此，如果您不需要 ActionScript 数据是数字（您没有在 Flex / ActionScript 方面进行任何数学运算），那么字符串映射效果很好（没有舍入怪异）。有关 BlazeDS 映射选项，请参阅此链接：http: [//livedocs.adobe.com/blazeds/1/blazeds_devguide/help.html ?content=serialize_data_2.html](http://livedocs.adobe.com/blazeds/1/blazeds_devguide/help.html?content=serialize_data_2.html)

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2010-08-10T13:51:55.277

GraniteDS 2.2 在 ActionScript3 中具有 BigDecimal、BigInteger 和 Long 实现，这些类型的 Java / Flex 之间的序列化选项，甚至还有代码生成工具选项，以便为相应的 Java 生成 AS3 大数字变量。

在此处查看更多信息：http: [//www.graniteds.org/confluence/display/DOC22/2.+Big+Number+Implementations](http://www.graniteds.org/confluence/display/DOC22/2.+Big+Number+Implementations)。

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2010-08-26T14:56:33.077

我们能够重用网络上可用的 BigDecimal.as 类之一，并通过从 AMF3Output 进行子类化来扩展 blazeds，您需要在 flex xml 文件中指定自己的端点类，在该自定义端点中您可以插入自己的序列化程序实例化一个 AMF3Output 子类。

```
public class EnhancedAMF3Output extends Amf3Output {

    public EnhancedAMF3Output(final SerializationContext context) {
        super(context);
    }

    public void writeObject(final Object o) throws IOException {           
        if (o instanceof BigDecimal) {
            write(kObjectType);
            writeUInt29(7); // write U290-traits-ext (first 3 bits set)
            writeStringWithoutType("java.math.BigDecimal");
            writeAMFString(((BigDecimal)o).toString());
        } else {
            super.writeObject(o);
        }
    }
} 
```

就如此容易！那么你就有了使用 blazeds 的原生 BigDecimal 支持，哇哦！确保您的 BigDecimal as3 类实现 IExternalizable

干杯，jb

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2011-09-20T08:52:44.917

伙计们，只需检查解决方案：

```
            受保护的功能 button1_clickHandler(event:MouseEvent):void
            {
                var formatter:NumberFormatter = new NumberFormatter();
                formatter.precision = 2;
                formatter.rounding = NumberBaseRoundType.NEAREST；
                var a:Number = 14.31999999999998;

                跟踪（格式化程序。格式（a））；//14.32
            }

```

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2011-10-05T20:07:25.423

我为 Actionscript 客户端移植了 BigDecimal 的 IBM ICU 实现。  [其他人在这里发布了他们几乎相同的版本作为谷歌代码项目。](http://code.google.com/p/bigdecimal/ "大十进制项目")  我们的版本添加了一些方便的方法来进行比较。

您可以扩展 Blaze AMF 端点以添加对 BigDecimal 的序列化支持。请注意，另一个答案中的代码似乎不完整，根据我们的经验，它无法在生产中工作。  

AMF3 假设重复的对象、特征和字符串是通过引用发送的。对象引用表在序列化时需要保持同步，否则客户端将在反序列化期间失去这些表的同步并开始抛出类转换错误，或破坏不匹配但转换正常的字段中的数据......

这是更正后的代码：

```
public void writeObject(final Object o) throws IOException {
    if (o instanceof BigDecimal) {
        write(kObjectType);
        if(!byReference(o)){   // if not previously sent
            String s = ((BigDecimal)o).toString();                  
            TraitsInfo ti = new TraitsInfo("java.math.BigDecimal",false,true,0);
            writeObjectTraits(ti); // will send traits by reference
            writeUTF(s);
            writeObjectEnd();  // for your AmfTrace to be correctly indented
        }
    } else {
            super.writeObject(o);
        }
} 
```

还有另一种发送类型化对象的方法，它不需要客户端上的 Externalizable。客户端将改为在对象上设置**textValue**属性：

```
TraitsInfo ti = new TraitsInfo("java.math.BigDecimal",false,false,1);           
ti.addProperty("textValue");
writeObjectTraits(ti);
writeObjectProperty("textValue",s); 
```

无论哪种情况，您的 Actionscript 类都需要此标记：

```
[RemoteClass(alias="java.math.BigDecimal")] 
```

Actionscript 类还需要一个 text 属性来匹配您选择发送的将初始化 BigDecimal 值的属性，或者在 Externalizable 对象的情况下，需要以下几个方法：

```
public  function writeExternal(output:IDataOutput):void {       
    output.writeUTF(this.toString());
}
public  function readExternal(input:IDataInput):void {          
    var s:String = input.readUTF();
    setValueFromString(s);
} 
```

此代码仅涉及从服务器到客户端的数据。为了反序列化从客户端到服务器的另一个方向，我们选择扩展 AbstractProxy，并使用包装类在创建实际对象之前临时存储 BigDecimal 的字符串值，因为您无法实例化 BigDecimal 然后分配值，正如 Blaze/LCDS 的设计所期望的那样，所有对象都应如此。

这是规避默认处理的代理对象：

```
public class BigNumberProxy extends AbstractProxy {

    public BigNumberProxy() {
        this(null);
    }

    public BigNumberProxy(Object defaultInstance) {
        super(defaultInstance);
        this.setExternalizable(true);

        if (defaultInstance != null)
           alias = getClassName(defaultInstance);
    }   

    protected String getClassName(Object instance) {
        return((BigNumberWrapper)instance).getClassName();
    }

    public Object createInstance(String className) {
        BigNumberWrapper w = new BigNumberWrapper();
        w.setClassName(className);
        return w;
    }

    public Object instanceComplete(Object instance) {
    String desiredClassName = ((BigNumberWrapper)instance).getClassName();
    if(desiredClassName.equals("java.math.BigDecimal"))
        return new BigDecimal(((BigNumberWrapper)instance).stringValue);
    return null;
}

    public String getAlias(Object instance) {
        return((BigNumberWrapper)instance).getClassName();
    }

} 
```

该语句必须在您的应用程序中的某处执行，以将代理对象绑定到您要控制的类。我们使用静态方法：

```
PropertyProxyRegistry.getRegistry().register(
    java.math.BigDecimal.class, new BigNumberProxy()); 
```

我们的包装类如下所示：

```
public class BigNumberWrapper implements Externalizable {

    String stringValue;
    String className;

    public void readExternal(ObjectInput arg0) throws IOException, ClassNotFoundException {
        stringValue = arg0.readUTF();       
    }

    public void writeExternal(ObjectOutput arg0) throws IOException {
        arg0.writeUTF(stringValue);     
    }

    public String getStringValue() {
        return stringValue;
    }

    public void setStringValue(String stringValue) {
        this.stringValue = stringValue;
    }

    public String getClassName() {
        return className;
    }

    public void setClassName(String className) {
        this.className = className;
    }

} 
```

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2012-10-19T16:37:33.560

令人惊讶的是，MS Excel 中的 round 函数为我们提供了与您在上面介绍的不同的值。例如在 Excel 中

`Round(143,355;2)`=`143,36`

所以我对 Excel 回合的解决方法是：

```
public function setPrecision(number:Number, precision:int):Number {
precision = Math.pow(10, precision);

const excelFactor : Number = 0.00000001;

number += excelFactor;

return (Math.round(number * precision)/precision);
} 
```

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:37:36.313

如果您事先知道所需的精度，则可以存储缩放的数字，以便您需要的最小量是一个整数。例如，将数字存储为美分而不是美元。

如果这不是一个选项，那么这样的事情怎么样：

```
function printTwoDecimals(x)
{
   printWithNoDecimals(x);
   print(".");
   var scaled = Math.round(x * 100);
   printWithNoDecimals(scaled % 100);
} 
```

（但是，您打印时没有小数点卡在那里。）

但是，这不适用于*非常*大的数字，因为您仍然会丢失精度。

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2010-08-03T15:20:19.413

[您可以在https://bugs.adobe.com/jira/browse/FP-3315](https://bugs.adobe.com/jira/browse/FP-3315)上的 Flash 播放器 Jira 错误跟踪系统中投票并观看增强请求

同时使用 Number.toFixed() 变通方法参见：( [http://livedocs.adobe.com/flex/3/langref/Number.html#toFixed%28%29](http://livedocs.adobe.com/flex/3/langref/Number.html#toFixed%28%29) )

或使用那里的开源实现：( [http://code.google.com/p/bigdecimal/](http://code.google.com/p/bigdecimal/) ) 或 ( [http://www.fxcomps.com/money.html](http://www.fxcomps.com/money.html) )

至于序列化工作，如果你使用 Blazeds 或 LCDS，它会很小，因为它们确实支持 Java BigDecimal 序列化（到字符串）cf。（[http://livedocs.adobe.com/livecycle/es/sdkHelp/programmer/lcds/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=serialize_data_3.html](http://livedocs.adobe.com/livecycle/es/sdkHelp/programmer/lcds/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=serialize_data_3.html)）

* * *

## 回答 #14

> 赞同：-1
> 
>             
> 
> 时间：2009-03-11T01:21:49.717

这似乎更像是一个运输问题，数字是正确的，但比例尺被忽略了。如果数字必须在服务器上存储为 BigDecimal，您可能希望在发送之前将其在服务器端转换为不那么模糊的格式（Number、Double、Float）。

# c++ - 使用迭代器遍历和取消遍历 std::vector 的最干净的方法是什么？

> ID：632805
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-11T00:15:50.000
> 
>         
> 
> 标签：c++, vector, loops, iterator, for-loop

我有一种情况，我正在穿过一个向量，做一些事情：

```
std::vector<T>::iterator iter = my_list.begin();

for ( ; iter != my_list.end(); ++iter )
{
  if ( iter->doStuff() )   // returns true if successful, false o/w
  {
    // Keep going...
  }
  else
  {
    for ( ; iter != m_list.begin(); --iter )  // ...This won't work...
    {
      iter->undoStuff();
    }
  }
} 
```

在正常情况下 - 假设一切顺利 - 我一路前进`my_list.end()`并成功结束循环。

但是，如果在我做事时出现问题，我希望能够撤消所有内容——基本上将我的步骤追溯到向量的最开始，以相反的顺序一次撤消所有内容。

我的问题是，当我到达时`my_list.begin()`- 如嵌套 for 循环所示 - 我真的还没有完成，因为我仍然需要调用`undoStuff()`列表中的第一个元素。现在，我可以在循环之外进行最终调用，但这似乎有点不干净。

在我看来，我只有在到达时才完成`my_list.rend()`。但是，我无法将 a`std::vector::iterator`与 a进行比较`std::vector::reverse_iterator`。

鉴于我正在尝试做的事情，迭代器类型/循环组合的最佳选择是什么？

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-03-11T00:20:09.430

当谈到 STL 向量时，我有点生疏，但是可以`std::vector::reverse_iterator`从您的初始迭代器创建一个吗？然后，您只需要从您在前进时所处的最后一个项目开始，并且能够将其与`my_list.rend()`以确保第一个项目得到处理。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T00:24:52.710

`operator[]()`如果向量可以使您的代码更清晰、更简单和/或更高效，那么当然没有理由不使用向量。

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T03:26:27.267

虽然通过`rbegin()`and使用反向迭代器`rend()`效果很好，但不幸的是，我发现反向迭代器和非反向迭代器之间的转换往往相当混乱。如果我需要在转换之前或之后递增或递减，我永远不会记得必须经过逻辑难题练习。因此，我通常避免转换。

这是我可能编写错误处理循环的方式。请注意，我认为您不必调用`undoStuff()`失败的迭代器 - 毕竟，`doStuff()`它说它没有成功。

```
// handle the situation where `doStuff() failed...

// presumably you don't need to `undoStuff()` for the iterator that failed
// if you do, I'd just add it right here before the loop:
//
//     iter->undoStuff();

while (iter != m_list.begin()) {
    --iter;
    iter->undoStuff();
} 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:37:48.747

不使用 a `reverse_iterator`，您可以这样向后走：

```
while(iter-- != m_list.begin())
{
    iter->undoStuff();
} 
```

虽然这会创建 的副本`iter`，但成本应该不会太大。您可以重构以获得更快的速度：

```
while(iter != m_list.begin())
{
    --iter;
    iter->undoStuff();
} 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T09:22:25.897

这取决于您的`doStuff()`功能做什么，以及性能在您的环境中的重要性。如果可能的话，处理你的向量副本可能会更清楚（即——对读者来说更容易），并且只有在一切正常的情况下，交换向量。

```
std::vector<Foo> workingCopy;
workingCopy.assign(myVector.begin(), myVector.end());

bool success = true;
auto iter = workingCopy.begin();
for( ; iter != workingCopy.end() && success == true; ++iter )
    success = iter->doStuff();

if( success )
    myVector.swap(workingCopy); 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:26:05.857

您需要使用 rbegin() 来获得可逆迭代器。   

个人还是比较喜欢

```
for (int i=0;i<vecter.size();i++) { } 
```

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:38:49.493

好的，我会在这里冒险出去..

```
std::vector iterator iter = my_list.begin();
bool error = false;

while(iter != my_list.end())
{
  error = !iter->doStuff();
  if(error)
    break
  else
    iter++;
}

if(error)
do
{
  iter->undoStuff();
  iter--;
} 
while(iter != my_list.begin()) 
```

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T03:31:09.080

这就是我所说的工程，但它非常有趣

```
// This also can be done with adaptators I think
// Run DoStuff until it failed or the container is empty
template <typename Iterator>
Iterator DoMuchStuff(Iterator begin, Iterator end) {
  Iterator it = begin;
  for(; it != end; ++it) {
    if(!*it->DoStuff()) {
      return it;
    }
  }
  return it;
}

// This can be replaced by adaptators
template <typename Iterator>
void UndoMuchStuff(Iterator begin, Iterator end) {
  for(Iterator it = begin; it != end; ++it) {
    it->UndoStuff();
  }
}

// Now it is so much easier to read what we really want to do
typedef std::vector<MyObject*> MyList;
typedef MyList::iterator Iterator;
typedef MyList::reverse_iterator ReverseIterator;
Iterator it = DoMuchStuff(my_list.begin(), my_list.end());
if(it != my_list.end()) {
  // we need to unprocess [begin,it], ie including it
  UndoMuchStuff(ReverseIterator(1+it), ReverseIterator(my_list.begin()));
} 
```

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2011-09-27T04:03:52.013

这可以通过以下方式完成`reverse_iterator`：

```
bool shouldUndo(false);
std::vector::iterator iter(my_list.begin()), end(my_list.end());
for ( ; iter != end && !shouldUndo; ++iter )
{
  shouldUndo = iter->doStuff();   // returns true if successful, false o/w
}
if (shouldUndo) {
  reverse_iterator<std::vector::iterator> riter(iter), rend(my_list.rend());
  //Does not call `undoStuff` on the object that failed to `doStuff`
  for ( ; riter != rend; ++riter )
  {
    iter->undoStuff();
  }
} 
```

# c# - 为什么公共领域比属性快？

> ID：632831
> 
>         
> 
> 赞同：38
> 
>         
> 
> 时间：2009-03-11T00:24:21.400
> 
>         
> 
> 标签：c#, oop, properties, struct, public-fields

我在 XNA 中四处寻找，发现其中的`Vector3`类使用公共字段而不是属性。我尝试了一个快速基准测试，发现`struct`差异非常显着（将两个向量加在一起 ​​1 亿次需要 2.0 秒的属性和 1.4 秒的字段）。对于引用类型，差异似乎并没有那么大，但确实存在。

那为什么呢？我知道一个属性被编译成`get_X`和`set_X`方法，这会产生方法调用开销。但是，这些简单的 getter/setter 不*总是*被 JIT 内联吗？我知道你不能保证 JIT 决定做什么，但肯定这在概率列表中相当高吗？还有什么可以将公共字段与机器级别的属性分开？

我一直想知道的一件事是：自动实现的属性 ( `public int Foo { get; set; }`) 如何比公共字段“更好”的 OO 设计？或者更好地说：这两者有什么*不同*？我知道通过反射使它成为一个属性更容易，但还有什么？我敢打赌，这两个问题的答案是一样的。

顺便说一句：我正在使用 .NET 3.5 SP1，我认为它解决了带有结构的方法（或结构的方法*，*我不确定）没有内联的问题，所以不是这样。我想我至少在使用它，它肯定已经安装了，但话又说回来，我使用的是带有 SP1 的 Vista 64 位，它应该有 DX10.1，但我没有 DX10.1 ..

另外：是的，我一直在运行发布版本:)

**编辑**：我很欣赏快速回答的家伙，但我表示我*确实*知道属性访问是一个方法调用，但我不知道为什么可能是内联方法比直接字段访问慢。

**编辑 2**：所以我创建了另一个`struct`使用显式 GetX() 方法的方法（我怎么不会错过我的 Java 日子），并且无论我是否禁用内联（通过），它*都*`[MethodImplAttribute(MethodImplOptions.NoInlining)]`执行相同的操作，所以结论：非静态方法显然从不内联，即使在结构上也是如此。

我认为有例外，JIT 可以优化虚拟方法调用。为什么这种情况不会发生在不知道继承的结构上，因此方法调用只能指向一个可能的方法，对吧？还是因为您可以在其上实现接口？

这有点可惜，因为它真的会让我考虑在性能关键的东西上使用属性，但是使用字段让我觉得很脏，我还不如用 C 写我正在做的事情。

**编辑 3**：我发现[这篇](http://www.ademiller.com/blogs/tech/2008/08/c-inline-methods-and-optimization/)帖子是关于完全相同的主题的。他的最终结论是属性调用确实得到了优化。我也可以发誓我已经读过很多次简单的 getter/setter 属性会被内联，尽管`callvirt`在 IL 中。那我是不是要疯了？

**编辑 4**：Reed Copsey 在下面的评论中发布了答案：

> 回复：Edit3 - 查看我更新的评论：我相信这是 x86 JIT 与 x64 JIT 问题。x64 中的 JIT 并不成熟。随着越来越多的 64 位系统每天上线，我希望 MS 能够迅速改进这一点。——里德·科普西

我对他的回答的回应：

> 谢谢，这就是答案！我尝试强制 x86 构建，所有方法都同样快，而且比 x64 快得多。实际上，这对我来说非常令人震惊，我不知道我在 64 位操作系统上生活在石器时代。我会在我的回答中包含您的评论，这样它会更好。– 朱利安

谢谢大家！

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-03-11T00:26:57.337

编辑2：

我在这里有另一个潜在的想法：

您提到您在 x64 上运行。我已经在 x86 上测试了同样的问题，并且在使用自动属性与字段时看到了相同的性能。但是，如果您查看 Connect 和邮件列表/论坛帖子，网上有很多参考资料表明 x64 CLR 的 JIT 是不同的代码库，并且与 x86 JIT 具有非常不同的性能特征。我的猜测是这是 x64 仍然落后的地方。

此外，仅供参考，在 .net 3.5sp1 中修复的结构/方法/等东西是在 x86 方面的，事实上，将结构作为参数的方法调用永远不会在 .net3.5sp1 之前的 x86 上内联。这与您系统上的讨论几乎无关。

* * *

编辑3：

另一件事：至于为什么 XNA 使用字段。我实际上是在他们宣布 XNA 的游戏节上。Rico Mariani 发表了一次演讲，他在博客中提出了许多相同的观点。似乎 XNA 的人在开发一些核心对象时也有类似的想法。看：

[http://blogs.msdn.com/ricom/archive/2006/09/07/745085.aspx](http://blogs.msdn.com/ricom/archive/2006/09/07/745085.aspx)

特别是，请查看第 2 点。

* * *

至于为什么自动属性优于公共字段：

它们允许您更改类的 v2 中的实现，并根据需要将逻辑添加到属性获取/设置例程中，而无需更改您与最终用户的接口。随着时间的推移，这会对您维护库和代码的能力产生深远的影响。

----来自原始帖子-但发现这不是问题--------

您是否在VS*之外*运行发布版本？这可能是为什么事情没有得到优化的一种解释。通常，如果您在 VS 中运行，即使是优化的发布版本，VS 主机进程也会禁用 JIT 的许多功能。这可能会导致性能基准发生变化。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-03-11T00:27:56.523

您应该阅读 Vance 的这篇文章。它详细介绍了为什么 JIT'er 并不总是内联方法，即使看起来完全明显它们应该是内联的。

[http://blogs.msdn.com/vancem/archive/2008/08/19/to-inline-or-not-to-inline-that-is-the-question.aspx](http://blogs.msdn.com/vancem/archive/2008/08/19/to-inline-or-not-to-inline-that-is-the-question.aspx)

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:25:32.317

*   公共字段是直接分配

*   属性是方法，然后是更多代码，微不足道但更多。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:30:36.067

XNA 必须以 Xbox 360 为目标，而 .NET Compact Framework 中的 JIT 并不像其桌面对应物那样复杂。.NET CF JIT'er 不会内联属性方法。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:31:25.017

访问字段只是内存引用，而使用属性实际上是调用方法并包括函数调用开销。使用属性而不是字段的原因是为了使您的代码免受更改并提供更好的访问粒度。通过不直接公开您的字段，您可以更好地控制访问的完成方式。使用自动字段可以让您获得典型的 getter/setter 行为，但构建了更改此行为的能力，而无需随后将更改传播到代码的其他部分。

例如，假设您要更改代码，以便对字段的访问由当前用户的角色控制。如果您公开了该字段，则必须触摸访问它的代码的每个部分。通过属性公开它允许您修改属性代码以添加您的新需求**，但不会导致对访问它的任何代码进行不必要的更改**。

# c - 清除 char 数组 c

> ID：632846
> 
>         
> 
> 赞同：113
> 
>         
> 
> 时间：2009-03-11T00:30:11.497
> 
>         
> 
> 标签：c, arrays, char

我认为通过将第一个元素设置为 null 会清除 char 数组的全部内容。

```
char my_custom_data[40] = "Hello!";
my_custom_data[0] = '\0'; 
```

但是，这只会将第一个元素设置为 null。

或者

```
my_custom_data[0] = 0; 
```

而不是 use `memset`，我认为上面的 2 个示例应该清除所有数据。

* * *

## 回答 #1

> 赞同：122
> 
>             
> 
> 时间：2009-03-11T00:33:44.793

这取决于您希望如何查看数组。如果您将数组视为一系列字符，那么清除数据的唯一方法是触摸每个条目。`memset`可能是实现这一目标的最有效方法。

另一方面，如果您选择将此视为 C/C++ 空终止字符串，则将第一个字节设置为 0 将有效地清除该字符串。

* * *

## 回答 #2

> 赞同：77
> 
>             
> 
> 时间：2009-03-11T00:34:25.340

C 中的数组只是一个内存位置，所以实际上，您的`my_custom_data[0] = '\0';`赋值只是将第一个元素设置为零，而其他元素保持不变。

如果要清除数组的所有元素，则必须访问每个元素。这就是`memset`：

```
memset(&arr[0], 0, sizeof(arr)); 
```

这通常是解决此问题的最快方法。如果您可以使用 C++，请考虑使用 std::fill ：

```
char *begin = &arr;
char *end = begin + sizeof(arr);
std::fill(begin, end, 0); 
```

* * *

## 回答 #3

> 赞同：26
> 
>             
> 
> 时间：2009-03-11T00:35:08.643

为什么您认为设置单个元素会清除整个数组？尤其是在 C 中，如果没有程序员明确地编程，几乎不会发生任何事情。如果您将第一个元素设置为零（或任何值），那么您已经完成了该操作，仅此而已。

初始化时，您可以将数组设置为零：

```
char mcd[40] = {0}; /* sets the whole array */ 
```

否则，除了 memset 或类似的东西，我不知道任何技术。

* * *

## 回答 #4

> 赞同：12
> 
>             
> 
> 时间：2009-03-31T16:31:08.633

采用：

```
memset(my_custom_data, 0, sizeof(my_custom_data)); 
```

或者：

```
memset(my_custom_data, 0, strlen(my_custom_data)); 
```

* * *

## 回答 #5

> 赞同：10
> 
>             
> 
> 时间：2010-12-10T20:09:43.857

试试下面的代码：

```
void clean(char *var) {
    int i = 0;
    while(var[i] != '\0') {
        var[i] = '\0';
        i++;
    }
} 
```

* * *

## 回答 #6

> 赞同：7
> 
>             
> 
> 时间：2009-03-11T00:34:53.467

为什么不使用`memset()`？这就是如何做到这一点。

设置第一个元素不会影响其余的内存，但 str 函数会将数据视为空。

* * *

## 回答 #7

> 赞同：6
> 
>             
> 
> 时间：2012-03-12T10:20:09.457

请在下面找到我在案例 1 和案例 2 之后用数组中的数据解释的地方。

```
char sc_ArrData[ 100 ];
strcpy(sc_ArrData,"Hai" ); 
```

情况1：

```
sc_ArrData[0] = '\0'; 
```

结果：

```
-   "sc_ArrData"
[0] 0 ''
[1] 97 'a'
[2] 105 'i'
[3] 0 '' 
```

案例二：

```
memset(&sc_ArrData[0], 0, sizeof(sc_ArrData)); 
```

结果：

```
-   "sc_ArrData"
[0] 0 ''
[1] 0 ''
[2] 0 ''
[3] 0 '' 
```

虽然将第一个参数设置为 NULL 可以解决问题，但建议使用 memset

* * *

## 回答 #8

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T00:34:01.393

没有。您所做的只是将第一个值设置为 '\0' 或 0。

如果您正在使用以空字符结尾的字符串，那么在第一个示例中，您将获得模仿您所期望的行为，但是仍然设置了内存。

如果要在不使用 memset 的情况下清除内存，请使用 for 循环。

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:33:21.783

你应该使用 memset。只设置第一个元素是行不通的，你需要设置所有元素 - 如果没有，你怎么能只设置第一个元素为 0？

* * *

## 回答 #10

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:34:20.270

将空字符写入第一个字符就是这样做的。如果将其视为字符串，则遵循空终止字符的代码会将其视为空字符串，但这与清除数据不同。如果你想真正清除数据，你需要使用 memset。

* * *

## 回答 #11

> 赞同：2
> 
>             
> 
> 时间：2018-01-19T13:09:33.323

我通常只是这样做：

```
memset(bufferar, '\0', sizeof(bufferar)); 
```

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:35:59.250

> 我认为通过将第一个元素设置为 null 会清除 char 数组的全部内容。

正如您发现的那样，这不正确

> **但是，这只会将第一个元素设置为 null。**

确切地！

您需要使用 memset 清除所有数据，将其中一个条目设置为 null 是不够的。

但是，如果将数组的一个元素设置为 null 意味着一些特殊的事情（例如，当使用 null 终止字符串时），将第一个元素设置为 null 可能就足够了。这样，即使数组仍然包含内存中的旧字符，数组的任何用户都会明白它是空的

* * *

## 回答 #13

> 赞同：1
> 
>             
> 
> 时间：2009-06-30T23:34:19.570

将第一个元素设置为 NULL。打印 char 数组不会给你任何回报。

* * *

## 回答 #14

> 赞同：1
> 
>             
> 
> 时间：2012-08-16T11:49:12.007

以下情况如何：

```
bzero(my_custom_data,40); 
```

* * *

## 回答 #15

> 赞同：-3
> 
>             
> 
> 时间：2013-11-16T03:44:03.770

```
void clearArray (char *input[]){
    *input = ' '; 
} 
```

* * *

## 回答 #16

> 赞同：-4
> 
>             
> 
> 时间：2011-11-23T04:17:41.017

尝试以下操作：

```
strcpy(my_custom_data,""); 
```

# c# - 当应用程序有未保存的数据时，处理注销/关闭/重新启动的正确方法是什么？

> ID：632851
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-11T00:30:47.080
> 
>         
> 
> 标签：c#, wpf, shutdown

在 WPF 中 App.Current.SessionEnding 必须在几秒钟内返回，否则会出现“应用程序不响应”窗口。所以不能在这个事件处理程序中要求用户保存他的数据，因为用户的响应时间超过几秒钟。

我认为一个解决方案是取消注销/关闭/重新启动，并在用户回答文件保存对话框时恢复它。

```
 ReasonSessionEnding _reasonSessionEnding;

    App.Current.SessionEnding +=
        new SessionEndingCancelEventHandler(Current_SessionEnding);

    void Current_SessionEnding(object sender, SessionEndingCancelEventArgs e)
    {
        if (_dataModified)
        {
            e.Cancel = true;
            _reasonSessionEnding = e.ReasonSessionEnding;
            Dispatcher.CurrentDispatcher.BeginInvoke(new Action(EndSession));
        }
    }

    void EndSession()
    {
        if (SaveWithConfirmation()) // if the user didn't press Cancel
            //if (_reasonSessionEnding = ReasonSessionEnding.Logoff)
                // logoff
            //else
                // shutdown or restart ?
    } 
```

问题是 ReasonSessionEnding 没有告诉我 Windows 是关闭还是重新启动（它不区分两者）。

那么，我的程序在会话结束事件上应该做什么？它甚至应该做任何事情，还是在这个事件上什么都不做是标准？

要求用户将他的更改保存在我的主窗体的 OnClosing 方法中，因此他不会丢失数据，但我认为“应用程序不响应”窗口并不表示正常的工作流程。

我猜不希望取消关闭，因为其他一些程序已经关闭。

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-11T00:45:15.000

似乎被接受的方式是无论如何都显示另存为对话框。

由于您陈述的原因和其他各种原因，取消关闭，然后再恢复它肯定不是一种选择。

由于简单地丢弃数据是不可接受的，因此确实没有其他选择。

好吧，除了将数据保存到临时文件，然后在下次运行程序时自动恢复它们。更像是崩溃后的 MS Word。实际上，我考虑得越多，听起来就越好。

**Edit:** There's yet another avenue, namely to save continously, the way eg. MS OneNote does. What has struck me before is that, provided you implement decent multilevel undo in your application, the whole manual saving business is actually somewhat dated - an anachronism from the days when disk operations were expensive and error-prone, nowadays mostly old habit.

But I'm digressing. Anyway, it's probably not applicable to your application, since I imagine it needs to be implemented from the beginning.

# python - Python，将变量值评估为变量

> ID：632856
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-11T00:31:50.540
> 
>         
> 
> 标签：python

我想做类似下面的事情：特别是'f.eval（field）'部分，这样它将变量的值评估为字段名称。如何在 Python 中实现这一点？

```
def punctuated_object_list(objects, field):
    field_list = [f.eval(field) for f in objects]
    if len(field_list) > 0:
        if len(field_list) == 1:
            return field_list[0]
        else:
            return ', '.join(field_list[:-1]) + ' & ' + field_list[-1]
    else:
        return u'' 
```

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2009-03-11T00:35:09.517

`getattr(f, field)`，如果我理解正确（也就是说，如果你可能有`field = "foo"`，并且想要`f.foo`）。如果不是，您可能需要澄清一下。Python 有一个`eval()`，我不知道`eval()`你想要什么其他语言。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T00:47:08.693

```
getattr( object, 'field' ) #note that field is a string

f = 'field_name'
#...
getattr( object, f )

#to get a list of fields in an object, you can use dir()
dir( object ) 
```

有关详细信息，请参阅：[http ://www.diveintopython.org/power_of_introspection/index.html](http://www.diveintopython.org/power_of_introspection/index.html)

**不要使用 eval**，即使在这种特殊情况下字符串是安全的！只是不要让自己习惯它。如果您从用户那里获取字符串，则可能是恶意代码。

墨菲定律：如果事情可能出错，它们就会出错。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:37:43.193

python等价`eval()`于是`eval()`

```
x = 9
eval("x*2") 
```

会给你18。

```
v = "x"
eval(v+"*2") 
```

也可以。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:43:27.767

要获取 Python 对象中所有字段的列表，您可以访问其`__dict__`属性。

```
class Testing():
    def __init__(self):
        self.name = "Joe"
        self.age = 30

test = Testing()
print test.__dict__ 
```

结果：

```
{'age': 30, 'name': 'Joe'} 
```

# random - 为什么程序很难生成随机数？

> ID：632873
> 
>         
> 
> 赞同：22
> 
>         
> 
> 时间：2009-03-11T00:36:05.320
> 
>         
> 
> 标签：random

我的孩子问我这个问题，我真的无法给出简明易懂的解释。

所以我希望有人能做到。

* * *

## 回答 #1

> 赞同：70
> 
>             
> 
> 时间：2009-03-11T00:40:03.687

怎么样，“因为计算机只是遵循指令，而随机数与遵循指令相反。如果你按照指令生成随机数，那么它就不是很随机！想象一下试图给某人如何选择随机数的指令。 "

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2009-03-11T02:10:53.813

这是一个儿童友好的解释：

1.  得到一个骰子（面数无关紧要）

2.  把这些写在一张纸上：

    *   向右移

    *   提升

    *   提升

    *   把骰子翻过来

    *   下移

    *   向右移

3.  向他们展示骰子和纸。解释骰子代表计算机，纸代表告诉计算机它将返回什么数字的数学或算法。

4.  现在，掷骰子。告诉他们您正在“播种”或要求计算机从随机骰子位置开始。

5.  移动骰子，按照纸上的每一步（向右移动）。

    *   假设你投掷了一个 6 面骰子，它的种子是 5。向右移动，你得到一个 4。

6.  说明计算机必须从一个起始值开始。这可以由任意数量的来源给出，例如日期或鼠标移动。向他们展示他们掷骰子的方式决定了初始值。

7.  说明这张纸是计算机如何得到下一个数字的。告诉他们，纸上的指令可以很容易地改变，就像程序员可以改变随机发生器的算法一样。

8.  向他们展示仅受他们想象力限制的各种可能性，玩得开心。

现在回答你的问题：

> 告诉他们，当一位优秀的数学家知道起始值以及计算机当前处于哪一步时，数学家就可以知道随机数的下一个值是多少。

1.  让孩子把纸藏起来扔骰子。

2.  然后让孩子按照纸上的步骤进行操作，然后你写下他是如何得到下一个随机数的。

3.  然后，向他们展示你的论文。现在您有了他们的随机数生成器的副本，其他任何人都可以轻松“猜测”出下一个随机数。

无论孩子的算法多么有创意，您仍然应该能够推断出他们的算法。告诉您的孩子，在计算机世界中，没有什么是隐藏的，只要通过观察，即使只是观察到的数字，也可以发现随机数算法。

...作为副作用，如果孩子能够提出一个让您感到困惑的好算法，您无法推断出下一个序列，那么您就有了一个聪明的孩子。:D

* * *

## 回答 #3

> 赞同：10
> 
>             
> 
> 时间：2009-03-11T00:40:18.040

要求他们设计一个逐步生成随机数的方法。

并且不要接受“从 1 到 10 中选择一个数字”作为答案；）

尝试一个问题应该说明必须从一组指令中生成随机数的难度，就像计算机实际必须做的那样。

* * *

## 回答 #4

> 赞同：10
> 
>             
> 
> 时间：2009-03-11T00:42:23.277

这是我在大约八年级时解释随机性的尝试。希望你的孩子觉得它有用！

令人惊讶的是，**计算机并不是很聪明。**计算机必须盲目地遵循它们的指令，因此是完全可以预测的。不以这种方式遵循指令的计算机实际上是坏了！我们希望计算机完全按照我们告诉他们的去做。

这正是让随机做事变得困难的原因。必须告诉计算机如何生成随机数的一系列指令。但这并不是真正随机的，因为如果你给其他任何人指示和相同的起点，他们可能会得出相同的答案。所以计算机不能仅仅通过遵循指令来实现真正的随机性。

* * *

## 回答 #5

> 赞同：5
> 
>             
> 
> 时间：2009-03-11T00:38:01.727

因为计算机是确定性机器。

* * *

## 回答 #6

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T01:00:59.067

在计算机上生成随机数就像在标签游戏中选择谁是第一个时玩“Eenie meenie miney moe”。从表面上看，它确实是随机的，但当你深入细节时，它是完全确定的。很难将 eenie meenie miney moe 变成一个人们真的无法预测结果的计划。

此外，要使分布均匀，也有一些困难。

* * *

## 回答 #7

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:38:50.367

因为给定任何输入，算法每次都会产生完全相同的输出。而且您不能只提供“随机”输入，因为您首先要尝试生成随机数。

* * *

## 回答 #8

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:43:58.250

“孩子们，除非他们坏了，否则电脑永远不会撒谎，他们总是按照你告诉他们的去做。即使我们对结果感到失望，事实证明他们总是完全忠实地做他们被告知要做的事情. 他们只能做两件事：加一加一，将一个数字从一个地方移动到另一个地方。如果你想让他们产生随机数，你需要向他们解释如何做到这一点加一和一和“

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T00:45:36.577

因为唯一真正的随机源存在于量子层面。借助合适的硬件辅助，计算机可以访问此级别。例如，他们可以对放射性同位素的衰变或热离子阀的噪声进行采样。但是您的基本 PC 并没有配备这些很酷的东西。

* * *

## 回答 #10

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T02:33:31.277

给孩子一个简单的解释：

随机性的定义是一个哲学和数学问题，超出了这个答案的范围，但根据定义，没有“随机”数这样的东西。在形而上学的意义上，一个数字只是顺序形式的随机数。但是，根据样本大小，序列有可能遵循某些统计分布。随机数生成器（在我们的例子中是伪随机数生成器，或*PRNG*）只是一种生成准随机数序列的设备，我们只能估计（基于序列中固有的给定概率）是随机的.

您应该向孩子们解释，程序只能使用复杂的数学公式来模仿这些设备（根据定义，这保证了缺乏“随机性”，因为它们是某些函数或程序算法的结果）。通常，为了区分量子硬件 PRNG（以此为契机向您的孩子解释海森堡原理！）和强大的软件 PRNG 的使用，必须进行严格的统计分析。

* * *

## 回答 #11

> 赞同：2
> 
>             
> 
> 时间：2009-08-24T23:01:48.417

真的必须完成

![RFC 1149.5 将 4 指定为标准 IEEE 审查的随机数。](https://imgs.xkcd.com/comics/random_number.png)

来源：http: [//xkcd.com/221/](http://xkcd.com/221/)

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T01:04:01.553

因为没有随机数这样的东西。

随机是我们在无法理解和不理解数据时使用的人类概念。如果我们相信科学最终会导致对一切如何运作的理解，那么肯定一切*都是*确定性的。

拿走人，没有随机，只有“这个”。它发生是因为它发生了，而不是因为它是随机的。

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:38:26.560

因为程序是一个系统，系统中的一切都是为了一致性和规律性运行的。随机性在系统中没有位置。

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:38:41.070

这很难，因为给定相同的输入和条件集，程序每次都会产生相同的结果。根据定义，这不是随机的。

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:40:43.233

生成随机数的算法不可避免地具有确定性。他们获取一个小的随机种子，并使用它来获得一长串伪随机数字。

如果不将微妙的模式引入数据，就很难做到这一点。一串数字看起来完全随机，但具有重复的模式，这使得分布不适合需要随机性的应用程序。

* * *

## 回答 #16

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:40:50.690

计算机只能执行算法计算，真正的随机数不是算法的东西。您可以获得产生类似于随机数的数字的算法；这种算法被称为“伪随机数生成器”。

在过去的不同时期，人们从连接到电子噪声源的模数转换器制造随机数发生器，但这往往是相当专业的套件。

* * *

## 回答 #17

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:41:27.320

主要是因为计算机没有任何以离散、非随机方式运行的函数。计算机是可预测的，它允许我们编写可靠的软件。如果它不可预测，生成随机数会更容易（因为我们的软件可以依赖这种不可预测的方法）。

虽然可以生成伪随机数和随机分布的数字，但如果没有单独的硬件，就无法生成真正的随机数。有硬件可以根据“量子”相互作用生成真正的随机数（至少根据制造商的说法）。在线扑克网站有时会将这些适配器用作其生成器。  

显然，甚至还有提供随机数的在线服务——例如[random.org](http://www.random.org/)。  

* * *

## 回答 #18

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:51:42.690

尽管看起来令人惊讶，但很难让计算机偶然做某事。计算机盲目地遵循其指令，因此是完全可预测的。（不以这种方式遵循其指令的计算机会损坏。）使用计算机生成随机数的主要方法有两种：伪随机数生成器 (PRNG) 和真随机数生成器 (TRNG)。

* * *

## 回答 #19

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:55:18.393

实际上，在大多数现代计算机上，为大多数目的生成“足够随机”的数字并不难。正如其他人所指出的，关键是要有随机性来源。您不能只编写一个通过算法产生随机性的程序，但您可以观察到大多数具有合理复杂性的计算机的各种活动中的随机性，即我们在编写程序时通常想到的那些。一种这样的来源是来自各种系统设备的中断的时序数据。

曾经，许多计算机无法获取这些数据，只能提供伪随机性，即基于特定种子的随机但可重复的数字分布。出于许多目的，这已经足够了——每次选择不同的种子会产生足够好的随机性。对于其他目的，例如加密，这还不够强大，您需要一些随机性才能开始，这是不可重复或不可预测的。今天，大多数计算机（也许嵌入式设备除外）都足够复杂，可以拥有可以生成加密强度随机数的随机源。例如，Linux 有[/dev/random](http://en.wikipedia.org/wiki/Urandom)并且 .NET 框架支持具有许多实现的加密强[RandomNumberGenerator类。](http://msdn.microsoft.com/en-us/library/system.security.cryptography.randomnumbergenerator.aspx)

* * *

## 回答 #20

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:55:26.287

区分难以预测的数字（计算机可以创建）和不确定的数字（这对计算机来说有点困难，理论上，任何物理存在）可能会有所帮助。

* * *

## 回答 #21

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T00:57:38.857

很容易想出一种算法来生成意想不到的数字，这些数字在某种意义上看起来是随机的。但是要设计一个生成真正随机数的算法，嗯，这很难。

想象一下设计一个算法来模拟掷骰子。您可以轻松地制定一些程序以在每次迭代中生成不同的数字。但是你能*保证*，从长远来看（我的意思是，直到无穷大），出现 6 的次数将与任何其他数字相同吗？在设计一个好的随机数生成器时，你必须承担这种承诺。如果应用程序（例如彩票）需要，您必须提供关于随机性的有力保证（例如数学证明）。

* * *

## 回答 #22

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:03:23.083

值得注意的是，[人类在生成随机数方面的表现非常差](http://en.wikipedia.org/wiki/Random_number_generator_attack#Human_generation_of_random_quantities)。计算机更糟糕，因为它们只遵循严格的设置命令。人类只有在遵循算法、一组命令时才能生成好的（伪）随机数。电脑也是一样。

尽管应该注意计算机可以从与其连接的“环境”中收集熵，例如键盘和鼠标操作，这有助于生成随机数（直接或通过播种 PRNG）。

* * *

## 回答 #23

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:41:23.320

为了让计算机生成一个随机数，计算机必须从一个随机源开始。

必须给它喂食的种子不能仅仅通过观察种子来预测或计算，如果种子来自时钟，那么它可以通过知道时间来预测或计算，如果种子来自像拍摄薰衣草灯一样并从图片流中获取数字，那么仅查看种子就很难知道下一个数字是什么。

计算机没有内置熔岩灯来生成随机性，这就是它的难点，我们必须用计算机中存在的一些输入来代替真正的随机性，也许是通过记录传递的 tcpip-packets 或其他东西，但它不是获取随机性来源的许多方法。

* * *

## 回答 #24

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T10:38:28.570

计算机只是没有合适的硬件。普通计算机的硬件是确定性的。[使用这里提到](http://www.intel.com/design/software/drivers/platform/security.htm)的合适的硬件，随机数根本不是问题。

* * *

## 回答 #25

> 赞同：0
> 
>             
> 
> 时间：2009-08-24T22:56:08.100

不久前，我遇到了“Dice-O-Matic”

[http://GamesByEmail.com/News/DiceOmatic](http://GamesByEmail.com/News/DiceOMatic)

问题的一种有趣的现实世界应用。

* * *

## 回答 #26

> 赞同：-1
> 
>             
> 
> 时间：2009-03-11T00:52:54.653

不难，这里有一对免费的：12、1400、397.6

# java - 给定日期的 System.currentTimeMillis()？

> ID：632884
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-11T00:38:29.633
> 
>         
> 
> 标签：java, timestamp

由于 java.util.Date 大部分已被弃用，因此获取给定日期（UTC 时间）的时间戳的正确方法是什么？可以与之相提并论的那一款`System.currentTimeMillis()`。

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-03-11T00:49:28.593

使用[Calendar](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Calendar.html)类，您可以在特定时区的特定时间创建时间戳。一旦你有了它，你就可以得到毫秒时间戳来比较：

```
Calendar cal = new GregorianCalendar();
cal.set(Calendar.DAY_OF_MONTH, 10);
// etc...

if (System.currentTimeMillis() < cal.getTimeInMillis()) {
  // do your stuff
} 
```

编辑：更改为使用更直接的方法从日历实例获取时间（以毫秒为单位）。感谢非法程序员

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2009-03-11T00:50:09.590

Date 用于许多事物的“官方”替代品是 Calendar。不幸的是，它相当笨拙且设计过度。你的问题可以这样解决：

```
long currentMillis = System.currentTimeMillis();
Date date = new Date(currentMillis);
Calendar calendar = Calendar.getInstance();
calendar.setTime(date);
long calendarMillis = calendar.getTimeInMillis();
assert currentMillis == calendarMillis; 
```

日历也可以用不同的方式初始化，甚至一次初始化一个字段（小时、分钟、秒等）。看看Javadoc。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:56:10.013

虽然我自己没有尝试过，但如果你的项目允许外部库，我相信你应该看看 JODA-Time 项目（开源）。AFAIK，JODA 时间为日期/时间上的新 JSR（通常在 Java7 中）做出了很大贡献。

许多人声称 JODA 时间是所有 java.util.Date/Calendar 问题的解决方案；-)

绝对值得一试。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T00:46:04.983

看看[Calendar](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Calendar.html)类。

您可以使用当前时间（未弃用）制作数据，然后从中制作日历（还有其他方法）。

# sql - 将自定义 sql 添加到查找条件的问题

> ID：632890
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-11T00:40:12.640
> 
>         
> 
> 标签：sql, mysql, ruby-on-rails, activerecord

我正在尝试将以下自定义 sql 添加到 finder 条件中，但有些地方不太正确.. 我不是 sql 专家，但与一位朋友一起解决了这个问题..（但他们不熟悉 ruby​​onrails 或 activerecord或查找器）

```
status_search = "select p.*
               from policies p
               where exists
                   (select 0 from status_changes sc
                   where sc.policy_id = p.id
                   and sc.status_id = '"+search[:status_id].to_s+"'
                   and sc.created_at between "+status_date_start.to_s+" and "+status_date_end.to_s+")
               or exists
                   (select 0 from status_changes sc
                   where sc.created_at =
                       (select max(sc2.created_at)
                       from status_changes sc2
                       where sc2.policy_id = p.id
                       and sc2.created_at < "+status_date_start.to_s+")
                   and sc.status_id = '"+search[:status_id].to_s+"'
                   and sc.policy_id = p.id)" unless search[:status_id].blank? 
```

我的查找语句： Policy.find(:all,:include=>[{:client=>[:agent,:source_id,:source_code]},{:status_changes=>:status}], :conditions=>[status_search] )

我在我的日志中收到此错误消息：

```
ActiveRecord::StatementInvalid (Mysql::Error: Operand should contain 1 column(s): SELECT DISTINCT `policies`.id FROM `policies`  LEFT OUTER JOIN `clients` ON `clients`.id = `policies`.client_id WHERE ((((policies.created_at BETWEEN '2009-01-01' AND '2009-03-10' OR policies.created_at = '2009-01-01' OR policies.created_at = '2009-03-10')))) AND (select p.*
               from policies p
               where exists
                   (select 0 from status_changes sc
                   where sc.policy_id = p.id
                   and sc.status_id = '2'
                   and sc.created_at between 2009-03-10 and 2009-03-10)
               or exists
                   (select 0 from status_changes sc
                   where sc.created_at =
                       (select max(sc2.created_at)
                       from status_changes sc2
                       where sc2.policy_id = p.id
                       and sc2.created_at < 2009-03-10)
                   and sc.status_id = '2'
                   and sc.policy_id = p.id))  ORDER BY clients.created_at DESC LIMIT 0, 25): 
```

这里的主要故障是什么 - 为什么抱怨这些列？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T01:53:44.103

条件修饰符需要一个条件（例如，可以在 where 子句中的布尔表达式），并且您正在向它传递整个查询（选择语句）。

看起来好像你想一口气做太多事情，应该把它分解成更小的步骤。几点建议：

*   使用查询`find_by_sql`并且不要弄乱条件。

*   使用 rails finder 并过滤 rails 代码中的记录

`status_date_start`另外，请注意，如果类似的值可以来自用户，那么以这种方式构造查询是不安全的。查看“sql 注入攻击”以了解问题所在，并阅读 rails 文档和示例`find_by_sql`以了解如何避免它们。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T03:05:06.210

好的，我已经设法对其进行了重新调整，因此它对条件修饰符更友好，并且我认为它正确地执行了 sql 查询。但是，当我尝试列出当前状态时，它正在返回策略（policy.status_change .last.status) 它被设置为查询中使用的相同状态 - 这是不正确的

这是我更新的条件字符串..

```
status_search = "status_changes.created_at between ? and ? and status_changes.status_id = ?) or 
      (status_changes.created_at = (SELECT MAX(sc2.created_at) FROM status_changes sc2 
              WHERE sc2.policy_id = policies.id and sc2.created_at < ?) and status_changes.status_id = ?" 
```

一旦在查询中找到状态更改，是否有明显的事情不会返回所有剩余的关联状态更改？

这是更新的发现..

```
Policy.find(:all,:include=>[{:client=>[:agent,:source_id,:source_code]},:status_changes],
  :conditions=>[status_search,status_date_start,status_date_end,search[:status_id].to_s,status_date_start,search[:status_id].to_s]) 
```

# c - 在 C89 中转发声明 typedef 结构的更好方法？

> ID：632891
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T00:40:16.993
> 
>         
> 
> 标签：c, typedef, forward-declaration, c89

```
struct SomeStruct;
typedef struct SomeStruct SomeStruct; 
```

以上方法有效，但有更简单（或更好）的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:25:05.840

原来我不需要第一行。第二行自行工作。

# c++ - 分布式进程异步通信的最佳方式是什么？

> ID：632896
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-11T00:41:21.063
> 
>         
> 
> 标签：c++, sockets, messaging

我正在开发一个应用程序，其中分布式组件通过网络以异步、发布/订阅的方式相互通信。

为此，我喜欢通过套接字发送 XML 的想法——它是异步的，我不需要任何类型的服务器，它可以在本地或通过网络工作。我将不得不推出我自己的发布/订阅机制，这可能不会太繁琐——我可以使用 IP 地址作为订阅者的 ID。实现语言将是 C++。我以前用过这种方法，效果很好。但是，我想知道是否有更好的方法？欢迎任何建议。

编辑：我还没有做出决定，但我对 cparcode 对 protobuf 的评论很感兴趣：

“我从不理解使用 XML 进行网络通信的流行度。无论如何，我意识到协议只是你问题的一部分，但在这个问题上，还有谷歌的 protobuf：[http ://code.google.com/p/protobuf /](http://code.google.com/p/protobuf/) – caparcode (3 月 11 日 1:01)"

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T00:55:29.907

最好不要使用 XML，而是使用现有的消息传递框架。看看[libt2n](http://www.intra2net.com/en/developer/libt2n/index.php)或[d-bus](http://www.freedesktop.org/wiki/Software/dbus)

但是如果您过去使用过自己的套接字实现并取得了很好的效果，我看不出您应该改变的理由。如果它没有坏，请不要修复它:)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T01:13:07.913

[您可以考虑使用 AMQP 之类的解决方案](http://www.amqp.org)，而不仅仅是直接的套接字。  

当您谈论将套接字连接用于发布/订阅接口时，这通常意味着点对点通信，这并不总是一种可扩展的解决方案。AMQP 真正解决了这种发布/订阅问题。它是免费的，它是开源的，并且可以工作。

鉴于他们已经解决了发布/订阅问题，您可能希望利用他们的工作，而不是自己动手。  

我推荐[OpenAMQ。](http://www.openamq.org)  

话虽如此，这实际上取决于您在哪种环境中工作。AMQP 需要 AMQP 代理（负责路由消息的应用程序）在系统中的某个位置运行。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T05:08:30.017

看看[ActiveMQ](http://activemq.apache.org/)。它是一个[JMS](http://java.sun.com/products/jms/)提供者，还具有许多其他语言的绑定，适用于多种传输，并且具有用于其消息的一系列协议。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-14T11:46:49.610

RabbitMQ 也是一个 AMQP 代理，它还使用适配器支持其他协议，如 XMPP、HTTP、STOMP、SMTP。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:05:16.123

特别是如果您以前做过，并且仍然满足您的需求，请坚持下去。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:44:36.950

在您的应用程序中嵌入 Web 服务器怎么样？[EasyHTTPD](http://sourceforge.net/projects/ehttpd/)是开源的 C++ 并且非常易于使用。异步部分很简单。您要么在发送者或接收者上启动一个新线程。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T02:51:56.990

如果您正在寻找 XML 和跨平台启动，您可以考虑使用像 SOAP 这样的 XML-RPC 机制（我使用 gSoap 在 linux 上的 C 服务器与 win32 上的 C++ 客户端之间进行通信，它运行良好一旦你弄清楚了）。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T07:32:10.170

如果您不太倾向于 XML，并且想要一些简单而高效的东西，那么请考虑查看[YAMI](http://www.msobczak.com/prog/yami/)库。它使用起来相当简单，并且给定的链接包含足够的文档、基本原理和示例以供入门。

# c++ - 如何在 C++ 中制作图标按钮

> ID：632919
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-11T00:50:24.223
> 
>         
> 
> 标签：c++, winapi, button, reference, icons

我知道如何在 C++ 中绘制一个按钮，但我将如何在其上制作一个图标，有人可以发布源代码或提供参考吗？通过 SendMessage() 或者如果不是这样，请粘贴

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-11T02:53:11.823

由于您是新手，您可能还希望查阅 MSDN 库。您可以找到有关[按钮样式](http://msdn.microsoft.com/en-us/library/bb775951(VS.85).aspx)的信息（具体参见 BS ICON 和 BS BITMAP 样式）和[BM_SETIMAGE 消息](http://msdn.microsoft.com/en-us/library/bb761822(VS.85).aspx)。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T02:40:41.370

如果您使用 MFC，那么我建议您使用以下`CButton`方法`SetIcon`：

```
CButton myButton;

// Create an icon button.
myButton.Create(_T("My button"), WS_CHILD|WS_VISIBLE|BS_ICON, 
   CRect(10,10,60,50), pParentWnd, 1);

// Set the icon of the button to be the system question mark icon.
myButton.SetIcon( ::LoadIcon(NULL, IDI_QUESTION) ); 
```

这很好用。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2014-01-16T16:59:28.030

发送 BM_SETIMAGE 消息，并将加载的图像句柄传递给 lParam。

```
button1 = CreateWindowW(L"BUTTON", L"&Button", WS_VISIBLE | WS_CHILD | WS_TABSTOP | BS_BITMAP, 20, 50, 80, 25, hwnd, (HMENU) 600, NULL, NULL);

hImg = LoadImageW(NULL, L"test123.bmp", IMAGE_BITMAP, 0, 0, LR_DEFAULTCOLOR | LR_DEFAULTSIZE | LR_LOADFROMFILE);
SendMessageW(button1, BM_SETIMAGE, IMAGE_BITMAP, (LPARAM) hImg); 
```

PS: CreateWindow() 时需要使用 BS_BITMAP 标志

# apache - Apache，.htaccess - 禁止直接访问文件，但允许重写到那里

> ID：632921
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T00:51:39.213
> 
>         
> 
> 标签：apache, .htaccess, url-rewriting

我已经想出了如何写类似的东西

```
 www.test.com/test 
```

至

```
 www.test.com/test.php. 
```

这对于提供更简单的浏览体验和模糊 PHP 的使用很有用。但是，我想走得更远，禁止访问

```
 www.test.com/test.php 
```

完全，并且只允许通过

```
 www.test.com/test 
```

为了防止人们通过简单地在 URL 中尝试来发现 PHP 的使用。

问题是，如果我不允许访问

```
 www.test.com/test.php 
```

然后

```
 www.test.com/test 
```

不再起作用，因为在重写后触发了禁止规则

```
 www.test.com/test.php 
```

已经完成了。

这可能吗？欢迎任何隐藏所用编程语言的替代建议。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T01:44:55.247

您可以做的一件事是将 PHP 文件定位在文档根目录之外的某个位置并使用 AliasMatch 指令。如果您的 PHP 文件在`/var/www-php/www.test.com`尝试中

```
AliasMatch ^(.*)$ /var/www-php/www.test.com/$1.php 
```

通常，当您想要禁止访问文件时，除非在特定条件下，将它们移到文档根目录之外是一种很好的方法。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:19:41.393

看看“最后一条规则”和“不继续”标志。

[http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)

```
This is an example to block certain domains from hotlinking to your images.
You could apply it to your case (the NC flags is important) :

    RewriteCond %{HTTP_REFERER} !^http://(www\.)?leech_site\.com/ [NC]
    RewriteRule \.(gif|jpg|png)$ - [F,L] 
```

# java - 在 Java 中从 PDF 生成 PCL

> ID：632933
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-11T00:56:17.080
> 
>         
> 
> 标签：java, pdf, printer-control-language

从 Java 中的现有 PDF 文件生成 PCL 输出文件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:35:38.997

这取决于您要投资多少，以及解决方案需要有多强大。为了快速和肮脏，您可以使用 PCL 驱动程序从 Adob​​e Acrobat 打印到文件（看，妈妈，没有 Java ...）。

[Java Print Service API](http://java.sun.com/javase/6/docs/technotes/guides/jps/spec/printing.fm2.html)可以处理 PDF 。使用 StreamPrintService 并将流写入文件，使用 PCL 作为输出格式。

如果您需要对内容进行更多控制，可能对其进行修改或添加，您可以使用 PDF 解析器（例如[这个](http://pdftohtml.sourceforge.net/)）并通过添加一些 Javascript 从您的应用程序启动的浏览器打印生成的 HTML，例如。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2010-03-24T16:08:05.190

JDK 6 中的 StreamPrintService 仅支持 PS。我仍在寻找支持 PCL 的 StreamPrintService。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2010-12-31T17:59:05.943

我们捕获从 Acrobat 打印 PDF 生成的 PCL 到 PCL 驱动程序，并将作为输入重定向到我们的 Windows 控制台 PCLXForm 程序。使用自定义脚本，我们可以“流式编辑”PCL。我们可以提取地址块文本进行地址更正、插入更正文本、添加智能邮件条码、二维条码、对文档进行排序、按页数进行批处理、更改托盘分配、与其他文档合并等。需要 PCLTool SDK - www.pagetech.com 上的选项 V

# regex - 帮助缩短具有重复子模式的正则表达式

> ID：632939
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T00:58:01.443
> 
>         
> 
> 标签：regex

我在我正在处理的项目中生成了以下正则表达式，它工作正常，但出于专业的好奇心，我想知道它是否可以“压缩/缩短”：

```
 /[(]PRD[)].+;.+;.*;.+;.+;.*;.*;.*;/ 
```

正则表达式对我来说总是像巫毒一样......

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T01:02:19.280

对于初学者，单字符块可以消失：

```
/\(PRD\).+;.+;.*;.+;.+;.*;.*;.*;/ 
```

接下来，您可以将相关项目组合在一起：

```
/\(PRD\)(.+;){2}.*;(.+;){2}(.*;){3}/ 
```

不过，这实际上使它的文本更长。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T01:39:10.877

```
/\(PRD\)(.+;.+;.*;){2}(.*;){2}/ 
```

短于

```
/\(PRD\)((.+;){2}.*;){2}(.*;){2}/ 
```

但可以说不那么令人敬畏。两者都成功地短于

```
/[(]PRD[)].+;.+;.*;.+;.+;.*;.*;.*;/ 
```

虽然（如果只是因为字符类的变化）。

或者你甚至可以和

```
/\(PRD\)(.+;.+;.*;){2}.*;.*;/ 
```

这*可能*是使用相同规则可以获得的最短时间。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:03:44.177

```
/\(PRD\).+;.+;.*;.+;.+;(.*;){3}/ 
```

我认为您不会获得太多收益并得出相同的确切规则。如果您不想在“;”之间制作所有文本 可选，那么您可以：

```
/\(PRD\)(.*;){8}/ 
```

# css - 父>子CSS选择器

> ID：632954
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-11T01:05:05.030
> 
>         
> 
> 标签：css, css-selectors

我经常使用这个 CSS 选择器 parent>child。我的设计在 Mozilla 和 Opera 中看起来不错。  

但是在 IE 中，它很糟糕。我知道`>`在 IE 中无法识别，但是 IE 中的替代方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-03-11T01:10:22.927

一种替代方法是使用通用选择器来制定更具体的规则，如果节点不是直接子节点，该规则将生效：

```
div p {color: red;}     // Takes effect if there's a <p> child at some level
div * p {color: black;} // .. but this'll be true if it's not a direct child 
```

但是，您需要注意特异性冲突。`div * p`例如，将比适用于一般段落的另一条规则更具体。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-03-11T01:08:08.533

IE6 中的直接子选择器没有替代选择（尽管它应该在 IE7 中工作）。

相反，您需要使用后代选择器（空格）并设计您的类来补偿。

# python - 无法将一个文件中的代码分离到 AWK/Python 中的多个文件

> ID：632958
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T01:06:34.840
> 
>         
> 
> 标签：python, awk

我需要将不同的代码放在一个文件中的多个文件中。该文件显然由 AWK 的创建者在其主页上共享。该文件也在[这里](http://dpaste.com/12282/)以方便使用。

**我对这个问题的尝试**

我可以通过以下方式获取每个代码所在的行

```
awk '{ print $1 }' 
```

但是，我不知道如何

1.  获取确切的行号，以便我可以使用它们

2.  收集特定行之间的代码，以便忽略每行的第一个单词

3.  将这些单独的代码放入以该行的第一个单词命名的新文件中

我确信这个问题可以通过 AWK 和 Python 来解决。也许，我们需要一起使用它们。

**[编辑]**在第一个答案之后

当我尝试使用 awk 执行它时出现以下错误

```
$awk awkcode.txt 
awk: syntax error at source line 1
 context is
     >>> awkcode <<< .txt
awk: bailing out at source line 1 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T10:56:35.560

您是否尝试过：

1.  创建具有以下内容的文件 unbundle.awk：

$1 != prev { close(prev); prev = $1 } { print substr($0, index($0, " ") + 1) >$1 }

2.  从文件 awkcode.txt 中删除以下行：

    **# unbundle - 将一个包解压成单独的文件**

$1 != prev { close(prev); prev = $1 } { print substr($0, index($0, " ") + 1) >$1 }

3.  运行以下命令：

awk -f unbundle.awk awkcode.txt

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:38:06.497

您是否尝试解压缩该格式的文件？它是一种 shell 存档。有关详细信息，请参阅[http://en.wikipedia.org/wiki/Shar](http://en.wikipedia.org/wiki/Shar)

如果您使用 awk 执行该程序，则 awk 将创建所有这些文件。您不需要编写或重写太多。您可以简单地运行该 awk 程序，它应该仍然可以工作。

首先，以“普通”格式查看文件。  [http://dpaste.com/12282/plain/](http://dpaste.com/12282/plain/)

其次，将文件的普通版本保存为“awkcode.shar”

第三，我认为您需要使用以下命令。

```
awk -f awkcode.shar 
```

* * *

如果你想用 Python 程序替换它，它会是这样的。

```
import urllib2, sys

data= urllib2.urlopen( "http://dpaste.com/12282/plain/" )
currName, currFile = None, sys.stdout
for line in data:
    fileName, _, text= line.strip().partition(' ')
    if fileName == currName:
        currFile.write(line+"\n")
    else:
        if currFile is not None:
            currFile.close()
        currName= fileName
        currFile= open( currName, "w" )
if currFile is not None:
    currFile.close() 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2013-10-07T07:47:06.670

awk 文件 awkcode.txt 不应包含任何空白行。如果遇到任何空行，则 awk 程序将失败。没有错误检查来过滤掉代码中的空白行。经过几天的努力，我可以发现这一点。

# dependency-injection - IOC 依赖注入部署（bin ? GAC ?）

> ID：632960
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-11T01:07:50.860
> 
>         
> 
> 标签：dependency-injection, hosting, shared-hosting

最流行的 IOC 容器（例如：Windsor、Ninject、Unity、StructureMap、Autofac）是否有任何部署要求？他们都部署相同吗？

如果您在共享主机上，会带来哪些挑战（例如中等信任度等...）

它们可以被 bin 部署吗？GAC 部署？

任何“IOC 就绪”的网络托管服务商？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:19:46.087

大多数 IOC 框架都与私有程序集一起使用，我不知道有多少 Web 托管程序允许您将文件部署到 GAC 中。

# c# - 我可以在 ASP.NET MVC 中指定自定义位置来“搜索视图”吗？

> ID：632964
> 
>         
> 
> 赞同：106
> 
>         
> 
> 时间：2009-03-11T01:09:46.033
> 
>         
> 
> 标签：c#, asp.net, webforms

我的 mvc 项目有以下布局：

*   /控制器

    *   /演示

    *   /Demo/DemoArea1Controller

    *   /Demo/DemoArea2Controller

    *   ETC...

*   /意见

    *   /演示

    *   /Demo/DemoArea1/Index.aspx

    *   /Demo/DemoArea2/Index.aspx

但是，当我有这个时`DemoArea1Controller`：

```
public class DemoArea1Controller : Controller
{
    public ActionResult Index()
    {
        return View();
    }
} 
```

我收到“无法找到视图'索引'或其主人”错误，以及通常的搜索位置。

如何在“Demo”视图子文件夹中的“Demo”命名空间搜索中指定控制器？

* * *

## 回答 #1

> 赞同：122
> 
>             
> 
> 时间：2009-05-26T08:30:21.817

您可以轻松扩展 WebFormViewEngine 以指定要查看的所有位置：

```
public class CustomViewEngine : WebFormViewEngine
{
    public CustomViewEngine()
    {
        var viewLocations =  new[] {  
            "~/Views/{1}/{0}.aspx",  
            "~/Views/{1}/{0}.ascx",  
            "~/Views/Shared/{0}.aspx",  
            "~/Views/Shared/{0}.ascx",  
            "~/AnotherPath/Views/{0}.ascx"
            // etc
        };

        this.PartialViewLocationFormats = viewLocations;
        this.ViewLocationFormats = viewLocations;
    }
} 
```

确保您记得通过修改 Global.asax.cs 中的 Application_Start 方法来注册视图引擎

```
protected void Application_Start()
{
    ViewEngines.Engines.Clear();
    ViewEngines.Engines.Add(new CustomViewEngine());
} 
```

* * *

## 回答 #2

> 赞同：49
> 
>             
> 
> 时间：2015-06-18T20:09:23.330

现在在 MVC 6 中，您可以实现`IViewLocationExpander`接口而不用弄乱视图引擎：

```
public class MyViewLocationExpander : IViewLocationExpander
{
    public void PopulateValues(ViewLocationExpanderContext context) {}

    public IEnumerable<string> ExpandViewLocations(ViewLocationExpanderContext context, IEnumerable<string> viewLocations)
    {
        return new[]
        {
            "/AnotherPath/Views/{1}/{0}.cshtml",
            "/AnotherPath/Views/Shared/{0}.cshtml"
        }; // add `.Union(viewLocations)` to add default locations
    }
} 
```

其中`{0}`是目标视图名称，`{1}`- 控制器名称和`{2}`- 区域名称。

您可以返回自己的位置列表，将其与默认位置`viewLocations`( `.Union(viewLocations)`) 合并或仅更改它们 ( `viewLocations.Select(path => "/AnotherPath" + path)`)。

要在 MVC 中注册您的自定义视图位置扩展器，请在文件中的`ConfigureServices`方法中添加下一行：`Startup.cs`

```
public void ConfigureServices(IServiceCollection services)
{
    services.Configure<RazorViewEngineOptions>(options =>
    {
        options.ViewLocationExpanders.Add(new MyViewLocationExpander());
    });
} 
```

* * *

## 回答 #3

> 赞同：42
> 
>             
> 
> 时间：2011-09-26T15:15:20.463

实际上有比将路径硬编码到构造函数中更简单的方法。下面是扩展 Razor 引擎以添加新路径的示例。我不完全确定的一件事是您在此处添加的路径是否会被缓存：

```
public class ExtendedRazorViewEngine : RazorViewEngine
{
    public void AddViewLocationFormat(string paths)
    {
        List<string> existingPaths = new List<string>(ViewLocationFormats);
        existingPaths.Add(paths);

        ViewLocationFormats = existingPaths.ToArray();
    }

    public void AddPartialViewLocationFormat(string paths)
    {
        List<string> existingPaths = new List<string>(PartialViewLocationFormats);
        existingPaths.Add(paths);

        PartialViewLocationFormats = existingPaths.ToArray();
    }
} 
```

还有你的 Global.asax.cs

```
protected void Application_Start()
{
    ViewEngines.Engines.Clear();

    ExtendedRazorViewEngine engine = new ExtendedRazorViewEngine();
    engine.AddViewLocationFormat("~/MyThemes/{1}/{0}.cshtml");
    engine.AddViewLocationFormat("~/MyThemes/{1}/{0}.vbhtml");

    // Add a shared location too, as the lines above are controller specific
    engine.AddPartialViewLocationFormat("~/MyThemes/{0}.cshtml");
    engine.AddPartialViewLocationFormat("~/MyThemes/{0}.vbhtml");

    ViewEngines.Engines.Add(engine);

    AreaRegistration.RegisterAllAreas();
    RegisterRoutes(RouteTable.Routes);
} 
```

需要注意的一件事：您的自定义位置将需要其根目录中的 ViewStart.cshtml 文件。

* * *

## 回答 #4

> 赞同：23
> 
>             
> 
> 时间：2012-05-21T20:34:52.993

如果您只想添加新路径，可以添加到默认视图引擎并节省一些代码行：

```
ViewEngines.Engines.Clear();
var razorEngine = new RazorViewEngine();
razorEngine.MasterLocationFormats = razorEngine.MasterLocationFormats
      .Concat(new[] { 
          "~/custom/path/{0}.cshtml" 
      }).ToArray();

razorEngine.PartialViewLocationFormats = razorEngine.PartialViewLocationFormats
      .Concat(new[] { 
          "~/custom/path/{1}/{0}.cshtml",   // {1} = controller name
          "~/custom/path/Shared/{0}.cshtml" 
      }).ToArray();

ViewEngines.Engines.Add(razorEngine); 
```

这同样适用于`WebFormEngine`

* * *

## 回答 #5

> 赞同：13
> 
>             
> 
> 时间：2013-09-09T17:30:53.157

您可以更改现有 RazorViewEngine 的 PartialViewLocationFormats 属性，而不是继承 RazorViewEngine 或直接替换它。此代码进入 Application_Start：

```
System.Web.Mvc.RazorViewEngine rve = (RazorViewEngine)ViewEngines.Engines
  .Where(e=>e.GetType()==typeof(RazorViewEngine))
  .FirstOrDefault();

string[] additionalPartialViewLocations = new[] { 
  "~/Views/[YourCustomPathHere]"
};

if(rve!=null)
{
  rve.PartialViewLocationFormats = rve.PartialViewLocationFormats
    .Union( additionalPartialViewLocations )
    .ToArray();
} 
```

* * *

## 回答 #6

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T01:13:47.617

最后我检查了一下，这需要您构建自己的 ViewEngine。我不知道他们是否在 RC1 中让它变得更容易。

我在第一个 RC 之前使用的基本方法是，在我自己的 ViewEngine 中，拆分控制器的命名空间并查找与部件匹配的文件夹。

**编辑：**

回去发现了代码。这是一般的想法。

```
public override ViewEngineResult FindView(ControllerContext controllerContext, string viewName, string masterName)
{
    string ns = controllerContext.Controller.GetType().Namespace;
    string controller = controllerContext.Controller.GetType().Name.Replace("Controller", "");

    //try to find the view
    string rel = "~/Views/" +
        (
            ns == baseControllerNamespace ? "" :
            ns.Substring(baseControllerNamespace.Length + 1).Replace(".", "/") + "/"
        )
        + controller;
    string[] pathsToSearch = new string[]{
        rel+"/"+viewName+".aspx",
        rel+"/"+viewName+".ascx"
    };

    string viewPath = null;
    foreach (var path in pathsToSearch)
    {
        if (this.VirtualPathProvider.FileExists(path))
        {
            viewPath = path;
            break;
        }
    }

    if (viewPath != null)
    {
        string masterPath = null;

        //try find the master
        if (!string.IsNullOrEmpty(masterName))
        {

            string[] masterPathsToSearch = new string[]{
                rel+"/"+masterName+".master",
                "~/Views/"+ controller +"/"+ masterName+".master",
                "~/Views/Shared/"+ masterName+".master"
            };

            foreach (var path in masterPathsToSearch)
            {
                if (this.VirtualPathProvider.FileExists(path))
                {
                    masterPath = path;
                    break;
                }
            }
        }

        if (string.IsNullOrEmpty(masterName) || masterPath != null)
        {
            return new ViewEngineResult(
                this.CreateView(controllerContext, viewPath, masterPath), this);
        }
    }

    //try default implementation
    var result = base.FindView(controllerContext, viewName, masterName);
    if (result.View == null)
    {
        //add the location searched
        return new ViewEngineResult(pathsToSearch);
    }
    return result;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
>             
> 
> 时间：2009-06-13T17:21:37.260

尝试这样的事情：

```
private static void RegisterViewEngines(ICollection<IViewEngine> engines)
{
    engines.Add(new WebFormViewEngine
    {
        MasterLocationFormats = new[] {"~/App/Views/Admin/{0}.master"},
        PartialViewLocationFormats = new[] {"~/App/Views/Admin//{1}/{0}.ascx"},
        ViewLocationFormats = new[] {"~/App/Views/Admin//{1}/{0}.aspx"}
    });
}

protected void Application_Start()
{
    RegisterViewEngines(ViewEngines.Engines);
} 
```

* * *

## 回答 #8

> 赞同：3
> 
>             
> 
> 时间：2009-08-07T03:24:55.320

注意：对于 ASP.NET MVC 2，它们有额外的位置路径，您需要为“区域”中的视图设置。

```
 AreaViewLocationFormats
 AreaPartialViewLocationFormats
 AreaMasterLocationFormats 
```

[Phil 的博客](http://haacked.com/archive/2009/07/31/single-project-areas.aspx)中描述了为区域创建视图引擎。

注意：这是预览版 1，因此可能会发生变化。

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2020-01-26T04:25:24.483

这里的大多数答案，通过调用**清除现有位置**`ViewEngines.Engines.Clear()`，然后重新添加它们......没有必要这样做。

我们可以简单地将新位置添加到现有位置，如下所示：

```
// note that the base class is RazorViewEngine, NOT WebFormViewEngine
public class ExpandedViewEngine : RazorViewEngine
{
    public ExpandedViewEngine()
    {
        var customViewSubfolders = new[] 
        {
            // {1} is conroller name, {0} is action name
            "~/Areas/AreaName/Views/Subfolder1/{1}/{0}.cshtml",
            "~/Areas/AreaName/Views/Subfolder1/Shared/{0}.cshtml"
        };

        var customPartialViewSubfolders = new[] 
        {
            "~/Areas/MyAreaName/Views/Subfolder1/{1}/Partials/{0}.cshtml",
            "~/Areas/MyAreaName/Views/Subfolder1/Shared/Partials/{0}.cshtml"
        };

        ViewLocationFormats = ViewLocationFormats.Union(customViewSubfolders).ToArray();
        PartialViewLocationFormats = PartialViewLocationFormats.Union(customPartialViewSubfolders).ToArray();

        // use the following if you want to extend the master locations
        // MasterLocationFormats = MasterLocationFormats.Union(new[] { "new master location" }).ToArray();   
    }
} 
```

`RazorViewEngine`现在您可以配置您的项目以在 Global.asax中使用上述内容：

```
protected void Application_Start()
{
    ViewEngines.Engines.Add(new ExpandedViewEngine());
    // more configurations
} 
```

有关更多信息，请参阅[本教程](https://exceptionnotfound.net/a-simple-custom-viewengine-for-asp-net-mvc/)。

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2020-09-04T13:07:09.440

我在 MVC 5 中这样做了。我不想清除默认位置。

助手类：

```
namespace ConKit.Helpers
{
    public static class AppStartHelper
    {
        public static void AddConKitViewLocations()
        {
            // get engine
            RazorViewEngine engine = ViewEngines.Engines.OfType<RazorViewEngine>().FirstOrDefault();
            if (engine == null)
            {
                return;
            }

            // extend view locations
            engine.ViewLocationFormats =
                engine.ViewLocationFormats.Concat(new string[] {
                    "~/Views/ConKit/{1}/{0}.cshtml",
                    "~/Views/ConKit/{0}.cshtml"
                }).ToArray();

            // extend partial view locations
            engine.PartialViewLocationFormats =
                engine.PartialViewLocationFormats.Concat(new string[] {
                    "~/Views/ConKit/{0}.cshtml"
                }).ToArray();
        }
    }
} 
```

然后在 Application_Start 中：

```
// Add ConKit View locations
ConKit.Helpers.AppStartHelper.AddConKitViewLocations(); 
```

# objective-c - NSMutableArray 添加新方法

> ID：632968
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T01:12:42.983
> 
>         
> 
> 标签：objective-c, arrays

经过一番研究，我发现了一段代码，它显示了如何扩展 NSMutableArray 功能以轻松使用二维数组。

[http://www.seattlexcoders.org/shared/Mutable%202D%20Array/](http://www.seattlexcoders.org/shared/Mutable%202D%20Array/)

我的这个特殊 NSMutableArray 的声明语句会是什么样子？

与以下

```
#import "ZNMutable2DArray.h"
@interface MainView : UIView {
    ZNMutable2DArray *tiles;
}

@property(nonatomic,retain) ZNMutable2DArray *tiles; 
```

它给了我错误“ZNMutable2DArray 之前的语法错误..”

谢谢你，克里斯

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-11T01:44:31.333

ZNMutable2DArray 只是 NSMutableArray 上的一个类别，因此您可以将其声明为`NSMutableArray *`. 它没有什么特别之处——这些方法对所有 NSMutableArrays 都可用。它的作用是创建一个充满 NSMutableArrays 的 NSMutableArray，这些就是你的“行”。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:50:21.880

它是一个类别，而不是一个子类。您可以像以前一样声明一个子类，但是通过使用此类别进行编译，您已经改变了 NSMutableArray 本身。所以声明为：

```
NSMutableArray *tiles; 
```

# sql - Ruby on Rails 根据数据库值计算“排名”？

> ID：632971
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-11T01:13:35.337
> 
>         
> 
> 标签：sql, ruby-on-rails, database

有没有一种简单快捷的方法来使用 Ruby on Rails 计算数据库中字段的排名？例如，如果我有一个 math_scores 表，并且想找到一个给定的

```
MathScore.find(:all, :condtions => ... :order =>...) 
```

然后遍历所有这些以找出测试分数下降的位置，但必须有一种更直接的方法......有什么建议吗？

这是有关架构的一些信息，它只是一个简单的表：

名字 varchar(50)

姓氏 varchar(50)

test_id 整数

分数浮动

澄清：我想通过问题更接近我在执行以下操作时如何检索排名值：

```
rank = MathScore.find_by_sql(
       "select count(*) as rank 
        from (
          select * from math_scores 
          where score > (select score from high_scores where test_id = 33 
          AND first_name = 'John' AND last_name = 'Doe'
        ) 
        order by score desc
      ) as s"
) 
```

我`[#<HighScore:0x6ca4724 @attributes={"rank"=>"3"}>]:Array`是根据查询获得的，但是如何获得排名值？

在此先感谢，本

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-11T01:41:12.433

您可以在 Rails 2.2 中使用[命名范围](http://railscasts.com/episodes/108-named-scope)来帮助解决这个问题，例如。

```
class MathScore
  named_scope :passed, :conditions => {:score => 60..100 }
  named_scope :failed, :conditions => {:score => 0..59}
end 
```

这将允许您在控制器中执行以下操作：

```
@passing_scores = MathScore.passed
@failing_scores = MathScore.failed 
```

因此，您可以在视图中遍历它们。

* * *

回应您的澄清（在erb中）：

```
<% your_array.each do |hs| %>
  <%= hs.rank %>
<% end %> 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T02:32:53.260

```
sql = "select count(*) as rank from (select * from math_scores where score > (select score from high_scores where test_id = 33 AND first_name = 'John' AND last_name = 'Doe') order by score desc) as s"
rank = MathScore.find_by_sql(sql)[0].rank 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:28:01.637

我不是特别了解 Rails，但我假设以下 SQL 示例有一些等价物。

SELECT COUNT(*) + 1 在相关行之前的所有行。

例如，要获取您知道的分数为 75.0 的项目的排名：

```
SELECT COUNT(*) + 1 as [rank] from my_table
    WHERE score > 75.0 
```

如果您不知道该项目的分数，但您知道其他识别信息：

```
SELECT COUNT(*) + 1 as [rank] from my_table
    WHERE score > (SELECT score FROM my_table WHERE test_id = 123) 
```

这具有将相同等级分配给具有相同分数的测试的副作用，但仍然正确分配它。所以你可能有一个分数在 1 级，然后两个分数与 2 级并列，然后下一个分数是 4 级，等等。如果你不喜欢这种副作用，你可以用你的 WHERE 子句来分割它们test_id 或名字和姓氏。

这只是一次仅用于一项测试的适当解决方案。如果你想对它们都进行排名，你不妨把它们都取出来，按分数排序，然后自己对它们进行排名。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T02:38:20.593

不确定你有什么 DBMS；但大多数支持 rank 和 dense_rank SQL 函数（窗口函数）。例子：

```
SQL> select ename,sal,
  2   row_number()
  3     over (order by sal desc)rn,
  4   rank()
  5     over (order by sal desc)rnk,
  6   dense_rank()
  7     over (order by sal desc)drnk
  8   from emp
  9  order by sal desc
 10  /

ENAME    SAL   RN   RNK   DRNK
-----   ----   --   ---   ----
 KING   5000    1     1      1
 FORD   3000    2     2      2
SCOTT   3000    3     2      2
JONES   2975    4     4      3
BLAKE   2850    5     5      4
CLARK   2450    6     6      5 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:32:44.870

您是否试图确定测试分数在钟形曲线中的哪个位置？您可以尝试使用 MySQL 的内置 group by 函数之一为模型滚动您自己的函数，如 STDDEV_POP()。你可以在这里看到它们[。](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html)  通过一些花哨的步法，您可以通过一次调用 db 来返回成绩在曲线上的位置。

# css - CSS：文本区域的高度占视口高度的百分比

> ID：632983
> 
>         
> 
> 赞同：13
> 
>         
> 
> 时间：2009-03-11T01:25:34.687
> 
>         
> 
> 标签：css, height

我想说文本区域的高度等于视口高度的 50%。我怎样才能做到这一点？一个简单`height: 50%`的不做的伎俩。

* * *

## 回答 #1

> 赞同：42
> 
>             
> 
> 时间：2009-03-11T03:12:17.190

> 一个简单的高度：50% 并不能解决问题。

不，因为它的父级没有明确的高度。那么50%是什么？父母说“自动”，这意味着它基于子内容的高度。这取决于父母的身高。啊！等等

所以你必须给它的父母一个百分比高度。和父母的父母，一直到根。示例文档：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <style type="text/css">
        html, body { margin: 0; padding: 0; }
        html, body, #mything, #mything textarea { height: 100%; }
    </style>
</head><body>
    <div id="mything">
        <textarea rows="10" cols="40">x</textarea>
    </div>
</body></html> 
```

如果您不想在所有内容上设置高度，另一种可能性是使用绝对定位。这会将尺寸所基于的元素从直接父级更改为具有默认“静态”以外的“位置”设置的最近祖先。如果没有带定位的祖先元素，则尺寸基于“初始包含块”，它与视口大小相同。

最后，由于文本区域应用了额外的填充和边框，因此存在“100%”稍微太大的小问题。您可以通过以下方式解决此问题：

*   妥协于 95% 之类的东西，或

*   在 textarea 上将填充和边框设置为 0/none，或者

*   使用“box-sizing:border-box;” 改变“高度”的含义。这是 CSS 未来的一项功能，它需要许多额外的特定于浏览器的重述（例如“-moz-box-sizing”）。

* * *

## 回答 #2

> 赞同：10
> 
>             
> 
> 时间：2015-03-24T21:46:56.610

这是一个小例子，它使用 CSS3[视口单元](http://dev.w3.org/csswg/css-values-3/#viewport-relative-lengths)`textarea`恰好占据视口高度的 50%，它是`vh` 

> 等于初始包含块高度的 1%。

因此，如果我们将 的高度设置`textarea`为`50vh`，它将获得一半的`body`高度：

```
html, body, textarea {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  height: 100%;
}

textarea {
  height: 50vh;
}
```

```
<textarea></textarea>
```

It's [pretty good supported](http://caniuse.com/#feat=viewport-units) by the different browsers, except for *Opera mini* and partial support in *IE*.

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T01:33:56.007

我认为您需要以某种方式使用 javascript 来执行此操作。处理调整大小事件，并将文本区域设置为那么多像素。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T01:35:17.110

如果你设置显示：块，你可以做到这一点。但是在 html 4.01 strict 你必须定义 cols 和 rows，但我认为你可以用 css 覆盖它们。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-11T01:38:00.757

HTML 和 CSS 不太擅长用高度来做这种事情。它们肯定更多是关于垂直滚动自由流动的页面。正如 FryGuy 所说，我认为 JavaScript 可能是您最完整的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:37:39.337

虽然我没有在所有浏览器中对此进行测试，但似乎大多数人都接受简单地指定高度就可以了。

我在 Internet Explorer 7 和 Firefox 3.0 中对此进行了测试。

只需使用以下代码：

```
<textarea style="height: 50%; width: 80%;">Your text here</textarea> 
```

您遇到问题的浏览器是什么？

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2013-03-18T23:04:32.020

当这个问题被问到时，这可能不在，但 CSS Values and Units Module Level 3 包括[viewport-percentage lengths](http://www.w3.org/TR/css3-values/#viewport-relative-lengths)。不过，除了 iOS 之外的移动浏览器似乎[不支持](http://caniuse.com/#feat=viewport-units)它。

* * *

## 回答 #8

> 赞同：-2
> 
>             
> 
> 时间：2013-04-01T20:17:36.867

尝试删除

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

# vb.net - VB.net 3 个数字的平均值两种不同的方式。初学者问题

> ID：632988
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-11T01:33:20.657
> 
>         
> 
> 标签：vb.net, average

我有一个表单，其中包含 3 个文本框，用于 3 个输入值，以及一个用于输出的列表框。我需要用户能够输入 3 个不同的数字并单击一个按钮来查找平均值。我不确定如何做/处理这个。任何帮助是极大的赞赏。

还是卡住了……

```
Private Sub btnAverage_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)     
Handles btnAverage.Click
    Dim a As Integer = CInt(txtone.Text)
    Dim b As Integer = CInt(txtTwo.Text)
    Dim c As Integer = CInt(txtThree.Text)
    Dim average As Integer
    average = (a + b + c) / 3
    lstOutput.Text = average 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-11T01:37:50.350

您不确定如何将输入转换为数字？如果是这样，请使用 CInt 函数。

```
Public Sub OnAverageClick(ByVal sender as Object, ByVal e As EventArgs) Handles AverageButton.Click

    Dim input1 as Integer = CInt(textBox1.Text)
    Dim input2 as Integer = CInt(textBox2.Text)
    Dim input3 as Integer = CInt(textBox3.Text)
    Dim average = (input1 + input2 + input3) / 3

End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-11T01:46:37.707

@JaredPar

我会改用 Integer.TryParse 。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2015-03-25T16:38:50.863

此函数计算任意数量的非零值的平均值：

```
''' <summary>Calcula el Promedio de los Valores ingresados.
''' Sólo tiene en cuenta los Valores mayores que 0.</summary>
''' <param name="diasValores">Valores a Calcular</param>
Function PromedioValores(ByVal ParamArray diasValores() As Integer)
    'Esta funcion calcula el promedio de los valores ingresados como parametro
    Dim result As Double = 0
    If diasValores.Length <= 0 Then Exit Function
    Dim cant As Integer = 0
    For i As Integer = 0 To UBound(diasValores, 1)
        If diasValores(i) > 0 Then
            cant = cant + 1
            result += diasValores(i)
        End If
    Next i
    If result > 0 Then
        result = result / cant
    End If

    Return result
End Function 
```

采用：

```
Me.TextBox1.Text = PromedioValores(10, 0, 0, 15, 0, 12, 12, 0) 
```

* * *

## 回答 #4

> 赞同：-2
> 
>             
> 
> 时间：2009-03-11T01:36:52.317

```
protected sub on_btn_click()

listbox1.items.add(new listitem((integer.parse(textbox1.text) + integer.parse(textbox2.text) + integer.parse(textbox3.text)) / 3 ))

end sub 
```

# java - Ejb 3，消息驱动的 bean 与有状态会话 bean 合作？

> ID：632990
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-11T01:33:48.520
> 
>         
> 
> 标签：java, ejb-3.0, jboss-mdb, stateful

嘿！我对 Java EE 和 Stackowerflow 都比较陌生，请善待 :-)

我有一堆设备触发 Java 消息，以便在任何状态更改时发送。这些设备通常在大约 30-90 分钟的时间间隔内处于活动状态。除了事件详细信息之外，每条事件消息都包含一个设备 ID。

我的应用程序的核心是订阅这些事件的消息驱动 bean。每次收到事件时，我都必须访问数据库以查找有关设备的一些信息。

如果我可以将有状态会话 bean 与每个活动设备相关联，那将是非常棒的！如果这是一个 Web 应用程序，我会使用 http 会话来存储有状态 bean 的句柄或引用（我是对的吗？）。有什么方法可以从我的消息 bean 中存档？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-11T03:54:04.640

这会很好，只是不能像你解释的那样做。MDB（和 SLSB）根据定义是无状态的，因此仅在调用期间保持对话是安全的。

您最终可以打破规范并在某处（可能在 MDB 本身中）创建一个静态属性，但这肯定不是可移植的，也不是可扩展的。

我的建议是在 JPA 级别启用缓存（有关详细信息，请参阅您的首选持久性提供程序），因此您可以非常快速（非常快）查找所需的任何数据。这是可移植的和集群友好的。这就是我在项目中使用的方式，我对此非常满意。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-18T15:21:48.367

我不太愿意推荐特定的产品，但是 Terracotta 服务器不是这样解决需求的吗？******** 
```********