# StackOverflow 问答 12486000-12486999

# php - 使用 PHP 的 HTML DomDocument 解析 RSS/Atom 提要

> ID：12486003
> 
> 赞同：1
> 
> 时间：2012-09-18T22:29:02.933
> 
> 标签：php, xml, rss, domdocument, atom-feed

如何使用以下代码查找命名空间内容的值：encoded 和 dc:creator 不幸的是，我不能使用 simplepie 或 magpierss 甚至 simplexml。我知道我必须使用 $doc->getElementsByTagName，但不知道在哪里？

```
 `<?php    
function rss_to_array($tags, $array, $url) {

  $doc = new DOMdocument();
  @$doc->load($url);
  $rss_array = array();
  foreach($tags as $tag) {
    if ($doc->getElementsByTagName($tag)) {
      foreach($doc->getElementsByTagName($tag) AS $node) {
        $items = array();
        foreach($array AS $key => $values) {
          $items[$key] = array();
          foreach($values as $value) {
            if ($itemsCheck = $node->getElementsByTagName($value)) {
              for( $j=0 ;  $j < $itemsCheck->length; $j++ ) {
                if (($attribute = $itemsCheck->item($j)->nodeValue) != "") {
                  $items[$key][] = $attribute;
                } else if ($attribute = $itemsCheck->item($j)->getAttribute('term')) {
                  $items[$key][] = $attribute;
                } else if ($itemsCheck->item($j)->getAttribute('rel') == 'alternate') {
                  $items[$key][] = $itemsCheck->item($j)->getAttribute('href');
                }
              }
            }
          }
        }
        array_push($rss_array, $items);
      }
    }
  }
  return $rss_array;
}

$rss_item_tags = array('item', 'entry');
$rss_tags = array(
  'title' => array('title'),
  'description' => array('description', 'content', 'summary'),
  'link' => array('link', 'feedburner'),
  'category' => array('category')
);

$rssfeed = rss_to_array($rss_item_tags, $rss_tags, $url);

echo '<pre>';
print_r($rssfeed);
echo '</pre>';
exit;
?>` 

            回答 #1

赞同：1

时间：2012-09-18T22:32:17.717

对于 RSS 提要，请尝试使用 simplexml_load_file。它从 XML 中创建一个对象，并且由于所有 RSS 提要都是相同的，因此您可以执行以下操作：

```
$feed = simplexml_load_file(your_rss_url_here);

for($i=0; $i < 10; $i++){
// this is assuming there are 10 pieces of content for each RSS you're loading

    $link = $feed->channel->item[$i]->link;
    // do each for pubdate, author, description, title, etc.
} 
```

[http://php.net/manual/en/book.simplexml.php](http://php.net/manual/en/book.simplexml.php)

```

# ajax - HTML 5 Web 存储 - 本地/服务器通信

> ID：12486004
> 
> 赞同：2
> 
> 时间：2012-09-18T22:29:08.520
> 
> 标签：ajax, html, local-storage, web-storage

我需要在我的主页上加载 localStorage 数据。但是当页面加载时，PHP/SQL 指令已经被处理了。有没有办法在服务器交互之前处理它并在我的 SQL 指令中使用 localStorage 数据？

附言。我尝试了 AJAX，将我的主页加载到索引页面内的 DIV 中......但它没有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-20T14:50:44.857

答案是否定的——您无法在第*一次*加载网站时读取 LocalStorage 数据。但是，您可以使用 Ajax 访问您的服务器并将任何 LocalStorage 值的副本发送到您的服务器。您提到使用 ajax 在 div 中加载您的主页。如果您在 url 中传递 LocalStorage 信息，那*应该可以。*例如，假设您有一个名为 name 的本地存储键。如果你想将 foo.php 的内容加载到一个 div 并让 PHP 访问 name，你可以在 URL 中传递它：“foo.php?name="+escape(localstorage.name)”。你也可以也使用表格帖子。

# sql-server - 选择性能

> ID：12486007
> 
> 赞同：1
> 
> 时间：2012-09-18T22:29:28.100
> 
> 标签：sql-server, performance, select

公平地说，从这样的结果集中创建第二个（外部）“SELECT”不需要时间（与嵌套的 SELECT 相比）吗？

```
 SELECT some_column 
    FROM
         (
           SELECT some_column
           FROM some_table
         )
    AS _alias 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T22:41:59.977

SQL 优化器可能会将该 SELECT 语句视为已编写：

```
SELECT some_column FROM some_table 
```

所以不会有任何性能差异。优化器尽最大努力将生成答案的成本降至最低，并将重新编写您编写的查询以加快速度。只有最天真的优化器才会评估内部 SELECT 并将结果保存在表中，然后在该结果上运行外部 SELECT。

# c - 用多个 fork() 子级计算表达式？

> ID：12486011
> 
> 赞同：2
> 
> 时间：2012-09-18T22:30:03.397
> 
> 标签：c, linux, unix, fork, system-calls

假设我们有一个`g=(a+b)*(c+d)-(e/f)`带有硬编码任意数字变量的表达式。我想使用多个子进程来计算这个表达式，以便更好地理解 fork() 的工作原理。

我的第一次尝试是计算`(a + b)`子**pid1**、`(c + d)`子**pid2**、`(e / f)`子**pid3**，然后在**父**进程中进行求和和减法。

好吧，令我失望`(a + b)`的是，在子进程**pid1**中完成的计算并没有影响`double expression1`父进程中的变量。我认为这背后的原因——每个**fork()**都会创建一个单独的内存空间；一旦子进程退出，在该子进程中完成的所有计算都将消失。

在这种情况下，你通常会怎么做？我想也许我可以在一个子进程中嵌套 fork() 子进程来`(a + b)`首先计算；**等待**；然后`(c + d)`; **等待**；`(e / f)`; **等待**；**第一个孩子**计算整个表达式；孩子**返回（0）**；**父母**终止。

但我认为这个问题有一个更简单的解决方案，对吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T15:44:24.697

如果您坚持使用`fork()`，那么这是我现在使用子进程和共享内存的答案

请注意，`exit()`此处以系统预期的方式使用它：指示孩子是否正常退出。

```
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/shm.h>

struct shared{
    int a_b;
    int c_d;
    int e_f;
};
const int a=1,b=2,c=3,d=4,e=6,f=2;
const key_t key = 1234;
pid_t pab,pcd,pef;
void* shared_mem;

int main(){
    //Parent process create the shared memory 
    int shmid = shmget(key,sizeof(struct shared), 0666|IPC_CREAT);
    if(shmid == -1) exit(EXIT_FAILURE);

    //Fork child
    pab = fork();
    if(pab == 0){  
        //Inside process ab
        //attach to shared memory
        shared_mem = shmat(shmid,(void*) 0,0);
        if(shared_mem == (void*) -1) exit (EXIT_FAILURE);
        struct shared* shared_data = (struct shared*) shared_mem;
        shared_data->a_b = a +b;

        //detach
        if(shmdt(shared_mem) == -1) exit (EXIT_FAILURE);
        exit(EXIT_SUCCESS);
    }else {
        pcd = fork();
        if(pcd == 0){
            //Inside process cd
            //attach to shared memory
            shared_mem = shmat(shmid,(void*) 0,0);
            if(shared_mem == (void*) -1) exit (EXIT_FAILURE);
            struct shared* shared_data = (struct shared*) shared_mem;
            shared_data->c_d = c+d;

            //detach
            if(shmdt(shared_mem) == -1) exit (EXIT_FAILURE);
            exit(EXIT_SUCCESS);

        }else{
            pef = fork();
            if(pef == 0){
                //Inside process ef
                //attach to shared memory
                shared_mem = shmat(shmid,(void*) 0,0);
                if(shared_mem == (void*) -1) exit (EXIT_FAILURE);
                struct shared* shared_data = (struct shared*) shared_mem;
                shared_data->e_f = e/f;

                //detach
                if(shmdt(shared_mem) == -1) exit (EXIT_FAILURE);

                exit(EXIT_SUCCESS);
            }
        }
    }

    //Wait child process termination
    int status_ab,status_cd,status_ef;
    waitpid(pab,&status_ab,0);
    waitpid(pcd,&status_cd,0);
    waitpid(pef,&status_ef,0);

    //Check if all child exited  normally
    if(!WIFEXITED(status_ab) || !WIFEXITED(status_cd)||!WIFEXITED(status_ef)){
        exit(EXIT_FAILURE);
    }

    //Parent attaches to memory 
    shared_mem = shmat(shmid,(void*) 0,0);
    if(shared_mem == (void*) -1) exit (EXIT_FAILURE);
    struct shared* shared_data = (struct shared*) shared_mem;

    //Calculate result
    int result = (shared_data->a_b)*(shared_data->c_d)-(shared_data->e_f);
    printf("Result is %d\n", result);

    //Parent detaches from shared memory and deletes
    if(shmdt(shared_mem) == -1) exit (EXIT_FAILURE);
    if(shmctl(shmid,IPC_RMID,0) == -1) exit(EXIT_FAILURE);

    return EXIT_SUCCESS;

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T00:59:37.887

fork() 进程，然后 waitpid() 处理它们的返回值：

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main()
{
    //whatever values you like:
    int a = 1;
    int b = 2;
    int c = 3;
    int d = 4;
    int e = 15;
    int f = 6;

    int a_plus_b_pid;
    int c_plus_d_pid;
    int e_div_f_pid;

    int a_plus_b;
    int c_plus_d;
    int e_div_f;

    a_plus_b_pid = fork();
    if(a_plus_b_pid)
    {
        c_plus_d_pid = fork();
        if(c_plus_d_pid)
        {
            e_div_f_pid = fork();
            if (e_div_f_pid)
            {
                //wait for our processes to exit, with our results, and stash the computed values.
                waitpid(a_plus_b_pid, &a_plus_b, 0);
                waitpid(c_plus_d_pid, &c_plus_d, 0);
                waitpid(e_div_f_pid, &e_div_f, 0);

                //The 8 least-significant bits carry info that we're not interested in here, so shift them out:
                a_plus_b >>= 8;
                c_plus_d >>= 8;
                e_div_f >>= 8;

                printf("%d %d %d %d\n", a_plus_b, c_plus_d, e_div_f, a_plus_b * c_plus_d - e_div_f);
            }
            else
            {
                exit (e/f);
            }
        }
        else
        {
            exit (c+d);
        }
    }
    else
    {
        exit (a+b);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-19T02:04:53.800

这是使用 pthread 的版本：

```
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <pthread.h>

volatile int a_b;
volatile int c_d;
volatile int e_f;
const int a=1,b=2,c=3,d=4,e=6,f=2;

void* calc_ab(void*);
void* calc_cd(void*);
void* calc_ef(void*);

int main(){
        pthread_t ab_thread, cd_thread, ef_thread;

        pthread_create(&ab_thread,NULL,calc_ab,NULL);
        pthread_create(&cd_thread,NULL,calc_cd,NULL);
        pthread_create(&ef_thread,NULL,calc_ef,NULL);
        pthread_join(ab_thread, NULL);
        pthread_join(cd_thread, NULL);
        pthread_join(ef_thread,NULL);
        int result = a_b*c_d-e_f;
        printf("Result is %d\n", result);

    return EXIT_SUCCESS;
}

void* calc_ab(void* arg){ a_b = a+b;pthread_exit(NULL);}
void* calc_cd(void* arg){ c_d = c+d;pthread_exit(NULL);}
void* calc_ef(void* arg){ e_f = e/f;pthread_exit(NULL);} 
```

要编译，您必须链接到 pthread： `gcc pthread.c -lpthread -o teste`

**笔记**

*   请注意，声明了在主线程和子线程之间共享的变量`volatile`。这可以防止编译器进行一些内存优化，从而防止在一个线程中完成的写入操作不会被其他线程看到。
*   每个子线程写入不同的共享变量。我想保持代码简单，不必显式处理同步。
*   主线程只有在它从`pthread_join`更改它的线程返回后才读取共享变量。同样，我想保持代码简单，不必显式处理同步。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-19T05:49:19.833

首先，您根本不需要进程来进行任意计算。嵌入像[lua](http://www.lua.org/)这样的解释器可能更简单。

当然，每个进程都有自己的地址空间。键入`cat /proc/self/maps`以获取有关运行该`cat`命令的进程的信息。

如果您坚持使用进程来了解它们如何通过管道进行通信，您可能会使用诸如[popen(3) 之](http://linux.about.com/library/cmd/blcmdl3_popen.htm)类的东西，它将使用一些系统调用来启动和管道命令。

```
char cmd[80];
int a, b, sum;
/// fill a & b
snprintf (cmd, sizeof(cmd), "echo $[%d + %d]", a, b);
FILE* pcmd = popen(cmd, "r");
if (fscanf (pcmd, "%d", &sum)>0) {
    // do something with sum
};
pclose(pcmd); 
```

你应该读一本好书，比如[Advanced Unix Programming](http://basepath.com/aup/)和[Advanced Linux Programming](http://www.advancedlinuxprogramming.com/)。真正的事情是理解[系统调用](http://en.wikipedia.org/wiki/Syscall)，如[fork(2)](http://www.kernel.org/doc/man-pages/online/pages/man2/fork.2.html)、[waitpid(2)](http://www.kernel.org/doc/man-pages/online/pages/man2/waitpid.2.html)、[execve(2)](http://www.kernel.org/doc/man-pages/online/pages/man2/execve.2.html)、[pipe(2)](http://www.kernel.org/doc/man-pages/online/pages/man2/pipe.2.html)、[dup(2)](http://www.kernel.org/doc/man-pages/online/pages/man2/dup.2.html)等。了解[系统调用 (2)](http://www.kernel.org/doc/man-pages/online/pages/man2/syscalls.2.html)是由某些命令完成的或程序，使用`strace`

# linq - Linq - 使用 VB.NET 选择或遍历所有孙子

> ID：12486017
> 
> 赞同：0
> 
> 时间：2012-09-18T22:30:46.927
> 
> 标签：linq, frameworks, entity

全部，

我正在 VB.NET 中试验 Linq 和实体框架（尽管我使用的是 nHydrate）。假设我有 3 个表，如下所示：

![图表](../Images/78746a1839d343507ff6b4438515627a.png)

所以 Table1 是具有许多记录/实体的顶级祖父母。

我想选择与特定 Table1 实例相关的所有 Table3 记录/实体。我想将此作为某些搜索功能的一部分。

我想以 Table1 的一个实例为起点，即

```
Public Class MySearch

    Private _lookUnder As System.Data.Objects.DataClasses.EntityObject

    Public Sub Search() 
        ...
        CType(_lookUnder, Table1) ' ???? need to linq here ????
        ...
    End Sub
End Class 
```

这可以用 Linq 完全完成吗？欢迎使用 C# 答案。

我试过看[这个](https://stackoverflow.com/questions/11925676/select-value-from-grandchildren)，但没有太大帮助。

谢谢，

安德斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T22:44:05.907

理想情况下，您应该可以访问上下文，从而使这样的事情成为可能（C#）：

```
var relatedTable3s = context.Table3s.Where(t3 => t3.Table2.Table1.id == _lookUnder.id); 
```

我想这样的事情也可能有效：

```
var relatedTable3s =
    from t2 in _lookUnder.Table2s.AsQueryable()
    from t3 in t2.Table3s
    select t3; 
```

...否则写为：

```
var relatedTable3s = _lookUnder.Table2s.AsQueryable()
    .SelectMany(t2 => t2.Table3s); 
```

# php - 如何内爆数组索引？

> ID：12486021
> 
> 赞同：5
> 
> 时间：2012-09-18T22:30:59.750
> 
> 标签：php, arrays, implode

是否可以内爆数组的索引？一个函数返回给我一个数组，我需要的是该数组的索引，所以我只想用逗号或任何其他字符为我的数据库工作内爆

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-09-18T22:31:56.523

你的意思是这样的...

```
implode(',', array_keys($some_arr)); 
```

... 对？) 这是;的[文档](http://php.net/manual/en/function.array-keys.php) `array_keys`简而言之，当使用单个参数（数组）调用时，此函数仅返回其所有键（作为数组）。

# c#-4.0 - 如何在 DataSet C# 中过滤数据？

> ID：12486022
> 
> 赞同：-2
> 
> 时间：2012-09-18T22:31:01.827
> 
> 标签：c#-4.0

单词表有 2 个字段：WORDID 和 LEMMA。此代码显示单词表中的所有记录。但我只想显示某些记录，例如`SELECT * WORD WHERE WORDID=10`. 谁能建议我如何实现这一目标？

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication4
{
    class Program
    {
        static void Main(string[] args)
        {
            ConsoleApplication4.DataSet1TableAdapters.wordTableAdapter kata = new DataSet1TableAdapters.wordTableAdapter();

            foreach (ConsoleApplication4.DataSet1.wordRow row in kata.GetData())
            {
              System.Console.WriteLine(row.lemma);
            }

         System.Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T22:35:30.020

使用 LINQ？：

```
ConsoleApplication4.DataSet1TableAdapters.wordTableAdapter kata = new DataSet1TableAdapters.wordTableAdapter();

var query = from p in kata.GetData()
            where p.WORDID == 10
            select p;

foreach(var item in query)
{
    System.Console.WriteLine("{0}, {1}", item.WORDID, item.LEMMA);
}

System.Console.ReadKey(); 
```

**编辑：**

您可能需要执行我在下面编写的附加步骤。

```
var myTable = kata.GetData();

var query = from p in myTable.AsEnumerable()
            where p.WORDID == 10
            select p; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:36:39.820

你可以试试这个。。

```
foreach (ConsoleApplication4.DataSet1.wordRow row in kata.GetData())
{
     if(row.wordid==10)
         System.Console.WriteLine(row.lemma);
} 
```

# c# - 用于推/拉结果的 JGit/NGit 包装器

> ID：12486027
> 
> 赞同：0
> 
> 时间：2012-09-18T22:31:21.057
> 
> 标签：c#, git, formatting, jgit

有人可以指出（或分享）JGit/NGit Push/Pull 输出结果的简单包装器吗？如何模仿 CGit 的输出？GUI 中应包含哪些信息？

到目前为止，这是我想出的（我使用的是 Mono/NGit）：

```
using System;
using NGit;
using NGit.Api;
using NGit.Storage.File;
using NGit.Transport;
using Sharpen;

namespace RepoSync.Service
{
    class NGitPushResultAdapter : ICommandResponse
    {
        public NGitPushResultAdapter (Iterable<PushResult> pushResults)
        {
            foreach (var pushResult in pushResults) {
                var remoteUpdates = pushResult.GetRemoteUpdates ();
                foreach (var remoteUpdate in remoteUpdates) {
                                    // TODO: Which infos to include?
                    Msg += remoteUpdate.GetStatus ();
                }
            }
        }

        public string Msg { get; set; }
        public bool Success { get; set; }
        public GitCommandException Exception { get; set; }
    }
} 
```

# java - 找出用于在 Java 中实例化模板的类型

> ID：12486030
> 
> 赞同：1
> 
> 时间：2012-09-18T22:32:03.010
> 
> 标签：java

用于实例的“输入”类型是否可能`MyClass<Input>`实际上是`Integer`我现在正在运行的这个实例？例如，我有：

```
class MyProcessor<Input, Output> {

  public void initialize() {
    if (Long.class.isAssignableFrom(Input.class))
    ....
  }
} 
```

IntelliJ 告诉我不能在“Input.class”上“从类型变量中选择”。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T22:34:22.050

您找不到泛型类型，因为有关它的信息[在运行时丢失](http://docs.oracle.com/javase/tutorial/java/generics/erasure.html)。

它只是用于在模板类上进行强制转换的提示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T22:36:45.647

如果您愿意通过构造函数传递类型，那么您可以在字段中保留该类型，例如

```
public class MyClass<T> {
    private final Class<T> clazz;

    ...

    public MyClass(Class<T> clazz, ...) {
        this.clazz = clazz;
        ...
    }

    ...

    public void initialize() {
        if (Long.class.isAssignableFrom(clazz)) 
        ....
    }

} 
```

[除此之外，由于类型擦除](http://docs.oracle.com/javase/tutorial/java/generics/erasure.html)，信息被丢弃

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T22:15:26.393

我似乎已经找到了针对与先前答案相矛盾的特定案例的解决方案。这是代码（有效）：

```
interface Processor<I,O>
{
  public O process();
}

abstract class SimpleProcessImpl<I,O> implements Processor<I,O>
{
  List<Processor> _upstream = new ArrayList<Processor>();

  @SuppressWarnings("unchecked")
  public I getInput()
  {
    Object value = _upstream.get(0).process();

    ParameterizedType t = (ParameterizedType) getClass().getGenericSuperclass();
    Class dstClass = (Class) t.getActualTypeArguments()[0];
    Class srcClass = value.getClass();

    System.out.println(srcClass.getName() + " -> " + dstClass.getName());

    if (dstClass == String.class && srcClass == String.class) {
      return (I) value;
    }

    if (dstClass == String.class) {
      return (I) value.toString();
    }

    if (srcClass == String.class && dstClass == Integer.class) {
      String valueStr = (String) value;
      Integer valueInt = Integer.parseInt(valueStr);
      return (I) valueInt;
    }

    if (srcClass == String.class && dstClass == Long.class) {
      String valueStr = (String) value;
      Long valueInt = Long.parseLong(valueStr);
      return (I) valueInt;
    }

    return (I) value;
  }
} 
```

# php - 使用 mysqli 绑定未知数量的参数

> ID：12486032
> 
> 赞同：2
> 
> 时间：2012-09-18T22:32:20.717
> 
> 标签：php, reference, mysqli

我正在尝试在表格中进行搜索，如下所示：[http ://www.phpjabbers.com/free-scripts/mysql-search-table/search.php](http://www.phpjabbers.com/free-scripts/mysql-search-table/search.php)

我发现我可以根据搜索表单 $_GET 连接一个字符串，这样我就可以在获取参数后查询它：

```
$query = "SELECT * FROM table WHERE status = 1"
if($_GET['param1']{
  $query = $query." AND param1 = ?";
}
$stmt = $mysqli->prepare($query); 
```

如果我不必添加，那将是完美的：

```
$stmt->bind_param('i',$_GET['art']); 
```

我按照这篇文章的说明进行操作：[https](https://stackoverflow.com/a/11152781/679333) ://stackoverflow.com/a/11152781/679333 ，但通配符部分不起作用。当我将变量推入数组时，我引用了这些变量，而不是那个 for 循环：

```
array_push($user_terms, &$_GET['var']); 
```

它有效，但现在我收到“已弃用：调用时传递引用已被弃用”警告。

我不想忽略警告，因为我读过 Call-time pass-by-reference 现在已被 PHP 杀死。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T22:51:37.047

有点草率，但完成了工作。

```
function refValues($arr){
    if (strnatcmp(phpversion(),'5.3') >= 0) //Reference is required for PHP 5.3+
    {
        $refs = array();
        foreach($arr as $key => $value)
            $refs[$key] = &$arr[$key];
        return $refs;
    }
    return $arr;
}

$params = array();

$query = "SELECT * FROM table WHERE status = 1";

// Iterate over your paramters from $_GET
foreach ($_GET as $k => $v) 
{ 
  if(!empty($v)
  {
    $query .= " AND $k = ?";
    $params[$k] = helper::sanitize($v);
  }
}
// After you get through all your params...

$stmt = $mysqli->prepare($query);

// Bind em.
call_user_func_array(array($stmt, 'bind_param'), refValues($params)); 
```

应该这样做，尽管我以前从未绑定过 mysqli。让我知道它是如何工作的。

# binding - UIPageViewController 的脊椎位置错误？

> ID：12486033
> 
> 赞同：-1
> 
> 时间：2012-09-18T22:32:25.430
> 
> 标签：binding, location, uipageviewcontroller, landscape

如果您在 Xcode 4.3.3 (4E3002) 中构建默认的 Page-Based Application 模板并在 iPad 上运行它，您会注意到即使书脊位于屏幕中心，翻页时的阈值约为 3 /4 在横向模式下向右，有 2 页可见。

我认为正在发生的事情是它仍然认为视图是 768 宽而不是 512。

有没有人找到解决这个问题的方法，告诉它页面视图的边缘在横向停止在 512 处？

还是我只需要升级 Xcode 并使用最新的模板？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:35:20.940

信不信由你，我的 iPad 上的触摸传感器中有一个坏列！当我的手指越过 3/4 的死区时，iOS 以为我放开了页面。所以这只是硬件问题。

# sql - sybase ISNULL - 条件是否太长？

> ID：12486035
> 
> 赞同：1
> 
> 时间：2012-09-18T22:32:38.600
> 
> 标签：sql, sybase

我正在尝试解开一个非常古老的变量。这是在一个字段中输入的全名，可在两个单独的表中找到。在大多数较新的地方，名称位于三个逻辑列中，第一、中间、最后。在这些中，它们都在一起，我试图将其剥离为第一个首字母，姓氏。我在这里找到以下内容并对其进行了修改：

[http://dbaspot.com/sqlserver-programming/365656-find-last-word-string.html](http://dbaspot.com/sqlserver-programming/365656-find-last-word-string.html)

```
 DECLARE @full_name VARCHAR(20)
 DECLARE @fullname VARCHAR(20)
 SELECT @full_name = REVERSE('John A Test')
 SELECT @fullname = REVERSE('Joe Q Public')

 SELECT @final = ISNULL(
                 (right(@full_name,1) + '.  ' + (REVERSE(SUBSTRING(@full_name, 1, 
                                                   CHARINDEX(' ',@full_name) - 1)))), 

                  (right(@fullname,1) + '.  ' + (REVERSE(SUBSTRING(@fullname, 1, 
                                                   CHARINDEX(' ',@fullname) - 1 ))))
                        ) 
```

当我将 full_name 留在那里时，它可以正常工作...返回`J. Test`。当我将其设为空时，默认值应该是
`J. Public`，但最终却是`.`. 当我分别测试每条线时，它们会起作用。我也尝试了 COALESCE，结果相同。ISNULL 或 ???? 的括号是否太多？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T07:08:17.370

你有问题`right(@full_name,1) + '. '`，例如：

`select null+'.'`

给你`.`。

尝试使用`case`如下更改您的代码：

```
 DECLARE @full_name VARCHAR(20)
 DECLARE @fullname VARCHAR(20)
 DECLARE @final VARCHAR(20)
 SELECT @full_name = null--REVERSE('John A Test')
 SELECT @fullname = REVERSE('Joe Q Public')

 SELECT @final = case
                    when @full_name is not null
                       then (right(@full_name,1) + '.  ' + (REVERSE(SUBSTRING(@full_name, 1, 
                                                   CHARINDEX(' ',@full_name) - 1))))
                    else (right(@fullname,1) + '.  ' + (REVERSE(SUBSTRING(@fullname, 1, 
                                                   CHARINDEX(' ',@fullname) - 1 ))))
                 end 
select @final 
```

# c# - 变量的有效范围

> ID：12486037
> 
> 赞同：3
> 
> 时间：2012-09-18T22:32:58.167
> 
> 标签：c#, scopes

> **可能重复：**
> [为什么不能在嵌套的局部范围内声明重复的变量名？](https://stackoverflow.com/questions/6156449/why-cant-a-duplicate-variable-name-be-declared-in-a-nested-local-scope)

大家好，今天我发现了一个问题，我不确定：

我认为下面的例子应该是正确的，因为大括号创建了一个新的局部区域，所以我不能访问大括号之后的第一个 x，我应该能够在右大括号之后创建一个同名的新变量。

```
 {
     int x = 0;
 }
 int x; 
```

但是如果我尝试这个例子，我会得到错误：“不能在这个范围内声明一个局部变量名“x”，因为它会给“temp”赋予不同的含义，它已经在父范围或当前范围中用于表示别的东西。”

这在 C# 中真的不允许吗？这也可能是 ReSharper 7.0 或 Visual Studio 2012 的故障。

请不要提出不好的编码风格，这只是我对c#的基本理解。

谢谢你，美好的一天；）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T22:35:41.013

问题是首要地位并不重要。您不会期望这会起作用：

```
int x;
{
  int x = 0;
} 
```

为什么不？因为第一个变量的范围延伸到大括号中。即使第二个变量的范围没有超出这些括号，声明第二个变量也会导致问题。

如果您颠倒顺序，同样的原则也适用。第一个变量不会阻止您声明第二个变量，但第二个变量会阻止您声明第一个变量。

如果您在其自己的范围内创建第二个变量，它将按照您期望的方式运行。

```
{
  int x = 0;
}
{
  int x;
} 
```

# java - 如何更改包含已更改实例变量的实例变量

> ID：12486038
> 
> 赞同：2
> 
> 时间：2012-09-18T22:32:58.377
> 
> 标签：java, oop

为什么 setWav 不改变`wav`in `wav + " " + "Grapes"`？如果我想要输出，我是否必须为 add 创建一个 set 方法`Oranges? Grapes`？

**编辑**：感谢大家的帮助，非常感谢。

```
package javaapplication1;

public class JavaApplication1 {

    public static void main(String[] args) 
    {
        NewClass object1 = new NewClass();
        System.out.println(object1.getAdd());
        object1.setWav("Oranges?");
        System.out.println(object1.getAdd());    

    }
} 
```

* * *

输出：

> 汉堡葡萄
> 
> 汉堡葡萄

* * *

```
package javaapplication1;

public class NewClass 
{
    private String wav;
    private String add;

    public NewClass()
    {
        wav = "Burgers";
        add = wav + " " + "Grapes";       

    }

    public void setWav(String wav)
    {
        this.wav = wav;        
    }
    public String getWav()
    {
        return wav;
    }

    public String getAdd()
    {
        return add;
    }    

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T22:36:13.417

`add`调用时不会刷新`setWav`。将此行从 ctor 复制到 setter：

```
add = wav + " " + "Grapes"; 
```

它会起作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-18T22:36:15.350

您的`getAdd`方法返回`add`. `add`您在构造函数中设置了值，`NewClass`但在其他任何地方都没有设置，因此即使您更改它也保持不变`wav`（这两个变量没有任何关系，更改一个不会影响另一个）。你可以试试这个：

```
public void setWav(String wav) {
    this.wav = wav;  
    add = wav + " " + "Grapes";  // i.e. add = wav + " Grapes";
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-18T22:38:55.843

在您的示例中，构造函数负责更新“添加”。但问题是它只被调用一次，也就是类被实例化的时候。

它发生在这一行：NewClass object1 = new NewClass();

您可以将 setWav 更改为：

```
public void setWav(String wav)
{
    this.wav = wav;
    this.add = wav + " " + "Grapes";
} 
```

这样，每次调用 setWav 时它都会更新 add 。

# html - 在画布应用程序中点赞按钮和打开图形标签

> ID：12486039
> 
> 赞同：1
> 
> 时间：2012-09-18T22:33:00.667
> 
> 标签：html, facebook-like, facebook-opengraph

所以...

我制作了一个画布应用程序，现在我想为它创建一个赞按钮。

我的第一个想法是，只需创建一个将 data-href HTML 参数设置为[https://apps.facebook.com/my_awesome_app](https://apps.facebook.com/my_awesome_app)的like 按钮，然后将该按钮放在索引页面上的某个位置。凉爽的...

好吧，它正在工作，但现在完全符合我的预期。Activity 是这样描述的... {name} 喜欢 {app_name} 上的 {object which is in this case my app}。我不想要那样，它看起来很傻。我只是想要 {name} 喜欢 {app_name}

所以我用谷歌搜索并堆了几个小时，得出了一个模糊的结论——OG标签。

我已经摆弄了一段时间了，我完全没有运气。帮帮我。

干杯!

# c# - 基于文本框和复选框值创建数据表 C#

> ID：12486040
> 
> 赞同：0
> 
> 时间：2012-09-18T22:33:16.677
> 
> 标签：c#, datatable

我需要创建一个`DataTable`in `C#`。现在我的`ascx`页面有两个`TextBoxes`. 一个是学生证`txtStudentID`，一个是学生姓名`txtStudentName`。它还有一个`CheckBox`包含通过或失败的列表 (ckbxPF)。我需要`DataTable`根据用户输入使用这些值创建一个，然后返回表。

另外，如果有人知道如何以不同的方式访问这些值`class`，那就太好了！

任何帮助将不胜感激！谢谢！-汤姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T22:47:19.277

我必须承认我不明白这个问题，但是好的，这是创建 DataTable 的一种方法：

```
DataTable table = new DataTable();
table.Columns.Add("StudentID", typeof(int));
table.Columns.Add("StudenName", typeof(string));
table.Columns.Add("Passed", typeof(bool));

int studentID = int.Parse(txtStudentID.Text);
String studentName = txtStudentName.Text;
bool passed = ckbxPF.SelectedIndex == 0; // assuming that "passed" is the first item

table.Rows.Add(studentID, studentName, passed); 
```

例如，您可以通过`DataTable`从类中的方法返回它来传递它，或者 - 如果您有对该类的引用 - 通过属性，例如：

```
// somewhere in Class2
DataTable table = class1.Table;

//in Class1, initialize this table from where you want
public DataTable Table { get; set;} 
```

# android - Android-如何以编程方式在从 XML 预加载的布局中的视图之间插入视图？

> ID：12486043
> 
> 赞同：10
> 
> 时间：2012-09-18T22:33:38.213
> 
> 标签：android, android-layout, android-linearlayout, android-view

我正在开发一个带有片段的 android 应用程序。虽然我的大部分布局都是在 XML 中预先确定的，但我想以编程方式在启动时已加载到 LinearLayout 中的视图之间插入一个新视图。

![在此处输入图像描述](../Images/c0fc4b282ebf7148a85fdad95e6f7268.png)

我该怎么做？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T05:57:47.780

当你动态地将视图添加到 LinearLayout 时，可以指定索引。

将第一个视图的高度设置为

```
android:layout_height="0dp"
android:layout_weight="1" 
```

设置`height = wrap_content`为第二个视图`XML`

然后当你动态添加新视图时，设置它`height = wrap_content`并将其添加到父视图`LinearLayout`中

```
 parentLinearLayout.addView(childView, index);     
                 //index = position where you want to insert the new view. 
```

它可能会帮助你。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-18T23:46:42.413

红色视图一开始应该有默认设置`View.setVisibility(View.GONE)`。当它出现时，您可以切换到`View.setVisibility(View.VISIBLE)`. 我现在无法验证解决方案，但它应该可以解决问题。因此，在这种情况下，您不是插入新视图，而是使现有视图可见。

# jquery - 如何从 Rails 的数据库中获取第一条记录，然后使用 Ajax 加载其他记录？

> ID：12486044
> 
> 赞同：0
> 
> 时间：2012-09-18T22:33:49.657
> 
> 标签：jquery, ruby-on-rails, ruby, ajax

我有一个包含许多图像的滑块。我想加载第一个图像，然后在页面加载完成后，用 Ajax 一个一个地加载其他图像。

如果滑块至少有两个图像，我想运行它。如果加载了第三个图像，它将附加到其他图像，依此类推，除非所有图像都已加载。

我使用 Rails 3.2 和 jQuery。是否有意义？我怎样才能做到这一点？

```
pages_controller.rb
def show
  @slider_items = @page.slider_items.where(:visible => true)
end

show.html.haml
%table.slider
  %tr
    - @slider_items.each do |item|
      %td.si
        .slider_item= image_tag(item.slider_image) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T01:43:53.517

好的，我将假设您的滑块是某种需要表结构的 javascript 小玩意儿。因此，您必须弄清楚的第一件事是如何将行插入现有表中。

假设您在初始页面加载后生成以下 HTML，其中只有一个图像：

```
<table id='slider'>
  <tr>
    <td class='si'>
      <img.... >
    </td>
  </tr>
</table> 
```

您需要能够通过 javascript 在该表中插入新行。我必须假设您此时正在使用 jquery。这是一些jQuery：

```
$('#slider:last-child').append("<tr><td>Hi!</td></tr>"); 
```

如果您使该 jquery 执行，则您的 DOM 将包含：

```
<table id='slider'>
  <tr>
    <td class='si'>
      <img.... >
    </td>
  </tr>
  <tr><td>Hi!</td></tr>
</table> 
```

再次执行相同的 javascript，然后：

```
<table id='slider'>
  <tr>
    <td class='si'>
      <img.... >
    </td>
  </tr>
  <tr><td>Hi!</td></tr>
  <tr><td>Hi!</td></tr>
</table> 
```

这是 jquery 代码的关键部分，但它在哪里，你如何使它正确？

好吧，调用该 jquery 代码需要在每次获取下一个图像的 AJAX 调用之后发生。因此，您必须解决的下一个问题是如何通过 AJAX 一次一个地遍历所有图像？

这将涉及要在浏览器中维护的 JavaScript 变量，该变量是所有图像的索引。至少，您必须在页面加载时捕获最大数量的图像。你可以这样做：

显示.html.erb：

```
<script type='text/javascript'>
  $(document).ready(function() {
    var maximage = <%= @maximage %>;
    var curimage = 0;
  });   
</script> 
```

为了让它工作，你必须设置@maximage。

应用程序/控制器/pages_controller.rb：

```
class PagesController < ApplicationController
  before_filter :prep_images , :only => [:show]
  def prep_images
    @maximage = @page.slider_items.length
  end
end 
```

因此，当 dom 就绪事件触发时，由于 erb 扩展，您的 HTML 将包含一个脚本部分，其中包含：

```
var maximage = 12;
var curimage = 0; 
```

假设有 12 张图像。

在这一点上，我不得不提到命名空间冲突，maximage 很可能是您使用的其他 javascript 库中使用的变量。如果您发现是这种情况，则必须解决此问题，但我假设没有冲突。

好的，我已经构建这篇文章有一段时间了。如果您认为我在正确的道路上，请告诉我，我将填写剩余的详细信息。

# sml - ML 中的递归函数

> ID：12486048
> 
> 赞同：0
> 
> 时间：2012-09-18T22:34:35.687
> 
> 标签：sml

这是一个只检查前两个列表元素的柯里化函数。

```
fun inn list f = f(hd(list), hd(tl(list))); 
```

我想知道的是我可以通过其他列表元素的任何方式。我不知道我如何使它递归。有谁能够帮助我？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T10:46:42.443

第一句话：*永远不要*使用`hd`and `tl`。请改用模式匹配。

我现在不知道你想让你的函数做什么，但这里有一个迭代列表并将 f 应用于每个元素的函数：

```
fun iter f l =
  case l of
    [] => ()
  | x::xs => (f x; iter f xs) 
```

可以更简洁地写成

```
fun iter f [] = ()
  | iter f (x::xs) = (f x; iter f xs) 
```

值得一提的是，这个功能在标准基础库中可用，名称为`List.app`.

# css - 更改默认响应式导航栏断点

> ID：12486051
> 
> 赞同：8
> 
> 时间：2012-09-18T22:34:46.403
> 
> 标签：css, twitter-bootstrap

有没有办法改变 Bootstrap 菜单响应和崩溃的断点？979px 对我来说太大了，我希望只在较小的尺寸上进行转换。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-09-18T22:44:47.513

是的，您可以通过在文件中重新定义`@navbarCollapseWidth`变量来做到这一点。`less/variables.less`然后重新编译css。

编译说明可以在官方文档的[Compiling Bootstrap with Less](http://getbootstrap.com/getting-started/#grunt)部分中找到。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-10-15T20:48:49.207

@nick-kugaevsky '用更少的编译引导程序' - 链接已损坏。

顺便说一句，对于 bootstrap 3 RC 1，您需要修改以下属性`less/variables.less`

```
// Point at which the navbar stops collapsing
@grid-float-breakpoint:     @screen-phone;      // here i allready changed it 
```

顺便说一句：这仅禁止响应式导航在宽度 > @screen-phone 时折叠。以下是有关使用 less 编译引导程序的更多信息：http: [//bootstrap.lesscss.ru/less.html](http://bootstrap.lesscss.ru/less.html)

您必须下载 bootstrap，将您的应用程序或节点 js util 指向包含 less 文件的 bootstrap 目录，修改 less/variables 并重新编译 bootstrap.less 文件。

啊，刚刚发现它写在引导文档中：http: [//getbootstrap.com/components/#navbar](http://getbootstrap.com/components/#navbar)

# vba - 将左弹出的评论移到另一列可以使其右弹出，修改评论的内容也可以

> ID：12486052
> 
> 赞同：3
> 
> 时间：2012-09-18T22:34:46.323
> 
> 标签：vba, excel, comments, location

Excel 评论弹出窗口通常向右，但有时它们向左。将左弹出的评论移动到另一列可以使其右弹出，修改评论的内容也可以。Excel 用列和注释信息来控制弹出方向是做什么的？我可以更直接地控制弹出方向吗？MS没有记录我能找到的这个。我不是要求用 Visual Basic 方法来控制评论弹出位置，因为我已经知道如何做到这一点。非常感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T23:21:02.630

注释框按形状存储在单元格内的注释中。

此代码将控制与存储在其中的活动单元格相关的弹出方向。（假设单元格 D8 中有评论）

```
Sub MoveCommentLocation()
    Dim x As Integer
    Dim y As Integer
    Dim bVisible As Boolean

    With Range("D8")
        ' read position of the cell
        x = .Left
        y = .Top
        ' if comment is initially hidden, we need to unhide it to move it
        bVisible = .Comment.Visible
        If Not bVisible Then .Comment.Visible = True

        With .Comment.Shape
            ' move comment relative to the cell
            .Left = x - 30
            .Top = y + 50
        End With

        If Not bVisible Then .Comment.Visible = False
    End With

End Sub 
```

*注意：* 如果评论被隐藏，您需要在移动之前取消隐藏评论。（上面包含的代码）

此外，Excel 会选择最接近单元格右上角的注释框角来选择在何处绘制箭头。如果您的评论框因上下文和字体而在大小/形状上有所不同，我建议将它们放在单元格的右下角，以便该位置始终指向左上角。

# collections - Backbone.js - 集合之间的“同步”模型

> ID：12486053
> 
> 赞同：2
> 
> 时间：2012-09-18T22:34:51.857
> 
> 标签：collections, backbone.js, model, synchronization

我习惯了 Spine.js，但我想试试 Backbone.js。

在 Spine 中，没有集合。只有模型。在 Spine 中，当我在不同的地方使用模型时，Spine 在我更新它们时始终保持模型彼此同步。在 Backbone 中，我发现情况并非如此。我希望你能告诉我我做错了什么！

我正在尝试创建 2 个 Articles 集合，其中包含 3 个 Article 模型：

```
var Article = Backbone.Model.extend({});

var Articles = Backbone.Collection.extend({
  model: Article,
  localStorage: new Backbone.LocalStorage("Articles")
});

var articles1 = new Articles();
var articles2 = new Articles();

articles1.create({ id: 1, name: "Article 1" });
articles1.create({ id: 2, name: "Article 2" });
articles1.create({ id: 3, name: "Article 3" }); 
```

在 Chrome 中，我使用控制台并进行了一些实验：

```
articles1.size()
=> 3
articles2.size()
=> 0
articles2.fetch()
=> undefined
articles2.size()
=> 3 
```

到现在为止还挺好。两个合集中的第一篇文章是“第 1 条”：

```
a1 = articles1.first()
=> child
a2 = articles2.first()
=> child
a1.get("name")
=> "Article 1"
a2.get("name")
=> "Article 1" 
```

但是当我尝试更新第一个集合中的模型时，它不会与第二个集合同步：

```
a1.set({ name: "Article 1 - Updated" })
=> child
a1.save()
=> undefined
a1.get("name")
=> "Article 1 - Updated"
a2.get("name")
=> "Article 1" 
```

我希望第二个集合中的模型能够自动更新。

但我可以看到两种文章模型都有不同的 cid：

```
a1.cid
=> "c0"
a2.cid
=> "c3" 
```

所以我的问题是……你在 Backbone 做什么？你如何让模型在集合之间保持同步？

我实际上阅读了这篇博客文章：[http](http://destroytoday.com/blog/reasons-for-spinejs/) ://destroytoday.com/blog/reasons-for-spinejs/ 。他写：

> 动态记录
> 
> 这只是一个疯狂的黑魔法，但它解决了我在使用 Backbone.js 时遇到的一个问题。假设您在应用程序的一个视图中获取了一条记录。然后，您在不同的视图中获取并更新同一条记录。在 Spine.js 中，两条记录都会更新。您不必担心使它们保持同步。当我读到这件事的那一刻，一滴眼泪从我的脸颊滚落。

我真的试图搜索这个但没有运气。

我希望你能指出我如何以 Backbone 方式执行此操作的正确方向！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T22:50:05.750

您有 2 个基本选项：

1.  确保两个集合都包含对完全相同的模型实例的引用。不仅是具有相同 ID 的 2 个对象，而且实际上是该记录的相同内存中单个模型实例。

2.  使用事件绑定来尝试保持集合或集合内的模型同步（collection1 上的 add/remove/change/reset 反过来会导致 collection2 上的 add/remove/change/reset）。

如果您想要脊椎行为，请让#1 工作。也许使用[这里描述](http://backstage.soundcloud.com/2012/06/building-the-next-soundcloud/)的实例缓存。

# javascript - 如何将javascript绑定到所有相关元素？

> ID：12486054
> 
> 赞同：2
> 
> 时间：2012-09-18T22:34:55.367
> 
> 标签：javascript, jquery, ajax

我正在尝试制作一个占位符来在 IE 上工作。问题是我的页面通过 Ajax 加载了一些元素，但 Javascript 只加载了一次。因此，加载 Ajax 的输入字段没有占位符（因为在执行 Javascript 时未加载这些元素）。

我试图使脚本与占位符绑定到所有输入文本元素，而不仅仅是当前加载，但我不确定我做错了什么。

```
if(!$.support.placeholder) {

    $('[placeholder]').on('focus', function() {
        var input = $(this);
        if (input.val() == input.attr('placeholder')) {
            input.val('');
            input.removeClass('placeholder');
        }
    }).on('blur', function() {
        var input = $(this);
        if (input.val() == '' || input.val() == input.attr('placeholder')) {
            input.addClass('placeholder');
            input.val(input.attr('placeholder'));
        }
    }).blur();

} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T22:37:17.927

试试这个

```
if(!$.support.placeholder) {

    $('#closestStaticParent').on('focus', '[placeholder]' function() {
      var input = $(this);
      if (input.val() == input.attr('placeholder')) {
        input.val('');
        input.removeClass('placeholder');
      }
    }).on('blur', '[placeholder]' function() {
      var input = $(this);
      if (input.val() == '' || input.val() == input.attr('placeholder')) {
        input.addClass('placeholder');
        input.val(input.attr('placeholder'));
      }
    }).blur();

} 
```

# php - PHP while循环中的JQuery“回复”超链接

> ID：12486055
> 
> 赞同：0
> 
> 时间：2012-09-18T22:35:01.860
> 
> 标签：php, jquery, loops, textarea, reply

我有一个简单的 PHP while 循环，它执行来自 SQL 数据库的表格评论/帖子列表。每个帖子都有一个回复超链接，该链接将在帖子下方打开一个文本区域（表单），允许用户回复该特定帖子。它适用于一篇文章，但是当有多个文章时，jQuery 会为每个文章打开所有文本区域。我认为这是我使用 jQuery 调用相同类的问题。但我不知道如何处理它。我想要实现的是允许用户单击特定帖子中的回复超链接，并且只有该文本区域会出现在下方，而不是同时出现所有这些文本区域。

这是生成具有回复功能的帖子列表的 PHP 代码。

```
<?php>

echo "<table width=\"100%\" border=\"0\" cellspacing=\"10\">";

while ($row2 = mysql_fetch_assoc($res)) 
{

echo "
   <tr>
   <td>
      <span class=\"anonname\">Anon" . $row2['uid'] . " </span> 
      <span class=\"smalltext\"> says:</span>
   </td>
   </tr>
   <tr>
   <td>
      <span class=\"messagetext\">" . $row2['msg'] . "</span></td>
   </tr>
   <tr>
   <td>
       <div class=\"replystyle\"><span class=\"replytext\"><a href=\"#\"  
       class=\"replybtn\">Reply</a> &#8901; <a href=\"#\">Like</a> </span> <span              
       class=\"replytext\" style=\"float:right;\"><span class=\"timetext\">" .         
       $row2['timestamp'] . "</span><a href=\"report.html\">Report</a></span></div>
   </td>
   </tr>
   <tr>
   <td>
       <div id=\"replymsgbox\">
       <form id=\"messaging\" action=\"\" method=\"post\" accept-charset=\"UTF-8\"> 
       <div class=\"tarea\">
       <textarea name=\"message\" rows=\"2\" class=\"txtbx\"></textarea>
       </div>
   <span style=\"float:right;\"><input name=\"submit\" class=\"signupbtn\"          
       type=\"submit\" value=\"share\" /></span><br/><br/>
       </form>
   </div>
  </td>
  </tr>";
}
       echo "</table>";
}
?> 
```

这是 jQuery

```
<script language="javascript" type="text/javascript"> 
  $(document).ready(function(){
            $('.replymsgbox').hide();
    $('.replybtn').click(function(){
    $('.replymsgbox').slideToggle('fast');
       });
       });
</script> 
```

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T22:39:40.827

使用`$('.replymsgbox')`选择器，您将获得**所有**具有此类的元素。

要仅获取与按钮相关的按钮，请使用：

```
$('.replybtn').click(function(){
    $('.replymsgbox', $(this).parent().parent().next()).slideToggle('fast');
}); 
```

这样你下一步就是在缩小对一个`.replymsgbox`元素的研究`<tr>`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T22:48:20.057

（这不是一个答案，只是一个观察；评论不允许这种格式）

这就是我在对您的问题的评论中所写的内容：

```
<table width="100%" border="0" cellspacing="10">
<?php
while ($row2 = mysql_fetch_assoc($res)) {
?>    
   <tr>
   <td>
      <span class="anonname">Anon<?php echo $row2['uid'];?></span> 
      <span class="smalltext"> says:</span>
   </td>
   </tr>
   <tr>
   <td>
      <span class="messagetext"><?php echo $row2['msg']; ?></span></td>
   </tr>
   <tr>
   <td>
       <div class="replystyle"><span class="replytext"><a href="#"  
       class="replybtn">Reply</a> &#8901; <a href="#">Like</a> </span> 
       <span class="replytext" style="float:right;"><span 
       class="timetext"><?php echo $row2['timestamp']; ?></span><a 
       href="report.html">Report</a></span></div>
   </td>
   </tr>
   <tr>
   <td>
       <div id="replymsgbox">
       <form id="messaging" action="" method="post" accept-charset="UTF-8"> 
       <div class="tarea">
         <textarea name="message"rows="2" class="txtbx"></textarea>
       </div>
       <span style="float:right;"><input name="submit" class="signupbtn"          
       type="submit" value="share" /></span><br/><br/>
       </form>
   </div>
  </td>
  </tr>
<?php } ?>
</table> 
```

看看如何清理得更好？现在，如果您想对 HTML 进行更改，您不必经历所有复杂的转义机制。

# php - 我可以从 MySQL 读取 SQL Server 中的表吗？

> ID：12486057
> 
> 赞同：1
> 
> 时间：2012-09-18T22:35:13.827
> 
> 标签：php, mysql, sql-server

我正在使用 MySQL 在 PHP 中创建一个页面，但我需要一些来自 SQL Server 2008 的数据。可以通过查询从 MySQL 服务器读取 SQL Server 2008 中的数据吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T22:37:21.637

不，不是从 MySQL 服务器，但可以通过单独的 ODBC 连接访问 MSSQL DB。

# magento - Magento 自定义选项卡和管理控制器 acl

> ID：12486063
> 
> 赞同：0
> 
> 时间：2012-09-18T22:35:40.767
> 
> 标签：magento, controller, admin, acl

我对管理后端的自定义控制器 ACL 有疑问。我已经阅读，重新阅读，检查......但仍然找不到我的问题。该死。

首先，代码……模块本身正在工作……我有块、助手、前端控制器……系统->配置选项卡/组数据……一切正常。我的问题只是与 admincontroller acl 相关......所以我现在只为该区域添加相关代码。

我的后端选项卡正在显示，但网址（admin/mynewmodule/index、admin/mynewmodule/list）转到 404 页面。

config.xml，管理路由器：

```
 <admin>
    <routers>
        <adminhtml>
            <args>
                <modules>
                    <mynewmodule before="Mage_Adminhtml">
                        Mworkz_MyNewModule_Adminhtml
                    </mynewmodule >
                </modules>
            </args>
        </adminhtml>
    </routers>
</admin> 
```

Adminhtml.xml、后端选项卡和 acl

```
 <?xml version="1.0"?>
 <config>
 <menu>
    <mynewmodule module="mynewmodule " translate="title">
        <title>MyNewModule</title>
        <sort_order>71</sort_order>               
            <children>
                    <items module="mynewmodule " translate="title">
                        <title>Index Action</title>
                        <sort_order>1</sort_order>
                        <action>adminhtml/mynewmodule/</action>
                    </items>
                    <list module="mynewmodule " translate="title">
                        <title>List Action</title>
                        <sort_order>2</sort_order>
                        <action>adminhtml/mynewmodule/list/</action>
                    </list>
             </children>
    </mynewmodule >
</menu>

    <acl>
        <resources>
            <admin>
                <children>
                    <system>
                        <children>
                            <config>
                                <children>
                                    <mynewmodule translate="title">
                                            <title>MyNewModule</title>
                                    </mynewmodule>
                                </children>
                            </config>
                        </children>
                    </system>
                    <mynewmodule translate="title" module="mynewmodule">
                    <title>MyNewModule</title>
                        <sort_order>-100</sort_order>
                        <children>
                            <items translate="title">
                                <title>Index Action</title>
                                <sort_order>1</sort_order>
                            </items>
                            <list translate="title">
                                <title>List Action</title>
                                <sort_order>2</sort_order>
                            </list>
                        </children>
                    </mynewmodule>
                </children>
            </admin>
        </resources>
    </acl>
    <layout>
        <updates>
            <mynewmodule>
                <file>mworkz/mynewmodule.xml</file>
            </mynewmodule>
        </updates>
    </layout>

 </config> 
```

管理员控制器

```
 class Mworkz_MyNewModule_Adminhtml_MyNewModuleController extends Mage_Adminhtml_Controller_action
 {

protected function _initAction() {

    $this->loadLayout()
        ->_setActiveMenu('extbuilderpro/items')
        ->_addBreadcrumb(Mage::helper('adminhtml')->__('Items Manager'), Mage::helper('adminhtml')->__('Item Manager'));

    return $this;
}   

public function indexAction() {

    $this->_initAction()
        ->renderLayout();
}

 public function listAction() {

    $this->_initAction()
        ->renderLayout();
}

 } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:52:46.140

如果您编写自己的扩展名，路径必须是`module_name/admin_html/list`. 下载免费的 magento 扩展，例如： http: [//www.magentocommerce.com/magento-connect/news-by-commercelab-3436.html](http://www.magentocommerce.com/magento-connect/news-by-commercelab-3436.html)并查看 etc/config.xml。

所以正确的代码：

```
<menu>
    <modulename module="modulename" translate="title">
        <title>Module Name</title>
        <sort_order>1</sort_order>
        <children>
            <add translate="title" module="modulename">
                <title>Add New Item</title>
                <sort_order>0</sort_order>
                <action>modulename/adminhtml_news/new</action>
            </add>
            <items translate="title" module="modulename">
                <title>Items Manager</title>
                <sort_order>10</sort_order>
                <action>modulename/adminhtml_news/index</action>
            </items>
            <settings translate="title" module="modulename">
                <title>Settings</title>
                <sort_order>40</sort_order>
                <action>adminhtml/system_config/edit/section/modulename</action>
            </settings>
        </children>
    </clnews>
</menu> 
```

# php - 按位不工作

> ID：12486065
> 
> 赞同：0
> 
> 时间：2012-09-18T22:36:04.750
> 
> 标签：php, bit-manipulation

我对我的一个脚本使用有点明智

```
<?php
$num1 = 33554432;
$num2 = 975827238;
if($num2 & $num1){
echo "Yes";
}else{
echo "No";
}
?> 
```

问题是当它应该为否时它会回显是，任何回应将不胜感激

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-18T22:37:25.880

`33554432 & 975827238`是`33554432`，它不是零，所以不，它不应该是否。

```
  975827238 10 = 111010001010011111000100100110 2 
& 33554432 10 = 000010000000000000000000000000 2
-----------------------------------------------------------
   33554432 10 = 000010000000000000000000000000 2

```

# ruby-on-rails - 将csv文件上传到sqlite

> ID：12486068
> 
> 赞同：0
> 
> 时间：2012-09-18T22:36:15.180
> 
> 标签：ruby-on-rails, sqlite, csv

我正在尝试将我的 csv 数据上传到我的 sqlite 表，这是我的代码：

```
require 'csv'

CSV.open('history.csv', 'r') do |row|
  HistoryYear.create(:year => row[1], :first => row[2], :second => row[3], :third => row[4], :regular_season_champ => row[5])
end 
```

我收到一条错误消息，`NoMethodError: undefined method '[]' for #<CSV:0x3c1fe18>`. 我是 Rails 和一般编程的新手，似乎找不到答案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T03:18:50.143

也不要忘记数组（在这种情况下为行）索引为 0，即行的第一个元素是 row[0]。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:51:01.973

您需要改用 CSV.foreach(file...)

您可以执行以下操作：

```
require 'csv'

CSV.foreach('history.csv') do |row|
  HistoryYear.create(:year => row[1], :first => row[2], :second => row[3], :third => row[4], :regular_season_champ => row[5])
end 
```

查看[http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV.html](http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV.html)

# php - 将内容放在 iframe 中（在 ie 中中断）

> ID：12486072
> 
> 赞同：2
> 
> 时间：2012-09-18T22:36:35.193
> 
> 标签：php, javascript, jquery

我试图在设计模式（richTextEditor）中将生成的变量字符串放在 iframe 中。它在所有浏览器中都能很好地工作，除了……你猜对了 IE。IE 根本不会处理 iframe 中的字符串变量。这是我所拥有的...

Html（非常基本）

```
<iframe name="richTextField" id="richTextField" class="writer"></iframe> 
```

PHP（再次非常基础） - 免责声明... mysql_query 不是一个好习惯，稍后将更改为 PDO。这仅用于测试目的！

```
$sql = mysql_query("SELECT * FROM songs WHERE id=$id LIMIT 1") or die();
    while($song=mysql_fetch_array($sql)){
        $title = $song['title'];
        $base_text = $song['song_chart'];
          $base_text = str_replace('<br />', '<br>', $base_text);
    } 
```

这是Javascript的问题...

```
window.frames['richTextField'].document.body.innerHTML = '<?php echo $base_text; ?>';
//I have also tried...
$('iframe').contents().find('body').html('<?php echo $base_text; ?>'); 
```

任何帮助将不胜感激。如果我这样做完全错误，有人可以帮助我找到新的方向。谢谢你

**编辑**

在 IE7、IE8、IE9 中测试，在其中任何一个中都不起作用

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T22:45:47.153

试试这个 javascript 代码

```
window.frames['richTextField'].document.write('<?php echo $base_text; ?>');
window.frames['richTextField'].document.designMode="on"; 
```

# php - PHP中的正则表达式对单词过于贪婪

> ID：12486078
> 
> 赞同：0
> 
> 时间：2012-09-18T22:36:56.897
> 
> 标签：php, regex

我知道我现在只是头脑简单，但我很难过。假设我有一个如下所示的文本目标：

**约翰尼实际上是以他 1234 年的祖父 John Hugenot 命名的，但他的 T5677 id 是 JH6781，他弟弟的 HG766 id 是 RB1223。**

使用这个 RegExp: `\s[A-Z][A-Z]\d\d\d\d\s`，我将如何分别提取匹配字符串的第一次和第二次出现？分别为“JH6781”和“RB1223”。我保证匹配的字符串在目标文本中恰好出现两次。

注意：我根本不想更改现有字符串，所以`str_replace()`不是一个选项。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T22:42:35.983

呃......如何使用这个正则表达式：

```
/\b[A-Z]{2}\d{4}\b/ 
```

它的意思是“匹配一个单词的边界，后跟两个大写英文字母，后跟四个数字，然后是一个单词边界”。所以它不会匹配'TGX7777'（单词边界后面跟着三个字母 - 模式匹配失败），它不会匹配'TX77777'（四个数字后面跟着另一个数字 - 再次失败）。

这就是它的使用方式：

```
$str = "Johnny was really named for his 1234 grandfather, John Hugenot, but his T5677 id was JH6781 and his little brother's HG766 id was RB1223.";

preg_match_all('/\b[A-Z]{2}\d{4}\b/', $str, $matches);
var_dump($matches[0]); 
// array
//  0 => string 'JH6781' (length=6)
//  1 => string 'RB1223' (length=6) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-18T22:45:41.840

```
$s='Johnny was really named for his 1234 grandfather, John Hugenot, but his T5677 id was JH6781 and his little brother\'s HG766 id was RB1223.';
$n=preg_match_all('/\b[A-Z][A-Z]\d\d\d\d\b/',$s,$m); 
```

给出结果`$n=2`，然后

```
print_r($m); 
```

给出结果

```
Array
(
    [0] => Array
        (
            [0] => JH6781
            [1] => RB1223
        )
) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-18T22:41:58.373

您可以结合`preg_match`使用偏移参数（第 5 次）并`strpos`选择第一次和第二次出现。或者，您可以使用`preg_match_all`并且只使用前两个数组条目

```
<?php
$first = preg_match($regex, $subject, $match);
$second = preg_match($regex, $subject, $match, 0, strpos($match[0]) + 1);
?> 
```

# sql - SQL Server：长查询中的聚合函数和 GROUP BY

> ID：12486079
> 
> 赞同：3
> 
> 时间：2012-09-18T22:37:04.853
> 
> 标签：sql, sql-server, group-by, aggregate-functions, ssms

前几天我在 SQL Server 中编写了一个查询，并且必须得到一个添加到查询中的列的总和。

现在，我必须添加 sum 列的查询已经有大约 20 个选定的列。

为了使总和（聚合函数）起作用，我必须`GROUP BY`为每个预先选择的列添加。

这最终成为一项极其乏味和无聊的任务（请参阅下面的查询）。我必须在查询中添加大约 50 行新行，才能使一列的 SUM 起作用。

有没有办法使用 SQL Server Management Studio 自动编写此类查询？

这与其他数据库（如 PL/SQL、Oracle、MySQL 等）是否相同？

这就是查询的样子。

```
SELECT 
       mvLogisticContracts.[mvLogisticContract_id]
      ,mvLogisticContracts.[CONTRACTNUMBER] 
      ,mvLogisticContracts.[CUSTNMBR]
      ,mvLogisticContracts.[DateCreated]
      ,mvLogisticContracts.[TruckAllocatedTotal]      ,mvLogisticContracts.[mvLOgisticAddress_id_StartOriginal]
          ,mvLogisticContracts.[mvLogisticAddress_id_StartOriginal]       ,mvLogisticContractLineItems.[LineItemQuantity]     ,mvLogisticContractLineItems.[LineItemNo]
          ,mvLogisticContractLineItems.[OffloadRequired]
          ,mvLogisticContractLineItems.[CarrierRequested]     ,mvLogisticContractLineItems.[RequestedSerialNo]
          ,mvLogisticContractLineItems.[mvLogisticAddress_id_Start]
          ,mvLogisticContractLineItems.[DateReadyBy]      ,mvLogisticContractLineItems.[DateCustomerRequested],
          mvLogisticContractLineItems.[mvLogisticContractLineItem_id]
      ,mvLogisticSalespersons.[FirstName],mvLogisticSalespersons.[LastName],
      mvLogisticServiceTypes.ServiceType,
      mvLogisticStatuses.Description,
      mvLogisticSKUs.[SKU],       mvLogisticSKUs.[Length],
      a1.CITY as \"CityStart\", a1.AddressName as \"AddressNameStart\", a1.Address1 as \"Address1Start\", a1.STATE as \"StateStart\", a1.ZIP as \"ZipStart\",
      a2.CITY as \"CityEnd\", a2.AddressName as \"AddressNameEnd\", a2.Address1 as \"Address1End\", a2.STATE as \"StateEnd\", a2.ZIP as \"ZipEnd\",
      mvLogisticContracts.[mvLogisticAddress_id_Start] AS aa1,
      mvLogisticContracts.[mvLogisticAddress_id_End] AS aa2,
      SUM(mvLogisticReleases.ReleaseQuantity) as ReleaseQtySum
            FROM mvLogisticContractLineItems
            LEFT JOIN mvLogisticContracts ON mvLogisticContractLineItems.mvLogisticContract_id = mvLogisticContracts.mvLogisticContract_id
            LEFT JOIN mvLogisticSalespersons ON mvLogisticContracts.[mvLogisticSalesperson_id] = mvLogisticSalespersons.[mvLogisticSalesperson_id]
            LEFT JOIN mvLogisticServiceTypes ON mvLogisticContractLineItems.mvLogisticServiceType_id = mvLogisticServiceTypes.mvLogisticServiceType_id
            LEFT JOIN mvLogisticStatuses ON mvLogisticContractLineItems.mvLogisticStatus_id = mvLogisticStatuses.mvLogisticStatus_id
            LEFT JOIN mvLogisticSKUs ON mvLogisticContractLineItems.[SKU_id] = mvLogisticSKUs.[SKU_id]
            LEFT JOIN mvLogisticAddresses a1 ON a1.[mvLogisticAddress_id] = mvLogisticContractLineItems.[mvLogisticAddress_id_Start]
            LEFT JOIN mvLogisticAddresses a2 ON a2.[mvLogisticAddress_id] = mvLogisticContractLineItems.[mvLogisticAddress_id_End]
            /*LEFT JOIN mvLogisticAddresses a1 ON a1.[mvLogisticAddress_id] = mvLogisticContracts.[mvLogisticAddress_id_Start]
            LEFT JOIN mvLogisticAddresses a2 ON a2.[mvLogisticAddress_id] = mvLogisticContracts.[mvLogisticAddress_id_End]*/
            LEFT JOIN mvLogisticReleases ON mvLogisticContractLineItems.mvLogisticContractLineItem_id = mvLogisticReleases.mvLogisticContractLineItem_id
            GROUP BY
            mvLogisticContracts.[mvLogisticContract_id]
      ,mvLogisticContracts.[CONTRACTNUMBER] 
      ,mvLogisticContracts.[CUSTNMBR]
      ,mvLogisticContracts.[DateCreated]
      ,mvLogisticContracts.[TruckAllocatedTotal]      ,mvLogisticContracts.[mvLOgisticAddress_id_StartOriginal]
          ,mvLogisticContracts.[mvLogisticAddress_id_StartOriginal]       ,mvLogisticContractLineItems.[LineItemQuantity]     ,mvLogisticContractLineItems.[LineItemNo]
          ,mvLogisticContractLineItems.[OffloadRequired]
          ,mvLogisticContractLineItems.[CarrierRequested]     ,mvLogisticContractLineItems.[RequestedSerialNo]
          ,mvLogisticContractLineItems.[mvLogisticAddress_id_Start]
          ,mvLogisticContractLineItems.[DateReadyBy]      ,mvLogisticContractLineItems.[DateCustomerRequested],
          mvLogisticContractLineItems.[mvLogisticContractLineItem_id]
      ,mvLogisticSalespersons.[FirstName],mvLogisticSalespersons.[LastName],
      mvLogisticServiceTypes.ServiceType,
      mvLogisticStatuses.Description, 
      mvLogisticSKUs.[SKU],       
      mvLogisticSKUs.[Length], 
      a1.CITY, a1.AddressName, a1.Address1, a1.STATE, a1.ZIP, 
      a2.CITY, a2.AddressName, a2.Address1, a2.STATE, a2.ZIP, 
      mvLogisticContracts.[mvLogisticAddress_id_Start], 
      mvLogisticContracts.[mvLogisticAddress_id_End] 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-09-18T22:50:58.090

子查询和公用表表达式 (CTE) 是将聚合隔离到易于连接到主 SELECT 语句的本地化点的两种方法。

**相关/同步子查询示例：**

```
SELECT c.contract_id, c.contractnum, c.customernum,
    ( SELECT SUM( li.price * li.orderquantity ) 
     FROM lineitems li 
     WHERE li.contract_id = c.contract_id
     ) AS grand_total
FROM contracts c 
WHERE ... 
```

引用 SELECT 列表中的相关子查询是恢复单个值的便捷方式。

**加入 CTE：**

```
WITH ordersummary AS 
( SELECT li.contract_id, 
      COUNT( DISTINCT li.partnum ) AS distinctproducts, 
      SUM( li.orderquantity ) AS itemcount,
      SUM( li.price * li.orderquantity) AS totalprice,
      MIN( p.ship_ready_date ) AS earliest_partial_ship_date,
      MAX( p.ship_ready_date ) AS earliest_complete_ship_date
      FROM lineitems li 
      INNER JOIN parts p 
          ON p.partnum = li.partnum
      GROUP BY li.contract_id
)
SELECT c.contract_id, c.contractnum, c.customernum,
s.distinctproducts, s.itemcount, s.totalprice,
s.earliest_partial_ship_date, s.earliest_complete_ship_date
FROM contracts c 
INNER JOIN ordersummary s
ON s.contract_id = c.contract_id
WHERE ... 
```

**加入一个表达式：**

```
SELECT c.contract_id, c.contractnum, c.customernum,
s.distinctproducts, s.itemcount, s.totalprice,
s.earliest_partial_ship_date, s.earliest_complete_ship_date
FROM contracts c 
INNER JOIN
( SELECT li.contract_id, 
      COUNT( DISTINCT li.partnum ) AS distinctproducts, 
      SUM( li.orderquantity ) AS itemcount,
      SUM( li.price * li.orderquantity) AS totalprice,
      MIN( p.ship_ready_date ) AS earliest_partial_ship_date,
      MAX( p.ship_ready_date ) AS earliest_complete_ship_date
      FROM lineitems li 
      INNER JOIN parts p 
          ON p.partnum = li.partnum
      GROUP BY li.contract_id
) AS s
ON s.contract_id = c.contract_id
WHERE ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T22:58:37.920

我有两个建议

1) 向数据库添加视图。此视图由“计算”列和您需要的其他列组成。计算列是将查询中的列与所有联接连接在一起的结果。例如“SELECT CONCAT(col1,col2), col3 FROM x JOIN y ... z ...”

您可以将其设为物化视图，这将提供更好的性能，因为它保存在磁盘上。从而避免即时加入。

2）首先尝试避免按所有字段进行分组。例如找出每一行的独特之处，你需要总和。也许您不需要返回所有这些字段。如果您这样做，您可以先将它们分组，然后加入表以返回您需要的列。

编辑：我同意 Fred Sobotka 的观点，即子查询是一个好方法。但这取决于您的数据是什么样的。一般来说，您应该尝试限制连接的数量，尤其是在您拥有大型数据集的情况下。连接往往很慢。

# actionscript-3 - 从不同的源域加载 Flash/actionscript 中的图像

> ID：12486084
> 
> 赞同：1
> 
> 时间：2012-09-18T22:37:17.207
> 
> 标签：actionscript-3, flash, amazon-s3, cross-domain

在闪存编码方面，我完全是个菜鸟。

我有一个从 S3 资产存储桶加载的 flash swf 文件。在 Flash swf 内，它*应该*显示一个“浏览”按钮，图像也由同一个存储桶提供。当我从站点所在的同一域托管图像和 swf 文件时，这可以正常工作，但从 S3 加载时则不行。

我已经向`crossdomain.xml`资产存储桶添加了一个文件，如下所示（我正在尝试使用 '*' 开始只是为了让它工作，并在它似乎正在做任何事情时将其缩小到我的实际主机）：

```
<?xml version="1.0"?>
<!DOCTYPE cross-domain-policy SYSTEM "http://www.macromedia.com/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
    <allow-access-from domain="*"/>
</cross-domain-policy> 
```

我还在存储桶中有一个跨域资源共享配置，以便为我们的样式表正确加载字体（这是有效的）。

使按钮图像加载到动作脚本中我做错了什么？我是否需要修改 actionscript 代码本身？代码位于此处（任何人都可以使用的公共库，不是我创作的）：[s3-swf-upload-plugin](https://github.com/nathancolgate/s3-swf-upload-plugin/tree/master/flex_src/src)

您可以[在这里](https://github.com/nathancolgate/s3-swf-upload-plugin/blob/master/flex_src/src/S3Uploader.as#L59)看到它正在实例化一个新`browseButton`定义的[here](https://github.com/nathancolgate/s3-swf-upload-plugin/blob/master/flex_src/src/com/nathancolgate/s3_swf_upload/BrowseButton.as)。就像我说的那样，我对 actionscript 并不完全熟悉，但如果有人能告诉我出了什么问题，我相信我可以摸索它:) 什么是获得实际错误报告的好方法？Firefox 和 Chrome 控制台中的 Firebug 没有任何来自 Flash 的关于正在发生的错误的消息。

**编辑：**

在设置 flash 对象和设置按钮图像的路径时发生了一些奇怪的事情。我更新`BrowseButton.as`了这样做：

```
Security.loadPolicyFile("http://s3.amazonaws.com/my-bucket/crossdomain.xml"); 
```

我把它放在函数`URLRequest`中的任何调用之前。`BrowseButton()`但是它仍然没有显示图像:(我还将 URLRequest 中的值硬编码为：

```
upLoader.load(new URLRequest("http://s3.amazonaws.com/my-bucket/assets/s3_up_button.gif")); 
```

但似乎什么也没发生。当我将它设置`/assets/s3_up_button.gif`为从本地文件中提取时，它工作正常。我究竟做错了什么！如何从 Flash 视频中获取错误消息？:\ 我用编译过，`<debug>true</debug>`但我不确定如何获取实际的异常消息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T07:05:38.810

检查您的 swf 在哪个沙箱中：

> Security.sandboxType 属性
> 
> SWF 文件的作者可以使用只读静态 Security.sandboxType 属性来确定 Flash Player 已将 SWF 文件分配到的沙箱类型。Security 类包括表示 Security.sandboxType 属性的可能值的常量，如下所示：

```
Security.REMOTE--The SWF file is from an Internet URL, and operates under domain-based sandbox rules.
Security.LOCAL_WITH_FILE--The SWF file is a local file, but it has not been trusted by the user and was not published with a networking designation. The SWF file can read from local data sources but cannot communicate with the Internet.
Security.LOCAL_WITH_NETWORK--The SWF file is a local file and has not been trusted by the user, but it was published with a networking designation. The SWF can communicate with the Internet but cannot read from local data sources.
Security.LOCAL_TRUSTED--The SWF file is a local file and has been trusted by the user, using either the Settings Manager or a Flash Player trust configuration file. The SWF file can both read from local data sources and communicate with the Internet. 
```

你可能想要`Security.LOCAL_WITH_NETWORK`，虽然`Security.LOCAL_TRUSTED`也可以。

有关如何在 Flex 中设置沙箱的说明以及详细信息，请参见此处： http://livedocs.adobe.com/flex/3/html/help.html?content= [05B_Security_04.html](http://livedocs.adobe.com/flex/3/html/help.html?content=05B_Security_04.html)

如果您在 Flash IDE 中工作，它应该只是发布设置的一部分。

# java - jaxb 编组跳过空元素

> ID：12486085
> 
> 赞同：7
> 
> 时间：2012-09-18T22:37:17.537
> 
> 标签：java, jaxb

使用 JAXB 可以确保 null 值不会被编组为 () 空元素。例如

```
public class Contacts {
    @XmlElement(name = "Phone")
    protected List<Phone> phone;
    } 
```

目前，如果其中一个电话元素为空，我得到

```
<contact>
         </phone>
         <phone>
                <areacode>919</areacode>
                <phonenumber>6785432</phonenumber>
         </phone>
    </contact> 
```

**我想要以下输出**

```
<contact>
            <phone>
                   <areacode>919</areacode>
                   <phonenumber>6785432</phonenumber>
            </phone>
   </contact> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T07:12:57.867

**默认情况下，空值不作为空元素封送**。
只有空值被编组为空元素

在您的示例中，您正在使用带有空`Phone object`元素的集合。您在列表中有两个元素：（`empty Phone`所有字段都是`null`）和`Phone object`非空字段。
所以，

```
public class Contacts {
    @XmlElement(name = "Phone")
    protected List<Phone> phone = Arrays.asList(new Phone[]{null, null, null});
} 
```

将被编组到

```
<contact/> 
```

但

```
public class Contacts {
    @XmlElement(name = "Phone")
    protected List<Phone> phone = Arrays.asList(new Phone[]{new Phone(), new Phone(), null});
} 
```

将被编组到

```
<contact>   
    <Phone/>  
    <Phone/>  
</contact> 
```

# asp.net-mvc-3 - IIS8 Win8 和 runAllManagedModulesForAllRequests="true"

> ID：12486089
> 
> 赞同：91
> 
> 时间：2012-09-18T22:38:03.073
> 
> 标签：asp.net-mvc-3, iis-8

我正在尝试在 IIS8 中运行配置中包含以下内容的应用程序：

```
<modules runAllManagedModulesForAllRequests="true" /> 
```

IIS8 给我一个错误，上面写着......

> 此配置部分不能在此路径中使用。当该部分锁定在父级别时会发生这种情况。锁定是默认情况下 (overrideModeDefault="Deny") 或由具有 overrideMode="Deny" 或旧 allowOverride="false" 的位置标记显式设置的。

我通过错误和快速的 SO 搜索猜测有一些更高级别的安全设置阻止该行被允许。有任何想法吗？

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2012-09-29T01:40:06.620

我通过在 Windows8 的控制面板中安装窗口功能“Internet 信息服务/万维网服务/应用程序开发/ASP.NET xx”解决了同样的问题。如果你想在 Windows Server 2012 上设置，下面的链接会给你提示。 [http://www.iis.net/learn/get-started/whats-new-in-iis-8/iis-80-using-aspnet-35-and-aspnet-45](http://www.iis.net/learn/get-started/whats-new-in-iis-8/iis-80-using-aspnet-35-and-aspnet-45)

希望它成功了。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2016-07-20T18:32:39.207

对于那些运行 Windows Server 2012 的用户，可以在以下位置找到应用程序开发功能

`[] Server Roles [] Web Server IIS [] Web Server [] Application Development [] ASP.NET x.x`

当您选择 .NET 版本时，它会询问您是否要添加扩展和其他功能。我只是说是的，但是您可能无需安装它们就可以逃脱。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-19T01:52:12.353

在这里很难给出一个具体的答案，但它的基础是你需要查看你正在运行的机器的 machine.config。找到`system.webServer`节点并在错误中查找其引用的 3 个标签/属性。您可能会发现标记为不可覆盖（`allowOverride="false"`）的东西，但我还没有弄乱 Windows 8/server 2012，所以我不知道 machine.config 是什么样的。

# security - 安全地存储访问令牌

> ID：12486090
> 
> 赞同：14
> 
> 时间：2012-09-18T22:38:04.400
> 
> 标签：security, encryption, oauth, access-token

我应该采取哪些安全措施来确保如果我的数据库受到损害，长期访问令牌不会被盗？

长寿命的访问令牌与特定服务的用户名和密码一样好，但从与他人的交谈来看，似乎大多数（包括我自己）以纯文本形式存储访问令牌。这似乎与以纯文本形式存储密码一样糟糕。显然，不能对令牌进行加盐和哈希处理。

理想情况下，我想加密它们，但我不确定最好的方法，尤其是在开源项目中。

我想这个问题的答案类似于存储支付信息和 PCI 合规性，但我也想问为什么没有更多的讨论这个问题？也许我错过了一些东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-09-18T23:35:46.713

你只是想验证别人提供的令牌吗？如果是这样，请将其视为密码。使用字节派生算法，如[基于密码的密钥派生函数 2 (PBKDF2)](http://en.wikipedia.org/wiki/PBKDF2)（也在[RFC 2898](https://www.rfc-editor.org/rfc/rfc2898)中描述）进行 10,000 次迭代并存储前 20 个字节左右。收到令牌时。它实际上是不可逆的。

是否要将令牌提供给其他人进行身份验证？如果是这样，这是一个挑战，因为如果您的应用程序可以解密或以其他方式访问令牌，那么攻击者也可以。想想香农的格言，攻击者知道系统，尤其是对于开源项目。

在这种情况下，最好的方法是使用强大的算法（例如 AES256）加密令牌，使用强大的加密标准随机数生成器生成密钥，并将密钥安全地存储在与数据不同的位置，例如在上例中数据库外部的权限保护文件。后者意味着 SQL 注入攻击不会泄露密钥。

# openid4java - openid4java 中的 NoClassDefFoundError

> ID：12486092
> 
> 赞同：1
> 
> 时间：2012-09-18T22:38:20.990
> 
> 标签：openid4java

我已经下载了 openid4java-0.9.6.662 并使用它实现了一个类。当我执行时：

```
List discoveries = manager.discover("https://www.google.com/accounts/o8/id"); 
```

我得到一个

```
java.lang.NoClassDefFoundError: org/apache/http/protocol/ImmutableHttpProcessor
    at org.apache.http.impl.client.AbstractHttpClient.getProtocolProcessor(AbstractHttpClient.java:656)
    at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:804)
    at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:754)
    at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:732)
    at org.openid4java.util.HttpCache.head(HttpCache.java:335)
    at org.openid4java.discovery.yadis.YadisResolver.retrieveXrdsLocation(YadisResolver.java:400)
    at org.openid4java.discovery.yadis.YadisResolver.discover(YadisResolver.java:248)
    at org.openid4java.discovery.yadis.YadisResolver.discover(YadisResolver.java:232)
    at org.openid4java.discovery.yadis.YadisResolver.discover(YadisResolver.java:166)
    at org.openid4java.discovery.Discovery.discover(Discovery.java:147)
    at org.openid4java.discovery.Discovery.discover(Discovery.java:129)
    at org.openid4java.consumer.ConsumerManager.discover(ConsumerManager.java:542)
    at com.sugra.openid.helper.OpenIDConsumer.authRequest(OpenIDConsumer.java:90) 
```

有趣的是这个类在任何 jar 中都找不到，以为它应该在 httpcore-4.0.1.jar 中找到，因为它包含相同包的类。该类在 httpcore-4.2.1.jar 中可用。但我已经尝试过了

```
org.openid4java.discovery.yadis.YadisException: 0x704: I/O transport error: hostname in certificate didn't match: <www.google.com/173.194.35.144> != <www.google.com> 
```

据说是移植错误，应该使用以前的版本

使用这种方法的正确方法应该是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T15:32:22.547

我找到了。与我的应用程序中的另一个 jar (httpclient.jar) 发生冲突。我只需要升级它

# r - as.factor转换错误

> ID：12486099
> 
> 赞同：0
> 
> 时间：2012-09-18T22:38:59.977
> 
> 标签：r, dataframe

我正在尝试将数据框中的三个字符变量转换为因子，并且我不断收到这三个变量之一的错误。有问题的变量 fund.category 有 4 个可能的值：“未定义”、“小”、“大型现有”和“大型新建”。我的代码如下 - 我首先使用 XLConnect 从 Excel 表中读取数据框，然后删除不必要的变量并重命名我保留的变量：

```
a.projects <- readWorksheet(wb, sheet = "ProjectsDetail")
a.projects.2 <- a.projects[c("ProjectNumber", "BusinessType", "Fund.Category")]
a.projects.2 <- rename(a.projects.2,
                       c("ProjectNumber" = "project.number",
                         "BusinessType" = "business.type",
                         "Fund.Category" = "fund.catetgory"))
str(a.projects.2)
a.projects.2$project.number <- as.factor(a.projects.2$project.number)
a.projects.2$business.type <- as.factor(a.projects.2$business.type)   
a.projects.2$fund.category <- as.factor(a.projects.2$fund.category) 
```

这是 a.projects.2 的结构，在我尝试进行因子转换之前生成：

```
'data.frame':   4291 obs. of  3 variables:
 $ project.number: chr  "APS-10-02825" "APS-10-02826" "APS-10-02876" "APS-10-03134" ...
 $ business.type : chr  "Office" "Office" "Process Industrial" "K-12 School" ...
 $ fund.catetgory: chr  "Undefined" "Undefined" "Large Existing" "Large New Construction" ... 
```

这是来自控制台的错误：

```
a.projects.2$fund.category <- as.factor(a.projects.2$fund.category)

Error in `$<-.data.frame`(`*tmp*`, "fund.category", value = integer(0)) : 
replacement has 0 rows, data has 4291 
```

相同的代码对我的其他两个字符变量（project.number 和 business.type）没有产生错误。任何想法为什么这不起作用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T22:57:33.827

您在之前的声明中拼错了“fund.category”：

```
a.projects.2 <- rename(a.projects.2,
                       c("ProjectNumber" = "project.number",
                         "BusinessType" = "business.type",
                         "Fund.Category" = "fund.catetgory")) 
```

修正错字，它应该很高兴:-)

* * *

要理解错误，

`a.projects.2$fund.category`返回`NULL`

`as.factor(NULL)`返回`factor(0)`

并且在分配`factor(0)`给`a.projects.2$fund.category`您时会出现错误：

```
Error in `$<-.data.frame`(`*tmp*`, "fund.category", value = integer(0)) : 
replacement has 0 rows, data has 4291 
```

# java - 洗牌对象的整数 在列表/数组列表中

> ID：12486101
> 
> 赞同：-2
> 
> 时间：2012-09-18T22:39:05.613
> 
> 标签：java, list, shuffle

```
List<Data> list = new ArrayList<Data>();

public class Data{
    public int n;
    public String p;

    public Data(int N, String P) {
        n = N;
        p = P;
    }

} 
```

我怎样才能洗牌对象的整数：数据。所以 String 保持在相同的位置，并且 Integer 被打乱了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T22:49:32.240

循环遍历每个对象`list`并将其存储在单独的列表中。使用 随机播放此列表。循环遍历这个新的混洗列表，并将每个相应成员的字段设置为在混洗列表中找到的新随机数。`int``Data``[Collections.shuffle(...)](http://docs.oracle.com/javase/6/docs/api/java/util/Collections.html#shuffle%28java.util.List%29)``n``list``int`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:46:33.153

可能必须自己做：

```
for (int i = list.size(); i > 0; i--) {
    int j = (int)(Math.random() * (i + 1));
    int temp = list.get(i).n;
    list.get(i).n = list.get(j).n;
    list.get(j).n = temp;
} 
```

你可以从java库中做的最好的事情是首先将它分成两个列表，一个整数和一个字符串，然后只打乱整数（使用Collections.shuffle），然后将两个列表组合回一个数据列表

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T22:50:51.727

你可以使用这样的东西：

```
List<Integer> ns = new ArrayList<Integer>(list.size());
for (Data data : list) {
    ns.add(data.n);
}
Collections.shuffle(ns);
for (int i = 0; i < list.size(); i++) {
    Data data = list.get(i);
    int newN = ns.get(i);
    data.n = newN;
} 
```

请注意，最好使用访问器`getN()`和`setN(int)`make `Data.n` `private`。

# java - 用于序列化的字节数组池

> ID：12486103
> 
> 赞同：0
> 
> 时间：2012-09-18T22:39:12.927
> 
> 标签：java, serialization, memory-management, garbage-collection, object-pooling

想象一个无状态的 Web 应用程序，它处理许多请求，比如每秒一千个请求。我们在处理周期内创建的所有数据将在结束时立即丢弃。该应用程序将大量使用序列化/反序列化，因此我们在每个请求上创建和丢弃大约 50-200kb。我认为这会给垃圾收集器带来很大的压力，因为 GC 将不得不丢弃大量的短期对象。实现一个字节数组池以将它们重用于序列化/反序列化目的是否有意义？有人有过这样的经历吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T22:41:27.507

垃圾回收机制是建立在大量创建的对象存在很短时间的前提下的。第一个对象池称为[伊甸园空间](http://middlewaremagic.com/weblogic/?tag=eden-space)（有关名称的由来，请参阅[此 SO 答案](https://stackoverflow.com/questions/5383256/eden-space-name-origin-in-garbage-collection)）并定期进行监控。所以我希望垃圾收集器能够处理这个问题。

像大多数（全部？）性能问题一样，我会在应用过早的优化之前测量您的特定用例。许多配置可用于调整垃圾收集，包括并行 GC 策略（请注意下面的“停止世界”评论）

# php - PEAR 邮件发送 CSV 失败

> ID：12486121
> 
> 赞同：3
> 
> 时间：2012-09-18T22:41:30.120
> 
> 标签：php, pear

我在 PHP 中使用 PEAR Mail 发送 CSV 时遇到问题。我可以收到消息 OK，我什至可以打开 CSV 附件——但内容显示为 base64 编码的字符串，而不是普通的 CSV。

这是相关的代码，输出如下：

`SUQsRW`在附加的 CSV 文件中。

显然不是我想要的！

```
// $csv is originally something like
// a,b,c,d,e
// d,e,f,g,h

$csv = base64_encode($csv);
$from = "...";
$to = "...";
$subject = "...";

$headers = array();
$headers['From'] = $from;
$headers['To'] = $to;
$headers['Subject'] = $subject;

// The attachment
$mime = new Mail_mime();
$mime->addAttachment($csv, "text/csv", "report.csv", false);
$mime->setTXTBody($bodyText);

$params = array();
$params['text_charset'] = 'utf-8';

$body = $mime->get($params);
$headers = $mime->headers($headers);

$smtp = Mail::factory('smtp', [unrelated server args]);
$mail = $smtp->send($to, $headers, $body); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-20T01:51:15.297

因此，显然您不需要对实际文件内容进行 base64 编码。无论如何，我仍然无法在 Excel 中打开文件，它给了我以下错误：

`SYLK: File format is not valid`

解决方案在[此处](http://support.microsoft.com/kb/215591)描述。根据 KB，它仅适用于 Excel for Mac，但我在 Windows 上看到了错误。无论如何，解决方案是正确的，CSV 不能以前`ID`两个字符开头。

# c# - 在 C# 中打印绘制的对象

> ID：12486128
> 
> 赞同：0
> 
> 时间：2012-09-18T22:42:00.963
> 
> 标签：c#, printing, gdi+, system.drawing

我有一个使用在面板上绘制对象的应用程序

```
private void Canvas_Paint(object sender, PaintEventArgs e) 
```

该函数绘制代表聚氨酯模具的用户定义数量的矩形。面板上还有一些字符串标记“模具”。面板是可滚动的，就像我说的那样，它里面有可变（并且可能很大）数量的矩形。

我被要求为这些矩形提供打印功能。我对 C# 完全陌生，事实上我在这个程序之前从未使用过它。有没有办法把我在面板上画的东西打印出来？我已经看到了一些绘制到 PrintDocument 的方法，但看起来我必须在 PrintPage 函数中重新绘制它们。我只想打印我已经画的东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T22:45:38.590

面板上的图像应该可以通过 .Image 属性访问。使用新的图形对象，将该图像绘制到 PrintDocument。

或者，您可以在绘制时在表单中保留对图像的引用。

但是，由于打印机和屏幕之间的差异，您可能会想要使用不同的抗锯齿设置等重新渲染整个事物。

# python - 新迁移后会显示数据吗？

> ID：12486130
> 
> 赞同：0
> 
> 时间：2012-09-18T22:42:10.923
> 
> 标签：python, django, model, migration, fixture

我正在使用 django 并且有一个包含夹具的迁移，以将一些初始数据加载到 Web 应用程序中。我还有其他用户添加的数据，这些数据不包含在夹具中。

我的问题是：如果我创建并应用新迁移以将新功能引入我的应用程序，是否仍会显示用户生成的数据（我知道夹具中的数据会显示）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T02:46:05.667

`dumpdata`通常会将 json 生成为：

```
[{"pk": 1, "model": "app_name.model", "fields": {"field1": "value1", "field2": "value2", }}, {"pk": 2, "model": "app_name.model", "fields": {"fiel1": "value2", "field2": "value2",  }}] 
```

这意味着如果模型存在，`pk1`它将覆盖 。`pk2`

因此，如果密钥冲突，用户内容将被覆盖。

# linux - htaccess 重定向到 403 禁止错误的不同页面

> ID：12486133
> 
> 赞同：0
> 
> 时间：2012-09-18T22:42:33.803
> 
> 标签：linux, apache, .htaccess

我这辈子都找不到这个。我们对索引进行了保护，因此如果有人去，`CDNdomain.com/1/`除非他们去，否则他们将看不到任何东西`CDNdomain.com/1/something.jpg`。当他们访问时，`/1/`他们会看到 403 Forbidden 错误。我想做的是当他们显示 403 Forbidden 错误时，将他们重定向到`ourRealdomain.com`.

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:12:12.227

您可以在以下文档根目录的 htaccess 文件中尝试类似的操作`CDNdomain.com`：

```
RewriteEngine On
# make sure this is the right host
RewriteCond %{HTTP_HOST} cdndomain.com$ [NC]
# make sure this is a request for an existing directory
RewriteCond %{REQUEST_FILENAME} -d
# redirect
RewriteRule ^(.*)$ http://ourRealdomain.com/ [L,R=301] 
```

请注意，这也会将`/`:重定向`http://CDNdomain.com/`到`http://ourRealdomain.com/`. 如果您想避免这种情况，请将正则表达式匹配从 更改`^(.*)$`为`^(.+)$`。如果您想将这些规则放在**CDNdomain.com**`^`的 vhost 配置中，请在:之后添加一个斜杠`^/(.+)$`。

# java - 使用 Apache POI 加载 xlsx 文件时出现 NullpointerException

> ID：12486137
> 
> 赞同：1
> 
> 时间：2012-09-18T22:42:53.590
> 
> 标签：java, apache-poi, openxml-sdk, xlsx

我正在尝试在 mac osx 环境中使用 Apache POI 3.8 读取文件，该文件是在 Windows 中使用 Open XML SDK 2.0 for Microsoft Office 创建的，由于无法加载 xlsx 文件，因此出现空指针异常。下面是堆栈跟踪。我可以打开文件并查看它。

相同的代码适用于我在 mac os env 中创建的文件。如果我在处理之前打开并保存文件，则没有任何问题。注意：保存后文件大小会增加。在 .net 中生成文件并在 mac osx 环境中处理文件是否存在问题。

任何线索为什么我会低于错误。

```
Caused by: java.lang.NullPointerException
        at org.apache.poi.xssf.usermodel.XSSFWorkbook.onDocumentRead(XSSFWorkbook.java:253)
        at org.apache.poi.POIXMLDocument.load(POIXMLDocument.java:159)
        at org.apache.poi.xssf.usermodel.XSSFWorkbook.<init>(XSSFWorkbook.java:183)
        at org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:73) 
```

该类如下所示，带有实用方法，没有复制整个类。但这发生在`wb = new XSSFWorkbook(bis)`创建工作簿时。我尝试了几个选项，例如`WorkbookFactory.create(bis)`而不是`XSSFWorkbook`，但错误仍然相同，问题主要在于文件内容。

```
public class XLSXReader {

    private BufferedInputStream bis;
    private boolean hasNext = true;
    int skipLines;

    private boolean linesSkiped;

    //   The default line to start reading.
    public static final int DEFAULT_SKIP_LINES = 0;

    private XSSFWorkbook wb =null;
    private XSSFSheet sheet=null;
    private int noOfCols;

    public XLSXReader(InputStream is){
        bis = new BufferedInputStream(is);
        this.noOfCols=0; 
        try {
            wb = new XSSFWorkbook(bis); 
            sheet = wb.getSheetAt(0);
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

// with basic utility methods ....
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-20T11:12:25.670

我想，你错过了这个`class path`问题。尝试如下。确保该`properties`目录必须位于`class path`. 将您的文档文件放在这些文件夹中。

```
public class WorkBookReader {
    public static void main(String[] args) {
        try {
            InputStream inp = new FileInputStream("properties/workbook.xls");
            Workbook wb = WorkbookFactory.create(inp);
            Sheet sheet = wb.getSheetAt(0);
            Row row = sheet.getRow(2);
            Cell cell = row.getCell(3);
            if (cell == null)
                cell = row.createCell(5);
            cell.setCellType(Cell.CELL_TYPE_STRING);
            cell.setCellValue("Hello!");

            // Write the output to a file
            FileOutputStream fileOut = new FileOutputStream("properties/workbook.xls");
            wb.write(fileOut);
            fileOut.close();
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } catch (InvalidFormatException e) {
            e.printStackTrace();
        }
    }
} 
```

# xml - XML 数据类型转换

> ID：12486139
> 
> 赞同：2
> 
> 时间：2012-09-18T22:43:06.063
> 
> 标签：xml, xslt, xsd, xslt-2.0

我需要将源架构定义的所有 Float 和 Double 数据类型转换为十进制数据类型。

我们有一个现有的 XSLT，它从第三方获取 XML 文档并将其转换为 XML 结构，然后我们可以将其传递到我们的 4GL DB 应用程序中。原生 4GL 接口的好处在于它可以将入站 XML 转换为原生 Dataset 结构。不足之处在于它将 Float 和 Double 数据类型映射到字符数据类型。

在 XSLT 中是否有一种方法可以识别 Float/Double 数据类型的元素并将其转换为小数。我在想这可能是主要的 XSLT 步骤，然后将输出传递到主要的 XSLT。

**示例模式在：**

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="ttPTManifest">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="JobCode"/>
                <xs:element ref="EstimateHours"/>
                <xs:element ref="ActualHours"/>
                <xs:element ref="Density"/>
                <xs:element ref="NettLitres"/>
                <xs:element ref="QuitOutLitres"/>
                <xs:element ref="QuitInLitres"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="QuitOutLitres" type="xs:double"/>
    <xs:element name="QuitInLitres" type="xs:float"/>
    <xs:element name="PTManifestSonicIn">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="ttPTManifest"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="JobCode" type="xs:string"/>
    <xs:element name="NettLitres" type="xs:double"/>
    <xs:element name="EstimateHours" type="xs:float"/>
    <xs:element name="Density" type="xs:decimal"/>
    <xs:element name="ActualHours" type="xs:float"/>
</xs:schema> 
```

**示例 XML 数据在：**

```
<?xml version="1.0"?>
<PTManifestSonicIn xsi:noNamespaceSchemaLocation="SampleIn.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <ttPTManifest>
        <JobCode>000123</JobCode>
        <EstimateHours>3.14159E3</EstimateHours>
        <ActualHours>3.14159E3</ActualHours>
        <Density>123.456</Density>
        <NettLitres>3.14159265358979E3</NettLitres>
        <QuitOutLitres>3.14159265358979E3</QuitOutLitres>
        <QuitInLitres>3.14159E3</QuitInLitres>
    </ttPTManifest>
</PTManifestSonicIn> 
```

**所需的架构输出：**

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="ttPTManifest">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="JobCode"/>
                <xs:element ref="EstimateHours"/>
                <xs:element ref="ActualHours"/>
                <xs:element ref="Density"/>
                <xs:element ref="NettLitres"/>
                <xs:element ref="QuitOutLitres"/>
                <xs:element ref="QuitInLitres"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="QuitOutLitres" type="xs:decimal"/>
    <xs:element name="QuitInLitres" type="xs:decimal"/>
    <xs:element name="PTManifestSonicIn">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="ttPTManifest"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="JobCode" type="xs:string"/>
    <xs:element name="NettLitres" type="xs:decimal"/>
    <xs:element name="EstimateHours" type="xs:decimal"/>
    <xs:element name="Density" type="xs:decimal"/>
    <xs:element name="ActualHours" type="xs:decimal"/>
</xs:schema> 
```

**所需的 XML 数据输出：**

```
<?xml version="1.0"?>
<PTManifestSonicIn xsi:noNamespaceSchemaLocation="SampleOut.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <ttPTManifest>
        <JobCode>000123</JobCode>
        <EstimateHours>3141.59</EstimateHours>
        <ActualHours>3141.59</ActualHours>
        <Density>123.456</Density>
        <NettLitres>3141.59265358979</NettLitres>
        <QuitOutLitres>3141.59265358979</QuitOutLitres>
        <QuitInLitres>3141.59</QuitInLitres>
    </ttPTManifest>
</PTManifestSonicIn> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:14:33.697

为了转换 XML 数据，您可以使用以下样式表：

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    version="2.0">
    <xsl:output indent="yes"/>

    <xsl:template match="@*|node()">
        <xsl:copy>
            <xsl:apply-templates select="@*|node()"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template 
           match="*
                  [local-name(.)=document(/*/@xsi:noNamespaceSchemaLocation)/*/xs:element[@type=('xs:double', 'xs:float')]/@name]
                  [. castable as xs:double or . castable as xs:float]">
        <xsl:copy>
            <xsl:value-of select="number(.)"/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet> 
```

您可以使用以下样式表转换 Schema：

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    version="2.0">
    <xsl:output indent="yes"/>

    <xsl:template match="@*|node()">
        <xsl:copy>
            <xsl:apply-templates select="@*|node()"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="@type[.=('xs:double', 'xs:float')]">
        <xsl:attribute name="type" select="'xs:decimal'"/>
    </xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T09:01:52.473

如果您可以使用 XSL v2，请使用 Mads 的答案。如果您坚持使用 v1，这可以进行 XSD 转换：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xsl:template match="@*|node()">
        <xsl:copy>
            <xsl:apply-templates select="@*|node()"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template match="xs:element[@type='xs:double' or @type='xs:float']">
        <xsl:copy>
            <xsl:attribute name="name"><xsl:value-of select="@name"/></xsl:attribute>
            <xsl:attribute name="type">xs:decimal</xsl:attribute>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet> 
```

这可用于转换 XML：

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    version="1.0">
    <xsl:output indent="yes"/>

    <xsl:template match="@*|node()">
        <xsl:copy>
            <xsl:apply-templates select="@*|node()"/>
        </xsl:copy>
    </xsl:template>

    <xsl:template 
          match="*
                  [local-name(.)=document(/*/@xsi:noNamespaceSchemaLocation)/*/xs:element[@type='xs:double' or @type='xs:float']/@name]
                  [number(.)=number(.)]">
        <xsl:copy>
            <xsl:value-of select="number(.)"/>
        </xsl:copy>
    </xsl:template>

</xsl:stylesheet> 
```

# jquery - 检查用户是否正在使用触控板滚动？

> ID：12486141
> 
> 赞同：11
> 
> 时间：2012-09-18T22:43:25.063
> 
> 标签：jquery, scroll, trackpad

我创建了一个网站，用户可以使用鼠标滚动或向上/向下箭头滚动浏览画廊。它像我想要的那样工作，并在使用鼠标滚动时更改一个图像 pr 滚动。但是，如果用户使用触控板滚动，几乎不可能一次滚动单个图像。

所以我的问题是：有没有办法检查用户是否正在通过触控板滚动，然后改变滚动行为，使其变得不那么敏感，从而更容易一次滚动单个图像？

我不太擅长 jquery，到目前为止，我的解决方案是由几个脚本组合而成的：

[http://jsfiddle.net/MukuMedia/PFjzX/33/](http://jsfiddle.net/MukuMedia/PFjzX/33/)

希望可以有人帮帮我 ：）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-05-22T15:43:26.237

我发现这里的神奇数字是 40。

似乎使用触控板（可能也使用魔术鼠标），增量增加了 40 倍。

即使您收回普通鼠标并稍后滚动它，它也会保持这种状态。

所以我做了什么，使用[jquery mousewheel 插件](https://github.com/brandonaaron/jquery-mousewheel)：

```
b.mousewheel(function(evt,delta,deltaX,deltaY){
    if(Math.abs(deltaY)>=40)
        deltaY/=40;
    if(Math.abs(deltaX)>=40)
        deltaX/=40;

    //Do your stuff here.
}); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-18T22:55:15.683

不，这是不可能的。我能想到的唯一解决方案是限制滚动速度。我不会尝试破译您的代码，但我建议您将`timedOut`变量初始化为零，每次滚动到新图像时将其设置为 1。`setTimeout()`在 50 毫秒后使用 a将其设置回零。在滚动到新图像之前，请检查此`timedOut`变量并仅在它为零时滚动。（确保你把你`setTimeout`的支票放在里面`timedOut`，否则每次鼠标滚轮移动时都会不断地调用它，这不是你想要的。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-10T18:49:13.907

这几乎就是 DC_ 所建议的。想我会发布这个，因为它是一个实际的实现。

```
// similar to _.debounce, but was having issues with it, so I made this.
function rateLimit(func, time){
        var callback = func,
                waiting = false,
                context = this;
        var rtn = function(){
            if(waiting) return;
            waiting = true;
            var args = arguments;
            setTimeout(function(){
                waiting = false;
                callback.apply(context, args);
            }, time);
        };
        return rtn;
    }

    function onWheel(e){
      // Add your code here
    }

    // will only fire a maximum of 10 times a second
    var debouncedOnWheel = rateLimit(onWheel, 100);
    window.addEventListener("wheel", debouncedOnWheel); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-12T07:25:49.107

我创建的“section-change”插件遇到了类似的问题。我结束了用“动画”变量解决它：轮子动作只有在这个变量设置为“假”时才有效，一旦触发，变量切换到“真”，然后我会将变量切换回“假”一次动画完成。希望这可以帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-02T22:05:08.567

我找到了一个解决方案，可以检测用户是否使用触摸板。它工作得很好，只有两个小缺点。

首先，它在第一次触发事件后检测到鼠标滚动，因此单击鼠标滚轮什么也不做。但这只是第一次。然后我们可以缓存导致第二个小问题的值。当用户拥有触控板和带滚轮的鼠标时，它会检测到首先使用的内容。对我来说，这些问题可以忽略不计。这里的代码

```
var scrolling = false;
var oldTime = 0;
var newTime = 0;
var isTouchPad;
var eventCount = 0;
var eventCountStart;

var mouseHandle = function (evt) {
    var isTouchPadDefined = isTouchPad || typeof isTouchPad !== "undefined";
    console.log(isTouchPadDefined);
    if (!isTouchPadDefined) {
        if (eventCount === 0) {
            eventCountStart = new Date().getTime();
        }

        eventCount++;

        if (new Date().getTime() - eventCountStart > 50) {
                if (eventCount > 5) {
                    isTouchPad = true;
                } else {
                    isTouchPad = false;
                }
            isTouchPadDefined = true;
        }
    }

    if (isTouchPadDefined) { // in this if-block you can do what you want
        // i just wanted the direction, for swiping, so i have to prevent
        // the multiple event calls to trigger multiple unwanted actions (trackpad)
        if (!evt) evt = event;
        var direction = (evt.detail<0 || evt.wheelDelta>0) ? 1 : -1;

        if (isTouchPad) {
            newTime = new Date().getTime();

            if (!scrolling && newTime-oldTime > 550 ) {
                scrolling = true;
                if (direction < 0) {
                    // swipe down
                } else {
                    // swipe up
                }
                setTimeout(function() {oldTime = new Date().getTime();scrolling = false}, 500);
            }
        } else {
            if (direction < 0) {
                // swipe down
            } else {
                // swipe up
            }
        }
    }
}

document.addEventListener("mousewheel", mouseHandle, false);
document.addEventListener("DOMMouseScroll", mouseHandle, false); 
```

# php - PHP对战系统完整性

> ID：12486142
> 
> 赞同：-3
> 
> 时间：2012-09-18T22:43:32.023
> 
> 标签：php, mysql, system

我正在尝试为我一直在设计的在线游戏编写一个 php 战斗系统。

简而言之，它将是一个 MMORPG，玩家的统计数据将保存在几个 MySQL 表中，怪物数据也将保存。

简而言之，我担心人们通过编辑怪物的 hp 来做某事，所以它说他们杀死了怪物，将他们的 HP 最大值保留在他们的计算机上（因为更新 MySQL 条目不是不切实际每转一圈？），或者别的什么。

我仍然只是 PHP 的中级，所以我不确定如何隐藏这些值以防止用户更改，但不会通过每次发生攻击时更新 MySQL 表来造成严重的服务器拥塞。

有人可以告诉我以下一项或多项：

1.  有没有办法单独在 PHP 中隐藏这些活动变量以防止被编辑以允许作弊？

2.  如果没有，或者如果它不是非常服务器友好，那么在 Java 中是否有一个相对简单的小程序，或者用于控制主机变量的应用程序可以以相对简单的方式进行编程？

目前怪物只有普通攻击，玩家只有攻击，不过我打算先扩展玩家的技能攻击。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:33:32.250

您永远不应该相信浏览器提供给服务器的内容。浏览器可以发出它想要的所有请求（例如，向前移动 5000 英尺），但如果服务器查看请求并说“哇，你不能这样做！最大速度是 2 英尺/秒”！然后你只是拒绝“移动请求”，或者你忽略它，你的选择取决于实施。

例如，客户端（无论是浏览器还是桌面上的应用程序）都可以存储它想要的所有数据。它可以存储HP和资源。服务器也有自己的副本。如果有人要使用一些内存更改工具（例如 Cheat Engine），他们所能做的就是修改客户的数据（例如，而不是 100 美元到 1,000,000 美元）。但这没有任何意义，因为如果客户端请求购买 50,000 美元的商品，服务器将验证该请求。它查看服务器上的资金，而不是客户端，并注意到用户资金不足。只要告诉用户“钱不够”，npo 交易就完成了。

如果客户端要尝试弄乱客户端的内部存储器，我不会担心客户端不再正常运行。只要确保服务器批准所有游戏状态修改请求，一切都会好起来的。

如果您想避免向网络发送垃圾邮件并保持用户的移动有效，则客户端可以假设服务器将批准请求。因此，您可以允许用户移动一定距离并在几秒钟后发送一个请求，或者您可以发送多个请求并在等待服务器批准请求时显示角色移动。如果您发出多个请求并且服务器需要一段时间来响应，这会为客户端带来与服务器不同步的新问题。

通常，您必须发送大量请求，并且每次用户执行某项操作时您都必须发送请求，因为您希望其他用户也看到您在做什么。没有办法解决这个问题，但您可以使用巧妙的压缩和延迟策略，让客户端运行更顺畅。

如果您想避免一直访问您的 SQL 服务器，您可以使用缓存工具，例如[Memcache](http://php.net/manual/en/book.memcache.php)，PHP 非常方便地支持该工具。Memcache 可以在内存中存储您需要的任何内容，以实现非常快速的数据存储。当然，这有一些警告，因为您需要将缓存与数据库同步，反之亦然。

# php - 跟踪用户活动以建立个人用户资料和建议

> ID：12486147
> 
> 赞同：1
> 
> 时间：2012-09-18T22:44:40.593
> 
> 标签：php, mysql, database, database-design

我即将建立一个网上商店，需要提出一个跟踪用户信息的解决方案，并在此基础上建议他们可能喜欢的用户产品，从而建立一个个人用户档案（他们喜欢什么）。

要跟踪/用于算法的信息，我认为应该包括：

*   过去的订单
*   愿望清单/书签/收藏夹...
*   输入的搜索词
*   查看的产品（这里还跟踪并考虑“丢弃”引用，这意味着用户是否关闭站点/立即返回或查看更多图片/向下滚动（视口）等）

产品被分配到类别以及不同的属性，如颜色、标签等。该表与、等`product`有关系。`color``category`

> **产品**
> id_产品
> 价格
> timestamp_add
> 
> **颜色**
> id_color
> ...
> 
> **product_color**
> id_product_color
> id_product
> id_color

问题是：

1) 您将如何构建一个数据库来跟踪例如查看的产品？应该是这样吗？：

> **product_viewed**
> id_product_viewed
> id_product
> id_user
> 时间戳

2）如果我想根据用户购买的产品颜色来计算用户最喜欢的3种颜色，放在他们的愿望清单上，加书签，查看：是否可以从性能的角度来计算应该推荐哪些产品每次查询数据库时都会这样做吗？或者您是否不时更新用户配置文件，仅存储基于跟踪数据的当前已计算出的最喜欢的颜色，并使用存储的计算数据来查找与此信息匹配的产品？

facebook、amazon 或 pinterest 等大型网站如何做到这一点？在 pinterest 上，您会根据您之前点击的项目获得您可能喜欢的项目的建议。他们如何处理这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:52:32.300

是的，您的 product_viewed 架构是可以的。

至于他们最喜欢的三种颜色，试试这个未经测试的代码：

```
select c.name, count(*) as rank
from product_viewed pv
JOIN product_color pc on pc.id_product = pv.id_product
JOIN color c on pc.id_color = c.id_color
where pv.id_user = 1
group by c.name
order by rank desc
limit 3 
```

给定用于连接表的 id 上的索引以及对查看项目数量的合理限制，这应该具有不错的性能。以后，您可能只会查看他们最近的 100 种产品等，只是为了防止它永远增长。（或者，正如您所建议的，缓存）。

这没有什么神奇之处，所以它可能类似于其他网站正在做的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:55:02.113

用你刚刚写的表格来做是一个好方法。Facebook 等也在这样做。

但为了提高效率，他们使用所谓的 B 树。

# visual-studio-2010 - 将 matlab 与 Visual Studio 集成

> ID：12486150
> 
> 赞同：3
> 
> 时间：2012-09-18T22:45:15.913
> 
> 标签：visual-studio-2010, matlab

是否有可能从 Visual Studio 获得一个可以调用 matlab 文件（代码）并运行它的界面。

我基本上想要一个 .exe 文件，它有来自 VS 的 GUI 和来自 matlab 的代码。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-11-13T11:20:56.567

如果您正在构建 GUI 并将其集成到文件中，则以下方法有效：您可以使用from`.mex`调用 matlab 函数或用户定义函数： [mexCallMATLAB](http://www.mathworks.se/help/matlab/apiref/mexcallmatlab.html?searchHighlight=mexcallmatlab)`mexCallMATLAB``mex.h`

如果你在 C/C++ 中构建一个独立的程序（生成一个`.exe`文件），那么`Matlab Engine`你可以调用它来执行`Matlab`代码。看看这里阅读更多关于这个接口的[Matlab 引擎](http://www.mathworks.se/help/matlab/matlab_external/using-matlab-engine.html)。它基本上是一个 C 库，允许您调用`Matlab`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T08:33:40.287

我不确定你的问题是什么，但我仍然很确定答案是“否”。

如果您使用其中一种 Visual Studio 语言（例如 C#、VB.NET 等）构建了用户界面，并且希望该界面调用 matlab 脚本，那么我知道您有两个选项：

1) 从 Mathworks 购买 matlab .NET 接口。我不确定这是如何工作的，因为它要花很多钱，而我没有。

2）购买matlab编译器（这也需要很多钱）并将你的matlab代码“编译”成可执行文件。然后通过命令行从您选择的 .NET 语言中调用该可执行文件。这种方法的问题在于，将数据传递到 matlab 脚本的唯一方法是通过从命令行调用脚本。通常的解决方法是在命令行的调用中传递 txt 或 csv 文件的位置，然后让 matlab 脚本的第一部分专门用于从该 txt 或 csv 文件中检索数据。这种方法的另一个问题是，如果你想调用很多 matlab 脚本，它会花费你很长时间，因为每次你在后台调用一个“编译”的 matlab 脚本，您实际上是通过称为 matlab 编译器运行时的野兽创建所有 matlab 运行时库的新实例。这就是我说“已编译”的原因——因为它仍然在运行时解释，所以它并没有真正编译。

**编辑**

要使用 VB.NET 调用 matlab 脚本，您可以尝试：

```
 '#Get the matlab executable info
    Dim MatlabStartInfo As New ProcessStartInfo
    MatlabStartInfo.FileName = "cmd.exe"
    MatlabStartInfo.WindowStyle = ProcessWindowStyle.Maximized
    MatlabStartInfo.Arguments = "/C " & Chr(34) & Chr(34) _ 
    & "C:\Path\To\Matlab\Script\Matlab_Script.exe " & Chr(34) & " " & Chr(34) _
    & MatlabScriptInputArgument & Chr(34) & Chr(34)

    '#Run the matlab executable
    Using MatlabProcess As Process = New Process
        MatlabProcess.StartInfo = MatlabStartInfo
        MatlabProcess.Start()
        MatlabProcess.WaitForExit()
    End Using 
```

其中 MatlabScriptInputArgument 是一个包含 matlab 函数参数的字符串（上面的代码假设只有一个输入）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-08T22:35:50.523

不是 Visual Studio，但有一个[Visual Studio Code](https://code.visualstudio.com/) MatLab[扩展](https://marketplace.visualstudio.com/items?itemName=Gimly81.matlab)。

# java - 在play framework 2.0中将变量分配给java列表

> ID：12486156
> 
> 赞同：0
> 
> 时间：2012-09-18T22:45:49.807
> 
> 标签：java, playframework, playframework-2.0

我需要从 html 代码中访问 Java 列表。我的列表由公共静态方法返回：

```
ComboboxOpts.getListOfValues() 
```

我在我的 scala 代码中多次使用此方法，希望将其分配给某个变量。也许与此类似

```
@mylist = ComboboxOpts.getListOfValues() 
```

这样我就可以像这样使用它

```
@for(i <- 0 to mylist.size -1){
    //Do stuff
} 
```

而不是这个

```
@for(i <- 0 to ComboboxOpts.getListOfValues.size -1){
    //Do stuff
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:02:31.903

您可以使用`defining()`设置新变量，例如：

```
@defining(getName() + " " + getType()) { text => 
  Hello @text!
} 
```

但是，对于您的情况，您可以按如下方式遍历列表：

```
@for(value <- ComboboxOpts.getListOfValues()) {
  <li>@value</li>
} 
```

这不会重复调用您的函数，并且更具表现力。Play 文档有几个相关示例：[http ://www.playframework.org/documentation/2.0/JavaTemplates](http://www.playframework.org/documentation/2.0/JavaTemplates)

如果您也绝对需要索引，请尝试使用 Scala 的`zipWithIndex()`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-28T12:35:37.590

**应用程序.java 文件**

2.  公共类应用程序扩展控制器{
3.  公共静态结果索引（）{
4.  列表 myList = new ArrayList();
5.  myList.add("one");
6.  myList.add("两个");
7.  返回 ok(index.render(myList));
8.  }
9.  }
**index.scala.html 文件**

11.  @(myList: 列表[字符串])
12.  @main("欢迎玩 2.0") {
13.  @for(项目
14.  @物品
15.  }
16.  }

# qt - 是否可以使用 QNetworkAccessManager 从文件托管站点下载文件

> ID：12486157
> 
> 赞同：1
> 
> 时间：2012-09-18T22:45:50.157
> 
> 标签：qt, network-programming

我尽了最大努力从 uploading.com 下载文件，但一切都是徒劳的。我尝试了所有可能的重定向方式，但都是徒劳的。它总是以永久移动错误告终，如果您尝试重定向，它最终会下载网页。哼！

```
This is the cookie which i have to pass to QNetworkAccessManager:

S=gmail=gPwZoKGL8hgGA4ZHoej_Tg; S=gmail=xrWQCf29oq77myB3uSRKPg;

request.setUrl(url);
          request.setAttribute(QNetworkRequest::HttpPipeliningAllowedAttribute, true);
          cookieJar->setCookiesFromUrl(QNetworkCookie::parseCookies(cookie),url);
          manager.setCookieJar(cookieJar);
          reply=manager.get(request); 
```

完成的信号调用以下槽

```
int statusCode=0;
            statusCode=reply->attribute(QNetworkRequest::HttpStatusCodeAttribute).toInt();
           if(statusCode>300)
           {
               if(statusCode==307||reply->rawHeaderList().contains("Location"))
               {
                url=reply->header(QNetworkRequest::LocationHeader).toString();
                request.setUrl(url);
                request.setAttribute(QNetworkRequest::HttpPipeliningAllowedAttribute, true);
                cookieJar->setCookiesFromUrl(QNetworkCookie::parseCookies(cookie),url);
                manager.setCookieJar(cookieJar);
                reply=manager.get(request);
                return;
            } 
```

下载失败，因为它下载的是网页而不是文件。url 和 cookie 由 flashgot 插件、firefox 提供。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:04:32.920

我认为如果“uploading.com”没有他们自己的原生 API：您将需要从他们的网站解析 html，然后编辑必要的 html，就好像您是他们网页上的用户来下载文件一样。

我需要更多关于您尝试过的内容以及您想做什么来回答这篇文章的信息。您应该首先检查他们是否有自己的 API。使用 Qt 绝对可以做到这一点。

# vba - 静默发送密钥

> ID：12486159
> 
> 赞同：0
> 
> 时间：2012-09-18T22:46:17.027
> 
> 标签：vba, excel, powerpoint

我正在尝试在 vba 应用程序（在幻灯片放映期间在 powerpoint 中）和我编写的 .net 应用程序之间传递消息。

我能想到的唯一方法是发送击键。

但是，这种方法会导致 powerpoint 失去焦点。

你能提出一个解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T10:38:16.033

如果这一切都发生在同一台机器上，最简单的方法可能是让 PPT 将其状态写入注册表，其他应用程序从注册表中读取它（`GetSetting(), SaveSetting()`）。

如果 PTT 和其他进程在不同的机器上运行，您可以考虑将状态写入一个可以异步读取的小文本文件中。

不同机器上的两个进程/应用程序之间（同步）通信的另一种方式是使用[套接字](http://msdn.microsoft.com/en-us/library/windows/desktop/ms738545%28v=vs.85%29.aspx)并通过网络发送信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T21:58:24.410

我发现了一种在 vba 和 .net 之间进行通信的有趣方式，无需文件系统操作、套接字或外部对象。

首先，我们注册 powerpoint 事件，如下所示：

[http://www.vbaexpress.com/kb/getarticle.php?kb_id=327](http://www.vbaexpress.com/kb/getarticle.php?kb_id=327)

其次，我们在演示开始事件上更新 VBA 中的剪贴板：

[http://word.mvps.org/faqs/macrosvba/ManipulateClipboard.htm](http://word.mvps.org/faqs/macrosvba/ManipulateClipboard.htm)

第三，我们在 .net 上使用剪贴板作为侦听器：

[如何在 C# 中监视剪贴板内容更改？](https://stackoverflow.com/questions/2226920/how-to-monitor-clipboard-content-changes-in-c)

最后，我们在演示结束事件上恢复原始剪贴板值

# ios - UIWebView 异步请求阻止滚动

> ID：12486162
> 
> 赞同：3
> 
> 时间：2012-09-18T22:46:21.440
> 
> 标签：ios, asynchronous, uiwebview

我一直在寻找类似的东西，但什么也没出现。所以我决定在这里第一次问。

我正在开发一个 iOS 项目。我有一个 UIWebView 与 NSURLRequest 一起工作得很好。但是，当我加载一个带有多个异步请求（即 wsj.com）的 URL 时，比如广告和 Facebook 喜欢的东西；Web 视图的滚动交互变得迟钝且无响应。

我一直在调试，并且在执行委托方法 shouldStartRequest 时发生了这种情况（多次）

第一次拍摄：使用线程。没用。第二次拍摄：玩网页视图的交互属性。第三次拍摄：试图停止不必要的调用（我的业务规则不需要它们）不起作用。即使我杀了他们，滞后效应仍然存在。

所有这一切的奇怪之处在于 Safari 使用相同的 URL 呈现和工作正常。

我正在寻找想法，有人知道这里发生了什么吗？

谢谢！！

# javascript - 有没有使用 ThreeNodes.js 作为库的例子？

> ID：12486166
> 
> 赞同：0
> 
> 时间：2012-09-18T22:46:50.307
> 
> 标签：javascript, graph, nodes

我发现了这个不错的库/项目：[ThreeNodes](https://github.com/idflood/ThreeNodes.js)（[演示](http://idflood.github.com/ThreeNodes.js/public/index.html#example/postprocessing1.json)）。

我想知道是否有人可以提供一个使用 js（不是 CofeeScript）的示例来创建一个带有 3 个服装连接节点的简单页面（例如，带有字符串和数字输入字段的服装组件框以及进入标准基础组件的 2 个输出字符串和数字）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-27T13:00:09.430

ThreeNodes 让您将代码导出为 JS：http: [//idflood.github.com/ThreeNodes.js/public/code_export_example.html](http://idflood.github.com/ThreeNodes.js/public/code_export_example.html)

# haskell - QuickCheck 非空字符串 - listOf

> ID：12486167
> 
> 赞同：1
> 
> 时间：2012-09-18T22:46:59.883
> 
> 标签：haskell, quickcheck

我正在学习快速检查（还有haskell），我有以下代码：

```
newtype Urls = FN { unFN :: String } deriving Show

instance Arbitrary Urls where
arbitrary = do protocol <- elements ["http://"]
             name <-  listOf $ elements ['a'..'z']
             domain <- elements [".com",".com.br",".net"]
             return (FN (protocol ++ name ++ domain)) 
```

我的问题是关于如何使 listOf 永远不会返回空（NonEmpty），因为现在对于生成的一些数据，我会收到像 {unFN = "http://.net"} 这样的字符串，简化我希望该名称永远不会为空

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-09-18T22:49:37.573

使用`listOf1`而不是`listOf`.

# javascript - 需要帮助了解如何对网站进行 ajaxify

> ID：12486174
> 
> 赞同：5
> 
> 时间：2012-09-18T22:48:13.717
> 
> 标签：javascript, jquery, ajax, html

我最近发现了这个关于如何使用 History.js、jQuery 和 ScrollTo 使用 HTML5 History API 对网站进行 Ajaxify 的要点：[https ://github.com/browserstate/ajaxify](https://github.com/browserstate/ajaxify)

我很难获得这个工作的简单版本，并且不确定我是否理解所有内容。首先，我加载了 gist 中提供的所有脚本，然后设置了一个非常简单的导航和内容部分：

```
 <ul id="nav">
    <li id="home-link"><a href="/" title="Home">Home</a>/</li>
    <li id="work-link"><a href="/work" title="Work">Work</a>/</li>
    <li id="labs-link"><a href="/labs" title="Labs">Labs</a>/</li>
    <li id="blog-link"><a href="/blog" title="Blog">Blog</a>/</li>
    <li id="contact-link"><a href="/contact" title="Contact">Contact</a></li>
</ul>

<div id="content"></div> 
```

接下来，我更改了选择器变量以匹配 html：

```
/* Application Specific Variables */
contentSelector = '#content',
$content = $(contentSelector),
contentNode = $content.get(0),
$menu = $('#nav'),
activeClass = 'active',
activeSelector = '.active',
menuChildrenSelector = 'li', 
```

我接下来应该做的是我迷路的地方。我要做的就是加载特定于所选导航链接的 html 内容。因此，如果我单击“工作”，我想将一个 work.html 文件加载到内容部分并将 URL 更改为“mywebsite.com/work”。为了简单起见，让我们说 work.html 和所有其他 ajaxable 内容都位于同一目录中。

任何帮助是极大的赞赏！干杯!

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-07-16T22:32:24.710

因此，这是一个真实的简单示例，说明我最终如何将我正在开发的网站 ajax 化，这激发了这个问题。很抱歉耽搁了很长时间。首先是 HTML：

```
 <ul id="nav">
        <li id="home-link"><a href="home" class="ajaxify" title="Home">Home</a></li>
        <li id="work-link"><a href="work" class="ajaxify" title="Work">Work</a></li>
        <li id="labs-link"><a href="labs" class="ajaxify" title="Labs">Labs</a></li>
        <li id="blog-link"><a href="blog" class="ajaxify" title="Blog">Blog</a></li>
    </ul>

    <div id="content">Home Content</div> 
```

接下来是Javascript：

```
 <script type="text/javascript">

    var directory = 'content/'; //directory of the content we want to ajax in
    var state = History.getState();

    //for when they click on an ajax link
    $('.ajaxify').on('click', function(e){
        var $this = $(this);
        var href = $this.attr('href'); // use the href value to determine what content to ajax in
        $.ajax({
            url: directory + href + '.html', // create the necessary path for our ajax request
            dataType: 'html',
            success: function(data) {
                $('#content').html(data); // place our ajaxed content into our content area
                History.pushState(null,href, href + '.html'); // change the url and add our ajax request to our history
            }
        });
        e.preventDefault(); // we don't want the anchor tag to perform its native function
    });

    //for when they hit the back button
    $(window).on('statechange', function(){
        state = History.getState(); // find out what we previously ajaxed in
        $.ajax({
            url: directory + state.title + '.html', //create our path
            dataType: 'html',
            success: function(data) {
                $('#content').html(data);
            }
        });
    });
    </script> 
```

本质上，我所做的只是使用“ajaxify”类拦截锚标记点击，该类用于指示我想要加载哪些特定内容。一旦我拦截点击并确定要加载哪些内容，然后我使用 history.js pushSate()跟踪用户浏览网站的顺序并在不重新加载页面的情况下更改 url。如果他们决定点击后退按钮，statechange 监听器将加载正确的内容。如果他们决定点击刷新按钮，您将需要想出一种方法来使用不同的 url 名称复制索引页面。这在 php 中很容易做到，或者您可以根据需要复制、粘贴和重命名索引页面。

这是我在 Github 上发布的一个示例：[https ://github.com/eivers88/ajaxify-simple-demo](https://github.com/eivers88/ajaxify-simple-demo)

提醒一下，在本地使用 ajax 时，最好在[MAMP](http://www.mamp.info/en/index.html)或[WAMP](http://www.wampserver.com/en/)等个人 Web 服务器上运行您的项目。在没有服务器运行的情况下，此演示将在 chrome 中失败。但是，它应该在没有服务器的情况下在 Firefox 中工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:52:28.227

鉴于这些要求，您需要做很多事情。这是您可以使用的功能：

```
function doAjax(htmlpage){
$.ajax({
    url:"/"+htmlpage, 
    type: 'GET',
    success: function(data){
        $('#content').html(data)
    }
});
} 
```

解决这个问题的最简单方法是将上面的标签调整为：

```
<a href="#" onclick="doAjax('work.html');return false;"><img></a> 
```

然而，在顶部的脚本标记中使用 jquery 执行此操作会稍微更“正确”（尽管功能相同）：

```
$(function () {
    $('#buttonid1').click(function(){doAjax('work.html')});
    $('#buttonid2').click(function(){doAjax('about.html')});
    $('#buttonid3').click(function(){doAjax('contact.html')});
}); 
```

请注意，在这两种情况下，这些“work.html”页面不应该是完整的 html 文档，它们应该只是内容 div 中的内容。

这个 ajax 不会改变访问者看到的 url。要使其正常工作，您必须使用[html5 history api](http://diveintohtml5.info/history.html)。它比我上面的 ajax 请求要复杂得多。因此，如果您没有完全掌握我上面写的内容，那可能合适，也可能不合适。

# python - 在 Google App Engine 中收集键与自动索引

> ID：12486178
> 
> 赞同：0
> 
> 时间：2012-09-18T22:48:43.290
> 
> 标签：python, google-app-engine

在启用 Appstats 并分析我的应用程序后，我惊慌失措地试图弄清楚如何通过任何方式降低成本。我每个请求的大部分成本都来自查询，因此我试图尽可能地消除查询。

例如，我有一个查询，我想在某个日期 X 之后获取用户的 StatusUpdates。我使用查询来获取：`statusUpdates = StatusUpdates.query(StatusUpdates.date > X)`。

所以我认为我可能会智取系统并避免查询，但为了降低读取成本而产生更高的写入成本。我认为每次用户写入状态时，我都会将该状态的密钥存储在用户的列表属性中。因此，我不会查询，而是会做`ndb.get_multi(user.list_of_status_keys)`.

问题是，这两种方法之间的系统有什么区别？当然，我避免对第二种情况进行查询，但是这里的幕后发生了什么？我在第二种情况下正在做什么，我正在收集密钥，只是我做一个手动索引，GAE 会为我做查询？

一般来说，get_multi(keys) 和查询有什么区别？哪个更有效率？哪个成本更低？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T02:44:05.257

检查计费文档：

[https://developers.google.com/appengine/docs/billing](https://developers.google.com/appengine/docs/billing)

这很简单。读取是 $0.07/100k，smalls 是 $0.01/100k，所以你想做smalls。

一个查询是 1 次读取 + 1 次小型 / 实体 A 是 1 次读取。如果您通过查询返回超过 1 个实体，则执行查询比从键中读取实体更便宜。

查询也可能更有效。执行获取的唯一好处是它们将完全一致（而查询最终是一致的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T22:57:32.953

存储密钥不会查询，因为您无法仅使用密钥执行任何操作。您仍然需要从内存中获取状态对象。此外，由于您想查询 Status 对象的日期，因此您需要将*所有*Status 对象提取到内存中并自己比较它们的日期。如果您使用查询，appengine 将仅获取具有所需日期的状态。由于您获取的内容更少，因此您的阅读成本会更低。

[由于这与您在此处](https://stackoverflow.com/questions/12484497/should-i-optimize-around-reads-or-cpu-time-in-google-app-engine)提出的问题基本相同，因此我建议您查看我在此处给出的答案。

# java - Eclipse for Android SDK 中的 R.java 未生成

> ID：12486181
> 
> 赞同：1
> 
> 时间：2012-09-18T22:48:47.100
> 
> 标签：java, android, eclipse, ubuntu

> **可能重复：**
> [在 Eclipse 中为 Android 开发：R.java 未生成](https://stackoverflow.com/questions/2757107/developing-for-android-in-eclipse-r-java-not-generating)

我将 Ubuntu 12.04 与 Eclipse Indigo 一起使用（我下载了经典版，它在初始屏幕上弹出，所以我猜就是这样）。我正在尝试将 Android SDK 与它一起使用。我从界面下载了所有可能的 SDK，然后添加了 Eclipse 插件。我创建了一个项目来搞乱Android的东西，并且有两个错误。我修复了一个错误。另一个类似于“R.java 不存在”。我用谷歌搜索了一下，发现了其他类似的 Stack Overflow 问题。我做了一个新的，因为其他问题的所有答案都不起作用。我尝试清理工作区和项目，尝试重新安装插件和 SDK。没有任何效果。让 Eclipse 生成 R.java 有什么我缺少的吗？我也在使用 32 位版本的 Ubuntu，如果这有所不同的话。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T22:51:46.873

您实际上没有在问题中包含任何代码，因此我们无法帮助验证它是否正确。

假设您的 Java 代码是正确的，您的原因很可能是资源或`AndroidManifest.xml`文件中的错误导致`R.java`无法重新生成。要弄清楚发生了什么：

1.  在 Package Explorer 中查找资源或清单中的红色 X 标记
2.  在控制台中查找错误消息
3.  在问题视图中查看错误消息

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:54:20.253

试试下面的方法看看是否有帮助

*   右键单击项目
*   选择安卓工具
*   选择修复项目属性

# php - 删除子域 cookie

> ID：12486182
> 
> 赞同：0
> 
> 时间：2012-09-18T22:48:48.527
> 
> 标签：php, cookies

我目前正在运行此设置，其中网站在 site.domain.tld 上运行，后端在 admin.site.domain.tld 上运行

将在 sso.admin.site.domain.tld 安装一个有点 SSOish 的系统。事实上，当访问该站点时，用户已通过身份验证，设置了相应的 cookie，并且用户被移回 admin.site.domain.tld。

当我设置这样的cookie时

```
setcookie('bid', $bid, 0, '/', 'admin.site.domain.tld'); 
```

我将获得一个为 .admin.site.domain.tld 发布的 cookie cookie（注意点）。

这样的登录工作正常，但如果用户出于某种原因首先访问 admin.site.domain.tld，然后决定使用 sso[...] 登录，我们就会遇到问题：adminpage 为自己设置了一个 cookie - 但这次是为 admin.site.domain.tld 发布的 - 开头没有点。

所以基本上在这次使用 sso-login 之后，用户最终拥有两个不同的 cookie，一个用于 admin.site.domain.tld，一个用于 .admin.site.domain.tld

因为管理页面更喜欢直接为页面本身设置的 cookie，所以点 cookie 被忽略并且登录失败。

所以基本上最好的方法是读取、修改或删除已经存在的 cookie，但这在 sso 子域中似乎是不可能的。

“由于某些原因”，我们无法将 sso-subdomain 中的内容直接放在 admin-subdomain 上。

任何有想法的人，我能做些什么来摆脱那些“坏”的admin.-cookies？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:16:39.370

是否可以使用不同的 cookie 名称？您有一个读取和写入“cookie1”的子域，然后有另一个读取和写入“cookie2”的子域。这能解决你的问题吗？

# sql-server-2008 - 列出超过总和阈值的交易

> ID：12486183
> 
> 赞同：1
> 
> 时间：2012-09-18T22:48:49.103
> 
> 标签：sql-server-2008

我在一家信用卡公司工作。我们的数据库有一个客户表和一个交易表。客户表中的字段是 SSN 和 CustomerKey。交易表中的字段是 CustomerKey、交易日期 (Transdate) 和交易金额 (TransAmt)。

我需要一份报告，可以列出每个 ssn 的每笔交易，其中交易金额的总和在 2012 年的两天内 > 1000。

以下是交易表中原始数据的示例：

```
Trans#-----CustKey-----Date--------Amount
1-----------12345----01/01/12--------$600
2-----------12345----01/02/12--------$500
3-----------67890----01/03/12--------$700
4-----------12345----04/01/12--------$600
5-----------67890----04/02/12--------$600 
```

以下是客户表中原始数据的示例：

```
CustKey-----SSN
12345------123456789
67890------123456789 
```

这是我需要的结果：

```
Trans#------SSN---------Date---------Amount---Group Key
1--------123456789----01/01/12---------$600--------1
2--------123456789----01/02/12---------$500--------1 
2--------123456789----01/02/12---------$500--------2 
3--------123456789----01/03/12---------$700--------2
4--------123456789----04/01/12---------$600--------3
5--------123456789-----04/02/12--------$600--------3 
```

正如您在我的结果中看到的那样，Trans#2 被列出两次，因为它是一组在 2 天内超过 1000 美元的交易的一部分。每组超过 1000 的事务由一个组密钥标识。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T01:18:04.307

假设您没有领先/滞后功能，我的方法如下。

首先，确定符合您标准的日期对。您可以通过自联接来执行此操作，以查找符合您条件的日期对的交易。现在，您有了日期的描述，但这些日期在一行而不是两行。

因此，您需要将其加入到交易中。第一次约会，第二次约会。如果满足多个条件，这种双重连接（实际上是左外连接）将允许事务出现多次。

这是一个尝试这样做的查询：

```
with pairs as
     (select t.trans, t.ssn, min(date) as mindate, max(date) as maxdate
      from (select t.*, c.ssn
            from transaction t join
                 customer c
                 on t.custkey = c.custkey
           ) t join
           (select t.*, c.ssn
            from transaction t join
                 customer c
                 on t.custkey = c.custkey
           ) tnext
           on t.ssn= tnext.ssn and
              t.date = tnext.date - 1
      group by t.trans, t.ssn, t.amount
      having sum(t.amount) > 1000
     ) pairs
select t.trans, c.ssn
from transactions t. join
     customer c
     on t.custkey = c.custkey left outer join
     pairs pfirst
     on t.date = pfirst.mindate and
        c.custkey = pfirst.custkey left outer join
     pairs plast
     on t.date = plast.maxdate and
        c.custkey = plast.custkey 
```

# linq - 复杂的 EF 图 linq 连接

> ID：12486191
> 
> 赞同：1
> 
> 时间：2012-09-18T22:49:42.460
> 
> 标签：linq, entity-framework

![实体模型](../Images/dbaeb09f6f4f000dcf0618e4d96347bb.png)

所以，这就是我的模型.. 又好又复杂。

**我正在寻找通过用户 ID 获取区域。**如果我在 SQL 中执行此操作，我会一直执行一系列连接到用户表。您将如何在 LINQ 查询语法或方法链接中执行此操作？

反过来，我可以很直接地做到这一点，但是我必须做很多额外的工作才能使结果图变平，而且还需要拉回中间的所有实体。

如果我可以选择包括 AreasPermissions 和 Permissions，那将是 gravy .. 但在这一点上，我不介意额外的查询来获取这些。

我浮动的另一个选项是使用函数导入到 sproc 并将其映射到 Area .. 但是当我开始需要包含其他实体时，它会使该选项不那么优雅。我也试图避免使用 sprocs*只是为了使用 sprocs*，因为它总是与人们一起滑坡..“将 sproc 用于一件事”往往会变成“不要将 EF（表访问）用于任何事情”。

```
var userByID = new Func<User, bool>(x => x.UserId.Equals(userID, StringComparison.InvariantCultureIgnoreCase));
var user = this._context.Users
    .Include("TeamsUsers.Team.TeamsRoles.Role.RolesAreasPermissions.AreaPermission.Area")
    .Include("TeamsUsers.Team.TeamsRoles.Role.RolesAreasPermissions.AreaPermission.Permission")
    .Single(userByID); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:34:31.997

我无法对此进行测试，但我认为它应该可以工作：

```
var result = 
    from user in _context.Users
    where user.Id == userId
    from teamUser in user.TeamUsers
    from teamRole in teamUser.Team.TeamRoles
    from roleAreaPermission in teamRole.Role.RoleAreaPermissions
    select roleAreaPermission.AreaPermission.Area; 
```

# javascript - 使用颜色选择器 jquery 更改图像的颜色

> ID：12486196
> 
> 赞同：-1
> 
> 时间：2012-09-18T22:50:07.680
> 
> 标签：javascript, jquery

我目前需要一些帮助，我正在使用 [Jquery Minicolors 颜色选择器][1]，我想实现这个 png 颜色选择器透明度到 png 图像基本上是彩色 png 图像而不单击按钮预览来应用它基本上我想将它包含在jquery Minicolors 插件我自己做了一个演示，但我自己不是很了解我需要帮助..

让我尽可能让自己清楚，我想做的是建立Jquery Minicolors颜色框来自动更改而不需要单击预览按钮来更改颜色，我想实现更改颜色png图像透明度到jQuery Minicolors。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T22:56:22.100

侦听颜色选择器的**更改事件并在回调期间应用更改。**

初始化颜色选择器时，提供修改图像的更改回调。

```
$("pickerElement").miniColors({
  change: function(hex, rgb) {
    // use the values above to manipulate image.
  }
}) 
```

每次更改颜色时都会调用此函数。

# c# - 我的单词搜索程序中的 System.ArgumentOutOfRangeException

> ID：12486203
> 
> 赞同：1
> 
> 时间：2012-09-18T22:50:56.013
> 
> 标签：c#

我不明白这里出了什么问题。有人可以解释一下吗？

```
using System;

public class Test
{
        public static void Main()
        {
                int bobo = 0;
                string result = "";
                string bob;
                string search = Console.ReadLine();
                string words = Console.ReadLine();
                string first = words.Substring(0,1);
                string second = words.Substring(1,2);
                string third = words.Substring(2,3);
                for(int i = 0;i<searchc.Length;i++)
                {
                        bobo++;
                        bob = search.Substring(bobo,bobo+2);    
                        if(bob == first)
                        {
                                result += bob.ToUpper();
                        }
                }

                Console.WriteLine(result);
        }
} 
```

我看到的错误信息是：

```
Unhandled Exception: System.ArgumentOutOfRangeException: startIndex + length > this.length
Parameter name: length
  at System.String.Substring (Int32 startIndex, Int32 length) [0x00000] in <filename unknown>:0 
  at Test.Main () [0x00000] in <filename unknown>:0 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T22:53:21.973

我害怕帮助你 bc 你的 alg。看起来有缺陷。

我会首先添加一个检查以确保长度> 2，然后以下逻辑应该会有所帮助。

将 bobo 更改为 i 并将您的 for 循环更新为`for(int i = 0;i<searchc.Length-1;i++)`

例如

```
bob = search.Substring(i,i+1); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T02:43:32.327

我会考虑为你的“单词”对象做一个 string.Split() 。

这将取决于输入的格式，但例如：

单词：'word1 word2 word3'

您可以执行以下操作：

```
var words = Console.ReadLine().Split(new[] {' '}, StringSplitOptions.RemoveEmptyEntries); 
```

如果您的“单词”只是一个字符列表，那么我将首先通过更好地命名您的字符串来使您的代码更清晰。很难理解您要使用提供的示例做什么。但这是我会做的。

```
 var result = string.Empty;

        var search = Console.ReadLine();
        var words = Console.ReadLine();
        var first = words.Substring(0, 1);
        for (int i = 0; i < search.Length; i++)
        {
            if (i + 1 > search.Length) break;
            var bob = search.Substring(i, i + 2);

            if (bob == first)
                result += bob.ToUpper();
        }

        Console.WriteLine(result); 
```

如果您在句子中搜索单词列表，请尝试以下操作：

```
 var result = new System.Text.StringBuilder();

        var search = Console.ReadLine();
        var words = Console.ReadLine().Split(new[] {' '}, StringSplitOptions.RemoveEmptyEntries);

        foreach (var word in words)
        {
            if (search.Contains(word))
                result.Append(string.Format("{0},", word));
        }

        Console.WriteLine(result.ToString()); 
```

希望能帮助到你。

# git - Git 开发到生产设置

> ID：12486207
> 
> 赞同：3
> 
> 时间：2012-09-18T22:51:20.877
> 
> 标签：git, repository

我知道这样的问题被问了很多。但是，我没有找到我的问题的确切答案。我正在开始使用 Git。我之前没有使用 Git 或任何类型的版本控制的经验。到目前为止，我已经能够毫无问题地在本地启动并运行它。我可以通过终端使用 Git，而且我也开始修改 SourceTree 应用程序。

当我尝试远程设置时，我的问题就出现了。我在服务器上安装了 Git。我在远程登台服务器上创建了一个存储库。我可以通过 SourceTree 推动它。但是，远程存储库似乎没有连接到 Web 根目录。我在本地对分支进行更改，提交，合并，然后推送到远程。但是，这些更改不在通过登台服务器提供的页面上？

在遥控器上，我在我的 Web 根目录之外创建了一个目录来保存存储库项目。我在其中创建了一个名为 mygit.git 的子目录。这是我使用 git init --bare 创建远程存储库的地方。这应该创建一个没有直接工作的回购，我可以推送。

这是我正在使用的环境

```
Production (remote server)
^
Staging (remote server)
^
Development (local) 
```

所以，我的问题是：

1.  为什么 Web 服务器不显示通过本地推送所做的更改
2.  我是否应该在我的生产服务器上也有存储库，以便所有更改都会冒泡？
3.  我做这一切都错了吗？

感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T06:30:38.980

A bare git repo has no working tree (ie no files).
So your web root won't be changed by a push to a bare repo.

However, you can add to that bare repo a `post-receive` hook which will checkout the content of that bare repo to your web root, updating its file.

There are various examples illustrating that technique: for instance "[git GIT_WORK_TREE post-receive hook deployment remote](https://stackoverflow.com/questions/8122543/git-git-work-tree-post-receive-hook-deployment-remote)".

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T15:44:32.270

VonC 的回答是正确的。除了 VonC 提供的链接之外，我还发现了这个链接[http://toroid.org/ams/git-website-howto 。](http://toroid.org/ams/git-website-howto)我将简单介绍一下我所做的工作，以使事情与此链接一起工作。我提供的链接中的信息最后一次更新是 2010 年 11 月 17 日，但它仍然有效。这绝不是详尽无遗的，因为我确信还有许多其他方法可以进行设置。我没有很多服务器或 Unix 命令经验，所以这个解释是从这个角度来的。

重要的第一步是您需要与远程服务器建立 SSH 连接以运行以下命令或从服务器本身的命令行运行。我不会在这里讨论它，因为它是单独的主题，我在网上找到了许多资源来帮助解决这个问题。

首先确保在本地机器和远程服务器上安装了 Git。那里的大多数操作方法都解释了这一点，并且很容易完成。[http://www.git-scm.com](http://www.git-scm.com)是我为本地机器下载安装程序的地方。该站点还包含有关如何在远程服务器上安装的信息。

还有一件事要注意。我正在为我的本地机器使用运行 MAMP 的 mac，而我的远程服务器是 Ubuntu Linux 10.04.1。

**第 1 步 - 设置本地存储库**

这可以通过多种方式完成。通过命令行或通过诸如 SourceTree、Tower、GitX 等 Git 应用程序。我使用了一个应用程序，因为这就是我计划使用 Git 的方式。

**第 2 步 - 设置远程存储库**

```
$ mkdir website.git && cd website.git
$ git init --bare 
```

第 1 行 - 在远程计算机上创建一个目录并更改该目录

第 2 行 - 在 website.git 目录中创建裸存储库。请记住，website.git 可以是您希望使用 .git 扩展名的任何名称。请参阅 VonC 对裸存储库的描述。

**第 3 步 - 这是给我最麻烦的一步**

```
$ mkdir /var/www/www.example.org
$ cat > hooks/post-receive
#!/bin/sh
GIT_WORK_TREE=/path/to/web/root git checkout -f
$ chmod +x hooks/post-receive 
```

第 1 行 - 这只是创建一个目录，该目录将成为您的 Web 根目录。如果您已经为 Web 服务器根目录设置了目录，则可能不需要执行此操作。如果您已经有 Web 根集，请跳过此步骤。

第 2-4 行 - 这是我的第一个障碍。此命令将向您显示文件 post-recieve 包含的内容。您可以 ftp 到远程服务器上的此文件或从命令行编辑。我最终只是在我的文本编辑器中编辑并通过 ftp 将其保存回服务器。对我来说更容易。该文件可以在您在步骤 2 中创建的目录 website.git/hooks/post-receeive.sample 中找到。

您还会注意到文件实际名称的末尾有 .sample。您将需要重命名它而无需扩展名。这将基本上打开钩子。新文件名应该只是 post-receive

打开文件，您应该会找到以下文本。

```
#!/bin/sh
#
# An example hook script for the "post-receive" event.
#
# The "post-receive" script is run after receive-pack has accepted a pack
# and the repository has been updated.  It is passed arguments in through
# stdin in the form
#  <oldrev> <newrev> <refname>
# For example:
#  aa453216d1b3e49e7f6f98441fa56946ddcd6a20 68f7abf4e6f922807889f52bc043ecd31b79f814 refs/heads/master
#
# see contrib/hooks/ for a sample, or uncomment the next line and
# rename the file to "post-receive".

#. /usr/share/doc/git-core/contrib/hooks/post-receive-email 
```

这些行已被注释掉，因此它们不会伤害任何东西。您可以删除这些行或离开并在注释行下方添加以下内容。完成后将文件保存回远程服务器。

```
#!/bin/sh
GIT_WORK_TREE=/path/to/web/root git checkout -f 
```

第 5 行 - 这将确保接收后文件的文件权限在服务器上是可执行的。这是一个让我们确定的步骤，这样事情就不会在以后中断。

**第 4 步 - 添加远程并推送本地主机**

这一步可以通过命令行或我之前提到的 Git 应用程序之一来完成。我使用其中一个应用程序。对我来说，这更容易，就像我说的那样，我是服务器和 unix 命令的新手。好处是您可以同时使用应用程序和命令行。一切都记录到 git 存储库中，两者都会看到相同的内容。使用你最舒服的任何东西。大多数人会告诉您学习一些基本的命令行内容，这不是一个坏主意。

**第 5 步 - 在本地计算机上创建分支。**

当您对更改感到满意时，将它们合并到您的主分支并将它们推送到您的远程。您的网站现在将更新，并且应该反映您添加的任何新更改。

而已。这就是让我启动并运行的原因。希望这会有所帮助，并且我所写的内容没有太多错误。

# c# - 从源代码在 C# 中创建文件

> ID：12486212
> 
> 赞同：0
> 
> 时间：2012-09-18T22:51:47.253
> 
> 标签：c#, .net, file

我正在寻找一种从源代码创建文件的方法（当您在例如记事本中打开文件时，它会为您提供一些代码，我想使用该代码重新创建文件，通过说明文件类型和文件名，然后应该在文件中的代码。

我希望你能理解我的问题，这有点难以解释，我会再去......

我有我想要创建的文件的源代码 + 文件名 + 文件类型 + 文件描述。> 现在我希望 C# 根据该信息创建一个文件，并使其成为该信息来源的精确副本。它应该保存文件，然后文件可以打开。

提前谢谢你，迈克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T23:06:25.490

将“代码”写入文件 mycode.cs

```
string code = "code";
string filename = "mycode";
string filetype = "cs";
using (FileStream fs = File.Create(filename+"."+filetype))
{
    Byte[] info = new UTF8Encoding(true).GetBytes(code);
    fs.Write(info, 0, info.Length);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-18T22:55:09.370

你可以只使用[File.Copy](http://msdn.microsoft.com/en-us/library/c6cfw35a%28v=vs.100%29.aspx)方法吗？

```
file.Copy("c:\temp\source.txt", "c:\temp\dest.txt"); 
```

# forms - 表单输入，查看然后更新

> ID：12486213
> 
> 赞同：0
> 
> 时间：2012-09-18T22:51:51.287
> 
> 标签：forms, coldfusion

我正在创建一个表单，用户将在其中输入数据，然后单击“查看”以查看他们输入的数据。然后在审查后，“保存”记录。

我正在使用 a`<cfform>`提交表单，但想知道如何从“评论”页面将数据提交到数据库，因为这里没有表单。

我是否应该设置`FORM.Name = VARIABLES.Name`要在评论页面上显示的变量，然后在提交“保存”后将它们转换回来？

不太确定在这里做什么。想太多？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T06:00:23.453

保持在表单范围内。表单值的基本输出，使用在 form.fieldList 中烘焙：

```
<cfloop list="#form.fieldList#" item="fieldName">

    <cfoutput>
        #fieldName#: #form[fieldName]#<br>
        <input type="hidden" name="#fieldName#" value="#form[fieldName]#">
    </cfoutput>

</cfloop> 
```

链接到原始表单或提交到您保存它的页面，使用隐藏字段中的值（应反映原始表单值）

您可以通过其他一些方法来做到这一点，但这对我来说似乎最简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-18T23:18:12.383

为什么不在评论页面使用带有隐藏输入字段的第二个表单？确认将是向将数据保存到服务器的页面的提交按钮。第二种可能性（不太合适）：将数据直接保存到数据库中并从那里加载以供审查。技巧：使用带有“已确认”的标志并在确认时设置它。不好的部分是：您必须清理尚未确认的旧数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-28T22:53:30.560

改进比利克雷文斯的答案。这可以防止具有嵌入式攻击的字段

```
<cfoutput>
    #lcase(fieldName)#: #xmlFormat(form[fieldName])#<br>
    <input type="hidden" name="#fieldName#" value="#xmlFormat(form[fieldName])#" />
</cfoutput> 
```

这也不适用于图像上传。lcase(fieldName) 是为了防止字段显示为全部大写。小写通常更容易阅读。

# tsql - 如果多个存储过程正在创建具有相同名称的临时表，我如何知道要删除哪个临时表？

> ID：12486215
> 
> 赞同：0
> 
> 时间：2012-09-18T22:51:54.797
> 
> 标签：tsql, stored-procedures, temp-tables

我一直试图弄清楚这一天:( ...

我有几个存储过程（在同一个数据库以及不同的数据库中）做同样的事情。

1.  创建名为 X 的临时表。
2.  使用 X 进行处理。
3.  掉落 X。

问题是这些存储过程正在创建具有相同名称的临时表。如果它们都具有名称并且我不能使用“LIKE”真正删除因为临时表可能正在被不同的存储过程使用，我如何知道一旦我完成处理后要删除哪个临时表？

这是一个场景。

SP1 开始 -

1.  创建临时表。...在它继续之前，会发生这种情况：

SP2 即将结束

1.  删除临时表。

如果发生上述情况，SP1 就会出现问题。如“临时表不存在”

我如何绕过这个问题？

当我要删除临时表时，我需要确保删除与创建它的存储过程相关的表。这甚至可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T22:58:28.663

您正在尝试解决您没有的问题。只是放下桌子。如果您查看 SSMS，您将真正拥有独特的表格。SP 知道要丢弃哪一个。

如果 SP1 和 SP2 使用同一个表，您将遇到更多问题，而不仅仅是删除。

```
 IF OBJECT_ID(N'tempdb..#Temp', N'U') IS NOT NULL DROP TABLE #Temp
  CREATE TABLE #Temp (sID INT PRIMARY KEY CLUSTERED);
  -- look in SSMS and you will see #temp appended
  -- use #temp  
  IF OBJECT_ID(N'tempdb..#Temp', N'U') IS NOT NULL DROP TABLE #Temp 
```

在 SP 中，您甚至不确定是否需要放弃。我认为它会自动删除。

但是，如果您运行前两行并查看 SSMS，您会发现您有自己的#TEMP - 而不是共享的#TEMP。运行最后一行，你会看到它消失了。

# node.js - 如何将临时的 html 和 js 块发送到 node.js 上正在运行的应用程序

> ID：12486219
> 
> 赞同：0
> 
> 时间：2012-09-18T22:52:22.113
> 
> 标签：node.js, express

我刚刚在 Node.js 上启动并运行了我的第一个应用程序。到目前为止，它只是提供一个静态文件。但我有一些想法将在未来实施，所以我将继续进行 Node 设置，以便到那时我会做好准备。

```
// get modules
var express = require('express');
var fs = require('fs');

// create app instance
var app = express();

// static files middleware
app.use("/assets", express.static(__dirname + '/assets'));

// main route
app.get('/', function(req, res) {
    var html = fs.readFileSync('assets/views/main.html', 'utf8');
    res.send(html);
});

// make web server listen on specific port
app.listen(8080); 
```

注意：我意识到我不需要 Express 来提供一条路线，但我想在这方面抢占先机有什么害处？！:)

我的第一个想法是想办法让所有当前使用该应用程序的用户知道已经有更新并且他们必须刷新他们的浏览器。无需保存应用程序的当前状态，因为它非常基本。

因此，如果我是用户，我正在使用该应用程序和繁荣，我会收到一个非常小的模态窗口警报通知，让我知道我需要刷新。

此外，如果某些用户在我发送警报之后加载应用程序，则该用户根本不应该看到警报（因为他们应该已经看到了新的更改）。

我已经对该主题进行了一些谷歌搜索，但我对找到的示例不满意。我不认为我想更新一个notifications.xml 文件（node.js 将被监视）来推送一个新的通知。

我能想到的一种解决方案是创建一个可以从命令行执行的命令，该命令将（以某种方式）向应用程序发送新通知。也许使用像 Grunt.js 这样的东西（我不确定它是否适合这个，因为我从未使用过它）。基本上，一旦发送通知，它的所有痕迹都应该消失。这就是为什么我认为命令行方法会很好。

这是我的问题：（一般来说）我应该如何实现这样的东西？我是 Node.js 新手，但我对 javascript 和命令行非常熟悉。

请随时提供您认为对我更好的任何替代解决方案（命令行方法除外），或您认为可以帮助我的任何工具。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:05:59.340

如果您想将更新推送到 Web 客户端，一种方法是使用[Socket.io 之](http://socket.io)类的东西。这会在客户端和服务器之间创建一个双向管道，您可以使用它来异步推送更新。

示例服务器：

```
var app = require('express').createServer()
  , io = require('socket.io').listen(app);

app.listen(80);

app.get('/', function (req, res) {
  res.sendfile(__dirname + '/index.html');
});

io.sockets.on('connection', function (socket) {
  socket.emit('news', { hello: 'world' });
  socket.on('my other event', function (data) {
    console.log(data);
  });
}); 
```

示例客户端：

```
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io.connect('http://localhost');
  socket.on('news', function (data) {
    alert('New news has come in! Please refresh your page!');
    socket.emit('my other event', { my: 'data' });
  });
</script> 
```

另一种选择是使用 Javascript 从客户端轮询以主动查找更新。您需要在服务器上为每个客户端保留一些状态，以确定该客户端是否需要更新。然后，客户端将在某个计时器间隔（例如，每秒一次）向辅助路由发出 get 请求，服务器将回复“是的，您需要更新”或“不，您不需要更新” . 如果是，则客户端 Javascript 会弹出您的模式框并告诉用户刷新。

# python - 如何根据操作系统版本使用 python 遍历目录？

> ID：12486223
> 
> 赞同：0
> 
> 时间：2012-09-18T22:52:44.757
> 
> 标签：python

我正在尝试将存储在列表中的文件与位于可能是 W2K3 或 W2K8 的服务器上的同一文件进行比较。我正在尝试对此使用单个函数，但我被困在这个 if 语句中。我试图弄清楚如何将正确的目录路径放入`os.walk():`

```
 if osVer == 'serverW2k3':
        continue
    elif osVer == 'serverW2k8':
        for folder, subfolders, files in os.walk(): 
```

我之前确实有这个工作，但有重复的行，所以我想简化代码。这是完整的课程：

```
class checkstatus:
    def __init__(self):
        print 'Checking Status...'
        chkbkpstats = csv.reader(file('c://temp//networkerservers.csv'))

        srvrs = []
        for row in chkbkpstats:
            srvrs.append({'Name' : row[0], 'Instance' : row[1]})

        for srvr in srvrs:
            srvrName = (srvr['Name'])
            srvrInst = (srvr['Instance'])
            w2k3Chk = r'\\%s\d$\DA$Utils\log\networker' % srvrName
            w2k8Chk = r'\\%s\c$\ProgramData\SQL\DA$Utils\log\networker' % srvrName

            try:
                c = wmi.WMI(srvr['Name'])

            except:
                print 'Error connecting to %s to check OS version' % srvrName

            else:
                osVer = c.Win32_OperatingSystem()[0].Caption
                if '2003' in osVer:
                    return 'serverW2k3'
                    #self.fileCheck(w2k3Chk, w2k8Chk, srvrInst, srvrName)

                elif '2008' in osVer:
                    return 'serverW2k8'
                    #self.fileCheck(w2k3Chk, w2k8Chk, srvrInst, srvrName)

    def fileCheck(self, w2k3Chk, w2k8Chk, srvrInst, srvrName, osVer):
        found = False
        if osVer == 'serverW2k3':
            continue
        elif osVer == 'serverW2k8':
            for folder, subfolders, files in os.walk():
                for sqlFile in files:
                    if sqlFile == srvrInst + ".log":
                        found = True
                        print 'The Backup For %s on %s Still Running' % (srvrInst, srvrName)
                    elif sqlFile == (srvrInst + ".ok"):
                        found = True
                        print 'The Backup For %s on %s Completed Successfully' % (srvrInst, srvrName)
                    elif sqlFile == (srvrInst + ".err"):
                        found = True
                        print 'The Backup For %s on %s Has Failed' % (srvrInst, srvrName)
                if not found:
                    print 'No file for %s found on %s' % (srvrInst, srvrName) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:09:24.257

你的问题有点不清楚，你的示例代码显然不是你的真实代码（你不能在没有参数的情况下调用 os.walk），但我想我可以猜到你在追求什么。

首先，`fileCheck`像这样改变：

```
def fileCheck(self, path, srvrInst, srvrName):
    found = False
    for folder, subfolders, files in os.walk(path):
        ... 
```

现在，在 中`__init__`，像这样执行最后一部分：

```
else:
    osVer = c.Win32_OperatingSystem()[0].Caption
    if '2003' in osVer:
        self.fileCheck(w2k3Chk, srvrInst, srvrName)
    else:
        self.fileCheck(w2k8Chk, srvrInst, srvrName) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T13:57:37.980

这是我更新的功能代码的片段。

```
 else:
            osVer = c.Win32_OperatingSystem()[0].Caption
            if '2003' in osVer:
                self.fileCheck(srvrInst, srvrName, osVer, w2k3Chk, w2k8Chk)

            elif '2008' in osVer:
                self.fileCheck(srvrInst, srvrName, osVer, w2k3Chk, w2k8Chk)

def fileCheck(self, srvrInst, srvrName, osVer, w2k3Chk, w2k8Chk):
    found = False
    if '2003' in osVer:
        path = w2k3Chk
    elif '2008' in osVer:
        path = w2k8Chk
    for folder, subfolders, files in os.walk(path): 
```

# jquery - history.js 混乱

> ID：12486224
> 
> 赞同：1
> 
> 时间：2012-09-18T22:52:49.247
> 
> 标签：jquery, ajax, history.js

我对 AJAX 和 history.js 完全陌生。我想创建一个使用 AJAX 在单击导航项时更改内容区域的基本站点，保留后退按钮功能并允许用户输入直接 URL，例如 mysite.com/page2，并拥有它在内容区域中加载 page2。

我不知道我在做什么，但 history.js（[如这里所示](https://github.com/browserstate/ajaxify)）看起来像我需要的。在测试它时，我不知道从这里去哪里。非常感谢任何帮助！

--编辑的jQuery脚本

```
<html>
<head>
    <title>test page</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <!-- jQuery ScrollTo Plugin -->
    <script defer src="http://balupton.github.com/jquery-scrollto/scripts/jquery.scrollto.min.js"></script>
    <!-- History.js --> 
    <script defer src="http://balupton.github.com/history.js/scripts/bundled/html4+html5/jquery.history.js"></script>
    <!-- This Gist -->
    <script defer src="http://gist.github.com/raw/854622/ajaxify-html5.js"></script>  

    <script type="text/javascript">
        $(window).bind("statechange", function(e) {
            var State = window.History.getState();
            if (window.console && window.console.log) {
                console.log("popstate", State, window.location.href);
            }
            $("#changehere").text(typeof State.data.changehere !== 'undefined' ? State.data.changehere : State.url);
            $('.nav').click(function() {
                alert(this);
                window.History.pushState({changehere:this}, this + 'title', '?' + this);
            })
        })
    </script>
    <style type="text/css">
        #one {
            height: 300px;
            width: 1000px;
            background: #a0a0a0;
        }
    </style>
</head>

<body>

    <div id="one">
        <a href="xml/first.html" id="first">change1</a>
        <a href="xml/second.html" id="second">change2</a>
        <a href="xml/third.html" id="third">change3</a>
    </div>
    <div id="changehere">
        start
    </div>

</body> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-06-11T10:43:28.423

您需要拦截对相关链接的所有点击，并为每次点击调用 History.pushState。请参阅[https://github.com/browserstate/ajaxify](https://github.com/browserstate/ajaxify)。

相关部分是：

```
 $.fn.ajaxify = function(){
        // Prepare
        var $this = $(this);

        // Ajaxify
        $this.find('a:internal:not(.no-ajaxy)').click(function(event){

            // Prepare
            var
                $this = $(this),
                url = $this.attr('href'),
                title = $this.attr('title')||null;

            // Continue as normal for cmd clicks etc
            if ( event.which == 2 || event.metaKey ) { return true; }

            // Ajaxify this link
            History.pushState(null,title,url);
            event.preventDefault();
            return false;
        });

        // Chain
        return $this;
    }; 
```

# sql - SQL -- 向现有查询中的结果行添加约束

> ID：12486226
> 
> 赞同：0
> 
> 时间：2012-09-18T22:53:01.883
> 
> 标签：sql, oracle

以下查询给了我一个单行结果

```
Select Sum(Actions) From
(
    Select
        Count(t.Create_Dtime) As Actions
    From Player_Tapjoy T 
           Inner Join Player_Source S 
               On (T.Player_Id = S.Player_Id)
           Inner Join Feature_Group_Xref F
          On (S.Group_Id=F.Group_Id 
              And F.Feature_Name ='Try     BC') 
     Where Trunc(t.Create_Dtime) = To_Date('2012-sep-17','yyyy-mon-dd')
     Union All
     Select 
         Count(a.Create_Dtime) As Actions
     From Player_Aux_Pt A 
         Inner Join Player_Source S  
              On (A.Player_Id = S.Player_Id)
         Inner Join Feature_Group_Xref F
          On (S.Group_Id=F.Group_Id 
               and f.feature_name =     'TryBC')
    Where A.Site = 'AppCircle' 
    And Trunc(A.Create_Dtime) = To_Date('2012-sep-17','yyyy-mon-dd')
 ) 
```

我现在想在结果中添加一个约束：仅在 2012 年 9 月 12 日之前创建帐户的用户。

在我的数据库语言中：只有具有`trunc(create_dtime) < To_Date('2012-sep-12','yyyy-mon-dd')`. 这个`trunc(create_dtime)`日期来自`player`表格。

我可以`player`通过使用另一个内部联接将此表映射到当前表吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T09:08:18.370

您的要求并不完全清楚，显然我不得不猜测您的数据模型。我假设该`Player`表每行有一行，`Player_Id`即它是与您正在查询的表的外键关系的主键端。

我已经更改了内部查询，因此它只返回一组行而不是聚合。然后我将内联视图（别名`q`）与`Player`表连接起来，并使用 COUNT() 而不是 SUM() 来获取图形。

```
Select count(Player_Id) From
(
    Select
        T.Player_Id
    From Player_Tapjoy T 
           Inner Join Player_Source S 
               On (T.Player_Id = S.Player_Id)
           Inner Join Feature_Group_Xref F
          On (S.Group_Id=F.Group_Id 
              And F.Feature_Name ='Try     BC') 
     Where Trunc(t.Create_Dtime) = To_Date('2012-sep-17','yyyy-mon-dd')
     Union All
     Select 
         A.Player_Id 
     From Player_Aux_Pt A 
         Inner Join Player_Source S  
              On (A.Player_Id = S.Player_Id)
         Inner Join Feature_Group_Xref F
          On (S.Group_Id=F.Group_Id 
               and f.feature_name =     'TryBC')
    Where A.Site = 'AppCircle' 
    And Trunc(A.Create_Dtime) = To_Date('2012-sep-17','yyyy-mon-dd')
 ) q
 join player p
      on (p.Player_Id = q.Player_Id)
 where Trunc(p.Create_Dtime) < To_Date('2012-sep-12','yyyy-mon-dd') 
```

由于我在顶部给出的原因，这可能不是您需要的确切结果，但它应该为您指明正确的方向。

# svg - 如何使用 ImageMagick 将 SVG 图像转换为 32 位 RGBA？

> ID：12486231
> 
> 赞同：2
> 
> 时间：2012-09-18T22:53:28.743
> 
> 标签：svg, imagemagick, rgba

如何使用 ImageMagick 将 SVG 图像转换为 32 位 RGBA？

背景必须是透明的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T05:38:17.133

只需尝试以下命令：

```
 convert  in.svg  -transparent white  out.png 
```

（假设原始 SVG 使用透明或白色背景。否则，如果 SVG 背景是红色或蓝色或 '#235689'：使用`-transparent red`,`-transparent blue`或`-transparent '#235689'`....）

如果您的 ImageMagick 版本不正确，请检查是否在和行中`convert -list configure | grep svg`显示`rsvg`输出。`DELEGATES``CONFIGURE`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-02T19:12:41.143

我发现将背景设置为*无*对我有用：

```
convert -background none in.svg out.png 
```

# ruby-on-rails - heroku 错误未初始化常量 User::FriendlyId

> ID：12486233
> 
> 赞同：0
> 
> 时间：2012-09-18T22:53:40.263
> 
> 标签：ruby-on-rails, heroku, devise, friendly-id

我在heroku上有一个奇怪的问题，这是我得到的错误：

我正在使用 rails 3.2.8，ruby 1.9.3，具有活跃的管理员，友好的 id！

```
/app/app/models/user.rb:2:in `<class:User>': uninitialized constant User::FriendlyId (NameError) 
```

在我的本地环境中，也使用 postgres，一切正常......

这是我的用户模型

```
class User < ActiveRecord::Base
  extend FriendlyId
  after_initialize :set_username
  before_create :set_as_student

  friendly_id :username, use: :slugged

  ROLES = %w[admin coordinator student]

  # Include default devise modules. Others available are:
  # :token_authenticatable, :confirmable,
  # :lockable, :timeoutable and :omniauthable
  devise :database_authenticatable, :registerable,
         :recoverable, :rememberable, :trackable, :validatable

  # Setup accessible (or protected) attributes for your model
  # attr_accessible :title, :body
  attr_accessible :email, :password, :password_confirmation, :remember_me,
                  :name, :code, :phone, :roles

  def roles=(roles)
    self.roles_mask = (roles & ROLES).map { |r| 2**ROLES.index(r) }.inject(0, :+)
  end

  def roles
    ROLES.reject do |r|
      ((roles_mask || 0) & 2**ROLES.index(r)).zero?
    end
  end

  def role?(role)
    roles.include? role.to_s
  end

  def self.search(query)
    where do
      ((name =~ "%#{query}%") | (code =~ "%#{query}%"))
    end
  end

  def should_generate_new_friendly_id?
    new_record?
  end

  private
  def set_username
    self.username = self.email.split('@')[0]
  end

  def set_as_student
    self.roles=(['student'])
  end

end 
```

我相信它必须与friendly_id 做一些事情，但我不知道出了什么问题，非常感谢您的帮助！

谢谢你们。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T22:48:23.130

您需要在 Gemfile 中包含 :assets 等组中的friendly_id ，否则在生产模式下（在没有资产组的情况下运行）找不到它。

在[https://github.com/norman/friendly_id/issues/326调试过](https://github.com/norman/friendly_id/issues/326)

# android - facebook，来自 Graph API 的自定义帖子

> ID：12486234
> 
> 赞同：2
> 
> 时间：2012-09-18T22:53:42.330
> 
> 标签：android, facebook

我想将帖子从 Android 发送到 Facebook 墙。一些初始代码有效，但在我的帖子中出现以下问题：

1.  如果我在帖子中设置“链接”，那么在帖子顶部会出现描述
    “来自应用程序 SomeApp 的 JohnDoe 发布的链接”。
    我只想在顶部使用标准用户名“John Doe”。

2.  如果我在帖子中设置图片，那么指向图片的链接将成为用户点击帖子后登陆的链接。
    我想展示来自例如的图片。“mysite.com/picture.png”，但点击帖子后，我想将用户带到“www.myadres.com”。

我试图找到基于 Graph API 的解决方案 [因为 REST API 现在已弃用]。

当前代码片段的上述行为。

```
Bundle params = new Bundle();
params.putString("message", "test message");
params.putString("link", "http://www.google.no");
params.putString("caption", "app caption");
params.putString("description", "this app is about ...");
params.putString("picture", "http://www.facebookmobileweb.com/hackbook/img/facebook_icon_large.png");
params.putString("name", " just won 1M500");

Utility.mAsyncRunner.request("me/feed", params, "POST", new BaseRequestListener() {
  @Override
    public void onComplete(String response, Object state) {
    System.out.println("response = " + response);
  }
}, null); 
```

提前感谢您的帮助！
最好的问候
GT

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-10-02T16:36:13.023

要发布看起来像“普通用户帖子”[而不像“共享链接”]的帖子，请使用 action`"feed"`而不是 NOT `"me/feed"`。

最后：

```
Utility.mAsyncRunner.request("feed", params, "POST", new BaseRequestListener() {
  @Override
    public void onComplete(String response, Object state) {
    System.out.println("response = " + response);
  }
}, null); 
```

# mysql - 从分隔字符串中选择

> ID：12486237
> 
> 赞同：1
> 
> 时间：2012-09-18T22:54:04.827
> 
> 标签：mysql, sql

我正在使用 dotProject（开源项目管理工具）并且需要为我自己的目的做一些自定义 sql 选择。

```
select  u.user_username,
        p.project_name,
        p.project_start_date,
        p.project_end_date,
        SUBSTRING(sysval_value,LOCATE(CONCAT(p.project_status,'|'),sysval_value)+2,LOCATE('\n',sysval_value,LOCATE(CONCAT(p.project_status,'|'),sysval_value))-LOCATE(CONCAT(p.project_status,'|'),sysval_value)-2) as project_status 
from project_contacts pc
left join users u on pc.contact_id = u.user_id
left join sysvals s on s.sysval_title='ProjectStatus'
left join projects p on p.project_id=pc.project_id 
```

请注意我不得不从 sysvals 表中选择 ProjectStatus 的讨厌方式。

ProjectStatus 的 sysval_value 如下所示： `0|Not Defined/n1|Proposed/n2|In Planning/n3|In Progress/n4|On Hold/n5|Complete/n6|Template/n7|Archived`

不知道为什么会这样，我本来希望有一个带有主键和描述的状态表（也许只是为了消除项目中的表数量）。

有没有更好的方法从 MySQL 中的这种分隔字符串中进行选择？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-02-04T08:19:10.790

这些 sysval_values 可以作为数组使用 using`dPgetSysVal()`方法：

此方法在 dotProject->includes -> main_functions.php 中定义

```
$arr = array();
$arr=dPgetSysVal("ProjectStatus");
$arr[0]----------> Not Defined
$arr[1]----------> Proposed
$arr[2]----------> In Planning
$arr[3]----------> In Progress
$arr[4]----------> On Hold
$arr[5]----------> Complete and so on... 
```

这是我尝试使用您的代码进行选择的内容：

```
<?php
require_once 'base.php';
require_once DP_BASE_DIR . '/includes/config.php';
require_once (DP_BASE_DIR . '/classes/csscolor.class.php'); // Required before main_functions
require_once (DP_BASE_DIR . '/classes/kses.class.php'); // Required before main_functions
require_once (DP_BASE_DIR . '/includes/main_functions.php');
require_once (DP_BASE_DIR . '/includes/db_adodb.php');
require_once (DP_BASE_DIR . '/includes/db_connect.php');

require_once (DP_BASE_DIR . '/classes/ui.class.php');
require_once (DP_BASE_DIR . '/classes/permissions.class.php');
require_once (DP_BASE_DIR . '/includes/session.php');
require_once (DP_BASE_DIR . '/includes/permissions.php');
require_once (DP_BASE_DIR . '/style/dp-grey-theme/overrides.php');

$q = new DBQuery;
$q->clear();
$q->addTable('project_contacts');
$q->addTable('users');
$q->addTable('projects');
$q->addTable('sysvals');
$q->addWhere('dotp_project_contacts.contact_id = dotp_users.user_id');
$q->addWhere('dotp_sysvals.sysval_title = "ProjectStatus"');
$q->addWhere('dotp_projects.project_id = dotp_project_contacts.project_id');
$values = $q->loadList();
$arr = array();
foreach ($values as $row) {
$arr=dPgetSysVal("ProjectStatus");
echo $row['user_username'].' '. $row['project_name'].' '. $row['project_start_date'].' '. $row['project_end_date'].' '. $arr[$row['project_status']].'<br>';
}
?> 
```

**dotp_**我的数据库表扩展 :)

# java - 当“Set”不合适时，是否有 NavigableSet 的替代方法？

> ID：12486239
> 
> 赞同：2
> 
> 时间：2012-09-18T22:54:24.580
> 
> 标签：java, list, data-structures, collections, set

该[`NavigableSet`](http://docs.oracle.com/javase/7/docs/api/java/util/NavigableSet.html)接口提供了许多普通方法[`Set`](http://docs.oracle.com/javase/7/docs/api/java/util/Set.html)没有的有用方法（特别是我正在考虑诸如`headSet`和之类的方法`tailSet`）。但是，作为 a `Set`，它不支持重复元素。另外，作为 a [`SortedSet`](http://docs.oracle.com/javase/7/docs/api/java/util/SortedSet.html)，排序必须与接口的约定一致，`equals`避免`hashCode`违反`Set`接口的约定。

当根据自然排序或比较器可能存在重复元素或多个元素“相等”但根据方法不“相等”时，是否有任何好的替代数据结构`equals`？作为一个激励示例，请考虑以下代码，该代码说明了 a`NavigableSet`不合适的原因：

```
public class Foo implements Comparable<Foo>{
  double x;
  double y;

  @Override
  public int compareTo(Foo o) {
    return Double.compare(x, o.x);  // only x matters for sort order
  }

  public static void main(String...args){
    Foo a = new Foo();
    a.x = 1;
    a.y = 2;

    Foo b = new Foo();
    b.x = 1;
    b.y = 42;

    Foo c = new Foo();
    c.x = 2;
    c.y = 12.34;

    NavigableSet<Foo> set = new TreeSet<Foo>();
    set.add(a);
    set.add(a);
    set.add(b);
    set.add(c);

    System.out.println(set.size());
  }
} 
```

请注意，元素`a`只添加一次（当然，因为这是 a `Set`）。另外，请注意`b`没有添加，因为已经有一个元素的比较返回 0。

我觉得这可能是一件相当普遍的事情，所以我希望找到一个现有的实现，而不是自己动手。是否有适合我的用途的良好、广泛使用的数据结构？

我要补充一点，在写这个问题时我确实遇到了[Biscotti Project](http://code.google.com/p/biscotti/)，但是 a）我不相信它可以解决比较/等于问题，并且 b）常见问题解答明确表示使用起来并不安全。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:53:10.447

让我重新表述你的问题，以确保我能很好地理解它。需要`headSet`并且`tailSet`意味着必须对集合进行排序。这与根据`compareTo`.

冲突来自对此类集合的有效使用。*使用O(log n)*`compareTo`中的方法将成员添加到已排序的集合中- 一种二进制搜索然后添加。是使用which can't two same members 根据 实现的。*`TreeSet``TreeMap``compareTo`*

 *您正在寻找的东西不会有效。

*   您可以尝试使用简单的`ArrayList`排序方法`Collections.sort`，然后使用`sublist`方法。问题在于它根本不处理重复项。
*   您也可以使用`LinkedHashSet`which 处理重复项（根据并且`equals()`它对*免疫*`compareTo()`），但它没有排序。当然，您可以通过在构造函数中传递其实例`LinkedHashSet`来将实例转换为 。`SortedSet`*

# java - 如果轮询，COM 端口事件处理程序将失败

> ID：12486240
> 
> 赞同：1
> 
> 时间：2012-09-18T22:54:30.723
> 
> 标签：java, eclipse

我对提出问题有点害羞，因为它们已被否决，但这让我发疯。我可以从所有串行端口事件处理程序问题中看到，这是一个流行的主题。经过一番努力，我得到了以下代码：

```
 public void serialEvent(SerialPortEvent evt) {
    if (evt.getEventType() == SerialPortEvent.DATA_AVAILABLE) {
        try {
            rdata = (byte) comIn.read();
            line_buffer[line_ptr++] = rdata; 
            data_available = true;
//              System.out.print((byte)rdata);
            if( rdata == '\n') {
                line_available = true;
            }
        }
        catch (Exception e) {
            System.out.print("Failed to read data. (" + e.toString() );
        }
    }
} 
```

我说它正在工作，因为如果我取消注释打印，我会看到我期望的数据。我还在设置 data_available 和行可用标志的行上设置了断点，并且它们发生了。

我正在尝试使用以下代码与此代码进行通信：

```
// Code that requests data to be send back

// Code that inserts a delay for data to be received

    while( comm.line_avaiable() == false ) { } 

    for(int j=0;j< comm.line_ptr; j++) {
      System.out.print( (char)comm.line_buffer[j] );
} 
```

这段代码是等待data_available，然后打印接收到的数据行。使用所示代码，while 循环永远不会获取 data_available。不仅如此，事件处理程序不会得到任何事件。没有数据被回显（注释被删除）并且断点永远不会被击中。

如果我注释掉等待 data_available 的 while 循环（并添加延迟以接收数据，因为我们在没有握手的情况下运行，数据接收得很好。如果设置事件处理程序确实会遇到断点并且可以回显数据.

轮询 line_available 标志如何破坏事件处理程序？

# java - java客户端-服务器应用程序 - 无法创建多个客户端

> ID：12486241
> 
> 赞同：0
> 
> 时间：2012-09-18T22:54:38.773
> 
> 标签：java, sockets, tcp, network-programming

我正在创建一个多线程应用程序，其中服务器应同时处理多个客户端请求。此外，客户端应该与其他客户端通信。服务器将保存各种客户端的端口地址，因此每个客户端都必须联系服务器以了解其对等方的端口地址。

我对程序的理解：

client.java（有一个套接字和一个服务器套接字）

socket - 用于与服务器交谈以注册其 serversocket 编号，这将有助于其他对等方进行识别。（注意：与服务器套接字不同，我们可能不得不在创建时提及端口，套接字# 由操作系统唯一分配，因此我们无需担心这一点。）

serversocket - 用于与其他对等方交谈，其他对等方应该知道此号码。

* * *

服务器.java

serversocket - 用于与各种客户端通信

* * *

现在，我有两个程序 server.java 和 client.java。当然，为了拥有多个客户端，我会多次运行 client.java。以下是我的问题：

我的 client.java 会有两个端口吗？一个套接字与服务器对话，一个服务器套接字监听其他客户端？如果是这样，我应该将端口号作为参数传递给 client.java 以便它可以用作每个客户端实例的唯一服务器套接字#？

请帮帮我！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:01:51.787

是的，您可以将它们作为运行时参数传递，或者更好地让服务器为您决定它，这样您就不必担心分配唯一的端口号。

此外，我相信您必须通过客户端端口和 ip 才能让客户端相互交谈，除非您的所有客户端都在同一台机器上。

# jsf - jsf 默认语言环境问题

> ID：12486242
> 
> 赞同：1
> 
> 时间：2012-09-18T22:54:42.690
> 
> 标签：jsf, internationalization

我在 faces-config.xml 中有以下配置

```
<locale-config>
   <default-locale>tr</default-locale>
   <supported-locale>tr</supported-locale>
   <supported-locale>en</supported-locale>
</locale-config>
<resource-bundle>
   <base-name>i18n.texts</base-name>
   <var>text</var>
</resource-bundle> 
```

以及必要目录中的 texts_en.properties、texts_tr.properties。当我将语言环境设置为 tr 时，会显示 tr 消息；当我设置为 en 时，显示 en 消息；对于其他语言环境，它应该在显示 en 消息时显示 tr 消息。有任何想法吗？

# php - PHP：通过其网址下载图像并提示用户保存

> ID：12486244
> 
> 赞同：0
> 
> 时间：2012-09-18T22:55:04.687
> 
> 标签：php, download

让用户单击下载按钮然后自动获取图像文件然后将其下载到他们的通用下载文件夹或提示他们保存它的最佳方法是什么？

我尝试了以下但没有成功：

```
 $file = $art[0]['location']; // this is the full url to image http://....image.jpg
  $ch = curl_init();
  curl_setopt($ch, CURLOPT_POST, 0); 
  curl_setopt($ch,CURLOPT_URL, $file); 
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); 
  $file_content = curl_exec($ch);
  curl_close($ch); 
```

等等，还是我要解决这一切都错了（可能）

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-09-18T22:57:08.060

在回显数据之前：

```
header('Content-Disposition: attachment; filename=save_as_name.jpg'); 
```

然后

```
echo file_get_contents("http://..."); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T22:59:35.587

```
header('Content-Disposition: attachment; filename="exmaple.jpg"');
header('Content-Type: application/octet-stream'); // (or a MIME type like "image/jpeg")

echo $file_content; 
```

# c - 在 C 中玩指针增量

> ID：12486246
> 
> 赞同：3
> 
> 时间：2012-09-18T22:55:14.093
> 
> 标签：c

当我发现你可以增加指针时，我开始在 c 中玩了一下。所以我想，为什么不试试看是否可以用这个程序清除我的 RAM：

```
#include <stdio.h>

int main()
{
    int number = 0;
    int *pointer = &number;
    while (true) {
        pointer++;
        *pointer = 0;
    }
    return 0;
} 
```

这是我的操作系统无法运行的原因，还是 C 语言对此有例外？

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T22:57:29.447

> 这是我的操作系统无法运行的原因，还是 C 语言对此有例外？

就语言而言，这是未定义的行为。由操作系统决定当您使用不属于您的内存时会发生什么。

您为 分配`sizeof int`了字节`number`，将其地址存储在指针中，然后继续遍历该内存块，直到出现明显的问题。一旦您递增`pointer`并写入该位置，您就会调用未定义的行为。

您不能随心所欲地读写随机内存位置（好吧，您*可以*，只是不能保证您的程序以任何特定方式运行）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-18T23:00:23.747

在任何现代操作系统中，每个进程都有自己的地址空间。在其中，它将找到自己的可执行代码和数据。因此，您不能简单地访问“计算机的 RAM”。您所能做的就是在程序的地址空间中搞砸。

您可以通过并行运行以下代码轻松看到这一点：

```
int main()
{
    int i=0;
    printf("The address of i = %p\n",&i);
    sleep(60);
} 
```

您将（可能）看到所有进程都打印出相同的内存地址。当然，它们并没有指向相同的物理内存位。

（**ps。**当共享库（“DLL”）被加载时，你*将*拥有所有进程都指向内存中相同的物理位。这样，许多可执行代码只需为所有进程加载一次。这将被读取- 仅内存，因此没有进程可以使用同一库更改其他进程的可执行代码。其背后的机制称为内存映射，请查看`mmap()`系统调用以获取更多信息。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-18T22:59:00.973

`number`在堆栈上声明，您正在擦除它和随后的内存位置。所以你正在破坏堆栈。这可能会也可能不会导致您的程序崩溃；这是未定义的行为。堆栈损坏可能会导致您的函数*看起来*干净地退出而没有不利影响，但是当您的进程尝试访问无效的内存位置时，它更有可能发生 SEGV。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-18T23:10:04.127

只是为了备份其他人已经说过的内容，当您写入某个无效或非法的内存位置时，您的程序很可能会导致[分段错误。](http://en.wikipedia.org/wiki/Segmentation_fault)

为了看到这是因为更新了一些随机内存地址的内容而发生的，我将显示您的程序在 GDB 下运行。

```
[jrn@localhost SO]$ gcc -ggdb dumb.c 
[jrn@localhost SO]$ gdb ./a.out 
GNU gdb (GDB) CentOS (7.0.1-42.el5.centos)
Reading symbols from /home/jrn/source/SO/a.out...done.
(gdb) run
Starting program: /home/jrn/source/SO/a.out 

Program received signal SIGSEGV, Segmentation fault.
0x08048399 in main () at dumb.c:9
9               *pointer = 0;
(gdb) list
4       {
5           int number = 0;
6           int *pointer = &number;
7           while (1) {
8               pointer++;
9               *pointer = 0;
10          }
11          return 0;
12      }
13 
```

您将在第 9 行看到错误发生在您写入某个不应该写入的内存地址时。操作系统使用通常由 CPU 提供的内存保护来检测错误写入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-18T22:59:00.740

称为[内存保护](http://en.wikipedia.org/wiki/Memory_protection)的东西会阻止你这样做。基本上，如果操作系统试图更改尚未分配的 RAM 部分，操作系统将终止程序，通常称为[分段错误](http://en.wikipedia.org/wiki/Segmentation_fault)。

当您的程序以特权模式运行时，您可以（理论上）执行此操作，例如在编写设备驱动程序或为裸机嵌入式系统编程时。

# xmpp - 关于 XMPP/Jabber 功能的一些问题

> ID：12486249
> 
> 赞同：0
> 
> 时间：2012-09-18T22:55:29.740
> 
> 标签：xmpp

我们正在现有的 Jabber 客户端之上构建一些功能。我想知道以下是否可能：

1.  为每个用户添加元数据/自定义字段，例如性别、年龄
2.  是否可以通过自定义字段进行搜索（例如，让我找到所有居住在加拿大的 20 到 30 岁之间的女性）
3.  你能得到一个“谁在线”的列表吗
4.  您可以向不在您朋友列表中的人发送消息吗？
5.  该协议是否支持文件/图像传输？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T14:39:25.060

1.  是的
2.  这需要支持[XEP-0055](http://xmpp.org/extensions/xep-0055.html#usecases-search)和数据形式（我认为）。我不能说是否有任何服务器会开箱即用地支持它，或者可能需要一些定制。
3.  [仅当它支持来自XEP-0133](http://xmpp.org/extensions/xep-0133.html#get-online-users-list)的适当临时命令时。
4.  是的。您可以向任何 JID 发送消息。
5.  是的，几乎所有 XMPP 客户端都已经有了这个。支持协议内置的多种传输方法。

将来，您应该限制问题的范围，否则您可能会面临关闭问题的风险。在一个问题中提出多个问题通常会导致它们被关闭。

# c# - XAttribute 包含编码的 HTML

> ID：12486251
> 
> 赞同：1
> 
> 时间：2012-09-18T22:55:44.637
> 
> 标签：c#, xml

我在文档中定义了以下 XML 元素：

```
<modelDef name="EmployeeOutput" description="Current Model Run output.">
    <resultSet name="Values">
        <field name="Net P&amp;L Impact" typeName="Decimal" formatString="C2"/>
    </resultSet>
</modelDef> 
```

注意 field 元素上的 name 属性。当我检索值时，它会返回与符号，我想在其中保留 xml 中定义的编码值。这是我用来检索属性值的简单代码

```
field.Attribute("name").Value 
```

如何确保我得到 & 代码而不是实际的 & 符号？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:07:35.037

实际上，“净损益影响”*是*您在 XML 中编码的值，因为`&amp;`它是与符号的 XML 代码。如果实际编码*值*应该是`"Net P&amp;L Impact"`，那么您需要更改您的 XML：

```
<modelDef name="EmployeeOutput" description="Current Model Run output.">
    <resultSet name="Values">
        <field name="Net P&amp;amp;L Impact" typeName="Decimal" formatString="C2"/>
    </resultSet>
</modelDef> 
```

但是，很少会遇到`&amp;`名称中带有真实世界的实体。为什么要这样编码？是因为您将其输出到 HTML 吗？如果是这样，`HttpUtility.HtmlEncode()`请在将结果值输出到 HTML 时使用它。这是正确和安全的方法。不要期望您的 XML 解析代码预测值将输出到的上下文。

# python - 我需要帮助从函数中获取变量以更改 main() 中的类属性

> ID：12486252
> 
> 赞同：0
> 
> 时间：2012-09-18T22:55:53.593
> 
> 标签：python

这是我的程序。[内联代码：]

```
import pygame, sys
import random

class Player1:
    def __init__(self, firstName, lastName, points):
        self.firstName = firstName
        self.lastName = lastName
        self.points = points

    def __repr__(self):
        return "%s %s" % (self.firstName, self.lastName)

    def __int__(self):
        return self.points

    def __add__(self, other):
        try:
            self.points += other
            return Person(points)

        except AttributeError:
            print "error"
            raw_input

class Player2:
    def __init__(self, firstName2, lastName2, points2):
        self.firstName2 = firstName2
        self.lastName2 = lastName2
        self.points2 = points2

    def __repr__(self):
        return "%s %s" % (self.firstName2, self.lastName2)

    def __int__(self):
        return self.points2

    def __add__(self, other):
        try:
            self.points += other
            return Person(points)

        except AttributeError:
            print "error"
            raw_input

def rollDie(sides):
    r = random.randint(1,sides)
    return r

def takeTurn(player):
    points = int(player)
    if int(player) < 100:
        keepRolling = 1
        print
        raw_input("%s <press enter to begin turn>" % (player))
        while keepRolling == 1:
            r = rollDie(6)
            print "%s rolled a " % (player) + str(r)
            print
            if r == 1:
                points = str(int(player))
                print "%s your points are now " % (player) + `points` + " because you rolled a 1." 
                keepRolling = 0
                print "Turn over"
                print
            else:
                points += r
                print "%s your points are now " % (player) + `points` 
                kR = input("Keep rolling?(0=no 1=yes): ")
                if kR == 1:
                    print
                    keepRolling = 1
                else:
                    keepRolling = 0
                    print "%s your points are now " % (player) + `points` 
                    print "turn over"
                    print

    else:
        print
        print "Congradulations %s you have won the Game of Thrones..... I mean pig. Yeah, pig." % (player)
        print
        raw_input("%s, press any key to exit the game.........") % (player)
        sys.exit()

    return points

def intro():
    print "This is the game of pig."
    print
    print "Each player has to roll a six-sided die"
    print "until they get a 1, reach 100, or want to stop."
    print "If they roll a 1, they get nothing."
    print "When prompted, press 1 to roll, 2 to skip."

def main():

    player11 = raw_input("What is Player 1's first name? -> ")
    player12 = raw_input("Last name? -> ")
    player21 = raw_input("Player 2's first name? -> ")
    player22 = raw_input("Last name? -> ")
    desiredT = input("How many turns do you want? ")

    player1 = Player1(player11, player12, 0) #I need the point from take turn to change these zeros
    player2 = Player2(player21, player22, 0)

    def correctInfo():
        verify = raw_input("Is this info correct? Player 1 is %s: Player2 is %s? [y,n] -> " % (player1, player2))
        if verify == "y":
               print

        elif verify == "n":
                print
                print
                main()

        else: 
            print "Not a valid input"
            print
            correctInfo()

    def turns(t):
        for i in range(t):
            takeTurn(player1) #how do I get the point from here to change the class?
            takeTurn(player2)
        if int(player1) > int(player2):
            print
            print "%s has won with %s points." % (player1, int(player1))
            print

        else:
            print
            print "%s has won with %s points." % (player2, int(player2))
            print
        raw_input("press any key to exit.............")

    correctInfo()
    intro()
    turns(desiredT)

main() 
```

相关领域有评论。我只需要弄清楚如何获得

```
return points 
```

在 takeTurn() 结束时改变

```
player1 = Player1(firstName, lastName, 0) 
```

在 main() 中，零是需要改变的

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:04:50.040

除了忽略为什么以及何时使用类的全部要点之外，您的代码还存在许多问题。

如果他们要共享*所有*功能，您只需要**一个玩家类。**

 *```
player1 = player(player11, player12, 0) # These instances,
player2 = player(player21, player22, 0) # use the same class. 
```

改变这一点，你所拥有的一切应该仍然可以正常工作。

您想从玩家需要参与的回合中构建具有积分的玩家吗？你的逻辑在这里是错误的。

如果您想更改玩家点数，请**在 TakeTurn()**函数中进行。您已经可以在此处访问播放器对象。

```
TakeTurn(player):
    # Instead of return points
    player.points = points 
```*

# ios - 在禁用的 UIButton 上使用 UILongPressGestureRecognizer

> ID：12486256
> 
> 赞同：0
> 
> 时间：2012-09-18T22:56:28.040
> 
> 标签：ios, uikit, uigesturerecognizer

我有`UIButton`一个`UILongPressGestureRecognizer`附加的。

如果按钮已启用，我会收到来自gestureRecognizer 的事件。
但是，如果按钮被禁用（即`button.enabled = NO`）我不会收到这些事件。

`UILongPressGestureRecognizer`如果`UIButton`未启用，有什么方法可以从 a 接收事件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:12:37.423

几个选项：

*   实际上不要禁用按钮，只需在内部设置一个标志，并且在标志为 false 时不执行按钮操作。副作用是按钮看起来仍然可以正常工作。

*   在没有可见外观的禁用按钮之上创建另一个按钮。还要长按。启用可见按钮时，禁用不可见按钮，反之亦然。

*   在父视图上长按使用手势委托来查看它是否在您的按钮顶部：

    ```
    - (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch
    {
        if (touch.view == theButton)
        {
            // Perform your action
        }
    } 
    ```

# iis - 在 Windows 7 上安装 IIS8？

> ID：12486257
> 
> 赞同：7
> 
> 时间：2012-09-18T22:56:35.853
> 
> 标签：iis, windows-7, iis-8

我目前正在考虑升级我的开发环境，以尝试在我的生产 Web 服务器上复制 IIS。我的生产 Web 服务器是新的，最近才使用 windows server 2012 和 IIS8 启动。

我正在本地使用 Windows 7 机器。

是否可以在 Windows 7 机器上安装 IIS8？

如果是这样，我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:08:54.393

这是虚拟机的完美场景。我会安装一些虚拟化软件，并在其上安装您在生产中使用的 Windows Server 版本。这样，当您运行 IIS8 时，它将处于更接近生产 Web 服务器的环境中；-)

# nosql - 我可以在 cassandra 中创建以下列 Family 吗？

> ID：12486261
> 
> 赞同：2
> 
> 时间：2012-09-18T22:57:08.287
> 
> 标签：nosql, cassandra, command-line-interface, bigdata

我需要在 Cassandra 中制作小型 POC，并且需要创建以下类型的列 Family：

具有唯一字符串 id（例如 '1234'）的用户应存储所有按时间戳排序的传入消息。

```
 "1234"=> 
    [
      1348008041376000 : {  target_uid : 4321, msg : "Hello, how are you?" },
      1348008041377000 : {  target_uid : 3213, msg : "And how Are you?" }
    ] ,
    "4321"=> 
    [
      1348008041376000 : {  target_uid : 1234, msg : "Thank you I'm fine." },
      1348008041377000 : {  target_uid : 2345, msg : "And how Are you?" }
    ] 
```

google了半天，也看到了很多例子，但还是没搞明白应该是什么类型的COLUMN FAMILY？

我是 Cassandra 的新手，我知道这听起来像是家庭作业:)，但请帮忙。

**更新：**

我正在尝试创建以下 cli Create Family 列，但它似乎不起作用。

```
 CREATE COLUMN FAMILY messages with comparator = DateType and key_validation_class=UTF8Type AND column_metadata=[ {column_name: msg, validation_class: UTF8Type}];
java.lang.RuntimeException: org.apache.cassandra.db.marshal.MarshalException: unable to coerce 'msg' to a  formatted date (long) 
```

你能帮忙看看cli语法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T02:02:02.840

对于 1.1 之前的版本，这应该可以解决问题。它假定您将 JSON 值存储在一个宽行中（您管理自己的序列化）。

```
CREATE COLUMNFAMILY Example 
  ( user_id text PRIMARY KEY ) 
  WITH comparator=timestamp; 
```

对于 1.1 版以后，请查看此文档以获取更多指导： [http ://www.datastax.com/dev/blog/schema-in-cassandra-1-1](http://www.datastax.com/dev/blog/schema-in-cassandra-1-1)

# r - R 中各列的平均值，不包括 NA

> ID：12486264
> 
> 赞同：23
> 
> 时间：2012-09-18T22:57:33.170
> 
> 标签：r, average

我无法想象我是第一个提出这个问题的人，但我还没有找到解决方案（这里或其他地方）。

我有几列，我想在 R 中平均。唯一最棘手的方面是某些列包含 NA。

例如：

```
Trait Col1 Col2 Col3
DF    23   NA   23
DG    2    2    2
DH    NA   9    9 
```

我想创建一个 Col4 来平均前 3 列中的条目，忽略 NA。所以：

```
 Trait Col1 Col2 Col3 Col4
 DF    23   NA   23   23
 DG    2    2    2    2
 DH    NA   9    9    9 
```

理想情况下，这样的事情会起作用：

```
data$Col4 <- mean(data$Chr1, data$Chr2, data$Chr3, na.rm=TRUE) 
```

但事实并非如此。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2012-09-18T23:02:48.177

您想要`rowMeans()`但重要的是要注意它有一个`na.rm`您想要设置为的参数`TRUE`。例如：

```
> mat <- matrix(c(23,2,NA,NA,2,9,23,2,9), ncol = 3)
> mat
     [,1] [,2] [,3]
[1,]   23   NA   23
[2,]    2    2    2
[3,]   NA    9    9
> rowMeans(mat)
[1] NA  2 NA
> rowMeans(mat, na.rm = TRUE)
[1] 23  2  9 
```

为了匹配您的示例：

```
> dat <- data.frame(Trait = c("DF","DG","DH"), mat)
> names(dat) <- c("Trait", paste0("Col", 1:3))
> dat
  Trait Col1 Col2 Col3
1    DF   23   NA   23
2    DG    2    2    2
3    DH   NA    9    9
> dat <- transform(dat, Col4 = rowMeans(dat[,-1], na.rm = TRUE))
> dat
  Trait Col1 Col2 Col3 Col4
1    DF   23   NA   23   23
2    DG    2    2    2    2
3    DH   NA    9    9    9 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2019-10-27T14:51:12.340

**为什么不是公认的答案？** 公认的答案是正确的，但是，它对这个特定任务*过于具体*，无法一概而论。如果我们需要，而不是`mean`其他统计信息，例如`var`,`skewness`等，甚至是自定义函数怎么办？

**更灵活的解决方案：**

```
row_means <- apply(X=data, MARGIN=1, FUN=mean, na.rm=TRUE) 
```

* * *

**更多详情`apply`：**

通常，要在整个数据集上应用任何函数（自定义或内置），应使用按列或按行，`apply`或其变体之一（`sapply`、lapply`、...）。它的签名是：

```
apply(X, MARGIN, FUN, na.rm) 
```

在哪里：

*   `X`：表单数据框或矩阵的数据。
*   `MARGIN`：发生聚合的维度。用于`1`按行操作和`2`按列操作。
*   `FUN`：要对数据调用的操作。这里可以使用任何预定义的 R 函数以及任何用户定义的函数。
*   `na.rm`: 如果`TRUE`，`NA`值将在`FUN`被调用之前被删除。

**为什么要使用`apply`？**

出于多种原因，包括但不限于：

1.  任何功能都可以轻松插入`apply`。
2.  对于不同的偏好，例如输入或输出数据类型，可以使用其他变体（例如，`lapply`对于列表上的操作）。
3.  （**最重要的是**）它促进了可扩展性，因为这个函数的版本允许并行执行（例如`mclapply`从`{parallel}`库中）。例如，参见[[+]](https://stat.ethz.ch/R-manual/R-devel/library/parallel/html/mclapply.html)或[[+]](https://cran.r-project.org/web/packages/future.apply/index.html)。

# asp.net-mvc - ASP.NET MVC3 Windows 身份验证需要来自 Active Directory

> ID：12486268
> 
> 赞同：0
> 
> 时间：2012-09-18T22:58:07.197
> 
> 标签：asp.net-mvc, active-directory

我希望创建一个使用我们的 Active Directory 登录系统的站点。所以在一个实验中，我创建了一个带有 Windows 身份验证的项目，并尝试从其他位置登录。一台机器使用了我登录的用户。太好了。我从 Mac 登录，它要求我进行身份验证。优秀的。

但是，我担心的是从未以 AD 用户身份（而是以本地管理员用户身份）登录的计算机登录。因此，不是将用户显示为 AD(USER)，而是 MACHINE\USER。

有什么方法可以要求我的应用程序仅拥有来自 AD 空间的经过身份验证的用户？还是我最好制作自己的身份验证逻辑？

在一个侧面主题中（我没有对其进行任何搜索，所以请随意避免这个问题），有没有办法只允许特定的广告用户组访问该网站？

（请注意，我是 AD 和 ASP 的新手，所以如果我只是缺少某些术语，我很乐意做更多的研究）

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:27:27.440

当你寻求帮助的那个尴尬时刻，做更多的搜索并自己回答。

[http://bytes.com/topic/asp-net/answers/343407-using-web-config-allow-access-domain-users-only](http://bytes.com/topic/asp-net/answers/343407-using-web-config-allow-access-domain-users-only)

所以我这样做了：

```
<authorization>
  <allow roles="AD\Group.Name" />
  <deny users="?" />
  <deny users="*" />
</authorization> 
```

# android - 姜饼上的 ActionbarSherlock setNavigationMode

> ID：12486272
> 
> 赞同：0
> 
> 时间：2012-09-18T22:58:48.333
> 
> 标签：android, navigation, actionbarsherlock

我有一个应用程序，它有多个片段**Fragment1**和**Fragment2**，用户可以使用`ViewPagerAdapter`. 该应用程序还使用`ActionBarSherlock`.
Fragment1 使用`NAVIGATION_MODE_STANDARD`mode 而 Fragment2 使用`NAVIGATION_MODE_LIST`.

在 Gingerbread 及以下版本中，在这两个片段之间切换并旋转手机几次会导致操作栏保持列表视图`NAVIGATION_MODE_LIST`并在其上绘制新的导航模式。因此，如果我在这两个片段之间切换几次并旋转手机几次，最终我的操作栏中会出现一个列表视图和一个标题！

我可以通过在`com.actionbarsherlock.internal.widget.ActionBarView$setNavigationMode`. 我基本上要求隐藏列表视图，除了从父级中删除它的布局。这解决了问题。

我想知道其他人是否也看到了这个问题，如果是，他们是否有更好的解决方案/解释？

# facebook - Facebook 支付对话框不返回响应

> ID：12486276
> 
> 赞同：2
> 
> 时间：2012-09-18T22:59:24.450
> 
> 标签：facebook, json, facebook-javascript-sdk, payment

我正在尝试打开支付对话框，但进展不顺利。当我将操作设置为 buy_credits 或 ear_credits 时，它会起作用。但是，当我将操作设置为 buy_item 时，它会返回“错误”

```
1383046 - Sorry, but we're having trouble processing your payment. You have not been charged for this transaction. Please try again. 
```

我的 Java 代码：

```
<script type="text/javascript">
    function buy() {
        FB.ui(
        {
            method: 'pay',
            action: 'buy_item',
            order_info: { 'item_id': '1a'},
            dev_purchase_params: {'oscif': true}
        }, 
        js_callback);
    }
    var js_callback = function (data) {
        if (data['order_id']) {
            write_callback_data(
                "<br><b>Transaction Completed!</b> </br></br>"
                + "Data returned from Facebook: </br>"
                + "Order ID: " + data['order_id'] + "</br>"
                + "Status: " + data['status']);
        } else if (data['error_code']) {
            // Appropriately alert the user.
            write_callback_data(
                "<br><b>Transaction Failed!</b> </br></br>"
                + "Error message returned from Facebook:</br>"
                + data['error_code'] + " - "
                + data['error_message']);
        } else {
            // Appropriately alert the user.
            write_callback_data("<br><b>Transaction failed!</b>");
        }
    };

    function write_callback_data(str) {
        document.getElementById('fb-ui-return-data').innerHTML = str;
    }
</script> 
```

我的 PHP 回调代码：

```
error_reporting(E_ALL);
$app_secret = '********************************';
// Validate request is from Facebook and parse contents for use.
$request = parse_signed_request($_POST['signed_request'], $app_secret);

// Get request type.
// Two types:
//   1\. payments_get_items.
//   2\. payments_status_update.
$request_type = $_POST['method'];

error_log($request_type, 0);
// Setup response.
$response = '';

if ($request_type == 'payments_get_items') {
  // Get order info from Pay Dialog's order_info.
  // Assumes order_info is a JSON encoded string.
  $order_info = json_decode($request['credits']['order_info'], true);

  // Get item id.
  $item_id = $order_info['item_id'];

  // Simulutates item lookup based on Pay Dialog's order_info.
  if ($item_id == '1a') {
    $item = array(
      'title' => '100 Gold',
      'description' => 'Premium Currency.',
      // Price must be denominated in credits.
      'price' => 5,
      'image_url' => '1a.png'
    );

    // Construct response.
    $response = array(
                  'content' => array(
                                 0 => $item,
                               ),
                  'method' => "payments_get_items",
                );
    // Response must be JSON encoded.
    $response = json_encode($response);
  }

} else if ($request_type == "payments_status_update") {
  // Get order details.

  $order_details = json_decode($request['credits']['order_details'], true);

  // Determine if this is an earned currency order.
  $item_data = json_decode($order_details['items'][0]['data'], true);
  $earned_currency_order = (isset($item_data['modified'])) ?
                             $item_data['modified'] : null;

  // Get order status.
  $current_order_status = $order_details['status'];

  if ($current_order_status == 'placed') {
    // Fulfill order based on $order_details unless...

    if ($earned_currency_order) {
      // Fulfill order based on the information below...
      // URL to the application's currency webpage.
      $product = $earned_currency_order['product'];
      // Title of the application currency webpage.
      $product_title = $earned_currency_order['product_title'];
      // Amount of application currency to deposit.
      $product_amount = $earned_currency_order['product_amount'];
      // If the order is settled, the developer will receive this
      // amount of credits as payment.
      $credits_amount = $earned_currency_order['credits_amount'];
    }

    $next_order_status = 'settled';

    // Construct response.
    $response = array(
                  'content' => array(
                                 'status' => $next_order_status,
                                 'order_id' => $order_details['order_id'],
                               ),
                  'method' => $request_type,
                );
    // Response must be JSON encoded.
    $response = json_encode($response);

  } else if ($current_order_status == 'disputed') {
    // 1\. Track disputed item orders.
    // 2\. Investigate user's dispute and resolve by settling or refunding the order.
    // 3\. Update the order status asychronously using Graph API.

  } else if ($current_order_status == 'refunded') {
    // Track refunded item orders initiated by Facebook. No need to respond.

  } else {
    // Track other order statuses.

  }
}

// Send response.
error_log(print_r($response, true));
echo $response;

// These methods are documented here:
// https://developers.facebook.com/docs/authentication/signed_request/
function parse_signed_request($signed_request, $secret) {
  list($encoded_sig, $payload) = explode('.', $signed_request, 2);

  // decode the data
  $sig = base64_url_decode($encoded_sig);
  $data = json_decode(base64_url_decode($payload), true);

  if (strtoupper($data['algorithm']) !== 'HMAC-SHA256') {
    error_log('Unknown algorithm. Expected HMAC-SHA256');
    return null;
  }

  // check sig
  $expected_sig = hash_hmac('sha256', $payload, $secret, $raw = true);
  if ($sig !== $expected_sig) {
    error_log('Bad Signed JSON signature!');
    return null;
  }

  return $data;
}

function base64_url_decode($input) {
  return base64_decode(strtr($input, '-_', '+/'));
} 
```

我在脚本中有 error_log 调用，当我按下购买按钮时，它似乎调用了两次服务。调用相同的方法：payments_get_items。响应数据看起来格式正确。这是日志的输出：

```
payments_get_items
{"content":[{"title":"100 Gold","description":"Premium Currency.","price":5,"image_url":"1a.png"}],"method":"payments_get_items"}
payments_get_items
{"content":[{"title":"100 Gold","description":"Premium Currency.","price":5,"image_url":"1a.png"}],"method":"payments_get_items"} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:52:40.993

这几乎肯定是您的回调 URL 返回到 Facebook 的响应存在问题。

您看到两个条目的原因是 Facebook 会在失败之前尝试两次以获得（有效）响应，并向用户显示“抱歉，我们在处理您的付款时遇到问题...”错误消息。

Check the HTTP error codes and the body of the response you're giving to Facebook and make sure it's valid

# git - 等效的 Git 命令

> ID：12486279
> 
> 赞同：1
> 
> 时间：2012-09-18T22:59:41.447
> 
> 标签：git, git-branch, git-clone, git-checkout

是

```
git clone -b branch1 ssh://gitolite@host/project/testkit 
```

相当于

```
git clone ssh://gitolite@host/project/testkit
cd testkit
git checkout branch1 
```

?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:07:19.073

是的，这是由[`git clone`文档](https://www.kernel.org/pub/software/scm/git/docs/git-clone.html)支持的：

> `-b <name>`
> 
> > 不要将新创建的 HEAD 指向克隆存储库的 HEAD 指向的`<name>`分支，而是指向分支。在非裸存储库中，这是将被检出的分支。

# c# - 如何从 XML 文件中删除空格

> ID：12486283
> 
> 赞同：1
> 
> 时间：2012-09-18T23:00:41.887
> 
> 标签：c#, xml, whitespace

我有以下 XML 文件。如何从中删除不必要的空格？我尝试使用 XDocument.Save 并删除格式，但它不起作用。尝试解析文件时出现异常。本质上，我想规范化文本，使其不包含那些空格。我应该求助于正则表达式吗？

> < ? xmlversion = "1 . 0" 编码 = "utf - 1 6" ？>

```
 < n s 0 : C D I S c h e m a E r r o r   x m l n s : n s 0 = " h t t p : / / M i c r o s o f t . I T . R e l a t i o n s h i p M a n a g e m e n t . S c h e m a s . P a r t n e r F u n d S u m m a r y S c h e m a E r r o r / V 1 " > 

     < E r r o r I n f o r m a t i o n > T h e r e   w a s   a   f a i l u r e   e x e c u t i n g   t h e   r e c e i v e   p i p e l i n e :   " s d f g t w . I T . R e l a t i o n s h i p M a n a g e m e n t . P i p e l i n e s . N o n C a s h P a y m e n t R e s p o n s e V 1 C S V T o X m l F i l e C o n v e r s i o n ,   t b f a e . I T . R e l a t i o n s h i p M a n a g e m e n t . P i p e l i n e s   U R I :   " D : \ t e s t u r l f o l d e r \ S u b S y s t e m \ S t a g i n g \ V I R P \ * . c s v "   R e a s o n :   T h e   d o c u m e n t   f a i l e d   t o   v a l i d a t e   b e c a u s e   o f   t h e   f o l l o w i n g   e r r o r : " T h e   ' R e f e r e n c e N u m b e r '   e l e m e n t   h a s   a n   i n v a l i d   v a l u e   a c c o r d i n g   t o   i t s   d a t a   t y p e . "   .     < / E r r o r I n f o r m a t i o n > 
     < O r i g i n a l M e s s a g e >  > Id,StatusCode,ReferenceNumber,DateTime,ErrorMessage 
```

> 41977,0,12344,2011-08-29T15:16:06.120,blackety blah </ O riginal M essage > </ ns 0 : CDIS chema E rror >

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:03:19.580

看起来您正在使用 Utf8 或 ASCII 编码读取 UTF-16 文档。正确打开流，您应该不会看到奇怪的字符（应该是`\0`，而不是空格）。

样本（由 Dmytro Tsiniavsky 提供）：

```
XElement body; 
using(var sReader = new StreamReader(fileName,Encoding.Unicode))
{
  body = XDocument.Parse(sReader.ReadToEnd());
} 
```

# ruby-on-rails - 如何缩短 `each do` `raise unless` 简单的源代码？

> ID：12486284
> 
> 赞同：0
> 
> 时间：2012-09-18T23:00:45.593
> 
> 标签：ruby-on-rails, ruby

我正在使用 Ruby on Rails 3.2.2 并试图缩短以下代码：

```
custom_values.each do |custom_value|
  raise("Error!") unless AVAILABLE_CUSTOM_VALUES.include?(custom_value)
end 
```

有没有办法做到这一点？如果是这样，如何缩短（或者，也许，改进）代码？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-09-18T23:09:26.723

就个人而言，我对您编写的代码没有任何问题，但您可以像这样缩短它：

```
(custom_values - AVAILABLE_CUSTOM_VALUES).empty? || raise('Error!') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T04:56:38.793

不是很短，但可能更优雅一点：

```
raise('Error!') unless custom_values.all? do |custom_value|                                                                                                      
  AVAILABLE_CUSTOM_VALUES.include?(custom_value)                                                                                                                 
end 
```

# c++ - 16 字节长的整数类型

> ID：12486285
> 
> 赞同：6
> 
> 时间：2012-09-18T23:00:49.393
> 
> 标签：c++, types, 64-bit

我正在使用 64 位上的 GCC 编译 C++ 程序 - machine/OS/（`-m64`选项传递给`g++`）。正如预期的那样，`sizeof(long double) == 16`我想知道整数是否有 16 字节长的标准类型？

据我了解， PS`__int128_t`是一个模拟标准类型的人工扩展。除此之外我什么也没找到。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:02:41.953

不，只有保证大小适用于`char`, `unsigned char`& `signed char`，它们是`1`：

**5.3.3 大小[expr.sizeof]**

> 1 sizeof 运算符产生其操作数的对象表示中的字节数。操作数要么是一个不求值的表达式，要么是一个带括号的类型 ID。sizeof 运算符不得应用于具有函数或不完整类型的表达式，或应用于所有枚举数已声明之前的枚举类型，或应用于此类类型的带括号的名称，或应用于指定位域的左值。**sizeof(char)、sizeof(signed char) 和 sizeof(unsigned char) 为 1。 sizeof 应用于任何其他基本类型 (3.9.1) 的结果是实现定义的。**[ 注意：特别是 sizeof(bool) 和 sizeof(wchar_t) 是实现定义的。74) —end note ] [ 注意：字节的定义见 1.7，对象表示的定义见 3.9。——尾注]

（强调我的）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-05-29T00:20:01.707

c++ 标准没有标准化每种类型的大小（接受 char），而是标准化彼此之间的大小差异。

```
A char has to be 1 byte.
A short has to be >= to a char.
An int has to be >= to a short.
A long has to be >= to an int.
and a long long has to be >= to a long. 
```

浮点类型也是如此。

我相信大多数编译器现在最多支持 8 字节整数

但是我知道一个事实，即使不是大多数，也没有 16 字节整数。

我还认为人们开发了一些对象类/结构来模拟一个 16 字节的整数，这些整数适用于大多数编译器。

# r - “注意：拟合通过原点的回归！” 意思是？

> ID：12486286
> 
> 赞同：1
> 
> 时间：2012-09-18T23:00:56.553
> 
> 标签：r, plot, linear-regression

我正在使用 R 的容差包中的 plottol 函数，并在生成我的绘图后收到错误/警告，上面写着“注意：拟合通过原点的回归！”

我已经用谷歌搜索了它，但什么也没想到，我不知道从哪里开始试图弄清楚它在警告我什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T23:09:40.263

它通常表示拟合模型，其中截距项被强制为零（换句话说，模型没有截距）。模型中的截距是当等于 0时`y ~ x`的期望。通过将截距设置为 0，我们明确说明当 0为 0 时期望为 0。换句话说，拟合的直线通过点 ( 0,0)，即原点。`y``x``y``x``y ~ x`

如果您想要一个不太笼统的解释（更适合您的具体示例），您需要提供更多详细信息，说明您正在使用哪些**公差**功能，例如通过可重复的示例。

# mysql - 我可以将其转换为子查询驱动的查询吗？就目前而言，由于 LEFT JOIN，它返回了超过一百万行

> ID：12486288
> 
> 赞同：1
> 
> 时间：2012-09-18T23:01:13.817
> 
> 标签：mysql, left-join

这是简化的查询：

```
SELECT
`Node`.`id`,
`Node`.`name`
FROM
`localhost`.`nodes` AS `Node`
LEFT JOIN `localhost`.`data_date_times` AS `DataDateTime` ON (
`DataDateTime`.`node_id` = `Node`.`id`
)
LEFT JOIN `localhost`.`data_locations` AS `DataLocation` ON (
`DataLocation`.`node_id` = `Node`.`id`
) 
```

这个 VS 左连接有什么缺点吗？我可以通过子查询的返回值对整个查询的结果进行排序吗？

我尝试格式化此查询：

```
SELECT
`Node`.`id`,
`Node`.`name`,
    (SELECT `data_locations`.`name` FROM `data_locations` WHERE `data_locations`.`node_id` = `Node`.`id`),
    (SELECT `data_date_times`.`name` FROM `data_date_times` WHERE `data_date_times`.`node_id` = `Node`.`id`)
FROM
`localhost`.`nodes` AS `Node`
WHERE ???
ORDER BY ??? 
```

# c - 在 C 中使用命令行检测参数，然后打印出参数的第一个或第二个字符

> ID：12486289
> 
> 赞同：0
> 
> 时间：2012-09-18T23:01:19.487
> 
> 标签：c, strncpy

我需要制作一个程序，在命令行中接受不少于 2 个且不超过 6 个参数，然后打印出第一个或第二个字符 EX：asdf asdf asdf asdf 打印为：asas

我有初始数组设置和工作，下面的 for 循环旨在在输入中的一个空格处切断字符串并将其复制到新字符串，但它无法正常工作。我是 C 和这个网站的新手。任何帮助是极大的赞赏。

```
 #include <stdio.h>
#include <string.h>

int main(){

char a[50];
char b[50];
char c[50];
char d[50];
char e[50];
char f[50];

int i;

printf("enter a string (Ex: asdf asdf asdf... Must have atleast 2 arguments but no more than six): ");
scanf("%s", a);
printf("%c", a);

for (i = 0; i != 50; i++){

      if(a[i]==' '){
      char strncpy(b, &a[i], i+2);
      printf("\n%c ",a[1]);
      printf("%c ",b[0]);
      }
}
for (i = 0; i != 50; i++){    
      if(b[i]==' '){
      char strncpy(c, &b[i], i+2);
      printf("%c ",c[1]);
      }
}
for (i = 0; i != 50; i++){    
      if(c[i]==' '){
      char strncpy(d, &c[i], i+2);
      printf("%c ",d[0]);
      }
}
for (i = 0; i != 50; i++){    
      if(d[i]==' '){
      char strncpy(e, &d[i], i+2);
      printf("%c ",e[1]);
      }
}
for (i = 0; i != 50; i++){    
      if(e[i]==' '){
      char strncpy(f, &e[i], i+2);
      printf("%c ",f[0]);
      }
}
return 0;
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:39:31.933

你不需要从任何地方复制你的字符串......来自命令行，你会让它们坐在里面`argv`：

```
int main( int argc, char **argv )
{

} 
```

其中`argc`是参数的总数加 1（第一个是调用程序的名称），并且`argv`是指向每个参数字符串的指针数组。这些已经从命令行标记化了。

所以首先你想测试你有足够的论据。我喜欢明确地创建一个新变量，以消除比较中的逐一混淆：

```
int nparams = argc - 1;
if( nparams < 2 || nparams > 6 ) {
    printf( "Wrong number of arguments\n" );
    return -1;
} 
```

然后你循环你的论点。第一个将位于数组的位置 1... 从您的示例中，您似乎打印了第一个参数的第一个字符，以及下一个参数的第二个字符，然后继续交替。这是一个模运算。我有一个变量`which`来选择要打印的字符。

```
int i, which;
for( i = 1; i <= nparams; i++ ) {
    which = (i-1) % 2;
    printf( "%c\n", argv[i][which] );
} 
```

这确实假设每个第二个参数至少有两个字符长。没有错误检查。如果您需要错误检查，您需要确保您正在打印的字符不是字符串终止符（值 0）。在第二个字符的情况下，您还需要在它不为0之前检查该值。我不知道是否可以指定一个零长度的字符串的参数。也许知道的读者可以发表评论。

好吧，我不妨把它放进去……所以你的循环看起来有点像这样：

```
if( argv[i][0] == 0 || argv[i][which] == 0 ) {
    printf( "\n" );
} else {
    printf( "%c\n", argv[i][which] );
} 
```

# objective-c - Objective C，在使用 ARC 时替换保留

> ID：12486294
> 
> 赞同：0
> 
> 时间：2012-09-18T23:01:58.590
> 
> 标签：objective-c, automatic-ref-counting

我正在尝试将使用保留和释放的项目转换为使用 ARC。XCode 中的自动转换没有成功，所以我手动完成。处理释放很容易。我现在归结为几个保留语句，如下所示：

```
UIImage *origImage = [[info objectForKey:UIImagePickerControllerOriginalImage] retain]; 
```

如何将其转换为 ARC 友好？我尝试使用强关键字，但编译器抱怨使用未声明的标识符“强”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T23:09:51.777

```
UIImage *origImage = [info objectForKey:UIImagePickerControllerOriginalImage] ; 
```

它是 ARC 友好的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:04:46.490

您想使用与 @property`__strong`相同`strong`的，但用于变量。与`weak`和相同`__weak`

```
__strong UIImage *origImage = [info objectForKey:UIImagePickerControllerOriginalImage]; 
```

# django - django 获取切片后无法组合查询

> ID：12486295
> 
> 赞同：7
> 
> 时间：2012-09-18T23:02:12.187
> 
> 标签：django, concatenation, slice, django-queryset

有什么方法可以连接切片查询集？它的简化示例（我意识到这个特定示例可以写在一个查询中）：

```
>>> ...
>>> query_set_1 = Model.objects.filter(...)[:3]
>>> query_set_2 = Model.objects.filter(...)[5:]

>>> query_set_1 | query_set_2 
```

不去上班，

```
>>> AssertionError: Cannot combine queries once a slice has been taken. 
```

有什么建议么？谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-09-18T23:07:13.877

不，但是[`itertools.chain()`](http://docs.python.org/library/itertools.html#itertools.chain)将允许您按顺序遍历两个查询集。

```
qiter = itertools.chain(query_set_1, query_set_2) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2019-02-01T05:24:35.880

您可以使用[union()](https://docs.djangoproject.com/en/stable/ref/models/querysets/#union)组合两个切片查询集。像这样：

```
query_set_1 = Model.objects.filter(...)[:3]
query_set_2 = Model.objects.filter(...)[5:]

queryset = query_set_1.union(query_set_2) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-09-12T01:38:00.637

```
merged_queryset = [x for x in queryset1] + [y for y in queryset2] 
```

# ruby - TypeError：无法将 Builder::XmlMarkup 转换为 Array

> ID：12486297
> 
> 赞同：6
> 
> 时间：2012-09-18T23:02:26.700
> 
> 标签：ruby, xml, builder

我在从 Builder::XmlMarkup 对象访问原始 xml 时遇到问题。

```
irb> xml = Builder::XmlMarkup.new(:target => '')
=> <pretty_inspect/>

irb> xml.foo("bar")
=> "<pretty_inspect/><foo>bar</foo>"

irb> puts xml
TypeError: can't convert Builder::XmlMarkup to Array (Builder::XmlMarkup#to_ary gives String)
from (pry):122:in `puts' 
```

在我使用 Builder 创建 XML 的脚本中，我将 @xml 传递给 POST：

```
 response = HTTParty.post(API_ENDPOINT, :body => @xml) 
```

这给出了相同的错误：

```
TypeError (can't convert Builder::XmlMarkup to Array (Builder::XmlMarkup#to_ary gives String)): 
```

当然，如果我执行@xml.to_xml，它不会返回错误，但会添加`</to_xml>`到 xml，这意味着它实际上并没有将 XML 对象转换为 xml。那不是我想要的。

那么我怎样才能获得对 xml 的访问权限，以便我可以将它传递给我的帖子，而不会给我的 xml 添加额外的节点呢？

**编辑：可能的解决方案**

这样做`@xml.target!`似乎可以解决问题，但我不确定我理解为什么。

```
response = HTTParty.post(API_ENDPOINT, :body => @xml.target!) 
```

也许有人可以帮助我了解这里发生了什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2015-05-11T09:51:51.223

使用

```
puts xml 
```

正在输出 Builder::XmlMarkup 对象，因此给出错误

使用

```
puts xml.target! 
```

输出当前的 xml 字符串，这就是你想要的

# c# - File.Copy 返回 void，那么如何检测操作是否成功呢？

> ID：12486306
> 
> 赞同：1
> 
> 时间：2012-09-18T23:03:04.137
> 
> 标签：c#, .net, file-copying

我正在使用以下代码将远程文件复制到本地。复制大文件时如何检测操作失败。

除了处理 system.io 异常之外，还有什么更好的方法来检测故障吗？

```
File.Copy(remoteSrcFile, dest); 
```

这是框架提供的复制文件大小在千兆字节范围内的大文件的最佳方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:09:58.620

> 除了处理 system.io 异常之外，有没有更好的方法来检测故障？

可以预先检查许多可能的错误，例如无效的文件名。如果[File.Copy](http://msdn.microsoft.com/en-au/library/system.io.file.copy.aspx)失败，它会抛出异常。没有其他错误指示​​器。

> 这是框架提供的复制文件大小在千兆字节范围内的大文件的最佳方法吗？

这取决于您想要的其他功能。例如，如果你想显示进度，File.Copy 不会帮助你，因为它只是包装了 FileCopy API。但是，调用 Windows API FileCopyEx 可以提供进度。请参阅[我可以在 .NET 中使用 FileInfo.CopyTo() 显示文件复制进度吗？](https://stackoverflow.com/questions/187768/can-i-show-file-copy-progress-using-fileinfo-copyto-in-net)了解更多信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-18T23:08:53.847

复制失败应该是一种例外情况，因此失败被建模为例外。

`File.Copy`您应该将调用包装在`try`/`catch`中以捕获您能够显式容纳的任何异常。

`File.Copy`是框架中唯一与 . 一起“包含”的东西`FileInfo.CopyTo`。但是，您可以以不同的方式使用它。也许会产生一个线程来调用它。您还可以使用基本 IO 将数据从一个文件读取到另一个文件以获得更好的进度/取消；但是，这取决于您想要实现的目标。

# android - Android中的简单Xml解析错误

> ID：12486307
> 
> 赞同：0
> 
> 时间：2012-09-18T23:03:11.560
> 
> 标签：android, xml-parsing, simple-framework

```
<GetProductsForMachine>
<Products>
    <ProductsForMachine>coffee espresso</ProductsForMachine>
    <ProductsForMachine>coffe1</ProductsForMachine>
    <ProductsForMachine>coffee2</ProductsForMachine>

</Products> 
```

必须是类 ProductsForMachine 的实现，这很困难，因为没有元素可以获取它们的价值。

我尝试使用以下代码，但我在解析中有错误..

```
@Root
public class ProductsForMachine{

    @Attribute(name="ProductsForMachine", required=true)
    public String ProductsForMachine;

    @Element(required=false)
    public int value;
} 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T09:29:50.027

这是一个简单的解决方案，假设每个`<ProductsForMachine>...</ProductsForMachine>` 条目都可以用字符串表示。

```
@Root(name="GetProductsForMachine")
public class GetProductsForMachine
{
    @ElementList(name="Products", entry="ProductsForMachine")
    private ArrayList<String> products; /* 1 */

    // Construtors / Methods

} 
```

**注 1：**`ArrayList<String>`使用 代替的原因`List<String>`请看[这里](https://stackoverflow.com/questions/12113025/remove-class-attribute/12145092#12145092)。

`name`由于设置了注释的值，因此可以重命名类/字段。

您现在可以像这样反序列化您的 XML：

```
File f = // your xml file

Serializer ser = new Persister();
GetProductsForMachine products = ser.read(GetProductsForMachine.class, f); 
```

顺便提一句。`GetProductsForMachine`需要一个结束标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:59:00.887

看看我对[这个问题](https://stackoverflow.com/questions/12479601/how-to-get-the-value-of-an-xml-element-from-within-a-soap-response-android/12480785#12480785)的回答。它提供了一种在查找特定标签时解析简单 xml 的通用方法。

# php - 使用 jquery 和 PHP 显示“活动”链接并在当前页面上保持菜单滑块打开的手风琴菜单问题

> ID：12486313
> 
> 赞同：3
> 
> 时间：2012-09-18T23:03:55.750
> 
> 标签：php, jquery, jquery-ui-accordion

由于我对 jQuery 和 PHP 的了解很少，我几乎完成了一个手风琴式菜单，当活动页面打开时，链接显示为“活动”，而在活动页面上，滑块菜单在正确的部分保持打开状态。

我在底部链接中添加了一些 php。子链接在活动页面上显示为活动。然而，父元素不会，也会自行关闭。

我真的很感激任何帮助！！！

这是我的代码：

```
<ul id="accordion">    
<ul class="parent">
    <li>
        <a href="#" class="slide">CMS</a>

        <ul class="child">
            <li><a href="/learn/intro-to-cms">Intro to CMS</a></li>
            <li><a href="/learn/specific-cms">Specific CMS</a></li> 
            <li><a href="/learn/installing-a-cms">Installing a CMS</a></li> 
        </ul>

     </li>
</ul>

<ul class="parent">
        <li>
            <?php
            if ($this_page=="Customising-Google-Forms" || $this_page=="Web-Event-Notes"){
            echo "<a href=\"#\" class=\"slide current\">Other</a>";
            }else{
            echo "<a href=\"#\" class=\"slide\">Other</a>";
            }
            ?>

        <ul class="child">
            <?php
            if ($this_page=="Customising-Google-Forms"){
            echo "<li class=\"current\"><a href=\"/learn/customising-google-forms\">Customising-google-forms</a></li>";
            }else{
            echo "<li><a href=\"/learn/customising-google-forms\">Customising Google Forms</a></li>";
            }
            ?>
            <?php
            if ($this_page=="Web-Event-Notes"){
            echo "<li class=\"current\"><a href=\"/learn/web-event-notes\">Web Event Notes</a></li>";
            }else{
            echo "<li><a href=\"/learn/web-event-notes<\">Web-Event-Notes</a></li>";
            }
            ?>
        </ul>

     </li>
</ul> 
```

```
<script type="text/javascript">
$(function(){
// hide all links on load
$('ul.child').hide();
// for image
// $("a.slide:first").css("background-image","url('path')");

$('ul.parent a.slide').click(function(){
    $('ul.parent a.slide').css("color","#000");

    $('ul.parent a.slide').hover(function(){
        $(this).css("color","#ef492f");
    });

    $('ul.parent a.slide').mouseout(function(){
        $(this).css("color","#000");
    });

    $(this).mouseout(function(){
        $(this).css("color","#000");
    });

    $(this).css("color","#000");

    // slide all up
    $('ul.child').slideUp('slow');

    // show the links of current heading
    $(this).next().find('a').show();

    // slide down current heading
    $(this).next().slideDown('fast');

    // prevent default action
    return false;
});

if($("ul li a").hasClass("current")) {
$(this).closest("ul").slideDown("fast") //open the menu
}

});

</script> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-24T00:51:17.863

在我看来，实现这一点的最佳方法是制作一个包含链接的 PHP 数组，然后从中构建一个 html 菜单。通过这种方式，PHP 可以根据 url 参数控制哪些链接将持有“当前”类。最后一步将是 jquery 来获取“.current”列表项并使其可见。下面的工作可能看起来很多，但是当你得到它时，它将是强大且可重用的:)

```
//Grab the page parameter somehow.. below = example
$page = $_GET['page'];

//Build menu array containing links and subs
$items = Array( 
    //highest level
    'cms' => Array(
        'title' => 'CMS',
        //Array containing submenu items for cms
        'subs' => Array(
            'intro-to-cms' => Array('title' => 'Intro to CMS'),
            'specific-cms' => Array('title' => 'Specific CMS'),
            'installing-a-cms' => Array('title' => 'Installing a CMS')
        ),
    )
);

//Display the menu
echo navlinks($items, $page);

/**
 * Recursive function creates a navigation out of an array
 * @param type $items
 * @return string containing navigationlist
 */
function navlinks($items, $page=false)
{
  $html = '<ul>';
  foreach ($items AS $uri => $info) {
    //Check if the pagename is the same as the link name and set it to current when it is
    $html .= '<li'.($info['title'] == $page ? ' class="current"' : '').'>';
    echo '  <a href="' . $uri . '">' . $info['title'] . '</a>';
    //If the link has a sub array, recurse this function to build another list in this listitem
    if (isset($info['subs']) && is_array($info['subs'])) {
      $html .= navlinks($info['subs']);
    }
    $html .= '</li>';
  }
  $html .= '</ul>';
  return $html;
} 
```

# actionscript-3 - 可以在 AIR 中重新加载应用程序 swf 吗？

> ID：12486323
> 
> 赞同：1
> 
> 时间：2012-09-18T23:05:00.197
> 
> 标签：actionscript-3, air

我很懒，因为我有一个基本的 actionscript AIR 应用程序，我想在按下按钮时重置它。是否有可能以某种方式告诉 AIR 重置/重新初始化/重新加载应用程序 swf ？

我想有可能通过 Loader 的 loaderBytes 方法再次初始化 swf，并可能从 loadInfo 对象传递字节，或者简单地编写一个循环遍历类并重置它们的方法。我只是想知道上面提到的 hacky 想法是否可以实现，如果可以，如何实现。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T04:52:39.970

这看起来很hacky，虽然我自己没有尝试过，但应该可以工作：

```
 navigateToURL(new URLRequest(stage.loaderInfo.url) , "_level0"); 
```

取自[这里](http://imagineric.ericd.net/2011/02/07/a-reset-for-your-swf/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T05:43:24.500

您可以在安装的 AIR 中使用此代码，它将关闭您当前的应用程序并打开新实例：

```
import mx.core.Application;
import mx.core.WindowedApplication;
import adobe.utils.ProductManager;

public function restart():void {
    var app:WindowedApplication = WindowedApplication(Application.application);
    var mgr:ProductManager = new ProductManager("airappinstaller");
    mgr.launch("-launch " + app.nativeApplication.applicationID + " " + app.nativeApplication.publisherID);
    app.close();
} 
```

# android - 通过 API“滚动”的 Galaxy S3 视频录制或在 Bright Light 中损坏

> ID：12486325
> 
> 赞同：1
> 
> 时间：2012-09-18T23:05:02.857
> 
> 标签：android, android-camera, galaxy

完全按照 Google 的说明进行操作 (QUALITY_HIGH)：

[http://developer.android.com/guide/topics/media/camera.html#custom-camera](http://developer.android.com/guide/topics/media/camera.html#custom-camera)

使用 Galaxy S3（美国版）执行此操作时，在室内照明下一切似乎都很好。但是当相机走到外面并且很亮（可能需要提高快门速度）时，会发生一些奇怪的事情。视频开始像坏电视信号一样“滚动”，并且图像质量非常低。几乎看起来图像传感器过载和混乱。

我尝试使用普通的相机应用程序进行录制，在相同条件下似乎没有问题。但是使用这里描述的 API 会产生这个问题。由于 S3 非常受欢迎——以前有人遇到过这个问题吗？

主相机应用程序是否有某种隐藏设置用于相机设置？我尝试将相机设置展平以查看其中的内容，并且有大量设置，但我不知道没有文档他们都做了什么。已经尝试关闭反带和亮度适应，但这似乎没有做任何事情。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T20:47:27.637

我想我想通了。需要更多测试，但这似乎可以做到。有一个称为“相机模式”的隐藏设置，通常设置为 -1。我将其更改为 1，突然它很好并且像普通的相机应用程序一样运行.. 有人知道这个模式的真正含义吗？

```
Camera.Parameters lParam = prCamera.getParameters();
lParam.set("camera-mode",1);    
prCamera.setParameters(lParam); 
```

如果其他人似乎遇到了问题，那么诀窍是什么。\

# git - 使用 git subtree push 的“致命：坏对象”错误

> ID：12486326
> 
> 赞同：13
> 
> 时间：2012-09-18T23:05:03.447
> 
> 标签：git, subtree

这是一个菜鸟问题，但我有能力解决这个问题。我继承了一个*似乎*是回购损坏的 git 子树的奇怪问题。

这是场景：基于 git 的项目 A 的子树正在项目 B 中使用。部署脚本的一部分使用将子树推送到项目 B 的 repo：

git subtree push -P sub/path/name --squash git@github.com:MyCo/project_b.git projectb_branch

它开始推送提交并失败

```
"fatal: bad object {sha}" 
```

我在源代码库的 git 日志中搜索了 SHA。它显示在提交中：

```
git-subtree-dir: app/assets/ui
git-subtree-split: {sha} 
```

目标 repo (project_b) 确实具有该 SHA 的提交，但源 repo 没有。我浏览了子树 shell 脚本，我可以看到它在尝试使用 git log 查找该对象时失败了（在调用 git log -l --pretty=format:'%T' {sha} 的 toptree_for_commit 函数中）。

在这一点上，我有点不知所措，但渴望找到解决方案。在我有限的知识允许的范围内，我已经对此进行了研究，因此我欢迎任何可以让我更接近解决方案的提示、技巧或 RTFM。

我由衷的感谢！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2013-01-08T04:59:35.770

我刚刚遇到了这个问题，并能够通过以下方式解决：

```
git remote add shared $url
git fetch shared
git subtree push -P $prefix shared $branch 
```

可能对所有人都没有帮助，但让我不必破解回购结构。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-03-27T04:02:01.787

我遇到了类似的问题：`git subtree push ...`曾经在我做过的计算机上工作`git subtree add ...`，但不能在第二台计算机上工作：

```
$ git subtree push --prefix lib git@github.com:lib/lib.git master
...
...
fatal: bad object {sha} 
```

修复是首先从存储库中提取更改（即使没有更改）：

```
git subtree pull --prefix lib git@github.com:lib/lib.git master 
```

即使它没有拉任何东西，推也可以正常工作：

```
git subtree push --prefix lib git@github.com:lib/lib.git master 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-04T02:38:32.240

我已经想通了；我在提交信息中找到了错误 sha 的引用。

解决此问题的最简单方法是：

*   停止使用已创建的子树拆分，
*   将内容移动到不同的子目录，然后
*   重新拆分子树。

与取消提交到有问题的提交然后重新应用它们相比，有点混乱但更不容易出错（建议在回答有点类似的问题时）。

不漂亮，但它完成了工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-06T18:31:16.303

`git pull`为我工作。如果您当前的分支不是远程分支，请使用

```
`git push -u origin <branchname>` 
```

# generics - 当我在 Haskell 中编写“显示”和“阅读”时发生了什么？

> ID：12486329
> 
> 赞同：4
> 
> 时间：2012-09-18T23:05:47.067
> 
> 标签：generics, haskell, type-inference, typeclass, ghci

以下是 GHCi 的简短记录：

```
Prelude> :t read
read :: Read a => String -> a
Prelude> :t show
show :: Show a => a -> String
Prelude> :t show.read
show.read :: String -> String
Prelude> (show.read) "whales"
"*** Exception: Prelude.read: no parse 
```

当我作曲时`show`，`read`我只能假设 GHC 选择了一些既能`Read`也`Show`能成为“中间”类型的任意类型。

它是如何选择这种类型的，我有什么方法可以找出它是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-09-18T23:24:30.197

GHCi 默认规则说选择的类型是`()`. 这是在需要`Show`实例时选择的默认类型。GHCi 将选择`()`一般约束、`Integer`数值或整数约束以及`Double`分数/其他实数约束。这不是由于一些 Haskell 固有的。这就是 GHCi 的实现方式，以便可以轻松地用作计算器。

如果你真的在一个文件中输入了代码并编译了它，就会应用更严格的 GHC 规则，你会得到一个错误，说无法解析中间类型。

您当然可以通过为其中一个函数指定类型来指示 GHC 使用不同的类型，例如：

```
show . (read :: String -> Int) 
```

# php - 通过php在mysql表中添加引号

> ID：12486338
> 
> 赞同：0
> 
> 时间：2012-09-18T23:07:10.157
> 
> 标签：php, mysql

```
$sql_images = "'".$uploaded_image."', '".$uploaded_image2."', '".$uploaded_image3."', '".$uploaded_image4."', '".$uploaded_image5."'";

$db->query("UPDATE menu SET nav_name = $navigation, image_bg = $sql_images WHERE id = $id;") or die(mysql_error()); 
```

我无法更新我的表，我知道问题出在 $sql_images 变量上，因为我添加了引号并将其全部搞砸了，但这就是我想要和需要的方式，有没有办法在表中添加该变量没有任何问题？因为现在它给了我一个错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:11:20.680

像这样试试

```
$sql_images = "\'".$uploaded_image."\', \'".$uploaded_image2."\', \'".$uploaded_image3."\', \'".$uploaded_image4."\', \'".$uploaded_image5."\'";

$db->query("UPDATE menu SET nav_name = '$navigation', image_bg = '$sql_images' WHERE id = $id;") or die(mysql_error()); 
```

# sockets - 恢复 TCP 连接

> ID：12486342
> 
> 赞同：1
> 
> 时间：2012-09-18T23:07:34.923
> 
> 标签：sockets, networking, tcp, network-programming, scapy

我有一个可以处理多个客户端的简单 Python 服务器：

```
import select 
import socket 
import sys 

host = '' 
port = 50000 
backlog = 5 
size = 1024 
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
server.bind((host,port)) 
server.listen(backlog) 
input = [server,sys.stdin] 
running = 1 
while running: 
    inputready,outputready,exceptready = select.select(input,[],[]) 

    for s in inputready: 

        if s == server: 
            # handle the server socket 
            client, address = server.accept() 
            input.append(client) 

        elif s == sys.stdin: 
            # handle standard input 
            junk = sys.stdin.readline() 
            running = 0 

        else: 
            # handle all other sockets 
            data = s.recv(size) 
            if data: 
                s.send(data) 
            else: 
                s.close() 
                input.remove(s) 
server.close() 
```

一个客户端连接到它，他们可以通信。我有第三个盒子，我从那里向`RST`服务器发送信号（使用 Scapy）。TCP 状态图没有说明端点是否应该在看到 RESET 时尝试恢复连接。有什么办法可以强制服务器恢复连接？（我希望它发回一个`SYN`以便它连接到第三个客户端）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:32:31.987

你的问题没有多大意义。TCP 只是不能那样工作。

1.  重新“TCP 状态图没有说明端点是否应该在看到 RESET 时尝试恢复连接”：[RFC 793 #3.4](http://www.ietf.org/rfc/rfc793.txt)明确表示“如果接收器处于任何其他状态 [除了 LISTEN 或 SYN-RECEIVED] ，它会中止连接并建议用户并进入 CLOSED 状态。”。

2.  RST 不会干扰连接，除非它通过该连接到达。我猜你可能会伪造一个，但你必须知道当前的 TCP 序列号，而且你无法从任何一个对等方中获取它，更不用说第三台主机了。

3.  如果你以某种方式成功了，那么连接就会死掉，完成，结束。也看不出这有什么意义。

4.  我无法对您要求服务器向第三台主机发送 SYN 以响应来自第三台主机的 RST 的要求附加任何意义，该 RST 看起来好像来自第二台主机。TCP 也不能像这样工作。

5.  如果您希望服务器连接到第三台主机，它只需要`connect()`像其他人一样调用。在这种情况下，它当然会成为客户。

# ruby-on-rails - 查询的范围或 ajax

> ID：12486346
> 
> 赞同：1
> 
> 时间：2012-09-18T23:08:09.807
> 
> 标签：ruby-on-rails, ruby, ruby-on-rails-3

我不确定我是否正确理解了 Rails 中的范围。在这里，我正在尝试做我有一个模型调用文章并称为标签。

要启动应用程序，它会在显示所有文章的 Article#index 操作中登录您。但是，我希望能够通过单击将动态创建的标签来优化我的视图。我想要的查询是`Article.find(:all, :conditions => ['tags = ?', 'world'])`

我怎样才能做到这一点？还是我应该只使用 ajax 来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:39:25.350

我认为 ajax 在这种情况下是有意义的。

你可以有这样的东西。

**路线.rb**

`match "/articles/tag" => "articles#tag"`

**文章控制器.rb**

```
def tag
  @particularly_tagged_links = Link.find_all_by_tags(params[:tags])
end 
```

**application.js**或任何您使用 jquery 代码的地方。并在用户点击标签什么的时候触发这个功能。

```
function taggit(tag) {
  $.ajax({
    url: "articles/tags?"+tag
  });
} 
```

# java - 无法使用 JSON REST WS

> ID：12486347
> 
> 赞同：2
> 
> 时间：2012-09-18T23:08:11.573
> 
> 标签：java, web-services, rest, jaxb, jersey

我有一个在 XML 发布请求方面运行良好的 api。XML 在 Post 正文中接收并进行相应处理。这是方法的标题

```
@POST
@Path ("{"+num+"}/"+STATUS+"."+XML)
@Consumes (MediaType.APPLICATION_XML)
@Produces (MediaType.APPLICATION_XML)
public Response getStatusXML (@PathParam(num) String num,
        JAXBElement<OrderStatusRequestType> jaxbOrderStatusRequestType,
        @Context UriInfo requestUriInfo,
        @Context SecurityContext securityContext){

    OrderStatusRequestType orderStatusRequestType = jaxbOrderStatusRequestType.getValue();

    return processRequest (num, XML, orderStatusRequestType, securityContext);
} 
```

使用此 POST 正文调用此 WS

```
<orderStatusRequest>
    <vendor>32658</vendor>
    <key>232X1</key>
</orderStatusRequest> 
```

我有 XML 模式，这个请求按要求工作正常。我得到了 jaxbObject，也得到了 orderStatusRequest。但是，当我尝试调用我的 json webservice 时，我得到了 null `orderStatusRequest`。我有一个单独的方法来使用 json。

```
@POST
@Path ("{"+num+"}/"+STATUS+"."+JSON)
@Consumes (MediaType.APPLICATION_JSON)
@Produces (MediaType.APPLICATION_JSON)
public Response getStatusJSON(@PathParam(num) String num,
        JAXBElement<OrderStatusRequestType> jaxbOrderStatusRequestType,
        @Context UriInfo requestUriInfo,
        @Context SecurityContext securityContext){
    OrderStatusRequestType orderStatusRequestType= jaxbOrderStatusRequestType.getValue();

    return processRequest (num, JSON, orderStatusRequestType, securityContext);
} 
```

我在 post 请求中发送以下 json

```
{"orderStatusRequest":{"vendor":"32658","key":"232X1"}} 
```

我在我的 jaxbElement 中得到空对象。我无法理解为什么。为方便起见，这是我的 XML Schema

```
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified" attributeFormDefault="unqualified">

    <xs:complexType name="orderStatusRequestType">
        <xs:sequence>
            <xs:element name="vendor" type="xs:string" minOccurs="1" maxOccurs="1"/>
            <xs:element name="key" type="xs:string" minOccurs="1" maxOccurs="1"/>
        </xs:sequence>
    </xs:complexType>

            <xs:element name="orderStatusRequest" type="orderStatusRequestType"/>

</xs:schema> 
```

* * *

我写了一个客户端并发送 JSON 请求

```
 ClientResponse clientResponse = service.path("api")
    .path("v1")
    .path("personal")
    .path("orders")
    .path(num)
    .path("status.json").accept(MediaType.APPLICATION_JSON).post(ClientResponse.class, jaxbOst); 
```

它给了我错误状态 415，即不支持内容类型。但是，只有 2 处修改即`status.xml`可以`MediaType.APPLICATION_XML`正常工作。

* * *

更新 2：使用 Fiddler，我可以使用 JSON 访问 Web 服务。但是泽西岛并没有将输入的 POST 正文行进到特定的对象中。我在`vendor`和`key`字段中得到空值。

* * *

**更新 3** 我可以使用 Fiddler 的 JSON。JSON 是`{"vendor":"32658","key":"232X1"}`. 我之前将它包裹在另一个对象下。**但**我仍然无法使用 Jersey Client 发送请求。我猜是`XML`当我尝试发布时我的 JAXB 对象正在给出。我如何确保当我使用它时`objectFactory.createOderRequestStatus`，它会被翻译成 JSON 而不是 XML？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T02:09:15.683

415 表示您的客户端未在请求中发送正确的**内容类型**。如果您查看您的路径，对于 XML 和 JSON 方法，它们是相同的，因此您需要确保您的客户端发送正确的内容路径，以便区分哪种方法将为您的请求提供服务。否则泽西岛只会选择第一个，这就是这里发生的事情。

[在另一个线程](https://stackoverflow.com/questions/5250923/http-content-negotiation-conflicts-in-jax-rs-jersey)中有关于这个主题的讨论。我自己没有尝试过，但是您可以向您的客户添加一些标头以查看是否有效吗？也许类似于以下内容：

```
ClientResponse clientResponse = service.path("api")
                                .path("v1")
                                .path("personal")
                                .path("orders")
                                .path(num)
                                .path("status.json")
                                .accept(MediaType.APPLICATION_JSON)
                                .header("content-type", MediaType.APPLICATION_JSON)
                                .post(ClientResponse.class, jaxbOst); 
```

# php - 奇怪的PHP号码问题

> ID：12486348
> 
> 赞同：0
> 
> 时间：2012-09-18T23:08:24.160
> 
> 标签：php, if-statement, numbers

这是简单的代码：

```
$result = 0;
$result = $obj->delete($this_id);
echo "Result:" . $result;
var_dump($result);
if ( (int) $result < 0 || $result == null ) {
   echo "Here" . $result;
       var_dump($result);exit;  
} 
```

结果如下：

```
Result:0int(0)
Here0int(0) 
```

它不应该进入`if`块。因为 $result 是`=`0。不是`<`0。

我错过了什么还是 PHP 以不同的方式处理这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:11:50.357

与 null 的比较应该是`===`而不是`==`. 由于 null 可以计算为 0，因此比较计算 (0 == null) = true

```
if ( (int) $result < 0 || $result === null ) { 
```

有关详细信息，请参阅[http://php.net/manual/en/language.operators.comparison.php](http://php.net/manual/en/language.operators.comparison.php)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:11:12.753

看起来转换为 int 类型会使您的变量测试错误地针对 0。

替换`if( (int) $result ...`为`if( $result ...`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T23:12:25.703

它不是第一个匹配的验证：

```
var_dump(0 == null); //true
var_dump(false == null); //true 
```

# sql - SpringMVC GetJdbcTemplate() 从查询中获取值

> ID：12486350
> 
> 赞同：0
> 
> 时间：2012-09-18T23:08:26.017
> 
> 标签：sql, spring, spring-mvc, jdbc, jdbctemplate

我有一个函数，我想从我使用 getJdbcTemplate 的查询中提取值，我通过传递一个字符串查询和一个对象然后从对象中访问值来提取值。我想在您实际传递字符串时访问该值。我的代码是：

在这里我使用 Map 但我没有传递对象 Map results = getJdbcTemplate().queryForMap(sql, userName) 并且 userName 是一个字符串。我将不得不使用地图，但这是如何写的。

```
public boolean OfficerExist(Officers officer){

    try{

        logger.debug("About to check if officers existing");

        String sql = "SELECT userName FROM crimetrack.tblofficers WHERE userName = ?";

        logger.info("User Name Found 1");

        * Map<String, Object> results = getJdbcTemplate().queryForMap(sql, userName);

        logger.info("User Name Found 2");

        String dbUserName = (String)results.get("userName");

        logger.info("Checking if officers exist "+sql);

        if (dbUserName.equals(userName)) {

            logger.info("User Name Exists");
            return true;

        }else{
            logger.info("User Name Does NOT Exists");
            return false;
        }
        logger.info("User Name Found 3");

        return true;

    }catch(Exception e){

        logger.info(e.getMessage());
        return false;
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T15:53:39.090

要尝试的一件事是代替 Map，也许只尝试查询 Object，因为您知道您只是在查询用户名。

IE

```
getJdbcTemplate().queryForObject("select username...", String.class, userName)

public String findCustomerNameById(int custId){

String sql = "SELECT NAME FROM CUSTOMER WHERE CUST_ID = ?";

String name = (String)getJdbcTemplate().queryForObject(
        sql, new Object[] { custId }, String.class);

return name; 
```

}

# django - 覆盖保存方法无限循环？

> ID：12486352
> 
> 赞同：0
> 
> 时间：2012-09-18T23:08:40.273
> 
> 标签：django

班上：

```
class Operation(models.Model):
  related_operation = models.ForeignKey('self', null = True)

  __related_operation = None

  def __init__(self, *args, **kwargs):
    super(Operation, self).__init__(*args, **kwargs)
    self.__related_operation = self.related_operation

  def save(self, force_insert=False, force_update=False):
    if self.related_operation != self.__related_operation:
      del self.__related_operation

    super(Operation, self).save(force_insert, force_update)
    self.__related_operation = self.related_operation 
```

编码：

```
 (...)
 OperationFormSet = modelformset_factory(Operation, form=OperationCategoryOnlyForm)
  if request.method == "POST":
    formset = OperationFormSet(request.POST, queryset=Operation.objects.filter(category=category_id))
    if formset.is_valid():
      instances = formset.save(commit = False)
      for instance in instances:
        if instance.related_account is not None:
          related_operation = Operation()
          related_operation.related_operation = instance
          related_operation.save()
          instance.related_operation = related_operation

        instance.save()

      formset = OperationFormSet(queryset=Operation.objects.filter(category=category_id))
  else:
    formset = OperationFormSet(queryset=Operation.objects.filter(category=category_id)) 
```

和问题：

没有覆盖方法保存一切正常，但如果我改变了相关的操作形式，它当然会进行第二，第三等等相关的操作。

所以我决定覆盖保存方法 - 并添加 __related_operation。在保存期间，它会检查related_operation 是否发生了变化——如果是这样——它应该删除旧的related_operation 而不是保存（创建一个全新的related_operation）......它几乎可以工作了！（新的related_operation被添加到数据库，但它在保存后循环。它永远不会结束。我不知道它在做什么。我必须重新启动apache才能从服务器获得任何答案。也许这是愚蠢的错误输入或非常复杂的东西 -我堆积...

（当然操作类有多个字段如related_account，所以if instance.related_account is not None: 是正确的）

**更新：**

我发现，问题出在这里：

```
def __init__(self, *args, **kwargs):
  super(Operation, self).__init__(*args, **kwargs)
  #self.__related_operation = self.related_operation 
```

如果我注释掉上面的那一行——一切正常——但当然是错的——为什么它会阻止某事。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-21T20:43:14.873

我找到了问题所在并找到了解决方案...

我试图在**init**中链接相同类型的对象- 所以在初始化期间我创建了该对象的另一个实例，因此它会创建另一个实例，直到它死掉。

所以解决方案（现在 - 也许有人最好）是：

```
class Operation(models.Model):
  related_operation = models.ForeignKey('self', null = True)

  __related_operation = None

  def __init__(self, *args, **kwargs):
    super(Operation, self).__init__(*args, **kwargs)
    self.__related_operation = self.related_operation_id

  def save(self, force_insert=False, force_update=False):
    super(Operation, self).save(force_insert, force_update)
    if self.related_operation is not None:
      if self.related_operation_id != self.__related_operation:
        if self.__related_operation is not None:
         Operation.objects.get(id = self.__related_operation).delete()

    if self.related_operation is not None:
      self.__related_operation = self.related_operation_id

  def __unicode__(self):
    return str(self.id) 
```

如您所见 - 现在我使用 id 而不是对象，因此分配不会触发对象的创建...

我认为这对其他人可能会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:32:03.263

据我了解，您正在尝试执行某种保存前/保存后的操作。这乞求使用 Django 的[信号](https://docs.djangoproject.com/en/1.4/topics/signals/)

例如在`models.py`

```
import django.db.models.signals.pre_save

def my_handler(sender, **kwargs):
  if not kwargs['instance'].related_operation:
    new_related_operation = Operation(related_operation = kwargs['instance'])
    new_related_operation.save() # this will cause calling signal again
    kwargs['instance'].related_operation = new_related_operation

pre_save.connect(my_handler, sender=Operation) 
```

高温高压

# mysql - 按找到的选择数量排序

> ID：12486353
> 
> 赞同：0
> 
> 时间：2012-09-18T23:08:45.610
> 
> 标签：mysql, sql, search

我正在实现基于标签的搜索，用户可以在其中插入多个标签来搜索特定实体。一个实体可以有多个标签。但是没有必要将用户搜索的所有标签都列在结果中。

例如，在用户输入三个标签的情况下，例如“鞋”、“皮革”、“正式”，具有这些标签中的一个或多个的每个实体都可以在列表中。

我正在使用联合返回具有这些关键字中的任何一个的实体的完整列表，但问题是我希望它们根据类别中找到的标签数量进行排序。

例如，具有所有三个标签“鞋子”、“皮革”、“正式”的实体应该位于只有其中一个或两个标签的实体之上。是否有任何 sql 功能来执行这种搜索？

[编辑]

我的表格布局是：

实体表

*   实体名称
*   Entity_id(auto inc 主键)

标签表

*   标签
*   Entity_id

我无法解决我的目的。现在使用这个查询：

```
select entity.entity_name from entity.entity_id join tags on tags.entity_id=entity.entity_id where tags.tag="first tag"
union 
select entity.entity_name from entity.entity_id join tags on tags.entity_id=entity.entity_id where tags.tag="second tag"
union 
select entity.entity_name from entity.entity_id join tags on tags.entity_id=entity.entity_id where tags.tag="third tag" 
```

正如我所说，这并不能解决我的目的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:29:11.283

这应该为你做：

```
 select entity_name, count(*) count
   from (
         select e.entity_name, t.tag
           from tag t
           join entity e on (t.entity_id = e.entity_id)
          where t.tag in ('tag', 'tag', 'tag')
         )x
  group by entity_name
  order by count desc 
```

它按实体计算匹配的标签，然后首先将它们与最高匹配进行排序。

另请注意，布尔样式全文匹配将提供这样的功能。

# .net - WPF 数据绑定 - 从父级获取值

> ID：12486357
> 
> 赞同：2
> 
> 时间：2012-09-18T23:08:55.803
> 
> 标签：.net, wpf, xaml, c#-4.0, binding

我有以下 .xaml：

```
<TreeView ItemsSource="{Binding EntityInstanceGroupings}">
    <TreeView.ItemTemplate>
        <DataTemplate>
            <TreeViewItem ItemsSource="{Binding EntityInstances}">
                <TreeViewItem.HeaderTemplate>
                    <DataTemplate>
                        <DockPanel LastChildFill="True">
                            <TextBlock Text="{Binding ...}" />
                            <Button Content="Add" DockPanel.Dock="Right" VerticalContentAlignment="Top">
                                ...
                            </Button>
                        </DockPanel>
                    </DataTemplate>
                </TreeViewItem.HeaderTemplate>
                <TreeViewItem.ItemTemplate>
                    ...
                </TreeViewItem.ItemTemplate>
            </TreeViewItem>
        </DataTemplate>
    </TreeView.ItemTemplate>
</TreeView> 
```

在线：

```
<TextBlock Text="{Binding ...}" /> 
```

我正在尝试绑定到 EntityInstanceGroupings 视图模型中的属性“GroupName”。我想不出这样做（如果可能的话）。任何帮助将不胜感激 ：）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T23:12:21.553

您应该能够使用`RelativeSource`.

```
<TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem},
    Path=DataContext.GroupName}" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T20:01:35.427

虽然我试图做的事情已经实现，但我确实找到了更好的解决方案来实现我想要的。

```
<UserControl.Resources>
    <HierarchicalDataTemplate x:Key="entityTemplate">
        <TextBlock Text="{Binding LayoutName}" />
    </HierarchicalDataTemplate>

    <HierarchicalDataTemplate x:Key="groupingTemplate" ItemsSource="{Binding EntityInstances}" ItemTemplate="{StaticResource entityTemplate}">
        <DockPanel LastChildFill="True">
            <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
            <Button Content="Add" DockPanel.Dock="Right" VerticalContentAlignment="Top">
                ...
            </Button>
        </DockPanel>
    </HierarchicalDataTemplate>    
</UserControl.Resources>

<!-- Instantiate the TreeView control -->
<TreeView ItemsSource="{Binding EntityInstanceGroupings}" ItemTemplate="{StaticResource groupingTemplate}" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T06:18:46.583

如果我可以按照您的逻辑，您`TreeView`将获得**EntityInstance group**的列表。`TreeView`s rootNodes 是这些组。在`TreeView.ItemTemplate`你想显示每个组的名称。

在这种情况下`DataContext`， the`TreeViewItem`和 the`TextBox`应该是一**组 EntityInstances**。

这意味着您只需将`Binding`直接设置为道具：

```
<TextBlock Text="{Binding GroupName}" /> 
```

# cakephp - tcpdf - 背景图片 - CakePdf

> ID：12486366
> 
> 赞同：2
> 
> 时间：2012-09-18T23:09:36.037
> 
> 标签：cakephp, tcpdf

我正在尝试使用 CakePdf 和 TcPdf 引擎设置带有背景图像的 pdf 生成。我已经设法使用以下设置将图像放到背景上：

```
// set background image
$img_file = APP . 'webroot/img/BC_Letterhead.jpg';
$TCPDF->Image($img_file, 0, 0, 210, 297, '', '', '', false, 300, '', false, false, 0); 
```

问题是图像似乎覆盖了整个背景。它似乎距页面右侧约 1 英寸，距页面底部约 2 英寸。我使用的图像尺寸正确（我仔细检查了它）

这可能是保证金问题或类似问题吗？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2015-05-02T15:23:34.873

关键是删除页眉和页脚，将边距设置为零并将自动分页符设置为 false。

例如，要打印覆盖整个 A4 页面的图像：

```
// create new PDF document
$pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);

// remove default header/footer
$pdf->setPrintHeader(false);
$pdf->setPrintFooter(false);

// set margins
$pdf->SetMargins(0, 0, 0, true);

// set auto page breaks false
$pdf->SetAutoPageBreak(false, 0);

// add a page
$pdf->AddPage('P', 'A4');

// Display image on full page
$pdf->Image('background.jpg', 0, 0, 210, 297, 'JPG', '', '', true, 200, '', false, false, 0, false, false, true);

//Close and output PDF document
$pdf->Output('page.pdf', 'I'); 
```

文档中还有一个使用自定义标头的示例：

[http://www.tcpdf.org/examples/example_051.phps](http://www.tcpdf.org/examples/example_051.phps)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-03-04T08:41:02.400

这对我有用。

```
class MYPDF extends TCPDF {
//Page header
public function Header() {
    // get the current page break margin
    $bMargin = $this->getBreakMargin();
    // get current auto-page-break mode
    $auto_page_break = $this->AutoPageBreak;
    // disable auto-page-break
    $this->SetAutoPageBreak(false, 0);
    // set background image
    $img_file = K_PATH_IMAGES.'pozadina.jpg';
    $this->Image($img_file, 0, 0, 98, 59, '', '', '', false, 300, '', false, false, 0);
    // restore auto-page-break status
    $this->SetAutoPageBreak($auto_page_break, $bMargin);
    // set the starting point for the page content
    $this->setPageMark();
}
}
$pdf = new MYPDF('L', 'mm', array(59,98));
$pdf->Output('filename.pdf', 'D'); //To force download 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-19T22:39:08.823

我最终使用以下代码或多或少地让它工作。唯一的问题是我在底部还有大约 1 厘米没有背景图像覆盖它，宽度很好。

```
 // -- SET BACKGROUND IMAGE ------------------------------>
        $TCPDF->SetFooterMargin(0);

        // get the current page break margin
        $bMargin = $TCPDF->getBreakMargin();

        // get current auto-page-break mode
        $auto_page_break = $TCPDF->getAutoPageBreak();

        // disable auto-page-break
        $TCPDF->SetAutoPageBreak(true, 0);

        // set background image
        $img_file = APP . 'webroot/img/BC_Letterhead.jpg';
        $TCPDF->Image($img_file, 0, 0, 225, 305, '', '', '', false, 300, '', false, false, 0);

        // set the starting point for the page content
        $TCPDF->setPageMark();
        $TCPDF->setPrintFooter(false);
        // END BACKGROUND MODS --------------------------------> 
```

# python - Python查找列表的所有组合

> ID：12486370
> 
> 赞同：2
> 
> 时间：2012-09-18T23:09:57.097
> 
> 标签：python, for-loop

> **可能重复：**
> [一组python的幂集和笛卡尔积](https://stackoverflow.com/questions/10342939/power-set-and-cartesian-product-of-a-set-python)

解决老问题。我想通了一切。现在我有一个更疯狂的问题。这是我应该得到的：

输入： scoreList(["a", "s", "m", "t", "p"])

输出：[['a', 1], ['am', 4], ['at', 2], ['spam', 8]]

这个 I/O 工作得很好，但是如果我像这样添加第 6 个元素：

输入： scoreList(["a", "s", "m", "t", "p", "e"])

程序像疯了一样出故障。请告诉我如何解决这个问题。感谢任何帮助

我的代码：

```
from itertools import chain, combinations

def ind(e,L):
    if L==[] or L=="":
        return 0
    elif L[0]==e:
        return 0
    else:
        return ind(e,L[1:])+1

def letterScore(letter, scorelist):
    if scorelist[0][0] == letter:
        return scorelist[0][1]
    elif (len(scorelist) == 1) and (scorelist[0][0] != letter):
        return 'lol. stop trying to crash my program'
    else:
        return letterScore(letter, scorelist[1:])

scorelist = [ ["a", 1], ["b", 3], ["c", 3], ["d", 2], ["e", 1], ["f", 4], ["g", 2], ["h", 4], ["i", 1], ["j", 8], ["k", 5], ["l", 1], ["m", 3], ["n", 1], ["o", 1], ["p", 3], ["q", 10], ["r", 1], ["s", 1], ["t", 1], ["u", 1], ["v", 4], ["w", 4], ["x", 8], ["y", 4], ["z", 10] ]

def wordScore(S, scorelist):
    if (len(S) == 1):
        return letterScore(S[0],scorelist)
    elif (letterScore(S[0],scorelist) == 'lol. stop trying to crash my program'):
        return 'you really want to crash me, dont you'
    else:
        return letterScore(S[0],scorelist) + wordScore(S[1:], scorelist)

def perm(l):
    sz = len(l)
    if sz <= 1:
        return [l]
    return [p[:i]+[l[0]]+p[i:]
        for i in xrange(sz) for p in perm(l[1:])]

from itertools import combinations, permutations

def findall(my_input):
    return [''.join(p) for x in range(len(my_input)) for c in combinations(my_input, x+1)
            for p in permutations(c)]

d = ["a", "am", "cab", "apple", "at", "bat", "bar", "babble", "can", "foo", "spam", "spammy", "zzyzva"]

def match(lis): 
    return match2(findall(lis))

def match2(lis): 
    if lis == []:
        return []
    elif(len(d) != ind(lis[0],d)):
        return [lis[0]] + match2(lis[1:])
    else:
        return match2(lis[1:])

def scoreList(lis):
    return match3(match(lis))

def match3(lis):
    if (lis == []):
        return []
    else:
        return [[lis[0],wordScore(lis[0],scorelist)]] + match3(lis[1:]) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:15:21.977

这是作业，还是可以使用itertools？

```
>>> my_input = ['a','b','c']
>>> from itertools import combinations, permutations
>>> [''.join(p) for x in range(len(my_input)) for c in combinations(my_input, x+1)
                for p in permutations(c)]
['a', 'b', 'c', 'ab', 'ba', 'ac', 'ca', 'bc', 'cb', 'abc', 'acb', 'bac', 'bca', 'cab', 'cba'] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-18T23:27:48.350

可能不是最易读的，但这是另一种解决方案，使用`itertools`这个[答案](https://stackoverflow.com/a/716489/8418)：

```
>>> from itertools import permutations
>>> inpt = ['a', 'b', 'c']
>>> sum([map(''.join, list(permutations(inpt, l + 1))) for l in xrange(len(inpt))], [])
['a', 'b', 'c', 'ab', 'ac', 'ba', 'bc', 'ca', 'cb', 'abc', 'acb', 'bac', 'bca', 'cab', 'cba'] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-18T23:39:45.617

较早的答案显示了`itertools`包的用法，但是如果您不想使用它（作业是您这样做的唯一原因），我发现[该](http://en.wikipedia.org/wiki/Permutation#Generation_in_lexicographic_order)算法是最容易实现的算法。

# jquery - jquery if - 事件快捷方式存在？

> ID：12486373
> 
> 赞同：1
> 
> 时间：2012-09-18T23:10:03.330
> 
> 标签：jquery

我在代码中有很多条件，其中元素的显示/隐藏取决于输入值是否为空。

这些行是否存在任何较短的版本？

```
if ($("input#x").val())
{
   $("#lbl_y").show();
}
else
{
   $("#lbl_y").hide();
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-18T23:13:16.467

```
$("#lbl_y").toggle($("input#x").val()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:14:16.513

您可以使用这样的结构：

```
$("#lbl_y")[$("input#x").val() ? 'show' : 'hide'](); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-18T23:14:35.363

本质上，您可以将其简化为一行-

```
($("input#x").val() == ''?  $("#lbl_y").show() :  $("#lbl_y").hide() ) 
```

我在这里使用三元运算符。在这种情况下，它的行为很像一个简单的条件语句。它检查某个条件的评估，并根据`true/false`语句返回的值执行一项或另一项任务。

```
(condition ? true : false) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-18T23:14:38.437

像这个三元运算符你的意思是：

你可以`.is(':empty')`用来做空检查！

```
var resultofexpression = conditionasboolean ? truepart: falsepart; 
```

在你的情况下：

```
$("input#x").is(':empty') ?   $("#lbl_y").show(); : $("#lbl_y").hide(); 
```

# c++ - 在 C++ 中，强制转换为重载函数的子类？

> ID：12486375
> 
> 赞同：0
> 
> 时间：2012-09-18T23:10:05.280
> 
> 标签：c++, oop, inheritance, overloading

所以情况如下：

我有一个用于光线追踪器程序的抽象超类“模型”，各种几何图形都从中继承属性和函数。显然，不会有模型类型的对象，但是会有一个模型类型的数组，其中将存储场景的整个几何图形。

然后光线追踪器会投射出许多光线。每条射线都将遍历这个模型数组，并使用自己的方法 Ray::intersect 检查它是否与它们发生碰撞。因此，Ray 的声明大致包括以下内容：

```
Point intersect(Sphere sphere) {...}

Point intersect(Cube cube) {...}

Point intersect(Torus torus) {...} 
```

ETC

问题是，由于所有这些类都继承自 Model，并且数组的类型是 model，所以元素在被访问时将是 model 类型。模型没有相交，所以我不会像没有这样的方法错误那样得到错误的方法错误。所以问题是：如何将每个成员转换为适当的类型？

有没有一种合理的方法可以做到这一点，或者我必须尝试为每个对象显式地转换每个子类，并使用任何棒子？对于似乎是一个常见问题的问题，这似乎非常骇人听闻。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T01:10:52.577

你应该反过来做。每个模型都应该具有以下功能，而不是让 Ray`Point intersect(Sphere sphere)`等`virtual Point intersect(const Ray& ray) const`。

PS。顺便说一句，请确保您的数组是 Model* 数组或某种形式的智能指针，否则您将切片您的模型。

聚苯乙烯。真正的光线追踪器会找到一种方法将它们的光线组合在一起，因此您没有那么多（虚拟）函数调用。

**编辑：**

此外，可以强制转换为特定模型，但在这种情况下使用它会破坏 OOP 特性，并导致丑陋的 switch 语句。例如，假设你有一个`Model* model`，并且你认为它可能是一个`Sphere*`，那么你可以这样做：`Sphere* sphere = dynamic_cast<Sphere*>(model);`。如果`model`确实是 a `Sphere*`，那么`sphere`现在将指向它，否则`sphere`将是`NULL`。IMO 您应该尽量避免`dynamic_cast`在几乎所有情况下使用；如果你发现你必须使用它，这通常表明你的设计搞砸了（重新设计，或者如果你没有时间，从错误中吸取教训）。

# php - jquery + php - 使用 JSON 数组

> ID：12486376
> 
> 赞同：1
> 
> 时间：2012-09-18T23:10:18.850
> 
> 标签：php, jquery, html

我在 Jquery 中创建一个 JSON 数组，然后将其发送到 php。在 php 中我对其进行解码，但我收到一条错误消息。下面是到达 php 的数组的回显和错误消息。注意：我只传递了一项（以使其更小，但在进一步的数组中会有更多项：

![在此处输入图像描述](../Images/7b39108dc0166e4a416c68e2eb00339c.png)

这是当前的 PHP 代码：

```
 print_r($_POST['cropData']);
    $cropData = json_decode($_POST['cropData']);
    print_r($cropData); 
```

这里也是生成 json 数组的 jquery：

```
 jsonArray[thumbNum] = [{'src':val.attr('src')},
                            {'width':val.width()},
                            {'height':val.height()},
                            {'dataCX':val.attr('data-cx')},
                            {'dataCY':val.attr('data-cy')},
                            {'dataCW':val.attr('data-cw')},
                            {'dataCH':val.attr('data-ch')}
      ]
      thumbNum++;
    }

    $.post('scripts/php/join_processing.php', {
      'cropJoin': '1',
      'cropData': jsonArray},               
      function(data) { 
```

关于我在这里做错了什么有什么建议吗？我是在发送格式错误的 JSON 数组还是未正确编码？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:15:28.327

因为[jQuery.post()](http://api.jquery.com/jQuery.post/)的数据参数是“智能猜测”，所以如果你在 jQuery.post() 中传递 JSON 字符串或 JS 对象作为数据参数，它已经将其作为 HTTP POST 数组发布而不是单个 json 字符串。所以，你在 php 中收到的已经是一个可用的数组，所以不需要解码它。

顺便提一句; 您可以很容易地看到这一点，因为您 print_r 是 POST 变量，并且它显然将其打印为数组而不是字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:11:43.223

你不需要解码它 - 它已经是一个数组。所以请随意使用它。

`$.post`将其作为数组传递，而不是作为 json 字符串传递。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T23:14:13.820

JavaScript 中的数组与 PHP 中的数组不同。您可能不是要发送一个 JS 数组，而是一个 JS 对象（它将变成一个 PHP 数组）。

请尝试使用此代码...

```
jsonArray[thumbNum] = {
  src: val.attr('src'),
  width: val.width(),
  height: val.height(),
  // ..
}; 
```

虽然将大致像这样转换为 php 对象：

```
array(
  array(
    "src" => "",
    "width" => "",
    "height" => ""
  ), array(
    "src" => "",
    "width" => "",
    "height" => ""
  )
); 
```

其他海报也是*正确*的，您实际上并不需要`json_decode`所有内容，因为 $.post 会为您正确转换它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-18T23:14:34.500

您实际上并没有在那里创建 JSON 数组。JSON 是一种可以表示数组的字符串表示法。您实际上是在创建一个常规的 JavaScript 数组。`$.post`将正确地将其传递给您的 PHP 脚本，以便`$_POST`正确填充。`json_decode`根本不需要。

# java - 通过 JNLP 在系统范围的剪贴板和 Java 小程序内部的沙箱之间进行无缝数据传输 - 可能吗？

> ID：12486384
> 
> 赞同：0
> 
> 时间：2012-09-18T23:11:20.837
> 
> 标签：java, applet, clipboard, copy-paste, jnlp

我目前正在尝试实现`ClipboardService`由相当新的 JNLP API 提供的功能，以访问我通过 JNLP 启动的 Java 小程序内的系统范围剪贴板。我想要做的是，只要按下 Ctrl+C，就将全局剪贴板的内容复制到沙盒剪贴板，反之亦然（在 Ctrl+V 上），只是为了使这种集成尽可能无缝。

我已经设法实际获取和设置系统范围剪贴板的内容。但是我不知道在哪里可以找到默认使用的沙盒剪贴板。默认工具包仅提供对系统剪贴板的访问，这当然会引发安全异常。我认为有一些方法可以模仿这一点，但我真的很高兴有一个不需要任何“黑客”的无缝解决方案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-21T18:17:55.060

如果您想访问系统剪贴板，您将获得安全异常，除非您的小程序已签名。如果您希望应用程序和系统之间“无缝集成”，那么您**确实需要**系统剪贴板。如果没有访问权限，您只能在您的应用程序中复制/粘贴。

举个例子，看看我的一个学生去年和我一起写的[MLA 引文生成器。](http://proctinator.com/citation/)如果这描述了您要执行的操作，我将发布相关的源代码。

# javascript - 通过解析dom提取java脚本代码

> ID：12486386
> 
> 赞同：0
> 
> 时间：2012-09-18T23:11:31.417
> 
> 标签：javascript, dom

我使用通常的方式在我的页面中包含了外部 java 脚本文件 `script src = "myjs.js"` - 我可以假设 java 脚本代码现在应该成为 DOM 的一部分吗？我可以解析 dom 以在 var 中获取 java 脚本内容吗？

我不想使用 HTMLHttpRequest 并且想在简单的 java 脚本中使用，即也没有 dojo 或 jquery。任何人都可以告诉我是否有可能，如果是的话，如果您能帮助我解决这个问题，我将不胜感激。

问题的核心是我想在我的页面上吐出包含在 head 标记下的脚本标记中的 java 脚本 - 我想这样做而不尝试再次加载 .js，即使用 HTMLHttpRequest。

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:21:35.443

不，从文件加载的脚本文本不包含在文档中。

您可以使用 AJAX 调用的 textContent 获取文字文本（如果脚本共享页面的域），它不会再次下载它，而是从缓存中提供它。

你可以在 html 中直接包含脚本，并使用 scriptelement.text，如果你真的不喜欢 XMLHttpRequest，你可能是指当你提到 HTMLHttpRequest 时。

# wpf - WPF Popup PlacementMode.Bottom 未按预期运行

> ID：12486390
> 
> 赞同：4
> 
> 时间：2012-09-18T23:12:02.007
> 
> 标签：wpf, popup

我有一个非常简单的应用程序，按钮上有一个处理程序，显示一个弹出窗口：

```
private void Button_Click(object sender, RoutedEventArgs e)
{
    Popup popup =
        new Popup
        {
            Width = 200,
            Height = 20,
            Child = new Rectangle { Fill = Brushes.Fuchsia },
            PlacementTarget = (Button)sender,
            Placement = PlacementMode.Bottom,
            IsOpen = true,
        };
} 
```

它产生以下结果：

## ![实际弹出行为](../Images/e3fa7fe12bbc53f734aa8d462bd961c3.png)

通过将放置模式更改为 PlacementMode.Custom 并添加回调（省略），我可以实现以下功能：

## ![所需的弹出行为](../Images/dd97e901dc35d1b654191e0156057573.png)

但是，我希望这将是 PlacementMode.Bottom 的默认行为。来自 MSDN：

> PlacementMode = 底部
> 
> Popup 控件的位置，控件将其上边缘与 PlacementTarget 的下边缘对齐，并将其左边缘与 PlacementTarget 的左边缘对齐。

## ![MSDN 图片](../Images/4d53469c7f9648d744b3003c7b611260.png)

我是误读了文档还是做错了什么？为什么我的简单应用程序看起来/行为不像文档所说的那样（至少我目前是如何阅读的）它应该？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:35:07.883

这是在 PC 还是平板电脑上运行？显然，平板电脑上的“惯用手”设置会改变弹出窗口的对齐方式。（也许还要看看从右到左的语言是否是一个因素？）

[http://social.msdn.microsoft.com/forums/en-US/wpf/thread/19ef3d33-01e5-45c5-a845-d64f9231001c](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/19ef3d33-01e5-45c5-a845-d64f9231001c)

除此之外，您是否尝试过使用 XAML 方法而不是代码隐藏？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-17T09:09:41.130

我今天遇到了同样的问题 - 我认为您可以使用其他 2 个属性来调整弹出窗口的位置（Horizo​​ntalOffset 和 VerticalOffset - 可以采用正数和负数）

[http://www.c-sharpcorner.com/resources/699/how-to-position-a-popup-in-wpf.aspx](http://www.c-sharpcorner.com/resources/699/how-to-position-a-popup-in-wpf.aspx)上的示例

# http - 通过 HTTPS 的 UTF-8 不起作用，但通过 HTTP 可以

> ID：12486391
> 
> 赞同：0
> 
> 时间：2012-09-18T23:12:03.303
> 
> 标签：http, utf-8, https

我很难理解为什么当我通过 HTTP 访问一个简单的 PHP 页面时，它的文本看起来很好，但当我通过 HTTPS 访问它时，它却被扭曲了。

该页面包含希腊文本，文件的编码是 UTF-8，并且我在 HTML 标头中有内容元标记：

```
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"> 
```

这可能是什么原因？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T00:35:48.760

HTTP 与 HTTPS 通常对网页的字符编码没有影响，因为 HTTPS 仅加密套接字连接，仅此而已。字节仍然按原样从网络服务器传输到网络浏览器，只是加密。因此，如果网页在 HTTPS 下的呈现方式与在 HTTP 下的呈现方式不同，则 Web 服务器在每种协议下发送不同的数据。

在您的特定情况下，实际上是这种情况。在 HTTP 下，网络服务器发送 UTF-8 编码的 HTML 和一个未指定字符集的 HTTP标头，这允许网络浏览器使用 HTML标记`Content-Type: text/html`中指定的 UTF-8 字符集。`meta`

但是，在 HTTPS 下，网络服务器发送的是 UTF-8 编码的 HTML 和一个 HTTP`Content-Type: text/html; charset=iso-8859-15`标头。HTTP 标头中的字符集会覆盖 HTML`meta`标记中的 UTF-8 字符集，因为 HTTP 标头具有优先权。如果您告诉您的网络浏览器忽略 HTTPS 提供的`Content-Type`字符集并强制将 HTML 解释为 UTF-8，它的呈现方式与 HTTP 提供的网页相同。所以问题是您的网络服务器`Content-Type`在 HTTPS 下的标头中发送了错误的字符集，但在 HTTP 下没有。HTML 本身在这两种情况下都很好。因此，要么网络服务器配置不正确，要么 PHP 脚本在通过 HTTPS 发送数据时存在字符集错误。

# jquery - 如何取消选择所有选择

> ID：12486397
> 
> 赞同：0
> 
> 时间：2012-09-18T23:12:28.657
> 
> 标签：jquery

我之前曾问过这个问题（请参阅[此线程](https://stackoverflow.com/questions/9745253/how-does-one-select-unselect-all-options-in-a-select-list-using-jquery?rq=1)），但我再次陷入困境，并且该代码在另一个示例中似乎不起作用。

GUI 现在有两个不同的选项列表。stylabid 和 pjtlabid。如果我单击其中一个，我希望清除另一个列表中的任何选定项目。

这是jquery代码：

```
$('input[name="stylabid"]').change(
    function(){
      $('#pjtlabid').find('option').prop('selected',false)
    }); 
```

但这没有效果......有人看到这里有什么问题吗？

TIA, rixter PS -- 既然你们中的一些人问过，这里是 HTML 代码：

```
<div id=content-container2>
      <fieldset>
      <LEGEND><b>Select Study Sample</b></LEGEND>
    <p>
    <P CLASS=select_header>Study - Box - Well - Lab ID<br>
    <SELECT multiple size=20 NAME="stylabid" onchange=show_stylabid() onclick=clear_fetch() STYLE="width: 115px">
    <?php 
      $i=0;
      while ($i < $numstylabids) {
        $styarr = pg_fetch_row($stylabidresult);
        echo "<option value=$styarr[0]>$styarr[1]\n";
        $i++;           
      }
      ?>
    </select>
    </p>                
      </fieldset>
    </div> 
```

和第二个选择列表：

```
<fieldset>
      <LEGEND><b>Select Project Sample</b></LEGEND>
    <p>
    <P CLASS=select_header>Project - Box - Well - Lab ID<br>
    <SELECT multiple size=20 NAME="pjtlabid" onchange=show_pjtlabid() onclick=clear_fetch() STYLE="width: 115px">
    <?php 
      $j=0;
      while ($j < $numpjtlabids) {
        $pjtarr = pg_fetch_row($pjtlabidresult);
        echo "<option value=$pjtarr[0]>$pjtarr[1]\n";
        $j++;           
      }
      ?>
    </select>
    </p>                
      </fieldset> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:21:18.493

如果您删除 selected 属性，则选择器选择的任何内容都将为 false。尝试这个：

```
$('select[name="stylabid"]').change(function(){
    $('#pjtlabid option').removeAttr('selected');
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:42:28.173

> GUI 现在有两个不同的选项列表。stylabid 和 pjtlabid。如果我单击其中一个，我希望清除另一个列表中的任何选定项目。

如果*选择列表*是指一个`<select>`元素，那么问题在于如何绑定更改处理程序： a`<select>`不是`<input>`. 相反，请执行以下操作：

```
$('select[name="stylabid"]').change( function() {
    $('#pjtlabid').find('option').prop('selected',false);
}); 
```

另外，请确保您使用了[正确的选择器](http://api.jquery.com/category/selectors/)；`'#pjtlabid'`选择**ID**为*pjtlabid*的元素，同时`[name="stylabid"]`选择**名称**为*stylabid*的元素。名称和 ID 属性不相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T23:21:52.413

喜欢这个人吗？[http://jsfiddle.net/5XFrc/1/](http://jsfiddle.net/5XFrc/1/)

粘贴到你的 html 中，我会做具体的演示，如果这有帮助，请告诉我，或者我很乐意删除这篇文章。

**请注意**，`change`您可以使用`this.checked`状态，然后使用该状态来更新属性。

希望对事业有所帮助。

**代码**

```
 $("#tableOne thead tr th:first input:checkbox").click(function() {
            var checkedStatus = this.checked;
            $("#tableOne tbody tr td:first-child input:checkbox").each(function() {
                this.checked = checkedStatus;
            });
        });​ 
```

# javascript - 检测 JavaScript 中的焦点丢失

> ID：12486399
> 
> 赞同：2
> 
> 时间：2012-09-18T23:12:54.037
> 
> 标签：javascript, html, dom

我希望能够检测到任意元素何时在 JavaScript 中失去焦点，因此我可以构建一个类似于 jEdit 的内联编辑工具。这个库我不能依赖 jQuery，所以我需要一个本地方法来做它。

我查看了 onblur，这似乎是正确的，但 MDN 有一个注释表明它可能是 IE 特定的？

> 与几乎所有类型的元素都会接收到模糊事件的 MSIE 相比，Gecko 浏览器上的几乎所有类型的元素都不适用于此事件。

哪些元素将/不会与此一起使用，有没有更好的方法来检测这些东西？

如果模糊有效，是否应该更改[https://developer.mozilla.org/en-US/docs/DOM/element.onblur上的文档？](https://developer.mozilla.org/en-US/docs/DOM/element.onblur)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:21:39.040

您可以`onfocusout`在 body 元素上使用一个。`onblur`和之间的区别在于`onfocusout`后者会冒泡，因此您不必为所需的每个节点都安装它。

但是`onfocusout`不是跨浏览器，是 IE 的特性，不是标准。我不知道`onblur`在当前浏览器中设置有什么问题，除了它不会冒泡。

每当发生模糊时，唯一要通知的 hack 是让您`document.activeElement`在看到更改时轮询和触发事件。请参阅[使用 JavaScript 或 jQuery 检测哪个表单输入具有焦点](https://stackoverflow.com/questions/354718/detect-which-form-input-has-focus-using-javascript-or-jquery/4455401#4455401)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-10-28T09:31:31.180

为了检测焦点的丢失，对于可访问性审计，我个人使用以下所有丑陋的组合：

```
(function($){

var focusCounter = 0;

/* Set focus outline (CSS, jQuery): */
$("*").on("focus","body",function(e){$(e.target).css("outline","5px solid orange");$(e.target).on("blur",function(e){$(e.target).css("outline","none");})});

/* Log keypress */
$(document).on('keydown',function(e){
    console.log("========= KEYDOWN ", e.key, " ==================");
});

/* Log currently focused element (On start) */
console.log("CURRENT: ",document.activeElement);

/* Log focused element (On focus) */
document.addEventListener("focus",function(){
    console.log(
        "[ " + (focusCounter++).toString() + " ]",
        "FOCUSED: ",
        "<" + document.activeElement.nodeName + ">",
        ($.trim($(document.activeElement).text())? $.trim($(document.activeElement).text()) : $.trim($(document.activeElement).val())).replace(/(\r\n|\n|\r)/gm, "").substring(0, 30) + '...',
        document.activeElement
    );

},true);

/* Try to detect loss of focus (Works in Chrome) */
document.addEventListener("focusout", function(event){console.log((!event.relatedTarget)?"⚠ FOCUS LOST":"");});

/* Fallback, checks in intervals if the focus is still active/lost e.g. if onfocus or onfocusout didn't work */
(function(){setInterval(function(){console.log('interval check: ',(document.body===document.activeElement)?"FOCUS LOST":"ok");},8500);})();

})(jQuery); 
```

想法：我将所有这些设置为书签，以便我可以轻松访问它

# javascript - 在 IE9-10 中清除文本区域

> ID：12486400
> 
> 赞同：0
> 
> 时间：2012-09-18T23:12:54.957
> 
> 标签：javascript, forms, internet-explorer, internet-explorer-9, textarea

这在 IE10 中不起作用，但在其他浏览器中起作用：http: [//jsfiddle.net/54EKK/2/](http://jsfiddle.net/54EKK/2/)

如果在 textarea 中输入文本并设置变量，则该变量会保留 textarea 的内容。

当然，如果您在添加内容（函数之外）之前设置变量，它将为空，但在我的项目中我不能这样做。这是一个演示。它适用于所有浏览器：http: [//jsfiddle.net/54EKK/3/](http://jsfiddle.net/54EKK/3/)

现在我的问题是是否有办法清空文本区域，同时仍将变量保留在函数中。顺便说一句，清空该值也无济于事。

谢谢你们的见解！

（我怕不清楚我是如何解释的，所以如果不是，请告诉我！）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:27:46.980

据我所知，这只适用于IE9。我尝试过 Firefix、Chrome、Safari 和 Opera，但`textarea`在使用`innerHTML`.

当您使用`innerHTML`时，它将为您提供`value` *属性*，这是在表单字段中设置的原始文本。您在表单域中键入的值在`value` *属性*中。

如果在使用时想要表单域的内容，则`innerHTML`必须将 value 属性复制到每个表单域的 value 属性中。

* * *

### 编辑：

正如您所澄清的那样，您真正想要的只是清除`textarea`，然后将`textarea`元素的值设置为空字符串。

您需要访问该元素，因此您可能需要一个 id：

```
<textarea id="txt"></textarea> 
```

然后当你想清除它时，你会得到它的引用并清除它的值：

```
document.getElementById('txt').value = ''; 
```

# objective-c - @interface 可以有多个类吗？

> ID：12486401
> 
> 赞同：2
> 
> 时间：2012-09-18T23:13:00.587
> 
> 标签：objective-c, xcode, class, interface, multiple-inheritance

> **可能重复：**
> [Objective-C 多重继承](https://stackoverflow.com/questions/4192203/objective-c-multiple-inheritance)

在我的应用程序中，我需要添加`SideSwipeTableViewController`和`PullRefreshTableViewController`到`ViewController.h`. 但是，由于某种原因，当我尝试构建应用程序时它会给我一个错误。

这是代码：

```
@interface ViewController : SideSwipeTableViewController, PullRefreshTableViewController  {

    ...

} 
```

当其中任何一个都在时，它会起作用，但不是两者都在。我想知道的是：有没有办法成功实现这两个类？提前致谢，我对这个问题表示歉意：我对 Objective-C 还是有点陌生​​。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-09-18T23:14:42.960

Objective-C 中没有多重继承。不过，您可以实现任意数量的协议。

# actionscript-3 - 在 AS3 中，如何在没有对字符串进行 url 编码的情况下将字符串发布到 php？

> ID：12486404
> 
> 赞同：0
> 
> 时间：2012-09-18T23:13:18.993
> 
> 标签：actionscript-3, post, base64, urlencode

有没有办法在没有对字符串进行 url 编码的情况下发布到 php 页面？我已经阅读了 php 中的 urldecode，但我需要保留 + 符号，我认为 urldecode 会将它们去掉。

# soap - 如何在 The Grinder 中提交 SOAP 请求

> ID：12486405
> 
> 赞同：3
> 
> 时间：2012-09-18T23:13:26.440
> 
> 标签：soap, jython, grinder

研磨机使用 jython 作为它的主要脚本语言。

我需要测试一些只有肥皂接口的网络服务。

我一直无法找到一种方法来让它发挥作用。我是 The Grinder 的新手，虽然他们有一个示例脚本显示 XmlRpcClient 的使用，但即使这个示例错误指出“导入错误：没有名为 apache 的模块”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-10-02T11:51:26.730

这是我的网络服务的示例代码：

```
# coding=utf-8

import traceback
from net.grinder.script.Grinder import grinder
from net.grinder.script import Test
from net.grinder.plugin.http import HTTPPluginControl, HTTPRequest
from HTTPClient import NVPair

connectionDefaults = HTTPPluginControl.getConnectionDefaults()
httpUtilities = HTTPPluginControl.getHTTPUtilities()
connectionDefaults.useContentEncoding = 1
log = grinder.logger.info

class TestRunner:

    def __call__(self):
        your_url_for_web_service = ''
        your_soap_message_body = ''
        soapMessage = """<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
<SOAP-ENV:Body>"""+
    your_soap_message_body+"""
</SOAP-ENV:Body>
</SOAP-ENV:Envelope>"""
        self.send_service( your_url_for_web_service, soapMessage )

    def send_service( self, soapMessage ):                
        request = HTTPRequest()
        headers =   (
                    NVPair( "Content-Type", "text/xml; charset=utf-8" ),
                    NVPair( "Content-Length", str( len( soapMessage ) ) ),
                    )
        request.setHeaders(headers)
        httpResponseObject = request.POST( url, soapMessage )
        soapAsString = httpResponseObject.getText()
        log( soapAsString )

def instrumentMethod(test, method_name, c=TestRunner):
  """Instrument a method with the given Test."""
  unadorned = getattr(c, method_name)
  import new
  method = new.instancemethod(test.wrap(unadorned), None, c)
  setattr(c, method_name, method)

# Replace each method with an instrumented version.
instrumentMethod(Test(1, 'soap request showcase example'), 'send_service') 
```

请务必在`call`方法中更改以下内容：

```
your_url_for_web_service = ''
your_soap_message_body = '' 
```

为您的 Web 服务提供适当的值。

# php - 将此 curl 转换为多 PHP

> ID：12486407
> 
> 赞同：1
> 
> 时间：2012-09-18T23:13:43.580
> 
> 标签：php, curl

我有这个代码，我想用 multi 建立 10 个这样的 curl 连接，但我不知道如何使用这个特定的代码：

代码有什么作用？

1.  对 .asp 页面进行 curl 请求

2.  使用结果以表单 ($ciudad) 发送一些数据，然后页面获取此提交并发出内部请求并显示结果。

3.  输出最终结果。

    ```
    function curl($header,$encoded,$cookie){
      $options = array(
        CURLOPT_USERAGENT       => $_SERVER['HTTP_USER_AGENT'],
        CURLOPT_TIMEOUT         => 120,    
        //CURLOPT_REFERER           => '',
        //CURLOPT_HTTPHEADER        => $header,
        CURLOPT_COOKIE          =>  $cookie,
        CURLOPT_POST            => true,
        CURLOPT_POSTFIELDS      => $encoded,
        CURLOPT_RETURNTRANSFER  => true,     
        CURLOPT_HEADER          => false,    
        CURLOPT_FOLLOWLOCATION  => true,     
      );
      $ch = curl_init("http://procesos.ramajudicial.gov.co/consultaprocesos/consultap.aspx"); 
      curl_setopt_array( $ch, $options );
      $output = curl_exec($ch); 
      curl_close($ch);
      return $output;
    }

    $cookie = "";
    foreach($_COOKIE as $k => $v)
      $cookie .= $k."=".$v.";";
      $cookie = substr($cookie,0,strlen($cookie)-1);

      $encoded = '';
      foreach($_POST as $name => $value) {
        $encoded .= urlencode($name).'='.urlencode($value).'&';
      }

      $lk = "http://procesos.ramajudicial.gov.co/consultaprocesos/";

      $header[] = 'User-Agent: '.$_SERVER['HTTP_USER_AGENT'];
      $header[] = 'Accept: text/xml,application/xml,application/xhtml+xml,text /html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5';
      $header[] = 'Accept-Language: en-us,en;q=0.5'; 
      $header[] = 'Accept-Encoding: gzip,deflate'; 
      $header[] = 'Connection: keep-alive';
      $header[] = 'Cookie : '.$cookie;
      $header[] = 'Content-Type: application/x-www-form-urlencoded';

      $output = curl($header,$encoded,$cookie);

      $CIUDAD = urlencode("Medellin"); // to change
      $CORPORACION = urlencode("JUZGADOS CIVILES MUNICIPALES DE MEDELLIN"); // to change
      $DIGITOS = $numsus; 

      // BEGIN STEP 1
      $__VIEWSTATE = 'id="__VIEWSTATE" value="';
      $i = stripos($output,$__VIEWSTATE) + strlen($__VIEWSTATE);
      $j = stripos($output,'"',$i);
      $__VIEWSTATE = substr($output,$i,$j-$i);

      $__EVENTVALIDATION = 'id="__EVENTVALIDATION" value="';
      $i = stripos($output,$__EVENTVALIDATION) + strlen($__EVENTVALIDATION);
      $j = stripos($output,'"',$i);
      $__EVENTVALIDATION = substr($output,$i,$j-$i);

      $encoded = '__EVENTTARGET=DropDownList1&__EVENTARGUMENT=&__LASTFOCUS=&__VIEWSTATE='.urlencode($__VIEWSTATE).'&__EVENTVALIDATION='.urlencode($__EVENTVALIDATION).'&DropDownList1='.$CIUDAD.'&TextBox13=';

      $output = curl($header,$encoded,$cookie); 
    ```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T15:36:19.970

如果您可以使用最适合您的任何方法来使用十个线程，那就太好了，file_get_contents 最有可能......

[https://github.com/krakjoe/pthreads](https://github.com/krakjoe/pthreads)

你可以有线程:)

享受 ...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T11:54:04.260

多卷曲一开始有时很难掌握，我强烈建议您查看 Pete Wardens PHP [https://github.com/petewarden/ParallelCurl](https://github.com/petewarden/ParallelCurl)实现。这消除了抽象。

您基本上需要实现一个回调函数以在下载完成时触发。例如，写入一个临时目录，当它完成后，你的主程序可以检查内容并从那里处理它。

# .net-4.0 - SSIS Excel 源连接。它用什么来读取 Excel？

> ID：12486409
> 
> 赞同：0
> 
> 时间：2012-09-18T23:13:48.857
> 
> 标签：.net-4.0, ssis, excel-2003

使用 SSIS，我可以使用带有 Jet 驱动程序的 OLE Con​​nect 来读取 Excel，或者我可以使用单独的“Excel 连接”连接类型

正如我所担心的那样，两者似乎都在使用合并单元格读取文件时遇到问题。

我很好奇使用“Excel 连接”时 SSIS 使用什么来连接 Excel。

除了 VBA，对于在服务器上读取包含合并单元格、公式、格式等的 Excel 文件，您有什么建议？我正在使用 Excel 2003。

**更新**

这是我用来读取 XLS 的代码：

```
private static void GetExcelSheets(string filePath)
        {
            string connectionString = string.Format("Provider=Microsoft.Jet.OLEDB.4.0;Data Source={0};Extended Properties='Excel 8.0;HDR={1}'", filePath, "no");

            OleDbConnection excelConnection = new OleDbConnection(connectionString);
            OleDbCommand cmdExcel = new OleDbCommand();
            OleDbDataAdapter oda = new OleDbDataAdapter();
            cmdExcel.Connection = excelConnection;

            if (excelConnection.State == ConnectionState.Open)
            {
                excelConnection.Close();
            }
            excelConnection.Open();

            OleDbCommand oleDbCommand = new OleDbCommand();
            oleDbCommand.CommandType = System.Data.CommandType.Text;
            oleDbCommand.Connection = excelConnection;
            OleDbDataAdapter oleDbDataAdapter = new OleDbDataAdapter(oleDbCommand);

            DataTable dtExcelSheetName = excelConnection.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, null);
            string getExcelSheetName = dtExcelSheetName.Rows[5]["Table_Name"].ToString();
            oleDbCommand.CommandText = "SELECT * FROM [" + getExcelSheetName + "]";
            oleDbDataAdapter.SelectCommand = oleDbCommand;
            DataTable dtExcelRecords = new DataTable();
            oleDbDataAdapter.Fill(dtExcelRecords);

            excelConnection.Dispose();

        } 
```

当我阅读如下所示的电子表格时：

![在此处输入图像描述](../Images/5d8ff333d172718a511392fc8306d542.png)

然后使用调试器 Visualizer 显示数据集，我看到了。请注意，显示的 DataTable 中缺少我圈出的源电子表格中的数据：

![在此处输入图像描述](../Images/99491779cc48a3f2ed486d475413fe6c.png)

关于使用 Microsoft OLE DB Provider for Jet 4.0 的 Excel 连接点。在 SSIS 中，有两个单独的连接对象。第一个是 Excel 连接对象。它的属性页面如下所示：

![在此处输入图像描述](../Images/d96265fa2bbc9bb24bf1efe4d482a01b.png) 第二个是使用 JET 驱动程序并指向 Excel 的 OLE 连接对象。

![在此处输入图像描述](../Images/aa175ea52aba9fa929618eb4d90b7b8e.png)

Excel Connection 对象是否真的使用 4.0 Jet 驱动程序，它只是做同样事情的一种简写方式，还是这些连接类型在某些方面真的不同？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T13:46:16.167

据微软称：

> Excel 连接管理器使用 Microsoft OLE DB Provider for Jet 4.0 及其支持的 Excel ISAM（索引顺序访问方法）驱动程序来连接和读取数据并将数据写入 Excel 数据源。

*资料来源*：**[MSDN](http://msdn.microsoft.com/en-us/library/ms139836.aspx)**

* * *

至于如何正确导入具有合并单元格的 Excel 工作表：您需要确保在转换中映射了最左侧的列才能获取值。在合并的一组单元格中不是最左边的任何单元格都将是`null`. 我认为这是一个合理的期望，因为 SSIS 通常与没有“合并”单元格概念的数据库源一起使用。

# c - 用 C 语言输出一首诗，每个单词都换行

> ID：12486421
> 
> 赞同：2
> 
> 时间：2012-09-18T23:14:49.450
> 
> 标签：c, getchar, putchar

我在 C 编程课上有一个作业，只使用函数`getchar`和`putchar`. 我已经编写了大部分程序，但我不知道如何只为多个空格添加一个新行。例如，当有多个空格时，输出中有一个间隙，这是我不想要的。有谁知道如何纠正这个？

```
int main(int argc, const char * argv[])
{
    /* Variables declared */
    int iochar;

    /* While loop */
    while ((iochar = getchar() ) != EOF) {

        /* If statement to return on alphabetic characters, not puncuation */
        if (((iochar >= 'A') && (iochar <= 'Z')) || ((iochar >= 'a') && (iochar <= 'z'))) {
            putchar(iochar);
        }

        /* If statement to produce a new line when a space is detected */
        if (iochar == ' ') {
            putchar('\n');
        }
    }

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:22:05.857

您可以将前一个字符存储在另一个变量中，并且仅在当前字符是空格且前一个字符不是空格时才输出换行符。

顺便说一句：输入中的数字应该发生什么？

# ruby-on-rails - 从 AJAX URL Rails 调用部分

> ID：12486425
> 
> 赞同：1
> 
> 时间：2012-09-18T23:15:16.983
> 
> 标签：ruby-on-rails, ajax, partial-views

如何从 Ajax 函数调用部分内容，我需要在 home.html.erb 中呈现部分内容，这里是代码：

```
<div class="span8">
  <h3>Micropost Feed</h3>
    <div class="posts">
        <%= render 'feed' %>
    </div>
</div> 
```

在底部我有一个脚本，问题代码在这些行中：

```
if(nearBottomOfPage()) {
  loading=true;
  page++;
  $.ajax({ // send an ajax-request to load the next page
    url: '/feed?page=' + page,
    type: 'get',
    dataType: 'script',
    success: function() { // after successfully completing the ajax-request redraw the    sausage-navigation.
      $(window).sausage('draw');
      loading=false;
    }
  }); 
```

“url”参数是我不知道要写什么来调用部分的地方，这个部分是调用 _feed.html.erb 并且它在 Home.html.erb 的同一个文件夹中，最后在我的控制器操作中我有这个：

```
def home
  if signed_in?
    @post  = current_user.posts.build
    @feed_items = current_user.feed.order(:created_at).page(params[:page])
  end  
  respond_to do |format|
      format.js  { render :partial => 'feed'}
      format.html # index.html.erb
      format.xml  { render :xml => @feed_items }
    end
 end 
```

如何从 Ajax 函数调用该部分？

非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:58:15.920

您不能通过 URL 直接调用部分。只有 /public 目录中的页面/视图可以直接访问。

您需要创建一个控制器操作来呈现“提要”部分和相应的路线。然后使用该路由的路径作为您的 AJAX URL。

# git - Git克隆存储库到其他存储库的根目录？

> ID：12486434
> 
> 赞同：1
> 
> 时间：2012-09-18T23:16:12.427
> 
> 标签：git, git-merge

如果我有一个空存储库`git init`，并且我想拉入另一个存储库以**仅用于拉**入更新，如果我希望文件位于根目录中，我该怎么做？

所以，

让我们说：

```
cd ~/repositories
mkdir newrepo
cd newrepo
git init
echo "testfile" > readme.md
git add .
git remote add <whatever>
git push -u origin master

#ok so that part works fine
#now we have our repository at <my_other_repository> that looks like
#a_root_file.ext
#directory/another_file.ext

#so now I want to run something like:
git clone <my_other_repository>

#and end up with:
#readme.md
#a_root_file.ext
#directory/another_file.ext

#if I then run
echo "edited testfile" > readme.md
git status
#I want to be told that
#untracked changes
#newfile: a_root_file.ext
#newfile: directory/another_file.ext
#modified: readme.md

#running
git commit -a -m "Some files from another repository"
git push
#should push everything up to the <whatever> repository

#then I want to be able to run
git pull <my_other_repository_name>
# and have it pull in any upstream changes 
```

这是可以设置的吗？

我想我可以通过一个“包装器目录”来稍微解决它

```
cd ~/repositories
mkdir newrepo
cd newrepo
git init
git remote add <whatever>
mkdir wrapper #this will now be the root of my project
cd wrapper
echo "testfile" > readme.md
cd ../
git add .
git push -u origin master 
```

然后我应该能够`git clone <my_other_repository>`毫无问题地运行，但这只有在我只想合并到一个存储库中时才有效，并且我想合并到多个存储库中，我还想知道什么会跟踪更改，因为现在有两个存储库正在观看相同的文件，都会跟踪它们吗？或者会`<whatever>`说“嘿，这些都在这个存储库下，所以我们不会跟踪它！”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:32:53.097

我不太确定你在这里要求什么，但你应该知道你可以拥有多个`remote`. 例如，您可以：

```
git remote add another <my_other_repository> 
```

然后，您可以使用`git fetch another`. 然后，您可以使用以下方法合并更新：

```
git merge another/master 
```

将其他存储库中的更新合并到本地存储库中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:06:38.120

我认为实现这一点的最佳方法是拥有两个存储库——但让其中一个成为另一个的*分支*，然后*将*提交从一个拉到另一个。

拥有两个不同的存储库，其中一个是另一个的分支，可确保在两者之间轻松跟踪单个提交。如果您有两个不同的存储库，那么您可能必须将更改从一个拉到另一个作为新提交——而不是简单地合并两者之间的单个提交。

我设想的步骤是：

*   创建第一个存储库并将其推送到`origin`（我假设您现在使用的是 github）。这是您场景中的 < *whatever* > 存储库。
*   分叉存储库。这将成为 <*my_other_repository*> 存储库。
*   然后在您想要的任何存储库中根据需要提交更改。
*   然后根据需要在它们之间“拉”变化。

在确保所有提交轻松且完整地在存储库之间进行时，这种方法为您提供了很大的灵活性。（在上面的场景中，新存储库中的提交实际上变成了不同的 git 提交——在某些情况下，这可能会丢失有关每个单独提交的信息。）

这种方法的另一个好处是它很容易扩展到拥有 3、4、5 或许多其他存储库，而不仅仅是 2 个。您还可以指定一个人来处理与主存储库的合并，这样他们就可以充当“交通警察” ' 并在有意义的情况下拒绝一些更改。

祝你好运-

# sql - 如何使用包 database/sql 批处理 sql 语句

> ID：12486436
> 
> 赞同：48
> 
> 时间：2012-09-18T23:16:28.943
> 
> 标签：sql, go

如何使用 Go 的 database/sql 包批处理 sql 语句？

在Java中我会这样做：

```
// Create a prepared statement
String sql = "INSERT INTO my_table VALUES(?)";
PreparedStatement pstmt = connection.prepareStatement(sql);

// Insert 10 rows of data
for (int i=0; i<10; i++) {
    pstmt.setString(1, ""+i);
    pstmt.addBatch();
}

// Execute the batch
int [] updateCounts = pstmt.executeBatch(); 
```

我如何在 Go 中实现相同的目标？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2014-08-07T21:03:36.963

由于该`db.Exec`函数是[variadic](http://golang.org/ref/spec#Passing_arguments_to_..._parameters)，因此一种选择（实际上只进行一次网络往返）是自己构造语句并分解参数并将它们传入。

示例代码：

```
func BulkInsert(unsavedRows []*ExampleRowStruct) error {
    valueStrings := make([]string, 0, len(unsavedRows))
    valueArgs := make([]interface{}, 0, len(unsavedRows) * 3)
    for _, post := range unsavedRows {
        valueStrings = append(valueStrings, "(?, ?, ?)")
        valueArgs = append(valueArgs, post.Column1)
        valueArgs = append(valueArgs, post.Column2)
        valueArgs = append(valueArgs, post.Column3)
    }
    stmt := fmt.Sprintf("INSERT INTO my_sample_table (column1, column2, column3) VALUES %s", 
                        strings.Join(valueStrings, ","))
    _, err := db.Exec(stmt, valueArgs...)
    return err
} 
```

在我运行的一个简单测试中，该解决方案在插入 10,000 行时比另一个答案中提出的 Begin、Prepare、Commit 快了大约 4 倍——尽管实际改进很大程度上取决于您的个人设置、网络延迟等。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2015-04-16T15:04:42.350

如果您使用的是 PostgreSQL，那么[pq](http://godoc.org/github.com/lib/pq)支持[批量导入](http://godoc.org/github.com/lib/pq#hdr-Bulk_imports)。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2018-01-03T02:25:38.960

为不支持占位符的 PostgreSQL调整[安德鲁的解决方案](https://stackoverflow.com/a/25192138/3357175)`?`，以下工作：

```
func BulkInsert(unsavedRows []*ExampleRowStruct) error {
    valueStrings := make([]string, 0, len(unsavedRows))
    valueArgs := make([]interface{}, 0, len(unsavedRows) * 3)
    i := 0
    for _, post := range unsavedRows {
        valueStrings = append(valueStrings, fmt.Sprintf("($%d, $%d, $%d)", i*3+1, i*3+2, i*3+3))
        valueArgs = append(valueArgs, post.Column1)
        valueArgs = append(valueArgs, post.Column2)
        valueArgs = append(valueArgs, post.Column3)
        i++
    }
    stmt := fmt.Sprintf("INSERT INTO my_sample_table (column1, column2, column3) VALUES %s", strings.Join(valueStrings, ","))
    _, err := db.Exec(stmt, valueArgs...)
    return err
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-01-15T18:21:32.487

扩展 Avi Flax 的答案，我需要在我的 INSERT 中添加一个 ON CONFLICT DO UPDATE 子句。

解决这个问题的方法是 COPY 到一个临时表（设置为在事务结束时删除），然后从临时表 INSERT 到永久表。

这是我确定的代码：

```
func (fdata *FDataStore) saveToDBBulk(items map[fdataKey][]byte) (err error) {
    tx, err := fdata.db.Begin()
    if err != nil {
        return errors.Wrap(err, "begin transaction")
    }
    txOK := false
    defer func() {
        if !txOK {
            tx.Rollback()
        }
    }()

    // The ON COMMIT DROP clause at the end makes sure that the table
    // is cleaned up at the end of the transaction.
    // While the "for{..} state machine" goroutine in charge of delayed
    // saving ensures this function is not running twice at any given time.
    _, err = tx.Exec(sqlFDataMakeTempTable)
    // CREATE TEMPORARY TABLE fstore_data_load
    // (map text NOT NULL, key text NOT NULL, data json)
    // ON COMMIT DROP
    if err != nil {
        return errors.Wrap(err, "create temporary table")
    }

    stmt, err := tx.Prepare(pq.CopyIn(_sqlFDataTempTableName, "map", "key", "data"))
    for key, val := range items {
        _, err = stmt.Exec(string(key.Map), string(key.Key), string(val))
        if err != nil {
            return errors.Wrap(err, "loading COPY data")
        }
    }

    _, err = stmt.Exec()
    if err != nil {
        return errors.Wrap(err, "flush COPY data")
    }
    err = stmt.Close()
    if err != nil {
        return errors.Wrap(err, "close COPY stmt")
    }

    _, err = tx.Exec(sqlFDataSetFromTemp)
    // INSERT INTO fstore_data (map, key, data)
    // SELECT map, key, data FROM fstore_data_load
    // ON CONFLICT DO UPDATE SET data = EXCLUDED.data
    if err != nil {
        return errors.Wrap(err, "move from temporary to real table")
    }

    err = tx.Commit()
    if err != nil {
        return errors.Wrap(err, "commit transaction")
    }
    txOK = true
    return nil
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-03-11T00:27:04.237

如果您使用 Postgres，这里是[@Debasish Mitra的解决方案。](https://stackoverflow.com/a/55038922/10769162)

运行示例： https: [//play.golang.org/p/dFFD2MrEy3J](https://play.golang.org/p/dFFD2MrEy3J)

替代示例： https: [//play.golang.org/p/vUtW0K4jVMd](https://play.golang.org/p/vUtW0K4jVMd)

```
data := []Person{{"John", "Doe", 27}, {"Leeroy", "Jenkins", 19}}

vals := []interface{}{}
for _, row := range data {
    vals = append(vals, row.FirstName, row.LastName, row.Age)
}

sqlStr := `INSERT INTO test(column1, column2, column3) VALUES %s`
sqlStr = ReplaceSQL(sqlStr, "(?, ?, ?)", len(data))

//Prepare and execute the statement
stmt, _ := db.Prepare(sqlStr)
res, _ := stmt.Exec(vals...) 
```

函数替换SQL

```
func ReplaceSQL(stmt, pattern string, len int) string {
    pattern += ","
    stmt = fmt.Sprintf(stmt, strings.Repeat(pattern, len))
    n := 0
    for strings.IndexByte(stmt, '?') != -1 {
        n++
        param := "$" + strconv.Itoa(n)
        stmt = strings.Replace(stmt, "?", param, 1)
    }
    return strings.TrimSuffix(stmt, ",")
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-09-02T03:46:33.037

如果有人使用 pgx（Golang 中所谓的最佳 Postgres 驱动程序），请参阅此解决方案： [https ://github.com/jackc/pgx/issues/764#issuecomment-685249471](https://github.com/jackc/pgx/issues/764#issuecomment-685249471)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-05-28T20:51:57.583

我让 pq.CopyIn 工作了，它实际上比字符串值/参数方法快 2.4 倍（顺便说一句，这是一个非常有用和优雅的解决方案，所以谢谢！）

我将 1000 万个 int、varchar 测试值插入到一个结构中，并使用以下函数加载它。我对 GoLang 有点陌生，所以请耐心等待...

```
func copyData(client *client.DbClient, dataModels []*dataModel) error{
    db := *client.DB
    txn, err := db.Begin()
    if err != nil {
        return err
    }
    defer txn.Commit()

    stmt, err := txn.Prepare(pq.CopyIn("_temp", "a", "b"))
    if err != nil {
        return(err)
    }

    for _, model := range dataModels{
        _, err := stmt.Exec(model.a, model.b)
        if err != nil {
            txn.Rollback()
            return err
        }
    }

    _, err = stmt.Exec()
    if err != nil {
        return err
    }

    err = stmt.Close()
    if err != nil {
        return err
    }

    return nil
    } 
```

`

经过（字符串值/参数）：1m30.60s。

经过（copyIn）：37.57s。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-03-07T08:10:41.010

对于 Postgres lib pq 支持批量插入：[https ://godoc.org/github.com/lib/pq#hdr-Bulk_imports](https://godoc.org/github.com/lib/pq#hdr-Bulk_imports)

但是同样可以通过下面的代码实现，但真正有用的是尝试执行批量条件更新（相应地更改查询）。

要为 Postgres 执行类似的批量插入，您可以使用以下函数。

```
// ReplaceSQL replaces the instance occurrence of any string pattern with an increasing $n based sequence
func ReplaceSQL(old, searchPattern string) string {
   tmpCount := strings.Count(old, searchPattern)
   for m := 1; m <= tmpCount; m++ {
      old = strings.Replace(old, searchPattern, "$"+strconv.Itoa(m), 1)
   }
   return old
} 
```

所以上面的样本变成了

```
sqlStr := "INSERT INTO test(n1, n2, n3) VALUES "
vals := []interface{}{}

for _, row := range data {
   sqlStr += "(?, ?, ?)," // Put "?" symbol equal to number of columns
   vals = append(vals, row["v1"], row["v2"], row["v3"]) // Put row["v{n}"] blocks equal to number of columns
}

//trim the last ,
sqlStr = strings.TrimSuffix(sqlStr, ",")

//Replacing ? with $n for postgres
sqlStr = ReplaceSQL(sqlStr, "?")

//prepare the statement
stmt, _ := db.Prepare(sqlStr)

//format all vals at once
res, _ := stmt.Exec(vals...) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-09-19T12:13:19.863

无法通过 database/sql 中可用的接口进行批处理。但是，特定的数据库驱动程序可能会单独支持它。例如[https://github.com/ziutek/mymysql](https://github.com/ziutek/mymysql)似乎支持使用 MySQL 进行批处理。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-10-06T00:52:45.523

采用 Andrew C 的想法，并使用 sql 标量变量来适应我的工作需要。它非常适合我工作中的特定要求。也许它对某人有用，因为它在 golang 中模拟 sql 的批处理事务很有用。这就是想法。

```
func BulkInsert(unsavedRows []*ExampleRowStruct) error {
    valueStrings := make([]string, 0, len(unsavedRows))
    valueArgs := make([]interface{}, 0, len(unsavedRows) * 3)
    i := 0
    for _, post := range unsavedRows {
        valueStrings = append(valueStrings, fmt.Sprintf("(@p%d, @p%d, @p%d)", i*3+1, i*3+2, i*3+3))
        valueArgs = append(valueArgs, post.Column1)
        valueArgs = append(valueArgs, post.Column2)
        valueArgs = append(valueArgs, post.Column3)
        i++
    }
    sqlQuery := fmt.Sprintf("INSERT INTO my_sample_table (column1, column2, column3) VALUES %s", strings.Join(valueStrings, ","))

    var params []interface{}

    for i := 0; i < len(valueArgs); i++ {
        var param sql.NamedArg
        param.Name = fmt.Sprintf("p%v", i+1)
        param.Value = valueArgs[i]
        params = append(params, param)
    }

    _, err := db.Exec(sqlQuery, params...)
    return err
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-07-24T10:27:27.320

使用链式语法查看的另一个好库是`go-pg`

[https://github.com/go-pg/pg/wiki/Writing-Queries#insert](https://github.com/go-pg/pg/wiki/Writing-Queries#insert)

使用单个查询插入多本书：

```
err := db.Model(book1, book2).Insert() 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-11-04T15:43:54.280

这是一个更通用的版本，用于根据@andrew-c 和@mastercarl 的答案生成查询和值参数：

// 批量/insert.go

```
import (
    "strconv"
    "strings"
)

type ValueExtractor = func(int) []interface{}

func Generate(tableName string, columns []string, numRows int, postgres bool, valueExtractor ValueExtractor) (string, []interface{}) {
    numCols := len(columns)
    var queryBuilder strings.Builder
    queryBuilder.WriteString("INSERT INTO ")
    queryBuilder.WriteString(tableName)
    queryBuilder.WriteString("(")
    for i, column := range columns {
        queryBuilder.WriteString("\"")
        queryBuilder.WriteString(column)
        queryBuilder.WriteString("\"")
        if i < numCols-1 {
            queryBuilder.WriteString(",")
        }
    }
    queryBuilder.WriteString(") VALUES ")
    var valueArgs []interface{}
    valueArgs = make([]interface{}, 0, numRows*numCols)
    for rowIndex := 0; rowIndex < numRows; rowIndex++ {
        queryBuilder.WriteString("(")
        for colIndex := 0; colIndex < numCols; colIndex++ {
            if postgres {
                queryBuilder.WriteString("$")
                queryBuilder.WriteString(strconv.Itoa(rowIndex*numCols + colIndex + 1))
            } else {
                queryBuilder.WriteString("?")
            }
            if colIndex < numCols-1 {
                queryBuilder.WriteString(",")
            }
        }
        queryBuilder.WriteString(")")
        if rowIndex < numRows-1 {
            queryBuilder.WriteString(",")
        }
        valueArgs = append(valueArgs, valueExtractor(rowIndex)...)
    }
    return queryBuilder.String(), valueArgs
} 
```

// 批量/insert_test.go

```
import (
    "fmt"
    "strconv"
)

func valueExtractor(index int) []interface{} {
    return []interface{}{
        "trx-" + strconv.Itoa(index),
        "name-" + strconv.Itoa(index),
        index,
    }
}

func ExampleGeneratePostgres() {
    query, valueArgs := Generate("tbl_persons", []string{"transaction_id", "name", "age"}, 3, true, valueExtractor)
    fmt.Println(query)
    fmt.Println(valueArgs)
    // Output:
    // INSERT INTO tbl_persons("transaction_id","name","age") VALUES ($1,$2,$3),($4,$5,$6),($7,$8,$9)
    // [[trx-0 name-0 0] [trx-1 name-1 1] [trx-2 name-2 2]]
}

func ExampleGenerateOthers() {
    query, valueArgs := Generate("tbl_persons", []string{"transaction_id", "name", "age"}, 3, false, valueExtractor)
    fmt.Println(query)
    fmt.Println(valueArgs)
    // Output:
    // INSERT INTO tbl_persons("transaction_id","name","age") VALUES (?,?,?),(?,?,?),(?,?,?)
    // [[trx-0 name-0 0] [trx-1 name-1 1] [trx-2 name-2 2]]
} 
```

# android - 如何创建一个复选框，根据变化的变量显示其状态？

> ID：12486437
> 
> 赞同：2
> 
> 时间：2012-09-18T23:16:30.727
> 
> 标签：android, variables, checkbox

我有一个项目列表，当单击这些项目时会打开一个新活动（从现在开始的食谱活动），其中显示一个图像、2 个文本视图和一个复选框。

该列表由带有字符串数组的 xml 文件填充。根据单击的内容，配方活动会显示从另一个 xml 文件中提取的信息。像这样的东西：

1.（在列表中）

(字符串产品 = ((TextView) 视图).getText().toString();)

2.（在食谱活动中）

if(product.equals("Naan")) sastojci = getString(R.string.sNaan);

无论如何，问题如下：

我想要一个可以读取产品变量的复选框，检查它是否之前被选中并放入收藏夹（共享首选项），然后取决于是否在收藏夹中显示其正确状态（选中或未选中）。

因为现在我有一个复选框，对于我选择的列表中的任何项目都是相同的......如果我选择第一个项目，它将在所有项目上保持选中状态，对于未选中的项目也是如此......

怎么能做这样的事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-20T13:55:51.907

好吧，我想我明白了……

首先保存`CheckBox`所选字符串的状态：

```
SharedPreferences mySettings = getSharedPreferences("mySettingsfile", MODE_PRIVATE);

mySettingsfile.Editor prefEditor = mySettings .edit(); 
prefEditor.putBoolean("selectedstring", myCheckbox.isChecked());
prefEditor.commit(); 
```

现在，通过以下方式加载设置

```
SharedPreferences mySettings = getSharedPreferences("mySettingsfile", MODE_PRIVATE);
myCheckbox.setChecked(mySettings .getBoolean("selectedstring", false)); 
```

在这里，每个字符串的检查状态是分开存储的。

# xml - 用于清除值的功能区 XML 组合框控件... VB.NET

> ID：12486440
> 
> 赞同：1
> 
> 时间：2012-09-18T23:16:52.867
> 
> 标签：xml, vb.net, vsto, ribbon

嘿伙计们，你能帮我解决这个问题吗！？我仍在研究如何清除功能区 XML 中组合框控件上的值的答案。到目前为止，我还没有找到合适的解决方案。

我的组合框控件是相互链接的，combobox2 依赖于 combobox1 选择的值，所以每次combobox1 选择的值发生变化时，我都需要清除combobox2 中的数据文本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T11:20:56.117

我实际上并没有在 VSTO 中完成此操作，但我对 VBA 回调和`dropDown`控件进行了类似操作。以下是我的做法，只有回调是 VBA 而不是 VB.NET（未经测试！）

为您的组合框定义回调：

1.  使用`getItemCount`,`getItemID`和`getItemLabel`来定义组合框的内容 - 您必须使用某种状态来了解如何根据第一个组合中的内容填充第二个组合中的值。

2.  在第一个组合上使用`onChange`回调来触发第二个组合的失效。您使用对功能区的引用并调用`Invalidate`以重新加载整个功能区 och`InvalidateControl(id)`以使特定控件无效（例如第二个组合）

*如果你不能让它工作，我推荐 dropDown 控件，它有更多可用的回调和更好的控制*（`onAction`回调定义了选择的索引，而不是像 comboBox 这样的字符串`onChange`）。

上述回调的 VB.NET 签名：

```
Function GetItemCount(control As IRibbonControl) as Integer

Function GetItemID(control As IRibbonControl, itemIndex as Integer) as String

Function GetItemLabel(control As IRibbonControl, itemIndex as Integer) as String

Sub OnChange(control As IRibbonControl, text As String) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T23:14:44.290

我现在明白了，它与下拉控件几乎相同。

我在 combobox1 上使用了 Onchange 属性，然后使用 invalidateControl 来触发 combobox2 我使用 getText 属性来清除值。

```
Public Sub onChange_cb1(ByVal control As Office.IRibbonControl, ByVal text As String)
ribbon.InvalidateControl("cb2") 'to load cb2 again in the ribbon
cb2Text = "" 'global var to set the text on cb2 as empty when cb1 has selected a new value
End Sub
Public Function setText_cb2(ByVal control As Office.IRibbonControl) As String
Return cb2Text 'return value
End Function 
```

关于 XML

组合框1

```
<comboBox id="cb1" label="combo1" getItemCount="getCount" getItemLabel="getItem" onChange="onChange_cb1"/> 
```

组合框2

```
<comboBox id="cb2" label="combo2" getItemCount="getCount" getItemLabel="getItem" getText="setText_cb2"  onChange="onChange_cb2"/> 
```

# android - 如何使用 Java 在 Android Wi-Fi 连接上设置 ProxySettings 和 ProxyProperties？

> ID：12486441
> 
> 赞同：11
> 
> 时间：2012-09-18T23:17:11.650
> 
> 标签：android, wifimanager

如何使用 Java（以编程方式）在 Android Wi-Fi 连接上设置 ProxySettings 和 ProxyProperties？

由于 ipAssignment、linkProperties、ProxySettings 和 ProxyProperties 是 Android 3.1 及更高版本 WifiConfiguration 中的隐藏字段，我需要能够枚举类并使用这些字段。

按照使用下面链接的代码示例，我可以为特定的 Wi-Fi 连接设置静态 IP 地址、网关和 DNS，但我还需要设置 Wificonfiguration.ProxySettings.STATIC 和 ProxyProperties

请参阅堆栈溢出问题*[如何在 Android 3.x 或 4.x 上以编程方式配置静态 IP 地址、网络掩码、网关](https://stackoverflow.com/questions/10278461)*。

例如，

```
WifiConfiguration config = new WifiConfiguration(configuration);
config.ipAssignment = WifiConfiguration.IpAssignment.UNASSIGNED;
config.proxySettings = WifiConfiguration.ProxySettings.STATIC;
config.linkProperties.setHttpProxy(new ProxyProperties("127.0.0.1", 3128, "")); 
```

寻找类似的东西：

```
setProxySettings("STATIC", wifiConf);
setProxyProperties("proxyserver.mine.com.au", 8080, ""); // Set Proxy server and port.
wifiManager.updateNetwork(wifiConf); //apply the setting 
```

使用来自coolypf .ipAssignment .ProxySettings 和linkProperties 的以下代码被隐藏...

```
 WifiManager manager = (WifiManager)getSystemService(Context.WIFI_SERVICE);
manager.asyncConnect(this, new Handler());
if (!manager.isWifiEnabled()) return;
    List<WifiConfiguration> configurationList = manager.getConfiguredNetworks();
    WifiConfiguration configuration = null;
    int cur = manager.getConnectionInfo().getNetworkId();
    for (int i = 0; i < configurationList.size(); ++i)
    {
        WifiConfiguration wifiConfiguration = configurationList.get(i);
        if (wifiConfiguration.networkId == cur)
        configuration = wifiConfiguration;
    }
    if (configuration == null) return;
    WifiConfiguration config = new WifiConfiguration(configuration);
    config.ipAssignment = WifiConfiguration.IpAssignment.UNASSIGNED;
    config.proxySettings = WifiConfiguration.ProxySettings.STATIC;

    config.linkProperties.clear();

    config.linkProperties.setHttpProxy(new ProxyProperties("127.0.0.1", 3128, ""));

    manager.saveNetwork(config); 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2013-01-12T15:25:07.577

这里有一些代码应该允许您设置/取消设置 ProxyProperties。它使用上面链接中的一些相同代码。设置似乎没有在断开/重新连接时生效。

```
public static Object getField(Object obj, String name)
throws SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException{
    Field f = obj.getClass().getField(name);
    Object out = f.get(obj);
    return out;
}

public static Object getDeclaredField(Object obj, String name)
throws SecurityException, NoSuchFieldException,
IllegalArgumentException, IllegalAccessException {
    Field f = obj.getClass().getDeclaredField(name);
    f.setAccessible(true);
    Object out = f.get(obj);
    return out;
}  

public static void setEnumField(Object obj, String value, String name)
throws SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException{
    Field f = obj.getClass().getField(name);
    f.set(obj, Enum.valueOf((Class<Enum>) f.getType(), value));
}

public static void setProxySettings(String assign , WifiConfiguration wifiConf)
throws SecurityException, IllegalArgumentException, NoSuchFieldException, IllegalAccessException{
    setEnumField(wifiConf, assign, "proxySettings");     
}

WifiConfiguration GetCurrentWifiConfiguration(WifiManager manager)
{
    if (!manager.isWifiEnabled()) 
        return null;

    List<WifiConfiguration> configurationList = manager.getConfiguredNetworks();
    WifiConfiguration configuration = null;
    int cur = manager.getConnectionInfo().getNetworkId();
    for (int i = 0; i < configurationList.size(); ++i)
    {
        WifiConfiguration wifiConfiguration = configurationList.get(i);
        if (wifiConfiguration.networkId == cur)
            configuration = wifiConfiguration;
    }

    return configuration;
}

void setWifiProxySettings()
{
    //get the current wifi configuration
    WifiManager manager = (WifiManager)getSystemService(Context.WIFI_SERVICE);
    WifiConfiguration config = GetCurrentWifiConfiguration(manager);
    if(null == config)
        return;

    try
    {
        //get the link properties from the wifi configuration
        Object linkProperties = getField(config, "linkProperties");
        if(null == linkProperties)
            return;

        //get the setHttpProxy method for LinkProperties
        Class proxyPropertiesClass = Class.forName("android.net.ProxyProperties");
        Class[] setHttpProxyParams = new Class[1];
        setHttpProxyParams[0] = proxyPropertiesClass;
        Class lpClass = Class.forName("android.net.LinkProperties");
        Method setHttpProxy = lpClass.getDeclaredMethod("setHttpProxy", setHttpProxyParams);
        setHttpProxy.setAccessible(true);

        //get ProxyProperties constructor
        Class[] proxyPropertiesCtorParamTypes = new Class[3];
        proxyPropertiesCtorParamTypes[0] = String.class;
        proxyPropertiesCtorParamTypes[1] = int.class;
        proxyPropertiesCtorParamTypes[2] = String.class;

        Constructor proxyPropertiesCtor = proxyPropertiesClass.getConstructor(proxyPropertiesCtorParamTypes);

        //create the parameters for the constructor
        Object[] proxyPropertiesCtorParams = new Object[3];
        proxyPropertiesCtorParams[0] = "127.0.0.1";
        proxyPropertiesCtorParams[1] = 8118;
        proxyPropertiesCtorParams[2] = null;

        //create a new object using the params
        Object proxySettings = proxyPropertiesCtor.newInstance(proxyPropertiesCtorParams);

        //pass the new object to setHttpProxy
        Object[] params = new Object[1];
        params[0] = proxySettings;
        setHttpProxy.invoke(linkProperties, params);

        setProxySettings("STATIC", config);

        //save the settings
        manager.updateNetwork(config);
        manager.disconnect();
        manager.reconnect();
    }   
    catch(Exception e)
    {
    }
}
void unsetWifiProxySettings()
{
    WifiManager manager = (WifiManager)getSystemService(Context.WIFI_SERVICE);
    WifiConfiguration config = GetCurrentWifiConfiguration(manager);
    if(null == config)
        return;

    try
    {
        //get the link properties from the wifi configuration
        Object linkProperties = getField(config, "linkProperties");
        if(null == linkProperties)
            return;

        //get the setHttpProxy method for LinkProperties
        Class proxyPropertiesClass = Class.forName("android.net.ProxyProperties");
        Class[] setHttpProxyParams = new Class[1];
        setHttpProxyParams[0] = proxyPropertiesClass;
        Class lpClass = Class.forName("android.net.LinkProperties");
        Method setHttpProxy = lpClass.getDeclaredMethod("setHttpProxy", setHttpProxyParams);
        setHttpProxy.setAccessible(true);

        //pass null as the proxy
        Object[] params = new Object[1];
        params[0] = null;
        setHttpProxy.invoke(linkProperties, params);

        setProxySettings("NONE", config);

        //save the config
        manager.updateNetwork(config);
        manager.disconnect();
        manager.reconnect();
    }   
    catch(Exception e)
    {
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-11-27T02:04:19.097

与 Dave 的答案类似，但仅使用该方法的行数更少`setProxy(ProxySettings settings, ProxyInfo proxy)`（为清楚起见，省略了周围的代码）：

```
Class proxySettings = Class.forName("android.net.IpConfiguration$ProxySettings");

Class[] setProxyParams = new Class[2];
setProxyParams[0] = proxySettings;
setProxyParams[1] = ProxyInfo.class;

Method setProxy = config.getClass().getDeclaredMethod("setProxy", setProxyParams);
setProxy.setAccessible(true);

ProxyInfo desiredProxy = ProxyInfo.buildDirectProxy(YOUR_HOST, YOUR_PORT);

Object[] methodParams = new Object[2];
methodParams[0] = Enum.valueOf(proxySettings, "STATIC");
methodParams[1] = desiredProxy;

setProxy.invoke(config, methodParams); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-02-13T19:36:40.633

这是一些示例代码，用于在 Android 5.0 中处理相同的事情，格式与上述 Carl 的回答相同。

```
public void setWifiProxySettings5()
{
    //get the current wifi configuration
    WifiManager manager = (WifiManager)getSystemService(Context.WIFI_SERVICE);
    WifiConfiguration config = GetCurrentWifiConfiguration(manager);
    if(null == config)
        return;     

    try
    {       
        //linkProperties is no longer in WifiConfiguration          
        Class proxyInfoClass = Class.forName("android.net.ProxyInfo");
        Class[] setHttpProxyParams = new Class[1];
        setHttpProxyParams[0] = proxyInfoClass;         
        Class wifiConfigClass = Class.forName("android.net.wifi.WifiConfiguration");
        Method setHttpProxy = wifiConfigClass.getDeclaredMethod("setHttpProxy", setHttpProxyParams);
        setHttpProxy.setAccessible(true);

        //Method 1 to get the ENUM ProxySettings in IpConfiguration
        Class ipConfigClass = Class.forName("android.net.IpConfiguration");
        Field f = ipConfigClass.getField("proxySettings");
        Class proxySettingsClass = f.getType();        

        //Method 2 to get the ENUM ProxySettings in IpConfiguration
        //Note the $ between the class and ENUM
        //Class proxySettingsClass = Class.forName("android.net.IpConfiguration$ProxySettings");

        Class[] setProxySettingsParams = new Class[1];
        setProxySettingsParams[0] = proxySettingsClass;
        Method setProxySettings = wifiConfigClass.getDeclaredMethod("setProxySettings", setProxySettingsParams);
        setProxySettings.setAccessible(true);

        ProxyInfo pi = ProxyInfo.buildDirectProxy("127.0.0.1", 8118);
        //Android 5 supports a PAC file
        //ENUM value is "PAC"
        //ProxyInfo pacInfo = ProxyInfo.buildPacProxy(Uri.parse("http://localhost/pac"));

        //pass the new object to setHttpProxy
        Object[] params_SetHttpProxy = new Object[1];
        params_SetHttpProxy[0] = pi;
        setHttpProxy.invoke(config, params_SetHttpProxy);

        //pass the enum to setProxySettings
        Object[] params_setProxySettings = new Object[1];
        params_setProxySettings[0] = Enum.valueOf((Class<Enum>) proxySettingsClass, "STATIC");
        setProxySettings.invoke(config, params_setProxySettings);

        //save the settings
        manager.updateNetwork(config);
        manager.disconnect();
        manager.reconnect();
    }   
    catch(Exception e)
    {
        Log.v("wifiProxy", e.toString());
    }
} 
```

# matlab - Matlab 不会使用编辑命令创建文件

> ID：12486442
> 
> 赞同：4
> 
> 时间：2012-09-18T23:17:20.647
> 
> 标签：matlab

当我进入

```
edit somenewfile.m 
```

在我的 Matlab R2010a 命令窗口中，它给了我这个错误

```
??? Error using ==> edit at 57
Neither 'somenewfile' nor 'somenewfile.m' could be found. 
```

在我的另一台运行 R2012a 的计算机上，同样的命令可以工作并创建一个新文件。2010年有什么不同吗？

我试着摆弄 edit.m 了一会儿，但我担心我会搞砸一些事情。这是它失败的部分

```
try
if (nargin == 0)
    openEditor;
else
    for i = 1:nargin
        argName = translateUserHomeDirectory(strtrim(varargin{i}));
        if isempty(argName)
            openEditor;
        else
            checkEndsWithBadExtension(argName);

            if ~openInPrivateOfCallingFile(argName)
                if ~openOperator(argName)
                    if ~openWithFileSystem(argName, ~isSimpleFile(argName))
                        if ~openPath(argName)
                            showEmptyFile(argName);
                        end
                    end
                end
            end
        end
    end
end
catch exception
    throw(exception); % throw so that we don't display stack trace
end 
```

在 ShowEmptyFile 而看起来像

```
%--------------------------------------------------------------------------
% Helper function that displays an empty file -- taken from the previous edit.m
% Now passes error message to main function for display through error.
function showEmptyFile(file)
errMessage = '';
errID = '';

% If nothing is found in the MATLAB workspace or directories,
% open a blank buffer only if:
%   1) the given file is a simple filename (contains no qualifying 
%      directories, i.e. foo.m) 
%   OR 
%   2) the given file's directory portion exists (note that to get into 
%      this method it is implied that the file portion does not exist)
%      (i.e. myDir/foo.m, where myDir exists and foo.m does not).
[path fileNameWithoutExtension extension] = fileparts(file);

if isSimpleFile(file) || (exist(path, 'dir') == 7)

    % build the file name with extension.
    if isempty(extension) 
        extension = '.m';
    end
    fileName = [fileNameWithoutExtension extension];

    % make sure the given file name is valid.
    checkValidName(fileName);

    % if the path is empty then use the current working directory.
    % else use the fully resolved version of the given path.
    if (strcmp(path, ''))
       path = pwd;
    else
        whatStruct = what(path);
        path = whatStruct.path;
    end

    if (isempty(checkJavaAvailable) ...
            && com.mathworks.mde.editor.EditorOptions.getShowNewFilePrompt == false ...
            && com.mathworks.mde.editor.EditorOptions.getNamedBufferOption == ...
                com.mathworks.mde.editor.EditorOptions.NAMEDBUFFER_DONTCREATE ...
            && com.mathworks.mde.editor.EditorOptions.getBuiltinEditor ~= 0)
        [errMessage, errID] = showFileNotFound(file, false);
    else
        openEditor(fullfile(path,fileName));
    end
else
    [errMessage, errID] = showFileNotFound(file, false);
end
handleError(errMessage, errID); 
```

也许我的edit.m不好？或者有一个设置导致带有代码的新edit.m引发错误？有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T10:07:16.200

如果在取消选中以下选项后编辑不存在的文件，我会在 2010a（edit.m 的第 57 行）中收到相同的错误消息：

文件 -> 首选项 -> 常规 -> 确认对话框 -> 编辑不存在的文件时提示

考虑到这一点，听起来您没有启用该选项？

# ruby-on-rails - 安装 ffmpeg

> ID：12486448
> 
> 赞同：0
> 
> 时间：2012-09-18T23:18:20.443
> 
> 标签：ruby-on-rails, ruby, ffmpeg

我不是对 linux 和 Rails 的新手的期望，但我试图让我的用户允许上传视频并查看它们。现在我找到了这个用于 ruby​​ on rails [https://github.com/owahab/paperclip-ffmpeg](https://github.com/owahab/paperclip-ffmpeg)的 gem，它似乎使用回形针和 ffmpeg 软件在我的服务器上上传视频。但是在文档中它声明您必须安装 ffmpeg，但我不确定如何安装。我使用的是 ubuntu 12.04，不知道如何安装。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:58:56.527

对SO来说不是问题。理想情况下，您应该向超级用户提出此类问题。但是要安装 ffmpeg 就可以

```
 sudo apt-get install ffmpeg 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-12-22T09:07:23.080

[FFMPEG安装指南](https://trac.ffmpeg.org/wiki/CompilationGuide/) -Linux、Windows、MacOS等平台官方。（包括开发人员指南）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-17T12:09:17.200

Ubuntu 存储库通常具有 ffmpeg 的旧版本，并且不包含某些当前功能。[最好从源代码](https://www.ffmpeg.org/download.html)下载 ffmpeg并构建它。

对于 ubuntu，您可以按照以下流程进行构建和安装：

提取tar文件并进入ffmpeg文件夹执行以下命令

```
$ ./configure
$ make -j 10
$ sudo make install 
```

如果您希望使用某些选项配置 ffmpeg，您可以提供如下参数

```
./configure --enable-libx264 --enable-libvo-aacenc --enable-gpl --enable-version3 
```

# jquery - 基于 URL 的 jQuery 条件

> ID：12486449
> 
> 赞同：1
> 
> 时间：2012-09-18T23:18:29.493
> 
> 标签：jquery, url, conditional

我在下面有这个代码工作，除了它只在 URL 是“domain/dev”而不是“domain/dev/”和尾部斜杠时工作。我对 JS 语法不是很熟悉，所以不知道如何更正。我尝试了不同的变体，添加了一个条件语句，但斜线似乎破坏了代码。

```
$(function() {
    var loc = window.location.href;
  if(/dev/.test(loc)) {
    var visited = 'visited';
    if($.cookies.get(visited) === null){
        $('#career-home').addClass('visited')
        $.cookies.set('visited', 'visited')
        console.log("addClass")
    }else{
        $('#career-home').removeClass('visited')
        console.log("removeClass")
    }
  }
  console.log(window.location.pathname);
}); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-20T15:43:00.403

我能够使用此代码实现我所需要的（检查 cookie 是否存在，如果存在，则添加几个类，如果不存在，则添加一个类）

```
$(document).ready(function() {
    var pathArray = window.location.pathname.split( '/' );
    var cookieName = pathArray[2];
    var loc = window.location.pathname;
    if($.cookies.get(cookieName) === null) {
        $.cookies.set(cookieName, 'visited');
        $('#' + cookieName).addClass('current');
        setTimeout(function(){
            $('#' + cookieName).addClass('visited')
            console.log("addClass 'visited' to #" + cookieName)
        },5000);
        console.log("Set cookie = " + cookieName)
        console.log("addClass 'current' to #" + cookieName)
    } else {
        console.log(cookieName + " cookie value = " + $.cookies.get(cookieName))        
    }
    if(/dev/.test(loc)) {
        $('#' + cookieName).addClass('current');
    }       
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:10:14.510

这可能是一个黑客，但它应该工作

```
var loc = window.location.href;
    if(loc.substring(loc.length-1,loc.length) == '/'){
       loc = loc.substring(0,loc.length-1);} 
```

# c++ - C++ - 在范围和字符中

> ID：12486454
> 
> 赞同：1
> 
> 时间：2012-09-18T23:19:29.263
> 
> 标签：c++

我正在制作一个系统，用户在控制台上输入数字并最终添加它们。我遇到的问题是，如果用户输入一个字符而不是一个数字，程序会告诉有一个错误或者它不能添加，因为系统上插入了一个字符。我用 if-else-else-if 制作了系统，但是自从我放置 || 之后，我花了很长时间来编写代码。例如功能：

```
if (x=="a" || x=="b" || x == "c" ) .... 
```

等等...

C++有没有办法检测输入值是字符还是字符串，程序会出错。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:20:47.593

暗示：

```
if ( x >= 'a' && x <= 'z' ) 
```

会告诉你是否`x`介于`'a'`和之间`'z'`（大写字母类似）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:34:24.500

标准库中有字符分类函数可以为您完成所有这些工作。`isdigit`是一个很好的起点。

# .net - 解决方案的全局可转换设置

> ID：12486456
> 
> 赞同：1
> 
> 时间：2012-09-18T23:19:48.187
> 
> 标签：.net, msbuild, configuration-files

具有多种项目类型的解决方案。它们都引用了一个通用的 dll。

想：

1.  从任何项目（连接字符串等）公开访问配置设置。示例：commondll.My.MySettings.Default.Setting1

2.  根据构建配置（DEV、QA、PROD）转换每个设置

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T05:47:32.060

通常使用配置文件（app.config、web.config）

# php - 数据未插入表中

> ID：12486457
> 
> 赞同：2
> 
> 时间：2012-09-18T23:20:01.340
> 
> 标签：php, mysql, database, mysqli

我正在使用下面的代码上传文件并使用 mysqli 将数据插入“图像”表：

```
<?php
/* check connection */
if (mysqli_connect_errno()) {
    printf("Connect failed: %s\n", mysqli_connect_error());
    die();
}

$result = 0;

//UPLOAD IMAGE FILE

move_uploaded_file($_FILES["fileImage"]["tmp_name"], "ImageFiles/" . $_FILES["fileImage"]["name"]);

$result = 1;

//INSERT INTO IMAGE DATABASE TABLE

$imagesql = "INSERT INTO Image (ImageFile) VALUES (?)";

if (!$insert = $mysqli->prepare($imagesql)) {
    // Handle errors with prepare operation here
}

//Dont pass data directly to bind_param store it in a variable
$insert->bind_param("s", $img);

//Assign the variable
$img = 'ImageFiles/' . $_FILES['fileImage']['name'];

$insert->execute();

$insertimagequestion->execute();

//IF ANY ERROR WHILE INSERTING DATA INTO EITHER OF THE TABLES
if ($insert->errno) {
  // Handle query error here
}

$insert->close();

$lastID = $mysqli->insert_id;

 $imagequestionsql = "INSERT INTO Image_Question (ImageId, SessionId, QuestionId) 
    VALUES (?, ?, ?)";

    if (!$insertimagequestion = $mysqli->prepare($imagequestionsql)) {
      // Handle errors with prepare operation here
       echo "Prepare statement err";
    }

$sessid =  $_SESSION['id'] . ($_SESSION['initial_count'] > 1 ? $_SESSION['sessionCount'] : '');

$insertimagequestion->bind_param("isi",$lastID, $sessid, $_POST['numQuestion'][$i]);

        $insertimagequestion->execute();

                if ($insertimagequestion->errno) {
          // Handle query error here
        }

        $insertimagequestion->close();

}
?> 
```

因此，例如，如果我将 2 个图像“cat.png”和“dog.png”插入“图像”数据库表中，它将像这样插入：

```
 ImageId         ImageFile

    220             cat.png
    221             dog.png

(ImageId is an auto increment) 
```

无论如何我想要做的是，当文件上传时，不仅数据插入到上面的表中，而且我还希望能够检索上面插入的 ImageId 并将其放在下面的“Image_Question”表中所以它会是这样的：

```
ImageId         SessionId      QuestionId

    220            AAA             1 
    221            AAB             4 
```

但它没有在 Image_Question 表中插入任何内容。当我上传图片时，它不仅可以将数据插入到“Image”表中，而且还能够将数据插入到“Image_Question”表中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:50:16.517

如果我离开了，请原谅我，但是 php 不是按顺序执行的，换句话说，不应该 this: `$insertimagequestion->execute();` go after this:`if (!$insertimagequestion = $mysqli->prepare($imagequestionsql))` 吗？也许第一次出现`$insertimagequestion->execute();`是清除插入ID。我会放一些东西来打印并确保你得到了 insert_id。

# codeigniter - 如何在没有登录表单的情况下验证 Codeigniter 用户？

> ID：12486459
> 
> 赞同：0
> 
> 时间：2012-09-18T23:20:15.673
> 
> 标签：codeigniter, authentication

如何在不使用登录表单的情况下验证 Codeigniter 用户？

即，如果他有某个特定值的 cookie，或者他是从某个特定链接重定向的，是否要自动进行身份验证？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:57:00.280

假设这两个应用程序都在 CodeIgniter 上 - 您必须在您的应用程序和将发布 cookie 的第三方之间就某些参数达成一致。

进入`config/config.php`并让双方都设置（至少）：

`$config['sess_cookie_name']`并且`$config['cookie_prefix']`是相同的值。

如果您决定加密您的会话，您还必须在第三方和您的应用程序之间就加密密钥达成一致并`$config['encryption_key']`适当地设置该值。

最后，或许也是最重要的一点，您必须设置 cookie 域，`$config['cookie_domain']`否则 CodeIgniter 将拒绝它。

然后，您可以分别使用`$this->session->userdata()`和获取和设置会话 cookie 。`$this->session->set_userdata()`

我以前从未尝试过这个，所以我不能真正保证或支持任何可能出现的问题，但希望它能让你走上成功的道路。

# image - src.sencha.io 包含使用 URL 参数获取的图像且没有文件扩展名（但内容类型正确）

> ID：12486460
> 
> 赞同：0
> 
> 时间：2012-09-18T23:20:18.013
> 
> 标签：image, extjs

[我在http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871](http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871)有一张图片，我尝试通过 src.sencha.io 运行它，但是当我执行类似[http://src.sencha.io的操作时/80/http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871](http://src.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871)，然后我从 src.sencha.io 收到 400 错误（错误请求）。

我尝试转义`?`字符（[http://src.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx%3Fid=4926871](http://src.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871)），但这也不起作用。

我什至尝试双重转义它只是为了确定（[http://src.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx%253Fid=4926871](http://src.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx%253Fid=4926871)）但没有骰子。

我检查了profiles.ucsf.edu 是否返回了一个不稳定的内容类型，但它返回的是image/jpeg，所以这应该很酷。

我尝试通过附加到 URL 的末尾来欺骗 src.sencha.io，`&.jpg`以查看它是否取决于文件扩展名，但这不起作用。

基于[Sencha 论坛中的一个帖子](http://www.sencha.com/forum/showthread.php?194211-Crazy-Image-Urls)，我尝试了[http://src6.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871](http://src6.sencha.io/80/http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871)但也没有运气。

如果我将图像复制到其他地方并通过 src.sencha.io 使用没有 URL 参数的 URL 运行它，它就可以工作。我将它上传到[http://imgur.com/L91W7](http://imgur.com/L91W7)并尝试在[http://src.sencha.io/80/http://imgur.com/L91W7.png](http://src.sencha.io/80/http://imgur.com/L91W7.png)访问它，这很好。

我可以做些什么来让 src.sencha.io 与profiles.ucsf.edu URL 很好地配合，还是我不走运？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-26T21:29:47.123

源服务器未设置 HTTP Content-length 标头（也不使用分块）：

```
sh-4.1$ wget http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871
--2012-09-26 14:50:53--  http://profiles.ucsf.edu/Thumbnail.ashx?id=4926871
Resolving profiles.ucsf.edu... 64.54.132.33
Connecting to profiles.ucsf.edu|64.54.132.33|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [image/jpeg] 
```

目前 src.sencha.io 将在任何省略 Content-length 标头且不使用分块编码的 HTTP 响应上失败。这是服务器出于资源限制原因检查响应大小的副作用。400 状态有点令人困惑，因为实际上操作由于违反约束而失败，但 400 响应页面仅讨论输入参数的正确性。

这解释了为什么当图像被复制到不同的 HTTP 服务器时您的请求有效。该服务器正在设置 Content-length 标头：

```
sh-4.1$ wget http://imgur.com/L91W7.png
--2012-09-26 15:05:05--  http://imgur.com/L91W7.png
Resolving imgur.com... 54.243.206.51, 23.23.110.81, 23.23.110.58
Connecting to imgur.com|54.243.206.51|:80... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: http://i.imgur.com/L91W7.png [following]
--2012-09-26 15:05:05--  http://i.imgur.com/L91W7.png
Resolving i.imgur.com... 72.21.81.253
Connecting to i.imgur.com|72.21.81.253|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 72842 (71K) [image/png] 
```

我目前知道的唯一解决方法是安排您的 HTTP 服务器发送分块响应或设置 Content-length 标头。[HTTP 1.1 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.4)允许服务器响应，因为它关闭了连接，但 src.sencha.io 目前不会接受该响应。

您的服务器是 IIS 6.0。我做了一些研究，看看省略 Content-length 标头是否是 IIS 6.0 中的一个已知错误。结果尚无定论。有一些关于“压缩静态文件”[选项的讨论可能会导致这个问题](https://serverfault.com/questions/74955/iis-6-downloading-files-file-size-not-shown)，但可能是一个红鲱鱼。[如本文](http://objectmix.com/inetserver/360921-iis6-dynamic-compression-=-no-content-length-header.html)所述，问题可能出在某处损坏的代理中。

顺便说一句，在诊断这个问题时要小心，我们经常看到“客户端”网络设备会修复缺少 Content-length 标头 (!) 的 HTTP 响应，要么添加它，要么将响应转换为分块的响应。因此，请务必从具有 100% 干净连接且没有代理或其他诱骗盒子的机器进行测试。

# gwt - GWT requestFactory + 编辑器框架重载关联实体

> ID：12486462
> 
> 赞同：1
> 
> 时间：2012-09-18T23:20:31.323
> 
> 标签：gwt, gwt2, requestfactory, gwt-editors

我将 GWT 2.5rc1 与 RequestFactory 和 Editor 框架一起使用。当我保存具有关联模型的实体时，服务器`Locator`会在保存之前重新加载关联模型。因此，客户端中的任何更改都会被覆盖。例如：

```
@ProxyFor(value=Foo.class, locator=FooLocator.class)
public interface FooProxy extends EntityProxy {
  void setBar(BarProxy bar);
  BarProxy getBar();

}

@ProxyFor(value=Bar.class, locator=BarLocator.class)
public interface BarProxy interface EntityProxy {
  ...
}

// The save method implemented in an Activity.
// Invoked when the editor's save button is clicked.
public void onSave() {
  // driver is a RequestFactoryEditorDriver
  FooRequest request = (FooRequest) driver.flush();
  request.save(entity).fire(myReceiver);
}

// The service on the server that saves the two entities.
public class FooService {

  public Foo save(Foo foo) {
    barDao.save(foo.getBar()); // Bar has been reloaded via the BarLocator and all changes lost
    fooDao.save(foo);
    return foo;
  }
} 
```

在服务器上，`BarLocator.find(...)`调用该方法重新加载 Bar 实例并覆盖对传入 Bar 实例所做的任何更改。

示例日志输出：

```
FooLocator loading Foo
setBar called
BarLocator loading Bar
save called 
```

最后三行都是指从数据库加载的 Bar；我从未在我的任何定位器或服务代码中看到更改后的栏。

# c++ - Visual C++ 中的链接器错误 LNK2019

> ID：12486467
> 
> 赞同：2
> 
> 时间：2012-09-18T23:20:53.103
> 
> 标签：c++

尝试从我的主方法调用类方法时遇到链接器错误。我已经寻找答案，但似乎没有任何适用于我的问题，任何帮助将不胜感激。

## 文件系统.h

```
#ifndef FILE_SYSTEM_H
#define FILE_SYSTEM_H

#include <fstream>
#include <string>
#include <random>

#include "SortingAlgorithms.h"
#include "SortingAlgorithms.cpp"

using namespace std;

class FileSystem
{
private:
    ifstream inFile;
    ofstream outFile;

    template <class T>
    void fillArrays( T randomArray[], T sortedArray[], T backwardArray[], int size );

public:
    FileSystem();
    ~FileSystem();

    bool openFile(string fileName);
    void writeToFile(string output);
    void createTestFiles(string testFiles[]);

    template <class T>
    void fillArrayFromFile(T list[], int size);
};

#endif 
```

## fillArrayFromFile

```
template <class T>
void FileSystem::fillArrayFromFile(T list[], int size)
{
    int i;

    for(i = 0; i < size; i ++)
    {
        inFile >> list[i];
    }

    inFile.clear();
    inFile.seekg(inFile.beg);
} 
```

## pa2.cpp

```
#include <iostream>
#include <ctime>
#include <string>
#include <iomanip>

#include "TimerSystem.h"
#include "FileSystem.h"

using namespace std;

int main()
{
    FileSystem file;
    int testArray[10];

    file.openFile("test-10-0.txt");
    file.fillArrayFromFile(testArray, 10);
} 
```

## 错误：

```
pa2.obj : error LNK2019: unresolved external symbol "public: void __thiscall FileSystem::fillArrayFromFile<int>(int * const,int)" (??$fillArrayFromFile@H@FileSystem@@QAEXQAHH@Z) referenced in function _main
C:\Users\Matt\Google Drive\Programming\Data Structures & Algorithms\PA2-9-15-2012\Debug\PA2.exe : fatal error LNK1120: 1 unresolved externals 
```

再次感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:01:21.063

在编译调用`template`函数的代码时，编译器必须能够看到函数的完整实现。在编译器正在构建的时候`pa2.cpp`，编译器只查看`FileSystem.h`头文件中的定义（`pa2.cpp`当然还有其他头文件）。它不看当时的内容`FileSystem.cpp`。

要解决此问题，请将实现移动`FileSystem::fillArrayFromFile()`到头*文件*而不是`.cpp`文件。您可以通过以下两种方式之一执行此操作：

```
class FileSystem {
public:
    template <class T>
    void fillArrayFromFile(T list[], int size);
};

template <class T>
void FileSystem::fillArrayFromFile(T list[], int size)
{
    // ...
} 
```

或者

```
class FileSystem {
public:
    template <class T>
    void fillArrayFromFile(T list[], int size)
    {
        // ...
    }
}; 
```

# asp.net-mvc-3 - mvc3 下拉列表呈现部分视图和持久化数据

> ID：12486470
> 
> 赞同：1
> 
> 时间：2012-09-18T23:21:07.130
> 
> 标签：asp.net-mvc-3

我试图让一个页面呈现一个 mvc 下拉列表并在下拉列表中的值更改时呈现部分视图。在我单击局部视图中的按钮以保留在局部视图中所做的更改之前，它工作正常。

我的部分视图有以下代码 -

```
<script type="text/javascript">
    $(function () {
        $("#sortable, #sortable2").sortable({
            connectWith:  ".connectedSortable"
        }).disableSelection();        
    });

    $(function () {
        $("button").button();
        $(".submit").click(function () {
            var list = "somedata";
            var companyid = $("#myid").text();            
            $.ajax({
                url: "/Controller/Action",
                data: {
                    'values': list,
                    'id': myid
                }
            });
        });
    });

</script>

......

<div class="submit">
    <button>Submit</button>
</div> 
```

这是我的主要视图的代码 -

```
<script type="text/javascript">
    function processList() {
        var myid = $("#ddList").val();
        $.ajax({
            url: 'Controller/Action/',
            data: {
                'id': myid 
            },
            datatype: 'html',
            success: function (result) { success(result); }            
        });
    }

    function success(result) {
        $("#partial").html(result);
    }
</script>

@using (Html.BeginForm("Action", "Controller"))
{      
    @Html.DropDownListFor(x => x.SelectedValue, Model.MyEntity, new { @id = "ddList", onchange = "processList();" })

<div id="partial" style="height:  90%">

        @Html.Partial("_MyPartialView")

</div>
} 
```

我的控制器的代码如下 -

```
public ActionResult Action(int? id)
        {                        
            id = id ?? 1;    

            var vm = new MyViewModel
            {
                .....
            };
            return PartialView("_MyPartialView", vm);
        }

        public ActionResult PersistActivities(int myid, string values)
        {
            int result = _service.UpdateActivityOrderByCompany(companyid, values);                         
            return new EmptyResult();            
        } 
```

当我单击持久按钮时，我希望页面仅重新呈现部分视图。即使它什么也没做，那也没关系。实际发生的是控制器再次进入“Action”动作，然后引发渲染错误。如果我继续处理 jquery 错误，则只有部分视图数据会呈现在整个窗口中。

谁能指出我的渲染/控制器调用问题出在哪里？

我希望这是足够的信息。我不得不削减代码，但如有必要可以提供更多。

感谢您的任何想法。

EDTI -

我得到的错误是在用于呈现可排序列表的第一个函数的部分视图中 -

Microsoft JScript 运行时错误：预期对象

希望有帮助

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:49:25.237

有很多事情可能是正在发生的事情的原因。

您的网址可能不正确。

```
url: 'Controller/Action/', 
```

应该：

```
url: '@Url.Action("Action", "Controller")', 
```

您的按钮提交代码是指您`Action`的`Controller`，但您可能希望它转到您的`PersistActivities`. 此外，您的控制器操作需要变量`myid`and `values`，但您正在发送`id`and values `instead`。您还指的是 html 元素 myid，但此处未显示，我假设您为简洁起见将其省略了。也没有成功功能-您打算让该按钮实际做什么？

你可能想要的是这样的：

```
 $(".submit").click(function () {
     var list = "somedata";
     var myid = 1;
     alert(myid);
     $.ajax({
        url: '@Url.Action("PersistActivities", "Home")',
        data: {
           'values': list,
           'myid': myid
        }            
     });
  }); 
```

最后，您的按钮发布页面的原因是它正在提交表单。如果您不希望它实际提交表单，您应该将按钮的类型更改为类型按钮。

```
<button type="button">Submit</button> 
```

# php - 返回意外数字的 PDO 提取计数

> ID：12486471
> 
> 赞同：1
> 
> 时间：2012-09-18T23:21:10.513
> 
> 标签：php, pdo

我正在尝试设置登录系统，但无法检查从我的 PDO 调用返回到我的数据库的行数。当提供错误的用户名和/或密码时，以下代码应返回 0 行，但无论密码或用户名如何，它似乎都返回 1 行。

```
require_once("includes/database.php");
session_start();
$dbh = db_connect();
$response = array();

$user = $_POST['username'];
$password = $_POST['password'];

$check_login = "SELECT * FROM user WHERE user=:user AND password=:password LIMIT 1";
$check_login_stmt = $dbh->prepare($check_login);
$check_login_stmt->bindParam(":user", $user);
$check_login_stmt->bindParam(":password", $password);

if(!$check_login_stmt->execute()) {
    $response['code'] = "failure";
    $response['err'] = $check_login_stmt->errorInfo();
    $response['reason'] = "bad_query";
} else {
    if(count($user = $check_login_stmt->fetch()) > 0) {
        $_SESSION['login'] = true;
        $_SESSION['pb_committee'] = $user['pb_committee'];
        $response['code'] = "success";
        $response['count'] = count($user);
    } else {
        $response['code'] = "failure";
        $response['reason'] = "bad_reqs";
    }
}

echo json_encode($response); 
```

当我执行 count($user = $check_login_stmt->fetchAll()) > 0 时，它可以工作。但我不明白为什么，我宁愿使用 fetch() 因为我将它限制在 SELECT 语句中的一行。

任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:26:12.177

我不能保证`count($nonArrayVariable)`会做什么，但你可能会玩得更好：

```
} else {
   if ($check_login_statement->rowCount() > 0) {
      $user = $check_login_stmt->fetch()
      // etc.
   } 
```

请注意，这`> 0`是多余的。

另外，请不要将密码以纯文本形式存储在数据库中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:36:07.287

任何传递给`count()`它的还不是数组的东西都被转换为数组。对于大多数事情，这将导致`count()`返回`1`（`NULL`这是我现在能想到的唯一例外）。

也就是说，您应该检查[fetch mode](http://us3.php.net/manual/en/pdostatement.setfetchmode.php)`PDO` ，因为您可能会返回一个非数组，这将导致所描述的行为。

# php - 移动到新的私人服务器，现在无法通过 PHP 上传大文件

> ID：12486476
> 
> 赞同：0
> 
> 时间：2012-09-18T23:21:47.903
> 
> 标签：php, apache, upload

我有一个共享服务器，并且已经能够上传大约文件。大小为 50 兆，没有问题，并且在我的 php.ini 文件中设置了限制，允许上传高达 100 兆。

我进行了潜水并获得了一个私人服务器帐户，并更改了我的 php.ini 文件以匹配我共享框中的那个...现在由于某种原因我无法上传大约 50 兆的文件。

我在 php.ini 中出于测试目的更改的项目包括：

```
memory_limit: 200M
max_execution_time: 1000
max_input_time: 1000
upload_max_filesize: 100M
post_max_size: 200M
--*These are just set like this for testing purposes until I get it working...* 
```

此外，我在上传后执行的脚本目录和包含以下内容的目标文件夹中都设置了一个 .htaccess 文件：

```
"LimitRequestBody 102400000" 
```

然而它仍然无法正常工作。我想我只是很困惑为什么这会在共享盒子上工作，而不是在我的新 VPS 上工作。有没有我在某处缺少的设置？

我之前测试过一个 40 兆的文件，它可以工作，但 43 兆没有...

更具体地说，我在处理文件的 php 脚本中运行它时遇到错误：

```
!is_uploaded_file($_FILES['photoupload']['tmp_name']){
echo "error";
} 
```

这让我相信它与 http post 有关，但是，我不能对此持肯定态度，正如我所说，相同的脚本在共享服务器上完美运行。

它可能与apache用户的权限有关吗？在这一点上我很困惑。

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:43:26.253

您是否检查过以确保您有一个临时目录设置并正确配置？

如果将 40 MB 上传到这个新服务器，我会怀疑你在那里很好。

我会通过两台服务器之间的 phpinfo() 调用来比较您的 PHP 设置，以找出您缺少的内容。如果您通过 PHP 发布它，Apache 将与它没有任何关系。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:50:06.907

如果您的服务器位于数据中心，则数据中心可能会将您的传输速度降低到上传 50 兆文件需要超过 15 分钟的时间。如果您的 apache 配置和服务器的设置方式完全相同，则表明存在网络问题。尝试增加 max_input_time: 1000

# c++ - C++ 我可以在自己的函数中传递指向对象的指针吗？

> ID：12486481
> 
> 赞同：0
> 
> 时间：2012-09-18T23:22:54.937
> 
> 标签：c++, class, object, pointers

例如，

我有一个带有一些成员函数的类 foo..

在某些功能中说..

```
void foo::someFunction()
{

int pointer = ??????

} 
```

如何传递指向对象 foo 的指针？

我可以这样做吗？还是我必须在外部进行？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-09-18T23:25:32.707

```
foo* pointer = this; 
```

`foo*`请注意，指针类型不应为`int`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-09-18T23:25:36.777

为此目的，命名的特殊指针`this`在（非静态）成员函数中可用。但是，它与 的赋值不兼容`int`，而是具有 type `foo *`。

# objective-c - 当我使用 dispatch_async 时 NSCollectionView UI 没有更新

> ID：12486482
> 
> 赞同：0
> 
> 时间：2012-09-18T23:23:04.907
> 
> 标签：objective-c, cocoa

所以我有一个包含歌曲列表的 NSCollectionView。当我更新 NSCollectionView 通常代表的数组时，UI 会反映该更改：

图片：[http ://cl.ly/image/1D3A1o192k3W](http://cl.ly/image/1D3A1o192k3W)

代码：

```
[self setCurrentPlaylist:[HMRequest playlistPopular3Day]]; 
```

（注：_currentPlaylist 为数组，`[HMRequest playlistPopular3Day]`返回歌曲数组）

`dispatch_async`但是当我突然尝试使用时，用户界面变得疯狂。NSCollectionView 的可见部分不会更新，但是当我向下滚动时，之前隐藏的部分会正确更新。

图片（我滚动了一下，空白的白色是以前可见的，歌曲是隐藏的滚动视图的一部分）：[http ://cl.ly/image/3y0f212Y3W3S](http://cl.ly/image/3y0f212Y3W3S)

代码：

```
dispatch_queue_t aQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_async(aQueue, ^{        
    [self setCurrentPlaylist:[HMRequest playlistPopular3Day]];
}); 
```

有什么帮助避免那个空白的 UI 部分吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:33:14.577

AppKit 的大多数部分都不是线程安全的，因此您应该只在主线程上而不是在后台线程上进行 UI 更新。此外，屏幕截图看起来您实际上并不想使用 a`NSCollectionView`而是 a `NSTableView`，这在性能方面要快得多。

# php - 在默认控制器上加载控制器方法而不引用 URL 中的控制器

> ID：12486483
> 
> 赞同：0
> 
> 时间：2012-09-18T23:23:06.280
> 
> 标签：php, codeigniter, routing

您好我正在开发一个 CodeIgniter 应用程序，为用户提供他们自己的网站。

我要完成的工作：如果用户有一个帐户，他们有自己的子域（例如：user.website.com），并且默认控制器变为“user_website”，如果网站可以正常访问（无子域）默认控制器是“网站”。

当用户访问他们的部分时，我有一个方法，例如称为“测试”

因此，要访问该用户，请访问：user.website.com/user_website/test

我想要发生的是：user.website.com/test

* * *

所以基本上我要问的是，如果有一个子域在使用中直接访问控制器的访问方法，而无需将控制器放在 url 中，我该如何获取 codeigniter。

因此，它不会使用 user.website.com/auth 去 auth 控制器，而是使用 user_website 控制器的 auth 方法

如果有人可以帮助我解决这个问题，或者指出我正确的方向，在此先感谢。

这里还有来自 MY_Controller 的 _remap 函数，我的所有控制器都扩展了它。

```
public function _remap($method, $arguments)
    {

        if (method_exists($this, $method))
        {
            call_user_func_array(array($this, $method), array_slice($this->uri->rsegments, 2));
        }
        else
        {
            show_404(strtolower(get_class($this)).'/'.$method);
        }

        $this->_load_view();
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:29:37.743

您可以尝试一条路线，但您要问的可能很复杂。我有这样的路线

```
$route['(:any)'] = "user_website/$1"; 
```

因此，如果有人访问 user.website.com/test，它会将他们路由到控制器 user_website 并调用方法 test，这就是您要找的吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:31:47.213

看看[这个](http://net.tutsplus.com/tutorials/php/basecamp-style-subdomains-with-codeigniter/)来自 NET TUTS 的非常方便的教程，它应该能回答你的大部分问题。

# c++ - 使用顶点着色器 OpenGL 3.x 计算观察矩阵

> ID：12486484
> 
> 赞同：2
> 
> 时间：2012-09-18T23:23:08.700
> 
> 标签：c++, opengl, matrix, glsl, glm-math

我按照这篇文章构建了 GluLookAt 类型矩阵。

[计算 LookAt 矩阵](https://stackoverflow.com/questions/349050/calculating-a-lookat-matrix#comment8075824_349050)

```
 Method calculateLookAtMatrix(glm::vec3 eye, glm::vec3 center, glm::vec3 up)

    glm::vec3 zaxis = glm::normalize(center - eye);
    glm::vec3 xaxis = glm::normalize(glm::cross(up, zaxis));
    glm::vec3 yaxis = glm::cross(zaxis, xaxis);

    lookAtMatrix[0][0] = xaxis.x;
    lookAtMatrix[0][1] = yaxis.x;
    lookAtMatrix[0][2] = zaxis.x;

    lookAtMatrix[1][0] = xaxis.y;
    lookAtMatrix[1][1] = yaxis.y;
    lookAtMatrix[1][2] = zaxis.y;

    lookAtMatrix[2][0] = xaxis.z;
    lookAtMatrix[2][1] = yaxis.z;
    lookAtMatrix[2][2] = zaxis.z;

    lookAtMatrix[3][0] = glm::dot(xaxis, -eye);
    lookAtMatrix[3][1] = glm::dot(yaxis, -eye);
    lookAtMatrix[3][2] = glm::dot(zaxis, -eye);

    lookAtMatrix[3][3] = 1; 
```

我计算那个 CPU 端，并以与透视矩阵相同的方式将其作为统一传递给着色器。

着色器看起来像这样。

```
 gl_Position =   lookAtMatrix * position * perspectiveMatrix; 
```

如果将lookAtMatrix 作为单位矩阵传入，则场景会正确渲染，但是使用上面的代码将矩阵设置为...

```
 eye(0.0f,0.0f,10.0f);
center(0.0f,0.0f,0.0f);
up(0.0f,0.0f,1.0f); 
```

导致一个空白的场景。场景是在 X/Y 上绘制的 10x10 网格，因此我一直期待场景的缩小视图。

（我玩过行和列，但我 99.9% 确信它们很好，因为透视矩阵很好）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-19T04:44:46.800

```
gl_Position =   lookAtMatrix * position * perspectiveMatrix; 
```

这是不正确的。您想通过lookAtMatrix 转换您的位置，然后通过perspectiveMatrix 转换结果。

当使用列向量/列主向量和矩阵时，您希望通过将向量放在矩阵的右侧来将矩阵和向量相乘。

所以你的乘法最终应该是这样的：

```
gl_Position =   perspectiveMatrix * lookAtMatrix * position; 
```

话虽如此，我不确定您为什么首先将位置放在左侧，所以我想知道您是否在管道中的某个地方进行了一些矩阵转置。如果此解决方案不起作用，您可能需要显示更多代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-18T23:29:56.850

```
eye(0.0f,0.0f,10.0f);
center(0.0f,0.0f,0.0f);
up(0.0f,0.0f,1.0f); 
```

`up`矢量方向平行于观察方向。这是不允许的。

请记住：向上方向定义了“向上”对视图的含义。它定义了围绕观察方向的旋转。如果向上方向*是*观察方向，则数学不再有效。

# c++ - std::vector 与 std::stack

> ID：12486487
> 
> 赞同：25
> 
> 时间：2012-09-18T23:23:17.347
> 
> 标签：c++, stl, stack, stdvector

`std::vector`和 和有什么不一样`std::stack`？

显然，向量可以删除集合中的项目（尽管比列表慢得多），而堆栈被构建为仅限 LIFO 的集合。

*但是，最终项目操作的堆栈是否更快？它是链表还是动态重新分配的数组？*

我找不到关于堆栈的太多信息，但如果我正确地描绘了它们（它们类似于实际的线程堆栈；推送、弹出等 - 以及该`top()`方法），那么它们似乎非常适合窗口堆叠管理。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2012-09-18T23:25:18.777

A`stack`不是容器；它是一个容器*适配器*。它有一个`vector`,`deque`或类似的容器，它存储为实际保存元素的成员。请记住：它被声明为：

```
template<
    class T,
    class Container = std::deque<T>
> class stack; 
```

所做的只是将用户界面限制在`stack`这个内部容器中。操作的性能特征与底层容器的性能特征完全相同。

# twitter-bootstrap - 在导航栏固定菜单栏中更改背景颜色 Bootstrap

> ID：12486488
> 
> 赞同：3
> 
> 时间：2012-09-18T23:23:42.573
> 
> 标签：twitter-bootstrap

我想在 Bootstrap 中更改我的导航栏固定菜单栏的颜色。在 application.css.scss 我有这个：

```
.navbar
  .navbar-inner {
    background-color: #2c2c2c;
  }
} 
```

在 application.html.erb 我有这个：

```
<header class="navbar navbar-inverse navbar-fixed-top">
<nav class="navbar-inner"> 
```

有人可以解释为什么我仍然看到黑色作为菜单栏背景（我怀疑我没有完全匹配这些类）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-09-18T23:27:52.657

默认情况下，导航栏使用 CSS 渐变。这使用该`background-image`属性。您还需要重置此值：

```
.navbar {
  .navbar-inner {
    background-color: #2c2c2c;
    background-image: none;
  }
} 
```

更新：添加了缺失的大括号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-12-31T09:11:08.077

```
<style type="text/css">
    .navbar {
        background-color:#00FFCC;
        background-image: none;
    }
</style> 
```

只需使用此代码，您的 css 中就会出现一些逻辑错误

# android - SQLite 错误请求错误

> ID：12486493
> 
> 赞同：0
> 
> 时间：2012-09-18T23:24:26.183
> 
> 标签：android, sqlite

我正在尝试将 sqlite 数据库中的短信导入短信收件箱。db 位于 SD 卡上。我收到错误请求错误。Sql 语句结构正确。我不确定是什么错误。请帮我找出错误在哪里。

MainActivity 片段：

```
 private void importSms() {
    int id = 10;
    while(id < 10860) {  
        System.out.println("The id is " + id);
        String address = null;
        String body = null;
        dbHelper.returnAddress(id);
        dbHelper.returnBody(id);
        ContentValues values = new ContentValues();
        values.put("address", address);
        values.put("body", body);
        getContentResolver().insert(Uri.parse("content://sms/inbox"), values);
        Toast.makeText(getApplicationContext(),"Importing sms number" + id,Toast.LENGTH_SHORT).show();
        id = id ++;
    }

    Toast.makeText(getApplicationContext(),"Finished import",Toast.LENGTH_LONG).show();
} 
```

DataBaseHelper 片段：（如果需要，我可以发布整个课程，它不是那么大）

```
 public String returnAddress(int id) {
    System.out.println("returnAddress has been called");
    openDataBase();
    SQLiteDatabase db = getReadableDatabase();

                String addressQuery = "SELECT address FROM sms WHERE _id = " + id;
                Cursor ca = db.rawQuery(addressQuery, null);
                ca.moveToFirst();
                String address = ca.getString(1);
                return address;

}
public String returnBody(int id) {
    System.out.println("returnBody has been called");
    openDataBase();
    SQLiteDatabase db = getReadableDatabase();

                String bodyQuery = "SELECT body FROM sms WHERE _id = " + id;
                Cursor cb = db.rawQuery(bodyQuery, null);
                cb.moveToFirst();
                String body = cb.getString(2);
                return  body;

} 
```

错误信息：

```
09-18 19:09:33.466: I/System.out(2729): The id is 10
 09-18 19:09:33.466: I/System.out(2729): returnAddress has been called
 09-18 19:09:33.526: E/CursorWindow(2729): Bad request for field slot 0,1\. numRows = 1, numColumns = 1
 09-18 19:09:33.526: D/AndroidRuntime(2729): Shutting down VM
 09-18 19:09:33.526: W/dalvikvm(2729): threadid=1: thread exiting with uncaught exception (group=0x40015560)
 09-18 19:09:33.526: E/AndroidRuntime(2729): FATAL EXCEPTION: main
 09-18 19:09:33.526: E/AndroidRuntime(2729): java.lang.IllegalStateException: get field slot from row 0 col 1 failed
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.database.CursorWindow.getString_native(Native Method)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.database.CursorWindow.getString(CursorWindow.java:329)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.database.AbstractWindowedCursor.getString(AbstractWindowedCursor.java:49)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at com.mobile.sms.testing.DataBaseHelper.returnAddress(DataBaseHelper.java:64)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at com.mobile.sms.testing.MainActivity.importSms(MainActivity.java:53)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at com.mobile.sms.testing.MainActivity.access$0(MainActivity.java:47)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at com.mobile.sms.testing.MainActivity$1.onClick(MainActivity.java:41)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.view.View.performClick(View.java:2485)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.view.View$PerformClick.run(View.java:9080)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.os.Handler.handleCallback(Handler.java:587)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.os.Handler.dispatchMessage(Handler.java:92)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.os.Looper.loop(Looper.java:130)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at android.app.ActivityThread.main(ActivityThread.java:3683)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at java.lang.reflect.Method.invokeNative(Native Method)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at java.lang.reflect.Method.invoke(Method.java:507)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)
 09-18 19:09:33.526: E/AndroidRuntime(2729):    at dalvik.system.NativeStart.main(Native Method)
 09-18 19:09:35.676: I/Process(2729): Sending signal. PID: 2729 SIG: 9 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:47:30.590

看起来您正试图从不存在的列中获取字符串。

我认为这可能是您需要的：

```
String addressQuery = "SELECT _id, address FROM sms WHERE _id = ?";
Cursor ca = db.rawQuery(addressQuery, id);
ca.moveToFirst();
int addressColumn = ca.getColumnIndexOrThrow ("address");
String address = ca.getString(addressColumn); 
```

此代码参数化您的 id 并让您知道您获得了正确的列。

虽然，`IllegalStateException`让我想知道数据库是否可读

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T07:03:15.627

查看您的查询，您只返回一列，并且游标中的列从 0 开始编号。因此 using`String address = ca.getString(1);`本质上是要求它从（不存在的）第二列中提取数据......与您的相同体法。

更改这些代码，我相信您的问题将得到解决。

```
String address = ca.getString(0);
String body = cb.getString(0); 
```

更好的是，按照 pjco 的建议进行操作并使用该`getColumnIndexOrThrow`方法，因为如果您在游标中插入或删除其他元素（因此可能会更改所需数据的列 ID），则不必在整个过程中更改列 ID你的应用程序的其余部分：

```
String address = ca.getString(ca.getColumnIndexOrThrow("address"));
String body = ca.getString(ca.getColumnIndexOrThrow("body")); 
```

# javascript - 如何更改输入按钮的显示文本，而不更改其值？

> ID：12486501
> 
> 赞同：0
> 
> 时间：2012-09-18T23:25:46.183
> 
> 标签：javascript, html, forms, input

我想将输入提交按钮的显示文本从说 foo 更改为 bar。但我不想改变价值。任何人都可以帮忙吗？

```
<input type="submit" name="random" value="foo" /> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:28:04.637

对不起，但你不能。不过，你可以试试这个：

```
<button value="foo">bar</button> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T05:20:23.070

复制粘贴制作：

```
< script type="text/javascript" >
function replaceScript() {
    var toReplace = 'value="foo"';
    var replaceWith ='value="bar"';
    document.body.innerHTML = document.body.innerHTML.replace(toReplace, replaceWith);
}
< /script > 
```

然后在 body 标记中初始化以在页面加载时执行。

```
<body OnLoad = "replaceScript();"> 
```

应该可以正常工作并替换 html 正文代码中的所有实例。

来源：[查找和替换字符串](https://stackoverflow.com/questions/5951801/find-and-replace-string)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2021-09-01T11:03:40.137

`<button type="submit" name="random" value="foo">bar</button>` 这对我有用。在 Chrome 和 Firefox 上测试。

# ios - MonoTouch 是否支持模块初始化程序？

> ID：12486507
> 
> 赞同：2
> 
> 时间：2012-09-18T23:26:10.380
> 
> 标签：ios, xamarin.ios, cil, il

只是好奇 MonoTouch 是否支持“模块初始化器”？ [http://blogs.msdn.com/b/junfeng/archive/2005/11/19/494914.aspx](http://blogs.msdn.com/b/junfeng/archive/2005/11/19/494914.aspx)

相关问题：[Mono 是否支持“模块初始化程序”？](https://stackoverflow.com/questions/7974726/does-mono-support-module-initializers)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T13:11:05.483

您的第一个链接至少回答了一半您自己的问题。Mono 运行时支持**Module Initializers**并且完成的测试（以证明这一点）是使用 Mono 的 JIT 执行的。

MonoTouch 在 iOS 模拟器上执行时使用 JIT，所以没有理由不能在那里工作。

它也可能适用于设备（​​或者它是一个[错误](http://bugzilla.xamarin.com)），即使用 AOT 编译器的地方。正如杰森所说，这是一个测试它的问题。如果您不能自己测试它，只需填写错误报告并附加一个（自包含的）测试用例，我们将确认它是否有效（或保持错误开放直到它有效）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T01:51:44.237

从您链接到的 MSDN 文章

> 由于 C# 不支持全局函数，因此 C# 不支持模块初始化程序。

# ajax - 处理ajax请求时不调用spring mvc @InitBinder

> ID：12486512
> 
> 赞同：0
> 
> 时间：2012-09-18T23:26:47.797
> 
> 标签：ajax, spring-mvc

```
@InitBinder
public void initBinder(WebDataBinder binder) {
    this.binder = binder;
} 
```

处理普通请求时可以调用该函数，但如果第一个请求是ajax请求

```
@RequestMapping("create")
@ResponseBody
public String create(@RequestBody String body) {
    JSONObject result = new JSONObject();
    try{
        JSONObject params = new JSONObject(body);
        T t = buildEntity(params);
        service().save(t);
        result.put(ExtConstant.DATA, t.detailJson());
        result.put(ExtConstant.SUCCESS, true);
    }catch(Exception e){
        result.put(ExtConstant.SUCCESS, false);
        result.put(ExtConstant.ERROR_MSG, e.getMessage());
        e.printStackTrace();
    }
    return result.toString();
} 
```

未调用函数 initBinder，binder 为空。这真的让我很困惑

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:19:41.900

是的，这是正确的行为 -`@InitBinder`仅在解析需要绑定的参数时才调用带注释的方法，因此在您的情况下，如果您有一个带有参数的`@RequestMapping`/`@ModelAttribute`方法，例如需要绑定的命令/模型对象，那么`@InitBinder`将被调用。

在这种特定情况下，您的`create`方法有一个带有注释的参数主体`@RequestBody`，该参数不是由绑定器而是由 MessageConverters（从 json/xml 到适当的类型）解析的，因此`@InitBinder`不会调用该方法。

# android - 使 ListView 滚动平滑

> ID：12486513
> 
> 赞同：2
> 
> 时间：2012-09-18T23:26:53.827
> 
> 标签：android, design-patterns

我正在探索 Android 开发者网站并阅读一些文章。有一种方法可以使用 AsyncTask 在列表视图中延迟加载图像：

```
// Using an AsyncTask to load the slow images in a background thread
new AsyncTask<ViewHolder, Void, Bitmap>() {
    private ViewHolder v;

    @Override
    protected Bitmap doInBackground(ViewHolder... params) {
        v = params[0];
        return mFakeImageLoader.getImage();
    }

    @Override
    protected void onPostExecute(Bitmap result) {
        super.onPostExecute(result);
        if (v.position == position) {
            // If this item hasn't been recycled already, hide the
            // progress and set and show the image
            v.progress.setVisibility(View.GONE);
            v.icon.setVisibility(View.VISIBLE);
            v.icon.setImageBitmap(result);
        }
    }
}.execute(holder); 
```

但是，对我来说，该代码似乎存在一些问题。假设我们从 Internet 加载图像，它们每个都需要几秒钟的时间来加载。

作为用户，如果我们滚动列表然后切换到另一个活动，将会有一些 AsyncTask 在后台运行并占用一些带宽，而我们可能在新的前台活动中需要它。

您通常如何使用他们的方法处理这种情况？回收视图时，您是否杀死了与持有者关联的 AsyncTask？您是否在适配器中跟踪哪些 AsyncTasks 仍在运行并在活动停止时将它们全部取消？还有其他方法吗？

我的问题主要是关于架构清理部件以解决该问题（而不是实现）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T17:18:44.057

我会说大多数时候下载并没有花费足够的时间来解决这个问题，但如果是这样，你应该杀死它们。同样在他们的实现中，他们下载图像并检查视图是否已被重用。如果你有很长的延迟，你应该在重用时取消任务。请注意，任务的执行顺序因 Android 版本而异。从[文档](http://developer.android.com/reference/android/os/AsyncTask.html)：

> 首次引入时，AsyncTask 在单个后台线程上串行执行。从 DONUT 开始，这被更改为允许多个任务并行运行的线程池。从 HONEYCOMB 开始，任务在单个线程上执行，以避免并行执行导致的常见应用程序错误。
> 
> 如果你真的想要并行执行，你可以使用 THREAD_POOL_EXECUTOR 调用 executeOnExecutor(java.util.concurrent.Executor, Object[])。

# python - python中抛硬币，抛硬币1000次，需要运行3次并求平均值

> ID：12486514
> 
> 赞同：-2
> 
> 时间：2012-09-18T23:26:59.647
> 
> 标签：python, coin-flipping

这是我到目前为止所拥有的。问题要求我们运行`coinToss(1000)`一定次数。然后根据它运行的 3 次找出平均正面数。（例如，如果我们有 400 个正面，350 个正面，然后是 600 个正面，程序将返回 450 个正面作为这三个正面的平均值。）我被难住了，因为我不知道如何让这个东西运行三次，然后返回平均值。任何帮助将不胜感激！

```
import random

def coinToss(number):

    heads = 0
    tails = 0
    for i in range(0, number):
        flip = int(random.random()*2)
        if (flip == 0):
            heads = heads + 1
        else:
            tails = tails + 1
    return (heads, tails)

def simulatecoinToss(counter):

    for i in range(0, counter):
        coinToss(1000)
        counter = counter -1
    return 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:53:15.980

```
simulateCoinToss(counter,number):
    trial_heads = (coinToss(number)[0] for _ in xrange(counter))
    average_heads = float(sum(trial_heads))/counter
    return (average_heads, number-average_heads) 
```

*注意：你实际上不需要记录任何关于尾巴的东西（如heads+tails=number）。*

# macos - os x 上的黑莓设备调试无法访问文件系统

> ID：12486515
> 
> 赞同：0
> 
> 时间：2012-09-18T23:27:02.743
> 
> 标签：macos, debugging, blackberry, filesystems, jde

能在 OS X 上开发 Blackberry 软件真是太好了。我需要运行桌面软件才能从 JDE 访问设备。当我启动调试会话时，我无法设置断点，但我可以在 JDE 控制台上看到 System.out。问题是手机看不到 file:///store/...（错误 10003） 研究表明，只要桌面连接手机，运行的应用程序就无法访问文件系统。将手机与取景器断开连接无济于事。断开黑莓桌面会终止调试会话。

那么问题来了：如何让 JDE 调试器与在手机上读写文件的应用程序保持连接？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:27:02.743

1.  通过 USB 插入黑莓
2.  黑莓桌面会弹出
3.  运行 JDE
4.  让mac进入睡眠状态
5.  让黑莓插上电源
6.  再次唤醒 Mac
7.  没有驱动器重新连接
8.  黑莓桌面运行但显示弹出
9.  JDE 仍然可以看到黑莓
10.  调试工作，而应用程序可以看到黑莓文件系统

# c - 从内存中释放单链表时出现分段错误

> ID：12486521
> 
> 赞同：0
> 
> 时间：2012-09-18T23:27:50.333
> 
> 标签：c, data-structures

我对指针和 C 的想法相对较新，所以如果这是一个非常简单的问题，我深表歉意。我正在尝试从创建的内存中释放一个单链表。单个列表创建得很好，但是我无法从内存中释放它，我遇到了分段错误。有什么想法我哪里出错了吗？我需要为 freelist 和 freenode 提供单独的方法。Avail 是一个全局指针变量，它是我确信可以工作的代码的一部分。问题存在于免费列表中，我只是不确定在哪里。

```
 void freelist(olnode **list) {
   olnode *ptr = *list;
    while (*list != NULL) {
     ptr = *list
     freenode(&ptr);
     ptr = ptr->next;
    }
   }

   void freenode(olnode **ptr) {
    if(*ptr != NULL) {
     (*ptr)->next = avail;
     avail = *ptr;
     *ptr = NULL:
    }
   } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-18T23:33:59.423

Freenode 将传递给它的指针设置为 NULL。之后 freelist 尝试取消引用现在为空的指针。这就是程序崩溃的地方。

除此之外，您的程序并没有真正释放任何数据。它只是将指向数据的指针更改为指向 NULL。这意味着内存将保持分配状态并且不可用于新数据。要将指针指向的内存标记为不再需要，您需要从标准库中对指向它的指针调用[free()方法。](http://www.cplusplus.com/reference/clibrary/cstdlib/free/)之后不需要将指针设置为 NULL，但一个好的做法是确保任何后续尝试访问已释放的内存位置都会导致可预测的崩溃，而不是完全不可预测的行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:30:43.253

您需要`next`在释放它之前从节点中获取指针。

不是这个：

```
 freenode(&ptr);
 ptr = ptr->next; 
```

但是这个：

```
 olnode *next = ptr->next;
 freenode(&ptr);
 ptr = next; 
```

# c# - 是什么导致 Razor 模板拒绝依赖于 System.Windows 的类？

> ID：12486525
> 
> 赞同：2
> 
> 时间：2012-09-18T23:28:06.537
> 
> 标签：c#, wpf, asp.net-mvc, razor

我有一个通用模型：

```
public abstract class MyModel<T> 
    where T: MyBase, new()
{ ... } 
```

我有一个特定的模型，其中 Foo 从 MyBase 继承：

```
public class MySpecificModel : MyModel<Foo>
{ ... } 
```

在我的 Razor 模板中，我想实例化 MySpecificModel 的一个实例：

```
@{
    var test = new MySpecificModel();
} 
```

如果 MyBase 继承自 System.Windows.DependencyObject（因为它恰好是我需要重用的 WPF ViewModel 类），我会在编译 Razor 模板时收到异常，说我缺少对 WindowsBase.dll 的引用，即使我的项目中有这个参考。我尝试将 @using System.Windows 添加到我的模板中，但 Razor 根本无法识别命名空间。

为了解决这个问题，我将代码更改如下：

```
public abstract class MyModel 
{
    protected abstract MyBase myBase { get; }
    ... 
}

public class MySpecificModel : MyModel
{
    private Foo _myBase;
    protected override MyBase myBase
    {
        get
        {
            if (_myBase == null)
                _myBase = new Foo();
            return _myBase;
        }
    }
    ... 
} 
```

在 MyModel 中，我必须将任何“new T()”更改为“myBase”才能访问 Foo 对象。这种方法非常有效，但对于 MySpecificModel 类来说工作量要大得多，我将为 MyBase 的不同子类提供许多变体。

那么，为什么第一种方法失败而第二种方法成功呢？这不仅仅是泛型的使用，因为如果 MyBase 不从 WindowsBase 类继承，那就没有问题。我认为这与构造 Foo 对象的位置有关，以及 Razor 正在做的事情以防止使用任何 WPF 类。但我找不到任何关于此的文档。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:42:54.607

ASP.NET 从*.aspx/* .ascx/ *.master/* .cshtml 文件生成一个新的匿名程序集，然后引用您的 Web 应用程序的程序集，生成的类存储在`ASP.`命名空间中。此程序集是在运行时向您的 Web 应用程序发出第一个请求时生成的。

这个新程序集仅额外引用了一些其他程序集（`System.Web.dll`等），而不是`System.Windows.xxx`您注意到的程序集。

因为 ASP.NET 正在生成一个基于公开类型的新程序集，`System.Windows`所以它需要直接引用该程序集，而它不会 - 而当它使用派生自 System.Windows 类型的类型的子类型时（即您的工作示例）它之所以有效，是因为它不直接与 System.Windows 交互。

# android - android上的Logcat问题

> ID：12486529
> 
> 赞同：2
> 
> 时间：2012-09-18T23:28:36.573
> 
> 标签：android, mobile, logging

我正在使用应用程序 AIDE 直接在我的设备上进行开发，而不使用 eclipse 或外部机器。

我的两台设备上出现了冲突的 logcat 输出，一台是 Galaxy Nexus，另一台是 Nexus 7。两者都在 Jellybean 上，都运行相同版本的 IDE 应用程序，并且都使用我正在编写的相同源代码。

在我的手机上，我看到了来自我的应用程序的所有日志命令，而在平板电脑上，一个也没有。

我还尝试构建 IDE 应用程序附带的测试 hello world 应用程序，然后向其中添加日志记录。同样，手机可以工作，平板电脑不能。

我有一个；所以检查了开发人员下设备上的设置，两者都具有相同的功能，包括 USB 调试。

最后，在应用程序本身中，我尝试在清单中同时使用 android:debuggable="true" 和没有它。它始终适用于他们的手机，而不是平板电脑。

更新

在对 jellybean 日志进行搜索后，不仅仅是 android 日志，看来 android/google 已经关闭了在 3rd 方应用程序上查看日志的功能。您现在只能查看系统日志或您正在使用的应用程序的日志，即您不能使用一个应用程序查看另一个应用程序的日志。

我仍然有点困惑，因为我的两个设备都在 jellybean 上，正如我所提到的，一个可以看到所有日志，另一个不能。然而....内核是不同的。平板是3.1，手机是3.0.31。

我相信日志更改必须发生在这些版本之间。

所以现在我想我将不得不root才能看到日志，或者只有在我手头有笔记本电脑时才进行调试，这并不常见。

现在，如果有人知道如何在不擦除数据的情况下扎根 Galaxy nexus 或 nexus 7……

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T10:43:14.363

Jelly Bean 不再允许新安装的应用程序在 LogCat 中查看任意消息。更具体地说，新安装的应用程序不再拥有该`READ_LOGS`权限。如果您在手机升级到 Jelly Bean 之前已在手机上安装了 AIDE，这将解释您所看到的症状。

但是，您无需 root 手机即可查看日志记录数据。记录到 LogCat 是一种便利机制。欢迎您使用标准的 Java 日志记录东西（例如，`java.util.logging`）在其他地方（例如，外部存储）进行日志记录，以便您可以查看您的日志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-28T22:21:56.917

有时，上述答案都不起作用。这就是我在笔记本电脑上使用 Nexus 7 和 Eclipse 来调试应用程序时发生的事情。尤其是当我开始调试与之前调试的应用程序不同的应用程序时，就会发生这种情况。我做了两件事最终让 logcat 消息出现在 eclipse 的 logcat 窗口中。

首先，在 Nexus 7 平板电脑的“开发者选项”下有一个名为“选择调试应用程序”的设置。我必须选择正在调试的特定应用程序（从它显示的应用程序列表中 - 之前已调试过一段时间）。

其次，我不得不杀死 adb 服务器并重新启动服务器。在这两个步骤之后，正在调试的新应用程序开始出现 logcat 消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-07T15:00:40.377

您可以像这样包装 android.utils.Log 以获得可扩展性：

```
public class Log {
    // Constants
    //--------------------------------------------------------------------------
    private static final String TAG = Log.class.getName();

    public static final int VERBOSE = android.util.Log.VERBOSE;
    public static final int DEBUG = android.util.Log.DEBUG;
    public static final int INFO = android.util.Log.INFO;
    public static final int WARN = android.util.Log.WARN;
    public static final int ERROR = android.util.Log.ERROR;
    public static final int ASSERT = android.util.Log.ASSERT;

    // Extension interface
    //--------------------------------------------------------------------------
    public interface LogExtension {
        void onLog(int priority, String tag, String msg, Throwable tr);
    }

    private static ConcurrentHashMap<String, LogExtension> logExtensions = new ConcurrentHashMap<String, LogExtension>();

    public static void addExtension(String tag, LogExtension extension) {
        if (tag != null && extension != null) {
            Log.logExtensions.put(tag, extension);
        }
    }

    public static void removeExtension(String tag) {
        Log.logExtensions.remove(tag);
    }

    // android.util.Log wrapper
    //--------------------------------------------------------------------------
    public static int d(String tag, String msg) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(DEBUG, tag, msg, null);
        }
        return android.util.Log.d(tag, msg);
    }

    public static int d(String tag, String msg, Throwable tr){
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(DEBUG, tag, msg, tr);
        }
        return android.util.Log.d(tag, msg, tr);
    }

    public static int e(String tag, String msg){
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(ERROR, tag, msg, null);
        }
        return android.util.Log.e(tag, msg);
    }

    public static int e(String tag, String msg, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(ERROR, tag, msg, tr);
        }
        return android.util.Log.e(tag, msg, tr);
    }

    public static String getStackTraceString(Throwable tr) {
        return android.util.Log.getStackTraceString(tr);
    }

    public static int i(String tag, String msg) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(INFO, tag, msg, null);
        }
        return android.util.Log.i(tag, msg);
    }

    public static int i(String tag, String msg, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(INFO, tag, msg, tr);
        }
        return android.util.Log.i(tag, msg, tr);
    }

    public static boolean isLoggable(String tag, int level) {
        return android.util.Log.isLoggable(tag, level);
    }

    public static int println(int priority, String tag, String msg) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(priority, tag, msg, null);
        }
        return android.util.Log.println(priority, tag, msg);
    }

    public static int v(String tag, String msg) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(VERBOSE, tag, msg, null);
        }
        return android.util.Log.v(tag, msg);
    }

    public static int v(String tag, String msg, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(VERBOSE, tag, msg, tr);
        }
        return android.util.Log.v(tag, msg, tr);
    }

    public static int w(String tag, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(WARN, tag, null, tr);
        }
        return android.util.Log.w(tag, tr);
    }

    public static int w(String tag, String msg, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(WARN, tag, msg, tr);
        }
        return android.util.Log.w(tag, msg, tr);
    }

    public static int w(String tag, String msg) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(WARN, tag, msg, null);
        }
        return android.util.Log.w(tag, msg);
    }

    public static int wtf(String tag, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(ASSERT, tag, null, tr);
        }
        return android.util.Log.wtf(tag, tr);
    }

    public static int wtf(String tag, String msg) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(ASSERT, tag, msg, null);
        }
        return android.util.Log.wtf(tag, msg);
    }

    public static int wtf(String tag, String msg, Throwable tr) {
        for (LogExtension extension : Log.logExtensions.values()) {
            extension.onLog(ASSERT, tag, msg, tr);
        }
        return android.util.Log.wtf(tag, msg, tr);
    }

    // Convenience
    //--------------------------------------------------------------------------
    public static String acronymForPriority(int priority) {
        switch (priority) {
            case VERBOSE: {
                return "V";
            }
            case DEBUG: {
                return "D";
            }
            case INFO: {
                return "I";
            }
            case WARN: {
                return "W";
            }
            case ERROR: {
                return "E";
            }
            case ASSERT: {
                return "WTF";
            }
            default: {
                return "?";
            }
        }
    }
} 
```

然后使用此 Wrapper 的完全限定名称查找/替换 android.util.Log。`LogExtension`您可以通过实现接口来简单地扩展 Logger ：

```
public class LogCatBuffer implements Log.LogExtension{
    // Attributes
    //--------------------------------------------------------------------------
    private int linesOfLog;
    private Queue<String> logCatContents;
    private DateFormat dateFormatter = new SimpleDateFormat("MM-dd HH:mm:ss.SSS");

    // Construction
    //--------------------------------------------------------------------------
    private LogCatBuffer(int linesOfLog) {
        this.linesOfLog = linesOfLog;
        this.logCatContents = new ConcurrentLinkedQueue<String>();
    }

    // LogExtension implementation
    //--------------------------------------------------------------------------
    @Override
    public void onLog(int priority, String tag, String msg, Throwable tr) {
        Date now = new Date();
        String loggingMessage = this.dateFormatter.format(now) +
                " " +
                android.os.Process.myPid() +
                " " +
                Log.acronymForPriority(priority) +
                "/" +
                tag +
                ": " +
                (msg != null ? msg : "") +
                (msg != null && tr != null ? "\n" : "") +
                (tr != null ? Log.getStackTraceString(tr) : "");
        this.logCatContents.add(loggingMessage);
        if (this.logCatContents.size() > this.linesOfLog) {
            this.logCatContents.poll();
        }
    }

    // Export
    //--------------------------------------------------------------------------
    @Override
    public String toString() {
        StringBuilder builder = new StringBuilder(256 * this.linesOfLog);
        for (String line : this.logCatContents) {
            builder.append(line).append("\n");
        }
        return builder.toString();
    }
} 
```

然后，您可以将`LogCatBuffer.toString()`输出转储到一个文本文件中，该文件看起来非常类似于您在 LogCat 控制台中使用的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-04-30T03:12:21.080

转到菜单->更多->项目->构建变体->选择调试助手

# android - 带有 unicode 字符的 EasyTracker (android) 事件标签

> ID：12486530
> 
> 赞同：1
> 
> 时间：2012-09-18T23:28:56.513
> 
> 标签：android, google-analytics, google-analytics-api

使用 EasyTracker 事件跟踪时，我看不到 unicode 字符的报告。例如，阿拉伯语字符串不显示。EasyTracker 是否支持 unicode 字符？

# php - 静态关键字使用php

> ID：12486533
> 
> 赞同：0
> 
> 时间：2012-09-18T23:29:18.383
> 
> 标签：php, static, static-methods

假设我有一个类似以下的课程：

```
class MyClass {
  public function __construct($str) {
    // do some stuff including:
    $str = self::getIP($str);
  }

  private static function getIP($str) {
    return (bool) ip2long($str) ? $str : gethostbyname($str);
  }

  // other NON static functions ....
} 
```

在上述情况下，getIP 静态与简单的优点/缺点是什么：

```
private function getIP($str) {
  return (bool) ip2long($str) ? $str : gethostbyname($str);
} 
```

并调用`$this->getIP();`构造函数（或任何其他方法）

上下文：我通常会在没有 static 关键字的情况下执行此操作，但最近我遇到过几次。只是想知道当您绝对不打算使用它时使用静态是否有任何优势。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:36:43.027

在这种特殊情况下，我不确定。通常我使用静态方法，因为：

*   它将数据存储在我希望从多个对象访问的静态变量中（有点像全局）
*   我不想每次调用该方法时都必须创建对象的实例——尤其是当它主要是从外部调用时。

例如，我通常会创建一个 App 对象，它有许多辅助方法。其中之一是`fetch_db`。每次我想连接到数据库时，我都会调用`App::fetch_db()`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:35:51.867

在这种特定情况下，没有优势或劣势。但是，静态方法可以被其他静态方法（可能是某些`public static`方法）使用。你确定它不是被另一个静态方法调用的吗？

`$this`从技术上讲，只要符合其接口，任何不依赖的方法都可以是静态的（例如，如果父方法依赖`$this`但子方法不依赖，则子方法不应该是静态的）。

# python - 在 Python 中，如何复制字典列表并过滤特定键，包括嵌套键？

> ID：12486535
> 
> 赞同：3
> 
> 时间：2012-09-18T23:29:18.007
> 
> 标签：python

如果我有一本包含列表、字典、字符串和整数的字典，我如何复制该字典，但只复制特定的白名单键？

通过这个功能过滤`old_dict`会给我`new_dict`. 白名单键可以是任何格式，但解决方案应该能够采用任意白名单键的对象来产生输出。

```
old_dict = [
    {
        'name': {'first': "John", 'last': "Doe"},
        'groups': ["foo", "bar"],
        'widgets': [
            {'id': 0, 'name': "Acme"},
            {'id': 1, 'name': "Anvil"},
        ],
    },

    {
        'name': {'first': "David"},
        'groups': ["bar", "bash", "ding"],
        'widgets': [
            {'id': 1, 'name': "Anvil"},
            {'id': 8, 'name': "Bingo"},
        ],
    },
]

new_dict = [
    {
        'name': {'last': "Doe"},
        'widgets': [
            {'name': "Acme"},
            {'name': "Anvil"},
        ],
    },

    {
        'name': { },
        'widgets': [
            {'name': "Anvil"},
            {'name': "Bingo"},
        ],
    },
] 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:45:17.237

制作一个递归函数来处理每种类型并在您看到字典时过滤掉：

```
def keep_only(keys, val):
    if type(val) is list:
        return [keep_only(keys, v) for v in val]
    if type(val) is dict:
        return dict((k, keep_only(keys, v)) for k,v in val.items() if k in keys)
    return val 
```

示例用法：

```
>>> old_dict = [
    {
        'name': {'first': "John", 'last': "Doe"},
        'groups': ["foo", "bar"],
        'widgets': [
            {'id': 0, 'name': "Acme"},
            {'id': 1, 'name': "Anvil"},
        ],
    },

    {
        'name': {'first': "David"},
        'groups': ["bar", "bash", "ding"],
        'widgets': [
            {'id': 1, 'name': "Anvil"},
            {'id': 8, 'name': "Bingo"},
        ],
    },
]
>>> keep_only(set(['name', 'widgets', 'last']), old_dict)
[{'widgets': [{'name': 'Acme'}, {'name': 'Anvil'}], 'name': {'last': 'Doe'}}, {'widgets': [{'name': 'Anvil'}, {'name': 'Bingo'}], 'name': {}}] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:41:45.847

```
new_dict = []
for dic in old_dic:
    new_dict.append({})
    for key in white_list: #list of keys
        if key in dic:
            new_dict[key] = old_dic[key] 
```

您可以将列表理解为：

```
new_dic = [ dict( key, old_dic[key])
                 for key in whitelist
                 if key in old_dic)
            for dic in old_dic ] 
```

# c# - 忽略字典键中的大小写

> ID：12486544
> 
> 赞同：9
> 
> 时间：2012-09-18T23:30:02.483
> 
> 标签：c#, .net, dictionary

如何忽略字典键中的大小写？我正在这样做：

```
var map = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase);
map.Add("e", "Letter e lower case");

string value = null;
if (!map.TryGetValue("E", out value)) {
    Console.WriteLine("Not found");
} 
```

而且我已经尝试过使用StringComparer.InvariantIgnoreCase，结果是一样的。它找不到大写字母“E”。

**编辑：** 即使使用 OrdinalIgnoreCase ，我是否会与我的环境设置存在某种文化冲突？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-12-27T17:22:09.840

StringComparer.OrdinalIgnoreCase 在 System.Globalization.TextInfo 中使用对 Window API“nativeCompareOrdinalIgnoreCase”函数的内部调用；所以它不是不变的文化。太糟糕了 mscorlib.dll 中的函数是内部的，我们无法测试它。

无论如何，您应该使用 StringComparer.InvariantCultureIgnoreCase 而不是前者。

如果它仍然拒绝工作，您可以重新实现 IEqualityComparer

```
public class StringComparerIgnoreCase : IEqualityComparer<string>
{
    public bool Equals(string x, string y)
    {
        if (x != null && y != null)
        {
            return x.ToLowerInvariant() == y.ToLowerInvariant();
        }
        return false;
    }

    public int GetHashCode(string obj)
    {
        return obj.GetHashCode();
    }
} 
```

用法：

```
var map = new Dictionary<string, string>(new StringComparerIgnoreCase()); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-20T21:02:48.573

我在我拥有的其他机器（4 个虚拟机和 1 个真实的）上对其进行了测试，发现只有在我当前的虚拟机（Win7 x64、us_eng、一些葡萄牙语设置、.net 4.5）中才会出现问题。在我的真实机器和其他虚拟机中，测试工作正常，使用 OrdinalIgnoreCase 以及 InvariantIgnoreCase。

所以，我猜那个环境中有一些很奇怪的东西，但我现在不能花时间去调查它。

不幸的是，这个问题被一些人标记为无用，这让我失去了深入研究它的兴趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T23:33:34.763

对于不区分大小写的字典键，您对 Dictionary 的声明是正确的。

您还可以使用`map.ContainsKey("E")`和`map["E"]`来搜索密钥并访问它。

# sqlite - 使用 DateTimeOffset 从 C# 填充的日期时间列上的 SQLite 排序顺序

> ID：12486545
> 
> 赞同：3
> 
> 时间：2012-09-18T23:30:22.380
> 
> 标签：sqlite, microsoft-metro

我正在开发一个使用 SQLite 作为其本地数据库的 Windows 8 Metro 应用程序。

数据库中的一张表包含一个日期时间列。在运行按 datetime 列对结果集进行排序的查询时，我看到了意外的结果——结果集的排序与您期望的不同。

datetime 列填充了 Metro 应用程序在 C# 中生成的数据；例如作为`DateTimeOffset.Now`。WinRT 不支持`DateTime`，所以我们使用`DateTimeOffset`.

您可以在一个简单的表中复制它：

```
CREATE TABLE "Foo" ("DateOfFoo" DATETIME) 
```

这是一些基于我们应用程序数据的示例数据（请注意，我在 PDT 时区，即 UTC -7）：

```
INSERT INTO "main"."Foo" ("DateOfFoo") VALUES (?1)
Parameters:
param 1 (text): 9/18/2012 8:08:56 AM -07:00

INSERT INTO "main"."Foo" ("DateOfFoo") VALUES (?1)
Parameters:
param 1 (text): 9/18/2012 8:13:42 AM -07:00

INSERT INTO "main"."Foo" ("DateOfFoo") VALUES (?1)
Parameters:
param 1 (text): 9/18/2012 12:46:36 PM -07:00 
```

一个简单的查询，例如：

```
Select * From Foo Order By DateOfFoo 
```

返回以下结果集：

```
9/18/2012 12:46:36 PM -07:00
9/18/2012 8:08:56 AM -07:00
9/18/2012 8:13:42 AM -07:00 
```

当我期望：

```
9/18/2012 8:08:56 AM -07:00
9/18/2012 8:13:42 AM -07:00
9/18/2012 12:46:36 PM -07:00 
```

并`Select * From Foo Order By DateOfFoo DESC`返回：

```
9/18/2012 8:13:42 AM -07:00
9/18/2012 8:08:56 AM -07:00
9/18/2012 12:46:36 PM -07:00 
```

当我期望：

```
9/18/2012 12:46:36 PM -07:00
9/18/2012 8:13:42 AM -07:00
9/18/2012 8:08:56 AM -07:00 
```

我在 CDT 时区的同事无法复制该问题。我将机器上的时区更改为 CDT 并填充了应用程序数据，果然查询对结果集进行了正确排序：

```
9/18/2012 2:46:36 PM -05:00
9/18/2012 10:13:42 AM -05:00
9/18/2012 10:08:56 AM -05:00 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-25T18:17:25.143

SQLite 不支持实际的日期/时间数据类型。日期和时间作为字符串插入数据库，因此在`SELECT`语句中按字母顺序排序。SQLite 确实支持一些日期和时间函数，但要求字符串是格式列表中的一种，而您使用的格式不匹配。有关正确的格式，请参阅[SQLite 文档](http://www.sqlite.org/lang_datefunc.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-11-27T05:35:26.337

`SQLite`将日期/时间存储为字符串。`orderby`假设使用可以与自定义一起使用的标准格式将值输入到您的日期/时间字段中`IComparer<string>`：

```
public class SqliteDateComparer : IComparer<string> {
  public int Compare(string s1, string s2) => DateTime.Compare(DateTime.Parse(s1), DateTime.Parse(s2));
} 
```

然后即：

```
var res = (new MyDbContext()).MyData.OrderBy(v => v.TimeField, new SqliteDateComparer()); 
```

# android - 使用音乐播放器和 AudioManager.requestAudioFocus 混合音频

> ID：12486548
> 
> 赞同：1
> 
> 时间：2012-09-18T23:30:58.350
> 
> 标签：android, android-audiomanager

是否可以将我的应用程序的音频与音乐播放器的音频混合？

我发现默认情况下，android 确实将音乐播放器的音频与我的应用程序混合在一起。但是，这在调用 AudioManager.requestAudioFocus 方法后停止工作。意思是，如果音乐播放器正在播放，当我的应用程序开始播放时，它会停止音乐播放器。我希望他们同时玩。

我请求音频焦点，这样我就可以知道何时发生了其他中断，例如电话呼叫。我确实想在来电时停止我的应用程序的音频。

我的音频播放正弦波，它是一种医疗设备。我使用 AudioManager.STREAM_MUSIC 和 AudioManager.AUDIOFOCUS_GAIN 请求音频焦点。我正在使用 AudioTrack 播放它们。

# ios - 归档 iPhone 应用程序时出现奇怪的错误

> ID：12486549
> 
> 赞同：1
> 
> 时间：2012-09-18T23:31:00.207
> 
> 标签：ios, archive, armv6

因此，我正在尝试将我的 iPhone 应用程序存档以进行临时测试，但我遇到了一些奇怪的情况。当我归档它时，在它显示归档类型的顶部，由于某种原因，它显示“Mac 应用程序归档”而不是通常的“iOS 应用程序归档”

我不知道为什么会这样，因为这不是一个 mac 应用程序。

当我归档可能有帮助的应用程序时，我会收到以下三个警告，但我不确定。

第一个是这个

```
iPhone/iPod Touch: application executable is missing a required architecture.  
At least     one of the following architecture(s) must be present: armv6 (-19033) 
```

我不确定为什么会发生这种情况，因为我在有效架构中列出了 armv6 和 armv7

我得到的第二个警告是这个

```
The CodeResources file is missing and it must be a symbolic link to
_CodeSignature/CodeResources.  Make certain that the bundle is on a locally-mounted volume
(not a remote SMB volume), and be certain to use the Mac OS X Finder to compress it  
(-19062) 
```

同样，不确定为什么会发生这种情况，甚至不知道这意味着什么。

最后一个错误是这个

```
Warning: The Copy Bundle Resources build phase contains this target's Info.plist file 'Catch It/Resources/Info.plist'. 
```

我真的迷路了，我不知道它想告诉我什么。

请帮助我，因为我无法分发这个 ipa，因为它认为它是一个 mac 应用程序。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-29T18:49:58.897

我猜你使用的是 Xcode 4.5。

我刚刚遇到了同样的问题，并设法解决了这个问题。我的应用程序现在正在等待审核。

这就是我所做的更改：在目标中，我选择了“构建阶段”，然后在“复制捆绑资源”中删除了 plist 文件。

如果这不能解决您的问题，请确保您将 iOS 部署目标至少设置为 iOS 4.3。

编辑：我还从两者`Architectures`和`Valid Archictectures`构建设置中删除了 armv6。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-24T08:10:22.027

我在 Xcode 4.6.3 上收到消息

```
The CodeResources file is missing and it must be a symbolic link to
_CodeSignature/CodeResources.  Make certain that the bundle is on a locally-mounted volume
(not a remote SMB volume), and be certain to use the Mac OS X Finder to compress it  
(-19062) 
```

当尝试构建应用程序时，在模拟器上运行它之后。将目标更改为 iOSDevise 可解决此问题。

# c# - 在启动时动态决定 Winforms 还是 Wpf？

> ID：12486551
> 
> 赞同：2
> 
> 时间：2012-09-18T23:31:36.130
> 
> 标签：c#, .net, wpf, windows, winforms

我有一个用例，有一个 exe 可以在启动时决定它是*仅*托管WPF 应用程序代码还是*仅*托管WinForms 代码。一旦做出决定，exe 将简单地加载一个 dll（用于 WinForms）或不同的 dll（用于 WPF）。

我希望 exe 具有尽可能少的代码（和引用），并将大部分（如果不是全部）应用程序逻辑放在一组 dll 中。这就是我的想法：

```
MyApp.exe                <- The exe shim.
MyApp.Core.dll           <- Things and Stuff.
MyApp.Windows.Forms.dll  <- The WinForms dll.
MyApp.Windows.dll        <- The WPF dll. 
```

*MyApp.exe 将仅引用 WinForms和*WPF通用的 .NET 框架程序集。（所以，`System, System.Core, System.Data, System.Xml, etc`）然后它只会动态加载对 MyApp.Windows.dll 或 MyApp.Windows.dll 的引用，这将完成其余的工作。

我的问题是：

*   什么可能出错？
*   我找不到任何例子。你能？
*   仅仅为了避免拥有 2 个独立的 exe 就值得麻烦吗？

（基本上，对于最终用户（他们是开发人员）来说，单个 exe 将非常*性感*和简单，但这并不是*完全*必要的。因此，如果这个想法是方式，远离人迹罕至的道路，并可能导致不寻常的问题，我不会想做。）

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-18T23:34:25.697

在您决定组装时，只需调用[Process.Start()](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx)并运行适当的应用程序。不要混合开发的东西。

# objective-c - 如何在 Firebreath NPAPI 插件中将 NSMenu 连接到 NSStatusItem，以便在单击状态栏项时出现菜单？

> ID：12486553
> 
> 赞同：1
> 
> 时间：2012-09-18T23:32:00.577
> 
> 标签：objective-c, macos, xib, npapi, firebreath

作为 NPAPI Chrome 浏览器插件的一部分，我正在努力获取一个带有菜单的状态图标，以显示在 Mac OS 状态栏中。

Firebreath 使用 C++，而大多数用于 Mac OS 开发的库都使用 Objective C。感谢对[这个问题](https://stackoverflow.com/q/12325559/552792)的回答，我克服了这个障碍。我还必须调整我的 CMake 设置才能将 XIB 文件编译为 NIB。

经过反复试验，我能够让状态栏选项出现在状态栏中，但是当我单击它时，菜单不会展开。我不确定我需要做什么才能显示菜单。它适用于 Cocoa 应用程序，但不适用于 Firebreath 应用程序。

我也导入了 Foundation 和 Cocoa 库。

我怀疑问题出在我的 MainMenu.xib 文件或 AppDelegate.m 中。

**AppDelegate.m:**

```
#import "AppDelegate.h"   

@implementation AppDelegate

-(void)awakeFromNib {
    NSLog(@"calling awakeFromNib...");

    NSStatusBar *bar = [NSStatusBar systemStatusBar];
    statusItem = [[bar statusItemWithLength:NSVariableStatusItemLength ] retain];

   // statusItem = [[NSStatusBar systemStatusBar] statusItemWithLength:NSVariableStatusItemLength];
    //[statusItem retain];
    NSMenuItem *menuItem;

    menuItem = [[[NSMenuItem alloc] initWithTitle:@"Test" action:NULL keyEquivalent:@""] retain];
//    [menuItem setView: myView];
    statusMenu = [statusMenu initWithTitle:@"WTF"];
    [statusMenu addItem:menuItem];

    [menuItem retain];
    [statusItem setTitle: NSLocalizedString(@"StatusMenu",@"")];
    [statusItem setHighlightMode:YES];
    [statusItem setMenu:statusMenu];
    [statusItem setEnabled:YES];

    [statusMenu retain];

    // this was needed to get the icon to display
    [statusItem retain];
    //[window retain];
}

- (IBAction)settings:(id)sender {
    NSLog(@"Invoking the settings from the menu...");

}

//@synthesize window;
@end 
```

该文件是从示例应用程序中获取的，并且正在从 Objective C++ 包装类手动调用 awakeFromNib。根据日志，以及我在状态栏中看到“StatusMenu”的事实，我知道正在调用此函数。

我还包括 MainMenu.xib 的屏幕截图：

**主菜单.xib：**

![主菜单.xib](../Images/f410dcaab024ba51bf65f5266b585909.png)

我尝试的最后一件事是将 NSStatusItem 添加为 IBOutlet 以查看是否可以将其连接到 xib 文件中的某些内容，但我不确定这是正确的方向。

单击“状态菜单”选项时需要做什么才能显示菜单？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-10-19T02:20:19.863

这里的问题是 Firebreath 项目和 NPAPI 插件架构不支持自动引用计数（ARC），通常在 XCode 项目中默认开启。

此外，由于将 Objective C 与 C++ 混合的疯狂，XCode 并不能像纯粹用 Objective C 编写代码那样容易地报告错误。因此，错误消息被抑制了。为了避免错误，使用 NPAPI 插件架构的开发人员必须通过在 NSMenu 对象上调用 alloc 来显式管理内存。

只要对这些对象调用 alloc，它们就会被正确保留。这解决了问题。

# python - 在 Django 中生成唯一的 slug

> ID：12486557
> 
> 赞同：4
> 
> 时间：2012-09-18T23:32:15.433
> 
> 标签：python, django, unique, slug, modelform

我见过各种不同的方法来生成独特的 slug：[例如。1](https://code.djangoproject.com/wiki/SlugifyUniquely)，[例](http://djangosnippets.org/snippets/512/)2 ，[例。3](https://stackoverflow.com/questions/3816307/how-to-create-a-unique-slug-in-django)，[例如。4](https://stackoverflow.com/questions/11978035/django-unique-slug-by-id)等等等等

我想在保存 ModelForm 时创建独特的 slug。如果我的模型是这样的：

```
class Phone(models.Model):
    user = models.ForeignKey(User)
    slug = models.SlugField(max_length=70, unique=True)
    year = models.IntegerField()
    model = models.ForeignKey('Model')
    series = models.ForeignKey('Series') 
```

假设该`Phone`对象具有以下值（通过提交的 ModelForm）：

```
Phone.user = dude
Phone.year = 2008
Phone.model = iphone
Phone.series = 4S 
```

我希望这个对象的 url 看起来像：

```
http://www.mysite.com/phones/dude-2008-iphone-4S 
```

我知道我应该`slugify`通过信号或覆盖保存方法来实现这一点。但是如果用户`dude`创建了第二个 2008 iphone 4S 对象，那么为这个对象创建一个独特的 slug 的最佳方法是什么？我希望其他对象的 url 看起来像：

```
http://www.mysite.com/phones/dude-2008-iphone-4S-2 
```

和

```
http://www.mysite.com/phones/dude-2008-iphone-4S-3
http://www.mysite.com/phones/dude-2008-iphone-4S-4
#...etc ... 
```

谷歌搜索后，似乎有多种不同的方法可以在 django 中创建 slug，这在试图找出最佳实践时一直令人困惑。

非常感谢您对此问题的任何建议和澄清！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:02:48.943

首先，将字段命名为“模型”是一个坏主意，它只会造成混乱。寻找替代方案将是一个好主意。

最简单的解决方案是在[pre_save](https://docs.djangoproject.com/en/dev/ref/signals/#pre-save)信号中设置 slug：

```
from django.db.models.signals import pre_save
from django.template.defaultfilters import slugify

def phone_slug(sender, instance, **kwargs):
    slug = u'%s-%s-%s-%s' % (slugify(instance.user.username), instance.year,
        slugify(instance.model), slugify(instance.series))
    instance.slug = slug

    if instance.pk:
        other_phones = Phone.objects.exclude(pk=instance.pk)
    else:
        other_phones = Phone.objects.all()

    i = 2
    exists = other_phones.filter(slug=instance.slug).count() > 0
    while exists:
        instance.slug = u'%s-%s' % (slug, i)
        i++
pre_save.connect(phone_slug, sender=Phone) 
```

或者也许使用[django-autoslug](https://bitbucket.org/neithere/django-autoslug)，它看起来像这样：

```
slug = AutoSlugField(unique_with=['user__username', 'year', 'model__name', 'series__name']) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-17T02:51:31.093

我最终使用[This Django Snippet](http://djangosnippets.org/snippets/690/)在我的 models.py 中覆盖了 Phone 的保存方法：

```
def save(self, **kwargs):
    slug_str = "%s %s %s %s" % (self.user, self.year, self.model, self.series)
    unique_slugify(self, slug_str)
    super(Phone, self).save() 
```

但是感谢 jpic 的贡献。

# ruby-on-rails-3 - 如何模拟登录以进行控制器测试？

> ID：12486560
> 
> 赞同：1
> 
> 时间：2012-09-18T23:32:50.740
> 
> 标签：ruby-on-rails-3, rspec, controller

我有一个 SearchesController 需要用户登录才能执行它的操作。

我想编写一个 rspec 辅助函数`login`来模拟控制器测试的登录。（注意：我将分别处理集成/请求规范。）我的尝试没有奏效：`logged_in?`ApplicationController 中的方法返回 false。

问题：如何编写“登录”助手？

这是 RSpec 控制器测试：

```
# file: spec/controllers/searches_controller_spec.rb
require 'spec_helper'
require 'controllers_helper'
describe SearchesController do
  include ControllersHelper

  describe "GET index" do

    it 'without login renders login page' do
      get :index
      response.should redirect_to(login_path)
    end

    it 'with login finds searches belonging to user' do
      me = FactoryGirl.create(:user)
      my_searches = FactoryGirl.create_list(:search, 2, :user => me)
      not_me = FactoryGirl.create(:user)
      not_my_searches = FactoryGirl.create_list(:search, 2, :user => not_me)

      login(me)  # want to define this in spec/controllers_helper.rb
      get :index
      assigns(:searches).should =~ my_searches
    end
  end
end 
```

这是控制器：

```
# file: app/controllers/searches_controller.rb
class SearchesController < ApplicationController

  def index
    unless logged_in?
      redirect_to login_path, :alert => "You must be logged in to access this page."
    else
      @searches = Search.where(:user_id => current_user.id)
      respond_to do |format|
        format.html
        format.json { render json: @searches }
      end
    end
  end

end 
```

这是 ApplicationController 代码。请注意，它`current_user = x`具有登录 x 的效果，而且相当简单：它设置 @current_user 和 session[:user_id]。

```
# file: app/controllers/application_controller.rb
class ApplicationController < ActionController::Base
  protect_from_forgery
  force_ssl

  protected

  def current_user
    @current_user ||= User.find_by_id(session[:user_id])
  end

  def current_user=(user)
    @current_user = user
    session[:user_id] = user && user.id
  end

  def logged_in?
    !!@current_user
  end

  def require_login
    unless logged_in?
      redirect_to login_path, :alert => "You must be logged in to access this page."
    end
  end

  helper_method :current_user, :logged_in?, :require_login
end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:30:08.193

*我之前可能说过，但如果 Stack Overflow 给徽章回答自己的问题，我就会有很多徽章！:)*

好的，要回答这个问题，您需要查看[ActionController::TestCase 的文档](http://api.rubyonrails.org/classes/ActionController/TestCase.html)。当您这样做时，您会发现它为以下内容设置了绑定：

```
@controller
@request
@response 
```

所以对于 OP 中给出的具体控制器，编写`login`方法很简单：

```
# file: spec/controllers_helper.rb
module ControllersHelper
  def login(user)
    @controller.send(:current_user=, user)
  end
end 
```

（我是不是又听到有人说 RTFM 了？我是这么想的……）

# batch-file - 如何使用批处理脚本监视日志文件的文件大小更改？

> ID：12486564
> 
> 赞同：0
> 
> 时间：2012-09-18T23:33:11.737
> 
> 标签：batch-file, cmd, monitor

我试图找出一种通过任务调度程序启动的脚本来监视日志文件的方法。

所以理想情况下，我想要发生的是让脚本检查文件大小，将其与脚本上次运行的文件大小进行比较，如果大小已更改，则将条目写入事件查看器并更新 oldfilesize.txt文件。这将每天重复。

到目前为止，我想出的是：

```
dir logfile.txt > C:\filesize.txt
//this should give me the filesize and save the result into filesize.txt
COMP oldfilesize filesize.txt
//This should compare the old file created with the new. 
```

在这些命令之后是我迷路的地方。如何获取`COMP`命令的结果并确定是否应将新结果保存到 oldfilesize.txt 并将事件写入事件查看器？

我猜我会用它`eventcreate`来触发事件创建，但我不确定我会如何做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T07:07:47.750

我不会将此基于 的输出`dir`，因为如果输出中的*任何内容*发生变化（大小、日期、可用磁盘空间......），`comp`将报告差异。尝试这样的事情：

 *```
@echo off

setlocal EnableDelayedExpansion

set datastore=C:\filesize.txt
set logfile=C:\logfile.txt

if exist %datastore% (
  for /f %%f in ('%datastore%') do set old_size=%%~f
) else (
  set old_size=0
)

for %%f in (%logfile%) do set new_size=%%~zf

if %new_size% neq %old_size% (
  echo %new_size% > %datastore%
  rem do other stuff
)

endlocal 
```*

# ruby - 如何分析数组中序列中数字的最大百分比增益（突发）？

> ID：12486567
> 
> 赞同：0
> 
> 时间：2012-09-18T23:33:23.357
> 
> 标签：ruby, arrays, algorithm, currency, stocks

有一些算法可以检测数组中的最大子数组（连续的和非连续的）。不过，它们中的大多数都是基于负数和正数。仅使用正数如何完成？

我在一个连续的时间范围内有一组股票的值（比如说，该数组包含所有连续月份的值）。

`[15.42, 16.42, 17.36, 16.22, 14.72, 13.95, 14.73, 13.76, 12.88, 13.51, 12.67, 11.11, 10.04, 10.38, 10.14, 7.72, 7.46, 9.41, 11.39, 9.7, 12.67, 18.42, 18.44, 18.03, 17.48, 19.6, 19.57, 18.48, 17.36, 18.03, 18.1, 19.07, 21.02, 20.77, 19.92, 18.71, 20.29, 22.36, 22.38, 22.39, 22.94, 23.5, 21.66, 22.06, 21.07, 19.86, 19.49, 18.79, 18.16, 17.24, 17.74, 18.41, 17.56, 17.24, 16.04, 16.05, 15.4, 15.77, 15.68, 16.29, 15.23, 14.51, 14.05, 13.28, 13.49, 13.12, 14.33, 13.67, 13.13, 12.45, 12.48, 11.58, 11.52, 11.2, 10.46, 12.24, 11.62, 11.43, 10.96, 10.63, 10.19, 10.03, 9.7, 9.64, 9.16, 8.96, 8.49, 8.16, 8.0, 7.86, 8.08, 8.02, 7.67, 8.07, 8.37, 8.35, 8.82, 8.58, 8.47, 8.42, 7.92, 7.77, 7.79, 7.6, 7.18, 7.44, 7.74, 7.47, 7.63, 7.21, 7.06, 6.9, 6.84, 6.96, 6.93, 6.49, 6.38, 6.69, 6.49, 6.76]`

我需要一种算法来为每个元素确定它具有最大百分比增益的单个时间段。这可能是 1 个月的时间段、几个月的某个跨度或整个阵列（例如，120 个月），具体取决于库存。然后，我想以百分比增益以及回报（价格相对于原始价格的变化；因此该期间的峰值价格与起始价格）来输出爆发。

我结合了最大子数组类型算法，但意识到这个问题有点不同；该数组没有负数，因此这些算法仅将整个数组报告为周期，并将所有元素的总和报告为增益。

我提到的算法位于[此处](https://stackoverflow.com/questions/3733251/find-the-subsequence-with-largest-sum-of-elements-in-an-array/3733481#3733481)和[此处](https://stackoverflow.com/questions/7086464/interview-question-maximum-single-sell-profit?lq=1)，后者基于[主定理](http://en.wikipedia.org/wiki/Master_theorem)。希望这可以帮助。

我正在用 Ruby 编写代码，但也欢迎使用伪代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:08:49.767

我认为你走错了路……
我不熟悉 ruby​​，但让我们用你自己的话用伪代码构建算法：

> 我有一个数组，其中包含某个时间范围内的股票值（假设对于这个示例，每个元素都是一个月内的股票值；该数组包含所有连续月份的值）。

我们将这个数组命名为`StockValues`，它的长度由 给出`length(StockValues)`，假设它是基于 1 的（第一项是用 检索的`StockValues[1]`）

> 我需要一种算法来分析数组，并为每个元素确定价格涨幅最大的单个时间段。

您想知道对于给定索引，我们`i`在哪个索引处获得最大百分比增益，即何时最大。`j``j>i``gain=100*StockValues[j]/StockValues[i]-100`

> 然后，我想以百分比增益以及回报（价格相对于原始价格的变化；因此该期间的峰值价格与起始价格）来输出爆发。

您要检索这两个值`burst=gain=100*StockValues[j]/StockValues[i]-100`，`return=StockValues[j]-StickValues[i]`
第一步是遍历数组，并为每个元素执行第二次循环以查找增益何时最大，当我们找到最大值时，我们将您想要的值保存在另一个名为 Result 的数组中（让我们假设这个数组是用无效值初始化的，比如burst=-1，这意味着在任何时期都找不到增益）

```
for i=1 to length(StockValues)-1 do
  max_gain=0
  for j=i+1 to length(StockValues) do
    gain=100*StockValues[j]/StockValues[i]-100
    if gain>max_gain then
      gain=max_gain
      Result[i].burst=gain
      Result[i].return=StockValues[j]-StockValues[i]
      Result[i].start=i
      Result[i].end=j
      Result[i].period_length=j-i+1
      Result[i].start_price=StockValues[i]
      Result[i].end_price=StockValues[j]
    end if
  end for
end for 
```

请注意，此算法给出了最小的周期，如果您替换为最长的周期，则在多个周期具有相同增益值的情况下，您将获得最长的周期`gain>max_gain`。`gain>=max_gain`仅列出正增益或空增益，如果根本没有增益，则结果将包含无效值。仅列出 period>1，如果接受 1 的周期，则可能的最差增益为 0%，您必须修改循环`i`转到`length(StockValues)`并`j`开始于`i`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:09:46.617

这听起来不像是几天的工作：p 除非我错过了什么。

```
# returns array of percentage gain per period
def percentage_gain(array)
  initial = array[0]
  after = 0
  percentage_gain = []
  1.upto(array.size-1).each do |i|
    after = array[i]
    percentage_gain << (after - initial)/initial*100
    initial = after
  end
  percentage_gain
end

# returns array of amount gain $ per period
def amount_gain(array)
  initial = array[0]
  after = 0
  amount_gain = []
  1.upto(array.size-1).each do |i|
    after = array[i]
    percentage_gain << (after - initial)
    initial = after
  end
  amount_gain
end

# returns the maximum amount gain found in the array
def max_amount_gain(array)
  amount_gain(array).max
end

# returns the maximum percentage gain found in the array
def max_percentage_gain(array)
  percentage_gain(array).max
end

# returns the maximum potential gain you could've made by shortselling constantly.
# i am basically adding up the amount gained when you would've hit profit.
# on days the stock loses value, i don't add them.
def max_potential_amount_gain(array)
  initial = array[0]
  after = 0
  max_potential_gain = 0
  1.upto(array.size-1).each do |i|
    after = array[i]
    if after - initial > 0
      max_potential_gain += after - initial
    end
    initial = after
  end
  amount_gain
end

array = [15.42, 16.42, 17.36, 16.22, 14.72, 13.95, 14.73, 13.76, 12.88, 13.51, 12.67, 11.11, 10.04, 10.38, 10.14, 7.72, 7.46, 9.41, 11.39, 9.7, 12.67, 18.42, 18.44, 18.03, 17.48, 19.6, 19.57, 18.48, 17.36, 18.03, 18.1, 19.07, 21.02, 20.77, 19.92, 18.71, 20.29, 22.36, 22.38, 22.39, 22.94, 23.5, 21.66, 22.06, 21.07, 19.86, 19.49, 18.79, 18.16, 17.24, 17.74, 18.41, 17.56, 17.24, 16.04, 16.05, 15.4, 15.77, 15.68, 16.29, 15.23, 14.51, 14.05, 13.28, 13.49, 13.12, 14.33, 13.67, 13.13, 12.45, 12.48, 11.58, 11.52, 11.2, 10.46, 12.24, 11.62, 11.43, 10.96, 10.63, 10.19, 10.03, 9.7, 9.64, 9.16, 8.96, 8.49, 8.16, 8.0, 7.86, 8.08, 8.02, 7.67, 8.07, 8.37, 8.35, 8.82, 8.58, 8.47, 8.42, 7.92, 7.77, 7.79, 7.6, 7.18, 7.44, 7.74, 7.47, 7.63, 7.21, 7.06, 6.9, 6.84, 6.96, 6.93, 6.49, 6.38, 6.69, 6.49, 6.76] 
```

# c# - C# 原子性：在 x64 平台上分配 int 与 long

> ID：12486572
> 
> 赞同：6
> 
> 时间：2012-09-18T23:33:44.603
> 
> 标签：c#, .net, multithreading, pointers, thread-safety

我正在查看[http://msdn.microsoft.com/en-us/library/aa691278(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa691278(VS.71).aspx)，它说 int 的读写是原子的，而 long 的读写可能不是。对于 64 位平台真的是这样吗？是不是 IntPtr.Size == 64 位或长？我是否遗漏了什么或语言规格不够完整？

这里还有更多想法：http: [//philosopherdeveloper.wordpress.com/2011/02/08/beware-assignment-atomic-assignment/](http://philosopherdeveloper.wordpress.com/2011/02/08/beware-assignment-atomic-assignment/)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-09-18T23:35:45.447

`long`是在具有 64 位字的 CPU 和平台上**进行**的原子写入。例如，如果您在 64 位计算机上运行 32 位 .NET 应用程序，写入`long`将*不是*原子的。

请注意，如果您不能确保编译器不会优化对该类型变量的访问，那么原子性几乎毫无意义。例如，你不能`long`用`volatile`.

> 仅在 64 位运行时环境中保证对 64 位字段的操作是原子的

[http://www.albahari.com/threading/part4.aspx](http://www.albahari.com/threading/part4.aspx)

> 如果您在 64 位版本的 CLR 中在 64 位操作系统上运行 C# 代码，那么 64 位双精度和长整数的读写也保证是原子的

[http://blogs.msdn.com/b/ericlippert/archive/2011/05/31/atomicity-volatility-and-immutability-are-different-part-two.aspx](http://blogs.msdn.com/b/ericlippert/archive/2011/05/31/atomicity-volatility-and-immutability-are-different-part-two.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:37:07.633

那是对应于 .NET Framework 1.1 的 VS2003 的文档，它仅提供 32 位版本（暂时忽略非常利基的 IA-64 版本）。

.NET Framework 2.0 引入了 x64 版本，其中（只要您在 64 位模式下运行）那么某些（但不是全部）Int64 操作将是原子的。

当然，如果你想确定，使用`Interlocked`类。

# database - 如何在 Wordpress 中编写高级 query_posts 参数

> ID：12486581
> 
> 赞同：0
> 
> 时间：2012-09-18T23:35:38.163
> 
> 标签：database, wordpress, arguments, posts

在此先感谢您的帮助。我正在尝试为 Wordpress 编写 query_posts 语句，其中：

```
$args = 'meta_query' => array (
    array (
        array ('key' => 'key-type-1',
               'value' => 'something'
              ),
        array ('key' => 'key-type-2',
               'value' => 'something'
              )
    )
    OR
    array (
        array ('key' => 'key-type-3',
               'value' => 'something'
              ),
        array ('key' => 'key-type-4',
               'value' => 'something'
              )
    )
);
query_posts( $args ); 
```

如您所见，我的理解存在一个漏洞:) 我正在尝试编写一个场景，其中任何一个都可能是真的：key-type-1 和 key-type-2 的值存在，或者值对于 key-type-3 AND key-type-4 存在。

我已经尝试了明显的：

```
$args = 'meta_query' => array (
    array (
        array ('key' => 'key-type-1',
               'value' => 'something'
              ),
        array ('key' => 'key-type-2',
               'value' => 'something'
              )
    ),
    array (
        array ('key' => 'key-type-3',
               'value' => 'something'
              ),
        array ('key' => 'key-type-4',
               'value' => 'something'
              )
    )
);
query_posts( $args ); 
```

但这只会产生： key-type-1 AND key-type-2 的值存在并且 key-type-3 AND key-type-4 的值存在......这不好。

也许每个子数组中都有一个“比较”值？或者，也许我不得不求助于使用多个 query_posts 并结合显示的多个输出？如果有人有任何见解，那真的会帮助我。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:26:53.347

首先，除非您打算修改默认的 Wordpress 循环，否则不要使用 query_posts。它修改各种Globals，很乱，而且很慢。请考虑将您的所有 query_posts 调用更改为[WP Query](http://codex.wordpress.org/Class_Reference/WP_Query)。

关于[query_posts 与 WP_Query](https://wordpress.stackexchange.com/questions/1753/when-should-you-use-wp-query-vs-query-posts-vs-get-posts)的辩论有相当多的文档，并且几乎所有人都得出结论 WP_Query 是要走的路。

至于你想做什么，有几种方法可以做到这一点。想到一个标准的 SQL 调用，但老实说，构建 SQL 可能比它的价值更麻烦。相反，运行两个单独的查询以包含来自两个元查询的帖子可能会更容易。

这在很大程度上未经测试，我不能保证它会直接工作，但这应该让你开始：

```
<?php
$meta_a = array(
    'meta_query' => array(
        array ('key' => 'key-type-1',
               'value' => 'something'
        ),
        array ('key' => 'key-type-2',
               'value' => 'something'
        )
    )
);
$meta_b = array(
    'meta_query' => array(
        array ('key' => 'key-type-3',
               'value' => 'something'
        ),
        array ('key' => 'key-type-4',
               'value' => 'something'
        )
    )
);
$multi_query = array();
$multi_query[] = new WP_Query($meta_a);
$multi_query[] = new WP_Query($meta_b);
foreach($multi_query as $q)
{
    if($q->have_posts()) : while($q->have_posts()) : $q->the_post();
        //YOUR POSTS HERE
    endwhile;endif;
    wp_reset_postdata();
}
?> 
```

**更新：**

如果您*绝对必须*使用 query_posts()，您可以通过以下方式实现它：

```
<?php
$meta = array(
    array(
        array ('key' => 'key-type-1',
               'value' => 'something'
              ),
        array ('key' => 'key-type-2',
               'value' => 'something'
              )
    ),
    array (
        array ('key' => 'key-type-3',
               'value' => 'something'
              ),
        array ('key' => 'key-type-4',
               'value' => 'something'
              )
    )
);
foreach($meta as $args)
{
    query_posts(array('meta_query'=>$args));
    if(have_posts()) : while(have_posts()) : the_post();
        //YOUR POSTS HERE
    endwhile;endif;
    wp_reset_query();
}
?> 
```

# php - MySQL 表查找一致性哈希改进

> ID：12486587
> 
> 赞同：1
> 
> 时间：2012-09-18T23:35:57.537
> 
> 标签：php, mysql, sharding, consistent-hashing

几年来，我一直在使用以下代码来处理对我们数据库表的查找。我们目前在 6 个主机上分片我们的表。查找代码为：

```
$db_servers = Array(
    'db-1','db-2','db-3'
    //you get the idea
);
$full_table = 'mydatabase.mytable'; //just an example...obviously
$hash = sprintf('%u', crc32($full_table));
$host = $db_servers[($hash % $db_server_count)]; 
```

这种“算法”具有快速且非常随机的优点。但是，每当我向集群添加一个新节点时，重新平衡需要相当长的时间，因为似乎有不必要的表必须移动到不同的主机上。这不是一个大问题，因为我能够构建重新平衡脚本，因此在重新平衡发生时没有停机时间。相反，在它完成之前只有很小的性能损失。

我的问题是，是否还有其他算法可以在添加新主机时完成这种形式的一致散列而不需要大量的重新平衡？我正在继续研究这个主题，但我认为 Stack Overflow 会有一些聪明的解决方案，人们已经看到这些解决方案在生产中运行良好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T03:14:32.377

好的，我发现一个名为 Flexihash 的 PHP 类可以很好地处理这个问题。这是一篇关于它的博客文章：http: [//paul.annesley.cc/2008/04/flexihash-consistent-hashing-php/](http://paul.annesley.cc/2008/04/flexihash-consistent-hashing-php/)

此外，您可以在此处查看 Github 存储库：[https ://github.com/pda/flexihash](https://github.com/pda/flexihash)

这是我的代码现在为以后偶然发现此线程的任何人寻找的方式。

```
$db_servers = Array(
    'db-1','db-2','db-3'
    //you get the idea
);
$full_table = 'mydatabase.mytable'; //just an example...obviously
$Flexihash = new Flexihash(null, 8);
//I played around with different replica counts and settled on 8
$Flexihash->addTargets($db_servers);
$host = $Flexihash->lookup($full_table); 
```

# java - 无法确定关系属性的目标实体

> ID：12486593
> 
> 赞同：8
> 
> 时间：2012-09-18T23:36:50.377
> 
> 标签：java, jpa, eclipselink

我无法弄清楚问题是什么，请帮助。我搜索了很多，但没有找到任何有用的建议。也许你可以帮助我。非常感谢。

有两个类使用 eclipselink 作为 jpa 提供者：

```
@Entity
@Table(name = "USER")
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE)
    private Long id;

    private String login;

    private Long groupId;

    private String email;

    @ManyToMany(mappedBy = "users")
    private List polls;

    @OneToMany(mappedBy = "user")
    private List votes;

    public List getVotes() {
        return votes;
    }

    public void setVotes(List votes) {
        this.votes = votes;
    }

    public User() {
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getLogin() {
        return login;
    }

    public void setLogin(String login) {
        this.login = login;
    }

    public Long getGroupId() {
        return groupId;
    }

    public void setGroupId(Long groupId) {
        this.groupId = groupId;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public List getPolls() {
        return polls;
    }

    public void setPolls(List polls) {
        this.polls = polls;
    }
} 
```

和

```
@Entity
@Table(name = "VOTE")
public class Vote {

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE)
    private Long vid;

    private String comment;

    @ManyToOne
    private User user;

    @ManyToOne
    private Option option;

    public Vote() {
    }

    public Long getVid() {
        return vid;
    }

    public void setVid(Long vid) {
        this.vid = vid;
    }

    @Column(name = "comment")
    public String getComment() {
        return comment;
    }

    public void setComment(String comment) {
        this.comment = comment;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public Option getOption() {
        return option;
    }

    public void setOption(Option option) {
        this.option = option;
    }

} 
```

当我试图编译它时，我收到错误：

```
Exception [EclipseLink-7214] (Eclipse Persistence Services - 2.4.0.v20120608-r11652): org.eclipse.persistence.exceptions.ValidationException
Exception Description: The target entity of the relationship attribute [votes] on the class [class logic.User] cannot be determined.  When not using generics, ensure the target entity is defined on the relationship mapping. 
```

这是我的 persistence.xml 文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="1.0"
    xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd">
    <persistence-unit name="pollsPU" transaction-type="RESOURCE_LOCAL">
        <provider>org.eclipse.persistence.jpa.PersistenceProvider</provider>        
        <class>logic.Option</class>
        <class>logic.Poll</class>
        <class>logic.User</class>
        <class>logic.Vote</class>       
        <class>logic.Greeting</class>       
        <properties>
            <property name="eclipselink.jdbc.password" value="" />
            <property name="eclipselink.jdbc.user" value="" />
            <property name="eclipselink.jdbc.driver" value="com.mysql.jdbc.Driver" />
            <property name="eclipselink.jdbc.url"
                value="jdbc:mysql://localhost:3306/core_polls" />
            <property name="eclipselink.ddl-generation" value="drop-and-create-tables" />
            <property name="eclipselink.logging.level" value="INFO" />
            <property name="eclipselink.ddl-generation.output-mode"
                value="database" />
        </properties>
    </persistence-unit>
</persistence> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-09-18T23:53:58.193

如[Javadoc中所述](http://docs.oracle.com/javaee/5/api/javax/persistence/OneToMany.html)

> 如果集合使用泛型定义来指定元素类型，则不需要指定关联的目标实体类型；否则必须指定目标实体类。

所以，你可以做

```
@OneToMany(mappedBy = "user")
private List<Vote> votes; 
```

或者

```
@OneToMany(targetEntity=logic.Vote.class, mappedBy = "user")
private List votes; 
```

但我更喜欢第一个。

# jquery - ASP.net 或 jQuery 模态弹窗解决方案

> ID：12486594
> 
> 赞同：0
> 
> 时间：2012-09-18T23:37:01.517
> 
> 标签：jquery, asp.net

我正在寻找具有以下要求的模态弹出解决方案：

1.) 可与 ASP.net 一起使用。2.) 模态弹窗的高度是动态的，例如：模态弹窗的高度将根据其中的内容量以及您的内容是否使弹窗高于浏览器的可用高度而增长，内容将是可滚动的。

目前，我们正在使用 ASP.net 模态弹出窗口扩展器，如果我们的弹出窗口大于浏览器窗口，则必须单击并拖动。当用户的分辨率非常小并且模式弹出窗口的拖动句柄被浏览器的工具栏遮挡时，这会成为一个问题。

我只是想知道是否有其他人遇到过这个问题，如果有，他们是如何解决的。

提前谢谢你，吉姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:51:37.617

您是否尝试过 JQuery 对话框？

[http://jqueryui.com/demos/dialog/#modal](http://jqueryui.com/demos/dialog/#modal)

# python - 用破折号替换列表中每个项目的空格-python

> ID：12486598
> 
> 赞同：3
> 
> 时间：2012-09-18T23:37:35.090
> 
> 标签：python, whitespace, replace

有没有办法简化这个循环，我用破折号替换列表中每个项目的空格？

```
for item in a_list:
    alist[alist.index(item)] = '-'.join(item.split(" ")) 
```

还是这样更好？

```
for item in a_list:
    alist[alist.index(item)] = item.replace(" ", "-") 
```

**注意：上述解决方案仅更新此列表中的第一次出现，正如 David 建议的那样，使用*列表推导*来完成上述任务。**

我有一个单词列表，有些有破折号，有些没有。a_list 中的项目如下所示：

```
this-item has a-dash
this has dashes
this should-have-more dashes
this foo
doesnt bar
foo
bar 
```

输出应该是这样的，列表中的所有项目都应该有破折号而不是空格：

```
this-item-has-a-dash
this-has-dashes
this-should-have-more-dashes
this-foo
doesnt-bar
foo
bar 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-09-18T23:39:37.580

使用列表推导：

```
a_list = [e.replace(" ", "-") for e in a_list] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T00:13:04.587

当您发现自己使用该`index`方法时，您可能做错了什么。（并非*总是*如此，但经常足以让您考虑一下。）

在这种情况下，您正在按顺序迭代列表，并且您想知道当前元素的索引。反复查找它很慢（它使 O(N) 算法 O(N^3)）——但更重要的是，它很脆弱。例如，如果您有两个相同的项目，索引将永远找不到第二个。

这正是`enumerate`创建的目的。所以，这样做：

```
for i, item in enumerate(a_list):
    alist[i] = '-'.join(item.split(" ")) 
```

同时，您可以用列表推导替换循环：

```
a_list = ['-'.join(item.split(" ")) for item in a_list] 
```

这可能会更慢或使用更多内存（因为您正在复制列表而不是就地修改它），但这几乎肯定无关紧要（它肯定不会像您的原始代码那么慢），并且不可变算法更简单、更容易推理——也更灵活；您可以使用元组或任意迭代来调用此版本，而不仅仅是列表。

作为另一项改进，您真的需要`split`然后`join`，还是可以只使用`replace`？

```
a_list = [item.replace(" ", "-") for item in a_list] 
```

您可以改用正则表达式，这在某些类似情况下可能会更好地提高性能或可读性——但我认为在这种情况下实际上会更糟。所以，一旦你到达这里，你就完成了。

# eclipse - 删除了 Data_Stax，现在没有测试方法/类/等。在 javasrc/src 中

> ID：12486601
> 
> 赞同：0
> 
> 时间：2012-09-18T23:37:41.083
> 
> 标签：eclipse, datastax-enterprise

Eclipse 和 playOrm 运行良好，我终于让 Cassandra 运行，并且测试用例正在编译（运行/调试）。

在让 Cassandra 运行的过程中，我下载了 Data_Stax，我认为这毫无意义，因为 Cassandra 可能一直在运行，我只是在等待更多的东西出现，而不是 dos 窗口中的“Listening for thrifts clients”消息。

话虽如此，今天我删除了 Data_Stax，现在在重新创建 Java 项目时：从 AntBuild 中，我的 .java 方法和类不再出现在“包资源管理器”视图中。

![没有 .java 文件](../Images/4d6f88c42d232739c3358bd842e0e16f.png)

所有 .JAR 库文件都在填充...

![扩展库视图](../Images/675f5688319ee32e35cbce9af38adb41.png)

错误消息显示... ![在此处输入图像描述](../Images/e188c6f5556d9edef21cbeb17c2b6233.png)

这与删除 Data_Stax 有关吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-22T16:33:41.147

想通了，忘记运行 .bat 文件，填充库和文件......

# javascript - 在 JavaScript 中，如何将一个对象数组与另一个对象数组合并？

> ID：12486602
> 
> 赞同：0
> 
> 时间：2012-09-18T23:37:46.073
> 
> 标签：javascript, arrays, json, object

在一个循环中，我试图合并两个数组的内容：

```
var myArray = [{a:"a"},{b:"b"}];//first pass in loop
var myArray = [{c:"c"},{d:"d"}];//second pass in loop 
```

对于结果，我想要这个：

```
results = [{a:"a"},{b:"b"},{c:"c"},{d:"d"}]; 
```

如果我在每次通过时都这样做：

```
results.splice(0,0,array[i]); 
```

那么`results`数组就变成了两个数组的集合，而不是四个对象的集合。

我试过`.concat`了，但是没有用。

`for()`有没有办法在不使用and的组合的情况下将包含一个对象数组的对象与另一个对象数组合并`push()`？

一定有一些简单的东西我错过了。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:42:52.260

实际上 concat 是在您定义 myarray 两次的示例中的正确方法。希望您的代码中不是这种情况。当我尝试

```
var myArray1 = [{a:"a"},{b:"b"}];
var myArray2 = [{c:"c"},{d:"d"}];
var result = myarray1.concat(myarray2); 
```

这必须有效。如果没有，请在您的浏览器中向我们展示这三行的结果

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:54:24.857

Moataz 有你的答案，但你提到了一个循环，所以你可能正在寻找：

```
var result = [];
var myArray;

for (...) {
  myArray = /* getMyArray()? */
  result = result.concat(myArray);
} 
```

where`myArray`每次都设置为新值。`myArray`您可以通过在`concat`表达式中分配数组的逻辑来删除一行。

# ant - 常春藤 SSH 发布者

> ID：12486604
> 
> 赞同：2
> 
> 时间：2012-09-18T23:37:57.817
> 
> 标签：ant, jenkins, x11, ivy

我正在尝试使用 ssh 发布者通过 jenkins 将工件发布到远程服务器。

```
<ssh name="ssh-publisher" host="myhost.com" user="dummy" keyFile="/home/dummy/id_rsa">
   <ivy pattern="/data/refdata/local0/artifacts[organisation]/[module]/[revision]/ivy-[revision].xml"/>
   <artifact pattern="/data/refdata/local0/artifacts/[organisation]/[module]/[revision]/[artifact]-[revision](-[classifier]).[ext]"/>
</ssh> 
```

但是，当我尝试发布时，出现以下错误

```
impossible to publish artifacts for <my.artifacts>;<my.version>: java.awt.HeadlessException: 
No X11 DISPLAY variable was set, but this program performed an operation which requires it.
    at java.awt.GraphicsEnvironment.checkHeadless(GraphicsEnvironment.java:159)
    at java.awt.Window.<init>(Window.java:407)
    at java.awt.Frame.<init>(Frame.java:402)
    at java.awt.Frame.<init>(Frame.java:367)
    at javax.swing.SwingUtilities$SharedOwnerFrame.<init>(SwingUtilities.java:1731)
.... 
```

所以我在远程用户的 bash_profile 中设置了 DISPLAY 变量，我都试过了

```
export DISPLAY=:0.0
export DISPLAY=<jenkin.server.ip>:0.0 
```

但它们都不起作用。有人可以告诉我如何解决这个问题吗？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-11-19T15:42:38.817

我认为 Ivy 试图提示您输入密码，但由于 Jenkins 无头运行，它不能这样做。检查您的密钥文件。

# php - 将平面数组变成嵌套数组

> ID：12486605
> 
> 赞同：0
> 
> 时间：2012-09-18T23:38:00.763
> 
> 标签：php

只是在做一些事情，如果不使用 foreach 循环遍历数组，就找不到解决这个问题的简单方法。有没有人有一个简单的解决方案

我想转这个

```
&array(4) {
["a"]=>int(0)
["b"]=>int(1)
["c"]=>int(2)
["d"]=>int(3)
} 
```

进入这个

```
array(1) {
  ["a"]=>
  array(1) {
    [0]=>
    array(1) {
      ["b"]=>
      array(1) {
        [0]=>
        array(1) {
          ["c"]=>
          array(1) {
            [0]=>
            array(1) {
              ["d"]=> int(1) //this value does not matter
            }
          }
        }
      }
    }
  }
} 
```

这些值根本不重要，我只需要针对我拥有的 array_intersect_key_recursive 函数运行密钥。

编辑：测试后数组已更改，需要嵌套为数组的数组

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:49:01.927

我不知道这最终会如何帮助你，但这仍然是一个有趣的练习。

```
$newArray = array();
$last = &$newArray;
$array = array_reverse(array_keys($array));
while ($item = array_pop($array)) {
   if (!is_array($last)) {
      $last = array();
   }
   $last[$item] = array(array());
   $last = &$last[$item][0];
} 
```

注意：我用`int(1)`. 你说值不重要，所以我现在不打算更改它，但如果值很重要，你将不得不做更多的工作（可能是从原始数组中获取值`$item`作为键）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T02:06:04.017

使用递归的另一种方法：

```
function toNestedArray(array $array, $index = 0) {
    $return = array();
    if ($index < count($array)) {
        $return[$array[$index]] = toNestedArray($array, ++$index);
    }
    return $return;
} 
```

使用示例：

```
$flatArray   = array('a' => 1, 'b' => 2, 'c' => 3, 'd' => 4); 
$nestedArray = toNestedArray(array_keys($flatArray));
print_r($nestedArray); 
```

输出：

```
Array
(
    [a] => Array
        (
            [b] => Array
                (
                    [c] => Array
                        (
                            [d] => Array
                                (
                                )

                        )

                )

        )

) 
```

# android - 果冻豆的 MapActivity 类

> ID：12486608
> 
> 赞同：0
> 
> 时间：2012-09-18T23:38:16.990
> 
> 标签：android, mapactivity

在我为果冻豆制作的测试应用程序中，似乎 MapActivity 类为我的代码抛出了 Class not Found 异常。一旦删除了 MapActivity 的所有使用，该应用程序就会运行。

这里是代码。这会随着 Class not found 不断崩溃。我在这里做错了什么？

```
import android.os.Bundle;

import com.google.android.maps.MapActivity;
import com.loopj.android.http.RequestParams;

public class HomeActivity extends MapActivity {

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_home);
    }

    @Override
    protected boolean isRouteDisplayed() {
        return false;
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:39:22.807

您的清单中没有该`<uses-library>`元素，或者您在没有 Google Maps SDK 插件的设备或模拟器上运行此应用程序。

# out-of-memory - 随机 500 和 404 错误 - Gitlab

> ID：12486610
> 
> 赞同：2
> 
> 时间：2012-09-18T23:38:36.747
> 
> 标签：out-of-memory, http-status-code-404, gitlab

我在安装 Gitlab 时遇到随机友好的 500 和 404 错误。除此以外，一切正常。

这真的很烦人，有时页面可以工作，有时我需要刷新页面几次才能显示。

这是我遇到的错误`/etc/httpd/logs/error_log`

```
ActionView::Template::Error (cannot map `/home/git/gitlabhq/vendor/bundle/ruby/1.9.1/gems/charlock_holmes-0.6.8/ext/charlock_holmes/dst/share/misc/magic.mgc' (Cannot allocate memory)):
1: - file = tree_full_path(content)
2: %tr{ class: "tree-item #{tree_hex_class(content)}", url: tree_file_project_ref_path(@project, @ref, file) }    3:   %td.tree-item-file-name
4:     = tree_icon(content)
5:     = link_to truncate(content.name, length: 40), tree_file_project_ref_path(@project, @ref || @commit.id, file), remote: :true
6:   %td.tree_time_ago.cgray
7:     - if index == 1
app/helpers/tree_helper.rb:4:in `tree_icon'
app/views/refs/_tree_item.html.haml:4:in `_app_views_refs__tree_item_html_haml__359204534986361082_50783740'
app/views/refs/_tree.html.haml:37:in `block in _app_views_refs__tree_html_haml__2791169573873392874_51939480'
app/views/refs/_tree.html.haml:36:in `each'
app/views/refs/_tree.html.haml:36:in `_app_views_refs__tree_html_haml__2791169573873392874_51939480'
app/views/refs/tree.html.haml:2:in `_app_views_refs_tree_html_haml__1175555315298044292_52501320'
app/controllers/refs_controller.rb:40:in `tree'

^GOut of memory (Needed 8160 bytes)

ActionView::Template::Error (Mysql2::Error: MySQL client ran out of memory: SELECT COUNT(*) FROM `users` ):    25:       %h5 Users
26:       .data.padded    27:         = link_to admin_users_path do
28:           %h1= User.count
29:         %hr
30:         = link_to 'New User', new_admin_user_path, class: "btn small"
31:  config/initializers/connection_fix.rb:22:in `execute'
 app/views/admin/dashboard/index.html.haml:28:in `block in _app_views_admin_dashboard_index_html_haml___3571568531981020694_30874020'
 app/views/admin/dashboard/index.html.haml:27:in `_app_views_admin_dashboard_index_html_haml___3571568531981020694_30874020' 
```

我是 Ruby 世界的新手。

补充说明：

*   操作系统：Centos 5
*   Gitlab v2.8.2
*   该问题几乎从未出现在管理页面或其他页面上。仅在存储库页面上，例如文件树、图表或提交

# openlaszlo - 如何在 OpenLaszlo 中创建一个比可以暂停和循环的 lz.Timer 类更准确的计时器？

> ID：12486611
> 
> 赞同：1
> 
> 时间：2012-09-18T23:38:39.643
> 
> 标签：openlaszlo, lzx

OpenLaszlo 中的 lz.Timer 类有时会延迟 256 毫秒，您如何创建一个更准确地触发？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:39:59.190

我设计的以下 OpenLaszlo 计时器类将更准确地触发，并且还有一个很好的循环功能，带有暂停和重置，以便于使用。此代码适用于 OpenLaszlo 4.9.0 SWF10 和 DHTML 运行时：

```
<library>

  <!---
  Class: <loopingtimer>
  Extends: <node>

  This class is a looping timer that can be used to call a method to peform
  an action repeatedly after a specified number of milliseconds.

  Override the abstract method reactToTimeChange(theTime) to do something
  useful in your application, theTime will be the time elapsed since the
  timer's last firing, it will be close to the 'timer_resolution' set but
  will be off from about 47ms-78ms in FireFox 2 and 47ms-94ms in IE6
  (see note below for explanation).

  NOTE:

  This class originally used the LzTimer class but it was firing up to 256ms
  late, so this has been replaced with a setTimeout() method and embedded
  JavaScript which is more accurate, but still fires about 59ms late on
  average.

  For this reason the firing times of this class are approximate but will
  probably fire 47ms to 78ms (about 59ms) on average late. As a workaround
  for this problem the timer uses the system time to calculate how much time
  has actually elapsed since the last timer firing and passes the actual time
  elapsed ('theTime') in milliseconds to the abstract 'reactToTimeChange()'
  method.

  -->
  <class name="loopingtimer" extends="node">

    <switch>
      <when property="$as3">
        <passthrough>
          import flash.utils.setTimeout;
        </passthrough>
      </when>
    </switch>

    <!-- *** ATTRIBUTES *** -->

    <!-- Public Attributes -->

    <!---
    @param numnber timer_resolution: number of milliseconds between timer
    firings (default: 40ms)

    Note: OpenLaszlo seems to typically have a lower limit of 47-78
    milliseconds between firings, so setting below this may be useless.
    -->
    <attribute name="timer_resolution" type="number" value="40" />

    <!-- Private Attributes -->

    <!--- @keywords private -->
    <!---
    @param number formertime: used internally to calculate the number of
    elapsed milliseconds since playback was started
    -->
    <attribute name="formertime" type="number" value="0" />

    <!--- @keywords private -->
    <!---
    Used internally for tracking virtual current time in milliseconds
    for pause functionality.
    -->
    <attribute name="currenttime" type="number" value="0" />

    <!--- @keywords private -->
    <!--- @param string timer_state: 'PAUSED' | 'COUNTING' -->
    <attribute name="timer_state" type="string" value="PAUSED" />

    <!-- *** METHODS *** -->

    <!-- Public Methods -->

    <!--- @keywords abstract -->
    <!---
    ABSTRACT METHOD: overwrite to do something useful in your program

    @param number theTime: the time in milliseconds elapsed since playback
    was  started
    -->
    <method name="reactToTimeChange" args="theTime">
      if ($debug){
        Debug.write('WARNING: reactToTimeChange(): This is an abstract method that should be overridden to do something useful in your application');
        Debug.write('reactToTimeChange(): Time elapsed since last firing in milliseconds: '+theTime);
      }
    </method>

    <!--- Start Timer (Note: This will reset timer to 0) -->
    <method name="startTimer">
      this.setAttribute('timer_state', 'COUNTING');
      var now = new Date();
      var rawTime = now.getTime();
      this.setAttribute('formertime', rawTime);

      this.doForTime();
    </method>

    <!--- Pauses timer at current time -->
    <method name="pauseTimer">
      this.setAttribute('timer_state', 'PAUSED');
    </method>

    <!--- Resumes timer from time it is paused at -->
    <method name="unpauseTimer">
      this.setAttribute('timer_state', 'COUNTING');
      var now = new Date();
      var rawTime = now.getTime();
      this.setAttribute('formertime', rawTime-this.currenttime);
      this.repeat();
    </method>

    <!--- Stop Timer - stops timer and resets to 0  -->
    <method name="stopTimer">
      this.pauseTimer();
      this.resetTimer();
    </method>

    <!--- Resets Timer to 0 -->
    <method name="resetTimer">
      this.setAttribute('formertime', 0);
      this.setAttribute('currenttime', 0);
    </method>

    <!---
    Seeks to the given time in milliseconds.

    @param number(int) iTimeMs: the time to seek to
    -->
    <method name="seekToTime" args="iTimeMs">
      this.setAttribute('currenttime', Math.floor(iTimeMs));
    </method>

    <!-- Private Methods -->

    <!--- @keywords private -->
    <!---
    Called Internally By Timer

    @param number theTime: the actual time in milliseconds that has passed
    since the last timer firing (will usually be 16-100ms more than timer
    firing interval)
    -->
    <method name="doForTime">

      // Prevent Timer Incrementing When Paused
      if (this.timer_state == 'PAUSED')
        return;

      var now = new Date();

      var rawTime = now.getTime();

      if (this.formertime != 0)
        var currentTime = rawTime - this.formertime;

      this.setAttribute('currenttime', currentTime);

      // Call Abstract Method:
      this.reactToTimeChange(currentTime);

      this.repeat();

    </method>

    <!--- @keywords private -->
    <!---
    Used internally for timer looping.
    -->
    <method name="repeat">

      // This function uses an embedded JavaScript function which
      // can be called via the standard JavaScript setTimeout()
      // method which results in more accurate timer firing then the
      // standard OpenLaszlo LzTimer() class. LzTimer() fired up to
      // 256ms late, while setTimeout() usually fires from
      // only 47ms-78ms

      var f = function(){
        doForTime();
      }

      setTimeout(f, this.timer_resolution);
    </method>

  </class>

</library> 
```

# google-chrome - 如何使用 chrome 应用打开链接？（类似于 Android 如何提示您要使用哪个应用程序来处理某些 URL）

> ID：12486619
> 
> 赞同：0
> 
> 时间：2012-09-18T23:39:51.187
> 
> 标签：google-chrome, google-chrome-extension

我有一个 chrome 应用程序，它显示从网站 A 提取的数据。

如果用户安装了应用程序，并且在网站 A 上，如何让 chrome 应用程序检测到用户在网站 A 上，然后提示用户在 chrome 应用程序中打开网站 A？

例如，如果您尝试打开 Google Play 商店 URL，我试图模仿 Android 是如何做到这一点的。

提前致谢， 迪米特里

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T05:31:46.733

您的应用需要在[清单](http://developer.chrome.com/extensions/manifest.html)文件中定义一个[webRequest](http://developer.chrome.com/extensions/webRequest.html)（权限的一部分） 。你可以使用阻塞响应来自己处理所有的东西。

# php - 将十六进制颜色分类为红、绿、蓝、黄、橙、

> ID：12486621
> 
> 赞同：5
> 
> 时间：2012-09-18T23:40:05.553
> 
> 标签：php, colors, hex

有没有办法轻松地将给定的十六进制颜色代码分配给更一般的类别（红色、绿色、蓝色、黄色、橙色、粉色、黑色、白色、灰色……）？

喜欢`#ffcc55`-> 橙色，`#f0f0f0`-> 白色，...

编辑：甚至类似于 adobe photoshop 寻找最近的网络安全颜色，因此它将颜色数量减少到 256，这已经是一个很好的解决方案！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T00:10:32.000

这是来自[http://php.net/manual/en/function.dechex.php](http://php.net/manual/en/function.dechex.php)，来自 lavacube dot com 的 cory 的评论：

```
<?php

function color_mkwebsafe ( $in )
{
    // put values into an easy-to-use array
    $vals['r'] = hexdec( substr($in, 0, 2) );
    $vals['g'] = hexdec( substr($in, 2, 2) );
    $vals['b'] = hexdec( substr($in, 4, 2) );

    // loop through
    foreach( $vals as $val )
    {
        // convert value
        $val = ( round($val/51) * 51 );
        // convert to HEX
        $out .= str_pad(dechex($val), 2, '0', STR_PAD_LEFT);
    }

    return $out;
}

?> 
```

示例：color_mkwebsafe('0e5c94'); 生产：006699

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-19T00:23:55.103

我不是 php 大师，所以在 php 中可能有更有效的方法来解决这个问题，但我会将每种颜色设置为一个数组，所以每个颜色类别都有 3 个数字。然后找到您建议的颜色与其他颜色之间的数学距离。保存最接近的匹配并返回它的名称。

```
function getcolorname($mycolor) {
    // mycolor should be a 3 element array with the r,g,b values 
    // as ints between 0 and 255\. 
    $colors = array(
        "red"       =>array(255,0,0),
        "yellow"    =>array(255,255,0),
        "green"     =>array(0,255,0),
        "cyan"      =>array(0,255,255),
        "blue"      =>array(0,0,255),
        "magenta"   =>array(255,0,255),
        "white"     =>array(255,255,255),
        "grey"      =>array(127,127,127),
        "black"     =>array(0,0,0)
    );

    $tmpdist = 255*3;
    $tmpname = "none";
    foreach($colors as $colorname => $colorset) {        
        $r_dist = (pow($mycolor[0],2) - pow($colorset[0],2));
        $g_dist = (pow($mycolor[1],2) - pow($colorset[1],2));       
        $b_dist = (pow($mycolor[2],2) - pow($colorset[2],2));
        $totaldist = sqrt($r_dist + $g_dist + $b_dist);
        if ($totaldist < $tmpdist) {        
            $tmpname = $colorname;
            $tmpdist = $totaldist;
        }
    }
    return $tmpname;
} 
```

# python - Paramiko 无法下载大于 1GB 的大文件

> ID：12486623
> 
> 赞同：19
> 
> 时间：2012-09-18T23:40:40.660
> 
> 标签：python, paramiko

```
def download():
if os.path.exists( dst_dir_path ) == False:
    logger.error( "Cannot access destination folder %s. Please check path and permissions. " % ( dst_dir_path ))
    return 1
elif os.path.isdir( dst_dir_path ) == False:
    logger.error( "%s is not a folder. Please check path. " % ( dst_dir_path ))
    return 1

file_list = None
#transport = paramiko.Transport(( hostname, port)) 
paramiko.util.log_to_file('paramiko.log')
ssh = paramiko.SSHClient() 
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy()) 
#transport
try:
    ssh.connect( hostname, username=username, password=password, timeout=5.0) 
    #transport.connect(username=username, password=password ) 
except Exception, err:
    logger.error( "Failed to connect to the remote server. Reason: %s" % ( str(err) ) )
    return 1

try:
    #sftp = paramiko.SFTPClient.from_transport(transport)
    sftp = ssh.open_sftp() 
except Exception, err:
    logger.error( "Failed to start SFTP session from connection to %s. Check that SFTP service is running and available. Reason: %s" % ( hostname, str(err) ))
    return 1

try:    
    sftp.chdir(src_dir_path)
    #file_list = sftp.listdir(path="%s" % ( src_dir_path ) )
    file_list = sftp.listdir()

except Exception, err:
    logger.error( "Failed to list files in folder %s. Please check path and permissions. Reason: %s" % ( src_dir_path, str(err) ))
    return 1
match_text = re.compile( file_mask )
download_count = 0
for file in file_list:         
    # Here is an item name... but is it a file or directory?         
    #logger.info( "Downloading file %s." % ( file ) )
    if not re.match( file_mask, file ):
        continue
    else:
        logger.info( "File \"%s\" name matched file mask \"%s\". matches %s.Processing file..." % ( file, file_mask, (match_text.match( file_mask ) ) ) )
    src_file_path = "./%s" % ( file )
    dst_file_path = "/".join( [ dst_dir_path, file]   )
    retry_count = 0
    while True:
        try:
            logger.info( "Downloading file %s to %s."  % ( file, dst_file_path ) )
            #sftp.get( file, dst_file_path, callback=printTotals ) #sftp.get( remote file, local file )
            sftp.get( file, dst_file_path) #sftp.get( remote file, local file )
            logger.info( "Successfully downloaded file %s to %s."  % ( file, dst_file_path ) )
            download_count += 1
            break
        except Exception, err:
            if retry_count == retry_threshold:
                logger.error( "Failed to download %s to %s. Reason: %s." % ( file, dst_file_path, str(err) ) )
                sftp.close() 
                #transport.close()
                return 1
            else:
                logger.error( "Failed to download %s to %s. Reason: %s." % ( file, dst_file_path, str(err) ) )
                retry_count +=1

sftp.close() 
transport.close() 
logger.info( "%d files downloaded." % ( download_count ) )
return 0 
```

当我运行以下函数时，它会下载源文件大约 3 分钟，然后关闭会话，即使只下载了 1-1.6GB 文件的 38-41MB（不定）。

从 Paramiko 日志文件中，看起来 SSh 连接在 SFTP 会话关闭时保持打开状态：

> hmac-sha1', 'hmac-sha1-96', 'hmac-md5', 'hmac-md5-96', 'umac-64@openssh.com'] 服务器mac:['hmac-sha1', 'hmac- sha1-96', 'hmac-md5', 'hmac-md5-96', 'umac-64@openssh.com'] 客户端压缩：['zlib@openssh.com', 'zlib', 'none'] 服务器compress:['zlib@openssh.com', 'zlib', 'none'] 客户端 lang:[''] 服务器 lang:[''] kex 跟随？假 DEB [20120913-10:05:07.421] thr=1 paramiko.transport：密码同意：local=aes128-ctr，remote=aes128-ctr DEB [20120913-10:05:07.421] thr=1 paramiko.transport：使用 kex diffie-hellman-group1-sha1；服务器密钥类型 ssh-dss；密码：本地 aes128-ctr，远程 aes128-ctr；mac：本地 hmac-sha1，远程 hmac-sha1；压缩：本地无，远程无 DEB [20120913-10:05:07。625] thr=1 paramiko.transport: 切换到新密钥... INF [20120913-10:05:10.374] thr=2 paramiko.transport.sftp: [chan 1] sftp 会话关闭。DEB [20120913-10:05:10.388] thr=2 paramiko.transport: [chan 1] EOF 发送 (1)

此后，脚本退出并出现此异常（来自 sftp.get() try/except 块）

> 资源不足，无法完成请求

系统本身有千兆字节的可用磁盘空间，所以这不是问题。

parakmiko 失败的相同传输在 FileZilla 和我几年前编写的用于 SFTP 传输的 Java 应用程序中运行良好。所以我认为这是 paramiko 的问题。

它在 Windows XP 和 Windows Server 2003 上运行。

我已经尝试修补 Paramko 1.17 以便它更频繁地刷新密钥，但传输仍然会引发异常。Python 2.7.3 Paramiko 1.7 与补丁 Windows 2003 Sevfer

想法？

附加信息：它在 Windows XP SP3 和 Windows 2003 服务器上失败，完全相同的行为和错误消息。sys.version 信息 Window XP Workstation: '2.7.3 (default, Apr 10 2012, 23:31:26) [MSC v.1500 32 bit (Intel)]' Windows 2003 Server: '2.7.3 (default, Apr 10 2012, 23:31:26) [MSC v.1500 32 bit (Intel)]' 我修补了 packet.py 文件以减少密钥更新之间的时间。它对 sftp.get() 的行为没有影响。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2013-01-08T07:36:25.587

SFTP 协议没有办法流式传输文件数据；相反，它所拥有的是一种从打开文件中的特定偏移量请求数据块的方法。下载文件的简单方法是请求第一个块，将其写入磁盘，然后请求第二个块，依此类推。这是可靠的，但非常慢。

相反，Paramiko 使用了一个性能技巧：当您调用它时，它会立即为文件中的*每个*`.get()`块发送请求，并且它会记住它们应该写入的偏移量。然后，当每个响应到达时，它会确保将其写入磁盘上正确的偏移量。有关详细信息，请参阅 Paramiko 文档中的和方法。我怀疑它在下载 1GB 文件时存储的簿记信息可能会导致......资源耗尽，生成“资源不足”消息。*`SFTPFile.prefetch()``SFTPFile.readv()`*

 *`.get()`如果您只是调用`.open()`以获取`SFTPFile`实例，则不要使用，然后调用`.read()`该对象，或者将其交给 Python 标准库函数`shutil.copyfileobj()`以下载内容。这应该避免 Paramiko 预取缓存，并允许您下载文件，即使它不是那么快。

IE：

```
 def lazy_loading_ftp_file(sftp_host_conn, filename):
    """
        Lazy loading ftp file when exception simple sftp.get call
        :param sftp_host_conn: sftp host
        :param filename: filename to be downloaded
        :return: None, file will be downloaded current directory
    """
    import shutil
    try:
        with sftp_host_conn() as host:
            sftp_file_instance = host.open(filename, 'r')
            with open(filename, 'wb') as out_file:
                shutil.copyfileobj(sftp_file_instance, out_file)
            return {"status": "sucess", "msg": "sucessfully downloaded file: {}".format(filename)}
    except Exception as ex:
        return {"status": "failed", "msg": "Exception in Lazy reading too: {}".format(ex)} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-09-23T21:37:55.797

我有一个非常相似的问题，在我的情况下，文件只有 ~400 MB，但在下载大约 35 MB 左右后它会一直失败。它并不总是在下载完全相同的字节数时失败，但在大约 35 - 40 MB 的某个地方，文件会停止传输，大约一分钟后，我会收到“资源不足，无法完成请求”错误。

通过 WinSCP 或 PSFTP 下载文件工作正常。

我尝试了Screwtape 的方法，它确实有效，但速度非常慢。我的 400 MB 文件要花 4 个小时才能下载，这对于这个特定的应用程序来说是一个不可接受的时间范围。

此外，有一次，当我们第一次进行设置时，一切正常。但是服务器管理员对 SFTP 服务器进行了一些更改，这就是事情发生的时候。我不确定更改是什么，但由于使用 WinSCP/其他 SFTP 方法仍然可以正常工作，我认为尝试从服务器端攻击它不会有成果。

我不会假装理解为什么，但最终对我有用的是：

1.  我下载并安装了当前版本的 Paramiko（此时为 1.11.1）。最初这根本没有任何区别，但我想我会提到它以防万一它是解决方案的一部分。

2.  异常的堆栈跟踪是：

    ```
    File "C:\Python26\lib\site-packages\paramiko\sftp_client.py", line 676, in get
        size = self.getfo(remotepath, fl, callback)
    File "C:\Python26\lib\site-packages\paramiko\sftp_client.py", line 645, in getfo
        data = fr.read(32768)
    File "C:\Python26\lib\site-packages\paramiko\file.py", line 153, in read
        new_data = self._read(read_size)
    File "C:\Python26\lib\site-packages\paramiko\sftp_file.py", line 157, in _read
        data = self._read_prefetch(size)
    File "C:\Python26\lib\site-packages\paramiko\sftp_file.py", line 138, in _read_prefetch
        self._check_exception()
    File "C:\Python26\lib\site-packages\paramiko\sftp_file.py", line 483, in _check_exception
        raise x 
    ```

3.  在 sftp_file.py 中查看了一下，我注意到了这一点（当前版本中的第 43-45 行）：

    ```
    # Some sftp servers will choke if you send read/write requests larger than
    # this size.
    MAX_REQUEST_SIZE = 32768 
    ```

4.  一时兴起，我尝试将 MAX_REQUEST_SIZE 更改为 1024，你瞧，我能够下载整个文件！

5.  在通过将 MAX_REQUEST_SIZE 更改为 1024 使其工作后，我尝试了 1024 到 32768 之间的其他值，以查看它是否影响性能或其他任何东西。但是当值明显大于 1024（1025 可以，但 1048 最终失败）时，我总是迟早会得到错误。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2019-10-11T10:47:23.630

我在使用 pysftp 通过 SFTP 下载大文件（>1 GB）时遇到了问题。底层库是 Paramiko。谷歌搜索问题将我带到这里，并且有很好的解决方案。尽管如此，许多帖子都相对较旧，我想这些问题中的大部分已经随着时间的推移而得到解决。它对我的问题没有帮助。

即：Paramiko 在 sftp_file.py 预取期间加载块时遇到内存错误。该列表超出了限制，并且内存错误以某种方式没有阻止执行。它可能在堆栈上以某种方式默默地消耗掉了。仅当发生此错误时下载才会失败，并且它们在单独的线程中运行。

无论如何，控制列表大小的方法是设置 MAX_REQUEST_SIZE：

```
paramiko.sftp_file.SFTPFile.MAX_REQUEST_SIZE = pow(2, 22) # 4MB per chunk 
```

如果超过 16MB，你会遇到一个新问题：paramiko.sftp.SFTPError: Garbage packet received。原来在 _read_packet 方法中检查了 sftp.py：

```
# most sftp servers won't accept packets larger than about 32k, so
# anything with the high byte set (> 16MB) is just garbage.
if byte_ord(x[0]):
    raise SFTPError("Garbage packet received") 
```

因此，如果一个块 > 16MB，我们就会引发此错误。我不想摆弄 Paramiko 库本身，所以我不得不将我的块大小保持在 4MB 的“可接受的最大值”。

这样我就能够下载大小> 30GB的文件。希望这对人们有所帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-03-07T12:00:41.727

除了Screwtape的回答之外，还值得一提的是，您可能应该限制块大小`.read([block size in bytes])`

阅读大文件的懒惰[方法](https://stackoverflow.com/questions/519633/lazy-method-for-reading-big-file-in-python)

`file.read()`我在 2.4 中没有块大小大小时遇到​​了真正的问题，但 2.7 可能确定正确的块大小。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2019-06-25T11:25:35.990

我将这种类型的脚本与 paramiko 一起用于较大的文件，您可以使用`window_size`/`packet size`来查看最适合您的方式，如果您希望它具有更高的性能，您可以运行并行进程以使用并行读取不同的文件块第二种方法（见[http://docs.paramiko.org/en/latest/api/sftp.html#paramiko.sftp_file.SFTPFile.readv](http://docs.paramiko.org/en/latest/api/sftp.html#paramiko.sftp_file.SFTPFile.readv)）

```
import time, paramiko

MAX_RETRIES = 10

ftp_server = "ftp.someserver.com"
port = 22
sftp_file = "/somefolder/somefile.txt"
local_file = "/somefolder/somewhere/here.txt"
ssh_conn = sftp_client = None
username = "username"
password = "password"

start_time = time.time()

for retry in range(MAX_RETRIES):
    try:
        ssh_conn = paramiko.Transport((ftp_server, port))
        ssh_conn.connect(username=username, password=password)
        # method 1 using sftpfile.get and settings window_size, max_packet_size
        window_size = pow(4, 12)#about ~16MB chunks
        max_packet_size = pow(4, 12)
        sftp_client = paramiko.SFTPClient.from_transport(ssh_conn, window_size=window_size, max_packet_size=max_packet_size)
        sftp_client.get(sftp_file, local_file)
        # method 2 breaking up file into chunks to read in parallel
        sftp_client = paramiko.SFTPClient.from_transport(ssh_conn)
        filesize = sftp_client.stat(sftp_file).st_size
        chunksize = pow(4, 12)#<-- adjust this and benchmark speed
        chunks = [(offset, chunksize) for offset in range(0, filesize, chunksize)]
        with sftp_client.open(sftp_file, "rb") as infile:
            with open(local_file, "wb") as outfile:
                for chunk in infile.readv(chunks):
                    outfile.write(chunk)
        break
    except (EOFError, paramiko.ssh_exception.SSHException, OSError) as x:
        retry += 1
        print("%s %s - > retrying %s..." % (type(x), x, retry))
        time.sleep(abs(retry) * 10)
        # back off in steps of 10, 20.. seconds 
    finally:
        if hasattr(sftp_client, "close") and callable(sftp_client.close):
            sftp_client.close()
        if hasattr(ssh_conn, "close") and callable(ssh_conn.close):
            ssh_conn.close()

print("Loading File %s Took %d seconds " % (sftp_file, time.time() - start_time)) 
```

如果您真的关心性能，您可以运行第二种方法并将文件分成多个进程/线程，这是一个使用多线程的代码示例，它写入多个文件部分，然后将它们连接到一个文件中

```
import threading, os, time, paramiko

#you could make the number of threads relative to file size
NUM_THREADS = 4
MAX_RETRIES = 10

def make_filepart_path(file_path, part_number):
    """creates filepart path from filepath"""
    return "%s.filepart.%s" % (file_path, part_number+1)

def write_chunks(chunks, tnum, local_file_part, username, password, ftp_server, max_retries):
    ssh_conn = sftp_client = None
    for retry in range(max_retries):
        try:
            ssh_conn = paramiko.Transport((ftp_server, port))
            ssh_conn.connect(username=username, password=password)
            sftp_client = paramiko.SFTPClient.from_transport(ssh_conn)
            with sftp_client.open(sftp_file, "rb") as infile:
                with open(local_file_part, "wb") as outfile:
                    for chunk in infile.readv(chunks):
                        outfile.write(chunk)
            break
        except (EOFError, paramiko.ssh_exception.SSHException, OSError) as x:
            retry += 1
            print("%s %s Thread %s - > retrying %s..." % (type(x), x, tnum, retry))
            time.sleep(abs(retry) * 10)
        finally:
            if hasattr(sftp_client, "close") and callable(sftp_client.close):
                sftp_client.close()
            if hasattr(ssh_conn, "close") and callable(ssh_conn.close):
                ssh_conn.close()

start_time = time.time()

for retry in range(MAX_RETRIES):
    try:
        ssh_conn = paramiko.Transport((ftp_server, port))
        ssh_conn.connect(username=username, password=password)
        sftp_client = paramiko.SFTPClient.from_transport(ssh_conn)
        # connect to get the file's size in order to calculate chunks
        filesize = sftp_client.stat(sftp_file).st_size
        sftp_client.close()
        ssh_conn.close()
        chunksize = pow(4, 12)
        chunks = [(offset, chunksize) for offset in range(0, filesize, chunksize)]
        thread_chunk_size = (len(chunks) // NUM_THREADS) + 1
        # break the chunks into sub lists to hand off to threads
        thread_chunks = [chunks[i:i+thread_chunk_size] for i in range(0, len(chunks) - 1, thread_chunk_size)]
        threads = []
        fileparts = []
        for thread_num in range(len(thread_chunks)):
            local_file_part = make_filepart_path(local_file, thread_num) 
            args = (thread_chunks[thread_num], thread_num, local_file_part, username, password, ftp_server, MAX_RETRIES)
            threads.append(threading.Thread(target=write_chunks, args=args))
            fileparts.append(local_file_part)
        for thread in threads:
            thread.start()
        for thread in threads:
            thread.join()
        # join file parts into one file, remove fileparts
        with open(local_file, "wb") as outfile:
            for filepart in fileparts:
                with open(filepart, "rb") as infile:
                    outfile.write(infile.read())
                os.remove(filepart)
        break
    except (EOFError, paramiko.ssh_exception.SSHException, OSError) as x:
        retry += 1
        print("%s %s - > retrying %s..." % (type(x), x, retry))
        time.sleep(abs(retry) * 10)
    finally:
       if hasattr(sftp_client, "close") and callable(sftp_client.close):
           sftp_client.close()
       if hasattr(ssh_conn, "close") and callable(ssh_conn.close):
           ssh_conn.close()

print("Loading File %s Took %d seconds " % (sftp_file, time.time() - start_time)) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-02-15T12:14:24.373

我尝试将代码跟踪到 paramiko，现在我确定这是服务器问题。

### 1\. prefetch做了什么

为了提高下载速度，paramiko 尝试通过 fetch 方法预取文件。当`SFTP_FILE.prefetch()`方法被调用时，会创建一个新线程，并将吨 fetch 请求发送到服务器 util 覆盖整个文件。
我们可以在文件 paramiko/sftp_file.py 的第 464 行附近找到它。

### 2.如何确定是服务器问题

上面提到的请求是在异步模式下运行的。`SFTP_FILE._async_response()`用于接收来自服务器的异步响应。跟踪代码，我们可以发现这个异常是在`SFTP_FILE._async_response()`从服务器发送的消息转换的方法中创建的。现在，我们可以确定这是来自服务器的异常。

### 3.如何解决问题

因为我无法访问服务器，所以在命令行中使用 sftp 是我最好的选择。但是另一方面，现在我们知道请求过多会使服务器崩溃，所以我们可以在向服务器发送请求时休眠.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2020-12-10T06:12:37.960

我也遇到了类似的问题。

```
Traceback (most recent call last):
File "---", line 948, in <module>
main()
File "---", line 937, in main
args.sshProxyKeyfile)
File "---", line 904, in Bootstrap
CopyFiles(client, builds, k8sVer)
File "---", line 393, in CopyWcpFilesToVC
ScpWithClient(client, __file__, __file__)
File "---", line 621, in ScpWithClient
with client.open_sftp() as sftp:
File "---_env.Linux/lib64/python3.5/site-packages/paramiko/client.py", line 556, in open_sftp
return self._transport.open_sftp_client()
File "---_env.Linux/lib64/python3.5/site-packages/paramiko/transport.py", line 1097, in open_sftp_client
return SFTPClient.from_transport(self)
File "---_env.Linux/lib64/python3.5/site-packages/paramiko/sftp_client.py", line 170, in from_transport
return cls(chan)
File "---_env.Linux/lib64/python3.5/site-packages/paramiko/sftp_client.py", line 130, in __init__
server_version = self._send_version()
File "---_env.Linux/lib64/python3.5/site-packages/paramiko/sftp.py", line 134, in _send_version
t, data = self._read_packet()
File "---_env.Linux/lib64/python3.5/site-packages/paramiko/sftp.py", line 205, in _read_packet
raise SFTPError("Garbage packet received")
paramiko.sftp.SFTPError: Garbage packet received 
```

原因是 bash 不是与用户登录关联的默认 shell。使用永久更改用户的默认外壳`chsh -s /bin/bash <user>`解决了该问题。*

# objective-c - 如果您将自动释放对象标记为自动释放会发生什么

> ID：12486624
> 
> 赞同：7
> 
> 时间：2012-09-18T23:40:51.720
> 
> 标签：objective-c, ios, memory-management, autorelease

我的问题可能听起来很愚蠢，但我想知道如果我将自动释放的对象标记为自动释放会发生什么。会发布两次吗？还是什么都没发生？例如：

```
 Obj * obj = [[Obj create] autorelease]; 
```

假设`[Obj create]`返回一个自动释放的对象。
如果我添加另一个自动释放，那么会发生什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-09-18T23:44:56.100

是的，发送`autorelease`两次将释放对象两次。如果您的`create`方法返回一个自动释放的对象并且您向`autorelease`它发送另一条消息，您的应用程序将崩溃，因为您将释放一个已释放的对象。

话虽如此，您为什么不使用新的[自动引用计数（ARC）](http://developer.apple.com/library/ios/#releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html)？您不必再担心（自动）释放对象了。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2012-09-19T03:01:53.933

您使用类方法（+），您不应该关心内存。人们使用 Class Method 的一个原因是它可以返回一个自动释放对象。如果你释放或自动释放类方法返回的对象，它会崩溃。

# r - 读取不带小数点格式的毫秒刻度数据到动物园系列

> ID：12486625
> 
> 赞同：1
> 
> 时间：2012-09-18T23:41:01.903
> 
> 标签：r, indexing, zoo, financial, milliseconds

我正在尝试将一些 CSV 格式的金融报价数据（来源：[HISTDATA_COM_ASCII_EURUSD_T_201209.zip](http://www.histdata.com/download-free-forex-historical-data/?/ascii/tick-data-quotes/eurusd/2012/9)）读入动物园系列。数据由一个时间列索引，该列包含格式为的时间戳，例如`20120902 170010767`- 几乎像，`%Y%m%d %H%M%OS3`除了毫秒不按`%OS3`.

我试图通过将时间戳的后（右）一半除以 1000 并再次粘贴在一起来强制要求小数点：

```
FUN <- function(i, format)  {
    sapply(strsplit(i, " "), function(j) strptime(paste(j[1], as.numeric(j[2])/1000), format = format))
}
read.zoo(file, format = "%Y%m%d %H%M%OS3", FUN = FUN, sep = ",") 
```

但是，这并没有奏效-有人可以说明如何最好地正确执行此操作吗？

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:00:37.373

你显然可以把它缩短，但这很好地给出了这个想法：

```
> tm <- "20120902 170010767"    
> gsub("(^........\\s......)(.+$)", "\\1.\\2", tm)
[1] "20120902 170010.767"
> strptime( gsub("(^........\\s......)(.+$)", "\\1.\\2", tm), "%Y%m%d %H%M%OS")
[1] "2012-09-02 17:00:10.767" 
```

# push-notification - 多用户应用程序中推送通知的最佳实践？

> ID：12486626
> 
> 赞同：11
> 
> 时间：2012-09-18T23:41:02.283
> 
> 标签：push-notification, push, apple-push-notifications, google-cloud-messaging

我正在研究一种需要支持允许多个用户的应用程序的推送架构。这意味着多个用户可以使用他们的凭据登录应用程序。我遇到的问题是，如果用户 A 允许推送通知，然后注销，然后用户 B 登录并开始获取用户 A 的推送通知，该怎么办？

处理此类事情的一些最佳实践是什么？我的一个想法是你可以记住最后一个登录的用户，并且只向“登录”用户显示推送通知。您必须在消息有效负载中发送某种用户上下文，以便可以根据登录用户对其进行检查。然而，这感觉有点时髦。

还有其他人遇到过这个吗？这似乎是一个非常相关的问题，尤其是对于家庭倾向于共享设备的平板电脑。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-07-01T12:09:24.170

我们通过向 APSN 注册设备、获取设备令牌并通过 ws 将其发送到我们的服务器来实现这一点。

在服务器端，设备令牌仅与最后登录的用户相关联。

```
New app
User A (first ever user) uses IPAD A
Register with APSN, get token
Send token to our servers through ws
Search for token in db, token is new, store it
assign token to USER A

Next user logs into app
Register with APSN, get token
Send token to our servers through ws
Search for token in db, token exists already
Remove connection to USER A
assign token to USER B

SEND Notification to device WITH USERNAME
if username is logged in show it - else dont 
```

仍然不完美，因为它首先发送到主屏幕所以对所有用户

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-21T15:42:49.230

我认为您的建议在多用户应用程序中是可以接受的。在客户端实现这一点要比在服务器端简单得多。缺点是浪费了额外的带宽来发送不需要的通知。但是绝大多数的使用可能是单用户的，所以这可能并不重要。

另一种方法是跟踪服务器上的登录用户及其当前的 reg_id。这可能更复杂，因为 A 可以在多个设备上登录，然后从设备 1 注销，B 登录到设备 1，等等，您的服务器必须跟踪所有这些。所以可能是另一个表来跟踪“登录用户”与“注册 ID”之间的关系。

如果您讨厌发送不需要的通知，请使用服务器路由。如果您重视 Keep-It-Simple 原则，请选择客户路线。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-06-02T04:47:38.123

假设您的应用程序的用户可以登录多台设备。

我们必须在服务器端制作两个 API：

```
 func setUserDeviceNotifyToken(userId: Int, deviceToken: String) {}
    func removeUserDeviceNotifyToken(userId: Int, deviceToken: String {} 
```

在您的应用程序端，您必须`setUserDeviceNotifyToken`在每次登录时调用 API 并`removeUserDeviceNotifyToken`在每次注销时调用。

在服务器端，您可以跟踪每个用户`deviceNotificationToken`并发送正确设备的通知。

**注意**：如果您的服务不支持一个用户的多设备登录，您可以只处理一个`updateUserDeviceNotifyToken`并传递`null`删除用户的设备令牌。

**注意 2**`removeUserDeviceNotifyToken` ：在调用API之前不要让用户注销。

# objective-c - 图片不想拖

> ID：12486627
> 
> 赞同：4
> 
> 时间：2012-09-18T23:41:10.470
> 
> 标签：objective-c, cocoa, osx-lion

我正在关注 Aaron 为 Mac OS X 编写的 Cocoa 编程的第 23 章。
我必须从视图中拖动一个字母并将其复制到另一个应用程序中，例如文本编辑。
这是我发现问题的代码部分：

```
- (void) mouseDragged:(NSEvent *)theEvent
{
    NSPasteboard* pb=[NSPasteboard pasteboardWithName: NSDragPboard];
    NSPoint down=[mouseDownEvent locationInWindow];
    NSPoint drag=[theEvent locationInWindow],p;
    NSSize size=[string sizeWithAttributes: attributes];
    NSRect imageBounds;
    NSImage* image=[NSImage alloc];
    float distance;
    distance= hypot(down.x-drag.x, down.y-drag.y);
    if(distance<3 || [string length]==0)
    return;
    image=[image initWithSize: size];
    imageBounds.origin=NSZeroPoint;
    imageBounds.size=size;
    [image lockFocus];
    [self drawStringCenteredIn: imageBounds];
    [image unlockFocus];
    p=[self convertPoint: down fromView: nil];
    p.x= p.x - size.width/2;
    p.y= p.y - size.height/2;
    [self writeToPasteboard: pb];
    [self dragImage: image at: p offset: NSZeroSize event: mouseDownEvent pasteboard: pb source: self slideBack: YES];
} 
```

其中：
- mouseDownEvent 是先前保存的事件，当用户单击讲台时（mouseDown 事件）；
- string 是一个 NSMutableAttributesString，一个最大 1 个 lected 的字符串，包含要显示到视图中的 lecter；

当事件发生时，视图上已经显示了一个字母（因此字符串的长度为 1）。如果我忘记了一些重要信息，请询问。

问题：拖放操作工作正常，但问题是当我拖动图像时，我没有看到图像从其原始位置移位。
这是我在拖动字母时看到的：

![在此处输入图像描述](../Images/0bda33288ad623ae5ecfb47f5c8f90a6.png)

这是我应该看到的：

![在此处输入图像描述](../Images/9b87c04ff0693d185a0873ee8fcbcf79.png)

所以字母应该会移位，但这不会发生。我不认识这个问题的原因，我认为方法drawImageCenteredIn应该可以正常工作。这是这个方法的代码：

```
- (void) drawStringCenteredIn: (NSRect) rect
{
    NSSize size=[string sizeWithAttributes: attributes];
    NSPoint origin;
    origin.x= rect.origin.x+ (rect.size.width+size.width)/2;
    origin.y=rect.origin.y + (rect.size.height+size.height)/2;
    [string drawAtPoint: origin withAttributes: attributes];
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-21T14:58:38.583

这很简单。这两行中的符号不​​正确：

```
 origin.x= rect.origin.x+ (rect.size.width-size.width)/2;
  origin.y= rect.origin.y + (rect.size.height-size.height)/2; 
```

以下是更正的方法：

```
- (void) drawStringCenteredIn: (NSRect) rect
{
    NSSize size=[string sizeWithAttributes: attributes];
    NSPoint origin;
    origin.x= rect.origin.x+ (rect.size.width-size.width)/2;
    origin.y= rect.origin.y + (rect.size.height-size.height)/2;
    [string drawAtPoint: origin withAttributes: attributes];
} 
```

# python - Python PyAudio 安装问题（使用 PortAudio）

> ID：12486628
> 
> 赞同：11
> 
> 时间：2012-09-18T23:41:30.823
> 
> 标签：python, windows-7, installation, portaudio, pyaudio

我正在尝试编写一个程序来记录来自我的计算机麦克风的信息并将其保存到文件中。`PyAudio`似乎是执行此操作的更好的软件包之一，它们甚至有一个适用于 Windows 7 (Python 2.7) 的二进制文件。我下载了可执行文件并运行它来设置 PyAudio，但是当我现在尝试将 PyAudio 导入 python 脚本时出现错误：

```
Please build and install the PortAudio Python bindings first.

Traceback (most recent call last):
  File "<pyshell#0>", line 1, in <module>
    import pyaudio
  File "C:\Python27\lib\site-packages\pyaudio.py", line 103, in <module>
    sys.exit(-1)
SystemExit: -1 
```

如果我查看 pyaudio.py，它失败的代码是：

```
# attempt to import PortAudio
try:
    import _portaudio as pa
except ImportError:
    print "Please build and install the PortAudio Python " +\
          "bindings first."
    sys.exit(-1) 
```

此外，如果它是相关的，如果我去`Python27\Lib\site-packages`（pyaudio.py 所在的位置），有一个名为`portaudio_x64.dll`.

他们网站上的文档似乎仅包含有关是否要通过从源代码构建来安装 PyAudio 的说明。此外，它说 PortAudio v19 包含在二进制文件中，所以我认为它只会在运行 setup 可执行文件后工作。

我不知道出了什么问题，我真的需要尽快运行它。关于出了什么问题的任何想法？或者，如果有人对专门用于 Windows 7（64 位）和 Python 2.7（Enthought 发行版）以及跨平台的类似软件包提出建议，我很想听听。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-10-10T04:57:32.957

复制评论中的答案，以便从“未回答”过滤器中删除此问题：

> 尝试来自[http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio的二进制文件](http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio)

〜回答每个[cgohlke](https://stackoverflow.com/users/453463/cgohlke)

# xcode - 使用 Xcode 4.4 为 Snow Leopard 构建 mac 应用程序

> ID：12486632
> 
> 赞同：1
> 
> 时间：2012-09-18T23:41:57.550
> 
> 标签：xcode, osx-snow-leopard, osx-mountain-lion

新手问题我知道...但是我可以使用 Xcode 4.4 的 Mountain Lion 版本为 Snow Leopard 构建应用程序吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-18T23:44:46.790

是的你可以。您始终可以使用低于当前版本的预期目标版本构建程序（只要仍然支持旧版本）。

# java - 小程序问题：java.lang.NoClassDefFound

> ID：12486633
> 
> 赞同：1
> 
> 时间：2012-09-18T23:42:10.200
> 
> 标签：java, applet, japplet

我在使用适用于 u.are.u 4500 生物识别指纹读取器的 SDK 的小程序上遇到了一些问题。
当我使用 NetBeans 在本地测试小程序时，小程序工作正常。 ![小程序测试。 当地的](../Images/af6254a659cc8d00de579c4783d8e8eb.png)

问题是当我尝试发布小程序时。 ![小程序网络测试。 错误详情](../Images/40ce230fb0f94f3f1c320be8813555bc.png)

我总是得到“ **java.lang.NoClassDefFound** ”。我修改了 java 配置，以便服务器配置和我的工作站配置匹配。

SDK安装在**c:\java\jdk1.7.0_07**
JRE安装在**c:\java\jre7** ![在此处输入图像描述](../Images/0b3decd3fef307ba82965d15d73b419f.png)

生物指纹识别器的 jar 文件是：

*   dpfpenrollment.jar
*   dpfpverification.jar
*   dpotapi.jar
*   dpotjni.jar

类路径是：

```
C:\Java\jdk1.7.0_07\jre\lib\ext;
C:\Java\jdk1.7.0_07\jre\lib\ext\mysql-connector-java-5.1.22-bin.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpfpenrollment.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpfpverification.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpotapi.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpotjni.jar; 
```

JAVA_HOME 是：

```
c:\java\jre7 
```

我试过把jar文件放在lib文件夹下，放出来的结果是一样的。我用谷歌搜索了这个错误，但我发现没有任何东西可以帮助我解决这个问题。

任何帮助表示赞赏...
谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:53:54.737

> 类路径是：

```
C:\Java\jdk1.7.0_07\jre\lib\ext;
C:\Java\jdk1.7.0_07\jre\lib\ext\mysql-connector-java-5.1.22-bin.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpfpenrollment.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpfpverification.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpotapi.jar;
C:\Java\jdk1.7.0_07\jre\lib\ext\dpotjni.jar; 
```

不不不。正如 EJP 所提到的，这不是`ext`目录的用途。此外，最终用户的目录中不会有这些 Jars `ext`，即使有，它们也不会被添加到小程序的运行时类路径中。

如果小程序需要这些罐子，则需要将它们放在服务器上可访问的路径中，而`codebase`应该指向该位置，并且`archive`属性可能类似于：

```
archive='mysql-connector-java-5.1.22-bin.jar,dpfpenrollment.jar,dpfpverification.jar,dpotapi.jar,dpotjni.jar' 
```

MySQL jar 也有点令人担忧。小程序不应该直接访问数据库，而是应该通过服务器端功能来调节访问。如果您的小程序可以访问数据库，恶意用户可以对其进行逆向工程并直接访问数据库。

# android - Android MCC/MNC显示错误值

> ID：12486635
> 
> 赞同：2
> 
> 时间：2012-09-18T23:42:25.777
> 
> 标签：android

所以我使用[https://stackoverflow.com/a/890945/761670](https://stackoverflow.com/a/890945/761670)中描述的方法来检查我的应用程序中的 MCC 和 MCC。我得到了 MCC=134 和 MNC=38，但这完全不是我在美国使用 Cricket 无线电话所期望的……看着@ [http://en.wikipedia.org/wiki/Mobile_Network_Code#U](http://en.wikipedia.org/wiki/Mobile_Network_Code#U)，我预期 310 和 16 - 我做错了什么还是 Wiki 页面错了？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-05-01T21:34:26.107

这是一个老问题，但答案会对我有所帮助——终于找到了。

在您引用的 SO 问题中，代码获取的是“塔式运营商”而不是 SIM 运营商。

所以这一行：

```
String networkOperator = tel.getNetworkOperator(); 
```

应该是这样的：

```
String networkOperator = tel.getSimOperator(); 
```

因为很可能板球（在你的情况下）不是塔运营商......

# python - 从 numpy zero recarray 创建/附加时，额外的记录出现在 pytable 表中

> ID：12486637
> 
> 赞同：1
> 
> 时间：2012-09-18T23:42:42.183
> 
> 标签：python, numpy, pytables

（本题已被原作者修改，示例代码已修改，以便您可以在自己的机器上运行）

我正在将时间序列数据加载到 pytables 中（在这个测试用例中，大约 200 万行，23 列主要是浮点值）。我还想在同一个 pytable 文件中创建一个相应的表，该表具有相同的行数和列数以及列名，但使用 int8 数据类型作为质量控制“掩码”。为此，我从数据表中检索列名和行计数信息，并使用它来创建用于创建/附加到质量控制 pytable 表的 numpy 零记录数组。

当我将 numpy 零记录数组附加到新的“掩码”pytable 时，就会出现问题。即使用于创建/附加到 pytable 的 numpy 零记录数组是正确的大小 - 生成的 pytable 比预期的要大得多 - pytable 中的更多行然后已从 numpy recarray 附加。

以下可运行的示例代码演示了该问题。它创建了一个 pytable 并将 numpy 零重新数组附加到表中，期望创建一个表，其中包含“nrows”的零值记录。使用 Vitables 查看时，生成的 pytable 的行数比预期的多

我不确定这些额外的数据行来自哪里？任何建议，将不胜感激。

使用 python 2.7.2、pytables 2.3.1、numpy 1.6.1.1

```
import tables 
import numpy as np
import string as str

Storename   = 'Test.h5'
Storetitle  = 'Test'
PathList    = ['Lvl0','Lvl1']
Tablename   = 'Data'

storeq = tables.openFile(Storename, mode='a', title= Storetitle)

for ix, agroup in enumerate(PathList):
   mypath0 =  '/'+str.strip('/'.join(PathList[0:ix]))
   mypath1 =  '/'+str.strip('/'.join(PathList[0:ix+1]))      
   try:  
      storeq.getNode(mypath1)
   except(tables.exceptions.NoSuchNodeError):        
      storeq.createGroup(mypath0,PathList[ix]) 

pathq = mypath1
qtable = None  

tfields = ['DateTime','f0','f1','f2','f3','f4','f5','f6','f7','f8','f9']
nfields = 11

tformats = ['int64', 'int8', 'int8', 'int8', 'int8', 'int8', 
            'int8', 'int8', 'int8', 'int8', 'int8']

nrows = 2122387
rowchunk = 100000
rowsteps, rowrem = divmod(nrows, rowchunk)

for ix in range(rowsteps):        
  fillarray = np.zeros((rowchunk,nfields), {'names': tfields, 'formats': tformats})
  if qtable==None:
      print('create')      
      qtable    = storeq.createTable(pathq, Tablename, fillarray)       
      qtable.flush()
  else:
      print('append :', ix, fillarray.shape)  
      qtable.append(fillarray)
      qtable.flush()

if rowrem > 0:
  fillarray = np.zeros((rowrem,nfields), {'names': tfields, 'formats': tformats})
  if ix == 0:
     print('create')      
     qtable  = storeq.createTable(pathq,Tablename, fillarray)       
     qtable.flush()
  else:
     print('append :', rowrem, fillarray.shape)  
     qtable.append(fillarray)
     qtable.flush()

qtable.close()
storeq.close() 
```

以下是将 numpy 零重新数组写入质量控制 pytable 时创建的打印语句输出。

```
create
('append :', 1, (100000, 26))
('append :', 2, (100000, 26))
('append :', 3, (100000, 26))
('append :', 4, (100000, 26))
('append :', 5, (100000, 26))
('append :', 6, (100000, 26))
('append :', 7, (100000, 26))
('append :', 8, (100000, 26))
('append :', 9, (100000, 26))
('append :', 10, (100000, 26))
('append :', 11, (100000, 26))
('append :', 12, (100000, 26))
('append :', 13, (100000, 26))
('append :', 14, (100000, 26))
('append :', 15, (100000, 26))
('append :', 16, (100000, 26))
('append :', 17, (100000, 26))
('append :', 18, (100000, 26))
('append :', 19, (100000, 26))
('append :', 20, (100000, 26))
('append :', 22387, (22387, 26)) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-08-22T05:53:38.463

鉴于问题的年龄，我想作者已经有了答案......但以防万一，这是我的（未经测试）：

在示例代码的第 45 行，您创建了一个 shape 的结构化数组`(rowchunk, nfields)`：这是错误的，因为结构化数组必须是 1D（行数），字段的数量、名称和格式由`dtype`参数设置。

因此你应该使用类似的东西

```
fillarray = np.zeros(rowchunk, dtype={'names': tfields, 'formats': tformats}) 
```

# postgresql - 多租户 PostgreSQL 数据库中全文搜索的索引策略

> ID：12486642
> 
> 赞同：4
> 
> 时间：2012-09-18T23:43:10.277
> 
> 标签：postgresql, full-text-search, multi-tenant

我有一个 PostgreSQL 数据库，用于存储多个用户帐户的联系信息表（名字、姓氏）。每个联系人行都有一个用户 ID 列。建立索引以便用户可以搜索其联系人的名字或姓氏的*前几个字母的最高效的方法是什么？*

我知道传统的 b-tree 索引和特定于 PG 的 GIN 和 GiST，但我只是不确定它们如何（或不能）一起工作，以便只有几个联系人的用户不必搜索通过 user_id 过滤之前的所有联系人。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T01:24:35.340

您应该将帐户标识符添加为您创建的任何索引的第一列。这实际上将首先将搜索范围缩小到属于该帐户的行。对于 gist 或 gin 全文索引，您需要安装 btree_gist 或 btree_gin 扩展。

如果您只需要搜索第一个字母，最简单且可能最快的方法是使用支持两列文本操作并进行 2 次查找的常规 btree。您需要使用 text_pattern_ops opclass 来支持文本前缀查询和 lower() 字段以确保不区分大小写：

```
CREATE INDEX contacts_firstname_idx ON contacts(aid, lower(firstname) text_pattern_ops);
CREATE INDEX contacts_lastname_idx ON contacts(aid, lower(lastname) text_pattern_ops); 
```

查询将如下所示：

```
SELECT * FROM contacts WHERE aid = 123 AND
    (lower(firstname) LIKE 'an%' OR lower(lastname) LIKE 'an%') 
```

# java - 单链表删除 bool 方法

> ID：12486644
> 
> 赞同：1
> 
> 时间：2012-09-18T23:43:25.787
> 
> 标签：java, list, boolean, addremoveprograms

我正在尝试创建一个公共 bool remove(E element) 方法，该方法删除包含该元素的第一个节点，如果没有找到这样的节点，则返回 false 否则为 true ...我该怎么做？我无法将已删除节点的前任链接到其后继节点以缩小由节点删除造成的差距......这是我到目前为止的代码......谢谢

```
public class SinglyLinkedList<E> {
private final SLNode<E> head;
private final SLNode<E> tail;
int length;

// creates an empty list
public SinglyLinkedList() {
    head = new SLNode<E>();
    tail = new SLNode<E>();
    head.setSuccessor(tail);
    length = 0;
}

// adds new node on beginning of the list
public void add(E element) {
    SLNode<E> node = new SLNode<E>(element, null);
    node.setSuccessor(head.getSuccessor());
    head.setSuccessor(node);
}

// adds new node on beginning of the list
public void add(SLNode<E> node) {
    node.setSuccessor(head.getSuccessor());
    head.setSuccessor(node);
}

@Override
public String toString() {
    StringBuilder sb = new StringBuilder();
    SLNode<E> cursor = head.getSuccessor();
    while (cursor != tail) {
        sb.append(cursor.getElement()).append(" ");
        cursor = cursor.getSuccessor();
    }
    sb.append("\n");
    return sb.toString();
}
 } 
```

节点类

```
public class SLNode<E> {
private E element;
private SLNode<E> successor;

public SLNode() {
    element = null;
    successor = null;
}

public SLNode(E theElement, SLNode<E> theSuccessor) {
    element = theElement;
    successor = theSuccessor;
}

public E getElement() {
    return element;
}

public void setElement(E newElement) {
    element = newElement;
}

public SLNode<E> getSuccessor() {
    return successor;
}

public void setSuccessor(SLNode<E> newSuccessor) {
    successor = newSuccessor;
}
  } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T23:57:10.173

诀窍是在迭代时，您需要保留对前一个元素和当前元素的引用。对前一个元素的引用可以让您缩小差距：

```
public boolean remove(E element) {
    SLNode<E> previous = head;
    SLNode<E> current = head.getSuccessor();

    while (current != tail) {
        if (current.getElement().equals(element)) {
            previous.setSuccessor(current.getSuccessor());

            return true;
        }

        previous = current;
        current = current.getSuccessor();
    }

    return false;
} 
```

# dynamics-crm - MSCRM 2011 中的服务端点是什么？

> ID：12486645
> 
> 赞同：3
> 
> 时间：2012-09-18T23:43:26.323
> 
> 标签：dynamics-crm, dynamics-crm-2011

技术朋友，

MSCRM 2011 中的服务端点是什么？

当我在 MSCRM 2011 中打开一个解决方案时，我在左侧面板中看到一个单独的功能，名为“服务端点”。我没有找到很多相同的文档，以及我们如何添加新的服务端点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-20T09:07:22.020

名称端点来自[Enterprise Integration Patterns](http://www.eaipatterns.com/MessagingEndpointsIntro.html)。您可以通过它为您提供的用户界面使用 CRM，但还有其他选择。您自己的软件能够与 CRM 进行交互，就像与服务一样。交互通过消息进行，您的客户端软件发送到 CRM 服务。因此，在这种情况下，您正在使用的软件和 CRM 都将具有端点。您的软件将具有客户端端点，但 CRM 将具有服务器端点。我认为您不需要在 CRM 中添加新端点，因为已经定义了。只需使用它们从您的代码发送消息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-22T12:06:59.220

上面的答案似乎很有帮助，但这里是 MSDN 论坛中的回复，其中说端点是与 Windows Azure 集成所必需的。

关联：

[http://social.msdn.microsoft.com/Forums/en-US/crmdevelopment/thread/5fa85ef2-1f6e-44f6-9752-dea120f9d9d0](http://social.msdn.microsoft.com/Forums/en-US/crmdevelopment/thread/5fa85ef2-1f6e-44f6-9752-dea120f9d9d0)

# ruby-on-rails-3.2 - 邪恶 没有路线匹配

> ID：12486646
> 
> 赞同：0
> 
> 时间：2012-09-18T23:43:38.330
> 
> 标签：ruby-on-rails-3.2, rails-routing

我正在按照[A Wicked 示例](https://github.com/schneems/wicked/wiki/Building-Partial-Objects-Step-by-Step)构建我的向导，除了我首先在专用控制器中创建模型，然后保存重定向到步骤控制器，但我收到一个路由错误说：

```
No route matches {:action=>"show", :controller=>"needs_personals/steps"} 
```

重定向代码如下所示：

```
redirect_to needs_personal_step_path, :needs_personal_id => @needsPersonal.id 
```

我使用`needs_personal_step_path`是因为我的`rake routes`输出是：

```
 needs_personal_steps GET    /needs_personals/:needs_personal_id/steps(.:format)          needs_personals/steps#index
                         POST   /needs_personals/:needs_personal_id/steps(.:format)          needs_personals/steps#create
 new_needs_personal_step GET    /needs_personals/:needs_personal_id/steps/new(.:format)      needs_personals/steps#new
edit_needs_personal_step GET    /needs_personals/:needs_personal_id/steps/:id/edit(.:format) needs_personals/steps#edit
     needs_personal_step GET    /needs_personals/:needs_personal_id/steps/:id(.:format)      needs_personals/steps#show
                         PUT    /needs_personals/:needs_personal_id/steps/:id(.:format)      needs_personals/steps#update
                         DELETE /needs_personals/:needs_personal_id/steps/:id(.:format)      needs_personals/steps#destroy 
```

在路由文件中我有这个：

```
resources :needs_personals do
  resources :steps, controller: 'needs_personals/steps'
end 
```

如果我输入指向浏览器的路径，它就可以工作`/needs_personals/90/steps`

谢谢。

**2012 年 9 月 29 日更新**

我相信我已经弄清楚了这样做的原因并实施了解决方法。我认为这是因为与 id 参数混淆而发生的。尽管通过`needs_personal_id`了，但似乎将 id 视为链接的最后一个参数，而不是中间 id。

我的解决方法只是将它指向实际的字符串 url：

```
redirect_to "/needs_personals/#{@needsPersonal.id}/steps" 
```

这很好用。虽然很想知道如何以正确的方式做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-10-05T19:35:05.530

我认为这就是你要找的：

```
redirect_to needs_personals_steps_path(@needsPersonal.id, :first_step) 
```

其中 :first_step 是第一个向导步骤的符号。

# javascript - 使用 Jquery 获取正确的文档高度

> ID：12486647
> 
> 赞同：0
> 
> 时间：2012-09-18T23:44:26.393
> 
> 标签：javascript, jquery

晚安/晚安

一个小而烦人的 jquery 问题。我想得到我的文件的高度。为此，我使用以下代码：

```
$docHeight = $(document).height(); 
```

当我以正常方式访问我的页面时（通过单击其他页面上的 href），我得到了正确的文档高度。（约 4000 像素）。但是当我刷新时，我得到了 windowheight (1037px)。有什么办法可以避免/解决这个问题？

恭喜，

W。

****解决方案****

$(window).load(function({...}); 成功了。我的图像（所以 imageheight 也是）没有加载 document.ready，只有标签。window.load 加载整个页面的高度等，这给了我正确的文档高度。

# asp.net-mvc - 为 MVC 会话扩展 Azure ACS 声明

> ID：12486649
> 
> 赞同：0
> 
> 时间：2012-09-18T23:44:37.297
> 
> 标签：asp.net-mvc, asp.net-mvc-4, azure, acs, iprincipal

我正在开发要在 Azure 中托管的 MVC 4 应用程序，并希望使用他们的 ACS 服务进行身份验证。用户通过身份验证后，我将使用生成的索赔详细信息与我的本地记录相关联。在此之后，我想扩展声明集以包括代表本地授权的其他声明，我的应用程序将用于授权决策。我假设我需要替换 Principle，但我不确定在 MVC 中的何处/何时执行此操作，并且希望避免破坏通常在整个会话生命周期中使用的任何身份验证管道。任何人都可以对此有所了解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T01:32:13.220

WIF 中用于丰富声明集的扩展点是[ClaimsAuthenticationManager](http://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimsauthenticationmanager.aspx)

从文档：

> 声明身份验证管理器在 RP 处理管道中提供了一个可扩展点，您可以使用它在调用 RP 应用程序之前过滤、修改或将新声明注入到由 IClaimsPrincipal 提供的声明集中。

您还可以在 ACS 中添加规则，以使用您需要的声明来丰富令牌。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T06:42:45.177

除了@Eugenio Pace 所说的之外，值得注意的是，您可以在以下位置添加和删除声明`IClaimsPrincipal`：

```
public static void UpdateClaims(IClaimsIdentity identity)
{
    identity.Claims.Remove(identity.Claims.SingleOrDefault(x => x.ClaimType == ClaimTypes.Name));
    identity.Claims.Remove(identity.Claims.SingleOrDefault(x => x.ClaimType == ClaimTypes.Email));
    identity.Claims.Add(new Claim(ClaimTypes.Name, "Steve Smith"));
    identity.Claims.Add(new Claim(ClaimTypes.Email, "steve@smith.com"));
}

UpdateClaims(User.Identity as IClaimsIdentity); 
```

添加的声明可以是 中枚举的类型之一，也可以是`ClaimTypes`您自己设计的自定义字符串。您可以添加多个类型的声明`ClaimTypes.Role`- 我不确定其他类型。

从`ClaimsCollection`文档：

> 表示与单个主题相关联的声明集合。
> 
> 通过调用 SetSubject 方法，将声明添加到 ClaimCollection 隐式地将该声明与与该集合关联的主题相关联。
> 
> 通过调用 SetSubject 方法，从 ClaimCollection 中移除 Claim 会隐式移除此关联。

[http://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimcollection.aspx](http://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimcollection.aspx)

**更新**

对于 .Net 4.5，身份类和更新声明的方法以及命名空间都发生了变化：

```
using System.IdentityModel;
using System.Security.Claims;

public static void UpdateClaims(Member member, ClaimsIdentity identity)
{
    identity.RemoveClaim(identity.Claims.SingleOrDefault(x => x.Type == ClaimTypes.Name));
    identity.RemoveClaim(identity.Claims.SingleOrDefault(x => x.Type == ClaimTypes.Email));
    identity.AddClaim(new Claim(ClaimTypes.Name, "Steve Smith"));
    identity.AddClaim(new Claim(ClaimTypes.Email, "steve@smith.com"));
}

UpdateClaims(User.Identity as ClaimsIdentity); 
```

[http://msdn.microsoft.com/en-us/library/system.security.claims.claimsidentity.aspx](http://msdn.microsoft.com/en-us/library/system.security.claims.claimsidentity.aspx)

# java - 除了 SimpleDateFormat，如何在时间设置上增加一个小时？

> ID：12486652
> 
> 赞同：1
> 
> 时间：2012-09-18T23:45:09.343
> 
> 标签：java, android, eclipse, simpledateformat

我有一个显示当前时间的开始按钮，我希望能够有一个停止时间比当前时间晚一小时的按钮。我该怎么做呢？

这是显示当前时间的按钮的代码

```
Button stopButton = (Button) this
            .findViewById(R.id.StartTrackingEditStopTime_button);
    // using SimpleDateFormat class
    SimpleDateFormat sdfStopTime = new SimpleDateFormat("hh:mm:ss a",
            Locale.ENGLISH);
    String newStoptime = sdfStopTime
            .format(new Date(System.currentTimeMillis()));

    stopButton.append(newStoptime); 
```

非常感谢您提供有关如何执行此操作的任何帮助或建议。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-09-19T02:27:38.763

您设置`new Date(System.currentTimeMillis())`当前时间的方式是采用精确的当前毫秒并从中确定日期。如果您坚持使用毫秒，您需要做的是添加一个小时的毫秒或 1000 * 60 * 60 = 3600000。

因此，您可以通过以下确切代码满足您的需求的**方式#1 ：**

```
Button stopButton = (Button) findViewById(R.id.StartTrackingEditStopTime_button);

SimpleDateFormat sdfStopTime = new SimpleDateFormat("hh:mm:ss a", Locale.ENGLISH);

String newStoptime = sdfStopTime.format(
        new Date(System.currentTimeMillis() + 3600000));

stopButton.setText(newStopTime); 
```

这将起作用。**实现这一点的方法#2**，如果您系统地处理时间，它很有用，是使用 Calendar 对象。为此，请将上面的第三行替换为以下代码：

```
Calendar c = Calendar.getInstance();
c.add(Calendar.HOUR, 1);
Date d = c.getTime();
String newStopTime = sdfStopTime.format(d); 
```

希望这可以帮助！你的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-18T23:54:57.077

这将所有内容都保存在 SimpleDateFormat 中。无需创建额外的对象。

```
SimpleDateFormat sdfStopTime = new SimpleDateFormat("hh:mm:ss a", Locale.ENGLISH);

System.out.println("Before: " + sdfStopTime.getCalendar().getTime());

sdfStopTime.getCalendar().add(Calendar.HOUR, 1);

System.out.println("After: " + sdfStopTime.getCalendar().getTime()); 
```

add() 方法的第一个参数是字段、小时、分钟等。第二个参数是要添加的量，如果为负，则减去。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-18T23:48:43.797

使用`Calendar`类（[javadoc](http://docs.oracle.com/javase/6/docs/api/java/util/Calendar.html)）。假设您已经有一个`Date now`：

```
Calendar calendar = Calendar.getInstance();
calendar.setTime(now);
calendar.add(Calendar.HOUR, 1);
Date inAnHour = calendar.getTime();

// format inAnHour with your DateFormat and set a button label 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-18T23:51:09.043

您必须在当前时间上增加一小时。

```
// You don't have to put System.currentTimeMillis() to the constructor.
// Default constructor of Date gives you the current time.
Date stopTime = new Date();
stopTime.setHours(stopTime.getHours() + 1);
String newStoptime = sdfStopTime.format(stopTime);
stopButton.append(newStoptime); 
```

如果您不想使用已弃用的函数`setHours`and `getHours`，请使用`setTime`and`getTime`并将 3,600,000 毫秒（1 小时）添加到当前时间：

```
stopTime.setTime(stopTime.getTime() + 60 * 60 * 1000); 
```

代替

```
stopTime.setHours(stopTime.getHours() + 1); 
```

# git - git push 到现有的远程分支

> ID：12486653
> 
> 赞同：36
> 
> 时间：2012-09-18T23:45:12.000
> 
> 标签：git, git-push

如何将更改从本地 git 分支推送到现有的非主远程分支？如果我执行“git push”，它会尝试将所有本地分支中的更改推送到它们正在跟踪的远程。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2012-09-18T23:46:25.573

要做到这一点，您可以使用`refspec`，如[`git push`文档](https://www.kernel.org/pub/software/scm/git/docs/git-push.html)中所述。例如：

```
git push origin local_branch_name:remote_branch_name 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-09-18T23:54:04.153

如果分支已经存在于存储库中，它应该只是：

> git push origin 分支名称

# javascript - 检测客户端是否使用 HTML5 Youtube 播放器

> ID：12486655
> 
> 赞同：1
> 
> 时间：2012-09-18T23:45:14.850
> 
> 标签：javascript, youtube-api

在带有嵌入式 YouTube 播放器的页面上，是否可以判断正在使用哪个版本的播放器（HTML5 或 Flash）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-21T03:43:06.700

事实证明，您可以检查播放器上某些属性的存在/不存在。最明显的可能是`cueVideoByFlashvars`，所以你可以这样做：

`var isHtml5Player = !player.cueVideoByFlashvars;`

正如 Jeff 提到的那样，不得不依赖它并不是很好，因为它随时可能发生变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T21:42:20.830

没有用于确定该信息的受支持 API，而且不太可能添加一个。

虽然我确信有一些 hack 可以利用 AS3 和 HTML5 视频在响应某些 API 调用的方式上的细微差异，或者找到一种检查 DOM 的方法，但我不建议编写任何脆弱的东西进入生产质量的应用程序。

# c# - Windows 8 Windows 商店应用程序中的中继命令

> ID：12486659
> 
> 赞同：7
> 
> 时间：2012-09-18T23:45:38.920
> 
> 标签：c#, xaml, mvvm, windows-8

是否有 RelayCommand 版本，因为 CommandManager 在 win8 Metro 应用程序中不可用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:49:42.897

[这里](https://xp-dev.com/svn/mytoolkit/Shared/MVVM/RelayCommand.cs)有一个版本。

```
using System;
using System.Diagnostics;

#if METRO
using Windows.UI.Xaml.Input;
using System.Windows.Input;
#else
using System.Windows.Input;
#endif

namespace MyToolkit.MVVM
{
#if METRO
    public class RelayCommand : NotifyPropertyChanged, ICommand
#else
    public class RelayCommand : NotifyPropertyChanged<RelayCommand>, ICommand
#endif
    {
        private readonly Action execute;
        private readonly Func<bool> canExecute;

        public RelayCommand(Action execute)
            : this(execute, null) { }

        public RelayCommand(Action execute, Func<bool> canExecute)
        {
            if (execute == null)
                throw new ArgumentNullException("execute");

            this.execute = execute;
            this.canExecute = canExecute;
        }

        bool ICommand.CanExecute(object parameter)
        {
            return CanExecute;
        }

        public void Execute(object parameter)
        {
            execute();
        }

        public bool CanExecute 
        {
            get { return canExecute == null || canExecute(); }
        }

        public void RaiseCanExecuteChanged()
        {
            RaisePropertyChanged("CanExecute");
            if (CanExecuteChanged != null)
                CanExecuteChanged(this, new EventArgs());
        }

        public event EventHandler CanExecuteChanged;
    }

    public class RelayCommand<T> : ICommand
    {
        private readonly Action<T> execute;
        private readonly Predicate<T> canExecute;

        public RelayCommand(Action<T> execute)
            : this(execute, null)
        {
        }

        public RelayCommand(Action<T> execute, Predicate<T> canExecute)
        {
            if (execute == null)
                throw new ArgumentNullException("execute");

            this.execute = execute;
            this.canExecute = canExecute;
        }

        [DebuggerStepThrough]
        public bool CanExecute(object parameter)
        {
            return canExecute == null || canExecute((T)parameter);
        }

        public void Execute(object parameter)
        {
            execute((T)parameter);
        }

        public void RaiseCanExecuteChanged()
        {
            if (CanExecuteChanged != null)
                CanExecuteChanged(this, new EventArgs());
        }

        public event EventHandler CanExecuteChanged;
    } 
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:49:51.860

如果 Metro 中提供了 ICommand，则没有实现，尽管有几个版本可用，例如[CodeProject](http://www.codeproject.com/Articles/319855/Attached-Command-for-Windows-8-Metro-Style-in-C)上的这个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-05T03:34:45.323

Prism for Windows Store 应用程序现在可用，其中包含 DelegateCommand（实现 ICommand）以及 OnPropertyChanged 的​​实现。

# wpf - WPF：用户控件的命令和命令参数

> ID：12486660
> 
> 赞同：2
> 
> 时间：2012-09-18T23:45:42.873
> 
> 标签：wpf, user-controls, wpf-controls, prism

我正在创建一个自定义`UserControl`，并希望 UC 拥有一个`Command`与`Button`. 我是 WPF 的新手。

这是我到目前为止没有任何运气的尝试：

**WelcomeView.xaml**

```
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="150"/>
    </Grid.RowDefinitions>

    <Controls:SignedButton Grid.Row="1" VerticalAlignment="Top" Width="245" Height="45" Foreground="#FFFFFF" 
                           LeftSign="+" Text="Add an account" TextSize="20" 
                           ButtonBackground="#3A5795" HoverBackground="#C41AD7" HoverOpacity="1"
                           Command="{x:Static Infrastructure:ApplicationCommands.NavigateCommand}" 
                           CommandParameter="{x:Type Views:AddAccountView}"/>
</Grid> 
```

**签名按钮.xaml.cs**

```
public partial class SignedButton : UserControl
{

    public static DependencyProperty ButtonBackgroundProperty =
        DependencyProperty.Register("ButtonBackground", typeof (string), typeof (SignedButton));

    public static DependencyProperty CommandParameterProperty =
        DependencyProperty.Register("CommandParameter", typeof (object), typeof (SignedButton));

    public static DependencyProperty CommandProperty =
        DependencyProperty.Register("Command", typeof (ICommand), typeof (SignedButton));

    public static DependencyProperty HoverBackgroundProperty =
        DependencyProperty.Register("HoverBackground", typeof (string), typeof (SignedButton));

    public static DependencyProperty HoverOpacityProperty =
        DependencyProperty.Register("HoverOpacity", typeof (double), typeof (SignedButton));

    public static DependencyProperty LeftSignProperty =
        DependencyProperty.Register("LeftSign", typeof (string), typeof (SignedButton));

    public static DependencyProperty RightSignProperty =
        DependencyProperty.Register("RightSign", typeof (string), typeof (SignedButton));

    public static DependencyProperty TextProperty =
        DependencyProperty.Register("Text", typeof (string), typeof (SignedButton));

    public static DependencyProperty TextSizeProperty =
        DependencyProperty.Register("TextSize", typeof (double), typeof (SignedButton));

    public SignedButton()
    {
        InitializeComponent();
    }

    public string ButtonBackground
    {
        get { return (string) GetValue(ButtonBackgroundProperty); }
        set { SetValue(ButtonBackgroundProperty, value); }
    }

    public ICommand Command
    {
        get { return (ICommand) GetValue(CommandProperty); }
        set { SetValue(CommandProperty, value); }
    }

    public object CommandParameter
    {
        get { return GetValue(CommandParameterProperty); }
        set { SetValue(CommandParameterProperty, value); }
    }

    public string HoverBackground
    {
        get { return (string) GetValue(HoverBackgroundProperty); }
        set { SetValue(HoverBackgroundProperty, value); }
    }

    public double HoverOpacity
    {
        get { return (double) GetValue(HoverOpacityProperty); }
        set { SetValue(HoverOpacityProperty, value); }
    }

    public string LeftSign
    {
        get { return (string) GetValue(LeftSignProperty); }
        set { SetValue(LeftSignProperty, value); }
    }

    public string RightSign
    {
        get { return (string) GetValue(RightSignProperty); }
        set { SetValue(RightSignProperty, value); }
    }

    public string Text
    {
        get { return (string) GetValue(TextProperty); }
        set { SetValue(TextProperty, value); }
    }

    public double TextSize
    {
        get { return (double) GetValue(TextSizeProperty); }
        set { SetValue(TextSizeProperty, value); }
    }
} 
```

**签名按钮.xaml**

```
<UserControl x:Class="Client.Infrastructure.Controls.SignedButton"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="45" d:DesignWidth="245" 
             DataContext="{Binding RelativeSource={RelativeSource Self}}">
    <UserControl.Resources>
        <FontFamily x:Key="OpenSans">. . .</FontFamily>
        <Storyboard x:Key="OnMouseEnter">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="grid">
                . . .
            </DoubleAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="grid">
                . . .
            </ColorAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="OnMouseLeave">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="grid">
                . . .
            </DoubleAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="grid">
                . . .
            </ColorAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Mouse.MouseEnter">
            . . .
        </EventTrigger>
        <EventTrigger RoutedEvent="Mouse.MouseLeave">
            . . .
        </EventTrigger>
    </UserControl.Triggers>
    <Grid x:Name="grid" Cursor="Hand" Background="{Binding ButtonBackground}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="50"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="50"/>
        </Grid.ColumnDefinitions>
        <TextBlock Text="{Binding LeftSign}" 
                   FontFamily="{DynamicResource OpenSans}" FontSize="{Binding TextSize}"
                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
        <TextBlock Text="{Binding Text}" 
                   FontFamily="{DynamicResource OpenSans}" FontSize="{Binding TextSize}"
                   HorizontalAlignment="Center" VerticalAlignment="Center" Grid.Column="1"/>
        <TextBlock Text="{Binding RightSign}" 
                   FontFamily="{DynamicResource OpenSans}" FontSize="{Binding TextSize}"
                   HorizontalAlignment="Center" VerticalAlignment="Center" Grid.Column="2"/>
    </Grid>
</UserControl> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-09-18T23:53:33.170

看起来您剩下的一步是将`ICommand`界面连接到控件的 UI。首先创建一个鼠标单击事件侦听器。

```
public SignedButton()
{
    InitializeComponent();
    this.MouseUp += new MouseButtonEventHandler(MyClassContent_MouseUp);
}

void MyClassContent_MouseUp(object sender, MouseButtonEventArgs e)
{
    Command.Execute(CommandParameter);
} 
```

您还需要监听实例`CanExecuteChanged`上的事件`Command`，以启用/禁用 UI 上的可点击指示器。

* * *

**脚注**从问题的范围来看，最好扩展 WPF[按钮](http://msdn.microsoft.com/en-us/library/system.windows.controls.button.aspx)控件而不是重新发明其各种功能。可以以[各种方式自定义其外观和行为](http://msdn.microsoft.com/en-us/library/ee230084.aspx)，同时仍然利用[视觉](http://ajdotnet.wordpress.com/2010/01/24/silverlight-bitspieces-the-first-steps-with-visual-state-manager/)状态（按下、活动、禁用等）和`ICommand`集成等核心功能。

# ruby-on-rails - embeds_one 在 Mongoid 中的作用是什么？

> ID：12486666
> 
> 赞同：4
> 
> 时间：2012-09-18T23:46:41.120
> 
> 标签：ruby-on-rails, ruby-on-rails-3, mongoid

我理解使用的概念，`embeds_many`但是`embeds_one`当您在嵌入式文档中只有一个字段时，特别是当您在 mongoid.org 上的 1-N 嵌入式文档示例中显示时，它的用途是什么？在父文档中创建一个字段不是更好吗？

mongoid.org 上的示例：

```
class Band
  include Mongoid::Document
  embeds_one :label
end

class Label
  include Mongoid::Document
  field :name, type: String
  embedded_in :band
end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T07:41:24.283

在示例中，他们给出了一个字段示例，只是为了显示定义结构。您可以在嵌入文档中引入多个字段。

当您不想存储在主文档中的嵌入文档中有多个字段时，使用 embeds_one。当某些字段不是所有文档都必须具有时，我们不会在主文档中引入，因为它会使文档变得沉重。取而代之的是，我们介绍了您可以根据主文档的要求创建的嵌入式文档。

# php - PHP - 提交按钮什么都不做

> ID：12486671
> 
> 赞同：-2
> 
> 时间：2012-09-18T23:47:11.820
> 
> 标签：php, email

我知道这已经被问过很多次了。但是我的提交按钮在我拥有的电子邮件脚本上不起作用。

```
<?php
if (isset($_REQUEST['email']))

 {

$email = $_REQUEST['email'] ;
$subject = $_REQUEST['subject'] ;
$message = $_REQUEST['message'] ;
mail("necro@gophobia.com", $subject,
$message, "From:" . $email);
echo "Thank you for using our mail form";
}
else
 {
 echo "<form method='post' action='http://cogameservers.com/home/contact'>
Email: <input name='email' type='text' /><br />
Subject: <input name='subject' type='text' /><br />
Message:<br />
<textarea name='message' rows='15' cols='40'>
</textarea><br />
<input type='submit' />
</form>";
}
?> 
```

感谢您的帮助=]

* * *

*编辑* 当我说提交按钮不起作用时。我的意思是它什么都不做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:01:06.750

[检查您的 HTML 源代码](http://validator.w3.org/check?verbose=1&uri=http%3A%2F%2Fcogameservers.com%2Fhome%2Fcontact)。它完全搞砸了：

*   还有第二个开始`<html>`标签
*   您`<head>`包含许多应该放置的代码行`<body>`（例如`<div id="loginmodal" class="reveal-modal">`）

浏览器尽最大努力克服错误，但有时当出现太多严重错误时它会丢失。

还有其他错误，请检查验证器输出的内容。修复您的 HTML 代码，检查验证器是否满意，然后再次尝试提交您的表单。

[这里](http://msdn.microsoft.com/en-us/library/ms537512%28v=vs.85%29.aspx)解释了条件注释的正确语法。在您的情况下，它应该是：

```
<!--[if gt IE 8]> <html class="no-js" lang="en"> <!<![endif]--> 
```

但是您当前的代码是：

```
<!--[if gt IE 8] <html class="no-js" lang="en"> <!--<![endif]--> 
```

无论如何，由于之前已经有一个开始`<html>`标签，它会导致错误：页面中只能有一个`<html>`标签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-18T23:55:33.080

联络线 45 有问题。在 Firebug 等浏览器调试器中使用并检查控制台。

# php - 我将如何构建一个像这样工作的简单 php 挂钩系统？

> ID：12486684
> 
> 赞同：6
> 
> 时间：2012-09-18T23:48:51.633
> 
> 标签：php

我试图找出一种方法来构建一个非常类似于 Drupal 使用的钩子系统。使用 Drupal，您可以简单地以某种方式命名一个函数，如果启用该模块，它将自动作为钩子调用。

我在 Stackoverflow 上查看了其他答案，但没有一个真正给出如何将这种类型的功能构建到 PHP 应用程序中的答案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-09-19T00:03:12.473

这就是drupal 的工作方式，以及您可以做到的方式。使用带有名称约定的字符串连接。使用 function_exists() 和 call_user_func_array() 你应该已经准备好了。

这里有两个内部的 drupal 函数，使技巧 (module.inc)

```
function module_invoke() {
     $args = func_get_args();
     $module = $args[0];
     $hook = $args[1];
     unset($args[0], $args[1]);
     $function = $module .'_'. $hook;
     if (module_hook($module, $hook)) {
     return call_user_func_array($function, $args);
  }
}

function module_hook($module, $hook) {
    return function_exists($module .'_'. $hook);
} 
```

因此，您只需要调用

```
module_invoke('ModuleName','HookName', $arg1, $arg2, $arg3); 
```

最终会调用

```
ModuleName_HookName($arg1,$arg2,$arg3); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-18T23:52:12.787

您可以使用 PHP[`get_defined_functions`](http://php.net/get_defined_functions)获取函数名称字符串数组，然后通过某种预定义格式过滤这些名称。

这个来自 PHP 文档的示例：

```
<?php
function myrow($id, $data)
{
    return "<tr><th>$id</th><td>$data</td></tr>\n";
}

$arr = get_defined_functions();

print_r($arr);
?> 
```

输出如下内容：

```
Array
(
    [internal] => Array
        (
            [0] => zend_version
            [1] => func_num_args
            [2] => func_get_arg
            [3] => func_get_args
            [4] => strlen
            [5] => strcmp
            [6] => strncmp
            ...
            [750] => bcscale
            [751] => bccomp
        )

    [user] => Array
        (
            [0] => myrow
        )

) 
```

与更明确的钩子系统相比，这是一种粗略的技术，但它确实有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-18T23:52:03.063

我不熟悉 Drupal 内部，但它可能使用反射来完成它：

[http://php.net/manual/en/book.reflection.php](http://php.net/manual/en/book.reflection.php)

您将包含包含挂钩函数的 PHP 页面，然后使用反射来查找与特定命名约定匹配的函数或类方法，然后保存函数指针以在适当的时候调用这些函数（例如模块生命周期中的事件）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-19T00:11:09.503

为什么不只使用函数存在？开发人员可以以某种方式命名函数，钩子代码只是检查它是否存在然后调用它们

# regex - 编写选择包含社会安全号码的行的正则表达式

> ID：12486685
> 
> 赞同：0
> 
> 时间：2012-09-18T23:48:53.983
> 
> 标签：regex

啊我在codelab中做正则表达式。它要求我“编写一个正则表达式，选择包含社会安全号码的行（纯九位数字形式，ddddddddd，或以标准方式用连字符分隔：ddd-dd-dddd）对于这个练习，你必须围绕你的带双引号的解决方案。”

我对其进行了编码，但它给了我错误提示“备注：问题：^\d{3}[-]？\d{2}[-]？\d{4}$ 接受：87231-6449”我该如何编码所以我会有 xxx-xx-xxxx

```
 "^\\d{3}[- ]?\\d{2}[- ]?\\d{4}$" 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:06:27.600

您当前的正则表达式`^\d{3}[- ]?\d{2}[- ]?\d{4}$`允许连字符或空格任意出现或不出现在指定的位置。它不强制所有连字符/空格必须全部出现或全部不出现。

如果你只想接受上面2种格式的社保，那么你可以使用这个正则表达式：

```
^(\d{3}-\d{2}-\d{4}|\d{9})$ 
```

添加字符串转义序列后：

```
"^(\\d{3}-\\d{2}-\\d{4}|\\d{9})$" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:06:38.210

`^\d{3}-?\d{2}-?\d{4}$`：所有连字符都是可选的。（允许所有有或没有连字符的组合）

`^(\d{3}-\d{2}-\d{4}|\d{9})$`: 只允许带连字符或不带连字符

# php - 运行 cron 作业时，“php -f”中的 -f 代表什么？

> ID：12486686
> 
> 赞同：6
> 
> 时间：2012-09-18T23:48:55.870
> 
> 标签：php, linux, cron, crontab

`"-f"`里面说什么

```
* * * * * php -f myscript.php 
```

代表？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-09-18T23:50:23.733

根据 PHP 命令行选项参考：[http://php.net/manual/en/features.commandline.options.php](http://php.net/manual/en/features.commandline.options.php)该`-f`选项指示 PHP 引擎应该执行哪个文件，在这种情况下为`myscript.php`.

# jquery - FancyBox 可以在特定的 div 中打开而不是在整个浏览器中打开吗？

> ID：12486688
> 
> 赞同：1
> 
> 时间：2012-09-18T23:49:12.453
> 
> 标签：jquery, fancybox

不确定这是否可能，但我想我会问。是否可以在另一个 div 中打开内容？目前 FancyBox 在整个浏览器的视口中打开内容，但我只希望它在特定的 div 中打开。

所以一个特定的用例，我有一个大图像，我想在大图像中显示较小的图像，而不是整个浏览器页面。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2016-01-29T20:38:38.243

不确定您是否已经找到解决此问题的方法，但我已经取得了一些进展。我使用的是 2.1.5 版本并且一直在编辑 jQuery 本身。我首先对“body”进行了搜索和替换，并将所有这些值更改为我希望在其中打开的指定 div。然后查找“F.helpers.overlay”行并找到选项“el : $('html'),”并将'html'更改为您指定的div。

它仍然在整个窗口中打开，但我目前正在调整 css，因为这就是此时控制其位置的原因。希望这个对你有帮助

编辑：好的，我已经弄清楚了！

所以我必须将“位置：相对”设置为我放置fancybox的div。然后我不得不添加这些样式“yourContainer .fancybox-overlay-fixed { position: absolute;}”来覆盖导致fancybox覆盖整个窗口的“固定定位”。如果您按照我上面输入的步骤以及我的编辑中的这些步骤进行操作，它应该对您有用！如果您有任何问题，请告诉我。

另外，我知道这个问题很老，但我敢肯定其他人会遇到这个寻找相同的解决方案。希望我对以后遇到这个问题的你们中的一些人有所帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-01-25T18:24:08.457

从 3.0 版开始，您可以声明要在哪个元素中注入 fancybox。

这是文档：[https ://www.luciadallas.com/js/fancybox3/docs/](https://www.luciadallas.com/js/fancybox3/docs/)

```
// Container is injected into this element
parentEl: "body", 
```

如果您希望将 fancybox 注入带有 class 的特定 div 中`product-menu`，请使用以下代码：

```
parentEl: ".product-menu" 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-09-18T23:56:46.810

嗯，FancyBox 有大量的选项和方法，所以只要有一些聪明的想法，你就可以完成这个。

但听起来你可以很容易地为这个用例自己制作一些东西，使用一些聪明的 jquery。

# android - 如何针对多核优化安卓应用

> ID：12486689
> 
> 赞同：5
> 
> 时间：2012-09-18T23:49:12.677
> 
> 标签：android, multithreading, optimization

随着具有多核的安卓手机的出现，应用程序开发人员如何确保他们的应用程序利用这些核的额外处理能力。据我了解，应用程序开发人员唯一能做的就是让他们的应用程序多线程，并让 android 内核负责将任务委托给不同的内核。

我想知道是否还有其他可以优化多核的方法。此外，android 中最好的多线程实践是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T04:01:02.917

与其尝试自己执行线程化，不如最好使用内置的范例，例如 AsyncTask。

如果你想

```
//Sets up a thread pool where NUM_THREADS is the amount that can run at the same time
ExecutorService threadPool = null;
threadPool = Executors.newFixedThreadPool(NUM_THREADS);

//Will execute something on one of the threads queuing if necessary
threadPool.execute(new Runnable() {
    @Override
    public void run() {

                      }}); 
```

通常网络调用和数据解析应该在单独的线程上完成

# mongodb - 将分片集群转换为复制分片集群

> ID：12486690
> 
> 赞同：1
> 
> 时间：2012-09-18T23:49:31.883
> 
> 标签：mongodb, replication, sharding

我已经使用 mongo 工作了几个星期，并在开发人员中构建了我的环境。我从单个节点开始，然后移动到一个分片集群，现在想移动到一个复制的分片集群。从我读到的复制碎片集群是最好的，可扩展性，持久性，性能提升等。

我已经阅读了他们帮助中的大多数（非常好的）教程。似乎他们的课程建议从单节点到副本集，再到分片副本集，不幸的是，这与我的做法相反。我似乎找不到任何东西可以将分片集群升级为复制分片集群。

这是我拥有的 5 台主机：

*   应用服务器
*   配置服务器
*   SHARD1
*   分片2
*   SHARD3

我启动了每个分片服务器：

```
mongod --shardsvr 
```

然后我启动了配置服务器：

```
mongod --configsvr 
```

然后我在 APPSERVER 上启动了 mongos 进程：

```
mongos --configdb CONFIGSERVER 
```

然后在 mongos 中，我添加了分片，在我的数据库上启用分片，并为集合定义了一个 shardkey：

```
sh.addShard("SHARD1:27018");//again for 2 and 3
sh.enableSharding("beacon");
sh.shardCollection("beacon.alpha2", {"ip":1}); 
```

我希望每个分片都复制到其他两个分片上。（对吗？）我是否需要关闭分片上的 mongod 进程并使用不同的 CL 参数重新启动它们？我需要在我的 mongos shell 中发出什么命令才能复制它？我应该导出所有数据、删除所有数据、重新启动并重新导入吗？同样，我看到了很多关于如何创建副本集的教程，但我并没有真正看到任何关于如何在分片系统开始时创建副本集的内容。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T01:28:01.150

对于每个分片，您需要重新启动当前成员并使用`--replset`命令行选项启动它和两个新成员（或 1 个新成员和一个仲裁器）。您可以添加更多的成员，但 3 是最低的可行集。然后从将成为新主节点的内部（例如您当前的 SHARD1），您可以执行以下操作：

```
rs.add("newmember1:port")
rs.add("newmember2:port")
rs.initiate(); 
```

然后，您需要检查并确保`sh.status()`已更新以反映副本集的新成员。在 2.2 中，这变得稍微容易一些，因为它应该是自动的，对于以前的版本，必须手动将分片信息保存在配置数据库中，这反映在 sharded cluster 下的文档中。如果它已被自动添加，您将在`sh.status()`输出中看到副本集列表，类似于以下内容：

```
{  "_id" : "shard1",  "host" : "shard1/SHARD1:port,newmember1:port,newmember2:port" } 
```

如果这没有自动发生，您将需要按照上面文档链接中概述的程序进行操作，即从内部`mongos`：

```
db.getSiblingDB("config").shards.save({_id:"<name>", host:"<rsName>/member1,member2,..."}) 
```

按照上面的例子，它看起来像：

```
db.getSiblingDB("config").shards.save({_id:"SHARD1", host:"shard1/SHARD1:port,newmember1:port,newmember2:port"}) 
```

您需要为每个分片执行此过程，并且您应该一次执行一个，以便在移动到 SHARD2 之前将所有 SHARD1 作为副本集。您还需要注意，在初始选举发生时，每个副本集都将变为只读，因此至少您应该将其安排在停机时间或维护窗口中。理想情况下，首先在暂存环境中进行测试。

# linux - 如何让我的 Golang Web 服务器在后台运行？

> ID：12486691
> 
> 赞同：49
> 
> 时间：2012-09-18T23:49:32.380
> 
> 标签：linux, shell, daemon

我最近完成了*Wiki Web 开发教程*（[http://golang.org/doc/articles/wiki/](http://golang.org/doc/articles/wiki/)）。我有很多乐趣，我想尝试更多的 net/http 包。

但是，我注意到当我从控制台运行 wiki 时，wiki 会接管控制台。如果我关闭控制台终端或停止进程，`CTRL+Z`则服务器停止。

如何让服务器在后台运行？我认为这个术语是在守护进程中运行的。

我在 Ubuntu 12.04 上运行它。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2012-09-19T00:03:33.670

# 简单/可用的东西优先

如果您想要一个不费吹灰之力的启动脚本，您可以使用该`upstart`服务。请参阅相应的手册页和`/etc/init/*.conf`示例。创建这样的过程后，您可以通过调用启动服务器

```
service myserver start 
```

如果您想要更多功能，例如特定限制或权限管理，您可以尝试`xinetd`.

# 使用外壳

你可以像这样开始你的过程：

```
nohup ./myexecutable & 
```

`&`告诉 shell 在后台启动命令，并将其保存在作业列表中。在某些 shell 上，如果父 shell 使用 HANGUP 信号退出，则作业将被终止。为防止这种情况，您可以使用命令启动`nohup`命令，该命令会丢弃 HANGUP 信号。

但是，如果被调用进程重新连接 HANGUP 信号，这将不起作用。

确实，您需要从 shell 的作业列表中删除该进程。对于两个众所周知的 shell，这可以实现如下：

### 重击：

```
./myexecutable &
disown <pid> 
```

### zsh：

```
./myexecutable &! 
```

## 杀死你的后台工作

通常，shell 会打印进程的 PID，然后可以使用`kill`命令将其终止，以停止服务器。如果你的 shell 不打印 PID，你可以使用

```
echo $! 
```

执行后直接。这将打印分叉进程的 PID。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-09-18T23:52:44.013

您可以使用[Supervisord](http://supervisord.org)来管理您的流程。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-09-19T00:17:07.127

Ubuntu？使用[`upstart`](http://upstart.ubuntu.com/).

`/etc/init`为您的工作创建一个文件，命名为`your-service-name.conf`

```
start on net-device-up
exec /path/to/file --option 
```

您可以使用`start your-service-name`, 以及：`stop`, `restart`,`status`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-12-22T06:02:28.680

这将使用 配置您的服务`systemd`，而不是一个全面的教程，而是如何设置的快速入门。

您的`app.service`文件内容

```
[Unit]  
Description=deploy-webhook service
After=network.target

[Service]      
ExecStart=/usr/bin/go webhook.go    
WorkingDirectory=/etc/deploy-webhook

User=app-svc      
Group=app-svc

Restart=always    
RestartSec=10    
KillSignal=SIGINT

SyslogIdentifier=deploy-webhook-service      
PrivateTmp=true  

Environment=APP_PARAM_1=ParamA
Environment=APP_PARAM_2=ParamB

[Install]      
WantedBy=multi-user.target 
```

启动服务

```
sudo systemctl start deploy-webhook.service 
```

服务状态

```
sudo systemctl status deploy-webhook.service 
```

日志

```
journalctl -u deploy-webhook -e 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-12-22T06:08:01.677

按`ctrl`+ `z`（使当前任务进入睡眠状态）后，您可以`bg`在终端（代表后台）中运行命令，让最新的任务继续在后台运行。

需要时，运行`fg`以返回任务。

要获得相同的结果，您可以`&`在最后添加命令以在后台启动它。

# android - Android蓝牙IOException：连接被拒绝

> ID：12486695
> 
> 赞同：7
> 
> 时间：2012-09-18T23:50:03.123
> 
> 标签：android, bluetooth, rfcomm

好吧，这就是交易。我有两部启用蓝牙的 Galaxy Nexus 手机。

我编写了一个蓝牙连接管理应用程序，用于设备发现和连接。它还输出设备可以支持的所有可用 UUID。

从[http://www.bluetooth.org/Technical/AssignedNumbers/service_discovery.htm 查看](http://www.bluetooth.org/Technical/AssignedNumbers/service_discovery.htm)以下标准 UUID 从 Galaxy Nexus 设备中公开。

*   0x1116 - 午睡
*   0x112f - PBAP（电话簿访问配置文件）
*   0x111f - HFP（免提）
*   0x1105 - OPP（对象推送配置文件）
*   0x1112 - HSP（耳机配置文件）
*   0x110c - AVRCP
*   0x110a - A2DP

我正在尝试通过 OPP 配置文件 ( `UUID 00001105-0000-1000-8000-00805F9B34FB`) 连接并在设备之间推送对象（文件）。我已经阅读了有关如何发现、配对/绑定（线程等）和管理所有蓝牙连接的整个[Android API 文档。](http://developer.android.com/guide/topics/connectivity/bluetooth.html)我已经设法通过 SPP (0x1101) 配置文件成功连接并与旧版板设备通信。

但是，当我尝试`socket.connect()`在两部 Galaxy nexus 手机之间使用时，会出现配对对话框，然后我单击`Pair`两部设备上的按钮。之后，我立即得到一个`Connection Refused IOException`. 请注意，在配对发生后，我再也不会被问到，这是有道理的，因为安全链接已被缓存。

如果我无法使用这些标准 UUID 连接到这些标准配置文件，为什么它们会暴露？如何从我的应用程序连接到任何这些配置文件并与它们交互？是因为我的应用程序不受信任吗？奇怪的是，即使是`Share`Android 上的功能也根本不起作用。这在 Android 上完全被破坏了吗？

请避免像文档说的那样提示我使用“众所周知的 UUID SPP 一个 0x1101”。这不是我想要的。我对这些东西的工作原理有相当好的理解，我正在寻找一个真正的解决方案或问题的解释。

我已经看到了典型的“反射”解决方案，但我不明白为什么这在 Android 上仍然是一个问题？为什么人们使用反射来完成这项工作？我们可以在 Android 上提交一个错误来解决这个问题吗？

如果这些 UUID 是标准的，那么任何应用程序都应该能够连接它们并与之交互。为什么这是一个问题，为什么我会得到这个异常？

提前致谢。

**更新**

因此，出于某种原因，Android 系统中的对象推送开始起作用。我实际上试图通过我的应用程序进行连接，但它无法正常工作。然后，我去了联系人应用程序并尝试分享一个神奇的联系人。然后，我回到我的应用程序，现在它可以工作了......哇。这很奇怪，必须对此进行解释。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-03-18T05:38:25.487

我遇到了同样的问题，并设法找到了适合我的解决方案。

在我的情况下，我使用了三种不同的测试设备（Nexus 5、Galaxy S4、Note 2），由于某种原因，Note 2 无法连接到我的蓝牙模块，而其他两个可以。

我发现的原因是蓝牙驱动程序各不相同，并且需要稍微不同的连接方法来创建不同设备之间的连接。

我使用的三种方法称为“安全”、“不安全”和“反射方法”/“hax”。

```
 switch(connType)
            {
            case Secure:
                tmpSocket = device.createRfcommSocketToServiceRecord(_uuid);
                break;

            case Insecure:
                tmpSocket = device.createInsecureRfcommSocketToServiceRecord(_uuid);
                break;

            case Hax:
                Method createSocket = device.getClass().getMethod("createRfcommSocket", new Class[] {int.class});
                tmpSocket = (BluetoothSocket)createSocket.invoke(device, Integer.valueOf(1));   
                break;
            } 
```

就我而言，安全模式适用于 Nexus 5 和 Galaxy S4，但不适用于 Note 2。

经过一些测试后，我发现 Note 2 只能在“不安全”模式下工作，因此为了迎合这一点，我基本上会尝试连接并在必要时循环使用不同的模式。当尝试不同的连接模式时，我只是提示“重试连接”。因此，如果使用安全连接失败，那么我将尝试使用不安全，然后使用反射方法。

我还没有遇到过这三种方法之一不起作用的情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T00:12:34.570

您是否尝试过使用非标准配置文件？即为`UUID`您的应用程序定制。这也将帮助您知道您（很可能）仅连接到您自己的应用程序，而不是使用相同配置文件注册的其他应用程序。

根据我的经验，蓝牙配对对于第一次尝试是非常错误的。但是，使用自定义`UUID`会有所帮助。

反射方法（我认为）最初是尝试修复特定设备的错误，但是我认为有些人在其他地方也成功地使用了它。该设备被称为Spica或类似的东西。

正如还发布的评论之一，我也会在失败后再次尝试连接。

基本上编写计划第一次尝试失败的代码，但如果出现失败，代码会在 5 秒内尝试再次连接。

这些都是不完美的解决方案，但 Android 上的蓝牙实现也不完美（恕我直言）。希望有帮助

**编辑**

根据问题更新和评论：

我同意某些东西肯定是错误的。我认为部分问题是 BT 驱动程序各不相同，每个驱动程序都有不同的 BT 堆栈和不同的怪癖。我还发现了一个同时使用反射方法和自定义`UUID`以及其他标准方法的问题。这对我来说似乎很极端，但它确实涵盖了大部分内容。不幸的是，作为应用程序开发人员，我们无法控制低级堆栈/代码/驱动程序。

我发现我的两个蓝牙共享应用程序第**一次配对总是很棘手**。

我很高兴知道这不仅仅是我。

# c++ - 我怎样才能有效地清理这个程序并且仍然检测文件输入何时不是字母？

> ID：12486698
> 
> 赞同：0
> 
> 时间：2012-09-18T23:50:22.160
> 
> 标签：c++, fstream, simplification

这是我的整个程序，我应该从名为 hw4pr11input.txt 的输入文件中计算单词中的平均字母数。我只编程了几个星期，所以我很感激简单的答案，我可以用我的少量知识来实现​​。我还不知道数组是什么，我正在做作业的那一章在文件 io.xml 中。

```
#include <fstream>
#include <iostream>
#include <cstdlib>
using namespace std;

//function declaration 
void average_letters(ifstream& fin);
//Precondition: there is a input file with text ready to be read
//postcondition: Text from the input file is read then the average length of
//words is calculated and output to the screen

//start main program
int main()
{
ifstream fin;

         fin.open("hw4pr11input.txt");                                               //opening input file
         if (fin.fail())                                                            //checking for input file opening failure
         {
            cout << "Input file open fail";
            exit(1);                                                               //terminating program if check fails
         }
         cout << "File Open\n";
         average_letters(fin);                                                     //calling function to remove spaces
         system("pause");
         return 0;
}
                                                                                   //function definition, uses iostream and fstream
void average_letters(ifstream& fin)
{
char next, last_char = 0;
double letter_count = 0, word_count = 0;
double average = 0;
     while(!(fin.eof()))
     {
         fin.get(next);
         if(!(next == ' ' || next == ',' || next == '.' || next == '/'             
         || next =='(' || next == ')')) 
         {
                   letter_count++;                                                                    
         }

         else
         {   
             if((next == ' ' || next == ',' || next == '.' || next == '/'         
             || next =='(' || next == ')') && (last_char == ' ' || next == ','    
             || next == '.' || next == '/' || next =='(' || next == ')' ))

             {
                     continue;
             }
             else
             {
                     word_count++;
             }
         }
         last_char = next;                  //stores previous value of loop for comparison
     }
     average = letter_count/word_count;
     cout << "The average length of the words in the file is:" << " " <<average;
     cout << endl;
} 
```

我相信这个程序可以完成任务，但我主要关心的是函数 average_letters 的一部分，它检查它是字母还是符号。我通过查看 .txt 文件选择了这个符号列表。我删除了评论，因为它们使复制和粘贴变得困难，如果这使我的逻辑更难以理解，我深表歉意。

谢谢你的帮助。对我放轻松:)。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:01:54.887

您可以使用`std::bitset<255>`转换为无符号整数的字符并仅将那些作为单词字符的字符预设为 true。在您的循环中，您只需查找它是否是有效单词。

请注意，这假定 char 是 255 位而不是 unicode。您可以相应地扩大您的位设置。

这使您可以非常快速地检查字符是否为单词字符，并允许您定义要包含的字符（例如，如果要求突然更改为包含“-”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:03:07.587

您可以通过将这些字符组存储在字符串中来美化此代码。然后你可以编写一个函数，它接受一个 char 和一个字符串，并检查 char 是否等于给定字符串中的任何 char。但这需要您学习如何使用数组，因为字符串 i C 是字符数组。

# html - 缩小 float:left 和 float:right 之间的差距

> ID：12486712
> 
> 赞同：0
> 
> 时间：2012-09-18T23:52:13.970
> 
> 标签：html, css, css-float, margin, padding

我有`.content-left`和`.content-right`，它们打算分别向左和向右浮动。我的问题是两个 div 都设置为`width:300px`，这远小于容器的宽度（960px）。我认为这就是导致`.content-left`和之间差距如此之大的原因`.content-right`。我的问题是——如何缩小差距？在这种情况下，负填充和边距似乎不起作用。

CSS：

```
#container {
    margin: 0 auto;
    width: 960px;
}

.content-left {
    float: left;
    width: 300px;
}

.content-right {
    float: right;
    width: 300px;
} 
```

HTML：

```
<div id="container">
    <h1>Heading.</h1>
    <div class="content-left">
        //left side content
    </div><!-- end content-left -->
    <div class="content-right">
        //right side content
    </div><!-- end content-right -->
</div><!-- end container --> 
```

![差距](../Images/8a5e5a9cae1496aad53f977d4c973827.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-18T23:53:58.807

尝试向左浮动。然后用一些`margin`

如果你真的想使用左浮动和右浮动，添加`margin-right`到浮动右的那个就可以了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-18T23:57:13.423

边距不起作用？嗯，不，它有效。

[http://jsfiddle.net/NF8Lk/](http://jsfiddle.net/NF8Lk/)

# php - 存储过程调用后的 Codeigniter DB 错误

> ID：12486720
> 
> 赞同：0
> 
> 时间：2012-09-18T23:53:12.037
> 
> 标签：php, mysql, codeigniter

我有一个数据库，其中包含一些我想通过 CodeIgniter 调用的存储过程。我的模型类中有以下代码：

```
$sql = "CALL `stored_proc`(1)";
$query = $this->db->query($sql); //This call breaks the DB :(

$this->db->select('status');
$this->db->where('id', $id);
$query = $this->db->get('table');

print($query->num_rows()); //line 1116 
```

当我运行此代码时，我收到以下错误：

> 致命错误：在第 1116 行的 C:\server\apache\htdocs\application\models\let_model.php 中的非对象上调用成员函数 num_rows()

如果我删除查询行，则选择可以正常工作。此外，如果我用 SELECT 命令替换对存储过程的调用，它也可以正常工作。

为什么我收到这个错误，有什么明显的我遗漏了吗？如果没有好的答案，有没有办法解决这个问题？

谢谢你的时间！

**编辑：**在深入研究问题后，如果我的存储过程包含 SELECT 命令，似乎会发生此错误。更新似乎工作正常。也许这个问题与 CodeIgniter 如何处理 SELECT 结果有关？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-02-10T11:15:12.163

由于这个问题首先出现在谷歌上，我设法通过使用解决了这个问题：

```
$this->db->simple_query($query); 
```

而不是常规的查询功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T01:26:47.873

问题是存储过程中的 SELECT 导致 CodeIgniter 出现问题。通过确保所有 SELECT 都是定向的（即使用 INTO 子句），存储过程能够成功运行。

例如，

```
-- This causes an error in CodeIgniter when inside a stored procedure.
SELECT GET_LOCK('lock1',0);  

-- This does not.
DECLARE _lock_result INT;
SELECT GET_LOCK('lock1',0) INTO _lock_result; 
```

我仍然不知道为什么这会导致错误的根本原因，但这个解决方案足以满足我目前的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T08:33:36.527

仅使用

`$query->num_rows`代替`$query->num_rows()`

# java - 在 oracle 主要版本 11 上具有 HibernateException 的 JBOSS 部署

> ID：12486722
> 
> 赞同：4
> 
> 时间：2012-09-18T23:53:24.407
> 
> 标签：java, oracle, hibernate, jboss-4.2.x, dialect

尝试在 JBoss-4.2.3.GA 中使用以下设置部署应用程序 ear 文件

**jboss-app.xml**

```
<jboss-app>
    <loader-repository>
        com.xxxx.xxx:loader=<ear-name>
      <loader-repository-config>
        java2ParentDelegation=false
      </loader-repository-config>  
    </loader-repository>
</jboss-app> 
```

**persistence.xml**（只是一个片段）

```
<property name="hibernate.dialect" value="org.hibernate.dialect.Oracle10gDialect"/>
<property name="hibernate.hbm2ddl.auto" value="validate"/>
<property name="hibernate.show_sql" value="false"/>
<property name="hibernate.format_sql" value="false"/>
<property name="jboss.entity.manager.factory.jndi.name" value="java:/XXXXFactory"/> 
```

**在部署期间获得了以下记录器信息，我不确定为什么 INFO 记录器中列出了异常，我可以不为此烦恼吗？**

```
16:30:07,239 INFO  [STDOUT] 16:30:07,238 INFO  [SettingsFactory] JDBC driver: Oracle JDBC driver, version: 11.2.0.3.0
javax.ejb.EJBException: org.hibernate.HibernateException: unknown Oracle major version [11]
    at org.jboss.ejb3.tx.Ejb3TxPolicy.handleExceptionInOurTx(Ejb3TxPolicy.java:63)
    at org.jboss.aspects.tx.TxPolicy.invokeInOurTx(TxPolicy.java:83)

Caused by: org.hibernate.HibernateException: unknown Oracle major version [11]
    at org.hibernate.dialect.DialectFactory$1.getDialectClass(DialectFactory.java:135)
    at org.hibernate.dialect.DialectFactory.determineDialect(DialectFactory.java:65)
    at org.hibernate.dialect.DialectFactory.buildDialect(DialectFactory.java:39)
    at org.hibernate.cfg.SettingsFactory.determineDialect(SettingsFactory.java:426) 
```

**注意：我们使用的是 JBoss-Seam-2.2.0.GA**

**试过：[这个](https://stackoverflow.com/a/1158045/150371)，[这个](http://jaitechwriteups.blogspot.com/2008/08/how-to-upgrade-hibernate-in-jboss.html)和[那个](http://smooth-java.blogspot.com/2011/08/fixing-problem-in-hibernate-unknown.html)**

如果需要任何其他信息，请告诉我，我正在尝试将 jboss 中可用的库拉回耳朵。

**更新：尝试**

1.  发现应用程序正在使用 2 个不同的会话，并且
    有一个 hibernate.cfg.xml 也用于另一个遗留代码，其中没有指定方言。
2.  所以将Oracle10g方言添加到cfg.xml，它停止抛出上述未知oracle版本错误，但由于无法加载10gDialect而异常。
3.  美是两个会话都指向同一个数据源。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-09-19T05:45:31.610

尝试添加

```
hibernate.dialect=org.hibernate.dialect.Oracle10gDialect 
```

也到`JBoss/server/default/deploy/ejb3.deployer/META-INF/persistence.properties`。

它适用于 JBoss-4.2.3.GA 捆绑的 Hibernate 3.2.4.sp1 和 ojdbc5 11.1.0.6.0（都在 JBoss 全局库中）。

**更新**

还要重新检查类路径中的某个位置是否不存在旧版本的休眠。

JBoss-Seam-2.2.0.GA 分发包捆绑休眠 3.3.1.GA 而[针对 Oracle 数据库 11g 的休眠方言？](https://stackoverflow.com/questions/4369944/hibernate-dialect-for-oracle-database-11g)建议至少`Hibernate 3.3.2+ is required for recent JDBC drivers`。

JBoss-4.2.3.GA 捆绑的 Hibernate 3.2.4.sp1 可能有一些现代人员向后移植。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T05:58:01.053

我从来没有遇到过这种例外，但对我来说这听起来很清楚：

Hibernate 的 DialectFactory 应该维护某种数据库引擎类型的映射

（包括版本）到实际的方言。整个问题是您没有到 Oracle 11 的重新映射

作为第一个赌注，我会看看这个特定的课程。我不知道你有什么版本的hibernate，但看起来Oracle 11根本不支持，至少我找到的来源（看看[这里](http://grepcode.com/file/repo1.maven.org/maven2/org.hibernate/hibernate/3.2.6.ga/org/hibernate/dialect/DialectFactory.java)）看看那个''MAPPERS''哈希地图，你会看到......这里的开源规则;）

所以我认为最好的办法是将休眠升级到最新版本（只需检查最新版本中映射器是否已更新）。或者至少调试应用程序服务器以找出将参数传递给方法的内容等等。

当然，它也可以构建您的自定义版本的 Hibernate，但我认为它不应该被视为更可取的解决方案。

我也会考虑覆盖默认方言，因为你已经在“那个”文章中找到了:) 我不明白为什么它不应该工作，但你最好再次调试它。也许你应该在某个地方告诉 JBoss 它也应该使用你的方言......

希望这可以帮助

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-05-30T08:49:40.430

```
 public String getDialectClass(int majorVersion) throws Throwable
        {
            switch(majorVersion)
            {
            case 8: // '\b'
                return (DialectFactory.class$org$hibernate$dialect$Oracle8iDialect != null ? DialectFactory.class$org$hibernate$dialect$Oracle8iDialect : (DialectFactory.class$org$hibernate$dialect$Oracle8iDialect = DialectFactory._mthclass$("org.hibernate.dialect.Oracle8iDialect"))).getName();

            case 9: // '\t'
                return (DialectFactory.class$org$hibernate$dialect$Oracle9iDialect != null ? DialectFactory.class$org$hibernate$dialect$Oracle9iDialect : (DialectFactory.class$org$hibernate$dialect$Oracle9iDialect = DialectFactory._mthclass$("org.hibernate.dialect.Oracle9iDialect"))).getName();

            case 10: // '\n'
                return (DialectFactory.class$org$hibernate$dialect$Oracle10gDialect != null ? DialectFactory.class$org$hibernate$dialect$Oracle10gDialect : (DialectFactory.class$org$hibernate$dialect$Oracle10gDialect = DialectFactory._mthclass$("org.hibernate.dialect.Oracle10gDialect"))).getName();

            case 11: // '\013'
                return (DialectFactory.class$org$hibernate$dialect$Oracle10gDialect != null ? DialectFactory.class$org$hibernate$dialect$Oracle10gDialect : (DialectFactory.class$org$hibernate$dialect$Oracle10gDialect = DialectFactory._mthclass$("org.hibernate.dialect.Oracle10gDialect"))).getName();

        }

            throw new HibernateException("unknown Oracle major version [" + majorVersion + "]");
        } 
```

实际上这是 DialectFactory 中的代码，因此当您的数据库版本更改为 11 以上时，您将遇到此问题我添加了额外的开关盒，它解决了我的问题

# twitter-bootstrap - Twitter引导模式事件未触发

> ID：12486728
> 
> 赞同：1
> 
> 时间：2012-09-18T23:54:05.010
> 
> 标签：twitter-bootstrap

当模态窗口关闭但它不起作用时，我试图调用一个函数。

我的代码是：

```
<script type="text/javascript">

    $('#myModal').bind('hidden', function () {
        alert("blah");
    });

</script>

<div id="myModal" class="modal hide fade">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <br />
    Test
  </div>
  <div class="modal-body">
    <p>Modal body</p>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn primary">Primary</a>
    <a href="#" class="btn secondary">Secondary</a>
  </div>
</div>
<button type="button" data-toggle="modal" data-target="#myModal">Launch modalbggg</button> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-24T12:45:00.157

您的代码完美运行。见这里：http: [//jsfiddle.net/5sJYk/](http://jsfiddle.net/5sJYk/)

确保您使用的是正确的 Twitter Bootstrap 和 jQuery 版本，并且正确调用它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-06-04T16:43:11.960

Łukasz Niemier,

我遇到了同样的问题并找到了原因。定义事件函数时，myModal 尚未定义。因此，尝试将脚本移动到该行下方的任何位置

```
<div id="myModal" class="modal hide fade"> 
```

它会起作用的。

辛比尔斯克是正确的。您的代码在 jsfiddle 中完美运行。原因在jsfiddle，脚本在html内容的底部。

顺便说一句， on 和 bind 都可以工作。

编辑：最好的解决方案是将您的脚本包装在 ready 函数周围。然后你可以把它放在页面上的任何位置

```
$().ready(function () {

   $('#myModal').bind('hidden', function () {
        alert("blah");
    });
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-19T00:02:39.397

1.  [文档](http://twitter.github.com/bootstrap/javascript.html#modals)说要使用`on`，而不是`bind`
2.  你确定你包括了所有的来源？
3.  为什么不使用 jQuery 的神奇功能：

    ```
    $(function() {
        $('#myModal').bind('hidden', function () {
            alert("blah");
        });
    }); 
    ```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-04T13:44:44.350

```
$(function(){ // let all dom elements are loaded
    $('#mymodal').on('hide.bs.modal', function (e) {
        alert('event fired')
    });
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-07-28T14:47:36.377

您只需要为模态的 ID 声明一个变量。然后将其绑定到隐藏事件。

```
var $modal = $('#myModal');

$modal.on('hidden.bs.modal', function(e) {
   // console.log("modal is closed....");
}); 
```

# asp.net-mvc - 为 Azure Web 角色定义缩放阈值

> ID：12486730
> 
> 赞同：5
> 
> 时间：2012-09-18T23:54:22.873
> 
> 标签：asp.net-mvc, azure, scalability, azure-web-roles

Azure 包含弹性缩放的概念，我已经能够通过我的**Worker Roles**实现这一点。但是，当涉及到我的**Web 角色**（*例如 MVC 应用程序*）时，我不确定要监控什么（*或如何*）来确定何时是增加（*或*减少）运行实例数量的好时机。我假设我需要监控一个或多个性能计数器，但不确定从哪里开始。

任何人都可以推荐一种最佳实践来评估与扩展决策相关的 MVC Web 角色实例负载吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T01:50:19.157

这个问题有点开放，因为监控通常是特定于应用程序的。话说回来：

从您在本地服务器上查看的简单测量开始，代表您的应用程序的 KPI。例如：也许看看网络利用率。[这篇 TechNet 文章](http://technet.microsoft.com/en-us/library/gg276380.aspx)介绍了 System Center for Windows Azure 收集的性能计数器。例如：

*   ASP.NET 应用程序请求/秒
*   网络接口字节
*   接收/秒
*   每秒发送的网络接口字节数
*   处理器 % 处理器时间总计
*   LogicalDisk 免费兆字节
*   逻辑磁盘 % 可用空间
*   可用内存兆字节

您可能还想查看排队的请求数和请求等待时间。

网络利用率很有趣，因为您的 NIC 提供大约。每个内核 100Mbps，即使 CPU 和其他资源未得到充分利用，最终也可能成为瓶颈。您可能需要扩展到更多实例来处理高带宽方案。

另外：我倾向于不太重视 CPU 利用率，尽管它很容易衡量（并且在示例中经常出现）。以接近容量运行 CPU 通常是*一件好事*，因为您正在为此付费并且尽可能多地使用它。

至于*减少*：这需要更小心地处理。Windows Azure 计算按小时计费。例如，如果您在 11:50 横向扩展至一个额外的实例，并在 12:10 再次横向缩减，那么您刚刚花费了两个 cpu 小时。另外：您不想扩大规模，然后进行新的测量并决定现在可以再次缩小规模（有效地创建一个不断增加和减少实例的脉冲）。[为了让事情变得更简单，请考虑在Enterprise Library](http://entlib.codeplex.com/)中找到的 Autoscaling Application Block (WASABi) 。这包含了所有的比例规则（比如我刚才提到的那些），并且使用起来非常简单。

# django - 当 commit=False 时如何在表单集中保存 M2M 字段

> ID：12486734
> 
> 赞同：1
> 
> 时间：2012-09-18T23:55:11.797
> 
> 标签：django

```
deals_formset_factory = modelformset_factory(Deal, form=DealCForm, extra=1)    
attached_deals_formset = deals_formset_factory(request.POST, prefix='deals') 
```

由于我的`Deal`模型的某些字段未显示在表单中，因此无法由用户设置（但 M2M 字段已显示并且可以由用户设置），我不能只做一个

```
for fm in attached_deals_formset:                
    if fm.has_changed(): 
       fm.save() 
```

因为它会破裂。

所以理论上这种情况下的想法是做

```
deal = fm.save(commit=False)
...
deal.save() 
```

但这并不能在交易中保存我的 M2M 字段。直通表保持不变。解决这个问题的最佳方法是什么？

```
class Deal(models.Model):            
    deal_id             = UUIDField()
    ....
    sales_item          = models.ManyToManyField(SalesItem) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T10:15:14.993

我找到了解决方案，无需重写保存方法。

> 当您的模型与另一个模型具有多对多关系时，会看到使用 commit=False 的另一个副作用。如果您的模型具有多对多关系并且您在保存表单时指定 commit=False，则 Django 无法立即保存多对多关系的表单数据。这是因为在实例存在于数据库中之前，无法为实例保存多对多数据。
> 
> 为了解决这个问题，每次您使用 commit=False 保存表单时，Django 都会向您的 ModelForm 子类添加一个 save_m2m() 方法。手动保存表单生成的实例后，可以调用 save_m2m() 保存多对多表单数据

[资源](https://docs.djangoproject.com/en/dev/topics/forms/modelforms/#the-save-method)

在 deal.save() 之后：

```
fm.save_m2m() 
```

# read-write - 在手机上读/写 NVM？

> ID：12486736
> 
> 赞同：1
> 
> 时间：2012-09-18T23:55:36.693
> 
> 标签：read-write, cdma, nvm

我正在尝试使用 Win32 在基于高通的手机 (cdma) 上读取/写入 NVM。

LG 提供驱动程序，以便电话在热插拔时可通过串行端口使用。我可以按预期打开端口。

但我不确定如何阅读和编写 NV 项目。我的 Google-fu 今天关闭了，所以我没有得到任何有用的点击。

我下载了 BitPim 的源代码，但我不是 Python 人。我想我可能能够从 filesystem.py 获得一些信息，但它是管理 GUI 视图的代码（？？？）。

我还尝试在使用 CDMA Workshop 时使用 SysInternal 的 PortMon，但 PortMon 不捕获端口（显然，它只允许捕获存在的端口，而不是来来去去的设备接口）。

有没有人有任何信息或经验？

杰夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-04-16T22:47:33.810

您基本上需要连接到串行端口或 DM 端口并构造适当的 QCDM 数据包以发送到设备。

您可以查看一个名为 ModemManager 的 Linux 应用程序，其中包含一个名为的库`libqcdm`- 如果您熟悉 C，您可以查看它如何构造其 QCDM 数据包，您可以使用任何支持编写的语言重新创建它们到串口。

由于我在零售手机行业工作，因此我开始使用与 CDMA Workshop 类似的软件供内部使用，并且查看此应用程序的来源也对我有很大帮助：

[http://code.google.com/p/cdmaworkshoptool/](http://code.google.com/p/cdmaworkshoptool/)

除了那个应用程序之外，我还发现了一些带有 CDMA C++ 源代码的中文网站，这对我也有很大帮助。（虽然不是一个非常友好的下载网站，但您可以单击各个源文件通过浏览器阅读代码）

[http://www.pudn.com/downloads125/sourcecode/windows/comm/detail529045.html](http://www.pudn.com/downloads125/sourcecode/windows/comm/detail529045.html)

# wordpress - 我的 robots.txt 中与 .htaccss 文件相关的奇怪 Https / Http 错误

> ID：12486737
> 
> 赞同：1
> 
> 时间：2012-09-18T23:55:39.133
> 
> 标签：wordpress, .htaccess, http, https, robots.txt

我已经建立了一个网站，就像我以前做过很多次一样，但是当你真正用谷歌搜索该网站时会出错。

> clrhorizo​​n.com/ 由于此站点的 robots.txt，此结果的描述不可用 - 了解更多信息。

是我看到的消息

如果您将鼠标悬停在“clrhorizo​​n.com”上，这只会显示一个转到主页的正常 url。

但是，如果您将鼠标悬停在“robots.txt”文件上，它会转到“https://clrhorizo​​n.com/robots.txt”，这很奇怪，因为我在基于 wordpress 的网站上没有 ssl 证书。

如果您然后单击“robots.txt”链接，我会收到一个奇怪的错误：

`<META HTTP-EQUIV="Refresh" CONTENT="0;URL=http://clrhorizon.systempartners.com/robots.txt"><h1><a href=http://clrhorizon.systempartners.com/robots.txt>VIEW TEMPORARY SITE</a></h1>`

而且这里的网址不再是 https 了。经历了数小时的托管支持，以查看错误在哪里，但没有运气。他们建议清除我的 .robots.txt 文件并等待。

在另一个线程上，我找到了一个潜在的解决方案，但到目前为止还没有运气（读到它应该立即更新）。当前的 .htaccess 文件是：

```
>     # BEGIN WordPress
> 
> <IfModule mod_rewrite.c> 
> RewriteEngine On 
> RewriteCond %{HTTPS} on
> RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} 
> RewriteBase /
> RewriteRule ^index\.php$ - [L] 
> RewriteCond %{REQUEST_FILENAME} !-f
> RewriteCond %{REQUEST_FILENAME} !-d 
> RewriteRule . /index.php [L]
> </IfModule>
> 
> # END WordPress 
```

我对错误应该在哪里失去了想法。

希望有人能帮忙吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T23:03:43.503

看起来您是通过 Google 网站管理员工具将您的网站提交为[http://clrhorizo​​n.com](http://clrhorizon.com)而不是最终重定向到的[http: //www.clrhorizo​​n.com。](http://www.clrhorizon.com)在主站点上，您似乎也没有 robots.txt 文件。由于您确实有一个站点地图，我建议您创建一个如下所示的站点，并使用非重定向域名（包括 www）重新提交您的站点：

```
User-agent: *
Disallow: /wp-admin/
Disallow: /wp-includes/

Sitemap: http://www.clrhorizon.com/sitemap.xml 
```

我的猜测是您的主机使用基于名称的虚拟主机，尽管您没有 SSL 证书，但他们仍在为您的域侦听 443 并尝试进行重定向。

您可以在此处查看类似问题的描述[http://help.bigcartel.com/questions/3221-a-description-for-this-result-is-not-available-because-of-this-site-s-机器人-txt-学习-更多](http://help.bigcartel.com/questions/3221-a-description-for-this-result-is-not-available-because-of-this-site-s-robots-txt-learn-more)

# php - 多维数组函数的key()返回0？

> ID：12486739
> 
> 赞同：0
> 
> 时间：2012-09-18T23:55:46.123
> 
> 标签：php

我构建了一个函数来仅搜索多维数组中的*特定键*（不要混淆`in_array`它`array_search`会搜索每个元素。我试图返回多维数组中匹配的子数组的键。

```
$array = array(array("hello1", "hello2"), array("test1", "test2"));
function search_custom($needle, $specific_key) {
    global $array;
    foreach($array as $value) {
        /* only searches specific key in the sub-arrays */
        if($needle == $value[$specific_key]) {
            return key($value); /* should return 1? */
        }
    }
}
print_r(search_custom("test2", 1)); /* search only in element 1 of sub-arrays */ 
```

不幸的是，即使“test2”在多数组的元素 1 中，它也会输出“0”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:14:41.100

您的使用`key()`是错误的，它需要一个数组。但是`foreach`可以给你钥匙，你不必寻找它：

```
$array = array(array("hello1", "hello2"), array("test1", "test2"));
function search_custom($needle, $specific_key) {
    global $array;
    foreach($array as $key=>$value) {
        /* only searches specific key in the sub-arrays */
        if($needle == $value[$specific_key]) {
            return $key;
        }
    }
}
print_r(search_custom("test2", 1)); /* search only in element 1 of sub-arrays */ 
```

# entity-framework - 实体框架急切加载/“IncludeEverything()”？

> ID：12486741
> 
> 赞同：2
> 
> 时间：2012-09-18T23:55:57.107
> 
> 标签：entity-framework, iqueryable

在 EF4 中，我的对象图很小，数据量也很小。因此，对于查询，我想急切地加载所有相关数据。是否有任何单个方法调用可以完成这项工作，例如`"IQueryable.IncludeEverything()"`，而不是`Include()`使用硬编码的属性名称重复调用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T19:07:47.543

没有什么是开箱即用的，但您可以使用 MetadataWorkspace 来实现它：

```
 public static IQueryable<T> IncludeEverything<T>(this IQueryable<T> query, ObjectContext context)
        where T : class
    {
        var ospaceEntityType = context.MetadataWorkspace.GetItem<EntityType>(
            typeof(T).FullName, DataSpace.OSpace);

        var cspaceEntityType = context.MetadataWorkspace.GetEdmSpaceType(ospaceEntityType);

        var includedTypes = new HashSet<EdmType>();
        includedTypes.Add(cspaceEntityType);

        return IncludeEverything(query, cspaceEntityType as EntityType, "", includedTypes);
    }

    private static IQueryable<T> IncludeEverything<T>(IQueryable<T> query,
        EntityType entity,
        string path,
        HashSet<EdmType> includedTypes)
        where T : class
    {
        foreach (var navigationProperty in entity.NavigationProperties)
        {
            var propertyEdmType = navigationProperty.TypeUsage.EdmType;
            if (includedTypes.Contains(propertyEdmType))
            {
                continue;
            }
            includedTypes.Add(propertyEdmType);

            var propertyCollectionType = propertyEdmType as CollectionType;

            EntityType propertyEntityType;
            if (propertyCollectionType != null)
            {
                propertyEntityType = propertyCollectionType.TypeUsage.EdmType as EntityType;
            } else
            {
                propertyEntityType = propertyEdmType as EntityType;
            }

            var propertyPath = string.IsNullOrEmpty(path) ? "" : path + ".";
            propertyPath += navigationProperty.Name;
            query = query.Include(propertyPath);
            query = IncludeEverything(query, propertyEntityType, propertyPath, includedTypes);
        }

        return query;
    } 
```

请注意，此代码仅用于说明。它没有参数验证，它可能多次包含相同的实体，并且如果您的模型中有循环，它不会包含所有相关实体。

# jquery - 尝试选择隐藏的单选按钮时 Cucumber + Capybara + Selenium 测试失败

> ID：12486747
> 
> 赞同：0
> 
> 时间：2012-09-18T23:56:46.280
> 
> 标签：jquery, ruby-on-rails, selenium, cucumber, automated-tests

我正在尝试检查在 RoR 中提交的表单的单选按钮，该表单在开发和生产中有效，但在我使用 @javascript 标记对 Cucumber 运行自动化测试时无效。观点是这样的：

```
<%= form_for @model do |f| %>
  <%= f.error_messages %>
  <%= f.hidden_field :user_id, :value => current_user.id %>
  <%= f.hidden_field :contact_id, :value => @contact.id %>
  <ul id="categories" class="unstyled">
<% @new_categories.each do |priority| %>
<li class="span2 contact" id="category_<%=priority.category.id%>" style="margin:0 20px 20px 0;position:relative; background:white">
  <div class="contact-image">
    <%= image_tag(priority.category.image, :alt => priority.category.name) %>
    <%= f.radio_button(:category_id, priority.category.id, class: 'hidden') %>
  </div>

</li>

<% end %>
 </ul>
  <p>
    <%= f.submit 'submit', :id=>"submit_category", :class=>'hide' %></p>
 <% end %>

<script type="text/javascript">
$('li').click(function() {
    var radio = $(this).find("input[type=radio]");
    radio.attr('checked', true);
    $('#submit_category').click();
});
</script> 
```

如果我把这样的脚本放在循环中：

```
<script type="text/javascript">
    $('li').click(function() {
        $("#model_category_id_<%=priority.category.id%>").attr('checked', true);
        $('#submit_category').click();
    });
</script> 
```

它确实有效，但我发现它效率低下。在前一个解决方案中，var radio 返回一个对象（使用 alert() 找到此对象），但我对其进行的任何调用（.name、.val()、.innerHTML）都返回未定义。

此外，这是单击 li 元素的步骤：

```
When /^I click on the "(.*?)" category$/ do |category_name|
  @category = Category.find_by_name(category_name)
  page.find('li', id: "category_#{@category.id}").click
end 
```

确实提出了请求，但好像根本没有选择单选按钮，并且这一步之后的步骤失败了。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-05-21T14:41:44.997

这个问题来自一年前，但也许这会对某人有所帮助......

前面的答案已经成功了一半。您确实要设置：`Capybara.ignore_hidden_elements = true`

然后...

```
page.execute_script("$('element').show()")
choose('element') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-13T12:35:01.980

*   如果要单击隐藏的单选按钮，请在 env.rb 中添加以下内容

    Capybara.ignore_hidden_​​elements = true

恕我直言：Capybara 默认忽略隐藏元素

*   尝试单击单选按钮（例如，用户 xpath 或其他东西）并单击它而不是 li

# .htaccess - 如何在 apache 中使用 .htaccess 进行重定向？

> ID：12486748
> 
> 赞同：0
> 
> 时间：2012-09-18T23:56:48.583
> 
> 标签：.htaccess, mod-rewrite, redirect

我正在尝试创建一个用户管理系统，用户可以使用他们预先创建的用户链接（例如 http www .abc .co ）注册其他用户。uk/access/register.php?id=username [抱歉不允许放更多链接]

但我希望长链接是这样的：

[http://www.abc.co.uk/用户名](http://www.abc.co.uk/username)

当用户输入短网址时，它将重定向到[http://www.abc.co.uk/access/register.php?id=username](http://www.abc.co.uk/access/register.php?id=username)

下面是我的 .htaccess 文件中的代码，因为我也在同一个域中运行 wordpress。

```
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

Options +FollowSymLinks
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(\w+)$ ./access/register.php?id=$1 [L,QSA] 
```

我为用户名重定向添加的 .htaccess 附加代码可以与同一个 .htaccess 文件中的其他 wordpress 重定向一起使用吗？

当我在浏览器中输入短网址时，它会将我带到“找不到页面”页面。

我尝试了几种方法，上面的代码不起作用。有人可以帮我吗？谢谢杰

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:28:57.973

你想要的是不可能的。apache 如何区分 wordpress 页面和用户名？

`www.abc.co.uk/contact`可能是您的联系站点或用户“联系人”。您需要将引荐来源网址放在子文件夹中，例如。`register`（所以你得到`abc.co.uk/register/username`：

```
RewriteEngine On
RewriteBase /

# Register
RewriteRule ^/register/(.+)$ ./access/register.php?id=$1 [L,QSA]

# Wordpress
RewriteRule ^index.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L] 
```

# cocos2d-iphone - Cocos2D - 删除区域上的图层不透明度

> ID：12486751
> 
> 赞同：0
> 
> 时间：2012-09-18T23:57:06.043
> 
> 标签：cocos2d-iphone, opacity, layer, region, cut

我得到了一个带有顶部 z-index 图层的场景，其中一个为整个场景添加了黑暗效果，设置了它的不透明度。我现在要做的是去除图像显示的混凝土区域（圆锥体/三角形内）中的阴影/黑暗效果（红色多边形内）。换句话说，我希望在三角形内部具有与屏幕左侧相同的“亮度”（零不透明度）。

![在此处输入图像描述](../Images/b52ac92bfc6cff8957cca1fde442cc17.png)

代码：

```
-(id) init
{
if( (self=[super initWithColor:ccc4(0,0,0,128)] )) {
    CGSize winSize = [[CCDirector sharedDirector] winSize];

    CCLayerColor* layer1 = [CCLayerColor layerWithColor: ccc4(0, 0, 0, 180) width: winSize.width height: winSize.height];
    layer1.position = ccp(50,0);
    [self addChild: layer1 z:2];

    CCSprite *background = [CCSprite spriteWithFile:@"background.png"];
    background.position = ccp(background.contentSize.width/2, background.contentSize.height/2);
    [self addChild:background];

    CCSprite *player = [CCSprite spriteWithFile:@"Player.png"rect:CGRectMake(0, 0, 27, 40)];
    player.position = ccp(player.contentSize.width/2, winSize.height/2);
    [self addChild:player];     
}
return self;
} 
```

关于如何做到这一点的任何想法？也许我应该尝试用另一种方式来做，而不是使用 CCLayer 来添加黑暗效果？？

提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:09:20.737

最简单的方法是使用带有背景大小的黑色图像的 CCSprite。然后在图像程序中剪下您需要的整体，并在背景上绘制该精灵并降低不透明度。

# django-forms - multivaluedictkeyerror : 在 < 中找不到键

> ID：12486755
> 
> 赞同：0
> 
> 时间：2012-09-18T23:57:16.833
> 
> 标签：django-forms

我的模板包含一个表格：

```
<form action="." method="post">
<label {#for="q"#}>Search: </label>
<br>    
<input type="text" name="username" value="USERNAME" />
<br>
<input type="text" name="password" value="PASSWORD"/>
<br>    
<input type="submit" value="Search">
</form> 
```

但是在我写的 Django 代码中：

```
def register(request):
    userID = request.POST['username'] 
```

我收到错误消息：

```
MultiValueDictKeyError at /register/
"Key 'username' not found in < QueryDict: {}>" 
```

请帮忙。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:52:05.830

您没有发布到 URL。您不应该尝试`request.POST`在 GET 请求中使用；确保首先检查请求方法。

# c# - 更改 RichEditBox 中的文本颜色

> ID：12486757
> 
> 赞同：2
> 
> 时间：2012-09-18T23:57:20.707
> 
> 标签：c#, windows-8, windows-runtime

我正在使用`RichEditBox`Windows 8 中的新功能并尝试选择文本范围并更改文本颜色。下面的代码将下划线并更改所选文本的背景，但`ForegroundColor`不会更改，文本只是保持黑色。

```
result.Document.SetText(Windows.UI.Text.TextSetOptions.None, "Hello World");            
var range = result.Document.GetRange(0, 5);

range.CharacterFormat.Underline = Windows.UI.Text.UnderlineType.DoubleWave;
range.CharacterFormat.ForegroundColor = Windows.UI.Color.FromArgb(255, 0, 0, 255);
range.CharacterFormat.BackgroundColor = Windows.UI.Color.FromArgb(255, 0, 255, 0); 
```

如何更改`ITextRange`内部的文本颜色`RichEditBox`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:35:04.650

您需要致电`Document.ApplyDisplayUpdates`以查看对文本的更改。

```
result.Document.ApplyDisplayUpdates(); 
```

# scala - 在 trait 中定义的 Scala 尾递归流处理器函数持有对流头的引用

> ID：12486762
> 
> 赞同：11
> 
> 时间：2012-09-18T23:57:41.800
> 
> 标签：scala, stream, functional-programming

在以下情况下

```
trait T {

 @tailrec
 def consume[A](as: Stream[A]): Unit = {
    if (as.isEmpty) ()
    else consume(as.tail)
  }
 }

object O extends T 
```

调用足够大`O.consume(Range(1, N).toStream)`，`N`程序将耗尽内存，或者至少会消耗 O(N) 而不是所需的 O(1)。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-09-18T23:57:41.800

为特征生成尾递归方法。特征扩展器中的方法入口（此处`O`）将调用转发到特征的方法，但在这样做的同时，它保留对流头部的引用。

因此该方法是尾递归的，但内存仍然无法释放。补救措施：不要在特征中定义流函数，直接在对象中。

另一种方法是 scalaz's [`EphemeralStream`](https://github.com/scalaz/scalaz/blob/scalaz-seven/core/src/main/scala/scalaz/EphemeralStream.scala)，它持有对流头部和尾部的弱引用，并根据需要重新计算它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-07-02T03:14:46.880

有一个简单的解决方法。只需将您的尾递归流消费者包装在另一个通过名称参数接收流的函数中：

```
import scala.annotation.tailrec

trait T {
  def consume[A](as: => Stream[A]): Unit = {
    @tailrec
    def loop[A](as: Stream[A]): Unit = {
        if (as.isEmpty) ()
       else loop(as.tail)
    }
    loop(as)
  }
}

object O extends T {
  def main(args: Array[String]): Unit = 
    O.consume(Range(1, 1000000000).toStream) 
} 
```

forwarder 方法将持有对计算表达式的*函数*的引用，该表达式的结果是一个流：

```
public final class O$ implements T {
  public static final MODULE$;
  // This is the forwarder:
  public <A> void consume(Function0<Stream<A>> as) {
    T.class.consume(this, as);
  }
     .  .  .      

  public void main(String[] args) {
    consume(new AbstractFunction0() {
      public final Stream<Object> apply() {
        return package..MODULE$.Range().apply(1, 1000000000).toStream();
      }
    });
  }
} 
```

# java - 如何将图像插入到我的 Java 小程序中？

> ID：12486768
> 
> 赞同：1
> 
> 时间：2012-09-18T23:58:30.977
> 
> 标签：java

基本上我必须编写一个生成名片的 Java 小程序。我坚持的部分是弄清楚如何在小程序中显示自己的图像。

我对我的方向感到困惑的部分是它说：

> 这假设您在 BlueJ 项目的目录中有一个名为“businesscard.jpg”的图像

我如何将我的图片放入我的 BlueJ 项目的目录中？然后我如何以正确的方式获取代码，使其出现在小程序中？

```
import javax.swing.JApplet;
import java.awt.*; 
import java.net.*;
import javax.imageio.*;
import java.io.*;
import java.awt.Graphics2D;
import java.awt.image.*;

public class BusinessCard extends JApplet
{

    public void paint(Graphics page)
    {
        //Variables used in rectangle
        int x = 0;
        int y = 0;
        int width = 500;
        int height = 300;

        page.drawRect(x, y, width, height);  //draws the rectangle using variables

        //Displays name
        Font f = new Font("Helvetica", Font.BOLD, 26);
        page.setFont(f);
        page.drawString ("anon", 300,100);

        //Displays company
        Font g = new Font("Helvetica", Font.PLAIN, 18);
        page.setFont(g);
       page.drawString ("anon", 320, 120);

        //Displays email
        Font h = new Font("serif", Font.ITALIC, 15);
        page.setFont(h);
        page.drawString ("email", 320,140);

        //int for the logo
        final int MID = 350;
        final int TOP = 168;

        page.setColor (Color.orange);
        page.fillOval (MID, TOP, 60, 60); //bottom half of the trophy. the rounded part.
        page.drawArc (MID-8, TOP+15, 25, 25, 100, 160); //left arc
        page.drawArc (MID+43, TOP+15 , 25, 25, 280, 160); //right arc
        page.fillRect (MID+1, TOP+1, 59, 25); //make the top of the trophy flat basically
        page.fillRect (MID+22, TOP+60, 15, 25); //neck of the trophy
        page.drawLine (MID+48, TOP+84, MID+10, TOP+84); //base of the trophy

        page.setColor (Color.blue);
        Font i = new Font("serif", Font.BOLD, 20); 
        page.setFont(i);
        page.drawString ("#1", MID+20, TOP+30); //Creates the "#1" on the trophy.

        //The following is all code for inserting my image

          BufferedImage photo = null;

        try {
            URL u = new URL(getCodeBase(), "businesscard.jpg");
            photo = ImageIO.read(u);
        }   catch (IOException e) {
            page.drawString("Problem reading the file", 100, 100);
        }

        page.drawImage(photo, 10, 10, 150, 225, null);

    }

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-04-25T04:20:04.037

```
import javax.swing.*;
import java.awt.*; 
import javax.imageio.*;
import java.net.*;
import java.io.*;
import java.awt.image.*;
import java.applet.*;
public class Photo extends Applet
{
    public void paint(Graphics g)
    {        
      int x = 0;
      int y = 0;
      int width = 500;
      int height = 300;                     
      BufferedImage photo = null;
      try 
      {
         URL u = new URL(getCodeBase(),"Bike.jpg");
         photo = ImageIO.read(u);
      }   
      catch (IOException e) 
      {
         g.drawString("Problem reading the file", 100, 100);
      }
         g.drawImage(photo,x, y, width, height,null);
   }
} 
```

# c# - Visual Studio 2010无法打开Visual Studio 2012修改的2010解决方案

> ID：12486776
> 
> 赞同：10
> 
> 时间：2012-09-19T00:00:01.143
> 
> 标签：c#, .net, visual-studio-2010, visual-studio-2012

基本上，我有一个项目是用 C# 中的 Visual Studio 2010 Express 编写的，然后我尝试使用 Visual Studio 2012 Express 和该文件，现在 VS2010 说：

> “所选文件是解决方案文件，但由该应用程序的较新版本创建，无法打开。”

现在当我查到这一点时，微软说如果你不使用任何特定于 VS2012 的东西，你仍然可以使用 2010。好吧，我已经尝试了 VS2012 中的内置测试，这是唯一特定于 VS2012 的东西，但是从我的项目（测试项目）中删除它，仍然说它是由更新的版本。

那么，如何让 VS2012 修改后的 VS2010 解决方案再次与 VS2010 一起工作呢？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-09-21T14:01:26.047

VS 2010 的 SP1 需要打开 VS 2012 修改的解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-19T00:05:15.517

试试这个：

[http://vsprojectconverter.codeplex.com/](http://vsprojectconverter.codeplex.com/)

就我个人而言，我从未使用过它，但我将它标记为在遇到问题时使用的工具。希望能帮助到你！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T00:09:09.470

这可能不是您正在寻找的那种答案，但它过去曾为我解决兼容性问题等问题，因此值得一提。如果您的项目不太复杂，您可以创建一个新项目，然后复制并粘贴所有内容，从表单控件开始，然后移至代码。这是一个草率的解决方案，不能很好地扩展，但有时似乎没有其他任何工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-16T01:45:47.443

Andrew.Wu 的回复非常全面 [http://social.msdn.microsoft.com/Forums/en-US/vssetup/thread/fc763995-beed-4287-97de-6e47d3e87865](http://social.msdn.microsoft.com/Forums/en-US/vssetup/thread/fc763995-beed-4287-97de-6e47d3e87865)并详细说明了解决问题的步骤

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-13T10:43:15.910

很老...但希望它可以帮助某人...

第 1 步：转到保存项目 sln 文件的项目位置，然后右键单击它，选择“属性”。取消选中“只读”，如下所示：

步骤2：再次转到保存项目sln文件的位置，然后右键单击它以使用记事本打开它并将“Microsoft Visual Studio解决方案文件，格式版本12.00”更改为“Microsoft Visual Studio解决方案文件，格式版本 11.00”在文件中。

您也可以将“Visual Studio 2012”更改为 2010

# python - 如何在 PyX 中做天文符号“\sun”

> ID：12486778
> 
> 赞同：3
> 
> 时间：2012-09-19T00:00:33.117
> 
> 标签：python, graphics, pyx

我一直在尝试使用 PyX 将太阳的天文符号放在图表上，但没有成功。我的代码如下：

```
 from pyx import *
 from pylab import *
 x=arange(1,5,0.1)
 y=exp(-(x-3.0)**2/(2.0*0.5**2))/sqrt(2.0*pi*0.5**2)
 ######################
 g=graph.graphxy(width=8,y=graph.axis.linear(title=r"Fraction of DM halos"),x=graph.axis.linear(min=1,title=r"Mass ($10^{11}M_{\sun}$)"))
 g.plot(graph.data.values(x=x,y=y),styles=[graph.style.histogram()])
 g.writeEPSfile("testhistogram") 
```

我尝试添加`text.set(mode="latex")`后跟`text.preamble("\usepackage{mathabx}")`，但这不起作用（因为我知道这个符号在 mathabx LaTeX 包上）。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T01:42:03.193

我这里没有 pyx，但是您是否只是尝试使用 Unicode 字符串并为您想要的符号传入 unicode 字符？

太阳符号的 char 具有 unicode 编号 9737 (decimal, 0x2609 hex) ，因此您可以尝试这样做：

```
g=graph.graphxy(width=8,y=graph.axis.linear(title=r"Fraction of DM halos"),
   x=graph.axis.linear(min=1,
       title=u"Mass ($10^{11}M_\u2609$)")) 
```

# ruby - Capybara 和 Rspec 没有作用域

> ID：12486780
> 
> 赞同：3
> 
> 时间：2012-09-19T00:00:47.697
> 
> 标签：ruby, ruby-on-rails-3, capybara, rspec2

我有`Price`具有以下范围和属性的模型。

```
def self.total
  self.sum(:amount) + self.sum(:tax)
end

def self.today
  where(:date => Date.today)
end

def self.for_data
  where(:bought => true)
end 
```

我有获取当前用户今天总量的范围链。

```
<p class="today">
  Today
   <span class="amount today">
     <%= number_to_currency(current_user.prices.for_data.today.total) %>
   </span>
</p> 
```

我写了一个规范来测试这个。

```
# user_pages_spec

describe 'Overview Page' do
  it 'shows spending' do
     make_user_and_login
     price = FactoryGirl.create(:price)
     click_link('Overview') 
     page.should have_selector('title', :text => 'Overview')
     within('p.today', :text => 'Today') do
       page.should have_content('$1.01')
     end
  end
end 
```

这是我的价格工厂：

```
factory :price do
  amount '1.00'
  tax '0.01'
  bought true
  date Date.today
end 
```

不幸的是，这会返回错误：

```
1) UserPages Account Settings Data Page shows spending
 Failure/Error: page.should have_content('$1.01')
 expected there to be content "$1.01" in "\n\t\t\tToday\n\t\t\t$0.00\n\t\t" 
```

手动将其放置`$1.01`在视图中是可行的，但当我依赖于范围时则不行。看起来它在返回时一般没有检测到工厂或范围`$0.00`。为什么以及如何解决这个问题？

谢谢你。

* * *

支持/user_macros.rb

```
module UserMacros
  def make_user_and_login
    user = FactoryGirl.create(:user)
    visit new_user_session_path
    page.should have_selector('title', :text => 'Login')
    fill_in('Email',    :with => user.email)
    fill_in('Password', :with => user.password)
    click_button('Login')
    page.should have_selector('title', :text => 'Home')
  end
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T01:19:49.453

我认为问题是价格记录与 current_user 没有关系。所以在这种情况下，current_user 总数实际上是 0.00。您可以通过像这样更改价格工厂来解决这个问题：

```
factory :price do
  amount '1.00'
  tax '0.01'
  bought true
  date Date.today
  user { User.first || FactoryGirl.create(:user) }
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:05:04.107

我认为这是一个集成规范，因此您必须在交互步骤（登录）之前执行播种步骤（工厂创建）。

您可以执行以下操作以在工厂创建期间处理用户关联：

```
user = FactoryGirl.create(:user)
price = FactoryGirl.create(:price, user: user) 
```

# java - Java：替换字符串中缺少的 Unicode 符号？

> ID：12486781
> 
> 赞同：2
> 
> 时间：2012-09-19T00:00:47.313
> 
> 标签：java, string, unicode

我有一个相当直截了当的问题。当我从流中读取字符串时，所有字母都很好，除了符号。例如，如果我尝试读取其中包含 ™ 或 © 符号的用户名，则这些符号分别打印为：â„¢ 和 Â©。我认为 Java 支持所有的 Unicode 字符。如何正确打印符号？

有没有我可以使用的特殊类型的字符串，或者这个问题的另一种解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:09:19.850

从流中读取时，例如使用

```
InputStreamReader reader = new InputStreamReader(stream); 
```

您告诉 java 使用平台编码。这可能不是 Unicode 编码（实际上至少 50% 的时间考虑到 windows pc 出现的频率）

您需要指定字节流的编码，例如

```
InputStreamReader reader = new InputStreamReader(stream, charset); 
```

或者

```
InputStreamReader reader = new InputStreamReader(stream, "UTF-8"); 
```

如果使用字符集名称而不是字符集实例

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:40:23.620

根据您提供的字符示例，我相信您正确阅读字符。例如，版权字符是 Unicode A9。但是，当您以 UTF-8 将其写出时，它将被序列化为 2 个字节：C2 后跟 A9。见[http://www.fileformat.info/info/unicode/char/a9/index.htm](http://www.fileformat.info/info/unicode/char/a9/index.htm)

如果您的输出设备需要 UTF-8 格式的数据，一切都会好起来的。但是，由于您看到 Â©，我相信您的输出设备需要 ISO-8859-1 中的数据（请参阅[http://en.wikipedia.org/wiki/ISO/IEC_8859-1](http://en.wikipedia.org/wiki/ISO/IEC_8859-1)），因此您的数据不匹配。输出设备将 C2 解释为 Â，将 A9 解释为 ©。

要在代码中解决此问题（不更改输出设备），您需要创建一个打印流，在将 Unicode 字符转换为字节流时使用 ISO-8859-1 字符编码。例如：

```
public static void main (String [] args) throws Exception
{
    // use default character encoding
    String s = "copyright is ©";
    System.out.println(s);

    // create a new stream with a different encoding
    PrintStream out = new PrintStream(System.out, true, "ISO-8859-1");
    out.println(s);
} 
```

在我的情况下，第一个 println 看起来不错，因为 IDE 控制台窗口具有 UTF-8 编码，而第二个看起来是假的。在您的情况下，第一行应该是错误的（在版权符号应该出现的位置显示两个字符），第二行应该显示正确的版权字符。

# vba - 如何在列中查找目标值？

> ID：12486782
> 
> 赞同：-1
> 
> 时间：2012-09-19T00:00:51.840
> 
> 标签：vba, excel

哈哈！我会难倒你的 Excel 大师。;-D

我想根据一些分隔文本设置选择范围边界。

如果我这样做 Cells.Find 会搜索整个工作表并找到多个实例。我想要找到的可能是分隔符的第三或第四个实例。实际上它在特定的列 B 中。但是它是一个不连续的范围，并且该列中的实际搜索开始是几百个单元格。

如何在该列中搜索并设置我的可重用范围开始变量，设置为分隔符单元格（不包括分隔符单元格）？我试过这个：

```
Dim selectionStart As Range, selectionEnd As Range
Dim currentCell As Range, dataRange As Range
Dim lastRow As Range, insertRows As Range, destinationCell As Range

Range("b1", Range("b65536").End(xlUp)).Select

Set selectionStart = Selection.Find(What:="<-RANGE START->", After:=ActiveCell, LookIn _
    :=xlValues, LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:= _
   xlNext, MatchCase:=False, SearchFormat:=False) 
```

它选择范围但不设置变量。

我正在尝试所有这些令人讨厌的大东西，这样我就可以在没有太多眼睛疲劳的情况下看到它们的作用。不需要优雅。

TIA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:23:14.027

你是这个意思吗？

```
Option Explicit

Sub test()

Dim selectionStart As Range, selectionEnd As Range
Dim currentCell As Range, dataRange As Range
Dim lastRow As Range, insertRows As Range, destinationCell As Range
Dim rngtoSearch As Range
Dim foundValue As Variant
Dim foundAddress As String
Dim foundRow As Long

With sheetWhatever 'change to whatever sheet codename required
    Set rngtoSearch = .Range("b1", .Range("b65536").End(xlUp))

    Set selectionStart = rngtoSearch.Find(What:="<-RANGE START->", LookIn _
        :=xlValues, LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:= _
       xlNext, MatchCase:=False, SearchFormat:=False)

    'check it actually found a range
    If Not selectionStart Is Nothing Then
        'If found set the variable
        foundValue = selectionStart.Value 'set as value
        foundAddress = selectionStart.Address 'set as address string
        foundRow = selectionStart.Row ' set as row
    End If

End With

End Sub 
```

# c++ - 字符串文字开始迭代器和结束迭代器的 C++ 宏

> ID：12486783
> 
> 赞同：1
> 
> 时间：2012-09-19T00:00:53.957
> 
> 标签：c++, string, stl, macros

我想要这样的宏

```
STR_ITERATORS("My string") 
```

产生

```
 pBegin, pEnd 
```

例如，您可以使用它来搜索向量...

`std::vector<char> str1;`

`std::search(str1.begin(), str1.end(), STR_ITERATORS("Look for this"));`

请注意，搜索需要两对迭代器，宏提供第二对。

宏可以写两次——一次用于普通字符，一次用于宽字符。它不必一次性解决所有问题。

注意：我没有使用最新编译器的选项。（这让它有点无聊不是吗？:-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:25:33.980

在 C++11 中，为此创建自己的搜索函数很容易。

```
template<class iter1, class iter2>
iter1 search(iter1 stackbegin, iter1 stackend, iter2 needlebegin, iter2 needleend)
{return std::search(stackbegin, stackend, needlebegin, needleend);}

template<class iter1, class needlecontainer>
iter1 search(iter1 stackbegin, iter1 stackend, const needlecontainer& needle)
{return std::search(stackbegin, stackend, std::begin(needle), std::end(needle));}

template<class stackcontainer, class needlecontainer>
decltype(std::begin(std::declval<stackcontainer>()))
search(const stackcontainer& stack, const needlecontainer& needle)
{return std::search(std::begin(stack), std::end(stack), std::begin(needle), std::end(needle));}

template<class stackcontainer, class needlecontainer>
decltype(std::begin(std::declval<stackcontainer>()))
search(stackcontainer& stack, const needlecontainer& needle)
{return std::search(std::begin(stack), std::end(stack), std::begin(needle), std::end(needle));} 
```

并使用它们：

```
int main() {
    std::vector<char> str1;
    auto it = search(str1, "Look for this");
} 
```

编译证明：http: [//ideone.com/cO1rz](http://ideone.com/cO1rz)（这个版本的 gcc 没有`std::begin`，`std::end`所以我必须自己定义它们）和 C++03 版本：http: [//ideone.com/gt1Do](http://ideone.com/gt1Do)

如果你真的真的很想要一个简短的宏，你可以*保证*文字共享相同的空间：

```
template<int N>
const char* end(const char(&s)[N]) {return s+N;}
#define STR_ITERATORS(X) X, end(X) //BE WARNED, HIGHLY UNSAFE, NOT PORTABLE 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T01:04:00.443

boost range 提供了使用范围的算法重载，并将自动处理大多数类似 STL 的集合。具体来说，字符串也可以自动转换为范围。还有免费的函数开始和结束。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-09-19T00:08:01.420

```
template<int N>
int GetLengthOfLiteral(const wchar_t (&literal)[N]) { return N - 1; }

template<int N>
int GetLengthOfLiteral(const char (&literal)[N]) { return N - 1; }

#define LITERAL_ITERATORS(literal) (literal), ((literal) + GetLengthOfLiteral(literal) 
```

# dynamics-crm - 无法在 Visual Studio 2010 中添加 MSCRM 2011 WCF 服务引用

> ID：12486787
> 
> 赞同：0
> 
> 时间：2012-09-19T00:01:11.067
> 
> 标签：dynamics-crm, dynamics-crm-2011

技术朋友，

我无法在 Visual Studio 2010 中添加 MSCRM 2011 WCF 服务引用。尝试执行此操作时会引发错误。我们如何将此服务添加为 Visual Studio 2010 中的服务引用并生成所有代理类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-20T08:28:01.770

您是否尝试过遵循这些说明？[使用 Dynamics CRM 开发人员资源页面下载端点](http://msdn.microsoft.com/en-us/library/gg309401.aspx)。

特别是在“使用 WSDL”部分。

> 要将这些服务的服务引用添加到 Microsoft Visual Studio 2010 项目，您必须在“添加服务引用”对话框中指定地址时将 ?WSDL 附加到服务 URL。例如，发现服务 WSDL 地址是 `http://servername/xrmservices/2011/discovery.svc?wsdl.`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-24T11:35:46.693

我找到了问题的解决方案并且我已经测试过了:)

要在 Visual Studio 中添加发现服务和组织服务作为参考，我们必须添加查询字符串：?wsdl=wsdl0

例如：-

.api.crm4.dynamics.com/XRMServices/2011/Organization.svc? **wsdl=wsdl0**

这同样适用于发现服务。

检查此链接：

[http://social.msdn.microsoft.com/Forums/en-US/crmdevelopment/thread/033f9831-5e88-4b85-a4eb-a55985f39997](http://social.msdn.microsoft.com/Forums/en-US/crmdevelopment/thread/033f9831-5e88-4b85-a4eb-a55985f39997)

# java - Java 图像裁剪不准确

> ID：12486791
> 
> 赞同：0
> 
> 时间：2012-09-19T00:01:22.787
> 
> 标签：java, image, crop

这是我的代码，当您选择要裁剪的区域然后按回车键时，裁剪的图像与原始选定区域的大小/图片不同。

```
public class DragNDrop extends JFrame implements DropTargetListener {

private static final long serialVersionUID = 1872019741456690593L;

private Graphics g;
private BufferedImage image, origiImage;
private Rectangle area;
private Rectangle currentRect;
private Rectangle rectToDraw = null;
private Image buffer;

public static void main(String args[]) {
    new DragNDrop();
}

public DragNDrop() {
    super("Drop Test");
    setSize(300, 300);
    setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    setDropTarget(new DropTarget(getContentPane(), this));
    setVisible(true);

    CaptureListener listener = new CaptureListener();
    addMouseListener(listener);
    addMouseMotionListener(listener);
}

public void drop(DropTargetDropEvent dtde) {
    try {
        Transferable tr = dtde.getTransferable();
        DataFlavor[] flavors = tr.getTransferDataFlavors();
        dtde.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);
        Object list = tr.getTransferData(flavors[0]);
    list = list.toString().substring(1, list.toString().length()-1);
        if (isValidImage(list)) {
            Image droppedImage = Toolkit.getDefaultToolkit().getImage(list.toString());
            image = toBufferedImage(droppedImage);
            origiImage = toBufferedImage(droppedImage);
            area = new Rectangle(image.getWidth(), image.getHeight());
            if (droppedImage != null) {
                setSize(image.getWidth(), image.getHeight());
                dtde.dropComplete(true);
                addKeyListener(new KeyListener() {

                    @Override
                    public void keyTyped(KeyEvent e) {
                    }

                    @Override
                    public void keyReleased(KeyEvent e) {
                        if (e.getKeyCode() == 10) {
                            capture();
                        }
                    }

                    @Override
                    public void keyPressed(KeyEvent e) {

                    }
                });
                return;
            }
        }
        dtde.rejectDrop();
    } catch (Exception e) {
        dtde.rejectDrop();
    }
}

public void paint() {
    if (area != null && image != null) {
        g.clearRect(area.x, area.y, area.width, area.height);
        g.drawImage(image, 0, 0, null);
    }
    if (currentRect != null) {
        g.setColor(Color.RED);
        g.drawRect(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
        g.setColor(new Color(255,255,255,150));
        g.fillRect(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
    }
}

@Override
public void paint(Graphics gr) {
    if (buffer == null && area != null) {
        this.buffer = createImage(area.width, area.height);
        this.g = buffer.getGraphics();
    }
    paint();
    if (buffer != null)
        gr.drawImage(buffer, 0, 0, this);
}

public boolean isValidImage(Object list) {
    System.out.println(list.toString());
    for (String string : ImageIO.getReaderFormatNames())
        if (list.toString().contains(string))
            return true;
    return false;
}

public BufferedImage toBufferedImage(Image image) {
    if (image instanceof BufferedImage) {
        return (BufferedImage) image;
    }
    image = new ImageIcon(image).getImage();
    boolean hasAlpha = hasAlpha(image);
    BufferedImage bimage = null;
    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
    int transparency = Transparency.OPAQUE;
    if (hasAlpha == true) {
        transparency = Transparency.BITMASK;
    }
    GraphicsDevice gs = ge.getDefaultScreenDevice();
    GraphicsConfiguration gc = gs.getDefaultConfiguration();
    bimage = gc.createCompatibleImage(image.getWidth(null), image.getHeight(null), transparency);
    if (bimage == null) {
        int type = BufferedImage.TYPE_INT_RGB;
        if (hasAlpha == true) {
            type = BufferedImage.TYPE_INT_ARGB;
        }
        bimage = new BufferedImage(image.getWidth(null), image.getHeight(null), type);
    }
    Graphics g = bimage.createGraphics();
    g.drawImage(image, 0, 0, null);
    g.dispose();
    return bimage;
}

public static boolean hasAlpha(Image image) {
    if (image instanceof BufferedImage) {
        return ((BufferedImage) image).getColorModel().hasAlpha();
    }
    PixelGrabber pg = new PixelGrabber(image, 0, 0, 1, 1, false);
    try {
        pg.grabPixels();
    } catch (InterruptedException e) {
    }
    return pg.getColorModel().hasAlpha();
}

private void updateRectangle(int compWidth, int compHeight) {
    int x = currentRect.x;
    int y = currentRect.y;
    int width = currentRect.width;
    int height = currentRect.height;
    if (width < 0) {
        width = 0 - width;
        x = x - width + 1;
        if (x < 0) {
            width += x;
            x = 0;
        }
    }
    if (height < 0) {
        height = 0 - height;
        y = y - height + 1;
        if (y < 0) {
            height += y;
            y = 0;
        }
    }
    if ((x + width) > compWidth) {
        width = compWidth - x;
    }
    if ((y + height) > compHeight) {
        height = compHeight - y;
    }
    if (rectToDraw != null) {
        rectToDraw.setBounds(x, y, width, height);
    } else {
        rectToDraw = new Rectangle(x, y, width, height);
    }
}

public void capture() {
    BufferedImage croppedImage = origiImage.getSubimage(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
    setSize(rectToDraw.width, rectToDraw.height);
    image = croppedImage;
}

public void upload(BufferedImage image) {
    String IMGUR_POST_URI = "http://api.imgur.com/2/upload.xml";
    String IMGUR_API_KEY = "b84e430b4a65d16a6955358141f21a61";
    String readLine = null;
    try {
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        ImageIO.write(image, "png", outputStream);
        URL url = new URL(IMGUR_POST_URI);

        String data = URLEncoder.encode("image", "UTF-8") + "=" + URLEncoder.encode(Base64.encodeBase64String(outputStream.toByteArray()).toString(), "UTF-8") + "&" + URLEncoder.encode("key", "UTF-8") + "=" + URLEncoder.encode(IMGUR_API_KEY, "UTF-8");

        URLConnection urlConnection = url.openConnection();
        urlConnection.setDoOutput(true);
        OutputStreamWriter wr = new OutputStreamWriter(urlConnection.getOutputStream());
        wr.write(data);
        wr.flush();
        // Get the response
        InputStream inputStream;
        if (((HttpURLConnection) urlConnection).getResponseCode() == 400) {
            inputStream = ((HttpURLConnection) urlConnection).getErrorStream();
        } else {
            inputStream = urlConnection.getInputStream();
        }
        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
        String line;
        while ((line = reader.readLine()) != null) {
            readLine = line;
        }
        wr.close();
        reader.close();
    } catch(Exception e){
        e.printStackTrace();
    }
    //Prints the url link of the image uploaded
    System.out.println(readLine.substring(readLine.indexOf("<original>") + 10, readLine.indexOf("</original>")));
}

public void dragEnter(DropTargetDragEvent dtde) {

}

public void dragExit(DropTargetEvent dte) {

}

public void dragOver(DropTargetDragEvent dtde) {

}

public void dropActionChanged(DropTargetDragEvent dtde) {

}

private class CaptureListener extends MouseInputAdapter {
    public void mouseDragged(MouseEvent e) {
        updateSize(e);
    }

    public void mousePressed(MouseEvent e) {
        int x = e.getX();
        int y = e.getY();
        currentRect = new Rectangle(x, y, 0, 0);
        updateRectangle(getWidth(), getHeight());
        repaint();
    }

    public void mouseReleased(MouseEvent e) {
        updateSize(e);
    }

    public void updateSize(MouseEvent e) {
        currentRect.setSize(e.getX() - currentRect.x, e.getY() - currentRect.y);
        updateRectangle(getWidth(), getHeight());
        repaint();
    }
}

} 
```

有人可以查看我的代码并找出为什么它不裁剪完全相同的大小吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T04:20:08.340

您的裁剪逻辑没有问题，问题在于您的绘画逻辑。

首先，您永远不应该（好吧，`paint`在后面）覆盖顶级容器（如 a `JFrame`）。有很多原因，而您只是发现了其中一个。

其次，你应该总是打电话`super.paintXxx(g)`，不这样做是一个非常糟糕的主意。

老实说，我不知道这段代码试图做什么（除了双缓冲），如果你使用类似的东西就不需要`JPanel`

```
public void paint() {
    if (area != null && image != null) {
        g.clearRect(area.x, area.y, area.width, area.height);
        g.drawImage(image, 0, 0, null);
    }
    if (currentRect != null) {
        g.setColor(Color.RED);
        g.drawRect(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
        g.setColor(new Color(255,255,255,150));
        g.fillRect(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
    }
}

@Override
public void paint(Graphics gr) {
    if (buffer == null && area != null) {
        this.buffer = createImage(area.width, area.height);
        this.g = buffer.getGraphics();
    }
    paint();
    if (buffer != null)
        gr.drawImage(buffer, 0, 0, this);
} 
```

这不允许框架实际上为框架装饰留出空间（0x0 实际上是窗口的左上角，而不是内部绘图表面）......

所以我把你的代码拿来重写了......

```
public class DragNDrop extends JFrame {

    private static final long serialVersionUID = 1872019741456690593L;

    public static void main(String args[]) {
        new DragNDrop();
    }

    public DragNDrop() {
        super("Drop Test");
        setLayout(new BorderLayout());
        add(new ImagePane());
        setSize(300, 300);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setVisible(true);
    }

    protected class ImagePane extends JPanel implements DropTargetListener {

        private BufferedImage image, origiImage;
        private Rectangle currentRect;
        private Rectangle rectToDraw = null;

        public ImagePane() {

            setDropTarget(new DropTarget(getContentPane(), this));
            CaptureListener listener = new CaptureListener();
            addMouseListener(listener);
            addMouseMotionListener(listener);

            setFocusable(true);
            requestFocusInWindow();

            // Keybindings are better the KeyListeners, as the generally work...
            InputMap im = getInputMap(WHEN_FOCUSED);
            ActionMap am = getActionMap();

            im.put(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, 0), "Capture");
            am.put("Capture", new AbstractAction() {
                @Override
                public void actionPerformed(ActionEvent e) {
                    capture();
                }
            });

        }

        @Override
        protected void paintComponent(Graphics g) {
            // Look how simple this is...

            super.paintComponent(g);

            Graphics2D g2d = (Graphics2D) g;
            if (image != null) {
                g2d.drawImage(image, 0, 0, this);
            }

            if (currentRect != null) {
                g2d.setColor(Color.RED);
                g2d.drawRect(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
                g2d.setColor(new Color(255, 255, 255, 150));
                g2d.fillRect(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
            }
        }

        public void drop(DropTargetDropEvent dtde) {
            try {
                Transferable tr = dtde.getTransferable();
                DataFlavor[] flavors = tr.getTransferDataFlavors();
                dtde.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);
                Object list = tr.getTransferData(flavors[0]);
                list = list.toString().substring(1, list.toString().length() - 1);
                if (isValidImage(list)) {
                    Image droppedImage = Toolkit.getDefaultToolkit().getImage(list.toString());
                    image = toBufferedImage(droppedImage);
                    origiImage = toBufferedImage(droppedImage);
                    if (droppedImage != null) {
                        setSize(image.getWidth(), image.getHeight());
                        dtde.dropComplete(true);
                        // This is a bad idea, apart from KeyListeners are just a bad idea,
                        // Each time you drop a new image, your registering a new key listener :P
//                        addKeyListener(new KeyListener() {
//                            @Override
//                            public void keyTyped(KeyEvent e) {
//                            }
//
//                            @Override
//                            public void keyReleased(KeyEvent e) {
//                                if (e.getKeyCode() == 10) {
//                                    capture();
//                                }
//                            }
//
//                            @Override
//                            public void keyPressed(KeyEvent e) {
//                            }
//                        });
                        return;
                    }
                }
                dtde.rejectDrop();
            } catch (Exception e) {
                dtde.rejectDrop();
            }
        }

        public boolean isValidImage(Object list) {
            System.out.println(list.toString());
            for (String string : ImageIO.getReaderFormatNames()) {
                if (list.toString().contains(string)) {
                    return true;
                }
            }
            return false;
        }

        public BufferedImage toBufferedImage(Image image) {
            if (image instanceof BufferedImage) {
                return (BufferedImage) image;
            }
            image = new ImageIcon(image).getImage();
            boolean hasAlpha = hasAlpha(image);
            BufferedImage bimage = null;
            GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
            int transparency = Transparency.OPAQUE;
            if (hasAlpha == true) {
                transparency = Transparency.BITMASK;
            }
            GraphicsDevice gs = ge.getDefaultScreenDevice();
            GraphicsConfiguration gc = gs.getDefaultConfiguration();
            bimage = gc.createCompatibleImage(image.getWidth(null), image.getHeight(null), transparency);
            if (bimage == null) {
                int type = BufferedImage.TYPE_INT_RGB;
                if (hasAlpha == true) {
                    type = BufferedImage.TYPE_INT_ARGB;
                }
                bimage = new BufferedImage(image.getWidth(null), image.getHeight(null), type);
            }
            Graphics g = bimage.createGraphics();
            g.drawImage(image, 0, 0, null);
            g.dispose();
            return bimage;
        }

        public boolean hasAlpha(Image image) {
            if (image instanceof BufferedImage) {
                return ((BufferedImage) image).getColorModel().hasAlpha();
            }
            PixelGrabber pg = new PixelGrabber(image, 0, 0, 1, 1, false);
            try {
                pg.grabPixels();
            } catch (InterruptedException e) {
            }
            return pg.getColorModel().hasAlpha();
        }

        private void updateRectangle(int compWidth, int compHeight) {
            int x = currentRect.x;
            int y = currentRect.y;
            int width = currentRect.width;
            int height = currentRect.height;
            if (width < 0) {
                width = 0 - width;
                x = x - width + 1;
                if (x < 0) {
                    width += x;
                    x = 0;
                }
            }
            if (height < 0) {
                height = 0 - height;
                y = y - height + 1;
                if (y < 0) {
                    height += y;
                    y = 0;
                }
            }
            if ((x + width) > compWidth) {
                width = compWidth - x;
            }
            if ((y + height) > compHeight) {
                height = compHeight - y;
            }
            if (rectToDraw != null) {
                rectToDraw.setBounds(x, y, width, height);
            } else {
                rectToDraw = new Rectangle(x, y, width, height);
            }
        }

        public void capture() {
            BufferedImage croppedImage = origiImage.getSubimage(rectToDraw.x, rectToDraw.y, rectToDraw.width, rectToDraw.height);
            setSize(rectToDraw.width, rectToDraw.height);
            image = croppedImage;

            currentRect = null;

            repaint();
        }

        public void upload(BufferedImage image) {
          // Sorry, you can uncomment this can't you
//        String IMGUR_POST_URI = "http://api.imgur.com/2/upload.xml";
//        String IMGUR_API_KEY = "b84e430b4a65d16a6955358141f21a61";
//        String readLine = null;
//        try {
//            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
//            ImageIO.write(image, "png", outputStream);
//            URL url = new URL(IMGUR_POST_URI);
//
//            String data = URLEncoder.encode("image", "UTF-8") + "=" + URLEncoder.encode(Base64.encodeBase64String(outputStream.toByteArray()).toString(), "UTF-8") + "&" + URLEncoder.encode("key", "UTF-8") + "=" + URLEncoder.encode(IMGUR_API_KEY, "UTF-8");
//
//            URLConnection urlConnection = url.openConnection();
//            urlConnection.setDoOutput(true);
//            OutputStreamWriter wr = new OutputStreamWriter(urlConnection.getOutputStream());
//            wr.write(data);
//            wr.flush();
//            // Get the response
//            InputStream inputStream;
//            if (((HttpURLConnection) urlConnection).getResponseCode() == 400) {
//                inputStream = ((HttpURLConnection) urlConnection).getErrorStream();
//            } else {
//                inputStream = urlConnection.getInputStream();
//            }
//            BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
//            String line;
//            while ((line = reader.readLine()) != null) {
//                readLine = line;
//            }
//            wr.close();
//            reader.close();
//        } catch (Exception e) {
//            e.printStackTrace();
//        }
//        //Prints the url link of the image uploaded
//        System.out.println(readLine.substring(readLine.indexOf("<original>") + 10, readLine.indexOf("</original>")));
        }

        public void dragEnter(DropTargetDragEvent dtde) {
        }

        public void dragExit(DropTargetEvent dte) {
        }

        public void dragOver(DropTargetDragEvent dtde) {
        }

        public void dropActionChanged(DropTargetDragEvent dtde) {
        }

        protected class CaptureListener extends MouseInputAdapter {

            public void mouseDragged(MouseEvent e) {
                updateSize(e);
            }

            public void mousePressed(MouseEvent e) {

                requestFocusInWindow();

                int x = e.getX();
                int y = e.getY();
                currentRect = new Rectangle(x, y, 0, 0);
                updateRectangle(getWidth(), getHeight());
                repaint();
            }

            public void mouseReleased(MouseEvent e) {
                updateSize(e);
            }

            public void updateSize(MouseEvent e) {
                if (currentRect != null) {
                    currentRect.setSize(e.getX() - currentRect.x, e.getY() - currentRect.y);
                    updateRectangle(getWidth(), getHeight());
                    repaint();
                }
            }
        }
    }
} 
```

现在它工作...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T02:26:00.013

# 快速回答

您问的问题是窗口装饰（“框架”、标题栏等）覆盖了裁剪图像的一部分。（这就是为什么我认为与预期结果或上传/保存到文件的结果进行比较可能会有所帮助）。

就解决方案而言，您基本上必须确保您不会像外部边界那样调整窗口大小，而是为内容提供所需的空间。有几种方法可以做到这一点。MadProgrammer 将您的大部分代码移至面板类，并将其实例添加为 JFrame 的内容。

或者，您可以继续使用 JFrame contentPane 并确保在其上设置大小而不是框架：

```
getContentPane().setPreferredSize(new Dimension(newWidth, newHeight));
pack(); 
```

（在您的 JFrame 实例上调用方法，该解决方案从 Java 5 开始有效）

* * *

# 自己寻找答案

图像裁剪本身很好。您的问题出在其他地方，我想帮助您自己找到它。

## 最小化问题

您必须缩小代码中“奇怪的事情”发生的位置。所以不要盯着你的所有代码，而是复制一份，作为第一步，扔掉裁剪不需要的东西。扔掉上传的东西，你不需要它来裁剪。您的许多代码都涉及通过拖放获取文件名。将其缩短为命令行选项或纯硬编码字符串（硬编码的东西通常很糟糕，但对于调试它没关系）。等等。

实际上，裁剪不需要任何 GUI，真的。那么，如果您将裁剪后的图像写入文件而不是在窗口中显示，会发生什么情况呢？

## 知道会发生什么

无论是否使用 GUI，都列出您选择的位置（x，y）和尺寸（宽度，高度）。现在，您的程序裁剪的图像与使用 gimp/ImageMagick/... 以相同参数裁剪的相同图像相比如何？图像的哪些部分缺失？

## 问好问题

按照这些步骤并提出这些问题，您应该知道您的程序出了什么问题。至少，您将能够就您的问题提出一个简短而准确的问题。而且在 StackOverflow 上可能会有人可以回答！

# c# - 添加换行符

> ID：12486794
> 
> 赞同：0
> 
> 时间：2012-09-19T00:01:57.947
> 
> 标签：c#, string

下面的代码将字符添加`\r\n`到我的字符串变量中，但是一旦返回字符串，就会忽略换行符。

以下是返回字符串的片段：**Mondavi\r\nrms_processtype**

这是我添加换行符的代码：

```
 char[] charsToTrim = { ',', ' ' };
 feed = feed.TrimEnd(charsToTrim) + Environment.NewLine; 
```

这是尝试读取“feed”变量时出错的代码

```
var dict = feed.Split(new string[] { "\r\n", "\n" }, StringSplitOptions.None)
    .SelectMany(s => s.Split('|')).ToDictionary(t => t.Split(',')[0], t => t.Split(',')[1]); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:10:17.697

尝试`StringSplitOptions.RemoveEmptyEntries`

# ruby-on-rails-3.2 - Ruby f.select：分配css类的语法？

> ID：12486795
> 
> 赞同：4
> 
> 时间：2012-09-19T00:02:14.917
> 
> 标签：ruby-on-rails-3.2

**环境**

红宝石 1.9.3p194（2012-04-20 修订版 35410）[x86_64-darwin10.8.0]；导轨 3.2.6；OSX 10.6.8

**问题**

在尝试了以下语法的许多排列之后，我不得不问（可能是愚蠢的问题），**将 .css 类分配给 Ruby f.select 对象的正确语法是什么？**

```
<%= f.select :fieldname, 
options_for_select( [[ t('selector_instruction_string'), ""]] + countries, 
resource.fieldname), 
html_options { :class => 'Select_100pct' } %> 
```

**见最后一行（为了显示而断开）。**

**这种语法（以及许多类似的语法）要么被忽略，要么无法引发错误（或者）。**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-09-19T17:14:47.630

在我看来，当我阅读[文档](http://rdoc.info/gems/actionpack/ActionView/Helpers/FormBuilder:select)时，您的代码应该是：

```
<%= f.select :fieldname, options_for_select(...), {}, { :class => 'Select_100pct' } %> 
```

因为您只想指定`html_options`，所以只需传入一个空的 Hash `{}`for `options`。

# c - 将 C 中的图形渲染到 VB 控件

> ID：12486808
> 
> 赞同：0
> 
> 时间：2012-09-19T00:03:24.683
> 
> 标签：c, vb.net, dll, graphics

我已经用 C 语言编写了自己的 3D 图形软件管道（只是为了向自己证明我可以做到），并且看到它工作后，我想以 DLL 形式将它用作 Visual Basic .NET 的库。过去我在以这种方式混合 C 和 VB 方面取得了很好的成功（C 在 DLL 中完成了艰苦的工作，VB 看起来很漂亮），但我现在想做的有点不同。我的软件渲染器需要以 VB 形式显示图形，很可能在面板上。理想情况下，我会做两件事之一。首先，我可以在 Visual Basic 中创建一个 Bitmap 类的实例，以某种方式将指向像素数组的指针传递给 C 中的渲染函数，然后将位图绘制到面板上。或者第二，我可以更直接地控制面板上的图形，但我不确定它是如何工作的。有人知道我怎样才能实现我的目标吗？

编辑：到目前为止，我一直在使用 SDL 来显示图形。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-20T04:12:03.183

我相信我可能在这里找到了我想要的东西。

[http://msdn.microsoft.com/en-us/library/5ey6h79d.aspx](http://msdn.microsoft.com/en-us/library/5ey6h79d.aspx)

一旦我尝试我的计划，我会回来提供更多信息。基本上，我可以使用锁定位方法获取位图的像素数组的地址。我可以将它传递给我的 C 渲染函数。它应该可以完美运行。

# javascript - 防止代码被用户执行

> ID：12486809
> 
> 赞同：5
> 
> 时间：2012-09-19T00:03:29.523
> 
> 标签：javascript, obfuscation

所以我正在用 JavaScript 编写一个游戏，最大的问题是任何玩它的人可能对 JS 有相当了解的人都可以打开我的源代码，弄清楚它是如何工作的，然后将 a`game.score = 100000000000000;`插入控制台。但是，似乎除了混淆脚本之外，将所有内容包装在匿名函数中也可以解决问题。

```
(function() {
    game_start = function() {
        //etc
    }
    //etc
 })(); 
```

当我尝试从 Chrome 控制台运行任何代码时，它会出现`undefined`. 这是想要的结果，但是有没有办法绕过我的方法让它变得无用？甚至是防止从控制台运行的更好方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T00:17:32.790

没有办法确保这个人不会作弊。即使有严重混淆的代码（我说的是类似的东西`H5b(b){if(b.pd()&&b.Ca&&b.gKa){var a=b.ra(RT.Nwa)`），您仍然可以观察 UI 更改或网络请求并从那里进行跟踪。

有些人使用 AJAX 调用来验证分数，例如每次分数增加/减少时，应用程序都会对后端进行 AJAX 调用，并且您也在后端跟踪分数。当用户提交最终分数时，您将其与后端分数进行核对，如果不同，您将知道该人在作弊。

但是，这不会阻止人们编写一个脚本来进行这些 ajax 调用，并且这样可以使它的分数有效。

tl;dr：不，没有办法确保用户端代码不被泄露。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T00:09:40.187

抱歉，当游戏在他的机器上运行时，没有办法真正防止用户作弊。任何在用户机器上运行的代码都可以被用户操作。当你想让作弊变得不可能时，你必须在服务器上实现所有游戏逻辑，不要发送任何玩家不应该知道的信息，不要接受任何不允许玩家发出的命令做。

# oracle - Oracle 查询分组依据

> ID：12486811
> 
> 赞同：0
> 
> 时间：2012-09-19T00:04:26.733
> 
> 标签：oracle, group-by, max, having

我需要在最大日期之前返回 1 行，其中包含一些值的总和。但这 2 行是由不同的人更新的，但只需要显示最新更新的人 id。

我的查询是：

```
select v.code, sum(v.a_lines), sum(v.b_lines),
v.updated_by, f.period, max(v.updated_on)
from f_values v, f_file f where 
v.file_id = f.id
and v.code= '100002'
and 
to_char(f.period,'MM/DD/YYYY') = '03/31/2011'
group by v.code, v.updated_by, f.period 
```

这将返回 2 行：

```
102 30  100 xxx 31-MAR-11   10-AUG-11
102 50  200 yyy 31-MAR-11   07-OCT-11 
```

现在我们只需要返回 1 行。像这样的东西：

```
102   80   3000   yyy 31-Mar-11  07-Oct-11 
```

我知道这可以通过从列中删除“updated_by”来实现，但我需要填充它，但它只需要是最新的 updated_by 行（'yyy'）。希望我的问题很清楚

请告知这是否可能。提前致谢

哈里什

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:48:01.183

你说你想要最新的 updated_by 行。这似乎有点太明显了，但是从子句中`MIN(v.updated_by)`删除不会做你想要的吗？`v.updated_by``GROUP BY`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-24T16:15:26.810

通过使用让它工作

```
MAX(updated_by) KEEP (DENSE_RANK FIRST ORDER BY updated_on DESC) 
```

但是这个查询在 HQL 上不起作用，所以只好改成 SQL 查询。如果有人可以在 HQL 等价物上提供帮助，那就太好了。

谢谢

# spring - 日期范围查询不工作 mongoDB

> ID：12486814
> 
> 赞同：0
> 
> 时间：2012-09-19T00:05:03.987
> 
> 标签：spring, mongodb, spring-data-mongodb

我有 UesrFeedback 文件，如下所述，我想找出开始日期和结束日期之间的所有文件。我没有得到正确的结果 我得到的结果超出了开始日期和结束日期的范围。

这是文件：

```
class UserFeedbackImpl{
    private String userId;
    @Indexed
    private String resourceId;
    @Indexed
    private String resoruceType;
    private String rating;
    private String comments;
    private Date creationTimeStamp = new Date();
} 
```

MongoDB查询：

```
public List<UserFeedback> findUserFeedback(Date Start, Date end){
    Query query = new Query(Criteria.where("creationTimeStamp").gte(Start).andOperator(Criteria.where("creationTimeStamp").lte(end)));
    List<UserFeedbackImpl> pref = getTemplate().find(query,UserFeedbackImpl.class); 
```

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-25T22:14:57.270

我相信 andOperator 将 Criteria 列表作为其参数，所以你想要

```
Query query = new Query(Criteria.andOperator( Criteria.where("creationTimeStamp").gte(Start), Criteria.where("creationTimeStamp").lte(end) )); 
```

这是根据这里的弹簧文档：http: [//static.springsource.org/spring-data/data-mongo/docs/1.0.0.M5/api/org/springframework/data/mongodb/core/query/Criteria .html#andOperator(org.springframework.data.mongodb.core.query.Criteria](http://static.springsource.org/spring-data/data-mongo/docs/1.0.0.M5/api/org/springframework/data/mongodb/core/query/Criteria.html#andOperator(org.springframework.data.mongodb.core.query.Criteria) ...)

# iphone - Parse.com 从相关的 PFObject 获取 PFUser

> ID：12486817
> 
> 赞同：5
> 
> 时间：2012-09-19T00:05:36.447
> 
> 标签：iphone, ios, parse-platform

我将一张照片作为 PFObject 保存到 Parse，其中`[PFUser currentUser]`用户 ID 作为其键之一。

我想在表格视图中显示照片以及来自该 PFUser 的详细信息。但是当我尝试获取用户 - `PFUser *user = [self.photo objectForKey:@"user"];`- 然后尝试访问用户的显示名称时，我得到以下异常：

```
Terminating app due to uncaught exception 'NSInternalInconsistencyException', 
reason: 'Key "profilePicture" has no data.  Call fetchIfNeeded before getting 
its value.' 
```

但是，调用 fetchIfNeeded 会使表崩溃，而 AnyPic 教程正是我在不使用 fetchIfNeeded 的情况下尝试做的事情。AnyPic 只需调用`PFUser *user = [self.photo objectForKey:@"user"];`，一切正常。

我在某处错过了一步吗？谢谢！

这是`cellForRowAtIndexPath`：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath object:(PFObject *)object {
    static NSString *CellIdentifier = @"Cell";

    PhotoCellTest *cell = (PhotoCellTest *)[tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil) {
        cell = [[PhotoCellTest alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier descriptionText:nil userNameText:nil captionText:nil];
    }

    photo = object;
    PFUser *user = [self.photo objectForKey:@"user"];
    PFFile *profilePictureSmall = [user objectForKey:@"profilePicture"];
    cell.profilePicPlaceholder.file = profilePictureSmall;

    return cell;
} 
```

**编辑**

这是我为 PFObject 设置键的地方：

```
PFObject *photo = [PFObject objectWithClassName:@"Photo"];
    [photo setObject:[PFUser currentUser] forKey:@"user"];
    [photo setObject:self.photoFile forKey:@"image"];
    [photo setObject:[nameField text] forKey:@"itemCaption"]; 
```

这里是我为 PFUser 设置密钥的地方：

```
PFFile *profilePic = [PFFile fileWithData:data];
    [[PFUser currentUser] setObject:profilePic forKey:@"profilePicture"];
    [[PFUser currentUser] saveInBackground]; 
```

当我 NSLog 时`user`，我只得到`<PFUser:nOpK5splEX:(null)> { }`，但是当我 NSLog 时`[PFUser currentUser]`，我得到`<PFUser:nOpK5splEX:(null)> { displayName = "XXX"; facebookId = XXX; profilePicture = "<PFFile: XXX>"; username = XXX;}`......所以显然 PFUser 没有正确设置。

我应该在数据库中做些什么来链接用户字段或类似的东西吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-09-19T02:20:50.193

明白了 - 我没有`includeKey`在 PFQuery 中使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-05-11T14:51:28.680

后

`PFUser *user = [self.photo objectForKey:@"user"];`

你应该打电话

`[user fetchIfNeeded];`

# c++ - 层次结构ID C ADO

> ID：12486818
> 
> 赞同：0
> 
> 时间：2012-09-19T00:05:50.907
> 
> 标签：c++, mfc, sql-server-2008-r2, ado

我有一个 MS SQL Server 2008 R2 数据库，其中包含一个包含`HierarchyID`列的表。我正在使用 C++(MFC) 和 ADO。

当我读取层次结构的根记录时，它的`HierarchyId`值，当通过 检索时`ADO`，是一个`VARIANT`包含空的`SAFEARRAY`（UI1 有 0 个元素）。

当我尝试将其`VARIANT`作为参数传递回 SQL 函数时，出现错误。

SQL 服务器功能：

```
CREATE FUNCTION [MaintApp].[fnFindPersHier] ( @hHierId hierarchyid )
RETURNS TABLE
AS
RETURN 
(
    SELECT *
    FROM PersHier
    WHERE hHierId = @hHierId
) 
```

如何创建`VARIANT`包含 HierarchyID.GetRoot() 的等效项，以便可以将其传递给此函数？

# html - 如何检查用户点击了哪个复选框标签？

> ID：12486827
> 
> 赞同：0
> 
> 时间：2012-09-19T00:07:09.567
> 
> 标签：html, ruby, ruby-on-rails-3

在rails中，浏览器如何知道用户点击了哪个复选框？

```
=check_box_tag "name" 
```

我在这里检查了他们有[http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-check_box_tag](http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-check_box_tag)

```
check_box_tag(name, value = "1", checked = false, options = {}), 
```

有人可以解释上面的逻辑吗？它是否具有保存用户选择的复选框标签的功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T03:16:23.783

表单项（包括复选框）由它们的名称标识。只要您将它们包装在提交到服务器上所需路由的表单标签中，它就与任何其他表单（用户注册、登录等）没有什么不同。复选框数据将在您的控制器中的 params 哈希中可用。

例如，您认为此代码：

```
<%= form_tag("/checkboxes", :method => "get") do %>
  <%= check_box_tag(:box_1) %>
  <%= check_box_tag(:box_2) %>
  <%= check_box_tag(:box_3) %>
  <%= check_box_tag(:box_4) %>
  <%= submit_tag("Submit") %>
<% end %> 
```

将允许您在控制器中访问您的复选框，如下所示：

```
def checkboxes
  params[:box_1]
  params[:box_2]
  params[:box_3]
  params[:box_4]
end 
```

# python - Python：制作一个使用复数的类

> ID：12486828
> 
> 赞同：-2
> 
> 时间：2012-09-19T00:07:26.930
> 
> 标签：python, function, methods, syntax-error, complex-numbers

我目前正在尝试编写一个处理复数的程序。我必须使用类和方法。我试图能够加、减、乘等，复数，以及将它们相互比较。我认为我有一个良好的开端，但有一些问题。

每种方法我都开始了，我想我只需要填补空白。在方法中，我使用 self.x 作为占位符。我不太确定那里发生了什么。首先，程序需要创建自己的复数。我是制作方法和函数的新手，我不确定我是否在正确的地方使用了 (self)。

我很确定我有一些语法问题，即它一直说变量“i”没有定义，当我清楚地在多个地方定义它时。

一旦所有这些都解决了，我需要创建一个实际使用代码的测试函数。

任何帮助，将不胜感激。谢谢！

到目前为止我的代码：

```
import math
i = math.sqrt(-1) 

class Complex(object):

    def __init__(Complex, a, b):
        '''Creates Complex Number'''
        a = 0
        b = 0
        return(Complex, a, b) 

    def __str__(Complex, a, b):
        '''Returns complex number as a string'''
        a = 0
        b = 0
        return str(a, b) 

    def __add__(self):
        '''Adds complex numbers'''
        i = math.sqrt(-1) 
        self.x = (a + bi) + (c + di) = (a + c) + (b + d)i

    def __sub__(self):
        '''Subtracts complex numbers'''
        self.x = (a + bi) - (c + di) = (a - c) + (b - d)i

    def __mul__(self):
        '''Multiplies complex numbers'''
        self.x =  (a + bi) * (c + di) = (ac - bd) + (bc + ad)i

    def __div__(self):
        '''Divides complex numbers'''
        self.x =  (a + bi) / (c + di) = (ac + bd)/(c**2 + d**2) + (bc - ad)i/(c**2 + d**2)

    def __abs__(self):
        '''Determines absolute value of complex numbers'''
        self.x = math.sqrt(a**2 + b**2) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:31:17.463

# java - Eclipse 链接数据库更改通知

> ID：12486832
> 
> 赞同：2
> 
> 时间：2012-09-19T00:08:28.720
> 
> 标签：java, oracle, eclipselink, oracle-adf, change-notification

我有一个 java/j2ee 应用程序在使用 Eclipse 链接连接到 Oracle 数据库的 UI 上显示数据。

我希望数据库在发生任何更改时将数据推送回 UI。

我可以在 Eclipse 链接中本地执行推送更改通知，而无需我的应用程序轮询数据库以获取更新的结果吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T05:57:26.387

根据 Eclipselink 用户指南，我搜索了[http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Caching/DatabaseEvents](http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Caching/DatabaseEvents)，答案是肯定的。

坦率

# php - 以编程方式测试视频（m3u8 和 ts）文件是否损坏/不可播放

> ID：12486834
> 
> 赞同：2
> 
> 时间：2012-09-19T00:08:52.777
> 
> 标签：php, video

如何以编程方式浏览大量视频文件（包含密钥和 ts 文件的 m3u8 播放列表文件），并测试损坏的文件（或任何无法播放的视频文件）？

理想情况下，解决方案不重（即，它可以探测视频的一部分并确定其可播放性）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T01:17:31.853

使用 ffMPEG 或其姐妹 ffProbe。(http://ffmpeg.org/)

灯光选项：ffProbe 将为您提供有关视频和音频的信息。非常详细。将作为快速运行。

最重要的选项：ffMPEG 可以转换视频，如果您尝试将视频从一种格式转换为另一种格式，那么如果视频不好，它可能会失败。但请注意，这是一个 CPU 密集型操作，您需要对请求进行排队（每个 CPU 内核一个 ffMPEG 实例）。您还可以使用带有 -i 选项的 ffMpeg 为您提供快速且“轻量级”的视频信息

您在服务器上设置 ffProbe 或 ffmpeg - 它可以在 Windows 和 *nix 系统上运行，并且您通过 exec 调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:57:16.050

从技术上讲，有很多视频流不会以一种判断它们是否损坏的方式解码。除非它是包含对数据流进行某种检查的法典。

我不知道您指的是什么文件格式，但也许 PHP 的[开源 getID3 库](http://getid3.sourceforge.net/)会有​​所帮助。如果它无法提取标题信息，则该文件可能不是视频或坏的。它的重量也很轻，因为它只检查标题。

# android - 获取选定的 ListView 项目的 ID（使用 SQLite DB 填充的数据）

> ID：12486835
> 
> 赞同：4
> 
> 时间：2012-09-19T00:08:53.497
> 
> 标签：android, database, sqlite, listview

我有一个数据库来跟踪用户的提醒数据（提醒名称、注释、日期、时间等）。第一列是它的主键 (_ID)。ListView 是从数据库中填充的，它显示了一组带有提醒名称的简单行，如下所示：

* * *

把垃圾带出去。

* * *

遛狗。

* * *

吃午餐。

* * *

等等

* * *

现在我的问题是，如何让我的应用程序确定点击了哪个特定提醒？单击一行时，我需要从我的数据库中找到它的主键（_ID 列），并能够检索该行中的所有数据。

到目前为止，我知道我需要使用 onItemClick 来检测点击。但是如何获取被点击项目的主键值（_ID）呢？我当前的代码如下所示：

```
final Context context = this;

//DB Connectivity variables.
protected RemindersDAO remindersDAO;
protected SimpleCursorAdapter remindersCursorAdapter;
public ListView viewRemindersListView;

@SuppressWarnings("deprecation")
@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_view_local_reminders);

    // Get rid of the app title in the action bar.
    ActionBar actionBar = getSupportActionBar();
    actionBar.setDisplayShowTitleEnabled(false);

    viewRemindersListView = (ListView) findViewById(R.id.listview_view_local_reminders);

    remindersDAO = new RemindersDAO(this);
    Cursor cursor = remindersDAO.all(this);

    remindersCursorAdapter = new SimpleCursorAdapter(this,
                                     R.xml.view_reminders_item_layout,
                                     cursor, new String [] { RemindersDAO.NAME },
                                     new int[] { R.id.view_reminders_item_text } );

    viewRemindersListView.setAdapter(remindersCursorAdapter);
}

@Override
public void onItemClick(AdapterView<?> listView, View view, int position, long arg3) {
    remindersDAO = new RemindersDAO(this);
    Cursor cursor = remindersDAO.all(this);

    int idColIndex = cursor.getColumnIndex(RemindersDAO._ID); 
    int rowId = cursor.getInt(idColIndex); 
}

@Override
public boolean onCreateOptionsMenu(com.actionbarsherlock.view.Menu menu) {
    // TODO Auto-generated method stub
    MenuInflater inflater = getSupportMenuInflater();
    inflater.inflate(R.menu.activity_view_local_reminders, menu);

    return super.onCreateOptionsMenu(menu);
}

public boolean onOptionsItemSelected(MenuItem item) {
     //Set the classes that are called from each actionbar item.
     switch (item.getItemId()) {
         case R.id.local_reminders_actionbar_go_advanced:
             Intent i=new Intent(this, AdvancedNewReminder.class);
             startActivity(i);
             return true;
         case R.id.local_reminders_actionbar_simple_reminder:
             Intent k = new Intent(this, QuickNewReminder.class);
             startActivity(k);
             return true;

             /* case R.id.local_reminders_actionbar_google_tasks:
             showGoogleTasksBetaDialog();
             return true; */

     }
     return false;
 }

@Override
public void onBackPressed() {
    return;
} 
```

}

感谢你的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-09-19T01:28:18.467

In `onItemClick` method you can see 3rd param -`long id` is the `id` in database. So you just simple get that clicked item id

```
 @Override
    public void onItemClick(AdapterView<?> listView, View view, int position, long arg3) {
       Log.d("Clicked item id", " "+ arg3); 
    } 
```

if you want other fields you should get cursor of clicked item

```
 @Override
    public void onItemClick(AdapterView<?> listView, View view, int position, long arg3) {
     Cursor item=   (Cursor) reminderCursorAdapter.getItem(position);
Log.d("Clicked item field", " "+ item.getColum(your colum index)); 
    } 
```

# java - IntelliJ：生成开关盒

> ID：12486846
> 
> 赞同：84
> 
> 时间：2012-09-19T00:09:57.050
> 
> 标签：java, intellij-idea

真的没有办法为 IntelliJ 中的给定变量生成 switch case 吗？

Ctrl+Space 和 Ctrl+J 不会产生任何结果。

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2012-09-19T03:33:42.637

对于枚举变量，输入`switch (myEnumVar)`并按`Alt`+ `Enter`。智能完成将建议：`Create missing 'switch' branches`

[Crazy Coder](https://stackoverflow.com/users/104891/crazycoder)提供了以下屏幕截图，展示了如何启用**Create Enum Switch Branches**意图。

![意图：创建枚举开关分支](../Images/b4c5447a128086219a34497100416dbf.png)

请参阅[YouTrack 问题 6374](http://youtrack.jetbrains.com/issue/IDEABKL-6374)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2014-12-27T16:37:00.480

请按照此处的步骤操作：[https://confluence.jetbrains.com/display/PYH/Creating+and+applying+live+templates+(code+snippets)](https://confluence.jetbrains.com/display/PYH/Creating+and+applying+live+templates+(code+snippets))

对于上下文，使用 JAVA 和 switch - case 语句的代码将是：

```
switch($switchVar$) {
case $value$:
    $END$
    break;
default:
    break;
} 
```

对try-catch做同样的事情；）

```
try {
$END$
} catch(Exception e) {e.printStackTrace();} 
```

我喜欢 intellij 中的模板功能，并且经常使用它。

# unit-testing - 在单元测试中测试条件的 for 循环是否正常？

> ID：12486847
> 
> 赞同：0
> 
> 时间：2012-09-19T00:10:06.583
> 
> 标签：unit-testing, mocking, moq

我开始玩 xUnit 和 Moq 并且想知道我是否做得对。

我应该这样写测试：

```
[Fact]
public void ForWebShouldReturnDev()
{
    // Arrange
    var server = new Mock<HttpServerUtilityBase>();
    server.SetupSequence(s => s.MachineName).Returns("t11466").Returns("localhost").Returns("webdev");

    var context = new Mock<HttpContextBase>();
    context.SetupGet(c => c.Server).Returns(server.Object);

    var service = new EnvironmentService(context.Object, null);

    // Act / Assert
    service.GetApplicationEnvironment().Should().Be(ApplicationEnvironment.Dev);
    service.GetApplicationEnvironment().Should().Be(ApplicationEnvironment.Dev);
    service.GetApplicationEnvironment().Should().Be(ApplicationEnvironment.Dev);
} 
```

或者更像这样：

```
[Fact]
public void ForWebShouldReturnDev()
{
    // Arrange
    var server = new Mock<HttpServerUtilityBase>();

    var context = new Mock<HttpContextBase>();
    context.SetupGet(c => c.Server).Returns(server.Object);

    var service = new EnvironmentService(context.Object, null);

    // Act / Assert
    foreach (var name in new string[] { "t11466", "localhost", "webdev" })
    {
        server.Setup(s => s.MachineName).Returns(name);
        service.GetApplicationEnvironment().Should().Be(ApplicationEnvironment.Dev);
    }
} 
```

我知道您应该每次测试只测试一个代码单元，但是当测试中有变量时，循环断言是否可以？

我无法找出测试这些类型事物的最佳方法。

作为记录，下面是被测的实际代码：

```
// The constructor for the application environment
public EnvironmentService(HttpContextBase httpContext, IEnvironment environment)
{
    this.environment = environment;
    this.httpContext = httpContext;
}

private readonly Dictionary<ApplicationEnvironment, string> applicationEnvironments = new Dictionary<ApplicationEnvironment, string>() {
    { ApplicationEnvironment.Dev, "DEV" },
    { ApplicationEnvironment.Test, "TEST" },
    { ApplicationEnvironment.QA, "QA" },
    { ApplicationEnvironment.Prod, "PROD" }
};

public ApplicationEnvironment GetApplicationEnvironment()
{
    var machine = IsWeb ? httpContext.Server.MachineName : environment.GetCommandLineArgs().First();

    return applicationEnvironments.FirstOrDefault(x => machine.ToUpper().Contains(x.Value)).Key;
} 
```

关于起订量的更多细节，我还有另一个问题[。](https://stackoverflow.com/questions/12484241/setup-moq-to-return-multiple-values)

Moq 有什么好的资源吗，他们的文档很薄。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-10-31T11:26:39.817

如果使用 NUnit，我会亲自使用该`[TestCase]`属性，这样您仍在测试一件事，但要测试一组案例。

xUnit 中存在类似的东西， [在这篇 SO 帖子中的这篇文章中进行了解释](https://stackoverflow.com/questions/9110419/test-parameterization-in-xunit-net-similar-to-nunit)

# c - 如何保存到链接列表？

> ID：12486851
> 
> 赞同：0
> 
> 时间：2012-09-19T00:10:52.120
> 
> 标签：c, pointers, linked-list

我迷路了。我创建了一个链接列表，我想将数据保存到其中。当人们输入他们的名字时，我希望它保存在链接列表中。

我怀疑这是指向指针的问题，但我不习惯用于获取 get char 等输入的策略。无效代码（不是结构）在 int main() 之外，直到现在我从未在 int main() 之外编码。

在 int main() 函数中是我的链接列表代码。

所以我想将 int main 之外的函数调用到 int main 中，并指向一个指向名称的指针。我该怎么做？

非常感谢，TG52。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-20T05:15:22.590

你的代码是什么，你的问题是什么？

我知道很多你可能会考虑的列表实现 查看 glib 的实现（或者甚至更好地使用 glib）

[http://developer.gnome.org/glib/2.33/glib-Singly-Linked-Lists.html](http://developer.gnome.org/glib/2.33/glib-Singly-Linked-Lists.html)

您可以从以下位置下载各种收藏的完整来源：

[http://code.google.com/p/ccl/](http://code.google.com/p/ccl/)

如果你坚持自己做，你至少应该向我们展示你到目前为止所做的事情。

# ios - Facebook iOS SDK：无法使用 FBRequest 的 requestForUploadPhoto 指定相册：

> ID：12486852
> 
> 赞同：6
> 
> 时间：2012-09-19T00:10:56.420
> 
> 标签：ios, facebook, facebook-graph-api, facebook-ios-sdk

我的 iPhone 应用程序中有一张本地照片，我想将其上传到 Facebook 上专门用于我的应用程序的特定相册。

**问题：**我的应用名称以“照片”一词结尾，因此默认的 Facebook 相册`APP_NAME Photos Photos`- 显然是个问题。

**目标：**我想创建一个新相册，将其 ID 存储在 中`NSUserDefaults`，并且（在运行时进行一些验证后）将其用于将来从应用程序上传的所有照片。

**我在哪里：**我可以通过 Open Graph 制作新专辑，使用我想要的名称和描述，我可以检索它的 ID。我也可以很容易地上传照片。但是，我不知道如何指定上传照片的最终位置！

**代码：**这是我的照片上传代码，其中注释了一些结果。我假设这是我的问题所在，因为相册创建等工作正常。

```
- (void)postPhotosToFacebook:(NSArray *)photos withAlbumID:(NSString *)albumID {

    // Just testing with one image for now; I'll get in to multiple later..
    UIImage *image = [photos lastObject];

    FBRequest *imageUploadRequest = [FBRequest requestForUploadPhoto:image];

    // CALL OUT: I'm guessing my problem is here - but I just don't know!
    [[imageUploadRequest parameters] setValue:albumID
                                       forKey:@"album"];

    DebugLog(@"imageUploadRequest parameters: %@",[imageUploadRequest parameters]);

    // Results of DebugLog:
    // imageUploadRequest parameters: {
    //     album = 10151057144449632;
    //     picture = "<UIImage: 0xc6b6920>";
    // }
    // The album data returns correctly using FB's Graph API explorer tool,
    // so I know it's a legit album.
    // https://developers.facebook.com/tools/explorer

    FBRequestConnection *connection = [[FBRequestConnection alloc] init];

    [connection addRequest:imageUploadRequest
         completionHandler:^(FBRequestConnection *connection, id result, NSError *error) {

             if (!error) {

                 DebugLog(@"Photo uploaded successfuly! %@",result);

                 // Results of DebugLog:
                 // 
                 // Photo uploaded successfuly! {
                 //     id = 10151057147399632;
                 //     "post_id" = "511304631_10151057094374632";
                 // }
                 // Again, the photo at that ID shows up correctly, etc -
                 // BUT it's in the wrong album! It shows up in the default app album.

             } else {

                 DebugLog(@"Photo uploaded failed :( %@",error.userInfo);
             }

         }];

    [connection start];

} 
```

**猜测：**我猜我的问题在于我如何将专辑 ID 参数分配给图像请求。但我不知道。

您可以在[此 URL](https://developers.facebook.com/docs/sdk-reference/iossdk/3.0/class/FBRequest/#//api/name/requestForUploadPhoto%3a)上看到这应该是可能的..

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-19T00:23:20.000

啊，甜。我通过一些老式的、直接的修补来解决这个问题。

鉴于没有关于如何将“专辑”值应用于 FBRequest 的真正说明，我不愿称其为错误，但无论哪种方式，我都需要一种不同的方法——在这种情况下，只需创建一个通用的 Open Graph HTTP 请求和填写所有图像信息。

这种方法没有真正的缺点。除了你不能使用 requestForUploadPhoto: 方便方法。

这是我对正确方法的实现（删除的代码被注释掉）：

```
- (void)postPhotosToFacebook:(NSArray *)photos withAlbumID:(NSString *)albumID {

    UIImage *image = [photos lastObject];

//    FBRequest *imageUploadRequest = [FBRequest requestForUploadPhoto:image];
//    
//    [[imageUploadRequest parameters] setValue:albumID
//                                       forKey:@"album"];
//    
//    DebugLog(@"imageUploadRequest parameters: %@",[imageUploadRequest parameters]);

    NSString *graphPath = [NSString stringWithFormat:@"%@/photos",albumID];

    DebugLog(@"graphPath = %@",graphPath);

    NSDictionary *parameters = [NSDictionary dictionaryWithObjectsAndKeys:
                                image,@"picture",
                                nil];

    FBRequest *request = [FBRequest requestWithGraphPath:graphPath
                                              parameters:parameters
                                              HTTPMethod:@"POST"];

    FBRequestConnection *connection = [[FBRequestConnection alloc] init];

    [connection addRequest:request
         completionHandler:^(FBRequestConnection *connection, id result, NSError *error) {

             if (!error) {

                 DebugLog(@"Photo uploaded successfuly! %@",result);

             } else {

                 DebugLog(@"Photo uploaded failed :( %@",error.userInfo);
             }

         }];

    [connection start];

} 
```

# java - 如何应用密钥库/信任库对

> ID：12486857
> 
> 赞同：1
> 
> 时间：2012-09-19T00:12:01.040
> 
> 标签：java, ssl

我使用 java 的 keytool 创建了自己的 keystore.jks 和 truststore.jks。我需要知道如何在代码中实际使用它们。

```
System.setProperty("javax.net.ssl.keyStore", "C:/keystore.jks");
    SSLServerSocketFactory sslserversocketfactory;
    SSLServerSocket sslserversocket = null;
    SSLSocket sslsocket = null;
    try {
        sslserversocketfactory = (SSLServerSocketFactory) SSLServerSocketFactory
                .getDefault();
        sslserversocket = (SSLServerSocket) sslserversocketfactory
                .createServerSocket(PORT);
    } catch (IOException e) {
        e.printStackTrace();
        System.out.println("Could not listen on port: "
                + Integer.toString(PORT));
        System.exit(-1);
    } 
```

那是行不通的。我正在尝试使用我创建的东西设置客户端-服务器对。如果有人能解释我如何为 SSL 指定我的配对，我将不胜感激。谢谢。

# python - 在 OpenERP 中隐藏侧边栏按钮

> ID：12486861
> 
> 赞同：3
> 
> 时间：2012-09-19T00:12:25.667
> 
> 标签：python, openerp

我正在尝试为 OpenERP 6.1 编写一个模块，该模块将隐藏合作伙伴表单上的“发送短信”按钮。`name`我尝试用不同的and覆盖窗口操作的 id `src_model`，但只出现了名称更改。我跟踪了代码，看起来`ir_values`基本模块中的记录仍在将操作链接到`res.partner`模型。

是否有隐藏侧边栏按钮的合法方法，或者我将不得不修改基本模块？我短暂地尝试过限制向导表的权限，但这似乎没有效果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T05:25:00.233

试试[`<delete>`tag](http://doc.openerp.com/v6.1/developer/11_upgrade_and_migration.html#delete)吧，它适用于 XML 和 YAML。您可以通过其 XML id 删除特定记录，或使用搜索条件。

```
<delete model="ir.actions.act_window" id="other_module.action_id"/> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T04:41:32.230

在窗口的视图中添加

```
multi="False" 

<act_window name="Invoice Membership"
        res_model="membership.invoice"
        src_model="res.partner"
        multi="False"
        key2="client_action_multi"
        view_mode="form"
        id="action_membership_invoice_view"/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-19T11:22:23.430

进入“设置”模块：

*   打开菜单选项自定义 -> 低级对象 -> 窗口操作。
*   在 Action Name 中搜索“SMS”并打开它的表单。
*   在“安全”选项卡中，您可以设置可以查看此操作的组。添加“管理员/配置”组，它将对普通用户隐藏。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-19T12:26:27.750

只需添加 multi="True" 。
这允许在表单视图中隐藏操作，但您可以从菜单中的“操作”齿轮图标中使用它。

```
<act_window id="action_partner_sms_send" 
    name="Send an SMS"
    res_model="partner.sms.send"
    src_model="res.partner"
    view_mode="form"
    target="new"
    key2="client_action_multi"
    multi="True"/> 
```

参考：[https ://lists.launchpad.net/openerp-dev/msg00012.html](https://lists.launchpad.net/openerp-dev/msg00012.html)

谢谢你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-19T15:04:09.387

请尝试创建一个新组并将该组提供给您的按钮/链接，并且不要将此组添加给任何用户。

# arrays - 可以将堆栈视为具有成员函数的数组吗？

> ID：12486865
> 
> 赞同：1
> 
> 时间：2012-09-19T00:12:50.923
> 
> 标签：arrays, stack

假设我们使用的是堆栈的数组实现而不是链表实现。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T05:48:11.700

不完全是。您可以将堆栈集合视为数组的包装器。

数组以固定大小分配，而堆栈随着添加到其中的数据而增长。通常这是通过最初分配一个小数组来完成的，当数据超过当前数组时分配一个更大的数组。

# html - Chrome HTML5 视频横向翻转纵向

> ID：12486870
> 
> 赞同：11
> 
> 时间：2012-09-19T00:13:38.627
> 
> 标签：html, google-chrome, html5-video

我正在建立一个网站来显示从 iPhone 录制的视频。视频采用纵向，288x352。Safari 可以很好地显示此视频，但在 Chrome 中，视频被翻转为横向模式，352x288。我的头偏向一边。:-(

这是有问题的页面：http: [//aaron.tiberiuslog.com/B4F4CC56-172E-4D84-9656-BE04E6E475A0](http://aaron.tiberiuslog.com/B4F4CC56-172E-4D84-9656-BE04E6E475A0)

如果有帮助，这就是视频本身。

[http://tiberiuslog.s3.amazonaws.com/output_D7DB78A9-8019-4D09-9B22-EB8738F844BB-2380-000001530B13BE09.mov](http://tiberiuslog.s3.amazonaws.com/output_D7DB78A9-8019-4D09-9B22-EB8738F844BB-2380-000001530B13BE09.mov)

我尝试过使用香草 HTML5 标记，现在添加了[VideoJS](http://videojs.com/)，尽管它对这个问题没有任何影响。

**更新**：我现在对我的问题有一半的答案。似乎需要在设备上设置一些编码选项，以确保所有查看器都尊重正确的方向，包括 VLC 和 Chrome（例如）。这个问题没有足够的能力得到答案，所以[我创建了一个新问题](https://stackoverflow.com/questions/13465746/ios-avfoundation-setting-orientation-of-video)。希望我们会为这个问题提供适当的解决方案！

**更新 2**：我找到了答案！[我发布的另一个问题使我了解了在 iOS 上正确编码视频的技术](https://stackoverflow.com/questions/13465746/ios-avfoundation-setting-orientation-of-video)。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-11-07T01:03:50.130

请参阅videojs 支持论坛上的[这篇文章](http://help.videojs.com/discussions/problems/1508-video-orientation-for-iphone-wrong)，这表明这可能取决于 iPhone 编码视频的方式，因为它包含 QuickTime 可以读取但其他播放器不能读取的信息。建议您使用[AVFoundation](https://developer.apple.com/library/mac/#documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html)在 iOS 上对视频进行编码并旋转它。大概其他一些标准编码库也可以工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-11-10T14:13:54.640

这有点难看，但是您可以添加`-webkit-transform:rotate(90deg);`到标签的`style`属性中。`video`但是，这也会旋转您的控件。

我刚刚通过 VLC Player 从 AWS 流式传输视频，视频似乎逆时针旋转了 90 度。Apple 使用元数据标志来指示旋转，而不是简单地以不同的方向录制视频。不幸的是，许多播放器/浏览器会忽略此标志，包括 VLC 和 Chrome。

要解决此问题，您需要旋转实际的视频文件。您可以通过在 VLC Player 中打开它来执行此操作，转到`Tools > Effects and Filters`. `Video Effects`然后点击`Geometry`。启用`Transform`并`Rotate by 90 degrees`从下拉菜单中选择。单击`OK`然后关闭 VLC。视频现在应该已经准备好了，尽管我无法在您的页面上对其进行测试。

您现在可能需要删除旋转元数据标签，以便 Safari 不会进一步旋转视频。同样，我还没有测试过这个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-07-06T15:59:32.740

此问题已于 2016 年 6 月 2 日修复。请在[此处](https://bugzilla.mozilla.org/show_bug.cgi?id=1228601)参考 firefox 错误。这个问题不是 Iphone 如何编码视频，而是与支持 mp4 文件的 firefox 相关，但与 mp4 文件中的方向元数据无关。

无论如何，可以使用以下方法检查视频文件是否有旋转：`exiftool -Rotation video.mp4`

**注意：** 对于仍然看到此问题的任何人，此更新尚不可用，因为我的最新更新未正确自动定位视频。仔细一看，错误页面说目标是 mozilla49。

# javascript - 通过 jQuery 向 PrimeFaces selectOneListbox 添加新的选择值

> ID：12486871
> 
> 赞同：3
> 
> 时间：2012-09-19T00:13:38.503
> 
> 标签：javascript, jquery, jsf, primefaces

我需要将文本输入中的值动态添加到列表框字段。基本上，我正在制作一个自定义的多行文本组件。以下适用于标准`<h:selectOneListbox>`，但是当我使用 PrimeFaces 等效项时`<p:selectOneListbox>`，似乎什么都没有发生。我在我的应用程序中使用所有 PrimeFaces 输入，并且我希望保持外观一致。

```
<!--This works:-->

<h:form id="mainForm">
<p:inputText id="txtInput" /><p:commandButton value="Add" id="addTxt" 
onclick="addText()"/>
<h:selectOneListbox id="selectTxt"/>
<script type="text/javascript">
function addText(){
    var txtInput = $('#mainForm\\:txtInput').val();
    var opts = $('#mainForm\\:selectTxt').prop('options');
    opts[opts.length] = new Option(txtInput,txtInput,true,true);
        }
</script>
</h:form>

<!--This doesn't work:-->
<h:form id="mainForm">
<p:inputText id="txtInput" /><p:commandButton value="Add" id="addTxt"     
onclick="addText()"/>
<p:selectOneListbox id="selectTxt"/>
<script type="text/javascript">
    function addText(){
        var txtInput = $('#mainForm\\:txtInput').val();
        var opts = $('#mainForm\\:selectTxt_input').prop('options');
        opts[opts.length] = new Option(txtInput,txtInput,true,true);
        }
    </script>
    </h:form> 
```

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T12:28:16.757

使用`<p:selectOneListbox>`an`<ul><li>`而不是`<select><option>`来呈现选项（原因很简单，那就是有更多的自由来赋予它不同的外观'n'feel）。这正是您不能只创建和添加新`Option`元素的原因。在浏览器中右键单击页面并执行*查看源代码*，您会更好地理解它（当然，如果您已经熟悉基本的 HTML）。

请注意，以这种方式添加新选项似乎确实适用于`<h:selectOneListbox>`，但这纯粹是视觉上的，在客户端。JSF 在提交时不会接受在客户端创建的项目，但会抛出一个`Validation Error: Value not valid`简单的原因，即提交的值不是服务器端定义的项目的一部分`<f:selectItems>`。

您需要使用 JSF 而不是 JavaScript 来操作该`<f:selectItems>`值。这样它也可以工作`<p:selectOneListbox>`。

这是一个具体的启动示例，如何使用纯 JSF 进行操作：

```
<h:form>
    <p:inputText value="#{bean.text}" />
    <p:commandButton value="Add" action="#{bean.add}" update="listbox" />
    <p:selectOneListbox id="listbox">
        <f:selectItems value="#{bean.items}" />
    </p:selectOneListbox>
</h:form> 
```

和：

```
@ManagedBean
@ViewScoped
public class Bean {

    private String text; // +getter+setter
    private List<String> items; // +getter

    @PostConstruct
    public void init() {
        items = new ArrayList<String>();
    }

    public void add() {
        items.add(text);
    }

    // ...
} 
```

就这样。

### 也可以看看：

*   [当 UI 可以由 CSS、HTML、JavaScript、jQuery 实现时，JSF 需要什么？](https://stackoverflow.com/questions/4421839/what-is-the-need-of-jsf-when-ui-can-be-achieved-from-css-html-javascript-jquery)

# java - GUI 显示为空白

> ID：12486873
> 
> 赞同：3
> 
> 时间：2012-09-19T00:13:58.193
> 
> 标签：java, user-interface

这是我的问题。我只是想为朋友的生日写一个漂亮的小应用程序。问题是当我运行程序时，我最初得到一个空白的 GUI。但是，如果我稍微调整一下窗口的边框，问题就会出现，就像它应该出现的那样。

这只是在我放入`JTextArea`. 所要做的就是显示文本。它不会用于输入文本。关于我做错了什么有什么建议吗？我是不是越界了`JFrame`？

谢谢你的帮助。

```
import javax.swing.*;
import java.awt.*;

public class Birthday {

  private JFrame mainFrame;
  private JPanel mainPanel;
  private JPanel labelPanel;
  private JPanel buttonPanel;
  private JButton story;
  private JButton misc;
  private JButton next;
  private JLabel mainLabel;

  private JFrame miscFrame;
  private JPanel miscPanel;
  private JLabel miscLable;

  private JTextArea text;

  public Birthday(){
    gui();
  }

  public static void main(String [] args){
    Birthday b = new Birthday();

  }

  public void gui(){
    mainFrame = new JFrame("The Buttercup Project"); //main window
    mainFrame.setVisible(true);
    mainFrame.setSize(550,650);
    //mainFrame.setResizable(false);
    mainFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    text = new JTextArea(30,35);

    mainPanel = new JPanel(); //displays content in window
    mainPanel.setBackground(Color.YELLOW);
    mainPanel.setVisible(true);
    mainPanel.add(text);

    labelPanel = new JPanel();
    labelPanel.setVisible(true);
    labelPanel.setBackground(Color.LIGHT_GRAY);

    buttonPanel = new JPanel();
    buttonPanel.setVisible(true);
    buttonPanel.setBackground(Color.LIGHT_GRAY);

    story = new JButton("Story"); //button
    misc = new JButton("?");
    next = new JButton ("Next Story");
    mainLabel = new JLabel("The Buttercup Project"); //label

    labelPanel.add(mainLabel); //adds buttons to panel
    buttonPanel.add(story, BorderLayout.CENTER);
    buttonPanel.add(misc, BorderLayout.CENTER);
    buttonPanel.add(next, BorderLayout.CENTER);

    mainFrame.add(labelPanel,BorderLayout.NORTH );
    mainFrame.add(buttonPanel, BorderLayout.AFTER_LAST_LINE);

    mainFrame.add(mainPanel,BorderLayout.CENTER );  //put panel inside of frame

  }

} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T00:24:48.440

您不需要在每个面板上调用 setVisible()。您只需为包含它们的 JFrame 执行一次；添加完所有组件后，您也应该这样做。此外，请务必调用 mainFrame.pack() 以便计算正确的大小。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-19T00:24:04.627

`mainFrame.setVisible(true)`在方法结束时调用`gui()`。删除所有其他事件。

# c++ - C++ 中的未知 Seg 错误

> ID：12486875
> 
> 赞同：0
> 
> 时间：2012-09-19T00:14:14.637
> 
> 标签：c++, segmentation-fault

我似乎遇到了分段错误的问题。我不确定为什么。

```
int inputNumber;
vector<string> inputName;
// Input number of inputs
cout << "Enter the number of inputs you will be using" <<endl;
cin >> inputNumber;
while(floor(inputNumber) != inputNumber) {
    cin >> inputNumber;
}
cout << "Input Number reached" << inputNumber <<endl;

//Enter names of vectors
for(int x=0; x>=inputNumber; x++){
    string temp;
    cout << "Enter the name for input " << x << ": ";
    cin >> temp;
    inputName.append(temp);
    cout << x <<endl;
} 
```

标有 cout << "输入号码到达" << inputNumber << endl; 运行得很好。之后它会出现分段错误。我假设它涉及引用向量，但我不太确定。

# c - 仅使用加法/减法编写模函数

> ID：12486883
> 
> 赞同：5
> 
> 时间：2012-09-19T00:14:59.923
> 
> 标签：c, mips

我正在编写一个`MIPS`不能使用浮点计算 IE 模、除法、乘法的库。

我已经用 C 语言编写了除法和乘法函数，然后将该代码翻译为`MIPS`.

但是，我不知道如何编写一个函数来通过`C`仅使用加法或减法来计算模数。

**如何编写一个函数来仅使用加法和减法计算模数？**

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-09-19T00:24:49.477

**注意：**以下代码片段仅在两个操作数均为正数时才有效。我省略了对负值的任何处理，因为`x % y`一个或两个操作数为负时的结果在不同的语言和平台之间有所不同。一般来说，您可以只计算`abs(x) % abs(y)`然后对结果进行一些转换。

* * *

`x % y`仅使用加法和减法计算的最简单方法是重复减去`y`，直到剩余值小于`y`：

```
/* Compute x mod y naively. */
int mod_basic(int x, int y) {
    int result = x;   
    while (result >= y)
        result -= y;

    return result;
} 
```

但是，这种方法效率很低。一种更复杂但更快的方法是使用[二进制长除法](http://en.wikipedia.org/wiki/Binary_division#Division)。这类似于常规的长除法，除了在二进制中每一步的结果是`0`或者`1`而不是`0..9`。使用 BLD进行计算的基本方法`x % y`如下所示：

```
/* Compute x mod y using binary long division. */
int mod_bld(int x, int y)
{
    int modulus = x, divisor = y;

    while (divisor <= modulus && divisor <= INT_MAX/2)
        divisor <<= 1;

    while (modulus >= y) {
        while (divisor > modulus)
            divisor >>= 1;
        modulus -= divisor;
    }

    return modulus;
} 
```

上面的一个问题：必须在when`divisor <= INT_MAX/2`中停止溢出。`divisor <<= 1``x > MAX_INT/2`

此外`divmod`，它在一次计算中为您提供商和模，看起来几乎完全相同：

```
/* Compute divmod(x, y) using binary long division. */
void divmod(int x, int y, int *div, int *mod) {
    int quotient = 0, modulus = x, divisor = y;

    while (divisor <= modulus && divisor <= INT_MAX/2)
        divisor <<= 1;

    while (modulus >= y) {
        while (divisor > modulus) {
            divisor >>= 1;
            quotient <<= 1;
        }

        modulus -= divisor;
        quotient++;
    }

    while (divisor != y) {
        quotient <<= 1;
        divisor >>= 1;
    }

    *div = quotient;
    *mod = modulus;
} 
```

最后，请注意，如果`y`是 2 的幂，则可以作弊。在这种情况下`x % y`只是`x & (y - 1)`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-19T00:26:49.650

二进制长除法可以解决问题：

16 / 3 的示例（二进制 10000 [2] / 11 [2]）：

```
 10000 | Quotient
 1     | 0         // 1 < 11 (append 0 to quotient, no effect)
 10    | 0         // 10 < 11 (append 0 to quotient, no effect)
 100   | 1         // 100 > 11, append 1 to quotient
- 11   | 
----   |
   1   |
   10  | 10        // 10 < 11, append 0 to quotient
   100 | 101       // 100 > 11, append 1 to quotient
 -  11 | 101
 ----- |
     1 | 101       // Quotient = 101, Remainder = 1 
```

由于结果是二进制的，因此您可以立即判断何时将 0 或 1 附加到商：当先前计算的片段小于除数时，则附加 0；当片段大于除数时，追加1。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T01:36:40.317

> 我用 C 语言编写了除法和乘法函数，然后将该代码翻译成 MIPS。

我猜你写的除法函数可能已经在算法结束时计算了模数 x%N。出于这个原因，像 x86 这样的高级架构提供了同时返回 x/N 和 x%N 的汇编指令（例如 divl）：通常用于计算一个的任何算法都会自动给出另一个，所以你可以杀死两只鸟如果同时需要两者，则用一块石头。

此外，如果您编写了除法和乘法函数，那么您就拥有了计算模数所需的一切，因为`x%N == x - N*( x/N )`. 所以在最坏的情况下，如果你想只使用加减法计算 x%N，并且你知道如何只使用加减法进行乘除，那么你可以使用上面的公式得到 x%N。话虽如此，您可以做得比这更好，例如通过已经建议的长除法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-16T22:24:48.943

虽然不如上面的实现高效，但如果在面试中问过这个问题，这里有一个 JavaScript 中的快速递归解决方案。请注意，这也支持负数和十进制输入。

```
var modulo = function(x, y) {
    y = Math.abs(y);
    return (x < y) ? x : modulo(x - y, y);
};

console.log(modulo(12, 5)); //2
console.log(modulo(10, 2)); //0
console.log(modulo(4, 10)); //4
console.log(modulo(4, 2.4)); //1.6
console.log(modulo(-1, 10)); //-1
console.log(modulo(10, -3)); //1
console.log(modulo(10, -4)); //2
console.log(modulo(10, -3)); //1 
```

# php - Javascript 和 PHP 倒计时计时器，每个人都显示相同

> ID：12486885
> 
> 赞同：6
> 
> 时间：2012-09-19T00:15:22.240
> 
> 标签：php, javascript, mysql, dynamic, timer

我有生成具有开始和恢复按钮的倒数计时器所需的脚本。我正在尝试做的是在一个页面上设置开始、停止和重置按钮来控制另一页上的计时器。因此，如果用户 X 访问 page.html，他们将看到计时器为 0。管理员 X 访问 admin.html，他们看到计时器为 0，但他们也有一个开始、停止和重置按钮。当管理员单击按钮时，page.html 上的计时器开始倒计时。如果其他用户在计时器倒计时时访问该页面，他们将看到计时器当前所在的位置。如果有人有任何代码想法、我可以参考的本网站上的其他答案或我需要的代码，我将非常感激。

---真实场景 我们在 Skype 上有人正在做节目，他们需要知道什么时候该休息一下。这个想法是，制作人可以点击一个按钮来启动倒数计时器，让他们知道他们还有 60 秒的时间休息。我想要在网页上显示此内容的原因是因为 Skype 上的人正在关注页面中发生的其他事情。所以我想要一些他们不能错过的东西。我可以访问 sql 服务器，并且可以同时执行 php 和 javascript。我猜我需要将两者结合起来。

更新感谢大家的帮助。

我正在更新这个，因为我意识到我可能让事情变得比现在需要的更复杂。每 30 分钟有一次休息，所有节目都将在一小时后或 30 分钟后开始。我终于想出了完美的剧本。虽然它可能会因为正常的时钟漂移而略有偏差，但无论谁进入页面，它实际上都应该显示相同的内容。

```
<script>
 function addZero(i)
{
if (i<10)
  {
   i="0" + i;
  }
 return i;
 }
 setInterval(function() {
   function addZero(i)
{
if (i<10)
  {
  i="0" + i;
  }
return i;
}
    var d = new Date();
    var s =(d.getSeconds());
    var m =(d.getMinutes());
    var x = document.getElementById("timer");
    var c = addZero(30 - m) + ":" + addZero(60 - s);
    var d = addZero(60 - m) + ":" + addZero(60 - s);
    if (m < 30) {
        t = c
    }
    else {
        t = d
    }

     x.innerHTML = t;
 }, 250) 
    </script>    
 <div align="center">
    <table><tbody>
    <tr><td style="font-size:34px;" id="timer"></td>
    <td nowrap="nowrap" width="15px"><p style="text-align: left;"></p></td>
    <td style="font-size:24px;">Minutes till Station Break.</td></tr>
     </tbody></table>
          </div> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:28:12.643

听起来您需要一个[COMET/Push](http://en.wikipedia.org/wiki/Comet_%28programming%29)解决方案，它允许您监控活动客户端并将新数据推送给它们。我不确定 PHP 是不是最好的解决方案，因为还有其他编程语言可以更优雅地处理这个问题。

请参阅：[将彗星与 PHP 一起使用？](https://stackoverflow.com/questions/603201/using-comet-with-php)

其他人可能不同意，但[Node.js](http://nodejs.org/)是解决这种特殊类型问题的绝佳解决方案。将Node.js 与[Socket.io](http://socket.io/)结合起来，您就有了基本工具来实现您所描述的内容。

简而言之，客户端应用程序将向服务器发送 AJAX 请求。然后服务器将保留该请求，直到它有一些返回（在您的情况下 - 计时器启动，计时器滴答，计时器暂停等）。一旦返回数据，服务器将发出另一个请求并保持，从而重复该过程。如果您的服务器和客户端支持[WebSockets](http://en.wikipedia.org/wiki/WebSocket)，那么可以避免保持 AJAX 连接，而支持 WebSocket（TCP over HTTP）连接。

因为不是每个人都在使用最新版本的 Chrome/Firefox，所以您可能必须支持多种推送方法才能跨浏览器兼容。Socket.io 抽象了通信层（Comet - 长轮询、WebSockets、Adobe Flash Socket、Ajax 多部分流、Forever Iframe、JSONP 轮询），并根据客户端的浏览器功能选择最佳技术。

**选择**

您还可以使用 javascript 间隔定期轮询服务器（通过 AJAX）以查看是否已设置计时器。但是，您可能会用请求淹没您的服务器，因为每个客户端都会不断地轮询服务器以确定 60 秒计时器是否已启动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-21T05:50:21.423

我终于想出了一个可行的解决方案。还有一些元素我还没有完全弄清楚如何修复，但下面的代码基本上完全符合我现在的需要。

```
setInterval(function() {
function addZero(i) {
    if (i < 10) {
        i = "0" + i;
    }
    return i;
}
var x = document.getElementById("timer");
var d = new Date();
var s = (d.getSeconds());
var m = (d.getMinutes());
var a = addZero(30 - m);
var b = addZero(60 - m);
var c = (60 - s);
var z = "<span style='color:red;font-size:50px;'>" + "Break" + "</span>";
var v = "<span style='color:black;font-size:24px;'>" + "Break" + "</span>";

if (m > 30) {
    y = b;
}
else if (m < 30) {
    y = a;
}
if (y < 2 && c < 15) {
    q = z;
}
else {
    q = v;
}

var t = y + (":" + addZero(c) + " Till Station " + (q));
x.innerHTML = t;
}, 250);

<div align="center" id="timer" style='color:black;font-size:24px;' ></div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T00:36:45.447

当管理员启动计时器时，服务器保存`start_time`和`duration`计时器（60 秒）（在数据库、文件或其他内容中）。当用户访问 page.html，`start_time`并`duration`从服务器接收时，计算`finish_time`（或`finish_time`在保存时计算）。然后`finish_time - current_time`是一个区别，即定时器的当前状态。

```
$start_time = strtotime( '2012-09-19 00:30:05' );
$duration   = 300; //300 seconds = 5 minutes (60 * 5)

$finish_time = $start_time + $duration;

$timer_state = $finish_time - time(); 
```

`$timer_state`传递给javascript并倒计时为零。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-24T02:01:40.600

这是我现在使用的最终解决方案.... 以下是在一个名为 timer.js 的文件中

```
setInterval(function() {
function addZero(i) {
    if (i < 10) {
        i = "0" + i;

    }
    return i;
}
var d = new Date();
var s = (d.getSeconds());
var m = (d.getMinutes());
var x = document.getElementById("timer")
var a = (29 - m);
var b = (59 - m);
var f = (60 - s);
 if (m < 30) {
    e = addZero(a);
}
else {
    e = addZero(b);
}
var c = " Minutes Till Station ";
var z = "<span style='color:red;font-size:50px;'>" + "Break" + "</span>";
var v = "<span style='color:white;font-size:24px;'>" + "Break" + "</span>";

if (e < 1 && f < 30) {
    t = (e) + ":" + addZero(f) + (c) + (z);
}

else {
    t = (e) + ":" + addZero(f) + (c) + (v);
}

x.innerHTML = (t);
  }, 250); 
```

然后我在页面上使用它来显示最终结果。

```
<script language="javascript" src="timer.js"></script>
<div id="timer" style='margin-top:150;float:center;color:white;font-size:24px;'></div> 
```

# asp.net - 使用 ASP.NET Membership 获取具有所有自定义属性的所有用户配置文件

> ID：12486889
> 
> 赞同：1
> 
> 时间：2012-09-19T00:16:44.693
> 
> 标签：asp.net, asp.net-mvc, asp.net-membership, asp.net-authentication

我正在创建一个 MVC4 Web 应用程序，它使用 ASP.NET 表单身份验证并定义了自定义配置文件属性，例如名字和姓氏。

经过一番争论，这对于注销小部件来说效果很好：

```
Hello, 

@((Profile as ProfileCommon).FirstName)

@((Profile as ProfileCommon).LastName) 
```

但是现在我需要制作一个管理屏幕，显示（除其他外）所有作者的名字和姓氏，以获取文档列表。

这是为了显示信息网格，因此出于性能原因，我无法为每个用户进行数据库绑定调用。我需要在一两个查询中获取所有信息。

我每行都有作者的会员用户 ID GUID。因此，我需要将所有用户的名字和姓氏从 GUID 中删除。

在查看了有关此主题的其他一些 SO 帖子后，我想出了这个静态方法来获取信息：

```
public static IEnumerable<UserInfo> GetUserInfos()
{
    var members = Membership.GetAllUsers();

    var profiles = ProfileManager.GetAllProfiles(ProfileAuthenticationOption.All);

    foreach (MembershipUser member in members)
    {
        var profile = profiles[member.UserName];

        if (profile != null)
        {
            yield return new UserInfo
            {
                UserId = (Guid)member.ProviderUserKey,

                FirstName = profile.???,

                LastName = profile.???
            };
        }
    }
} 
```

我成功地从方法中获取了成员和个人资料。但所有配置文件对象都是 ProfileInfo 对象，而不是 ProfileCommon 或 ProfileBase。他们似乎没有任何方法可以访问自定义属性。

*为什么此技术缺少自定义属性？我怎样才能得到它们？*

有没有更好或更简单的方法来做到这一点？

作为参考，相关的 web.config 值：

```
<authentication mode="Forms">
    <!--<forms name=".ASPXAUTH" protection="None" domain=".napa-ibs.com" path="/" loginUrl="Account/Login" />-->
    <forms name=".ASPXAUTH" protection="None" path="/" loginUrl="Account/Login" />
</authentication>
<roleManager enabled="true">
    <providers>
        <clear/>
        <add
            name="AspNetSqlRoleProvider"
            connectionStringName="AuthenticationDatabase"
            applicationName="IBSRegistration"
            type="System.Web.Security.SqlRoleProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
    </providers>
</roleManager>
<membership>
    <providers>
        <clear/>
        <add
            name="AspNetSqlMembershipProvider"
            type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
            connectionStringName="AuthenticationDatabase"
            enablePasswordRetrieval="true"
            enablePasswordReset="true"
            requiresQuestionAndAnswer="false"
            applicationName="IBSRegistration"
            requiresUniqueEmail="false"
            passwordFormat="Clear"
            maxInvalidPasswordAttempts="100"
            minRequiredPasswordLength="7"
            minRequiredNonalphanumericCharacters="1"
            passwordAttemptWindow="10"/>
    </providers>
</membership>
<profile enabled="true">
    <providers>
        <clear/>
        <add
            name="AspNetSqlProfileProvider"
            connectionStringName="AuthenticationDatabase"
            applicationName="IBSRegistration"
            type="System.Web.Profile.SqlProfileProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
    </providers>
    <properties>
        <add name="FirstName" type="string"/>
        <add name="LastName" type="string"/>
        <add name="Title" type="string"/>
        <add name="District" type="string"/>
        <add name="DC" type="string"/>
        <add name="Address1" type="string"/>
        <add name="Address2" type="string"/>
        <add name="City" type="string"/>
        <add name="State" type="string"/>
        <add name="ZipCode" type="string"/>
        <add name="IsApproved" type="bool"/>
        <add name="RegistrationDate" type="DateTime"/>
    </properties>
</profile> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:42:29.580

您需要获取对 CommonProfile 对象的引用才能访问您的自定义属性。

```
public static IEnumerable<UserInfo> GetUserInfos()
{
    var members = Membership.GetAllUsers();

    var profiles = ProfileManager.GetAllProfiles(ProfileAuthenticationOption.All);

    foreach (MembershipUser member in members)
    {
        var profile = profiles[member.UserName];
        ProfileCommon profileCommon = Profile.GetProfile(profile.UserName);

        if (profileCommon != null)
        {
            yield return new UserInfo
            {
                UserId = (Guid)member.ProviderUserKey,

                FirstName = profileCommon.FirstName,

                LastName = profileCommon.LastName
            };
        }
    }
} 
```

# ruby - HAML 运行内联 Ruby，但不渲染任何内容

> ID：12486892
> 
> 赞同：-2
> 
> 时间：2012-09-19T00:17:26.727
> 
> 标签：ruby, sinatra, haml, padrino

```
-#encoding: utf-8
:css
 .hidden{display:none;}
%script{:src=>"/javascripts/jquery.js"}
%form{:action=>"https://get724.ccvb.com.tr/Get724/get724uye.aspx",:method=>"post"}
 %input.hidden{:type=>"text",:name=>"uyeno",:value=>""}
 %input.hidden{:type=>"text",:name=>"kkno",:value=>""}
 %input.hidden{:type=>"text",:name=>"gectar",:value=>""}
 %input.hidden{:type=>"text",:name=>"tutar",:value=>""}
 %input.hidden{:type=>"text",:name=>"dcins",:value=>""}
 %input.hidden{:type=>"text",:name=>"sipbil",:value=>""}
 %input.hidden{:type=>"text",:name=>"sesbil",:value=>""}
 %input.hidden{:type=>"text",:name=>"burl",:value=>""}
 %input.hidden{:type=>"text",:name=>"hurl",:value=>""}
 - t = Time.now.strftime("%Y%m%d%H%M%S")
 - puts t
 %input.hidden{:type=>"text",:name=>"zaman",:value=>"#{t}"}
 -puts "adfasdf : " + @asdf.to_s
 -puts "asdf"
 -puts "asdf : " + @asdf.to_s
 -puts session[:ewer]
 -puts session[:zxcv]
 -puts strtodigest
 -digest = Digest::SHA1.base64digest(strtodigest)
 -puts digest
 -#%input{:type=>"text",:value=>"#{strtodigest}"}
 -#%input{:type=>"text",:value=>"#{digest}"}
 %input.hidden{:type=>"text",:name=>"ozet",:value=>"#{digest}"}
:javascript
  $('form').submit();
-puts "End Of Haml" 
```

我有一个像上面这样的 haml，我在 Sinatra 应用程序中使用它。当我运行我的应用程序时

```
haml :problem_haml 
```

每个 ruby​​ 命令都可以完美运行，但 haml 不会渲染任何内容。甚至没有一行，但每个以“-”开头的 ruby​​ 命令都完美无缺？可能是什么原因？请不要回答“因为隐藏类隐藏了所有内容”，这与隐藏 css 无关，实际上甚至没有从服务器返回一个字节。

编辑：

之前说应用是sinatra应用，其实是Padrino应用。虽然 padrino 只是几个在主 sinatra 应用程序中运行的 sinatra 应用程序，而且更多人知道 sinatra，但我说 sinatra 是为了让问题更简单。

这里还有调用haml的代码，

```
def get3DSecure(ccname,price,skul,ccno,cvc)
    puts "#############################################"
    puts "get3DSecure function called"
    puts "#############################################"
    @ccname = ccname
    @price = price.to_s + "00"
    @skul = skul
    @ccno = ccno
    @cvc = cvc
    session[:name] = ccname
    session[:xmltosend] = makeXmlFor3D
    session[:sipbil] = UUIDTools::UUID.random_create.to_s.delete!("-")
    session[:sesbil] = UUIDTools::UUID.random_create.to_s.delete!("-")
    session[:skul] = skul
    session[:price] = price
    session[:ccno] = ccno
    session[:cvc] = cvc
    puts "#############################################"
    puts "get3DSecure function near end, render starts"
    puts "#############################################"
    render :adsecure,:layout=>:main
  end 
```

它还将 puts 命令写入控制台，没有任何问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T07:52:20.297

您的代码对我有用，尽管首先我得到了：

```
WARN: tilt autoloading 'haml' in a non thread-safe way; explicit require 'haml' suggested. 
```

因为我忘了补充：

```
require "haml" 
```

在我的代码的开头。会不会是你的问题？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-07T18:32:05.970

I have find out that render or haml methods does not do return. So if you are in middle of your function, your should do

```
return haml :problem_haml 
```

It fixes the problem.

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-09-19T04:03:13.577

您可以检查您的表单是否已提交，使用 chrome 开发人员工具、firebug 或类似的东西（检查 POST），如果是，因为有一个 post 请求您需要处理响应，只是猜测:)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-09-19T15:07:49.783

在使用 haml/slim/erb 模板时要注意`puts`，这是因为 haml 有自己的 puts 方法：[http ://haml.info/docs/yardoc/Haml/Exec/Generic.html#puts-instance_method](http://haml.info/docs/yardoc/Haml/Exec/Generic.html#puts-instance_method)

因此，由于您使用的是 padrino，请将每个 puts 替换为：`logger.debug`

# ruby-on-rails - Rails：json 1.7.5 捆绑安装问题

> ID：12486894
> 
> 赞同：2
> 
> 时间：2012-09-19T00:17:50.677
> 
> 标签：ruby-on-rails, ruby-on-rails-3, json, gem, bundler

运行 bundle 时出现以下问题...

> 使用原生扩展安装 json (1.7.5) Gem::Installer::ExtensionBuildError: ERROR: Failed to build gem native extension。
> 
> ```
>  /usr/local/bin/ruby extconf.rb creating Makefile 
> ```
> 
> make Makefile:158: ***目标模式不包含 `%'。停止。
> 
> Gem 文件将继续安装在 /srv/www/socialu.com/https:/github.com/willfults/rails3-jquery-autocomplete.git/ruby/1.9.1/gems/json-1.7.5 以供检查。结果记录到 /srv/www/socialu.com/https:/github.com/willfults/rails3-jquery-autocomplete.git/ruby/1.9.1/gems/json-1.7.5/ext/json/ext/generator /gem_make.out 安装 json (1.7.5) 时出错，Bundler 无法继续。`gem install json -v '1.7.5'`在捆绑之前确保成功。

我尝试执行以下`sudo aptitude install ruby1.9.1-dev`操作，但没有奏效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-11-07T19:53:34.493

在 debian 上，如果使用 apt-get 安装了 ruby​​，请尝试安装 ruby​​-dev 包

```
#apt-get install ruby-dev 
```

它对我的情况有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-19T05:30:28.617

尝试安装依赖项：

> sudo apt-get install build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev

然后是常规流程

> mkdir ~/src && cd ~/src
> 
> wget [ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.1-p0.tar.gz](ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.1-p0.tar.gz)
> 
> tar -xvf ruby​​-1.9.1-p0.tar.gz
> 
> cd ruby​​-1.9.1-p0
> 
> 。/配置
> 
> 制作
> 
> 做测试
> 
> 须藤使安装
> 
> 并让导轨正常工作
> 
> 须藤宝石更新--系统
> 
> 须藤宝石安装导轨

并让 sqlite3 正常工作

> sudo apt-get install sqlite3 libsqlite3-dev
> 
> sudo gem 安装 sqlite3-ruby

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T16:06:15.900

问题在于生成文件中的冒号...在生成 [文件中的文件名中转义冒号](https://stackoverflow.com/questions/2052406/escaping-colons-in-filenames-in-a-makefile)

这样做解决了它...... [https://stackoverflow.com/a/9952952/1026266](https://stackoverflow.com/a/9952952/1026266)

# java - HashMap 与列表关联的一个键

> ID：12486896
> 
> 赞同：0
> 
> 时间：2012-09-19T00:18:24.870
> 
> 标签：java, list, collections, hashmap

我有一个包含表格行数据的对象列表。该表中有多个列，但我认为这不是问题。我需要应用的逻辑只需要两列。这两列称为**化学名称**和**批号**。现在有趣的部分是，对于特定的批号，一种化学物质可以出现多次。例如，

## 化工 | 批次 | 其他栏目

## A----------------100---------ABC

## A----------------100---------GHF

## A----------------100---------GHL

现在我需要的是批号及其相关行。我意识到最好的方法是 HashMap，其中 K 是批号，V 是列表。现在我不确定如何将键分配给包含行对象的列表。

我希望，但我不能在数据库级别这样做，所以这是不可能的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:20:29.700

您可以使用`Map<String, List<String>>`给定键存储事物列表。

如果你想变得花哨，你可以使用这个[匿名](http://docstore.mik.ua/orelly/java-ent/jnut/ch03_12.htm)实现：

```
Map<String, List<String>> map = new HashMap<String, List<String>>() {

    public List<String> get(Object key) {
        List<String> list = super.get(key);
        if (list == null) { 
            list = new ArrayList<String>();
            put(key, list);
        }
        return list;
    }

} 
```

当列表不存在时，它将自动创建一个列表，因此您可以像这样安全地使用它：

```
map.get(key).add("new item"); // won't get a NuilPointerException 
```

如果找到一个客户`get()`方法的这个代码模式很方便！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:21:06.907

创建一个`Row`对象来保存您的值，然后将 a 添加`List<Row>`到您的地图中：

```
Map<String, List<Row>> map = new HashMap<String, List<Row>>();
List<Row> list = new ArrayList<Row>();
list.add(new Row(...));
list.add(new Row(...));
map.put("someKey", list); 
```

如果您需要在循环中执行此操作，您将使用以下内容：    

```
Map<String, List<Row>> map = new HashMap<String, List<Row>>();
for (Row currentRow : rows) {
    String key = currentRow.getKey();
    List<Row> rows = map.get(key);
    if (rows == null) {
      rows = new ArrayList<Row>();
    }
    rows.add(currentRow);
    map.put(key, rows);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-19T01:20:43.883

或者你可以只使用番石榴库。[Multimap](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Multimap.html)类（技术接口）可以满足您的需求：一个键映射到多个值。

您可能首先将所有`Row`对象放在一个列表中，然后使用该`Multimaps.index`方法创建一个`Multimap`实例。[Multimaps](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Multimaps.html)是一个实用类，它提供了许多创建`Multimap`实例的方法。

您的代码可能如下所示：

```
List<Row> rows = ... // all the row objects.
Multimap<String, Row> rowsMap = Multimaps.index(rows, new Function<Row, String>() {
    @Override
    public String apply(Row row) {
        return row.getRowKey(); // assume that getRowKey() return the key of one row.
    }
}); 
```

从 guava api 查看更多细节。

# sql - 与分组聚合中的数据集级聚合进行比较

> ID：12486897
> 
> 赞同：3
> 
> 时间：2012-09-19T00:18:39.457
> 
> 标签：sql, reporting-services

**背景**

我有一个连接表，其中包含从 SQL Server 2008 R2 获得的事件、客户和区域。查询很简单，我选择了相关字段并过滤掉了不相关的数据。我得到一个作为 datediff(...) 的 ResolveTime 字段我有一个矩阵 tablix，它按区域分组的列中的数据组织，然后是区域，以及按事件所有者分组的行。

这些字段显示平均值、计数和（这是我的问题所在）低于平均值的百分比。在整个数据集的第二个基本表中计算相同的细节。如果您感到困惑，这里是表格的屏幕截图。

![表设置](../Images/fe8ec61cc7b2fae37f496bb03da41d5b.png)

**问题**

我用于低于平均百分比的表达式如下：

```
=Sum(iif(Fields!ResolveTimeMinutes.Value < avg(fields!ResolveTimeMinutes.Value), 1, 0)) / countrows() 
```

当我在矩阵中使用它时，它工作正常，但基于组内的平均值工作。我尝试将数据集用作总和和平均值的范围，但都返回有关嵌套聚合和范围的错误。我不能在聚合内嵌套具有范围的聚合，或者不能在范围聚合内嵌套另一个聚合。

我尝试创建一个包含我有兴趣比较的值的变量，但我不允许在聚合中引用它。

```
=Sum(iif(Fields!ResolveTimeMinutes.Value < Variables!avgResolveTime.Value ), 1, 0)) / countrows() 
```

这给了我一个错误`variable values cannot be used in aggregate functions.`

我什至尝试将平均值单独计算为一个单独的数据集并尝试在比较中引用它，但是关于嵌套聚合和我想要做的另一个错误。

任何建议将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T16:19:14.617

好吧，今天早上想通了。

我创建了一个内部参数，使其在报告中不可见，并从计算我试图直接从 iff 函数引用的“GlobalAverage”的同一数据集中检索默认值。

**询问：**

```
SELECT avg(datediff(minute, CreatedDateTime, ResolvedDateTime)) as AverageTTR
from incident 
where changeid is null and linkedproblem is null and count_numberoftasks = 0 
```

**表达：**

```
=Sum(iif(Fields!ResolveTimeMinutes.Value < Parameters!GlobalAverage.Value, 1, 0)) / countrows() 
```

奇迹般有效。希望对可能遇到同样问题的其他人有所帮助！

# c++ - 为什么 getline 如此不一致？

> ID：12486900
> 
> 赞同：5
> 
> 时间：2012-09-19T00:19:26.103
> 
> 标签：c++, string, getline

我在计算机实验室，没有一个导师能弄清楚我为什么`getline`不能正常工作。它没有正确存储信息（仅存储 1 或 2 个字母）。有谁知道为什么会这样？

```
void addMovie(Inventory movie[], int &count)
{
    string s;
    int i;

    cout << "Please enter the SKU " << endl;
    cin >> i;
    movie[count].sku = i;

    cout << "Please enter the name of the movie you wish to add " << endl;

    cin.ignore('\n');
    getline(cin, s, '\n');
    movie[count].title = s;

    count++;
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-09-19T00:36:13.443

`std::istream::ignore`(ie `cin.ignore()`) 的第一个参数是要丢弃的字符数。的值`'\n'`的 ASCII 码为 10，因此它`'\n'`被隐式转换为整数（很可能是 10，但如果使用不同的编码，它可能会有所不同 - EBCDIC 使用 21），这就是忽略了多少个字符，留下剩下几个。

您真正想要的是丢弃最大可能的数字，直到找到换行符：

```
#include <limits> //for numeric_limtis
std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n'); 
```

# system-calls - 系统调用实现

> ID：12486901
> 
> 赞同：1
> 
> 时间：2012-09-19T00:19:40.633
> 
> 标签：system-calls

我正在尝试扩展系统调用`my_time`。

我正在为此扩展 timekeeping.c。但它给了我随机的时间。

```
struct timeval tv;

// get the current time
do_gettimeofday(&tv);
current_time->tv_sec=tv.tv_sec;
current_time->tv_nsec=tv.tv_usec*1000;

return( current_time->tv_nsec); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-10-26T08:24:28.907

我想到了。实际上时间是纳秒，所以它不是随机的。它只是每秒钟都显示出很高的偏差

# asp.net - 如何在为这些页面重写 url 的同时强制 301 重定向到 asp.net 中的一些旧页面

> ID：12486903
> 
> 赞同：0
> 
> 时间：2012-09-19T00:19:46.070
> 
> 标签：asp.net, redirect, http-status-code-301

在我们的应用程序中，我们对所有页面进行 url 重写。例如，您有 . 最近我们把所有的 url 都改成了 /adults/about/ 或 /kids/about/ ……现在以前所有的 url 像“/about/”都会给 404。有没有办法添加 301 重定向并强制所有页面比如“/about/”去“/adults/about/”。我找到了一种方法，但我不确定它是一个好方法还是它对 SEO 有帮助。我所做的是为“/about/”添加一个 url 重写，例如“/adults/about/”，然后在 page_Load 检查 url 中是否没有“adults”或“kids”，然后重定向到“/adults /关于/”。大人小孩不是文件夹。它们只是帮助区分导航菜单。

抱歉，如果标题不清楚。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T01:28:16.287

Check the URL in `Application_BeginRequest` in your global.asax file. If the `HttpContext.Current.Request.Url` matches an old page, do an 301 redirect to the corresponding new page.

You can check this through Regular Expressions for example.

Here is explained [how to do a proper 301 redirect](https://stackoverflow.com/questions/1083337/how-can-i-send-a-301-permanent-redirect-with-asp-net?rq=1).

# java - java正则表达式查找第一个和最后一个字符

> ID：12486905
> 
> 赞同：2
> 
> 时间：2012-09-19T00:20:01.860
> 
> 标签：java, regex, recursion

我正在编写一个程序来确定字符串是否是递归回文。我决定尝试使用正则表达式，但我在理解语法时遇到了一些麻烦。我需要做的是比较第一个和最后一个字符，看看它们是否相同。我该怎么做呢？

谢谢！

编辑：我发现这很有帮助：[AirSource Ltd 对 Degvik 问题的回答](https://stackoverflow.com/a/233296/1552271)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T01:03:56.317

是的，如果第一个字符和最后一个字符相同，您可以确定使用正则表达式：

```
str.matches("(.).*\\1") 
```

这使用“反向引用”来引用“组 1”，它捕获第一个字符。

例子：

```
"aba".matches("(.).*\\1") // true
"abc".matches("(.).*\\1") // false 
```

然后，您可以递归删除第一个和最后一个字符并再次检查：

```
public static boolean isPalindrome(String str) {
    return str.length() < 2 || 
        (str.matches("(.).*\\1") && isPalindrome(str.substring(1, str.length() - 1)));
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-19T00:31:19.537

There's really no need to use regular expressions if you want to work recursively here, and no need to use them if you want to test for palindromes in general (if it's even possible). You can try something like this:

```
public static boolean isPalindrome(String s) {
    if (s.length() < 2) return true;
    return s.charAt(0) == s.charAt(s.length() - 1) && isPalindrome(s.substring(1, s.length() - 1));
} 
```

# php - 如果变量包含在文本文件中，则更改 PHP 中的变量

> ID：12486906
> 
> 赞同：1
> 
> 时间：2012-09-19T00:20:09.810
> 
> 标签：php, filter, fopen

我在这里尝试做的是设置某种过滤器。

我目前没有源代码，但我可以在找到如何执行此操作后快速输入它。

所以说我有

```
$Variable1 = "The Brown Fox Jumps"; 
```

我想要一个 If 语句在哪里

```
IF $Variable1 contains a word from a .txt file (filter.txt) Then $Variable1 = "Filtered" 
```

所以如果文本文件包含

```
Hey
Hi
Jump
Brown 
```

它会将整个事情更改为过滤。我不知道我会怎么写，所以有点帮助打字会很好:)

多谢你们

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:34:03.220

什么是你不明白的？

我想说，最简单的方法：

1）读取文本文件：`$str = file_get_contents('filter.txt');`

2）将文本文件的内容分解为数组：（第一个参数是分隔符，如有必要可更改）

```
$badwords = explode(" ",$str); 
```

3）如果您`$variable`匹配新创建的数组中的任何单词，请将其更改为“过滤”：

```
foreach($badwords as $badword) {
   if(stristr($badword,$variable) {
       $variable = 'filtered';
       break;
    }
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:34:56.317

我不会像为它分配一个新变量那样更改变量名本身。

```
// if you want to search by ONE word
$file = file_get_contents(your_text_file_here);

if(stripos($file, $variable1)){
// there was a match
  $variable1 = "Filtered";
}

// if you want to search your document for MULTIPLE words
$file = file_get_contents(your_text_file_here);

foreach(explode(' ', $file) as $word) {
  if(stripos($word, $variable1)){
  // there was a match
    $variable1 = "Filtered";
  }
} 
```

我不太确定这是否有帮助，但 stripos 是一个函数，它接受一个字符串并且不区分大小写地确定是否存在匹配项。

如果您输入一些代码，那么我想我可以进一步帮助您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-19T00:36:14.740

这是您的代码：

```
$filters = file('filter.txt');
foreach( $filters AS $word ) {
  if( stripos( $Variable1, $word ) !== null ) {
     $Variable1 = 'filtered';
     break;
   }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-19T00:52:51.230

如果您的文件由换行符分隔：

```
$file = file_get_contents('filter.txt');
$bad_words = explode(PHP_EOL, $file); // If PHP_EOL doesn't work there are other EOL characters you can try.
$variable1 = "This is some string."
$compare = explode(' ', $variable1);
if(count(array_intersect($bad_words, $compare)) > 0){
  $variable1 = 'Filtered';
} 
```

# c++ - c ++搜索字符串列表的特定字符串

> ID：12486909
> 
> 赞同：0
> 
> 时间：2012-09-19T00:20:22.883
> 
> 标签：c++

假设我们有一个特定的字符串：

```
string a[]={"ab","cd","ef"} 
```

当我们输入字符串的第一个字符时，我们想要一个特定的字符串：例如：

```
input: c
output: "cd" 
```

我在想的是：

所以假设我们为输入值分配 char x 。然后使用循环遍历列表，但我不知道 char x 将如何停止循环并打印特定的字符串。

另一个问题是在字符串中找到一个字母会有什么不同。例如输入：d 和输出：“cd”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T06:03:12.493

我将回答您的两个问题（即使您应该将每个“问题”保留为一个问题）。

要停止循环，请使用该`break`语句。

要在字符串中查找字符（或字符串），请使用该[`std::string::find`](http://en.cppreference.com/w/cpp/string/basic_string/find)函数。

现在将它们组合起来：

```
#include <string>
#include <iostream>
#include <algorithm>

int main()
{
    std::string a[] = { "ab", "cd", "ef", "ce" };

    char x;
    std::cout << "Enter a letter: ";
    std::cin >> x;

    // If you want to stop as soon as you find a string with the letter
    // you have to loop manually
    std::cout << "\nFind first string containing letter:\n";
    for (std::string s : a)
    {
        if (s.find(x) != std::string::npos)
        {
            std::cout << "Letter '" << x << "' found in string \"" << s << "\"\n";
            break;  // Stop the loop
        }
    }

    // If you want to print all strings containing the letter you can
    // use the `std::for_each` function
    std::cout << "\nFind all strings containing letter:\n";
    std::for_each(std::begin(a), std:end(a), [x](const std::string &s) {
           if (s.find(x) != std::string::npos)
               std::cout << "Letter '" << x << "' found in string \"" << s << "\"\n";
        });
} 
```

**注意：**上面的代码包含来自“新” [C++11](http://en.wikipedia.org/wiki/C%2B%2B11)标准的两个特性：[基于范围的 for-loops](http://en.wikipedia.org/wiki/C%2B%2B11#Range-based_for-loop)；和[lambda 函数](http://en.wikipedia.org/wiki/C%2B%2B11#Lambda_functions_and_expressions)。

# java - 我的 minecraft 缓冲阅读器只读取最后一行

> ID：12486910
> 
> 赞同：1
> 
> 时间：2012-09-19T00:20:24.787
> 
> 标签：java, minecraft

我正在尝试创建一个缓冲阅读器，通过聊天进行演讲，目的是让长陈述更容易。我让这个缓冲的阅读器听到，它在大多数情况下都有效，但它只读取最后一行，其他一切都很好。我在代码中哪里出错了？作为参考，这里是：（为了澄清，“eggtime”是一个时间延迟的布尔值）

> 静态文件华夫饼=新文件（Minecraft.getMinecraftDir（），“speech.txt”）；

```
public static void speechedo(String args)
{

    if(waffles.exists())
    {
        @SuppressWarnings("resource")
        BufferedReader read = null;
        try {
            read = new BufferedReader(new FileReader(waffles));
        } catch (FileNotFoundException e) {

            e.printStackTrace();
        }
        String notataco;
        if (eggtime){
        try {
            for(int i = 0; (notataco = read.readLine()) != null; i++)
            {

                speechmakerchat = notataco;

            }
        } catch (IOException e) {

            e.printStackTrace();
        }
        }

    }else{
        return;}

    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:38:54.083

> 我的 minecraft 缓冲阅读器只读取最后一行

不，您的缓冲阅读器会读取每一行。但是，除了最后一行之外，您将丢弃所有内容。

您的异常处理也很差。在构造 BufferedReader 的 IOException 之后，您不应允许该方法继续。大多数情况下，您的 catch 块位于错误的位置：它们应该是所有主要代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T00:25:38.603

在行

```
 speechmakerchat = notataco; 
```

您正在用`speechmakerchat`最后一行替换的内容，丢弃先前读取的值。您需要将新数据连接到旧数据：

```
 speechmakerchat += notataco; 
```

顺便说一句，您有……有趣的……变量的命名约定。

# assembly - 在汇编中为子例程传递参数和返回值

> ID：12486918
> 
> 赞同：9
> 
> 时间：2012-09-19T00:20:58.140
> 
> 标签：assembly, arm, calling-convention

我正在使用 ARM 程序集，我必须编写一个子程序，我遵循 ARM 调用约定（这必须与其他地方的一些单独的更高级别的实现集成）来传递参数和返回值。

现在这是我在使用装配时通常不确定的事情。

因此，按照惯例，如果我理解得很好，参数是按从寄存器 r0 - r4 开始的顺序传递的，然后使用其他参数堆栈。返回值被传递给 r0。

现在这就是我感到困惑的地方。如果我应该保存 r0 的上下文并在之后将其弹出，则无法返回结果，唯一的方法是破坏第一个参数。

有什么解决方法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-09-19T00:23:05.807

当您在 r0 中传回返回值时，调用者*希望*您这样做。调用者不希望 r0 仍然包含与原始第一个参数相同的值，因为 r0 是返回值的具体位置。

通常，[ARM 调用约定要求子例程保留 r4 到 r11](https://en.wikipedia.org/wiki/Calling_convention#ARM)，而不是 r0 到 r3。所以无论如何也没有矛盾。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-09-19T04:11:31.333

为什么不自己尝试一下，看看编译器做了什么？

```
unsigned int fun ( unsigned int a, unsigned int b )
{
    return(a+b);
} 
```

编译成对象并反汇编

```
arm-none-eabi-gcc -O2 -c fun.c -o fun.o
arm-none-eabi-objdump -D fun.o 
```

结果是

```
00000000 <fun>:
   0:   e0810000    add r0, r1, r0
   4:   e12fff1e    bx  lr 
```

使用 r0 和 r1 传入两个输入 a 和 b。r0-r4 不一定要保存，特别是 r0 因为它的返回值是不能保存的。因此，根据 C 代码所需的两个操作数相加，并且根据调用约定，结果在 r0 中返回。r0 = r0 + r1。

编译器必须遵守约定，否则它生成的代码将无法工作，因此您可以简单地编译代码并反汇编，以了解有关特定编译器和目标的调用约定的大量信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-09-25T00:16:26.667

> 如果我应该保存 r0 的上下文并在之后将其弹出

这听起来像是**由术语 "caller-saved" 引起的混乱**。它错误地暗示调用者实际上*应该*保存/恢复每个这样的寄存器，而不是让它被函数调用销毁（在这种情况下被返回值替换）。

我喜欢术语“call-clobbered”与“call-preserved”： [什么是被调用者和调用者保存的寄存器？](//stackoverflow.com/a/56178078)

如果您想在函数调用中保留一个值，只需将其保存在不同的寄存器中，该寄存器由调用约定保留，而不是围绕每个函数调用进行保存/恢复。

# .net - Azure 生产和开发角色配置

> ID：12486919
> 
> 赞同：1
> 
> 时间：2012-09-19T00:21:02.850
> 
> 标签：.net, testing, deployment, azure, roles

我们正在将我们的网站迁移到 Azure，并希望确保我们以正确的方式做事。

我们有我们的开发区域，我们在部署到生产之前进行测试 - 不确定在 Azure 中设置它的正确方法。

我在想我们想要一个解决方案，它有两个角色，指向我们的测试和生产 Azure 实例。这样我们就可以发布到 dev，完成测试，然后发布到 prod。

这是可能的/正确的方式吗？谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T01:09:12.107

其中一些取决于您使用的服务、网站、虚拟机或云服务。我假设我们正在谈论云服务。

设置两个云服务。这为您提供了两个固定的 dns 名称，然后您也可以轻松地映射您自己的自定义域。接下来，为您创建 cscfg 文件（云服务配置文件）的副本，一份用于您的生产环境，一份用于您的预生产环境。当您进行部署时，也要为您正在部署的环境提供正确的文件。

所有特定于环境的确认设置（例如连接字符串）都将在 cscfg 文件中进行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T07:32:37.743

实际上为此目的拥有两个角色是一个坏主意 - 您希望您的测试环境尽可能类似于生产环境。更好的选择是拥有两个不同的服务配置 (.cscfg) 文件，它们将存储连接字符串和其他将生产服务数据与测试服务数据隔离开来的东西。

# jquery - 链接 $.Deferred

> ID：12486921
> 
> 赞同：4
> 
> 时间：2012-09-19T00:21:15.753
> 
> 标签：jquery, jquery-deferred

我希望了解为什么在尝试直接链接延迟对象时与尝试通过将对象保存在变量中并在该变量上调用一个或多个延迟方法来进行链接时得到不同的行为。

将对象保存在变量中时，发送到每个函数的值是相同的（在下面的代码片段中，5） - 即在这种情况下值不会过滤。当直接链接时，值过滤......所以我不清楚`Deferred.pipe()`在几个不同的语句中设置 a 时如何进行过滤。通过我阅读[jquery docs](http://api.jquery.com/category/deferred-object/)，它应该是可能的：

> Deferred 对象是可链接的，类似于 jQuery 对象的可链接方式，但它有自己的方法。创建 Deferred 对象后，您可以通过直接从对象创建链接或将对象保存在变量中并在该变量上调用一个或多个方法来使用以下任何方法。

我究竟做错了什么？

这是我的代码：

```
<script type="text/javascript">
$(document).ready(function () {
// This works as expected - alert(20)

var defer = new $.Deferred();
defer.pipe(myFunction).pipe(myFunction).pipe(myAlert);
defer.resolve(5);

// This does not work as expected - alert(5)
var defer2 = new $.Deferred();
defer2.pipe(myFunction);
defer2.pipe(myFunction);
defer2.pipe(myAlert);
defer2.resolve(5);

});

var myFunction = function (value) {
return value * 2;
}

var myAlert = function (value) {
alert('The value is ' + value);
}
</script> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:33:05.967

该`$.Deferred`对象确实是可链接的，但是在第二种情况下，您没有链接任何东西；当解决或拒绝时，您只是将多个`pipe`s分配`$.Deferred`给要独立执行的对象。`$.Deferred`换句话说，您**忽略了***包含*要传递给链中下一个过滤/修改值的返回`Promise`对象。*`.pipe()`*

 *从[文档](http://api.jquery.com/deferred.pipe/)：

> deferred.pipe() 方法**返回一个新的 promise，它**通过函数过滤 deferred 的状态和值。

为了在第二个示例中实现您想要的，`pipe`结果`Promise`而不是原始`$.Deferred`对象：

```
var defer2 = new $.Deferred();
var promise = defer2.pipe(myFunction);
promise = promise.pipe(myFunction); // pipe and update promise
promise.pipe(myAlert);
defer2.resolve(5); 
```

**[演示](http://jsfiddle.net/kU9nz/)**。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-09-28T17:35:44.683

Joao，我有同样的情况 - 要调用的管道数量未知。这是怎么做的 - [JavaScript 中的异步循环](https://stackoverflow.com/questions/4288759/asynchronous-for-cycle-in-javascript/12637748#12637748)*

# c# - 单订阅者事件

> ID：12486922
> 
> 赞同：1
> 
> 时间：2012-09-19T00:21:24.003
> 
> 标签：c#

目前，我使用以下代码在一个类中实现一个事件，该事件最多可以注册一个事件处理程序：

```
private event EventHandler<EventArgs> e_Foo;

public event EventHandler<EventArgs> Foo {
    add {
        if (e_Foo != null && e_Foo.GetInvocationList().Any())
            throw new InvalidOperationException("Only one event handler may be registered at a time.");
        e_Foo += value;
    }
    remove {
        e_Foo -= value;
    }
}

private void OnFoo() {
    if (e_Foo != null)
        e_Foo(this, EventArgs.Empty);
} 
```

*   有没有更好的办法？
*   有什么办法可以将它包装在一个类中，这样我就不必复制和粘贴这么多代码了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:27:47.933

这真的应该是一个评论，但我需要编写代码：

```
private void OnFoo() {
    if (e_Foo != null)
        e_Foo(this, EventArgs.Empty);
} 
```

引入了潜在的竞争条件，因为调用列表可能会在检查和实际调用之间发生变化。您最终可能会调用 null。它应该是：

 ~~```
private void OnFoo() {
    var fuFoo = e_Foo;
    if (fuFoo != null)
        fuFoo(this, EventArgs.Empty);
} 
```~~ 

***注意：现在是 2020 年，从 C# 6 开始，我们有了[空条件运算符](https://docs.microsoft.com/en-us/archive/msdn-magazine/2014/october/csharp-the-new-and-improved-csharp-6-0#null-conditional-operator)。***

这可以用来以更简单的方式表达前面的代码：

```
private void OnFoo() {
    e_Foo?.Invoke(this, EventArgs.Empty);
} 
```

我想一种不易出错的方法是一种更好的方法。我赢了！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-22T13:58:37.040

事件只是以特殊语义公开委托属性的一种特殊方式：您无需设置值，而是添加和删除处理程序。如果此行为对您不起作用，那么尝试将其从事件中删除只会造成不必要的复杂性。相反，为什么不直接将回调公开为委托属性来避免添加您不想要的行为呢？

```
public Action<T1, T2> Foo {get; set;}

private void OnFoo(T1, T2) 
{
    var handler = Foo;
    if(handler != null) handler(T1, T2);
} 
```

这样，当有人设置`OnFoo`它时，它将使用正常的属性语义并替换委托实例，而不是将其扔在一堆。它并没有摆脱多播，但在我看来，这并不是你的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-22T13:42:01.693

我认为不可能大量减少代码，但是您可以将检查放入为您完成工作的方法中，或者返回处理程序，如下所示：

```
public EventHandler<T> HookUp<T>(EventHandler<T> myEvent, EventHandler<T> myMethod)
    where T : EventArgs
{
    if (myEvent != null && myEvent.GetInvocationList().Any())
        throw new InvalidOperationException("Only one event handler may be registered at a time.");
    return myMethod;
}

private event EventHandler<EventArgs> e_Foo;

public event EventHandler<EventArgs> Foo
{
    add { e_Foo += HookUp(e_Foo, value); }
    remove { e_Foo -= value; }
} 
```

您可以在某些扩展方法中实现一个具有所有逻辑的接口，或者继承一个抽象类。但是，您必须为所需的每个事件数（`ISingleSubscriberOne`、`ISingleSubscriberTwo`、`ISingleSubscriberThree`等）拥有多个接口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-22T14:17:54.633

我不确定在您的场景中是否可行，但我可能会将事件代码分配给 Action 变量并将事件链接到该 Action。然后，用户将只能更改操作，而永远不会真正更改我的事件上已注册的事件。该事件将简单地链接到操作，以便您可以更改操作，但您永远不能同时拥有 2 个。

只是一个想法。还没喝咖啡，所以这可能根本不合适......

# .net - Crystal Reports - 如何设置数据库凭据

> ID：12486925
> 
> 赞同：1
> 
> 时间：2012-09-19T00:22:13.430
> 
> 标签：.net, crystal-reports

我创建了一些水晶报告。当我在我的系统上运行这些报告时，它运行良好，但是当我在另一台机器上构建项目并安装（exe）时，它要求数据库凭据并且无法正常工作。你能请人帮忙解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T10:04:50.170

需要设置访问数据库的凭据

```
reportDocument.SetDatabaseLogon("user", "password", "server", "database"); 
```

# c# - 如何将属性添加到我的新类以决定 Form1 是否保存值？

> ID：12486928
> 
> 赞同：0
> 
> 时间：2012-09-19T00:22:42.090
> 
> 标签：c#

例如，我希望能够在 Form1 构造函数中键入： Options_DB.Save 类似的东西或 Options_DB.Save(true) 或 (false) 因此，如果它为 false，则该类将不会根据我在 Form1 中所做的所有设置生效Options_DB，如果它为真，它将生效并执行类 Options_DB 中的所有事情。

这是类 Options_DB：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using DannyGeneral;
using System.IO;
using System.Windows.Forms;

namespace GatherLinks
{
    static class OptionsDB
    {
        static string changeWebsite;
        static bool downloadImages;
        static bool localOnly;
        static decimal num1;
        static string num1_numricupdown;
        static string path_exe;
        static string path_settings;
        static string settings_file;
        static string settings_dir;
        static OptionsFile setting_file;

        static OptionsDB()
        {
            path_exe = Path.GetDirectoryName(Application.LocalUserAppDataPath);

            path_settings = Path.GetDirectoryName(Application.LocalUserAppDataPath);
            settings_file = "\\settings.txt";
            settings_dir = path_settings + @"\settings";
            setting_file = new OptionsFile(settings_dir + settings_file);

            // ---- L O A D I N G   A L L   K E Y S ---- \\

            changeWebsite = setting_file.GetKey("changeWebSite");
        }
        // ---- FUNCTIONS GET AND SET ---- \\

        public static string get_changedWebSite()
        {
            return changeWebsite;
        }

        public static void set_changeWebSite(string website)
        {
            changeWebsite = website;
            setting_file.SetKey("changeWebSite", changeWebsite);

        }
    }
} 
```

我在 Form1 中使用它，例如：

在 Form1 构造函数中：

```
mainUrl =  OptionsDB.get_changedWebSite(); 
```

在button2点击事件中：

```
private void button2_Click(object sender, EventArgs e)
        {
            cl = new ChangeLink();
            cl.StartPosition = FormStartPosition.CenterParent;
            DialogResult dr = cl.ShowDialog(this);
            if (dr == DialogResult.Cancel)
            {
                cl.Close();
            }
            else if (dr == DialogResult.OK)
            {    
                    label4.Text = cl.getText();
                    mainUrl = cl.getText();
                    OptionsDB.set_changeWebSite(cl.getText());
                    cl.Close();
            } 

        } 
```

现在在我执行 Options_DB.get 之前的 Form1 构造函数中...我想添加 Options_DB 的一个属性，或者告诉我是否将类作为新类。这个类我已经使用了很多时间将所有选项（如复选框和其他东西）保存在文本文件中，因此当我运行程序时，它会记住我更改的设置。

现在我想要一个属性来告诉程序保存我所做的任何更改或不保存它们。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T06:43:38.623

如果我做对了（但我不确定我是否真的理解你想要做什么）你可以简单地向你的 Form1 类添加一个公共 bool 字段，创建一个接受参数并设置它的构造函数，然后检查访问 OptionsDB 之前的值。请注意，必须在访问该字段之前对其进行设置。这意味着您必须在新构造函数中移动访问 OptionsDB 的行，并避免使用默认构造函数。

像这样的东西（至少作为一个起点）：

```
 private bool useOptionsDB; 
    private Form1() // private to be sure you don't use it
    {
        InitializeComponent();
    }

    public Form1(bool useOptions)
        : this()
    {
        useOptionsDB = useOptions;
        // your stuff
        if (useOptionsDB)
            mainUrl = OptionsDB.get_changedWebSite();
    }

    private void button2_Click(object sender, EventArgs e)
    {
        cl = new ChangeLink();
        cl.StartPosition = FormStartPosition.CenterParent;
        DialogResult dr = cl.ShowDialog(this);
        if (dr == DialogResult.Cancel)
        {
            cl.Close();
        }
        else if (dr == DialogResult.OK && useOptionsDB) // <- add check on the bool field
        {
            label4.Text = cl.getText();
            mainUrl = cl.getText();
            OptionsDB.set_changeWebSite(cl.getText());
            cl.Close();
        }
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T06:49:24.473

根据您的问题，这是我能做的最好的事情。很难阅读/理解您的问题

```
private static bool isActive; // The new property; put it with the rest of the statics
public static string get_changedWebSite()
{
    return changeWebsite;
}

public static void set_changeWebSite(string website)
{
    if (isActive) // Check if it is active or not
    {
        changeWebsite = website;
        setting_file.SetKey("changeWebSite", changeWebsite);
    }
}

public bool IsActive // Get and set
{ 
  get
  {
     return isActive;
  } 
  set
  {
      isActive = value;
  } 
} 
```

在`Form1`只是写`OptionsDB.IsActive = false;`关闭。`OptionsDB.IsActive = true;`打开。可能在构造 ( `static OptionsDB()`) 中设置初始值。

最后，你真的可以改变你的 get 和 set 方法来使用**Accessors**。就像我使用的 Get 和 Set 一样。**--侧面建议；只是因为你可以**

# c++ - “逆”关联容器？

> ID：12486948
> 
> 赞同：3
> 
> 时间：2012-09-19T00:25:36.327
> 
> 标签：c++, stl, std

stl 或一般情况下是否存在一种“反向”关联容器？例如，我想要一个容器，其中相同的元素由一组键共享。

假设我的密钥是`int`，那么我将拥有例如：

```
container.at(3) -> some object A
container.at(4) -> same object A
container.at(1) -> other object B 
```

对于不同的操作，该容器（理想情况下）具有与 std::map 相同的复杂性。这样的事情可能吗？

我正在考虑首先使用 a `std::map<int, T*>`，其中几个索引指向同一个对象，但是当从地图中删除一个项目时，运行时间在 O(n) 中，因为您必须检查其他项目以查看您是否需要删除T`object`

在 stl 或 boost 中是否已经“本地”存在这种容器？

编辑：一些使用示例：

```
container<int, myClass> myContainer;
myClass obj(...); //new object
myContainer.insert(3, obj); //insert object for specific key
myContainer.insert(2, obj); //insert same object for specific key, since both objects would compare equal we would actually not "insert" a new object but have it shared by both keys
myContainer.duplicate_object(2,5); //key 5 also has the same object as key 2 (and 3)
myContainer.getAllKeys(2); //would return 2,3 and 5 since they all reference the same object as key 2
myContainer.removeKey(3);
myContainer.removeKey(2);
myContainer.removeKey(5); //would destroy the object here, not before 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-19T00:46:59.670

你可以使用一个

```
std::map<int,std::shared_ptr<myclass>> 
```

在 C++11 中，这是标准的一部分。否则使用 Boost 库提供的共享指针。

共享指针的想法是它在内部保持一个引用计数，即它跟踪指针复制了多少次。当您删除映射条目时，共享指针对象的析构函数将确保计数器递减。一旦达到零，该对象将被删除。

* * *

（编辑：）为了使答案更完整，一些用法示例：

```
#include <map>
#include <memory>

struct myclass
{

};

int main()
{
  std::map<int,std::shared_ptr<myclass>> mymap;

  /* std::make_shared() calls the constructor and creates a shared_ptr: */
  std::shared_ptr<myclass> object1 { std::make_shared<myclass>() };
  std::shared_ptr<myclass> object2 { std::make_shared<myclass>() };
  std::shared_ptr<myclass> object3 { std::make_shared<myclass>() };

  mymap[1] = object1;
  mymap[2] = object2;
  mymap[3] = object3;
  mymap[4] = object2;
  mymap[5] = object1;

  mymap.erase(2); // erases the (2,object2) entry
                  // therefore, decreases the counter
                  // for object2
                  // but (4,object2) is still intact

  return 0;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T14:21:36.180

你可能想看看[Boost.MultiIndex](http://www.boost.org/doc/libs/1_51_0/libs/multi_index/doc/index.html)；描述说：

> Boost Multi-index Containers Library 提供了一个名为 multi_index_container 的类模板，它支持构建容器来维护一个或多个具有不同排序和访问语义的索引。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-09-19T00:47:59.467

因此，您想要的是像 std::map 中那样快速插入和查找，而且还需要按值快速删除条目的能力。

没有标准的容器可以做到这一点。但是当你想自己写一个时，你可以通过维护两个内部数据结构来做到这一点：

1.  将键映射到值的[std::map](http://www.cplusplus.com/reference/stl/map/)
2.  第二个[std::multimap](http://www.cplusplus.com/reference/stl/multimap/)将值映射到指向它们的键集

当您想按值删除键时，您可以在第二张地图中查找它。

# java - 如何停止 MediaPlayer 流然后重新启动它？安卓

> ID：12486951
> 
> 赞同：9
> 
> 时间：2012-09-19T00:25:50.930
> 
> 标签：java, android, media-player, android-mediaplayer

我正在制作一个简单的应用程序来播放在线广播流。我知道如何设置流。到目前为止，这是我的代码。它设置流并播放它。但如果我停止，我无法让它重新开始。我错过了一些明显的东西吗？

```
final MediaPlayer mediaPlayer = new MediaPlayer();
    mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
    try {
        mediaPlayer.setDataSource(url);
    } catch (IllegalArgumentException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } catch (SecurityException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } catch (IllegalStateException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } catch (IOException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }
    try {
        mediaPlayer.prepare();
    } catch (IllegalStateException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } catch (IOException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } // might take long! (for buffering, etc)

   streamButton = (ToggleButton) findViewById(R.id.playstopstream);

   streamButton.setOnCheckedChangeListener(new OnCheckedChangeListener() {

    @Override
    public void onCheckedChanged(CompoundButton arg0, final boolean isChecked) {
        // TODO Auto-generated method stub
         new Thread(new Runnable() {

            @Override
            public void run() {
                // TODO Auto-generated method stub
                if(isChecked)
                {

                    mediaPlayer.start();

                }
                else
                {
                    mediaPlayer.stop();
                    mediaPlayer.reset();

                }
            } 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2015-11-14T09:11:32.633

老问题，但我发现它正在寻找这个。只需使用 pause 停止，然后在重新启动之前使用 seekTo(0)：

```
mediaPlayer.seekTo(0);
mediaPlayer.start(); 
```

无需每次都重新准备录音机即可工作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-09-19T01:51:09.937

当你打电话`mediaPlayer.reset()` `mediaPlayer`时进入空闲状态。对于播放，您应该在开始之前进行初始化准备。

您可以在此处检查媒体播放器状态：http: [//developer.android.com/reference/android/media/MediaPlayer.html](http://developer.android.com/reference/android/media/MediaPlayer.html)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-07-14T16:42:44.020

```
public void playButton (View view){

        if (isActive == false){
            mediaPlayer.start();
            isActive = true;
        }else{
            mediaPlayer.seekTo(0);
            mediaPlayer.start();
        }
    } 
```

适合我。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-02-10T02:19:23.253

尝试这个

```
@Override
public void onCheckedChanged(CompoundButton arg0, final boolean isChecked) {
    // TODO Auto-generated method stub
     new Thread(new Runnable() {

        @Override
        public void run() {
            // TODO Auto-generated method stub
            if(isChecked) {
                mediaPlayer.setDataSource(url);
                mediaPlayer.prepare();
                mediaPlayer.start();
            }
            else {
                mediaPlayer.stop();
                mediaPlayer.reset();
            }
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-12-13T07:35:32.227

完成歌曲/播放歌曲后，您必须调用 onDestroy() 方法。您可以从我的实时代码中获得帮助。

```
public class RingtonePlayingService extends Service {
    public static MediaPlayer mediaPlayer;
    public static Context context;

    @SuppressWarnings("deprecation")
    @Override
    public void onCreate() {
        super.onCreate();

        context = getApplicationContext();
    }

    @Override
    public IBinder onBind(Intent intent) {
        return null;
    }

    @Override
    public int onStartCommand(Intent intent, int flags, int startId) {
            mediaPlayer = new MediaPlayer();
            // this is important.
            mediaPlayer.setAudioStreamType(AudioManager.STREAM_RING);

            try {
                // Uri ringerUri = RingtoneManager.getActualDefaultRingtoneUri(
                // getApplicationContext(), RingtoneManager.TYPE_RINGTONE);
                mediaPlayer.setDataSource(context,
                        Settings.System.DEFAULT_RINGTONE_URI);
                // mediaPlayer.setDataSource(context, ringerUri);

                mediaPlayer.setLooping(true);
                mediaPlayer.prepare();
                if (SettingsManager.getInstance(context).getFinishCall()) {

                } else {
                    mediaPlayer.start();
                }

            } catch (IllegalArgumentException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            } catch (SecurityException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            } catch (IllegalStateException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            } catch (IOException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }

        return START_NOT_STICKY;
    }

    @Override
    public void onDestroy() {
        // TODO Auto-generated method stub
        super.onDestroy();
        TTcall.onDestroyr();
        if (mediaPlayer != null) {

            if (mediaPlayer.isPlaying()) {
                mediaPlayer.pause();
                mediaPlayer.stop();
                mediaPlayer = null;
            }

        }
    }

} 
```

我希望你会从上面的代码中得到帮助。请尝试像这样使用。谢谢

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2012-11-08T14:15:46.153

此外，您可能不需要`stop()`，`pause()`可能就足够了，这意味着您可以`play()`在想继续玩时调用。

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2016-04-14T01:46:31.580

```
mediaPlay.seek(0);
mediaPlay.pause(); 
```

# c++ - 在c ++中通过迭代找到平方根

> ID：12486959
> 
> 赞同：1
> 
> 时间：2012-09-19T00:27:00.007
> 
> 标签：c++, algorithm, math, square-root

我有一个家庭作业到期，我的循环有问题。我首先必须通过我已经可以做的循环找到下一个最高和最低的平方根。接下来我的作业告诉我，我需要通过平均整数的下一个最高和最低平方根来获得平方根的近似值。然后我必须询问用户他们想要的小数位数。以下是作业的引述：

> 然后应该构建一个计数控制的循环；它将为每个所需的小数位执行一次；在示例中，此循环将执行四次（十位、百位、千位和千位小数位各执行一次）。使用诸如decimalPosition 之类的计数器来跟踪循环处于哪个阶段。

这是我遇到麻烦的地方，我正在使用基于用户输入的小数位数的 while 循环，但我的循环没有完成循环。我是编程新手，所以如果这真的很简单，请原谅我。这是我的while代码：

```
for (int decimalPosition = 1; decimalPosition <= decimal; decimalPosition++)
{
    while (baseRoot*baseRoot > num)
    {
        baseRoot = baseRoot - (pow((.1),decimalPosition));
        cout << fixed << setprecision(decimal) << baseRoot << endl;
    }

} 
```

这是我到目前为止的输出

```
Enter a number you wish to know the square root of: 8
Enter the number of decimal places of accuracy you want: 7
Find the square root of 8 to 7 decimal places: 
2.6000000
2.7000000
2.8000000
2.9000000
2.9000000 square root of 8.0000000 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-09-19T01:01:00.387

它被称为[牛顿法](http://en.wikipedia.org/wiki/Newton%27s_method)，它的收敛性是二次的。那应该可以帮助您弄清楚。

PS - 巴比伦人首先发现了它，但牛顿得到了它的赞誉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-20T05:55:31.983

为了使您的循环正常工作，您可以添加一个语句

```
baseRoot = baseRoot + (pow((.1),decimalPosition)); 
```

在while循环之后，因为您需要确保`baseRoot`大于每次迭代之前的答案。像这样：

```
for (int decimalPosition = 1; decimalPosition <= decimal; decimalPosition++)
{
    while (baseRoot*baseRoot > num)
    {
        baseRoot = baseRoot - (pow((.1),decimalPosition));
        cout << fixed << setprecision(decimal) << baseRoot << endl;
    }
    baseRoot = baseRoot + (pow((.1),decimalPosition));
} 
```

现在你可以得到答案了`2.8284271`。

顺便说一句，还有另一种称为**二分法**（类似于二分搜索）的有效方法来解决这类问题（与**单调函数**有关），无需太多数学：

```
double mySqrt(double x, double epsilon) {
    double left = 0, right = x;
    while (right - left > epsilon) {
        double mid = (left + right) / 2;
        if (mid * mid > x) {
            right = mid;
        } else {
            left = mid;
        }
    }
    return left;
} 
```

这很简单，愚蠢:)

# javascript - 如何从 Opera 的外部页面向本地服务器发出跨域请求？

> ID：12486960
> 
> 赞同：3
> 
> 时间：2012-09-19T00:26:59.563
> 
> 标签：javascript, jquery, security, cross-domain, opera

我有一个系统负责将作业分配给在不同机器上运行的一组浏览器。每个浏览器都会重新加载一个页面，等待作业进来。

每个作业要做的一件事是向本地机器上运行的本地服务器发出跨域 JSONP 请求，以便从系统中获取一些信息。这适用于我尝试过的所有浏览器，除了 Opera。

这是我用来发出请求的 jQuery 代码：

```
$.ajax({
  url: "http://10.20.30.40:8000/...",
  dataType: "jsonp",
  data: someData
  success: function(data) { ... }
}); 
```

`10.20.30.40`主机是本地IP地址，用浏览器标识机器上运行的本地服务器。`blah.internal.example.com`发出此请求的页面是从我们网络内的所有机器可见的域名加载的。

从 Opera（我使用的是 12.02）发出的第一个此类请求成功。但是，以相同方式发出的后续请求从未真正发出过。它们不会显示在检查器的网络选项卡中。在控制台中，会显示一条消息，内容为`Linked script not loaded`。

我相信这条消息（以及缺少请求）是由 Opera 的跨网络安全触发的，在[这篇博](http://my.opera.com/securitygroup/blog/2012/07/03/operas-cross-network-protection)文中有描述。在 Stackexchange 上，[这个答案](https://stackoverflow.com/questions/5464599/opera-wont-load-some-javascript-files/7442998#7442998)提出了一种解决方法，但它需要用户交互。对于我的用例，浏览器由脚本启动、停止和运行，因此用户交互不是一个选项。

有没有办法完全禁用 Opera 中的这种跨网络安全性，或者禁用从特定“受信任”主机加载的页面？我需要在首选项中进行更改，或者`opera:config`在会话中保持粘性。（所有这些计算机都在内部网络上的内部控制页面上运行，所以我不担心跨网络攻击。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T06:15:11.687

如果您可以在 Opera 12+（以及所有其他浏览器，甚至 IE8）中使用 CORS，为什么还要使用 JSONP？它就像魅力一样。

只是不要忘记将所需`Access-Control-Allow-*`的标头添加到本地服务器。

Opera 开发网络上的更多信息： [http ://dev.opera.com/articles/view/dom-access-control-using-cross-origin-resource-sharing/](http://dev.opera.com/articles/view/dom-access-control-using-cross-origin-resource-sharing/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-20T07:37:31.283

尝试在opera:config#Cross%20Network 中完全禁用安全功能（似乎SO不会让我链接到那个..）

自然，如果您禁用了安全功能，则以后应该谨慎浏览.. ;-)

# html - 元素的文本对齐

> ID：12486962
> 
> 赞同：0
> 
> 时间：2012-09-19T00:27:38.257
> 
> 标签：html, css

我想得到这样的结果：[http://jsfiddle.net/7Kc2m/](http://jsfiddle.net/7Kc2m/)`text-align` ，但出于明显的原因我不想使用。我试图离开只是`margin: 0 auto`，但它神秘地不起作用。`text-align`那么，如果没有and ，我该如何实现`center`呢？如果可以的话，请告诉我为什么它不能`margin: 0 auto`和你的一样，谢谢。

当我尝试使用 时`float: left`，它也不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T00:32:31.020

`margin:0 auto`确保在元素上指定宽度。

它在小提琴中起作用，因为它是一个内联块元素，与文本对齐结合使用，但如果未指定宽度，块级元素将跨越页面的整个宽度，从而使边距技巧无效。

# asp.net-mvc-3 - 控制器名称未在 mvc3 上的 ajax 调用中传递

> ID：12486967
> 
> 赞同：0
> 
> 时间：2012-09-19T00:28:12.903
> 
> 标签：asp.net-mvc-3, jquery, asp.net-mvc-routing

我有一个 ajax 调用，直到最近在托管网站上一直运行良好

像这样定义

```
$.ajax({
        url: 'GetItemsForCountry',
        type: 'GET',
        data: "country=" + country,
        success: function (items) {
            $("#Items").empty();
            $("#Items").attr("disabled", false)
            $.each(items, function (i, c) {
                $("#Items").append($('<option></option>').val(c.Value).html(c.Text))
            }
                  );
        }) 
```

当我尝试在 VS 中本地调试它时，它工作正常，我看到它通过我的控制器在线...

```
http://localhost:9000/Home/GetItemsForCountry?country=USA 
```

当我在托管服务器上运行它时，它被传递为

```
http://servername/GetItemsForCountry?country=USA. 
```

它以前没有这样做。

有谁知道为什么？或者知道一种 MapRoute 方法以使其不出现 404 错误？

谢谢你的帮助。

大卫

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T00:47:34.180

这是您正在使用的相对 URL，因此它将使用当前路径。由于它是一个`home`url，我假设它也使用默认路由。听起来您的 localhost 测试将`http://localhost:28347/home/index`不仅仅是根 url，而您的服务器测试将针对`/`. 解决这个问题的一种方法是使用

```
$.ajax({
    url: '@Url.RouteUrl(new { controller = "Home", action= "GetItemsForCountry"})',
    type: 'GET',
    data: "country=" + country,
    success: function (items) {
        $("#Items").empty();
        $("#Items").attr("disabled", false)
        $.each(items, 
            function (i, c) {
                $("#Items").append($('<option></option>').val(c.Value).html(c.Text))
            }
        );
}) 
```

无论呼叫如何，这都应该为您解决路线。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T02:07:42.597

如果您将 URL 更改为`/home/getitemsforcountry`它将在服务器和本地工作。仅使用`Getitemsforcountry`将尝试将其附加到您所在站点的当前“区域”。

# java - 主菜单未出现在我的 Android 手机上

> ID：12486972
> 
> 赞同：0
> 
> 时间：2012-09-19T00:29:00.147
> 
> 标签：java, android, menu

我正在尝试设置一个主菜单，但它没有出现在我的手机上。主菜单 xml 已经设置好，一切都编译好了，但是当我在手机上尝试时，它没有出现。而且构建目标是Android 4.0.3，和我的手机一样。下面是java代码，希望有人能帮帮我。

```
 package image.change;

    import android.os.Bundle;
    import android.app.Activity;
    import android.view.Menu;
    import android.view.MenuInflater;

    public class UserInterface extends Activity {

        @Override
        public void onCreate(Bundle savedInstanceState) {

            super.onCreate(savedInstanceState);
            setContentView(R.layout.main);

        }//end onCreate

        @Override
        public boolean onCreateOptionsMenu(Menu menu) {

            MenuInflater inflater = getMenuInflater();
            inflater.inflate(R.menu.mainmenu, menu);
            return true;

        }//end onCreateOptionsMenu

    }//end UserInterface 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-19T04:56:08.843

试试这个来建立你的`MENU`

```
@Override
    public boolean onCreateOptionsMenu(Menu menu){
        boolean result=super.onCreateOptionsMenu(menu);
        menu.add(0,menu_1,1,"Register");
        return result;
    }
    @Override
    public boolean onOptionsItemSelected(MenuItem item){
        switch(item.getItemId()){       
            case menu_1:
                fnRegistration();
                return true;
        }         
        return super.onOptionsItemSelected(item);
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-19T06:12:21.173

尝试这样做...

**膨胀菜单：**

```
 public boolean onCreateOptionsMenu(Menu menu)
    {
        MenuInflater menuInflater = getMenuInflater();
        menuInflater.inflate(R.layout.menu, menu);
        return true;
    }

public boolean onOptionsItemSelected(MenuItem item)
    {

        switch (item.getItemId())
        {
        case R.id.menu_bookmark:
            // Single menu item is selected do something
            // Ex: launching new activity/screen or show alert message
            Toast.makeText(AndroidMenusActivity.this, "Bookmark is Selected", Toast.LENGTH_SHORT).show();
            return true;

        case R.id.menu_save:
            Toast.makeText(AndroidMenusActivity.this, "Save is Selected", Toast.LENGTH_SHORT).show();
            return true;

        case R.id.menu_search:
            Toast.makeText(AndroidMenusActivity.this, "Search is Selected", Toast.LENGTH_SHORT).show();
            return true;

        case R.id.menu_share:
            Toast.makeText(AndroidMenusActivity.this, "Share is Selected", Toast.LENGTH_SHORT).show();
            return true;

        case R.id.menu_delete:
            Toast.makeText(AndroidMenusActivity.this, "Delete is Selected", Toast.LENGTH_SHORT).show();
            return true;

        case R.id.menu_preferences:
            Toast.makeText(AndroidMenusActivity.this, "Preferences is Selected", Toast.LENGTH_SHORT).show();
            return true;

        default:
            return super.onOptionsItemSelected(item);
        }
    } 
```

# opengl - 使用 OpenGL 运行 cuda 程序时出现分段错误

> ID：12486974
> 
> 赞同：1
> 
> 时间：2012-09-19T00:29:10.317
> 
> 标签：opengl, ubuntu, cuda, segmentation-fault

我正在编写 [http://code.google.com/p/snp-gpgpu/source/browse/trunk/cuda_by_example_codes/chapter08/basic_interop.cu?r=4中提供的 cuda 代码](http://code.google.com/p/snp-gpgpu/source/browse/trunk/cuda_by_example_codes/chapter08/basic_interop.cu?r=4)

我通过明确提到标题替换了标题，我提到它们如下：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <GL/gl.h>
#include <GL/glut.h>
#include <cuda.h>
#include <cuda_runtime.h>
#include "cutil.h"
#include <cuda_gl_interop.h> 
```

我正在编译发出命令的代码 nvcc -o test_cuda basic_prog_num_1.cu -lGL -lGLU -lglut 程序正在编译，没有任何错误，并且创建了 test_cuda 可执行文件。但是，当我尝试运行发出 ./test_cuda 的可执行文件时，它给了我分段错误。我想提一件事，以前当我使用“cutil.h”进行编译时，发生了一个错误，即没有像 cutil.h 这样的文件或目录。所以我明确下载了“cutil.h”并包含在与程序相同的文件夹中。该程序正在编译，没有任何错误，但在运行时返回分段错误。

代码如下：

```
PFNGLBINDBUFFERARBPROC    glBindBuffer     = NULL;
PFNGLDELETEBUFFERSARBPROC glDeleteBuffers  = NULL;
PFNGLGENBUFFERSARBPROC    glGenBuffers     = NULL;
PFNGLBUFFERDATAARBPROC    glBufferData     = NULL;

#define     DIM    512

GLuint  bufferObj;
cudaGraphicsResource *resource;

__global__ void kernel( uchar4 *ptr ) {
    // map from threadIdx/BlockIdx to pixel position
    int x = threadIdx.x + blockIdx.x * blockDim.x;
    int y = threadIdx.y + blockIdx.y * blockDim.y;
    int offset = x + y * blockDim.x * gridDim.x;

    // now calculate the value at that position
    float fx = x/(float)DIM - 0.5f;
    float fy = y/(float)DIM - 0.5f;
    unsigned char   green = 128 + 127 *
                            sin( abs(fx*100) - abs(fy*100) );

    // accessing uchar4 vs unsigned char*
    ptr[offset].x = 0;
    ptr[offset].y = green;
    ptr[offset].z = 0;
    ptr[offset].w = 255;
}

static void key_func( unsigned char key, int x, int y ) {
    switch (key) {
        case 27:

            HANDLE_ERROR( cudaGraphicsUnregisterResource( resource ) );
            glBindBuffer( GL_PIXEL_UNPACK_BUFFER_ARB, 0 );
            glDeleteBuffers( 1, &bufferObj );
            exit(0);
    }
}

static void draw_func( void ) {

    glDrawPixels( DIM, DIM, GL_RGBA, GL_UNSIGNED_BYTE, 0 );
    glutSwapBuffers();
}

int main( int argc, char **argv ) {
    cudaDeviceProp  prop;
    int dev;

    memset( &prop, 0, sizeof( cudaDeviceProp ) );
    prop.major = 1;
    prop.minor = 0;
    HANDLE_ERROR( cudaChooseDevice( &dev, &prop ) );

    cudaGLSetGLDevice( dev );

    glutInit( &argc, argv );
    glutInitDisplayMode( GLUT_DOU@harrism : BLE | GLUT_RGBA );
    glutInitWindowSize( DIM, DIM );
    glutCreateWindow( "bitmap" );

    /*glBindBuffer    = (PFNGLBINDBUFFERARBPROC)GET_PROC_ADDRESS("glBindBuffer");
    glDeleteBuffers = (PFNGLDELETEBUFFERSARBPROC)GET_PROC_ADDRESS("glDeleteBuffers");
    glGenBuffers    = (PFNGLGENBUFFERSARBPROC)GET_PROC_ADDRESS("glGenBuffers");
    glBufferData    = (PFNGLBUFFERDATAARBPROC)GET_PROC_ADDRESS("glBufferData");*/

    glGenBuffers( 1, &bufferObj );
    glBindBuffer( GL_PIXEL_UNPACK_BUFFER_ARB, bufferObj );
    glBufferData( GL_PIXEL_UNPACK_BUFFER_ARB, DIM * DIM * 4,
                  NULL, GL_DYNAMIC_DRAW_ARB );

        cudaGraphicsGLRegisterBuf@harrism : fer( &resource, 
                                      bufferObj, 
                                      cudaGraphicsMapFlagsNone );

   cudaGraphicsMapResources( 1, &resource, NULL );
    uchar4* devPtr;
    size_t  size;

        cudaGraphicsResourceGetMappedPointer( (void**)&devPtr, 
                                              &size, 
                                              resource);

    dim3    grids(DIM/16,DIM/16);
    dim3    threads(16,16);
    kernel<<<grids,threads>>>( devPtr );
  cudaGraphicsUnmapResources( 1, &resource, NULL );

    // set up GLUT and kick off main loop
    glutKeyboardFunc( key_func );
    glutDisplayFunc( draw_func );
    glutMainLoop();
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-25T02:45:48.783

您在代码中注释掉了原书示例中的几行关键行。我不知道为什么要这样做，但最终结果是您在正确创建 openGL 渲染上下文之前尝试了某些 OGL 调用（glGenBuffers 是 seg 错误的来源）。

取消注释这 4 行会导致代码和标题中缺少“GET_PROC_ADDRESS”宏。这使我发现您没有正确包含原始书名。您的代码中还包含一些垃圾，例如各个地方的@harrism。

无论如何，我拿了你的代码并添加了一些东西，以下对我有用：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <GL/gl.h>
#include <GL/glut.h>
#include <cuda.h>
#include <cuda_runtime.h>
// #include "cutil.h"
#include <cuda_gl_interop.h>

#include <GL/glext.h>
#include <GL/glx.h>
#define GET_PROC_ADDRESS( str ) glXGetProcAddress( (const GLubyte *)str )

static void HandleError( cudaError_t err, const char *file,  int line ) {
    if (err != cudaSuccess) {
            printf( "%s in %s at line %d\n", cudaGetErrorString( err ),  file, line );
            exit( EXIT_FAILURE );
    }
}
#define HANDLE_ERROR( err ) (HandleError( err, __FILE__, __LINE__ ))

PFNGLBINDBUFFERARBPROC    glBindBuffer     = NULL;
PFNGLDELETEBUFFERSARBPROC glDeleteBuffers  = NULL;
PFNGLGENBUFFERSARBPROC    glGenBuffers     = NULL;
PFNGLBUFFERDATAARBPROC    glBufferData     = NULL;

#define     DIM    512

GLuint  bufferObj;
cudaGraphicsResource *resource;

__global__ void kernel( uchar4 *ptr ) {
// map from threadIdx/BlockIdx to pixel position
int x = threadIdx.x + blockIdx.x * blockDim.x;
int y = threadIdx.y + blockIdx.y * blockDim.y;
int offset = x + y * blockDim.x * gridDim.x;

// now calculate the value at that position
float fx = x/(float)DIM - 0.5f;
float fy = y/(float)DIM - 0.5f;
unsigned char   green = 128 + 127 *
                        sin( abs(fx*100) - abs(fy*100) );

// accessing uchar4 vs unsigned char*
ptr[offset].x = 0;
ptr[offset].y = green;
ptr[offset].z = 0;
ptr[offset].w = 255;
}

static void key_func( unsigned char key, int x, int y ) {
  switch (key) {
    case 27:

        HANDLE_ERROR( cudaGraphicsUnregisterResource( resource ) );
        glBindBuffer( GL_PIXEL_UNPACK_BUFFER_ARB, 0 );
        glDeleteBuffers( 1, &bufferObj );
        exit(0);
  }
}

static void draw_func( void ) {

glDrawPixels( DIM, DIM, GL_RGBA, GL_UNSIGNED_BYTE, 0 );
glutSwapBuffers();
}

int main( int argc, char **argv ) {
cudaDeviceProp  prop;
int dev;

memset( &prop, 0, sizeof( cudaDeviceProp ) );
prop.major = 1;
prop.minor = 0;
HANDLE_ERROR( cudaChooseDevice( &dev, &prop ) );

cudaGLSetGLDevice( dev );

glutInit( &argc, argv );
glutInitDisplayMode( GLUT_DOUBLE | GLUT_RGBA );
glutInitWindowSize( DIM, DIM );
glutCreateWindow( "bitmap" );

glBindBuffer    = (PFNGLBINDBUFFERARBPROC)GET_PROC_ADDRESS("glBindBuffer");
glDeleteBuffers = (PFNGLDELETEBUFFERSARBPROC)GET_PROC_ADDRESS("glDeleteBuffers");
glGenBuffers    = (PFNGLGENBUFFERSARBPROC)GET_PROC_ADDRESS("glGenBuffers");
glBufferData    = (PFNGLBUFFERDATAARBPROC)GET_PROC_ADDRESS("glBufferData");

glGenBuffers( 1, &bufferObj );
glBindBuffer( GL_PIXEL_UNPACK_BUFFER_ARB, bufferObj );
glBufferData( GL_PIXEL_UNPACK_BUFFER_ARB, DIM * DIM * 4,
              NULL, GL_DYNAMIC_DRAW_ARB );

cudaGraphicsGLRegisterBuffer( &resource,
                                  bufferObj,
                                  cudaGraphicsMapFlagsNone );

cudaGraphicsMapResources( 1, &resource, NULL );
uchar4* devPtr;
size_t  size;

cudaGraphicsResourceGetMappedPointer( (void**)&devPtr,
                                          &size,
                                          resource);

dim3    grids(DIM/16,DIM/16);
dim3    threads(16,16);
kernel<<<grids,threads>>>( devPtr );
cudaGraphicsUnmapResources( 1, &resource, NULL );

// set up GLUT and kick off main loop
glutKeyboardFunc( key_func );
glutDisplayFunc( draw_func );
glutMainLoop();
} 
```

# java - 在 Java 中使用 .equals 方法的正确方法是什么？

> ID：12486977
> 
> 赞同：14
> 
> 时间：2012-09-19T00:30:06.333
> 
> 标签：java, coding-style

我正在和我的 CompSci 教授交谈，他建议所有 String`.equals`方法都写成：

```
"Hello World".equals(fooString); 
```

而不是：

```
fooString.equals("Hello World"); 
```

这两行都可以编译，但我想知道第一种方式有什么好处？我一直都是后一种方式。这是错的吗？什么是常见/常规？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2012-09-19T00:31:57.230

第一种方式保证`NullPointerException`永远不会被抛出，而第二种方式可能会`NullPointerException`在`fooString`碰巧发生时冒着风险`null`。

但是，最终，这一切都归结为需求。如果需求规定这种`null`情况根本不应该发生，或者应该被区别对待，那么用第二种方式 ( `fooString.equals()`) 编写可以帮助您检测实现缺陷。如果您可以将`null`其视为另一种情况，那么第一种方法就可以了。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-09-19T00:38:14.293

第一种方法确保您在执行比较时不会收到**NullPointerException 。**当您尝试在不存在的对象上调用方法时，将引发（发生）此异常。

*下面有点相关的切线：自担风险仔细阅读*

不过需要注意的是，我很少真正看到在合法生产环境中使用这种技术或编码风格。有两个原因。

**首先，如果您的变量包含null**，您编写的程序几乎总是想做一些特殊或不同的事情。这是因为它通常表示代码功能的其他部分存在错误或需要解决的特殊情况。因此，空值检查应始终在对对象（在本例中为您的）进行任何比较或方法调用*之前*`String fooString`进行。

其次，`fooString.equals("Hello World")`只是倾向于使您的代码更具可读性。代码中第一种技术的逻辑意义需要几秒钟才能正确处理，并且在浏览数百或数千行代码时很容易做出判断错误。这实际上远没有听起来那么琐碎，因为在工作世界中，通常会有非常大且非常古老的程序会被对它们一无所知的人修补，然后再瞥一眼它们以解决问题。代码可读性极大地提高了公司执行快速分类和解决长期问题的能力。

# ruby - RubyGems 创建 gem 批处理文件是错误的还是我遗漏了什么？

> ID：12486985
> 
> 赞同：1
> 
> 时间：2012-09-19T00:31:47.337
> 
> 标签：ruby, batch-file, rubygems

Ruby 安装中有一些批处理文件引用*了这个*Ruby exe ( `$~dp0ruby.exe`)。例如，`gem.bat`（注意最后一行）

```
@ECHO OFF
IF NOT "%~f0" == "~f0" GOTO :WinNT
ECHO.This version of Ruby has not been built with support for Windows 95/98/Me.
GOTO :EOF
:WinNT
@"%~dp0ruby.exe" "%~dpn0" %* 
```

*但是，一些 gem 会得到一个引用系统*Ruby ( )的批处理文件`ruby.exe`，无论`PATH`. 例如，`bundle.bat`

```
@ECHO OFF
IF NOT "%~f0" == "~f0" GOTO :WinNT
@"ruby.exe" "C:/Ruby192/bin/bundle" %1 %2 %3 %4 %5 %6 %7 %8 %9
GOTO :EOF
:WinNT
@"ruby.exe" "%~dpn0" %* 
```

我有一个用于 .NET 项目的隔离 Ruby 环境（开发人员或构建代理不太可能拥有系统 Ruby）。但是，许多 gem（bundler、rake 等）正试图在不存在的系统 Ruby 中执行。

```
C:\
  Ruby192\            <-- System Ruby, would be here
    bin\                  and this bin would be in the
      bundle.bat          PATH
      gem.bat
      ruby.exe

  <some-other-path>\  <-- An isolated environment, in
    Ruby\                 my problem, this is deployed 
      bin\                to a build agent
        bundle.bat
        gem.bat
        ruby.exe 
```

是什么赋予了？这是 ruby​​gems[创建](https://github.com/rubygems/rubygems/blob/master/lib/rubygems/installer.rb#L627)批处理文件的方式的缺陷吗？

```
def windows_stub_script(bindir, bin_file_name)
  ruby = File.basename(Gem.ruby).chomp('"')
  return <<-TEXT
@ECHO OFF
IF NOT "%~f0" == "~f0" GOTO :WinNT
@"#{ruby}" "#{File.join(bindir, bin_file_name)}" %1 %2 %3 %4 %5 %6 %7 %8 %9
GOTO :EOF
:WinNT
@"#{ruby}" "%~dpn0" %*
TEXT
end 
```

`ruby.exe`不引用你曾经使用过的`gem install`这个 gem的想法是什么？我只是做错了吗？我应该需要一个系统 Ruby，然后使用 Bundler 或其他东西来隔离它吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-19T15:23:05.123

我是 RubyInstaller 项目的维护者之一，该项目产生了您展示的第一个批处理文件。

编译 Ruby 时，我们将 Ruby 构建的生成的批处理文件替换为我们自己的[`batch_stub`](https://github.com/oneclick/rubyinstaller/blob/master/recipes/interpreter/ruby19.rake#L187-196)

这个存根被认为`%~dp0`是 Ruby 的可执行文件相对于这个批处理文件的位置，因为我们知道这些批处理文件将与可执行文件一起存在。

Gems 可以安装在任何地方，而不仅仅是在 Ruby 的树中（例如，使用 Bundler 或`gem install --install-dir`or `--bindir`）。

在这些情况下， RubyGems 批处理文件不能`%~dp0`用来确定 Ruby，这就是为什么这些批处理文件存根**仅** `ruby.exe`包含在其中的原因。

正如您所指出的，问题在于`ruby.exe`将从 中找到`PATH`，其中包含您的全局 Ruby 安装，而不是您正在处理的孤立的安装。

快速修复将在`PATH`此隔离 Ruby 的目录前添加：

```
SET PATH=C:\<some-other-path>\Ruby\bin;%PATH% 
```

你可以把它放在一个批处理文件中，比如`setenv.bat`在执行 Ruby 之前调整环境（或作为启动脚本）。

另一种选择是使用类似[gem-exefy 的](https://github.com/bosko/gem-exefy)东西，它将替换可执行存根的批处理文件，并将使用相对于它找到的 Ruby dll，因此将使用隔离版本而不是全局版本。

对于家庭作业，我不确定是否`bundle exec`会起作用，因为它将`PATH`用于查找要运行的可执行文件，因此无法详细告诉您。

希望这能解释为什么 RubyGems 生成的批处理文件与 RubyInstaller 生成的批处理文件不同。

# javascript - JPlayer: how to set up for video?

> ID：12486990
> 
> 赞同：0
> 
> 时间：2012-09-19T00:32:49.817
> 
> 标签：javascript, jquery, video, jquery-plugins, jplayer

I cannot find any good resources online so I am hoping someone might know here. I just need to set up jplayer to play videos. I have followed the source code of this page: [http://www.jplayer.org/latest/demo-01-video/](http://www.jplayer.org/latest/demo-01-video/)

But my player just doesnt appear - I just get a garbled mess of divs and icon images. Has anyone used this plugin before?

**EDIT:** Noticed I get this error in console: `Uncaught TypeError: Object #<Object> has no method 'jPlayer'` from within the actual `jquery.jplayer.min.js` file...

I made sure I have links to the .js and css files set up fine. I have the follow code in my header:

```
$("#jquery_jplayer_1").jPlayer({
        ready: function () {
            $(this).jPlayer("setMedia", {
                m4v: "http://www.jplayer.org/video/m4v/Big_Buck_Bunny_Trailer.m4v",
                ogv: "http://www.jplayer.org/video/ogv/Big_Buck_Bunny_Trailer.ogv",
                webmv: "http://www.jplayer.org/video/webm/Big_Buck_Bunny_Trailer.webm",
                poster: "http://www.jplayer.org/video/poster/Big_Buck_Bunny_Trailer_480x270.png"
            });
        },
        swfPath: "http://www.jplayer.org/2.1.0/js",
        supplied: "webmv, ogv, m4v",
        size: {
            width: "640px",
            height: "360px",
            cssClass: "jp-video-360p"
        }
    }); 
```

and I have the following in my HTML body:

```
<div id="jp_container_1" class="jp-video jp-video-360p">
<div class="jp-type-single">
<div class="jp-gui">
<div class="jp-video-play">
                        <a class="jp-video-play-icon" tabindex="1" href="javascript:;">play</a>
                    </div>
<div class="jp-interface">
<div class="jp-progress">
<div class="jp-seek-bar">

                            </div>
</div>
<div class="jp-controls-holder">

<ul class="jp-controls">
<li><a class="jp-play" tabindex="1" href="javascript:;">play</a></li>
<li><a class="jp-pause" tabindex="1" href="javascript:;">pause</a></li>
<li><a class="jp-stop" tabindex="1" href="javascript:;">stop</a></li>
<li><a class="jp-mute" title="mute" tabindex="1" href="javascript:;">mute</a></li>
<li><a class="jp-unmute" title="unmute" tabindex="1" href="javascript:;">unmute</a></li>
<li><a class="jp-volume-max" title="max volume" tabindex="1" href="javascript:;">max volume</a></li>
</ul>
<div class="jp-volume-bar">

                            </div>
<ul class="jp-toggles">
<li><a class="jp-full-screen" title="full screen" tabindex="1" href="javascript:;">full screen</a></li>
<li><a class="jp-restore-screen" title="restore screen" tabindex="1" href="javascript:;">restore screen</a></li>
<li><a class="jp-repeat" title="repeat" tabindex="1" href="javascript:;">repeat</a></li>
<li><a class="jp-repeat-off" title="repeat off" tabindex="1" href="javascript:;">repeat off</a></li>
</ul>
</div>
<div class="jp-title">

<ul>
<li>Big Buck Bunny Trailer</li>
</ul>
</div>
</div>
</div>
</div>
</div> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-10-03T05:12:02.450

我也遇到了同样的问题，但如果找到本教程的源代码。它在 Chrome 和 Firefox 上运行良好。但不是在 IE 7、8、9 上。我对此提出了另一个[问题](https://stackoverflow.com/questions/19135334/jplayer-doesnt-support-ie-7-8-9)。

我想这个答案对你来说可能为时已晚。但在这里。

[http://webdesign.tutsplus.com/tutorials/site-elements/skin-orman-clarks-video-interface-using-jplayer-and-css/](http://webdesign.tutsplus.com/tutorials/site-elements/skin-orman-clarks-video-interface-using-jplayer-and-css/)

# scala - Twitter says Scala can't emit a raw unvarnished volatile field. True?

> ID：12486992
> 
> 赞同：8
> 
> 时间：2012-09-19T00:32:54.430
> 
> 标签：scala

The fine Twitter util library has the following Java class, which is extended by a Scala class that reads the volatile field and updates it using AtomicReferenceFieldUpdater. Access must be at least private, i.e., must allow other.state.

Is the motivational claim in the comment true? How true? ("How" means in what way and to what degree.)

```
public class IVarField<A> {
  /** This is needed because we cannot create a field like this in Scala.  */
  volatile State<A> state;
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-09-19T00:32:54.430

Something like the following works.

Making the field "private [this]" turns it into the desired field reference ("getfield").

Access from a different instance is through an accessor "state()" which, if made @inline, will happily loosen the access restriction to the field.

That also means that the updater (which happens to reside in the companion module) can also access it.

(Because the normal accessor for the var is not emitted for an object-private member, you can define your own, using parens. But you don't need to use parens at the call site, other.state. Your uniform access principle dollars at work. Or Swiss francs.)

Also notice the totally hip usage of ``new`` in backticks for a param name. I ~~don't~~ even know how to make the ticks show up in this markup. Because both params are the same type, one is likely to want to write `cas(expect=prev, `new`=changed)`, so I might have used `next` instead, but if this markup supported a hipster thumbs-up, I'd give it right now. :+1: Did it work? Can anyone see my thumb? [I guess I saw that on github. Hubster, not hipster.]

```
object IVar {
  // TODO: retrieve mangled name by reflection
  private final val stateField = "com$twitter$concurrent$IVar$$state"
  private val stateUpd = AtomicReferenceFieldUpdater.newUpdater(
        classOf[IVar[_]], classOf[State[_]], stateField)
}

final class IVar[A] {  //}extends IVarField[A] {
  import IVar._

  @volatile private[this] var state: State[A] = initState: State[A]

  @inline private final def state(): State[A] = this.state

  override def toString = "Ivar@%s(state=%s)".format(hashCode, state)

  @inline private[this]
  def cas(expect: State[A], `new`: State[A]) = stateUpd.compareAndSet(this, expect, `new`)

  def depth: Int = {
    @tailrec
    def loop(iv: IVar[_], d: Int): Int = iv.state match {
      case Linked(iv) => loop(iv, d + 1)
      case _ => d
    }
    loop(this, 0)
  }
  // etc
} 
```

Showing that state() is really inlined:

```
private final int loop$1(com.twitter.concurrent.IVar, int);
  flags: ACC_PRIVATE, ACC_FINAL
  Code:
    stack=3, locals=5, args_size=3
       0: aload_1
  // Field   com$twitter$concurrent$IVar$$state:Lcom/twitter/concurrent/ivar/State;
       1: getfield      #16                 
       4: astore_3 
```

Not only is it "OK to ask and answer your own questions",

[https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/](https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/)

it's infinitely more satisfying.

(More power to Daniel Sobral, Rex Kerr, Retronym and the rest of the Justice League.)

# javascript - stopPropagation() 但保持其他点击事件处于活动状态

> ID：12486995
> 
> 赞同：2
> 
> 时间：2012-09-19T00:33:20.660
> 
> 标签：javascript, jquery

我有一些 jQuery 代码来关闭我的菜单：

```
$('body').click(function(){
  $('#menu').hide();
});
$("#menu").click(function(e) {
  e.stopPropagation();
  return false;       
}); 
```

但是，在我的 #menu 元素上，我有一些附加了点击事件的元素：

```
$('.menu_elem').live("click", function(){
  //Do something
}); 
```

我的问题是 e.stopPropagation() 阻止了我的菜单的点击事件。我怎样才能避免这种情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-09-19T00:36:24.403

您可以使用 e.target 来包含或排除条件中的元素用于 stopPropagation，

```
$("#menu").click(function(e) {
   if(e.target.id == "menu")
   {
     e.stopPropagation();
     return false;       
   }
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T00:44:03.837

我不确定我是否完全理解您的 HTML，但如果`#menu`是您的菜单的根目录并且`.menu_elem`是菜单中的菜单项，那么您可以将委托的事件处理更改为`#menu`像这样捕获：

```
$("#menu").on("click", ".menu_elem", function () {
   // do something
}); 
```

这具有以下优点：

1.  它更改了委托事件处理以捕获冒泡事件，`#menu`因此它不需要传播超出`#menu`以工作，因此您不必更改`.stopPropagation()`代码。

2.  它从（现在已弃用）`.live()`切换到替换`.on()`，这使您可以更好地控制冒泡事件的捕获位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-19T00:36:53.703

在调用 stopPropagation.. 之前编写你想要执行的代码并调用它。

```
$("#menu").click(function(e) {

// Your code here
  e.stopPropagation();
  return false;       
}); 
```

或者使用 target 属性来包含你的点击事件

# jquery - 需要删除标签后的空格

> ID：12486999
> 
> 赞同：0
> 
> 时间：2012-09-19T00:34:15.997
> 
> 标签：jquery, html, css

我正在研究一种设计，其中强标签旨在发送下一行旁边的任何内容。CSS 看起来像这样：

```
strong { display: block; } 
```

html是这样的：

```
<p><strong>foo</strong> bar.<p> 
```

问题：强标记和后面的文本之间的空格在下一行显示为意外缩进。我在想，有一种方法可以在使用 jQuery 的强标签之后删除空格。我怎样才能做到这一点？

注意：我不能用 Fiddle 重现这个问题，所以我不知道它是否真的是导致缩进的空间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-19T00:40:49.673

既然你没有解决你的问题，我会把它扔掉......

IE 有一个怪癖，至少在怪癖模式下，元素之间的空白被渲染。解决方案是以这样的方式分解 HTML 以使空白不被标记..

一个例子...

```
<a
href="linkk1">This is my test</a><a
href="linkk2">Another</a><a
href="linkk3">Yet another</a> 
```

看看是否有帮助。