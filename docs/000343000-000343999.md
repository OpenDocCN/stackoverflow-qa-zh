# StackOverflow 问答 000343000-000343999

# .net - 在 Lucene 中搜索短语

> ID：343002
> 
> 赞同：3
> 
> 时间：2008-12-05T05:42:41.217
> 
> 标签：.net, search, lucene, lucene.net, phrase

有人可以给我举个例子，如何使用 Lucene.net 搜索短语吗？

假设我的索引中有一个字段为“name”、值为“Jon Skeet”的文档。现在我希望能够在搜索“jon skeet”时找到该文档。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T07:18:31.990

您可以使用[邻近搜索](http://lucene.apache.org/java/2_3_2/queryparsersyntax.html#Proximity%20Searches)来查找彼此相距一定距离内的术语。Lucene 查询语法如下所示`"jon skeet"~3`，意思是在三个单词中查找“jon”和“skeet”。使用这种语法，相对顺序无关紧要；“jon q. skeet”、“skeet, q. jon”和“jon skeet”都会匹配。

如果您有一个要视为单个标记的短语列表，则需要在分析器中处理它。例如，您想将“近东”、“中东”和“远东”视为单独的标记。您需要编写一个带有一些前瞻功能的分析器，以便它可以将这些短语视为一个单词。该分析器用于索引器和搜索应用程序中的用户输入。

# vb.net - 在 oracle 中隐藏/锁定表

> ID：343004
> 
> 赞同：1
> 
> 时间：2008-12-05T05:46:19.947
> 
> 标签：vb.net, oracle

如何在 Oracle 中隐藏/锁定一些表，以便只有我的应用程序有权修改表中的这些数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T12:52:32.080

您需要做的就是创建一个新用户并在该用户的架构下创建表。除了具有 SELECT/INSERT/etc ALL TABLES 权限的高权限用户之外，没有其他用户能够访问它们，除非您授予他们权限或授予他们的角色。

如果您想要最终的安全模型，您可能不想要，请在一个架构下创建表（比如 APP_DATA），并在另一个架构下创建存储过程（APP_CODE）。仅将 APP_DATA 对象上所需的权限授予 APP_CODE 架构，并且仅将 APP_CODE 架构上所需的权限授予其他用户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T06:16:38.527

创建一个用户/登录到您可以控制的数据库。将该用户指定为您需要“隐藏/锁定”的表的所有者（使用授权）。使用授权使其他用户无法访问（或只读）表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T07:08:26.193

创建用户后，请确保删除其他用户的授权。默认情况下，默认用户拥有授权。因此，请确保只有您的用户拥有所有授权

# .net - .NET 事件在 winform 中比 webform 更常见？

> ID：343012
> 
> 赞同：0
> 
> 时间：2008-12-05T05:54:36.560
> 
> 标签：.net, winforms, events, webforms

[在 winform 应用程序中声明这样](http://www.c-sharpcorner.com/UploadFile/rmcochran/customgenericeventargs05132007100456AM/customgenericeventargs.aspx)的自定义 .NET 事件是否比 webform 更常见？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T07:32:06.253

与 winforms 相比，自定义事件在 webforms 中可能更罕见，因为 http 是无状态的。因此，在许多情况下，您想要响应的用户操作通常以请求的形式出现，您使用查询字符串参数来确定响应的内容和方式。

但是我仍然发现自定义事件在我的 ascx 用户控件中非常有用，因为它是一种简单的方法来隐藏有关用户控件内部工作方式的详细信息，并且只需公开一个事件，当有趣的事情发生时页面可以做出反应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T19:37:55.180

对关键字“event”的文本搜索（注意末尾的空格）可以很好地指示公开自定义事件的类。

# asp.net - ASP.NET 自定义错误页面 - Server.GetLastError() 为空

> ID：343014
> 
> 赞同：114
> 
> 时间：2008-12-05T05:57:01.483
> 
> 标签：asp.net, exception, web-applications, custom-error-pages

我为我的应用程序设置了一个自定义错误页面：

```
<customErrors mode="On" defaultRedirect="~/errors/GeneralError.aspx"
/> 
```

在 Global.asax 的 Application_Error() 中，以下代码用于获取异常详细信息：

```
 Exception ex = Server.GetLastError();
  if (ex != null)
    {
        if (ex.GetBaseException() != null)
            ex = ex.GetBaseException();
    } 
```

当我到达我的错误页面 (~/errors/GeneralError.aspx.cs) 时，Server.GetLastError() 为空

有什么方法可以在错误页面而不是 Global.asax.cs 中获取异常详细信息？

Vista/IIS7 上的 ASP.NET 3.5

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2008-12-05T06:33:14.157

仔细查看我的 web.config 设置，[这篇文章中的一条评论非常有帮助](http://msdn.microsoft.com/en-us/library/vstudio/h0hfz6fc(v=vs.100).aspx)

> 在 asp.net 3.5 sp1 中有一个新参数 redirectMode

所以我们可以修改`customErrors`添加这个参数：

```
<customErrors mode="RemoteOnly" defaultRedirect="~/errors/GeneralError.aspx" redirectMode="ResponseRewrite" /> 
```

该`ResponseRewrite`模式允许我们在不重定向浏览器的情况下加载«错误页面»，因此 URL 保持不变，对我来说重要的是，异常信息不会丢失。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-12-05T06:23:32.850

好的，我找到了这篇文章：http: [//msdn.microsoft.com/en-us/library/aa479319.aspx](http://msdn.microsoft.com/en-us/library/aa479319.aspx)

使用这个非常说明性的图表：

[![图表](https://i.stack.imgur.com/p1YJZ.gif)](https://i.stack.imgur.com/p1YJZ.gif)
[（来源：[microsoft.com](http://i.msdn.microsoft.com/Aa479319.customerrors_01(en-us,MSDN.10).gif)）]

本质上，要获取这些异常详细信息，我需要自己将它们存储在 Global.asax 中，以便以后在我的自定义错误页面上检索。

似乎最好的方法是在 Global.asax 中完成大部分工作，使用自定义错误页面处理有用的内容而不是逻辑。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-05T19:29:30.610

NailItDown 和 Victor 所说的结合。首选/最简单的方法是使用您的 Global.Asax 来存储错误，然后重定向到您的自定义错误页面。

**全球.asax**：

```
 void Application_Error(object sender, EventArgs e) 
{
    // Code that runs when an unhandled error occurs
    Exception ex = Server.GetLastError();
    Application["TheException"] = ex; //store the error for later
    Server.ClearError(); //clear the error so we can continue onwards
    Response.Redirect("~/myErrorPage.aspx"); //direct user to error page
} 
```

此外，您需要设置**web.config**：

```
 <system.web>
    <customErrors mode="RemoteOnly" defaultRedirect="~/myErrorPage.aspx">
    </customErrors>
  </system.web> 
```

**最后，除了存储在错误页面**中的异常，做任何你需要做的事情：

```
protected void Page_Load(object sender, EventArgs e)
{

    // ... do stuff ...
    //we caught an exception in our Global.asax, do stuff with it.
    Exception caughtException = (Exception)Application["TheException"];
    //... do stuff ...
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-23T04:27:36.150

尝试在global.asax.cs`Server.Transfer("~/ErrorPage.aspx");`的方法中使用类似的东西`Application_Error()`

然后从`Page_Load()`ErrorPage.aspx.cs 内部，您应该可以执行以下操作：`Exception exception = Server.GetLastError().GetBaseException();`

`Server.Transfer()`似乎保持异常徘徊。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-06-07T20:39:08.660

虽然这里有几个很好的答案，但我必须指出，在错误页面上显示系统异常消息并不是一个好习惯（这是我假设你想要做的）。您可能会无意中向恶意用户透露您不希望这样做的内容。例如 Sql Server 异常消息非常冗长，可以在发生错误时给出数据库的用户名、密码和架构信息。该信息不应显示给最终用户。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-09-28T16:03:16.633

这是我的解决方案..

在 Global.aspx 中：

```
void Application_Error(object sender, EventArgs e)
    {
        // Code that runs when an unhandled error occurs

        //direct user to error page 
        Server.Transfer("~/ErrorPages/Oops.aspx"); 
    } 
```

在 Oops.aspx 中：

```
protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            LoadError(Server.GetLastError()); 
    }

    protected void LoadError(Exception objError)
    {
        if (objError != null)
        {
            StringBuilder lasterror = new StringBuilder();

            if (objError.Message != null)
            {
                lasterror.AppendLine("Message:");
                lasterror.AppendLine(objError.Message);
                lasterror.AppendLine();
            }

            if (objError.InnerException != null)
            {
                lasterror.AppendLine("InnerException:");
                lasterror.AppendLine(objError.InnerException.ToString());
                lasterror.AppendLine();
            }

            if (objError.Source != null)
            {
                lasterror.AppendLine("Source:");
                lasterror.AppendLine(objError.Source);
                lasterror.AppendLine();
            }

            if (objError.StackTrace != null)
            {
                lasterror.AppendLine("StackTrace:");
                lasterror.AppendLine(objError.StackTrace);
                lasterror.AppendLine();
            }

            ViewState.Add("LastError", lasterror.ToString());
        }
    }

   protected void btnReportError_Click(object sender, EventArgs e)
    {
        SendEmail();
    }

    public void SendEmail()
    {
        try
        {
            MailMessage msg = new MailMessage("webteam", "webteam");
            StringBuilder body = new StringBuilder();

            body.AppendLine("An unexcepted error has occurred.");
            body.AppendLine();

            body.AppendLine(ViewState["LastError"].ToString());

            msg.Subject = "Error";
            msg.Body = body.ToString();
            msg.IsBodyHtml = false;

            SmtpClient smtp = new SmtpClient("exchangeserver");
            smtp.Send(msg);
        }

        catch (Exception ex)
        {
            lblException.Text = ex.Message;
        }
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-06-05T20:23:01.563

我认为每个人都缺少的一个重要考虑因素是负载平衡（网络农场）场景。由于执行 global.asax 的服务器可能与执行自定义错误页面的服务器不同，因此将异常对象存储在 Application 中是不可靠的。

我仍在寻找一个可靠的解决方案来解决这个问题在 global.asax Application_Error 中。

PS 如果不先锁定再解锁，将数据存储在Application集合中是不安全的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-01-22T02:37:24.393

**它对我有用。在 MVC 5 中**

在`~\Global.asax`

```
void Application_Error(object sender, EventArgs e)
{
    FTools.LogException();
    Response.Redirect("/Error");
} 
```

* * *

在`~\Controllers`创建`ErrorController.cs`

```
using System.Web.Mvc;

namespace MVC_WebApp.Controllers
{
    public class ErrorController : Controller
    {
        // GET: Error
        public ActionResult Index()
        {
            return View("Error");
        }
    }
} 
```

* * *

在`~\Models`创建`FunctionTools.cs`

```
using System;
using System.Web;

namespace MVC_WebApp.Models
{
    public static class FTools
    {
        private static string _error;
        private static bool _isError;

        public static string GetLastError
        {
            get
            {
                string cashe = _error;
                HttpContext.Current.Server.ClearError();
                _error = null;
                _isError = false;
                return cashe;
            }
        }
        public static bool ThereIsError => _isError;

        public static void LogException()
        {
            Exception exc = HttpContext.Current.Server.GetLastError();
            if (exc == null) return;
            string errLog = "";
            errLog += "**********" + DateTime.Now + "**********\n";
            if (exc.InnerException != null)
            {
                errLog += "Inner Exception Type: ";
                errLog += exc.InnerException.GetType() + "\n";
                errLog += "Inner Exception: ";
                errLog += exc.InnerException.Message + "\n";
                errLog += "Inner Source: ";
                errLog += exc.InnerException.Source + "\n";
                if (exc.InnerException.StackTrace != null)
                {
                    errLog += "\nInner Stack Trace: " + "\n";
                    errLog += exc.InnerException.StackTrace + "\n";
                }
            }
            errLog += "Exception Type: ";
            errLog += exc.GetType().ToString() + "\n";
            errLog += "Exception: " + exc.Message + "\n";
            errLog += "\nStack Trace: " + "\n";
            if (exc.StackTrace != null)
            {
                errLog += exc.StackTrace + "\n";
            }
            _error = errLog;
            _isError = true;
        }
    }
} 
```

* * *

在`~\Views`创建文件夹`Error` 和`~\Views\Error`创建`Error.cshtml`

```
@using MVC_WebApp.Models
@{
    ViewBag.Title = "Error";
    if (FTools.ThereIsError == false)
    {
        if (Server.GetLastError() != null)
        {
            FTools.LogException();
        }
    }
    if (FTools.ThereIsError == false)
    {
        <br />
        <h1>No Problem!</h1>
    }
    else
    {
        string log = FTools.GetLastError;
        <div>@Html.Raw(log.Replace("\n", "<br />"))</div>
    }
} 
```

* * *

**如果您输入此地址`localhost/Error`** [![打开页面没有错误](https://i.stack.imgur.com/cNDPA.png)](https://i.stack.imgur.com/cNDPA.png)

* * *

**如果发生错误** [![发生错误](https://i.stack.imgur.com/d5RmS.png)](https://i.stack.imgur.com/d5RmS.png)

## 可以代替显示错误，将变量“日志”存储在数据库中

> 来源：[微软 ASP.Net](https://www.asp.net/web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/aspnet-error-handling)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-12-15T13:06:01.190

这与下面这两个主题有关，我想在错误页面上同时获取 GetHtmlErrorMessage 和 Session。

[ResponseRewrite 后会话为空](https://stackoverflow.com/questions/16397453/session-is-null-after-responserewrite)

[为什么当 redirectMode = ResponseRewrite 时 HttpContext.Session 为空](https://stackoverflow.com/questions/1589566/why-is-httpcontext-session-null-when-redirectmode-responserewrite/1701436#1701436)

我试过并看到不需要的解决方案`Server.Transfer() or Response.Redirect()`

**第一：去掉web.config中的ResponseRewrite**

**网页配置**

```
<customErrors defaultRedirect="errorHandler.aspx" mode="On" /> 
```

**然后 Global.asax**

```
 void Application_Error(object sender, EventArgs e)
    {
         if(Context.IsCustomErrorEnabled)
         {     
            Exception ex = Server.GetLastError();
            Application["TheException"] = ex; //store the error for later
         }
    } 
```

**然后errorHandler.aspx.cs**

```
 protected void Page_Load(object sender, EventArgs e)
            {       
                string htmlErrorMessage = string.Empty ;
                Exception ex = (Exception)Application["TheException"];
                string yourSessionValue = HttpContext.Current.Session["YourSessionId"].ToString();

                //continue with ex to get htmlErrorMessage 
                if(ex.GetHtmlErrorMessage() != null){              
                    htmlErrorMessage = ex.GetHtmlErrorMessage();
                }   
                // continue your code
            } 
```

**供参考**

[http://www.developer.com/net/asp/article.php/3299641/ServerTransfer-Vs-ResponseRedirect.htm](http://www.developer.com/net/asp/article.php/3299641/ServerTransfer-Vs-ResponseRedirect.htm)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-05T19:05:15.417

我想你在这里有几个选择。

您可以将最后一个异常存储在 Session 中并从您的自定义错误页面中检索它；或者您可以在 Application_error 事件中重定向到您的自定义错误页面。如果选择后者，则要确保使用 Server.Transfer 方法。

# piracy-prevention - 您的雇主是否强制使用反盗版软件？

> ID：343017
> 
> 赞同：0
> 
> 时间：2008-12-05T06:01:29.353
> 
> 标签：piracy-prevention

您的雇主如何限制/防止其产品的盗版？

一些人认为盗版可能是好事，因为它提供的市场份额和曝光率。当然，这些都是好处，但它们是有代价的。

您是否使用任何反盗版软件或方法来保护您的产品？为什么/为什么不？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-05T07:38:07.647

我认为您在决定软件保护时需要权衡许多因素，以及这些措施的侵入性或不便性。

最具侵入性（实施起来也很昂贵）的措施是硬件加密狗。由于巨大的成本和不便，我怀疑它是否会被更多地使用。你需要为每台运行软件的机器制造一个硬件。如果他们的加密狗出现故障，或者他们丢失或损坏了加密狗，合法用户可能会被蒙在鼓里。然后，您需要为它们寄送替代品。最后，熟练的破解者可以修补您的软件中查询加密狗的部分，从而使该方案无用。这通常用于最昂贵的软件产品（例如 AutoCAD）。从用户的角度来看，这意味着他们的软件可能随时过期，如果您的公司停业，最终该软件将无法再使用（无论如何都是合法的）。

注意：游戏制造商仍在坚持尝试使 CD 成为一种硬件加密狗，这可能会给消费者造成很大的挫败感，因为他们使用的方法会使 CD 难以（如果不是不可能）在某些驱动器中读取，并且通常在系统上安装许多阴暗的“设备驱动程序”以尝试防止变通方法。

下一个最具侵入性的，虽然实施起来便宜得多，是在线激活。该软件通常会为安装它的 PC 生成一个唯一标识符代码，并将其发送到激活服务器，激活服务器将为其提供解锁代码，使其只能在这台机器上运行。Windows XP 就是一个例子。虽然没有一块硬件可以制造、丢失或损坏，但这种方案仍然给用户带来了问题。每当他们需要将软件移动到新机器或重新安装他们当前的 PC，甚至足够更改硬件配置时，他们都需要重新激活。此外，如果他们无法访问互联网（是的，这仍然会发生！）您需要一个备用方案，例如呼叫中心，他们可以在其中拨打他们的机器代码并让操作员读取他们的解锁代码。

侵入性较小的仍然是一次性解锁代码，无论它在什么机器上，它都可以应用于软件。这对用户和软件分销商都有很多好处。首先，需要的支持要少得多，因为唯一可能出现的问题是用户丢失了此代码，您可以自动再次通过电子邮件发送给他们或通过电话阅读。这确实使盗版变得容易得多，但是您可以通过将他们的名称或公司名称标记到软件上的明显位置来减轻这种情况，从而很容易判断它是否被盗版。这种方法还意味着，只要用户保留解锁码，您的软件就永远不会“过期”。

最小侵入性根本没有保护。我认为，如果您试图销售商业产品，这是行不通的。盗版可能会增加合法销售，因为使用该产品的人越多，购买它的可能性就越大，但同样的效果可以通过允许软件 30 天（或其他合理期限）无限制试用，然后要求激活码。是的，这可以绕过，但是准备为软件付费的人通常不会去绕过你的解锁方案。

底线：没有万无一失的保护机制，你越是试图让你的机制万无一失，你就越会激怒你的合法买家，你需要给予的支持就越多，从而使你的整个运营变得不那么有利可图。

结束了很长的咆哮。（[Steve Yegge](http://steve-yegge.blogspot.com/)，你现在有竞争对手了！至少在字数方面。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T07:58:48.883

我真的相信，如今（或许之前）软件价值更多地基于支持和聚合服务，而不是代码本身。它很可能取决于您正在构建的软件类型，因此，如果您的软件是主流（阅读：操作系统、设计软件等），那么您的软件可能会被非法使用，而不是专门的会计应用程序或电子政务软件。

对于 Microsoft、Autodesk、Adobe 等公司来说，这更难，因为有大量的论坛、pdf、截屏视频、电子书和视频（有时也是“盗版”），您可以依靠它们来充分利用该软件，因此您可能不需要公司的“支持”。

对于 ISV 和小型软件公司而言，该软件非常适合某个市场，并且大多数情况下，破解者和以非法软件为生的一般人不会太在意您的应用程序，因为用户更喜欢看比如说，windows vista，而不是你的“x 公司会计软件”，因此，他们不会花时间破解你的软件，因为 99.8% 的市场根本不在乎。

至于“大”公司，我认为他们从“真正的”客户那里生活。普通用户，即上网和下载东西的用户可能会使用大量软件的未授权版本，因为......他们只是不在乎，他们将计算机用作娱乐，但对于使用该软件的人来说一种用于产生收入的工具，他们会将这个软件视为一项投资，并且他们确信他们最好支付许可证费用，这样当服务器出现故障的那一天，他们就会有人打电话，而不是在失去客户时等待破解补丁/销售量。

这很可能取决于您公司的预算，大多数公司没有时间或资源来创建反盗版解决方案或购买它们，但我想对于 ISV 来说，没有它运送您的产品可能是安全的，在最后，如果有人想免费使用您的软件，他们会，另一方面，那些了解您的产品是工具而不是您从 cnet 下载的东西的人知道附加价值（支持编号、手册、更新等） ) 是贵公司的人力资源可以为他们做的事情，对我来说，是最终产品的 50%。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-21T17:05:48.437

提供软件即服务，不再关心盗版。那是唯一可行的商业模式。其他一切都是愚蠢的无知。

人为地制造只有可以轻松复制的位和字节的东西的短缺是非常不合逻辑的。

但我想普通的象牙塔经理疯子永远不会明白这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T10:11:11.113

在我的公司，我们不使用它。我们在一个小众（10-20）客户的利基市场运营，因此透明度很高。我们的管理层相信我们会查明是否有些客户使用了未经许可的复制品。

为了决定您是否要投资于一项保护（您的时间是自己开发一项，还是花钱购买一项），您需要看看在经济上是否值得付出努力。

对于任何数百人使用的受保护软件，您都可以找到破解版。到目前为止，每个保护方案都可以被篡改。另一方面，并​​不是每个（潜在的）客户都知道如何找到破解版，因此使用保护方案可能会减少盗版的数量。

最大的未知数是：

1.  那些不使用破解版的人会向你购买许可证吗？
2.  保护方案的使用是否会阻止任何人购买许可证，如果软件没有受到保护，他们会购买许可证吗？

# .net - 是否有用于调整浮点值的控件之类的 winforms 微调器？

> ID：343018
> 
> 赞同：4
> 
> 时间：2008-12-05T06:02:51.300
> 
> 标签：.net, winforms, floating-point, spinner

我有一个带有浮点值的 .NET 应用程序，我想通过用户可调节的增量来上下调整它，比如[微调控件](http://kendsnyder.com/sandbox/Spinner/)。在我开始自己建造之前，这样的东西是否已经存在？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T06:15:19.810

像 NumericUpDown 一样？

[http://msdn.microsoft.com/en-us/library/system.windows.forms.numericupdown.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.numericupdown.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T06:42:24.450

[DevExpress](http://devexpress.com)在他们的套件中有这样一个[SpinEdit](http://devexpress.com/Products/NET/Controls/WinForms/Editors/editors/SpinEdit.xml)组件

# lucene - 查找 Lucene 中的所有功能

> ID：343024
> 
> 赞同：0
> 
> 时间：2008-12-05T06:09:07.077
> 
> 标签：lucene

我的网页上有以下两个字段：`BookAuthor`和`BookDescription`. 提交时，页面使用给定的搜索条件搜索 Lucene 索引。

如果用户没有在两个字段中输入任何内容并提交页面，我如何让 Lucene.Net 从我的索引中返回所有书籍而不考虑`BookAuthor`字段`BookDescription`值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T14:06:31.147

Use a [MatchAllDocsQuery](http://incubator.apache.org/lucene.net/docs/2.1/Lucene.Net.Search.MatchAllDocsQuery.html).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T07:12:18.867

这里的常见解决方案是为索引中的每个文档添加另一个字段。这是一个假字段，如“ALL_RECORDS”，包含一些虚拟值，如“x”。Lucene 不会接受空查询，因此如果用户尝试执行一个查询，您的应用程序会用类似“ALL_RECORDS:x”的查询替换它，它会返回每条记录。

# c++ - 1个千兆网卡准确带宽公式的需求

> ID：343025
> 
> 赞同：2
> 
> 时间：2008-12-05T06:09:42.160
> 
> 标签：c++, networking, network-programming

我需要公式来准确计算 1 Gig Nic 卡的带宽。我正在做的是以 1Gbps 的速度发送第 2 层数据包，但我的软件显示 6oo Mbps。

整个实验是背靠背的。没有交换机没有路由器。

这就是我所做的。

```
// LinkSpeed = 1Gb

UINT nBandwidth =   LinkSpeed/100;//Mbps

nBandwidth = nBandwidth/8; //Bytes/sec

nBandwidth = nBandwidth/FrameLength;
//Frames/Sec. Frame Length = 1518

UINT FramesPerBurst = (nBandwidth*Sleeptime)/1000;
//Frames/Burst 

UINT nBufferSpaceNeededPerFrame = FrameLength-4 + sizeof(dump_bpf_hdr));

UINT nTxBufferSize = FramesPerBurst * nBufferSpaceNeededPerFrame;

unsigned char* pTxBuffer = new
unsigned char[m_nTxBufferSize]; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T07:35:59.430

在以太网中，您还必须考虑[帧间间隙](http://en.wikipedia.org/wiki/Interframe_gap)，它至少为 96 个量子时间，即量子时间是发送比特的时间，即 GigaEthernet 中的 1ns（1 秒 / 1,000,000,000）。

此外，如果您遇到碰撞，将会有[退避时间](http://en.wikipedia.org/wiki/Truncated_binary_exponential_backoff)，该量子是在 0 到 2^<nb 碰撞> - 1 之间随机选择的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T08:43:49.167

仅仅因为您的卡是 1 Gigabit 卡，并不意味着您将获得整个速度。除了 Mat 所说的，您还必须担心信号衰减和干扰。如果路由器或交换机拥塞，这也会降低您的传输速度。没有公式可以为您提供真实世界数据传输速率的完全准确的数字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T09:09:44.420

如果你真的用整数做所有这些计算，你会得到一些奇怪的结果......

与电缆通信的硬件 99.999% 肯定能够达到 125MBytes/秒，轻负载的交换机也可能跟上。除非您遇到灾难，否则您也不会在线路上看到任何显着的错误率。

您的实际性能很可能受到您用于传输数据包的平台的影响 - 您对此不多说。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T07:57:10.913

首先，您至少需要一个“长”来存储编号。您收到的帧数。

要计算正在使用的带宽，

a = GetIntfCounters()

以秒为单位启动计时器（超时）

b = GetIntfCounters()

Pkts/sec = (b - a)/超时

比特/秒 = (Pkts/sec * pktsize)

字节/秒 = (位/秒)/8

GetIntfCounters() 取决于您使用的软件平台。您可以在给定的时间间隔内使用睡眠来代替计时器，然后计算该时间间隔内的 pps。但是，您设备接收帧的唯一实际带宽计算将是您是否考虑接口计数器。

# .net - .NET 中通过 WMI 的数据库大小

> ID：343033
> 
> 赞同：5
> 
> 时间：2008-12-05T06:15:35.503
> 
> 标签：.net, sql-server, wmi

有没有办法使用 .NET 中的 WMI 找出 SQL Server 数据库的大小？

我查看了[WMI 文档](http://msdn.microsoft.com/en-us/library/ms180499.aspx)，但不清楚如何找到该信息。

我们使用的是 SQL Server 2008。

-戴夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T06:55:50.743

您可以通过 Microsoft.SqlServer.Management.Smo 访问此属性。试试看：[MSDN](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.database.size.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T08:20:42.287

有点切题的答案，但每当我想玩 WMI 时，我都会先快速浏览一下Microsoft 的 WMI 浏览器[Scriptomatic 。](http://www.microsoft.com/technet/scriptcenter/tools/scripto2.mspx)

**针对 SQL Express 2005**这样做，唯一的 WMI 功能似乎与服务器本身有关，而不是针对任何数据库。

# requirements - 您在项目需求的初步头脑风暴中使用了哪些工具？

> ID：343034
> 
> 赞同：6
> 
> 时间：2008-12-05T06:15:47.080
> 
> 标签：requirements

除了铅笔和纸？我发现freemind，这个映射工具非常有用。还有其他想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T06:29:00.797

便利贴

白板和体面的彩色笔

将笔记钉在墙上

数码相机捕捉所有工作

这本书领域驱动设计:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T07:04:13.550

就我个人而言，我喜欢用纸质笔记本和铅笔来锻炼想法:-)，但有时我会使用[FreeMind](http://freemind.sourceforge.net/)。

检查此[思维导图软件](http://en.wikipedia.org/wiki/List_of_mind_mapping_software)列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T06:44:49.220

我发现这（[FreeMind](http://freemind.sourceforge.net/wiki/index.php/Main_Page)）是捕捉结构化非结构化思想的绝佳方式。非常适合集思广益，尽管它不涵盖图表方面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T07:16:44.117

通常我们使用写字板。个性化 - 铅笔和纸。我用来记笔记、制作待办事项和其他列表的最舒适的工具之一是[VIM Outliner](http://www.vimoutliner.org/)。如果你不使用 VIM，我相信你可以找到任何其他舒适的大纲。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T06:28:41.717

一个白板和一个摄像头，可以快速捕捉白板上的内容，以便能够继续进行下一件事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T06:29:01.687

严肃地说，当涉及到其他人时，就是一块白板。后来Microsoft Visio 将图纸从讨论中正式化。一位现在为我们公司工作的竞争对手的前设计总监经常捕捉会议的录音——他将其用于自己的利益；他不会用它来召唤人们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-05T07:08:11.653

[GoVisual](http://www.oreas.com/gde_en.php)是一款非常不错的免费绘图软件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-02T22:00:26.320

思维导图对于这个目的非常有用。当您有分布式团队时，您可能希望使用基于 Web 的思维导图应用程序。我正在使用[Mindomo](http://www.mindomo.com/)与其他需求管理和开发团队共享初始（而不仅仅是）需求文档。

我也经常使用draw&scan方法来捕捉和分享想法、评论、方案等。通常它比写一封普通的电子邮件或文档要好得多。

# linux - 程序分叉时如何清除输出缓冲区？

> ID：343035
> 
> 赞同：1
> 
> 时间：2008-12-05T06:15:50.730
> 
> 标签：linux, file-io, fork

我有一个写入 FILE *cgiOut 的程序，在它写入流之后，我需要分叉并运行一个后台进程。问题是，在 fork 之后，FILE * 流似乎有时会被刷新，并且我得到重复的输出（在 fork 之后，所有打开的文件都被关闭，我猜这会导致缓冲区被刷新）。我怎样才能避免这种情况？我不想关闭主进程中的文件，因为它是在库中打开的，我认为它是一个套接字或管道。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T06:43:46.647

不太确定我理解你的问题，但是如果你想确保你的`cgiOut`缓冲区是空的，然后你`fork()`可以在你`fflush()`之前的流上使用`fork()`。这应该强制刷新缓冲区。

通过`setvbuf()`和朋友更改缓冲设置，可能适合使用无缓冲流。这样你就不会（阅读：不应该）有任何缓冲问题，但它可能不是你想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T06:44:26.710

[`fflush(file)`](http://opengroup.org/onlinepubs/007908775/xsh/fflush.html)

# php - 在 PHP 中检索浏览器和操作系统

> ID：343039
> 
> 赞同：3
> 
> 时间：2008-12-05T06:19:19.630
> 
> 标签：php, browser, operating-system

我需要通过 php 编码检索浏览器和操作系统。

我用过`$_SERVER['HTTP_USER_AGENT']`，但它显示以下

```
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 2.0.50727; .NET CLR 1.1.4322; IEMB3) 
```

如何将浏览器和操作系统与上述收到的值分开？

请指导我..

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T06:45:36.160

您可以使用[Google 代码 Browscap 类](http://code.google.com/p/phpbrowscap/)。它本质上与 PHP 的 get_browser() 做同样的事情，但您不必担心让您的 browscap.ini 保持最新。

这对我有用：

```
require('Browscap.php');
$browscap = new Browscap('/path/to/cache');
var_dump($browscap->getBrowser()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T06:36:30.623

只需为此[http://ie.php.net/manual/en/function.get-browser.php使用内置函数](http://ie.php.net/manual/en/function.get-browser.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T21:14:47.303

最好的方法是使用内置的 get_browser() 函数，因为如果你只运行一次，它比 Google-Code-version 快几倍。（如果您运行它 4 次以上，Google-Code-version 会更快）

因此，除非您需要自动更新并且一次只使用一项检查，否则您应该使用内置版本。:)

做一个 cronjob 来获得最新版本应该不难。;)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T06:33:04.220

[获取 browscap.ini](http://browsers.garykeith.com/)的副本，将 $_SERVER['HTTP_USER_AGENT'] 与该文件进行比较。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-05T06:34:23.717

你可以使用简单的explode()；

```
<?php
$ex=explode(' ',$_SERVER['HTTP_USER_AGENT']);
echo 'OS: '.$ex[4].' '.$ex[5].' '.$ex[6].'/n'; 
echo 'Browser: '.$ex[0]; 
?> 
```

# javascript - 隐藏 MS CRM 表单中包含只读字段的部分

> ID：343053
> 
> 赞同：1
> 
> 时间：2008-12-05T06:30:24.570
> 
> 标签：javascript, dynamics-crm, dynamics-crm-4

Javascript

我的代码将根据 Picklist 的值隐藏 MS CRM 表单中的各个部分。代码在 Picklist 的 onChange 事件中执行。它通过引用部分中的字段来隐藏部分，然后使用 ParentElement 语法向上导航 DOM，如下所示：

crmForm.all.fieldName.parentElement.parentElement.parentElement.style.display = 'none';

这似乎有效，但有 1 个例外。违规部分有一个只读字段，我认为这是原因。没有错误被抛出。我还尝试了 2 和 4 个“.parentElement”块的变体。

如何隐藏此部分？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T02:18:53.940

看看下面的帖子。它使用节位置而不是父元素。 [http://mscrm4ever.blogspot.com/2008/08/show-hide-crm-form-section.html](http://mscrm4ever.blogspot.com/2008/08/show-hide-crm-form-section.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T15:47:38.207

对不起，买你能解决问题吗？当该部分具有只读字段时，您说它适用于 1 个例外。这是您在示例中尝试使用的领域吗？或者您可以使用该部分中的任何字段，但如果该部分中有一个只读字段，它会失败？有什么异常（不起作用，javascript 错误）？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-29T07:35:19.637

先前按 # 部分隐藏的建议将起作用。或者您也可以尝试使用 fieldname_c 而不是 fieldname（并且应该只需要 2 个 parentElements）。_c 是该字段的“注释”（标签），应该更加一致。

# c++ - 如何在 Win32 上开始使用 C++ 编程？

> ID：343061
> 
> 赞同：2
> 
> 时间：2008-12-05T06:40:27.683
> 
> 标签：c++, winapi

我需要/渴望学习在 C++ 中针对 Win32 进行编程。我对 Win32 甚至是什么感到有些困惑，因为我在该平台上没有经验。

你会推荐什么让我开始在 Win32 上编程和调试 C++ 程序？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-12-05T07:17:23.583

一一回答您的（原始）问题：

* * *

**1/有人能告诉我Win32是什么吗？**

Win32 是 Windows 的应用程序编程接口 (API)。具体来说，它适用于 32 位 Windows 及更高版本，因为旧 API 主要适用于 16 位版本的 Windows、Windows ME 及之前的版本。

*旁白：我很确定微软可能想忘记我曾经存在过，只是重写历史书，说他们直接从 Win98 到 Win2k；他们可能还想用他们的其他产品做一些事情：“Vista，什么是 Vista？我们所知道的只有 Windows XP 和 Windows 7”*。:-)

第一个完全支持 Win32 的 Windows 版本是 Windows NT。

API 是您被允许进行的一组调用。对于 Windows，它包括诸如窗口创建和操作、多线程、图形绘制、文本渲染等。基本上，这是您的程序如何与 Windows 操作系统交互以完成任务。

公司发布他们的 API，以便客户可以用它们做有用的事情。还有其他方法可以让产品做事，但这些通常被称为未记录的功能，虽然一家好的公司会竭尽全力确保更高版本的 API 不会破坏您的代码，但使用未记录的功能不是他们的问题。使用它们后果自负。

* * *

**2/ 如何在win32中编译和执行c++程序？**

为此，您需要一个编译器。流行的选择是 Microsoft Visual C++（您可以从 Microsoft 免费获得 Visual Express 版本）、CygWin 或 MinGW（Windows 的极简 GNU）。在 Google 上搜索“windows 的免费 c++ 编译器”。

编译器获取 C++ 源代码并将其转换为可执行代码，能够在目标系统（本例中为 Windows）上运行。

一旦有了可执行文件，就可以像运行任何其他程序一样运行它。如果您`do_something.exe`在路径中创建可执行文件，只需`do_something`从命令行键入。

编译器不仅仅限制您使用命令行工具，它们还允许您创建成熟的图形应用程序，因此您只需双击文件管理器中的可执行文件，或创建关联的文件类型以自动运行可执行文件特定的文件类型。

* * *

**3/ 如何使用 c++ 程序在 win32 中调试？**

Visual C++ 集成开发环境 (IDE) 中包含编译器和调试器。调试相对轻松，因为您可以简单地单步执行程序的每一行并检查其行为。其他环境（例如 MinGW 和 CygWin）具有命令行调试器，它们不像 Visual C++ 那样与 Windows 紧密结合。

但我不得不承认，有时我仍然会通过`printf`在代码中插入语句并重新编译来进行调试。旧习难改。

* * *

**4/ 当我在win32中写c++程序时，我还需要知道什么？**

我几乎不知道从哪里开始。你面前有一段漫长的（但希望是愉快的）旅程。一旦您组织好安装编译器并尝试编译并运行您的第一个程序，最好在此处查看其他具体问题。

祝你好运。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-05T07:15:47.817

哇，在这里等一下。这是一个巨大的话题。您是否想在工作面试中临时学习 Win32 是什么？如果你需要学习 Win32，你需要 Charles Petzold 的《Programming Windows 5th Edition》一书：

[http://www.charlespetzold.com/pw5/](http://www.charlespetzold.com/pw5/)

它的旧没关系；它几乎仍然适用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-05T06:43:25.743

Win32 通常是指 Win32 API，可用于与 Windows 操作系统进行交互。也可以指平台，也就是Windows的32位版本。要对其进行编译，您将需要一个编译器，例如 Microsoft Visual C++ 或 MinGW/gcc。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-05T07:40:50.400

[您可以从这里](http://www.microsoft.com/express/)下载 Visual Studio Express 的免费版本（例如，Visual C# Express、Visual C++ Express），尽管它们没有这些产品的更高级功能，但它们仍然非常适合学习。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T07:25:30.353

形式上，Windows API 是 Microsoft 的核心应用程序编程接口集。给赶时间的人！获取 Microsoft Visual Studio。启动它并选择 Files->New Project 并选择 Visual C++ and Win32 Console Application。这将使您快速入门，调试也很容易。

# .net - asp.net 调查问卷引擎

> ID：343068
> 
> 赞同：24
> 
> 时间：2008-12-05T06:44:34.493
> 
> 标签：.net, asp.net, sql-server, workflow, survey

我希望实现（或作为最后手段构建）一种允许可扩展性和集成到现有工作流引擎的调查引擎。

调查/问卷引擎应该允许管理员用户添加新的问题和响应类型（文本/布尔/多个/等），应该使用 SQL Server 进行持久性和 ASP.NET 2.0 或更高版本。它应该利用 AD 来实现 Windows 集成身份验证和安全性。

有谁知道满足这些基本要求的好（免费或便宜甚至更好）现成的解决方案？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-04-07T20:58:13.663

在以下位置尝试 C# 开源调查项目（复兴的 Nsurvey 表单引擎和调查工具）：

[http://www.surveyproject.info](http://www.surveyproject.info)（提供演示站点和 Codeplex.com 的资源）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-06T14:04:31.717

如果您决定构建自己的解决方案，这些文章可能会很有用：

基于网络的调查变得容易： [http ://aspnet.4guysfromrolla.com/articles/061604-1.aspx](http://aspnet.4guysfromrolla.com/articles/061604-1.aspx)

使用 WebSurvey 控件的结果： [http ://aspnet.4guysfromrolla.com/articles/111004-1.aspx](http://aspnet.4guysfromrolla.com/articles/111004-1.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-29T21:30:19.477

查看用 C# ASP.NET 编写的[Zodiac.NET 调查引擎。](http://www.mentor-logic.com/index.php/products/components/zodiacnet)除了以 XML 格式定义调查问卷外，它满足您的大部分要求。它可以将答案作为 XML 文件保存在服务器上。您还可以使用其 API 将答案保存到任何数据库，并将 XML 动态绑定到 Web 控件。这个引擎的好处是它是 Web 控件的集合。当您想将其与现有应用程序集成时，这是一个很大的好处。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T16:24:05.727

[SelectSurvey.Net](http://www.classapps.com/SelectSurveyNETOverview.asp)运行良好且成本低于反馈服务器

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-07T21:42:43.067

您仍然可以在网上找到旧的 NSurvey 资源（[这里，例如](http://www.dotnetnukes.com/Members/NSurvey/tabid/81/language/en-US/Default.aspx)）。

它是免费的，只是不要获得反馈服务器（不幸的是，现在在 nsurvey.org 上）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-29T19:32:55.837

[Zodiac.NET](http://www.mentor-logic.com/index.php?option=com_content&view=article&id=46:zodiac-net-web-aspnet-survey-engine-software&catid=34:components&Itemid=63)是另一个 ASP.NET 调查/问卷引擎

# c - 如何让我的服务器同时打开与多个客户端的连接？

> ID：343075
> 
> 赞同：0
> 
> 时间：2008-12-05T06:54:57.530
> 
> 标签：c, multithreading, unix, networking

我想在 MacOS 机器上用 C 语言编写自己的小型聊天服务器。现在我想连接到所有在线并打开连接的客户端，以便能够接收和发送消息。问题是我只知道如何一次打开一个套接字连接。所以到目前为止只有一个客户可以连接，这样聊天有点无聊；）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T16:55:32.777

对于小型聊天服务器，最简单的解决方案可能是使用 select() 或 pselect()。

看看优秀[的 Beej's Guide to Network Programming](http://beej.us/guide/bgnet/)。在他的[select() 教程](http://beej.us/guide/bgnet/output/html/multipage/advanced.html#select)中，他构建了一个小型聊天服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T07:00:31.183

一种选择是将多线程与[pthreads](https://computing.llnl.gov/tutorials/pthreads/)库一起使用。另一种选择是在调用中使用异步 I/O [`select(2)`](http://linux.die.net/man/2/select)。使用`select(2)`，您打开一堆套接字，然后您可以轮询每个套接字以查看它是否有数据。如果它有数据，则读取它，否则继续下一个套接字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T13:24:30.893

由于 Mac OS X 基于 FreeBSD，为了获得最佳和最高效的程序，您应该使用[kqueue](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man2/kqueue.2.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T07:05:53.310

基本上你需要在你选择的端口上有一个监听套接字。一旦与侦听套接字建立连接，您需要在不同的端口号上打开一个新套接字并将客户端移交给这个新套接字。最好尝试使用预先编写的套接字库，因为在这里滚动您自己的将是一个复杂的过程。

尝试在[http://sourceforge.net](http://sourceforge.net)中搜索一些示例库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T07:08:22.307

看看[select、pselect](http://www.opengroup.org/onlinepubs/000095399/functions/select.html)和[poll](http://www.opengroup.org/onlinepubs/000095399/functions/poll.html)。

我自己从来没有使用过它们，但我怀疑它们是为了你想做的事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T08:09:32.637

一个程序有多个连接的socket是没有问题的，也不需要乱搞多线程。只需像以前一样保持打开连接即可。如果您的所有客户端都连接到同一个侦听器，请不要在之后关闭侦听`accept()`器 - 它会继续侦听更多传入连接。

使用`select()`或`poll()`检查所有打开的套接字上的传入数据。不要忘记将侦听套接字包含在描述符列表中`select()`- 传入连接是一个事件`select()`检测。

这真的很简单。没有火箭科学。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-05T16:45:08.257

你也可以使用 fork-on-accept，像这样：

```
int listen_fd, new_fd;

while ((new_fd = accept(listen_fd, NULL, NULL)) != -1) {
    if (fork())
        close(new_fd);
    else
        // handle client connection
} 
```

# sql-server - 对象的 SELECT 权限被拒绝

> ID：343078
> 
> 赞同：2
> 
> 时间：2008-12-05T06:55:56.857
> 
> 标签：sql-server, security, roles

如果在 SqlServer 中创建了一个自定义角色，我将其添加到 db__denydatareader 和 db__denydatawriter 角色中。我认为通过 db 并授予所有 neccersary 存储过程的 exec 权限。

一切正常，调用这些 sps 将运行良好。一个例外是使用 sp_executesql 执行动态 sql 的存储过程。这失败了

```
The SELECT permission was denied on the object 'listing_counter', database 'Cannla', schema 'dbo'. 
```

有什么方法可以授予角色运行此查询的权限而不授予它对基础表的选择访问权限？

我想我想要做的是在 sys.sp_executesql 上授予 exec 权限，但仅限于特定情况。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T07:28:14.000

您可以仅为使用 execute_sql 的存储过程创建一个新用户，授予他所需的权限，然后添加到带有 EXECUTE AS 'MyUser' 的过程定义中。 [请参阅 MSDN。](http://msdn.microsoft.com/en-us/library/ms188354.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T07:05:22.283

使用以下语句。它对我有用。

sp_addlinkedserver [@server=]'服务器'[，[@srvproduct=]'product_name'][，[@provider=]'provider_name']

```
 [ , [ @datasrc= ] 'data_source' ] 
 [ , [ @location= ] 'location' ] 
 [ , [ @provstr= ] 'provider_string' ] 
 [ , [ @catalog= ] 'catalog' ] 
```

# .net - ResolveAll 做什么

> ID：343085
> 
> 赞同：6
> 
> 时间：2008-12-05T07:02:07.220
> 
> 标签：.net, dependency-injection, inversion-of-control, castle-windsor

在国际奥委会`ResolveAll`做什么？我知道官方的答案是“解决所有与此类型匹配的有效组件”。这是否意味着它将返回任何实现给定接口的类？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-04T23:21:21.593

它将返回为给定接口注册的所有类。

...并且不等待解决任何参考。今天被我咬了！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-28T05:14:52.293

使用 Unity，ResolveAll 解析接口的每个注册映射，默认映射**除外**。

所以如果你注册了：

```
container.RegisterType<IInterface, ActualClassOne>(new ContainerControlledLifetimeManager());
container.RegisterType<IInterface, ActualClassOne>("Singleton", new ContainerControlledLifetimeManager());
container.RegisterType<IInterface, ActualClassOne>("Trans", new TransientLifetimeManager()); 
```

ResolveAll() 只会给你一个 IEnumerable 包含已解析的“Singleton”和“Trans”映射

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T07:22:59.237

它将返回为给定接口**注册的所有类。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-27T14:49:58.427

如果我有：

container.ResolveAll(new { argument = something}).Where(...)

似乎 T 的所有组件都用“某物”实例化，即使并非所有组件都完全填充 where 子句....谁负责释放这些额外的组件？

# objective-c - NSTextView 在写入 USB 设备时不会循环更新

> ID：343088
> 
> 赞同：1
> 
> 时间：2008-12-05T07:04:41.003
> 
> 标签：objective-c, cocoa, user-interface

我正在编写一个与 USB 设备通信的 Objective-C 应用程序。应用程序不断地向设备写入某些数据，并在一个文本视图中显示写入操作的状态，该文本视图是 NSTextView 的一个对象。`-[NSTextView insertText:]`当我从设备获取写操作状态时，我在循环中调用该方法。

问题是 NSTextView 不会在每次调用`-insertText:`. 只有在执行了整个循环之后，我才能获得 NSTextView 的全部内容。

我没有看到 NSTextView 类的适当刷新或更新方法。如何接收操作状态并同时更新 NSTextView？

```
- (IBAction)notifyContentHasChanged:(NSInteger) block {
    NSString *str;
    str = [NSString stringWithFormat:@"Block Written Successfully: %d\n", block];
    [data insertText:str];
}

- (IBAction)func {
    while(USB_SUCCESS(status))
    {
        printf("\nBlocks Written Successfully: %d",BlockCnt);
        [refToSelf notifyContentHasChanged:BlockCnt];
    }
} 
```

请注意，`printf`on 控制台会及时更新，但 NSTextView 不会。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T07:36:57.103

Mac OS X 不会立即将视图的更改刷新到屏幕上，以避免在这种情况下常见的闪烁和撕裂。这意味着您不能只是在更新视图时坐在循环中并执行阻塞操作；如果您这样做，应用程序人机界面中的视图或其他任何内容都不会更新，您的应用程序将显示为挂起并最终获得旋转光标。

（当应用程序在很短的时间后没有与窗口服务器通信时，会出现旋转光标；按照设计，没有办法抑制这种情况。这并不意味着“等待”，而是意味着“这个应用程序已经消失了进入杂草”，您应该努力确保它永远不会出现在您的用户面前。）

要管理 Cocoa 中的阻塞操作，您可以执行以下两项操作之一：

1.  您可以在后台线程中执行阻塞操作并将结果传达给主线程以更新您的人机界面。例如，您可以使用`select(2)`标准 UNIX 文件 I/O 调用以这种方式进行 I/O 或套接字通信。

2.  如果兼容版本可用，您可以在运行循环（例如主运行循环）上安排操作；这通常会为您管理阻塞版本的操作的后台线程。例如，NSFileHandle 在文件描述符之上提供了一个运行循环兼容的抽象；NSStream 也为套接字通信执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-04-20T20:04:23.157

你必须使用：

```
//Creates the background thread.
dispatch_queue_t backgroundQueue = dispatch_queue_create("Network", nil); 
```

创建一个新线程。然后，将您的代码包装在：

```
//Runs code in background thread.
dispatch_async(backgroundQueue, ^(void){
    //Code Here.
}); 
```

并且更新到 UI 应该包含在：

```
//Sends code within the background thread to the main thread.
dispatch_async(dispatch_get_main_queue(), ^(void){
    //Code Here.
}); 
```

所以在你的代码中：

```
- (IBAction)notifyContentHasChanged:(NSInteger) block {
    NSString *str;
    str = [NSString stringWithFormat:@"Block Written Successfully: %d\n", block];
    [data insertText:str];
}

- (IBAction)func {
    dispatch_queue_t backgroundQueue = dispatch_queue_create("Network", nil);
    dispatch_async(backgroundQueue, ^(void){
        while(USB_SUCCESS(status))
        {
            printf("\nBlocks Written Successfully: %d",BlockCnt);
            dispatch_async(dispatch_get_main_queue(), ^(void){
                [refToSelf notifyContentHasChanged:BlockCnt];
            });
        }
    });
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-06T06:31:04.470

您应该能够通过 -setNeedsDisplay: 方法刷新 NSTextView。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-03-24T18:53:55.310

我有一个循环从网络访问数据并将其填充到数据库中。在处理过程中，我想要一个类似控制台的窗口（不是 Xcode 中的窗口，因为这将是一个已编译的应用程序。）

所以我有一个 NSTextView ，每次循环时我都在改变 textStorage 并滚动到底部。不幸的是，唯一可见的变化发生在循环完成时（尽管是正确的。）

是否有某种简单的“好的，现在更新屏幕”方法，而无需获得低级别或编写更多代码？

# c++ - 异步使用 ReadDirectoryChangesW 时的线程死锁

> ID：343099
> 
> 赞同：1
> 
> 时间：2008-12-05T07:12:55.310
> 
> 标签：c++, readdirectorychangesw, asynchronous

我想在一个线程中实时监控多个目录的变化，所以我决定将 ReadDirectoryChangesW() 方法与 GetQueuedCompletionStatus 异步使用。这是我的代码：

```
static DWORD WINAPI Routine( LPVOID lParam )
{
    FileSystemWatcher* obj = (FileSystemWatcher*)lParam;

    obj->hDir[0] = CreateFile(
        obj->WatchedDir[0].c_str(),
        GENERIC_READ|GENERIC_WRITE,
        FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE,
        NULL,
        OPEN_EXISTING,
        FILE_FLAG_BACKUP_SEMANTICS|FILE_FLAG_OVERLAPPED,
        NULL
    );

    obj->hDir[1] = CreateFile(
   obj->WatchedDir[1].c_str(),
   GENERIC_READ|GENERIC_WRITE,
   FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE,
   NULL,
   OPEN_EXISTING,
   FILE_FLAG_BACKUP_SEMANTICS|FILE_FLAG_OVERLAPPED,
   NULL
    );

    if( INVALID_HANDLE_VALUE == obj->hDir[0] || INVALID_HANDLE_VALUE == obj->hDir     [1] ) 
{
    return false;
}

obj->IOCPHandle[0] = CreateIoCompletionPort(obj->hDir[0], NULL, 0, 1);
obj->IOCPHandle[1] = CreateIoCompletionPort(obj->hDir[1], NULL, 0, 1);

if (obj->IOCPHandle[0] == INVALID_HANDLE_VALUE || obj->IOCPHandle[1] ==  INVALID_HANDLE_VALUE)
{
    return false;
}

    char buf[ 2*(sizeof(FILE_NOTIFY_INFORMATION)+MAX_PATH) ];
    FILE_NOTIFY_INFORMATION* pNotify=(FILE_NOTIFY_INFORMATION *)buf;
    DWORD BytesReturned;
    LPOVERLAPPED overLap = NULL;

    m_pFileNotifyInfo = pNotify;
    dirEvents[0] = CreateEvent(NULL, TRUE, FALSE, NULL);
    dirEvents[1] = CreateEvent(NULL, TRUE, FALSE, NULL);*/

    while(true)
    {

    BOOL success = ReadDirectoryChangesW( obj->hDir[0],
    pNotify,
    sizeof(buf),
    true,
    FILE_NOTIFY_CHANGE_FILE_NAME|FILE_NOTIFY_CHANGE_DIR_NAME,
    &BytesReturned,
    overLap,
    NULL );
    BOOL success1 = ReadDirectoryChangesW( obj->hDir[1],
    pNotify,
    sizeof(buf),
    true,
    FILE_NOTIFY_CHANGE_FILE_NAME|FILE_NOTIFY_CHANGE_DIR_NAME,
    &BytesReturned,
    overLap,    
                 NULL );

    LPOVERLAPPED theOverLap;
    PULONG_PTR lpCompKey = NULL;
    if (GetQueuedCompletionStatus(obj->IOCPHandle[0], &BytesReturned, lpCompKey, &overLap, 100))
    {
    cout<<"First Dir Changed"<<endl;
    }

    if (GetQueuedCompletionStatus(obj->IOCPHandle[1], &BytesReturned, lpCompKey, &overLap, 100))
    {
    cout<<"Second Dir Changed"<<endl;
    }

    cout<<"Nothing happened yet"<<endl;

       }

    return 0;
} 
```

在这里，当我运行我的代码时，我的线程会无缘无故地阻塞，无论我为 GetQueuedCompletionStatus() 函数的最后一个参数设置什么值。我不知道为什么我遇到了这个问题。谁能告诉我原因？非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T17:40:14.073

1.  You have to specify a valid OVERLAPPED structure for asynchronous I/O to work. You are using NULL (`LPOVERLAPPED overLap = NULL;`).

2.  Concurrent I/O operations must use separate OVERLAPPED structures, not just one.

3.  Are you sure you need IOCP at all? I would just fill in `hEvent` in the OVERLAPPED structures and do a `WaitForMultipleObjects` on these events.

# .net - 如何获取构建程序集的 .NET 版本（1.1、2.0、3.0 等）？

> ID：343100
> 
> 赞同：3
> 
> 时间：2008-12-05T07:13:43.780
> 
> 标签：.net, assemblies, clr

我有一个集会。有没有办法检测使用哪个版本的 .NET 来构建该程序集？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T07:32:48.950

您可以使用 Assembly.ImageRuntimeVersion。根据[MSDN docs](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.imageruntimeversion.aspx)，默认情况下，这设置为用于构建程序集的 CLR 版本。虽然显然它可以改变。

它是一个字符串属性，因此您必须对其进行一些字符串比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T07:17:38.153

我不相信。使用 .NET 2.0 构建 .NET 1.1 应用程序相对困难，尽管这并非不可能 - 因此，如果您检查应用程序引用的 mscorlib 版本，您可以“可能准确”地了解它是使用 1.1 还是 2.0 构建的+。

在使用 VS2008 但针对 .NET 2.0 的目标进行构建时，您还需要问自己想要什么答案。你真的对使用哪个版本的编译器感兴趣吗？不同版本的编译器的输出之间可能存在一些特征差异。额外的功能也可能会泄露 - 如果应用程序是用 C# 编写的面向 .NET 2.0 的，您可以找到看起来像是从源代码中的匿名类型生成的类型。当然，这首先取决于所使用的语言功能......

为什么你需要知道这个，出于兴趣？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-16T15:07:39.563

对于 < 2.0 和 framework 4.0 的框架，引用的 mscorlib 的版本将为您提供框架版本。对于框架 2.0 - 3.5，检查是否存在对 System.Core 或其他 3.5+ 程序集之一以及 PresentationCore 或任何其他 3.0+ 程序集的引用。如果你没有这些，它应该定位到 2.0。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T08:13:27.497

您可以使用 System.Reflection 检查系统引用程序集的版本号。

```
using System;
using System.Reflection;

class Module1
{

    public static void CheckReferencedAssemblies(string assemblyPath)
    {
         Assembly a = Assembly.Load(assemblyPath);

        foreach (AssemblyName an in a.GetReferencedAssemblies() )
        {
             // Check an.Version for System assemblies
        }
    }
} 
```

编辑：我不确定我是否明白你想要什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T08:18:09.717

您的问题的部分问题是 .NET 在不随版本增加而更改代码方面做得很好。我的意思是 mscorlib 在 .NET 4.0 中与在 .NET 1.1 中的相同。

但我有点同意 Jon Skeet 隐含的问题：你为什么需要知道？这纯粹是出于兴趣吗，因为我认为这对你来说不重要。

# regex - 双间距复杂 Sed 输出

> ID：343101
> 
> 赞同：0
> 
> 时间：2008-12-05T07:14:47.693
> 
> 标签：regex, unix, shell, sed

让我首先说我知道可能有一种更简单的方法可以做到这一点。但这就是我所拥有的，是的，希望我能在最后做出一些改进和/或简化。

**此刻的目标**

将存储在下面变量中的输出加倍，并对`$tmp`每一行单独编号。这样做应该在不同的行上为我提供每组可执行命令。

*问题 1*

我已经尝试了所有我能想到的将变量中的空间加倍的方法。移动双空格命令，并更改命令本身。

要对我尝试修改此代码的文件进行编号：

```
 sed = filename | sed 'N; s/^/ /; s/ *\(.\{6,\}\)\n/\1 / 
```

当然，用 awk 进行了实验，但没有进展..

**不是那么长期的目标**

*   将这些命令一一执行并比较字节差异。或者只是任何一般的差异。我知道此时我可以使用 diff 命令，`file1 file2`然后将输出保存在某个变量中，例如：`"$diffA $diffB"`并每次使用循环更新它，以便有可能将超过 2 个文件作为参数传递。
*   告诉每个命令行之间的区别。并回显类似：

> file1 中的第 1 行与 file2 中的第 1 行不同，请查看：“$diffA $diffB”

这是我到目前为止所拥有的，它是一个开始：

```
#!/bin/bash

FILE="$1"

echo "You Entered $FILE"

if [ -f $FILE ]; then

tmp=$(cat $FILE | sed '/./!d' | sed -n '/regex/,/regex/{/regex/d;p}'| sed -n '/---/,+2!p' | sed -n '/#/!p' | sed 's/^[ ]*//' | sed -e\
s/[^:]*:// | sed -n '/regex /!p' | sed -n '/regex /!p' | sed -n '/"regex"/,+1!p' | sed -n '/======/!p' | sed -n '/regex/!p' | sed -n '/regex\
\r/!p' | sed -n '/regex /!p' )

fi

MyVar=$(echo $tmp)

echo "$MyVar | sed G"

FILE2="$2"
if [ -f $FILE2 ]; then
    if [ -f $FILE2 ]; then
         tmp2=$(cat $FILE2 | sed -n '/regex/,/regex/{/regex\ S/d;p}' |\ 
sed -n '/#/!p' | sed -e s/[^:]*:// | sed /--------/,+10d)
     fi

echo "$tmp2" 
```

很感谢任何形式的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T11:41:21.053

以下 awk 脚本将输出双倍间距并对行编号：

```
awk ' { print NF " " $0; print ""; }' 
```

您的问题是将其分配给变量：

```
( echo a; echo b) | awk ' { print NR " " $0; print ""; }' 
```

给出：

```
1 a

2 b 
```

但

```
tmp=$(( echo a; echo b) | awk ' { print NR " " $0; print ""; }')
echo "$tmp" 
```

给

```
1 a 2 b 
```

因为使用 $() 将用空格替换换行符。您将不得不使用一个临时文件：

```
tmp=$(mktemp)
awk ' { print NR " " $0; print ""; }' $FILE > $tmp
cat $tmp # Do something with the file
rm $tmp # Don't forget to clean up after yourself. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-25T06:17:33.793

这可能对您有用：

```
a=$(printf "aaa %d\n" {1..5} | sed = | sed 'N;s/\n//;G')
echo $a
1aaa 1 2aaa 2 3aaa 3 4aaa 4 5aaa 5
echo "$a"
1aaa 1

2aaa 2

3aaa 3

4aaa 4

5aaa 5 
```

解释：

1.  `sed =`插入一个行号，追加一个换行符，然后追加一行
2.  `sed 'N's/\n//;G'`添加一个换行符，读取另一行并附加它。`s/\n//`删除嵌入的换行符。`G`将换行符附加到行尾。在循环结束时，在打印之前重新附加换行符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-05T10:55:31.730

使用临时文件的另一种方法是使用引号来抑制换行符/空格替换：

```
tmp="$(echo a; echo b)"
echo "$tmp" 
```

# algorithm - 3D表面重建算法

> ID：343108
> 
> 赞同：4
> 
> 时间：2008-12-05T07:18:05.580
> 
> 标签：algorithm, math, 3d, interpolation

我有一个 3D 表面（例如圆锥）。它以等高线的形式投影到 2D 平面上，这意味着不同的 Z 在 2D 平面上会有不同的线条。问题出在轮廓上，如何通过插值恢复3D表面？我们只知道不同的折线之间的 z 差异。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T08:26:18.233

您提到的“轮廓”的技术术语是“等线”。
给定一组等值线，您首先需要在 3D 中构建点云（只是 3D 空间中的点集合）。你分两个阶段做到这一点。首先以均匀的间隔对每条等值线进行采样，得到 2D 点，然后将这些点提高适当的高度。
通过在任何地方追踪它，可以很容易地以均匀的间隔对一条线进行采样。您可以通过从最外侧的线开始并一条一条地向内追踪线，删除您追踪的每条线并跟踪您追踪的线数，来了解一条线的高度。
当然，您需要提前知道线之间的高度差是多少，最外面的线（或任何其他可以用作参考的线）的高度是多少

一旦有了 3D 点云，您就可以使用多种表面重建算法中的任何一种。[例如，这家公司](http://www.farfieldtechnology.com/download/)制作了一个应用程序，您可以从他们的网站下载一个命令行演示，该演示最多可用于 30,000 点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-29T10:15:27.420

在这种情况下，如果您的点在 z=f(x,y) 中或者您的形状是凸的，则表面重建算法会浪费时间。

对于 z=f(x,y) 是简单的解决方案

1.  仅使用 x,y 坐标的 delaunay 三角剖分
2.  使用之前的三角剖分绘制曲面，这次也使用 z。工作完成了！

你的形状是凸的，使用 convhull 算法

您的形状是凹形使用： http: [//www.advancedmcode.org/surface-recostruction-from-scattered-points-cloud-mycrust-robust.html](http://www.advancedmcode.org/surface-recostruction-from-scattered-points-cloud-mycrust-robust.html)

# asp.net - 如何在 ClientValidationFunction 中修剪字符串

> ID：343111
> 
> 赞同：0
> 
> 时间：2008-12-05T07:21:17.820
> 
> 标签：asp.net, javascript, validation, client-side

我正在为[CustomValidator](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.customvalidator.aspx)编写客户端验证函数，我需要检查输入字符串的长度。但在此之前，为了稍微抵消作弊者，我想从字符串中删除所有前导和尾随空格。在这种情况下，最简单的方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T07:47:04.600

最简单的方法是在您的页面上调用 ValidatorTrim(value) javascript 函数。此函数来自每个 asp.net 验证器在添加到页面时包含的 javascript。

但我不认为它是一个记录的特性，所以你不能依赖它在未来版本的验证器中可用。因此，我会通过 jQuery 进行测试，或者添加您自己的函数，正如 J Cooper 指出的那样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T07:32:31.603

请原谅我的迟钝，但您只是在寻找`trim`Javascript 中的函数吗？如果是这样，这是 jQuery 使用的：

```
function trim( text ) {
    return (text || "").replace( /^\s+|\s+$/g, "" );
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T07:47:57.937

不得不说我问的问题很容易用谷歌搜索，我已经调查过了。但是我想为 StackOverflow 社区贡献一个解决方案，如果您正在为 ASP.NET 页面编写客户端验证功能，该解决方案是最简单的。

众所周知，RequiredFieldValidator 还会修剪要检查的字符串的空格。如果您查看与您的应用程序关联的 ScriptResource.axd 文件的来源，您可以找到这个

```
function RequiredFieldValidatorEvaluateIsValid(val) {
    return (ValidatorTrim(ValidatorGetValue(val.controltovalidate)) != 
        ValidatorTrim(val.initialvalue))
} 
```

更有趣的是

```
function ValidatorTrim(s) {
    var m = s.match(/^\s*(\S+(\s+\S+)*)\s*$/);
    return (m == null) ? "" : m[1];
} 
```

代码片段。

因此，您不应该从头开始重写修剪功能，您已经拥有它并且可以使用它。

# php - 用于查找和标签之间的所有内容的正则表达式

> ID：343115
> 
> 赞同：6
> 
> 时间：2008-12-05T07:23:52.293
> 
> 标签：php, regex

我正在尝试找到一种方法来列出标签之间`<a>`的所有内容。`</a>`所以我有一个链接列表，我想获取链接的名称（不是链接的位置，而是它们在页面上的名称）。对我真的很有帮助。

目前我有这个：

```
$lines = preg_split("/\r?\n|\r/", $content);  // content is the given page
foreach ($lines as $val) {
  if (preg_match("/(<A(.*)>)(<\/A>)/", $val, $alink)) {     
    $newurl = $alink[1];

    // put in array of found links
    $links[$index] = $newurl;
    $index++;
    $is_href = true;
  }
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-05T08:10:15.943

标准免责声明适用：使用正则表达式解析 HTML 并不理想。成功取决于逐个字符级别的输入格式是否正确。如果你不能保证这一点，正则表达式将在某些时候无法做正确的事情。

话说回来：

```
<a\b[^>]*>(.*?)</a>   // match group one will contain the link text 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T11:00:55.397

我是正则表达式的忠实粉丝，但这不是使用它们的正确地方。

使用真正的 HTML 解析器。

*   你的代码会更清晰
*   它更有可能起作用

我在 Google 上搜索了一个 PHP HTML 解析器，并找到[了这个](http://sourceforge.net/projects/simplehtmldom/).

如果您知道您正在使用 XHTML，那么您可以使用 PHP 的标准 XML 解析器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T09:13:54.130

```
<a\s*(.*)\>(.*)</a>

<a href="http://www.stackoverflow.com">Go to stackoverflow.com</a> 
```

$1 = href="www.stackoverflow.com"

$2 = 访问 stackoverflow.com

我回答了一个类似的问题，以去除除标签之外的所有[内容](https://stackoverflow.com/questions/44078/strip-all-html-tags-except-links#44124)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T07:33:28.827

正则表达式，黑魔法，再次:)

我发现了一个关于常见正则表达式[的好问题。](https://stackoverflow.com/questions/331426/common-regular-expressions)有一些有趣的链接，您会在其中找到像您这样的非常常见的正则表达式。

> 抓取 HTML 标签
> 
> < TAG\b[^>] *>(.* ?) 用 RegexBuddy 分析这个正则表达式匹配特定 HTML 标记的开始和结束对。标签之间的任何内容都被捕获到第一个反向引用中。正则表达式中的问号使星号变得懒惰，以确保它在第一个结束标记之前而不是在最后一个结束标记之前停止，就像贪婪的星号一样。此正则表达式将无法正确匹配嵌套在自身内部的标签，例如 onetwoone。
> 
> <([AZ][A-Z0-9] *)\b[^>]* >(.*?) 用 RegexBuddy 分析这个正则表达式将匹配任何 HTML 标记的开始和结束对。请务必关闭区分大小写。此解决方案的关键是在正则表达式中使用反向引用 \1。标签之间的任何内容都被捕获到第二个反向引用中。此解决方案也不会匹配嵌套在自身中的标签。

否则：浏览此链接：[关键字“链接”](http://regexlib.com/Search.aspx?k=links)。过滤链接有一些有趣的方法。

我希望这有帮助 ：）

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T08:49:04.930

嗯.. 使用正则表达式并不完美，但是在 perl regexp 中，

```
m!<a .*?>(.*?)</a>!i 
```

应该给你匹配组一中该行的第一个链接的名称，忽略大小写。

限制：

*   不处理一行中的多个链接
*   不处理跨越多行的链接。
*   也将匹配锚标签。

您可以通过将所有行合并为一行，然后使用链接开始作为分隔符将其拆分为一个数组（或多行）来解决此问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-11T12:47:30.043

创建介于 之间的列表的最佳和最快的方法是使用 preg_match_all。

例子：

```
$pattern = '#<a[^>]*>([^<]*)<\/a>#';
$subject = '<a href="#">Link 1</a> <a href="#">Link 3</a> <a href="#">Link 3</a>';
preg_match_all($pattern, $subject, $matches);
print_r($matches[1]); 
```

或者

```
$pattern = '#<a[^>]*>(.*?)<\/a>#';
$subject = '<a href="#">2 > 1</a> <a href="#">1 < 2</a>';
preg_match_all($pattern, $subject, $matches); 
```

结果将是：

```
Array (
 [0] => Link 1
 [1] => Link 3
 [2] => Link 3
) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-06-24T16:45:37.673

随着图案

```
'<a.*?>(.*?)</a>' 
```

你会得到

```
['sign up', 'log in', 'careers 2.0'] 
```

在此标记中搜索：

```
<span id="hlinks-nav"><a href="/users/login?returnurl=%2fquestions%2f343115%2fregexp-for-finding-everything-between-a-and-a-tags">sign up</a><span class="lsep">|</span><a href="/users/login?returnurl=%2fquestions%2f343115%2fregexp-for-finding-everything-between-a-and-a-tags">log in</a><span class="lsep">|</span><a href="http://careers.stackoverflow.com">careers 2.0</a><span class="lsep">|</span></span> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-10-09T01:33:43.720

如果会有一些虚构的或无效的边缘情况，那么带有和标志的`["']`边界表达式也是一种选择，例如：`i``s`

```
<a\s.*?['"]\s*>((?:(?!<\/a>).)*)<\/a> 
```

### 测试

```
$re = '/<a\s.*?[\'"]\s*>((?:(?!<\/a>).)*)<\/a>/si';
$str = '<a href="https://google.com"
title="some title"
data-key="{\'key\':\'adf0a8dfq<>*1$4%\' >

some context in here <>

some context in there <>

</a>

<A href="https://google.com"
title="some title"
data-key="{\'key\':\'adf0a8dfq<>*1$4%\'>

some context in here

some context in there

</A>';

preg_match_all($re, $str, $matches, PREG_SET_ORDER, 0);

var_dump($matches); 
```

* * *

如果您想简化/修改/探索表达式，它已在[regex101.com](https://regex101.com/r/1yjQ5M/1/)的右上角面板中进行了说明。如果您愿意，您还可以在[此链接](https://regex101.com/r/1yjQ5M/1/debugger)中观看它如何与一些示例输入匹配。

* * *

### 正则表达式电路

[jex.im](https://jex.im/regulex/#!flags=&re=%5E(a%7Cb)*%3F%24)可视化正则表达式：

[![在此处输入图像描述](https://i.stack.imgur.com/hqhDD.png)](https://i.stack.imgur.com/hqhDD.png)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-10-09T22:59:47.947

如果我要抱怨所有的正则表达式解决方案，我想我需要实际演示如何使用正确的 HTML 解析器（OP 没有表明要解析的 HTML 以任何方式无效——所以一个合法的解析器绝对适合脚本的稳定性和质量）。

现在，我的建议确实要求您熟悉 DOMDocument（以及可选的 DOMXPath）的基础知识，但是一旦您了解了所涉及的组件，您就会发现其语法远没有正则表达式那么神秘。出于这个原因，我还将争辩说这种技术将提高脚本的整体可读性（对于您和您的代码的未来读者）。

代码：（[演示](https://3v4l.org/qtpkt)）

```
$html = <<<HTML
<a href="#">hello</a> <abbr href="#">FYI</abbr> <a title="goodbye">later</a>
<a href=https://example.com>no quoted attributes</a>
<A href="https://example.com"
title="some title"
data-key="{\'key\':\'adf0a8dfq<>*1$4%\'">a link with data attribute</A>
and
this is <a title="hello">not a hyperlink</a> but simply an anchor tag
HTML;

$dom = new DOMDocument; 
$dom->loadHTML($html);
$xpath = new DOMXPath($dom);
$linkText = [];
foreach ($xpath->evaluate("//a[@href]") as $node) {
    $linkText[] = $node->nodeValue;
}
var_export($linkText); 
```

输出：

```
array (
  0 => 'hello',
  1 => 'no quoted attributes',
  2 => 'a link with data attribute',
) 
```

如果您不关心`href`存在的属性：

代码：

```
$doc = new DOMDocument();
$doc->loadHTML($html);
$aTags = [];
foreach ($doc->getElementsByTagName('a') as $a) {
    $aTags[] = $a->nodeValue;
}
var_export($aTags); 
```

输出：

```
array (
  0 => 'hello',
  1 => 'later',
  2 => 'no quoted attributes',
  3 => 'a link with data attribute',
  4 => 'not a hyperlink',
) 
```

# specman - 我可以为一个变量设置一次约束并在 specman 中生成几次吗？

> ID：343126
> 
> 赞同：1
> 
> 时间：2008-12-05T07:32:23.257
> 
> 标签：specman

我有一个变量，我想在同一个函数中生成几次，每次都使用相同的约束集。我可以设置一次约束并`gen`多次设置约束吗？也就是说，而不是这样：

```
var a:uint;
gen a keeping {it in [100..120];};
// some code that uses a
.
.
.
gen a keeping {it in [100..120];};
// some code that uses a
.
.
.
gen a keeping {it in [100..120];};
// some code that uses a
// etc... 
```

我想这样做：

```
var a:uint;
keep a in [100..120];
.
.
.
gen a;
// some code that uses a
.
.
.
gen a;
// some code that uses a
.
.
.
gen a;
// some code that uses a
// etc... 
```

这样，如果我想更改`a`s 约束，我只需要做一次。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-13T02:50:50.847

您可以通过使变量成为封闭对象的实例成员来做到这一点。

```
a : uint;
keep a in [100..120];
my_method()@qualified_clk_rise_e is {

    gen a;
    ...
    gen a;
    ...
    gen a; 
}; 
```

如果多个 my_method() 同时在同一个对象上运行，则此实现不是线程安全的。您可以通过将生成的 'a' 分配给方法范围：

```
var my_a : uint;
gen a;
my_a = a; 
```

或者您可以编写一个生成“a”的方法：

```
gen_a(): uint is {
    gen result keeping { it in [100..120] };
};

my_method()@qualified_clock_rise_e is {
    var a : uint;
    ...
    a = gen_a();
    ...
    a = gen_a();
    ...
    a = gen_a();
    ...
}; 
```

# c# - 时间表：使用 SQL、LINQ 或类检索数据？

> ID：343133
> 
> 赞同：1
> 
> 时间：2008-12-05T07:36:01.223
> 
> 标签：c#, asp.net, sql-server, linq, design-patterns

我的问题是我想要一个填充了一组用于任务的时间的网格。它需要在顶部有星期几（最好是固定的 - 即太阳、星期一...星期六），任务名称在左列下方。网格的内容将包含当天在该任务上花费的各个小时。

实现这一目标的最佳方法是什么？选项一是尝试将其全部放入数据库中的 SQL 语句中。选项二是 LINQ 查询的集合，它们从 Tasks 和 TimeEntries 中提取原始数据并正确构建它。选项三是使用 LINQ 并将结果拉入一个类（或集合），然后将其绑定到控件（可能是 gridview）。

你会怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T14:18:29.847

我会在不知道您的结构的情况下对其进行粗略的破解，但猜测您有一个任务表和一个任务时间表，其中存储了每个任务的实际时间和日期。这未经测试，但：

select t.taskname, sum(case when datepart(d,tt.taskdate)= 1, tt.taskhours) else 0 end) as Sunday, sum(case when datepart(d,tt.taskdate)= 2, t.taskhours) else 0 end) as Monday from tasktable t join tasktime tt on t.taskid = tt.taskid where tt.taskdate >= @begindate and tt.taskdate<= @enddate

where 子句很重要，因为您可能只想在网格上一次显示一周（通常是当前周）。这还假设您已正确存储作为日期时间数据类型收费的小时的日期。（如果您现在还没有解决这个问题 - 您稍后会感谢我的。）变量将以某种方式从用户界面提交。我个人会这样做作为存储过程。我离开周二到周六让你去做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T07:44:14.730

您似乎暗示数据当前驻留在数据库中。最佳解决方案取决于数据的内部处理量和项目现有的基础设施。

我要么使用大型 SQL 查询将所有数据拉到一起并将直接绑定`ResultSet`到网格（几乎没有处理或基础架构），要么使用 LINQ 填充一种`TimeSheetModel`类，使用现有基础架构并启用进一步处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-06T19:42:19.273

您可以使用 LinqToSql 将行提取到内存中，然后使用 LinqToObjects 将这些行聚合到您的表格式中（这是一个旋转聚合）。

这篇文章显示了一个 linq 数据透视查询。在您的情况下，它会很好地工作，因为您知道要在设计时生成的列。 [SQL 命令到 LINQ（透视）](https://stackoverflow.com/questions/183585/sql-command-to-linq-pivoting#184032)

我建议使用 0 个匿名类。应该（至少）有一个类代表数据库中的一行，一个类代表网格中一行的值。

* * *

因为我可以在这里说任何我想说的，所以我想评论一下 HLGEM 的 SUM(CASE) 技术。我以前在只用 SQL 编写的报告中使用过它。它工作得很好......如果你想用 SQL 编写。

# postgresql - 从 PostgreSQL 数据库中检索评论

> ID：343138
> 
> 赞同：54
> 
> 时间：2008-12-05T07:39:22.823
> 
> 标签：postgresql, metadata

我正在 Postgres 数据库上运行一个项目，需要检索数据库中列上的注释以用作表标题等。我已经看到有几个内置函数（[pg_description](http://www.postgresql.org/docs/9.1/static/catalog-pg-description.html)和[col_description](http://www.postgresql.org/docs/9.1/static/functions-info.html)），但我无法找到有关如何使用它们的示例，并且使用它们被证明是徒劳的。

所以我想知道以前是否有人能够做到这一点，如果可以，怎么做？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2011-02-09T14:38:59.977

```
SELECT c.table_schema,c.table_name,c.column_name,pgd.description
FROM pg_catalog.pg_statio_all_tables as st
  inner join pg_catalog.pg_description pgd on (pgd.objoid=st.relid)
  inner join information_schema.columns c on (pgd.objsubid=c.ordinal_position
    and  c.table_schema=st.schemaname and c.table_name=st.relname); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-05T07:51:14.123

这一切都由oid工作，

```
mat=> SELECT c.oid FROM pg_catalog.pg_class c WHERE c.relname = 'customers';
  oid  
-------
 23208
(1 row) 
```

现在，我有那个表的 oid，所以我可以问：

```
mat=> select pg_catalog.obj_description(23208);
  obj_description  
-------------------
 Customers
(1 row) 
```

然后，我可以询问第四列的描述：

```
mat=> select pg_catalog.col_description(23208,4);
             col_description             
-----------------------------------------
 Customer codes, CHS, FACTPOST, POWER...
(1 row) 
```

如果您想知道在执行或`psql`时确实运行了哪些查询，只需使用.`\dt+``\d+ customers``-E`

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2014-03-20T23:55:37.147

小心模式，这段代码认为它们：

```
SELECT
    cols.column_name, (
        SELECT
            pg_catalog.col_description(c.oid, cols.ordinal_position::int)
        FROM
            pg_catalog.pg_class c
        WHERE
            c.oid = (SELECT ('"' || cols.table_name || '"')::regclass::oid)
            AND c.relname = cols.table_name
    ) AS column_comment
FROM
    information_schema.columns cols
WHERE
    cols.table_catalog    = 'your_database'
    AND cols.table_name   = 'your_table'
    AND cols.table_schema = 'your_schema'; 
```

参考：

*   [Postgresql 文档 表和列说明 表和列的注释](http://anypossibility.com/blog/2011/08/postgresql-document-table-and-column-description-comments-on-table-and-column/)

*   [在 Postgres 9.1 中确定表的 OID？](https://stackoverflow.com/questions/10953123)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-03-04T07:30:50.077

如果有人需要，就在这里。

这里有很多答案，但没有一个像我希望的那样简单。因此，基于以前的答案和当前的 postgres 9.4，我创建了这个查询：

```
SELECT 
    obj_description(format('%s.%s',isc.table_schema,isc.table_name)::regclass::oid, 'pg_class') as table_description,
    pg_catalog.col_description(format('%s.%s',isc.table_schema,isc.table_name)::regclass::oid,isc.ordinal_position) as column_description
FROM
    information_schema.columns isc 
```

它获取表和列描述，没有任何令人困惑的连接和丑陋的字符串连接。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-07-06T19:18:53.163

这适用于我使用 PostBooks 3.2.2 DB：

```
select cols.column_name,
(select pg_catalog.obj_description(oid) from pg_catalog.pg_class c where c.relname=cols.table_name) as table_comment
,(select pg_catalog.col_description(oid,cols.ordinal_position::int) from pg_catalog.pg_class c where c.relname=cols.table_name) as column_comment
from information_schema.columns cols
where cols.table_catalog='postbooks' and cols.table_name='apapply' 
```

问候， 西林斯

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2018-04-23T15:39:14.597

对其他答案之一稍作更改，它只会为您提供对其有评论的列，这将为您提供所有列，无论它们是否有评论。

```
select c.table_schema, st.relname as TableName, c.column_name, 
pgd.description
from pg_catalog.pg_statio_all_tables as st
inner join information_schema.columns c
on c.table_schema = st.schemaname
and c.table_name = st.relname
left join pg_catalog.pg_description pgd
on pgd.objoid=st.relid
and pgd.objsubid=c.ordinal_position
where st.relname = 'YourTableName'; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-10-08T10:26:45.313

Enhance for @Nick and @mat suggestions: use
`SELECT obj_description('schemaName.tableName'::regclass, 'pg_class');` when you have string name (not oid).

To avoid to remember 'pg_class' parameter, and to avoid ugly concatenations at the function calls, as `(tname||'.'||schema)::regclass`, an useful overload for `obj_description`:

```
 CREATE FUNCTION obj_description(
      p_rname text, p_schema text DEFAULT NULL, 
      p_catalname text DEFAULT 'pg_class'
  ) RETURNS text AS $f$
     SELECT obj_description((CASE 
        WHEN strpos($1, '.')>0 OR $2 IS NULL OR $2='' THEN $1
        ELSE $2||'.'||$1
     END)::regclass, $3);
  $f$ LANGUAGE SQL IMMUTABLE;
 -- USAGE: obj_description('mytable') 
 --        SELECT obj_description('s.t'); 
 -- PS: obj_description('s.t', 'otherschema') is a syntax error, 
 --     but not generates exception: returns the same as ('s.t') 
```

Now is easy to use, because the *table name* (`rname` parameter) is a varchar and can be expressed with a separated field for *schema name*, as in the main tables and queries.

See also "[Getting list of table comments in PostgreSQL](https://stackoverflow.com/questions/5664094)" or the [new pg9.3 Guide](http://www.postgresql.org/docs/9.3/static/functions-info.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-06-30T09:26:54.933

如果您只需要`comments`在其他数据中显示您的列，您还可以使用：

```
\d+ my_table 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-23T18:13:09.450

这个答案有点晚了，但它出现在我为研究这个问题所做的谷歌搜索中。我们只需要表格描述，但列的方法是相同的。列描述也在 pg_description 表中，由 objoid 引用。

添加此视图：

```
 CREATE OR REPLACE VIEW our_tables AS 
 SELECT c.oid, n.nspname AS schemaname, c.relname AS tablename, d.description,
   pg_get_userbyid(c.relowner) AS tableowner, t.spcname AS "tablespace", 
   c.relhasindex AS hasindexes, c.relhasrules AS hasrules, c.reltriggers > 0 AS hastriggers
   FROM pg_class c
   LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
   LEFT JOIN pg_tablespace t ON t.oid = c.reltablespace
   LEFT JOIN pg_description d ON c.oid = d.objoid
  WHERE c.relkind = 'r'::"char";

ALTER TABLE our_tables OWNER TO postgres;
GRANT SELECT, UPDATE, INSERT, DELETE, REFERENCES, TRIGGER ON TABLE our_tables TO postgres;
GRANT SELECT ON TABLE our_tables TO public; 
```

然后运行：

```
SELECT tablename, description FROM our_tables WHERE schemaname = 'public'
```

该视图是 pg_tables 视图的修改版本，它添加在描述列中。您还可以随意使用视图定义以使其成为单个查询。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-10-23T14:17:10.617

我访问了这样的表格评论：

```
select c.relname table_name, pg_catalog.obj_description(c.oid) as comment from pg_catalog.pg_class c where c.relname = 'table_name'; 
```

因此，专栏评论：

```
SELECT c.column_name, pgd.description FROM pg_catalog.pg_statio_all_tables as st inner join pg_catalog.pg_description pgd on (pgd.objoid=st.relid) inner join information_schema.columns c on (pgd.objsubid=c.ordinal_position and c.table_schema=st.schemaname and c.table_name=st.relname and c.table_name = 'table_name' and c.table_schema = 'public'); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-09-22T13:09:26.800

我刚刚在这里找到了这个。它将为您提供一个特定表上的所有类型的元数据（类型、默认值、非空标志、长度、注释、外键名称、主键名称）。它似乎运作良好。

```
SELECT pg_tables.tablename, pg_attribute.attname AS field, 
    format_type(pg_attribute.atttypid, NULL) AS "type", 
    pg_attribute.atttypmod AS len,
    (SELECT col_description(pg_attribute.attrelid, 
            pg_attribute.attnum)) AS comment, 
    CASE pg_attribute.attnotnull 
        WHEN false THEN 1  ELSE 0  
    END AS "notnull", 
    pg_constraint.conname AS "key", pc2.conname AS ckey, 
    (SELECT pg_attrdef.adsrc FROM pg_attrdef 
        WHERE pg_attrdef.adrelid = pg_class.oid 
        AND pg_attrdef.adnum = pg_attribute.attnum) AS def 
FROM pg_tables, pg_class 
JOIN pg_attribute ON pg_class.oid = pg_attribute.attrelid 
    AND pg_attribute.attnum > 0 
LEFT JOIN pg_constraint ON pg_constraint.contype = 'p'::"char" 
    AND pg_constraint.conrelid = pg_class.oid AND
    (pg_attribute.attnum = ANY (pg_constraint.conkey)) 
LEFT JOIN pg_constraint AS pc2 ON pc2.contype = 'f'::"char" 
    AND pc2.conrelid = pg_class.oid 
    AND (pg_attribute.attnum = ANY (pc2.conkey)) 
WHERE pg_class.relname = pg_tables.tablename  
--    AND pg_tables.tableowner = "current_user"() 
    AND pg_attribute.atttypid <> 0::oid  
    AND tablename='your_table' 
ORDER BY field ASC 
```

来源： http: [//golden13.blogspot.de/2012/08/how-to-get-some-information-about_7.html](http://golden13.blogspot.de/2012/08/how-to-get-some-information-about_7.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-08T21:41:17.097

上个月我问[了一个关于 Postgresql 评论的类似问题。](https://stackoverflow.com/questions/272438/setting-the-comment-of-a-column-to-that-of-another-column-in-postgresql)如果你深入研究，你会在我的博客上看到一些 Perl 代码，它可以自动提取评论的过程。

要提取表的列名，可以使用如下内容：

```
select
     a.attname  as "colname"
    ,a.attrelid as "tableoid"
    ,a.attnum   as "columnoid"
from
    pg_catalog.pg_attribute a
    inner join pg_catalog.pg_class c on a.attrelid = c.oid
where
        c.relname = 'mytable' -- better to use a placeholder
    and a.attnum > 0
    and a.attisdropped is false
    and pg_catalog.pg_table_is_visible(c.oid)
order by a.attnum 
```

然后，您可以使用 tableoid、columnoid 元组来提取每列的注释（请参阅我的问题）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-05T07:45:21.360

好的，所以我解决了这个问题......

选择 col_description（表 id，列号）...

即：选择 col_description(36698,2);

那行得通，但是有没有更简单的方法可以做到这一点，可能会在所有列上添加所有注释并使用表名而不是 oid？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-12-23T13:34:29.547

要显示所有表的所有列的注释：

```
SELECT
    cols.table_name,
    cols.column_name, (
    SELECT
        pg_catalog.col_description(c.oid, cols.ordinal_position::int)
    FROM
        pg_catalog.pg_class c
    WHERE
            c.oid = (SELECT ('"' || cols.table_name || '"')::regclass::oid)
      AND c.relname = cols.table_name
) AS column_comment
FROM
    information_schema.columns cols
WHERE
  cols.table_name   IN (SELECT cols.table_name FROM information_schema.columns)
  AND cols.table_catalog = 'your_database_name'
  AND cols.table_schema = 'your_schema_name'; 
```

您需要在任何架构/目录/数据库之外执行此查询

此查询基于此问题中的另一个答案，该答案仅显示来自一个表的评论

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-11-14T23:29:42.507

扩展@amxy 提供的响应；我发现添加模式过滤器在某些环境中会有所帮助。正如我发现@amxy 的解决方案在我通过模式过滤器添加之前不起作用

```
SELECT 
pg_tables.schemaname,
pg_tables.TABLENAME,
pg_attribute.attname AS field,
format_type(pg_attribute.atttypid, NULL) AS "type",
pg_attribute.atttypmod AS len,
(
SELECT col_description(pg_attribute.attrelid, pg_attribute.attnum)) AS  COMMENT,
CASE pg_attribute.attnotnull
    WHEN FALSE THEN 1
    ELSE 0
END AS "notnull",
pg_constraint.conname AS "key", pc2.conname AS ckey,
(
SELECT pg_attrdef.adsrc
FROM pg_attrdef
WHERE pg_attrdef.adrelid = pg_class.oid
    AND pg_attrdef.adnum = pg_attribute.attnum) AS def
FROM pg_tables, pg_class
JOIN pg_attribute
    ON pg_class.oid = pg_attribute.attrelid
    AND pg_attribute.attnum > 0
LEFT JOIN pg_constraint
    ON pg_constraint.contype = 'p'::"char"
    AND pg_constraint.conrelid = pg_class.oid
    AND
(pg_attribute.attnum = ANY (pg_constraint.conkey))
LEFT JOIN pg_constraint AS pc2
    ON pc2.contype = 'f'::"char"
    AND pc2.conrelid = pg_class.oid
    AND (pg_attribute.attnum = ANY (pc2.conkey))
WHERE pg_class.relname = pg_tables.TABLENAME
AND pg_tables.schemaname IN ('op', 'im', 'cs','usr','li')
-- AND pg_tables.tableowner = "current_user"()
    AND pg_attribute.atttypid <> 0::oid
    ---AND TABLENAME='your_table'
ORDER BY pg_tables.schemaname,
pg_tables.TABLENAME ASC; 
```

**结果：** [![在此处输入图像描述](https://i.stack.imgur.com/tgbYD.png)](https://i.stack.imgur.com/tgbYD.png)

# javascript - getElementById 是否适用于由 javascript 创建的元素？

> ID：343145
> 
> 赞同：5
> 
> 时间：2008-12-05T07:46:01.607
> 
> 标签：javascript, html, dom

我创建了两个函数来在单击链接时在我的博客的存档部分加载一个月的扩展视图：

```
// Load open view of a month in the Archive section
function loadMonth(date) {
  // Remove other open month
     removeMonth();

  // Hide opening month's link
  // Define variable to hold month anchor tag
     var monthLink = document.getElementById(date); 
     monthLink.style.display = "none"; // Hide month anchor

  // Define new open month node and its attributes
     var openMonth = document.createElement("div");
     openMonth.setAttribute("id", "openMonth");
     openMonth.innerHTML = "Testing one, two, three.";

  // Insert open month
  // Define a variable to hold the archive Div node
     var archive = document.getElementById("archive");
  // Insert the open month in the archive node before it's link
     archive.insertBefore(openMonth,monthLink);

     return;
  }

// Close full view of a month and replace with respective link
function removeMonth() {

  // Define global function vars
     var archive = document.getElementById("archive"); // Define a var to hold the archive Div node
     var openMonth = document.getElementById("openMonth"); // Define var to hold the open month Div node

  // Get date of full view month for replacement anchor tag where ID = date
     var month = openMonth.getElementsByTagName("span")[0].innerHTML; // Define var to hold the name of the open month
     var date = (new Date(month + " 15, 2008").getMonth() + 1); // Define var to hold the numerical equivalent of the month
     var year = archive.getElementsByTagName("h3")[0].innerHTML.split(" "); // Define var to hold the year being displayed in the archive
     date = year[1] + "" + date; // Change date var to string and insert year

  // Remove the open month
     archive.removeChild(openMonth);

  // Show Link for that month
     document.getElementById(date).className = "big"; // Fixes display error when anchor has class firstLink
     document.getElementById(date).style.display = "inline"; // Returns link from display "none" state
     return;
} 
```

这些功能在原始静态内容上运行时起作用，但是当在存档中单击第二个链接时，它们什么也不做。我想知道是否可能是因为我的函数创建的元素不能被 document.getElementById 调用。也许应该使用访问这些节点的不同方法，或者也可以用适用于 javascript 创建的元素的东西替换“文档”？

任何建议将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T07:57:45.873

你应该没问题：

```
openMonth.id = "openMonth"; 
```

`getElementById()`仅当元素是 DOM 的一部分时才能工作，但由于您已经使用`insertBefore()`了这只是一个旁注。

这里有一个常见的混淆来源：*名为*“id”的属性不一定是在底层 DTD 中*定义为元素 ID 的属性。*在声明性 HTML 中，它们是自动链接的。当您使用 时`setAttribute()`，您只不过是创建了一个*名为*“id”的属性。元素 ID 本身可通过`.id`属性访问。

*编辑*

以下对我有用：

```
function test()
{
  // create element, set ID
  var p = document.createElement("P");
  p.innerHTML = "Look ma, this is a new paragraph!";
  p.id = "newParagraph";

  // make element part of the DOM
  document.getElementsByTagName("BODY")[0].appendChild(p);

  // get element by ID
  var test = document.getElementById("newParagraph");
  alert(test.innerHTML);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T08:14:03.487

回答您的主要问题：`document.getElementById` **确实**可以使用动态添加的元素。

在您的示例代码中，您正在创建 openMonth div 并设置其 innerHTML。然后在删除标签中你这样做：

```
var month = openMonth.getElementsByTagName("span")[0].innerHTML; 
```

`openMonth.getElementsByTagName("span")`将不存在并且会因为没有 span 元素而出错。我不知道这是代码中的错误还是只是帖子中的不完整示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T09:08:27.293

另一个想法 - 你正在为不同的元素重用'openMonth' id，即使你先删除前一个元素，这也可能是个问题。

您可以尝试使用类而不是 id，或者您可以使用“当前月份元素”保存一个全局变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-30T23:12:54.720

只有在创建元素时为元素指定 id 时它才有效。我记得当我动态创建元素时，我会为 id 设置一个计数器，或者如果从数据库中检索数据，我会使用行 id。

我将使用元素的 innerHTML 字段创建元素并将元素作为文本插入，然后渲染引擎将从那里获取它。这不是最好的方法，但它非常快，我有些匆忙......

希望有帮助

# model-view-controller - MVC（或 MVP）可以与 SOA 共存吗？

> ID：343150
> 
> 赞同：8
> 
> 时间：2008-12-05T07:49:31.787
> 
> 标签：model-view-controller, architecture, mvp, soa

我认为在使用 MVC 或 MVP 设计模式时，业务逻辑应该存在于模型中，但在面向服务的架构中应该隐藏在服务后面。

软件系统可以在面向服务的架构中使用 MVC 或 MVP 设计模式吗？如果是这样，模型坐在哪里？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-05T08:04:36.343

好吧，它们是完全不同的动物。MVC 是关于数据的呈现、控制用户对话框的导航和构建数据模型的一些业务逻辑。

SOA 是关于从服务提供者那里检索数据。

在客户端，您可以在 MVC 模式的模型部分中使用 SOA，以使用来自 SOA 服务的数据构建模型。

在服务端，由于没有演示和用户对话，大多数 MVC 模式变得多余。此外，良好的 SOA 设计应该专注于提供有用的服务，而不管底层数据存储如何，因此“模型”部分在很大程度上是附带的。

的确，许多服务是“有状态的”（例如，订单经过验证、付款、发送然后接收），但这些状态是业务逻辑的一个组成部分，不适合 MVC 模式的典型会话管理.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-17T10:52:34.877

好问题。我认为 MVC 和 SOA 将并且必须共存。MVC 是用户与系统通信最成功的架构。SOA 是一种用于有效系统-系统通信的架构。在大多数组织中，两者都有一席之地。因此，我相信它们会共存。

就它们如何相互交互而言，我个人的看法是——MVC 将保持（一旦 SOA 炒作消失）作为核心架构模式，模型和控制器都在适当的地方公开服务接口。

# c++ - 自动错误报告 - 建议？

> ID：343151
> 
> 赞同：2
> 
> 时间：2008-12-05T07:49:36.563
> 
> 标签：c++, reporting

任何人都可以推荐一个库/SDK/等。是免费的还是购买的，我可以集成到我的 C++ 应用程序中，使应用程序能够执行自动错误报告？我现在正在使用一些东西，但它并没有捕获所有异常。我正在寻找比现在更复杂、更强大的东西。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T08:12:22.477

您没有提及您的平台，但如果是 Windows，您可以查看 Microsoft 的[Windows 错误报告](http://www.microsoft.com/whdc/maintain/StartWER.mspx)。

这是“应用程序 XYZ 已崩溃。您想向 Microsoft 发送错误报告吗？” 东西。如果您注册 WER，您可以访问您的应用程序的错误报告（基本上是转储文件）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T13:05:56.817

如果您的应用程序适用于 Windows，那么[XCrashReport](http://www.codeproject.com/KB/debug/XCrashReportPt4.aspx)可能是一个有趣的解决方案。如果您需要一些调整，它似乎很小、免费、易于集成、配置和修改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T11:04:06.030

您可以使用*SetUnhandledExceptionFilter*和*MiniDumpWriteDump*函数自己进行错误报告。

# asp.net - 客户端通过每个请求通过多个 IP 连接时 ViewState 解码失败

> ID：343153
> 
> 赞同：3
> 
> 时间：2008-12-05T07:55:20.840
> 
> 标签：asp.net, viewstate

我们的网站有一个半奇怪的问题。

一致地，来自 1 个匿名 * 用户会发生以下错误：

> 异常类型：System.FormatException
> 
> 异常消息：Base-64 字符数组的长度无效。

经过一番调查，用户似乎正在使用某种形式的负载平衡防火墙，因为 IIS 日志显示来自 2 个不同（但连续）IP 的请求。

据我所知，禁用“ViewStateMAC”应该可以解决这个问题。

但是我不确定，并且没有任何方式与用户进行测试，我觉得有点不愿意继续这样做。

有没有人遇到过类似的问题？你是怎么对付他们的？

服务器详情：

从单个 IP 运行的单个服务器 (Win2003)。

更新：

据我所知，ViewStateMAC 仅适用于服务器端。我的问题是由于客户发回具有多个 IP 的单个页面。

* 但来自 IIS 日志确定的相同 2 个 IP。用户也没有恶意。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-22T12:46:58.267

嘿 - 我们在应用程序上看到异常数量的这些错误 - 由于客户要求和缺乏对这些错误的指导 - 在每个页面上使用了过多的控件，特别是 GridViews。

明显的罪魁祸首是视图状态的长度，在某些极端情况下是 +50k 个字符长。由于这是一个仅由有限的一组用户使用的管理应用程序，我们最初通过使用这篇出色的（您略过时的）文章中概述的解决方案的改编版本将视图状态移动到会话中完全解决了这个问题：http: [//msdn.microsoft .com/en-us/magazine/cc163577.aspx](http://msdn.microsoft.com/en-us/magazine/cc163577.aspx) 然而，这给我们带来了人们使用后退按钮和/或标签浏览的问题。

接下来，我们添加了一些额外的日志记录代码 - 并确认问题确实正是错误所说的 - base-64 编码的字符串必须具有可被 4 整除的长度 - 当我们得到这个错误时，情况并非如此。假设是某些代理和/或防火墙我们只是在某些时候切断了视图状态字符串。然后，我们使用 ASP.NET 的 ViewStateChunking 将字段拆分为几个隐藏字段 - 我们仍在监视此解决方案。

但是-我最近在具有有效长度的视图状态字段上遇到错误-但是 __EVENTVALIDATION 字段长度对此无效。

在发生这种情况的页面上，我们的字段中有“+”号（电话代码） - 我目前正在调查这一切是否可能是由原始字符串的无效编码引起的（因为 + 号在 base 中具有特殊含义-64 结束字符串）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T11:07:24.587

禁用 viewstatemac 并不能解决问题；ViewStateMac 故障发生在您有多个 Web 服务器时，**而不是**当用户来自多个 IP 地址时。

您是否有机会使用 viewstateuserkey？即使那样，这也是一个很长的机会，因为你会得到一个不同的例外。

我很想，如果用户可以在一致的基础上重新创建它，让他们安装 fiddler 并记录请求，直到它发生，然后让他们将它们发送给你。然后从您身边重播它们，看看是否发生错误。

他们不是在 Mac 上使用 IE 吗？由于表单字段长度中的错误，这会破坏长视图状态。

# delphi - 在 Delphi 2009 中将整数值转换为 AnsiString

> ID：343164
> 
> 赞同：3
> 
> 时间：2008-12-05T08:02:11.340
> 
> 标签：delphi, delphi-2009, integer, ansistring

`IntToStr()`函数返回现在是 Unicode 的字符串。我想转换为`AnsiString`. 我可以`AnsiString(IntToStr(I))`安全使用吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T08:05:12.460

当然。或者您可以使用`IntToAnsiString`（由[Bob 博士](http://www.bobswart.nl/Weblog/Blog.aspx?RootId=5:2984 "Unicode 技巧 #8 - AnsiString 的整数和浮点数")编写）：

```
function IntToAnsiStr(X: Integer; Width: Integer = 0): AnsiString;
begin
   Str(X: Width, Result);
end; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T15:06:28.440

是的，您可以安全地将`UnicodeString`返回的 by转换`IntToStr`为`AnsiString`. 它安全的原因是它返回的字符串将只包含`'0'`通过的数字字符`'9'`，而不是任何花哨的 Unicode 数字，因此转换为`AnsiString`不会丢失任何信息。

# c# - 如何将 .cs 文件转换为 PowerShell cmdlet？

> ID：343182
> 
> 赞同：7
> 
> 时间：2008-12-05T08:15:57.633
> 
> 标签：c#, powershell, cmdlet

谁能帮我将 C# .NET 程序转换为 PowerShell cmdlet？我对这个领域很陌生。请帮助我离开这个检查站！

问候，

阿伦

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-05T08:30:24.263

添加对*System.Management.Automation*的引用，创建一个继承自*Cmdlet*的类并覆盖*ProcessRecord*方法：

```
[Cmdlet(VerbsCommon.Get, "Double")]
public class GetDouble : Cmdlet
{
    [Parameter]
    public int SomeInput { get; set; }

    protected override void ProcessRecord()
    {
        WriteObject(SomeInput * 2);
    }
} 
```

添加安装程序：

```
[RunInstaller(true)]
public class MySnapin : PSSnapIn
{
    public override string Name { get { return "MyCommandlets"; } }
    public override string Vendor { get { return "MyCompany"; } }
    public override string Description { get { return "Does unnecessary aritmetic."; } }
} 
```

安装您的命令行开关程序集：

```
Installutil /i myassembly.dll 
```

并添加：

```
Add-PsSnapin MyCommandlets 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-11T17:07:18.003

There's an add-on for Reflector to do that. Here's a good article with the example: [http://msmvps.com/blogs/paulomorgado/archive/2009/09/18/powershell-for-the-net-developer.aspx](http://msmvps.com/blogs/paulomorgado/archive/2009/09/18/powershell-for-the-net-developer.aspx)*

> .NET Reflector has [an array of add-ons on CodePlex](http://reflectoraddins.codeplex.com/releases/view/1805), and one of these is [the PowerShell add-on](http://reflectoraddins.codeplex.com/wikipage?title=PowerShellLanguage&ProjectName=reflectoraddins) that allows you to disassemble code directly into PowerShell.
> 
> In this example, I am opening the method ChangeAccountPassword from the SPUtility library in SharePoint:
> 
> [![image](https://i.stack.imgur.com/mrFBK.png)](https://i.stack.imgur.com/mrFBK.png)
> 
> I can now change targets from C# to PowerShell.
> 
> [![image](https://i.stack.imgur.com/kj1mw.png)](https://i.stack.imgur.com/kj1mw.png)
> 
> When you need to convert helper methods from C# to PowerShell or if you’re new to PowerShell syntax, this tool is really helpful!

[*] The link is dead as of 10/12/2015.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-12T08:03:16.030

首先，您应该使用 PowerShell 模板将 .cs 文件转换为 DLL。然后通过使用`pssnapin`，`getproc`您可以将其转换为 DLL。

# project-planning - 用户故事的时间估计

> ID：343187
> 
> 赞同：5
> 
> 时间：2008-12-05T08:20:58.060
> 
> 标签：project-planning, estimation, user-stories

您如何估计实施用户故事所需的时间？如果这是您在知道需要多长时间之前就已经完成的事情。但是，如果它对您来说是全新的呢？你为“惊喜”预留了多少时间？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T08:33:06.490

一个很好的技术是将故事分解为更小的任务，并估计它们之间的*比较*（而不是绝对）。所以你可以说：

*   任务 A 将占用 2 个单元（任意）
*   任务 B 大约是任务 A 的 2 倍（4 个单元）
*   任务 C 大约有一半复杂（1 个单元）

我们更擅长估计相对复杂性而不是绝对复杂性。然后您实际执行其中一项任务，并计算出执行 1 个单元需要多少“实时”时间 - 现在您可以计算所有任务。你会根据你的进展情况不断更新你的估计。

这项技术来自Mike Cohn的[敏捷估计和规划，这是一本关于该主题的好书。](https://rads.stackoverflow.com/amzn/click/com/0131479415)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T08:27:16.593

在敏捷开发的 XP 学派中，他们主张不要以实际时间而是以任意单位进行估算。（他们使用“Gummy Bears”，但你可以使用任何东西）。您对实现该用户故事所需的单元数量进行最佳猜测。

诚然，您可能错了，但您将进入开发阶段，进行几次迭代，此时您的猜测大部分是正确的，并且业务/客户很容易获得他们可以包含多少故事的准确预算在一次迭代中。

在难以估计的早期，一个好的经验法则是采取最简单的任务之一，并将其​​分配为 1。评估与该用户故事相关的每个其他用户故事，并给出最佳猜测。如果某件事太复杂，或者定义不够明确，你将不得不给它一个非常大的数字。

另一个关键概念是您必须在每次迭代时重新评估每个用户故事的时间。随着您的故事得到更好的定义，并且随着您对速度的估计提高，您将获得更准确的故事时间。

至于惊喜，它并不真正影响用户故事的估计......因为你没有用户故事来代表惊喜。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T12:45:13.220

史蒂夫·麦康奈尔在“[软件评估 - 揭开魔法的神秘面纱](http://www.stevemcconnell.com/est-toc.htm)”中说得比我好：

> “尽可能数数。当你不能数数时计算。仅将判断作为最后的手段。”

[第 7 章 - 计数、计算、判断](http://www.stevemcconnell.com/Estimation-07.pdf)(PDF)。

（感谢您提醒我这一点：）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T09:02:55.790

在我工作的地方实施的一种技术。对于每个用户故事，把它写在一张带标题的卡片上。让每个人拿一张卡片，并在上面写下他们认为完成所需的小时数。让他们把卡片放在任务上，而不是互相展示。获得所有结果后，查看数字并查看顶部和底部值。通常您会得到非常接近的数字。

对于那些远高于或远低于平均水平的值，请询问开发人员或输入人员为什么他们认为与平均水平相比需要这么长或这么短的时间。从团队而不是个人提出共识意味着每个人都能接受任务。

这是我读过的一本关于敏捷技术的书中的一个想法，忘记了作者将其归功于他们。

# asp.net - 如果自动完成功能打开，为什么 javascript onchange 事件不会触发？

> ID：343192
> 
> 赞同：28
> 
> 时间：2008-12-05T08:25:36.257
> 
> 标签：asp.net, javascript

我有一个带有 onchange 事件的文本框。当用户使用自动完成功能填充文本框时，为什么不会触发此事件？

我正在使用 Internet Explorer。是否有解决此问题的标准且相对简单的解决方案，而无需禁用自动完成功能？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-05T08:41:36.800

上次我遇到这个问题时，我最终改用了`onpropertychange`Internet Explorer 的事件。[我在 MSDN 上](http://msdn.microsoft.com/en-us/library/ms533032(VS.85).aspx)读到了这一点：这是绕过它的推荐方法。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-05T08:42:45.347

我之前也遇到过这个烦人的功能，当时我的解决方案是使用onfocus事件记录文本框的当前值，然后使用onblur事件检查当前值现在是否与onfocus期间保存的值匹配。例如

```
<input type="text" name="txtTest" value="" onfocus="this.originalvalue=this.value" onblur="if (this.value != this.originalvalue) alert('Test has changed')"/> 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-11-23T21:57:27.573

基于 Tim C 的回答，这是我想出的简单 jquery，用于处理页面上的所有文本框：

```
$("input[type=text]").bind("focus change",function(){
    this.previousvalue = this.value;
}).blur(function(){
    if (this.previousvalue != this.value){
        $(this).change();
    }
}) 
```

如果您不关心 onchange 多次触发，则可以使其更简单：

```
$("input[type=text]").blur(function(){
    $(this).change();
}) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-03-08T16:10:01.637

我刚刚发现[使用 jQuery 1.4 设置更改事件](http://blog.darkthread.net/blogs/darkthreadtw/archive/2010/03/09/jquery1-4-fix-autocomplete-onchange-issue.aspx)可以解决这个问题。如果您已经熟悉 jQuery，这似乎是解决此问题的最简单方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-12-10T13:03:57.633

我只是为需要触发文本更改事件的文本框关闭自动完成功能

```
'Turn off Auto complete 
'(it needs to fire the text change event)
 txtYourTextBox.Attributes.Add("AutoComplete", "off") 
```

只需将其放在页面加载中即可。

或者，您可以将属性添加到`input`元素或整个标记上`form`：

```
<input type=text autocomplete=off> 
```

或者

```
<form autocomplete=off> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-04-18T20:40:36.627

我发现以下 jQuery (v1.10+) JavaScript 在 HTML 文本输入字段自动完成文本的情况下确实有效。这至少在 Mac OS X 10.8.5 上的 Safari 6.1.1 中经过测试可以可靠地工作，但也应该在其他兼容的浏览器中工作：

```
$("input:text[id=text_field_id]").bind("focus change keyup blur", function(event) {
// handle text change here...
}); 
```

似乎添加`blur`事件处理程序是完成这项工作的关键，尽管其他事件处理程序有助于确保在文本更改时调用事件处理程序，无论是由于浏览器自动完成功能的编辑还是新输入.

只需将`"input:text[id=text_field_id]"`上面的代码替换为您想要的文本输入字段的相关选择器，或者如果使用`id`属性来引用您的字段，请替换`text_field_id`为您的文本字段的`id`属性值。

# windows - 从 Windows .lnk（快捷方式）文件中提取图标

> ID：343200
> 
> 赞同：8
> 
> 时间：2008-12-05T08:31:16.370
> 
> 标签：windows, icons, shortcut

我需要从 Windows 快捷方式 (.lnk) 文件中提取图标（或找到图标文件，如果它只是由快捷方式指向的话）。

我不是要从 exe、dll 等中提取图标。有问题的快捷方式是在我运行安装程序时创建的。并且快捷方式显示的图标不包含在快捷方式指向的.exe中。大概图标嵌入在 .lnk 文件中，或者 .lnk 文件包含指向该图标所在位置的指针。但是我找到的实用程序都没有解决这个问题——它们都只是转到.exe。

非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-11-26T23:31:37.717

使用 Shell32 方法访问链接：

```
String lnkPath = @"C:\Users\PriceR\Desktop\Microsoft Word 2010.lnk";
//--- run microsoft word
var shl = new Shell32.Shell();         // Move this to class scope
lnkPath = System.IO.Path.GetFullPath(lnkPath);
var dir = shl.NameSpace(System.IO.Path.GetDirectoryName(lnkPath));
var itm = dir.Items().Item(System.IO.Path.GetFileName(lnkPath));
var lnk = (Shell32.ShellLinkObject)itm.GetLink;
//lnk.GetIconLocation(out strIcon);
String strIcon;
lnk.GetIconLocation(out strIcon);
Icon awIcon = Icon.ExtractAssociatedIcon(strIcon);
this.button1.Text = "";
this.button1.Image = awIcon.ToBitmap(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-05T08:36:18.013

[该线程提供了有关.lnk 文件中包含](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1407242&SiteID=1)的数据的有趣信息

sSHGetFileInfoss[函数](http://www.codeproject.com/KB/shell/systemiconsimagelist.aspx?display=PrintAll)应该能够提取图标文件。

记录[在这里](http://msdn.microsoft.com/en-us/library/bb762179.aspx)，并用于 lnk 文件：

```
Path2Link := 'C:\Stuff\TBear S Saver.lnk';
SHGetFileInfo(PChar(Path2Link), 0, ShInfo1, SizeOf(TSHFILEINFO),
          SHGFI_ICON);
// this ShInfo1.hIcon will have the Icon Handle for the Link Icon with
// the small ShortCut arrow added} 
```

从第一个链接，您可以在 c# 中构建这样的实用程序，您可以在其中声明此函数，如下所示：

```
[DllImport("shell32.dll")]
public static extern IntPtr SHGetFileInfo(
   string pszPath, uint dwFileAttributes, ref SHFILEINFO psfi, 
   uint cbSizeFileInfo, uint uFlags); 
```

* * *

[您还可以使用autoit 脚本语言](http://www.autoitscript.com/forum/index.php?s=36edb56d0daa23b6cf8c4f3ec49dcb84&showtopic=70788)构建一个实用程序，您可以在其中使用声明如下的函数：

```
Func _ShellGetAssocIcon(Const $szFile,Const $IconFlags = 0)
    Local $tFileInfo = DllStructCreate($tagSHFILEINFO)
    If @error Then
        Return SetError(1,@extended,0)
    EndIf

    Local $Ret = DllCall("shell32.dll","int","SHGetFileInfo","str",$szFile,"dword",0, _
        "ptr",DllStructGetPtr($tFileInfo),"uint",DllStructGetSize($tFileInfo),"uint",BitOr($SHGFI_ICON,$IconFlags))
    MsgBox(0,0,@error)
    Return DllStructGetData($tFileInfo,"hIcon")
EndFunc 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-26T11:43:04.153

2010 年微软终于发布了 LNK 文件格式的官方[规范](http://msdn.microsoft.com/en-us/library/dd871305.aspx)。当然，它比网上漂浮的逆向工程规范要准确和详细得多。

为了完整起见，[这里](http://msdn.microsoft.com/en-us/library/bb776891%28v=vs.85%29.aspx)是 MSDN 对 shell 链接和快捷方式的描述。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T09:13:20.293

也可以自己解析 .lnk 文件，有关快捷文件格式的详细信息，请参见此[pdf](http://www.i2s-lab.com/Papers/The_Windows_Shortcut_File_Format.pdf)或[本文](http://www.stdlib.com/art6-Shortcut-File-Format-lnk.html)。

[或者你可以使用这个问题](https://stackoverflow.com/questions/234231/how-do-you-create-an-application-shortcut-lnk-file-in-c-or-net#234543)的答案中提到的 ShellLink 类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-01-04T01:51:57.177

我使用它来获取**没有**在其上添加快捷箭头迷你图标作为图像的图标：

`using IWshRuntimeLibrary;`

```
Image ShortcutIcon = System.Drawing.Icon.ExtractAssociatedIcon(((IWshShortcut)new WshShell().CreateShortcut(File)).TargetPath).ToBitmap(); 
```

如果您希望将其作为图标获取：

```
Icon ShortcutIcon = System.Drawing.Icon.ExtractAssociatedIcon(((IWshShortcut)new WshShell().CreateShortcut(File)).TargetPath); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-14T10:59:39.520

要为此添加更多资源，因为大概您不需要应用程序的图标而不是左下角有快捷方式的图标：

*   [下面介绍如何使用 WinApi 的 IShellLink 解析 LNK 格式](http://www.msjogren.net/dotnet/eng/samples/dotnet_shelllink.asp)
*   [IShellLink 定义](http://www.pinvoke.net/default.aspx/Interfaces/IShellLinkA.html)
*   [LNK 格式，如果您不想使用 IShellLink 解析它](http://www.stdlib.com/art6-Shortcut-File-Format-lnk.html)

# sharepoint - 如何加快 Virtual PC 中的共享点开发？

> ID：343201
> 
> 赞同：1
> 
> 时间：2008-12-05T08:32:17.130
> 
> 标签：sharepoint, virtual-pc

我正在 Virtual PC 中开发 sharepoint (MOSS) 项目。不幸的是，虚拟 PC 只能使用我的四核机器的一个核心。是否有任何提示和技巧可以加快我的开发过程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T11:06:04.637

我们在迁移到 Hyper-V 之前曾经做过的事情......

不要为 VPC 分配过多的 RAM，它会开始过多地使用分页文件。

确保 VPC 的虚拟硬盘驱动器和虚拟内存文件已从您的防病毒程序中排除。

对 VPC 进行碎片整理，然后对主机进行碎片整理。

不要将页面文件与 VPC 放在同一个驱动器上。

修复页面文件的大小，使其不会碎片化。

杀死您的主要主机上的所有后台进程，您不必为您的工作而运行......并为此调整 Windows 以获得最佳性能而不是最佳外观。

运行Virtual Server而不是Virtual PC，并使用远程桌面访问VPC（我发现VS在管理机器方面更好一些，远程桌面似乎更快，并且可以在第二台显示器上获得良好的全屏体验）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T10:36:44.523

我在外部 harrdrive 上运行 sharepoint。VPC 分配了 2.5 GB RAM。它运行得非常快（不是真正快速照明，但可行）。

所以我的建议是为 VPC 分配尽可能多的内存，并在外部 HDD 上运行。如果可以的话，用火线连接你的硬盘，与 USB 相比，它有很大的不同。

除了对您的主机和虚拟机进行碎片整理之外可以提供帮助（但可能需要很长时间）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T11:22:08.257

运行别的东西。虚拟PC是垃圾。在 HyperV、VMWare 和 Virtualbox 之间，有更好的选择。

就个人而言，我使用 VMWare 服务器。我尝试过 HyperV，但性能没有达到我对 Microsoft 的期望。VMWare 在 3 个平台上可用的事实意味着我可以在 Macbook 上启动我的项目，将其传输到 Linux 服务器，或在另一个 Windows 机器上打开它。

我可以选择 1,2 或 4 个核心。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T17:30:03.690

检查 Scott Hanselman 的[虚拟机性能检查器](http://www.hanselman.com/blog/VMPerformanceChecklistBeforeYouComplainThatYourVirtualMachineIsSlow.aspx)。这是关于如何提高虚拟机性能的一般文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T09:03:44.587

您是否在 BIOS 和 VPC 设置中都激活了硬件虚拟化扩展？
你给你的虚拟机足够的内存了吗（我通常设置在 2GB 左右）。

你也可以切换到Win2008 + HyperV，功能更强大。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-08T10:39:13.677

使用 SSD 驱动器而不是 HDD。性能显着提高，特别是在发生磁盘交换的内存压力情况下。

还要检查 .NET Framework[是否没有检查 Certificate Revocation List](http://www.muhimbi.com/blog/2009/04/new-approach-to-solve-sharepoints.html)。如果存在网络连接问题，那么您将获得超时。

# fluent-nhibernate - 如何构建流畅的 NHibernate？

> ID：343203
> 
> 赞同：1
> 
> 时间：2008-12-05T08:33:55.177
> 
> 标签：fluent-nhibernate

我想看看 Fluent NHibernate 但不幸的是我找不到任何关于如何从源代码构建它的信息。也许有人可以帮助我？我需要什么工具来构建它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T10:06:42.707

Build.bat 文件只包含一个命令，即“rake”，即[Ruby Make](http://rake.rubyforge.org/)。这会在当前文件夹中运行 rake，使用文件“rakefile”来构建项目。

因此，您需要 rake 才能使用 bat 文件进行构建。如果您使用的是 Windows，则可以使用[适用于 Windows 的 Ruby 安装程序](http://rubyinstaller.org/downloads/)来安装 Ruby ，其中包括 rake。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T08:49:31.510

我已经使用 VS 构建了它，所以问题是“我需要哪些工具来使用 Build.bat 文件构建它”

# python - 关于 3.0 的“hashlib”模块的问题

> ID：343204
> 
> 赞同：2
> 
> 时间：2008-12-05T08:35:13.990
> 
> 标签：python, python-3.x, python-2to3

当我遇到困难时，我一直在努力将 2.5 模块移植到 3.0，主要是为了我自己的教育。“Builder”类作为它的初始化：

```
def __init__(self, **options):
    self._verifyOptions(options)
    self._options = options
    self._initDigest()
    self._initBuildNames()
    self._methods = [] 
```

但是错误发生在：

```
def _initDigest(self):
    import os, sys, hashlib
    digester = hashlib.md5()
    digester.update(self._options.get('code'))
    self._digest = digester.hexdigest() 
```

它的回溯是：

```
Traceback (most recent call last):
  File "<pyshell#5>", line 5, in <module>
    """, language="Cee")
  File "C:\Python30\lib\site-packages\PyInline\__init__.py", line 31, in build
    b = m.Builder(**args)
  File "C:\Python30\lib\site-packages\PyInline\Cee.py", line 17, in __init__
    self._initDigest()
  File "C:\Python30\lib\site-packages\PyInline\Cee.py", line 27, in _initDigest
    digester.update(self._options.get('code'))
TypeError: object supporting the buffer API required 
```

我已经通过 2to3 运行它，但它没有接受它。据我所知，更新函数期望参数采用字节/缓冲区的形式，但我尝试了几种不同的方法来转换它，但都没有成功。

与往常一样，我们将不胜感激任何帮助。:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T09:16:24.407

我猜这条线：

```
digester.update(self._options.get('code')) 
```

应该变成：

```
digester.update(self._options.get('code').encode("utf-8")) 
```

在您的情况下，实际所需的编码可能会有所不同，但 UTF-8 将适用于所有情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T08:47:02.063

我还没试过3.0。但是现在字节序列和字符串之间有更大的区别。后者保存 unicode 代码点，而前者不保存 unicode，而只保存`encoded`unicode 字符串。哈希对字节序列进行操作。因此，您必须首先对您的（unicode）字符串进行编码，然后才能将它们提供给散列。

# javascript - JavaScript UI 小部件的框架？

> ID：343209
> 
> 赞同：6
> 
> 时间：2008-12-05T08:36:29.900
> 
> 标签：javascript

我正在尝试将 JavaScript UI 小部件框架列表放在一个项目中以供考虑。理想情况下，它应该是一个库，其中包含一系列现成的 ui 小部件，不依赖于 dom/js 扩展/操作框架，如 JQuery 或 Prototype，最少的附加内容，如 Ajax API 和 DOM 选择器等。

这是我到目前为止所拥有的：

*   qooxdoo,
*   脚本客户端
*   ExtJs

有人能推荐其他值得一看的吗？

请不要建议，JQuery、Prototype、Mootools、Dojo 等，它们的主要重点不是提供 ui 小部件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T09:30:25.673

在这里回答：[您选择的跨浏览器 javascript GUI](https://stackoverflow.com/questions/218699/your-choice-of-cross-browser-javascript-gui)和这里：[ExtJS 的替代品是什么？](https://stackoverflow.com/questions/200284/what-are-alternatives-to-extjs)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T08:39:39.033

YUI（雅虎用户界面）有一组不错的 ui 小部件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T09:14:35.203

[AJAX 和 JavaScript 解决方案](http://www.smashingmagazine.com/2008/04/15/60-more-ajax-and-javascript-solutions-for-professional-coding/)的列表并不少。我知道，它不是某个库，但也许你会发现一些有用的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T09:23:42.533

这篇[wiki 文章](http://en.wikipedia.org/wiki/Comparison_of_JavaScript_frameworks) 很好地比较了不同的 java 脚本框架的工作原理。这种比较基于不同的参数。它提供了对框架不同方面的深入了解。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T15:20:19.130

Active Widgets ( [http://www.activewidgets.com](http://www.activewidgets.com) ) - 非常好的控件，类似于 Win32 中常见的控件，并且在 IE 和 Firefox 中运行良好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T09:10:44.527

我对 Dojo 的看法是，它实际上*非常注重*提供 UI 小部件，但无论如何我都不会推荐它。

我认为您会为自己的局限性而苦苦挣扎：除了最琐碎的示例之外，每个类似小部件的框架都依赖于一些基本的 JS 框架来完成繁重的工作——这是一件好事。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-01T16:43:22.180

[Rialto](http://rialto.improve-technologies.com) (Rich Internet Application Toolkit) 是基于 ajax 的跨浏览器 javascript 小部件库。因为它与技术无关，所以它可以封装在 JSP、JSF、.Net、Python 或 PHP 图形组件中。Rialto 的目的是让企业开发人员更容易获得丰富的互联网应用程序开发。理想情况下，Rialto 开发人员不需要编写或理解 DHTML、Ajax 或 DOM 代码。

Rialto 的目标是企业网络应用程序，而不是互联网网站。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-04-11T00:31:44.060

Sproutcore 有一套不错的：[http ://www.sproutcore.com/](http://www.sproutcore.com/)

# python - CGAL 的 python 绑定发生了什么？

> ID：343210
> 
> 赞同：9
> 
> 时间：2008-12-05T08:36:49.993
> 
> 标签：python, geometry, polygon, computational-geometry, cgal

我在搜索将凹多边形分解为最少数量的凸组件的算法时找到了[计算几何算法库。](http://www.cgal.org/)网站外的链接和大量的谷歌结果表明它有 python 绑定，这真的很方便，但是所有的链接都死了！这是怎么回事？我现在在哪里可以得到它？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-10-26T06:32:58.573

作为 cgal-bindings 项目的一部分，已经完成了对 CGAL-Python 绑定的重写。看看：[http ://code.google.com/p/cgal-bindings/](http://code.google.com/p/cgal-bindings/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T11:19:22.987

[CGAL-Python](http://cgal-python.gforge.inria.fr/)已经惰性了一年多了，但代码（可通过“下载”链接获得）似乎工作正常，虽然不是 Python 3。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T04:28:24.223

您可能还对 GEOS 库感兴趣，该库在 Python 中通过[Shapely](https://github.com/Toblerity/Shapely)和[GeoDjango 中包含的 GEOS API 可用](http://geodjango.org/docs/geos.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T08:47:23.730

最快的可能只是查看代码并自己在 python 中重新实现它。仅仅为了这一点就携带所有 CGAL 似乎是多余的。
此外，这个计算并没有让我觉得通过运行编译会非常受益。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-30T23:19:30.930

CGAL 的绑定本质上是困难的。因为该库是大量基于模板的，所以使用它的可能方式的组合爆炸式增长。任何绑定都需要挑选并选择要包含的内容。

但是：Python 包 demakein（我编写的）包含一个模块，用于即时编译 C++ 片段，然后使用 cffi 加载它们。代码片段被缓存以使后续运行更快。那里有包含我需要的 CGAL 部分的代码，这些可能与您需要的不同，但应该让您了解如何使用它。它可以在 Linux 或 OS X 上与 CPython 或 PyPy 一起使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-09-01T01:09:36.833

现在试试这个：

```
pip install -i https://test.pypi.org/simple/ cgal 
```

它是实验性的，但可在[此处获得](https://test.pypi.org/project/cgal/)

# entity-framework - 实体框架设计器中的空白字符串默认值

> ID：343211
> 
> 赞同：11
> 
> 时间：2008-12-05T08:38:17.180
> 
> 标签：entity-framework

是否可以在实体框架的 EDMX 设计器中指定一个空白字符串（即“”）作为默认值？我发现的唯一技术是使用文本编辑器手动编辑 edmx 文件

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-03-23T02:30:12.547

我意识到这是一个非常古老的问题，但为了后代的缘故，在 EF4 设计器中，您可以在属性窗口字段中键入一个空格，然后按退格键，将该字段留空而不是默认值（无）。对于字符串，这似乎默认为 String.Empty。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-14T23:50:28.087

我所做的是在我设置的部分类中创建一个默认构造函数

```
_privateFieldName = string.Empty; 
```

部分类显然会在不同的文件中，并且不会被设计者重新生成。此方法的唯一缺点是现在对设计器中默认值的任何更改都将不适用

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T06:20:58.710

是的，我发现将空字符串设置为默认值的唯一方法是编辑 EDMX。重新生成代码时，无法编辑设计器文件。

这确实是实体框架中需要解决的错误。

编辑：实际上，在 XML 中设置一个空字符串非常痛苦，因此在创建新实体时在应用程序中将值设置为 string.Empty 可能更容易。

# c++ - 是否可以在 C++ 类中使用信号？

> ID：343219
> 
> 赞同：37
> 
> 时间：2008-12-05T08:42:56.440
> 
> 标签：c++, signal-handling

我正在做这样的事情：

```
#include <signal.h>

class myClass {
public: 
    void myFunction () 
    {
        signal(SIGIO,myHandler);
    }

    void myHandler (int signum)
    {
        /**
        * Handling code
        */
    }

} 
```

我正在使用 gcc 在 Ubuntu 上工作。

但它不会编译。它抱怨：

> 错误：与类型的参数`void (MyClass::)(int)`不同意`void (*) (int)`

有什么线索吗？或者也许只是我不能在类中使用信号？信号只允许在 C 中使用吗？

错误消息是近似翻译，因为我的编译器不是英文的。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-05T16:56:20.950

signal 的第二个参数应该是一个指向接受 int 并返回 void 的函数的指针。您传递给信号的是一个指向接受 int 并返回 void （其类型为）的*成员*`void (myClass::*)(int)`函数的指针。我可以看到克服这个问题的三种可能性：

1 - 你的方法`myHandler`可以是静态的：这很棒，让它成为静态的

```
class myClass 
{
  public:
    void myFunction () 
    {
        signal(SIGIO, myClass::myHandler);
    }

    static void myHandler (int signum)
    {
        // handling code
    }
}; 
```

2 - 您的方法不应该是静态的：如果您打算仅对一个实例使用信号，您可以创建一个私有静态对象，并编写一个静态方法，只需在该对象上调用该方法。类似的东西

```
class myClass 
{
  public:
    void myFunction () 
    {
        signal(SIGIO, myClass::static_myHandler);
    }

    void myHandler (int signum)
    {
        // handling code
    }

    static void static_myHandler(int signum)
    {
        instance.myHandler(signum);
    }

  private:
    static myClass instance;
}; 
```

3 - 但是，如果您计划在多个实例中使用信号，事情会变得更加复杂。也许一个解决方案是将您想要操作的每个实例存储在一个静态向量中，并在每个实例上调用该方法：

```
class myClass
{
  public:
    void myFunction () // registers a handler
    {
        instances.push_back(this);
    }

    void myHandler (int signum)
    {
        // handling code
    }

    static void callHandlers (int signum) // calls the handlers
    {
        std::for_each(instances.begin(), 
                      instances.end(), 
                      std::bind2nd(std::mem_fun(&myClass::myHandler), signum));
    }
  private:
    static std::vector<myClass *> instances;
}; 
```

在某个地方，打一个电话

```
signal(SIGIO, myClass::callHandlers); 
```

但我认为，如果您最终使用最后一个解决方案，您可能应该考虑改变您的处理设计:-)！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-05T09:01:32.470

要传递指向方法的指针，它必须是静态方法并且您必须指定类名。

试试这个：

```
class myClass {
  void myFunction () 
  {
    signal(SIGIO, myClass::myHandler);
  }

  static void myHandler (int signum)
  {
     // blabla
  }
}; 
```

您还应该阅读 Baget 提供的链接，[即 C++ FAQ 中的第 33.2 段](http://www.parashift.com/c++-faq-lite/pointers-to-members.html#faq-33.2)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-31T19:55:23.260

实际上，C++ 信号处理程序不允许使用 C 和 C++ 中不存在的任何工具（除了在 C++11 中它们可能使用原子），并且必须使用 C 链接。引用[C++11 草案 n3242](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/n3242.pdf)第 18.10 节“其他运行时支持”[support.runtime]（第 8 段），

> C 和 C++ 语言的公共子集包括所有可能出现在格式良好的 C++ 程序和符合标准的 C 程序中的声明、定义和表达式。POF（“plain old function”）是仅使用来自该公共子集的特征的函数，并且不直接或间接使用任何不是 POF 的函数，除非它可以使用第 29 条中定义的非 POF 函数。成员函数。所有信号处理程序都应具有 C 链接。可用作符合 C 程序中的信号处理程序的 POF 在用作 C++ 程序中的信号处理程序时不会产生未定义的行为。在 C++ 程序中用作信号处理程序的任何其他函数的行为是实现定义的。

（第 29 条是关于原子的。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-09-24T09:13:12.343

```
#include <signal.h>

class myClass {

 private:
  static myClass* me;

 public:
  myClass(){ me=this; }

  void myFunction (){
    signal(SIGIO,myClass::myHandler);
  }

  void my_method(){ }

  static void myHandler (int signum){
    me->my_method();
 }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-04-04T08:42:18.077

您可以发布声誉低于评论现有答案所需的新答案，这似乎很疯狂，但我们开始了。

gekomad 2015 年 9 月 24 日的回答是我用来解决问题的答案。值得指出的是，只有当只有一个`myClass`created 实例时，这才会完全明显地起作用。否则，静态对象指针将指向可能不是所需的实例之一（最近创建的）。

而且，如果它对其他人有用，几个答案中链接的常见问题解答问题的有效 2018 URL 是：

[http://www.cs.technion.ac.il/users/yechiel/c++-faq/memfnptr-vs-fnptr.html](http://www.cs.technion.ac.il/users/yechiel/c++-faq/memfnptr-vs-fnptr.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-05-21T18:26:27.907

您可以使用单例模式

```
 static MyClass &getInstance() {
    static MyClass instance;
    return instance; 
```

# sql - 如何从数据库文本字段中删除 html 标签

> ID：343220
> 
> 赞同：2
> 
> 时间：2008-12-05T08:43:31.897
> 
> 标签：sql, sql-server, sql-server-2005

如何从 SQL Server 中删除文本字段中的 html 元素？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T08:54:03.110

我假设您的意思是从存储在数据库中的字段中删除 html 标记。如果是这样，并且如果您可以在 .NET 中编写解决方案，我将使用[HTML 敏捷包](http://www.codeplex.com/htmlagilitypack)来遍历 html 内容，并保存您感兴趣的元素的 InnerText（我认为这是属性名称）多变的。然后用变量的内容替换字段的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T08:57:40.107

您可以使用 CLR 过程（SQL Server 2005 及更高版本）来解码 HTML，去除标签。

这看起来像是您想要实现的目标的示例。

[SQL Server CLR 过程](http://www.sqlclr.net/Examples/tabid/55/articleType/ArticleView/articleId/31/Default.aspx)

# sql-server - MS-SQL Server 2005：复制后的非收敛数据

> ID：343224
> 
> 赞同：1
> 
> 时间：2008-12-05T08:44:57.247
> 
> 标签：sql-server, replication

我们有一个合并复制拓扑，包括一个发布者、多个发布和多个订阅。它已经运行了至少 8 个月，没有出现任何问题。

几天前我被告知我的采购订单代码被无故“更改”，从标准的“ZWWTP/PO-0092”样式变为新的“ZWWT”样式：采购订单代码中的字符 5 到 8 更改为在某些服务器上，另一个字符串是 chr(0) & chr(1) & chr(0) & chr(1)

我到了这样的地步，似乎只有我的一个复制/订阅过程正在生成这样的虚拟数据：发布者和这个特定订阅者上的 PO 代码与最近更新或添加的记录不再匹配。在订阅者端创建的 PO 的代码在上传到发布者时将被更改（在订阅者端保持干净）。从发布者下载的 PO 将在订阅者上使用更改后的 PO 代码进行传播。

然后，我能够使用一些表比较实用程序 + 一些 UPDATE 语句来清理/调整两台服务器上的数据，但是现在每次在两台服务器之间运行复制时都会出现完全相同的差异：两台服务器上的干净/相同数据将是在成功复制运行后设置回其非收敛状态：相同的记录，相同的值！

我认为我在网上没有留下太多关于数据融合和复制的可用资源。我什么也没找到。我计划在 3 小时内抛出/重建现有的发布/订阅，但我仍在为我的问题寻找一个合理的答案，以免它变成一个精神分析问题：

**有人知道发生了什么吗？**

PS：顺便说一下，由于PO代码不作为自然键，所以这个复制问题对数据库完整性没有影响。另一个支持代理键的论点*总是与**大多数时间*有效的自然键相反，但这[已经在其他地方讨论过](https://stackoverflow.com/questions/230351/what-should-i-consider-when-selecting-a-data-type-for-my-primary-key#232985)......

编辑：好吧，我做到了，但它不起作用！我把订阅和发布都扔了，重新创建了发布，但是我无法生成快照。服务器无法管理它所谓的“发布者的身份范围分配条目”，“在系统表中找不到” `MSmerge_identity_range`。

浏览后发现这篇[文章](http://support.microsoft.com/kb/943281)说“你删除了发布数据库中创建的第一个发布”时会出现这样的问题</p>

多么可笑！这正是我刚刚所做的！

幸运的是，这个问题应该可以通过 SQLServer 2005 累积包 5 解决，我仍然需要下载和安装。但现在的问题是：在这个 CP5 发布之前，SQLServer 2005 用户如何工作？

EDIT2：累积包 5 不起作用，我仍然无法为我的新复制创建快照！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T16:22:20.893

我认为你有正确的计划；）

# sql - 在哪里寻找数据库样本/模式？

> ID：343230
> 
> 赞同：5
> 
> 时间：2008-12-05T08:47:19.190
> 
> 标签：sql, database

我发现[http://www.databaseanswers.org/data_models/](http://www.databaseanswers.org/data_models/)非常有用。还有其他建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T13:21:17.390

如果你只是在寻找数据模型，我推荐以下书籍：

*   [数据模型资源书，卷。1：适用于所有企业的通用数据模型库](https://rads.stackoverflow.com/amzn/click/com/0471380237)
*   [数据模型资源书，卷。2：特定行业的数据模型库](https://rads.stackoverflow.com/amzn/click/com/0471353485)
*   [数据模型资源书：数据建模的通用模式](https://rads.stackoverflow.com/amzn/click/com/0470178450)

我有第 1 卷和第 2 卷，这些在过去很有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T08:50:17.297

**Microsoft 在VS2005**和**VS2008**中有 db 示例，但您也可以从这里下载： [Northwind Database](http://msdn.microsoft.com/en-us/library/ms227484.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T10:55:17.000

[这里](https://stackoverflow.com/questions/295838/where-can-i-get-a-large-sql-server-sample-database)和[这里](https://stackoverflow.com/questions/57068/good-databases-with-sample-data)有两个类似的问题，在 stackoverflow 上有很多答案。

# java - 如何使用 Java 将音频流转换为 MP3？

> ID：343240
> 
> 赞同：4
> 
> 时间：2008-12-05T08:50:39.683
> 
> 标签：java, mp3, capture, encode, recording

是否可以使用 Java 将实时音频流从混音器转换为 MP3？

*   它必须逐块转换，否则内存将被耗尽。
*   我已经知道如何录制，但仅限于无损格式，例如 wav 和 aiff。
*   当音频进来时，我需要转换。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T09:03:19.300

也许你可以使用[LAMEOnJ](http://openinnowhere.sourceforge.net/lameonj/)，它是一个 100% Java API 包装了标准 LAME API（LAME 是一个 MP3 编码器）。

我不确定它是否会“逐块”编码......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-06T06:18:25.477

使用 Xuggler 来做到这一点。它是免费的、开源的 (LGPL)，并且在后台使用 libmp3lame。Xuggler 中的[MediaTool API](http://wiki.xuggle.com/MediaTool_Introduction)提供了很多如何使用它的示例：

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T09:23:06.933

Lame 确实是 MP3 编码的事实上的标准，部分原因是它的高质量（编码 MP3 很难做到正确......这是一门主观艺术），部分原因是法律问题（MP3 是一项专利技术，AFAIK，这就是为什么您从有限数量的站点获取 Lame 二进制文件的原因，其中大多数位于这些法律问题较少（或未执行）强制执行的国家/地区）。

VonC 发现的 LAMEOnJ 项目似乎使用了非自由的 JNI 实现，但我想您可以自己绑定 JNI 甚至 JNA，特别是如果您针对的是精确系统。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T09:22:41.023

至于第一个问题 - 是否有可能，我能看到的唯一限制是处理器速度。如果您使用的算法和您的处理器都足够快，那么就没有理由不可能。

我知道这不是 Java 源代码，但它可能会让你走上正轨——试试看[Lame MP3 Encoder](http://lame.sourceforge.net/)。

据我所知，所有 MP3 转换算法都是逐块工作的。他们不需要读取整个 WAV 文件即可开始转换，但他们可以即时转换。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T10:30:06.923

在 Java 中创建一个新进程，然后将流写入到[SoX](http://sox.sourceforge.net/)等工具的标准输入中，让它即时将音频数据转换为 MP3。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-09-09T05:48:16.680

尝试使用环形缓冲区对原始音频缓冲区进行实时编码。

# scrum - Scrum 适合小型组织吗？

> ID：343254
> 
> 赞同：9
> 
> 时间：2008-12-05T09:02:03.530
> 
> 标签：scrum

是否有可能将他们的方法转换为 scrum

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-05T09:07:16.950

Scrum 的两个最佳实践是：

*   将您的员工分组为小团队。

*   保持快速高效的沟通（尤其是会议）。

所以，是的，毫无疑问，Scrum 适合小型组织。事实上，作为一个小型组织，你需要更少的重组来开始应用 scrum ！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T10:51:07.287

你甚至可以单独进行 Scrum，它被称为“ [Solo Scrum](http://www.pbell.com/index.cfm/2007/6/17/Solo-Scrums) ”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-08-08T21:25:54.847

正如其他人所指出的那样，Scrum 可以在所有级别上使用，它可以作为 1 的 scrum 单独完成。同样，您可以拥有“scrum of scrums”，它本质上是一个 scrum 团队的金字塔。每个团队都专注于一个功能或相关的功能集。团队会选出一两个成员来代表该功能团队向更多的观众（他们不需要每天开会！）并且该团队可以向上移动......您也可以更换代表，但我建议在 sprint 之间这样做，这是进行更改的最佳一般时间。

我对任何刚开始使用 Scrum 的人说的最重要的事情是：

*   从基础开始，不要沉迷于花哨的软件！使用索引卡、标记板等。这条规则的唯一例外是团队分散时。
*   在最初的几个 sprint 中，遵循所有的 scrum 规则。只有在您进行了几次冲刺之后，才能进行重大更改。这样，如果该过程对您不起作用，您就会知道这不是因为您立即做出了改变。
*   将更改排除在 sprint 之外。管理层不喜欢这个想法，因为他们想要控制，但事先已经同意产品更改发生在冲刺之间。
*   找一个“scrum 发起人”，这个人经历过一些 sprint 并且可以提供帮助（但不能干涉）。

祝你好运！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T09:20:29.250

对，但是...

我在一个小型组织中使用 Scrum 遇到的一个问题是，产品负责人经常不可用（由于还有许多其他职责）。

不用说，这会严重影响您的敏捷性。如果您想在这种情况下应用 Scrum，请务必清楚地传达产品负责人的角色是一个耗时的角色。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T20:21:42.217

没问题。我的经验是，即使是大公司也决定转向敏捷（scrum），他们从小团队中的 Scrum 开始——作为“概念证明”。

例如，我们从 2 名开发人员开始，然后迁移到具有 20 多名开发人员、4 个团队和 3 个独立项目的 Scrum。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T09:36:01.387

当然，Scrum 的某些方面只适用于大型团队，但也适用于小型团队。

像许多事情一样，这只是采取对您的公司或团队有用的事情，而不是盲目地遵循所有这些事情，因为“这就是你所做的”。

我已经看到它在 1 个开发人员和 3 周的预算下非常成功，只需将其缩减并调整为仅与该规模项目相关的想法。不确定这是否仍然算作 scrum，但它确实有效。

最终，任何项目管理计划都比没有好，您越早意识到问题的影响就越小。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-27T02:46:16.560

Scrum 最适合小型组织，原因如下：

1.  没有太多需要改变的命令和控制的心态。
2.  Scrum 团队和产品负责人之间更轻松、更非正式的讨论。
3.  开发团队、文档团队、QA 团队等没有很多明确定义的孤岛。因此，由从事产品工作的人员组成团队并让他们继续前进会更容易。
4.  没有多少先前的流程可能会阻碍 Scrum 流程的建立。
5.  小型组织通常没有为向高级管理层报告进度而创建大量报告的开销。您可以邀请他们随时查看墙上的烧毁。

我想这些理由已经足够了。在你的组织中接受它。

只要确保有一个非常了解该过程的人来为您实施它。另外，很高兴为第一个 Sprint 找一个教练。

# c++ - 适用于 Windows Mobile 的 DirectShow、视频缩放和图像捕捉

> ID：343257
> 
> 赞同：0
> 
> 时间：2008-12-05T09:02:38.943
> 
> 标签：c++, windows-mobile, directshow

我目前正在开发一个用于实时视频流 (www.livecliq.net) 的应用程序，并且我想添加用于图像捕获和视频缩放的功能。我一直在寻找有关 DirectShow 的教程和资源，但到目前为止，我只找到了一本书“为数字视频和电视编程 Microsoft DirectShow”，它对高级视频处理没有多大帮助。

有谁知道这是否可能以及如何对捕获的视频应用数字变焦以及如何使用设备相机拍摄照片？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T09:34:02.263

前段时间我搜索了有关使用 DirectShow 拍摄照片的信息，我发现最好的是这个[博客条目](http://blogs.msdn.com/marcpe/archive/2006/03/03/542941.aspx)。作者构建了一个 dll，它公开了一个用于捕获照片的功能。它还提到了 SDK 中进行视频捕获的 CameraCapture 示例。

# openid - 如何在 .net 中集成 OpenId 功能

> ID：343259
> 
> 赞同：4
> 
> 时间：2008-12-05T09:03:16.240
> 
> 标签：openid

寻找在 .net 中集成 OpenId 功能的教程

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T09:07:09.290

我有一种感觉，这个[Google 代码项目](http://code.google.com/p/dotnetopenid/)将是一个很好的起点。不久前我自己才开始研究它，我没有太多时间深入研究，但对于那些不想花太多时间实施的人来说，它看起来很有希望。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T09:08:13.703

如果您只需要 .NET 中的 OpenID 功能，您应该查看开源包[dotnetopenid](http://code.google.com/p/dotnetopenid/)。

至于教程，如果您不介意阅读没有针对特定实现语言的教程，那么还有很多教程。您应该查看[官方 OpenID 站点](http://openid.net)以获取教程，以及[有关 OpenId 的 Wikipedia 文章](http://en.wikipedia.org/wiki/OpenID)。

祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T09:48:37.040

刚刚在其他地方回答了这个问题：

> 通过谷歌找到一对： 已经提到了[这个。](http://blog.madskristensen.dk/post/OpenID-implementation-in-Csharp-and-ASPNET.aspx)那里也有一些控件，例如[这个](http://blog.nerdbank.net/2007/01/aspnet-drop-in-control-to-enable-openid.html)
> 
> 您还可以查看名为[RPX](http://rpxnow.com/)的新服务，它是作为 SaaS 的 OpenId。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-09T07:06:03.780

[本文档](http://openid.net/get-an-openid/start-using-your-openid/)解释了 OpenID 的工作原理，并通过屏幕截图展示了整个过程。

[文档](http://code.google.com/apis/accounts/docs/OpenID.html)描述了如何在您的 Web 应用程序和第三方网站中实现 Google 登录，并让您了解 OpenID 身份验证的工作原理。

[以下](http://www.fryan0911.com/2010/09/use-google-openid-authentication-in.html)是使用 DotNetOpenOAuth 库在 ASP.NET 应用程序上实现 OpenID 的分步过程。

# printing - 如何打印流水号ZPL-II的条码？

> ID：343271
> 
> 赞同：2
> 
> 时间：2008-12-05T09:10:24.260
> 
> 标签：printing, zpl-ii

我有一个简单的程序打印条形码。标签格式是预加载的形式。条形码的值由参数传递，如下所示。

```
^XA
^XFR:FORM.ZPL
^FN999^FDH654321+Y0001+OABC+^FS
^PQ2,0,1,N 
```

它打印两个条形码

```
H654321+Y0001+OABC+
H654321+Y0001+OABC+ 
```

我想要的是中间部分作为序列号，它会打印这样的条形码

```
H654321+Y0001+OABC+
H654321+Y0002+OABC+ 
```

我试过 ^SN 和 ^SF

```
^FN999^FDH654321+Y0001+OABC+^SF%%%%%%%%%dddd%%%%%%,1%%%%%%^FS 
```

但这并不成功，两个副本是一样的。我如何在 ZPL-II 中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T09:37:19.263

摘自 ZPL II 手册：

> ^AF^SN 0001, 1, Y^FS
> 
> 定义序列化字段，起始值为1，递增1，插入前导零

不过，我无法知道这是否会对您有所帮助，因为我只有 EPL2 标签定义方面的经验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-02-21T14:57:09.323

试试这个代码：

```
^XA
^LH10,40
^BCN,150,Y,N,N^FD^SNH654321+Y0001+OABC+,1,Y^FS
^PQ2,0,1,Y
^XZ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-09T08:53:37.793

这是不行的。并最终在应用程序中生成序列，而不是在打印机中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-22T11:36:43.650

尝试将 更改`^PQ2,0,1,N`为`^PQ2,0,0,N`。重复字段中的值表明您希望在增加序列号之前打印重复的序列号。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-06-05T14:26:03.783

使用串行字段命令 ^SF 而不是 ^SN（记录在 Zebra ZPL 编程参考和示例中）

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2021-09-22T18:15:34.613

您应该将符号`%`视为零，如下所示

`^FN999^FDH654321+Y0001+OABC+^SF%%%%%%%%%dddd%%%%%%,1%%%%%%^FS %%%%%%= 1000000`.

然后 `^FN999^FDH654321+Y0001+OABC+^SF%%%%%%%%%dddd%%%%%%,1000000^FS`

# .net - 从扫描图像中捕获数据的工具

> ID：343274
> 
> 赞同：2
> 
> 时间：2008-12-05T09:11:38.673
> 
> 标签：.net, ocr, devtools, data-capture

从扫描图像中获取数据的最佳工具有哪些？不管他们是免费的还是付费的。他们应该能够将扫描的图像转换为数据（文本、图像、表格等）。**最重要的是，他们应该有 API 与 .NET 2.0 集成以实现自动化。**

**编辑：输入数据一般是图片中的文本、图片、表格位置。这些图像基本上是来自包含数据的目录的扫描页面。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T10:08:55.767

以下是一些示例产品：

[渴望](http://asprise.com/product/ocr/index.php?lang=csharp)

[奥克工具](http://www.ocrtools.com/)

[所有这些 SourceForge .NET OCR](http://sourceforge.net/search/?type_of_search=soft&words=ocr+c%23)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-03T06:42:46.480

奇怪，但这里的大多数答案都是关于 OCR 库的，不管问题本身是否将数据捕获作为主要任务。

市面上有很多Data Capture应用，但说到SDK，我只能推荐ABBYY FlexiCapture Engine：[http ://abbyy.com/flexicapture_engine/](http://abbyy.com/flexicapture_engine/)

它为您提供了非常强大的可视化工具，可以根据不同的规则定义字段提取逻辑，批量测试，然后在与您的应用程序链接的 SDK 中使用此描述。这种字段提取技术一开始有点复杂，但是可以处理一些比较困难的事情，比如表格分成几页等等。免责声明：我为 ABBYY 工作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T18:29:39.697

[ABBYY FineReader OCR](http://finereader.abbyy.com/) API 符合 COM，可用于 C/C++、Visual Basic、.Net、Delphi 等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T09:12:05.223

我建议您查看[ReadIris Pro](http://www.irislink.com/c2-523-188/Readiris-Pro-11-Corporate-Edition---Ocr-software-for-high-volumes.aspx)，它声称具有自动文档处理功能。它很有可能具有某种形式的 API，尽管我还没有真正证实这一点。

我知道它对文本、表格和手写（全部大写的手写）很满意，并且作为额外的奖励可以识别条形码。

不过，它确实要花一些钱，但它并没有贵到令人望而却步。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-02T19:33:19.360

[AForge](http://www.codeproject.com/KB/recipes/aforge.aspx)有很多有用的机器视觉东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T09:15:33.300

你的意思是[OCR（光学字符识别）](http://en.wikipedia.org/wiki/Optical_character_recognition)？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-14T10:56:45.557

您可以使用[Amazon 的 Mechanical Turk](http://requester.mturk.com/)中的人员，您可以对人员进行编程以做任何您想做的事情，您可以查看他们的[API 文档](https://requester.mturk.com/mturk/resources)以获取更多信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-12-13T07:08:00.420

IBM DataCap、EMC-Captiva inputaccel 怎么样？

# eclipse - 更改eclipse插件更新站点的镜像

> ID：343275
> 
> 赞同：11
> 
> 时间：2008-12-05T09:11:40.873
> 
> 标签：eclipse, plugins, mirror, update-site

我正在使用 ganymede，但找不到为更新站点更改镜像的选项。有没有办法改变这个？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T09:48:01.843

**镜像**的所有概念[不再是 eclipse Ganymede 更新机制的一等公民](http://tronprog.blogspot.com/2008/07/eclipse-ganymede.html)，而是存储库的简单属性（用于[元数据或工件](http://wiki.eclipse.org/Equinox/p2/Concepts)）。

您仍然可以使用与[此错误](https://bugs.eclipse.org/bugs/show_bug.cgi?id=256909)中提到的命令行类似的命令行为给定功能强制镜像。

```
eclipsec -verbose -application org.eclipse.equinox.p2.metadata.repository.mirrorApplication 
-source http://www.someurl.com/ -destination file:x:/local/path/to/mirror 
```

（虽然没有测试）

另请参阅此[P2 简介](http://bandxi.com/exposure/eclipsecon2008/359/M2-UsingEquinoxP2.pdf)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T09:24:24.793

只需取消选中“自动选择镜像”，下次它会提示您选择镜像。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-05T09:23:55.717

如果我没记错的话，在“Help->Software Updates”中你可以管理所有的 Eclipse 存储库...

# javascript - 如何抑制窗口鼠标滚轮滚动...？

> ID：343277
> 
> 赞同：8
> 
> 时间：2008-12-05T09:13:05.300
> 
> 标签：javascript, scroll, mousewheel, zooming

我正在开发嵌入在页面中的画布应用程序。我有它，因此您可以使用鼠标滚轮放大绘图，但不幸的是，它会滚动页面，因为它是文章的一部分。

当我在 dom 元素上滚动鼠标滚轮时，是否可以防止鼠标滚轮在窗口上滚动？！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-05T09:27:50.093

为 mousewheel (Not Gecko) / DOMMouseScroll (Not IE) 附加事件处理程序并阻止其默认操作（即滚动内容）：

```
如果（元素.addEventListener）
    element.addEventListener("DOMMouseScroll", function(event) {
        event.preventDefault();
    }， 错误的）;
别的
    element.attachEvent("鼠标滚轮", function() {
        返回假；
    })

```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-03-28T12:00:24.770

我知道这是旧的，但这可能对谷歌人仍然有帮助。

我编写了一个 jQuery 插件来处理这个问题：**[$.disablescroll](https://github.com/ultrapasty/jquery-disablescroll)**。

它不仅处理鼠标滚轮，还处理通常会触发滚动的 touchmove 和 keypress 事件。

```
// disable all scrolling:
$(window).disablescroll();

// enable scrolling again:
$(window).disablescroll("undo"); 
```

# css - 居中两个兄弟 div 之一

> ID：343282
> 
> 赞同：8
> 
> 时间：2008-12-05T09:15:06.890
> 
> 标签：css, html, center

在下文中，我想更改 CSS`right-sibling`以使div*真正*居中。`container`（编辑：不使用绝对定位）。

```
<html>
  <head>
    <style type='text/css'>
      #container {
        width: 500px;
      }
      #left-sibling {
        float: left;
      }
      #right-sibling {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id='container'>
      <div id='left-sibling'>Spam</div>
      <div id='right-sibling'>Eggs</div>
    </div>
  </body>
</html> 
```

在当前的实现中，右兄弟的居中受到左兄弟的影响——您可以通过添加`display: none`到`left-sibling`' 样式来看到这一点。

（注意：我想避免修改 HTML 结构，因为据我了解，CSS 的全部意义在于将标签结构与表示逻辑分离，而这对于 CSS 来说似乎并不是一个非常疯狂的要求。处理。）

TIA。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T11:38:27.800

我刚刚用来让它工作的一个技巧是在容器的左侧有填充，我们可以通过给它一个相等但负的边距来鼓励左兄弟坐在这个空间内。

为了完成图片，我们还在容器的右侧放置了与左兄弟宽度相等的填充。

```
<html>
  <head>
      <style type='text/css'>      
        #container {
            width: 500px;
            padding-left:50px;
            padding-right:50px;     
            }      
        #left-sibling {
            border: solid 1px #000;
            float: left;
            width:50px;
            margin-left:-50px;  
        }      
        #right-sibling {
            border: solid 1px #000;
            text-align: center;

        }
        #container2 {
            width: 500px;   
            }  
</style>
  </head>
    <body>
        <div id='container'>      
            <div id='left-sibling'>Spam</div>
            <div id='right-sibling'>Eggs<br />Eggs<br />Eggs<br /></div>
        </div>
        <div id='container'> 
            <div id='left-sibling' style="display:none;">Spam</div>    
            <div id='right-sibling'>Eggs<br />Eggs<br />Eggs<br /></div>
        </div>
        <div id='container2'> 
            <div id='right-sibling'>Eggs<br />Eggs<br />Eggs<br /></div>
        </div>
      </body>
</html> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T09:59:26.020

尝试将宽度设置为 left-sibling 和相等的 padding-right: 到 right-sibling

像这样

```
<html>
  <head>
    <style type='text/css'>
      #container {
        width: 500px;
      }
      #left-sibling {
        float: left;
        width:50px;
      }
      #right-sibling {
        text-align: center;
        padding-right:50px;
      }
    </style>
  </head>
  <body>
    <div id='container'>
      <div id='left-sibling'>Spam</div>
      <div id='right-sibling'>Eggs</div>
    </div>
  </body>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T09:20:14.617

您可以将`float: left;`on更改`#left-sibling`为`position: absolute;`. 这将使其脱离正常流程，因此不会再影响右兄弟姐妹。

当然，这可能会对您的设计产生其他副作用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T09:27:07.067

您应该始终在浮动元素上设置宽度，否则事情会变得很奇怪:)

如果你放一个

```
border: solid 1px #000; 
```

在两个 div 上使用规则，您会看到发生了什么 - #right-sibling div 填充了父 div (#container) 的整个宽度，因此虽然文本*实际上*与中心对齐，但看起来并非如此！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T09:38:36.920

text-align 属性控制应用该属性的容器中内容的对齐方式。通过添加以下样式很容易看到：

```
#left-sibling { float: left; width:100px; border:1px Solid Blue; }
#right-sibling { text-align: center; width:100px; border:1px Solid Red; } 
```

我建议在文档中添加一个 doctype 以避免 quirksmode

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

以及以下样式：

```
#container { width: 500px; position:relative; border:1px Solid Black; }
#left-sibling { float:left; position:absolute; top:0px; left:0px; width:100px; border:1px Solid Blue; }
#right-sibling { width:100px; position:relative; margin-left:auto; margin-right:auto; border:1px Solid Red; } 
```

您当然希望调整兄弟姐妹的大小以满足您的需要。边界很好地展示了真正发生的事情。

# architecture - 我对 REST 有什么不了解的地方？

> ID：343288
> 
> 赞同：18
> 
> 时间：2008-12-05T09:19:52.650
> 
> 标签：architecture, rest

我正在构建一个框架，并希望使用它构建的开发人员能够允许它的一部分与其他站点共享数据并允许其他站点添加/编辑/删除数据。

例如，如果某人创建了一个包含书评、作者、引用、代码示例、评论等的网站，则开发人员可以使例如“书评”对其他网站只读，而“评论”对其他网站可读而对其他网站可写某些网站/用户。这个想法是使用该框架来构建可以轻松与其他应用程序互连的应用程序。

我设想通过 POST 和 GET 与网站进行所有交互，看起来像这样：

*   **/books.php?category=ruby**（返回有关 ruby​​ 的书籍的 XML 集合）
*   **/books.php?id=23**（返回特定书籍的 XML）
*   **/books.php?action=add&title=AdvancedRuby&description=....&securityId=923847203487**
*   **/books.php?action=delete&id=342&securityId=923847203487**

其他应用程序也可以通过这样做“发现和消费”某个站点必须提供的内容：

*   **/discover.php**（返回所有可用公共类和操作的 XML）

实际上，这就是我需要使框架成为开发人员快速创建松散连接站点的一种方式。

**我想知道的是，在我开始实施之前，是否有 REST 的重要/有趣的部分我还不明白我应该将哪些构建到框架**中，例如：

*   REST 需要 GET、POST、PUT 和 DELETE。为什么我需要“PUT”和“DELETE”？如果我不使用这些标准，我是否会阻止自己利用某些标准？
*   我的“discover.php”文件的功能类似于 Web 服务中的 WSDL 文件。我对 REST 的描述感到惊讶，似乎没有发现 RESTful 服务提供的服务的标准化方法，或者是否存在？
*   如果客户端网站尝试向服务器网站添加一本书，但没有得到任何“成功”响应，它会简单地再试一次，直到得到响应。服务器网站根本不会两次添加同一本书。这是我对 REST 中数据完整性的理解，还有比这更多的吗？
*   最终，我希望拥有多个具有相同丰富类的站点，例如“BookReview”，以便客户端站点能够执行如下代码：

    **$bookReview = new BookReview(" [http://www.example.com/books.php?id=23](http://www.example.com/books.php?id=23) "); $book->informAuthor("关于您的书评的评论已发布在我们的网站上...");**

服务器站点会向该评论的作者发送一封电子邮件。这种类型的交互是 RESTful 哲学的一个组成部分，还是 REST 只是通过 XML、JSON 交换数据？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-05T09:29:56.873

**如果我不使用这些标准，我是否会阻止自己利用某些标准？**

您将自己锁定在 HTTP 标准之外。当然，您可以使用 GET 参数来做同样的事情。那时它不是 REST，而是类似于 RPC 的东西。

我可以推荐Leonard Richardson 和 Sam Ruby的书[RESTful Web Services吗？](https://rads.stackoverflow.com/amzn/click/com/0596529260)阅读并显示不同方法之间的差异非常有趣。

更详细地回答您的问题：由您决定走哪条路。从理论上讲，您可以使用 RESTful 和类似 RPC 的方法来做所有相同的事情。使用 RESTful，您可以使用底层 HTTP 协议作为*协议*。使用 RPC，您将 HTTP 用作一种传输方式，并将工作订单隐藏在传输的数据中的某个位置。这会导致（不必要的）开销。

看看你的两个例子：

*   **/books.php?action=add&title=AdvancedRuby&description=....&securityId=923847203487**
*   **/books.php?action=delete&id=342&securityId=923847203487**
    *   有 POST 和 PUT 或 DELETE，为什么有 action=add 和 action=delete？
    *   有HTTP身份验证。为什么要发明一个——可能不太安全的——securityId？
    *   顺便说一句：您不应该允许通过 GET 更改数据。这只是不应该做的事情（另一个话题，虽然;））

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-05T09:41:49.127

我建议您阅读 Roy Fielding 的这篇[文章](http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven)。

一个亮点：

*   REST API 应该花费几乎所有的描述性工作来定义用于表示资源和驱动应用程序状态的媒体类型，或定义扩展关系名称和/或现有标准媒体类型的超文本启用标记。描述在感兴趣的 URI 上使用什么方法所花费的任何努力都应该完全在媒体类型的处理规则范围内定义（并且在大多数情况下，已经由现有媒体类型定义）。[这里的失败意味着带外信息正在推动交互而不是超文本。]

*   REST API 不得定义固定的资源名称或层次结构（客户端和服务器的明显耦合）。服务器必须可以自由控制自己的命名空间。相反，允许服务器通过在媒体类型和链接关系中定义这些指令来指导客户端如何构建适当的 URI，例如在 HTML 表单和 URI 模板中完成。[这里的失败意味着客户端由于带外信息而假设资源结构，例如特定于域的标准，它是面向数据的等价于 RPC 的功能耦合]。

正如您所描述的那样，您当然可以使用类似 RPC 的方法取得成功，并且它比“适当的 REST API”更容易掌握。REST 最容易被误解的方面是，一旦定义，它应该**自动工作**，你不应该定义 go to this URI using this method to get that answer，这都应该由你提供的媒体类型隐含以及让客户知道在哪里可以找到相关资源。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T10:45:15.100

来自[RestWiki](http://rest.blueoxen.net/cgi-bin/wiki.pl?RestInPlainEnglish#nid6AF)：

*   对标识符的 GET 表示“给我一份特定文档格式的信息副本”。
*   对该标识符的 PUT 表示“用我的信息替换您的信息”。
*   POST 添加信息，并且
*   DELETE 删除信息。

考虑到这一点，将其应用于您的应用程序应该非常简单。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T11:04:39.880

借助 Restlet 框架，我们完全尝试在 HTTP 细节之上提供这种抽象级别，并使 REST 概念更加具体（许多具有匹配的类，如 Component、Connector 和 Representation）： [http ://www.restlet.org/](http://www.restlet.org/)

我们是务实的编码人员，我们的用户使用我们的 RESTful 框架（用于 Java 和 GWT）开发实际应用程序。REST 支持者并不都是迂腐的，但每个主要技术都有一个学习曲线。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-04T06:42:27.357

我将尝试一下它看起来像 RESTful。

/books.php?category=ruby

```
GET /search?type=books&category=ruby 
```

/books.php?id=23

```
GET /books/23 (or /books/23.xml) 
```

/books.php?action=add&title=AdvancedRuby&description=....&securityId=923847203487

```
POST /books
title=AdvancedRuby&description=A+great+book... 
```

/books.php?action=delete&id=342&securityId=923847203487

```
DELETE /books/342 
```

许多开发人员坚持使用 GET 和 POST，在这种情况下，最后一个可能是：

```
POST /books/342
status=Deleted 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T10:04:19.597

REST 是一种有趣且可能有用的技术，但不幸的是，它似乎吸引了最迂腐的开发人员。

似乎他们宁愿一个实现遵循 REST 教条，即使这意味着完全丧失功能。任何与纯 REST 的偏差都将被视为异端。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-12-05T10:43:50.797

我对 REST 没有什么满意的地方。对我来说，从抽象的角度来看，对于不必处理复杂 HTTP 通信中涉及的更棘手的编码问题的网络极客来说，这是一个很棒的概念。

如果 REST API 可以将我们从所有 HTTP 中抽象出来，那该多好。但事实并非如此。相反，REST 支持者必须做一项销售工作，让您编写这样的 API，并伴随着调试和测试的所有问题。

在我看到 REST 1.0 标头的那一天，我会再看一遍，以找到值得付出努力的优势。

# .net - 使用 .NET 批量插入到 Oracle

> ID：343299
> 
> 赞同：31
> 
> 时间：2008-12-05T09:24:59.973
> 
> 标签：.net, sql, oracle, bulkinsert

使用 .NET 对 Oracle 进行批量插入的最快方法是什么？我需要使用 .NET 将大约 160K 记录传输到 Oracle。目前，我正在使用插入语句并执行 160K 次。大约需要 25 分钟才能完成。作为从另一个数据库（MySQL）查询的结果，源数据存储在 DataTable 中，

有没有更好的方法来做到这一点？

**编辑**：我目前正在使用 System.Data.OracleClient，但愿意接受使用其他提供商（ODP.NET、DevArt 等）的解决方案

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-28T12:28:34.723

我使用 ODP.NET 中的数组绑定在 15 秒左右的时间内加载了 50,000 条记录

它通过重复调用您指定的存储过程（并且您可以在其中执行更新/插入/删除）来工作，但是它将多个参数值从 .NET 批量传递到数据库。

您无需为存储过程的每个参数指定单个值，而是为每个参数指定一个值*数组*。

Oracle 一次性将参数数组从 .NET 传递到数据库，然后使用您指定的参数值重复调用您指定的存储过程。

[http://www.oracle.com/technetwork/issue-archive/2009/09-sep/o59odpnet-085168.html](http://www.oracle.com/technetwork/issue-archive/2009/09-sep/o59odpnet-085168.html)

/达米安

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2010-08-30T17:29:50.273

我最近发现了一个非常适合批量插入 (ODP.NET) 的专用类。Oracle.DataAccess.Client.OracleBulkCopy！它以数据表为参数，然后调用WriteTOServer方法……非常快速有效，祝你好运！！

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-12-05T10:17:41.943

Rob Stevenson-Legget 的解决方案很慢，因为他不绑定他的值，但他使用 string.Format()。

当您要求 Oracle 执行一条 sql 语句时，它首先计算该语句的 has 值。之后，它会在哈希表中查找它是否已经知道该语句。如果它已经知道它的语句，它可以从这个哈希表中检索它的执行路径并非常快地执行这个语句，因为 Oracle 之前已经执行过这个语句。这称为库缓存，如果您不绑定 sql 语句，它将无法正常工作。

例如不要这样做：

诠释n;

```
 for (n = 0; n < 100000; n ++)
    {
      mycommand.CommandText = String.Format("INSERT INTO [MyTable] ([MyId]) VALUES({0})", n + 1);
      mycommand.ExecuteNonQuery();
    } 
```

但做：

```
 OracleParameter myparam = new OracleParameter();
      int n;

      mycommand.CommandText = "INSERT INTO [MyTable] ([MyId]) VALUES(?)";
      mycommand.Parameters.Add(myparam);

      for (n = 0; n < 100000; n ++)
      {
        myparam.Value = n + 1;
        mycommand.ExecuteNonQuery();
      } 
```

不使用参数也会导致sql注入。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-04-11T06:23:06.587

SQL Server 的 SQLBulkCopy 速度非常快。不幸的是，我发现 OracleBulkCopy 慢得多。它也有问题：

*   如果您计划使用 OracleBulkCopy，您必须非常确定您的输入数据是干净的。如果发生主键冲突，则会引发 ORA-26026，并且似乎无法恢复。尝试重建索引无济于事，并且表上的任何后续插入都会失败，正常插入也是如此。
*   即使数据是干净的，我发现 OracleBulkCopy 有时也会卡在 WriteToServer 中。问题似乎取决于批量大小。在我的测试数据中，当我重复时，问题将发生在我的测试中完全相同的点。使用更大或更小的批量大小，问题就不会发生。我看到较大批量大小的速度更加不规则，这表明与内存管理相关的问题。

实际上 System.Data.OracleClient.OracleDataAdapter 比 OracleBulkCopy 更快，如果你想用小记录但很多行填充一个表。您需要调整批处理大小，OracleDataAdapter 的最佳 BatchSize 小于 OracleBulkCopy。

我在具有 x86 可执行文件和 32 位 ODP.Net 客户端 2.112.1.0 的 Windows 7 机器上运行了我的测试。. OracleDataAdapter 是 System.Data.OracleClient 2.0.0.0 的一部分。我的测试集大约有 600,000 行，最大记录大小。102 字节（平均大小 43 个字符）。数据源是一个 25 MB 的文本文件，以流的形式逐行读取。

在我的测试中，我将输入数据表构建为固定的表大小，然后使用 OracleBulkCopy 或 OracleDataAdapter 将数据块复制到服务器。我在 OracleBulkCopy 中将 BatchSize 保留为 0（以便将当前表内容作为一个批次复制）并将其设置为 OracleDataAdapter 中的表大小（同样应该在内部创建一个批次）。最佳结果：

*   OracleBulkCopy：表大小 = 500，总持续时间 4'22"
*   OracleDataAdapter：表大小 = 100，总持续时间 3'03"

为了比较：

*   SqlBulkCopy：表大小 = 1000，总持续时间 0'15"
*   SqlDataAdapter：表大小 = 1000，总持续时间 8'05"

相同的客户端机器，测试服务器是 SQL Server 2008 R2。对于 SQL Server，大容量复制显然是最好的方法。它不仅总体上最快，而且服务器负载也低于使用数据适配器时。遗憾的是 OracleBulkCopy 不能提供完全相同的体验 - BulkCopy API 比 DataAdapter 更容易使用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-05T10:06:09.267

解决这个问题的一个非常快速的方法是建立从 Oracle 数据库到 MySQL 数据库的数据库链接。您可以创建指向非 Oracle 数据库的数据库链接。创建数据库链接后，您可以使用 ... create table mydata as select * from ... 语句从 MySQL 数据库中检索数据。这称为异构连接。这样，您无需在 .net 应用程序中执行任何操作即可移动数据。

另一种方法是使用 ODP.NET。在 ODP.NET 中，您可以使用 OracleBulkCopy 类。

但我不认为使用 System.Data.OracleClient 在 Oracle 表中插入 160k 记录应该需要 25 分钟。我认为你犯了太多次。您是使用参数将您的值绑定到插入语句还是连接您的值。绑定要快得多。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-06-25T15:39:29.150

发现链接的示例有些令人困惑，我编写了一些代码来演示将工作数组插入到测试表 (jkl_test) 中。这是表格：

```
create table jkl_test (id number(9)); 
```

下面是一个简单的控制台应用程序的 .Net 代码，它使用 ODP.Net 连接到 Oracle 并插入一个 5 个整数的数组：

```
using Oracle.DataAccess.Client;

namespace OracleArrayInsertExample
{
    class Program
    {
        static void Main(string[] args)
        {
            // Open a connection using ODP.Net
            var connection = new OracleConnection("Data Source=YourDatabase; Password=YourPassword; User Id=YourUser");
            connection.Open();

            // Create an insert command
            var command = connection.CreateCommand();
            command.CommandText = "insert into jkl_test values (:ids)";

            // Set up the parameter and provide values
            var param = new OracleParameter("ids", OracleDbType.Int32);
            param.Value = new int[] { 22, 55, 7, 33, 11 };

            // This is critical to the process; in order for the command to 
            // recognize and bind arrays, an array bind count must be specified.
            // Set it to the length of the array.
            command.ArrayBindCount = 5;
            command.Parameters.Add(param);
            command.ExecuteNonQuery();
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-01-21T14:57:33.197

用我的发现跟进 Theo 的建议（抱歉——我目前没有足够的声誉来发表评论）

首先，这是如何使用几个命名参数：

```
String commandString = "INSERT INTO Users (Name, Desk, UpdateTime) VALUES (:Name, :Desk, :UpdateTime)";
using (OracleCommand command = new OracleCommand(commandString, _connection, _transaction))
{
    command.Parameters.Add("Name", OracleType.VarChar, 50).Value = strategy;
    command.Parameters.Add("Desk", OracleType.VarChar, 50).Value = deskName ?? OracleString.Null;
    command.Parameters.Add("UpdateTime", OracleType.DateTime).Value = updated;
    command.ExecuteNonQuery();
} 
```

但是，我发现以下之间的速度没有变化：

*   为每一行构造一个新的 commandString (String.Format)
*   为每一行构造一个现在参数化的 commandString
*   使用单个 commandString 并更改参数

我正在使用 System.Data.OracleClient，在事务中删除和插入 2500 行

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-28T12:32:31.623

甲骨文说（[http://www.oracle.com/technology/products/database/utilities/htdocs/sql_loader_overview.html](http://www.oracle.com/technology/products/database/utilities/htdocs/sql_loader_overview.html)）

> SQL*Loader 是使用来自外部文件的数据快速填充 Oracle 表的主要方法

我的经验是，他们的加载器加载表格的速度比其他任何东西都快。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-10-25T07:50:36.967

如果您使用的是非托管 oracle 客户端 (Oracle.DataAccess)，那么最快的方法是使用 OracleBulkCopy，正如 Tarik 指出的那样。

如果您使用的是最新的托管 oracle 客户端 (Oracle.ManagedDataAccess)，那么最快的方法是使用数组绑定，正如 Damien 所指出的那样。如果您希望保持应用程序代码不受数组绑定细节的影响，您可以使用数组绑定编写自己的 OracleBulkCopy 实现。

以下是真实项目的使用示例：

```
var bulkWriter = new OracleDbBulkWriter();
    bulkWriter.Write(
        connection,
        "BULK_WRITE_TEST",
        Enumerable.Range(1, 10000).Select(v => new TestData { Id = v, StringValue=v.ToString() }).ToList()); 
```

10K 记录在 500 毫秒内插入！

这是实现：

```
public class OracleDbBulkWriter : IDbBulkWriter
{
    public void Write<T>(IDbConnection connection, string targetTableName, IList<T> data, IList<ColumnToPropertyMapping> mappings = null)
    {
        if (connection == null)
        {
            throw new ArgumentNullException(nameof(connection));
        }
        if (string.IsNullOrEmpty(targetTableName))
        {
            throw new ArgumentNullException(nameof(targetTableName));
        }
        if (data == null)
        {
            throw new ArgumentNullException(nameof(data));
        }
        if (mappings == null)
        {
            mappings = GetGenericMappings<T>();
        }

        mappings = GetUniqueMappings<T>(mappings);
        Dictionary<string, Array> parameterValues = InitializeParameterValues<T>(mappings, data.Count);
        FillParameterValues(parameterValues, data);

        using (var command = CreateCommand(connection, targetTableName, mappings, parameterValues))
        {
            command.ExecuteNonQuery();
        }
    }

    private static IDbCommand CreateCommand(IDbConnection connection, string targetTableName, IList<ColumnToPropertyMapping> mappings, Dictionary<string, Array> parameterValues)
    {
        var command = (OracleCommandWrapper)connection.CreateCommand();
        command.ArrayBindCount = parameterValues.First().Value.Length;

        foreach(var mapping in mappings)
        {
            var parameter = command.CreateParameter();
            parameter.ParameterName = mapping.Column;
            parameter.Value = parameterValues[mapping.Property];

            command.Parameters.Add(parameter);
        }

        command.CommandText = $@"insert into {targetTableName} ({string.Join(",", mappings.Select(m => m.Column))}) values ({string.Join(",", mappings.Select(m => $":{m.Column}")) })";
        return command;
    }

    private IList<ColumnToPropertyMapping> GetGenericMappings<T>()
    {
        var accessor = TypeAccessor.Create(typeof(T));

        var mappings = accessor.GetMembers()
            .Select(m => new ColumnToPropertyMapping(m.Name, m.Name))
            .ToList();

        return mappings;
    }

    private static IList<ColumnToPropertyMapping> GetUniqueMappings<T>(IList<ColumnToPropertyMapping> mappings)
    {
        var accessor = TypeAccessor.Create(typeof(T));
        var members = new HashSet<string>(accessor.GetMembers().Select(m => m.Name));

        mappings = mappings
                        .Where(m => m != null && members.Contains(m.Property))
                        .GroupBy(m => m.Column)
                        .Select(g => g.First())
                        .ToList();
        return mappings;
    }

    private static Dictionary<string, Array> InitializeParameterValues<T>(IList<ColumnToPropertyMapping> mappings, int numberOfRows)
    {
        var values = new Dictionary<string, Array>(mappings.Count);
        var accessor = TypeAccessor.Create(typeof(T));
        var members = accessor.GetMembers().ToDictionary(m => m.Name);

        foreach(var mapping in mappings)
        {
            var member = members[mapping.Property];

            values[mapping.Property] = Array.CreateInstance(member.Type, numberOfRows);
        }

        return values;
    }

    private static void FillParameterValues<T>(Dictionary<string, Array> parameterValues, IList<T> data)
    {
        var accessor = TypeAccessor.Create(typeof(T));
        for (var rowNumber = 0; rowNumber < data.Count; rowNumber++)
        {
            var row = data[rowNumber];
            foreach (var pair in parameterValues)
            {
                Array parameterValue = pair.Value;
                var propertyValue = accessor[row, pair.Key];
                parameterValue.SetValue(propertyValue, rowNumber);
            }
        }
    }
} 
```

注意：此实现使用 Fastmember 包来优化对属性的访问（比反射快得多）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-02-07T07:06:24.087

我猜 OracleBulkCopy 是最快的方法之一。我遇到了一些麻烦，我需要一个新的 ODAC 版本。参照。[[Oracle.DataAccess.Client.OracleBulkCopy] 类型在哪里？](https://stackoverflow.com/questions/4912944/where-is-type-oracle-dataaccess-client-oraclebulkcopy)

这是从查询复制到合适的现有 Oracle 表的完整 PowerShell 代码。我尝试了 Sql-Server 一个数据源，但其他有效的 OLE-DB 源将转到。

```
if ($ora_dll -eq $null)
{
    "Load Oracle dll"
    $ora_dll = [System.Reflection.Assembly]::LoadWithPartialName("Oracle.DataAccess") 
    $ora_dll
}

# sql-server or Oracle source example is sql-server
$ConnectionString ="server=localhost;database=myDatabase;trusted_connection=yes;Provider=SQLNCLI10;"

# Oracle destination
$oraClientConnString = "Data Source=myTNS;User ID=myUser;Password=myPassword"

$tableName = "mytable"
$sql = "select * from $tableName"

$OLEDBConn = New-Object System.Data.OleDb.OleDbConnection($ConnectionString)
$OLEDBConn.open()
$readcmd = New-Object system.Data.OleDb.OleDbCommand($sql,$OLEDBConn)
$readcmd.CommandTimeout = '300'
$da = New-Object system.Data.OleDb.OleDbDataAdapter($readcmd)
$dt = New-Object system.Data.datatable
[void]$da.fill($dt)
$OLEDBConn.close()
#Write-Output $dt

if ($dt)
{
    try
    {
        $bulkCopy = new-object ("Oracle.DataAccess.Client.OracleBulkCopy") $oraClientConnString
        $bulkCopy.DestinationTableName = $tableName
        $bulkCopy.BatchSize = 5000
        $bulkCopy.BulkCopyTimeout = 10000
        $bulkCopy.WriteToServer($dt)
        $bulkcopy.close()
        $bulkcopy.Dispose()
    }
    catch
    {
        $ex = $_.Exception
        Write-Error "Write-DataTable$($connectionName):$ex.Message"
        continue
    }
} 
```

顺便说一句：我用它来复制带有 CLOB 列的表。我没有得到它使用链接服务器[cf。关于 dba](https://dba.stackexchange.com/questions/297/why-cant-i-read-oracles-clob-columns-via-sql-server-2008-linked-server)的问题。我没有用新的 ODAC 重试链接发球。

# email - 如何解决“421 RP-001 连接Windows Live Hotmail服务器的邮件服务器IP已超过速率限制”的问题？

> ID：343300
> 
> 赞同：3
> 
> 时间：2008-12-05T09:25:01.347
> 
> 标签：email, limit, live, hotmail

我们在荷兰经营着一个大型在线社区。因此，我们会向会员的 hotmail 电子邮件地址发送大量邮件。最近我们注意到并不是所有的邮件都会到达我们的会员，因为我们似乎已经达到了一定的限制。

谷歌（还）没有给出解决方案，但我们看到很多其他人也有同样的问题。请注意，我们已经为我们的域添加了（很久以来的）SPF 记录，采用 TXT 和 SPF 类型。我们还能做些什么来解决这个问题？

// 瑞安

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T18:39:21.207

补充一下 bzlm 所说的，hotmail 可能不会*拒绝*您的邮件，而是尝试使用速率限制来防止垃圾邮件。也就是说，您可以在这里使用一些潜在的解决方案。您可以联系 hotmail 并了解如何从他们的速率限制中获取您的邮件服务器豁免状态。根据您社区的规模，他们可能会或可能不会回应您或愿意与您合作。我建议这仅作为“外交”解决方案。

*或者*，您可以设置两个邮件服务器；一个给hotmail用户，一个给其他人。我从我经营的一些网站了解到，很多人都注册了 hotmail 帐户，主要是因为每个人都有一个他们不想使用真实电子邮件地址的在线服务的“垃圾邮件转储”。因此，您无疑意识到，您的数据库中的 hotmail 用户数量占了相当大的比例。因此，当您需要发送电子邮件时，您可以确定是发送到您的普通 SMTP 服务器，还是您的 hotmail 指定的服务器。在 hotmail SMTP 服务上，您需要添加某种类型的等待机制，以便在收到 421 响应后休眠一段时间。

这个想法的问题在于，您拥有的 hotmail 用户数量，加上您在发送过程中遇到的延迟，意味着队列长度很可能会超过您必须发送的邮件数量。您可以通过设置二级/三级服务器来缓解这个问题，最好是在其他网络上......但我在这里领先于自己。无论如何，我做了一些谷歌搜索（你可能也有），这并不是一个不常见的问题，但没有明显的解决方案。

很有可能，您要么必须创建某种稍微不正统的网络解决方法，要么尝试“外交”路线并联系不太可能关心您的问题的组织。我建议同时进行。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T22:00:19.360

421 表示该服务*当前*不可用，客户端**应该重试**。这可能有多种原因，包括在 Hotmail 认为您可能是垃圾邮件机器人时试图阻止您过于频繁地发送邮件。

为什么不简单地让您的出站 smtpd 将邮件排队并重试？

为什么“并非所有邮件都送达您的会员”？如果您收到 421 响应，您不会再试一次吗？

编辑：做[sqook说的。](https://stackoverflow.com/questions/343300/how-to-fix-the-421-rp-001-the-mail-server-ip-connecting-to-windows-live-hotmail-s/570757#570757)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-24T05:57:43.197

“解决”这个问题的唯一真正方法是成为一名优秀的电子邮件公民。让人们轻松取消订阅您的通知，与主要邮件提供商建立投诉反馈循环，自动从您的列表中删除退回的电子邮件，不要向人们发送他们不想收到的电子邮件。不遵守这些简单的要求会使您看起来像垃圾邮件发送者，而像 Hotmail 这样的提供商会像对待您一样对待您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-17T12:25:01.760

连接到 Outlook.com 服务器的邮件服务器 IP 已超过允许的速率限制。速率限制的原因与 IP/域信誉有关。如果您不是电子邮件/网络管理员，请联系您的电子邮件/互联网服务提供商寻求帮助。

[https://mail.live.com/mail/troubleshooting.aspx](https://mail.live.com/mail/troubleshooting.aspx)

我建议你也等一段时间

# asp.net - ASP.NET 数据缓存 - 覆盖是否意味着删除和重新添加？

> ID：343311
> 
> 赞同：0
> 
> 时间：2008-12-05T09:30:49.040
> 
> 标签：asp.net, caching

如果我将一个名为“foo”的项目添加到缓存中，然后在第一个过期之前将另一个名为“foo”的项目添加到缓存中，这会触发 CacheItemRemoved 事件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T10:04:31.000

不，它只是覆盖该项目。不调用已删除项目的回调。

# css - CSS设置宽度以填充剩余区域的百分比

> ID：343313
> 
> 赞同：82
> 
> 时间：2008-12-05T09:31:28.510
> 
> 标签：css

抱歉标题有点垃圾。我想不出如何更好地描述这一点。

我正在尝试在我的网站上实现 Google 朋友群成员小工具（刚刚进入该计划并希望在不进行重大重新设计的情况下将其放入，至少为了测试起见）。

我的问题如下：

我有一个容器 div，其宽度为主页（正文）的 90%。在这里面，我将一个 div 浮动到右侧并将其宽度设置为 300px 并将 google 小工具放入其中。我想要的是能够让 div 填充 google gadget div 左侧剩余空间的 95%。

我不知道是否可以将 px 和 % 与 div 和宽度混合使用。

我希望这是有道理的。

谢谢

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-05T09:34:41.233

这是。您正在寻找半流体布局。该任务最初是[CSS 实现的圣杯](http://www.alistapart.com/articles/holygrail)……但正如您从该链接中看到的那样（他们正在做 3 列，2 列固定但很容易改变），这是一个长期解决的问题 =）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-01-05T04:37:59.790

在查看了很多潜在的解决方案之后，我也做了一个快速的实验。我试图做的是混合流动和固定的行和列。

这就是我最终的结果：

[http://jsbin.com/hapelawake](http://jsbin.com/hapelawake)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-07-26T20:12:29.887

如果您更喜欢避免浮动和 clearfixes，请使用 flex 布局。

```
.main {
  display: flex;
  width: 90%;
}
.col1 {
  flex-grow: 1;
}
.col2 {
  width: 300px;
  margin-left: 5%;
}
```

```
<div class="main">
  <div class="col1" style="background: #518cf3;">Left column</div>
  <div class="col2" style="background: #94d0bb;">Right column</div>
</div>
```

**注意：如果您**[支持的浏览器](http://caniuse.com/#search=flex)需要，请添加 flex 供应商前缀。

# javascript - 将表格导出到 Excel，包括宏

> ID：343314
> 
> 赞同：1
> 
> 时间：2008-12-05T09:33:12.280
> 
> 标签：javascript, excel, asp-classic

出于统计原因，我想从数据集中进行广泛的分析。我已经有一个将数据导出到 Excel 的函数，但我有这样的原始数据；500 行，35 列，有时是一堆文本……

是否可以将宏包含到函数中，以便准备好分析 excel 文件？

我正在使用 ASP、Javascript，目前使用 Excel 2003。这是当前函数（由我的一位前辈编写）：

```
 function exporttoexcel()
    { //export to excel
        if (tableSortArray.length > 0)
        { 
          var t, arr;
          var tempArray=new Array();

          for(var i=0; i, i<tableSortArray.length; i++) {
              arr = tableSortArray[i].toString();
              arrr = (arr.split(","));
              if (i==0) { t = arrr[1]; }
              else { t += ','+arrr[1]; }
          }
          document.excel.t.value = t;
        }
        // I left out some mumbojumbo about sorting here
        document.excel.submit();
} 
```

我的意思是宏，以便“自动”制作图表以及一些转盘......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T10:30:11.293

从 mrexcel.com 被盗（google + cut_paste = 比打字更快）：

> ```
> ' Delete any old stray copies of the module1
> On Error Resume Next
> Kill ("C:\MrXL1.bas")
> On Error GoTo 0
> ' Export Module 1
> ActiveWorkbook.VBProject.VBComponents("module1").Export ("c:\MrXL1.bas")
> For x = 1 to 54   
> ThisBroker = Sheets("BrokerList").range("A" & x).value 
> ```
> 
> ' 为简洁省略了计划的定制 Sheets(Array("Menu", "Plan")).Copy NBName = ActiveWorkbook.Name
> ' 新书名 ' 将模块 1 导入到这本新书 Application.VBE.ActiveVBProject.VBComponents.Import (" c:\MrXL1.bas") ActiveWorkbook.SaveAs 文件名:=ThisBroker ActiveWorkbook.Close Next x Kill ("C:\MrXl1.bas")

或者，您也可以设置一个主 excel 文件（例如称为“analysis.xls”），该文件引用“数据”excel 文件中的数据，例如在单元格中输入：

> ='Z:\excel-data[Current-data.xls]Sheet1'!$A$1

用户打开主文件（“analysis.xls”），然后它会添加 Z:\excel-data\Current-data.xls 中的所有值，只需根据需要用新数据替换 Current-data.xls。

# ubuntu - 如何配置ubuntu以使GBK在eclipse中可用？

> ID：343343
> 
> 赞同：-1
> 
> 时间：2008-12-05T09:49:30.907
> 
> 标签：ubuntu

我无法在 Eclipse 中使用 GBK 编码编译 java 文件。项目属性中没有“GBK”选项，即使我在“文本文件编码”中输入了“GBK”。

我的 Eclipse 安装在 ubuntu 中，可能我的 ubuntu 的默认文件编码是 utf-8。如何配置ubuntu并让它在eclipse中支持“GBK”？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-10T10:53:53.627

eclipse的默认jre不是sun的jre，我改一下就成功了。

# windows - 网络驱动器标签

> ID：343346
> 
> 赞同：0
> 
> 时间：2008-12-05T09:52:35.707
> 
> 标签：windows, networking, c#-2.0, label, drives

我正在尝试将某些网络资源的标签映射为驱动器。当我使用 DriveInfo.GetDrives() 时，本地卷按预期具有 VolumeLabel 填充参数，但在网络驱动器中它是一个空字符串。我怎样才能得到这些标签？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T10:05:43.650

您可以为此使用 WMI - 不确定确切的查询（已经有一段时间了），但这里有一个如何获取网络驱动器可用空间的示例：

[http://en.csharp-online.net/Network_Drive_Free_Space](http://en.csharp-online.net/Network_Drive_Free_Space)

我认为在该示例中将 'name' 替换为 'VolumeName' 将为您提供所需的内容。

WMI 参考这里以防万一：

[http://msdn.microsoft.com/en-us/library/aa394173(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394173(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T13:15:08.713

永远不要使用 WMI 使用网络 API。

# internet-explorer - 如何使用不同的会话运行多个版本的 IE

> ID：343356
> 
> 赞同：1
> 
> 时间：2008-12-05T09:56:09.800
> 
> 标签：internet-explorer, testing, multiple-instances

我正在开发一个针对 IE 的 Web 应用程序，并且在测试期间希望以多个不同用户的身份登录并测试他们之间的交互。

目前我必须登录和注销才能切换用户；打开另一个窗口只会覆盖 cookie/会话。

有什么方法可以让 IE 完全独立运行；我可以运行 firefox 或 chrome 并获得另一个会话，但这些浏览器不支持该应用程序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T09:59:11.870

以不同的用户身份运行它怎么样？

例如，

```
runas /user:domain\account iexplore.exe 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T09:59:54.443

一种潜在的解决方案是从您的 PC 上运行具有不同设置的各种不同的虚拟机。Virtual PC 2007 可从 Microsoft 免费下载，它使虚拟机的创建变得非常简单直接。

假设您拥有中等功率的 PC 资源也应该不是什么大问题。

[http://www.microsoft.com/downloads/details.aspx?FamilyId=04D26402-3199-48A3-AFA2-2DC0B40A73B6&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=04D26402-3199-48A3-AFA2-2DC0B40A73B6&displaylang=en)

还有 MultipleIEs 虽然我不认为它使用不同的会话......不过值得一试。

[多个IE](http://multipleies.en.softonic.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-30T21:17:50.947

还有[IECollection](http://finalbuilds.edskes.net/iecollection.htm)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T10:01:54.703

这可能不是您问题的最终解决方案，但我观察到的是，例如[RSS Bandit](http://rssbandit.org/) - 一种使用 IE 作为渲染引擎的 RSS 阅读器 - 似乎与“真正的 Internet Explorer”具有不同的 Cookie 基础。这样您就可以同时拥有两个（基于 IE 的）浏览器会话。

不确定是否以及何时适用于其他应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T10:04:31.500

您可以使用 vmware 之类的虚拟化工具，并使用自己的 IE 运行第二个（或更多，如果您有足够的 RAM）Windows 实例。

而且这个工具听起来它可以只为 IE 实现相同的效果（无需设置整个 Windows 安装的麻烦）：http: [//googlesystem.blogspot.com/2007/05/google-buys-greenborder-security.html](http://googlesystem.blogspot.com/2007/05/google-buys-greenborder-security.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-30T21:11:23.487

这可能是一个更好的解决方案：

[http://www.mydigitallife.info/2009/07/22/run-separate-isolated-ie8-window-frame-session-with-nomerge-switch-for-multiple-logins/](http://www.mydigitallife.info/2009/07/22/run-separate-isolated-ie8-window-frame-session-with-nomerge-switch-for-multiple-logins/)

使用 -nomerge 标志运行 ie8 或使用菜单中的新会话...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-30T21:21:43.637

使用 IE Tester 并测试其他 IE 版本怎么样？

[http://www.my-debugbar.com/wiki/IETester/HomePage](http://www.my-debugbar.com/wiki/IETester/HomePage)

如何为同一台机器设置两个不同的域？这样，不同的 cookie 将用于不同的域（“服务器”）。

# c# - 字符串转二进制[]

> ID：343357
> 
> 赞同：3
> 
> 时间：2008-12-05T09:57:04.870
> 
> 标签：c#, stream

我有一个字符串需要提供给一个 com 对象，该对象有一个接受“对象数据”的 LoadFromStream 方法。我猜这应该是一个字节[]。

相当基本的问题：我的 MemoryStream 已全部填满并准备就绪。将其转换为二进制 [] 的最佳方法是什么？我应该手动将它一个一个地读入数组还是有一个简单的内置方式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T09:59:51.027

MemoryStream 有一个 ToArray() 方法，它返回一个 byte[]。

# c# - C#如何设置一个灵活的基础，以便以后从程序集中更改控件？

> ID：343358
> 
> 赞同：1
> 
> 时间：2008-12-05T09:57:07.227
> 
> 标签：c#, wpf, assemblies, namespaces, wpftoolkit

我还是 C# 的新手，我正在开发一个项目，我们还使用 WPF 和 WPF DataGrid Toolkit（参见 CodePlex），它尚未发布到框架中。由于项目的性质，100% 确定我们稍后会更改装配的一些控制。我的同事决定在我们项目的命名空间内重新定义数据网格中的每个控件，并重新定义程序集命名空间的特定控件。所以不要使用： clr-namespace:Microsoft.Windows.Controls.Primitives;assembly=WPFToolkit clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit 我们将使用我们自己的 xxx.Controls 和 xxx.Controls.Primitives 命名空间. 这样，更改 ihnerited 控件将非常容易。

不知何故，我对这个解决方案有一种**不好的** **感觉**，但我仍然**缺乏经验**，无法判断这种方法是否合法，或者是否有其他好的解决方案来满足我们的要求（稍后更改控件而不更改太多代码多个文件）。

如果您对这种方法发表意见，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T10:07:29.310

你在说什么样的改变？在您知道实际需要更改的内容之前先从每个类派生似乎是浪费时间。

当您*确实*需要更改某些内容时，此时创建派生类并修复任何引用应该不会太难 - 这可能仅适用于*某些*实例而不是所有实例。是的，这可能意味着签入涉及相当多的文件 - 但如果您使用的是合理的源代码控制系统，这将是一个原子更改，并且很明显*为什么*会发生更改。

使用您当前的方法，没有立即“这些是我们必须更改的控件” - 如果您以“及时”的方式进行操作，您只需查看哪些派生控件即可判断你实际上必须创造。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T10:29:54.070

我同意你的看法。改变，或者更好地说，改变，可以是任何种类的。行为等。并且应该及时做出改变。不幸的是，这不是我的决定。一些固执的人在工作:)

但令我感兴趣的是，是否存在对整个想法完全不同的方法？比如说，我有一个 DataGrid，项目正在发展，现在，我必须对 dataGrid 行的验证行为进行一些重大更改。这也适用于许多控件。

我们项目的问题是，我们有一种复杂的数据访问层，它不仅提供数据，而且实际上控制它。这意味着在不包含数据访问层提供的一些逻辑的情况下**，不会读取、修改、删除或附加数据。**

例如，数据网格不直接删除行，而是覆盖删除行为并请求数据访问层将其删除。使用绑定，这目前工作得很好。这种场景将适用于未来的许多其他事情，关于 CRUD 操作、验证等。

# database - Web 应用程序数据库并发

> ID：343362
> 
> 赞同：2
> 
> 时间：2008-12-05T09:59:34.270
> 
> 标签：database, concurrency

我有一个在后台有一个数据库（SQL Server）的 Web 应用程序（ASP.net 2.0）。如果两个用户同时将相同的数据插入同一个表，我正在考虑如何处理数据库并发。有什么办法可以处理这种情况吗？提前致谢。

吉米

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T10:17:55.983

为防止同时插入相同的数据，请在您希望唯一的列上使用唯一索引。第一个`INSERT`会成功，正确处理失败的错误`INSERT`。

要防止 2 个以上的用户同时修改相同（现有）记录，请使用乐观并发[http://en.wikipedia.org/wiki/Optimistic_concurrency_control](http://en.wikipedia.org/wiki/Optimistic_concurrency_control)。使用 SQL Server，使用列很容易实现乐观并发`TIMESTAMP`。使用您的数据读取时间戳。更新行时，检查时间戳值是否相同。如果时间戳不匹配，则用户有（正在查看）过时的行。适当地处理这种情况。

使用 SqlClient 的示例：

```
command.CommandText = @"
    UPDATE tbl
    SET LastName = @LastName, FirstName = @FirstName
    WHERE ID = @ID AND Timestamp = @Timestamp
    ";

int rowCount = command.ExecuteNonQuery();
if (rowCount != 1)
    throw new DBConcurrencyException(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T10:08:34.083

所有你需要的是：

```
开始交易；
将 XXXXXX 插入表 1 ......
将 YYYYY 插入表 2 ........
犯罪;
if (commit_failed) { 告诉用户再试一次！; };

```

SQLserver 将负责其余的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T10:09:19.260

如果您试图防止重复，最简单的答案是在您希望唯一的列上创建一个唯一索引。

如果您试图阻止多个用户同时修改同一记录，最好的办法是在表中添加最后修改的时间戳。当您阅读要在屏幕上显示的记录时，您会阅读时间戳，并且在您编写更改之前再次检查时间戳。如果它已更改，则意味着另一个用户已修改该记录，您应该阻止写入更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T10:16:47.467

在不知道您的 C# 代码如何与数据库（O/R、ADO.NET...）对话的情况下，很难给您一个有用的答案...

编辑：所有的例子都很棒，但如果他使用 SubSonic 等，它们将无济于事。

# svn - Subversion 中的最大密码长度是多少？

> ID：343366
> 
> 赞同：2
> 
> 时间：2008-12-05T10:01:37.357
> 
> 标签：svn, passwords

如果我将用于存储库访问的 Subversion 用户名和密码存储在文件`conf`夹中的文本文件中，我可以使用的最大密码长度是多少？也就是说，下面文件中的secret可以保存多久？

```
[users]
harry = harryssecret
sally = sallyssecret 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T10:34:42.390

如果您正在使用`svnserve`，它似乎没有定义限制（至少我找不到任何提及它）。来自[svn 书](http://svnbook.red-bean.com/)：

> 默认情况下，svnserve 服务器只知道如何发送 CRAM-MD5 身份验证质询。本质上，服务器向客户端发送少量数据。客户端使用 MD5 哈希算法创建数据和密码组合的指纹，然后将指纹作为响应发送。服务器使用存储的密码执行相同的计算以验证结果是否相同。实际密码绝不会通过网络传播。

恕我直言，如果使用 MD5，那么您可以使用任何可管理的密码长度。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T10:34:49.223

配置文件没有限制（当然，除了内存限制！）。

当然，客户端是否限制输入取决于您使用的客户端，但我希望它们都允许相当长的密码。

# c++ - 错误 LNK2005：_DllMain@12 已在 MSVCRT.lib 中定义

> ID：343368
> 
> 赞同：37
> 
> 时间：2008-12-05T10:01:43.533
> 
> 标签：c++, visual-c++, linker

我收到此链接器错误。

> **mfcs80.lib(dllmodul.obj)：错误 LNK2005：_DllMain@12 已在 MSVCRT.lib(dllmain.obj) 中定义**

请告诉我消除此错误的正确方法。我在微软支持网站上阅读了关于这个错误的解决方案，但它并没有太大帮助。

我正在使用带有平台 SDK 的 VS 2005

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2013-11-12T13:25:28.287

我有同样的错误信息，但这里的答案都没有为我解决。因此，如果您在创建使用 MFC 的 DLL 项目时遇到该问题，可以通过输入以下行来解决：

```
extern "C" { int _afxForceUSRDLL; } 
```

到`DllMain`定义的cpp文件。然后使用您自己的`DllMain`实现，而不是来自 dllmain.obj 的实现。

> 当我们尝试使用 MFC 库时，肯定会直接或间接包含 afx.h，然后 MFC(afx.h) 告诉链接器找到 __afxForceUSRDLL 的符号并将包含 __afxForceUSRDLL 的对象放入程序中，因此链接器搜索并将 dllmodule.obj 放入我们的程序中，因为 __afxForceUSRDLL 是在 dllmodule.cpp 中定义的。
> 
> 这是常见的情况。当我们想在mfc dll项目中使用自己的DllMain时，链接器抱怨有两个DllMain，一个在我们的代码中，一个在Dllmodule.obj中。
> 
> 所以我们需要告诉链接器为 __afxForceUSRDLL 添加我们的 dllmain.obj。所以我们需要在我们自己定义了自己的DllMain的cpp文件中定义__afxForceUSRDLL，然后链接器会忽略mfc的dllmodule.obj，只看到一个DllMain，从不报错。

来源：[http ://social.msdn.microsoft.com/Forums/en-US/0d78aa6b-1e87-4c01-a4a7-691335b7351a/how-to-build-mfc-application-dll-in-visual-c-2010](http://social.msdn.microsoft.com/Forums/en-US/0d78aa6b-1e87-4c01-a4a7-691335b7351a/how-to-build-mfc-application-dll-in-visual-c-2010)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-05T10:47:31.430

如果您彻底阅读链接器错误并应用一些知识，您可能会自己到达那里：

链接器将许多已编译的对象和库链接在一起以获取二进制文件。

每个对象/库描述

*   它期望在其他对象中出现什么符号
*   它定义了什么符号

如果两个对象定义了相同的符号，你就会得到这个链接器错误。在您的情况下， mfcs80.lib 和 MSVCRT.lib 都定义了 _DllMain@12 符号。

摆脱错误：

1.  找出您真正需要的两个库中的哪一个
2.  了解如何告诉链接器不要使用另一个链接器（例如使用[James Hopkin 的提示](https://stackoverflow.com/questions/343368/error-lnk2005-dllmain12-already-defined-in-msvcrtlib#343413)）

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-05T10:24:16.750

如果您要定义自己的 DllMain，则需要在项目设置中将“配置属性/常规”中的“使用 MFC”设置为“使用标准 Windows 库”。

您应该在更改后进行干净的重建。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-07-05T12:16:22.963

在我的项目中，我能够通过在项目设置中添加 mfcs80.lib 和 msvcrt.lib 作为附加依赖项来解决这个问题。“附加依赖项”可以在链接器 -> 输入下找到。

在调试配置中，必须分别是 mfcs80d.lib 和 msvcrtd.lib。

顺便说一句，我正在使用 Visual Studio 2010，所以在我的情况下，MFC 库称为 mfc100.lib。

我不确定为什么会这样。没有必要将这些 lib 文件添加为附加依赖项，因为我已经将“使用 MFC”设置为“在共享 dll 中使用 MFC”。我猜想通过将这些库指定为附加依赖项，它们以不同的顺序链接。

此解决方案与 Microsoft 网站上建议的解决方案大致相同：http: [//support.microsoft.com/kb/148652](http://support.microsoft.com/kb/148652)，除了我不需要在“忽略特定默认库”框中键入任何内容。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-05-06T04:39:07.643

对我来说，直接原因确实是缺少 _afxForceUSRDLL 符号引用，但间接原因是缺少 _USRDLL 宏定义。它由 VC 向导默认定义，但有时开发人员会错误地删除它。 [这里有更多的话](http://ofekshilon.com/2012/08/18/_dllmain12-already-defined/)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-01-13T10:08:43.000

对于所有在 ATL 项目中遇到此错误的人（主要是在尝试添加 MFC 支持时），这是我经过几天的挫折后找到的解决方案！

首先，[这个链接](http://www.dziwior.org/WindowsProgramming/Link_fails_with_multiple_includes_of_DllMain.html)比其他链接对我更有帮助。它为我指明了正确的方向。如果“生成的文件”（包含代理和存根代码，就像类型 guid）由于某种原因已被删除并重新添加到项目中，则会出现问题。这会导致 Visual Studio 以错误的顺序添加它们！

通常您首先会遇到“ATL 需要 C++ 编译”错误，但您可能已经通过关闭该文件的`Yc/Yu`（预编译头文件）设置来解决此问题。

您接下来应该做的是卸载您的项目并对其进行编辑。搜索定义构建并包含顺序（`ClCompile`和`ClInclude`）的项目组。检查他们的顺序和设置。

编译应按以下顺序出现：

1.  `dllmain.cpp`（`CompileAsManaged`设置为`false`并`PrecompiledHeader`留空）。
2.  库源（`MyLib.cpp`，包含`DllCanUnloadNow`等）
3.  代理/存根代码（`MyLib_i.c`; 与 具有相同的设置`dllmain.cpp`）
4.  `stdafx.cpp`（`PrecompiledHeader`设置为`Create`）
5.  所有其他库源文件（您的实际库内容）
6.  `xdlldata.c`（与 相同的设置`dllmain.cpp`）

然后应该像这样订购包含的内容：

1.  `dllmain.h`
2.  `MyLib_i.h`
3.  `Resource.h`
4.  `stdafx.h`
5.  `targetver.h`
6.  ...（实际的库头文件）
7.  `xdlldata.h`

修复构建顺序修复了我的项目，我能够创建一个新的干净构建。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-09-06T06:01:06.127

MSDN 知识库 ID Q148652。

[http://support.microsoft.com/kb/148652](http://support.microsoft.com/kb/148652)

原因：Visual C++ 按字母顺序编译源文件，并按字母顺序将编译的目标文件传递给链接器。如果链接器首先处理 DLLDATAX.OBJ，则源代码引用 DllMain，链接器从 MSVCRTD.LIB(dllmain.obj) 加载它。然后，链接器处理从包含#include "stdafx.h" 的 C++ 文件编译的目标文件，该文件引用符号 __afxForceUSRDLL，链接器从 MFC42D.LIB(dllmodul.obj) 加载该符号。此对象模块还包含 DllMain 的实现，从而导致冲突。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-04-24T07:25:49.760

我有一个非常相似的问题。[mfcs110d.lib(dllmodul.obj) : error LNK2005: _DllMain@12 already defined in MSVCRTD.lib(dllmain.obj)] 解决方案是**将 mfcs110d.lib 添加到 Additional Dependencies**

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-08-19T17:54:05.077

就我而言，预处理器指令有问题。出于某种原因`_USRDLL`，它不应该被定义。

要检查这一点，请转到 menu `Project` ，选择 `Project Properties` ，然后选择片段 `Configuration Properties` --> `Preprocessor` 。

预处理器指令将在那里找到。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-12-02T23:00:51.197

就`#undef`在`_USRDLL`之前包括`afx.h`，甚至更好的是，编辑您的项目配置并删除宏。

这是 MFC 扩展 DLL 的常用配置：MFC DLL[的构建设置](https://msdn.microsoft.com/en-us/library/aa235516%28v=vs.60%29.aspx)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-06-10T02:21:39.460

确保在每个 .cpp 文件的顶部包含“Stdafx.h”。我遇到了完全相同的错误，并且有一个 .cpp 文件根本不包含此标头。添加#include 解决了这个问题。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-04-20T19:50:49.623

我个人以这种方式摆脱了这个错误：右键单击项目中的`Solution Explorer`，`Properties`从弹出菜单中选择，单击`Linker`选项卡并添加`mfcs71ud.lib`到`Additional Dependencies`. 如果您使用的是 Visual Studio 2005，它应该是“80”而不是“71”等等。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-05-23T14:04:04.820

我在这里找到了解决方案 [Visual Studio 2010 库链接顺序](https://stackoverflow.com/questions/2765403/visual-studio-2010-library-linking-order)

这是： /FORCE:MULTIPLE 在链接器选项中

我必须将 ATL 和 MFC 混合在一起，才能使用 [module(name = "mymodule")]; MFC 应用程序中的构造以及“__hook”关键字

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-10-22T17:03:30.997

我发现这对我有帮助：http: [//support.microsoft.com/kb/148652](http://support.microsoft.com/kb/148652)

基本上链接器顺序不正确。CRT 库在 MFC 库之前被链接。事实证明，必须首先链接 MFC 库，然后才能链接 CRT 库。

呸呸呸微软！！

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-10-09T04:10:10.953

在字段中声明`mfc80ud.lib`and以解决问题。`mfcs80ud.lib``Additional Dependancies``Project Properties -> Linker Tab -> Input of Visual Studio`

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-06-06T13:19:17.420

这里的一些答案有一个共同的主题。

阿维舍克·玻色：-

> 在 Project Properties -> Linker Tab -> Input of Visual Studio 的 Additional Dependancies 字段中声明 mfc80ud.lib 和 mfcs80ud.lib 以解决此问题。

vmb100:-

> 我正在使用 Visual Studio 2010，因此在我的情况下，MFC 库称为 mfc100.lib。

何塞安德烈斯戈麦斯托瓦尔：-

> 我有一个非常相似的问题。[mfcs110d.lib(dllmodul.obj) : error LNK2005: _DllMain@12 already defined in MSVCRTD.lib(dllmain.obj)] 解决方案是将 mfcs110d.lib 添加到 Additional Dependencies

所以一般情况似乎是先找到要添加的库的名称...

[![图书馆名称](https://i.stack.imgur.com/jM5qN.png)](https://i.stack.imgur.com/jM5qN.png)

然后添加它....

[![将库添加到依赖项](https://i.stack.imgur.com/5UisA.png)](https://i.stack.imgur.com/5UisA.png)

请注意，似乎有一些[先决条件](https://stackoverflow.com/a/343413/3070485)和/或[替代](https://stackoverflow.com/a/19930430/3070485)解决方案。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-08-03T03:11:46.310

如果您的解决方案有多个导出相同符号的项目，也会发生这种情况。例如，如果您有`foo.dll`一个`foo.def`使用导出文件构建的子项目`DoFoo` *和*`bar.dll`一个使用`bar.def`导出文件构建的子项目`DoFoo`，则会发生冲突，这是您在链接时会看到的错误。

# java - 无法使用 DocumentBuilder 解析 XML 文件

> ID：343383
> 
> 赞同：2
> 
> 时间：2008-12-05T10:08:54.020
> 
> 标签：java, xml, parsing

我有这个代码：

```
if (file.exists()) {
  Document doc = builder.parse(file);
  NodeList list = doc.getElementsByTagName("property");
  System.out.println("XML Elements: ");
  for (int ii = 0; ii < list.getLength(); ii++) { 
```

第 2 行给出以下异常

```
E:\workspace\test\testDomain\src\com\test\ins\nxg\maps\Right.hbm.xml
...***java.net.SocketException：操作超时：连接：可能是由于地址无效
    在 java.net.PlainSocketImpl.socketConnect（本机方法）
    在 java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:372)
    在 java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:233)
    在 java.net.PlainSocketImpl.connect(PlainSocketImpl.java:220)

```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-05T10:22:27.330

也许 DocumentBuilder 没有成功地尝试通过网络套接字访问您的 XML 文档的 DTD？

如果 XML 文档中有 DTD 引用，请尝试编辑它们以证明原因。

如果这样可以解决您的问题，我认为您可以使用 EntityResolver 来获得更永久的解决方案，但我自己并没有这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-09-16T19:29:47.383

Brabster 的回答对我很有帮助。就我而言，我有一个以

```
<?xml version="1.0"?> <!DOCTYPE GBSet PUBLIC "-//NCBI//NCBI GBSeq/EN" http://www.ncbi.nlm.nih.gov/dtd/NCBI_GBSeq.dtd"> ... more to come 
```

这导致 DocumentBuilder 出现问题。我遇到了超时问题。真正的邪恶在于 URL 的内容：[http://www.ncbi.nlm.nih.gov/dtd/NCBI_GBSeq.dtd](http://www.ncbi.nlm.nih.gov/dtd/NCBI_GBSeq.dtd)：

```
<!-- ============================================
 ::DATATOOL:: Generated from "gbseq.asn"
 ::DATATOOL:: by application DATATOOL version 1.5.0
 ::DATATOOL:: on 06/06/2006 23:03:48
 ============================================ -->

<!-- NCBI_GBSeq.dtd
This file is built from a series of basic modules.
The actual ELEMENT and ENTITY declarations are in the modules.
This file is used to put them together.
-->

<!ENTITY % NCBI_Entity_module PUBLIC "-//NCBI//NCBI Entity Module//EN"  
"NCBI_Entity.mod.dtd">  %NCBI_Entity_module;

<!ENTITY % NCBI_GBSeq_module PUBLIC "-//NCBI//NCBI GBSeq Module//EN" "NCBI_GBSeq.mod.dtd"> %NCBI_GBSeq_module; 
```

删除后

```
<!DOCTYPE GBSet PUBLIC "-//NCBI//NCBI GBSeq/EN" "http://www.ncbi.nlm.nih.gov/dtd/NCBI_GBSeq.dtd"> 
```

我的程序至少可以前进！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T00:35:07.650

您是否创建了 DocumentBuilderFactory 的新实例，然后在解析文件之前创建了 newDocumentBuilder？

```
DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
DocumentBuilder db = dbf.newDocumentBuilder();
Document doc = db.parse(file); 
```

希望这个[链接](http://www.java-tips.org/java-se-tips/javax.xml.parsers/how-to-read-xml-file-in-java.html)有帮助。今天早些时候它肯定对我有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T10:25:49.180

尝试简化您的问题。

你能得到代码吗，你必须手动解析？

如果是，请尝试解析它。我认为这不是您的 DocumentBuilder 的问题，而是您的网络连接的问题。因此，您必须确保 DocumentBuilder 能够访问xml 文档的*每一位*。

如果您手动存储的文档在验证时失败，则会出现不同的错误消息。

希望能帮助到你。

# matlab - 检测传输中的文件？

> ID：343391
> 
> 赞同：2
> 
> 时间：2008-12-05T10:14:09.080
> 
> 标签：matlab, filesystems, polling

我正在编写一个应用程序，通过每隔几秒钟轮询一次目录来监视新输入文件的目录。新文件通常可能有几兆字节，因此需要一些时间才能完全到达输入目录（例如：从远程共享复制）。

有没有一种简单的方法来检测文件当前是否正在被复制？理想情况下，任何方法都与平台和文件系统无关，但不同平台可能需要特定策略。

我已经考虑过将两个目录列表分开几秒钟并比较文件大小，但这引入了时间/可靠性权衡，除非别无选择，否则我的上级并不满意。

作为背景，该应用程序被编写为一组 Matlab M 文件，所以恐怕没有 JRE/CLR 技巧......

* * *

**编辑：**文件通过直接移动/复制操作直接到达输入，无论是从网络驱动器还是从本地文件系统上的另一个位置。此复制操作可能由人类用户而不是其他应用程序启动。

因此，很难让文件提供者负责添加控制文件或使用中间暂存区......

* * *

**结论：**似乎没有简单的方法可以做到这一点，所以我已经决定采用带大括号的方法 - 如果满足以下条件，则文件已准备好进行处理：

*   它的大小在一定时间内不会改变，*并且*
*   可以以只读模式打开文件（某些复制过程会锁定文件）。

感谢大家的回复！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T10:21:43.010

最安全的方法是让将文件放在目录中的应用程序首先将它们放在不同的临时目录中，然后将它们移动到真实目录（即使使用 FTP 或文件共享也应该是原子操作） . 您还可以使用命名约定在一个目录中实现相同的结果。

**编辑：** 这实际上取决于文件系统，取决于它的复制功能是否甚至具有“已完成文件”的概念。我不太了解 SMB 协议，但如果它有这个概念，您可以编写一个公开 SMB 接口（或修补 Samba）的应用程序和一个 API，以便在完成文件副本时获得通知。不过可能工作量很大。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T10:32:45.483

这是一个由来已久的中间件问题，简短的回答是：不。

这两个“解决方案”将责任放在文件上传器上：（1）将文件上传到暂存目录中，然后将其移动到目标目录（2）上传文件，然后创建/上传一个“就绪”文件指示内容文件的状态。

第一个更好，但两者都不优雅。事实上，存在比文件系统更好的通信媒体。考虑使用一些只涉及推送或拉取的 IPC（而不是两者，文件系统也是如此），例如 HTTP POST、JMS 或 MSMQ 队列等。此外，这也可以是同步的，允许进程接收文件承认内容，甚至检查其价值，并给客户一张收据 - 这是不可否认的正义之路。遵循这一点，您将永远不会因文件是否已交付给您的服务器进行处理而争论不休。

M。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T10:21:46.847

一种简单的可能性是以相当大的间隔（2 到 5 分钟）进行轮询，并且仅在您第二次看到新文件时才确认它。

除了检查文件是否被锁定之外，我不知道在任何操作系统中确定文件是否仍在被复制的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T10:21:53.837

文件是如何到达那里的？您可以在写入时为其设置属性，然后在写入完成时更改属性吗？这需要通过写作来完成……听起来这不是一个选择。

否则，缓存列表并将文件视为新文件（如果两个连续列表的文件大小相同）是我能想到的最好方法。

或者，您可以在文件上使用修改后的时间 - 文件必须是新的，并且修改后的时间至少是过去的 x。但我认为这将相当于缓存列表。

如果您每隔几秒钟就轮询一次文件夹，那么它的时间损失不是很大吗？并且它与平台无关。

此外，仅限 Linux：[http ://www.linux.com/feature/144666](http://www.linux.com/feature/144666)

像 cron 但用于文件。不确定它如何处理您的特定问题 - 但可能有用吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T10:55:14.673

你的操作系统是什么。在 unix 中，您可以使用“lsof”实用程序来确定用户是否打开了文件以供写入。显然，在 MS Windows 进程资源管理器中的某个地方有相同的功能。

或者，您可以尝试对文件进行独占打开并避免失败。但这可能有点不可靠，而且很容易踩到你自己的脚趾。

# flash - 信用卡支付成功后，在 Flash 中感谢捐赠者

> ID：343393
> 
> 赞同：-1
> 
> 时间：2008-12-05T10:15:47.763
> 
> 标签：flash, donations

我所说的一个例子是在一些政治候选人网站上，比如 BJ Lawson 或 Ron Paul 的旧网站。

当您捐赠时，它会在 Flash 中显示您作为最近捐赠者的姓名。它还可能显示一个“目标”以及您的进度。只是好奇你能否给我一些关于如何完成类似事情的想法，首先从如何接受信用卡开始。

我“认为”我应该使用第 3 方支付处理器来避免自己处理信用卡和责任，比如 Paypal，但我不确定我的网站（以及最近的 Donor Flash 应用程序）如何“知道”付款是顺利完成。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T16:53:23.967

作为您发布付款步骤的一部分，通常您会做一些事情，例如将订单发送给您的履行团队，记录捐赠。

Flash 应用程序将需要通过以 xml 或 json 形式返回信息的网页查询您的数据库，或者您希望将数据提供给您的 Flash 应用程序，以便经常显示新的捐赠。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T10:55:19.683

第三方支付处理网站会让您知道支付处理的结果。我认为你需要对这个领域做一些基础研究，有很多第三方——一直到完整的商家账户，一直到 Paypal 和 Google Checkout。

为什么需要 Flash 来写入某人的姓名和进度表？

# vba - 从更新查询提示中获取值

> ID：343396
> 
> 赞同：3
> 
> 时间：2008-12-05T10:17:04.470
> 
> 标签：vba, ms-access

当我们运行更新查询时，我们会得到提示说'这些许多记录将被更新。你想继续吗'是否可以将提示消息中的值捕获到变量中，即要更新的记录数。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T13:02:32.060

如果从代码运行查询，则可以使用受影响的记录属性：

```
Dim db As Database
Set db=CurrentDB
db.Execute "Some SQL here"
db.RecordsAffected 
```

如果使用事务，则可以回滚。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T01:09:59.003

Patrick Cuff 提出了这个功能：

```
 Function RowsChanged(updateQuery As String) As Long
    Dim qry As QueryDef

    Set qry = CurrentDb.QueryDefs(updateQuery)
    qry.Execute

    RowsChanged = qry.RecordsAffected
  End Function 
```

我不明白为什么当可以直接在 CurrentDB.Execute 完成而不初始化（或清理）任何对象变量的情况下分配 QueryDef 变量来执行查询时，为什么会遇到麻烦。

显然，参数查询将需要使用 QueryDef 方法，因为您必须在执行之前将值分配给参数。但是如果没有参数，就没有理由让它变得比必要的更复杂。像这样的通用函数没有设置为处理参数查询，它似乎设计错误。

而且，当然，它还应该使用 dbFailOnError，这样您就不会得到意外的结果（dbFailOnError 与 QueryDef.Execute 一起使用，就像它与 CurrentDB.Execute 一样）。在这种情况下，确实需要一个错误处理程序。

而不是每次执行 SQL 时都编写错误处理程序，而是可以这样做。以下函数返回 RecordsAffected 并将正确地从错误中恢复：

```
 Public Function SQLRun(strSQL As String) As Long
  On Error GoTo errHandler
    Static db As DAO.Database

    If db Is Nothing Then 
       Set db = CurrentDB
    End If
    db.Execute strSQL, dbFailOnError
    SQLRun = db.RecordsAffected

  exitRoutine:
    Exit Function

  errHandler:
    MsgBox Err.Number & ": " & Err.Description, vbExclamation, "Error in SQLRun()"
    Resume exitRoutine
  End Function 
```

It can also be used to replace DoCmd.RunSQL (you just call it and ignore the return value). In fact, this function was entirely designed for use as a global replacement for DoCmd.RunSQL.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T13:07:01.163

是的，您可以通过`RecordsAffected`属性获取更新的记录数：

```
Function RowsChanged(updateQuery As String) As Long
    Dim qry As QueryDef

    Set qry = CurrentDb.QueryDefs(updateQuery)
    qry.Execute

    RowsChanged = qry.RecordsAffected
End Function 
```

您可以使用更新查询的名称调用此函数以获取更新的行数：

```
Dim numRows as long
numRows = RowsChanged("UpdateQuery") 
```

# project-management - 版本控制和里程碑之间是否存在关联？

> ID：343401
> 
> 赞同：1
> 
> 时间：2008-12-05T10:18:09.523
> 
> 标签：project-management, versioning

我知道的很多操作系统项目（我是 PHP 开发人员）都使用版本作为里程碑，但这是最好的方法吗？里程碑是否应该意味着项目迭代过程中的某些东西（意思是全名）？有什么规则吗？或者它完全是主观的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T10:35:06.760

就像那句古老的格言所说，“标准的美妙之处在于有这么多可供选择。” 我不能告诉你我将如何为 PHP 项目做这件事，但我可以告诉你我们用于商店的方法 - 这是一个 .NET 商店。

我们使用一个相当传统的四部分版本控制系统，版本的每个部分代表不同的东西。例如：

Major.Minor.Revision.Build

显然，每个都是一个数字。对我们来说，这四个部分是微软预先安排好的。让我带你回顾一下堆栈，关于我们如何证明每个人的合理性：

*   构建 - 在我们的商店中自动递增。这个指标就像一个构建的唯一标识符，因为它是由编译器提供的。
*   修订版 - 我们将此保留用于不会破坏兼容性的版本。公开的接口被保留，第三方实现可能会在没有修改的情况下原封不动地运行。
*   次要 - 此版本通常会引入新功能、更改现有功能并运行破坏兼容性的更高风险。
*   Major - 涉及大量重写、大量新功能集以及从根本上偏离以前的代码库的大规模更改。

里程碑在哪里发挥作用？它们是我们的项目目标。里程碑在项目启动之前确定，代表应达到预期进度水平的点。它主要用于在发布之前向业务用户介绍功能并监控发布的整体交付计划。我们还在版本控制中为每个里程碑应用了一个标签，以帮助轻松识别由于任何原因需要手动构建的里程碑。

在我们店里，里程碑的内容比它的名字更重要。为什么？当有多种原因表明它是一个里程碑时，复杂的里程碑不能轻易地以传达含义的方式命名。我们在日历和 wiki 上放置了里程碑，并描述了预期在其中实现的目标。

就像我之前提到的，我相信你也会得到一些其他的“标准”。目标是找到适合您和您的团队的流程，并坚持下去。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T10:56:28.633

在我们的开发过程中，版本和里程碑是不同的。我们的标准里程碑之一是*发布*。当然，这有一个版本。但对我来说，里程碑是未来的事情，是我必须计划的事情。版本与发布相耦合，因此它已成为过去。

我们的标准里程碑计划基于公司范围的项目管理标准。我们有

*   S-Gate：*指定*
*   A-Gate：*可用*
*   V-Gate：*已验证*
*   R门：已*发布*

对于迭代开发，我们基本上重复这个循环。从 A 到 V 门是 alpha 阶段，从 V 到 R 是 beta 阶段。对于更大的项目，我们添加了与正在完成的特定功能集相关的里程碑。

我们使用它的原因主要是所有项目都是根据这个方案报告的，并且以他们熟悉的方式向管理层提供信息总是好的做法;-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T10:28:20.017

嗯，是的，这意味着你已经在迭代中完成了足够的工作来发布一些有用的东西。里程碑通常意味着您已经完成了比迭代结束更重要的事情。我会使用有意义的名字是的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T11:15:05.913

你在谈论至少两件不相关的事情。有源代码控制和项目里程碑。它们是相关的，但它们不是一回事。此外，还有软件开发工作本身，这与源代码和项目里程碑有关，但也有所不同。

这是一种基于 Scrum 的方法。它有三个可以编号或命名的不相关的东西。

首先是软件开发工作。

1.  我们有冲刺来构建东西。这些可以编号，但它们通常有名称。诸如“批量加载第 1 部分”、“重构工作簿库”或“添加销售演示数据夹具”之类的名称。

2.  我们有发布来发布东西。这些可以编号（基于 SVN 版本，或基于我们内部的“兼容性版本”，​​但它们通常有名称。“客户 X 的第一个版本”，或“此的错误修复”或“升级到那个”或其他东西有意义的。

其次，有源代码控制。为此，我们有一些与 sprint 和发布无关的内部版本/修订跟踪。

1.  SVN 有存储库版本号。这会随着每次签入而增加。有几个星期，每天都有一个签到。几个星期，只有几个“大”签到。

2.  我们有一个 major.minor 版本号，我们手动更新以显示兼容性。一些应用程序从 1.1 迁移到 1.2，因为一些小的变化，但数据库和 API 是相同的。其他应用程序从 2.3 迁移到 3.1，因为数据库或 API（或两者）以某种不兼容的方式发生了更改，我们需要进行模式迁移，并可能通知客户 REST 客户端接口的更改。

三是项目规划。

我们的项目计划**里程碑**包括我们的发布时间表。然而，项目里程碑还包括其他与软件无关的事情。里程碑包括诸如“签署新的托管协议”或“获取客户 X 测试数据”之类的内容。这些不是版本或发布或冲刺或任何东西。

“有什么规矩吗？” 是的。阅读 Scrum 以获得一套好的规则。

这不是一回事。这是两（或三）件事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T10:29:28.563

版本号很方便，因为您可以立即获取任何两个版本，并查看两个版本中哪个较新。它总是在一定程度上是主观的，因为谁能说什么功能或错误修复构成了里程碑？

我喜欢的方案是 xyz，其中 x 是主要版本号，y 是次要版本号，z 是内部版本号。主要版本意味着重写、大修或引入主要的新功能。次要版本意味着重大的错误修复，或一些小的功能改进或错误修复。内部版本号正是 - 版本号。

# mysql - 绕过 MySQL“无法重新打开表”错误

> ID：343402
> 
> 赞同：107
> 
> 时间：2008-12-05T10:18:34.263
> 
> 标签：mysql, temp-tables

我目前正忙于实现一个过滤器，我需要为每个“标签”生成一个 INNER JOIN 子句来过滤。

问题是，在一大堆 SQL 之后，我有一个表，其中包含进行选择所需的所有信息，但是对于每个生成的 INNER JOIN，我都需要它

这基本上看起来像：

```
SELECT
    *
FROM search
INNER JOIN search f1 ON f1.baseID = search.baseID AND f1.condition = condition1
INNER JOIN search f2 ON f2.baseID = search.baseID AND f2.condition = condition2
...
INNER JOIN search fN ON fN.baseID = search.baseID AND fN.condition = conditionN 
```

这可行，但我更希望“搜索”表是临时的（如果它不是普通表，它可以小几个数量级）但这给了我一个非常烦人的错误：`Can't reopen table`

一些研究让我看到了[这个错误报告](http://bugs.mysql.com/bug.php?id=10327)，但 MySQL 的人们似乎并不关心这样的基本功能（多次使用表）不适用于临时表。我在这个问题上遇到了很多可扩展性问题。

是否有任何可行的解决方法不需要我管理潜在的大量临时但非常真实的表，或者让我维护一个包含所有数据的巨大表？

亲切的问候，克里斯

[额外的]

GROUP_CONCAT 答案在我的情况下不起作用，因为我的条件是按特定顺序排列的多个列，它会使 OR 脱离我需要的 AND。但是，它确实帮助我解决了早期的问题，因此现在不再需要该表，无论是否为临时表。对于我们的问题，我们只是想得太笼统了。过滤器的整个应用现在已经从大约一分钟缩短到不到四分之一秒。

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2013-01-28T10:27:59.517

一个简单的解决方案是复制临时表。如果表相对较小，则效果很好，临时表通常是这种情况。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-12-07T06:03:11.813

对，MySQL[文档](http://dev.mysql.com/doc/refman/5.0/en/temporary-table-problems.html)说：“你不能`TEMPORARY`在同一个查询中多次引用一个表。”

这是一个替代查询，它应该找到相同的行，尽管匹配行的所有条件都不会位于单独的列中，它们将位于逗号分隔的列表中。

```
SELECT f1.baseID, GROUP_CONCAT(f1.condition)
FROM search f1
WHERE f1.condition IN (<condition1>, <condition2>, ... <conditionN>)
GROUP BY f1.baseID
HAVING COUNT(*) = <N>; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-05-03T06:30:34.143

我通过创建一个永久的“临时”表并将 SPID（对不起，我来自 SQL Server 领域）后缀到表名来解决这个问题，以创建一个唯一的表名。然后创建动态 SQL 语句来创建查询。如果发生任何不好的事情，该表将被删除并重新创建。

我希望有更好的选择。来吧，MySQL 开发人员。“错误”/“功能请求”自 2008 年以来一直开放！似乎所有遇到的“错误”都在同一条船上。

```
select concat('ReviewLatency', CONNECTION_ID()) into @tablename;

#Drop "temporary" table if it exists
set @dsql=concat('drop table if exists ', @tablename, ';');
PREPARE QUERY1 FROM @dsql;
EXECUTE QUERY1;
DEALLOCATE PREPARE QUERY1;

#Due to MySQL bug not allowing multiple queries in DSQL, we have to break it up...
#Also due to MySQL bug, you cannot join a temporary table to itself,
#so we create a real table, but append the SPID to it for uniqueness.
set @dsql=concat('
create table ', @tablename, ' (
    `EventUID` int(11) not null,
    `EventTimestamp` datetime not null,
    `HasAudit` bit not null,
    `GroupName` varchar(255) not null,
    `UserID` int(11) not null,
    `EventAuditUID` int(11) null,
    `ReviewerName` varchar(255) null,
    index `tmp_', @tablename, '_EventUID` (`EventUID` asc),
    index `tmp_', @tablename, '_EventAuditUID` (`EventAuditUID` asc),
    index `tmp_', @tablename, '_EventUID_EventTimestamp` (`EventUID`, `EventTimestamp`)
) ENGINE=MEMORY;');
PREPARE QUERY2 FROM @dsql;
EXECUTE QUERY2;
DEALLOCATE PREPARE QUERY2;

#Insert into the "temporary" table
set @dsql=concat('
insert into ', @tablename, ' 
select e.EventUID, e.EventTimestamp, e.HasAudit, gn.GroupName, epi.UserID, eai.EventUID as `EventAuditUID`
    , concat(concat(concat(max(concat('' '', ui.UserPropertyValue)), '' (''), ut.UserName), '')'') as `ReviewerName`
from EventCore e
    inner join EventParticipantInformation epi on e.EventUID = epi.EventUID and epi.TypeClass=''FROM''
    inner join UserGroupRelation ugr on epi.UserID = ugr.UserID and e.EventTimestamp between ugr.EffectiveStartDate and ugr.EffectiveEndDate 
    inner join GroupNames gn on ugr.GroupID = gn.GroupID
    left outer join EventAuditInformation eai on e.EventUID = eai.EventUID
    left outer join UserTable ut on eai.UserID = ut.UserID
    left outer join UserInformation ui on eai.UserID = ui.UserID and ui.UserProperty=-10
    where e.EventTimestamp between @StartDate and @EndDate
        and e.SenderSID = @FirmID
    group by e.EventUID;');
PREPARE QUERY3 FROM @dsql;
EXECUTE QUERY3;
DEALLOCATE PREPARE QUERY3;

#Generate the actual query to return results. 
set @dsql=concat('
select rl1.GroupName as `Group`, coalesce(max(rl1.ReviewerName), '''') as `Reviewer(s)`, count(distinct rl1.EventUID) as `Total Events`
    , (count(distinct rl1.EventUID) - count(distinct rl1.EventAuditUID)) as `Unreviewed Events`
    , round(((count(distinct rl1.EventUID) - count(distinct rl1.EventAuditUID)) / count(distinct rl1.EventUID)) * 100, 1) as `% Unreviewed`
    , date_format(min(rl2.EventTimestamp), ''%W, %b %c %Y %r'') as `Oldest Unreviewed`
    , count(distinct rl3.EventUID) as `<=7 Days Unreviewed`
    , count(distinct rl4.EventUID) as `8-14 Days Unreviewed`
    , count(distinct rl5.EventUID) as `>14 Days Unreviewed`
from ', @tablename, ' rl1
left outer join ', @tablename, ' rl2 on rl1.EventUID = rl2.EventUID and rl2.EventAuditUID is null
left outer join ', @tablename, ' rl3 on rl1.EventUID = rl3.EventUID and rl3.EventAuditUID is null and rl1.EventTimestamp > DATE_SUB(NOW(), INTERVAL 7 DAY) 
left outer join ', @tablename, ' rl4 on rl1.EventUID = rl4.EventUID and rl4.EventAuditUID is null and rl1.EventTimestamp between DATE_SUB(NOW(), INTERVAL 7 DAY) and DATE_SUB(NOW(), INTERVAL 14 DAY)
left outer join ', @tablename, ' rl5 on rl1.EventUID = rl5.EventUID and rl5.EventAuditUID is null and rl1.EventTimestamp < DATE_SUB(NOW(), INTERVAL 14 DAY)
group by rl1.GroupName
order by ((count(distinct rl1.EventUID) - count(distinct rl1.EventAuditUID)) / count(distinct rl1.EventUID)) * 100 desc
;');
PREPARE QUERY4 FROM @dsql;
EXECUTE QUERY4;
DEALLOCATE PREPARE QUERY4;

#Drop "temporary" table
set @dsql = concat('drop table if exists ', @tablename, ';');
PREPARE QUERY5 FROM @dsql;
EXECUTE QUERY5;
DEALLOCATE PREPARE QUERY5; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2020-05-25T05:31:53.877

如果切换到 MariaDB（MySQL 的一个分支）是可行的——从 10.2.1 版开始，这个烦恼就在那里得到解决：[https](https://jira.mariadb.org/browse/MDEV-5535) ://jira.mariadb.org/browse/MDEV-5535 。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-07T07:55:12.773

就我个人而言，我只是把它做成一张永久的桌子。您可能希望为这些表创建一个单独的数据库（假设它们需要唯一的名称，因为可以一次完成许多这些查询），还允许明智地设置权限（您可以设置数据库的权限；您可以t 设置表通配符的权限）。

然后你还需要一个清理工作来偶尔删除旧的（MySQL 方便地记住创建表的时间，所以你可以使用它来计算何时需要清理）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-12-08T07:27:27.580

您可以通过创建一个永久表（之后将其删除）来解决它，或者只使用相同的数据创建 2 个单独的临时表

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-01-27T19:32:25.720

[![在此处输入图像描述](https://i.stack.imgur.com/EULLr.png)](https://i.stack.imgur.com/EULLr.png)

这是有关此问题的 MYSQL 文档。我像上面的一些答案一样使用重复的临时表，但是，您可能会遇到适合 CTE 的情况！

[https://dev.mysql.com/doc/refman/8.0/en/temporary-table-problems.html](https://dev.mysql.com/doc/refman/8.0/en/temporary-table-problems.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T17:44:15.210

我能够将查询更改为永久表，这为我修复了它。（更改了 MicroStrategy 中的 VLDB 设置，临时表类型）。

# html - 动态重叠父 div 的 HTML 表

> ID：343422
> 
> 赞同：1
> 
> 时间：2008-12-05T10:28:34.277
> 
> 标签：html, css, resize

如何在调整大小时使内表与父 div 重叠 5 px？

我目前的解决方案：

```
<div id="crop">
  <table style="width:105%; height:105%;">
    //table cells
  </table>
</div> 
```

问题是调整大小时它会变小...

我怎样才能让它不断地与 5px 重叠；

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T15:22:52.370

后续似乎在 FF3、Chrome 和 IE7 中运行良好。虽然在 IE 的 CSS 样式中使用表达式并不理想。

您应该看到，在渲染时，蓝色的“外部”div 显示在“内部”div 中。对于 IE 以外的浏览器，“内部” div 将为红色，而 IE 将变为绿色。

另请注意，在此示例中，我必须从“内部”div 的高度中减去 2px 以调整顶部和底部边框。

```
<html>
    <head>
        <style type="text/css">
            #outer {
                position: relative;
                border: solid 1px blue;
                height: 100px;
            }
            #inner {
                position: absolute;
                border: solid 1px red;
                top: -5px;
                left: -5px;
                bottom: -5px;
                right: -5px;
            }
        </style>
        <!--[if IE]>
        <style type="text/css">
            #inner {
                border: solid 1px green;
                height: 108px;
                width: expression(document.getElementById("outer").clientWidth + 10);
            }
        </style>
        <![endif]-->
    </head>
    <body>
        <table width="100%">
            <colgroup>
                <col />
                <col width="100" />
                <col width="200" />
            </colgroup>
            <tr>
                <td>
                    <div id="outer">
                        <div id="inner">
                            <table border="1">
                                <tr><td>A</td><td>B</td></tr>
                                <tr><td>C</td><td>D</td></tr>
                            </table>
                        </div>
                    </div>
                </td>
                <td>Alpha</td>
                <td>Beta</td>
            </tr>
            <tr>
                <td>One</td>
                <td>Two</td>
                <td>Three</td>
            </tr>
        </table>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T11:01:44.303

您是否尝试过以下方法：

```
table {
position: relative;
top: 5px;
left: 5px;
margin-top: -5px;
margin-left: -5px;
} 
```

该表将在右侧和底部以 5px 重叠 div。添加边距以使表格填充左侧和顶部。如果您希望整个表格偏移，只需省略边距。您可能必须为表格上方的 div 或内容添加一些样式，以防止 div 折叠。

这是一个完整的例子：

```
<style type="text/css">
#container {
background-color: red; //color added for illustration
}

#data {
background-color: blue; //color added for illustration
position: relative;
top: 5px;
left: 5px;
margin-top: -5px;
margin-left: -5px;
}
</style>

<!-- ... -->

<div id="container">
some text to make the div visible at the top
<table id="data">
<!-- rows -->
</table>
</div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T11:02:46.657

简而言之：

1.  `table`把里面的另一个粘起来，`div`把`table`'s 的宽度设置为 100%
2.  通过将`div`其定位设置为绝对（确保父对象具有相对位置）并将其宽度设置为 100% 来实现移动。
3.  使用新`div`的负边距将其精确拉出 5px。

这有点乱，但你肯定需要负边距，你可能需要`position:absolute`让它重叠......

# java - 这是什么 java.awt.event 错误？

> ID：343435
> 
> 赞同：1
> 
> 时间：2008-12-05T10:31:28.997
> 
> 标签：java, events, awt

### 回答：

如果你曾经看到这些线条并且像我一样被迷惑，这就是它们的意思。

`Thread[AWT-EventQueue-0] (Suspended (exception NullPointerException))`

`EventDispatchTread.run() line: not available [local variables unavailable]`

并不是说这些变量不可用，因为它们潜伏在一个潮湿的图书馆里的神秘裹尸布后面。不不，他们只是超出了范围！这仍然是你的错，你仍然必须找到空值，不，你不能责怪图书馆。重要的教训！

### 问题：

作为初学者，对我来说最令人沮丧的事情之一就是图书馆！这是一种爱恨交织的关系：一方面他们让我做我通常不明白的事情如何处理我理解的代码，另一方面因为我不完全理解他们，他们有时会抛出一个使用其他工作正常的代码扳手！这是因为我不理解使用这些库时可能发生的错误，因为我没有编写它们，而且当其中一个导入开始起作用时，eclipse 并没有给我太多的帮助......

所以这就是问题所在：我一直在使用 java.awt.event 来处理屏幕上的一堆 JButton。当我使用我制作的其中一个按钮时出现错误。错误是：

`Thread[AWT-EventQueue-0] (Suspended (exception NullPointerException))`

`EventDispatchTread.run() line: not available [local variables unavailable]`

这是什么意思？可能是什么原因造成的？我很尴尬地发布代码，但如果你能忍受尝试破译我糟糕的风格，这里是似乎导致这个错误被抛出的方法。

```
public void actionPerformed(ActionEvent e) {
    String cmd = e.getActionCommand();
    String name;

code...

if(cmd.equals("Play")) {
        name = field.getText();
        card = getCard(name);

        if(card != null) {
            if(rules.zoneHasCard(card, rules.hand)) {
                display.updateStatusMessage(rules.play(card));
                field.setText("");
                display.updateHand(rules.zoneList("hand"));
                display.updateDiscard(rules.zoneList("Discard")); // This is the error here! The discard Zone was empty!
            }
            else {
                field.setText("You do not have " + card.getName());
                field.selectAll();
            }
        }
        else {
            field.setText("That cardname is unused");
            field.selectAll();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T11:12:02.317

欢迎来到编写 GUI 代码的复杂性。

当您运行 Swing 程序时，会创建一个称为 Event Dispatch Thread 的后台线程。例如，当用户单击 JButton 时，JButton 使用此事件调度线程创建并触发一个事件。因此得名：它是调度事件的线程！

你的代码：

```
public void actionPerformed(ActionEvent e) {
        String cmd = e.getActionCommand();
        String name;

// more code...
} 
```

由此事件调度线程调用，因此您的代码可以处理该事件。

在您的代码中的某处，您正试图对当前等于 null 的变量执行某些操作。错误消息告诉您，“嘿，在事件调度线程上运行一些代码时，我**在您的代码中**遇到了 NullPointerException” 。

为什么您没有收到更多信息？可能您将 Eclipse 配置为在编译时不包含调试信息？

现在，我建议在您的 actionPerformed 方法中添加一些行来显示变量的状态：

```
System.out.println("field = " + field);
System.out.println("rules = " + rules);
System.out.println("display = " + display); 
```

看看这是否显示任何空值。

即使 NullPointerException 来自库，堆栈跟踪也会显示代码的哪一行调用了该库。但前提是您已将 Eclipse 配置为生成调试信息。

从长远来看，通过 Sun 的 Swing 教程来了解有关这些问题的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T10:43:34.447

对空对象的任何方法调用都会引发空指针异常。

在您的代码中，*规则、名称或显示*可能为空并导致异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T10:58:33.373

使用调试器（例如包含在 Eclipse IDE 中的调试器）并在 actionPerformed() 方法的开始处设置断点，然后逐行遍历它以查看您尝试调用方法的变量何时为空。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T11:10:42.367

只是不要在两行之后停止读取堆栈跟踪。在堆栈跟踪的某处，您将识别出您编写的类/方法之一的名称。开始看那里。（顺便说一句，人们在调试器中花费了很多时间:-)）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T11:09:57.267

您可能忘记实际设置 ActionCommand。

在[ActionEvent API Doc](http://java.sun.com/javase/6/docs/api/java/awt/event/ActionEvent.html#getActionCommand())中有一条关于 getActionCommand() 可能的空结果的注释。

# c++ - 使用 C 或 C++ 的 Windows 的 Memcached 客户端？

> ID：343437
> 
> 赞同：1
> 
> 时间：2008-12-05T10:32:00.680
> 
> 标签：c++, c, windows, memcached

我需要一个可移植的 C/C++ 解决方案，因此我正在寻找适用于 Windows 和 Unix 的 Memcached 的 C/C++ 客户端库。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T10:42:39.207

C中有libmemcached。应该是最便携的:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-06T07:32:21.727

[http://people.freebsd.org/~seanc/libmemcache/](http://people.freebsd.org/~seanc/libmemcache/)

高温高压

# c# - 将字符串从内存流转换为二进制 [] 包含领先的废话

> ID：343457
> 
> 赞同：1
> 
> 时间：2008-12-05T10:42:45.543
> 
> 标签：c#, stream

--编辑更多bgnd信息--

一个（黑盒）COM 对象返回一个字符串。第二个 COM 对象需要与 byte[] 相同的字符串作为输入，并返回带有处理数据的 byte[]。这将作为可下载的非人类可读文件提供给浏览器，该文件将加载到客户端独立应用程序中。

所以我从第一个 COM 获取字符串 inputString 并将其转换为 byte[] 如下

```
BinaryFormatter bf = new BinaryFormatter();
MemoryStream ms = new MemoryStream();
bf.Serialize(ms, inputString);
obj = ms.ToArray(); 
```

我将它提供给第二个 COM 并将其读回。结果被写入浏览器。

```
Response.ContentType = "application/octet-stream";
Response.AddHeader("content-disposition", "attachment; filename="test.dat");
Response.BinaryWrite(obj); 
```

由于格式不正确，错误发生在第 2 个 COM 中。我去检查了原始字符串，这非常好。然后我将结果从 1st com 直接发送到浏览器并观察结果。似乎在路上的某个地方添加了额外的不可读字符。这些字符是什么，它们的用途是什么？如何防止它们使我的第二个 COM 停止运行？

不可读的字符是这样的：

NUL/SOH/NUL/NUL/NUL/FF/FF/FF/FF/SOH/NUL/NUL/NUL 等

有任何想法吗？

**--答案--**
使用

```
System.Text.Encoding.UTF8.GetBytes(theString) 
```

而不是

```
BinaryFormatter.Serialize() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T10:58:05.277

BinaryFormatter 几乎肯定不是您想要使用的。

如果您只需要将字符串转换为字节，当然可以使用[Encoding.GetBytes](http://msdn.microsoft.com/en-us/library/system.text.encoding.getbytes.aspx)进行合适的编码。UTF-8 通常是正确的，但请检查文档是否指定了编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T10:52:01.467

我认为您错过了 BinarySerialization 的重点。

首先，formulaXml 是什么类型？

二进制序列化会将其压缩为机器表示的值，而不是 XML！内容将如下所示：

```
 ÿÿÿÿ          AIronScheme, Version=1.0.0.0, Culture=neutral, Public 
```

也许您应该改用 XML 序列化程序。

**更新：**

您想将一些 XML 写为“内容处置”流。

为此，请执行以下操作：

```
byte[] buffer = Encoding.Default.GetBytes(formulaXml);
Response.BinaryWrite(buffer); 
```

这应该像你希望的那样工作（我认为）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T11:00:26.457

的`BinaryFormatter`工作是将对象转换为某种不透明的序列化格式，只能由另一`BinaryFormatter`端的另一个人理解。

（我也想提一下`Encoding.GetBytes`，但乔恩打败了我。）

您可能想要使用 System.Text.Encoding.UTF8.GetBytes()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T11:22:17.663

好的，使用您更新的信息：您的第二个 COM 对象需要二进制数据，但您想从字符串创建该二进制数据。它是否将其视为纯二进制数据？

我的猜测是，在客户端会有一些事情会逆转这个过程。如果最终要将数据重建为字符串，则需要选择要使用的正确编码，并在两边都使用它。在大多数情况下，UTF-8 是一个不错的选择，但*如果*客户端只是将数据写入文件并将其用作 XML 文件，则需要根据 XML 选择适当的编码。

您之前说过字符串的前几个字符只是`"<foo>"`（或类似的）——这是否意味着没有 XML 声明？如果不是，请选择 UTF-8。否则，您应该查看 XML 声明并使用它来确定您的编码（如果声明未指定编码，则再次默认为 UTF-8）。

获得正确的编码后，请使用前面答案中提到的 Encoding.GetBytes 。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T10:52:24.743

开头的废话是两个字节长吗？

这可能是 Unicode 编码字符串的字节顺序标记。

> [http://en.wikipedia.org/wiki/Byte-order_mark](http://en.wikipedia.org/wiki/Byte-order_mark)

# c# - dot net 是否有一个像 IEnumerable 这样带有 Count 属性的接口？

> ID：343466
> 
> 赞同：13
> 
> 时间：2008-12-05T10:46:01.837
> 
> 标签：c#, .net

dot net 是否有一个像 IEnumerable 这样带有计数属性的接口？我知道诸如 IList 和 ICollection 之类的接口确实提供了 Count 属性，但似乎这些接口首先是为可变数据结构设计的，并且用作只读接口似乎是事后的想法 - IsReadOnly 字段的存在和变异器抛出异常当此属性为真时，IMO 有充分的证据证明这一点。

目前我正在使用一个名为 IReadOnlyCollection 的自定义界面（请参阅我自己对这篇文章的回答），但我很高兴知道其他替代方法。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-05T10:52:20.937

ICollection 系列和 IEnumerable 系列之间的主要区别在于，存在的项目数量缺乏确定性（通常这些项目将根据需要生成/加载/水合） - 在某些情况下，Enumerable 可能永远无法完成生成结果，这就是缺少 Count 的原因。

根据您的要求，可以派生和添加一个 Count，但这违背了这种精神，这就是 ICollection 的目的 - 一个东西的集合。

另一种方法可能是使用 System.Linq.Enumerable.Count 方法，即

```
using System.Linq;

class X
{
   void Y(IEnumerable<int> collection)
   {
      int itemCount = collection.Count();
   }
} 
```

或使用 (System.Linq.Enumerable) .ToList() 将枚举器中的所有项目拉入 Collection 并从那里开始工作。

（还要在获得 50 个代表之前回答您的评论：-“.Count()”位是对扩展类 System.Linq.Enumerable 上的扩展方法的调用-扩展方法可用于从 IEnumerable 派生的所有事物，因为该代码有一个“使用 System.Linq”，它将该命名空间中所有类中的扩展方法带入范围 - 在这种情况下，它在 Enumerable 类中。如果您在 VS 中，按 F12 将带您进入 SLEnumerable 的定义. 顺便说一句，C# In Depth 是一本用于正确学习 LINQ 的绝妙书籍 - 与逐个学习 LINQ 的部分相比，它确实可以帮助您全面了解 LINQ）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-06-04T17:50:12.103

从 .Net 4.5 开始，有两个新接口：[`IReadOnlyCollection<T>`](http://msdn.microsoft.com/en-us/library/hh881542%28v=vs.110%29)和[`IReadOnlyList<T>`](http://msdn.microsoft.com/en-us/library/hh192385%28v=vs.110%29).

`IReadOnlyCollection<T>`是添加`IEnumerable<T>`了一个`Count`属性，`IReadOnlyList<T>`还添加了索引。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T11:03:45.763

考虑到一些评论，我决定使用实现自定义接口的包装类......

```
interface IReadOnlyCollection<T> : IEnumerable<T>
{
    int Count { get; }
}

//This can now be not misused by downcasting to List
//The wrapper can also be used with lists since IList inherits from ICollection
public class CollectionWrapper<T> : IReadOnlyCollection<T>
{

    public CollectionWrapper(ICollection<T> collection)
    {
        _collection = collection;
    }

    public int Count
    {
        get
        {
            return _collection.Count;
        }
    }

    public IEnumerator<T> GetEnumerator()
    {
        return (IEnumerator<T>)_collection.GetEnumerator();
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return (IEnumerator)((IEnumerable)_collection).GetEnumerator();
    }

    ////////Private data///////
    ICollection<T> _collection;
}

class Program
{
    static void Main(string[] args)
    {
        List<int> list = new List<int>();

        list.Add(1);
        list.Add(2);
        list.Add(3);
        list.Add(4);

        CollectionWrapper<int> collection = new CollectionWrapper<int>(list);

        Console.WriteLine("Count:{0}", collection.Count);
        foreach (var x in collection)
        {
            Console.WriteLine(x);
        }

        foreach (var x in (IEnumerable)collection)
        {
            Console.WriteLine(x);
        }
    }
} 
```

谢谢大家的建议。

**编辑：**现在不能通过向下转换为 List （或其他）来滥用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-05T11:15:08.427

听起来您真的只是想要[`ReadOnlyCollection<T>`](http://msdn.microsoft.com/en-us/library/ms132476.aspx)-将其公开为`IList<T>`，但是通过像这样包装原始列表，您只会得到一个具有适当计数的只读包装器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T10:48:02.583

IList 可以将 IsReadOnly 返回为 true，这会将集合标记为只读。除此之外，恐怕我不知道有什么合适的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-05T10:50:35.543

既然是接口，就得自己实现 Count 属性，为什么不新建一个继承 IEnumerator 的接口，加上一个 Count 属性呢？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T10:56:04.453

`IList`如果您想使用标准接口，或者`ICollection`将是要走的路。

请注意，如果您不希望接口所需的方法出现在类的公共接口中，则可以“隐藏”它们——例如，因为将内容添加到只读集合没有意义，您可以这样做：

```
void ICollection<DataType>.Add(DataType item)
{
    throw new NotSupportedException();
}

public DataType this[int index]
{
    get { return InnerList[index]; }
}

DataType IList<DataType>.this[int index]
{
    get { return this[index]; }
    set { throw new NotSupportedException(); }
} 
```

等等

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-05T10:49:35.670

如果您添加对 System.Linq 的引用（无论如何在 3.5 中），您可以使用扩展方法在 IEnumerable 上获得 .Count。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-05T11:04:25.233

可以将数组转换为 IList，这使得 IList ReadOnly == true :)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-05T13:19:31.357

正如 Jon Skeet 所提到的，最好使用 System.Collections.ObjectModel.ReadOnlyCollection 而不是创建自己的包装类。

然后您可以按如下方式实现您的示例：

```
class Program {
    static void Main(string[] args) {
        List<int> list = new List<int>();
        list.Add(1);
        list.Add(2);
        list.Add(3);
        list.Add(4);

        ReadOnlyCollection<int> collection = new ReadOnlyCollection<int>(list);
        Console.WriteLine("Count:{0}", collection.Count);
        foreach (var x in collection) {
            Console.WriteLine(x);
        }
        foreach (var x in (IEnumerable)collection) {
            Console.WriteLine(x);
        }
    }
} 
```

# c# - Richtextbox wpf 绑定

> ID：343468
> 
> 赞同：82
> 
> 时间：2008-12-05T10:48:02.350
> 
> 标签：c#, wpf, data-binding, richtextbox

要`Document`在 WPF 中进行 DataBinding，`RichtextBox`到目前为止，我看到了 2 个解决方案，它们是从 派生`RichtextBox`并添加 a `DependencyProperty`，以及带有“代理”的解决方案。

第一个或第二个都不令人满意。有人知道另一种解决方案，或者是能够进行**DataBinding**的商业 RTF 控件吗？正常`TextBox`不是替代方案，因为我们需要文本格式。

任何的想法？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2010-04-14T23:35:12.740

有一个更简单的方法！

您可以轻松创建附加`DocumentXaml`（或`DocumentRTF`）属性，该属性将允许您绑定`RichTextBox`'s 文档。它是这样使用`Autobiography`的，数据模型中的字符串属性在哪里：

```
<TextBox Text="{Binding FirstName}" />
<TextBox Text="{Binding LastName}" />
<RichTextBox local:RichTextBoxHelper.DocumentXaml="{Binding Autobiography}" /> 
```

瞧！完全可绑定的`RichTextBox`数据！

此属性的实现非常简单：设置属性后，将 XAML（或 RTF）加载到新的`FlowDocument`. 当`FlowDocument`发生变化时，更新属性值。

这段代码应该可以解决问题：

```
using System.IO;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Documents;
public class RichTextBoxHelper : DependencyObject
{
    public static string GetDocumentXaml(DependencyObject obj)
    {
        return (string)obj.GetValue(DocumentXamlProperty);
    }

    public static void SetDocumentXaml(DependencyObject obj, string value)
    {
        obj.SetValue(DocumentXamlProperty, value);
    }

    public static readonly DependencyProperty DocumentXamlProperty =
        DependencyProperty.RegisterAttached(
            "DocumentXaml",
            typeof(string),
            typeof(RichTextBoxHelper),
            new FrameworkPropertyMetadata
            {
                BindsTwoWayByDefault = true,
                PropertyChangedCallback = (obj, e) =>
                {
                    var richTextBox = (RichTextBox)obj;

                    // Parse the XAML to a document (or use XamlReader.Parse())
                    var xaml = GetDocumentXaml(richTextBox);
                    var doc = new FlowDocument();
                    var range = new TextRange(doc.ContentStart, doc.ContentEnd);

                    range.Load(new MemoryStream(Encoding.UTF8.GetBytes(xaml)),
                          DataFormats.Xaml);

                    // Set the document
                    richTextBox.Document = doc;

                    // When the document changes update the source
                    range.Changed += (obj2, e2) =>
                    {
                        if (richTextBox.Document == doc)
                        {
                            MemoryStream buffer = new MemoryStream();
                            range.Save(buffer, DataFormats.Xaml);
                            SetDocumentXaml(richTextBox,
                                Encoding.UTF8.GetString(buffer.ToArray()));
                        }
                    };
                }
            });
} 
```

相同的代码可用于 TextFormats.RTF 或 TextFormats.XamlPackage。对于 XamlPackage，您将拥有 type 的属性，`byte[]`而不是`string`.

与普通 XAML 相比，XamlPackage 格式具有多个优点，尤其是能够包含图像等资源，并且它比 RTF 更灵活且更易于使用。

很难相信这个问题持续了 15 个月，却没有人指出简单的方法。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2010-11-15T23:02:34.020

我知道这是一篇旧文章，但请查看[Extended WPF Toolkit](https://github.com/xceedsoftware/wpftoolkit)。它有一个 RichTextBox 支持你正在尝试做的事情。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-12-05T21:45:34.003

我可以给你一个好的解决方案，你可以接受它，但在我这样做之前，我将尝试解释为什么 Document*不是*一`DependencyProperty`开始的。

在`RichTextBox`控件的生命周期内，`Document`属性通常不会改变。用`RichTextBox`初始化`FlowDocument`。该文档已显示，可以通过多种方式进行编辑和修改，但该`Document`属性的基础值仍然是`FlowDocument`. 因此，它确实没有理由应该是`DependencyProperty`，即 Bindable。如果您有多个引用 this 的位置，则`FlowDocument`只需引用一次。由于它在任何地方都是相同的实例，因此每个人都可以访问更改。

我不认为`FlowDocument`支持文档更改通知，但我不确定。

话虽这么说，这里有一个解决方案。在开始之前，由于`RichTextBox`没有实现`INotifyPropertyChanged`且 Document 不是 a `DependencyProperty`，所以当 Document 的属性发生变化时我们没有通知`RichTextBox`，因此绑定只能是 OneWay。

创建一个将提供`FlowDocument`. 绑定需要 a 的存在`DependencyProperty`，所以这个类继承自`DependencyObject`。

```
class HasDocument : DependencyObject
{
    public static readonly DependencyProperty DocumentProperty =
        DependencyProperty.Register("Document", 
                                    typeof(FlowDocument), 
                                    typeof(HasDocument), 
                                    new PropertyMetadata(new PropertyChangedCallback(DocumentChanged)));

    private static void DocumentChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e)
    {
        Debug.WriteLine("Document has changed");
    }

    public FlowDocument Document
    {
        get { return GetValue(DocumentProperty) as FlowDocument; }
        set { SetValue(DocumentProperty, value); }
    }
} 
```

`Window`在 XAML 中使用富文本框创建一个。

```
<Window x:Class="samples.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Flow Document Binding" Height="300" Width="300"
    >
    <Grid>
      <RichTextBox Name="richTextBox" />
    </Grid>
</Window> 
```

给`Window`一个类型的字段`HasDocument`。

```
HasDocument hasDocument; 
```

窗口构造函数应该创建绑定。

```
hasDocument = new HasDocument();

InitializeComponent();

Binding b = new Binding("Document");
b.Source = richTextBox;
b.Mode = BindingMode.OneWay;
BindingOperations.SetBinding(hasDocument, HasDocument.DocumentProperty, b); 
```

如果您希望能够在 XAML 中声明绑定，则必须使您的`HasDocument`类派生自，`FrameworkElement`以便可以将其插入到逻辑树中。

现在，如果您要更改 上的`Document`属性`HasDocument`，富文本框`Document`也会更改。

```
FlowDocument d = new FlowDocument();
Paragraph g = new Paragraph();
Run a = new Run();
a.Text = "I showed this using a binding";
g.Inlines.Add(a);
d.Blocks.Add(g);

hasDocument.Document = d; 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-06-07T12:08:33.080

我已经稍微调整了以前的代码。首先 range.Changed 对我不起作用。在我将 range.Changed 更改为 richTextBox.TextChanged 后，事实证明 TextChanged 事件处理程序可以递归调用 SetDocumentXaml，因此我提供了针对它的保护。我还使用了 XamlReader/XamlWriter 而不是 TextRange。

```
public class RichTextBoxHelper : DependencyObject
{
    private static HashSet<Thread> _recursionProtection = new HashSet<Thread>();

    public static string GetDocumentXaml(DependencyObject obj)
    {
        return (string)obj.GetValue(DocumentXamlProperty);
    }

    public static void SetDocumentXaml(DependencyObject obj, string value)
    {
        _recursionProtection.Add(Thread.CurrentThread);
        obj.SetValue(DocumentXamlProperty, value);
        _recursionProtection.Remove(Thread.CurrentThread);
    }

    public static readonly DependencyProperty DocumentXamlProperty = DependencyProperty.RegisterAttached(
        "DocumentXaml", 
        typeof(string), 
        typeof(RichTextBoxHelper), 
        new FrameworkPropertyMetadata(
            "", 
            FrameworkPropertyMetadataOptions.AffectsRender | FrameworkPropertyMetadataOptions.BindsTwoWayByDefault,
            (obj, e) => {
                if (_recursionProtection.Contains(Thread.CurrentThread))
                    return;

                var richTextBox = (RichTextBox)obj;

                // Parse the XAML to a document (or use XamlReader.Parse())

                try
                {
                    var stream = new MemoryStream(Encoding.UTF8.GetBytes(GetDocumentXaml(richTextBox)));
                    var doc = (FlowDocument)XamlReader.Load(stream);

                    // Set the document
                    richTextBox.Document = doc;
                }
                catch (Exception)
                {
                    richTextBox.Document = new FlowDocument();
                }

                // When the document changes update the source
                richTextBox.TextChanged += (obj2, e2) =>
                {
                    RichTextBox richTextBox2 = obj2 as RichTextBox;
                    if (richTextBox2 != null)
                    {
                        SetDocumentXaml(richTextBox, XamlWriter.Save(richTextBox2.Document));
                    }
                };
            }
        )
    );
} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2017-11-01T12:11:46.543

```
 <RichTextBox>
     <FlowDocument PageHeight="180">
         <Paragraph>
             <Run Text="{Binding Text, Mode=TwoWay}"/>
          </Paragraph>
     </FlowDocument>
 </RichTextBox> 
```

这似乎是迄今为止最简单的方法，并且没有显示在任何这些答案中。

在视图模型中只有`Text`变量。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-12-05T13:50:28.343

创建一个 UserControl，它有一个名为 RTB 的 RichTextBox。现在添加以下依赖属性：

```
 public FlowDocument Document
    {
        get { return (FlowDocument)GetValue(DocumentProperty); }
        set { SetValue(DocumentProperty, value); }
    }

    public static readonly DependencyProperty DocumentProperty =
        DependencyProperty.Register("Document", typeof(FlowDocument), typeof(RichTextBoxControl), new PropertyMetadata(OnDocumentChanged));

    private static void OnDocumentChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        RichTextBoxControl control = (RichTextBoxControl) d;
        FlowDocument document = e.NewValue as FlowDocument;
        if (document  == null)
        {
            control.RTB.Document = new FlowDocument(); //Document is not amused by null :)
        }
        else
        {
            control.RTB.Document = document;
        }
    } 
```

该解决方案可能是您在某处看到的“代理”解决方案..但是.. RichTextBox 根本没有 Document 作为 DependencyProperty ...因此您必须以另一种方式执行此操作...

高温高压

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-02-21T15:35:45.500

[krzysztof的这个答案](https://stackoverflow.com/users/360374/krzysztof)[https://stackoverflow.com/a/2989277/3001007](https://stackoverflow.com/a/2989277/3001007)满足了我的大部分需求。但是该代码的一个问题（我面临的是），绑定不适用于多个控件。所以我改变了一个基于的实现。所以它也适用于同一窗口中的多个控件。`_recursionProtection``Guid`

```
 public class RichTextBoxHelper : DependencyObject
    {
        private static List<Guid> _recursionProtection = new List<Guid>();

        public static string GetDocumentXaml(DependencyObject obj)
        {
            return (string)obj.GetValue(DocumentXamlProperty);
        }

        public static void SetDocumentXaml(DependencyObject obj, string value)
        {
            var fw1 = (FrameworkElement)obj;
            if (fw1.Tag == null || (Guid)fw1.Tag == Guid.Empty)
                fw1.Tag = Guid.NewGuid();
            _recursionProtection.Add((Guid)fw1.Tag);
            obj.SetValue(DocumentXamlProperty, value);
            _recursionProtection.Remove((Guid)fw1.Tag);
        }

        public static readonly DependencyProperty DocumentXamlProperty = DependencyProperty.RegisterAttached(
            "DocumentXaml",
            typeof(string),
            typeof(RichTextBoxHelper),
            new FrameworkPropertyMetadata(
                "",
                FrameworkPropertyMetadataOptions.AffectsRender | FrameworkPropertyMetadataOptions.BindsTwoWayByDefault,
                (obj, e) =>
                {
                    var richTextBox = (RichTextBox)obj;
                    if (richTextBox.Tag != null && _recursionProtection.Contains((Guid)richTextBox.Tag))
                        return;

                    // Parse the XAML to a document (or use XamlReader.Parse())

                    try
                    {
                        string docXaml = GetDocumentXaml(richTextBox);
                        var stream = new MemoryStream(Encoding.UTF8.GetBytes(docXaml));
                        FlowDocument doc;
                        if (!string.IsNullOrEmpty(docXaml))
                        {
                            doc = (FlowDocument)XamlReader.Load(stream);
                        }
                        else
                        {
                            doc = new FlowDocument();
                        }

                        // Set the document
                        richTextBox.Document = doc;
                    }
                    catch (Exception)
                    {
                        richTextBox.Document = new FlowDocument();
                    }

                    // When the document changes update the source
                    richTextBox.TextChanged += (obj2, e2) =>
                        {
                            RichTextBox richTextBox2 = obj2 as RichTextBox;
                            if (richTextBox2 != null)
                            {
                                SetDocumentXaml(richTextBox, XamlWriter.Save(richTextBox2.Document));
                            }
                        };
                }
            )
        );
    } 
```

为了完整起见，让我从[ray-burns](https://stackoverflow.com/users/199245/ray-burns)的原始答案[https://stackoverflow.com/a/2641774/3001007](https://stackoverflow.com/a/2641774/3001007)添加几行。这是使用助手的方法。

```
<RichTextBox local:RichTextBoxHelper.DocumentXaml="{Binding Autobiography}" /> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-09-07T14:58:02.883

这是 Lolo 答案的 VB.Net 版本：

```
Public Class RichTextBoxHelper
Inherits DependencyObject

Private Shared _recursionProtection As New HashSet(Of System.Threading.Thread)()

Public Shared Function GetDocumentXaml(ByVal depObj As DependencyObject) As String
    Return DirectCast(depObj.GetValue(DocumentXamlProperty), String)
End Function

Public Shared Sub SetDocumentXaml(ByVal depObj As DependencyObject, ByVal value As String)
    _recursionProtection.Add(System.Threading.Thread.CurrentThread)
    depObj.SetValue(DocumentXamlProperty, value)
    _recursionProtection.Remove(System.Threading.Thread.CurrentThread)
End Sub

Public Shared ReadOnly DocumentXamlProperty As DependencyProperty = DependencyProperty.RegisterAttached("DocumentXaml", GetType(String), GetType(RichTextBoxHelper), New FrameworkPropertyMetadata("", FrameworkPropertyMetadataOptions.AffectsRender Or FrameworkPropertyMetadataOptions.BindsTwoWayByDefault, Sub(depObj, e)
                                                                                                                                                                                                                                                                                                                    RegisterIt(depObj, e)
                                                                                                                                                                                                                                                                                                                End Sub))

Private Shared Sub RegisterIt(ByVal depObj As System.Windows.DependencyObject, ByVal e As System.Windows.DependencyPropertyChangedEventArgs)
    If _recursionProtection.Contains(System.Threading.Thread.CurrentThread) Then
        Return
    End If
    Dim rtb As RichTextBox = DirectCast(depObj, RichTextBox)
    Try
        rtb.Document = Markup.XamlReader.Parse(GetDocumentXaml(rtb))
    Catch
        rtb.Document = New FlowDocument()
    End Try
    ' When the document changes update the source
    AddHandler rtb.TextChanged, AddressOf TextChanged
End Sub

Private Shared Sub TextChanged(ByVal sender As Object, ByVal e As TextChangedEventArgs)
    Dim rtb As RichTextBox = TryCast(sender, RichTextBox)
    If rtb IsNot Nothing Then
        SetDocumentXaml(sender, Markup.XamlWriter.Save(rtb.Document))
    End If
End Sub 
```

结束类

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-03-03T14:33:16.560

这是我基于 Ray Burns 回答的解决方案，其中包含 DataBinding 以及将 XAML 字符串转换为 RichTextBox 文档：

视图模型

```
 TestText = @"<FlowDocument xmlns=""http://schemas.microsoft.com/winfx/2006/xaml/presentation""><Paragraph><Bold>Hello World!</Bold></Paragraph></FlowDocument>"; 
```

看法

```
<RichTextBox local:RichTextBoxHelper.DocumentXaml="{Binding TestText}"/> 
```

富文本框助手

```
public class RichTextBoxHelper : DependencyObject
{
    public static string GetDocumentXaml(DependencyObject obj) { return (string) obj.GetValue(DocumentXamlProperty); }

    public static void SetDocumentXaml(DependencyObject obj,
                                       string value)
    {
        obj.SetValue(DocumentXamlProperty, value);
    }

    public static readonly DependencyProperty DocumentXamlProperty = DependencyProperty.RegisterAttached
    (
        "DocumentXaml",
        typeof(string),
        typeof(RichTextBoxHelper),
        new FrameworkPropertyMetadata
        {
            BindsTwoWayByDefault = true,
            PropertyChangedCallback = (obj,
                                       e) =>
            {
                var    richTextBox = (RichTextBox) obj;
                var    xaml        = GetDocumentXaml(richTextBox);
                Stream sm          = new MemoryStream(Encoding.UTF8.GetBytes(xaml));
                richTextBox.Document = (FlowDocument) XamlReader.Load(sm);
                sm.Close();
            }
        }
    );
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-09-09T09:47:02.090

这个 VB.Net 版本适用于我的情况。我删除了线程集合信号量，而不是使用 RemoveHandler 和 AddHandler。此外，由于 FlowDocument 一次只能绑定到一个 RichTextBox，因此我检查了 RichTextBox 的 IsLoaded=True。让我们从我如何在使用 ResourceDictionary 而不是 Window 的 MVVM 应用程序中使用该类开始。

```
 ' Loaded and Unloaded events seems to be the only way to initialize a control created from a Resource Dictionary
' Loading document here because Loaded is the last available event to create a document
Private Sub Rtb_Loaded(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs)
    ' only good place to initialize RichTextBox.Document with DependencyProperty
    Dim rtb As RichTextBox = DirectCast(sender, RichTextBox)
    Try
        rtb.Document = RichTextBoxHelper.GetDocumentXaml(rtb)
    Catch ex As Exception
        Debug.WriteLine("Rtb_Loaded: Message:" & ex.Message)
    End Try
End Sub

' Loaded and Unloaded events seems to be the only way to initialize a control created from a Resource Dictionary
' Free document being held by RichTextBox.Document by assigning New FlowDocument to RichTextBox.Document. Otherwise we'll see an of "Document belongs to another RichTextBox"
Private Sub Rtb_Unloaded(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs)
    Dim rtb As RichTextBox = DirectCast(sender, RichTextBox)
    Dim fd As New FlowDocument
    RichTextBoxHelper.SetDocumentXaml(rtb, fd)
    Try
        rtb.Document = fd
    Catch ex As Exception
        Debug.WriteLine("PoemDocument.PoemDocumentView.PoemRtb_Unloaded: Message:" & ex.Message)
    End Try
End Sub

Public Class RichTextBoxHelper
    Inherits DependencyObject

    Public Shared Function GetDocumentXaml(ByVal depObj As DependencyObject) As FlowDocument
        Return depObj.GetValue(DocumentXamlProperty)
    End Function

    Public Shared Sub SetDocumentXaml(ByVal depObj As DependencyObject, ByVal value As FlowDocument)
        depObj.SetValue(DocumentXamlProperty, value)
    End Sub

    Public Shared ReadOnly DocumentXamlProperty As DependencyProperty = DependencyProperty.RegisterAttached("DocumentXaml", GetType(FlowDocument), GetType(RichTextBoxHelper), New FrameworkPropertyMetadata(Nothing, FrameworkPropertyMetadataOptions.AffectsRender Or FrameworkPropertyMetadataOptions.BindsTwoWayByDefault, Sub(depObj, e)
                                                                                                                                                                                                                                                                                                                                   RegisterIt(depObj, e)
                                                                                                                                                                                                                                                                                                                               End Sub))

    Private Shared Sub RegisterIt(ByVal depObj As System.Windows.DependencyObject, ByVal e As System.Windows.DependencyPropertyChangedEventArgs)
        Dim rtb As RichTextBox = DirectCast(depObj, RichTextBox)
        If rtb.IsLoaded Then
            RemoveHandler rtb.TextChanged, AddressOf TextChanged
            Try
                rtb.Document = GetDocumentXaml(rtb)
            Catch ex As Exception
                Debug.WriteLine("RichTextBoxHelper.RegisterIt: ex:" & ex.Message)
                rtb.Document = New FlowDocument()
            End Try
            AddHandler rtb.TextChanged, AddressOf TextChanged
        Else
            Debug.WriteLine("RichTextBoxHelper: Unloaded control ignored:" & rtb.Name)
        End If
    End Sub

    ' When a RichTextBox Document changes, update the DependencyProperty so they're in sync.
    Private Shared Sub TextChanged(ByVal sender As Object, ByVal e As TextChangedEventArgs)
        Dim rtb As RichTextBox = TryCast(sender, RichTextBox)
        If rtb IsNot Nothing Then
            SetDocumentXaml(sender, rtb.Document)
        End If
    End Sub

End Class 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-09-20T11:48:12.570

伙计们，为什么要打扰所有的faff。这完美地工作。无需代码

```
<RichTextBox>
    <FlowDocument>
        <Paragraph>
            <Run Text="{Binding Mytextbinding}"/>
        </Paragraph>
    </FlowDocument>
</RichTextBox> 
```

# string - 我可以访问从 Delphi CreateProcess 命令返回的字符串吗？

> ID：343476
> 
> 赞同：1
> 
> 时间：2008-12-05T10:51:19.707
> 
> 标签：string, delphi, createprocess, delphi-5

我正在使用 Win32`CreateProcess`函数来执行对外部可执行文件的调用。可执行文件返回一个字符串。

有没有办法在调用可执行文件后捕获和询问返回的字符串？如果做不到这一点，我可能不得不将字符串写入可执行文件中的文件，并在调用完成后在调用程序中读取它。不过，这似乎很蹩脚。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-05T11:54:42.853

[Jedi 代码库](http://sourceforge.net/projects/jcl/ "绝地代码库")包含函数 CreateDOSProcessRedirected，它运行一个进程并为其提供输入和输出文件。您可以将所需的输入（如果有）放入输入文件，并从输出文件（在流程完成后）读取流程输出（如果有）。

这就是在[JCL](http://sourceforge.net/projects/jcl/ "绝地代码库")中实现的方式：

```
function CreateDOSProcessRedirected(const CommandLine, InputFile, OutputFile: string): Boolean;
var
  StartupInfo: TStartupInfo;
  ProcessInfo: TProcessInformation;
  SecAtrrs: TSecurityAttributes;
  hInputFile, hOutputFile: THandle;
begin
  Result := False;
  hInputFile := CreateFile(PChar(InputFile), GENERIC_READ, FILE_SHARE_READ,
    CreateInheritable(SecAtrrs), OPEN_EXISTING, FILE_ATTRIBUTE_TEMPORARY, 0);
  if hInputFile <> INVALID_HANDLE_VALUE then
  begin
    hOutputFile := CreateFile(PChar(OutPutFile), GENERIC_READ or GENERIC_WRITE,
      FILE_SHARE_READ, CreateInheritable(SecAtrrs), CREATE_ALWAYS,
      FILE_ATTRIBUTE_TEMPORARY, 0);
    if hOutputFile <> INVALID_HANDLE_VALUE then
    begin
      FillChar(StartupInfo, SizeOf(StartupInfo), #0);
      StartupInfo.cb := SizeOf(StartupInfo);
      StartupInfo.dwFlags := STARTF_USESHOWWINDOW or STARTF_USESTDHANDLES;
      StartupInfo.wShowWindow := SW_HIDE;
      StartupInfo.hStdOutput := hOutputFile;
      StartupInfo.hStdInput := hInputFile;
      Result := CreateProcess(nil, PChar(CommandLine), nil, nil, True,
        CREATE_NEW_CONSOLE or NORMAL_PRIORITY_CLASS, nil, nil, StartupInfo,
        ProcessInfo);
      if Result then
      begin
        WaitForSingleObject(ProcessInfo.hProcess, INFINITE);
        CloseHandle(ProcessInfo.hProcess);
        CloseHandle(ProcessInfo.hThread);
      end;
      CloseHandle(hOutputFile);
    end;
    CloseHandle(hInputFile);
  end;
end; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T11:28:38.943

假设您想捕获 exe 正在写入标准输出的内容，您可以使用

```
yourprog.exe > results.txt 
```

这会将输出写入`results.txt`，然后您可以对其进行读取和评估。

或者，您可以尝试[此线程](http://ubuntuforums.org/showthread.php?t=610271)中解释的方法：为生成的进程的输出创建一个管道并从中读取。第 7 篇文章有一个关于如何在 C++ 中使用相关 WinApi 函数的源示例，应该很容易转换为 Delphi。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T10:53:38.670

可执行文件如何*返回字符串*？我所知道的可执行文件可以返回的最多只是一个数字，即退出代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T10:56:47.900

您可以使用共享内存在两个应用程序之间进行通信。

您可以使用 Win32 CreateFileMapping 函数，也可以使用互斥锁来同步对内存映射文件的调用。

以下代码创建文件。

```
var
  fMapping : THandle;
  pMapData : Pointer;

fMapping := CreateFileMapping($FFFFFFFF, nil, PAGE_READWRITE,
             0, MAPFILESIZE, pchar('MAP NAME GOES HERE'));

PMapData := MapViewOfFile(fMapping, FILE_MAP_ALL_ACCESS, 0, 0, 0); 
```

以下代码关闭地图文件

```
if PMapData <> nil then
  UnMapViewOfFile(PMapData);
if fMapping <> 0 then
  CloseHandle(fMapping); 
```

# visual-studio - Visual Studio 中工作区的有效使用？

> ID：343479
> 
> 赞同：1
> 
> 时间：2008-12-05T10:52:21.263
> 
> 标签：visual-studio, workspace

我想知道在 Visual Studio 中使用工作区的最佳方式是什么。我们有 150 多个 Web 服务，它们都是同一个团队项目 $/MyTeamProject 的一部分，完全没有关联。它们都属于同一个团队项目的原因是它们都由我们组织内的同一组人员维护。

每个 Web 服务具有以下结构

```
$/MyTeamProject/WebService1
$/MyTeamProject/WebService1/Main
$/MyTeamProject/WebService1/Release/1.0
$/MyTeamProject/WebService1/Release/1.1

$/MyTeamProject/WebService2
$/MyTeamProject/WebService2/Main
... ETC。

```

我想知道在此设置中使用工作区的正确方法是什么，因为目前只有团队项目的映射，所以我所有的 web 服务都是同一个工作区的一部分。我应该为主分支和每个发布分支创建映射作为单独的工作区，还是应该将每个 Web 服务映射到它自己的工作区，例如 $/MyTeamProject/WebService1？

任何帮助，将不胜感激。

我不能将每个 Web 服务作为其自己的团队项目，因为 tfs 在具有相同项目规模的多个组之间共享，因此我们受到所有 Web 服务的自己的团队项目的限制。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T11:25:21.710

你说网络服务根本不相关。然后我假设它们是单独发布的。

我看不出有任何理由在您的场景中使用多个工作区。我建议您从顶级项目“MyTeamProject”中删除映射。然后，您可以灵活地将子文件夹映射到您想要的任何本地文件夹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T12:25:21.560

如果每个 Web 服务有一个工作区，那么您将获得 150*#releases 个工作区。这对于构建版本、标签等将变得非常难以管理。更少的工作空间将意味着更少的构建需要管理。

我建议每个版本都有一个工作区。通常，您可能一次只处理一个版本，这将允许您有效地管理单个版本的所有代码。然后，您还可以将客户端上的工作区映射到问题中提到的更合乎逻辑的结构。

例如

**\Projects\MyTeamProject\Main\WebService1**
**\Projects\MyTeamProject\Main\WebService2 ...**

**\Projects\MyTeamProject\Release1.0\WebService1**
**\Projects\MyTeamProject\Release1.0\WebService2 ...**

**\Projects\MyTeamProject\Release1.1\WebService1**
**\Projects\MyTeamProject\Release1.1\WebService2 ...**

**ETC**

# c++ - 使用 C++ 在 Mac 上使用智能卡对数据进行签名

> ID：343488
> 
> 赞同：1
> 
> 时间：2008-12-05T10:56:28.820
> 
> 标签：c++, macos, cryptography, smartcard

Mac OS X 中是否支持使用智能卡对数据进行签名？我查看了系统头文件，发现只有对智能卡支持的模糊引用（在 SecKeychain.h 中），这并没有真正带我去任何地方。

如果没有内置支持，我的选择是什么（即存在哪些免费/非免费库可以帮助我）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T21:45:58.493

[Apple-CDSA 邮件列表](http://lists.apple.com/mailman/listinfo/apple-cdsa "Apple-CDSA 邮件列表")可能是问这个问题的最佳地点；CDSA 代表通用数据安全架构，它包括 Mac OS X 上的所有安全/钥匙串/签名基础设施，包括对智能卡安全性的任何支持。

很多使用 CDSA 和从事 CDSA 工作的人都会在那里。可能还值得检查档案；有人可能已经做了你想做的事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-03T12:22:49.017

[MUSCLE](http://linuxnet.com)的东西还提供了一个 API、PKCS#11 模块等，并且可以在 OS X 上运行。

MUSCLE Framework 和 OpenSC 可能支持不同的卡，所以这取决于您使用的类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-24T06:42:38.943

我在这里回答我自己的问题，以供参考。[OpenSC](http://www.opensc-project.org/)库提供了处理智能卡所需的一切，它是跨平台的（Windows、Linux 和 Mac），它的许可证适用于商业项目。

# java - Java 同步轮询

> ID：343491
> 
> 赞同：0
> 
> 时间：2008-12-05T10:58:11.423
> 
> 标签：java, synchronization

这是我曾经看过的一些代码。你能看出它有什么问题吗？

[更新]

```
public class ResourceManager1
{
    private final String mutex = "";
    Object resource = null;

    public Object getResource()
    {
        synchronized (mutex)
        {
            if (resource == null)
            {
                resource = new Object();
            }
        }

        return resource;
    }
}

public class ResourceManager2
{
    private final String mutex = "";
    Object resource = null;

    public Object getResource()
    {
        synchronized (mutex)
        {
            if (resource == null)
            {
                resource = new Object();
            }
        }

        return resource;
    }
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-05T11:03:45.907

永远不要在字符串上同步，尤其是被实习的字符串文字。你基本上只有一个锁。

*通常，除非*外部可见性的目的正是为了锁定目的，否则永远不要同步任何可能在您的类之外可见的引用（包括“this”） 。我通常使用`private final`仅为锁定目的而创建的变量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T11:04:25.123

您使用相同的 String 作为两个类的互斥锁，因此一次只能使用一个同步块，这似乎不是代码的意图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T11:03:22.503

互斥锁不是最终的，资源不是私有的。

此外，您需要一个返回资源的 getResource 方法，但我想这只是一个错字。

# python - Pygame 能在图形方面做哪些 wxPython 做不到的事情？

> ID：343505
> 
> 赞同：16
> 
> 时间：2008-12-05T11:03:36.483
> 
> 标签：python, graphics, wxpython, pygame

我想用 Python 开发一个非常简单的 2D 游戏。Pygame 是 Python 中最流行的游戏开发库，但我已经对 wxPython 非常熟悉，并且使用它感觉很舒服。我什至在里面写了一个[俄罗斯方块克隆](http://eli.thegreenplace.net/2008/05/31/a-tetris-clone-in-python-wxpython/)，而且非常流畅。

我想知道，Pygame 在图形方面提供了哪些 wxPython 无法做到的（暂时不考虑声音）？在 Pygame 中做图形是否比在 wxPython 中更简单/更快？是不是更跨平台？

看起来我在这里遗漏了一些东西，但我不知道是什么。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-05T14:35:58.753

好吧，理论上你可以用 Pygame 做任何你不能用 wxPython 做的事情。关键不是什么，而是如何。在我看来，使用 PyGame 编写游戏更容易，因为：

*   它更快。Pygame 基于 SDL，这是一个专门为游戏设计的 C 库，它的开发考虑了速度。开发游戏时，您需要速度。

*   是一个游戏库，而不是通用画布，它具有对精灵、变换、输入处理、绘图、碰撞检测有用的类和函数。它还实现了游戏中常用的算法和技术，如脏矩形、翻页等。

*   有[成千上万的游戏](http://pygame.org/tags/)和用它制作的例子。你会更容易发现如何做任何技巧。

*   有很多[库](http://pygame.org/tags/libraries)具有可以重用的效果和实用程序。你想要一个等距游戏，有一个库，你想要一个物理引擎，有一个库，你什么很酷的视觉效果，有一个库。

*   [周刊](http://www.pyweek.org/)。:) 这是为了让您的游戏开发更加有趣！

对于像俄罗斯方块这样的非常简单的游戏，差异不会太大，但是如果你想开发一个相当复杂的游戏，相信我，你会想要像 PyGame 这样的东西。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-05T14:53:07.063

wxPython 基于[wxWidgets](http://wxwidgets.org/)，它是一个面向 GUI 的工具包。它的优点是使用运行它的系统提供的样式和装饰，因此很容易编写可移植的应用程序，很好地集成到您正在运行的任何外观和感觉中。你想要一个复选框？使用 wxCheckBox 和 wxPython 将处理外观和交互。

另一方面，pyGame 面向游戏开发，因此以 wxPython 所不具备的方式（也不需要，因为它调用操作系统来绘制其大部分控件）使您更接近硬件。pyGame 有许多与游戏相关的东西，例如碰撞检测、表面和层的细粒度控制或在您选择的时间翻转显示缓冲区。

也就是说，就图形而言，您可能总能找到一种方法来使用这两个工具包做您想做的事情。但是，当速度很重要，或者您希望以图形方式实现比俄罗斯方块更费力的游戏创意时，您可能更适合使用 pyGame。如果你想使用大量的 GUI 元素并且不需要花哨的图形和声音功能，你最好使用 wxPython。

便携性不是问题。两者都可用于三巨头（Linux、OSX、Windows）。

It's more a question of what kind of special capabilities you need, really.

# sql-server - SQL Server 中的系统进程

> ID：343513
> 
> 赞同：1
> 
> 时间：2008-12-05T11:04:46.653
> 
> 标签：sql-server

一些天真的质疑 sysprocesses 中的数字。我通过查看数字 cpu、physical_io、memusage 得出结论

这些数字中的任何一个总和是有限的吗？另外，我注意到当我运行查询时，状态变得“可运行”。当查询停止时，它变为“睡眠”。然而，资源使用的数字仍在上升 我还在消耗这些资源吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T20:36:28.367

直接来自[在线书籍](http://msdn.microsoft.com/en-us/library/aa260456(SQL.80).aspx)：

> cpu：进程的累积 CPU 时间。
> 
> physical_io：进程的累积磁盘读取和写入。

由于它们是累积的，因此它们不会加总。我相当肯定事情并没有改变（很多），因为[这篇](http://support.microsoft.com/kb/170360)文章他们将 cpu 定义为进程消耗的用户模式时间的毫秒数，而physical_io 定义为同步读取和写入。

> memusage：过程高速缓存中当前分配给该进程的页数。负数表示该进程正在释放由另一个进程分配的内存。

这是当前分配的数字，因此这确实是分配给该进程的实际页数。

由于数字是累积的，因此很难单独从 cpu 和physical_io 得出结论。虽然通常没有定论，但我个人只是在诊断问题时使用这些列来查找异常值。

# reporting-services - SQL Server Reporting Services - 报表维护工具

> ID：343514
> 
> 赞同：2
> 
> 时间：2008-12-05T11:05:09.240
> 
> 标签：reporting-services, release-management

直接从 Visual Studio 将新报告部署到报告服务器似乎很容易，但是当这些报告被推送到我们的网络场（开发人员无权访问）时，这需要手动完成，通过报告逐个报告，通过微软的Web 前端，或进入 MSI。

但是，有时我们可能希望重新配置报表服务器上的报表选项，例如更改所有报表的数据源或更改它们的缓存选项。与其为每组更改创建一个全新的 MSI 或手动执行此操作，我想知道是否有人知道任何替代工具可以一次更新多个报告，甚至能够将文件夹的内容部署到报告服务器上的文件夹中.

干杯，克里斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T17:01:32.203

对于管理员，rs.exe（[http://technet.microsoft.com/en-us/library/ms162839.aspx](http://technet.microsoft.com/en-us/library/ms162839.aspx)）允许通过 VBScript 进行远程脚本编写。如果可以授予 SOAP 访问权限，那么您应该能够完成所有您想要的，甚至更多，而无需求助于 MSI。

谢谢， Jamie Microsoft 报告服务 - 开发人员

# python - 如何使用 python 模块的多个 git 分支？

> ID：343517
> 
> 赞同：2
> 
> 时间：2008-12-05T11:06:01.843
> 
> 标签：python, git, module

我想使用 git 来处理我正在同时编写的模块中的多个功能。我目前正在使用 SVN，只有一个工作区，所以我的 PYTHONPATH 上只有一个工作区。我意识到这不太理想，所以我想知道是否有人可以提出一种更“正确”的方式来做到这一点。

让我用一个假设的情况来详细说明：我说我有一个模块“eggs”，带有子模块“foo”和“bar”。'bar' 中的组件使用 foo 中的代码，因此 eggs/bar/a.py 可能会“导入 egg.foo”。

假设“eggs”在 git 存储库中。我想尝试对“foo”进行一些更改，所以我复制了它。问题是eggs/bar 中的'import eggs.foo' 在PYTHONPATH 中找到了原始存储库，所以它最终使用旧的'foo' 而不是我修改过的。

我如何设置自己，使模块的每个副本都使用自己关联的“foo”？谢谢。

编辑-感谢指向相对导入的指针。我已经阅读了它，我可以看到如何应用它。我在使用它时遇到的一个问题是我已经建立了一个相当大的代码库，而且我对它并不太了解，所以大多数模块`if __name__ == '__main__':`在read 不使用相对导入：

*   [http://mail.python.org/pipermail/python-list/2006-October/408945.html](http://mail.python.org/pipermail/python-list/2006-October/408945.html)

*   [http://www.velocityreviews.com/forums/t502905-relative-import-broken.html](http://www.velocityreviews.com/forums/t502905-relative-import-broken.html)

我可以用谷歌搜索的另一个解决方案是故意操纵 sys.path，这似乎是一个更糟糕的黑客攻击。还有其他可能吗？

编辑 - 感谢您的建议。我最初误解了 git 分支，所以指出的分支正是我想要的。尽管如此，我之前没有听说过相对进口，所以也谢谢你。我学到了一些新东西，可能会结合它的用途。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T11:14:00.050

[相对导入](http://www.python.org/doc/2.5.2/tut/node8.html#SECTION008420000000000000000)（[PEP 328](http://www.python.org/dev/peps/pep-0328/)）可能会有所帮助：

```
eggs/
  __init__.py
  foo.py
  bar.py

# foo.py
from __future__ import absolute_import
from . import bar 
```

请参阅[如何组织 Python 模块？](https://stackoverflow.com/questions/171785/how-do-you-organize-python-modules)其他选项。

编辑：

另一种选择是使用 S.Lott 和 Jim 的建议，即重组你的包以分解出用于实验分支并用于工作的`eggs.foo`部分（参见`eggs.bar.a`Git [Community Book](http://book.git-scm.com/)）。`git`

这是一个例子：

```
$ git status
# On branch master
nothing to commit (working directory clean) 
```

[只是为了确保一切都好]

```
$ git checkout -b experimental
Switched to a new branch "experimental" 
```

[做实验的东西]

```
$ git commit -a 
```

[提交到实验分支]

```
$ git checkout master
Switched to branch "master" 
```

[在主分支上工作]

```
$ git commit -a 
```

要将更改合并到主分支：

```
$ git merge experimental 
```

请参阅上述书中的[基本分支和合并一章。](http://book.git-scm.com/3_basic_branching_and_merging.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T11:56:56.950

“假设我有一个模块‘eggs’，带有子模块‘foo’和‘bar’。‘bar’中的组件使用foo中的代码，所以eggs/bar/a.py可以‘import egg.foo’。”

这可能不是最好的结构。我建议您有一些其他模块难以摆脱。

你有`eggs.bar.a`依赖`eggs.foo`。我猜其他的东西`eggs`取决于`eggs.foo`. 此外，我怀疑`eggs.foo`可以将其划分为`eggs.foo`and `eggs.quux`，事情可能会更简单。

我建议重构它以获得更好的结构。这些`PYTHONPATH`问题是模块树中错误位置太多东西的症状。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T14:39:44.890

也许我没有正确理解，但似乎 git 会*是*这里的解决方案，因为 git 的分支不需要单独的路径。

为您的 egg 模块的每个工作版本创建一个分支。然后，当您签出该分支时，整个模块将更改为与您的子模块版本匹配的状态。然后，您可以在分支之间来回合并您需要的内容。

正如 S.Lott 指出的那样，可能进行一点重构也无妨；）

# windows - 找出正在运行的批处理文件的文件名

> ID：343518
> 
> 赞同：26
> 
> 时间：2008-12-05T11:06:04.153
> 
> 标签：windows, batch-file

在 Windows 批处理文件中，我想弄清楚这个批处理文件的完全限定路径名是什么。

我已经尝试过`%0`，但这确实只给了我输入的命令（例如，只是没有路径或扩展名的文件名）。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-05T13:32:50.020

供你参考，

您将需要启用命令扩展，这在 Win 2000 之前不存在（我不知道 NT4）

见：cmd.exe /？

```
/E:ON   Enable command extensions (see below)
/E:OFF  Disable command extensions (see below) 
```

Windows 上默认启用命令扩展。

我建议阅读的另一个帮助是 FOR 命令。它包含这些标志的完整含义。

见：`for /?`从`cmd`

```
In addition, substitution of FOR variable references has been enhanced.
You can now use the following optional syntax:

    %~I         - expands %I removing any surrounding quotes (")
    %~fI        - expands %I to a fully qualified path name
    %~dI        - expands %I to a drive letter only
    %~pI        - expands %I to a path only
    %~nI        - expands %I to a file name only
    %~xI        - expands %I to a file extension only
    %~sI        - expanded path contains short names only
    %~aI        - expands %I to file attributes of file
    %~tI        - expands %I to date/time of file
    %~zI        - expands %I to size of file
    %~$PATH:I   - searches the directories listed in the PATH
                   environment variable and expands %I to the
                   fully qualified name of the first one found.
                   If the environment variable name is not
                   defined or the file is not found by the
                   search, then this modifier expands to the
                   empty string

The modifiers can be combined to get compound results:

    %~dpI       - expands %I to a drive letter and path only
    %~nxI       - expands %I to a file name and extension only
    %~fsI       - expands %I to a full path name with short names only
    %~dp$PATH:I - searches the directories listed in the PATH
                   environment variable for %I and expands to the
                   drive letter and path of the first one found.
    %~ftzaI     - expands %I to a DIR like output line

In the above examples %I and PATH can be replaced by other valid
values.  The %~ syntax is terminated by a valid FOR variable name.
Picking upper case variable names like %I makes it more readable and
avoids confusion with the modifiers, which are not case sensitive. 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-12-05T13:25:13.280

```
echo %~f0 
```

为我工作。

查看`for /?`并`cmd`阅读有关变量替换的信息。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-05T11:12:56.510

`%CD%`给出当前目录。

`%~dp0`将为您提供脚本所在的目录。

IE: script in `c:\folder`，我把它从`c:\otherfolder`

`%CD%`=`C:\otherfolder`

`%~dp0`=`c:\folder`

（我 99% 确定我的方法是正确的，但没有窗户可以检查 atm）。

编辑：从那里，使用你已经得到的，你应该能够得到批处理文件名

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T14:20:21.840

```
%~f0 
```

```
%~dpnx0 
```

以上任何一个都给出了完全限定的路径。如果路径包含空格，请将其括在双引号中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-01-03T18:06:08.270

调用脚本`FIRST.BAT`：

```
call second.bat %0 parameter-a parameter-b 
```

调用脚本`SECOND.BAT`：

```
echo The name of this called script should be "SECOND", proof: %~n0
echo The 1st parameter passed should be "FIRST", proof: %1
shift
echo The name of the calling script should be "FIRST", proof: %~n0
echo The 1st parameter should be "parameter-a", proof: %1 
```

# msbuild - 将 NUnit-2.5 RequiresSTAAttribute 与 TeamCity 4 一起使用

> ID：343521
> 
> 赞同：2
> 
> 时间：2008-12-05T11:06:36.430
> 
> 标签：msbuild, nunit, teamcity, nunit-2.5, testautomationfx

使用 TeamCity，我试图获得一个需要 STA 线程才能运行的 (TestAutomationFX) 测试。

它通过配置 NUnit 2.4.x (8) 的自定义 app.config 工作（如 Gishu 所指，谢谢，描述于[http://madcoderspeak.blogspot.com/2008/12/getting-nunit-to-go-全站.html](http://madcoderspeak.blogspot.com/2008/12/getting-nunit-to-go-all-sta.html) )

它通过以下方式工作：

```
/// <summary>
/// Via Peter Provost / http://www.hedgate.net/articles/2007/01/08/instantiating-a-wpf-control-from-an-nunit-test/
/// </summary>
public static class CrossThreadTestRunner // To be replaced with (RequiresSTA) from NUnit 2.5
{
    public static void RunInSTA(Action userDelegate)
    {
        Exception lastException = null;

        Thread thread = new Thread(delegate()
          {
              try
              {
                  userDelegate();
              }
              catch (Exception e)
              {
                  lastException = e;
              }
          });
        thread.SetApartmentState(ApartmentState.STA);

        thread.Start();
        thread.Join();

        if (lastException != null)
            ThrowExceptionPreservingStack(lastException);
    }

    [ReflectionPermission(SecurityAction.Demand)]
    static void ThrowExceptionPreservingStack(Exception exception)
    {
        FieldInfo remoteStackTraceString = typeof(Exception).GetField(
          "_remoteStackTraceString",
          BindingFlags.Instance | BindingFlags.NonPublic);
        remoteStackTraceString.SetValue(exception, exception.StackTrace + Environment.NewLine);
        throw exception;
    }
} 
```

我希望使用内置的东西。所以 NUnit 2.5.0.8322（Beta 1）的 RequiresSTAAttribute 似乎很理想。它独立工作，但不能通过 TeamCity 工作，即使我试图通过以下方式强制解决问题：

```
<NUnit Assemblies="Test\bin\$(Configuration)\Test.exe" NUnitVersion="NUnit-2.5.0" /> 
```

文档说跑步者支持 2.5.0 alpha 4？（[http://www.jetbrains.net/confluence/display/TCD4/NUnit+for+MSBuild](http://www.jetbrains.net/confluence/display/TCD4/NUnit+for+MSBuild)）

可能回答了我自己的问题，2.5.0 Aplha 4 没有 RequiresSTAAttribute，因此跑步者不尊重我的属性......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T11:55:13.880

TeamCity 4.0.1 包含 NUnit 2.5.0 beta 2。我相信这应该适用于这种情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T11:13:07.760

你看看这是否有帮助？通过 .config 文件方法设置 STA ......就像在 NUnit 2.5 之前一样

[http://madcoderspeak.blogspot.com/2008/12/getting-nunit-to-go-all-sta.html](http://madcoderspeak.blogspot.com/2008/12/getting-nunit-to-go-all-sta.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T11:39:22.947

目前，我正在使用：

```
 private void ForceSTAIfNecessary(ThreadStart threadStart)
    {
        if (Thread.CurrentThread.GetApartmentState() == ApartmentState.STA)
            threadStart();
        else
            CrossThreadTestRunner.RunInSTA(threadStart);
    }

    [Test]
    public void TestRunApp()
    {
        ForceSTAIfNecessary(TestRunAppSTA);
    }

    public void TestRunAppSTA()
    {
        Assert.That(Thread.CurrentThread.GetApartmentState(), Is.EqualTo(ApartmentState.STA));
        ...
    } 
```

代替：

```
 [RequiresSTA]
    public void TestRunAppSTA()
    {
        Assert.That(Thread.CurrentThread.GetApartmentState(), Is.EqualTo(ApartmentState.STA));
        ...
    } 
```

# perl - 如何提取文本中的所有引用？

> ID：343528
> 
> 赞同：5
> 
> 时间：2008-12-05T11:11:14.300
> 
> 标签：perl, sed, grep, quotations

我正在寻找一个输出文本中所有引用的*SimpleGrepSedPerlOrPythonOneLiner 。*

* * *

示例 1：

```
echo “HAL,” noted Frank, “said that everything was going extremely well.” | SimpleGrepSedPerlOrPythonOneLiner 
```

标准输出：

```
"HAL,"
"said that everything was going extremely well.” 
```

* * *

示例 2：

```
cat MicrosoftWindowsXPEula.txt | SimpleGrepSedPerlOrPythonOneLiner 
```

标准输出：

```
"EULA"
"Software"
"Workstation Computer"
"Device"
"DRM" 
```

等等

（[链接到相应的文本](http://www.microsoft.com/windowsxp/eula/home.mspx)）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T13:32:44.607

我喜欢这个：

```
perl -ne 'print "$_\n" foreach /"((?>[^"\\]|\\+[^"]|\\(?:\\\\)*")*)"/g;' 
```

它有点冗长，但它比最简单的实现更好地处理转义引号和回溯。它的意思是：

```
my $re = qr{
   "               # Begin it with literal quote
   ( 
     (?>           # prevent backtracking once the alternation has been
                   # satisfied. It either agrees or it does not. This expression
                   # only needs one direction, or we fail out of the branch

         [^"\\]    # a character that is not a dquote or a backslash
     |   \\+       # OR if a backslash, then any number of backslashes followed by 
         [^"]      # something that is not a quote
     |   \\        # OR again a backslash
         (?>\\\\)* # followed by any number of *pairs* of backslashes (as units)
         "         # and a quote
     )*            # any number of *set* qualifying phrases
  )                # all batched up together
  "                # Ended by a literal quote
}x; 
```

如果你不需要那么大的力量——说它可能只是对话而不是结构化的引语，那么

```
/"([^"]*)"/ 
```

可能和其他任何东西一样有效。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T11:26:19.493

如果您有嵌套引号，则任何正则表达式解决方案都不起作用，但对于您的示例，这很好用

```
$ echo \"HAL,\" noted Frank, \"said that everything was going extremely well\"  
 | perl -n -e 'while (m/(".*?")/g) { print $1."\n"; }'
"HAL,"
"said that everything was going extremely well"

$ cat eula.txt| perl -n -e 'while (m/(".*?")/g) { print $1."\n"; }'
"EULA"
"online"
"Software"
"Workstation Computer"
"Device"
"multiplexing"
"DRM"
"Secure Content"
"DRM Software"
"Secure Content Owners"
"DRM Upgrades"
"WMFSDK"
"Not For Resale"
"NFR,"
"Academic Edition"
"AE,"
"Qualified Educational User."
"Exclusion of Incidental, Consequential and Certain Other Damages"
"Restricted Rights"
"Exclusion des dommages accessoires, indirects et de certains autres dommages"
"Consumer rights" 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T11:23:56.457

```
grep -o "\"[^\"]*\"" 
```

这 greps for `"`+ 除了引用之外的任何内容，任意次数 +`"`

-o 使它只输出匹配的文本，而不是整行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-31T11:19:53.100

```
grep -o '"[^"]*"' file 
```

> The option '-o' print only pattern

# algorithm - 算法 2D 参考翻译

> ID：343533
> 
> 赞同：1
> 
> 时间：2008-12-05T11:13:56.570
> 
> 标签：algorithm, math, referential

我正在尝试构建一个函数绘图器，

用户输入 xmin, xmax, ymin, ymax, 函数。我得到了所有点的x，y。

现在我想将此初始引用翻译为从 0,0 到 250,250 的画布。

有没有捷径，或者我应该检查一下

```
if x < 0 
new x = (x - xmin) * (250 / (xmax - xmin)) ? 
```

ETC ..

此外，这种基本方法不会优化采样。例如，如果我的函数 f(x) = 5 我不需要在 500 个点中对 xrange 进行采样，我只需要两个点。我可以做一些启发式检查。

但是对于像 sin(2/x) 这样的函数，我需要围绕 x (-1,1) 进行更多采样，你将如何处理这样的事情？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T17:39:29.613

不是在原始坐标中迭代 x，而是在画布上迭代，然后转换回原始坐标：

```
for (int xcanvas = 0; xcanvas <= 250; i++) {
    double x = ((xmax - xmin) * xcanvas / 250.0) + xmin;
    double y = f(x);

    int ycanvas = 250 * (y - ymin) / (ymax - ymin) + .5;

    // Plot (xcanvas, ycanvas)
} 
```

这为画布的每一列提供了一个函数评估。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T13:08:25.373

我想我会从从画布到数学上下文的转换开始对此进行推理。

```
(canvas_x, canvas_y) -> (maths_x, maths_y)
(maths_x, maths_y)   -> (canvas_x, canvas_y)

maths_x -> maths_y 
```

您遍历可显示的点，在 canvas_x 上循环。

这将转化为一些简单的功能：

```
maths_x = maths_x_from_canvas_x(canvas_x, min_maths_x, max_maths_x)
maths_y = maths_y_from_maths_x(maths_x) # this is the function to be plotted.
canvas_y = canvas_y_from_maths_y(maths_y, min_maths_y, max_maths_y)

if (canvas_y not out of bounds) plot(canvas_x, canvas_y) 
```

到了这里，把这些简单的函数写成代码就相对简单了。

从这里开始优化。

我认为对于这种方法，您不需要对采样频率了解太多，因为您以适合显示的速率进行采样。这不是最佳的 - 你的例子`y = 5`是一个很好的例子，但你可以保证不会采样超过你可以显示的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T12:40:15.583

1.  您可以估计导数（如果有的话）。
2.  您可以使用双向（二分法）方法：估计差异并在必要时拆分段。

# reporting - 从文件隐藏代码访问 rdlc 元素

> ID：343540
> 
> 赞同：1
> 
> 时间：2008-12-05T11:15:10.750
> 
> 标签：reporting

您能否提供任何示例代码以从代码隐藏文件中访问 rdlc 元素。

我在 rdlc 文件中有一个文本框，我必须从文件后面的代码中设置它的值。请帮我

谢谢

PS马里穆图

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-15T21:52:47.043

您可以使用 XDocument 或 XmlDocument 或任何您想要的方式将 RDLC 代码加载为 XML，然后根据需要相应地查询和更新文件，然后保存 RDLC。如果您想以这种方式以编程方式设置一个值，您可以定义一个隐藏的报表参数并使用 DOM 以同样的方式以编程方式更新该参数。

# delphi - 如何防止 Delphi ADO 将整个表加载到内存中？

> ID：343553
> 
> 赞同：8
> 
> 时间：2008-12-05T11:22:19.347
> 
> 标签：delphi, ado

我不是 Delphi 程序员，但我有一个旧的 Delphi 7 应用程序，我需要修复它，它正在使用 ADO。

数据库表（MS Accesss）包含 +100,000 行，当我设置 ADOTable.Active=true 时，它​​开始将整个表加载到 RAM 中，这需要大量内存和时间。

如何防止 ADO 加载整个表？我试图设置 MaxRecords 但它没有帮助。

基本上我们所做的就是 att 程序启动：

```
// Connect to database
DataModule.MyADOConnection.Connected:=true;

DataModule.MeasurementsADOTable.MaxRecords:=1;

// Open datatables
DataModule.MeasurementsADOTable.Active:=true; 
```

设置 Active=true 后，它开始将整个测量值加载到 RAM 中，这需要 TIME！

我们正在使用 MSDASQL.1 提供程序。也许它不支持 MaxRecords 属性？

如何在此数据对象中添加一些限制查询以仅“从测量中加载 TOP 1 *”？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T12:00:27.787

您可以使用 TADOQuery 通过 sql 查询来限制结果集。或者您可以使用 TADOTable 并将[CursorLocation](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate4/EN/html/delphivclwin32/ADODB_TCustomADODataSet_CursorLocation.html)设置为服务器端游标，以防止客户端将完整的结果集加载到内存中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T16:34:36.000

您可以将该 adoTable 与 Server OpenForwardOnly 游标和 TCLientDataset 一起使用，并将 PacketRecords 设置为非零值。当我不得不编写一个应用程序以自定义方式将数据从 MSSQL 泵送到 Oracle 时，我的工作非常出色，其中包含数百万条记录的表。

编辑->这将是这样的：

```
procedure ConfigCDSFromAdoQuery(p_ADOQ: TADOQuery; p_CDS: TClientDataset; p_Prov: TDatasetProvider);
begin
  If p_ADOQ.Active then p_ADOQ.Close;
  p_ADOQ.CursorLocation := clServer;
  p_ADOQ.CursorType := ctOpenForwardOnly;
  p_Prov.Dataset := p_ADOQ;
  p_CDS.SetProvider(p_Prov);
  p_CDS.PacketRecords := 100;
  p_CDS.Open; 
end ; 
```

我已经通过代码完成了这一切，但大部分你可以在设计时完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-13T10:58:27.257

本文是特定于 BDE 的，但适用于 ADO 或大多数客户端数据访问库。

[http://dn.codegear.com/article/28160](http://dn.codegear.com/article/28160)

我建议使用 TADODataSet（它比 TADOQuery“更接近”ADO 层）并通过提供自定义搜索表单（日期范围、特定项目列表等）仅选择客户端需要的数据

祝你好运

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-07T22:00:12.007

1.  在“MeasurementsADOTable”当前所在的数据模块上，删除一个 TADOQuery 并将其命名为“MeasurementsADOQuery”
2.  将 MeasurementsADOQuery 的 Connection 属性设置为 MyADOConnection（假设这是基于提供的小代码片段的情况。）
3.  我还假设您正在显示网格或以其他方式使用 DataSource - 将 DataSource 组件的“DataSet”属性从 MeasurementsADOTable 更改为 MeasurementsADOQuery
4.  通过设置 MeasurementsADOQuery 的 SQL 属性来编辑要执行的实际查询。（在打开前的运行时：Measurements.SQL.Text := 'select top 10 * from measurement order by whatever'）
5.  分析/将代码中的所有引用从 MeasurementsADOTable 更改为 MeasurementsADOQuery

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-25T18:05:06.810

不要在启动时使 adotable 处于活动状态，稍后将其变为 true 是一种方法，但仍然没有真正的帮助....使用 adodataset 并在运行时根据需要使用连接文本填充它。只会检索相关数据，使其更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-12-30T11:19:58.283

使用 adoquery 如果您不需要任何行而只想插入新行，请使用类似这样的 sql 命令 'select * from myTable where id=-1' 因为 Id 是自动编号，所以不会返回任何行。或 'select * from myTable where 1=-1' 但我认为这不是插入数据的好方法。使用 adocommand 肯定会好很多。

如果你想要 X 行 'select top X * from myTable'

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-13T10:06:33.133

我发现 ADO + Access w/Delphi 在很多事情上都非常缓慢（大表读取就像您所描述的那样，但也插入等）。我的回答变成了“完全停止使用 ADO 和 Access”。

从来不明白为什么它的表现如此糟糕，尤其是当早期的技术似乎不是这样的时候。

# dedicated-hosting - 共享专用 IP

> ID：343556
> 
> 赞同：0
> 
> 时间：2008-12-05T11:25:34.067
> 
> 标签：dedicated-hosting

我在一个 IP 上有 10 个网站。我想在所有网站之间共享 IP。如何在不必在不同端口号上运行这些网站的情况下实现这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T11:28:13.127

您使用 apache 网络服务器的“基于名称的虚拟主机”功能： [http](http://httpd.apache.org/docs/1.3/vhosts/) ://httpd.apache.org/docs/1.3/vhosts/ 其他网络服务器可能有也可能没有类似的功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T11:29:10.113

[IIS 的主机标头](http://www.google.co.uk/search?q=host+headers)。

# php - 如何区分命令行和 Web 服务器调用？

> ID：343557
> 
> 赞同：60
> 
> 时间：2008-12-05T11:25:53.927
> 
> 标签：php, command-line-interface

有没有办法区分脚本是从命令行调用还是由 Web 服务器调用的？

（**请参阅[什么是确定 PHP 脚本的命令行与 http 执行的规范方法？](https://stackoverflow.com/questions/173851/what-is-the-canonical-way-to-determine-commandline-vs-http-execution-of-a-php-s)以获得最佳答案**和更详细的讨论 - 在发布之前没有找到那个）

* * *

我有一个带有 Apache 2.2.10 和 PHP 5.2.6 的（非生产）服务器。在它上面，在一个网络可访问的目录中是我的 PHP 脚本，`maintenance_tasks.php`. 我想从命令行或通过 HTTP 请求（通过在浏览器中打开）调用此脚本。是否有一些变量可以让我可靠地确定脚本是如何被调用的？

（我已经解决了每种调用类型的不同视图和 HTTP 响应超时的问题，只是在寻找一种区分两种调用类型的方法）

我将尝试不同的事情并在下面添加我的发现。

**重复：** [确定 PHP 脚本的命令行与 http 执行的规范方法是什么？](https://stackoverflow.com/questions/173851/what-is-the-canonical-way-to-determine-commandline-vs-http-execution-of-a-php-s)

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-12-05T11:30:05.073

~~如果从命令行调用，则未设置服务器变量 HTTP_USER_AGENT。我使用这个常量来定义是否从命令行调用脚本：~~

 ~~```
define("CLI", !isset($_SERVER['HTTP_USER_AGENT'])); 
```~~  ~~**更新：**由于该答案仍被标记为“正确”答案，因此我想修改我的声明-依赖“User-Agent”标头可能会出现问题，因为它是用户定义的值。

请按照 Eugene/cam8001 在评论中的建议使用`php_sapi_name() == 'cli'`or 。`PHP_SAPI == 'cli'`

感谢您指出了这一点！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T11:36:16.150

我`$_SERVER`在两种调用中都比较了超全局。似乎`$_SERVER['argc']`（即传递给脚本的参数数量）仅在从 shell/命令行运行时设置：

```
<?php
if (isset($_SERVER['argc'])) {
    define('CLI', true);
} else {
    define('CLI', false);
} 
```

这似乎适用于 Linux 和 Windows 主机。（首先我考虑检查一些环境变量，但每个操作系统的环境变量都不同。此外，`$_SERVER['HTTP_*']`CLI 版本中缺少所有标头，但我不确定这是否足够可靠。）

# asp.net - 动态加载不同控件时加载视图状态失败

> ID：343558
> 
> 赞同：5
> 
> 时间：2008-12-05T11:26:05.500
> 
> 标签：asp.net, viewstate

我有一个aspx 页面，它在回发时动态加载一些控件（即当点击事件发生时）并将它们添加到占位符中。根据单击的内容，需要加载一组不同的控件。
这第一次完美运行，但是当我清除占位符的控件并尝试动态加载一组不同的控件时，我收到以下错误：“加载视图状态失败。正在加载视图状态的控件树必须与控件树匹配在上一个请求期间用于保存视图状态。”

即使我执行 ViewState.Clear()，也会发生这种情况。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T12:17:59.000

Yuriy Solodkyy 在这里很好地解释了它：[在 ASP.NET 中动态创建的控件](http://www.singingeels.com/Articles/Dynamically_Created_Controls_in_ASPNET.aspx)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-05T11:56:48.450

动态创建控件时，您必须确保创建的每个控件都有唯一的 ID。

我认为这里发生的事情是您将控件命名为：Control1、Control2、Control3。

也许当您单击创建一组不同的控件时，您可能会给不同类型的对象赋予相同的名称，比如说 Control1 最初是像文本框一样创建的，当您单击它时，它是一个复选框。

没有看到代码很难说出为什么 ViewState.Clear() 不起作用，但是如果您尝试清除不需要回发的视图状态，则可以尝试请求新页面并在查询字符串上传递参数的回发。这也会更快，因为您不必将 ViewState 信息发送回服务器。

# jquery - jQuery 选择器

> ID：343561
> 
> 赞同：2
> 
> 时间：2008-12-05T11:27:02.817
> 
> 标签：jquery

我想实现去父元素然后到上一个元素获取具有类的元素的属性ID：类名。

```
<div>

<span><span id="190" class="classname">blabla</span></span>

<span><a href="#" class="button">blabla</a></span>

</div> 
```

伪代码：

```
$('.button').click(function(){
 console.log($(this).parent().prev().$(".classname").attr("id"));
}); 
```

我必须在这里使用 find 还是有其他方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T11:50:00.850

对于您的示例：

```
$(this).parent().prev().children( '.classname' ).attr( 'id' ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-06T15:26:42.330

顺便说一句，id“190”是无效的，id和name属性必须以字母开头，而不是数字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T23:13:17.850

查找似乎是到达那里的最短途径....

```
alert($(this).parents("div").find(".classname").attr( 'id' )); 
```

或者

```
alert($(this).parents("div").find("span span").attr( 'id' )); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T11:37:23.840

我会`find`按照你的建议使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-23T14:01:12.460

也许您可以使用上下文功能，如下所示：

```
$('.button').click(function(){
    console.log( $('.classname', $(this).parent() ).attr('id') );
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-13T02:57:33.217

正如 Ivanfosson 所说，只有当您知道要搜索的元素在 DOM 下的有限步数或层数时，您才能使用他的建议，但如果`<div>`您放置的 div 与其他一些 div 相关，并且您也可以使用`find`然后执行

```
$(this).parent().prev().children( '.classname' ).attr( 'id' ); 
```

# sql - 在 sql (Firebird/MySql) 中更新/插入记录的正确/最快方法是什么

> ID：343562
> 
> 赞同：5
> 
> 时间：2008-12-05T11:27:44.687
> 
> 标签：sql, mysql, firebird, upsert

我需要一些 SQL 来更新数据库中的记录（如果存在）并在不存在时插入它，环顾四周似乎有几种解决方案，但我不知道什么是正确/可接受的方法来做到这一点。

理想情况下，我希望它可以在 Firebird 2 和 MySQL 5 上运行，因为需要对两个数据库运行更新，如果在两个数据库上运行相同的 SQL 会更简单，如果它可以在更多数据库上运行，那将是一个加号.

速度和可靠性也是考虑因素，在这种情况下可靠性超过速度，但它可能用于快速连续更新 1000 条记录（在不同的表上）。

有什么服从吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T15:12:41.410

在 Firebird 2.1 中，您可以使用[UPDATE OR INSERT](http://www.firebirdsql.org/refdocs/langrefupd25-update-or-insert.html)处理简单的情况，或者使用[MERGE](http://www.firebirdsql.org/refdocs/langrefupd21-merge.html)处理更复杂的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T11:51:59.020

你应该使用这样的东西：

```
BEGIN TRANSACTION
IF EXISTS (SELECT * FROM the_table WHERE pk = 'whatever')
    UPDATE the_table SET data = 'stuff' WHERE pk = 'whatever'
ELSE
    INSERT INTO the_table (pk, data) VALUES ('whatever', 'stuff')
COMMIT 
```

或者这个，但是单独发送它们并忽略来自 INSERT 的任何关于违反主键约束的错误：

```
INSERT INTO the_table (pk, data) VALUES ('whatever', 'stuff')

UPDATE the_table SET data = 'stuff' WHERE pk = 'whatever' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-24T20:06:52.887

在 2.1 之前的 firebird 中，您可以使用这种棘手的方法：

```
insert into table (id, a, b, c) values (:id, :a, :b, :c)
when SQLCODE -803 
do
begin
  update table set a = :a, b = :b, c = :c where id = :id;
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T11:36:09.960

对于 MySQL，请尝试以下`REPLACE`命令：[http ://dev.mysql.com/doc/refman/5.0/en/replace.html](http://dev.mysql.com/doc/refman/5.0/en/replace.html)

（有关 Firebird 的等价物，请参阅 Milan Babuskov 对此答案的评论。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T11:40:49.120

REPLACE 的工作方式与 INSERT 完全相同，只是如果表中的旧行与 PRIMARY KEY 或 UNIQUE 索引的新行具有相同的值，则在插入新行之前删除旧行。

句法 ：

替换 [LOW_PRIORITY | 延迟] [进入] tbl_name [(col_name,...)]

```
{ VALUES | VALUE} 

({expr | DEFAULT},...),(...),... 
```

鉴于：**使用约束时最好避免 REPLACE。**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T12:17:16.100

我在[MySQL](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html)中使用 INSERT来更新行：
`INSERT INTO table () VALUES () ON DUPLICATE KEY UPDATE key`
但是你不能使用自动生成的键。

# java - 制作一个简单的视频 - 未压缩，逐帧

> ID：343571
> 
> 赞同：4
> 
> 时间：2008-12-05T11:31:09.017
> 
> 标签：java, algorithm, video

我需要一种算法，将帧（图片）写入文件，该文件可以被一些视频切割/制作软件读取以使用。

所以我得到了框架，我想给它们一个函数/方法的输入。让我们用 Java 做 i。

我怎样才能做到这一点？有没有一种简单的方法，我可以在不使用任何系统编解码器的情况下编写视频文件？

我只需要一个具有恒定帧率（25 fps 或 50 fps）的未压缩视频，它将拍摄我的真彩色图片（二维颜色数组），以便我可以在我的 Videoprogramm 中使用该视频。

我从来没有找到任何适合的文件格式。

你能帮助我吗？

来自奥地利的问候，谢谢。弗洛。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T12:06:25.683

根据您要用于进一步处理电影的程序，您还可以简单地为单帧创建 PNG（或 TGA 或 BMP）。例如，VirtualDub 可以将图像用作电影的帧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T12:04:05.907

AVI 容器格式可以包含未压缩的视频流，其中有多种类型可供选择。[在http://fourcc.org/](http://fourcc.org/)上查看RGB 和 YUV 格式，在[http://www.alexander-noe.com/video/documentation/avi.pdf](http://www.alexander-noe.com/video/documentation/avi.pdf)上查看有关 AVI 文件格式的详细信息。

# database - 元数据库视图/数据集成

> ID：343573
> 
> 赞同：1
> 
> 时间：2008-12-05T11:32:38.623
> 
> 标签：database, database-design, data-integration

是否有（免费）工具或框架允许在多个数据后端定义视图（最好用于 java 和基于对象）？

例如我有 2 个数据库：一个数据库提供表或类（无关紧要）PersonX(name, address)，另一个提供 PersonY(name, dateOfBirth)

现在我想创建一个视图，将它们连接成`Person(name, address, dateOfBirth)`类似（伪代码）：

```
Person(n, a, dob) :=
    Couple(x.name, y.name) as n, x.address as a, y.dateOfBirth as dob From PersonX as x outer join PersonY as y on (x.name = y.name) 
```

但我不仅想要视图，我还希望能够对视图进行更新，这应该将更改委托回源。这里的“Couple”关键字应该意味着，字段 Persion.name 的更新应该委托给两个底层源。

因此，从我对数据集成的了解来看，这都是关于创建某种视图的，所以我的问题与此相关，但我在该主题上没有太多经验。

对此的任何帮助表示赞赏 - thx :)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T12:46:09.583

某些数据库（例如 Oracle）允许您在视图上创建“INSTEAD OF”触发器，将视图上的插入、更新和删除转换为基础表上的 DML。不涉及 Java，但这是一件好事，因为这意味着视图可以从任何应用程序中使用。

# visual-studio-2008 - 不处于调试模式时单元测试无法运行

> ID：343576
> 
> 赞同：6
> 
> 时间：2008-12-05T11:35:27.400
> 
> 标签：visual-studio-2008, unit-testing

我刚刚将我们的通用业务层项目从主分支分支到一个新分支，并将它们包含在一个新的解决方案中。一切都可以编译，但是当我运行单元测试时，每个测试都会出现以下错误...

> 单元测试适配器抛出异常：无法加载一种或多种请求的类型。检索 LoaderExceptions 属性以获取更多信息。

奇怪的是，当我调试它们时它们运行良好。仅当我在没有附加调试器的情况下运行它们时才会发生错误。

彻底修复失败，谁能告诉我如何“检索 LoaderExceptions 属性”？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-24T12:42:58.420

我也见过这种情况，有时当简单的清理没有帮助时，我将配置切换到 Release，清理它，然后回到 Debug，清理并重建（

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T04:57:44.110

我的通灵调试器说您使用的是 64 位，并且您的测试适配器设置为使用 64 位 .NET 框架，而 devenv 设置为 32 位。使用 corflags 强制您的测试适配器使用 32 位 CLR 运行。

注意：精神调试器并不总是 100% 准确，因为它使用了精神力量 :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-12T16:29:14.627

尝试清洁溶液并重试。

还可以尝试单击“测试结果”窗口黄色栏中显示的链接，这有时会提供有关无法运行测试的原因的更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-06T18:55:54.353

我确实遇到了同样的错误，并且清洁没有完成这项工作。

我通过进入 TestRunConfig 文件、代码覆盖率菜单并将正确的 SNK 文件放入“重新签名密钥文件”文本框中解决了这个问题。

希望这有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-07T10:06:21.913

I ran into the same problems without knowingly having changed anything, so what helped for me was to open the **Configuration Manager** (Build => Configuration Manager) and make sure that the solution and all its projects are set to **"Any CPU"**. Somehow some of them were set to "x86", after changing this back to "Any CPU" all tests run fine again in Debug and Release mode.

HTH

G.

# java - 如何从 JSP/Java 中的 double 中获取整数和小数部分？

> ID：343584
> 
> 赞同：110
> 
> 时间：2008-12-05T11:38:11.467
> 
> 标签：java, math, jsp

如何从 JSP/Java 中的 double 中获取整数和小数部分？如果值为 3.25，那么我想得到`fractional =.25`，`whole = 3`

我们如何在 Java 中做到这一点？

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2008-12-05T11:50:57.540

```
double value = 3.25;
double fractionalPart = value % 1;
double integralPart = value - fractionalPart; 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-12-05T12:15:39.223

[http://www.java2s.com/Code/Java/Data-Type/Obtainingtheintegerandfractionalparts.htm](http://www.java2s.com/Code/Java/Data-Type/Obtainingtheintegerandfractionalparts.htm)

```
double num;
long iPart;
double fPart;

// Get user input
num = 2.3d;
iPart = (long) num;
fPart = num - iPart;
System.out.println("Integer part = " + iPart);
System.out.println("Fractional part = " + fPart); 
```

输出：

```
Integer part = 2
Fractional part = 0.2999999999999998 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2010-02-13T13:20:14.013

由于这个 1 年前的问题是由更正问题主题的人提出的，并且这个问题被标记为`jsp`，这里没有人能够给出 JSP 目标答案，这是我的 JSP 目标贡献。

使用[JSTL](http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/)（只需将[jstl-1.2.jar](http://download.java.net/maven/1/jstl/jars/jstl-1.2.jar)放入`/WEB-INF/lib`）[fmt](http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/fmt/tld-summary.html) taglib。有一个标签可以在属性的帮助下[`<fmt:formatNumber>`](http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/fmt/formatNumber.html)以非常简单的方式完成您想要的操作。`maxFractionDigits``maxIntegerDigits`

这是一个[SSCCE](http://sscce.org)，只需复制'n'paste'n'运行它。

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>

<%
    // Just for quick prototyping. Don't do this in real! Use servlet/javabean.
    double d = 3.25;
    request.setAttribute("d", d);
%>

<!doctype html>
<html lang="en">
    <head>
        <title>SO question 343584</title>
    </head>
    <body>
        <p>Whole: <fmt:formatNumber value="${d}" maxFractionDigits="0" />
        <p>Fraction: <fmt:formatNumber value="${d}" maxIntegerDigits="0" />
    </body>
</html> 
```

输出：

> 整体：3
> 
> 分数：0.25

就是这样。无需借助原始 Java 代码对其进行按摩。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-05T11:44:38.787

最初的问题要求指数和尾数，而不是小数和整数部分。

要从 double 中获取指数和尾数，您可以将其转换为[IEEE 754](http://en.wikipedia.org/wiki/IEEE_754)表示并提取如下所示的位：

```
long bits = Double.doubleToLongBits(3.25);

boolean isNegative = (bits & 0x8000000000000000L) != 0; 
long exponent      = (bits & 0x7ff0000000000000L) >> 52;
long mantissa      =  bits & 0x000fffffffffffffL; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-05T12:05:27.887

IEEE 双浮点数的尾数和指数是这样的值

```
value = sign * (1 + mantissa) * pow(2, exponent) 
```

如果尾数的形式为 0.101010101_base 2（即其最高位移动到二进制点之后）并且指数针对偏差进行了调整。

从 1.6 开始，java.lang.Math 还提供了一种直接获取无偏指数的方法（称为 getExponent(double)）

但是，您要求的数字是数字的整数部分和小数部分，可以使用

```
integral = Math.floor(x)
fractional = x - Math.floor(x) 
```

尽管您可能希望以不同的方式处理负数`(floor(-3.5) == -4.0)`，具体取决于您想要这两个部分的原因。

我强烈建议您不要称这些尾数和指数。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-08-29T17:38:14.857

主要逻辑您必须首先找到小数点后有多少位。
此代码适用于最多 16 位的任何数字。如果您使用 BigDecimal，您最多可以运行 18 位数字。将输入值（您的数字）放入变量“num”，这里作为示例，我已经对其进行了硬编码。

```
double num, temp=0;
double frac,j=1;

num=1034.235;
// FOR THE FRACTION PART
do{
j=j*10;
temp= num*j;
}while((temp%10)!=0);       

j=j/10;
temp=(int)num;
frac=(num*j)-(temp*j);

System.out.println("Double number= "+num);      
System.out.println("Whole part= "+(int)num+" fraction part= "+(int)frac); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-10-09T23:07:49.873

不知道这是否更快，但我正在使用

```
float fp = ip % 1.0f; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-05T12:01:56.007

*[编辑：问题最初询问如何获得尾数和指数。]*

其中*n*是获得真实尾数/指数的数​​字：

```
exponent = int(log(n))
mantissa = n / 10^exponent 
```

或者，要获得您正在寻找的答案：

```
exponent = int(n)
mantissa = n - exponent 
```

这些不完全是 Java，但应该很容易转换。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-10-22T03:47:27.687

如果您的号码是 2.39999999999999，该怎么办。我想你想得到确切的十进制值。然后使用 BigDecimal：

```
Integer x,y,intPart;
BigDecimal bd,bdInt,bdDec;
bd = new BigDecimal("2.39999999999999");
intPart = bd.intValue();
bdInt = new BigDecimal(intPart);
bdDec = bd.subtract(bdInt);
System.out.println("Number : " + bd);
System.out.println("Whole number part : " + bdInt);
System.out.println("Decimal number part : " + bdDec); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-10T11:43:24.940

由于`fmt:formatNumber`标签并不总是产生正确的结果，这里是另一种仅限 JSP 的方法：它只是将数字格式化为字符串并在字符串上进行其余的计算，因为这更容易并且不涉及进一步的浮点算术。

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>

<%
  double[] numbers = { 0.0, 3.25, 3.75, 3.5, 2.5, -1.5, -2.5 };
  pageContext.setAttribute("numbers", numbers);
%>

<html>
  <body>
    <ul>
      <c:forEach var="n" items="${numbers}">
        <li>${n} = ${fn:substringBefore(n, ".")} + ${n - fn:substringBefore(n, ".")}</li>
      </c:forEach>
    </ul>
  </body>
</html> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-09-05T04:12:40.657

很多这些答案都有可怕的舍入错误，因为它们将数字从一种类型转换为另一种类型。怎么样：

```
double x=123.456;
double fractionalPart = x-Math.floor(x);
double wholePart = Math.floor(x); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-08-07T12:06:30.933

接受的答案不适用于 -0 和 -1.0 之间的负数。同时将小数部分设为负数。

例如：对于数字 -0,35

返回

整数部分 = 0 小数部分 = -0.35

如果您正在使用 GPS 坐标，则最好将整数部分的符号作为结果：

整数部分 = -0 小数部分 = 0.35

这些数字用于例如 GPS 坐标，其中纬度或经度位置的符号很重要

提议代码：

```
 double num;
    double iPart;
    double fPart;

    // Get user input
    num = -0.35d;
    iPart = (long) num;
    //Correct numbers between -0.0 and -1.0
    iPart = (num<=-0.0000001 && num>-1.0)? -iPart : iPart ;
    fPart = Math.abs(num - iPart);
    System.out.println(String.format("Integer part = %01.0f",iPart));
    System.out.println(String.format("Fractional part = %01.04f",fPart)); 
```

输出：

```
Integer part = -0
Fractional part = 0,3500 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-10-27T05:37:55.753

从 Java 8 开始，您可以使用`Math.floorDiv`.

`int`它返回小于或等于代数商的最大（最接近正无穷大）值。

一些例子：

```
floorDiv(4, 3) == 1
floorDiv(-4, 3) == -2 
```

或者，`/`可以使用运算符：

```
(4 / 3) == 1
(-4 / 3) == -1 
```

参考：

*   [Java 8：Math.floorDiv(int,int)](https://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#floorDiv-int-int-)
*   [Java 8：Math.floorDiv(long,long)](https://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#floorDiv-long-long-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-12-22T12:21:45.543

我会使用 BigDecimal 作为解决方案。像这样：

```
 double value = 3.25;
    BigDecimal wholeValue = BigDecimal.valueOf(value).setScale(0, BigDecimal.ROUND_DOWN);
    double fractionalValue = value - wholeValue.doubleValue(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-09-04T08:54:26.477

```
String value = "3.06";

if(!value.isEmpty()){
    if(value.contains(".")){    
        String block = value.substring(0,value.indexOf("."));
        System.out.println(block);
    }else{
        System.out.println(value);
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-06-19T21:11:16.010

好的，这可能为时已晚，但我认为最好和更准确的方法是使用 BigDecimal

```
double d = 11.38;

BigDecimal bigD = BigDecimal.valueOf(d);
int intPart = bigD.intValue();
double fractionalPart = bigD.subtract(BigDecimal.valueOf(intPart)).doubleValue();

System.out.println(intPart); // 11
System.out.println(fractionalPart ); //0.38 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2020-04-25T10:12:33.817

```
// target float point number
double d = 3.025;

// transfer the number to string
DecimalFormat df = new DecimalFormat();
df.setDecimalSeparatorAlwaysShown(false);
String format = df.format(d);

// split the number into two fragments
int dotIndex = format.indexOf(".");
int iPart = Integer.parseInt(format.substring(0, dotIndex)); // output: 3
double fPart = Double.parseDouble(format.substring(dotIndex)); // output: 0.025 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2009-04-06T11:31:09.797

```
public class MyMain2 {
    public static void main(String[] args) {
        double myDub;
        myDub=1234.5678;
        long myLong;
        myLong=(int)myDub;
        myDub=(myDub%1)*10000;
        int myInt=(int)myDub;
        System.out.println(myLong + "\n" + myInt);
    }
} 
```

# obfuscation - 小型供应商的软件保护

> ID：343586
> 
> 赞同：18
> 
> 时间：2008-12-05T11:38:31.373
> 
> 标签：obfuscation, protection, piracy, cracking

这是我们都必须在某个时候考虑的问题。

经过多年和许多方法之后，我倾向于总体上同意这样的说法：“对于任何数百人使用的受保护软件，您都可以找到破解版。到目前为止，每个保护方案都可以被篡改。” [您的雇主是否强制使用反盗版软件？](https://stackoverflow.com/questions/343017/does-your-employer-enforce-the-use-of-anti-piracy-software)

此外，每次我发布有关此主题的信息时，都会有人提醒我；“首先，无论你采用什么样的保护措施，一个真正敬业的饼干最终都会通过所有的保护屏障。” [对于单个开发人员来说，什么是最物有所值的 c# 代码保护](https://stackoverflow.com/questions/71146/whats-the-best-value-for-money-c-code-protection-for-a-single-developer)

因此，尽管有这两个广泛正确的免责声明，让我们谈谈“保护”！

我仍然觉得对于不太可能吸引熟练破解者的时间和注意力的小型应用程序，保护是一项值得的练习。

很明显，无论您做什么，如果破解者可以通过修补应用程序来切换 IF 语句 (jmp) 的结果，那么世界上所有的密码和加密狗都无济于事。

所以我的方法是使用以下产品通过虚拟化混淆代码： [http](http://www.oreans.com/codevirtualizer.php) ://www.oreans.com/codevirtualizer.php 我对这个产品非常满意。据我所知，它从未被击败过。我什至可以用 PEcompact 压缩可执行文件还有其他人有这方面的经验吗？

除了 EXEcryptor 的问题之外什么都没有 [http://www.strongbit.com/news.asp](http://www.strongbit.com/news.asp) 即使该网站使用起来也很头疼。编译的应用程序在执行任何 WMI 调用时都会崩溃。

这种方法允许您使用混淆来包围较小的代码部分，从而保护安全检查等。

我使用在线授权方法，因为应用程序需要定期从服务器获取数据，因此用户长时间离线使用它是没有意义的。根据定义，该应用程序在这一点上毫无价值，即使它已被破解。

所以一个简单的加密握手就足够了。我只是偶尔在混淆保护中检查它。如果用户在另一台机器上安装应用程序，则在启动时会上传新 ID，服务器会禁用旧 ID 并返回新授权。

我还使用已编译应用程序的哈希值，并在启动时检查它是否有任何更改，然后从应用程序内将应用程序作为文件（带有读取锁）打开，以防止任何人在启动后更改它。

由于所有静态字符串在 .exe 文件中都清晰可见，因此我尝试使用通用的错误消息等。您不会在任何地方找到字符串“授权失败”。

为了防止内存转储，我使用了一种简单的文本混淆技术（例如 XOR 每个字符）这使得内存中的纯文本数据更难与变量等区分开来。

当然，对于任何真正敏感的数据都有 AES。我喜欢文本的计数器模式，因为这不会导致重复序列显示底层数据（如一系列空白）。

但是使用所有这些技术，如果可以从内存中转储密钥或初始化向量，或者绕过 IF 语句，那么一切都被浪费了。

我倾向于使用 switch 语句而不是条件语句。然后我创建了第二个函数，它基本上是一个死胡同，而不是实际执行所需任务的函数。

另一个想法是编写添加了变量的指针。变量是授权的结果（通常为零）。这将不可避免地在某个时候导致 GPF。我只在一些较低级别的授权失败后才将其用作最后的手段，否则真正的用户可能会遇到它。然后，您的软件的声誉就会降低。

你使用什么技术？

（这不是一个讨论实现某事的优点的线程。它是为那些决定做某事的人设计的）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-05T12:21:13.283

我不同意 xsl。

我们保护我们的代码，不是因为我们想保护我们的收入——我们接受那些如果没有许可证就使用的人可能永远不会为此付费。

相反，我们这样做是为了保护客户对**我们****软件**的投资。我们相信，使用我们的软件使他们在市场上更具竞争力，并且如果其他公司无需付费就可以使用它，他们就有了不公平的优势——即，他们在没有许可成本开销的情况下变得具有竞争力。

 **我们非常小心地确保保护 - 这是自产的 - 对有效用户尽可能不显眼，为此，我们永远不会考虑“购买”可能影响这一点的现成解决方案。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-05T14:07:40.620

你不需要几百个用户来破解你的软件。我对我的共享软件被破解了这么多次感到恼火，所以作为一个实验，我创建了一个名为 Magic Textbox 的程序（它只是一个带有文本框的表单）并将其发布到共享软件站点（它有自己的 PAD 文件和所有内容） ）。一天后，Magic Textbox 的破解版面世。

这段经历让我几乎放弃了尝试用除了基本的复制保护之外的任何东西来保护我的软件。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-05T12:08:53.650

我个人使用[这里讨论](http://sleeksoft.co.uk/public/techblog/articles/20050621_1.html)的代码技术。这些技巧的好处是给盗版者带来不便，而不会让您的合法最终用户的生活更加困难

但更有趣的问题不是“什么”，而是“为什么”。在软件供应商开始此类练习之前，构建威胁模型非常重要。例如，低价 B2C 游戏的威胁与高价值 B2B 应用程序的威胁完全不同。

Patrick Mackenzie 有一篇很好的文章，他在其中[讨论了一些威胁](http://kalzumeus.com/2006/09/05/everything-you-need-to-know-about-registration-systems/)，包括对 4 种潜在客户的分析。我建议在选择保护您的业务模型之前对您自己的应用程序进行此威胁分析。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-05T15:08:06.237

我已经在自己之前实现了硬件键控（加密狗），所以我对这些问题并不完全陌生。事实上，我已经考虑了很多。我不同意任何违反版权法的人，就像你的饼干所做的那样。任何不想合法获取您的软件副本的人都应该这样做。我自己从不侵犯软件版权。话虽如此...

我真的非常不喜欢这里使用的“保护”这个词。你唯一想要保护的是*你的控制权*。你**没有**保护软件。无论哪种方式，该软件都很好，您的用户也一样。

阻止人们复制和共享您的软件是如此邪恶的 PITA 的原因是阻止此类活动是不自然的。计算机的整个概念围绕着复制数据，想要分享有用的东西是简单的人性。如果你真的坚持，你可以与这些事实作斗争，但这将是一场终生的斗争。上帝并没有让人类有任何不同，我也不会买一台不能复制东西的电脑。*也许找到一些与*计算机和人一起工作的方法会更好，而不是一直与他们对抗？

我和大多数专业软件开发人员一样，受雇于一家公司，该公司需要开发软件以便它能够开展业务，而不是让它能够拥有人为稀缺的“软件产品”来“出售”给用户。如果我写了一些通常有用的东西（这里不被认为是“竞争优势”），我们可以将它作为自由软件发布。不需要“保护”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-06T16:29:00.583

从一些链接：

我试图解释的概念就是我所说的“裂缝传播”。您的应用程序是否存在破解（或注册机，或盗版序列，或其他）并不重要。重要的是有多少人可以访问破解。

在哪里/何时检查序列号：我在启动时检查一次。很多人说“在各种地方检查”，以便通过剥离检查使某人更难破解。如果您想对破解者特别讨厌，请使用内联代码检查各种地方（即不要将其全部外部化到 SerialNumberVerifier.class 中），如果可能的话，使其成为多线程并且在失败时难以识别， 也。但这只是让破解变得更加困难，并非不可能，记住你的目标通常不是打败破解者。打败饼干不会让你赚到可观的钱。在大多数情况下，您只需要击败临时用户，而临时用户无权访问调试器，也不知道如何使用调试器。

如果你要打电话回家，你应该用他们的用户信息打电话回家并接受序列号作为服务器脚本的输出，而不是用序列号打电话回家并接受布尔值等作为输出。即您应该进行密钥注入，而不是密钥验证。密钥验证最终必须在应用程序中进行，这就是为什么公钥加密是最好的方法。原因是 Internet 连接也掌握在攻击者手中 :) 如果您的软件只是希望从 Internet 上读取布尔值，那么您是一个主机文件更改，远离一次中断、无处不在的漏洞利用。

不要做“有趣的”或“具有挑战性的”保护。许多饼干只为智力挑战而努力。使您的保护难以破解，但尽可能无聊。

有一些裂缝是寻找字节模式寻找修补的地方。它们通常不会被重新编译打败，但是如果你的 .EXE 被打包（通过 ASProtect、Armadillo 等），这些破解必须首先解压 .EXE。将能够使用诸如 SoftICE 之类的汇编级调试器手动解压缩 EXE，但无法创建自动解压缩 .EXE 的工具（以在之后应用字节补丁）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-05T14:23:17.170

我过去使用过 .NET Reactor，效果很好 - [http://www.eziriz.com/](http://www.eziriz.com/)

我喜欢这个产品的地方是它不需要你混淆代码来获得很好的保护。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-06T15:41:50.163

xsl，这是一个非常狭窄的观点，其中包含许多内置假设。

在我看来，任何依赖于从您控制的服务器提供某些东西的应用程序都应该能够很好地确定我们谁拥有有效帐户！

我也相信定期更新（意味着新编译的应用程序在不同位置的代码）将使破解的版本很快过时。如果您的应用程序与服务器通信，那么每周启动一个辅助进程来替换主可执行文件是小菜一碟。

所以是的，没有什么是不可破解的，但是通过一些巧妙的内在设计，它成为一个有争议的问题。唯一重要的因素是饼干愿意花多少时间在上面，以及您的潜在客户愿意付出多少努力来尝试每周甚至每天寻找他们努力的产品！

我怀疑如果您的应用程序提供了有用的有价值的功能，那么他们将愿意为此付出合理的代价。否则，竞争产品将进入市场，您的问题就会自行解决。

# asp.net - 为什么将 ClientID 传递给 javascript 函数会传递整个控件？

> ID：343588
> 
> 赞同：1
> 
> 时间：2008-12-05T11:39:13.820
> 
> 标签：asp.net, javascript, internet-explorer-7

如果我将 ClientID 作为参数传递给 javascript 函数而不包括其周围的单引号，它将作为对控件本身的引用传递，然后可以在不首先调用 getElementByID 的情况下使用它。

我在任何地方都找不到这种行为，这是浏览器特定的东西还是 .net 的东西还是什么？

我正在代码隐藏中设置这样的调用......

```
protected void Page_Load(object sender, EventArgs e)
        {
            Button1.Attributes.Add("onClick", string.Format("showvalue({0})",  TextBox1.ClientID));
        } 
```

我担心这可能不适用于旧版本的 IE。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T11:49:02.583

生成 JS 代码时在 ID 值周围添加引号，例如：string.Format("showvalue( **'** {0} **'** )", TextBox1.ClientID)

如果没有引号，showValue 会使用您的 ClientID 名称获取全局变量的实例，该名称通常是您的控件呈现的 DOM 元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T11:45:46.163

如果你用单引号传递它并使用 getElementByID 它应该在所有浏览器中都可以工作，这是“正常”的方式。

我不确定为什么这种方法像你说的那样有效。它也适用于 Firefox 吗？

# c# - 如何验证对象的内部状态？

> ID：343605
> 
> 赞同：7
> 
> 时间：2008-12-05T11:52:38.130
> 
> 标签：c#, c++, validation, invariants

我很想听听您在操作期间使用什么技术来验证对象的内部状态，从它自己的角度来看，这些技术只会因为内部状态不好或不变的破坏而失败。

我的主要关注点是 C++，因为在 C# 中，官方和流行的方法是抛出异常，而在 C++ 中并没有*唯一*的方法可以做到这一点（好吧，在 C# 中也不是，我知道）。

请注意，我**不是**在谈论函数参数验证，而是更像是类不变完整性检查。

例如，假设我们想要一个`Printer`对象`Queue`异步打印作业。对于 的用户`Printer`，该操作只能成功，因为异步队列结果在另一个时间到达。因此，没有相关的错误代码可以传达给调用者。

但是对于`Printer`对象而言，如果内部状态不好，即类不变量被破坏，则此操作可能会失败，这基本上意味着：一个错误。该条件不一定对`Printer`对象的用户有任何兴趣。

就个人而言，我倾向于混合三种内部状态验证风格，我无法真正决定哪一种是最好的，如果有的话，只能确定哪一种绝对是最差的。我想听听你对这些的看法，也想听听你在这件事上分享你自己的经验和想法。

我使用的第一种风格 - 以可控的方式失败比损坏数据更好：

```
void Printer::Queue(const PrintJob& job)
{
    // Validate the state in both release and debug builds.
    // Never proceed with the queuing in a bad state.
    if(!IsValidState())
    {
        throw InvalidOperationException();
    }

    // Continue with queuing, parameter checking, etc.
    // Internal state is guaranteed to be good.
} 
```

我使用的第二种风格 - 比损坏的数据更好的崩溃无法控制：

```
void Printer::Queue(const PrintJob& job)
{
    // Validate the state in debug builds only.
    // Break into the debugger in debug builds.
    // Always proceed with the queuing, also in a bad state.
    DebugAssert(IsValidState());

    // Continue with queuing, parameter checking, etc.
    // Generally, behavior is now undefined, because of bad internal state.
    // But, specifically, this often means an access violation when
    // a NULL pointer is dereferenced, or something similar, and that crash will
    // generate a dump file that can be used to find the error cause during
    // testing before shipping the product.
} 
```

我使用的第三种风格 - 比损坏的数据更好地静默和防御性地纾困：

```
void Printer::Queue(const PrintJob& job)
{
    // Validate the state in both release and debug builds.
    // Break into the debugger in debug builds.
    // Never proceed with the queuing in a bad state.
    // This object will likely never again succeed in queuing anything.
    if(!IsValidState())
    {
        DebugBreak();
        return;
    }

    // Continue with defenestration.
    // Internal state is guaranteed to be good.
} 
```

我对样式的评论：

1.  我认为我更喜欢第二种风格，其中不隐藏故障，前提是访问冲突实际上会导致崩溃。
2.  如果它不是不变量中涉及的 NULL 指针，那么我倾向于倾向于第一种样式。
3.  我真的不喜欢第三种风格，因为它会隐藏很多错误，但我知道有人更喜欢在生产代码中使用它，因为它会产生一种不会崩溃的强大软件的错觉（功能只会停止运行，如损坏`Printer`对象上的排队）。

您更喜欢其中的任何一个，还是有其他方法可以实现这一目标？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T12:05:24.767

您可以将一种称为 NVI（*非虚拟接口*）的技术与该`template method`模式一起使用。这可能就是我会做的事情（当然，这只是我个人的看法，这确实值得商榷）：

```
class Printer {
public:
    // checks invariant, and calls the actual queuing
    void Queue(const PrintJob&);
private:
    virtual void DoQueue(const PringJob&);
};

void Printer::Queue(const PrintJob& job) // not virtual
{
    // Validate the state in both release and debug builds.
    // Never proceed with the queuing in a bad state.
    if(!IsValidState()) {
        throw std::logic_error("Printer not ready");
    }

    // call virtual method DoQueue which does the job
    DoQueue(job);
}

void Printer::DoQueue(const PrintJob& job) // virtual
{
    // Do the actual Queuing. State is guaranteed to be valid.
} 
```

因为`Queue`是非虚拟的，所以如果派生类重写`DoQueue`以进行特殊处理，仍然会检查不变量。

* * *

供您选择：我认为这取决于您要检查的条件。

*如果是内部不变量*

> 如果它是一个不变量，那么您的类的用户应该不可能违反它。类应该关心它的不变量本身。因此，我会`assert(CheckInvariant());`在这种情况下。

*它只是一个方法的前提条件*

> 如果这只是类用户必须保证的前提条件（例如，仅在打印机准备好后打印），我会 `std::logic_error`如上所示抛出。

我真的不鼓励检查条件，但什么也不做。

* * *

类的用户可以在调用一个方法之前断言它的先决条件得到满足。所以一般来说，如果一个类对某个状态负责，并且它发现一个状态是无效的，它应该断言。如果该类发现违反了不属于其责任的条件，则应该抛出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T12:13:03.643

最好结合您如何测试您的软件来考虑这个问题。

重要的是，在测试期间遇到损坏的不变量将作为高严重性错误提交，就像崩溃一样。可以在开发期间进行测试构建以停止死机并输出诊断信息。

添加防御性代码可能是合适的，就像您的风格 3：您`DebugBreak`将在测试构建中转储诊断，但对于开发人员来说只是一个断点。这降低了开发人员因不相关代码中的错误而无法工作的情况。

可悲的是，我经常看到它以相反的方式进行，开发人员会遇到所有不便，但测试构建会通过损坏的不变量。许多奇怪的行为错误被提交，实际上一个错误是原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T13:21:37.343

这是一个很好且非常相关的问题。恕我直言，任何应用程序架构都应该提供一种策略来报告损坏的不变量。可以决定使用异常，使用“错误注册表”对象，或者明确检查任何操作的结果。也许还有其他策略——那不是重点。

依赖于一个可能很大的崩溃是一个坏主意：如果你不知道不变破坏的原因，你不能保证应用程序会崩溃。如果没有，您仍然有损坏的数据。

来自 litb的[NonVirtual Interface](https://stackoverflow.com/questions/343605/how-do-you-validate-an-objects-internal-state#343628)解决方案是一种检查不变量的巧妙方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T17:09:40.237

棘手的问题：）

就我个人而言，我倾向于抛出一个异常，因为在实现某些东西时我通常会过多地关注我正在做的事情来处理你的设计应该注意的事情。通常这会回来并稍后咬我......

我对“做一些记录，然后不再做任何事情”策略的个人经验是，它也会反过来咬你 - 特别是如果它像你的情况那样实施（没有全球策略，每个班级都可能以不同的方式做到这一点）。

一旦我发现这样的问题，我会做的就是与团队的其他成员交谈，并告诉他们我们需要某种全局错误处理。处理将做什么取决于您的产品（您不希望什么都不做，并将某些内容记录在空中交通管制系统中的一个微妙的开发人员意识文件中，但如果您正在制作驱动程序，它会工作得很好，比如说，一台打印机:) )。

我想我说的是，恕我直言，这个问题是您应该在应用程序的设计级别而不是在实现级别解决的问题。- 可悲的是没有神奇的解决方案:(

# java - Struts 1.3：如何在 Web 应用程序中设置默认语言环境？

> ID：343609
> 
> 赞同：0
> 
> 时间：2008-12-05T11:54:09.967
> 
> 标签：java, locale, struts-1

我的 struts 应用程序中有两个或三个 i18n 文件。我可以通过`Global.LOCALE_KEY`在会话中设置变量来在这些之间切换。

有没有办法为应用程序设置默认语言环境（我猜可能在 struts-config.xml 文件中）？会话是设置语言环境的唯一地方吗？

当然，我可以拦截对第一页的调用并在会话中设置变量，但这更麻烦。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T12:13:46.497

在您的 web.xml 中，您可以定义一个上下文参数：

```
<context-param>
    <param-name>LOCALE</param-name>
    <param-value>en-GB</param-value>
</context-param> 
```

然后在您的网络应用程序中预先：

```
java.util.Enumeration<String> setout = servletContext.getInitParameterNames();
while (setout.hasMoreElements()) {
    String paramName = setout.nextElement();
    configProperties.put(paramName, servletContext.getInitParameter(paramName));
} 
```

尽管您必须更改该属性行以将其粘贴在会话上。您可能需要破解一个像这样进行预初始化的 ActionComponentServlet 版本。

可能有更好的方法来做到这一点，这只是我继承的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-04-27T01:34:27.170

如果要在创建会话时设置会话，可以使用 HttpSessionListener。为每个新会话设置默认区域设置如下所示：

```
package com.mycompany.web.session;
import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionListener;
import org.apache.struts.Globals;

public class LocaleController implements HttpSessionListener {

    private static Locale defaultLocale = locale.ENGLISH;

    @Override
    public void sessionCreated(HttpSessionEvent event) {
        event.getSession().setAttribute(Globals.LOCALE_KEY, defaultLocale);
    }

    @Override
    public void sessionDestroyed(HttpSessionEvent event) {
    }
} 
```

然后将此元素添加到 web.xml 文件中：

```
<listener>
    <listener-class>com.mycompany.web.session.LocaleController</listener-class>
</listener> 
```

或者您可以通过 ServletContext.addListener 方法“以编程方式”添加它

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T12:27:40.537

嗯，我终于通过编写 Java 代码而不是使用 struts-config.xml 解决了这个问题。

我创建了一个上下文侦听器来设置 Struts 类中静态字段的值。

看到这个问题：[Is there a way to run a method/class only on tomcat startup?](https://stackoverflow.com/questions/158336/is-there-a-way-to-run-a-methodclass-only-on-tomcat-startup)

```
import javax.servlet.ServletContext;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;

public class AppContextListener implements ServletContextListener {
    @Override
    public void contextDestroyed(ServletContextEvent event) { /* empty. */ }

    @Override
    public void contextInitialized(ServletContextEvent event) {
        /*
         * Default locale
         */
        ServletContext sc = event.getServletContext();
        sc.setAttribute(org.apache.struts.Globals.LOCALE_KEY, "pt_BR");
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-14T23:11:19.460

如果您只需要选择一个资源文件作为默认值，只需省略文件名中的语言代码：

```
Texts_en_GB.properties
Texts_pt_BR.properties
Texts.propertiers ( <-- this one will be selected when no resources for requested language could be found) 
```

**编辑：**`mode`如果您在默认模式下定义消息（如果您省略该属性 ，则会选择该模式），则 Struts 1.x 中存在一个关于默认消息处理的错误：

```
<message-resources key="Texts" parameter="com.mycompany.Texts" null="false"/> 
```

并且默认语言环境与没有后缀的属性中的语言不同：`Texts.properties`.

假设我们的`Texts.properties`文件将包含英文文本。另外还有德语翻译：`Texts_de.properties`. 我们的默认系统语言环境是法语，因为我们在法语服务器上运行（并且我们没有明确设置它）。

如果您在服务器启动后的第一个请求请求页面的德语翻译，并且如果所请求的语言代码没有明确的属性文件，则同一页面的所有后续请求都将以德语提供。

如果第一个请求要求一个英文页面，并且如果没有针对所请求语言代码的显式属性文件（这是我们想要的），则同一页面的每个后续请求都将以英文提供。

这个问题的解决方案是为每个消息资源声明设置 mode 属性：

```
<message-resources key="Texts" parameter="com.mycompany.Texts" null="false">
    <set-property key="mode" value="JSTL" />
</message-resources> 
```

# python - 如何提交仅给定 HTML 源的表单？

> ID：343622
> 
> 赞同：0
> 
> 时间：2008-12-05T12:02:54.363
> 
> 标签：python, django, testing, parsing, form-submit

我希望能够在**HTML 源代码（字符串）**中提交表单。换句话说，我至少需要能够**从包含表单的 HTML 源的字符串**生成 POST 参数。这在 Django 项目的单元测试中是必需的。我想要一个可能的解决方案；

*   仅使用标准 Python 库和 Django。
*   如果存在多个表单，则允许从特定表单生成参数。
*   允许我在提交之前更改值。

从给定表单类返回（Django）表单实例的解决方案是最好的。因为它可以让我使用验证。理想情况下，它会使用源（它是一个字符串）、一个表单类和可选的表单名称，并返回呈现之前的实例。

注意：我知道这不是一件容易的事，而且可能收益很难证明所需要的努力是合理的。但我只是好奇如何以一种实用且可靠的方式做到这一点。如果可能的话。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T22:08:09.743

您应该重新阅读[有关 Django 测试框架的文档，特别是有关使用](http://docs.djangoproject.com/en/dev/topics/testing/)[测试客户端](http://docs.djangoproject.com/en/dev/topics/testing/#module-django.test.client)测试视图（和表单）的部分。

测试客户端充当一个简单的 Web 浏览器，并允许您向 Django 视图发出`GET`和`POST`请求。您可以阅读响应 HTML 或获取`Context`模板收到的相同对象。您的对象应该包含您正在寻找`Context`的实际实例。`forms.Form`

例如，如果您在 URL 上的视图`/form/`将上下文传递`{'myform': forms.Form()}`给模板，您可以通过以下方式获取它：

```
from django.test.client import Client
c = Client()

# request the web page:
response = c.get('/form/')

# get the Form object:
form = response.context['myform']

form_data = form.cleaned_data
my_form_data = {} # put your filled-out data in here...
form_data.update(my_form_data)

# submit the form back to the web page:
new_form = forms.Form(form_data)
if new_form.is_valid():
    c.post('/form/', new_form.cleaned_data) 
```

希望这可以实现您想要的，而不必弄乱解析 HTML。

**编辑**：在我重新阅读有关表单的 Django 文档后，事实证明表单是不可变的。不过没关系，只需创建一个新`Form`实例并提交即可；我已经更改了我的代码示例以匹配此。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T12:10:32.073

由于 Django 测试框架这样做，我不确定你在问什么。

你想测试一个有表单的 Django 应用吗？

*   在这种情况下，您需要执行初始 GET
*   然后是生成的 POST

你想编写（和测试）一个将表单提交到另一个站点的 Django 应用程序吗？

以下是我们如何使用表单测试 Django 应用程序。

```
class Test_HTML_Change_User( django.test.TestCase ):
    fixtures = [ 'auth.json', 'someApp.json' ]
    def test_chg_user_1( self ):
        self.client.login( username='this', password='this' )
        response= self.client.get( "/support/html/user/2/change/" )
        self.assertEquals( 200, response.status_code )
        self.assertTemplateUsed( response, "someApp/user.html")

def test_chg_user( self ):
    self.client.login( username='this', password='this' )
    # The truly fussy would redo the test_chg_user_1 test here
    response= self.client.post(
        "/support/html/user/2/change/",
        {'web_services': 'P',
         'username':'olduser',
         'first_name':'asdf',
         'last_name':'asdf',
         'email':'asdf@asdf.com',
         'password1':'passw0rd',
         'password2':'passw0rd',} )
    self.assertRedirects(response, "/support/html/user/2/" )
    response= self.client.get( "/support/html/user/2/" )
    self.assertContains( response, "<h2>Users: Details for", status_code=200 )
    self.assertContains( response, "olduser" )
    self.assertTemplateUsed( response, "someApp/user_detail.html") 
```

注意 - 我们不会详细解析 HTML。如果它有正确的模板和正确的响应字符串，它必须是正确的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T13:16:50.207

这很简单……同时也很困难。
免责声明：我对 Python 知之甚少，对 Django 一无所知...所以我给出一般的、与语言无关的建议...如果上述建议之一对您不起作用，您可能需要手动执行：

*   使用 HTML 解析器加载页面，列出表单。
*   如果`method`属性是POST（不区分大小写），获取`action`属性获取请求的URL（可以是相对的）。
*   在表单中，获取所有`input`和`select`标签。（`name`或者`id`如果没有名称）属性是请求参数的键。`value`属性（如果不存在则为空）是相应的值。
*   对于`select`，该值是选定的一个`option`或显示的文本是无`value`属性的。

这些名称和值必须在 GET 请求中进行 URL 编码，而不是在 POST 请求中。

HTH。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T12:59:34.220

检查[机械化](http://wwwsearch.sourceforge.net/mechanize/)或它的包装[斜纹布](http://twill.idyll.org/)。我认为它的[ClientForm](http://wwwsearch.sourceforge.net/ClientForm/)模块会为你工作。

# c# - MVC 路由 - 参数名称问题

> ID：343638
> 
> 赞同：11
> 
> 时间：2008-12-05T12:09:21.793
> 
> 标签：c#, asp.net-mvc, model-view-controller, routing, url-routing

我正在寻找一些关于在 MVC 中使用 C# 进行路由的信息。我目前非常了解 MVC 中路由的基础知识，但我正在寻找的东西有点难以找到。

实际上，我想要找到的是一种定义采用单个参数的单个路由的方法。

我在网上找到的常见示例都是基于示例

```
routes.MapRoute(
    "Default",
    "{controller}.mvc/{action}/{id}"
    new { controller = "Default", action="Index", id=""}); 
```

通过映射这个路由，你可以映射到任何控制器中的任何动作，但是如果你想将任何东西传递给动作，方法参数必须称为“id”。如果可能的话，我想找到一种解决方法，这样我就不必为了在我的操作中使用不同的参数名称而不断地指定路由。

有没有人有任何想法，或找到解决这个问题的方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-03-13T18:50:21.097

如果您想使用不同的参数名称*并*保持相同的路由变量，请使用 FromUri 属性，如下所示：

```
public ActionResult MyView([FromUri(Name = "id")] string parameterThatMapsToId)
{
   // do stuff
} 
```

在您的路线中，您只需要：

```
routes.MapRoute(
  "Default",
  "{controller}.mvc/{action}/{id}"
  new { controller = "Default", action="Index", id=""}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T21:45:12.130

我认为你不能完全按照你的要求去做。当 MVC 调用一个动作时，它会在路由、请求参数和查询字符串中查找参数。它总是在寻找匹配参数名称。

也许好的旧查询字符串会满足您的需求。

```
~/mycontroller/myaction/?foobar=123 
```

将 123 传递给此操作：

```
public ActionResult MyAction(int? foobar) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-06-16T11:19:24.750

我知道这是几个世纪前的事了，但希望它仍然对某人有所帮助。我之前问过同样的问题。我想这就是你要找的。从我的问题帖子中引用的答案：“{*pathInfo} 位称为 slug。它基本上是一个通配符，表示“此后的所有内容都填充到一个名为 pathInfo 的参数中”。因此，如果您有“{resource}.axd/ {*pathInfo}" 和这样的 url：`http://blah/foo.axd/foo/bar/baz/bing`然后创建两个参数，一个称为资源，其中包含 foo，另一个称为 pathInfo，其中包含 foo/bar/baz/bing。"

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T12:35:19.247

您可以根据需要构建路线

```
routes.MapRoute(
    "Default",
    "{controller}.mvc/{action}/{param1}/{param2}/{param3}"
    new { controller = "Default", action="Index", param1="", param2="", param3=""}); 
```

另外，[看看这篇文章](http://chriscavanagh.wordpress.com/2008/03/11/aspnet-routing-goodbye-url-rewriting/)，它在评论部分包含所有类型的示例

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-04-13T15:19:03.163

尽管您仍然不能使用该`FromUri`属性，但是您可以使用该`Route`属性，如下所示

```
[Route("~/Policy/PriorAddressDelete/{sequence}")]
public ActionResult PriorAddressDelete(int sequence)
{
  Policy.RemoveScheduledPriorAddressItem(sequence);
  return RedirectToAction("Information", new { id = Policy.Id });
} 
```

从技术上讲，这增加了一条新路线，但至少它不会弄乱你的`routeconfig`. 它将路线定义放在我喜欢的地方，这是我喜欢的（少找东西）。

请记住，为了使用属性路由，这必须在您定义的路由**上方的 routeconfig 文件中：**

```
routes.MapMvcAttributeRoutes(); 
```

# specifications - 功能规格的最低细节级别，以便有用

> ID：343642
> 
> 赞同：1
> 
> 时间：2008-12-05T12:14:38.583
> 
> 标签：specifications

在我工作的地方，人们不喜欢编写规范。（男孩，有人吗？）所以他们不这样做，除非他们的老板强迫。如果他们被迫编写它们，它们会尽可能短。（顺便说一句，*他们*也包括*我*。）

这导致规范如

*   该软件将事件 A 和 B 之间的时间记录到事件日志中
*   参数 X 的名称和路径在 ini 格式的配置文件中设置。
*   该软件是活动的，无需用户登录到计算机（作为 Windows 服务实施）

这个例子取自一个非常小的项目，效果很好，但我认为它不足以处理更复杂的事情。我没有指定操作系统/硬件要求，因为这是内部开发，我们有涵盖这些的公司或部门标准。

所以我的问题是： *您认为任何重要软件的功能规范中的绝对最低细节水平是多少？*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T12:22:08.040

Joel on Software 写了一篇关于规范的破解文章。

你可以在这里找到它 [规范讨论](http://www.joelonsoftware.com/articles/fog0000000036.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T12:32:49.687

恕我直言，关于功能规范（以及所有其他用于软件开发和项目规划的正式方法/工具（Yourdon、SSADM、PRINCE2、UML 等）的重要之处在于，它们通过让您按照共同的思路思考来鼓励良好的实践。他们不保证成功，但他们通过将良好实践正规化来鼓励成功

因此，创建 FS 的事实是一件好事，即使它们可能会更好。一些计划和准备总比没有好 - 这是很多开发人员所做的。

理想情况下应该进入FS？尽可能多，尽可能少。仅仅因为某些功能规格涵盖 X、Y 和 Z 并不意味着您应该这样做。如果你变得过于规范，你会给简单的项目增加不必要的官僚主义；相应地，对于复杂的项目，规范的方法可能会鼓励开发人员停止他们真正应该达到的细节水平。

# windows - 在 Windows 上忽略 Git 存储库中的目录

> ID：343646
> 
> 赞同：1369
> 
> 时间：2008-12-05T12:17:28.657
> 
> 标签：windows, git, gitignore, git-bash, msysgit

如何在 Windows 上使用 msysgit 忽略 Git 中的目录或文件夹？

* * *

## 回答 #1

> 赞同：1934
> 
> 时间：2008-12-05T12:54:10.407

`.gitignore`在项目目录中创建一个名为的文件。通过在文件中输入目录名称来忽略目录（附加斜杠）：

```
dir_to_ignore/ 
```

更多信息在[这里](http://git-scm.com/docs/gitignore)。

* * *

## 回答 #2

> 赞同：225
> 
> 时间：2010-07-22T11:23:07.430

默认情况下，`.gitignore`当文件名实际上是`.gitignore.txt`.

Git不会使用`.gitignore.txt`

而且您不能将文件重命名为`.gitignore`，因为 Windows 资源管理器认为它是一个没有名称的 gitignore 类型的文件。

非命令行解决方案：

```
您可以将文件重命名为“.gitignore”。，它将创建“.gitignore”
```

* * *

## 回答 #3

> 赞同：130
> 
> 时间：2012-05-01T10:30:33.807

似乎忽略文件和目录有两种主要方法：

1.  **.gitignore**

    *   将`.gitignore`文件放入存储库的根`.git`目录中（在 Windows 中，确保[看到真实的文件扩展名](http://windows.microsoft.com/en-us/windows/show-hide-file-name-extensions#show-hide-file-name-extensions=windows-7)，然后制作`.gitignore.`（最后的点是空文件扩展名））
    *   进行全局配置`~/.gitignore_global`并运行`git config --global core.excludesfile ~/.gitignore_global`以将其添加到您的 Git 配置中

    注意：之前跟踪的文件可以通过运行取消跟踪`git rm --cached filename`

2.  **存储库排除**- 对于不需要共享的本地文件，您只需将文件模式或目录添加到文件中`.git/info/exclude`。这些规则未提交，因此**其他用户看不到**它们。更多信息在[这里](http://help.github.com/ignore-files/)。

要在忽略文件列表中设置例外，请参阅[此问题](https://stackoverflow.com/questions/2415873/exceptions-in-gitignore)。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2010-03-25T18:14:52.417

要指示 Git 忽略某些文件或文件夹，您必须创建`.gitignore`文件。

但在 Windows 资源管理器中，您必须为文件提供名称。您不能仅使用扩展名创建文件。诀窍是创建一个空文本文件并转到命令提示符并将文件名更改为`.gitignore`：

```
ren "New Text Document.txt" .gitignore 
```

现在使用您喜欢的文本编辑器打开文件并添加您希望忽略的文件/文件夹名称。您还可以使用这样的通配符：`*.txt`.

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2008-12-05T13:50:55.100

[我在Windows 资源管理器](https://en.wikipedia.org/wiki/File_Explorer)中创建文件时遇到了一些问题`.`。

一种解决方法是进入命令外壳并使用“编辑”创建一个新文件。

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2016-06-15T21:51:19.767

要在 Git 中忽略整个目录，最简单的方法是在目标目录中包含一个 .gitignore 文件，该文件仅包含“*”。

一个说明性的例子，

**示例系统**

```
/root/
    .gitignore
    /dirA/
        someFile1.txt
        someFile2.txt
    /dirB/
        .gitignore
        someFile3.txt
        someFile4.txt 
```

**目标**

*   忽略 /dirB/ 的内容

**顶级 (/root/.gitignore)**

*   这是您的标准 gitignore 信息所在的位置（例如“~Untitled.docx”、一些私有目录等）。如果需要，“dirB/”当然可以放在这里

**忽略的目录 (/root/dirB/.gitignore)**

*   Git 在文件系统的每一步都监视 gitignore，因此只要您忽略要应用的规范，然后将其扔进去，为该目录生成一个新的 gitignore

*   dirB/.gitignore 然后读取为“*”并且所有内容都被完全忽略，它本身和所有文件！

就这么简单:)

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2012-06-29T10:29:15.103

如果你想维护一个文件夹而不是其中的文件，只需在文件夹中放置一个“.gitignore”文件，以“*”作为内容。该文件将使 Git 忽略存储库中的所有内容。但`.gitignore`将包含在您的存储库中。

```
$ git add path/to/folder/.gitignore 
```

如果您添加一个空文件夹，您会收到此消息（.gitignore 是一个隐藏文件）

```
The following paths are ignored by one of your .gitignore files:
path/to/folder/.gitignore
Use -f if you really want to add them.
fatal: no files added 
```

因此，使用“-f”强制添加：

```
$ git add path/to/folder/.gitignore -f 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2014-01-13T13:49:49.260

在 Windows 中，有一个额外的斜线。**排除.gitignore**中的单个目录

> dir_to_exclude/

可能会工作，但不包括所有目录

> /

当您的目录中有带空格（如 ）的文件名时会导致问题`my file.txt`：Git Bash 使用反斜杠（如 ）转义这些空格，`my\ file.txt`并且适用于 Windows 的 Git 不区分`/`和`\`。

要排除所有目录，最好使用：

> **/

两个连续的星号表示目录内容。

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2018-02-17T00:40:58.190

万一您需要排除子文件夹，您可以使用`**`通配符排除任何级别的子目录。

```
**/build/output/Debug/ 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2015-02-05T14:27:04.637

您可以使用以下内容创建“.gitignore”文件：

```
*
!.gitignore 
```

这个对我有用。

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2011-02-10T10:12:00.060

在您的`\.git\info`项目目录中还有一个排除文件，它实际上与`.gitignore`（我认为）相同。您可以在其中添加要忽略的文件和目录。

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2018-04-04T21:38:12.507

当**一切都失败**时，尝试编辑文件

> /.git/info/排除

并将您想要的目录添加到文件末尾，如下所示：

```
# git ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~
assets/
compiled/ 
```

我将文件夹“assets”和“compiled”添加到要忽略的文件和目录列表中。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2012-02-15T19:43:43.637

我在让 Git`.gitignore`在 Windows 上获取文件时遇到了一些问题。该`$GIT_DIR/info/exclude`文件似乎总是有效。

然而，这种方法的缺点是`$GIT_DIR`目录中的文件不包含在签入中，因此不共享。

> ps `$GIT_DIR`通常是名为的隐藏文件夹`.git`

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2018-06-27T11:22:09.507

在 Unix 上：

```
touch .gitignore 
```

在 Windows 上：

```
echo > .gitignore 
```

在终端中执行的这些命令将`.gitignore`在当前位置创建一个文件。

然后只需向该`.gitignore`文件添加信息（例如使用 Notepad++），哪些文件或文件夹应该被忽略。保存您的更改。就是这样 ：）

更多信息：*[.gitignore](https://www.atlassian.com/git/tutorials/saving-changes/gitignore)*

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2012-06-29T10:11:02.440

我认为问题是你的工作树是这样的：

```
a-cache/foo
a-cache/index.html
b-cache/bar
b-cache/foo
b-cache/index.html
.gitignore 
```

...与`.gitignore`你描述的。这将为您提供`git status`如下输出：

```
$ git status
# On branch master
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#    .gitignore
#    a-cache/
#    b-cache/ 
```

...**如果**`index.html`文件尚未添加到存储库中。（Git 发现缓存目录中有未被忽略的文件，但它只报告目录。）要解决此问题，请确保您已添加并提交`index.html`文件：

```
git add *cache/index.html
git commit -m "Adding index.html files to the cache directories" 
```

...然后您的`git status`遗嘱将如下所示：

```
$ git status
# On branch master
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#    .gitignore
nothing added to commit but untracked files present (use "git add" to track) 
```

（显然你也想提交`.gitignore`。我只是懒得处理这个测试用例。）

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2018-08-14T11:17:42.233

在 Windows 和 Mac 上，如果您想忽略当前目录中名为 Flower_Data_Folder 的文件夹，您可以执行以下操作：

```
echo Flower_Data_Folder >> .gitignore 
```

如果它是一个名为的文件`data.txt`：

```
echo data.txt >> .gitignore 
```

如果是像“Data/passwords.txt”这样的路径

```
echo "Data/passwords.txt" >> .gitignore. 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-08-06T15:01:49.960

我有类似的问题。我使用与 Linux 人员共享存储库的 Windows 工具链工作，他们很乐意在给定文件夹中创建具有相同（大小写除外）名称的文件。

效果是我可以克隆存储库并立即拥有数十个“修改过的”文件，如果我签入这些文件，将会造成严重破坏。

我将 Windows 设置为区分大小写，将 Git 设置为不忽略大小写，但它仍然失败（显然在 Win32 API 调用中）。

如果我 gitignore 文件，那么我必须记住不要跟踪 .gitignore 文件。

但我在这里找到了一个很好的答案：

[http://archive.robwilkerson.org/2010/03/02/git-tip-ignore-changes-to-tracked-files/index.html](http://archive.robwilkerson.org/2010/03/02/git-tip-ignore-changes-to-tracked-files/index.html)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-02-11T23:58:42.340

只需`.gitignore`在您的项目文件夹中创建文件然后在其中添加文件夹的名称，例如：

```
frontend/node_modules 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-12-19T17:57:53.977

这对某些人来说可能非常明显，但我确实从其他答案中理解了这一点。

在目录中创建 .gitignore 文件本身并没有任何作用。您必须将 .gitignore 作为文本文件打开并写入您希望它忽略的文件/目录，每个文件/目录各占一行。

所以 cd 到 Git 存储库目录

```
touch .gitignore
nano .gitignore 
```

然后写下您想要忽略的文件和/或目录的名称及其扩展名（如果相关）。

此外，.gitignore 是某些操作系统（例如 Mac）上的隐藏文件，因此您需要`ls -a`查看它，而不仅仅是 ls。

# project-management - 研究新技术时如何估算时间？

> ID：343652
> 
> 赞同：7
> 
> 时间：2008-12-05T12:21:21.783
> 
> 标签：project-management, estimation

过去几个月我一直在研究 Flex，因为这是我第一次真正做 Flex，我最终低估了导致延迟的项目任务。那么，在研究一项新技术时，如何估计项目时间呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T12:27:10.370

你不能。

你必须把它当作研究，而研究是无法估计的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-05T12:26:07.250

在承诺在特定日期交付任何东西之前，我会给自己一段固定的时间来试验和学习新技术。

在第一个阶段之后，做一些粗略的估计，并确保你的上级知道他们到底有多粗略。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-07-12T08:57:14.530

使用**霍夫施塔特定律：**

> 即使考虑到霍夫施塔特定律，它也总是比您预期的要长。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T12:37:21.207

当我在一个项目中将一个中型开发团队切换到 .Net 时，可以估计完全转换的唯一方法是允许初始研究阶段。这使一些开发人员能够熟悉该技术并完全实现一小部分功能。我发现按照生产标准完成的系统部分非常重要。

还讨论了聘请熟悉该技术的顾问。出于成本考虑，我们决定不这样做，但我认为让有 .NET 项目经验的人为我们指明正确的方向会非常有帮助。

唯一要补充的一点是，当您从事这种性质的项目时，重要的是还要估计让其他开发人员跟上进度所需的时间。显然，这将少于研究阶段所花费的时间。尽管开发原型的开发人员应该随时准备帮助那些现在正在采用新技术的人。

总结一下：

*   您需要给自己时间来掌握新的技术，然后才能给出真实的估计。
*   您需要根据整个项目的经验，根据生产标准进行估算。
*   不要害怕聘请有经验的承包商，以便快速学习最佳实践。
*   不要忘记，每个人都需要学习这项技术，然后才能了解生产代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T15:20:21.237

我还建议查看此线程：[有人使用功能点吗？](https://stackoverflow.com/questions/118023/does-anyone-work-with-function-points)

功能点是一种“行业标准”（无论这意味着什么），用于估计做某事需要多长时间。在大多数情况下，他们试图绘制出程序的功能，然后你将它们放入这样的算法中：

```
long GetManHoursForProject()
{
    long   Count_of_Function_Points = GetFunctionPointCountFromAnalyticalPhaseOfSDLC();
    double Average_Complexity       = 1;  // .8 for easy, 1 for normal, 1.2 for hard
    long   Programming_Language     = 130; // for C++ (higher level languages have higher values)

    double Man_Months = Count_of_Function_Points * Programming_Language * Average_Complexity;

    long   Man_Hours = Man_Months * 20 * 8; // 20 days per month, 8 hours per day

    return Man_Hours;
} 
```

我从上面链接到的主题讨论了故事板积分，这本身就是一个有趣的对话。我会研究这两个主题，以找到适合您的主题。

功能点和故事板点的好处是它们有一个语言乘数。所有语言都使用相同的思维方式。

如果您正在学习一门新语言，那么您的特定系统的复杂性会更高。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T13:22:30.210

我通常分别估算学习时间和实施时间。即我估计这个项目，就好像我知道我在做什么基于它的困惑，然后试着估计我学习新技术可能需要的时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T13:48:46.383

不久前，我不得不在 Flex 中开展一个项目，而我之前从未使用过 Flex（或 Flash）。我还被迫在这个 Flex 应用程序中使用某个第 3 方小部件库。我估计了我认为使用 Java 这样的合理语言需要多长时间，然后大约将其翻倍以考虑学习一门新语言。问题是，Flex 不合理，没有文档记录，标准库中有很多错误，显然我们的 3rd-party 库把标准库的所有设计特性都牢记在心，因为它也非常破碎的。我们最终得到了一个性能很差的产品，只有一半的功能和分配的时间。值得庆幸的是，管理层允许我们继续研究它一段时间（他们一直在改变要求，所以他们欠我们那么多），我们把它变成了非常好的状态。它仍然没有完成我们想要的一切，但是我们解决了大多数库错误，包括缓解最糟糕的性能问题（即，实例化 UIComponent 需要很长时间，所以与其在启动时全部完成，我们按需执行。这与我们的 3rd 方库无关）。

所以，简而言之：

*   总是估计大量的启动时间来学习一个新系统。除了学习语言，你还需要学习特质。这可能无法准确估计
*   尽可能避免使用 Flex。我无法想象直接 Flash 会更好，因为它们共享库的很大一部分。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T16:11:49.760

我的经验法则是将您认为需要的时间加倍。我发现你总是会遇到一些需要时间来解决的意想不到的问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-05T12:27:22.083

我想对于一定规模的项目，给自己一些时间来制作一个相当简单但仍然完整且不平凡的项目的某些代表性部分的原型。然后，您将有一些时间来使用该技术，并获得有关使用它创建东西所需时间的宝贵见解。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-05T12:48:26.643

当我过去使用一项新技术时（即，当新技术成为项目交付的核心时），我将其估计为：

```
New Project Time = Project Time * 1.5 
```

...但不用说，这是经验法则和 YMMV。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-05T13:00:06.043

你可以做的一件事——除了雇佣或不估计——是估计你的任务的**相对复杂性**，然后将实际实施时间与复杂程度进行比较。随着时间的推移，该比率将趋于稳定值。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-12T08:11:13.437

现在，我遇到了像你这样的问题。在这里阅读这些评论后，我认为属于要深入了解新技术的级别。首先，只是在短时间内将新技术作为原始（草图）进行研究，之后已经有分解工作，所以现在只需按顺序进行优先级和更深入的研究。

我希望这很有用。

# c# - 模仿 C# 列表的 C 数据结构 >?

> ID：343654
> 
> 赞同：5
> 
> 时间：2008-12-05T12:22:47.150
> 
> 标签：c#, c, data-structures, refactoring

我希望将 ac# 方法重构为 ac 函数以尝试获得一些速度，然后在 c# 中调用 c dll 以允许我的程序使用该功能。

目前，c# 方法采用整数列表并返回整数列表的列表。该方法计算了整数的幂集，因此 3 个整数的输入将产生以下输出（在此阶段整数的值并不重要，因为它用作内部加权值）

```
1
2
3
1,2
1,3
2,3
1,2,3 
```

其中每一行代表一个整数列表。输出指示第一个列表的索引（偏移量为 1），而不是值。所以 1,2 表示索引 0 和 1 处的元素是幂集的元素。

我不熟悉 c，那么对于允许 c# 访问返回数据的数据结构，我的最佳选择是什么？

提前致谢

**更新**

到目前为止，感谢大家的评论。这是问题性质的一些背景知识。

计算集合的幂集的迭代方法相当简单。两个循环和一点位操作就是它真正的全部。它只是被调用......很多（如果集合的大小足够大，实际上是数十亿次）。

我对使用 c（人们指出的 c++）的想法是它为性能调整提供了更多的空间。直接端口可能不会提供任何增加，但它为更多涉及的方法开辟了道路，从而获得更快的速度。即使每次迭代的小幅增加也将等同于可测量的增加。

我的想法是移植一个直接版本，然后努力增加它。然后随着时间的推移对其进行重构（在 SO 的每个人的帮助下）。

**更新 2**

jalf 的另一个公平点，我不必使用列表或等效项。如果有更好的方法，那么我愿意接受建议。该列表的唯一原因是每组结果的大小不同。

**到目前为止的代码...**

```
public List<List<int>> powerset(List<int> currentGroupList)
{
    _currentGroupList = currentGroupList;
    int max;
    int count;

    //Count the objects in the group
    count = _currentGroupList.Count;
    max = (int)Math.Pow(2, count);

    //outer loop
    for (int i = 0; i < max; i++)
    {
        _currentSet = new List<int>();

        //inner loop
        for (int j = 0; j < count; j++)
        {              
            if ((i & (1 << j)) == 0)
            {
                _currentSetList.Add(_currentGroupList.ElementAt(j));                          
            }
        }
        outputList.Add(_currentSetList);
    }   
    return outputList;
} 
```

正如你所看到的，它并不多。它只是转来转去很多！

我承认创建和构建列表可能不是最有效的方式，但我需要某种方式以可管理的方式提供结果。

**更新 2**

感谢所有的投入和实施工作。只是为了澄清提出的几点：我不需要输出处于“自然顺序”，而且我对返回的空集也不感兴趣。

Hughdbrown 的实现很有趣，但我认为我需要在某个时候存储结果（或至少其中的一个子集）。听起来内存限制会在运行时间成为真正问题之前很久就应用。部分正因为如此，我认为我可以摆脱使用字节而不是整数，从而提供更多潜在的存储空间。

那么问题真的是：我们是否达到了 C# 中这种计算的最大速度？非托管代码选项是否提供更多范围。我知道在很多方面答案都是徒劳的，因为即使我们缩短了运行时间，它也只会允许原始集合中的额外值。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T12:36:17.480

此外，请确保迁移到 C/C++ 确实是您开始时需要做的事情。检测原始 C# 方法（独立，通过单元测试执行），检测新的 C/C++ 方法（同样，通过单元测试独立），看看现实世界的区别是什么。

我提出这个问题的原因是我担心这可能是一场代价高昂的胜利——使用 Smokey Bacon 的建议，你得到了你的列表类，你在“更快”的 C++ 中，但调用那个 DLL 仍然是有代价的：Bouncing out使用 P/Invoke 或 COM 互操作的运行时会带来相当大的性能成本。

在你这样做之前，请确保你已经从那次跳跃中获得了你的“金钱价值”。

**根据 OP 的更新进行更新**

如果你重复调用这个循环，你需要绝对确保整个循环逻辑被封装在一个互操作调用中——否则编组的开销（正如其他人在这里提到的那样）肯定会杀死你。

我确实认为，鉴于问题的描述，问题不在于 C#/.NET 比 C“慢”，而更可能是代码需要优化。正如此处提到的另一张海报，您可以在 C# 中使用指针来显着提高这种循环中的性能，而无需编组。对于这种情况，在进入复杂的互操作世界之前，我会先研究一下。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-05T12:35:34.907

如果您希望使用 C 来提高性能，那么您很可能打算通过使用指针来实现。C# 确实允许使用指针，使用 unsafe 关键字。你考虑过吗？

另外，您将如何调用此代码.. 是否会经常调用它（例如在循环中？）如果是这样，来回编组数据可能会抵消任何性能提升。

* * *

**跟进**

[在不牺牲 .NET 性能](http://www.vsj.co.uk/dotnet/display.asp?id=174)的情况下查看本机代码以获得某些互操作选项。有一些方法可以在不损失太多性能的情况下进行互操作，但这些互操作只能发生在最简单的数据类型中。

尽管我仍然认为您应该研究使用直接 .NET 加速您的代码。

* * *

**跟进 2**

另外，我可以建议，如果您一心想要混合原生代码和托管代码，那么您可以使用 c++/cli 创建您的库。下面是一个简单的例子。请注意，我不是 c++/cli 人，这段代码并没有做任何有用的事情……它只是为了展示你可以多么容易地混合本机代码和托管代码。

```
#include "stdafx.h"

using namespace System;

System::Collections::Generic::List<int> ^MyAlgorithm(System::Collections::Generic::List<int> ^sourceList);

int main(array<System::String ^> ^args)
{
    System::Collections::Generic::List<int> ^intList = gcnew System::Collections::Generic::List<int>();

    intList->Add(1);
    intList->Add(2);
    intList->Add(3);
    intList->Add(4);
    intList->Add(5);

    Console::WriteLine("Before Call");
    for each(int i in intList)
    {
        Console::WriteLine(i);
    }

    System::Collections::Generic::List<int> ^modifiedList = MyAlgorithm(intList);

    Console::WriteLine("After Call");
    for each(int i in modifiedList)
    {
        Console::WriteLine(i);
    }
}

System::Collections::Generic::List<int> ^MyAlgorithm(System::Collections::Generic::List<int> ^sourceList)
{
    int* nativeInts = new int[sourceList->Count];

    int nativeIntArraySize = sourceList->Count;

    //Managed to Native
    for(int i=0; i<sourceList->Count; i++)
    {
        nativeInts[i] = sourceList[i];
    }

    //Do Something to native ints
    for(int i=0; i<nativeIntArraySize; i++)
    {
        nativeInts[i]++;
    }

    //Native to Managed
    System::Collections::Generic::List<int> ^returnList = gcnew System::Collections::Generic::List<int>();
    for(int i=0; i<nativeIntArraySize; i++)
    {
        returnList->Add(nativeInts[i]);
    }

    return returnList;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-05T13:08:02.097

是什么让您认为通过调用 C 代码可以提高速度？C 并不比 C# 神奇地快。当然，它可以是，但它也很容易变慢（和错误）。尤其是当您将 p/invoke 调用纳入本机代码时，远不能确定这种方法是否会加速任何事情。

在任何情况下，C 都没有 List 之类的东西。它有原始数组和指针（你可能会争辩说 int** 或多或少是等价的），但你最好使用 C++，它确实有等价的数据结构。特别是 std::vector。但是，没有简单的方法可以将这些数据公开给 C#，因为它会非常随机地分散（每个列表都是指向*某处*动态分配的内存的指针）

但是，我怀疑最大的性能改进来自改进 C# 中的算法。

编辑：

我可以在您的算法中看到一些似乎不是最佳的东西。构建列表列表不是免费的。也许您可以创建一个列表并使用不同的偏移量来表示每个子列表。或者也许使用 'yield return' 和 IEnumerable 而不是显式构造列表可能会更快。

你有没有分析过你的代码，发现时间花在了哪里？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-05T13:17:07.430

我还将投票支持调整您的 C#，特别是通过使用“不安全”代码并失去可能大量的边界检查开销。

尽管它是“不安全的”，但它并不比 C/C++ 更“安全”，而且它更容易正确处理。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-08T15:49:04.250

这一次返回一组幂集。它基于[此处](http://groups.google.com/group/comp.lang.python/browse_thread/thread/d9211cd6c65e1d3a/)的 python 代码。它适用于超过 32 个元素的 powerset。如果您需要少于 32 个，您可以将 long 更改为 int。它非常快——比我以前的算法快，也比 P Daddy 的代码（我修改为使用 yield return 版本）快。

```
static class PowerSet4<T>
{
    static public IEnumerable<IList<T>> powerset(T[] currentGroupList)
    {
        int count = currentGroupList.Length;
        Dictionary<long, T> powerToIndex = new Dictionary<long, T>();
        long mask = 1L;
        for (int i = 0; i < count; i++)
        {
            powerToIndex[mask] = currentGroupList[i];
            mask <<= 1;
        }

        Dictionary<long, T> result = new Dictionary<long, T>();
        yield return result.Values.ToArray();

        long max = 1L << count;
        for (long i = 1L; i < max; i++)
        {
            long key = i & -i;
            if (result.ContainsKey(key))
                result.Remove(key);
            else
                result[key] = powerToIndex[key];
            yield return result.Values.ToArray();
        }
    }
} 
```

[您可以在此处](http://www.iwebthereforeiam.com/files/TestYieldReturn.zip)下载我测试过的所有最快版本。

我真的认为使用收益回报是使计算大型幂集成为可能的变化。预先分配大量内存会显着增加运行时间，并导致算法很早就因内存不足而失败。原始海报应该计算出他一次需要多少组 powerset。拥有所有这些元素并不是真正具有> 24个元素的选项。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-07T01:29:38.107

下面是一个 C# 算法，它应该比您发布的算法快得多（并且使用更少的内存）。它不使用您使用的整洁的二进制技巧，因此代码要长一些。它的`for`循环比你的多一些，可能需要一两次使用调试器逐步完成它才能完全理解它。但它实际上是一种更简单的方法，一旦你了解它在做什么。

作为奖励，返回的集合具有更“自然”的顺序。它将按照您在问题中列出的顺序返回集合 {1 2 3} 的子集。这不是重点，而是所使用算法的副作用。

在我的测试中，我发现这个算法比你为一大组 22 个项目发布的算法快大约 4 倍（这是我可以在我的机器上运行的最大容量，而不会过多的磁盘抖动使结果扭曲太多）。你的一次运行大约需要 15.5 秒，而我的运行大约需要 3.6 秒。

对于较小的列表，差异不太明显。对于一组只有 10 个项目，您的运行 10,000 次大约需要 7.8 秒，而我的运行大约需要 3.2 秒。对于包含 5 个或更少项目的集合，它们几乎同时运行。通过多次迭代，您的运行速度会更快一些。

无论如何，这是代码。抱歉这么久；我试图确保我评论得很好。

```
/* 
 * Made it static, because it shouldn't really use or modify state data.
 * Making it static also saves a tiny bit of call time, because it doesn't
 * have to receive an extra "this" pointer.  Also, accessing a local
 * parameter is a tiny bit faster than accessing a class member, because
 * dereferencing the "this" pointer is not free.
 * 
 * Made it generic so that the same code can handle sets of any type.
 */
static IList<IList<T>> PowerSet<T>(IList<T> set){
    if(set == null)
        throw new ArgumentNullException("set");

    /*
     * Caveat:
     * If set.Count > 30, this function pukes all over itself without so
     * much as wiping up afterwards.  Even for 30 elements, though, the
     * result set is about 68 GB (if "set" is comprised of ints).  24 or
     * 25 elements is a practical limit for current hardware.
     */
    int   setSize     = set.Count;
    int   subsetCount = 1 << setSize; // MUCH faster than (int)Math.Pow(2, setSize)
    T[][] rtn         = new T[subsetCount][];
    /* 
     * We don't really need dynamic list allocation.  We can calculate
     * in advance the number of subsets ("subsetCount" above), and
     * the size of each subset (0 through setSize).  The performance
     * of List<> is pretty horrible when the initial size is not
     * guessed well.
     */

    int subsetIndex = 0;
    for(int subsetSize = 0; subsetSize <= setSize; subsetSize++){
        /*
         * The "indices" array below is part of how we implement the
         * "natural" ordering of the subsets.  For a subset of size 3,
         * for example, we initialize the indices array with {0, 1, 2};
         * Later, we'll increment each index until we reach setSize,
         * then carry over to the next index.  So, assuming a set size
         * of 5, the second iteration will have indices {0, 1, 3}, the
         * third will have {0, 1, 4}, and the fifth will involve a carry,
         * so we'll have {0, 2, 3}.
         */
        int[] indices = new int[subsetSize];
        for(int i = 1; i < subsetSize; i++)
            indices[i] = i;

        /*
         * Now we'll iterate over all the subsets we need to make for the
         * current subset size.  The number of subsets of a given size
         * is easily determined with combination (nCr).  In other words,
         * if I have 5 items in my set and I want all subsets of size 3,
         * I need 5-pick-3, or 5C3 = 5! / 3!(5 - 3)! = 10.
         */
        for(int i = Combination(setSize, subsetSize); i > 0; i--){
            /*
             * Copy the items from the input set according to the
             * indices we've already set up.  Alternatively, if you
             * just wanted the indices in your output, you could
             * just dup the index array here (but make sure you dup!
             * Otherwise the setup step at the bottom of this for
             * loop will mess up your output list!  You'll also want
             * to change the function's return type to
             * IList<IList<int>> in that case.
             */
            T[] subset = new T[subsetSize];
            for(int j = 0; j < subsetSize; j++)
                subset[j] = set[indices[j]];

            /* Add the subset to the return */
            rtn[subsetIndex++] = subset;

            /*
             * Set up indices for next subset.  This looks a lot
             * messier than it is.  It simply increments the
             * right-most index until it overflows, then carries
             * over left as far as it needs to.  I've made the
             * logic as fast as I could, which is why it's hairy-
             * looking.  Note that the inner for loop won't
             * actually run as long as a carry isn't required,
             * and will run at most once in any case.  The outer
             * loop will go through as few iterations as required.
             * 
             * You may notice that this logic doesn't check the
             * end case (when the left-most digit overflows).  It
             * doesn't need to, since the loop up above won't
             * execute again in that case, anyway.  There's no
             * reason to waste time checking that here.
             */
            for(int j = subsetSize - 1; j >= 0; j--)
                if(++indices[j] <= setSize - subsetSize + j){
                    for(int k = j + 1; k < subsetSize; k++)
                        indices[k] = indices[k - 1] + 1;
                    break;
                }
        }
    }
    return rtn;
}

static int Combination(int n, int r){
    if(r == 0 || r == n)
        return 1;

    /*
     * The formula for combination is:
     *
     *       n!
     *   ----------
     *   r!(n - r)!
     *
     * We'll actually use a slightly modified version here.  The above
     * formula forces us to calculate (n - r)! twice.  Instead, we only
     * multiply for the numerator the factors of n! that aren't canceled
     * out by (n - r)! in the denominator.
     */

    /*
     * nCr == nC(n - r)
     * We can use this fact to reduce the number of multiplications we
     * perform, as well as the incidence of overflow, where r > n / 2
     */
    if(r > n / 2) /* We DO want integer truncation here (7 / 2 = 3) */
        r = n - r;

    /*
     * I originally used all integer math below, with some complicated
     * logic and another function to handle cases where the intermediate
     * results overflowed a 32-bit int.  It was pretty ugly.  In later
     * testing, I found that the more generalized double-precision
     * floating-point approach was actually *faster*, so there was no
     * need for the ugly code.  But if you want to see a giant WTF, look
     * at the edit history for this post!
     */

    double denominator = Factorial(r);
    double numerator   = n;
    while(--r > 0)
        numerator *= --n;

    return (int)(numerator / denominator + 0.1/* Deal with rounding errors. */);
}

/*
 * The archetypical factorial implementation is recursive, and is perhaps
 * the most often used demonstration of recursion in text books and other
 * materials.  It's unfortunate, however, that few texts point out that
 * it's nearly as simple to write an iterative factorial function that
 * will perform better (although tail-end recursion, if implemented by
 * the compiler, will help to close the gap).
 */
static double Factorial(int x){
    /*
     * An all-purpose factorial function would handle negative numbers
     * correctly - the result should be Sign(x) * Factorial(Abs(x)) -
     * but since we don't need that functionality, we're better off
     * saving the few extra clock cycles it would take.
     */

    /*
     * I originally used all integer math below, but found that the
     * double-precision floating-point version is not only more
     * general, but also *faster*!
     */

    if(x < 2)
        return 1;

    double rtn = x;
    while(--x > 1)
        rtn *= x;

    return rtn;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-07T00:56:53.430

您的结果列表与您的代码将产生的结果不匹配。特别是，您没有显示生成空集。

如果我正在生成可能具有数十亿个子集的 powerset，那么单独生成每个子集而不是一次生成所有子集可能会减少您的内存需求，从而提高代码的速度。这个怎么样：

```
static class PowerSet<T>
{
    static long[] mask = { 1L << 0, 1L << 1, 1L << 2, 1L << 3, 
                           1L << 4, 1L << 5, 1L << 6, 1L << 7, 
                           1L << 8, 1L << 9, 1L << 10, 1L << 11, 
                           1L << 12, 1L << 13, 1L << 14, 1L << 15, 
                           1L << 16, 1L << 17, 1L << 18, 1L << 19, 
                           1L << 20, 1L << 21, 1L << 22, 1L << 23, 
                           1L << 24, 1L << 25, 1L << 26, 1L << 27, 
                           1L << 28, 1L << 29, 1L << 30, 1L << 31};
    static public IEnumerable<IList<T>> powerset(T[] currentGroupList)
    {
        int count = currentGroupList.Length;
        long max = 1L << count;
        for (long iter = 0; iter < max; iter++)
        {
            T[] list = new T[count];
            int k = 0, m = -1;
            for (long i = iter; i != 0; i &= (i - 1))
            {
                while ((mask[++m] & i) == 0)
                    ;
                list[k++] = currentGroupList[m];
            }
            yield return list;
        }
    }
} 
```

然后您的客户端代码如下所示：

```
 static void Main(string[] args)
    {
        int[] intList = { 1, 2, 3, 4 };
        foreach (IList<int> set in PowerSet<int>.powerset(intList))
        {
            foreach (int i in set)
                Console.Write("{0} ", i);
            Console.WriteLine();
        }
    } 
```

我什至会免费提供一个带有模板化参数的位旋转算法。为了提高速度，您可以将 powerlist() 内部循环包装在一个不安全的块中。它没有太大区别。

在我的机器上，此代码比 OP 的代码稍慢，直到集合为 16 或更大。但是，16 个元素的所有时间都小于 0.15 秒。在 23 个元素中，它在 64% 的时间内运行。原始算法不能在我的机器上运行 24 个或更多元素——它耗尽了内存。

此代码需要 12 秒来生成数字 1 到 24 的功率集，省略屏幕 I/O 时间。那是在 12 秒内达到 1600 万次，即每秒大约 1400K。对于 10 亿（这是您之前引用的），大约是 760 秒。你认为这需要多长时间？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-05T12:29:20.270

它必须是 C，还是 C++ 也是一个选项？`list`如果是 C++，您可以只从 STL 中获取自己的类型。否则，您必须实现自己的列表 - 查找链接列表或动态大小的数组以获取有关如何执行此操作的指针。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-07T02:03:47.083

我同意“首先优化 .NET”的观点。这是最无痛的。我想如果您使用 C# 指针编写一些非托管的 .NET 代码，除了 VM 开销外，它与 C 执行相同。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-07T16:27:30.303

P爸爸：

您可以将您的 Combination() 代码更改为：

```
 static long Combination(long n, long r)
    {
        r = (r > n - r) ? (n - r) : r;
        if (r == 0)
            return 1;
        long result = 1;
        long k = 1;
        while (r-- > 0)
        {
            result *= n--;
            result /= k++;
        }

        return result;
    } 
```

这会将乘法和溢出的机会减少到最低限度。

# sql-server - Moss 2007 SSP 错误“搜索应用程序‘{0}’未准备好。”

> ID：343656
> 
> 赞同：0
> 
> 时间：2008-12-05T12:23:20.487
> 
> 标签：sql-server, sharepoint, search, moss, ssp

我正在尝试修复 MOSS 2007 站点上损坏的 SSP。我遇到的问题表现如下......

在 SSP“搜索设置”页面中，我收到以下消息：

*搜索服务当前处于离线状态。访问 SharePoint 管理中心中的“服务器上的服务”页面以验证该服务是否已启用。这也可能是因为正在进行索引器移动。*

在 SSP“用户配置文件和属性”页面中，我在顶部以红色显示：

*访问 SQL Server 数据库或 Office SharePoint Server 搜索服务时出错。如果这是您第一次看到此消息，请稍后再试。如果此问题仍然存在，请联系您的管理员。*

我已经联系了我的管理员，但目前是我本人，事实证明我对这个问题一无所知。

在事件日志中，我收到以下消息：

*作业定义 Microsoft.Office.Server.Search.Administration.IndexingScheduleJobDefinition (ID 8714973c-0514-4e1a-be01-e1fe8bc01a18) 的 Execute 方法引发异常。更多信息包括在下面。*

*搜索应用程序“{0}”尚未准备好。*

事件 ID 是 6398，它没有我希望的那么有用，但我发现这条消息很有趣，因为它看起来像一个缺少替换值的 String.format 调用。不幸的是，它告诉我如何解决问题并不有趣。

Sharepoint 自己的日志提供了这一点：

```
UserProfileConfigManager.GetImportStatus() 无法获取爬网状态：System.InvalidOperationException：搜索应用程序“{0}”未准备好。     
在 Microsoft.Office.Server.Search.Administration.SearchApi..ctor（WellKnownSearchCatalogs 目录，SearchSharedApplication 应用程序）     
在 Microsoft.Office.Server.Search.Administration.SearchSharedApplication.get_SearchApi()     
在 Microsoft.Office.Server.UserProfiles.UserProfileConfigManager.c__DisplayClass3.b__0()     
在 Microsoft.Office.Server.Diagnostics.FirstChanceHandler.ExceptionFilter（布尔 fRethrowException，TryBlock tryBlock，FilterBlock 过滤器，CatchBlock catchBlock，FinallyBlock finallyBlock）
```

我已经尝试停止和启动搜索服务，从管理面板中删除和重新添加它，以及几乎所有我能找到的与 Sharepoint 自己的管理工具有关的事情，这让我相信这里的问题可能是数据库或权限相关。

在同一台服务器上设置了第二个 SSP，我认为这可能是问题的原始原因的一部分，但删除它并没有什么区别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T16:12:39.837

也许你可以理解这一点 - 我是 sharepoint 的新手，所以对我来说没有什么意义：“服务共享，在寻找解决方案后，在这个论坛上有人绦虫同样的问题。在阅读了无数评论之后，我用来解决问题的方法是创建一个新的共享服务，后来它将其他应用程序分配给他，后来我把它像预定的那样，它启动了配置文件的导入，然后是听证会，显然首先我做到了一个测试站点，以防万一，后来消除了First Shared Service，终于解决了我的错误。数据库中应用程序配置的注册表快照已正确存储。上下文：应用程序`SharedServices2' "

你没有提到任何关于绦虫的事情，所以也许你正在运行一个更新的版本。

翻译：

[http://tecnologiainformaticait.wordpress.com/2008/11/21/error-sharepoint-search-application-0-is-not-ready/](http://tecnologiainformaticait.wordpress.com/2008/11/21/error-sharepoint-search-application-0-is-not-ready/)

就个人而言，我会尝试 msdn 论坛。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T17:22:09.430

所以看来问题是一个损坏的共享服务提供者（不知道它是如何产生的，但是你去），我能找到的唯一可行的解​​决方案是删除它并重新开始。

我怀疑通过在某处更改数据库中的某些内容可能会获得更优雅的修复，但我对 Sharepoint 数据库模型的了解不够好，无法在可用的时间内找到它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T10:58:56.990

作为对此的附加警告，如果您确实删除了 SSP，您可能会发现它没有完全删除，因此您会得到一堆仍然尝试在空数据库上运行的 SQL 服务器任务，如果您有这可能会导致问题在同一数据库服务器上运行的任何其他内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T17:15:34.630

同样的问题。我的 DBA 正确删除了搜索数据库，但它仍然无法正常工作。当我找到一些东西时，我会在我的博客上发布解决方案。目前，我们打开一个 MS 呼叫。

1.  创建了一个新的 SSP 2- 在中央管理中，单击共享服务管理
    3- 单击“更改关联”并将所有 Web 应用程序移动到新的 SSP

选择一个新的 search_DB 并选择将索引的好服务器（如果您在场中）

此操作产生的问题：我们注意到我们丢失了网站的统计信息。

如果您尝试过这个解决方案，也请给我们您的反馈

谢谢。

[http://dejacquelot.blogspot.com/](http://dejacquelot.blogspot.com/)

# c# - 用于比较 XML 节点的高效算法

> ID：343667
> 
> 赞同：13
> 
> 时间：2008-12-05T12:28:28.090
> 
> 标签：c#, xml, algorithm, comparison, performance

我想确定 XML 文档中的两个不同子节点是否相等。如果两个节点具有相同的一组属性和子注释并且所有子注释也相等（即整个子树应该相等），则它们应该被认为是相等的。

输入文档可能非常大（最多 60MB，超过 100000 个要比较的节点）并且性能是一个问题。

检查两个节点是否相等的有效方法是什么？

**例子：**

```
<w:p>
  <w:pPr>
    <w:spacing w:after="120"/>
  </w:pPr>
  <w:r>
    <w:t>Hello</w:t>
  </w:r>
</w:p>
<w:p>
  <w:pPr>
    <w:spacing w:after="240"/>
  </w:pPr>
  <w:r>
    <w:t>World</w:t>
  </w:r>
</w:p> 
```

此 XML 片段描述 OpenXML 文档中的段落。该算法将用于确定文档是否包含与文档中较早的段落具有相同属性（w:pPr 节点）的段落（w:p 节点）。

我的一个想法是将节点的外部 XML 存储在一个哈希集中（通常我必须首先获得一个规范的字符串表示，其中属性和子注释总是以相同的方式排序，但我可以期望我的节点已经是这样的形式）。

另一个想法是为每个节点创建一个 XmlNode 对象并编写一个比较器来比较所有属性和子节点。

我的环境是 C# (.Net 2.0)；非常欢迎任何反馈和进一步的想法。也许有人甚至已经有了一个好的解决方案？

编辑：微软的 XmlDiff API 实际上可以做到这一点，但我想知道是否会有更轻量级的方法。XmlDiff 似乎总是产生一个 diffgram 并且总是首先产生一个规范的节点表示，这两件事我都不需要。

EDIT2：我终于根据这里提出的建议实现了我自己的 XmlNodeEqualityComparer 。非常感谢！！！！

谢谢，迪沃

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-05T14:00:47.637

我建议不要滚动您自己的哈希创建函数，而是依赖内置`XNodeEqualityComparer`的`GetHashCode`方法。这保证在创建结果时考虑属性和后代节点，也可以节省一些时间。

您的代码如下所示：

```
XNodeEqualityComparer comparer = new XNodeEqualityComparer();
XDocument doc = XDocument.Load("XmlFile1.xml");
Dictionary<int, XNode> nodeDictionary = new Dictionary<int, XNode>();

foreach (XNode node in doc.Elements("doc").Elements("node"))
{
    int hash = comparer.GetHashCode(node);
    if (nodeDictionary.ContainsKey(hash))
    {
        // A duplicate has been found. Execute your logic here
        // ...
    }
    else
    {
        nodeDictionary.Add(hash, node);
    }
} 
```

我的 XmlFile1.xml 是：

```
<?xml version="1.0" encoding="utf-8" ?>
<doc>
  <node att="A">Blah</node>
  <node att="A">Blah</node>
  <node att="B">
    <inner>Innertext</inner>
  </node>
  <node>Blah</node>
  <node att="B">
    <inner>Different</inner>
  </node>
</doc> 
```

`nodeDictionary`最终将包含一个唯一的节点集合及其哈希。`Dictionary`使用'方法检测重复项，传入我们使用'方法`ContainsKey`生成的节点的哈希。`XNodeEqualityComparer``GetHashCode`

我认为这应该足够快以满足您的需求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T13:12:48.250

这种方法怎么样：

对于文档中的所有`<w:pPr>`节点（我想每个节点不超过一个`<w:p>`），将所有相关数据（元素名称、属性、值）连接成一个字符串：

```
// string format is really irrelevant, so this is just a bogus example
'!w:keep-with-next@value="true"!w:spacing@w:before="10"@w:after="120"' 
```

按字母顺序执行此操作，以考虑不同的文档顺序。

使用这些字符串作为键和对相应`<w:p>`节点的引用作为值来构建一个集合。

在执行此操作的过程中，当您遇到给定键已存在于集合中的点时，您会发现一个具有相同属性的段落。如果您想继续收集，请使用节点列表作为收集值。

我不能说这会表现如何，但我想实施和发现并不难。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T14:37:45.597

即使正确定义问题也是非常具有挑战性的

“当两个 xml 文档相等时？”

这件事情是由很多原因导致的：

1.  XML 文档是可能具有不同文本表示的树。
2.  在比较中可能会或可能不会考虑仅空白节点
3.  在比较中可能会或可能不会考虑评论节点
4.  在比较中可能会或可能不会考虑 PI 节点
5.  词汇差异：或
6.  不同的前缀可能与两个文档中的同一个命名空间相关联
7.  命名空间节点可以显示为在 doc1 的节点上定义，也可以显示为未定义但继承自 doc2 中相应节点的父节点
8.  可以在 doc1 中的属性周围使用引号，但在 doc2 中可以使用撇号
9.  实体可以在 doc1 中使用，但它们可以在 doc2 中预先展开
10.  两个文档可能有不同但语义上等价的 DTD
11.  等等。

因此，尝试为两个 XML 文档的相等性比较生成函数的正确实现似乎是幼稚和不切实际的。

**我的建议是**将[**deep-equal()**](http://www.w3.org/TR/xpath-functions/#func-deep-equal)函数与兼容的 XPath 2.0 引擎一起使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T15:24:05.003

这是我敲出的一个哈希函数，它试图解决您的部分问题。请注意，我几乎没有编写散列函数的经验，主要是为了从人们那里获得关于它在解决这个特定问题方面的有效性的反馈。我不建议在生产中使用它。

```
static int HashXElement(XElement elem)
{
    int hash = 23;

    foreach (XAttribute attrib in elem.Attributes())
    {
        int attribHash = 23;
        attribHash = attribHash * 37 + attrib.Name.GetHashCode();
        attribHash = attribHash * 37 + attrib.Value.GetHashCode();
        hash = hash ^ attribHash;
    }

    foreach(XElement subElem in elem.Descendants())
    {
        hash = hash * 37 + XmlHash(subElem);
    }

    hash = hash * 37 + elem.Value.GetHashCode();

    return hash;
} 
```

想法是使子节点的顺序显着，但属性的顺序不显着。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T12:42:57.390

不是对您的问题的直接回答，而是与您要实现的目标密切相关：看看[XmlDiff](http://msdn.microsoft.com/en-us/library/aa302294.aspx) (.net XML power tools)

# java - 如何让 JAXB 将布尔值呈现为 0 和 1，而不是真假

> ID：343669
> 
> 赞同：27
> 
> 时间：2008-12-05T12:30:40.767
> 
> 标签：java, jaxb, boolean

有一个快速的问题。有谁知道如何让 JAXB (marshall) 将布尔字段呈现为 1 和 0 而不是打印出“true”和“false”？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-10-27T19:07:40.517

适配器类：

```
import javax.xml.bind.annotation.adapters.XmlAdapter;

public class BooleanAdapter extends XmlAdapter<Integer, Boolean>
{
    @Override
    public Boolean unmarshal( Integer s )
    {
        return s == null ? null : s == 1;
    }

    @Override
    public Integer marshal( Boolean c )
    {
        return c == null ? null : c ? 1 : 0;
    }
} 
```

用法：

```
@XmlElement( name = "enabled" )
@XmlJavaTypeAdapter( BooleanAdapter.class )
public Boolean getEnabled()
{
    return enabled;
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-12-14T09:47:21.087

遇到与 user20298 相同的问题，我按照 mtpettyp 的提示进行了调整，并针对我的配置进行了调整。

我的配置是： - maven 来构建项目。- maven 中的“org.jvnet.jaxb2.maven2”插件。- jaxb 2.2.6 - 在这个场合，我正在为 kml 2.2 (ogckml22.xsd) 制作 Java 类

我偶然发现布尔值被渲染为“真/假”的问题，当谷歌地图希望它们为“1/0”时

这是maven中的插件配置：

```
<plugin>
<groupId>org.jvnet.jaxb2.maven2</groupId>
<artifactId>maven-jaxb2-plugin</artifactId>
<executions>
    <execution>
        <phase>generate-sources</phase>
        <goals>
            <goal>generate</goal>
        </goals>
    </execution>
</executions>
<configuration>
    <generateDirectory>src/main/generated</generateDirectory>
    <extension>true</extension>
    <removeOldOutput>true</removeOldOutput>
</configuration> 
```

我在 src/main/resources 文件夹中添加了一个 jaxb-bindings.xjb 文件，其中包含以下内容：

```
 <?xml version="1.0" ?>
<bindings xmlns="http://java.sun.com/xml/ns/jaxb" 
          version="2.1" 
          xmlns:kml="http://www.opengis.net/kml/2.2"
          xmlns:xjc="http://java.sun.com/xml/ns/jaxb/xjc"
          xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <globalBindings>
        <xjc:simple/>
        <xjc:javaType name="java.lang.Boolean" 
                      xmlType="xsd:boolean" 
                      adapter="path.to.my.JaxbBooleanAdapter"/>
    </globalBindings>
    ...
    ...
</bindings> 
```

适配器类是这样的：

```
package path.to.my;

import javax.xml.bind.annotation.adapters.XmlAdapter;

/**
 * Utility class to correctly render the xml types used in JAXB.
 */
public class JaxbBooleanAdapter extends XmlAdapter<String, Boolean>
{
    @Override
    public Boolean unmarshal(String v) throws Exception
    {
        if ("1".equals(v))
        {
            return true;
        }
        return false;
    }

    @Override
    public String marshal(Boolean v) throws Exception
    {
        if (v == null)
        {
            return null;
        }
        if (v)
        {
            return "1";
        }
        return "0";
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-05T15:13:11.673

JAXB 提供了一种灵活的方式来[定制您的绑定](http://java.sun.com/webservices/docs/1.5/tutorial/doc/JAXBUsing4.html#wp148613)。您只需编写一个 XML 文件，该文件将指示您希望如何绑定 XML 和 Java 类型。在您的情况下，您可以使用`<javaType>`声明，您可以在其中指定 a`parseMethod`和 a `printMethod`。这些方法可以很简单

```
public boolean myParseBool(String s)
{
    return s.equals("1");
}

public String myPrintBool(boolean b)
{
    return b ? "1" : "0";
} 
```

可能存在更简单的方法，可能使用 DatatypeConverter，但我对这个主题还不够了解，无法为您提供更多帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T12:44:16.013

我可能会创建一个用于将布尔值转换为 int 的类型适配器。JAXB 用户指南中有一些[示例](https://jaxb.dev.java.net/guide/XML_layout_and_in_memory_data_layout.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T12:40:15.570

您可以编写一对解析器/编写器并在绑定 JAXB XML 中定义属性映射。

# git - 用过之后你对 git 的优缺点是什么？

> ID：343675
> 
> 赞同：42
> 
> 时间：2008-12-05T12:32:54.977
> 
> 标签：git, version-control

我现在使用的是 SVN，过去我使用过 CVS 和 VSS。SVN 是我目前最喜欢的书籍，但我听说过很多关于 git 的信息。在使用过 git 的人中，您的经验有哪些优点和缺点？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-05T12:39:24.760

我对git没有*很多*经验，但是：

优点：

*   真的很快
*   本地提交摇滚
*   快速启动新存储库（无需配置等）
*   github很容易使用

（除了能够拥有本地存储库并推送到公共存储库之外，我还没有真正“需要”事物的分布式方面。）

缺点：

*   我相信，Windows 支持仍然落后——而且你不能只从普通的命令提示符中使用它
*   缺乏 IDE 和 Explorer 集成
*   我花了一些时间才找到一本符合红豆书的[好的介绍性文字](http://book.git-scm.com/)。
*   “添加”已更改文件仅在该时间点添加内容的事实（因此它可以显示为暂存提交*并且*仍然有需要另一个修改`git add`）需要一段时间才能掌握

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-12-06T09:11:17.783

**命令数**

虽然 svn 和其他现代 VCS（如 hg 或其他）都是不错且有用的工具，但 git 是一个充满机床的商店。这同时占优势和劣势。虽然 svn 有 30 个命令（根据 'svn help'），但 git 提供了 130 个手册页，每个手册页或多或少地描述了一个命令。原因之一是 git 公开了大多数用户作为命令行工具所需要的较低级别的功能。但即使没有这些低级命令，git 也提供了许多非常强大的工具，并且在我所知道的任何其他 VCS 中都找不到（参见[git-bisect](http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html)、[git-filter-branch](http://git-scm.com/docs/git-filter-branch)、[git-cherry](http://www.kernel.org/pub/software/scm/git/docs/git-cherry.html)或[git-reset](http://git-scm.com/docs/git-reset)举些例子）。虽然手头有这些工具非常有帮助，但初学者很难理解他们需要和需要知道哪些命令，哪些不需要。

* * *

**发展模式**

一个类似的话题是 git 足够强大，可以支持非常不同的操作模式。这对初学者来说很困难，因为没有真正的“最佳实践”文档，因为最佳实践没有内置到 git 中。所以你必须自己决定你是否

*   只需使用合并来避免与您的工作目录冲突
*   使用重新定位到上游 HEAD 的私有分支
*   使用上游分支
    *   定期合并的（飞鱼）
    *   完成后合并
*   使用一个项目维护者、树维护者、子系统维护者、驱动程序维护者和贡献者的树，每个级别都从下面的级别拉补丁（Linux内核）

由于您拥有本地存储库，您甚至可以使用与您正在处理的项目非常不同的操作模式，只需在推送/发布它们之前调整您的更改集。

* * *

**变革之路**

根据您的观点，另一件事也算是利弊，那就是使用 git 比使用任何集中式 VCS 更复杂，甚至比大多数其他分布式 VCS 更复杂。

使用集中式 VCS，您通常只需执行一次提交，您所做的更改就会转到存储库。在 git 中，更改在到达最终目的地之前可能会经历很多步骤。典型步骤是（括号中不是那么常见的步骤）：

*   工作目录（编辑）
*   索引又名暂存区（git add）
*   本地存储库（git commit）
*   (其他本地分支) (git rebase, git cherry-pick, git merge)
*   (子维护者的仓库) (git push, git pull, mail)
*   上游仓库（git push、git pull、mail）

由于您可以跳过索引，因此至少涉及 2 个步骤，但通常还有更多。这需要更深入地了解您在做什么并输入更多命令。另一方面，这使您可以控制这些步骤中的每一个。你可以

*   决定哪些垃圾/行进入提交，哪些不是
*   决定你想要哪些补丁在你的本地分支中
*   决定发布哪些补丁
*   在发布补丁之前返工、压缩、修复、拆分、重新排序补丁
*   决定自己信任哪些人并接受来自哪些人的补丁
*   将项目的一部分委托给您信任的其他维护者。

所有这些权力和决定使初学者很难开始使用 git。一旦掌握，他们就可以对代码进行极大的控制。

* * *

**写访问**

任何分布式 VCS 的一个主要优点是贡献者不需要写入权限即可从 VCS 中受益。每个具有读取权限的人都可以克隆存储库，在必要时创建分支并开始堆叠放置补丁集。在没有写权限的情况下使用 cvs 是一件非常痛苦的事情——使用 git 获取补丁的方式并没有太大的不同。这不仅是技术优势，而且还可以省去复杂的讨论，这个菜鸟是否真的应该获得写权限。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-05T13:58:13.680

临：

*   快——非常快。
*   与 SVN 相比，创建新的 repo 非常容易
*   完整的 repo 只包含在一个 .git 文件夹中 - 它不会在代码的每个文件夹中添加一个 .SVN 文件夹（没什么大不了的，但我喜欢它）
*   分支更容易
*   GitHub！

缺点：

*   无法签出存储库的一部分（例如仅一个文件夹或仅一个文件）
*   不跟踪空文件夹
*   糟糕的 Windows 支持（对我没有太大影响 - 我使用 Linux）
*   我还没有为 Git 找到一个好的 GUI 工具（我使用 KDESVN 进行 SVN）。如果您对 CLI 感到满意，这不是什么大问题。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-05T13:03:05.680

很多人会否认这一点，但源代码管理工具的选择会影响您的工作方式。我过去经常使用 Subversion，直到我发现了 Git。我主要避免在 Subversion 中进行分支。每当我无法避免时，我更喜欢设置本地镜像（使用 svk）。虽然在 Subversion 和 Git 中都可以轻松完成分支，但只有 Git 使合并（和变基！）变得有趣，Subversion 一直是合并时间的一大难题。

我真正喜欢 Git 的第二件事（除了已经提到的所有要点）是“索引”，这是一个保存下一次提交的暂存区域，并且可以只向其中添加已更改文件的单个块。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-05T12:46:11.453

Windows 支持令人震惊，所以我转向[Mercurial](http://www.selenic.com/mercurial/)，这是另一个同样出色的 DVCS。

例如，当您在办公室的服务器中有一个存储库并且您在现场工作时，DVCS 的好处就变得显而易见。能够在不访问服务器办公室的情况下进行本地提交（必要时进行回滚）非常棒！

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-05T16:18:41.493

使用 git 与使用其他版本控制系统非常不同。

拥有本地存储库非常重要。这意味着您可以在不打扰任何人的情况下使用版本控制系统的全部功能（这对于 git 来说很重要）。如果您的项目中存在有争议的问题，您可以私下处理它 - 通过创建分支、堆叠补丁和完善它们。这样你就可以带着熨烫的补丁集回来。但即使在“正常操作”中，如果您可以在向公众展示补丁之前清理它们会更好，事实上，如果您有健全的补丁，而不仅仅是“一天结束”的快照，调试会容易得多。

在我提交更大的补丁集之前，我通常会将新代码上的补丁重新排序并将错误修复直接压缩到补丁中。所以补丁看起来我从来没有犯过任何错误。之后，我的私人分支重新建立在 HEAD 之上，然后推送。我通常从不使用合并，因为它只会使历史混乱。

简而言之：它可以让你的历史保持干净。

这使您对自己的工作有非常不同的看法。它允许您将当前状态视为单个补丁的添加，这些补丁创建的历史不仅是日志，而且是您故意放在那里的东西。补丁集是您构建应用程序的基石 - 如有必要，可以移动到正确的位置。

我永远不会自愿回到我在 git 之前使用的任何其他版本控制系统或任何不支持 rebase 和本地分支和提交的版本控制系统。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-31T15:28:08.100

优点：[为什么 Git 比 X 更好](http://whygitisbetterthanx.com/)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-05T12:43:47.247

在 git 中合并要简单得多，因为创建分支是默认设置，而不是额外的选项。因此，当您必须合并某些内容时，您只需提交它，然后合并两个分支（现有分支和 git 为您上次签入自动创建的新分支）。

此外，在使用 git 时，您始终拥有整个存储库。您可以在离线时签入并稍后合并（因为合并要简单得多）。

缺点是 GIT 在 Windows 上的 USB 驱动器上几乎无法使用。Windows 禁用这些缓存，而 GIT 可以处理数百万个小文件。此外，仍然缺乏 IDE 支持。我不确定后者是否真的是一个问题。GIT 自带的 UI 很不错。

此外，我不是 100% 高兴您必须一直“添加”现有文件 [编辑] 和大量功能。对于初学者来说，它们是压倒性的，而且通常不清楚为什么要使用某个选项/命令。我的意思是，CVS 附带了 20 个命令。GIT 有 73 个，每个都有很多选项（这还不包括管道命令......）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-05T20:19:37.437

其他注意事项：

优点：

*   灵活：不强制执行一个真正的工作流程
*   如此之快以至于版本控制成为一项小任务
*   轻量级分支、易于合并和暂存区允许个性化的工作流程
*   更有力
*   非常紧凑的回购

缺点：

*   没有内置的访问控制
*   二进制文件的弱工具。不会在 repo 中压缩对二进制文件的更改，并且存储二进制文件会阻止自动处理 Windows 中的行尾。
*   可能更难学习，因为它更灵活、更强大。并不总是遵循 CVS/SVN 语义，也不围绕文件进行组织。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-05T13:49:04.230

最新版本的 Git 可以直接在 Window 的命令提示符下工作，我就是这样使用的。这个过程现在对我来说相当微不足道。

我还在外部硬盘驱动器和我的 jumpdrive 上安装了 Git。每当在一台新计算机上，我都会运行一个脚本来临时设置包含 Git 工具的路径。然后就可以继续开发了！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-05T12:37:13.000

好问题，我使用 SVN 已经有一段时间了，感觉很舒服。但我不得不多次使用 Git 从不同的开源项目中获取源代码。我仍然没有花时间真正了解它。这值得么？

我还想问在普通 VCS 上使用分布式版本控制作为颠覆有什么好处。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-05T12:42:44.503

Skeet 拥有其中的大部分，但是：

临：

*   分枝！在单独的分支中处理大量功能并且仍然能够对它们进行版本控制比在一个分支中进行多件事情要好得多。一旦你决定喜欢分支，你必须喜欢 git 与 SVN 相比的简单程度

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-12-06T15:37:28.677

优点：

*   上面提到的一切

缺点：

*   Windows中autocrlf的奇怪行为

*   无法移动/重命名文件或 dir insode repo 并保留其提交历史记录（**git mv**只是从 repo 中删除文件，重命名并将其再次添加到 repo，从而丢失所有历史记录）

# c# - 显示来自 C# AfterInstall 事件的错误消息

> ID：343678
> 
> 赞同：1
> 
> 时间：2008-12-05T12:34:03.537
> 
> 标签：c#, windows, installation

有人可以告诉我在执行 AfterInstallEvent 期间如何在 C# 中显示错误消息吗？

我的项目使用 Microsoft 设置和部署项目，然后我创建了一个在 AfterInstall 事件触发时调用的类。

消息框.Show(); 不起作用...“名称'MessageBox'未出现在当前上下文中”。

如果就这么简单，我就不会问了！？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T21:39:05.933

真正的解决方案是使用范围。像这样的东西： global::System.Windows.Forms.MessageBox.Show(ex,"Error",MessageBoxButtons.OK, MessageBoxIcon.Error);

干杯

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-02T12:28:30.393

这已经很老了，但无论如何我都会回答：

**这只是一个缺失的参考。**

**将对System.Windows.Forms**的引用添加到包含该类的项目中。还添加**“使用 System.Windows.Forms;”** 到你的类文件的顶部。

据我所知，从自定义安装操作显示消息框应该没有任何问题。

# .net - .NET 中与 Hypernate 相关的文章

> ID：343684
> 
> 赞同：1
> 
> 时间：2008-12-05T12:35:43.410
> 
> 标签：.net

我正在.net 中寻找与 Hypernate 相关的文章

有人可以推荐一些吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T12:47:22.917

您似乎不太可能*真正*追求[hypernate](http://sourceforge.net/projects/hypernate/)（这似乎是一个 3 年内没有发布的单独项目）。您是说[NHibernate](http://www.nhibernate.org)吗？如果是这样，当您使用正确的名称时，您很可能只需通过搜索就能找到您想要的东西:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T13:00:29.100

如果您指的是 Hibernate，那么这是介绍 Nhibernate[的文章。](http://www.codeproject.com/KB/database/Nhibernate_Made_Simple.aspx)我用了不到 1 个小时就开始使用 Nhibernate。非常好入手。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T12:51:08.463

我猜您正在寻找有关 NHibernate 的文章（检查拼写）？在 stackoverflow 或谷歌搜索 NHibernate，你会发现很多文章。

NHibernate 项目的网站在[http://www.nhibernate.org/](http://www.nhibernate.org/)（但目前似乎不可用？）。

# apache-flex - 在 Flash 文件中使用 FLEX 3 组件怎么样？

> ID：343690
> 
> 赞同：1
> 
> 时间：2008-12-05T12:38:48.847
> 
> 标签：apache-flex, flash

是否可以在 Flash (cs4) SWF 文件中使用 Flex 3 组件/代码？

我知道它可能在相反的方向。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T12:51:43.830

我自己没有在“纯 AS3”项目中使用过 Flex 代码，但我不明白为什么你不能这样做。

您可以下载[Flex SDK](http://www.adobe.com/products/flex/flexdownloads/)并从那里获取 Flex 组件，包括`swc`文件（在 下`/frameworks/libs`）和 AS3 源代码（在 下`/frameworks/projects/framework/src`）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T19:58:33.893

通过我的最小测试**，在构建“纯 AS3”项目时似乎不能使用 Flex 组件。**（我们可以开始称它为 PAS3 之类的吗？比如“passé”。或“糕点”。:)

我通过创建一个带有一个 AS 类作为“文档类”的测试项目来完成这个公认的有限测试，该项目将实例化并添加一个 mx.controls.Button。我将整个 mx 包从[hasseg](https://stackoverflow.com/users/4111/hasseg)提到的路径复制到项目源路径中。

这是我发现的：

1.  通过从某个 Version.as 文件中删除 mx_internal 的使用，我得到了 Flash IDE 来编译我的测试项目而没有警告。然而，舞台上什么都没有出现。
2.  使用 Flex Builder（显然还有 flex 编译器）我还成功地编译了项目而没有错误。我在代码中放置了断点，并观察它在调试器中自行构建。组件被完美地实例化，但仍然没有任何东西出现在舞台上。这个 swf 也多次使浏览器崩溃。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-19T15:16:57.427

看起来这毕竟可以做到：http: [//labs.wichers.nu/2007/12/25/using-flex-compiled-code-within-flash/](http://labs.wichers.nu/2007/12/25/using-flex-compiled-code-within-flash/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-03T11:26:18.407

一般来说，您需要使用 MXML 来初始化 Flex 框架并使用 Flex 组件。

Adobe 的 Mike Chambers 说：

> 不支持在仅 AS 项目中使用 Flex 框架。虽然理论上可行，但您必须手动引导 Flex 处理的大量应用程序初始化代码（这会相当复杂）。-[来源](http://www.mail-archive.com/flashcoders@chattyfig.figleaf.com/msg17761.html)

要查看复杂程度，您可以告诉编译器保留它从 MXML 生成的中间 AS3 文件。打开您的 AS3 项目属性并将其设置`-keep-generated-actionscript`为编译器的参数。编译您的项目，然后查看 obj/generated 文件夹。使用 Flex 4，我得到了 13 个小文件，其中的主要文件扩展`spark.components.Application`并覆盖了一些方法。

所以这是可能的，但你可能不想这样做。Flex 旨在让您的生活更轻松，而不是更艰难。

# visual-c++ - 如何使用搜索创建 MFC 组合框

> ID：343695
> 
> 赞同：6
> 
> 时间：2008-12-05T12:40:44.570
> 
> 标签：visual-c++, mfc, ccombobox

我需要一个具有搜索功能的 Windows MFC 应用程序中的组合框。它应该可以工作，以便如果您开始键入与列表中的一个或多个项目匹配的内容，组合框应该下拉并显示这些项目。有点像网络上流行的基于 ajax 的搜索框

您知道提供此功能的任何控件吗？- 有关于如何自己创建此类功能的信息的链接？- 有关于如何做到这一点的想法可以分享吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T12:57:02.073

为事件提供一个处理程序`CBN_EDITCHANGE`，您的处理程序将在每次用户更改编辑字段中的文本时被调用。

在此处理程序中，调用该`CComboBox::FindString()`方法以查看键入的文本是否存在于您的任何组合框条目中。如果是，请调用`CComboBox::SetCurSel()`以选择它。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-08T13:37:18.573

这是一个 Win32 api 常见问题解答。见高级。Win32 api ng news://194.177.96.26/comp.os.ms-windows.programmer.win32 （你根本不需要CBN_EDITCHANGE。用api自动）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-08T19:14:51.200

完全访问组合框的编辑框：

```
CEdit *pEdit = (CEdit *)pComboBox->GetWindow(GW_CHILD); 
```

# ssh - 通过 SSH 传输文件

> ID：343711
> 
> 赞同：479
> 
> 时间：2008-12-05T12:46:03.623
> 
> 标签：ssh, scp

我正在命令行上通过 SSH 连接到远程服务器，并尝试使用该`scp`命令将目录复制到我的本地计算机上。但是，远程服务器返回此“使用”消息：

```
[Stewart:console/ebooks/discostat] jmm% scp -p ./styles/
usage: scp [-1246BCEpqrv] [-c cipher] [-F ssh_config] [-i identity_file]
           [-l limit] [-o ssh_option] [-P port] [-S program]
           [[user@]host1:]file1 [...] [[user@]host2:]file2
[Stewart:console/ebooks/discostat] jmm% 
```

我希望能够双向传输文件。根据我的阅读，我认为上述命令可以用于下载和`scp -p [localpath] [remotepath]`上传？

* * *

## 回答 #1

> 赞同：770
> 
> 时间：2008-12-05T12:51:02.067

你需要在`scp`某个地方做点什么。你有`scp ./styles/`，所以你说的是安全副本`./styles/`，但不是复制到哪里。

一般来说，如果你想下载，它会去：

```
# download: remote -> local
scp user@remote_host:remote_file local_file 
```

where`local_file`实际上可能是放置您要复制的文件的目录。要上传，则相反：

```
# upload: local -> remote
scp local_file user@remote_host:remote_file 
```

如果要复制整个目录，则需要`-r`. 可以想象`scp`为 like `cp`，除了您可以指定一个文件`user@remote_host:file`以及本地文件。

编辑：如评论中所述，如果本地和远程主机上的用户名相同，则在指定远程文件时可以省略用户。

* * *

## 回答 #2

> 赞同：172
> 
> 时间：2008-12-05T12:57:03.040

如果复制到/从您的桌面计算机，请使用 WinSCP，或者如果在 Linux 上，Nautilus 通过连接到服务器选项支持 SCP。

scp 只能将文件复制到运行 sshd 的机器上，因此您需要从正在运行 scp 的机器上运行远程机器上的客户端软件。

如果在命令行上复制，请使用：

```
# copy from local machine to remote machine
scp localfile user@host:/path/to/whereyouwant/thefile 
```

或者

```
# copy from remote machine to local machine
scp user@host:/path/to/remotefile localfile 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-12-05T13:25:00.487

您需要同时指定源和目标，如果要复制目录，则应查看 -r 选项。

因此，要递归地将 /home/user/whatever 从远程服务器复制到您的当前目录：

```
scp -pr user@remoteserver:whatever . 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-12-05T12:49:36.207

不，您仍然需要以`scp [from] [to]`任何方式复制

不同的是，你需要`scp -p server:serverpath localpath`

# .net - 微软是否应该仅仅因为国际化太难而避免在 .Net 中实现某项功能？

> ID：343717
> 
> 赞同：7
> 
> 时间：2008-12-05T12:47:34.383
> 
> 标签：.net, internationalization, language-features

我在 Microsoft Connect 上提出了有关日期格式的请求（“ [DateTime Formatting should calculate the correct suffix for the day](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=327261) ”）。基本上我想有一个格式化字符串代码，用于将后缀添加到日期编号。所以“1 Jan”将被格式化为“1st Jan”和“2 Jan”被格式化为“2nd Jan”等等。

对于英语案例来说，这很容易做到，但微软拒绝了这个想法，理由是它太难以国际化。

我只是想知道人们是否同意微软让仅仅为英语市场写作的英语程序员的生活变得更加困难是合理的，只是因为他们不能迎合非英语市场？

**编辑：**好的，我接受这样的论点，即有框架可以做他们想做的事。我更多是出于意识形态的要求。还要记住，对于非英语文化，有一个简单的后备方案，那就是什么都不添加，这不会让人们的生活比现在更糟。

**编辑 2：**对我来说，这是一个多小时的工作。我需要支持看起来像这样的代码：

```
 DateTime minDate = new DateTime(2003, 12, 10);
        string errorMessage = ValidationMessageResource.DateTooEarly;            
        Console.WriteLine(String.Format(errorMessage, minDate)); 
```

我无法控制资源文件的内容，资源字符串通常类似于“日期不应早于 {0:D}”。为此，我需要实现我自己的 IFormatProvider 类，该类必须支持 Microsoft 格式化程序接受的所有不同格式化字符串。微软似乎没有提供一种简单的方法来通过继承来扩展他们的格式化程序。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-05T12:52:35.433

1：这是他们的框架，他们选择做的任何事情按照定义都是合理的。他们没有义务提供他们不喜欢的任何东西。

2：不能国际化的功能基本没用。如果他们只为英语添加它，他们所能实现的只是世界其他地方会要求它国际化，突然间，他们会因为给予世界其他地方低劣的待遇而看起来很糟糕。

3：*很难*国际化。您不能假设每种语言都简单地添加一个后缀。它可能是一个前缀，或者它可能会改变句子的完全不同的部分。（或者，正如另一位发帖者指出的那样，它可能是“第一”而不是第一个，所以即使在英语中，也没有硬性规定。为什么他们要执行您的任意规则，而不是其他对英语同样有效的规则？ )

3b：虽然您显然不关心这一点，但微软正在将 .NET 作为一种国际化感知框架进行营销。这意味着他们不能仅仅为了满足您的需求而忽略世界的 90%。

4：你要花一个小时自己编写英文版，不是吗？;)

5：与日期时间无关。它是一般数字字符串格式的一般*属性*。

6：您的假设“如果他们添加了英语功能，没有其他人会比现在更糟”是不正确的。开发人员通常依靠 .NET 来正确运行。如果添加了您的格式建议，开发人员自然会希望它适用于所有语言和区域设置，因此，当开发人员认为不存在问题时，会为所有非英语语言生成无效或意外的输出。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-05T12:50:26.093

完全同意这是合理的。没有什么可以阻止您在自己的可重用库中实现您想要的格式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T13:11:04.307

*“我只是想知道人们是否同意微软让仅仅为英语市场写作的英语程序员的生活变得更加艰难是合理的，因为他们无法满足非英语市场的需求？”*

我认为您有点极端，在我看来，这确实是一个边缘案例。这种日期格式化就像向微软索要邮政/邮政编码格式化程序或地址类。当然，大多数国家/地区都有格式化邮政编码和地址的惯例，但这并不意味着 MS 必须实施它。您可以轻松构建这些类型的数据结构的框架。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T12:52:16.997

那么列表中第 1、2、3 项的正确英文不是 first、second、third 吗？

我明白你的意思，但它更多的是支持收缩“不能，不会，不是”问题，然后是日期时间问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T13:07:57.557

正如 Jalf 所说，用英语沙沙作响的东西不会花太长时间。然后，您可以将其用作开源项目（如果以前没有这样做过）。了解其他国家/地区格式的开发人员可以做出贡献，因此您无需在开始之前找出所有内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T15:03:02.677

格式化日期的 C 函数是 strftime()。这需要一个带有 ' `%x`' 符号的格式字符串来指示要格式化的日期部分以及如何格式化它们。添加 ' `%o`' 作为带有数字（第 1、第 2、第 3、...）的序数天数的格式项，以及`%O`拼写的替代（逻辑上 ' ' 但我认为这已经在用户中）是可行的出版本（第一，第二，...）。然后可以像日期格式的任何其他部分一样全球化。`%o`如果语言环境没有关于如何写入序数的信息，则“”的默认结果很可能是“无后缀”；您甚至可以使用不带后缀的数字作为“拼写”

等效功能存在于其他语言框架中——可以在其中任何一个框架中轻松提供。

（如果有人想对月份进行排序——2009 年的第一个月——那么你需要另一个符号。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T12:54:13.637

我认为 MS 和你都提出了很好的观点。

我倾向于同意MS。问题不是让非英语软件的日子更难过。真正的问题是新方法不适用于不同的语言，这是不可接受的。一件事是没有功能，另一件事是具有在某些情况下不起作用的功能。

我想虽然可以制作语言特定的功能。也许像 localization.English.DateFormatter 这样的东西会是一个不错的折衷方案，但是从长远来看，它可能会导致编写软件更加难以本地化。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-05T12:58:06.187

只是为了让您了解这有多难。

1 月 1 日仅适用于**英**式英语。美国英语的正确形式是 1 月 1 日。

加拿大人可能会与 1er Janvier 妥协。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-05T12:56:48.470

Microsoft 没有义务为您执行工作。它必须是您在他们的框架之上实现的那些东西之一。

# svn - 集市和$Id$

> ID：343721
> 
> 赞同：3
> 
> 时间：2008-12-05T12:49:45.177
> 
> 标签：svn, version-control, bazaar

我的大多数来源都在颠覆中，我使用“$Id$”将修订信息添加到这些来源。然后我可以轻松检查使用了哪些来源（例如，--version 选项显示该信息）。

现在我要使用bazaar，找不到这样的功能。集市上是否有任何相当于 svn '$Id$' 的东西？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T13:17:45.820

使用 Bazaar 等 DSCM 工具自动生成显示合理版本号的 Id 标签是不可能的，因为每个人的开发线都可能与其他人不同。因此，有人可能会引用文件的“1.41”版本，但该文件的“1.41”版本是不同的。

基本上，$Id$ 对 Bazaar、Git 和其他分布式源代码管理工具没有任何意义。

# java - 如何获取 XMLBeans 中的所有枚举值？

> ID：343728
> 
> 赞同：1
> 
> 时间：2008-12-05T12:52:21.347
> 
> 标签：java, enums, xmlbeans

Apache XMLBeans 可用于从 XML 模式定义文件 (XSD) 生成 Java 类和接口。它还根据 StringEnumAbstractBase 和 StringEnumAbstractBase.Table 生成枚举来表示域值。它们对于仅输入有效值很方便。但是，我想获取所有这些值来生成 JCombobox、JTable 或 html 表。

是否有 XMLBeans API 调用来从生成的类中获取所有 Enum 值？唯一可用的选择是某种 Java 反射吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T15:00:08.750

这对我有用：

```
for (int i = 1; i <= MyEnum.Enum.table.lastInt(); i++) 
{
  System.out.println(MyEnum.Enum.forInt(i));
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-31T17:27:23.077

这是另一种获取方式：

```
public static List<String> getEnumValueList(XmlString xmlString){
    List<String> values = new ArrayList<String>();
    SchemaStringEnumEntry valArr[] = xmlString.schemaType().getStringEnumEntries();
    for(SchemaStringEnumEntry val : valArr){
        values.add(val.getString());
    }
    return values;
} 
```

因此，要获取 ModelType 的枚举值列表，我执行以下操作：

```
getEnumValueList(ModelType.Factory.newInstance()); 
```

# floating-point - 您将存储工程数据的计量单位是什么？

> ID：343732
> 
> 赞同：4
> 
> 时间：2008-12-05T12:53:53.793
> 
> 标签：floating-point, precision, units-of-measurement

在我们的应用程序中，我们目前决定将所有工程数据存储在我们的 SI 数据库中。

我担心我们可能会冒在我们的数据库或 .NET 数字类型中没有足够精确度和准确性的风险。我还担心我们可能会看到浮点数学的伪像（尽管这可能是一个问题）。

例如，源数据可能是以 Psi（磅/平方英寸）表示的压力量（并从某些第 3 方服务中读取）。工程师会选择这种计量单位，因为（对于表示的数量）这将倾向于提供易于消化、人类可读的数字，而不需要科学记数法。

当我们“标准化”这个数字时，即当我们为了我们自己的持久性而转换这个数量时，我们可能会将它转换为 Pa（帕斯卡），这需要将这个数字乘以或除以某个其他可能很大的数字。

我们经常最终存储非常大或非常小的数字，更糟糕的是 - 我们可能会对这些数字进行进一步的计算。

目前我们使用ORACLE float 和System.Double。

人们对此有何看法？

**更新**

进一步的研究发现了即将推出的 F# 语言（在我写的 CTP 中）[对度量单位的支持。](http://blogs.msdn.com/andrewkennedy/archive/2008/08/20/units-of-measure-in-f-part-one-introducing-units.aspx)

看来我们将能够让 F# 理解用户输入，例如：

```
9.81<n/s^2> // an acceleration 
```

我们还可以创建自己的派生单位和单位系统。

[![在 F# 中为牛顿创建派生单位](https://i.stack.imgur.com/xMfVf.png)](https://i.stack.imgur.com/xMfVf.png)
[（来源：[msdn.com](http://blogs.msdn.com/blogfiles/andrewkennedy/WindowsLiveWriter/UnitsofMeasureinFPartOneIntroducingUnits_A131/image_thumb_11.png)）]

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T13:02:09.520

牢记*重要数字*——测量的准确性。如果 PSI 只知道整磅，那么转换为 Pa 后有 15 位小数，仍然只有一个有效数字。

精度与精度不同，对工程单位执行浮点运算需要在运算过程中考虑到这一点——不要存储比测量精度更高的精度，也不要在计算中使用比已知精度更高的精度。

* * *

编辑：

您还可以考虑使用`NUMERIC(p,s)`可以显式指定精度（位数）和小数位数（小数点右侧的位数）的位置。

如果这不是一个选项，请考虑保持特定测量的准确性，以便可以报告和/或在计算中使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T13:05:45.003

我认为只要您能够存储与实际一样多的精度，您就没有理由担心。

使用您给出的将 PSI 转换为帕斯卡（1 PSI = 6 894.75 pa）的示例，如果我测量 14.7 PSI 并将其转换为帕斯卡，我得到 101,352.825。这太精确了。您需要将其存储为 101,000 以反映*测量*的真实精度，而不是*计算*。

请记住，您用于进行转换的任何数字都需要至少与您的测量值一样精确，这样您就不会在转换过程中失去精度。最好在您的转换因子中使用比在您的测量中更多的精度（至少多一位）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T13:01:45.900

我认为工程数据通常不够精确，无法担心差异。你知道工程师的表达“用千分尺测量，用粉笔标记，用斧头切割”。大概就是这样总结。担心 8 位有效数字或 12 位在现实世界中构建的东西与 2 位有效数字公差之间的差异是没有意义的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T13:08:48.773

为避免由于单位转换而导致精度损失，您可以将来自测量的所有数据存储在测量单位中。当然，这意味着您最终可能会以 Pa 存储压力值，而将其他压力值存储为 Psi，甚至毫米汞柱。你必须自己决定这是否会带来比它解决的问题更多的问题。

我同意其他答案：在大多数情况下，Oracle 浮点提供的精度远远高于测量本身的精度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T12:59:24.143

好吧，这取决于您想要的精确程度。请记住，在谈论工程时，仅存储数字 3.20 是不够的，因为在工程方面，3.2 与 3.20 不同。3.20 意味着比 3.2 更高的准确度，可能是*3.15 <= x < 3.25*。

# f# - 好的 F# 异步 IO 示例

> ID：343733
> 
> 赞同：3
> 
> 时间：2008-12-05T12:53:58.803
> 
> 标签：f#, asynchronous, io

我在哪里可以找到一个很好的关于带有线程箍的文件的异步 IO 示例？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T15:42:07.870

在这段视频中[http://channel9.msdn.com/pdc2008/TL11/](http://channel9.msdn.com/pdc2008/TL11/) Luca Bolognese 解释了 F#，包括异步文件读取和并行映射减少。

我希望它有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T16:58:01.273

下面是一个示例：[使用 F# 异步工作流来简化 AutoCAD 中的并发编程](http://through-the-interface.typepad.com/through_the_interface/2008/01/harnessing-f-as.html)。

# javascript - 在 fireFox 中关闭父窗口

> ID：343744
> 
> 赞同：1
> 
> 时间：2008-12-05T12:59:42.050
> 
> 标签：javascript, firefox

是否可以使用 JavaScript 在 Firefox 2.0 中关闭父窗口。我有一个打开另一个窗口的父页面，我需要在 10 秒后关闭父窗口。我已经尝试过 Firefox 调整“dom.allow_scripts_to_close_windows”，尝试过延迟，但似乎没有任何效果。

任何帮助将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T13:27:49.733

出于安全原因，仅使用 opener 对象可能不会总是关闭父窗口。你可以做的是：

在父节点上，有一个名为 closeWindowFromChild() 的函数：

```
函数 closeWindowFromChild()
{
    this.window.close();
}

```

在孩子身上，当你想关闭窗口时：

```
函数关闭父窗口（）
{
    opener.closeWindowFromChild();
}
```

这应该可以正常工作。:-D

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T13:09:40.253

从[quirksmode](http://www.quirksmode.org/js/croswin.html)中剪下（编辑：添加了一些上下文，如 Diodeus 所建议的）：

理论上

```
opener.close() 
```

应该是弹出窗口中的代码：关闭打开此弹出窗口的窗口。

但是，在某些浏览器中，不允许自动关闭尚未由 JavaScript 打开的窗口。上面的行在 Mac、Mozilla、Opera 和 OmniWeb 上的资源管理器中运行良好，但在 Windows、Netscape 4 及更低版本和 iCab 上的资源管理器中却不行。在这些浏览器中，用户被要求确认关闭窗口。至于 Safari，它完全没有任何作用。

令我惊讶的是，在 Windows 上的 Explorer 5.5 和 6 中绕过这个确认框非常容易。Explorer 只是查看页面是否有开启器。如果不是，则该窗口已被用户打开，并且未经确认可能不会关闭。所以我们需要做的是让 Explorer 认为打开页面有一个开启器：

```
opener.opener = top; // or whatever, as long as opener.opener has a value;
opener.close() 
```

这个技巧在 Netscape 4 及更低版本和 iCab 中不起作用，这些浏览器有更复杂的方法来确定一个窗口是否已被 JavaScript 打开。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T13:05:29.247

通常，您无法关闭不是您自己使用 javascript 打开的窗口。

# php - html 从 php 得到乱码

> ID：343753
> 
> 赞同：0
> 
> 时间：2008-12-05T13:02:36.600
> 
> 标签：php, javascript, mysql, html, csv

我有一个 mysql 数据库，其中一个字段包含一个 html 描述。这个描述不在我的控制范围内，是自动获取和插入的。这些描述之一的示例如下：

[http://www.nomorepasting.com/getpaste.php?pasteid=22492](http://www.nomorepasting.com/getpaste.php?pasteid=22492)

数据最初是从访问数据库中导出的，并且似乎保持不变。导出数据的示例如下：

[http://www.yousendit.com/transfer.php?action=batch_download&batch_id=TTZtWmdsT01kMnVGa1E9PQ](http://www.yousendit.com/transfer.php?action=batch_download&batch_id=TTZtWmdsT01kMnVGa1E9PQ)

我正在尝试将包含 html 描述的变量输出到弹出窗口中，以按原样显示。我试图用来执行此操作的代码在这里：

[http://www.nomorepasting.com/getpaste.php?pasteid=22498](http://www.nomorepasting.com/getpaste.php?pasteid=22498)

但是它会生成以下 html 代码：

[http://www.nomorepasting.com/getpaste.php?pasteid=22462](http://www.nomorepasting.com/getpaste.php?pasteid=22462)

有一个未关闭的样式标签可防止显示页面的其余部分，并阻止打开弹出窗口。据我所知，我已将其缩小为 php 问题，因为 mysql 中的数据似乎很好。

编辑：

我只是尝试使用以下代码从数据库中仅选择 article_Desc：

[http://www.nomorepasting.com/getpaste.php?pasteid=22494](http://www.nomorepasting.com/getpaste.php?pasteid=22494)

结果是这样的：

[http://www.nomorepasting.com/getpaste.php?pasteid=22496](http://www.nomorepasting.com/getpaste.php?pasteid=22496)

编辑2：

包含 style 标签的 countrycode 变量似乎有问题。当我删除它时，会显示图片并创建弹出窗口，只有 html 结果与我粘贴的最后一个链接非常相​​似。数据库中的数据似乎正确，那么可能导致此问题的原因是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T13:11:22.353

让我想起了[这个问题](https://stackoverflow.com/questions/340478/phpcode-generating-broken-javascript-and-html-code)。

你在这里看到 PHP 代码

```
child1.document.write(' . json_encode($row2["ARTICLE_DESC"]) . '); 
```

在 HTML 代码中

```
child1.document.write(""); 
```

这意味着 json_encode($row2["ARTICLE_DESC"]) 输出“”。由于 json_encode('') 输出 ""，这意味着 $row2["ARTICLE_DESC"] 为空。

编辑：

```
$sql="SELECT * FROM Auctions WHERE ARTICLE_NO ='$pk'";
$sql2="SELECT ARTICLE_DESC FROM Auctions WHERE ARTICLE_NO ='$pk'"; 
```

不需要第二个 sql2，因为第一个 $sql 应该已经包含 ARTICLE_DESC。所以

1.  该 ARTICLE_NO 的字段 ARTICLE_DESC 为空。
2.  ARTICLE_DESC 不是正确的名称。
3.  ARTICLE_DESC 在不同的表中。

编辑编辑：

```
$query = "SELECT article_desc FROM Auctions WHERE ARTICLE_NO ='220288560247'"; 
```

名称是 article_desc 而不是 ARTICLE_DESC。

编辑评论：

将所有出现的 ARTICLE_DESC 更改为 article_desc。

编辑现在你得到了 html 代码，你需要替换

```
json_encode($row['article_desc']) 
```

有了这个

```
str_replace(array("\n", "\r", "\t"), array('', '', ''), $row['article_desc']); 
```

这可以在一个不错的功能中完成。请记住您打印的所有 html 代码都在

```
<!-- text --> 
```

所以你实际上不会在你的新窗​​口中看到任何东西......

```
<!-- +++++++++++++++++++++++++ Bitte ändern Sie im eigenen Interesse nichts an diesem Code! ++++++++++++++++++++++++ -->
<!-- +++++++++++++++++++++++++ Das kann massive Fehldarstellungen ihrer Auktion zur Folge haben! +++++++++++++++++++ -->
<!-- +++++++++++++++++++++++++ ++++++++++++++++++++++++++ Ihr Supreme Team +++++++++++++++++++++++++++++++++++++++++ --> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T13:39:20.410

CSV 文件有点乱。这些字段似乎由制表符分隔，没有被任何东西包围。这对于简单数据可能没问题，但是当您开始将 HTML 放入其中时，您会遇到问题 - 查看[您的其他问题之一，](https://stackoverflow.com/questions/340478/phpcode-generating-broken-javascript-and-html-code)看起来 CSV 解析器正在混淆并将 HTML 的一个字段拆分为多个 - 这似乎每次遇到选项卡时都会发生（也许还有双引号？）

您可以更改 CSV 文件的格式吗？我建议您使用逗号分隔字段，并为更复杂的字符串（如 HTML）定义一个封闭字符（例如双引号） - 我认为您需要确保字符串中的任何双引号也是逃脱了。另请记住，您可能需要从这些字符串中删除或转义换行符，具体取决于解析它的内容，但我并不完全确定这一点。

**发表评论后编辑**

您无需担心包含分隔符的字符串，只要它被字符包围即可。如果您需要包含三个字段的行，并且三个字符串值是：

```
String1
String2
Stri,ng3 
```

以下**内容**无效，解析器会将其视为四个字段

`String1,String2,Stri,ng3`

以下**是**有效的，因为分隔符被双引号“括起来”

`"String1", "String2", "Stri,ng3"`

然后，当您想在字符串中使用双引号时，它会变得更加棘手-然后需要对其进行转义。如果你想代表

```
String1
String"2 
```

CSV 字段可以像

```
"String1", "String\"2" 
```

如果我没记错的话，您是使用 LOAD DATA? 导入 MySQL 的，所以对于上面的示例，您可能需要使用类似的选项

```
FIELDS TERMINATED BY ',' ENCLOSED BY '"' ESCAPED BY '\\' 
```

我不确定 MySQL 将如何处理封闭字符串中的换行符，我似乎找不到太多关于此的内容。如果它逐行读取文件，您可能需要遇到问题。

**编辑 2**

如果剩余的问题与换行符相关，您可以在将每个字段导出到 CSV 的代码中对`\n`with`\\n`和`\r`with进行字符串替换`\\r`

# java - .net中是否有类似于java中的源代码分析api？

> ID：343754
> 
> 赞同：2
> 
> 时间：2008-12-05T13:02:37.753
> 
> 标签：java, .net

> 需要执行源代码分析的 Java 应用程序开发人员可能感兴趣的 API 是 Java Compiler API (JSR 199)、Plugable Annotation Processing API (JSR 269) 和 Compiler Tree API。

.net 有类似的 api 或库吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T13:13:27.170

Visual Studio 2008 附带一个运行源代码分析的工具：它为您提供代码继承深度、代码行（已编译）、解决方案/项目/类/方法的可维护性索引。

我不确定是否有具有此功能的 VS2003-2005 插件。

对于方法/类的注释，VS 2008 没有本机工具，但是，对于 VS 2003-2005，sourceforge 上有一个开放项目，它在成员（命名空间）上方获取注释（''' 注释） 、类、方法、属性）标头（存储在类 .xml 文件中）和生成像 JavaDoc 这样的文档。对于 VS 2008，我开发了一个工具可以做同样的事情，如果你需要我可以分享。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T18:59:32.137

对于代码分析，我多年来一直在使用 Microsoft 的免费工具**FxCop**。

# php - PHP 调试 - 在哪里设置断点？如何认证？

> ID：343764
> 
> 赞同：1
> 
> 时间：2008-12-05T13:06:46.420
> 
> 标签：php, debugging, zend-framework, breakpoints, zend-debugger

所以我最近刚刚从使用 的临时调试和一些更复杂的方法迈出了一步`dump`，我遇到了困难。`print_r``echo`

我使用 Zend Framework、Aptana 和 Zend Debugger。

此时我正在尝试调试自定义控制器，无论我尝试什么，我都没有到达我理解的断点，因为在两者之间有身份验证并使用菜单。

**问题**：

1.  如何让我的应用程序在身份验证时中断，登录浏览器，导航到某个 uri，然后继续调试？
2.  使用 MVC 在 Zend Framework 中设置断点的好地方有哪些？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T13:54:32.003

设置一个常量会不会更容易，例如：

```
define('MODE_DEBUG', 1); 
```

然后检查身份验证过程：

```
if($obj->myLoginMethod() || constant('MODE_DEBUG') == 1){

} 
```

没有人能够注入这个常数，而最糟糕的事情是你最终因为我的错误离开了调试模式......

您可以在定义之前进行检查：

```
define('MODE_DEBUG', (false !== strpos($_SERVER['HTTP_HOST'], 'dev.mysite.com') ? 1 : 0)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-06T11:39:06.363

您想在请求中途更改当前用户的身份验证详细信息吗？

我不认为这是可能的。Zend Debugger 几乎是一个只读工具。即使是这样，您也假设您使用的任何框架都可以处理这个问题。这意味着它必须不断尝试将其内部状态与不断变化的输入数据同步。

我认为与其问我们如何解决这个特定问题，不如告诉我们为什么需要更改身份验证。听起来您正在调试器中启动一个脚本，但由于您没有用户会话而失败。

Zend Debugger 有一个浏览器工具栏 ( [http://files.zend.com/help/Zend-Studio-Eclipse-Help/zend_debugger_toolbar.htm](http://files.zend.com/help/Zend-Studio-Eclipse-Help/zend_debugger_toolbar.htm) ) 允许您为当前页面启动一个调试器；调试器将包含浏览器发送的所有信息：cookie、发布数据等。甚至还有一个“调试下一页”设置可以帮助您调试 POST 表单。听起来这就是你想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-06T22:27:17.070

也许您只需要重新考虑转储解决方案（我喜欢使用断点的想法，但在遇到像您经验丰富的打嗝后又转回来，我使用 Zend Studio）。为了调试我的应用程序，我使用 Zend_Log 和 Zend_Log 的[firebug writer](http://framework.zend.com/manual/en/zend.log.writers.html#zend.log.writers.firebug)。firebug 将日志输出到[firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)（注意，您还必须安装 firefox 的[firephp](http://www.firephp.org/)扩展）。将记录器存储在您的注册表中，您可以完成大量调试，而不会因为丑陋的转储而弄乱您的视图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T16:17:54.427

Ok so I played with zend debugger some more. (your question stirred up old demons) and I finally figured out the "proper" way to debug. To answer your initial question to debug after login I would say install the zend toolbar for firefox or IE. To the right of the Debug menu item there is a drop down with some options. One of the options is "next page". So you can go to your login screen select "Next Page" and then put in your credentials and submit and the NEXT page is what is debugged.

# python - 如何在 moinmoin 中使用 InterWiki 链接？

> ID：343769
> 
> 赞同：2
> 
> 时间：2008-12-05T13:08:12.643
> 
> 标签：python, wiki, moinmoin

我们在公司中使用了许多不同的 Web 服务，wiki(moinmoin)、bugtracker（内部）、requestracker（客户连接）、subversion。有没有办法解析维基页面，这样如果我写“......在 Bug1234 中你可以......” Bug1234 将被渲染为指向`http://mybugtracker/bug1234`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T14:06:51.587

查看 moinmoin 中的 interwiki 页面，（大多数 wiki 都有它们）例如，我们使用 trac，您可以设置不同的链接路径以指向不同的 Web 资源。因此，在我们的 Trac 中，您可以转到 [[SSGWiki:Some Topic]]，它将指向另一个内部 wiki。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-19T12:58:37.703

添加到文件中`data/intermap.txt`（如果不存在则创建，但不应该发生）一行

```
wpen http://en.wikipedia.org/wiki/ 
```

这样你就可以写`[[wpen:MoinMoin]]`而不是`http://en.wikipedia.org/wiki/MoinMoin`

我也有

```
wpfr http://fr.wikipedia.org/wiki/
wpde http://de.wikipedia.org/wiki/ 
```

还提供了其他示例，这些`data/intermap.txt`示例就像 Firefox 中的书签一样。在您的情况下，使用：

```
tracker http://mybugtracker/ 
```

你会发出`[[tracker:bug1234]]`

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-05T12:26:21.090

我终于找到了解决方案。“将站点添加到 data/intermap.txt”，位于：

[http://moinmo.in/MoinMoinQuestions#MoinMoinQuestions.2BAC8-Administration.Howtoaddnewinterwikisites.3F](http://moinmo.in/MoinMoinQuestions#MoinMoinQuestions.2BAC8-Administration.Howtoaddnewinterwikisites.3F)

# java - 如何在 Java 中创建（和读取）Windows 快捷方式（.lnk 文件）？

> ID：343776
> 
> 赞同：5
> 
> 时间：2008-12-05T13:11:00.810
> 
> 标签：java, windows, shortcuts

[同样的问题](https://stackoverflow.com/questions/234231/how-do-you-create-an-application-shortcut-lnk-file-in-c-or-net)，不同的语言。

你如何在 Java 中做到这一点？你使用 JNI 吗？运行exe？或者是否有像 POI 读/写 *.xls 这样的库读/写 *.lnk？

我曾经解决方法来创建[纯文本 INI 文件](http://www.fmtz.com/formats/url-file-format/article)的“.url” 。但我正在寻找其他有趣的方式来做到这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T14:54:55.187

如果目标是质量，我会使用 JNI 接口。

[http://alumnus.caltech.edu/~jimmc/jshortcut/](http://alumnus.caltech.edu/~jimmc/jshortcut/)

对于快速破解，（仅在我的工作站上）： System.Exec() 一个 vbscript :-) （我知道，我知道）。

# hibernate - 需要多少个 .hbm 文件来表示 Hibernate 继承？

> ID：343779
> 
> 赞同：0
> 
> 时间：2008-12-05T13:11:45.350
> 
> 标签：hibernate, inheritance

为了表示继承，需要多少个 hbm 文件？

如何在子类 hbm 文件中表示基类和子类之间的关系？

我想要超类和子类的 hbm 和 pojo 类。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T02:19:50.233

[http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-declaration-subclass](http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-declaration-subclass)

使用“subclass”、“joined-subclass”或“union-subclass”元素的“extends”属性。您可以将所有类放在同一个 .hbm 文件中，也可以根据需要将它们拆分为单独的文件。

# c# - SystemSounds 播放不工作

> ID：343790
> 
> 赞同：4
> 
> 时间：2008-12-05T13:14:34.407
> 
> 标签：c#, audio

我正在尝试从 C# 程序中播放 Asterisk 系统声音

```
System.Media.SystemSounds.Asterisk.Play(); 
```

但没有声音播放。我的系统确实为 Asterisk 设置了声音，而其他程序（不是我编写的）会导致播放各种系统声音。

任何人都可以提出任何可能的原因吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-30T09:18:58.160

直到今天我都忽略了这个问题。一些谷歌搜索显示这是一个很常见的问题，与 .NET Play 调用完全无关。

发生的情况是，虽然您可以从控制面板声音和音频设备小程序播放/预览声音，但在程序触发声音时它们不会播放。这似乎是由程序安装引起的损坏。修复非常简单。

注册表中 HKEY_CURRENT_USER 的（默认）条目应为（未设置值）。如果是其他内容（我的是 OfficeCompleted），请删除该条目（右键单击并选择删除）并将其重新创建为（未设置值）。然后应该播放系统声音。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T15:17:26.390

对不起，如果这夸大了显而易见的......

1.  你确定这行代码正在执行吗？
2.  正如 RobS 所建议的那样，其他 SystemSounds 会播放吗？

我看了一下反光板。无论您调用哪个 SystemSound，都会返回一个使用您要播放的系统声音的类型（例如 Asterix 的 0x40）初始化的 SystemSound 实例。然后将其传递给 Win32 bool MessageBeep( int type ) 方法。导入为：

```
[DllImport("user32.dll", CharSet=CharSet.Auto, ExactSpelling=true)]
internal static extern bool MessageBeep(int type); 
```

bool return 不会以任何方式保留 - 即你无法得到它:(

异常不会被吞下，因此如果抛出异常，您应该得到任何异常。

希望有帮助（虽然可能只是告诉你你已经知道的）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-07T19:07:33.260

我只迟到了 8 年，但我刚刚在 Windows 7 平板电脑上遇到了这个问题。修复它的东西？经典`Restart`。

尝试重新启动设备。

# .net - 指定重复作业或任务的执行时间的最佳方法是什么？

> ID：343795
> 
> 赞同：1
> 
> 时间：2008-12-05T13:17:07.007
> 
> 标签：.net, logic, scheduled-tasks, recurrence

我正在寻找一种有效指定重复作业执行时间的方法，而无需将显式执行时间写入数据存储。换句话说，与其说“作业 x 下一个在 11.12.08 下午 13:00 运行”，然后必须在作业运行后更新下一周的执行时间，我希望能够说“作业 x 在每个星期四下午 13 点”。我需要能够指定从几分钟到每月一次的任何重复范围。我的猜测是复发期越短，这就越困难。有任何想法吗？

注意：我不是在寻找有关调度**机制**的建议。我无法使用 Windows 调度程序、Cron 或创建 Windows 服务（我别无选择，只能在 ASP.NET 中使用后台线程）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T13:32:55.090

我已经看到广泛用于执行此操作的 cron 表达式，它可能作为一种内部表示格式工作得很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T20:32:14.720

我同意 kamal 的观点，即 Cron 可能是配置调度程序的最简单的解决方案。它非常灵活——你可以配置它来做任何事情（在合理的范围内）。

我过去使用[Quartz.NET](http://quartznet.sourceforge.net/)进行调度。它提供了一个 CronTrigger - 请参阅教程。您可以在运行 Quartz 调度程序的 Web 应用程序中创建一个线程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-20T17:57:54.173

我实现了一些无人值守的服务（用 c# 编写的 Windows 服务），使用 cron 来管理调度。该模式功能强大且灵活。我们可以在任何时间创建计划，只使用 cron 表达式。也许我错了，但我认为 cron 唯一没有涵盖的时间表是如果我们想要一个月的最后一天，但这从来都不是所有服务的要求。

我从互联网上的一篇文章（由 Atif Aziz 开源）中复制了 cron 算法，并在我的实用程序类中实现，多年来运行良好。

在我的博客中查看更多详细信息： [CronTab 调度解析器算法](http://blog.robertolopes.com/2010/11/17/crontab-schedule-parser-algorithm/)

干杯!

罗伯托

# perforce - 如何在 Perforce 中搜索历史记录

> ID：343799
> 
> 赞同：7
> 
> 时间：2008-12-05T13:18:05.913
> 
> 标签：perforce

在 P4V 中似乎没有办法做到这一点。

我可以使用“提交的更改列表”，但它很麻烦，我只能按用户和工作区搜索。

**我想按描述搜索历史。**

有什么简单的方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T14:43:39.830

If you are on Windows, P4Win has a "Find string" menu item that works on all the fields in the Submitted Changelists - very handy.

You can also do what you want from the command line, by piping the output of `p4 changes` through `grep` or something similar.

# jquery - 有 jQuery Click 方法吗？

> ID：343811
> 
> 赞同：25
> 
> 时间：2008-12-05T13:21:59.057
> 
> 标签：jquery

我正在尝试使用 jquery 单击链接。似乎只有一个单击事件可以复制“onclick”（即用户输入）。是否可以使用 jquery 实际单击链接？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-05T15:35:05.373

从你的回答：

```
$("a[0]") 
```

不是有效的选择器。要获得页面上的第一个 a ，请使用：

```
$("a:first") 
```

或者

```
$("a").eq(0). 
```

因此，对于您答案中的选择器：

```
$("table[1]/tr[1]/td[1]/a").trigger('click'); 
```

写

```
$("table").eq(1).children("tr").eq(1).children('td').eq(1).children('a').click(); 
```

请注意，这将如何单击页面上第二个表格中第二个表格行的第二个表格单元格中的所有链接。
如果您使用此方法将页面重定向到 a 的 href，则以下方法会稍微好一些：

```
document.location = $("table").eq(1).children("tr").eq(1).children('td').eq(1).children('a').attr('href'); 
```

请注意，这将如何将文档位置设置为在页面上第二个表格中找到的第二个表格行的第二个表格单元格中找到的第一个 a 的 href。
如果要匹配第一个元素，请使用 eq(0) 而不是 eq(1)。

**编辑**
如果你真的想这样做 1337-haxxor

```
$("table:eq(1) > tr:eq(1) > td:eq(1) > a").click(); 
```

但是我认为另一种方法更具可读性。

**编辑**

好的，从你的下一个答案/问题
开始，不实际点击链接，而只是将 document.location 字符串设置为它怎么样：

```
document.location = $("table").eq(0).children("tr").eq(0).children('td').eq(0).children('a').eq(0).attr('href'); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-05T13:30:56.387

为了可读性，我更喜欢[$(-some object-).click()](http://docs.jquery.com/Events/click)

如果将 click() 方法传递给函数，它的行为类似于 onClick 事件绑定：

即 $(-some object-).click(function() { -do stuff- })

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T13:28:41.197

$(-some object-).trigger('click') 应该可以解决问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-05T01:45:24.770

这成功地工作：

```
 $(document).ready(function() {
        $("#horizontalSlideButton").trigger('click');
    }); 
```

其中horizo​​ntalSlideButton 是您要为其触发点击事件的链接的ID。

一旦加载了 DOM，就会加载 $(document).ready(function() {} 的内容。

如果这有帮助，请标记！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-04-28T15:58:49.000

我遇到了类似的问题，发现通过创建一个假事件对象然后使用 dispatchEvent() 调度它可以很好地复制用户点击：

```
var event = document.createEvent("HTMLEvents");
event.initEvent("click", true, true);
document.getElementById('myID').dispatchEvent(event); 
```

显然这不是使用 JQuery，但它可能对您的任务有所帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-14T16:57:49.813

```
$("table:first").find("tr:first").find("td:first").find("a:first")[0].click(); 
```

如果那是您唯一的目标，这将在 Internet Explorer 中工作，否则您将无法使用 document.location 解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T16:56:44.223

试试这种方式：

```
$("table:first").find("tr:first").find("td:first").find("a:first").click(); 
```

这将触发第一个表中第一行的第一个单元格中第一个 a 的 onclick 事件......并且它本身非常可读。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-07-27T12:43:55.440

我更喜欢使用实时功能，例如（对于一个类）

```
 $(document).ready(function() {
    $(".myclass").live('click', function(){//do something});

}); 
```

或用于 id

```
 $(document).ready(function() {
    $("#myid").live('click', function(){//do something});

}); 
```

我使用 span 类来设置我的链接的样式并给它一个类或 id

```
 <span class="link"><a href="javascript:void(0);" target="_new">my link/a></span> 
```

# sharepoint - CAML 是查询 MOSS 的唯一方法吗？

> ID：343820
> 
> 赞同：3
> 
> 时间：2008-12-05T13:24:46.743
> 
> 标签：sharepoint, moss, wss, caml

CAML 很难学习，也很难使用，除了使用 CAML 查询之外，还有更好的方法从 MOSS 中获取结果吗？而不是指速度较慢的 Web 服务或对象模型，后者同样速度较慢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T19:12:55.837

本质上，是的，您至少需要能够阅读和理解 CAML。但是，您可能可以不写它。我用过这些工具：

U2U 的 U2U CAML 查询生成器 -[下载](http://www.u2u.be/res/Tools/CamlQueryBuilder.aspx)和[在线](http://www.u2u.be/res/Tools/SharePointCamlQueryBuilder.aspx)

Carlos Segura Sanz 的另一个 CAML 查询工具（如果您知道 SQL，那就太好了） - [CodePlex](http://yacamlqt.codeplex.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T07:54:00.807

还有一个 Linq to Sharepoint 提供程序，它提供了通过 CAML 使用 Linq 语法的能力——绝对值得一看。

[Linq To Sharepoint 提供程序](http://www.codeplex.com/LINQtoSharePoint)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-02T12:41:44.377

是的，Sharepoint 2010 引入了一个名为 SPMetal 的工具，使用它我们可以让实体代表我们网站中的列表。我们可以使用 SPMetal 和 Linq 执行 CRUD（创建读取更新删除）操作。

[此链接](http://yogeshlotlikar.wordpress.com/2012/03/22/using-spmetal-parameters/)向您展示如何使用 SPMetal 和参数生成自定义实体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T13:49:10.343

我取决于你想做什么。
您还可以使用 MOSS 搜索引擎来搜索文档。

[http://msdn.microsoft.com/en-us/library/ms544561.aspx](http://msdn.microsoft.com/en-us/library/ms544561.aspx)

# jquery - 在 Internet Explorer(IE) 中可拖动的 jquery ui - 对象不支持此方法

> ID：343836
> 
> 赞同：0
> 
> 时间：2008-12-05T13:29:39.213
> 
> 标签：jquery, jquery-ui, internet-explorer, draggable, jquery-ui-draggable

当我尝试在 IE 中执行以下代码时：

```
 <script type="text/javascript">
        google.load("jquery", 1);
        google.load("jqueryui", "1.5.3");

  $(document).ready(function()        
  {            
    $("#main-dialog").draggable();        
  });    

</script>

<div id="main-dialog">    
  This is just some simple content 
</div> 
```

我收到以下错误消息：

> 对象不支持此属性或方法

为什么我会收到此错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T15:45:35.210

也许这是我对 google ajax API 的无知，但是在您使用参数 '1' 加载 jquery 的地方尝试使用 '1.2.6' 以确保它是您正在使用的最新版本。它可能有一个错误修复。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-14T03:06:30.637

我遇到了一个与此类似的错误，原来我的自定义 jQuery UI 下载缺少一些依赖项。尝试返回 jQuery UI 站点并再次下载，但选中所有框。

# tomcat - 如何配置 Tomcat 5.5 以针对 Win2003 Activedirectory(LDAP) 进行身份验证

> ID：343841
> 
> 赞同：3
> 
> 时间：2008-12-05T13:31:41.440
> 
> 标签：tomcat, active-directory, ldap

如何配置 Tomcat 5.5 以针对 Win2003 Activedirectory(LDAP) 进行身份验证

默认tomcat配置需要做哪些更改，至少需要更改server.xml才能获得Win2003服务器的IP？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T15:03:31.033

我不知道是否可以使用 IE 进行“自动”登录。

但是您可以使用“经典”登录表单（Java EE 样式）并让 Tomcat 使用 JNDI 领域对 Active Directory 执行登录。

更改 server.xml 中的默认领域或在应用程序的 context.xml 中设置领域，如下所示：

```
 <Realm
        className="org.apache.catalina.realm.JNDIRealm"
        debug="99"
        connectionURL="ldap://your-activedirectory-server:389"
        connectionName="a user with read access to AD (optional if anonymous access is permitted)"
        connectionPassword="password"
        referrals="follow"
        userBase="where to look for users, for instance: DC=mycompany,DC=com"
        userSearch="(sAMAccountName={0})"
        userSubtree="true"
        roleBase="where to look for groups, for instance: DC=mycompany,DC=com"
        roleName="cn"
        roleSearch="(member={0})"
        roleSubtree="true"/> 
```

更多信息在这里：[Apache Tomcat 5.5 Realm Configuration HOW-TO](http://tomcat.apache.org/tomcat-5.5-doc/realm-howto.html#JNDIRealm)

并且：[活动目录集成](http://www.jspwiki.org/wiki/ActiveDirectoryIntegration)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T16:09:34.867

[使用 Active Directory 配置 Tomcat](http://wiki.openi.org/index.php/Configuring_Tomcat_With_Active_Directory)。没试过。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T11:34:31.440

我想要从活动目录中选择用户名的 LDAP 登录，当您使用 firefox 等时，浏览器将显示 user+pwd 对话框。

如果 IE 自动握手没关系，但它不是必需的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-16T15:52:28.417

> @thanks，catalina 日志现在显示：PartialResultException LDAP 错误 10 任何想法如何解决它？– 汤姆 12 月 11 日

我已经看到了这个错误，它阻止了我。我发现 LDAP 服务器没有返回我请求的邮件

```
seen below:--   emailAddress=mail

User Property Names Mapping : userId=sAMAccountName,name=cn,emailAddress=displayName 
```

发现更改为被退回的东西是一种享受，即`displayName`。

# algorithm - 确定输入是否是完美正方形的好算法是什么？

> ID：343852
> 
> 赞同：94
> 
> 时间：2008-12-05T13:35:31.027
> 
> 标签：algorithm, math, perfect-square

> **可能重复：**
> [确定整数的平方根是否为整数的最快方法](https://stackoverflow.com/questions/295579/fastest-way-to-determine-if-an-integers-square-root-is-an-integer)

有什么方法可以查看一个数字是否是一个[完美的正方形](http://en.wikipedia.org/wiki/Square_number)？

```
bool IsPerfectSquare(long input)
{
   // TODO
} 
```

我正在使用 C#，但这与语言无关。

清晰和简单的加分点（这并不意味着代码高尔夫）。

* * *

**编辑：**这比我预期的要复杂得多！事实证明，双精度的问题体现在几个方面。首先，Math.Sqrt 需要一个不能精确保持长的双精度（感谢乔恩）。

其次，当你有一个巨大的、近乎完美的正方形时，双精度会丢失小的值（0.000...00001）。例如，我的实现未通过 Math.Pow(10,18)+1 的此测试（我的报告为真）。

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2008-12-05T13:41:05.167

```
bool IsPerfectSquare(long input)
{
    long closestRoot = (long) Math.Sqrt(input);
    return input == closestRoot * closestRoot;
} 
```

这可能会避免仅检查“平方根是否为整数”的*一些问题，但可能不是全部。*你可能需要变得更时髦一点：

```
bool IsPerfectSquare(long input)
{
    double root = Math.Sqrt(input);

    long rootBits = BitConverter.DoubleToInt64Bits(root);
    long lowerBound = (long) BitConverter.Int64BitsToDouble(rootBits-1);
    long upperBound = (long) BitConverter.Int64BitsToDouble(rootBits+1);

    for (long candidate = lowerBound; candidate <= upperBound; candidate++)
    {
         if (candidate * candidate == input)
         {
             return true;
         }
    }
    return false;
} 
```

Icky，除了非常大的值之外，其他任何东西都是不必要的，但我认为它*应该*工作......

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-05T13:42:24.493

```
bool IsPerfectSquare(long input)
{
    long SquareRoot = (long) Math.Sqrt(input);
    return ((SquareRoot * SquareRoot) == input);
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-05T13:45:56.293

在 Common Lisp 中，我使用以下内容：

```
(defun perfect-square-p (n)
  (= (expt (isqrt n) 2)
     n)) 
```

# javascript - 如何在 python 或 Javascript 中将 UTM 转换为 LatLng

> ID：343865
> 
> 赞同：31
> 
> 时间：2008-12-05T13:42:34.977
> 
> 标签：javascript, python, gis, arcgis-js-api, proj4js

我有一堆带有 UTM 形式坐标的文件。对于每个坐标，我都有东、北和区域。我需要将其转换为 LatLng 以与 Google Map API 一起使用以在地图中显示信息。

我发现一些在线计算器可以做到这一点，但没有实际的代码或库。[http://trac.osgeo.org/proj4js/](http://trac.osgeo.org/proj4js/)是 Javascript 的投影库，但看演示它不包括 UTM 投影。

我对整个 GIS 领域仍然很陌生，所以我想要的是 ala：

```
(lat,lng) = transform(easting, northing, zone) 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-12-05T15:04:59.317

我最终从 IBM 找到了解决它的 java 代码：http: [//www.ibm.com/developerworks/java/library/j-coordconvert/index.html](http://www.ibm.com/developerworks/java/library/j-coordconvert/index.html)

仅供参考，这是我需要的方法的python实现：

```
import math

def utmToLatLng(zone, easting, northing, northernHemisphere=True):
    if not northernHemisphere:
        northing = 10000000 - northing

    a = 6378137
    e = 0.081819191
    e1sq = 0.006739497
    k0 = 0.9996

    arc = northing / k0
    mu = arc / (a * (1 - math.pow(e, 2) / 4.0 - 3 * math.pow(e, 4) / 64.0 - 5 * math.pow(e, 6) / 256.0))

    ei = (1 - math.pow((1 - e * e), (1 / 2.0))) / (1 + math.pow((1 - e * e), (1 / 2.0)))

    ca = 3 * ei / 2 - 27 * math.pow(ei, 3) / 32.0

    cb = 21 * math.pow(ei, 2) / 16 - 55 * math.pow(ei, 4) / 32
    cc = 151 * math.pow(ei, 3) / 96
    cd = 1097 * math.pow(ei, 4) / 512
    phi1 = mu + ca * math.sin(2 * mu) + cb * math.sin(4 * mu) + cc * math.sin(6 * mu) + cd * math.sin(8 * mu)

    n0 = a / math.pow((1 - math.pow((e * math.sin(phi1)), 2)), (1 / 2.0))

    r0 = a * (1 - e * e) / math.pow((1 - math.pow((e * math.sin(phi1)), 2)), (3 / 2.0))
    fact1 = n0 * math.tan(phi1) / r0

    _a1 = 500000 - easting
    dd0 = _a1 / (n0 * k0)
    fact2 = dd0 * dd0 / 2

    t0 = math.pow(math.tan(phi1), 2)
    Q0 = e1sq * math.pow(math.cos(phi1), 2)
    fact3 = (5 + 3 * t0 + 10 * Q0 - 4 * Q0 * Q0 - 9 * e1sq) * math.pow(dd0, 4) / 24

    fact4 = (61 + 90 * t0 + 298 * Q0 + 45 * t0 * t0 - 252 * e1sq - 3 * Q0 * Q0) * math.pow(dd0, 6) / 720

    lof1 = _a1 / (n0 * k0)
    lof2 = (1 + 2 * t0 + Q0) * math.pow(dd0, 3) / 6.0
    lof3 = (5 - 2 * Q0 + 28 * t0 - 3 * math.pow(Q0, 2) + 8 * e1sq + 24 * math.pow(t0, 2)) * math.pow(dd0, 5) / 120
    _a2 = (lof1 - lof2 + lof3) / math.cos(phi1)
    _a3 = _a2 * 180 / math.pi

    latitude = 180 * (phi1 - fact1 * (fact2 + fact3 + fact4)) / math.pi

    if not northernHemisphere:
        latitude = -latitude

    longitude = ((zone > 0) and (6 * zone - 183.0) or 3.0) - _a3

    return (latitude, longitude) 
```

在这里，我认为这是一些简单的`easting*x+zone*y`东西。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-05T14:21:28.937

我找到的是以下站点：[http](http://home.hiwaay.net/~taylorc/toolbox/geography/geoutm.html) ://home.hiwaay.net/~taylorc/toolbox/geography/geoutm.html 它有一个javascript转换器，你应该在那里检查算法。从页面：

> 程序员：本文档中的 JavaScript 源代码可以不受限制地复制和重复使用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-05T14:58:52.280

根据this page，proj4js支持UTM。

[http://trac.osgeo.org/proj4js/wiki/UserGuide#Supportedprojectionclasses](http://trac.osgeo.org/proj4js/wiki/UserGuide#Supportedprojectionclasses)

您可能还想看看[GDAL](http://gdal.org)。gdal 库具有出色的 python 支持，但如果您只进行投影转换，它可能有点矫枉过正。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-04-20T03:01:42.713

我也是这方面的新手，最近一直在研究这个主题。

这是我使用 python [gdal](http://pypi.python.org/pypi/GDAL) pacakge 找到的一种方法（*osr*包包含在 gdal 中）。gdal 包非常强大，但文档可能会更好。

这来自这里的讨论：http: [//www.mail-archive.com/gdal-dev@lists.osgeo.org/msg12398.html](http://www.mail-archive.com/gdal-dev@lists.osgeo.org/msg12398.html)

```
import osr

def transform_utm_to_wgs84(easting, northing, zone):
    utm_coordinate_system = osr.SpatialReference()
    utm_coordinate_system.SetWellKnownGeogCS("WGS84") # Set geographic coordinate system to handle lat/lon
    is_northern = northing > 0    
    utm_coordinate_system.SetUTM(zone, is_northern)

    wgs84_coordinate_system = utm_coordinate_system.CloneGeogCS() # Clone ONLY the geographic coordinate system 

    # create transform component
    utm_to_wgs84_transform = osr.CoordinateTransformation(utm_coordinate_system, wgs84_coordinate_system) # (<from>, <to>)
    return utm_to_wgs84_transform.TransformPoint(easting, northing, 0) # returns lon, lat, altitude 
```

这是从 wgs84（大多数 gps 单位报告的）中的 lat、lon 转换为 utm 的方法：

```
def transform_wgs84_to_utm(lon, lat):    
    def get_utm_zone(longitude):
        return (int(1+(longitude+180.0)/6.0))

    def is_northern(latitude):
        """
        Determines if given latitude is a northern for UTM
        """
        if (latitude < 0.0):
            return 0
        else:
            return 1

    utm_coordinate_system = osr.SpatialReference()
    utm_coordinate_system.SetWellKnownGeogCS("WGS84") # Set geographic coordinate system to handle lat/lon  
    utm_coordinate_system.SetUTM(get_utm_zone(lon), is_northern(lat))

    wgs84_coordinate_system = utm_coordinate_system.CloneGeogCS() # Clone ONLY the geographic coordinate system 

    # create transform component
    wgs84_to_utm_transform = osr.CoordinateTransformation(wgs84_coordinate_system, utm_coordinate_system) # (<from>, <to>)
    return wgs84_to_utm_transform.TransformPoint(lon, lat, 0) # returns easting, northing, altitude 
```

我还发现，如果您已经安装了 django/gdal，并且您知道您正在处理的 UTM 区域的[EPSG代码，则可以使用](http://reference.mapinfo.com/common/docs/mapxtend-dev-web-none-eng/miaware/doc/guide/xmlapi/coordsys/systems.htm)`Point()` *transform()*方法。

```
from django.contrib.gis.geos import Point
utm2epsg = {"54N": 3185, ...}
p = Point(lon, lat, srid=4326) # 4326 = WGS84 epsg code
p.transform(utm2epsg["54N"]) 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-12-09T21:17:17.137

Staale 答案的 Javascript 版本

```
function utmToLatLng(zone, easting, northing, northernHemisphere){
        if (!northernHemisphere){
            northing = 10000000 - northing;
        }

        var a = 6378137;
        var e = 0.081819191;
        var e1sq = 0.006739497;
        var k0 = 0.9996;

        var arc = northing / k0;
        var mu = arc / (a * (1 - Math.pow(e, 2) / 4.0 - 3 * Math.pow(e, 4) / 64.0 - 5 * Math.pow(e, 6) / 256.0));

        var ei = (1 - Math.pow((1 - e * e), (1 / 2.0))) / (1 + Math.pow((1 - e * e), (1 / 2.0)));

        var ca = 3 * ei / 2 - 27 * Math.pow(ei, 3) / 32.0;

        var cb = 21 * Math.pow(ei, 2) / 16 - 55 * Math.pow(ei, 4) / 32;
        var cc = 151 * Math.pow(ei, 3) / 96;
        var cd = 1097 * Math.pow(ei, 4) / 512;
        var phi1 = mu + ca * Math.sin(2 * mu) + cb * Math.sin(4 * mu) + cc * Math.sin(6 * mu) + cd * Math.sin(8 * mu);

        var n0 = a / Math.pow((1 - Math.pow((e * Math.sin(phi1)), 2)), (1 / 2.0));

        var r0 = a * (1 - e * e) / Math.pow((1 - Math.pow((e * Math.sin(phi1)), 2)), (3 / 2.0));
        var fact1 = n0 * Math.tan(phi1) / r0;

        var _a1 = 500000 - easting;
        var dd0 = _a1 / (n0 * k0);
        var fact2 = dd0 * dd0 / 2;

        var t0 = Math.pow(Math.tan(phi1), 2);
        var Q0 = e1sq * Math.pow(Math.cos(phi1), 2);
        var fact3 = (5 + 3 * t0 + 10 * Q0 - 4 * Q0 * Q0 - 9 * e1sq) * Math.pow(dd0, 4) / 24;

        var fact4 = (61 + 90 * t0 + 298 * Q0 + 45 * t0 * t0 - 252 * e1sq - 3 * Q0 * Q0) * Math.pow(dd0, 6) / 720;

        var lof1 = _a1 / (n0 * k0);
        var lof2 = (1 + 2 * t0 + Q0) * Math.pow(dd0, 3) / 6.0;
        var lof3 = (5 - 2 * Q0 + 28 * t0 - 3 * Math.pow(Q0, 2) + 8 * e1sq + 24 * Math.pow(t0, 2)) * Math.pow(dd0, 5) / 120;
        var _a2 = (lof1 - lof2 + lof3) / Math.cos(phi1);
        var _a3 = _a2 * 180 / Math.PI;

        var latitude = 180 * (phi1 - fact1 * (fact2 + fact3 + fact4)) / Math.PI;

        if (!northernHemisphere){
          latitude = -latitude;
        }

        var longitude = ((zone > 0) && (6 * zone - 183.0) || 3.0) - _a3;

        var obj = {
              latitude : latitude,
              longitude: longitude
        };

        return obj;
      } 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-09-04T18:30:40.070

您可以使用 Proj4js，如下所示。

[使用此](https://github.com/proj4js/proj4js)链接从 GitHub 下载 Proj4JS 。

以下代码将从UTM转换为经度纬度

```
<html>
<head>
  <script src="proj4.js"></script>

  <script>
    var utm = "+proj=utm +zone=32";
    var wgs84 = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";
    console.log(proj4(utm,wgs84,[539884, 4942158]));
  </script>
</head>
<body>

</body>
</html> 
```

在这段代码中，UTM 区域是 32，这应该很明显。东距为 539884，北距为 4942158。结果为：

```
[9.502832656648073, 44.631671014204365] 
```

也就是说 44.631671014204365N，9.502832656648073E。我已经[验证](http://www.rcn.montana.edu/resources/tools/coordinates.aspx?nav=11&c=UTM&md=83&mdt=NAD83/WGS84&z=32&e=539884&n=4942158&h=N)是正确的。

如果您需要其他投影，可以在[此处](http://spatialreference.org/ref/epsg/4326/)找到它们的字符串。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2021-12-10T19:10:30.787

有一个 Python 库（[utm](https://github.com/Turbo87/utm)）“用于 Python 的双向 UTM-WGS84 转换器”，可以管理单个坐标点或系列。

将 (latitude, longitude) 元组转换为 UTM 坐标：

```
>>> utm.from_latlon(51.2, 7.5) 
```

结果

```
(395201.3103811303, 5673135.241182375, 32, 'U') 
```

返回有形式`(EASTING, NORTHING, ZONE_NUMBER, ZONE_LETTER)`。

如果使用系列，结果 EASTING 和 NORTHING 将具有相同的形状。

```
>>> utm.from_latlon(np.array([51.2, 49.0]), np.array([7.5, 8.4])) 
```

结果

```
(array([395201.31038113, 456114.59586214]), array([5673135.24118237, 5427629.20426126]), 32, 'U') 
```

相反，将 UTM 坐标转换为 (latitude, longitude) 元组：

```
>>> utm.to_latlon(340000, 5710000, 32, 'U') 
```

```
(51.51852098408468, 6.693872395145327) 
```

用语法`utm.to_latlon(EASTING, NORTHING, ZONE_NUMBER, ZONE_LETTER)`。如果要使用系列，在这种情况下也是如此。根据文档，传递一系列比对函数的多次单点调用更快。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-07-18T14:00:41.733

```
////////////////////////////////////////////////////////////////////////////////////////////
//
// ToLL - function to compute Latitude and Longitude given UTM Northing and Easting in meters
//
//  Description:
//    This member function converts input north and east coordinates
//    to the corresponding Northing and Easting values relative to the defined
//    UTM zone.  Refer to the reference in this file's header.
//
//  Parameters:
//    north   - (i) Northing (meters)
//    east    - (i) Easting (meters)
//    utmZone - (i) UTM Zone of the North and East parameters
//    lat     - (o) Latitude in degrees 
//    lon     - (o) Longitude in degrees
//
function ToLL(north,east,utmZone)
{ 
  // This is the lambda knot value in the reference
  var LngOrigin = DegToRad(utmZone * 6 - 183)

  // The following set of class constants define characteristics of the
  // ellipsoid, as defined my the WGS84 datum.  These values need to be
  // changed if a different dataum is used.    

  var FalseNorth = 0\.  // South or North?
  //if (lat < 0.) FalseNorth = 10000000\.  // South or North?
  //else          FalseNorth = 0\.   

  var Ecc = 0.081819190842622       // Eccentricity
  var EccSq = Ecc * Ecc
  var Ecc2Sq = EccSq / (1\. - EccSq)
  var Ecc2 = Math.sqrt(Ecc2Sq)      // Secondary eccentricity
  var E1 = ( 1 - Math.sqrt(1-EccSq) ) / ( 1 + Math.sqrt(1-EccSq) )
  var E12 = E1 * E1
  var E13 = E12 * E1
  var E14 = E13 * E1

  var SemiMajor = 6378137.0         // Ellipsoidal semi-major axis (Meters)
  var FalseEast = 500000.0          // UTM East bias (Meters)
  var ScaleFactor = 0.9996          // Scale at natural origin

  // Calculate the Cassini projection parameters

  var M1 = (north - FalseNorth) / ScaleFactor
  var Mu1 = M1 / ( SemiMajor * (1 - EccSq/4.0 - 3.0*EccSq*EccSq/64.0 -
    5.0*EccSq*EccSq*EccSq/256.0) )

  var Phi1 = Mu1 + (3.0*E1/2.0 - 27.0*E13/32.0) * Math.sin(2.0*Mu1)
    + (21.0*E12/16.0 - 55.0*E14/32.0)           * Math.sin(4.0*Mu1)
    + (151.0*E13/96.0)                          * Math.sin(6.0*Mu1)
    + (1097.0*E14/512.0)                        * Math.sin(8.0*Mu1)

  var sin2phi1 = Math.sin(Phi1) * Math.sin(Phi1)
  var Rho1 = (SemiMajor * (1.0-EccSq) ) / Math.pow(1.0-EccSq*sin2phi1,1.5)
  var Nu1 = SemiMajor / Math.sqrt(1.0-EccSq*sin2phi1)

  // Compute parameters as defined in the POSC specification.  T, C and D

  var T1 = Math.tan(Phi1) * Math.tan(Phi1)
  var T12 = T1 * T1
  var C1 = Ecc2Sq * Math.cos(Phi1) * Math.cos(Phi1)
  var C12 = C1 * C1
  var D  = (east - FalseEast) / (ScaleFactor * Nu1)
  var D2 = D * D
  var D3 = D2 * D
  var D4 = D3 * D
  var D5 = D4 * D
  var D6 = D5 * D

  // Compute the Latitude and Longitude and convert to degrees
  var lat = Phi1 - Nu1*Math.tan(Phi1)/Rho1 *
    ( D2/2.0 - (5.0 + 3.0*T1 + 10.0*C1 - 4.0*C12 - 9.0*Ecc2Sq)*D4/24.0
     + (61.0 + 90.0*T1 + 298.0*C1 + 45.0*T12 - 252.0*Ecc2Sq - 3.0*C12)*D6/720.0 )

  lat = RadToDeg(lat)

  var lon = LngOrigin + 
    ( D - (1.0 + 2.0*T1 + C1)*D3/6.0
      + (5.0 - 2.0*C1 + 28.0*T1 - 3.0*C12 + 8.0*Ecc2Sq + 24.0*T12)*D5/120.0) / Math.cos(Phi1)

  lon = RadToDeg(lon)

  // Create a object to store the calculated Latitude and Longitude values
  var sendLatLon = new PC_LatLon(lat,lon)

  // Returns a PC_LatLon object
  return sendLatLon
}

////////////////////////////////////////////////////////////////////////////////////////////
//
//  RadToDeg - function that inputs a value in radians and returns a value in degrees
//
function RadToDeg(value)
{
  return ( value * 180.0 / Math.PI )
}

////////////////////////////////////////////////////////////////////////////////////////////
//
// PC_LatLon - this psuedo class is used to store lat/lon values computed by the ToLL 
//  function.
//
function PC_LatLon(inLat,inLon)
{
  this.lat       = inLat     // Store Latitude in decimal degrees
  this.lon       = inLon     // Store Longitude in decimal degrees
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-12-20T14:55:26.710

我在使用 proj4js 时遇到的一个问题是它需要@Richard 指出的确切区域。[我在这里](http://home.hiwaay.net/~taylorc/toolbox/geography/geoutm.html)找到了一个很好的资源，它可以将 WGS 转换为 UTM 并用 JavaScript 编写了一个更干净的包装器：

[https://github.com/urbanetic/utm-converter](https://github.com/urbanetic/utm-converter)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-07T13:04:24.000

通过 CPAN 有一个名为 Geography::NationalGrid 的 perl 模块，它可以将东/北转换为纬度/经度。这可能会有所帮助。

[或者，可移动式网站](http://www.movable-type.co.uk/scripts/latlong-gridref.html)上有很多脚本可以让您转换纬度/经度和东/北。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-08-22T13:51:49.430

Staale 的答案对我进行了小修改 - 数学模块无法处理 Pandas 系列，所以我用 numpy 替换了所有数学函数。

但是，检查 QGIS，我看到 UTM 和 LAT/LON 坐标之间的差异约为 4m。

下面的代码：

```
import numpy as np

def utmToLatLng(zone, easting, northing, northernHemisphere=True):
    if not northernHemisphere:
        northing = 10000000 - northing

a = 6378137
e = 0.081819191
e1sq = 0.006739497
k0 = 0.9996

arc = northing / k0
mu = arc / (a * (1 - np.power(e, 2) / 4.0 - 3 * np.power(e, 4) / 64.0 - 5 * np.power(e, 6) / 256.0))

ei = (1 - np.power((1 - e * e), (1 / 2.0))) / (1 + np.power((1 - e * e), (1 / 2.0)))

ca = 3 * ei / 2 - 27 * np.power(ei, 3) / 32.0

cb = 21 * np.power(ei, 2) / 16 - 55 * np.power(ei, 4) / 32
cc = 151 * np.power(ei, 3) / 96
cd = 1097 * np.power(ei, 4) / 512
phi1 = mu + ca * np.sin(2 * mu) + cb * np.sin(4 * mu) + cc * np.sin(6 * mu) + cd * np.sin(8 * mu)

n0 = a / np.power((1 - np.power((e * np.sin(phi1)), 2)), (1 / 2.0))

r0 = a * (1 - e * e) / np.power((1 - np.power((e * np.sin(phi1)), 2)), (3 / 2.0))
fact1 = n0 * np.tan(phi1) / r0

_a1 = 500000 - easting
dd0 = _a1 / (n0 * k0)
fact2 = dd0 * dd0 / 2

t0 = np.power(np.tan(phi1), 2)
Q0 = e1sq * np.power(np.cos(phi1), 2)
fact3 = (5 + 3 * t0 + 10 * Q0 - 4 * Q0 * Q0 - 9 * e1sq) * np.power(dd0, 4) / 24

fact4 = (61 + 90 * t0 + 298 * Q0 + 45 * t0 * t0 - 252 * e1sq - 3 * Q0 * Q0) * np.power(dd0, 6) / 720

lof1 = _a1 / (n0 * k0)
lof2 = (1 + 2 * t0 + Q0) * np.power(dd0, 3) / 6.0
lof3 = (5 - 2 * Q0 + 28 * t0 - 3 * np.power(Q0, 2) + 8 * e1sq + 24 * np.power(t0, 2)) * np.power(dd0, 5) / 120
_a2 = (lof1 - lof2 + lof3) / np.cos(phi1)
_a3 = _a2 * 180 / np.pi

latitude = 180 * (phi1 - fact1 * (fact2 + fact3 + fact4)) / np.pi

if not northernHemisphere:
    latitude = -latitude

longitude = ((zone > 0) and (6 * zone - 183.0) or 3.0) - _a3

return (latitude, longitude) 
```

这样我可以直接这样做：

```
df['LAT'], df['LON']=utmToLatLng(31, df['X'], df['Y'], northernHemisphere=True) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-11-19T15:03:55.330

将 @TreyA 转换为 kotlin（Java 库中的一些数学函数），仅针对它的情况。似乎比@Staale 和@sandino 更准确一些

```
 fun utmToLatLng2(
    north:Double?,
    east:Double?,
    zone:Long,
    northernHemisphere: Boolean
):LatLng?{

    if((north==null)||(east == null)) return null

    val lngOrigin = Math.toRadians(zone*6.0 - 183.0)
    val falseNorth = if(northernHemisphere) 0.toDouble() else 10000000.toDouble()

    val ecc = 0.081819190842622
    val eccSq = ecc*ecc
    val ecc2Sq = eccSq / (1.0 - eccSq)
    //var ecc2 = sqrt(ecc2Sq) //not in use ?
    val e1 = (1.0 - sqrt(1.0-eccSq))/(1.0 + sqrt(1-eccSq))
    val e12 = e1*e1
    val e13 = e12*e1
    val e14 = e13*e1

    val semiMajor = 6378137.0
    val falseEast = 500000.0
    val scaleFactor = 0.9996

    //Cassini

    val m1 = (north - falseNorth) / scaleFactor
    val mu1 = m1 / (semiMajor * (1.0 - eccSq/4.0 - 3.0*eccSq*eccSq/64.0 - 5.0*eccSq*eccSq*eccSq/256.0))

    val phi1 = mu1 +
            (3.0 * e1 / 2.0 - 27.0 * e13 / 32.0) * sin(2.0 * mu1) +
            (21.0 * e12 / 16.0 - 55.0 * e14 / 32.0) * sin(4.0 * mu1) +
            (151.0 * e13 / 96.0) * sin(6.0 * mu1) +
            (1097.0 * e14 / 512.0) * sin( 8.0 * mu1)

    val sin2phi1 = sin(phi1) * sin(phi1)
    val rho1 = (semiMajor * (1.0-eccSq)) / (1.0 - eccSq * sin2phi1).pow(1.5)
    val nu1 = semiMajor / sqrt(1.0-eccSq*sin2phi1)

    //POSC

    val t1 = tan(phi1)*tan(phi1)
    val t12 = t1*t1
    val c1 = ecc2Sq*cos(phi1)*cos(phi1)
    val c12 = c1*c1
    val d = (east - falseEast) / (scaleFactor*nu1)
    val d2 = d*d
    val d3 = d2*d
    val d4 = d3*d
    val d5 = d4*d
    val d6 = d5*d

    //Compute lat & lon convert to degree

    var lat =
        phi1 - nu1 * tan(phi1)/rho1 *
                (d2/2.0 - (5.0 + 3.0*t1 + 10*c1 - 4.0*c12 -9.0*ecc2Sq) * d4/24.0 +
                        (61.0 + 90.0*t1 +298.0*c1 + 45.0*t12 -252*ecc2Sq - 3.0*c12) * d6/720.0)

    lat = Math.toDegrees(lat)

    var lon =
        lngOrigin +
                (d - (1.0 + 2.0*t1 + c1)*d3/6.0 +
                        (5.0 - 2.0*c1 + 28.0*t1 - 3.0*c12 + 8.0*ecc2Sq + 24.0*t12)*d5/120.0) / cos(phi1)

    lon = Math.toDegrees(lon)

    return LatLng(lat,lon)

} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-03-01T18:29:15.597

在**Python**中，您还可以使用**[pyproj](https://pyproj4.github.io/pyproj/stable/installation.html)**包。找到您的 UTM 的 EPSG 代码（例如，[此处](https://epsg.io/)）。然后：

从**lat-lon**到**UTM**：

```
from pyproj import Transformer, CRS
crs = CRS.from_epsg(25833)  # put your desired EPSG code here
latlon2utm = Transformer.from_crs(crs.geodetic_crs, crs)
lats = [58.969, 59.911]  # latitudes of two Norwegian cities
lons = [5.732, 10.750]  # longitudes of two Norwegian cities
eastings, northings = latlon2utm.transform(lats, lons) 
```

从**UTM**到**lat-lon**：

```
utm2latlon = Transformer.from_crs(crs, crs.geodetic_crs)
latitudes, longitudes = utm2latlon.transform(eastings, northings) 
```

# .net - 有没有一种好方法可以在不同的架构层之间自动转换对象？

> ID：343866
> 
> 赞同：0
> 
> 时间：2008-12-05T13:43:21.527
> 
> 标签：.net

越来越多的应用程序需要相似对象的不同表示，例如，当与网络服务交叉或映射到数据库时。当您使用域模型时，您可能需要业务层/域模型中的一种对象（小，大量行为），而在跨越流程或网络边界（大，只有数据）或与数据库通信时（例如，LINQ to SQL 仅支持 DB 表和生成/映射对象之间的一对一映射）。

这意味着您必须编写大量代码来执行将相似对象相互转换/映射的死记硬背的任务。当然必须有某种框架或工具来帮助你做到这一点？还是手动编码是真正控制的唯一方法？我们已经研究过使用反射和 XML/属性映射来自己解决这个问题，但它很快就会变得相当复杂，例如，将一个对象上的子对象和列表或多个原语映射到另一个对象上的子对象。

我们在 .NET 3.5 上使用 C#。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T14:30:34.410

If the scenario permits it, you should always code against interfaces and abstractions, not against concrete classes. That way you can have a dedicated class/set of classes that deal with transforming one kind of objects into another - something along the lines of the Adapter pattern, for example. Maybe you could try and tweak your design in that direction.
And yes, I think manual coding is the only way to really be in control.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-02-19T23:14:28.643

你可以试试[automapper](https://automapper.org/)，它是由经验丰富的老 C# 开发人员 Jimmy Bogard 开发的。

它很容易上手，只需安装它

```
PM> Install-Package AutoMapper 
```

配置它

```
Mapper.Initialize(cfg => {
    cfg.CreateMap<Foo, FooDto>();
    cfg.CreateMap<Bar, BarDto>();
}); 
```

并使用它！

```
var fooDto = Mapper.Map<FooDto>(foo);
var barDto = Mapper.Map<BarDto>(bar); 
```

### 编辑

据我了解问题是关于进行对象转换的工具，更具体地说是 DTO（数据传输对象）以在 api 中公开信息、接收数据和其他内容。

例如，我可以有一个实体用户

```
class User {
    int Id;
    int UserName;
    int LastUpdate;
} 
```

但是当你的 api 接收到一个对象来添加用户时，你只需要用户名

```
class AddUserFromApi {
    int UserName;
} 
```

因此，您需要从 AddUserFromApi 创建一个用户，同样用于编辑

```
class EditUserFromApi {
    int Id;
    int UserName;
} 
```

您需要编写代码将一个类转换为另一个类。正如页面所述，Automapper 正是为此而设计的工具：

> AutoMapper 是一个简单的小库，旨在解决一个看似复杂的问题——摆脱将一个对象映射到另一个对象的代码。这种类型的代码写起来相当枯燥乏味，那么为什么不发明一个工具来为我们做呢？

# c# - 取出特定命名空间的所有类

> ID：343869
> 
> 赞同：11
> 
> 时间：2008-12-05T13:44:29.807
> 
> 标签：c#, reflection, namespaces

有没有办法从特定的命名空间获取对象？也许与`System.Reflections`？我想从`ITestType`命名空间中的类型中获取所有对象`Test.TestTypes`作为对象，以便我有一个实例列表`TestType1, TestType2, TestType3`等等。有人能帮我吗？我不知道在哪里搜索。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-05T13:49:49.093

您可以找到程序集中的所有*类型*，并找到与给定命名空间匹配的所有类型（这对于 LINQ 来说非常容易）——但是如果您没有要查看的特定程序集，则需要检查*所有*可能的。

但是，如果您正在寻找一种查找所有活动*对象*的方法，那就另当别论了——据我所知，如果不使用分析器 API，您将无法做到这一点。（即使那样也可能很难——我不知道。）

这是 LINQ 查询：

```
public static IEnumerable<Type> GetTypesFromNamespace(Assembly assembly, 
                                               String desiredNamespace)
{
    return assembly.GetTypes()
                   .Where(type => type.Namespace == desiredNamespace);
} 
```

# windows - 如何从 CFindReplaceDialog 派生类？(MFC)

> ID：343877
> 
> 赞同：0
> 
> 时间：2008-12-05T13:45:59.913
> 
> 标签：windows, mfc

是否可以从 CFindEditDialog 派生自定义对话框？我想在 Viasual Studio Resource Builder 中构建一个对话框模板（绘制它），然后隐藏默认的 Find 对话框窗口并改用 my。

MSDN 说：

> 要自定义对话框，请从 CFindReplaceDialog 派生一个类，提供自定义对话框模板，并添加消息映射以处理来自扩展控件的通知消息。任何未处理的消息都应该传递给基类。
> 
> 不需要自定义钩子函数

有没有人有这方面的经验？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-07T07:24:19.747

虽然我对此没有直接经验（但与其他人很接近），但这是很有可能的，应该很容易。大多数消息将以虚拟方式实现，因此您可能需要使用添加的代码覆盖您感兴趣的消息。

代码项目有一篇关于 CFindEdit 的文章。这可能会有所帮助
[http://www.codeproject.com/KB/cpp/Media_PlayerByyazan_nemer.aspx](http://www.codeproject.com/KB/cpp/Media_PlayerByyazan_nemer.aspx) 如果您查看一个对话框的 oninitialize 事件，您应该看到事件是如何在继承类中工作的。

# jquery - jQuery绑定错误“未定义事件”

> ID：343878
> 
> 赞同：0
> 
> 时间：2008-12-05T13:46:37.370
> 
> 标签：jquery

目前我在标记中做这样的事情

```
<input type="text" ONKEYPRESS="InputNumeric(event);" id="txtNumber" /> 
```

但是出于所有明显的原因，我想使用 jQuery 绑定方法。

```
jQuery(function($)
{
    $("#txtNumber").bind("keyup", InputNumeric(event));
}); 
```

但是当我尝试上述方法时，出现以下错误

“未定义事件”

这个语法应该是什么样的？

**编辑**

我得到的实际解决方案如下所示。

```
$("#txtPriority").keypress(function (e) { InputInteger(e); }); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T13:58:05.193

```
jQuery(function($)
{
    $("#txtNumber").bind("keyup", function(event) {InputNumeric(event);});
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T14:04:35.493

看起来 InputNumeric 是一个将事件作为参数的现有函数，在这种情况下，这也应该有效

`$("#txtNumber").bind("keyup",InputNumeric);`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T15:34:54.500

通过 jquery 回调传回的参数总是隐含的，因此只需编写函数名就足够了。

```
$("#txtNumber").bind("keyup",InputNumeric);

function InputNumeric(event){
    $(event.target).dosomething(); // is the same as
    $(this).dosomething();
} 
```

示例： http: [//www.sanchothefat.com/dev/sfhelp/jquery-args.html](http://www.sanchothefat.com/dev/sfhelp/jquery-args.html)

# search - SandCastle Help Builder：搜索功能

> ID：343892
> 
> 赞同：9
> 
> 时间：2008-12-05T13:51:33.303
> 
> 标签：search, sandcastle

我对 SandCastle 的输出非常满意，但我还希望在 HTML 输出中包含一些搜索功能，这可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-01-18T10:05:25.377

SandCastle Help File Builder 的网站输出包含**index.aspx**和**index.html**。

如果您显示**index.html**，那么您不会获得搜索或索引选项： [http ://www.ewoodruff.us/shfbdocs/index.html](http://www.ewoodruff.us/shfbdocs/index.html)

如果你显示**index.aspx**那么你会得到搜索和索引选项： [http ://www.ewoodruff.us/shfbdocs/index.aspx](http://www.ewoodruff.us/shfbdocs/index.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-05T14:22:55.790

根据它所在的[站点](http://shfb.codeplex.com/)，但我还没有查看如何配置它：

> 网站输出包含一个 HTML 和一个带有树视图的 ASP.NET 索引页面，可用于导航目录和全文索引搜索功能。

# asp.net-mvc - 如何在 MVC 应用程序中缓存数据

> ID：343899
> 
> 赞同：257
> 
> 时间：2008-12-05T13:53:07.340
> 
> 标签：asp.net-mvc, database, caching

我已经阅读了很多关于 MVC 应用程序中的页面缓存和部分页面缓存的信息。但是，我想知道您将如何缓存数据。

在我的场景中，我将使用 LINQ to Entities（实体框架）。在第一次调用 GetNames（或任何方法）时，我想从数据库中获取数据。我想将结果保存在缓存中，并在第二次调用时使用缓存版本（如果存在）。

任何人都可以举一个例子来说明这将如何工作，应该在哪里实施（模型？）以及它是否可以工作。

我已经在传统的 ASP.NET 应用程序中看到过这种情况，通常用于非常静态的数据。

* * *

## 回答 #1

> 赞同：407
> 
> 时间：2008-12-08T10:34:27.333

这是我使用的一个不错且简单的缓存助手类/服务：

```
using System.Runtime.Caching;  

public class InMemoryCache: ICacheService
{
    public T GetOrSet<T>(string cacheKey, Func<T> getItemCallback) where T : class
    {
        T item = MemoryCache.Default.Get(cacheKey) as T;
        if (item == null)
        {
            item = getItemCallback();
            MemoryCache.Default.Add(cacheKey, item, DateTime.Now.AddMinutes(10));
        }
        return item;
    }
}

interface ICacheService
{
    T GetOrSet<T>(string cacheKey, Func<T> getItemCallback) where T : class;
} 
```

### 用法：

```
cacheProvider.GetOrSet("cache key", (delegate method if cache is empty)); 
```

缓存提供者会检查缓存中是否有名为“cache id”的内容，如果没有，它将调用委托方法来获取数据并将其存储在缓存中。

### 例子：

```
var products=cacheService.GetOrSet("catalog.products", ()=>productRepository.GetAll()) 
```

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-12-05T14:10:48.333

引用`System.Web`模型中的 dll 并使用`System.Web.Caching.Cache`

```
 public string[] GetNames()
    {
      string[] names = Cache["names"] as string[];
      if(names == null) //not in cache
      {
        names = DB.GetNames();
        Cache["names"] = names;
      }
      return names;
    } 
```

有点简化，但我想这会奏效。这不是 MVC 特定的，我一直使用这种方法来缓存数据。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-07-08T15:39:15.663

我指的是 TT 的帖子，并建议采用以下方法：

**在模型中引用 System.Web dll 并使用 System.Web.Caching.Cache**

```
public string[] GetNames()
{ 
    var noms = Cache["names"];
    if(noms == null) 
    {    
        noms = DB.GetNames();
        Cache["names"] = noms; 
    }

    return ((string[])noms);
} 
```

您不应该返回从缓存中重新读取的值，因为您永远不会知道在那个特定时刻它是否仍在缓存中。即使您之前将它插入到语句中，它也可能已经消失或从未添加到缓存中——您只是不知道。

因此，您添加从数据库读取的数据并直接返回，而不是从缓存中重新读取。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2015-12-14T10:31:23.043

对于 .NET 4.5+ 框架

添加参考：`System.Runtime.Caching`

添加使用语句： `using System.Runtime.Caching;`

```
public string[] GetNames()
{ 
    var noms = System.Runtime.Caching.MemoryCache.Default["names"];
    if(noms == null) 
    {    
        noms = DB.GetNames();
        System.Runtime.Caching.MemoryCache.Default["names"] = noms; 
    }

    return ((string[])noms);
} 
```

> 在 .NET Framework 3.5 及更早版本中，ASP.NET 在 System.Web.Caching 命名空间中提供了内存缓存实现。在早期版本的 .NET Framework 中，缓存仅在 System.Web 命名空间中可用，因此需要依赖于 ASP.NET 类。在 .NET Framework 4 中，System.Runtime.Caching 命名空间包含为 Web 和非 Web 应用程序设计的 API。

更多信息：

*   [https://msdn.microsoft.com/en-us/library/dd997357(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/dd997357(v=vs.110).aspx)

*   [https://docs.microsoft.com/en-us/dotnet/framework/performance/caching-in-net-framework-applications](https://docs.microsoft.com/en-us/dotnet/framework/performance/caching-in-net-framework-applications)

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2011-06-03T20:54:42.020

Steve Smith 写了两篇很棒的博文，展示了如何在 ASP.NET MVC 中使用他的 CachedRepository 模式。它有效地使用了存储库模式，并允许您在无需更改现有代码的情况下获得缓存。

[http://ardalis.com/Introducing-the-CachedRepository-Pattern](http://ardalis.com/Introducing-the-CachedRepository-Pattern)

[http://ardalis.com/building-a-cachedrepository-via-strategy-pattern](http://ardalis.com/building-a-cachedrepository-via-strategy-pattern)

在这两篇文章中，他向您展示了如何设置此模式，并解释了它为何有用。通过使用这种模式，您可以获得缓存，而您现有的代码不会看到任何缓存逻辑。本质上，您使用缓存的存储库就像它是任何其他存储库一样。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2018-05-17T21:17:54.560

我以这种方式使用它，它对我有用。 [https://msdn.microsoft.com/en-us/library/system.web.caching.cache.add(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.add(v=vs.110).aspx) 参数信息 system.web.caching.cache.add。

```
public string GetInfo()
{
     string name = string.Empty;
     if(System.Web.HttpContext.Current.Cache["KeyName"] == null)
     {
         name = GetNameMethod();
         System.Web.HttpContext.Current.Cache.Add("KeyName", name, null, DateTime.Noew.AddMinutes(5), Cache.NoSlidingExpiration, CacheitemPriority.AboveNormal, null);
     }
     else
     {
         name = System.Web.HttpContext.Current.Cache["KeyName"] as string;
     }

      return name;

} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-07-16T15:00:56.547

**AppFabric 缓存**是一种分布式内存缓存技术，它使用跨多个服务器的物理内存将数据存储在键值对中。AppFabric 为 .NET Framework 应用程序提供了性能和可伸缩性改进。[概念和架构](http://msdn.microsoft.com/en-us/library/ff383813%28v=azure.10%29.aspx)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-02-08T17:52:17.467

扩展@Hrvoje Hudo 的答案...

**代码：**

```
using System;
using System.Runtime.Caching;

public class InMemoryCache : ICacheService
{
    public TValue Get<TValue>(string cacheKey, int durationInMinutes, Func<TValue> getItemCallback) where TValue : class
    {
        TValue item = MemoryCache.Default.Get(cacheKey) as TValue;
        if (item == null)
        {
            item = getItemCallback();
            MemoryCache.Default.Add(cacheKey, item, DateTime.Now.AddMinutes(durationInMinutes));
        }
        return item;
    }

    public TValue Get<TValue, TId>(string cacheKeyFormat, TId id, int durationInMinutes, Func<TId, TValue> getItemCallback) where TValue : class
    {
        string cacheKey = string.Format(cacheKeyFormat, id);
        TValue item = MemoryCache.Default.Get(cacheKey) as TValue;
        if (item == null)
        {
            item = getItemCallback(id);
            MemoryCache.Default.Add(cacheKey, item, DateTime.Now.AddMinutes(durationInMinutes));
        }
        return item;
    }
}

interface ICacheService
{
    TValue Get<TValue>(string cacheKey, Func<TValue> getItemCallback) where TValue : class;
    TValue Get<TValue, TId>(string cacheKeyFormat, TId id, Func<TId, TValue> getItemCallback) where TValue : class;
} 
```

**例子**

单个项目缓存（当每个项目基于其 ID 进行缓存时，因为缓存项目类型的整个目录会过于密集）。

```
Product product = cache.Get("product_{0}", productId, 10, productData.getProductById); 
```

缓存所有东西

```
IEnumerable<Categories> categories = cache.Get("categories", 20, categoryData.getCategories); 
```

**为什么选择 TID**

第二个助手特别好，因为大多数数据键不是复合的。如果您经常使用复合键，则可以添加其他方法。通过这种方式，您可以避免执行各种字符串连接或 string.Formats 来获取传递给缓存助手的密钥。它还使传递数据访问方法更容易，因为您不必将 ID 传递给包装器方法……对于大多数用例，整个事情变得非常简洁和一致。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-08-14T19:03:53.303

这是对 Hrvoje Hudo 答案的改进。此实现有几个关键改进：

*   缓存键是根据更新数据的函数和传入的指定依赖关系的对象自动创建的
*   传递任何缓存持续时间的时间跨度
*   使用锁来保证线程安全

请注意，这依赖于 Newtonsoft.Json 来序列化 dependsOn 对象，但可以轻松地将其替换为任何其他序列化方法。

ICache.cs

```
public interface ICache
{
    T GetOrSet<T>(Func<T> getItemCallback, object dependsOn, TimeSpan duration) where T : class;
} 
```

InMemoryCache.cs

```
using System;
using System.Reflection;
using System.Runtime.Caching;
using Newtonsoft.Json;

public class InMemoryCache : ICache
{
    private static readonly object CacheLockObject = new object();

    public T GetOrSet<T>(Func<T> getItemCallback, object dependsOn, TimeSpan duration) where T : class
    {
        string cacheKey = GetCacheKey(getItemCallback, dependsOn);
        T item = MemoryCache.Default.Get(cacheKey) as T;
        if (item == null)
        {
            lock (CacheLockObject)
            {
                item = getItemCallback();
                MemoryCache.Default.Add(cacheKey, item, DateTime.Now.Add(duration));
            }
        }
        return item;
    }

    private string GetCacheKey<T>(Func<T> itemCallback, object dependsOn) where T: class
    {
        var serializedDependants = JsonConvert.SerializeObject(dependsOn);
        var methodType = itemCallback.GetType();
        return methodType.FullName + serializedDependants;
    }
} 
```

用法：

```
var order = _cache.GetOrSet(
    () => _session.Set<Order>().SingleOrDefault(o => o.Id == orderId)
    , new { id = orderId }
    , new TimeSpan(0, 10, 0)
); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-06-01T10:53:51.420

```
public sealed class CacheManager
{
    private static volatile CacheManager instance;
    private static object syncRoot = new Object();
    private ObjectCache cache = null;
    private CacheItemPolicy defaultCacheItemPolicy = null;

    private CacheEntryRemovedCallback callback = null;
    private bool allowCache = true;

    private CacheManager()
    {
        cache = MemoryCache.Default;
        callback = new CacheEntryRemovedCallback(this.CachedItemRemovedCallback);

        defaultCacheItemPolicy = new CacheItemPolicy();
        defaultCacheItemPolicy.AbsoluteExpiration = DateTime.Now.AddHours(1.0);
        defaultCacheItemPolicy.RemovedCallback = callback;
        allowCache = StringUtils.Str2Bool(ConfigurationManager.AppSettings["AllowCache"]); ;
    }
    public static CacheManager Instance
    {
        get
        {
            if (instance == null)
            {
                lock (syncRoot)
                {
                    if (instance == null)
                    {
                        instance = new CacheManager();
                    }
                }
            }

            return instance;
        }
    }

    public IEnumerable GetCache(String Key)
    {
        if (Key == null || !allowCache)
        {
            return null;
        }

        try
        {
            String Key_ = Key;
            if (cache.Contains(Key_))
            {
                return (IEnumerable)cache.Get(Key_);
            }
            else
            {
                return null;
            }
        }
        catch (Exception)
        {
            return null;
        }
    }

    public void ClearCache(string key)
    {
        AddCache(key, null);
    }

    public bool AddCache(String Key, IEnumerable data, CacheItemPolicy cacheItemPolicy = null)
    {
        if (!allowCache) return true;
        try
        {
            if (Key == null)
            {
                return false;
            }

            if (cacheItemPolicy == null)
            {
                cacheItemPolicy = defaultCacheItemPolicy;
            }

            String Key_ = Key;

            lock (Key_)
            {
                return cache.Add(Key_, data, cacheItemPolicy);
            }
        }
        catch (Exception)
        {
            return false;
        }
    }

    private void CachedItemRemovedCallback(CacheEntryRemovedArguments arguments)
    {
        String strLog = String.Concat("Reason: ", arguments.RemovedReason.ToString(), " | Key-Name: ", arguments.CacheItem.Key, " | Value-Object: ", arguments.CacheItem.Value.ToString());
        LogManager.Instance.Info(strLog);
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-12-27T13:32:27.513

我使用两个类。第一个缓存核心对象：

```
public class Cacher<TValue>
    where TValue : class
{
    #region Properties
    private Func<TValue> _init;
    public string Key { get; private set; }
    public TValue Value
    {
        get
        {
            var item = HttpRuntime.Cache.Get(Key) as TValue;
            if (item == null)
            {
                item = _init();
                HttpContext.Current.Cache.Insert(Key, item);
            }
            return item;
        }
    }
    #endregion

    #region Constructor
    public Cacher(string key, Func<TValue> init)
    {
        Key = key;
        _init = init;
    }
    #endregion

    #region Methods
    public void Refresh()
    {
        HttpRuntime.Cache.Remove(Key);
    }
    #endregion
} 
```

第二个是缓存对象列表：

```
public static class Caches
{
    static Caches()
    {
        Languages = new Cacher<IEnumerable<Language>>("Languages", () =>
                                                          {
                                                              using (var context = new WordsContext())
                                                              {
                                                                  return context.Languages.ToList();
                                                              }
                                                          });
    }
    public static Cacher<IEnumerable<Language>> Languages { get; private set; }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-11-05T04:55:25.290

我会说在这个持久数据问题上实施 Singleton 可以解决这个问题，以防你发现以前的解决方案非常复杂

```
 public class GPDataDictionary
{
    private Dictionary<string, object> configDictionary = new Dictionary<string, object>();

    /// <summary>
    /// Configuration values dictionary
    /// </summary>
    public Dictionary<string, object> ConfigDictionary
    {
        get { return configDictionary; }
    }

    private static GPDataDictionary instance;
    public static GPDataDictionary Instance
    {
        get
        {
            if (instance == null)
            {
                instance = new GPDataDictionary();
            }
            return instance;
        }
    }

    // private constructor
    private GPDataDictionary() { }

}  // singleton 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-02-24T15:38:22.833

```
HttpContext.Current.Cache.Insert("subjectlist", subjectlist); 
```

* * *

## 回答 #14

> 赞同：-8
> 
> 时间：2008-12-09T17:12:01.663

您还可以尝试使用 ASP MVC 中内置的缓存：

将以下属性添加到您要缓存的控制器方法中：

```
[OutputCache(Duration=10)] 
```

在这种情况下，此的 ActionResult 将被缓存 10 秒。

更多关于[这里](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)

# mysql - 选择第一个 n-chars 相等的行（MySQL）

> ID：343900
> 
> 赞同：3
> 
> 时间：2008-12-05T13:53:22.193
> 
> 标签：mysql, regex, select

我有一张带有玩家手柄的桌子，如下所示：

```
1 - [N] Laka
2 - [N] James
3 - nor | Brian
4 - nor | John
5 - Player 2
6 - Spectator
7 - [N] Joe 
```

从那里我想选择第一个 n-chars 匹配的所有玩家，但我不知道模式，只是它是第一个 n-chars。在上面的示例中，我不希望它返回第 1、2、3、4 和 7 行。

这在 MySQL 中是否可行且不会太贵？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T14:50:04.170

如果你知道 n 的值，你可以这样做（对于 n=3）：

```
Select *
FROM players
WHERE Left(name, 3) in (
   SELECT Left(name, 3)
   FROM players
   GROUP BY Left(name, 3)
   HAVING (Count(*) > 1)
); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T14:27:59.453

您可以添加一个存在子句。

```
select name from players p1 where exists (
  select 1 from players p2 where 
    p2.name like CONCAT( SUBSTRING(p1.name, 1, 3), '%') 
    and p1.name <> p2.name ) 
```

这会给你：
1 - [N] Laka
2 - [N] James
3 - 也不 | 布赖恩
4 - 也没有 | 约翰
7 - [N] 乔

在名称上添加“order by”，您可以在代码中完成其余的工作。

# oracle - 用 Hibernate 映射 ORACLE 的 NUMBER 类型

> ID：343902
> 
> 赞同：0
> 
> 时间：2008-12-05T13:53:45.110
> 
> 标签：oracle, hibernate, mapping

我在 ORACLE 10g 数据库中有一个表，其中有一列“ `kzCode NUMBER(1)`”。

如果我尝试将其与 JBOSS Server WebApp 中的 Hibernate 注释映射，如下所示：

```
@Column(nullable=false)
private Integer kzCode; 
```

我收到一个错误：

```
org.hibernate.HibernateException: Wrong column type: kzCode, expected: integer 
```

我也试过

```
@Column(nullable=false) private BigInteger kzCode; 
```

错误：

```
org.hibernate.HibernateException: Wrong column type: kzCode, expected:numeric(19,2) 
```

我真的不知道，要采用什么 Java 类型。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T14:19:03.933

ok, got it!

I had a wrong dialect property in persistence.xml file. Now all works fine..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T14:03:17.180

```
@Column(nullable=false)
private Boolean kzCode; 
```

or if you really want it to be a number, change the Oracle type to NUMBER(36, 0) and use long or Long in your Java.

# sql-server - SQL 2005：完整备份如何影响日志传送？

> ID：343908
> 
> 赞同：5
> 
> 时间：2008-12-05T13:54:51.410
> 
> 标签：sql-server

我计划将日志传送设置到远程站点以进行灾难恢复，但我仍然希望每晚进行一次完整备份，以便可以将其复制到备份磁带并使用它来恢复到我们的报告服务器上。我可以在不破坏日志备份周期的情况下做到这一点吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T14:59:01.483

是的你可以。您从完整备份的还原开始日志传送过程，从那时起您只需要还原事务日志备份。您可以根据需要进行尽可能多的差异或完整备份，它不会影响 LSN，因此只要日志按顺序恢复就不会干扰日志传送过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T20:47:48.550

这是 SQL 备份概述 [http://msdn.microsoft.com/en-us/library/ms175477(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms175477(SQL.90).aspx)

完整备份和差异备份不会破坏 LSN 日志链，因此您可以随时安全地进行这些备份，而不会影响日志传送

# command-line - MS DOS 编辑文件

> ID：343921
> 
> 赞同：0
> 
> 时间：2008-12-05T14:02:32.440
> 
> 标签：command-line, batch-file, dos

我正在编写一个批处理脚本，我希望打开一个文件，然后更改它的第二行。我想找到字符串“cat”并将其替换为我设置的值，即 %var% 。我只希望这发生在第二行（或前 3 次）。你会怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T15:17:55.593

我只是自己解决。它只会在第二行查找 var 。

```
@echo OFF
SETLOCAL ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION
SET filename=%1
set LINENO=0    
for /F "delims=" %%l in (%filename%) do (
 SET /A LINENO=!LINENO!+1
 IF "!LINENO!"=="2" ( call echo %%l ) ELSE ( echo %%l )
) 
```

但我更喜欢使用 cscript（vbscript 甚至 jscript）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T14:14:30.120

首先，使用批处理文件来实现这一点很麻烦（恕我直言）。无论如何，您都必须使用外部工具来进行字符串替换。我会改用一些脚本语言。

如果你真的想使用批处理，[这](https://stackoverflow.com/questions/130116/dos-batch-commands-to-read-first-line-from-text-file)会让你开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T14:20:41.077

这对于本机批处理脚本来说是很难看的。我要么

1.  在 VBScript 中执行此操作。如果您真的需要在批处理文件中使用它，您可以从批处理脚本中调用 VBScript 文件。您甚至可以将 %var% 作为参数传递给 VBScript。

2.  使用 sed 脚本。Unix 命令有 Windows 端口，例如[GnuWin32](http://gnuwin32.sourceforge.net/)、[GNU Utilities for Win32](http://unxutils.sourceforge.net/)（我使用这些）或[Cygwin](http://www.cygwin.com/)。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-05T14:19:40.157

我会创建一个脚本：

1.  扫描输入文件
2.  写入第二个输出文件
3.  删除输入
4.  重命名输出

至于要解析的dos命令，我做了一个[谷歌搜索](http://www.google.com/search?hl=en&q=file+parse+batch+ms+dos)并想出了一个很好的起点：

```
@echo off
setlocal enabledelayedexpansion

set file=c:\file.txt
set output=output.txt
set maxlines=5000

set count=0

for /F "tokens=* usebackq" %%G in ("%file%") do (
 if !count!==%maxlines% goto :eof

 set line=%%G
 set line=!line:*000000000000=--FOUND--!
 if "!line:~0,9!"=="--FOUND--" (
  echo %%G>>"%output%"
  set /a count+=1
 )
) 
```

（从 Intarwebnet 窃取）

# sql-server - SQL Server 2005：文件大小调整

> ID：343924
> 
> 赞同：2
> 
> 时间：2008-12-05T14:05:37.567
> 
> 标签：sql-server, database, tsql

我有一些数据库，每个数据库都有四个文件；一个用于 PRIMARY、IDX、IMAGE、LOG，它们的初始大小分别设置为 200MB，但它们消耗的空间要少得多，总共大约 100MB。

1) 是否可以在使用数据库文件时将它们调整为更合理的大小，比如“当前消耗”+ 10MB？

2) 是否可以将这些文件合并为一个 .mdf 和 .ldf？

我的首选答案是一些 T-SQL，但我会接受指向 MSDN（或其他站点）的链接，并提供要查找的 T-SQL 的参考。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T14:17:23.767

1) DBCC [SHRINKFILE](http://msdn.microsoft.com/en-us/library/ms189493.aspx)或[SHRINKDATABASE](http://msdn.microsoft.com/en-us/library/ms190488.aspx)。SQL Management Studio 中还有一个上下文单击，用于所有任务。

如果他们被设置为自动增长，那么他们就会这样做，并撤消你的收缩。收缩操作最适合在数据库中发生大量数据删除时，或者当服务器因磁盘空间不足而崩溃时。

2）是的，但它非常困难。您将删除所有表并在目标文件组上创建它们，然后重新填充它们。可能有一种方法可以使用[RESTORE](http://msdn.microsoft.com/en-us/library/ms186858.aspx)选项来执行此操作，但恕我直言，如果文件少于 10 个，最好不要使用它们。

# java - 大量 RAM 的 Java 性能

> ID：343929
> 
> 赞同：19
> 
> 时间：2008-12-05T14:07:51.057
> 
> 标签：java, garbage-collection

我正在探索在具有大量 RAM 的机器上运行 Java 应用程序的可能性（从 300GB 到 15TB，可能在 SGI Altix 4700 机器上），我很好奇 Java 的 GC 可能如何执行在这种情况下。

我听说 IBM 或 JRockit 的 JVM 可能比 Sun 的更适合这个。有谁知道在这种情况下有关 JVM 性能的任何研究或数据？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T15:01:21.773

在 Sun JVM 上，您可以使用选项 -XX:UseConcMarkSweepGC 来打开 Concurrent mark and sweep Collector，这将几乎完全避免默认 GC 算法的“stop the world”阶段，但代价是多一点高架。

恕我直言，在此类机器上使用超过 VM 的建议已过时。在现实世界的应用程序中，您通常拥有足够的共享数据，因此 CMS 和一个 JVM 的性能会更好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-05T14:19:49.487

问题是：您是否要在单个进程 (JVM) 中运行？如果你这样做了，那么你就会有问题。请参阅[Tuning Java Virtual Machines](http://edocs.beasys.com/wls/docs81/perform/JVMTuning.html)、[Oracle Coherence 用户指南](http://coherence.oracle.com/display/COH34UG/Coherence+User+Guide+(Full))和类似文档。我的经验法则是尽量避免大于 1GB 的堆。而 512MB-1GB 的完整 GC 可能需要不到一秒钟的时间。2-4GB 的完整 GC 可能需要 5 秒或更长时间。显然这取决于许多因素，但故事的寓意是 GC 开销不会线性扩展，一旦进入一秒范围，性能就会迅速下降。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T14:31:05.360

Sun 的 JVM 允许您配置和优化垃圾收集，但这本身就是一门科学：http: [//java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html](http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html)

你可能需要做一些阅读和研究，但对于那种机器，为机器和应用程序优化的 GC 设置可能会产生很大的不同。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T14:38:36.657

从 5.0 开始，Hotspot JVM 使用一个称为 Ergonomics 的概念来尝试优化内存使用。这不仅仅基于可用的内存量和影响堆大小、生成大小和垃圾收集算法。

首先阅读此内容，其中解释了人体工程学等：

[https://www.oracle.com/technetwork/java/javase/memorymanagement-whitepaper-150215.pdf](https://www.oracle.com/technetwork/java/javase/memorymanagement-whitepaper-150215.pdf)

还有一个叫 Brian Goetz 的人写了很多关于 Java 如何分配和使用内存的文章，所有这些文章以及更多可以在这里找到：

[http://www.briangoetz.com/pubs.html](http://www.briangoetz.com/pubs.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T14:25:09.210

这根本不是在回答您的问题，但如果您计划部署一个巨大的 Java 应用程序，您可能有兴趣研究[Azul Systems 设备](http://www.azulsystems.com/products/compute_appliance.htm)。他们说能够在不造成应用程序暂停的情况下进行垃圾收集，最高可达单个 670 GB 堆。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-16T22:35:07.023

您可能需要考虑在这台机器上运行一个虚拟[Terracotta](http://www.terracotta.org/)集群。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T21:58:54.490

唯一能真正告诉你的是SGI。超级计算机的行为不像普通服务器，只是更大。

但是，我发现当内存位于访问它的处理器的本地时，Java 的性能最好。注意：GC 需要能够端到端地遍历整个内存。这意味着如果您的设计就像许多计算机粘在一起，那么它就不能很好地扩展，这可能就是这种情况。内存模块大小为 32 GB，因此如果您将 JVM 限制为舒适地适应此大小，您可能会获得更好的性能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-18T13:23:30.910

这篇文章的公认答案相当陈旧，现在已经过时了。截至 2014 年 9 月，如果您使用的是 Java 7，您可能应该切换到 GC1 收集器。从 Java 7 更新 4 发行说明：

[http://www.oracle.com/technetwork/java/javase/7u4-relnotes-1575007.html](http://www.oracle.com/technetwork/java/javase/7u4-relnotes-1575007.html)

“G1 收集器的目标是充分利用当今多处理器服务器中可用的大量内存，同时仍控制垃圾收集延迟的应用程序。需要大堆、具有大活动数据集、突发或非统一的工作负载或遭受垃圾收集引起的长时间延迟应该从切换到 G1 中受益。”

* * *

## 回答 #9

> 赞同：-8
> 
> 时间：2008-12-05T14:10:43.873

当然，关于 GC 将如何执行的答案是“谁在乎？” ;-)

# c++ - 固定宽度字体 - Symbian C++ CEikLabel

> ID：343946
> 
> 赞同：1
> 
> 时间：2008-12-05T14:16:12.660
> 
> 标签：c++, fonts, symbian, s60, ceiklabel

我想更改我在 S60 设备上的 CEikLabel 中使用的字体

我相信我可以做到以下几点

```
const CFont* aPlainFont = LatinPlain12();
aLabel->SetFont(aPlainFont); 
```

其中 LatinPlain12 是此列表中的一个..

```
Albi12
Alp13
Alpi13
Albi13
alp17
Alb17b
albi17b
alpi17
Aco13
Aco21
Acalc21
LatinBold12
LatinBold13
LatinBold17
LatinBold19 
LatinPlain12
Acb14
Acb30
Acp5 
```

但是，谁能帮我找出这个列表中哪些是固定宽度的。谢谢:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T14:43:01.467

您可以使用[FontViewer](http://www.newlc.com/FontViewer.html)应用程序查看并找出哪些字体是成比例的和固定宽度的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T08:22:45.537

以编程方式，您可以使用以下方法确定字体是否成比例：

```
const CFont* myFont; 
// Initialize your font
// ....
TBool isProportional = (myFont->FontSpecInTwips().iTypeface.Attributes() & TTypeFace::EProportional); 
```

顺便说一句，与依赖静态字体访问器函数相比，枚举设备上的字体和/或使用逻辑字体 API 可能会更好。

# java - Eclipse 如何调试应用服务器中的代码？

> ID：343947
> 
> 赞同：7
> 
> 时间：2008-12-05T14:17:12.783
> 
> 标签：java, eclipse, jakarta-ee, jdb

当我在 Eclipse 中以调试模式运行服务器时，Eclipse 和我的应用程序服务器 (JBoss) 之间正在进行什么通信？这是如何运作的？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-05T14:23:24.160

当您以调试模式启动服务器时，它会侦听指定的 TCP 端口。Eclipse 连接到该端口，它们使用 Java Debug Wire Protocol (JDWP) 进行通信。在此处阅读详细信息：http: [//java.sun.com/j2se/1.5.0/docs/guide/jpda/](http://java.sun.com/j2se/1.5.0/docs/guide/jpda/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T14:20:44.540

我认为它被称为 JDWP (Java Debugging Wire Protocol) -[在这里阅读更多](http://java.sun.com/j2se/1.5.0/docs/guide/jpda/architecture.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-12-15T00:06:52.973

Eclipse 调试从所谓的代理开始。

运行已编译的 .class 源的 JVM 具有允许将外部库（用 Java 或 C++ 编写）注入到 JVM 中的功能，这与运行时有关。这些外部库称为代理，它们能够修改已运行的 .class 文件的内容。这些代理可以访问 JVM 的功能，而这些功能在 JVM 中运行的常规 Java 代码中是无法访问的，它们可以用来做一些有趣的事情，比如注入和修改正在运行的源代码、分析等。像 JRebel 这样的工具利用这块功能实现了他们的神奇。

要将 Agent Lib 传递给 JVM，您可以通过启动参数执行此操作，使用

```
 agentlib:libname[=options] format. 
```

我们实际上是在将一个名为 jdwp 的代理库传递给运行 Tomcat 的 JVM。jdwp 是 JDWP（Java Debug Wire Protocol）的 JVM 特定的可选实现，用于定义调试器和正在运行的 JVM 之间的通信。它的实现（如果存在）作为 JVM 的本机库作为 jdwp.so 或 jdwp.dll 提供

那么它有什么作用呢？简单来说，我们传递的 jdwp 代理基本上提供了连接运行应用程序的 JVM 实例和调试器（可以位于远程或本地）之间的功能。由于它是一个代理库，它确实具有拦截运行代码的能力，在 JVM 和调试器之间建立桥梁，并具有应用在 JVM 上的调试器的功能。由于在 JVM 架构中，调试功能不在 JVM 本身中找到，而是被抽象到外部工具（被恰当地称为调试器）中，这些工具可以驻留在运行正在调试的 JVM 的本地机器上，也可以运行来自外部机器。正是这种解耦的模块化架构允许我们在远程机器上运行 JVM 并使用 JDWP，

简而言之，这就是 Eclipse 调试器的工作方式。

# .net - 当前加载的类不断增加 - 内存泄漏

> ID：343954
> 
> 赞同：6
> 
> 时间：2008-12-05T14:19:39.050
> 
> 标签：.net, debugging, windbg

我有一个内存泄漏非常慢的服务。如果我分析 .NET CLR Loading 计数器，我会看到*Current Classes Loaded*计数器不断增加，并且始终与*Total Classes Loaded*计数器匹配。这给我的印象是内存泄漏与未释放的资源有关（这只是一个猜测）。

该服务每次执行任务时都会创建新的 appDomain（插件架构）。

我需要找出类名，以便缩小泄漏的原因。我对 WinDbg 不是很精通，但我想知道是否有人可以引导我完成枚举这些*Loaded*类的步骤。

我确实有源代码，因此我可以在必要时获取符号文件。提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T14:27:53.293

这是 .net 2.0 还是更高版本？如果是这样，您可能不会卸载`AppDomain`（正如 Jon Skeet 在评论中所说）。

如果是 1.1 或更低版本，则`AppDomain`卸载功能中存在错误。`AppDomain`即当“卸载”时它不会释放内存或释放资源。

（这是从 .net 2.0 开始修复的）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T16:59:15.593

您可以随时检查 AppDomain 中加载了哪些程序集：

```
foreach (var assembly in AppDomain.CurrentDomain.GetAssemblies())
{
      Console.WriteLine(assembly.FullName);
} 
```

因此，如果您不小心将程序集加载到错误的域中，也不会很难看到。

编辑：

如果你想使用 WinDgb SOS，[这里](http://msdn.microsoft.com/en-us/library/bb190764.aspx)是支持的命令。您最有可能对以下内容感兴趣：DumpDomain、DumpClass、DumpAssembly、EEHeap ...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T20:44:27.400

我相信这个问题实际上是由一系列未处理的 FileSystemWatcher 实例引起的，这些实例嵌套在 RemoteTaskRunner MBRO 中。我仍然不确定我是否已经完全解决了内存泄漏，但我绝对可以分辨出区别。

这似乎不是 FileSystemWatchers 第一次给我带来问题。:)

感谢大家（尤其是 leppie）帮助我解决这个问题！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T14:23:16.140

我建议使用适当的内存分析器——比如“.NET Memory Profiler”——http: [//memprofiler.com/](http://memprofiler.com/) 你当然可以在评估时尝试一下，看看它是否是一种有用的工具。

这将使您比核心 WinDBG/SoS 的东西更容易看到所有活动对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T14:31:59.510

正如另一个答案所说，应该使用 AppDomain.Unload() 。

但是，您需要注意不要在多个位置加载程序集，尤其是主应用程序域。

查看 AppDomain.Load(AssemblyName) 的 MSDN 文档以了解上述情况如何发生。

同样在同一行中，您确定您使用的是正确的远程类吗？如果没有，上述情况肯定会发生。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T16:13:56.823

我刚刚在 Suzanne Cook 的博客上读到了这篇文章。

[http://blogs.msdn.com/suzcook/archive/2003/06/12/57169.aspx](http://blogs.msdn.com/suzcook/archive/2003/06/12/57169.aspx)

> 确保不传递任何类型/程序集/等。实例（除了您的 MarshalByRefObject 类型）返回到原始 appdomain。如果这样做，它将导致这些程序集被加载到原始 appdomain 中。如果两个 appdomain 之间的 appdomain 设置不同，则这些程序集可能无法在此处加载。另外，即使它们被成功加载，在卸载目标 appdomain 后，即使原始 appdomain 从未使用它们，程序集也会保持加载和锁定状态。

当她说任何类型/组装/等时。她可能是什么类型的？我问的原因是因为我的 MarshalByRefObject (RemoteTaskRunner) 在任务运行后确实返回了一个 DateTime 对象。这会导致插件程序集加载到我的主 appDomain 中（并最终导致内存泄漏）吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T20:51:00.400

每当有人报告内存泄漏时，我总是把它扔在那里，因为它让我忙了几个星期。不要在调试模式下运行您的应用程序。如果您在 .Net 2.0+ 中以调试模式运行您的应用程序（在 .Net 1.1 中没有发生），并且您实例化了一个包含事件的类，即使您不引发该事件，它也只会容纳一个小一块记忆。这会极大地影响长时间运行的应用程序，例如服务和 Web 应用程序，因为随着时间的推移，在实例化对象后消耗的少量内存可能会增加很多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-05T14:27:16.087

编辑：阅读其他一些帖子后，在使用更好的分析器和解决 appDomain 问题后，应考虑这些。

您可能希望将性能计数器添加到您的服务中，以便至少可以跟踪您创建的对象。这将帮助您确定 Classes.Loaded 是您的类还是 CLR 类。

在显式创建和销毁对象时添加一些调试日志记录可能会有所帮助。

作为最后的手段，您可以*尝试*将 GC.Collect() 放在那里，看看调用它是否可以解决您的问题。它不是*修复*，但测试它会让你知道它是一个选项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-05T15:50:27.353

AppDomain 已卸载，但来自 leppie 的响应让我想知道插件程序集是否同时加载到主 AppDomain 和辅助 AppDomain 中。当我查看性能计数器时，当前的 AppDomain 计数不会不断增加。

该应用程序应该创建一个辅助 appDomain，然后加载一个单独的插件程序集。也许一些代码会有所帮助：

从主 appDomain 创建辅助 AppDomain：

```
AppDomainSetup ads = new AppDomainSetup();
ads.ApplicationName = "RemoteAgentLib";
ads.ApplicationBase = AppDomain.CurrentDomain.BaseDirectory;
ads.PrivateBinPath = AppDomain.CurrentDomain.BaseDirectory;
ads.ShadowCopyDirectories = AppDomain.CurrentDomain.BaseDirectory;
ads.ShadowCopyFiles = "true";

m_domain = AppDomain.CreateDomain("RemoteTaskRunner", null, ads); 
```

使用 RemoteTaskRunner 在辅助 appDomain 中加载插件：

```
RemoteTaskRunner taskRunner = m_domain.CreateInstanceAndUnwrap(
                    Assembly.GetExecutingAssembly().FullName,
                    typeof (RemoteTaskRunner).FullName) as RemoteTaskRunner;
taskRunner.LoadTask(taskInfo.Assembly, taskInfo.Type); 
```

使用 RemoteTaskRunner 在辅助 appDomain 中执行任务：

```
[Serializable]
internal class RemoteTaskRunner : MarshalByRefObject
{
    private ITask m_task;

    public RemoteTaskRunner()
    {
    }

    internal void LoadTask(string assembly, string type)
    {
        // This assembly should load in the secondary appDomain.
        Assembly taskAssembly = AppDomain.CurrentDomain.Load(assembly);
        m_task = taskAssembly.CreateInstance(type) as ITask;
    }

    internal void RunTask(string taskConfig)
    {
        // This method should run in the secondary appDomain.
        m_task.RunTask(taskConfig, m_logger);
    }
...
... 
```

要执行插件任务，在 Primary appDomain 中使用以下代码行：

```
taskRunner.RunTask(taskInfo.TaskConfig); 
```

任务完成后，appDomain 被卸载：

```
AppDomain.Unload(m_domain); 
```

# performance - 优化磁盘数据的位置以进行顺序访问

> ID：343963
> 
> 赞同：7
> 
> 时间：2008-12-05T14:21:49.297
> 
> 标签：performance, hard-drive, heuristics

我需要将大量数据存储在大约 1k 个块中。我将以一种难以预测但可能存在模式的方式访问这些对象。

是否有一种算法或启发式方法可以根据我的访问模式重新排列磁盘上的对象，以尝试最大化顺序访问，从而最小化磁盘寻道时间？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T11:13:02.717

在现代操作系统（Windows、Linux 等）上，您绝对无法优化寻道时间！原因如下：

1.  你处于一个先发制人的多任务系统中。您的应用程序及其所有数据可以随时刷新到磁盘 - 用户切换任务、屏幕保护程序启动、电池电量耗尽等。
2.  您不能保证该文件在磁盘上是连续的。执行 Aaron 的第一个要点并不能确保文件完整无缺。当您开始写入文件时，操作系统不知道文件将有多大，因此它可以将其放在一个小空间中，并在您向其写入更多数据时将其分段。
3.  仅当文件大小小于应用程序中的可用地址范围时，内存映射文件才有效。在 Win32 上，可用的地址空间量约为 2Gb - 应用程序使用的内存。映射较大的文件通常涉及取消映射和重新映射文​​件的部分，这不是最好的事情。
4.  将数据放在文件的中心没有任何帮助，因为据您所知，文件的中心部分可能是最碎片化的部分。

套用[Raymond Chen](http://blogs.msdn.com/oldnewthing/)的话说，如果您必须询问操作系统限制，您可能做错了什么。将您的文件系统视为一个不可变的黑匣子，它就是它本来的样子（我知道，您可以使用 RAID 等来提供帮助）。

您必须采取的第一步（并且必须在您进行优化时采取）是衡量您目前拥有的东西。永远不要假设任何事情。用硬数据验证一切。

从您的帖子中，听起来您实际上还没有编写任何代码，或者，如果您有，目前没有性能问题。

唯一真正的解决方案是着眼于全局并开发方法以在不停止应用程序的情况下从磁盘中获取数据。这通常是通过异步访问和推测加载。如果您的应用程序总是访问磁盘并处理数据的一小部分，您可能需要考虑重新组织数据以将所有有用的东西放在一个地方，而将其他数据放在其他地方。如果不了解完整的问题域，就不可能真正有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T15:12:41.423

使用内存映射文件访问而不是通常的 open-seek-read/write 模式。该技术适用于 Windows 和 Unix 平台。

这样，操作系统的虚拟内存系统将为您处理缓存。访问已经在内存中的块将不会导致磁盘寻道或读取时间。从内存回写到磁盘会被自动且高效地处理，并且不会阻塞您的应用程序。

Aaron 的笔记也很好，因为它们会影响不在内存中的块的初始加载时间。将其与内存映射技术相结合——毕竟使用重新排序块`memcpy()`比从磁盘读取/写入和尝试交换等更容易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T16:16:29.190

根据您所说的“难以预测”的含义，我可以想到几个选项：

如果您总是基于相同的块字段/属性进行搜索，请将记录存储在按该字段排序的磁盘上。这使您可以使用[二进制搜索](http://en.wikipedia.org/wiki/Binary_search)来提高 O(log n) 的效率。

如果您在不同的块字段上查找，请考虑为每个字段存储一个外部索引。[b-tree](http://en.wikipedia.org/wiki/B-tree)给你 O(log n) 的效率。当你寻找时，抓住适当的索引，搜索你的块的数据文件地址并跳转到它。

更好的是，如果您的块是同质的，请考虑将它们分解为数据库记录。数据库为您提供优化的存储、索引和免费执行高级查询的能力。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T15:08:00.340

解决这个问题的最简单方法是使用一个操作系统，它可以在后台为你解决这个问题，比如 Linux。给它足够的 RAM 以在 RAM 中保存 10% 的对象，它会尝试将尽可能多的对象保留在缓存中，将加载时间减少到 0。Windows 的最新*服务器*版本也可能工作（其中一些没有'不适合我，这就是我提到这个的原因）。

如果这是不行的，试试这个算法：

*   在硬盘上创建一个非常大的文件。一口气写完这个非常重要，这样操作系统就会在磁盘上分配一个连续的空间。

*   将所有对象写入该文件。确保每个对象的大小相同（或在文件中给每个对象相同的空间，并注意每个块的前几个字节的长度）。使用空硬盘或刚刚进行碎片整理的磁盘。

*   在数据结构中，保留每个数据块的偏移量以及访问频率。当它被频繁访问时，将其在文件中的位置与更接近文件开头且访问次数较少的块交换。

*   [编辑] 使用操作系统的内存映射 API 访问此文件，以允许操作系统有效缓存最常用的部分以获得最佳性能，直到您下次可以优化文件布局。

随着时间的推移，频繁访问的块将冒泡到顶部。请注意，您可以在一段时间内收集访问模式，分析它们并在您的机器上几乎没有负载的情况下在夜间重新排序。或者您可以在完全不同的机器上进行重新排序，并在完成后交换文件（和偏移表）。

也就是说，你真的应该依赖一个现代操作系统，许多聪明人一直在努力为你解决这些问题。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-08T09:54:11.877

这是一个有趣的挑战。不幸的是，我也不知道如何开箱即用地解决这个问题。Corbin 的方法对我来说听起来很合理。

至少这里有一点优化建议：将最常访问的项目放在磁盘（或未碎片化文件）的*中心*，而不是放在末尾。这样，平均而言，寻求较少使用的数据将更接近。呃，不过，这很明显。

如果您自己找到解决方案，请告诉我们。

# c# - Reading a large file into a Dictionary

> ID：343968
> 
> 赞同：3
> 
> 时间：2008-12-05T14:24:25.640
> 
> 标签：c#, performance, memory, file, filesystems

I have a 1GB file containing pairs of string and long. What's the best way of reading it into a Dictionary, and how much memory would you say it requires?

File has 62 million rows. I've managed to read it using 5.5GB of ram.

Say 22 bytes overhead per Dictionary entry, that's 1.5GB. long is 8 bytes, that's 500MB. Average string length is 15 chars, each char 2 bytes, that's 2GB. Total is about 4GB, where does the extra 1.5 GB go to?

The initial Dictionary allocation takes 256MB. I've noticed that each 10 million rows I read, consume about 580MB, which fits quite nicely with the above calculation, but somewhere around the 6000th line, memory usage grows from 260MB to 1.7GB, that's my missing 1.5GB, where does it go?

Thanks.

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-05T20:10:25.003

了解填充 Hashtable 时发生的情况很重要。（字典使用 Hashtable 作为其底层数据结构。）

当您创建一个新的 Hashtable 时，.NET 会创建一个包含 11 个存储桶的数组，这些存储桶是字典条目的链接列表。当你添加一个条目时，它的键被散列，散列码被映射到 11 个桶之一，条目（键 + 值 + 散列码）被附加到链表中。

在某个点（这取决于首次构造 Hashtable 时使用的负载因子），Hashtable 在 Add 操作期间确定它遇到了太多的冲突，并且最初的 11 个桶还不够。因此，它创建了一个新的存储桶数组，其大小是旧存储桶的两倍（不完全是；存储桶的数量始终是素数），然后从旧表填充新表。

因此，就内存利用率而言，有两件事会发挥作用。

第一个是，Hashtable 每隔一段时间就需要使用两倍于当前使用量的内存，以便它可以在调整大小时复制表。因此，如果您有一个使用 1.8GB 内存的 Hashtable 并且需要调整它的大小，那么它短暂需要使用 3.6GB，那么，现在您遇到了问题。

第二个是每个哈希表条目有大约 12 个字节的开销：指向键、值和列表中的下一个条目的指针，加上哈希码。对于大多数用途来说，这种开销是微不足道的，但如果你正在构建一个包含 1 亿个条目的 Hashtable，那么这大约是 1.2GB 的开销。

您可以通过使用 Dictionary 的构造函数的重载来解决第一个问题，该构造函数允许您提供初始容量。如果您指定一个足够大的容量来容纳您要添加的所有条目，则在您填充哈希表时不需要重新构建它。对于第二个，您几乎无能为力。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-05T14:52:32.743

这里的每个人似乎都同意，处理这个问题的最好方法是一次只将文件的一部分读入内存。当然，速度取决于内存中的哪个部分以及需要特定信息时必须从磁盘读取哪些部分。

有一种简单的方法可以决定哪些部分最好保存在内存中：

**将数据放入数据库。**

一个真正的，如 MSSQL Express，或 MySql 或 Oracle XE（都是免费的）。

数据库缓存了最常用的信息，所以它就像从内存中读取一样。它们为您提供了一种访问内存或磁盘数据的单一方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-05T14:50:46.773

也许您可以将该 1 GB 文件转换为具有两列键和值的 SQLite 数据库。然后在键列上创建索引。之后，您可以查询该数据库以获取您提供的键的值。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-05T14:38:21.697

Thinking about this, I'm wondering why you'd need to do it... (I know, I know... I shouldn't wonder why, but hear me out...)

The main problem is that there is a huge amount of data that needs to be presumably accessed quickly... The question is, will it essentially be random access, or is there some pattern that can be exploited to predict accesses?

In any case, I would implement this as a sliding cache. E.g. I would load as much as feasibly possible into memory to start with (with the selection of what to load based as much on my expected access pattern as possible) and then keep track of accesses to elements by time last accessed. If I hit something that wasn't in the cache, then it would be loaded and replace the oldest item in the cache.

This would result in the most commonly used stuff being accessible in memory, but would incur additional work for cache misses.

In any case, without knowing a little more about the problem, this is merely a 'general solution'.

It may be that just keeping it in a local instance of a sql db would be sufficient :)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T14:29:31.743

You'll need to specify the file format, but if it's just something like name=value, I'd do:

```
Dictionary<string,long> dictionary = new Dictionary<string,long>();
using (TextReader reader = File.OpenText(filename))
{
    string line;
    while ((line = reader.ReadLine()) != null)
    {
        string[] bits = line.Split('=');
        // Error checking would go here
        long value = long.Parse(bits[1]);
        dictionary[bits[0]] = value;
    }
} 
```

Now, if that doesn't work we'll need to know more about the file - how many lines are there, etc?

Are you using 64 bit Windows? (If not, you won't be able to use more than 3GB per process anyway, IIRC.)

The amount of memory required will depend on the length of the strings, number of entries etc.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-06T11:28:12.280

您能否将 1G 文件转换为更有效的索引格式，但将其作为文件保留在磁盘上？然后您可以根据需要访问它并进行有效的查找。

也许你可以内存映射这个（更有效的格式）文件的内容，然后有最小的内存使用和需求加载，这可能是一个很好的权衡之间直接访问磁盘上的文件和加载整个文件到一个大字节数组。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T15:44:51.763

我不熟悉 C#，但如果您遇到内存问题，您可能需要为此任务滚动自己的内存容器。

既然你想把它存储在一个字典中，我假设你需要它来快速查找？不过，您还没有澄清哪一个应该是关键。

我们希望您想对键使用长值。然后试试这个：

分配一个与文件一样大的缓冲区。将文件读入该缓冲区。

然后创建一个以长值（我猜是 32 位值？）作为键的字典，它们的值也是 32 位值。

现在像这样浏览缓冲区中的数据：找到下一个键值对。计算其值在缓冲区中的偏移量。现在将此信息添加到字典中，其中长作为键，偏移量作为其值。

这样，您最终会得到一个字典，每条记录可能需要 10-20 个字节，以及一个更大的缓冲区来保存所有文本数据。

我认为，至少对于 C++，这将是一种相当节省内存的方式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-07T15:46:51.883

如果您选择使用数据库，最好使用 dbm 风格的工具，例如[Berkeley DB for .NET](http://sourceforge.net/projects/libdb-dotnet)。它们专门设计用于表示基于磁盘的哈希表。

或者，您可以使用一些数据库技术推出自己的解决方案。

假设您的原始数据文件如下所示（点表示字符串长度不同）：

```
[key2][value2...][key1][value1..][key3][value3....] 
```

将其拆分为索引文件和值文件。

值文件：

```
[value1..][value2...][value3....] 
```

索引文件：

```
[key1][value1-offset]
[key2][value2-offset]
[key3][value3-offset] 
```

索引文件中的记录是固定大小的`key->value-offset`对，并按键排序。值文件中的字符串也按键排序。

要为`key(N)`您获取值，可以对索引中的记录进行二进制搜索`key(N)`，然后从值文件中读取字符串，从 开始`value(N)-offset`并结束 before `value(N+1)-offset`。

可以将索引文件读入内存中的结构数组（与 Dictionary 相比，开销更少，内存消耗更可预测），或者您可以直接在磁盘上进行搜索。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-05T14:40:53.453

Loading a 1 GB file in memory at once doesn't sound like a good idea to me. I'd virtualize the access to the file by loading it in smaller chunks only when the specific chunk is needed. Of course, it'll be slower than having the whole file in memory, but 1 GB is a real mastodon...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-05T15:36:30.533

即使您有 8 GB 的物理 RAM，也不要将 1GB 的文件读入内存，您仍然会遇到很多问题。-根据个人经验-

我不知道您需要做什么，但找到解决方法并部分阅读并处理。如果它不起作用，则考虑使用数据库。

# vb6 - VB6 P&D Installations, "The destination file is in use..."

> ID：343971
> 
> 赞同：0
> 
> 时间：2008-12-05T14:25:39.350
> 
> 标签：vb6, installation, packaging

I am maintaining an application written in VB6 and we currently use package and deployment wizard to create installations for our project. When most users try to install this software they get the error message:

```
C:\WINDOWS\system32\vbajet32.dll
The destination file in in-use. Please ensure that all other applications are closed. 
```

Can anyone tell me if there is a specific way that I can avoid this happening by changing something in the installation files/setup or writing some kind of script? I have no experience writing packaging/deployment scripts which is part of why we use P&D wizard.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T14:29:21.200

Your installer is probably trying to replace a dll (vbsjet32.dll) that is being used by another app.

Maybe they are using Access (or another app) while trying to install and it's already using the dll.

You may be able to get around it by making sure users have closed all open programs before installing, or you may have to write custom code to handle it.

# sharepoint - SharePoint (MOSS 2007) 删除 用户

> ID：343983
> 
> 赞同：1
> 
> 时间：2008-12-05T14:28:31.123
> 
> 标签：sharepoint, moss

老板想知道如何在 Sharepoint 中删除用户。我们让他确信删除用户太难了，因为该用户通过系统的痕迹，所以现在他希望能够将用户名更改为全 X 或类似的名称。我浏览了数据库，发现了几个 UserInfo 表，一个在`SharePoint_AdminContent_<guid>`db 中，另一个在 SharedServices 中。有没有更好的方法来更改用户名？我在错误的轨道上吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T14:51:51.340

请不要直接访问数据库，因为它不受支持；您甚至可能在此过程中破坏完整性。

如果您**真的**想“删除”用户的所有痕迹，我建议您查看“ `stsadm -o migrateuser`”以将用户重命名为在您的会员提供商中创建的虚拟 XXX 用户。

**编辑**：它是 migrateuser 而不是 renameuser，我的错误

[http://technet.microsoft.com/en-us/library/cc262141.aspx](http://technet.microsoft.com/en-us/library/cc262141.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T16:01:14.807

有“ `stsadm -o deleteuser`”。请参阅[此 TechNet 文章](http://technet.microsoft.com/en-us/library/cc287928.aspx)。该命令将从网站集中删除用户。

您还可以在[Keith Richie 的博客](http://blogs.msdn.com/krichie/archive/2006/05/17/600040.aspx)上找到更多选项。那是从 WSS 2.0 / SPS 2003 时代开始的，但那里有很多好的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T19:07:15.363

您无法从 SharePoint 中删除用户的原因是用户未存储在 SharePoint 中。用户存储在各自的成员资格提供程序中：AD、aspnetsqlmembershipprovider 等。

从 SharePoint 环境中删除用户的过程是首先转到您的成员资格提供商并在那里删除该用户。完成此操作后，您可以选择。

1.  您可以留下用户的工件以获取遗留信息。即，Joe Blow 创建了一个文档，即使 Joe Blow 不再存在（被公共汽车撞到），很高兴知道他创建了该文档。
2.  或者，您可以运行`stsadm -o deleteuser`Alex 提到的命令（每个网站集一次），该命令应该取消该用户与该网站集的所有工件的关联。用户创建的任何文档现在都将归系统管理员所有（我相信）。使用此选项的一个示例是当用户帐户拼写错误并且您希望在创建正确帐户之前删除所有跟踪。

# delphi - 在 Delphi 中为 Excel 编写 DLL

> ID：343989
> 
> 赞同：0
> 
> 时间：2008-12-05T14:30:31.743
> 
> 标签：delphi, excel, vba, dll, idispatch

我正在使用 Turbo Delphi 2006。

DLL 将作为 VBA/DLL 组合的一部分从 Excel 中调用。

问题的第一部分是试图找出如何将对当前 Excel 会话的引用传递给 DLL。我见过的大多数其他代码是它启动了一个单独的 Excel 实例，而不是你所在的那个。

我见过一些 C++ 代码创建一个实例，`IDispatch`然后将某些内容传递给 IDispatch 对象的方法，但对 C++ 了解不多。

有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T22:56:31.893

您所描述的称为编写 COM 插件。您需要创建一个自动化 DLL 并实现[`IDTExtensibility2`](http://msdn.microsoft.com/en-us/library/aa155640(office.10).aspx#comaddins_idtextens2)接口。然后，您将收到 Excel`Application`接口作为该`OnConnection`方法的参数。

您还需要将DLL[注册](http://msdn.microsoft.com/en-us/library/aa155640(office.10).aspx#comaddins_registration)为插件，以便 Excel 自动加载它。

**编辑：**忘了提：您可能想看看[Add-in Express](http://www.add-in-express.com/add-in-delphi/)。他们的框架和组件使得开始创建 Office 插件非常容易。您绝对不必为`IDTExtensibility2`. 不过，所有这些都带有（合理的）价格标签。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T21:11:40.827

Delphi 带有一组 ActiveX 控件，可以完全访问 Excel 和其他 Office 应用程序。它们应该位于工具面板的“服务器”选项卡上。

如果不存在，则选择组件|安装包，然后向下滚动列表直到最后，然后选择正确的包。

在默认安装中，它们应该被称为：

Microsoft Office 示例自动化服务器包装组件

XP和Win2k应该有一个。XP 的将适用于 Vista。

现在，如果你想自动化 Excel。

如果您只想使用 Delphi 向 Excel 添加功能，我建议使用 COM 对象，因为我怀疑 Excel 非常接受 COM 对象。否则，您可以创建一个直接的 DLL，并像 Excel 使用任何其他 DLL 一样使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T15:02:39.243

我对Office不太了解，但我想你应该使用COM/ActiveX。然后你也会得到你的 IDispatch。请参阅[http://delphi.about.com/od/comoleactivex/OLE_COM_DCOM_Automation_ActiveX_Delphi_knowledge_base.htm](http://delphi.about.com/od/comoleactivex/OLE_COM_DCOM_Automation_ActiveX_Delphi_knowledge_base.htm)

# winapi - Windows 服务关闭

> ID：343991
> 
> 赞同：0
> 
> 时间：2008-12-05T14:30:43.350
> 
> 标签：winapi, service, atl, shutdown

我将 VS6 和 ATL 与 CServiceModule 一起使用来实现自定义 Windows 服务。如果出现致命错误，服务应自行关闭。由于 CServiceModule 可通过所有文件中的 _Module 变量获得，我想到了这样的事情来导致 CServiceModule::Run 停止发送消息并自行关闭

```
PostThreadMessage(_Module.dwThreadID, WM_QUIT, 0, 0); 
```

这是正确的还是你有更好的主意？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T14:58:51.937

我相信如果你这样做，那么服务管理器会认为你的服务已经崩溃，如果用户将它设置为自动重启，它会的。

在 .NET 中，您使用 ServiceController 来指示您的服务关闭。我希望它在 Win32 中是相似的，因为 .NET 中的大部分内容只是包装器。抱歉，我没有方便的 C++ 代码来关闭服务，但这里是 .NET 代码。这有望帮助您在 Google 上搜索所需的信息，或在 MSDN 中找到文档。

这是来自一些测试套件代码，因此是错误检查的风格；）您需要将此代码放在一个线程中，以便处理关闭消息。

```
 private void stopPLService( bool close )
  {
     if ( m_serviceController == null )
     {
        m_serviceController = new ServiceController( "PLService" );
     }

     WriteLine( "StopPLService" );

     if ( m_serviceController != null )
     {
        try
        {
           m_serviceController.Stop();
        }
        catch
        {
           // Probably just means that it wasn't running or installed, ignore
        }

        // Wait up to 30 seconds for the service to stop
        try
        {
           m_serviceController.WaitForStatus( ServiceControllerStatus.Stopped, new TimeSpan( 0, 0, 30 ) );
        }
        catch ( System.ServiceProcess.TimeoutException )
        {
           Assert.Fail( "Timeout waiting for PLService to stop" );
        }
        catch
        {
           // Not installed, we only care in the start
        }
        if ( close )
        {
           m_serviceController.Close();
           m_serviceController = null;
        }
     }
  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-07T16:47:54.197

您可能希望使用 ControlService 或[ControlServiceEx](http://msdn.microsoft.com/en-us/library/ms682110(VS.85).aspx)方法来关闭您的服务。您应该能够从 CServiceModule 获得所需的句柄。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T00:35:22.043

对于自我关闭，您将命令发送到服务管理器。试试这个样本：

```
 BOOL StopServiceCmd ( const char * szServiceName )
{ 
    SC_HANDLE schService; 
    SC_HANDLE schSCManager; 
    SERVICE_STATUS ssStatus;       // current status of the service 
    BOOL bRet;
    int iCont=0;

    schSCManager = OpenSCManager( 
        NULL, // machine (NULL == local) 
        NULL, // database (NULL == default) 
        SC_MANAGER_ALL_ACCESS // access required 
        ); 
    if ( schSCManager ) 
    { 
        schService = OpenService(schSCManager, szServiceName, SERVICE_ALL_ACCESS); 

        if (schService) 
        { 
            // try to stop the service 
            if ( ControlService( schService, SERVICE_CONTROL_STOP, &ssStatus ) ) 
            { 
                Sleep( 1000 ); 

                while( QueryServiceStatus( schService, &ssStatus ) ) 
                { 
                    iCont++;
                    if ( ssStatus.dwCurrentState == SERVICE_STOP_PENDING ) 
                    { 
                        Sleep( 1000 ); 
                        if ( iCont > 4 ) break;
                    } 
                    else 
                        break; 
                } 

                if ( ssStatus.dwCurrentState == SERVICE_STOPPED ) 
                    bRet = TRUE; 
                else 
                    bRet = FALSE; 
            } 

            CloseServiceHandle(schService); 
        } 
        else 
            bRet = FALSE; 

        CloseServiceHandle(schSCManager); 
    } 
    else 
        bRet = FALSE;

    return bRet;
} 
```

# php - .Net 中的 PHP crypt() 函数？

> ID：343995
> 
> 赞同：7
> 
> 时间：2008-12-05T14:32:07.963
> 
> 标签：php, .net, asp.net, security, encryption

我正在用 ASP.NET MVC 重写一个 PHP 网站。我想保持相同的用户群，但使用 PHP crypt() 函数对密码进行哈希处理。我需要 .Net 中的相同功能，以便我可以在登录时对密码进行哈希处理，并将其与用户数据库中的哈希密码进行检查。

crypt 在这种情况下使用 CRYPT_MD5 实现 - 哈希都以 $1$ 开头

我试过 Phalanger，但它没有 crypt 函数的 MD5 实现。

有谁知道.Net中的一个？CodeProject 上 crypt() 的 C# 示例使用 DES，而不是 MD5。

我在 C# 中尝试了以下代码，使用不同的 salt+password、password+salt 和 salt 排列，带和不带 $1$ 前缀和 $ 后缀。没有给出与 PHP 相同的结果：

```
static void Main(string[] args)
{
    const string salt = "somesalt";
    const string password = "fubar";
    const string plaintextString = password + salt;
    byte[] plaintext = GetBytes(plaintextString);
    var md5 = MD5.Create("MD5");
    byte[] hash = md5.ComputeHash(plaintext);
    string s = System.Convert.ToBase64String(hash);
    Console.WriteLine("Hash of " + password + " is " + s);
    Console.ReadKey();
}

private static byte[] GetBytes(string s)
{
    var result = new byte[s.Length];
    for (int i = 0; i < s.Length; i++)
        result[i] = (byte)s[i];
    return result;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T14:43:48.517

有一些用于 md5 散列的 .NET 方法，`System.Web.Security.FormsAuthentication.HashPasswordForStoringInConfigFile(password, format)`是最容易使用的，即使它是一口。只需将“md5”作为格式传递。

根据 PHP 是如何做到这一点的，它可能就像`$1$`在导入时将散列的开头切掉一样简单。它可能更复杂。如果您可以发布示例密码/哈希，我会看看我是否可以想出一些 C# 为您从该密码生成相同的哈希。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T14:46:21.663

您看过 .NET [MD5 类](http://msdn.microsoft.com/en-us/library/system.security.cryptography.md5.aspx)吗？$1$ 是 12 个字符的盐的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T15:18:01.290

至少这些看起来很有希望。

用于`CRYPT_MD5`带`$1$`盐的[unix md5crypt 。](http://69.10.233.10/KB/recipes/Unix_md5crypt.aspx)

（用于 DES[的 Unix crypt() 的 AC# 实现）](http://www.codeproject.com/KB/cs/unixcrypt.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-26T03:59:50.443

我目前正在研究完全相同的问题。我想出的解决方案是通过外部调用直接调用 php 函数：

```
[DllImport( "php5ts.dll", EntryPoint = "crypt", CharSet = CharSet.Ansi )]
private static extern string crypt( string str, string salt ); 
```

当运行本地 WebDev 服务器、IIS5 和 IIS6 时，这适用于 php 版本 5.2.10，但如果您使用 II7，ASP.Net 工作进程会因未处理的异常而崩溃。（我会在找到解决方案后立即更新我的答案）

我们还包括一个密码类型标志，允许我们为所有新用户使用 .Net MD5 实现，并在现有用户更新其详细信息时无缝转换他们。

**更新：**直接从 IIS7 引用 php5ts.dll 的问题似乎很可能归结为使用 64 位 Windows，因此此解决方案可能适用于 32 位 Windows 7 或 Server 2008 安装，但我无法验证这一点。事实证明，我们现有的站点正在使用 DES，因此我们能够使用 CodeProject 的 crypt 实现，感谢 Mike 的参考。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-26T18:01:00.257

我找到的唯一解决方案是调用一个简单的 PHP 脚本，该脚本只需执行输入字符串的哈希并返回它:-(**~~