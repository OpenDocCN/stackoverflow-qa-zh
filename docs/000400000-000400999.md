# StackOverflow 问答 000400000-000400999

# c# - 我可以做些什么来优化我的手机网页，特别是 iPhone？

> ID：400015
> 
> 赞同：2
> 
> 时间：2008-12-30T11:07:08.953
> 
> 标签：c#, asp.net, iphone

所以我给自己买了一部 iPhone……每个人都有一部……所以我想我会**看看**有什么大不了的。令我惊讶的是......以及整体的怀疑......我必须说我对 iPhone**印象**深刻。这里没有任何**真正的**魔法......它似乎是一个**非常干净且非常易于**使用的设备。

所以现在我想利用我们的内部项目管理应用程序创建另一个专门针对 iPhone 的用户界面。

我用谷歌搜索了一些网站，其中大多数看起来都很酷，不是真正的肉或物质。我确实看到你可以在哪里使用一些额外的 Html 属性来让某些东西出现 iPhonish 以及一个用户界面库来帮助渲染。

您是否知道任何好的网站或有任何关于开始使用 ASP.NET 创建 iPhone Web 用户界面的建议？是否有任何参考资料可以解释 iPhone/Safari 可以识别的所有 Html 技巧或语法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T11:55:36.767

苹果[开发者网站](http://developer.apple.com/webapps/)是最好的起点。

如果您只是在做一个 Web 应用程序并且您对基于浏览器的界面感到满意，那么您不需要使用 mac 进行开发。

我自己不使用 ASP.NET，但是使用它应该没有什么特别之处，您只需要遵循 HTML / javascript 界面的指南，因此它应该与使用任何其他 javascript 库没有什么不同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T12:01:30.343

如果你在谈论网页，是的，它可以做到。

请参阅此处的 Aaron Rocks 帖子：[使用 ASP.NET MVC 摇滚 iPhone](http://weblogs.asp.net/aaronlerch/archive/2008/06/08/rock-the-iphone-with-asp-net-mvc.aspx)（通过[Scott Hanselman](http://www.hanselman.com/blog/TheWeeklySourceCode28IPhoneWithASPNETMVCEdition.aspx)）

他正在使用MVC。

我还没有尝试过，但它看起来不错。

希望这可以帮助。

**编辑：**

[MVC 4 路线图](http://aspnet.codeplex.com/wikipage?title=ASP.NET%20MVC%204%20RoadMap)表明MVC 4 应该支持移动视图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T16:47:46.503

你可以试试[IUI](http://code.google.com/p/iui/)。它使用简单，看起来很棒。您需要做的就是修改您的 ASP 页面以使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T21:56:24.400

在某种程度上，你的问题没有意义。浏览器（webkit，这是 iphone 使用的，IE，FF，Safari）看不到服务器上发生了什么，这是 asp.net 所在的位置。所以你的问题应该是：我可以做些什么来优化我的手机网页，特别是 iPhone？[这是我认为看起来很有帮助](http://www.ehousestudio.com/blog/2008/01/24/how-your-website-will-look-on-the-iphone-and-ipod-touch/)的第一击。

# iphone - 如何在 iPhone 上录制音频

> ID：400016
> 
> 赞同：3
> 
> 时间：2008-12-30T11:07:12.993
> 
> 标签：iphone

我想使用 iphone 录制音频（< 2 分钟）并将其保存到文件中。我看着 SpeakHere，但它让我感到困惑。我使用哪些类？我要创建哪些委托方法？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-28T03:55:46.240

我同意，SpeakHere 不是学习 iPhone 音频的一个很好的起点。

iPhone 音频使用两个概念。音频队列和音频会话。如果要录制到文件，则需要创建一个 AudioSession，激活会话，然后创建一个 AudioInputQueue 和一个 AudioOutputQueue。

AudioQueues 的参考（到目前为止，您将处理最多的部分）是：

[http://developer.apple.com/iphone/library/documentation/MusicAudio/Conceptual/AudioQueueProgrammingGuide/Introduction/Introduction.html](http://developer.apple.com/iphone/library/documentation/MusicAudio/Conceptual/AudioQueueProgrammingGuide/Introduction/Introduction.html)

至于音频会话：

[http://developer.apple.com/iphone/library/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/Introduction/Introduction.html](http://developer.apple.com/iphone/library/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/Introduction/Introduction.html)

虽然你可以忽略大部分 AudioSession 的东西，因为你不会做任何那么复杂的事情。所以基本上，这里是步骤：

1.  使用 AudioInterrupt 回调初始化您的音频会话。此回调处理来电的情况，中断您的程序。
2.  设置传入音频和文件绑定音频的数据格式。这存储在一个名为 AudioStreamBasicDescription 的结构中。
3.  创建一个 AudioQueue 对象并使用 AudioQueueNewInput 对其进行初始化。您必须指定一个回调来处理传入的音频。这将是您可以指定将音频保存到文件的地方，但请注意，这是一个实时线程，您必须尽最大努力不要阻止它太久。
4.  定义您的录音系统将拥有多少个 AudioQueueBuffer。这些缓冲区是根据您在步骤 2 中指定的采样率填充的。您必须调整这些，以便在下一个缓冲区到达之前有足够的时间进行处理。
5.  AudioSessionSetActive(YES);
6.  AudioQueueStart 在您的 AudioQueue 上。

我没有在这里包含所有参数，但这就是 API 的用途。

希望有帮助。

[编辑]

抱歉，忘记包含输出内容，尽管它们相当简单。创建另一个 AudioQueue，使用 AudioQueueNewOutput 进行初始化，API 应该能够指导您完成剩下的工作。

干杯。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-16T05:11:01.253

不再需要 AudioQueue 来录制音频。现在使用 AVAudioRecorder 类是一个非常简单的过程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-06T04:10:24.447

此代码用于**录制音频**

不要忘记添加 AVFoundation 和 AudioToolBox 框架

```
NSMutableDictionary* recordSetting = [[NSMutableDictionary alloc] init];
        [recordSetting setValue :[NSNumber numberWithInt:kAudioFormatAppleIMA4] forKey:AVFormatIDKey];
        [recordSetting setValue:[NSNumber numberWithFloat:44100.0] forKey:AVSampleRateKey]; 
        [recordSetting setValue:[NSNumber numberWithInt: 2] forKey:AVNumberOfChannelsKey];

recordedTmpFile = [NSURL fileURLWithPath:[NSTemporaryDirectory() stringByAppendingPathComponent:@"filename.caf"]];
NSLog(@"Using File called: %@",recordedTmpFile);

recorder = [[ AVAudioRecorder alloc] initWithURL:recordedTmpFile settings:recordSetting error:nil];
[recorder setDelegate:self];
[recorder prepareToRecord];
[recorder record]; 
```

# c# - C# 4.0 动态特性

> ID：400022
> 
> 赞同：6
> 
> 时间：2008-12-30T11:10:51.287
> 
> 标签：c#

拥有一个可以调用可能存在或不存在的方法的动态类有什么意义？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T11:19:05.327

主要是它允许 C# 4 与 DLR 使用 Python 等语言提供的对象更好地互操作。它还允许与典型的 COM 对象进行更轻松的互操作，而无需创建互操作程序集。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T11:18:24.313

关键是您通常会确信该方法将存在（或动态处理 - 例如`FindByAuthor`，“书籍存储库”类中的方法被转换为适当的 SQL 查询）但您不知道静态类型- 或者接口类型很弱（例如 Office COM API）。

我不希望动态类型在 C# 中经常有用- 但是当它*很*方便时，我怀疑它会非常非常方便。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T11:19:43.623

原因之一是使用后期绑定可以更轻松地与 COM 进行互操作。因此，您不必再使用互操作程序集了。

如果您需要调用不同版本的 COM 服务器，这非常好。例如，当您需要应用程序使用不同版本的 Office 时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T11:34:17.963

我当然不会在互操作场景之外使用它。在处理以动态语言编写的程序集或代码时，它简化了设计时体验。在这些情况下，无论如何您都必须对动态类型做出假设。如果您的假设以任何方式失败，您将在运行时获得异常。

将其视为 Invoke 或反射的简写。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T13:12:39.713

另一个问题可能是编写应该与某些程序集版本一起使用的代码。假设一个没有定义程序集绑定的插件。现在需要为许多主机程序集版本编译相同的源代码。

在这种情况下，像“鸭子打字”这样的功能将是一个很好的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-16T16:37:25.930

我的 2 美分：非常有用`dynamic`的基于场景是隐式接口。举个例子`EndianBinaryReader`，可以使用哪个来代替，`BinaryReader`但是这两个类不共享适当的公共接口。是的，您也可以制作这样的接口并包装这些类，但是这不会扩展（如果您由于某种原因获得了第三个使用此类接口，您也必须包装它）。隐式接口（鸭子类型）是动态语言中的有用功能，`dynamic`在 C# 中也可以使用它。

# asp.net - 实体框架映射，不同的属性名称

> ID：400049
> 
> 赞同：0
> 
> 时间：2008-12-30T11:22:20.203
> 
> 标签：asp.net, entity-framework

我有一个名为 的数据库字段`abCode`，我想将其映射到对象层中调用的属性`statusCode`。需要对 msl、csdl、ssdl 和对象层进行哪些更改才能完成此操作？

以下是文件的相关（我认为）部分：

在 msl 中：

```
<ScalarProperty Name="abCode" ColumnName="abCode" /> 
```

在 csdl 中：

```
<Property Name="abCode" Type="Int32" /> 
```

在ssdl中：

```
<Property Name="ParentId" Type="int" /> 
```

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T11:40:21.803

通过纯粹的反复试验，所需的更改是：

在 msl 中：

```
<ScalarProperty Name="statusCode " ColumnName="abCode" /> 
```

在 csdl 中：

```
<Property Name="statusCode " Type="Int32" /> 
```

在对象层中，私有属性`abCode`更改为`StatusCode`.

# python - 在 Python 中读取和运行数学表达式

> ID：400050
> 
> 赞同：5
> 
> 时间：2008-12-30T11:22:43.447
> 
> 标签：python

使用 Python，我将如何读取（从字符串、文件或 url）一个数学表达式（1 + 1 是一个好的开始）并执行它？

除了抓取字符串、文件或 url，我不知道从哪里开始。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T11:43:43.450

因为python支持一些代数形式，你可以这样做：

```
eval("1 + 1") 
```

但这允许输入执行您环境中定义的任何内容：

```
eval("__import__('sys').exit(1)") 
```

此外，如果您想支持 python 不支持的东西，该方法将失败：

```
x³ + y² + c
----------- = 0
     z 
```

[您可以使用ply](http://www.dabeaz.com/ply/)实现分词器和解析器，而不是这样做。评估像“1 + 1”这样的东西不应该超过十行左右。

您还可以手动实现标记器和解析器。阅读有关 LL 和 LR 解析器的信息。在尝试之前，最好先学习使用解析器生成器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T11:28:02.000

如果您以字符串形式接收表达式，则需要将其解析为运算符和操作数，然后处理生成的树。这本身不是 python 问题。但如何处理作为字符串传递的数学表达式的一般问题。

一个快速的谷歌揭示了一堆用于 python 的词法解析器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-31T15:45:28.300

除非您想学习如何编写解析器，否则不要编写自己的解析器。正如@JF Sebastian 在评论中已经提到的，我建议使用像[SAGE这样的完整](http://www.sagemath.org/)[计算机代数系统 (CAS)](http://en.wikipedia.org/wiki/Computer_algebra_system)。它将处理比 1+1 复杂得多**的数学语句 :)**

 *** * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T11:28:51.140

也许`eval`是你所追求的？

```
>>> eval('1+1')
2 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T11:32:25.050

阅读有关[输入](http://docs.python.org/library/functions.html#input)功能的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-25T09:51:54.310

您可以利用 Python 自己的评估功能。但是，盲目使用 eval() 是非常危险的，因为有人可以欺骗您的程序：

```
eval( (__import__("os").system("rm important_file") or 1) + 1) 
```

使用 eval 的正确方法是使用以下收据，这将确保您正在评估的表达式中不包含任何危险：

[http://code.activestate.com/recipes/496746-restricted-safe-eval/](http://code.activestate.com/recipes/496746-restricted-safe-eval/)

# asp.net - 带有 XmlDataSources 的主/详细信息视图

> ID：400051
> 
> 赞同：0
> 
> 时间：2008-12-30T11:24:33.363
> 
> 标签：asp.net, data-binding, detailsview, datalist, xmldatasource

我有一个基本的测试 Web 表单，其中包含一个 DataList 和一个 DetailsView，每个表单都有两个 XmlDataSource 组件。

DataList 与底层 XML 文档的绑定很容易设置，但我正在努力连接 DetailsView。这个想法是两个可绑定控件之间存在主/细节关系，所以我想我应该挂钩到 DataList 上的 OnSelectedItemIndexChanged 来绑定 DetailsView 中当前选定的项目。但是，当我使用 XmlDataSource 使其工作时，相关键是什么/如何设置 DataKeyField？

干杯，

--larsw

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T11:32:02.493

哇！我现在正在这样做，但使用对象数据源:)

我正在关注[Matt Berseth](http://mattberseth.com)的精彩教程，[请查看他的帖子](http://mattberseth.com/blog/2008/04/masterdetail_with_the_gridview.html)。

就差不多了，只是你用了其他的DataSource，其他的都一样！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T00:32:29.093

我不确定，但看看这些链接，希望能有所帮助：

[http://www.eggheadcafe.com/tutorials/aspnet/d89d1d96-03f1-4784-bbb2-a3db1af393f5/aspnet-datalist-and-data.aspx](http://www.eggheadcafe.com/tutorials/aspnet/d89d1d96-03f1-4784-bbb2-a3db1af393f5/aspnet-datalist-and-data.aspx) [http://safari.informit.com/9780735625273/index?indexview=D](http://safari.informit.com/9780735625273/index?indexview=D) [http://my.safaribooksonline.com/0735621764/index?indexview=D](http://my.safaribooksonline.com/0735621764/index?indexview=D) [http://blogs.msdn.com/adrianvinca/archive/2006/02/15/532449.aspx](http://blogs.msdn.com/adrianvinca/archive/2006/02/15/532449.aspx) [http://safari.informit.com/ 9780735625273/index?indexview=D](http://safari.informit.com/9780735625273/index?indexview=D)

# windows - 响应 Windows 中的 ACPI 固定功能按钮？

> ID：400072
> 
> 赞同：3
> 
> 时间：2008-12-30T11:35:53.497
> 
> 标签：windows, acpi

我的笔记本电脑上有一个神秘的额外按钮，它不会导致任何键盘消息——我已经用一个低级键盘钩子验证了这一点。

它似乎是一个“ACPI 固定功能按钮”。任何想法当它被按下时我会如何回应？我发现了一些关于[它在内核模式下如何工作的](http://blogs.msdn.com/doronh/archive/2006/09/08/746834.aspx)讨论。此信息是否渗透到用户模式？还是我必须编写过滤器驱动程序？

接受 Win32 或 .NET 解决方案。Windows Vista。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T04:49:51.850

您可能会对以下 URL 感兴趣。 [Vista ACPI驱动文档](http://download.microsoft.com/download/0/0/b/00bba048-35e6-4e5b-a3dc-36da83cbb0d1/ACPIDriver_Vista.doc)和[Vista ACPI驱动PPT](http://download.microsoft.com/download/5/b/9/5b97017b-e28a-4bae-ba48-174cf47d23cd/CPA002_WH06.ppt)

# asp.net - Asp.Net MVC 是适合企业项目的解决方案吗？

> ID：400083
> 
> 赞同：13
> 
> 时间：2008-12-30T11:44:46.943
> 
> 标签：asp.net, asp.net-mvc

我们正准备使用 ASP.NET 开发一个企业人力资源项目，我们的团队对使用 MVC 而不是 WebForms 很感兴趣，但我们对此有点担心。

我们不确定这是否适合企业项目。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-30T12:09:41.497

如果您的开发人员尚未使用模型-视图-控制器概念开发任何解决方案，他们会发现 ASP.Net MVC 框架将有**相当陡峭的学习曲线**。

这是因为它不是基于通常在 Web 窗体应用程序中使用的常用代码和 .aspx 物理页面构建的，而是将所有内容相应地分为视图、控制器和模型。

**如果您的应用程序的截止日期很严格，我不建议您使用 MVC 框架构建它，而是坚持使用开发人员已经知道的东西，即基于 Web 表单的应用程序。**

但是，如果管理层愿意给您的开发人员时间来了解“新”（*更像是，不同而不是新的*）概念并适应它，那么是的，无论如何，去使用它并开发它MVC 框架。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T12:18:26.050

在预览版开始发布后不久，我就从 WebForms 进行了切换，并且从那以后一直使用 MVC 框架。它使构建和部署工作变得更加容易，更重要的是，我认为它有助于更​​好的团队合作。

在 MVC 中，两个人可以同时在同一个“页面”上工作，而在 WebForms 中，两个人在一个页面上工作最终是一个更大的挑战。这对我的团队非常有用，因为我的设计师可以在我处理视图逻辑的同时锁定页面布局。

这需要一点时间来适应，但是一旦你掌握了它的机制，你会发现它确实很好地扩展了你的网络工作的能力。

编辑 - 我的一位团队成员提醒我，虽然我们使用 MVC 作为框架，但我们仍然只使用了该项目提供的十分之一，而且我们仍然从中获得了惊人的成果。而且我认为其他人提到了它，但值得重复...... stackoverflow 是在 ASP.Net MVC 上开发的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T13:09:33.277

今年六月我选择了 WebForms 而不是 MVC，因为 MVC 还没有“成熟”。

不能告诉你我现在有多难过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T11:50:00.537

ASP.NET MVC 只是一个不同于经典 ASP.NET 的模型，如果你愿意的话，它是一个扩展。

从[这里](http://dotnetslackers.com/articles/aspnet/AnArchitecturalViewOfTheASPNETMVCFramework.aspx)：

> ASP.NET MVC 框架本质上是微软试图创建一个以 MVC 模式为中心的 ASP.NET 编程环境。目前，MVC 框架应被视为 Web 表单的替代方案。在某种程度上，MVC 框架和 Web 表单或多或少具有汽车和摩托车的共同点。两者都可以带你去其他地方，但速度、舒适度、自由感、后备箱大小不同。

例如，stackoverflow 就是建立在它之上并且效果很好。

更多信息：[我应该迁移到 ASP.NET MVC 吗？](https://stackoverflow.com/questions/30067)

更多信息： http: [//www.coderjournal.com/2008/12/introducing-aspnet-mvc-part-2-aspnet-mvc-vs-webforms/](http://www.coderjournal.com/2008/12/introducing-aspnet-mvc-part-2-aspnet-mvc-vs-webforms/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T13:22:45.187

从技术上讲，我认为 MVC 没有问题，但有一个问题：它是 beta 版，有些东西仍然会改变。[预览期间没有什么突破性的东西，但可以在此处](http://weblogs.asp.net/scottgu/archive/2008/12/19/asp-net-mvc-design-gallery-and-upcoming-view-improvements-with-the-asp-net-mvc-release-candidate.aspx)获得有关当前 Beta 版和即将发布的候选版本之间将发生什么变化的简要概述。

从法律上讲，这是另一回事。虽然微软明确允许实时部署，但我不确定他们是否对由于错误造成的任何损害负责，因为它是测试版。我知道，由于错误而采取的法律行动听起来很傻，但是一些管理团队希望有一个防弹的“这个软件可以工作，如果没有，我们会付钱给你”——许可证，而 MVC 还没有这种情况。

# perl - 是否可以使用 ActivePerl 在 Windows 上使用 -DDEBUGGER 选项编译 perl？

> ID：400094
> 
> 赞同：1
> 
> 时间：2008-12-30T11:49:53.580
> 
> 标签：perl, memory, debugging, compilation

有许多调试选项可用，但它说您需要使用 -DDEBUGGER 选项编译 Perl。我们如何在 Windows 上使用 ActivePerl 做到这一点。

另外，我遇​​到了 Perl 内存不足的问题。我正在读取一个包含 5 行的 XML 文件，但第二行对于 5 行来说太大了（文件大小为 4.3Mb）。它不解析第二行并且无法打印该行：

```
print $_ if /match/ ; #match does exists fyi 
```

那我该如何解析第二行呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T16:08:14.213

您确定您的 ActivePerl 二进制文件尚未编译并提供调试支持吗？我知道 ActiveState 提供了一个图形调试器，其功能与本机 Perl 调试器几乎相同，所以我假设他们的二进制文件已经编译并支持调试。

您的第二个问题实际上与第一个问题无关，您可能应该将其作为一个单独的问题发布。但要尝试回答：我怀疑它“太大”无法解析，因为你只受系统内存的限制，而 4.3Mb 按现代标准来说并没有那么大，即使你的正则表达式相当复杂（它没有t 似乎是）。您确定要匹配的模式确实包含在该行中吗？

我有点迷茫，因为我不明白基于简单的正则表达式匹配从文件中打印多兆字节单行的意义，尤其是。当整个文件只有 5 行时。你到底想完成什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T18:31:10.507

ActiveState 将其源代码贡献回主要的 Perl 源代码，因此您可以根据需要自行编译它。您只需使用与 ActiveState 相同的编译器。您应该能够看到`perl -V`从命令窗口运行时使用的所有编译选项 ActiveState。

但是，您可能不必这样做。如果您告诉我们您要完成的工作，我们可能会给您一个更好的答案。:)

# profiling - 分析 ClickOnce *启动*时间

> ID：400096
> 
> 赞同：1
> 
> 时间：2008-12-30T11:50:47.120
> 
> 标签：profiling, clickonce, profiler

我正在尝试优化我公司内部工具之一的启动时间。

但是，它通过 ClickOnce 部署并使用了独立存储。

我正在使用 JetBrains dotTrace 3.1 对其进行分析，但由于依赖于独立存储和 ApplicationDeployment 要求应用程序在 ClickOnce 上下文中运行，它无法启动应用程序。

我知道我可以使用手动 StopWatch-ing 来分析所有内容。但我想我会先在这里问，因为我不是常规的分析员，也不是性能狂。如果有可以节省我时间的工具或提示，那么我很想知道。

是否有*完全*支持 ClickOnce 的分析工具？

或者关于使用 JetBrains dotTrace 分析 ClickOnce 启动时间的任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T14:57:28.317

我会创建一个特定版本的应用程序进行分析，无需 ClickOnce 即可运行。希望删除隔离存储访问并返回一些虚拟值不会太困难。

即使您没有隔离存储问题，我也不确定您是否可以通过 ClickOnce 完成此操作。我没有使用 dotTrace，但我认为它需要 .pdb 文件来分析您的代码。如果您使用您的应用程序部署 .pdb 文件，我会感到惊讶。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:26:33.803

您可以使用 DotTrace 3.1 附加到 Windows 资源管理器。执行以下步骤：

1.  运行 DotTrace
2.  运行任务管理器并杀死资源管理器
3.  文件-> 配置文件应用程序-> 可执行路径：资源管理器-> 单击启动应用程序
4.  运行您的点击一次应用程序

就这样 ：）

# .net - NHibernate不坚持多对多关系

> ID：400097
> 
> 赞同：9
> 
> 时间：2008-12-30T11:51:01.330
> 
> 标签：.net, nhibernate, fluent-nhibernate

我目前使用 NHibernate 作为我的数据访问层，使用 Fluent NHibernate 为我创建映射文件。我有两个类，TripItem 和 TripItemAttributeValue，它们之间有一个多对多的关系。

映射如下：

```
public class TripItemMap : ClassMap<TripItem2>
{
    public TripItemMap()
    {
        WithTable("TripItemsInt");
        NotLazyLoaded();

        Id(x => x.ID).GeneratedBy.Identity().WithUnsavedValue(0);
        Map(x => x.CreateDate, "CreatedOn").CanNotBeNull();
        Map(x => x.ModifyDate, "LastModified").CanNotBeNull();

        /* snip */

        HasManyToMany<TripItemAttributeValue>(x => x.Attributes).AsBag()
            .WithTableName("TripItems_TripItemAttributeValues_Link")
            .WithParentKeyColumn("TripItemId")
            .WithChildKeyColumn("TripItemAttributeValueId")
            .LazyLoad();
    }
}

public class TripItemAttributeValueMap : ClassMap<TripItemAttributeValue>
{
    public TripItemAttributeValueMap()
    {
        WithTable("TripItemAttributeValues");

        Id(x => x.Id).GeneratedBy.Identity();
        Map(x => x.Name).CanNotBeNull();

        HasManyToMany<TripItem2>(x => x.TripItems).AsBag()
            .WithTableName("TripItems_TripItemAttributeValues_Link")
            .WithParentKeyColumn("TripItemAttributeValueId")
            .WithChildKeyColumn("TripItemId")
            .LazyLoad();
    }
} 
```

在我的应用程序的某个时刻，我从数据库中获取现有属性，将它们添加到tripItem.Attributes，然后保存tripItem 对象。最后，TripItems_TripItemAttributeValues_Link 永远不会得到任何新记录，导致关系没有被持久化。

如果有帮助，这些是 Fluent NHibernate 为这些类生成的映射文件：

```
<?xml version="1.0" encoding="utf-8"?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" default-lazy="true" assembly="ETP.Core" namespace="ETP.Core.Domain">
  <class name="TripItem2" table="TripItemsInt" xmlns="urn:nhibernate-mapping-2.2" lazy="false">
    <id name="ID" column="ID" type="Int32" unsaved-value="0">
      <generator class="identity" />
    </id>
    <property name="CreateDate" column="CreatedOn" type="DateTime" not-null="true">
      <column name="CreatedOn" />
    </property>
    <property name="ModifyDate" column="LastModified" type="DateTime" not-null="true">
      <column name="LastModified" />
    </property>
    <bag name="Attributes" lazy="true" table="TripItems_TripItemAttributeValues_Link">
      <key column="TripItemId" />
      <many-to-many column="TripItemAttributeValueId" class="ETP.Core.Domain.TripItemAttributeValue, ETP.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
    </bag>
  </class>
</hibernate-mapping> 
```

和

```
<?xml version="1.0" encoding="utf-8"?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" default-lazy="true" assembly="ETP.Core" namespace="ETP.Core.Domain">
  <class name="TripItemAttributeValue" table="TripItemAttributeValues" xmlns="urn:nhibernate-mapping-2.2">
    <id name="Id" column="Id" type="Int32">
      <generator class="identity" />
    </id>
    <property name="Name" column="Name" length="100" type="String" not-null="true">
      <column name="Name" />
    </property>
    <bag name="TripItems" lazy="true" table="TripItems_TripItemAttributeValues_Link">
      <key column="TripItemAttributeValueId" />
      <many-to-many column="TripItemId" class="ETP.Core.Domain.TripItem2, ETP.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
    </bag>
  </class>
</hibernate-mapping> 
```

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T20:51:59.467

@efdee

我遇到了同样的问题，花了将近两天的时间。我有一个多对多的关系，并且链接表也没有更新。我是 NHibernate 的新手，只是想学习它，所以对我所说的一切持保留态度。

好吧，事实证明它不是 Fluent NHibernate，也不是映射，但我不明白 NHibernate 如何与多对多一起工作。在多对多关系中，如果两个实体上的集合都没有填充，NHibernate 不会将数据持久化到链接表中。

假设我在多对多关系中有这个实体：

```
 partial class Contact
{
   public string ContactName {get; set;}
   public IList Locations {get; set;}

}

partial class Location
{
   public string LocationName {get; set;}
   public string LocationAddress {get;set;}
   public IList Contacts {get;set;}
} 
```

当我将位置添加到 Contact.Locations 时，我必须确保该联系人也存在于 location.Contacts 中。

所以要添加一个位置，我在我的 Contact 类中有这个方法。

```
 public void AddLocation(Location location)
        {
            if (!location.Contacts.Contains(this))
            {
                location.Contacts.Add(this);
            }
            Locations.Add(location);
        } 
```

这似乎解决了我的问题，但就像我说的我只是拿起 NHibernate 并学习它，可能有更好的方法。如果有人有更好的解决方案，请发布。

这是让我检查两个集合的帖子：http: [//www.coderanch.com/t/217138/Object-Relational-Mapping/link-table-of-ManyToMany-annotation](http://www.coderanch.com/t/217138/Object-Relational-Mapping/link-table-of-ManyToMany-annotation)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-10-17T17:49:27.203

调用 Session.Flush() 或使用事务。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-05T09:44:04.340

我也遇到了同样的问题 - 多对多的加入数据没有持久化。我已经从另一个多对一关系复制了映射（将其修改为多对多 rel），但保留了一个 inverse="true" 属性。当我删除这个属性时，问题就解决了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-02T13:55:37.947

我不确定你是如何使用 Fluent NHibernate 的，但你需要在包上设置 Cascade 选项（`TripItems`）。像往常一样，[Ayende 有一篇关于级联选项的有用帖子](http://ayende.com/Blog/archive/2006/12/02/NHibernateCascadesTheDifferentBetweenAllAlldeleteorphansAndSaveupdate.aspx "如果对 NHibernate 有疑问，请先查看 Ayende 的博客")。

从快速谷歌，我建议你尝试：

```
HasManyToMany<TripItem2>(x => x.TripItems).AsBag()
        .WithTableName("TripItems_TripItemAttributeValues_Link")
        .WithParentKeyColumn("TripItemAttributeValueId")
        .WithChildKeyColumn("TripItemId")
        .LazyLoad()
/*-->*/ .Cascade.All(); /*<-- this is the bit that should make it work */ 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-02T14:20:03.467

David Kemp 说得对：你想在你的包里添加一个级联。

我总是手工编辑（和手工创建）映射文件，所以我自然倾向于把它放在那里。你可以这样做：

```
<bag name="TripItems" lazy="true" table="TripItems_TripItemAttributeValues_Link" cascade="all">
  <key column="TripItemAttributeValueId" />
  <many-to-many column="TripItemId" class="ETP.Core.Domain.TripItem2, ETP.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
</bag> 
```

我发现保持我的类“纯”并在 .hbm.xml 文件中保留与 nHibernate 相关的所有内容可以让我的解决方案更干净。这样，如果我想使用新的 ORM 软件，我只需替换映射文件，而不重写类。我们使用单元测试来测试类并为 xml 提供可测试性，尽管我有点喜欢 Fluent NHibernate 的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-12T16:44:02.163

我遇到了完全相同的问题，但我一直在使用 NHibernate.JetDriver。我尝试使用推荐的答案但没有成功。有谁知道 NHibernate.JetDriver 在多对多方面是否有限制？

这是我的 hbm 文件，以防有人碰巧有兴趣查看它们：

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" namespace="Ace.Docs.Core.Domain" assembly="Ace.Docs.Core">
<class name="Ace.Docs.Core.Domain.Address, Ace.Docs.Core" table="Addresses" lazy="true">
    <id name="Id" column="ID">
        <generator class="identity" />
    </id>
    <property name="Address1" column="Address1" />
    <property name="Address2" column="Address2" />
    <property name="City" column="City" />
    <property name="EmailAddress" column="EmailAddress" />
    <property name="Phone1" column="Phone1" />
    <property name="Phone2" column="Phone2" />
    <property name="PostalCode" column="PostalCode" />
    <property name="StateOrProvince" column="StateOrProvince" />
    <many-to-one name="AddressTypeMember" column="AddressTypeID" class="AddressType" />
    <bag name="HasPersonalInfo" table="Link_PersonalInfo_Addresses" lazy="true" cascade="save-update" inverse="true" >
        <key column="AddressID"></key>
        <many-to-many column="PersonalInfoID" class="PersonalInfo" />
    </bag>
</class> 
```

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" namespace="Ace.Docs.Core.Domain" assembly="Ace.Docs.Core">
<class name="Ace.Docs.Core.Domain.PersonalInfo, Ace.Docs.Core" table="PersonalInfo" lazy="true">
    <id name="Id" column="ID">
        <generator class="identity" />
    </id>
    <property name="Prefix" column="Prefix" />
    <property name="FirstName" column="FirstName" />
    <property name="MiddleName" column="MiddleName" />
    <property name="LastName" column="LastName" />
    <property name="SIN" column="SIN" />
    <property name="Birthdate" column="Birthdate" />
    <property name="Note" column="Notes" />
    <bag name="HasAddress" table="Link_PersonalInfo_Addresses" lazy="true" cascade="save-update" inverse="true" >
        <key column="PersonalInfoID"></key>
        <many-to-many column="AddressID" class="Address" />
    </bag>
</class> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-12T17:14:27.517

我已经知道了，我希望这可以帮助其他人。问题是我在两个包上都有 inverse='true' 。如果您阅读下面的摘录，您会注意到只需要在其中一个袋子上将 inverse 设置为 true：

注意使用 inverse="true"。再一次，这个设置告诉 NHibernate 忽略对类别集合所做的更改，并使用关联的另一端 - 项目集合 - 作为应该与数据库同步的表示。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-03T02:16:19.263

恐怕 Cascade.All() 并不是我的问题的真正解决方案 - 这是我尝试过的事情之一。问题不在于添加到集合中的项目没有保存——它们在被添加到集合时已经在数据库中。只是链接表中的条目没有被创建。此外，我认为 Cascade.All() 也会导致子项目被删除，这在我的场景中是不可取的行为。我试过使用 Cascade.SaveUpdate()，但正如我所指出的，这解决了一些不是我真正问题的问题:-)

但是，为了确保这一点，我将重试此解决方案并让您知道结果。

至于保持类的纯粹性，Fluent NHibernate 是 100% 的情况。您创建的类映射是与实体类一起使用的 C# 代码文件，非常类似于 .hbm.xml 文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-20T18:36:42.577

我也在为此苦苦挣扎，而我遇到麻烦的原因完全不同。在我的示例中，如果我有一个没有任何多对多关系的对象，我可以调用 saveOrUpdate，一切都会好的。但如果我有任何多对多关系，我必须确保我的 saveOrUpdate 调用在 BeginTransaction 和 CommitTransaction 中。我对流利的 Nhibernate 很陌生，如果这很明显，请道歉。但这不是我的。

# .net - 在 SQL2005 中部署 WCF 客户端程序集

> ID：400099
> 
> 赞同：4
> 
> 时间：2008-12-30T11:51:58.863
> 
> 标签：.net, wcf, sql-server-2005, stored-procedures

我正在尝试在 SQL 2005 中部署 WCF 客户端程序集。这意味着我需要为我的 WCF 客户端创建/注册依赖项，它们是：

*   System.Runtime.Serialization
*   系统.Web
*   系统.服务模型

使用此脚本：

```
CREATE ASSEMBLY System_Runtime_Serialization FROM 'C:\Windows\Microsoft.NET\Framework\v3.0\Windows Communication Foundation\System.Runtime.Serialization.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE ASSEMBLY System_Web FROM 'C:\Windows\Microsoft.NET\Framework\v2.0.50727\System.Web.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE ASSEMBLY System_ServiceModel FROM 'C:\Windows\Microsoft.NET\Framework\v3.0\Windows Communication Foundation\System.ServiceModel.dll'
WITH PERMISSION_SET = UNSAFE
GO 
```

System.Web.dll 注册失败并显示以下错误消息：

```
Assembly 'System.Web' references assembly 'system.web, version=2.0.0.0, culture=neutral, publickeytoken=b03f5f7f11d50a3a.', which is not present in the current database. SQL Server attempted to locate and automatically load the referenced assembly from the same location where referring assembly came from, but that operation has failed (reason: version, culture or public key mismatch). Please load the referenced assembly into the current database and retry your request. 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-31T19:22:08.423

好的，想通了：

我认为发生这种情况是因为我使用的是 64 位系统。我试图将 System.Web 的 32 位版本添加到 64 位 SQL Server（我认为 32 位版本确实引用了 64 位版本）。

无论如何，作为参考，工作代码如下：

```
CREATE ASSEMBLY System_Runtime_Serialization FROM 'C:\Windows\Microsoft.NET\Framework\v3.0\Windows Communication Foundation\System.Runtime.Serialization.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE ASSEMBLY System_Web FROM 'C:\Windows\Microsoft.NET\Framework64\v2.0.50727\System.Web.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE ASSEMBLY System_IdentityModel FROM 'c:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\System.IdentityModel.dll'
WITH PERMISSION_SET = UNSAFE
GO
CREATE ASSEMBLY System_IdentityModel_Selectors FROM 'c:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\System.IdentityModel.Selectors.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE ASSEMBLY System_Messaging FROM 'c:\windows\Microsoft.net\Framework\v2.0.50727\System.Messaging.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE ASSEMBLY System_ServiceModel FROM 'C:\Windows\Microsoft.NET\Framework\v3.0\Windows Communication Foundation\System.ServiceModel.dll'
WITH PERMISSION_SET = UNSAFE
GO 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-12T13:59:28.380

我遇到了同样的问题，但是我自己编写了一个客户端程序集。一个更简单的解决方案是重新编译我的程序集，将 Platform Target 设置为“AnyCPU”而不是“x86”，从而使它们可以用于运行 SQL Server 的 64 位系统。

1.  右键单击 VS 项目并选择属性。
2.  单击“属性”窗口左边缘的“构建”选项卡。
3.  将平台目标值从 x86 更改为 AnyCpu。
4.  重新编译。
5.  在 SQL Server 中重新安装程序集。

诚然，当程序集由 Microsoft 提供且无法重新编译时，此解决方案对您的情况没有帮助，但是我想为其他使用自定义程序集的人回答问题，他们可能会像我一样发现此页面很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T14:20:04.837

这似乎为其他人解决了这个问题..

> 我刚刚在我的 SQL Server 2005 SP2 安装上尝试了这个完全相同的语句，它运行良好。我猜您的 .NET 框架安装，尤其是 System.Web 已损坏，因为它引用了自身。您可以在任何其他系统上尝试它还是尝试重新安装 .NET 框架

这来自 MSDN，有原始问题的人说它解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:26:16.120

只是说...我不确定在 SQL-Server 中托管 WCF 客户端是一个特别理想的选择。SQL/CLR 有一些用途，例如，如果您（无论出于何种原因）想要在数据库中使用定制的 .NET 类型，或者（更有可能）您想要一些*范围非常狭窄的* **实用**方法，例如 Split、Regex 等。但是，我不会在 SQL 运行时内运行我的主要应用程序逻辑（例如 WCF 客户端）。

我可能得到的最接近的是在数据库中有一个队列表，并有一个 Windows 服务出队工作，处理它，并将其标记为已完成（或删除它）。这允许您在不使数据库过载的情况下扩展此类工作。

我确信它可能会起作用......我只是不会自己做。

# c# - Linq 返回列表或单个对象

> ID：400100
> 
> 赞同：7
> 
> 时间：2008-12-30T11:53:34.803
> 
> 标签：c#, linq, .net-3.5, enums

我有一个像这样的 Linq to Entities 查询：

```
var results = from r in entities.MachineRevision
              where r.Machine.IdMachine == pIdMachine
                 && r.Category == (int)pCategory
              select r; 
```

通常，我使用下面的代码来检查是否返回了一些结果：

```
if (results.Count() > 0)
{
    return new oMachineRevision(results.First().IdMachineRevision);
} 
```

但是，我在**if**条件下得到**NotSupportedException 。**

 **错误消息是：*无法创建“闭包类型”类型的常量值。此上下文仅支持原始类型（“例如 Int32、String 和 Guid”）。*

请注意，**pCategory**是 Enum 类型。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-30T12:09:36.083

**编辑**：根据您的更新，该错误可能与您的实体类中的枚举有关。有关更多信息和解决方法，请参阅此[博客条目](http://gmontrone.com/problem-with-casting-enums-in-linq-to-entities/)。我将保留我的原始答案作为对您的查询语法的改进。

尝试使用 FirstOrDefault 选择查询本身中的第一个实体，然后检查结果是否为空。

```
int compareCategory = (int)pCategory; // just a guess
var result = (from r in entities.MachineRevision
              where r.Machine.IdMachine == pIdMachine
                 && r.Category == compareCategory
              select r).FirstOrDefault();

if (result != null)
{
     return new oMachineRevision(result.IdMachineRevision);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T12:09:25.163

为什么不直接使用 FirstOrDefault() 来检查 null 呢？我看不到查询计数然后获取第一个元素的好处。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T12:57:07.327

在 linq 的标准实现中，运算符“select”和“where”映射到返回 IEnumerable 或 IQueryable 的方法。因此，使用标准 linq 方法时，应始终从查询中返回 IEnumerable 而不是单个对象。

但是作为 linq 运算符候选的 linq 方法不限于返回 IEnumerables 的方法，可以选择任何返回任何内容的方法。

如果您有名为“Select”和“Where”的实例方法，它们返回单个对象或特定于您的类并返回单个对象的扩展方法，这些方法将被使用而不是标准的 linq 对象。

我的猜测是，您的类中定义的“Select”或“Where”方法正在使 linq 返回单个值而不是`IEnumerable<T>`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T12:51:33.487

我不知道会根据查询结果创建不同的匿名对象。我猜他们只是希望结果是 IEnumerable 类型

使用foreach怎么样？

```
var results = from r in entities.MachineRevision
              where r.Machine.IdMachine == pIdMachine
                 && r.Category == pCategory
              select r;

foreach( var r in results )
{
    yield return new oMachineRevision( r.IdMachineRevision );
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-29T10:34:06.097

这也适用于所有隐式类型。我必须承认我一直忘记这一点，这就是我看到这篇文章的方式。

如果你有

```
class ClassA {
               ...

               private string value;

               ...

               public static implicit operator string(ClassA value)
               {
                    return value.ToString();
               } 

              ...
} 
```

您需要将类显式转换为 astring 以进行比较。

所以我通常这样做

```
 var myClassAStr = myClassA.ToString();

    var x = (from a in entites where a.ValToCompare == myClassAStr select a).first();

// do stuff with x
    ... 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T11:57:58.943

尝试使用

```
IENumerable<MachineRevision> results = from r in entities.MachineRevision
... 
```

反而。

我认为它是导致您的问题的 var 。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T12:14:36.773

编辑：

阅读错误信息。“无法创建‘闭包类型’类型的常量值。在此上下文中仅支持原始类型（‘例如 Int32、String 和 Guid’）。”

其中一个比较是与不是 int、string 或 guid 的类型。我猜是类别。

```
r.Machine.IdMachine == pIdMachine && r.Category == pCategory 
```

有趣的是，LinqToSql 将允许这种构造。不知道为什么 LinqToEntities 不支持这个。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-16T10:20:37.800

我认为您还可以通过使用 lambda 表达式以另一种更简单的方式选择您想要的项目。

```
var result = entities.MachineRevision
                 .Where(x => x.Machine.IdMachine == pIdMachine)
                 .Where(y => y.Category == (int)pCategory)
                 .FirstOrDefault();

if (result != null)
{
     return new oMachineRevision(result.IdMachineRevision);
} 
```

然后像往常一样进行

# c# - 在 Windows 窗体应用程序中实现键盘快捷键的最佳方法？

> ID：400113
> 
> 赞同：296
> 
> 时间：2008-12-30T12:03:07.157
> 
> 标签：c#, winforms, keyboard-shortcuts

我正在寻找一种在 C#中的[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)应用程序中实现常用 Windows 键盘快捷键（例如`Ctrl`+ `F`、`Ctrl`+ `N`）的最佳方法。

该应用程序有一个主窗体，它承载许多子窗体（一次一个）。当用户点击`Ctrl`+`F`时，我想显示一个自定义搜索表单。搜索表单将取决于应用程序中当前打开的子表单。

我正在考虑在*ChildForm_KeyDown*事件中使用类似的东西：

```
 if (e.KeyCode == Keys.F && Control.ModifierKeys == Keys.Control)
        // Show search form 
```

但这不起作用。当您按下某个键时，该事件甚至不会触发。解决办法是什么？

* * *

## 回答 #1

> 赞同：480
> 
> 时间：2008-12-30T14:04:27.800

您可能忘记将表单的[KeyPreview](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.keypreview.aspx)属性设置为 True。覆盖[ProcessCmdKey()](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.processcmdkey.aspx)方法是通用解决方案：

```
protected override bool ProcessCmdKey(ref Message msg, Keys keyData) {
  if (keyData == (Keys.Control | Keys.F)) {
    MessageBox.Show("What the Ctrl+F?");
    return true;
  }
  return base.ProcessCmdKey(ref msg, keyData);
} 
```

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2011-08-04T07:06:48.560

在您的主窗体上

1.  设置`KeyPreview`为真
2.  使用以下代码添加 KeyDown 事件处理程序

    ```
    private void MainForm_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.Control && e.KeyCode == Keys.N)
        {
            SearchForm searchForm = new SearchForm();
            searchForm.Show();
        }
    } 
    ```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-12-30T12:06:27.400

最好的方法是使用菜单助记符，即在主窗体中设置菜单条目，并为其分配所需的键盘快捷键。然后其他一切都在内部处理，您所要做的就是实现在`Click`该菜单条目的事件处理程序中执行的适当操作。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-05-11T18:07:49.643

你甚至可以试试这个例子：

```
public class MDIParent : System.Windows.Forms.Form
{
    public bool NextTab()
    {
         // some code
    }

    public bool PreviousTab()
    {
         // some code
    }

    protected override bool ProcessCmdKey(ref Message message, Keys keys)
    {
        switch (keys)
        {
            case Keys.Control | Keys.Tab:
              {
                NextTab();
                return true;
              }
            case Keys.Control | Keys.Shift | Keys.Tab:
              {
                PreviousTab();
                return true;
              }
        }
        return base.ProcessCmdKey(ref message, keys);
    }
}

public class mySecondForm : System.Windows.Forms.Form
{
    // some code...
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-30T14:17:16.060

如果你有一个菜单，那么改变它`ShortcutKeys`的属性`ToolStripMenuItem`应该可以解决问题。

如果没有，您可以创建一个并将其`visible`属性设置为 false。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-11-16T06:19:55.400

在主表单中，您必须：

*   确保将**KeyPreview**设置为**true**（默认为 TRUE）
*   添加**MainForm_KeyDown** (..) - 通过它您可以在此处设置您想要的任何快捷方式。

另外，我在谷歌上找到了这个，我想把这个分享给那些仍在寻找答案的人。（对于全球）

我认为你必须使用 user32.dll

```
protected override void WndProc(ref Message m)
{
    base.WndProc(ref m);

    if (m.Msg == 0x0312)
    {
        /* Note that the three lines below are not needed if you only want to register one hotkey.
         * The below lines are useful in case you want to register multiple keys, which you can use a switch with the id as argument, or if you want to know which key/modifier was pressed for some particular reason. */

        Keys key = (Keys)(((int)m.LParam >> 16) & 0xFFFF);                  // The key of the hotkey that was pressed.
        KeyModifier modifier = (KeyModifier)((int)m.LParam & 0xFFFF);       // The modifier of the hotkey that was pressed.
        int id = m.WParam.ToInt32();                                        // The id of the hotkey that was pressed.

        MessageBox.Show("Hotkey has been pressed!");
        // do something
    }
} 
```

进一步阅读此[http://www.fluxbytes.com/csharp/how-to-register-a-global-hotkey-for-your-application-in-c/](http://www.fluxbytes.com/csharp/how-to-register-a-global-hotkey-for-your-application-in-c/)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-09-09T11:13:21.160

[对于新手来说，汉斯的答案](https://stackoverflow.com/a/400325/709202)可能会更容易一些，所以这是我的版本。

您无需胡闹`KeyPreview`，将其设置为`false`. 要使用下面的代码，只需将其粘贴到您的下方`form1_load`并运行`F5`以查看它是否有效：

```
protected override void OnKeyPress(KeyPressEventArgs ex)
{
    string xo = ex.KeyChar.ToString();

    if (xo == "q") //You pressed "q" key on the keyboard
    {
        Form2 f2 = new Form2();
        f2.Show();
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-12-31T08:30:05.057

在 WinForm 中，我们总是可以通过以下方式获取 Control Key 状态：

```
bool IsCtrlPressed = (Control.ModifierKeys & Keys.Control) != 0; 
```

# sql-server - 是否可以使用 DBX 以编程方式创建数据库？

> ID：400114
> 
> 赞同：6
> 
> 时间：2008-12-30T12:03:47.047
> 
> 标签：sql-server, delphi, firebird, dbexpress, dbx

看起来 TSQLConnection 只连接到现有数据库，我找不到另一个允许我向数据库服务器发送命令的组件。

我将 Delphi 2009 与 Firebird 和 MSSQL 一起使用。

一个想法是连接到系统数据库（例如 MSSQL 中的 master 或 tempdb），然后将创建命令发送到服务器。这可能是 MSSQL 的一个选项，但我不确定 Firebird。

我也知道 Delphi 2009 中的新 DBX 元数据，但我找不到使用它创建数据库的方法。我发现的所有示例都是修改现有数据库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T19:05:23.060

是的你可以。dbExpress 现在包括一组功能强大的元数据类来实现这一点。

[Steve Shaughnessy在这里](http://blogs.codegear.com/steveshaughnessy/2007/09/07/38810)做了一个很好的介绍。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-21T11:26:03.987

Erick 如果您使用 Devart 驱动程序，您可以在没有 databasename 参数的情况下连接并发送 t-sql create database 命令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-09T13:54:25.233

Delphi 中包含的 dbExpress 使用“最小公分母”策略。通过本机驱动程序提供的查询统计信息等信息在 dbExpress 中是不可见的。（也许我应该问一个问题，比如“替代 dbExpress 实现中的哪个特性让你切换了？”）

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-30T13:03:54.100

您可以使用标准 TSQLQuery 在两个数据库上执行“CREATE DATABASE ...”。

请注意，这两者之间的语法不同。由于 dbx 是轻量级库，因此可能永远不会完全支持此 SQL 和 DB 特定操作。它给你留下了 SQL。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-06-05T12:44:16.493

Delphi 2007/2009 附带 DBX4。您可以使用那里的低级结构以编程方式创建数据库。在看`dbxcommons.pas`

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-12-30T14:33:13.327

您可以通过在任何服务器（甚至是 ms-access 文件）上打开的任何连接（ADO、OLEDB、ODBC 等）发送“CREATE DATABASE”脚本，只要它遵循特定的服务器 DDL 语法即可。

# msmq - 什么是 Microsoft 消息队列 (MSMQ)？它是如何工作的？

> ID：400115
> 
> 赞同：56
> 
> 时间：2008-12-30T12:03:52.553
> 
> 标签：msmq

我需要使用 MSMQ（Microsoft 消息队列）。它是什么，它是做什么用的，它是如何工作的？它与网络服务有何不同？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-12-30T12:20:13.363

在充分尊重@Juan 的回答的情况下，两者都是在两个断开连接的进程之间交换数据的方式，即进程间通信通道（IPC）。消息队列是异步的，而 Web 服务是同步的。它们使用不同的协议和后端服务来执行此操作，因此它们在实现上完全不同，但目的相似。

当其他通信进程可能不可用时，您可能希望使用消息队列，但您仍希望在客户端选择时发送消息。当另一端的进程唤醒并收到消息到达的通知时，将发生传递。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-12-30T12:09:02.510

顾名思义，它只是一个队列管理器。

您可以将对象（序列化）发送到队列中，直到您收到它们为止。它通常用于以解耦的方式在应用程序之间发送消息或对象

它与webservices无关，它们是两个不同的东西

**关于 MSMQ 的信息**：

[https://msdn.microsoft.com/en-us/library/ms711472(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/ms711472(v=vs.85).aspx)

**网络服务信息**：

[http://msdn.microsoft.com/en-us/library/ms972326.aspx](http://msdn.microsoft.com/en-us/library/ms972326.aspx)

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-12-30T13:06:11.117

**事务队列管理 101**

事务队列是一种中间件系统，它在任何给定时间可能连接或不连接的主机之间异步路由另一种消息。这意味着它还必须能够在某处持久保存消息。此类系统的示例是[MSMQ](http://www.microsoft.com/windowsserver2003/technologies/msmq/default.mspx)和[IBM MQ](http://www-01.ibm.com/software/integration/wmq/)

事务队列也可以参与[分布式事务](http://en.wikipedia.org/wiki/Distributed_transaction_processing)，回滚可以触发消息的处置。这意味着消息保证以[最多一次](http://hissa.nist.gov/rbac/5277/node9.html)语义传递，或者如果不回滚，则保证传递。如果出现以下情况，则不会传递消息：

*   主机 A 发布消息，但主机 B 未连接

*   某些东西（可能但不一定从主机 A 发起）回滚事务

*   B 事务回滚后连接

在这种情况下，B 将永远不会知道该消息甚至存在，除非通过其他媒介通知。如果事务被回滚，这可能无关紧要。如果 B 在事务回滚之前连接并收集消息，回滚也会反转消息对 B 的影响。

请注意，A 可以将消息发布到队列并保证最多一次传递。如果事务被提交，主机 A 可以假设消息已经[由可靠的传输介质传递。](http://en.wikipedia.org/wiki/Two-phase_commit_protocol) 如果事务回滚，主机 A 可以假定消息的任何影响都已被逆转。

**网页服务**

Web 服务是由（通常）HTTP 服务器发布的[远程过程调用](http://en.wikipedia.org/wiki/SOAP_(protocol))或其他服务（例如[RESTFul API ）。](http://en.wikipedia.org/wiki/Restful)它是一个同步请求/响应协议，不保证协议内置的交付。由客户端来验证服务是否已正确运行。通常，这将通过对请求的回复或呼叫超时来实现。

在后一种情况下，Web 服务不保证最多一次语义。服务器可以完成服务但无法提供响应（可能是由于服务器外部出现问题）。应用程序必须能够处理这种情况。

IIRC，RESTFul 服务应该是幂等的（在多次调用同一服务后达到相同的状态），***这是一种解决 Web 服务架构中缺乏保证的成功/失败通知的策略。*** 这个想法是，从概念上讲，写状态而不是调用服务，因此可以写任意次数。这意味着应用程序可以容忍缺少有关成功的反馈，因为它可以重新尝试发布，直到它从服务器获得“成功”消息。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-12-30T12:26:45.267

请注意，您可以将 Windows Communication Foundation (WCF) 用作 MSMQ 之上的抽象层。这让您有一种使用服务的感觉——只有单向操作。

有关详细信息，请参阅：http: [//msdn.microsoft.com/en-us/library/ms789048.aspx](http://msdn.microsoft.com/en-us/library/ms789048.aspx)

--larsw

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-30T14:01:49.757

实际上，MSMQ 和 WebService 之间没有任何关系。使用 MSMQ 进行进程间通信（您还可以使用套接字、Windows 消息传递、映射内存）。它是一个 Windows 服务，负责保存消息直到有人将它们出队。您可以说它比套接字更可靠，因为消息存储在硬盘上，但它比其他 IPC 技术慢。

您可以通过少量代码在 dotnet 中使用 MSMQ，只需声明您的`MessageQueue`对象并调用`Receive`和`Send`方法。Message 本身可以是普通的字符串或二进制数据。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T13:19:02.137

正如大家所解释的，MSMQ 被用作消息队列。消息可以是实际数据、对象和任何您可以序列化和通过网络发送的东西的包装器。MSMQ 有它自己的局限性。MSMQ 1.0 和 MSMQ 2.0 的消息限制为 4MB。MSMQ 3.0 取消了此限制。面向消息的中间件 (MOM) 是一个严重依赖于消息传递的概念。企业服务总线基础建立在消息传递之上。所有这些新技术都依赖于可靠的异步数据传递消息传递。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T12:11:25.017

谷歌搜索“MSMQ”的前几个链接应该有帮助......

[http://msdn.microsoft.com/en-us/library/ms711472(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms711472(VS.85).aspx)

[http://www.microsoft.com/windowsserver2003/techinfo/overview/msmqfaq.mspx](http://www.microsoft.com/windowsserver2003/techinfo/overview/msmqfaq.mspx)

[http://en.wikipedia.org/wiki/Microsoft_Message_Queuing](http://en.wikipedia.org/wiki/Microsoft_Message_Queuing)

更多信息在这里：[http ://www.google.com/search?q=MSMQ](http://www.google.com/search?q=MSMQ)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-02-12T07:09:48.467

MSMQ- Microsoft 消息队列：
• MSMQ 是 Microsoft 开发的消息队列实现。
• 它部署在其Windows Server 操作系统中。
• 它是一种消息传递协议，允许在不同服务器/进程上运行的应用程序以故障安全方式进行通信。
• MSMQ 在企业中通常用于构建软件。
• MSMQ 将未能到达其预期目的地的消息放入队列中，然后在到达目的地后重新发送它们，从而确保可靠传递。
• MSMQ 还支持事务。它允许在多个队列上进行多个操作，所有操作都包装在一个事务中，从而确保所有操作或没有任何操作生效。
• 消息队列(MSMQ) 技术使在不同时间运行的应用程序能够跨异构网络和可能暂时离线的系统进行通信。
以下端口用于 Microsoft 消息队列操作：
• TCP：1801
• RPC：135、2101*、2103*、2105*
• UDP：3527、1801

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-07-21T11:00:23.423

# MSMQ 代表 Microsoft 消息队列。

它只是以格式化方式存储消息的队列，以便它可以传递给数据库（可能在同一台机器上或服务器上）。那里有不同类型的队列，它们对消息进行分类。如果消息内部存在一些问题/错误或传递的无效消息会自动进入死队列，这表示它没有进一步处理。但是在将消息传递到死队列之前，它会重试最大计数，直到它没有被处理然后它可以将它发送到死队列。它通常用于将日志消息从客户端机器发送到服务器或数据库，以便如果客户端机器上发生任何问题，那么开发人员或支持团队可以通过日志来解决问题。MSMQ 是微软提供的获取 Log 文件记录的服务，使用 Log 文件轻松获取解决方案。你从这个博客得到更好的主意 [http://msdn.microsoft.com/en-us/library/ms711472(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/ms711472(v=vs.85).aspx)

# c++ - __builtin_offsetof 运算符的用途和返回类型是什么？

> ID：400116
> 
> 赞同：9
> 
> 时间：2008-12-30T12:04:23.283
> 
> 标签：c++, symbian

C++中`__builtin_offsetof`运算符（或Symbian 中的运算符）的用途是什么？`_FOFF`

此外它还返回什么？指针？字节数？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-30T12:11:11.337

它是 GCC 编译器提供的内置函数，用于实现`offsetof`C 和 C++ 标准指定的宏：

[GCC - 偏移量](http://gcc.gnu.org/onlinedocs/gcc/Offsetof.html#Offsetof)

它返回 POD 结构/联合成员所在的字节偏移量。

样本：

```
struct abc1 { int a, b, c; };
union abc2 { int a, b, c; };
struct abc3 { abc3() { } int a, b, c; }; // non-POD
union abc4 { abc4() { } int a, b, c; };  // non-POD

assert(offsetof(abc1, a) == 0); // always, because there's no padding before a.
assert(offsetof(abc1, b) == 4); // here, on my system
assert(offsetof(abc2, a) == offsetof(abc2, b)); // (members overlap)
assert(offsetof(abc3, c) == 8); // undefined behavior. GCC outputs warnings
assert(offsetof(abc4, a) == 0); // undefined behavior. GCC outputs warnings 
```

@Jonathan 提供了一个很好的例子来说明你可以在哪里使用它。我记得曾经看到它用于实现侵入式列表（其数据项包括 next 和 prev 指针本身的列表），但遗憾的是，我不记得它在哪里有助于实现它。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-30T16:08:56.113

正如@litb 指出和@JesperE 所示，offsetof() 提供了一个以字节为单位的整数偏移量（作为一个`size_t`值）。

你什么时候可以使用它？

可能相关的一种情况是表驱动操作，用于从文件中读取大量不同的配置参数并将值填充到同样庞大的数据结构中。将巨大减少到如此微不足道（并忽略各种必要的现实世界实践，例如在标题中定义结构类型），我的意思是一些参数可能是整数和其他字符串，并且代码可能看起来像：

```
#include <stddef.h>

typedef stuct config_info config_info;
struct config_info
{
   int parameter1;
   int parameter2;
   int parameter3;
   char *string1;
   char *string2;
   char *string3;
   int parameter4;
} main_configuration;

typedef struct config_desc config_desc;
static const struct config_desc
{
   char *name;
   enum paramtype { PT_INT, PT_STR } type;
   size_t offset;
   int   min_val;
   int   max_val;
   int   max_len;
} desc_configuration[] =
{
    { "GIZMOTRON_RATING", PT_INT, offsetof(config_info, parameter1), 0, 100, 0 },
    { "NECROSIS_FACTOR",  PT_INT, offsetof(config_info, parameter2), -20, +20, 0 },
    { "GILLYWEED_LEAVES", PT_INT, offsetof(config_info, parameter3), 1, 3, 0 },
    { "INFLATION_FACTOR", PT_INT, offsetof(config_info, parameter4), 1000, 10000, 0 },
    { "EXTRA_CONFIG",     PT_STR, offsetof(config_info, string1), 0, 0, 64 },
    { "USER_NAME",        PT_STR, offsetof(config_info, string2), 0, 0, 16 },
    { "GIZMOTRON_LABEL",  PT_STR, offsetof(config_info, string3), 0, 0, 32 },
}; 
```

您现在可以编写一个通用函数，从配置文件中读取行，丢弃注释和空白行。然后它隔离参数名称，并在表中查找它`desc_configuration`（您可以对其进行排序以便您可以进行二进制搜索 - 多个 SO 问题解决了这个问题）。当它找到正确的`config_desc`记录时，它可以将找到的值和`config_desc`条目传递给两个例程之一——一个用于处理字符串，另一个用于处理整数。

这些功能的关键部分是：

```
static int validate_set_int_config(const config_desc *desc, char *value)
{
    int *data = (int *)((char *)&main_configuration + desc->offset);
    ...
    *data = atoi(value);
    ...
}

static int validate_set_str_config(const config_desc *desc, char *value)
{
    char **data = (char **)((char *)&main_configuration + desc->offset);
    ...
    *data = strdup(value);
    ...
} 
```

这避免了必须为结构的每个单独成员编写单独的函数。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-02T14:40:04.767

内置`__offsetof`运算符的目的是编译器供应商可以继续 #define`offsetof()`宏，但让它与定义 unary 的类一起使用`operator&`。典型的 C 宏定义`offsetof()`仅在`(&lvalue)`返回该右值的地址时才起作用。IE

```
#define offsetof(type, member) (int)(&((type *)0)->member) // C definition, not C++
struct CFoo {
    struct Evil {
        int operator&() { return 42; }
    };
    Evil foo;
};
ptrdiff_t t = offsetof(CFoo, foo); // Would call Evil::operator& and return 42 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-30T12:21:34.827

正如@litb 所说：结构/类成员的字节偏移量。在 C++ 中，有些情况下它是未定义的，以防编译器抱怨。IIRC，实现它的一种方法（至少在 C 中）是

```
#define offsetof(type, member) (int)(&((type *)0)->member) 
```

但我确信这有问题，但我会把它留给感兴趣的读者指出......

# c# - 如何异步处理？

> ID：400130
> 
> 赞同：24
> 
> 时间：2008-12-30T12:14:26.133
> 
> 标签：c#, asynchronous, dispose

假设我有一个实现**IDisposable**接口的类。像这样的东西：

![http://www.flickr.com/photos/garthof/3149605015/](https://farm4.static.flickr.com/3199/3149605015_f090f20185_o.png)

**MyClass**使用一些非托管资源，因此**IDisposable的***Dispose()*方法会释放这些资源。**MyClass**应该像这样使用：

 ****```
using ( MyClass myClass = new MyClass() ) {
    myClass.DoSomething();
} 
```

* * *

现在，我想实现一个异步调用*DoSomething()的方法。***我向MyClass**添加了一个新方法：

![http://www.flickr.com/photos/garthof/3149605005/](https://farm4.static.flickr.com/3103/3149605005_bde86e4e0b_o.png)

现在，从客户端来看，**MyClass**应该像这样使用：

```
using ( MyClass myClass = new MyClass() ) {
    myClass.AsyncDoSomething();
} 
```

但是，如果我不做任何其他事情，这可能会失败，因为对象*myClass*可能在调用*DoSomething()*之前被释放（并抛出意外的**ObjectDisposedException**）。因此，对*Dispose()*方法的调用（隐式或显式）应该延迟到对*DoSomething()*的异步调用完成。

我认为*Dispose()*方法中的代码应该以**异步方式执行，并且只有在所有异步调用都被解决后**。我想知道这可能是实现这一目标的最佳方式。

谢谢。

*注意：为了简单起见，我没有详细介绍 Dispose() 方法是如何实现的。在现实生活中，我通常遵循[Dispose 模式](http://msdn.microsoft.com/en-us/library/fs2xkftw(VS.80).aspx)。*

* * *

**更新：**非常感谢您的回复。我感谢你的努力。正如[chakrit](https://stackoverflow.com/users/3055/chakrit) [所评论](https://stackoverflow.com/questions/400130/how-to-dispose-asynchronously#400165)的，我需要**对异步 DoSomething 进行多次调用**。理想情况下，这样的事情应该可以正常工作：

```
using ( MyClass myClass = new MyClass() ) {

    myClass.AsyncDoSomething();
    myClass.AsyncDoSomething();

} 
```

我会研究计数信号量，这似乎是我在寻找的东西。这也可能是设计问题。如果我觉得方便，我将与您分享一些真实案例以及**MyClass**的真正作用。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-30T12:28:43.843

看起来您正在使用基于事件的异步模式（[有关 .NET 异步模式的更多信息，请参见此处](http://msdn.microsoft.com/en-us/library/ms228969.aspx)），因此您通常拥有的是在异步操作完成时触发的类上的一个事件，命名为`DoSomethingCompleted`（请注意`AsyncDoSomething`应该真正调用`DoSomethingAsync`以正确遵循模式）。暴露此事件后，您可以编写：

```
var myClass = new MyClass();
myClass.DoSomethingCompleted += (sender, e) => myClass.Dispose();
myClass.DoSomethingAsync(); 
```

另一种选择是使用该`IAsyncResult`模式，您可以将调用 dispose 方法的委托传递给`AsyncCallback`参数（有关此模式的更多信息也在上面的页面中）。在这种情况下，您将拥有`BeginDoSomething`and`EndDoSomething`方法而不是`DoSomethingAsync`, 并将其称为...

```
var myClass = new MyClass();
myClass.BeginDoSomething(
    asyncResult => {
                       using (myClass)
                       {
                           myClass.EndDoSomething(asyncResult);
                       }
                   },
    null); 
```

但是无论您采用哪种方式，您都需要一种方法来通知调用者异步操作已完成，以便它可以在正确的时间处理对象。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T12:23:08.317

异步方法通常有一个回调，允许您在完成时执行一些操作。如果这是你的情况，它会是这样的：

```
// The async method taks an on-completed callback delegate
myClass.AsyncDoSomething(delegate { myClass.Dispose(); }); 
```

另一种解决方法是异步包装器：

```
ThreadPool.QueueUserWorkItem(delegate
{
    using(myClass)
    {
        // The class doesn't know about async operations, a helper method does that
        myClass.DoSomething();
    }
}); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-01-19T18:45:52.997

我认为不幸的是，微软没有要求作为`IDisposable`合同的一部分，实现应该允许`Dispose`从任何线程上下文中调用，因为没有理智的方法可以创建一个对象可以强制线程上下文继续存在它是创建的。可以设计代码，以便创建对象的线程以某种方式监视对象变得过时并且可以`Dispose`在其方便时，并且当线程不再需要其他任何东西时，它会一直存在，直到所有适当的对象都已经完成`Dispose`d，但我认为没有一种标准机制不需要创建`Dispose`.

您最好的选择可能是在一个公共线程（可能是 UI 线程）中创建所有感兴趣的对象，尝试保证线程将在感兴趣的对象的生命周期内一直存在，并使用类似`Control.BeginInvoke`请求对象的方法' 处理。前提是对象创建和清理都不会阻塞任何时间，这可能是一个好方法，但如果任何一个操作都可以阻塞不同的方法，则可能需要[也许用自己的线程打开一个隐藏的虚拟表单，所以可以在那里使用`Control.BeginInvoke`]。

或者，如果您可以控制`IDisposable`实现，请将它们设计为可以安全地异步触发。在许多情况下，只要没有人在处理该项目时尝试使用它，这将“正常工作”，但这几乎不是给定的。特别是，对于许多类型`IDisposable`，存在多个对象实例可能同时操纵公共外部资源的真正危险[例如，一个对象可能持有一个`List<>`已创建实例，在构造它们时将实例添加到该列表中，并删除实例`Dispose`。如果列表操作未同步，则异步`Dispose`可能会破坏列表，即使*正在处理的对象*未在其他情况下使用。

顺便说一句，一个有用的模式是对象在使用时允许异步处置，期望这种处置将导致任何正在进行的操作在第一个方便的机会抛出异常。像套接字这样的东西就是这样工作的。可能无法提前退出读取操作而不使其套接字处于无用状态，但如果套接字无论如何都不会被使用，那么如果另一个线程已经确定，那么读取就没有必要继续等待数据了它应该放弃。恕我直言，这就是所有`IDisposable`对象都应该努力表现的方式，但我知道没有文件要求这种通用模式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2021-08-11T12:41:24.117

从 C#8.0 开始，您可以使用`IAsyncDisposable`.

```
using System.Threading.Tasks;

public class ExampleAsyncDisposable : IAsyncDisposable
{
    public async ValueTask DisposeAsync()
    {
        // await DisposeAllTheThingsAsync();
    }
} 
```

[这里](https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/implementing-disposeasync)是微软官方文档的参考。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T12:26:22.757

我不会以某种方式更改代码以允许异步处理。相反，我会确保在调用 AsyncDoSomething 时，它将拥有它需要执行的所有数据的副本。该方法应该负责清理所有资源。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T12:35:38.730

您可以添加回调机制并将清理函数作为回调传递。

```
var x = new MyClass();

Action cleanup = () => x.Dispose();

x.DoSomethingAsync(/*and then*/cleanup); 
```

但是如果你想对同一个对象实例运行多个异步调用，这会带来问题。

一种方法是使用[Semaphore 类](http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx)实现一个简单的[计数信号](http://en.wikipedia.org/wiki/Semaphore_(programming))量来计算正在运行的异步作业的数量。

将计数器添加到 MyClass 并在每次 AsyncWhatever 调用时递增计数器，在退出时递减它。当信号量为 0 时，则该类已准备好被释放。

```
var x = new MyClass();

x.DoSomethingAsync();
x.DoSomethingAsync2();

while (x.RunningJobsCount > 0)
    Thread.CurrentThread.Sleep(500);

x.Dispose(); 
```

但我怀疑这将是理想的方式。我闻到了设计问题。也许重新考虑 MyClass 设计可以避免这种情况？

你能分享一些 MyClass 的实现吗？它应该做什么？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-08-13T15:51:53.250

这是对这个老问题的更现代的解释。

真正的目标是跟踪异步任务并等到它们完成......

```
public class MyExample : IDisposable
{
    private List<Task> tasks = new List<Task>();

    public async Task DoSomething()
    {
        // Track your async Tasks
        tasks.Add(DoSomethingElseAsync());
        tasks.Add(DoSomethingElseAsync());
        tasks.Add(DoSomethingElseAsync());
    }

    public async Task DoSomethingElseAsync()
    {
        // TODO: something else
    }

    public void Dispose()
    {
        // Block until Tasks finish
        Task.WhenAll(tasks);

        // NOTE: C# allows DisposeAsync()
        // Use non-blocking "await Task.WhenAll(tasks)"
    }
} 
```

考虑将其转换为可重用的基类。

有时我对静态方法使用类似的模式......

```
public static async Task MyMethod()
{
    List<Task> tasks = new List<Task>();

    // Track your async Tasks
    tasks.Add(DoSomethingElseAsync());
    tasks.Add(DoSomethingElseAsync());
    tasks.Add(DoSomethingElseAsync());

    // Wait for Tasks to complete
    await Task.WhenAll(tasks);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-30T12:46:48.020

所以，我的想法是保持有多少*AsyncDoSomething()*等待完成，并且仅在此计数达到零时才处理。我最初的做法是：

```
public class MyClass : IDisposable {

    private delegate void AsyncDoSomethingCaller();
    private delegate void AsyncDoDisposeCaller();

    private int pendingTasks = 0;

    public DoSomething() {
        // Do whatever.
    }

    public AsyncDoSomething() {
        pendingTasks++;
        AsyncDoSomethingCaller caller = new AsyncDoSomethingCaller();
        caller.BeginInvoke( new AsyncCallback( EndDoSomethingCallback ), caller);
    }

    public Dispose() {
        AsyncDoDisposeCaller caller = new AsyncDoDisposeCaller();
        caller.BeginInvoke( new AsyncCallback( EndDoDisposeCallback ), caller);
    }

    private DoDispose() {
        WaitForPendingTasks();

        // Finally, dispose whatever managed and unmanaged resources.
    }

    private void WaitForPendingTasks() {
        while ( true ) {
            // Check if there is a pending task.
            if ( pendingTasks == 0 ) {
                return;
            }

            // Allow other threads to execute.
            Thread.Sleep( 0 );
        }
    }

    private void EndDoSomethingCallback( IAsyncResult ar ) {
        AsyncDoSomethingCaller caller = (AsyncDoSomethingCaller) ar.AsyncState;
        caller.EndInvoke( ar );
        pendingTasks--;
    }

    private void EndDoDisposeCallback( IAsyncResult ar ) {
        AsyncDoDisposeCaller caller = (AsyncDoDisposeCaller) ar.AsyncState;
        caller.EndInvoke( ar );
    }
} 
```

如果两个或多个线程尝试同时读取/写入*pendingTasks*变量，可能会出现一些问题，因此应该使用**lock关键字来防止竞争条件：**

```
public class MyClass : IDisposable {

    private delegate void AsyncDoSomethingCaller();
    private delegate void AsyncDoDisposeCaller();

    private int pendingTasks = 0;
    private readonly object lockObj = new object();

    public DoSomething() {
        // Do whatever.
    }

    public AsyncDoSomething() {
        lock ( lockObj ) {
            pendingTasks++;
            AsyncDoSomethingCaller caller = new AsyncDoSomethingCaller();
            caller.BeginInvoke( new AsyncCallback( EndDoSomethingCallback ), caller);
        }
    }

    public Dispose() {
        AsyncDoDisposeCaller caller = new AsyncDoDisposeCaller();
        caller.BeginInvoke( new AsyncCallback( EndDoDisposeCallback ), caller);
    }

    private DoDispose() {
        WaitForPendingTasks();

        // Finally, dispose whatever managed and unmanaged resources.
    }

    private void WaitForPendingTasks() {
        while ( true ) {
            // Check if there is a pending task.
            lock ( lockObj ) {
                if ( pendingTasks == 0 ) {
                    return;
                }
            }

            // Allow other threads to execute.
            Thread.Sleep( 0 );
        }
    }

    private void EndDoSomethingCallback( IAsyncResult ar ) {
        lock ( lockObj ) {
            AsyncDoSomethingCaller caller = (AsyncDoSomethingCaller) ar.AsyncState;
            caller.EndInvoke( ar );
            pendingTasks--;
        }
    }

    private void EndDoDisposeCallback( IAsyncResult ar ) {
        AsyncDoDisposeCaller caller = (AsyncDoDisposeCaller) ar.AsyncState;
        caller.EndInvoke( ar );
    }
} 
```

我发现这种方法存在问题。由于资源的释放是异步完成的，这样的事情可能会起作用：

```
MyClass myClass;

using ( myClass = new MyClass() ) {
    myClass.AsyncDoSomething();
}

myClass.DoSomething(); 
```

**当在using**子句之外调用*DoSomething()*时，预期的行为应该是启动**ObjectDisposedException 。**但我认为这还不足以重新考虑这个解决方案。

 **** * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-07-15T17:13:21.713

我不得不去老学校。不，您不能使用简化的“使用”块。但是 Using 块只是用于清理半复杂的 try/catch/finally 块的语法糖。像使用任何其他方法一样构建您的 dispose，然后在 finally 块中调用它。

```
 public async Task<string> DoSomeStuffAsync()
    {
        // used to be a simple:
        //    using(var client = new SomeClientObject())
        //    {
        //       string response = await client.OtherAsyncMethod();
        //       return response;
        //    }
        //
        // Since I can't use a USING block here, we have to go old-school
        // to catch the async disposable.
        var client = new SomeClientObject();
        try
        {
            string response = await client.OtherAsyncMethod();
            return response;
        }
        finally
        {
            await client.DisposeAsync();
        }
    } 
```

这很丑，但它非常有效，而且比我见过的许多其他建议简单得多。

# c# - 列表 或 IList

> ID：400135
> 
> 赞同：536
> 
> 时间：2008-12-30T12:18:09.357
> 
> 标签：c#, list, generics

谁能向我解释为什么我想在 C# 中使用 IList 而不是 List ？

*相关问题：[为什么认为暴露是不好的`List<T>`](https://stackoverflow.com/questions/387937)*

* * *

## 回答 #1

> 赞同：478
> 
> 时间：2008-12-30T12:23:00.050

如果您通过其他人将使用的库来公开您的类，您通常希望通过接口而不是具体实现来公开它。如果您决定稍后更改类的实现以使用不同的具体类，这将有所帮助。在这种情况下，您的库的用户不需要更新他们的代码，因为界面不会改变。

如果你只是在内部使用它，你可能不会太在意，使用它`List<T>`可能还可以。

* * *

## 回答 #2

> 赞同：342
> 
> 时间：2009-10-05T22:53:55.273

不太流行的答案是程序员喜欢假装他们的软件将在世界范围内被重用，而事实上大多数项目将由少数人维护，无论与界面相关的声音有多好，你都是在自欺欺人你自己。

[建筑宇航员](http://www.joelonsoftware.com/items/2008/05/01.html)。您编写自己的 IList 并将任何内容添加到 .NET 框架中已有的 IList 的机会是如此遥远，以至于它是为“最佳实践”保留的理论果冻。

![软件宇航员](https://t2.gstatic.com/images?q=tbn:ga6-86aP3KtEeM:http://hannahsworld.files.wordpress.com/2007/11/astronaut.jpg)

很明显，如果你被问到你在面试中使用哪个，你会说 IList，微笑，他们都为自己如此聪明而感到高兴。或者对于面向公众的 API，IList。希望你明白我的意思。

* * *

## 回答 #3

> 赞同：192
> 
> 时间：2008-12-30T18:22:10.637

**接口是一个承诺**（或合同）。

就像承诺一样——**越小越好**。

* * *

## 回答 #4

> 赞同：111
> 
> 时间：2016-04-12T10:17:22.873

有人说“总是使用`IList<T>`而不是`List<T>`”。
他们希望您将方法签名从 更改`void Foo(List<T> input)`为`void Foo(IList<T> input)`.

这些人是错误的。

它比这更微妙。如果你将一个`IList<T>`作为公共接口的一部分返回到你的库，你会给自己留下一些有趣的选项，以便将来制作一个自定义列表。您可能永远不需要该选项，但这是一个论点。我认为这是返回接口而不是具体类型的全部参数。值得一提的是，但在这种情况下，它有一个严重的缺陷。

作为一个次要的反驳，您可能会发现每个调用者都需要一个`List<T>`，并且调用代码到处都是`.ToList()`

**但更重要的是，**如果您接受 IList 作为参数，则最好小心，因为它们`IList<T>`的`List<T>`行为方式不同。尽管名称相似，并且尽管共享*接口*，但它们**并未**公开相同的*合约*。

假设你有这个方法：

```
public Foo(List<int> a)
{
    a.Add(someNumber);
} 
```

一位乐于助人的同事“重构”了接受的方法`IList<int>`。

您的代码现在已损坏，因为`int[]`implements `IList<int>`，但大小固定。`ICollection<T>`( 的基础)的合约`IList<T>`要求使用它的代码`IsReadOnly`在尝试从集合中添加或删除项目之前检查标志。合同`List<T>`没有。

Liskov 替换原则（简化版）指出，派生类型应该能够用来代替基本类型，而无需额外的前置条件或后置条件。

这感觉就像它打破了 Liskov 替换原则。

```
 int[] array = new[] {1, 2, 3};
 IList<int> ilist = array;

 ilist.Add(4); // throws System.NotSupportedException
 ilist.Insert(0, 0); // throws System.NotSupportedException
 ilist.Remove(3); // throws System.NotSupportedException
 ilist.RemoveAt(0); // throws System.NotSupportedException 
```

但事实并非如此。答案是该示例使用了错误的 IList<T>/ICollection<T>。如果您使用 ICollection<T>，则需要检查 IsReadOnly 标志。

```
if (!ilist.IsReadOnly)
{
   ilist.Add(4);
   ilist.Insert(0, 0); 
   ilist.Remove(3);
   ilist.RemoveAt(0);
}
else
{
   // what were you planning to do if you were given a read only list anyway?
} 
```

如果有人传递给你一个数组或一个列表，如果你每次都检查标志并有一个后备，你的代码就会正常工作......但真的；谁做的？如果您的方法需要一个可以容纳其他成员的列表，您是否提前知道？您没有在方法签名中指定吗？如果你通过了一个只读列表，你到底要做什么`int[]`？

您可以将 a 替换为*正确*`List<T>`使用`IList<T>`/的代码。您*不能*保证可以将/替换为使用.`ICollection<T>` **`IList<T>``ICollection<T>``List<T>`**

 **在许多使用抽象而不是具体类型的论点中，单一职责原则/接口隔离原则很有吸引力——取决于尽可能窄的接口。在大多数情况下，如果您使用的是 a`List<T>`并且您认为可以改用更窄的界面 - 为什么不`IEnumerable<T>`呢？如果您不需要添加项目，这通常更合适。如果您需要添加到集合中，请使用具体类型`List<T>`.

对我来说`IList<T>`（和`ICollection<T>`）是 .NET 框架中最糟糕的部分。 `IsReadOnly`违反最小意外原则。永远不允许添加、插入或删除项目的类，例如`Array`，不应实现具有 Add、Insert 和 Remove 方法的接口。（另见[https://softwareengineering.stackexchange.com/questions/306105/implementing-an-interface-when-you-dont-need-one-of-the-properties](https://softwareengineering.stackexchange.com/questions/306105/implementing-an-interface-when-you-dont-need-one-of-the-properties)）

是否`IList<T>`适合您的组织？如果同事要求您将方法签名更改为使用`IList<T>`而不是`List<T>`，请询问他们如何将元素添加到`IList<T>`. 如果他们不知道`IsReadOnly`（而且大多数人不知道），那么不要使用`IList<T>`. 曾经。

* * *

请注意，IsReadOnly 标志来自 ICollection<T>，并指示是否可以从集合中添加或删除项目；但只是为了真正混淆事物，它并不表示它们是否可以被替换，在数组的情况下（返回 IsReadOnlys == true）可以。

有关 IsReadOnly 的更多信息，请参阅[ICollection<T>.IsReadOnly 的 msdn 定义](https://docs.microsoft.com/en-in/dotnet/api/system.collections.generic.icollection-1.isreadonly)

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2008-12-30T14:56:05.217

`List<T>`是 的一个具体实现，它是一个容器，可以像使用整数索引`IList<T>`的线性数组一样被寻址。`T[]`当您指定`IList<T>`方法参数的类型时，您只指定您需要容器的某些功能。

例如，接口规范不强制使用特定的数据结构。的实现与`List<T>`线性数组的访问、删除和添加元素的性能相同。但是，您可以想象一个由链表支持的实现，在末尾添加元素更便宜（恒定时间），但随机访问更昂贵。（请注意，.NET*没有*`LinkedList<T>`实现. ）*`IList<T>`*

 *此示例还告诉您，可能存在需要在参数列表中指定实现而不是接口的情况：在此示例中，每当您需要特定的访问性能特征时。对于容器的特定实现，通常可以保证这一点（`List<T>`文档：“它`IList<T>`使用大小根据需要动态增加的数组来实现通用接口。”）。

此外，您可能需要考虑公开所需的最少功能。例如。如果您不需要更改列表的内容，您可能应该考虑使用`IEnumerable<T>`扩展`IList<T>`。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2009-09-08T21:47:31.440

我会稍微扭转一下这个问题，而不是证明为什么应该使用接口而不是具体实现，而是尝试证明为什么要使用具体实现而不是接口。如果你不能证明它的合理性，请使用界面。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-12-30T12:23:19.783

IList<T> 是一个接口，因此您可以继承另一个类并仍然实现 IList<T> 而继承 List<T> 会阻止您这样做。

例如，如果有一个类 A 并且你的类 B 继承了它，那么你不能使用 List<T>

```
class A : B, IList<T> { ... } 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-12-30T13:29:15.627

```
public void Foo(IList<Bar> list)
{
     // Do Something with the list here.
} 
```

在这种情况下，您可以传入任何实现 IList<Bar> 接口的类。如果您改用 List<Bar>，则只能传入 List<Bar> 实例。

IList<Bar> 方式比 List<Bar> 方式更松散耦合。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-12-30T12:26:02.070

TDD 和 OOP 的原则通常是针对接口而不是实现进行编程。

在这种特定情况下，因为您本质上是在谈论一种语言结构，而不是自定义语言结构，所以这通常无关紧要，但是例如说您发现 List 不支持您需要的东西。如果您在应用程序的其余部分中使用了 IList，您可以使用自己的自定义类扩展 List，并且仍然能够在不重构的情况下传递它。

这样做的成本是最小的，为什么不让自己以后头疼呢？这就是接口原理的全部内容。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2008-12-30T13:35:37.423

使用接口而不是实现的最重要情况是在 API 的参数中。如果您的 API 采用 List 参数，那么使用它的任何人都必须使用 List。如果参数类型是 IList，那么调用者就有更多的自由，并且可以使用你从未听说过的类，这些类在你编写代码时甚至可能不存在。

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2015-10-18T17:53:03.800

令人惊讶的是，这些 List 与 IList 问题（或答案）都没有提到签名差异。（这就是我在 SO 上搜索这个问题的原因！）

因此，这是 List 包含的在 IList 中找不到的方法，至少从 .NET 4.5 开始（大约 2015 年）

*   添加范围
*   只读
*   二进制搜索
*   容量
*   全部转换
*   存在
*   寻找
*   找到所有
*   查找索引
*   查找最后
*   查找最后一个索引
*   为每个
*   获取范围
*   插入范围
*   最后索引
*   移除所有
*   删除范围
*   逆转
*   种类
*   数组
*   修剪过剩
*   真为所有人

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2011-08-12T05:29:15.350

如果 .NET 5.0 替换`System.Collections.Generic.List<T>`为`System.Collection.Generics.LinearList<T>`. .NET 始终拥有该名称`List<T>`，但他们保证这`IList<T>`是一个合同。所以恕我直言，我们（至少我）不应该使用某人的名字（尽管在这种情况下是 .NET）并在以后遇到麻烦。

在使用`IList<T>`的情况下，调用者总是可以保证工作，并且实现者可以自由地将底层集合更改为任何替代的具体实现`IList`

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2014-02-06T23:04:42.940

关于为什么使用接口而不是具体实现，所有概念基本上都在上面的大多数答案中说明。

```
IList<T> defines those methods (not including extension methods) 
```

`IList<T>` [MSDN 链接](http://msdn.microsoft.com/en-us/library/5y536ey6%28v=vs.110%29.aspx)

1.  添加
2.  清除
3.  包含
4.  复制到
5.  获取枚举器
6.  指数
7.  插入
8.  消除
9.  删除时间

`List<T>`实现了这九种方法（不包括扩展方法），除此之外它还有大约 41 个公共方法，这会影响您考虑在您的应用程序中使用哪一种方法。

`List<T>` [MSDN 链接](http://msdn.microsoft.com/en-us/library/6sh2ey19%28v=vs.110%29.aspx)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-12-30T12:25:21.557

您会因为定义 IList 或 ICollection 将为您的接口的其他实现打开。

您可能希望有一个 IOrderRepository 来定义 IList 或 ICollection 中的订单集合。然后，您可以使用不同类型的实现来提供订单列表，只要它们符合您的 IList 或 ICollection 定义的“规则”。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-02-07T10:51:48.710

根据另一张海报的建议，IList<> 几乎总是更可取，但是请注意，当使用 WCF DataContractSerializer 通过多个序列化/反序列化周期运行 IList<> 时[，.NET 3.5 sp 1 中存在一个错误。](https://connect.microsoft.com/VisualStudio/feedback/details/391260/executionengineexception-thrown-from-datacontractserializer-with-ilist-t?wa=wsignin1.0)

现在有一个 SP 来修复这个错误：[KB 971030](http://support.microsoft.com/kb/971030)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-06-22T05:55:24.543

***该接口确保您至少获得您期望的方法***；了解接口的定义，即。任何继承接口的类都可以实现的所有抽象方法。所以如果有人用除了他从接口继承的一些附加功能之外的几个方法创建了一个自己的大类，而这些对你没有用，最好使用对子类的引用（在这种情况下接口）并将具体的类对象分配给它。

额外的好处是，您的代码不受对具体类的任何更改的影响，因为您只订阅了具体类的少数方法，只要具体类从您的接口继承，这些方法就会存在使用。因此，它对您来说是安全的，并且对于编写具体实现以更改或向其具体类添加更多功能的编码人员来说是自由的。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-10-19T15:38:00.300

您可以从多个角度看待这个论点，包括一种纯粹的 OO 方法，它表示针对接口而不是实现进行编程。有了这个想法，使用 IList 遵循与传递和使用从头定义的接口相同的原则。我也相信一般接口提供的可扩展性和灵活性因素。如果实现 IList<T> 的类需要扩展或更改，则使用代码不必更改；它知道 IList 接口契约遵循什么。但是，在更改的类上使用具体实现和 List<T> 可能会导致调用代码也需要更改。这是因为遵循 IList<T> 的类保证了某种行为，而使用 List<T> 的具体类型无法保证这种行为。

也有能力做一些事情，比如在一个类上修改 List<T> 的默认实现 实现 IList<T> 例如 .Add、.Remove 或任何其他 IList 方法为开发人员提供了*很大*的灵活性和功能，否则是预定义的按列表<T>

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-11-29T17:00:56.143

通常，一个好的方法是在面向公众的 API 中使用 IList（如果需要，并且需要列表语义），然后在内部使用 List 来实现 API。这允许您更改为 IList 的不同实现，而不会破坏使用您的类的代码。

类名 List 可能会在下一个 .net 框架中更改，但接口永远不会更改，因为接口是合同。

请注意，如果您的 API 仅用于 foreach 循环等，那么您可能需要考虑只公开 IEnumerable。

# c# - 如何在 C# 中自动删除临时文件？

> ID：400140
> 
> 赞同：67
> 
> 时间：2008-12-30T12:20:17.543
> 
> 标签：c#, .net, temporary-files

如果我的应用程序关闭或崩溃，有什么好方法可以确保删除临时文件？理想情况下，我想获得一个临时文件，使用它，然后忘记它。

现在，我保留了一个临时文件列表，并使用在 Application.ApplicationExit 上触发的 EventHandler 删除它们。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-12-30T14:30:42.117

如果进程过早终止，则无法保证任何事情，但是，我使用“ `using`”来执行此操作..

```
using System;
using System.IO;
sealed class TempFile : IDisposable
{
    string path;
    public TempFile() : this(System.IO.Path.GetTempFileName()) { }

    public TempFile(string path)
    {
        if (string.IsNullOrEmpty(path)) throw new ArgumentNullException("path");
        this.path = path;
    }
    public string Path
    {
        get
        {
            if (path == null) throw new ObjectDisposedException(GetType().Name);
            return path;
        }
    }
    ~TempFile() { Dispose(false); }
    public void Dispose() { Dispose(true); }
    private void Dispose(bool disposing)
    {
        if (disposing)
        {
            GC.SuppressFinalize(this);                
        }
        if (path != null)
        {
            try { File.Delete(path); }
            catch { } // best effort
            path = null;
        }
    }
}
static class Program
{
    static void Main()
    {
        string path;
        using (var tmp = new TempFile())
        {
            path = tmp.Path;
            Console.WriteLine(File.Exists(path));
        }
        Console.WriteLine(File.Exists(path));
    }
} 
```

现在，当`TempFile`处理或垃圾收集文件时（如果可能）。显然，您可以随意使用它，或者在某个集合中使用它。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2014-08-20T18:14:32.833

考虑使用 FileOptions.DeleteOnClose 标志：

```
using (FileStream fs = new FileStream(Path.GetTempFileName(),
       FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.None,
       4096, FileOptions.RandomAccess | FileOptions.DeleteOnClose))
{
    // temp file exists
}

// temp file is gone 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-12-30T14:45:40.120

您可以[P/Invoke`CreateFile`](http://www.pinvoke.net/default.aspx/kernel32/CreateFile.html)并传递`FILE_FLAG_DELETE_ON_CLOSE`标志。这告诉 Windows 在所有句柄关闭后删除文件。另请参阅：[Win32`CreateFile`文档](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-04-04T00:32:31.347

我会使用 .NET`TempFileCollection`类，因为它是内置的，在旧版本的 .NET 中可用，并且实现了接口，因此如果与关键字 `IDisposable`结合使用，则可以自行清理。`"using"`

这是一个从嵌入资源中提取文本的示例（通过项目属性页添加 -> 资源选项卡，如此处所述：[如何在 .NET 程序集中嵌入文本文件？](https://stackoverflow.com/questions/433171/how-to-embed-a-text-file-in-a-net-assembly)，然后`"EmbeddedResource"`在嵌入文件的属性设置中设置为）。

```
 // Extracts the contents of the embedded file, writes them to a temp file, executes it, and cleans up automatically on exit.
    private void ExtractAndRunMyScript()
    {
        string vbsFilePath;

        // By default, TempFileCollection cleans up after itself.
        using (var tempFiles = new System.CodeDom.Compiler.TempFileCollection())
        {
            vbsFilePath= tempFiles.AddExtension("vbs");

            // Using IntelliSense will display the name, but it's the file name
            // minus its extension.
            System.IO.File.WriteAllText(vbsFilePath, global::Instrumentation.Properties.Resources.MyEmbeddedFileNameWithoutExtension);

            RunMyScript(vbsFilePath);
        }

        System.Diagnostics.Debug.Assert(!File.Exists(vbsFilePath), @"Temp file """ + vbsFilePath+ @""" has not been deleted.");
    } 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-11-19T13:54:00.313

我使用更可靠的解决方案：

```
using System.IO;
using System.Reflection;

namespace Helpers
{
    public static partial class TemporaryFiles
    {
        private const string UserFilesListFilenamePrefix = ".used-temporary-files.txt";
        static private readonly object UsedFilesListLock = new object();

        private static string GetUsedFilesListFilename()
        {
            return Assembly.GetEntryAssembly().Location + UserFilesListFilenamePrefix;
        }

        private static void AddToUsedFilesList(string filename)
        {
            lock (UsedFilesListLock)
            {
                using (var writer = File.AppendText(GetUsedFilesListFilename()))
                    writer.WriteLine(filename);
            }
        }

        public static string UseNew()
        {
            var filename = Path.GetTempFileName();
            AddToUsedFilesList(filename);
            return filename;
        }

        public static void DeleteAllPreviouslyUsed()
        {
            lock (UsedFilesListLock)
            {
                var usedFilesListFilename = GetUsedFilesListFilename();

                if (!File.Exists(usedFilesListFilename))
                    return;

                using (var listFile = File.Open(usedFilesListFilename, FileMode.Open))
                {
                    using (var reader = new StreamReader(listFile))
                    {
                        string tempFileToDelete;
                        while ((tempFileToDelete = reader.ReadLine()) != null)
                        {
                            if (File.Exists(tempFileToDelete))
                                File.Delete(tempFileToDelete);
                        }
                    }
                }

                // Clean up
                using (File.Open(usedFilesListFilename, FileMode.Truncate)) { }
            }
        }
    }
} 
```

每次您需要临时文件使用时：

```
var tempFile = TemporaryFiles.UseNew(); 
```

确保在应用程序关闭或崩溃后删除所有临时文件

```
TemporaryFiles.DeleteAllPreviouslyUsed(); 
```

在应用程序开始时。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-30T12:46:43.557

我主要不是 C# 程序员，但在 C++ 中，我会为此使用[RAII 。](https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)在线上有一些[关于在 C# 中使用类似 RAII 的行为的提示](https://docs.microsoft.com/en-us/archive/blogs/colinth/c-for-c-devs-a-doesnt-act-like-a-destructor)，但大多数似乎都使用终结器——这不是确定性的。

我认为有一些 Windows SDK 功能可以创建临时文件，但不知道它们是否会在程序终止时自动删除。有[GetTempPath](https://docs.microsoft.com/en-us/dotnet/api/system.io.path.gettemppath#System_IO_Path_GetTempPath)功能，但只有在您注销或重新启动时才会删除文件，IIRC。

PS [C#析构函数文档](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/destructors)说你可以并且应该在那里释放资源，我觉得这有点奇怪。如果是这样，您可以简单地删除析构函数中的临时文件，但同样，这可能不是完全确定的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-30T13:10:38.487

很高兴看到您想负责，但如果文件不是很大（> 50MB），您将与每个人（包括 MS）保持一致，将它们留在临时目录中。磁盘空间充足。

正如[csl](https://stackoverflow.com/users/21028/csl) [发布](https://stackoverflow.com/a/400178)的那样，GetTempPath 是要走的路。空间不足的用户将能够运行磁盘清理，并且您的文件（以及其他所有人的文件）将被清理。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T16:54:22.683

您可以在启动时启动一个线程，该线程将删除“不应该”从崩溃中恢复时存在的文件。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-07-15T18:27:19.083

如果您正在构建 Windows 窗体应用程序，则可以使用以下代码：

```
 private void Form1_FormClosing(object sender, FormClosingEventArgs e)
    {
        File.Delete("temp.data");
    } 
```

# asp.net - 将 runat="server" 添加到 HTML 标记以获取 ASP.net 中的相对路径是一种优雅的解决方案吗？

> ID：400146
> 
> 赞同：6
> 
> 时间：2008-12-30T12:23:15.273
> 
> 标签：asp.net, html

我在新网站的不同位置使用了几个 ASP.Net 用户控件。这些用户控件有这样的链接：

```
<a href="daily/panchang/"></a> 
```

如果用户控件在各个子目录的页面中使用，则相对路径不起作用，我不想在路径中提供我的完整网站名称。所以我做了这个

```
<a href="~/daily/panchang/" runat="server"> 
```

现在 ASP.Net '~' 标记可以正常工作以解析根路径。

是否可以标记我需要使用 runat="server" 解析根路径的所有 HTML 标记，或者您知道更好的 HTML 方法吗？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T12:34:14.050

我不会说这是否是一个优雅的解决方案，我只会指出 System.Web 中的一个替代方案：

```
<a href="<%= VirtualPathUtility.ToAbsolute("~/daily/panchang/") %>"> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T12:33:36.190

您应该使用基本标记来定义应用程序的根，并使所有链接都像这样相对：

```
<head>
    <base href="<%= Request.ApplicationPath %>" />
</head>
...
<a href="daily/panchang/"></a> <!-- this now points to ~/daily/panchang/ --> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T12:27:08.543

不过要小心，因为每次 PostBack 发生时，每个元素`runat="server"`都会被“序列化”并存储在[ViewState](http://weblogs.asp.net/infinitiesloop/archive/2006/08/03/truly-understanding-viewstate.aspx)中，而且你不想用无用的数据把它弄得乱七八糟。

# c# - C# 表单中的 RightToLeft 属性

> ID：400167
> 
> 赞同：2
> 
> 时间：2008-12-30T12:36:22.067
> 
> 标签：c#, winforms, internationalization

我想将表单标题、图标和关闭以及帮助按钮从左侧移动到右侧（更改布局）。

我手动移动了表单控件以保留背景图像，但现在我想更改表单标题。

当我在表单属性中将 rightToLeft 属性设置为 yes 并将 rightToLeftLayout 设置为 true 时，背景图像会消失，但它使用属性“BackColor”

我的代码如下：

```
if (_lang == 'Arabic')
{
    this.RightToLeft =  RightToLeft.Yes;
    this.RightToLeftLayout = true;
} 
```

但它保持按钮图像。

那为什么呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T12:55:11.170

为了进一步 Blounty 的回答，MSDN 规范明确指出使用 RightToLeftLayout 时不支持 BackgroundImage、Opacity 和其他：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.form.righttoleftlayout(vs.80).aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.righttoleftlayout(vs.80).aspx)：

> 当 RightToLeftLayout 设置为 Yes 时，不支持所有者绘制。所有者绘制事件仍将发生，但未定义您在这些事件中编写的任何代码的行为。此外，不支持 BackgroundImage、Opacity、TransparencyKey 和绘画事件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T12:41:14.147

当 RightToLeftLayout 设置为 yes 时，不支持 BackgroundImage、Opacity、TransparencyKey 和绘画事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T14:18:21.470

替换丢失的功能非常容易：

```
protected override void OnPaintBackground(PaintEventArgs e) {
  Rectangle rc = new Rectangle(Point.Empty, this.ClientSize);
  e.Graphics.DrawImage(Properties.Resources.SampleImage, rc);
} 
```

如果您需要平铺图像，则需要做更多的工作。

# visual-studio - Office XP 共享插件 VS 2008

> ID：400180
> 
> 赞同：1
> 
> 时间：2008-12-30T12:48:16.427
> 
> 标签：visual-studio, com, ms-office, add-in

我正在尝试使用 VS 2008 for Office XP（准确地说是 Excel）创建一个共享插件。但是，在 Visual Studio 中创建项目并更改对 Office XP 的引用（除了可扩展性，我似乎无法找到 office xp 的副本）并将 excel.exe 添加到引用中之后。我现在似乎无法在任何计算机上安装插件。

有没有人有关于使用 VS 2008（我可能添加的 Com 插件）编写 Office XP 插件的指南？

有谁知道我打算拥有的参考资料或我打算在电脑上安装的东西？

我有三台测试电脑，这台上有 office xp、2003 和 2007，我可以使用 2003 参考编写一个插件，在这台上运行，但没有其他盒子。一个只安装了office xp，还安装了office xp PIA 和.NET，另一个只安装了office xp。

任何帮助都会非常感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T10:25:21.593

我最终发现了这个问题。

问题来自 KB 条目[908002](http://support.microsoft.com/kb/908002)。不幸的是，要运行修复程序，您需要安装 Visual Studio 2005 和 Office 2003，否则它不会部署修复程序，因此我已经多次忽略了这一点。最后，我在备用机器上找到了 VS2005 和 Office 2003 的旧副本，安装了修复程序，创建了安装程序并在装有 Office XP 的机器上进行了尝试，一切正常。

要在任何装有 Office XP 的机器上工作，需要进行两个修复：

```
extensibilityMSM.msi - installs the extensibility.dll
lockbagRegKey.msi    - adds a fix to a registry key 
```

我找不到这些可以从 KB908002 修复程序中单独下载，但我在本地有副本。

应用这些修复后，可以像使用 VSTO 一样轻松使用 COM 插件，而且我只花了不到一个小时就编写了实际代码。我不是在寻找将这些作为先决条件包含在我的 MSI 安装程序中的方法。

任何问题都可以在评论中提出，我会尽快更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T18:51:00.483

您需要安装 PIA 作为先决条件。插件完全安装，还是安装失败？主机应用程序 (Excel) 可能会禁止在启动时出现异常行为的加载项。您可以在 Excel 的加载项设置对话框中重新启用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-20T03:30:45.917

@PintSizedCat -[这](http://blogs.msdn.com/b/cristib/archive/2011/04/04/deploying-a-shared-com-add-in-for-office-2003-visual-studio-2008-sp1-and-how-to-work-around-a-known-issue-which-causes-the-add-in-to-fail-to-load-if-kb908002-is-not-installed.aspx)是一个 msdn 博客的链接，它展示了如何在不安装 VS2005 的情况下提取 msi。

请参阅“构建共享 COM 加载项安装项目”部分 - 使用命令行：

vs2005-kb908002-enu-x85.exe /T:”C:\Test” /C

对我们来说，它是带有 .Net 2.0 的 Excel 2003，并且缺少 extensibility.dll。我不认为 VS2008 / VS2010 有这个作为先决条件。dll 不可再分发（根据此[博客](http://www.midniteblog.com/?p=11)- 请参阅“答案”部分） - 您必须使用 msi 重新分发它。

# javascript - 如何在javascript中处理输入元素状态的编程更改

> ID：400181
> 
> 赞同：1
> 
> 时间：2008-12-30T12:50:23.973
> 
> 标签：javascript, jquery, html, dom

我遇到了奇怪的问题。虽然用户更改表单上的复选框输入元素会产生足够的事件编程更改，但不会。我应该如何面对这个挑战？代码如下：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
  <script type="text/javascript">
    jQuery(document).ready(
      function() {        
        jQuery("#cb").change(
          function() {
            alert("Changed!"); 
            return true;
          }
        );
        jQuery("#b").click(
          function() {
            var newState = !jQuery("#cb").attr('checked');
            jQuery("#cb").attr('checked', newState);
          });
      });
  </script>
</head>
<body>
  <form action="#">
    <p>
      <input type="button" id="b" />
      <input type="checkbox" id="cb" />
    </p>
  </form>
</body>
</html> 
```

**更新** 我不控制元素更改，我只需要处理它们。这是我编写的通用建议代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T13:12:49.777

使用 trigger 函数触发复选框上的点击事件。您不需要获取现有状态，因为复选框只会通过单击来切换。

```
jQuery("#cb").trigger('click'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T13:11:59.577

在这种情况下，您不应在事件处理函数本身中编写逻辑代码。您应该将任何此类逻辑放在单独的函数中。同样，您不应将以编程方式直接操作复选框值的代码放在其他代码序列中，而应将其抽象为另一个函数：-

```
jQuery(document).ready(
  function() {

    jQuery("#cb").change(
      function() {
        changeLogicForcb.call(this);
         return true; 
     }
    );

    jQuery("#b").click(
      function() {
         togglecb();            
      });

    function changeLogicForcb()
    {
         //something actually sensible here
         alert("changed!");
    }

    function togglecb()
    {
        var cb = jQuery("#cb");
        var newState = !cb.attr('checked');
        cb.attr('checked', newState);
        changeLogicForcb.call(cb.get(0));         
    }  

  }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-19T14:42:59.083

jQuery 核心库方法 .val() 不会触发 change 事件。如果您提供自己的 jQuery 副本，则可以修改库方法，但这可能不明智。相反，您可以添加自己的利用 .val() 的值设置器，同时还可以使用以下几行的内容触发更改事件：

```
jQuery.fn.xVal = (function() {
    return function(value) {
        // Use core functionality
        result = this.val.apply(this, arguments);
        // trigger change event
        if (result instanceof jQuery) {
              result.change();
        }
        return result;
    };
})(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-20T15:27:14.087

在 javascript 语言中跟踪对象的状态是不可能的，因为它可以在 Objective-C (KVO) 中完成。也不可能使用 DOM 功能 - DOM 不会在每次属性更改时触发事件 - 相反，它只会在某些用户操作时触发事件：鼠标单击、按键或页面生命周期及其衍生。

每次修改某些属性时，人们都可以实现唯一的触发事件。当然，这可以封装在 AnthonyWJones 提到的函数中。

# generics - CodeDom - 调用泛型方法

> ID：400185
> 
> 赞同：6
> 
> 时间：2008-12-30T12:53:17.053
> 
> 标签：generics, codedom

有谁知道用 CodeDom 调用基类的泛型方法的方法？

我调用标准方法没有问题，但我找不到调用泛型的解决方案。

我用来调用标准基类方法GetInstance的代码：

```
CodeAssignStatement assignStatement = new CodeAssignStatement(
     new CodeVariableReferenceExpression("instance"),
     new CodeMethodInvokeExpression(
         new CodeThisReferenceExpression(),
         "GetInstance",
         new CodeExpression[] { new CodeVariableReferenceExpression("instance") }
     )); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-30T13:12:36.937

[您可以在](http://msdn.microsoft.com/en-us/library/system.codedom.codetypeparameter.aspx)msdn中找到您的答案：

向下滚动到 C# 示例 (CodeDomGenericsDemo)。

生成一个通用方法：

```
 public virtual void Print<S, T>()
            where S : new()
        {
            Console.WriteLine(default(T));
            Console.WriteLine(default(S));
        } 
```

稍后在示例中执行：

```
dict.Print<decimal, int>(); 
```

生成对该方法的调用的代码：

```
 methodMain.Statements.Add(new CodeExpressionStatement(
                 new CodeMethodInvokeExpression(
                      new CodeMethodReferenceExpression(
                         new CodeVariableReferenceExpression("dict"),
                             "Print",
                                 new CodeTypeReference[] {
                                    new CodeTypeReference("System.Decimal"),
                                       new CodeTypeReference("System.Int32"),}),
                                           new CodeExpression[0]))); 
```

（您将使用 CodeThisReferenceExpression() 或 CodeBaseReferenceExpression() 而不是 CodeVariableReferenceExpression），不确定这是否是您调用标准基类方法的意思。

# c++ - 您如何检索已安装路径的原始位置？

> ID：400191
> 
> 赞同：3
> 
> 时间：2008-12-30T12:58:19.010
> 
> 标签：c++, winapi, mount, subst

在 C++ 中，如何检索已安装驱动器的位置？例如，如果我已将驱动器 s: 安装到 c:\temp（在命令行中使用 subst）“subst c:\temp s:”，我如何通过传递“s:”来获取“c:\temp”

我还想知道如何为网络驱动器完成它。（如果 s: 挂载到“\MyComputer\Hello”，那么我想检索“\MyComputer\Hello”，然后从中检索“c:\Hello”）

这可能是一个非常简单的问题，但我找不到有关它的信息。

谢谢，

亚当

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T15:51:37.193

如果您使用过 SUBST，您需要的 API 是 QueryDosDevice。您可以使用 DefineDosDevice 自己 SUBST 事物。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T14:45:00.637

要查找已安装网络共享的路径，您必须使用 WNet API：

```
wstring ConvertToUNC(wstring sPath)
{
    WCHAR temp;
    UNIVERSAL_NAME_INFO * puni = NULL;
    DWORD bufsize = 0;
    wstring sRet = sPath;
    //Call WNetGetUniversalName using UNIVERSAL_NAME_INFO_LEVEL option
    if (WNetGetUniversalName(sPath.c_str(),
        UNIVERSAL_NAME_INFO_LEVEL,
        (LPVOID) &temp,
        &bufsize) == ERROR_MORE_DATA)
    {
        // now we have the size required to hold the UNC path
        WCHAR * buf = new WCHAR[bufsize+1];
        puni = (UNIVERSAL_NAME_INFO *)buf;
        if (WNetGetUniversalName(sPath.c_str(),
            UNIVERSAL_NAME_INFO_LEVEL,
            (LPVOID) puni,
            &bufsize) == NO_ERROR)
        {
            sRet = wstring(puni->lpUniversalName);
        }
        delete [] buf;
    }

    return sRet;;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T13:05:12.773

您可能可以使用[GetVolumeInformation](http://msdn.microsoft.com/en-us/library/aa364993(VS.85).aspx)函数。从文档中：

> 符号链接行为
> 
> 如果路径指向符号链接，则该函数返回目标的卷信息。

不过我自己没有测试过。

# jquery - 在jQuery中提取Ajax返回数据

> ID：400197
> 
> 赞同：43
> 
> 时间：2008-12-30T13:01:28.020
> 
> 标签：jquery, ajax, callback

我已经完成了 jQuery 和 Ajax，但我无法将响应放入 Div 元素。这是代码：

**索引.html**

```
$.ajax({
    type:"POST",
    url: "ajax.php",
    data:"id="+id ,
    success: function(html){
        $("#response").html(data);
    }
}); 
```

它正在接收对我的`<div id="response"></div>`.

将`ajax.php`以下代码返回到`index.html`文件：

```
<div id ="one"> OneVal </div>
<div id ="sub"> SubVal </div> 
```

我能否将 OneVal 和 Subval 提取到变量中，如何提取“OneVal”和“SubVal”，而不是上述响应？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-12-30T13:18:57.393

您可以`.filter`在从响应创建的 jQuery 对象上使用：

```
success: function(data){
    //Create jQuery object from the response HTML.
    var $response=$(data);

    //Query the jQuery object for the values
    var oneval = $response.filter('#one').text();
    var subval = $response.filter('#sub').text();
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-31T10:49:23.700

更改`.find`为`.filter`...

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-08-23T23:44:32.680

我注意到您的成功函数具有参数“html”，并且您正在尝试将“数据”添加到您的元素`html()`中......更改它以使它们都匹配：

```
$.ajax({
    type:"POST",
    url: "ajax.php",
    data:"id="+id ,
    success: function(data){
        $("#response").html(data);
    }
}); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-12-09T06:17:29.747

你可以`json`像下面的例子一样使用。

[PHP](http://en.wikipedia.org/wiki/PHP)代码：

```
echo json_encode($array); 
```

`$array`是数组数据，jQuery代码是：

```
$.get("period/education/ajaxschoollist.php?schoolid="+schoolid, function(responseTxt, statusTxt, xhr){
    var a = JSON.parse(responseTxt);
    $("#hideschoolid").val(a.schoolid);
    $("#section_id").val(a.section_id);
    $("#schoolname").val(a.schoolname);
    $("#country_id").val(a.country_id);
    $("#state_id").val(a.state_id);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-11T05:24:25.027

您也可以使用 jQuery**上下文**参数。[链接到文档](http://api.jquery.com/jQuery/)

> 选择器上下文
> 
> 默认情况下，选择器从文档根目录开始在 DOM 中执行搜索。但是，可以通过使用 $() 函数的可选第二个参数为搜索提供替代上下文

因此，您还可以拥有：

```
success: function(data){
    var oneval = $('#one',data).text();
    var subval = $('#sub',data).text();
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-11-20T15:59:34.727

```
on success: function (response) { alert(response.d); } 
```

# algorithm - 网格内的连接点

> ID：400209
> 
> 赞同：1
> 
> 时间：2008-12-30T13:06:31.223
> 
> 标签：algorithm, geometry

给定网格内的一组随机点，如何**有效地**检查它们是否都位于其他点的固定范围内。即：选择任何一个随机点，然后您可以导航到网格中的任何其他点。

进一步澄清：如果您有一个 1000 x 1000 的网格并在其中随机放置 100 个点，您如何证明任何一个点都在邻居的 100 个单位内，并且所有点都可以通过从一个点走到另一个点来访问？

我一直在编写一些代码并提出了一个有趣的问题：非常偶尔（到目前为止只有一次）它会创建一个超出其余点最大范围的点岛。我需要解决这个问题，但蛮力似乎不是答案。

它是用 Java 编写的，但我擅长使用伪代码或 C++。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T14:03:06.540

我喜欢@joel.neely 的[构造方法](https://stackoverflow.com/questions/400209/connected-points-with-in-a-grid#400277)，但如果你想确保更均匀的密度，这更有​​可能起作用（尽管它可能会产生更多的集群而不是整体均匀的密度）：

1.  通过从有效网格内的均匀分布中选择 x,y 来随机放置一个初始点 P_0
2.  对于 i = 1:N-1
    1.  选择随机 j = 从 0 到 i-1 均匀分布，识别`P_j`之前放置的点
    2.  `P_i`选择distance( `P_i`, ) < 100 的随机点`P_j`，方法是重复以下步骤，直到在`P_i`下面的子步骤 4 中选择了一个有效点：
        1.  选择 (dx,dy) 每个从 -100 到 +100 均匀分布
        2.  如果 dx^2+dy^2 > 100^2，距离太大（21.5%的时间失败），返回上一步。
        3.  计算候选坐标( `P_i`) = coords( `P_j`) + (dx,dy)。
        4.  `P_i`如果它在整个有效网格内，则它是有效的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T23:38:40.327

如果我正确理解您的问题，给定一组站点，您想测试每个站点的最近邻居（对于 L1 距离，即网格距离）的距离是否小于 K 值。

这很容易通过计算点集的 Delaunay 三角剖分获得欧几里得距离：站点的最近邻居是其在 Delaunay 三角剖分中的邻居之一。有趣的是，L1 距离大于欧几里得距离（在一个因子 sqrt(2) 内）。

因此，测试您的状况的方法如下：

1.  计算站点的 Delaunay 三角剖分
2.  对于每个站点 s，在三角剖分中从 s 开始广度优先搜索，以便您发现到 s 的欧几里得距离小于 K 的所有顶点（Delaunay 三角剖分具有距离小于 K 的顶点集的性质）给定站点在三角剖分中连接）
3.  对于每个站点 s，在距离 s 小于 K 的这些顶点中，检查它们中的任何一个是否在距离 s 小于 K 的 L1 距离处。如果不是，则该属性不满意。

该算法可以通过以下几种方式进行改进：

1.  一旦发现 L1 距离小于 K 的站点，当然应该停止第 2 步的广度优先搜索。
2.  在寻找 s 的有效邻居期间，如果发现站点 s' 与 s 的 L1 距离小于 K，则无需为 s' 寻找有效邻居：s 显然是其中之一。
3.  不需要完整的广度优先搜索：在访问了所有与 s 相关的三角形后，如果三角剖分中 s 的邻居都不是有效邻居（即 L1 距离小于 K 的站点），则表示为 (v [1] , ...,v [n] ) 邻居。最多有四个与水平轴和垂直轴相交的边（ [vi]，vi [+1 ）。]只能通过这四个（或更少）边继续搜索。[这来自于 L1 球体的形状]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T14:37:15.847

就评估现有的点集而言，这看起来像是一种[欧几里得最小生成树](http://en.wikipedia.org/wiki/Euclidean_minimum_spanning_tree)问题。维基百科页面指出这是[Delaunay 三角剖分](http://en.wikipedia.org/wiki/Delaunay_triangulation)的子图；所以我认为计算 Delaunay 三角剖分就足够了（参见上一页参考资料或谷歌“计算几何”），然后计算最小生成树并验证所有边的长度是否小于 100。

从阅读参考资料看来，这是 O(N log N)，也许有更快的方法，但这已经足够了。

一个更简单（但可能效率较低）的算法如下所示：

1.  给定：这些点位于从索引 0 到 N-1 的数组中。
2.  以 x 坐标顺序对点进行排序，即 O(N log N) 以进行有效排序。
3.  初始化 i = 0。
4.  增量 i。如果 i == N，则**停止成功。**（所有点都可以从另一个半径 R 到达）
5.  初始化 j = i。
6.  递减 j。
7.  如果`j<0`或`P[i].x - P[j].x > R`，**则以失败告终。**（存在间隙，半径为 R 的所有点无法相互到达）
8.  否则，如果 P[i].x 和 P[j].x 在彼此的 R 范围内，我们就会到达这里。检查点 P[j] 是否足够接近 P[i]：如果`(P[i].x-P[j].x)^2 + (P[i].y-P[j].y)^2 <`R^2`，则点 P[i] 可以通过半径 R 内的先前点之一到达，然后返回步骤 4。
9.  继续尝试：返回第 6 步。

编辑：这可以修改为*应该*是 O(N log N) 但我不确定：

1.  给定：这些点位于从索引 0 到 N-1 的数组中。
2.  以 x 坐标顺序对点进行排序，即 O(N log N) 以进行有效排序。
3.  维护一个按 y 坐标顺序排列的点集 YLIST，将 YLIST 初始化为集合 {P[0]}。我们将从左到右扫描 x 坐标，将点一个接一个地添加到 YLIST 并删除 x 坐标离新添加的点太远的点。
4.  初始化 i = 0，j = 0。
5.  在这一点上，循环不变式始终为真：k <= i 的所有点 P[k] 形成一个网络，它们可以通过半径 R 从彼此到达。YLIST 中的所有点都有位于 P[i] 之间的 x 坐标。 xR 和 P[i].x
6.  增量 i。如果 i == N，则**停止成功**。
7.  如果 P[i].xP[j].x <= R，则转到第 10 步。（如果 i == j，则自动为真）
8.  点 P[j] 无法从半径为 R 的点 P[i] 到达。从 YLIST 中移除 P[j]（这是 O(log N)）。
9.  增加 j，进行第 6 步。
10.  此时，`j<i`P[i].xR 和 P[i].x 之间的所有点 P[j] 和 x 坐标都在集合 YLIST 中。
11.  将 P[i] 添加到 YLIST（这是 O(log N)），并记住 YLIST 中的索引 k，其中 YLIST[k]==P[i]。
12.  点 YLIST[k-1] 和 YLIST[k+1]（如果它们存在；P[i] 可能是 YLIST 中的唯一元素，也可能位于极端）是 YLIST 中离 P[i] 最接近的点.
13.  如果点 YLIST[k-1] 存在并且在 P[i] 的半径 R 内，则 P[i] 可以从至少一个先前点以半径 R 到达。转到第 5 步。
14.  如果点 YLIST[k+1] 存在并且在 P[i] 的半径 R 内，则 P[i] 可以从至少一个先前点以半径 R 到达。转到第 5 步。
15.  P[i] 不能从前面的任何点到达。**以失败告终。**

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T13:56:29.660

**新的和改进的** ;-)

感谢 Guillaume 和 Jason S 的评论让我思考更多。这产生了第二个提案，其统计数据显示出显着改善。

Guillaume 说我之前发布的策略会失去均匀的密度。当然，他是对的，因为它本质上是一种倾向于绕原点运行的“醉汉行走”。然而，点的均匀随机放置产生了不符合“路径”要求的显着概率（所有点都可以通过不大于 100 步长的路径连接）。测试这种情况很昂贵；生成纯随机解决方案直到通过一次更是如此。

Jason S 提供了一个变体，但对大量模拟的统计测试使我得出结论，他的变体产生的模式与我的第一个提案中的模式一样聚集（基于检查坐标值的平均值和标准偏差）。

下面修改后的算法产生的点集的统计数据与纯（均匀）随机放置的统计数据非常相似，但通过构造保证满足路径要求。不幸的是，形象化比口头解释要容易一些。实际上，它要求点在一个模糊一致的方向（NE、SE、SW、NW）上随机交错，只有在“从墙上反弹”时才会改变方向。

这是高级概述：

1.  随机选择一个初始点，将水平行程设置为 RIGHT，垂直行程设置为 DOWN。

2.  对剩余的点数重复（例如原始规范中的 99）：

    2.1。随机选择距离在 50 到 100 之间的 dx 和 dy。（我假设欧几里得距离——平方和的平方根——在我的试验实现中，但“出租车”距离——绝对值之和——会更容易编码。）

    2.2\. 根据水平和垂直行程（右/下 -> 加，左/上 -> 减）将 dx 和 dy 应用于前一点。

    2.3\. 如果任一坐标超出范围（小于 0 或至少 1000），则在违反的边界周围反射该坐标，并将其行进替换为相反方向。这意味着四种情况（2 个坐标 x 2 个边界）：

    ```
    2.3.1\. if x < 0, then x = -x and reverse LEFT/RIGHT horizontal travel.
    2.3.2\. if 1000 <= x, then x = 1999 - x and reverse LEFT/RIGHT horizontal travel.
    2.3.3\. if y < 0, then y = -y and reverse UP/DOWN vertical travel.
    2.3.4\. if 1000 <= y, then y = 1999 - y and reverse UP/DOWN vertical travel. 
    ```

请注意，步骤 2.3 下的反射保证将新点留在前一点的 100 个单位内，因此保留了路径要求。然而，水平和垂直旅行的限制迫使点的生成随机地“扫过”整个空间，比原来的纯“酒鬼走路”算法产生更多的总分散。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T13:12:30.387

快速思考一下：如果您将网格划分为 50x50 的补丁，当您放置初始点时，您还会记录它们属于哪个补丁。现在，当您想检查一个新点是否在其他点的 100 像素内时，您可以简单地检查补丁加上它周围的 8 点，看看点数是否匹配。

例如，你知道你有 100 个随机点，每个补丁包含它们包含的点数，你可以简单地总结一下，看看它是否确实是 100——这意味着所有点都可以到达。

我敢肯定还有其他方法，很难。

编辑：从左上点到 50x50 补丁右下角的距离是 sqrt(50^2 + 50^2) = 70 点，所以你可能不得不选择更小的补丁大小。也许 35 或 36 会做 (50^2 = sqrt(x^2 + x^2) => x=35.355...)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T13:41:22.450

找到点集的[凸包](http://en.wikipedia.org/wiki/Convex_hull)，然后使用[旋转卡尺](http://en.wikipedia.org/wiki/Rotating_calipers)法。凸包上最远的两个点是集合中最远的两个点。由于所有其他点都包含在凸包中，因此可以保证它们比两个极值点更近。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T13:44:49.307

通过构造强制所需条件。不要仅通过绘制随机数来放置所有点，而是按如下方式约束坐标：

1.  随机放置一个初始点。

2.  对剩余的点数重复（例如 99）：

    2.1。在前一点的某个范围（例如 90）内随机选择一个 x 坐标。

    2.2\. 计算 y 坐标的合法范围，使其在前一点的 100 个单位内。

    2.3\. 在该范围内随机选择一个 y 坐标。

3.  如果您想完全模糊原点，请按坐标对对点进行排序。

与纯随机性相比，这不需要太多开销，但会保证每个点与至少一个其他点的距离在 100 个单位以内（实际上，除了第一个和最后一个点，每个点都在其他*两个*点的 100 个单位以内）。

作为上述的变体，在步骤 2 中，随机选择*任何*已经生成的点并将其用作参考，而不是之前的点。

# javascript - 如何在 JavaScript 中复制到剪贴板？

> ID：400212
> 
> 赞同：4040
> 
> 时间：2008-12-30T13:09:05.777
> 
> 标签：javascript, clipboard, copy-paste

将文本复制到剪贴板（多浏览器）的最佳方法是什么？

我试过了：

```
function copyToClipboard(text) {
    if (window.clipboardData) { // Internet Explorer
        window.clipboardData.setData("Text", text);
    } else {
        unsafeWindow.netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
        const clipboardHelper = Components.classes["@mozilla.org/widget/clipboardhelper;1"].getService(Components.interfaces.nsIClipboardHelper);
        clipboardHelper.copyString(text);
    }
} 
```

但在 Internet Explorer 中，它给出了语法错误。在 Firefox 中，它说*unsafeWindow is not defined*。

一个不使用[Flash](https://en.wikipedia.org/wiki/Adobe_Flash)的好技巧：*[Trello 如何访问用户的剪贴板？](https://stackoverflow.com/questions/17527870/how-does-trello-access-the-users-clipboard)*

* * *

## 回答 #1

> 赞同：3006
> 
> 时间：2015-06-12T18:56:18.323

# 概述

有三个主要的浏览器 API 用于复制到剪贴板：

1.  [异步剪贴板 API](https://www.w3.org/TR/clipboard-apis/#async-clipboard-api) `[navigator.clipboard.writeText]`

    *   [Chrome 66](https://developers.google.com/web/updates/2018/03/clipboardapi)中提供以文本为中心的部分（2018 年 3 月）
    *   访问是异步的并使用[JavaScript Promises](https://developers.google.com/web/fundamentals/primers/promises)，可以编写为安全用户提示（如果显示）不会中断页面​​中的 JavaScript。
    *   文本可以直接从变量复制到剪贴板。
    *   仅在通过 HTTPS 提供的页面上受支持。
    *   在 Chrome 66 页面中，非活动标签可以在没有权限提示的情况下写入剪贴板。
2.  `document.execCommand('copy')`（***[已弃用](https://developer.mozilla.org/docs/Web/API/Document/execCommand#browser_compatibility)***）

    *   自 2015 年 4 月起，大多数浏览器都支持此功能（请参阅下面的浏览器支持）。
    *   访问是同步的，即停止页面中的 JavaScript 直到完成，包括显示和用户与任何安全提示进行交互。
    *   文本从 DOM 中读取并放置在剪贴板上。
    *   在测试期间 ~ 2015 年 4 月，只有 Internet Explorer 被记录为在写入剪贴板时显示权限提示。
3.  覆盖复制事件

    *   [请参阅有关覆盖复制事件的](https://w3c.github.io/clipboard-apis/#override-copy)剪贴板 API 文档。
    *   允许您从任何复制事件修改剪贴板上显示的内容，可以包括纯文本以外的其他格式的数据。
    *   这里没有涉及，因为它没有直接回答这个问题。

# 一般开发说明

当您在控制台中测试代码时，不要期望剪贴板相关命令能够正常工作。通常，页面需要处于活动状态（异步剪贴板 API）或需要用户交互（例如用户单击）以允许 ( `document.execCommand('copy')`) 访问剪贴板，详情请参见下文。

## **重要**（此处注明 2020/02/20）

请注意，由于这篇文章最初是写[在跨域](https://sites.google.com/a/chromium.org/dev/Home/chromium-security/deprecating-permissions-in-cross-origin-iframes)IFRAME和其他[IFRAME “沙盒”](https://blog.chromium.org/2010/05/security-in-depth-html5s-sandbox.html)中的权限的弃用，因此会阻止嵌入式演示“运行代码片段”按钮和“codepen.io 示例”在某些浏览器中工作（包括 Chrome 和 Microsoft Edge ）。

要开发创建您自己的网页，请通过 HTTPS 连接提供该页面以进行测试和开发。

这是一个演示代码工作的测试/演示页面： [https ://deanmarktaylor.github.io/clipboard-test/](https://deanmarktaylor.github.io/clipboard-test/)

# 异步+后备

由于浏览器对新 Async Clipboard API 的支持级别，您可能希望回退到该`document.execCommand('copy')`方法以获得良好的浏览器覆盖率。

这是一个简单的示例（可能无法嵌入此站点，请阅读上面的“重要”说明）：

```
function fallbackCopyTextToClipboard(text) {
  var textArea = document.createElement("textarea");
  textArea.value = text;

  // Avoid scrolling to bottom
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    console.log('Fallback: Copying text command was ' + msg);
  } catch (err) {
    console.error('Fallback: Oops, unable to copy', err);
  }

  document.body.removeChild(textArea);
}
function copyTextToClipboard(text) {
  if (!navigator.clipboard) {
    fallbackCopyTextToClipboard(text);
    return;
  }
  navigator.clipboard.writeText(text).then(function() {
    console.log('Async: Copying to clipboard was successful!');
  }, function(err) {
    console.error('Async: Could not copy text: ', err);
  });
}

var copyBobBtn = document.querySelector('.js-copy-bob-btn'),
  copyJaneBtn = document.querySelector('.js-copy-jane-btn');

copyBobBtn.addEventListener('click', function(event) {
  copyTextToClipboard('Bob');
});

copyJaneBtn.addEventListener('click', function(event) {
  copyTextToClipboard('Jane');
});
```

```
<div style="display:inline-block; vertical-align:top;">
  <button class="js-copy-bob-btn">Set clipboard to BOB</button><br /><br />
  <button class="js-copy-jane-btn">Set clipboard to JANE</button>
</div>
<div style="display:inline-block;">
  <textarea class="js-test-textarea" cols="35" rows="4">Try pasting into here to see what you have on your clipboard:

  </textarea>
</div>
```

（codepen.io 示例可能不起作用，请阅读上面的“重要”注释）请注意，此代码段在 Stack Overflow 的嵌入式预览中效果不佳，您可以在此处尝试：[https ://codepen.io/DeanMarkTaylor/pen/RMRaJX?editors =1011](https://codepen.io/DeanMarkTaylor/pen/RMRaJX?editors=1011)

# 异步剪贴板 API

*   [MDN 参考](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API)
*   [Chrome 66 公告帖（2018 年 3 月）](https://developers.google.com/web/updates/2018/03/clipboardapi)
*   参考[Async Clipboard API](https://www.w3.org/TR/clipboard-apis/#async-clipboard-api)草稿文档

请注意，通过 Chrome 66 中的权限 API，可以“请求权限”并测试对剪贴板的访问权限。

```
var text = "Example text to appear on clipboard";
navigator.clipboard.writeText(text).then(function() {
  console.log('Async: Copying to clipboard was successful!');
}, function(err) {
  console.error('Async: Could not copy text: ', err);
}); 
```

# document.execCommand('复制')

本文的其余部分将介绍`document.execCommand('copy')`API 的细微差别和细节。

## 浏览器支持

~~JavaScript[`document.execCommand('copy')`](https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand)支持已增加，请参阅以下链接了解浏览器更新：~~ （***[已弃用](https://developer.mozilla.org/docs/Web/API/Document/execCommand#browser_compatibility)***）

*   Internet Explorer 10+（尽管[本文档](https://msdn.microsoft.com/en-us/library/ms537834(v=vs.85).aspx)表明 Internet Explorer 5.5+ 提供了一些支持）。
*   [Google Chrome 43+（~2015 年 4 月）](https://developers.google.com/web/updates/2015/04/cut-and-copy-commands?hl=en)
*   [Mozilla Firefox 41+（2015 年 9 月发货）](https://developer.mozilla.org/en-US/Firefox/Releases/41#Interfaces.2FAPIs.2FDOM)
*   [Opera 29+（基于 Chromium 42，~2015 年 4 月）](https://dev.opera.com/blog/opera-29/#cut-and-copy-commands)

## 简单示例

（可能无法嵌入本网站，请阅读上面的“重要”说明）

```
var copyTextareaBtn = document.querySelector('.js-textareacopybtn');

copyTextareaBtn.addEventListener('click', function(event) {
  var copyTextarea = document.querySelector('.js-copytextarea');
  copyTextarea.focus();
  copyTextarea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    console.log('Copying text command was ' + msg);
  } catch (err) {
    console.log('Oops, unable to copy');
  }
});
```

```
<p>
  <button class="js-textareacopybtn" style="vertical-align:top;">Copy Textarea</button>
  <textarea class="js-copytextarea">Hello I'm some text</textarea>
</p>
```

## 复杂示例：复制到剪贴板而不显示输入

`textarea`如果屏幕上有一个或`input`元素可见，上面的简单示例效果很好。

在某些情况下，您可能希望将文本复制到剪贴板而不显示`input`/`textarea`元素。这是解决此问题的方法的一个示例（基本上是插入元素，复制到剪贴板，删除元素）：

使用 Google Chrome 44、Firefox 42.0a1 和 Internet Explorer 11.0.8600.17814 进行测试。

（可能无法嵌入本网站，请阅读上面的“重要”说明）

```
function copyTextToClipboard(text) {
  var textArea = document.createElement("textarea");

  //
  // *** This styling is an extra step which is likely not required. ***
  //
  // Why is it here? To ensure:
  // 1\. the element is able to have focus and selection.
  // 2\. if the element was to flash render it has minimal visual impact.
  // 3\. less flakyness with selection and copying which **might** occur if
  //    the textarea element is not visible.
  //
  // The likelihood is the element won't even render, not even a
  // flash, so some of these are just precautions. However in
  // Internet Explorer the element is visible whilst the popup
  // box asking the user for permission for the web page to
  // copy to the clipboard.
  //

  // Place in the top-left corner of screen regardless of scroll position.
  textArea.style.position = 'fixed';
  textArea.style.top = 0;
  textArea.style.left = 0;

  // Ensure it has a small width and height. Setting to 1px / 1em
  // doesn't work as this gives a negative w/h on some browsers.
  textArea.style.width = '2em';
  textArea.style.height = '2em';

  // We don't need padding, reducing the size if it does flash render.
  textArea.style.padding = 0;

  // Clean up any borders.
  textArea.style.border = 'none';
  textArea.style.outline = 'none';
  textArea.style.boxShadow = 'none';

  // Avoid flash of the white box if rendered for any reason.
  textArea.style.background = 'transparent';

  textArea.value = text;

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    console.log('Copying text command was ' + msg);
  } catch (err) {
    console.log('Oops, unable to copy');
  }

  document.body.removeChild(textArea);
}

var copyBobBtn = document.querySelector('.js-copy-bob-btn'),
  copyJaneBtn = document.querySelector('.js-copy-jane-btn');

copyBobBtn.addEventListener('click', function(event) {
  copyTextToClipboard('Bob');
});

copyJaneBtn.addEventListener('click', function(event) {
  copyTextToClipboard('Jane');
});
```

```
<div style="display:inline-block; vertical-align:top;">
  <button class="js-copy-bob-btn">Set clipboard to BOB</button><br /><br />
  <button class="js-copy-jane-btn">Set clipboard to JANE</button>
</div>
<div style="display:inline-block;">
  <textarea class="js-test-textarea" cols="35" rows="4">Try pasting into here to see what you have on your clipboard:

  </textarea>
</div>
```

## 补充笔记

### 仅当用户采取行动时才有效

所有`document.execCommand('copy')`调用都必须是用户操作的直接结果，例如单击事件处理程序。这是一种防止在用户不期望的情况下弄乱用户剪贴板的措施。

有关详细信息，请参阅[此处的 Google Developers 帖子](https://developers.google.com/web/updates/2015/04/cut-and-copy-commands?hl=en)。

### 剪贴板 API

注意完整的剪贴板 API 草案规范可以在这里找到： [https ://w3c.github.io/clipboard-apis/](https://w3c.github.io/clipboard-apis/)

### 是否支持？

*   `document.queryCommandSupported('copy')``true`如果命令“浏览器支持”，则应返回。
*   如果现在调用将成功，则`document.queryCommandEnabled('copy')`返回。检查以确保从用户启动的线程调用命令并满足其他要求。`true``document.execCommand('copy')`

但是，作为浏览器兼容性问题的一个示例，Google Chrome 从 2015 年 4 月到 2015 年 10 月仅在`true`从`document.queryCommandSupported('copy')`用户启动的线程调用命令时才返回。

请注意下面的兼容性详细信息。

### 浏览器兼容性详情

虽然由于用户单击而对`document.execCommand('copy')`包装在`try`/`catch`块中的简单调用将为您提供最大的兼容性，但使用以下有一些附带条件：

对或`document.execCommand`的任何调用都应包含在/块中。`document.queryCommandSupported``document.queryCommandEnabled``try``catch`

不同的浏览器实现和浏览器版本在调用而不是返回时会抛出不同类型的异常`false`。

不同的浏览器实现仍在不断变化，[剪贴板 API](https://w3c.github.io/clipboard-apis/)仍在草稿中，因此请记住进行测试。

* * *

## 回答 #2

> 赞同：1335
> 
> 时间：2011-05-19T08:06:06.560

自动复制到剪贴板可能很危险，因此大多数浏览器（Internet Explorer 除外）都使其变得非常困难。就个人而言，我使用以下简单技巧：

```
function copyToClipboard(text) {
  window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
} 
```

向用户呈现提示框，其中已选择要复制的文本。现在按下`Ctrl`+`C`和`Enter`（关闭框）就足够了——瞧！

现在剪贴板复制操作是*安全*的，因为用户手动进行（但以一种非常简单的方式）。当然，它适用于所有浏览器。

```
<button id="demo" onclick="copyToClipboard(document.getElementById('demo').innerHTML)">This is what I want to copy</button>

<script>
  function copyToClipboard(text) {
    window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
  }
</script>
```

* * *

## 回答 #3

> 赞同：459
> 
> 时间：2015-11-26T00:03:49.120

以下方法适用于 Chrome、Firefox、Internet Explorer 和 Edge，以及最新版本的 Safari（2016 年 10 月发布的版本 10 中添加了复制支持）。

*   创建一个 textarea 并将其内容设置为要复制到剪贴板的文本。
*   将文本区域附加到 DOM。
*   选择文本区域中的文本。
*   调用 document.execCommand("copy")
*   从 dom 中删除 textarea。

注意：您不会看到 textarea，因为它是在 Javascript 代码的同一个同步调用中添加和删除的。

如果您自己实现此功能，请注意以下几点：

*   出于安全原因，这只能从诸如 click 之类的事件处理程序中调用（就像打开窗口一样）。
*   Internet Explorer 将在第一次更新剪贴板时显示权限对话框。
*   Internet Explorer 和 Edge 将在 textarea 获得焦点时滚动。
*   execCommand() 在某些情况下可能会抛出。
*   除非您使用 textarea，否则换行符和制表符可能会被吞下。（大多数文章似乎都建议使用 div）
*   当 Internet Explorer 对话框显示时，textarea 将可见，您要么需要隐藏它，要么使用 Internet Explorer 特定的 clipboardData API。
*   在 Internet Explorer 中，系统管理员可以禁用剪贴板 API。

下面的函数应该尽可能干净地处理以下所有问题。如果您发现任何问题或有任何改进建议，请发表评论。

```
// Copies a string to the clipboard. Must be called from within an
// event handler such as click. May return false if it failed, but
// this is not always possible. Browser support for Chrome 43+,
// Firefox 42+, Safari 10+, Edge and Internet Explorer 10+.
// Internet Explorer: The clipboard feature may be disabled by
// an administrator. By default a prompt is shown the first
// time the clipboard is used (per session).
function copyToClipboard(text) {
    if (window.clipboardData && window.clipboardData.setData) {
        // Internet Explorer-specific code path to prevent textarea being shown while dialog is visible.
        return window.clipboardData.setData("Text", text);

    }
    else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
        var textarea = document.createElement("textarea");
        textarea.textContent = text;
        textarea.style.position = "fixed";  // Prevent scrolling to bottom of page in Microsoft Edge.
        document.body.appendChild(textarea);
        textarea.select();
        try {
            return document.execCommand("copy");  // Security exception may be thrown by some browsers.
        }
        catch (ex) {
            console.warn("Copy to clipboard failed.", ex);
            return prompt("Copy to clipboard: Ctrl+C, Enter", text);
        }
        finally {
            document.body.removeChild(textarea);
        }
    }
} 
```

[https://jsfiddle.net/fx6a6n6x/](https://jsfiddle.net/fx6a6n6x/)

* * *

## 回答 #4

> 赞同：156
> 
> 时间：2017-09-14T09:20:33.823

这是我对那个的看法...

```
function copy(text) {
    var input = document.createElement('input');
    input.setAttribute('value', text);
    document.body.appendChild(input);
    input.select();
    var result = document.execCommand('copy');
    document.body.removeChild(input);
    return result;
 } 
```

@korayem：请注意，使用 html`input`字段不会尊重换行符`\n`，并且会将任何文本展平为一行。

正如@nikksan 在评论中提到的，使用`textarea`将解决以下问题：

```
function copy(text) {
    var input = document.createElement('textarea');
    input.innerHTML = text;
    document.body.appendChild(input);
    input.select();
    var result = document.execCommand('copy');
    document.body.removeChild(input);
    return result;
} 
```

* * *

## 回答 #5

> 赞同：93
> 
> 时间：2008-12-30T13:33:45.303

从网页读取和修改剪贴板会引发安全和隐私问题。但是，在 Internet Explorer 中，可以这样做。我找到了这个[示例片段](http://www.sajithmr.com/onclick-select-all-and-copy-to-clipboard-javascript/)：

```
 <script type="text/javascript">
        function select_all(obj) {
            var text_val=eval(obj);
            text_val.focus();
            text_val.select();
            r = text_val.createTextRange();
            if (!r.execCommand) return; // feature detection
            r.execCommand('copy');
        }
    </script>
    <input value="http://www.sajithmr.com"
     onclick="select_all(this)" name="url" type="text" />
```

* * *

## 回答 #6

> 赞同：88
> 
> 时间：2010-10-17T14:40:35.000

如果您想要一个非常简单的解决方案（集成时间不到 5 分钟）并且开箱即用看起来不错，那么[Clippy](http://github.com/mojombo/clippy)是一些更复杂解决方案的不错替代品。

它是由 GitHub 的联合创始人编写的。下面的示例 Flash 嵌入代码：

```
<object
    classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"
    width="110"
    height="14"
    id="clippy">

    <param name="movie" value="/flash/clippy.swf"/>
    <param name="allowScriptAccess" value="always"/>
    <param name="quality" value="high"/>
    <param name="scale" value="noscale"/>
    <param NAME="FlashVars" value="text=#{text}"/>
    <param name="bgcolor" value="#{bgcolor}"/>
    <embed
        src="/flash/clippy.swf"
        width="110"
        height="14"
        name="clippy"
        quality="high"
        allowScriptAccess="always"
        type="application/x-shockwave-flash"
        pluginspage="http://www.macromedia.com/go/getflashplayer"
        FlashVars="text=#{text}"
        bgcolor="#{bgcolor}"/>
</object> 
```

请记住`#{text}`用您需要复制的文本和`#{bgcolor}`颜色替换。

* * *

## 回答 #7

> 赞同：77
> 
> 时间：2014-12-03T20:31:06.940

我最近写了一篇关于这个问题的[技术博客文章](https://www.lucidchart.com/techblog/2014/12/02/definitive-guide-copying-pasting-javascript/)（我在 Lucidchart 工作，我们最近对剪贴板进行了大修）。

将纯文本复制到剪贴板相对简单，假设您尝试在系统复制事件期间执行此操作（用户按下`Ctrl`+`C`或使用浏览器的菜单）。

```
var isIe = (navigator.userAgent.toLowerCase().indexOf("msie")    != -1 ||
            navigator.userAgent.toLowerCase().indexOf("trident") != -1);

document.addEventListener('copy', function(e) {
    var textToPutOnClipboard = "This is some text";
    if (isIe) {
        window.clipboardData.setData('Text', textToPutOnClipboard);
    } else {
        e.clipboardData.setData('text/plain', textToPutOnClipboard);
    }
    e.preventDefault();
}); 
```

不在系统复制事件期间将文本放在剪贴板上要困难得多。看起来这些其他答案中的一些参考了通过 Flash 进行操作的方法，这是唯一的跨浏览器方法（据我所知）。

除此之外，还有一些基于浏览器的选项。

这是 Internet Explorer 中最简单的方法，您可以随时通过 JavaScript 访问 clipboardData 对象：

```
window.clipboardData 
```

（但是，当您尝试在系统剪切、复制或粘贴事件之外执行此操作时，Internet Explorer 将提示用户授予 Web 应用程序剪贴板权限。）

在 Chrome 中，您可以创建一个 Chrome 扩展程序，该扩展程序将为您提供[剪贴板权限](https://developer.chrome.com/extensions/declare_permissions)（这是我们为 Lucidchart 所做的）。然后对于安装了您的扩展程序的用户，您只需要自己触发系统事件：

```
document.execCommand('copy'); 
```

看起来 Firefox 有[一些选项](http://kb.mozillazine.org/Granting_JavaScript_access_to_the_clipboard)允许用户授予某些网站访问剪贴板的权限，但我个人没有尝试过这些。

* * *

## 回答 #8

> 赞同：73
> 
> 时间：2013-04-23T22:32:03.287

我喜欢这一个：

```
<input onclick="this.select();" type='text' value='copy me' /> 
```

如果用户不知道如何在他们的操作系统中复制文本，那么他们很可能也不知道如何粘贴。因此，只需自动选择它，其余的留给用户。

* * *

## 回答 #9

> 赞同：58
> 
> 时间：2015-08-11T15:33:37.223

[clipboard.js](https://www.npmjs.com/package/clipboard-js)是一个小型的非 Flash 实用程序，它允许将文本或 HTML 数据复制到剪贴板。它非常易于使用，只需包含 .js 并使用如下内容：

```
<button id='markup-copy'>Copy Button</button>

<script>
document.getElementById('markup-copy').addEventListener('click', function() {
  clipboard.copy({
    'text/plain': 'Markup text. Paste me into a rich text editor.',
    'text/html': '<i>here</i> is some <b>rich text</b>'
  }).then(
    function(){console.log('success'); },
    function(err){console.log('failure', err);
  });

});
</script> 
```

clipboard.js 也在[GitHub 上](https://github.com/lgarron/clipboard.js)。

> **注意：**现在已弃用。迁移到[这里](https://github.com/lgarron/clipboard-polyfill)。

* * *

## 回答 #10

> 赞同：42
> 
> 时间：2018-08-06T13:42:39.387

在 2018 年，您可以这样做：

```
async copySomething(text?) {
  try {
    const toCopy = text || location.href;
    await navigator.clipboard.writeText(toCopy);
    console.log('Text or Page URL copied');
  }
  catch (err) {
    console.error('Failed to copy: ', err);
  }
} 
```

它在我的 Angular 6+ 代码中使用，如下所示：

```
<button mat-menu-item (click)="copySomething()">
    <span>Copy link</span>
</button> 
```

如果我传入一个字符串，它会复制它。如果没有，它会复制页面的 URL。

剪贴板的东西也可以做更多的体操。在此处查看更多信息：

*[取消阻止剪贴板访问](https://developers.google.com/web/updates/2018/03/clipboardapi)*

* * *

## 回答 #11

> 赞同：41
> 
> 时间：2018-07-01T18:52:46.070

我非常成功地使用了它（**没有**jQuery 或任何其他框架）。

```
function copyToClp(txt){
    var m = document;
    txt = m.createTextNode(txt);
    var w = window;
    var b = m.body;
    b.appendChild(txt);
    if (b.createTextRange) {
        var d = b.createTextRange();
        d.moveToElementText(txt);
        d.select();
        m.execCommand('copy');
    } 
    else {
        var d = m.createRange();
        var g = w.getSelection;
        d.selectNodeContents(txt);
        g().removeAllRanges();
        g().addRange(d);
        m.execCommand('copy');
        g().removeAllRanges();
    }
    txt.remove();
} 
```

*警告*

制表符被转换为空格（至少在 Chrome 中）。

* * *

## 回答 #12

> 赞同：35
> 
> 时间：2013-11-21T20:41:25.003

ZeroClipboard 是我发现的最好的跨浏览器解决方案：

```
<div id="copy" data-clipboard-text="Copy Me!">Click to copy</div>
<script src="ZeroClipboard.js"></script>
<script>
  var clip = new ZeroClipboard( document.getElementById('copy') );
</script> 
```

如果您需要对 iOS 的非 Flash 支持，您只需添加一个备用：

```
clip.on( 'noflash', function ( client, args ) {
    $("#copy").click(function(){
        var txt = $(this).attr('data-clipboard-text');
        prompt ("Copy link, then click OK.", txt);
    });
}); 
```

[http://zeroclipboard.org/](http://zeroclipboard.org/)

[https://github.com/zeroclipboard/ZeroClipboard](https://github.com/zeroclipboard/ZeroClipboard)

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2015-11-05T03:50:33.120

由于 Chrome 42+ 和 Firefox 41+ 现在支持**document.execCommand('copy')命令，因此我结合使用**[Tim Down 的旧答案](https://stackoverflow.com/a/8024509/4307527)和[Google Developer 的答案](https://developers.google.com/web/updates/2015/04/cut-and-copy-commands?hl=en)，创建了几个用于跨浏览器复制到剪贴板功能的函数：

```
function selectElementContents(el) {
    // Copy textarea, pre, div, etc.
    if (document.body.createTextRange) {
        // Internet Explorer
        var textRange = document.body.createTextRange();
        textRange.moveToElementText(el);
        textRange.select();
        textRange.execCommand("Copy");
    }
    else if (window.getSelection && document.createRange) {
        // Non-Internet Explorer
        var range = document.createRange();
        range.selectNodeContents(el);
        var sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
        try {
            var successful = document.execCommand('copy');
            var msg = successful ? 'successful' : 'unsuccessful';
            console.log('Copy command was ' + msg);
        }
        catch (err) {
            console.log('Oops, unable to copy');
        }
    }
} // end function selectElementContents(el)

function make_copy_button(el) {
    var copy_btn = document.createElement('input');
    copy_btn.type = "button";
    el.parentNode.insertBefore(copy_btn, el.nextSibling);
    copy_btn.onclick = function() {
        selectElementContents(el);
    };

    if (document.queryCommandSupported("copy") || parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]) >= 42) {
        // Copy works with Internet Explorer 4+, Chrome 42+, Firefox 41+, Opera 29+
        copy_btn.value = "Copy to Clipboard";
    }
    else {
        // Select only for Safari and older Chrome, Firefox and Opera
        copy_btn.value = "Select All (then press Ctrl + C to Copy)";
    }
}
/* Note: document.queryCommandSupported("copy") should return "true" on browsers that support copy,
    but there was a bug in Chrome versions 42 to 47 that makes it return "false".  So in those
    versions of Chrome feature detection does not work!
    See https://code.google.com/p/chromium/issues/detail?id=476508
*/

make_copy_button(document.getElementById("markup"));
```

```
<pre id="markup">
  Text that can be copied or selected with cross browser support.
</pre>
```

* * *

## 回答 #14

> 赞同：28
> 
> 时间：2020-06-01T08:48:01.380

```
 $("td").click(function (e) {
        var clickedCell = $(e.target).closest("td");
        navigator.clipboard.writeText(clickedCell.text());
        alert(clickedCell.text());
    });
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<table>
<tr>
<td>First<td>
</tr>
<tr>
<td>Second<td>
</tr>
<tr>
<td>Third<td>
</tr>
<tr>
<td>Fourth<td>
</tr>
</table>
```

我已经阅读了所有答案，截至 2020 年 6 月 1 日，当我终于找到文档时，我一直在努力解决这个问题：

```
$("td").click(function (e) {
    var clickedCell = $(e.target).closest("td");
    navigator.clipboard.writeText(clickedCell.text());
}); 
```

它将单击的单元格文本写入浏览器剪贴板。

您可以根据需要更改选择器“td”，您可以添加 console.log 以进行调试和/或警报功能。

这是文档： [https ://developer.mozilla.org/en-US/docs/Web/API/Clipboard/writeText](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/writeText)

* * *

## 回答 #15

> 赞同：27
> 
> 时间：2011-05-03T22:17:01.680

在我一直从事的一个项目中，一个利用[ZeroClipboard](https://github.com/patricklodder/jquery-zclip)库的 jQuery 复制到剪贴板插件。

如果你是一个重度 jQuery 用户，它比原生的 Zero Clipboard 插件更容易使用。

* * *

## 回答 #16

> 赞同：25
> 
> 时间：2012-07-05T15:33:32.850

我找到了以下解决方案：

on-key-down 处理程序创建一个“pre”标签。我们将要复制的内容设置到此标签，然后在此标签上进行选择并在处理程序中返回 true。这会调用 Chrome 的标准处理程序并复制选定的文本。

如果需要，您可以为恢复先前选择的功能设置超时。我在[MooTools](https://en.wikipedia.org/wiki/MooTools)上的实现：

```
function EnybyClipboard() {
    this.saveSelection = false;
    this.callback = false;
    this.pastedText = false;

    this.restoreSelection = function() {
        if (this.saveSelection) {
            window.getSelection().removeAllRanges();
            for (var i = 0; i < this.saveSelection.length; i++) {
                window.getSelection().addRange(this.saveSelection[i]);
            }
            this.saveSelection = false;
        }
    };

    this.copyText = function(text) {
        var div = $('special_copy');
        if (!div) {
            div = new Element('pre', {
                'id': 'special_copy',
                'style': 'opacity: 0;position: absolute;top: -10000px;right: 0;'
            });
            div.injectInside(document.body);
        }
        div.set('text', text);
        if (document.createRange) {
            var rng = document.createRange();
            rng.selectNodeContents(div);
            this.saveSelection = [];
            var selection = window.getSelection();
            for (var i = 0; i < selection.rangeCount; i++) {
                this.saveSelection[i] = selection.getRangeAt(i);
            }
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(rng);
            setTimeout(this.restoreSelection.bind(this), 100);
        } else return alert('Copy did not work. :(');
    };

    this.getPastedText = function() {
        if (!this.pastedText) alert('Nothing to paste. :(');
        return this.pastedText;
    };

    this.pasteText = function(callback) {
        var div = $('special_paste');
        if (!div) {
            div = new Element('textarea', {
                'id': 'special_paste',
                'style': 'opacity: 0;position: absolute;top: -10000px;right: 0;'
            });
            div.injectInside(document.body);
            div.addEvent('keyup', function() {
                if (this.callback) {
                    this.pastedText = $('special_paste').get('value');
                    this.callback.call(null, this.pastedText);
                    this.callback = false;
                    this.pastedText = false;
                    setTimeout(this.restoreSelection.bind(this), 100);
                }
            }.bind(this));
        }
        div.set('value', '');
        if (document.createRange) {
            var rng = document.createRange();
            rng.selectNodeContents(div);
            this.saveSelection = [];
            var selection = window.getSelection();
            for (var i = 0; i < selection.rangeCount; i++) {
                this.saveSelection[i] = selection.getRangeAt(i);
            }
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(rng);
            div.focus();
            this.callback = callback;
        } else return alert('Failed to paste. :(');
    };
} 
```

用法：

```
enyby_clip = new EnybyClipboard(); // Init

enyby_clip.copyText('some_text'); // Place this in the Ctrl+C handler and return true;

enyby_clip.pasteText(function callback(pasted_text) {
    alert(pasted_text);
}); // Place this in Ctrl+V handler and return true; 
```

在粘贴时，它会创建一个文本区域并以相同的方式工作。

PS：也许这个解决方案可以用来创建一个没有 Flash 的完整的跨浏览器解决方案。它适用于 Firefox 和 Chrome。

* * *

## 回答 #17

> 赞同：25
> 
> 时间：2017-07-25T15:51:33.473

我把我认为最好的一个放在一起。

*   使用 cssText 来避免 Internet Explorer 中的异常，而不是直接使用样式。
*   如果有选择，则恢复选择
*   设置为只读，这样键盘就不会出现在移动设备上
*   有一个适用于 iOS 的解决方法，因此它实际上可以正常工作，因为它通常会阻止 execCommand。

这里是：

```
const copyToClipboard = (function initClipboardText() {
  const textarea = document.createElement('textarea');

  // Move it off-screen.
  textarea.style.cssText = 'position: absolute; left: -99999em';

  // Set to readonly to prevent mobile devices opening a keyboard when
  // text is .select()'ed.
  textarea.setAttribute('readonly', true);

  document.body.appendChild(textarea);

  return function setClipboardText(text) {
    textarea.value = text;

    // Check if there is any content selected previously.
    const selected = document.getSelection().rangeCount > 0 ?
      document.getSelection().getRangeAt(0) : false;

    // iOS Safari blocks programmatic execCommand copying normally, without this hack.
    // https://stackoverflow.com/questions/34045777/copy-to-clipboard-using-javascript-in-ios
    if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {
      const editable = textarea.contentEditable;
      textarea.contentEditable = true;
      const range = document.createRange();
      range.selectNodeContents(textarea);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      textarea.setSelectionRange(0, 999999);
      textarea.contentEditable = editable;
    }
    else {
      textarea.select();
    }

    try {
      const result = document.execCommand('copy');

      // Restore previous selection.
      if (selected) {
        document.getSelection().removeAllRanges();
        document.getSelection().addRange(selected);
      }

      return result;
    }
    catch (err) {
      console.error(err);
      return false;
    }
  };
})(); 
```

用法：`copyToClipboard('some text')`

* * *

## 回答 #18

> 赞同：24
> 
> 时间：2008-12-30T14:33:38.287

其他方法会将纯文本复制到剪贴板。要复制 HTML（即，您可以将结果粘贴到所见即所得的编辑器中），您只能在 Internet Explorer 中执行以下*操作*。这与其他方法根本不同，因为浏览器实际上是在可见地选择内容。

```
// Create an editable DIV and append the HTML content you want copied
var editableDiv = document.createElement("div");
with (editableDiv) {
    contentEditable = true;
}
editableDiv.appendChild(someContentElement);

// Select the editable content and copy it to the clipboard
var r = document.body.createTextRange();
r.moveToElementText(editableDiv);
r.select();
r.execCommand("Copy");

// Deselect, so the browser doesn't leave the element visibly selected
r.moveToElementText(someHiddenDiv);
r.select(); 
```

* * *

## 回答 #19

> 赞同：17
> 
> 时间：2021-05-20T10:59:51.480

此代码在 2021 年 5 月测试。在 Chrome、IE、Edge 上工作。下面的“消息”参数是您要复制的字符串值。

```
<script type="text/javascript">
    function copyToClipboard(message) {
        var textArea = document.createElement("textarea");
        textArea.value = message;
        textArea.style.opacity = "0"; 
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            var successful = document.execCommand('copy');
            var msg = successful ? 'successful' : 'unsuccessful';
            alert('Copying text command was ' + msg);
        } catch (err) {
            alert('Unable to copy value , error : ' + err.message);
        }

        document.body.removeChild(textArea);
    }

</script> 
```

* * *

## 回答 #20

> 赞同：14
> 
> 时间：2010-03-17T20:12:39.990

从 Flash 10 开始，如果操作源自用户与 Flash 对象的交互，则只能复制到剪贴板。（[阅读 Adob​​e 的 Flash 10 公告中的相关部分](http://www.adobe.com/devnet/flashplayer/articles/fplayer10_security_changes_02.html#head31)。）

解决方案是在 Copy 按钮或启动复制的任何元素上方覆盖 Flash 对象。ZeroClipboard 是目前具有此实现的最佳库。经验丰富的 Flash 开发人员可能只想制作自己的库。

* * *

## 回答 #21

> 赞同：13
> 
> 时间：2016-12-12T16:22:02.410

已经有很多答案，但是想添加一个（jQuery）。适用于任何浏览器，也适用于移动浏览器（即，有关安全性的提示，但当您接受它时，它就可以正常工作）。

```
function appCopyToClipBoard(sText)
{
    var oText = false,
        bResult = false;
    try
    {
        oText = document.createElement("textarea");
        $(oText).addClass('clipboardCopier').val(sText).insertAfter('body').focus();
        oText.select();
        document.execCommand("Copy");
        bResult = true;
    }
    catch(e) {
    }

    $(oText).remove();
    return bResult;
} 
```

在您的代码中：

```
if (!appCopyToClipBoard('Hai there! This is copied to the clipboard.'))
{
    alert('Sorry, copy to clipboard failed.');
} 
```

* * *

## 回答 #22

> 赞同：13
> 
> 时间：2017-01-18T10:57:02.620

我找到了以下解决方案：

我在隐藏输入中有文本。因为`setSelectionRange`对隐藏输入不起作用，所以我暂时将类型更改为文本，复制文本，然后再次将其隐藏。如果要从元素复制文本，可以将其传递给函数并将其内容保存在目标变量中。

```
jQuery('#copy').on('click', function () {
    copyToClipboard();
});

function copyToClipboard() {
    var target = jQuery('#hidden_text');

    // Make it visible, so can be focused
    target.attr('type', 'text');
    target.focus();
    // Select all the text
    target[0].setSelectionRange(0, target.val().length);

    // Copy the selection
    var succeed;
    try {
        succeed = document.execCommand("copy");
    }
    catch (e) {
        succeed = false;
    }

    // Hide input again
    target.attr('type', 'hidden');

    return succeed;
} 
```

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2018-01-25T22:42:01.973

将文本从 HTML 输入复制到剪贴板：

```
 function myFunction() {
   /* Get the text field */
   var copyText = document.getElementById("myInput");

   /* Select the text field */
   copyText.select();

   /* Copy the text inside the text field */
   document.execCommand("Copy");

   /* Alert the copied text */
   alert("Copied the text: " + copyText.value);
 }
```

```
 <!-- The text field -->
 <input type="text" value="Hello Friend" id="myInput">

 <!-- The button used to copy the text -->
<button onclick="myFunction()">Copy text</button>
```

**注意：** *Internet Explorer 9 及更早版本不支持**该方法。`document.execCommand()`*

**来源**：[W3Schools -*将文本复制到剪贴板*](https://www.w3schools.com/howto/howto_js_copy_clipboard.asp)

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2021-12-19T18:10:03.897

复制文本字段内文本的最佳方法。使用**navigator.clipboard.writeText**。

```
<input type="text" value="Hello World" id="myId">
<button onclick="myFunction()" >Copy text</button>

<script>
function myFunction() {
  var copyText = document.getElementById("myId");
  copyText.select();
  copyText.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(copyText.value);
}

</script> 
```

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2008-12-30T13:38:51.957

在 Internet Explorer 以外的浏览器中，您需要使用一个小的 Flash 对象来操作剪贴板，例如

*   [自动复制到剪贴板](http://ajaxian.com/archives/auto-copy-to-clipboard)

* * *

## 回答 #26

> 赞同：10
> 
> 时间：2011-01-17T17:09:45.453

从（类似于 Excel）构建自定义网格编辑以及与 Excel 的兼容性时，我遇到了同样的问题。我必须支持选择多个单元格、复制和粘贴。

解决方案：创建一个文本区域，您将在其中插入数据供用户复制（对于我来说，当用户选择单元格时），将焦点设置在它上（例如，当用户按下时`Ctrl`）并选择整个文本。

因此，当用户点击`Ctrl`+时，`C`他/她会得到他/她选择的复制单元格。测试后，只需将 textarea 的大小调整为一个像素（我没有测试它是否可以在 display:none 上工作）。它适用于所有浏览器，并且对用户透明。

粘贴 - 你可以这样做（在你的目标上有所不同） - 继续关注 textarea 并使用 onpaste 捕获粘贴事件（在我的项目中，我在单元格中使用 textareas 进行编辑）。

我无法粘贴示例（商业项目），但您明白了。

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2015-07-09T14:24:25.117

这是其他答案之间的一些组合。

```
var copyToClipboard = function(textToCopy){
    $("body")
        .append($('<textarea name="fname" class="textToCopyInput"/>' )
        .val(textToCopy))
        .find(".textToCopyInput")
        .select();
      try {
        var successful = document.execCommand('copy');
        var msg = successful ? 'successful' : 'unsuccessful';
        alert('Text copied to clipboard!');
      } catch (err) {
          window.prompt("To copy the text to clipboard: Ctrl+C, Enter", textToCopy);
      }
     $(".textToCopyInput").remove();
} 
```

它使用 jQuery，但它当然不是必须的。如果你愿意，你可以改变它。我只是有 jQuery 供我使用。您还可以添加一些 CSS 以确保不显示输入。例如：

```
.textToCopyInput{opacity: 0; position: absolute;} 
```

或者当然你也可以做一些内联样式

```
.append($('<textarea name="fname" style="opacity: 0;  position: absolute;" class="textToCopyInput"/>' ) 
```

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2019-11-11T18:51:43.227

```
function copytoclipboard(element) {

    var $temp = $("<input>");
    $("body").append($temp);
    $temp.val('0' + element).select();
    document.execCommand("copy");
    $temp.remove();
} 
```

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2011-08-12T08:17:32.383

这是[Chase Seibert 答案](https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript/400403#400403)的扩展，其优点是它适用于 IMAGE 和 TABLE 元素，而不仅仅是 Internet Explorer 9 上的 DIV。

```
if (document.createRange) {
    // Internet Explorer 9 and modern browsers
    var r = document.createRange();
    r.setStartBefore(to_copy);
    r.setEndAfter(to_copy);
    r.selectNode(to_copy);
    var sel = window.getSelection();
    sel.addRange(r);
    document.execCommand('Copy');  // Does nothing on Firefox
} else {
    // Internet Explorer 8 and earlier. This stuff won't work
    // on Internet Explorer 9.
    // (unless forced into a backward compatibility mode,
    // or selecting plain divs, not img or table).
    var r = document.body.createTextRange();
    r.moveToElementText(to_copy);
    r.select()
    r.execCommand('Copy');
} 
```

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2015-10-28T11:17:06.240

我用过剪贴板.js。

我们可以在 npm 上获取它：

```
npm install clipboard --save 
```

还有在[鲍尔](https://bower.io/)

```
bower install clipboard --save 
```

```
new ClipboardJS("#btn1");

document.querySelector("#btn2").addEventListener("click", () => document.querySelector("#btn1").dataset.clipboardText = Math.random());
```

```
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>

<button id="btn1" data-clipboard-text="Text to copy goes here">
    Copy to clipboard
</button>
<button id="btn2">Click here to change data-clipboard-text</button>

<br /><br />

<input type="text" placeholder="Paste here to see clipboard" />
```

更多用法和示例位于[https://zenorocha.github.io/clipboard.js/](https://zenorocha.github.io/clipboard.js/)。

* * *

## 回答 #31

> 赞同：8
> 
> 时间：2017-10-19T02:33:37.960

要将选定的文本（“要复制的文本”）复制到剪贴板，请创建一个 Bookmarklet（执行 JavaScript 的浏览器书签）并执行它（单击它）。它将创建一个临时文本区域。

来自 GitHub 的代码：

[https://gist.github.com/stefanmaric/2abf96c740191cda3bc7a8b0fc905a7d](https://gist.github.com/stefanmaric/2abf96c740191cda3bc7a8b0fc905a7d)

```
(function (text) {
  var node = document.createElement('textarea');
  var selection = document.getSelection();

  node.textContent = text;
  document.body.appendChild(node);

  selection.removeAllRanges();
  node.select();
  document.execCommand('copy');

  selection.removeAllRanges();
  document.body.removeChild(node);
})('Text To Copy'); 
```

* * *

## 回答 #32

> 赞同：6
> 
> 时间：2011-08-16T19:22:47.043

似乎我误读了这个问题，但作为参考，您可以提取 DOM 的范围（而不是剪贴板；与所有现代浏览器兼容），并将其与 oncopy、onpaste 和 onbeforepaste 事件结合以获取剪贴板行为。这是实现此目的的代码：

```
function clipBoard(sCommand) {
  var oRange = contentDocument.createRange();
  oRange.setStart(startNode, startOffset);
  oRange.setEnd(endNode, endOffset);

  /* This is where the actual selection happens.
     in the above, startNode and endNode are
     DOM nodes defining the beginning and
     end of the "selection" respectively.

     startOffset and endOffset are constants
     that are defined as follows:

         END_TO_END: 2
         END_TO_START: 3
         NODE_AFTER: 1
         NODE_BEFORE: 0
         NODE_BEFORE_AND_AFTER: 2
         NODE_INSIDE: 3
         START_TO_END: 1
         START_TO_START: 0

     And it would be used like oRange.START_TO_END
  */

  switch(sCommand) {

    case "cut":
      this.oFragment = oRange.extractContents();
      oRange.collapse();
      break;

    case "copy":
      this.oFragment = oRange.cloneContents();
      break;

    case "paste":
      oRange.deleteContents();
      var cloneFragment = this.oFragment.cloneNode(true)
      oRange.insertNode(cloneFragment);
      oRange.collapse();
      break;
  }
} 
```

* * *

## 回答 #33

> 赞同：6
> 
> 时间：2013-09-13T21:56:09.130

我的错。这仅适用于 Internet Explorer。

这是另一种复制文本的方法：

```
<p>
    <a onclick="window.clipboardData.setData('text', document.getElementById('Test').innerText);">Copy</a>
</p> 
```

* * *

## 回答 #34

> 赞同：6
> 
> 时间：2022-01-29T13:45:39.867

JavaScript/TypeScript 中最好和最简单的方法使用这个命令

```
navigator.clipboard.writeText(textExample); 
```

**只需在textExample**中传递您想要复制到剪贴板的值

 *** * *

## 回答 #35

> 赞同：5
> 
> 时间：2008-12-30T13:26:42.183

据我所知，这只适用于 Internet Explorer。

另请参阅*[Dynamic Tools - JavaScript Copy To Clipboard](http://www.dynamic-tools.net/toolbox/copyToClipboard/)*，但它需要用户先更改配置，即使那样它似乎也不起作用。

* * *

## 回答 #36

> 赞同：5
> 
> 时间：2008-12-30T14:47:36.013

看起来您从[Greasemonkey\JavaScript 复制到剪贴板按钮](https://stackoverflow.com/questions/316508/greasemonkey-javascript-copy-to-clipboard-button%20%22Greasemonkey%5CJavaScript "复制到剪贴板按钮")或此代码段的原始来源中获取了代码...

此代码用于 Greasemonkey，因此是 unsafeWindow。我猜 Internet Explorer 中的语法错误来自`const`Firefox 特有的关键字（将其替换为`var`）。

* * *

## 回答 #37

> 赞同：5
> 
> 时间：2017-10-14T23:15:10.663

这是我在互联网上查找各种方法后唯一开始工作的事情。这是一个混乱的话题。世界各地发布了许多解决方案，但其中大多数都*不起作用*。这对我有用：

注意：此代码仅在作为类似“onClick”方法的直接同步代码执行时才有效。如果您调用对 Ajax 的异步响应或以任何其他异步方式，它将不起作用。

```
copyToClipboard(text) {
    var copyText = document.createElement("input");
    copyText.type = "text";
    document.body.appendChild(copyText);
    copyText.style = "display: inline; width: 1px;";
    copyText.value = text;
    copyText.focus();
    document.execCommand("SelectAll");
    document.execCommand("Copy");
    copyText.remove();
} 
```

我确实意识到这段代码会在屏幕上显示一个 1 像素宽的组件，持续一毫秒，但我决定不用担心，如果真的有问题，其他人可以解决这个问题。

* * *

## 回答 #38

> 赞同：5
> 
> 时间：2021-10-21T08:18:14.687

尝试使用此功能

```
 const copyToClipboard = (
  value,
  successfully = () => null,
  failure = () => null
) => {
  const clipboard = navigator.clipboard;
  if (clipboard !== undefined && clipboard !== "undefined") {
    navigator.clipboard.writeText(value).then(successfully, failure);
  } else {
    if (document.execCommand) {
      const el = document.createElement("input");
      el.value = value;
      document.body.append(el);

      el.select();
      el.setSelectionRange(0, value.length);

      if (document.execCommand("copy")) {
        successfully();
      }

      el.remove();
    } else {
      failure();
    }
  }
}; 
```

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2013-08-06T12:10:24.597

这是同一网站的**简单**的基于 Ajax/会话的剪贴板。

请注意，会话必须启用且有效，并且此解决方案适用于同一站点。我在 CodeIgniter 上对其进行了测试，但遇到了 session/Ajax 问题，但这[也](https://stackoverflow.com/questions/7980193/codeigniter-session-bugging-out-with-ajax-calls)解决了这个问题。如果您不想玩会话，请使用数据库表。

**JavaScript/jQuery**

```
<script type="text/javascript">
    $(document).ready(function() {

        $("#copy_btn_id").click(function(){

            $.post("<?php echo base_url();?>ajax/foo_copy/"+$(this).val(), null,
                function(data){
                    // Copied successfully
                }, "html"
            );
        });

        $("#paste_btn_id").click(function() {

           $.post("<?php echo base_url();?>ajax/foo_paste/", null,
               function(data) {
                   $('#paste_btn_id').val(data);
               }, "html"
           );
        });
    });
</script> 
```

**HTML 内容**

```
<input type='text' id='copy_btn_id' onclick='this.select();'  value='myvalue' />
<input type='text' id='paste_btn_id' value='' /> 
```

**PHP 代码**

```
<?php
    class Ajax extends CI_Controller {

        public function foo_copy($val){
            $this->session->set_userdata(array('clipboard_val' => $val));
        }

        public function foo_paste(){
            echo $this->session->userdata('clipboard_val');
            exit();
        }
    }
?> 
```

* * *

## 回答 #40

> 赞同：4
> 
> 时间：2017-01-09T02:22:17.233

我不得不从页面中复制非输入框文本（任何 div/span 标签内的文本）并提出以下代码。唯一的诀窍是有一个隐藏字段，但作为 TEXT 类型。它不适用于隐藏类型。

```
function copyToClipboard(sID) {
    var aField = document.getElementById("hiddenField");

    aField.hidden = false;
    aField.value  = document.getElementById(sID).textContent;
    aField.select();
    document.execCommand("copy");
    alert("Following text has been copied to the clipboard.\n\n" + aField.value);
    aField.hidden = true;
} 
```

并在 HTML 中添加以下内容：

```
input type="text" id="hiddenField" style="width:5px;border:0" />
... 
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2022-01-20T15:26:27.433

# Stackoverflow 的解决方案

我只是想指出 Stackoverflow 实际上就是这样做的。在每个答案下都有一个“共享”链接 - 当您单击该链接时，它会打开一个弹出窗口，其中在输入中突出显示共享链接，以及一个“复制链接”链接：

[![在此处输入图像描述](https://i.stack.imgur.com/ZpqQ3.png)](https://i.stack.imgur.com/ZpqQ3.png)

如果你去 Chrome DevTools 并去那个链接的事件监听器，你可以找到他们使用的函数。它被称为 tryCopy()：

[![在此处输入图像描述](https://i.stack.imgur.com/cqeGw.png)](https://i.stack.imgur.com/cqeGw.png)

这与[Dean Taylors 在这里的回答](https://stackoverflow.com/a/30810322/422845)（最近更新）完全一致 - 具体阅读标题为**“Async + Fallback”**的部分。TL;DR 是：尝试使用`navigator.clipboard`api - 如果浏览器不支持，请回退到 document.execCommand()。

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2013-06-26T07:28:21.147

如果必须将复制的链接粘贴到同一站点上，那么一个简单的解决方案是在按下简单的 HTML 复制按钮之前突出显示文本，然后按下它，文本内容将存储在会话中。在要粘贴的地方，都有一个粘贴按钮。

**我知道，这不是一个持久和通用的解决方案，但它是 :)

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2013-10-21T11:39:39.470

如果您在 Chrome 扩展程序中从剪贴板读取文本，并且允许“clipboardRead”权限，您可以使用以下代码：

```
function readTextFromClipboardInChromeExtension() {
    var ta = $('<textarea/>');
    $('body').append(ta);
    ta.focus();
    document.execCommand('paste');
    var text = ta.val();
    ta.blur();
    ta.remove();
    return text;
} 
```

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2015-09-08T11:51:52.533

除了[Dean Taylor 的更新答案（2015 年 7 月）](https://stackoverflow.com/a/30810322/1684970)，我还写了一个 jQuery 方法，看起来像他的示例。

[jsFiddle](http://jsfiddle.net/kmsdev/wf43zq1y/)

```
/**
* Copies the current selected text to the SO clipboard
* This method must be called from an event to work with `execCommand()`
* @param {String} text Text to copy
* @param {Boolean} [fallback] Set to true shows a prompt
* @return Boolean Returns `true` if the text was copied or the user clicked on accept (in prompt), `false` otherwise
*/
var CopyToClipboard = function(text, fallback){
    var fb = function () {
        $t.remove();
        if (fallback !== undefined && fallback) {
            var fs = 'Please, copy the following text:';
            if (window.prompt(fs, text) !== null) return true;
        }
        return false;
    };
    var $t = $('<textarea />');
    $t.val(text).css({
        width: '100px',
        height: '40px'
    }).appendTo('body');
    $t.select();
    try {
        if (document.execCommand('copy')) {
            $t.remove();
            return true;
        }
        fb();
    }
    catch (e) {
        fb();
    }
}; 
```

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2015-10-05T09:29:10.970

2015 年更新：目前有一种使用`document.execCommand`剪贴板的方法。

[clipboard.js](https://github.com/zenorocha/clipboard.js)提供了一种使用剪贴板的跨浏览器方式（[浏览器支持](http://caniuse.com/#search=document.execCommand)）。

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2020-11-04T21:20:34.067

[在这里](https://www.w3schools.com/howto/howto_js_copy_clipboard.asp)找到了这个解决方案。`document.execCommand("copy");`Internet Explorer 8 和更早版本不支持 。

```
const copyBtn =  document.getElementById("copyBtn");
const input = document.getElementById("input");

function copyText() {
  const value = input.value;

  input.select(); // selects the input variable as the text to be copied
  input.setSelectionRange(0, 99999); // this is used to set the selection range for mobile devices

  document.execCommand("copy"); // copies the selected text

  alert("Copied the text " + value); // displays the copied text in a prompt
}

copyBtn.onmousedown = function () {
  copyText();
}
```

```
<input type="text" id="input" placeholder="Type text to copy... "/>
<button id="copyBtn">
  Copy
</button>
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2020-12-09T21:33:54.450

简单、即用型且不会过时的解决方案：

```
function copyToClipboard(elementIdToCopy, elementIdToNotifyOutcome) {
    const contentToCopy = document.getElementById(elementIdToCopy).innerHTML;
    const elementToNotifyOutcome = document.getElementById(elementIdToNotifyOutcome);

    navigator.clipboard.writeText(contentToCopy).then(function() {
        elementToNotifyOutcome.classList.add('success');
        elementToNotifyOutcome.innerHTML = 'Copied!';
    }, function() {
        elementToNotifyOutcome.classList.add('failure');
        elementToNotifyOutcome.innerHTML = 'Sorry, did not work.';
    });
} 
```

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2014-07-02T14:28:28.423

在 Chrome 中，您可以使用[`copy('the text or variable etc')`](http://anti-code.com/devtools-cheatsheet/#command-line-api). 虽然这不是跨浏览器（并且[不能在片段中工作？](https://code.google.com/p/chromium/issues/detail?id=260401)），但您可以将其添加到其他跨浏览器答案中。

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2015-10-10T04:13:00.630

我打算使用clipboard.js，但它没有任何移动解决方案（还）......所以我写了一个超级小库：

[雪佛兰](https://github.com/ryanpcmcquen/cheval)

这将复制文本（桌面、Android 和 Safari 10+），或者至少选择文本（旧版本的 iOS）。缩小它刚刚超过 1 kB。在桌面 Safari（版本 10 之前）中，它告诉用户*"Press Command + C to copy"*。您也无需编写任何 JavaScript 即可使用它。

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2017-07-13T11:16:47.820

我在一个简单的解决方案中编译了一些函数来涵盖所有情况，如果需要，可以及时回退。

```
window.copyToClipboard = function(text) {
  // Internet Explorer specific
  if (window.clipboardData && window.clipboardData.setData) {
    return clipboardData.setData("Text", text);
  }

  // All other modern browsers
  target = document.createElement("textarea");
  target.style.position = "absolute";
  target.style.left = "-9999px";
  target.style.top = "0";
  target.textContent = text;
  document.body.appendChild(target);
  target.focus();
  target.setSelectionRange(0, target.value.length);

  // Copy the selection of fall back to prompt
  try {
    document.execCommand("copy");
    target.remove();
    console.log('Copied to clipboard: "'+text+'"');
  }
  catch(e) {
    console.log("Can't copy string on this browser. Try to use Chrome, Firefox or Opera.")
    window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
  }
} 
```

在这里测试它：[https ://jsfiddle.net/jv0avz65/](https://jsfiddle.net/jv0avz65/)

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2018-01-11T21:07:28.053

这是唯一对我有用的东西：

```
let textarea = document.createElement('textarea');
textarea.setAttribute('type', 'hidden');
textarea.textContent = 'the string you want to copy';
document.body.appendChild(textarea);
textarea.select();
document.execCommand('copy'); 
```

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2018-01-19T16:30:29.043

使用 JavaScript 功能`try/catch`甚至可以更好地处理错误，如下所示：

```
copyToClipboard() {
    let el = document.getElementById('Test').innerText
    el.focus(); // el.select();
    try {
        var successful = document.execCommand('copy');
        if (successful) {
            console.log('Copied Successfully! Do whatever you want next');
        }
        else {
            throw ('Unable to copy');
        }
    }
    catch (err) {
        console.warn('Oops, Something went wrong ', err);
    }
} 
```

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2019-01-26T13:23:09.270

使用`document.execCommand`将为您完成工作...

使用它，您还可以进行**剪切**、**复制**和**粘贴**...

这是一种简单的剪贴板复制功能，可以复制输入文本中的所有内容...

```
function copyInputText() {
  var copyText = document.querySelector("#input");
  copyText.select();
  document.execCommand("copy");
}

document.querySelector("#copy").addEventListener("click", copyInputText);
```

```
<input id="input" type="text" />
<button id="copy">Copy</button>
```

有关详细信息，请参阅[*与剪贴板交互*](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard)（附加组件）。

* * *

## 回答 #54

> 赞同：2
> 
> 时间：2019-10-30T21:00:29.500

`textarea`这是一个独立的类，通过将其放置在屏幕外，确保不会从临时发生闪烁。

这适用于 Safari（桌面）、Firefox 和 Chrome。

```
// ================================================================================
// ClipboardClass
// ================================================================================
var ClipboardClass = (function() {

    function copyText(text) {
        // Create a temporary element off-screen to hold text.
        var tempElem = $('<textarea style="position: absolute; top: -8888px; left: -8888px">');
        $("body").append(tempElem);

        tempElem.val(text).select();
        document.execCommand("copy");
        tempElem.remove();
    }

    // ============================================================================
    // Class API
    // ============================================================================
    return {
        copyText: copyText
    };

})(); 
```

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2020-12-16T12:40:28.467

以下函数可用于复制到剪贴板：

```
copyToclipboard = (event, text) => {
    var container = event.currentTarget;
    let tempInnerHtml = container.innerHTML;
    container.innerHTML = text;
    window.getSelection().removeAllRanges();
    let range = document.createRange();
    range.selectNode(container);
    window.getSelection().addRange(range);
    document.execCommand('copy');
    window.getSelection().removeAllRanges();
    container.innerHTML = tempInnerHtml;
} 
```

* * *

## 回答 #56

> 赞同：2
> 
> 时间：2021-10-18T00:39:23.073

添加到 Dean Taylor 的答案，这里有一个简短的答案和一个长答案，因此您可以复制适合您需要的功能：

简短的回答：

只需使用`navigator.clipboard.writeText(str)`

请参阅[caniuse.com 上的剪贴板 API](https://caniuse.com/clipboard)

长答案：

```
 // Copies a string to clipboard
    // Uses navigator API if available, else uses execCommand (deprecated)
    // Returns a boolean if copy was successful
    // See: https://stackoverflow.com/q/400212/4907950
        async function copyText(str) {
        console.log('Copying', str);
        if (!navigator.clipboard) {
            // fallback
            let input = document.createElement('textarea');
            input.innerHTML = str;
            document.body.appendChild(input);
            input.focus();
            input.select();
            let result;

            try {
                result = document.execCommand('copy');
                console.log(
                    'Fallback: Copying text command was ' + (result ? 'successful' : 'unsuccessful')
                );
            } catch (err) {
                console.error('Fallback: Could not copy text: ', err);
            }
            document.body.removeChild(input);
            return result;
        }
        const result = navigator.clipboard.writeText(str).then(
            function () {
                console.log('Async: Copying to clipboard was successful');
                return true;
            },
            function (err) {
                console.error('Async: Could not copy text: ', err);
                return false;
            }
        );
        return result; 
```

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2015-05-07T12:36:18.500

出于安全原因，您不能这样做。您必须选择 Flash 才能复制到剪贴板。

我建议这个：http: [//zeroclipboard.org/](http://zeroclipboard.org/)

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2016-05-25T15:06:19.373

搜索支持 Safari 和其他浏览器（Internet Explorer 9 及更高版本）的解决方案后，

我使用和 GitHub 一样的：[ZeroClipboard](https://github.com/zeroclipboard/zeroclipboard)

## **例子：**

[http://zeroclipboard.org/index-v1.x.html](http://zeroclipboard.org/index-v1.x.html)

**HTML**

```
<html>
  <body>
    <button id="copy-button" data-clipboard-text="Copy Me!" title="Click to copy me.">Copy to Clipboard</button>
    <script src="ZeroClipboard.js"></script>
    <script src="main.js"></script>
  </body>
</html> 
```

**JavaScript**

```
var client = new ZeroClipboard(document.getElementById("copy-button"));

client.on("ready", function (readyEvent) {
    // alert( "ZeroClipboard SWF is ready!" );

    client.on("aftercopy", function (event) {
        // `this` === `client`
        // `event.target` === the element that was clicked
        event.target.style.display = "none";
        alert("Copied text to clipboard: " + event.data["text/plain"]);
    });
}); 
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2017-09-01T15:20:30.587

这是最好的。赢了这么多。

```
var toClipboard = function(text) {
    var doc = document;

    // Create temporary element
    var textarea = doc.createElement('textarea');
    textarea.style.position = 'absolute';
    textarea.style.opacity  = '0';
    textarea.textContent    = text;

    doc.body.appendChild(textarea);

    textarea.focus();
    textarea.setSelectionRange(0, textarea.value.length);

    // Copy the selection
    var success;
    try {
        success = doc.execCommand("copy");
    }
    catch(e) {
        success = false;
    }

    textarea.remove();

    return success;
} 
```

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2019-08-19T08:43:44.310

这是一个简单的例子；）

```
<!DOCTYPE html>
<html>
    <body>
        <input type="text"
               value="Hello, World!"
               id="myInput">
        <button onclick="myFunction()">Copy text</button>

        <p>The document.execCommand() method is not supported
           in Internet&nbsp;Explorer&nbsp;8 and earlier.</p>

        <script>
            function myFunction() {
                var copyText = document.getElementById("myInput");
                copyText.select();
                document.execCommand("copy");
                alert("Copied the text: " + copyText.value);
            }
        </script>
    </body>
</html> 
```

* * *

## 回答 #61

> 赞同：1
> 
> 时间：2020-10-13T16:16:15.680

```
document.querySelector('#some_your_textfield_id').select();
document.execCommand('copy'); 
```

第一行是选择要复制的文本。

第二行是复制选定的文本。

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2017-07-14T10:46:41.843

我已经将@dean-taylor 提出的解决方案与其他地方的一些其他选择/取消选择代码一起放在 NPM 上可用的 jQuery 插件中：

[https://www.npmjs.com/package/jquery.text-select](https://www.npmjs.com/package/jquery.text-select)

### 安装：

`npm install --save jquery.text-select`

### 用法：

```
<script>
    $(document).ready(function(){
        $("#selectMe").selectText(); // Hightlight / select the text
        $("#selectMe").selectText(false); // Clear the selection

        $("#copyMe").copyText(); // Copy text to clipboard
    });
</script> 
```

有关方法/事件的更多信息可以在上面的 NPM 注册表页面中找到。

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2018-02-26T12:25:54.707

这是 Angular 5.x+ 的优雅解决方案：

零件：

```
import {
  ChangeDetectionStrategy,
  ChangeDetectorRef,
  Component,
  ElementRef,
  EventEmitter,
  Input,
  OnInit,
  Output,
  Renderer2,
  ViewChild
} from '@angular/core';

@Component({
  selector: 'copy-to-clipboard',
  templateUrl: './copy-to-clipboard.component.html',
  styleUrls: ['./copy-to-clipboard.component.scss'],
  changeDetection: ChangeDetectionStrategy.OnPush
})

export class CopyToClipboardComponent implements OnInit {
  @ViewChild('input') input: ElementRef;
  @Input() size = 'md';
  @Input() theme = 'complement';
  @Input() content: string;
  @Output() copied: EventEmitter<string> = new EventEmitter<string>();
  @Output() error: EventEmitter<string> = new EventEmitter<string>();

  constructor(private renderer: Renderer2) {}

  ngOnInit() {}

  copyToClipboard() {

    const rootElement = this.renderer.selectRootElement(this.input.nativeElement);

    // iOS Safari blocks programmtic execCommand copying normally, without this hack.
    // https://stackoverflow.com/questions/34045777/copy-to-clipboard-using-javascript-in-ios
    if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {

      this.renderer.setAttribute(this.input.nativeElement, 'contentEditable', 'true');

      const range = document.createRange();

      range.selectNodeContents(this.input.nativeElement);

      const sel = window.getSelection();

      sel.removeAllRanges();
      sel.addRange(range);

      rootElement.setSelectionRange(0, 999999);
    } else {
      rootElement.select();
    }

    try {
      document.execCommand('copy');
      this.copied.emit();
    } catch (err) {
      this.error.emit(err);
    }
  };
} 
```

模板：

```
<button class="btn btn-{{size}} btn-{{theme}}" type="button" (click)="copyToClipboard()">
  <ng-content></ng-content>
</button>

<input #input class="hidden-input" [ngModel]="content"> 
```

款式：

```
.hidden-input {
  position: fixed;
  top: 0;
  left: 0;
  width: 1px; 
  height: 1px;
  padding: 0;
  border: 0;
  box-shadow: none;
  outline: none;
  background: transparent;
} 
```

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2018-05-05T10:14:55.367

这是我的解决方案：

```
var codeElement =
    document.getElementsByClassName("testelm") &&
        document.getElementsByClassName("testelm").length ?
    document.getElementsByClassName("testelm")[0] :
    "";
if (codeElement != "") {
    var e = document.createRange();
    e.selectNodeContents(codeElement);
    var selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(e);
    document.execCommand("Copy");
    selection.removeAllRanges();
} 
```

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2018-11-21T11:12:15.250

这*可以*通过使用 getElementbyId、Select()、blur() 和复制命令的组合来完成。

**笔记**

select() 方法选择 <textarea> 元素或带有文本字段的 <input> 元素中的所有文本。这可能不适用于按钮。

**用法**

```
let copyText = document.getElementById('input-field');
copyText.select()
document.execCommand("copy");
copyReferal.blur()
document.getElementbyId('help-text').textContent = 'Copied' 
```

blur() 方法将删除难看的突出显示部分，而不是您可以在漂亮的消息中显示*您的内容已成功复制*。

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2019-08-06T10:31:51.847

我尝试了很多解决方案。如果它适用于现代浏览器，则它不适用于 Internet Explorer。如果它在 Internet Explorer 中工作，它不会在 iOS 上。我终于对它们进行了整理，并得出了适用于所有浏览器、iOS、webview 和 Android 的以下修复程序。

注意：我还介绍了用户拒绝剪贴板权限的场景。此外，即使用户手动复制，也会显示“链接已复制”消息。

```
<div class="form-group col-md-12">
    <div class="input-group col-md-9">
        <input name="copyurl"
               type="text"
               class="form-control br-0 no-focus"
               id="invite-url"
               placeholder="http://www.invitelink.com/example"
               readonly>
        <span class="input-group-addon" id="copy-link" title="Click here to copy the invite link">
            <i class="fa fa-clone txt-18 text-success" aria-hidden="true"></i>
        </span>
    </div>
    <span class="text-success copy-success hidden">Link copied.</span>
</div> 
```

脚本：

```
var addEvent =  window.attachEvent || window.addEventListener;
var event = 'copy';
var $inviteUrl = $('#invite-url');

$('#copy-link').on('click', function(e) {
    if ($inviteUrl.val()) {
        if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {
            var el = $inviteUrl.get(0);
            var editable = el.contentEditable;
            var readOnly = el.readOnly;
            el.contentEditable = true;
            el.readOnly = false;
            var range = document.createRange();
            range.selectNodeContents(el);
            var sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            el.setSelectionRange(0, 999999);
            el.contentEditable = editable;
            el.readOnly = readOnly;
            document.execCommand('copy');
            $inviteUrl.blur();
        }
        else {
            $inviteUrl.select();
            document.execCommand("copy");
        }
    }
});

addEvent(event, function(event) {
    if ($inviteUrl.val() && event.target.id == 'invite-url') {
        var $copyLink = $('#copy-link i');
        $copyLink.removeClass('fa-clone');
        $copyLink.addClass('fa-check');
        $('.copy-success').removeClass('hidden');
        setTimeout(function() {
            $copyLink.removeClass('fa-check');
            $copyLink.addClass('fa-clone');
            $('.copy-success').addClass('hidden');
        }, 2000);
    }
}); 
```

* * *

## 回答 #67

> 赞同：-6
> 
> 时间：2021-03-24T06:50:11.803

这可能是您问题的解决方案

```
function CopyToNotepad(id){
    var r = document.createRange();
    r.selectNode(document.getElementById(id));
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(r);
    document.execCommand('copy');
    window.getSelection().removeAllRanges();
} 
```

注意：**id**应该是您要将内容复制到的***父元素 id 。***例如：假设您要复制列表中的所有内容，则 id 应按如下方式使用：

```
<ul id="dummy_id">
<li>copy content 1 </li>
<li>copy content 2 </li>
<li>copy content 3 </li>
<li>copy content 4 </li>
<li>copy content 5 </li>
</ul> 
```

那么函数调用应该是这样的

***CopyToNotepad(dummy_id)***

谢谢。当然这可以解决你的问题！

# design-patterns - 工厂模式在没有访问者的框架之外有用吗？

> ID：400222
> 
> 赞同：1
> 
> 时间：2008-12-30T13:12:54.363
> 
> 标签：design-patterns, oop

在该领域多年经验之后，在我看来，工厂模式是不编写框架或库时不太有趣和有用的模式之一。

我并不是说工厂模式是不必要的。例如，W3C`Document`接口充当各种 XML 节点（元素、属性、文本……）的工厂。Eclipse JDT 中的`AST`类充当`ASTNode`s like `Assignment`、`MethodDeclaration`等的工厂。我可以找到许多其他框架/库示例。

但大多数时候，在纯客户端代码中，我从不觉得需要使用工厂模式。您不关心对象来自哪里或它们是如何创建的。您只需通过依赖注入的接口将对象连接起来，然后这些对象可以以依赖于环境的方式“弹跳”到生命中（例如`new`，在简单的本地测试中手动进行，Java EE 环境中的 bean 容器......）。但从来没有像`ArticleFactory.createArticle()`.

我意识到例如 Spring 可以被认为是一个 bean '工厂'，但是 Spring bean 工厂是非常通用的，我正在谈论的 Factory 的实现应该有一个特定的接口，并且在某种程度上仅限于创建一个成员预定义的“家庭”对象。

我还注意到Factory、Composite 和Visitor 经常齐头并进，Factory 创建一组Visitor 可以遍历的（域）相关对象。同样，框架的典型内容，而不是客户端代码。

因此，我的问题是：在框架之外，是否存在您（将）使用工厂模式而不是普通接口和依赖注入的情况？如果有，是否有关联的访客？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T13:18:48.673

我有规律地使用工厂类（或方法）。也许，它是[金锤反模式](http://en.wikipedia.org/wiki/Anti-pattern#Methodological_anti-patterns)的一个症状，因为 Factory 恰好是我很好理解的模式之一，但我已经找到了用途。我最近发现的一种用途是注入工厂以根据 ASP.NET MVC 控制器中工作单元的需要创建 LINQ DataContexts。通过使用Factory，控制器中的方法可以使用Factory的方法按需创建一个新的DataContext。结合依赖注入，这给了我模拟工厂（以及数据上下文）和按需创建的能力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-30T18:17:17.033

正如 Maxime Rouiller 在这篇文章中所说，我希望更多的人等到他们真正需要创建不同类型的对象后再实现工厂。我敢打赌，大多数时候这种需求永远不会实现，工厂也没有必要。

[http://blog.decayingcode.com/post/anti-pattern-gas-factory-or-unnecessary.aspx](http://blog.decayingcode.com/post/anti-pattern-gas-factory-or-unnecessary.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T14:13:29.437

工厂可以与依赖注入结合使用，在这种情况下，您从容器中获取的对象与这些对象用于完成其工作的对象之间的生命周期/生命周期存在差异。

一个例子：

假设您通过 DI 配置 Web 服务，并且该 Web 服务使用代理与其他 Web 服务进行通信。

这些代理需要经常关闭/处置，并且比 Web 服务的寿命短。您可以使用 IProxyFactory 接口注入它，而不是使用代理注入 Web 服务（这将导致代理的生命周期绑定到 Web 服务，即当 Web 服务使用它时不能关闭它）。

这样，Web 服务可以要求 IProxyfactory 接口创建一个 IProxy 实现，在该实现上它可以将调用委托给其他服务。Web 服务可以在每次使用它时关闭/处置代理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T16:06:18.477

也许一个具体的例子会有所帮助。

在我的 CAD/CAM 软件中，我有一个 DLL 目录，每个 DLL 都有不同数量的参数形状。所有形状都实现了 IParametricShape 接口。每个 DLL 都有一个工厂类，它有一个返回 IParametricShape 集合的方法。这将添加到软件的主列表中，并可供用户使用。

CAD/CAM 软件非常适合我的行业，我们如何将其用于文件类型和报告。更多类型的软件使用它们。您有一个报表列表，每个报表都实现了一个 IReport 接口。您有一个返回 IReports 集合的工厂。您添加您的报告主列表并使其可供用户使用。通过更改 DLL 和 Factory 类，您可以改变集合并轻松添加新报告。与您处理的文件类型相同。

最后，您可以在界面上设置属性，让您可以确定哪些报告（或文件类型）在软件中的位置。例如，我有一个车间标准报告集合，其中包含打印客户设置参数的报告，另一个与客户正在处理的工作相关的报告集合。属性告诉我哪个报告是哪个。或者，您可以有两个单独的工厂方法，一个生成 Collection A，另一个生成 Collection B。

# asp.net-mvc - Nhibernate、MVC 和 ModelBinders

> ID：400225
> 
> 赞同：1
> 
> 时间：2008-12-30T13:16:00.550
> 
> 标签：asp.net-mvc, nhibernate, model-view-controller, modelbinders

我想用 Nhibernate 配置我的模型绑定器：

所以我有：

```
<object id="GigModelBinder" type="App.ModelBinders.GigModelBinder, App.Web"  singleton="false"  >
<property name="VenueManager" ref="VenueManager"/>
<property name="ArtistManager" ref="ArtistManager"/> 
```

我有一个标记控制器操作的属性，以便它们使用正确的模型绑定器，即

```
[AcceptVerbs("POST")]
    public ActionResult Create([GigBinderAttribute]Gig gig)
    {
        GigManager.Save(gig);
        return View();
    } 
```

这工作正常，我的 GigModelBinder 注入了正确的 VenueManger 和 ArtistManager

但是，如果在应用程序开始我添加：

```
System.Web.Mvc.ModelBinders.Binders.Add(typeof(App.Shared.DO.Gig), new GigModelBinder()); 
```

并在控制器动作中使用：

```
UpdateModel<Gig>(gig); 
```

例如：

```
[AcceptVerbs("POST")]
    public ActionResult Update(Guid id, FormCollection formCollection)
    {
        Gig gig = GigManager.GetByID(id);

        UpdateModel<Gig>(gig);

        GigManager.Save(gig);
        return View();
    } 
```

VenueManger 和 ArtistManager 尚未注入 GigModelBinder。

任何想法我做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T21:37:58.087

在第一个示例中，您通过 Spring.NET 检索您的对象。这意味着它将查找所有依赖项并将它们粘贴到您的对象中并且一切正常。

在第二个示例中，您一直都忘记了 Spring.NET，而只是创建了一个普通的类实例。

您注册活页夹的行应如下所示：

```
 System.Web.Mvc.ModelBinders.Binders[typeof(App.Shared.DO.Gig)] = context.GetObject("GigModelBinder"); 
```

其中 context 是 Spring.NET 包中的 IApplicationContext 或 IObjectFactory 实例。

最好的问候，马蒂亚斯。

# java - 在运行时更改 JTable 引用 - 未出现在 GUI 中

> ID：400235
> 
> 赞同：0
> 
> 时间：2008-12-30T13:19:18.267
> 
> 标签：java, swing, java-me, jtable

我正在努力掌握 Pocket PC 的 Java ME 开发。我正在运行 NSIcom CrE-ME 模拟器并使用 NetBeans 6.5 构建我的应用程序。

该应用程序基于三个选项卡面板，每个选项卡面板都有 Swing 组件。内容 Swing 组件在应用程序的各个点进行更新。这些组件包括 JTextArea、JTextFields，最重要的是 JScrollPane 中的 JTable。

JTable 引起了问题。如果我通过 Matisse 使用一些示例数据对其进行初始化，它就会出现。但是，如果我尝试在运行时在下面的 populateFields() 方法中设置 JTable 的引用，则不会出现任何内容。请注意，这只是使用 Sun 教程中的示例表数据，甚至不是我的自定义 TableModel。

我究竟做错了什么？是否有一些我需要调用的明显更新方法，或者我错过了一些其他明显的错误/conecpt？我几乎尝试了我遇到的所有可能的方法，我认为这些方法可能与它有关。

在程序期间的不同时间调用 populateFields() 方法。

```
 public void populateFields()
    {

        String[] columnNames = {"First Name", "Last Name","Sport", "# of Years", "Vegetarian"};
        Object[][] data = { {"Mary", "Campione", "Snowboarding", new Integer(5), new Boolean(false)},
            {"Alison", "Huml", "Rowing", new Integer(3), new Boolean(true)},
            {"Kathy", "Walrath", "Knitting", new Integer(2), new Boolean(false)},
            {"Sharon", "Zakhour", "Speed reading", new Integer(20), new Boolean(true)},
            {"Philip", "Milne", "Pool", new Integer(10), new Boolean(false)} };

        this.tableSurvey = new JTable(new DefaultTableModel(data, columnNames));
        this.scrollPaneSurvey = new JScrollPane(this.tableSurvey);
        DefaultTableModel dtm = (DefaultTableModel) this.tableSurvey.getModel();
        dtm.fireTableStructureChanged();
        dtm.fireTableDataChanged();
        this.scrollPaneSurvey.invalidate();
        this.scrollPaneSurvey.validate();
        this.panelSurvey.validate();
        this.panelSurvey.repaint();
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T16:16:13.213

好的，我终于发现显然这就是我所需要的：

```
this.tableSurvey = new JTable(new DefaultTableModel(data, columnNames));       
this.scrollPaneSurvey.setViewportView(this.tableSurvey);
this.scrollPaneSurvey.validate(); 
```

谁能解释为什么使用下面的代码而不是 setViewportView() 方法不起作用？

```
this.scrollPaneSurvey = new JScrollPane(this.tableSurvey); 
```

谢谢！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T01:01:30.843

I think, based on your code snippets, that you are doing the

```
this.scrollPaneSurvey = new JScrollPane(this.tableSurvey); 
```

But the problem is that the parent panel layout manager has its own reference to the old scrollPaneSurvey. So when you recreate it, you never replace the existing component, and this new component is never added to the render pipeline. Your class knows about it, but the parent doesn't see notification that something changed.

Does that make sense?

Where as in the second part that you post, you're telling the scrollPaneSurvey what it should be displaying, which generates the notifications to repaint automatically.

# asp.net - ASP.NET 路由 - 自定义路由是否完全跳过 Global.asax 中的所有内容？

> ID：400236
> 
> 赞同：2
> 
> 时间：2008-12-30T13:20:33.910
> 
> 标签：asp.net, webforms, routing

我有一个简单的 ASP.NET 3.5 SP1 Web 窗体应用程序...我已经添加了 System.Web.Routing DLL，并且我已经创建了一个简单的路由，它返回一个标准 ASP.NET 页面作为“IHttpHandler”。

一切都很好......除了 HttpContext.Current.User 为**空**？？？

所以，我做了更多的挖掘（我在 Global.asax 文件中的所有事件中都放置了断点）。通常，这些断点会被命中（当我导航到标准的“.aspx”页面时）：

*   Application_BeginRequest
*   Application_AuthenticateRequest
*   Application_EndRequest

但是，当使用 ASP.NET 路由时……这些事件都没有触发。我错过了什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-12T19:36:26.950

假设您使用的是 IIS6，另一种方法是定义一个“通配符”扩展处理程序。将这个简单的“包罗万象”映射添加到 IIS6 将使它能够处理您的无扩展请求。默认情况下，.NET 安装程序将“.aspx”映射到 aspnet_isapi.dll——这就是 .aspx 扩展工作的原因。要将没有扩展名的请求映射到 APS.NET 引擎，您必须告诉 IIS 查看*每个请求*。

这是一篇解释该过程的快速文章：

[http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)

希望这有助于并减少您的网址的“蹩脚”因素。:)

-托德

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T13:51:52.880

找到了怪异和古怪（和愚蠢）的答案:)

如果您没有在路线末尾添加“.aspx”，则 Global.asax 中不会触发任何内容，这意味着您不会收到任何 BeginRequest、AuthenticateRequest、EndRequest 等...此外，您不会获得 SessionState或任何东西。

所以，“修复”对我来说只是改变我的路线：

```
RouteTable.Routes.Add("Blah", new Route("Blah/{reportName}", new MyHandler()); 
```

对此：

```
RouteTable.Routes.Add("Blah", new Route("Blah/{reportName}.aspx", new MyHandler()); 
```

多么蹩脚:) ...但它仍然是一个修复！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T09:50:16.533

当你说

“如果您不将“.aspx”添加到您的路线末尾，则 Global.asax 中不会触发任何内容，这意味着您不会收到任何 BeginRequest、AuthenticateRequest、EndRequest 等……此外，您不会得到会话状态或任何东西。”

IIS 会将此类请求记录在日志文件中还是只是匿名的？应用程序变量和 ViewState 呢？

抱歉，我还没有测试过，只是问你是否已经知道？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T10:56:17.763

我已经检查了应用程序变量和 Viewstate，这两个显然正在工作.. 不确定服务器日志：S

# linux - 如何获取 Linux 上可用无线网络的列表？

> ID：400240
> 
> 赞同：36
> 
> 时间：2008-12-30T13:23:39.910
> 
> 标签：linux, wireless

我想获得可用无线网络的列表。理想情况下，这将是通过一些 C 调用，但我不介意是否必须通过系统调用来解决它。如果所需的 C 调用或程序不需要某些特殊的 3rd 方包，那就更好了。

互联网似乎建议我使用`sudo iwlist <interface> scan`which 似乎确实可以从命令行解决问题，但我宁愿不需要 root 权限。我只想看到基础，不想改变任何东西。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2013-05-25T18:55:11.063

在命令行中进行扫描非常容易。手册页是您的朋友（查看**iwconfig**和**iwlist**）。但是使用 C 接口有点困难，所以我将重点介绍这一点。

首先，正如其他人提到的，一定要下载[无线工具源代码](http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html#latest)。编程接口的所有文档都在**.c**文件中。据我所知，该 api 没有网络文档。但是，源代码很容易阅读。对于这个问题，您几乎只需要**iwlib.h**和**iwlib.c 。**

虽然您可以使用`iw_set_ext`and `iw_get_ext`，但**libiw**实现了一个基本的扫描功能`iw_scan`，您可以从中提取您需要的大部分信息。

这是一个获取所有可用无线网络的 ESSID 的简单程序。编译`-liw`并运行`sudo`.

```
#include <stdio.h>
#include <time.h>
#include <iwlib.h>

int main(void) {
  wireless_scan_head head;
  wireless_scan *result;
  iwrange range;
  int sock;

  /* Open socket to kernel */
  sock = iw_sockets_open();

  /* Get some metadata to use for scanning */
  if (iw_get_range_info(sock, "wlan0", &range) < 0) {
    printf("Error during iw_get_range_info. Aborting.\n");
    exit(2);
  }

  /* Perform the scan */
  if (iw_scan(sock, "wlan0", range.we_version_compiled, &head) < 0) {
    printf("Error during iw_scan. Aborting.\n");
    exit(2);
  }

  /* Traverse the results */
  result = head.result;
  while (NULL != result) {
    printf("%s\n", result->b.essid);
    result = result->next;
  }

  exit(0);
} 
```

免责声明：这只是一个演示程序。某些结果可能没有 essid。此外，这假设您的无线接口是“wlan0”。你明白了。

阅读**iwlib**源代码！

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-12-30T14:39:37.323

[无线工具](http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html)包（iwlist[是](http://linuxcommand.gds.tuwien.ac.at/man_pages/iwlist8.html)其中的一部分）还包含无线工具帮助程序库。您需要包含**iwlib.h**并与**libiw.a**链接（即添加 -liw）。然后查找**iw_set_ext**函数的文档。SIOCSIWSCAN参数最有用**。**有关如何使用此接口的示例，请查看 KDE 库中的 KWifiManager 源代码（请参阅：[Interface_wireless_wirelessextensions::get_available_networks](http://websvn.kde.org/tags/KDE/3.5.0/kdenetwork/wifi/interface_wireless_wirelessextensions.cpp?view=markup)方法）。或者，您也可以下载[Wireless Tools 源代码](http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/wireless_tools.29.tar.gz)并查看 iwlib iw_set_ext 函数如何在 iwlist.c 中用于扫描。

至于特权，我想该进程将需要以 root 身份运行才能执行扫描。我很想知道是否也可以这样做。

由于您使用的是 Ubuntu 8.04，因此应该使用[libiw-dev软件包。](https://launchpad.net/ubuntu/hardy/+package/libiw-dev)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2019-11-28T23:23:56.710

您可以使用`nmcli`不需要root权限或WIFI接口名称的。

```
nmcli -t -f ssid dev wifi 
```

# mysql - 从 Adob e flex/AIR 访问 mysql

> ID：400241
> 
> 赞同：6
> 
> 时间：2008-12-30T13:25:01.703
> 
> 标签：mysql, apache-flex, air, adobe

是否可以通过 Adob​​e AIR/Flex 应用程序直接访问 MySql 数据库？
如果不是，那么下一个最佳选择是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-31T18:21:10.077

我不得不不同意（尽管尊重！）与 Abdullah 的观点，即在 AIR 中构建 ODBC 客户端会“导致奇怪的问题并引发安全问题”——这通常是这样做的（例如，Java 和 .NET，它们的运行时打包各种 ODBC 客户端）——但两张海报都是正确的：唯一的方法是将某种服务接口编码到您的 AIR 应用程序中（使用 WebService、HTTPService 等 Flex 类）和补充的服务器端接口（例如，通过 PHP 进行 REST，然后将连接到您的 MySQL 数据库）。对于简单的应用程序，这可能有点痛苦，但目前，这就是我们所得到的。:)

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T12:53:08.673

我没有尝试过，但是有一些项目可以在 AS3 中实现本机驱动程序以连接到 mysql 服务器。最后它只是一个套接字连接，并且允许 AIR 应用程序打开套接字。看看[http://code.google.com/p/assql/](http://code.google.com/p/assql/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T14:00:30.773

我不建议直接访问数据库。[我在这里](https://stackoverflow.com/questions/400243/would-you-use-laszlo-do-develop-a-flash-based-front-end-to-a-java-web-app)描述了我会如何做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T16:40:52.213

不，尽管 AIR 确实有一个内置的本地（客户端）SQLite 数据库。无论如何，您并不真的希望您的客户端应用程序能够直接访问服务器端数据库，这确实会导致奇怪的问题并引发安全问题。但是，您可以使用 Web 服务公开 MySQL 数据库。这篇[文章](http://netbeans.org/kb/docs/websvc/rest.html)有一个非常简单的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-03T22:17:31.830

恕我直言，从 Flex APP（Air 或 Flash）访问任何数据库的最佳方式是创建 Web 服务。在使用 PHP 进行了几次试用后，我开始使用 C# 构建的 WSDL SOAP 网络服务，这真是太棒了！从 C# 中，我可以随时获得 PostgreSQL、MySQL、SQL-SERVER 或 Oracle。使用 Flex Builder，您可以导入 WSDL，以便为您创建在 WSDL 端创建的对象和 Web 方法，以及事件、侦听器和对象。尝试。对于 C# 或 Java 或任何其他语言，WSDL SOAP 是一个很好的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-29T05:03:52.437

实际上，在 AIR 2.0 中，Adobe 添加了 NativeProcess 功能。这允许用户通过命令行的标准输入/标准输出在应用程序之间交换数据。缺点是您必须将应用程序编译为 EXE、DMG 或 RPM 文件，因为此功能不是跨平台的。MySQL 通过命令行可以很好地工作，因此这对您来说可能是一个非常好的选择。以下是有关使用该功能的一些链接。

[http://blog.omarfouad.com/?p=277](http://blog.omarfouad.com/?p=277) http://gotoandlearn.com/play.php?id=125 [http://gotoandlearn.com/play.php?id=126](http://gotoandlearn.com/play.php?id=126) http://www. adobe.com/devnet/air/flex/articles/air_screenrecording.html

# sql - 来自 SQL 的 Web 服务

> ID：400242
> 
> 赞同：3
> 
> 时间：2008-12-30T13:26:28.097
> 
> 标签：sql, web-services, tsql

我可以从存储过程调用远程 Web 服务并使用重新调整的值吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T13:31:39.257

如果您使用的是 SQL 2005/2008，如果您有能力安装和运行这些存储过程，则可以从 CLR 存储过程中执行此操作。欲了解更多信息：

[http://msdn.microsoft.com/en-us/library/ms190790.aspx](http://msdn.microsoft.com/en-us/library/ms190790.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T13:58:55.160

Service Broker 可能会提供您在此处寻找的那种功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T14:08:20.257

正如 The AntiSanta 所说，使用 CLR 存储过程这是可能的。真正的问题是你是否可以完全避免它。从存储过程调用 Web 服务感觉是颠倒的。理想情况下，您会有一些其他服务/应用程序/层调用存储过程和 Web 服务。存储的过程可能会返回 Web 服务的参数值，并且您在 WS 调用完成后提交本地事务。

从长远来看，这将使调试、部署和支持变得更加简单，并解耦存储过程和 Web 服务之间的直接引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:14:03.880

在 SQL Server 2000 及更高版本（如果未启用 CLR）上，如果您的 Web 服务有现有的 COM 包装器，则可以通过存储过程（ 、 等）`sp_OACreate`使用COM。`sp_OAMethod`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-15T20:48:19.143

这是我的有效代码。

```
exec @hr = sp_OACreate 'MSXML2.ServerXMLHttp', @obj OUT  
if @hr < 0 begin Raiserror('sp_OACreate MSXML2.ServerXMLHttp failed',16,1) 
return end  
exec @hr = sp_OAMethod @obj, 'Open', NULL, 'GET', @UrlString, false  
if @hr <0 begin set @msg = 'sp_OAMethod Open failed' goto eh end  
exec @hr = sp_OAMethod @obj, 'send'  
if @hr <0 begin set @msg = 'sp_OAMethod Send failed' goto eh end  
exec @hr = sp_OAGetProperty @obj, 'status', @status OUT  
if @hr <0 begin set @msg = 'sp_OAMethod read status failed' goto eh end  
if @status <> 200 begin set @msg = 'sp_OAMethod http status ' +str(@status) goto eh end  
exec @hr = sp_OAGetProperty @obj, 'responseText', @response OUT  
if @hr <0 begin set @msg = 'sp_OAMethod read response failed' goto eh end  
exec @hr = sp_OADestroy @obj  
select @response 
```

……

嗯：

```
exec @hr = sp_OADestroy @obj  
Raiserror(@msg, 16, 1)  
Return 
```

# java - 您会使用 Laszlo 为 Java Web 应用程序开发基于 Flash 的前端吗？

> ID：400243
> 
> 赞同：6
> 
> 时间：2008-12-30T13:26:35.007
> 
> 标签：java, ajax, flash, jsp, laszlo

如果您有一个基于 Java 的 Web 应用程序（J2EE Web 应用程序 - 不介意正在使用哪些其他底层框架），并且您想引入一个基于 Flash 的前端，您会使用 Laszlo 还是更愿意公开一个类似 ReST 的 XML 接口并构建和部署使用它的 Flash 应用程序？

一方面，Laszlo 非常了不起——为 Flash 做的就像 JSP 为 HTML 做的一样。它很容易使用。它非常适合 Web 应用程序的其余部分（基于 JSP）。

另一方面，开发一个与服务器分离的完整 Flash 应用程序并使用 XML-over-HTTP 机制将两者绑定可能会更好。如果需要，这将具有额外的优势，即能够为 AJAX 前端使用相同的 XML 接口。

你会怎么做，为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T14:35:43.667

过去我可能考虑过 Laszlo，但今天，我会留在 Java 堆栈中并使用**JavaFX**。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T14:42:52.527

Laszlo 是从未成功过的产品，它周围没有足够大的开发者生态系统。

我会使用 Adob​​e Flex 作为前端。使用标记语言进行 Flash 具有相同的好处，但它具有更大的开发人员基础和可供利用的开源项目。对于数据通信，请使用 REST，或者如果您想变得更聪明，请使用 BlazeDS。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T13:58:55.597

我会创建契约优先服务，单独部署它们，然后编写 RIA 客户端来访问它们。

首先提出模式具有在开发过程中将两者完全解耦的额外好处。RIA 开发人员可以创建一些合成 XML 流以在等待服务上线时用于数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T04:30:21.717

实际上，我已经花了一些时间研究类似于您所建议的实现。我在网页中嵌入了一个编译好的 Open Laszlo 前端，后端有一个 Django（一个 python MVC 库）REST 接口，没有 Open Laszlo 服务器。它工作得相当好，但有几件事需要注意。Open Laszlo 仅支持对 GET 和 POST 的调用，因此您将无法在 REST API 中轻松使用 DELETE 和 PUT 方法。另一个是 Laszlo 周围缺乏社区（如其他地方所述）。在使用 Laszlo 时，我有时很难回答一些基本问题，尤其是围绕框架中的 XML HTTP API 和 XML 复制特性。

综上所述，如果您愿意解决上述限制，则该实施确实有效并且可以有效。另外，Open Laszlo 是免费的，如果您的预算有限，这可能是一个非常大的优势。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T16:30:56.243

OpenLaszlo 是一个完整的 RIA 框架，所以我很确定您可以将它“编译”成一个完全独立的应用程序，通过 HTTP 与服务器通信。它与 Flex 非常相似。Flex 的优势在于更大的社区、成熟的 IDE 和更多资源 (Adobe)，而 OpenLaszlo 更具创新性，您可以从一个代码库部署到 Flash 或 AJAX。

# federated-identity - 使用日内瓦框架创建本地令牌缓存

> ID：400246
> 
> 赞同：5
> 
> 时间：2008-12-30T13:30:02.333
> 
> 标签：federated-identity, geneva-framework

还没有看到很多与日内瓦相关的问题，我也在[日内瓦论坛](http://social.msdn.microsoft.com/Forums/en-US/Geneva/threads/)上发布了这个问题......

我正在处理一个场景，我们有一个具有广泛安装基础的 win forms 应用程序，它将在整个操作过程中对我们集中托管的各种服务发出频繁的调用。

这些服务都使用日内瓦框架，所有客户都应该首先调用我们的 STS 以获取令牌以允许访问服务。

开箱即用，使用 ws2007FederationHttpBinding，可以将应用程序配置为在每次服务调用之前从 STS 检索令牌，但显然这不是最有效的方式，因为我们几乎重复了调用服务的工作。

或者，我已经实现了从应用程序“手动”检索令牌所需的代码，然后在对服务调用操作时传递相同的预检索令牌（基于 WSTrustClient 示例和论坛上的帮助）；效果很好，所以我们确实有一个解决方案，但我认为它不是很优雅，因为它需要在代码中构建 WCF 通道，远离美妙的 WCF 配置。

我更喜欢 ws2007FederationHttpBinding 方法，在这种方法中，客户端只需像任何其他 WCF 服务一样调用该服务，而无需了解有关日内瓦的任何信息，并且绑定负责令牌交换。

然后有人（乔恩辛普森）给了我 [我认为是] 一个好主意 - 添加一个服务，托管在应用程序本身中以缓存本地检索到的令牌。本地缓存服务将执行与 STS 相同的合约；当接收到请求时，它会检查是否存在缓存令牌，如果存在则返回它，否则它将调用“真实”STS，检索新令牌，缓存并返回它。客户端应用程序仍然可以使用 ws2007FederationHttpBinding，但不是将 STS 作为颁发者，而是使用本地缓存；

通过这种方式，我认为我们可以实现两全其美 - 在没有服务特定的自定义代码的情况下缓存令牌；我们的缓存应该能够处理所有 RP 的令牌。

我创建了一个非常简单的原型来看看它是否有效，并且 - 不幸的是有点不足为奇 - 我有点卡住了 -

我的本地服务（当前是控制台应用程序）获取请求，并且 - 第一次 - 调用 STS 以检索令牌，将其缓存并成功将其返回给客户端，随后客户端使用它来调用 RP。一切正常。

然而，第二次，我的本地 cahce 服务尝试再次使用相同的令牌，但客户端失败并出现 MessageSecurityException -

“安全处理器无法在消息中找到安全标头。这可能是因为消息是不安全的错误，或者是因为通信双方之间存在绑定不匹配。如果为安全配置了服务并且客户端是不使用安全性。”

是否有什么东西阻止了同一个令牌被多次使用？我对此表示怀疑，因为当我按照 WSTrustClient 示例重用令牌时，它运行良好；我错过了什么？我的想法可能吗？一个好？

这是本地缓存的（非常基本的，在这个阶段）主要代码位 -

```
 static LocalTokenCache.STS.Trust13IssueResponse  cachedResponse = null; 
    public LocalTokenCache.STS.Trust13IssueResponse Trust13Issue(LocalTokenCache.STS.Trust13IssueRequest request) 
    { 
        if (TokenCache.cachedResponse == null) 
        { 
            Console.WriteLine("cached token not found, calling STS"); 
            //create proxy for real STS 
            STS.WSTrust13SyncClient sts = new LocalTokenCache.STS.WSTrust13SyncClient(); 
            //set credentials for sts 
            sts.ClientCredentials.UserName.UserName = "Yossi"; 
            sts.ClientCredentials.UserName.Password = "p@ssw0rd"; 
            //call issue on real sts 
            STS.RequestSecurityTokenResponseCollectionType stsResponse = sts.Trust13Issue(request.RequestSecurityToken); 
            //create result object - this is a container type for the response returned and is what we need to return; 
            TokenCache.cachedResponse = new LocalTokenCache.STS.Trust13IssueResponse(); 
            //assign sts response to return value... 
            TokenCache.cachedResponse.RequestSecurityTokenResponseCollection = stsResponse; 
        } 
        else 
        { 
        } 
        //...and reutn 
        return TokenCache.cachedResponse; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T14:27:09.940

这几乎令人尴尬，但感谢论坛上的 Dominick Baier，我现在没有意识到我错过了一个重要的观点（我知道这没有意义！老实说！:-)） -

每个服务代理都会检索一次令牌，假设它没有过期，所以我需要做的就是重用相同的代理，我本来打算这样做，但相当愚蠢的是，我的原型上没有。

另外——我在 MSDN WCF 示例中发现了一个非常有趣的示例[——Durable Issued Token Provider](http://msdn.microsoft.com/en-us/library/aa717045(VS.85).aspx)，如果我理解正确的话，它使用客户端的自定义端点行为来实现令牌缓存，非常优雅。

我仍然会研究这种方法，因为我们有多个服务，因此我们可以通过在它们的代理之间重用相同的令牌来实现更高的效率。

所以 - 两种解决方案，我的眼睛几乎不知道；希望我的愚蠢在某些时候对某人有所帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-20T02:36:59.753

我在这里提供了一个用于缓存令牌的完整示例：http: [//blogs.technet.com/b/meamcs/archive/2011/11/20/caching-sts-security-token-with-an-active-web -client.aspx](http://blogs.technet.com/b/meamcs/archive/2011/11/20/caching-sts-security-token-with-an-active-web-client.aspx)

# java - 使用参数排列进行测试的工具

> ID：400250
> 
> 赞同：3
> 
> 时间：2008-12-30T13:32:48.443
> 
> 标签：java, unit-testing, testing, parameters

我记得有一个测试程序/库可以运行您的代码和/或单元测试，创建各种参数排列（空值、随机整数、字符串等）。我只是不记得它叫什么，搜索谷歌似乎没有提出任何东西。

我知道它是为 Java 代码创建的，而且我认为它也非常昂贵。这就是我能记住的全部，有人知道我在想什么程序/库吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T14:08:01.023

想到了[AgitarOne JUnit 生成器](http://www.agitar.com/solutions/products/automated_junit_generation.html)。不过，我不确定这是否是您的想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T14:57:24.700

Parasoft 的 JTest 可能就是您所想的。

# oracle - 如何将超过 1000 个值放入 Oracle IN 子句

> ID：400255
> 
> 赞同：118
> 
> 时间：2008-12-30T13:35:17.673
> 
> 标签：oracle, in-clause

有什么办法可以绕过 Oracle 10g 对静态 IN 子句中 1000 个项目的限制？我有一个逗号分隔的列表，其中包含许多我想在 IN 子句中使用的 ID，有时这个列表可能超过 1000 个项目，此时 Oracle 会引发错误。查询类似于此...

```
select * from table1 where ID in (1,2,3,4,...,1001,1002,...) 
```

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-12-30T13:38:04.530

将值放在临时表中，然后执行 select where id in (select id from temptable)

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2013-06-10T07:49:05.790

```
select column_X, ... from my_table
where ('magic', column_X ) in (
        ('magic', 1),
        ('magic', 2),
        ('magic', 3),
        ('magic', 4),
             ...
        ('magic', 99999)
    ) ... 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2008-12-31T11:16:48.543

我几乎可以肯定您可以使用 OR 在多个 IN 之间拆分值：

```
select * from table1 where ID in (1,2,3,4,...,1000) or 
ID in (1001,1002,...,2000) 
```

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2008-12-30T13:40:09.190

您可以尝试使用以下表格：

```
select * from table1 where ID in (1,2,3,4,...,1000)
union all
select * from table1 where ID in (1001,1002,...) 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-31T10:32:19.727

您首先从哪里获得 id 列表？由于它们是您数据库中的 ID，它们是否来自以前的查询？

当我过去看到这个时，是因为：-

1.  缺少参考表，正确的方法是添加新表，在该表上放置一个属性并加入它
2.  从数据库中提取一个 id 列表，然后在后续的 SQL 语句中使用（可能稍后或在另一台服务器上或其他任何地方）。在这种情况下，答案是永远不要从数据库中提取它。要么存储在临时表中，要么只编写一个查询。

我认为可能有更好的方法来修改这段代码，让这条 SQL 语句正常工作。如果您提供更多详细信息，您可能会得到一些想法。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-30T13:55:28.630

使用 ...from table(... :

```
create or replace type numbertype
as object
(nr number(20,10) )
/ 

create or replace type number_table
as table of numbertype
/ 

create or replace procedure tableselect
( p_numbers in number_table
, p_ref_result out sys_refcursor)
is
begin
  open p_ref_result for
    select *
    from employees , (select /*+ cardinality(tab 10) */ tab.nr from table(p_numbers) tab) tbnrs 
    where id = tbnrs.nr; 
end; 
/ 
```

这是需要提示的少数情况之一，否则 Oracle 不会使用列 id 上的索引。这种方法的优点之一是 Oracle 不需要一次又一次地硬解析查询。大多数情况下，使用临时表会比较慢。

**编辑 1**简化了程序（感谢 jimmyorr）+ 示例

```
create or replace procedure tableselect
( p_numbers in number_table
, p_ref_result out sys_refcursor)
is
begin
  open p_ref_result for
    select /*+ cardinality(tab 10) */ emp.*
    from  employees emp
    ,     table(p_numbers) tab
    where tab.nr = id;
end;
/ 
```

例子：

```
set serveroutput on 

create table employees ( id number(10),name varchar2(100));
insert into employees values (3,'Raymond');
insert into employees values (4,'Hans');
commit;

declare
  l_number number_table := number_table();
  l_sys_refcursor sys_refcursor;
  l_employee employees%rowtype;
begin
  l_number.extend;
  l_number(1) := numbertype(3);
  l_number.extend;
  l_number(2) := numbertype(4);
  tableselect(l_number, l_sys_refcursor);
  loop
    fetch l_sys_refcursor into l_employee;
    exit when l_sys_refcursor%notfound;
    dbms_output.put_line(l_employee.name);
  end loop;
  close l_sys_refcursor;
end;
/ 
```

这将输出：

```
Raymond
Hans 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-08-03T19:37:00.420

我也来到这里寻找解决方案。

根据您需要查询的高端项目数，并假设您的项目是唯一的，您可以将查询拆分为 1000 个项目的批量查询，然后将结果组合起来（此处为伪代码）：

```
//remove dupes
items = items.RemoveDuplicates();

//how to break the items into 1000 item batches        
batches = new batch list;
batch = new batch;
for (int i = 0; i < items.Count; i++)
{
    if (batch.Count == 1000)
    {
        batches.Add(batch);
        batch.Clear()
    }
    batch.Add(items[i]);
    if (i == items.Count - 1)
    {
        //add the final batch (it has < 1000 items).
        batches.Add(batch); 
    }
}

// now go query the db for each batch
results = new results;
foreach(batch in batches)
{
    results.Add(query(batch));
} 
```

在您通常没有超过 1000 个项目的情况下，这可能是一个很好的权衡 - 因为拥有超过 1000 个项目将是您的“高端”边缘情况。例如，如果您有 1500 个项目，则 (1000, 500) 的两个查询不会那么糟糕。这也假设每个查询本身并不是特别昂贵。

如果您的预期项目的典型数量变得更大（例如，在 100000 范围内）需要 100 个查询，这*将是不合适的。*如果是这样，那么您可能应该更认真地考虑使用上面提供的全局临时表解决方案作为最“正确”的解决方案。此外，如果您的项目不是唯一的，您还需要解决批次中的重复结果。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-05-08T19:39:00.930

是的，甲骨文的情况非常奇怪。

如果您在 IN 子句中指定 2000 个 id，它将失败。这失败了：

```
select ... 
where id in (1,2,....2000) 
```

但如果您只是将 2000 个 ID 放在另一个表（例如临时表）中，它将在以下查询中工作：

```
select ... 
where id in (select userId 
             from temptable_with_2000_ids ) 
```

您可以做什么，实际上可以将记录拆分为 1000 条记录并逐组执行。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-05-30T17:40:37.767

下面是一些 Perl 代码，它试图通过创建一个内联视图然后从中进行选择来解决这个限制。语句文本是通过使用每行十二个项目而不是从 DUAL 中单独选择每个项目来压缩的，然后通过将所有列联合在一起来解压缩。解压缩中的 UNION 或 UNION ALL 在这里应该没有区别，因为它都在一个 IN 中，无论如何都会在加入它之前施加唯一性，但是在压缩中，UNION ALL 用于防止很多不必要的比较。由于我过滤的数据都是整数，所以引用不是问题。

```
#
# generate the innards of an IN expression with more than a thousand items
#
use English '-no_match_vars';
sub big_IN_list{
    @_ < 13 and return join ', ',@_;
    my $padding_required = (12 - (@_ % 12)) % 12;  
    # get first dozen and make length of @_ an even multiple of 12
    my ($a,$b,$c,$d,$e,$f,$g,$h,$i,$j,$k,$l) = splice @_,0,12, ( ('NULL') x $padding_required );

    my @dozens; 
    local $LIST_SEPARATOR = ', '; # how to join elements within each dozen
    while(@_){
        push @dozens, "SELECT @{[ splice @_,0,12 ]} FROM DUAL"
    };  
    $LIST_SEPARATOR = "\n    union all\n    "; # how to join @dozens 
    return <<"EXP";
WITH t AS (
    select $a A, $b B, $c C, $d D, $e E, $f F, $g G, $h H, $i I, $j J, $k K, $l L FROM     DUAL
    union all
    @dozens
 )
select A from t union select B from t union select C from t union
select D from t union select E from t union select F from t union
select G from t union select H from t union select I from t union 
select J from t union select K from t union select L from t
EXP
} 
```

有人会这样使用它：

```
my $bases_list_expr = big_IN_list(list_your_bases());
$dbh->do(<<"UPDATE");
    update bases_table set belong_to = 'us'
    where id in ($bases_list_expr)
UPDATE 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-08-01T12:54:34.180

除了 using`IN`子句，您可以尝试`JOIN`与另一个正在获取 id 的表一起使用。这样我们就不用担心限制了。只是我的一个想法。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2012-06-14T15:39:43.230

代替`SELECT * FROM table1 WHERE ID IN (1,2,3,4,...,1000);`

用这个 ：

`SELECT * FROM table1 WHERE ID IN (SELECT rownum AS ID FROM dual connect BY level <= 1000);`

*请注意，如果这是依赖项，您需要确保该 ID 不引用任何其他外国 IDS。为了确保只有现有的 id 可用，然后：

`SELECT * FROM table1 WHERE ID IN (SELECT distinct(ID) FROM tablewhereidsareavailable);`

干杯

# css - 如何使用 css 绘制一个框，例如 stackoverflow 中的答案框？

> ID：400256
> 
> 赞同：1
> 
> 时间：2008-12-30T13:35:31.400
> 
> 标签：css

我怎样才能在css中画一个盒子？我想要一个像绿色的框，用于在stackoverflow中显示问题的答案数量？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T14:35:53.620

使用 Firebug 和“检查”功能；指向 SO 上的答案框并从 Firebug 控制台中提取 HTML 和 CSS。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T13:39:45.667

使用任何元素——例如 a `div`，确保它显示为块级元素（即`display: block`）并给它一个边框。

```
.box { border: 1px solid #088; font-size: 4em; }

<div class="box">6</div> 
```

效果很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T13:45:49.023

CSS：

```
.answerbox
{
height: 150px; /*Specify Height*/
width:  150px; /*Specify Width*/
border: 1px solid black; /*Add 1px solid border, use any color you want*/
background-color: green; /*Add a background color to the box*/
text-align:center; /*Align the text to the center*/
} 
```

HTML： `<div class="answerbox">4 <br /> Answers</div>`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:44:04.150

本页：[http ://www.w3.org/TR/CSS2/box.html](http://www.w3.org/TR/CSS2/box.html)

是通过 Google 搜索“css box”找到的第一页

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T14:53:51.773

您还可以使用 AIS 可访问性工具栏 - [http://www.visionaustralia.org.au/ais/toolbar/](http://www.visionaustralia.org.au/ais/toolbar/) - 在一大堆其他东西中公开用于网站的 css。

# c++ - 如何将类成员函数作为回调传递？

> ID：400257
> 
> 赞同：86
> 
> 时间：2008-12-30T13:35:35.207
> 
> 标签：c++, callback, function-pointers, c++03

我正在使用一个 API，它要求我将函数指针作为回调传递。我正在尝试在我的课堂上使用这个 API，但我遇到了编译错误。

这是我从构造函数中所做的：

```
m_cRedundencyManager->Init(this->RedundencyManagerCallBack); 
```

这不会编译 - 我收到以下错误：

> 错误 8 错误 C3867：'CLoggersInfra::RedundencyManagerCallBack'：函数调用缺少参数列表；使用 '&CLoggersInfra::RedundencyManagerCallBack' 创建指向成员的指针

我尝试了使用的建议`&CLoggersInfra::RedundencyManagerCallBack`- 对我不起作用。

对此有任何建议/解释吗？

我正在使用VS2008。

谢谢！！

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2008-12-31T05:52:30.930

这是一个简单的问题，但答案却出奇地复杂。`std::bind1st`简短的回答是你可以用or做你想做的事情`boost::bind`。更长的答案如下。

编译器正确建议您使用`&CLoggersInfra::RedundencyManagerCallBack`. 首先，如果`RedundencyManagerCallBack`是成员函数，则函数本身不属于该类的任何特定实例`CLoggersInfra`。它属于类本身。如果您以前曾经调用过静态类函数，您可能已经注意到您使用了相同的`SomeClass::SomeMemberFunction`语法。由于函数本身在属于类而不是特定实例的意义上是“静态的”，因此您使用相同的语法。'&' 是必要的，因为从技术上讲，您不直接传递函数——函数不是 C++ 中的真实对象。相反，从技术上讲，您是在传递函数的内存地址，即指向函数指令在内存中开始位置的指针。结果是一样的，你实际上是'

但这只是本例中问题的一半。正如我所说，`RedundencyManagerCallBack`该函数不“属于”任何特定实例。但听起来你想将它作为回调传递给一个特定的实例。要了解如何做到这一点，您需要了解真正的成员函数：具有额外隐藏参数的常规未定义在任何类中的函数。

例如：

```
class A {
public:
    A() : data(0) {}
    void foo(int addToData) { this->data += addToData; }

    int data;
};

...

A an_a_object;
an_a_object.foo(5);
A::foo(&an_a_object, 5); // This is the same as the line above!
std::cout << an_a_object.data; // Prints 10! 
```

需要多少参数`A::foo`？通常我们会说 1。但实际上， foo 确实需要 2。查看 A::foo 的定义，它需要 A 的特定实例才能使 'this' 指针有意义（编译器需要知道 '这是）。您通常指定您想要的“this”的方式是通过语法`MyObject.MyMemberFunction()`。但这只是将地址`MyObject`作为第一个参数传递给`MyMemberFunction`. 同样，当我们在类定义中声明成员函数时，我们不会将“this”放在参数列表中，但这只是语言设计者为节省输入而提供的礼物。相反，您必须指定成员函数是静态的，才能自动选择退出它，并自动获取额外的“this”参数。如果 C++ 编译器将上面的例子翻译成 C 代码（原来的 C++ 编译器实际上是这样工作的），它可能会写成这样：

```
struct A {
    int data;
};

void a_init(A* to_init)
{
    to_init->data = 0;
}

void a_foo(A* this, int addToData)
{ 
    this->data += addToData;
}

...

A an_a_object;
a_init(0); // Before constructor call was implicit
a_foo(&an_a_object, 5); // Used to be an_a_object.foo(5); 
```

回到你的例子，现在有一个明显的问题。'Init' 需要一个指向带有一个参数的函数的指针。但是`&CLoggersInfra::RedundencyManagerCallBack`是一个指向带有两个参数的函数的指针，它是普通参数和秘密“this”参数。这就是为什么您仍然会遇到编译器错误的原因（作为旁注：如果您曾经使用过 Python，那么这种混淆就是为什么所有成员函数都需要一个 'self' 参数）。

处理此问题的详细方法是创建一个特殊对象，该对象包含一个指向所需实例的指针，并具有一个名为“run”或“execute”（或重载“（）”运算符）的成员函数，它接受参数对于成员函数，只需在存储的实例上使用这些参数调用成员函数。但这需要您更改“Init”以获取您的特殊对象而不是原始函数指针，并且听起来 Init 是其他人的代码。每次出现这个问题时都创建一个特殊的类会导致代码膨胀。

所以现在，最后，好的解决方案，`boost::bind`以及`boost::function`每个你可以在这里找到的文档：

[boost::bind 文档](http://www.boost.org/doc/libs/1_37_0/libs/bind/bind.html)， [boost::function 文档](http://www.boost.org/doc/libs/1_37_0/doc/html/function/tutorial.html)

`boost::bind`将让您获取一个函数和该函数的参数，并在该参数被“锁定”到位的位置创建一个新函数。因此，如果我有一个将两个整数相加的函数，我可以使用它`boost::bind`来创建一个新函数，其中一个参数被锁定为 5。这个新函数将只接受一个整数参数，并且总是专门添加 5。使用这种技术，您可以将隐藏的“this”参数“锁定”为特定的类实例，并生成一个只接受一个参数的新函数，就像您想要的那样（注意隐藏参数始终是*第一个*参数，正常参数依次排列）。看着那（这`boost::bind`文档作为示例，他们甚至专门讨论了将其用于成员函数。从技术上讲，有一个标准函数`[std::bind1st][3]`，您也可以使用它，但`boost::bind`更通用。

当然，还有一个问题。`boost::bind`将为您提供一个很好的 boost::function ，但这在技术上仍然不是像 Init 可能想要的原始函数指针。值得庆幸的是，boost 提供了一种将 boost::function 转换为原始指针的方法，如 StackOverflow[中](https://stackoverflow.com/questions/282372/demote-boostfunction-to-a-plain-function-pointer)所述。它如何实现这一点超出了这个答案的范围，尽管它也很有趣。

如果这看起来很难，请不要担心——您的问题与 C++ 的几个较暗的角落相交，并且`boost::bind`一旦您学习它就会非常有用。

`boost::bind`C++11 更新：您现在可以使用捕获“this”的 lambda 函数代替。这基本上是让编译器为您生成相同的东西。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2008-12-30T13:55:10.410

这不起作用，因为成员函数指针不能像普通函数指针那样处理，因为它需要一个“this”对象参数。

相反，您可以按如下方式传递静态成员函数，这在这方面类似于普通的非成员函数：

```
m_cRedundencyManager->Init(&CLoggersInfra::Callback, this); 
```

函数可以定义如下

```
static void Callback(int other_arg, void * this_pointer) {
    CLoggersInfra * self = static_cast<CLoggersInfra*>(this_pointer);
    self->RedundencyManagerCallBack(other_arg);
} 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2017-08-05T18:16:05.420

此答案是对上述评论的回复，不适用于 VisualStudio 2008，但应优先用于更新的编译器。

* * *

同时，您不必再使用 void 指针，也不需要 boost，因为[`std::bind`](http://en.cppreference.com/w/cpp/utility/functional/bind)和[`std::function`](http://en.cppreference.com/w/cpp/utility/functional/function)可用。*一个*优点（与 void 指针相比）是类型安全，因为返回类型和参数是使用 显式声明的`std::function`：

```
// std::function<return_type(list of argument_type(s))>
void Init(std::function<void(void)> f); 
```

然后您可以创建函数指针`std::bind`并将其传递给 Init：

```
auto cLoggersInfraInstance = CLoggersInfra();
auto callback = std::bind(&CLoggersInfra::RedundencyManagerCallBack, cLoggersInfraInstance);
Init(callback); 
```

使用`std::bind`成员、静态成员和非成员函数的[完整示例：](http://coliru.stacked-crooked.com/a/860dd7e0bb98502d)

```
#include <functional>
#include <iostream>
#include <string>

class RedundencyManager // incl. Typo ;-)
{
public:
    // std::function<return_type(list of argument_type(s))>
    std::string Init(std::function<std::string(void)> f) 
    {
        return f();
    }
};

class CLoggersInfra
{
private:
    std::string member = "Hello from non static member callback!";

public:
    static std::string RedundencyManagerCallBack()
    {
        return "Hello from static member callback!";
    }

    std::string NonStaticRedundencyManagerCallBack()
    {
        return member;
    }
};

std::string NonMemberCallBack()
{
    return "Hello from non member function!";
}

int main()
{
    auto instance = RedundencyManager();

    auto callback1 = std::bind(&NonMemberCallBack);
    std::cout << instance.Init(callback1) << "\n";

    // Similar to non member function.
    auto callback2 = std::bind(&CLoggersInfra::RedundencyManagerCallBack);
    std::cout << instance.Init(callback2) << "\n";

    // Class instance is passed to std::bind as second argument.
    // (heed that I call the constructor of CLoggersInfra)
    auto callback3 = std::bind(&CLoggersInfra::NonStaticRedundencyManagerCallBack,
                               CLoggersInfra()); 
    std::cout << instance.Init(callback3) << "\n";
} 
```

可能的输出：

```
Hello from non member function!
Hello from static member callback!
Hello from non static member callback! 
```

此外，[`std::placeholders`](http://en.cppreference.com/w/cpp/utility/functional/placeholders)您可以动态地将参数传递给回调（例如，如果 f 具有字符串参数，则可以使用`return f("MyString");`in ）。`Init`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-30T13:38:17.043

需要什么论据`Init`？新的错误信息是什么？

C++ 中的方法指针有点难以使用。除了方法指针本身，您还需要提供一个实例指针（在您的情况下`this`）。也许`Init`期望它作为一个单独的论点？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-30T13:47:38.443

`m_cRedundencyManager`可以使用成员函数吗？大多数回调设置为使用常规函数或静态成员函数。请查看C++ FAQ Lite 中的[此页面以获取更多信息。](http://www.parashift.com/c++-faq-lite/pointers-to-members.html)

**更新：**您提供的函数声明显示需要`m_cRedundencyManager`以下形式的函数：`void yourCallbackFunction(int, void *)`。因此，在这种情况下，成员函数作为回调是不可接受的。静态成员函数*可能会*起作用，但如果这在您的情况下是不可接受的，那么以下代码也可以使用。请注意，它使用来自`void *`.

```
 // in your CLoggersInfra constructor:
m_cRedundencyManager->Init(myRedundencyManagerCallBackHandler, this); 
```

```
 // in your CLoggersInfra header:
void myRedundencyManagerCallBackHandler(int i, void * CLoggersInfraPtr); 
```

```
 // in your CLoggersInfra source file:
void myRedundencyManagerCallBackHandler(int i, void * CLoggersInfraPtr)
{
    ((CLoggersInfra *)CLoggersInfraPtr)->RedundencyManagerCallBack(i);
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-30T13:47:43.327

指向类成员函数的指针与指向函数的指针不同。类成员接受一个隐式的额外参数（*this*指针），并使用不同的调用约定。

如果您的 API 需要一个非成员回调函数，那么您必须将其传递给它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-03-27T17:49:17.727

死灵术。
我认为迄今为止的答案有点不清楚。

让我们举个例子：

假设您有一个像素数组（ARGB int8_t 值数组）

```
// A RGB image
int8_t* pixels = new int8_t[1024*768*4]; 
```

现在您要生成 PNG。为此，您调用函数 toJpeg

```
bool ok = toJpeg(writeByte, pixels, width, height); 
```

其中 writeByte 是一个回调函数

```
void writeByte(unsigned char oneByte)
{
    fputc(oneByte, output);
} 
```

这里的问题： FILE* 输出必须是全局变量。
如果您在多线程环境中（例如 http 服务器），那就太糟糕了。

因此，您需要某种方法使输出成为非全局变量，同时保留回调签名。

想到的直接解决方案是闭包，我们可以使用具有成员函数的类来模拟它。

```
class BadIdea {
private:
    FILE* m_stream;
public:
    BadIdea(FILE* stream)  {
        this->m_stream = stream;
    }

    void writeByte(unsigned char oneByte){
            fputc(oneByte, this->m_stream);
    }

}; 
```

然后做

```
FILE *fp = fopen(filename, "wb");
BadIdea* foobar = new BadIdea(fp);

bool ok = TooJpeg::writeJpeg(foobar->writeByte, image, width, height);
delete foobar;
fflush(fp);
fclose(fp); 
```

然而，出乎意料的是，这行不通。

原因是，C++ 成员函数的实现有点像 C# 扩展函数。

所以你有了

```
class/struct BadIdea
{
    FILE* m_stream;
} 
```

和

```
static class BadIdeaExtensions
{
    public static writeByte(this BadIdea instance, unsigned char oneByte)
    {
         fputc(oneByte, instance->m_stream);
    }

} 
```

所以当你要调用writeByte时，你不仅需要传递writeByte的地址，还要传递BadIdea-instance的地址。

所以当你有一个 writeByte 过程的 typedef 时，它看起来像这样

```
typedef void (*WRITE_ONE_BYTE)(unsigned char); 
```

你有一个看起来像这样的 writeJpeg 签名

```
bool writeJpeg(WRITE_ONE_BYTE output, uint8_t* pixels, uint32_t 
 width, uint32_t height))
    { ... } 
```

从根本上讲，将双地址成员函数传递给单地址函数指针（不修改 writeJpeg）是不可能的，也没有办法绕过它。

在 C++ 中可以做的下一件最好的事情是使用 lambda 函数：

```
FILE *fp = fopen(filename, "wb");
auto lambda = [fp](unsigned char oneByte) { fputc(oneByte, fp);  };
bool ok = TooJpeg::writeJpeg(lambda, image, width, height); 
```

但是，由于 lambda 与将实例传递给隐藏类（例如“BadIdea”类）没有什么不同，因此您需要修改 writeJpeg 的签名。

lambda 相对于手动类的优点是您只需要更改一个 typedef

```
typedef void (*WRITE_ONE_BYTE)(unsigned char); 
```

到

```
using WRITE_ONE_BYTE = std::function<void(unsigned char)>; 
```

然后你可以保持其他一切不变。

你也可以使用 std::bind

```
auto f = std::bind(&BadIdea::writeByte, &foobar); 
```

但这在幕后只是创建了一个 lambda 函数，然后还需要更改 typedef。

所以不，没有办法将成员函数传递给需要静态函数指针的方法。

但是 lambda 是一种简单的方法，前提是您可以控制源。
否则，你就不走运了。
你不能用 C++ 做任何事情。

**注意：**
std::function 需要`#include <functional>`

但是，由于 C++ 也允许您使用 C ，如果您不介意链接依赖项，则可以使用纯 C 中的[libffcall来执行此操作。](https://savannah.gnu.org/projects/libffcall/)

从 GNU 下载 libffcall（至少在 ubuntu 上，不要使用发行版提供的包 - 它已损坏），解压缩。

```
./configure
make
make install

gcc main.c -l:libffcall.a -o ma 
```

主.c：

```
#include <callback.h>

// this is the closure function to be allocated 
void function (void* data, va_alist alist)
{
     int abc = va_arg_int(alist);

     printf("data: %08p\n", data); // hex 0x14 = 20
     printf("abc: %d\n", abc);

     // va_start_type(alist[, return_type]);
     // arg = va_arg_type(alist[, arg_type]);
     // va_return_type(alist[[, return_type], return_value]);

    // va_start_int(alist);
    // int r = 666;
    // va_return_int(alist, r);
}

int main(int argc, char* argv[])
{
    int in1 = 10;

    void * data = (void*) 20;
    void(*incrementer1)(int abc) = (void(*)()) alloc_callback(&function, data);
    // void(*incrementer1)() can have unlimited arguments, e.g. incrementer1(123,456);
    // void(*incrementer1)(int abc) starts to throw errors...
    incrementer1(123);
    // free_callback(callback);
    return EXIT_SUCCESS;
} 
```

如果你使用 CMake，请在 add_executable 之后添加链接器库

```
add_library(libffcall STATIC IMPORTED)
set_target_properties(libffcall PROPERTIES
        IMPORTED_LOCATION /usr/local/lib/libffcall.a)
target_link_libraries(BitmapLion libffcall) 
```

或者你可以动态链接 libffcall

```
target_link_libraries(BitmapLion ffcall) 
```

注意：
您可能想要包含 libffcall 头文件和库，或者使用 libffcall 的内容创建一个 cmake 项目。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-11-03T01:08:45.470

一个简单的“解决方法”仍然是创建一个虚函数类“接口”并在调用者类中继承它。然后将它作为参数“可能在构造函数中”传递给您想要回调调用者类的另一个类。

定义接口：

```
class CallBack 
{
   virtual callMeBack () {};
}; 
```

这是您要回电的课程：

```
class AnotherClass ()
{
     public void RegisterMe(CallBack *callback)
     {
         m_callback = callback;
     }

     public void DoSomething ()
     {
        // DO STUFF
        // .....
        // then call
        if (m_callback) m_callback->callMeBack();
     }
     private CallBack *m_callback = NULL;
}; 
```

这是将被回调的类。

```
class Caller : public CallBack
{
    void DoSomthing ()
    {
    }

    void callMeBack()
    {
       std::cout << "I got your message" << std::endl;
    }
}; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-30T13:47:03.670

我可以看到 init 具有以下覆盖：

```
Init(CALLBACK_FUNC_EX callback_func, void * callback_parm) 
```

`CALLBACK_FUNC_EX`在哪里

```
typedef void (*CALLBACK_FUNC_EX)(int, void *); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-30T13:51:34.050

[C++ FAQ Lite](https://isocpp.org/wiki/faq)中的这个[问题和答案](https://isocpp.org/wiki/faq/pointers-to-members#memfnptr-vs-fnptr)涵盖了您的问题以及我认为答案中涉及的考虑因素。我链接的网页的简短片段：

> 不。
> 
> 因为成员函数没有对象来调用它是没有意义的，所以你不能直接这样做（如果 X Window System 是用 C++ 重写的，它可能会传递对对象的引用，而不仅仅是指向函数的指针；自然是对象将体现所需的功能，可能还有更多）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-05-08T21:16:51.333

*指向非静态成员函数*的指针的类型不同于*指向普通函数*的指针。
类型是`void(*)(int)`普通*成员*函数还是*静态*成员函数。
类型是`void(CLoggersInfra::*)(int)`如果它是一个*非静态*成员函数。
因此，如果需要普通函数指针，则不能将指针传递给非静态成员函数。

此外，非静态成员函数具有对象的隐式/隐藏参数。指针作为`this`参数隐式传递给成员函数调用。所以成员函数*只能*通过提供一个对象来调用。

`Init` *如果无法*更改API ，则可以使用调用该成员的包装函数（普通函数或类静态成员函数）。在最坏的情况下，该对象将是一个供包装器函数访问的全局对象。

```
CLoggersInfra* pLoggerInfra;

RedundencyManagerCallBackWrapper(int val)
{
    pLoggerInfra->RedundencyManagerCallBack(val);
} 
```

```
m_cRedundencyManager->Init(RedundencyManagerCallBackWrapper); 
```

如果 API`Init` *可以*更改，则有许多替代方案 - Object 非静态成员函数指针、Function Object`std::function`或 Interface Function。

[有关C++ 工作示例](https://github.com/cognitivewaves/cpp-examples/tree/master/callbacks)的不同变体，请参阅有关[回调](https://cognitivewaves.wordpress.com/callbacks/)的帖子。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-02-20T13:05:03.663

将 C 风格的回调函数与 C++ 类实例连接起来仍然很困难。我想改写一下原来的问题：

*   您正在使用的某些库需要从该库回调的 C 样式函数。更改库 API 是不可能的，因为它不是*您的*API。

*   您希望在您自己的 C++ 代码中的成员方法中处理回调

由于您没有（确切地）提到您要处理的回调，我将举一个使用[GLFW 回调进行键输入](https://www.glfw.org/docs/3.3/group__input.html#ga1caf18159767e761185e49a3be019f8d)的示例。（附带说明：我知道 GLFW 提供了一些其他机制来将用户数据附加到他们的 API，但这不是这里的主题。）

我不知道任何不包括使用某种静态对象的解决方案。让我们看看我们的选择：

**简单方法：使用 C 风格的全局对象**

正如我们总是在类和实例中思考的那样，我们有时会忘记在 C++ 中我们仍然拥有整个 C 库。所以有时这个非常简单的解决方案不会出现在脑海中。

假设我们有一个类*Presentation*应该处理键盘输入。这可能看起来像这样：

```
struct KeyInput {
    int pressedKey;
} KeyInputGlobal;

void globalKeyHandler(GLFWwindow* window, int key, int scancode, int action, int mods) {
    KeyInputGlobal.pressedKey = key;
}

int Presentation::getCurrentKey()
{
    return KeyInputGlobal.pressedKey;
}

void Presentation::initGLFW()
{
    glfwInit();
    glfwSetKeyCallback(window, globalKeyHandler);
} 
```

我们有一个全局对象*KeyInputGlobal*应该接收按下的键。函数*globalKeyHandler*具有 GLFW 库所需的 C 样式 API 签名，以便能够调用我们的代码。它在我们的成员方法*initGLFW*上被激活。如果在我们的代码中的任何地方我们对当前按下的键感兴趣，我们可以调用另一个成员方法*Presentation::getCurrentKey*

这种方法有什么问题？

也许一切都好。完全取决于您的用例。也许您完全可以在应用程序代码中的某处读取最后按下的键。您不在乎错过按键事件。简单的方法就是您所需要的。

概括一下：如果您能够在 C 风格的代码中完全处理回调，计算一些结果并将其存储在一个全局对象中，以便稍后从代码的其他部分读取，那么使用这种简单的方法确实是有意义的。从好的方面来说：这很容易理解。不足之处？感觉有点像作弊，因为你并没有真正处理你的 C++ 代码中的回调，你只是使用了结果。如果您将回调视为一个事件并希望在您的成员方法中正确处理每个事件，则此方法是不够的。

**另一种简单的方法：使用 C++ 静态对象**

我想我们中的许多人已经这样做了。我当然有。思考：等等，我们有一个 C++ 的全局概念，即使用*static*。但是我们可以在这里保持简短的讨论：它可能比使用前面示例中的 C 风格更具 C++ 风格，但问题是相同的 - 我们仍然有全局变量，很难将其与非静态的常规成员方法结合在一起. 为了完整起见，在我们的类声明中它看起来像这样：

```
class Presentation
{
public:
    struct KeyInput {
        int pressedKey;
    };
    static KeyInput KeyInputGlobal;

    static void globalKeyHandler(GLFWwindow* window, int key, int scancode, int action, int mods) {
        KeyInputGlobal.pressedKey = key;
    }
    int getCurrentKey()
    {
        return KeyInputGlobal.pressedKey;
    }
...
} 
```

激活我们的回调看起来是一样的，但我们还必须定义接收在我们的实现中按下的键的静态结构：

```
void Presentation::initGLFW()
{
    glfwInit();
    glfwSetKeyCallback(window, globalKeyHandler);
}
//static
Presentation::KeyInput Presentation::KeyInputGlobal; 
```

您可能倾向于从我们的回调方法*globalKeyHandler中删除**static*关键字：编译器会立即告诉您，您不能再将其传递给*glfwSetKeyCallback()*中的 GLFW 。现在，如果我们只能以某种方式将静态方法与常规方法连接起来......

 ****使用静态和 lambda 的 C++11 事件驱动方法**

我能找到的最佳解决方案如下。它可以工作并且有点优雅，但我仍然认为它并不完美。让我们看一下并讨论：

```
void Presentation::initGLFW()
{
    glfwInit();
    static auto callback_static = [this](
           GLFWwindow* window, int key, int scancode, int action, int mods) {
        // because we have a this pointer we are now able to call a non-static member method:
        key_callbackMember(window, key, scancode, action, mods);
    };
    glfwSetKeyCallback(window,
    [](GLFWwindow* window, int key, int scancode, int action, int mods)
      {
        // only static methods can be called here as we cannot change glfw function parameter list to include instance pointer
        callback_static(window, key, scancode, action, mods);
      }
    );
}

void Presentation::key_callbackMember(GLFWwindow* window, int key, int scancode, int action, int mods)
{
    // we can now call anywhere in our code to process the key input:
    app->handleInput(key, action);
} 
```

*callback_static*的定义是我们将静态对象与实例数据连接起来，在这种情况下，*这*是我们的*Presentation*类的一个实例。您可以阅读定义如下：如果在此定义之后的任何时间*调用callback_static*，所有参数都将传递给刚刚使用的*Presentation*实例调用的成员方法*key_callbackMember 。*这个定义与 GLFW 库没有任何关系——它只是为下一步做准备。

 *我们现在使用第二个 lambda 向*glfwSetKeyCallback()*中的库注册我们的回调。同样，如果*callback_static*没有被定义为*静态*，我们不能在这里将它传递给 GLFW。

当 GLFW 调用我们的代码时，这是在所有初始化之后在运行时发生的情况：

1.  GLFW 识别一个关键事件并调用我们的静态对象*callback_static*
2.  *callback_static*可以访问*Presentation*类的实例并调用它的实例方法*key_callbackMember*
3.  现在我们处于“对象世界”中，我们可以在其他地方处理关键事件。在这种情况下，我们在某个任意对象*app上调用方法**handleInput*，该对象已在我们代码的其他地方设置。

 *好处：我们已经实现了我们想要的，无需在初始化方法*initGLFW*之外定义全局对象。不需要 C 风格的全局变量。

坏处：不要仅仅因为所有东西都整齐地包装在一种方法中而被愚弄。我们**仍然**有静态对象。与它们一起出现的所有问题都是全局对象所具有的。例如，多次调用我们的初始化方法（使用不同的*Presentation*实例）可能不会达到您想要的效果。

**概括**

可以将现有库的 C 样式回调连接到您自己代码中的类实例。您可以尝试通过在代码的成员方法中定义必要的对象来最小化管理代码。但是对于每个回调，您仍然需要一个静态对象。如果你想用 C 风格的回调连接你的 C++ 代码的几个实例，准备好引入比上面的例子更复杂的静态对象管理。

希望这可以帮助某人。快乐编码。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2020-06-03T18:04:45.863

看起来[`std::mem_fn`](https://en.cppreference.com/w/cpp/utility/functional/mem_fn)(C++11) 完全符合您的需要：

> 函数模板 std::mem_fn 为指向成员的指针生成包装对象，它可以存储、复制和调用指向成员的指针。调用 std::mem_fn 时可以使用对对象的引用和指针（包括智能指针）。

# ruby-on-rails - 在 Ruby On Rails 中使用 session_id 检索会话？

> ID：400274
> 
> 赞同：1
> 
> 时间：2008-12-30T13:42:03.727
> 
> 标签：ruby-on-rails, session

我想从与我发起会话的域不同的域访问用户的会话。我可以使用用户的 session.session_id 然后检索该用户的会话哈希吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T20:16:48.173

如果它位于不同的域（即，不是子域）上，则无法获取会话信息（因为它存储在 cookie 中）——您需要其他信息（请参阅[此问题](https://stackoverflow.com/questions/377137/rails-multiple-top-level-domains-and-a-single-session-cookie#378072)）。如果它是子域，我认为有一种巧妙的方法可以通过设置 cookie 的域来自动完成（查看 environment.rb's `config.action_controller.session`，尝试设置`:session_domain`）

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-30T19:47:25.767

看起来你可以使用类似的东西：

```
CGI::Session::ActiveRecordStore::SqlBypass::find_by_session_id(session_id) 
```

但是，我不确定这是否是个好主意——在这种情况下，它仅在您使用 ActiveRecordStore 时才有用。不确定其他商店还有什么可用的，但是如果您在 actionpack/lib/action_controller/session/* 下四处逛逛，您可能会得到更明确的答案。

# regex - 正则表达式空格与。蚀

> ID：400276
> 
> 赞同：0
> 
> 时间：2008-12-30T13:44:45.140
> 
> 标签：regex, eclipse, regexbuddy

我正在尝试制作一个正则表达式来匹配空格，到目前为止我正在这样做：

```
Powered[\s]*[bB]y.*MyBB 
```

我知道它应该可以工作，因为我已经用 Regex Buddy 尝试过它并且它说它可以，但是当我尝试用 Eclipse 运行它时，它会标记一个错误，说它不是一个有效的转义序列，它会自动添加 2 '\' 渲染正则表达式没用....有人可以告诉我该怎么做吗？到目前为止，我最终使用了一个点而不是 \s，但我真正需要的是 \s ...

谢谢

* * *

*补充*：

好吧，我理解但是，我虽然 ' `\s`' 用于任何空白字符，正如我所说，Regex Buddy 也可以识别它，如果我使用 ' `\s`' 它在 Regex Buddy 中无法识别，因此测试失败，但在 eclipse它允许我继续，即使它什么都不匹配...... =/或者我没有得到什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T13:58:23.007

'\' 标识 java 中的转义字符，因此如果要单独使用它，则需要对其进行转义。（\t 是制表符，\n 是换行符等）要转义它，您需要添加 1 '\' 而不是 2。

这是一些可以解决问题的Java代码：

```
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.junit.Assert;
import org.junit.Test;

public class RegexTest {
    @Test
    public void testPatternWithWhiteSpace(){
        Pattern pattern = Pattern.compile("Powered\\s*[bB]y.*MyBB");
        Matcher matcher = pattern.matcher("Powered     By     MyBB");
        Assert.assertTrue(matcher.matches());
        matcher = pattern.matcher("Powered_By     MyBB");
        Assert.assertFalse(matcher.matches());
    }
} 
```

您不必将空格“标记”(\s) 放在字符集 ([]) 中。

你是对的， \s 是任何空格。

正则表达式伙伴需要输入，因为正则表达式实际上是编写的，需要转义 eclipse/源代码中的文字字符串表达式。如果您要从属性文件中读取模式，则无需转义它。

> 正如我所说，Regex Buddy 也可以识别它，如果我使用 \s 它在 Regex Buddy 中不会被识别，因此测试失败

我假设你的意思是日食失败的地方？只需将这些行添加到测试中，也许这可以解释更多：

```
 matcher = pattern.matcher("Powered\t\n\r By     MyBB");
        Assert.assertTrue(matcher.matches());
        matcher = pattern.matcher("Powered\t\n\r ,By     MyBB");
        Assert.assertFalse(matcher.matches()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T07:36:48.287

在 Eclipse 中使用正则表达式到底是什么意思？您是要在 IDE 中进行搜索和替换，还是要在 Java 代码中使用正则表达式？

如果您想在 Java 代码中使用正则表达式，请在 RegexBuddy 的“使用”选项卡上生成 Java 源代码片段，然后将其粘贴到您的代码中。

如果您想让正则表达式单独准备好粘贴到 Java 代码中，请在 RegexBuddy 顶部的工具栏中选择 Java 风格。然后单击复制按钮，并选择将正则表达式复制为 Java 字符串。然后，RegexBuddy 会将您的正则表达式复制到剪贴板，并将其正确格式化为 Java 字符串。您的正则表达式将被复制为：

```
"Powered[\\s]*[bB]y.*MyBB" 
```

使用 Java 字符串文字存储正则表达式时，额外的反斜杠是必不可少的。

PS：您可以使用 \s 代替 [\s]。节省两次击键。

# c# - BindingSource 按日期筛选

> ID：400283
> 
> 赞同：6
> 
> 时间：2008-12-30T13:49:05.367
> 
> 标签：c#, sql, filter, filtering

我想根据日期过滤数据库中的值。

数据库中的日期包含如下值：2008-12-28 18:00:00。我的班级有一个 DateTime 变量，具体取决于我要过滤的内容。理想情况下，它会像这样工作： `myBindingSource.Filter = "DATE(myDateField) = myDateTime.Date"`+ 根据需要调整 myDateTime.Date 格式。

但它会引发 EvaluateException：“表达式包含未定义的函数调用 DATE()。”

虽然如果我直接执行 SQL 语句，我可以在过滤器中使用 DATE() 函数。

PS 我使用 MYSQL DB 和 Connector/Net 5.2

我怎么解决这个问题？

谢谢大家的建议。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-12T06:56:18.557

不需要 getSqlDate 函数。您可以使用 String.Format() 格式化日期：

```
String.Format("{0:yyyy-MM-dd} 00:00:00", myDateTime) 
```

或者

```
myDateTime.Date.ToString("yyyy-MM-dd") + " 00:00:00" 
```

您可以像这样过滤绑定源：

```
myBindingSource.Filter = String.Format("myDateField >= '{0:yyyy-MM-dd}' AND myDateField < '{1:yyyy-MM-dd}'", myDateTime, myDateTime.AddDays(1)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T15:41:20.740

谢谢汤姆 H。

是的，我想消除过滤器中日期时间的时间部分，您的建议非常有效。

我将把完整的解决方案留给其他人：

```
myBindingSource.Filter = "myDateField >= '" + getSqlDate(myDateTime) + "' AND myDateField < '" + getSqlDate(myDateTime.AddDays(1)) + "'"; 
```

其中 getSqlDate 函数是：

```
string getSqlDate(DateTime date) {
    string year = "" + date.Year;
    string month = (date.Month < 10) ? "0" + date.Month : "" + date.Month;
    string day = (date.Day < 10) ? "0" + date.Day : "" + date.Day;

    return year + "-" + month + "-" + day + " 00:00:00";
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-30T08:05:43.653

对答案的更正：根据[msdn](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx) ，获取**mm**的正确日期

```
yyyy-mm-dd 
```

必须像这样大写；

```
yyyy-MM-dd 
```

获得格式正确的日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:12:15.087

myDateField 是数据集中字段的名称吗？我想你想要这样的表达：

```
myBindingSource.Filter = "myDateField = " & myDateTime.Date.ToString() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T14:34:44.713

您是否在问如何消除过滤器中日期时间的时间部分？我对 MySQL 不太熟悉，但如果您使用任何类型的函数来返回日期时间的日期部分，那么您很可能会扼杀在该列上使用索引进行查询（现有或未来索引）的任何机会。

您最好的选择是在前端创建一个过滤器，检查仅适用于您给定过滤器日期的范围。例如：

```
myBindingSource.Filter = "myDateField >= " & <code to create a string representing 12AM of your date> &
" myDateField < " & <code to create a string for 12AM of the next day> 
```

很抱歉没有确切的代码，但我是一名 SQL 开发人员，我缺乏 VB/C# 技能需要我花更多的时间来想出这些函数，然后它可能需要你。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-15T12:41:10.490

要在 DataGridView 中的两个日期之间进行搜索，您可以使用以下代码：

```
BindingSource1.Filter = "F5 >= '" + maskedTextBox1.Text + "' And " + "F5 <= '" + maskedTextBox2.Text + "'";

BindingSource1 : my datagridview datasourc load in BindingSource1 .
F5             : name of your header column in datagridview . 
maskedTextBox1 : for get first date .
maskedTextBox2 : for get second date . 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-15T12:45:57.500

要在 DataGridView 中的两个日期之间进行搜索，您可以使用以下代码：

```
BindingSource1.Filter = "F5 >= '" + maskedTextBox1.Text + "' And " + "F5 <= '" + maskedTextBox2.Text + "'"; 
```

BindingSource1 ：我的 datagridview 数据源加载到 BindingSource1 中。F5：datagridview 中标题列的名称。maskedTextBox1：用于获取第一个日期。maskedTextBox2：用于获取第二个日期。

成功“Arn_7”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-09-26T06:23:04.437

您将需要添加像“'2021-09-26'”这样的单引号。

```
myBindingSource.Filter = "myDateField = " + "'" + myDateTime.Date.ToString("yyyy-MM-dd") + "'" 
```

# algorithm - 寻求一种算法来有效地布局日历事件横幅

> ID：400288
> 
> 赞同：0
> 
> 时间：2008-12-30T13:51:51.540
> 
> 标签：algorithm, calendar, minimize

我正在寻找一种算法来有效地放置全天/多天事件横幅，就像 Outlook 或 Google 日历中的月视图一样。我有许多具有开始和结束日期的事件，按增加开始（然后结束）日期（或您喜欢的任何其他顺序，我正在从数据库表中收集事件）排序。我想尽量减少平均垂直空间的使用量，因为在事件横幅之后，我需要为当天放置其他事件（这些总是在给定日期的横幅之后）。因此，例如，如果我有两个事件，一个 1/10-1/11 和一个 1/11-1/15，我更愿意像这样安排它们（每一列是一天）：

```
 bbbbb
aa 
```

不喜欢：

```
aa
 bbbbb 
```

因为当我只添加当天的事件（x、y 和 z）时，我可以这样做（我更喜欢第一个，不想要第二个）：

```
 bbbbb    vs.    aa
aa xyz            bbbbb
                    xyz 
```

但这并不像将较长的事件放在首位那么简单，因为对于 1/10-1/11、1/13-1/14 和 1/11-1/13，我想要：

```
aa cc
 bbb 
```

相对于：

```
 bbb
aa cc 
```

因为这将允许事件 x 和 y：

```
aa cc    vs.     bbb
xbbby           aa cc
                x   y 
```

当然，我更愿意一次性完成。对于数据结构，我目前正在使用从日期到列表的映射，其中对于事件的每一天，我将事件添加到相应的列表中。因此，一个为期三天的事件出现在三个列表中，每个列表都位于地图中的某一天之下。这是将结果转换为可视输出的便捷结构，但我也对其他数据结构持开放态度。我目前正在使用贪婪算法，我只是按顺序添加每个事件，但这会产生不需要的伪影，例如：

```
aa ccc          
 bbbbb
    dd
     eeeeeeeeeeeeeeeee 
```

对于大多数“e”事件日，这会浪费*大量空间。*

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-31T21:34:34.083

这是一种可能解决方案的高级草图（使用星期几整数而不是完整的日期）。这个界面：

```
public interface IEvent {

    public abstract int getFirst();  // first day of event
    public abstract int getLast();   // last day of event
    public abstract int getLength(); // total number of days
    public abstract char getLabel(); // one-char identifier

    // true if this and that have NO days in common
    public abstract boolean isCompatible(IEvent that);

    // true if this is is compatible with all events
    public abstract boolean isCompatibleWith(Collection<IEvent> events);

} 
```

必须实现以使用以下方法中表达的算法`layout`。

此外，具体类必须实现`Comparable`创建一个自然顺序，其中较长的事件先于较短的事件。（我对下面演示的示例实现使用了长度降序，然后升序开始日期，然后升序标签。）

该`layout`方法采用`IEvent`实例集合并返回一个`Map`，它为演示文稿中的每一行分配可以在该行中显示的事件集。

```
public Map<Integer,Set<IEvent>> layout(Collection<IEvent> events) {
    Set<IEvent> remainingEvents = new TreeSet<IEvent>(events);
    Map<Integer,Set<IEvent>> result = new TreeMap<Integer,Set<IEvent>>();
    int day = 0;
    while (0 < remainingEvents.size()) {
        Set<IEvent> dayEvents = new TreeSet<IEvent>();
        for(IEvent e : remainingEvents) {
            if (e.isCompatibleWith(dayEvents)) {
                dayEvents.add(e);
            }
        }
        remainingEvents.removeAll(dayEvents);
        result.put(day, dayEvents);
        ++day;
    }
    return result;
} 
```

通过选择最长的剩余事件并逐步选择与当前行的先前选择的事件兼容的所有附加事件（按上述顺序）组成每一行。效果是所有事件都尽可能向上“浮动”而不会发生碰撞。

以下演示显示了您问题中的两个场景，以及一组随机创建的事件。

```
Event collection:
    x(1):4
    b(5):2..6
    y(1):5
    a(2):1..2
    z(1):6
Result of layout:
    0 -> {b(5):2..6}
    1 -> {a(2):1..2, x(1):4, y(1):5, z(1):6}
Visual presentation:
      bbbbb
     aa xyz

Event collection:
    x(1):1
    b(3):2..4
    a(2):1..2
    c(2):4..5
    y(1):5
Result of layout:
    0 -> {b(3):2..4, x(1):1, y(1):5}
    1 -> {a(2):1..2, c(2):4..5}
Visual presentation:
     xbbby 
     aa cc 

Event collection:
    f(2):1..2
    h(2):1..2
    d(4):1..4
    e(4):2..5
    c(1):6
    a(2):5..6
    g(4):2..5
    b(2):0..1
Result of layout:
    0 -> {d(4):1..4, a(2):5..6}
    1 -> {e(4):2..5, b(2):0..1, c(1):6}
    2 -> {g(4):2..5}
    3 -> {f(2):1..2}
    4 -> {h(2):1..2}
Visual presentation:
     ddddaa
    bbeeeec
      gggg 
     ff    
     hh 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T14:50:32.950

我认为在这种情况下，最好先确保数据组织正确，然后再进行渲染。我知道你想要一次通过，但我认为结果会好很多。

例如，将数据组织到特定日期所需的行中，并以最佳方式组织事件，从最长的事件开始（不需要先显示，但确实需要组织首先）并向下移动到最短的事件。这将允许您相应地呈现您的输出而不浪费任何空间，并避免那些“e”事件日。此外，然后：

```
 bbb
aa cc 
```

或者

```
aa cc
 bbb 
```

无关紧要，因为`x`and`y`总是可以在 and 的任何一侧，`bbb`甚至在`aa`and之间`cc`

我希望你觉得这有帮助。

# asp.net - 对 Web 应用程序 (ASP.NET) 上的间歇性故障进行故障排除

> ID：400294
> 
> 赞同：0
> 
> 时间：2008-12-30T13:55:17.710
> 
> 标签：asp.net, windows, iis-7, windows-server-2003

收到有关 Web 应用程序在三周内出现两次故障的报告。需要做一些根本原因分析。重启后工作正常。我不是这个领域的专家。

它托管在 IIS 和 Windows 2003 上。

事件查看器中没有什么有趣的东西，IIS 日志只是显示了许多成功的`GET`操作。它连接到的远程 SQL 服务器上的 SQL 日志中没有任何有趣的内容。

我不确定如何破译 IIS 日志。它看起来就像一堆`GET`没有错误的成功消息。

我认为通过根本原因分析追踪问题的原因，我真的不能走得更远？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T01:47:28.147

您唯一可以尝试获得一些实际结果的是 Tess Ferrandez 的这篇出色的[博客](http://blogs.msdn.com/tess/)。我认为您会发现[崩溃实验室](http://blogs.msdn.com/tess/archive/2008/02/08/net-debugging-demos-lab-2-crash.aspx)非常有启发性:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T15:09:18.903

Depending on your traffic, twice in three weeks doesn't sound like a lot. The root cause may relate to the fix- if you were able to bring it back up by restarting IIS, it could be a memory leak. If you had to restart the server, it could be a deeper problem.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T14:29:27.283

看看[这个](http://weblogs.asp.net/scottgu/archive/2005/12/14/433194.aspx)，它可能会帮助您找到应用程序关闭的原因。

# iphone - 有没有一种简单的方法可以为 iPhone 开发人员使用 Web 服务？

> ID：400299
> 
> 赞同：3
> 
> 时间：2008-12-30T13:57:05.727
> 
> 标签：iphone, xml

我们想要获取 XML 数据并将其转换为 NSDictionary 对象，但我们不想手动迭代 XML。是否有捷径可寻？您如何为您的 iPhone 应用程序提供网络服务？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T14:03:10.033

如果您可以控制服务器输出，请尝试使用 plist。否则，您将无法解析 XML（或 JSON，如果服务器可以这样做），但您可以使用一些框架。[请参阅此问题](https://stackoverflow.com/questions/365868/what-is-the-best-approach-for-building-an-iphone-client-for-a-rails-app)的答案。

此外，这里很好地概述了如何在 iphone 上执行 RESTful 客户端：

[https://developer.apple.com/webapps/articles/creatingrestfulclients.html](https://web.archive.org/web/20090119082131/http://developer.apple.com/webapps/articles/creatingrestfulclients.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T14:24:28.977

如果您可以控制 XML 输出，则可以尝试创建一个属性列表，然后您可以使用 -dictionaryWithContentsOfURL: 将其读入字典：（尽管更好的异步方法是使用 NSURLConnection 获取数据，然后使用 - NSString 上的 propertyList 方法）。您可以在此处找到有关属性列表的更多信息：http: [//developer.apple.com/documentation/Cocoa/Conceptual/PropertyLists/Introduction/chapter_1_section_1.html](http://developer.apple.com/documentation/Cocoa/Conceptual/PropertyLists/Introduction/chapter_1_section_1.html)

当然最好的解决方案是使用 RESTful 客户端并结合使用 NSURLConnection 来获取/发送数据和 TouchXML 类 ( [http://code.google.com/p/touchcode/wiki/TouchXML](http://code.google.com/p/touchcode/wiki/TouchXML) ) 来解析数据，尽管这需要更多的工作才能将数据放入字典中。当然，如果这些将成为您系统中的主要数据对象，您真的希望使用自定义类或 SQLite 来存储数据，因为它在测试应用程序时比字典提供了更高的可靠性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T11:49:16.343

您可以返回 JSON 格式的数据。iPhone 上有许多可用的开源 JSON 解析器（TouchJSON 就是其中之一）。

还有一个名为 NSPropertyListSerialization 的类可用，它可以从数据中获取字典。

你可以用你收到的数据做这样的事情

NSDictionary* 属性列表；
NSPropertyListFormat 格式；
NSString *errorStr;

propertyList = [NSPropertyListSerialization
propertyListFromData:receivedData
mutabilityOption: NSPropertyListImmutable
format: &format
errorDescription: &errorStr];

抱歉，不知道这里用什么标签来格式化代码！

# asp.net - IOC 容器什么时候准备好？

> ID：400301
> 
> 赞同：0
> 
> 时间：2008-12-30T13:57:17.317
> 
> 标签：asp.net, inversion-of-control

IOC 容器何时处于 ASP.NET 应用程序的生命周期中？

我什么时候可以开始从容器中请求对象？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T13:59:48.247

根据您所谈论的容器（Windsor、StructureMap、Ninject 等），它们通常在创建后立即可用。

您通常在 Application_Start 事件中创建容器。

# c# - Visual Studio 中的测试单独成功，一组失败

> ID：400304
> 
> 赞同：16
> 
> 时间：2008-12-30T13:58:20.683
> 
> 标签：c#, .net, visual-studio, unit-testing

当我在 Visual Studio 中单独运行测试时，它们都可以顺利通过。但是，当我一次运行所有这些时，有些通过，有些失败。我尝试在每种测试方法之间暂停 1 秒，但没有成功。

有任何想法吗？在此先感谢您的帮助...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T14:10:50.597

您可能有一些共享数据。检查正在使用的类中的静态成员变量，这意味着一个测试设置了一个导致后续测试失败的值。

您还可以调试单元测试。根据您使用的框架，您应该能够将框架工具作为调试启动应用程序运行，并将编译程序集的路径作为参数传递。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T14:02:31.127

在一项测试中完成的某些修改/实例化很可能会影响其他测试。这表明糟糕的测试设计和缺乏适当的隔离。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T14:25:12.347

每个人都可能是对的，测试之间正在修改一些共享日期。但请注意[MS 测试执行的顺序](http://blogs.msdn.com/nnaderi/archive/2007/02/17/explaining-execution-order.aspx)。只是在测试之间暂停不是解决方案。每个测试都在它自己的测试类实例中在一个单独的线程上执行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:12:39.563

根据其他回复。听起来您有一个导致交互的单例或全局变量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-25T20:30:14.397

我使用的其他单元测试框架努力确保测试产生相同的结果，无论测试是单独运行还是作为“全部运行”替代方案的一部分运行。目标是防止一个测试由于副作用而对另一个测试产生影响，例如（例如）让一个测试将类的静态状态留在另一个测试不期望的配置中。VS 单元测试框架似乎没有提供这种隔离。我有 2 条建议来尽量减少问题所暗示的问题类型。首先，如果类具有状态（除了静态方法之外还有其他任何东西），则优先使用非静态类而不是静态类。创建此类的单个实例，并让它保留保存在静态类中的状态信息。第二，如果您确实选择了具有静态状态的静态类，请使用将静态状态设置回“空”的静态方法（例如，将所有静态属性设置为空/零/等的方法）。在每个单元测试结束时调用它以撤消测试对静态状态施加的任何影响。（诚​​然，这不太优雅，但如果适度完成是可行的）。或者做我打算做的事情——找到一个提供跨测试隔离的单元测试框架。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-21T20:33:57.383

尽管我的问题最终成为线程问题，但我也遇到了这个问题。就我而言，我在伪造 HttpContext 对象，因为测试依赖于它的存在。但是，我在 ClassInitialize 方法中进行了设置，认为这将用于以下每种方法：

```
[ClassInitialize]
public static void ClassInit(TestContext testContext)
{
    HttpContext.Current = new HttpContext(new HttpRequest(null, "http://tempuri.org", null), new HttpResponse(null));
} 
```

然而，事实证明，类中的每个测试方法都在单独的线程中运行。所以我不得不将此代码添加到依赖它来解决问题的每个测试方法中。

```
[TestMethod]
public void TestMethod1()
{
    HttpContext.Current = new HttpContext(new HttpRequest(null, "http://tempuri.org", null), new HttpResponse(null));
    ...
}

[TestMethod]
public void TestMethod2()
{
    HttpContext.Current = new HttpContext(new HttpRequest(null, "http://tempuri.org", null), new HttpResponse(null));
    ...
} 
```

有关这方面的更多信息，请参阅链接。 [http://blogs.msdn.com/b/nnaderi/archive/2007/02/17/explaining-execution-order.aspx](http://blogs.msdn.com/b/nnaderi/archive/2007/02/17/explaining-execution-order.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-08-14T15:06:16.437

我在这里遇到了类似的问题，我是如何解决的：

1.  将第二个测试的代码复制到第一个测试中（在它之后）。
2.  尝试测试第一个测试。第一个测试可能会失败，然后您可以调试第一个测试（逐步）以找到导致问题的静态/共享变量或逻辑。

# design-patterns - 提供者模型是否使用工厂模式？

> ID：400306
> 
> 赞同：2
> 
> 时间：2008-12-30T13:58:31.073
> 
> 标签：design-patterns, provider-model

提供者模型真的只是工厂模式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T14:10:58.583

据此，[_](http://en.wikipedia.org/wiki/Provider_model)

> 提供者是 ProviderBase 类的子类，通常使用工厂方法进行实例化。

所以我会说不，它们不是一回事，但工厂用于实现提供者。

您还可以按照[此链接](http://msdn.microsoft.com/en-us/library/ms972319.aspx)和 Ctrl-F 访问“工厂”来查看该模式在提供程序模型中的使用方式。

# c# - C#中的“T”是什么意思？

> ID：400314
> 
> 赞同：81
> 
> 时间：2008-12-30T14:01:36.667
> 
> 标签：c#, .net, generics

我有 VB 背景，我正在为我的新工作转换为 C#。我也在努力在 .NET 上做得更好。我已经看到人们发布的示例中经常使用关键字“T”。C#中的“T”是什么意思？例如：

```
public class SomeBase<T> where T : SomeBase<T>, new() 
```

做什么`T`？我为什么要使用它？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-30T14:05:27.220

[它是泛型类型参数](http://msdn.microsoft.com/en-us/library/512aeb7t.aspx)的符号。它也可以是其他东西，例如：

```
public class SomeBase<GenericThingy> where GenericThingy : SomeBase<GenericThingy>, new() 
```

只有 T 是 Microsoft 使用和鼓励的默认选项。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-12-30T14:03:45.103

T 本身不是关键字，而是泛型类型的占位符。请参阅 Microsoft 的[泛型简介](http://msdn.microsoft.com/en-us/library/ms379564(vs.80).aspx)

等效的 VB.Net 语法将是：

```
Public Class SomeBase(Of T As {Class, New})) 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-12-30T14:08:09.290

使用另一个名称代替 T 的一个很好的例子`would`是哈希表类，例如

```
public class Dictionary<K,V> ... 
```

where`K`代表 Key 和`V`value。我认为`T`代表类型。

你可能已经看到了这个。如果您可以建立联系，那应该会很有帮助。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-30T14:12:22.560

那将是一个“通用”。正如人们已经提到的，[微软对](http://msdn.microsoft.com/en-us/library/ms379564(vs.80).aspx)这个概念有一个解释。至于为什么是“T”——见[这个问题](https://stackoverflow.com/questions/374014/why-do-generics-often-use-t)。

简而言之，它允许您创建专用于特定类型的类/方法。一个经典的例子是`System.Collections.Generic.List<T>`类。它与 相同`System.Collections.ArrayList`，只是它只允许您存储类型为 的项目`T`。这提供了类型安全 - 您不能（意外或其他）将错误类型的项目放入列表中。`System.Collections.Generic`命名空间包含其他几个使用它的不同集合类型。

至于你可以在哪里使用它——这取决于你。有许多不时出现的用例。大多数情况下，它是某种自制集合（当内置集合不够用时），但它真的可以是任何东西。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-30T14:04:26.210

最好的方法是让自己熟悉“泛型”，网络上有很多资源，这里有[一个](http://msdn.microsoft.com/en-us/library/ms379564(vs.80).aspx)

T 不是关键字而是名称，据我所知可以是任何东西，但 T 是约定（当只需要一种类型时，当然）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T14:09:36.933

`T`是泛型类中类型参数的名称。它代表“类型”，但您也可以称它为“爱丽丝”。

您可以使用泛型以类型安全的方式提高可重用性，而无需不必要地重复代码。因此，您不需要为`ListOfIntegers`、`ListOfStrings`、等编写类`ListOfChars`，`ListOfPersons`而是可以编写一个泛型类，`List<T>`然后实例化 、 和 类型`List<Int32>`的对象。编译器为您完成工作。`List<string>``List<char>``List<Person>`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T14:03:16.663

它的意思是“任何类别”。它可以是“B”，“A”，等等。我认为使用 T 是因为“模板”

# c# - 尝试使用 SharpSVN 结帐时出错

> ID：400330
> 
> 赞同：2
> 
> 时间：2008-12-30T14:07:32.350
> 
> 标签：c#, svn, sharpsvn

在尝试使用以下代码时，我收到以下错误：已经为不同的 url 工作，错误代码 155000。

```
string targetPath = @"C:\Documents and Settings\Admin\My Documents\CPM Creator\"; //" for prettify

client.Authenticatio​n.DefaultCredentials​ = new NetworkCredential("guestUser", "hjk$#&123");

// Checkout the code to the specified directory
client.CheckOut(new Uri("http://svn.peerlis.com:8080/CPM Creator"), targetPath); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T15:47:44.317

IMHO, the best way to troubleshoot SVN problems is to use the command line client. Sometimes, it offers more clues that way, so you might want to look at documentation on [svn checkout](http://svnbook.red-bean.com/en/1.0/re04.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-11T12:52:23.117

你说有隐藏的 .svn 文件夹；这意味着它`targetPath`已经是一个工作副本，您必须检出另一个文件夹，或者如果不再需要现有的工作副本，则删除它。

如果您想更新现有的工作副本，请执行以下操作：

```
client.Update(targetPath); 
```

查看[Subversion 文档](http://svnbook.red-bean.com/)以获取有关在什么情况下需要什么命令的更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T14:29:15.613

嗯，正确吗？这已经是 SVN 文件夹的工作路径了吗？该位置是否有任何隐藏的 svn 文件夹？

我在“进入暂存区域、在本地工作、丢弃”循环中使用 SharpSVN，所以我总是从一个干净（空）文件夹开始（祖先中没有 SVN 文件夹）。这一直运作良好。

# java - 对 Hibernate 驱动的应用程序进行单元测试？

> ID：400338
> 
> 赞同：35
> 
> 时间：2008-12-30T14:10:10.597
> 
> 标签：java, unit-testing, hibernate, junit

这可能是一个幼稚的问题，但我对 junit 和 hibernate 框架都是新手，我想知道对主要调用 hibernate 的应用程序进行单元测试的最佳方法是什么，或者是否有必要这样做？

这里的最佳做法是什么？

**编辑：**
春天似乎是这里的大建议。不幸的是，这对于一个项目来说可能有点太多了。Junit、Hibernate 和 Spring 对我来说都是新的，虽然它们都是我想掌握的技术，但我认为尝试将它们全部整合到一个项目中对我来说可能过于庞大。

欢迎链接到教程和/或书籍建议。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-30T15:43:33.887

Keep in mind the difference between unit testing and integration testing.

Unit tests should be testing code without any outside dependencies. These dependencies are mocked using a framework like, for example, JMock.

Integration tests are important too but the major drawback of them is that they take a long time to run. You can run thousands of true unit tests in a couple of seconds, but it's not the same with integration tests.

Depending on the size of your project/development team you might want to prioritize true unit tests over integration tests. Both style of tests are important but if you are pressed for resources, just going with Unit testing may be a better idea.

I wrote an application by myself that unit tested the Web (with Spring MVC this is easy) and Service layers, as well as domain objects. But I left the DAO alone because I didn't want to write a bunch of slow integration tests. If I had more people on staff I would have gone with integration tests as well, but in this case I didn't feel the time spent would be worth it.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T14:38:12.773

至于最佳实践：

如果可能，请使用嵌入式数据库来运行您的测试，这样您就不需要一个完整部署的关系数据库来运行您的测试（在本地，或者在您的连续构建服务器上，如果有的话）。这样您也不需要（必然）担心回滚等，您可以在需要时重新创建数据库。使用嵌入式数据库进行测试不会测试您使用特定生产数据库时可能出现的特性，但它会测试您的代码，这应该足够了。

在运行 Hibernate 测试之前，您还可以使用JUnit 的扩展[DbUnit](http://dbunit.sourceforge.net/)轻松地用预期的行填充数据库并将其置于已知状态。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T14:22:33.910

最佳实践？我使用 Spring 并使我的所有测试都具有事务性。我执行测试并回滚所有更改，因此我不会更改数据库的状态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T16:58:29.260

Hibernate 源代码包含大量单元测试，我建议您通过这些测试并采用类似的方法。

您还可以查看示例应用程序为“Java Persistence with Hibernate”一书开发的[CaveatEmptor](http://www.hibernate.org/400.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T15:07:52.807

I like to use a in memory hsqldb for testing. The process for each hibernate POJO is:

1.  Create the object
2.  Persist it to the DB
3.  Clear the session
4.  Get it from the DB
5.  Assert the objects are equal.

For DAOs, I create and persist enough objects to accurately test the methods, then run the tests and delete the objects as necessary to not intefere with other tests.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-25T09:42:20.980

如果您将 Hibernate 用于域丰富的模型，单元测试域逻辑就像测试 POJO 一样简单，而 Hibernate 不会妨碍您。这里唯一需要注意的是，对于双向映射，您可能必须在两侧设置对象以进行单元测试。

对于简单的映射，通常不进行与数据库的集成测试。但是建议在单表继承等精致映射的情况下使用。这里唯一要记住的是，有时您可能必须显式刷新到数据库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-11T09:49:24.077

编写一个将请求传递给 Hibernate 的简单层。然后使用像[EasyMock](http://www.easymock.org/)或[JMock](http://www.jmock.org/)这样的模拟库来断言您的 Hibernate-veneer 层被您的应用程序类正确调用。这在部分完整的[JMock 书中](http://www.mockobjects.com/book/listening-to-the-tests.html)得到了很好的描述（向下滚动到测试气味“一切都被嘲笑”）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T14:21:40.527

当然，如果你的持久层不是用 Hibernate 编写的，你会对其进行单元测试，不是吗？

创建使用 Hibernate 实现的给定持久性接口，实例化一些示例对象，执行 CRUD 操作，并要求 JUnit 断言操作成功。与任何其他类相同。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T14:23:46.093

您可以在这里使用 Spring 来提供帮助。

它有一个很棒的单元测试框架，您可以使用它来测试 CRUD 操作，然后回滚更改 - 如果您没有每次都重新加载数据库的能力，那就太好了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-07-10T22:36:15.257

两种情况很容易测试：

1.  如果可行，请在不知道​​保存或加载实体的函数中执行各种计算和转换。如果你能做出这些纯函数，那就更好了。

2.  对于只保存到数据库而不从数据库中读取的函数，您可以在测试时选择不保存。

执行 #2 的最简单（最粗略）的方法是向`reallyUpdate`函数添加一个参数，然后在每个“保存”调用周围加上：

```
if (reallyUpdate) {
    HibernateUtil.saveOrUpdate(theThing);
} 
```

对我来说，这些是最低的挂果。

# apache-flex - Flash、Flex、Adobe Air、Java FX 和 Silverlight 的所有这些业务是什么？

> ID：400340
> 
> 赞同：9
> 
> 时间：2008-12-30T14:10:25.387
> 
> 标签：apache-flex, flash, silverlight, air, javafx

Flash、Flex、Adobe Air、Java FX 和 Silverlight 的所有这些业务是什么？为什么我会选择一个而不是另一个？Java Applet 和 ActiveX 控件发生了什么？

哦，AJAX 在哪里适合这一切？Laszlo 是否相关？

Afteredit（回应一些“d'uh”类型的答案）：这个问题有点开玩笑。我了解各种 RIA 技术。然而，我对 StackOverflow 社区对每一种的看法都很感兴趣——尤其是为什么你会使用一个而不是另一个

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-30T14:26:13.637

大主题，需要页面才能提供完整的答案，所以这里是“简短”版本......

1.  Adobe Flex/AIR 是迄今为止最成熟的 RIA 平台，它在 FlashPlayer 中运行。您使用 ActionScript（类似于 Javascript）和 MXML（主要用于布局/视图代码的标记）编写应用程序。如果用户安装了 AIR 运行时，您还可以轻松地将 Flex 应用程序部署到桌面。

2.  Silverlight 是微软的产品，它仍然落后于 Flex，但正在迅速取得进展。SL 运行时是新的，并且正在慢慢获得更大的安装基础。您可以使用 C#、VB.NET 或 .NET 运行时支持的其他语言。它可以在 Windows 和 Mac 上运行，但不能在桌面上运行。

3.  JavaFX 是一种平台、API 和脚本语言，用于在 Java 平台上构建 RIA。它是最新的条目，最近刚刚发布了 1.0 版本。它可以在浏览器或桌面上运行，并且可以利用任何和所有 Java 代码。鉴于存在多少开源 Java 代码，这可能非常引人注目。

AJAX / DHTML 主要是这些技术的替代方案，尽管由于 FP、SL 和 Java 都具有双向 Javascript API，您可以编写使用两者并允许它们互操作的应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T14:28:36.050

Flash/Flex、JavaFX 和 Silverlight 是用于开发**富 Internet 应用程序**(RIA) 的工具。您可能对 Flash 应用程序非常熟悉，这些应用程序经常充满动画和其他效果。JavaFX 和 Silverlight 让您可以开发类似的应用程序。Laszlo 符合同样的情况。

Silverlight 是微软的入门产品，它被设计为在 .NET 堆栈中工作。JavaFX 是 Sun 的新产品，旨在与 Java 虚拟机一起使用。为了过度简化 Adob​​e AIR，它试图让 RIA 内容在桌面上无缝运行（JavaFX 也提供了这一点）。

小程序并没有消失，它们只是遭受了 Web 浏览器中 JVM 的糟糕实现。JavaFX 是小程序的新继承人。

AJAX 非常不同；AJAX 是一种使用浏览器现有功能的方式，无需插件即可提供看似丰富的交互式网页。它使用 JavaScript 和 XML。虽然有些 AJAX 应用程序确实很酷，但开发 Flash 风格的 RIA 并不那么容易或自然。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T14:23:13.957

我对 flex 和 air 一无所知，但 Flash、Java FX 和 Silverlight 都是 Web 技术，它们本质上都是在做同样的事情来争夺市场份额，因为这些公司（分别是 Adob​​e、Sun 和 Microsoft）都不想给对方一个边缘和/或不控制网络上的主要内容交付平台。简而言之就是这样。市场话语可能包括诸如“富互联网应用程序”之类的东西。

除非我弄错了，否则 ActiveX 是一个巨大的溃烂安全漏洞，即使是微软也基本上放弃了它，Java 小程序从未像 sun 所希望的那样起飞。我不太清楚为什么，但我认为它们缺乏吸引人们闪现的简单性。

Ajax 与这一切无关。Ajax 只是一种通过将整个页面划分为独立刷新的子部分来防止整个页面刷新的方法。再次，这是我试图以非技术性的方式解释这一切。

编辑：似乎我以错误的方式接近了这个答案。获得更多技术；Flash 是其中最成熟的。Silverlight 和 JavaFX 本质上是婴儿，虽然 Microsoft 和 Sun 都试图从他们现有的基础（.net 和 java）中吸引开发人员，但我不知道是否有人可以对这两种技术发表任何明确的意见。需要一段时间才能看到哪些技术会起飞。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-12-30T14:19:28.877

听起来你需要启动谷歌并做一些研究和阅读。从“富 Internet 应用程序”或“RIA”开始，或者直接输入这些术语并享受。

考虑前三个是同义词；JavaFX 是 Sun 的产品；Silverlight 是微软的入口。

小程序或 ActiveX 控件没有“发生”，它们都还在我们身边。他们有点过时并且失宠了。当茶壶第一次在 Web 上跳舞时，Applet 正处于鼎盛时期。ActiveX 控件存在一些安全问题。

[据此](http://www.donhopkins.com/drupal/node/65)，Laszlo 似乎是 Flex 的灵感来源。

# asp.net - 使用 JavaScript 禁用 ASP.NET 验证器

> ID：400346
> 
> 赞同：34
> 
> 时间：2008-12-30T14:12:25.897
> 
> 标签：asp.net, javascript, validation

有谁知道如何使用 JavaScript 禁用 ASP.NET 验证器？我正在使用 javascript style.display = 'none' 禁用网页的某些部分。但是，这些禁用的部分具有仍在触发的 asp.net 验证器，我需要禁用它而不需要往返于服务器。谢谢。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-12-30T14:14:25.067

使用这个片段：

```
function doSomething()
{
  var myVal = document.getElementById('myValidatorClientID');
  ValidatorEnable(myVal, false); 
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-06-24T17:27:48.593

这是一个古老的问题，但对它没有给出的以下答案感到惊讶。我使用上面的评论实现了它并且完美地工作

```
# enable validation
document.getElementById('<%=mytextbox.ClientID%>').enabled = true

#disable validation
document.getElementById('<%=mytextbox.ClientID%>').enabled = false 
```

这个实现可能有些棘手，因为请记住，如果 javascript 中有错误，代码将退出，但您不会收到任何错误。一些有用的点

1.  确保您可以设置断点*并且*可以单步执行代码。如果没有重启浏览器。

2.  在放置此代码的函数的开头设置断点。单步执行代码，如果出现错误，代码将退出，您将无法单步执行代码。

3.  在 firefox Firebug 中，您可以在控制台选项卡中键入整个 javascript 语句以查看语句返回的内容。最重要的是，您要检查控件的非空值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-05T15:11:43.050

此外，您可以将 Visible 属性设置为 false，而不是简单地隐藏元素...

`whateverItem.Visible = false;`

这使得该项目根本不会呈现到页面，我相信这会禁用验证。如果我错了，请有人纠正我。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-06T16:27:47.990

根据上面 Glenn G 的评论，我会使用

```
myVal.enabled = false; 
```

禁用验证器而不是

```
ValidatorEnable(myVal, false); 
```

以下是我的经历：这两个片段在我的 2003 服务器上运行良好，带有 .net 框架 2.0。但是，在带有 .net 框架 4.0 的服务器 2008 R2 上（我不确定是哪个导致了问题），我遇到了“ValidatorEnable”的意外行为。我的页面上有标签（用户控件），当我离开调用“ValidatorEnable”的标签时，它会暂时禁用下一个标签上的验证器（即使没有调用代码来禁用它们），直到下一次回发。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-29T14:17:34.927

这样做的最好方法，

```
function doSomething()
{
    var objvalidator = document.getElementById('myValidatorClientID');
    objvalidator.enabled = false;
    objvalidator.isvalid = true;
    ValidatorUpdateDisplay(objvalidator);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-04T23:13:36.500

这是关于如何从 JavaScript 控制 ASP.NET 验证器的详细文章：

[如何从 JavaScript 控制 ASP.NET Validator 控制客户端验证](https://web.archive.org/web/20130810162420/http://aspdotnetfaq.com/Faq/How-to-control-ASP-NET-Validator-Controls-Client-Side-validation-from-JavaScript.aspx)

# algorithm - 重新包装硬包装文本的算法？

> ID：400359
> 
> 赞同：7
> 
> 时间：2008-12-30T14:18:32.953
> 
> 标签：algorithm, text, string, word-wrap

假设我为我工作的公司编写了一个自定义电子邮件管理应用程序。它从公司的支持帐户中读取电子邮件，并将其清理后的纯文本版本存储在数据库中，并在此过程中执行其他简洁的操作，例如将其与客户帐户和订单相关联。当员工回复消息时，我的程序会生成一封电子邮件，该电子邮件将与讨论线程的格式化版本一起发送给客户。如果客户做出回应，应用程序会在主题行中查找唯一编号以读取传入消息，删除之前的讨论，并将其作为新项目添加到线程中。例如：

```
这是来自 Contoso 客户服务的消息。

最近，您请求客户支持。以下是您的摘要
请求和我们的答复。

-------------------------------------------------- ------------------
Contoso (Fred) 于 2008 年 12 月 30 日星期二上午 9:04
-------------------------------------------------- ------------------
约翰：

我已经修改了你的地址。您可以通过登录来确认我的工作
我们网站上的“您的帐户”。您的订单应该今天发货。

感谢您在 Contoso 购物。

-------------------------------------------------- ------------------
您于 2008 年 12 月 30 日星期二上午 8:03
-------------------------------------------------- ------------------
糟糕，我输入了错误的地址。你能把它改成

弗雷德·史密斯
主街 123 号
弗吉尼亚州任何镇 12345

谢谢！

--
弗雷德·史密斯
Contoso 产品爱好者

```

一般来说，这一切都很好，但有一个领域我现在有点推迟清理，它处理文本换行。为了生成像上面这样漂亮的电子邮件格式，我需要重新包装客户最初发送的文本。

我已经编写了一个算法来执行此操作（尽管查看代码，我并不完全确定它是如何工作的——它可以使用一些重构）。**但它无法区分硬换行换行、“段落结尾”换行和“语义”换行。**例如，硬换行换行是电子邮件客户端在段落中插入的换行，以换行一长行文本，例如 79 列。段落结尾换行符是用户在段落最后一句之后添加的换行符。语义换行符类似于`br`标签，例如 Fred 在上面键入的地址。

相反，我的算法只看到一行中的两个换行符表示一个新段落，因此它会使客户的电子邮件格式如下：

```
糟糕，我输入了错误的地址。你能把它改成

弗雷德·史密斯 123 Main St Anytown, VA 12345

谢谢！

-- Fred Smith Contoso 产品爱好者

```

每当我尝试编写一个可以按预期重新换行该文本的版本时，我基本上都会碰壁，因为我需要知道文本的语义，“硬换行”换行符和“我的意思是它就像一个`br`"-type 换行符，例如在客户的地址中。（我连续使用两个换行符来确定何时开始一个新段落，这与大多数人似乎实际键入电子邮件的方式一致。）

任何人都有可以按预期重新包装文本的算法？或者在权衡任何给定解决方案的复杂性时，这种实现是否“足够好”？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T14:29:16.830

您可以尝试检查是否已插入换行符以将行长度保持在最大值以下（也称为硬换行）：只需检查文本中最长的行。然后，对于任何给定的行，将下一行的第一个单词附加到它。如果结果行超过最大长度，则换行符可能是硬换行。

更简单的是，您可能只是将所有`(maxlength - 15) <= length <= maxlength`闯入视为硬包装（15 只是有根据的猜测）。这肯定会过滤掉地址和内容中的故意中断，并且在此范围内任何错过的中断都不会对结果造成太大影响。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T14:59:16.863

我有两个建议，如下。

*   注意标点符号：这将帮助您区分“硬换行”换行符和“段落结尾”换行符（因为，如果该行以句号结尾，则更有可能是用户想要的一个段落的结尾。

*   注意一行是否比最大行长短得多：在上面的示例中，您可能有 79 个字符的文本被“硬换行”，而且您的地址行只有 30 个字符长；因为 30 远小于 79，所以您知道地址行是由用户破坏的，而不是由用户的文本换行算法破坏的。

另外，请注意缩进：从左侧缩进空格的行可能被认为是新段落，与之前的行不同，就像在这个论坛上一样。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T19:43:53.873

按照上面 Ole 的建议，我重新设计了实现以查看阈值。它似乎可以很好地处理我抛出的大多数场景，而无需我发疯并编写真正理解英语的代码。

基本上，我首先扫描输入字符串并在变量中记录最长的行长度`inputMaxLineLength`。然后当我重新包装时，如果我遇到一个索引在`inputMaxLineLength`85%之间的换行符`inputMaxLineLength`，那么我用一个空格替换那个换行符，因为我认为它是一个硬换行换行符——除非它后面紧跟着另一个换行符，因为那时我假设它只是一个恰好在该范围内的单行段落。例如，如果有人键入一个简短的项目符号列表，就会发生这种情况。

当然不是完美的，但对于我的场景来说“足够好”，考虑到文本通常一开始就被以前的电子邮件客户端破坏了一半。

这是一些代码，我的几个小时前的实现可能仍然在一些边缘情况下（使用 C#）。它比我以前的解决方案简单得多，这很好。

[源代码](http://piasecki.name/skiviez-crap/wrap-ex/WrapExSample.cs)

下面是一些执行该代码的单元测试（使用 MSTest）：

[测试代码](http://piasecki.name/skiviez-crap/wrap-ex/WrapExSampleTest.cs)

如果有人有更好的实现（毫无疑问存在更好的实现），我很乐意阅读您的想法！谢谢。

# asp.net - 空 QueryString 参数

> ID：400364
> 
> 赞同：26
> 
> 时间：2008-12-30T14:20:28.597
> 
> 标签：asp.net, query-string

### 问题

`foo`使用 asp.net 在以下 url 的查询字符串中检查参数的正确方法是什么？这甚至可能吗？

```
http://example.com?bar=3&foo 
```

我已经尝试过检查`Request["foo"]`，`Request.QueryString["foo"]`并且我都得到`null`了。我还尝试使用集合`List`中的值填充 a，`QueryString`但正如我在下面提到的，它不包括该值。

### 问题

我知道没有价值，但不应该`Request["foo"]`返回空字符串而不是`null`? 有没有办法找出查询字符串键是否存在，即使它没有值？

### 笔记

我发现[这里](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=377511)包括`Request.QueryString.AllKeys`空白`null`查询字符串参数。

### [编辑]

正如[James](https://stackoverflow.com/users/12725/james-curran)和[Dreas](https://stackoverflow.com/users/44084/dreas-grech)下面所述，解析原始 url 的正则表达式可能是最好的（也可能是唯一的）方法。

```
Regex.IsMatch(Request.RawUrl, "[?&]thumb([&=]|$)") 
```

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2010-08-29T21:58:22.880

您可以将`null`其用作键，`NameValueCollection`它将为您提供一个以逗号分隔的没有值的参数名称列表。

因为`http://example.com?bar=3&foo`你会使用`Request.QueryString[null]`它，它会检索`foo`.

如果您有多个没有值的参数名称，它将为您提供一个以逗号分隔的值。

因为`http://example.com?bar=3&foo&test`你会得到`foo,test`回报。

**更新：**

您实际上可以使用`Request.QueryString.GetValues(null)`来获取没有值的参数名称。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-30T14:30:14.927

`Request.ServerVariables["QUERY_STRING"]`将完整的查询字符串作为字符串返回。然后使用 Regex 或 IndexOf 搜索它

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-30T14:23:03.550

你得到 null 因为`foo`参数没有值。

...到底是什么问题？

如果您仍想检查它是否存在（尽管它缺少值），请尝试以下操作：

```
bool doesFooExist = Request.Url.AbsoluteUri.IndexOf("foo=") >= 0 ? true : false; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:26:37.397

德里亚斯是正确的。变量“bar”有一个值，但 foo 没有。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T14:57:39.317

QueryString["Bar"] 将返回 3，因为它具有与变量 Bar 关联的值 3。但是， Foo 将返回 null，因为它们没有值，并且当您在变量或键上调用 QueryString 时，您正在查询值，而不是键，这就是您返回 null 的原因。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-05T06:55:07.577

查询字符串可能是一种浪费。如果您使用 Request.Params[""] 或对其进行迭代，那么您将找到您想要的。它真的比其他东西方便。

如果您需要任何帮助，请告诉我。

# solr - 有没有一种简单的方法可以让 Solr 根据随请求提交的一组凭据引用不同的索引？

> ID：400366
> 
> 赞同：7
> 
> 时间：2008-12-30T14:22:07.360
> 
> 标签：solr

我想要一个[Solr](http://lucene.apache.org/solr/)实例，受某种身份验证保护，根据用于该身份验证的凭据对不同的索引进行操作。身份验证的类型很灵活，但如果可能的话，我更喜欢使用开放标准（现有的或新兴的）。

我试图解决的核心问题是应用程序的不同用户（可能）可以访问存储在其中的不同数据，并且用户不应该能够搜索不可访问的数据。为每个用户建立索引似乎是保证一个用户看不到禁止数据的最简单方法。有没有更简单的方法？一个可以避免 Solr 需要一种将用户映射到索引的方法？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T16:04:21.990

Solr 人员对可能的情况进行了非常详尽的概述，请参阅[http://wiki.apache.org/solr/MultipleIndexes](http://wiki.apache.org/solr/MultipleIndexes)

# wpf - 摆脱选项卡控件的该选项卡下的行

> ID：400395
> 
> 赞同：6
> 
> 时间：2008-12-30T14:32:29.927
> 
> 标签：wpf, tabcontrol, border

使用 xaml ( wpf ) 我试图摆脱选项卡控件下的行，如下面的“插图 A”所示，使其最终看起来像“插图 B”：

插图 A

[http://www.arulerforwindows.com/images/peskylinea.png](http://www.arulerforwindows.com/images/peskylinea.png)

图 B

[http://www.arulerforwindows.com/images/peskylineb.png](http://www.arulerforwindows.com/images/peskylineb.png)

当我定义选项卡项但似乎附加到选项卡控件时，该行显示，因此更改选项卡项或选项卡控件中的一个或两个上的 BorderThickness 似乎不会产生所需的结果。

我需要在无法使用实心填充矩形来掩盖问题的透明背景上执行此操作。

这是代码：

```
<!--Tab Control-->
<Style  TargetType="{x:Type TabControl}">
    <Setter Property="OverridesDefaultStyle" Value="True" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
     <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type TabControl}">
                <Grid KeyboardNavigation.TabNavigation="Local">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TabPanel Name="HeaderPanel" Grid.Row="0" Panel.ZIndex="1" Margin="0,0,0,-1" IsItemsHost="True" KeyboardNavigation.TabIndex="1" Background="Transparent" />
                    <Border 
                        Name="Border" 
                        Grid.Row="1" 
                        Background="{StaticResource WindowBackgroundBrush}" 
                        BorderBrush="{StaticResource DefaultSystemBrush}" 
                        BorderThickness="1,1,1,1" 
                        Margin="0,0,0,0"
                        CornerRadius="4" 
                        KeyboardNavigation.TabNavigation="Local"
                        KeyboardNavigation.DirectionalNavigation="Contained"
                        KeyboardNavigation.TabIndex="2" >
                        <ContentPresenter 
                             Name="PART_SelectedContentHost"
                             Margin="4"
                             ContentSource="SelectedContent" />
                    </Border>                                         
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Foreground" Value="{StaticResource DisabledForegroundBrush}" />
                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource DisabledBorderBrush}" />
                    </Trigger>
        <Trigger Property="IsEnabled" Value="False">
          <Setter Property="Foreground" Value="{StaticResource DisabledForegroundBrush}" />
          <Setter Property="BorderBrush" TargetName="Border" Value="{StaticResource DisabledBorderBrush}" />
        </Trigger>
      </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>

<Style TargetType="{x:Type TabItem}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type TabItem}">
                <Grid>
                    <Border Name="Border" Background="Transparent" BorderBrush="{StaticResource DefaultSystemBrush}" BorderThickness="1,1,1,1" CornerRadius="6,6,0,0">
                        <ContentPresenter x:Name="ContentSite" VerticalAlignment="Center" HorizontalAlignment="Center" ContentSource="Header" Margin="12,2,12,2"/>
                    </Border>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Panel.ZIndex" Value="100" />
                        <Setter TargetName="Border" Property="Background" Value="Transparent" />
                        <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0" />
                    </Trigger>
                    <Trigger Property="IsSelected" Value="False">
                        <Setter TargetName="Border" Property="Background" Value="LightGray" />
                        <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

提前致谢，

抢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T15:45:25.990

Using [ShowMeTheTemplate](http://www.sellsbrothers.com/tools/#ShowMeTheTemplate) I found out part of the style, it's on the TabItem. There is a lot more in the default control template you may be interested in setting up if you override it.

```
<MultiTrigger>
  <MultiTrigger.Conditions>
    <Condition Property="Selector.IsSelected">
      <Condition.Value>
        <s:Boolean>True</s:Boolean>
      </Condition.Value>
    </Condition>
    <Condition Property="TabItem.TabStripPlacement" Value="{x:Static Dock.Top}" />
  </MultiTrigger.Conditions>
  <Setter Property="FrameworkElement.Margin">
    <Setter.Value>
      <Thickness>-2,-2,-2,-1</Thickness>
    </Setter.Value>
  </Setter>
</MultiTrigger> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-30T09:27:50.230

有同样的问题。请注意，这条线仅针对设置了高度的选项卡绘制（仅针对一个选项卡设置，并且所有选项卡都自动具有保存高度）。所以我添加了一个新`TabItem`的 with`width=0`并`height`指定并`height`从所有其他选项卡中删除，这对我来说是个窍门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-20T13:10:42.477

这工作得很好。

```
<Style TargetType="TabItem">
    <Setter Property="VerticalContentAlignment" Value="Stretch"/>
    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type TabItem}">
                <Border x:Name="Chrome"
                        BorderThickness="1,1,1,0" 
                        BorderBrush="Black" 
                        Background="{TemplateBinding Background}" 
                        Padding="2,2,2,1" Margin="1,1,1,0">
                    <ContentPresenter ContentSource="Header" 
                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="Selector.IsSelected" Value="True">
                        <Setter TargetName="Chrome" Property="Margin" Value="1,1,1,-1"/>
                        <Setter TargetName="Chrome" Property="Padding" Value="2"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

只需更改选定选项卡项上的边距和填充。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-06-03T08:30:07.680

```
 <Style TargetType="TabControl">
        <Setter Property="Template">
            <Setter.Value>

                <ControlTemplate TargetType="{x:Type TabControl}">
                    <Grid KeyboardNavigation.TabNavigation="Local">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TabPanel x:Name="HeaderPanel"
                              Grid.Row="0"
                              Panel.ZIndex="1"
                              Margin="0,0,0,-1"
                              IsItemsHost="True"
                              KeyboardNavigation.TabIndex="1"
                              Background="Transparent" />

                        <Border x:Name="Border"
                            Grid.Row="1"
                            BorderThickness="1"
                            KeyboardNavigation.TabNavigation="Local"
                            KeyboardNavigation.DirectionalNavigation="Contained"
                            KeyboardNavigation.TabIndex="2">

                            <Border.Background>
                                <SolidColorBrush Color="White"/>
                            </Border.Background>

                            <Border.BorderBrush>
                                <SolidColorBrush Color="White"/>
                            </Border.BorderBrush>

                            <ContentPresenter x:Name="PART_SelectedContentHost"
                                          Margin="0"
                                          ContentSource="SelectedContent" />
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        </Style> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-18T21:14:49.267

调整边距和填充对我来说效果不佳。然而，在选项卡控件边框上绘制一个白色（背景色）边框就可以了：

```
<ControlTemplate TargetType="{x:Type TabItem}">
<StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0 0 7 0">
        <Border x:Name="tabContentBorder" BorderThickness="2 2 2 0" Background="AliceBlue" BorderBrush="AliceBlue" CornerRadius="6 6 0 0">
        <ContentPresenter HorizontalAlignment="Center" x:Name="Content" VerticalAlignment="Center" ContentSource="Header" Margin="7 3 7 3"/>
    </Border>
    <Border  x:Name="tabBottomBorder"  BorderBrush="White" BorderThickness="1" Visibility="Hidden" Margin="2 0 2 -2" HorizontalAlignment="Stretch"></Border>
</StackPanel>
<ControlTemplate.Triggers>
    <Trigger Property="IsSelected" Value="True">
        <Setter TargetName="tabContentBorder" Property="Background" Value="White" />
        <Setter TargetName="tabBottomBorder" Property="Visibility" Value="Visible"/>
    </Trigger>
</ControlTemplate.Triggers> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-11-17T14:08:25.063

另一种非常简单的方法是添加一个宽度为零的额外选项卡，您可以在其中将高度设置为所需的高度，甚至只是使其可见性隐藏。然后，您可以设置选项卡高度，而无需在设置高度的选项卡上设置恼人的水平线。

```
 <TabItem Header="" Width="0" Height="30" Visibility="Hidden" /> 
```

# c# - 如何限制 .NET 中 StreamReader.ReadLine() 读取的字符数？

> ID：400407
> 
> 赞同：9
> 
> 时间：2008-12-30T14:34:47.257
> 
> 标签：c#, readline, streamreader, ddos

我正在用 C# 编写一个 Web 服务器应用程序，并使用 StreamReader 类从底层 NetworkStream 中读取：

```
 NetworkStream ns = new NetworkStream(clientSocket);
 StreamReader sr = new StreamReader(ns);
 String request = sr.ReadLine(); 
```

这段代码很容易受到 DoS 攻击，因为如果攻击者从不断开连接，我们将永远不会读完该行。有什么方法可以限制.NET 中 StreamReader.ReadLine() 读取的字符数？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T14:39:47.043

您将不得不使用`Read(char[], int, int)`重载（确实限制了长度）并进行自己的行尾检测；不应该太棘手。

对于稍微懒惰的版本（使用单字符阅读版本）：

```
static IEnumerable<string> ReadLines(string path, int maxLineLength)
{
    StringBuilder currentLine = new StringBuilder(maxLineLength);
    using (var reader = File.OpenText(path))
    {
        int i;
        while((i = reader.Read()) > 0) {
            char c = (char) i;
            if(c == '\r' || c == '\n') {
                yield return currentLine.ToString();
                currentLine.Length = 0;
                continue;
            }
            currentLine.Append((char)c);
            if (currentLine.Length > maxLineLength)
            {
                throw new InvalidOperationException("Max length exceeded");
            }
        }
        if (currentLine.Length > 0)
        {
            yield return currentLine.ToString();
        }                
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T14:42:23.293

您可能需要`StreamReader.Read`重载之一：

取自[http://msdn.microsoft.com/en-us/library/9kstw824.aspx](http://msdn.microsoft.com/en-us/library/9kstw824.aspx)

```
 using (StreamReader sr = new StreamReader(path)) 
    {
        //This is an arbitrary size for this example.
        char[] c = null;

        while (sr.Peek() >= 0) 
        {
            c = new char[5];
            sr.Read(c, 0, c.Length);
            //The output will look odd, because
            //only five characters are read at a time.
            Console.WriteLine(c);
        }
    } 
```

专注于`sr.Read(c, 0, c.Length)`行。这仅从流中读取 5 个字符并放入`c`数组中。您可能希望将 5 更改为您想要的值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T08:50:37.167

这是我自己基于 Marc Gravell 的解决方案的解决方案：

```
using System;
using System.IO;
using System.Text;

namespace MyProject
{
    class StreamReaderExt : StreamReader
    {

        public StreamReaderExt(Stream s, Encoding e) : base(s, e)
        {            
        }

        /// <summary>
        /// Reads a line of characters terminated by CR+LF from the current stream and returns the data as a string
        /// </summary>
        /// <param name="maxLineLength">Maximum allowed line length</param>
        /// <exception cref="System.IO.IOException" />
        /// <exception cref="System.InvalidOperationException">When string read by this method exceeds the maximum allowed line length</exception>
        /// <returns></returns>
        public string ReadLineCRLF(int maxLineLength)
        {
            StringBuilder currentLine = new StringBuilder(maxLineLength);

            int i;
            bool foundCR = false;
            bool readData = false;

            while ((i = Read()) > 0)
            {

                readData = true;

                char c = (char)i;

                if (foundCR)
                {
                    if (c == '\r')
                    {
                        // If CR was found before , and the next character is also CR,
                        // adding previously skipped CR to the result string
                        currentLine.Append('\r');
                        continue;
                    }
                    else if (c == '\n')
                    {
                        // LF found, finished reading the string
                        return currentLine.ToString();
                    }
                    else
                    {
                        // If CR was found before , but the next character is not LF,
                        // adding previously skipped CR to the result string
                        currentLine.Append('\r');
                        foundCR = false;
                    }
                }
                else // CR not found
                {
                    if (c == '\r')
                    {
                        foundCR = true;
                        continue;
                    }
                }

                currentLine.Append((char)c);
                if (currentLine.Length > maxLineLength)
                {
                    throw new InvalidOperationException("Max line length exceeded");
                }
            }

            if (foundCR)
            {
                // If CR was found before, and the end of the stream has been reached, appending the skipped CR character
                currentLine.Append('\r');
            }

            if (readData)
            {
                return currentLine.ToString();
            }

            // End of the stream reached
            return null;

        }
    }
} 
```

这段代码是“按原样”提供的，没有任何保证。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T14:40:16.277

您始终可以使用“.Read(...)”，MSDN 建议您在遇到类似情况时这样做。

[http://msdn.microsoft.com/en-us/library/system.io.streamreader.readline.aspx](http://msdn.microsoft.com/en-us/library/system.io.streamreader.readline.aspx)

# c# - Web 服务性能问题

> ID：400413
> 
> 赞同：1
> 
> 时间：2008-12-30T14:37:59.183
> 
> 标签：c#, web-services, asmx

我有一个简单的 asmx Web 服务，只需要将一些信息记录到事务数据库中。但是，它对客户端来说是超时的。更新数据库的调用只调用了 1 个存储过程，我不相信它可以进一步优化以获得更好的性能。我已经简化为只使用 log4net 记录运行，然后通过更新数据库的单独进程读取日志。

我想知道是否有更好的方法来做到这一点。我想知道是否有办法让我的代码执行以下操作：

```
public bool method(...)
{
  LogRun(...)

  Asynchronously call method to insert transaction

  return true;  
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T14:43:15.053

您可能想尝试的一件事是[Tracing](http://www.asp101.com/articles/robert/tracing/default.asp)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T14:54:31.087

**编辑：**我错了 BackgroundWorker。所以我把它改成 Thread 版本，经过测试。

如果您希望异步完成工作，您可以研究如何启动另一个线程。

```
public class Service1 : System.Web.Services.WebService
{

    [WebMethod]
    public void Log(int foo, int bar)
    {
        Thread a = new Thread(new ThreadStart(delegate()
        {
            // Do some processing here
            // For example, let it sleep for 10 secs
            Thread.Sleep(10000);
        }));
        a.Start();
    }
} 
```

如果 Thread.Sleep(10000) 行在 Log 方法本身中，则 Log 方法需要 10 秒才能完成处理。但是，使用*Thread a*， Log 方法将在调用后立即返回。

另请注意，使用这种异步调用方式，没有简单的方法可以保证调用客户端是否完成插入操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T15:07:48.343

如果查询无法进一步优化，您可以增加[SQL 客户端的超时值，](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlcommand.commandtimeout(VS.71).aspx)假设您可能正在使用 SQL 服务器。

在使用 Web 服务的客户端，如果您希望客户端继续执行其他操作，可以异步使用该方法。当 web 方法完成时，它将触发一个事件。如果您认为它可能有帮助，[您可以在此处阅读](http://www.codeguru.com/csharp/csharp/cs_webservices/security/article.php/c9179__1/)一个不错的小示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T16:12:02.880

虽然您可以查看在 web 方法中执行异步操作，但您正在使用 asp.net 中的线程和/或线程池，它已经具有多线程操作。虽然在技术上可行，但您也可能在不经意间抢夺系统资源，因为 httpruntime 管理为您的服务提供请求的资源。

写入本地 log4net 文件并在离线例程中导入该数据比实时日志记录、异步或其他方式具有更高的可用性，因为您的 sql 服务器可以离线并且您的服务仍然可用。如果您不需要 sql server 进行日志记录以外的任何操作，则最好将 db 操作排除在 webmethod 之外。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T16:49:55.063

如果这只是客户端的即发即弃调用，您的 Web 服务可以将详细信息添加到队列并返回给客户端。我已经使用 MSMQ 来实现类似于您所描述的内容。它不会修复数据库超时，但它确实会从您的客户端中删除错误消息。

# c# - C#中VB6的WeekDay函数的等价物

> ID：400421
> 
> 赞同：7
> 
> 时间：2008-12-30T14:40:24.407
> 
> 标签：c#, datetime, vb6, dayofweek, weekday

在 VB6 代码中，我有以下内容：

```
dim I as Long 

I = Weekday(Now, vbFriday) 
```

我想要 C# 中的等价物。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-30T15:05:44.930

```
public static int Weekday(DateTime dt, DayOfWeek startOfWeek)
{
    return (dt.DayOfWeek - startOfWeek + 7) % 7;
} 
```

这可以使用以下方法调用：

```
DateTime dt = DateTime.Now;
Console.WriteLine(Weekday(dt, DayOfWeek.Friday)); 
```

上述输出：

```
4 
```

因为星期二是星期五之后的 4 天。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T14:43:07.083

你的意思是[DateTime.DayOfWeek](http://msdn.microsoft.com/en-us/library/system.datetime.dayofweek.aspx)属性？

```
DayOfWeek dow = DateTime.Now.DayOfWeek; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T14:44:04.133

是的，每个 DateTime 值都有一个名为 DayOfWeek 的内置属性，它返回同名的枚举......

```
DayOfWeek dow = DateTime.Now.DayOfWeek; 
```

如果您想要整数值，只需将枚举值转换为 int。

```
int dow = (int)(DateTime.Now.DayOfWeek); 
```

您必须添加一个从 1 到 6 的常数并执行 Mod 7 以将其重新调整到星期日以外的另一天，但是...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T14:58:40.797

我不认为 VB 的 Weekday 函数有两个参数形式的等价物。

你可以用这样的东西来模拟它；

```
private static int Weekday(DateTime date, DayOfWeek startDay)
{
    int diff;
    DayOfWeek dow = date.DayOfWeek;
    diff = dow - startDay;
    if (diff < 0)
    {
        diff += 7;
    }
    return diff;
} 
```

然后像这样调用它：

```
int i = Weekday(DateTime.Now, DayOfWeek.Friday); 
```

它今天返回 4，因为星期二是星期五之后的 4 天。

# java - 如何通过 Java 小程序将图像文件保存在服务器上？

> ID：400422
> 
> 赞同：1
> 
> 时间：2008-12-30T14:42:19.533
> 
> 标签：java, image, applet, paint

我有一个作为 Java 小程序运行的绘图应用程序。我需要以任何图像格式（通常是 PNG）将画布的内容保存在服务器机器上。请帮忙！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T14:53:02.803

你需要做两件事：

1.  在您的小程序中生成 PNG 图像文件 -[写入/保存图像](http://java.sun.com/docs/books/tutorial/2d/images/saveimage.html)
2.  将图像文件发布到一些将存储图像的服务器端 CGI/servlet -[如何将文件上传到我的 servlet 或 JSP？](http://www.jguru.com/faq/view.jsp?EID=160)

你在服务器上运行什么？php？导轨？JSP？。网？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:35:27.467

您可能会对我为 Processing 编写的代码感兴趣，它基本上是 Java 代码。 [回复：保存到网络 --- 图像导出](http://processing.org/discourse/yabb_beta/YaBB.cgi?board=Syntax;action=display;num=1212658813;start=15#15 "回复：保存到网络---图像导出")。在线程的前面，我解释了对此类应用程序要采取的一些预防措施（以避免恶意用户淹没服务器），并给出相应的 PHP 代码。

# asp.net - 使用 .NET 的 HttpWebRequest 了解 SSL 连接

> ID：400428
> 
> 赞同：2
> 
> 时间：2008-12-30T14:43:48.813
> 
> 标签：asp.net, ssl, httpwebrequest

我似乎无法理解这一点。我正在使用 HttpWebRequest 尝试将一些数据发送到另一个站点。我试图找出配置防火墙的最佳方法，但我不知所措。通过查看 NetMon 跟踪，它似乎忽略了我告诉它的内容。我看到的 HTTP 标头从请求中发出（不是浏览器到我的服务器请求，而是我的服务器到远程服务器请求）不加起来。

```
Http: Request, CONNECT some.random.url:443
Command: CONNECT
URI: some.random.url:443
    Location: some.random.url:443
ProtocolVersion: HTTP/1.1
Host: some.random.url
ProxyConnection: Keep-Alive
HeaderEnd: CRLF 
```

TCP DstPort 似乎也总是以 HTTP(80) 开头。无论如何，我最初似乎无法让它处理 443；SSL 在开始“真正”传输之前是否以端口 80 协商开始？启动时，此请求似乎忽略了我在启动请求之前尝试设置的任何 HttpWebRequest 设置：即使我将 HTTP 1.0 或 keep-alive 设置为 false，它仍然以上述标头开始。

它在做什么？我想知道如何让它通过，但我不确定它为什么会表现出这种行为？

下面的代码，如果它有帮助。

```
Uri newUri = new Uri("https://some.random.url:443/random");
System.Net.HttpWebRequest wr = (HttpWebRequest)WebRequest.Create(newUri);
wr.Method = "POST";
wr.ContentType = "application/x-www-form-urlencoded";
ASCIIEncoding encoding = new ASCIIEncoding();
byte[] requestBytes = encoding.GetBytes("test");
wr.ContentLength = requestBytes.Length;
System.IO.Stream stream = wr.GetRequestStream(); //FAILS HERE, ServerProtocolViolation 
```

我已经搜索过 Google 和其他 SSL/HttpWebRequest 问题，但找不到灵丹妙药。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-31T04:44:26.107

您的问题似乎是 ASP.NET 服务器和远程服务器之间的代理服务器。您可以尝试不使用代理服务器 (wr.Proxy = null)，但这可能是您的网络设置所必需的。

我建议与负责您服务器所在网络的人交谈，并查看代理是否支持 SSL 直通（通过 .NET 代表您发送的 CONNECT 命令）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T15:01:08.903

我已经`HttpWebRequest`通过 SSL 进行了调用，但从未遇到过这个问题。我能看到的唯一一件我从未做过的事情就是在 URL 中包含端口号 (443)。

.NET 应该处理 SSL 连接的创建，而不会在您使用`https`协议时被告知要使用哪个端口。如果您还没有，请尝试不使用端口号。如果你有，那么我没有想法;）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-10T14:36:49.210

试试这个，让我知道你是怎么找到它的！

htw.Credentials = new NetworkCredentials（用户名，密码）

# c# - 等效于 C# 中的 `IF ( X AND ( 2 ^ Y ) ) Then`

> ID：400432
> 
> 赞同：2
> 
> 时间：2008-12-30T14:45:33.770
> 
> 标签：c#, vb6, operators, translation

我`If`在VB6中有这种情况

```
If ( X AND ( 2 ^ Y)) Then 
  a = a + " 1" 
Else
  a = a + " 0" 
```

我想要 C# 中的相同等价物

我试着做

```
if ( X && ( 2 ^ Y))   // ERROR: && can not be used between int to int
  a = a + "1";
else
  a = a + "0"; 
```

但这件事给了我一个错误。

这是我要转换为 C# 的完整 VB 代码

```
For i = 7 To 0 Step -1
        If intNumber And (2 ^ i) Then   ' Use the logical "AND" operator.
            bin = bin + "1"
        Else
            bin = bin + "0"
        End If
    Next 
```

在上面的代码`intNumber`中可以是任何数字。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-30T14:50:23.463

**注意**：由于原始问题中缺乏信息，此答案已被大量编辑。此版本的答案现在基于具有足够信息的更新问题。有关历史记录，请查看编辑日志。

两件事情：

*   `&&`用于布尔表达式之间，以确定逻辑与值
*   `^`在 C# 中表示 XOR，而不是提升到幂。你没有问这个问题，但你不可避免地发现它`^`似乎没有做它的工作。

`&&`很容易处理，因为它可以替换为具有双重含义的单个，`&`具体取决于上下文。它要么是一个完整的逻辑 AND 运算符（`&&`是一个短路的运算符），要么是一个位运算符，这就是你想要的。

`^`不过是不同的。最直接的等价物是[Math.Pow](http://msdn.microsoft.com/en-us/library/system.math.pow.aspx)，但在这种情况下，可以使用更好的替代方案，即位移。

的情况`2^X`可以认为是*将 1 位 X 位置左移*，而左*移位*有其自己的运算符，`<<`运算符。

所以`2^X`可以换成`1 << X`.

在这种情况下，这就是你想要的最里面的 if 语句：

```
if ((intNumber & (1 << index)) != 0)
    a = a + "1";
else
    a = a + "0"; 
```

像你在底部示例中那样将它插入一个循环中，你会得到这个：

```
for (Int32 index = 7; index >= 0; index--)
    if ((intNumber & (1 << index)) != 0)
        bin = bin + "1";
    else
        bin = bin + "0"; 
```

现在，像这样连接字符串会产生 GC 压力，因此您可能应该将这些数字存储到`Char`数组中，然后再构造字符串，或者使用 StringBuilder 类。否则，您将构建 8 个（来自我的示例）不同大小的字符串，并且您只会使用并保留最后一个。根据具体情况，这可能不会造成问题，但如果您多次调用此代码，它会加起来。

这是最终代码的更好版本：

```
Char[] digits = new Char[8]; // change if you want more/fewer digits
for (Int32 index = 0; index < digits.Length; index++)
    if ((intNumber & (1 << index)) != 0)
        digits[digits.Length - 1 - index] = '1';
    else
        digits[digits.Length - 1 - index] = '0';
bin = new String(digits); 
```

然而，这是踢球者。在 .NET 中已经有一种方法可以将 Int32 值转换为充满二进制数字的字符串，这就是 Convert.ToString 方法。唯一的区别是它不添加任何前导零，所以我们必须自己做。

因此，这是您应该使用的最终代码：

```
String bin = Convert.ToString(intNumber, 2).PadLeft(8, '0'); 
```

这将替换整个循环。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T14:50:33.433

在这种情况下，它看起来像是使用 VB 进行按位与，所以也许：

```
if ( (1 & ( 2 ^ 1)) != 0) 
```

然而，这是一个常数！你确定那里没有变量吗？

2 ^ 1 是 3；1 & 3 为 1；所以这永远是真的

（至少，在 C# 下，^ 是 XOR；有人告诉我在 VB 中 ^ 是 POWER，所以 2 ^ 1 是 2；1 & 2 是 0；所以这总是错误的......）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T14:51:34.977

我不明白条件语法...你的意思是 1 & ( 2 ^ 1)) 吗？（仅使用一个 & 符号进行按位比较！）（但这是恒定的！）

但如果 a 是一个字符串，那么

```
 a +=  Conditional?  "1": "0"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T14:49:10.253

尝试

```
if ( 1 & ( 2 ^ 1))
  a = a + "1";
else
  a= a+ "0"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T14:49:47.820

不要使用短路和。试试这个：

```
if (1 & (2 ^ 1) == 1)
{
    a = a + "1";
}
else
{
    a = a + "0";
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T15:28:48.787

你的帖子毫无意义：

```
IF ( 1 AND ( 2 ^ 1)) Then 
 a = a + " 1" 
Else
  a = a + " 0" 
```

2^1 = 2 = Math.Pow(2,1) 1 AND 2 = 1 & 2 = 0

此逻辑意味着 if 的结果将始终为零。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T17:46:34.513

如果我理解正确你想要做的是循环做

```
if i is even
a = a + "0"
else
a = a+"1" 
```

在这种情况下，如果你只是写会更好

```
for (int i=7;i>=0;i--)
{
   bin+=(i % 2).ToString();
} 
```

同样对于循环中的字符串连接，您应该使用 StringBuilder 类而不是 + 运算符。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-12-12T20:17:57.973

仅供参考，Lasse最终代码的更简洁版本：

```
Char[] digits = new Char[8]; // change if you want more/fewer digits
int index = digits.Length;
var x = intNumber;
do {
    digits[--index] = '0' + (x & 1);
    x >>= 1;
} while (index);
bin = new String(digits); 
```

基本上，这利用了这样一个事实，即我们可以像左移掩码一样轻松地将数字右移。如果我们这样做，AND 操作的结果总是个位，这与我们想要在字符串中的数字相同，所以我们只需通过添加“0”（或 48 或 0x30）将其转换为 ASCII 字符.

# hibernate - 示例休眠程序？

> ID：400450
> 
> 赞同：0
> 
> 时间：2008-12-30T14:51:59.267
> 
> 标签：hibernate

我将如何使用 Java 中的 Hibernate 编写一个简单的程序，并以 MySQL 作为后端？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T14:55:45.247

The [Hibernate reference docs](http://www.hibernate.org/hib_docs/v3/reference/en-US/html/) are a good place to start.

Maybe a ["Hello, Hibernate"](http://www.javaworld.com/javaworld/jw-10-2004/jw-1018-hibernate.html) can help.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T15:05:56.960

In addition to Duffymo's suggestion, I would recommend trying out Netbeans 6.5\. I am just starting out with hibernate as well. Netbeans automates database mapping and seems to integrate well with Hibernate. It has helped ease me into the framework.

# .net - Linq and DeleteAllOnSubmit pain

> ID：400464
> 
> 赞同：2
> 
> 时间：2008-12-30T14:58:23.387
> 
> 标签：.net, linq

The following code loads a gig, clears out the gigs acts collection and then adds a new act.

```
 Data.LinqToSQL.Gig dbGig = DBContext.Gigs.Where(x => x.ID == myGigID).SingleOrDefault();

            //Remove all references to the current acts
            if(dbGig.Acts!=null) {
                DBContext.Acts.DeleteAllOnSubmit(dbGig.Acts);
            }

            Data.LinqToSQL.Act dbAct =  new ListenTo.Data.LinqToSQL.Act();
            dbAct.ID = Guid.NewGuid();
            DBContext.Acts.InsertOnSubmit(dbAct);

            DBContext.SubmitChanges(); 
```

Please note that everytime I run this code, the value of myGigID is the same, so its always the same gig that I load.

The first time I run this code it works fine and I have a gig with 1 act.

The second time, dbGig.Acts (a collection) has a count of 0 and so the DeleteAllOnSubmit does not remove any acts. However in the database there is 1 act for this gig! Hence I end up with 2 acts once this code has run.

If I run it a 3rd time, I end up with 3 acts in total.

Any ideas what I'm doing wrong?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-08T20:35:49.837

尝试在此块的开头打开一个新的 DBContext。如果您在第一次和第二次运行时使用相同的上下文，则第二次将看不到插入的记录。重置上下文应该强制它查看表中的最新行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-10T04:23:19.697

gfrizzle 的答案的替代方法是，除非您有令人信服的理由这样做，否则在完成所有数据库工作之前不要调用 SubmitChanges。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T15:05:43.713

Well, you never actually associate the new act with any gig - is that what is missing?

```
dbGig.Acts.Add(dbAct); 
```

or maybe:

```
dbAct.Gig = dbGig; 
```

or something with the ids.

i.e. are you sure the act in the db is for the gig?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-20T10:45:56.157

我有一个类似的问题，我的问题/解决方案是代表数据库表的内部类缺少主键的一部分。

这似乎工作正常，直到来自数据库的数据导致数据库满意的代码中的主键约束。

PT

# ruby-on-rails - Rails 1.X 和 2.X 之间的主要区别是什么

> ID：400470
> 
> 赞同：7
> 
> 时间：2008-12-30T14:59:25.397
> 
> 标签：ruby-on-rails, ruby

大多数死树书籍和网络教程都针对 Rails 1.X。我想知道它们是否值得用来学习 Rails 2.X。如果是这样，我应该避免哪些部分和概念，哪些部分和概念几乎保持不变？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T17:02:34.167

我最喜欢的一本书是 The Pragmatic Programmers 的“滑板”书，“Agile Web Development with Rails”。许多已更改的内容已从核心移至插件，因此，如果它们是您想要或需要的功能，那么您仍然可以使用它们。大多数新功能都在添加，而不是删除。

如其他评论中所述，要了解更多信息，您可以访问以下链接：

*   [http://weblog.rubyonrails.org/2007/9/30/rails-2-0-0-preview-release](http://weblog.rubyonrails.org/2007/9/30/rails-2-0-0-preview-release)
*   [http://www.infoq.com/news/2007/12/rails-20-docs](http://www.infoq.com/news/2007/12/rails-20-docs)

也就是说，我还有 Obie Fernandez 的“The Rails Way”，它涵盖了 Rails 2.0。然而，我仍然发现自己更频繁地接触敏捷书。您可以在此处获取它以及即将推出的第 3 版：http: [//pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition](http://pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition)。

由于 Rails 的开发节奏如此之快，书籍很难真正跟上框架的步伐。我发现阅读博客是了解已添加的新功能或了解我不知道的非新功能的最佳方式。

我订阅的一些博客（还有很多很多可用的）：

*   [http://weblog.rubyonrails.com/](http://weblog.rubyonrails.com/)
*   [http://delicious.com/jnunemaker/railstips](http://delicious.com/jnunemaker/railstips)
*   [http://railstips.org/](http://railstips.org/)
*   [http://blog.hasmanythrough.com/](http://blog.hasmanythrough.com/)
*   [http://ryandaigle.com/](http://ryandaigle.com/)
*   [http://railspikes.com/](http://railspikes.com/)
*   [http://www.railsontherun.com/](http://www.railsontherun.com/)
*   [http://agilewebdevelopment.com/plugins](http://agilewebdevelopment.com/plugins)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-31T17:42:29.997

不，它们不再值得使用。

如果您想从头开始，现在最好的方法是使用[官方的 Rails 指南文档](http://guides.rubyonrails.org/)。

仍然有人出于习惯推荐“敏捷”书，但最好继续前进。

阅读完基本指南后，您可以查看截屏视频，例如 RailsCasts.com 的免费 railscast 或 PeepCode.com 的付费视频。

如果我从今天开始知道我现在所知道的，这就是我会做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T15:05:24.917

看看这个。它是从 2007 年开始的，但它可能会给你一些想法。[http://www.infoq.com/news/2007/12/rails-20-docs](http://www.infoq.com/news/2007/12/rails-20-docs)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-31T04:07:13.170

如果您喜欢死树，请查看Obie Fernandez[的 The Rails Way](https://rads.stackoverflow.com/amzn/click/com/0321445619)。它涵盖了 Rails 2.0，并且可能是目前关于 Ruby on Rails 的最好的纸质书籍。我会说它目前比敏捷书更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T15:09:13.707

我建议您阅读 Rails 2.0 功能，位于[此处](http://weblog.rubyonrails.org/2007/9/30/rails-2-0-0-preview-release "2.0/变更日志的特点")

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T12:20:00.537

他们在每个主要版本上发布博客文章，通常是总结。

[这是 2.0 的帖子](http://weblog.rubyonrails.org/2007/9/30/rails-2-0-0-preview-release)。[这也是 2.2 的帖子](http://weblog.rubyonrails.org/2008/11/21/rails-2-2-i18n-http-validators-thread-safety-jruby-1-9-compatibility-docs)，找不到 2.1 的帖子，但我确定它在某个地方。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-31T12:24:54.163

上面的好资源。考虑一下很快学习MERB。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-03T00:09:49.080

对我来说，这是很好的嵌套资源和更好的迁移......但是那里有很多东西。上面有人发布了链接，但又在这里：[http ://weblog.rubyonrails.org/2007/9/30/rails-2-0-0-preview-release](http://weblog.rubyonrails.org/2007/9/30/rails-2-0-0-preview-release)

# iphone - iPhone API 是否允许我的应用程序响应耳机按钮？

> ID：400472
> 
> 赞同：1
> 
> 时间：2008-12-30T15:00:54.690
> 
> 标签：iphone

我在任何地方的文档中都找不到这个。有谁知道这是否可行，或者它是否处于较低级别，无法用于 3rd 方应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T15:55:07.797

不，不是的。我也找了这个。很抱歉承受坏消息。

# html - 如何启动没有工具栏的新浏览器窗口？

> ID：400475
> 
> 赞同：7
> 
> 时间：2008-12-30T15:01:20.447
> 
> 标签：html

我希望我的主页上有一个超链接，以便在新的浏览器窗口中启动 HTML 帮助页面。但是我希望新窗口只有一个地址栏，即没有菜单、工具栏或状态栏，最好甚至没有可编辑的地址栏。

我已经在很多网站上看到了这一点，但无法弄清楚我需要做什么才能在该状态下启动新窗口。

有什么线索吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-30T15:38:01.620

为了稍微扩展 ocdecio 上面的内容，您可以将`window.open`调用放置在从各种超链接访问的函数中，通过将不同的参数传递给函数来允许不同的链接弹出新窗口。

```
<a href="#" onclick="openWindow('faq.html');">FAQ</a>
<a href="#" onclick="openWindow('options.html');">Options</a>

<script language='Javascript'>
<!--
  // Function to open new window containing window_src, 100x400
  function openWindow(window_src)
  {
    window.open(window_src, 'newwindow', config='height=100, width=400, '
        + 'toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, '
        + 'directories=no, status=no');
  }
-->
</script> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-30T15:02:18.463

```
<SCRIPT LANGUAGE="javascript">
<!--
window.open ('titlepage.html', 'newwindow', config='height=100,
width=400, toolbar=no, menubar=no, scrollbars=no, resizable=no,
location=no, directories=no, status=no')
-->
</SCRIPT> 
```

# java - 在 64 位机器上，Java 中 int 的大小是 32 位还是 64 位？

> ID：400477
> 
> 赞同：68
> 
> 时间：2008-12-30T15:02:15.173
> 
> 标签：java

在 64 位机器上，Java 中 int 的大小是 32 位还是 64 位？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-12-30T15:04:16.823

32 位。整数的大小不随底层计算机而变化，这是 Java 语言的特性之一。请参阅[规范的相关部分](http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.2)。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-30T20:24:42.073

原始数据的大小是[虚拟机规范的一部分，](http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.2)不会改变。将改变的是对象引用的大小，从 32 位变为 64。因此，相同的程序在 64 位 JVM 上将需要更多内存。其影响取决于您的应用程序，但可能很重要。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-30T15:08:15.487

如果需要 64 位整数，请使用 long。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-30T15:05:00.457

32 位。Java 的运行方式与运行它的机器或操作系统无关，至少对于原始数据类型而言，这肯定是正确的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T18:00:48.603

这就是“编译一次，随处运行”口号的后果之一：Java 执行独立于底层硬件字长和字节序；JVM 在任何地方都以相同的方式工作。

这种独立性保证比尝试将操作系统抽象出来要好得多；-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T15:06:13.543

是的，它是 32 位

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-08T00:31:43.530

> 通常被误解的另一点是，无论我们的程序运行在何种架构上，这些数据类型的大小将始终相同。因此，您可能在 64 位机器上运行您的程序，但 int 将始终为 32 位长，因此它具有相同的范围。这对于 C# 和 Java 都是如此。

这是关于此事的完整文章：

[Java 和 C# 中的整数数据类型。](http://blog.svpino.com/2012/08/integral-data-types-in-java-and-c.html)

# windows - 什么时候无法支持 Visual Basic 6.0 应用程序？

> ID：400479
> 
> 赞同：33
> 
> 时间：2008-12-30T15:02:21.770
> 
> 标签：windows, visual-studio, vb6

在过去的 3-5 年中，我一直在更新基于 Visual Basic 6.0 的保险应用程序和商业集成工具包。

根据 Microsoft 的“ [It just works policy](https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-basic-6/visual-basic-6-support-policy?redirectedfrom=MSDN) ”，在 2008 年 4 月 8 日之后不再支持 IDE。

它仍然适用于开发和部署 Visual Basic 6.0 应用程序。

什么时候不可能支持 Visual Basic 6.0 应用程序，或者它们会像 Cobol 应用程序一样永远存在？

更新：Microsoft 2010 年 3 月声明：Visual Basic 团队致力于在 Windows Vista、Windows Server 2008 包括 R2 和 Windows 7 上实现 Visual Basic 6.0 应用程序的“它只是工作”的兼容性。

2011 年 5 月更新：
[Visual Basic 20 岁生日快乐！](https://web.archive.org/web/20150922150636/http://blogs.msdn.com/b/vbteam/archive/2011/05/20/happy-20th-birthday-visual-basic.aspx)

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-30T15:07:03.760

我会说他们处于危险之中，因为操作系统和硬件将在他们之下发展出来。

您可以在 Windows XP 上运行 Visual Basic 6.0，但即便如此，它也已接近生命的尽头（它在死亡的床上不断地复活）。

那些 Cobol 应用程序仍然存在，因为它们运行的​​大型机不会去任何地方。“大铁”是在计算机昂贵且稀有且必须运行 20-30 年的时期建造的。基于 PC 和 Windows 的应用程序并非如此，它们被视为一次性用品。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-12-30T15:09:38.247

如果您需要继续支持 VB6，我建议创建一个包含 XP 和 VB 6 以及所有服务包的 VM。这样，即使您的桌面演变为可能与 VB 6 开发环境不兼容的东西，您也可以继续运行您的开发环境。在 Vista 上安装 Visual Studio 6 两年前就有问题了。

对于维护之外的新开发，我会考虑使用不同的环境。根据我的经验，您最好从一个全新的角度来看待它，而不是限制自己迁移到 VB .NET。迁移已经够麻烦了，您真的应该在最适合您的应用程序的环境中进行新的开发。那可能是 VB .NET，也可能不是。

使用过时的技术进行开发从来都不是问题，直到它成为问题然后为时已晚。您需要留在曲线的最佳位置，并且您是唯一可以决定那是什么的人。如果你换得太早，你可能会做出错误的决定，如果你等待太久，你就会落后太远。正是这样的决定让这个领域既有趣又痛苦。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-30T16:31:01.297

各种机械制造商在VB6中开发了大量的垂直市场软件。VB6 对 ActiveX 控件、ActiveX DLL 的使用以及使用大多数 Win32 DLL 的能力导致许多制造商的各种组件都支持 VB6。

使用 VB6 和支持库比在定制芯片上组装的旧方法或使用 C 至少快一个数量级且更可靠。请注意，即使是 C/C++ 开发人员也得到了帮助，因为他们可以使用新的支持库作为好。

这些应用程序中的许多应用程序都充满了数学函数，这些函数已经过测试，适用于环境和设计它们的机器。

因此，当 Microsoft 使 VB.NET 与 VB6 不兼容时，这对我们中的许多人来说是一笔大买卖。与从 VB3 到 VB4-6 的过渡不同，我们必须在很多地方接触我们的代码才能使其与 .NET 一起使用。事实上，它与用一种新语言重写你的软件是一样的。

由于这些原因，VB6 将继续存在一段时间，因为所有这些机器都在那里。仍然需要新的更新和修复。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-30T15:08:43.147

它可能会工作很多年，但最终你会到达必须维护旧硬件、运行旧的、不可修补的操作系统才能运行软件的地步。同时，您错过了所有新开发的框架和语言优势。最终，您将需要修复某些东西或添加一些在您的环境中不可能的东西，然后您需要为累积的技术债务支付*全部*费用。

我的看法：您应该已经在升级到更新的平台或替换应用程序。我的偏好几乎总是在我被环境强迫之前这样做。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-05T17:49:40.577

我认为 Visual Basic 6.0 应用程序将存在很长时间，就像 COBOL 应用程序一样，并且出于类似的原因。我公司的部分产品仍然是VB6，除非有充分的理由，否则不会更改。我们希望微软在很长一段时间内都不会放弃对 VB6 的支持，因为他们太多的企业客户拥有 VB6 应用程序。他们已经被迫将支持期延长到他们最初的计划之外。我们希望 Raymond Chen 胜过 MSDN 杂志 - 只有当您还记得[Joel](http://www.joelonsoftware.com/articles/APIWar.html)关于微软在向后兼容性与设计纯洁性之间的两难境地的帖子时，这个晦涩的笑话才有意义。

如果您正在考虑升级或重写，恕我直言[这个问题](https://stackoverflow.com/questions/395/how-to-switch-a-large-app-from-vb6-to-vb-net)和[这个问题](https://stackoverflow.com/questions/35233/rewrite-or-repair)有一些信息丰富的答案。如果有您想要的 .NET 功能，或者即使您只是想学习 .NET，您可以使用 Interop 将新的 .NET 组件与现有的 Visual Basic 6.0 混合使用。

[Visual Basic 6.0 新闻组](http://groups.google.co.uk/group/microsoft.public.vb.general.discussion/topics)仍然非常活跃，因此显然有很多像我这样的老手仍在使用 Visual Basic 6.0 进行开发:)

Duffymo, Bruceatk - 只需稍加努力，即可使 Visual Basic 6.0 IDE[在](http://visualstudiomagazine.com/columns/article.aspx?editorialsid=2257)Vista 上运行。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-30T16:07:32.530

我预计在 Windows 7 之后将无法支持 VB6 应用程序。（我希望 VB6 运行时和 IDE 可以在 Windows 7 上运行，但不能在 Windows 8 上运行）

更新：2/17/12 Microsoft 的 Visual Basic 6.0 支持声明现在包括 Windows 8。它们暗示 IDE 也可以在 Windows 8 上运行。 [http://msdn.microsoft.com/nb-no/vbrun/ms788708(en-us).aspx](http://msdn.microsoft.com/nb-no/vbrun/ms788708(en-us).aspx)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-30T17:23:13.407

COBOL 是一个公共标准，由多个供应商在多个硬件平台上进行了多种实现。

VB6 仅受 Microsoft 支持，并且他们已经告诉您，他们不会在新版本的 Windows 上支持它。所以最终它将实际上是死的。COBOL 可能也是如此，但远没有那么快。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-30T15:08:47.687

您将始终能够在 VB 6 中进行开发，因为 Microsoft 不会访问您的计算机来卸载它。如果您不想重写您的应用程序，那么您不必/不必这样做。

但是您现在获得的工具与十年后您将拥有的工具相同。因此，随着新的计算机科学范式的出现，您最终可能会落后（假设您不会开发自己的 VB 编译器）。

通过坚持使用当前的 VB，您的应用程序将始终“可能”维护，但它会变得越来越难。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-30T15:09:27.967

一方面，它们将永远存在，因为 vb 运行时将继续在当今存在的微软操作系统上工作。例如，VB6 应用程序仍然可以在 Vista 中运行。当微软停止在其操作系统上支持 VB6 运行时，VB6 应用程序将无法继续支持。

这意味着它们可能会永远存在，就像某些 COBOL 应用程序今天仍然存在一样。然而，现在几乎永远不应该用实际上已死的语言编写新代码，因此 VB6 技能的市场化将逐渐下降，直到保持一些低水平的稳定状态。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-30T16:13:13.687

通过使用 VirtualPC/VMWare/VirtualBox 等进行虚拟化，理论上应该可以支持 VB6 应用程序，前提是您有一个可以正确运行 VB6 的主机操作系统，您可以进行虚拟化以运行这些应用程序。

我想到许多运行为 NT4 编写的软件的公司缺乏对虚拟机中新机器的驱动程序支持。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-30T16:37:35.823

大约十年前，我开始使用 Visual Basic 3.0 进行专业编程，我可能是最后一个迁移到 .NET 的人（我在 2004 年做到了）。所以你找不到比我更喜欢这个平台的人了。

1.  我认为 Visual Basic 6.0 不会很快消失。里面有很多遗留应用程序。公司会计软件、定制工具，应有尽有。因此，应用程序将无处不在。

2.  新的 Visual Basic 6.0 应用程序的数量正在呈螺旋式下降，因此，如果您想以 Visual Basic 6.0 程序员为职业，那么您已经过时了。

3.  也就是说，对可以维护/修复/升级旧代码的人的需求将会非常强烈。

我有用 Visual Basic 6.0 编写的软件，它有大约 10 万用户，并且仍然很强大。我所有的新开发都是在 C# 中进行的，但是对于这个特定的软件，我想我会在 2009 年底或 2010 年初用 C# 重新编写它。所以至少在那之前我没有看到 Windows 不支持 Visual Basic 6.0。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-01-04T16:08:38.037

我想他们会永远在那里。原因很简单：MS 无法发布不支持它们的操作系统，因为没有大公司会购买该操作系统。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-12-30T15:08:45.533

如果您仍然拥有操作系统和工具，那么支持它们永远不会“不可能”。

真正的问题是你是否还想支持他们。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-11-07T14:55:53.860

[VBA](http://en.wikipedia.org/wiki/Visual_Basic_for_Applications)也需要运行 Visual Basic 6.0 应用程序所需的大部分内容。

而且 VBA 不会很快消失——它的内容太多了。

因此，如果您的年龄足以使用 Visual Basic 6.0 进行开发，我不会担心它会在您有生之年停止工作。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-02-18T13:43:53.350

我认为 Visual Basic 6.0 将继续工作很长时间。首先，.NET 作为商业大规模分布式应用程序的开发平台失败了。似乎没有人像使用 Visual Basic 6.0/C++ 那样使用它。.NET 运行时仍然不可靠（根据经验，出于这个原因，我们提取了一个 .NET 应用程序并用 C++ 重新编码）

不过，我同意就业能力。

失去 Visual Basic 6.0 是微软的一个重大错误：他们被整个 OO 事物所催眠。大多数人想要快速开发，而不是关于漂亮代码的迂腐争论。

[VBA](http://en.wikipedia.org/wiki/Visual_Basic_for_Applications)已经在办公室中取代了 Visual Basic 6.0：谁会想到通过 .NET 路由来操作 Office？

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-08-12T14:32:55.937

运行时仍然是 .NET 的噩梦。

我支持 20,000-30,000 个桌面上的代码并分析它们的注册表。没有任何 .NET 运行时（更不用说 2+）的 PC 数量惊人。如果不雇佣一大批支持人员来帮助重新启动，就不可能向它们大规模分发辅助代码（核心应用程序是 C++）。

C++ 是客户端应用程序的唯一途径。

整个 OO 海市蜃楼对 MS 和我们来说都是一场灾难！多么昂贵的充气机！

...和 ​​ASP.NET webforms/viewstate ...我可以输入 DAYS（我们的编程承包商显然做到了。）

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-11-07T15:17:30.527

VB6 可能会永远存在于保险/银行类型的组织中。硬件移出他们的领域不是问题。他们只会得到某种形式的模拟器。我已经看到一个非常古老的大型机的应用程序在另一个模拟器内的模拟器内工作。

对于非技术人员来说，考虑重写和重新测试已经有效的东西通常没有商业意义。-

欢迎来到痛苦的地狱世界......现在出去:-) -

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-30T17:39:27.103

我怀疑 VB6 应用程序的寿命有限，因为 Redmond 必须让其编码人员忙于从每个人的身下拉扯地毯。

如果您认为在 .NET 中重写您的应用程序可以保证它们的永生性，请记住 DDE、OLE、COM、DAO 等。

如果一个应用程序可以正常工作，那么它应该停止工作，而没有人每隔几年找到重新编写它的资源，但遗憾的是有很多理由。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-07-24T14:56:17.447

如果您开始将机器和操作系统添加到应用程序将不再运行的组合中，它只会变得“不可能”。

Vista 仍将运行 VB6 应用程序。我的猜测是 7 也将继续这样做。如果不是，那么总会有虚拟化。

您的公司可能正在计划的任何类型的硬件/操作系统升级都需要考虑到您现有的 LOB 应用程序。这与考虑当前版本的 Office 或电子邮件客户端没有什么不同。

PC没有真正的到期日期。即使您被 XP 卡住了，您也可以获得可以使用它的硬件，并且会在很长一段时间内继续这样做。如果您购买预建机器，您可能需要简单地降级已安装的操作系统。这没什么大不了的。

也就是说，在事情变得困难之前，您可能还有大约 3 年的时间，然后再过 1 或 2 年，人们就会不再想在您的 IT 部门工作，因为一切都很古老。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-10-02T19:02:43.003

Visual Basic 6.0 工作，直到您需要使用线程，或者直到您将不得不面对大于 4 GB 的文件。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-10-31T10:15:18.097

VB6 程序只不过是一个 Win32 可执行文件，它依赖于许多附带的 COM-ActiveX 库。所以它只是创建一个适当的安装包的问题。

顺便说一句，VB6 IDE 在 Windows 7 64 位机器上完美运行（当然还有一些小的调整）。

PS。不幸的是，我的公司仍然提供**商业**和公开的 VB6 产品，所以 - 我碰巧知道这一点。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2011-06-02T09:58:33.513

我不得不说这是你不能指责很多（而且公正！）诽谤COBOL的事情。

来自 IBM、UNISYS、MicroFocus 的多个平台上的频繁新版本持续支持 COBOL，这些平台支持最新硬件、64 位寻址、内置对 XML 的支持等。甚至还有一个进展良好的 Linux 版本 (OpenCobol)。

此外，语言本身也在不断发展（如果你可以用新的保留字来称呼犯同样的老错误 :-} ）并且最新的语言规范是完全面向对象的，如果你不相信我，请看[这里！](http://www.c-sharpcorner.com/UploadFile/rickmalek/Art02-OOIntro12052005040650AM/Art02-OOIntro.aspx)

所以 COBOL 还没有死，只是过时了。而我认为 VB 6.0 真的已经死了，只是有点晚了。

# sql - 从 Web 服务返回对象

> ID：400495
> 
> 赞同：0
> 
> 时间：2008-12-30T15:07:40.450
> 
> 标签：sql, web-services

如何从 Web 服务中获取对象：

[WebMethod] public DataSet GetVendors(string Database) { SqlConnection sqlConn = new SqlConnection();

```
 sqlConn.ConnectionString = GetConnString(Database);

        // build query
        string strSQL = @"  SELECT      [No_] AS [VendorNo],
                                        LTRIM([Name]) AS [VendorName]

                            FROM        [********_$Vendor]

                            WHERE       LEN(RTRIM([Name])) > 0 /* avoid blank names */

                            AND         [Vendor Posting Group] = 'VEND'

                            ORDER BY    LTRIM([Name]) ASC; /* LTRIM fixes spaces before name */ ";

        SqlDataAdapter da = new SqlDataAdapter(strSQL, sqlConn);

        DataSet ds = new DataSet();

        da.Fill(ds, "Vendors");

        return (ds);
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T15:17:52.303

如果我正确解释了您的问题，请使用您的信息填充您的对象，`DataSet`并将您的返回类型设置为`object`. 或者只是将您填充为该对象的对象返回。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T15:43:04.793

另一种方法是将数据集 xml 作为字符串返回，并在客户端从它创建一个数据集。

虽然我确信加密对象会相当简单，但当我的 Web 服务需要加密（序列化所有内容、加密该字符串、返回字符串、解密、反序列化）时，这种方法帮助了我。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T15:46:28.140

如果您要询问如何返回任何类型的对象，而不是`Object`，那么您将需要序列化该对象。如果您尝试序列化 a `DataSet`，我建议`List`先将其制成 a 或其他数据结构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T16:32:40.967

对我来说似乎很脆弱。它假定客户端将知道如何反序列化该对象，从而将客户端锁定到特定平台（例如 Java EE 或 .NET）。

XML 序列化不那么脆弱，因为它与平台无关，并且将解组的怪癖留给客户端解决。我建议不要返回一个对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T16:33:44.490

不返回 DataSet 的另一个原因是“泄漏抽象”：为什么要将客户端暴露给与持久层有关的任何事情？重新考虑一下。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T17:10:59.517

IMO 从您的 Web 服务返回数据集并不是一个好主意。它假定客户端了解 Dataset、DataTable 等数据结构和类。相反，我建议您使用普通的 CLR 对象，即数据传输对象，或者如果您愿意，您可以使用 XmlNode 作为您的数据类型。您可以使用 WSE 保护您的 Web 服务。

# ms-access - MS-Access 2007 中的字典和哈希表

> ID：400499
> 
> 赞同：2
> 
> 时间：2008-12-30T15:08:28.297
> 
> 标签：ms-access, vba, ms-access-2007

我想在我的访问程序中使用哈希表或字典。显然，我应该为此使用 Microsoft Scripting Runtime Library，但它不起作用。

```
Dim Dict1 As Dictionary

' Create a dictionary instance.
Set Dict1 = New Dictionary 
```

它找不到方法“.compareMode”或“.Add”：

```
With Dict1
  'set compare mode
  .CompareMode = BinaryCompare
  ' Add items to the dictionary.
  .Add 1, "Item 1"
  .Add 2, "Item 2"
  .Add 3, "Item 3"
End With 
```

相反，这些是我唯一可用的：

```
.application
.creator
.delete
etc... 
```

有什么线索吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T15:20:42.797

好吧，首先将*BinaryCompare*更改为*vbBinaryCompare*。

而且我认为您希望像这样进行设置：

```
Set Dict1 = CreateObject(Scripting.Dictionary) 
```

**编辑**只是为了让它更明显，这是安东的最终解决方案。他改变了他声明他的字典的方式如下：

```
Dim SortValues As Scripting.Dictionary 
Set SortValues = New Scripting.Dictionary 
```

# ajax - 是否有任何支持 AJAX 的优秀拖放 Web 应用程序 IDE？

> ID：400503
> 
> 赞同：5
> 
> 时间：2008-12-30T15:08:53.490
> 
> 标签：ajax, user-interface, ide, drag-and-drop, rad

任何人都可以推荐一个 GUI 构建器工具来创建使用 AJAX 与 Web 服务后端通信的 DHTML Web 应用程序吗？我想避免在设计 HTML、编组/解组数据、检查浏览器兼容性等方面搞乱。该工具应该有一个小部件库，可以放入应用程序并连接到功能，并且是可扩展的足以定义自定义小部件。当然免费和/或开源是可取的，但我也会考虑专有工具。

此外，GUI 工具的选择在多大程度上会影响我将用于后端的平台或语言？如果 GUI 只是调用 Web 服务，那么我应该能够在服务器端使用任何东西来提供该接口，但也许某些 gui 端工具使用需要一些特定服务器端代码的专有数据交换格式？

编辑：我不需要可以拖动的小部件，我想要一个允许人们轻松构建 gui 的 IDE（即 RAD 工具）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T23:22:28.487

[WaveMaker](https://www.wavemaker.com)是开源的，在 J2EE 上运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T20:44:52.923

如果您熟悉 Java，也许您可​​以尝试使用 Google Web Toolkit？[http://code.google.com/webtoolkit/](http://code.google.com/webtoolkit/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-01T08:12:04.610

我正在使用 Wavemaker，它完全符合您的要求......它非常易于使用且非常高效......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T16:10:22.400

我相信 Dreamweaver 可以做到这一点，但在我看来，这样的编辑器并不是一个好主意。它们产生可怕的、不可维护的服务器端代码，而且非常不灵活。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-03-09T07:03:21.023

Wavemaker 击败了我用过的所有其他东西。应用程序可以快速开发，具有拖放功能，可以连接到任何 Web 服务，并具有无与伦比的数据库管理工具。唯一的问题是它不断易手/所有权，其未来方向尚不清楚。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T20:40:44.210

[Codegear 的Delphi for PHP](http://www.codegear.com/products/delphi/php)有一些这种能力，但我同意 ceejayoz 的观点，即这些工具不一定能写出好的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-31T15:23:51.040

根据 Dan 的建议，我查看了 GWT。我以前听说过它，但从来没有仔细看过它，它似乎很有趣。当然，它消除了像素推送的烦恼，并使事情在多个浏览器中工作。我还尝试搜索“gwt rad 工具”并得出了几个结果：

*   [实例化 GWT Designer](http://www.instantiations.com/windowbuilder/gwtdesigner/index.html)（商业，59 美元/年）
*   [Wirelexsoft Vistafei](http://www.wirelexsoft.com/VistaFei.html)（仍处于测试阶段，但会有免费版和商业版）

我会看看这些，但如果有人用过别的东西，请告诉我。

# iphone - 如何运行两个 iPhone 模拟器 (Aspen) 实例来试用 WiTap 示例？

> ID：400511
> 
> 赞同：7
> 
> 时间：2008-12-30T15:12:26.993
> 
> 标签：iphone, network-programming, ios-simulator, aspen

有没有人有运气运行两个 iPhone 模拟器实例来测试两者之间的网络代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T15:21:20.517

不可以，但您可以在手机上运行模拟器和 WiTap 代码。我已经做到了，这很酷。

只需为您的开发配置文件配置 WiTap 代码并将其加载到手机上。然后，确保手机在同一个网络 wifi 上，您可以使用运行 WiTap 的模拟器和运行 WiTap 的手机运行您的开发机器。

奇迹般有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-07T06:42:15.030

仅供参考，frankodwyer 以不同用户身份运行 iPhoneSimulator 的想法行不通。Quoth Finder：“您无法打开应用程序‘iPhone Simulator’，因为其他用户已打开它。请其他用户退出应用程序，然后重试。”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T16:01:25.850

只是一个想法，但您可以尝试将另一个用户添加到您的 mac 并在两个帐户中运行模拟器。（我很确定模拟器配置是相对于用户主目录存储的）

第一步是在用户切换下进行。如果可行，它应该有望设置模拟器在第二个实例中所需的一切。然后注销第二个帐户，回到您的常用帐户。现在尝试从终端中的命令行运行第二个模拟器实例，但作为第二个用户帐户（使用“su -”在运行模拟器之前切换另一个用户帐户）。

我不在我的 Mac 上，而且我不知道模拟器二进制文件的名称，否则我会试试这个并为你粘贴一些代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-22T13:20:39.113

请按照以下步骤测试您的应用。

您必须首先为整个过程做一件事：转到项目 - > 编辑项目设置 - > 勾选选项 - 并行构建独立目标。

调试将在模拟器中创建应用程序的代码 例如，您的应用程序名称是 - Instance Close Simulator 转到 Project->New Target -> Instance2 在 Instance2.info.plist 文件中添加“Bundle display name : Instance2” Set Executable Name : Instance2 Select Instance2 Target -> Go to Project -> Set Active Target -> Instance2 Build with Instance2 注意：小心操作，否则你必须重置你的模拟器 For Reset Simulator -> Run Simulator -> iPhone Simulator -> Reset Content & Settings...

现在您在模拟器中有两个应用程序，您可以在所有实例上测试应用程序。

希望它会帮助你:)

拉维坎特纳加尔

# version-control - TFS 结构 - 多个项目还是单个项目？

> ID：400517
> 
> 赞同：8
> 
> 时间：2008-12-30T15:15:10.717
> 
> 标签：version-control, tfs, team-project

我们的小型开发工作室正在寻求将我们的项目从 VSS 迁移到 TFS，并且我们正在评估 TFS 与其他项目（还没有扣动扳机）。我们软件商店的性质是，我们在 VSS 中有 100 多个项目，从小型的单人展示项目到大型企业范围的应用程序。

我们正在尝试确定如何在过渡期间构建我们的项目，并且在大多数情况下，决定将所有内容放入一个项目站点/系统中，每个项目都有一个根目录下的子文件夹。

使用这种类型的设置，我们担心我们将失去 TFS 提供的许多功能（错误跟踪、scrum 燃尽、报告、文档存储等），因为所有项目都将位于同一个门户/项目空间中，而且它将很难分离出单个项目票/项目。

有人对此有经验吗？你的解决方案是什么？你坚持使用 TFS 吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-25T20:04:52.497

这个问题的答案需要您进行一些规划：您打算如何使用 TFS，以及这些功能中的哪些在产品中具有固有的限制。我将我的建议总结为：

1.  每个流程模板需要 [至少] 1 个团队项目。也就是说，如果两个团队想要采用/定制不同的流程，他们将需要分开。

2.  一旦满足条件 #1，您可能不需要像您想的那样多的单独团队项目。90% 的 TFS 功能和设置本质上是分层的，允许您根据每个项目的需要将它们的范围扩大或缩小。

有关完整的详细信息，请参阅：

*   [http://www.codeplex.com/BranchingGuidance/Wiki/View.aspx?title=Guidance%20for%20Structuring%20Team%20Projects](http://www.codeplex.com/BranchingGuidance/Wiki/View.aspx?title=Guidance%20for%20Structuring%20Team%20Projects)
*   [http://blogs.msdn.com/richardb/archive/2007/05/01/tfs-team-project-whitepaper.aspx](http://blogs.msdn.com/richardb/archive/2007/05/01/tfs-team-project-whitepaper.aspx)
*   [http://msdn2.microsoft.com/en-us/library/aa974183(vs.80).aspx](http://msdn2.microsoft.com/en-us/library/aa974183(vs.80).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T15:20:30.877

确实，要获得 TFS 的所有好处，最好使用单独的项目，但是应该权衡这些好处与管理许多项目相关的管理开销。多年前，我使用 Visual Source Safe……离开 Microsoft 后，我​​切换到了 Subversion。回到微软后，我正在使用 TFS，到目前为止我对它非常满意。

流程指导、报告、集成的错误跟踪和紧密的 IDE 集成完美地满足了我的需求。另外，TFS SDK 允许一些有趣的可扩展性场景。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-01T21:36:46.903

我采取的方法是为程序集的每个逻辑分组创建一个 TFS 项目——所以我们有一个框架项目，其中包含所有应用程序共有的程序集，然后我们有一个单独的项目用于我们的报价系统，另一个用于成本核算系统等。虽然工作区映射有点“有趣”，但它确实允许针对不同项目和不同时间尺度的不同设计方法——因此一个团队可能同时完成了一个冲刺（大多数项目使用[Scrum for Team System](http://scrumforteamsystem.com/en/default.aspx)）另一个时间才刚刚开始……

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T15:24:38.497

我已经使用了几个 SCC 提供程序，并且我们已经选择了 TFS，因为它具有其他人没有的所有功能。Bug 关联、CI 和自动化测试无疑是最重要的好处。

至于是否使用多个项目，我想说这取决于项目是否共享任何公共代码。我们倾向于对所有“相关”代码资产使用 TFS 项目，因此如果我们有几个不同的解决方案来做类似的事情并共享大量代码，我们会使用单个 TFS 项目。如果它们没有共同点，那么它们就会成为单独的项目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T15:32:32.037

我不确定这是否在 2008 年得到修复，但在 2005 年，当您构建一个作为根项目的子文件夹的项目时，MSBuild 将提取根项目的整个源代码树——甚至是不属于您的子文件夹的文件。

根据您管理的源数量，这可能会大大增加您的构建时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-07T23:31:51.193

我意识到这篇文章已经过时了，但是 TFS 2010 现在支持一个很棒的功能，称为团队项目集合，它只是项目之上的另一个级别的间接或分组。

这使得创建团队项目变得更加容易，而不会阻塞您的命名空间并鼓励更好的组织！

伟大的链接谈论更多关于收藏

[http://blogs.msdn.com/b/bharry/archive/2009/04/19/team-foundation-server-2010-key-concepts.aspx](http://blogs.msdn.com/b/bharry/archive/2009/04/19/team-foundation-server-2010-key-concepts.aspx)

我不是 sharepoint 用户，但我听说它与 Sharepoint 集合非常相似的概念 :)

# c# - 使用正则表达式匹配版本号部分

> ID：400522
> 
> 赞同：8
> 
> 时间：2008-12-30T15:17:00.337
> 
> 标签：c#, regex, version

我正在尝试将版本号 (Major.Minor.Build.Revision) 的部分与 C# 正则表达式匹配。但是，我对编写 Regex 还是很陌生，即使使用 Expresso 也被证明有点困难。现在，我有这个：

```
(?<Major>\d*)\.(?<Minor>\d*)\.(?<Build>\d*)\.(?<Revision>\d*) 
```

这可行，但要求版本号的每个部分都存在。我想做的也是匹配版本，例如：

```
2.13 
```

在这种情况下，Build 和 Revision 组需要返回空值。如果我对这一切都错了，请随时提出更好的方法。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-30T15:20:55.430

```
(?<Major>\d*)\.(?<Minor>\d*)(\.(?<Build>\d*)(\.(?<Revision>\d*))?)? 
```

使第三和第四部分可选。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-07-14T17:49:36.013

我知道这不是正则表达式，但[System.Version](http://msdn.microsoft.com/en-us/library/system.version.aspx)会为您完成所有工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-08T11:54:56.157

在 VBScript 中测试，这种模式：

```
^(\d+)(\.\d+)?(\.\d+)?(\.\d+)?$ 
```

将验证以下所有 True：

*   23
*   23.1
*   23.1.1
*   23.1.1.1

以下全部为假：

*   23.11.11.33.11
*   23.43 2.1
*   44.11.2 3
*   3q.4.2.1
*   3.4.
*   4.3.21a

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T15:54:46.283

如果您不想使用正则表达式，您可以尝试：

```
System.Diagnostics.FileVersionInfo fvi = System.Diagnostics.FileVersionInfo.GetVersionInfo(<string filePath>);

int major = fvi.FileMajorPart;
int minor = fvi.FileMinorPart;
int build = fvi.FileBuildPart; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-30T10:11:58.747

以上答案无法正常工作

```
(?<Major>\d*)\.(?<Minor>\d*)(\.(?<Build>\d*)(\.(?<Revision>\d*))?)? 
```

试试这个，

```
 var regularExpression = @"^(\d+\.)?(\d+\.)?(\d+\.)?(\*|\d+)$";
                var regex = Regex.IsMatch("1.0.0.0", regularExpression, RegexOptions.IgnoreCase | RegexOptions.CultureInvariant);
                Console.WriteLine(regex); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-30T15:25:08.293

尝试这样的事情：

`(?<Major>\d*)\.?(?<Minor>\d*)?\.?(?<Build>\d*)?\.?(?<Revision>\d*)?`

我只是在捕获组和点中添加了一些“零或一”量词，以防它们不存在。

# visual-studio-2008 - Visual Studio 2008 版本特定参考

> ID：400524
> 
> 赞同：2
> 
> 时间：2008-12-30T15:18:03.737
> 
> 标签：visual-studio-2008

有谁知道 Visual Studio 2008 是否在 Web 应用程序中有一种机制来包含参考而不是特定于版本的参考？

背景故事：我在 VS08 中构建了一个新的 Web 应用程序，它引用了在 VS03 中构建的类库。类库 DLL 包含在 VS08 项目的 \References 文件夹中。参考是特定于版本的，这是我在 VS08 .proj 文件中看到的：

该类库每天通过 CruiseControl 构建一次，因此一旦构建完成，我需要手动更新 VS08 中的 DLL 和版本号。

我正在寻找自动化这个。更新我们存储库中的 DLL 不是问题，但是制作一个构建脚本来解析 .proj 文件并更新版本号并不是最佳的，但它是一种可行的 hack。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T15:23:11.073

不确定这是否会有所帮助，但这是解决此问题的一种方法：

[http://www.codeproject.com/KB/dotnet/ManagingAssemblyVersions.aspx](http://www.codeproject.com/KB/dotnet/ManagingAssemblyVersions.aspx)

它使用这个工具。

[http://code.mattgriffith.net/UpdateVersion/](http://code.mattgriffith.net/UpdateVersion/)

UpdateVersion 工具可用于自动更新您的`AssemblyInfo.cs`文件，以使用对日常构建等实践更友好的版本控制系统。

# asp.net - ASP.Net ScriptControl - 添加 Javascript get_events 方法：可能吗？

> ID：400537
> 
> 赞同：1
> 
> 时间：2008-12-30T15:21:40.967
> 
> 标签：asp.net, javascript, ajax, scriptcontrol, extendercontrol

所以我遇到了一个障碍，显然 get_events 方法只是“包含”在 ExtenderControl 类中。

我需要做什么：

**能够使用 ScriptControl 调用 get_events Javascript 方法，因为此时使用 ExtenderControl 是不可能的。**

我希望有一种简单的方法可以让 scriptControl 的 javascript 对象从某些东西继承（如果可能的话）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T19:38:54.770

事实证明 get_events 方法的创建非常简单。您只需要一个字段来保存字典、几行代码以及在需要时调用事件的内容：

```
getEvents: function() 
{
    if (this._events == null) 
    {
        this._events = new Sys.EventHandlerList();
    }

    return this._events;
}, 
```

现在访问：

```
onItemSelected: function(args)
{
   this.raiseEvent('userItemSelected', args);
},

raiseEvent: function(eventName, eventArgs)
{
    var handler = this.getEvents().getHandler(eventName);
    if(handler)
    {
        handler(this._autoComplete, eventArgs);
    }

}, 
```

基本上 events 只是一个字典，其中包含事件的名称和对要调用的方法的引用。一旦有了方法（处理程序），只需调用它即可。

# database-design - Best practice for managing data-model changes in a released system

> ID：400540
> 
> 赞同：5
> 
> 时间：2008-12-30T15:23:48.640
> 
> 标签：database-design, data-modeling

I am about to embark on the development of a web application project.

I'd like to get something up early and often for early adopters to play with and feedback.

But I envisage the data model changing as the project progresses and my understanding of the system improves.

How should I manage the dilemma of updating the data model appropriately and preventing data loss for early adopters? Should I simply put up a big warning saying "user beware", or should I put in the effort to create migration scripts?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T15:31:06.363

What platform are you using? Ruby on Rails gives you migration scripts as part of the package. If you're in Java-land, you might want to check out [migrate4j](http://migrate4j.sourceforge.net/ "migrate4j").

In the end, I'd suggest doing both things: Warn your users that they're using alpha software, and employ migration scripts with the intent of preserving their data whenever you can (lest they become peeved and lose interest).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T15:29:27.257

Scott Ambler has written some nice stuff about agile databases. There's a [book](https://rads.stackoverflow.com/amzn/click/com/0321293533) and a [website](http://www.agiledata.org/).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-31T13:07:36.510

**对于我公司...**

这是一个硬性规定，在可能的情况下，数据库**必须向后兼容**当前版本的软件。如果不是对罪犯诉诸焦油和羽化策略。

在我们的案例中，我们为客户编写自定义软件应用程序，因此我们在如何实现事物方面具有一定的灵活性……但更多情况下，**客户希望通过实时数据查看他们的更改**。因此，我们必须能够支持应用程序的当前版本，以及客户正在审查和批准的应用程序的新版本。

我们做的其他一些事情是投资**Red Gate 的 Sql Compare 和 Sql Data Compare**。这可以确保来自开发环境的更改正确地转移到生产环境中。

我们最近也**放弃了使用存储过程**，因为它们在维护方面提供了不必要的抽象层......而且它们是邪恶的！=)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T15:30:50.217

The first time I ever heard about agile data was a talk by [Martin Fowler and Pramod Sadalage](http://martinfowler.com/articles/evodb.html).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T12:48:00.763

@bradheintz; I'm using the Microsoft Web Stack.

I have found a short list of .NET related migration tools here:

[http://flux88.com/blog/net-database-migration-tool-roundup/](http://flux88.com/blog/net-database-migration-tool-roundup/).

# multithreading - 对异步方法进行单元测试的最佳方法是什么？

> ID：400552
> 
> 赞同：15
> 
> 时间：2008-12-30T15:28:17.833
> 
> 标签：multithreading, unit-testing

我似乎找不到这个问题的 .NET 答案，我认为这很常见。
单元测试异步方法的最佳模式是什么？

显然我需要调用该方法，然后查看回调是否触发，但是有没有比简单地睡一会儿然后检查回调设置的标志更好的方法？在运行多个测试的情况下，管理标志会有点混乱。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T15:35:33.810

我通常使用匿名委托和等待句柄。例如，我的演示者中有一个名为 SetRemoteTableName 的函数。设置名称后，它还会引发一个事件。我想测试那个异步引发的事件。测试看起来像这样：

```
[TestMethod]
[WorkItem(244)]
[Description("Ensures calling SetRemoteTableName with a valid name works 
              AND raises the RemoteTableNameChange event")]
public void SetRemoteTableNamePositive()
{
  string expected = "TestRemoteTableName";
  string actual = string.Empty;

  AutoResetEvent are = new AutoResetEvent(false);
  SQLCECollectorPresenter presenter = new SQLCECollectorPresenter();
  presenter.RemoteTableNameChange += new EventHandler<GenericEventArg<string>>(
    delegate(object o, GenericEventArg<string> a)
    {
      actual = a.Value;
      are.Set();
    });

  presenter.SetRemoteTableName(expected);
  Assert.IsTrue(are.WaitOne(1000, false), "Event never fired");
  Assert.AreEqual(actual, expected);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T15:37:19.360

拆分代码，使逻辑位于由瘦异步包装器调用的同步代码位中。

然后您的大多数单元测试都可以测试同步代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T15:39:58.293

> 有没有比简单地睡一会儿然后检查回调设置的标志更好的方法？

用等待句柄替换标志。设置等待句柄，而不是设置标志。与其休眠然后检查是否设置了标志，不如等待等待句柄......并等待超时，这样如果你因为计时器到期而醒来，而不是因为你等待的句柄被触发而醒来通过回调，您就知道测试失败了（即在超时期限内未调用回调）。

# sql - 如何在 SQL 中计算带小数的百分比？

> ID：400557
> 
> 赞同：14
> 
> 时间：2008-12-30T15:29:27.770
> 
> 标签：sql, decimal, sum

如何在 SQL 中将其转换为小数？下面是等式，我得到的答案是 78（整数），但真正的答案是 78.6（带小数）所以我需要显示这个，否则报告不会达到 100%

```
(100 * [TotalVisit1]/[TotalVisits]) AS Visit1percent 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-30T15:34:40.067

试试这个：

```
(100.0 * [TotalVisit1]/[TotalVisits]) AS Visit1percent 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-30T15:41:30.663

```
convert(decimal(5,2),(100 * convert(float,[TotalVisit1])/convert(float,[TotalVisits]))) AS Visit1percent 
```

丑陋，但它的工作原理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-06-13T15:03:35.863

```
CAST(ROUND([TotalVisit1]*100.0/[TotalVisits],2)as decimal(5,2)) as Percentage 
```

不丑，工作更好更快，享受吧！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T15:34:18.867

至少在 MySQL 中（如果有帮助的话），如果你想使用浮点数，你必须使用类型 float 字段，而不是常规的 int 字段。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T15:49:20.273

只需将小数添加到 100

```
(100.0 * [TotalVisit1]/[TotalVisits]) AS Visit1percent 
```

这会强制所有处理都以浮点数进行...如果您希望最终输出为文本，并被截断以仅显示一位小数，请使用 Str 函数

```
Str( 100.0 * [TotalVisit1]/[TotalVisits], 4, 1 ) AS Visit1percent 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-01-10T19:57:29.517

这对我来说非常有效：

```
CAST((1.0 * SUM(ColumnA) /COUNT(ColumnB)) as decimal(5,2)) 
```

希望它可以帮助世界上的某个人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T15:40:41.303

这样做可能有点矫枉过正，但您可能希望考虑将所有值转换为浮点数以确保所有阶段的准确性。

```
(100.0 * ( [TotalVisit1]+0.0 )/([TotalVisits]+0.0) ) as Visit1percent 
```

请注意，对于 TotalVisits == 0 的情况，您确实需要在此处输入代码，否则您将得到除以 0 的答案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-29T21:36:34.793

```
SELECT(ROUND(CAST(TotalVisit1 AS DECIMAL)/TotalVisits,1)) AS 'Visit1percent' 
```

这将返回一个小数，而 ROUND 会将其四舍五入为一位数。所以在你的情况下，你会得到 76.6。如果您不想要任何数字，请将 1 更改为 0，如果您想要两位数，请将其更改为 2。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-08-02T12:39:17.377

试试这个，没有round和str或Over()。我发现这是一种更简单的方法。

```
cast((count(TotalVisit1) * 100.0) /TotalVisits as numeric(5,3))  as [Visit1percent] 
```

您可以根据需要更改小数位数

> 例如数字（5,2）或数字（5,4）

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-12-30T16:39:35.490

这可能不会直接解决您的问题，但是当您将一组数字四舍五入以进行显示时，除非您采取特殊预防措施，否则您永远无法保证得到的数字加起来为 100。例如，四舍五入 33.33333、33.33333 和 33.33333 会使总和少一个，因此合乎逻辑的做法是修改集合中最大值的百分比以考虑任何差异。

这是在 Oracle SQL 中使用分析函数和子查询分解 (WITH) 子句生成示例数据的一种方法。

```
with data as (select 25 num from dual union all
              select 25     from dual union all
              select 25     from dual)
select num, 
case
   when rnk = 1
   then 100 - sum(pct) over (order by rnk desc
                             rows between unbounded preceding
                                      and         1 preceding)
   else pct
end pct
from
   (
   select num,
          round(100*ratio_to_report(num) over ()) pct,
          row_number() over (order by num desc) rnk
   from data
   )
/

NUM                    PCT                    
---------------------- ---------------------- 
25                     33                    
25                     33                     
25                     34 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-08-22T21:26:30.107

在 ms Access 中可以使用 SQL 函数 ROUND(number, number of decimals)，它将数字四舍五入到给定的小数位数：

**ROUND((100 * [TotalVisit1]/[TotalVisit]),1) AS Visit1percent**

# sql - 将记录分组到一个临时表中

> ID：400562
> 
> 赞同：0
> 
> 时间：2008-12-30T15:31:45.223
> 
> 标签：sql

我有一个表，其中一列有重复记录，但其他列是不同的。所以像这样

代码子代码版本状态

1234 D1 1个

1234 D1 0

第1234章 1个

1234 数据库 1 个

5678 BB 1 安

5678 BB 0

5678 英国石油公司 1 个

5678 BJ 1 一个

0987 HH 1 A

所以在上表中。subcode 和 Version 是唯一值，而 Code 是重复的。我想将上表中的记录转移到临时表中。只有我想转移的记录是代码的所有子代码的状态为“A”，我只希望它们在临时表中出现一次。

所以从上面的例子。临时表应该只有 5678 和 0987，因为与 5678 相关的所有子代码的状态都是“A”，而 0987（它只有一个）的所有子代码的状态都是 A。1234 被省略，因为它的子代码“DB”的状态为'P'

我会很感激任何帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T15:46:47.657

版本列是否起作用还不清楚。例如，您是否只想考虑具有最大版本的行，或者如果任何 subcde 有一个“A”，它是否应该计算在内。以 5678, BB 为例，其中版本 1 有一个“A”，版本 0 有一个“B”。包含 5678 是因为至少一个子代码 BB 有一个“A”还是因为版本 1 有一个“A”。

以下代码假定您想要所有代码，其中每个子代码至少有一个“A”，无论版本如何。

```
SELECT
    T1.code,
    T1.subcode,
    T1.version,
    T1.status
FROM
    MyTable T1
WHERE
    (
      SELECT COUNT(DISTINCT subcode)
      FROM MyTable T2
      WHERE T2.code = T1.code
    ) =
    (
      SELECT COUNT(DISTINCT subcode)
      FROM MyTable T3
      WHERE T3.code = T1.code AND T3.status = 'A'
    ) 
```

如果您的表很大，性能可能会很糟糕。我将尝试提出一个可能具有更好性能的查询，因为这不是我的想法。

另外，如果您解释了问题的全部范围，也许我们可以找到摆脱该临时表的方法... ;)

这里还有两种可能的方法。仍然有很多子查询，但它们看起来会比上面的方法执行得更好。它们都非常相似，尽管这里的第二个在我的数据库中有更好的查询计划。当然，在数据有限且没有索引的情况下，这不是一个很好的测试。您应该尝试所有方法，看看哪种方法最适合您的数据库。

```
SELECT
    T1.code,
    T1.subcode,
    T1.version,
    T1.status
FROM
    MyTable T1
WHERE
    EXISTS
    (
        SELECT *
        FROM MyTable T2
        WHERE T2.code = T1.code
          AND T2.status = 'A'
    ) AND
    NOT EXISTS
    (
        SELECT *
        FROM MyTable T3
        LEFT OUTER JOIN MyTable T4 ON
            T4.code = T3.code AND
            T4.subcode = T3.subcode AND
            T4.status = 'A'
        WHERE T3.code = T1.code
          AND T3.status <> 'A'
          AND T4.code IS NULL
    )

SELECT
    T1.code,
    T1.subcode,
    T1.version,
    T1.status
FROM
    MyTable T1
WHERE
    EXISTS
    (
        SELECT *
        FROM MyTable T2
        WHERE T2.code = T1.code
          AND T2.status = 'A'
    ) AND
    NOT EXISTS
    (
        SELECT *
        FROM MyTable T3
        WHERE T3.code = T1.code
          AND T3.status <> 'A'
          AND NOT EXISTS
            (
                SELECT *
                FROM MyTable T4
                WHERE T4.code = T3.code
                  AND T4.subcode = T3.subcode
                  AND T4.status = 'A'
            )
    ) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T17:03:48.530

这是我的解决方案

```
SELECT Code
FROM
(
  SELECT
    Code,
    COUNT(SubCode) as SubCodeCount
    SUM(CASE WHEN ACount > 0 THEN 1 ELSE 0 END)
      as SubCodeCountWithA
  FROM
  (
    SELECT
      Code,
      SubCode,
      SUM(CASE WHEN Status = 'A' THEN 1 ELSE 0 END)
        as ACount
    FROM CodeTable
    GROUP BY Code, SubCode
  ) sub
  GROUP BY Code
) sub2
WHERE SubCodeCountWithA = SubCodeCount 
```

让我们从内到外分解它。

```
 SELECT
      Code,
      SubCode,
      SUM(CASE WHEN Status = 'A' THEN 1 ELSE 0 END)
        as ACount
    FROM CodeTable
    GROUP BY Code, SubCode 
```

将代码和子代码分组（每一行是代码和子代码的不同配对）。查看每个配对中出现了多少个 A。

```
 SELECT
    Code,
    COUNT(SubCode) as SubCodeCount
    SUM(CASE WHEN ACount > 0 THEN 1 ELSE 0 END)
      as SubCodeCountWithA
  FROM
    --previous
  GROUP BY Code 
```

按代码重新组合这些配对（现在每一行都是一个代码）并计算有多少子代码，以及有多少子代码有一个 A。

```
SELECT Code
FROM
  --previous
WHERE SubCodeCountWithA = SubCodeCount 
```

发出与带有 A 的子代码具有相同数量的子代码的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T15:43:19.677

在您的选择中，添加一个 where 子句，内容如下：

```
Select [stuff]
From Table T
Where Exists
    (Select * From Table 
     Where Code = T.Code
        And Status = 'A')
  And Not Exists
    (Select * From Table I
     Where Code = T.Code 
       And Not Exists
          (Select * From Table
           Where Code = I.Code
               And SubCode = I.SubCode
               And Status = 'A')) 
```

在英语中，显示至少一行状态为“A”的行，并且没有任何特定子代码的行，至少没有一行带有该代码/子代码的行，状态为“A”

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-30T15:45:32.527

```
INSERT theTempTable (Code)
SELECT t.Code
FROM   theTable t
       LEFT OUTER JOIN theTable subT ON (t.Code = subT.Code AND subT.status <> 'A')
WHERE  subT.Code IS NULL
GROUP BY t.Code 
```

这应该可以解决问题。逻辑有点棘手，但我会尽力解释它是如何得出的。

与 IS NULL 检查相结合的外连接允许您搜索*缺少*的条件。将其与您通常要查找的内容相反（在本例中为 status = 'A'），当*没有不匹配的行时*查询成功。这与（（没有行）OR（所有行匹配））相同。由于我们知道由于表上的其他查询而存在行，因此所有行都必须匹配。

# c# - 有没有办法在.NET中继承一个没有构造函数的类？

> ID：400565
> 
> 赞同：8
> 
> 时间：2008-12-30T15:32:04.613
> 
> 标签：c#, .net, inheritance, httpwebrequest

我目前正在尝试修改一些 HttpWebRequest 函数，但我无法通过继承来完成，因为 HttpWebRequest 没有公共构造函数（除了反序列化构造函数）。有解决方法吗？

我的目标是编写类似于下面示例的代码，但此类对象必须继承 HttpWebRequest 属性和方法：

```
using System;
using System.Net;
using System.Threading;

public class AsyncWebRequest:WebRequest
{
    private readonly AsyncCallback getResponseCallback;
    private readonly Uri uri;
    private volatile int RetriesLeft = 3;
    private volatile WebRequest request;

    public AsyncWebRequest(string uri, AsyncCallback getResponseCallback)
       :this(new Uri(uri), getResponseCallback)
    {
    }

    public AsyncWebRequest(Uri uri, AsyncCallback getResponseCallback):base()
    {
        this.uri = uri;
        this.getResponseCallback = getResponseCallback;
    }

    private IAsyncResult BeginGetResponse()
    {
        request = HttpWebRequest.CreateDefault(uri);
        ((HttpWebRequest)request).ReadWriteTimeout = Timeout;
        var result = request.BeginGetResponse(GetResponseCallback, null);
        ThreadPool.RegisterWaitForSingleObject(result.AsyncWaitHandle,
            GetResponseTimeout, null, Timeout, true);
        return result;
    }

    private void GetResponseTimeout(object state, bool timedOut)
    {
        if (timedOut)
        {
            Retry();
        }
    }

    private void Retry()
    {
        request.Abort();
        bool retry = false;
        lock (request)
        {
            if (RetriesLeft > 0)
            {
                Interlocked.Decrement(ref RetriesLeft);
                retry = true;
            }
        }
        if (retry)
        {
            BeginGetResponse();
        }
        else
        {
            getResponseCallback(null);
        }
    }

    private void GetResponseCallback(IAsyncResult AsyncResult)
    {
        try
        {
            getResponseCallback(AsyncResult);
        }
        catch(WebException webException)
        {
            Retry();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-30T16:32:40.497

您不能通过从 HttpWebRequest 的继承（如果您不想调用序列化构造函数），但您可以通过组合和委托，以及通过从 WebRequest 的继承（我不确定这是否适合您，但是在功能上它非常相似）。WebRequest 有一个默认构造函数。

在这种情况下，您不能让类“成为”一个 HttpWebRequest（如在 is-a 关系中），因为您不能从它扩展，但它将“成为”一个 WebRequest，这应该就足够了。

您可以编写一个继承自 WebRequest 的类，该类具有 WebRequest 类型的实例成员，创建一个 HttpWebRequest 并分配给新类型的构造函数中的实例成员，并将所有调用委托给该引用（一种装饰器模式）：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Text;

namespace ClassLibrary1
{
    public class MyHttpWebRequest : WebRequest
    {
        private WebRequest request;

        public MyHttpWebRequest(string uri)
        {
            request = HttpWebRequest.Create(uri);
        }

        public override WebResponse GetResponse()
        {
            // do your extras, or just delegate to get the original code, as long
            // as you still keep to expected behavior etc.
            return request.GetResponse();
        }

    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T15:35:37.913

除非你可以欺骗序列化构造函数来做你的投标，否则没有，没有办法。

该类的构造函数是内部的，因此您无法调用它们。

# java - 使用 Java Graphics.drawString 替换的充分理由？

> ID：400566
> 
> 赞同：6
> 
> 时间：2008-12-30T15:32:09.807
> 
> 标签：java, graphics, text, 2d

有谁知道可以让您在 Java2D 中绘制完全合理的文本的现有代码？

例如，如果我说，`drawString("sample text here", x, y, width)`是否有一个现有的库可以计算出有多少文本适合宽度，做一些字符间距以使文本看起来不错，并自动进行基本的自动换行？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-30T16:07:49.143

虽然不是最优雅和最健壮的解决方案，但这里有一个方法，它将获取[`Font`](http://java.sun.com/javase/6/docs/api/java/awt/Font.html)当前[`Graphics`](http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html)对象的 并获取它[`FontMetrics`](http://java.sun.com/javase/6/docs/api/java/awt/FontMetrics.html)，以便找出在哪里绘制文本，并在必要时移动到新行：

```
public void drawString(Graphics g, String s, int x, int y, int width)
{
    // FontMetrics gives us information about the width,
    // height, etc. of the current Graphics object's Font.
    FontMetrics fm = g.getFontMetrics();

    int lineHeight = fm.getHeight();

    int curX = x;
    int curY = y;

    String[] words = s.split(" ");

    for (String word : words)
    {
        // Find out thw width of the word.
        int wordWidth = fm.stringWidth(word + " ");

        // If text exceeds the width, then move to next line.
        if (curX + wordWidth >= x + width)
        {
            curY += lineHeight;
            curX = x;
        }

        g.drawString(word, curX, curY);

        // Move over to the right for next word.
        curX += wordWidth;
    }
} 
```

此实现将通过使用以空格字符作为唯一单词分隔符的方法将给定`String`的数组分隔，因此它可能不是很健壮。它还假设单词后面跟着一个空格字符，并在移动位置时采取相应的行动。`String`[`split`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#split(java.lang.String))`curX`

如果我是您，我不建议使用此实现，但可能为了进行另一个实现所需的功能仍将使用[`FontMetrics`class](http://java.sun.com/javase/6/docs/api/java/awt/FontMetrics.html)提供的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:25:09.483

对于自动换行，您可能对[如何使用 Graphics 在多行上输出字符串](https://stackoverflow.com/questions/239537/how-to-output-a-string-on-multiple-lines-using-graphics "如何使用图形在多行上输出字符串")感兴趣。这里没有任何理由，不确定添加是否容易（或不可能！）...

# ssl - 服务器拒绝 Biztalk X.509 证书

> ID：400567
> 
> 赞同：0
> 
> 时间：2008-12-30T15:32:10.137
> 
> 标签：ssl, biztalk, ssl-certificate

我们的 ssl 证书最近过期了，所以我们得到了 CA 颁发的新证书。不幸的是，当 biztalk 使用此证书访问服务器时，服务器拒绝它，给我们一个 403.17 错误（已过期或尚未生效）。

所以我检查了证书的日期，似乎还可以。但要真正检查证书是否有效，我们将其加载到 IE7 中并尝试访问服务器。这样做很有效。

Biztalk 查看证书的硬编码位置，但我们已经用新文件替换了该文件。

知道为什么当 Biztalk 尝试访问服务器时，它会被拒绝吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T15:36:10.643

也许 Biztalk 已经缓存了您的证书？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-08T15:46:24.693

我们已经找到了解决方案。问题是访问证书和私钥。更换证书时，安装它是不够的。为什么？因为它只会在当前用户下安装。

Biztalk 作为用户运行：BizTalkSVC，并且该帐户没有访问证书的权限。

一旦获得许可，它就会像魅力一样运行！

# sql - 何时是使用 SQL 语句“SELECT [results] FROM [tables] WHERE [conditions] FETCH FIRST [n] ROWS ONLY”的合适时间

> ID：400575
> 
> 赞同：2
> 
> 时间：2008-12-30T15:34:49.133
> 
> 标签：sql, select

我不太确定只选择一定数量的行会比简单地制作更具体的选择语句更好。我有一种感觉，我错过了一些非常直接的东西，但我无法弄清楚。我在任何 SQL 方面的经验都不到 6 个月，而且很粗略，所以如果这是一个非常简单的问题，但我找不到明确的答案，我很抱歉。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T16:50:32.973

我知道两种常见用途：

分页：一定要指定一个排序。如果未指定排序，许多数据库实现会使用任何便于执行查询的方式。这种“最佳”排序行为可能会产生非常不可预测的结果。

```
SELECT top 10 CustomerName
FROM Customer
WHERE CustomerID > 200 --start of page
ORDER BY CustomerID 
```

子查询：可以发出子查询的许多地方都要求结果是单个值。在许多情况下，top 1 只比 max 快。

```
--give me some customer that ordered today
SELECT CustomerName
FROM Customer
WHERE CustomerID =
(
  SELECT top 1 CustomerID
  FROM Orders
  WHERE OrderDate = @Today
) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T15:37:48.533

通常是自定义分页。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T15:58:14.297

我们使用该语句的原因如下：

1.  仅显示最相关的结果（例如前 100 个），而无需将所有行从数据库传输到客户端。在这种情况下，我们也使用 ORDER BY。

2.  我们只想知道是否有匹配的行并举几个例子。在这种情况下，我们不对结果进行排序，再次，FETCH FIRST 比让数据库准备传输大量行然后将它们扔给客户端要便宜得多。这通常是在软件开发过程中，需要感受一下某个 SQL 是否正确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T15:46:03.120

当您想向用户显示这些值时，您可能只需要 N 行。通常，数据库服务器可以获取前 N 行，比它获取所有行的速度要快，因此您的屏幕重绘可以快一点。

Oracle 甚至有一个名为 FIRST_ROWS 的提示，它表明快速恢复数据比有效恢复数据更重要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T16:09:09.280

SQL 的设计者同意你的观点，这就是为什么标准 SQL 不包括 top/limit/fetch first 等的原因。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T16:09:37.173

想想谷歌搜索结果和通常用于结果的页面数。

虽然很明显，他们的情况还有很多，但这就是想法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T17:49:33.523

除了分页之外，任何时候您想要从表中获取最多或最少的 [在此处插入度量] 行，按 [任何度量] 排序并限制为 1 行，IME 都比使用 MIN/MAX 进行子查询更好。可能因发动机而异。

# search - 如何在 xp 中为 jpeg 图像创建元数据

> ID：400599
> 
> 赞同：1
> 
> 时间：2008-12-30T15:43:50.020
> 
> 标签：search, metadata, jpeg

我有一个呆伯特卡通档案，并想以某种方式组织它们，我可以根据关键字搜索的顺序找到我需要的那个。

我正在寻找有关以编程方式完成此任务的合理方法的建议。我倾向于 perl 来实现。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T15:49:31.800

就个人而言，作为 Perl 的粉丝，我会使用 Image::Metadata::JPEG。然而，有很多图书馆可以做这种事情。

如果您正在寻找执行此操作的程序，我知道 Photoshop 可以，而且我相信还有其他编辑器（The Gimp）也可以。

我不确定您是否也在寻找用于搜索图像的解决方案，但是有许多照片归档程序可以让您在其中进行标记和搜索。毕加萨浮现在脑海。

# c# - C# 和 PhP 中 :: 运算符的含义

> ID：400609
> 
> 赞同：1
> 
> 时间：2008-12-30T15:47:42.803
> 
> 标签：c#, php

在我的工作中，我在 Php 中遇到了诸如 global:: (C#) 或 G:Loading($value) 之类的语法，它们是什么意思？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T15:53:47.423

在 C#`::`中是命名空间别名限定符运算符，并`global`表示全局命名空间。如果您有重叠的类和命名空间，这是必要的。

例如，如果您有类`Foo.Bar`，`Baz.Foo.Bar`那么该引用`Foo.Bar`可能是`Foo.Bar`在全局命名空间和`Baz`命名空间中都存在的模棱两可的引用。但是，通过说`global::Foo.Bar`您明确地将引用范围限定为全局名称空间，因此它不再模棱两可。

[更多信息在这里](http://msdn.microsoft.com/en-us/library/c3ay4x3d.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T15:51:09.473

在 PHP:: 中用于访问静态成员或方法，参见[http://www.php.net/manual/en/language.oop5.static.php](http://www.php.net/manual/en/language.oop5.static.php)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T15:54:20.730

如果是 C#，`::`则称为命名空间别名限定符。

如果有歧义，它会限定您所在的命名空间。例如：

```
using MyNameSpace;

...

global::System.Data 
```

将`System.Data`命名空间与`MyNameSpace.System.Data`.

看一下关于`::`操作符的 C# 参考：

[http://msdn.microsoft.com/en-us/library/htccxtad.aspx](http://msdn.microsoft.com/en-us/library/htccxtad.aspx)

更有帮助的是，MSDN 文章展示了它的使用

[http://msdn.microsoft.com/en-us/library/c3ay4x3d.aspx](http://msdn.microsoft.com/en-us/library/c3ay4x3d.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T20:07:04.387

在基于类的面向对象编程语言（如 C++、Java、PHP 等）中，有一些属性（也称为字段）是数据，只是变量或常量，还有方法是类的功能，实际上是功能（例程）。每个类都可以实例化为对象。每个对象在开始时都具有基类的所有数据和功能，但是数据可以从一个对象到另一个对象进行更改和不同。有2种属性和2种方法。一些属性在类的所有对象之间共享。这意味着如果您更改类的此数据，所有实例化对象的相同数据将更改为新值。这种属性称为类属性或静态属性（因为在定义这些变量时，在大多数语言中，您将使用 static 关键字）。其他一些属性特定于每个对象。改变on对象的数据，不影响其他对象的数据。这些被称为对象属性或实例属性。有些方法是从对象调用的，有些方法称为对象方法。这些是对象方法，要使用它们，您需要首先实例化一个类并使用该对象。使用类本身调用其他一些方法。这些是类方法（或静态方法），如果您想要这些功能之一，则不需要对象。要使用对象属性/方法，在 PHP（如 C++）中，您应该使用 -> 运算符：这些被称为对象属性或实例属性。有些方法是从对象调用的，有些方法称为对象方法。这些是对象方法，要使用它们，您需要首先实例化一个类并使用该对象。使用类本身调用其他一些方法。这些是类方法（或静态方法），如果您想要这些功能之一，则不需要对象。要使用对象属性/方法，在 PHP（如 C++）中，您应该使用 -> 运算符：这些被称为对象属性或实例属性。有些方法是从对象调用的，有些方法称为对象方法。这些是对象方法，要使用它们，您需要首先实例化一个类并使用该对象。使用类本身调用其他一些方法。这些是类方法（或静态方法），如果您想要这些功能之一，则不需要对象。要使用对象属性/方法，在 PHP（如 C++）中，您应该使用 -> 运算符：

```
object->method();
object->property; 
```

要在 PHP（如 C++）中使用类属性/方法，您应该使用 :: 运算符：

```
class::method();
class::property; 
```

在像 Jave 这样的语言中，运算符 . 用于所有属性/方法：

```
object.method();
class.property; 
```

假设你有一个 Circle 类。这个类定义了一些数据，如半径、中心坐标和 PI 值的常量。还有一种计算圆面积的方法。

这里有一些 PHP 代码可以清楚地说明：

```
<?php
class Circle {
    public $radius;
    public $centerX;
    public $centerY;
    public static $PI = 3.1415;
    public function __construct($r,$x,$y) {
        $this->radius = $r;
        $this->centerX = $x;
        $this->centerY = $y;
    }
    public function getArea() {
        return self::$PI * $this->radius * $this->radius;
    }
}
$circle1 = new Circle(10,0,0);
echo $circle1->getArea() . "<br>\n";
$circle2 = new Circle(15,10,12);
echo $circle2->getArea() . "<br>\n";
Circle::$PI = 3.14;
echo $circle1->getArea() . "<br>\n";
echo $circle2->getArea() . "<br>\n";
?> 
```

在这个例子中，我们定义了一个圆形类，它具有对象属性（radius、centerX、CenterY）、对象方法（getArea()）和一个类属性（PI）。通过更改 PI 静态属性，两个对象的面积都会受到影响。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-15T12:50:05.873

考虑以下示例：

```
namespace  A { 
    public class MyClass { }
} 

namespace namespaceB
{
    public class A
    {
        public class MyClass { }
    }

    public class OtherClass
    {
        public A.MyClass MyAClass;
    }
} 
```

解释：

在上面的示例中，编译器总是将 MyAClass 解析为类型 namespaceB.A.MyClass。

如果您希望它是 A.MyClass，那么在 C# 2.0 之前没有办法做到这一点。

在 C# 2.0 中，您将使用： public class MyOtherClass

```
{ public global::A.MyClass yAClass; } 
```

表明您不应使用本地命名空间范围，而应使用根命名空间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T15:55:36.843

在 C# 中，global:: 运算符用于确保将以下名称解释为全局名称表达式而不是本地名称表达式。这样做的主要用途是当开发人员有一个嵌套命名空间，其中名称与全局命名空间相同。如果没有 global:: 操作符，就无法访​​问全局版本。

```
namespace Foo { 
  namespace System {
    class DateTime {} 
    class Example {
      object Example() { 
        return System.DateTime.Now; // Returns Foo.System.DateTime.Now
        return global::System.DateTime.Now; // Returns mscorlib,System.DateTime.Now
      }
    }
  }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T15:56:20.367

在 PHP 中，它被称为范围解析运算符 (Paamayim Nekudotayim)，并允许访问类中的成员或常量

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T15:58:30.923

在 C# 中，`::`运算符是命名空间别名限定符。它用于将标识符解析为适当的名称空间，尤其是在存在歧义的情况下。

因此，假设您通过创建命名空间别名

```
using IOAlias = System.IO; 
```

并希望声明`StreamReader`该类的一个实例。你可以通过

```
IOAlias::StreamReader sr = new StreamReader(path); 
```

此外，您可以通过以下方式解析到全局命名空间

```
global::System.IO.StreamReader sr = new StreamReader(path); 
```

# asp.net - 当我禁用提交按钮以防止双击时，为什么我的表单没有发布？

> ID：400616
> 
> 赞同：8
> 
> 时间：2008-12-30T15:49:32.393
> 
> 标签：asp.net, javascript, client-side, double-submit-prevention

像地球上的其他 Web 开发人员一样，我遇到了用户双击表单上的提交按钮的问题。我的理解是，处理此问题的常规方法是在第一次单击后立即禁用按钮，但是当我这样做时，**它不会发布**.

我确实对此进行了一些研究，上帝知道有足够的信息，但是其他问题，例如[Disable button on form submission](https://stackoverflow.com/questions/106509/disable-button-on-form-submission)，禁用按钮似乎有效。[提交后禁用按钮](https://stackoverflow.com/questions/286149/disable-button-after-submit)的原始海报似乎和我有同样的问题，但没有提到他如何/如果他解决了这个问题。

这是一些关于如何重复它的代码（在 IE8 Beta2 中测试，但在 IE7 中有同样的问题）

我的aspx代码

```
<%@ Page Language="C#" CodeFile="Default.aspx.cs" Inherits="_Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<script language="javascript" type="text/javascript">
    function btn_onClick()
    {
        var chk = document.getElementById("chk");
        if(chk.checked)
        {
            var btn = document.getElementById("btn");
            btn.disabled = true;
        }
    }
</script>
<body>
    <form id="form1" runat="server">
        <asp:Literal ID="lit" Text="--:--:--" runat="server" />
        <br />
        <asp:Button ID="btn" Text="Submit" runat="server" />
        <br />
        <input type="checkbox" id="chk" />Disable button on first click
    </form>
</body>
</html> 
```

我的cs代码

```
using System;

public partial class _Default : System.Web.UI.Page 
{
    protected override void OnInit(EventArgs e)
    {
        base.OnInit(e);
        btn.Click += new EventHandler(btn_Click);
        btn.OnClientClick = "btn_onClick();";
    }

    void btn_Click(object sender, EventArgs e)
    {
        lit.Text = DateTime.Now.ToString("HH:mm:ss");
    }
} 
```

请注意，当您单击按钮时，会发生回发，并且时间会更新。但是当您选中该复选框时，下次单击该按钮时，该按钮被禁用（如预期的那样），但永远不会回发。

我到底在想什么？？？

提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T16:19:03.193

我认为您只是缺少此标签：

```
UseSubmitBehavior="false" 
```

试试这样：

```
<asp:Button ID="btnUpdate" runat="server" UseSubmitBehavior="false" OnClientClick="if(Page_ClientValidate()) { this.disabled = true; } else {return false;}" Text = "Update" CssClass="button" OnClick="btnUpdate_Click" ValidationGroup="vgNew"/> 
```

[解释](http://rumandcode.wordpress.com/2008/06/20/single-click-aspnet-button/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-30T16:08:13.557

fall888 是对的，您的方法不适用于跨浏览器。我使用[这个小片段](http://drawohara.com/post/30636169/javascript-prevent-double-click-submit-with-jquery)来防止双击。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-27T08:49:46.627

`UseSubmitBehavior="false"`将提交按钮转换为普通按钮 ( `<input type="button">`)。如果您不希望这种情况发生，您可以隐藏提交按钮并立即在其位置插入禁用按钮。因为这种情况发生得如此之快，它看起来就像按钮被用户禁用。详细信息在[Josh Stodola 的博客中](http://web.archive.org/web/20090210030547/http://blog.josh420.com/archives/2008/02/how-to-disable-the-submit-button-ofweb-form.aspx)。

代码示例（jQuery）：

```
$("#<%= btnSubmit.ClientID %>").click(function()
{
  $(this)
    .hide()
    .after('<input type="button" value="Please Wait..." disabled="disabled" />');
}); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-30T15:54:51.773

“禁用”HTML 控件并不总是在所有主要浏览器中产生一致的行为。所以我尽量避免在客户端这样做，因为（使用 ASP.NET 模型）在这种情况下，您需要跟踪客户端和服务器上元素的状态。

我要做的是通过将按钮的 className 切换到包含以下内容的 CSS 类来将按钮从窗口的可见部分移开：

```
.hiddenButton
{
  position: absolute;
  top: -1000px;
  left: -1000px;
} 
```

现在，用什么代替按钮？

1.  看起来像禁用按钮的图像
2.  或者只是显示“请稍候...”的纯文本

这可以以相同的方式完成，但相反。从页面加载时隐藏的元素开始，然后在表单提交时切换到可见的 className。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-30T10:44:19.080

我们使用以下 JQuery 脚本来禁用**所有按钮**（输入类型=提交和按钮），当单击**一个按钮**时。

我们只是将脚本包含在一个全局 JavaScript 文件中，因此在创建新按钮时我们不需要记住任何事情。

```
$(document).ready(function() {
    $(":button,:submit").bind("click", function() {
        setTimeout(function() {
            $(":button,:submit").attr("disabled", "true");
        }, 0);
    });
}); 
```

通过检查 Page_ClientValidate() 可以轻松扩展此脚本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T16:30:00.753

```
document.getElementById('form1').onsubmit = function() {
    document.getElementById('btn').disabled = true;
}; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-29T15:56:38.987

这是执行此操作的正确且简单的方法：

它适用于所有浏览器（与上面接受的解决方案不同）。

在您的应用程序中创建一个辅助方法（例如在 Utlity 命名空间中）：

```
 Public Shared Sub PreventMultipleClicks(ByRef button As System.Web.UI.WebControls.Button, ByRef page As System.Web.UI.Page)
        button.Attributes.Add("onclick", "this.disabled=true;" + page.ClientScript.GetPostBackEventReference(button, String.Empty).ToString)
    End Sub 
```

现在从每个网页背后的代码中，您可以简单地调用：

```
 Utility.PreventMultipleClicks(button1, page) 
```

其中 button1 是您要防止多次点击的按钮。

这只是将点击处理程序设置为：this.disabled=true

然后附加按钮自己的回发处理程序，所以我们得到：

onclick="this.disabled=true";__doPostBack('ID$ID','');"

这不会破坏页面的默认行为，并且可以在所有浏览器中按预期工作。

享受！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-31T18:03:58.957

**对于 JQUERY 用户**

在使用 jQuery 事件侦听器时，尝试将 javascript 直接添加到 ASP.NET 按钮上的 onClick 事件时，您会遇到各种问题。

我发现禁用按钮并使回发工作的最佳方法是执行以下操作：

```
 $(buttonID).bind('click', function (e) {

        if (ValidateForm(e)) {

            //client side validation ok!
            //disable the button:
            $(buttonID).attr("disabled", true);

            //force a postback:
            try {
                __doPostBack($(buttonID).attr("name"), "");
                return true;
            } catch (err) {
                return true;
            }

        }
        //client side validation failed!
        return false;
    }); 
```

其中**ValidateForm**是您的自定义验证函数，如果您的表单验证客户端，则返回 true 或 false。

buttonID是**按钮**的 id，例如 '#button1'

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T16:01:52.197

出于调试目的，如果在 if(chk.checked) 中添加 else 子句会发生什么？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-30T16:47:51.513

确保您的 javascript 函数返回 true（或将评估为 boolean true 的值），否则表单将不会被提交。

```
function btn_click()
var chk = document.getElementById("chk");
    if(chk.checked)
    {
            var btn = document.getElementById("btn");
            btn.disabled = true;
            return true;   //this enables the controls action to propagate
    }
    else    return false;  //this prevents it from propagating
} 
```

# operating-system - 哪个windows server 2008 版本用于数据库服务器

> ID：400622
> 
> 赞同：1
> 
> 时间：2008-12-30T15:51:31.563
> 
> 标签：operating-system, windows-server-2008

我们正在升级我们的服务器，我们将拥有 3 台服务器 - 1 台 db 服务器和 2 台前端 Web 服务器。对于 Web 服务器，我们将使用 2008 Web 版本，但我们无法决定为 db 使用哪个版本。

起初我们考虑使用标准版，但使用我们的主机，每月的费用比网络版贵 10 倍。我们的第三种选择是使用数据中心版，它的成本仅比 Web 版高 5 倍。

我们可以并且应该在 Windows Server Web 版上运行 SQL 2008 吗？如果不是，我们应该选择哪个版本？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T16:00:28.473

[此处](http://msdn.microsoft.com/en-us/library/ms143506.aspx)为所有 SQL 2008 版本的最低要求。

Server 2008 Web 被列为受支持的操作系统，所以你应该没问题。

编辑：我应该澄清一下，*可以*在 Windows 服务器的 Web 版上运行 SQL 2008，但我不确定这样做的限制是什么。Server Web 比 Server Standard 有更多限制，但我不确定它们是什么 - 无论是硬件相关还是其他。

# delphi - 如何使用 Delphi 将多个文件压缩到一个存档中

> ID：400627
> 
> 赞同：11
> 
> 时间：2008-12-30T15:53:56.300
> 
> 标签：delphi, compression

我需要使用 Delphi 将多个文件压缩到一个存档中。我更喜欢使用免费软件组件或开源组件，因为我非常便宜 :-)

我的主要要求是：

1.  可以加密存档
2.  可以创建任何拥有 WinZip 副本的人都可以打开的通用存档

有人对他们使用过的组件有建议吗？请随时建议免费以及商业组件/库。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T16:02:22.040

也许[DelphiZip](http://www.delphizip.org/)是您正在寻找的，它似乎也支持加密，并且与 WinZip 兼容。它是在 LGPL 下发布的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-08T13:29:15.843

[KaZip](http://www.vclcomponents.com/Delphi/Compression__Encryption/KAZip-info.html)是一个开源的 ZIP 归档器。这是它的描述：

> KAZIP 是快速、简单的 ZIP 归档器和 dearchiver，它使用最流行的 ZIP 格式。Inflate - Deflate zip 压缩格式（不支持加密，不支持多磁盘）。 KAZip 完全基于 Delphi VCL -**没有 DLL、ActiveX 或其他外部库**.KAZip 完全面向流，因此您可以仅在内存中处理数据而无需创建临时文件等。如果您需要在应用程序中添加 zip-unzip 功能，KAZIP 是正确的解决方案。附加 ZipListView 和 ZipTreeView 组件，便于可视化。功能：Zip-Unzip 使用 Inflate-DeflateBZip2 解压来自 Edison Mera Menndez 的 BZIP2 单元的使用。功能：添加文件、文件夹、流；选择、取消选择、检查；提取到文件和流；删除和重命名文件创建、删除和重命名文件夹测试、修复许多新属性和方法，提高速度。包括一个非常复杂的 Zip 浏览器演示应用程序

It is not compatible with Delphi 2009 yet, but with some minor changes in the source code, you can make it work in Delphi 2009 too. Actually, that's what I did.

Regards

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T17:24:29.363

我推荐 ComponentAce 的 69 美元[ZipForge](http://www.componentace.com/zip_component_zip_delphi_zipforge.htm)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-01T01:58:45.270

我正在使用来自[madCollection的](http://help.madshi.net/madZipUnit.htm#Zip)[madZip](http://www.madshi.net)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T16:16:31.483

我很惊讶还没有人提到 JclCompression——它是著名的 Jedi Code Library (JCL) 的一部分。这是单元本身的视图：http: [//jcl.svn.sourceforge.net/viewvc/jcl/trunk/jcl/source/common/JclCompression.pas ?view=markup](http://jcl.svn.sourceforge.net/viewvc/jcl/trunk/jcl/source/common/JclCompression.pas?view=markup)

请注意，它与 7-zip DLL 版本 4.64 兼容 - 较新的版本可能不向后兼容...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T17:05:17.780

您可以为 Pascal 使用 7zip (LZMA) 绑定（与 Delphi 兼容）： http: [//www.birtles.org.uk/programming/](http://www.birtles.org.uk/programming/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-30T19:00:15.783

要查看的另一个 Delphi 资源是[InnoSetup](http://www.innosetup.com/isdl.php)。源代码是可用的，稍加工作可能会让您在尝试做的事情上占得先机。有一个选项可以创建与 WinZip 兼容的自解压 zip 档案，

我的想法不是使用该程序，而是使用他的源代码作为起点，因为它经过了非常严格的测试并且非常可靠。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-30T16:56:16.130

有[infozips](http://www.info-zip.org/) zip32 和 unzip32 dll。它们可以在 Delphi（甚至 Visual Basic）中使用，两者都有接口单元/模块。界面没有我希望的那么好，但它可以工作。

# visual-studio-2008 - TortoiseSVN 工作副本/修订未正确提交

> ID：400628
> 
> 赞同：1
> 
> 时间：2008-12-30T15:54:14.850
> 
> 标签：visual-studio-2008, svn, tortoisesvn

我在 TortoiseSVN 源代码控制下有一个 VS 2008 项目。我是目前唯一使用它的人。

当我收到消息“文件 abc 已过期 - 请更新”时，我正试图提交我的最新更改。当我尝试更新项目时，我得到一整套文件冲突（二进制和文本）。由于我确信我的工作副本包含文件的正确版本，因此我尝试通过选择“我的”作为正确版本来解决冲突。我也尝试将每个文件冲突标记为已解决。然后我就可以提交了。

然而，在此之后，我的 VS 2008 项目拒绝编译，并给出了数百个错误（VS 2008 报告的错误太多以至于有太多错误无法显示！）。TortoiseSVN 的冲突解决方案彻底搞砸了项目，它拒绝构建。

**有什么办法可以强制 TortoiseSVN 将我的工作副本作为最新版本保存到存储库中，而不检查冲突？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T16:08:09.500

我希望您在更新之前已经对您的工作副本进行了备份，因为否则很可能冲突会导致您的源文件中出现大量`>>>>>> theirs`注释`<<<<<<< mine`。

虽然我不明白冲突是如何发生的（因为你是唯一一个提交到存储库的人），但有一个可能的解决方法。

将您当前的“工作”工作副本移动到安全位置。检查项目完全新鲜。将源文件复制到新的工作副本上，然后提交结果更改。

当您的源代码树包含多个目录时，单独复制每个目录可能会很乏味。为了克服这个问题，您可以使用 TortoiseSVN -> Export All 导出您的安全“工作”工作副本。这将创建一个没有所有 .svn 文件和目录的目录。然后，您可以将此导出的目录复制到新的工作副本上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:07:54.760

我发现 Visual Studio 项目文件很容易出现自动合并问题。问题是文件的格式如此重复，合并实用程序很难确定更改是添加还是修改。此外，某些操作似乎会导致 Visual Studio 重新排列项目文件中的整体。同样，对于合并实用程序而言，这些更改相对难以正确处理。

我依靠两个选项之一来解决这个问题。首先，您可以在记事本中打开项目文件并手动修复它。它们并没有那么复杂，您通常可以遵循模式并确保没有任何不合适的地方。

第二种方法是还原项目文件，然后添加和删除文件，并根据需要在 Visual Studio 中进行其他更改。

如果提早且经常提交，那么这些任务都不会太复杂。如果炸弹被扔到存储库上，那么这就是为什么尽早提交并且通常是一个好主意的众多原因之一。=)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T16:07:41.250

Visual Studio 和 TortoiseSVN 不能很好地结合在一起。我注意到的一件事是您无法成功地对构建目录中的任何内容进行版本控制，因为 VS 认为它“拥有”构建目录，并且可能会删除您的 .svn 文件夹（这仅适用于涉及清理的构建吗？ )

您可能会查看集成到 Visual Studio 中的 Subversion 客户端。AnkhSVN 浮现在脑海中，但一个很好的研究起点是[http://sharpsvn.open.collab.net/](http://sharpsvn.open.collab.net/)。或者，您可以考虑直接从构建前或构建后任务中使用Sharpsvn，或者可能是Visual Studio 中的宏。

# banner - 如何通过一个应用程序在网页上放置横幅到网站的所有页面

> ID：400631
> 
> 赞同：2
> 
> 时间：2008-12-30T15:54:45.957
> 
> 标签：banner

如何通过一个应用程序在网站的所有页面上放置横幅？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T15:58:53.623

这样做的一种方法是将您的横幅放入一个文件中，然后将其包含在您的其他每个页面上。这样，您只需在一个地方更改代码即可在整个站点范围内更新横幅。

因此，一个 PHP 示例将是：

```
banner.inc.php:
<?php
  // echo out banner here...
?> 
```

然后，在您的其他页面上：

```
include("banner.inc.php"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T14:33:15.043

如果它真的应该出现在您网站的每个页面上，我认为它是网站设计的一部分，而不是内容本身。在这种情况下，您很容易[在 css 中设置背景图像](http://www.w3.org/TR/CSS21/colors.html#propdef-background-image)。当然，您可能仍然需要在 html 中包含某种占位符元素，但至少您可以一起更新整个站点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T15:57:44.280

好吧，希望您已经设计了网站，以便如果您需要全局更改某些内容，您只需编辑页眉或页脚文件。

如果没有，我会使用 Perl 浏览所有文件，然后进行搜索和替换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T15:58:18.257

您可以只创建一个包含在所有页面中的头文件，并在其中包含横幅代码。解决方案在所有语言中几乎相同。如果您的主机允许服务器端包含，您甚至可以使用（几乎）纯 HTML 做完全相同的事情。你也可以很容易地用 JavaScript 做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T15:58:35.543

您的所有页面都有一个全局模板吗？定义所有页面的基本结构，而将特定内容填充到正文部分的东西？如果您有类似的东西，您可以修改全局模板以拥有您想要的横幅，它将显示在您的所有页面上。

谷歌“html 模板”了解更多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T16:09:29.763

我建议使用母版页。这样，如果您有一些必须在整个项目中全局更改的内容，您只需在一个地方进行更改。而且它们使用起来非常简单。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T16:14:27.257

如果您的 Web 服务器是 IIS，并且您知道一点 CSS，您可以在不使用 perl 的情况下执行此操作，而无需触及任何其他文件，但会牺牲一些性能。

IIS 允许您将 HTML 片段插入到所提供的任何内容中：http: [//www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/e27f918e-89a9-45a8-8604-2ad2ded09d64.mspx? mfr=true](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/e27f918e-89a9-45a8-8604-2ad2ded09d64.mspx?mfr=true)

如果所述页脚文件具有将其推到顶部的 CSS，那么您将获得您正在寻找的行为。

请注意，这***不是***一个理想的解决方案，但它是一个快速而肮脏的补丁，直到您可以返回并使用母版页或类似的东西来改造您的所有页面。

# string - 保护格式字符串漏洞

> ID：400655
> 
> 赞同：3
> 
> 时间：2008-12-30T16:01:25.147
> 
> 标签：string, format

Windows 系统中的“格式字符串漏洞”到底是什么，它是如何工作的，我该如何防范？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T16:23:12.247

最简单的格式字符串攻击是这样的：

```
char buffer[128];
gets(buffer);
printf(buffer); 
```

那里也存在缓冲区溢出漏洞，但重点是：您正在将不受信任的数据（来自用户）传递给`printf`使用该参数作为格式字符串的（或其表亲之一）。

也就是说：如果用户输入“%s”，你就有了信息泄露漏洞，因为`printf`会将用户输入视为格式字符串，并尝试将堆栈中的下一个内容作为字符串打印。就好像你的代码说`printf("%s");`. 由于您没有将任何其他参数传递给`printf`，因此它将显示任意内容。

如果用户键入“%n”，则可能会受到特权提升攻击（至少是拒绝服务攻击），因为 %n 格式字符串会导致`printf`将目前打印的字符数写入下一个位置在堆栈上。因为你没有给它一个放置这个值的地方，它会写到任意的地方。

`printf`这一切都很糟糕，这也是您在使用和堂兄弟时应该非常小心的原因之一。

你应该做的是：

```
printf("%s", buffer); 
```

这意味着用户的输入永远不会被视为格式字符串，因此您可以免受特定攻击向量的影响。

在 Visual C++ 中，您可以使用`__Format_string`注释告诉它验证`printf`. `%n`默认情况下是不允许的。在 GCC 中，您可以`__attribute__(__printf__)`用于同样的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T16:21:36.260

在这个伪代码中，用户输入一些要打印的字符，比如“hello”

```
string s=getUserInput();
write(s) 
```

这按预期工作。但是由于 write 可以格式化字符串，例如

```
int i=getUnits();
write("%02d units",i); 
```

输出：“03 个单位”。如果用户首先写了“%02d”怎么办......因为堆栈上没有参数，所以会获取其他东西。那是什么，以及这是否是一个问题取决于程序。

一个简单的解决方法是告诉程序输出一个字符串：

```
write("%s",s); 
```

或使用另一种不尝试格式化字符串的方法：

```
output(s); 
```

包含更多信息的维基百科[链接。](http://en.wikipedia.org/wiki/Format_string_attack)

# asp.net - 向 web.sitmap 中的节点添加属性是个坏主意吗？

> ID：400666
> 
> 赞同：2
> 
> 时间：2008-12-30T16:03:33.677
> 
> 标签：asp.net, sitemap, breadcrumbs, sitemappath

我将 SiteMapPath 与 xml 文件一起用于数据。我想为另一个菜单使用相同的文件，但我需要为每个节点附加更多信息。

```
<siteMapNode target="_blank" url="~/Default.aspx" title="Home"  description="Home Page" >
VS
<siteMapNode url="~/Default.aspx" title="Home"  description="Home Page" > 
```

到目前为止，它并没有在我的盒子上坏掉，但我以后会遇到问题吗？或者，还有更好的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T06:11:53.933

Microsoft 一直希望 siteMapNode 元素允许在其上使用自定义属性。您可以使用SiteMapNode 类上的[索引器](http://msdn.microsoft.com/en-us/library/system.web.sitemapnode.item.aspx)访问这些属性的值。

[ASP.NET 快速入门教程在这里](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavapi.aspx#sitemap2)简要地提到了这个特性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:32:07.237

怀疑你会遇到任何问题。无论消耗您的站点地图文件，都只会解析已知属性。额外的属性将被忽略。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T09:45:18.370

我经常使用这种方法并且持续了相当长的一段时间。它没有给我带来任何问题。唯一的缺点是解析它们所需的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T10:19:05.993

我同意其他答案。XML 是可扩展的。

# iphone - 如何在我的应用程序播放声音时降低 iPod 音频的音量

> ID：400674
> 
> 赞同：3
> 
> 时间：2008-12-30T16:07:41.047
> 
> 标签：iphone, cocoa-touch

当您在收听 iPod 音乐时收到新消息时，我正在尝试重现内置邮件应用程序的功能。

邮件应用程序会发生什么：

1.  iPod 的音量降低了一点
2.  邮件应用播放短声音和振动
3.  iPod 的音量恢复正常

我知道如何播放声音并引起振动，我不知道如何降低 iPod 的音量并在我的声音播放后恢复它。

如何使用 SDK 2.2 在我的应用程序中重现相同的功能？我知道第三方应用程序无法在后台运行。我的用户将播放 iPod，然后将我的应用程序置于前台。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-16T20:19:26.953

请参阅我对您的另一个问题的回答；）

```
[[MPMusicPlayerController iPodMusicPlayer] setVolume:x.y] 
```

您可以通过计时器或一次性更改 xy。当然，在 OS3 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:21:02.847

您是否尝试过简单地播放声音？我怀疑这是 SDK 的自动功能。

编辑：根据[这个问题](https://stackoverflow.com/questions/386111/why-does-ipods-audio-not-fade-back-in-after-my-app-caused-it-to-fade-out)，您可以淡出 ipod 声音但不能恢复。

（我很惊讶这个功能不是自动和默认行为。但是我总是发现苹果 API 的优雅与界面的优雅成反比 :-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:38:26.227

这对于 iPhone SDK 2.2.1 或更早版本是不可能的。[如果您需要此功能，请向Apple](http://bugreporter.apple.com/)提交错误。我已经提交了一份，但重复项表明有兴趣，因此它可能有助于促进这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-08T12:13:50.250

[[MPMusicPlayerController iPodMusicPlayer] setVolume:xy] 这将影响您的 ipod 音乐播放器音量（允许的值为 0.0 到 1.0）

我希望 iPod 中不允许振动。如果设备有振动选项，那么我们可以做

# odbc - x64 OS下使用C#查询Jet Databases/Excel文件

> ID：400684
> 
> 赞同：3
> 
> 时间：2008-12-30T16:09:08.687
> 
> 标签：odbc, 64-bit, oledb, jet

因此，我了解到用于查询 Microsoft Access MDB 文件和 Excel 电子表格等数据源的*Microsoft.Jet.OLEDB.4.0*数据提供程序在 Windows 64 位操作系统下不起作用。

**我现在应该使用什么来查询 .NET 3.5 (C#) 应用程序中的这些文件类型，以确保在 x86 和 x64 环境中的兼容性？**我已经搜索了互联网，但似乎无法找到关于如何处理这种不兼容性的直接答案。

我还尝试过使用 ODBC 提供程序和 MSDASQL 提供程序，但没有成功，因为它们似乎会抛出与 Microsoft.JET.OLEDB.4.0 提供程序在 x64 环境中使用时相同的异常（除非我在做一些公然错误的事情）这两个提供程序，即使它们在我的 Windows XP x86 环境下运行良好）。

我发现有人说我需要在 x64 系统中使用*%WINDIR%\System32\odbcad32.exe*进行 ODBC 连接，但我知道如何使用它。

在 x64 下抛出的示例异常：

> ************** 异常文本 ************** System.InvalidOperationException：“Microsoft.Jet.OLEDB.4.0”提供程序未在本地机器。在 System.Data.OleDb.OleDbServicesWrapper.GetDataSource(OleDbConnectionString constr, DataSourceWrapper& datasrcWrapper) 在 System.Data.OleDb.OleDbConnectionInternal..ctor(OleDbConnectionString constr, OleDbConnection connection) 在 System.Data.OleDb.OleDbConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo、DbConnectionPool 池、DbConnection owningObject）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T17:19:04.570

这里发生的是 x64 程序集试图调用 x86 COM 组件。x64 应用程序不会在主 x64 注册表中看到 COM 注册，因为它们位于 wow6432node 配置单元中。

最简单的解决方法是使用 x86 目标平台构建应用程序，然后让它在您的 x64 机器上的 WOW 上运行。该应用程序将作为 32 位运行，并且能够查看它需要的 32 位 COM 对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T17:13:33.910

我在自己最近的研究中看到的一切都证实了您所看到的 - 根本没有 64 位 Jet 驱动程序。另外，我在[THIS](http://social.msdn.microsoft.com/forums/en-US/sqldataaccess/thread/54b449b0-89aa-4ff5-91a9-3cb8fabcedf9/) thread 上发现了一篇帖子，似乎证实 64 位 MSDASQL 无济于事，因为它实际上只是一个包装器（参见 Ricky Wen 于 5 月 8 日发布的最后一篇帖子）。您唯一的选择是通过 32 位代理链接，也许是另一个 32 位 SQL 服务器。在我可以将 Jet 数据移动到 SQL 之前，我可能最终会自己这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-24T15:04:26.107

现在有一个用于 JetSQL 的 64 位 ODBC 驱动程序。它是[Microsoft Access 数据库引擎 2010 Redistributable](http://www.microsoft.com/download/en/details.aspx?id=13255)。我没有将它用于 OLEDB，但我已经用它[用 PowerShell 创建了新的 Microsoft Access 数据库](https://gist.github.com/1166670)。

# c# - C# 在 Active Directory 中创建 OU

> ID：400691
> 
> 赞同：6
> 
> 时间：2008-12-30T16:10:21.773
> 
> 标签：c#, active-directory

我正在努力使用下面的代码为 Active Directory 创建一个 OU。

```
strPath = "OU=TestOU,DC=Internal,DC=Com"

DirectoryEntry objOU; 
objOU = ADentry.Children.Add(strPath, "OrganizationalUnit");
objOU.CommitChanges(); 
```

问题是 strPath 包含完整路径 'OU=TestOU,DC=Internal,DC=net' 所以使用 .Children.Add 正在制作 ldap 路径 'OU=TestOU,DC=Internal,DC=net,DC=Internal,DC =net' 这会导致错误，因为域显然不存在。

我的问题是我可以在`strPath`没有的情况下创建一个 OU`.Children.Add`吗？

我对AD不熟悉，这是我从我之前的那个人那里继承来的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-30T16:41:54.130

尝试这个

```
using System;
using System.DirectoryServices;

namespace ADAM_Examples
{
    class CreateOU
    {
        /// <summary>
        /// Create AD LDS Organizational Unit.
        /// </summary>
        [STAThread]
        static void Main()
        {
            DirectoryEntry objADAM;  // Binding object.
            DirectoryEntry objOU;    // Organizational unit.
            string strDescription;   // Description of OU.
            string strOU;            // Organiztional unit.
            string strPath;          // Binding path.
        // Construct the binding string.
        strPath = "LDAP://localhost:389/O=Fabrikam,C=US";

        Console.WriteLine("Bind to: {0}", strPath);

        // Get AD LDS object.
        try
        {
            objADAM = new DirectoryEntry(strPath);
            objADAM.RefreshCache();
        }
        catch (Exception e)
        {
            Console.WriteLine("Error:   Bind failed.");
            Console.WriteLine("         {0}", e.Message);
            return;
        }

        // Specify Organizational Unit.
        strOU = "OU=TestOU";
        strDescription = "AD LDS Test Organizational Unit";
        Console.WriteLine("Create:  {0}", strOU);

        // Create Organizational Unit.
        try
        {
            objOU = objADAM.Children.Add(strOU,
                "OrganizationalUnit");
            objOU.Properties["description"].Add(strDescription);
            objOU.CommitChanges();
        }
        catch (Exception e)
        {
            Console.WriteLine("Error:   Create failed.");
            Console.WriteLine("         {0}", e.Message);
            return;
        }

        // Output Organizational Unit attributes.
        Console.WriteLine("Success: Create succeeded.");
        Console.WriteLine("Name:    {0}", objOU.Name);
        Console.WriteLine("         {0}",
            objOU.Properties["description"].Value);
        return;
    }
}
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T17:12:12.070

使用 System.DirectoryServices 创建对象的唯一方法是为父级创建一个 DirectoryEntry 对象并使用 DirectoryEntry.Children.Add。

我认为此时您最好的做法是使用您拥有的路径并提取您需要的部分（“OU=something”）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-02T12:54:53.610

不，你不能。但是你的代码有一些错误，试试这个：

```
 string rootOU = @"LDAP://DC=Internal,DC=Com/OU=Root OU,DC=Internal,DC=Com; // or simply "DC=Internal,DC=Com" instead of "OU=Root OU,DC=Internal,DC=Com" if you want to create your test OU in root
 DirectoryEntry objAD = new DirectoryEntry(rootOU, userName, password);
 DirectoryEntry objOU = objAD.Children.Add("OU=Test OU", "OrganizationalUnit");
 objOU.CommitChanges(); 
```

# wcf - 将序列化的 WCF 对象转换回本机对象

> ID：400704
> 
> 赞同：1
> 
> 时间：2008-12-30T16:15:17.537
> 
> 标签：wcf, .net-3.5, serialization

我怀念 .Net 远程处理的日子，那时我可以通过网络发送一个对象，它可以在中间层的两侧工作而无需太多工作。原因如下：

我被分配了一个任务。我正在构建一个逻辑/数据抽象层（愚蠢的 PCI 合规性），以便我们可以将我们的数据库服务器从公司网络转移到受保护的网络中。我曾经在.Net 2.0下使用远程处理做过一个这样的项目。我在中间件层上构建了对象并将该对象发送给客户端，客户端可以使用我的 .Net 对象。但是 WCF 需要序列化才能在管道上上下发送内容，并且序列化从我的奇特方法中消失了，这些方法对我现有的字段做出了令人难以置信的事情。

我提出了两种不同的策略来解决这个问题：（1）将方法从类本身移动到静态实用程序类，（2）“反序列化”客户端的数据并使用来自的数据重建本机对象序列化的对象。

```
nativeObject.Name = serializedObject.Name; 
```

第二种方法的缺陷是我必须重新序列化对象才能将其发送回中间件层。

```
serializedObject.Name = nativeObject.Name; 
```

这两种方法都有效，但是由于中间层造成的整个序列化混乱，它使得写入对象的时间比它应该花费的时间长得多。我会回到 .Net Remoting，但架构师说他希望在 WCF 中完成这个抽象层，因为（我的话，不是他的话）它是新的和性感的。

那么如何在 WCF 连接的两侧使用 .Net 本机对象...而不编写 1,000 行胶水代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T16:55:27.580

您可以生成一个代理并告诉它使用一组特定的类而不是创建新的类。我相信这是使用 svutil.exe 的 /r 参数完成的。如果您使用的是 IDE（VS2008），您可以在添加服务引用时执行此操作，单击高级，并确保选中 Reuse Types in Assemblies（我认为这是默认设置）。

# .net - 循环引用导致内存泄漏？

> ID：400706
> 
> 赞同：38
> 
> 时间：2008-12-30T16:15:29.393
> 
> 标签：.net, memory, memory-management, memory-leaks, circular-dependency

我正在尝试解决 Windows 窗体应用程序中的内存泄漏问题。我现在正在查看一个包含多个嵌入式表单的表单。让我担心的是，子表单在其构造函数中引用了父表单，并将其保存在私有成员字段中。所以在我看来，垃圾收集时间到了：

父通过控件集合引用子表单（子表单嵌入其中）。子表单不是 GC'd。

子表单通过私有成员字段引用父表单。父表单不是 GC'd。

这是对垃圾收集器如何评估情况的准确理解吗？有什么方法可以“证明”它以用于测试目的？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-30T16:23:15.540

好问题！

不，这两种形式都将（可以）进行 GC，因为 GC 不会直接在其他参考中查找参考。它只查找所谓的“根”引用......这包括堆栈上的引用变量，（变量在堆栈上，实际对象当然在堆上），CPU 寄存器中的引用变量，以及引用变量类中的静态字段...

所有其他引用变量只有在上述过程找到的“根”引用对象之一的属性中被引用时才被访问（和 GC'd）......（或在由根对象中的引用引用的对象中） ， ETC...）

因此，只有当其中一种形式在“根”引用中的其他地方被引用时——那么这两种形式都不会受到 GC 的影响。

我能想到的“证明”它的唯一方法（不使用内存跟踪实用程序）是在方法内的循环中创建几十万个这样的表单，然后在方法中查看应用程序的内存占用，然后退出方法，调用GC，再看一下footprint。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-30T16:45:21.843

正如其他人已经说过的，GC 在循环引用方面没有问题。我想补充一点，在 .NET 中泄漏内存的常见地方是事件处理程序。如果您的一个表单有一个附加到另一个“活动”对象的事件处理程序，那么就会有对您的表单的引用并且该表单不会被 GC'd。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-30T16:48:22.680

垃圾收集通过跟踪应用程序根来工作。应用程序根是包含对托管堆上的对象（或 null）的引用的存储位置。在 .NET 中，根是

1.  对全局对象的引用
2.  对静态对象的引用
3.  对静态字段的引用
4.  堆栈上对本地对象的引用
5.  堆栈上对传递给方法的对象参数的引用
6.  对等待完成的对象的引用
7.  CPU 寄存器中对托管堆上对象的引用

活动根列表由 CLR 维护。垃圾收集器通过查看托管堆上的对象并查看应用程序仍然可以访问哪些对象来工作，也就是说，可以通过应用程序根访问。这样的对象被认为是有根的。

现在假设您有一个包含对子表单的引用的父表单，并且这些子表单包含对父表单的引用。此外，假设应用程序不再包含对父表单或任何子表单的引用。然后，出于垃圾收集器的目的，这些托管对象不再是 root 并且将在下次垃圾收集发生时进行垃圾收集。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-30T16:23:55.663

如果父母和孩子都没有被引用，但他们只是互相引用，他们确实会被 GCed。

获取内存分析器来真正检查您的应用程序并回答您的所有问题。我可以推荐[http://memprofiler.com/](http://memprofiler.com/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-24T20:34:11.587

我想回应 Vilx 关于事件的评论，并推荐一种有助于解决它的设计模式。

假设您有一个类型是事件源，例如：

```
interface IEventSource
{
    event EventHandler SomethingHappened;
} 
```

这是处理来自该类型实例的事件的类的片段。这个想法是，每当您将新实例分配给属性时，您首先取消订阅任何先前的分配，然后订阅新实例。空检查确保正确的边界行为，更重要的是，简化了处置：您所做的就是将属性设为空。

这就提出了处置的问题。任何订阅事件的类都应该实现 IDisposable 接口，因为事件是托管资源。（注意，为了简洁起见，我在示例中跳过了 Dispose 模式的正确实现，但你明白了。）

```
class MyClass : IDisposable
{
    IEventSource m_EventSource;
    public IEventSource EventSource
    {
        get { return m_EventSource; }
        set
        {
            if( null != m_EventSource )
            {
                m_EventSource -= HandleSomethingHappened;
            }
            m_EventSource = value;
            if( null != m_EventSource )
            {
                m_EventSource += HandleSomethingHappened;
            }
        }
    }

    public Dispose()
    {
        EventSource = null;
    }

    // ...
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T16:38:16.383

GC 可以正确处理循环引用，如果这些引用是保持表单活动的唯一事物，那么它们将被收集。
.net 没有从表单中回收内存，我遇到了很多麻烦。在 1.1 中，menitem 存在一些错误（我认为），这意味着它们没有被处理掉并且可能会泄漏内存。在这种情况下，添加显式调用 dispose 并清除表单的 Dispose 方法中的成员变量可以解决问题。我们发现这也有助于为其他一些控件类型回收内存。
我还花了很长时间使用 CLR 分析器来研究为什么没有收集表单。据我所知，框架保留了引用。每个表单类型一个。因此，如果您创建 100 个 Form1 实例，然后将它们全部关闭，则只有 99 个会被正确回收。我没有找到任何方法来治愈这个。
我们的应用程序已经转移到 .net 2，这似乎要好得多。当我们打开第一个表单时，我们的应用程序内存仍然会增加，并且在关闭时不会回退，但我相信这是因为 JIT 代码和加载了额外的控制库。
我还发现，虽然 GC 可以处理循环引用，但循环事件处理程序引用似乎（有时）存在问题。IE object1 引用 object2 并且 object1 具有处理来自 object2 的事件的方法。我发现这样的情况并没有在我预期的时候释放对象，但我永远无法在测试用例中重新生成它。

# c - 使用 Web 测试 C 代码

> ID：400710
> 
> 赞同：4
> 
> 时间：2008-12-30T16:17:06.473
> 
> 标签：c, forms

我有许多实现数学公式的 C 函数。迄今为止，这些已通过通过命令行应用程序传递参数或为 Excel 等应用程序编译 DLL 来测试数学“可靠性”。有没有一种简单的方法可以通过网络进行此测试？

理想情况下是这样的：

*   编译一个库
*   花五分钟定义一个调用此代码的 Web 表单
*   测试人员可以查看网页、输入参数并查看输出

一个简单的计算示例可以是计算债券的“应计利息”：

**输入**：当前日期、到期日、票面支付频率（整数）、票面金额（双倍）

**输出**：应计利息（双倍）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T16:29:30.987

你应该看看自动化测试。每次更改代码中的某些内容时，都必须重复手动测试。自动化测试是您测试类型的解决方案。让测试人员编写带有结果的测试用例，然后将它们制成单元测试。

参见：[单元测试](http://en.wikipedia.org/wiki/Unit_testing)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T00:03:32.227

If you're going to do this, you should be sure that **every web interaction is captured in a permanent database of tests**. Then you can use this database to

*   **Automatically re-run all tests** if the software changes

*   **Possibly find inconsistencies** that result if a person gives you the wrong answer

In other words, the web form should be the **front end to a persistent infrastructure for testing**, *not* a means of running tests that disappear just after they are viewed.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T16:25:11.463

我能想到的最快的事情就是在服务器上编译这些 C 程序。并创建一个接收命令行参数的PHP页面，然后在服务器上执行编译程序，解析输出。PHP 以外的技术也可以正常工作。对于特定技术，您需要弄清楚的是：

*   如何启动进程
*   如何重定向标准输入/输出

我还看到一些网站允许用户提交他们的 C 代码，然后在服务器上编译。之后，程序将获得一些输入文件并给出输出。然后用正确的答案验证程序的输出。例如访问这个网站，[http://acm.timus.ru/](http://acm.timus.ru/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T22:50:25.040

这就是你要找的：

[http://codepad.org/](http://codepad.org/)

它将在线执行 C、C++、D、Haskell、Lua 和许多其他程序，并显示结果。

如果你有一个大的库要编译它可能会变得笨拙，但简单地测试一个函数只是粘贴代码并点击“提交”的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T00:31:55.303

This sounds much like [FIT](http://en.wikipedia.org/wiki/Framework_for_Integrated_Test). You could probably make a new fixture for it, or for one of the other language ports like the Python one, that calls a C library with your function. This would take advantage of the work that's gone into making FIT convenient, the kind of work Norman Ramsey recommends in his answer.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T16:33:37.330

或者类似地，创建一个 Perl CGI 来检查输入值，然后将它们传递给 C 程序。顺便说一句，这应该只用于测试而不是最终部署。

您应该真正自动化测试以检查您的行为在广泛的值范围内是否符合预期。

或者您不应该在尽可能接近最终部署环境的环境中进行测试吗？

干杯，

抢

# sql - 如何做相当于“限制不同”？

> ID：400712
> 
> 赞同：4
> 
> 时间：2008-12-30T16:17:53.583
> 
> 标签：sql, mysql

如何将结果集限制为给定列的*n 个*不同值，其中实际行数可能更高？

输入表：

```
client_id, employer_id, other_value
1, 2, abc
1, 3, defg
2, 3, dkfjh
3, 1, ldkfjkj
4, 4, dlkfjk
4, 5, 342
4, 6, dkj
5, 1, dlkfj
6, 1, 34kjf
7, 7, 34kjf
8, 6, lkjkj
8, 7, 23kj 
```

所需的输出，其中 limit distinct=5 个不同的 client_id 值：

```
1, 2, abc
1, 3, defg
2, 3, dkfjh
3, 1, ldkfjkj
4, 4, dlkfjk
4, 5, 342
4, 6, dkj
5, 1, dlkfj 
```

该平台适用于 MySQL。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-30T16:21:27.807

您可以使用子选择

```
select * from table where client_id in 
(select distinct client_id from table order by client_id limit 5) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T16:32:12.277

这是针对 SQL Server 的。我不记得了，MySQL 可能使用 LIMIT 关键字而不是 TOP。如果您可以通过在同一子查询中使用 LIMIT 和 DISTINCT 来摆脱最内层的子查询，这可能会使查询更加高效。（看起来 Vinko 使用了这种方法并且 LIMIT 是正确的。不过，我将把它留在这里作为第二个可能的答案。）

```
SELECT
     client_id,
     employer_id,
     other_value
FROM
     MyTable
WHERE
     client_id IN
     (
          SELECT TOP 5
               client_id
          FROM
          (
               SELECT DISTINCT
                    client_id
               FROM
                    MyTable
          ) SQ
          ORDER BY
               client_id
     ) 
```

当然，在子查询中添加您自己的 WHERE 子句和 ORDER BY 子句。

另一种可能性（比较性能，看看哪个效果更好）是：

```
SELECT
     client_id,
     employer_id,
     other_value
FROM
     MyTable T1
WHERE
     T1.code IN
     (
          SELECT
               T2.code
          FROM
               MyTable T2
          WHERE
               (SELECT COUNT(*) FROM MyTable T3 WHERE T3,code < T2.code) < 5
     ) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-12-16T20:58:04.493

-- 在 Microsoft SQL Server 中使用公用表表达式。-- MS SQL 中不存在 LIMIT 函数。

```
WITH CTE
AS
(SELECT DISTINCT([COLUMN_NAME])
FROM [TABLE_NAME])
SELECT TOP (5) [[COLUMN_NAME]]
FROM CTE; 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2021-03-01T19:36:10.677

如果有人在该平台上，这适用于 ‍‍<code>MS SQL：

```
SET ROWCOUNT 10;
SELECT DISTINCT
     column1, column2, column3,...
FROM 
     Table1
WHERE ... 
```

# crystal-reports - Crystal Reports - 无法打开行集

> ID：400717
> 
> 赞同：12
> 
> 时间：2008-12-30T16:19:40.040
> 
> 标签：crystal-reports

可以做些什么来解决异常：

CrystalDecisions.CrystalReports.Engine.InternalException：无法打开行集。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-30T17:02:59.860

每当报表查询失败时，这是 Crystal Reports 中的一般错误。可能有多种原因。如果您的报告针对特定数据库，然后在未更新报告的情况下更改了数据库，则可能会导致此问题。它也可能是由于查询本身失败导致的，例如，如果报表基于运行报表所针对的数据库中不存在的存储过程。尝试验证报告的数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-22T08:00:56.993

如前所述，这是一个通用错误，与所有此类错误一样，这是一个非常令人沮丧的错误。问题是 VS 2003 没有水晶报表的预览选项，因此很难找到问题的根源。所以解决这个问题的最好方法是在vs 2005或更高版本中创建一个空白项目，导入水晶报表，然后运行预览。然后你会得到一个更具体的错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-15T13:50:15.413

我有同样的问题，并收到此错误消息：

在结果集中找不到一个或多个字段。使用验证数据库更新报告。文件文件名 {9FEE6406-1613-409A-B9BD-C5FDA24E3DEE}.rpt 中*的*错误：

找不到行集列。

我使用存储过程为报告收集数据，果然我为 SP 传递了一个无效参数。如果您使用 SP 填充报告数据，请仔细检查参数的类型和值。

祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-01-14T07:34:21.907

我也遇到了同样的错误，报告有子报告。当我切换到每个子报告并使用数据库/表/视图再次验证时，问题已解决。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T17:05:55.640

这是由您的关系中的某些差异引起的，例如相反的左连接或类似的东西。CR 还有一个坏习惯，即每次修改报告所需的表和视图列表时都创建“默认”链接。它有时甚至可以自动创建在关系屏幕中可能无法“立即”查看的递归链接。

如果您找不到导致问题的关系（有时并不那么明显），则必须通过在报告中添加/删除表格来进行一些试错测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-15T07:21:37.747

每次您在水晶中添加一个新表时，它都会在已链接的表上添加自己的链接，有时它甚至会链接同一个表中的 2 个字段。在添加表格并滚动所有表格以查看从同一表格创建的任何链接后，请确保您知道您的链接以便通过

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-09-07T02:53:13.407

我收到了 ：

CrystalDecisions.CrystalReports.Engine.InternalException 未处理 Message=报表应用服务器失败

谷歌把我带到了这里。对于那些有类似问题的人。

作为记录：我有一个带有图像的 byte[] 数组，并从报告中删除了日志并且错误停止了。我现在必须弄清楚我在徽标上做错了什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-22T09:56:37.147

我遇到了这个问题 - 我们使用 SQL 登录来确保安全（未集成/DSN 连接）

通过向用户授予我的存储过程的执行权限，我解决了这个问题。

真的，真的不能因为他们的异常屏蔽而更讨厌 Crystal——让这成为所有程序员的一个教训；

```
Try
   'your code here
Catch
   Throw new exception("Hey, here's a really friendly but completely useless error message")
End Try 
```

会给未来的开发者带来痛苦——不要这样做！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-09T14:34:53.333

当您验证数据库时，它可能会告诉您它是最新的，在这种情况下，您还有两个选项可以检查：

a) 刷新报告（闪电形图标），如果您对某个字段（例如 SQL 字段）有问题，它会提示您错误，然后显示该字段的编辑窗口。

b) 直接在 SQL 上运行查询，如果查询本身有问题，您也会在 Crystal 中收到此消息，但 SQL 会准确告诉您出了什么问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-12-08T07:26:14.553

检查[在 VS2005 中运行时更改 Crystal Report 数据库登录信息以](http://www.codeproject.com/KB/aspnet/CrystalRptAuthentication.aspx)获取帮助。

其中重要的一行是：

```
table.Location = Database & ".dbo." & table.Name 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-11-15T02:06:59.477

对我来说，当我登录并重新登录到报告连接到的 SQL 服务器时，问题就解决了

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-24T13:49:52.090

在您的存储过程中如果您正在使用

```
SET NOCOUNT ON; 
```

然后删除这个

```
--SET NOCOUNT ON; 
```

现在验证您的报告数据库，构建并运行您的解决方案。

# asp.net - ASP.NET - 使用 javascript 在网格视图中禁用验证器

> ID：400723
> 
> 赞同：0
> 
> 时间：2008-12-30T16:21:40.147
> 
> 标签：asp.net, javascript, gridview, validation

除了我关于使用 javascript 禁用验证器的问题 - [Disable ASP.NET validators with JavaScript](https://stackoverflow.com/questions/400346/disable-asp-net-validators-with-javascript) ...

有谁知道如何通过 javascript 中的 gridview 来动态禁用每行上的验证器。我现在明白我需要使用 ValidatorEnable(validatorControl, false) 来禁用每个验证器，但我如何首先发现验证器？

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T16:29:59.520

您将不得不向下钻取网格视图并以这种方式选择各个验证器。

可以在[这里找到使用 javascript 访问 gridview 的一个很好的示例](http://www.netomatix.com/development/gridviewclientsideaccess.aspx)

# jquery - IE6 中 jQuery 对话框的修复或解决方法 - 对话框包含表单时的主要布局问题

> ID：400728
> 
> 赞同：0
> 
> 时间：2008-12-30T16:23:18.473
> 
> 标签：jquery, forms, internet-explorer-6, dialog

我正在使用一个包含表单的 jQuery 对话框。在 ie6 中，表格上方有几英寸无法解释的填充。当我从标记中删除表单时，最严重的布局问题就消失了。我已经尝试过没有主题（默认）、Flora 和我的 themeroller 主题，它们似乎都有同样的问题。

我尝试对对话框 CSS 进行各种调整，但似乎没有任何效果，并且在创建对话框时会编写大量内联 CSS，从而阻止应用任何其他样式。

我尝试在表单本身上设置 css 属性，例如浮动、消除边距和填充、显示内联等，但只要表单在那里，就会有额外的间距。有没有人能够找到解决方法？我宁愿不破解它并拥有没有表单标签的表单控件。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-31T08:43:59.117

每当我必须为现有网站、论坛、小部件等创建 CSS 主题时，我总是首先剥离所有样式表，并将所有主要 html DOM 元素的边距和填充规范化为 0。当涉及到内联 CSS 时，这一点尤其重要。

您应该尝试删除表单元素本身的任何内联 CSS。然后尝试类似：

```
form {
    margin: 0;
    padding: 0;
    overflow: hidden;
} 
```

在 IE6 中驯服溢出通常可以解决很多边距问题。尝试使用以下样式在所有 html 元素上临时设置边框，以查看是否有任何先前的元素溢出到表单的空间中。

```
* {
    border: solid 1px #FF0000;
} 
```

如果您看到窗体上的边框，那么您也应该尝试抑制该元素的溢出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T08:59:45.060

在更改 CSS 之前，请确保您的页面具有正确的[文档类型。](http://htmlhelp.com/tools/validator/doctype.html)

如果它没有文档类型，浏览器将以[“怪癖”](http://www.quirksmode.org/css/quirksmode.html)模式呈现，许多事情看起来不太正确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T09:25:02.077

我之前在按钮和无法解释的边距方面遇到过类似的问题。IE6 中有一些元素继承了它们父元素的边距。很诡异...

试试这个修复： http: [//blog.netscraps.com/internet-explorer-bugs/ie6-ie7-margin-inheritance-bug.html](http://blog.netscraps.com/internet-explorer-bugs/ie6-ie7-margin-inheritance-bug.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T16:29:30.117

尝试这样的事情：

```
#yourDiv { padding:1.2em; margin-right:2.4em; } 
```

其中 #yourDiv 是包含您的标签的 div 的 id（我在输入时遇到了这个问题）。

# visual-studio - Visual Studio - 从调试输出中过滤异常

> ID：400731
> 
> 赞同：17
> 
> 时间：2008-12-30T16:23:59.157
> 
> 标签：visual-studio, debugging, filter

我有一些代码会导致一堆异常（可以安全地忽略），但它会淹没我的调试输出窗口。它始终具有相同的形式，并且很容易过滤掉。我如何编写一个宏（？）来实时过滤掉这些行

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-03T13:33:08.513

右键单击输出窗口（当它处于活动状态时），然后取消选中“异常消息”。

# string - VB6中的字体居中

> ID：400732
> 
> 赞同：2
> 
> 时间：2008-12-30T16:24:44.117
> 
> 标签：string, fonts, vb6

如何确定 Arial Bold 字体中文本字符串的长度，然后在 VB6 中居中？

我们没有使用“标签”或“图片框”将文本打印到屏幕上。我们正在动态调整文本大小，并允许用户根据自己的喜好调整应用程序的大小。我们使用代码将文本写入屏幕。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T16:37:54.637

一种方法是拥有一个隐藏的图片框并按照您想要的方式设置该图片框的字体规格。

然后使用 PictureBox 的 TextHeight 和 TextWidth 方法进行测量。单位将处于图片框设置的任何比例模式。

如果您直接打印到打印机或表格，那么只需先设置字体，然后进行测量。

将其居中

```
MyText = "Hello World"
<displayarea>.FontName = "Arial"
<displayarea>.FontSize = 14
<displayarea>.FontBold = True
TextWidth = <displayarea>.TextWidth(MyText)
TextLeftCoordinate = <displayarea>.ScaleLeft+<displayarea>.ScaleWidth/2-TextWidth/2
<displayarea>.CurrentX = TextLeftCoordinate
<displayarea>.Print MyText 
```

用您正在使用的任何对象替换显示区域。

根据您更新的答案，请注意隐藏的图片框建议不用于打印。它只是获取文本测量。但是，您直接打印到表单，因此您只需要使用上面的代码示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:33:35.613

我不记得细节了（距离我上次使用 VB 6 已经过去了大约 3 年），但是 Form 上有一个方法叫做“ `MeasureString`”。它获取字符串，并根据表单的字体设置对其进行测量。

[此外，这里是Jason Lepack](https://stackoverflow.com/users/16592/jason-lepack)发表的评论，以防我误解了您的要求并使您的要求过于复杂：

“标签通常具有对齐属性。如果将其设置为居中对齐，则无论字体如何，它都应在标签中居中”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T16:34:37.530

您可以调用 Win32 GDI 函数：例如参见[http://msdn.microsoft.com/en-us/library/ms534223(VS.85).aspx上的 GetTextExtentPoint32](http://msdn.microsoft.com/en-us/library/ms534223(VS.85).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-13T16:37:49.300

您最好的选择可能是 Form.TextWidth，它似​​乎以缇为单位返回字符串的宽度。我刚刚采用了这种方法，以便根据需要出现在其中的标签的长度来动态调整按钮的大小。

还有一个名为 Form.TextHeight 的相应函数，它允许您在垂直维度上做同样的事情。

确保将表单的 Font 属性设置为与要测量文本的控件的 Font 属性相匹配，否则会得到不正确的结果。

[在http://msdn.microsoft.com/en-us/library/aa267168(VS.60).aspx](http://msdn.microsoft.com/en-us/library/aa267168(VS.60).aspx)阅读更多内容

# c# - 如何在 C# 中获取字符串的 ASCII 值

> ID：400733
> 
> 赞同：136
> 
> 时间：2008-12-30T16:25:01.120
> 
> 标签：c#, encoding, ascii

我想在 C# 中获取字符串中字符的 ASCII 值。

如果我的字符串的值为“9quali52ty3”，我想要一个包含 11 个字符中每个字符的 ASCII 值的数组。

如何在 C# 中获取 ASCII 值？

* * *

## 回答 #1

> 赞同：218
> 
> 时间：2008-12-30T16:38:49.300

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.text.encoding.convert(VS.71).aspx)

```
string value = "9quali52ty3";

// Convert the string into a byte[].
byte[] asciiBytes = Encoding.ASCII.GetBytes(value); 
```

您现在有一个字节的 ASCII 值数组。我得到以下信息：

57 113 117 97 108 105 53 50 116 121 51

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-12-30T16:28:01.943

```
string s = "9quali52ty3";
foreach(char c in s)
{
  Console.WriteLine((int)c);
} 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-12-30T16:29:18.443

这应该有效：

```
string s = "9quali52ty3";
byte[] ASCIIValues = Encoding.ASCII.GetBytes(s);
foreach(byte b in ASCIIValues) {
    Console.WriteLine(b);
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-30T16:29:49.677

你的意思是你只想要字母字符而不是数字？所以你想要“质量”作为结果？您可以使用 Char.IsLetter 或 Char.IsDigit 将它们一一过滤掉。

```
string s = "9quali52ty3";
StringBuilder result = new StringBuilder();
foreach(char c in s)
{
  if (Char.IsLetter(c))  
    result.Add(c);
}
Console.WriteLine(result);  // quality 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-30T16:30:58.630

```
string text = "ABCD";
for (int i = 0; i < text.Length; i++)
{
  Console.WriteLine(text[i] + " => " + Char.ConvertToUtf32(text, i));
} 
```

如果我没记错的话，ASCII 值是[Unicode](http://en.wikipedia.org/wiki/Unicode)数字的低七位的数字。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-12-04T07:20:47.220

```
string value = "mahesh";

// Convert the string into a byte[].
byte[] asciiBytes = Encoding.ASCII.GetBytes(value);

for (int i = 0; i < value.Length; i++)

    {
        Console.WriteLine(value.Substring(i, 1) + " as ASCII value of: " + asciiBytes[i]);
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-03-07T10:40:31.593

该程序将接受多个字符并输出它们的 ASCII 值：

```
using System;
class ASCII
{
    public static void Main(string [] args)
    {
        string s;
        Console.WriteLine(" Enter your sentence: ");
        s = Console.ReadLine();
        foreach (char c in s)
        {
            Console.WriteLine((int)c);
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-30T16:31:04.777

如果您想要字符串中每个字符的字符码，您可以执行以下操作：

```
char[] chars = "9quali52ty3".ToCharArray(); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-07-21T10:25:00.430

```
byte[] asciiBytes = Encoding.ASCII.GetBytes("Y");
foreach (byte b in asciiBytes)
{
    MessageBox.Show("" + b);
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-02-27T22:22:35.083

或者在 LINQ 中：

```
string value = "9quali52ty3";
var ascii_values = value.Select(x => (int)x);
var as_hex = value.Select(x => ((int)x).ToString("X02")); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-09-30T14:31:00.133

较早的响应者已经回答了这个问题，但没有提供标题让我期待的信息。我有一个返回一个字符串的方法，但我想要一个可以转换为十六进制的字符。以下代码演示了我认为我会发现的内容，希望对其他人有所帮助。

```
 string s = "\ta£\x0394\x221A";   // tab; lower case a; pound sign; Greek delta;
                                   // square root  
  Debug.Print(s);
  char c = s[0];
  int i = (int)c;
  string x = i.ToString("X");
  c = s[1];
  i = (int)c;
  x = i.ToString("X");
  Debug.Print(c.ToString() + " " + i.ToString() + " " + x);
  c = s[2];
  i = (int)c;
  x = i.ToString("X");
  Debug.Print(c.ToString() + " " + i.ToString() + " " + x);
  c = s[3];
  i = (int)c;
  x = i.ToString("X");
  Debug.Print(c.ToString() + " " + i.ToString() + " " + x);
  c = s[4];
  i = (int)c;
  x = i.ToString("X");
  Debug.Print(c.ToString() + " " + i.ToString() + " " + x); 
```

上面的代码将以下内容输出到即时窗口：

```
a£Δ√ 
```

一个 97 61

163 英镑 A3

Δ 916 394

√ 8730 221A

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-03-09T11:54:36.483

您可以使用以下方法删除[BOM](http://en.wikipedia.org/wiki/Byte_order_mark)：

```
//Create a character to compare BOM
char byteOrderMark = (char)65279;
if (sourceString.ToCharArray()[0].Equals(byteOrderMark))
{
    targetString = sourceString.Remove(0, 1);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-06-24T11:28:33.607

我想在 C# 中获取字符串中字符的 ASCII 值。

每个人都在这个结构中给出答案。如果我的字符串的值为“9quali52ty3”，我想要一个包含 11 个字符中每个字符的 ASCII 值的数组。

但是在控制台中，我们坦率地工作，所以如果我错了，我们会得到一个字符并打印 ASCII 码，所以请更正我的答案。

```
 static void Main(string[] args)
        {
            Console.WriteLine(Console.Read());
            Convert.ToInt16(Console.Read());
            Console.ReadKey();
        } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-01-11T15:15:34.340

为什么不是老式的简单方法？

```
 public int[] ToASCII(string s)
    {
        char c;
        int[] cByte = new int[s.Length];   / the ASCII string
        for (int i = 0; i < s.Length; i++)
        {
            c = s[i];                        // get a character from the string s
            cByte[i] = Convert.ToInt16(c);   // and convert it to ASCII
        }
        return cByte;
    } 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2020-03-16T15:46:26.123

```
 string nomFile = "9quali52ty3";  

     byte[] nomBytes = Encoding.ASCII.GetBytes(nomFile);
     string name = "";
     foreach (byte he in nomBytes)
     {
         name += he.ToString("X02");
     }
`
     Console.WriteLine(name); 
```

// 现在好多了 ;)

# python - 星号 * 在 Python 中是什么意思？

> ID：400739
> 
> 赞同：353
> 
> 时间：2008-12-30T16:28:53.423
> 
> 标签：python

* 在 Python 中是否像在 C 中一样具有特殊含义？我在 Python Cookbook 中看到了这样的函数：

```
def get(self, *a, **kw) 
```

请您向我解释一下或指出我在哪里可以找到答案（Google 将 * 解释为通配符，因此我找不到满意的答案）。

* * *

## 回答 #1

> 赞同：335
> 
> 时间：2008-12-30T16:31:05.307

请参阅语言参考中的[函数定义](https://docs.python.org/2.7/reference/compound_stmts.html#function-definitions)。

> 如果表单`*identifier`存在，则将其初始化为接收任何多余位置参数的元组，默认为空元组。如果表单`**identifier`存在，则将其初始化为接收任何多余关键字参数的新字典，默认为新的空字典。

另请参阅[函数调用](https://docs.python.org/2.7/reference/expressions.html#calls)。

假设人们知道位置参数和关键字参数是什么，这里有一些例子：

示例 1：

```
# Excess keyword argument (python 2) example:
def foo(a, b, c, **args):
    print "a = %s" % (a,)
    print "b = %s" % (b,)
    print "c = %s" % (c,)
    print args

foo(a="testa", d="excess", c="testc", b="testb", k="another_excess") 
```

`a, b, c`正如您在上面的示例中看到的，我们在函数的签名中只有参数`foo`。由于`d`和`k`不存在，它们被放入 args 字典。程序的输出是：

```
a = testa
b = testb
c = testc
{'k': 'another_excess', 'd': 'excess'} 
```

示例 2：

```
# Excess positional argument (python 2) example:
def foo(a, b, c, *args):
    print "a = %s" % (a,)
    print "b = %s" % (b,)
    print "c = %s" % (c,)
    print args

foo("testa", "testb", "testc", "excess", "another_excess") 
```

在这里，由于我们正在测试位置参数，多余的参数必须在最后，并将`*args`它们打包成一个元组，所以这个程序的输出是：

```
a = testa
b = testb
c = testc
('excess', 'another_excess') 
```

您还可以将字典或元组解包到函数的参数中：

```
def foo(a,b,c,**args):
    print "a=%s" % (a,)
    print "b=%s" % (b,)
    print "c=%s" % (c,)
    print "args=%s" % (args,)

argdict = dict(a="testa", b="testb", c="testc", excessarg="string")
foo(**argdict) 
```

印刷：

```
a=testa
b=testb
c=testc
args={'excessarg': 'string'} 
```

和

```
def foo(a,b,c,*args):
    print "a=%s" % (a,)
    print "b=%s" % (b,)
    print "c=%s" % (c,)
    print "args=%s" % (args,)

argtuple = ("testa","testb","testc","excess")
foo(*argtuple) 
```

印刷：

```
a=testa
b=testb
c=testc
args=('excess',) 
```

* * *

## 回答 #2

> 赞同：196
> 
> 时间：2008-12-30T16:54:18.160

我只有一件事要补充，其他答案并不清楚（为了完整起见）。

您也可以在调用函数时使用星号。例如，假设您有这样的代码：

```
>>> def foo(*args):
...     print(args)
...
>>> l = [1,2,3,4,5] 
```

您可以像这样将列表 l 传递给 foo ...

```
>>> foo(*l)
(1, 2, 3, 4, 5) 
```

你可以对字典做同样的事情......

```
>>> def foo(**argd):
...     print(argd)
...
>>> d = {'a' : 'b', 'c' : 'd'}
>>> foo(**d)
{'a': 'b', 'c': 'd'} 
```

* * *

## 回答 #3

> 赞同：90
> 
> 时间：2009-01-02T10:51:03.603

以上所有答案都非常清楚和完整，但为了记录，我想确认 python 中 * 和 ** 的含义与 C 中看起来相似的运算符的含义绝对没有相似之处。

它们被称为参数解包和关键字参数解包运算符。

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2008-12-30T16:43:30.677

单星意味着变量“a”将是提供给函数的额外参数的元组。双星表示变量“kw”将是随关键字提供的额外参数的可变大小字典。

尽管实际行为已明确，但有时仍可能非常不直观。编写一些示例函数并使用各种参数样式调用它们可能会帮助您了解允许的内容和结果。

```
def f0(a)
def f1(*a)
def f2(**a)
def f3(*a, **b)
etc... 
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2008-12-30T17:28:13.367

在编写将另一个回调函数作为参数的函数时，我发现 * 很有用：

```
def some_function(parm1, parm2, callback, *callback_args):
    a = 1
    b = 2
    ...
    callback(a, b, *callback_args)
    ... 
```

这样，调用者可以传入任意额外的参数，这些参数将传递给他们的回调函数。好处是回调函数可以使用普通的函数参数。也就是说，它根本不需要使用 * 语法。这是一个例子：

```
def my_callback_function(a, b, x, y, z):
    ...

x = 5
y = 6
z = 7

some_function('parm1', 'parm2', my_callback_function, x, y, z) 
```

当然，闭包提供了另一种方法来做同样的事情，而不需要您通过 some_function() 和 my_callback_function() 传递 x、y 和 z。

# .net - VS2005 配置“回退”DLL

> ID：400743
> 
> 赞同：3
> 
> 时间：2008-12-30T16:29:20.707
> 
> 标签：.net, visual-studio, sql-server-2008, dll

我正在尝试将 SQL2008 支持添加到 .NET 2.0 应用程序。但是，我唯一的限制是一些用户仍然会使用 SQL2005，我不想要求他们安装 SQL2008 客户端组件。

我需要的 SQL2008 的实际 DLL 集与 SQL2005 不同。代码可以保持不变。

底线，我需要在VS2005（或手动编辑汇编文件）中说：

如果用户有 DLL_1 v2、DLL_2 v2 和 DLL_3 v2，请使用它们。如果没有，请使用 DLL_1 v1 和 DLL_2 v1。

* * *

我将研究使用反射来加载 DLL，这听起来对我来说几乎是唯一的选择，而不是需要 SQL 2008 客户端组件。

至于重新分发 DLL，我确实阅读了许可证。那里有几个适用于我们的可疑术语（例如，对于托管软件）。另外，这是一个更加复杂的问题，因为我们的客户数据非常敏感，因此他们通过广泛的审批流程来允许安装任何东西，例如我们包含的 DLL。

谢谢您的帮助！

* * *

感谢您的想法！然而，我们还没有完全到那里......

1.  不，用户没有选择他们要安装到哪个数据库版本。目的是允许 SQL2005 和/或 SQL2008，即使在同一个安装中。例如，我们有一个管理应用程序，允许用户跨不同的 SQL 服务器管理数据库实例。

2.  我意识到我们可以添加一个对话框来选择是否需要 SQL2008 支持。但是，这会进一步扩展我们的测试矩阵，这是我们试图避免的。

3.  我相信我确实需要直接引用 DLL。我对数据库做的不仅仅是连接和查询。

我需要的 DLL 是：

*   Microsoft.SqlServer.ConnectionInfo
*   Microsoft.SqlServer.Management.Sdk.Sfc
*   微软.SqlServer.Smo
*   Microsoft.SqlServer.SmoExtended
*   Microsoft.SqlServer.SqlEnum

还有其他想法，想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T20:19:42.180

反射将允许您在运行时动态加载所需的 DLL 集。因此，您可以检测可用的内容并加载它。

唯一的缺点是使用反射会使您的工作更加困难和耗时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T22:14:53.893

If you're just doing basic data access, you shouldn't need to worry about it, either native client should work fine, and you can let the framework hook into it for you. If you specify the SQL client, .Net will use whichever one it can get its hands on. Are you using SMO Objects? In that case there could be some dependency issues.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T16:34:01.743

用户是否选择要安装到哪个数据库版本？（我假设有某种安装过程）。您可以根据所选数据库版本在安装时换出 bin 文件夹中的 dll 文件吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T16:35:42.440

您可以在代码中更改表适配器的连接字符串，那么是否有必要为 SQL2008 编写全新的 dll？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T16:08:31.887

You shouldn't have to make a direct reference to any DLLs at all. If you are using System.Data.SqlClient to connect to your DBs then .Net will know how to talk to both of them. If you aren't using System.Data.SqlClient to communicate with your servers then the next question become can you switch over to that namespace for your DB communication.

This may be a little outside the realm of what you are looking to do, but you could create a service layer abstraction where everybody connects to the service layer and the service layer handles the routing and the communication with the DB servers and you can communicate with the service layer either via SOAP or .Net Remoting. I've started to switch all of my apps over to this method as it allows me to focus my business logic and db abstraction in one controlled location and working with the presentation on the local machine.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-02T23:08:29.267

您可以使用服务容器并在配置文件中连接依赖项。它可能需要将依赖于任一组程序集的代码分离成单独的类和程序集。

IE。两个类库，一个用于 2005，一个用于 2008，两者都包含一组实现一组通用接口的类。然后，应用程序将只向服务容器请求实现其中一个通用接口的对象，并且应用程序配置文件将指示将使用哪个实现。

这种配置当然也可以在应用程序启动时在代码中完成。

这种方法还允许您做更多的事情，而不仅仅是使用一组不同的 dll。如果某些事情需要在 2005 年与 2008 年不同地完成，您可以在您的类库中实现这些差异，并且应用程序不会更明智。

# asp.net - 是否存在用于 asp.net 的 RAD？

> ID：400756
> 
> 赞同：6
> 
> 时间：2008-12-30T16:32:33.087
> 
> 标签：asp.net, asp.net-mvc, asp.net-ajax, webforms, rad

我已经使用经典的 ASP、ASP.NET Web 表单以及最近使用 ExtJS 的 ASP.NET 构建了网站。然而，我一直觉得我必须做很多繁重的工作，并且在应用程序相当成熟之前没有真正的 RAD。

我只是简单地看了一下 RoR 和 Django，但它们看起来是朝着正确方向迈出的一步。有没有人觉得他们拥有相同的 .net 技术组合来快速创建网站？

编辑：我想继续使用与 ASP.NET 一起使用的主流工具（尤其是开源或“低成本”）。还对快速框架配置/设置感兴趣，因为我当前的项目需要大量初始代码（我的）生成模板工作才能使其进入 RAD 状态。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T18:18:42.187

您可以尝试 JQuery + ASP.NET MVC + Linq2SQL。

对于 RAD 来说是一个很好的组合。或者您可以通过[Subsonic更改 linq2SQL](http://subsonicproject.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T20:38:33.590

好吧，asp.net 比必须自己编写套接字接口和处理 Web 请求要 RAD 得多。我想这是一个观点的问题。我仍在等待可以直接插入大脑并弹出任何我能想到的软件的设备。那将是RAD。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-06T22:17:05.657

我使用带有 jQ​​uery 和 Telerik 客户端 api 的 Telerik Rad 控件的 asp.net 它对我来说效果很好，但它当然可以讨论

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T19:56:32.363

我不确定您到底在寻找什么，但根据其他人发布的内容，这是一个更成熟的产品：

[http://www.ironspeed.com](http://www.ironspeed.com)

# mysql - SQL 按日期分组，但也获取不带记录的日期

> ID：400759
> 
> 赞同：2
> 
> 时间：2008-12-30T16:33:03.320
> 
> 标签：mysql, group-by

有没有一种简单的方法来做一个`GROUP BY DATE(timestamp)`包括一段时间内所有天的方法，不管是否有任何与该日期相关的记录？

基本上，我需要生成这样的报告：

```
24 Dec - 0 orders
23 Dec - 10 orders
22 Dec - 8 orders
21 Dec - 2 orders
20 Dec - 0 orders 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T17:50:26.580

假设您的订单比日期多，这样的事情可能会奏效：

```
select date, count(id) as orders
from
(
  SELECT DATE_ADD('2008-01-01', INTERVAL @rn:=@rn+1 DAY) as date from (select @rn:=-1)t, `order` limit 365
) d left outer join `order` using (date)
group by date 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T16:36:00.053

一种方法是创建一个日历表并加入它。

我会永久创建它，然后创建一个插入新日期的任务，它可以每周、每天、每月等完成。

请注意，我假设您将时间戳转换为日期。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T16:39:14.853

不要使用 GROUP BY，而是创建一个包含您想要的特定日期的表（可能是一个临时表），例如：

```
24 Dec
23 Dec
22 Dec
21 Dec
20 Dec 
```

然后，将该表连接到 Orders 表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T16:42:14.177

您需要生成一个中间结果集，其中包含您希望包含在输出中的所有日期...

如果您在存储过程中执行此操作，那么您可以创建一个临时表或表变量（我不知道 MySQL 的功能），但是一旦您在表或某种结果集中拥有所有日期

只需使用外连接从临时表连接到真实数据

在 SQL Server 中是这样的

```
 Declare @Dates Table (aDate DateTime Not Null)
  Declare @StartDt DateTime Set @StartDt = 'Dec 1 2008'
  Declare @EndDt   DateTime Set @EndDt   = 'Dec 31 2008'
  While @StartDt < @EndDt Begin
    Insert @Dates(aDate) Values(@StartDt)
    Set @StartDt = DateAdd(Day, 1, @StartDt)
  End

   Select D.aDate, Count(O.*) Orders
   From @Dates D Left Join 
      OrderTable O On O.OrderDate = D.aDate
   Group By D.aDate 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T16:49:41.587

在数据仓库中，采用的方法是创建一个包含所有日期的表，并在您的数据和日期表之间创建一个外键。我并不是说这是针对您的情况的最佳方法，只是说在需要以多种方式汇总大量数据以进行报告的情况下，这是最佳实践。

如果您在 SQL Server 上使用报告层，您可以编写一些逻辑，在数据返回之后和呈现报告之前在感兴趣的范围内插入缺失的日期。

如果您直接从 SQL Server 创建报表并且您还没有数据仓库，并且现在没有时间或需要创建一个，我将创建一个日期表并加入它。进行连接和获得所需输出所需的格式可能有点不稳定，但它会完成工作。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-10-10T21:15:13.953

有一种非常简单的方法可以做到这一点……除了我不记得了。[但我从这个线程](http://forums.devshed.com/ms-sql-development-95/date-count-rows-420079.html)改编了这个查询：

```
SELECT 
    DISTINCT(LEFT(date_field,11)) AS `Date`,
    COUNT(LEFT(date_field,11)) AS `Number of events`
FROM events_table
GROUP BY `Date` 
```

它也适用于 MySQL

# testing - 如何在您的公司/工作/项目上执行集成测试？

> ID：400772
> 
> 赞同：2
> 
> 时间：2008-12-30T16:36:50.940
> 
> 标签：testing, process, integration-testing, testimonials, test-plan

我想改进我工作的集成测试方法，我想知道这个过程在其他地方是如何发生的。
比如：
- 什么时候开始编写测试计划
- 测试人员、开发人员和要测试的东西（整个应用程序或修改）之间的比例
- 使用什么样的方法进行集成测试。

实际上，我测试 webapps 和测试计划是通过 Test Link 管理的。发现的错误会在 Bugzilla 上报告。我正在尝试使用 Selenium RC 自动化测试，但我需要一些时间来编写计划并编写要在 Selenium 上执行的代码。时间是我没有的东西，因为我正在测试 3 个或更多应用程序。

我的大多数问题都是由测试环境和生产环境之间的差异引起的。但是测试需要很长时间才能开始。如果今天有人完成修改，我需要大约 3 周的时间才能开始测试。并且测试进程队列不断增长。

如果有人提出可以改进测试过程的建议（例如更多人测试等），那将是非常好的。但大多数情况下，我想听听**测试过程在其他地方是如何运作的**。
谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T18:37:03.460

对我们来说，集成测试通常由开发人员在提交之前执行。只是简单的表面测试，看没有明显的损坏。

然后，我们将主干中的代码部署到连接到测试数据库的开发服务器上，该测试数据库是生产数据库的完整副本，并让负责新功能的用户在该服务器上进行验收测试和进一步的集成测试。

我们有一个“超级用户”的概念来组织这个。超级用户负责在他们的专业领域对其他用户进行培训，并回答与系统使用相关的帮助台问题。超级用户也是参与与其工作相关的所有功能的功能请求和需求讨论的人。

因此，当开发新功能时，超级用户首先验证设计建议，然后在部署前执行最后阶段的测试。

这种设置很好，因为它确保了领域专家是验证系统功能的人，并免除了 IT 部门的一些责任。

坏事是他们通常不是非常技术性或优秀的测试人员。作为用户，他们倾向于看到系统是什么而不是它可能是什么。他们作为全职员工在组织中也有他们的普通职能，这一事实也意味着他们在测试方面的资源非常有限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T19:14:20.967

我假设您的意思是集成测试，即检查应用程序的各个部分是否协同工作（例如，在 DBA 和 Web 开发人员分别表示完成后让数据库和网站协同工作）我'将使用我当前项目中的示例

*   我的代码生成了几个配置文件，所以我可以观察应用程序的某些模块打开/关闭，即错误报告、身份验证、调试模式编译，有/没有 SSL。开发环境可能会关闭“友好错误页面”、没有身份验证、没有 SSL 等。

*   我还使用构建脚本为配置文件的每个变体创建应用程序的副本

*   尽可能多地将生产的特性复制到暂存和开发是有帮助的——如果你缺乏硬件，请使用虚拟机

*   我还在生产代码库中写入了一些页面，这些页面测试了当代码从一台机器移动到另一台机器时会中断的事情，即数据库连接是否正常工作，是否发送电子邮件，临时文件夹是否可写并将该页面设为主页服务器操作员页面

关键是尽可能地自动化。频繁的集成测试可以更早地发现问题。

从签入到打包代码进行部署，我需要 8 分钟的自动化工作和 1/2 小时的手动点击烟雾测试。

# silverlight - UserControl 在其继承树中有一个泛型类

> ID：400778
> 
> 赞同：2
> 
> 时间：2008-12-30T16:39:00.033
> 
> 标签：silverlight, generics, xaml, intellisense, silverlight-2.0

我正在尝试创建一个继承自泛型类的 UserControl。它不是直接继承自一个泛型类，而是通过一个不使用泛型的中间类。这在运行时编译并工作，但在设计时出现错误。

这是我的通用父类：

```
Public Class GenericParent(Of T)
    Inherits UserControl
End Class 
```

这是我的非泛型父类：

```
Public Class NonGenericParent
    Inherits GenericParent(Of String)
End Class 
```

这是我的 XAML：

```
<local:NonGenericParent x:Class="SilverlightApplication5.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    xmlns:local="clr-namespace:SilverlightApplication5"
    Width="400" Height="300">
    <StackPanel>
        <Button Content="Hello"/>
    </StackPanel>
</local:NonGenericParent> 
```

IntelliSense 解析器给出以下错误：

1.  在“NonGenericParent”类型中找不到属性“Width”。
2.  在“NonGenericParent”类型中找不到属性“Height”。
3.  “NonGenericParent”类型不支持直接内容。

就好像 IntelliSense 无法查看 GenericParent 类之后的继承树。我尝试直接在 SilverlightApplication5.Page 类、NonGenericParent 类上指定 ContentPropertyAttribute，但它不起作用。

我读过 Silverlight 2.0 不支持 TypeArguments 属性。这就是我创建中间 NonGenericParent 类的原因。

如果有人对如何消除这些错误有任何想法，我很想听到它们。

**更新：**我们已经向 MSFT 开了一张支持票，无论他们的解决方案是什么，我都会对其进行更新。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T18:39:06.770

我们从 Microsoft 收到消息，这不太可能在未来的版本中得到修复。在他们围绕试图找到负责任的组提出问题后，看来这个问题属于他们的 WPF 开发人员组，这就是“不会修复它”答案的来源。

与此同时，我们已经更新了代码以从父类中提取泛型，直到我猜是 XAML 2009。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T17:02:00.143

不确定silverlight，但这可以在c#中按预期编译和运行：

```
 class GenericObject[T] : UserControl
{
}

class StaticObject : GenericObject[Int32]
{
    public Int32 wide { get { return this.Width; } }
}

private void Form1_Load(object sender, EventArgs e)
{
    StaticObject so = new StaticObject();
    this.Text = so.wide.ToString();
} 
```

因此，如果它针对 clr 进行编译，它应该可以正常工作。

正如您所建议的那样，可能只是一个智能感知错误。通常我会建议不要忽略编译器警告，但在这种情况下，警告似乎无效。

编辑：用方括号替换尖括号会导致它们被剥离。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T16:45:48.490

尽管是 2.0 silverlight（尤其是针对 silverlight 的 VS2008 调整）仍然非常年轻。IDE 的东西仍然有怪癖。

即使在成功构建之后，您仍然有问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-10T22:18:34.440

这篇博文似乎与您的问题有关：

[http://blogs.msdn.com/b/wpfsldesigner/archive/2010/01/22/known-issue-controls-deriving-from-a-generic-base-class-must-be-in-separate-assembly。 aspx](http://blogs.msdn.com/b/wpfsldesigner/archive/2010/01/22/known-issue-controls-deriving-from-a-generic-base-class-must-be-in-separate-assembly.aspx)

对于 Silverlight，您似乎必须有 3 个类才能工作。

# python - 在 Python 中调整图像大小而不会丢失 EXIF 数据

> ID：400788
> 
> 赞同：28
> 
> 时间：2008-12-30T16:42:02.537
> 
> 标签：python, image-processing, python-imaging-library, exif

我需要使用 Python 调整 jpg 图像的大小，而不会丢失原始图像的 EXIF 数据（关于拍摄日期、相机型号等的元数据）。所有关于 python 和图像的谷歌搜索都指向我目前正在使用的 PIL 库，但似乎无法保留元数据。我到目前为止的代码（使用 PIL）是这样的：

```
img = Image.open('foo.jpg')
width,height = 800,600
if img.size[0] < img.size[1]:
    width,height = height,width

resized_img = img.resize((width, height), Image.ANTIALIAS) # best down-sizing filter
resized_img.save('foo-resized.jpg') 
```

有任何想法吗？或者我可以使用的其他库？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2014-02-27T09:13:16.497

实际上，有一种非常简单的方法可以仅使用 PIL 将 EXIF 数据从一张图片复制到另一张图片。虽然它不允许修改 exif 标签。

```
image = Image.open('test.jpg')
exif = image.info['exif']
# Your picture process here
image = image.rotate(90)
image.save('test_rotated.jpg', 'JPEG', exif=exif) 
```

如您所见，save 函数可以使用 exif 参数，该参数允许在保存时将原始 exif 数据复制到新图像中。如果您只想这样做，您实际上不需要任何其他库。我似乎找不到有关保存选项的任何文档，我什至不知道这是否特定于 Pillow 或与 PIL 一起使用。（如果有人有某种链接，如果他们在评论中发布，我会很高兴）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-30T17:00:10.660

```
import jpeg
jpeg.setExif(jpeg.getExif('foo.jpg'), 'foo-resized.jpg') 
```

[http://www.emilas.com/jpeg/](http://www.emilas.com/jpeg/)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-11-24T19:57:13.070

您可以使用 pyexiv2 从源图像中复制 EXIF 数据。在以下示例中，使用 PIL 库调整图像大小，使用 pyexiv2 复制的 EXIF 数据和图像大小 EXIF 字段设置为新大小。

```
def resize_image(source_path, dest_path, size):
    # resize image
    image = Image.open(source_path)
    image.thumbnail(size, Image.ANTIALIAS)
    image.save(dest_path, "JPEG")

    # copy EXIF data
    source_image = pyexiv2.Image(source_path)
    source_image.readMetadata()
    dest_image = pyexiv2.Image(dest_path)
    dest_image.readMetadata()
    source_image.copyMetadataTo(dest_image)

    # set EXIF image size info to resized size
    dest_image["Exif.Photo.PixelXDimension"] = image.size[0]
    dest_image["Exif.Photo.PixelYDimension"] = image.size[1]
    dest_image.writeMetadata()

# resizing local file
resize_image("41965749.jpg", "resized.jpg", (600,400)) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-30T19:27:17.557

为什么不使用[ImageMagick](http://www.imagemagick.org/script/index.php)？
它是一个相当标准的工具（例如，它是 Gallery 2 使用的标准工具）；我从未使用过它，但它也有一个[python 接口](http://www.imagemagick.org/download/python/)（或者，您也可以简单地生成命令），最重要的是，应该在所有转换之间维护 EXIF 信息。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-08-09T05:43:53.193

这是截至 2018 年的更新答案。 **piexif**是一个纯 Python 库，对我来说，它可以通过 pip (pip install piexif) 轻松安装并且运行良好（感谢维护者！）。 [https://pypi.org/project/piexif/](https://pypi.org/project/piexif/)

用法非常简单，一行将复制接受的答案并将所有 EXIF 标签从原始图像复制到调整大小的图像：

```
import piexif
piexif.transplant("foo.jpg", "foo-resized.jpg") 
```

我还没有尝试过，但看起来您也可以通过使用链接文档中描述的加载、转储和插入功能轻松执行修改。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-09T13:24:08.497

对于 pyexiv2 v0.3.2，[API 文档](http://tilloy.net/dev/pyexiv2/api.html#pyexiv2.metadata.ImageMetadata.copy)是指将 EXIF 数据从一个图像传递到另一个图像的复制方法。在这种情况下，它将是原始图像的 EXIF 数据到调整大小的图像。

离开@Maksym Kozlenko，复制EXIF数据的更新代码是：

```
 source_image = pyexiv2.ImageMetadata(source_path)
    source_image.read()

    dest_image = pyexiv2.ImageMetadata(dest_path)
    dest_image.read()

    source_image.copy(dest_image,exif=True)
    dest_image.write() 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-31T15:59:57.600

保存后可以使用pyexiv2修改文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-04T07:18:15.457

```
from PIL import Image
img_path = "/tmp/img.jpg"
img = Image.open(img_path)
exif = img.info['exif']
img.save("output_"+img_path, exif=exif) 
```

在 Pillow 2.5.3 中测试

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-05-14T11:55:44.933

似乎@Depado 的解决方案对我不起作用，在我的场景中，图像甚至不包含 exif 段。

pyexiv2 很难在我的 Mac 上安装，而是使用模块 pexif [https://github.com/bennoleslie/pexif/blob/master/pexif.py](https://github.com/bennoleslie/pexif/blob/master/pexif.py)。为了向不包含 exif 信息的图像“添加 exif 段”，我添加了包含在拥有 exif 段的图像中的 exif 信息

```
from pexif import JpegFile

#get exif segment from an image
jpeg = JpegFile.fromFile(path_with_exif)
jpeg_exif = jpeg.get_exif()

#import the exif segment above to the image file which does not contain exif segment
jpeg = JpegFile.fromFile(path_without_exif)
exif = jpeg.import_exif(jpeg_exif)
jpeg.writeFile(path_without_exif) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-04-09T06:40:50.987

[Maksym Kozlenko](https://stackoverflow.com/users/171847/maksym-kozlenko) Python3 和[py3exiv2 v0.7](https://launchpad.net/py3exiv2)的更新版本

```
# Resize image and update Exif data
from PIL import Image
import pyexiv2

def resize_image(source_path, dest_path, size):
    # resize image
    image = Image.open(source_path)
    # Using thumbnail, then 'size' is MAX width or weight
    # so will retain aspect ratio
    image.thumbnail(size, Image.ANTIALIAS)
    image.save(dest_path, "JPEG")

    # copy EXIF data
    source_exif = pyexiv2.ImageMetadata(source_path)
    source_exif.read()
    dest_exif = pyexiv2.ImageMetadata(dest_path)
    dest_exif.read()
    source_exif.copy(dest_exif,exif=True)

    # set EXIF image size info to resized size
    dest_exif["Exif.Photo.PixelXDimension"] = image.size[0]
    dest_exif["Exif.Photo.PixelYDimension"] = image.size[1]
    dest_exif.write() 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-12-30T17:01:28.927

PIL 处理 EXIF 数据，不是吗？查看 PIL.ExifTags。

# algorithm - 生成数字的分区

> ID：400794
> 
> 赞同：37
> 
> 时间：2008-12-30T16:45:41.877
> 
> 标签：algorithm, numbers, decomposition

我需要一种算法来生成所有可能的正数分区，我想出了一个（作为答案发布），但它是指数时间。

该算法应该返回一个数字可以表示为小于或等于其自身的正数之和的所有可能方式。因此，例如对于数字**5**，结果将是：

*   5
*   4+1
*   3+2
*   3+1+1
*   2+2+1
*   2+1+1+1
*   1+1+1+1+1

所以我的问题是：有没有更有效的算法呢？

**编辑：**问题的标题是*“数字的总和分解”*，因为我真的不知道这叫什么。[ShreevatsaR 指出](https://stackoverflow.com/questions/400794/generating-the-partitions-of-a-number#400810)它们被称为“分区”，因此我相应地编辑了问题标题。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-30T16:50:12.613

它被称为[分区](http://mathworld.wolfram.com/Partition.html)。[另见维基百科：[分区（数论）](http://en.wikipedia.org/wiki/Partition_(number_theory))。]

分区数量 p(n) 呈指数增长，因此您为生成*所有*分区所做的任何事情都必须花费指数时间。

也就是说，您可以比您的代码做得更好。请参阅[David](http://code.activestate.com/recipes/218332/) [Eppstein](https://11011110.github.io/blog/2005/08/05/integer-partitions.html)的[Python Algorithms and Data Structures](http://www.ics.uci.edu/~eppstein/PADS/IntegerPartitions.py)或其更新版本。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-30T16:45:56.320

这是我在 Python 中的解决方案（指数时间）：

```
q = { 1: [[1]] }

def decompose(n):
    try:
        return q[n]
    except:
        pass

    result = [[n]]

    for i in range(1, n):
        a = n-i
        R = decompose(i)
        for r in R:
            if r[0] <= a:
                result.append([a] + r)

    q[n] = result
    return result 
```

```
>>> decompose(5)
[[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]] 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-30T22:29:03.430

当您要求更有效的算法时，我不知道该比较哪个。但这是一种以直接方式（Erlang）编写的算法：

```
-module(partitions).

-export([partitions/1]).

partitions(N) -> partitions(N, N).

partitions(N, Max) when N > 0 ->
    [[X | P]
     || X <- lists:seq(min(N, Max), 1, -1),
        P <- partitions(N - X, X)];
partitions(0, _) -> [[]];
partitions(_, _) -> []. 
```

它在时间上是指数的（与[Ca​​n Berk Güder 在 Python 中的解决方案](https://stackoverflow.com/questions/400794/generating-the-partitions-of-a-number#400796)相同）并且在堆栈空间中是线性的。但是使用相同的技巧，memoization，你可以通过节省一些内存和更少的指数来实现很大的改进。（N=50 快十倍）

```
mp(N) ->
    lists:foreach(fun (X) -> put(X, undefined) end,
          lists:seq(1, N)), % clean up process dictionary for sure
    mp(N, N).

mp(N, Max) when N > 0 ->
    case get(N) of
      undefined -> R = mp(N, 1, Max, []), put(N, R), R;
      [[Max | _] | _] = L -> L;
      [[X | _] | _] = L ->
          R = mp(N, X + 1, Max, L), put(N, R), R
    end;
mp(0, _) -> [[]];
mp(_, _) -> [].

mp(_, X, Max, R) when X > Max -> R;
mp(N, X, Max, R) ->
    mp(N, X + 1, Max, prepend(X, mp(N - X, X), R)).

prepend(_, [], R) -> R;
prepend(X, [H | T], R) -> prepend(X, T, [[X | H] | R]). 
```

无论如何，您应该针对您的语言和目的进行基准测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-09-03T04:33:39.470

这是一种更冗长的方法（这是我在知道“分区”一词之前所做的，这使我能够进行谷歌搜索）：

```
def magic_chunker (remainder, chunkSet, prevChunkSet, chunkSets):
    if remainder > 0:
        if prevChunkSet and (len(prevChunkSet) > len(chunkSet)): # counting down from previous
            # make a chunk that is one less than relevant one in the prevChunkSet
            position = len(chunkSet)
            chunk = prevChunkSet[position] - 1
            prevChunkSet = [] # clear prevChunkSet, no longer need to reference it
        else: # begins a new countdown; 
            if chunkSet and (remainder > chunkSet[-1]): # no need to do iterations any greater than last chunk in this set
                chunk = chunkSet[-1]
            else: # i.e. remainder is less than or equal to last chunk in this set
                chunk = remainder #else use the whole remainder for this chunk
        chunkSet.append(chunk)
        remainder -= chunk
        magic_chunker(remainder, chunkSet, prevChunkSet, chunkSets)
    else: #i.e. remainder==0
        chunkSets.append(list(chunkSet)) #save completed partition
        prevChunkSet = list(chunkSet)
        if chunkSet[-1] > 1: # if the finalchunk was > 1, do further recursion
            remainder = chunkSet.pop() #remove last member, and use it as remainder
            magic_chunker(remainder, chunkSet, prevChunkSet, chunkSets)
        else: # last chunk is 1
            if chunkSet[0]==1: #the partition started with 1, we know we're finished
                return chunkSets
            else: #i.e. still more chunking to go 
                # clear back to last chunk greater than 1
                while chunkSet[-1]==1:
                    remainder += chunkSet.pop()
                remainder += chunkSet.pop()
                magic_chunker(remainder, chunkSet, prevChunkSet, chunkSets)

partitions = []
magic_chunker(10, [], [], partitions)
print partitions

>> [[10], [9, 1], [8, 2], [8, 1, 1], [7, 3], [7, 2, 1], [7, 1, 1, 1], [6, 4], [6, 3, 1], [6, 2, 2], [6, 2, 1, 1], [6, 1, 1, 1, 1], [5, 5], [5, 4, 1], [5, 3, 2], [5, 3, 1, 1], [5, 2, 2, 1], [5, 2, 1, 1, 1], [5, 1, 1, 1, 1, 1], [4, 4, 2], [4, 4, 1, 1], [4, 3, 3], [4, 3, 2, 1], [4, 3, 1, 1, 1], [4, 2, 2, 2], [4, 2, 2, 1, 1], [4, 2, 1, 1, 1, 1], [4, 1, 1, 1, 1, 1, 1], [3, 3, 3, 1], [3, 3, 2, 2], [3, 3, 2, 1, 1], [3, 3, 1, 1, 1, 1], [3, 2, 2, 2, 1], [3, 2, 2, 1, 1, 1], [3, 2, 1, 1, 1, 1, 1], [3, 1, 1, 1, 1, 1, 1, 1], [2, 2, 2, 2, 2], [2, 2, 2, 2, 1, 1], [2, 2, 2, 1, 1, 1, 1], [2, 2, 1, 1, 1, 1, 1, 1], [2, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-03T06:44:47.613

这是我在 Haskell 中编写的使用超态的解决方案。

```
import Numeric.Natural       (Natural)
import Control.Monad         (join)
import Data.List             (nub)
import Data.Functor.Foldable (ListF (..), para)

partitions :: Natural -> [[Natural]]
partitions = para algebra
    where algebra Nothing          = []
          algebra (Just (0,_))     = [[1]]
          algebra (Just (_, past)) = (nub . (getAll =<<)) (fmap (1:) past)

getAll :: [Natural] -> [[Natural]]
getAll = fmap (dropWhile (==0) . sort) . subsets
    where subsets xs = flip sumIndicesAt xs <$> indices xs

indices :: [Natural] -> [[Natural]]
indices = join . para algebra
    where algebra Nil                 = []
          algebra (Cons x (xs, []))   = [[x:xs]]
          algebra (Cons x (xs, past)) = (:) <$> [x:xs,[]] <*> past 
```

它绝对不是最有效的，但我认为它非常优雅，而且很有启发性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-22T05:04:57.950

## 这是这个问题的java代码

```
static void printArray(int p[], int n){
        for (int i = 0; i < n; i++)
            System.out.print(p[i]+" ");
        System.out.println();
}

// Function to generate all unique partitions of an integer
static void printAllUniqueParts(int n) {
    int[] p = new int[n]; // An array to store a partition
    int k = 0; // Index of last element in a partition
    p[k] = n; // Initialize first partition as number itself

    // This loop first prints current partition, then generates next
    // partition. The loop stops when the current partition has all 1s
    while (true) {
        // print current partition
        printArray(p, k + 1);

        // Generate next partition

        // Find the rightmost non-one value in p[]. Also, update the
        // rem_val so that we know how much value can be accommodated
        int rem_val = 0;
        while (k >= 0 && p[k] == 1) {
            rem_val += p[k];
            k--;
        }

        // if k < 0, all the values are 1 so there are no more partitions
        if (k < 0){
            break;
        }
        // Decrease the p[k] found above and adjust the rem_val
        p[k]--;
        rem_val++;

        while (rem_val > p[k]) {
            p[k + 1] = p[k];
            rem_val = rem_val - p[k];
            k++;
        }
        p[k + 1] = rem_val;
        k++;
    }
}

public static void main(String[] args) {
    System.out.println("All Unique Partitions of 5");
    printAllUniqueParts(5);

    System.out.println("All Unique Partitions of 7");
    printAllUniqueParts(7);

    System.out.println("All Unique Partitions of 9");
    printAllUniqueParts(8);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-12-03T23:13:28.720

另一个 Java 解决方案。它首先创建只有给定数字的第一个分区。然后它进入 while 循环，在最后创建的分区中找到大于 1 的最后一个数字。从该数字它将 1 移动到数组中的下一个数字。如果下一个数字最终与找到的数字相同，它将移至下一个。当最后创建的分区的第一个数字为 1 时，循环停止。这是因为所有分区中的数字始终按降序排序。

编号为 5 的示例。首先它创建第一个分区，即编号为 5。然后它在最后一个分区中找到大于 1 的最后一个数字。由于我们的最后一个分区是数组 [5,0,0,0,0]，因此它找到了编号5 在索引 0 处。然后从 5 中取一个并将其移动到下一个位置。这就是我们获得分区 [4, 1, 0, 0, 0] 的方式。它再次进入循环。现在它从 4 中取一个并将其向上移动，因此我们得到 [3, 2, 0, 0, 0]。然后同样的事情，我们得到 [3, 1, 1, 0, 0]。在下一次迭代中，我们得到 [2, 2, 1, 0, 0]。现在它从第二秒 2 中取出一个并尝试将其移动到索引 2 中我们有 1。它会跳到下一个索引，因为我们也会得到 2 并且我们会有分区 [2, 1, 2, 0, 0]只是最后一个的重复。相反，我们得到 [2, 1, 1, 1, 0]。在最后一步，我们得到 [1, 1, 1, 1,

```
private static List<int[]> getNumberPartitions(int n) {
    ArrayList<int[]> result = new ArrayList<>();
    int[] initial = new int[n];
    initial[0] = n;
    result.add(initial);
    while (result.get(result.size() - 1)[0] > 1) {
        int[] lastPartition = result.get(result.size() - 1);
        int posOfLastNotOne = 0;
        for(int k = lastPartition.length - 1; k >= 0; k--) {
            if (lastPartition[k] > 1) {
                posOfLastNotOne = k;
                break;
            }
        }
        int[] newPartition = new int[n];
        for (int j = posOfLastNotOne + 1; j < lastPartition.length; j++) {
            if (lastPartition[posOfLastNotOne] - 1 > lastPartition[j]) {
                System.arraycopy(lastPartition, 0, newPartition, 0, lastPartition.length);
                newPartition[posOfLastNotOne]--;
                newPartition[j]++;
                result.add(newPartition);
                break;
            }
        }
    }
    return result;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-08-19T21:24:36.213

这是我的 Rust 实现（灵感来自[Python 算法和数据结构](https://www.ics.uci.edu/~eppstein/PADS/IntegerPartitions.py)）：

```
#[derive(Clone)]
struct PartitionIter {
    pub n: u32,

    partition: Vec<u32>,
    last_not_one_index: usize,
    started: bool,
    finished: bool
}

impl PartitionIter {
    pub fn new(n: u32) -> PartitionIter {
        PartitionIter {
            n,
            partition: Vec::with_capacity(n as usize),
            last_not_one_index: 0,
            started: false,
            finished: false,
        }
    }
}

impl Iterator for PartitionIter {
    type Item = Vec<u32>;

    fn next(&mut self) -> Option<Self::Item> {
        if self.finished {
            return None
        }

        if !self.started {
            self.partition.push(self.n);
            self.started = true;
            return Some(self.partition.clone());
        } else if self.n == 1 {
            return None;
        }

        if self.partition[self.last_not_one_index] == 2 {
            self.partition[self.last_not_one_index] = 1;
            self.partition.push(1);
            if self.last_not_one_index == 0 {
                self.finished = true;
            } else {
                self.last_not_one_index -= 1;
            }
            return Some(self.partition.clone())
        }
        let replacement = self.partition[self.last_not_one_index] - 1;
        let total_replaced = replacement + (self.partition.len() - self.last_not_one_index) as u32;
        let reps = total_replaced / replacement;
        let rest = total_replaced % replacement;
        self.partition.drain(self.last_not_one_index..);
        self.partition.extend_from_slice(&vec![replacement; reps as usize]);
        if rest > 0 {
            self.partition.push(rest);
        }
        self.last_not_one_index = self.partition.len() - (self.partition.last().cloned().unwrap() == 1) as usize - 1;
        Some(self.partition.clone())
    }
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-05-28T18:20:40.250

Java 实现。可以从记忆中受益。

```
public class Partition {

    /**
     * partition returns a list of int[] that represent all distinct partitions of n.
     */
    public static List<int[]> partition(int n) {
        List<Integer> partial = new ArrayList<Integer>();
        List<int[]> partitions = new ArrayList<int[]>();
        partition(n, partial, partitions);
        return partitions;
    }

    /**
     * If n=0, it copies the partial solution into the list of complete solutions.
     * Else, for all values i less than or equal to n, put i in the partial solution and partition the remainder n-i.
     */
    private static void partition(int n, List<Integer> partial, List<int[]> partitions) {
        //System.out.println("partition " + n + ", partial solution: " + partial);
        if (n == 0) {
            // Complete solution is held in 'partial' --> add it to list of solutions
            partitions.add(toArray(partial));
        } else {
            // Iterate through all numbers i less than n.
            // Avoid duplicate solutions by ensuring that the partial array is always non-increasing
            for (int i=n; i>0; i--) {
                if (partial.isEmpty() || partial.get(partial.size()-1) >= i) {
                    partial.add(i);
                    partition(n-i, partial, partitions);
                    partial.remove(partial.size()-1);
                }
            }
        }
    }

    /**
     * Helper method: creates a new integer array and copies the contents of the list into the array.
     */
    private static int[] toArray(List<Integer> list) {
        int i = 0;
        int[] arr = new int[list.size()];
        for (int val : list) {
            arr[i++] = val;
        }
        return arr;
    }
} 
```

# c# - 如何异步调用我的 WCF 服务？

> ID：400798
> 
> 赞同：25
> 
> 时间：2008-12-30T16:46:22.980
> 
> 标签：c#, .net, wcf, windows-services

我有一个从 Windows 服务调用的 WCF 服务。

WCF 服务运行一个 SSIS 包，该包可能需要一段时间才能完成，我不希望我的 Windows 服务必须等待它完成。

如何使我的 WCF 服务调用异步？（或者默认情况下是异步的？）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-30T17:02:57.083

MSDN 的以下文章将满足您的所有需求：

[实现异步服务操作](http://msdn.microsoft.com/en-us/library/ms731177.aspx)

[调用 WCF 服务异步](http://msdn.microsoft.com/en-us/library/ms730059.aspx)

[设计服务合同](http://msdn.microsoft.com/en-us/library/ms733070.aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-04-29T06:46:07.150

在 Visual Studio 2010 的`Add Service Reference > click Advanced button > check the Generate Asynchronous Operations`复选框上。

完成此操作后，将添加异步操作并可供您使用。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-05-12T09:24:49.443

服务端：

```
[ServiceContract]
public interface IMyService
{
    [OperationContract]
    bool DoWork(int i);
} 
```

客户端：

```
[ServiceContract(Name = nameof(IMyService))]
public interface IMyServiceClient : IMyService
{
    [OperationContract]
    Task<bool> DoWorkAsync(int i);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T10:39:07.980

需要在创建时指定客户端内部的 WCF 代理（Windows 服务？），以使异步操作可用。

您可以通过右键单击现有 WCF 代理并选择“配置服务引用”来修改它，您只需选中“生成异步操作”旁边的复选框

好的，这就是 WCF 代理处理的事情。现在您需要在客户端内部使用带有代理的 APM（异步编程模型）。

# biztalk - BizTalk SSO 配置和 SQL 错误 18456，严重性 14，状态 16

> ID：400799
> 
> 赞同：1
> 
> 时间：2008-12-30T16:47:41.263
> 
> 标签：biztalk, single-sign-on

我在尝试配置新安装的 BizTalk Server 2006（不是 R2）时遇到了一个重大问题。该服务器之前安装了 BizTalk，并且运行良好。我已经卸载了 BizTalk，从单独的计算机 SQL 服务器中删除了数据库和作业，然后重新安装了 BizTalk。安装成功，安装过程中没有错误，安装日志中也没有任何内容。

我将 BizTalk 服务器配置为 SSO 主机密服务器，同时创建一个新的 BizTalk 组并注册 BizTalk 运行时。在 SQL 服务器上创建 SSO 数据库时，该过程总是出错。在 ConfigLog 中，有几个警告`MSSQLServerOLAPService does not exist`，然后它显示创建 SSO 数据库时出错。一排有4个。按顺序，它们是：

```
Error ConfigHelper] [DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or access denied.
Error ConfigHelper] SQL error: 08001 Native error code: 17
Error ConfigHelper] c:\depotsetupv2\private\common\configwizard\confighelper\sqlhelper.cpp(1176): FAILED hr = 80004005
Error ConfigHelper] c:\depotsetupv2\private\common\configwizard\confighelper\sqlhelper.cpp(918): FAILED hr = 80004005 
```

然后它在尝试创建每个 BizTalk 数据库时遇到类似的错误。

在 SQL Server 上，SQL Server 日志中有相应的错误 - 用户“[用户名]”的每次尝试登录失败。[客户端：[IP 地址]] 错误：18456，严重性：14，状态：16

SQL 日志中的第一个错误也会在 SQL 服务器的应用程序事件日志中显示为失败审核。

我遇到的最大问题是我登录到 BizTalk 服务器的用户是 BizTalk 服务器和 SQL 服务器上的本地管理员，并且在 SQL sysadmin 组中。我正在配置 BizTalk 服务以在其下运行的用户也是两台服务器上的本地管理员以及 SQL 服务器上的 sysadmin 组中的管理员。我检查了两台机器上的 MSDTC 设置，并确保它们按照 BizTalk 文档的建议进行设置。SQL 浏览器正在 SQL 机器上运行，并且我已使用 SQL 外围应用配置工具验证允许网络访问。

谁能帮我找到我可能错过的东西？

回复：伊格尔：

是的，所有服务器和用户都在同一个域中。我在研究此问题时遇到了有关 SQL 协议的帖子，但我尝试在连接到另一个数据库时从登录用户的默认数据库中的一个表中选择一个计数。运行该查询我完全没有问题。

回复：约西：

我正在 Windows Server 2003 R2 SP1 上安装 BizTalk。是的，我已经删除了 SSODB（虽然我不会错过这样的事情！）。我将确保我提供的用户名正确无误，并检查您链接的来源并回复您。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-31T09:43:09.200

一些指针：

*   查看MSDN 上[使用配置管理器配置企业 SSO](http://msdn.microsoft.com/en-gb/library/aa561969.aspx)页面末尾的两点：

> 使用本地帐户配置 SSO Windows 帐户时，必须指定帐户名称而不指定计算机名称。
> 
> 使用本地 SQL Server 命名实例作为数据存储时，必须使用 LocalMachineName\InstanceName 而不是 LocalMachineName\InstanceName、PortNumber。

*   查看相关的[安装指南](http://www.microsoft.com/downloads/details.aspx?FamilyID=df2e8a88-fb23-49a4-9ac7-d17f72517d12&DisplayLang=en)（不要担心它与 R2 相关，他们似乎隐藏了“R1”文档，但它们是相同的），特别是围绕“Windows 组和服务帐户”的部分

*   另外——只是为了确定——当你卸载了 BizTalk 并删除了数据库时——你也删除了 SSODB，对吗？！:-)

*   日志文件非常混乱 - 特别是在确定哪个错误是实际问题时 - 您是否尝试查找您遇到的任何其他错误？（例如，查看此[博客条目](http://www.malgreve.net/2008/09/error-configuring-biztalk-server-2006.html)）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-05T16:16:09.283

我已经正确设置了一切。对我来说不幸的是，答案是标准的“Windows”答案——重新启动并重试。重新启动 SQL 服务器后，我就可以很好地配置 BizTalk。

但是，我会将 Yossi 的答案设置为已接受，因为这对于可能正在阅读此问题的其他任何人来说都是最相关的。

请记住在所有设置更改后重新启动！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-24T05:02:00.257

确保 BizTalkMgmtDb 和 BizTalkMsgBoxDb 将您的本地管理员帐户作为 DB OWNER。右键单击数据库 --> 属性 --> 文件 --> 所有者：

# c++ - 如何在 C/C++ 中获取 HTML

> ID：400802
> 
> 赞同：-1
> 
> 时间：2008-12-30T16:48:16.723
> 
> 标签：c++, c, httprequest

如何在 C 或 C++ 中获取 HTML？带插座。你能给我一个示例代码吗？

注意 - 我最初关闭了它，但重新打开了。致海报 - 请参阅：

[https://stackoverflow.com/questions/400688/fetch-web-page-in-c](https://stackoverflow.com/questions/400688/fetch-web-page-in-c)

和

[以编程方式读取网页](https://stackoverflow.com/questions/389069/programmatically-reading-a-web-page#389074)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T16:52:25.653

您可以使用[libcURL](http://curl.haxx.se/libcurl/c/example.html)。参考这篇文章：以[编程方式读取网页](https://stackoverflow.com/questions/389069/programmatically-reading-a-web-page#389074)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:54:45.523

你没有提到任何平台，所以我给你一个Win32的答案。

从 Internet 下载任何内容的一种简单方法是`URLDownloadToFile`将`IBindStatusCallback`参数设置为`NULL`. 为了使函数更有用，需要实现回调接口。

# php - PHP函数从数组构建查询字符串

> ID：400805
> 
> 赞同：179
> 
> 时间：2008-12-30T16:49:05.520
> 
> 标签：php

我正在寻找 PHP 函数的名称以从键值对数组构建查询字符串。请注意，我正在寻找*内置的 PHP*函数来执行此操作，而不是自制函数（这似乎都是谷歌搜索返回的结果）。有一个，我只是不记得它的名字或在 php.net 上找到它。IIRC 它的名字并不那么直观。

* * *

## 回答 #1

> 赞同：332
> 
> 时间：2008-12-30T16:52:14.343

你正在寻找[`http_build_query()`](http://us.php.net/manual/en/function.http-build-query.php).

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2011-05-13T19:54:14.290

这是一个简单的 php4 友好的实现：

```
/**
* Builds an http query string.
* @param array $query  // of key value pairs to be used in the query
* @return string       // http query string.
**/
function build_http_query( $query ){

    $query_array = array();

    foreach( $query as $key => $key_value ){

        $query_array[] = urlencode( $key ) . '=' . urlencode( $key_value );

    }

    return implode( '&', $query_array );

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-10-31T08:38:16.143

就像对`@thatjuan`答案的补充一样。
更兼容的 PHP4 版本：

```
if (!function_exists('http_build_query')) {
    if (!defined('PHP_QUERY_RFC1738')) {
        define('PHP_QUERY_RFC1738', 1);
    }
    if (!defined('PHP_QUERY_RFC3986')) {
        define('PHP_QUERY_RFC3986', 2);
    }
    function http_build_query($query_data, $numeric_prefix = '', $arg_separator = '&', $enc_type = PHP_QUERY_RFC1738)
    {
        $data = array();
        foreach ($query_data as $key => $value) {
            if (is_numeric($key)) {
                $key = $numeric_prefix . $key;
            }
            if (is_scalar($value)) {
                $k = $enc_type == PHP_QUERY_RFC3986 ? urlencode($key) : rawurlencode($key);
                $v = $enc_type == PHP_QUERY_RFC3986 ? urlencode($value) : rawurlencode($value);
                $data[] = "$k=$v";
            } else {
                foreach ($value as $sub_k => $val) {
                    $k = "$key[$sub_k]";
                    $k = $enc_type == PHP_QUERY_RFC3986 ? urlencode($k) : rawurlencode($k);
                    $v = $enc_type == PHP_QUERY_RFC3986 ? urlencode($val) : rawurlencode($val);
                    $data[] = "$k=$v";
                }
            }
        }
        return implode($arg_separator, $data);
    }
} 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-12-30T16:52:00.070

[Implode](http://php.net/implode)将为您将一个数组组合成一个字符串，但是要对一个键/值对进行 SQL 查询，您必须编写自己的函数。

# sql - 使用带有 SQL 命令对象和 C# 2.0 的“IN”运算符

> ID：400819
> 
> 赞同：4
> 
> 时间：2008-12-30T16:53:15.870
> 
> 标签：sql, c#-2.0

我想调用一个sql语句，例如：

```
Select * From Table Where Column in ('value1', 'value2', 'value3') 
```

是否像将命令参数的值设置为“ `('value1', 'value2', 'value3')`”一样简单？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-12T07:51:35.197

@Charles：您正朝着正确的方向前进，但我们使用参数化查询主要是为了防止 SQL 注入。将“外部”值 ( `params string[] args`) 硬编码在查询中是自找麻烦。您可以迭代参数，但您仍然必须使用如下参数：

```
 string[] values = new [] {"value1", "value2", "value3", "value4"};
   StringBuilder query = new StringBuilder("Select * From Table Where Column in (");
   SqlCommand cmd = new SqlCommand();
   cmd.Connection = new SqlConnection("Your connection string");
   for(int i = 0; i < columns.Length; i++)
   {
       string arg = string.Format("@arg{0}", i);
       cmd.Parameters.AddwithValue(arg, SanatizeSqlString(columns[i]));
       sb.AppendFormat("{0}, ", arg);
   }
   sb = sb.Remove(sb.Length -2, 2);
   sb.Append(")");
   cmd.CommandText = sb.ToString(); 
```

这样，您最终会得到如下查询：

```
select * from table where column in (@arg0, @arg1, @arg2, @arg3) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T16:57:50.523

如果 in 子句只有三个参数，那么可以使用这些参数。否则你可以构建动态 SQL（小心 SQL 注入攻击）。

另一种方法是创建一个 UDF，它接受一个分隔字符串并返回一个表。那么您可以将查询修改为：

```
select * from 
table inner join
dbo.fn_stringToTable(@params) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T17:04:15.473

另一种选择是将 SqlCommand 的命令类型设置为“文本”并在代码中构造整个 Sql 字符串...假设 Column 是一个 varchar，并且您在一个名为“paramValues”的字符串数组中有值

```
 StringBuilder sbSql = new StringBuilder
                   ("Select * From Table Where Column in (");
       string[] paramValues = new string[] {"value1", "value2", "value3"};
       foreach (string val in paramValues)
          sbSql.Append("'" + val + "', ");
       sbSql = sbSql.Remove(sbSql.Length - 2, 2);
       sbSql.Append(")");

       SqlCommand cmd = new SqlCommand(sbSql.ToString());
       cmd.CommandType = CommandType.Text; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2021-10-19T20:57:56.500

尽管其他答案很有帮助，但这是您可以使用[string.Format](https://docs.microsoft.com/en-us/dotnet/api/system.string.format?view=net-5.0#get-started-with-the-stringformat-method)的另一种非常简单的方法。

假设您有一个 SQL 命令，例如`SELECT * FROM TABLE WHERE Id IN ('1', '2', '3')`：

```
var IdList = new List<int>() { 1, 2, 3 };
SqlCommand command = new SqlCommand(string.Format("SELECT * FROM TABLE WHERE Id IN ('{0}')", string.Join("', '", IdList)), connection); 
```

而已。从单行开始，您就可以实现 IN 运算符的使用。

# tfs - TFS 无法正确构建项目

> ID：400821
> 
> 赞同：4
> 
> 时间：2008-12-30T16:53:23.840
> 
> 标签：tfs

您好我正在尝试使用 TFS 构建我的解决方案，但它似乎跳过了具有依赖关系的项目。例如 Proj B 依赖于 Proj A ，那么它只构建 Proj A 而不是 Proj B。

此外，如果我尝试单独构建项目而不是解决方案，那么它不会创建发布文件夹。它说找不到输出路径。

非常感谢任何帮助谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T22:33:27.617

如果您右键单击解决方案，您将拥有的一个选项是**dependencies**。确保项目在那里正确设置，即使它们可能相互引用，解决方案本身的依赖关系可能不完整或不准确......这就是 MSBuild 使用的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T22:59:05.400

有问题的 SLN 文件是从旧版本的 Visual Studio 转换而来的吗？

我发现有时，例如当您从 VS2003 SLN 文件升级到 VS2008 SLN 文件时，它在 MSBuild 中失败（这实际上是 TFS 所做的）。

尝试使用相同的项目在 VS2008（或您正在使用的任何版本）中创建一个新的 SLN 文件，看看是否可以修复它......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T02:32:37.140

查看配置管理器并确保您正在运行的构建已选择构建这些项目。

可能是您正在为本地构建运行调试配置，然后在 TFS 服务器上运行发布，但配置不同。

# svn - 以编程方式区分 git-svn 和 git repos？

> ID：400822
> 
> 赞同：4
> 
> 时间：2008-12-30T16:54:09.067
> 
> 标签：svn, git, shell, git-svn, visual-c++

我已经设置了一些 shell 东西，根据 CWD 包含的 VC 存储库类型动态定义别名 - 例如，'d' 运行 'svn diff' 或 'git diff'，具体取决于。（基于[this blog post](http://muness.blogspot.com/2008/06/stop-presses-bash-said-to-embrace.html)，如果有人感兴趣......）

我想根据我是在 git repo 还是在 git-svn repo 中定义一些别名。有没有一种简单的方法来区分两者之间的区别？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T17:31:08.133

您可能可以使用`git config`命令的输出来区分 git 和 git-svn 存储库。

```
git config --get svn-remote.svn.url 
```

应该返回同步到的 svn URL，如果有的话。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T22:31:35.967

在确定哪些存储库确切是 git-svn 存储库时，您应该小心一点。一个存储库可能包含多个 svn 存储库。

Kafka 的解决方案只有在使用 -s 或 --std-layout 选项克隆 svn 存储库时才有效，其中实际上*有*一个 branch `trunk`。

Codelogic 的答案只有在调用 svn 存储库时才有效`svn`——并不要求这是真的。

检查配置中是否有 svn-remote 的最简单方法*是*：

```
$ git config --get-regexp ^svn-remote 
```

这将找到任何配置的 git-svn 存储库，无论它们被称为什么。如果匹配，它将以状态 0 退出，如果不匹配，它将以状态 1 退出。

但是，这并不意味着真正使用了 svn 存储库。也可能是有人导入了 svn 存储库，但使用 is 作为子模块或子树合并，甚至根本不使用。如果 git-svn 存储库中的元数据已打开，您可以使用以下内容查看当前 HEAD 中是否使用了任何 svn 修订：

```
$ git rev-list -1 --grep='git-svn-id' HEAD 
```

但这可能有点太令人费解了。你决定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T20:05:06.480

还有一个称为trunk 的分支和一个称为trunk@[REV] 的分支。但是，我认为 codelogics 方法更容易和更清洁。

# javascript - 获取 CRM 弹出窗口以刷新打开窗口

> ID：400834
> 
> 赞同：0
> 
> 时间：2008-12-30T16:58:56.873
> 
> 标签：javascript, asp.net, dynamics-crm, dynamics-crm-4

我正在使用 window.open(...) 从 Intranet 页面加载 Microsoft CRM 4.0 窗口。

当窗口关闭时，我需要它以编程方式按下打开它的页面上的按钮。我可以通过获取按钮（其名称在查询字符串中传递）并在 JavaScript 中执行其 click 方法，从我自己的表单中做到这一点。

我想我可以尝试使用包含 CRM 页面的 iframe 打开我自己的窗口，就像我在 Intranet 上使用其他基于 Web 的系统一样。在页面中，我可以单击页面的 onunload 事件中的按钮。然而，尽管这适用于我们的大多数系统，但使用 CRM 我遇到了两个问题。

1.  如果我打开一个窗口然后简单地关闭它，我会收到 CRM 错误。
2.  如果我在 CRM 窗口中按下保存并关闭按钮，它会保存但不会关闭。

有解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T04:32:44.307

你可以做一些事情，比如使用一个基本的 javascript window.opener 调用。

第 1 页打开 CRM 窗口。在该 CRM 窗口的 OnSave 中，您可以这样调用：

```
if(window.opener.DoSomeFunction != null)
  {
     window.opener.DoSomeFunction;
  } 
```

Where DoSomeFunction() is a defined javascript function in Page 1\. The you could use a PageMethod or a __doPostBack() call. I haven't had a chance to try this inside MS CRM but in theory this approach might work.

Reference on javascript window.opener:

[http://www.dotnetspider.com/resources/22146-How-call-parent-page-javascript-function-from-popup-window.aspx](http://www.dotnetspider.com/resources/22146-How-call-parent-page-javascript-function-from-popup-window.aspx)

[http://www.webreference.com/js/tutorial1/opener.html](http://www.webreference.com/js/tutorial1/opener.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T10:15:43.503

不就是防止跨站脚本造成的错误吗？除非 Intranet 应用程序和 CRM 驻留在同一台服务器上，否则在它们之间来回发送数据非常困难。

抱歉，如果我不完全理解您想要完成的工作，但我无法完全想象您的描述。也许一个简单的草图/绘图会有所帮助？

我自己目前正在使用 Dynamics CRM，并且很乐意提供帮助，因为我们遇到了各种各样的问题并且不得不发明许多解决方法。乐于分享。

# javascript - Javascript (jQuery) 性能测量和最佳实践（不是加载时间）

> ID：400836
> 
> 赞同：22
> 
> 时间：2008-12-30T16:59:26.403
> 
> 标签：javascript, jquery, optimization, performance

我会马上说这个问题与加载时间无关。我知道 YSlow、Firebug 分析器，以及谷歌上任何关于页面组件加载时间的最佳实践和工具。

我在问有什么好的分析工具或库或附加组件来测量 Javascript（特别是 jQuery）的实际执行，只要改善实际用户体验。例如，测量从点击到屏幕上可见结果的时间，或帮助确定为什么基于 jQuery 的悬停效果响应缓慢。

我们注意到当页面/DOM 变得相对较大时（例如，70kb 到 150kb 的 HTML，不包括外部 CSS、JS 和图像），和/或具有非常深的嵌套（从 <body> 到最深标签的 14-25 级)，jQuery 事件触发更慢，或者整个 JS 用户体验变得迟缓。

我还搜索并了解了选择器的最佳实践（例如，按 id 选择比使用类选择要快得多），我将实施这些实践。然而，一旦所有的 jQuery 都被完全加载，并且所有的事件都被钩住了，我们仍然需要改进实际的事件触发和执行。

我已经实现了一些事件委托，并且我确实感觉到减少挂钩的 DOM 元素会使事情稍微好一些，但是对于大页面，整体体验仍然需要改进。我应该提到的是，由于该站点是 AJAX 重的（很多是通过 AJAX 加载而不是初始 HTTP 命中），我们大量使用 livequery 而不是普通的 jQuery 事件挂钩。我还应该提到，我们稍微更关注 IE(7+) 性能，但也需要良好的 Firefox 性能。

当我开发和做出改变时，我想我需要一种方法来衡量改变前后的速度，这样我就可以得到关于改变是否能改善任何东西的具体数字。

任何提示、工具、库、博客文章、URL？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T18:48:48.117

[JSLitmus](http://broofa.com/Tools/JSLitmus/)看起来像是我可以尝试的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-19T08:08:56.403

通过使用 Firebug，您可以进入控制台选项卡，然后单击左上角的 firebug 图标（称为“Firebug 选项”）。然后单击“Profile Javascript”选项，然后执行您想要测量的操作，例如单击 javascript 按钮、拖动 Jquery 可拖动对象或运行一些 javascript 代码的任何您想要的东西。执行完要测量的 javascript 后，返回相同的菜单选项并再次单击“Profile javascript”（以便取消选中）。现在控制台选项卡将填满您之前运行的所有操作以及执行每个方法所花费的时间等（以及总时间）。

# graphics - 是否有可能获得高质量的 2D 图形？

> ID：400839
> 
> 赞同：6
> 
> 时间：2008-12-30T17:00:56.760
> 
> 标签：graphics, 2d

我正在考虑将 2D 和 3D 用于游戏，我倾向于 2D，但我看到的大多数 2D 游戏看起来都是手绘的，而且图形看起来不太好。是否有可能在 2D 中创建漂亮的图形？

我在考虑动画，例如：

*   从攻击对手的玩家的手/眼中射出的光线
*   火从龙的嘴里出来
*   来自玩家或发光球体的光芒
*   战斗中产生的火球

如果没有那种“业余”/“手绘”/DOS 游戏的外观，这些东西在 2D 中是否可行？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-30T17:02:25.447

看看 World Of Goo，看看 2D 游戏有多漂亮。[http://2dboy.com/games.php](http://2dboy.com/games.php)

是的，您可以制作非常漂亮、漂亮的 2D 图形。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-30T17:22:35.280

您将“质量”与“现实主义”混合在一起。

如果您在 2D 中绘画，您将与 Raphael、Cezanne、Monet 等人一样受到限制。他们在那里确实有很好的 2D 东西。

如果您使用 3D，您可以免费获得透视和阴影，因此您不必手动进行。但是，如果您不注意，结果的“质量”可能就像业余爱好者一样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-31T01:47:05.963

对于星际争霸，他们构建了所有事物的 3D 模型，然后将它们转换为精灵，这样他们就可以使用具有 2D 渲染速度的高质量 3D 艺术品。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T17:03:45.520

这当然是可能的。如果您有 Xbox 360，请查看 Geometry Wars Evolved 2。许多 iPhone 游戏也有非常漂亮的 2D 图形。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T18:05:41.543

我所有的[Physle 游戏](http://physle.com)都是 2D 的，虽然光滑可能不是我的确切目标，但它们都具有粒子效果和高分辨率纹理，而 Illustrator 矢量艺术通常可以做到这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-31T01:34:19.513

二维图形看起来不如我们的主要原因之一是它们通常是低预算游戏。大多数低预算游戏在 2D 中做事是有原因的：在 2D 中制作像样的游戏比在 3D 中容易得多。

制作 3D 图形需要你实际制作角色的 3D 模型，这比你随便找一个有艺术能力的朋友为你做艺术更耗时，而且需要找到更稀有/更具体的技能组合（可能是免费的）。更不用说编写 3D 引擎需要多少时间了。

正如其他人所说，*没有*理由 2D 看起来不如 3D。使用 2D 并完成您的项目，而不是尝试 SuperawesomeWTFBBQ 3D 图形，并且永远无法在时间要求的情况下真正完成您的项目。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T17:03:13.837

我不明白为什么不。我所有的 DVD 都绘制到 2D 屏幕上，它们看起来根本不像手绘 :-)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-30T17:08:12.423

我喜欢的许多老游戏都是 2D 制作的，而且它们看起来确实很漂亮。例如，洛克人 X、命令与征服泰伯利亚太阳、街头霸王。您始终可以在 2D 中执行您提到的操作，但与在 3D 中执行此操作相比，您可能需要额外的工作才能获得特定效果，反之亦然。这只是一个权衡的问题。为正确的工作选择正确的工具:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T17:05:13.770

街头霸王2？

说真的，应用程序中的图形与绘制时一样好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-30T17:57:34.850

“手绘”一点都不是坏事，看看实际玩的时候看起来很棒的[辫子](http://braid-game.com)（截图只是不公平）

# css - 圆形 CSS 选项卡

> ID：400843
> 
> 赞同：0
> 
> 时间：2008-12-30T17:02:13.900
> 
> 标签：css, rounded-corners

我使用 CSS 创建了一些圆形导航选项卡，但在实现时遇到了麻烦`hover`。

首先这里是一个指向站点[标签](http://www.ronnieweb.byethost10.com/test/index.html)的链接，因为它很难解释。请将鼠标悬停在选项卡的左侧以了解我的问题。我已经在下面解释了。

我在`#navigation li`包含左侧角的项目上设置了背景图像，然后我有第二个背景图像（右侧角），这是使用`#navigation a`.

但是，当我将鼠标悬停在选项卡的左侧时，只显示了一小块背景，我想这是因为只有 li 区域被悬停在上面。显然，当您将鼠标悬停在其其余部分上时，我希望整个选项卡都能突出显示。

这很难解释，所以如果您需要进一步询问我以了解问题，请这样做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T17:12:29.513

几件事：

通过去掉 <li> 的填充并将其放回子 <a> 来解决问题 - 它们占用的空间需要相同才能使悬停对齐。

现在你有一个不同的问题，左角不显示。通过使`a`and的背景颜色`a:hover`等于`transparent`而不是颜色来解决此问题 - 现在 <li> 可以显示出来。

最后，我建议您将行为从完全更改为另一个图像，更改为具有不同背景位置的同一图像，因此翻转加载不可见。

[编辑：此处](http://monkeyflash.com/tutorials/css-image-rollover-navbar/)描述的没有图像交换的 css 翻转

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T17:16:49.487

使用 jQuery 非常简单！但你甚至可以尝试可扩展的盒子：

[http://www.usabilitypost.com/2008/11/27/scalable-content-box-using-only-one-background-image/](http://www.usabilitypost.com/2008/11/27/scalable-content-box-using-only-one-background-image/)

然后在悬停时更改背景图像。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T17:26:57.267

或者你可以用这些替换你的 li:hover 和 a:hover ：

```
#navigation li:hover {
        background: #009BDA url(images/tab_left_on.gif) no-repeat top left;
        cursor : pointer;
        }

#navigation li:hover a {
        background: #009BDA url(images/tab_right_on.gif) no-repeat top right;
        color: #FFF;
} 
```

请注意，它可能不适用于 IE6。

# asp.net - ASP.Net ScriptControl - 从另一个调用一个方法

> ID：400849
> 
> 赞同：0
> 
> 时间：2008-12-30T17:03:23.307
> 
> 标签：asp.net, javascript, ajax, scriptcontrol, extendercontrol

假设我有两个脚本控件，一个控件将另一个控件作为子控件：

```
ParentControl : ScriptControl
{
   ChildControl childControl;
} 
```

子控件的脚本：

```
ChildControl = function(element) 
{
  ChildControl.initializeBase(this, [element]);
}

ChildControl.prototype =
{
    callMethod: function()
    {
      return 'hi';
    },

    initialize: function() 
    {
      ChildControl.callBaseMethod(this, 'initialize');
    },

    dispose: function() 
    {
      ChildControl.callBaseMethod(this, 'dispose');
    }
} 
```

在脚本方面，我想在子控件上调用一个方法：

```
ParentControl.prototype =
{
    initialize: function() 
    {
      this._childControl = $get(this._childControlID);
      this._childControl.CallMethod();

      ParentControl.callBaseMethod(this, 'initialize');
    },

    dispose: function() 
    {
      ParentControl.callBaseMethod(this, 'dispose');
    }
} 
```

问题是，每次我尝试这都是说找不到或不支持这种方法。ParentControl 不应该可以访问 ChildControl 上的所有方法吗？

有什么方法我必须公开该方法以便 ParentControl 可以看到它？

**更新** 是否可以“键入” this._childControl？

这就是我问的原因...当我使用 Watch 时，系统知道 ChildControl 类是什么，我可以从类本身调用方法，但是，我不能从 this._childControl 对象调用相同的方法。您会认为，如果内存中的类设计（？）识别出存在的方法，并且从该类实例化的对象也会。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T20:36:30.553

问题是“这个”。这在 javaScript 中是指 DOM 对象。您需要做一些类似于使用 Function.createDelegate 时发生的事情，这是使用 $addHandler 时所必需的（我知道您没有使用它，只是给出上下文）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T08:08:42.590

在客户端上，您通过将其传递给 $get 来使用名为 _childControlID 的父控件对象的字段。这样做有几个问题：

1.  _childControlID 是如何设置的？我猜想通过将它作为属性添加到服务器上的父控件描述符中，但是您没有显示该代码，也没有在客户端父控件类上显示属性。
2.  $get 返回元素引用——而不是控件。因此，即使 _childControlID 设置为有效的元素 ID，该元素也不会有一个名为 CallMethod 的方法。如果客户端子控件类确实在父控件之前初始化，则元素将具有一个名为“控件”的字段，您可以使用该字段来访问将自身“附加”到元素的脚本控件。当然，这只适用于子控件在父控件之前初始化的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-14T13:35:06.540

你有几个选择。

1.  您可以使用**$find()**找到您的子脚本控件。但是您会遇到在子控件之前初始化父控件的风险。

    ```
    this._childControl = $find(this._childControlID);
    this._childControl.CallMethod(); 
    ```

2.  您可以使用**AddComponentProperty()**在服务器上的控件描述符中注册一个属性。这将确保在初始化父控件之前初始化所有子控件。

    ```
    public class CustomControl : WebControl, IScriptControl
    {
         public ScriptControl ChildControl { get; set; }

         public IEnumerable<ScriptDescriptor> GetScriptDescriptors()
         {
             var descriptor = new ScriptControlDescriptor("Namespace.MyCustomControl", this.ClientID);
             descriptor.AddComponentProperty("childControl", ChildControl.ClientID);

             return new ScriptDescriptor[] { descriptor };
         }

         public IEnumerable<ScriptReference> GetScriptReferences()
         {
             var reference = new ScriptReference
                             {
                                 Assembly = this.GetType().Assembly.FullName,
                                 Name = "MyCustomControl.js"
                             };

             return new ScriptReference[] { reference };
         }
    } 
    ```

然后，只要您创建一个客户端属性“childControl”，它将自动初始化并准备好在父控件的 init() 方法中使用。

# javascript - 如何针对中等大小的数组最好地执行客户端验证

> ID：400859
> 
> 赞同：0
> 
> 时间：2008-12-30T17:06:27.730
> 
> 标签：javascript, html, performance

**概述：**
我有一个 20 字节字符串数组，需要存储在网页上以用于用户输入验证。我预计该数组中有 25 到 1000 个元素。

**注意事项：**
1\. Web 客户端将是一种内存和处理器能力降低的移动设备。
2\. 我仅限于客户端验证（我们目前的技术限制）。
3\. 安全不是问题——我知道用户可以查看源代码。
4\. 我不想向用户显示数组。我只希望用户输入一个值，然后遍历数组以查看是否匹配。如果不匹配，我将向用户发出一个 javascript 消息框。

**问题：**
存储和迭代这些数据的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T17:13:03.910

不要迭代，而是使用关联数组，并测试该元素是否存在：

```
var myChunks=[]
myChunks['aabbccdd...'] = true 
```

然后您可以通过一个简单的测试来检查输入的值是否存在。无需循环：

```
if(myChunks[myValue]) {
   //found the value
}
else {
  // did not find value
} 
```

# c# - 为什么这个文件实际上没有写入磁盘？

> ID：400861
> 
> 赞同：3
> 
> 时间：2008-12-30T17:07:08.663
> 
> 标签：c#, file-io

我必须编写一个从包含以下内容的文件中读取的程序：

```
toto, M, 50
fifi, F, 60
soso, F, 70
lolo, M, 60
fifi, F, 60 
```

* * *

然后找到以下内容：

哪个标记重复次数最多，重复了多少次？

*   平均所有学生
*   平均所有男性
*   平均所有女性

有多少低于平均分？

比平均分高出多少？

并反转。

在一个文件中，有多少学生的名字以 T 开头并以 T 结尾？

（所有结果都应该放在一个输出文件中）

* * *

我已经完成了这一切，没有任何错误，但它没有写在文件上，任何人都可以告诉我为什么，请我不想使用任何新方法（LINQ 和其他先进的东西）。

```
 using System;
using System.Collections.Generic;

using System.Text;
using System.IO;

namespace Exam_Ex
{
    class Program
    {
        public static int[] ReadFile(string FileName, out string[] Name, out char[] Gender)
        {
            Name = new string[1];
            int[] Mark = new int[1];
            Gender = new char[1];
            if (File.Exists(FileName))
            {
                FileStream Input = new FileStream(FileName, FileMode.Open, FileAccess.Read);
                StreamReader SR = new StreamReader(Input);
                string[] Current;
                int Counter = 0;
                string Str = SR.ReadLine();
                while (Str != null)
                {
                    Current = Str.Split(',');
                    Name[Counter] = Current[0];
                    Mark[Counter] = int.Parse(Current[2]);
                    Gender[Counter] = char.Parse(Current[1].ToUpper());
                    Counter++;
                    Array.Resize(ref Name, Counter + 1);
                    Array.Resize(ref Mark, Counter + 1);
                    Array.Resize(ref Gender, Counter + 1);
                    Str = SR.ReadLine();
                }
            }
            return Mark;
        }

        public static int MostFreq(int[] M, out int Frequency)
        {
            int Counter = 0;
            int Frequent = 0;
            Frequency = 0;
            for (int i = 0; i < M.Length; i++)
            {
                Counter = 0;
                for (int j = 0; j < M.Length; j++)
                    if (M[i] == M[j])
                        Counter++;
                if (Counter > Frequency)
                {
                    Frequency = Counter;
                    Frequent = M[i];
                }
            }
            return Frequent;
        }

        public static int Avg(int[] M)
        {
            int total = 0;
            for (int i = 0; i < M.Length; i++)
                total += M[i];
            return total / M.Length;
        }

        public static int AvgCond(char[] G, int[] M, char S)
        {
            int total = 0;
            int counter = 0;
            for (int i = 0; i < G.Length; i++)
                if (G[i] == S)
                {
                    total += M[i];
                    counter++;
                }
            return total / counter;
        }

        public static int BelowAvg(int[] M, out int AboveAvg)
        {
            int Bcounter = 0;
            AboveAvg = 0;
            for (int i = 0; i < M.Length; i++)
            {
                if (M[i] < Avg(M))
                    Bcounter++;
                else
                    AboveAvg++;
            }
            return Bcounter;
        }

        public static int CheckNames(string[] Name, char C)
        {
            C = char.Parse(C.ToString().ToLower());
            int counter = 0;
            string Str;
            for (int i = 0; i < Name.Length - 1; i++)
            {
                Str = Name[i].ToLower();
                if (Str[0] == C || Str[Str.Length - 1] == C)
                    counter++;
            }
            return counter;
        }

        public static void WriteFile(string FileName, string[] Output)
        {
            FileStream FS = new FileStream(FileName, FileMode.OpenOrCreate, FileAccess.Write);
            StreamWriter SW = new StreamWriter(FS);
            for (int i = 0; i < Output.Length; i++)
                SW.WriteLine(Output[i]);
        }

        static void Main(string[] args)
        {
            int[] Mark;
            char[] Gender;
            string[] Name;
            string[] Output = new string[8];
            int Frequent, Frequency, AvgAll, MaleAvg, FemaleAvg, BelowAverage, AboveAverage, NamesCheck;
            Mark = ReadFile("c:\\IUST1.txt", out Name, out Gender);
            Frequent = MostFreq(Mark, out Frequency);
            AvgAll = Avg(Mark);
            MaleAvg = AvgCond(Gender, Mark, 'M');
            FemaleAvg = AvgCond(Gender, Mark, 'F');
            BelowAverage = BelowAvg(Mark, out AboveAverage);
            NamesCheck = CheckNames(Name, 'T');
            Output[0] = "Frequent Mark = " + Frequent.ToString();
            Output[1] = "Frequency = " + Frequency.ToString();
            Output[2] = "Average Of All = " + AvgAll.ToString();
            Output[3] = "Average Of Males = " + MaleAvg.ToString();
            Output[4] = "Average Of Females = " + FemaleAvg.ToString();
            Output[5] = "Below Average = " + BelowAverage.ToString();
            Output[6] = "Above Average = " + AboveAverage.ToString();
            Output[7] = "Names With \"T\" = " + NamesCheck.ToString();
            WriteFile("d:\\output.txt", Output);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T17:20:28.170

其他答案是关于明确调用 Close - 我建议不要这样做，而是将 StreamWriter （以及 StreamReader 和流）的使用包装在一个`using`语句中，例如

```
using (StreamWriter SW = new StreamWriter(FS))
{
    for (int i = 0; i < Output.Length; i++)
    {
        SW.WriteLine(Output[i]);
    }
} 
```

这将`Dispose`自动调用，这将关闭相应的资源。仅在方法末尾手动调用`Close`容易受到异常的影响——您通常希望将它放在一个`finally`块中，但这就是`using`语句自动执行的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T17:11:14.087

我没有测试它。但是你应该`SW.close()`在写完东西后打电话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T17:12:41.367

在WriteFile方法中，在SW.WriteLine(Output[i]);之后，执行SW.Close();
我相信缓冲区不会被清空，直到你调用 Close();

# visual-studio - Visual Studio：如何在“属性”窗口中查看“高级”属性？

> ID：400862
> 
> 赞同：10
> 
> 时间：2008-12-30T17:07:32.860
> 
> 标签：visual-studio, winforms

我在设计表单时需要查看表单的[ClientRectangle](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.clientrectangle.aspx)。此特定属性被标记为“[高级](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsablestate.aspx)”，默认情况下在“属性”窗口中隐藏：

```
[EditorBrowsable(EditorBrowsableState.Advanced), ...]
public Rectangle ClientRectangle 
```

如果`ClientRectangle`我想看的房产不在了，那么我想我可以选择高级`ClientSize`房产：

```
[..., EditorBrowsable(EditorBrowsableState.Advanced)]
public Size ClientSize 
```

[EditorBrowsable](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsableattribute.aspx)属性的文档导致[一个具有 3 个值的枚举](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsablestate.aspx)：

> **Always**属性或方法始终可以在编辑器中浏览。
> 
> **从不**属性或方法永远不能在编辑器中浏览。
> 
> **高级**属性或方法是只有高级用户才能看到的功能。编辑器可以显示或隐藏这些属性。

显然我是“高级用户”，那么如何告诉 Visual Studio 我是*高级用户*，以便我可以看到*高级属性*？

* * *

## 更新一

[链接](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsableattribute.aspx)页面讨论了能够启用 Intellisense 和属性窗口以显示高级成员：

> 在 Visual C# 中，您可以使用工具 | 下的隐藏高级成员设置来控制高级属性何时出现在 IntelliSense 和属性窗口中。选项 | 文本编辑器 | C＃。对应的 [EditorBrowsableState](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsablestate.aspx)是[Advanced](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsablestate.advanced.aspx)。

不幸的是，这个选项实际上似乎只适用于 Intellisense。取消选中它不会使高级属性在“属性”窗口中可见

**注意：**该选项默认未选中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-04-21T09:38:26.293

Hans Passant 在[查找和使用隐藏属性（例如 DisplayRectangle）中](https://stackoverflow.com/questions/3708771/finding-and-using-hidden-propertiessuch-as-displayrectangle/3708900#3708900)的回答为我清除了这一点：无法完成。EditorBrowsable 仅适用于 TEXT 编辑器，在 Properties 窗口中控制显示的属性是“Browsable(false)”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T18:07:43.177

答案在[您提供的链接](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsableattribute.aspx)中：

> 在 Visual C# 中，您可以使用工具 | 下的隐藏高级成员设置来控制高级属性何时出现在 IntelliSense 和属性窗口中。选项 | 文本编辑器 | C＃。对应的 EditorBrowsableState 是 Advanced。

# sql-server - 如果我使用 Linq，是否必须手动关闭 SQL 连接？

> ID：400866
> 
> 赞同：8
> 
> 时间：2008-12-30T17:09:07.413
> 
> 标签：sql-server, visual-studio-2008, linq

传统上，当我们使用SQL字符串做一些工作时，我们必须在页面关闭之前关闭sql连接，我想知道如果我使用Linq进行数据操作，我还需要手动关闭连接吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T17:17:12.747

[这与这个问题](https://stackoverflow.com/questions/389822/when-should-i-dispose-of-a-data-context)非常相似（但不*完全*重复）。

LINQ to SQL 将在需要时打开和关闭连接 - 您实际上不必处理 DataContext。但是，有时您可以“欺骗”上下文以使您不应该打开连接 - 我个人喜欢理所当然地处理它。有关 LINQ to SQL 团队的 Matt Warren 的更多详细信息，请参阅我对另一个问题的回答。

但是，我不了解实体框架。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T18:27:37.223

我详细回答了一个关于关闭连接的问题，您可能会[在这里](https://stackoverflow.com/questions/141204/what-is-the-proper-way-to-ensure-a-sql-connection-is-closed-when-an-exception-is#141261)感兴趣。

* * *

[微软在这里](http://msdn.microsoft.com/en-us/library/bb386929.aspx)回答了这个问题：

> 问：我的数据库连接保持打开状态多久？
> 
> A. 在您使用查询结果之前，连接通常保持打开状态。如果您希望花时间处理所有结果并且不反对缓存结果，请将 ToList<(Of <(TSource>)>) 应用于查询。在每个对象只处理一次的常见场景中，流模型在 DataReader 和 LINQ to SQL 中都表现出色。
> 
> 连接使用的确切细节取决于以下内容：
> 
> 使用连接对象构造 DataContext 时的连接状态。
> 
> 连接字符串设置（例如，启用多个活动结果集 (MARS)。有关详细信息，请参阅多个活动结果集 (MARS)。

* * *

更多细节可以在[这里](http://msdn.microsoft.com/en-us/library/bb386944.aspx)找到：

> 您可以在创建 LINQ to SQL DataContext 时提供现有的 ADO.NET 连接。针对 DataContext 的所有操作（包括查询）都使用这个提供的连接。如果连接已打开，则 LINQ to SQL 将在您完成连接后保持原样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T17:14:21.053

在代码中，您不需要打开和关闭连接。但是，IMO 应将 LinqDataContext 视为 SqlConnection 或 SqlCommand 之类的资源，并且应该是 using 块的一部分，以便在不使用时将其处理掉。尽管我在 MSDN 上读到这不是必需的，但这是一个很好的做法。

# c# - Active Directory - 检查用户名/密码

> ID：400872
> 
> 赞同：34
> 
> 时间：2008-12-30T17:11:43.243
> 
> 标签：c#, windows-vista, active-directory, ldap

我在 Windows Vista Ultimate SP1 上使用以下代码来查询我们的活动目录服务器，以检查域中用户的用户名和密码。

```
public Object IsAuthenticated()
{
    String domainAndUsername = strDomain + "\\" + strUser;
    DirectoryEntry entry = new DirectoryEntry(_path, domainAndUsername, strPass);
    SearchResult result;
    try
    {
        //Bind to the native AdsObject to force authentication.         

        DirectorySearcher search = new DirectorySearcher(entry) { Filter = ("(SAMAccountName=" + strUser + ")") };

        search.PropertiesToLoad.Add("givenName"); // First Name                
        search.PropertiesToLoad.Add("sn"); // Last Name
        search.PropertiesToLoad.Add("cn"); // Last Name

        result = search.FindOne();

        if (null == result)
        {
            return null;
        }

        //Update the new path to the user in the directory.
        _path = result.Path;
        _filterAttribute = (String)result.Properties["cn"][0];
    }
    catch (Exception ex)
    {
        return new Exception("Error authenticating user. " + ex.Message);
    }
    return user;
} 
```

目标使用 .NET 3.5，并使用 VS 2008 标准编译

我在运行应用程序的域管理员的域帐户下登录。

该代码在 Windows XP 上完美运行；但在 Vista 上运行时出现以下异常：

```
System.DirectoryServices.DirectoryServicesCOMException (0x8007052E): Logon failure: unknown user name or bad password.

   at System.DirectoryServices.DirectoryEntry.Bind(Boolean throwIfFail)
   at System.DirectoryServices.DirectoryEntry.Bind()
   at System.DirectoryServices.DirectoryEntry.get_AdsObject()
   at System.DirectoryServices.DirectorySearcher.FindAll(Boolean findMoreThanOne)
   at System.DirectoryServices.DirectorySearcher.FindOne()
   at Chain_Of_Custody.Classes.Authentication.LdapAuthentication.IsAuthenticated()
   at System.DirectoryServices.DirectoryEntry.Bind(Boolean throwIfFail)
   at System.DirectoryServices.DirectoryEntry.Bind()
   at System.DirectoryServices.DirectoryEntry.get_AdsObject()
   at System.DirectoryServices.DirectorySearcher.FindAll(Boolean findMoreThanOne)
   at System.DirectoryServices.DirectorySearcher.FindOne()
   at Chain_Of_Custody.Classes.Authentication.LdapAuthentication.IsAuthenticated() 
```

我尝试更改身份验证类型，但不确定发生了什么。

* * *

**另见**：[针对 Active Directory 验证用户名和密码？](https://stackoverflow.com/questions/290548/c-validate-a-username-and-password-against-active-directory)

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-01-01T18:20:35.537

如果您使用的是 .net 3.5，请改用此代码。

要验证用户：

```
PrincipalContext adContext = new PrincipalContext(ContextType.Domain);

using (adContext)
{
     return adContext.ValidateCredentials(UserName, Password);
} 
```

如果您需要查找用户对对象的 R/W 属性，请执行以下操作：

```
PrincipalContext context = new PrincipalContext(ContextType.Domain);
UserPrincipal foundUser = 
    UserPrincipal.FindByIdentity(context, "jdoe"); 
```

这是使用 System.DirectoryServices.AccountManagement 命名空间，因此您需要将其添加到您的 using 语句中。

如果您需要将 UserPrincipal 对象转换为 DirectoryEntry 对象以使用旧代码，您可以执行以下操作：

```
DirectoryEntry userDE = (DirectoryEntry)foundUser.GetUnderlyingObject(); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-03-26T19:01:02.433

我发现相同的代码在 Internet 上的多个网站上流传，但它对我不起作用。Steve Evans 可能是对的，如果您使用的是 .NET 3.5，则不应使用此代码。但是，如果您仍在使用 .NET 2.0，您可以尝试通过以下方式对您的 AD 服务进行身份验证：

```
DirectoryEntry entry = new DirectoryEntry("LDAP://" + domain, 
   userName, password, 
   AuthenticationTypes.Secure | AuthenticationTypes.SecureSocketsLayer);
object nativeObject = entry.NativeObject; 
```

第一行使用域、用户名和密码创建一个 DirectoryEntry 对象。它还设置 AuthenticationTypes。请注意我是如何在两个参数之间使用“按位或”（'|'）运算符设置安全（Kerberos）身份验证和 SSL 的。

第二行使用第一行的信息强制“入口”的 NativeObject 绑定到 AD 服务。

如果抛出异常，则凭据（或设置）不正确。如果没有例外，则您已通过身份验证。异常消息通常会指示出了什么问题。

此代码与您已经拥有的代码非常相似，但是在您拥有“路径”的地方使用域，并且用户名没有与域结合。确保也正确设置您的 AuthenticationTypes。这可以成就或破坏身份验证的能力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T14:50:02.293

无论如何我都想通了

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T17:26:13.417

绑定到 LDAP 是否需要提升权限 (UAC)？您可以尝试以管理员身份运行 Visual Studio 和/或应用程序，看看是否有帮助。如果这是问题所在，您可以随时向应用程序添加清单并将其设置为需要提升，这样当用户运行它时它会提示。

不知道为什么它需要更高的权限，但值得一试。

# java - 在为 SQL Server 2005/2008 使用最新的 jdbc 驱动程序时，准备好的语句、视图和存储过程在性能方面如何比较？

> ID：400881
> 
> 赞同：1
> 
> 时间：2008-12-30T17:13:05.830
> 
> 标签：java, sql, sql-server-2005, performance, jdbc

在为 SQL Server 2005/2008 使用最新的 Microsoft jdbc 驱动程序时，准备好的语句、视图和存储过程在性能方面如何比较？

如果我有一个带有一些动态 where 子句的普通旧 select 语句，我会看到从准备好的语句中的直接 SQL 移动到视图甚至存储过程的好处吗？

更具体地说，像这样的东西呢：

```
select foo.name, bar.name, baz.name, belch.burp
from foo 
inner join bar on foo.id=bar.fooID
inner join baz on bar.id=baz.barID
inner join belch on baz.id = belch.bazID
where foo.name like '%<USERINPUT>%' and bar.name like '%<USERINPUT>%' 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T18:40:30.350

由于 SP 的缓存执行计划，您不太可能看到显着的性能差异，因为执行计划也在 SQL Server 2005 和更高版本中缓存，甚至对于 ad hoc SQL。

在参数嗅探可能由于对某些参数值的错误基数估计而对性能产生不利影响的情况下，您可以使用 WITH RECOMPILE 指示符。

视图和存储过程的好处将体现在安全和维护领域，其中的好处可能太多，无法在此处详尽介绍，但包括以下能力：

限制从 SELECT 语句中读取受保护的数据，而不必为基础表分配单个列权限。

重用来自其他 SQL 代码和应用程​​序中多个位置的参数化 SP。

在不影响或重新部署应用程序代码的情况下，将应用程序 SP 检测、记录、分析和调整为系统的命名数据库接口组件。

在不影响或重新部署应用程序代码的情况下重构数据库。

提供与数据库的抽象层和接口契约，可以很好地了解系统所需和提供的数据库服务，其中可能包括自动生成有关接口的元数据的可能性，可以进行自动测试的单独层，以及也可以用作后端可移植性的分界点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T20:01:43.383

无论您以何种方式将其呈现为带有通配符作为第一个字符的 like 语句，您永远不会从这样的语句中获得良好的性能，这自动意味着索引不用于该字段。坦率地说，我们一直坚持我们的用户必须至少输入第一个字符才能进行搜索。如果您的数据不知道第一个字符，那么您可能有一个糟糕的设计和规范化问题（在一个字段中存储多个信息位）。没有重新设计数据库的好办法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T17:17:14.667

取决于 sql 和您的应用程序。我不相信有一个笼统的答案，它可能不取决于驱动程序。

如果您可以选择编写一个将大量数据带回中间层的查询以执行数据库可以轻松执行的操作，我建议让数据库进行计算并简单地返回结果。

# asp.net - 是否可以限制 Infragistics 网格的高度？

> ID：400891
> 
> 赞同：1
> 
> 时间：2008-12-30T17:17:55.943
> 
> 标签：asp.net, infragistics

我已经尝试过 Infragistics，但他们似乎不明白我在问什么，而且需要几天的时间才能得到答案，所以请帮忙！

我需要将 Infragistics 网络网格放入 div 或表格单元格中。网格的大小必须适合 div 或单元格。如果要显示的数据太多，我需要网格来发挥它的魔力并添加它自己的滚动条。

到目前为止，我已经使用 javascript 实现了这一点，并在每次浏览器窗口调整大小时调整大小。不幸的是，当刷新页面（使用 AJAX）时，网格会在更正之前将自身调整为默认大小一秒钟，但这对于客户（或者我而言）是不可接受的。

令人恼火的是，width=100% 有效，但 height=100% 无效。我发现它只是从 div 或 table 延伸出来（甚至没有调整 div 的大小，只是从它扩展出来）。

我已经尝试了将高度和宽度设置为 100% 并将框架自定义规则设置为 table-layout:auto 的 KB 文章，但这不起作用。

## 更新

我创建了一个测试项目，其中有一个 500 像素高的表格、两行（每行 50% 高度）和每行两个单元格，以提供 2 x 2 网格。如果我将单元格内的 Infragistics 网格高度设置为 100%，它会非常适合，直到您将其绑定到数据。然后它会扩展，使表格的高度超过 500 像素。

我尝试在其中一个单元格和网格中放置一个 100% x 100% div。然后表格保持正确的大小，但网格的高度增加了一行的大小，并延伸到了 div 和单元格之外:-(

我开始怀疑 Infragistics Web 控件是否达到应有的水平。它们当然似乎不如 Windows 版本好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T17:34:17.113

您是否尝试过仅指定 width=100% 并完全离开网格的高度规范？

另一个想法是将网格放在 asp.net 面板上，并将面板放在 div 或表格单元格中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T17:35:18.827

我对 ComponentArt 的网格有一个类似的问题，如果我理解你，那么也许这会有所帮助。

我必须做的是通过将它放在我自己的 Div 中来限制网格的高度，该 Div 具有溢出-y 可滚动性。所以我有这个：

根本不要在网格上指定高度。

# 编辑

我认为你需要在你的 div 上设置一个特定的高度。

```
<table style="height:500px">
   <tr>
      <td>Cell 1</td>
      <td>Cell 2</td>
   </tr>
   <tr>
      <td>
         <div style="height:400px;overflow-y:scrollable"> <ingragists...>
         </div>
       </td>
       <td>Cell 3</td>
    </tr>
</table> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T00:26:07.017

您是否在没有任何用户控件、母版页和继承的空项目中尝试过它？如果没有可能的属性可以做到这一点，我认为您可以通过条件代码来完成这项工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T14:41:44.160

我最终通过从 ASP.NET 页面中删除 doctype 解决了这个问题。似乎网格的布局方式不适用于标准模式下的 IE。它看起来主要是一个IE问题。

Infragistics 表示他们正在开发一个没有这些问题的新网格，但不幸的是它还没有标准网格的灵活性。

# iphone - Xcode：iPhone 应用程序代码设计错误

> ID：400894
> 
> 赞同：37
> 
> 时间：2008-12-30T17:19:13.803
> 
> 标签：iphone, ios, xcode, code-signing, xcrun

在 Xcode 中构建新的 iPhone 应用程序时，我收到此错误：

> 代码签名错误：代码签名身份“iphone 开发者”与钥匙串中的任何代码签名证书都不匹配。添加到钥匙串后，触摸文件或清理项目以继续。

解决方法是什么？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-12-30T17:19:56.580

修复非常简单。在 Build Results 窗口中（您可能通过单击项目窗口右下角的错误图标进入），将下拉菜单从“Device - iPhone xxx”更改为“Simulator - iPhone xxx”。

[![xcode 截图](https://i.stack.imgur.com/vCO4m.jpg)](https://i.stack.imgur.com/vCO4m.jpg)
[（来源：[kickasslabs.com](http://www.kickasslabs.com/wp-content/uploads/2008/12/picture-1.jpg)）]

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-01T12:23:23.603

您需要加入 99 美元的开发者计划才能在实际手机上进行测试。一旦你被接受加入程序，Apple 应该有关于如何签署你的代码的信息。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-30T23:27:37.977

当我不小心修改了目标而不是项目级别的代码签名身份构建设置时，我收到了这个错误。确保您在项目级别输入了正确的信息（获取有关项目的信息，而不是目标。）如果您更改了目标构建设置，请尝试从那里删除这些值。然后目标将继承项目的设置。

我也会做一个“全部清理”，然后退出 xcode，从构建文件夹中删除所有内容并尝试进行另一个构建。（这是一个 Xcode 巫术技巧，似乎可以解决许多代码签名问题。）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-10-14T11:02:04.450

我刚刚解决了我的代码签名问题。什么样的恶梦！两天超过8小时的挫败感。我尝试了新应用程序、新应用程序名称、新证书、删除配置文件等。基本上我的钥匙串中有两个“iPhone Distribution”证书，导致所有代码签名失败。但是一个被隐藏了！可见证书在我的登录钥匙串中。隐形证书在我的系统钥匙串中。请注意，将您的证书添加到任一钥匙串，但不能同时添加！我从系统钥匙串中删除了证书，它变成了一个幽灵证书。它不再出现在系统钥匙串“钥匙串访问”工具中，但它确实存在于实际的系统钥匙串文件中，因此实际上它没有被删除。我在钥匙串文件中找到了 Distribution 这个词，它就在那里！我的解决方案是从修复代码签名的钥匙串文件中删除包含 iPhone Distribution 的那一行。结果是我的系统钥匙串坏了。但我可以再次签署应用程序 \m/

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-11-10T04:40:17.977

这听起来可能很有趣，但我到处寻找解决方案。最终我发现在左上角的 Xcode 中，您选择设备和版本的下拉列表中，我在下拉列表中选择了“调试”而不是发布。一旦我选择了发布，问题就解决了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-22T13:34:26.123

我有同样的问题。在这里找到修复：

[iphone sdk 工具实用程序](http://www.iphonedevsdk.com/forum/iphone-sdk-tools-utilities/14909-help-certificate-s-t.html)

在 Keychain Access.app 中，我的开发人员证书将显示为“此证书由未知机构签名”。原因是我没有 ADC 中间证书（您可以从“证书”选项卡中的“配置程序”下载。一旦我安装了这个，开发人员证书就会正确显示在钥匙串中，我的代码可以部署在血腥的电话。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-10-14T06:28:05.947

当您从其他人那里收到 Xcode 项目时，就会发生这种情况。

这是我为解决问题所做的。

1.  在钥匙链访问中注册您的钥匙。您可以在 iOS 配置门户中下载您的密钥。（应用程序 -> 实用程序 -> 钥匙串访问）
2.  安装应用程序的配置文件。
3.  在项目配置中更改 iPhone 开发人员。（目标信息->构建点击->代码签名->代码签名身份和任何iOS）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-22T20:36:48.377

不需要巫毒教。有时，某些应用程序更改了默认钥匙串，Xcode 停止查找 iPhone 开发人员密钥。解决方案很简单（它对我有用）：

1.  列表项启动钥匙串访问应用程序
2.  Ctrl+单击存储开发密钥的钥匙串，然后选择将钥匙串设为默认值
3.  享受开发出色的 iPhone 应用程序的乐趣。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-08-21T10:24:43.717

当以上都没有帮助我时，我不小心删除了带有电子签名证书的读卡器，现在我的应用程序构建没有错误。如果您有这样的证书，请尝试拔下它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-17T10:38:14.033

我刚刚解决了我的问题：

*   在 Project Navigator 中单击您的主项目文件夹
*   在右侧窗口中，选择您的目标
*   在“代码签名”下，将代码签名身份从任何内容更改为您的身份
*   将活动方案（在左上角，除了“运行”按钮）设置为您的 iPhone/iPad

希望这可以帮助那里的人！

# java - Java 编译器如何解析类型转换？

> ID：400895
> 
> 赞同：11
> 
> 时间：2008-12-30T17:19:38.623
> 
> 标签：java, parsing, compiler-construction, casting

一个简单的表达式，如

```
(x) - y 
```

根据是否`x`是类型名称，解释不同。如果`x`不是类型名称，`(x) - y`只需`y`从`x`. 但是 if`x`是一个类型名称，`(x) - y`计算负数`y`并将结果值转换为 type `x`。

在典型的 C 或 C++ 编译器中，是否`x`是类型的问题是可以回答的，因为解析器在处理 typedef 或 struct 声明后立即将此类信息传达给词法分析器。（我认为这种要求违反级别是 C 设计中最讨厌的部分。）

但是在 Java 中，`x`可能要到源代码的后面才能定义。Java 编译器如何消除这种表达式的歧义？

很明显，Java 编译器需要多次传递，因为 Java 不需要在使用前声明。但这似乎意味着第一遍必须在解析表达式上做一个非常草率的工作，然后在后面的一遍中做另一个更准确的表达式解析。这似乎很浪费。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T18:22:34.190

我想我已经找到了令我满意的解决方案。感谢 mmyers，我意识到我需要检查类型转换语法的正式规范。

歧义是由`+`一`-`元和二元运算符引起的。Java通过这个语法解决了这个问题：

```
CastExpression:
        ( PrimitiveType Dimsopt ) UnaryExpression
        ( ReferenceType ) UnaryExpressionNotPlusMinus 
```

（见[http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#238146](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#238146)）

因此，`'+'`并且`'-'`在强制转换之后立即被明确禁止，`')'`除非强制转换使用原始类型——编译器先验地知道这些类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T17:32:41.763

我刚刚测试了它，这段代码：

```
Double y = new Double(0.1);
System.out.println((Double)-y); 
```

给出编译错误：

> `operator - cannot be applied to Double, java.lang.Double`.

在 -y 周围加上括号使它编译得很好。所以显然Java通过简单地不允许在语法中解决这个问题（如果这是正确的术语；我不是编译器专家）。

# c# - 如何在运行时创建任意 Array 类型的实例？

> ID：400900
> 
> 赞同：35
> 
> 时间：2008-12-30T17:20:34.613
> 
> 标签：c#, reflection, compact-framework, .net-2.0

我试图在编译时反序列化类型未知的数组。在运行时我发现了类型，但我不知道如何创建一个实例。

就像是：

```
Object o = Activator.CreateInstance(type); 
```

这不起作用，因为没有无参数构造函数， Array 似乎没有任何构造函数。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-12-30T17:22:41.783

使用[Array.CreateInstance](http://msdn.microsoft.com/en-us/library/system.array.createinstance.aspx)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-30T17:24:13.077

您可以使用 Array 的 CreateInstance 重载之一，例如：-

```
object o = Array.CreateInstance(type, 10); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-12-28T04:27:21.317

相当老的帖子，但在回答一个新问题时，虽然发布了一个创建多维数组的相关示例。

假设类型 ( `elementType`) as`int`和一个二维数组。

```
var size = new[] { 2, 3 };                
var arr = Array.CreateInstance(typeof(int), size); 
```

例如，当它是二维时，它可以填充为

```
var value = 1;
for (int i = 0; i < size[0]; i++)
    for (int j = 0; j < size[1]; j++)
        arr.SetValue(value++, new[] { i, j });
//arr = [ [ 1, 2, 3 ], [ 4, 5, 6 ] ] 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-07-03T19:47:42.130

另一种方法是使用表达式树来提高性能。例如，如果你有数组*类型*，`type`你可以这样做

```
var ctor = type.GetConstructors().First(); // or find suitable constructor
var argsExpr = ctor.GetParameters().Select(x => Expression.Constant(0)); 
var func = Expression.Lambda<Func<object>>(Expression.New(ctor, argsExpr)).Compile(); 
```

这只是返回一个空数组。可能不是很有用。MSDN 状态`GetConstructors`不保证任何顺序，因此您可能需要一个逻辑来找到具有正确参数的正确构造函数，以便以正确的大小进行实例化。例如，您可以这样做：

```
static Func<object> ArrayCreateInstance(Type type, params int[] bounds) // can be generic too
{
    var ctor = type
        .GetConstructors()
        .OrderBy(x => x.GetParameters().Length) // find constructor with least parameters
        .First();

    var argsExpr = bounds.Select(x => Expression.Constant(x)); // set size
    return Expression.Lambda<Func<object>>(Expression.New(ctor, argsExpr)).Compile();
} 
```

如果你得到的只是数组元素类型，而不是数组类型本身，那么使用`Expression.NewArrayBounds`代替可以更容易地实现相同的效果。`Expression.New`演示：

```
static Func<object> ArrayCreateInstance(Type type, params int[] bounds) // can be generic too
{
    var argsExpr = bounds.Select(x => Expression.Constant(x)); // set size
    var newExpr = Expression.NewArrayBounds(type.GetElementType(), argsExpr);
    return Expression.Lambda<Func<object>>(newExpr).Compile();
}

// this exercise is pointless if you dont save the compiled delegate, but for demo purpose:

x = string[] {...
y = ArrayCreateInstance(x.GetType(), 10)(); // you get 1-d array with size 10

x = string[,,] {...
y = ArrayCreateInstance(x.GetType(), 10, 2, 3)(); // you get 3-d array like string[10, 2, 3]

x = string[][] {...
y = ArrayCreateInstance(x.GetType(), 10)(); // you get jagged array like string[10][] 
```

如果您传递的是元素类型本身，只需更改`type.GetElementType()`为简单。`type`

# c++ - Borland C++ Builder 5 - 通过 Escape 键取消不起作用

> ID：400903
> 
> 赞同：2
> 
> 时间：2008-12-30T17:21:09.667
> 
> 标签：c++, event-handling, c++builder

我在 Borland C++ Builder 5 中的一个对话框上的 Escape 键处理程序有一个相当令人困惑的问题。Escape 键是否有任何其他要求来触发取消事件（除了我在下面列出的那些）？

1.  “取消”按钮（一个 TBitBtn）的 Cancel 属性设置为 true。
2.  “取消”按钮的默认属性设置为 false。
3.  “取消”按钮的 modalResult 设置为 mrCancel。

注意：我正在使用仍在 Borland C++ Builder 5 中编译的旧遗留应用程序。我们有一个单独的项目来替换它 - 我只是在进行生命周期结束维护。

**更新**

四个月后，我终于不再摸不着头脑了……事实证明，应用程序的父窗体定义了一个运行时 OnShortCut 处理程序。我只需要禁用 Esc 处理程序就可以在子对话框上工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T21:07:18.587

您应该检查可能阻止取消事件的所有可能方式：

1.  首先，检查单击取消按钮是否真的关闭了表单。

2.  然后检查是否有任何其他按钮的 Cancel 属性设置为 true。

3.  之后检查所有关键事件处理程序，不要忘记表单的事件处理程序，特别是如果您启用了 KeyPreview。

4.  如果您仍然没有发现问题，请检查另一个组件是否将其 ShortCut 属性设置为处理转义键。

5.  还要检查是否有任何键盘挂钩处于活动状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T23:49:20.040

可能是 Form 的 KeyPreview 属性已设置为 true。这是 Escape 键经常/可能被禁用的地方。KeyPreview 属性也经常被启用以捕捉 [Return] 按键按下（即 OnKeyPress）以前进到下一个字段而不是关闭表单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T09:53:03.297

您还可以创建另一个对话框，在其中添加取消按钮，然后查看 Escape 键是否有效。然后比较两种形式的DFM源，检查设置的差异。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T14:12:01.460

是否存在带有逻辑阻止其关闭的“CanClose”类型事件？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T20:47:17.233

还要记住，对话框需要通过 ShowModal() 而不仅仅是 Show() 调用。例如，如果您的表单名为“FAskDialog”，那么显示它的代码应该是

FAskDialog->ShowModal();

而不是

FAskDialog->显示（）；

如果对话框是通过 Show() 调用的，那么点击取消键或设置 ModalResult = mrCancel 将不会导致对话框关闭。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-16T11:38:40.940

这是一个老问题，我可以给出答案：

您需要设置 KeyPreview = True 然后编写代码来捕获 ESC 键：

Form1::OnKeyUp(...)
{
if (Key == 27) {
Close();
}
}

# xslt - 检查 XSLT 中较高优先级变量内的变量值

> ID：400909
> 
> 赞同：4
> 
> 时间：2008-12-30T17:22:55.967
> 
> 标签：xslt

我需要能够检查一个变量的“当前”值在包含另一个的不同 xslt 中的同一变量的重新声明中是什么。

main.xslt：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:import href="other.xslt"/>
    <xsl:variable name="email">
        <xsl:if test="string-length($email) = 0">
            bar@foo.com
        </xsl:if>
    </xsl:variable>
    <xsl:template match="/">
        <Email>
            <xsl:value-of select="$email"/>
        </Email>
    </xsl:template>
</xsl:stylesheet> 
```

其他.xslt：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:variable name="email">foo@bar.com</xsl:variable>
</xsl:stylesheet> 
```

我想做的是能够检查低优先级变量的值，看看我是否需要在当前 xslt 的变量中覆盖它。（免责声明 - 当前代码恶意崩溃）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-31T05:52:09.307

**正如其他人所指出的，向导入样式表中定义的全局变量添加默认值不能使用相同的变量名来完成**。这是因为在当前 xslt 样式表中定义的具有该名称的变量的优先级高于导入样式表中的变量，并且只会使用前者（您不能在较低优先级的样式表中访问同名变量）。

**这是添加默认值的方法**：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<!--                                            -->
  <xsl:import href="other.xsl"/> 
<!--                                            -->
    <xsl:variable name="vMyEmail" select=
     "concat(substring('bar@foo.com', 1 div not($vEmail)), $vEmail)"
     />
<!--                                            -->
    <xsl:template match="/">
      <xsl:value-of select="$vMyEmail"/>
    </xsl:template>
</xsl:stylesheet> 
```

**请注意**，全局变量的定义方式是，如果这是长度至少为 1 的字符串或所需的默认值**`$vMyEmail`**，则它具有变量的值（在导入的样式表中定义），否则。**`$vEmail`**

**使用这种技术，人们将在`$vMyEmail`其定义之后的任何地方使用如此定义的内容。导入样式表中的`$vEmail`变量根本不会被直接使用**。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T17:28:50.040

你不能直接做你想做的事，你必须设置第二个变量。

但我无法理解其意图：如果这是基于模板的，您可以为任何参数提供默认值（其行为与变量非常相似）。您提出问题的方式表明这对我来说是正确的方法，但是您能否阐明这些模板之间的关系和使用方式？

# lucene - 优化搜索查询

> ID：400911
> 
> 赞同：0
> 
> 时间：2008-12-30T17:23:39.333
> 
> 标签：lucene

我正在开发一个使用 Lucene.net（版本 2.0.0.4）进行商店搜索的 Web 应用程序。虽然我的 Web 应用程序用户可以搜索位于美国的商店，这些商店距离给定位置 50 英里以内。我正在使用第三方 API 来查找半径内的所有城市。对于一个城市，比如新泽西州的爱迪生，它在 40 英里范围内为我提供了大约 450 个城市（API 返回一个包含 450 个城市的 .Net 哈希表）。通过迭代这个哈希表，我正在使用 BooleanQuery/Query 类来构建 lucene 查询。

在这种情况下，我发现通过 lucene 构建、执行和返回搜索结果需要花费大量时间。有什么办法可以优化这段代码吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T21:40:29.777

在构建索引时，将城市映射到纬度和经度坐标。在 Web 应用程序中，当您进行半径搜索时，将搜索到的城市映射到坐标并进行范围查询（您需要将距离转换为坐标所在的单位）。

这是不完美的，因为您将搜索正方形而不是圆形，但如果您需要精确，您可以编写一些代码来过滤原始半径之外的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T11:21:06.040

我认为执行此操作的关键是考虑如何存储数据并围绕它拥有一些元数据。

我的意思是什么？

例如，有一个在 NJ 有商店的城市列表，并根据您的主列表过滤掉从您的第三方 api 返回的城市。您可能会发现返回的 450 个匹配项中只有 5 个匹配项。同样，我不会在一个查询中组合 450 个查询 - 尝试将它们分成更小的数量。

此外，如果您可以基于州创建索引，您可能会发现较小的索引（特别是针对 NJ）可以比在较大的索引中选择特定州的数据更有效地处理您的查询。

希望这会有所帮助，Ciaran

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T08:15:14.410

[KenE 的回答](https://stackoverflow.com/questions/400911/optimizing-search-query#485407)很好，您应该在谷歌上[搜索“lucene 空间搜索”](http://www.google.com/search?hl=en&q=lucene+spatial+search)以获取有关该方法的更多信息。

假设半径始终为 40 英里，您还可以采用另一种方法：只需将过程颠倒过来即可。

有一个名为`nearyby_city`. **对于索引中的每家商店，添加其**40 英里半径内的城市列表。现在，当您搜索新泽西州爱迪生附近的商店时，只需`nearby_city:"Edison, NJ"`在查询中添加一个词即可。现在，只有该城市 40 英里范围内的商店才会匹配您的查询。

# jquery - 如何检查是否加载了 jQuery 插件？

> ID：400916
> 
> 赞同：232
> 
> 时间：2008-12-30T17:26:13.073
> 
> 标签：jquery, jquery-plugins

有什么方法可以检查特定插件是否可用？

想象一下，您正在开发一个插件，该插件依赖于正在加载的另一个插件。

例如，我希望 jQuery Validation 插件使用 dateJS 库来检查给定日期是否有效。如果 dateJS 可用，在 jQuery Valdation 插件中检测的最佳方法是什么？

* * *

## 回答 #1

> 赞同：379
> 
> 时间：2008-12-30T17:36:10.603

一般来说，jQuery 插件是 jQuery 范围内的命名空间。您可以运行一个简单的检查来查看命名空间是否存在：

```
 if(jQuery().pluginName) {
     //run plugin dependent code
 } 
```

但是 dateJs 不是 jQuery 插件。它修改/扩展 javascript 日期对象，并且不作为 jQuery 命名空间添加。您可以检查您需要的方法是否存在，例如：

```
 if(Date.today) {
      //Use the dateJS today() method
 } 
```

但是您可能会遇到 API 与本机 Date API 重叠的问题。

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2011-03-28T21:54:44.243

如果我们谈论的是一个合适的 jQuery 插件（一个扩展 fn 命名空间的插件），那么检测插件的正确方法是：

```
if(typeof $.fn.pluginname !== 'undefined') { ... } 
```

或者因为几乎可以保证每个插件都有一些等于 true 的值，所以您可以使用较短的

```
if ($.fn.pluginname) { ... } 
```

顺便说一句，$ 和 jQuery 是可以互换的，就像插件周围看起来很奇怪的包装器所展示的那样：

```
(function($) {
    //
})(jQuery)) 
```

关闭

```
(function($) {
    //
}) 
```

紧随其后的是对该闭包“传递”jQuery 作为参数的调用

```
(jQuery) 
```

闭包中的 $ 设置为等于 jQuery

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-03-23T10:47:08.047

为了检测 jQuery 插件，我发现使用括号更准确：

```
if(jQuery().pluginName) {
    //run plugin dependent code
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-05-04T18:49:10.450

对于不使用 fn 命名空间的插件（例如 pnotify），这是有效的：

```
if($.pluginname) {
    alert("plugin loaded");
} else {
    alert("plugin not loaded");
} 
```

这不起作用：

```
if($.fn.pluginname) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-04-20T12:30:41.170

jQuery 有一个方法来检查某个东西是否是一个函数

```
if ($.isFunction($.fn.dateJS)) {
    //your code using the plugin
} 
```

API参考：[https ://api.jquery.com/jQuery.isFunction/](https://api.jquery.com/jQuery.isFunction/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T08:34:48.730

我强烈建议您将 DateJS 库与您的插件捆绑在一起，并记录您已经完成它的事实。没有什么比不得不寻找依赖项更令人沮丧的了。

也就是说，出于法律原因，您可能并不总是能够捆绑所有内容。小心谨慎并使用[Eran Galperin 的答案](https://stackoverflow.com/a/400943/1862009)检查插件的存在也永远不会受到伤害。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-13T18:42:33.007

在您选择的浏览器控制台中运行它。

`if(jQuery().pluginName){console.log('bonjour');}`

如果插件存在，它将在您的控制台中打印出“bonjour”作为响应。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-30T17:35:49.667

这种方法应该有效。

```
var plugin_exists = true;

try {
  // some code that requires that plugin here
} catch(err) {
  plugin_exists = false;
} 
```

# c# - 在 Web 服务中重用/缓存数据表

> ID：400926
> 
> 赞同：3
> 
> 时间：2008-12-30T17:28:54.457
> 
> 标签：c#, web-services, caching

我有一个 Web 应用程序，它可以提取数据表并显示结果。由于业务的性质，所有业务规则都包含在 Web 应用程序必须从中提取的 dll 中。因为有多个站点，我们不想在所有部署的许多应用程序中包含核心 dll，所以我们将对核心 dll 的任何调用合并到 Web 服务中。这有助于在更新核心 dll 时只需要推送一个新应用程序（即 Web 服务）。

使用这个架构，我发现任何登录到任何 Web 应用程序的人都会导致对数据库的多次调用，以获取然后解析的数据表。有问题的数据表变化缓慢，我只需要每 4-6 小时刷新一次。

当用户想要查看同一数据表的不同视图时，我熟悉在会话中存储此类内容。然而，网络服务会话并不真正适用。什么是在 web 服务中缓存数据表的好方法，这样我们就不会重复昂贵的数据库访问。

Web 服务和应用程序都在 C# 和 ASP.NET 2.0 中，我们使用的是 VS2005。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T23:21:48.617

作为一种非常便宜的方式（但它存在），您可以使用 WebMethod arribute 的 CacheDuration 属性，它将缓存 Web 方法调用的结果。更多信息：
[CacheDuration 属性](http://msdn.microsoft.com/en-us/library/byxd99hx(VS.71).aspx#vbtskusingwebmethodattributecacheduration)

这可能会有所帮助，只是一个想法......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T17:36:17.280

[您可以使用memcached](http://www.danga.com/memcached/)将任何数据存储在内存中，只要您愿意。它在 Linux 和 Windows 上运行，并且它们也有几个使用 C# 的[api实现。](http://www.danga.com/memcached/apis.bml)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T17:49:45.443

**便宜的选项 #1**：将数据表创建为 Web 服务类的本地静态变量。在类的静态构造函数中填充数据表对象。当第一次查询服务以及任何应用程序工作进程回收时，数据表对象将可用于您的 Web 方法。

```
//pseudo-code

class MyWebMethods {

  private static DataTable localDataTable;
  static MyWebMethods() {
    localDataTable = new DataTable();
    //Do whatever else is needed here to populate the table
  }

  [WebMethod]
  public string GetSomeData(int id) {
    //Query localDataTable using parameter info
    //return result
  }
} 
```

**便宜的选项 #2**：类似的方法，考虑 ASP.Net 缓存 (System.Web.Caching.Cache)。加载过程与上面相同，但存储不同。

# applet - 小程序用户代理

> ID：400929
> 
> 赞同：0
> 
> 时间：2008-12-30T17:30:29.663
> 
> 标签：applet, user-agent

这是一个简单的问题，但我没有找到任何有关此的文档。当小程序发出请求时，请求的用户代理如何。我想知道小程序用户代理表达式来检测请求是否来自小程序。

我做了两个测试，IE7 和 Firefox 3.0.5 和 JDK 1.6.0_03，用户代理都是“Mozilla/4.0 (Windows 2003 5.2) Java/1.6.0_03”，但我不能从两个测试中概括。

提前感谢，乔纳森。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-31T14:09:40.300

迟到总比没有好。

浏览器 IE、Safari、Firefox 和 Chrome 允许 Java 小程序的请求带有用户代理标题 "Mozilla/4.0 ( `operative system info`) Java/1.6.0_03" 。Opera 放置自己的标题而不是小程序标题。

希望这可以帮助某人。

# perl - 如何完全镜像网页？

> ID：400935
> 
> 赞同：2
> 
> 时间：2008-12-30T17:33:06.100
> 
> 标签：perl, wget, mirror

我在几个不同的网站上有几个网页，我想完全镜像。这意味着我需要图像、CSS 等，并且需要转换链接。此功能类似于使用 Firefox 来“将页面另存为”并选择“网页，完成”。我想将文件和相应的目录命名为合理的名称（例如 myfavpage1.html、myfavpage1.dir）。

我无权访问服务器，它们不是我的页面。这是一个示例链接：[点击我！](http://ww13.itau.com.br/PortalRI/Iframe.aspx?strURL=/PortalRI/PrincipaisIndicadores/principaisindicadores.aspx?idioma=port)

再澄清一点...我有大约 100 个页面要镜像（许多来自慢速服务器），我将在 Solaris 10 上执行任务，并每小时将结果转储到 samba 挂载以供人们查看。而且，是的，我显然已经用几个不同的标志尝试了 wget，但我没有得到我正在寻找的结果。因此，指向 GNU wget 页面并没有真正的帮助。让我从一个简单的例子开始。

```
wget --mirror -w 2 -p --html-extension --tries=3 -k -P stackperl.html "https://stackoverflow.com/tags/perl"

```

由此，如果我的标志正确，我应该会在 stackper.html 文件中看到[https://stackoverflow.com/tags/perl页面。](https://stackoverflow.com/tags/perl)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T18:17:00.600

如果您只是想运行命令并获取网站的副本，请使用其他人建议的工具，例如[wget](http://www.gnu.org/software/wget/)、[curl](http://curl.haxx.se/)或一些 GUI 工具。我使用我自己的个人工具，我称之为[webreaper](http://search.cpan.org/~bdfoy/webreaper-0.31/)（虽然那不是 Windows [WebReaper](http://www.webreaper.net/)。我知道一些 Perl 程序，包括[webmirror](http://search.cpan.org/~fleitner/WebMirror-1.0/webmirror)和其他一些你可以在[CPAN](http://search.cpan.org)上找到的程序。

如果您希望在您正在编写的 Perl 程序中执行此操作（因为您的答案中有“perl”标签），[CPAN](http://search.cpan.org)中有许多工具可以在每个步骤中为您提供帮助：

*   下载内容：[LWP::Simple](http://search.cpan.org/dist/libwww-perl) , [LWP::UserAgent](http://search.cpan.org/dist/libwww-perl) , [WWW::Mechanize](http://search.cpan.org/dist/WWW-Mechanize)
*   链接提取：[HTML::LinkExtor](http://search.cpan.org/dist/HTML-LinkExtor) , [HTML::SimpleLinkExtor](http://search.cpan.org/dist/HTML-SimpleLinkExtor)
*   链接重写：[HTML::Parser](http://search.cpan.org/dist/HTML-Parser)

祝你好运， ：）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T17:46:13.797

对于您的站点的 HTML 化版本，您可以使用 WinHTTrack - 一个免费的开源 GPL 程序。它将拉下您的页面、图形、文档、zip 文件、电影等的预渲染版本......当然，由于这是一个镜像副本，因此任何动态后端代码（例如数据库调用）将不再是动态的。

[http://www.httrack.com/](http://www.httrack.com/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T17:55:56.523

就我个人而言，上次我有这样做的冲动时，我编写了一个 python 脚本，它复制了我的浏览器缓存，然后手动访问了我希望镜像的所有页面。一个非常丑陋的解决方案，但它具有不触发任何“不要刮我的页面”警报的好处。多亏了[Opera](http://www.opera.com)的链接标签栏，“手动”下载数以万计的页面并不像您想象的那么难。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T17:52:37.247

我使用[WebReaper](http://www.webreaper.net/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T17:53:05.640

我会回应“不清楚”的评论。这些网页/站点是您创建的，并且您希望将它们部署在多台服务器上吗？如果是这样，请在您的 HTML 中使用相对引用，您应该没问题。或者，在您的网站中使用 a 并在每个站点上进行调整。但是，相对论确实是要走的路。

或者，您是说您想下载网站（如 Stack Overflow 主页、perl.com 等）以在您的计算机上拥有本地副本？我同意丹尼尔的观点——使用 wget。

吉姆

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-07-17T00:30:07.020

您可以使用 wget gnu 工具来抓取整个站点，如下所示：

```
wget -r -p -np -k URL 
```

或者，如果您使用 perl，请尝试以下模块：

*   LWP::简单

*   万维网::机械化

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T17:37:28.323

在大多数现代网站中，前端只讲述了故事的一小部分。不管剥离 html、css 和 javascript 的工具是什么，您仍然会缺少服务器中包含的核心功能。

或者，也许你的意思是别的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T18:17:26.167

如果 wget 很复杂，或者你没有 linuxbox，你总是可以使用 WebZip

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-02T11:47:47.533

听起来您想要一个好的代理服务器提供的缓存功能。

也许看看像SQUID这样的东西？很确定它可以做到。

这更像是一个系统管理员类型的问题，而不是编程问题。

# vba - 使用 VBA 在 Outlook 中将电子邮件消息写入平面文件

> ID：400941
> 
> 赞同：5
> 
> 时间：2008-12-30T17:35:53.567
> 
> 标签：vba, email, outlook, flat-file

我编写了一个 VBA 应用程序，它在 Outlook 中打开一个文件夹，然后遍历消息。我需要将消息正文（经过一些调整）写入单个平面文件。我的代码如下...

```
Private Sub btnGo_Click()
    Dim objOutlook As New Outlook.Application
    Dim objNameSpace As Outlook.NameSpace
    Dim objInbox As MAPIFolder
    Dim objMail As mailItem
    Dim count As Integer

    Set objNameSpace = objOutlook.GetNamespace("MAPI")
    Set objInbox = objNameSpace.GetDefaultFolder(olFolderInbox)
    count = 0

    For Each objMail In objInbox.Items
       lblStatus.Caption = "Count: " + CStr(count)
       ProcessMailItem (objMail)
       count = count + 1
    Next objMail

  End If
End Sub 
```

有问题的部分是“ProcessMailItem”。因为我在这个阶段并不太关心性能，所以非常低效的“打开、附加、关闭”文件方法对于这个例子来说很好。

我知道我可以花一些时间用谷歌查找答案，但我先在这里查了一下，没有很好的答案。作为 Stackoverflow 的粉丝，我希望把它放在这里可以帮助未来的开发人员寻找答案。谢谢你的耐心。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T20:16:18.050

您可以在不使用任何对象的情况下写入文件，只需使用内置的 VBA 文件工具：

```
Open "C:\file.txt" for append as 1
Print #1, SomeStringVar
Close #1 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T18:07:20.027

如果您不介意每次附加一些文本时都重新打开输出文件，那么这应该可以工作。

```
Private Sub ProcessMailItem(objMail As MailItem)

    Dim fso As New FileSystemObject
    Dim ts As TextStream

    Set ts = fso.OpenTextFile("C:\Outputfile.txt", ForAppending, True)

    ts.Write(objMail.Body)

    ts.Close()
    Set ts = Nothing
    Set fso = Nothing

End Sub 
```

您还需要添加对 Microsoft Scripting Runtime 库的引用。这里面有 FileSystemObject。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-27T16:37:56.140

您还必须注意“尝试访问电子邮件地址”的安全弹出窗口，该弹出窗口包含在[面向开发人员的 Outlook“对象模型保护”安全问题中](http://www.outlookcode.com/article.aspx?ID=52)

```
Public Sub ProcessMailItem(objMail As MailItem)
Dim FSO As New FileSystemObject
Dim ts As TextStream
Dim loc As String
Dim subject As String
Dim strID As String
' per http://www.outlookcode.com/article.aspx?ID=52
Dim olNS As Outlook.NameSpace
Dim oMail As Outlook.MailItem

strID = MyMail.EntryID
Set olNS = Application.GetNamespace("MAPI")
Set oMail = olNS.GetItemFromID(strID)
subject = oMail.subject
Set ts = FSO.OpenTextFile("C:\Documents and Settings\tempuser\My Documents\EMAILS\" + subject, ForAppending, True)
ts.Write (oMail.Body)
ts.Close
Set ts = Nothing
Set FSO = Nothing
Set oMail = Nothing
Set olNS = Nothing 
```

结束子

# c# - c#解决方案中的命名空间和文件夹结构：磁盘上的文件夹应该如何组织？

> ID：400945
> 
> 赞同：15
> 
> 时间：2008-12-30T17:36:51.240
> 
> 标签：c#, namespaces, solution

首先，让我们同意命名空间应该与文件夹结构相匹配，并且每个语言工件都应该在自己的文件中。

（请参阅[解决方案中的文件夹是否应与命名空间匹配？](https://stackoverflow.com/questions/4664/should-the-folders-in-a-solution-match-the-namespace)）。

下一个问题是如何在磁盘上实际组织文件夹。
假设我在 ABC 命名空间中有 ClassC，在 ABCD 命名空间中有 ClassD。
我们还假设每个命名空间都内置在自己的程序集（项目）中，并且命名空间根据公认的最佳实践从右到左具有依赖关系（ABCD 可以依赖于 ABC，而 ABC 可以依赖于 AB，而 AB 又可以依赖于 A）。我很欣赏每个命名空间不必位于单独的程序集中，但在一般情况下，我们将在单独的程序集中有一些命名空间，我的示例说明了这一点。

我可以看到（至少）两种创建文件夹树的方法——我称之为“嵌套文件夹”和“平面文件夹”：

## 1 - 嵌套文件夹：

A
--A.csproj --B ----ABcsproj
---- C ------ABCcsproj ------classC.cs ------D -------- ABCDcsproj --------classD.cs

或者

## 2 – 平面文件夹：

A
--A.csproj
AB
--ABcsproj
ABC
--ABCcsproj
--classC.cs
ABCD
--ABCDcsproj
--classD.cs

你会看到我已经做了一些假设：

*   每个项目文件都有一个基于命名空间的完全限定名称 (FQN)。
*   每个类文件使用一个非 FQN

嵌套文件夹看起来更自然（我们都喜欢层次结构），但在大型解决方案中可能更难导航：

当您在 VS 中查看解决方案时，它会显示项目的平面列表，而不是嵌套视图。这看起来更像是“平面文件夹”，因此组织磁盘上的文件夹以匹配 VS 中的视图可能会有好处。

如果您查看磁盘上的每个文件夹，您将看到该项目的文件夹 artefacts 以及命名空间的子文件夹：以 C 为例：

C
--bin --D --obj
--Properties --ABCcsproj --classC.cs

根据 D 的真实名称，D 是名称空间文件夹而不是 C 名称空间中的组织文件夹可能并不明显。

我知道我们从 .NET（8 或 9 年前）和 Java 的第一天起就有文件夹和命名空间，但是，就个人而言，我们似乎还没有就大型项目的最佳实践组织达成共识解决方案。我真的很想知道你们的想法。

谢谢
迈克尔

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-31T10:01:16.730

我使用平面方法。我发现嵌套层次结构太难维护了。我将我的项目分成几个解决方案，考虑到最大的可重用性和交叉引用，并且总是觉得这很令人满意。示例（项目缩进）：

```
CompanyName
  CompanyName.Core
    Class1
    Struct2
    Enum3
  CompanyName.Data
  CompanyName.Web

CompanyName.Projects
  CompanyName.Projects.Core

CompanyName.Projects.ProjectX
  CompanyName.Projects.ProjectX.Core
  CompanyName.Projects.ProjectX.Website
  CompanyName.Projects.ProjectX.ToolY 
```

等等等等

编辑：删除废话

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T18:13:36.660

我不是嵌套项目的忠实拥护者，因为它会将项目深埋在结构中，如果您需要在另一个应用程序中重用该项目，那么您会做什么，复制/粘贴代码？我喜欢遵循某种扁平结构，但按名称空间组织。

我就是这样做的：

```
- DataHelpers\
---Factory\
---DataAccess\
---...
- Components\
--- EmailProcessor\
--- ErrorLogger\
- Desktop\
--- WindowsApp1\
- Services\
--- WindowsService1\
--- WindowsService2\
- WebApps\
--- WebApp1\
--- WebApp2\ 
```

现在，在我拥有的每个主要应用程序中，例如：

```
- WindowsService1\
--- WindowsService1\ (this contains all *.cs, bin, obj, etc and .csproj file)
--- Solution\ (this contains the .sln file where you link to other projects like ErrorLogger, etc) 
```

我希望这是有道理的！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T17:46:43.360

“首先，让我们同意命名空间应该与文件夹结构匹配，并且每个语言工件 [原文如此] 应该在自己的文件中。”

有趣的是，这就是包在 Java 中的工作方式。我一直认为打破命名空间和目录结构之间的联系被认为是 C# 引入的改进之一。这不是真的吗？（原谅我的无知，我是一个Java人。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-30T17:57:01.670

我一直在做嵌套层次结构。它使向现有解决方案添加新项目的位置变得非常明显，并使您的命名空间在磁盘上保持良好的组织。这也使得命名空间与项目的划分更加明显。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-02T17:24:10.777

如果您使用嵌套项目，则可能会遇到 Windows [MaxPath](http://msdn.microsoft.com/en-us/library/aa365247%28v=vs.85%29.aspx#maxpath)问题。对于使用嵌套结构来说，这是一个巨大的交易破坏者。试想一下，在开发项目中途遇到这个小 Gem，必须用 3 个字母的首字母缩写词命名 VS 项目，以免碰到 MaxPath。一个 MS 错误最终成为程序集名称的灵感来源。那会是什么玩笑。全面使用扁平结构要好得多。

```
 -SouceControlFolderName
     -Project1
       -Src
         -Main
           -Company.Project1.AppName
             *Company.Project1.AppName.sln
             *Company.Project1.AppName.Tests.sln
             -Company.Project1.AppName.Common
             -Company.Project1.AppName.Common.Tests
             -Company.Project1.AppName.Entities
             -Company.Project1.AppName.Entities.Tests
             -Company.Project1.AppName.Security
             -Company.Project1.AppName.Security.Tests
             -etc. 
```

您可以为测试项目或如上所述创建一个单独的目录并将它们放在一起，这在添加到源代码控制时更易于管理，即 Subversion（TFS 在许多方面都更好，因为它需要 Explorer 集成而不仅仅是 VS 集成和一个适当的离线故事）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T10:05:07.707

我认为您需要定义一个平面方法不再起作用的截止点。例如，如果您在一个小型项目中有一个典型的 3 层架构，那么在外层有 3 个项目是没有问题的。但是，如果您有几十个，那么某种分组有助于细分功能并使整个解决方案更易于理解。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-04T22:45:18.647

我更喜欢根部有项目的扁平结构。

*   我的公司核心
*   我的应用程序域
*   我的应用程序数据
*   我的应用程序界面
*   我的应用程序测试

在这些里面我有各种文件夹和命名空间。我只为可部署单元创建不同的程序集。小型应用程序甚至没有这种分离量。IMO 这使事情变得简单。如果我决定需要在其他地方使用我的代码，只要我遵循良好的命名空间实践，如果需要，很容易将其分解为程序集。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-01-09T04:44:10.207

12 年过去了，这个问题有没有明确的或最佳实践的答案？

我想使用嵌套文件夹结构，但是鉴于您：

> “同意命名空间应与文件夹结构匹配，并且每种语言工件都应位于其自己的文件中。”

如果从其他命名空间扩展代码，项目**ABCcsproj**文件夹结构将如何显示，例如：

*   祖父母：**A.csproj**
*   父母：**ABcsproj**
*   孩子**ABCDcsproj**
*   外部命名空间**System.Linq**或**Microsoft.Extensions.Logging**

也许是这样的：

```
/A                                  // namespace: A
  /B                                // namespace: A.B
    /C                              // namespace: A.B.C
      A.B.C.csproj 
      ClassC.cs                  
      /_                            // External Namespace root folder (underscore with no text)
        /System                     // namespace: System 
          /Linq                     // namespace: System.Linq
            IQueryableExtensions.cs 
        /Microsoft                  // namespace: Microsoft
          /Extensions               // namespace: Microsoft.Extensions
            /Logging                // namespace: Microsoft.Extensions.Logging
              ILoggerExtensions.cs                                  
      /__A                          // namespace: A (Grand Parent folder (2 underscores for 2 levels up)
        ClassAExtensions.cs
        /B                          // namespace: A.B (Nested Parent folder)
          ClassBExtensionsNested.cs
                                    //Parent Namespace folder (1 underscore for 1 level up)
      /_B                           // namespace: A.B
        ClassBExtensions.cs
      /D                            // namespace: A.B.C.D (Child folder)
        ClassDExtensions.cs 
```

以上试图证明：

*   带有单独下划线 (_) 且后面没有文本的文件夹将替换为空命名空间和所有外部命名空间的新根。
*   在当前项目的树/层次结构中，带有下划线 (__A) 和 (_B) 后跟文本替换的文件夹作为上一级。每个下划线 1 级

# c - C 是否有“foreach”循环结构？

> ID：400951
> 
> 赞同：124
> 
> 时间：2008-12-30T17:39:13.810
> 
> 标签：c, foreach

几乎所有语言都有[`foreach`循环](https://en.wikipedia.org/wiki/Foreach_loop)或类似的东西。C有吗？你可以发布一些示例代码吗？

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2008-12-30T17:51:11.087

C 没有 foreach，但经常使用宏来模拟：

```
#define for_each_item(item, list) \
    for(T * item = list->head; item != NULL; item = item->next) 
```

并且可以像这样使用

```
for_each_item(i, processes) {
    i->wakeup();
} 
```

也可以对数组进行迭代：

```
#define foreach(item, array) \
    for(int keep = 1, \
            count = 0,\
            size = sizeof (array) / sizeof *(array); \
        keep && count != size; \
        keep = !keep, count++) \
      for(item = (array) + count; keep; keep = !keep) 
```

并且可以像这样使用

```
int values[] = { 1, 2, 3 };
foreach(int *v, values) {
    printf("value: %d\n", *v);
} 
```

编辑：如果您也对 C++ 解决方案感兴趣，C++ 有一个原生的 for-each 语法，称为“基于范围的 for”

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-30T18:13:51.667

这是 C99 中 for-each 宏的完整程序示例：

```
#include <stdio.h>

typedef struct list_node list_node;
struct list_node {
    list_node *next;
    void *data;
};

#define FOR_EACH(item, list) \
    for (list_node *(item) = (list); (item); (item) = (item)->next)

int
main(int argc, char *argv[])
{
    list_node list[] = {
        { .next = &list[1], .data = "test 1" },
        { .next = &list[2], .data = "test 2" },
        { .next = NULL,     .data = "test 3" }
    };

    FOR_EACH(item, list)
        puts((char *) item->data);

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2017-11-06T09:47:49.073

您可能已经知道，C 中没有“foreach”风格的循环。

虽然这里已经提供了很多很棒的宏来解决这个问题，但也许你会发现这个宏很有用：

```
// "length" is the length of the array.   
#define each(item, array, length) \
(typeof(*(array)) *p = (array), (item) = *p; p < &((array)[length]); p++, (item) = *p) 
```

...可以与`for`（如`for each (...)`）一起使用。

这种方法的优点：

*   `item`在 for 语句中声明并递增（就像在 Python 中一样！）。
*   似乎适用于任何一维数组
*   在宏 ( `p`, `item`) 中创建的所有变量在循环范围之外都是不可见的（因为它们是在 for 循环头中声明的）。

缺点：

*   不适用于多维数组
*   依赖`typeof()`，它是 GNU 扩展，*不是*标准 C 的一部分
*   由于它在 for 循环头中声明了变量，因此它只适用于 C11 或更高版本。

只是为了节省您一些时间，以下是测试它的方法：

```
typedef struct {
    double x;
    double y;
} Point;

int main(void) {
    double some_nums[] = {4.2, 4.32, -9.9, 7.0};
    for each (element, some_nums, 4)
        printf("element = %lf\n", element);

    int numbers[] = {4, 2, 99, -3, 54};
    // Just demonstrating it can be used like a normal for loop
    for each (number, numbers, 5) { 
        printf("number = %d\n", number);
        if (number % 2 == 0)
                printf("%d is even.\n", number);
    }

    char* dictionary[] = {"Hello", "World"};
    for each (word, dictionary, 2)
        printf("word = '%s'\n", word);

    Point points[] = {{3.4, 4.2}, {9.9, 6.7}, {-9.8, 7.0}};
    for each (point, points, 3)
        printf("point = (%lf, %lf)\n", point.x, point.y);

    /* Neither p, element, number or word are visible outside the scope of
    their respective for loops. Try to see if these printfs work (they shouldn't): */
    //printf("*p = %s", *p);
    //printf("word = %s", word);

    return 0;
} 
```

默认情况下似乎适用于 gcc 和 clang；没有测试过其他编译器。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-30T17:43:36.297

C中没有foreach。

您可以使用 for 循环遍历数据，但需要知道长度或数据需要以已知值终止（例如 null）。

```
char* nullTerm;
nullTerm = "Loop through my characters";

for(;nullTerm != NULL;nullTerm++)
{
    //nullTerm will now point to the next character.
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-06-02T14:32:42.050

虽然 C 没有 for each 构造，但它总是有一个惯用的表示数组末尾的一个`(&arr)[1]`。这允许您为每个循环编写一个简单的惯用语，如下所示：

```
int arr[] = {1,2,3,4,5};
for(int *a = arr; a < (&arr)[1]; ++a)
    printf("%d\n", *a); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-07-21T15:12:45.393

这是一个相当古老的问题，但我虽然应该发布这个。它是 GNU C99 的 foreach 循环。

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>

#define FOREACH_COMP(INDEX, ARRAY, ARRAY_TYPE, SIZE) \
  __extension__ \
  ({ \
    bool ret = 0; \
    if (__builtin_types_compatible_p (const char*, ARRAY_TYPE)) \
      ret = INDEX < strlen ((const char*)ARRAY); \
    else \
      ret = INDEX < SIZE; \
    ret; \
  })

#define FOREACH_ELEM(INDEX, ARRAY, TYPE) \
  __extension__ \
  ({ \
    TYPE *tmp_array_ = ARRAY; \
    &tmp_array_[INDEX]; \
  })

#define FOREACH(VAR, ARRAY) \
for (void *array_ = (void*)(ARRAY); array_; array_ = 0) \
for (size_t i_ = 0; i_ && array_ && FOREACH_COMP (i_, array_, \
                                    __typeof__ (ARRAY), \
                                    sizeof (ARRAY) / sizeof ((ARRAY)[0])); \
                                    i_++) \
for (bool b_ = 1; b_; (b_) ? array_ = 0 : 0, b_ = 0) \
for (VAR = FOREACH_ELEM (i_, array_, __typeof__ ((ARRAY)[0])); b_; b_ = 0)

/* example's */
int
main (int argc, char **argv)
{
  int array[10];
  /* initialize the array */
  int i = 0;
  FOREACH (int *x, array)
    {
      *x = i;
      ++i;
    }

  char *str = "hello, world!";
  FOREACH (char *c, str)
    printf ("%c\n", *c);

  return EXIT_SUCCESS;
} 
```

这段代码已经过测试，可以在 GNU/Linux 上与 gcc、icc 和 clang 一起使用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-09-29T07:34:25.650

这是我在使用 C 时使用的内容。您不能在同一范围内两次使用相同的项目名称，但这并不是真正的问题，因为并非所有人都能使用好的新编译器:(

```
#define FOREACH(type, item, array, size) \
    size_t X(keep), X(i); \
    type item; \
    for (X(keep) = 1, X(i) = 0 ; X(i) < (size); X(keep) = !X(keep), X(i)++) \
        for (item = (array)[X(i)]; X(keep); X(keep) = 0)

#define _foreach(item, array) FOREACH(__typeof__(array[0]), item, array, length(array))
#define foreach(item_in_array) _foreach(item_in_array)

#define in ,
#define length(array) (sizeof(array) / sizeof((array)[0]))
#define CAT(a, b) CAT_HELPER(a, b) /* Concatenate two symbols for macros! */
#define CAT_HELPER(a, b) a ## b
#define X(name) CAT(__##name, __LINE__) /* unique variable */ 
```

用法：

```
int ints[] = {1, 2, 0, 3, 4};
foreach (i in ints) printf("%i", i);
/* can't use the same name in this scope anymore! */
foreach (x in ints) printf("%i", x); 
```

**编辑：**这是`FOREACH`使用 c99 语法避免命名空间污染的替代方法：

```
#define FOREACH(type, item, array, size) \
    for (size_t X(keep) = 1, X(i) = 0; X(i) < (size); X(keep) = 1, X(i)++) \
    for (type item = (array)[X(i)]; X(keep); X(keep) = 0) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-30T17:45:38.883

C 有 'for' 和 'while' 关键字。如果像 C# 这样的语言中的 foreach 语句看起来像这样......

```
foreach (Element element in collection)
{
} 
```

...那么在 C 中这个 foreach 语句的等价物可能是这样的：

```
for (
    Element* element = GetFirstElement(&collection);
    element != 0;
    element = GetNextElement(&collection, element)
    )
{
    //TODO: do something with this element instance ...
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-14T22:04:49.953

[当您使用“break”或“continue”时， Eric 的回答](https://stackoverflow.com/a/1236910/419)不起作用。

这可以通过重写第一行来解决：

原始行（重新格式化）：

```
for (unsigned i = 0, __a = 1; i < B.size(); i++, __a = 1) 
```

固定的：

```
for (unsigned i = 0, __a = 1; __a && i < B.size(); i++, __a = 1) 
```

如果你将它与 Johannes 的循环进行比较，你会发现他实际上也在做同样的事情，只是更复杂和更丑陋一些。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-08-27T17:45:19.600

这是一个简单的单 for 循环：

```
#define FOREACH(type, array, size) do { \
        type it = array[0]; \
        for(int i = 0; i < size; i++, it = array[i])
#define ENDFOR  } while(0);

int array[] = { 1, 2, 3, 4, 5 };

FOREACH(int, array, 5)
{
    printf("element: %d. index: %d\n", it, i);
}
ENDFOR 
```

让您可以在需要时访问索引 ( `i`) 和我们正在迭代的当前项目 ( `it`)。请注意，嵌套循环时可能会遇到命名问题，您可以将项目和索引名称作为宏的参数。

编辑：这是接受的答案的修改版本`foreach`。让您指定`start`索引，`size`以便它适用于衰减的数组（指针），不需要`int*`并更改`count != size`为`i < size`以防万一用户不小心将“i”修改为大于`size`并陷入无限循环。

```
#define FOREACH(item, array, start, size)\
    for(int i = start, keep = 1;\
        keep && i < size;\
        keep = !keep, i++)\
    for (item = array[i]; keep; keep = !keep)

int array[] = { 1, 2, 3, 4, 5 };
FOREACH(int x, array, 2, 5)
    printf("index: %d. element: %d\n", i, x); 
```

输出：

```
index: 2\. element: 3
index: 3\. element: 4
index: 4\. element: 5 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-05-15T20:01:19.917

如果您打算使用函数指针

```
#define lambda(return_type, function_body)\
    ({ return_type __fn__ function_body __fn__; })

#define array_len(arr) (sizeof(arr)/sizeof(arr[0]))

#define foreachnf(type, item, arr, arr_length, func) {\
    void (*action)(type item) = func;\
    for (int i = 0; i<arr_length; i++) action(arr[i]);\
}

#define foreachf(type, item, arr, func)\
    foreachnf(type, item, arr, array_len(arr), func)

#define foreachn(type, item, arr, arr_length, body)\
    foreachnf(type, item, arr, arr_length, lambda(void, (type item) body))

#define foreach(type, item, arr, body)\
    foreachn(type, item, arr, array_len(arr), body) 
```

用法：

```
int ints[] = { 1, 2, 3, 4, 5 };
foreach(int, i, ints, {
    printf("%d\n", i);
});

char* strs[] = { "hi!", "hello!!", "hello world", "just", "testing" };
foreach(char*, s, strs, {
    printf("%s\n", s);
});

char** strsp = malloc(sizeof(char*)*2);
strsp[0] = "abcd";
strsp[1] = "efgh";
foreachn(char*, s, strsp, 2, {
    printf("%s\n", s);
});

void (*myfun)(int i) = somefunc;
foreachf(int, i, ints, myfun); 
```

但我认为这仅适用于 gcc（不确定）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-03-14T23:12:11.983

C 没有`for-each`. 将数组解析为点时，接收器不知道数组有多长，因此无法判断何时到达数组的末尾。请记住，在 C`int*`中是指向包含 int 的内存地址的点。没有包含有关按顺序放置多少整数的信息的标头对象。因此，程序员需要跟踪这一点。

然而，对于列表，很容易实现类似于`for-each`循环的东西。

```
for(Node* node = head; node; node = node.next) {
   /* do your magic here */
} 
```

要为数组实现类似的功能，您可以执行以下两项操作之一。

1.  使用第一个元素来存储数组的长度。
2.  将数组包装在一个结构中，该结构包含长度和指向数组的指针。

以下是此类结构的示例：

```
typedef struct job_t {
   int count;
   int* arr;
} arr_t; 
```

# ios - 如何自定义分组表格视图单元格的背景/边框颜色？

> ID：400965
> 
> 赞同：114
> 
> 时间：2008-12-30T17:47:34.870
> 
> 标签：ios, objective-c, iphone, uitableview, cocoa-touch

我想自定义分组样式 UITableView 的背景和边框颜色。

我可以使用以下方法自定义背景颜色：

```
tableView.contentView.backgroundColor = [UIColor greenColor]; 
```

但是边框颜色仍然是我不知道如何更改的东西。

如何自定义分组样式表视图的这两个方面？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-12-30T19:46:36.033

**更新：**在 iPhone OS 3.0 及更高版本中，`UITableViewCell`现在有一个`backgroundColor`属性使这变得非常容易（尤其是与`[UIColor colorWithPatternImage:]`初始化程序结合使用）。但我会将 2.0 版本的答案留给任何需要它的人……</p>

* * *

这比它真正应该的要难。当我不得不这样做时，我是这样做的：

您需要将 UITableViewCell 的 backgroundView 属性设置为自定义 UIView，以适当的颜色绘制边框和背景本身。此视图需要能够以 4 种不同的模式绘制边框，部分中的第一个单元格的顶部圆角，部分中的最后一个单元格的底部圆角，部分中间的单元格没有圆角, 并对包含一个单元格的部分的所有 4 个角进行舍入。

不幸的是，我无法弄清楚如何自动设置此模式，因此我不得不在 UITableViewDataSource 的 -cellForRowAtIndexPath 方法中进行设置。

这是一个真正的 PITA，但我已经与 Apple 工程师确认这是目前唯一的方法。

**更新**这是该自定义 bg 视图的代码。有一个绘图错误使圆角看起来有点滑稽，但我们改用了不同的设计，并在我有机会修复它之前取消了自定义背景。不过，这可能对您很有帮助：

```
//
//  CustomCellBackgroundView.h
//
//  Created by Mike Akers on 11/21/08.
//  Copyright 2008 __MyCompanyName__. All rights reserved.
//

#import <UIKit/UIKit.h>

typedef enum  {
    CustomCellBackgroundViewPositionTop, 
    CustomCellBackgroundViewPositionMiddle, 
    CustomCellBackgroundViewPositionBottom,
    CustomCellBackgroundViewPositionSingle
} CustomCellBackgroundViewPosition;

@interface CustomCellBackgroundView : UIView {
    UIColor *borderColor;
    UIColor *fillColor;
    CustomCellBackgroundViewPosition position;
}

    @property(nonatomic, retain) UIColor *borderColor, *fillColor;
    @property(nonatomic) CustomCellBackgroundViewPosition position;
@end

//
//  CustomCellBackgroundView.m
//
//  Created by Mike Akers on 11/21/08.
//  Copyright 2008 __MyCompanyName__. All rights reserved.
//

#import "CustomCellBackgroundView.h"

static void addRoundedRectToPath(CGContextRef context, CGRect rect,
                                 float ovalWidth,float ovalHeight);

@implementation CustomCellBackgroundView
@synthesize borderColor, fillColor, position;

- (BOOL) isOpaque {
    return NO;
}

- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        // Initialization code
    }
    return self;
}

- (void)drawRect:(CGRect)rect {
    // Drawing code
    CGContextRef c = UIGraphicsGetCurrentContext();
    CGContextSetFillColorWithColor(c, [fillColor CGColor]);
    CGContextSetStrokeColorWithColor(c, [borderColor CGColor]);

    if (position == CustomCellBackgroundViewPositionTop) {
        CGContextFillRect(c, CGRectMake(0.0f, rect.size.height - 10.0f, rect.size.width, 10.0f));
        CGContextBeginPath(c);
        CGContextMoveToPoint(c, 0.0f, rect.size.height - 10.0f);
        CGContextAddLineToPoint(c, 0.0f, rect.size.height);
        CGContextAddLineToPoint(c, rect.size.width, rect.size.height);
        CGContextAddLineToPoint(c, rect.size.width, rect.size.height - 10.0f);
        CGContextStrokePath(c);
        CGContextClipToRect(c, CGRectMake(0.0f, 0.0f, rect.size.width, rect.size.height - 10.0f));
    } else if (position == CustomCellBackgroundViewPositionBottom) {
        CGContextFillRect(c, CGRectMake(0.0f, 0.0f, rect.size.width, 10.0f));
        CGContextBeginPath(c);
        CGContextMoveToPoint(c, 0.0f, 10.0f);
        CGContextAddLineToPoint(c, 0.0f, 0.0f);
        CGContextStrokePath(c);
        CGContextBeginPath(c);
        CGContextMoveToPoint(c, rect.size.width, 0.0f);
        CGContextAddLineToPoint(c, rect.size.width, 10.0f);
        CGContextStrokePath(c);
        CGContextClipToRect(c, CGRectMake(0.0f, 10.0f, rect.size.width, rect.size.height));
    } else if (position == CustomCellBackgroundViewPositionMiddle) {
        CGContextFillRect(c, rect);
        CGContextBeginPath(c);
        CGContextMoveToPoint(c, 0.0f, 0.0f);
        CGContextAddLineToPoint(c, 0.0f, rect.size.height);
        CGContextAddLineToPoint(c, rect.size.width, rect.size.height);
        CGContextAddLineToPoint(c, rect.size.width, 0.0f);
        CGContextStrokePath(c);
        return; // no need to bother drawing rounded corners, so we return
    }

    // At this point the clip rect is set to only draw the appropriate
    // corners, so we fill and stroke a rounded rect taking the entire rect

    CGContextBeginPath(c);
    addRoundedRectToPath(c, rect, 10.0f, 10.0f);
    CGContextFillPath(c);  

    CGContextSetLineWidth(c, 1);  
    CGContextBeginPath(c);
    addRoundedRectToPath(c, rect, 10.0f, 10.0f);  
    CGContextStrokePath(c); 
}

- (void)dealloc {
    [borderColor release];
    [fillColor release];
    [super dealloc];
}

@end

static void addRoundedRectToPath(CGContextRef context, CGRect rect,
                                float ovalWidth,float ovalHeight)

{
    float fw, fh;

    if (ovalWidth == 0 || ovalHeight == 0) {// 1
        CGContextAddRect(context, rect);
        return;
    }

    CGContextSaveGState(context);// 2

    CGContextTranslateCTM (context, CGRectGetMinX(rect),// 3
                           CGRectGetMinY(rect));
    CGContextScaleCTM (context, ovalWidth, ovalHeight);// 4
    fw = CGRectGetWidth (rect) / ovalWidth;// 5
    fh = CGRectGetHeight (rect) / ovalHeight;// 6

    CGContextMoveToPoint(context, fw, fh/2); // 7
    CGContextAddArcToPoint(context, fw, fh, fw/2, fh, 1);// 8
    CGContextAddArcToPoint(context, 0, fh, 0, fh/2, 1);// 9
    CGContextAddArcToPoint(context, 0, 0, fw/2, 0, 1);// 10
    CGContextAddArcToPoint(context, fw, 0, fw, fh/2, 1); // 11
    CGContextClosePath(context);// 12

    CGContextRestoreGState(context);// 13
} 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2011-06-30T17:30:08.740

我知道答案与更改分组表格单元格有关，但如果有人想更改表格视图的背景颜色：

您不仅需要设置：

```
tableview.backgroundColor = color; 
```

您还需要更改或摆脱背景视图：

```
tableview.backgroundView = nil; 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-06-23T09:47:08.627

首先感谢这段代码。我在此功能中进行了一些绘图更改，以消除绘图的角落问题。

```
-(void)drawRect:(CGRect)rect 
{
    // Drawing code

    CGContextRef c = UIGraphicsGetCurrentContext();
    CGContextSetFillColorWithColor(c, [fillColor CGColor]);
    CGContextSetStrokeColorWithColor(c, [borderColor CGColor]);
    CGContextSetLineWidth(c, 2);

    if (position == CustomCellBackgroundViewPositionTop) {

        CGFloat minx = CGRectGetMinX(rect) , midx = CGRectGetMidX(rect), maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny + 1;

        maxx = maxx - 1;
        maxy = maxy ;

        CGContextMoveToPoint(c, minx, maxy);
        CGContextAddArcToPoint(c, minx, miny, midx, miny, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, miny, maxx, maxy, ROUND_SIZE);
        CGContextAddLineToPoint(c, maxx, maxy);

        // Close the path
        CGContextClosePath(c);
        // Fill & stroke the path
        CGContextDrawPath(c, kCGPathFillStroke);        
        return;
    } else if (position == CustomCellBackgroundViewPositionBottom) {

        CGFloat minx = CGRectGetMinX(rect) , midx = CGRectGetMidX(rect), maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny ;

        maxx = maxx - 1;
        maxy = maxy - 1;

        CGContextMoveToPoint(c, minx, miny);
        CGContextAddArcToPoint(c, minx, maxy, midx, maxy, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, maxy, maxx, miny, ROUND_SIZE);
        CGContextAddLineToPoint(c, maxx, miny);
        // Close the path
        CGContextClosePath(c);
        // Fill & stroke the path
        CGContextDrawPath(c, kCGPathFillStroke);    
        return;
    } else if (position == CustomCellBackgroundViewPositionMiddle) {
        CGFloat minx = CGRectGetMinX(rect) , maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny ;

        maxx = maxx - 1;
        maxy = maxy ;

        CGContextMoveToPoint(c, minx, miny);
        CGContextAddLineToPoint(c, maxx, miny);
        CGContextAddLineToPoint(c, maxx, maxy);
        CGContextAddLineToPoint(c, minx, maxy);

        CGContextClosePath(c);
        // Fill & stroke the path
        CGContextDrawPath(c, kCGPathFillStroke);    
        return;
    }
} 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-07-18T01:53:37.607

谢谢你的代码，这正是我想要的。我还在 Vimal 的代码中添加了以下代码，以实现 CustomCellBackgroundViewPositionSingle 单元格的情况。（所有四个角都是圆形的。）

```
 else if (position == CustomCellBackgroundViewPositionSingle)
{
        CGFloat minx = CGRectGetMinX(rect) , midx = CGRectGetMidX(rect), maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , midy = CGRectGetMidY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny + 1;

        maxx = maxx - 1;
        maxy = maxy - 1;

        CGContextMoveToPoint(c, minx, midy);
        CGContextAddArcToPoint(c, minx, miny, midx, miny, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, miny, maxx, midy, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, maxy, midx, maxy, ROUND_SIZE);
        CGContextAddArcToPoint(c, minx, maxy, minx, midy, ROUND_SIZE);

        // Close the path
        CGContextClosePath(c);
        // Fill & stroke the path
        CGContextDrawPath(c, kCGPathFillStroke);                
        return;     
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-08-26T18:18:19.607

我使用 Mike Akers 的上述 CustomCellBackgroundView 代码遇到的一件事可能对其他人有用：

`cell.backgroundView`重用单元格时不会自动重绘，并且更改 backgroundView 的位置变量不会影响重用的单元格。`cell.backgroundViews`这意味着考虑到它们的位置，长桌将被错误地绘制。

要解决此问题，而不必每次显示一行时都创建一个新的 backgroundView，请`[cell.backgroundView setNeedsDisplay]`在`-[UITableViewController tableView:cellForRowAtIndexPath:]`. 或者对于更可重用的解决方案，覆盖 CustomCellBackgroundView 的位置设置器以包含`[self setNeedsDisplay]`.

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-08-06T20:18:29.290

感谢这篇超级有用的帖子。万一有人（比如我！）想要一个完全空的单元格背景，而不是通过 IB 中的图像/文本/其他内容自定义它，并且无法弄清楚如何摆脱愚蠢的边框/填充/即使您在 IB 中将其设置为清除背景...这是我用来解决问题的代码！

```
 - (UITableViewCell *) tableView: (UITableView *) tableView cellForRowAtIndexPath: (NSIndexPath *) indexPath {

    static NSString *cellId = @"cellId";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier: cellId];
    if (cell == nil) {
        [[NSBundle mainBundle] loadNibNamed:@"EditTableViewCell" owner:self options:nil];
        cell = cellIBOutlet;
        self.cellIBOutlet = nil;
    }

    cell.backgroundView = [[[UIView alloc] initWithFrame: CGRectZero] autorelease];
    [cell.backgroundView setNeedsDisplay];

    ... any other cell customizations ...

    return cell;
} 
```

希望这会帮助别人！似乎像魅力一样工作。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-01-13T02:11:44.943

非常感谢所有发布代码的人。这非常有用。

我得出了一个类似的解决方案来更改分组表视图单元格的突出显示颜色。基本上是 UITableViewCell 的 selectedBackgroundView（不是 backgroundView）。据我所知，即使在 iPhone OS 3.0 上仍然需要这个 PITA 解决方案......

下面的代码对使用渐变而不是一种纯色渲染高光进行了更改。边框渲染也被删除。享受。

```
//
//  CSCustomCellBackgroundView.h
//

#import <UIKit/UIKit.h>

typedef enum  
{
    CustomCellBackgroundViewPositionTop, 
    CustomCellBackgroundViewPositionMiddle, 
    CustomCellBackgroundViewPositionBottom,
    CustomCellBackgroundViewPositionSingle,
    CustomCellBackgroundViewPositionPlain
} CustomCellBackgroundViewPosition;

@interface CSCustomCellBackgroundView : UIView 
{
    CustomCellBackgroundViewPosition position;
 CGGradientRef gradient;
}

@property(nonatomic) CustomCellBackgroundViewPosition position;

@end

//
//  CSCustomCellBackgroundView.m
//

#import "CSCustomCellBackgroundView.h"

#define ROUND_SIZE 10

static void addRoundedRectToPath(CGContextRef context, CGRect rect,
         float ovalWidth,float ovalHeight);

@implementation CSCustomCellBackgroundView

@synthesize position;

- (BOOL) isOpaque 
{
    return NO;
}

- (id)initWithFrame:(CGRect)frame 
{
    if (self = [super initWithFrame:frame]) 
 {
        // Initialization code
  const float* topCol = CGColorGetComponents([[UIColor redColor] CGColor]);
  const float* bottomCol = CGColorGetComponents([[UIColor blueColor] CGColor]);

  CGColorSpaceRef rgb = CGColorSpaceCreateDeviceRGB();
  /*
  CGFloat colors[] =
  {
   5.0 / 255.0, 140.0 / 255.0, 245.0 / 255.0, 1.00,
   1.0 / 255.0,  93.0 / 255.0, 230.0 / 255.0, 1.00,
  };*/
  CGFloat colors[]=
  {
   topCol[0], topCol[1], topCol[2], topCol[3],
   bottomCol[0], bottomCol[1], bottomCol[2], bottomCol[3]
  };
  gradient = CGGradientCreateWithColorComponents(rgb, colors, NULL, sizeof(colors)/(sizeof(colors[0])*4));
  CGColorSpaceRelease(rgb);
    }
    return self;
}

-(void)drawRect:(CGRect)rect 
{
    // Drawing code

    CGContextRef c = UIGraphicsGetCurrentContext();

    if (position == CustomCellBackgroundViewPositionTop) 
 {

        CGFloat minx = CGRectGetMinX(rect) , midx = CGRectGetMidX(rect), maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny + 1;

        maxx = maxx - 1;
        maxy = maxy ;

        CGContextMoveToPoint(c, minx, maxy);
        CGContextAddArcToPoint(c, minx, miny, midx, miny, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, miny, maxx, maxy, ROUND_SIZE);
        CGContextAddLineToPoint(c, maxx, maxy);

        // Close the path
        CGContextClosePath(c);

  CGContextSaveGState(c);
  CGContextClip(c);
  CGContextDrawLinearGradient(c, gradient, CGPointMake(minx,miny), CGPointMake(minx,maxy), kCGGradientDrawsBeforeStartLocation | kCGGradientDrawsAfterEndLocation);
  CGContextRestoreGState(c);

        return;
    } 
 else if (position == CustomCellBackgroundViewPositionBottom) 
 {

        CGFloat minx = CGRectGetMinX(rect) , midx = CGRectGetMidX(rect), maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny + 1;

        maxx = maxx - 1;
        maxy = maxy - 1;

        CGContextMoveToPoint(c, minx, miny);
        CGContextAddArcToPoint(c, minx, maxy, midx, maxy, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, maxy, maxx, miny, ROUND_SIZE);
        CGContextAddLineToPoint(c, maxx, miny);
        // Close the path
        CGContextClosePath(c);

  CGContextSaveGState(c);
  CGContextClip(c);
  CGContextDrawLinearGradient(c, gradient, CGPointMake(minx,miny), CGPointMake(minx,maxy), kCGGradientDrawsBeforeStartLocation | kCGGradientDrawsAfterEndLocation);
  CGContextRestoreGState(c);

        return;
    } 
 else if (position == CustomCellBackgroundViewPositionMiddle) 
 {
        CGFloat minx = CGRectGetMinX(rect) , maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny + 1;

        maxx = maxx - 1;
        maxy = maxy ;

        CGContextMoveToPoint(c, minx, miny);
        CGContextAddLineToPoint(c, maxx, miny);
        CGContextAddLineToPoint(c, maxx, maxy);
        CGContextAddLineToPoint(c, minx, maxy);
  // Close the path
        CGContextClosePath(c);

  CGContextSaveGState(c);
  CGContextClip(c);
  CGContextDrawLinearGradient(c, gradient, CGPointMake(minx,miny), CGPointMake(minx,maxy), kCGGradientDrawsBeforeStartLocation | kCGGradientDrawsAfterEndLocation);
  CGContextRestoreGState(c);

        return;
    }
 else if (position == CustomCellBackgroundViewPositionSingle)
 {
        CGFloat minx = CGRectGetMinX(rect) , midx = CGRectGetMidX(rect), maxx = CGRectGetMaxX(rect) ;
        CGFloat miny = CGRectGetMinY(rect) , midy = CGRectGetMidY(rect) , maxy = CGRectGetMaxY(rect) ;
        minx = minx + 1;
        miny = miny + 1;

        maxx = maxx - 1;
        maxy = maxy - 1;

        CGContextMoveToPoint(c, minx, midy);
        CGContextAddArcToPoint(c, minx, miny, midx, miny, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, miny, maxx, midy, ROUND_SIZE);
        CGContextAddArcToPoint(c, maxx, maxy, midx, maxy, ROUND_SIZE);
        CGContextAddArcToPoint(c, minx, maxy, minx, midy, ROUND_SIZE);
        // Close the path
        CGContextClosePath(c);              

  CGContextSaveGState(c);
  CGContextClip(c);
  CGContextDrawLinearGradient(c, gradient, CGPointMake(minx,miny), CGPointMake(minx,maxy), kCGGradientDrawsBeforeStartLocation | kCGGradientDrawsAfterEndLocation);
  CGContextRestoreGState(c);

        return;         
 } 
 else if (position == CustomCellBackgroundViewPositionPlain) {
    CGFloat minx = CGRectGetMinX(rect);
    CGFloat miny = CGRectGetMinY(rect), maxy = CGRectGetMaxY(rect) ;
    CGContextDrawLinearGradient(c, gradient, CGPointMake(minx,miny), CGPointMake(minx,maxy), kCGGradientDrawsBeforeStartLocation | kCGGradientDrawsAfterEndLocation);
    return;
}

}

- (void)dealloc 
{
    CGGradientRelease(gradient);
    [super dealloc];
}

- (void) setPosition:(CustomCellBackgroundViewPosition)inPosition
{
 if(position != inPosition)
 {
  position = inPosition;
  [self setNeedsDisplay];
 }
}

@end

static void addRoundedRectToPath(CGContextRef context, CGRect rect,
         float ovalWidth,float ovalHeight)

{
    float fw, fh;

    if (ovalWidth == 0 || ovalHeight == 0) {// 1
        CGContextAddRect(context, rect);
        return;
    }

    CGContextSaveGState(context);// 2

    CGContextTranslateCTM (context, CGRectGetMinX(rect),// 3
         CGRectGetMinY(rect));
    CGContextScaleCTM (context, ovalWidth, ovalHeight);// 4
    fw = CGRectGetWidth (rect) / ovalWidth;// 5
    fh = CGRectGetHeight (rect) / ovalHeight;// 6

    CGContextMoveToPoint(context, fw, fh/2); // 7
    CGContextAddArcToPoint(context, fw, fh, fw/2, fh, 1);// 8
    CGContextAddArcToPoint(context, 0, fh, 0, fh/2, 1);// 9
    CGContextAddArcToPoint(context, 0, 0, fw/2, 0, 1);// 10
    CGContextAddArcToPoint(context, fw, 0, fw, fh/2, 1); // 11
    CGContextClosePath(context);// 12

    CGContextRestoreGState(context);// 13
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-04-11T20:34:43.853

您可以通过设置自定义边框颜色

```
tableView.separatorColor 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-04-11T16:26:41.807

要更改表格视图边框颜色：

在.h：

```
#import <QuartzCore/QuartzCore.h> 
```

以 .m 为单位：

```
tableView.layer.masksToBounds=YES;
tableView.layer.borderWidth = 1.0f;
tableView.layer.borderColor = [UIColor whiteColor].CGColor; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-20T07:57:34.187

通过添加大约 5 行代码，可以使用[PrettyKit轻松完成此任务。](https://github.com/vicpenap/PrettyKit)如果您使用`nib`文件或`storyboard`，也不要忘记应用[这个小技巧](https://github.com/vicpenap/PrettyKit/issues/3)。当您使用这种方法时，您应该将您的单元格从以下子类化`PrettyTableViewCell`：

```
#import <PrettyKit/PrettyKit.h>

@class RRSearchHistoryItem;

@interface RRSearchHistoryCell : PrettyTableViewCell 
```

这是我的例子`cellForRowAtIndexPath`：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
  static NSString *cellIdentifier = @"RRSearchHistoryCell";

  RRSearchHistoryCell *cell = (RRSearchHistoryCell *)[tableView dequeueReusableCellWithIdentifier:cellIdentifier];

  if ( cell == nil ) {

    NSArray *topLevelObjects = [[NSBundle mainBundle] loadNibNamed:@"RRSearchHistoryCell" owner:self options:nil];
    cell = topLevelObjects[0];
    cell.gradientStartColor = RGB(0xffffff);
    cell.gradientEndColor = RGB(0xf3f3f3);

  }

  RRSearchHistoryItem *item = _historyTableData[indexPath.row];
  [cell setHistoryItem:item];

  [cell prepareForTableView:tableView indexPath:indexPath];

  return cell;
} 
```

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2009-06-19T07:28:42.190

我一直有这个问题，并尝试了很多组合的东西，因为我注意到对于某些细胞它工作得很好，但对于其他细胞却不行。

奇怪的是，我发现可以将 cell.backgroundColor 设置为 lightGrayColor 并且一切正常 - 但是 blueColor 导致我无法更新外部边缘的问题。

除非使用绿色真的很重要——也许你可能想试试这个。这可能是一个让人们在指示单元格被选中时只使用灰色的功能。

# javascript - 当我包装一个函数时，有没有办法防止“这个”发生变化？

> ID：400968
> 
> 赞同：1
> 
> 时间：2008-12-30T17:49:53.227
> 
> 标签：javascript, binding

我希望所有按钮在其正常的 onclick 事件之前和之后执行一个操作。所以我想出了循环遍历所有这些元素并创建一个包装函数的“绝妙”想法。

当我测试它时，这似乎工作得很好，但是当我将它集成到我们的应用程序中时，它就崩溃了。我将其追溯到包装器更改了“this”值。示例代码说明了这一点；在包装事件处理程序之前，每个按钮都会在您单击时显示按钮 ID，但在包装它之后，在此示例中显示的名称为“未定义”，如果您从表单中运行它，则显示名称为“Form1”。

有人知道做同样事情的更好方法吗？还是保持最初预期的“this”值的好方法？

可以想象，我不想修改目标按钮中的任何现有事件处理程序代码。

提前致谢。

PS-目标浏览器是IE6及以上，不需要跨浏览器功能

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<script language="javascript" type="text/javascript">
    function btnWrap_onClick()
    {
        var btns = document.getElementsByTagName("button");
        for( var i = 0; i < btns.length; i++)
        {
            var btn = btns[i];

            // handle wrap button differerntly
            if( "btnWrap" == btn.id)
            {
                btn.disabled = true;
                continue; // skip this button
            }

            // wrap it
            var originalEventHandler = btn.onclick;
            btn.onclick = function()
            {
                alert("Starting event handler");
                originalEventHandler();
                alert("Finished event handler");
            }
        }

        alert("Buttons wrapped successfully");
    }
</script>
<body>
    <p>
    <button id="TestButton1" onclick="alert(this.id);">TestButton1</button>
    <button id="TestButton2" onclick="alert(this.id);">TestButton2</button>
    </p>
    <button id="btnWrap" onclick="btnWrap_onClick();">Wrap Event Handlers</button>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T17:59:45.673

您可以使用[call](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/call)方法来解析绑定，例如`originalEventHandler.call(btn);`

或者，像原型这样的库可以提供帮助 - 它的[bind](http://www.prototypejs.org/api/function/bind)方法允许您构建一个绑定到指定对象的新函数，因此您可以将 originalEventHandler 声明为`var originalEventHandler = btn.onclick.bind(btn);`

最后，有关绑定问题的良好背景知识，另请参阅[摆脱 JavaScript 中的绑定情况](http://www.alistapart.com/articles/getoutbindingsituations)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T22:07:40.697

就像[Paul Dixon](https://stackoverflow.com/users/6521/)说的，你可以使用[call](http://msdn.microsoft.com/en-us/library/wt1h2e5c.aspx)但我建议你使用[apply](http://msdn.microsoft.com/en-us/library/4zc42wh1(VS.85).aspx)代替。

但是，我要回答的原因是我发现了一个令人不安的错误：**您实际上正在用最后一个按钮的事件处理程序替换所有事件处理程序。**我不认为那是你的意图，是吗？（提示：您将在每次迭代中替换 originalEventHandler 的值）

在下面的代码中，您可以找到一个有效的跨浏览器解决方案：

```
function btnWrap_onClick()
{
    var btns = document.getElementsByTagName("button");
    for( var i = 0; i < btns.length; i++)
    {
        var btn = btns[i];

        // handle wrap button differerntly
        if( "btnWrap" == btn.id)
        {
            btn.disabled = true;
            continue; // skip this button
        }

        // wrap it

        var newOnClick = function()
        {
            alert("Starting event handler");
            var src=arguments.callee;
            src.original.apply(src.source,arguments);
            alert("Finished event handler");
        }
        newOnClick.original = btn.onclick; // Save original onClick
        newOnClick.source = btn; // Save source for "this"
        btn.onclick = newOnClick; //Assign new handler
    }
alert("Buttons wrapped successfully");
} 
```

首先，我创建一个新的匿名函数并将其存储在变量*newOnClick*中。由于函数是一个对象，我可以像任何其他对象一样在函数对象上创建属性。我使用它来创建作为原始 onclick-handler 的属性*original*，以及作为*源*元素的 source ，当调用原始处理程序时将成为*this 。*

在匿名函数内部，我需要获取对该函数的引用才能获取属性*original*和*source*的值。由于匿名函数没有名称，我使用[arguments.callee](http://msdn.microsoft.com/en-us/library/s4esdbwz(VS.85).aspx)（自MSIE5.5 起支持）来获取该引用并将其存储在变量src 中。

然后我使用方法*apply*来执行原始的 onclick 处理程序。*apply*接受两个参数：第一个是*this*的值，第二个是参数数组。*这*必须是原始 onclick 处理程序附加到的元素，并且该值保存在*source*中。*arguments*是所有函数的内部属性，并保存调用函数时使用的所有参数（请注意，匿名函数没有指定任何参数，但如果无论如何调用它时使用了一些参数，它们将在*arguments*属性中找到）。

The reason I use *apply* is that I can forward all the arguments that the anonymous function was called with, and this makes this function transparent and cross-browser. (Microsoft put the event in window.event but the other browsers supplies it in the first parameter of the handler call)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T17:55:41.983

您的问题是闭包在 JavaScript 中的工作方式。老实说，我建议使用框架。他们中的任何一个都应该使事件处理比手动处理要好得多。

# sql-server - 如何查找 SQLServer 数据库中所有空间的使用位置

> ID：400976
> 
> 赞同：2
> 
> 时间：2008-12-30T17:53:52.377
> 
> 标签：sql-server, sql-server-2005

我们有一个 SQL Server 数据库，根据 Microsoft SQL Server Management Studio 的说法，在 6436Mb 中只有 119Mb 可用。

然而命令： EXEC sp_msforeachtable 'sp_spaceused ''?'''
显示总保留空间小于 2Gb

我们如何才能找出其余空间的使用情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T18:33:58.850

尝试运行我在我们的数据库上使用的这个脚本。这可能会为您提供更多信息。寻找索引空间：

```
CREATE TABLE #temp(
    rec_id      int IDENTITY (1, 1),
    table_name  varchar(128),
    nbr_of_rows int,
    data_space  decimal(15,2),
    index_space decimal(15,2),
    total_size  decimal(15,2),
    percent_of_db   decimal(15,12),
    db_size     decimal(15,2))

    -- Get all tables, names, and sizes
    EXEC sp_msforeachtable @command1="insert into #temp(nbr_of_rows, data_space, index_space) exec sp_mstablespace '?'",
                @command2="update #temp set table_name = '?' where rec_id = (select max(rec_id) from #temp)"

    -- Set the total_size and total database size fields
    UPDATE #temp
    SET total_size = (data_space + index_space), db_size = (SELECT SUM(data_space + index_space) FROM #temp)

    -- Set the percent of the total database size
    UPDATE #temp
    SET percent_of_db = (total_size/db_size) * 100

    -- Get the data
    SELECT *
    FROM #temp
    ORDER BY nbr_of_rows DESC

    --select sum(nbr_of_rows) from #temp 
    --for xml auto

    -- Comment out the following line if you want to do further querying
    DROP TABLE #temp 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T18:54:58.290

如果您使用安装了 Reporting Services 的 SQL Server 2005，您可以尝试运行名为“按表列出的磁盘使用情况”的内置报告。您可以在 Management Studio 中通过右键单击您的数据库并选择：Reports->Standard Reports->Disk Usage by Table 来访问它。

该报告将为您提供以下信息：表名、记录数、保留 (KB)、数据 (KB)、索引 (KB)、未使用 (KB)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-02-24T07:25:05.920

检查此脚本以[获得每个数据库的可用空间](http://sqlhint.com/sqlserver/how-to/tsql/get-space-used-for-each-database)。

```
SELECT
        DB.name,
        MF.physical_name,
        MF.type_desc AS FileType,
        MF.size * 8 / 1024 AS FileSizeMB,
        fileproperty(MF.name, 'SpaceUsed') * 8/ 1024 AS UsedSpaceMB
FROM
        sys.master_files MF
        JOIN sys.databases DB ON DB.database_id = MF.database_id
ORDER BY
        DB.name,
        FileSizeMB DESC 
```

# sql - 创建 SQL Server 回滚脚本的最佳方法？

> ID：400984
> 
> 赞同：6
> 
> 时间：2008-12-30T17:57:37.080
> 
> 标签：sql, sql-server-2005, tsql, rollback

我正在对现有数据库进行一些架构更改。

我备份了数据库以获取开发副本，并进行了更改。我将创建一个单一的滚动脚本，以在单个事务中迁移生产机器上的更改。

是否有创建回滚脚本以防止出现部署问题的最佳实践？在我使用以下模式手动编写之前：

*   删除新的约束和索引
*   更改表以删除新列
*   删除添加的表
*   提交事务

有更好的方法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T18:54:23.190

你错过了第五步

*   删除新的约束和索引
*   更改表以删除新列
*   删除添加的表
*   提交事务
*   **在生产中运行之前测试脚本**

一种更有效的方法是在更改发生时注册更改，就像[RoR](http://wiki.rubyonrails.org/rails/pages/understandingmigrations) [迁移](http://wiki.rubyonrails.org/rails/pages/UsingMigrations) [所做](http://api.rubyonrails.org/classes/ActiveRecord/Migration.html)的那样。对于每个数据库更改，您创建一个脚本，该脚本将应用更改并将其回滚（当然，由您选择）。然后，您可以将这些脚本置于版本控制之下，就像您的代码一样。

此外，如果您在数据库中保留一个版本号，您可以通过使用版本号识别每个脚本并根据执行的操作增加或减少数据库中的版本号来使其自动化程度更高。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T18:03:36.540

基本上就是这样，除了你的方法之外，我认为没有什么要补充的。这就是我们公司的做法，我们的开发人员负责创建脚本和回滚脚本，我们负责使数据库保持在应用初始更改之前的相同状态。然后 DBA 在生产中运行它，如果出现问题，他们将运行回滚脚本，一切都恢复正常。请记住更改对象然后向后创建回滚脚本的依赖关系和顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T18:04:48.003

如果它是一个相对较小的数据库，只需在应用升级之前进行备份。如果这一切都出问题了，你就做一个恢复。

一旦它上线并输入了新数据，无论如何您都无法真正回滚它。你只需要解决问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T20:05:10.677

如果您使用像 Redgate 的 SQL 比较这样的工具，您可以在两个数据库之间运行比较，并使用两者来创建您需要的脚本。dev 到 prod 脚本将包含您正在进行的更改，而 prd 到 dev 脚本将返回到原始生产数据库状态。这可确保您也不会忘记任一脚本中的任何内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T20:08:48.190

使用 SQL Server 2005 或更高版本，您还可以创建数据库快照，以便随时返回到该状态。有关更多信息，请参阅此页面：

[http://msdn.microsoft.com/en-us/library/ms175158.aspx](http://msdn.microsoft.com/en-us/library/ms175158.aspx)

# javascript - 在对每个条目执行请求时遍历数组

> ID：400989
> 
> 赞同：4
> 
> 时间：2008-12-30T18:01:15.983
> 
> 标签：javascript, jquery, ajax

这是我的问题。我有一个数组，其中包含我需要查找天气的城市名称。所以我遍历每个城市并执行 AJAX 请求来检索天气。

```
var LOCATION = 'http://www.google.com/ig/api?weather=';

$( document ).ready( function() {
    for( var cityIdx = 0; cityIdx < cities.length; cityIdx++ ) {
        $.ajax({
            type: 'GET',
            url: LOCATION + cities[ cityIdx ],
            dataType: 'xml',
            success: function( xml ) {
                if( $( xml ).find( 'problem_cause' ) != 0 ) {
                    // Do what I want with the data returned
                    var weather = $( xml ).find( 'temp_c' ).attr( 'data' );
                }
            }
        });
    }
}); 
```

我遇到的问题是在成功功能中，我无法访问城市名称（通过城市 [cityIdx]）。我在 for 循环和成功函数中插入了一个 alert()，看起来循环执行*了 city.length*次，然后我得到了成功函数警报。我的目标是简单地遍历每个城市以获取天气并将其与相关城市名称一起显示在我的页面上。

另外，您建议我应该怎么做才能将内容与演示文稿分开？

谢谢你。:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T18:25:32.860

我怀疑您的问题类似于[http://ejohn.org/apps/learn/](http://ejohn.org/apps/learn/)上的示例。索引变量 cityIdx 在处理 for 循环时在您创建的闭包中更新，因此当您的函数成功运行时，cityIdx 将指向数组中的最后一个元素。解决方案是使用评估的匿名函数来创建一个独立的上下文，其中索引值不会得到更新。

```
//...
success: (function(cities, idx) {
    return function( xml ) {
      if( $( xml ).find( 'problem_cause' ) != 0 ) {
        // Do what I want with the data returned
        // use cities[idx]
        var weather = $( xml ).find( 'temp_c' ).attr( 'data' );
      }
    };
  })(cities, cityIdx)
//... 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T18:29:33.850

由于 Javascript 使用函数进行闭包，我发现对我来说最简单的方法是将 for 循环的内容包装在一个内联函数中，该函数将当前城市名称复制到它始终可以访问的变量中。

```
$(document).ready(function() {
    for (var cityIdx = 0; cityIdx < cities.length; cityIdx++) {
        new function() {
            var currentCity = cities[cityIdx];
            $.ajax({
                type: 'GET',
                url: LOCATION + currentCity,
                dataType: 'xml',
                success: function(xml) {
                    alert(currentCity);
                    if ($(xml).find('problem_cause') != 0) {
                        // Do what I want with the data returned
                        var weather = $(xml).find('temp_c').attr('data');
                    }
                }
            });
        }(); // the "();" calls the function we just created inline
    }
}); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T19:26:29.803

为什么不使用 jQuery 来遍历你的数组呢？使用 jQuery 的 each 函数：

```
 var LOCATION = 'http://www.google.com/ig/api?weather=';

$( document ).ready( function() {

    $.each(cities, function()  {
    //assign the current city name to a variable
        var city = this;
        $.ajax({
                type: 'GET',
                url: LOCATION + city,
                dataType: 'xml',
                success: function( xml ) {
                    if( $( xml ).find( 'problem_cause' ) != 0 ) {
                        alert(city);
                            // Do what I want with the data returned
                        var weather = $( xml ).find( 'temp_c' ).attr( 'data' ); 
                    }
                }
        });
    });
}); 
```

成功功能中的警报显示正确的城市。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T18:11:31.407

最简单的做法是让您的 AJAX 请求返回城市名称。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T18:17:28.600

由于各种原因，我会尝试将成功函数提取到单独定义的函数中，然后在包含城市名称的 ajax 调用中为其创建一个闭包。所以首先，一个单独的成功处理程序：

```
function city_success(xml, name) {
  // your success handling code here
} 
```

然后在 ajax 调用中更改成功绑定：

```
success: function (xml) { city_success(xml, cities[ cityIdx ]); }, 
```

# silverlight - 从 Silverlight 中的 UserControl 派生

> ID：400991
> 
> 赞同：3
> 
> 时间：2008-12-30T18:03:15.557
> 
> 标签：silverlight, silverlight-2.0

在 Silverlight 2 中，我有以下控件类声明：

```
public partial class ClassX : UserControl 
```

我希望用派生自 UserControl 的 ClassXBase 替换 UserControl，但我得到了合理的错误“'ClassX' 的部分声明不能指定不同的基类”

但是，我找不到另一个部分类来替换它的基类。知道这个其他部分类在哪里或我是如何做到的吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-31T10:09:19.383

如果包含 UserControl 基类的命名空间，只要使用命名空间即可。例如：

```
public abstract class MyBaseUserControl : UserControl
{
  // ...
} 
```

然后你必须在 XAML 中使用这个类（注意我的命名空间，然后使用新的命名空间作为文档的根）：

```
<!-- Page.xaml -->
<my:BaseUserControl 
    x:Class="SilverlightApplication11.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    xmlns:my="clr-namespace:SilverlightApplication11"
    Width="400" Height="300">
    <Grid x:Name="LayoutRoot" Background="White">

    </Grid>
</my:BaseUserControl> 
```

这不会神奇地更改代码隐藏中的基类，因此将该代码更改为您的基类：

```
public partial class Page : BaseUserControl
{
  public Page()
  {
    InitializeComponent();
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T19:10:45.357

UserControl 的分部类由 XAML 定义，框架期望它派生自 UserControl。你想达到什么目的？使用封装而不是继承可能会更好。如果您必须使用继承，那么从其他类派生您可能会更好地从其他控件类（如 ContentControl 或 Control）派生。Jesse Liberty在[Silverlight.net上](http://silverlight.net)[制作了一系列精彩的视频](http://silverlight.net/learn/learnvideo.aspx?video=116200)。

# c++ - 关于智能指针及其不可避免的不确定性的问题

> ID：400993
> 
> 赞同：16
> 
> 时间：2008-12-30T18:04:16.273
> 
> 标签：c++, shared-ptr, raii, object-lifetime

在过去的两年里，我一直在我的项目中广泛使用智能指针（确切地说是 boost::shared_ptr）。我理解并欣赏他们的好处，而且我通常非常喜欢他们。但是我使用它们的次数越多，我就越想念 C++ 在内存管理和 RAII 方面的确定性行为，而我在编程语言中似乎喜欢这种行为。智能指针简化了内存管理过程并提供了自动垃圾收集等功能，但问题在于，通常使用自动垃圾收集，而智能指针具体会在（去）初始化的顺序上引入某种程度的不确定性。这种不确定性剥夺了程序员的控制权，正如我最近意识到的那样，设计和开发 API 的工作，

为了详细说明，我目前正在开发一个 API。此 API 的某些部分要求某些对象在其他对象之前初始化或在其他对象之后销毁。换句话说，（去）初始化的顺序有时很重要。举一个简单的例子，假设我们有一个名为 System 的类。系统提供了一些基本功能（在我们的示例中为日志记录），并通过智能指针保存了许多子系统。

```
class System {
public:
    boost::shared_ptr< Subsystem > GetSubsystem( unsigned int index ) {
        assert( index < mSubsystems.size() );
        return mSubsystems[ index ];
    }

    void LogMessage( const std::string& message ) {
        std::cout << message << std::endl;
    }

private:
    typedef std::vector< boost::shared_ptr< Subsystem > > SubsystemList;
    SubsystemList mSubsystems;    
};

class Subsystem {
public:
    Subsystem( System* pParentSystem )
         : mpParentSystem( pParentSystem ) {
    }

    ~Subsystem() {
         pParentSubsystem->LogMessage( "Destroying..." );
         // Destroy this subsystem: deallocate memory, release resource, etc.             
    }

    /*
     Other stuff here
    */

private:
    System * pParentSystem; // raw pointer to avoid cycles - can also use weak_ptrs
}; 
```

正如您已经知道的那样，子系统仅在系统的上下文中才有意义。但是这种设计中的子系统很容易比其父系统寿命更长。

```
int main() {
    {
        boost::shared_ptr< Subsystem > pSomeSubsystem;
        {
            boost::shared_ptr< System > pSystem( new System );
            pSomeSubsystem = pSystem->GetSubsystem( /* some index */ );

        } // Our System would go out of scope and be destroyed here, but the Subsystem that pSomeSubsystem points to will not be destroyed.

     } // pSomeSubsystem would go out of scope here but wait a second, how are we going to log messages in Subsystem's destructor?! Its parent System is destroyed after all. BOOM!

    return 0;
} 
```

如果我们使用原始指针来保存子系统，那么当我们的系统出现故障时，我们就会破坏子系统，当然，pSomeSubsystem 将是一个悬空指针。

虽然保护客户端程序员免受自己的伤害不是 API 设计人员的工作，但让 API 易于正确使用和难以错误使用是一个好主意。所以我问你们。你怎么看？我应该如何缓解这个问题？你会如何设计这样一个系统？

在此先感谢，乔希

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-30T22:43:05.570

## 问题总结

这个问题有两个相互竞争的问题。

1.  s 的生命周期管理`Subsystem`，允许它们在正确的时间被移除。
2.  s 的客户`Subsystem`需要知道`Subsystem`他们正在使用的 是有效的。

## 处理#1

`System`拥有`Subsystem`s 并且应该用它自己的范围来管理它们的生命周期。为此使用`shared_ptr`s 特别有用，因为它简化了销毁，但您不应该将它们分发出去，因为这样您就失去了您正在寻求的关于它们的释放的确定性。

## 处理#2

这是需要解决的更有趣的问题。更详细地描述问题，您需要客户端接收一个对象，该对象的行为类似于`Subsystem`while `Subsystem`（它是 parent `System`）存在，但在 a`Subsystem`被销毁后行为适当。

这很容易通过[代理模式](http://en.wikipedia.org/wiki/Proxy_pattern "维基百科：代理模式")、[状态模式](http://en.wikipedia.org/wiki/State_pattern "维基百科：状态模式")和[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern "维基百科：空对象模式")的组合来解决。虽然这似乎是一个有点复杂的解决方案，但“*只有在复杂性的另一面才有简单性*。” 作为库/API 开发人员，我们必须加倍努力以使我们的系统更加健壮。此外，我们希望我们的系统能够按照用户的期望直观地运行，并在他们试图滥用它们时优雅地衰减。这个问题有很多解决方案，但是，这个应该让您达到最重要的一点，正如您和[Scott Meyers](https://rads.stackoverflow.com/amzn/click/com/0321334876 "亚马逊：Scott Meyers 的《Effective C++》")所说，它“*易于正确使用，难以正确使用。* ”

现在，我假设在现实中`System`处理一些`Subsystem`s 的基类，您可以从中派生各种不同`Subsystem`的 s。我在下面介绍了它`SubsystemBase`。您需要在下面引入一个***Proxy***对象，它通过将请求转发到它所代理的对象来`SubsystemProxy`实现接口。`SubsystemBase`（从这个意义上说，它非常像[装饰模式](http://en.wikipedia.org/wiki/Decorator_pattern "维基百科：装饰器模式")的特殊用途应用程序。）每个都`Subsystem`创建这些对象中的一个，它通过 a 持有`shared_ptr`，并在通过请求时返回`GetProxy()`，在调用时由父`System`对象`GetSubsystem()`调用。

当 a`System`超出范围时，它的每个`Subsystem`对象都会被破坏。在他们的析构函数中，他们调用`mProxy->Nullify()`，这会导致他们的***Proxy***对象改变他们的***State***。他们通过更改指向实现接口的***Null Object***`SubsystemBase`来做到这一点，但什么都不做。

在这里使用***状态模式***允许客户端应用程序完全不知道某个特定对象是否`Subsystem`存在。此外，它不需要检查指针或保留本应销毁的实例。

***代理模式***允许客户端依赖于一个轻量级的对象，该对象完全封装了 API 内部工作的细节，并保持了一个恒定的、统一的接口。

***Null Object Pattern***允许***代理***在删除原始对象后运行`Subsystem`。

## 示例代码

我在这里放置了一个粗略的伪代码质量示例，但我对此并不满意。我已经将它重写为我上面描述的一个精确的编译（我使用了 g++）示例。为了让它工作，我不得不介绍一些其他的类，但它们的用途应该从它们的名称中清楚地看出。我在课堂上使用了[单例模式](http://en.wikipedia.org/wiki/Singleton_pattern "维基百科：单例模式")`NullSubsystem`，因为你不需要超过一个是有道理的。 `ProxyableSubsystemBase`完全从 Proxying 中抽象出 Proxying 行为`Subsystem`，使其不知道这种行为。这是类的UML图：

[![子系统和系统层次结构的 UML 图](https://i.stack.imgur.com/5RVNY.png)](https://i.stack.imgur.com/5RVNY.png)

### 示例代码：

```
#include <iostream>
#include <string>
#include <vector>

#include <boost/shared_ptr.hpp>

// Forward Declarations to allow friending
class System;
class ProxyableSubsystemBase;

// Base defining the interface for Subsystems
class SubsystemBase
{
  public:
    // pure virtual functions
    virtual void DoSomething(void) = 0;
    virtual int GetSize(void) = 0;

    virtual ~SubsystemBase() {} // virtual destructor for base class
};

// Null Object Pattern: an object which implements the interface to do nothing.
class NullSubsystem : public SubsystemBase
{
  public:
    // implements pure virtual functions from SubsystemBase to do nothing.
    void DoSomething(void) { }
    int GetSize(void) { return -1; }

    // Singleton Pattern: We only ever need one NullSubsystem, so we'll enforce that
    static NullSubsystem *instance()
    {
      static NullSubsystem singletonInstance;
      return &singletonInstance;
    }

  private:
    NullSubsystem() {}  // private constructor to inforce Singleton Pattern
};

// Proxy Pattern: An object that takes the place of another to provide better
//   control over the uses of that object
class SubsystemProxy : public SubsystemBase
{
  friend class ProxyableSubsystemBase;

  public:
    SubsystemProxy(SubsystemBase *ProxiedSubsystem)
      : mProxied(ProxiedSubsystem)
      {
      }

    // implements pure virtual functions from SubsystemBase to forward to mProxied
    void DoSomething(void) { mProxied->DoSomething(); }
    int  GetSize(void) { return mProxied->GetSize(); }

  protected:
    // State Pattern: the initial state of the SubsystemProxy is to point to a
    //  valid SubsytemBase, which is passed into the constructor.  Calling Nullify()
    //  causes a change in the internal state to point to a NullSubsystem, which allows
    //  the proxy to still perform correctly, despite the Subsystem going out of scope.
    void Nullify()
    {
        mProxied=NullSubsystem::instance();
    }

  private:
      SubsystemBase *mProxied;
};

// A Base for real Subsystems to add the Proxying behavior
class ProxyableSubsystemBase : public SubsystemBase
{
  friend class System;  // Allow system to call our GetProxy() method.

  public:
    ProxyableSubsystemBase()
      : mProxy(new SubsystemProxy(this)) // create our proxy object
    {
    }
    ~ProxyableSubsystemBase()
    {
      mProxy->Nullify(); // inform our proxy object we are going away
    }

  protected:
    boost::shared_ptr<SubsystemProxy> GetProxy() { return mProxy; }

  private:
    boost::shared_ptr<SubsystemProxy> mProxy;
};

// the managing system
class System
{
  public:
    typedef boost::shared_ptr< SubsystemProxy > SubsystemHandle;
    typedef boost::shared_ptr< ProxyableSubsystemBase > SubsystemPtr;

    SubsystemHandle GetSubsystem( unsigned int index )
    {
        assert( index < mSubsystems.size() );
        return mSubsystems[ index ]->GetProxy();
    }

    void LogMessage( const std::string& message )
    {
        std::cout << "  <System>: " << message << std::endl;
    }

    int AddSubsystem( ProxyableSubsystemBase *pSubsystem )
    {
      LogMessage("Adding Subsystem:");
      mSubsystems.push_back(SubsystemPtr(pSubsystem));
      return mSubsystems.size()-1;
    }

    System()
    {
      LogMessage("System is constructing.");
    }

    ~System()
    {
      LogMessage("System is going out of scope.");
    }

  private:
    // have to hold base pointers
    typedef std::vector< boost::shared_ptr<ProxyableSubsystemBase> > SubsystemList;
    SubsystemList mSubsystems;
};

// the actual Subsystem
class Subsystem : public ProxyableSubsystemBase
{
  public:
    Subsystem( System* pParentSystem, const std::string ID )
      : mParentSystem( pParentSystem )
      , mID(ID)
    {
         mParentSystem->LogMessage( "Creating... "+mID );
    }

    ~Subsystem()
    {
         mParentSystem->LogMessage( "Destroying... "+mID );
    }

    // implements pure virtual functions from SubsystemBase
    void DoSomething(void) { mParentSystem->LogMessage( mID + " is DoingSomething (tm)."); }
    int GetSize(void) { return sizeof(Subsystem); }

  private:
    System * mParentSystem; // raw pointer to avoid cycles - can also use weak_ptrs
    std::string mID;
};

//////////////////////////////////////////////////////////////////
// Actual Use Example
int main(int argc, char* argv[])
{

  std::cout << "main(): Creating Handles H1 and H2 for Subsystems. " << std::endl;
  System::SubsystemHandle H1;
  System::SubsystemHandle H2;

  std::cout << "-------------------------------------------" << std::endl;
  {
    std::cout << "  main(): Begin scope for System." << std::endl;
    System mySystem;
    int FrankIndex = mySystem.AddSubsystem(new Subsystem(&mySystem, "Frank"));
    int ErnestIndex = mySystem.AddSubsystem(new Subsystem(&mySystem, "Ernest"));

    std::cout << "  main(): Assigning Subsystems to H1 and H2." << std::endl;
    H1=mySystem.GetSubsystem(FrankIndex);
    H2=mySystem.GetSubsystem(ErnestIndex);

    std::cout << "  main(): Doing something on H1 and H2." << std::endl;
    H1->DoSomething();
    H2->DoSomething();
    std::cout << "  main(): Leaving scope for System." << std::endl;
  }
  std::cout << "-------------------------------------------" << std::endl;
  std::cout << "main(): Doing something on H1 and H2\. (outside System Scope.) " << std::endl;
  H1->DoSomething();
  H2->DoSomething();
  std::cout << "main(): No errors from using handles to out of scope Subsystems because of Proxy to Null Object." << std::endl;

  return 0;
} 
```

## 代码输出：

```
main(): Creating Handles H1 and H2 for Subsystems.
-------------------------------------------
  main(): Begin scope for System.
  <System>: System is constructing.
  <System>: Creating... Frank
  <System>: Adding Subsystem:
  <System>: Creating... Ernest
  <System>: Adding Subsystem:
  main(): Assigning Subsystems to H1 and H2.
  main(): Doing something on H1 and H2.
  <System>: Frank is DoingSomething (tm).
  <System>: Ernest is DoingSomething (tm).
  main(): Leaving scope for System.
  <System>: System is going out of scope.
  <System>: Destroying... Frank
  <System>: Destroying... Ernest
-------------------------------------------
main(): Doing something on H1 and H2\. (outside System Scope.)
main(): No errors from using handles to out of scope Subsystems because of Proxy to Null Object. 
```

## 其他想法：

*   我在一本 Game Programming Gems 书籍中读到的一篇有趣的文章谈到了使用 Null 对象进行调试和开发。他们专门讨论了使用 Null 图形模型和纹理，例如棋盘纹理，以使缺失的模型真正脱颖而出。通过更改 for a 可以在此处应用相同的方法，该`NullSubsystem`for a`ReportingSubsystem`将记录调用，并可能在访问时记录调用堆栈。这将允许您或您的图书馆的客户根据超出范围的内容追踪他们所在的位置，但无需导致崩溃。

*   我在@Arkadiy 的评论中提到，他在两者之间提出的循环依赖`System`有点`Subsystem`令人不快。它可以很容易地通过`System`从依赖的接口派生来解决，这`Subsystem`是 Robert C Martin 的[依赖倒置原则](http://en.wikipedia.org/wiki/Dependency_inversion_principle "维基百科：依赖倒置原则")的应用。更好的办法是将`Subsystem`s 需要的功能与其父级隔离，为此编写一个接口，然后保留该接口的实现者`System`并将其传递给`Subsystem`s，后者将通过 a 保存它`shared_ptr`。例如，您可能有`LoggerInterface`用于`Subsystem`写入日志的 ，然后您可以从它派生`CoutLogger`或`FileLogger`从它派生，并在 中保留这样的实例`System`。
    [![消除循环依赖](https://i.stack.imgur.com/Kq0HX.png)](https://i.stack.imgur.com/Kq0HX.png)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-30T18:52:18.907

这可以通过正确使用`weak_ptr`该类来实现。事实上，您已经非常接近找到一个好的解决方案了。你是对的，你不能期望你“超越”​​你的客户程序员，也不应该期望他们总是遵循你的 API 的“规则”（我相信你已经知道了）。所以，你真正能做的最好的就是损害控制。

我建议您调用`GetSubsystem`返回 a`weak_ptr`而不是`shared_ptr`简单地返回 a ，以便客户端开发人员可以测试指针的有效性，而不必总是声称对它的引用。

同样， have`pParentSystem`是 a以便它可以通过调用on以及检查`boost::weak_ptr<System>`来内部检测其父级是否仍然存在（原始指针不会告诉您这一点）。`System``lock``pParentSystem``NULL`

假设您更改您的`Subsystem`类以始终检查其对应的`System`对象是否存在，您可以确保如果客户端程序员尝试`Subsystem`在预期范围之外使用该对象，则会导致错误（由您控制​​），而不是莫名其妙的异常（您必须信任客户端程序员来捕获/正确处理）。

所以，在你的例子中`main()`，事情不会繁荣！在 dtor 中处理这个问题的最优雅的方法`Subsystem`是让它看起来像这样：

```
class Subsystem
{
...
  ~Subsystem() {
       boost::shared_ptr<System> my_system(pParentSystem.lock());

       if (NULL != my_system.get()) {  // only works if pParentSystem refers to a valid System object
         // now you are guaranteed this will work, since a reference is held to the System object
         my_system->LogMessage( "Destroying..." );
       }
       // Destroy this subsystem: deallocate memory, release resource, etc.             

       // when my_system goes out of scope, this may cause the associated System object to be destroyed as well (if it holds the last reference)
  }
...
}; 
```

我希望这有帮助！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T18:22:45.953

这里 System 显然拥有子系统，我认为共享所有权没有意义。我会简单地返回一个原始指针。如果一个子系统比它的系统寿命长，这本身就是一个错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-08-05T13:23:51.847

你在第一段的开头是对的。您基于 RAII 的设计（如我的和大多数编写良好的 C++ 代码）要求您的对象由独占所有权指针持有。在 Boost 中，这将是 scoped_ptr。

那么你为什么不使用 scoped_ptr。这肯定是因为您希望使用weak_ptr 的好处来防止悬空引用，但您只能将weak_ptr 指向shared_ptr。因此，当您真正想要的是单一所有权时，您已经采用了方便地声明 shared_ptr 的常见做法。这是一个错误的声明，正如您所说，它损害了以正确顺序调用的析构函数。当然，如果您从不共享所有权，您将侥幸逃脱 - 但您必须不断检查您的所有代码以确保它从未被共享。

更糟糕的是 boost::weak_ptr 使用起来很不方便（它没有 -> 运算符），因此程序员通过错误地将被动观察引用声明为 shared_ptr 来避免这种不便。这当然共享所有权，如果您忘记将 shared_ptr 设为空，那么您的对象将不会被销毁，也不会在您打算这样做时调用其析构函数。

简而言之，您已经被 boost 库所困扰——它没有接受良好的 C++ 编程实践，并迫使程序员做出错误的声明以尝试从中获得一些好处。它仅适用于编写真正想要共享所有权并且对严格控制内存或以正确顺序调用析构函数不感兴趣的胶水代码。

我和你走的路一样。C++ 中迫切需要对悬空指针的保护，但 boost 库没有提供可接受的解决方案。我必须解决这个问题——我的软件部门想要保证 C++ 可以安全。所以我推出了自己的 - 这是相当多的工作，可以在以下位置找到：

[http://www.codeproject.com/KB/cpp/XONOR.aspx](http://www.codeproject.com/KB/cpp/XONOR.aspx)

它完全适合单线程工作，我将对其进行更新以包含跨线程共享的指针。它的主要特点是它支持专有对象的智能（自归零）被动观察者。

不幸的是，程序员已经被垃圾收集和“一刀切”的智能指针解决方案所吸引，并且在很大程度上甚至没有考虑所有权和被动观察者 - 结果他们甚至不知道他们所做的事情是错误的并且不要不要抱怨。针对 Boost 的异端几乎闻所未闻！

向您建议的解决方案非常复杂且毫无帮助。它们是由于文化上不愿承认对象指针具有必须正确声明的不同角色以及盲目相信 Boost 必须是解决方案而导致的荒谬示例。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T18:17:52.610

我认为让 System::GetSubsystem 将原始指针（而不是智能指针）返回给子系统没有问题。由于客户端不负责构造对象，因此没有隐含的合同让客户端负责清理。并且由于它是一个内部引用，因此假设 Subsystem 对象的生命周期取决于 System 对象的生命周期应该是合理的。然后，您应该使用说明该内容的文档来加强此隐含合同。

关键是，您没有重新分配或共享所有权 - 那么为什么要使用智能指针呢？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-30T03:33:25.923

这里真正的问题是你的设计。没有好的解决方案，因为模型没有反映好的设计原则。这是我使用的一个方便的经验法则：

*   如果一个对象包含其他对象的集合，并且可以从该集合返回任意对象，**则从您的设计中删除该对象**。

我意识到您的示例是人为的，但我在工作中看到了很多反模式。问问自己，`System`添加没有的价值是什么`std::vector< shared_ptr<SubSystem> >`？您的 API 的用户需要知道`SubSystem`（因为您返回他们）的接口，所以为他们编写一个持有者只会增加复杂性。至少人们知道界面来`std::vector`，强迫他们记住`GetSubsystem()`上面`at()`或者`operator[]`只是*卑鄙*的。

你的问题是关于管理对象的生命周期，但是一旦你开始分发对象，你要么失去对生命周期的控制，要么让其他人让它们保持活动状态`shared_ptr`（在多线程应用程序中，情况更糟——谁将您分发给不同线程的对象锁定？当以这种方式使用时，提升共享指针和弱指针是一个复杂性诱导陷阱，特别是因为它们只是线程安全的，足以绊倒没有经验的开发人员。

如果您要创建一个持有者，它需要向您的用户隐藏复杂性并减轻他们可以自己管理的负担。例如，一个接口包括 a) 向子系统发送命令（例如 URI - /system/subsystem/command?param=value）和 b) 迭代子系统和子系统命令（通过类似 stl 的迭代器）和可能的 c) register 子系统将允许您向用户隐藏几乎所有实现细节，并在内部强制执行生命周期/排序/锁定要求。

在任何情况下，可迭代/可枚举的 API 都比公开对象更可取——命令/注册可以很容易地序列化以生成测试用例或配置文件，并且它们可以交互显示（例如，在树控件中，对话框由查询组成可用的操作/参数）。您还将保护您的 API 用户免受您可能需要对子系统类进行的内部更改。

我会提醒您不要遵循 Aarons answer 中的建议。为一个需要 5 种不同设计模式来实现的简单问题设计解决方案只能意味着解决了错误的问题。我也厌倦了任何人引用迈尔斯先生的设计，因为他自己承认：

“我已经 20 多年没有写过生产软件了，我也从来没有用 C++ 写过生产软件。不，从来没有。此外，我什至从未尝试过用 C++ 编写生产软件，所以我不仅不是真正的C++ 开发人员，我什至不是一个想要的人。稍微平衡一点的事实是，我在研究生期间（1985-1993 年）确实用 C++ 编写了研究软件，但即使这样也只是一个小开发人员（几千行）很快就被扔掉的东西。自从十几年前作为顾问脱颖而出以来，我的 C++ 编程一直仅限于玩具“让我们看看它是如何工作的”（或者，有时，“让我们看看有多少编译器这会破坏“）程序，通常是适合单个文件的程序”。

并不是说他的书不值得一读，但他没有权力谈论设计或复杂性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T18:16:33.737

在您的示例中，如果 System 持有 a`vector<Subsystem>`而不是 a会更好`vector<shared_ptr<Subsystem> >`。它既简单又消除了您的顾虑。GetSubsystem 将返回一个引用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-31T00:43:36.730

堆栈对象将以与实例化相反的顺序释放，因此除非使用 API 的开发人员试图管理智能指针，否则通常不会有问题。有一些事情是你无法阻止的，你能做的最好的就是在运行时提供警告，最好只调试。

您的示例对我来说似乎非常像 COM，您对使用 shared_ptr 返回的子系统进行了引用计数，但是您在系统对象本身上缺少它。

如果每个子系统对象在创建时对系统对象执行了 addref，并在销毁时释放，那么如果在系统对象提前销毁时引用计数不正确，您至少可以显示异常。

使用weak_ptr 还可以让您提供一条消息而不是/以及当事情以错误的顺序释放时爆炸。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-31T14:53:38.857

您的问题的本质是循环引用：System 指的是 Subsystem，而 Subsystem 又指的是 System。这种数据结构不能通过引用计数轻松处理——它需要适当的垃圾收集。您试图通过对其中一条边使用原始指针来打破循环 - 这只会产生更多的复杂性。

至少已经提出了两个好的解决方案，所以我不会试图超越以前的海报。我只能注意到，在@Aaron 的解决方案中，您可以拥有系统的代理而不是子系统的代理 - 取决于更复杂的和有意义的。

# java - Java：处理组合键盘输入

> ID：400994
> 
> 赞同：5
> 
> 时间：2008-12-30T18:04:41.577
> 
> 标签：java, event-handling, keyboard

在注册在 JButton 后面的 KeyListener`F1`和 ie `CTRL`+`F1`各自的`SHIFT`- `CTRL`+之间分开的正确方法是什么？`F1`

```
public void keyPressed(KeyEvent event) {
    int key = event.getKeyCode();

    logger.debug("KeyBoard pressed char(" + event.getKeyChar() + ") code (" + key + ")");
} 
```

.. 总是给我 112 `F1`， 113`F2`等等。我知道我可以自己处理 keyPressed() 来处理 keyReleased for `CTRL`// `SHIFT`/`ALT`等，但我希望有更好的方法。

非常感谢！！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T18:13:57.843

解决方案在于 KeyEvent 的父级（InputEvent）

1.  使用 isAltDown、isControlDown、isShiftDown 方法或
2.  使用 getModifiers 方法

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T18:16:04.767

由于 KeyEvent 扩展了 InputEvent、[isControlDown](http://java.sun.com/javase/6/docs/api/java/awt/event/InputEvent.html#isControlDown())、[isShiftDown](http://java.sun.com/javase/6/docs/api/java/awt/event/InputEvent.html#isShiftDown())和[isAltDown](http://java.sun.com/javase/6/docs/api/java/awt/event/InputEvent.html#isAltDown())。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T19:26:40.193

`KeyEvent`s 在处理 Swing 小部件时可能有点低级。而是通过`InputMap`and `ActionMap`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T18:22:44.863

显然，只要按键按下，就会调用按键按下事件。它不是一个多键按下事件，也没有这样的事情，所以没有多键按下的键码。

您只需要使用一个变量来跟踪按下的 crtl 键。这意味着您还必须使用按键向上事件来跟踪控制键何时被释放。

在 pusdo 代码中：

```
// CRTLKeyCode是 ctrl 键的代码
私人布尔 ctrlPressed = false;

 onKeyDown(KeyEvent 事件){
     int key = event.getKeyCode();
     如果（键 == CRTLKeyCode）
        ctrlPressed =真；
     否则 if(ctrlPressed && key == 112)
        //执行你的动作
 }
 onKeyUp(KeyEvent 事件){
     int key = event.getKeyCode();
     如果（键 == CRTLKeyCode）
        ctrlPressed = 假；
 }

```

# redirect - Apache2 中的 URL 重定向

> ID：400997
> 
> 赞同：1
> 
> 时间：2008-12-30T18:05:25.223
> 
> 标签：redirect, apache2, sysadmin

试图将我 LAN 上的一个网络服务器上的 URL 重定向到我 LAN 上的另一个网络服务器。我假设我需要的只是 /var/www 目录中的 .htaccess 文件，其内容仅为以下 3 行：

选项 +FollowSymLinks

重写引擎开启

RewriteMatch newsite\.level2\.level1\.com [http://192.168.0.250:8080](http://192.168.0.250:8080)

我还在文件夹 /etc/apache2/mods-enabled 中创建了一个符号链接到 /etc/apache2/mods-available/rewrite.load

第一个：当我在浏览器中输入“newsite.level2.level1.com”时，我最终进入“level2.level1.com” 第二个：RewriteMatch 是否支持附加到新 URL 的端口

应该提到 level2.level1.com 是通过 DynDns.org 因为我有 Comcast 并且启用了允许 *.level2.level1.com 的功能

感谢您的关注，丰富

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T04:01:57.547

重写规则适用于 URL 的路径部分，而不是主机部分。`<VirtualHost>`您可以通过将重写规则放在适当的容器中来控制匹配的主机部分。

您可以重定向到另一台主机，但您拥有的规则永远不会匹配。

如果要重定向所有请求，请尝试类似

```
 RewriteEngine On
  RewriteMatch .* http://192.168.0.250:8080/ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T01:18:22.027

您可以为此使用 mod_proxy：

```
ProxyPass / http://192.168.0.250:8080/
ProxyPassReverse / http://192.168.0.250:8080/ 
```********************