# StackOverflow 问答 000163000-000163999

# mysql - MySQL 查询：限制 JOIN

> ID：163004
> 
> 赞同：5
> 
> 时间：2008-10-02T15:25:58.817
> 
> 标签：mysql, sql, join, greatest-n-per-group

假设我有两个要加入的表。分类：

```
id   name
----------
1    Cars
2    Games
3    Pencils 
```

和项目：

```
id   categoryid   itemname
---------------------------
1    1            Ford
2    1            BMW
3    1            VW
4    2            Tetris
5    2            Pong
6    3            Foobar Pencil Factory 
```

我想要一个返回类别和第一个（并且只有第一个）项目名称的查询：

```
category.id category.name item.id item.itemname
-------------------------------------------------
1           Cars          1       Ford
2           Games         4       Tetris
3           Pencils       6       Foobar Pencil Factory 
```

有没有办法我可以获得随机结果，例如：

```
category.id category.name item.id item.itemname
-------------------------------------------------
1           Cars          3       VW
2           Games         5       Pong
3           Pencils       6       Foobar Pencil Factory 
```

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T15:42:24.673

刚刚做了一个快速测试。这似乎有效：

```
mysql> select * from categories c, items i
    -> where i.categoryid = c.id
    -> group by c.id;
+------+---------+------+------------+----------------+
| id   | name    | id   | categoryid | name           |
+------+---------+------+------------+----------------+
|    1 | Cars    |    1 |          1 | Ford           |
|    2 | Games   |    4 |          2 | Tetris         |
|    3 | Pencils |    6 |          3 | Pencil Factory |
+------+---------+------+------------+----------------+
3 rows in set (0.00 sec) 
```

我认为这将满足您的第一个问题。不确定第二个 - 我认为这需要一个带有 random() 顺序的内部查询或类似的东西！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T15:36:47.323

Mysql 允许您拥有不包含在分组或聚合中的列，在这种情况下，它们有随机值：

```
 select category.id, category.name, itemid, itemname
    inner join 
      (select item.categoryid, item.id as itemid, item.name as itemname
       from item group by categoryid)
    on category.id = categoryid 
```

或者，至少，

```
select category.id, category.name, itemid, itemname
inner join 
  (select item.categoryid, min(item.id) as itemid, item.name as itemname
  from items
  group by item.categoryid)
on category.id = categoryid 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:19:52.840

Mysql 确实让包含非聚合列并且不能保证确定性，但根据我的经验，我几乎总是得到第一个值。

所以通常（但不能保证）这会给你第一个

```
select * 
from categories c, items i
where i.categoryid = c.id
group by c.id; 
```

如果你想保证，你需要做类似的事情

```
select categories.id, categories.name, items.id, items.name
from categories inner join
  items on items.categoryid = categories.id and 
     items.id = (select min(items2.id) from items as items2 where items2.categoryid = category.id) 
```

如果您想要随机答案，则必须稍微更改子查询

```
 select categories.id, categories.name, items.id, items.name
    from categories inner join
      items on items.categoryid = categories.id and 
         items.id = (select items2.id from items as items2 where items2.categoryid = category.id order by rand() limit 1) 
```

# python - urllib2 文件名

> ID：163009
> 
> 赞同：31
> 
> 时间：2008-10-02T15:27:04.553
> 
> 标签：python, url, urllib2

如果我使用 urllib2 打开一个文件，如下所示：

```
remotefile = urllib2.urlopen('http://example.com/somefile.zip') 
```

除了解析原始 URL 之外，是否有一种简单的方法来获取文件名？

编辑：将 openfile 更改为 urlopen ...不知道这是怎么发生的。

EDIT2：我最终使用：

```
filename = url.split('/')[-1].split('#')[0].split('?')[0] 
```

除非我弄错了，否则这也应该排除所有潜在的查询。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-02T15:43:12.970

你的意思是[urllib2.urlopen](http://www.python.org/doc/2.5.2/lib/module-urllib2.html#l2h-3928)吗？

*如果*服务器通过检查发送 Content-Disposition 标头，您可能会提升*预期*的文件名，但我认为您只需要解析 url。*`remotefile.info()['Content-Disposition']`*

 *您可以使用`urlparse.urlsplit`，但如果您有第二个示例中的任何 URL，则无论如何您最终都必须自己提取文件名：

```
>>> urlparse.urlsplit('http://example.com/somefile.zip')
('http', 'example.com', '/somefile.zip', '', '')
>>> urlparse.urlsplit('http://example.com/somedir/somefile.zip')
('http', 'example.com', '/somedir/somefile.zip', '', '') 
```

不妨这样做：

```
>>> 'http://example.com/somefile.zip'.split('/')[-1]
'somefile.zip'
>>> 'http://example.com/somedir/somefile.zip'.split('/')[-1]
'somefile.zip' 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-02T16:06:16.720

如果您只想要文件名本身，假设末尾没有查询变量，例如[http://example.com/somedir/somefile.zip?foo=bar](http://example.com/somedir/somefile.zip?foo=bar)那么您可以使用 os.path.basename ：

```
[user@host]$ python
Python 2.5.1 (r251:54869, Apr 18 2007, 22:08:04) 
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> os.path.basename("http://example.com/somefile.zip")
'somefile.zip'
>>> os.path.basename("http://example.com/somedir/somefile.zip")
'somefile.zip'
>>> os.path.basename("http://example.com/somedir/somefile.zip?foo=bar")
'somefile.zip?foo=bar' 
```

使用 urlparse 提到的其他一些海报，这将起作用，但您仍然需要从文件名中删除前导目录。如果您使用 os.path.basename() 则不必担心，因为它只返回 URL 或文件路径的最后部分。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-02T15:43:10.130

我认为当涉及到 http 传输时，“文件名”不是一个很好定义的概念。服务器可能（但不是必须）提供一个作为“内容处置”标头，您可以尝试使用`remotefile.headers['Content-Disposition']`. 如果失败，您可能必须自己解析 URI。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-03-20T18:38:47.497

刚看到这个我通常做的..

```
filename = url.split("?")[0].split("/")[-1] 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-03-31T20:05:36.643

使用`urlsplit`是最安全的选择：

```
url = 'http://example.com/somefile.zip'
urlparse.urlsplit(url).path.split('/')[-1] 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-02T15:42:59.867

你的意思是`urllib2.urlopen`？`openfile`模块中没有调用函数`urllib2`。

无论如何，使用以下`urllib2.urlparse`功能：

```
>>> from urllib2 import urlparse
>>> print urlparse.urlsplit('http://example.com/somefile.zip')
('http', 'example.com', '/somefile.zip', '', '') 
```

瞧。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-05-11T06:15:24.877

该`os.path.basename`函数不仅适用于文件路径，还适用于 url，因此您不必自己手动解析 URL。此外，请务必注意，您应该使用`result.url`而不是原始 url 来跟踪重定向响应：

```
import os
import urllib2
result = urllib2.urlopen(url)
real_url = urllib2.urlparse.urlparse(result.url)
filename = os.path.basename(real_url.path) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-28T14:41:39.770

您还可以将两个评价最高的答案结合起来：使用 urllib2.urlparse.urlsplit() 获取 URL 的路径部分，然后使用 os.path.basename 获取实际文件名。

完整的代码是：

```
>>> remotefile=urllib2.urlopen(url)
>>> try:
>>>   filename=remotefile.info()['Content-Disposition']
>>> except KeyError:
>>>   filename=os.path.basename(urllib2.urlparse.urlsplit(url).path) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T15:45:47.147

我想这取决于你所说的解析的意思。如果不解析 URL，就无法获取文件名，即远程服务器不给您文件名。但是，您不必自己做太多事情，有以下`urlparse`模块：

```
In [9]: urlparse.urlparse('http://example.com/somefile.zip')
Out[9]: ('http', 'example.com', '/somefile.zip', '', '', '') 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-02T15:46:49.670

从来没听说过。

但你可以像这样简单地解析它：

```
``url = 'http://example.com/somefile.zip'` print url.split('/')[-1]` 
```

* * *

 `## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T15:45:48.580

```
import os,urllib2
resp = urllib2.urlopen('http://www.example.com/index.html')
my_url = resp.geturl()

os.path.split(my_url)[1]

# 'index.html' 
```

这不是openfile，但可能仍然有帮助:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-26T20:54:44.823

使用请求，但您可以使用 urllib(2) 轻松完成

```
import requests
from urllib import unquote
from urlparse import urlparse

sample = requests.get(url)

if sample.status_code == 200:
    #has_key not work here, and this help avoid problem with names

    if filename == False:

        if 'content-disposition' in sample.headers.keys():
            filename = sample.headers['content-disposition'].split('filename=')[-1].replace('"','').replace(';','')

        else:

            filename = urlparse(sample.url).query.split('/')[-1].split('=')[-1].split('&')[-1]

            if not filename:

                if url.split('/')[-1] != '':
                    filename = sample.url.split('/')[-1].split('=')[-1].split('&')[-1]
                    filename = unquote(filename) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-09-10T22:31:37.437

您可能可以在这里使用简单的正则表达式。就像是：

```
In [26]: import re
In [27]: pat = re.compile('.+[\/\?#=]([\w-]+\.[\w-]+(?:\.[\w-]+)?$)')
In [28]: test_set 

['http://www.google.com/a341.tar.gz',
 'http://www.google.com/a341.gz',
 'http://www.google.com/asdasd/aadssd.gz',
 'http://www.google.com/asdasd?aadssd.gz',
 'http://www.google.com/asdasd#blah.gz',
 'http://www.google.com/asdasd?filename=xxxbl.gz']

In [30]: for url in test_set:
   ....:     match = pat.match(url)
   ....:     if match and match.groups():
   ....:         print(match.groups()[0])
   ....:         

a341.tar.gz
a341.gz
aadssd.gz
aadssd.gz
blah.gz
xxxbl.gz 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-04-11T19:28:35.967

使用不依赖于操作系统并优雅处理 url 的[PurePosixPath是 Pythonic 解决方案：](https://docs.python.org/3/library/pathlib.html#pathlib.PurePosixPath)

```
>>> from pathlib import PurePosixPath
>>> path = PurePosixPath('http://example.com/somefile.zip')
>>> path.name
'somefile.zip'
>>> path = PurePosixPath('http://example.com/nested/somefile.zip')
>>> path.name
'somefile.zip' 
```

请注意这里没有网络流量或任何东西（即那些 url 不会去任何地方） - 只需使用标准解析规则。

# javascript - 我在哪里可以找到免费的内容托管？

> ID：163021
> 
> 赞同：5
> 
> 时间：2008-10-02T15:29:33.907
> 
> 标签：javascript, hosting, cdn, content-delivery-network

是否有免费的 Javascript 托管服务？最近 google 一直在托管 jQuery 等……而 Yahoo 托管的是 YUI，这很棒，但如果有可以托管用户脚本之类的服务会更好。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T15:34:06.207

您可以将 Google AppEngine 转换为您自己的 CDN。这肯定会给你你正在寻找的效果。

[http://www.coderjournal.com/2008/06/turn-google-app-engine-into-a-content-delivery-network-cdn/](http://www.coderjournal.com/2008/06/turn-google-app-engine-into-a-content-delivery-network-cdn/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-19T09:16:36.260

我发现了另一个很棒的免费 javascript 文件托管。www.yourjavascript.com 他们有一个很好的功能来访问特定域的文件。

# .net - .NET 中的高分辨率计时器

> ID：163022
> 
> 赞同：34
> 
> 时间：2008-10-02T15:30:14.157
> 
> 标签：.net, profiling, timer

我想对我的代码进行一些基本的分析，但发现 C# 中的 DateTime.Now 只有大约 16 毫秒的分辨率。我还没有找到更好的计时结构。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-10-02T15:43:21.643

这是一个用于计时操作的示例代码：

```
Dim sw As New Stopwatch()
sw.Start()
//Insert Code To Time
sw.Stop()
Dim ms As Long = sw.ElapsedMilliseconds
Console.WriteLine("Total Seconds Elapsed: " & ms / 1000) 
```

编辑：

巧妙的是，它也可以恢复。

```
Stopwatch sw = new Stopwatch();
foreach(MyStuff stuff in _listOfMyStuff)
{
    sw.Start();
    stuff.DoCoolCalculation();
    sw.Stop();
}
Console.WriteLine("Total calculation time: {0}", sw.Elapsed); 
```

[System.Diagnostics.Stopwatch](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)类将使用高分辨率计数器（如果您的系统上有可用的计数器）。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-02T15:31:12.593

System.Diagnostics.StopWatch 类非常适合进行分析。

如果您不想编写自己的测量函数，这里是[Vance Morrison 的代码计时器博客的链接。](http://blogs.msdn.com/vancem/archive/2006/09/21/765648.aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-02T15:48:37.467

对于最高分辨率的性能计数器，您可以使用底层的 win32 性能计数器。

添加以下 P/Invoke 信号：

```
[System.Runtime.InteropServices.DllImport("Kernel32.dll")]
public static extern bool QueryPerformanceCounter(out long perfcount);

[System.Runtime.InteropServices.DllImport("Kernel32.dll")]
public static extern bool QueryPerformanceFrequency(out long freq); 
```

并使用以下方式调用他们：

```
#region Query Performance Counter
/// <summary>
/// Gets the current 'Ticks' on the performance counter
/// </summary>
/// <returns>Long indicating the number of ticks on the performance counter</returns>
public static long QueryPerformanceCounter()
{
    long perfcount;
    QueryPerformanceCounter(out perfcount);
    return perfcount;
}
#endregion

#region Query Performance Frequency
/// <summary>
/// Gets the number of performance counter ticks that occur every second
/// </summary>
/// <returns>The number of performance counter ticks that occur every second</returns>
public static long QueryPerformanceFrequency()
{
    long freq;
    QueryPerformanceFrequency(out freq);
    return freq;
}
#endregion 
```

将其全部转储到一个简单的类中，您就可以开始了。示例（假设类名为 PerformanceCounters）：

```
long startCount = PerformanceCounter.QueryPerformanceCounter();
// DoStuff();
long stopCount = PerformanceCounter.QueryPerformanceCounter();
long elapsedCount = stopCount - startCount;
double elapsedSeconds = (double)elapsedCount / PerformanceCounter.QueryPerformanceFrequency();
MessageBox.Show(String.Format("Took {0} Seconds", Math.Round(elapsedSeconds, 6).ToString())); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T15:42:31.070

您可以调用 Windows 中的高分辨率性能计数器。函数名称为 kernel32.dll 中的 QueryPerformanceCounter。

导入 C# 的语法：

```
[DllImport("Kernel32.dll")]
private static extern bool QueryPerformanceCounter(out long lpPerformanceCount); 
```

Windows 调用的语法：

```
BOOL QueryPerformanceCounter(      
    LARGE_INTEGER *lpPerformanceCount
); 
```

[查询性能计数器@MSDN](http://msdn.microsoft.com/en-us/library/ms644904.aspx)

# c++ - 如何检测我是否正在为 C++ 中的 64 位架构进行编译

> ID：163058
> 
> 赞同：26
> 
> 时间：2008-10-02T15:37:32.937
> 
> 标签：c++, 64-bit, c-preprocessor

在 C++ 函数中，如果它正在为 64 位架构编译，我需要编译器选择不同的块。

我知道为 MSVC++ 和 g++ 做的一种方法，所以我会把它作为答案发布。但是我想知道是否有更好的方法（更优雅，适用于所有编译器/所有 64 位架构）。如果没有更好的方法，我应该寻找哪些其他预定义宏才能与其他编译器/架构兼容？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2015-09-22T12:39:30.757

在 C 和 C++ 中检测 32 位和 64 位构建的独立于体系结构的方法如下所示：

```
// C
#include <stdint.h>

// C++
#include <cstdint>

#if INTPTR_MAX == INT64_MAX
// 64-bit
#elif INTPTR_MAX == INT32_MAX
// 32-bit
#else
#error Unknown pointer size or missing size macros!
#endif 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-02T15:38:27.083

这适用于 MSVC++ 和`g++`：

```
#if defined(_M_X64) || defined(__amd64__)
  // code...
#endif 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-15T17:05:55.670

你为什么选择一个街区而不是另一个街区？如果您的决定是基于指针的大小，请使用`sizeof(void*) == 8`. 如果您的决定是基于整数的大小，请使用`sizeof(int) == 8`.

我的观点是架构本身的名称应该很少有任何区别。你只检查你需要检查的，为了你要做的事情。您的问题并没有很清楚地说明您检查的目的是什么。您所问的类似于尝试通过查询 Windows 版本来确定是否安装了 DirectX。您可以使用更多可移植和通用的工具。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-02T15:47:43.647

雷蒙德[涵盖了这一点](http://blogs.msdn.com/oldnewthing/archive/2006/09/06/742710.aspx)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T19:05:48.973

如果你正在为 Windows 平台编译，你应该使用：

```
#ifdef _WIN64 
```

MSVC 编译器为 x64 和 ia64 平台定义了这一点（您不想切断这个市场，是吗？）。我不确定 gcc 是否也这样做 - 但如果没有，它应该这样做。

另一种选择是

```
#ifdef WIN64 
```

这有一个微妙的区别。WIN64（不带前导下划线）由 SDK（或构建配置）定义。由于这是由 SDK/build 配置定义的，它应该与 gcc 一样工作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-06T23:28:38.263

```
#ifdef _LP64 
```

适用于两个平台

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T16:14:52.597

这是 Mac OS X 的一个很好的概述：

[http://developer.apple.com/documentation/Darwin/Conceptual/64bitPorting](http://developer.apple.com/documentation/Darwin/Conceptual/64bitPorting)

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2012-04-14T06:07:54.493

如果您使用 Windows，最好从注册表中获取“PROCESSOR_ARCHITECTURE”环境变量，因为如果它是在 64 位操作系统（又名 WOW64）上运行的 32 位进程，则 sizeof(PVOID) 将等于 4：

```
 if (RegOpenKeyEx(HKEY_LOCAL_MACHINE, _T("SYSTEM\CurrentControlSet\\Control\\Session Manager\\Environment"), 0, KEY_READ, &hKey) == ERROR_SUCCESS) {
        LPSTR szArch = new CHAR[100];

        ZeroMemory(szArch, 100);

        if (RegQueryValueEx(hKey, _T("PROCESSOR_ARCHITECTURE"), NULL, NULL, (LPBYTE)szArch, &dwSize) == ERROR_SUCCESS) {
            if (strcmp(szArch, "AMD64") == 0)
                this->nArchitecture = 64;
            else
                this->nArchitecture = 32;
        } else {
            this->nArchitecture = (sizeof(PVOID) == 4 ? 32 : 64);
        }

        RegCloseKey(hKey);
    } 
```

# oop - 耦合、内聚和得墨忒耳定律

> ID：163071
> 
> 赞同：69
> 
> 时间：2008-10-02T15:40:11.417
> 
> 标签：oop, refactoring, coupling, law-of-demeter, cohesion

得[墨忒耳法则](http://en.wikipedia.org/wiki/Law_of_Demeter)表明你应该只与你直接知道的物体交谈。也就是说，不要执行方法链接来与其他对象对话。当您这样做时，您正在与中间对象建立不正确的链接，将您的代码不恰当地[耦合](http://en.wikipedia.org/wiki/Coupling_(computer_science))到其他代码。

那很糟。

解决方案是让您知道的类本质上公开简单的包装器，将责任委托给与之有关系的对象。

那挺好的。

但是，这似乎导致班级[凝聚力](http://en.wikipedia.org/wiki/Cohesion_(computer_science))低。它不再只是简单地负责它所做的事情，而且它还具有某种意义上的委托，通过复制其相关对象的接口部分来降低代码的内聚性。

那很糟。

真的会降低凝聚力吗？是两害相权取其轻吗？

这是发展的灰色地带之一，您可以在其中讨论界限在哪里，或者是否有强有力的、有原则的方法来决定在哪里划定界限以及您可以使用什么标准来做出决定？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-03T05:47:55.263

Grady Booch 在“面向对象的分析与设计”中：

“内聚的概念也来自结构化设计。简单地说，内聚衡量的是单个模块的元素之间的连接程度（对于面向对象的设计，是单个类或对象）。最不理想的内聚形式是巧合内聚，其中完全不相关的抽象被放入同一个类或模块中。例如，考虑一个由狗和航天器的抽象组成的类，它们的行为是完全不相关的。内聚最理想的形式是功能内聚，其中元素“

Subsitute Dog with Customer in the above and it might be a bit clearer. So the goal is really just to aim for functional cohesion and to move away from coincidental cohesion as much as possible. Depending on your abstractions, this may be simple or could require some refactoring.

Note cohesion applies just as much to a "module" than to a single class, ie a group of classes working together. So in this case the Customer and Order classes still have decent cohesion because they have this strong relationshhip, customers create orders, orders belong to customers.

Martin Fowler says he'd be more comfortable calling it the "Suggestion of Demeter" (see the article [Mocks aren't stubs](http://martinfowler.com/articles/mocksArentStubs.html)):

"Mockist testers do talk more about avoiding 'train wrecks' - method chains of style of getThis().getThat().getTheOther(). Avoiding method chains is also known as following the Law of Demeter. While method chains are a smell, the opposite problem of middle men objects bloated with forwarding methods is also a smell. (I've always felt I'd be more comfortable with the Law of Demeter if it were called the **Suggestion of Demeter** .)"

That sums up nicely where I'm coming from: it is perfectly acceptable and often necessary to have a lower level of cohesion than the strict adherence to the "law" might require. Avoid coincidental cohesion and aim for functional cohesion, but don't get hung up on tweaking where needed to fit in more naturally with your design abstraction.

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-02T15:53:01.760

如果你违反了得墨忒耳法则

```
int price = customer.getOrder().getPrice(); 
```

解决方案不是创建一个 getOrderPrice() 并将代码转换为

```
int price = customer.getOrderPrice(); 
```

但要注意这是[代码异味](https://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them)，并进行相关更改，希望既能增加内聚力，又能降低耦合度。不幸的是，这里没有始终适用的简单重构，但您可能应该应用[告诉不要问](http://www.pragmaticprogrammer.com/articles/tell-dont-ask)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-02T16:00:43.660

我想你可能误解了凝聚力的含义。一个类按照其他几个类来实现，其内聚度不一定低，只要代表一个明确的概念，有明确的目的即可。例如，您可能有一个`class Person`，它是根据班级`Date`（出生日期）`Address`、 和`Education`（该人上过的学校的列表）来实现的。您可以提供`Person`用于获取出生年份、上一所学校或他居住的州的包装，以避免暴露在`Person`其他类方面实施的事实。这会减少耦合，但`Person`不会降低内聚性。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-02T16:01:42.597

这是一个灰色地带。这些原则旨在帮助您完成工作，如果您发现您正在为他们工作（即他们妨碍您和/或您发现它使您的代码复杂化），那么您太难遵守并且您需要退缩。

让它为你工作，不要为它工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T16:00:17.110

我不知道这是否真的会降低凝聚力。

聚合/组合都是关于一个类利用其他类来满足它通过其公共方法公开的合同。该类不需要复制其相关对象的接口。它实际上向方法调用者隐藏了有关这些聚合类的任何知识。

在多级类依赖的情况下要遵守得墨忒耳定律，你只需要在每一级应用聚合/组合和良好的封装。

换句话说，每个类对其他类都有一个或多个依赖项，但是这些只是对被引用类的依赖，而不是对从属性/方法返回的任何对象的依赖。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T15:45:17.693

在耦合和内聚之间似乎存在权衡的情况下，我可能会问自己“如果其他人已经编写了这个逻辑，并且我正在寻找其中的错误，我会先看哪里？”，并且以这种方式编写代码。

# sql-server - 从 SQLite 导出到 SQL Server

> ID：163079
> 
> 赞同：34
> 
> 时间：2008-10-02T15:41:17.530
> 
> 标签：sql-server, database, sqlite, data-migration

是否有将[SQLite](http://en.wikipedia.org/wiki/SQLite)数据库迁移到[SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server)（结构和数据）的工具？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-02T15:48:54.843

[SQLite](http://en.wikipedia.org/wiki/SQLite)确实有一个 .dump 选项可以在命令行运行。虽然我更喜欢使用[SQLite Database Browser](http://sqlitebrowser.sourceforge.net/)应用程序来管理 SQLite 数据库。您可以将结构和内容导出到几乎任何东西都可以读取的 .sql 文件。文件 > 导出 > 数据库到 SQL 文件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2015-10-05T12:41:51.107

我知道这是旧线程，但我认为这个解决方案也应该在这里。

*   为 SQLite 安装 ODBC 驱动程序
*   为 x64 运行 odbcad32 或为 x86 运行 C:\Windows\SysWOW64\odbcad32.exe
*   创建 SYSTEM DSN，在其中选择 SQLite3 ODBC 驱动程序
*   然后填写表格，其中数据库名称是 sqlite 数据库的文件路径

然后在 sysadmin 下运行 SQL Server

```
USE [master]
GO
EXEC sp_addlinkedserver 
   @server     = 'OldSQLite', -- connection name
   @srvproduct = '',          -- Can be blank but not NULL
   @provider   = 'MSDASQL', 
   @datasrc    = 'SQLiteDNSName' -- name of the system DSN connection 
GO 
```

然后您可以以普通用户身份运行查询，例如

```
SELECT * INTO SQLServerDATA FROM openquery(SQLiteDNSName, 'select * from SQLiteData') 
```

[或者您可以将类似的](https://stackoverflow.com/a/7354416/1756072)东西用于更大的桌子。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-02T15:51:57.257

SQLite`.dump`命令会将数据库的全部内容输出为 ASCII 文本文件。此文件为标准 SQL 格式，因此可以导入任何 SQL 数据库。此页面上的更多详细信息：[sqlite3](http://sqlite.org/sqlite.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-01-26T13:53:25.423

**sqlite-manager** , firefox 插件：允许您在 SQL 脚本中导出 SQLite 数据库。

**数据库>导出数据库>导出到文件**

（更正 firefox 35 bugg 必须更正扩展代码，如以下网页所示： [How to fix your optional sqlite manager module to work](https://stackoverflow.com/questions/28013639/importing-csv-to-sqlitefirefox-add-on-typeerror-gfile-contents-is-null)）

**命令行**：

```
sqlite3 DB_name .dump > DB_name.sql 
```

在 SQL 脚本中导出 sqlite 数据库。

来自网址：[http](http://doc.ubuntu-fr.org/sqlite#lister_les_commandes_sqlite "SQLite Ubuntu foc fr") ://doc.ubuntu-fr.org/sqlite 。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-07T11:10:23.550

一个想法是做这样的事情： - 在 sql lite 中查看 squema 并获取 CREATE TABLE 命令。- 在 SQL SERVER 中执行、解析 sql - 为每一行创建一个 INSERT 语句的旅行数据。（也解析sql）

这段代码是测试版，因为没有检测类型数据，也没有使用@parameter和命令对象，而是运行。

（您需要插入参考并安装 System.Data.SQLite；）

c#: 在 head cs 中插入此代码（或 neccesari）

使用系统；

使用 System.Collections.Generic；

使用 System.Text；

使用 System.Data；

使用 System.Data.SqlClient；

使用 System.Data.SQLite；

使用 System.Threading；

使用 System.Text.RegularExpressions；

使用 System.IO；

使用 log4net；

使用 System.Net；

```
 public static Boolean SqLite2SqlServer(string sqlitePath, string connStringSqlServer)
    {
        String SqlInsert;
        int i;
        try
        {

            string sql = "select * from sqlite_master where type = 'table' and name like 'YouTable in SQL'";
            string password = null;
            string sql2run;
            string tabla;
            string sqliteConnString = CreateSQLiteConnectionString(sqlitePath, password);
            //sqliteConnString = "data source=C:\\pro\\testconverter\\Origen\\FACTUNETWEB.DB;page size=4096;useutf16encoding=True";

            using (SQLiteConnection sqconn = new SQLiteConnection(sqliteConnString))
            {

                sqconn.Open();

                SQLiteCommand command = new SQLiteCommand(sql, sqconn);
                SQLiteDataReader reader = command.ExecuteReader();

                SqlConnection conn = new SqlConnection(connStringSqlServer);
                conn.Open();
                while (reader.Read())
                {
                    //Console.WriteLine("Name: " + reader["name"] + "\tScore: " + reader["score"]);
                    sql2run = "" + reader["sql"];
                    tabla = "" + reader["name"];

                    /*
                    sql2run = "Drop table " + tabla;
                    SqlCommand cmd = new SqlCommand(sql2run, conn);                       
                    cmd.ExecuteNonQuery();
                    */

                    sql2run = sql2run.Replace("COLLATE NOCASE", "");
                    sql2run = sql2run.Replace(" NUM", " TEXT");
                    SqlCommand cmd2 = new SqlCommand(sql2run, conn);
                    cmd2.ExecuteNonQuery();

                    // insertar los datos.
                    string sqlCmd = "Select *  From " + tabla;
                    SQLiteCommand cmd = new SQLiteCommand(sqlCmd, sqconn);
                    SQLiteDataReader rs = cmd.ExecuteReader();
                    String valor = "";
                    String Valores = "";
                    String Campos = "";
                    String Campo = "";
                    while (rs.Read())
                    {
                        SqlInsert = "INSERT INTO " + tabla;
                        Campos = "";
                        Valores = "";
                        for ( i = 0; i < rs.FieldCount ; i++)
                        {

                            //valor = "" + rs.GetString(i);
                            //valor = "" + rs.GetName(i);
                            Campo = "" + rs.GetName(i);
                            valor = "" + rs.GetValue(i);

                            if (Valores != "")
                            {
                                Valores = Valores + ',';
                                Campos = Campos + ',';
                            }
                            Valores = Valores + "'" + valor + "'";
                            Campos = Campos + Campo;
                        }
                        SqlInsert = SqlInsert + "(" + Campos + ") Values (" + Valores + ")";
                        SqlCommand cmdInsert = new SqlCommand(SqlInsert, conn);
                        cmdInsert.ExecuteNonQuery();

                    }

                }

                }
            return true;
        } //END TRY
        catch (Exception ex)
        {
            _log.Error("unexpected exception", ex);

            throw;

        } // catch
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-19T07:53:17.537

对于安卓。

```
adb root
adb shell
cd /data/com.xxx.package/databases/
sqlite3 db_name .dump >dump.sql 
```

# php - 设置默认值（条件赋值）

> ID：163092
> 
> 赞同：33
> 
> 时间：2008-10-02T15:42:48.680
> 
> 标签：php, ruby, logical-operators

在 Ruby 中，您可以轻松地为变量设置默认值

```
x ||= "default" 
```

如果 x 为 nil 或 false，上述语句将 x 的值设置为“default”

PHP中是否有类似的快捷方式或者我必须使用更长的形式：

```
$x = (isset($x))? $x : "default"; 
```

有没有更简单的方法可以在 PHP 中处理这个问题？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2011-02-03T12:54:27.423

从 PHP 5.3 开始，您可以使用三元运算符同时省略中间参数：

```
$x = $x ?: 'default'; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2018-08-23T14:13:01.370

从 PHP 7.0 开始，您还可以使用[null coalesce 运算符](http://php.net/manual/en/migration70.new-features.php#migration70.new-features.null-coalesce-op)

```
// PHP version < 7.0, using a standard ternary
$x = (isset($_GET['y'])) ? $_GET['y'] : 'not set';
// PHP version >= 7.0
$x = $_GET['y'] ?? 'not set'; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-02T15:48:21.350

```
isset($x) or $x = 'default'; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T18:40:19.300

我将它包装在一个函数中：

```
function default($value, $default) {
    return $value ? $value : $default;
}
// then use it like:
$x=default($x, 'default'); 
```

有些人可能不喜欢它，但如果你在做一个疯狂的函数调用，它会让你的代码更干净。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T15:47:29.653

我认为您的较长形式已经是 php 的快捷方式......我不会使用它，因为它不好阅读

一些注意事项：在 symfony 框架中，大多数“get”方法都有第二个参数来定义默认值......

# sql-server - 如何缩小 MS SQL 2000 数据库上的事务日志？

> ID：163098
> 
> 赞同：5
> 
> 时间：2008-10-02T15:44:10.940
> 
> 标签：sql-server, sysadmin

我有几个数据库，其中事务日志 (.LDF) 比数据库文件 (.MDF) 大很多倍。

我能做些什么来自动缩小这些或防止它们变得如此之大？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T16:08:50.600

那应该做的工作

```
use master
go
dump transaction <YourDBName> with no_log
go
use <YourDBName>
go
DBCC SHRINKFILE (<YourDBNameLogFileName>, 100) -- where 100 is the size you may want to shrink it to in MB, change it to your needs
go
-- then you can call to check that all went fine
dbcc checkdb(<YourDBName>) 
```

**一句警告**

您只会在不需要适当备份策略的测试/开发数据库上真正使用它，因为转储日志会导致丢失事务历史记录。在实时系统中，您应该使用[Cade Roux建议的解决方案](https://stackoverflow.com/questions/163098/how-do-i-shrink-the-transaction-log-on-ms-sql-2000-databases/163117#163117)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T15:47:42.087

备份事务日志并收缩它。

如果数据库定期备份并在检查点截断，它不应该失控，但是，如果您在这些间隔之间执行大量（大小）事务，它将增长到下一个检查点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T15:47:36.033

右键单击企业管理器中的数据库 > 所有任务 > 收缩数据库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T15:47:25.597

DBCC 收缩文件。

[这里是 2005年。](http://support.microsoft.com/kb/907511) [这里是 2000 年。](http://support.microsoft.com/kb/907511)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T15:05:32.073

这里没有人说过，所以我会：永远不要缩小事务日志。从 SQL Server 的角度来看，这是一个坏主意。

通过进行每日数据库备份和每小时（或更少）事务日志备份来保持事务日志较小。事务日志备份间隔取决于您的数据库的繁忙程度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T15:56:53.267

您可以尝试的另一件事是将数据库的恢复模式设置为简单（如果还没有），这将防止日志文件快速增长。我们最近遇到了这个问题，我们的事务日志已满，我们不再被允许进行事务。

多个答案中的收缩文件和简单恢复模式的组合确保我们的日志文件保持合理的大小。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T16:04:18.677

使用查询分析器：

```
USE yourdabatase
SELECT * FROM sysfiles 
```

您应该找到类似于以下内容的内容：

```
FileID    …  
1             1             24264    -1            1280      1048578               0             yourdabatase_Data    D:\MSSQL_Services\Data\yourdabatase_Data.MDF
2             0             128         -1            1280      66           0                             yourdabatase_Log      D:\MSSQL_Services\Data\yourdabatase_Log.LDF 
```

检查日志文件的文件 ID（大多数情况下是 2）。执行 2 或 3 次 checkpoint 命令，将每一页写入硬盘。

```
Checkpoint
GO
Checkpoint
GO 
```

执行以下事务命令将日志文件中继到 1 MB

```
DUMP TRAN yourdabatase WITH no_log 
DBCC SHRINKFILE(2,1)  /*(FileID , the new size = 1 Mb)*/ 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T16:34:35.903

这是我一直在使用的

```
BACKUP LOG <CatalogName> with TRUNCATE_ONLY
DBCC SHRINKDATABASE (<CatalogName>, 1)
use <CatalogName>
go
DBCC SHRINKFILE(<CatalogName_logName>,1) 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-02T15:48:12.520

试试 sp_force_shrink_log，你可以在这里找到 [http://www.rectanglered.com/sqlserver.php](http://www.rectanglered.com/sqlserver.php)

# .net - 如何从 WinForms 应用程序中用户控件上的子控件中获取事件？

> ID：163104
> 
> 赞同：11
> 
> 时间：2008-10-02T15:45:11.157
> 
> 标签：.net, winforms, events, user-controls

主窗体有什么方法能够拦截在用户控件上的子控件上触发的事件？

我在我的应用程序的主窗体中嵌入了一个自定义用户控件。该控件包含各种操作数据的子控件，这些子控件本身由主窗体上的其他控件显示。我想要的是，如果用户更改子控件时可以以某种方式通知主窗体，那么我可以在其他地方更新数据和相应的显示。

现在，我在作弊。我有一个委托连接到子控件的焦点离开事件。这个委托改变了我没有在其他地方使用的用户控件的一个属性（在这个原因中，CausesValidation）。然后，我在主窗体上定义了一个委托，用于当用户控件的 CausesValidation 属性发生更改时，它会指示应用程序更新数据并显示。

出现问题是因为我还为焦点离开用户控件时设置了一个委托，因为我需要先验证用户控件中的字段，然后才能允许用户执行其他任何操作。但是，如果用户只是在子控件之间切换，我不想验证，因为它们可能没有完成编辑。

基本上，我希望在用户切换子控件或离开用户控件时更新数据，但不进行验证。当用户离开控件时，我想更新并验证。现在，离开用户控件会导致验证触发两次。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-02T16:14:45.080

最佳实践是在将事件`UserControl`冒泡到父表单的事件上公开事件。我已经开始为你整理了一个例子。以下是此示例提供的内容的描述。

*   `UserControl1`
*   创建`UserControl`一个`TextBox1`
*   `UserControl`在被叫上注册一个公共事件`ControlChanged`
*   在寄存器中为TextChangedEvent`UserControl`的事件处理程序`TextBox1`
*   在`TextChangeEvent`处理程序函数中，我调用`ControlChanged`事件以冒泡到父表单
*   `Form1`
*   `UserControl1`在设计器上放置一个实例
*   `UserControl1`在for`MouseLeave`和 for上注册一个事件处理程序`ControlChanged`

这是一个屏幕截图，说明`ControlChanged`我在 上定义的事件`UserControl`可通过父 Windows 窗体上的 Visual Studio 中的 UX 获得。

[![用于用户控制的事件处理程序](https://i.stack.imgur.com/absnd.jpg)](https://i.stack.imgur.com/absnd.jpg)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T15:53:09.500

此类事情的最佳模型是在您的用户控件上创建自定义事件，并在适当的时间引发它们。

您的场景相当复杂，但并非闻所未闻。（实际上，在我当前的一个项目中，我处于非常相似的模式。）我处理它的方式是用户控件负责自己的验证。我不使用 CausesValidation；相反，在适当的用户控制点，我通过覆盖 ValidateChildren() 来执行验证。（对我来说，这通常发生在用户单击用户控件上的“保存”或“下一步”时。）

不熟悉您的用户控件 UI，这可能不是 100% 适合您的方法。但是，如果您引发自定义事件（可能使用指定是否执行验证的自定义 EventArgs），您应该能够到达您想要的位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-29T18:25:23.323

您将需要连接您关心在用户控件中捕获的事件，并通过用户控件本身的一些自定义事件属性发布它们。一个简单的例子是包装一个按钮点击事件：

```
// CustomControl.cs
// Assumes a Button 'myButton' has been added through the designer

// we need a delegate definition to type our event
public delegate void ButtonClickHandler(object sender, EventArgs e);

// declare the public event that other classes can subscribe to
public event ButtonClickHandler ButtonClickEvent;

// wire up the internal button click event to trigger our custom event
this.myButton.Click += new System.EventHandler(this.myButton_Click);
public void myButton_Click(object sender, EventArgs e)
{
  if (ButtonClickEvent != null)
  {
    ButtonClickEvent(sender, e);
  }
} 
```

然后，在使用该控件的表单中，您可以像其他任何方式一样连接事件：

```
// CustomForm.cs
// Assumes a CustomControl 'myCustomControl' has been added through the desinger
this.myCustomControl.ButtonClickEvent += new System.EventHandler(this.myCustomControl_ButtonClickEvent);
myCustomControl_ButtonClickEvent(object sender, EventArgs e)
{
  // do something with the newly bubbled event
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-02-04T20:03:52.053

如果有人仍然想知道如何在 WinForm 中模拟事件冒泡，那么[Application.AddMessageFilter](https://msdn.microsoft.com/en-us/library/system.windows.forms.application.addmessagefilter(v=vs.110).aspx)方法是一个不错的选择。

使用这种方法，您可以安装自己的过滤器来监控所有**发布**到当前线程的消息队列的消息。

您应该知道此过滤器无法处理正在发送（未发布）的消息。Fourtounatly，最有趣的事件（如点击事件）被发布而不被发送，因此可以被这个过滤器监控

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-29T18:34:59.840

如前所述，我想插话，听起来你实际上是在追逐一条红鲱鱼。虽然您似乎遇到了 WinForms 中缺少事件冒泡导致您遇到麻烦的情况，但现实情况是，糟糕的架构迫使您在不应该需要事件冒泡的情况下需要事件冒泡。

如果您可以重构/重构您的设计，以便控件使用通用数据模型（MVC/MVP 是显而易见的选择），那么您可以简单地在模型上应用常见的 WinForms 模式（如 PropertyChanged 事件）来告诉您的主窗体和任何其他控件它消耗这些数据来更新自己。

简而言之，其他答案是合理的，因为它们按要求回答了问题。但从代码质量的角度来看，我认为更好的答案是将数据与 UI 分开。

# java - CLIENT-CERT auth-method 可以与 tomcat 中的 JDBC 领域一起使用吗？

> ID：163113
> 
> 赞同：6
> 
> 时间：2008-10-02T15:47:13.897
> 
> 标签：java, web-services, authentication, tomcat, authorization

JDBC 领域为身份验证指定了一个表结构，其中包含由属性 userNameCol 和 userCredCol 定义的列。这些对应于对 FORM 或 BASIC 身份验证方法有意义的用户和密码。它们是交互式的，需要客户端用户的这两部分。

*   从证书中返回什么？
*   存储在 userNameCol 和 userCredCol 中的数据示例是什么样的？
*   在这种情况下，领域是否有替代表结构？

PS - 我使用的是 tomcat 5.5.x。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T06:36:49.780

### JDBCRealm 支持 CLIENT-CERT

是的，它可以。但是，很少有需要注意的怪癖。

### 用户名

用户名列应包含证书主体的专有名称，作为字符串。不幸的是，Tomcat 用于获取此字符串的方法会产生依赖于实现的结果，因此如果您要切换到新的安全提供程序，甚至只是升级您的 Java 运行时，您可能需要将您的用户名映射到新表单. 您必须测试您的部署以找出使用的格式。

具体来说，在返回的时候`getName()`被调用来获取a ，作为用户名。如果您阅读[文档，](http://java.sun.com/j2se/1.5.0/docs/api/java/security/cert/X509Certificate.html#getSubjectDN())您会发现这不再是最好的方法。`Principal``X509Certificate.getSubjectDN()``String`

### 验证

最简单的设置是将您的信任锚加载到[Tomcat 的信任库](http://tomcat.apache.org/tomcat-5.5-doc/ssl-howto.html)中，该信任库在“server.xml”文件中配置。使用此设置，位于您的受信任 CA 中的任何客户端证书链都将被视为“经过身份验证”，这是正确的 - 身份验证意味着身份是已知的，并且与授权不同，授权决定了允许该身份的内容做。

### 授权

由于任何拥有签名证书的人都将通过身份验证，因此您需要设置角色以保护应用程序中的私有资源。这是通过在“web.xml”文件中设置与角色相关联的安全约束来完成的。然后，在您的数据库中，填充“角色”表以授予受信任用户额外的角色。

用户表和角色表之间的关系与使用基于 FORM 的授权完全一样，应该用于向您信任的用户授予适当的权限。

### 关于密码的说明

将`JDBCRealm`创建一个新的[Principal](http://java.sun.com/j2se/1.5.0/docs/api/java/security/package-summary.html)，它确实带有密码，但除非您的应用程序将其向下转换`Principal`为特定于 Tomcat 的实现（[GenericPrincipal](http://tomcat.apache.org/tomcat-5.5-doc/catalina/docs/api/org/apache/catalina/realm/GenericPrincipal.html)），否则您将看不到此属性，并且您输入的内容并不重要那一栏。我推荐`NULL`。

换句话说，当`JDBCRealm`与 client-auth 一起使用时，密码字段将被忽略。这`GenericPrincipal`有一种访问基础主体的方法，但不幸的`Principal`是，证书中的 没有传递；将`JDBCRealm`其设置为空；在这种情况下唯一有用的方法可能是`getName()`（返回主题 DN 可能是一些非标准形式）。

### 表结构和内容

[使用与基于 FORM 的 JDBCRealm](http://tomcat.apache.org/tomcat-5.5-doc/realm-howto.html#JDBCRealm)（或 DatasourceRealm）完全相同的表结构。唯一的区别在于内容。用户名将是主题专有名称的文本表示，密码将是`NULL`或一些虚拟值。

# c# - 在 VS.Net 2005 中调试时断点未连接

> ID：163133
> 
> 赞同：4
> 
> 时间：2008-10-02T15:50:42.220
> 
> 标签：c#, debugging, visual-studio-2005, breakpoints

最近遇到了这个问题...在 VS.Net 2005 中调试应用程序时，断点未连接。错误表示编译的代码与运行的版本不同，因此存在不匹配导致断点断开。

清理所有 bin 文件并重新编译的解决方案无济于事。也不只是发生在一个盒子或一个人身上。

补充说明：此解决方案在 TFS 中用于源代码控制。如果我删除本地 TFS 存储库并从头开始从源代码控制中获取它，有时问题就会消失。我也试过卸载并重新安装 Visual Studio。这有时也有帮助。这两种方法在某些时候都有效，这一事实表明问题不是由任何一种直接引起的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-02T17:48:32.513

也许这个建议可能会有所帮助：

1.  在 Visual Studio 中调试时，单击“调试”>“Windows”>“模块”。IDE 将停靠一个 Modules 窗口，显示已为您的项目加载的所有模块。
2.  查找项目的 DLL，并检查它的符号状态。
3.  如果它说符号已加载，那么你就是黄金。如果它显示类似无法找到或打开 PDB 文件，请右键单击您的模块，选择加载符号，然后浏览到 PDB 的路径。

我发现有时需要：

1.  停止调试器
2.  关闭 IDE
3.  关闭托管应用程序
4.  核对 obj 和 bin 文件夹
5.  重启IDE
6.  重建项目
7.  再次浏览“模块”窗口
8.  浏览到 PDB 文件的位置后，符号状态应更改为已加载符号，您现在应该能够在代码行中设置和捕获断点。

来源：[断点当前不会被命中。没有为此文档加载任何符号。](http://geekswithblogs.net/dbutscher/archive/2007/06/26/113472.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-28T09:30:10.097

[http://dpotter.net/Technical/2009/05/upgrading-to-ie8-breaks-debugging-with-visual-studio-2005/](http://dpotter.net/Technical/2009/05/upgrading-to-ie8-breaks-debugging-with-visual-studio-2005/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T15:53:26.080

在选项 -> 调试中，您可以取消选中“要求源文件与原始版本完全匹配”，这可能会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T15:54:19.683

构建配置是否设置为发布？

您是否引用了设置断点的外部 DLL？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T16:05:37.440

您是否正在创建一个由外部可执行文件使用的 DLL 项目？您使用的是 .NET 还是 COM？

如果您将 COM 互操作与 .NET 一起使用，则当可执行文件加载 DLL 时，DLL 版本有时会成为问题。例如，如果您的每日构建产生递增的构建号，但您的调试 DLL 的构建号较小，则可执行文件将不会加载调试 DLL。要解决此问题，您需要扫描注册表中的 HKEY_CLASSES_ROOT\CLSID 目录以查找 .NET/COM 组件的 GUID/CLSID。在 InProc32 下，删除版本号高于调试 DLL 的条目。

同样，以上仅适用于 .NET + COM 互操作 DLL。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T16:47:02.053

我过去也遇到过类似的问题。

解决方法是关闭 Visual Studio 并删除“C:\WINDOWS\Microsoft.NET\Framework{framework version}\Temporary ASP.NET Files”下项目的临时 ASP.NET 生成的程序集文件，然后重新打开项目。

阅读[此处的帖子](http://geekswithblogs.net/dbutscher/archive/2007/06/26/113472.aspx)和评论以解决它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T15:59:42.477

AviewAnew - 已经应 MS 技术人员的要求这样做了。取消选中需要源文件以匹配版本没有帮助。

Mike L - 配置设置为调试，现在有外部 DLL。使用除框架引用之外的所有本地项目。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T16:00:17.250

您确定 .pdb 文件与您正在运行的可执行文件位于同一文件夹中吗？确保两个文件的最后修改日期匹配，并且 VS 附加到该 exe（而不是其他）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-02T16:07:16.720

您是否有以任何方式触及您的二进制文件的后期构建步骤？如果是这样，这可能会使调试器感到困惑，并使您的符号看起来与您的 exe/dll 不匹配，因为大小/时间戳不正确。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T16:07:52.163

在过去，我有时发现关闭编译器优化可以解决“丢失”断点，因为优化器已经（正确地）确定代码没有被调用，并将它们从编译版本中删除。

这听起来确实是一个不同的问题，但可能值得确保在调试模式下关闭优化。[项目/属性，构建设置选项卡]

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T17:14:29.943

确定代码上没有 Debug 属性会阻止代码在应用程序的任何位置被调试，例如 DebuggerHidden 或 DebuggerStepThrough？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T17:26:12.693

您可以单步执行代码直到断点行，而不是运行并等待它命中吗？你可以单步执行代码吗？

# silverlight - 重新学习图形编程的最佳地点在哪里

> ID：163146
> 
> 赞同：9
> 
> 时间：2008-10-02T15:54:41.633
> 
> 标签：silverlight, graphics

考虑到 Sliverlight，我想知道去哪里学习 3d 空间、变换、矩阵操作和所有这些好东西的好地方。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-02T16:00:49.277

总有*圣经*

![弗利和范达姆](https://i.stack.imgur.com/8nEyw.jpg)

它很贵而且理论上*很重*，所以还有更便宜的*圣经精简版*

![替代文字](https://i.stack.imgur.com/zvmQ1.jpg)

正如一些评论和其他答案所指出的，绝对值得注意的是，这本书现在已经过时了。但是，在原始问题的背景下，很长一段时间以来，线性代数的低级原理并没有真正发生任何变化。

如果您想学习高级图形编程，这可能不是您的第一本书。但是，如果您想了解“机器的胆量”和基础数学——也许你是那种认为人们应该学习 C 的人 :-)——那就发疯了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T16:06:07.487

这不是一个地方，但我发现Charles Petzold 的[3D Programming for Windows非常棒。](http://www.charlespetzold.com/3D/)它涵盖了您所询问的所有内容，并且专门针对 WPF/silverlight。

当然，Petzold（像往常一样）能够很好地传达重要的概念。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T15:56:50.037

我想我可能自己找到了。正在查看：http: [//msdn.microsoft.com/en-us/library/cc189037](http://msdn.microsoft.com/en-us/library/cc189037(VS.95).aspx) (VS.95).aspx 和 [http://www.c-sharpcorner.com/UploadFile/mgold/TransformswithGDIplus09142005064919AM/TransformswithGDIplus.aspx](http://www.c-sharpcorner.com/UploadFile/mgold/TransformswithGDIplus09142005064919AM/TransformswithGDIplus.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T16:07:05.673

免费的图形算法可以在 [comp.graphics.algorithms 常见问题解答中找到](http://www.faqs.org/faqs/graphics/algorithms-faq/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T16:08:05.343

如前所述，你真的应该学习线性代数，这里有一些很棒的视频讲座，[麻省理工学院线性阿莱布格拉视频讲座](http://ocw.mit.edu/OcwWeb/Mathematics/18-06Spring-2005/VideoLectures/ "视频讲座")。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T15:59:33.947

任何线性代数教科书都应该提供数学复习；[在线性代数教科书主页上](http://joshua.smcvt.edu/linearalgebra/)有一个相当不错的在线可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T17:48:22.477

我个人认为，虽然圣经（由 Foley & Van Damn 所著）是当时最伟大的书，但它有些过时了。

我建议 Alan 和 Mark Watt 的“**高级动画和渲染技术**”。这本书的唯一问题是它让你对 CG 的几乎每一个广泛的方面都有很好的理解，但它假设你对它有一定的了解，并且没有完全解释它。您可以随时查看 Bib 并找到有关您感兴趣的每个主题的增强文章和书籍。

如果您想进一步了解，或者如果您想深入了解计算机图形和 GPU 的使用，我建议您查看三个“GPU Gems”。

# c# - 您可以使用多个过滤器调用 Directory.GetFiles() 吗？

> ID：163162
> 
> 赞同：395
> 
> 时间：2008-10-02T15:58:21.407
> 
> 标签：c#, filesystems, .net

我正在尝试使用该`Directory.GetFiles()`方法来检索多种类型的文件列表，例如`mp3`'s 和`jpg`'s。我尝试了以下两种方法，但都没有运气：

```
Directory.GetFiles("C:\\path", "*.mp3|*.jpg", SearchOption.AllDirectories);
Directory.GetFiles("C:\\path", "*.mp3;*.jpg", SearchOption.AllDirectories); 
```

有没有办法在一个电话中做到这一点？

* * *

## 回答 #1

> 赞同：587
> 
> 时间：2008-10-02T16:09:11.927

对于 .NET 4.0 及更高版本，

```
var files = Directory.EnumerateFiles("C:\\path", "*.*", SearchOption.AllDirectories)
            .Where(s => s.EndsWith(".mp3") || s.EndsWith(".jpg")); 
```

对于早期版本的 .NET，

```
var files = Directory.GetFiles("C:\\path", "*.*", SearchOption.AllDirectories)
            .Where(s => s.EndsWith(".mp3") || s.EndsWith(".jpg")); 
```

**编辑：** *请阅读评论。[Paul Farry](https://stackoverflow.com/users/97516/paul-farry)提出的改进以及[Christian.K](https://stackoverflow.com/users/21567/christian-k)指出的内存/性能问题都非常重要。*

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2011-12-11T19:55:28.967

这个怎么样：

```
private static string[] GetFiles(string sourceFolder, string filters, System.IO.SearchOption searchOption)
{
   return filters.Split('|').SelectMany(filter => System.IO.Directory.GetFiles(sourceFolder, filter, searchOption)).ToArray();
} 
```

我在这里找到它（在评论中）：http: [//msdn.microsoft.com/en-us/library/wz42302f.aspx](http://msdn.microsoft.com/en-us/library/wz42302f.aspx)

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2011-01-06T16:36:58.490

如果您有大量的扩展要检查，您可以使用以下内容。我不想创建很多 OR 语句，所以我修改了 lette 写的内容。

```
string supportedExtensions = "*.jpg,*.gif,*.png,*.bmp,*.jpe,*.jpeg,*.wmf,*.emf,*.xbm,*.ico,*.eps,*.tif,*.tiff,*.g01,*.g02,*.g03,*.g04,*.g05,*.g06,*.g07,*.g08";
foreach (string imageFile in Directory.GetFiles(_tempDirectory, "*.*", SearchOption.AllDirectories).Where(s => supportedExtensions.Contains(Path.GetExtension(s).ToLower())))
{
    //do work here
} 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2013-11-13T18:39:15.773

为了

```
var exts = new[] { "mp3", "jpg" }; 
```

你可以：

```
public IEnumerable<string> FilterFiles(string path, params string[] exts) {
    return
        Directory
        .EnumerateFiles(path, "*.*")
        .Where(file => exts.Any(x => file.EndsWith(x, StringComparison.OrdinalIgnoreCase)));
} 
```

*   不要忘记新的 .NET4`Directory.EnumerateFiles`以提高性能（[Directory.EnumerateFiles 与 Directory.GetFiles 有什么区别？](https://stackoverflow.com/questions/5669617/what-is-the-difference-between-directory-enumeratefiles-vs-directory-getfiles)）
*   “IgnoreCase”应该比“ToLower”快（`.EndsWith("aspx", StringComparison.OrdinalIgnoreCase)`而不是`.ToLower().EndsWith("aspx")`）

`EnumerateFiles`但是，当您拆分过滤器并合并结果时，就会显示出真正的好处：

```
public IEnumerable<string> FilterFiles(string path, params string[] exts) {
    return 
        exts.Select(x => "*." + x) // turn into globs
        .SelectMany(x => 
            Directory.EnumerateFiles(path, x)
            );
} 
```

如果您不必将它们变成 glob（即`exts = new[] {"*.mp3", "*.jpg"}`已经），它会变得更快一些。

基于以下 LinqPad 测试的性能评估（注意：`Perf`仅重复委托 10000 次） [https://gist.github.com/zaus/7454021](https://gist.github.com/zaus/7454021)

*（从“重复”重新发布和扩展，因为该问题特别要求没有 LINQ：[System.IO.Directory.GetFiles 的多个文件扩展搜索模式](https://stackoverflow.com/questions/7039580/multiple-file-extensions-searchpattern-for-system-io-directory-getfiles/19933502#19933502)）*

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2012-10-17T04:18:10.573

我知道这是老问题，但 LINQ：（.NET40+）

```
var files = Directory.GetFiles("path_to_files").Where(file => Regex.IsMatch(file, @"^.+\.(wav|mp3|txt)$")); 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2013-03-22T13:03:58.223

还有一个下降解决方案，它似乎没有任何内存或性能开销并且非常优雅：

```
string[] filters = new[]{"*.jpg", "*.png", "*.gif"};
string[] filePaths = filters.SelectMany(f => Directory.GetFiles(basePath, f)).ToArray(); 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2011-12-02T22:31:33.177

使用 Linq 的另一种方法，但不必返回所有内容并在内存中对其进行过滤。

```
var files = Directory.GetFiles("C:\\path", "*.mp3", SearchOption.AllDirectories).Union(Directory.GetFiles("C:\\path", "*.jpg", SearchOption.AllDirectories)); 
```

它实际上是 2 次调用`GetFiles()`，但我认为这与问题的精神一致，并以一个可枚举的形式返回它们。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-09-14T08:16:22.763

让

```
var set = new HashSet<string> { ".mp3", ".jpg" }; 
```

然后

```
Directory.GetFiles(path, "*.*", SearchOption.AllDirectories)
         .Where(f => set.Contains(
             new FileInfo(f).Extension,
             StringComparer.OrdinalIgnoreCase)); 
```

或者

```
from file in Directory.GetFiles(path, "*.*", SearchOption.AllDirectories)
from ext in set
where String.Equals(ext, new FileInfo(file).Extension, StringComparison.OrdinalIgnoreCase)
select file; 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-10-02T16:06:20.263

没有。尝试以下操作：

```
List<string> _searchPatternList = new List<string>();
    ...
    List<string> fileList = new List<string>();
    foreach ( string ext in _searchPatternList )
    {
        foreach ( string subFile in Directory.GetFiles( folderName, ext  )
        {
            fileList.Add( subFile );
        }
    }

    // Sort alpabetically
    fileList.Sort();

    // Add files to the file browser control    
    foreach ( string fileName in fileList )
    {
        ...;
    } 
```

取自：http: [//blogs.msdn.com/markda/archive/2006/04/20/580075.aspx](http://blogs.msdn.com/markda/archive/2006/04/20/580075.aspx)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2011-11-26T17:02:46.113

我不能使用`.Where`方法，因为我在 .NET Framework 2.0 中编程（Linq 仅在 .NET Framework 3.5+ 中受支持）。

下面的代码不区分大小写（因此`.CaB`或`.cab`也将列出）。

```
string[] ext = new string[2] { "*.CAB", "*.MSU" };

foreach (string found in ext)
{
    string[] extracted = Directory.GetFiles("C:\\test", found, System.IO.SearchOption.AllDirectories);

    foreach (string file in extracted)
    {
        Console.WriteLine(file);
    }
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-05-31T17:43:28.413

以下函数搜索多个模式，以逗号分隔。您还可以指定排除项，例如：“！web.config”将搜索所有文件并排除“web.config”。图案可以混合。

```
private string[] FindFiles(string directory, string filters, SearchOption searchOption)
{
    if (!Directory.Exists(directory)) return new string[] { };

    var include = (from filter in filters.Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries) where !string.IsNullOrEmpty(filter.Trim()) select filter.Trim());
    var exclude = (from filter in include where filter.Contains(@"!") select filter);

    include = include.Except(exclude);

    if (include.Count() == 0) include = new string[] { "*" };

    var rxfilters = from filter in exclude select string.Format("^{0}$", filter.Replace("!", "").Replace(".", @"\.").Replace("*", ".*").Replace("?", "."));
    Regex regex = new Regex(string.Join("|", rxfilters.ToArray()));

    List<Thread> workers = new List<Thread>();
    List<string> files = new List<string>();

    foreach (string filter in include)
    {
        Thread worker = new Thread(
            new ThreadStart(
                delegate
                {
                    string[] allfiles = Directory.GetFiles(directory, filter, searchOption);
                    if (exclude.Count() > 0)
                    {
                        lock (files)
                            files.AddRange(allfiles.Where(p => !regex.Match(p).Success));
                    }
                    else
                    {
                        lock (files)
                            files.AddRange(allfiles);
                    }
                }
            ));

        workers.Add(worker);

        worker.Start();
    }

    foreach (Thread worker in workers)
    {
        worker.Join();
    }

    return files.ToArray();

} 
```

用法：

```
foreach (string file in FindFiles(@"D:\628.2.11", @"!*.config, !*.js", SearchOption.AllDirectories))
            {
                Console.WriteLine(file);
            } 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-09-18T04:37:25.643

```
List<string> FileList = new List<string>();
DirectoryInfo di = new DirectoryInfo("C:\\DirName");

IEnumerable<FileInfo> fileList = di.GetFiles("*.*");

//Create the query
IEnumerable<FileInfo> fileQuery = from file in fileList
                                  where (file.Extension.ToLower() == ".jpg" || file.Extension.ToLower() == ".png")
                                  orderby file.LastWriteTime
                                  select file;

foreach (System.IO.FileInfo fi in fileQuery)
{
    fi.Attributes = FileAttributes.Normal;
    FileList.Add(fi.FullName);
} 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-04-19T09:40:18.050

```
DirectoryInfo directory = new DirectoryInfo(Server.MapPath("~/Contents/"));

//Using Union

FileInfo[] files = directory.GetFiles("*.xlsx")
                            .Union(directory
                            .GetFiles("*.csv"))
                            .ToArray(); 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2014-09-03T11:31:49.337

在 .NET 2.0（无 Linq）中：

```
public static List<string> GetFilez(string path, System.IO.SearchOption opt,  params string[] patterns)
{
    List<string> filez = new List<string>();
    foreach (string pattern in patterns)
    {
        filez.AddRange(
            System.IO.Directory.GetFiles(path, pattern, opt)
        );
    }

    // filez.Sort(); // Optional
    return filez; // Optional: .ToArray()
} 
```

然后使用它：

```
foreach (string fn in GetFilez(path
                             , System.IO.SearchOption.AllDirectories
                             , "*.xml", "*.xml.rels", "*.rels"))
{} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-10-02T17:17:32.183

刚刚找到了另一种方法来做到这一点。仍然不是一项操作，而是将其扔出去，看看其他人对此有何看法。

```
private void getFiles(string path)
{
    foreach (string s in Array.FindAll(Directory.GetFiles(path, "*", SearchOption.AllDirectories), predicate_FileMatch))
    {
        Debug.Print(s);
    }
}

private bool predicate_FileMatch(string fileName)
{
    if (fileName.EndsWith(".mp3"))
        return true;
    if (fileName.EndsWith(".jpg"))
        return true;
    return false;
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2015-05-21T18:10:02.457

关于什么

```
string[] filesPNG = Directory.GetFiles(path, "*.png");
string[] filesJPG = Directory.GetFiles(path, "*.jpg");
string[] filesJPEG = Directory.GetFiles(path, "*.jpeg");

int totalArraySizeAll = filesPNG.Length + filesJPG.Length + filesJPEG.Length;
List<string> filesAll = new List<string>(totalArraySizeAll);
filesAll.AddRange(filesPNG);
filesAll.AddRange(filesJPG);
filesAll.AddRange(filesJPEG); 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2018-02-15T10:36:37.260

如果您使用的是 VB.NET（或将依赖项导入到 C# 项目中），则实际上存在一种允许过滤多个扩展的便捷方法：

```
Microsoft.VisualBasic.FileIO.FileSystem.GetFiles("C:\\path", Microsoft.VisualBasic.FileIO.SearchOption.SearchAllSubDirectories, new string[] {"*.mp3", "*.jpg"}); 
```

在 VB.NET 中，这可以通过 My-namespace 访问：

```
My.Computer.FileSystem.GetFiles("C:\path", FileIO.SearchOption.SearchAllSubDirectories, {"*.mp3", "*.jpg"}) 
```

不幸的是，这些方便的方法不支持像这样的延迟评估的变体`Directory.EnumerateFiles()`。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-02T16:09:01.380

不...我相信您必须根据所需的文件类型拨打尽可能多的电话。

我会自己创建一个函数，在字符串上使用我需要的扩展名，然后在该数组上进行迭代，进行所有必要的调用。该函数将返回与我发送的扩展名匹配的文件的通用列表。

希望能帮助到你。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2011-12-15T07:27:34.730

```
/// <summary>
/// Returns the names of files in a specified directories that match the specified patterns using LINQ
/// </summary>
/// <param name="srcDirs">The directories to seach</param>
/// <param name="searchPatterns">the list of search patterns</param>
/// <param name="searchOption"></param>
/// <returns>The list of files that match the specified pattern</returns>
public static string[] GetFilesUsingLINQ(string[] srcDirs,
     string[] searchPatterns,
     SearchOption searchOption = SearchOption.AllDirectories)
{
    var r = from dir in srcDirs
            from searchPattern in searchPatterns
            from f in Directory.GetFiles(dir, searchPattern, searchOption)
            select f;

    return r.ToArray();
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2012-04-02T22:24:40.257

将您想要的扩展名设为一个字符串，即“.mp3.jpg.wma.wmf”，然后检查每个文件是否包含您想要的扩展名。这适用于 .net 2.0，因为它不使用 LINQ。

```
string myExtensions=".jpg.mp3";

string[] files=System.IO.Directory.GetFiles("C:\myfolder");

foreach(string file in files)
{
   if(myExtensions.ToLower().contains(System.IO.Path.GetExtension(s).ToLower()))
   {
      //this file has passed, do something with this file

   }
} 
```

这种方法的优点是您可以在不编辑代码的情况下添加或删除扩展，即添加 png 图像，只需编写 myExtensions=".jpg.mp3.png"。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2013-04-02T15:32:10.607

我想知道为什么发布了这么多“解决方案”？

如果我对 GetFiles 工作原理的菜鸟理解是正确的，那么只有两个选项，上面的任何解决方案都可以归结为这些：

1.  GetFiles，然后过滤：快速，但由于在应用过滤器之前存储开销而成为内存杀手

2.  GetFiles 时过滤：设置的过滤器越多越慢，但内存使用率低，因为没有存储开销。
    *这在上面的一篇文章中有一个令人印象深刻的基准进行了解释：每个过滤器选项都会导致单独的 GetFile 操作，因此硬盘驱动器的同一部分会被读取多次。*

在我看来，选项 1) 更好，但在 C:\ 之类的文件夹上使用 SearchOption.AllDirectories 会占用大量内存。
因此，我将使用选项 1 制作一个遍历所有子文件夹的递归子方法）

这应该会导致每个文件夹上只有 1 个 GetFiles 操作，因此速度很快（选项 1），但只使用少量内存，因为在每个子文件夹读取后应用过滤器 - > 每个子文件夹后删除开销。

如果我错了，请纠正我。正如我所说的那样，我对编程很陌生，但希望对事物有更深入的了解，最终变得擅长这一点:)

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2020-06-12T10:50:12.070

这是获取过滤文件的一种简单而优雅的方法

```
var allowedFileExtensions = ".csv,.txt";

var files = Directory.EnumerateFiles(@"C:\MyFolder", "*.*", SearchOption.TopDirectoryOnly)
                .Where(s => allowedFileExtensions.IndexOf(Path.GetExtension(s)) > -1).ToArray(); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-12-05T08:39:34.537

我遇到了同样的问题，找不到正确的解决方案，所以我编写了一个名为 GetFiles 的函数：

```
/// <summary>
/// Get all files with a specific extension
/// </summary>
/// <param name="extensionsToCompare">string list of all the extensions</param>
/// <param name="Location">string of the location</param>
/// <returns>array of all the files with the specific extensions</returns>
public string[] GetFiles(List<string> extensionsToCompare, string Location)
{
    List<string> files = new List<string>();
    foreach (string file in Directory.GetFiles(Location))
    {
        if (extensionsToCompare.Contains(file.Substring(file.IndexOf('.')+1).ToLower())) files.Add(file);
    }
    files.Sort();
    return files.ToArray();
} 
```

这个函数只会调用`Directory.Getfiles()`一次。

例如调用这样的函数：

```
string[] images = GetFiles(new List<string>{"jpg", "png", "gif"}, "imageFolder"); 
```

编辑：要获得一个具有多个扩展名的文件，请使用这个：

```
/// <summary>
    /// Get the file with a specific name and extension
    /// </summary>
    /// <param name="filename">the name of the file to find</param>
    /// <param name="extensionsToCompare">string list of all the extensions</param>
    /// <param name="Location">string of the location</param>
    /// <returns>file with the requested filename</returns>
    public string GetFile( string filename, List<string> extensionsToCompare, string Location)
    {
        foreach (string file in Directory.GetFiles(Location))
        {
            if (extensionsToCompare.Contains(file.Substring(file.IndexOf('.') + 1).ToLower()) &&& file.Substring(Location.Length + 1, (file.IndexOf('.') - (Location.Length + 1))).ToLower() == filename) 
                return file;
        }
        return "";
    } 
```

例如调用这样的函数：

```
string image = GetFile("imagename", new List<string>{"jpg", "png", "gif"}, "imageFolder"); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-07-10T12:47:49.673

我不知道哪种解决方案更好，但我使用这个：

```
String[] ext = "*.ext1|*.ext2".Split('|');

            List<String> files = new List<String>();
            foreach (String tmp in ext)
            {
                files.AddRange(Directory.GetFiles(dir, tmp, SearchOption.AllDirectories));
            } 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-11-06T11:34:50.173

使用 GetFiles 搜索模式过滤扩展是不安全的！例如，您有两个文件 Test1.xls 和 Test2.xlsx，并且您想使用搜索模式 *.xls 过滤掉 xls 文件，但 GetFiles 同时返回 Test1.xls 和 Test2.xlsx 我不知道这一点并在生产中出错一些临时文件突然被当作正确文件处理的环境。搜索模式是 *.txt 并且临时文件被命名为 *.txt20181028_100753898 所以搜索模式不能被信任，你还必须对文件名添加额外的检查。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2014-04-08T20:51:01.680

或者您可以将扩展字符串转换为 String^

```
vector <string>  extensions = { "*.mp4", "*.avi", "*.flv" };
for (int i = 0; i < extensions.size(); ++i)
{
     String^ ext = gcnew String(extensions[i].c_str());;
     String^ path = "C:\\Users\\Eric\\Videos";
     array<String^>^files = Directory::GetFiles(path,ext);
     Console::WriteLine(ext);
     cout << " " << (files->Length) << endl;
} 
```

# iis - IIS 连接池询问/泄漏跟踪

> ID：163164
> 
> 赞同：3
> 
> 时间：2008-10-02T15:58:45.303
> 
> 标签：iis, ado, connection-pooling

根据这篇[有用的文章](http://www.15seconds.com/issue/040830.htm)，我已确认在运行 W2k3 的 IIS 6 服务器上的某些应用程序中存在连接池泄漏。

困难的部分是，我在 6 个应用程序池中为 700 名开发人员编写的 300 个网站提供服务，其中 50% 是 .NET 1.1，它甚至没有在 CLR 数据性能计数器中显示连接。如果一切都是 .NET 2.0+，我可以看到连接不断增长，但我什至对那个纤薄的监控工具都不走运。

我的 300 个网站连接到分布在 Oracle、SQLServer 和异常值之间的大概 100 多个数据库，所以我也无法看到来自数据库端的连接。

现在我最好也是唯一的计划是对我最严重的违规者进行松散的二进制搜索。我将杀死应用程序池并慢慢地从其中删除应用程序，直到我找到在我杀死它们的池时哪些单个应用程序导致最多连接断开。但由于这是一个生产箱，我喜欢继续工作，作为一种追踪方法，这可能需要数周时间。

有谁知道询问 IIS 连接池以了解其来源或所有者的方法？是否有一个我可以在创建时附加的 MSMQ 触发器？我忽略了什么愚蠢的事情？

凯文

（我将包含错误代码以方便其他人通过搜索找到您的答案：异常：System.InvalidOperationException 消息：超时已过期。在从池中获取连接之前已经过了超时时间。这可能是因为所有池连接都在已达到使用和最大池大小。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T03:23:20.347

尝试[从 Bill Vaughn 的第一篇文章](http://msdn.microsoft.com/en-us/library/aa175863(SQL.80).aspx)开始。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-17T02:49:08.567

Todd Denlinger 编写了一个很棒的类[http://www.codeproject.com/KB/database/connectionmonitor.aspx](http://www.codeproject.com/KB/database/connectionmonitor.aspx)，它监视 Sql Server 连接并报告在一段时间内未正确处理的连接。将其连接到您的站点，它会在发生泄漏时通知您。

# c# - LINQ to SQL 特性

> ID：163183
> 
> 赞同：5
> 
> 时间：2008-10-02T16:01:31.007
> 
> 标签：c#, linq, linq-to-sql

我遇到了 LINQ to SQL 的一些特殊性。

通过一个相对简单的查询，我想选择一些字段，但是将日期字段格式化为字符串，我首先是这样实现的：

```
 var list = dataContext.MyLists.Single(x => x.ID == myId);

        var items = from i in list.MyItems
                    select
                        new
                            {
                                i.ID,
                                i.Sector,
                                i.Description,
                                CompleteDate = i.CompleteDate.HasValue ? i.CompleteDate.Value.ToShortDateString() : "",
                                DueDate = i.DueDate.HasValue ? i.DueDate.Value.ToShortDateString() : ""
                            }; 
```

后来我尝试了以下查询，这完全一样，除了我直接从我的 dataContext 查询，而不是我的第一个查询中的一个元素：

```
 var items = from i in dataContext.MyLists
                    select
                        new
                            {
                                i.ID,
                                i.Sector,
                                i.Description,
                                CompleteDate = i.CompleteDate.HasValue ? i.CompleteDate.Value.ToShortDateString() : "",
                                DueDate = i.DueDate.HasValue ? i.DueDate.Value.ToShortDateString() : ""
                            }; 
```

第一个运行良好，但第二个查询产生：

*无法将表达式 '...' 转换为 SQL，并且无法将其视为本地表达式。*

如果我删除格式化日期的行，它工作正常。如果我删除 .HasValue 检查它也可以正常工作，直到有空值。

有任何想法吗？

安东尼

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-02T16:14:57.277

我会在不进行格式化的情况下执行 SQL 部分，然后在客户端进行格式化：

```
var items = list.MyItems.Select(item => new { item.ID, item.Sector, item.Description, 
                                              item.CompleteDate, item.DueDate })
                        .AsEnumerable() // Don't do the next bit in the DB
                        .Select(item => new { item.ID, item.Sector, item.Description,
                                              CompleteDate = FormatDate(CompleteDate),
                                              DueDate = FormatDate(DueDate) });

static string FormatDate(DateTime? date)
{
    return date.HasValue ? date.Value.ToShortDateString() : ""
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-02T16:13:18.000

在第一个查询中，您已经在第二行运行时从数据库中取回了数据（var items = ...）。这意味着第二行在客户端运行，ToShortDateString 可以非常愉快地运行。

在第二个查询中，因为 select 直接在 IQueryable 集合 (dataContext.MyLists) 上运行，所以它尝试将 select 转换为 SQL 以在服务器上进行处理，其中 ToShortDateString 不被理解 - 因此出现“Could Not Translate..”异常.

为了更好地理解这一点，您确实需要了解 IQueryable 和 IEnumerable 之间的区别，以及此时 Linq To Sql 查询不再是 IQueryable 并变为 IEnumerable。网上有很多关于这个的东西。

希望这可以帮助，

保罗

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-02T16:15:36.653

就像错误消息告诉您的那样，不同之处在于在连接到 SQL 时可以远程执行本地操作。

Linq 代码必须由 Linq to SQL 转换为用于远程数据拉取的 SQL 命令 - 不能包括必须在本地完成的任何操作。

一旦将其拉入本地对象（在第一个示例中），它就不再使用 Linq to SQL，而是使用普通的 Linq。此时，您可以自由地对其进行本地操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T17:16:54.460

可能存在复制和粘贴错误，或者只是您的示例中的拼写错误。但如果不是，这可能是问题...

在第二个查询中，您正在查询列表的集合，而在第一个查询中，您正在查询列表中的项目。但是您还没有调整查询来解释这种差异。

你需要的可能是这个。请注意第二个示例中未出现的注释行。

```
 var items = from aList in dataContext.MyLists
                from i in aList.MyItems  // Access the items in a list
                where aList.ID == myId  // Use only the single desired list
                select
                    new
                        {
                            i.ID,
                            i.Sector,
                            i.Description,
                            CompleteDate = i.CompleteDate.HasValue ? i.CompleteDate.Value.ToShortDateString() : "",
                            DueDate = i.DueDate.HasValue ? i.DueDate.Value.ToShortDateString() : ""
                        }; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-05T14:56:58.117

`ToShortDateString()`Linq to SQL 不支持[http://msdn.microsoft.com/en-us/library/bb882657.aspx](http://msdn.microsoft.com/en-us/library/bb882657.aspx)

# c# - 使用大型文档时运行非常慢的正则表达式

> ID：163184
> 
> 赞同：2
> 
> 时间：2008-10-02T16:01:40.210
> 
> 标签：c#, regex, performance

我需要将内联 css 样式属性转换为它们的 HTML 标记等效项。我的解决方案有效，但使用 Microsoft .Net Regex 命名空间和长文档（约 40 页 html）运行非常缓慢。我尝试了几种变体，但没有有用的结果。我对执行表达式做了一些总结，但最后它只是被调用的内置正则表达式替换方法。

我确定我正在滥用正则表达式的贪婪，但我不确定使用单个正则表达式实现我想要的方法。

我希望能够运行以下单元测试：

```
[Test]
public void TestCleanReplacesFontWeightWithB()
{
    string html = "<font style=\"font-weight:bold\">Bold Text</font>";
    html = Q4.PrWorkflow.Helper.CleanFormatting(html);
    Assert.AreEqual("<b>Bold Text</b>", html);
}
[Test]
public void TestCleanReplacesMultipleAttributesFontWeightWithB()
{
    string html = "<font style=\"font-weight:bold; color: blue; \">Bold Text</font>";
    html = Q4.PrWorkflow.Helper.CleanFormatting(html);
    Assert.AreEqual("<b>Bold Text</b>", html);
}
[Test]
public void TestCleanReplaceAttributesBoldAndUnderlineWithHtml()
{
    string html = "<span style=\"font-weight:bold; color: blue; text-decoration: underline; \">Bold Text</span>";
    html = Q4.PrWorkflow.Helper.CleanFormatting(html);
    Assert.AreEqual("<u><b>Bold Text</b></u>", html);
}
[Test]
public void TestCleanReplaceAttributesBoldUnderlineAndItalicWithHtml()
{
    string html = "<span style=\"font-weight:bold; color: blue; font-style: italic; text-decoration: underline; \">Bold Text</span>";
    html = Q4.PrWorkflow.Helper.CleanFormatting(html);
    Assert.AreEqual("<u><b><i>Bold Text</i></b></u>", html);
}
[Test]
public void TestCleanReplacesFontWeightWithSpaceWithB()
{
    string html = "<font size=\"10\" style=\"font-weight: bold\">Bold Text</font>";
    html = Q4.PrWorkflow.Helper.CleanFormatting(html);
    Assert.AreEqual("<b>Bold Text</b>", html);
} 
```

我用来实现这个逻辑的正则表达式有效，但非常慢。c# 代码中的正则表达式如下所示：

```
public static IReplacePattern IncludeInlineItalicToITag(ICleanUpHtmlFactory factory)
{
    return factory.CreateReplacePattern("(<(span|font) .*?style=\".*?font-style:\\s*italic[^>]*>)(.*?)</\\2>", "$1<i>$3</i></$2>");
}
public static IReplacePattern IncludeInlineBoldToBTag(ICleanUpHtmlFactory factory)
{
    return factory.CreateReplacePattern("(<(span|font) .*?style=\".*?font-weight:\\s*bold[^>]*>)(.*?)</\\2>", "$1<b>$3</b></$2>");
}
public static IReplacePattern IncludeInlineUnderlineToUTag(ICleanUpHtmlFactory factory)
{
    return factory.CreateReplacePattern("(<(span|font) .*?style=\".*?text-decoration:\\s*underline[^>]*>)(.*?)</\\2>", "$1<u>$3</u></$2>");
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T16:07:32.443

我认为问题在于，如果它找到一个`span`| `font`没有定义样式属性的标签，由于`.\*?`. 我没有测试过它，但将其更改为`[^>]\*?`可能会提高性能。

确保将更改应用到`.\*?`您所拥有的一切；即使是捕获标签之间内容的那个（`[^<]\*?`在此处使用），因为如果文件格式不正确，它将捕获到下一个结束标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T16:27:54.783

~~.NET regular expressions does not support recursive constructs.~~ PCRE does, but that doesn't matter here.

Concider

```
<font style="font-weight: bold;"> text1 <font color="blue"> text2 </font> text3 </font> 
```

It would get converted into

```
<b> text1 <font color="blue"> text2 </b> text3 </font> 
```

My suggestion would be to use a proper markup parser, and maybe use regexp on the values of the style-tags.

**Edit:** Scratch that. It seems .NET has a construct for balanced, recursive patterns. But not as powerful as those in PCRE/perl.

```
(?<N>content) would push N onto a stack if content matches
(?<-N>content) would pop N from the stack, if content matches.
(?(N)yes|no) would match "yes" if N is on the stack, otherwise "no". 
```

See [http://weblogs.asp.net/whaggard/archive/2005/02/20/377025.aspx](http://weblogs.asp.net/whaggard/archive/2005/02/20/377025.aspx) for details.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T19:17:56.773

疯狂猜测：我相信成本来自替代方案和相应的匹配。您可能想尝试替换：

```
"(<(span|font) .*?style=\".*?font-style:\\s*italic[^>]*>)(.*?)</\\2>", "$1<i>$3</i></$2>" 
```

有两个单独的表达式：

```
"(<span .*?style=\".*?font-style:\\s*italic[^>]*>)(.*?)</span>", "$1<i>$2</i></span>"
"(<font .*?style=\".*?font-style:\\s*italic[^>]*>)(.*?)</font>", "$1<i>$2</i></font>" 
```

诚然，文件解析加倍，但正则表达式更简单，引用更少，在实践中可能更快。它不是很好（重复代码），但只要它有效......

有趣的是，我做了类似的事情（我手头没有代码）来清理工具生成的 HTML，简化它以便 JavaHelp 可以理解它......这是针对 HTML 的正则表达式可以的一种情况，因为它不是人类犯错误或更改创建 HTML 的小东西，而是一个具有良好定义模式的过程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T10:00:31.307

在测试期间，我发现了奇怪的行为。在单独的线程中运行正则表达式时，它运行得更快。我有 sql 脚本，我使用正则表达式将其拆分为从 Go 到 Go 的部分。在不使用单独线程的情况下处理此脚本时，它会持续大约 2 分钟。但是当使用多线程时，它只持续几秒钟。

# debugging - IIS6：503 错误和 CPU 峰值

> ID：163192
> 
> 赞同：0
> 
> 时间：2008-10-02T16:03:23.983
> 
> 标签：debugging, iis-6, http-status-code-503

所以，有一个写得很糟糕的网站，我偶尔会帮忙，它最初是用经典的 ASP 编写的。

然后通过将全局变量移动到后面的代码并将其余代码留在 aspx 中，将其“移植”到 ASP.NET ......这是一个巨大的混乱。

在某些页面上，似乎触发了偶尔的竞争条件，导致 IIS6 死机（返回 503 错误）并将 CPU 峰值提高到 100%。

我们设置了一些监控工具并在发生这种情况时回收应用程序池以保持站点稳定，但这只是一个创可贴。

有谁知道任何工具可以让我指出正确的方向来找出为什么会发生这种情况？

内存使用率保持不变，因此它不是泄漏参考问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T16:06:31.463

通常最好的起点是 Http.sys 日志：

HTTP.SYS 错误日志 - %windir%\System32\LogFiles\HTTPERR

您还可以检查事件日志和 IIS 日志以查看其中是否有任何其他信息。

# .net - 如何在 .Net 中将字符串用作流？

> ID：163207
> 
> 赞同：6
> 
> 时间：2008-10-02T16:07:07.467
> 
> 标签：.net

我需要调用一个接受流参数的方法。该方法将文本加载到流中，该流通常是一个文件。我想简单地用流的内容填充一个字符串，而不是将其写入文件。我该怎么做呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T16:11:17.117

将 MemoryStream 与 StreamReader 一起使用。就像是：

```
using (MemoryStream ms = new MemoryStream())
using (StreamReader sr = new StreamReader(ms))
{
   // pass the memory stream to method
   ms.Seek(0, SeekOrigin.Begin); // added from itsmatt
   string s = sr.ReadToEnd();
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T16:09:53.903

使用 StringWriter 充当字符串上的流：

```
StringBuilder sb = new StringBuilder();
StringWriter sw = new StringWriter(sb);
CallYourMethodWhichWritesToYourStream(sw);
return sb.ToString(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T16:08:50.100

查找 MemoryStream 类

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T16:31:22.823

```
MemoryStream ms = new MemoryStream();
YourFunc(ms);
ms.Seek(0, SeekOrigin.Begin);
StreamReader sr = new StreamReader(ms);
string mystring = sr.ReadToEnd(); 
```

是一种方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T16:13:26.003

您可以执行以下操作：

```
string s = "Wahoo!";
int n = 452;

using( Stream stream = new MemoryStream() ) {
  // Write to the stream

  byte[] bytes1 = UnicodeEncoding.Unicode.GetBytes(s);
  byte[] bytes2 = BitConverter.GetBytes(n);
  stream.Write(bytes1, 0, bytes1.Length);
  stream.Write(bytes2, 0, bytes2.Length); 
```

# algorithm - 如何测试给定的 BSP 树是否是最优的？

> ID：163225
> 
> 赞同：3
> 
> 时间：2008-10-02T16:09:52.000
> 
> 标签：algorithm, 3d, bsp-tree

我有一个三角形的多边形汤，我想为其构建一个 BSP 树。我当前的程序只是通过从模型中一次插入一个随机三角形来构造一个 BSP 树，直到所有三角形都被消耗完，然后它检查树的深度和宽度并记住它获得的最佳分数（最低深度，最低宽度）。

根据定义，最佳深度为 log2(n)（如果共面三角形被分组，则更小？）其中 n 是我的模型中三角形的数量，最佳宽度为 n（意味着没有发生分裂）。但是，有些三角形的配置永远无法达到这个顶峰。

是否有有效的测试来检查我的 BSP 树的质量？具体来说，我试图找到一种方法让我的程序知道它应该停止寻找更优化的结构。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T16:24:09.720

最优树的构造是一个 NP 完全问题。确定给定的树是否是最优的本质上是相同的问题。

从此[BSP 常见问题解答](http://www.faqs.org/faqs/graphics/bsptree-faq/)：

> 问题是分裂与树平衡之一。这些是相互排斥的要求。您应该根据您打算如何使用树来选择构建好树的策略。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T16:20:37.577

随机构建 BSP 树，直到你有机会找到一个好的树，这将是非常非常低效的。

与其随机选择一个 tri 来用作分割平面，不如尝试几个（可能是所有这些，或者可能是随机抽样）并根据一些启发式方法选择一个。启发式通常基于 (a) 生成的子节点的平衡程度，以及 (b) 将拆分多少 tris。

您可以通过考虑更小或更大的 tris 样本作为候选分割平面来权衡性能和质量。

但最终，您不能指望为任何真实世界的数据获得完全最优的树，因此您可能不得不满足于“足够好”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-19T04:51:59.330

*   尝试选择（可能）被大多数平面分割的平面作为分割平面。分割平面不能分割。
*   尝试选择前后飞机数量接近的飞机。
*   尝试选择不会导致太多分裂的飞机。
*   尝试选择与许多其他表面共面的平面

您必须对这个标准进行抽样并提出一个评分系统来决定哪一个最有可能成为分裂平面的好选择。例如，越不平衡，它失去的分数就越多。如果它导致 20 次分裂，则惩罚为 -5 * 20（例如）。选择得分最高的一项。您不必对每个多边形进行采样，只需搜索一个非常好的多边形。

# version-control - 错误编号注释

> ID：163232
> 
> 赞同：8
> 
> 时间：2008-10-02T16:11:13.543
> 
> 标签：version-control, bug-tracking

你为什么要加

> //错误 1024

注释到源代码控制的代码库中？大多数错误跟踪和源代码控制系统都能够更好地跟踪这些信息。在源代码管理中，标签或注释可以与签入一起使用。在错误跟踪器中，可以将修订号添加到错误的解决方案中。那么为什么要注释代码呢？特别是因为这些评论的相关性非常短暂，而且它们往往会堆积乱七八糟的代码库。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-02T16:15:50.660

前几天我在我们的代码库中发现其中一个很有帮助。

我说“他为什么要第二次调用初始化函数，工作流程这么晚？？”

错误评论让我正确的问题描述。当我重新编写代码时，我肯定会在我的测试中包含该错误并且没有重新引入它。

虽然我会说，总的来说，我同意你的观点，并且我自己不会插入这些内容。

我更希望有问题的开发人员以更有意义的方式修复错误，这样我一开始就不必怀疑代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T16:14:49.743

最后，我认为这是一个不好的做法。最好包括错误存在的原因（Y 类型的 foo 没有属性 Z）。如果需要，您可以在其中包含“更多错误 ID 12345”。

如果您在多个级别上进行集成，trac 中的源代码视图可以直接链接到 BugId。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T16:14:07.857

纯粹的懒惰。当然，从长远来看需要更多时间，但从短期来看，“//Bug 1024”一点也不费力。你拥有的代码越多，情况就越糟糕。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T16:14:53.097

想象一下，您有一个新错误，您可以追踪到修订版 12345 中的更改。您查看日志，它立即告诉您错误 1024 是进行更改的原因。

然后，您可以查看 1024 以了解内容、原因和时间，然后再进行新的修复 - 即“统治一切的人”。

如果错误编号不在提交消息中，则您必须搜索提交修复的错误 - 这可能是多个（如果错误被多次报告）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T16:19:27.533

我认为这是一个“我有锤子，那一定是钉子”的案例。您的文本编辑器或 IDE 并不是您管理代码的唯一工具。

历史最好在代码外部维护。当代码的含义不是很明显时，应该在注释中描述。

我同意错误编号应该在源代码控制提交消息中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-02T16:30:32.013

你不应该只添加错误编号。如果您为单个错误进行了多次签入，则应添加错误编号和主题以及任何限定符：

错误 1111 - Foo 在 64 位系统上被破坏。修复 #2，因为它在合并到主干后重新打开。

某些系统具有错误编号集成。在 mxr.mozilla.org 中，cvs 日志显示中的错误编号自动神奇地变成了指向 bugzilla.mozilla.org 编号的链接。当您在代码中挖掘时，这是一个巨大的节省时间。我认为 Fogbugz 有类似的功能......

此外，即使您的系统没有，它通常也会有所帮助，因为没有人希望看到评论更改的整个上下文，这就是错误跟踪器的用途。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T16:16:58.863

我同意你的看法，这样的评论并没有真正的帮助，而且太简短了。

然而，使用缺陷跟踪系统（或扩展到您可能拥有的任何 KM 存储库）中的记录来评论代码是非常有用和重要的。

有时会更改代码以解决应用程序行为的某个问题。有时引入的解决方法是不合逻辑的。经常发生的情况是，当其他人更新代码时，作为重构工作的一部分，这段“坏”代码会被删除。

因此，将代码标记为属于特定的错误修复使其在重构期间可见，从而促使开发人员在更改代码之前查看错误描述。它还有助于在重新打开错误的情况下 - 如果您必须多次更改代码的同一部分，您可能会考虑在替代解决方案上投入时间。

PS，您可能会认为Joel On Software 的[这篇](http://www.joelonsoftware.com/items/2008/02/19.html)关于 MS Office 的文章很有帮助。据我所知，MS Office 和 MS Windows 的代码中充满了类似的注释，这些注释解释了开发人员早已不复存在的决定。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-02T16:18:08.970

我发现它在解释看起来错误的代码时很有用，也适用于提交消息。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-02T16:28:27.010

我不那样做。我想不出你将缺陷 ID 放入代码的充分理由。我会将其放在发行说明/变更日志中。

我发现有用的是在自动化测试中使用缺陷 ID 作为名称的一部分：

```
[TestFixture]
public class Release_1_2_Bugfixes
{
  [Test]
  public void TestBug42()
  {
    Assert.AreEqual(42, CalculateAnswerToLifeUniverseAndEverything());
  }
} 
```

我见过[其他项目](http://code.google.com/p/v8/source/browse#svn/trunk/test/mjsunit/bugs)做同样的事情。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-02T17:52:29.663

我很惊讶有多少人反对这一点。我个人对此的感觉是，这是一个非常*好的*主意。我同意之前的评论，即它应该包括的不仅仅是错误编号，如果合适的话，最好包括一个简短的摘要和到错误跟踪系统的链接。

这些评论的好处只有在具有历史和大量先前错误修复的旧项目中才明显。您不必在任何地方都进行这些注释，但是当将它们放置在没有上下文可能没有意义的代码块之前时，它们非常有用。在任何一种相当复杂的系统中，都会有一些在没有上下文的情况下看起来不合逻辑或不必要的代码片段。

由于与系统的交互或旧的解决方法，代码*是*必要的。为了防止以后有人重新引入已修补的错误，表示代码块旨在修复的错误非常有帮助，最好附上某种类型的解释。否则，由于提交日志中记录的原因，您依赖于某人仔细检查提交历史记录，这是极不可能的，尤其是在有人正在重构代码的情况下。

**编辑**：我特别指的是把这些放在一段不寻常或需要额外上下文的代码中。评论您所做的每一个错字修复都没有帮助或没有必要:-)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T16:14:52.643

我一直这样做，直到 Visual Studio 2008 附带注释。当回顾旧代码时，它很有用，可以立即看到至少在特定代码决策背后是经过深思熟虑的。

是的，我知道您可以与以前的版本进行比较，但是当您只需要对较小的代码更新有一个快速的感觉时，这真是让人头疼。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-02T16:18:14.383

如果您正在浏览不熟悉的源代码，并且看到一些不明显的东西，那么很高兴知道原因。虽然这是一个判断电话，但并非每个错误修复都需要这样的解释 - 可能大多数人都可以在没有它的情况下逃脱。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-02T16:30:08.910

如果有足够的理由相信某人在查看部分代码时会想知道错误编号，那么添加一个提及错误的注释可能会非常好（但希望它也能解释错误的重要部分）。

是的，源代码控制提交消息也应该包含错误编号，查看修订日志可以为您提供相同的信息......但是如果代码的同一部分被多次更改，但从最初的错误中学到的细节仍然适用，可能需要一段时间才能找到原始更改以了解该错误。

此外，当有充分的理由将代码从一个类移动到另一个类或重命名文件时，就会出现这种情况，这将使找到某个代码部分背后的原因变得更加困难（重命名不是SVN 的问题，但 CVS 的痛苦）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-02T16:45:33.087

“相关性非常短暂，它们往往会堆积乱七八糟的代码库”。

源文件中积累的每一点无用的垃圾都会使它们的可读性降低，并且难以维护。删除所有不增加价值的东西。“Bug 12345”现在几乎没有价值，几周后就没有了。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-02T17:10:37.363

我们在一个包含许多开发人员和多个已发布分支的大型系统上工作。

这些错误参考注释实际上在从一个分支移植到另一个分支期间非常有用，特别是因为我们使用的 SCM 系统功能非常差，并且提交注释很难获得，或者可能非常陈旧。

如果修复很简单，那么它可能不需要错误标记。如果它不是显而易见的，那么参考一个 Bug 然后在评论部分写一个长的解释可能更有意义。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-02T17:22:04.417

我不喜欢这种涂鸦。像其他令人反感的生命形式一样，它们会随着时间的推移而增加，阻塞代码库。

当人们进行与先前的错误修复重叠的错误修复时，麻烦就真正开始了。然后，您将有错误编号标记一段完全错误或具有误导性的代码。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-02T19:19:00.440

这种类型的评论*非常*有用：当您更改错误跟踪或源代码控制工具时会发生什么？参考 BZ1722 与 FB3101 会告诉您要检查的跟踪工具（例如 Bugzilla 或 FogBugz）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-02T19:55:19.900

那是一件好事！

正在查看代码的人不太可能了解代码的完整历史，并且可能会撤消非常重要的更改，因为他们以前可能没有在代码的这个领域工作过。它可以解释看起来很疯狂的代码或同样奇怪的客户要求。

你不能总是通过架构和代码来捕捉客户需求的细节，尤其是当他们要求一些愚蠢的东西时。因此，您从明智的开始，然后当您被迫这样做时，将代码改进或修改为愚蠢的代码，错误编号支持了疯狂代码的意图。

# http - 在哪里可以找到标准 HTTP 标头值列表？

> ID：163236
> 
> 赞同：6
> 
> 时间：2008-10-02T16:11:24.883
> 
> 标签：http, http-headers, web-standards

我正在寻找 Web 服务器通常会收到的所有当前标准标头值。一个例子是“当来自运行 OS X Leopard 和 Camino 的 Mac 时，标题会是什么样子？” 或者“当来自运行 Firefox 3.0.1 的 Fedora 9 与运行 Konqueror 的 SuSe 时，标题会是什么样子？”

[PConroy](https://stackoverflow.com/questions/163236/where-can-i-find-a-list-of-standard-http-header-values#163306)给出了一个[来自 JQuery 的示例，](http://jquery.thewikies.com/browser/test.html)该示例倾向于我正在寻找的内容。 **我想要的是实际的示例标题。**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T16:15:27.107

你试过[RFC](http://www.faqs.org/rfcs/rfc2616.html)吗？它拥有所有这些信息。

实际上，在搜索任何协议或标准的信息时，请先尝试搜索 RFC。

干杯。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T16:14:22.317

关于用户代理，这完全取决于应用程序的创建者。请参阅 user-agent 的这个半开玩笑的[历史](http://www.webaim.org/blog/user-agent-string-history/)。总之，确实没有一组规范的值。基于 Microsoft 的用户代理可能会根据本地计算机上安装的软件（.NET 框架版本等）而改变。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T16:24:29.830

没有固定的用户代理值列表。您可以找到冗长的列表（例如[JQuery 浏览器插件](http://jquery.thewikies.com/browser/)使用的[这个](http://jquery.thewikies.com/browser/test.html)列表）。

关于其他 HTTP 标头，[这篇维基百科文章](http://en.wikipedia.org/wiki/List_of_HTTP_headers)是一个很好的起点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-02-04T17:28:15.880

[IANA](http://www.iana.org/)跟踪 HTTP 标头

> IANA 负责维护各种 Internet 协议中包含的许多代码和数字，如下所列。我们与 Internet 工程任务组 (IETF) 协作提供此服务。

包括：

消息头

*   永久消息头字段名称
*   临时消息头字段名称

这是最初基于[RFC 4229](https://www.rfc-editor.org/rfc/rfc4229)[的详尽列表](http://www.iana.org/assignments/message-headers/message-headers.xhtml)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T16:16:05.497

对于用户代理，一个快速的谷歌搜索拉出了[这个站点](http://www.zytrax.com/tech/web/browser_ids.htm)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T17:35:50.313

HTTP 标头列表在 W3 网站上很容易获得：

*   [http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)

[PConroy](https://stackoverflow.com/users/2287/pconroy)还链接到 wikipedia 页面，该页面更简洁，格式更简单：

*   [http://en.wikipedia.org/wiki/List_of_HTTP_headers](http://en.wikipedia.org/wiki/List_of_HTTP_headers)

但是，“User-Agent”标头是一个不好的例子，因为没有设置响应；用户代理字符串由客户端决定，因此它实际上可以是任何东西。有一个非常全面[的用户代理列表](http://user-agents.org/)可用，但不一定会涵盖任何可能的选项，因为即使某些工具栏和应用程序也可以修改 Internet Explorer 或其他浏览器的用户代理。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T17:42:21.920

O'Reilly的[花栗鼠书和](http://oreilly.com/catalog/9781565925090/)[Chris Shiflett 的 HTTP 参考书](http://shiflett.org/books)一样好。

哦，哎呀，这不是花栗鼠。这是一只十三行的地松鼠。

# sql-server - SQL Server 相当于 Oracle 的 CREATE OR REPLACE VIEW

> ID：163246
> 
> 赞同：119
> 
> 时间：2008-10-02T16:13:08.483
> 
> 标签：sql-server

在 Oracle 中，我可以使用单个语句重新创建视图，如下所示：

```
CREATE OR REPLACE VIEW MY_VIEW AS
SELECT SOME_FIELD
FROM SOME_TABLE
WHERE SOME_CONDITIONS 
```

正如语法所暗示的，这将删除旧视图并使用我给出的任何定义重新创建它。

MSSQL（SQL Server 2005 或更高版本）中是否有类似的功能可以做同样的事情？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2011-03-03T18:28:20.357

上面的解决方案虽然可以完成工作，但这样做会冒着放弃用户权限的风险。我更喜欢按如下方式创建或替换视图或存储过程。

```
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_myView]'))
    EXEC sp_executesql N'CREATE VIEW [dbo].[vw_myView] AS SELECT ''This is a code stub which will be replaced by an Alter Statement'' as [code_stub]'
GO

ALTER VIEW [dbo].[vw_myView]
AS
SELECT 'This is a code which should be replaced by the real code for your view' as [real_code]
GO 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-10-02T16:14:55.453

您可以使用“IF EXISTS”来检查视图是否存在，如果存在则删除。

```
如果存在（从 INFORMATION_SCHEMA.VIEWS 中选择 TABLE_NAME
        WHERE TABLE_NAME = '我的视图')
    删除视图我的视图
去

创建视图 MyView
作为
     ……
去

```

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2016-11-20T17:59:30.687

供您参考，**`SQL Server 2016 SP1+`**可以使用`CREATE OR ALTER VIEW`语法。

> [MSDN 创建视图](https://msdn.microsoft.com/en-us/library/ms187956.aspx)：
> 
> ```
> CREATE [ OR ALTER ] VIEW [ schema_name . ] view_name [ (column [ ,...n ] ) ]   
> [ WITH <view_attribute> [ ,...n ] ]   
> AS select_statement   
> [ WITH CHECK OPTION ]   
> [ ; ] 
> ```
> 
> **或改变**
> 
> 仅当视图已存在时才有条件地更改视图。

**[db<>小提琴演示](https://dbfiddle.uk/?rdbms=sqlserver_2017&fiddle=159a876489f078e76c8a0e4cede1295a)**

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-06-02T11:41:54.397

我用：

```
IF OBJECT_ID('[dbo].[myView]') IS NOT NULL
DROP VIEW [dbo].[myView]
GO
CREATE VIEW [dbo].[myView]
AS 
```

...

最近我为这类东西添加了一些实用程序：

```
CREATE PROCEDURE dbo.DropView
@ASchema VARCHAR(100),
@AView VARCHAR(100)
AS
BEGIN
  DECLARE @sql VARCHAR(1000);
  IF OBJECT_ID('[' + @ASchema + '].[' + @AView + ']') IS NOT NULL
  BEGIN
    SET @sql  = 'DROP VIEW ' + '[' + @ASchema + '].[' + @AView + '] ';
    EXEC(@sql);
  END 
END 
```

所以现在我写

```
EXEC dbo.DropView 'mySchema', 'myView'
GO
CREATE View myView
...
GO 
```

我认为它使我的变更脚本更具可读性

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-02T16:18:53.493

我通常使用这样的东西：

```
if exists (select * from dbo.sysobjects
  where id = object_id(N'dbo.MyView') and
  OBJECTPROPERTY(id, N'IsView') = 1)
drop view dbo.MyView
go
create view dbo.MyView [...] 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-10-30T19:41:55.037

从 SQL Server 2016 开始，您拥有

```
DROP TABLE IF EXISTS [foo]; 
```

[MSDN 源码](https://msdn.microsoft.com/en-us/library/ms173790.aspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-11-20T13:24:29.893

它适用于我在 SQL Server 2017 上：

```
USE MSSQLTipsDemo 
GO
CREATE OR ALTER PROC CreateOrAlterDemo
AS
BEGIN
SELECT TOP 10 * FROM [dbo].[CountryInfoNew]
END
GO 
```

[https://www.mssqltips.com/sqlservertip/4640/new-create-or-alter-statement-in-](https://www.mssqltips.com/sqlservertip/4640/new-create-or-alter-statement-in-)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-02T16:18:55.927

您可以使用 ALTER 来更新视图，但这与 Oracle 命令不同，因为它仅在视图已经存在时才有效。DaveK 的回答可能会更好，因为这将始终有效。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-02-13T09:03:06.497

在 SQL Server 2016（或更高版本）中，您可以使用：

```
CREATE OR ALTER VIEW VW_NAMEOFVIEW AS ... 
```

在旧版本的 SQL Server 中，您必须使用类似的东西

```
DECLARE @script NVARCHAR(MAX) = N'VIEW [dbo].[VW_NAMEOFVIEW] AS ...';

IF NOT EXISTS(SELECT * FROM sys.views WHERE name = 'VW_NAMEOFVIEW')
-- IF OBJECT_ID('[dbo].[VW_NAMEOFVIEW]') IS NOT NULL
BEGIN EXEC('CREATE ' + @script) END
ELSE
BEGIN EXEC('ALTER ' + @script) END 
```

或者，如果视图上没有依赖项，您可以删除它并重新创建：

```
IF EXISTS(SELECT * FROM sys.views WHERE name = 'VW_NAMEOFVIEW')
-- IF OBJECT_ID('[dbo].[VW_NAMEOFVIEW]') IS NOT NULL
BEGIN 
   DROP VIEW [VW_NAMEOFVIEW];
END

CREATE VIEW [VW_NAMEOFVIEW] AS ... 
```

# architecture - 在 32 位 CPU 上，“整数”类型是否比“短”类型更有效？

> ID：163254
> 
> 赞同：11
> 
> 时间：2008-10-02T16:14:35.627
> 
> 标签：architecture, integer, cpu, 32-bit, cpu-architecture

在 32 位 CPU 上，一个整数是 4 个字节，一个短整数是 2 个字节。如果我正在编写一个使用许多数值的 C/C++ 应用程序，这些数值总是在提供的短整数范围内，使用 4 字节整数还是 2 字节整数更有效？

我听说它建议 4 字节整数更有效，因为这适合从内存到 CPU 的总线带宽。但是，如果我将两个短整数相加，CPU 是否会将这两个值并行打包一次（从而跨越总线的 4 字节带宽）？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-02T16:28:09.773

如果您有大量数字，请使用可行的最小尺寸。使用 16 位 short 数组比使用 32 位整数更有效，因为您可以获得两倍的缓存密度。与高速缓存未命中的成本相比，CPU 为处理 32 位寄存器中的 16 位值而必须进行的任何符号扩展的成本都可以忽略不计。

如果您只是在与其他数据类型混合的类中使用成员变量，那么它就不那么明确了，因为填充要求可能会消除 16 位值的任何节省空间的好处。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-02T16:16:11.813

是的，您绝对应该在 32 位 CPU 上使用 32 位整数，否则最终可能会屏蔽掉未使用的位（即，它将始终以 32 位进行数学运算，然后将答案转换为 16 位）

它不会一次为您执行两个 16 位操作，但是如果您自己编写代码并且确定它不会溢出，则可以自己执行。

**编辑**：我应该补充一点，它在某种程度上也取决于您对“高效”的定义。虽然它能够更快地执行 32 位操作，但您当然会使用两倍的内存。

如果这些被用于某个内部循环中的中间计算，则使用 32 位。但是，如果您从磁盘读取它，或者即使您只需要为缓存未命中付费，使用 16 位整数可能仍然会更好。与所有优化一样，只有一种方法可以知道：**profile it**。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-02T16:39:01.137

如果您使用“许多”整数值，则处理中的瓶颈很可能是内存带宽。16 位整数更紧密地打包到数据缓存中，因此会带来性能优势。

如果您对大量数据进行数字运算，您应该阅读Ulrich Drepper 的[每个程序员应该了解的关于内存的知识。](http://people.redhat.com/drepper/cpumemory.pdf)专注于第 6 章，关于最大化数据缓存的效率。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-08-24T18:31:07.060

32 位 CPU 是通常在内部对 32 位值进行操作的 CPU，但这并不意味着在对 8/16 位值执行相同操作时它会更慢。例如，x86 仍然向后兼容到 8086，可以对寄存器的小数部分进行操作。这意味着即使一个寄存器是 32 位宽，它也只能在该寄存器的前 16 位或前 8 位上运行，并且根本不会减速。这个概念甚至被 x86_64 采用，其中寄存器是 64 位，但它们仍然只能在前 32、16 或 8 位上运行。

此外，x86 CPU 总是从内存中加载整个缓存行，如果尚未在缓存中，并且缓存行无论如何都大于 4 字节（对于 32 位 CPU，而不是 8 或 16 字节），因此从内存中加载 2 字节的速度与从内存中加载 4 个字节。如果从内存处理许多值，16 位值实际上可能比 32 位值快得多，因为内存传输较少。如果缓存线是 8 字节，则每个缓存线有四个 16 位值，但只有两个 32 位值，因此当使用 16 位整数时，每四个值有一个内存访问，使用 32 位整数时，每两个值就有一个，导致处理大型 int 数组的传输次数增加一倍。

其他 CPU，例如 PPC，不能只处理寄存器的一部分，它们总是处理整个寄存器。然而，这些 CPU 通常具有特殊的加载操作，允许它们从内存加载 16 位值，将其扩展为 32 位并将其写入寄存器。后来他们有一个特殊的存储操作，从寄存器中取出值，只将最后 16 位存储回内存；两种操作都只需要一个 CPU 周期，就像 32 位加载/存储一样，因此也没有速度差异。而且由于 PPC 只能对寄存器执行算术运算（与 x86 不同，它也可以直接对内存进行操作），因此无论您使用 32 位整数还是 16 位整数，都会发生此加载/存储过程。

唯一的缺点是，如果您在只能对完整寄存器进行操作的 32 位 CPU 上链接多个操作，则上一个操作的 32 位结果可能必须在执行下一个操作之前“缩减”为 16 位，否则结果可能不正确。不过，这样的缩减只是一个 CPU 周期（一个简单的 AND 操作），编译器非常擅长确定何时真正需要这种缩减，以及何时将其排除在外不会对最终结果产生任何影响，所以这样的缩减并不是在每条指令之后都执行，只有在确实不可避免的情况下才会执行。一些 CPU 提供了各种“增强”指令，这使得这种削减变得不必要，我在生活中见过很多代码，我曾期望这样的削减，但查看生成的汇编代码，

So if you expect a general rule here, I'll have to disappoint you. Neither can one say for sure that 16 bit operations are equally fast to 32 bit operations, nor can anyone say for sure that 32 bit operations will always be faster. It depends also what exactly your code is doing with those numbers and how it is doing that. I've seen benchmarks where 32 bit operations were faster on certain 32 bit CPUs than the same code with 16 bit operations, however I also already saw the opposite being true. Even switching from one compiler to another one or upgrading your compiler version may already turn everything around again. I can only say the following: Whoever claims that working with shorts is significantly slower than working with ints, shall please provide a sample source code for that claim and name CPU and compiler he used for testing, since I have never experienced anything like that within about the past 10 years. There may be some situations, where working with ints is maybe 1-5% faster, yet anything below 10% is not "significant" and the question is, is it worth to waste twice the memory in some cases only because it may buy you 2% performance? I don't think so.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T16:34:42.817

这取决于。如果您受 CPU 限制，32 位 CPU 上的 32 位操作将比 16 位快。如果您受内存限制（特别是如果您有太多 L2 缓存未命中），则使用您可以挤入的最小数据。

您可以找出您正在使用哪个分析器，该分析器将测量 CPU 和 L2 未命中，如[Intel 的 VTune](http://www.intel.com/cd/software/products/asmo-na/eng/vtune/239144.htm)。您将以相同的负载运行您的应用程序 2 次，它会将 2 次运行合并到应用程序中热点的一个视图中，您可以查看每一行代码在该行上花费了多少周期。如果在昂贵的代码行中，您看到 0 次缓存未命中，则说明您受 CPU 限制。如果您看到大量未命中，则说明您的记忆力有限。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-12-05T22:58:56.367

不要听劝告，试试看。

这可能在很大程度上取决于您正在使用的硬件/编译器。快速测试应该可以快速解决这个问题。写测试的时间可能比在这里写问题要少。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T16:38:12.980

如果您在大型数据集上进行操作，最大的担忧是内存占用。在这种情况下，一个好的模型是假设 CPU 速度无限快，然后花时间担心必须将多少数据移入/移出内存。事实上，CPU 现在速度如此之快，以至于有时对数据进行编码（例如，压缩）效率更高。这样一来，CPU （可能）做更多的工作（解码/编码），但内存带宽大大减少。

因此，如果您的数据集很大，您最好使用 16 位整数。如果您的列表已排序，您可能会设计一个涉及差分或游程编码的编码方案，这将进一步减少内存带宽。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-05T22:52:31.433

当您说 32 位时，我假设您的意思是 x86。16 位算术非常慢：操作数大小前缀使解码*非常*慢。所以不要让你的临时变量短 int 或 int16_t。

但是，x86 可以有效地将 16 位和 8 位整数加载到 32 位或 64 位寄存器中。（movzx / movsx：零和符号扩展）。因此，请随意对数组和结构字段使用 short int，但请确保对临时变量使用 int 或 long。

> 但是，如果我将两个短整数相加，CPU 是否会将这两个值并行打包一次（从而跨越总线的 4 字节带宽）？

那是胡说八道。加载/存储指令与 L1 缓存交互，限制因素是操作数；宽度无关紧要。例如，在 core2 上：每个周期 1 次加载和 1 次存储，无论宽度如何。L1 缓存有一个 128 或 256 位路径到 L2 缓存。

如果负载是您的瓶颈，那么您在加载后用轮班或掩码拆分一个广泛的负载可能会有所帮助。或者使用SIMD并行处理数据，并行加载后无需解包。

# ruby-on-rails - What do you need to take into consideration when deciding between MySQL and Amazon's SimpleDB for a RoR app?

> ID：163275
> 
> 赞同：9
> 
> 时间：2008-10-02T16:16:50.643
> 
> 标签：ruby-on-rails, ruby, amazon-web-services, amazon-simpledb

I am just beginning to do research into the feasibility of using Amazon's SimpleDB service as the datastore for RoR application I am planning to build. We will be using EC2 for the web server, and had planned to also use EC2 for the MySQL servers. But now the question is, why not use SimpleDB?

The application will (if successful) need to be very scalable in terms of # of users supported, will need to maintain a simple and efficient code base, and will need to be reliable.

I'm curious as to what the SO communities thoughts are on this.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T16:20:58.667

Well, considering simple DB doesn't use SQL, or even have tables, means that it's a completely different beast than MySQL and other SQL-based things ([http://aws.amazon.com/simpledb/](http://aws.amazon.com/simpledb/)). There are no constraints, triggers, or joins. Good luck.

Here's one way of getting it up and running: [http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1242](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1242) (via [http://rubyforge.org/projects/aws-sdb/](http://rubyforge.org/projects/aws-sdb/) )

I suppose if you're never going to need to query the data outside of rails, then SimpleDB may prove to be OK. But as it's not a first-class supported DB, you're likely to run into bugs that are difficult to fix. I wouldn't want to run a production rails app in a semi-beta backend.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T16:54:15.310

The Ruby SimpleDB library is not as complete as ActiveRecord (the default Rails DB adapter), so many of the features you're used to will not be there.

On the plus side it's schemaless, scalable and works well with ec2.

If you're going to do things like full text search in your app then SimpleDB might not be the best choice, stick with AR + sphinx.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-20T18:02:29.383

To me this just feels like, "Hey there are these neat tools out there, I should go build a project using them," rather than actually needing to use these specific tools. Maybe I'm just being crabby but it feels like a classic case of premature optimization. You're trying to use an external service that costs money for an app that isn't even written yet and you don't say you've got a guaranteed audience or one that will necessarily scale to a level that warrants that.

"The application will (if successful) need to be very scalable in terms of # of users supported", seriously, that describes half the Internet. It's the "if successful" part that's really the question. Just concentrate on building the application quickly and easily. The easiest way to do that is just use ROR as it is out-of-the-box so to speak. Pair it with a database, use ActiveRecord and get something built and attracting users.

In fact, I'll go further and say that EC2 is rather expensive for always on servers. Deploy it over on Slicehost or another hosted solution and then move it to EC2 if you need to in order to support demand.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T16:21:07.280

I myself am very interested in this topic. Right now I'm on a cloud computing high so I'd say go with SimpleDB since it'll probably scale better in the sense that you'll have high availability, but that's just my thoughts as of the moment. Not from experience yet.

Edit: It's true that SimpleDB has no normal features a "normal" database, but it should do the trick if you only need a simple CRUD layer to work against, which is my case

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-20T17:50:51.483

There's a library called [SimpleRecord](http://gemcutter.org/gems/simple_record) that is a drop in replacement for ActiveRecord, but uses SimpleDB as its backend data store.

# html - Textarea overflow-x when a user copy-pastes into it?

> ID：163294
> 
> 赞同：1
> 
> 时间：2008-10-02T16:21:35.297
> 
> 标签：html, textarea, copy-paste

I have a textarea with overflow-x: auto; attributed to it. It works great when a user is typing text into the box by hand. When a user copy pastes a line from a file, however, that is bigger than my textarea, the overflow-x property does not work, instead the textarea wordwraps the long line.

Is there a way (maybe javascript) to make overflow-x work on copy-paste?

Thanks.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-04T17:59:17.850

我不确定您要实现什么 - 当用户输入文本时文本区域会自动扩展吗？我无法仅使用 HTML 和 CSS 创建这样的行为。

理论上，您可以将 textarea wrap 属性设置为“no”，这将在用户输入或粘贴长行时强制创建水平滚动条。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T16:41:43.377

From the looks of it, it would seem that the text comes pre-wordwrapped from the editor. What editor are you using, and on which platform are you experiencing this behaviour?

# apache - How do I ignore a directory in mod_rewrite?

> ID：163302
> 
> 赞同：74
> 
> 时间：2008-10-02T16:23:38.147
> 
> 标签：apache, mod-rewrite

I'm trying to have the modrewrite rules skip the directory `vip`. I've tried a number of things as you can see below, but to no avail.

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
#RewriteRule ^vip$ - [PT]
RewriteRule ^vip/.$ - [PT]
#RewriteCond %{REQUEST_URI} !/vip 
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress 
```

How do I get modrewrite to entirely ignore the `/vip/` directory so that all requests pass directly to the folder?

### Update:

As points of clarity:

*   It's hosted on Dreamhost
*   The folders are within a wordpress directory
*   the /vip/ folder contains a webdav .htaccess etc (though I dont think this is important

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-10-02T17:22:50.110

试着把它放在任何其他规则之前。

```
RewriteRule ^vip - [L,NC] 
```

它将匹配任何以 URI 开头的 URI `vip`。

*   `-`手段无所作为。
*   这`L`应该是最后的规则；忽略后面的一切。
*   表示没有案例（因此`NC`“VIP”也匹配）。

请注意，它匹配任何*开头* `vip`的内容。表达式`^vip$`将匹配`vip`但不匹配`vip/`or `vip/index.html`。这`$`可能是你的垮台。如果你真的想把它做对，你可能想去，`^vip(/|$)`所以你不匹配`vip-page.html`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-07T21:32:06.527

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d 
```

这表示如果它是现有文件或目录，请不要触摸它。您应该能够访问 site.com/vip 并且不应该发生重写规则。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-08-09T23:27:45.553

您正在添加的代码以及提供重写规则/条件的所有答案都是无用的！默认的 WordPress 代码已经完成了您需要的所有操作：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L] 
```

这些行说“如果它不是现有文件 ( `-f`) 或目录 ( `-d`)，则将其传递给 WordPress。添加额外的规则，无论它们多么具体或好，都是多余的——你应该已经被 WordPress 规则所涵盖！

那他们为什么不工作？？？

`.htaccess`目录中的`vip`引发错误。如果您使用密码保护目录，则会发生完全相同的事情。

这是解决方案：

```
ErrorDocument 401 /err.txt
ErrorDocument 403 /err.txt 
```

在 WordPress 代码之前插入这些行，然后创建 /err.txt。这样，当它遇到您的 WebDAV（或受密码保护的目录）并失败时，它将转到该文件，并被现有的默认 WordPress 条件 ( `RewriteCond %{REQUEST_FILENAME} !-f`) 捕获。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-08-08T17:35:33.660

总之，最终的解决方案是：

```
ErrorDocument 401 /misc/myerror.html
ErrorDocument 403 /misc/myerror.html

# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress 
```

我在我的具体情况下发布了更多关于这个问题的原因，涉及 Dreamhost 上的 Wordpress 和 WebDAV，我希望[我的网站](http://codyaray.com/2010/08/wordpress-webdav-and-dreamhost "Wordpress、WebDAV 和 Dreamhost")上还有很多其他人。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-02T18:31:22.550

您提到您在要忽略的目录中已经有一个 .htaccess 文件 - 您可以使用

```
RewriteEngine off 
```

在那个 .htaccess 中停止使用 mod_rewrite （不确定您是否在该文件夹中使用 mod_rewrite，如果您是，那将无济于事，因为您无法将其关闭）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-06-11T06:55:12.627

尝试替换这部分代码：

```
重写规则 ^vip/.$ - [PT]
```

...具有以下内容：

```
RewriteCond %{REQUEST_URI} !(vip) [NC]
```

那应该可以解决问题。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-11-29T20:03:35.100

```
RewriteCond %{REQUEST_URI} !^pilot/ 
```

是这样做的方法。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-10-21T23:02:51.727

就我而言，**brentonsrine**的答案（我看到**matdumsa**也有同样的想法）是正确的……我想对他们的答案进行投票，但是作为新来的，我没有“声誉”，所以我有写一个完整的答案，以强调我认为这里真正的关键。

其中一些答案将成功阻止 WordPress index.php 被使用......但在许多情况下，这样做的原因是有一个真实的目录，其中包含您想要直接显示的真实页面，并且

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d 
```

生产线已经解决了这个问题，所以在像我这样的情况下，这些解决方案中的大多数都会分散注意力。

关键是**brentonsrine**认为错误是次要影响，是由我试图直接显示的目录中的密码保护引起的。通过放入

```
ErrorDocument 401 /err.txt
ErrorDocument 403 /err.txt 
```

行并创建错误页面（我实际上创建了 err401.html 和 err403.html 并提供了更多信息性错误消息）当它找不到任何页面以显示需要 401 身份验证时，我停止生成 404 响应，然后文件夹工作正如预期的那样......显示一个apache登录对话框，然后是文件夹的内容，或者失败时，我的错误401页面。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-04-19T01:31:12.110

我在使用 wordpress 时遇到了同样的问题，发现该问题与没有适当的 401 和 403 错误处理程序有关。

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d 
```

这些条件应该不会重写现有文件夹的 url，但它们不会为受密码保护的文件夹完成工作。就我而言，将以下两行添加到我的根 .htaccess 解决了问题：

```
ErrorDocument 401 /misc/myerror.html
ErrorDocument 403 /misc/myerror.html 
```

当然你需要创建/misc/myerror.html，

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-02-27T22:51:08.320

这有效...

```
RewriteRule ^vip - [L,NC] 
```

但确保这是之后的第一条规则

重写引擎开启

IE

```
ErrorDocument 404 /page-not-found.html

RewriteEngine on

RewriteRule ^vip - [L,NC]

AddType application/x-httpd-php .html .htm

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d 

etc 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-10-02T16:49:44.713

我不确定我是否理解您的目标，但以下内容可能会满足您的需求？

```
RewriteRule ^/vip/(.*)$   /$1?%{QUERY_STRING} [L] 
```

这将导致在没有 /vip 的情况下重写诸如[http://www.example.com/vip/fred.html之类的 URL。](http://www.example.com/vip/fred.html)

# asp.net - 获取 DateA 和 DateB 之间所有日期的最佳方法

> ID：163311
> 
> 赞同：1
> 
> 时间：2008-10-02T16:26:29.467
> 
> 标签：asp.net, css, date

我正在使用 asp:Calander，并且我有一个具有开始日期和结束日期的对象。我需要获取这两个日期之间的所有日期并将它们放在一个数组中，这样我就可以使用不同的 CSS 在日历上呈现相应的日期

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T16:29:43.047

```
DateTime startDate;
DateTime endDate;

DateTime currentDate = startDate;
List<DateTime> dates = new List<DateTime> ();

while (true)
{
    dates.Add (currentDate);
    if (currentDate.Equals (endDate)) break;
    currentDate = currentDate.AddDays (1);
} 
```

它假定 startDate < 比 endDate，您在“日期”列表中获得结果

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T16:38:14.617

```
IEnumerable<DateTime> RangeDays(DateTime RangeStart, DateTime RangeEnd) {
   DateTime EndDate = RangeEnd.Date;

   for (DateTime WorkDate = RangeStart.Date; WorkDate <= EndDate; WorkDate = WorkDate.AddDays(1)) {
      yield return WorkDate;
   }

   yield break;
} 
```

未经测试的代码......但应该可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T16:37:25.383

我投了 AlbertEin 的票，因为他给出了一个很好的答案，但你真的需要一个收藏来保存所有的日期吗？当您渲染一天时，您不能只检查日期是否在指定范围内，然后以不同的方式渲染它，不需要集合。这里有一些代码来演示

```
DateTime RangeStartDate,RangeEndDate; //Init as necessary
DateTime CalendarStartDate,CalendarEndDate; //Init as necessary
DateTime CurrentDate = CalendarStartDate;

String CSSClass;

while (CurrentDate != CalendarEndDate)
{
    if(CurrentDate >= RangeStartDate && CurrentDate <= RangeEndDate)
    {
        CSSClass= "InRange";
    }     
    else
    {
        CSSClass = "OutOfRange";
    }
    //Code For rendering calendar goes here
    currentDate = currentDate.AddDays (1);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T16:56:22.653

```
// inclusive
var allDates = Enumerable.Range(0, (endDate - startDate).Days + 1).Select(i => startDate.AddDays(i));

// exclusive
var allDates = Enumerable.Range(1, (endDate - startDate).Days).Select(i => startDate.AddDays(i)); 
```

# delphi - 使用 P4COM 的奇怪结果

> ID：163313
> 
> 赞同：1
> 
> 时间：2008-10-02T16:26:50.650
> 
> 标签：delphi, version-control, perforce

我正在使用 P4COM 与我们的 perforce 服务器进行通信。我编写了一个小实用程序来简化我们对哪些文件从一个版本更改为另一个版本的 QA。我一直在使用 Delphi 的 P4COM 接口。到现在为止还挺好。

我认为允许用户从我的小实用程序中查看文件的两个版本之间的差异而不是返回到 p4v 可能会很好。所以我使用 p4COM 和以下命令打印（获取）每个修订版的文件

> print -o "E:\Development\TempProjects\p4Changes\temp\File_dispatch.pas#25" "//depot/mydepotpath/File_dispatch.pas"#25

和

> print -o "E:\Development\TempProjects\p4Changes\temp\File_dispatch.pas#26" "//depot/mydepotpath/File_dispatch.pas"#26

但是，当我使用 P4COM 从我的应用程序执行此操作时，我似乎得到了随机文件（它们似乎已被删除）。如果我从命令行运行完全相同的命令，我会得到完美的结果。运行这两个确实会返回一个文件并将其正确转储到我想要的磁盘，它只是不是我要求的文件。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T23:18:29.393

它可能是命令字符串中的反斜杠问题吗？这在命令行中可以正常工作，但是单个反斜杠可能会被您使用的任何语言编译器解释为转义码（如果是 C 或 C++，那么这肯定会导致问题，并且可能发生在幕后P4COM 端）。

尝试使用双反斜杠，看看是否能解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T06:01:43.577

您可能最好将其要求 Perforce 支持本身，因为这听起来像是他们软件中的错误。

作为旁注：你为什么使用 p4v？（我自己非常喜欢 p4win）

# php - 跨其中一个元素切片多维 PHP 数组

> ID：163336
> 
> 赞同：21
> 
> 时间：2008-10-02T16:33:19.107
> 
> 标签：php, arrays, associative-array

例如，您刚刚查询了一个数据库并收到了这个二维数组。

```
$results = array(
    array('id' => 1, 'name' => 'red'  , 'spin' =>  1),
    array('id' => 2, 'name' => 'green', 'spin' => -1),
    array('id' => 3, 'name' => 'blue' , 'spin' => .5)
); 
```

我经常发现自己在写这样的循环。

```
foreach($results as $result)
    $names[] = $result['name']; 
```

我的问题是有没有一种方法可以在不使用循环的情况下获取这个数组 $names？使用回调函数算作使用循环。

这是获取每个字段的更通用示例。

```
foreach($results as $result)
    foreach($result as $key => $value)
        $fields[$key][] = $value; 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2013-03-21T18:51:53.637

截至 6 月 20 日，PHP-5.5 中有一个新函数[array_column](http://us2.php.net/array_column)

例如：

```
$records = array(
    array(
        'id' => 2135,
        'first_name' => 'John',
        'last_name' => 'Doe'
    ),
    array(
        'id' => 3245,
        'first_name' => 'Sally',
        'last_name' => 'Smith'
    ),
    array(
        'id' => 5342,
        'first_name' => 'Jane',
        'last_name' => 'Jones'
    ),
    array(
        'id' => 5623,
        'first_name' => 'Peter',
        'last_name' => 'Doe'
    )
);

$firstNames = array_column($records, 'first_name');
print_r($firstNames); 
```

将返回

```
Array
(
    [0] => John
    [1] => Sally
    [2] => Jane
    [3] => Peter
) 
```

上述链接中还有更多示例。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-02T17:13:38.587

我对@Devon 的回复投了赞成票，因为确实没有办法使用内置函数来完成您所要求的事情。你能做的最好的就是写你自己的：

```
function array_column($array, $column)
{
    $ret = array();
    foreach ($array as $row) $ret[] = $row[$column];
    return $ret;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-11-26T09:04:51.053

从 PHP 5.3 开始，您可以将这个漂亮的调用与 lambda 函数一起使用：

```
$names = array_map(function ($v){ return $v['name']; }, $results); 
```

这将返回按“名称”维度切片的数组。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-02T16:55:30.347

简单地说，没有。

您将需要使用循环或回调函数，如[array_walk](http://us3.php.net/function.array-walk)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T23:07:25.703

我对此进行了更多研究，发现 ruby​​ 和原型都有一个称为[array_pluck](http://us.php.net/manual/en/function.array-map.php#82256) [2](http://groups.google.ca/group/php.notes/browse_thread/thread/0ee4f31c6d98affe)的函数。有趣的是，它`array_map`还有第二个用途，可以让你做与我在这里想做的相反的事情。我还发现有人正在编写一个 PHP[类](http://www.phpclasses.org/browse/package/3565.html)来模拟数组的原型操作。

我将做更多的挖掘工作，如果我没有找到任何其他东西，我将制作一个补丁提交到 internals@lists.php.net 邮件列表，看看他们是否会添加 array_pluck。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-10-04T18:15:16.760

对于那些现在无法升级`PHP5.5`并需要此功能的人，这里是`array_column`.

```
function array_column($array, $column){
    $a2 = array();
    array_map(function ($a1) use ($column, &$a2){
        array_push($a2, $a1[$column]);
    }, $array);
    return $a2;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-07-07T17:38:09.107

如果您运行的是 5.5 和 5.5 之前的 PHP 版本`array_column()`，则可以使用普通 PHP 中的官方替换：

[https://github.com/ramsey/array_column](https://github.com/ramsey/array_column)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T19:12:05.963

我认为这会做你想要的

[array_uintersect_uassoc](http://us2.php.net/manual/en/function.array-uintersect-uassoc.php)

你必须做这样的事情

```
$results = array(
    array('id' => 1, 'name' => 'red'  , 'spin' =>  1),
    array('id' => 2, 'name' => 'green', 'spin' => -1),
    array('id' => 3, 'name' => 'blue' , 'spin' => .5)
);
$name = array_uintersect_uassoc( $results, array('name' => 'value')  , 0, "cmpKey");
print_r($name);

//////////////////////////////////////////////////
// FUNCTIONS
//////////////////////////////////////////////////
function cmpKey($key1, $key2) {
  if ($key1 == $key2) {
    return 0;
  } else {
    return -1;
  }
} 
```

但是，我无权访问 PHP5，所以我没有对此进行测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-03-26T19:08:41.313

你可以这样做：

```
$tmp = array_flip($names);
$names = array_keys($tmp); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-08-11T08:52:17.543

这是 array_column() 的快速函数替代

```
if(!function_exists('array_column')) {
    function array_column($element_name) {
        $ele =   array_map(function($element) {
            return $element[$element_name];
        }, $a);
        return  $ele;
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-12-28T06:40:00.117

其他选择

```
 function transpose(array $array): array
 {
     $out = array();
     foreach ($array as $rowkey => $row) {
        foreach ($row as $colkey => $col) {
                $out[$colkey][$rowkey] = $col;
         }
     }
        return $out;
 }

 function filter_columns(array $arr, string ...$columns): array
 {
     return array_intersect_key($arr, array_flip($columns));
 } 
```

测试

```
$results = array(
    array('id' => 1, 'name' => 'red'  , 'spin' =>  1),
    array('id' => 2, 'name' => 'green', 'spin' => -1),
    array('id' => 3, 'name' => 'blue' , 'spin' => .5)
);

 var_dump(filter_columns(transpose($results),'name'));
 var_dump(filter_columns(transpose($results),'id','name'));
 var_dump(filter_columns(transpose($results),'id','spin')); 
```

# c# - 如何阅读所有提要项目？

> ID：163342
> 
> 赞同：1
> 
> 时间：2008-10-02T16:35:07.323
> 
> 标签：c#

我想阅读 C# 中提要的所有项目。我找到的解决方案仅适用于最近 10 天的最新项目。

有人对此有很好的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T16:37:59.657

用于阅读提要的库通常会读取提要中的所有数据，但提要通常只包含最近的数据——您需要一个包含旧项目的数据源，而不是一个更好的库来读取您拥有的数据。

大多数实体发布提要以允许人们跟踪新内容何时发布，而不是让他们的所有数据以更方便的机器可读格式提供。为此，发布最近的数据只有在节省带宽时才有意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T16:39:02.353

如果您可以连接到诸如 Google Reader 之类的东西，它会存档旧的提要项目（尽管我不确定它是否是永久存档），那么也许您可以做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T16:39:29.200

大多数 RSS 提要仅用于提供相对较短的时间段——提要中的“所有”项目通常需要您随着时间的推移创建自己的存档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T15:45:44.097

扩展托马斯的答案，您可以找到的两个与谷歌相关的提要数据档案是官方的：

谷歌 AJAX 供稿 API [http://code.google.com/apis/ajaxfeeds/](http://code.google.com/apis/ajaxfeeds/)

这会将您限制为 250 项，以及非官方的一项：

谷歌阅读器 API [http://www.niallkennedy.com/blog/2005/12/google-reader-api.html](http://www.niallkennedy.com/blog/2005/12/google-reader-api.html)

这将为您提供无限的（我认为）项目，但您需要解决他们的身份验证（使用 cookie）并祈祷他们不会更改或丢弃 API（因为它没有记录）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T17:17:17.203

我试过谷歌阅读器，但存档不完整。我认识经营博客的人，所以我只是要求他们进行出口。

# sql-server - IN() 子句中的子查询导致错误

> ID：163355
> 
> 赞同：0
> 
> 时间：2008-10-02T16:38:55.583
> 
> 标签：sql-server, subquery, in-clause

我在 SQL Server 2005 上，我收到一个我很确定不应该收到的错误。

```
Msg 512, Level 16, State 1, Procedure spGetSavedSearchesByAdminUser, Line 8 Subquery
returned more than 1 value. This is not permitted when the subquery
follows =, !=, <, <= , >, >= or when the subquery is used as an expression. 
```

我正在关注 [此](http://msdn.microsoft.com/en-us/library/ms177682(SQL.90).aspx)MSDN 链接上的示例#B。

我存储的过程代码如下。如果您要求，我可以为这篇文章简化它：

```
ALTER PROCEDURE [dbo].[spGetSavedSearchesByAdminUser] 
    @strUserName varchar(50)  
    ,@bitQuickSearch bit = 0
AS

BEGIN

    SELECT [intSearchID] ,strSearchTypeCode ,[strSearchName]
    FROM [tblAdminSearches] 

    WHERE 
        strUserName = @strUserName
        AND 
        strSearchTypeCode 
            IN (
                CASE @bitQuickSearch 
                WHEN 1 THEN 'Quick' 
                ELSE (SELECT strSearchTypeCode FROM tblAdvanceSearchTypes) 
                END
            )

    ORDER BY strSearchName
END 
```

我已经检查了子查询的结果集和与子查询结果进行比较的 strSearchTypeCode 之间没有数据类型不匹配。

我看不出为什么这不起作用。如果您有任何线索，请告诉我。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T16:43:41.547

尝试重新排列查询，使布尔表达式出现在子选择中，例如

```
ALTER PROCEDURE [dbo].[spGetSavedSearchesByAdminUser] 
    @strUserName varchar(50)  
    ,@bitQuickSearch bit = 0
AS

BEGIN

    SELECT [intSearchID] ,strSearchTypeCode ,[strSearchName]
    FROM [tblAdminSearches] 

    WHERE 
        strUserName = @strUserName
        AND 
        strSearchTypeCode 
                IN (SELECT strSearchTypeCode FROM tblAdvanceSearchTypes where @bitQuickSearch=0
                    UNION
                    SELECT 'Quick' AS strSearchTypeCode WHERE @bitQuickSearch=1)

    ORDER BY strSearchName
END 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T16:42:28.833

我不知道您可以在这样的 IN 子句中使用 CASE 语句。我建议将该位重写为：

```
WHERE strUserName = @strUserName AND (
   (@bitQuickSearch = 1 AND strSearchTypeCode = 'Quick')
   OR
   (strSearchTypeCode IN (SELECT strSearchTypeCode FROM tblAdvanceSearchTypes))
) 
```

或者，如果您真的很喜欢那里的风格：

```
WHERE strUserName = @strUserName 
   AND strSearchTypeCode IN (
      SELECT CASE @bitQuickSearch WHEN 1 THEN 'Quick' ELSE strSearchTypeCode END
      FROM tblAdvanceSearchTypes
   ) 
```

一般来说，如果@bitQuickSearch = 1，SQL 应该足够智能以优化表。但是，我会检查查询计划以确保（信任，但验证）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T16:42:35.403

在我看来，这个选择：

```
SELECT strSearchTypeCode FROM tblAdvanceSearchTypes 
```

返回多行，这就是你的问题。您可以将其重写为：

```
SELECT TOP 1 strSearchTypeCode FROM tblAdvanceSearchTypes 
```

# java - Java中匹配URL的正则表达式

> ID：163360
> 
> 赞同：94
> 
> 时间：2008-10-02T16:40:00.430
> 
> 标签：java, regex, regexbuddy

我在使用正则表达式时使用 RegexBuddy。我从它的库中复制了正则表达式以匹配 URL。我在 RegexBuddy 中成功测试。但是，当我将其复制为 Java`String`风格并将其粘贴到 Java 代码中时，它不起作用。以下类打印`false`：

```
public class RegexFoo {

    public static void main(String[] args) {
        String regex = "\\b(https?|ftp|file)://[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|]";
        String text = "http://google.com";
        System.out.println(IsMatch(text,regex));
}

    private static boolean IsMatch(String s, String pattern) {
        try {
            Pattern patt = Pattern.compile(pattern);
            Matcher matcher = patt.matcher(s);
            return matcher.matches();
        } catch (RuntimeException e) {
        return false;
    }       
}   
} 
```

有谁知道我做错了什么？

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-10-02T16:48:55.357

请改用以下正则表达式字符串。您的测试可能是以区分大小写的方式完成的。我添加了小写字母以及正确的字符串开头占位符。

```
String regex = "^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]"; 
```

这也有效：

```
String regex = "\\b(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]"; 
```

笔记：

```
String regex = "<\\b(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]>"; // matches <http://google.com>

String regex = "<^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]>"; // does not match <http://google.com> 
```

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2013-09-20T11:18:08.370

现在最好的方法是：

```
android.util.Patterns.WEB_URL.matcher(linkUrl).matches(); 
```

编辑：`Patterns`来自[https://github.com/android/platform_frameworks_base/blob/master/core/java/android/util/Patterns.java](https://github.com/android/platform_frameworks_base/blob/master/core/java/android/util/Patterns.java)的代码：

```
/*
 * Copyright (C) 2007 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package android.util;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Commonly used regular expression patterns.
 */
public class Patterns {
    /**
     *  Regular expression to match all IANA top-level domains.
     *  List accurate as of 2011/07/18\.  List taken from:
     *  http://data.iana.org/TLD/tlds-alpha-by-domain.txt
     *  This pattern is auto-generated by frameworks/ex/common/tools/make-iana-tld-pattern.py
     *
     *  @deprecated Due to the recent profileration of gTLDs, this API is
     *  expected to become out-of-date very quickly. Therefore it is now
     *  deprecated.
     */
    @Deprecated
    public static final String TOP_LEVEL_DOMAIN_STR =
        "((aero|arpa|asia|a[cdefgilmnoqrstuwxz])"
        + "|(biz|b[abdefghijmnorstvwyz])"
        + "|(cat|com|coop|c[acdfghiklmnoruvxyz])"
        + "|d[ejkmoz]"
        + "|(edu|e[cegrstu])"
        + "|f[ijkmor]"
        + "|(gov|g[abdefghilmnpqrstuwy])"
        + "|h[kmnrtu]"
        + "|(info|int|i[delmnoqrst])"
        + "|(jobs|j[emop])"
        + "|k[eghimnprwyz]"
        + "|l[abcikrstuvy]"
        + "|(mil|mobi|museum|m[acdeghklmnopqrstuvwxyz])"
        + "|(name|net|n[acefgilopruz])"
        + "|(org|om)"
        + "|(pro|p[aefghklmnrstwy])"
        + "|qa"
        + "|r[eosuw]"
        + "|s[abcdeghijklmnortuvyz]"
        + "|(tel|travel|t[cdfghjklmnoprtvwz])"
        + "|u[agksyz]"
        + "|v[aceginu]"
        + "|w[fs]"
        + "|(\u03b4\u03bf\u03ba\u03b9\u03bc\u03ae|\u0438\u0441\u043f\u044b\u0442\u0430\u043d\u0438\u0435|\u0440\u0444|\u0441\u0440\u0431|\u05d8\u05e2\u05e1\u05d8|\u0622\u0632\u0645\u0627\u06cc\u0634\u06cc|\u0625\u062e\u062a\u0628\u0627\u0631|\u0627\u0644\u0627\u0631\u062f\u0646|\u0627\u0644\u062c\u0632\u0627\u0626\u0631|\u0627\u0644\u0633\u0639\u0648\u062f\u064a\u0629|\u0627\u0644\u0645\u063a\u0631\u0628|\u0627\u0645\u0627\u0631\u0627\u062a|\u0628\u06be\u0627\u0631\u062a|\u062a\u0648\u0646\u0633|\u0633\u0648\u0631\u064a\u0629|\u0641\u0644\u0633\u0637\u064a\u0646|\u0642\u0637\u0631|\u0645\u0635\u0631|\u092a\u0930\u0940\u0915\u094d\u0937\u093e|\u092d\u093e\u0930\u0924|\u09ad\u09be\u09b0\u09a4|\u0a2d\u0a3e\u0a30\u0a24|\u0aad\u0abe\u0ab0\u0aa4|\u0b87\u0ba8\u0bcd\u0ba4\u0bbf\u0baf\u0bbe|\u0b87\u0bb2\u0b99\u0bcd\u0b95\u0bc8|\u0b9a\u0bbf\u0b99\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0bc2\u0bb0\u0bcd|\u0baa\u0bb0\u0bbf\u0b9f\u0bcd\u0b9a\u0bc8|\u0c2d\u0c3e\u0c30\u0c24\u0c4d|\u0dbd\u0d82\u0d9a\u0dcf|\u0e44\u0e17\u0e22|\u30c6\u30b9\u30c8|\u4e2d\u56fd|\u4e2d\u570b|\u53f0\u6e7e|\u53f0\u7063|\u65b0\u52a0\u5761|\u6d4b\u8bd5|\u6e2c\u8a66|\u9999\u6e2f|\ud14c\uc2a4\ud2b8|\ud55c\uad6d|xn\\-\\-0zwm56d|xn\\-\\-11b5bs3a9aj6g|xn\\-\\-3e0b707e|xn\\-\\-45brj9c|xn\\-\\-80akhbyknj4f|xn\\-\\-90a3ac|xn\\-\\-9t4b11yi5a|xn\\-\\-clchc0ea0b2g2a9gcd|xn\\-\\-deba0ad|xn\\-\\-fiqs8s|xn\\-\\-fiqz9s|xn\\-\\-fpcrj9c3d|xn\\-\\-fzc2c9e2c|xn\\-\\-g6w251d|xn\\-\\-gecrj9c|xn\\-\\-h2brj9c|xn\\-\\-hgbk6aj7f53bba|xn\\-\\-hlcj6aya9esc7a|xn\\-\\-j6w193g|xn\\-\\-jxalpdlp|xn\\-\\-kgbechtv|xn\\-\\-kprw13d|xn\\-\\-kpry57d|xn\\-\\-lgbbat1ad8j|xn\\-\\-mgbaam7a8h|xn\\-\\-mgbayh7gpa|xn\\-\\-mgbbh1a71e|xn\\-\\-mgbc0a9azcg|xn\\-\\-mgberp4a5d4ar|xn\\-\\-o3cw4h|xn\\-\\-ogbpf8fl|xn\\-\\-p1ai|xn\\-\\-pgbs0dh|xn\\-\\-s9brj9c|xn\\-\\-wgbh1c|xn\\-\\-wgbl6a|xn\\-\\-xkc2al3hye2a|xn\\-\\-xkc2dl3a5ee0h|xn\\-\\-yfro4i67o|xn\\-\\-ygbi2ammx|xn\\-\\-zckzah|xxx)"
        + "|y[et]"
        + "|z[amw])";

    /**
     *  Regular expression pattern to match all IANA top-level domains.
     *  @deprecated This API is deprecated. See {@link #TOP_LEVEL_DOMAIN_STR}.
     */
    @Deprecated
    public static final Pattern TOP_LEVEL_DOMAIN =
        Pattern.compile(TOP_LEVEL_DOMAIN_STR);

    /**
     *  Regular expression to match all IANA top-level domains for WEB_URL.
     *  List accurate as of 2011/07/18\.  List taken from:
     *  http://data.iana.org/TLD/tlds-alpha-by-domain.txt
     *  This pattern is auto-generated by frameworks/ex/common/tools/make-iana-tld-pattern.py
     *
     *  @deprecated This API is deprecated. See {@link #TOP_LEVEL_DOMAIN_STR}.
     */
    @Deprecated
    public static final String TOP_LEVEL_DOMAIN_STR_FOR_WEB_URL =
        "(?:"
        + "(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])"
        + "|(?:biz|b[abdefghijmnorstvwyz])"
        + "|(?:cat|com|coop|c[acdfghiklmnoruvxyz])"
        + "|d[ejkmoz]"
        + "|(?:edu|e[cegrstu])"
        + "|f[ijkmor]"
        + "|(?:gov|g[abdefghilmnpqrstuwy])"
        + "|h[kmnrtu]"
        + "|(?:info|int|i[delmnoqrst])"
        + "|(?:jobs|j[emop])"
        + "|k[eghimnprwyz]"
        + "|l[abcikrstuvy]"
        + "|(?:mil|mobi|museum|m[acdeghklmnopqrstuvwxyz])"
        + "|(?:name|net|n[acefgilopruz])"
        + "|(?:org|om)"
        + "|(?:pro|p[aefghklmnrstwy])"
        + "|qa"
        + "|r[eosuw]"
        + "|s[abcdeghijklmnortuvyz]"
        + "|(?:tel|travel|t[cdfghjklmnoprtvwz])"
        + "|u[agksyz]"
        + "|v[aceginu]"
        + "|w[fs]"
        + "|(?:\u03b4\u03bf\u03ba\u03b9\u03bc\u03ae|\u0438\u0441\u043f\u044b\u0442\u0430\u043d\u0438\u0435|\u0440\u0444|\u0441\u0440\u0431|\u05d8\u05e2\u05e1\u05d8|\u0622\u0632\u0645\u0627\u06cc\u0634\u06cc|\u0625\u062e\u062a\u0628\u0627\u0631|\u0627\u0644\u0627\u0631\u062f\u0646|\u0627\u0644\u062c\u0632\u0627\u0626\u0631|\u0627\u0644\u0633\u0639\u0648\u062f\u064a\u0629|\u0627\u0644\u0645\u063a\u0631\u0628|\u0627\u0645\u0627\u0631\u0627\u062a|\u0628\u06be\u0627\u0631\u062a|\u062a\u0648\u0646\u0633|\u0633\u0648\u0631\u064a\u0629|\u0641\u0644\u0633\u0637\u064a\u0646|\u0642\u0637\u0631|\u0645\u0635\u0631|\u092a\u0930\u0940\u0915\u094d\u0937\u093e|\u092d\u093e\u0930\u0924|\u09ad\u09be\u09b0\u09a4|\u0a2d\u0a3e\u0a30\u0a24|\u0aad\u0abe\u0ab0\u0aa4|\u0b87\u0ba8\u0bcd\u0ba4\u0bbf\u0baf\u0bbe|\u0b87\u0bb2\u0b99\u0bcd\u0b95\u0bc8|\u0b9a\u0bbf\u0b99\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0bc2\u0bb0\u0bcd|\u0baa\u0bb0\u0bbf\u0b9f\u0bcd\u0b9a\u0bc8|\u0c2d\u0c3e\u0c30\u0c24\u0c4d|\u0dbd\u0d82\u0d9a\u0dcf|\u0e44\u0e17\u0e22|\u30c6\u30b9\u30c8|\u4e2d\u56fd|\u4e2d\u570b|\u53f0\u6e7e|\u53f0\u7063|\u65b0\u52a0\u5761|\u6d4b\u8bd5|\u6e2c\u8a66|\u9999\u6e2f|\ud14c\uc2a4\ud2b8|\ud55c\uad6d|xn\\-\\-0zwm56d|xn\\-\\-11b5bs3a9aj6g|xn\\-\\-3e0b707e|xn\\-\\-45brj9c|xn\\-\\-80akhbyknj4f|xn\\-\\-90a3ac|xn\\-\\-9t4b11yi5a|xn\\-\\-clchc0ea0b2g2a9gcd|xn\\-\\-deba0ad|xn\\-\\-fiqs8s|xn\\-\\-fiqz9s|xn\\-\\-fpcrj9c3d|xn\\-\\-fzc2c9e2c|xn\\-\\-g6w251d|xn\\-\\-gecrj9c|xn\\-\\-h2brj9c|xn\\-\\-hgbk6aj7f53bba|xn\\-\\-hlcj6aya9esc7a|xn\\-\\-j6w193g|xn\\-\\-jxalpdlp|xn\\-\\-kgbechtv|xn\\-\\-kprw13d|xn\\-\\-kpry57d|xn\\-\\-lgbbat1ad8j|xn\\-\\-mgbaam7a8h|xn\\-\\-mgbayh7gpa|xn\\-\\-mgbbh1a71e|xn\\-\\-mgbc0a9azcg|xn\\-\\-mgberp4a5d4ar|xn\\-\\-o3cw4h|xn\\-\\-ogbpf8fl|xn\\-\\-p1ai|xn\\-\\-pgbs0dh|xn\\-\\-s9brj9c|xn\\-\\-wgbh1c|xn\\-\\-wgbl6a|xn\\-\\-xkc2al3hye2a|xn\\-\\-xkc2dl3a5ee0h|xn\\-\\-yfro4i67o|xn\\-\\-ygbi2ammx|xn\\-\\-zckzah|xxx)"
        + "|y[et]"
        + "|z[amw]))";

    /**
     * Good characters for Internationalized Resource Identifiers (IRI).
     * This comprises most common used Unicode characters allowed in IRI
     * as detailed in RFC 3987.
     * Specifically, those two byte Unicode characters are not included.
     */
    public static final String GOOD_IRI_CHAR =
        "a-zA-Z0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF";

    public static final Pattern IP_ADDRESS
        = Pattern.compile(
            "((25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\\.(25[0-5]|2[0-4]"
            + "[0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]"
            + "[0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}"
            + "|[1-9][0-9]|[0-9]))");

    /**
     * RFC 1035 Section 2.3.4 limits the labels to a maximum 63 octets.
     */
    private static final String IRI
        = "[" + GOOD_IRI_CHAR + "]([" + GOOD_IRI_CHAR + "\\-]{0,61}[" + GOOD_IRI_CHAR + "]){0,1}";

    private static final String GOOD_GTLD_CHAR =
        "a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF";
    private static final String GTLD = "[" + GOOD_GTLD_CHAR + "]{2,63}";
    private static final String HOST_NAME = "(" + IRI + "\\.)+" + GTLD;

    public static final Pattern DOMAIN_NAME
        = Pattern.compile("(" + HOST_NAME + "|" + IP_ADDRESS + ")");

    /**
     *  Regular expression pattern to match most part of RFC 3987
     *  Internationalized URLs, aka IRIs.  Commonly used Unicode characters are
     *  added.
     */
    public static final Pattern WEB_URL = Pattern.compile(
        "((?:(http|https|Http|Https|rtsp|Rtsp):\\/\\/(?:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)"
        + "\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,64}(?:\\:(?:[a-zA-Z0-9\\$\\-\\_"
        + "\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,25})?\\@)?)?"
        + "(?:" + DOMAIN_NAME + ")"
        + "(?:\\:\\d{1,5})?)" // plus option port number
        + "(\\/(?:(?:[" + GOOD_IRI_CHAR + "\\;\\/\\?\\:\\@\\&\\=\\#\\~"  // plus option query params
        + "\\-\\.\\+\\!\\*\\'\\(\\)\\,\\_])|(?:\\%[a-fA-F0-9]{2}))*)?"
        + "(?:\\b|$)"); // and finally, a word boundary or end of
                        // input.  This is to stop foo.sure from
                        // matching as foo.su

    public static final Pattern EMAIL_ADDRESS
        = Pattern.compile(
            "[a-zA-Z0-9\\+\\.\\_\\%\\-\\+]{1,256}" +
            "\\@" +
            "[a-zA-Z0-9][a-zA-Z0-9\\-]{0,64}" +
            "(" +
                "\\." +
                "[a-zA-Z0-9][a-zA-Z0-9\\-]{0,25}" +
            ")+"
        );

    /**
     * This pattern is intended for searching for things that look like they
     * might be phone numbers in arbitrary text, not for validating whether
     * something is in fact a phone number.  It will miss many things that
     * are legitimate phone numbers.
     *
     * <p> The pattern matches the following:
     * <ul>
     * <li>Optionally, a + sign followed immediately by one or more digits. Spaces, dots, or dashes
     * may follow.
     * <li>Optionally, sets of digits in parentheses, separated by spaces, dots, or dashes.
     * <li>A string starting and ending with a digit, containing digits, spaces, dots, and/or dashes.
     * </ul>
     */
    public static final Pattern PHONE
        = Pattern.compile(                      // sdd = space, dot, or dash
                "(\\+[0-9]+[\\- \\.]*)?"        // +<digits><sdd>*
                + "(\\([0-9]+\\)[\\- \\.]*)?"   // (<digits>)<sdd>*
                + "([0-9][0-9\\- \\.]+[0-9])"); // <digit><digit|sdd>+<digit>

    /**
     *  Convenience method to take all of the non-null matching groups in a
     *  regex Matcher and return them as a concatenated string.
     *
     *  @param matcher      The Matcher object from which grouped text will
     *                      be extracted
     *
     *  @return             A String comprising all of the non-null matched
     *                      groups concatenated together
     */
    public static final String concatGroups(Matcher matcher) {
        StringBuilder b = new StringBuilder();
        final int numGroups = matcher.groupCount();

        for (int i = 1; i <= numGroups; i++) {
            String s = matcher.group(i);

            if (s != null) {
                b.append(s);
            }
        }

        return b.toString();
    }

    /**
     * Convenience method to return only the digits and plus signs
     * in the matching string.
     *
     * @param matcher      The Matcher object from which digits and plus will
     *                     be extracted
     *
     * @return             A String comprising all of the digits and plus in
     *                     the match
     */
    public static final String digitsAndPlusOnly(Matcher matcher) {
        StringBuilder buffer = new StringBuilder();
        String matchingRegion = matcher.group();

        for (int i = 0, size = matchingRegion.length(); i < size; i++) {
            char character = matchingRegion.charAt(i);

            if (character == '+' || Character.isDigit(character)) {
                buffer.append(character);
            }
        }
        return buffer.toString();
    }

    /**
     * Do not create this static utility class.
     */
    private Patterns() {}
} 
```

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2008-10-02T16:53:38.900

我会尝试一个标准的“你为什么这样做？” 回答... 你知道`java.net.URL`吗？

```
URL url = new URL(stringURL); 
```

`MalformedURLException`如果无法解析 URL ，上面将抛出一个。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-01-20T15:23:46.020

所有建议方法的问题：所有 RegEx 都在**验证**

所有基于 RegEx 的代码都被过度设计：它只会找到有效的 URL！作为示例，它将忽略以“http://”开头且内部包含非 ASCII 字符的任何内容。

甚至更多：我遇到过使用 Java RegEx 包（从文本中过滤电子邮件地址）处理非常小而简单的句子的 1-2 秒处理时间（单线程、专用），没有什么特别的；Java 6 RegEx 中可能存在错误...

最简单/最快的解决方案是使用 StringTokenizer 将文本拆分为标记，删除以“http://”等开头的标记，并将标记再次连接到文本中。

如果你想从文本中过滤电子邮件（因为稍后你会做 NLP 人员等） - 只需删除所有包含“@”的标记。

这是 Java 6 的 RegEx 失败的简单文本。在 Java 的不同变体中尝试一下。在长时间运行的单线程测试应用程序中，每次 RegEx 调用大约需要 1000 毫秒：

```
pattern = Pattern.compile("[A-Za-z0-9](([_\\.\\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\\.\\-]?[a-zA-Z0-9]+)*)\\.([A-Za-z]{2,})", Pattern.CASE_INSENSITIVE);

"Avalanna is such a sweet little girl! It would b heartbreaking if cancer won. She's so precious! #BeliebersPrayForAvalanna");
"@AndySamuels31 Hahahahahahahahahhaha lol, you don't look like a girl hahahahhaahaha, you are... sexy."; 
```

如果只需要过滤带有“@”、“http://”、“ftp://”、“mailto:”的单词，不要依赖正则表达式；这是巨大的工程开销。

如果您真的想在 Java 中使用 RegEx，请尝试[Automaton](http://www.brics.dk/automaton/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T17:24:30.667

这也有效：

```
String regex = "\\b(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]"; 
```

笔记：

```
String regex = "<\\b(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]>"; // matches <http://google.com>

String regex = "<^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]>"; // does not match <http://google.com> 
```

所以可能第一个对一般用途更有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-05-06T09:58:29.277

根据 billjamesdev 的回答，这是另一种不使用 RegEx 验证 URL 的方法：

从[Apache Commons Validator](https://commons.apache.org/proper/commons-validator/) lib，查看类[UrlValidator](https://commons.apache.org/proper/commons-validator/apidocs/org/apache/commons/validator/routines/UrlValidator.html)。一些示例代码：

使用“http”和“https”的有效方案构造一个 UrlValidator。

```
String[] schemes = {"http","https"}.
UrlValidator urlValidator = new UrlValidator(schemes);
if (urlValidator.isValid("ftp://foo.bar.com/")) {
   System.out.println("url is valid");
} else {
   System.out.println("url is invalid");
}

prints "url is invalid" 
```

如果改为使用默认构造函数。

```
UrlValidator urlValidator = new UrlValidator();
if (urlValidator.isValid("ftp://foo.bar.com/")) {
   System.out.println("url is valid");
} else {
   System.out.println("url is invalid");
} 
```

打印出“网址有效”

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-06-12T10:36:55.560

```
((http?|https|ftp|file)://)?((W|w){3}.)?[a-zA-Z0-9]+\.[a-zA-Z]+ 
```

在这里检查：- [https://www.freeformatter.com/java-regex-tester.html#ad-output](https://www.freeformatter.com/java-regex-tester.html#ad-output)

它正确地整理出这些条目

*   google.com
*   www.google.com
*   谷歌
*   英尺。
*   www.google.com
*   .ft
*   [https://www.google.com](https://www.google.com)
*   https://
*   [https://www](https://www)。
*   [https://google.com](https://google.com)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-09T15:11:59.680

使用 RegexBuddy 库中的正则表达式时，请确保在您自己的代码中使用与库中的正则表达式相同的匹配模式。如果您在 Use 选项卡上生成源代码片段，RegexBuddy 将自动在源代码片段中设置正确的匹配选项。如果你复制/粘贴正则表达式，你必须自己做。

在这种情况下，正如其他人指出的那样，您错过了不区分大小写选项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-02-10T11:35:51.433

这是一个 URL 解析器正则表达式的提议，它可以识别：

*   协议
*   主持人
*   港口
*   路径（文档/文件夹）
*   获取参数

```
^(?>(?<protocol>[[:alpha:]]+(?>\:[[:alpha:]]+)*)\:\/\/)?(?<host>(?>[[:alnum:]]|[-_.])+)(?>\:(?<port>[[:digit:]]+))?(?<path>\/(?>[[:alnum:]]|[-_.\/])*)?(?>\?(?<request>(?>[[:alnum:]]+=[[:alnum:]]+)(?>\&(?>[[:alnum:]]+=[[:alnum:]]+))*))?$ 
```

这个正则表达式能够解析这样的 URL：

```
jdbc:hsqldb:hsql://localhost:91/index. 
```

有很多方法可以设计 URL 正则表达式，因此我建议的方法可以稍微调整以匹配更准确的 URL 语法。

可以在以下页面进行测试：[https ://regex101.com/r/Dy7HE0/5](https://regex101.com/r/Dy7HE0/5)

请注意，用于正则表达式的语言原生 API（例如 java.util.regex）不支持智能字符类，例如**[[:alnum:]]**和**[[:alpha:]]**。

改用**\w**和**\d**。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-08-12T14:52:02.453

首先，一个正则表达式示例：

```
regex = “((http|https)://)(www.)?” 
+ “[a-zA-Z0-9@:%._\\+~#?&//=]{2,256}\\.[a-z]” 
+ “{2,6}\\b([-a-zA-Z0-9@:%._\\+~#?&//=]*)” 
```

*该 URL 必须以 http 或 https 开头，然后 * 后跟 :// 和 *，然后它必须包含 www。*然后是长度为 (2, 256) 的子域，*最后一部分包含顶级域，如 .com、.org 等。

* * *

## 在 JAVA

```
// Java program to check URL is valid or not
// using Regular Expression

import java.util.regex.*;

class GFG {

    // Function to validate URL
    // using regular expression
    public static boolean
    isValidURL(String url)
    {
        // Regex to check valid URL
        String regex = "((http|https)://)(www.)?"
              + "[a-zA-Z0-9@:%._\\+~#?&//=]"
              + "{2,256}\\.[a-z]"
              + "{2,6}\\b([-a-zA-Z0-9@:%"
              + "._\\+~#?&//=]*)";

        // Compile the ReGex
        Pattern p = Pattern.compile(regex);

        // If the string is empty
        // return false
        if (url == null) {
            return false;
        }

        // Find match between given string
        // and regular expression
        // using Pattern.matcher()
        Matcher m = p.matcher(url);

        // Return if the string
        // matched the ReGex
        return m.matches();
    }

    // Driver code
    public static void main(String args[])
    {
        String url
            = "https://www.superDev.org";
        if (isValidURL(url) == true) {
            System.out.println("Yes");
        }
        else
            System.out.println("NO");
    }
} 
```

* * *

## 在蟒蛇 3

```
# Python3 program to check
# URL is valid or not
# using regular expression
import re

# Function to validate URL
# using regular expression
def isValidURL(str):

    # Regex to check valid URL
    regex = ("((http|https)://)(www.)?" +
             "[a-zA-Z0-9@:%._\\+~#?&//=]" +
             "{2,256}\\.[a-z]" +
             "{2,6}\\b([-a-zA-Z0-9@:%" +
             "._\\+~#?&//=]*)")

    # Compile the ReGex
    p = re.compile(regex)

    # If the string is empty
    # return false
    if (str == None):
        return False

    # Return if the string
    # matched the ReGex
    if(re.search(p, str)):
        return True
    else:
        return False

# Driver code

# Test Case 1:
url = "https://www.superDev.org"

if(isValidURL(url) == True):
    print("Yes")
else:
    print("No") 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-17T06:50:37.817

这个正则表达式对我有用：

```
String regex = "(https?://|www\\.)[-a-zA-Z0-9+&@#/%?=~_|!:.;]*[-a-zA-Z0-9+&@#/%=~_|]"; 
```

# excel - 如何创建从多个工作表中提取数据的 Excel 图表？

> ID：163363
> 
> 赞同：7
> 
> 时间：2008-10-02T16:40:38.260
> 
> 标签：excel, charts, excel-2007

我将月度销售数据存储在单独的表格中。我想为每个月创建多个产品的销售图。每个产品将在同一图表上以不同颜色的线表示，每个月沿 x 轴运行。

创建从多个工作表上的相同相关单元格中提取的单个折线图的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T16:53:46.497

使用图表向导。

在第 2 步（共 4 步）中，有一个标签为“系列”。此选项卡上有 3 个字段和一个列表框。列表框显示您已经包含在图表中的不同系列。每个系列都有一个“名称”字段和一个特定于该系列的“值”字段。最后一个字段是所有系列通用的“类别 (X) 轴标签”字段。

单击列表框下方的“添加”按钮。这将在您的列表框中添加一个空白系列。请注意，当您突出显示列表框中的系列时，“名称”和“值”的值会发生变化。

选择您的新系列。

右侧的每个字段中都有一个图标。此图标允许您选择工作簿中的单元格以从中提取数据。当您单击它时，向导会暂时隐藏自身（您正在处理的字段除外），以便您与工作簿进行交互。

在工作簿中选择适当的工作表，然后选择包含要在图表中显示的数据的字段。可以单击字段右侧的按钮来取消隐藏向导。

希望有帮助。

编辑：以上适用于 2003 年及之前。对于 2007 年，当图表被选中时，您应该能够使用功能区“设计”选项卡上的“选择数据”选项执行类似的操作。这将打开一个对话框，列出图表的系列。您可以像在 Excel 2003 中一样选择系列，但您必须使用“添加”和“编辑”按钮来定义自定义系列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-13T14:08:13.853

这是来自 Excel 2010 的一些可能有效的代码。它有几个细节（例如从标题中过滤错误编码字符），但它旨在从具有绝对和基于百分比的数据的 4 维数据创建多个多系列图。修改它你喜欢的方式：

```
Sub createAllGraphs()

Const chartWidth As Integer = 260
Const chartHeight As Integer = 200

If Sheets.Count = 1 Then
    Sheets.Add , Sheets(1)
    Sheets(2).Name = "AllCharts"
ElseIf Sheets("AllCharts").ChartObjects.Count > 0 Then
    Sheets("AllCharts").ChartObjects.Delete
End If
Dim c As Variant
Dim c2 As Variant
Dim cs As Object
Set cs = Sheets("AllCharts")
Dim s As Object
Set s = Sheets(1)

Dim i As Integer

Dim chartX As Integer
Dim chartY As Integer

Dim r As Integer
r = 2

Dim curA As String
curA = s.Range("A" & r)
Dim curB As String
Dim curC As String
Dim startR As Integer
startR = 2

Dim lastTime As Boolean
lastTime = False

Do While s.Range("A" & r) <> ""

    If curC <> s.Range("C" & r) Then

        If r <> 2 Then
seriesAdd:
            c.SeriesCollection.Add s.Range("D" & startR & ":E" & (r - 1)), , False, True
            c.SeriesCollection(c.SeriesCollection.Count).Name = Replace(s.Range("C" & startR), "Â", "")
            c.SeriesCollection(c.SeriesCollection.Count).XValues = "='" & s.Name & "'!$D$" & startR & ":$D$" & (r - 1)
            c.SeriesCollection(c.SeriesCollection.Count).Values = "='" & s.Name & "'!$E$" & startR & ":$E$" & (r - 1)
            c.SeriesCollection(c.SeriesCollection.Count).HasErrorBars = True
            c.SeriesCollection(c.SeriesCollection.Count).ErrorBars.Select
            c.SeriesCollection(c.SeriesCollection.Count).ErrorBar Direction:=xlY, Include:=xlBoth, Type:=xlCustom, Amount:="='" & s.Name & "'!$F$" & startR & ":$F$" & (r - 1), minusvalues:="='" & s.Name & "'!$F$" & startR & ":$F$" & (r - 1)
            c.SeriesCollection(c.SeriesCollection.Count).ErrorBar Direction:=xlX, Include:=xlBoth, Type:=xlFixedValue, Amount:=0

            c2.SeriesCollection.Add s.Range("D" & startR & ":D" & (r - 1) & ",G" & startR & ":G" & (r - 1)), , False, True
            c2.SeriesCollection(c2.SeriesCollection.Count).Name = Replace(s.Range("C" & startR), "Â", "")
            c2.SeriesCollection(c2.SeriesCollection.Count).XValues = "='" & s.Name & "'!$D$" & startR & ":$D$" & (r - 1)
            c2.SeriesCollection(c2.SeriesCollection.Count).Values = "='" & s.Name & "'!$G$" & startR & ":$G$" & (r - 1)
            c2.SeriesCollection(c2.SeriesCollection.Count).HasErrorBars = True
            c2.SeriesCollection(c2.SeriesCollection.Count).ErrorBars.Select
            c2.SeriesCollection(c2.SeriesCollection.Count).ErrorBar Direction:=xlY, Include:=xlBoth, Type:=xlCustom, Amount:="='" & s.Name & "'!$H$" & startR & ":$H$" & (r - 1), minusvalues:="='" & s.Name & "'!$H$" & startR & ":$H$" & (r - 1)
            c2.SeriesCollection(c2.SeriesCollection.Count).ErrorBar Direction:=xlX, Include:=xlBoth, Type:=xlFixedValue, Amount:=0
            If lastTime = True Then GoTo postLoop
        End If

        If curB <> s.Range("B" & r).Value Then

            If curA <> s.Range("A" & r).Value Then
                chartX = chartX + chartWidth * 2
                chartY = 0
                curA = s.Range("A" & r)
            End If

            Set c = cs.ChartObjects.Add(chartX, chartY, chartWidth, chartHeight)
            Set c = c.Chart
            c.ChartWizard , xlXYScatterSmooth, , , , , True, Replace(s.Range("B" & r), "Â", "") & " " & s.Range("A" & r), s.Range("D1"), s.Range("E1")

            Set c2 = cs.ChartObjects.Add(chartX + chartWidth, chartY, chartWidth, chartHeight)
            Set c2 = c2.Chart
            c2.ChartWizard , xlXYScatterSmooth, , , , , True, Replace(s.Range("B" & r), "Â", "") & " " & s.Range("A" & r) & " (%)", s.Range("D1"), s.Range("G1")

            chartY = chartY + chartHeight
            curB = s.Range("B" & r)
            curC = s.Range("C" & r)
        End If

        curC = s.Range("C" & r)
        startR = r
    End If

    If s.Range("A" & r) <> "" Then oneMoreTime = False ' end the loop for real this time
    r = r + 1
Loop

lastTime = True
GoTo seriesAdd
postLoop:
cs.Activate

End Sub 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-03-05T06:04:11.910

2007 使用功能区功能更强大..:=) 要在图表中添加新系列，请执行以下操作：选择图表，然后单击功能区上图表工具中的设计，在设计功能区上，选择数据组中的“选择数据”，然后您将看到添加按钮以添加新系列。

希望这会有所帮助。

# c++ - How to setup VS2008 for efficient C++ development

> ID：163364
> 
> 赞同：0
> 
> 时间：2008-10-02T16:41:13.517
> 
> 标签：c++, visual-studio, static-analysis

Normally I program in C# but have been forced to do some work in C++. It seems that the integration with Visual Studio (2008) is really poor compared to C# but I was wondering if there are any good tools, plugins or configurations that can improve the situation.

Another post pointed out the program Visual Assist X, which at least helps with some things such as refactoring (though it is a bit expensive for me). My major problem is, though, that the compile errors give little clue about what is wrong and I spend most of my time figuring out what I did wrong. It just feels like it is possibly to statically check for a lot more errors than VS does out of the box. And why doesn't it provide the blue underlines as with C#, that shouldn't be too hard?!

I realize that half the problem is just the fact that I am new to C++ but I really feel that it can be unreasonably hard to get a program to compile. Are there any tools of this sort out there or are my demands too high?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T17:08:03.140

我认为有两种可能性：1）要么你正在尝试 C++ 的东西，这超出了你的知识（因此，你不知道你做错了什么以及如何解释错误消息），2）你太高了期望。

提示：许多后续错误是由第一个错误引起的。当我得到大量错误列表时，我通常只纠正第一个错误并重新编译。您会惊讶于缺少分隔符或类型声明会产生多少垃圾（就错误消息而言）:)

在编译之前很难对 C++ 程序进行语法分析，主要有两个原因：1) C++ 语法是上下文相关的，2) 模板是图灵完备的（将它们视为具有奇怪语法的函数式编程语言）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T18:44:29.150

我的建议：

*   如果您想要 C# 中的更多功能，请获取[VisualAssist X](http://www.wholetomato.com/)并了解如何使用它。它不是免费的，但可以为您节省大量时间。
*   将您的[警告级别设置为高](http://msdn.microsoft.com/en-us/library/thxezb7y.aspx)（这最初会产生更多的编译错误，但当您修复它们时，您会对常见错误有所了解）。
*   将警告设置为错误，这样您就不会养成忽略警告的习惯。
*   要了解编译错误，请使用 Google（不要在帮助系统上浪费时间）搜索警告错误编号（它们看起来像这样：C4127）。
*   避免使用模板，直到使用上述方法编译代码且没有错误。如果您不太了解模板，请学习！买一些书，做一些教程，然后从小事做起。众所周知，模板编译错误很难弄清楚。Visual C++ 2008 的错误消息比以前的版本好得多，但仍然很难。
*   如果您开始认真地制作模板，请准备一个宽屏显示器（甚至两个），以便更轻松地阅读详细错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-26T21:12:43.017

视觉辅助 +1，也许不是现在——但当你把爱好变成职业时，你会需要它。

根据我的经验，诊断已经比 VC6 好得多，但是作为学习 IDE 的一部分，您需要“了解”它们的真正含义。

由于构建模式和极其复杂的语言，C++ 的静态检查比 C# 复杂得多。**[PC-Lint](http://www.gimpel.com/html/pcl.htm)**（最好与[Visual Lint](http://www.riverblade.co.uk/products/visual_lint/index.html)一起将其集成到 IDE 中）是规范的静态分析。不过也不便宜。。。

C++ 标准有时读起来像圣经，但没有受过训练的传教士来解释它。一位出色的解释器是 Marshal Cline 及其**[C++ FAQ](http://www.parashift.com/c++-faq-lite/)**。请注意，在线常见问题解答虽然内容广泛，但涵盖的内容远少于[本书](https://rads.stackoverflow.com/amzn/click/com/0201309831)。

帮助我理解复杂错误消息的主要方法是尝试在较小的环境中重现问题 - 但是当时没有互联网......

# c++ - 如何使 C++ 宏表现得像函数？

> ID：163365
> 
> 赞同：62
> 
> 时间：2008-10-02T16:41:14.343
> 
> 标签：c++, c-preprocessor

假设由于某种原因您需要编写一个宏：`MACRO(X,Y)`。 **（让我们假设您不能使用内联函数是有充分理由的。）** 您希望此宏模拟对没有返回值的函数的调用。

* * *

### 示例 1：这应该按预期工作。

```
if (x > y)
  MACRO(x, y);
do_something(); 
```

### 示例 2：这不应导致编译器错误。

```
if (x > y)
  MACRO(x, y);
else
  MACRO(y - x, x - y); 
```

### 示例 3：这不应该*编译*。

```
do_something();
MACRO(x, y)
do_something(); 
```

* * *

编写宏的幼稚方法是这样的：

```
#define MACRO(X,Y)                       \
cout << "1st arg is:" << (X) << endl;    \
cout << "2nd arg is:" << (Y) << endl;    \
cout << "Sum is:" << ((X)+(Y)) << endl; 
```

这是一个非常糟糕的解决方案，所有三个示例都失败了，我不需要解释原因。

**忽略宏的实际作用，这不是重点。**

* * *

现在，我最常看到宏的编写方式是将它们括在花括号中，如下所示：

```
#define MACRO(X,Y)                         \
{                                          \
  cout << "1st arg is:" << (X) << endl;    \
  cout << "2nd arg is:" << (Y) << endl;    \
  cout << "Sum is:" << ((X)+(Y)) << endl;  \
} 
```

这解决了示例 1，因为宏位于一个语句块中。但是示例 2 被破坏了，因为我们在调用宏之后放置了一个分号。这使得编译器认为分号本身就是一个语句，这意味着 else 语句不对应任何 if 语句！最后，示例 3 编译成功，即使没有分号，因为代码块不需要分号。

* * *

有没有办法编写一个宏以使其通过所有三个示例？

* * *

*注意：我提交我自己的答案作为[共享提示的公认方式的](https://stackoverflow.com/questions/162246/is-stack-overflow-appropriate-for-sharing-knowledge-tips-tricks-and-interesting)一部分，但如果有人有更好的解决方案，请随时在此处发布，它可能会比我的方法获得更多的选票。:)*

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-02T16:41:21.847

有一个相当聪明的解决方案：

```
#define MACRO(X,Y)                         \
do {                                       \
  cout << "1st arg is:" << (X) << endl;    \
  cout << "2nd arg is:" << (Y) << endl;    \
  cout << "Sum is:" << ((X)+(Y)) << endl;  \
} while (0) 
```

现在你有一个单独的块级语句，它后面必须跟一个分号。这在所有三个示例中都符合预期和期望。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-02T16:54:59.677

通常应避免使用宏；在任何时候都更喜欢内联函数。任何称职的编译器都应该能够像宏一样内联一个小函数，并且内联函数将尊重命名空间和其他范围，以及一次评估所有参数。

如果它必须是宏，while 循环（已经建议）将起作用，或者您可以尝试逗号运算符：

```
#define MACRO(X,Y) \
 ( \
  (cout << "1st arg is:" << (X) << endl), \
  (cout << "2nd arg is:" << (Y) << endl), \
  (cout << "3rd arg is:" << ((X) + (Y)) << endl), \
  (void)0 \
 ) 
```

`(void)0`导致语句评估为一种类型，并且使用逗号而`void`不是分号允许它在语句中使用，而不仅仅是作为独立的。出于多种原因，我仍然会推荐一个内联函数，其中最小的原因是范围以及`MACRO(a++, b++)`会增加两次的事实。`a``b`

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-02T23:26:25.540

我知道您说“忽略宏的作用”，但是人们会通过根据标题进行搜索来找到这个问题，所以我认为有必要讨论进一步的技术来模拟宏的功能。

我所知道的最接近的是：

```
#define MACRO(X,Y) \
do { \
    auto MACRO_tmp_1 = (X); \
    auto MACRO_tmp_2 = (Y); \
    using std::cout; \
    using std::endl; \
    cout << "1st arg is:" << (MACRO_tmp_1) << endl;    \
    cout << "2nd arg is:" << (MACRO_tmp_2) << endl;    \
    cout << "Sum is:" << (MACRO_tmp_1 + MACRO_tmp_2) << endl; \
} while(0) 
```

这将执行以下操作：

*   在每个所述的上下文中都能正常工作。
*   对每个参数只计算一次，这是函数调用的保证特性（假设在这两种情况下，任何表达式都没有异常）。
*   通过使用 C++0x 中的“auto”作用于任何类型。这还不是标准的 C++，但没有其他方法可以获取单一评估规则所需的 tmp 变量。
*   不需要调用者从命名空间 std 导入名称，原始宏会这样做，但函数不会。

但是，它与函数的不同之处在于：

*   在某些无效用途中，它可能会给出不同的编译器错误或警告。
*   如果 X 或 Y 包含来自周围范围的 'MACRO_tmp_1' 或 'MACRO_tmp_2' 的使用，则会出错。
*   与命名空间 std 相关：函数使用自己的词法上下文来查找名称，而宏使用其调用站点的上下文。在这方面，没有办法编写一个表现得像函数的宏。
*   它不能用作 void 函数的返回表达式，而 void 表达式（例如逗号解决方案）可以。当所需的返回类型不是 void 时，这甚至会成为一个更大的问题，尤其是在用作左值时。但是逗号解决方案不能包括 using 声明，因为它们是语句，所以选择一个或使用 ({ ... }) GNU 扩展。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-12-21T13:36:58.787

这是来自的答案`libc6`！看了一下`/usr/include/x86_64-linux-gnu/bits/byteswap.h`，我找到了你要找的把戏。

对先前解决方案的一些批评：

*   Kip 的解决方案不允许对最终经常需要*的表达式求值。*
*   coppro 的解决方案不允许*分配变量*，因为表达式是分开的，但可以评估为表达式。
*   Steve Jessop 的解决方案使用 C++11`auto`关键字，这很好，但*可以随意使用已知/预期类型*。

诀窍是同时使用`(expr,expr)`构造和`{}`范围：

```
#define MACRO(X,Y) \
  ( \
    { \
      register int __x = static_cast<int>(X), __y = static_cast<int>(Y); \
      std::cout << "1st arg is:" << __x << std::endl; \
      std::cout << "2nd arg is:" << __y << std::endl; \
      std::cout << "Sum is:" << (__x + __y) << std::endl; \
      __x + __y; \
    } \
  ) 
```

注意`register`关键字的使用，它只是对编译器的提示。和宏参数（已经）用括号括起来并`X`转换**为**预期的类型。此解决方案适用于前增量和后增量，因为参数只评估一次。`Y`

 **出于示例目的，即使没有要求，我也添加了`__x + __y;`语句，这是使整个 bloc 被评估为精确表达式的方法。

`void();`如果您想确保宏不会评估为表达式，那么使用它会更安全，因此在`rvalue`预期的地方是非法的。

**但是**，该解决方案*不符合 ISO C++ 标准*，因为会抱怨`g++ -pedantic`：

```
warning: ISO C++ forbids braced-groups within expressions [-pedantic] 
```

为了让 休息一下`g++`，使用`(__extension__ OLD_WHOLE_MACRO_CONTENT_HERE)`新定义如下：

```
#define MACRO(X,Y) \
  (__extension__ ( \
    { \
      register int __x = static_cast<int>(X), __y = static_cast<int>(Y); \
      std::cout << "1st arg is:" << __x << std::endl; \
      std::cout << "2nd arg is:" << __y << std::endl; \
      std::cout << "Sum is:" << (__x + __y) << std::endl; \
      __x + __y; \
    } \
  )) 
```

为了进一步改进我的解决方案，让我们使用`__typeof__`关键字，如[C 中的 MIN 和 MAX](https://stackoverflow.com/questions/3437404/min-and-max-in-c/3437484#3437484)所示：

```
#define MACRO(X,Y) \
  (__extension__ ( \
    { \
      __typeof__(X) __x = (X); \
      __typeof__(Y) __y = (Y); \
      std::cout << "1st arg is:" << __x << std::endl; \
      std::cout << "2nd arg is:" << __y << std::endl; \
      std::cout << "Sum is:" << (__x + __y) << std::endl; \
      __x + __y; \
    } \
  )) 
```

现在编译器将确定适当的类型。这也是一种`gcc`延伸。

请注意关键字的删除`register`，因为它与类类型一起使用时会出现以下警告：

```
warning: address requested for ‘__x’, which is declared ‘register’ [-Wextra] 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-11-04T13:26:04.643

C++11 为我们带来了 lambda，它在这种情况下非常有用：

```
#define MACRO(X,Y)                              \
    [&](x_, y_) {                               \
        cout << "1st arg is:" << x_ << endl;    \
        cout << "2nd arg is:" << y_ << endl;    \
        cout << "Sum is:" << (x_ + y_) << endl; \
    }((X), (Y)) 
```

You keep the generative power of macros, but have a comfy scope from which you can return whatever you want (including `void`). Additionally, the issue of evaluating macro parameters multiple times is avoided.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-02T16:50:39.500

使用创建块

```
 #define MACRO(...) do { ... } while(false) 
```

不要添加 ; 一段时间后（假）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-02T17:11:24.897

您的答案存在多重评估问题，因此（例如）

```
macro( read_int(file1), read_int(file2) ); 
```

会做一些意想不到的事情，可能是不想要的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T17:46:00.303

正如其他人所提到的，您应该尽可能避免使用宏。如果对宏参数进行多次评估，则它们在存在副作用的情况下是危险的。如果您知道参数的类型（或可以使用 C++0x`auto`功能），则可以使用临时变量来强制执行单一评估。

另一个问题：多次评估发生的顺序可能不是你所期望的！

考虑这段代码：

```
#include <iostream>
using namespace std;

int foo( int & i ) { return i *= 10; }
int bar( int & i ) { return i *= 100; }

#define BADMACRO( X, Y ) do { \
    cout << "X=" << (X) << ", Y=" << (Y) << ", X+Y=" << ((X)+(Y)) << endl; \
    } while (0)

#define MACRO( X, Y ) do { \
    int x = X; int y = Y; \
    cout << "X=" << x << ", Y=" << y << ", X+Y=" << ( x + y ) << endl; \
    } while (0)

int main() {
    int a = 1; int b = 1;
    BADMACRO( foo(a), bar(b) );
    a = 1; b = 1;
    MACRO( foo(a), bar(b) );
    return 0;
} 
```

它是在我的机器上编译并运行的输出：

```
X=100, Y=10000, X+Y=110
X=10, Y=100, X+Y=110

```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-02T16:54:33.143

如果您愿意采用在 if 语句中始终使用花括号的做法，

您的宏将只是缺少最后一个分号：

```
#define MACRO(X,Y)                       \
cout << "1st arg is:" << (X) << endl;    \
cout << "2nd arg is:" << (Y) << endl;    \
cout << "Sum is:" << ((X)+(Y)) << endl 
```

示例 1：（编译）

```
if (x > y) {
    MACRO(x, y);
}
do_something(); 
```

示例 2：（编译）

```
if (x > y) {
    MACRO(x, y);
} else {
    MACRO(y - x, x - y);
} 
```

示例 3：（不编译）

```
do_something();
MACRO(x, y)
do_something(); 
```

# mysql - 更新记录时出错

> ID：163367
> 
> 赞同：0
> 
> 时间：2008-10-02T16:41:42.550
> 
> 标签：mysql, ruby-on-rails, ruby, activerecord

我得到一个mysql错误：

**#update (ActiveRecord::StatementInvalid) "Mysql::Error: #HY000Got error 139 from storage engine:**

尝试使用长度为 1429 个字符的字符串更新记录上的文本字段时，有关如何追踪问题的任何想法？

下面是堆栈跟踪。

```
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb:147:in `log'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/mysql_adapter.rb:299:in `execute'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb:167:in `update_sql'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/mysql_adapter.rb:314:in `update_sql'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb:49:in `update_without_query_dirty'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:19:in `update'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/base.rb:2481:in `update_without_lock'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/locking/optimistic.rb:70:in `update_without_dirty'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/dirty.rb:137:in `update_without_callbacks'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/callbacks.rb:234:in `update_without_timestamps'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/timestamp.rb:38:in `update'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/base.rb:2472:in `create_or_update_without_callbacks'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/callbacks.rb:207:in `create_or_update'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/base.rb:2200:in `save_without_validation'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/validations.rb:901:in `save_without_dirty'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/dirty.rb:75:in `save_without_transactions'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/transactions.rb:106:in `save'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `transaction'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/transactions.rb:79:in `transaction'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/transactions.rb:98:in `transaction'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/transactions.rb:106:in `save'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/transactions.rb:118:in `rollback_active_record_state!'
from /var/www/releases/20081002155111/vendor/rails/activerecord/lib/active_record/transactions.rb:106:in `save' 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T16:36:46.007

当您说文本字段时，它是 VARCHAR 类型还是 TEXT 类型？

如果是前者，那么您不能在该列中存储大于 255 个字符的字符串（使用 UTF-8 开销可能更少）。如果是后者，您最好发布您的架构定义，以便人们可以进一步帮助您。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T16:55:49.520

也许是这个错误：[#1030 - Got error 139 from storage engine](http://bugs.mysql.com/bug.php?id=10035)，但如果您发布应该直接在错误消息之后的查询，它会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T10:39:59.527

这似乎是一个非常奇怪的 mysql 错误，其中文本被截断为 256 个字符（对于文本类型）并且抛出上述错误是字符串为 1000 个字符或更多。将表格列修改为文本再次解决了问题，或者它只是自行修复了..我仍然不确定。

更新：将表类型更改为 MyISAM 解决了这个问题

# java - 类泛型的类型不匹配

> ID：163382
> 
> 赞同：22
> 
> 时间：2008-10-02T16:44:56.003
> 
> 标签：java, generics

我有以下无法编译的代码，尽管有一种方法可以使其编译，但我想了解它为什么无法编译。有人可以告诉我具体为什么我会收到我将在最后发布的错误消息吗？

```
public class Test {
    public static void main(String args[]) {
        Test t = new Test();
        t.testT(null);
    }

    public <T extends Test> void testT(Class<T> type) {
        Class<T> testType = type == null ? Test.class : type; //Error here
        System.out.println(testType);
    }
} 
```

`Type mismatch: cannot convert from Class<capture#1-of ? extends Test> to Class<T>`

通过强制转换`Test.class`为`Class<T>`this 编译并发出`Unchecked cast`警告并完美运行。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-02T16:54:15.250

原因是 Test.class 属于 Class<Test> 类型。您不能将 Class<Test> 类型的引用分配给 Class<T> 类型的变量，因为它们不是同一个东西。但是，这有效：

```
Class<? extends Test> testType = type == null ? Test.class : type; 
```

通配符允许将 Class<T> 和 Class<Test> 引用分配给 testType。

[在Angelika Langer Java Generics FAQ](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html "Java 泛型常见问题解答")中有大量关于 Java 泛型行为的信息。我将根据那里使用`Number`类层次结构 Java 的核心 API 的一些信息提供一个示例。

考虑以下方法：

```
public <T extends Number> void testNumber(final Class<T> type) 
```

这是为了让以下语句能够成功编译：

```
testNumber(Integer.class);
testNumber(Number.class); 
```

但以下内容无法编译：

```
testNumber(String.class); 
```

现在考虑这些陈述：

```
Class<Number> numberClass = Number.class;
Class<Integer> integerClass = numberClass; 
```

第二行无法编译并产生此错误`Type mismatch: cannot convert from Class<Number> to Class<Integer>`。但是`Integer`extends `Number`，那为什么会失败呢？查看接下来的两个语句以了解原因：

```
Number anumber = new Long(0);
Integer another = anumber; 
```

很容易看出为什么第二行在这里没有编译。您不能将 的实例分配给`Number`类型变量，`Integer`因为无法保证该`Number`实例是兼容类型。在此示例中，`Number`实际是 a `Long`，当然不能将其分配给`Integer`。其实错误也是类型不匹配：`Type mismatch: cannot convert from Number to Integer`.

规则是不能将实例分配给作为实例类型的子类的变量，因为不能保证是兼容的。

泛型的行为方式类似。在泛型方法签名中，`T`只是一个占位符，用于指示该方法允许编译器做什么。当编译器遇到它时，`testNumber(Integer.class)`它基本上替换`T`为`Integer`.

通配符增加了额外的灵活性，因为以下将编译：

```
Class<? extends Number> wildcard = numberClass; 
```

因为`Class<? extends Number>`表示任何属于 this`Number`或其子类的类型`Number`在许多情况下都是完全合法的并且可能有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T00:38:10.500

假设我扩展测试：

```
public class SubTest extends Test {
  public static void main(String args[]) {
    Test t = new Test();
    t.testT(new SubTest());
  }
} 
```

现在，当我调用 时`testT`，类型参数`<T>`是`SubTest`，这意味着变量`testType`是 a `Class<SubTest>`。`Test.class`是类型的`Class<Test>`，它不能分配给类型的变量`Class<SubTest>`。

将变量声明`testType`为 a`Class<? extends Test>`是正确的解决方案；转换`Class<T>`为隐藏了一个真正的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T16:52:02.057

删除条件，错误更好一点......

```
public class Test {
    public static void main(String args[]) {
        Test t = new Test();
        t.testT(null);
    }

    public <T extends Test> void testT(Class<T> type) {
    Class<T> testClass = Test.class;
        System.out.println(testClass);
    }
}

Test.java:10: incompatible types
found   : java.lang.Class<Test>
required: java.lang.Class<T>
        Class<T> testClass = Test.class; 
```

# java - Logging conventions

> ID：163385
> 
> 赞同：5
> 
> 时间：2008-10-02T16:45:24.240
> 
> 标签：java, logging, log4j

What conventions do you use for log categories in log4j or similar libraries ? Usually you see class names as categories, but have you used other systems ?

What about log levels ? What levels do you use and in which case ?

Update: as some of you replied, there is no 'right' answer. I'm just looking for what different conventions people use as a possible source of inspiration.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T16:47:10.070

我有 3 个级别：错误、警告和详细日志，告诉程序一次在做什么。

我使用类+函数作为上下文。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T17:17:18.347

我同意[Vaibhav 的回答](https://stackoverflow.com/questions/163385/logging-conventions#163427)：你必须知道你为什么要记录。

*   对于调试内部技术调试信息，log4j 或任何其他库都可以（只要它们的使用不会人为地增加函数的[圈复杂度](https://stackoverflow.com/questions/105852/how-do-you-deal-with-conditional-logging-when-trying-to-respect-a-limited-cyclo)）
*   对于横向*准时*日志记录（跨整个代码），一些[面向方面的方法](http://en.wikipedia.org/wiki/Aspect_oriented)更适合
*   对于**监控**，您进入另一个级别的日志记录，即[KPI](http://en.wikipedia.org/wiki/Key_performance_indicator)，需要通过发布总线（例如 TIBCO）将这些信息记录到某种数据库。

因此，仅对于内部日志记录，我们遵循一种非常标准的方法：

*   严重的任何可能危及程序的错误
*   跟踪内部进展的信息
*   对一些子步骤细节很好

粒度（对于经典的内部日志记录）是主要类，负责流程的主要步骤。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T16:55:21.377

多年来，我们对此进行了广泛的辩论，我们唯一同意的是，没有完美的答案！

我们已经确定的是使用顶级类别名称来区分广泛的类别：例如，“操作”与用户可能关心的任何事情有关，“内部”与只有开发人员会关心的事情有关，“审计”用于跟踪有趣的事件。

除此之外，我们试图**限制**类别的数量，因为我们发现没有人在更详细的级别上打开/关闭它们。因此，我们尝试将它们分组到功能区域中，而不是类名，例如。查询、更新等

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T16:56:53.043

日志记录取决于您的要求。如果您制作的日志只是简单地关注是否存在任何问题（例如记录异常），那么您可能只需要类和函数名称。

但是，如果您有创建和审核各种跟踪的功能需求，则必须将日志记录带到完全不同的详细级别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T17:14:24.217

我们有类+方法的调试日志。

对于某些操作，我们也有特定的日志，例如，在套接字上接收到的连接。这些就是我所说的“事实日志”或“审计跟踪日志”，它们记录单一类型的事情。当然，最近我只是将这些数据保存到数据库中，因为您捕获的事实可能比一串文本复杂得多，它们可以包括特定时间的状态。即，您为您需要的每个审计滚动您自己的审计跟踪记录机制。

调试时，我们将在 log4j 中将我们正在调试的包/类设置为 DEBUG，同时将 rootlogger 保留为 ERROR，并且我们将有一个调试日志文件，希望能够排除来自应用程序其他区域的所有 gumpf 日志记录。

但实际上并没有“正确的方法”来做这些事情。机制的组合似乎不错，但这取决于您要记录的内容。

# sql - 有没有办法在不执行它的情况下获取未知数据库查询的类型/名称？

> ID：163389
> 
> 赞同：4
> 
> 时间：2008-10-02T16:46:41.507
> 
> 标签：sql, database, oracle, plsql

我有一个 Web 应用程序，用户可以在其中输入任意 sql 查询以供以后进行批处理。我们想要验证查询的语法而不实际执行它。有些查询会花费很长时间，这就是我们不想执行它们的原因。我正在使用 Oracle 的 dbms_sql.parse 来执行此操作。

但是，我现在有一种情况，我需要知道结果集列的数量和类型。有没有办法在不实际执行查询的情况下做到这一点？也就是说，让 Oracle 解析查询并告诉我在实际执行查询时将返回什么结果数据类型/名称？我正在使用 Oracle 10g，它是一个 Java 1.5/Servlet 2.4 应用程序。

编辑：输入查询的用户已经是数据库上的用户。他们使用他们的数据库凭据对我的应用程序进行身份验证，并使用这些凭据执行查询。因此，他们无法输入任何仅通过连接 sqlplus 无法运行的查询。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T17:11:25.287

您应该能够准备 SQL 查询来验证语法并获取结果集元数据。准备查询不应该执行它。

```
import java.sql.*;
. . .
Connection conn;
. . .
PreparedStatement ps = conn.prepareStatement("SELECT * FROM foo");
ResultSetMetadata rsmd = ps.getMetaData();
int numberOfColumns = rsmd.getColumnCount(); 
```

然后，您可以获得有关结果集每一列的元数据。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T12:53:07.740

如果您想通过 pl/sql 严格执行此操作，则可以执行以下操作：

```
DECLARE 
  lv_stat varchar2(100) := 'select blah blah blah';
  lv_cur INTEGER;
  lv_col_cnt INTEGER;
  lv_desc DBMS_SQL.desc_tab;
BEGIN
  DBMS_SQL.parse(lv_cur,lv_stat,DBMS_SQL.NATIVE);
  DBMS_SQL.describe_columns(lv_cur,lv_col_cnt,lv_desc);
  FOR ndx in lv_desc.FIRST .. lv_desc.LAST LOOP
    DBMS_OUTPUT.PUT_LINE(lv_desc(ndx).col_name ||' '||lv_desc(ndx).col_type);
  END LOOP;
END; 
```

DBMS_SQL.desc_tab 包含几乎所有您需要了解的有关列的信息。

# sql - Microsoft Access - SQL - 内部外键

> ID：163392
> 
> 赞同：2
> 
> 时间：2008-10-02T16:47:24.953
> 
> 标签：sql, ms-access

MS Access 2007 是否支持同一个表中的内部外键？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T17:53:23.237

是的。创建具有层次结构的表。

id - 自动编号 - 主键
parent_id -
数值

转到关系屏幕。添加层次结构表两次。连接 id 和 parent_id 字段。实施参照完整性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T18:01:09.893

是的，它确实。

在数据库工具和关系下，您需要显示自引用表的 2 个副本。它将第二个副本命名为 Table_1。然后在“table”中的主键和“Table_1”中的外键列之间建立关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T07:17:56.577

是的，它确实如此，并且与许多功能更强大的 SQL（例如 SQL Server）不同，您还可以在同一个表中的 FK 上使用 CASCADE 引用操作，这很好。

# php - 与关系有关的数据库设计问题

> ID：163400
> 
> 赞同：1
> 
> 时间：2008-10-02T16:49:39.597
> 
> 标签：php, mysql, database-design, foreign-keys, relational-database

我正在对现有数据库进行升级，该数据库的设计没有任何代码来实现正在考虑的设计。现在我在用代码实现数据库设计方面遇到了障碍。我确定这是否是数据库设计的问题，或者我只是没有看到关于如何做的正确解决方案。

基本逻辑规定如下：

1.  用户通过席位访问在线培训。用户可以拥有多个席位。
2.  席位由公司购买，并与产品具有多对多关系。
3.  产品与模块具有多对多关系。
4.  模块与课程具有多对多关系。
5.  课程是最终用户进行培训的访问权限。
6.  为了搅浑水，出于某种原因，一些用户有多个包含相同产品的席位。
7.  认证是基于每个产品进行的，而不是基于每个席位。
8.  用户与存储其当前状态或课程分数的课程具有多对多关系。
9.  用户在完成该产品的所有模块中的所有课程后，即可对产品进行认证。
10.  了解用户何时完成特定模块的所有课程也很重要。
11.  一些席位将用于重新认证，这意味着之前通过产品认证的用户可以注册并参加重新认证考试。
12.  由于规则 11，用户可以并且将会拥有多个认证记录。
13.  编辑：当用户完成课程（得分高于 80%）时，用户已（根据当前业务逻辑）完成了所有产品和包含课程的所有席位的课程。

正如我或多或少所描述的那样，我在当前设计和业务逻辑上一直遇到的问题是，我无法找到一种方法来有效地将用户是否已获得特定产品和席位的认证与他们何时获得认证没有。我一直在尝试确定哪些产品下的哪些座位已获得用户认证，哪些没有。部分问题是因为如果他们目前在不同席位下注册了多个相同产品，那么我只需要计算一次产品。

下面是所涉及的架构部分的副本。任何有关如何改进设计或在代码中绘制关联的建议将不胜感激。万一这很重要，这个网站是建立在 LAMPP 堆栈上的。

您可以在此处查看数据库架构的相关部分：[http://lpsoftware.com/problem_db_structure.png](http://lpsoftware.com/problem_db_structure.png)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T17:26:28.790

你要找的是[关系除法](http://www.dbazine.com/ofinterest/oi-articles/celko1) ，不是直接用SQL实现的，但是可以做到。在 google 上搜索其他示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T17:40:06.653

快速查看架构后，我认为您可以做的一件事是创建一个“to_be_certified”表。将产品分配给座位时（填充 product_seat_rtab 时）使用 user_id、product_id 和 seat_id 填充它。

在向certificate_rtab 表添加记录时，删除“to_be_certified”表中的相应记录。这将使您可以轻松访问所有经过用户认证和未经过认证的产品。

要消除重复的 product_id，您可以按 product_id 分组。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T18:29:21.137

您需要对 coursestatus_rtab 表进行更改：

```
CREATE TABLE lessonstatus_rtab (
  user_id    INT NOT NULL,
  seat_id    INT NOT NULL,
  lesson_id  INT NOT NULL REFERENCES lesson_rtab,
  accessdate TIMESTAMP,
  score      NUMERIC(5,2) NOT NULL DEFAULT 0,
  PRIMARY KEY (user_id, seat_id, lesson_id),
  FOREIGN KEY (user_id, seat_id) REFERENCES user_seat_rtab (user_id, seat_id)
); 
```

然后你可以查询用户有席位的每个产品，他是否经过认证？这假定他获得的课程数量（例如 50% 或更高）与该产品的所有模块中的课程数量相同。

```
SELECT p.name, us.user_id, us.seat_id, COUNT(l.id) = COUNT(lu.lesson_id) AS is_certified
FROM user_seat_rtab AS us
 JOIN seat_rtab AS s ON (s.id = us.seat_id)
 JOIN product_seat_rtab AS ps ON (ps.seat_id = s.id)
 JOIN product_rtab AS p ON (p.id = ps.product_id)
 JOIN product_module_rtab AS pm ON (pm.product_id = p.id)
 JOIN module_rtab AS m ON (m.id = pm.module_id)
 JOIN module_lesson_rtab AS ml ON (ml.module_id = m.id)
 JOIN lesson_rtab AS l ON (l.id = ml.lesson_id)
 LEFT OUTER JOIN lessonstatus_rtab AS lu 
   ON (lu.lesson_id = l.id AND lu.user_id = us.user_id 
     AND lu.seat_id = us.seat_id AND lu.score > 0.50)
GROUP BY p.id, us.user_id, us.seat_id; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T13:32:43.740

更新：

我已经进一步考虑了这个问题，并考虑过简单地删除 user_seat_rtab 表，然后使用等效的certificate_rtab 表（可能已重命名）来保存有关用户座位状态的所有信息是否能让事情更好地工作。这样，用户、他们的席位、席位内的每个产品以及用户是否已获得特定产品和席位的认证之间都建立了直接关系。

因此，我将对随问题发布的架构应用以下更改：

```
DROP TABLE user_seat_rtab;
RENAME TABLE certification_rtab TO something_different; 
```

进一步规范这种新结构的另一种方法是执行以下操作：

```
ALTER TABLE user_seat_rtab 
    DROP PRIMARY KEY;
    ADD COLUMN product_id int(10) unsigned NOT NULL;
    ADD CONSTRAINT pk_user_seat_product PRIMARY KEY (user_id, seat_id, product_id);
    ADD CONSTRAINT fk_product_user_seat FOREIGN KEY (product_id) REFERENCES product_rtab(id) ON DELETE RESTRICT; 
```

我不确定这是否会解决问题，或者它是否会在引入新问题时稍微改变问题的性质。那么，有没有人有任何其他的批评或建议？

# java - JSP 中的枚举

> ID：163407
> 
> 赞同：16
> 
> 时间：2008-10-02T16:52:21.197
> 
> 标签：java, jsp, jstl

有没有办法在不使用 scriptlet 的情况下在 JSP 中使用 Enum 值。

例如

```
package com.example;

public enum Direction {
    ASC,
    DESC
} 
```

所以在JSP中我想做这样的事情

```
<c:if test="${foo.direction ==<% com.example.Direction.ASC %>}">... 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-02T16:57:46.223

您可以将枚举中的方向的网络友好文本实现为字段：

```
 <%@ page import="com.example.Direction" %>
...
<p>Direction is <%=foo.direction.getFriendlyName()%></p>
<% if (foo.direction == Direction.ASC) { %>
<p>That means you're going to heaven!</p>
<% } %> 

```

但这混合了视图和模型，尽管对于简单的用途，它可以是独立于视图的（“升序”、“降序”等）。

除非您不喜欢将 Java 直接放入您的 JSP 页面中，即使用于比较之类的基本操作也是如此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-02-09T10:06:57.380

我猜可以这样完成

```
<c:set var="ASC" value="<%=Direction.ASC%>"/>
<c:if test="${foo.direction == ASC}"></c:if> 
```

优点是当我们重构时它也会在这里反映出来

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-09T12:43:26.800

您可以简单地检查枚举值作为字符串：

```
<c:if test="${foo.direction == 'ASC'}">... 
```

# c# - ASPX 页面编译失败

> ID：163412
> 
> 赞同：2
> 
> 时间：2008-10-02T16:53:54.017
> 
> 标签：c#, asp.net, clr

我们正在开发一个基于 Web 的应用程序，允许管理员上传插件。所有插件都存储在应用根目录之外的特殊文件夹中（例如 C:\Plugins），并通过 Assembly.LoadFrom() 动态加载。这在大多数情况下都可以正常工作：插件中的 WebControls 被实例化和加载，自定义类按预期运行，等等。

我们使用自定义 VirtualPathProvider 从这些插件中获取资源。因此，要获得嵌入式 ASPX 文件，您只需执行“/MySite/embeddedResource/?Assembly=MyPlugin&Resource=MyPage.aspx”。这也很好用：嵌入的 ASPX 文件可以像普通页面一样编译和提供。

但是，当嵌入的 .aspx 文件（在动态加载的插件内部）引用同一插件程序集中的类时，就会出现问题。我们会收到诸如“找不到类型或程序集 MyPlugin”之类的编译错误。这很奇怪，因为很明显，它将 .aspx 文件从 MyPlugin 中拉出。那怎么找不到呢？

所以，我希望你能帮我解决这个问题。该插件看起来像这样：

MyPlugin.dll：

*   InternalHelperClass.cs
*   MyPage.aspx（没有 .cs 文件的资源）

当 MyPage.aspx 包含类似“<%= InternalHelperClass.WriteHelloWorld() %>”的内容时，编译失败。

我们怎样才能让它发挥作用？

**更新：**

我们已经尝试使用完全限定名称。没有不同。无法单步执行 - 当您转到 aspx 页面时，这是一个编译错误。在这种情况下，命名空间不会成为问题（因为它来自外部插件 dll）

**更新2：**

乔尔，我认为你在做某事。不幸的是，编辑 web.config 以包含这些程序集并不是设计的一部分。基本上，我们希望插件是完全动态的——将它们放在一个文件夹中，重新启动应用程序，然后就可以使用了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T14:09:17.240

Assembly.LoadFrom 是动态的（后期绑定），这意味着在编译期间不包含该类型，因此对其包含的类的引用无效。您需要专门引用程序集，以便将其包含在 *.aspx 类的编译中。

[您可能会发现这里](http://www.codeproject.com/KB/aspnet/ASPNET_11_Compilation_E.aspx)的一些源代码很有帮助，我建议尝试使用[托管可扩展性框架](http://www.codeplex.com/MEF)，因为它可能已经解决了这个问题。

更新：我找到了我认为是您问题的答案。虽然这不适用于 ASP.NET 1.1 项目，但它适用于 2.0+。他们已经重组了构建管道以使用可以在配置文件 (web.config) 中指定的 BuildProvider。尽管您必须编写自己的构建提供程序，但您可以创建一个在编译之前自动引用 Plugins 文件夹中的所有程序集的提供程序。这是[有关配置](http://msdn.microsoft.com/en-us/library/h0e51sw9.aspx)的信息，[这是您需要子类化的内容](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildprovider.aspx)。

[这是Mono 的 PageBuildProvider](http://mono.ms.mff.cuni.cz/projects/mono/diffs/showdiff.php?old=2006-02-12&new=2006-02-16&fileIndex=5&bench=)源代码的过时副本，您需要从 MS 的共享源中检查 ASP.NET 的最新实现，复制它，并使用您的自定义程序集引用对其进行扩展，因为该类不幸被密封（但它看起来并不复杂）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T19:13:04.010

我从未尝试过这样做，但我怀疑您的 ASPX 页面，虽然它是从您的插件程序集加载的，但正在一个没有引用您的插件程序集的 ASP.NET 环境中编译 - 这可以解释为什么完全限定名称不起作用。

您是否尝试将 MyPlugin.dll 的引用添加到 web.config 文件中的编译/程序集标记？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:21:49.347

您是否尝试过完全限定助手类的命名空间？是公开的吗？它在同一个程序集中吗？也许它在另一个必须加载的程序集中。

尝试进入代码并检查 InternalHelperClass 的类型。较新的“网站”编译方法通常会添加您没有预料到的名称空间。例如，网页的类具有命名空间 ASP.MyWebPage。有时会根据它们所在的文件夹添加命名空间。

# vb.net - 以编程方式打印到 pdf 打印机

> ID：163420
> 
> 赞同：3
> 
> 时间：2008-10-02T16:55:21.953
> 
> 标签：vb.net, pdf

我正在尝试在 Visual Basic 2008 中以编程方式将现有文件打印为 PDF。

我们当前的相关资产有： Visual Studio 2008 Professional Adob​​e Acrobat Professional 8.0

我考虑过获得像 ITextSharp 这样的 sdk，但对于我正在尝试做的事情来说，这似乎有点矫枉过正，尤其是因为我们拥有完整版的 Adob​​e。

是否有一段相对简单的代码可以打印到 PDF 打印机（当然也可以指定它打印到特定位置），还是需要使用另一个库才能打印到 pdf？

* * *

我想将以前创建的文档打印到 pdf 文件中。在这种情况下，它是一个 .snp 文件，我想将它制作成一个 .pdf 文件，但我认为任何文件类型的逻辑都是相同的。

* * *

我刚刚尝试了上面的 shell 执行，它不会按照我想要的方式执行。因为它提示我要打印的位置，但仍然没有打印到我想要​​的位置（多个位置），这至关重要，因为我们创建了许多相同命名的 PDF 文件（PDF 中有不同的数据并放置在对应的客户文件夹）

* * *

目前的流程是：

*   转到 \\report server\client1
*   手动创建文件夹中所有snp文档的pdf文件
*   将 pdf 复制到 \\website reports\client1
*   然后对所有 100 多个客户重复此操作大约需要两个小时才能完成和验证

我知道这可以做得更好，但我才来这里三个月，还有其他更紧迫的问题。我也没想到看起来如此微不足道的东西却难以编码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T20:07:30.980

这就是我在 VBScript 中的做法。可能对您不是很有用，但可能会让您入门。您需要一个 PDF 制作器 (adobe acrobat) 作为名为“Adobe PDF”的打印机。

```
'PDF_WILDCARD = "*.pdf"
'PrnName = "Adobe PDF"
Sub PrintToPDF(ReportName As String, TempPath As String, _
               OutputName As String, OutputDir As String, _
               Optional RPTOrientation As Integer = 1)

  Dim rpt As Report
  Dim NewFileName As String, TempFileName As String

  '--- Printer Set Up ---
  DoCmd.OpenReport ReportName, View:=acViewPreview, WindowMode:=acHidden
  Set rpt = Reports(ReportName)
  Set rpt.Printer = Application.Printers(PrnName)

  'Set up orientation
  If RPTOrientation = 1 Then
    rpt.Printer.Orientation = acPRORPortrait
  Else
    rpt.Printer.Orientation = acPRORLandscape
  End If

  '--- Print ---
  'Print (open) and close the actual report without saving changes
  DoCmd.OpenReport ReportName, View:=acViewNormal, WindowMode:=acHidden

  ' Wait until file is fully created
  Call waitForFile(TempPath, ReportName & PDF_EXT)

  'DoCmd.Close acReport, ReportName, acSaveNo
  DoCmd.Close acReport, ReportName

  TempFileName = TempPath & ReportName & PDF_EXT 'default pdf file name
  NewFileName = OutputDir & OutputName & PDF_EXT 'new file name

  'Trap errors caused by COM interface
  On Error GoTo Err_File
  FileCopy TempFileName, NewFileName

  'Delete all PDFs in the TempPath
  '(which is why you should assign it to a pdf directory)
  On Error GoTo Err_File
  Kill TempPath & PDF_WILDCARD

Exit_pdfTest:
  Set rpt = Nothing
  Exit Sub

Err_File:    ' Error-handling routine while copying file
  Select Case Err.Number    ' Evaluate error number.
      Case 53, 70   ' "Permission denied" and "File Not Found" msgs
          ' Wait 3 seconds.
          Debug.Print "Error " & Err.Number & ": " & Err.Description & vbCr & "Please wait a few seconds and click OK", vbInformation, "Copy File Command"
          Call sleep(2, False)
          Resume
      Case Else
          MsgBox Err.Number & ": " & Err.Description
          Resume Exit_pdfTest
  End Select

  Resume

End Sub

Sub waitForFile(ByVal pathName As String, ByVal tempfile As String)
    With Application.FileSearch
        .NewSearch
        .LookIn = pathName
        .SearchSubFolders = True
        .filename = tempfile
        .MatchTextExactly = True
        '.FileType = msoFileTypeAllFiles
    End With
    Do While True
       With Application.FileSearch
           If .Execute() > 0 Then
               Exit Do
           End If
       End With
    Loop
End Sub

Public Sub sleep(seconds As Single, EventEnable As Boolean)
    On Error GoTo errSleep
    Dim oldTimer As Single

    oldTimer = Timer
    Do While (Timer - oldTimer) < seconds
       If EventEnable Then DoEvents
    Loop

errSleep:
       Err.Clear
End Sub 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T19:58:01.480

这里最重要的一点是 PDF 很难。如果您可以采取任何措施避免直接创建或编辑 PDF 文档，我强烈建议您这样做。听起来您真正想要的是批量 SNP 到 PDF 转换器。您可以使用现成的产品来完成此操作，甚至根本不需要打开 Visual Studio。有人提到了 Adob​​e Distiller Server——检查你的 Acrobat 文档，我知道它带有基本的 Distiller，你可以设置 Distiller 以类似的模式运行，它会监视目录 A 并吐出任何文件的 PDF 版本出现在目录 B 中。

另一种选择：由于您正在使用 Access 快照，因此您最好编写一个 VBA 脚本，该脚本遍历目录中的所有 SNP 并将它们打印到已安装的 PDF 打印机。

ETA：如果您需要指定 PDF 打印机的输出，那可能会更难。我建议将 PDF 蒸馏器配置为输出到临时目录，这样您就可以打印一个，移动结果，然后打印另一个，等等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T16:56:45.320

您要做的是找到一个好的免费 PDF 打印机驱动程序。这些作为打印机安装，但不是打印到物理设备，而是将打印机命令呈现为 PDF。然后，您可以按照上述方式执行 ShellExecute，或者使用内置的 .net PrintDocument，按名称引用 PDF“打印机”。我很快就找到了一些[免费的](http://www.google.com/search?q=free+pdf+printer+driver)，包括[Primo](http://www.primopdf.com/)和[BullZip 的产品（自由限制为 10 个用户） 。](http://www.bullzip.com/products/pdf/info.php)

看起来 SNP 文件是 Microsoft Access 快照。您将不得不寻找 Access 或 Snapshot Viewer 的命令行界面，以便您指定打印机目标。

我还看到 SnapshotViewer 下载中包含一个 ActiveX 控件。您可以尝试在您的程序中使用它来加载 snp 文件，然后告诉它在哪里打印它，如果它支持该功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T17:37:39.247

[PDFforge](http://www.pdfforge.org/)提供 PDFCreator。它将从任何能够打印的程序（甚至是现有程序）创建 PDF。请注意，它基于 GhostScript，因此可能不适合您的 Acrobat 许可证。

你看过[Adob​​e Distiller Server](http://www.adobe.com/products/acrdis/)吗？您可以使用任何打印机驱动程序生成 PostScript 文件并将其翻译成 PDF。（实际上，PDFCreator 做了类似的事情。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-17T15:22:41.407

我也有同样的挑战。我所做的解决方案是购买一个名为 PDFTron 的组件。它有一个 API 可以将 pdf 文档从无人值守的服务发送到打印机。我在我的博客中发布了一些关于此的信息。看一看！

[如何以编程方式打印 PDF 文件？？？](http://blog.robertolopes.com/2012/08/16/how-to-print-a-pdf-file-programmatically/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T17:14:22.847

尝试使用带有 Print Verb 的 ShellExecute。

这是我在 Google 上找到的博客。

[http://www.vbforums.com/showthread.php?t=508684](http://www.vbforums.com/showthread.php?t=508684)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T18:12:10.273

如果您尝试手动生成 PDF（使用 SDK 或 PDF 打印机驱动程序），这并不容易。PDF 格式参考可从 Adob​​e 获得。

问题是该文件是 ASCII 和表的混合，这些表在文件中具有二进制偏移量以引用对象。这是一种有趣的格式，并且非常可扩展，但是很难编写一个简单的文件。

如果需要，这是可行的。我查看了 Adob​​e PDF 参考中的示例，将它们手动输入并进行了修改，直到我可以根据需要让它们工作。如果您经常这样做，那可能是值得的，否则请查看 SDK。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T20:04:12.667

我在 C# ASP.NET 应用程序中遇到了类似的问题。我的解决方案是在命令行使用一些生成的代码启动 LaTeX 编译器。这不是一个简单的解决方案，但它会生成一些非常漂亮的 .pdf。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-02-10T08:22:17.107

```
Imports System.Drawing.Printing
Imports System.Reflection
Imports System.Runtime.InteropServices
Public Class Form1
Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
    Dim pkInstalledPrinters As String

    ' Find all printers installed
    For Each pkInstalledPrinters In _
        PrinterSettings.InstalledPrinters
        printList.Items.Add(pkInstalledPrinters)
    Next pkInstalledPrinters

    ' Set the combo to the first printer in the list
    If printList.Items.Count > 0 Then
        printList.SelectedItem = 0
    End If
    End Sub
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    Try

        Dim pathToExecutable As String = "AcroRd32.exe"
        Dim sReport = " " 'pdf file that you want to print
        'Dim SPrinter = "HP9F77AW (HP Officejet 7610 series)" 'Name Of printer
        Dim SPrinter As String
        SPrinter = printList.SelectedItem
        'MessageBox.Show(SPrinter)
        Dim starter As New ProcessStartInfo(pathToExecutable, "/t """ + sReport + """ """ + SPrinter + """")
        Dim Process As New Process()
        Process.StartInfo = starter
        Process.Start()
        Process.WaitForExit(10000)
        Process.Kill()
        Process.Close()
    Catch ex As Exception
        MessageBox.Show(ex.Message) 'just in case if something goes wrong then we can suppress the programm and investigate
    End Try
End Sub
End Class 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2017-06-26T14:27:39.973

与其他答案类似，但要简单得多。我终于把它缩减为 4 行代码，没有外部库（尽管您必须安装 Adob​​e Acrobat 并将其配置为 PDF 的默认值）。

```
 Dim psi As New ProcessStartInfo
    psi.FileName = "C:\Users\User\file_to_print.pdf"
    psi.Verb = "print"
    Process.Start(psi) 
```

这将打开文件，使用默认设置打印，然后关闭。

改编[自这个 C# 答案](https://stackoverflow.com/a/5566234/1082555)

# c++ - 类中带有指针的垃圾，C++

> ID：163432
> 
> 赞同：-1
> 
> 时间：2008-10-02T16:57:54.100
> 
> 标签：c++, pointers, class-design

我正在使用 Borland Builder C++。我有内存泄漏，我知道这一定是因为我创建了这个类，但我不知道如何修复它。请查看我的代码——任何想法将不胜感激！

这是.h文件：

```
#ifndef HeaderH
#define HeaderH
#include <vcl.h>
#include <string>
using std::string;
class Header {

 public:
    //File Header
    char FileTitle[31];
    char OriginatorName[16];

    //Image Header
    char ImageDateTime[15];
    char ImageCordsRep[2];
    char ImageGeoLocation[61];

    NitfHeader(double latitude, double longitude, double altitude, double heading);
    ~NitfHeader();
    void SetHeader(char * date, char * time, double location[4][2]);  

 private:

    void ConvertToDegMinSec (double angle, AnsiString & s, bool IsLongitude);
    AnsiString ImageDate;
    AnsiString ImageTime;
    AnsiString Latitude_d;
    AnsiString Longitude_d;
    double Latitude;
    double Longitude;
    double Heading;
    double Altitude;

}; 
```

这是一些 .cpp 文件：

```
void Header::SetHeader(char * date, char * time, double location[4][2]){
    //File Header
strcpy(FileTitle,"Cannon Powershot A640");
strcpy(OperatorName,"Camera Operator");

   //Image Header
//Image Date and Time
   ImageDate = AnsiString(date);
   ImageTime = AnsiString(time);
   AnsiString secstr = AnsiString(ImageTime.SubString(7,2));
   AnsiString rounder = AnsiString(ImageDate.SubString(10,1));
   int seconds = secstr.ToInt();
    //Round off seconds  - will this be necessary with format hh:mm:ss in text file?
   if (rounder.ToInt() > 4) {
     seconds++;
    }
   AnsiString dateTime = ImageDate.SubString(7,4)+ ImageDate.SubString(4,2) + ImageDate.SubString(1,2) + ImageTime.SubString(1,2)
                    + ImageTime.SubString(4,2) + AnsiString(seconds);
   strcpy(ImageDateTime,dateTime.c_str());

   //Image Coordinates Representation
   strcpy(ImageCordsRep,"G");

   //Image Geographic Location
   AnsiString lat;
   AnsiString lon;
   AnsiString locationlat_d;
   AnsiString locationlon_d;
   AnsiString corner;

   for (int i = 0; i < 4; i++){

     ConvertToDegMinSec(location[i][0],lat,false);
     ConvertToDegMinSec(location[i][1],lon,true);

     if(location[i][0] < 0){
        locationlat_d = 'S';
        ConvertToDegMinSec(-location[i][0],lat,false);
      }else if(location[i][0] > 0){
        locationlat_d = 'N';
     }else locationlat_d = ' ';

     if(location[i][1] < 0){
        locationlon_d = 'W';
        ConvertToDegMinSec(-location[i][1],lon,true);
     }else if(location[i][1] > 0){
         locationlon_d = 'E';
     }else locationlon_d = ' ';

     corner += lat + locationlat_d + lon + locationlon_d;

   }
   strcpy(ImageGeoLocation,corner.c_str());

} 
```

现在，当我在 main 中使用该类时，基本上我只是创建了一个指针：

```
Header * header = new Header;
header->SetHeader(t[5],t[6],corners->location);
char * imageLocation = header->ImageGeoLocation;
//do something with imageLocation
delete header; 
```

其中corners->location 是另一个类的字符串，t[5] 和 t[6] 都是字符串。问题是 imageLocation 不包含预期的内容，而且通常只是垃圾。我已经阅读了很多关于内存泄漏和指针的内容，但我对编程仍然很陌生，其中一些内容相当混乱。任何建议都会很棒！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T17:06:56.530

恐怕这里有很多问题。

对于初学者来说`char ImageCordsRep[1];`是行不通的......一个字符串总是以空结尾，所以当你这样做时， `strcpy(ImageCordsRep,"G");`你会溢出缓冲区。

在构造函数中用 null 终止所有这些字符串缓冲区也是一种好习惯，因此它们始终是有效的字符串。

更好的是使用字符串类而不是 char 数组，或者如果传入的字符串比您预期的大，至少使用“strncpy”来防止缓冲区溢出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T17:00:27.090

您的内存泄漏在`main`; 您正在使用 制作指针`new`，但随后没有调用`delete`。

如果您只想创建一个在退出`Header`时将被销毁的类型的对象`main`，只需将其声明为“ `Header header;`”如果您希望创建一个持久指针，您应该照常使用`new`，但一定要`delete header;`在程序之前结尾。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T17:11:45.783

您的问题是 ImageGeoLocation 是垃圾还是内存泄漏？

如果您的代码是这样编写的：

```
Header * header = new Header;
header->SetHeader(t[5],t[6],corners->location);
char * imageLocation = header->ImageGeoLocation;
delete header;
printf("ImageLocation is %s", imageLocation); 
```

那么你的问题不是内存泄漏，而是你正在从 imageLocation 下删除内存。ImageLocation 只是一个指针，实际上并不包含数据，它只是指向它。因此，如果您删除数据，则指针指向垃圾箱。

如果不是这种情况，请调试您的 SetHeader 方法。ImageGeoLocation 是否像您期望的那样填充了数据？如果是，则 imageLocation 必须指向有效数据，除非有一些省略的代码稍后会损坏 ImageGeoLocation。记住查看 ImageGeoLocation 的窗口会有所帮助，因为您将能够单步执行代码并查看哪一行实际更改了您不期望的 ImageGeoLocation。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T17:43:51.620

我改成它解决了我的问题`strcpy()`。`strncpy()`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T17:07:26.700

还有什么...

注意不要在删除标头对象后使用 imageLocation。最好从对象中复制字符串而不是获取指向它的指针。在这种情况下可能没问题，具体取决于代码的其余部分。

```
Header * header = new Header;
header->SetHeader(t[5],t[6],corners->location);
char * imageLocation = header->ImageGeoLocation; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T17:27:00.380

谢谢 Torlack 和其他人这么快回复。基本上， imageLocation 填充得很好，除非我之前有其他代码。例如，我有这个字符串列表，它基本上包含文件名。

```
 AnsiString fileType ("*.jpg");
    AnsiString path = f + fileType;
    WIN32_FIND_DATA fd;
    HANDLE hFindJpg = FindFirstFile(path.c_str(),&fd);

   //Find all images in folder
    TStringList * imageNames = new TStringList;

    if (hFindJpg != INVALID_HANDLE_VALUE) {
        do{

            if(!(fd.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)){
                image = AnsiString(fd.cFileName);
                imageNames->Add(image);

                jpgFileCount++;
            }

        }while(FindNextFile(hFindJpg,&fd));
    }else ShowMessage ("Cannot find images.");

    FindClose(hFindJpg); 
```

现在，当我尝试直接从列表中引用图像时，我得到了放在 imageLocation 中的图像名称。

```
 //char * imageLocation = header->ImageGeoLocation; //as expected
Image1->Picture->LoadFromFile(imageNames->Strings[j]);
char * imageLocation = header->ImageGeoLocation; //puts name of jpg file in imageLocation 
```

# database-design - 关系数据库中的空值可以吗？

> ID：163434
> 
> 赞同：78
> 
> 时间：2008-10-02T16:58:47.140
> 
> 标签：database-design, oop, null

有一种观点认为关系数据库中不应允许空值。也就是说，表的属性（列）不应允许空值。来自软件开发背景，我真的不明白这一点。似乎如果 null 在属性的上下文中是有效的，那么它应该被允许。这在对象引用通常为空的 Java 中很常见。没有丰富的数据库经验，我想知道我是否在这里遗漏了一些东西。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-02T17:01:03.953

从数据库规范化的角度来看，空值是负面的。这个想法是，如果一个值可以什么都不是，那么你真的应该将它拆分到另一个稀疏表中，这样你就不需要为没有值的项目提供行。

这是为了确保所有数据都是有效和有价值的。

但是，在某些情况下，具有空字段很有用，尤其是当您出于性能原因想要避免再次连接时（尽管如果数据库引擎设置正确，这应该不是问题，除非在非常高性能的情况下。）

-亚当

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-02T17:05:45.237

反对空值的一个论点是它们没有明确定义的解释。如果字段为空，则可以解释为以下任何一种：

*   值为“无”或“空集”
*   没有对该字段有意义的值。
*   值未知。
*   该值尚未输入。
*   该值是一个空字符串（对于不区分空字符串和空字符串的数据库）。
*   一些特定于应用程序的含义（例如，“如果值为空，则使用默认值。”）
*   发生了错误，导致该字段实际上不应该具有空值。

一些模式设计者要求所有值和数据类型都应该有明确定义的解释，因此空值是不好的。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-10-02T17:04:18.983

这取决于。

只要您了解为什么允许`NULL`s 在数据库中（**需要在每列的基础上做出选择**）以及您将如何解释、忽略或以其他方式处理它们，它们就可以了。

例如，像这样的列`NUM_CHILDREN`- 如果你不知道答案，你会怎么做 - 它应该是`NULL`. 在我看来，对于此列的设计，没有其他最佳选择（即使您有一个标志来确定该`NUM_CHILDREN`列是否有效，您仍然必须在该列中有一个值）。

另一方面，如果您不允许`NULL`s 并且在某些情况下具有特殊的保留值（而不是标志），例如 -1 表示真正未知的孩子数量，您必须以类似的方式解决这些问题，在公约、文件等条款。

因此，最终，这些问题必须通过约定、文档和一致性来解决。

正如亚当戴维斯在上述答案中显然支持的那样，将列标准化为稀疏（或不那么稀疏，在`NUM_CHILDREN`示例或大多数数据具有已知值的任何示例的情况下）表的替代方案，同时能够消除所有 NULL，在一般实践中是不可行的。

在许多属性未知的情况下，为每一列连接到另一个表几乎没有意义，这可以让`NULL`s 在更简单的设计中允许。连接的开销，主键的空间要求在现实世界中几乎没有意义。

这让人想起通过添加基数列可以消除重复行的方式，同时它在理论上解决了没有唯一键的问题，实际上这有时是不可能的 - 例如，在大规模数据中。然后，纯粹主义者很快建议使用代理 PK，但是从关系理论的角度来看，无意义的代理可以构成关系（表）中元组（行）的一部分的想法是可笑的。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-10-02T16:59:50.367

空标记很好。真的，他们是。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-10-29T12:36:52.543

对使用 NULL 有几种不同的反对意见。一些反对意见是基于数据库理论的。从理论上讲，理论与实践没有区别。在实践中，有。

确实，完全规范化的数据库完全可以在没有 NULLS 的情况下运行。任何必须省略数据值的地方都是可以省略整行而不会丢失信息的地方。

在实践中，将表分解到这种程度并没有多大用处，而且对数据库执行简单 CRUD 操作所需的编程变得更加乏味且容易出错，而不是更少。

在某些地方使用 NULLS 可能会导致问题：基本上这些都围绕以下问题：缺失数据的真正含义是什么？NULL 真正传达的只是给定字段中没有存储值。但是应用程序程序员从丢失的数据中得出的推论有时是不正确的，这会导致很多问题。

由于各种原因，数据可能会从某个位置丢失。这里有几个：

1.  数据在这种情况下不适用。例如，单身人士的配偶名字。

2.  数据输入表单的用户将字段留空，并且应用程序不需要在该字段中输入。

3.  数据从某个其他数据库或文件复制到数据库，并且源中缺少数据。

4.  在外键中编码了一个可选的关系。

5.  一个空字符串存储在 Oracle 数据库中。

以下是有关何时避免 NULLS 的一些准则：

如果在正常的预期编程过程中，查询编写者必须编写大量 ISNULL、NV、COALESCE 或类似代码才能用有效值替换 NULL。有时，最好在存储时进行替换，前提是存储的是“现实”。

如果计数可能因为包含 NULL 的行被计数而关闭。通常，只需选择 count(MyField) 而不是 count(*) 就可以避免这种情况。

这里有一个地方可以让你更好地习惯 NULL，并相应地编程：每当你开始使用外连接时，比如 LEFT JOIN 和 RIGHT JOIN。与内部联接不同，外部联接背后的全部要点是在缺少某些匹配数据时获取行。缺失的数据将作为 NULLS 给出。

我的底线：不理解理论就不要放弃它。但是要学习何时偏离理论以及如何遵循它。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2008-10-02T17:02:28.177

对数据字段使用 NULL 没有任何问题。将键设置为空时必须小心。主键永远不应为 NULL。外键可以为空，但您必须小心不要创建孤立记录。

如果某些东西“不存在”，那么您应该使用 NULL 而不是空字符串或其他类型的标志。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-10-02T17:11:38.997

而不是写出所有关于 NULL 的问题，以及三态与布尔逻辑等 - 我将提供这个精辟的建议：

1.  不要在列中使用 NULL，直到您发现自己添加了一个神奇的值来表示丢失或不完整的数据。

2.  既然您要问这个问题，您应该*非常*小心处理 NULL 的方式。它有很多不明显的陷阱。如有疑问，请勿使用 NULL。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-02T17:18:46.127

使用“N/A”或“N/K”或空字符串还有另一种选择 - 一个单独的表。

例如，如果我们可能知道也可能不知道客户的电话号码：

```
CREATE TABLE Customer (ID int PRIMARY KEY, Name varchar(100) NOT NULL, Address varchar(200) NOT NULL);
CREATE TABLE CustomerPhone (ID int PRIMARY KEY, Phone varchar(20) NOT NULL, CONSTRAINT FK_CustomerPhone_Customer FOREIGN KEY (ID) REFERENCES Customer (ID)); 
```

如果我们不知道电话号码，我们就不会在第二个表中添加一行。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-04-22T16:33:02.933

不要低估通过将字段设为 NULLable 所创建的复杂性。例如，下面的 where 子句看起来会匹配所有行（位只能是 1 或 0，对吗？）

```
where bitfield in (1,0) 
```

但是如果位域是 NULLable，它会遗漏一些。或进行以下查询：

```
select * from mytable
where id not in (select id from excludetable) 
```

现在，如果 excludetable 包含 null 和 1，则转换为：

```
select * from mytable
where id <> NULL and id <> 1 
```

但是“id <> NULL”对于任何 id 值都是错误的，所以这永远不会返回任何行。这甚至让经验丰富的数据库开发人员感到惊讶。

鉴于大多数人可能会被 NULL 吓到，我尽量避免它。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-10-02T17:05:39.357

我会说绝对应该使用 Null。没有其他正确的方式来表示缺乏数据。例如，使用空字符串表示缺失的地址行是错误的，或者使用 0 表示缺失的年龄数据项是错误的。因为空字符串和 0 都是数据。Null 是表示这种情况的最佳方式。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-10-02T17:11:01.463

这是一大堆蠕虫，因为 NULL 可能意味着很多事情：

*   没有死亡日期，因为这个人还活着。
*   没有手机号码，因为我们不知道它是什么，甚至不知道它是否存在。
*   没有社会安全号码，因为知道那个人没有。

其中一些可以通过规范化来避免，其中一些可以通过在该列中存在一个值（“N/A”）来避免，其中一些可以通过有一个单独的列来解释 NULL 的存在来减轻（“N/K”、“N/A”等）。

它也是一罐蠕虫，因为找到它们所需的 SQL 语法与非空值不同，很难加入它们，而且它们通常不包含在索引条目中。

由于前一个原因，您会发现 null 不可避免的情况。

由于后一个原因，您仍然应该尽力减少它们的数量。

无论如何，始终使用 NOT NULL 约束来防止需要值的空值。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-04-22T15:38:54.560

空值的主要问题是它们具有特殊的语义，可以通过比较、聚合和连接产生意想不到的结果。

*   没有什么等于 null，也没有什么不等于、大于或小于 null，因此如果要进行任何批量比较，必须将 null 设置为占位符值。

*   这也是可能在连接中使用的复合键的问题。如果自然键包含可为空的列，您可能需要考虑使用合成键。

*   Null 可能会丢失计数，这可能不是您想要的语义。

*   可以连接的列中的空值将消除内部连接中的行。一般来说，这可能是所期望的行为，但它可能会为进行报道的人设置大象陷阱。

空值还有很多其他的微妙之处。Joe Celko[为 Smarties 编写的 SQL](https://rads.stackoverflow.com/amzn/click/com/0123693799)有一整章关于这个主题，是一本好书，无论如何都值得一读。null 是一个很好的解决方案的一些例子是：

*   连接实体可能存在或不存在的可选关系。Null 是在外键列上表示可选关系的唯一方法。

*   您可能希望用于 null 以退出计数的列。

*   可能存在或不存在的可选数字（例如货币）值。数字系统中的“未记录”没有有效的占位符值（特别是在零是合法值的情况下），因此 null 确实是唯一的好方法。

您可能希望避免使用空值的一些示例，因为它们可能会导致细微的错误。

*   带有参考表的 FK 的代码字段上的“未记录”值。使用占位符值，因此您（或一些随机的业务分析师）在对数据库进行查询时不会无意中将行从结果集中删除。

*   没有输入任何内容的描述字段 - 空字符串 ( `''`) 可以正常工作。这样就不必将空值视为特殊情况。

*   报告或数据仓库系统上的可选列。对于这种情况，请在维度中为“未记录”创建一个占位符行并与之结合。这简化了查询并与临时报告工具很好地配合使用。

再一次，Celko 的书很好地处理了这个主题。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-10-02T17:08:42.093

关于范式的最好的事情是它们是指南，不应该顽固地遵守指南。当学术界的世界与现实世界发生冲突时，你很少会发现许多幸存的学术界战士。

这个问题的答案是可以使用空值。如果您觉得空值与实际值的比率过高，只需评估您的情况并决定是否希望它们显示在表中或将数据折叠到另一个相关表中。

正如朋友喜欢说的，“不要让完美成为美好的敌人”。想想伏尔泰也这么说。8)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-10-02T17:03:06.367

根据严格的关系代数，不需要空值。但是，对于任何实际项目，它们都是必需的。

首先，许多真实世界的数据是未知的或不适用的，并且 null 很好地实现了该行为。其次，它们使视图和外部连接更加实用。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-10-06T04:59:51.950

我同意上面的许多答案，并且还相信 NULL 可以在适当的情况下用于规范化模式设计 - 特别是在您可能希望避免使用某种“幻数”或默认值的情况下，反过来，可以误导！

最终，我认为 null 的使用需要经过深思熟虑（而不是默认情况下），以避免上面答案中列出的一些假设，特别是在 NULL 可能**被假定**为“无”或“空”、“未知”的情况下'或'尚未输入值'。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-04-22T15:11:17.357

null 表示没有值，而 0 没有，如果你看到一个 0 你不知道它的含义，如果你看到一个 null 你知道它是一个缺失值

我认为空值更清晰，0 和 '' 令人困惑，因为它们没有清楚地显示存储值的意图

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-10-02T17:04:33.103

您会发现分步数据采集系统无法避免在数据库中出现空值，因为提问/数据收集的顺序很少与逻辑数据模型相匹配。

或者您可以默认值（需要代码来处理这些默认值）。您可以假设所有字符串都是空的而不是 null，例如，在您的模型中。

或者，您可以使用暂存数据库表进行数据采集，直到获得所有数据，然后再填充实际的数据库表。这是很多额外的工作。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-10-02T17:06:10.727

对于数据库，null 转换为“我没有这个值”。这意味着（有趣的是）允许空值的布尔列是完全可以接受的，并且出现在许多数据库模式中。相反，如果你的代码中有一个布尔值，它的值可以是“真”、“假”或“未定义”，那么你很可能会看到你的代码迟早会出现在 thedailywtf 上:)

所以是的，如果您需要允许字段根本没有任何值的可能性，那么在列上允许空值是完全可以接受的。它明显优于潜在的替代品（空字符串、零等）

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-10-02T17:13:11.817

Null 可能很难使用，但在某些情况下它们是有意义的。

假设您有一个带有“PaidDate”列的发票表，该列具有日期值。在发票付款之前，您在该栏中输入了什么（假设您事先不知道何时付款）？它不能是空字符串，因为那不是有效的日期。给它一个任意日期（例如 1/1/1900）是没有意义的，因为该日期根本不正确。似乎唯一合理的值是 NULL，因为它没有值。

在数据库中使用空值有一些挑战，但数据库可以很好地处理它们。真正的问题是当您将数据库中的空值加载到应用程序代码中时。这就是我发现事情变得更加困难的地方。例如，在 .NET 中，强类型数据集中的日期（模仿您的 DB 结构）是一种值类型，不能为空。因此，您必须构建解决方法。

尽可能避免使用空值，但不要排除它们，因为它们具有有效用途。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-10-02T17:29:34.133

我认为您将概念数据建模与物理数据建模混淆了。

在 CDM 中，如果一个对象有一个可选字段，您应该子类型该对象并在该字段不为空时创建一个新对象。这就是 CDM 中的理论

在物理世界中，我们为现实世界做出了各种妥协。在现实世界中，NULL 非常好，它们是必不可少的

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-11-14T15:32:55.150

虽然从技术上讲，NULL 作为字段值是可以的，但它们经常不受欢迎。根据数据写入数据库的方式，有可能（并且常见）在字段中以空字符串值结束，而不是 NULL。因此，任何将此字段作为 WHERE 子句一部分的查询都需要处理这两种情况，这两种情况都是不必要的击键。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-10-06T05:39:24.210

空岩石。如果在某些情况下不需要，SQL 将不会使用 IS NULL 和 IS NOT NULL 作为特例运算符。NULL 是概念普遍性的根源，其他一切都不是 NULL。只要数据值可能不存在但不会遗漏，就可以自由使用 NULL。如果默认值始终绝对正确，则默认值只能补偿 NULL。例如，如果我有一个单比特字段“IsReady”，则该字段具有默认值 false 并且不允许使用 NULL 可能非常有意义，但这隐含地断言我们*知道*什么都没有准备好，而事实上我们可能没有这样的知识。在工作流场景中，决定是否准备好的人可能还没有机会发表他们的意见，因此默认为 false 实际上可能是危险的，导致他们忽略似乎有的决定已制作，但实际上只是默认了。

顺便说一句，关于中间名首字母的例子，我父亲没有中间名，因此他的中间名首字母将为 NULL - 不是空白、空格或星号 - 除了在军队中，他的中间名首字母是 NMI = No Middle最初的。那有多傻？

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-10-02T19:06:49.377

从技术上讲，空值在关系数据库所基于的关系数学中是非法的。所以从纯粹的技术、语义关系模型的角度来看，不，它们是不行的。

在现实世界中，非规范化和一些违反模型的行为是可以的。但是，一般来说，空值是您应该更仔细地查看整体设计的一个指标。

我总是对空值非常警惕，并尽可能将它们标准化。但这并不意味着它们有时不是最佳选择。但我肯定会倾向于“无空值”，除非你真的确定在你的特定基础中拥有空值更好。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-10-02T17:21:24.467

如果您使用的是 Oracle 数据库，则会遇到一个问题。如果您将空字符串保存到 CHAR 类型列，那么 Oracle 将强制该值为 NULL 而无需询问。因此，在 Oracle 的字符串列中避免 NULL 值是相当困难的。

如果您使用 NULL 值，请学习使用 SQL 命令 COALESCE，尤其是字符串值。然后，您可以防止 NULL 值传播到您的编程语言中。例如，假设一个人有 FirstName、MiddleName 和 FamilyName，但您想返回一个字段；

```
 SELECT FullName = COALESCE(FirstName + ' ', '') + COALESCE(MiddleName+ ' ', '') + COALESCE(FamilyName, '') FROM Person 
```

如果您不使用 COALESCE，如果**任何**列包含**NULL**值，您将返回**NULL**。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2010-05-21T06:23:16.113

不要拿我的话讽刺，我是认真的。除非您正在使用玩具数据库，否则 NULL 是不可避免的，并且在现实世界中我们无法避免 NULL 值。

只是为了说你怎么能有每个人的名字，中间名，姓氏。（中间名和姓氏是可选的，在这种情况下为您提供 NULL）以及如何为博客列表中的每个人提供传真、商务电话、办公电话。

NULLS 很好，检索时必须正确处理它们。在 SQL Server 2008 中，有一个稀疏列的概念，您也可以在其中避免为 NULL 占用空间。

不要将 NULL 与零和任何其他值混淆。人们这样做，任何人都说这是对的。

谢谢纳文

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2011-08-17T01:23:05.017

我当天有争议的观点——在数据库列中默认允许 NULL 可能是所有 RDBM 领域中普遍接受的最糟糕的设计决策。每个供应商都这样做，这是错误的。NULL 在某些、特定的、经过深思熟虑的实例中很好，但是您必须为每一列明确禁止 NULL 的想法使得疏忽的可空性方式比它应该的更常见。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-10-06T04:47:19.697

我认为问题归结为您将 NULL 值解释为表示什么。是的，NULL 值有很多解释，但其中一些张贴在这里永远不应该使用。NULL 的真正含义取决于您的应用程序的上下文，并且不应仅表示一件事。例如，一个建议是，出生日期字段中的 NULL 表示此人还活着。这是危险的。

简而言之，定义 NULL 并坚持下去。我用它来表示“此时此字段中的值未知”。这意味着，仅此而已。如果您需要它来表示其他含义，那么您需要重新检查您的数据模型。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-10-02T17:09:22.170

就个人而言，我认为只有当您将该字段用作另一个表的外键时才应该使用空值，以表示该记录不链接到另一个表中的任何内容。除此之外，我发现在编写应用程序逻辑时，null 值实际上非常麻烦。由于在大多数编程语言中对于许多数据类型没有直接表示数据库空值，因此最终会创建大量应用程序代码来处理这些空值的含义。当数据库遇到空整数时，例如尝试向其添加值 1（也称为 null + 1），数据库将返回 null，因为这就是逻辑的定义方式。但是，当一种编程语言尝试添加 null 和 1 时，通常会抛出异常。因此，您的代码最终会检查当值为空时要做什么，

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-10-02T19:16:14.830

这一切都归结为规范化与易用性和性能问题。

如果您要坚持完整的规范化规则，您最终将编写如下内容：

选择 c.id, c.lastname,....... from customer c left join customerphonenumber cpn on c.id = cpn.customerid left join customeraddress ca on c.id = ca.customerid left join customerphonenumber2 cpn2 on c. id = cpn2.customerid 等等等等

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-04-22T17:23:55.057

> 似乎如果 null 在属性的上下文中是有效的，那么它应该被允许。

但是 null 是什么*意思*？这就是问题所在。它是“没有价值”，但有十几个不同的原因可能没有价值，并且“null”不会给你任何线索，在这种情况下它意味着哪一个。（尚未设置，不适用于此实例，不适用于此类型，未知，不可知，未找到，错误，程序错误，...）

> 这在对象引用通常为空的 Java 中很常见。

有一种观点认为[空引用也很糟糕](http://qconlondon.com/london-2009/presentation/Null+References:+The+Billion+Dollar+Mistake)。同样的问题：null 是什么*意思*？

IIRC，Java 同时具有“null”和“未初始化”（尽管后者没有语法）。因此，高斯林意识到对每一种“无价值”都使用“null”是愚蠢的。但为什么只停止[两个](http://c2.com/cgi/wiki?ZeroOneInfinityRule)？

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2008-10-02T17:00:54.047

使用 null 绝对没问题。

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2008-10-02T17:50:50.403

相关问题：[如何在我的数据库中实施数据完整性规则？](https://stackoverflow.com/questions/86181/how-do-i-enforce-data-integrity-rules-in-my-database)

我最初从许多具有几乎为零的 nullalbe 字段的小表开始。然后我了解了 LINQ to SQL IsDiscriminator 属性，并且 LINQ to SQL 只支持单表继承。因此，我将它重新设计为一个包含许多 nullalbe 字段的表。

* * *

## 回答 #33

> 赞同：-4
> 
> 时间：2009-08-17T11:57:19.423

作为一名拥有 30 年经验的分析师/程序员，我只想说 NULL 应该被取出并摆脱他们的痛苦。

-1、01/01/0001/12/31/9999 和 ? 没有处理这些讨厌的 NULL 所需的思维扭曲代码就足够了。

# javascript - 我可以在 JavaScript 中从不同页面传递参数吗？

> ID：163444
> 
> 赞同：2
> 
> 时间：2008-10-02T17:01:33.437
> 
> 标签：javascript

`$_GET[]`在 PHP 中，使用和传递参数很容易`$_POST[]`。JavaScript中有类似的东西吗？我希望我可以从地址或表单中传递参数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T17:07:30.817

window.location.href 包含当前页面的 URL。您可以在“？”之后将参数附加到页面的 URL。（即，查询字符串），并让该页面上的 javascript 解析它们。在像[这样](http://www.netlobo.com/url_query_string_javascript.html)的谷歌页面上有更多的信息和示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T17:03:33.400

您可以使用 java 脚本来设置隐藏的表单字段。当表单发布时，数据将被传输到服务器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T17:09:43.263

如果您正在谈论使用纯客户端代码将参数从一个页面传递到下一个页面，那么您最好的选择可能是构建一个普通的 URL 查询字符串，并将其附加到您正在导航到的页面的 URL 上。设置文档位置。

在目标页面上，您的客户端代码必须解析 document.location.href 以获取各个 URL 参数。一些 Javascript 库有帮助函数来为你做这种解析。例如，原型可以轻松地将散列对象与 URL 查询字符串转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T17:06:19.447

您也可以从 javascript 中访问查询字符串，所以这应该会有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T17:06:25.533

Ken 所说的相当于 POST 变量。要通过 GET 传递值，您可以使用 javascript 将查询字符串键附加到链接。

# java - 模型是否应该调用服务来获取数据

> ID：163451
> 
> 赞同：1
> 
> 时间：2008-10-02T17:03:12.497
> 
> 标签：java, .net, model-view-controller, design-patterns, web

我们正在使用 MVC 模式构建一个网站。到目前为止，我们构建的所有页面都使用了必须对参考数据进行操作的模型（这些数据在网站第一次加载时被缓存）。但是现在我们已经到了必须处理事务数据（特定于该流程）的流程阶段。到目前为止，我们通过提供所有数据来创建模型类，因为它们都已经被缓存了。但是现在我们必须处理事务数据，我们应该做同样的事情，即我们预先获取所有数据并创建一个模型对象，还是应该让模型类通过调用服务来获取数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-06T13:07:51.857

If you're truly using MVC, then your controller should intercept the particular action that should be taken, invoke any data-related requests, and shove the data into your model objects so that the model can then be placed into the view. There is very little benefit to having the model populate itself from a database, because you already have a controller which can do the job in a more cohesive manner.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T11:17:51.363

在真正的 MVC 中，模型负责更新自身以响应来自控制器的指令。因此，是的。模型，并且只有模型，应该进行服务调用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:06:28.293

第一种方法的缺点是可能永远不会使用预先获取的数据。所以我们采用了模型获取数据的第二种方法。为了解耦模型和服务调用，我们使用了一个接口。欢迎替代品。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T17:58:38.747

模型对象是通过对数据库的查询来构建的。这是一般的方法。

模型对象可以通过对其他服务器和数据库的 Web 服务请求来构建。这几乎是一样的。

如果——为了一些性能调整——你预先构建了所有的模型对象，很好。那是个特例。

我更喜欢使用 ORM 层来处理对象缓存，所以我不预取任何东西。相反，它保留在 ORM 缓存中。

# c# - 为什么我的 ListView 不显示 List 或 Details 项？

> ID：163472
> 
> 赞同：2
> 
> 时间：2008-10-02T17:07:52.360
> 
> 标签：c#, .net, winforms, listview

使用 C# .NET 2.0，我有一个所有者绘制的 ListView，我在其中覆盖了 OnDrawColumnHeader、OnDrawItem 和 OnDrawSubitem 事件。如果我在设计时将 View 属性设置为 Details，则一切正常，我可以切换 View 属性，并且所有视图模式都按应有的方式显示（我没有使用 Tile 视图）。但是，如果我从任何其他视图开始，列表和详细信息视图都是空白的。

我知道你可能想看代码，但是代码很多，所以我不愿意发布那么多，但如果有必要可以。我更好奇是否有人以前见过这个，和/或可能对如何修复它有所了解。View 属性将是用户保存的设置，因此默认情况下我不会总是能够在 Details 视图中启动。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T17:21:23.297

没有添加子项，或者您没有添加任何列。这是我最初的感觉。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T09:49:24.467

WinForms ListView 主要是实际 Windows 控件顶部的抽象层，因此其行为的某些方面是，嗯，违反直觉是一种礼貌的放置方式。

在我作为 Delphi 开发人员的日子里，我有一个模糊的回忆，当您作为所有者绘制 ListView 时，除非您的 Listview 在加载项目时处于“详细信息”模式，否则实际上不会填充控件的子项。

要尝试的事情...

...在更改显示样式后强制 WinForms 控件重新创建基础窗口句柄。如果没有记错，DestroyHandle() 是您想要的方法。

...假设您的应用程序中有一个“刷新”来重新加载数据，那么在更改显示样式后刷新时是否正常工作？

...如果一切都失败了，请借用或窃取 Charles 的 Windows 编程经典 Petzolds 的副本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T03:05:28.603

如果您使用设计器正确配置它，只需进入生成的设计器代码并查看 Visual Studio 发出的代码以使其正常工作。然后只是模拟该代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T09:17:02.673

没有您的代码，没有什么可以说的，但只有在 OwnerDraw 属性设置为 true 时才会调用 DrawColumnHeader。不确定它是否会根据 View 属性自动设置为 true 和 false，但值得一试。因此，请确保在启动应用程序之前将 OwnerDraw 设置为 true。

# windows - 阻止 MSVC++ 调试错误阻止当前进程？

> ID：163484
> 
> 赞同：1
> 
> 时间：2008-10-02T17:11:28.280
> 
> 标签：windows, unit-testing, visual-c++, continuous-integration, automated-tests

Windows 上任何失败的 ASSERT 语句都会导致出现以下调试消息并冻结应用程序执行。我意识到这是预期的行为，但它会在无头机器上定期运行，因此可以防止单元测试失败，而是无限期地等待用户输入。

是否有一个注册表项或编译器标志可以用来阻止此消息框请求用户输入，同时仍然允许测试在 ASSERT 下失败？

**基本上，我想在不修改任何代码的情况下执行此操作，只需更改编译器或 Windows 选项。**

谢谢！

[Microsoft Visual C++ 调试库断言 http://img519.imageshack.us/img519/853/snapshotbu1.png](http://img519.imageshack.us/img519/853/snapshotbu1.png "Microsoft Visual C++ 调试库 ASSERT")

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:06:42.153

我认为这是 _CrtDbgReport 为 _CRT_ASSERT 类型的报告显示的对话框。使用 _CrtSetReportHook，您可以为整个应用程序定制该行为。（即需要一个本地更改）特别是，您可以在断言失败后继续执行，从而忽略它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T17:29:35.600

从 MSDN 关于 ASSERT 宏：

在 MFC ISAPI 应用程序中，调试模式下的断言会弹出一个模态对话框（ASSERT 对话框现在默认是模态的）；这将中断或挂起执行。要抑制模式断言对话框，请将以下行添加到项目源文件 (projectname.cpp)：

```
// For custom assert and trace handling with WebDbg
#ifdef _DEBUG
CDebugReportHook g_ReportHook;
#endif 
```

完成此操作后，您可以使用 WebDbg 工具 (WebDbg.exe) 查看断言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-18T11:38:01.827

在单元测试上下文中，将 ASSERT（实际上是`_CrtDbgReport`调用）转换为包含一些信息文本的异常通常是好的，通常是 std::exception。这往往会以失败的形式出现在单元测试的输出日志中。这正是你想要的：失败的 ASSERT 应该是失败的单元测试。

通过投入您的报告挂钩函数来做到这一点，如使用指定的那样：`_CrtSetReportHook()`

# c++ - 在没有网络服务器的情况下生成 WSDL

> ID：163487
> 
> 赞同：0
> 
> 时间：2008-10-02T17:12:06.500
> 
> 标签：c++, visual-studio, wsdl

我想在不使用 Web 服务器的情况下从 c++ atl webservice 生成 WSDL 文件。我想将它作为 Visual Studio 构建的一部分或作为构建后事件生成。我找到了一个为 .NET 程序集执行此操作的程序 ( [CmdHelper](http://www.stephan-brenner.com/?page_id=82) )，但它似乎不适用于我所需要的。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-02T18:51:34.267

[Microsoft SOAP Toolkit](http://www.microsoft.com/downloads/details.aspx?familyid=c943c0dd-ceec-4088-9753-86f052ec8450&displaylang=en)带有一个 WSDL 生成器，它将从 COM 组件生成一个 WSDL 文件。我们在我工作的地方使用它，它似乎可以完成这项工作。我们没有尝试将它集成到我们的构建过程中——当我们需要更新 WSDL 时，我们总是手动运行该工具，并将生成的 WSDL 检查到版本控制中。

我看到微软已经弃用了这个产品，所以可能会有更新的替代品，但它对我们来说很好用。

# time - 状态和时间穿越逻辑和程序流程？

> ID：163492
> 
> 赞同：1
> 
> 时间：2008-10-02T17:13:39.260
> 
> 标签：time, logic, state

想知道使用一些参考键索引应用程序的每个可能状态是否有用......

意思是，假设我们有一个启动的程序，只有这么多可能的结果，比如 8。

但是如果每个结果都是通过更多的逻辑状态来获得的，并且在每个分支之间被认为是一个状态并映射到一个键。

在大型程序中可能会占用大量内存，但如果我们可以直接访问密钥（密钥可以基于时间或逻辑深度），那么我们可以立即遍历任何可能的情况，而无需启动整个过程再次使用新数据。

可以把它想象成一棵树，其中没有子节点的节点是最终结果，节点与其父节点或子节点之间的每个分支都是一个“状态”，每个分支都有不同的键控。因此，虽然只有 8 个叶子，或者该过程的最终结果，但可能存在许多“状态”，具体取决于逻辑在没有子节点之前沿着树向下走的深度。

也许用于模拟，但这需要大量内存。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T17:19:26.000

对于一般程序，这将无法解决。停止问题证明不可能确定程序是否会停止。确定给定状态是否可能的问题可以归结为停止问题，因此也无法解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T18:22:53.273

我认为这种方法对于任何事情都是完全难以处理的。

作为一个搜索问题，它太大了。如果我们假设每个状态可以导致 10 种结果（尽管我认为这个数字真的很低），那么为了向前看 20 步，我们现在必须跟踪 2000 亿种可能性。

请记住，循环中的每一步都算作一个分支点。因此，如果我们的代码如下所示：

```
for (int i=0; i < 100; i++)
    some_function(); 
```

那么可能的状态数是（some_function内部的分支数）^ 100

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-17T04:59:22.837

虽然 Josh 是对的，由于它的模棱两可，您无法回答这个问题的最自由版本，但如果您对您的场景设置一些限制，您可以回答它。您的程序状态与业务实体的状态之间存在很大差异。

例如，假设您有一个由 DFA（状态机）定义的面向工作流的应用程序。然后，您实际上可以将该 DFA 中的给定点与某种 id 相关联。

所以是的，它是易于处理的，但并非没有限制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T17:17:52.570

这是在功能级别上完成的；这是一种称为[memoization](http://en.wikipedia.org/wiki/Memoization)的技术。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T18:37:50.647

研究克里普克结构和模态逻辑。这是建模程序中采用的一种方法。我忘记了使用这种方法的经典系统是什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T06:44:13.187

**瑞安，答案是肯定的。**

与第一个答案相反，停止问题并不能证明任何事情。事实上，瑞恩，你的建议证明了错误的停机问题~~不适~~用于真正的数字计算机，我以前曾用这个例子作为证明。

在确定性数字系统（即在真实数字硬件上运行的程序）中，可能状态的数量是有限的，因此所有可能的状态都是可枚举的。

哈希所需的确切内存量为：

**`(2)*(program state size)*(number of initial states)`**

初始状态将是您的哈希键，最终状态将是哈希值，然后每个初始状态都有一个键/值对。

对于操作系统，“程序状态大小”为 2^（所有系统设备的总内存千兆位）。显然，如此大的通用程序需要不切实际的内存量来散列，并且无论如何都不会有用，因为系统是自引用/不可约复杂的（即下一个用户输入取决于先前的系统输出）。

**解释：**

这非常有用，因为如果您索引每个可能的初始状态并将其与终止状态相关联，您将有效地将任何程序的运行时间归零！任何为零，我的意思是非常快的 O(1) 运行时间——查找终止状态（如果它终止）所需的时间。

运行一个程序，从所有可能的状态开始，将提供一种显示循环的状态图。 **因此解决了停止问题，因为在给定任何可能的初始状态时，只有三种（实际上是四种折叠为三种）可能性：**

1.  在耗尽所有可能的状态之前，程序将重新进入先前遇到的状态（从初始状态开始），因此在逻辑上永远循环。
2.  程序在有机会重新进入先前遇到的状态或用尽所有可能的状态（自初始状态以来）之前达到标识为“终止”的状态。
3.  或 4\. 最简单的程序将从初始状态开始，将进入所有可能的状态仅一次，然后别无选择，只能 (3) 停止或 (4) 重新进入先前遇到的状态并永远循环。

    for (int i = 0; true; i++); //i 将达到最大值，回滚到零，此时它将重新进入初始状态

因此，基本上，您的索引可以这样描述：

*   **对于每个初始状态，恰好有一个或零个终止状态。**

换句话说，对于每个初始状态，程序要么达到终止状态，要么重新进入自初始状态以来已经遇到的状态并无限循环。

**因此，对于在确定性数字硬件**上运行的任何程序，**绝对有可能**（但通常**不切实际**）确定其所有状态以及它是否永远停止或循环。

*   实用性仅取决于您拥有多少有效初始状态（可以通过输入约束*大幅*减少），以及花时间运行程序以终止它们并将结果状态存储在哈希中的可行性桌子。

除了强制任何程序的运行时间为 O(1) 操作之外，捕获状态的其他用途包括游戏控制台模拟器中的保存状态功能和计算机的休眠功能（尽管不是完美的状态恢复，因为必须使用一些系统内存对于恢复状态的代码和一些内存可能永远不会被存储（例如GPU内存））。

这证明了任何程序都可以用哈希表来表示。任何程序都可以用初始到最终状态转换图来表示。 **所有程序都可以简化为一个具有大量内存占用的大功能！**

# ruby - 将 Ruby 程序作为 Windows 服务运行？

> ID：163497
> 
> 赞同：32
> 
> 时间：2008-10-02T17:14:43.610
> 
> 标签：ruby, windows-services

是否可以将 ruby​​ 应用程序作为 Windows 服务运行？我看到有一个相关的问题讨论了将[Java 应用程序作为 Windows 服务](https://stackoverflow.com/questions/25530/best-method-to-run-a-java-application-as-a-nix-daemon-or-windows-service)运行，你如何使用 Ruby 应用程序来做到这一点？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-02T17:23:55.053

查看以下库：[Win32Utils](http://win32utils.rubyforge.org/)。您可以创建一个简单的服务，您可以在闲暇时启动/停止/重新启动。我目前正在使用它来管理 Windows 托管的 Rails 应用程序的 Mongrel 实例，它可以完美运行。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-02T20:17:52.420

在尝试 Win32Utils 时，确实需要研究文档并查看网络，然后才能找到一些简单的工作示例。这似乎在今天 2008-10-02 有效：

宝石安装 win32 服务

2012-11-20 更新：根据[https://stackoverflow.com/users/1374569/paul，register_bar.rb](https://stackoverflow.com/users/1374569/paul) 现在应该是

```
Service.create( :service_name => 'some_service',
                :host => nil,
                :service_type       => Service::WIN32_OWN_PROCESS,
                :description        => 'A custom service I wrote just for fun',
                :start_type         => Service::AUTO_START,
                :error_control      => Service::ERROR_NORMAL,
                :binary_path_name   => 'c:\usr\ruby\bin\rubyw.exe -C c:\tmp\ bar.rb',
               :load_order_group   => 'Network',
               :dependencies       => ['W32Time','Schedule'],
               :display_name       => 'This is some service'       ) 
```

* * *

# bar.rb

# 创建应用程序/守护程序

```
LOG_FILE = 'C:\\test.log'

begin
  require "rubygems"
  require 'win32/daemon'

  include Win32

  class DemoDaemon < Daemon

    def service_main
      while running?
      sleep 10
      File.open("c:\\test.log", "a"){ |f| f.puts "Service is running #{Time.now}" } 
    end
  end 

    def service_stop
      File.open("c:\\test.log", "a"){ |f| f.puts "***Service stopped #{Time.now}" }
      exit! 
    end
  end

  DemoDaemon.mainloop
rescue Exception => err
  File.open(LOG_FILE,'a+'){ |f| f.puts " ***Daemon failure #{Time.now} err=#{err} " }
  raise
end 
```

* * *

bar.rb 是服务，但我们必须先创建和注册！这可以通过 sc create some_service 来完成

## 但是如果我们要使用 ruby​​ 和 win32utils 我们应该做一个

# register_bar.rb

```
 require "rubygems"
require "win32/service"
   include Win32

   # Create a new service
   Service.create('some_service', nil,
      :service_type       => Service::WIN32_OWN_PROCESS,
      :description        => 'A custom service I wrote just for fun',
      :start_type         => Service::AUTO_START,
      :error_control      => Service::ERROR_NORMAL,
      :binary_path_name   => 'c:\usr\ruby\bin\rubyw.exe -C c:\tmp\ bar.rb',
      :load_order_group   => 'Network',
      :dependencies       => ['W32Time','Schedule'],

      :display_name       => 'This is some service'
   ) 
```

* * *

注意，'c:\usr\ruby\bin\rubyw.exe -C c:\tmp\ bar.rb' 中的 c:\tmp\ bar.rb 之间有一个空格

运行`ruby register_bar.rb` ，现在可以从 Windows 服务控制面板或

```
sc start some_service 
```

并观看 c:test.log 填充 Service is running Thu Oct 02 22:06:47 +0200 2008

## 对于简单的有一些东西可以使用它更容易删除服务寄存器并创建一个新的而不是修改现有的

# unregister_bar.rb

```
 require "rubygems"
    require "win32/service"
       include Win32

    Service.delete("some_service") 
```

* * *

感谢人们 [http://rubypane.blogspot.com/2008/05/windows-service-using-win32-service-and_29.html](http://rubypane.blogspot.com/2008/05/windows-service-using-win32-service-and_29.html)

[http://rubyforge.org/docman/view.php/85/595/service.html](http://rubyforge.org/docman/view.php/85/595/service.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-01-23T11:54:09.470

这是执行fireeamon的代码模板:)

```
#####################################################################
#  runneur.rb :  service which run (continuously) a process
#                   'do only one simple thing, but do it well'
#####################################################################
# Usage:
#   .... duplicate this file : it will be the core-service....
#   .... modify constantes in beginning of this script....
#   .... modify stop_sub_process() at end  of this script for clean stop of sub-application..
#
#   > ruby runneur.rb install   foo     ; foo==name of service, 
#   > ruby runneur.rb uninstall foo
#   > type d:\deamon.log"       ; runneur traces
#   > type d:\d.log             ; service traces
#
#####################################################################
class String; def to_dos() self.tr('/','\\') end end
class String; def from_dos() self.tr('\\','/') end end

rubyexe="d:/usr/Ruby/ruby19/bin/rubyw.exe".to_dos

# example with spawn of a ruby process...

SERVICE_SCRIPT="D:/usr/Ruby/local/text.rb"
SERVICE_DIR="D:/usr/Ruby/local".to_dos
SERVICE_LOG="d:/d.log".to_dos           # log of stdout/stderr of sub-process
RUNNEUR_LOG="d:/deamon.log"             # log of runneur

LCMD=[rubyexe,SERVICE_SCRIPT]   # service will do system('ruby text.rb')
SLEEP_INTER_RUN=4               # at each dead of sub-process, wait n seconds before rerun

################### Installation / Desintallation ###################
if ARGV[0]
    require 'win32/service'
    include Win32

    name= ""+(ARGV[1] || $0.split('.')[0])
    if ARGV[0]=="install"
        path = "#{File.dirname(File.expand_path($0))}/#{$0}".tr('/', '\\')
        cmd = rubyexe + " " + path
        print "Service #{name} installed with\n cmd=#{cmd} ? " ; rep=$stdin.gets.chomp
        exit! if rep !~ /[yo]/i

        Service.new(
         :service_name     => name,
         :display_name     => name,
         :description      => "Run of #{File.basename(SERVICE_SCRIPT.from_dos)} at #{SERVICE_DIR}",
         :binary_path_name => cmd,
         :start_type       => Service::AUTO_START,
         :service_type     => Service::WIN32_OWN_PROCESS | Service::INTERACTIVE_PROCESS
        )
        puts "Service #{name} installed"
        Service.start(name, nil)
        sleep(3)
        while Service.status(name).current_state != 'running'
            puts 'One moment...' + Service.status(name).current_state
            sleep 1
        end
        while Service.status(name).current_state != 'running'
            puts ' One moment...' + Service.status(name).current_state
            sleep 1
        end
        puts 'Service ' + name+ ' started'      
    elsif ARGV[0]=="desinstall" || ARGV[0]=="uninstall"
        if Service.status(name).current_state != 'stopped'
            Service.stop(name)
            while Service.status(name).current_state != 'stopped'
                puts 'One moment...' + Service.status(name).current_state
                sleep 1
            end
        end
        Service.delete(name)
        puts "Service #{name} stopped and uninstalled"

    else
        puts "Usage:\n > ruby #{$0} install|desinstall [service-name]"
    end 
    exit!
end

#################################################################
#  service runneur : service code 
#################################################################
require 'win32/daemon'
include Win32

Thread.abort_on_exception=true
class Daemon
    def initialize
        @state='stopped'
        super
        log("******************** Runneur #{File.basename(SERVICE_SCRIPT)} Service start ***********************")
    end
    def log(*t)
        txt= block_given?()  ? (yield() rescue '?') : t.join(" ")
        File.open(RUNNEUR_LOG, "a"){ |f| f.puts "%26s | %s" % [Time.now,txt] } rescue nil
    end
    def service_pause
        #put activity in pause
        @state='pause'
        stop_sub_process
        log { "service is paused" }
    end
    def service_resume
        #quit activity from pause
        @state='run'
        log { "service is resumes" }
    end
    def service_interrogate
        # respond to quistion status
        log { "service is interogate" }
    end
    def service_shutdown 
        # stop activities before shutdown
        log { "service is stoped for shutdown" }
    end

    def service_init
        log { "service is starting" }
    end
    def service_main
        @state='run'
        while running?
        begin
            if @state=='run'
                log { "starting subprocess #{LCMD.join(' ')} in #{SERVICE_DIR}" }
                @pid=::Process.spawn(*LCMD,{
                    chdir: SERVICE_DIR, 
                    out: SERVICE_LOG, err: :out
                }) 
                log { "sub-process is running : #{@pid}" }
                a=::Process.waitpid(@pid)
                @pid=nil
                log { "sub-process is dead (#{a.inspect})" }
                sleep(SLEEP_INTER_RUN) if @state=='run'
            else
                sleep 3
                log { "service is sleeping" } if @state!='run'
            end
        rescue Exception => e
            log { e.to_s + " " + e.backtrace.join("\n   ")}
            sleep 4
        end
        end
    end

    def service_stop
     @state='stopped'
     stop_sub_process
     log { "service is stoped" }
     exit!
    end
    def stop_sub_process
        ::Process.kill("KILL",@pid) if @pid
        @pid=nil
    end
end

Daemon.mainloop 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T17:18:30.760

您可以编写（或下载）包装服务。包装器可以调用 ruby​​.exe 来执行您的程序。同样的技巧适用于 Java、VB 等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T17:19:26.453

您应该能够在 IronRuby 中完成此操作，因为您将拥有 .NET 框架。

# c# - C#、ASP.NET - NullReferenceException - 对象引用未设置为对象的实例

> ID：163507
> 
> 赞同：1
> 
> 时间：2008-10-02T17:18:08.593
> 
> 标签：c#, asp.net

使用中的变量定义：

```
Guid fldProId = (Guid)ffdPro.GetProperty("FieldId");
string fldProValue = (string)ffdPro.GetProperty("FieldValue");
FormFieldDef fmProFldDef = new FormFieldDef();
fmProFldDef.Key = fldProId;
fmProFldDef.Retrieve();
string fldProName = (string)fmProFldDef.GetProperty("FieldName");
string fldProType = (string)fmProFldDef.GetProperty("FieldType"); 
```

给出问题的行（特别是第 4 行（hTxtBox.Text = ...））：

```
if (fldProType.ToLower() == "textbox")
{
    Label hTxtBox = (Label)findControl(fldProName);
    hTxtBox.Text = fldProValue;
} 
```

所有数据都是从数据库中正确收集的，但是标签很糟糕。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T17:21:40.160

您确定 findControl 正在返回一个值吗？

hTxtBox.Text 是一个对可能引发 NullReferenceException 的集合进行任何计算的属性吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T17:22:24.527

findControl 正在返回一个空值。可能是特定的 Label 不是当前页面的直接子级，即在 UpdatePanel 或其他控件内，因此控件的实际名称与应用的名称不同（因此找不到它） . 例如，如果它被命名为“name”，则实际名称可能是 ctl0$content$name，因为它嵌套在页面上的另一个控件中。

您并没有真正提供有关上下文的足够信息，我无法给您更好的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:21:00.740

看起来 fmProFldDef 的 FieldName 属性很奇怪。您是否确认它正在获取 hTxtBox 的客户端 ID？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T17:21:19.413

此行返回 null：

```
Label hTxtBox = (Label)findControl(fldProName); 
```

这可能是“FieldName”不存在的结果（因此此行返回 null，然后在查找中使用 null）

```
string fldProName = (string)fmProFldDef.GetProperty("FieldName"); 
```

或 FieldName 中的文本不代表表单字段。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T18:15:24.773

FindControl 可能无法看到文本框 - 它是否在数据绑定控件中（例如 ListView、FormView 等）？

# design-patterns - 会计软件设计模式

> ID：163517
> 
> 赞同：48
> 
> 时间：2008-10-02T17:20:47.387
> 
> 标签：design-patterns, accounting

对于包含财务会计功能的软件的设计模式或其他最佳实践，是否有任何好的资源（书籍、权威指南等）？

具体来说，关于处理以下问题的好信息在哪里：

*   货币数量的内部表示
*   帐户、日记帐和其他记录的内部表示
*   协调不一致（自动或通过用户操作）
*   处理会计期间的结束（每天、每周、每月）
*   设计对商人有意义的用户界面和打印的财务报告

* * *

注意：我们在这里寻找“权威”或其他被广泛接受的信息。否则，这只会​​变成人们尝试过的所有事情的一大堆轶事，使话题变得非常主观。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-10-02T17:45:49.417

不久前，当我被分配到这样一个系统上工作时，我在 Martin Fowler 网站上找到了这个链接：

[Martin Fowler - 会计模式](http://www.martinfowler.com/apsupp/accounting.pdf)

它包含会计软件的一些模式，例如会计分录、交易和调整。他描述的架构是基于事件的。从来没有完整地阅读过它，因为我工作的系统已经处于开发阶段的中间，我无法更改设计。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-02T17:41:18.490

Martin Fowler 的[分析模式](https://rads.stackoverflow.com/amzn/click/com/0201895420)涵盖了其中一些主题。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-10-05T08:18:38.760

I would have the following structural classes:

1.  Account - Represents a financial account. eg. Cash, Sale, Expense;
2.  Category - The category where the Account belongs to. eg. Asset, Expenses, Revenues;
3.  Mutation - Represents a financial entry of an account.
4.  Transaction - Contains a collection of mutations.
5.  Money - A composite class using Currency object and storing amount as long integer;

When I approached the design initially I kept thinking about Decorator and Builder Patterns. Tax calculation can use the Strategy Pattern. Observer Pattern can be used to veto Transaction.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-02T17:56:23.493

在处理货币时，请记住，您不仅要记住输入金额的货币，还要记住输入的时间，以及当时每种货币的汇率。此外，当涉及到金额的“不准确”时，会计师也不会原谅。如果输入了金额，您必须将其存储为输入的金额，而不是先将其转换，因为之后您将无法保证您可以像输入的金额一样取回输入的金额。

这些听起来似乎是显而易见的事情，但在现实世界中人们确实对他们犯罪。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T17:48:27.520

我可以推荐[企业应用程序架构](http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FEnterprise-Application-Architecture-Addison-Wesley-Signature%2Fdp%2F0321127420%2F&tag=harryspublicm-20&linkCode=ur2&camp=1789&creative=9325)模式和 [分析模式，](http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FAnalysis-Patterns-Reusable-Addison-Wesley-Technology%2Fdp%2F0201895420&tag=harryspublicm-20&linkCode=ur2&camp=1789&creative=9325) Martin Fowler 的可重用对象模型，它们为常见问题提供软件架构模式。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-01-27T10:32:15.957

I find the [Data Model Resource book](https://rads.stackoverflow.com/amzn/click/com/0471380237) to be a good source of inspiration for modeling business structures. [Apache Ofbiz ERP](http://ofbiz.apache.org/) was built around the concepts in this book.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T17:43:22.230

对于 UI / 报告：查看 Crystal Reports 和 Business Objects。两者都在我在投资会计部门的工作地点使用。

我们在这里使用其他的内部结构（JD Edwards），但除了“是的，确实如此”之外，我无法真正深入细节

# asp.net - 使用 WiX 设置 ASP.Net 版本

> ID：163531
> 
> 赞同：25
> 
> 时间：2008-10-02T17:22:50.203
> 
> 标签：asp.net, installation, wix

我正在使用 WiX 为 ASP.Net 网站创建安装程序。如何使用 WiX 在 IIS 中设置 ASP.Net 版本？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-14T08:57:18.240

我们使用这个：

首先从注册表中确定.Net框架根目录：

```
<Property Id="FRAMEWORKROOT">
  <RegistrySearch Id="FrameworkRootDir" Root="HKLM"
                Key="SOFTWARE\Microsoft\.NETFramework" 
                Type="directory" Name="InstallRoot" />
</Property> 
```

然后，在 IIS 中安装您的网站的组件内部：

```
<!-- Create and configure the virtual directory and application. -->
<Component Id='WebVirtualDirComponent' Guid='{GUID}' Permanent='no'>
  <iis:WebVirtualDir Id='WebVirtualDir' Alias='YourAlias' Directory='InstallDir' WebSite='DefaultWebSite'  DirProperties='DirProperties'>
    <iis:WebApplication Id='WebApplication' Name='YourAppName' WebAppPool='AppPool'>
      <!-- Required to run the application under the .net 2.0 framework -->
      <iis:WebApplicationExtension Extension="config" CheckPath="yes" Script="yes"
                    Executable="[FRAMEWORKROOT]v2.0.50727\aspnet_isapi.dll" Verbs="GET,HEAD,POST" />
      <iis:WebApplicationExtension Extension="resx" CheckPath="yes" Script="yes"
                    Executable="[FRAMEWORKROOT]v2.0.50727\aspnet_isapi.dll" Verbs="GET,HEAD,POST" />
      <iis:WebApplicationExtension Extension="svc" CheckPath="no" Script="yes"
                    Executable="[FRAMEWORKROOT]v2.0.50727\aspnet_isapi.dll" Verbs="GET,HEAD,POST" />
    </iis:WebApplication>
  </iis:WebVirtualDir>
</Component> 
```

对于 x64 安装程序（**这很重要**）将 Win64='yes' 添加到注册表搜索，因为 64 位机器上的 32 位环境具有不同的注册表配置单元（和不同的 frameworkroot）

```
<RegistrySearch Id="FrameworkRootDir" Root="HKLM"
        Key="SOFTWARE\Microsoft\.NETFramework" 
        Type="directory" 
        Name="InstallRoot" Win64='yes' /> 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-28T22:26:49.023

在与它搏斗之后，这对我有用：

```
 <Property Id="FRAMEWORKBASEPATH">
     <RegistrySearch Id="FindFrameworkDir" Root="HKLM" Key="SOFTWARE\Microsoft\.NETFramework" Name="InstallRoot" Type="raw"/>
  </Property>
  <Property Id="ASPNETREGIIS" >
     <DirectorySearch Path="[FRAMEWORKBASEPATH]" Depth="4" Id="FindAspNetRegIis">
        <FileSearch Name="aspnet_regiis.exe" MinVersion="2.0.5"/>
     </DirectorySearch>
  </Property>

  <CustomAction Id="MakeWepApp20" Directory="TARGETDIR" ExeCommand="[ASPNETREGIIS] -norestart -s W3SVC/[WEBSITEID]/ROOT/[VIRTUALDIR]" Return="check"/>

  <InstallExecuteSequence>
     <Custom Action="MakeWepApp20" After="InstallFinalize">ASPNETREGIIS AND NOT Installed</Custom>
  </InstallExecuteSequence> 
```

[WEBSITEID] 和 [VIRTUALDIR] 是您必须自己定义的属性。[VIRTUALDIR] 仅当您为应用程序而不是整个网站设置 ASP.NET 版本时才需要。

自定义操作的顺序至关重要。在 InstallFinalize 之前执行它会导致它失败，因为在此之后 Web 应用程序不可用。

感谢 Chris Burrows 提供了一个查找 aspnet_regiis 可执行文件的正确示例（Google“使用 WIX 保护连接字符串”）。

jb

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-09-03T15:07:28.620

不要忘记在服务器上启用 ASP 2.0

```
<iis:WebServiceExtension Id="ExtensionASP2" Group="ASP.NET v2.0.50727" Allow="yes" File="[NETFRAMEWORK20INSTALLROOTDIR]aspnet_isapi.dll" Description="ASP.NET v2.0.50727"/> 
```

[这是软问题](https://stackoverflow.com/questions/269991/set-existing-web-service-extension-to-allow-using-wix)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-03-12T10:49:03.233

我的回答与这里看到的其他人基本相同；我只是想为人们提供另一个例子。

鉴于 ASP.NET 处理的文件扩展名的数量，以及每个版本中列表的变化，我认为最可靠的解决方案是`aspnet_regiis`在安装结束时运行。但这确实意味着，我不支持回滚或卸载。我在 IIS 中创建一个新应用程序，这并不重要，因为它将被 Wix 删除。如果您正在修改现有应用程序，也许您可​​以从注册表中找出配置了 ASP.NET 的哪个版本，然后运行该版本`aspnet_regiis`来撤消您的更改。

以下使用 Wix 3.5。

```
<Fragment>
    <!-- Use the properties in Wix instead of doing your own registry search. -->
    <PropertyRef Id="IISMAJORVERSION"/>
    <PropertyRef Id="NETFRAMEWORK40FULL"/>
    <PropertyRef Id="NETFRAMEWORK40FULLINSTALLROOTDIR"/>

    <!-- The code I'm using is intended for IIS6 and above, and it needs .NET 4 to be
    installed. -->
    <Condition Message="This application requires the .NET Framework 4.0\. Please install the required version of the .NET Framework, then run this installer again.">
        <![CDATA[Installed OR (NETFRAMEWORK40FULL)]]>
    </Condition>
    <Condition Message="This application requires Windows Server 2003 and Internet Information Services 6.0 or better.">
        <![CDATA[Installed OR (VersionNT >= 502)]]>
    </Condition>

    <!-- Populates the command line for CAQuietExec. IISWEBSITEID and IISVDIRNAME 
    could be set to default values, passed in by the user, or set in your installer's 
    UI. -->
    <CustomAction Id="ConfigureIis60AspNetCommand" Property="ConfigureIis60AspNet"
                  Execute="immediate"
                  Value="&quot;[NETFRAMEWORK40FULLINSTALLROOTDIR]aspnet_regiis.exe&quot; -norestart -s &quot;W3SVC/[IISWEBSITEID]/ROOT/[IISVDIRNAME]&quot;" />
    <CustomAction Id="ConfigureIis60AspNet" BinaryKey="WixCA" DllEntry="CAQuietExec" 
                  Execute="deferred" Return="check" Impersonate="no"/>
    <InstallExecuteSequence>
        <Custom Action="ConfigureIis60AspNetCommand" After="CostFinalize"/>

        <!-- Runs the aspnet_regiis command immediately after Wix configures IIS. 
        The condition shown here assumes you have a selectable feature in your 
        installer with the ID "WebAppFeature" that contains your web components. The 
        command will not be run if that feature is not being installed, or if IIS is 
        not version 6\. It *will* run if the application is being repaired. 

        SKIPCONFIGUREIIS is a property defined by Wix that causes it to skip the IIS
        configuration. -->
        <Custom Action="ConfigureIis60AspNet" After="ConfigureIIs" Overridable="yes">
            <![CDATA[((&WebAppFeature = 3) OR (REINSTALL AND (!WebAppFeature = 3))) 
            AND (NOT SKIPCONFIGUREIIS) AND (IISMAJORVERSION = "#6")]]>
        </Custom>
    </InstallExecuteSequence>
    <UI>
        <ProgressText Action="ConfigureIis60AspNetCommand"
            >Configuring ASP.NET</ProgressText>
        <ProgressText Action="ConfigureIis60AspNet"
            >Configuring ASP.NET</ProgressText>
    </UI>

</Fragment> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T20:56:31.907

我通过使用 WiX WebApplicationExtension 找到了一种不同的方法。您可以在[此处](http://www.mail-archive.com/wix-users@lists.sourceforge.net/msg11420.html)和[此处](http://www.mail-archive.com/wix-users@lists.sourceforge.net/msg11451.html)查看完整的解决方案。

到目前为止，我喜欢 Wix，但确实需要大量的挖掘才能找到你要找的东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-16T23:48:51.013

这有点简单。我不知道这是否适用于更新现有的 AppPool，但适用于创建 APP Pool 和设置 .NET 版本。

```
<iis:WebServiceExtension Id="AMS_AppPool" Name="AccountManagementSVC1" Identity="other"  ManagedPipelineMode="integrated" ManagedRuntimeVersion="v4.0" User="AMS_AppPoolUser" RecycleMinutes="120" /> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T17:58:43.457

*   首先找到正确的 .NET 版本文件夹。使用 DirectorySearch/FileSearch 执行搜索。

*   使用上述路径调用 aspnet_regiis.exe 并通过自定义操作设置 webapp 的版本。

    `aspnet_regiis.exe -s W3SVC/1/ROOT/SampleApp1`

# sql-server - 恢复 SQL Server Express Edition 数据库

> ID：163534
> 
> 赞同：0
> 
> 时间：2008-10-02T17:24:07.657
> 
> 标签：sql-server

有没有办法从 SQL Server Express Edition 中获取备份文件并将其还原到标准 SQL Server 数据库中？我尝试从 Management Studio 执行此操作，但它无法识别文件格式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T20:06:11.590

如果您有数据库 .bak 文件，您可以从 SQL Server 2005 Express 移动到 SQL Server。

只需确保选中覆盖现有数据库的选项即可。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T17:26:05.827

是的。它应该使用标准工具工作。您正在使用哪些版本的数据库？

# asp.net - 使用 jQuery 查找 ASP.Net 控件的最佳方法是什么？

> ID：163535
> 
> 赞同：15
> 
> 时间：2008-10-02T17:24:22.087
> 
> 标签：asp.net, jquery, controls

在使用 jquery 实现我的第一个重要脚本时，我需要在页面上找到一个特定的 web 控件。由于我使用 DotNetNuke，因此无法保证控件 ClientID，因为容器控件可能会因站点而异。我最终使用了一个属性选择器来查找以控件的服务器 ID 结尾的 ID。

```
$("select[id$='cboPanes']") 
```

这似乎不是最好的方法。还有另一种方法可以做到这一点吗？

* * *

@Roosteronacid - 当我得到我想要的控件时，我尝试遵循给定技术/语言的习语。当我在 C# 中编程时，我会尝试以最能利用 C# 特性的方式来进行。因为这是我第一次尝试真正使用 jQuery，并且因为这将被成千上万的用户使用，所以我想确保我创建的代码对其他人来说也是一个很好的例子。

@toohool - 这肯定会起作用，但不幸的是，出于性能原因，我需要将 javascript 保存在单独的文件中。如果您内联 javascript，您将无法真正很好地利用缓存，因为每个“页面”都是动态生成的。我最终会一遍又一遍地向客户端发送相同的 javascript，只是因为页面上的其他内容发生了变化。

* * *

@Roosteronacid - 当我得到我想要的控件时，我尝试遵循给定技术/语言的习语。当我在 C# 中编程时，我会尝试以最能利用 C# 特性的方式来进行。因为这是我第一次尝试真正使用 jQuery，并且因为这将被成千上万的用户使用，所以我想确保我创建的代码对其他人来说也是一个很好的例子。

@toohool - 这肯定会起作用，但不幸的是，出于性能原因，我需要将 javascript 保存在单独的文件中。如果您内联 javascript，您将无法真正很好地利用缓存，因为每个“页面”都是动态生成的。我最终会一遍又一遍地向客户端发送相同的 javascript，只是因为页面上的其他内容发生了变化。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-02T17:30:23.167

```
$("#<%= cboPanes.ClientID %>") 
```

这将动态注入控件的 DOM ID。当然，这意味着你的 JS 必须在 ASPX 文件中，而不是在外部 JS 文件中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T03:22:12.963

我过去做过的一件事（在 JavaScript 而不是 jQuery 中），在上面我的 JavaScript 导入中，输出动态控件 ID 类似于 toohool 推荐的内容，并将它们分配给我在脚本导入中引用的变量。

像这样的东西，应该允许您利用缓存并仍然使您能够拥有确切的客户端 ID：

```
<head>
    <script type="text/javascript>
        var cboPanesID = <%= cboPanes.ClientID %>;
    </script>

    <!-- this JS import references cboPanesID variable declared above -->
    <script src="jquery.plugin.js"></script>
</head> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T17:28:50.003

在控件上使用标记类，并通过 jQuery 选择它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T17:33:23.737

除了在性能方面稍微贵一点之外，我看不出使用该选择器有什么问题。毕竟; 您正在获得要访问的控件。

# .net - 如何从自定义 MSBuild 任务将输出写入控制台？

> ID：163537
> 
> 赞同：5
> 
> 时间：2008-10-02T17:24:23.820
> 
> 标签：.net, msbuild

我正在尝试调试 MSBuild 任务，并且我知道有一些方法可以从自定义任务中写入 MSBuild 日志，但我忘记了如何。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-02T17:28:36.803

基础[Task](http://msdn.microsoft.com/en-us/library/microsoft.build.utilities.task.aspx)类有一个`Log`可以使用的属性：

```
Log.LogMessage("My message"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T07:03:27.470

出于单元测试的目的，我将记录器包装在一个辅助类周围

```
public static void Log(ITask task, string message, MessageImportance importance)
{
    try
    {
        BuildMessageEventArgs args = new BuildMessageEventArgs(message, string.Empty, 
            task.ToString(), importance);
        task.BuildEngine.LogMessageEvent(args);
    }
    catch (NullReferenceException)
    {
        // Don't throw as task and BuildEngine will be null in unit test.
    }
} 
```

如今，为了方便起见，我可能会将其转换为扩展方法。

# c# - C# - Assert() 方法有什么作用？它还有用吗？

> ID：163538
> 
> 赞同：170
> 
> 时间：2008-10-02T17:24:28.407
> 
> 标签：c#, assert

我正在使用断点进行调试，并且我实现了断言调用？我认为这仅用于单元测试。它除了断点还有什么作用？既然可以断点，为什么要使用 Assert？

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2008-10-02T17:25:41.397

在调试编译[`Assert`](https://msdn.microsoft.com/en-us/library/kssw4w7z.aspx "MSDN 调试.断言")中，将布尔条件作为参数，如果条件为假，则显示错误对话框。如果条件为真，程序继续进行而不会中断。

如果你在 Release 中编译，所有[`Debug.Assert`](https://msdn.microsoft.com/en-us/library/kssw4w7z(v=vs.110).aspx#Remarks "MSDN Debug.Assert 备注")的 's 都会被自动排除在外。

* * *

## 回答 #2

> 赞同：104
> 
> 时间：2008-10-02T17:36:44.587

从[代码完成](http://cc2e.com/)

> ## 8 防御性编程
> 
> ### 8.2 断言
> 
> 断言是在开发过程中使用的代码——通常是例程或宏——允许程序在运行时检查自身。当断言为真时，这意味着一切都按预期运行。当它为假时，这意味着它在代码中检测到意外错误。例如，如果系统假设客户信息文件的记录永远不会超过 50,000 条，则程序可能包含记录数小于或等于 50,000 条的断言。只要记录数小于或等于 50,000，断言就会保持沉默。但是，如果它遇到超过 50,000 条记录，它会大声“断言”程序中存在错误。
> 
> 断言在大型复杂程序和高可靠性程序中特别有用。它们使程序员能够更快地清除不匹配的接口假设、修改代码时出现的错误等等。
> 
> 一个断言通常需要两个参数：一个布尔表达式，描述假设为真，如果不是，则显示消息。
> 
> （……）
> 
> 通常，您不希望用户在生产代码中看到断言消息；断言主要用于开发和维护期间。断言通常在开发时编译到代码中，并从代码中编译出来用于生产。在开发过程中，断言会清除矛盾的假设、意外情况、传递给例程的错误值等等。在生产过程中，它们是从代码中编译出来的，因此断言不会降低系统性能。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-10-02T17:31:13.927

当您不想为检查变量的每一行代码都设置断点时，您应该使用它，但如果存在某些情况，您确实希望获得某种反馈，例如：

```
Debug.Assert(someObject != null, "someObject is null! this could totally be a bug!"); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-02T17:33:02.973

Assert 还为您提供了另一个机会来嘲笑 Microsoft 的 UI 设计技能。我的意思是：一个包含三个按钮 Abort、Retry、Ignore 的对话框，以及如何在标题栏中解释它们的说明！

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2017-01-02T19:12:25.837

首先`Assert()`方法可用于`Trace`和`Debug`类。
`Debug.Assert()`仅在调试模式下执行。
`Trace.Assert()`正在调试和发布模式下执行。

这是一个例子：

```
 int i = 1 + 3;
        // Debug.Assert method in Debug mode fails, since i == 4
        Debug.Assert(i == 3);
        Debug.WriteLine(i == 3, "i is equal to 3");

        // Trace.Assert method in Release mode is not failing.
        Trace.Assert(i == 4);
        Trace.WriteLine(i == 4, "i is equla to 4");

        Console.WriteLine("Press a key to continue...");
        Console.ReadLine(); 
```

在调试模式下运行此代码，然后在发布模式下运行。

## [![在此处输入图像描述](https://i.stack.imgur.com/Tszjl.jpg)](https://i.stack.imgur.com/Tszjl.jpg)

您会注意到，在调试模式期间，您的代码`Debug.Assert`语句失败，您会看到一个消息框，显示应用程序的当前堆栈跟踪。这不会在 Release 模式下发生，因为`Trace.Assert()`condition 为 true `(i == 4)`。

`WriteLine()`方法只是为您提供了将信息记录到 Visual Studio 输出的选项。 [![在此处输入图像描述](https://i.stack.imgur.com/0NK9W.jpg)](https://i.stack.imgur.com/0NK9W.jpg)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-10-02T17:26:03.020

Assert 允许您断言在您的代码中应用的条件（post 或 pre）。这是一种记录您的意图并让调试器在未满足您的意图时通过对话框通知您的方式。

与断点不同，Assert 与您的代码一起使用，可用于添加有关您的意图的其他详细信息。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-10-02T17:27:53.983

Assert 可以帮助您在测试和发布之间提供单独的消息传递行为。例如，

`Debug.Assert(x > 2)`

如果您正在运行“调试”构建，而不是发布构建，则只会触发中断。[这里](http://en.csharp-online.net/Assert)有一个关于这种行为的完整例子

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-11-16T21:03:42.590

断言在按合同设计 (DbC) 中占有重要地位，据我所知，这是由 Meyer, Bertand 介绍/认可的。1997\. 面向对象的软件构造。

一个重要的特性是它们不能产生副作用，例如，您可以使用 if 语句（防御性编程）处理异常或采取不同的行动。

断言用于检查合同的前/后条件、客户/供应商关系 - 客户必须确保满足供应商的先决条件，例如。发送 5 英镑，供应商必须确保满足后置条件，例如。送出12朵玫瑰。（只是对客户/供应商的简单解释——可以接受更少，交付更多，但关于断言）。C# 还引入了 Trace.Assert()，可用于发布代码。

要回答这个问题，是的，它们仍然有用，但可以增加代码的复杂性+可读性和时间+难以维护。我们还应该使用它们吗？是的，我们都会使用它们吗？可能不是，或者不是迈耶描述的程度。

（即使是我学习此技术的 OU Java 课程也只显示了简单的示例，其余代码并未对大多数代码强制执行 DbC 断言规则，而是假定用于确保程序的正确性！）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-02T17:51:41.867

我认为它的方式是 Debug.Assert 是一种建立关于如何调用方法的协定的方法，重点关注关于参数值的细节（而不仅仅是类型）。例如，如果您不应该在第二个参数中发送空值，则在该参数周围添加 Assert 以告诉使用者不要这样做。

它可以防止某人以愚蠢的方式使用您的代码。但它也允许这种愚蠢的方式进入生产环境，而不是向客户传达令人讨厌的信息（假设您构建了发布版本）。

# python - 如何将字符串传递给 subprocess.Popen（使用 stdin 参数）？

> ID：163542
> 
> 赞同：321
> 
> 时间：2008-10-02T17:25:23.303
> 
> 标签：python, subprocess, stdin

如果我执行以下操作：

```
import subprocess
from cStringIO import StringIO
subprocess.Popen(['grep','f'],stdout=subprocess.PIPE,stdin=StringIO('one\ntwo\nthree\nfour\nfive\nsix\n')).communicate()[0] 
```

我得到：

```
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/build/toolchain/mac32/python-2.4.3/lib/python2.4/subprocess.py", line 533, in __init__
    (p2cread, p2cwrite,
  File "/build/toolchain/mac32/python-2.4.3/lib/python2.4/subprocess.py", line 830, in _get_handles
    p2cread = stdin.fileno()
AttributeError: 'cStringIO.StringI' object has no attribute 'fileno' 
```

显然，cStringIO.StringIO 对象与文件鸭的距离不够近，无法适应 subprocess.Popen。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：377
> 
> 时间：2008-10-03T04:11:07.493

[`Popen.communicate()`](https://docs.python.org/3/library/subprocess.html?highlight=subprocess#subprocess.Popen.communicate)文档：

> 请注意，如果您想将数据发送到进程的标准输入，您需要使用标准输入=PIPE 创建 Popen 对象。同样，要在结果元组中获得除 None 以外的任何内容，您也需要提供 stdout=PIPE 和/或 stderr=PIPE 。
> 
> **替换 os.popen***

```
 pipe = os.popen(cmd, 'w', bufsize)
    # ==>
    pipe = Popen(cmd, shell=True, bufsize=bufsize, stdin=PIPE).stdin 
```

> **警告**使用communicate() 而不是stdin.write()、stdout.read() 或stderr.read() 以避免由于任何其他OS 管道缓冲区填满并阻塞子进程而导致的死锁。

所以你的例子可以写成如下：

```
from subprocess import Popen, PIPE, STDOUT

p = Popen(['grep', 'f'], stdout=PIPE, stdin=PIPE, stderr=STDOUT)    
grep_stdout = p.communicate(input=b'one\ntwo\nthree\nfour\nfive\nsix\n')[0]
print(grep_stdout.decode())
# -> four
# -> five
# -> 
```

* * *

在 Python 3.5+（3.6+ for `encoding`）上，您可以使用[`subprocess.run`](https://docs.python.org/3/library/subprocess.html#subprocess.run), 将输入作为字符串传递给外部命令并获取其退出状态，并在一次调用中将其输出作为字符串返回：

```
#!/usr/bin/env python3
from subprocess import run, PIPE

p = run(['grep', 'f'], stdout=PIPE,
        input='one\ntwo\nthree\nfour\nfive\nsix\n', encoding='ascii')
print(p.returncode)
# -> 0
print(p.stdout)
# -> four
# -> five
# -> 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-02T17:27:55.760

我想出了这个解决方法：

```
>>> p = subprocess.Popen(['grep','f'],stdout=subprocess.PIPE,stdin=subprocess.PIPE)
>>> p.stdin.write(b'one\ntwo\nthree\nfour\nfive\nsix\n') #expects a bytes type object
>>> p.communicate()[0]
'four\nfive\n'
>>> p.stdin.close() 
```

有更好的吗？

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2016-12-08T10:04:26.587

如果您使用的是 Python 3.4 或更高版本，那么有一个很好的解决方案。使用`input`参数而不是`stdin`接受字节参数的参数：

```
output_bytes = subprocess.check_output(
    ["sed", "s/foo/bar/"],
    input=b"foo",
) 
```

这适用于[`check_output`](https://docs.python.org/3/library/subprocess.html#subprocess.check_output)and [`run`](https://docs.python.org/3/library/subprocess.html#subprocess.run)，但不适用于[`call`](https://docs.python.org/3/library/subprocess.html#subprocess.call)or[`check_call`](https://docs.python.org/3/library/subprocess.html#subprocess.check_call)出于某种原因。

在 Python 3.7+ 中，您还可以添加`text=True`make`check_output`将字符串作为输入并返回字符串（而不是`bytes`）：

```
output_string = subprocess.check_output(
    ["sed", "s/foo/bar/"],
    input="foo",
    text=True,
) 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2015-11-02T16:34:03.423

我有点惊讶没有人建议创建管道，在我看来，这是将字符串传递给子进程的标准输入的最简单的方法：

```
read, write = os.pipe()
os.write(write, "stdin input here")
os.close(write)

subprocess.check_call(['your-command'], stdin=read) 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2014-07-27T15:29:17.287

我正在使用 python3 并发现您需要先对字符串进行编码，然后才能将其传递到标准输入：

```
p = Popen(['grep', 'f'], stdout=PIPE, stdin=PIPE, stderr=PIPE)
out, err = p.communicate(input='one\ntwo\nthree\nfour\nfive\nsix\n'.encode())
print(out) 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-02T18:33:23.153

> 显然 cStringIO.StringIO 对象与文件鸭子不够接近以适应 subprocess.Popen

恐怕不是。管道是一个低级操作系统概念，因此它绝对需要一个由操作系统级文件描述符表示的文件对象。您的解决方法是正确的。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2012-04-13T03:36:37.190

```
from subprocess import Popen, PIPE
from tempfile import SpooledTemporaryFile as tempfile
f = tempfile()
f.write('one\ntwo\nthree\nfour\nfive\nsix\n')
f.seek(0)
print Popen(['/bin/grep','f'],stdout=PIPE,stdin=f).stdout.read()
f.close() 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-06-14T13:20:23.007

```
"""
Ex: Dialog (2-way) with a Popen()
"""

p = subprocess.Popen('Your Command Here',
                 stdout=subprocess.PIPE,
                 stderr=subprocess.STDOUT,
                 stdin=PIPE,
                 shell=True,
                 bufsize=0)
p.stdin.write('START\n')
out = p.stdout.readline()
while out:
  line = out
  line = line.rstrip("\n")

  if "WHATEVER1" in line:
      pr = 1
      p.stdin.write('DO 1\n')
      out = p.stdout.readline()
      continue

  if "WHATEVER2" in line:
      pr = 2
      p.stdin.write('DO 2\n')
      out = p.stdout.readline()
      continue
"""
..........
"""

out = p.stdout.readline()

p.wait() 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2019-12-27T04:29:04.120

在 Python 3.7+ 上执行以下操作：

```
my_data = "whatever you want\nshould match this f"
subprocess.run(["grep", "f"], text=True, input=my_data) 
```

并且您可能需要添加`capture_output=True`以获取将命令作为字符串运行的输出。

在旧版本的 Python 上，替换`text=True`为`universal_newlines=True`：

```
subprocess.run(["grep", "f"], universal_newlines=True, input=my_data) 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-05-19T14:56:38.567

请注意，如果太大，`Popen.communicate(input=s)`可能会给您带来麻烦，因为显然父进程会在分叉子子进程*之前*对其进行缓冲，这意味着它需要“两倍”的已用内存（至少根据“引擎盖下”的解释）并在[此处](https://stackoverflow.com/a/13329386/2426246)找到链接文档）。在我的特殊情况下，是一个生成器，它首先完全扩展，然后才写入，因此在子进程生成之前父进程非常大，并且没有内存可以分叉它：`s`*`s``stdin`*

 *`File "/opt/local/stow/python-2.7.2/lib/python2.7/subprocess.py", line 1130, in _execute_child self.pid = os.fork() OSError: [Errno 12] Cannot allocate memory`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2021-03-22T21:35:46.237

这对我来说太过分了`grep`，但是通过我的旅程，我了解了 Linux 命令`expect`和 python 库`pexpect`

*   **[expect](https://linux.die.net/man/1/expect)** : 与交互式程序的对话
*   **[pexpect](https://pexpect.readthedocs.io/en/stable/overview.html)**：用于生成子应用程序的 Python 模块；控制它们；并响应其输出中的预期模式。

```
import pexpect
child = pexpect.spawn('grep f', timeout=10)
child.sendline('text to match')
print(child.before) 
```

**[使用像pexpect](https://pexpect.readthedocs.io/en/stable/overview.html)**这样的交互式 shell 应用程序`ftp`是微不足道的

```
import pexpect
child = pexpect.spawn ('ftp ftp.openbsd.org')
child.expect ('Name .*: ')
child.sendline ('anonymous')
child.expect ('Password:')
child.sendline ('noah@example.com')
child.expect ('ftp> ')
child.sendline ('ls /pub/OpenBSD/')
child.expect ('ftp> ')
print child.before   # Print the result of the ls command.
child.interact()     # Give control of the child to the user. 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-09T04:39:40.930

```
p = Popen(['grep', 'f'], stdout=PIPE, stdin=PIPE, stderr=STDOUT)    
p.stdin.write('one\n')
time.sleep(0.5)
p.stdin.write('two\n')
time.sleep(0.5)
p.stdin.write('three\n')
time.sleep(0.5)
testresult = p.communicate()[0]
time.sleep(0.5)
print(testresult) 
```

# c# - 是否有可以使用 StreamWriter 写入的最大字符数？

> ID：163550
> 
> 赞同：21
> 
> 时间：2008-10-02T17:26:53.127
> 
> 标签：c#, .net, file-io

使用 StreamWriter 可以写入文件的最大字符数是否存在？或者是否有`WriteLine()`可以输出的最大字符数？我正在尝试将一些数据写入文件，但所有数据似乎都没有成功。这是我的代码的当前状态：

```
StreamWriter sw = new StreamWriter(pathToFile);

foreach (GridViewRow record in gv_Records.Rows)
{
    string recordInfo = "recordInformation";

    sw.WriteLine(recordInfo);
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-02T17:34:48.320

你是在调用 StreamWriter.Close() 还是 Flush()？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-02T17:37:48.513

确保将 StreamWriter 包装在 using 块中，或者注意对[资源生命周期的显式管理](http://msdn.microsoft.com/en-us/library/system.io.streamwriter.close.aspx)。

```
using (StreamWriter writer = new StreamWriter(@"somefile.txt"))
{
    // ...
    writer.WriteLine(largeAmountsOfData);
    // ...
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:37:51.930

确保您正在调用 .Flush()

# java - JDK/JRE 源代码与匹配的 JSSE (SSL) 源代码和匹配的可运行 JDK/JRE？

> ID：163552
> 
> 赞同：13
> 
> 时间：2008-10-02T17:27:16.073
> 
> 标签：java, ssl, jsse

我已经看到[在哪里可以找到 Java 6 JSSE/JCE 源代码？](https://stackoverflow.com/questions/87030/where-to-find-java-6-jssejce-source-code) 并问自己 [如何获得具有匹配源的 JRE/JDK？](https://stackoverflow.com/questions/150849/how-to-get-jrejdk-with-matching-source)但我并没有足够具体地得到我真正想要的答案，所以我将尝试一种更具体的问题版本。

基本上我要解决的问题是我希望能够在 Windows 上使用我的 Eclipse 调试器并进入 Java SSL 类 (JSSE) 以帮助我调试 SSL 问题以及更好地理解 SSL 过程. 顺便说一句，我熟悉（并使用）javax.net.debug=ssl|all 系统属性来获取 SSL 跟踪，虽然这非常有帮助，但我仍然希望能够单步执行那些讨厌的代码。

所以我认为我特别需要的是：

1.  一个可执行的 JRE / JDK 实现（不想构建一个）......
2.  在我的 Windows 平台 (XP) 上运行...
3.  这包括源...
4.  该来源包括 SSL“位”（JSSE 等）......
5.  理想情况下，SSL 实现是 Sun 或 OpenJDK 版本。

我认为最接近的东西（如 PW 的答案[StackOverflow: 87106](https://stackoverflow.com/questions/87030/where-to-find-java-6-jssejce-source-code#87106)中所述）是 OpenJDK 源代码 openjdk-6-src-b12-28_aug_2008.tar.gz 在[OpenJDK 6 Source Release](http://download.java.net/openjdk/jdk6/)中找到，但我不确定是否有匹配的可执行 JDK /JRE 用于在 Windows 上运行。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2016-05-30T06:38:46.310

您可以在此处获取 JSSE lib（Open JDK 实现）的源代码 - [http://hg.openjdk.java.net/jdk8u/jdk8u-dev/jdk/file/4d6c03fb1039/src/share/classes/sun/security/ ssl](http://hg.openjdk.java.net/jdk8u/jdk8u-dev/jdk/file/4d6c03fb1039/src/share/classes/sun/security/ssl)

创建源 jar 文件以附加到 IDE 以进行调试的步骤。

1.  转到目录结构的上方一点，即[http://hg.openjdk.java.net/jdk8u/jdk8u-dev/jdk/file/4d6c03fb1039/src/share/classes/](http://hg.openjdk.java.net/jdk8u/jdk8u-dev/jdk/file/4d6c03fb1039/src/share/classes/) repo。
2.  单击左侧窗格中的“zip”或“gz”链接下载源包。
3.  但这个包很大，包含数千个 *.java 文件。您通常不希望所有这些都只是调试 jsse.jar 代码。
4.  所以最好只将**sun.security.rsa**、**sun.security.ssl**、**sun.security.provider**和**com.sun.net.ssl**包复制到您计算机上的新文件夹（比如说 jsse-code）。
5.  从命令行转到该文件夹​​并自行创建源 jar。
    例如 **jar -cvf jsse-src.jar ***
6.  你完成了。您现在有了 jsse 源库，您可以将其附加到首选 IDE（例如 Eclipse）以调试 JSSE 代码。

谢谢阿亚斯
_

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-10T10:03:28.223

我使用了 Java 6 的 OpenJDK 下载：

[http://download.java.net/openjdk/jdk6/](http://download.java.net/openjdk/jdk6/)

为了调试 JSSE/SSL 代码，我使用了**sun.security.ssl**和**sun.security.ec**包中的类并创建了一个新库。不幸的是，仅仅拥有一个包含所有源代码的库对我来说还不够。我不知道如何让我的 IDE (Netbeans) 进入 JSSE 代码。相反，它调用了与我的 JDK 捆绑在一起的 JSSE。

作为一种解决方法，我最终将 ssl 和 ec 包重构为一个新的“提供者”。这是我所做的：

1.  将**SunJSSE**类重命名为**SSLProvider**并替换代码中对“SunJSSE”的所有引用。
2.  **将sun.security.ssl**和**sun.security.ec**重构为 2 个新包：**javaxt.ssl**和**javaxt.ec**
3.  查找/替换代码中对原始包名称的所有引用。例如，在 SSLProvider.java 类中，将“sun.security.ssl.SSLContextImpl”替换为“javaxt.ssl.SSLContextImpl”。

一旦我有了一个新的安全提供者，我就可以在我的代码中明确地引用它。例子：

```
 java.security.Provider provider = new javaxt.ssl.SSLProvider();
  java.security.Security.addProvider(provider);
  SSLContext sslc = SSLContext.getInstance("TLS", "SSLProvider"); 
```

通过显式设置安全提供程序，我现在可以删除断点并将打印语句扔到我心中的内容:-)

如果有人感兴趣，我在这里发布了“SSLProvider”源的 zip 存档：

[http://www.javaxt.com/download/?/jsse/SSLProvider.zip](http://www.javaxt.com/download/?/jsse/SSLProvider.zip)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-07-26T09:21:33.573

您可以按照以下步骤从其 mercurial 存储库中获取 JSSE lib（Open JDK 实现）的源代码，以创建源 zip 文件以附加到 IDE 以进行调试。

1.  获取您的 java 构建版本（在我的情况下构建是 1.8.0_181-b13）

    ```
    java -version 
    ```

    可能你会得到这样的结果：

    ```
    java version "1.8.0_181"
    Java(TM) SE Runtime Environment (build 1.8.0_181-b13)
    Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode) 
    ```

2.  [现在我们可以在这个存储库](http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/tags)中找到我们版本的节点。在我的例子中，我的标签是**jdk8u181-b13**因为我的构建是**1.8.0_181-b13**并且它的节点是**0cb452d66676**请记住 java 版本是**jdk8u**。我们可以通过单击左侧窗格中看到的“zip”或“gz”链接来下载源代码包，然后手动将其重新打包为 zip。或者只选择您需要的包。

3.  在这个例子中，我将下载目录下的所有包`classes`。为此，将本脚本中的jdk8u版本**和**节点 **0cb452d66676**替换为下载源代码，并重新打包成`src`zip文件。

    ```
    version=jdk8u
    node=0cb452d66676
    mkdir ~/temp
    cd ~/temp
    wget http://hg.openjdk.java.net/$version/$version/jdk/archive/$node.zip/src/share/classes/
    unzip $node.zip -d $version-$node
    cd jdk-$node/src/share/classes/
    zip -r $version-$node-src.zip . 
    ```

4.  将源代码添加到您的 IDE 和愉快的编码中。

**注意：**在这个存储库中，可用的版本是：

*   [JDK6](http://hg.openjdk.java.net/jdk6/jdk6/jdk/tags)
*   [JDK7](http://hg.openjdk.java.net/jdk7/jdk7/jdk/tags)
*   [jdk7u](http://hg.openjdk.java.net/jdk7u/jdk7u/jdk/tags)
*   [JDK8](http://hg.openjdk.java.net/jdk8/jdk8/jdk/tags)
*   [jdk8u](http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/tags)
*   [JDK9](http://hg.openjdk.java.net/jdk9/jdk9/jdk/tags)
*   [jdk10](http://hg.openjdk.java.net/jdk10/jdk10/jdk/tags)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-29T21:29:40.613

事实上，SSL 实现包含在 OpenJDK 源代码中，但由于某种原因不在标准源 Zip 文件中。我不知道为什么。

我不知道通常会从哪里获取 OpenJDK 源；我通过`apt-get source openjdk-6`. SSL 实现源位于`jdk/src/share/classes/javax/net/ssl`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T05:20:49.813

据我所知，Sun 的实现并不是开源的。您可以在此处下载开源 JCE：

[http://www.bouncycastle.org/java.html](http://www.bouncycastle.org/java.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-07-23T18:35:40.197

接下来，您可以下载 OpenJDK：

[https://adoptopenjdk.net/](https://adoptopenjdk.net/)

并将其与源代码完全匹配

[https://github.com/AdoptOpenJDK/openjdk-jdk8u](https://github.com/AdoptOpenJDK/openjdk-jdk8u)

目前 u172-b11 是最新版本，但它们是同步的，可以在所有平台上运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-07T13:41:11.443

我最终在运行 eclipse luna 和 javac 1.8.0_171 的 Mac OS X High Sierra 10.13.4 上执行了以下操作

在同样运行 open jdk 和 javac 1.8.0_171 的 ubuntu 机器上

```
apt-get install openjdk-8-source

cd tmp

unzip /usr/lib/jvm/openjdk-8/src.zip "sun/security/*"

zip -r jsse-src sun 
```

我没有包括 com/sun/net/ssl 的东西，但对我来说已经足够好了。

然后我复制`jsse-src.zip`到mac`/Library/Java/JavaVirtualMachines/jdk1.8.0_171.jdk/Contents/Home/`并指向eclipse。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-05-30T07:59:51.620

Sun Java 版本的 JSSE 源代码以前可以通过[Sun Community Source License Program 获得](http://wwws.sun.com/software/communitysource/j2se/java2/download.html)。自从甲骨文收购以来，它似乎已经消失了，但我希望我错了。

# asp.net - Wiki 样式文本格式

> ID：163562
> 
> 赞同：6
> 
> 时间：2008-10-02T17:29:49.343
> 
> 标签：asp.net, html, .net, wiki, text-formatting

我正在寻找某种用于 ASP.NET 的文本解析器，它可以从某种使用特殊格式的文本样式中生成 HTML。就像在 Wiki 中一样，标题等有一些特殊的语法。我曾尝试在 google 上查看，但没有找到任何适用于 .NET 的内容。

有人知道可以将文本解析为 HTML wiki 样式的 .NET 库吗？我不必与 Wiki 的语法相同吗？如果不是，你自己设计这样一个系统的最佳方式是什么？

提前致谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-02T17:37:54.550

StackOverflow 使用的 Markdown 怎么样？

[http://daringfireball.net/projects/markdown/](http://daringfireball.net/projects/markdown/)

从他们的主页：

> 因此，“Markdown”是两件事：（1）纯文本格式语法；(2) 一个软件工具，用 Perl 编写，将纯文本格式转换为 HTML。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T18:17:41.663

对于服务器端，您可以使用 Milan Negovan 的 Markdown.Net 库：[http ://www.aspnetresources.com/blog/markdown_announced.aspx](http://www.aspnetresources.com/blog/markdown_announced.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T18:11:53.410

Markdown 很棒——语法非常直观，而且你有WMD——我现在正在输入的[这个了不起的编辑工具。](http://wmd-editor.com/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-13T11:19:44.413

我*强烈*推荐 Textile 而不是 Markdown。 [Textile.NET](http://www.codeplex.com/textilenet)应该做你想做的。

为什么？我更喜欢 Textile 的语法，我认为它更容易让用户学习和使用。没有单一的大原因——只有很多小事。

在 Markdown 中，您可以轻松地做到这一点*`*italics*`*，**`**bold**`**但语法似乎是任意的。与 Textile for *`_italics_`*and中的等效语法**`*bold*`**相比，它反映了以纯文本格式指示这些修饰符的传统方式。

或者再举一个例子，在 Textile 中，您通过在每个项目前加上一个“#”来创建一个有序列表。在 Markdown 中，您可以在它前面加上“n.”，其中 n 是任何整数。Markdown 试图模仿人们在编写列表时在平面文本文件中使用的语法（这很好），但这意味着这个 Markdown 代码：

```
3\.  Test1
2\.  Test2
1\.  Test3 
```

呈现为：

> 1.  测试1
> 2.  测试2
> 3.  测试3

基本上，Markdown 会要求您输入一个数字，然后它会忽略该数字。这对我来说似乎很不雅，尽管我无法准确解释原因。

Textile 也有表格（并且希望语法非常紧凑）。降价没有。还有一些其他的小问题，但我认为这涵盖了大部分内容。:)

# javascript - Javascript Date() 构造函数不起作用

> ID：163563
> 
> 赞同：28
> 
> 时间：2008-10-02T17:29:53.183
> 
> 标签：javascript

我有一个问题-

javascript`Date("mm-dd-yyyy")`构造函数不适用于 FF。它适用于 IE。

*   即：`new Date("04-02-2008")`=>`"Wed Apr 2 00:00:00 EDT 2008"`
*   FF2：`new Date("04-02-2008")`=>`Invalid Date`

所以让我们尝试另一个构造函数。尝试这个构造函数`Date("yyyy", "mm", "dd")`

*   即：`new Date("2008", "04", "02");`=>`"Fri May 2 00:00:00 EDT 2008"`
*   法：`new Date("2008", "04", "02");`=>`"Fri May 2 00:00:00 EDT 2008"`
*   即：`new Date("2008", "03", "02");`=>`"Wed Apr 2 00:00:00 EDT 2008"`
*   法：`new Date("2008", "03", "02");`=>`"Wed Apr 2 00:00:00 EDT 2008"`

所以`Date("yyyy", "mm", "dd")`构造函数使用一个索引`0`来表示一月。

有没有人处理过这个？
一定有比从月份中减去 1 更好的方法。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-02T17:34:11.860

对字段使用值 0-11[是 Date 对象](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date)的定义。`month`

我相信使用 String 的构造函数依赖于系统（更不用说依赖于语言环境/时区），因此您最好使用将年/月/日指定为单独参数的构造函数。

顺便说一句，在 Firefox 中，

```
new Date("04/02/2008"); 
```

对我来说很好 - 它会解释斜杠，但不会解释连字符。我认为这证明了我的观点，即使用 String 构造 Date 对象是有问题的。改为使用月/日/年的显式值：

```
new Date(2008, 3, 2); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-13T14:51:16.563

确实不错的把戏，我刚刚发现了一个艰难的方法（通过思考）。但是我使用了一个更自然的带有连字符的日期字符串:-)

```
var myDateArray = "2008-03-02".split("-");
var theDate = new Date(myDateArray[0],myDateArray[1]-1,myDateArray[2]); 
alert(theDate); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-05T11:06:06.850

使用

```
var theDate = new Date(myDate[0],myDate[1]-1,myDate[2]); 
```

很好，但是当月份和日期值错误时，它会显示一些奇怪的行为。

尝试投射一个日期，其中两者`myDate[1]-1`的`myDate[2]`值都为 55。Javascript 仍然返回一个日期，尽管输入显然不正确。

在这种情况下，我更希望 javascript 返回错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-07-17T13:50:57.820

@弗兰克：你是对的。当您需要验证日期时，

```
var theDate = new Date(myDate[0],myDate[1]-1,myDate[2]); 
```

不管用。

发生的情况是它继续添加额外的参数。例如：

```
new Date("2012", "11", "57") // Date {Sat Jan 26 2013 00:00:00 GMT+0530 (IST)} 
```

日期对象需要额外的天数 (57-31=26) 并将其添加到我们创建的日期。

或者，如果我们尝试使用以下方法构造一个日期对象：

```
new Date("2012", "11", "57", "57") //Date {Mon Jan 28 2013 09:00:00 GMT+0530 (IST)} 
```

额外增加 2 天 9 小时 (57=24+24+9)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T22:06:16.480

你说的很对，月份被表示为一个索引，所以一月是第 0 个月，十二月是第 11 个月......

- 并且没有解决方法，因为它在 ECMA-script-definition 中明确说明，尽管简单的技巧通常会起作用：

```
var myDate = "2008,03,02".split(",");
var theDate = new Date(myDate[0],myDate[1]-1,myDate[2]); 
alert(theDate); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T17:37:48.500

大胆的声明。

这可能会引起您的兴趣：[JavaScript Pretty Date](http://ejohn.org/blog/javascript-pretty-date/)。

# apache-flex - 是否可以停止 ColdFusion 请求？

> ID：163569
> 
> 赞同：4
> 
> 时间：2008-10-02T17:31:15.207
> 
> 标签：apache-flex, coldfusion

我有一个 Flex 应用程序，它调用一个搜索大型文档集合的函数。根据搜索词，用户可能希望停止来自 flex 的请求。

我不仅要阻止 flex 应用程序期待请求，还要停止 CFC 请求。这可能吗？这样做的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T19:08:26.080

我认为没有**直接**的方法可以从外部停止页面调用。根据文档，只有线程本身及其父线程可以中止给定线程。

但是，您可以在共享范围内为给定线程设置标志。

假设您调用了一个开始一些后台处理的方法。它生成一个唯一的线程 ID 并将其返回给调用者。线程在（例如）应用程序范围内寻找一个告诉它停止的标志。它检查后台进程的每个子步骤。它可以在抛出标志的任何时候中止。

要抛出标志，请添加一个 abort 方法，该方法采用要中止的线程的名称，以及足够的安全性以确保第 3 方不能只是开始杀死线程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T20:05:24.663

为了添加到 Ben Doom 的答案，我将包含一些示例代码，以说明可以实现的方式。有多种命名方法和方式，组织和调用下面的代码，但希望它会有所帮助。

在请求启动期间的某个时刻，将有关进程的信息存储在共享范围内，并将 ID 返回给客户端。以下是可用于页面或远程请求的示例函数。

```
<cffunction name="createProcess" output="false">
  <cfset var id = createUUID()>
  <cfset application.processInfo[id] = {
    progress = 0,
    kill = false
  }>
  <cfreturn id />
</cffunction> 
```

然后客户端可以通过轮询服务器来检查进度，或者提交请求以终止进程

```
<cffunction name="getProcessProgress" output="false">
  <cfargument name="processID" required="true">
  <cfreturn application.processInfo[arguments.processID].progress />
</cffunction>

<cffunction name="killProcess" output="false">
  <cfargument name="processID" required="true">
  <cfset application.processInfo[arguments.processID].kill = true />
</cffunction> 
```

然后，实际的服务器端进程可以调用一个函数，例如在循环期间，以检查它是否应该中止处理并酌情清理任何工作。

```
<cffunction name="shouldKillProcess" output="false">
  <cfargument name="processID" required="true">
  <cfreturn application.processInfo[arguments.processID].kill />
</cffunction> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T18:25:48.430

如果您使用的是 ColdFusion 8，则可以使用该`<cfthread>`标签。您可以在其自己的线程上生成搜索进程，然后根据需要使用远程调用终止搜索线程。

*   cfthread的 Livedoc[页面](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_t_04.html)
*   [在 ColdFusion 中使用线程](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=threads_1.html#1120458)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T18:17:43.380

您可以使用`<cfabort/>`or以编程方式结束请求`<cfsetting requesttimeout="0"/>`- 但这是在 CF 服务器端，我认为这不是您要问的？

远程结束它...好吧，如果您有 FusionReactor，则*可以*使用 Flex 联系它并让它中断您的请求。（你当然可以尝试在 FusionReactor 中结束请求，但 Flex 是否真的可以要求 FR 停止它......如果有办法做到这一点，你必须在 FR 邮件列表中询问。）

可能的替代解决方案是尝试构建搜索，以便它可以处理多个请求，但这是否可行将取决于您正在搜索的内容。

# asp.net - Asp.net 格式化分组数据列表

> ID：163581
> 
> 赞同：1
> 
> 时间：2008-10-02T17:33:33.877
> 
> 标签：asp.net, layout

我有一个 asp.net 页面，我在其中查询 url 列表和 url 中的组。在后面的代码中，我遍历每个组并创建一个组标题，然后列出所有链接。

像这样的东西：

**第 1 组**

*   链接 1*   链接 2*   链接 3

    **第 2 组**

    *   链接 1*   链接 2*   链接 3

    现在我有很多链接，这会在页面上创建一个长列表，您必须向下滚动。

    使用多列或其他布局选项格式化此数据的最佳建议是什么，以便在单个页面上而不是在一个长列表上看起来更好。

    任何示例代码都会很棒。. .

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T18:18:35.733

对于 ASP.NET 3.5，您可以使用[ListView](http://msdn.microsoft.com/en-us/library/bb398790.aspx)控件。可以在[这里](http://aspnet.4guysfromrolla.com/articles/010208-1.aspx)找到一个很好的分组教程。如果您使用的是 ASP.NET 1.x 或 2.0，您可以尝试使用[DataList](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.aspx)控件（检查[RepeatColumns](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.repeatcolumns.aspx)和[RepeatDirection](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.repeatcolumns.aspx)属性）。ListView 更强大。

# javascript - 如何在不更改文件时间戳的情况下将缩小的 Javascript 文件部署到 Web 服务器？

> ID：163583
> 
> 赞同：0
> 
> 时间：2008-10-02T17:34:01.067
> 
> 标签：javascript, automation, minify

我们的应用程序中有数百个 JavaScript 文件，这些文件目前正在未压缩的状态下提供。我们获得更多客户端性能的解决方案之一是缩小我们的 javascript 文件。我已经创建了一个自动化解决方案来在构建中执行此操作，但是，当部署这些新文件时，确定是否将其重新发送给客户端的文件时间戳将被更改。这意味着，在以后的每个版本中，所有的 javascript 文件都会有一个新的时间戳。我们的客户将再次重新下载所有缩小的 javascript 文件，从而破坏缩小的性能方面。

这是其他人遇到的问题吗？你的解决方案是什么？您是否在项目中使用了单独的非缩小和缩小 javascript 文件，并且不对构建执行缩小？

我们考虑了其他解决方案（例如仅在源代码控制存储库中查找实际更改的文件），但这是我想了解其他人在做什么的一个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T17:41:35.150

您将必须确定哪些文件实际已更改。或者只是不用担心，享受通过缩小文件获得的改进。无论如何，客户端可能不会将文件保存在缓存中很长时间，因此除非您非常非常频繁地更新文件，否则尝试管理缓存行为可能收效甚微。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T18:04:16.330

您可以编写一个脚本来检查源文件夹和目标文件夹中每个文件的 CRC 或 MD5 哈希，并且仅在文件已更改时才执行覆盖。这将保留未更改文件的时间戳，从而为您提供所需的缓存行为。

同样，您可以记录前一个时间戳，进行覆盖，然后使用 touch 命令（假设这些文件位于 unix 系统上）将时间戳设置回其原始值。

第一个选项可能更好，而不是一直盲目地将时间戳设置为相同的值，因为这可能意味着某些客户端暂时不会拾取修改后的 JS 文件，因为服务器声称它没有更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:45:18.027

您可以在一段时间内推出这些脚本文件，这样单个用户请求就不会花费过多的时间。但说真的，我们在谈论多少 javascript？一次性重新下载与您的页面相关的脚本真的有那么大吗？想想你要付出多少努力才能完成这件事，并权衡它的好处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T10:57:01.910

阅读由 Flickr 成名的 Cal Henderson 撰写的[http://www.thinkvitamin.com/features/webapps/serving-javascript-fast 。](http://www.thinkvitamin.com/features/webapps/serving-javascript-fast)希望你会发现它很有用。

# bash - Emacs shell 模式中的 Bash 自动完成

> ID：163591
> 
> 赞同：98
> 
> 时间：2008-10-02T17:37:02.493
> 
> 标签：bash, shell, emacs, autocomplete

在 GNOME 终端中，Bash 进行智能自动完成。例如

```
apt-get in<TAB> 
```

变成

```
apt-get install 
```

在 Emacs shell 模式中，即使在我明确地 source 之后，这种自动完成功能也不起作用`/etc/bash_completion`。上面的示例坚持`in`或自动完成当前目录中的文件名，而不是有效的`apt-get`命令选项。据推测，这是因为 Emacs 正在拦截 Tab 按键。如何在 中启用智能自动完成`shell-mode`？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2011-11-16T13:52:48.953

我知道这个问题已经存在三年了，但我也一直有兴趣解决这个问题。网络搜索将我引向了一段 elisp，它使 Emacs 使用 bash 在 shell 模式下完成。无论如何，它对我有用。

[在https://github.com/szermatt/emacs-bash-completion](https://github.com/szermatt/emacs-bash-completion)查看。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-21T06:24:00.700

在 emacs shell 中，实际上是 emacs 进行自动完成，而不是 bash。如果 shell 和 emacs 不同步（例如，通过使用 pushd、popd 或一些改变 shell 当前目录的 bash 用户函数），那么自动完成将停止工作。

要解决这个问题，只需在 shell 中输入“dirs”，一切就会恢复同步。

我的 .emacs 中还有以下内容：

```
(global-set-key "\M-\r" 'shell-resync-dirs) 
```

然后只需按 Esc-return 即可重新同步自动完成。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-02T18:09:29.513

我不知道这个问题的答案。但它不能按预期工作的原因可能是因为 emacs shell 中的补全是由 emacs 内部处理的（通过 comint-dynamic-complete 函数），并且没有内置那些智能补全函数。

恐怕这不是一件容易解决的事情。

编辑：njsf 关于使用 term-mode 的建议可能和它得到的一样好。开始它

```
Mx 项
```

它包含在标准 emacs 发行版中（至少在 Ubuntu 和 Debian 上包含在 emacs21-common 或 emacs22-common 中）。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-02-19T23:06:28.060

请考虑另一种模式`M-x term`，就像我在 2011 年遇到问题时所做的那样。当时我试图通过 Inet 集中所有的努力来使 shell 与 Bash 完成一起工作，包括这个问题。但自从面对`term-mode`我发现替代方案后，我什至不想尝试`eshell`。

它是完整的终端模拟器，所以你可以在里面运行交互式程序，比如午夜指挥官。或者切换到`zsh`完成，这样您就不会在 Emacs 配置上浪费时间。

您可以免费在 bash 中完成 TAB。但更重要的是，您可以获得完整的 Readline 功能，例如**增量或前缀命令搜索**。为了使这个设置更方便检查我的[.inputrc](http://hg.defun.work/skel/file/default/.inputrc)，[.bashrc](http://hg.defun.work/skel/file/default/.bashrc)，[.emacs](http://hg.defun.work/dot-emacs/file/default/.emacs-my)。

的基本部分`.inputrc`：

```
# I like this!
set editing-mode emacs

# Don't strip characters to 7 bits when reading.
set input-meta on

# Allow iso-latin1 characters to be inserted rather than converted to
# prefix-meta sequences.
set convert-meta off

# Display characters with the eighth bit set directly rather than as
# meta-prefixed characters.
set output-meta on

# Ignore hidden files.
set match-hidden-files off

# Ignore case (on/off).
set completion-ignore-case on

set completion-query-items 100

# First tab suggests ambiguous variants.
set show-all-if-ambiguous on

# Replace common prefix with ...
set completion-prefix-display-length 1

set skip-completed-text off

# If set to 'on', completed directory names have a slash appended. The default is 'on'.
set mark-directories on
set mark-symlinked-directories on

# If set to 'on', a character denoting a file's type is appended to the
# filename when listing possible completions. The default is 'off'.
set visible-stats on

set horizontal-scroll-mode off

$if Bash
"\C-x\C-e": edit-and-execute-command
$endif

# Define my favorite Emacs key bindings.
"\C-@": set-mark
"\C-w": kill-region
"\M-w": copy-region-as-kill

# Ctrl+Left/Right to move by whole words.
"\e[1;5C": forward-word
"\e[1;5D": backward-word
# Same with Shift pressed.
"\e[1;6C": forward-word
"\e[1;6D": backward-word

# Ctrl+Backspace/Delete to delete whole words.
"\e[3;5~": kill-word
"\C-_": backward-kill-word

# UP/DOWN filter history by typed string as prefix.
"\e[A": history-search-backward
"\C-p": history-search-backward
"\eOA": history-search-backward
"\e[B": history-search-forward
"\C-n": history-search-forward
"\eOB": history-search-forward

# Bind 'Shift+TAB' to complete as in Python TAB was need for another purpose.
"\e[Z": complete
# Cycling possible completion forward and backward in place.
"\e[1;3C": menu-complete                    # M-Right
"\e[1;3D": menu-complete-backward           # M-Left
"\e[1;5I": menu-complete                    # C-TAB 
```

`.bashrc`（是的！Bash 中的任何单词都有 dabbrev `~/.bash_history`）：

```
set -o emacs

if [[ $- == *i* ]]; then
  bind '"\e/": dabbrev-expand'
  bind '"\ee": edit-and-execute-command'
fi 
```

`.emacs`使导航在术语缓冲区中舒适：

```
(setq term-buffer-maximum-size (lsh 1 14))

(eval-after-load 'term
  '(progn
    (defun my-term-send-delete-word-forward () (interactive) (term-send-raw-string "\ed"))
    (defun my-term-send-delete-word-backward () (interactive) (term-send-raw-string "\e\C-h"))
    (define-key term-raw-map [C-delete] 'my-term-send-delete-word-forward)
    (define-key term-raw-map [C-backspace] 'my-term-send-delete-word-backward)
    (defun my-term-send-forward-word () (interactive) (term-send-raw-string "\ef"))
    (defun my-term-send-backward-word () (interactive) (term-send-raw-string "\eb"))
    (define-key term-raw-map [C-left] 'my-term-send-backward-word)
    (define-key term-raw-map [C-right] 'my-term-send-forward-word)
    (defun my-term-send-m-right () (interactive) (term-send-raw-string "\e[1;3C"))
    (defun my-term-send-m-left () (interactive) (term-send-raw-string "\e[1;3D"))
    (define-key term-raw-map [M-right] 'my-term-send-m-right)
    (define-key term-raw-map [M-left] 'my-term-send-m-left)
    ))

(defun my-term-mode-hook ()
  (goto-address-mode 1))
(add-hook 'term-mode-hook #'my-term-mode-hook) 
```

由于任何`C-x o`在终端仿真模式下不起作用的常用命令，我扩展了键盘映射：

```
(unless
    (ignore-errors
      (require 'ido)
      (ido-mode 1)
      (global-set-key [?\s-d] #'ido-dired)
      (global-set-key [?\s-f] #'ido-find-file)
      t)
  (global-set-key [?\s-d] #'dired)
  (global-set-key [?\s-f] #'find-file))

(defun my--kill-this-buffer-maybe-switch-to-next ()
  "Kill current buffer. Switch to next buffer if previous command
was switching to next buffer or this command itself allowing
sequential closing of uninteresting buffers."
  (interactive)
  (let ( (cmd last-command) )
    (kill-buffer (current-buffer))
    (when (memq cmd (list 'next-buffer this-command))
      (next-buffer))))
(global-set-key [s-delete] 'my--kill-this-buffer-maybe-switch-to-next)
(defun my--backward-other-window ()
  (interactive)
  (other-window -1))
(global-set-key [s-up] #'my--backward-other-window)
(global-set-key [s-down] #'other-window)
(global-set-key [s-tab] 'other-window) 
```

请注意，我使用`super`key，因此`term-raw-map`可能任何其他键映射都不会与我的键绑定冲突。`super`要从左键制作钥匙，`Win`我使用`.xmodmaprc`：

```
! To load this config run:
!   $ xmodmap .xmodmaprc

! Win key.
clear mod3
clear mod4

keycode 133 = Super_L
keycode 134 = Hyper_R
add mod3 = Super_L
add mod4 = Hyper_R 
```

您只需要记住 2 个命令：`C-c C-j`- 进入正常的 Emacs 编辑模式（用于在缓冲区文本中复制或 grepping），`C-c C-k`- 返回终端仿真模式。

鼠标选择和`Shift-Insert`工作在`xterm`.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-03T02:55:07.053

就像 Matli 说的那样，这不是一件容易的事，因为 bash 以 --noediting 开头，而 TAB 绑定到 comint-dynamic-complete。

可以使用 local-set-key 将 TAB 重新绑定到 shell-comand-hook 中的 self-insert-command，并使 shell-mode 不以 Mx customize-variable RET explicit-bash-args 的 --noediting 开头，但我怀疑它不适用于所有其他编辑。

您可能想尝试 term-mode，但它还有另一组问题，因为一些其他常规键绑定已被 term-mode 取代。

编辑：通过术语模式取代其他常规键标，我的意思是除了 Cc 之外的所有键，它成为能够切换缓冲区的转义。因此，您必须 Cc Cx k 代替 Cx k 来杀死缓冲区。或者切换到另一个缓冲区 'Cc Cx o' 或 'Cc Cx 2'

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-01-16T06:59:54.900

我知道这篇文章现在已经超过 11 年了。但是我创建了一个函数来在 Emacs 中完成本机 shell。它只是向底层进程发送一个制表键并拦截输出，因此它与您在 shell 本身中得到的完全相同。

[https://github.com/CeleritasCelery/emacs-native-shell-complete](https://github.com/CeleritasCelery/emacs-native-shell-complete)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-04-16T02:45:21.393

我使用 Prelude，当我点击 Meta+Tab 时，它就为我完成了。

此外， Ctrl+i 似乎做同样的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-02-08T09:04:39.077

我使用掌舵模式。它具有此功能（按“TAB”后）： [![在此处输入图像描述](https://i.stack.imgur.com/OeILH.png)](https://i.stack.imgur.com/OeILH.png)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-10-02T19:16:17.980

我没有声称自己是 emacs 专家，但这应该可以解决您的问题：

创建：~/.emacs

添加到它：

(需要'shell-command) (shell-command-completion-mode)

Emacs 接管了外壳，因此 BASH 设置不会执行。这将为 EMACS 本身设置自动完成。

# python - Apache套接字没有关闭？

> ID：163603
> 
> 赞同：6
> 
> 时间：2008-10-02T17:40:38.303
> 
> 标签：python, apache, urllib2, cherrypy, mod-proxy

我有一个使用 CherryPy 编写的 Web 应用程序，它在`127.0.0.1:4321`. 我们使用 mod-rewrite 和 mod-proxy 让 Apache 充当反向代理；Apache 还处理我们的 SSL 加密，最终可能用于传输我们所有的静态内容。

这一切都适用于小型工作负载。但是，我最近曾经`urllib2`编写过一个压力测试脚本，可以模拟 100 个客户端的工作负载。一段时间后，每个客户端都收到来自 Apache 的 503 错误，表明 Apache 无法连接到`127.0.0.1:4321`. CherryPy 运行正常，但我的 Apache 错误日志显示如下行：

`[Thu Oct 02 12:55:44 2008] [error] (OS 10048)Only one usage of each socket address (protocol/network address/port) is normally permitted. : proxy: HTTP: attempt to connect to 127.0.0.1:4321 (*) failed`

谷歌搜索此错误表明 Apache 可能已用完套接字文件描述符。由于我只有 100 个客户端在运行，这意味着连接没有关闭，无论是在我的`urllib2`连接和 Apache 之间（我肯定是调用`.close()`的返回值`urlopen`），还是在 Apache 和 CherryPy 之间。

我已经确认我的`urllib2`请求正在发送一个 HTTP标头，尽管如果这很重要`Connection: close`，Apache 已经配置了。`KeepAlive On`

万一这很重要，我使用的是 Python 2.5、Apache 2.2、CherryPy 3.0.3，并且服务器在 Windows Server 2003 上运行。

那么我下一步要做什么来阻止这个问题呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T21:52:03.957

`SetEnv proxy-nokeepalive 1`如果问题是 Apache 和 CP 之间的 keepalive，可能会立即告诉您。有关更多信息，请参阅[mod_proxy 文档](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#envsettings)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T20:02:22.410

您可以运行 netstat 命令并查看是否有一堆处于 TIME_WAIT 状态的套接字。根据您的 MaxUserPort 设置，您可以使用的端口数量可能会受到严重限制。此外，TcpTimedWaitDelay 通常设置为 240 秒，因此任何使用的套接字在四分钟内都不能重复使用。

这里有更多好的信息 --> [http://smallvoid.com/article/winnt-tcpip-max-limit.html](http://smallvoid.com/article/winnt-tcpip-max-limit.html)

# sql - 在 MS SQL Server 2005 中使用 RAND() 时我做错了什么？

> ID：163604
> 
> 赞同：3
> 
> 时间：2008-10-02T17:41:09.660
> 
> 标签：sql, sql-server, random

我正在尝试从一张小桌子中随机选择 10% 的样本。我以为我会使用 RAND() 函数并选择随机数小于 0.10 的那些行：

```
SELECT * FROM SomeTable
WHERE SomeColumn='SomeCondition' AND
      RAND() < 0.10 
```

但我很快发现 RAND() 总是返回相同的数字！让我想起了这部[xkcd 卡通](http://xkcd.com/221/)。

![](https://imgs.xkcd.com/comics/random_number.png)

OK，没问题，RAND函数取一个种子值。我将定期运行此查询，如果我在不同的日子运行它，我希望它给出不同的结果，所以我使用日期和唯一行 ID 的组合来播种：

```
SELECT * FROM SomeTable
WHERE SomeColumn='SomeCondition' AND
      RAND(CAST(GETDATE) AS INTEGER) + RowID) < 0.10 
```

我仍然没有任何结果！当我展示 RAND 返回的随机数时，我发现它们都在一个狭窄的范围内。从 RAND 获取随机数似乎需要您使用随机种子。如果我一开始就有随机种子，我就不需要随机数了！

我已经看到了与此问题相关的先前讨论：

[SQL Server 随机排序](https://stackoverflow.com/questions/52964/sql-server-random-sort)
[如何在 SQL 中请求随机行？](https://stackoverflow.com/questions/19412/how-to-request-a-random-row-in-sql)

他们不帮助我。TABLESAMPLE 在页面级别工作，这对于大表来说非常有用，但对于小表则不适用，而且看起来它适用于 WHERE 子句之前。带有 NEWID 的 TOP 不起作用，因为我不提前知道我想要多少行。

有人有解决方案，或者至少有提示吗？

**编辑：**感谢 AlexCuse 提供适用于我的特殊情况的[解决方案。](https://stackoverflow.com/questions/163604/what-am-i-doing-wrong-when-using-rand-in-ms-sql-server-2005#163843)现在到更大的问题，如何让兰德表现？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T18:28:51.807

这种类型的方法（由 ΤZΩΤZΙΟΥ 显示）不能保证 10% 的采样。它只会为您提供所有 Rand() 被评估为 < .10 的行，这将是不一致的。

就像是

```
select top 10 percent * from MyTable order by NEWID() 
```

会成功的。

**编辑：**没有真正让兰德表现的好方法。这是我过去使用的（kludge alert - 它会杀死你无法在 UDF 中使用 Rand()）

```
CREATE VIEW RandView AS 

SELECT RAND() AS Val

GO

CREATE FUNCTION RandomFloat()
RETURNS FLOAT
AS
BEGIN

RETURN (SELECT Val FROM RandView)

END 
```

然后你就`select blah, dbo.RandomFloat() from table`在你的查询中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T17:43:18.080

如果您的表有一列（甚至可能是**rowid**列）是一般意义上的数字，如整数、浮点或 SQL 数字，请尝试以下操作：

```
SELECT * FROM SomeTable WHERE SomeColumn='SomeCondition' AND 0*rowid+RAND() < 0.10 
```

为了对*每一行*`RAND()`计算一次，而不是在*查询开始时*计算一次。

 **查询优化器是罪魁祸首。也许还有另一种方法，但我相信这对你有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T19:45:21.797

这似乎有效：

```
select * from SomeTable
where rand(0*SomeTableID + cast(cast(newid() as binary(4)) as int)) <= 0.10 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T19:43:30.677

你看到这个问题了吗？

[如何在 SQL Server 2005 中将随机数作为列返回？](https://stackoverflow.com/questions/94906/how-do-i-return-random-numbers-as-a-column-in-sql-server-2005)

Adam 发布了一个 UDF，您可以使用它来代替 Rand() 效果更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-26T15:00:55.300

这似乎有效

```
SELECT TOP 10 PERCENT * FROM schema.MyTable ORDER BY NEWID() 
```

# javascript - AJAX 和浏览器后退按钮

> ID：163610
> 
> 赞同：34
> 
> 时间：2008-10-02T17:42:40.810
> 
> 标签：javascript, html, ajax, navigation

我在 www.darknovagames.com 运行基于浏览器的游戏。最近，我一直在努力用 CSS 重新格式化网站，试图让它的所有页面都根据 HTML 标准进行验证。

我一直在玩弄这个想法，即在左侧 AJAX 页面中使用导航菜单（而不是每次将用户带到单独的页面，需要重新加载标题和导航栏，这几乎永远不会改变）我知道如果我这样做，我可能会破坏浏览器中的前进/后退按钮。我想我的问题是，我应该继续对网站进行 AJAX 处理，从而要求用户使用网站导航来玩游戏，还是应该让网站保持现状，并使用标准超链接和其他东西进行导航？

我问的原因是我在网站中建立了一个论坛系统，很多时候我想链接到论坛中的特定主题。

我也愿意接受建议。是否有一种标准（最好没有传统框架）方式来仅重新加载站点的主体区域，同时仍更改 URL 以便用户可以添加书签和前进/后退等？这也可能解决我的问题。我只是在这里寻求最佳解决方案，而不是特定问题的答案。^_^

谢谢

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-02T17:48:10.893

将 ajax 用于需要更新的页面部分，而不是整个页面。为此，您应该使用模板。

如果您仍想为页面上的各种状态更改保留后退按钮，请将它们与 #achors 结合以更改 url（不强制浏览器发出另一个 GET）。

例如，gmail 看起来像这样：

mail.google.com/#inbox/message-1234

# 之后的所有内容都是通过 ajax 发生的页面状态更改。如果我按返回，我将再次进入收件箱（同样，没有其他浏览器 GET）

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-02T18:01:41.467

如果您要启用 AJAX，请不要以您网站上每个重要页面的可访问 URL 为代价。这是人们可以使用的可导航站点的支柱。

当您将所有功能都放入 AJAX 调用和回调中时，您基本上是在强迫您的用户使用单一路径来访问他们想要的功能和内容——这完全违背了 Web 的功能。人们依赖地址栏和返回按钮。如果您覆盖所有链接，从而使您的站点本质上是一个仅通过 AJAX 更新的页面，那么您将限制用户浏览您的站点并找到他们需要的内容的能力。它还阻止您的用户分享他们发现的内容（这是重点的一部分，对吗？）。

想想用户对您网站的心理地图。如果他们知道他们是通过主页进入的，那么他们就会去搜索一些东西，然后他们会登陆一个游戏页面，然后他们开始玩一个特定的游戏，这是用户采取的四个不同的动作单元。他们可能在这些页面中的每一个上都做了一些其他更小、更无关紧要的操作——但这​​些是主要单元。当他们单击“返回”按钮时，他们应该期望通过他们进入的路径返回。如果您通过 AJAX 调用加载所有这些页面，那么您提供的站点的功能与用户的期望相反。

将您的网站分解为每个重要功能（即搜索、主页、个人资料、游戏——这将取决于您的网站的全部内容）。在您链接到这些页面的任何地方，都可以通过常规链接和静态 URL 进行链接。

AJAX 很好。但它的艺术在于知道何时使用它，何时不使用它。如果你坚持我上面勾勒的模型，你的用户会很感激的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-02T18:09:08.657

查看[真正简单](http://code.google.com/p/reallysimplehistory/)的历史。wiki 已经有 10 个月没有更新了，但我只是在 Ajax Experience 2008 上看到了Brian Dillard 的[演讲](http://ajaxexperience.techtarget.com/assets/documents/Brian_Dillard_Making_Friends_with_Browser.pdf)。他说 0.8 代码在他的硬盘上。希望它很快可以下载。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-01-13T13:42:45.227

另一种解决方案：

[AJAX 分页和返回按钮](http://www.aplusdesign.com.au/blog/ajax-pagination-back-button/)

这似乎是最好的，与 JQuery 和 Mootools 一起使用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T17:50:07.017

有很多方法可以使用时髦的 Javascript 技术解决这个问题，通常涉及 iframe，但我认为在这种情况下，您需要质疑为什么要使用 AJAX。它真的会让网站更容易为用户使用吗？在我看来，您使用它是因为您认为它很酷（这本身并不总是一件坏事），而不是因为它实际上会为您的访问者增加任何价值。在任何普通网站上，普通的超链接文档几乎总是适合主导航。它是人们所期望的，我不建议您根据一些花哨的技术四处打破这些期望。

AJAX 很棒，可以让你做很多很棒的事情，改变网站导航不是其中之一。

虽然很好地解决了这个问题，但那里有很多网站只是继续使用 AJAX，甚至不考虑这个！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-19T18:02:30.440

试试这个简单轻量[的 PathJS](https://github.com/mtrpcic/pathjs)库。它允许将侦听器直接绑定到锚点。

例子：

```
Path.map("#/page").to(function(){
    alert('page!');
}); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T17:51:01.680

正是由于您描述的原因，AJAX 并不是导航的最佳解决方案。与破坏浏览器导航 UI 的麻烦相比，重新加载标题和导航栏的影响很小。

AJAX 的一个更合适的示例是允许用户在主窗口中玩游戏，同时他们可以在导航窗格中浏览其他内容的列表。您可以通过 AJAX 在导航窗格中加载其他项目，而不会影响游戏。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T17:54:05.433

我会坚持使用简单的超链接。您的页面家具不应占 HTML 的很大一部分，因此将其排除在页面请求之外并不是什么大胜利。使每个资源都可寻址（即用户可能感兴趣的每一位内容的 URL）是 Web 的一个关键设计特征。这意味着缓存可以工作，并且意味着用户可以共享书签。它使 Google 以及社交书签网站都能正常工作。

在我看来，从后续页面更改中删除几个 HTML 字节是不值得的。

# c# - 更改继承的 .net 控件上的属性的 DefaultValue

> ID：163611
> 
> 赞同：11
> 
> 时间：2008-10-02T17:42:54.663
> 
> 标签：c#, .net, controls, properties, default

在 .net 中，我有一个继承的控件：

```
public CustomComboBox : ComboBox 
```

除了基类中指定的默认值（ComboBoxStyle.DropDown）之外，我只想将 DropDownStyle 属性的默认值更改为另一个值（ComboBoxStyle.DropDownList）。

有人可能会认为您可以只添加构造函数：

```
public CustomComboBox()
{
     this.DropDownStyle = ComboBoxStyle.DropDownList;
} 
```

但是，这种方法会混淆 Visual Studio 设计器。在 Visual Studio 中设计自定义控件时，如果您为 DropDownStyle 选择 ComboBoxStyle.DropDown 它认为您选择的属性仍然是默认值（来自基 ComboBox 类中的 [DevaultValue()]），所以它不会将 customComboBox.DropDownStyle = ComboBoxStyle.DropDown 行添加到 Designer.cs 文件。令人困惑的是，您发现屏幕在运行后并没有按预期运行。

那么你不能覆盖 DropDownStyle 属性，因为它不是虚拟的，但你可以这样做：

```
[DefaultValue(typeof(ComboBoxStyle), "DropDownList")]
public new ComboBoxStyle DropDownStyle
{
      set { base.DropDownStyle = value; }
      get { return base.DropDownStyle; }
} 
```

但是你会因为使用“新”声明的细微差别而遇到麻烦。我已经尝试过了，它似乎无法正常工作，因为视觉工作室设计师也对这种方法感到困惑并强制 ComboBoxStyle.DropDown （基类的默认值）。

有没有其他方法可以做到这一点？抱歉这个冗长的问题，很难详细描述。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-02T18:01:22.937

这看起来很有效：

```
public class CustomComboBox : ComboBox
{
    public CustomComboBox()
    {
        base.DropDownStyle = ComboBoxStyle.DropDownList;
    }

    [DefaultValue(ComboBoxStyle.DropDownList)]
    public new ComboBoxStyle DropDownStyle
    {
        set { base.DropDownStyle = value; Invalidate(); }
        get { return base.DropDownStyle;}
    }
} 
```

# email - 使电子邮件地址免受网页上的机器人攻击？

> ID：163628
> 
> 赞同：47
> 
> 时间：2008-10-02T17:45:04.037
> 
> 标签：email, obfuscation

在网页上放置电子邮件地址时，您是否将它们放置为如下文本：

```
joe.somebody@company.com 
```

或者使用一个聪明的技巧来欺骗电子邮件地址收集机器人？例如：

**HTML转义字符：**

```
&#106;&#111;&#101;&#46;&#115;&#111;&#109;&#101;&#98;&#111;&#100;&#121;&#64;&#99;&#111;&#109;&#112;&#97;&#110;&#121;&#46;&#99;&#111;&#109; 
```

**Javascript解密器：**

```
function XOR_Crypt(EmailAddress)
{
    Result = new String();
    for (var i = 0; i < EmailAddress.length; i++)
    {
        Result += String.fromCharCode(EmailAddress.charCodeAt(i) ^ 128);
    }
    document.write(Result);
}

XOR_Crypt("êïå®óïíåâïäùÀãïíðáîù®ãïí"); 
```

**人工解码：**

```
joe.somebodyNOSPAM@company.com

joe.somebody AT company.com 
```

你用什么，甚至打扰？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2017-01-10T10:26:28.043

在 CSS 中处理内容和属性：

```
.cryptedmail:after {
  content: attr(data-name) "@" attr(data-domain) "." attr(data-tld); 
}
```

```
<a href="#" class="cryptedmail"
   data-name="info"
   data-domain="example"
   data-tld="org"
   onclick="window.location.href = 'mailto:' + this.dataset.name + '@' + this.dataset.domain + '.' + this.dataset.tld; return false;"></a>
```

禁用 javascript 时，仅单击事件将不起作用，仍显示电子邮件。

另一种有趣的方法（至少没有点击事件）是利用从右到左的标记来覆盖书写方向。有关此的更多信息：[https ://en.wikipedia.org/wiki/Right-to-left_mark](https://en.wikipedia.org/wiki/Right-to-left_mark)

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2012-04-24T15:08:48.593

这是我使用的方法，带有服务器端包含，例如`<!--#include file="emailObfuscator.include" -->`其中`emailObfuscator.include`包含以下内容：

```
<!-- // http://lists.evolt.org/archive/Week-of-Mon-20040202/154813.html -->
<script type="text/javascript">
    function gen_mail_to_link(lhs,rhs,subject) {
        document.write("<a href=\"mailto");
        document.write(":" + lhs + "@");
        document.write(rhs + "?subject=" + subject + "\">" + lhs + "@" + rhs + "<\/a>");
    }
</script> 
```

为了包含地址，我使用 JavaScript：

```
<script type="text/javascript"> 
    gen_mail_to_link('john.doe','example.com','Feedback about your site...');
</script>
<noscript>
  <em>Email address protected by JavaScript. Activate JavaScript to see the email.</em>
</noscript> 
```

因为自 2005 年以来我一直通过 Gmail 收到电子邮件，所以垃圾邮件几乎不是问题。所以，我不能说这种方法有多有效。您可能想阅读生成此图表的[这项研究](https://web.archive.org/web/20160304042853/http://techblog.tilllate.com/2008/07/20/ten-methods-to-obfuscate-e-mail-addresses-compared/)（尽管它很旧）：

![在此处输入图像描述](https://i.stack.imgur.com/To13I.png)

* * *

## 回答 #3

> 赞同：90
> 
> 时间：2009-01-27T12:34:01.597

看看[这种方式](https://matt.berther.io/2009/01/15/hiding-an-email-address-from-spam-harvesters/)，非常聪明并且使用 css。

**CSS**

```
span.reverse {
  unicode-bidi: bidi-override;
  direction: rtl;
} 
```

**HTML**

```
<span class="reverse">moc.rehtrebttam@retsambew</span> 
```

然后，上面的 CSS 将覆盖阅读方向并以正确的顺序将文本呈现给用户。

希望能帮助到你

干杯

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2014-10-17T08:02:33.460

最初不是我的想法，但我找不到作者：

```
<a href="mailto:coxntact@domainx.com"
    onmouseover="this.href=this.href.replace(/x/g,'');">link</a> 
```

添加任意数量的 x。它可以完美地读取、复制和粘贴，并且不能被机器人读取。

* * *

## 回答 #5

> 赞同：46
> 
> 时间：2008-10-02T17:47:15.417

我一般不打扰。我曾经在一个每天收到数千封垃圾邮件的邮件列表上。我们的垃圾邮件过滤器（spamassassin）每天可能会通过 1 或 2 封邮件。有了这么好的过滤器，为什么让合法的人很难联系到你呢？

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2008-10-02T18:04:09.077

发明您自己的疯狂电子邮件地址混淆方案。不管它是什么，真的，只要它与任何众所周知的方法都不太相似。

问题是这个问题确实没有一个好的解决方案，它们要么相对容易绕过，要么对用户来说很烦人。如果任何一种方法变得流行，那么有人*会*找到解决方法。

因此，与其寻找 One True 电子邮件地址混淆技术，不如想出自己的。依靠这样一个事实，即这些机器人作者对您的网站不够关心，以至于坐下来编写一个东西来绕过您稍微疯狂的渲染文本和 CSS 和元素边框或您完全奇怪的、容易破解的 javascript 加密. 不管它是否微不足道，没有人会费心试图绕过它，以便他们可以向您发送垃圾邮件。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2008-10-02T17:52:14.173

您可以使用 reCAPTCHA 保护您的电子邮件地址，他们提供免费服务，因此人们必须输入 CAPTCHA（完全自动化的公共图灵测试以区分计算机和人类）才能看到您的电子邮件：[https ://www.google.com/recaptcha /管理员#邮件隐藏](https://www.google.com/recaptcha/admin#mailhide)

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-11-17T21:18:43.517

我编写了一个[编码器](http://hcard.geekhood.net/encode/?addr=test%40example.com)（[source](https://github.com/pornel/hCardValidator/blob/master/encode/index.php)），它使用了我能想到的各种解析技巧（不同类型的 HTML 实体、URL 编码、注释、多行属性、软连字符、mailto 的非明显结构：URL 等）

它不会阻止所有收割机，但 OTOH 它完全符合标准并且对用户透明。

另一个恕我直言的好方法（除了棘手的编码之外，您还可以使用它）是：

```
<a href="mailto:userhatestogetspam@example.com" 
   onclick="this.href=this.href.replace(/hatestogetspam/,'')"> 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2009-01-27T13:34:47.543

我认为您可以拥有的唯一万无一失的方法是创建一个“联系我”页面，该页面是一个提交给发送到您的电子邮件地址的脚本的表单。这样，您的地址就永远不会向公众公开。由于某种原因，这可能是不可取的，但我认为这是一个很好的解决方案。当我被迫将某人的电子邮件地址从他们的站点复制/粘贴到我的邮件客户端并向他们发送消息时，这常常让我感到厌烦；我宁愿通过他们网站上的表格直接完成。此外，这种方法允许您向您发送匿名评论等。请务必使用某种反机器人方案（例如验证码）保护您的表单。这里有很多关于 SO 的讨论。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2009-01-27T12:40:05.953

如果你有 php 支持，你可以这样做：

```
<img src="scriptname.php"> 
```

和 scriptname.php：

```
<?php
header("Content-type: image/png");
// Your email address which will be shown in the image
$email    =    "you@yourdomain.com";
$length    =    (strlen($email)*8);
$im = @ImageCreate ($length, 20)
     or die ("Kann keinen neuen GD-Bild-Stream erzeugen");
$background_color = ImageColorAllocate ($im, 255, 255, 255); // White: 255,255,255
$text_color = ImageColorAllocate ($im, 55, 103, 122);
imagestring($im, 3,5,2,$email, $text_color);
imagepng ($im);
?> 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2013-08-24T13:23:32.507

我知道我的回答不会被很多人喜欢，但请在大拇指向下之前考虑这里概述的要点。

垃圾邮件发送者可以轻松地机器读取任何易于机器读取的内容。尽管他们的行为在我们看来很愚蠢，但他们并不是愚蠢的人。他们创新且足智多谋。他们不只是使用机器人来收集电子邮件，他们有大量的方法可供使用，除此之外，他们只需为良好的新电子邮件列表付费。这意味着，他们让全球成千上万的黑帽黑客来执行他们的工作。人们准备编写恶意软件来抓取他人浏览器的屏幕，最终使您尝试实现的任何方法都变得无用。这个帖子已经被 10 多个这样的人阅读了，他们在嘲笑我们。他们中的一些人甚至可能厌倦了流泪，发现我们无法对他们提出新的挑战。

请记住，您最终不是要节省自己的时间，而是要节省他人的时间。因此，请考虑在这里多花一些时间。没有容易执行的灵丹妙药。如果您在一家在网站上发布 100 人电子邮件的公司工作，并且您可以减少每人每天 1 封垃圾邮件，那么我们谈论的是每年 36500 封垃圾邮件。如果删除此类电子邮件平均需要 5 秒钟，那么我们谈论的是每年 50 个工作小时。更不用说减少的烦恼了。那么，为什么不花几个小时在这上面呢？

不仅您和收到电子邮件的人认为时间是一种资产。因此，您必须找到一种方法来混淆电子邮件地址，以使其无法破解。如果您使用一些广泛使用的方法来混淆电子邮件，那么破解它确实是值得的。由于结果是，破解者将获得数千封，如果不是数万或数十万封新电子邮件。而对他们来说，他们会得到钱。

所以，继续编写你自己的方法。这是一种罕见的情况，重新发明轮子确实有回报。使用一种机器不可读的方法，并且最好在不牺牲用户体验的情况下需要一些用户交互。

我花了大约 20 分钟来编写一个例子来说明我的意思。在示例中，我使用 KnockoutJS 只是因为我喜欢它，而且我知道您自己可能不会使用它。但无论如何都无关紧要。这是一种自定义解决方案，并未广泛使用。破解它不会带来回报，因为这样做的方法只能在广阔的互联网上的一个页面上工作。

这是小提琴：http: [//jsfiddle.net/hzaw6/](http://jsfiddle.net/hzaw6/)

下面的代码并不是好的代码示例。但只是一个快速的代码示例，机器很难弄清楚我们甚至在这里处理电子邮件。即使可以做到，大规模执行也不会有回报。

是的，我知道它在 IE = lte8 上不起作用，因为'无法获取未定义或空引用的属性'属性'，但我根本不在乎，因为它只是方法的演示，而不是实际的实现，并且不打算按原样用于生产。随意编写自己的代码，它更酷，技术更可靠等。

哦，永远不要用 html 或 javascript 命名邮件或电子邮件。为任何名为 mail 或 email 的内容抓取 DOM 和 window 对象并检查它是否包含与电子邮件匹配的内容太容易了。这就是为什么您不希望任何变量包含完整形式的电子邮件，这也是您希望用户在分配此类变量之前与页面交互的原因。如果您的 javascript 对象模型包含任何处于 DOM 就绪状态的电子邮件地址，那么您就是将它们暴露给垃圾邮件发送者。

的HTML：

```
<div data-bind="foreach: contacts">
    <div class="contact">
        <div>
            <h5 data-bind="text: firstName + ' ' + lastName + ' / ' + department"></h5>
            <ul>
                <li>Phone: <span data-bind="text: phone"></span></li>
                <li><a href="#999" data-bind="click:$root.reveal">E-mail</a> <span data-bind="visible: $root.msgMeToThis() != ''"><input class="merged" data-bind="value: mPrefix" readonly="readonly" /><span data-bind="text: '@' + domain"></span></span></li>
            </ul>
        </div>
    </div>
</div> 
```

JS

```
function ViewModel(){
    var self = this;

    self.contacts = ko.observableArray([
        { firstName:'John', mPrefix: 'john.doe', domain: 'domain.com', lastName: 'Doe', department: 'Sales', phone: '+358 12 345 6789' },
        { firstName:'Joe', mPrefix: 'joe.w', domain: 'wonder.com', lastName: 'Wonder', department: 'Time wasting', phone: '+358 98 765 4321' },
        { firstName:'Mike', mPrefix: 'yo', domain: 'rappin.com', lastName: 'Rophone', department: 'Audio', phone: '+358 11 222 3333' }
    ]);
    self.msgMeToThis = ko.observable('');
    self.reveal = function(m, e){
        var name = e.target.attributes.href.value;
        name = name.replace('#', '');
        self.msgMeToThis(name);
    };
}
var viewModel = new ViewModel();
ko.applyBindings(viewModel); 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2009-01-27T13:44:22.127

您可以尝试使用十六进制中的**html 实体**来隐藏字符（例如：@ for @）。这是一种方便的解决方案，因为正确的浏览器会翻译它，并且您可以拥有正常的链接。缺点是机器人可以在理论上翻译它，但这有点不寻常。我用它来保护我博客上的电子邮件。

另一种解决方案是**使用 javascript**来组装部分地址并即时解码地址。缺点是禁用 javascript 的浏览器不会显示您的地址。

最有效的解决方案是**使用图像**，但用户不得不手动复制地址是一种痛苦。

**您的解决方案非常好**，因为您只为禁用了 javascript 的用户添加了一个缺点（手动编写 @）。您还可以通过以下方式更安全：

```
onclick="this.href='mailto:' + 'admin' + '&#x40;' + 'domain.com'" 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2010-08-03T09:39:29.760

我最喜欢的方法之一是使用 php 混淆电子邮件地址，一个经典的例子是将字符转换为 HEX 值，如下所示：

```
function myobfiscate($emailaddress){
 $email= $emailaddress;                
 $length = strlen($email);                         
 for ($i = 0; $i < $length; $i++){                
 $obfuscatedEmail .= "&#" . ord($email[$i]).";";
 }
 echo $obfuscatedEmail;
} 
```

然后在我的标记中，我将简单地调用它如下：

```
 <a href="mailto:<?php echo myobfiscate('someone@somewhere.com'); ?>"
title="Email me!"><?php echo myobfiscate('someone@somewhere.com');?> </a> 
```

然后检查您的来源，您会感到惊喜！

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-10-02T17:50:22.960

我不会打扰 - 它是在错误的级别上与垃圾邮件战争作斗争。特别是对于公司网站，我认为如果页面上除了带有 mailto 超链接的纯文本之外还有其他任何内容，这会让事情看起来非常不专业。

到处都是垃圾邮件，无论如何您都需要进行良好的过滤，并且无论如何，任何机器人最终都会理解所有常见的技巧。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-10-02T18:16:47.530

HTML：

```
<a href="#" class="--mailto--john--domain--com-- other classes goes here" /> 
```

JavaScript，使用[jQuery](http://jquery.com)：

```
// match all a-elements with "--mailto--" somehere in the class property
$("a[class*='--mailto--']").each(function ()
{
    /*
    for each of those elements use a regular expression to pull
    out the data you need to construct a valid e-mail adress
    */
    var validEmailAdress = this.className.match();

    $(this).click(function ()
    {
        window.location = validEmailAdress;
    });
}); 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2017-05-03T02:04:45.770

垃圾邮件机器人不会解释这一点，因为它是一种鲜为人知的方法:)

首先，定义css：

```
email:before {
    content: "admin";
}

email:after {
    content: "@example.com";
} 
```

现在，无论您想在哪里显示您的电子邮件，只需插入以下 HTML：

```
<div id="email"></div> 
```

还有多田！

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-05-27T08:05:12.157

我使用了一个非常简单的 CSS 和 jQuery 组合，它可以正确地向用户显示电子邮件地址，并且在单击或悬停锚点时也可以工作：

HTML：

```
<a href="mailto:me@example.spam" id="lnkMail">moc.elpmaxe@em</a> 
```

CSS：

```
#lnkMail {
    unicode-bidi: bidi-override;
    direction: rtl;
} 
```

jQuery：

```
$('#lnkMail').hover(function(){
    // here you can use whatever replace you want
    var newHref = $(this).attr('href').replace('spam', 'com');
    $(this).attr('href', newHref);
}); 
```

[这](https://jsfiddle.net/qy1dkkbh/)是一个工作示例。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-10-02T19:58:30.157

我不打扰。你只会惹恼老练的用户并迷惑不老练的用户。正如其他人所说，Gmail 为个人/小型企业域提供了非常有效的垃圾邮件过滤器，而企业过滤器通常也非常好。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-01-27T12:28:35.367

隐藏电子邮件地址的最佳方法只有在机器人程序员发现这种“编码”并实施解密算法之前才有效。

JavaScript 选项不会长时间工作，因为有很多爬虫解释 JavaScript。

没有答案，恕我直言。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-01-27T12:29:51.620

一种简单的解决方案是使用 HTML 实体而不是实际字符。例如，“me@example.com”将转换为：

```
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#109;&#101;&#64;&#101;&#120;&#97;&#109;&#112;&#108;&#101;&#46;&#99;&#111;&#109;">email me</A> 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2013-01-03T11:06:49.410

!- 添加此内容以供参考，不知道该信息可能是否过时，但它讲述了一些不需要使用任何脚本的简单解决方案

在我自己搜索这个之后，我遇到了这个页面，还有这些页面：

[http://nadeausoftware.com/articles/2007/05/stop_spammer_email_harvesters_obfuscating_email_addresses](http://nadeausoftware.com/articles/2007/05/stop_spammer_email_harvesters_obfuscating_email_addresses)

尝试反转电子邮件地址

**纯 HTML 示例：**

```
<bdo dir="rtl">moc.elpmaxe@nosrep</bdo>
Result : person@example.com 
```

**使用CSS同样的效果**

```
CSS:
.reverse { unicode-bidi:bidi-override; direction:rtl; }
HTML:
<span class="reverse">moc.elpmaxe@nosrep</span>
Result : person@example.com 
```

将其与前面提到的任何方法相结合甚至可以使其更有效

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2015-05-27T07:59:17.463

我对类似问题的回答[：](https://stackoverflow.com/a/30476576/612847)

> 我使用了一个非常简单的 CSS 和 jQuery 组合，它可以正确地向用户显示电子邮件地址，并且在单击锚点时也可以工作：
> 
> HTML：
> 
> ```
> <a href="mailto:me@example.spam" id="lnkMail">moc.elpmaxe@em</a> 
> ```
> 
> CSS：
> 
> ```
> #lnkMail {
>   unicode-bidi: bidi-override;
>   direction: rtl;
> } 
> ```
> 
> jQuery：
> 
> ```
> $('#lnkMail').hover(function(){
>   // here you can use whatever replace you want
>   var newHref = $(this).attr('href').replace('spam', 'com');
>   $(this).attr('href', newHref);
> }); 
> ```
> 
> [这](https://jsfiddle.net/qy1dkkbh/)是一个工作示例。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2016-05-12T00:11:21.977

这是我的工作版本：

* * *

在某处创建一个带有后备文本的容器：

```
<div id="knock_knock">Activate JavaScript, please.</div> 
```

并在 DOM 的底部（在渲染中）添加以下代码段：

```
<script>
  (function(d,id,lhs,rhs){
    d.getElementById(id).innerHTML = "<a rel=\"nofollow\" href=\"mailto"+":"+lhs+"@"+rhs+"\">"+"Mail"+"<\/a>";
  })(window.document, "knock_knock", "your.name", "example.com");
</script> 
```

它将生成的超链接添加到指定的容器：

```
<div id="knock_knock"><a rel="nofollow" href="your.name@example.com">Mail</a></div> 
```

另外这里是一个缩小版：

```
<script>(function(d,i,l,r){d.getElementById(i).innerHTML="<a rel=\"nofollow\" href=\"mailto"+":"+l+"@"+r+"\">"+"Mail"+"<\/a>";})(window.document,"knock_knock","your.name","example.com");</script> 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2020-07-18T14:35:53.840

一个巧妙的技巧是`div`使用单词*Contact*并仅在用户将鼠标移到电子邮件地址上时才显示电子邮件地址。电子邮件可以进行 Base64 编码以提供额外保护。

就是这样：

```
<div id="contacts">Contacts</div>

<script>
  document.querySelector("#contacts").addEventListener("mouseover", (event) => {
    // Base64-encode your email and provide it as argument to atob()
    event.target.textContent = atob('aW5mb0BjbGV2ZXJpbmcuZWU=')
  });
</script> 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-10-02T18:07:13.950

唯一最安全的方法当然是首先不要将电子邮件地址放在网页上。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2008-10-02T18:28:48.500

请改用联系表格。将您所有的电子邮件地址放入数据库并创建一个 HTML 表单（主题、正文、发件人...），该表单提交用户在表单中填写的电子邮件内容（以及用于在您的数据库中查找该人的电子邮件地址）到服务器端脚本，然后将电子邮件发送给指定的人。电子邮件地址绝不会暴露。您可能还需要实施某种形式的 CAPTCHA 来阻止垃圾邮件程序。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-01-27T12:29:37.423

可能有机器人将`[at]`和其他伪装识别为`@`符号。所以这不是一个真正有效的方法。

当然，您可以使用一些编码，如 URL 编码或 HTML 字符引用（或两者）：

```
// PHP example
// encodes every character using URL encoding (%hh)
function foo($str) {
    $retVal = '';
    $length = strlen($str);
    for ($i=0; $i<$length; $i++) $retVal.=sprintf('%%%X', ord($str[$i]));
    return $retVal;
}
// encodes every character into HTML character references (&#xhh;)
function bar($str) {
    $retVal = '';
    $length = strlen($str);
    for ($i=0; $i<$length; $i++) $retVal.=sprintf('&#x%X;', ord($str[$i]));
    return $retVal;
}

$email = 'user@example.com';
echo '<a href="'.bar('mailto:?to=' . foo(','.$email.'')).'">mail me</a>';

// output
// <a href="&#x6D;&#x61;&#x69;&#x6C;&#x74;&#x6F;&#x3A;&#x3F;&#x74;&#x6F;&#x3D;&#x25;&#x32;&#x43;&#x25;&#x37;&#x35;&#x25;&#x37;&#x33;&#x25;&#x36;&#x35;&#x25;&#x37;&#x32;&#x25;&#x34;&#x30;&#x25;&#x36;&#x35;&#x25;&#x37;&#x38;&#x25;&#x36;&#x31;&#x25;&#x36;&#x44;&#x25;&#x37;&#x30;&#x25;&#x36;&#x43;&#x25;&#x36;&#x35;&#x25;&#x32;&#x45;&#x25;&#x36;&#x33;&#x25;&#x36;&#x46;&#x25;&#x36;&#x44;">mail me</a> 
```

但由于使用它们是合法的，每个浏览器/电子邮件客户端也应该处理这些编码。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2020-09-12T16:12:09.303

一种可能性是使用`isTrusted`属性（Javascript）。

> Event 接口的 isTrusted 只读属性是一个布尔值，当事件由用户操作生成时为 true，当事件由脚本创建或修改或通过 EventTarget.dispatchEvent() 调度时为 false。

例如在你的情况下：

```
getEmail() {
  if (event.isTrusted) {
    /* The event is trusted */
    return 'your-email@domain.com';
  } else {
    /* The event is not trusted */
    return 'chuck@norris.com';
  }
} 
```

⚠ IE 不兼容！

从文档中阅读更多信息：[https ://developer.mozilla.org/en-US/docs/Web/API/Event/isTrusted](https://developer.mozilla.org/en-US/docs/Web/API/Event/isTrusted)

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-10-02T18:05:54.843

我创建了我的whateverDOC@whatever.com，然后在它旁边写下“删除大写字母”

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2008-10-02T18:16:14.490

另一种可能是独特的技术可能是使用多个图像和一些纯文本字母来显示地址。这可能会使机器人感到困惑。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2008-10-02T19:12:26.680

免费的 Gmail 有一个很棒的垃圾邮件过滤器。

如果您不想直接使用 Gmail，您可以将电子邮件发送到 gmail，并在邮件通过垃圾邮件过滤器后使用 gmail 转发将其发回给您。

在更复杂的情况下，当您需要显示@business.com 地址时，您可以显示 public@business.com 并将所有这些邮件转发到 gmail 帐户，然后再将其转发回 real@business.com

我想这不是您问题的直接解决方案，但它可能会有所帮助。Gmail 是免费的并且拥有如此出色的垃圾邮件过滤器，恕我直言，使用它是一个非常明智的选择。

我每天在我的 gmail 帐户中收到大约 100 封垃圾邮件，但我不记得其中一封邮件最后一次进入我的收件箱是什么时候了。

总而言之，无论是 Gmail 还是其他垃圾邮件过滤器，都要使用一个好的垃圾邮件过滤器。让用户重新输入或修改显示的电子邮件地址就像使用 DRM 来防止盗版。把负担放在“好”人身上不应该是做任何事情的方式。:)

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-01-27T12:31:38.607

如果我右键单击链接并选择“复制 URL”，它会起作用吗？如果不是，那么这不是一个理想的情况（我很少点击 mailto 链接，更喜欢复制电子邮件地址并将其粘贴到我的邮件应用程序或在特定时间点我需要它的任何其他地方）。

我曾经相当偏执地在线保护我的邮件地址（UseNet、web 等），但现在我怀疑更多“可能的垃圾邮件目标”实际上是通过编程方式生成与域匹配的本地部分。我的基础是有时会浏览我的邮件服务器日志。向不存在的地址（包括我在 90 年代后期徘徊在 UseNet 上的垃圾邮件诱饵的截断版本，当时地址抓取非常普遍）往往有相当多的交付尝试。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-01-27T18:39:35.260

首先，我会确保电子邮件地址仅在您启用 javascript 时显示。这样，没有 javascript 就没有纯文本可以读取。

其次，实现安全功能的一种方法是远离`<button>`标签。该标签需要在标签之间插入文本，使其具有计算机可读性。而是尝试`<input type="button">`使用 onClick 的 javascript 处理程序。然后使用其他人提到的所有技术来实现安全的电子邮件符号。

另一种选择是有一个带有“点击查看电子邮件地址”的按钮。单击后，它将变为编码电子邮件（HTML 代码中的字符）。在另一次单击时，这将重定向到“mailto:email”功能

最后一个想法的未编码版本，带有可选择和不可选择的电子邮件地址：

```
<html>
<body>
<script type="text/javascript">
      e1="@domain";
      e2="me";
      e3=".extension";
email_link="mailto:"+e2+e1+e3;
</script>
<input type="text" onClick="this.onClick=window.open(email_link);" value="Click for mail"/>
<input type="text" onClick="this.value=email;" value="Click for mail-address"/>
<input type="button" onClick="this.onClick=window.open(email_link);" value="Click for mail"/>
<input type="button" onClick="this.value=email;" value="Click for mail-address"/>
</body></html> 
```

看看这是否是您想要的，并将其与其他人的想法结合起来。你永远不能太确定。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2009-11-06T12:46:21.760

对于您自己的电子邮件地址，我建议不要太担心它。如果您需要将您的电子邮件地址提供给成千上万的用户，那么我建议您使用 gmail 地址（原版或通过谷歌应用程序）或使用高质量的垃圾邮件过滤器。

但是，当在您的网站上显示其他用户的电子邮件地址时，我认为需要进行一定程度的尽职调查。幸运的是，一位名叫 Silvan Mühlemann 的博主为[您完成了所有艰巨的工作](http://techblog.tilllate.com/2008/07/20/ten-methods-to-obfuscate-e-mail-addresses-compared/)。他在 1.5 年的时间里测试了不同的混淆方法并确定了最好的方法，其中大多数涉及 css 或 javascript 技巧，这些技巧可以让地址在浏览器中正确显示，但会混淆自动抓取工具。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2012-11-08T03:37:38.677

在使用了这么多技术后，我找到了一种简单且非常友好的方法，机器人搜索 @Símbolo，最近他们搜索 [at] ant it's 变种，所以我使用了 2 种技术

1.  我把我的电子邮件写在一个像 domaintolls 使用的图像上，它工作得很好，或者
2.  用它的图像替换 Símbolo (@)

![@ 代替](https://i.stack.imgur.com/Hx1XJ.gif) 并且图像 alt 将是 alt="@" 所以机器人会找到一个图像，任何人都会将其视为一个普通地址，所以如果他复制它，他将复制电子邮件并且工作完成，所以代码将是

```
<p>myname<img src="http://www.traidnt.net/vb/images/mail2.gif" width="11" height="9" alt="@" />domain.com</p> 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2013-04-29T20:23:48.850

HTML_CHARACTER 呢？：

```
joe&#064;mail.com 
```

输出

```
joe@mail.com 
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2013-10-13T20:14:38.883

还有我的功能。我创建它是查看放置在该主题中的答案。

```
 function antiboteEmail($email)
 {
        $html = '';

        $email = strrev($email);
        $randId = rand(1, 500);

        $html .= '<span id="addr-'.$randId.'" class="addr">[turn javascript on to see the e-mail]</span>';
        $html .= <<<EOD
                <script>
                $(document).ready(function(){

                    var addr = "$email";
                    addr = addr.split("").reverse().join("");
                    $("#addr-$randId").html("<a href=\"mailto:" + addr + "\">" + addr + " </a>");
                });
                </script>
EOD;

        return $html;
    } 
```

它使用两种方法：从右到左 dir 和 javascript put。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2014-03-06T07:18:17.793

选项 1：将电子邮件地址拆分为多个部分，并在 JavaScript 中从这些部分中创建一个数组。接下来以正确的顺序加入这些部分，并使用 .innerHTML 属性将电子邮件地址添加到网页。

```
 <span id="email">  </span>   // blank tag

 <script>
 var parts = ["info", "XXXXabc", "com", "&#46;", "&#64;"];
 var email = parts[0] + parts[4] + parts[1] + parts[3] + parts[2];
 document.getElementById("email").innerHTML=email; 
 </script> 
```

选项 2：使用图像而不是电子邮件文本

来自文本的图像创建者网站：http: [//www.chxo.com/labelgen/](http://www.chxo.com/labelgen/)

选项 3：我们可以用 AT 代替“@”，用 DOT 代替“.”

IE ：

```
 info(AT)XXXabc(DOT)com 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2015-12-02T13:49:10.697

我不喜欢混合使用 JavaScript 和 HTML，这就是我使用这个解决方案的原因。目前对我来说效果很好。

**想法**`data`：您可以通过在-attributes中提供加密信息并在 JS 中对其进行解密来使其更加复杂。这只是通过替换字母或只是反转它们来完成。

**HTML**：

```
<span class="generate-email" data-part1="john" data-part2="gmail" data-part3="com">placeholder</span> 
```

**JS**：

```
$(function() {
    $('.generate-email').each(function() {
        var that = $(this);
        that.html(
            that.data('part1') + '@' + that.data('part2') + '.' + that.data('part3')
        );
    });  
}); 
```

试试看：http: [//jsfiddle.net/x6g9L817/](http://jsfiddle.net/x6g9L817/)

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-10-02T18:26:20.067

将电子邮件地址保存到 png 文件的脚本将是一个安全的解决方案（如果您有足够的空间并且允许您在页面中嵌入图像）

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-10-02T18:28:47.377

这就是我们使用的（VB.NET）：

```
Dim rxEmailLink As New Regex("<a\b[^>]*mailto:\b[^>]*>(.*?)</a>")
Dim m As Match = rxEmailLink.Match(Html)
While m.Success
    Dim strEntireLinkOrig As String = m.Value
    Dim strEntireLink As String = strEntireLinkOrig
    strEntireLink = strEntireLink.Replace("'", """") ' replace any single quotes with double quotes to make sure the javascript is well formed
    Dim rxLink As New Regex("(<a\b[^>]*mailto:)([\w.\-_^@]*@[\w.\-_^@]*)(\b[^>]*?)>(.*?)</a>")
    Dim rxLinkMatch As Match = rxLink.Match(strEntireLink)
    Dim strReplace As String = String.Format("<script language=""JavaScript"">document.write('{0}{1}{2}>{3}</a>');</script>", _
                RandomlyChopStringJS(rxLinkMatch.Groups(1).ToString), _
                ConvertToAsciiHex(rxLinkMatch.Groups(2).ToString), _
                rxLinkMatch.Groups(3), _
                ConvertToHtmlEntites(rxLinkMatch.Groups(4).ToString))
    Result = Result.Replace(strEntireLinkOrig, strReplace)
    m = m.NextMatch()
End While 
```

和

```
 Public Function RandomlyChopStringJS(ByVal s As String) As String
        Dim intChop As Integer = Int(6 * Rnd()) + 1
        Dim intCount As Integer = 0
        RandomlyChopStringJS = ""
        If Not s Is Nothing AndAlso Len(s) > 0 Then
            For Each c As Char In s.ToCharArray()
                If intCount = intChop Then
                    RandomlyChopStringJS &= "'+'"
                    intChop = Int(6 * Rnd()) + 1
                    intCount = 0
                End If
                RandomlyChopStringJS &= c
                intCount += 1
            Next
        End If
    End Function 
```

我们覆盖 Render 并在它出门之前通过它运行传出的 HTML。这会呈现正常呈现给浏览器的电子邮件地址，但在源代码中如下所示：

```
<script language="JavaScript">document.write('<a '+'clas'+'s='+'"Mail'+'Link'+'" hr'+'ef'+'="ma'+'ilto:%69%6E%66%6F%40%62%69%63%75%73%61%2E%6F%72%67">&#105;&#110;&#102;&#111;&#64;&#98;&#105;&#99;&#117;&#115;&#97;&#46;&#111;&#114;&#103;</a>');</script> 
```

显然不是万无一失的，但希望减少一定数量的收获，而不会给游客带来困难。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-10-02T18:36:22.367

这取决于您的需求到底是什么。对于我工作的大多数网站，我发现输入“联系我/我们”表格更有用，该表格从系统向需要联系的任何人发送电子邮件。我知道这并不完全是您正在寻求的解决方案，但它确实可以完全防止收获，到目前为止我从未见过通过这样的表格发送垃圾邮件。它会发生，但它非常罕见，你永远不会收获。

如果您愿意，这也使您有机会在发送消息之前记录消息，从而为您提供额外的保护以防止失去联系。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2010-03-06T13:22:45.597

随着时间的推移，垃圾邮件机器人将拥有自己的 Javascript 和 CSS 引擎，所以我认为你不应该朝这个方向看。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2011-09-05T13:24:51.637

这是一个简单的jquery解决这个问题：

```
<script type="text/javascript">
$(document).ready(function() {
    str1="mailto:";
    str2="info";
    str3="@test.com";
    $("#email_a").attr("href", str1+str2+str3);

});
</script>

<a href="#" id="email_a"><img src="sample.png"/></a> 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2012-12-31T05:27:28.537

我最喜欢 ofaurax 的回答，但我会修改这个以获得更多隐藏的电子邮件：

```
onclick="p1='admin'; p2='domain.com'; this.href='mailto:' + p1 + '& #x40;' + p2" 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2013-08-25T12:30:36.233

我只需要提供另一个答案。我只是想出了一些有趣的东西来玩。

我发现在许多常见的字符表中，字母 @ 和 az 不止一次出现。您可以将原始字符映射到新的映射，让垃圾邮件机器人更难找出电子邮件是什么。

如果你遍历字符串，得到一个字母的字符代码，然后添加 65248 并基于数字构建一个 html 实体，你会得到一个人类可读的电子邮件地址。

```
var str = 'john.doe@email.com';
str = str.toLowerCase().replace(/[\.@a-z]/gi, function(match, position, str){
    var num = str.charCodeAt(position);
    return ('&#' + (num + 65248) + ';');
}); 
```

这是一个工作小提琴：http: [//jsfiddle.net/EhtSC/8/](http://jsfiddle.net/EhtSC/8/)

您可以通过在看起来相同的字符之间创建一组更完整的映射来改进此方法。但是，如果您将电子邮件复制/粘贴到记事本，例如，您会得到很多框。

为了克服一些用户体验问题，我将电子邮件创建为链接。当您单击它时，它会将字符重新映射回其原始状态。

为了改善这一点，您可以根据需要创建更复杂的字符映射。如果你能找到几个可以用来代替“a”的字符，为什么不随机映射到这些字符。

可能不是有史以来最安全的方法，但我真的玩得很开心：D

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2014-03-06T07:21:38.117

选项 1：将电子邮件地址拆分为多个部分，并在 JavaScript 中从这些部分中创建一个数组。接下来以正确的顺序加入这些部分，并使用 .innerHTML 属性将电子邮件地址添加到网页。

```
 <span id="email">  </span>   // blank tag

 <script>
 var parts = ["info", "XXXXabc", "com", "&#46;", "&#64;"];
 var email = parts[0] + parts[4] + parts[1] + parts[3] + parts[2];
 document.getElementById("email").innerHTML=email; 
 </script> 
```

选项 2：使用图像而不是电子邮件文本

来自文本的图像创建者网站：http: [//www.chxo.com/labelgen/](http://www.chxo.com/labelgen/)

选项 3：我们可以用 AT 代替“@”，用 DOT 代替“.”

IE ：

```
 info(AT)XXXabc(DOT)com 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2014-06-10T07:48:08.520

我刚刚编写了以下代码。不知道它是否好，但它比用纯文本写电子邮件更好。许多机器人会被愚弄，但并非所有机器人都会被愚弄。

```
<script type="text/javascript">
    $(function () {
        setTimeout(function () {
            var m = ['com', '.', 'domain', '@', 'info', ':', 'mailto'].reverse().join('');

            /* Set the contact email url for each "contact us" links.*/
            $('.contactUsLink').prop("href", m);
        }, 200);
    });
</script> 
```

如果机器人解决了这个问题，则无需添加更多“简单逻辑”代码，例如“if (1 == 1 ? '@' : '')”或以其他顺序添加数组元素，因为机器人无论如何都会评估代码.

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2017-09-18T03:26:17.653

字体很棒的作品！

```
<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">

<p>myemail<i class="fa fa-at" aria-hidden="true"></i>mydomain.com</p> 
```

[http://fontawesome.io/](http://fontawesome.io/)

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2021-08-13T15:57:44.197

**隐藏的 Base64 解决方案。**

我认为将电子邮件地址放在 :before/:after 伪中或将其拆分为反向写入的数据属性都没关系......垃圾邮件机器人很聪明，可以分析解析的网页。

此解决方案是交互式的。用户必须单击“显示”以获取 base64 解码的电子邮件地址，该地址可以被复制和/或可点击。

```
// search for [data-b64mail] attributes
document.querySelectorAll('[data-b64mail]').forEach(el => {

  // set "show" link
  el.innerHTML = '<span style="text-decoration:underline;cursor:pointer">show</span>';

  // set click event to all elements
  el.addEventListener('click', function (e) {
    let cT = e.currentTarget;

    // show address
    cT.innerHTML = atob(cT.getAttribute('data-b64mail'));

    // set mailto on a tags
    if (cT.tagName === 'A')
      cT.setAttribute('href', 'mailto:' + atob(cT.getAttribute('data-b64mail')));

  });

});

// get base64 encoded string
console.log(btoa('mail@example.org'));
```

```
<p>E-mail (span): <span data-b64mail="bWFpbEBleGFtcGxlLm9yZw=="></span></p>

<p>E-mail (link): <a href="#" data-b64mail="bWFpbEBleGFtcGxlLm9yZw=="></a></p>
```

* * *

## 回答 #51

> 赞同：-1
> 
> 时间：2017-12-25T09:14:21.713

另一种选择，我更喜欢字体真棒图标

发实现：

```
<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css"> 
```

邮件地址：

```
<a href="mailto:info@uploadimage.club"><span class="label">info<i class="fa fa-at"></i>uploadimage.club</span></a> 
```

# java - 你会推荐在 Java 中使用哪个 SVG 工具包？

> ID：163632
> 
> 赞同：4
> 
> 时间：2008-10-02T17:45:28.403
> 
> 标签：java, svg

[作为另一个问题](https://stackoverflow.com/questions/162991/selecting-proper-toolkit-for-a-2d-simulation-project-in-java)的后续，我想知道在 Java 项目中使用 SVG 的最佳方式是什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T17:50:33.117

Apache [Batik](http://xmlgraphics.apache.org/batik/)项目是一个用 Java 编写的开源 SVG 渲染器。您可以将 SVG 文件传递​​给它，或者通过可从 Java 代码访问的 DOM 样式 API 以编程方式创建文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-24T11:16:25.497

除了 Batik 之外，还有[SVG Salamander](https://svgsalamander.java.net/)。

我个人更喜欢 Salamander，它只是不支持所有 SVG 功能，例如。高斯模糊。

# ant - 如何从 vanilla ant（不是 ws_ant）访问 Websphere 6.1 ant 任务

> ID：163646
> 
> 赞同：3
> 
> 时间：2008-10-02T17:47:39.723
> 
> 标签：ant, websphere, task, websphere-6.1

我想我需要知道类路径中需要什么（什么 jar）才能执行 WebSphere 6.1 ant 任务。如果有人可以提供一个完美的例子。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T14:46:41.430

实际的 Websphere Ant 任务在`wsanttasks.jar`.

linux系统的可能路径是`/opt/IBM/WebSphere/AppServer/lib/wsanttasks.jar`

但是，我怀疑仅通过包含它就可以成功，因为我确实记得尝试过一次，但由于依赖性而失败。

但是，这并非不可能，因为它`ws_ant`只是一个包装脚本，它添加了*所有必需的类路径并调用内置的 ant*。因此，如果您有时间查看`ws_ant`脚本，您将能够获得所有必需的类路径。

顺便说一句，你有什么特别的理由要避免`ws_ant`，那肯定会让你的生活变得简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T15:35:04.380

对于 Websphere 6.1，您可以使用 jar com.ibm.ws.runtime_6.1.0.jar 来访问 ant 任务。

在 Windows 上，jar 位于 plugins 目录中（对我来说这是：C:\Program Files\IBM\WebSphere\AppServer\plugins）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-07T00:20:12.103

websphere 的 ant 任务被搞砸了，它们调用 wsadmin.bat

你可以自己做

# .net - 轻量级 .NET 调试器？

> ID：163647
> 
> 赞同：27
> 
> 时间：2008-10-02T17:47:45.900
> 
> 标签：.net, debugging

我经常需要在测试机器上调试 .NET 二进制文件（通过测试机器，我的意思是机器上没有安装 Visual Studio，它经常重新映像，这不是我进行开发的同一台机器， ETC）。

我喜欢 Visual Studio 调试器，但对我来说，仅仅为了调试断言或崩溃而在新映像的测试机器上安装 Visual Studio 是不切实际的（安装时间太长，占用空间太大等）。

我真的很想要一个快速安装的程序，它可以闯入正在运行的进程，让我指定符号/源代码的位置，然后直接进入调试。对于本机二进制文件，windbg 效果很好，但我没有找到任何与托管二进制文件类似的东西。有什么建议吗？

（作为旁注，我知道 Visual Studios 远程调试功能，但由于某种原因，它似乎对我来说始终无法正常工作......我经常遇到连接问题）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-16T21:35:13.560

要获得比 MDbg 或 cordbg 更好的界面，请查看 DbgCLR - Visual Studio 调试器的精简版本（至少看起来像一个），它只处理托管代码。它带有 .NET Framework（我不确定它是否在运行时中，或者您是否需要 Framework SDK）：

*   [http://msdn.microsoft.com/en-us/library/7zxbks7z(VS.85).aspx](http://msdn.microsoft.com/en-us/library/7zxbks7z(VS.85).aspx)

请注意，不推荐使用 cordbg 以支持 MDbg（即使 MDbg 不具有 cordbg 的所有功能）：

*   [http://blogs.msdn.com/jmstall/archive/2005/11/07/views_on_cordbg_and_mdbg.aspx](http://blogs.msdn.com/jmstall/archive/2005/11/07/views_on_cordbg_and_mdbg.aspx)

在写这篇文章时回顾 MDbg，我发现有一个可用于 MDbg 的 GUI 包装器（我还没有尝试过）：

*   [http://blogs.msdn.com/jmstall/archive/2005/02/04/367506.aspx](http://blogs.msdn.com/jmstall/archive/2005/02/04/367506.aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2018-09-08T14:03:39.877

使用**[dnSpy](https://github.com/0xd4d/dnSpy)**。

dnSpy 是一个调试器和 .NET 程序集编辑器。即使您没有任何可用的源代码，您也可以使用它来编辑和调试程序集。

太棒了。非常小巧轻便。无需安装或配置。它的界面与 Visual Studio 完全一样。甚至它的快捷键也和 VS 一样。

**特征：**

# 调试器

*   调试 .NET Framework、.NET Core 和 Unity 游戏程序集，无需源代码
*   设置断点并进入任何程序集
*   当地人，手表，汽车窗户
*   变量窗口支持将变量（例如解密的字节数组）保存到磁盘或在十六进制编辑器中查看它们（内存窗口）
*   对象 ID
*   可以同时调试多个进程
*   模块加载中断
*   跟踪点和条件断点
*   导出/导入断点和跟踪点
*   调用堆栈、线程、模块、进程窗口
*   打破抛出的异常（第一次机会）
*   变量窗口支持计算 C#/Visual Basic 表达式
*   可以调试动态模块（但由于 CLR 限制，不能调试动态方法）
*   输出窗口记录各种调试事件，默认显示时间戳:)
*   可以调试在运行时自行解密的程序集，dnSpy 将使用内存中的映像。您还可以强制 dnSpy 始终使用内存中的图像而不是磁盘文件。
*   公共 API，您可以编写扩展或使用 C# 交互窗口来控制调试器

# 装配编辑器

*   所有元数据都可以编辑
*   使用 IntelliSense 在 C# 或 Visual Basic 中编辑方法和类，无需源代码
*   在 C# 或 Visual Basic 中添加新方法、类或成员
*   用于低级 IL 方法体编辑的 IL 编辑器
*   可以编辑低级元数据表。这在内部使用十六进制编辑器。

# 十六进制编辑器

*   点击反编译代码中的一个地址，在十六进制编辑器中转到它的 IL 代码
*   与上述相反，在十六进制编辑器的 IL 正文中按 F12 以转到反编译代码或其他位的高级表示。很高兴找出补丁修改了哪个语句。
*   重点介绍 .NET 元数据结构和 PE 结构
*   工具提示显示有关所选 .NET 元数据/PE 字段的更多信息
*   转到位置、文件、RVA
*   转到 .NET 元数据令牌、方法主体、#Blob / #Strings / #US 堆偏移量或 #GUID 堆索引
*   关注参考 (Ctrl+F12)

# 其他

*   BAML 反编译器
*   蓝色、浅色和深色主题（以及深色高对比度主题）
*   书签
*   C# 交互式窗口可用于编写 dnSpy 脚本
*   在程序集中搜索类、方法、字符串等
*   分析类和方法的使用，查找调用者等
*   多个选项卡和选项卡组
*   引用被突出显示，使用 Tab / Shift+Tab 移动到下一个引用
*   转到入口点和模块初始化程序命令
*   转到元数据令牌或元数据行命令
*   代码工具提示（C# 和 Visual Basic）
*   导出到项目

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-02-09T20:56:49.930

我终于找到了可以满足我需求的 Windbg 扩展：[Sosex.dll](http://www.stevestechspot.com/)，让我可以使用 windbg 调试托管应用程序，并且只需极少的安装。我已经使用了一年多，对于我遇到的每个调试场景，它都可以正常工作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-02T17:53:55.510

总是有[mdbg](http://www.microsoft.com/downloads/details.aspx?familyid=38449a42-6b7a-4e28-80ce-c55645ab1310&displaylang=en)和[cordbg](http://msdn.microsoft.com/en-us/library/a6zb7c8d(VS.80).aspx)，但我建议深入研究为什么远程调试不能始终如一地工作。

VS2005/8 似乎比这里的早期版本可靠得多（尽管我主要做非托管），它使您不必在目标机器上访问符号。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-04T05:47:13.437

[ILSpy](http://wiki.sharpdevelop.net/ILSpy.ashx)版本 2包含一个调试器。而且效果很棒！

它仍处于非常早期的阶段，但已经帮助了我好几次。

请注意错误！:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T18:00:21.643

您可以查看 MDbg：http: [//blogs.msdn.com/jmstall/archive/2006/11/22/mdbg-sample-2-1.aspx](http://blogs.msdn.com/jmstall/archive/2006/11/22/mdbg-sample-2-1.aspx)。看起来它至少带有 .NET 3.5 SDK（它可能包含在 2.0+ 中）。

Windbg 已管理扩展（我相信称为 SOS），但我不知道它们是否允许源级调试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-16T01:23:24.597

你试过使用[Cracked.NET](http://joshsmithonwpf.wordpress.com/cracknet/)吗？

它是一个运行时调试和脚本工具，可让您访问计算机上运行的任何 .NET 桌面应用程序的内部结构。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-28T15:33:00.087

也许您可以尝试将[Live Tuning](http://www.objectis-software.com/product/ostudio-live-tuning-live-debugging-functional-tests/)与[Ocf 服务器](http://www.objectis-software.com/product/ocf-server-makes-your-application-accessible/)结合使用？

它本身不是调试器，但很容易在应用程序和 Live Tuning 之间建立连接。就像，字面意思是 3 行代码。然后，您可以访问您选择发布的所有变量。

我发现它在尝试调试我的程序而无法访问反编译代码或真正的调试器时很有用。你不能真的有断点，但事实证明有时有更好的调试方法。

# tcp - NAT 端口转发的最佳选择是什么？

> ID：163654
> 
> 赞同：7
> 
> 时间：2008-10-02T17:48:50.873
> 
> 标签：tcp, bonjour, nat, upnp, portforwarding

我想让用户可以轻松地将其 NAT 上的端口转发到我的 C++ 应用程序的本地计算机。我想让这项工作在 OSX 和 Windows 上运行。Linux 将是一个很大的好处，但 Linux 用户可能更愿意手动转发端口，所以这不是一个问题。LGPL 类型代码是可以的，但我不能使用任何直接 GPL 的东西。

我很想听听任何人在这方面的任何想法或经验，但我想到了一些具体的问题：

*   是否有公认的 UPNP 最佳库？MiniUPNP[客户](http://miniupnp.free.fr/)端看起来可以工作，但还有其他东西吗？
*   [卓悦](http://en.wikipedia.org/wiki/Bonjour_(software))呢？我可以将它用于 OSX 计算机吗？
*   所有大型的 bittorrent 应用程序都必须处理这个问题，那么是否有关于他们如何做到这一点的现有调查？Skype 呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T18:01:51.407

MiniUPNP 由至少一个 bittorrent 客户端（传输）使用，应该可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T04:34:58.180

OS X 和 Windows 上的 Bonjour 可用于与支持 uPNP 或 NAT-PMP 的路由器进行端口映射。我没有使用过[API (DNSServiceNATPortMappingCreate)](http://developer.apple.com/DOCUMENTATION/Networking/Reference/DNSServiceDiscovery_CRef/dns_sd/CompositePage.html#//apple_ref/c/func/DNSServiceNATPortMappingCreate)，但我已经成功地在 NAT-PMP 路由器后面的 Windows 和 OS X 上发布了广域服务。我不确定您的 Windows 用户是否想要安装 Bonjour（尽管如果他们使用 iTunes 或 Safari，他们可能已经安装了 Bonjour）来使用您的应用程序，但 OS X 支持应该不是问题。

# c# - 读取逗号分隔文件并将数据放入 ListView - C#

> ID：163662
> 
> 赞同：1
> 
> 时间：2008-10-02T17:50:50.527
> 
> 标签：c#, listview, user-interface

好吧，我正在尝试读取一个逗号分隔的文件，然后将其放入 ListView （或任何网格，真的）。我已经处理了工作的定界部分，文件的字段被放入多维字符串数组中。问题是试图将其放入 ListView。

似乎没有真正的动态添加列或项目的方法，因为每个列和项目都需要手动声明。这带来了一个问题，因为我需要 ListView 与文件一样大，而没有设置谁的大小。一次可能很大，一次可能很小。

对此的任何帮助将不胜感激。

* * *

回应杰弗里的回答。

我会这样做，但我遇到的问题是一个基本问题。如何在不命名它们的情况下创建这些对象。菜鸟问题，但遗憾的是，对我来说是个问题。这就是我到目前为止所拥有的。

```
int x = 0;
int y = 0;
while (y < linenum)
{
    while (x < width)
    {
        ListViewItem listViewItem1 = new ListViewItem(list[y,x]);
        x++;
    }
    y++;
    x = 0;
} 
```

listViewItem1的名字该怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T17:54:06.447

只需遍历您创建的每个数组并创建一个新的 ListViewItem 对象（我相信有一个构造函数接受一个字符串数组）。将 ListViewItem 传递给 ListView.Items.Add() 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T18:02:58.437

您可以[使用 ado.net 加载 csv 文件](http://www.dotnetspider.com/resources/646-Handling-CSV-Files-ADO.aspx)并将其绑定到 datagrids 数据源。或者您可以使用[linq for xml](http://weblogs.asp.net/pleloup/archive/2008/04/12/linq-to-csv-library.aspx)来解析文件并将这些结果绑定到数据网格的数据源属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T18:16:56.860

我将使用[FileHelpers 库](http://filehelpers.sourceforge.net/)读取 CSV 文件，然后将集合 DataBind 到 ListView。

使用 DelimitedClassBuilder 动态创建 typeof(string) 等于源文件中的列数的列。

使用您创建的 RecordClass 将 CSV 文件加载到 DataTable 中，然后将 ListView.DataSource 设置为 DataTable。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T18:29:36.580

[Linq 转 CSV](http://www.codeproject.com/KB/linq/LINQtoCSV.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T18:47:26.817

您是否有不能使用 DataTable 的原因？使用它的 DataSource 成员。

另外，我希望您使用的是 String.Split 函数，而不是手动解析...

~S

# hardware - 如何更改解释的 Specman 会话的默认 *.elog 日志文件名？

> ID：163678
> 
> 赞同：1
> 
> 时间：2008-10-02T17:53:00.880
> 
> 标签：hardware, verification, specman

我希望能够在 Specman 测试中为日志文件指定文件名 stem。我需要对主要的 *.elog 文件名进行硬编码，以免测试之间出现差异并混淆后处理脚本。我可以将约束或命令行传递给 Specman 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-22T10:53:58.343

您还可以使用 specman 命令“set log”或使用以下代码。

```
extend sys
{
     run() is also {
          specman("set log specman.elog");
     };
}; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T19:24:24.657

您可以使用开关 -log 控制 *.elog 文件名。

# html - Ajax 与 Frames

> ID：163704
> 
> 赞同：1
> 
> 时间：2008-10-02T17:58:38.293
> 
> 标签：html, ajax, frames

鉴于当今大多数网站实际上是如何使用 ajax 的；为什么在框架仍然被认为是一个坏主意的情况下接受 ajax？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T18:05:24.533

AJAX，从我坐的地方来看，是一种重大的权衡。您正在破坏互联网的“文档”模型，以便您的站点可以表现得更像一个“应用程序”。如果一个站点很好地使用了 AJAx，它们会以微妙的方式破坏文档模型，从而为应用程序增加一些价值。“投票”链接并不是真正的链接，但它为您提供了一个很酷的动画并异步更新问题的状态。

框架对文档模型（书签、滚动、复制和粘贴等）的破坏程度与文档模型一样多，但没有那么多好处。框架还插入了我的操作系统/窗口管理器碰巧使用的任何装饰，所以它们看起来很丑。

如果操作正确，AJAX 对于使用屏幕阅读器、基于文本的浏览器等的人来说也会更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T18:20:06.337

框架的最大问题是可以深度链接到框架集之外的框架页面，并且书签很少按预期工作。当然，所有这些事情都有修复，但它们只会使本来就不是很好的系统变得更加笨拙和复杂。

正如我在别处所说的，Ajax 更多是将现代 javascript 带入主流并使其再次被接受，而不是使用 xmlhttp 对象（这实际上是术语 AJAX 的含义）。一旦您拥有一个接受甚至预期使用 javascript 的网站，您就可以用它做更多有趣的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T18:08:35.290

使用 Ajax，您可以将所有逻辑放入 javascript 代码中。这样您就可以创建或使用不依赖于您的页面的 javascript 库。如果您使用 iframe，现在您必须处理隐藏控件，并且您的大多数 javascript 代码都必须知道 iframe。

如果页面没有框架，搜索引擎也能更好地工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T18:11:49.260

Ajax 为您提供更精细的控制。您可以更新页面中的单个元素，其中 Frames 使您可以控制甚至不在同一个文档中的块。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T18:23:20.027

这里有两个简单的答案：

1) 仅仅使用 AJAX 这个词很酷，并且让你的项目听起来更像“Web 2.0”。框架并不性感。事实上，在网络术语中，框架是性感的对立面。

2) AJAX 具有前瞻性，即使以非标准或支持不佳的方式使用。恕我直言，与向后看的帧相比，即使以相同的方式向前移动也不太可能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T18:01:08.613

从可访问性的角度来看，Ajax 和框架完全不同（它们也是完全不同的句号）。框架提供的积极影响很小，但带来了许多负面问题。另一方面，Ajax 使用户界面更加动态，而在大多数情况下不会影响可用性。

# svn - 颠覆（乌龟）中的阁楼在哪里？

> ID：163707
> 
> 赞同：4
> 
> 时间：2008-10-02T17:58:52.503
> 
> 标签：svn, tortoisesvn

哎呀，我需要一些来自我不久前删除的文件的信息。在 CVS 中，我只会去 ATTIC 找到它，我如何在 SVN 中找到文件而不必回到它存在的修订版（特别烦人，因为我不知道我什么时候删除了 - 一周前，两周前……）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T18:03:06.923

浏览它所在目录的SVN日志，找到你删除它的修订版。在底部窗格中，右键单击该文件，然后选择“将修订版本保存到..”选项。

为了帮助您找到删除它的修订版本，请在显示日志的操作列中查找左下角带有 X 的文档图标。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T18:05:59.430

CVS 中的“阁楼”更多的是实现细节。该文件无法从存储库中*完全*删除，因为文件历史记录在 " `,v`" 文件本身中，因此 CVS 将其移到一边。

Subversion 使用更复杂的存储库存储机制，其中不需要以这种方式将文件移到一边。我不认为有一种简单的方法可以查询文件存在的最新版本，但是您应该能够使用“svn ls -r *rev* ”轻松找到它。在这种情况下， *rev*可以是 Subversion 接受的任何一个表示修订的东西——一个数字、一个日期等。只要回到历史直到找到它，然后向前走，直到找到它存在的最后一个修订。

更新：@AviewAnew 对检查文件所在目录的日志有一个好主意。由于文件删除实际上是对包含它的目录的更改，因此应该很容易找到文件以这种方式消失的位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T18:10:36.190

```
svn log --verbose 
```

将显示您删除的内容。然后你可以做一个

```
svn copy --revision <last_revision_with_deleted_file> 
```

获取已删除文件的工作副本。这应该不会比从 CVS 中获取已删除文件更难。

# c# - 从 API 获取 thrift 文件，并构建 .NET dll 文件

> ID：163711
> 
> 赞同：1
> 
> 时间：2008-10-02T17:59:36.807
> 
> 标签：c#, .net, thrift

我不知道如何为 C# 编译节俭文件。我读过“thrift 文件，然后可以将其编译为各种不同编程平台（Java、PHP、C/C++、Cocoa、Perl、C#、Ruby 等）的特定语言接口。”

我在看这里： http: [//www.markhneedham.com/blog/2008/08/29/c-thrift-examples/](http://www.markhneedham.com/blog/2008/08/29/c-thrift-examples/)就像我必须编译编译器，然后从提供的节俭文件构建 C# 版本.

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-17T23:55:39.253

是的，没错，您首先使用[Cygwin](http://www.cygwin.com/)环境编译 Win32 编译器，然后再使用该编译器创建 Thrift 语言接口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-08T00:19:19.067

[您可以从http://thrift.apache.org/download/](http://thrift.apache.org/download/)下载 thrift 编译器可执行文件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-10T15:01:23.400

我正在搜索你的问题，我发现[了这个有用的话题](http://www.robertsindall.co.uk/blog/how-to-generate-cassandra-0-8-1-thrift-api/)。愿这有帮助:)

# java - 哪个 Java 分析器更好：JProfiler 还是 YourKit？

> ID：163722
> 
> 赞同：62
> 
> 时间：2008-10-02T18:02:04.773
> 
> 标签：java, performance, jprofiler, yourkit

哪个分析器更适合通用分析和堆分析？我们 90% 的应用程序是具有大量数据库和数字处理的独立命令行程序。其他 10% 是 webapps/servlet 容器应用程序（只有很少的 JSP 并且没有 SCRIPLETS！）。目标用户是具有 5-10 年行业经验的高级软件工程师。我们只需要支持 Sun JDK 5 和。

在撰写此问题 (2008-10-02) 时，JProfiler 为 5.1.4，YourKit 为 7.5。看起来YourKit 8.0 即将发布。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-02T20:32:12.010

我使用过 JProfiler 4 和 YourKit 7.5，YourKit 胜出。它比 JProfile 侵入性要小得多，因为我很乐意在安装了 YourKit 代理的情况下运行生产服务器，而 JProfiler 永远不会这样做。

此外，YourKit 附带的分析工具更直观（在我看来），更容易找到问题的根本原因。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-02T18:20:10.223

如果您使用的是 jdk >=1.6_07，您可能还想查看捆绑的 jvisualvm。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-05-20T14:56:05.783

最近同时使用了 JProfiler 和 Yourkit，我发现 yourkit 在内存问题分析方面要优越得多，并且更喜欢 jprofiler 来进行性能分析。Yourkit 的内存分析似乎更容易和直观。对于 yourkit 的性能分析，我未能成功解决我尝试使用 yourkit 解决的任何性能问题。JProfiler 显示更准确、更简洁的性能分析信息，其中包含方法调用的确切数量和每个方法花费的时间百分比。我还没有在你的工具包中找到这个。似乎 yourkit 只提供不准确的采样信息，除非您测量数千次调用。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-20T11:19:28.263

除了 JXInsight 之外，没有任何工具执行真正的数据库事务分析：

[http://www.jinspired.com/products/jxinsight/concurrency.html](http://www.jinspired.com/products/jxinsight/concurrency.html) [http://www.jinspired.com/products/jxinsight/olapvsoltp.html](http://www.jinspired.com/products/jxinsight/olapvsoltp.html)

JXInsight 的 Probes 技术也是唯一可以在生产中运行的技术，因为我们在 SPECjvm2008 基准测试中的性能比 netbeans profiler 高 20 倍，yourkit 高 100 倍。

[http://blog.jinspired.com/?p=272](http://blog.jinspired.com/?p=272)

我是 JXInsight 的架构师，所以我当然完全有偏见，但同时我可能比 Java 行业的大多数人更有资格提出这样的要求，因为我在过去 8 年中一直致力于对一些最重要的性能分析在生产中对 Java/J2EE 应用程序的要求很高。

我应该指出，JXInsight 是为软件性能工程师设计的，而不仅仅是偶尔的临时分析会话。我们有超过 4000 多个系统属性来配置运行时和 600 多个技术扩展库，因此除非有一个复杂的问题需要解决和/或在开发、测试和生产中使用相同的工具，否则这可能是多余的。

亲切的问候，

威廉

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-03T04:32:20.297

我已经广泛使用了 JProbe、OptimizeIt 和 YourKit，它们都是功能强大的工具。在这 3 个中，我最喜欢的是 YourKit。

JProbe 中的一个杀手级功能是能够从 perf 快照移动到带注释的源（带有计数和计时）。我发现这非常有用。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-11-03T22:45:16.967

在 Java 7 Update 40 中，Oracle 包含了[Java 任务控制](http://www.oracle.com/technetwork/java/javase/2col/jmc-relnotes-2004763.html)（最初是 JRockit JDK 的一部分）——一个非常强大的性能调整工具，能够与 yourkit/jprofiler 竞争。

看看并感到惊讶。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-11-15T11:20:51.887

我都用过，我现在的投票肯定是 JProfiler（在当前版本 6 中），因为它更易于使用并且具有许多有用的附加功能。在以前的版本中，YourKit 在更大的快照方面有一些优势，但现在已经不复存在了。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-09-12T02:48:42.863

绝对是YourKit ...它能够打开4 gigs heap dump，只使用1g的堆。而具有相同堆分配的 Jprofiler 崩溃了！

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-02T20:18:57.253

我用过 yourkit，它是一个*非常*好的分析器，是我在 java 中用过的最好的（这些年来我用过很多其他的）。话虽如此，我从未使用过jprofiler，所以我无法直接比较。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-02T18:41:12.713

对于命令行程序的快速而肮脏的分析，[JIP](http://sourceforge.net/projects/jiprof)工作得非常好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T22:02:13.777

免责声明：替代答案。

他们有各种用于生产监控/分析的产品，不像其他主要的开发时间工具：[http](http://www.jinspired.com/products/jxinsight/)
://www.jinspired.com/products/jxinsight/ JDBInsight 服务器端的这篇文章：[http ://www.theserverside.com/news/thread .tss?thread_id=13488](http://www.theserverside.com/news/thread.tss?thread_id=13488)

免责声明：我与这家公司没有任何级别的联系。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-03T19:02:44.963

YourKit 很棒。您可能还想查看 NetBeans 中内置的分析器——它非常酷。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-03T03:49:18.357

我用过YourKit。我没有使用过 JProfiler。我以前用过OptimizeIt。我对 YourKit 有很好的看法。它非常稳定、良好的 GUI 和良好的功能列表。我注意到的一项独特功能是 CPU 分析有无等待时间（如 I/O wais），包括。

它的价格也非常合理（我认为 5 个许可证约 1100 美元）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-02T20:26:25.737

多年来一直使用 JProfiler，对此非常满意。IntelliJ 似乎在 YourKit 和 JProfiler 之间来回切换他们的推荐，所以我猜他们的功能集是相似的。我相信他们都有试用版。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-10T15:15:51.240

Yourkit 开销低、稳定、易于安装在 JVM 上进行分析（只需一个 dll）且功能强大。对于分析堆转储，它是唯一接近[Eclipse Memory Analyzer](http://www.eclipse.org/mat/)的分析器。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-02T21:49:29.830

+1 for yourkit --- 在 Windows 中的开发盒上使用 7.0
有一段时间没有使用 JProfiler --- 无法评论，因为它们可能在此期间有所改进。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-06-14T10:30:48.003

I am using JProfiler and find it overall OK. It's "dynamical instrumentation" feature is terribly biased for small methods, though.

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-02T18:58:39.833

我只使用过 JProfiler（和一些 JProbe）。据我所知，YourKit 的一个限制是它们似乎不支持 JDK 1.4.2。这对很多人来说不是问题，但可能是。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-02T22:15:02.233

顺便说一句，您可能需要考虑 Netbeans 分析器——它非常好。但我没有使用过你提到的两个。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-09-01T16:07:51.333

我正在使用 TPTP 分析器。它的最佳特性是可以很容易地集成到 Eclipse 中，但不好的是它会使 Eclipse 运行速度变慢。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-01-13T07:55:32.740

绝对是 YourKit。最直观最稳定！

# maven-2 - maven-buildnumber-插件

> ID：163727
> 
> 赞同：2
> 
> 时间：2008-10-02T18:03:12.167
> 
> 标签：maven-2, maven-plugin

我使用 maven-buildnumber-plugin 为 JAR/WAR/EAR 包生成我的版本号。因此，在进行编译时，我会得到例如 ${project.version}-${buildNumber}，因为设置为此值。但是当使用 mvn deploy 只是 ${project.version} 是文件名，当我在 pom.xml 中设置为 XX ${buildNumber} 然后文件名是文件-XXX ${buildNumber} （<-不是buildNumber的内容，而是 ${buildNumber 作为测试}）。我做错了什么？我还希望使用 ${project.version} ${buildNumber} 安装文件。

谢谢任何帮助

马库斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T16:17:39.983

不是 100% 确定我遵循了您的问题，但是在我的 WAR 清单中获取内部版本号时遇到了问题。[这里](http://jira.codehaus.org/browse/MOJO-993)的讨论帮助了我。我必须创建一个名为 build.version 的全局属性

```
<properties>
    <build.version>${project.version}-r${buildNumber}</build.version>
</properties> 
```

并使用它而不是直接使用 ${buildNumber} 。希望这会对您的问题有所帮助。

# c# - 为一组唯一整数推荐的 .NET 类？

> ID：163732
> 
> 赞同：9
> 
> 时间：2008-10-02T18:04:53.240
> 
> 标签：c#, .net

对于需要保留唯一整数列表的课程，您会推荐什么？

我将要向集合添加（）整数并检查是否存在，例如包含（）。

也可以将它们作为字符串显示在列表中，即。“1、5、10、21”。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-02T18:06:28.337

[哈希集](http://msdn.microsoft.com/en-us/library/bb359438.aspx)：

> 该类`HashSet<T>`提供高性能的集合操作。集合是不包含重复元素的集合，其元素没有特定的顺序......
> 
> 对象的容量`HashSet<T>`是对象可以容纳的元素的数量。`HashSet<T>`随着元素添加到对象中，对象的容量会自动增加。
> 
> 该类基于数学集合模型，并提供类似于访问or集合`HashSet<T>`的键的高性能集合操作。简单来说，类可以被认为是一个没有值的集合。[`Dictionary<TKey, TValue>`](https://msdn.microsoft.com/en-us/library/xfhwa508.aspx)[`Hashtable`](https://msdn.microsoft.com/en-us/library/system.collections.hashtable.aspx)`HashSet<T>`[`Dictionary<TKey, TValue>`](https://msdn.microsoft.com/en-us/library/xfhwa508.aspx)
> 
> 集合`HashSet<T>`未排序且不能包含重复元素...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T18:46:46.600

在我的测试中，我发现在处理非常大的数据集（在我的情况下为 100,000+）时，具有虚拟值的 Dictionary 比 HashSet 更快。我希望这是因为 Dictionary 允许您设置初始容量，但我真的不知道。在您描述的情况下，如果我期待大量数字，我可能会使用字典，然后（或者当我添加到字典时，取决于意图）使用字符串生成器对其进行迭代，创建输出字符串。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T18:17:02.837

如果你不能使用 .NET 3.5，那么你就不能使用 HashSet。如果是这种情况，很容易根据 Dictionary 结构自行推出。

```
public class Set<T> {
    private class Unit { ... no behavior }
    private Dictionary<T, Unit> d;

....
} 
```

Unit 旨在成为一种只有一个值的类型。*将元素映射到*什么并不重要，只需使用键来了解集合中的内容。您在问题中要求的操作很容易实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T18:23:12.757

你可以从 KeyedCollection 继承一个类。这样，您的键可以是值本身，您可以覆盖 ToString 以便获得所需的输出。这可以给你你想要/需要的行为。

请注意，此答案适用于 Q 的框架 2.0 部分

# asp.net - ASP.NET 项目大小

> ID：163740
> 
> 赞同：4
> 
> 时间：2008-10-02T18:06:36.120
> 
> 标签：asp.net, visual-studio

关于 ASP.NET 项目中有多少“页面”，是否存在任何已知问题？

项目创建的 DLL 的大小是否重要？

我现有的项目大约有 150 页，DLL 只有大约 3MB，但最近从大约 50 页和 0.5 MB 增加

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T21:03:40.500

[Scott Hanselman](http://www.hanselman.com/blog/WhatsTheUpperLimitOnTheNumberOfProjectsWithinVS2005.aspx)两年前开始讨论这个话题。

绝对限制是您的系统内存。项目越大，它使用的内存就越多。

当然你可以留在一个 [50-200] 个项目中的一个解决方案中。

如果您发现您的 Visual Studio 占用的内存超出预期，请开始考虑拆分您的项目。

在我看来，最好的办法是将项目规模作为设计要求。

**编辑**：我并没有真正回答你的问题。说清楚。VS2003、VS2005 或 VS2008 解决方案中的元素（页面、项目、图像、引用等）越多，Visual Studio 占用的内存就越多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T18:09:13.680

对于多达数百页的网站，我没有遇到任何问题。我们谈论的网站有多大？页面之间是否存在可以通过使用单个页面获取参数来解决的内置冗余？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T18:13:17.040

通常，将较大站点或项目的子部分分解为多个 ASP.NET Web 项目是有意义的。这使得网站更加模块化。此外，如果您有在整个站点中使用的通用控件，这通常会导致项目只有这些控件。

然而，为了直接解决这个问题，我管理的项目有很多很多页面并且没有问题......除了浏览和开发它变得“有趣”之外。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T18:28:36.693

从技术上讲，您可以在 Web 应用程序项目中拥有数百个（我敢说是数千个）“页面”。

尽管如此，Russell 所说的将其分解为模块，可能会使其更易于维护。

有限制吗？不。您是否应该组织您的项目以使其更易于管理？是的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T18:32:31.597

除非您尝试调试它（或关闭批处理编译），否则无需担心。或者，如果您有一堆文件夹。每个文件夹将有一个 DLL 用于所有打开批处理的文件。所以如果你把东西分成一堆文件夹，那可能会导致进程内存的碎片问题。否则，很多页面都没有问题。

# java - JNI 的 Autoconf 测试包括目录

> ID：163747
> 
> 赞同：5
> 
> 时间：2008-10-02T18:08:35.493
> 
> 标签：java, java-native-interface, autoconf

我正在为 JNI 包装器编写配置脚本。配置参数之一是`jni.h`. 对于 C++ 编译是否正确设置了这个参数，什么是一个好的快速和肮脏的 Autoconf 测试？您可以假设您在 Linux 上运行并且`g++`可用。

或者，有没有办法让`javah`（或支持工具）直接给我这条路？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-06-27T09:00:19.767

然后是简单的方法：[http ://www.gnu.org/software/autoconf-archive/ax_jni_include_dir.html](http://www.gnu.org/software/autoconf-archive/ax_jni_include_dir.html)

有时最好只使用标准食谱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T19:08:41.230

检查标题很容易；只需使用`AC_CHECK_HEADER`. 如果它位于一个奇怪的地方（即编译器不知道的地方），那么期望用户设置`CPPFLAGS`.

困难的部分实际上是定位`libjvm`。您通常不想与此链接；`dlopen`但如果`JAVA_HOME`在运行时未设置，您可能希望默认为它的位置。

但我没有比要求`JAVA_HOME`在配置时设置更好的解决方案。在各种操作系统（甚至只是 Linux 发行版）中部署这些东西的方式差异太大。这就是我所做的：

```
AC_CHECK_HEADER([jni.h], [have_jni=yes])
AC_ARG_VAR([JAVA_HOME], [Java Runtime Environment (JRE) location])
AC_ARG_ENABLE([java-feature],
              [AC_HELP_STRING([--disable-java-feature],
                              [disable Java feature])])
case $target_cpu in
     x86_64) JVM_ARCH=amd64 ;;
     i?86)   JVM_ARCH=i386 ;;
     *)      JVM_ARCH=$target_cpu ;;
esac
AC_SUBST([JVM_ARCH])
AS_IF([test X$enable_java_feature != Xno],
[AS_IF([test X$have_jni != Xyes],
       [AC_MSG_FAILURE([The Java Native Interface is required for Java feature.])])
AS_IF([test -z "$JAVA_HOME"],
[AC_MSG_WARN([JAVA_HOME has not been set.  JAVA_HOME must be set at run time to locate libjvm.])],
[save_LDFLAGS=$LDFLAGS
LDFLAGS="-L$JAVA_HOME/lib/$JVM_ARCH/client -L$JAVA_HOME/lib/$JVM_ARCH/server $LDFLAGS"
AC_CHECK_LIB([jvm], [JNI_CreateJavaVM], [LIBS=$LIBS],
             [AC_MSG_WARN([no libjvm found at JAVA_HOME])])
LDFLAGS=$save_LDFLAGS
])]) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-12-20T03:52:36.143

仅供参考 - 下面针对最新 ax_jni_include_dir.m4 的补丁适用于 Macos 11.1。

```
--- a/m4/ax_jni_include_dir.m4
+++ b/m4/ax_jni_include_dir.m4
@@ -73,13 +73,19 @@ fi

 case "$host_os" in
         darwin*)        # Apple Java headers are inside the Xcode bundle.
-            macos_version=$(sw_vers -productVersion | sed -n -e 's/^@<:@0-9@:>@
*.\(@<:@0-9@:>@*\).@<:@0-9@:>@*/\1/p')
-            if @<:@ "$macos_version" -gt "7" @:>@; then
-                _JTOPDIR="$(xcrun --show-sdk-path)/System/Library/Frameworks/JavaVM.framework"
-                _JINC="$_JTOPDIR/Headers"
+            major_macos_version=$(sw_vers -productVersion | sed -n -e 's/^\(@<:@0-9@:>@*\).@<:@0-9@:>@*.@<:@0-9@:>@*/\1/p')
+            if @<:@ "$major_macos_version" -gt "10" @:>@; then
+                _JTOPDIR="$(/usr/libexec/java_home)"
+                _JINC="$_JTOPDIR/include"
             else
-                _JTOPDIR="/System/Library/Frameworks/JavaVM.framework"
-                _JINC="$_JTOPDIR/Headers"
+                macos_version=$(sw_vers -productVersion | sed -n -e 's/^@<:@0-9@:>@*.\(@<:@0-9@:>@*\).@<:@0-9@:>@*/\1/p')
+                if @<:@ "$macos_version" -gt "7" @:>@; then
+                    _JTOPDIR="$(xcrun --show-sdk-path)/System/Library/Frameworks/JavaVM.framework"
+                    _JINC="$_JTOPDIR/Headers"
+                else
+                    _JTOPDIR="/System/Library/Frameworks/JavaVM.framework"
+                    _JINC="$_JTOPDIR/Headers"
+                fi
             fi
             ;;
         *) _JINC="$_JTOPDIR/include";; 
```

# c# - COM 注册和 GAC

> ID：163748
> 
> 赞同：2
> 
> 时间：2008-10-02T18:08:36.240
> 
> 标签：c#, com, visual-studio-2005, installation, gac

我在 Visual Studio 2005 中有一个 Web 项目、一个 C# 库项目和一个 Web 设置项目。该 Web 项目需要 C# 库需要在 GAC 中注册。这很简单，只需将 GAC 文件夹添加到安装项目并将 C# 库的主要输出放在那里。C# 库还需要为 COM 互操作注册。我单击选择 GAC 文件夹中的主输出并将 Register 属性更改为 vsdrpCOM。我构建了安装项目并运行它，但 DLL 从未为 COM 注册。

这对我来说并不奇怪。我总是必须添加一个安装程序类，它有一个自定义操作，它使用 RegistrationServices.RegisterAssembly 正确注册我的 COM DLL。因此，我将多年来接受的这种解决方法应用于我的情况。现在，我发现在安装项目的 GAC 文件夹中分配给主要输出的自定义操作甚至会阻止安装项目的构建。

我一直觉得我在破解 .NET 和 COM 以更好地处理设置和部署项目。解决我的问题的正确方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T20:23:20.753

要使用 COM 注册程序集，请使用：regasm /codebase。有关详细信息，请参阅：http: [//msdn.microsoft.com/en-us/library/tzat5yw6](http://msdn.microsoft.com/en-us/library/tzat5yw6(VS.80).aspx) (VS.80).aspx 。您安装到 GAC 的方法对我来说似乎很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T21:34:19.367

我不知道“正确”的方式，但我的团队用批处理文件解决了这个问题。我们将该文件称为“cycleCOM.bat”之类的文件，并在需要更新 GAC 和组件服务时在构建后运行它。（我个人使用键盘启动器，所以我可以通过几个按键来触发它）

这是批处理文件的超级简化视图：

```
REM Unregister anything currently in component services

RemoveCom+.vbs

C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\regsvcs /u "C:\source\bin\FooCode.dll"

REM Remove from GAC

"C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\Bin\gacutil" /uf FooCode

REM Register in component services

C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\regsvcs "C:\source\bin\FooCode.dll"

REM Add to GAC

"C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\Bin\gacutil" /if "C:\source\bin\FooCode.dll" 
```

RemoveCom+.vbs 文件关闭在组件服务中运行的任何东西。它的代码是：

```
set cat = CreateObject ("COMAdmin.COMAdminCatalog")
Set apps = cat.GetCollection("Applications")

bFound = false
apps.Populate

lNumApps = apps.Count

' Enumerate through applications looking for AppName.
Dim app
For I = lNumApps - 1 to 0 step -1
    Set app = apps.Item(I)
    If app.Name = "FooCode" Then
      cat.ShutdownApplication ("FooCode")
      apps.Remove(I)
      apps.SaveChanges
    End If
Next 
```

对于我们在本地处理的应用程序的每个版本，我们都有这个脚本的多个版本，这些脚本使保持 GAC 和 COM+ 与正在编辑的代码版本保持同步变得很容易（好吧，尽可能容易） .

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T18:27:49.673

WIX，将允许您在 GAC 中轻松安装您的 COM 对象和程序集

[威克斯](http://sourceforge.net/projects/wix)

# delegates - 如何在 C++/CLI 中使用 boost::bind 绑定托管类的成员

> ID：163757
> 
> 赞同：11
> 
> 时间：2008-10-02T18:10:37.517
> 
> 标签：delegates, c++-cli, boost-bind, boost-signals

我在本机 C++ 类中使用 boost::signal，现在我正在 C++/CLI 中编写一个 .NET 包装器，以便我可以将本机 C++ 回调公开为 .NET 事件。当我尝试使用 boost::bind 获取托管类的成员函数的地址时，我收到编译器错误 3374，说除非我创建委托实例，否则我无法获取成员函数的地址。有谁知道如何使用 boost::bind 绑定托管类的成员函数？

为澄清起见，以下示例代码会导致编译器错误 3374：

```
#include <boost/bind.hpp>

public ref class Managed
{
public:
    Managed()
    {
        boost::bind(&Managed::OnSomeEvent, this);
    }

    void OnSomeEvent(void)
    {
    }
}; 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-31T21:17:40.720

虽然您的答案有效，但它会将您的一些实现暴露给世界（Managed::OnSomeEvent）。如果您不希望人们能够通过调用 OnSomeEvent() 来引发 OnChange 事件，您可以按如下方式更新您的 Managed 类（基于[此建议](http://msdn.microsoft.com/en-us/library/367eeye0(VS.80).aspx)）：

```
public delegate void ChangeHandler(void);
typedef void (__stdcall *ChangeCallback)(void);

public ref class Managed
{
public:
    Managed(Native* Nat);
    ~Managed();

    event ChangeHandler^ OnChange;

private:
    void OnSomeEvent(void);
    Native* native;
    Callback* callback;
    GCHandle gch;
};

Managed::Managed(Native* Nat)
 : native(Nat)
{
    callback = new Callback;

    ChangeHandler^ handler = gcnew ChangeHandler( this, &Managed::OnSomeEvent );
    gch = GCHandle::Alloc( handler );
    System::IntPtr ip = Marshal::GetFunctionPointerForDelegate( handler );
    ChangeCallback cbFunc = static_cast<ChangeCallback>( ip.ToPointer() );

    *callback = native->RegisterCallback(boost::bind<void>( cbFunc ) );
}

Managed::~Managed()
{
    native->UnregisterCallback(*callback);
    delete callback;
    if ( gch.IsAllocated )
    {
        gch.Free();
    }
}

void Managed::OnSomeEvent(void)
{
    OnChange();
} 
```

请注意使用的替代`bind<R>()`形式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T01:44:09.843

在谷歌上搜索了一些之后，我终于找到了一篇关于如何做到这一点的[不错的博客文章。](http://mr-sharpoblunto.junkship.org/2007/11/mapping-boostsignals-to-net-events.html)那篇文章中的代码比我需要的要多一点，但主要的核心是使用一个全局自由函数，该函数接受一个包含在 gcroot<> 模板中的托管 this 指针的参数。有关示例，请参见下面代码中的**SomeEventProxy(...)**。然后这个函数转过来调用我试图绑定的托管成员。我的解决方案如下所示，以供将来参考。

```
#include <msclr/marshal.h>

#include <boost/bind.hpp>
#include <boost/signal.hpp>
#include <iostream>

#using <mscorlib.dll>

using namespace System;
using namespace msclr::interop;

typedef boost::signal<void (void)> ChangedSignal;
typedef boost::signal<void (void)>::slot_function_type ChangedSignalCB;
typedef boost::signals::connection  Callback;

class Native
{
public:

    void ChangeIt() 
    {
        changed();
    }

    Callback RegisterCallback(ChangedSignalCB Subscriber)
    {
        return changed.connect(Subscriber);
    }

    void UnregisterCallback(Callback CB)
    {
        changed.disconnect(CB);
    }

private:
    ChangedSignal changed;
};

delegate void ChangeHandler(void);

public ref class Managed
{
public:
    Managed(Native* Nat);
    ~Managed();
    void OnSomeEvent(void);

    event ChangeHandler^ OnChange;

private:
    Native* native;
    Callback* callback;
};

void SomeEventProxy(gcroot<Managed^> This)
{
    This->OnSomeEvent();
}

Managed::Managed(Native* Nat)
 : native(Nat)
{
    native = Nat;
    callback = new Callback;
    *callback = native->RegisterCallback(boost::bind( SomeEventProxy, gcroot<Managed^>(this) ) );
}

Managed::~Managed()
{
    native->UnregisterCallback(*callback);
    delete callback;
}

void Managed::OnSomeEvent(void)
{
    OnChange();
}

void OnChanged(void)
{
    Console::WriteLine("Got it!");
}

int main(array<System::String ^> ^args)
{
    Native* native = new Native;
    Managed^ managed = gcnew Managed(native);

    managed->OnChange += gcnew ChangeHandler(OnChanged);

    native->ChangeIt();

    delete native;
    return 0;
} 
```

# winforms - 通用 GDI+ 错误

> ID：163760
> 
> 赞同：0
> 
> 时间：2008-10-02T18:11:35.780
> 
> 标签：winforms, multithreading, .net-3.5

我有一个表单正在从另一个线程上的另一个表单启动。大多数时候它工作得很好，但我不时收到以下错误。任何人都可以帮忙吗？

```
at System.Drawing.Bitmap..ctor(Int32 width, Int32 height, PixelFormat format)
at System.Drawing.Bitmap..ctor(Int32 width, Int32 height)
at System.Drawing.Icon.ToBitmap()
at System.Windows.Forms.ThreadExceptionDialog..ctor(Exception t)
at System.Windows.Forms.Application.ThreadContext.OnThreadException(Exception t)
at System.Windows.Forms.Control.WndProcException(Exception e)
at System.Windows.Forms.Control.ControlNativeWindow.OnThreadException(Exception e)
at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)    
at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG& msg)
at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)
at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)    
at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)    
at System.Windows.Forms.Form.ShowDialog(IWin32Window owner)    
at System.Windows.Forms.Form.ShowDialog() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-06T18:46:00.237

用户必须能够同时查看多个打开的帐户，对吗？所以你需要一个表单的多个实例？

除非我误读了某些内容，否则我认为您在这种情况下不需要线程，因此我认为您只是将自己介绍给一个受伤的世界（例如这些例外）。

假设您的帐户表单称为 AccountForm，我会这样做：

```
Dim acctForm As New AccountForm()
acctForm.Show() 
```

（当然你会有自己的逻辑......）我什至可以把它放在`ShowForm`方法中，这样我就可以更新我的调用者：

```
ShowForm() 
```

并完成。现在所有这些都假设您已经很好地封装了 AccountForm，以便每个实例都有自己的数据，并且它们不会在实例之间共享任何内容。

为此使用线程不仅是矫枉过正，而且可能会引入错误，例如顶部的异常。而且我在调试多线程 WinForms 应用程序方面的经验表明，这些错误通常很难复制，而且很难找到和修复。通常，最好的解决方法是不要使用多线程，除非您绝对**必须这样**做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T18:23:07.813

你能详细说明你想在这里做什么吗？如果您尝试从与 UI 线程不同的线程显示表单，请参考以下问题： [我的表单在从另一个线程启动时无法正确显示](https://stackoverflow.com/questions/160555/my-form-doesnt-properly-display-when-it-is-launched-from-another-thread)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T14:35:11.493

该应用程序是一个探索型客户管理系统。帐户表单从单独的后台线程上的“主”资源管理器表单启动。我们这样做是因为用户需要能够同时打开多个帐户。

我们使用以下代码启动表单：

```
Thread = New Thread(AddressOf ShowForm)
Thread.SetApartmentState(ApartmentState.STA)
Thread.IsBackground = True 
```

# javascript - QuickTime 对象的 SetURL 方法未定义？

> ID：163761
> 
> 赞同：0
> 
> 时间：2008-10-02T18:11:45.890
> 
> 标签：javascript, quicktime

我的页面上有一个隐藏的嵌入式 QuickTime 对象，我试图通过 JavaScript 控制它，但它不起作用。该对象如下所示：

```
<object id="myPlayer" data="" type="audio/mpeg" pluginspage="http://www.apple.com/quicktime/download" width="0" height="0">
    <param name="autoPlay" value="false" />
    <param name="controller" value="false" />
    <param name="enablejavascript" value="true" />
</object> 
```

data 参数中没有任何内容，因为在渲染时，我不知道要加载的 URL。我这样设置：

```
var player = document.getElementById("myPlayer");
player.SetURL(url); 
```

稍后将播放音频：

```
player.Play(); 
```

Firefox 3.0.3 在 JavaScript 控制台中不会产生错误，但`Play()`调用时不会发生播放。Safari 3.0.4 在控制台中产生以下错误：

```
"Value undefined (result of expression player.SetURL) is not object." 
```

Internet Explorer 7.0.5730.11 提供了以下非常有用的错误消息：

```
"Unspecified error." 
```

我的机器上安装了 QuickTime 7.4 版。[Apple 的文档](http://developer.apple.com/documentation/QuickTime/Conceptual/QTScripting_JavaScript/bQTScripting_JavaScri_Document/chapter_1000_section_5.html)说这`SetURL()`是正确的，那么为什么它不起作用呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T05:26:00.780

当您尝试通过 JavaScript 与插件通信时，尝试为对象元素提供一些宽度和高度（1px x 1px）并使其在视口中可见。

我注意到如果插件区域在屏幕上不可见，则它对 JS 命令没有响应。

这可以解释为什么这在 IE 中不适合您。

Safari and Opera should work, but FireFox will definitely require the Netscape style embed element, and really you should provide both. Additionally, once you have both, you need to ascertain which element (the object versus the embed) to address in which browser.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T22:04:35.313

我不知道 QuickTime API，但这可能值得一试：

```
player.attributes.getNamedItem('data').value = 'http://yoururlhere'; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T22:06:19.037

您链接到的页面未提及“数据”属性。他们在一个 OBJECT 中有一个 EMBED 和 PARAM，其中 EMBED 的 'src' 属性具有 url，但我在您发布的内容中没有看到 EMBED。

# wpf - 是否有适用于 WPF 的良好 iTunes 封面流类型控件？

> ID：163775
> 
> 赞同：6
> 
> 时间：2008-10-02T18:15:15.007
> 
> 标签：wpf

我目前正在使用 Telerik 的轮播控件，但它缺少许多功能并且有问题。是否有一个很好的控件可以在 iTunes 中看起来像 Coverflow 控件？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-06-11T08:43:27.357

## [WPF 封面流教程](http://d3dal3.blogspot.com/2008/10/wpf-cover-flow-tutorial-part-1.html)

![在此处输入图像描述](https://i.stack.imgur.com/7zhP2.png)

源代码：[第 7 部分](http://d3dal3.blogspot.com/2009/04/wpf-cover-flow-tutorial-part-7-source.html)，[下载](http://philippe.vianney.free.fr/blogger/WPFCoverFlowTutorialPart7.zip)

作者对内存泄漏声明的反驳（事实并非如此）：[第 8 部分](http://d3dal3.blogspot.com/2010/06/wpf-cover-flow-tutorial-part-8.html)

在行动：[视频](http://www.youtube.com/user/d3dal3)

包含构建覆盖流控件的详细演练，包括反射等功能。我编译并尝试了它并将其指向包含数百个小图像的目录（您需要编辑 TestWindow.xaml.cs 以指向包含 jpg 的目录），动画的性能和流畅度给我留下了深刻的印象。

我注意到使用非常大的图像会降低性能，因此我建议使用仅显示所需大小的图像。例如，当指向我的桌面背景图像目录时，在按下箭头键和项目完成过渡后有将近一秒的延迟（虽然动画本身仍然是流畅的，但需要一点时间才能开始）。

这是我找到的最好的，因为我一直在寻找 - 即非商业、反射和流畅的动画。不过，我确实查看了其他答案中当前提到的其他问题，以下是对它们的一些评论（排名不分先后）：

[FluidKit 的 ElementFlow](http://fluidkit.codeplex.com/)

![FluidKit 的 ElementFlow](https://i.stack.imgur.com/l0qIa.png)

*   开源，我用的是最新的源代码，但没有尝试任何补丁
*   动画很流畅
*   过渡感觉不是很精致，图片以一种奇怪的方式相互剪辑
*   似乎不适合同时在屏幕上显示一些元素，它试图显示所有内容，并且从一些讨论评论来看，显然没有虚拟化
*   通过提供的按钮将一些图像添加到演示后，其中很大一部分似乎无法被选中
*   没有反射

[Mindscape CoverFlow](http://www.mindscapehq.com/demo/WpfElements/coverflow/CoverFlowDemoXbap.xbap)

![Mindscape CoverFlow](https://i.stack.imgur.com/cKmPa.png)

*   商业的
*   动画很流畅
*   不会“弹出”选定的项目，感觉很 2D
*   有反射

[DevExpress 轮播](http://www.devexpress.com/Products/NET/Controls/WPF/Carousel/dependency_properties.xml)

![在此处输入图像描述](https://i.stack.imgur.com/knClT.jpg)

*   商业的
*   没有在线演示，我也没有尝试获得试用版，虽然看起来很精致

[Telerik 旋转木马](http://www.telerik.com/products/wpf/carousel.aspx)

![Telerik 旋转木马](https://i.stack.imgur.com/Xxnh4.png)

*   商业的
*   动画很流畅
*   过渡让我不太满意，新照片穿过旧照片
*   没有反射

[Xceed Cardflow 3D](http://xceed.com/3DViews_WPF_Intro.html)

![Xceed Cardflow 3D](https://i.stack.imgur.com/wxwHB.png)

*   商业版（仅限专业版）
*   动画很流畅，如果你走得快，它会显示空白卡片加速经过，然后在你减速时淡入卡片上的实际数据
*   支持翻转所选项目，如在 iTunes 中
*   有反射

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-02T19:36:28.090

ElementFlow 控件位于名为[FluidKit](http://www.codeplex.com/fluidkit)的 codeplex 项目中- 可从[此处下载](http://www.codeplex.com/fluidkit)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T19:22:10.743

有关控件的更多详细信息 - [Pavan 博客上的 ElementFlow 控件](http://pavanpodila.spaces.live.com/blog/cns!9C9E888164859398!380.entry)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-25T00:30:07.953

Mindscape 现在提供商业[WPF Coverflow](http://www.mindscape.co.nz/products/WpfElements/controls/Coverflow.aspx)控件作为其 WPF Elements 控件包的一部分，这也可能有用。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-05-21T04:45:57.983

[http://www.telerik.com/products/wpf/carousel.aspx](http://www.telerik.com/products/wpf/carousel.aspx) [http://www.devexpress.com/Products/NET/Controls/WPF/Carousel/dependency_properties.xml](http://www.devexpress.com/Products/NET/Controls/WPF/Carousel/dependency_properties.xml)

这两者都比您的普通封面流克隆更通用（尽管如果您愿意，它们也可以轻松做到这一点）。我会推荐 Telerik 远高于 DevExpress，因为 WPF 仍然是一项相对不成熟的技术，而 DevExpress 在跟上技术游戏方面非常差（尽管他们承诺“指日可待”，但他们只发布了支持 VS2010 的 DXperience 套件版本“自一月初以来，Telerik、ComponentOne 等都跟上了当前的技术。对于企业来说还不够好）。

# flash - ActionScript 3 可视化中的可滚动区域

> ID：163778
> 
> 赞同：0
> 
> 时间：2008-10-02T18:15:33.323
> 
> 标签：flash, actionscript-3, mxml, scrollbars

在扩展 flash.display.Sprite 并利用低级 DisplayObjects（Sprite'a、Shape's、TextField）的层次结构的 ActionScript 3 可视化中创建多个可滚动区域的最佳方法是什么？

我尝试使用三个 mx.containers.Canvas 对象作为主 Sprite 的子对象添加，并且还尝试将主 Sprite 转换为 Canvas，但使用任何一种方法都无法显示任何内容。我还尝试使用 Canvas.addChild 和 Canvas.rawChildren.addChild 添加我的 DisplayObject。

是否有必要/可能重写整个事物以使用 mx.* 组件，或者是否有技巧在 Canvas 对象内显示更多原始对象？

以下是使用精灵的工作方式的一些示例代码。我们想让 _colSprite、_rowSprite 和 _mapSprite 与链接的滚动条一起滚动。当我将它们转换为 Canvas 对象时，代码会在绘制任何显示对象之前静默挂起（如果我没记错的话，在 addChild 行）。

下面是代码的摘录。这一切都来自扩展 sprite 的单个动作脚本类。

设置我希望滚动的三个区域：

```
this._log("Creating Sprites"); 

                this._colSprite = new Sprite();

                this._colSprite.y=0;

                this._colSprite.x=this._rowLabelWidth + this._rowLabelRightPadding + this._horizontalPadding;

this._rowSprite = new Sprite();

                this._rowSprite.y=this._columnLabelHeight+this._columnLabelBottomPadding + this._verticalPadding;

                this._rowSprite.x=this._horizontalPadding;

                this._mapSprite = new Sprite();

                this._mapSprite.y=this._columnLabelHeight+this._columnLabelBottomPadding+ this._verticalPadding;

                this._mapSprite.x=this._rowLabelWidth + this._rowLabelRightPadding+this._horizontalPadding;

                    this._log("adding kids"); 

addChild(this._mapSprite);

addChild(this._rowSprite);

addChild(this._colSprite); 
```

样品绘制功能：

```
 private function _drawColumLabels(colStartIndex: int): void {

        for (var col : int = colStartIndex; col < myData.g.length; col++) {

            var colName : String = this.myData.g[col].label;

            var bottomLeftPoint : Object = this._getCellXYTopLeft(0, col);

            bottomLeftPoint.y = this._columnLabelHeight + this._verticalPadding;

            var centerX : int = Math.round(this._cellWidth / 2 + (this._fontHeight / 2) - 1);

            var colLabel : TextField = new TextField();

                colLabel.defaultTextFormat = this._labelTextFormat;

                colLabel.width = this._columnLabelHeight+this._columnLabelBottomPadding;

                colLabel.text = colName;                

                colLabel.embedFonts = true;

                var colSprite : Sprite = new Sprite();

                colSprite.addChild(colLabel);

                colSprite.x = bottomLeftPoint.x;

                colSprite.y = bottomLeftPoint.y;

                colSprite.rotation = -45;

                this._colSprite.addChild(colSprite);

        }

    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T18:29:54.410

将孩子添加到每个 Canvas 后，您可能需要调用 Canvas.invalidateSize() （在每个 Canvas 上）以让他们重新计算其大小。

是否需要这样做取决于您在组件生命周期中的哪个阶段添加子项 - 即当您调用“_drawColumLabels”时。

我想如果 _colSprite（和 _rowSprite）中的标签多于可见区域中显示的标签，您希望 scollbar 出现在 _colSprite（和 _rowSprite）上？如果是这种情况，您将需要使用 Sprite 以外的其他东西，例如 Canvas，因为 Sprite 不支持滚动。

您可能还想调试每个组件的 x/y/width/height 值，以确保它们符合您的期望 - 我发现对布局很有帮助的是在纸上绘制布局并开始写尺寸和坐标这样我就可以看到我的计算是正确的。

# algorithm - 对日志进行快速文本搜索

> ID：163783
> 
> 赞同：8
> 
> 时间：2008-10-02T18:16:34.193
> 
> 标签：algorithm, search, full-text-search, scalability

这是我遇到的问题，我有一组可以很快增长的日志。它们每天都被拆分成单独的文件，并且这些文件可以很容易地增长到一个演出的大小。为了帮助缩小规模，超过 30 天左右的条目将被清除。

问题是当我想在这些文件中搜索某个字符串时。现在，Boyer-Moore 搜索速度慢得令人难以置信。我知道像 dtSearch 这样的应用程序可以使用索引提供非常快速的搜索，但我不确定如何在不占用日志已经占用两倍空间的情况下实现它。

有什么我可以查看的资源可以提供帮助吗？我真的在寻找一种标准算法，它可以解释我应该做什么来构建索引并使用它来搜索。

编辑：
Grep 不起作用，因为此搜索需要集成到跨平台应用程序中。我无法将任何外部程序加入其中。

它的工作方式是有一个带有日志浏览器的 Web 前端。这与自定义 C++ Web 服务器后端对话。该服务器需要在合理的时间内搜索日志。目前搜索几场日志需要很长时间。

编辑 2：其中一些建议很棒，但我必须重申，我不能集成另一个应用程序，它是合同的一部分。但为了回答一些问题，日志中的数据与接收到的医疗保健特定格式的消息或与这些相关的消息不同。我希望依赖索引，因为虽然重建索引可能需要一分钟，但目前搜索需要很长时间（我已经看到它最多需要 2.5 分钟）。此外，很多数据在记录之前就被丢弃了。除非打开某些调试日志记录选项，否则会忽略一半以上的日志消息。

搜索基本上是这样的：Web 表单上的用户会看到最新消息的列表（当他们滚动时从磁盘流式传输，是的 ajax），通常，他们会想要搜索包含一些信息的消息它，可能是患者 ID，或者他们发送的一些字符串，因此他们可以将字符串输入到搜索中。搜索被异步发送，自定义 Web 服务器一次线性搜索 1MB 的日志以获取某些结果。当日志变大时，此过程可能需要很长时间。这就是我要优化的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T18:21:25.883

`grep`通常对我来说非常适合使用大日志（有时 12G+）。[您也可以在此处](http://gnuwin32.sourceforge.net/packages/grep.htm)找到适用于 Windows 的版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T18:34:22.107

您很可能希望将某种类型的索引搜索引擎集成到您的应用程序中。那里有几十个，[Lucene](http://lucene.apache.org/java/docs/index.html)似乎很受欢迎。检查这两个问题以获得更多建议：

[与自定义 Web 应用程序集成的最佳文本搜索引擎？](https://stackoverflow.com/questions/117987/best-text-search-engine-for-integrating-with-custom-web-app)

[如何在网站中实现搜索功能？](https://stackoverflow.com/questions/34314/how-do-i-implement-search-functionality-in-a-website#)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:19:51.297

查看 Lucene 使用的算法。不过，它们不太可能非常简单。曾几何时，我不得不研究其中一些算法，其中一些非常复杂。

如果您可以识别要索引的文本中的“单词”，只需构建单词的大型哈希表，将单词的哈希映射到每个文件中的出现。如果用户经常重复相同的搜索，缓存搜索结果。搜索完成后，您可以检查每个位置以确认搜索词位于该位置，而不仅仅是具有匹配哈希的单词。

另外，谁真正关心索引是否大于文件本身？如果你的系统真的这么大，有这么多活动，那么几十个索引的演出是世界末日吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T18:29:58.700

有关您正在执行的搜索类型的更多详细信息肯定会有所帮助。为什么，特别是您要依赖索引，因为您必须每天在日志翻转时重建它？这些日志中有哪些信息？可以在记录之前丢弃其中的一些吗？

现在这些搜索需要多长时间？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T20:08:52.160

您可能想查看 BSD 的源代码`grep`。您可能无法依靠 grep 来为您服务，但没有什么说您不能重新创建类似的功能，对吧？

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-10-02T18:34:55.117

[Splunk](http://www.splunk.com/ "斯普伦克")非常适合搜索大量日志。对你的目的来说可能是矫枉过正。您根据要处理的数据量（日志大小）付费。我很确定他们有一个 API，所以如果你不想的话，你不必使用他们的前端。

# xml - 分析大量 XML 的程序

> ID：163796
> 
> 赞同：3
> 
> 时间：2008-10-02T18:19:14.763
> 
> 标签：xml

我有很多 XML 文件，我想从中生成一份报告。报告应提供以下信息：

```
root 100%
 a*1 90%
 b*1 80%
  c*5 40% 
```

这意味着所有文档都有一个根元素，90%在根中有一个**a**元素，80% 在根中有一个**b**元素，40%在**b中有 5 个****c**元素。

 **例如，如果某些文档有 4 个**c**元素，一些 5 和一些 6，它应该说如下：

```
c*4.3 4 6 40% 
```

这意味着 40% 有 4 到 6 个**c**元素，平均值为 4.3。

我正在寻找免费软件，如果它不存在，我会写它。我正要这样做，但我想检查一下。我可能不是第一个必须分析并获得数千个 XML 文件的结构概览的人。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-02T22:09:01.513

这是一个 XSLT 2.0 方法。

假设`$docs`包含要扫描的文档节点序列，您希望为文档中出现的每个元素创建一行。你可以用它`<xsl:for-each-group>`来做到这一点：

```
<xsl:for-each-group select="$docs//*" group-by="name()">
  <xsl:sort select="current-group-key()" />
  <xsl:variable name="name" as="xs:string" select="current-grouping-key()" />
  <xsl:value-of select="$name" />
  ...
</xsl:for-each-group> 
```

然后，您想在文档中找出该元素的统计信息。首先，找到文档中包含该名称的元素：

```
<xsl:variable name="docs-with" as="document-node()+"
  select="$docs[//*[name() = $name]" /> 
```

其次，您需要每个文档中该名称的元素数量的序列：

```
<xsl:variable name="elem-counts" as="xs:integer+"
  select="$docs-with/count(//*[name() = $name])" /> 
```

现在您可以进行计算了。可以使用和函数计算平均值`avg()`、最小值和最大值。百分比只是包含该元素的文档数除以已格式化的文档总数。`min()``max()`

把它放在一起：

```
<xsl:for-each-group select="$docs//*" group-by="name()">
  <xsl:sort select="current-group-key()" />
  <xsl:variable name="name" as="xs:string" select="current-grouping-key()" />
  <xsl:variable name="docs-with" as="document-node()+"
    select="$docs[//*[name() = $name]" />
  <xsl:variable name="elem-counts" as="xs:integer+"
    select="$docs-with/count(//*[name() = $name])" />
  <xsl:value-of select="$name" />
  <xsl:text>* </xsl:text>
  <xsl:value-of select="format-number(avg($elem-counts), '#,##0.0')" />
  <xsl:text> </xsl:text>
  <xsl:value-of select="format-number(min($elem-counts), '#,##0')" />
  <xsl:text> </xsl:text>
  <xsl:value-of select="format-number(max($elem-counts), '#,##0')" />
  <xsl:text> </xsl:text>
  <xsl:value-of select="format-number((count($docs-with) div count($docs)) * 100, '#0')" />
  <xsl:text>%</xsl:text>
  <xsl:text>&#xA;</xsl:text>
</xsl:for-each-group> 
```

我在这里没有做的是根据元素的深度缩进线条。我刚刚按字母顺序对元素进行了排序，以便为您提供统计信息。原因有两个：首先，要以某种结构显示元素统计信息以反映它们在文档中的显示方式要困难得多（因为这里写得太复杂了），尤其是因为不同的文档可能具有不同的结构。其次，在许多标记语言中，无法知道文档的精确结构（例如，因为节可以在节内嵌套到任何深度）。

我希望它仍然有用。

更新：

需要 XSLT 包装器和一些运行 XSLT 的说明？好的。首先，掌握[Saxon 9B](http://saxon.sourceforge.net/)。

您需要将所有要分析的文件放在一个目录中。[Saxon 允许您使用使用特殊 URI 语法](http://www.saxonica.com/documentation/sourcedocs/collections.html)的集合访问该目录（或其子目录）中的所有文件。如果您想递归搜索或通过文件名过滤您正在查看的文件，则值得查看该语法。

现在是完整的 XSLT：

```
<xsl:stylesheet version="2.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  exclude-result-prefixes="xs">

<xsl:param name="dir" as="xs:string"
  select="'file:///path/to/default/directory?select=*.xml'" />

<xsl:output method="text" />

<xsl:variable name="docs" as="document-node()*"
  select="collection($dir)" />

<xsl:template name="main">
  <xsl:for-each-group select="$docs//*" group-by="name()">
    <xsl:sort select="current-group-key()" />
    <xsl:variable name="name" as="xs:string" select="current-grouping-key()" />
    <xsl:variable name="docs-with" as="document-node()+"
      select="$docs[//*[name() = $name]" />
    <xsl:variable name="elem-counts" as="xs:integer+"
      select="$docs-with/count(//*[name() = $name])" />
    <xsl:value-of select="$name" />
    <xsl:text>* </xsl:text>
    <xsl:value-of select="format-number(avg($elem-counts), '#,##0.0')" />
    <xsl:text> </xsl:text>
    <xsl:value-of select="format-number(min($elem-counts), '#,##0')" />
    <xsl:text> </xsl:text>
    <xsl:value-of select="format-number(max($elem-counts), '#,##0')" />
    <xsl:text> </xsl:text>
    <xsl:value-of select="format-number((count($docs-with) div count($docs)) * 100, '#0')" />
    <xsl:text>%</xsl:text>
    <xsl:text>&#xA;</xsl:text>
  </xsl:for-each-group>
</xsl:template> 

</xsl:stylesheet> 
```

要运行它，您将执行以下操作：

```
> java -jar path/to/saxon.jar -it:main -o:report.txt dir=file:///path/to/your/directory?select=*.xml

```

这告诉 Saxon 使用名为的模板启动进程，`main`将`dir`参数设置为`file:///path/to/your/directory?select=*.xml`并将输出发送到`report.txt`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T01:43:00.333

查看[**小工具**](https://web.archive.org/web/20140928025041/http://simile.mit.edu:80/wiki/Gadget)

[![替代文字](https://i.stack.imgur.com/SAMNI.png)](https://i.stack.imgur.com/SAMNI.png)
[（来源：[mit.edu](http://web.archive.org/web/20131225224913/http://simile.mit.edu/mediawiki/images/0/0f/Gadget-screenshot-1.png)）]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T01:46:19.360

[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/documentation.html)让 Python 中的 XML 解析变得简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-05T15:27:52.433

[社区帖子，此处：不涉及业力；）]
我在这里提出**[代码挑战](https://stackoverflow.com/questions/172184)**：

**解析在 xmlfiles.com/examples 中找到的所有 xml 并尝试得出以下输出：**

```
Analyzing plant_catalog.xml: 
Analyzing note.xml: 
Analyzing portfolio.xml: 
Analyzing note_ex_dtd.xml: 
Analyzing home.xml: 
Analyzing simple.xml: 
Analyzing cd_catalog.xml: 
Analyzing portfolio_xsl.xml: 
Analyzing note_in_dtd.xml: 
Statistical Elements Analysis of 9 xml documents with 34 elements
CATALOG*2 22%
  CD*26 50%
    ARTIST*26 100%
    COMPANY*26 100%
    COUNTRY*26 100%
    PRICE*26 100%
    TITLE*26 100%
    YEAR*26 100%
  PLANT*36 50%
    AVAILABILITY*36 100%
    BOTANICAL*36 100%
    COMMON*36 100%
    LIGHT*36 100%
    PRICE*36 100%
    ZONE*36 100%
breakfast-menu*1 11%
  food*5 100%
    calories*5 100%
    description*5 100%
    name*5 100%
    price*5 100%
note*3 33%
  body*1 100%
  from*1 100%
  heading*1 100%
  to*1 100%
page*1 11%
  para*1 100%
  title*1 100%
portfolio*2 22%
  stock*2 100%
    name*2 100%
    price*2 100%
    symbol*2 100% 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-05T15:33:05.323

这是针对这个[代码挑战](https://stackoverflow.com/questions/172184)的一个可能的 ruby​​ 解决方案......
因为它是我的第一个 ruby​​ 程序，我确信它的编码非常糟糕，但至少它可以回答 J. Pablo Fernandez 的问题。

将其复制粘贴到 '.rb 文件中并在其上调用 ruby​​。如果你有互联网连接，它会工作;）

```
require "rexml/document"
require "net/http"
require "iconv"
include REXML
class NodeAnalyzer
  @@fullPathToFilesToSubNodesNamesToCardinalities = Hash.new()
  @@fullPathsToFiles = Hash.new() #list of files in which a fullPath node is detected
  @@fullPaths = Array.new # all fullpaths sorted alphabetically
  attr_reader :name, :father, :subNodesAnalyzers, :indent, :file, :subNodesNamesToCardinalities
    def initialize(aName="", aFather=nil, aFile="")
        @name = aName; @father = aFather; @subNodesAnalyzers = []; @file = aFile
    @subNodesNamesToCardinalities = Hash.new(0)
    if aFather && !aFather.name.empty? then @indent = "  " else @indent = "" end
    if aFather
      @indent = @father.indent + self.indent
      @father.subNodesAnalyzers << self
      @father.updateSubNodesNamesToCardinalities(@name)
    end
    end
  @@nodesRootAnalyzer = NodeAnalyzer.new
  def NodeAnalyzer.nodesRootAnalyzer
    return @@nodesRootAnalyzer
  end
  def updateSubNodesNamesToCardinalities(aSubNodeName)
    aSubNodeCardinality = @subNodesNamesToCardinalities[aSubNodeName]
    @subNodesNamesToCardinalities[aSubNodeName] = aSubNodeCardinality + 1
  end
  def NodeAnalyzer.recordNode(aNodeAnalyzer)
    if aNodeAnalyzer.fullNodePath.empty? == false
      if @@fullPaths.include?(aNodeAnalyzer.fullNodePath) == false then @@fullPaths << aNodeAnalyzer.fullNodePath end
      # record a full path in regard to its xml file (records it only one for a given xlm file)
      someFiles = @@fullPathsToFiles[aNodeAnalyzer.fullNodePath]
      if someFiles == nil 
        someFiles = Array.new(); @@fullPathsToFiles[aNodeAnalyzer.fullNodePath] = someFiles; 
      end
      if !someFiles.include?(aNodeAnalyzer.file) then someFiles << aNodeAnalyzer.file end
    end
    #record cardinalties of sub nodes for a given xml file
    someFilesToSubNodesNamesToCardinalities = @@fullPathToFilesToSubNodesNamesToCardinalities[aNodeAnalyzer.fullNodePath]
    if someFilesToSubNodesNamesToCardinalities == nil 
      someFilesToSubNodesNamesToCardinalities = Hash.new(); @@fullPathToFilesToSubNodesNamesToCardinalities[aNodeAnalyzer.fullNodePath] = someFilesToSubNodesNamesToCardinalities ; 
    end
    someSubNodesNamesToCardinalities = someFilesToSubNodesNamesToCardinalities[aNodeAnalyzer.file]
    if someSubNodesNamesToCardinalities == nil
      someSubNodesNamesToCardinalities = Hash.new(0); someFilesToSubNodesNamesToCardinalities[aNodeAnalyzer.file] = someSubNodesNamesToCardinalities
      someSubNodesNamesToCardinalities.update(aNodeAnalyzer.subNodesNamesToCardinalities)
    else
      aNodeAnalyzer.subNodesNamesToCardinalities.each() do |aSubNodeName, aCardinality|
        someSubNodesNamesToCardinalities[aSubNodeName] = someSubNodesNamesToCardinalities[aSubNodeName] + aCardinality
      end
    end  
    #puts "someSubNodesNamesToCardinalities for #{aNodeAnalyzer.fullNodePath}: #{someSubNodesNamesToCardinalities}"
  end
  def file
    #if @file.empty? then @father.file else return @file end
    if @file.empty? then if @father != nil then return @father.file else return '' end else return @file end
  end
  def fullNodePath
    if @father == nil then return '' elsif @father.name.empty? then return @name else return @father.fullNodePath+"/"+@name end
  end
    def to_s
    s = ""
    if @name.empty? == false
      s = "#{@indent}#{self.fullNodePath} [#{self.file}]\n"
    end
    @subNodesAnalyzers.each() do |aSubNodeAnalyzer|
      s = s + aSubNodeAnalyzer.to_s
    end
    return s
    end
  def NodeAnalyzer.displayStats(aFullPath="")
    s = "";
    if aFullPath.empty? then s = "Statistical Elements Analysis of #{@@nodesRootAnalyzer.subNodesAnalyzers.length} xml documents with #{@@fullPaths.length} elements\n" end
    someFullPaths = @@fullPaths.sort
    someFullPaths.each do |aFullPath|
      s = s + getIndentedNameFromFullPath(aFullPath) + "*"
      nbFilesWithThatFullPath = getNbFilesWithThatFullPath(aFullPath);
      aParentFullPath = getParentFullPath(aFullPath)
      nbFilesWithParentFullPath = getNbFilesWithThatFullPath(aParentFullPath);
      aNameFromFullPath = getNameFromFullPath(aFullPath)
      someFilesToSubNodesNamesToCardinalities = @@fullPathToFilesToSubNodesNamesToCardinalities[aParentFullPath]
      someCardinalities = Array.new()
      someFilesToSubNodesNamesToCardinalities.each() do |aFile, someSubNodesNamesToCardinalities|
        aCardinality = someSubNodesNamesToCardinalities[aNameFromFullPath]
        if aCardinality > 0 && someCardinalities.include?(aCardinality) == false then someCardinalities << aCardinality end
      end
      if someCardinalities.length == 1
        s = s + someCardinalities.to_s + " "
      else
        anAvg = someCardinalities.inject(0) {|sum,value| Float(sum) + Float(value) } / Float(someCardinalities.length)
        s = s + sprintf('%.1f', anAvg) + " " + someCardinalities.min.to_s + "..." + someCardinalities.max.to_s + " "
      end
      s = s + sprintf('%d', Float(nbFilesWithThatFullPath) / Float(nbFilesWithParentFullPath) * 100) + '%'
      s = s + "\n"
    end
    return s
  end
  def NodeAnalyzer.getNameFromFullPath(aFullPath)
    if aFullPath.include?("/") == false then return aFullPath end
    aNameFromFullPath = aFullPath.dup
    aNameFromFullPath[/^(?:[^\/]+\/)+/] = ""
    return aNameFromFullPath
  end
  def NodeAnalyzer.getIndentedNameFromFullPath(aFullPath)
    if aFullPath.include?("/") == false then return aFullPath end
    anIndentedNameFromFullPath = aFullPath.dup
    anIndentedNameFromFullPath = anIndentedNameFromFullPath.gsub(/[^\/]+\//, "  ")
    return anIndentedNameFromFullPath
  end
  def NodeAnalyzer.getParentFullPath(aFullPath)
    if aFullPath.include?("/") == false then return "" end
    aParentFullPath = aFullPath.dup
    aParentFullPath[/\/[^\/]+$/] = ""
    return aParentFullPath
  end
  def NodeAnalyzer.getNbFilesWithThatFullPath(aFullPath)
    if aFullPath.empty? 
      return @@nodesRootAnalyzer.subNodesAnalyzers.length
    else
      return @@fullPathsToFiles[aFullPath].length;
    end
  end
end
class REXML::Document
    def analyze(node, aFatherNodeAnalyzer, aFile="")
    anNodeAnalyzer = NodeAnalyzer.new(node.name, aFatherNodeAnalyzer, aFile)
    node.elements.each() do |aSubNode| analyze(aSubNode, anNodeAnalyzer) end
    NodeAnalyzer.recordNode(anNodeAnalyzer)
  end
end

begin
  anXmlFilesDirectory = "xmlfiles.com/examples/"
  anXmlFilesRegExp = Regexp.new("http:\/\/" + anXmlFilesDirectory + "([^\"]*)")
  a = Net::HTTP.get(URI("http://www.google.fr/search?q=site:"+anXmlFilesDirectory+"+filetype:xml&num=100&as_qdr=all&filter=0"))
  someXmlFiles = a.scan(anXmlFilesRegExp)
  someXmlFiles.each() do |anXmlFile|
    anXmlFileContent = Net::HTTP.get(URI("http://" + anXmlFilesDirectory + anXmlFile.to_s))
    anUTF8XmlFileContent = Iconv.conv("ISO-8859-1//ignore", 'UTF-8', anXmlFileContent).gsub(/\s+encoding\s*=\s*\"[^\"]+\"\s*\?/,"?")
    anXmlDocument = Document.new(anUTF8XmlFileContent)
    puts "Analyzing #{anXmlFile}: #{NodeAnalyzer.nodesRootAnalyzer.name}"
    anXmlDocument.analyze(anXmlDocument.root,NodeAnalyzer.nodesRootAnalyzer, anXmlFile.to_s)
  end
  NodeAnalyzer.recordNode(NodeAnalyzer.nodesRootAnalyzer)
  puts NodeAnalyzer.displayStats
end 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T16:15:07.470

听听 JeniT 的回答——她是我从 02 年开始学习的第一批 XSLT 大师之一。要真正体会 XML 的强大功能，您应该使用 XPath 和 XSLT 并学习操作节点。

# ruby-on-rails - 使用外键关系创建 Rails 模型和脚手架的教程

> ID：163797
> 
> 赞同：3
> 
> 时间：2008-10-02T18:19:26.870
> 
> 标签：ruby-on-rails

我在哪里可以找到关于生成具有外键关系的 Rails 模型的良好 Rails 新手友好参考资料？

我发现一些页面表明您应该向相关模型添加`has_many`和`belongs_to`指定这些关系，但没有看到任何关于让脚手架生成正确的控制器和视图代码以反映这些关系的说明。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-02-14T19:53:58.390

[http://ruby.railstutorial.org/ruby-on-rails-tutorial-book](http://ruby.railstutorial.org/ruby-on-rails-tutorial-book)

并查看第 11 章和第 12 章了解 Rails 3 和 Rails 3.2 我希望你喜欢这些章节，这是外键关系的非常好的概念

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-26T20:59:44.927

看问题：[Rails 3.1：任何深度嵌套模型的教程？](https://stackoverflow.com/questions/6874057/rails-3-1-any-tutorials-for-deeply-nested-models)

另请查看*nested_form* gem 和相关文档：[http](http://rubydoc.info/gems/nested_form/0.1.1/frames) ://rubydoc.info/gems/nested_form/0.1.1/frames 。用法很简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-21T01:18:30.830

这不是一个教程，但我发现这个页面在试图弄清楚我的 Rails 关系应该是什么时非常有用。它也是一个“官方”指南，因此很可能会得到维护。

[http://guides.rubyonrails.org/association_basics.html](http://guides.rubyonrails.org/association_basics.html)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-02T20:21:56.483

有一堆 StackOverflow 问题要求新手参考资料。我建议您从两个 Peepcode 截屏视频开始：

*   [从零开始的 Rails 第一部分](http://peepcode.com/products/rails-from-scratch-part-i)
*   [从零开始的 Rails 第二部分](http://peepcode.com/products/rails-from-scratch-part-ii)

他们在视觉上向您介绍 Rails 2 开发方面做得很好。然后，我建议您阅读 Ryan Daigle 编写的 Rails 2.1 PDF，以了解截屏视频中未涵盖的 2.1 功能。

我不确定你的问题是什么。你期望脚手架做什么？自动创建多对象关系链接？那是你必须自己开始分层的东西……当你这样做时，脚手架开始被一个真实的应用程序取代。脚手架只是一个起点：它并不是要猜测您的对象间关系在应用程序中会是什么样子。

# .net - 如何从命令行参数中选择 .Net 应用程序配置文件？

> ID：163803
> 
> 赞同：16
> 
> 时间：2008-10-02T18:20:31.767
> 
> 标签：.net, configuration, configurationmanager

我想通过传递命令行参数来覆盖标准 app.config 的使用。如何更改默认应用程序配置文件，以便在访问 ConfigurationManager.AppSettings 时访问命令行中指定的配置文件？

编辑：

事实证明，加载不同于 EXE 名称加上 .config 的配置文件的正确方法是使用 OpenMappedExeConfiguration。例如

```
ExeConfigurationFileMap configFile = new ExeConfigurationFileMap();
configFile.ExeConfigFilename = Path.Combine(Environment.CurrentDirectory, "Shell2.exe.config");
currentConfiguration = ConfigurationManager.OpenMappedExeConfiguration(configFile,ConfigurationUserLevel.None); 
```

这部分有效。我可以看到 appSettings 部分中的所有键，但所有值都是空的。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-02T19:48:27.420

所以这里的代码实际上允许我实际访问除默认配置文件之外的配置文件中的 appSettings 部分。

```
ExeConfigurationFileMap configFile = new ExeConfigurationFileMap();
configFile.ExeConfigFilename = Path.Combine(Environment.CurrentDirectory, "Alternate.config");
Configuration config = ConfigurationManager.OpenMappedExeConfiguration(configFile,ConfigurationUserLevel.None);

AppSettingsSection section = (AppSettingsSection)config.GetSection("appSettings");
string MySetting = section.Settings["MySetting"].Value; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T18:23:01.823

将所需配置文件复制到 appname.exe.config 然后运行 ​​appname.exe 的批处理文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T18:27:26.587

这不完全是您想要的……将实际的[`ConfigurationManager`](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.aspx)静态对象重定向到不同的路径。但我认为这是解决您问题的正确方法。查看类[`OpenExeConfiguration`](http://msdn.microsoft.com/en-us/library/ms224437.aspx)上的方法[`ConfigurationManager`](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.aspx)。

如果上述方法不是您想要的，我认为使用Enterprise Library 框架（由 Microsoft 模式和实践团队开发和维护）的[配置功能](http://msdn.microsoft.com/en-us/library/microsoft.practices.enterpriselibrary.common.configuration.aspx)也值得一看。

具体看一下[`FileConfigurationSource`](http://msdn.microsoft.com/en-us/library/microsoft.practices.enterpriselibrary.common.configuration.fileconfigurationsource.fileconfigurationsource.aspx)类。

下面是一些代码，重点介绍了`FileConfigurationSource`from [Enterprise Library](http://www.microsoft.com/downloads/details.aspx?familyid=90DE37E0-7B42-4044-99BE-F8ECFBBC5B65&displaylang=en&Hash=oOfFascYgZ%2bhSk6bMSD0ctdKGJBo3jL9XEtSJS2%2bCaArLTPNHRCuJ5k%2bnhgG8YkFIMOdGq74qSBJRzpD6zppRg%3d%3d)的使用，我相信这完全符合您的目标。为此，您需要从 Ent Lib 获得的唯一程序集是`Microsoft.Practices.EnterpriseLibrary.Common.dll`.

```
static void Main(string[] args)
{
    //read from current app.config as default
    AppSettingsSection ass = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None).AppSettings;

    //if args[0] is a valid file path assume it's a config for this example and attempt to load
    if (args.Length > 0 && File.Exists(args[0]))
    {
        //using FileConfigurationSource from Enterprise Library
        FileConfigurationSource fcs = new FileConfigurationSource(args[0]);
        ass = (AppSettingsSection) fcs.GetSection("appSettings");
    }

    //print value from configuration
    Console.WriteLine(ass.Settings["test"].Value);
    Console.ReadLine(); //pause
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T19:28:11.120

我也需要为我的应用程序执行此操作，并且处理标准配置对象变成了一个非常简单的概念，我走这条路：

1.  以类似于 app.config 的 XML 格式保存多个配置文件
2.  将指定的配置文件加载到**DataSet**中（通过 .ReadXML），并将其中包含配置信息的**DataTable**用作我的**配置对象**。
3.  所以我所有的代码都只处理**配置数据**表来检索值，而不是那个疯狂混淆的应用程序配置对象。

然后我可以在命令行上传入我需要的任何配置文件名，如果不存在 - 只需将 app.config 加载到**DataSet**中。

天哪，在那之后就简单多了。:-)

罗恩

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-07T11:56:22.767

这是使用默认配置并通过命令行接受覆盖的应用程序源的相关部分：

**获取当前或用户配置到 Config 对象**

```
Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
string defCfgName = Environment.GetCommandLineArgs()[0] + ".config";

if (arg.Length != 0)
{
    string ConfigFileName = arg[0];
    if (!File.Exists(ConfigFileName))
        Fatal("File doesn't exist: " + ConfigFileName, -1);                
    config = ConfigurationManager.OpenMappedExeConfiguration(new ExeConfigurationFileMap { ExeConfigFilename = ConfigFileName }, ConfigurationUserLevel.None);
}
else if (!File.Exists(defCfgName)) Fatal("Default configuration file doesn't exist and no override is set." , -1); 
```

**使用配置对象**

```
AppSettingsSection s = (AppSettingsSection)config.GetSection("appSettings");
KeyValueConfigurationCollection a = s.Settings;
ConnectionString = a["ConnectionString"].Value; 
```

# php - 智能分页算法

> ID：163809
> 
> 赞同：37
> 
> 时间：2008-10-02T18:22:34.740
> 
> 标签：php, pagination

我正在寻找智能分页的示例算法。聪明，我的意思是我只想显示，例如，与当前页面相邻的 2 个页面，所以我没有以一个长得离谱的页面列表结束，而是截断它。

这是一个更清晰的快速示例......这就是我现在所拥有的：

```
Pages: 1 2 3 4 [5] 6 7 8 9 10 11 
```

这就是我想要结束的：

```
Pages: ... 3 4 [5] 6 7 ... 
```

（在这个例子中，我只显示了与当前页面相邻的 2 个页面）

我在 PHP/Mysql 中实现它，并且“基本”分页（没有 trucating）已经编码，我只是在寻找一个优化它的例子......它可以是任何语言的例子，只要它给了我一个关于如何实现它的想法......

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-02T18:26:36.290

不久前我也有同样的需求。

这是我用来完成它的文章（使用 PHP 代码）： [Digg-Style Pagination](http://www.strangerstudios.com/sandbox/pagination/diggstyle.php)

它运行得非常快，并且对您正在尝试做的事情有一些补充，例如：

```
[1] 2 3 4 5 6 ... 100
1 [2] 3 4 5 6 ... 100
...
1 ... 4 5 [6] 7 8 ... 100
```

以下是断开链接中的代码：

```
<?php
    /*
        Place code to connect to your DB here.
    */

    // How many adjacent pages should be shown on each side?
    $adjacents = 3;

    /* 
       First get total number of rows in data table. 
       If you have a WHERE clause in your query, make sure you mirror it here.
    */
    $query = "SELECT COUNT(*) as num FROM portfolio";
    $total_pages = mysql_fetch_array(mysql_query($query));
    $total_pages = $total_pages[num];

    /* Setup vars for query. */
    $limit = 2;                                 //how many items to show per page
    if($page) 
        $start = ($page - 1) * $limit;          //first item to display on this page
    else
        $start = 0;                             //if no page var is given, set start to 0

    /* Get data. */
    $query = "SELECT category, uname, title FROM portfolio LIMIT $start, $limit";
    $portfolio = mysql_query($query);

    /* Setup page vars for display. */
    if ($page == 0) $page = 1;                  //if no page var is given, default to 1.
    $prev = $page - 1;                          //previous page is page - 1
    $next = $page + 1;                          //next page is page + 1
    $lastpage = ceil($total_pages/$limit);      //lastpage is = total pages / items per page, rounded up.
    $lpm1 = $lastpage - 1;                      //last page minus 1

    /* 
        Now we apply our rules and draw the pagination object. 
        We're actually saving the code to a variable in case we want to draw it more than once.
    */
    $pagination = "";
    if($lastpage > 1)
    {   
        $pagination .= "<div class="\"pagination\"">";
        //previous button
        if ($page > 1) 
            $pagination.= "<a href="\"diggstyle.php?page=$prev\"">« previous</a>";
        else
            $pagination.= "<span class="\"disabled\"">« previous</span>";   

        //pages 
        if ($lastpage < 7 + ($adjacents * 2))   //not enough pages to bother breaking it up
        {   
            for ($counter = 1; $counter <= $lastpage; $counter++)
            {
                if ($counter == $page)
                    $pagination.= "<span class="\"current\"">$counter</span>";
                else
                    $pagination.= "<a href="\"diggstyle.php?page=$counter\"">$counter</a>";                 
            }
        }
        elseif($lastpage > 5 + ($adjacents * 2))    //enough pages to hide some
        {
            //close to beginning; only hide later pages
            if($page < 1 + ($adjacents * 2))        
            {
                for ($counter = 1; $counter < 4 + ($adjacents * 2); $counter++)
                {
                    if ($counter == $page)
                        $pagination.= "<span class="\"current\"">$counter</span>";
                    else
                        $pagination.= "<a href="\"diggstyle.php?page=$counter\"">$counter</a>";                 
                }
                $pagination.= "...";
                $pagination.= "<a href="\"diggstyle.php?page=$lpm1\"">$lpm1</a>";
                $pagination.= "<a href="\"diggstyle.php?page=$lastpage\"">$lastpage</a>";       
            }
            //in middle; hide some front and some back
            elseif($lastpage - ($adjacents * 2) > $page && $page > ($adjacents * 2))
            {
                $pagination.= "<a href="\"diggstyle.php?page=1\"">1</a>";
                $pagination.= "<a href="\"diggstyle.php?page=2\"">2</a>";
                $pagination.= "...";
                for ($counter = $page - $adjacents; $counter <= $page + $adjacents; $counter++)
                {
                    if ($counter == $page)
                        $pagination.= "<span class="\"current\"">$counter</span>";
                    else
                        $pagination.= "<a href="\"diggstyle.php?page=$counter\"">$counter</a>";                 
                }
                $pagination.= "...";
                $pagination.= "<a href="\"diggstyle.php?page=$lpm1\"">$lpm1</a>";
                $pagination.= "<a href="\"diggstyle.php?page=$lastpage\"">$lastpage</a>";       
            }
            //close to end; only hide early pages
            else
            {
                $pagination.= "<a href="\"diggstyle.php?page=1\"">1</a>";
                $pagination.= "<a href="\"diggstyle.php?page=2\"">2</a>";
                $pagination.= "...";
                for ($counter = $lastpage - (2 + ($adjacents * 2)); $counter <= $lastpage; $counter++)
                {
                    if ($counter == $page)
                        $pagination.= "<span class="\"current\"">$counter</span>";
                    else
                        $pagination.= "<a href="\"diggstyle.php?page=$counter\"">$counter</a>";                 
                }
            }
        }

        //next button
        if ($page < $counter - 1) 
            $pagination.= "<a href="\"diggstyle.php?page=$next\"">next »</a>";
        else
            $pagination.= "<span class="\"disabled\"">next »</span>";
        $pagination.= "</div>\n";       
    }
?>
<ul>
    <?php
        while($item = mysql_fetch_array($portfolio))
        {
    ?>
        <li><a href="/web/20080709045706/http://www.strangerstudios.com/portfolio//"></a></li>
    <?php
        }
    ?>
</ul>
<?=$pagination?> 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-09-27T00:24:13.167

有点晚=），但这是我的尝试：

```
function Pagination($data, $limit = null, $current = null, $adjacents = null)
{
    $result = array();

    if (isset($data, $limit) === true)
    {
        $result = range(1, ceil($data / $limit));

        if (isset($current, $adjacents) === true)
        {
            if (($adjacents = floor($adjacents / 2) * 2 + 1) >= 1)
            {
                $result = array_slice($result, max(0, min(count($result) - $adjacents, intval($current) - ceil($adjacents / 2))), $adjacents);
            }
        }
    }

    return $result;
} 
```

* * *

**例子：**

```
$total = 1024;
$per_page = 10;
$current_page = 2;
$adjacent_links = 4;

print_r(Pagination($total, $per_page, $current_page, $adjacent_links)); 
```

**输出（[@键盘](http://codepad.org/vcULT1DA)）：**

```
Array
(
    [0] => 1
    [1] => 2
    [2] => 3
    [3] => 4
    [4] => 5
) 
```

* * *

**另一个例子：**

```
$total = 1024;
$per_page = 10;
$current_page = 42;
$adjacent_links = 4;

print_r(Pagination($total, $per_page, $current_page, $adjacent_links)); 
```

**输出（[@键盘](http://codepad.org/HAKkgrb2)）：**

```
Array
(
    [0] => 40
    [1] => 41
    [2] => 42
    [3] => 43
    [4] => 44
) 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-12-22T19:50:04.837

我从 lazaro 的帖子开始，尝试使用 javascript/jquery 制作一个健壮且轻量级的算法......不需要额外和/或庞大的分页库......在小提琴上寻找一个活生生的例子：http: [//jsfiddle.net/ 97JtZ/1/](http://jsfiddle.net/97JtZ/1/)

```
var totalPages = 50, buttons = 5;
var currentPage = lowerLimit = upperLimit = Math.min(9, totalPages);

//Search boundaries
for (var b = 1; b < buttons && b < totalPages;) {
    if (lowerLimit > 1 ) { lowerLimit--; b++; }
    if (b < buttons && upperLimit < totalPages) { upperLimit++; b++; }
}

//Do output to a html element
for (var i = lowerLimit; i <= upperLimit; i++) {
    if (i == currentPage) $('#pager').append('<li>' + i + '</li> ');
    else $('#pager').append('<a href="#"><li><em>' + i + '</em></li></a> ');
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-05-03T16:54:18.903

```
List<int> pages = new List<int>();
int pn = 2; //example of actual pagenumber
int total = 8;

for(int i = pn - 9; i <= pn + 9; i++)
{
  if(i < 1) continue;
  if(i > total) break;
  pages.Add(i);
}

return pages; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T21:01:50.287

不久前我做了一个分页课程并加入了谷歌代码。看看它很简单 [http://code.google.com/p/spaceshipcollaborative/wiki/PHPagination](http://code.google.com/p/spaceshipcollaborative/wiki/PHPagination)

```
$paging = new Pagination();
$paging->set('urlscheme','class.pagination.php?page=%page%');
$paging->set('perpage',10);
$paging->set('page',15);
$paging->set('total',3000);
$paging->set('nexttext','Next Page');
$paging->set('prevtext','Previous Page');
$paging->set('focusedclass','selected');
$paging->set('delimiter','');
$paging->set('numlinks',9);
$paging->display(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T18:29:06.800

我会在您显示分页器的页面上使用一些简单的东西，例如：

```
if (
  $page_number == 1 || $page_number == $last_page ||
  $page_number == $actual_page ||
  $page_number == $actual_page+1 || $page_number == $actual_page+2 ||
  $page_number == $actual_page-1 || $page_number == $actual_page-2
  ) echo $page_number; 
```

您可以调整它以使用操作员显示每 10 个左右的页面`%`...

*我认为在这种情况下使用 switch() 情况会更好，我现在不记得语法了*

把事情简单化 ：）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-10-19T15:56:40.590

如果可以在客户端生成分页，我会建议我的新分页插件：[http ://www.xarg.org/2011/09/jquery-pagination-revised/](http://www.xarg.org/2011/09/jquery-pagination-revised/)

您的问题的解决方案是：

```
$("#pagination").paging(1000, { // Your number of elements
        format: '. - nncnn - ', // Format to get Pages: ... 3 4 [5] 6 7 ...
        onSelect: function (page) {
                // add code which gets executed when user selects a page
        },
        onFormat: function (type) {
                switch (type) {
                case 'block': // n and c
                        return '<a>' + this.value + '</a>';
                case 'fill': // -
                        return '...';
                case 'leap': // .
                        return 'Pages:';
                }
        }
}); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-20T08:38:49.123

[CodeIgniter 分页](http://codeigniter.com/user_guide/libraries/pagination.html)类的代码可以[在 GitHub 上找到](https://github.com/EllisLab/CodeIgniter/blob/develop/system/libraries/Pagination.php)

（你叫什么）智能分页可以通过配置来实现。

```
$config['num_links'] = 2; 
```

> 您希望在所选页码之前和之后的“数字”链接数。例如，数字 2 将在两侧放置两个数字，如本页最顶部的示例链接所示。

# python - Django ModelAdmin 中的“list_display”可以显示 ForeignKey 字段的属性吗？

> ID：163823
> 
> 赞同：374
> 
> 时间：2008-10-02T18:26:19.723
> 
> 标签：python, django, django-models, django-admin, modeladmin

我有一个`Person`与 具有外键关系的模型`Book`，它有许多字段，但我最关心的是`author`（一个标准的 CharField）。

话虽如此，在我的`PersonAdmin`模型中，我想显示`book.author`使用`list_display`：

```
class PersonAdmin(admin.ModelAdmin):
    list_display = ['book.author',] 
```

我已经尝试了所有明显的方法，但似乎没有任何效果。

有什么建议么？

* * *

## 回答 #1

> 赞同：587
> 
> 时间：2008-10-02T21:11:56.283

作为另一种选择，您可以进行如下查找：

```
class UserAdmin(admin.ModelAdmin):
    list_display = (..., 'get_author')

    def get_author(self, obj):
        return obj.book.author
    get_author.short_description = 'Author'
    get_author.admin_order_field = 'book__author' 
```

从 Django 3.2 开始，您可以使用[`display()`](https://docs.djangoproject.com/en/3.2/ref/contrib/admin/#the-display-decorator)装饰器：

```
class UserAdmin(admin.ModelAdmin):
    list_display = (..., 'get_author')

    @display(ordering='book__author', description='Author')
    def get_author(self, obj):
        return obj.book.author 
```

* * *

## 回答 #2

> 赞同：184
> 
> 时间：2014-05-19T21:55:14.047

尽管上面有所有很好的答案，而且由于我是 Django 的新手，我仍然被困住了。这是我从一个非常新手的角度进行的解释。

**模型.py**

```
class Author(models.Model):
    name = models.CharField(max_length=255)

class Book(models.Model):
    author = models.ForeignKey(Author)
    title = models.CharField(max_length=255) 
```

**admin.py （不正确的方式）** - 你认为它可以通过使用 'model__field' 来引用，但它没有

```
class BookAdmin(admin.ModelAdmin):
    model = Book
    list_display = ['title', 'author__name', ]

admin.site.register(Book, BookAdmin) 
```

**admin.py（正确的方式）** - 这是你引用外键名称的方式 Django 方式

```
class BookAdmin(admin.ModelAdmin):
    model = Book
    list_display = ['title', 'get_name', ]

    def get_name(self, obj):
        return obj.author.name
    get_name.admin_order_field  = 'author'  #Allows column order sorting
    get_name.short_description = 'Author Name'  #Renames column head

    #Filtering on side - for some reason, this works
    #list_filter = ['title', 'author__name']

admin.site.register(Book, BookAdmin) 
```

有关其他参考，请参阅[此处的 Django 模型链接](https://docs.djangoproject.com/en/dev/ref/contrib/admin/#list-display)

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2010-07-28T09:13:55.677

和其他人一样，我也使用了可调用对象。但是它们有一个缺点：默认情况下，您不能订购它们。幸运的是，有一个解决方案：

# 姜戈 >= 1.8

```
def author(self, obj):
    return obj.book.author
author.admin_order_field  = 'book__author' 
```

# 姜戈 < 1.8

```
def author(self):
    return self.book.author
author.admin_order_field  = 'book__author' 
```

* * *

## 回答 #4

> 赞同：66
> 
> 时间：2015-01-28T11:20:40.100

请注意，添加该`get_author`函数会减慢管理员中的 list_display，因为显示每个人都会进行 SQL 查询。

为避免这种情况，您需要修改`get_queryset`PersonAdmin 中的方法，例如：

```
def get_queryset(self, request):
    return super(PersonAdmin,self).get_queryset(request).select_related('book') 
```

> 之前：73 个查询在 36.02 毫秒内（管理员中有 67 个重复查询）
> 
> 之后：10.81 毫秒内 6 次查询

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-10-02T18:53:23.777

根据文档，您只能显示`__unicode__`ForeignKey 的表示：

[http://docs.djangoproject.com/en/dev/ref/contrib/admin/#list-display](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#list-display)

似乎很奇怪，它不支持`'book__author'`DB API 中其他地方使用的样式格式。

原来[这个功能有一张票](http://code.djangoproject.com/ticket/5863)，标记为不会修复。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2021-05-29T00:52:07.977

# 对于 Django >= 3.2

使用 Django 3.2 或更高版本的正确方法是使用[显示装饰器](https://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.display)

```
class BookAdmin(admin.ModelAdmin):
    model = Book
    list_display = ['title', 'get_author_name']

    @admin.display(description='Author Name', ordering='author__name')
    def get_author_name(self, obj):
        return obj.author.name 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2013-02-03T21:21:58.783

我刚刚发布了一个片段，使 admin.ModelAdmin 支持 '__' 语法：

[http://djangosnippets.org/snippets/2887/](http://djangosnippets.org/snippets/2887/)

所以你可以这样做：

```
class PersonAdmin(RelatedFieldAdmin):
    list_display = ['book__author',] 
```

这基本上只是在做与其他答案中描述的相同的事情，但它会自动处理（1）设置 admin_order_field （2）设置 short_description 和（3）修改查询集以避免每行的数据库命中。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-01-30T17:41:43.217

您可以使用可调用对象在列表显示中显示您想要的任何内容。它看起来像这样：

```
def book_author（对象）：
  返回 object.book.author

类 PersonAdmin（admin.ModelAdmin）：
  list_display = [书名作者，]
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2016-05-28T10:30:55.513

PyPI 中有一个非常易于使用的包可以处理这个问题：[django-related-admin](https://pypi.python.org/pypi/django-related-admin)。您还可以[在 GitHub 中查看代码](https://github.com/PetrDlouhy/django-related-admin)。

使用它，您想要实现的目标很简单：

```
class PersonAdmin(RelatedFieldAdmin):
    list_display = ['book__author',] 
```

两个链接都包含安装和使用的完整详细信息，因此我不会将它们粘贴在这里以防它们发生变化。

顺便说一句，如果您已经在使用其他东西`model.Admin`（例如，我正在使用`SimpleHistoryAdmin`），您可以这样做：`class MyAdmin(SimpleHistoryAdmin, RelatedFieldAdmin)`.

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-01-23T23:40:30.153

这个已经被接受了，但是如果那里有任何其他的假人（比如我）没有立即从[目前接受的答案](https://stackoverflow.com/a/164631/58668)中得到它，这里有一些更详细的信息。

`ForeignKey`需要引用的模型类在其中有一个`__unicode__`方法，如下所示：

```
class Category(models.Model):
    name = models.CharField(max_length=50)

    def __unicode__(self):
        return self.name 
```

这对我来说很重要，应该适用于上述情况。这适用于 Django 1.0.2。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-01-12T03:42:30.173

如果您有很多要使用的关系属性字段`list_display`并且不想为每个字段创建一个函数（及其属性），那么一个肮脏但简单的解决方案将是覆盖`ModelAdmin`instace`__getattr__`方法，动态创建可调用对象：

```
class DynamicLookupMixin(object):
    '''
    a mixin to add dynamic callable attributes like 'book__author' which
    return a function that return the instance.book.author value
    '''

    def __getattr__(self, attr):
        if ('__' in attr
            and not attr.startswith('_')
            and not attr.endswith('_boolean')
            and not attr.endswith('_short_description')):

            def dyn_lookup(instance):
                # traverse all __ lookups
                return reduce(lambda parent, child: getattr(parent, child),
                              attr.split('__'),
                              instance)

            # get admin_order_field, boolean and short_description
            dyn_lookup.admin_order_field = attr
            dyn_lookup.boolean = getattr(self, '{}_boolean'.format(attr), False)
            dyn_lookup.short_description = getattr(
                self, '{}_short_description'.format(attr),
                attr.replace('_', ' ').capitalize())

            return dyn_lookup

        # not dynamic lookup, default behaviour
        return self.__getattribute__(attr)

# use examples    

@admin.register(models.Person)
class PersonAdmin(admin.ModelAdmin, DynamicLookupMixin):
    list_display = ['book__author', 'book__publisher__name',
                    'book__publisher__country']

    # custom short description
    book__publisher__country_short_description = 'Publisher Country'

@admin.register(models.Product)
class ProductAdmin(admin.ModelAdmin, DynamicLookupMixin):
    list_display = ('name', 'category__is_new')

    # to show as boolean field
    category__is_new_boolean = True 
```

作为[这里的要点](https://gist.github.com/cauethenorio/9db40c59cf406bf328fd)

可调用的特殊属性，例如`boolean`and ，`short_description`必须定义为`ModelAdmin`属性，例如`book__author_verbose_name = 'Author name'`and `category__is_new_boolean = True`。

callable`admin_order_field`属性是自动定义的。

不要忘记使用[list_select_related](https://docs.djangoproject.com/en/1.9/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_select_related "list_select_related")属性`ModelAdmin`来让 Django 避免额外的查询。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-01-30T12:30:33.723

如果你在 Inline 中尝试，你不会成功，除非：

在您的内联中：

```
class AddInline(admin.TabularInline):
    readonly_fields = ['localname',]
    model = MyModel
    fields = ('localname',) 
```

在您的模型（MyModel）中：

```
class MyModel(models.Model):
    localization = models.ForeignKey(Localizations)

    def localname(self):
        return self.localization.name 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-09-28T10:53:52.800

我可能会迟到，但这是另一种方法。您可以简单地在模型中定义一个方法并通过`list_display`以下方式访问它：

**模型.py**

```
class Person(models.Model):
    book = models.ForeignKey(Book, on_delete=models.CASCADE)

    def get_book_author(self):
        return self.book.author 
```

**管理员.py**

```
class PersonAdmin(admin.ModelAdmin):
    list_display = ('get_book_author',) 
```

但是上面提到的这种方法和其他方法会在您的列表视图页面中的每行添加两个额外的查询。为了优化这一点，我们可以覆盖`get_queryset`注释必填字段，然后在我们的 ModelAdmin 方法中使用注释字段

**管理员.py**

```
from django.db.models.expressions import F

@admin.register(models.Person)
class PersonAdmin(admin.ModelAdmin):
    list_display = ('get_author',)
    def get_queryset(self, request):
        queryset = super().get_queryset(request)
        queryset = queryset.annotate(
            _author = F('book__author')
        )
        return queryset

    @admin.display(ordering='_author', description='Author')
    def get_author(self, obj):
        return obj._author 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-03-25T00:27:08.327

AlexRobbins 的回答对我有用，除了前两行需要在模型中（也许这是假设的？），并且应该引用 self：

```
def book_author(self):
  return self.book.author 
```

然后管理部分工作得很好。

* * *

## 回答 #15

> 赞同：-5
> 
> 时间：2016-09-22T14:48:41.757

我更喜欢这个：

```
class CoolAdmin(admin.ModelAdmin):
    list_display = ('pk', 'submodel__field')

    @staticmethod
    def submodel__field(obj):
        return obj.submodel.field 
```

# php - PHP 模板 - 使用 PHP

> ID：163834
> 
> 赞同：20
> 
> 时间：2008-10-02T18:28:09.830
> 
> 标签：php, templates

您见过的最优雅的模板（最好是纯 PHP！）解决方案是什么？

具体来说，我有兴趣处理：

1.  在重复块中检测它是第一个还是最后一个元素
2.  轻松处理奇数/偶数情况，例如斑马条纹表或类似物
3.  其他模数逻辑，您每次都会做一些事情。

我正在寻找可以减轻这种痛苦的东西：

```
<?php
$persons = array('John', 'Jack', 'Jill', 'Jason');
?>

<?php $i = 0; ?>
<?php if (isset($persons)): ?>
<ul>
<?php foreach ($persons as $name): ?>
    <li class="<?= ($i++ % 2 === 0) ? 'odd' : 'even' ?>"><?= $name ?></li>
<?php endforeach ?>
</ul>
<?php endif ?> 
```

真的需要上面的混乱来创建下面这样的东西吗？

```
<ul>
    <li class="odd">John</li>
    <li class="even">Jack</li>
    <li class="odd">Jill</li>
    <li class="even">Jason</li>
</ul> 
```

只有我觉得上面的内容近乎可怕吗？

所有这些 php-tags 的开始和结束都让我感到畏缩。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-02T19:40:01.373

您无需多次打开标签。如果你多次做同样的事情，你也可以用它做一个函数：

```
<?php
function makeul($items, $classes) {
  $c = count($classes);
  $out = "";

  if (isset($items) && count($items) > 0) {
    $out = "<ul>\n";
    foreach ($items as $item) {
      $out .= "\t<li class=\"" . $classes[$i++%$c] . "\">$item</li>\n";
    }
    $out .= "</ul>\n";
  }
  return $out;
}
?>

other page content

<?php
$persons = array('John', 'Jack', 'Jill', 'Jason');
$classes = array('odd', 'even');
print makeul($persons, $classes);
?> 
```

此外，如果您不介意使用 Javascript，[Jquery](http://jquery.com/)可以让 mod 2 的工作变得非常容易（例如，用于斑马条纹表）：

```
$("tr:odd").addClass("odd");
$("tr:even").addClass("even"); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-02T18:32:12.033

小而强

[www.tinybutstrong.com](http://www.tinybutstrong.com)

它不会犯在页面中嵌入另一种宏语言的聪明错误，但确实允许您处理我曾经抛出的每个实际 Web 显示问题。特别是上面的奇数/偶数结构是轻而易举的。对于从数据库表中选择的代码之类的东西

在 PHP 文件中

```
$TBS->MergeBlock('blk1',$sqlconnect, "SELECT name from people "); 
```

并在 HTML 文件中

```
<ul>
    <li class="odd">[blk.name;block=ul]</li>
    <li class="even">[blk.name;block=ul]</li>
</ul> 
```

就是这样。请注意，HTML 与 Dreamweaver 完全兼容。此外，如果我想在三种线条样式上交替使用，我需要做的就是添加额外的线条，可能使用不同的类，所以

```
<ul>
    <li class="linestyle1">[blk.name;block=ul]</li>
    <li class="linestyle2">[blk.name;block=ul]</li>
    <li class="linestyle3">[blk.name;block=ul]</li>
</ul> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-17T00:31:55.617

**关于循环的小帮助：**

```
<? $b=false; foreach($MyList as $name) { ?>
   <li class="row<?= $b=!$b ?>"><?= htmlspecialchars($name); ?></li>
<? } ?> 
```

通过说`$b=!$b`，它会自动在真假之间交替。由于 false 打印为“”，而 true 打印为“1”，因此通过定义 css 类`row`和`row1`，您可以轻松地更改行。

考虑使用`:first-child`css 以不同的方式设置第一个样式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-02T18:39:07.930

它不是纯 PHP（当时的模板语法），但它工作得非常好；[聪明](http://www.smarty.net)的。

对于循环，您可以执行以下操作：

```
 <ul>
{foreach from=$var name=loop item=test}
  {if $smarty.foreach.loop.first}<li>This is the first item</li>{/if}
  <li class="{cycle values="odd,even"}">{$var.name}</li>
  {if $smarty.foreach.loop.last}<li>This was the last item</li>{/if}
{/foreach}
</ul> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-03T19:27:20.047

我使用[PHPTAL](http://phptal.motion-twin.com/)进行模板，因为它是 100% 用带有占位符数据的实际 HTML 编写的，所以它甚至可以在网页设计师的所见即所得编辑器中工作。这很容易理解。

这就是我的样子。请原谅标记，我是新来的，四个空格块不适合我（列表是列表，而不是标记）。

*PHP代码：*

```
  $tal = 新 PHPTAL；
  $tal->setTemplate('people.htm')
      ->set('people', array('John', 'Jack', 'Jill', 'Jason'));
  回声$tal->执行（）；

```

*模板：*

```
  <ul>
    <li tal:repeat="person people" tal:content="person">John Doe</li>
  </ul>

```

*输出：*

> *   约翰*   杰克*   吉尔*   杰森

现在显然我不会为这个小模板制作模板，但我可以为它使用宏或构建整个页面并包含该变量。但你明白了。使用[PHPTAL](http://phptal.motion-twin.com/)几乎使我在模板和编程方面的速度提高了三倍，只是因为它的简单性（无需像 smarty 那样学习新语法）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-02T19:24:11.723

你考虑[过 phptal](http://phptal.motion-twin.com/)吗？它（或类似的东西）的一个主要好处是您可以获得可以通过验证的模板。大多数 php 模板引擎似乎都忽略了这一点。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-08-12T21:04:22.107

[XSLT](http://us.php.net/xsl)怎么样？唯一拥有标准机构的模板系统。跨编程语言的工作方式相同。一次学习，随处使用！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-12-01T13:48:18.833

# Symfony 组件：模板

[![替代文字](https://i.stack.imgur.com/ldWj4.png)](https://i.stack.imgur.com/ldWj4.png)
[（来源：[symfony-project.org](http://components.symfony-project.org/images/components/templating/home.png)）]

**Symfony 打算迁移到**基于轻量级 PHP 模板系统[twig](http://santiance.com/twig/Framework)的新模板系统。

首席开发人员 Fabien Potencier 在这里解释了这个决定：http: [//fabien.potencier.org/article/35/templating-engines-in-php-follow-up](http://fabien.potencier.org/article/35/templating-engines-in-php-follow-up)

Symfony 通常可以在此类问题上做出非常明智的决定，所以这个框架应该是**值得研究的**。

组件在这里：[http ://components.symfony-project.org/templating/](http://components.symfony-project.org/templating/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-02T18:39:18.680

我过去使用过[Smarty 模板引擎](http://www.smarty.net/)。它很结实。正如您可能从网站上看到的那样；它拥有相当大的用户群并定期更新。

它也是纯 PHP 的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-03T06:44:33.210

[Savant](http://www.phpsavant.com/)是一个轻量级的纯 PHP 模板引擎。版本 2 有一个类似于前面提到的 Smarty的[循环插件。](http://www.phpsavant.com/yawiki/index.php?area=Savant2&page=PluginCycle#)我无法在版本 3 中找到对同一插件的引用，但我相信您可以相当轻松地编写它。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-05-15T19:12:16.257

如果只是应用 CSS 样式，为什么不使用 :nth-of-type(odd) 选择器。

例如：li:nth-of-type(odd) { 背景：#f2f6f8; 背景：线性渐变（顶部，#f2f6f8 0%，#e0eff9 100%）；}

[http://jsfiddle.net/melonangie/nU7qK/](http://jsfiddle.net/melonangie/nU7qK/)`enter code here`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T18:29:46.940

我一直在使用模数，就像您在示例中所做的那样。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T18:33:11.890

如果让您畏缩的是开始和结束标签，请编写一个创建 html 字符串的函数，然后让它返回它。至少它会为您节省一些标签。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-12-01T13:38:01.770

前段时间我在 PHP 中创建了一个简单的模板系统来解决这个问题：

[http://code.google.com/p/templatephp/](http://code.google.com/p/templatephp/)

它需要一个多维数组，并且需要向 HMTL 添加一些额外的标签来创建组合模板。

它不像 Smarty 和其他一些解决方案那样复杂（尽管功能强大），但在很多时候都以简单性胜出。菜单创建演示：

```
<p>Main Menu</p>
<ul>
{block:menu_items}
        <li><a href="{var:link}">{var:name}</a></li>
{/block:menu_items}
</ul> 
```

与...合并

```
 array (
        'menu_items' => array (
                array (
                        'link' => 'home.htm',
                        'name' => 'Home'
                ),
                array (
                        'link' => 'about.htm',
                        'name' => 'About Us'
                ),
                array (
                        'link' => 'portfolio.htm',
                        'name' => 'Portfolio'
                ),
                array (
                        'link' => 'contact.htm',
                        'name' => 'Contact Us'
                )
        )
); 
```

将创建菜单...

```
<p>Main Menu</p>
<ul>
        <li><a href="home.htm">Home</a></li>
        <li><a href="about.htm">About Us</a></li>
        <li><a href="portfolio.htm">Portfolio</a></li>
        <li><a href="contact.htm">Contact Us</a></li>
</ul> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-06-17T00:19:27.513

我很长时间以来一直是 HAML 的粉丝，看起来 PHP 人现在有 HAML：请参阅[http://phphaml.sourceforge.net/](http://phphaml.sourceforge.net/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-06-27T17:46:05.307

```
<?= ($i++ % 2 === 0) ? 'odd' : 'even' ?> 
```

You're doing it the other way around. Your first item is now called even instead of odd. Use ++$i.

I'm having the same problem. But I think your original solution is the neatest. So I'll go with that.

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-08-28T02:45:16.597

```
<?php
    define ('CRLF', "\r\n");
    $persons = array('John', 'Jack', 'Jill', 'Jason');

    $color = 'white'; // Init $color for striped list
    $ho = '<UL>' . CRLF; // Start HTML Output variable
    foreach ($persons as $name)
    {
       $ho .= '  <li class="' . $color . '">' . $name . '</li>' . CRLF;
       $color = ($color == 'white') ? 'grey' : 'white'; // if white, make it grey else white
    }
    $ho .= '</ul>' . CRLF;
    echo $ho;
?> 
```

# java - 使用版本控制很好地重构

> ID：163835
> 
> 赞同：7
> 
> 时间：2008-10-02T18:28:16.660
> 
> 标签：java, eclipse, svn, version-control

我的一个同事让我检查我的一些代码，他给我发了一个差异文件。一般来说，我对差异或版本控制并不陌生，但由于他所做的更改，差异文件很难阅读。具体来说，他使用了“提取方法”功能，并对一些方法进行了重新排序。从概念上讲，很容易理解，但看差异，很难说出他做了什么。对我来说，检查以前的版本并使用 Eclipse 的“比较”功能要容易得多，但它仍然很笨拙。

是否有任何版本控制系统存储与重构相关的元数据。当然，这将是特定于 IDE 和编程语言的，但我们都使用 Eclipse 和 Java！也许有一些标准可以让 IDE 和版本控制实现很好地发挥作用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T18:43:15.173

Eclipse 可以[导出重构历史](http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/tasks-240.htm)（参见[3.2 发行说明](http://mirror.calvin.edu/eclipse/downloads/drops/S-3.2M5-200602171115/eclipse-news-M5.html)）。然后，您可以通过 Eclipse 中的预览查看重构更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T18:44:32.177

我不知道在重新排列文件时比较工具会做得很好。一般来说，由于这类问题，这是一个坏主意。人们经常这样做只是为了满足自己的风格，这是更改代码的一个糟糕的、糟糕的理由。它可以有效地破坏历史，就像重新格式化整个文件一样，除非必要，否则永远不要这样做（即它已经是一团糟且不可读）。

另一个问题是工作代码可能会因为某人的风格偏好而被破坏。如果它没有损坏，请不要修复它！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T18:52:31.847

不久前我问了一个[类似的问题](https://stackoverflow.com/questions/78339)，但从未得到满意的答案。我会看你的问题，看看人们想出了什么。

对于您的特定情况，最好使用 diff 作为指南来查看文件的最新版本。这也是我在我的情况下一直在做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T19:18:51.393

重构历史功能对我来说是新的，但我喜欢它听起来的方式。对于较少特定于工具的方法，我喜欢发送补丁文件。审查人员只是应用补丁并审查结果，然后他们可以在完成后恢复到版本控制中的版本。

# forms - 限制信用卡处理脚本/机器人的影响

> ID：163837
> 
> 赞同：10
> 
> 时间：2008-10-02T18:28:35.600
> 
> 标签：forms, credit-card, payment, fraud-prevention

我参与了为非营利组织建立捐赠表格。我们最近受到了一轮快速的低美元提交的打击。许多是无效卡，但有一些通过了。显然有人写了一个脚本来检查一堆卡号的有效性，可能是为了以后可以卖掉它们。

关于如何在未来预防或限制这种影响的任何想法？

我们可以控制系统的所有方面（代码、网络服务器等）。是的，表格通过 https 运行。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T18:39:10.660

当检测到来自单个 IP 地址或小范围地址的大量无效事务时，阻止该地址/网络。

如果正在使用僵尸网络，这将无济于事。您仍然可以检测到大量的低金额提交，并在您受到攻击时进行推断；在此期间，停止提交低金额的提交，以延长提交时间；为小额捐款引入验证码；请咨询您银行的防欺诈部门，以防他们利用您的服务器日志来抓捕犯罪者。

强制捐赠者创建账户以进行捐赠；使用验证码保护帐户创建，并限制来自任何帐户的捐款。

将允许的最低捐款提高到诈骗者以这种方式使用您不再具有经济意义的程度。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-21T15:39:47.487

您可能希望利用大多数人启用了 javascript 而机器人没有启用的事实，而不是会惹恼用户的 CAPTCHA。只需创建一小段 javascript，它在运行时会在隐藏字段中插入特定值。

对于那些禁用了 Javascript 的用户，您可以显示验证码（使用`<noscript>`标签），然后只有在这些措施中的任何一个检查通过时，您才能接受提交。

为了最大程度地让作恶者感到烦恼，您可以在计算上难以区分成功消息和失败消息（比如说，除了一张显示消息的图片之外，一切都是一样的），但对于人类来说很容易理解。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T18:33:02.983

将来自同一 IP 地址的提交限制为每分钟一次，或任何一个真实的人填写表格所需的合理时间

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T18:40:52.700

> 将最低捐款提高到诈骗者以这种方式使用您不再具有经济意义的程度通常会有所帮助。

这。无论如何，你能以低于 5 美元的价格获得多少合法捐款？

# python - python的WPF替代品

> ID：163881
> 
> 赞同：7
> 
> 时间：2008-10-02T18:35:16.207
> 
> 标签：python, user-interface

python中的WPF（Windows Presentation Foundation）有什么替代品吗？

[http://msdn.microsoft.com/en-us/library/aa970268.aspx#Programming_with_WPF](http://msdn.microsoft.com/en-us/library/aa970268.aspx#Programming_with_WPF)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T18:41:08.550

这是[Python GUI 工具包](http://wiki.python.org/moin/GuiProgramming)的列表。

此外，您可以[使用 IronPython 直接使用 WPF](http://stevegilham.blogspot.com/2007/07/hello-wpf-in-ironpython.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T18:38:46.417

你可能想看看[pygtk](http://www.pygtk.org/)和[glade](http://glade.gnome.org/)。[这](http://www.learningpython.com/2006/05/07/creating-a-gui-using-pygtk-and-glade/)是一个教程。

[Python Wiki](http://wiki.python.org/moin/FrontPage)上有很长[的替代方案列表](http://wiki.python.org/moin/GuiProgramming)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T18:42:38.017

尝试将 python 绑定到 QT 图形库的[PyQt 。](http://www.ibm.com/developerworks/linux/library/l-qt/)该文章末尾还有一些其他链接：

*   安吉
*   PyGTK
*   外汇牌价
*   wxPython
*   win32ui

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T18:47:36.647

如果您在 Windows 上并且想要使用 WPF（而不是替代方案），则可以将其与[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)（python 的 .NET 版本）一起使用。

这是一个简单的例子：[http ://stevegilham.blogspot.com/2007/07/hello-wpf-in-ironpython.html](http://stevegilham.blogspot.com/2007/07/hello-wpf-in-ironpython.html)

# sql - SQL 查询：在多行上模拟“与”而不是子查询

> ID：163887
> 
> 赞同：10
> 
> 时间：2008-10-02T18:36:59.543
> 
> 标签：sql, join

假设我有一个包含两列的“标签”表：**tagid**和**contentid**。每行代表分配给一段内容的标签。我想要一个查询，它会给我每条用 tagid 334、338 和 342 标记的内容的 contentid。

执行此操作的“简单”方法是（*伪代码*）：

```
select contentid from tags where tagid = 334 and contentid in (
    select contentid from tags where tagid = 338 and contentid in (
        select contentid from tags where tagid = 342
    )
) 
```

然而，我的直觉告诉我，有更好、更快、更可扩展的方法来做到这一点。例如，如果我需要找到 12 个标签的交集怎么办？这很快就会变得可怕。有任何想法吗？

**编辑**：原来这也包含在[这篇优秀的博客文章](http://weblogs.sqlteam.com/jeffs/jeffs/archive/2007/06/12/60230.aspx)中。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-02T18:41:17.440

```
SELECT contentID
FROM tags
WHERE tagID in (334, 338, 342)
GROUP BY contentID
HAVING COUNT(DISTINCT tagID) = 3

--In general
SELECT contentID
FROM tags
WHERE tagID in (...) --taglist
GROUP BY contentID
HAVING COUNT(DISTINCT tagID) = ... --tagcount 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T04:17:36.273

在一个非常大的对象和标签数据库上，这是一个比我更快的解决方案。这是三标记交叉点的示例。它只是在对象标签表 ( ) 上链接许多连接`objtags`以指示相同的对象，并在`WHERE`子句中规定标签 ID：

```
SELECT w0.objid

FROM       objtags t0
INNER JOIN objtags t1 ON t1.objid=t0.objid
INNER JOIN objtags t2 ON t2.objid=t1.objid

WHERE t0.tagid=512
  AND t1.tagid=256
  AND t2.tagid=128 
```

我不知道为什么它运行得更快。它的灵感来自 MusicBrainz 服务器中的搜索代码。在 Postgres 中执行此操作，我通常会比解决方案获得约 8-10 倍的加速`HAVING COUNT(...)`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T18:40:35.103

我能想到的唯一替代方法是：

```
select a.contentid from tags a
inner join tags b on a.contentid = b.contentid and b.tagid=334
inner join tags c on a.contentid = c.contentid and c.tagid=342
where a.tagid=338 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T18:45:02.033

我不知道这是否更好，但它可能更易于维护

```
select contentid from tags where tagid = 334
intersect
select contentid from tags where tagid = 338
intersect
select contentid from tags where tagid = 342 
```

您必须动态构建它，这不会像您原来的解决方案那样糟糕。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-02T18:42:02.043

什么类型的 SQL？MS SQL Server、甲骨文、MySQL？

在 SQL Server 中，这不等于：

```
select contentid from tags where tagid IN (334,338,342) 
```

# video - 一个 RTP 会话中的多个 H.264 视频流

> ID：163898
> 
> 赞同：11
> 
> 时间：2008-10-02T18:39:32.593
> 
> 标签：video, streaming, h.264, rtp

我想在流式视频应用程序中动态切换视频源。然而，不同的视频源具有独特的图像尺寸。我可以为每个视频源生成单独的 SDP 文件，但我想将它们组合成一个 SDP 文件，以便查看客户端可以在视频源更改时自动调整显示窗口的大小。以下是两个示例 SDP 文件：

640x480.sdp：

```
v=0
o=VideoServer 305419896 9876543210 IN IP4 192.168.0.2
s=视频流640x480
t=0 0
c=IN IP4 192.168.0.2
m=视频 8000/2 RTP/AVP 96
a=rtpmap:96 H264/90000
a=fmtp:96 打包模式=0；配置文件级别 ID = 4D4033；sprop 参数集=Z01AM5ZkBQHtCAAAAwAIAAADAYR4wZU=,aO48gJ==
a=控制：trackID=1

```

960x480.sdp：

```
v=0
o=VideoServer 305419896 9876543210 IN IP4 192.168.0.2
s=视频流960x480
t=0 0
c=IN IP4 192.168.0.2
m=视频 8000/2 RTP/AVP 96
a=rtpmap:96 H264/90000
a=fmtp:96 打包模式=0；配置文件级别 ID = 4D4033；sprop 参数集=J01AM5WwPA9sBAIA,KO4G8gA=
a=控制：trackID=1

```

如何将这些单独的文件组合成一个 SDP 文件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-23T21:12:12.027

您的两个 sdp 示例中的参数非常接近 - 流名称和 sprop-parameter-sets 不同。我假设您不关心流名称。如果您需要单独的 sprop-parameter-sets 并且客户端很好地支持标准，您可以为每个分辨率使用单独的动态有效负载类型并具有单个 SDP，如下所示：

```
    v=0
    o=VideoServer 305419896 9876543210 IN IP4 192.168.0.2
    s=视频流640x480
    t=0 0
    c=IN IP4 192.168.0.2
    m=视频 8000/2 RTP/AVP 96 97
    a=rtpmap:96 H264/90000
    a=fmtp:96 打包模式=0；配置文件级别 ID = 4D4033；sprop 参数集=Z01AM5ZkBQHtCAAAAwAIAAADAYR4wZU=,aO48gJ==
    a=rtpmap: 97 H264/90000
    a=fmtp: 97打包模式=0；配置文件级别 ID = 4D4033；sprop 参数集=J01AM5WwPA9sBAIA,KO4G8gA=
    a=控制：trackID=1

```

与其他答案类似，如果您实际上不需要不同的流名称或不同的 sprop-parameter-sets，您应该能够使用您的第一个 SDP 并在流中切换格式。我不知道 H.264 或您的特定解码器的实际有效负载足以确保这将在您的应用程序中工作，但在视频会议应用程序中允许在分辨率之间动态切换而无需发出更改信号或需要单独的动态是很常见的有效载荷类型。

尽管您可以像另一个答案中提到的那样连接两个 SDP 文档，但我认为在这种情况下它不会有帮助。我相信 H.264 解码器一次只能使用一个 sprop-parameter-sets 参数。由于两个 SDP 将具有相同的有效负载类型、源端口等，因此接收器将不知道何时使用哪个 sprop-parameter-sets 参数。更新：请注意，有些实现是在带内而不是从 SDP（或仅最初来自 SDP）中获取它们的 sprops。如果这适用于您的环境，则可以在带内更新 SDP sprop-parameter-sets

参考：

1.  [H.264 视频的 RFC 3984 RTP 有效负载格式](http://www.ietf.org/rfc/rfc3984.txt)
2.  [新提议的 H.264 RTP 有效载荷格式 RFC 6184](https://www.rfc-editor.org/rfc/rfc6184)
3.  [RFC 4566 SDP：会话描述协议](https://www.rfc-editor.org/rfc/rfc4566.html)

[抱歉没有给出完整的引用-请随时纠正]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T10:58:48.543

我已经查看了 RFC ( [RFC2327 - SDP: Session Description Protocol](http://www.faqs.org/rfcs/rfc2327.html) )，看来您可以连接两个 SDP 文档。该文件明确指出：

> 当 SAP 传送 SDP 时，每个数据包只允许一个会话描述。当通过其他方式传送 SDP 时，**可以将许多 SDP 会话描述连接在一起（指示会话描述开始的“v=”行终止先前的描述）**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-06T09:10:02.227

我认为这取决于您的解码器。如果它支持在流内改变参数，那么如果你可以告诉编码器在改变分辨率时放置相应的头部，你的解码器应该会自动切换。

你的问题到底是什么？是：如何在不停止/重新启动流的情况下更改分辨率？

我不认为您可以提前告诉解码器，这是您将通过一些 sdp 魔术看到的潜在分辨率。要么你的解码器能够理解H264参数变化，然后你就没事了，要么你必须停止重新启动整个事情，然后动态sdp就足够了。

我知道，例如，VLC 能够检测 MP4 编码的变化（例如从可变比特率移动到恒定比特率），但是如果你改变分辨率就会崩溃你唯一能用 sdp 做的就是结合不同的媒体描述，例如具有不同的动态有效负载类型和不同的 control-id 属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-05T17:56:13.583

您可以进行动态有效负载更改或流内参数集更改，或 SIP re-INVITE。

有效负载更改有一个问题，如果您不控制编码器和解码器，您需要确保另一端接受两个有效负载，并且它们会正确切换有效负载（并且对您来说足够快 - 对此没有要求）。

如果参数集数据包丢失，则流内更改会出现问题。您可以使用一组不同的参数集（更改时从参数集 1 切换到 2）以避免错误解码 - 如果这些集丢失，您应该只得到一张冻结或空白的图片。我建议重新传输它们几次（不要太快连续）。

SIP re-INVITE 是带外和握手的，因此是安全的，但会增加任何开关的延迟，并且可能会根据接收器而出现故障，并且可能会被拒绝。

（注意：我是 RFC 3984bis 的作者，RFC 3984 的更新）

# jquery - 在文件系统上运行的 HTML/Javascript 应用程序，安全问题

> ID：163900
> 
> 赞同：3
> 
> 时间：2008-10-02T18:40:03.013
> 
> 标签：jquery, ajax, xss, filesystems

我正在整理一些业务人员可以在他们的本地文件系统上运行的小工具，因为我们不想为它设置主机。

基本上，它只是 HTML + Javascript（使用 jQuery）使用 REST 从第 3 方提取一些报告。

问题是，FF3 和 IE 不允许 ajax 调用，我得到：

```
Access to restricted URI denied" code: "1012 
```

显然这是一个 XSS 问题......我该如何解决它？返回的数据是 XML 格式。

我试图这样做：

```
$.get(productUrl, function (data){
    alert (data);
}); 
```

**编辑**：要明确...我没有为此设置内部主机（太多繁文缛节），并且由于正在检索数据，我们不能在外部托管它。

**编辑#2**：一些测试表明我可以使用 IFRAME 来提出请求。有谁知道使用隐藏的 IFRAME 是否有任何缺点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T00:06:05.447

在类似的情况下，我的解决方案是使用 Web 标记，这是 IE 识别的特殊 HTML 注释。它将页面放置在不同的安全区域中。

参考：[MSDN](http://msdn.microsoft.com/en-us/library/ms537628(VS.85).aspx)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-02T18:50:13.333

如果您安装了 Python，则提供文件的网络服务器可以很简单

```
python -c “import SimpleHTTPServer;SimpleHTTPServer.test()” 
```

**编辑：** 原始海报不能使用这种方法，但总的来说，我认为这是为未来有此问题的用户解决此特定问题的方法。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-03T12:02:07.247

您是否控制提供数据的服务器？如果是这样，您可以设置回调。基本思想是您在脚本中有一个处理传入数据的函数（在您的情况下是一个 XML 字符串）。然后，服务器使用您的回调函数的 JavaScript 片段以字符串作为参数来响应请求。而不是使用 AJAX，而是向页面添加一个新的脚本标记。这是 JSONP 的基础。它看起来像这样。

本地页面。

```
<script>
    function callback(str) {
        alert(str);
    }
    function makeRequest(param) {
        var s = document.createElement('script');
        s.src = 'http://serveranywhere/script.bla?' + params;
        document.getElementsByTagName[0].appendChild(s);
    }
</script> 
```

远程服务器返回

```
callback('<xml><that><does><something></something></does></that></xml>'); 
```

现在，当脚本添加到页面时，函数回调将根据您提供的字符串执行。jQuery 调用在 $.ajax 调用中使用 JSONP 为您完成所有这些工作。希望这可以帮助。

# user-interface - 您如何决定一个项目是基于 Web 还是基于桌面？

> ID：163913
> 
> 赞同：14
> 
> 时间：2008-10-02T18:43:17.560
> 
> 标签：user-interface, desktop-application, web-applications

我无法决定我的项目是基于 Web（如在 Web 应用程序中）、基于桌面（桌面应用程序）还是可以同步或连接到云的桌面应用程序。

我不知道其他人是否会对这个应用程序感兴趣，而且它只适合我，所以我倾向于桌面应用程序。如果出于某种原因，我完成了它，发布了它，并且人们真的喜欢它，我可能会看到让它同步到云端（想想 v2）。但我不确定做出如此彻底的改变有多难，而且我不想最终得到一些无用的好东西，因为我什至在开始项目之前就做出了错误的选择。

对此有任何指导吗？有什么经验法则或最佳实践吗？有什么亲身经历吗？

如果语言很重要，我考虑 Java 只是因为我对它最满意，而且它可以很容易地让我与我的朋友分享它以进行测试，如果我遇到困难并需要其他人的帮助。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-02T18:51:13.517

我一般会问几个问题：

*   它甚至可以在网络上完成吗？不久前我没有涉及图像编辑组件，并且必须是一个网络应用程序。完成这项工作涉及很多痛苦，而桌面应用程序将是一个更好的方法。
*   我需要从任何地方访问它吗？是的，您可以将其加载到拇指驱动器上，但在这种情况下，网络更为可行。
*   会有多个用户吗？这可以是任何一种方式，但“长尾”的东西通常意味着网络。
*   你想用什么技术？最新最好的基于 WPF 的 UI？桌面（是的，是的，silverlight，我们不要去那里好吗？）。Django或其他人的脑死愚蠢的简单用户管理？网络。
*   如果它是一个 Web 应用程序，您是否需要担心 SQL 注入、XSS 等常见的攻击媒介？桌面应用程序在这里也有自己的问题，但曝光率往往较低。
*   它的资源密集程度如何？10 个用户会扼杀 Web 服务器的性能吗？
*   在桌面上进行版本控制可能会很痛苦，而对于 webapp，每个人都在同一个版本上。不过，这可能会咬你一口，请参阅新 Facebook 用户的回击。

编辑：

*   成本也可能是一个因素。具有数据库后端的 Web 应用程序通常意味着 Web 服务器。如果您想坚持使用 Microsoft Stack，您将需要价格昂贵的 SQL Server 许可证。开源更便宜，但可能并非在所有情况下都是一种选择。“服务”桌面应用程序通常更便宜。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T18:47:22.670

如果您作为网络​​应用程序发布，则不必将其移植过来。无论您走到哪里，您都可以访问它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T18:50:58.713

我的选择主要基于 GUI。如果 GUI 会很复杂，并且（需要快速或者需要花费大量时间来处理它的某些方面），那么我将使用桌面。如果它很简单，并且总是有小数据集可以立即使用，那么我将使用 Web。

我曾开发过一个作为网络应用程序制作的应用程序，显然它更适合桌面。这是一个巨大的失败。我不知道客户如何忍受它，因为我肯定不会使用它。桌面版（花了 6 个多月的时间重新编写）将网络版从水中吹走了。

话虽如此，我已经看到了一些不错的网络应用程序。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T18:53:05.090

我只能建议几个相关的因素。您如何确定该因素的答案和权重取决于您和其他情况：

*   你的听众是什么？你对他们有控制权吗？
*   您期望实现的交互有多复杂？
*   您需要近乎实时的数据更新吗？
*   您希望在首次发布后多久更新一次应用程序？
*   您期望一组定义明确的客户端平台，还是无法预测？

请注意，您的选择还可以包括 Java WebStart 应用程序，它可以减轻典型桌面应用程序的一些缺点。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T19:00:23.167

我想说大多数应用程序应该是基于桌面的。优点是更快、更流畅的应用程序。

只有在有明显好处的情况下，您才应该创建一个 Web 应用程序，例如从任何地方访问。（如果您的应用需要这样做。）

Web 应用程序的一个缺点也可能是它依赖于开发人员，如果你停止支持它，你的所有用户（如果你有的话）就不能再使用它了。此外，用户可能不愿意在线存储他们的数据。

最终，这取决于您要编写什么样的应用程序。即使您将其创建为桌面应用程序，您也可以稍后为网络重写它。无论如何，通常 2.0 版本的软件几乎需要完全重写。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T18:58:47.133

有时网络可能很好，有时则不是。我们正处于进入网络的新浪潮中，但不要忘记一些事情：

*   由于多个浏览器，Web 中的 GUI 更加复杂
*   需要在您的系统上工作的人可能不喜欢整天在浏览器中工作
*   某些应用程序的 Web 可能会变慢（图像编辑，需要大量 CPU 的艰苦工作）
*   像 Visual Studio 这样的 Rapid Gui for winform 比 web 更快

但是web在部署和可移植性方面有很多优势。如果您的系统结构良好，您可以稍后使用 MVC 构建两者或更改为另一个。只要改变你的视觉，你会没事的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T19:25:55.383

如果这是一个供我的多个用户使用的应用程序，并且具有共享数据，那么您可能无论如何都需要一台服务器。在这种情况下，我会倾向于 Web 应用程序。否则，您会遇到在桌面和服务器之间同步数据的复杂性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T19:31:08.837

到目前为止没有在列表中的两个重要问题：

*   第一个版本是否有任何需要对硬件进行低级访问的功能？
*   *未来的*版本是否会有任何需要对硬件进行低级访问的功能？

回答第一个问题很容易，但考虑一下第二个问题可以让你在以后的路上不那么头疼。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-02T18:48:45.503

我的默认选择是使用 Web 解决方案，因为它更容易部署并且通常是多平台的。我使用 winforms 应用程序的唯一时间是当有紧迫的安全、性能或功能问题需要它时。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-10-02T18:49:49.870

以前您已经编写了一个桌面应用程序，因为工具更好，而且您编写它的速度更快。人们曾经想要 Web 应用程序，但最终总是使用桌面。

现在情况不同了，您可以快速轻松地编写 Web 服务，因此没有理由不采用基于 Web 的方式。

基于 Web 的优点是灵活性、可扩展性和易于部署。它不会像桌面应用程序那样响应迅速，但如果您考虑一下您的设计，这并不是什么大问题。

# sql - 在 SQL Server 中使用 OPTION(MAXDOP 1) 的目的是什么？

> ID：163917
> 
> 赞同：60
> 
> 时间：2008-10-02T18:43:41.897
> 
> 标签：sql, sql-server

我从来没有清楚地理解`MAXDOP`. 我确实知道它使查询更快，并且它是我可以用于查询优化的最后一项。

但是，我的问题是，何时何地最适合在查询中使用？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-03T15:30:24.847

正如 Kaboing 提到的，`MAXDOP(n)`实际上控制查询处理器中正在使用的 CPU 内核的数量。

在完全空闲的系统上，SQL Server 将尝试尽快将表拉入内存并在内存中将它们连接起来。在您的情况下，最好使用单个 CPU 来执行此操作。`OPTION (FORCE ORDER)`这可能与使用which 强制查询优化器使用您指定的连接顺序具有相同的效果。在某些情况下，我看到`OPTION (FORCE PLAN)`将查询的执行时间从 26 秒减少到 1 秒。

Books Online 继续说，可能的值为`MAXDOP`：

> 0 - 根据当前系统工作负载使用可用 CPU 的实际数量。这是默认值和推荐设置。
> 
> 1 - 抑制并行计划生成。该操作将串行执行。
> 
> 2-64 - 将处理器数量限制为指定值。根据当前的工作负载，可以使用更少的处理器。如果指定的值大于可用 CPU 的数量，则使用实际的可用 CPU 数量。

我不确定最好的用法是什么，但是我会猜测一下，如果你有一个有 8 个分区的表，由于 I/O 限制，`MAXDOP`你会想要指定，但我可能是错的。`MAXDOP(8)`

以下是我发现的一些快速链接`MAXDOP`：

[在线书籍：并行度](http://msdn.microsoft.com/en-us/library/ms188611.aspx)

[用于配置 MAXDOP 选项的一般准则](http://support.microsoft.com/kb/329204)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-03T09:53:39.013

这是对 SQL Server 中并行性的一般漫谈，它可能无法直接回答您的问题。

来自在线图书，关于 MAXDOP：

> 设置查询处理器可用于执行单个索引语句的最大处理器数。根据当前的系统工作负载，可以使用更少的处理器。

请参阅[Rickie Lee](http://www.cnblogs.com/rickie/archive/2008/03/18/1111965.html)关于并行性和 CXPACKET 等待类型的博客。这很有趣。

一般来说，在 OLTP 数据库中，我的观点是，如果查询成本如此之高，需要在多个处理器上执行，则需要将查询重写为更高效的东西。

为什么添加 MAXDOP(1) 会得到更好的结果？没有实际的执行计划很难说，但它可能很简单，因为执行计划与没有 OPTION 的情况完全不同，例如使用不同的索引（或更可能）以不同的方式连接，使用 MERGE 或 HASH 连接。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-06-09T14:44:01.810

顺便说一句，MAXDOP 显然可以用作解决可能令人讨厌的错误的解决方法：

[返回的标识值并不总是正确的](http://connect.microsoft.com/SQLServer/feedback/details/328811/scope-identity-sometimes-returns-incorrect-value#)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-18T20:43:45.823

SQL Server 中存在一些输入异常的并行化错误。OPTION(MAXDOP 1) 将避开它们。

编辑：旧的。我的测试主要是在 SQL 2005 上完成的。其中大多数似乎不再存在，但每隔一段时间，我们就会质疑 SQL 2014 做一些愚蠢的事情的假设，我们回到旧的方式并且它有效。我们从未设法证明这不仅仅是在最近的案例中生成的错误计划，因为可以依靠 SQL Server 在新版本中正确使用旧方法。由于所有情况都是 IO 绑定查询 MAXDOP 1 不会受到伤害。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-08T18:22:35.967

根据我观察到的性能问题，加上我的两分钱。

如果简单的查询被不必要地并行化，它可能会带来比解决问题更多的问题。但是，在将 MAXDOP 作为“膝跳”修复添加到查询之前，需要检查一些服务器设置。

在[Jeremiah Peschka - Five SQL Server Settings to Change](https://www.brentozar.com/archive/2013/09/five-sql-server-settings-to-change/)中，提到了 MAXDOP 和“COST THRESHOLD FOR PARALLELISM”（`CTFP`）作为需要检查的重要设置。

注意：Paul White 还提到`max server memory`了一个要检查的设置，以响应[从 SQL Server 2005 迁移到 2012 后的性能问题](https://dba.stackexchange.com/questions/115228/performance-problem-after-migration-from-sql-server-2005-to-2012?rq=1)。一篇不错的 kb 文章是[使用大量内存会导致 SQL Server 中的计划效率低下](https://support.microsoft.com/en-us/kb/2413549)

[Jonathan Kehayias - 从计划缓存中调整“并行性成本阈值”](https://www.sqlskills.com/blogs/jonathan/tuning-cost-threshold-for-parallelism-from-the-plan-cache/)有助于找出`CTFP`.

[为什么忽略并行的成本阈值？](https://dba.stackexchange.com/questions/81980/why-is-cost-threshold-for-parallelism-ignored)

[Aaron Bertrand - 您应该对并行性感到紧张](https://sqlblog.org/2009/03/21/six-reasons-you-should-be-nervous-about-parallelism)的六个原因讨论了 MAXDOP 是解决方案的某些场景。

[Paul White - 强制并行查询执行计划](http://web.archive.org/web/20180404164406/http://sqlblog.com/blogs/paul_white/archive/2011/12/23/forcing-a-parallel-query-execution-plan.aspx)中提到了并行抑制组件

# language-agnostic - 从 Outlook 2007 中提取自动完成电子邮件

> ID：163919
> 
> 赞同：2
> 
> 时间：2008-10-02T18:44:15.890
> 
> 标签：language-agnostic, winapi, outlook

我需要提取在 Outlook 2007 中显示为自动完成条目的所有电子邮件。我主要需要创建一个我过去发送电子邮件的所有电子邮件地址的列表，并将它们转储到 Excel 中。

我应该以某种方式通过 COM 连接到 Outlook 吗？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T18:58:17.137

所有这些信息都在本地设置中的一个文件中，扩展名为 NK2。

> c:\Documents and Settings\{USERNAME}\Application Data\Microsoft\Outlook\{USERNAME}.NK2

此[实用程序](http://www.nirsoft.net/utils/outlook_nk2_autocomplete.html)可以读取/编辑内容。

文件格式本身在这里解释：[Google Code debunk2 NK2 文件格式的解释](http://code.google.com/p/debunk2/wiki/fileformat)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-02-14T19:37:57.707

请注意，Outlook 2010 和更高版本将昵称存储在邮箱存储中，而不是存储在 NK2 文件中。您可以解析用于存储数据的 blob（它是二进制的）或使用 Redemption 及其 RDONiocknames 集合 - 请参阅[http://www.dimastr.com/redemption/rdonicknames.htm](http://www.dimastr.com/redemption/rdonicknames.htm)

# algorithm - 地理标记或地理标签文本内容的方法

> ID：163923
> 
> 赞同：9
> 
> 时间：2008-10-02T18:44:32.677
> 
> 标签：algorithm, statistics, nlp, named-entity-recognition

有哪些好的算法可以用城市/地区或原产地自动标记文本？也就是说，如果博客是关于纽约的，我怎么能以编程方式讲述。是否有任何包装/文件声称可以肯定地做到这一点？

我已经研究了一些基于 tfidf 的方法、专有名词交集，但到目前为止，还没有取得惊人的成功，我会很感激想法！

给定一些主题列表，更一般的问题是关于将文本分配给主题。

简单/天真的方法更喜欢完全使用贝叶斯方法，但我很开放。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-02T21:38:52.570

您正在寻找[命名实体识别](https://secure.wikimedia.org/wikipedia/en/wiki/Named_entity_recognition)系统或简称 NER。有[几个](http://nltk.sourceforge.net/index.php/Main_Page) [很好的](http://opennlp.sourceforge.net/index.html) [工具包](http://alias-i.com/lingpipe)可以帮助你。特别是 LingPipe 有一个非常[不错的教程](http://alias-i.com/lingpipe/demos/tutorial/ne/read-me.html)。[CAGEclass](http://cageclass.sourceforge.net/)似乎是针对地理地名的NER，但我还没有使用它。

[这是](http://lingpipe-blog.com/2008/08/10/wheres-georgia-db-linkage-isnt-easy/)一篇很好的博客文章，介绍了 NER 与地名的困难。

如果您使用 Java，我建议您使用 LingPipe NER 类。OpenNLP 也有一些，但前者有更好的文档。

如果您正在寻找一些理论背景，[查韦斯等人。(2005)](http://www.linguateca.pt/documentos/gkb_technical_report.pdf)构建了一个有趣的同义词并记录了它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T21:46:48.197

[潜在语义映射](http://en.wikipedia.org/wiki/Latent_semantic_mapping)似乎很合适。这与您可能会发现的算法一样天真。

# c++ - 常见数据类型的长度是多少？

> ID：163938
> 
> 赞同：2
> 
> 时间：2008-10-02T18:48:09.157
> 
> 标签：c++, 64-bit, types

int 包含多少字节，long 包含多少字节？

语境：

*   C++
*   32位电脑
*   64位电脑有什么区别吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T18:49:33.380

请参阅[有关它的维基百科文章](http://en.wikipedia.org/wiki/Integer_(computer_science))。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-02T18:50:15.610

它是特定于平台和编译器的。在 c 或 c++ 中执行 sizeof(int) 和 sizeof(long)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-02T18:51:03.127

（我假设你在谈论 C/C++）

它取决于实现，但此规则应始终有效：

sizeof(short) <= sizeof(int) <= sizeof(long)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T19:04:55.170

正如其他人所说，这取决于您使用的编译器（甚至是您选择的编译器选项）。

然而，在实践中，使用许多 32 位机器的编译器，您会发现：-

*   字符：8位
*   短：16位
*   整数：32 位
*   长：32位
*   long long：64 位（如果支持）

C标准基本上说*long*不能比*int*短，而 int不能比*short 短*，等等......

对于 64 位 CPU，这些通常不会改变，但您**`MUST`**要注意指针和整数的大小通常不同：

```
 sizeof(int) != sizeof(void*) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T18:49:48.327

这取决于编译器。

在 32 位系统上，int 和 long 都包含 32 位。在 16 位系统上，int 是 16 位，long 是 32。

还有其他组合！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T18:55:15.973

我认为这取决于您使用的硬件。在 32 位平台上，int 和 long 通常都是 4 个字节。在 C 中，您可以使用 sizeof() 运算符来找出答案。

```
int intBytes;
long longBytes;
intBytes= sizeof(int);
longBytes = sizeof(long); 
```

我不确定 long 是否在 64 位架构上变为 8 个字节，或者它是否保持为 4。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T18:50:14.567

这取决于你的编译器。还有你的语言，就此而言。尝试问一个更具体的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T18:51:08.400

这在很大程度上取决于您使用的语言。

在 C 中，“int”总是处理器的字长。所以 32 位架构上的 32 位或 4 字节。

# sql - 是否可以确定 SQL Server 2000 中最后一次修改存储过程的时间？

> ID：163957
> 
> 赞同：2
> 
> 时间：2008-10-02T18:51:04.563
> 
> 标签：sql, sql-server, stored-procedures

我知道你可以在 SQL Server 2005 中做到这一点，但我对 2000 年不知所措。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T19:10:32.723

据我所知不是。

为了解决这个问题，我在 Visual Studio 数据库项目中管理我的存储过程。每个存储过程都在自己的文件中，并且在文件顶部有一个 drop 命令。当我通过 Visual Studio 更新存储时，由于 drop/create 语句，数据库的创建日期在数据库中更新。通过这种方式，我可以使用 SQL Server 2000 中的创建日期作为最后修改日期。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T19:09:49.417

从我过去对此所做的所有研究来看，不幸的是，我不得不说不。SQL Server 2000 根本不存储此信息，而且我从未见过任何检索它的解决方案。

有一些替代方法，但它们都涉及用户干预。除了将存储过程脚本保存在源代码控制系统中之外，我认为下一个最佳方法是在存储过程中使用注释。不理想，但如果您想跟踪更新的内容，总比没有好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T11:32:38.173

```
SELECT crdate
FROM   sysobjects 
WHERE  name = 'proc name here' 
AND    type = 'P' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-27T16:37:39.900

看起来您可以使用：SELECT * FROM INFORMATION_SCHEMA.ROUTINES

在这里找到：[日期对象上次修改](https://stackoverflow.com/questions/78471/date-object-last-modified/2342967#comment33469725_2342967)

# c++ - 为嵌入式应用程序从 std::string 切换到 std::wstring？

> ID：163962
> 
> 赞同：4
> 
> 时间：2008-10-02T18:51:33.860
> 
> 标签：c++, unicode, stl, embedded

到目前为止，我一直在我的嵌入式系统（路由器、交换机、电信设备等）的 C++ 应用程序中使用 std::string。

对于下一个项目，我正在考虑从 std::string 切换到 std::wstring 以获得 Unicode 支持。例如，这将允许最终用户在命令行界面 (CLI) 中使用中文字符。

我应该期待什么并发症/头痛/惊喜？例如，如果我使用仍然使用 std::string 的第三方库怎么办？

由于对国际字符串的支持对我所从事的嵌入式系统类型的要求并不那么强烈，因此我只会在不会引起严重头痛的情况下这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T18:57:06.017

请注意，许多通信协议需要 8 位字符（或 7 位字符或其他变体），因此您经常需要在内部 wchar_t/wstring 数据和外部编码之间进行转换。

当您需要 Unicode 字符的 8 位表示时，UTF-8 编码很有用。（有关更多信息，请参阅[如何编写对 UTF-8 安全的代码？](https://stackoverflow.com/questions/134371/how-do-you-write-code-that-is-safe-for-utf-8)）但请注意，您可能需要支持其他编码。

越来越多的第三方库支持 Unicode，但仍有很多不支持。

我真的不能告诉你这是否值得头疼。这取决于你的要求是什么。如果您从头开始，那么从 std::wstring 开始会比稍后从 std::string 转换为 std::wstring 更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T19:45:51.623

std::wstring 是在 Windows 上保存 Unicode 字符串的好选择，但在大多数其他平台上却不是，而且对于可移植代码当然也不是。最好尝试坚持使用 std::string 和 UTF-8。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T11:40:52.483

您可能会有些头疼，因为[C++ 标准规定在写入文件时需要宽流将双字节字符转换为单字节，而这种转换的完成方式取决于实现](http://www.codeproject.com/KB/stl/upgradingstlappstounicode.aspx)。

# .net - .Net：将对象的通用列表转换为数据集

> ID：163973
> 
> 赞同：1
> 
> 时间：2008-10-02T18:54:06.787
> 
> 标签：.net, generics, dataset

有没有人有代码可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T18:56:47.733

[基思·埃尔德（Keith Elder](http://keithelder.net/blog/archive/2006/03/10/Converting-Generic-Lists-or-Collections-to-a-DataSet.aspx)）就是一个例子。

# asp.net - Oracle/ASP.NET 环境的最佳源代码控制解决方案？

> ID：163980
> 
> 赞同：3
> 
> 时间：2008-10-02T18:56:11.417
> 
> 标签：asp.net, oracle, version-control, development-environment

我正在尝试为 5 位开发人员计划一种方法，让他们使用 Visual Studio 2005/2008 在开发 Web 服务器上针对 Oracle 8i（即将成为 10g）数据库协作开发 ASP.NET Web 应用程序。

开发人员要么在本地网络上，要么通过 vpn 进入（不是非常快的连接），

我评估了最新的 Visual SourceSafe，但遇到了以下问题：

1）我们不能使用去中心化开发，因为我们不能将一个开发预言机数据库复制到所有开发者的计算机上。此外，VPN 速度太慢，无法让他们的本地应用程序实例连接到数据库服务器。

2) 由于 VSS 源代码不在文件系统上，调试它的唯一方法是构建应用程序并运行调试器，在集中式开发服务器上一次只有一个开发人员可以这样做。这是无法接受的。我们尝试使用影子文件夹，以便每次签入文件时，它都会发布到开发服务器上的应用程序实例，但这对于 vpn 上的远程开发人员来说失败了。

3) 由于开发人员编写了大量的 Web 代码，出于生产力的原因，重要的是当他们保存文件时，他们应该能够立即看到在开发服务器上工作的更改。

4) 没有简单的方法来实现将文件推送到生产服务器的受控过程。

关于在这些限制下工作的源代码控制解决方案有什么建议吗？

**更新：**我猜由于开发被迫在服务器上进行，我们需要采用“锁定并签入”模型。那么哪种源代码控制解决方案最适合“锁定和签入”场景？

**更新：** Visual SVN 是否支持针对开发服务器进行集中开发？如在，开发人员保存在 VS 后可以立即在开发服务器上看到他的更新？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T19:00:37.300

我使用过[Subversion](http://subversion.tigris.org/)和[TortoiseSVN](http://tortoisesvn.tigris.org/)，非常满意。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T09:41:55.603

第 1 点是由于您的数据库架构（或数据）有问题吗？

> 1.  我们不能使用分散式开发，因为我们无法将开发预言机数据库复制到所有开发人员计算机。

如果没有，我强烈建议每个开发人员都有自己的环境（Visual Studio、Oracle...），并使用您的*开发*服务器进行集成。也许你可以只给他们数据的一个子集，或者只是模式脚本。

*   [Oracle Express Edition](http://www.oracle.com/technology/products/database/xe/index.html)非常适合这种情况。此外，共享同一个数据库违反[了数据库工作规则#1](http://odetocode.com/Blogs/scott/archive/2008/01/30/11702.aspx)，根据我的经验，应该在任何可能的地方强制执行。
*   正如[Guy 建议](https://stackoverflow.com/questions/163980/best-source-control-solution-for-oracleaspnet-environment#164099)的那样，拥有一个允许任何开发人员随时重新创建其数据库模式的自动化构建。
*   更多非常有用的指南可以在[这里找到](http://odetocode.com/Blogs/scott/archive/2008/02/03/11746.aspx)（包括上面的规则#1）。
*   定义您的开发过程，以便可以进行并行开发，并且仅将锁作为最后的手段。

如果您已经设想了这些解决方案并且发现它们不适合您的情况，我很抱歉，但我真的很想表达它们以防万一......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:10:07.950

Visual Source Safe 是撒旦的产物。

查看 Subversion 和 Visual SVN（使用 Tortise SVN）。当然，Visual SVN 有点贵——每个座位 49 美元——但它是一个很棒的工具。我们有一个由 6 名程序员组成的开发团队，这对我们来说是一个很大的福音。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T19:01:38.250

如果您可以花钱，那么 Team Foundation Server 是最适合在 Visual Studio 开发环境中运行的服务器。

根据个人经验，它在 VPN 连接上运行良好。您当然可以进行自动构建。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T19:03:00.837

我会说 SVN 的价格（免费），[Perforce](http://www.perforce.com/)的易于集成。

毫无疑问，您也会听说过 GIT 和 CVS，并且有充分的理由来研究它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T19:24:04.157

有趣 - 听起来您正在服务器上处理网站项目，并且每个人都在处理相同的物理文件。我同意 SVN 远优于 VSS 并且非常适合使用，但根据我的经验，它确实适用于在本地处理代码副本的开发人员。

VSS 是一种“锁定和签入”类型的源代码控制，而 SVN 和 TFS 以及大多数其他类型是“编辑和合并”——开发人员都获取源代码的副本，根据需要编辑文件，然后将他们的更改合并到源代码控制，如果其他人同时编辑了文件，他们会将更改合并在一起。

从数据库的角度来看，我假设您正在检查您的数据库脚本，然后进行一些自动构建打包并运行它们（或者可能只是一个开发人员或 DBA 经常手动运行它们）。在这种情况下，让开发人员拥有可以使用 SVN 或 TFS 编辑和合并的脚本的本地副本是有意义的。

但是，对于在开发服务器上处理源代码共享副本的团队，您可能会在使用编辑和合并时遇到问题——源代码控制的“锁定和签入”模型可能更适合您。从腐败和稳定的角度来看，不是 VSS。

# sql - 在 MySQL 中转换 UNION 查询

> ID：163994
> 
> 赞同：1
> 
> 时间：2008-10-02T18:59:11.657
> 
> 标签：sql, mysql, dynamic, union

我有一个非常大的表（8gb），其中包含有关文件的信息，我需要针对它运行一个看起来像这样的报告：

```
(select * from fs_walk_scan where file_path like '\\\\server1\\groot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server1\\hroot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server1\\iroot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server2\\froot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server2\\groot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server3\\hroot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server4\\iroot$\\%' order by file_size desc limit 0,30)
UNION ALL
(select * from fs_walk_scan where file_path like '\\\\server5\\iroot$\\%' order by file_size desc limit 0,30)
[...]
order by substring_index(file_path,'\\',4), file_size desc 
```

此方法完成了我需要做的事情：获取每个卷的 30 个最大文件的列表。但是，这非常慢，并且“喜欢”搜索是硬编码的，即使它们位于另一个表中并且可以通过这种方式获得。

我正在寻找的是一种无需多次通过巨大桌子即可做到这一点的方法。有人有想法么？

谢谢。

PS我不能以任何方式改变巨大源表的结构。

更新：file_path 和 file_size 上有索引，但是这些子（？）查询中的每一个仍然需要大约 10 分钟，我必须至少做 22 分钟。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T19:03:40.023

你在那张桌子上有什么样的索引？该指数：

创建索引 fs_search_idx ON fs_walk_scan(file_path, file_size desc)

会显着加快此查询的速度...如果您还没有这样的查询。

更新：

您说 file_path 和 file_size 上已经有索引...它们是单独的索引吗？或者是否有一个索引将两列索引在一起？对于此查询，差异将是巨大的。即使有 22 个子查询，如果索引正确，这应该很快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T20:10:08.787

您可以使用正则表达式：

```
select * from fs_walk_scan
  where file_path regexp '^\\\\server(1\\[ghi]|2\\[fg]|3\\h|[45]\\i)root$\\' 
```

否则，如果您可以修改表结构，请添加两列来保存服务器名称和基本路径（并对其进行索引），以便您可以创建更简单的查询：

```
select * from fs_walk_scan
  where server = 'server1' and base_path in ('groot$', 'hroot$', 'iroot$')
     or server = 'server2' and base_path in ('froot$', 'groot$') 
```

您可以设置触发器以在插入记录时初始化字段，或者在之后进行批量更新以填充两个额外的列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T22:36:47.593

你可以做这样的事情......假设 fs_list 有你的“LIKE”搜索列表：

```
DELIMITER $$

DROP PROCEDURE IF EXISTS `test`.`proc_fs_search` $$
CREATE PROCEDURE `test`.`proc_fs_search` ()
BEGIN

DECLARE cur_path VARCHAR(255);
DECLARE done INT DEFAULT 0;

DECLARE list_cursor CURSOR FOR select file_path from fs_list;

DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

SET @sql_query = '';

OPEN list_cursor;

REPEAT
  FETCH list_cursor INTO cur_path;

  IF NOT done THEN
    IF @sql_query <> '' THEN
      SET @sql_query = CONCAT(@sql_query, ' UNION ALL ');
    END IF;

    SET @sql_query = CONCAT(@sql_query, ' (select * from fs_walk_scan where file_path like ''', cur_path , ''' order by file_size desc limit 0,30)');
  END IF;

UNTIL done END REPEAT;

SET @sql_query = CONCAT(@sql_query, ' order by file_path, file_size desc');

PREPARE stmt FROM @sql_query;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

END $$

DELIMITER ; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T11:27:15.737

尝试这个。
您希望获取少于 30 条记录且文件大小更大且文件路径相同的每条记录。

```
SELECT * 
FROM   fs_walk_scan a
WHERE  ( SELECT COUNT(*) 
         FROM   fs_walk_scan b 
         WHERE  b.file_size  > a.file_size 
         AND    b.file_path  = a.file_path
       ) < 30 
```

## 编辑：

显然这表现得像一条狗。那么......这个循环语法怎么样？

```
SELECT DISTINCT file_path
INTO tmp1
FROM   fs_walk_scan a

DECLARE path VARCHAR(255);

SELECT MIN(file_path)
INTO   path
FROM   tmp1 

WHILE  path IS NOT NULL DO
    SELECT * 
    FROM   fs_walk_scan
    WHERE  file_path = path
    ORDER BY file_size DESC
    LIMIT 0,30

    SELECT MIN(file_path)
    INTO   path
    FROM   tmp1
    WHERE  file_path > path 
END WHILE 
```

这里的想法是 1\. 获取文件路径列表 2\. 循环，对每个路径进行查询，这将获得 30 个最大的文件大小。

（我确实查了语法，但我对 MySQL 不是很热，所以如果它不在那里，请随意。随意编辑/评论）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-20T21:30:40.477

您可以使用分组和自加入来实现此目的。

```
SELECT substring_index(file_path, '\\', 4), file_path
from fs_walk_scan as ws1
WHERE 30<= (
select count(*) from fs_Walk_scan as ws2
where substring_index(ws2.file_path, '\\', 4) = substring_index(ws1.file_path, '\\', 4)
and ws2.file_size > ws1.file_size
and ws2.file_path <> ws1.file_path)
group by substring_index(file_path, '\\', 4) 
```

它仍然是一个 O(n) 查询（n 是组数），但更灵活、更短。

编辑：另一种方法是使用变量。您的目的的可行性将取决于您将如何运行此查询。

```
set @idx=0; set @cur_vol=0;                                                                      
SELECT file_volume, file_path, file_size FROM (
    SELECT file_volume, file_path, file_size,
    IF(@cur_vol != a.file_volume, @idx:=1, @idx:=@idx+1) AS row_index,
    IF(@cur_vol != a.file_volume, @cur_vol:=a.file_volume, 0) AS discard
    FROM (SELECT substring_index(file_path, '\\', 4) as file_volume, file_path, file_size 
        FROM fs_walk_scan
        ORDER BY substring_index(file_path,'\\',4), file_size DESC) AS a
    HAVING row_index <= 30) AS b; 
```

我还没有尝试过这段代码，但是变量的概念可以像这样用于你的目的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T19:04:06.310

像这样的东西怎么样（还没有测试过，但看起来很接近）：

```
select * from fs_walk_scan where file_path like '\\\\server' and file_path like 'root$\\%' order by file_size desc 
```

这样，您将在单个字段上进行一对比较，这通常与您所描述的相匹配。也可以使用正则表达式，但我没有这样做。

# asp.net - 通过 Web 部署项目创建虚拟目录时访问被拒绝

> ID：163997
> 
> 赞同：3
> 
> 时间：2008-10-02T19:00:47.473
> 
> 标签：asp.net, iis, tfs, windows-server-2008, web-deployment-project

我正在尝试在 TFS 解决方案中使用（VS 2008）Web 部署项目将网站部署到（TFS 2008）构建服务器以运行基于 Web 的单元测试。出于某种原因，我还无法弄清楚，它无法创建虚拟目录：

使用程序集“C:\Program Files\MSBuild\Microsoft\WebDeployment\v9.0\Microsoft.WebDeployment.Tasks.dll”中的“CreateVirtualDirectory”任务。任务“CreateVirtualDirectory”初始化 IIS Web 服务器... C:\Program Files\MSBuild\Microsoft\WebDeployment\v9.0\Microsoft.WebDeployment.targets(667,5): 错误：访问被拒绝。C:\Program Files\MSBuild\Microsoft\WebDeployment\v9.0\Microsoft.WebDeployment.targets(667,5)：错误：无法创建虚拟目录“abc”。完成执行任务“CreateVirtualDirectory”——失败。

TFSService 用户肯定在 TFS Build 机器（运行 Windows Server 2008）上的 Administrators 组中。我不知道还有什么问题。我检查了事件日志，那里没有任何线索。我可以毫无问题地通过 IIS 控制台在该机器上手动创建虚拟目录。

任何想法可能是什么问题或有关如何进一步诊断的建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T17:34:06.280

它必须是权限...您是否尝试将 TFSService 放在您所在的同一组中？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T17:39:28.267

TFS 帐户是否在与您用于连接 IIS 的帐户相同的权限下运行？按照 Craig 的建议做，将 TFS 帐户移动到您参与的组中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T11:36:39.057

我已经看到当 IIS 服务器未在默认端口上运行时发生这种情况。我建议检查 IIS 以查看它是否在端口 80 上运行，以进一步诊断您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-28T18:42:02.583

我最终设法通过从我的 TFS 构建脚本中调用 Web 应用程序的 _CopyWebApplication 构建目标来进行部署（在手动创建 IIS 虚拟目录之后）。我不得不添加一个额外的目标来获取项目中要复制的链接文件，因为内置的 _CopyWebApplication 目标不包括这些。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-06T01:54:22.743

您确定构建在 TFSService id 下运行，而不是在为构建设置的另一个 id 下运行，并且可能不在管理员组中？由于我主要进行单人开发，因此我所做的不仅仅是玩自动构建，但我记得我在查看此内容时设置了一个单独的构建 ID。

# java - java.util.Collection 的经典集合操作

> ID：163998
> 
> 赞同：65
> 
> 时间：2008-10-02T19:01:31.933
> 
> 标签：java, collections, set

java.util.Collection 类上的经典集合操作是否有任何内置功能？我的具体实现是针对 ArrayList，但这听起来应该适用于 Collection 的所有子类。我正在寻找类似的东西：

```
ArrayList<Integer> setA ...
ArrayList<Integer> setB ...
ArrayList<Integer> setAintersectionB = setA.intersection(setB);
ArrayList<Integer> setAminusB = setA.subtract(setB); 
```

经过一番搜索，我只能找到本土解决方案。另外，我意识到我可能会将“集合”的概念与“集合”的概念混淆，分别不允许和允许重复。也许这真的只是 Set 接口的功能？

如果没有人知道任何内置功能，也许我们可以将其用作标准实践 Java 集合操作代码的存储库？我想这个轮子已经被重新发明了无数次。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-02T19:33:21.387

交点是用`Collection.retainAll`; 减法`Collection.removeAll`; 与 联合`Collection.addAll`。在每种情况下，as`Set`都像一个集合，而 a`List`像一个列表。

作为可变对象，它们在原地运行。如果要保留原始可变对象不变，则需要显式复制。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-02T19:24:41.643

我会推荐[谷歌番石榴](https://code.google.com/p/guava-libraries/)。[Sets](https://google.github.io/guava/releases/snapshot-jre/api/docs/com/google/common/collect/Sets.html)类似乎正是您想要的。它有[相交](https://google.github.io/guava/releases/snapshot-jre/api/docs/com/google/common/collect/Sets.html#intersection-java.util.Set-java.util.Set-)法和[差分](https://google.github.io/guava/releases/snapshot-jre/api/docs/com/google/common/collect/Sets.html#difference-java.util.Set-java.util.Set-)法。

如果您有兴趣，[此演示文稿可能是您想观看的内容。](http://smallwig.blogspot.com/2008/08/google-collections-presentation.html)它指的是 Google Collections，这是 Guava 的原始名称。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-12-23T16:24:06.760

对于可变操作，请参阅接受的答案。

对于不可变的变体，您可以使用 java 8 执行此操作

减法

```
set1
  .stream()
  .filter(item-> !set2.contains(item))
  .collect(Collectors.toSet()) 
```

路口

```
set1
  .stream()
  .filter(item-> set2.contains(item))
  .collect(Collectors.toSet()) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-02T19:09:16.437

您是否正在寻找[java.util.Set](http://java.sun.com/javase/6/docs/api/java/util/Set.html "放")接口（及其实现 HashSet 和 TreeSet（已排序））？
该接口定义了看起来像 substract() 的 removeAll(Collection c) 和看起来像交集的 retainAll(Collection c)。*******`*