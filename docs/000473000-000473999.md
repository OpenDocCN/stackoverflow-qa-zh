# StackOverflow 问答 000473000-000473999

# javascript - Jquery 实时验证

> ID：473004
> 
> 赞同：2
> 
> 时间：2009-01-23T14:09:54.363
> 
> 标签：javascript, jquery, ajax, validation, jquery-plugins

在四处搜索后，我找不到我想要的东西，我希望使用 Jquery 库和某种形式的验证插件来验证表单客户端。我希望有人可以告诉我是否有任何不使用通用错误消息的验证插件，因为我的表单布局没有这些错误的空间，我也希望验证器能够纠正内容也是如此。

基本上我希望能够检查每次按键和模糊时的字段，如果字段验证它是否获得绿色边框，如果它没有验证它是否获得红色边框，任何人都知道一个插件能做到吗？

谢谢

sico87

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T14:17:06.377

我不知道您搜索的是什么，但[验证插件](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)（“jquery 验证”的第一个谷歌结果）完全符合您的要求...阅读[随附的文档](http://docs.jquery.com/Plugins/Validation)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-09-23T01:46:41.490

这是我创建的一个 jQuery 插件，它也有实时表单验证。

[http://www.geektantra.com/2009/09/jquery-live-form-validation/](http://www.geektantra.com/2009/09/jquery-live-form-validation/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T14:15:15.287

我使用这个表单验证插件：[http](http://docs.jquery.com/Plugins/Validation) ://docs.jquery.com/Plugins/Validation 。虽然我不确定“实时”验证，但您可以使用 CSS 隐藏“通用”错误：

```
label.error{ display: none; } 
```

我知道这个插件支持 AJAX，所以也许可以扩展来做你想要的实时验证？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-22T20:38:24.553

我的插件尽可能使用客户端，当客户端不是一个好主意（validates_uniqueness 等）时使用无缝 AJAX。看看自述文件，你就像在你的模型中所做的那样 - Validatious-on-rails 使用优秀的库“Validatious”来处理其余部分。

您可以在此处找到插件/宝石：

[http://github.com/grimen/validatious-on-rails](http://github.com/grimen/validatious-on-rails)

如果您有任何问题，请随时给我发消息 - 不过应该是稳定的。=)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-11T13:21:09.850

我喜欢[这个](http://livevalidation.com/)。因为您可以自定义要验证的功能。

# java - Tomcat 6 中重复出现的“PermGen”

> ID：473011
> 
> 赞同：19
> 
> 时间：2009-01-23T14:11:51.723
> 
> 标签：java, memory, tomcat

我在我的 Tomcat 6 服务器上不断收到“PermGen”错误。

我知道是什么应用程序导致了问题，但我不确定它为什么会这样。该应用程序使用 MySQL 5 并在 JDK 6 上运行。

是否有任何工具/建议来诊断或分析特定应用程序的潜在问题？

谢谢

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-23T14:24:35.330

PermGen 用于存储类定义和内部字符串池。您的代码可能正在填充它（如果它不必要地调用实习生），但更有可能是您的应用程序的默认值过小。

这是因为 Tomcat 会在您每次部署 WAR 时加载新类——或者，如果您在开发环境中工作，则每次编辑 JSP 时都会加载。这些最终应该被清理干净，但是在一个活跃的开发环境中，您可能会在一段时间内同时加载新旧实例。或者，如果您在生产环境中并且拥有大型 Web 应用程序，您可能只需要更多空间。

要设置 permgen 大小，请使用`-XX:MaxPermSize=SIZE`

以下链接可能会有所帮助：[调整 GC](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)（这是 1.5 版）、[GC FAQ](http://java.sun.com/docs/hotspot/gc1.4.2/faq.html)（1.4.2 版）、[Hotspot VM options](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp)（我相信这是 1.6）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-12-03T12:24:42.110

尝试以下 JVM 开关：

```
-XX:+UseConcMarkSweepGC
-XX:+CMSPermGenSweepingEnabled
-XX:+CMSClassUnloadingEnabled 
```

增加 permgen 空间`-XX:MaxPermSize`只是延迟了问题。

请参阅此评论： [如何处理“java.lang.OutOfMemoryError: PermGen space”错误](https://stackoverflow.com/questions/88235/how-to-deal-with-java-lang-outofmemoryerror-permgen-space-error/88262#88262)

这间接地指向了我这两个帖子：[问题](http://blogs.oracle.com/fkieviet/entry/classloader%5Fleaks%5Fthe%5Fdreaded%5Fjava)，[解决方案](http://blogs.oracle.com/fkieviet/entry/how%5Fto%5Ffix%5Fthe%5Fdreaded)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-25T05:39:25.670

试试这个：在 Linux 机器中

`export JAVA_OPTS="-XX:PermSize=128m"`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T18:11:38.367

我认为您的应用程序中可能有许多 JSP。在 tomcat 中存在一个已知问题，即重新启动具有许多 JSP 的已部署应用程序会导致 PermGen 问题，因为 tomcat 会重新编译并再次重新加载所有这些类。如上一篇文章中提到的那样增加大小应该会有所帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-04-25T10:47:30.243

我同意使用 -XX:MaxPermSize 增加 permgen 空间只会延迟问题。我尝试增加 permgen，然后在向服务器发送更多请求后，我开始收到相同的错误。建议使用像 -XX:+CMSClassUnloadingEnabled 这样的附加标志，即使它会稍微降低性能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-18T16:27:08.773

在使用hibernate和spring时代码更改后重新加载tomcat时，我看到很多permgen错误，我认为这是由于logger / ehcache实例没有正确关闭。

# c++ - 你有没有通过使用 boost::pool 获得显着的加速？

> ID：473023
> 
> 赞同：26
> 
> 时间：2009-01-23T14:16:22.417
> 
> 标签：c++, optimization, memory-management, boost, malloc

我在一些地方玩过 boost::pool ，在我看来，我正在用大量的对象“搅动”严重地敲打堆。通常我使用`boost::object_pool`, 或`boost::pool_alloc`作为 STL 模板参数。然而，结果始终是性能几乎没有变化，或者显着恶化。

我很想知道它有什么成功的故事。

我应该在分析输出中寻找哪些可能表明 boost::pool 可能有帮助的东西？

改进旧的 malloc 真的很难吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-23T16:46:55.433

内存池是最有效的 imo 事务样式处理，您可以在其中分配给池，然后在事务完成后，将其转储到遗忘中。真正的加速并不是每次分配都会快得多，而是在一个运行时间极长的应用程序中，内存碎片几乎为零。

总的来说，听起来您的应用程序不保证使用内存池

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2010-10-13T07:09:27.280

是的，速度提高了 500%。应用程序（相当愚蠢，但有时你必须使用你得到的东西）在循环中将元素从 1 std::map 复制到另一个（在循环中有一些决策），以及多线程/进程服务器上的结果分配导致堆争用。我在第二张地图上添加了提升池作为分配器，结果是应用程序执行速度提高了 500%。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-23T15:52:37.073

盲目优化不好。尝试使用谷歌内存分配器，你甚至不需要重新编译你的应用程序。你可以在这里找到你需要知道的：

[http://google-perftools.googlecode.com/svn/trunk/doc/tcmalloc.html](http://google-perftools.googlecode.com/svn/trunk/doc/tcmalloc.html)

加埃塔诺

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-23T14:21:49.643

在开始优化之前，您可能希望先跟踪内存分配的性能问题。

因此，缩小分析范围以查明问题的位置。这可能是对同一代码的大量调用，而只调用一次可能不会花费很长时间。

# parsing - 在代码库中搜索对表名的引用

> ID：473027
> 
> 赞同：0
> 
> 时间：2009-01-23T14:17:36.297
> 
> 标签：parsing, legacy-code

我有一个目录，里面全是来自 VB6 应用程序的遗留代码。

我被要求提供此应用程序使用的所有表的列表，因此我们可以为其分配一个特殊的 SQL Server 用户名。

扫描代码库以查找对表名的引用的最佳方法是什么？

我的一些想法：

1.  搜索以下关键字：“FROM”、“UPDATE”、“INSERT”，并手动记下这些短语周围的表名。

    **问题：大量的手工工作**

2.  使用 SQL Trace 运行应用程序，并尝试执行每个函数，然后扫描日志以查找表名

    **问题：同样的手工工作，另外我可能会忽略一些晦涩的功能**

任何人都可以提出更好的选择吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T14:29:22.577

我将从 information_schema.tables 中选择并将结果保存到文件以构建表列表，然后使用 bat 文件或命令行正则表达式工具将表列表用作与源代码目录中的文件进行比较的源。您可以输出命中的文件和命中的表名（如果您有兴趣，命中在哪一行）。我不是 grep 高手，但我认为这将是正确使用的工具。

**编辑** 根据数据访问的处理方式，您可能希望扩展搜索列表以包括来自 information_schema.routines 的存储过程

**编辑 2 使用 finstr、光标和黑暗面的方法**

请注意，虽然下面应该可以工作，但如果指向错误的目录，可能会造成严重破坏。此外，它仅在可从服务器访问源代码并启用 xp_cmdshell 时才有效。也许整个想法是邪恶的，我不知道。

```
create table #files (filepath   varchar(4000))
create table #tablesfound (tablename sysname, filepath varchar(4000))

declare @sql nvarchar(4000)
Declare @cmd nvarchar(400)
Declare @dir varchar(256)
Declare @tbl sysname
set @dir = 'source code directory with e.g. c:\source\'
declare crsX cursor for
Select table_name from information_schema.tables
open crsX
Fetch Next from crsX into @tbl

While (@@Fetch_Status = 0)
Begin
    set @cmd = 'findstr /S /M '  + quotename(@tbl, char(34)) + ' ' + @dir + '*.*'

    insert into #files exec xp_cmdshell  @cmd
    if exists (Select 1 from #files where filepath is not null)
    Begin
        insert into #tablesfound (tablename, filepath)
        Select @tbl, filepath from #files where filepath is not null
        delete from #files 
    End  
    print @cmd
    Fetch Next from crsX into @tbl
End
close crsX 
Deallocate crsX

Select * from #tablesfound 
```

# .net - 如何编辑应用程序配置设置？App.config 最好的方法是什么？

> ID：473028
> 
> 赞同：14
> 
> 时间：2009-01-23T14:17:59.697
> 
> 标签：.net, configuration, settings, app-config

对于我的项目，我有通过项目属性中的设置添加的设置。

我很快发现直接编辑 app.config 文件似乎并没有真正更新设置值。似乎我必须在进行更改然后重新编译时查看项目属性。

*   我想知道......为项目处理可定制设置的**最佳和最简单**的方法是什么 - 认为这对于.Net如何处理它来说是一件很容易的事......对我来说很羞耻**。**

*   是否可以使用其中一种设置**AppSettings**、 **ApplicationSettings**或**UserSettings**来处理这个问题？

将我的设置写入自定义配置文件并自己处理会更好吗？

现在...**我正在寻找最快的解决方案**！

**我的环境是 C#、.Net 3.5 和 Visual Studio 2008。**

更新

我正在尝试执行以下操作：

```
 protected override void Save()
    {
        Properties.Settings.Default.EmailDisplayName = this.ddEmailDisplayName.Text;
        Properties.Settings.Default.Save();
    } 
```

编译时给我一个只读错误。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T14:44:49.567

这很愚蠢......我想我必须为浪费大家的时间而道歉！但看起来我只需要将**范围设置为用户**而不是应用程序，我就可以编写新值。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-01-17T14:54:01.577

我也试图解决这个需求，我现在有一个漂亮漂亮的 ConsoleApplication，我想分享它：（App.config）

你会看到的是：

1.  如何读取所有 AppSetting 属性
2.  如何插入新属性
3.  如何删除属性
4.  如何更新属性

玩得开心！

```
 public void UpdateProperty(string key, string value)
    {
        Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
        KeyValueConfigurationCollection appSettings = config.AppSettings.Settings;

        // update SaveBeforeExit
        config.AppSettings.Settings[key].Value = value;
        Console.Write("...Configuration updated: key "+key+", value: "+value+"...");

        //save the file
        config.Save(ConfigurationSaveMode.Modified);
        Console.Write("...saved Configuration...");
        //relaod the section you modified
        ConfigurationManager.RefreshSection(config.AppSettings.SectionInformation.Name);
        Console.Write("...Configuration Section refreshed...");
    }

    public void ReadAppSettingsProperty()
    {
        try
        {
            var section = ConfigurationManager.GetSection("applicationSettings");

            // Get the AppSettings section.
            NameValueCollection appSettings = ConfigurationManager.AppSettings;

            // Get the AppSettings section elements.
            Console.WriteLine();
            Console.WriteLine("Using AppSettings property.");
            Console.WriteLine("Application settings:");

            if (appSettings.Count == 0)
            {
            Console.WriteLine("[ReadAppSettings: {0}]", "AppSettings is empty Use GetSection command first.");
            }
            for (int i = 0; i < appSettings.Count; i++)
            {
                Console.WriteLine("#{0} Key: {1} Value: {2}",
                i, appSettings.GetKey(i), appSettings[i]);
            }
        }
        catch (ConfigurationErrorsException e)
        {
            Console.WriteLine("[ReadAppSettings: {0}]", e.ToString());
        }

    }

    public void updateAppSettingProperty(string key, string value)
    {
        // Get the application configuration file.
        System.Configuration.Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
        string sectionName = "appSettings";

        config.AppSettings.Settings.Remove(key);
        config.AppSettings.Settings.Add(key, value);

        SaveConfigFile(config);
    }

    public void insertAppSettingProperty(string key, string value)
    {
        // Get the application configuration file.
        System.Configuration.Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
        string sectionName = "appSettings";

        config.AppSettings.Settings.Add(key, value);

        SaveConfigFile(config);
    }

    public void deleteAppSettingProperty(string key)
    {
        // Get the application configuration file.
        System.Configuration.Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
        config.AppSettings.Settings.Remove(key);

        SaveConfigFile(config);
    }

    private static void SaveConfigFile(System.Configuration.Configuration config)
    {
        string sectionName = "appSettings";

        // Save the configuration file.
        config.Save(ConfigurationSaveMode.Modified);

        // Force a reload of the changed section. This  
        // makes the new values available for reading.
        ConfigurationManager.RefreshSection(sectionName);

        // Get the AppSettings section.
        AppSettingsSection appSettingSection =
          (AppSettingsSection)config.GetSection(sectionName);

        Console.WriteLine();
        Console.WriteLine("Using GetSection(string).");
        Console.WriteLine("AppSettings section:");
        Console.WriteLine(appSettingSection.SectionInformation.GetRawXml());
    }    
} 
```

*配置文件如下所示：*

```
<configuration>
<configSections>
</configSections>
<appSettings>
    <add key="aNewKey1" value="aNewValue1" />
</appSettings> 
```

好吧，所以我对这个解决方案的 AppSettings 没有任何问题！玩得开心... ;-） ！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-25T21:51:13.797

在我意识到我在调试模式下运行应用程序之前，我遇到了同样的问题，因此我的新 appSetting 的密钥被写入 [applicationName]。**vshost.exe.config**文件。

一旦应用程序关闭，此 vshost.exe.config 文件不会保留任何新密钥 - 它会恢复为 [applicationName]。**exe.config**文件的内容。

我在调试器之外对其进行了测试，在这里和其他地方添加配置 appSetting 密钥的各种方法都可以正常工作。新密钥添加到：[applicationName]。**exe.config**。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-08-17T16:03:13.107

```
 System.Configuration.Configuration config =ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);

        config.AppSettings.Settings["oldPlace"].Value = "3";     
        config.Save(ConfigurationSaveMode.Modified);
        ConfigurationManager.RefreshSection("appSettings"); 
```

试试这段代码，很简单。

阿特：埃里克·西利扎

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T14:24:35.067

**编辑：**我的错误。我误解了原始问题的目的。

**原文：**

我们经常直接在 app.config 文件中设置我们的设置，但通常这是用于我们的自定义设置。

示例 app.config：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <section name="MySection" type="System.Configuration.NameValueFileSectionHandler, System, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
    </configSections>
    <connectionStrings>
        <add name="Default" connectionString="server=MyServer;database=MyDatabase;uid=MyDBUser;password=MyDBPassword;connection timeout=20" providerName="System.Data.SqlClient" />
    </connectionStrings>
    <MySection>
        <add key="RootPath" value="C:\MyDirectory\MyRootFolder" /> <!-- Path to the root folder. -->
        <add key="SubDirectory" value="MySubDirectory" /> <!-- Name of the sub-directory. -->
        <add key="DoStuff" value="false" /> <!-- Specify if we should do stuff -->
    </MySection>
</configuration> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T14:24:50.993

不确定这是否是您所追求的，但您可以从应用程序更新并保存设置：

ConsoleApplication1.Properties.Settings.Default.StringSetting = "test"; ConsoleApplication1.Properties.Settings.Default.Save();

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-23T14:28:44.903

您如何在代码中引用 Settings 类？您是使用默认实例还是创建新的 Settings 对象？我相信默认实例使用设计器生成的值，只有在打开属性时才会从配置文件中重新读取。如果您创建一个新对象，我相信该值是直接从配置文件本身读取的，而不是从设计器生成的属性中读取的，除非 app.config 文件中不存在该设置。

通常我的设置将在库中，而不是直接在应用程序中。我在属性文件中设置了有效的默认值。然后我可以通过在应用程序的配置（web.config 或 app.config，视情况而定）中添加适当的配置部分（从库 app.config 文件中检索和修改）来覆盖这些。

使用：

```
 Settings configuration = new Settings();
 string mySetting = configuration.MySetting; 
```

代替：

```
 string mySetting = Settings.Default.MySetting; 
```

对我来说是关键。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-31T07:30:29.113

试试这个：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>

  <configSections>
   <!--- ->
  </configSections>

  <userSettings>
   <Properties.Settings>
      <setting name="MainFormSize" serializeAs="String">
        <value>
1022, 732</value>
      </setting>
   <Properties.Settings>
  </userSettings>

  <appSettings>
    <add key="TrilWareMode" value="-1" />
    <add key="OptionsPortNumber" value="1107" />
  </appSettings>

</configuration> 
```

从 App.Config 文件中读取值：

```
//This method will read the value of the OptionsPortNumber in the
//above app.config file.
private int LoadConfigData ()
    {
        System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
        // AppDomain.CurrentDomain.SetupInformation.ConfigurationFile
        // points to the config file.   
        doc.Load(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);
        int smartRefreshPortNumber = 0;
        foreach (XmlNode node in doc.ChildNodes.Item(1))
        {
        //Searching for the node “”
            if (node.LocalName == "appSettings")
            {
                 smartPortNumber =Convert.ToInt32(node.ChildNodes.Item(1).Attributes[1].Value);
            }
        }
        Return smartPortNumber;
    } 
```

更新 App.config 中的值：

```
//This method will read the value of the OptionsPortNumber in the
//above app.config file.
private void UpdateConfigData()
    {
        System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
        doc.Load(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);

        //Looping through all nodes.
        foreach (XmlNode node in doc.ChildNodes.Item(1))
        {
        //Searching for the node “”
            if (node.LocalName == "appSettings")
            {
                if (!dynamicRefreshCheckBox.Checked)
                {
                    node.ChildNodes.Item(1).Attributes[1].Value = this.portNumberTextBox.Text;
                }
                else
                {
                    node.ChildNodes.Item(1).Attributes[1].Value = Convert.ToString(0);
                }
            }
        }
        //Saving the Updated values in App.config File.Here updating the config
        //file in the same path.
        doc.Save(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T14:29:44.183

您的答案可能在这里： [在 Windows 窗体 C# 应用程序中拥有配置文件的最简单方法](https://stackoverflow.com/questions/114527/simplest-way-to-have-a-configuration-file-in-a-windows-forms-c-application)

# javascript - 如何从我的 reportError 函数中获取 SpiderMonkey (JSAPI) 中的完整回溯？

> ID：473029
> 
> 赞同：9
> 
> 时间：2009-01-23T14:18:01.413
> 
> 标签：javascript, c, spidermonkey, jsapi

我正在使用 spidermonkey 在我的应用程序中嵌入 javascript，并且我有一个名为`reportError`接收[JSErrorReport](https://developer.mozilla.org/en/JSErrorReport)的函数。

获取错误的当前行似乎很简单，但是是否有可能获取整个调用路径以显示完整的回溯？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-03-03T11:17:24.710

通过 JSErrorReport 是不可行的。相反，您必须查看调试器 APIS。找到头文件 jsdbgapi.h。如果您在启用调试的情况下运行 (JS_SetDebugMode(cx, true))，它将有一个挂钩函数列表。在这些钩子函数中，您可以简单地调用 js_DumpBacktrace 来获取完整堆栈。请注意，如果您不先启用调试，则 js_DumpBacktrace 将不起作用。在调试模式下，您可以做的不仅仅是打印堆栈。实际上可以获得函数上下文及其所有参数和本地变量。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-06T14:01:50.567

可能不是最好的答案，但`xpc_printJSStack`可能对您有所帮助：http: [//mxr.mozilla.org/mozilla-central/source/js/xpconnect/src/XPCDebug.cpp#255](http://mxr.mozilla.org/mozilla-central/source/js/xpconnect/src/XPCDebug.cpp#255)

# ajax - POST 与 Ajax 调用

> ID：473038
> 
> 赞同：17
> 
> 时间：2009-01-23T14:20:41.923
> 
> 标签：ajax

现在大多数现代浏览器都支持 AJAX 和客户端请求而不执行 POST，那么 POST（表单发布）的作用是什么？

是否存在 POST 总是优于 XmlHttpRequest 的情况或一般规则？

POST 所做的只是将可变键值对放在服务器头中。POST的优势我能想到的就是数据量大，手机浏览器多。还有很多我想念的吗？

注意我知道你可以使用 AJAX 调用执行 POST，我主要是在谈论使用`<form>`标签

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-23T16:43:41.090

这个问题有点棘手，因为它混淆了两个概念。第一个是 POST，第二个是 Ajax。与 GETting 相比，POSTing 是一种不同的 HTTP 方法，具有不同的实现和语义。Ajax 或 XmlHttpRequest 在正常的请求/导航中具有对应的功能。您可以将 POST 或 GET 用于 XmlHttpRequest 以及普通导航和表单提交（嗯，POST 始终是“表单提交”）。XmlHttpRequest 与普通请求的区别在于，普通请求将页面替换为新页面。

您几乎可以编写任何仅使用 Ajax 来获取数据和更改 DOM 的网站；这主要是 Gmail 的工作原理。没有传统意义上的“表单提交”。但是仍然存在 GET 和 POST，因为服务器和浏览器对结果的解释不同。GET 应该是幂等的；POST 用于更改服务器状态的操作。例如，一个电子商务交易应该是一个 POST。这在使用 Ajax 时不会改变，因为您希望代理服务器也知道这是一个 POST 并且它们不应该尝试缓存响应。

使用 GET 与 POST 也有优点和缺点。您不能为 POST 的结果添加书签，因为参数是隐藏的。您无法获取具有无限长度参数值的内容，因为 IE 仅支持大约 2000 个字符。

与普通提交相比，使用 Ajax 也有缺点；您不能为结果页面添加书签（因为页面没有更改）；后退按钮无法按预期工作。但是使用 Ajax，您可以最大限度地减少传输的数据，还可以方便地更新页面（例如监视长进程的状态），而不会出现烦人的闪烁或刷新。

总之，Ajax 和传统表单提交这两种请求类型都可以与 GET 和 POST 一起使用，并且各有利弊。两种类型都无法做到其他类型可以做到的一切，因此您可以期待在可预见的未来看到混合。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-23T14:25:08.543

由于安全限制，某些操作无法使用 AJAX 请求执行。例如，不能使用 AJAX 上传文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T14:23:29.513

如果您需要刷新整个页面，发帖可能会更容易。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T14:25:29.387

关键区别在于表单的 POST 发送数据并且可以在与服务器的单次往返中导航到新的 URL。Ajax 可以发送数据但不能导航到新页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T14:26:24.050

呃..张贴表格？

由于值隐藏在 html 标头中而不是附加到 url 字符串中，因此 Post 对大型表单非常有用？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T14:55:09.670

从理论上讲，HTTP GET 应该是对信息的幂等请求：两个相同的 GET 应该返回完全相同的信息。

另一方面，HTTP POST 旨在保持状态并执行操作：两个相同的 POST 可能执行不同的操作，具体取决于执行操作的人员、之前完成的操作以及完成的时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T10:20:50.367

我将用 Doug Crockford 最近偶然发现的[这段视频来回答我自己的问题。](http://video.yahoo.com/watch/4141759/11157560)他描述了所有 ajax 和所有页面刷新之间的跷跷板。

# java - 如何使用 Xalan 更改一些现有的 Java XSLT 代码以使用 Saxon 和 TinyTree

> ID：473041
> 
> 赞同：1
> 
> 时间：2009-01-23T14:21:04.263
> 
> 标签：java, xslt, saxon, xalan

我有一些以编程方式执行 XSLT 转换的现有 Java 代码 - 最初使用 Xalan。我已经对其进行了重构，以便能够使用另一个（外部配置的）TransformerFactory。

我曾尝试使用 Saxon（v6.5.3 和 v8.7）工厂，但没有看到任何性能改进 - 如果有的话，Saxon 比 Xalan 更慢并且使用更多内存。

我知道我可以使用 Saxon TinyTree 获得一些性能优势，但无法弄清楚如何使用此代码来做到这一点。

我的代码是这样的；

```
TransformerFactory tf = (TransformerFactory) transformerFactoryClass.newInstance();
Transformer t = tf.newTransformer(pTransformFile);
t.transform(new StreamSource(pSourceFile), new StreamResult(pTargetFile)); 
```

其中 'transformerFactoryClass' 是配置的 TransformerFactory 类的实例
- Xalan 的 org.apache.xalan.processor.TransformerFactoryImpl
- Saxon 8.7 的
net.sf.saxon.TransformerFactoryImpl 和 Saxon 6.5.3 的 com.icl.saxon.TransformerFactoryImpl

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T06:17:11.600

实际上，当你给 Saxon 一个 StreamSource 时，它​​应该默认在内部使用 TinyTree。

至于速度：正如撒克逊作者打趣的那样，Xalan 会根据样式表进行两种可能性之一：快速或正确。撒克逊人总是正确地做事，这在某些情况下意味着它更慢。部分问题在于，XSLT 1.0 规范定义了某些事情，使其行为方式很难正确优化（但如果将行为更改为不兼容则更容易）。

然而，不管怎样，我总是发现 Saxon 与更复杂的样式表一样快或更快。Xalan 对于更简单的来说通常更快。

最后，随着时间的推移，Saxon 已经进行了很多优化，因此请确保您使用更新的版本（Saxon 9.1）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T11:49:50.407

[Saxon 7 文档](http://saxon.sourceforge.net/saxon7.1/using-xsl.html#choosingmodel)推断你可以`tf.setAttribute(net.sf.saxon.FeatureKeys.TREE_MODEL,Builder.TINY_TREE);`

但是他们也说这是默认设置。

# sql - 使用外键更新子查询问题

> ID：473059
> 
> 赞同：0
> 
> 时间：2009-01-23T14:25:44.860
> 
> 标签：sql, stored-procedures, foreign-keys, subquery

我记错了这个模板表的键是什么，因此我添加了错误的字段作为外键。现在我需要添加外键，并且我想根据已经填充的其他字段填充它的值。我开始尝试使用更新语句来做到这一点，但我不知道该怎么做。

我的架构的一部分：

产品表：

```
ProductName (key)
TemplateName
TemplateID
... 
```

我添加了 TemplateID，但它还没有数据并且可以为空。

模板表：

```
TemplateID (key)
TemplateName
... 
```

我想使用 Templates 表为 Products 表中的每个 TemplateName 找到匹配的 TemplateID，并将其填写到 Products 表中的外键引用中。

我可以使用 Update 中的子查询来执行此操作，还是需要编写某种存储过程？我正在使用 Sql Server 2008

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T14:30:26.863

你可以用一个简单的 UPDATE 查询来做到这一点

```
UPDATE Products
SET Products.TemplateID = Templates.TemplateID
FROM Templates
WHERE Templates.TemplateName = Products.TemplateName 
```

您不需要在 FROM 子句中指定 Products 表，也不需要在 JOIN 子句中指定。只需在 FROM 子句中指定 Templates 表。您可以使用在 WHERE 子句中的 UPDATE 子句中使用的表名来关联两个表中的记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T14:30:28.237

这是一个加入解决方案。重要的是只有匹配的行会被更新。

```
Update p
Set p.TemplateId = t.TemplateId
From Products p
  join Templates t
  On p.TemplateName = t.TemplateName 
```

这是子查询解决方案。即使没有匹配项，也会更新每一行产品。

```
Update p
Set p.TemplateId =
(
  Select t.TemplateId
  From Templates t
  Where p.TemplateName = t.TemplateName
)
From Products p 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T14:29:06.337

```
update Templates
set TemplateId=Products.TemplateId
from Templates
inner join Products
   on Templates.TemplateName=Products.TemplateName 
```

# asp.net - ASP.Net Membership.DeleteUser

> ID：473060
> 
> 赞同：9
> 
> 时间：2009-01-23T14:26:15.763
> 
> 标签：asp.net, asp.net-membership, database-permissions

在测试中，我使用的数据库上的用户是一个大杰夫。在生产中，他只有 Execute。

当我打电话时，

```
Membership.DeleteUser(user) 
```

在测试中，它起作用了。我在生产中尝试同样的方法，我得到了这个：

> DELETE 语句与 REFERENCE 约束“FK__aspnet_Us__UserI__37703C52”冲突。冲突发生在数据库“Testing”、表“dbo.aspnet_UsersInRoles”、列“UserId”中。

在我的 seargles（在 Google 上搜索）中，我遇到了这个家伙说的这个[链接](http://www.dougdossett.com/Details.aspx?Detail=35) ，

> 错误：DELETE 语句与 REFERENCE 约束“FK__aspnet_Me__UserI__15502E78”冲突。冲突发生在数据库“YourDBName”、表“dbo.aspnet_Membership”、列“UserId”中。
> 
> 我花了一段时间在多个站点和选项中找到解决方案，因为错误和可能的解决方案相当具有误导性。事实证明，至少在我的情况下，这是成员数据库权限的问题。我用来连接的用户有权查看数据库本身的成员详细信息，但作为 aspnet_Users_DeleteUser 存储过程的一部分，它从 sysobjects 表中选择。会员连接用户显然没有足够的权限来执行该选择，因此整体删除失败。
> 
> 我的解决方法是将用户添加到成员数据库的 aspnet_Membership_FullAccess 角色。

但是当我这样做时，它不起作用。有人对如何处理这个有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-07-08T14:40:00.477

经过一番检查，我发现问题出在 aspnet_Users_DeleteUser 存储过程中的这一行：

```
IF ((@TablesToDeleteFrom & 1) <> 0 AND
    (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_MembershipUsers') AND (type = 'V')))) 
```

其他 3 个表还有 3 个类似的行。问题是，如果执行存储过程的用户无权访问 vw_aspnet_MembershipUsers，则在从 sysobjects 中选择时不会出现。我很想知道为什么整个 EXISTS 语句是必要的。

无论如何，下面的讨论“[访问 sysobjects 以查看用户表，而无需直接在 SQL Server 安全性中访问用户表](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.sqlserver.security&tid=f6f57505-7e3f-4a95-97bf-38cb6d86780e&cat=en_US_a36f2156-9287-4116-9521-b0c8ee543ba8&lang=en&cr=US&sloc=&p=1)”有答案。通过在相关视图上授予“VIEW DEFINITION”，EXISTS 语句现在将成功，您不必在应用程序的连接字符串中向用户授予不需要的、不需要的或过多的权限。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-28T17:03:54.343

我也遇到了这个问题，它是由缺少视图引起的，为了更正，我只是使用了另一个数据库中的创建脚本并重新创建了所有 vw_aspnet_* 视图。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T19:14:37.570

好吧，你猜怎么着？我读到这个： [http ://forums.asp.net/t/1254087.aspx](http://forums.asp.net/t/1254087.aspx)

> 好的，在发送我的帖子几分钟后，我找到了解决方案 :) 事实证明，必须在 vw_aspnet_MembershipUsers 视图上为 ASPNET 用户添加 SELECT PERMISSION。
> 
> 但是为什么我没有收到有关缺乏许可的错误仍然是个谜。EXIST 语句只是返回 false。

并授予生产用户 SELECT 权限，瞧！有用！多谢你们！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T14:36:18.910

我相信您的“REFERENCE”约束实际上是数据库中存在于 aspnet_Users 表和 aspnet_UsersInRoles 表之间的外键。我想你正在尝试的用户在两个表中都有它的 UserId，并且在你可以从 Users 表中删除它之前，它也必须从 UsersInRoles 表中删除。

您是否尝试过[http://msdn.microsoft.com/en-us/library/system.web.security.roleprovider.removeusersfromroles.aspx](http://msdn.microsoft.com/en-us/library/system.web.security.roleprovider.removeusersfromroles.aspx)以确保从该用户中删除所有角色？您也可以通过检查数据库中这两个表的行来进行验证。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T10:04:14.300

如果在 vw_aspnet_MembershipUsers 上授予 ASP 用户 SELECT 后错误（或类似）仍然存在，您可能希望为其他一些 vw_aspnet_ 授予 SELECT ？？？？意见也。特别是“个人资料”和“UsersInRoles”。否则 - 由于某些原因，DeleteUser SP 在从这些视图中选择时会得到一个空结果，并拒绝首先从中删除现有条目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-06-01T07:16:17.347

也许更好地确保执行删除成员身份的用户具有正确的 ASP.NET Membership sql 角色。在我的情况下，我正在删除一个具有一些角色和配置文件属性的会员用户。删除方法失败，但在分配了正确的 sql 角色后它起作用了。

```
ALTER ROLE [aspnet_Profile_FullAccess] ADD MEMBER [<YOUR SQL USER>]
ALTER ROLE [aspnet_Roles_FullAccess] ADD MEMBER [<YOUR SQL USER>] 
```

如果您正在使用该功能，还可以添加 [aspnet_Personalization_FullAccess]。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-29T02:17:13.833

我通过删除 proc 中检查视图的行来解决这个问题。我没有任何 asp 成员视图，并且在任何地方都不需要它们，所以创建视图似乎是毫无意义的，只是为了让代码行可以返回 true - proc 实际上并不使用视图。也许如果您使用会员对象的更多功能，您可能需要视图来做其他事情。无论哪种方式检查视图的存在对于 proc 来决定 aspnet_membership 表是否有需要删除的行似乎都是一种奇怪的方式。

```
IF ((@TablesToDeleteFrom & 1) <> 0 
    )
    --AND
    --   (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_MembershipUsers') AND (type = 'V')))) 
```

# java - 在 java 日志框架场景中找到方法

> ID：473065
> 
> 赞同：3
> 
> 时间：2009-01-23T14:27:10.367
> 
> 标签：java, logging, log4j, apache-commons

Java 有很多框架/API 可以帮助您在应用程序中进行日志记录：

1.  Java API 有 java.util.logging 包。
2.  Apache 的 Log4j。
3.  Apache 的公共日志记录。
4.  SLF4J（记录外观）。
5.  杰洛。还有更多...

我一直使用 log4j 库，我发现它大部分时间都足够了，并且在我需要更多控制时可以扩展。

任何有多个框架经验的人都可以分享他的经验吗？从应用程序架构的角度来看，什么时候使用一个框架优于另一个框架？为什么我更喜欢一个而不是另一个？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-23T14:39:17.003

Commons Logging 是[奇怪的类加载问题的根源](http://www.qos.ch/logging/classloader.jsp)。如果可以的话，避免它。在开发应用程序时我更喜欢 log4j。如果您开发库/框架并且不想强制执行日志记录库，请选择 slf4j。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T15:45:26.213

如果它的新代码我将从 slf4j 开始，因为它提供了在底层日志 API 之间切换的最简单方法，只需在应用程序的 classparth 中包含所需的 slf-[logging_api].jar。例如 - 如果您从 log4j 开始，您仍然必须在 log4j.xml 中配置一个 Conole 记录器才能查看您的日志输出，而使用 slf4j 您只需包含 slf4j-simple.jar。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-29T09:29:22.620

Logback 是 log4j 的重写。如果你喜欢 log4j，你应该更喜欢 logback。

此外，logback 是 SLF4J API 的本机实现，这意味着您使用的是 logback，那么您实际上是在使用 SLF4J。因此，如果出于任何原因您希望切换回另一个日志框架，无论是 log4j 还是 jul，您都可以通过将一个 jar 文件替换为另一个来实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T14:57:22.113

无论官方立场是什么，“log4j”都是标准的日志框架。

它运作良好并且已经存在了一段时间。它是数千个应用程序和包使用的部署最多的日志框架。它也是最有可能出现在开发人员简历中的日志框架。

坚持使用 log4j，没有充分的理由尝试其他任何东西。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-01-23T14:34:27.120

这个问题似乎与[354837](https://stackoverflow.com/questions/354837/whats-up-with-logging-in-java)相同。

简单的答案是，如果您正在编写一个库，该库可能会被放入您无法控制日志记录的应用程序中，那么您会选择 Commons Logging，如果不是，则为其他选择之一。我个人在所有情况下都使用 CL，只是因为它很常见——我不需要记住框架之间的差异。

# java - 如何使用 Jboss Tools Eclipse 插件在 Jboss 中“热”部署战争依赖项？

> ID：473068
> 
> 赞同：2
> 
> 时间：2009-01-23T14:27:37.807
> 
> 标签：java, eclipse, jakarta-ee, jboss, jboss-tools

我正在使用 Jboss 工具（3.0.0 alpha，在 Eclipse 3.4 上）在 Jboss 4.2.3 上热部署我的战争。我的战争取决于我正在处理的另一个项目（装在一个罐子里）。但是，当我在这个项目（jar项目）中保存文件时，Jboss Tools重新发布war项目的编译类，但不会重新部署jar项目中更改的类。（实际上是war项目部署“爆炸”在部署目录中，但 jar 项目作为 jar 部署在 WEB-INF/libs 目录中）我希望 eclipse 和 JBoss 工具重新发布 jar 项目中的类，就像它们对 JSP 和里面的类所做的那样战争项目...感谢您的帮助！安东尼

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T13:25:21.993

为此，您需要您的 jar 是一个依赖实用程序 jar，因此当通过 Web 工具进行打包时，它也会打包 jar 更改。

如果这对您来说不够灵活，那么请考虑使用 JBoss Tools 的 Project Archives 功能，它允许您根据需要定义依赖项。

ps 如果问题在于复制正确的文件，则使用 JavaRebel 之类的解决方案无济于事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T22:23:01.093

使用 JavaRebel。他们使用 Java Instrumentation API (javaagent) 在文件系统上发生更改时重新加载类。

# wpf - 如何在 XAML 中设置 ListBox 的焦点？

> ID：473080
> 
> 赞同：0
> 
> 时间：2009-01-23T14:29:55.647
> 
> 标签：wpf, xaml, listbox, focus

我有这个列表框：

```
<ListBox Name="lbColor">
    <ListBoxItem Content="Blue"/>
    <ListBoxItem Content="Red"/>
    <ListBoxItem Content="Orange"/>
</ListBox> 
```

这段代码可以预先选择选项，但没有设置焦点，我该怎么做？

```
public Window1()
{
    InitializeComponent();

    lbColor.SelectedIndex = 1;
    lbColor.Focus = 1;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T14:37:00.127

您可以使用[Focus](http://msdn.microsoft.com/en-us/library/system.windows.uielement.focus.aspx)方法：

```
public Window1()
{
    InitializeComponent();
    lbColor.SelectedIndex = 1;
    lbColor.Focus();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T14:37:52.323

我认为，您必须从 UIElement-Class 继承并将 true 设置为 UIElement.IsFocusable。现在您应该可以使用 lblcolor.Focus() 将焦点设置到列表框！我希望这会有所帮助。

# c# - C# 中的字符串基准 - 重构速度/可维护性

> ID：473087
> 
> 赞同：6
> 
> 时间：2009-01-23T14:33:38.463
> 
> 标签：c#, string, refactoring

我一直在用自己的时间修补小函数，试图找到重构它们的方法（我最近阅读了 Martin Fowler 的书*[Refactoring: Improvement the Design of Existing Code](https://rads.stackoverflow.com/amzn/click/com/0201485672)*）。我在更新它附近的代码库的另一部分时发现了以下函数`MakeNiceString()`，它看起来像是一个很好的候选者。事实上，没有真正的理由要更换它，但它足够小并且做一些小事情，因此很容易遵循，但仍然可以获得“良好”的体验。

```
private static string MakeNiceString(string str)
        {
            char[] ca = str.ToCharArray();
            string result = null;
            int i = 0;
            result += System.Convert.ToString(ca[0]);
            for (i = 1; i <= ca.Length - 1; i++)
            {
                if (!(char.IsLower(ca[i])))
                {
                    result += " ";
                }
                result += System.Convert.ToString(ca[i]);
            }
            return result;
        }

static string SplitCamelCase(string str)
    {
        string[] temp = Regex.Split(str, @"(?<!^)(?=[A-Z])");
        string result = String.Join(" ", temp);
        return result;
    } 
```

第一个函数`MakeNiceString()`是我在工作中更新的一些代码中找到的函数。该函数的目的是将**ThisIsAString**转换为**This Is A String**。它在代码中的六处使用，并且在整个方案中非常微不足道。

我建立第二个函数纯粹是作为一个学术练习来看看使用正则表达式是否需要更长的时间。

好吧，结果如下：

有 10 次迭代：

> ```
> MakeNiceString 花费了 2649 个滴答声
> SplitCamelCase 花费了 2502 个滴答声
> 
> ```

然而，它在长期内发生了巨大变化：

10,000 次迭代：

```
MakeNiceString 花费了 121625 个滴答声
SplitCamelCase 花费了 443001 个滴答声

```

* * *

### 重构`MakeNiceString()`

> 重构过程`MakeNiceString()`从简单地删除正在发生的转换开始。这样做产生了以下结果：

```
MakeNiceString 花费了 124716 个滴答声
改进的MakeNiceString 花了 118486

```

这是重构 #1 之后的代码：

```
private static string ImprovedMakeNiceString(string str)
        { //Removed Convert.ToString()
            char[] ca = str.ToCharArray();
            string result = null;
            int i = 0;
            result += ca[0];
            for (i = 1; i <= ca.Length - 1; i++)
            {
                if (!(char.IsLower(ca[i])))
                {
                    result += " ";
                }
                result += ca[i];
            }
            return result;
        } 
```

### 重构#2 - 使用`StringBuilder`

> 我的第二个任务是使用`StringBuilder`而不是`String`. 由于`String`是不可变的，因此在整个循环中创建了不必要的副本。使用它的基准如下，代码如下：

```
static string RefactoredMakeNiceString(string str)
        {
            char[] ca = str.ToCharArray();
            StringBuilder sb = new StringBuilder((str.Length * 5 / 4));
            int i = 0;
            sb.Append(ca[0]);
            for (i = 1; i <= ca.Length - 1; i++)
            {
                if (!(char.IsLower(ca[i])))
                {
                    sb.Append(" ");
                }
                sb.Append(ca[i]);
            }
            return sb.ToString();
        } 
```

这导致以下基准：

> ```
> MakeNiceString Take: 124497 Ticks //Original
> SplitCamelCase 采用：464459 记号 //Regex
> 改进的MakeNiceString Take: 117369 Ticks //移除转换
> RefactoredMakeNiceString Take: 38542 Ticks //使用 StringBuilder
> 
> ```

`for`将循环更改为`foreach`循环导致以下基准测试结果：

```
static string RefactoredForEachMakeNiceString(string str)
        {
            char[] ca = str.ToCharArray();
            StringBuilder sb1 = new StringBuilder((str.Length * 5 / 4));
            sb1.Append(ca[0]);
            foreach (char c in ca)
            {
                if (!(char.IsLower(c)))
                {
                    sb1.Append(" ");
                }
                sb1.Append(c);
            }
            return sb1.ToString();
        } 
```

> ```
> RefactoredForEachMakeNiceString 花费：45163 滴答声
> 
> ```

如您所见，在维护方面，`foreach`循环将是最容易维护的并且具有“最干净”的外观。它比循环稍慢`for`，但更容易遵循。

### 替代重构：使用已编译`Regex`

我在循环开始之前将正则表达式移到了右边，希望因为它只编译一次，它会执行得更快。我发现（我确信我在某处有一个错误）是这不会像它应该发生的那样发生：

```
static void runTest5()
        {
            Regex rg = new Regex(@"(?<!^)(?=[A-Z])", RegexOptions.Compiled);
            for (int i = 0; i < 10000; i++)
            {
                CompiledRegex(rg, myString);
            }
        }
 static string CompiledRegex(Regex regex, string str)
    {
        string result = null;
        Regex rg1 = regex;
        string[] temp = rg1.Split(str);
        result = String.Join(" ", temp);
        return result;
    } 
```

### 最终基准测试结果：

```
MakeNiceString 获得了 139363 个滴答声
SplitCamelCase 拿了 489174 记号
改进的MakeNiceString 获得了 115478 个滴答声
RefactoredMakeNiceString 花费了 38819 个滴答声
RefactoredForEachMakeNiceString 花费了 44700 滴答声
CompiledRegex 获得了 227021 个刻度

```

或者，如果您更喜欢毫秒：

```
MakeNiceString 花了 38 毫秒
SplitCamelCase 耗时 123 毫秒
改进的MakeNiceString 耗时 33 毫秒
RefactoredMakeNiceString 耗时 11 毫秒
RefactoredForEachMakeNiceString 耗时 12 毫秒
编译正则表达式耗时 63 毫秒

```

所以百分比收益是：

```
MakeNiceString 38 毫秒基线
SplitCamelCase 123 毫秒 223% 慢
改进的MakeNiceString 33 毫秒 13.15% 更快
RefactoredMakeNiceString 11 毫秒 71.05% 快
RefactoredForEachMakeNiceString 12 毫秒 68.42% 快
CompiledRegex 63 毫秒 65.79% 慢

```

（请检查我的数学）

最后，我将用 替换现有的东西`RefactoredForEachMakeNiceString()`，当我使用它时，我将把它重命名为有用的东西，比如`SplitStringOnUpperCase`.

### 基准测试：

为了进行基准测试，我只需`Stopwatch`为每个方法调用调用一个 new：

```
 string myString = "ThisIsAUpperCaseString";
       Stopwatch sw = new Stopwatch();
       sw.Start();
       runTest();
       sw.Stop();

     static void runTest()
        {

            for (int i = 0; i < 10000; i++)
            {
                MakeNiceString(myString);
            }

        } 
```

* * *

### 问题

*   是什么导致这些功能“从长远来看”如此不同，以及
*   我怎样才能改进这个功能a）更易于维护或b）运行得更快？
*   我将如何对这些进行内存基准测试以查看哪些使用的内存较少？

* * *

**感谢您迄今为止的回复。我已经插入了@Jon Skeet 提出的所有建议，并希望对我提出的更新问题提供反馈。**

> **注意**：这个问题旨在探索在 C# 中重构字符串处理函数的方法。我复制/粘贴了第一个代码`as is`。我很清楚您可以`System.Convert.ToString()`在第一种方法中删除，我就是这样做的。如果有人知道删除 的任何含义`System.Convert.ToString()`，那也将有所帮助。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-23T14:43:45.683

1) 使用 StringBuilder，最好设置一个合理的初始容量（例如字符串长度 * 5/4，以允许每四个字符有一个额外的空间）。

2）尝试使用 foreach 循环而不是 for 循环 - 它可能更简单

3）您不需要先将字符串转换为 char 数组 - foreach 已经可以处理字符串，或者使用索引器。

4) 不要到处进行额外的字符串转换——调用 Convert.ToString(char) 然后附加该字符串是没有意义的；不需要单个字符串

5）对于第二个选项，只需在方法之外构建一次正则表达式。也可以尝试使用 RegexOptions.Compiled。

编辑：好的，完整的基准测试结果。我尝试了更多的东西，并且还执行了更多迭代的代码以获得更准确的结果。这仅在 Eee PC 上运行，因此毫无疑问它会在“真实”PC 上运行得更快，但我怀疑广泛的结果是合适的。首先是代码：

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Text.RegularExpressions;

class Benchmark
{
    const string TestData = "ThisIsAUpperCaseString";
    const string ValidResult = "This Is A Upper Case String";
    const int Iterations = 1000000;

    static void Main(string[] args)
    {
        Test(BenchmarkOverhead);
        Test(MakeNiceString);
        Test(ImprovedMakeNiceString);
        Test(RefactoredMakeNiceString);
        Test(MakeNiceStringWithStringIndexer);
        Test(MakeNiceStringWithForeach);
        Test(MakeNiceStringWithForeachAndLinqSkip);
        Test(MakeNiceStringWithForeachAndCustomSkip);
        Test(SplitCamelCase);
        Test(SplitCamelCaseCachedRegex);
        Test(SplitCamelCaseCompiledRegex);        
    }

    static void Test(Func<string,string> function)
    {
        Console.Write("{0}... ", function.Method.Name);
        Stopwatch sw = Stopwatch.StartNew();
        for (int i=0; i < Iterations; i++)
        {
            string result = function(TestData);
            if (result.Length != ValidResult.Length)
            {
                throw new Exception("Bad result: " + result);
            }
        }
        sw.Stop();
        Console.WriteLine(" {0}ms", sw.ElapsedMilliseconds);
        GC.Collect();
    }

    private static string BenchmarkOverhead(string str)
    {
        return ValidResult;
    }

    private static string MakeNiceString(string str)
    {
        char[] ca = str.ToCharArray();
        string result = null;
        int i = 0;
        result += System.Convert.ToString(ca[0]);
        for (i = 1; i <= ca.Length - 1; i++)
        {
            if (!(char.IsLower(ca[i])))
            {
                result += " ";
            }
            result += System.Convert.ToString(ca[i]);
        }
        return result;
    }

    private static string ImprovedMakeNiceString(string str)
    { //Removed Convert.ToString()
        char[] ca = str.ToCharArray();
        string result = null;
        int i = 0;
        result += ca[0];
        for (i = 1; i <= ca.Length - 1; i++)
        {
            if (!(char.IsLower(ca[i])))
            {
                result += " ";
            }
            result += ca[i];
        }
        return result;
    }

    private static string RefactoredMakeNiceString(string str)
    {
        char[] ca = str.ToCharArray();
        StringBuilder sb = new StringBuilder((str.Length * 5 / 4));
        int i = 0;
        sb.Append(ca[0]);
        for (i = 1; i <= ca.Length - 1; i++)
        {
            if (!(char.IsLower(ca[i])))
            {
                sb.Append(" ");
            }
            sb.Append(ca[i]);
        }
        return sb.ToString();
    }

    private static string MakeNiceStringWithStringIndexer(string str)
    {
        StringBuilder sb = new StringBuilder((str.Length * 5 / 4));
        sb.Append(str[0]);
        for (int i = 1; i < str.Length; i++)
        {
            char c = str[i];
            if (!(char.IsLower(c)))
            {
                sb.Append(" ");
            }
            sb.Append(c);
        }
        return sb.ToString();
    }

    private static string MakeNiceStringWithForeach(string str)
    {
        StringBuilder sb = new StringBuilder(str.Length * 5 / 4);
        bool first = true;      
        foreach (char c in str)
        {
            if (!first && char.IsUpper(c))
            {
                sb.Append(" ");
            }
            sb.Append(c);
            first = false;
        }
        return sb.ToString();
    }

    private static string MakeNiceStringWithForeachAndLinqSkip(string str)
    {
        StringBuilder sb = new StringBuilder(str.Length * 5 / 4);
        sb.Append(str[0]);
        foreach (char c in str.Skip(1))
        {
            if (char.IsUpper(c))
            {
                sb.Append(" ");
            }
            sb.Append(c);
        }
        return sb.ToString();
    }

    private static string MakeNiceStringWithForeachAndCustomSkip(string str)
    {
        StringBuilder sb = new StringBuilder(str.Length * 5 / 4);
        sb.Append(str[0]);
        foreach (char c in new SkipEnumerable<char>(str, 1))
        {
            if (char.IsUpper(c))
            {
                sb.Append(" ");
            }
            sb.Append(c);
        }
        return sb.ToString();
    }

    private static string SplitCamelCase(string str)
    {
        string[] temp = Regex.Split(str, @"(?<!^)(?=[A-Z])");
        string result = String.Join(" ", temp);
        return result;
    }

    private static readonly Regex CachedRegex = new Regex("(?<!^)(?=[A-Z])");    
    private static string SplitCamelCaseCachedRegex(string str)
    {
        string[] temp = CachedRegex.Split(str);
        string result = String.Join(" ", temp);
        return result;
    }

    private static readonly Regex CompiledRegex =
        new Regex("(?<!^)(?=[A-Z])", RegexOptions.Compiled);    
    private static string SplitCamelCaseCompiledRegex(string str)
    {
        string[] temp = CompiledRegex.Split(str);
        string result = String.Join(" ", temp);
        return result;
    }

    private class SkipEnumerable<T> : IEnumerable<T>
    {
        private readonly IEnumerable<T> original;
        private readonly int skip;

        public SkipEnumerable(IEnumerable<T> original, int skip)
        {
            this.original = original;
            this.skip = skip;
        }

        public IEnumerator<T> GetEnumerator()
        {
            IEnumerator<T> ret = original.GetEnumerator();
            for (int i=0; i < skip; i++)
            {
                ret.MoveNext();
            }
            return ret;
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
    }
} 
```

现在结果：

```
BenchmarkOverhead...  22ms
MakeNiceString...  10062ms
ImprovedMakeNiceString...  12367ms
RefactoredMakeNiceString...  3489ms
MakeNiceStringWithStringIndexer...  3115ms
MakeNiceStringWithForeach...  3292ms
MakeNiceStringWithForeachAndLinqSkip...  5702ms
MakeNiceStringWithForeachAndCustomSkip...  4490ms
SplitCamelCase...  68267ms
SplitCamelCaseCachedRegex...  52529ms
SplitCamelCaseCompiledRegex...  26806ms 
```

如您所见，字符串索引器版本是赢家——它也是非常简单的代码。

希望这会有所帮助......而且不要忘记，肯定还有其他我没有想到的选择！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T14:43:22.673

您可能想尝试将`Regex`对象实例化为类成员并`RegexOptions.Compiled`在创建它时使用该选项。

目前，您正在使用 的静态`Split`成员`Regex`，并且不会缓存正则表达式。使用实例化成员对象而不是静态方法应该可以进一步提高您的性能（从长远来看）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T14:43:24.857

使用 a`StringBuilder`而不是串联。每个连接都创建一个新的字符串实例并丢弃旧的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T14:43:50.143

尝试重构，以便在第二种方法中用于拆分字符串的正则表达式存储在静态方法中，并且已使用 RegexOptions.Compiled 选项构建。更多关于这里的信息：http: [//msdn.microsoft.com/en-us/library/8zbs0h2f.aspx](http://msdn.microsoft.com/en-us/library/8zbs0h2f.aspx)。

我没有测试这个理论，但我想每次都必须重新创建正则表达式会很耗时。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T15:45:52.093

这是对 ctacke 对 Jon Skeet 回答的评论的回应（评论时间不长）

> 我一直认为 foreach 比 for 循环慢，因为它必须使用迭代器。

实际上，不，在这种情况下 foreach 会更快。索引访问是边界检查（即 i 在循环中被检查三次：一次在 for() 中，一次用于两个 ca[i]s），这使得 for 循环比 foreach 慢。

如果 C# 编译器检测到特定语法：

```
 for(i = 0; i < ca.Length; i++) 
```

然后它将执行特别优化，删除内部边界检查，使 for() 循环更快。但是，由于这里我们必须将 ca[0] 视为一种特殊情况（以防止输出出现前导空格），因此我们无法触发该优化。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T16:29:30.867

我知道他们对 RegEx 的看法，用它来解决问题，现在你有两个问题，但我仍然是粉丝，只是为了笑，这里是 RegEx 版本。正则表达式，带有一点点开始就很容易阅读，代码更少，并且可以让你轻松地插入额外的分隔符（就像我对逗号所做的那样）。

```
 s1 = MakeNiceString( "LookOut,Momma,There'sAWhiteBoatComingUpTheRiver" ) );

   private string MakeNiceString( string input )
   {
       StringBuilder sb = new StringBuilder( input );
       int Incrementer = 0;
       MatchCollection mc;
       const string SPACE = " ";

       mc = Regex.Matches( input, "[A-Z|,]" );

       foreach ( Match m in mc )
       {
           if ( m.Index > 0 )
           {
               sb.Insert( m.Index + Incrementer, SPACE );
               Incrementer++;
           }
       }

       return sb.ToString().TrimEnd();
   } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-23T16:41:27.630

我的第一个重构是将方法的名称更改为更具描述性的名称。MakeNiceString imo 不是一个可以向我表明此方法作用的名称。

PascalCaseToSentence 怎么样？不喜欢这个名字，但它比 MakeNiceString 好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-10T12:22:18.160

这是一个稍微更优化的版本。我从以前的海报中获得了建议，但也以块方式附加到字符串生成器中。这可能允许字符串生成器一次复制 4 个字节，具体取决于字的大小。我还删除了字符串分配，只需将其替换为 str.length。

```
 static string RefactoredMakeNiceString2(string str)
    {
        char[] ca = str.ToCharArray();
        StringBuilder sb = new StringBuilder(str.Length);
        int start = 0;
        for (int i = 0; i < ca.Length; i++)
        {
            if (char.IsUpper(ca[i]) && i != 0)
            {
                sb.Append(ca, start, i - start);
                sb.Append(' ');
                start = i;
            }
        }
        sb.Append(ca, start, ca.Length - start);
        return sb.ToString();
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T19:52:15.297

您的解决方案的正则表达式版本在结果上与原始代码不同。也许代码的更大上下文避免了它们不同的区域。原始代码将为任何不是小写字符的内容添加一个空格。例如`"This\tIsATest"`，将成为`"This \t Is A Test"`原始版本，但`"This\t Is A Test"`使用正则表达式版本。

```
(?<!^)(?=[^a-z]) 
```

是您想要更紧密匹配的模式，但即便如此它仍然忽略 i18n 的问题。以下模式应该解决这个问题：

```
(?<!^)(?=\P{Ll}) 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-01-23T17:08:48.417

在 C#（.Net，真的）中，当您附加一个字符串时，后台会发生几件事。现在，我忘记了细节，但它是这样的：

 ``string A = B + C;

A += D; A += E;

// ... rinse-repeat for 10,000 iterations`  `对于上面的**每一行**，.NET 将：1) 为 A 分配一些新内存。2) 将字符串 B 复制到新内存中。3) 扩展内存以保存 C。 4) 将字符串 C 附加到 A。

字符串 A 越长，花费的时间就越多。再加上，你这样做的次数越多，A 得到的时间越长，这需要的时间就越长。

但是，使用 StringBuilder 您不会分配新内存，因此您可以跳过该问题。

如果你说 ：

 `````
StringBuilder A = new StringBuilder();
A.Append(B);
A.Append(C);
// .. rinse/repeat for 10,000 times...

string sA = A.ToString(); 
````  `StringBuilder（编辑：固定描述）在内存中有一个字符串。它不需要为每个添加的子字符串重新分配整个字符串。当您发出 ToString() 时，字符串已经以正确的格式附加。

一个镜头而不是一个需要越来越长的周期的循环。

我希望这有助于回答为什么花费的时间要少得多。

# java - 你有什么“为建筑而建筑”的好例子吗？

> ID：473088
> 
> 赞同：8
> 
> 时间：2009-01-23T14:33:38.840
> 
> 标签：java, database, architecture

只是收听本周的[播客](https://blog.stackoverflow.com/2009/01/podcast-38/)，并认为将一些你已经看到设计的“架构”方面比它应该更主导事物的经历组合在一起会很好。

Java 在这方面经常受到负面报道，随着 Java EE 复杂性的增加，负面报道也越来越多。在 2004 年之后，我对时间图的 Java 体验急剧下降，所以我觉得没有资格发表评论。

我最近的经历是一位架构师拼命地试图在一组（关系）数据库表（恰好是 Oracle）中准确地表示对象模型。结果是一个数据库模式，如果不先预连接一堆表（在物化视图中），就不可能有效地查询。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T14:51:28.163

哦是的 ！

在我的上一份工作中，从事一个相当大的项目，我们有一个架构团队来部署我们使用的整个框架。他们设计了一个定制的 ORM（大约在 2000 年，Hibernate 不像今天那么普遍）和一个基于 Swing 的定制 RCP 框架。

ORM 并没有那么糟糕。他们只是过度关注循环依赖，所以在某些情况下，我们很难表达我们的领域模型，因为业务确实需要循环依赖（业务对象可以在不同的管理单元之间双向流动）。

Swing 框架简直就是地狱。他们试图实现一个组件模型，看起来有点像分层控制器。它在纸上看起来非常好：您可以拥有可以重复使用的组件。模型、视图和控制器明显分开。但实际上，该框架并没有提供足够的灵活性，所以我们不得不保留对 JComboBox 的引用来通过抽象层获取数据。我们必须为每一小块 UI 编写 4-5 个类。在某些情况下，在表单上添加复选框需要几天时间。调试很糟糕，因为每个简单操作的流程都要经过 15-20 个类。令人惊讶的是，表演还可以。

最糟糕的是，每个 Swing 组件都包装在一个抽象层中，“以防我们想要更改 UI 工具包”！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-23T16:34:23.057

几年前，乔尔关于这个话题的讨论组出现了一个非常好的寓言。这个故事叫做[我为什么讨厌框架](http://discuss.joelonsoftware.com/default.asp?joel.3.219431.12)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-23T16:51:47.360

我一直认为[这个 Hello World 实现](http://seenonslash.com/node/465)也很好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-23T15:11:54.893

在过去五年里我工作过的每一个地方！

在过去的六年里，我的官方职位一直包含“建筑师”，但是，在脾气暴躁的日子里，我更像是一个反建筑师，在不那么脾气暴躁的日子里，我是一个“极简主义建筑师”。

如果一个组件、框架或功能没有一个很好的明确的理由存在，那么我放弃它！

在我被否决的情况下，额外的不必要的建筑特征总是被证明是最大的问题领域。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-23T14:49:01.990

我工作的公司生产具有 SQL Server 后端数据库的应用程序。其中一个主表需要连接自身六次，然后才能从中获取任何有意义的数据！

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-23T15:16:29.173

这是最近在 reddit 上的，有一个很好的“yo dawg”笑话。

介绍：[RequestProcessorFactoryFactory](http://ws.apache.org/xmlrpc/apidocs/org/apache/xmlrpc/server/RequestProcessorFactoryFactory.html?rel=html)

Reddit 讨论[在这里](http://www.reddit.com/r/programming/comments/7p9ff/yo_dawg_i_heard_you_like_factories_so_i_put_a/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-23T17:25:30.287

我的一个朋友在大型数据库上工作，其中*一切*都必须来自自定义类**“Any”**

/不寒而栗

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-23T14:55:29.560

如果你还没有读过 Joel 关于建筑宇航员的文章（[Live Mesh one](http://www.joelonsoftware.com/items/2008/05/01.html)），我推荐它——这是一本关于这个主题的好书。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T16:56:34.837

我最喜欢的是“自动架构”。基本上只是一组规则，如果你遵循架构正确地落入到位......显然。

因此，这导致每个对象都有一个接口，无论它是否需要抽象和工厂（没有 new() 对你来说！）为每一个服务......*叹息*。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-23T17:23:59.353

不。

架构不应该服从于需求吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T18:26:10.197

我最讨厌的是“架构师”，他们不了解关系概念，并试图在数据库以基于集合的方式更好地执行并且应该被设计为以这种方式使用时使事情以对象方式工作。（数据库不应该由面向对象程序员转变为架构师设计，它们应该由数据库专家设计）以及认为将多个事物放在一个主基表中（过度概括）然后最终得到超过 100 个更“优雅”的架构师该表的外键和引用它的每个查询以及主要的性能噩梦（以及删除记录的荒谬过程）。

# apache-flex - 在 Flex 中的自定义组件之间传递值 - mxml

> ID：473093
> 
> 赞同：1
> 
> 时间：2009-01-23T14:34:34.173
> 
> 标签：apache-flex, components

如何将自定义组件中的值传递回 main.mxml？我需要这样做以传回 ana 数组集合

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T16:50:34.383

您可以使用静态 Application.application.yourPublicMethodName() 或 .yourPublicPropertyName = n 直接调用 Application，但您也可以考虑使用事件框架，以保持组件松散耦合。由于您的组件根据定义是一个事件分发器，您可以简单地从其中分发一个事件，并让您的 Application 类监听该事件。

在 MXML 中，对于组件类，它看起来像这样：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="400" height="300">

    <mx:Metadata>
        [Event(name="buttonClicked", type="flash.events.Event")]
    </mx:Metadata>

    <mx:Script>
        <![CDATA[

            public var someValue:int = 0;

            private function buttonClick():void
            {
                someValue = 1;
                dispatchEvent(new Event("buttonClicked"));
            }

        ]]>
    </mx:Script>

    <mx:Button label="Click Me" click="buttonClick()" />

</mx:Canvas> 
```

...对于应用程序，如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" xmlns:local="*">

    <mx:Script>
        <![CDATA[

            import mx.controls.Alert;

            private function myComponent_buttonClicked(event:Event):void
            {
                Alert.show(event.currentTarget.someValue.toString());
            }

        ]]>
    </mx:Script>

    <local:MyComponent buttonClicked="myComponent_buttonClicked(event)" />

</mx:Application> 
```

组件类中的 Event 元数据标签告诉编译器组件调度了一个 flash.events.Event 类型的事件（“buttonClicked”），它将它作为 MyComponent 标签上的一个事件公开；然后，您需要做的就是为该事件连接一个侦听器，并通过该事件的 currentTarget 属性，您可以访问该组件的所有公共数据。

只是想我会为你提供一个有趣的选择。希望能帮助到你！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T16:18:37.550

知道了; 只需要导入 mx.core.Application；

# php - 可滚动表格上方的固定标题

> ID：473094
> 
> 赞同：0
> 
> 时间：2009-01-23T14:34:42.660
> 
> 标签：php, html, css

我正在尝试在单独的 div 中保留一个表头，而下方的 div 能够滚动所有记录列表。两个 div 都在名为 Layer 3 的 div 中。这是我正在使用的 css 文件：

```
#Layer3
{
    position:absolute;
    width: 89%;
    height: 40%;
    left: 10%;
    top: 56%;
    background-color: #f1ffff;
}

#Layer3 h1 {
    font-size: medium;
    color: #000033;
    text-decoration: none;
    text-align: center;
}

.tableheader {
}

.tablecontent {
    overflow: auto;
} 
```

以及我用来生成 html 的部分 php 代码：

```
echo '<div id="tableheader" class="tableheader">';

echo "<h1>{$query} Auctions</h1>" . "\n"; 
echo "</div>";
echo '<div id="tablecontent" class="tablecontent">';

echo "<table border='0' width='100%'><tr>" . "\n"; 

echo "<td width='15%'>Seller ID</td>" . "\n";
echo "<td width='10%'>Start Date</td>" . "\n";
echo "<td width='75%'>Description</td>" . "\n";

echo "</tr>\n";

// printing table rows

foreach ($rows as $row)
{
    $pk = $row['ARTICLE_NO'];
    echo '<tr>' . "\n"; 

    // table contens generated in here

    echo '</tr>' . "\n"; 
}
}

echo "</div>"; 
```

我不确定我错过了什么，但 tableheader 似乎不是静止的，甚至与 tablecontent 分开。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T14:44:35.323

您忘记`<table>`在主 foreach() 循环后关闭标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T14:45:16.477

div 名称不等于 div id。#Layer3 正在引用 ID 为 Layer3 的元素。只允许一个元素具有给定的 id；所有 id 必须是唯一的。

不要忘记关闭您的标签（表格）。

如果 div#Layer3 正在滚动其中的所有内容，则它有一些溢出集。将其重新定义为溢出：隐藏在#Layer3 样式中。您可能需要尝试使用边距和浮动来使事情正确定位，但请留给您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:25:59.700

请允许我将您的问题分解为您感兴趣的裸元素。特别是，我将删除所有`<div>`节点。这是您非常基本的表格：

```
<table>
   <thead class="tableheader">
      <tr>
         <th>Seller ID</th>
         <th>Start Date</th>
         <th>Description</th>
      </tr>
   </thead>
   <tbody class="scrolling">
      <tr>
         <td>28</td><td>25 January 2009</td><td>Hello World!</td>
      </tr>
      <tr> etc. </tr>
   </tbody>
</table> 
```

（注意`<thead>`元素的使用。）

现在这里的样式表将产生你想要的滚动：

```
.tableheader {
    display: block;
}

.scrolling {
    display: block;
    height: 300px;
    overflow: auto;
    width: 100%
}

th, td { /* first column */
    width: 200px
}

th + th, td + td { /* second column */
    width: 240px
}

th + th + th, td + td + td { /* third column */
    width: 316px
} 
```

请注意，设置的结果`display:block`是您必须修复列的宽度......

# python - 检查给定键是否已存在于字典中并将其递增

> ID：473099
> 
> 赞同：317
> 
> 时间：2009-01-23T14:35:39.490
> 
> 标签：python, dictionary

给定一个字典，我如何确定该字典中的给定键是否已设置为非 None 值？

即，我想这样做：

```
my_dict = {}

if (my_dict[key] != None):
  my_dict[key] = 1
else:
  my_dict[key] += 1 
```

即，如果那里已经有一个值，我想增加该值，否则将其设置为 1。

* * *

## 回答 #1

> 赞同：348
> 
> 时间：2009-01-23T14:38:49.797

您正在寻找[`collections.defaultdict`](https://docs.python.org/3/library/collections.html#collections.defaultdict)（适用于 Python 2.5+）。这

```
from collections import defaultdict

my_dict = defaultdict(int)
my_dict[key] += 1 
```

会做你想做的。

对于常规的 Python `dict`s，如果给定键没有值，则在访问 dict 时将*不会*得到-将引发 a。因此，如果您想使用常规，而不是您的代码，您将使用`None``KeyError``dict`

```
if key in my_dict:
    my_dict[key] += 1
else:
    my_dict[key] = 1 
```

* * *

## 回答 #2

> 赞同：333
> 
> 时间：2009-01-23T15:39:05.353

我更喜欢在一行代码中做到这一点。

```
我的字典 = {}

my_dict[some_key] = my_dict.get(some_key, 0) + 1

```

字典有一个函数，get，它有两个参数——你想要的键和一个默认值（如果它不存在）。我更喜欢这种方法 defaultdict 因为您只想处理这一行代码中不存在密钥的情况，而不是无处不在。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2011-10-28T01:03:34.870

我个人喜欢使用`setdefault()`

```
my_dict = {}

my_dict.setdefault(some_key, 0)
my_dict[some_key] += 1 
```

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2009-01-23T14:41:38.853

你需要这个`key in dict`成语。

```
if key in my_dict and not (my_dict[key] is None):
  # do something
else:
  # do something else 
```

但是，您可能应该考虑使用`defaultdict`（如 dF 建议的那样）。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-02-04T10:32:38.813

要回答“*如何确定该字典中的给定索引是否已设置为非无值*”的问题，我更喜欢这个：

```
try:
  nonNone = my_dict[key] is not None
except KeyError:
  nonNone = False 
```

这符合已经调用的 EAFP 概念（更容易请求宽恕而不是许可）。它还避免了字典中的重复键查找，因为`key in my_dict and my_dict[key] is not None`如果查找很昂贵，它会很有趣。

对于您提出的实际*问题*，即如果存在 int 则递增，否则将其设置为默认值，我还建议

```
my_dict[key] = my_dict.get(key, default) + 1 
```

正如安德鲁威尔金森的回答一样。

如果您在字典中存储可修改的对象，还有第三种解决方案。一个常见的示例是[multimap](http://en.wikipedia.org/wiki/Multimap)，您可以在其中存储键的元素列表。在这种情况下，您可以使用：

```
my_dict.setdefault(key, []).append(item) 
```

如果字典中不存在 key 的值，setdefault 方法会将其设置为 setdefault 的第二个参数。它的行为就像一个标准的 my_dict[key]，返回键的值（可能是新设置的值）。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-01-23T15:09:59.967

同意cgoldberg。我是怎么做的：

```
try:
    dict[key] += 1
except KeyError:
    dict[key] = 1 
```

所以要么像上面那样做，要么像其他人建议的那样使用默认字典。不要使用 if 语句。那不是Pythonic。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-01-23T16:17:20.360

从许多答案中可以看出，有几种解决方案。尚未提及 LBYL 的一个实例（在你跳跃之前查看），has_key() 方法：

```
my_dict = {}

def add (key):
    if my_dict.has_key(key):
        my_dict[key] += 1
    else:
        my_dict[key] = 1

if __name__ == '__main__':
    add("foo")
    add("bar")
    add("foo")
    print my_dict 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-23T15:00:45.977

您尝试执行此操作的方式称为 LBYL（在您跳跃之前查看），因为您在尝试增加您的值之前检查条件。

另一种方法称为 EAFP（更容易请求宽恕而不是许可）。在这种情况下，您只需尝试该操作（增加值）。如果失败，您将捕获异常并将值设置为 1。这是一种稍微 Pythonic 的方法（IMO）。

[http://mail.python.org/pipermail/python-list/2003-May/205182.html](http://mail.python.org/pipermail/python-list/2003-May/205182.html)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2015-12-30T11:00:52.420

有点晚了，但这应该可以。

```
my_dict = {}
my_dict[key] = my_dict[key] + 1 if key in my_dict else 1 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-08-19T22:47:28.917

这不是直接回答问题，但对我来说，看起来您可能想要[collections.Counter](https://docs.python.org/3/library/collections.html#collections.Counter)的功能。

```
from collections import Counter

to_count = ["foo", "foo", "bar", "baz", "foo", "bar"]

count = Counter(to_count)

print(count)

print("acts just like the desired dictionary:")
print("bar occurs {} times".format(count["bar"]))

print("any item that does not occur in the list is set to 0:")
print("dog occurs {} times".format(count["dog"]))

print("can iterate over items from most frequent to least:")
for item, times in count.most_common():
    print("{} occurs {} times".format(item, times)) 
```

这导致输出

```
Counter({'foo': 3, 'bar': 2, 'baz': 1})
acts just like the desired dictionary:
bar occurs 2 times
any item that does not occur in the list is set to 0:
dog occurs 0 times
can iterate over items from most frequent to least:
foo occurs 3 times
bar occurs 2 times
baz occurs 1 times 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-12-10T14:12:56.957

这是我最近提出的用于解决此问题的单线。它基于[setdefault](http://docs.python.org/2/library/stdtypes.html#dict.setdefault)字典方法：

```
my_dict = {}
my_dict[key] = my_dict.setdefault(key, 0) + 1 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2011-10-11T06:23:38.247

我一直在寻找它，但在网上没有找到它，然后用 Try/Error 试试运气并找到了它

```
my_dict = {}

if my_dict.__contains__(some_key):
  my_dict[some_key] += 1
else:
  my_dict[some_key] = 1 
```

# git - 如何忽略 git 存储库根目录中的目录，但将其包含在树的更下方？

> ID：473102
> 
> 赞同：42
> 
> 时间：2009-01-23T14:36:54.637
> 
> 标签：git

我需要使用`.gitignore`来排除存储库根目录中的目录。但是，其他具有相同名称的目录存在于目录树的更深处，我需要将它们包括在内。似乎当我将目录名称放入时`.gitignore`，它会捕获所有这些目录，而不仅仅是我需要忽略的那个。我知道这`.gitignore`实际上不是文件列表，而是模式。那么如何构建一个模式来忽略我的根目录中的一个文件，而不是更远的同名文件呢？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-23T14:50:34.873

使用前导 /

```
 /file.x 
```

这只会匹配顶级 file.x，但不会匹配较低级别的文件，例如“want/file.x”。

# mysql - 一个大的 MySQL 数据库还是一千个小的 SQLite 数据库？

> ID：473109
> 
> 赞同：14
> 
> 时间：2009-01-23T14:38:51.200
> 
> 标签：mysql, sqlite, architecture

我正在开发一个基于 Web 的组织工具。我的目标市场与精彩的 Basecamp 不同，但假设用户和数据交互的方式看起来是一样的。

我将不得不处理用户定制、文件上传和图形调整。每个帐户也有一个论坛。而且我想提供一种轻松备份每个帐户的方法。

我一直在思考如何创建一个合理的架构，并接受过培训，可以在单个（但如果需要的话是分布式的）MySQL DB 中使用精美的规范化数据。最近我一直在想：是否可以考虑使用一个 SQLITE DB 来存储每个帐户的数据，而只使用 MYSQL 进行一般的网站管理？

**亲：**

*   备份很简单：设置版本、压缩、上传。
*   如果每个帐户都使用大量论坛，请不要打扰：每个帐户的混乱都在一个文件中。
*   SQLITE 速度很快，没有昂贵的连接时间......
*   表格方案要简单得多：无需每次都区分帐户

**缺点：**

*   不知道是否可扩展
*   不知道硬盘能不能跟上
*   不知道是否有办法让 SQLITE 不存储在 RAM 中，因为它很快就会成为一场灾难
*   很多目录和子目录：可以吗？
*   维护问题：升级现场站点意味着一一升级所有数据库
*   开发问题：设置开发/预生产/生产环境将非常困难
*   commom 数据仍然需要使用 mysql，因此我们将以每个页面的 2 个 DB 连接结束，arg

优点更多的缺点，仍然让我想知道（齐柏林风格）。

你说什么 ？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-24T11:44:33.593

本质上，您的问题是：对于多租户 SaaS 应用程序，以上哪个更好？

一千个小的 sqlite 数据库可能会吸引人，但可能无法扩展。

我将依次解决您的观点：

*   备份很简单：设置版本、压缩、上传。

如果在备份期间发生更新会怎样？您的备份需要多长时间（比如说，有一千个帐户，每个帐户有一百万个帖子）？您的备份是在备份期间锁定数据库，还是备份一致的数据视图，或者两者都不是？更新期间进行的数据库备份是否在每种情况下都能正确恢复？你测试过这些东西吗？

由于并发访问问题，我认为备份 sqlite 数据库并不像您想象的那么容易。

*   SQLITE 速度很快，没有昂贵的连接时间......

您暗示 MySQL 连接时间会“昂贵”可能是错误的。你有硬数据吗？实际上，通过 LAN 连接到服务器并不需要很长时间。

*   表格方案要简单得多：无需每次都区分帐户

如果您需要更改这 1,000 个小型数据库的架构，您是否考虑过如何进行迁移？会对服务产生什么影响？

* * *

我现在将添加一些我自己的：

*   可扩展性：如果您依赖具有锁定语义的本地文件系统（我相信 sqlite 会这样做），您不能简单地添加更多 Web 服务器，因为它们会有自己的文件系统。

因为 sqlite 不是基于网络的系统，所以不能只添加更多的 Web 服务器。您需要将您的用户划分到多台服务器上，并确保他们只访问自己的“家庭”服务器（这会带来一些问题，但可能是可行的），或者想办法在服务器之间共享一个 sqlite 数据库，这不会很漂亮，并且很可能会抹去它比（例如）MySQL 所拥有的任何可感知的性能优势。

*   可维护性 - 如果您的开发团队曾经对数据库进行架构更改（这不仅可能，而且很有可能），则需要将其应用于这 1,000 个小型数据库。成功地。有回滚计划。

我认为用一千个小型 sqlite 数据库扩展系统是无法扩展的。特别是，您最终可能会发现，最终不是 1,000 个微小的，而是 995 个微小的和 5 个相当大的。

使用专用 MySQL 服务器将使您能够执行中央备份和迁移。它将使您能够使用该框上的资源（即 RAM）来缓存数据库中最常用的部分，无论它们碰巧在哪个帐户中。

用于缓存大型 MySQL 数据库（例如 Innodb 缓冲池）的 RAM 可以在请求之间重用，并在其中的所有数据（例如表、行、列）之间共享。sqlite 数据库每次需要时都会从磁盘读取数据，除了在单个会话中。

* * *

我的建议：

*   考虑以上几点，如果你喜欢忽略它们
*   在生产级硬件上使用高模拟负载测量应用程序的性能。确保为数据库服务器使用生产级硬件（例如电池支持的 RAID 控制器）
*   如果可以的话，将其与 sqlite 实现进行比较。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T14:46:23.820

我给了它更多的想法，我看到了更多的问题：

*   如果我想为所有论坛使用一个公共区域，我被熏了
*   如果我想搜索所有网站，那将是世界末日
*   如果我想要统计数据，上帝保佑我的灵魂

这是个坏主意。

无论如何，把它写在 SO 上迫使我认真考虑它。最好在开始之前有一个清晰的头脑。

如果有一天，有人像我一样愚蠢，希望他能点击页面，这样可以帮助他重新考虑

喜欢这个网站（即使它是 ASP :-p）：帮助自己的最快方式，同时仍然帮助他人。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T14:42:49.273

SQLite 并不是最可扩展的解决方案。你被训练使用一个漂亮的、标准化的数据库是有原因的，如果需要，它可以分发。它具有可扩展性，并且更易于维护。

我会坚持使用单个 MySQL 数据库，因为您已经熟悉该架构，而且它很可能是这项工作的最佳解决方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-03T22:18:05.337

事后我才看到你的帖子。我运行一个 mediawiki 托管农场，其中每个 wiki 都有自己的 sqlite 数据库。我看到的主要问题是每个数据库都是独立加载的，并导致一些内存命中。除此之外，它还可以很好地用于备份处理，并允许每个 wiki 拥有自己的数据库。由于 mediawiki 没有设置为拥有多个 wiki，这意味着在 mysql 中，每个 wiki 都必须拥有自己的一组表，并带有自己的表前缀。这真的没有成功，sqlite 是一个很好的选择。

如果我从头开始构建系统，我会使用 mysql。由于我使用的是预建系统并且每个用户都有自己的筒仓，因此 sqlite 工作得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T20:15:14.197

您可以查看 CouchDB 的大规模并发性。

# java - 在多线程（Java 或 .Net）程序中，我可以假设复制变量是原子的吗？

> ID：473111
> 
> 赞同：6
> 
> 时间：2009-01-23T14:41:07.280
> 
> 标签：java, .net, multithreading, race-condition

当我想知道这个问题时，我担心我正在设计的应用程序中的竞争条件。

假设我有一个由程序的一个组件管理的大型数组或某种集合，我们称该组件为 Monitor。它的工作是定期检查集合是否“脏”，即最近发生了变化，如果是，则将快照写入磁盘（这是在应用程序发生崩溃时检查点）并再次将其标记为干净。

同一程序的其他组件，在不同的线程中运行，调用监视器的方法来添加数据或修改数组/集合中的数据。这些方法将集合标记为脏。

现在，更改方法在其他组件的线程中运行，对吗？如果我不是那么幸运，可能会在将快照写入磁盘时调用它们，更改已写入的数据，设置脏标志，然后监视器的线程将其取消设置，而无需保存更改（它当它改变时已经超过了元素）。所以我有一个被标记为干净的脏集合。

有一段时间，我想我可以通过制作一个临时的集合副本来解决这个问题，把它标记为干净，然后去序列化这个副本。但是复制会是原子的吗，即我可以确定在我复制时集合不会改变吗？

同时，我想我找到了更好的解决方案，比如

*   在开始写入磁盘之前设置锁定标志，并使数据更改方法等到取消设置标志
*   让数据更改方法写入“更改队列”而不是直接写入集合，并让线程执行该队列的磁盘写入过程

我认为锁定标志可能是最好的方法。**但我还是很好奇：复制变量是原子的吗？**

* * *

**追问**：也许这应该是一个问题，但实际上它非常相似。根据下面的答案，我的“锁定标志”方法也可能不起作用，对吧？因为数据更改方法可能会在锁定标志设置为“锁定”值时检查锁定标志并确定它没有被锁定。因此，如果我真的想正确地做到这一点，我需要一个像互斥锁这样的特殊结构，对吗？

* * *

[感谢埃里克森](https://stackoverflow.com/users/3474/erickson)对我的后续行动的[非常有帮助的回答。](https://stackoverflow.com/questions/473111/in-a-multithreaded-java-or-net-program-can-i-assume-that-copying-a-variable-i#473382)我真的应该提出这两个问题，所以我可以接受两个答案。请也给他投票。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-23T14:45:55.147

不会。例如，Java 中的长变量在 32 位机器上不是原子的。

此外，还有一个“线程缓存”问题 - 除非您的变量是 volatile 或在同步块内，否则另一个线程可能看不到变量值的更改。这适用于所有类型的变量，而不仅仅是长变量。

在这里阅读：http: [//gee.cs.oswego.edu/dl/cpj/jmm.html](http://gee.cs.oswego.edu/dl/cpj/jmm.html)，尤其是“原子性”和“可见性”段落。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T14:43:03.750

不，它不是原子的。 [请参阅此问题](https://stackoverflow.com/questions/409688/multithreaded-paranoia#409715)以了解为什么以及如何处理它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T14:51:02.610

看看[java.util.concurrent.atomic](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/atomic/package-summary.html) - 里面可能有一些你可以使用的好东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T15:49:14.990

在 JVM 上工作时，您需要关注对其他线程的更改的可见性。通常，您应该在一个`synchronized`块中进行分配，或者变量应该是`volatile`，或者您应该使用包中的变量包装器`java.util.concurrent.atomic`。

但是，在您的情况下，听起来您只有一个线程可以清除“脏”标志 - 保留数据的线程。如果是这种情况，请在写入数据*之前清除标志。*如果其他线程*在*您写入数据时设置它，它将保持设置直到下一次计划写入。我会使用`AtomicBoolean`, 在检查标志和清除标志之间为您的持久性线程提供原子性，如下所示：

```
private final AtomicBoolean dirty = new AtomicBoolean();

/**
 * Any method that modifies the data structure should set the dirty flag.
 */
public void modify() {
  /* Modify the data first. */
  ...
  /* Set the flag afterward. */
  dirty.set(true);
}

private class Persister extends Thread {
  public void run() {
    while (!Thread.interrupted()) {
      if (dirty.getAndSet(false)) {
        /* The dirty flag was set; this thread cleared it 
         * and should now persist the data. */
         ...
      }
    }
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T14:44:44.183

设置 32 位（至少在 .NET 中）是原子的，但它对您没有好处。您必须阅读它才能知道它是否被锁定，因此您可能会阅读它，并且在阅读之后，其他人在您设置它之前阅读它，因此两个线程最终*进入*“受保护”代码。这正是实际同步对象（如 .NET Monitor 类）的用途。您也可以使用 Interlocked 来检查和增加锁定变量。

另请参阅：[访问 C# 中的变量是原子操作吗？](https://stackoverflow.com/questions/9666/is-accessing-a-variable-in-c-an-atomic-operation)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T14:53:07.567

很大程度上取决于您正在运行的硬件和 JVM

在某些硬件和某些 JVM 上，某些副本将是原子的，但更安全的是假设情况并非如此，即使是简单的整数到整数赋值也可以转换为 x856 硬件上的四个机器指令。

字符串和数组副本可能涉及数千条指令序列，并且两个线程可以同时更新。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-01-23T14:45:59.267

据我了解，并非总是如此。

Int32 将是，Int64 不会在 32 位系统上，因为它需要 2 x 32 位。因此，它不适合一个 32 位单元。

# c# - .NET/C# 中的 TreeView 双击行为

> ID：473113
> 
> 赞同：14
> 
> 时间：2009-01-23T14:41:37.620
> 
> 标签：c#, .net, winforms, treeview, double-click

我有一个常规的 .NET [Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)树视图控件。节点设置如下：

团体

- -孩子

- -孩子

如果我双击折叠的 Group 节点，它会展开（如您所料）并触发 NodeMouseDoubleClick 事件，如果所选节点不是组节点，我的代码会在其中执行某些操作。

当组位于树视图底部附近时会出现问题，因此当我双击组节点时，它需要树视图垂直展开以使子节点适合视图。在这种情况下，如果我双击 Group 节点，当它展开并调整树视图时，我的鼠标光标位于子节点上（它必须向上推所有内容），这会导致 NodeMouseDoubleClick 认为子节点被选中，这会导致非常奇怪的行为。

我怎样才能解决这个问题？我不应该使用 NodeMouseDoubleClick 还是..？

我看到它也在反馈报告中解释了展开*[/折叠后 TreeView DoubleClick 事件的问题导致滚动的变化](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=304958)*。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-23T15:30:41.797

`NodeDoubleClick`很好，但不要使用,`e.Node`使用`this.treeView1.SelectedNode`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-25T13:40:03.570

双击 TreeNode 是一种鼠标手势，TreeView 已经“使用”它来折叠/展开节点 Microsoft 没有像 Apple 那样推动 UI 标准，并且在某种程度上令人失望的是 Microsoft 公开了 NodeDoubleClick，因为他们鼓励您使用自己的自定义行为修改 TreeView。这可能会误导最终用户，他们期望通用控件具有通用行为。

来自*Ben Shneiderman*的《 ***[Designing the User Interface](https://rads.stackoverflow.com/amzn/click/com/0201694972)*****》，界面设计的八条黄金法则中**的第一条：

 ***> 1.  力求一致性。
> 
> 在类似情况下，应要求采取一致的行动顺序；提示、菜单和帮助屏幕中应使用相同的术语；始终使用一致的命令。

长话短说，也许你不应该使用 NodeMouseDoubleClick。

# c - listview 控件是否有选择更改事件？

> ID：473115
> 
> 赞同：4
> 
> 时间：2009-01-23T14:41:41.240
> 
> 标签：c, winapi, listview

是否有与`LBN_SELCHANGE`列表视图等效的事件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T14:47:09.093

用于`LVN_ODSTATECHANGED`活动。

event 参数是一个指向 struct 类型的指针`NMLVODSTATECHANGED`。使用`uNewState`和`uOldState`位字段来确定其中哪些是选择更改（因为还有其他更改）。你正在寻找`LVIS_SELECTED`国旗。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-10-04T17:30:00.587

使用`LVN_ITEMCHANGED`通知代码。

```
NOTIFY_HANDLER(IDC_FILELIST, LVN_ITEMCHANGED, OnListViewItemChanged)

LRESULT CMainDlg::OnListViewItemChanged(int, LPNMHDR hdr, BOOL&) {
    NMLISTVIEW* lpStateChange = reinterpret_cast<NMLISTVIEW*>(hdr);
    if ((lpStateChange->uNewState ^  lpStateChange->uOldState) & LVIS_SELECTED) {
        // Do something
    }
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-31T14:52:33.437

但不要信任此事件处理程序中的 ListView_GetSelectionMark() - 使用

`ListView_GetNextItem(list_hwnd, -1, LVNI_SELECTED);`

# command - 将带有空格的路径作为参数传递给 bat 文件

> ID：473117
> 
> 赞同：67
> 
> 时间：2009-01-23T14:42:53.843
> 
> 标签：command, parameters, batch-file

我有一个简单的 bat 脚本，可以将文件从已知目录复制到用户指定的目录。如何将路径（它可能包含空格）传递给我的脚本并将其与 xcopy 命令一起使用？

* * *

在我的代码中，我有以下内容

```
:READ_PWA_PATH
    if "%1" == "" ( 
        rem Set default path
        set PWA_PATH="C:\Program Files\PWA"
        rem
        echo You have not specified your PWA url.
        echo Default will be assumed: C:\Program Files\PWA. 
        choice /C:YN /M:"Do you wish to continue [Y] or cancel the script [N]?"
            IF ERRORLEVEL ==2 GOTO CANCEL
            IF ERRORLEVEL ==1 GOTO READ_WSS_SERVER_EXTENSIONS_PATH
        GOTO END
    ) else (
        set PWA_PATH=%1
    ) 
```

如果我只是调用脚本，我会收到以下错误：

```
C:\Projects\Setup>install.cmd "C:\program files (x86)"

-----------------
SETUP SCRIPT
-----------------

files was unexpected at this time.
C:\Projects\Setup> 
```

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2010-12-08T14:43:00.247

使用`"%~1"`. `%~1`单独删除周围的引号。但是，由于您不知道输入参数是否`%1`有引号，因此您应该确保`"%~1"`它们被肯定地添加。这在连接变量时特别有用，例如`convert.exe "%~1.input" "%~1.output"`

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-23T16:10:32.387

有趣的一个。我喜欢收集有关在 cmd/command 中处理引号的引号。

您的特定脚本通过使用 %1 而不是 "%1" 得到修复！！！

通过添加“echo on”（或摆脱 echo off），您可以很容易地发现它。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-05-05T16:29:25.177

我认为 OP 的问题是他想做以下**两**件事：

*   传递可能包含空格的参数
*   测试是否缺少参数

正如几位海报所提到的，要传递包含空格的参数，您必须用双引号将实际参数值括起来。

测试一个参数是否缺失，我一直学的方法是：

```
if "%1" == "" 
```

但是，如果实际参数被引用（如果值包含空格，则必须如此），这将变为

```
if ""actual parameter value"" == "" 
```

这会导致“意外”错误。如果您改为使用

```
if %1 == "" 
```

那么引用值不再发生错误。但在这种情况下，当值丢失时，测试**不再起作用——它变成**

```
if  == "" 
```

要解决此问题，请在测试中使用任何其他字符（对 DOS 具有特殊含义的字符除外）而不是引号：

```
if [%1] == []
if .%1\. == ..
if abc%1xyz == abcxyz 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-03-06T07:37:15.810

"%~1" 大部分时间都可以使用。但是，您需要注意以下几点：

1.  Windows NT 4.0 不支持它。您需要 Windows 2000 或更高版本。（如果您正在编写与旧操作系统兼容的脚本，请注意。）
2.  它不会使参数安全和消毒。我的观察是**没有办法正确清理**CMD 脚本中的命令行参数。

为了说明第二点，我举个例子：

```
REM example.cmd
ECHO %~1 
```

运行`example.cmd dummy^&DIR`。& 符号在这里被转义 ( `^&`) 以防止 shell 解释为命令分隔符，因此它成为传递给脚本的参数的一部分。DIR 被解释为*运行脚本的子 shell 内的*命令，而它不应该被解释为。

引用它可能会工作一段时间，但仍然不安全：

```
REM example2.cmd
SETLOCAL EnableExtensions EnableDelayedExpansion
SET "arg1=%~1"
ECHO "%~1"
ECHO !arg1:"=! 
```

`example2.cmd foo^"^&DIR^&^"bar`会打破它。DIR 命令将运行两次，一次在 SET 之后，另一次在第一个 ECHO 之后。你会看到`"%~1"`你认为被引用得很好的东西被论点本身所引用。

所以，没有办法使解析参数安全。

（编辑：`EnableDelayedExpansion`在 Windows NT 4 中也不起作用。感谢这里的信息：[http](http://www.robvanderwoude.com/local.php) ://www.robvanderwoude.com/local.php ）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-23T14:44:36.040

如果您有带空格的路径，则必须用引号 (") 将其括起来。

不确定这是否正是您要问的？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T16:15:52.517

```
@echo off
setlocal enableextensions enabledelayedexpansion

if %1=="" (     
        rem Set default path
        set PWA_PATH="C:\Program Files\PWA"
        rem
        echo You have not specified your PWA url.
        echo Default will be assumed: C:\Program Files\PWA.     
        choice /C:YN /M:"Do you wish to continue [Y] or cancel the script [N]?"
                IF ERRORLEVEL ==2 GOTO CANCEL
                IF ERRORLEVEL ==1 GOTO READ_WSS_SERVER_EXTENSIONS_PATH
        GOTO END
    ) else (
        set PWA_PATH=%1
        @echo !PWA_PATH! vs. %1
        goto end
    )
:READ_WSS_SERVER_EXTENSIONS_PATH
echo ok
goto end
:CANCEL
echo cancelled
:end
echo. final %PWA_PATH% vs. %1 
```

正如[VardhanDotNet](https://stackoverflow.com/questions/473117#473480)提到的那样，`%1`就足够了。

`"%1%"`将在引号周围添加引号：`""c:\Program Files\xxx""`这意味着：

*   '空字符串' ( `""`),
*   后跟“c:\Program”，
*   其次是“这里出乎意料”'Files\xxx'，
*   后跟一个空字符串 ( `""`)

但是请注意，如果您需要`PWA_PATH`在`IF`子句中使用，则需要引用 if as `!PWA_PATH!`（因此`enabledelayedexpansion`作为脚本的开头）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-08-31T10:06:07.423

如果您的路径包含空格，请尝试使用`%~s1`. 这将删除空格并附`~1`加到您的路径，更重要的是它指的是文件的绝对路径。尝试使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-18T13:34:27.733

假设您要通过在 C# 代码中执行批处理文件来备份数据库。这是一个完全有效的解决方案，可以处理路径内的空格。这适用于 Windows。我还没有用单声道测试它。

C#代码：

```
 public bool BackupDatabase()
    {
        bool res = true;
        string file = "db.bat";
        if (!File.Exists(file)) return false;

        BackupPaths.ForEach(path =>
        {
            Directory.CreateDirectory(path);

            string filePath = Path.Combine(path, string.Format("{0}_{1}.bak", Util.ConvertDateTimeToFileName(false), DatabaseName));
            Process process = new Process();
            process.StartInfo.FileName = file;
            process.StartInfo.Arguments = string.Format(" {0} {1} \\\"{2}\\\""
                , DBServerName
                , DatabaseName
                , filePath);

            process.StartInfo.WindowStyle = ProcessWindowStyle.Normal;

            try
            {
                process.Start();
                process.WaitForExit();
            }
            catch (Exception ee)
            {
                Logger.Log(ee);
                res = false;
            }
        });
        return res;
    } 
```

这是批处理文件：

```
@echo OFF
set DB_ServerName=%1
set Name_of_Database=%2
set PathToBackupLocation=%3

echo Server Name = '%DB_ServerName%'
echo Name of Database = '%Name_of_Database%'
echo Path To Backup Location = '%PathToBackupLocation%'

osql -S %DB_ServerName% -E -Q "BACKUP DATABASE %Name_of_Database% TO DISK=%PathToBackupLocation%" 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-09-25T20:56:26.950

在特殊情况下，您希望始终默认为当前目录，或者，只有在未传入参数时才默认为当前目录，您可以使用`%CD%`.

正如[在 Server Fault 上的这个答案中](https://serverfault.com/a/173277/399723)找到的那样：

> Windows 在伪环境变量中维护当前目录`%CD%`。

查看该帖子以获得一个很好的示例，以及如何通过命令行轻松地直接对其进行测试。

就我而言，`myapp.exe`我需要使用命令行标志调用一个应用程序 ( ) `--dir=`，例如：
`myapp --dir=<path-to-desired-directory>`。

由于我一直希望标志始终引用我调用应用程序的目录，因此我可以制作一个批处理文件 ( `mybat.bat`) 来自动捕获我的当前路径，并使用它打开应用程序。

`mybat .`当 mybat.bat 具有以下内容时工作：
`myapp --dir=%1`

这很棒，但能够离开 `.`就更好了。
`mybat`当我将内容更改为：
`myapp --dir=%CD%`

# css - Chrome/Safari 中的边距（或填充不确定）问题

> ID：473119
> 
> 赞同：1
> 
> 时间：2009-01-23T14:43:14.000
> 
> 标签：css, safari, google-chrome

这是我的链接（请注意，它有自动播放音频 - 抱歉......！）

[链接文本](http://tinyurl.com/bt5n4c)

它不是通常的“在 FF 中看起来不错但在 IE 中很糟糕”的问题:)

它在 IE6/7 Firefox 中看起来不错，但在 Chrome 和 Safari 中，它在边距/填充或定位方面存在很大问题。（这缩小了范围吧？）

如果你看看你会明白我的意思。看起来我可能与我的 CSS 规则之一发生冲突，但是这不会在所有浏览器中始终导致问题吗？

任何帮助和指点都将不胜感激。谢谢你。

编辑：不确定为什么我的 reset.css 规则没有生效......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T14:54:25.613

`<h4>`问题是内部`product-panel-content` `<div>`s的边距顶部。

修改以下样式`site.css`：

```
.product-panel-content h4 {
    font-size:140%;
    letter-spacing:-0.5px;
} 
```

成为：

```
.product-panel-content h4 {
    font-size:140%;
    margin-top:0;
    letter-spacing:-0.5px;
} 
```

将修复基于 WebKit 的浏览器（例如 Safari 和 Chrome）中的显示问题。我不确定这是否会导致您的其他浏览器出现其他显示问题，但如果确实如此，请尝试使用`padding-top`on`<h4>`来补充该元素的间距不足。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-09-01T18:10:44.027

Chrome 与任何其他浏览器的不同之处在于它采用指定的元素宽度并*添加*填充以获得最终宽度。而其他浏览器使用填充来分隔内部内容并保持元素的指定宽度。铬在那艘船上掉了下来。

# asp.net-mvc - 我需要什么参考来调用 UpdateModel？

> ID：473124
> 
> 赞同：0
> 
> 时间：2009-01-23T14:44:19.910
> 
> 标签：asp.net-mvc, updatemodel

我正在尝试`UpdateModel`在我的控制器以外的类中使用，但它不起作用。当我调用`UpdateModel`我的控制器类时，它工作得很好。两个类中的引用相同。

有人可以帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:00:37.850

不幸的是，这不是参考问题。您的控制器继承自`Controller`其中具有虚拟`UpdateModel`方法。这允许您在派生类中调用该方法。此方法仅适用于继承自自身`Controller`及其实例的其他类型`Controller`。

# algorithm - 缓存感知算法的简单示例？

> ID：473137
> 
> 赞同：11
> 
> 时间：2009-01-23T14:47:20.387
> 
> 标签：algorithm, caching

有人可以发布任何关于缓存感知算法的简单解释吗？有很多可用的链接，但这些网站中的阅读材料本质上是学术性的，阅读和理解很费时间。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-23T16:01:24.310

缓存感知算法旨在最大限度地减少内存页面进出处理器片上内存缓存的移动。这个想法是为了避免所谓的“缓存未命中”，这会导致处理器在将数据从 RAM 加载到处理器缓存中时停止。

理论上不是最优的缓存感知算法可以胜过理论上“更快”的传统算法，因为缓存感知算法更有效地使用内存。

缓存感知算法被显式编码以利用处理器的缓存行为。有关处理器内存页面大小和“高速缓存行”的详细信息被编码到算法中。因此，缓存感知算法将是高度特定于处理器的。

与传统算法相比，缓存忽略算法被编码为以对缓存更友好的方式使用内存，但它不依赖于底层硬件的详细信息。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-03T17:50:22.263

我认为缓存感知算法的最简单示例之一是访问二维数组行优先与列优先。由于二维数组通常作为数组所有行的串联存储在内存中，因此逐行访问它会将适当的数据在正确的时间放入缓存中。但是，当以列优先顺序访问数组时，内存中的大量跳转和缓存未命中可能会导致速度大幅下降。

举个例子，这个 C++ 代码：

```
for (int i = 0; i < MAX_N; ++i) {
  for (int j = 0; j < MAX_N; ++j) {
   a[i][j] = 10;
  }
} 
```

在我的机器上运行速度比我交换访问单元格的索引（即访问`a[j][i]`）快 3-4 倍。

# c# - 到达表单实例

> ID：473138
> 
> 赞同：0
> 
> 时间：2009-01-23T14:48:39.603
> 
> 标签：c#, winforms

我正在创建一个在 MDI 项目中设计的关卡编辑器应用程序。该应用程序有两个主要的视图模式，`WorldEditor`模式和`ObjectEditor`模式。根据模式，我想要一个单独的属性窗口来显示特定于当前模式的属性设置。

我考虑过使用该`Activated`事件，并从该事件中告诉属性表单加载适当的设置。我需要`PropertyForm`从`World`or `Object`Form 类中访问来完成此操作。这就是我卡住的地方。

我相信我应该能够通过将`PropertyForm`类声明为静态来解决这个问题。由于我一次只使用其中一种类型，因此我希望能够在全球范围内使用它。但是，将表单类声明为`static`会给我编译器错误。我做错了，如果它甚至可能的话。

如何访问和搜索应用程序中处于活动状态的不同表单？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T15:10:22.150

你需要的是一个单例，而不是一个静态类。

在不损失太多性能的情况下，您可以创建不同的 PropertyForm 对象 - 为您拥有的每种“视图”类型创建一个对象。您可以添加一个参数化构造函数 - 应该采用一个对象，该对象具有特定于每个视图的详细信息。这将允许您为每个视图创建特定的 PropertyForm。

如果您真的只想拥有一份 PropertyForm 副本，那么更简单的方法是隐藏该表单。在“显示”事件处理程序中，您可以根据当前视图对其进行自定义。最后考虑单例方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T18:54:03.680

您可能能够从事件处理程序中的`sender`参数中获取您需要的内容。`Activated`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:25:52.837

在我看来，您的 MDI 父窗体（它知道哪个 MDI 子窗口处于活动状态）应该包含对属性窗体的引用。为每个创建的子窗口的 Activated 事件添加一个事件处理程序，使用父窗体中的一个函数，该函数使用来自已激活子窗口的信息来正确设置 Property 窗体。

Sesh 关于单身人士的回答也可能适用，尽管这确实是另一个问题。

# validation - 有没有人使用 YUI 构建表单验证？

> ID：473142
> 
> 赞同：3
> 
> 时间：2009-01-23T14:50:16.527
> 
> 标签：validation, yui

**DUPE：[我可以在 asp.net MVC 中实现的任何 Yahoo YUI 验证框架？](https://stackoverflow.com/questions/93664/any-yahoo-yui-validation-framework-that-i-can-implement-in-asp-net-mvc)**

有没有人使用 YUI 构建了可以模仿 asp.net 如何处理表单验证的表单验证功能？

我知道 jquery 有一个很好的验证插件，希望 YUI 也可以。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T17:53:20.980

YUI 没有将表单验证作为单独的组件内置。多年来，人们做了许多松散的附加组件，例如：

[http://blog.jc21.com/2007-02-05/yui-unobstrusive-javascript-validation/](http://blog.jc21.com/2007-02-05/yui-unobstrusive-javascript-validation/) [http://bubbling-library.com/eng/api/docs/plugins/wizard](http://bubbling-library.com/eng/api/docs/plugins/wizard)

我在 YUI 生态系统中看到的最直接的工作是这个项目：

[http://yuiblog.com/blog/2008/05/08/inputex/](http://yuiblog.com/blog/2008/05/08/inputex/)

我不确定它的当前状态是什么。

我们将在 YUI 中添加一个提供通用表单功能的正式组件，但这有点过时了。

-埃里克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T14:59:46.353

我只是快速浏览了 YUI 工具包，似乎没有任何东西让我眼前一亮。我知道他们在 DataTable 输入上有用于验证的东西，但看起来没有表单的等价物。

# html - div 清除后 IE 中的额外垂直空间

> ID：473143
> 
> 赞同：8
> 
> 时间：2009-01-23T14:50:31.457
> 
> 标签：html, internet-explorer

我创建了一个简单的 div 网格，左浮动它们和一个空 div，每行末尾都有一个 clear 。

这在 Firefox 中运行良好，但在 IE 中，我在行之间获得了额外的垂直空间。我试图应用“clearfix”方法，但我一定做错了什么。

为什么 IE 会插入额外的垂直空间，我该如何摆脱它？

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style>
        root {
            display: block;
        }

        body {
            background: white;
        }

        .colorChip {
            position:relative;
            float: left;
            width: 20px;
            height: 20px;
            margin: 2px;
            border-style: solid;
            border-width: 1px;
            border-color: black;
        }

        .clear {
            clear: both;
        }

        .clearfix {
            display:inline-block;
        }

        .clearfix:after, .container:after {
            clear:both;
            content:".";
            display:block;
            height:0;
            visibility:hidden;
        }

        * html .clearfix {
            height:1%;
        }
        .clearfix {
            display:block;
        }

    </style>
    <!--[if IE]>
<style type="text/css">
  .clearfix {
    zoom: 1;     /* triggers hasLayout */
</style>
<![endif]-->

  </head>

  <body>
    <div class="colorChip clearfix" style="background: rgb(163,143,88)"></div>
    <div class="colorChip" style="background: rgb(190,170,113)"></div>
    <div class="colorChip" style="background: rgb(190,250,113)"></div>
    <div class="clear"></div>
    <div class="colorChip clearfix" style="background: rgb(187,170,128)"></div>
    <div class="colorChip" style="background: rgb(215,197,154)"></div>
    <div class="colorChip" style="background: rgb(243,225,181)"></div>
    <div class="clear"></div>
    <div class="colorChip clearfix" style="background: rgb(104,94,68)"></div>
    <div class="colorChip" style="background: rgb(129,118,92)"></div>
    <div class="colorChip" style="background: rgb(155,144,116)"></div>
    <div class="clear"></div>
  </body>
</html> 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-23T15:14:33.047

IE对空s有点*好笑*`<div>`——它喜欢给它们一行文本的高度。

如果你改成`.clear`这个，它会缩小到 1 个像素：

```
 .clear {
        clear: both;
        height: 1px;
        overflow: hidden;
    } 
```

设置背景颜色以查看发生了什么

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T12:31:21.787

```
.clear {
    clear: both;
    height: 0px;
    overflow: hidden;
} 
```

将其更改为 0px 效果更好..

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-28T14:07:41.807

没有它，它可以在 IE6 中运行，但不能在 IE7 中运行，它可以在 IE7 中运行，但在 IE6 中会增加高度。没有词可以形容我对这个浏览器的仇恨。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-17T13:35:55.973

height: 0px 在 IE 8 中对我不起作用。另外，我不想要 1px 的高度，因为那样我的 div 上会有一条 1px 的白线，背景为灰色，我不想设置class="clear" div 的每个实例的特殊背景颜色。我试过 line-height: 0; 它在 IE8、IE7 和 IE6（我不关心比这更旧的东西）和 FF 3.6 中运行良好，没有添加额外的垂直空间。

```
。清除 {
    明确：两者；
    行高：0；
    溢出：隐藏；
}

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-18T07:57:44.937

我遇到了ie8这个问题并使用了以下

```
.clear
{
    clear:both;
    height:0;
    width:0;
    margin:0;
    padding:0;
    line-height:0;
    overflow: hidden;
    font-size:0px;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-11T10:21:55.927

也看看这里： http: [//nadirnasir.blogspot.com/2009/04/ie-blank-space-after-img-tag-fix.html](http://nadirnasir.blogspot.com/2009/04/ie-blank-space-after-img-tag-fix.html)

# c# - C# listView，如何将项目添加到第 2、3 和 4 列等？

> ID：473148
> 
> 赞同：111
> 
> 时间：2009-01-23T14:51:57.443
> 
> 标签：c#, winforms, listview

要将项目添加到我正在使用的`listView`控件 ( ) 中的第 1 列，这可以正常工作，但是如何将项目添加到第 2 列和第 3 列等？`Winform``listView1.Items.Add`

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-01-23T15:08:14.293

有几种方法可以做到这一点，但这里有一种解决方案（4 列）。

```
string[] row1 = { "s1", "s2", "s3" };
listView1.Items.Add("Column1Text").SubItems.AddRange(row1); 
```

这里有一个更详细的方式：

```
ListViewItem item1 = new ListViewItem("Something");
item1.SubItems.Add("SubItem1a");
item1.SubItems.Add("SubItem1b");
item1.SubItems.Add("SubItem1c");

ListViewItem item2 = new ListViewItem("Something2");
item2.SubItems.Add("SubItem2a");
item2.SubItems.Add("SubItem2b");
item2.SubItems.Add("SubItem2c");

ListViewItem item3 = new ListViewItem("Something3");
item3.SubItems.Add("SubItem3a");
item3.SubItems.Add("SubItem3b");
item3.SubItems.Add("SubItem3c");

ListView1.Items.AddRange(new ListViewItem[] {item1,item2,item3}); 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-01-23T15:23:34.667

您可以将[项目](http://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.aspx)/[子项目](http://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.listviewsubitem.aspx)添加到 ListView，例如：

```
ListViewItem item = new ListViewItem(new []{"1","2","3","4"});
listView1.Items.Add(item); 
```

但我怀疑您的问题出在[View Type](http://msdn.microsoft.com/en-us/library/system.windows.forms.view(VS.85).aspx)上。在设计器中将其设置为 Details 或在代码中执行以下操作：

```
listView1.View = View.Details; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-23T15:09:32.073

这是关于 listview 对象和 listviewItem 对象的 msdn 文档。
[http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.aspx)
[http://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.aspx)

我强烈建议您至少花时间浏览一下您在 .net 框架中使用的任何对象的文档。虽然有时文档可能很差，但它仍然是无价的，尤其是当您遇到这样的情况时。

但正如詹姆斯阿特金森所说，这只是将子项目添加到 listviewitem 的问题，如下所示：

```
ListViewItem i = new ListViewItem("column1");
i.SubItems.Add("column2");
i.SubItems.Add("column3"); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-04-04T09:21:15.080

```
 private void MainTimesheetForm_Load(object sender, EventArgs e)
        {
            ListViewItem newList = new ListViewItem("1");
            newList.SubItems.Add("2");
            newList.SubItems.Add(DateTime.Now.ToLongTimeString());
            newList.SubItems.Add("3");
            newList.SubItems.Add("4");
            newList.SubItems.Add("5");
            newList.SubItems.Add("6");
            listViewTimeSheet.Items.Add(newList);

        } 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-10-03T11:04:18.503

对于您的问题，请像这样使用：

```
ListViewItem row = new ListViewItem(); 
row.SubItems.Add(value.ToString()); 
listview1.Items.Add(row); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-05-03T16:42:40.653

我制作的一行代码有效：

```
listView1.Items.Add(new ListViewItem { ImageIndex = 0, Text = randomArray["maintext"], SubItems = { randomArray["columntext2"], randomArray["columntext3"] } }); 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-01-23T15:09:17.270

使用 ListViewSubItem - 请参阅：[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.listviewsubitem.aspx)

# css - CSS中的分层问题

> ID：473153
> 
> 赞同：2
> 
> 时间：2009-01-23T14:53:48.237
> 
> 标签：css

我正在尝试使用一些元素分层`z-index`，但它根本不起作用。

这是CSS：

```
 ul.ui-tabs-nav {list-style:none; float:left; display:block;padding:0; margin:6px 0px 0px 0px; width:85px;  }
    ul.ui-tabs-nav li {padding:0px 7px; height:64px; background:url(/templates/gspm_home/images/tab_bak.gif) top left no-repeat;}
    ul.ui-tabs-nav li.ui-tabs-selected {z-index:100; display:block; background:url(/templates/gspm_home/images/tab_bak_current.gif) top left no-repeat; overflow:visible;  }
.ui-tabs-panel { z-index:1; width:360px; height:256px; padding:0;background:#fff; float:right; margin-top:6px;} 
```

调用该类时`ui-tabs-selected`，应该有一个背景图像，该图层位于`ui-tabs-panel`. 但什么也没有发生。

这是html标记：

```
<ul class="ui-tabs-nav">
    <li class=""> <a href="#1" class="blue">
    Link</a></li>
    <li class="ui-tabs-selected"> <a href="#2" class="blue">Link</a></li>
    <li class=""> <a href="#3" class="blue"></a></li>
    <li class=""> <a href="#4" class="blue">Link</a></li></ul>

                <div style="" class="leading ui-tabs-panel ui-tabs-hide" id="1">
                Content
                </div>
                <div style="" class="leading ui-tabs-panel" id="2">
                Content
                </div>  
                <div style="" class="leading ui-tabs-panel ui-tabs-hide" id="3">
                Content
                        </div>
                <div style="" class="leading ui-tabs-panel ui-tabs-hide" id="4">
                Content
                </div> 
```

我错过了什么？

[www.gspm.org](http://www.gspm.org/) - 网站正在建设中。有问题的部分是旋转标签。使用 jQuery UI 选项卡插件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T15:25:06.910

你需要使用：

```
ul.ui-tabs-nav
{
    list-style:none;
    padding:0;
    margin:6px 0px 0px 0px;
    width:85px;
    position: absolute;
    z-index: 100;
} 

ul.ui-tabs-nav li.ui-tabs-selected
{
    display:block;
    background: url(/templates/gspm_home/images/tab_bak_current.gif) top left no-repeat; 
    width: 100px
} 
```

除非元素具有绝对位置或相对 iirc，否则 z-index 不会生效。`overflow: visible;`您还需要在选定的 li 上设置宽度 - 即使使用（您现在可以删除）背景图像也不会“逃逸” 。

这在 FireBug 中对我有用 - 希望当你将它放入代码时它会起作用。

# asp.net - 子文件夹受根 web.config 的影响

> ID：473156
> 
> 赞同：1
> 
> 时间：2009-01-23T14:55:08.140
> 
> 标签：asp.net, web-config, virtual-directory

这应该是一个简单的问题，

我正在 IIS 下构建一个站点，其中一部分位于**像 \blog 这样的子目录**中， 我将其转换为一个**虚拟目录**。

根文件夹有自己的 web.config，博客子文件夹有自己的 .

在**根的 web.config**我使用：

```
<pages theme="DefaultTheme"> 
```

并且子文件夹似乎受此影响，它会导致错误提示我没有这个主题。

解决办法是什么 ？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T15:19:39.603

查看：

```
<location> ... </location> 
```

可以加载到 web.config 中的元素。并非所有内容都可以在它下运行，但是您可以覆盖子文件夹以使其没有主题。或者您可以将主题限制为仅具有这些标签的顶级文件夹？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T15:22:34.153

Web.Config 可以嵌套，因此 pages 元素将影响范围内它下面的所有其他应用程序（例如，有一个 web.config 在框架的 config 文件夹中设置各种默认值）。

如果您不希望博客文件夹中页面上的主题，您是否尝试在子 web.config 中将主题设置为空字符串？这是属性的有效值，应该覆盖父级中的设置。

主题通过查看应用程序根目录下的 Themes 文件夹来工作 - 在这种情况下，在 /blogs 文件夹下，如果在其中找不到，它将抛出此异常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T15:28:28.057

你想添加

```
<clear/> 
```

到子文件夹的 web.config。这将从您放置的任何部分清除父配置值`clear into`。例如，如果您想从父配置文件中清除任何连接字符串，您可以这样做：

```
<connectionStrings>
    <clear/>
    <!-- add new connection strings here -->
</connectionStrings> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T15:00:43.310

除了将两个应用程序移动到子文件夹并确保父文件夹没有 Web.config 之外，我无法找到解决方案。

# vb.net - 部分类、LINQ、接口和 VB.NET

> ID：473160
> 
> 赞同：5
> 
> 时间：2009-01-23T14:55:33.523
> 
> 标签：vb.net, interface

好的，我遇到了 VB.NET 的问题。那么所有那些 VB.NET 的捍卫者，你能帮帮我吗？这是我的问题：我正在使用 LINQ to Entities，它也适用于 LINQ to SQL，我构建了我的 edmx 文件，然后创建了一个与实体之一同名的部分公共类到目前为止一切都很好，所以来了问题。

我需要 Partial 类来实现一个 Interface Implements Interfaces.IAsset 但是 VB.NET 想要将“Implements Interfaces.IAsset.ID”放在属性的末尾，这当然是在 Partial 类的生成代码部分中，它我不能这样做，因为 edmx 文件是自动生成的，并且将来会更改。

这是需要排序的代码行：

公共属性 ID1() 作为整数实现 Interfaces.IAsset.ID

在 C# 中它很好并且可以创造奇迹。那么为什么 VB.NET 不能实现代码生成类中的接口呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T15:21:31.520

部分类中的一点间接应该可以解决问题......

```
Public Property AssetId() As Int32 Implements IAsset.AssetId
    Get
        Return Id1
    End Get
    Set(ByVal value As Int32)
        Id1 = value
    End Set
End Property 
```

实现接口的属性调用 dbml 生成的实际属性。该类本质上将有两个 id 属性，这不是很优雅，但是当通过接口访问时，您将不知道其中的区别。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T15:09:06.567

没有办法解决这个问题。这是 VB 如何强制您处理接口实现的一个缺陷。

您可以为 C# 中的 LINQ to Entities 创建一个单独的库。我不确定您是否可以将部分类放在单独的项目中并将基础知识保留在 VB 中。我从来没有尝试过。

# serialization - Java ME 对象持久性

> ID：473163
> 
> 赞同：2
> 
> 时间：2009-01-23T14:57:07.607
> 
> 标签：serialization, java-me, persistence, midp, rms

我知道Java微版中没有序列化（Serializable）。使用 RMS 保存诸如 int 和 java.lang.String 对象之类的原语有点直接。但是，如果我想保存（使持久）任意对象？那可能吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T15:17:36.253

您可以使用连接 API 将数据写入文件/流。请记住，将数据持久化到 Stream 中很容易，但是为了从 Stream 中恢复数据，您必须编写自己的代码。通常反射用于此目的，它成为许多设备的瓶颈。

因此，我建议不要重新发明轮子，而是使用 Floggy（[http://floggy.sourceforge.net/](http://floggy.sourceforge.net/)）。Floggy 是用于 J2ME/MIDP 应用程序的免费对象持久性框架。该框架的主要目标是从开发人员那里抽象出数据持久性细节，从而减少开发和维护工作。[您可以在http://floggy.sourceforge.net/getting-started.html#framework](http://floggy.sourceforge.net/getting-started.html#framework)查看示例

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:17:32.540

不幸的是，如果不为其编写代码，就无法保存任意对象，因为反射在 J2ME 中受到严重限制（您可以查找类，但不能查找它们的字段和方法）。

# c# - 使用 LINQ to SQL 是否有助于防止 SQL 注入

> ID：473173
> 
> 赞同：58
> 
> 时间：2009-01-23T14:59:22.813
> 
> 标签：c#, asp.net, linq, linq-to-sql

我正在建立一个公共站点，我首先想到的是 SQL 注入。我有一些要保存的文本字段，并且正在使用 linq 更新/写入数据库。我使用 linq 安全吗？

此示例是创建用户帐户。

```
Data.MemberRegistrationDataContext context = new MemberRegistrationDataContext();
Data.tbl_Member_UserProfile profile = new tbl_Member_UserProfile();
profile.SSN = Convert.ToDecimal(Session["tempMemberSSN_Registration"]);
profile.UserName = userName;
profile.Password = password;
profile.EmailAddress = email;
profile.QuestionID = qID;
profile.QuestionResponse = securityAnswer;
profile.LastModDt = DateTime.Now;
profile.LastModBy = "web";
context.tbl_Member_UserProfiles.InsertOnSubmit(profile);
context.SubmitChanges(); 
```

此示例正在更改密码

```
 MemberRegistrationDataContext dc = new MemberRegistrationDataContext();
   var mProfileRecord = dc.tbl_Member_UserProfiles.Single(c => c.SSN == sSSN);
   mProfileRecord.Password = sNewPassword;
   dc.SubmitChanges(); 
```

这些安全吗？LINQ 是否参数化它自动生成的 SQL？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-01-23T15:00:54.820

是的，LINQ 将有助于阻止 SQL 注入。

> LINQ to SQL 通过 SQL 参数将所有数据传递到数据库。因此，尽管 SQL 查询是动态组合的，但值是通过参数替换服务器端的，以防止 SQL 注入攻击的最常见原因。

此外，请参阅[使用 LINQ 轻松消除 SQL 注入攻击以](http://www.devx.com/dotnet/Article/34653) 获取一些信息。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-23T15:01:32.213

你可以走了。Linq 确实参数化了它发送到数据库的数据。

使用 Log 属性检查发生了什么：`dc.Log = Console.Out;`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T15:02:03.900

应该是因为发出的 SQL 使用了命名参数，这些参数不能被利用来执行任意 SQL。

# javascript - Javascript局部变量技术

> ID：473181
> 
> 赞同：2
> 
> 时间：2009-01-23T15:00:39.267
> 
> 标签：javascript, variables, local

我有一个与单行编程有关的简单问题。先举个例子：

```
function test(a)
{
   var b=a.toString();
   return b.replace("a","b");
} 
```

这很简单（这个函数当然没用），但这里的问题稍微复杂一点：如果我要在一行中完成这个怎么办？我有我的想法，但请告诉我这在内存清理方面是否正常工作：

```
function test(a)
{
   return (arguments[1]=a.toString()).doSomething().doSomethingMore(arguments[1]);
} 
```

这当然是一个例子，但想法很简单：使用参数作为局部变量的容器 - 我不确定，但据我所知，当函数结束时，参数也会被删除吗？还是在参数中创建新元素会使该元素全局定义？从我的测试来看，我似乎是正确的，但我很好奇是否有人尝试过这个？这是一个安全和干净的解决方案吗？:) 感谢您的任何评论。

这是一个更实际的单行脚本问题：

```
function (number,limiter)
{
return ((arguments[2] = number.toString().replace(
         new RegExp("(\\d+)(\\d{3})($|"+limiter+")"),
         '$1'+limiter+'$2$3')) == number) ?
            arguments[2] : 
            arguments.callee(arguments[2],limiter);
} 
```

这一行函数使用给定的字符串执行操作并将其返回或递归解析到相同的函数。（在其他线程上，我展示了如何在没有递归的情况下完成此操作，但这不是问题的情况）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T15:12:46.107

您不必要地使操作复杂化。你根本不需要声明任何东西。

```
function test(a) {
return a.toString().replace("a","b");
} 
```

这不应该对性能或内存造成影响。

但是，如果您要使用闭包，则可能会遇到内存问题。

像你正在做的那样为参数数组赋值是没有意义的，因为每个函数都有自己的参数数组。为了解决您关于范围的问题，Javascript 范围是词法的；函数内本地声明的东西不能自动被函数外的东西访问。

编辑：使用参数数组并不比任何其他方法更干净或更好。这实际上比清楚更糟糕。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T15:21:44.937

您的示例可能使简单操作过于复杂，但您演示的技术称为方法“链接”。这是一种完全有效的形式，实际上可用于在不需要中间结果或没有意义时使代码更具可读性。

我目前最喜欢的例子是美妙的[DateJs](http://www.datejs.com/)：

```
var nextTuesday = DateJs.today().next().tuesday();

var aBitLater = DateJs.now().addHours(1).addMinutes(30); 
```

当然，它是语法糖，可以更冗长地写成单独的语句，但是通过仔细的方法命名，您实际上可以使它读起来像英语。

GC / 内存管理不受这种风格的影响，函数的参数和其他的一样被清理。事实上，它实际上可能更安全，因为参数在函数调用返回后立即超出范围，并且不需要为值创建本地变量只是为了将它们传递给下一个函数调用。

你的例子可能有点做作，但如果你在有意义的地方使用它，这是一个有用的模式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T15:13:45.263

“首先，调试的难度是编写代码的两倍。因此，如果你尽可能巧妙地编写代码，那么根据定义，你就不够聪明，无法调试它。” ——布赖恩·W·克尼根

我不是在敲你，我只是说要小心不要过分热心。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T15:08:48.393

我认为您只需要尝试阅读它就会意识到这不是一个“干净”的解决方案！我会特别避免链接这样的作业：

```
return (arguments[1]=a.toString()).doSomething().doSomethingMore(arguments[1]);
// is this a or a.toString()? it's not clear at a glance -------------^ 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T15:12:22.333

为什么要避免在本地创建变量？这样做会使代码更容易阅读/理解，而且我认为你并没有真正获得任何东西。

这些变量基本上只是对您正在创建的对象的引用。无论您将它们分配给普通变量还是将它们放入数组中，清理都将是相同的。一旦方法返回，参数数组和局部变量都将超出范围，因此我认为您不会看到任何行为差异。（如果该方法是通过 apply() 命令调用的，则参数数组的范围*可能会*有所不同，但我尚未对此进行测试以确定）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T15:19:25.610

~~颤抖~~

这让我想起了`awk`在函数中没有局部变量的地方，除非您在参数列表中声明额外的变量。

如果你需要一个局部变量，那就去做吧。

# .net - 通过序列化/反序列化维护对象引用

> ID：473182
> 
> 赞同：3
> 
> 时间：2009-01-23T15:00:41.203
> 
> 标签：.net, serialization

序列化时，我只想序列化一个对象一次，然后对该对象的任何引用都应序列化为对该对象的引用。这是因为，当我稍后反序列化对象时，我想维护这些引用。为了说明我的目标，下面的代码应该输出“序列化后：真”。

```
class Program
{
    static void Main(string[] args)
    {
        MyObject obj = new MyObject() { Name = "obj" };
        MyObject[] myObjs = new MyObject[]
        {
            obj, obj
        };

        Console.WriteLine("Object Refs Equal?");
        Console.WriteLine(string.Format("Before Serialization: {0}",
            object.ReferenceEquals(myObjs[0], myObjs[1])));

        XmlSerializer toXml = new XmlSerializer(typeof(MyObject[]));
        using (FileStream toFile = File.Create(@"C:\foo.xml"))
        {
            toXml.Serialize(toFile, myObjs);
        }

        XmlSerializer fromXml = new XmlSerializer(typeof(MyObject[]));
        using (FileStream fromFile = File.OpenRead(@"C:\foo.xml"))
        {
            MyObject[] deserialized = (MyObject[])fromXml.Deserialize(fromFile);

            Console.WriteLine(string.Format("After Serialization: {0}",
            object.ReferenceEquals(deserialized[0], deserialized[1])));
        }

        Console.ReadLine();
    }
}

[Serializable]
public class MyObject
{
    public string Name { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T15:09:43.073

如果您使用的是 .NET 3 或更高版本，则应使用`DataContractSerializer`and 设置`PreserveObjectReferences`为`true`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:04:46.110

您必须通过提供对象标识符而不是对象引用来做到这一点。

对象的引用本质上是它的指针。由于您不能直接在安全代码中操作指针，因此必须为对象指定其他唯一名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:09:11.623

不确定这是否是您想听到的……但是让我们想想您要做什么。

您只需要在以下情况下序列化一个对象：a）您想将它存储在某个地方，然后检索信息。b) 您想将对象发送到另一个应用程序。

引用只不过是指向对象所在位置的指针。因此，在任何一种情况下，您都无法访问内存，因为在 a) 它是为您的应用程序保留的，而在 b) 它是另一台机器，甚至不存在。

[http://en.csharp-online.net/Glossary:Definition_-_Reference_type](http://en.csharp-online.net/Glossary:Definition_-_Reference_type)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T15:21:26.777

您的代码示例将无法正常工作，因为 XmlSerializer 不保存参考信息，在序列化过程中，它只会将 obj 的数据写入流两次，这意味着当您反序列化时，它将读取 obj 的数据作为两个不同的实例，它无法知道它们在序列化时引用了同一个实例。使用前面提到的 DataContractSerializer 应该可以满足您的需求，但请注意它使用非标准 xml（请参阅：http: [//msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)）

# c# - 输出参数

> ID：473188
> 
> 赞同：2
> 
> 时间：2009-01-23T15:01:51.887
> 
> 标签：c#, sql-server

如何从一个表的存储过程中获取输出参数并使用该值如何在与该表相关的另一个表中插入数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:11:22.007

创建 SqlParameter 对象时，将 Output 分配给它的 Direction 属性。然后在执行查询后，将参数的值转换为 C# 变量并随意使用它：

```
SqlParameter newId = new SqlParameter();
newId.Direction = ParameterDirection.Output;
SqlCommand cmd = new SqlCommand();
// ... build your cmd...and add your other parameters as required
cmd.Parameters.Add(newId);
cmd.ExecuteNonQuery();
int outValue = (int)newId.Value; 
```

然后使用`outValue`将其传递给您的下一个 SQL 查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:05:23.860

输出参数只是一个值，我不确定我是否理解您的问题。您是在谈论 SQL Server 2008 表值参数吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:06:25.527

在你第一次插入后，你会想要这样的东西：

```
SELECT @parameter_goes_here = SCOPE_IDENTITY() 
```

这将为您提供刚刚输入的行的身份。然后只需将该值用作下一次插入中的参数。

如果你需要一个完整的例子......让我知道

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T15:09:50.810

你可以使用这样的东西：

```
CREATE PROCEDURE dbo.InsertNewImage
 @ImageTitle nvarchar(30),
 @ImageDescription nvarchar(100),
 @ImageFilename nvarchar(50),
 @ImageThumbnail image,
 @AlbumID int
AS
 Begin

  Set Nocount On

  DECLARE @ImageID int

  INSERT INTO Images(ImageTitle, ImageDescription, ImageFilename, ImageThumbnail)
  VALUES (@ImageTitle, @ImageDescription, @ImageFilename, @ImageThumbnail)

  SELECT @ImageID=@@IDENTITY

  INSERT INTO ImageInAlbum(ImageId, AlbumId)
  VALUES (@ImageID, @AlbumID)

 End 
```

注意：如果您使用的是 SQL Server 2005 +（我认为），请使用 SCOPE_IDENTITY() 而不是 @@IDENTITY

# installation - 为什么默认使用“C:\Program Files”。如果我们更改它，是否会出现任何违规或性能下降？

> ID：473191
> 
> 赞同：2
> 
> 时间：2009-01-23T15:03:40.137
> 
> 标签：installation

为什么微软推荐“C:\Program Files”作为默认安装目的地？有什么具体原因吗？如果我更改位置，是否会影响系统和应用程序的性能？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T15:08:15.320

由于它是默认设置，Windows 中的很多东西只是假设它是这样的。

这不是性能问题，但用户更改它可能会意外破坏事情。测试一下可能是件好事。

您绝对应该在程序中引用 %ProgramFiles% 环境变量，而不是硬编码的路径。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T15:07:28.177

它使计算机管理更容易。

*   支持人员确切地知道应用程序的位置。
*   通过将很少更改的应用程序（“C:\program Files”）与快速更改的用户数据（“C:\Documents and Settings”）分开，可以实现更有效的备份策略。
*   它允许将 C:\Program Files 目录树设置为“所有人可读；管理员可写”，以防止病毒安装和意外删除。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T15:12:16.250

这是确保程序与操作系统的应用程序和安全模型之间正确互操作的约定。如果您正在编写典型的应用程序软件，我强烈建议您不要在这里违反约定。作为管理员，尝试安装在其他地方的应用程序应该在各处发出危险信号。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T15:18:49.403

没有特殊原因需要安装在任何特定文件夹中（除了一些您不能安装的例外情况）。

但是，请仔细考虑为什么要问这个问题。如果你想硬编码你的路径，那就是懒惰，你可能会被它烫伤。确保您的程序可以处理安装在用户选择的文件夹中。如果您在 C:\BuggyProgram\ 中硬编码并且您的用户想要将您安装在他的 J: 驱动器中怎么办？那你就完蛋了。

简而言之，一个编写良好的程序并不真正关心它的安装位置。采取这种方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T15:28:42.830

不要忘记，在 Vista 中，他们还在 Program Files 文件夹本身上增加了一点安全性，这样流氓程序就不会弄乱同一通用目录区域中的其他程序。如果您尝试遵循 Microsoft 约定，他们现在会要求您将所有“通用”应用程序数据放在 C:\ProgramData 文件夹中，这样可以为应用程序提供更多控制权。

此外，您还可以使用[CSIDL](http://msdn.microsoft.com/en-us/library/bb762494.aspx)定义您的程序数据和程序文件文件夹，以便无论是 XP 还是 Vista（其中某些文件夹已更改）都可以正确引用它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T15:05:54.077

“C:\Program Files”只是一个约定，尽管拥有所有程序文件所在的单个目录确实很方便。该目录也可以对笨拙的临时用户隐藏，否则他们可能会无意中删除程序文件。但是，话虽如此，您可以在任何可以写入的地方安装应用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-23T15:08:02.327

这是大多数用户和管理员希望找到安装应用程序的位置。这实际上更像是一种约定。我建议这是一个合理的默认值，但如果用户愿意，您可以允许用户在安装过程中更改位置。在任何情况下，如果可能的话（通常情况下），您应该编写您的应用程序以在不依赖固定安装目录的情况下工作。除非它恰好位于速度较慢或访问次数较多的驱动器上，否则您不应看到与其他安装位置的任何性能差异。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T15:07:17.883

要考虑的另一件事是，通常在企业中，机器上设置了安全性，因此典型用户只能安装到 C:\Program Files 目录。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T17:00:51.913

“C:\Program Files”实际上只是*英文版*Windows 的默认设置。在德语版本中，它被称为“C:\Programme”，所以永远不要依赖这个文件夹是否存在或它的名字是什么这一事实。始终使用`%ProgramFiles%`.

我还假设引入该名称是为了让更多程序正确处理空格（以及路径中的其他奇怪字符）:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-26T03:45:36.623

在 Windows 中一切皆有可能。

1.  打开`Regedit`
2.  `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion`
3.  在右侧窗口中，双击该键`ProgramFilesDir`并对其进行修改以包含新路径。

# wpf - 为什么在 XAML XmlDataProvider 中我们必须说“x:Key”而不是“Key”？

> ID：473195
> 
> 赞同：1
> 
> 时间：2009-01-23T15:05:22.083
> 
> 标签：wpf, xaml

这里命名空间的作用是什么？

我认为在这个简单的示例中，我可以使用“Key”和“XData”而不是“x:Key”和“x:XData”，但是当我这样做时，它说在 XmlDataProvider 中找不到“Key”。

```
<Window x:Class="DataBindingWPF.XmlBinding"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="DataBindingWPF" Height="300" Width="300"
    >
    <StackPanel>
        <StackPanel.Resources>
            <XmlDataProvider x:Key="Colors" Source="Colors.xml"  XPath="/colors"></XmlDataProvider>
            <XmlDataProvider x:Key="MoreColors" XPath="/colors">
                <x:XData>
... 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T15:53:52.670

“Key”属性不是 XmlDataProvider 的实际属性。它是一个 Xaml 属性，位于以“x”为前缀的“ [http://schemas.microsoft.com/winfx/2006/xaml](http://schemas.microsoft.com/winfx/2006/xaml) ”命名空间中。

StackPanel.Resources 是一个资源字典。为了向字典中添加内容，您需要一个键/值对。Key 属性是资源的键，XmlDataProvider 是值。这是 WPF 用来唯一标识资源的机制。

您可以将 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 更改为 xmlns:ns="http://schemas.microsoft.com/winfx/2006/xaml" 然后你会将其称为“ns:Key”而不是“x:Key”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:20:46.810

您是否也从 :x 中删除了

```
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
```

所以它读

```
xmlns="http://schemas.microsoft.com/winfx/2006/xaml" 
```

# oracle - 在 Linux 和 Windows 上引用 oracle sql 文件中的环境变量

> ID：473201
> 
> 赞同：3
> 
> 时间：2009-01-23T15:06:40.660
> 
> 标签：oracle

我们有一个带有 oracle 10.2 的 sql 构建脚本。在脚本的末尾，我们有这个：

```
@$ORACLE_HOME/rdbms/admin/utlrp.sql 
```

它适用于 Linux，但不适用于 Windows。所以我们用这一行创建了第二个文件：

```
@%ORACLE_HOME%/rdbms/admin/utlrp.sql 
```

肯定有更好的方法。如何以跨平台的方式引用环境变量？或者，是否可以在 sql 文件中进行操作系统检测以使用 IF 子句保护每个语句？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T16:17:13.683

我相信这种语法是您所需要的：

@?/rdbms/admin/utlrp.sql

但是，这仅适用于 ORACLE_HOME 变量。我不知道别人...

编辑：

这有点尴尬，但您也可以考虑设置 SQLPATH 环境变量。它适用于 oracle 中的 SQL 脚本，因为 PATH 适用于 Unix/Windows 中的可执行文件。

# .net - 在 .Net DataSets 上使用列名或列索引会更好吗？

> ID：473205
> 
> 赞同：7
> 
> 时间：2009-01-23T15:07:40.610
> 
> 标签：.net, dataset, obfuscation, datarow

从 DataRow 检索值时，使用列名还是列索引更好？

列名更具可读性和更易于维护：

```
int price = (int)dr["Price"]; 
```

虽然列索引更快（我认为）：

```
int price = (int)dr[3]; 
```

如果您决定混淆数据库，使用列名会中断吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-23T15:10:04.630

我通常更喜欢可读性和理解而不是速度。随名而去。如果您决定更改数据库列名，您可以（应该）使用可以在一处更新的字符串常量。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-23T15:18:47.343

通过列名访问列/行值更利于人类阅读和向前兼容性（如果将来有人更改顺序或列数）。

通过列索引访问列/行值对性能更好。

所以，如果你想改变一个/两个/.....行中的一些值，列名是可以的。但是，如果您想更改数千行中的某个值，则应使用从列名计算的列索引：

```
int ndxMyColumn = table.Columns.IndexOf( "MyColumn" );
foreach(DataRow record in table.Rows ) {
    record[ndxMyColumn] = 15;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-01-13T15:23:22.017

与他人完全侵略。追求可读性和可维护性而不是速度。然而，我有一个通用方法需要将命名列作为参数传入，因此计算列索引是什么是有意义的。

在下面的基准测试中，使用列索引显示了很大的改进，因此如果这是代码的瓶颈区域或性能关键部分，那么它可能是值得的。

下面代码的输出是：

515ms 与 ColumnIndex

1031ms 与 ColumnName

```
 static void Main(string[] args)
    {            
        DataTable dt = GetDataTable(10000, 500);
        string[] columnNames = GetColumnNames(dt);

        DateTime start = DateTime.Now;
        TestPerformance(dt, columnNames, true);

        TimeSpan ts = DateTime.Now.Subtract(start);
        Console.Write("{0}ms with ColumnIndex\r\n", ts.TotalMilliseconds);

        start = DateTime.Now;
        TestPerformance(dt, columnNames, false);
        ts = DateTime.Now.Subtract(start);
        Console.Write("{0}ms with ColumnName\r\n", ts.TotalMilliseconds);
    }

    private static DataTable GetDataTable(int rows, int columns)
    {
        DataTable dt = new DataTable();

        for (int j = 0; j < columns; j++)
        {
            dt.Columns.Add("Column" + j.ToString(), typeof(Double));
        }

        Random random = new Random(DateTime.Now.Millisecond);
        for (int i = 0; i < rows; i++)
        {
            object[] rowValues = new object[columns];

            for (int j = 0; j < columns; j++)
            {
                rowValues[j] = random.NextDouble();
            }

            dt.Rows.Add(rowValues);
        }

        return dt;
    }

    private static void TestPerformance(DataTable dt, string[] columnNames, bool useIndex)
    {
        object obj;
        DataRow row;

        for (int i =0; i < dt.Rows.Count; i++)
        {
            row = dt.Rows[i];

            for(int j = 0; j < dt.Columns.Count; j++)
            {
                if (useIndex)
                    obj = row[j];
                else
                    obj = row[columnNames[j]];
            }
        }
    }

    private static string[] GetColumnNames(DataTable dt)
    {
        string[] columnNames = new string[dt.Columns.Count];

        for (int j = 0; j < columnNames.Length; j++)
        {
            columnNames[j] = dt.Columns[j].ColumnName;
        }

        return columnNames;
    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-23T15:08:53.807

我认为列名是最好的方法。更容易确定您要提取的内容，并且列顺序由 select 语句确定，该语句可能会在以后的某个时间更改。您可能会争辩说列名也可能会改变，但我认为这不太可能。

编辑：

实际上，如果您真的一心使用列索引，您可以创建列索引的常量并将该常量命名为列的名称。所以：

```
PRIMARY_KEY_COLUMN_NAME_INDEX = 0 
```

这至少可以使它具有可读性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T15:14:47.400

这取决于你需要什么。在我的例子中，我遇到了速度是最重要的情况，因为我正在对 DataSet 中的数千行执行密集处理，因此我选择编写一段按名称缓存列索引的代码。然后，在循环代码中我使用了缓存的索引。与直接使用列名相比，这提供了合理的性能提升。

当然，您的里程可能会有所不同。我的情况是一个相当做作和不寻常的情况，但在那种情况下它运作得相当好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-23T15:26:55.423

我的观点是，只有在分析代码并将其显示为瓶颈时，才应该切换到索引。我不认为这会发生。

命名东西很好，它使我们有限的大脑理解问题并更容易建立链接。这就是为什么我们被命名为 Fred、Martin、Jamie，而不是 Human[189333847]、Human[138924342] 和 Human[239333546]。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-23T15:10:11.370

如果您确实决定将来通过更改列名来混淆数据库，则可以在查询中为这些列设置别名以保持索引器代码的功能。我建议按名称索引。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-23T15:11:14.067

使用名称，您会收到更好的错误消息:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-23T15:27:18.590

我选择字符串是为了便于阅读和维护。我使用字符串常量来定义列名的值。前任：

```
public class ExampleDataColumns
{
    public const string ID = "example_id";
    public const string Name = "example_name";
    ....    
} 
```

然后我可以像这样稍后引用它：

```
row[ExampleDataColumns.ID] 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-23T15:32:40.530

为 DataRow 使用列名的原因与 RDBMS 不会通过要求程序员在 SQL 中指定列索引来提高速度的原因相同。但是您也许可以在发出 SELECT 语句时模仿 RDBMS 的操作方式，在 RDBMS 引擎内部，它会在遍历行之前查询 SELECT 子句中指定的列的列索引/偏移量，因此它可以更快地运行。

如果您真的想提高速度，**请不要**使用 const/enum 方式（数据库或 ORM 层上的列顺序可能会更改）。按照 TcKs 的建议进行操作（在实际循环之前）：

```
int ndxMyColumn = table.Columns.IndexOf( "MyColumn" );
foreach(DataRow record in table.Rows ) {
    record[ndxMyColumn] = 15;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T15:16:26.023

对我来说，我正在使用反射（不确定这是命名我所做工作的正确方法）从表中获取 columnnameColumn

没有“硬编码”更好

```
 int price = (int)dr[DatableVar.PriceColumn]; 
```

# c# - 如何实现 ASP.Net MVC 交互式过滤

> ID：473216
> 
> 赞同：1
> 
> 时间：2009-01-23T15:09:13.463
> 
> 标签：c#, asp.net-mvc, asp.net-ajax

这是我想要的结果：

给定一个 ASP.net MVC 页面，该页面在顶部有一个块，其中有几个参数用于过滤下面显示的列表，例如...

```
文本框 1 单选按钮 1   
TextBox2 OtherOptions Here

物品
物品
物品

```

我希望过滤在以后的迭代中具有交互能力，或者如果它相对容易的话，可以立即进行。

关于方法的任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T10:53:43.487

[这个 jQuery 插件](http://trirand.com/jqgrid/jqgrid.html)可以帮助你。打开“jqGrid Examples” -> “Advanced” -> “Search Big Sets” 进行过滤和搜索示例。还有很多其他的样本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T18:32:13.460

查看站点的用户和标签部分下使用的 StackOverflow 方法。当您在文本框中键入进行搜索时，它会在您键入时过滤列表。将其他选项（例如单选按钮等）添加到过滤器中将非常简单……

通过利用事件侦听器和它所具有的 ajax 功能，您可以使用 jquery 相对轻松地做到这一点。

# sql - 优化多列 LIKE SQL 查询的一些最佳实践是什么？

> ID：473218
> 
> 赞同：2
> 
> 时间：2009-01-23T15:09:26.677
> 
> 标签：sql, search, optimization, sql-like

我有一个正在继承并尝试优化的搜索查询。我很想知道是否有人对此有任何最佳实践和建议。生产服务器仍然是 SQL Server 2000。

该查询是一个高级客户搜索存储过程，它接受 5 个不同的搜索条件参数（即名字、姓氏、地址、电话等）来搜索数百万条记录表。WHERE 子句中的所有连接列和列都有索引。此外，初始查询将记录转储到表变量中以获取分页容量。

```
INSERT INTO   @tempCustTable (CustomerID, FirstName, LastName, City, StateProvince, Zip, PhoneNumber)
SELECT  DISTINCT cu.CustomerID, cu.FirstName, cu.LastName, a.City,
a.StateProvince, a.Zip, p.PhoneNumber
FROM Customer cu WITH(NOLOCK)
LEFT OUTER JOIN Address a WITH(NOLOCK) ON cu.CustomerID = a.CustomerID
LEFT OUTER JOIN Phone p WITH(NOLOCK) ON cu.CustomerID = p.CustomerID
WHERE  (cu.LastName = @LastName OR cu.LastName LIKE @LastName + '%') 
AND (@FirstName IS NULL OR cu.FirstName = @FirstName OR cu.FirstName LIKE @FirstName + '%')
AND (@StateProvince = '' OR a.StateProvince LIKE @StateProvince)
AND (@City = '' OR a.City LIKE @City + '%')
AND (@Zip = '' OR a.Zip = @Zip OR a.Zip LIKE @Zip + '%')
ORDER BY cu.LastName, cu.FirstName 
```

有人对如何提高查询性能有任何建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T15:15:46.803

这不是整条线吗

```
AND (@Zip = '' OR a.Zip = @Zip OR a.Zip LIKE @Zip + '%') 
```

和这个一样

```
AND (a.Zip LIKE @Zip + '%') 
```

当然

```
AND (a.Zip LIKE @Zip + '%') 
```

它与

```
a.Zip = @Zip OR a.Zip LIKE @Zip + '%' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T18:37:48.033

正如 SQLMenace 指出的那样，您绝对可以清理代码中的大量冗余。

另一件事是，ORDER BY 不应该与 INSERT..SELECT 一起使用。ORDER BY 在这种情况下是没有意义的。人们偶尔会使用它来强制 IDENTITY 列以某种方式运行，但这是 IMO 的一个坏习惯。

我不知道这是否对您的情况有所帮助，但我最近遇到的一件事是在存储过程中 SQL Server（我使用的是 2005，但可能也适用于 2000）不会短路 OR很多情况下的情况。例如，当您使用：

```
@my_parameter IS NULL OR my_column = @my_parameter 
```

即使您为@my_parameter 传入NULL 值，它仍会评估下半部分。即使我将存储过程设置为重新编译（和 SELECT），也会发生这种情况。诀窍是通过使用 CASE 语句来强制短路。使用该技巧（并消除一些冗余）您的语句将如下所示：

```
INSERT INTO @tempCustTable
(
     CustomerID,
     FirstName,
     LastName,
     City,
     StateProvince,
     Zip,
     PhoneNumber
)
SELECT DISTINCT
     cu.CustomerID,
     cu.FirstName,
     cu.LastName,
     a.City,
     a.StateProvince,
     a.Zip,
     p.PhoneNumber
FROM Customer cu WITH(NOLOCK)
LEFT OUTER JOIN Address a WITH(NOLOCK) ON cu.CustomerID = a.CustomerID
LEFT OUTER JOIN Phone p WITH(NOLOCK) ON cu.CustomerID = p.CustomerID
WHERE
     (cu.LastName LIKE @LastName + '%') AND
     (1 =
          CASE
               WHEN @FirstName IS NULL THEN 1
               WHEN cu.FirstName LIKE @FirstName + '%' THEN 1
               ELSE 0
          END
     ) AND
     (1 =
          CASE
               WHEN @StateProvince = '' THEN 1
               WHEN a.StateProvince = @StateProvince THEN 1
               ELSE 0
          END
     ) AND
     (1 = CASE
               WHEN @City = '' THEN 1
               WHEN a.City LIKE @City + '%' THEN 1
               ELSE 0
          END
     ) AND
     (1 = CASE
               WHEN @Zip = '' THEN 1
               WHEN a.Zip LIKE @Zip + '%' THEN 1
               ELSE 0
          END
     ) 
```

它使查询更长，并且可能更复杂一些，但为了更好的性能，它可能是值得的。如果您的条件包括可能会短路的子查询，则**尤其如此。**

最后...与您的参数**保持一致。**对于 @FirstName，您检查 NULL 值以确定它是否被使用，但对于其他人，您正在检查空字符串。此处需要注意的基本编码 101。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T15:10:41.540

*   避免使用“OR”——它们通常会阻止使用索引
*   切勿在左侧放置“%”。- 同样的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T15:20:16.263

我会尝试不让我的 sql 代码添加“%”，而是希望参数已经拥有它，这当然是在您在应用程序中验证它之后！然后不要包括 '=' 比较，一直使用 LIKE ：

WHERE (cu.LastName LIKE @LastName)

代替：

WHERE（cu.LastName = @LastName 或 cu.LastName LIKE @LastName + '%'）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T15:37:23.327

您可以使用动态 sql 构建查询。这将摆脱您的大部分 OR，也意味着您只需要在 WHERE 语句行中包含用户实际输入的参数。

如果您这样做，请务必使用 sp_executesql 而不是 exec，以便您可以参数化动态 sql，以便可以缓存查询计划。

# flash - 使用动态数据为网站使用 Flash 进行 3d 绘图/空间

> ID：473234
> 
> 赞同：2
> 
> 时间：2009-01-23T15:10:51.370
> 
> 标签：flash, charts, graph

为具有图形的某些特征但更专业的网站寻找 Flash 组件。

我希望能够在一个区域中绘制点，并让用户能够放大、缩小和四处移动。

只要用户可以移动图表并放大和缩小，一个 3d 折线图可以让我关闭绘图线并留下点作为止损是可以接受的。

我将从后端数据库生成图形/绘图的数据。

任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T23:29:26.903

我的数学技能几乎不存在，但我在[flashandmath.com](http://www.flashandmath.com/advanced/contours/index.html)网站上看到了一些可能对您有所帮助的东西。

# c++ - 检查 C++ 中的值定义性

> ID：473236
> 
> 赞同：7
> 
> 时间：2009-01-23T15:11:12.197
> 
> 标签：c++, undef

我在 C++ 中工作，我需要知道标量值（例如 a `double`）是否“已定义”。如果需要，我还需要能够“取消定义”它：

```
class Foo {
public:
    double get_bar();

private:
    double bar;
    void calculate_bar() {
        bar = something();
    }
};

double Foo::get_bar() {
    if ( undefined(bar) )
        calculate_bar();
    return bar;
} 
```

在 C++ 中可能吗？

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T15:17:06.770

正如其他答案所说，C++ 没有这个概念。不过，您可以轻松解决它。

您可以在构造函数中将 bar 初始化为未定义的值，通常为 -1.0 或类似的值。

如果您知道 calculate_bar 永远不会返回负值，您可以实现未定义的函数来检查 < 0.0。

一个更通用的解决方案是使用 bool 表示是否定义了 bar，您在构造函数中将其初始化为 false，并且当您第一次设置它时，您将其更改为 true。[boost::optional](http://www.boost.org/doc/libs/1_37_0/libs/optional/doc/html/index.html)以优雅的模板方式完成此操作。

这就是您拥有的代码示例的样子。

```
class Foo {
public:
    double get_bar();
    Foo() : barDefined(false) {}
private:
    double bar;
    bool barDefined;
    void calculate_bar() {
        bar = something();
    }
};

double Foo::get_bar() {
    if ( barDefined == false ) {
        calculate_bar();
        barDefined = true;
    }
    return bar;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T15:18:07.050

正如其他人指出的那样，没有什么比“未定义”状态更重要了。但你可能想看看[boost.optional](http://www.boost.org/doc/libs/1_35_0/libs/optional/doc/html/boost_optional/examples.html#boost_optional.examples.optional_local_variables)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T15:13:31.207

如果您的意思是在运行时，则没有这样的事情。如果`bar`从未初始化，它将具有任何随机位，具体取决于对象的分配方式（某些分配器会将新内存初始化为全零）。

编辑：由程序员在构造函数和/或手动初始化方法中处理对象状态，例如`init()`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T15:14:24.390

C++ 没有原始类型的“未定义”状态。最接近浮点/双精度的是 NAN，但这确实有不同的含义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T15:17:54.867

为什么不维护一个单独的标志，该标志被初始化为 false，然后在计算 bar 时设置为 true。然后可以通过再次将标志设置为 false 来“取消定义”。

```
if(!isBarValid)
{
    calculateBar();
    isBarValid = true;
}
return bar; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T15:15:49.783

这在 C/C++ 中是不可能的，原语将始终分配一个值（主要是垃圾，无论在它之前的内存中的那个位置，除非在声明时显式分配）。我通常有一个占位符值（即指针为 0），它表示未使用，但是也必须显式分配这些值。如果你的 double 可以取任何值，那么我建议你在它旁边放一个布尔值，最初分配为 false，然后在你想进行计算时测试/设置那个值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-23T15:28:28.743

[您可以在第一次使用惯用语时](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.13)尝试Construct并这样编写`get_bar()`：

```
double & get_bar()
{
    static double *bar = new double(something());
    return *bar;
} 
```

当您打电话时，如果没有人要求`get_bar()`它，它将为您服务。`bar`任何后续调用都将返回`bar`。正如链接页面所说，这在技术上不会泄漏内存，因为操作系统会在程序退出时回收它。

更新：

将返回值更改`double &`为允许您修改`bar`.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T15:17:56.020

初始化为在构造函数中`bar`调用函数时永远不会出现的某个值。`something()`

例如：

```
Foo(): bar(-1)
{
} 
```

然后检查函数`-1`中的值`get_bar`。

（嗯，Laserallan 还在 1 分钟前发布了该答案：-( ;-)）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-23T15:19:38.217

您必须使用额外的布尔值来实现。

要使用额外的布尔值实现，您可以尝试以下模板的逻辑：

```
template<typename T>
struct Defined
{
 bool defined;
 T value;
 Defined() : defined(false) {}
 Defined(const T& value_) : defined(true), value(value_) {}
 ... and perhaps other operators here ...
 ... to make this behave even more like a T ...
}; 
```

# c# - 开源（免费）ASP.NET 站点搜索

> ID：473249
> 
> 赞同：0
> 
> 时间：2009-01-23T15:14:16.043
> 
> 标签：c#, asp.net, search

有人知道一个易于实现的asp.net 站点搜索引擎吗？越简单越好。

可能只需要一个爬虫和后端来存储结果。获取搜索结果的某种 API 会很方便，但我也可以直接从数据库中获取。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:16:08.333

[点 Lucene](http://incubator.apache.org/lucene.net/) (AKA Lucene.net)

[您可以在CodeProject](http://www.codeproject.com/KB/aspnet/DotLuceneSearch.aspx)中找到一个很好的示例和解释

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:17:55.020

看看[Lucene.Net](http://incubator.apache.org/lucene.net/)。它是一个非常成熟的 Java 搜索引擎的 .Net 端口。我听说过.Net 版本的好消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:58:21.507

如果您想在站点后面的数据库中搜索，全文搜索也可以提供帮助。

# php - 如何跟踪和分析 mod_perl 或 mod_php 应用程序使用的所有低级调用（c 库）？

> ID：473261
> 
> 赞同：1
> 
> 时间：2009-01-23T15:16:52.573
> 
> 标签：php, performance, perl, debugging, profiling

我曾经在一个站点上看到过一个调用图，该调用图挖掘了由 PHP 应用程序发起的 Web 请求的最底层库，其中包含调用时间和摘要。在我看来，这是在分析纯 PHP 代码时发现不明显的瓶颈原因的好方法。

像 strace 这样的东西，但有更多的细节。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T15:19:24.473

Rasmus在他的演讲中多次提到[valgrind 。](http://valgrind.org/)如果我没记错的话，它会测量 IO、内存等。可能想看看。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T15:22:09.257

像[VTune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)这样的工具可以在这里提供帮助。您可以将此工具指向要分析的流程或系统，它将有助于找到性能热点。VTune 还具有调用图模式。

# .net - 301/302 重定向时 WebBrowser 控件的屏幕截图为空白

> ID：473271
> 
> 赞同：0
> 
> 时间：2009-01-23T15:18:35.753
> 
> 标签：.net, com, browser, webbrowser-control

我正在使用 SmallSharpTools Web Preview 中的一些代码来获取网站的屏幕截图，但如果 url 返回 301/302 重定向，我会得到一个空白屏幕截图。

```
 WebBrowser wb = new WebBrowser(); 
        wb.ScrollBarsEnabled = false;
        wb.Size = new Size(1024, 768);
        wb.ScriptErrorsSuppressed = true;
        wb.AllowNavigation = true; 
        wb.NewWindow += new System.ComponentModel.CancelEventHandler(wb_NewWindow);
        wb.Navigate(url);
        // wait for it to load
        while (wb.ReadyState != WebBrowserReadyState.Complete)
        {
            Application.DoEvents();
        } 
        bitmap = new Bitmap(width, height);
        Rectangle rect = new Rectangle(0, 0, width, height);
        wb.DrawToBitmap(bitmap, rect); 
```

我已尝试访问 Windows.Forms.WebBrowser 包装的 ActiveXInstance，但我只能在出现错误（如 404/500）时获取代码，但我需要查看它是否为 301/302，以便我可以告诉要重定向的页面（我想我还需要重定向 url）

如果一切都失败了，我可以做一个 HTTPWebRequest 并事先整理好东西，但是我会为 1 个页面发出 2 个请求。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-15T08:57:54.007

根据 msdn，webbrowser 控件不支持 drawtobitmap。你必须找到另一种方式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-13T10:45:10.833

它没有正式支持它，但它可以工作（不应该依赖它）。

# php - 如何在 Tic-Tac-Toe 游戏（X0）php 中使用 miniclip 算法

> ID：473274
> 
> 赞同：0
> 
> 时间：2009-01-23T15:18:49.480
> 
> 标签：php, algorithm

嗨，我正在开发一个在线 Tic-Tac-Toe 游戏，使用 miniclip 算法来计算最佳移动。我发现了一些例子，但我真的不了解 miniclips 逻辑。一些例子会很棒。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:24:37.300

对于像井字游戏这样具有少量可能状态的游戏，构建所有可能游戏状态的树并让您的 AI 只采用不会以失败告终的分支是非常可行的。

除此之外，我认为您正在寻找的东西称为[minimax](http://en.wikipedia.org/wiki/Minimax)，[这里有一篇文章](http://www.angelfire.com/wi/wickmann/cs002.html)解释了它在井字游戏上下文中的变体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T23:59:38.620

我猜决策树或更像[游戏树](http://en.wikipedia.org/wiki/Game_tree)是您正在寻找的

# c# - C# 中的工厂模型

> ID：473275
> 
> 赞同：5
> 
> 时间：2009-01-23T15:19:23.583
> 
> 标签：c#, .net-3.5, factory

我有一堆 MDI 子节点，它们都是以相同的方式创建的，为了减少冗余代码，我希望能够调用一个方法，向它传递一个字符串（子节点的名称），让它创建节点并将其添加到父级。

除了从类名的字符串创建类之外，我可以做所有的事情，我该怎么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T15:25:18.720

我目前在我的一个应用程序中使用它来新建一个类

```
public static IMobileAdapter CreateAdapter(Type AdapterType)
{
  return (IMobileAdapter)System.Activator.CreateInstance(AdapterType);
} 
```

它返回一个实现 IMobileAdapter 的类的实例，但您可以同样轻松地将其与字符串一起使用：

```
public static IMyClassInterface CreateClass(string MyClassType)
{
  return (IMyClassInterface)System.Activator.CreateInstance(Type.GetType(MyClassType));
} 
```

使用类似于以下的代码调用它：

```
IMyClassInterface myInst = CreateClass("MyNamespace.MyClass, MyAssembly"); 
```

当然，在这种情况下，它创建的类必须实现接口 IMyClassInterface，但是使用类工厂，您可能会让所有类都实现相同的接口。

***编辑：***

参考您的评论，出于本次讨论的目的，将术语“程序集”视为您的 vb/cs 项目中的文件集。我假设您在单个项目 [程序集] 中完成所有这些工作，而不是分散在多个项目中。

在你的情况下，因为你的类将扩展 Form 对象，你会做这样的事情。

```
Form myInst = CreateClass("MyExtendedForm"); 
```

或者

```
Form myInst = CreateClass(Type.GetType("MyExtendedForm")); 
```

取决于您是在 CreateClass 方法内还是在其外获得类型。您需要将实例转换为正确的类型才能访问任何自定义成员。考虑一下：

```
class MyCustomForm : Form
{
    public int myCustomField{ get; set; }
} 
```

我有一个自定义表单，它扩展了 Form 添加 myCustomField 属性。我想使用 Activator.CreateInstance() 来实例化它：

```
public static Form CreateClass(string InstanceName)
{
    return (Form)System.Activator.CreateInstance(Type.GetType(InstanceName));
} 
```

然后我使用以下方法调用它：

```
Form myInst = CreateClass("MyCustomForm"); 
```

所以现在我将我的自定义表单存储在 myInst 中。但是，要访问自定义属性 [myCustomField]，您需要将您的实例转换为正确的形式：

```
int someVal = ((Type.GetType("MyCustomForm"))myInst).myCustomField; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T15:25:38.860

```
Activator.CreateInstance(Type.GetType(typeName)) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:23:11.377

如果你有一个作为类名的字符串，那么你应该能够通过调用 Type.GetType(string) 从中获取一个 Type 对象。从该类型中，您应该能够使用反射来生成对象。

# java - 如何在左侧用零填充整数？

> ID：473282
> 
> 赞同：1143
> 
> 时间：2009-01-23T15:21:24.670
> 
> 标签：java, formatting, zero-pad

在java中`int`转换为a时如何用零填充？`String`

我基本上希望`9999`用前导零填充整数（例如 1 = `0001`）。

* * *

## 回答 #1

> 赞同：1860
> 
> 时间：2009-01-23T15:26:04.287

像这样使用[`java.lang.String.format(String,Object...)`](https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#format-java.lang.String-java.lang.Object...-)：

```
String.format("%05d", yournumber); 
```

对于长度为 5 的零填充。对于十六进制输出，将 替换`d`为`x`中的`"%05x"`。

完整的格式化选项记录为[`java.util.Formatter`](https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html).

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2016-02-20T11:41:25.963

假设您要打印`11`为`011`

**您可以使用格式化程序**: `"%03d"`。

[![在此处输入图像描述](https://i.stack.imgur.com/u4vid.png)](https://i.stack.imgur.com/u4vid.png)

您可以像这样使用此格式化程序：

```
int a = 11;
String with3digits = String.format("%03d", a);
System.out.println(with3digits); 
```

或者，一些 java 方法直接支持这些格式化程序：

```
System.out.printf("%03d", a); 
```

* * *

## 回答 #3

> 赞同：123
> 
> 时间：2009-01-23T15:32:14.447

如果您出于任何原因使用 1.5 之前的 Java，则可以尝试使用 Apache Commons Lang 方法

```
org.apache.commons.lang.StringUtils.leftPad(String str, int size, '0') 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-01-23T15:25:43.850

找到这个例子......将测试......

```
import java.text.DecimalFormat;
class TestingAndQualityAssuranceDepartment
{
    public static void main(String [] args)
    {
        int x=1;
        DecimalFormat df = new DecimalFormat("00");
        System.out.println(df.format(x));
    }
} 
```

对此进行了测试，并且：

```
String.format("%05d",number); 
```

两者都有效，出于我的目的，我认为 String.Format 更好，更简洁。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2018-06-25T14:26:15.383

试试这个：

```
import java.text.DecimalFormat; 

DecimalFormat df = new DecimalFormat("0000");

String c = df.format(9);   // Output: 0009

String a = df.format(99);  // Output: 0099

String b = df.format(999); // Output: 0999 
```

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2013-09-03T15:05:12.123

如果在您的情况下性能很重要，那么与函数相比，您可以用更少的开销自己做`String.format`：

```
/**
 * @param in The integer value
 * @param fill The number of digits to fill
 * @return The given value left padded with the given number of digits
 */
public static String lPadZero(int in, int fill){

    boolean negative = false;
    int value, len = 0;

    if(in >= 0){
        value = in;
    } else {
        negative = true;
        value = - in;
        in = - in;
        len ++;
    }

    if(value == 0){
        len = 1;
    } else{         
        for(; value != 0; len ++){
            value /= 10;
        }
    }

    StringBuilder sb = new StringBuilder();

    if(negative){
        sb.append('-');
    }

    for(int i = fill; i > len; i--){
        sb.append('0');
    }

    sb.append(in);

    return sb.toString();       
} 
```

**表现**

```
public static void main(String[] args) {
    Random rdm;
    long start; 

    // Using own function
    rdm = new Random(0);
    start = System.nanoTime();

    for(int i = 10000000; i != 0; i--){
        lPadZero(rdm.nextInt(20000) - 10000, 4);
    }
    System.out.println("Own function: " + ((System.nanoTime() - start) / 1000000) + "ms");

    // Using String.format
    rdm = new Random(0);        
    start = System.nanoTime();

    for(int i = 10000000; i != 0; i--){
        String.format("%04d", rdm.nextInt(20000) - 10000);
    }
    System.out.println("String.format: " + ((System.nanoTime() - start) / 1000000) + "ms");
} 
```

**结果**

**自有函数：** 1697ms

**字符串格式：** 38134ms

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2015-05-03T07:42:01.253

您可以使用[谷歌番石榴](https://code.google.com/p/guava-libraries/)：

**马文：**

```
<dependency>
     <artifactId>guava</artifactId>
     <groupId>com.google.guava</groupId>
     <version>14.0.1</version>
</dependency> 
```

**示例代码：**

```
String paddedString1 = Strings.padStart("7", 3, '0'); //"007"
String paddedString2 = Strings.padStart("2020", 3, '0'); //"2020" 
```

**笔记：**

`Guava`是一个非常有用的库，它还提供了很多与`Collections`, `Caches`, `Functional idioms`, `Concurrency`, `Strings`, `Primitives`, `Ranges`, `IO`, `Hashing`,`EventBus`等相关的功能

参考：[番石榴解释](https://code.google.com/p/guava-libraries/wiki/GuavaExplained)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2020-02-19T03:48:06.960

以下是如何在不使用`DecimalFormat`.

`String.format("%02d", 9)`

> 09

`String.format("%03d", 19)`

> 019

`String.format("%04d", 119)`

> 0119

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-03-02T19:13:07.620

尽管上述许多方法都很好，但有时我们需要格式化整数和浮点数。我们可以使用它，特别是当我们需要在十进制数的左侧和右侧填充特定数量的零时。

```
import java.text.NumberFormat;  
public class NumberFormatMain {  

public static void main(String[] args) {  
    int intNumber = 25;  
    float floatNumber = 25.546f;  
    NumberFormat format=NumberFormat.getInstance();  
    format.setMaximumIntegerDigits(6);  
    format.setMaximumFractionDigits(6);  
    format.setMinimumFractionDigits(6);  
    format.setMinimumIntegerDigits(6);  

    System.out.println("Formatted Integer : "+format.format(intNumber).replace(",",""));  
    System.out.println("Formatted Float   : "+format.format(floatNumber).replace(",",""));  
 }    
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-08-24T13:29:48.097

```
int x = 1;
System.out.format("%05d",x); 
```

如果您想将格式化的文本直接打印到屏幕上。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-11-08T10:30:50.560

您需要使用 Formatter，以下代码使用[NumberFormat](https://docs.oracle.com/javase/7/docs/api/java/text/NumberFormat.html?bcsi_scan_64741547a7fe261b=0&bcsi_scan_filename=NumberFormat.html)

```
 int inputNo = 1;
    NumberFormat nf = NumberFormat.getInstance();
    nf.setMaximumIntegerDigits(4);
    nf.setMinimumIntegerDigits(4);
    nf.setGroupingUsed(false);

    System.out.println("Formatted Integer : " + nf.format(inputNo)); 
```

> 输出：0001

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-10-13T11:15:13.263

**使用类 DecimalFormat，如下所示：**

```
NumberFormat formatter = new DecimalFormat("0000"); //i use 4 Zero but you can also another number
System.out.println("OUTPUT : "+formatter.format(811)); 
```

**输出：** 0000811

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-11-01T08:49:30.233

您可以像这样在字符串中添加前导 0。定义一个字符串，它将是您想要的字符串的最大长度。就我而言，我需要一个只有 9 个字符长的字符串。

```
String d = "602939";
d = "000000000".substring(0, (9-d.length())) + d;
System.out.println(d); 
```

输出：000602939

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-07-24T10:29:17.313

检查适用于整数和字符串的代码。

假设我们的第一个数字是 2。我们想在其中添加零，因此最终字符串的长度将为 4。为此，您可以使用以下代码

```
 int number=2;
    int requiredLengthAfterPadding=4;
    String resultString=Integer.toString(number);
    int inputStringLengh=resultString.length();
    int diff=requiredLengthAfterPadding-inputStringLengh;
    if(inputStringLengh<requiredLengthAfterPadding)
    {
        resultString=new String(new char[diff]).replace("\0", "0")+number;
    }        
    System.out.println(resultString); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-03-01T04:20:39.040

使用这个简单的扩展功能

```
fun Int.padZero(): String {
    return if (this < 10) {
        "0$this"
    } else {
        this.toString()
    }
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2022-02-24T09:35:11.963

对于科特林

```
fun Calendar.getFullDate(): String {
    val mYear = "${this.get(Calendar.YEAR)}-"
    val mMonth = if (this.get(Calendar.MONTH) + 1 < 10) {
        "0${this.get(Calendar.MONTH) + 1}-"
    } else {
        "${this.get(Calendar.MONTH)+ 1}-"
    }
    val mDate = if (this.get(Calendar.DAY_OF_MONTH)  < 10) {
        "0${this.get(Calendar.DAY_OF_MONTH)}"
    } else {
        "${this.get(Calendar.DAY_OF_MONTH)}"
    }
    return mYear + mMonth + mDate
} 
```

并将其用作

`val date: String = calendar.getFullDate()`

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2020-08-15T14:34:23.300

这是在左侧用零填充整数的另一种方法。您可以根据自己的方便增加零的数量。添加了检查以返回与负数或大于或等于配置的零的值相同的值。您可以根据您的要求进一步修改。

```
/**
 * 
 * @author Dinesh.Lomte
 *
 */
public class AddLeadingZerosToNum {

    /**
     * 
     * @param args
     */
    public static void main(String[] args) {

        System.out.println(getLeadingZerosToNum(0));
        System.out.println(getLeadingZerosToNum(7));
        System.out.println(getLeadingZerosToNum(13));
        System.out.println(getLeadingZerosToNum(713));
        System.out.println(getLeadingZerosToNum(7013));
        System.out.println(getLeadingZerosToNum(9999));
    }
    /**
     * 
     * @param num
     * @return
     */
    private static String getLeadingZerosToNum(int num) {
        // Initializing the string of zeros with required size
        String zeros = new String("0000");
        // Validating if num value is less then zero or if the length of number 
        // is greater then zeros configured to return the num value as is
        if (num < 0 || String.valueOf(num).length() >= zeros.length()) {
            return String.valueOf(num);
        }
        // Returning zeros in case if value is zero.
        if (num == 0) {
            return zeros;
        }
        return new StringBuilder(zeros.substring(0, zeros.length() - 
                String.valueOf(num).length())).append(
                        String.valueOf(num)).toString();
    }
} 
```

**输入**

0

7

13

713

7013

9999

**输出**

0000

0007

0013

7013

9999

* * *

## 回答 #18

> 赞同：-4
> 
> 时间：2017-05-09T12:27:44.753

无需包：

```
String paddedString = i < 100 ? i < 10 ? "00" + i : "0" + i : "" + i; 
```

这会将字符串填充为三个字符，并且很容易为四五个字符添加更多部分。我知道这无论如何都不是完美的解决方案（特别是如果你想要一个大的填充字符串），但我喜欢它。

# php - css div未被识别

> ID：473294
> 
> 赞同：1
> 
> 时间：2009-01-23T15:24:18.707
> 
> 标签：php, html, css

我有以下CSS代码：

```
#Layer3

{
position:absolute;
width: 89%;
height: 40%;
left: 10%;
top: 56%;
background-color: #f1ffff;
}

#Layer3 h1 
{
font-size: medium;
color: #000033;
text-decoration: none;
text-align: center;
}

.tableheader {
    border-width:10px; border-style:solid;
}
.tablecontent {
    height: 95%;    
    overflow:auto;    
} 
```

但是，当我使用这个 PHP 生成 html

```
echo '<div id="tableheader" class="tableheader">';

echo "<h1>{$query} Auctions</h1>" . "\n"; 
echo "</div>";
echo '<div id="tablecontent" class="tablecontent">';

echo "<table border='0' width='100%'><tr>" . "\n"; 

echo "<td width='15%'>Seller ID</td>" . "\n"; 

echo "<td width='10%'>Start Date</td>" . "\n"; 

echo "<td width='75%'>Description</td>" . "\n"; 

echo "</tr>\n";

// printing table rows

    foreach ($rows as $row)

    {

        $pk = $row['ARTICLE_NO'];

        echo '<tr>' . "\n"; 

table contens generated in here

        echo '</tr>' . "\n"; 

    }
echo "</table>";
}

echo "</div>"; 
```

生成这个html：

```
<div id="tableheader" class="tableheader">
<h1>hardy Auctions</h1>
</div>
<div id="tablecontent" class="tablecontent">
<table border='0' width='100%'>
<tr>
<td width='15%'>Seller ID</td>
<td width='10%'>Start Date</td>
<td width='75%'>Description</td>
the rest of table stuff
</div> 
```

样式表被正确引用，所以我不确定是什么导致了错误。但是表头周围根本没有边框。这两个层都在第 3 层中，不再正确显示在页面上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:27:41.583

```
#tableheader {
  border: 10px solid #000;
} 
```

试着给它一个颜色。

编辑：由于它的 id 是表头，请尝试将样式选择器更改为 id。您也可以尝试使用 !important 来查看是否有任何东西覆盖了您的类选择器。

特异性值：

内联：1000；id：100，类：10，元素：1

!important 胜过所有其他不重要的声明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T15:50:40.807

首先使用 Firefox 中的 Firebug 或 IE 中的 IE Developer Toolbar 浏览呈现页面中的 HTML DOM。

这样，您可以看到哪些样式实际上与呈现页面中的元素相关联。从那里调试问题要容易得多。

一种可能性是 CSS 文件中某处存在语法错误，导致样式无法正确应用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:52:18.540

我刚刚快速浏览了一下，它接缝很好，我还创建了这些的本地副本，样式也很好，我在 h1 文本周围有一个很好的厚黑色边框。

因此，从您的解释来看，要么覆盖样式，要么样式未应用于页面。

# xml - 为什么 XAML 元素到 xml 绑定只能部分工作？

> ID：473298
> 
> 赞同：0
> 
> 时间：2009-01-23T15:24:45.880
> 
> 标签：xml, xaml, binding, listbox

在下面的代码中，ListBox 填充了 XML 文件中的颜色名称，但奇怪的是这些名称没有出现在 TextBox 中。

但是，如果将文本框绑定到静态“lbColor2”，这些名称就会出现。

那么，当它们来自 XML 源时，这些名称可能有什么不同，这使得它们不会被传递呢？

```
<StackPanel>
    <StackPanel.Resources>
        <XmlDataProvider x:Key="ExternalColors" Source="App_Data/main.xml" XPath="/colors"/>
    </StackPanel.Resources>
    <TextBlock Text="Colors:"/>
    <ListBox Name="lbColor" IsSynchronizedWithCurrentItem="True" ItemsSource="{Binding Source={StaticResource ExternalColors}, XPath=color/@name}"/>
    <ListBox Name="lbColor2">
        <ListBoxItem>Red</ListBoxItem>
        <ListBoxItem>Orange</ListBoxItem>
        <ListBoxItem>Cyan</ListBoxItem>
    </ListBox>
    <TextBlock Text="You selected color:"/>
    <TextBox
        Text="{Binding ElementName=lbColor, Path=SelectedItem.Content}"
        >
    </TextBox>
</StackPanel> 
```

这是 XML 文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<colors>
  <color name="Pink"/>
  <color name="Cyan"/>
  <color name="LightBlue"/>
  <color name="LightGreen"/>
  <color name="Another One"/>
</colors> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:32:39.423

您已绑定`TextBox`to `SelectedItem.Content`，但`XmlAttribute`没有名为 的属性`Content`。改变这个，你会没事的：

```
<TextBox Text="{Binding ElementName=lbColor, Path=SelectedItem.Value}"/> 
```

# c++ - 状态图生成器

> ID：473324
> 
> 赞同：3
> 
> 时间：2009-01-23T15:29:07.760
> 
> 标签：c++

是否有通过查看代码生成状态空间的工具。即，如果我给出一个类定义，它应该生成状态机。

编辑：我的意思是状态机只是类和状态变化的图形表示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:11:56.830

恐怕你必须更具体。

类的状态空间是每个组件状态空间的笛卡尔积，不需要特别复杂的类就可以拥有比宇宙中的质子更多的可能状态。除了少数例外，C++ 代码不太适合使用状态空间进行分析。

状态机通常与正则表达式相关联。你想要一个用正则表达式做某事的工具吗？

如果是这样，是什么？接受正则表达式的语言会将它们转换为一种状态空间表示形式，使其保持某种内部形式。您是否希望它以可读图表的形式出现，正如标签所暗示的那样？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T15:38:39.720

许多类有无限数量的状态，所以创建状态机是不可行的......例如，没有回文的 DFA，所以任何接受回文的类都不会有可用的状态图......

# ruby-on-rails - 将业务规则移入模型

> ID：473325
> 
> 赞同：1
> 
> 时间：2009-01-23T15:29:56.900
> 
> 标签：ruby-on-rails, ruby, refactoring, model, controller

我之前问了一个问题，引起了一些很好的反应。

[这是之前的问题](https://stackoverflow.com/questions/472733/how-would-you-tidy-up-this-controller-logic)

根据那里给出的一些建议，我尝试移动以下控制器逻辑

```
 if params[:concept][:consulted_legal] == 0 && params[:concept][:consulted_marketing] == 1
  @concept.attributes = {:status => 'Awaiting Compliance Approval'}
elsif params[:concept][:consulted_marketing] == 0 && params[:concept][:consulted_legal] == 1 
  @concept.attributes = {:status => 'Awaiting Marketing Approval'}
elsif params[:concept][:consulted_marketing] == 0 && params[:concept][:consulted_legal] == 0
  @concept.attributes = {:status => 'Awaiting Marketing & Legal Approval'}
else
  @concept.attributes = {:status => 'Pending Approval'}
end 
```

进入模型，如下所示：

```
def set_status
if status.blank?
  if (consulted_legal == true) && (consulted_marketing == true)
      status = "Pending Approval"
  elsif (consulted_legal == true) && (consulted_marketing == false)
    status = "Awaiting Marketing Approval"
  elsif (consulted_legal == false) && (consulted_marketing == true)
    status = "Awaiting Legal Approval"
  elsif (consulted_legal == false) && (consulted_marketing == false)
    status = "Awaiting Marketing & Legal Approval"
  end
end
true # Needs to return true for the update to go through    
  end 
```

我从 before_save 回调中调用它。

默认情况下，consulted_legal 和consulted_marketing 属性都设置为false 而不是null，这就是为什么我在这里测试== false 或true，而不是询问

```
if consulted_legal? 
```

例如。

但是，这种逻辑似乎不起作用。如果我检查该对象，则永远不会将状态设置为任何内容。谁能发现为什么会发生这种情况？例如，我是否知道模型中的属性是如何被错误访问的？

TIA

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T16:28:47.827

而不是`status =`尝试`self.status =`。我发现我需要使用`self.`来更改模型中的模型属性。

最好`errors.empty?`在结尾而不是`true`，因此如果您`errors.add_to_base`将来使用，您的`set_status`方法已准备好中止保存。

**编辑：**
您可能还想查看[`acts_as_state_machine`](http://agilewebdevelopment.com/plugins/acts_as_state_machine). 它看起来像一个插件，正是你正在做的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:30:11.427

您是否从用户输入设置参数？

如果它们未定义为布尔数据库列，那么您将为它们分配一个字符串，该字符串永远不会等于 true。

# erlang - Erlang 中 io:fread 的意外行为

> ID：473327
> 
> 赞同：7
> 
> 时间：2009-01-23T15:30:42.187
> 
> 标签：erlang

这是一个 Erlang 问题。

我遇到了 io:fread 的一些意外行为。

我想知道是否有人可以检查我使用 io:fread 的方式是否有问题，或者 io:fread 中是否存在错误。

我有一个包含“数字三角形”的文本文件，如下所示：

```
59
73 41
52 40 09
26 53 06 34
10 51 87 86 81
61 95 66 57 25 68
90 81 80 38 92 67 73
30 28 51 76 81 18 75 44
...

```

每对数字之间有一个空格，每行以回车换行对结束。

我使用以下 Erlang 程序将此文件读入列表。

```
-模块（欧拉67）。
-作者（“凯尔·斯潘登”）。

-出口（[解决/0]）。

解决（）->
    {ok, File} = file:open("triangle.txt", [read]),
    数据 = 读取文件（文件），
    确定 = 文件：关闭（文件），
    数据。

读取文件（文件）->
    读取文件（文件，[]）。

读取文件（文件，数据）->
    case io:fread(File, "", "~d") of
        {好的，[N]} ->
            读取文件（文件，[N | 数据]）；
        eof->
            列表：反向（数据）
    结尾。

```

这个程序的输出是：

```
(erlide@cayle-spandons-computer.local)30> euler67:solve()。
[59,73,41,52,40,9,26,53,6,3410,51,87,86,8161,95,66,57,25,
 6890,81,80,38,92,67,7330,28,51,76,81|...]

```

请注意第四行的最后一个数字 (34) 和第五行的第一个数字 (10) 是如何合并为一个数字 3410 的。

当我使用“od”转储文本文件时，这些行没有什么特别之处；它们以 cr-nl 结尾，就像任何其他行一样：

```
> od -ta 三角形.txt
0000000 5 9 cr nl 7 3 sp 4 1 cr nl 5 2 sp 4 0
0000020 sp 0 9 cr nl 2 6 sp 5 3 sp 0 6 sp 3 4
0000040 cr nl 1 0 sp 5 1 sp 8 7 sp 8 6 sp 8 1
0000060 cr nl 6 1 sp 9 5 sp 6 6 sp 5 7 sp 2 5
0000100 sp 6 8 cr nl 9 0 sp 8 1 sp 8 0 sp 3 8
0000120 sp 9 2 sp 6 7 sp 7 3 cr nl 3 0 sp 2 8
0000140 sp 5 1 sp 7 6 sp 8 1 sp 1 8 sp 7 5 sp
0000160 4 4 cr nl 8 4 sp 1 4 sp 9 5 sp 8 7 sp

```

一个有趣的观察是，出现问题的一些数字恰好位于文本文件中的 16 字节边界上（但不是全部，例如 6890）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T00:22:10.153

我也打算把它当作 Erlang 中的一个 bug，而且是一个奇怪的 bug。将格式字符串更改为 "~2s" 会产生同样奇怪的结果：

```
["59","73","4","15","2","40","0","92","6","53","0","6","34",
 "10","5","1","87","8","6","81","61","9","5","66","5","7",
 "25","6",
 [...]|...] 
```

因此，出于计数的目的，它似乎将换行符计数为常规字符，但在产生输出时却没有。Loopy 就像地狱一样。

一周的 Erlang 编程，我已经深入研究了源代码。这对我来说可能是一个新的记录......

**编辑**

更多的调查已经证实我这是一个错误。调用其中使用的内部方法之一`fread`：

```
> io_lib_fread:fread([], "12 13\n14 15 16\n17 18 19 20\n", "~d").           
{done,{ok,"\f"}," 1314 15 16\n17 18 19 20\n"} 
```

基本上，如果要读取多个值，则换行符，第一个换行符在字符串的“仍待读取”部分中被吃掉。其他测试表明，如果您在前面加上一个空格就可以了，如果您用换行符引导字符串，它会要求更多。

我要深入了解这个，gosh-darn-it...（笑）没有那么多代码要经过，而且没有多少专门处理换行符，所以应该不会花太长时间缩小范围并修复它。

**编辑^2**

哈哈！得到了小麻烦。

这是您想要的 stdlib 的补丁（请记住重新编译并将新的梁文件放在旧文件的顶部）：

```
--- ../erlang/erlang-12.b.3-dfsg/lib/stdlib/src/io_lib_fread.erl
+++ ./io_lib_fread.erl
@@ -35,9 +35,9 @@
     fread_collect(MoreChars, [], Rest, RestFormat, N, Inputs).

 fread_collect([$\r|More], Stack, Rest, RestFormat, N, Inputs) ->
-    fread(RestFormat, Rest ++ reverse(Stack), N, Inputs, More);
+    fread(RestFormat, Rest ++ reverse(Stack), N, Inputs, [$\r|More]);
 fread_collect([$\n|More], Stack, Rest, RestFormat, N, Inputs) ->
-    fread(RestFormat, Rest ++ reverse(Stack), N, Inputs, More);
+    fread(RestFormat, Rest ++ reverse(Stack), N, Inputs, [$\n|More]);
 fread_collect([C|More], Stack, Rest, RestFormat, N, Inputs) ->
     fread_collect(More, [C|Stack], Rest, RestFormat, N, Inputs);
 fread_collect([], Stack, Rest, RestFormat, N, Inputs) ->
@@ -55,8 +55,8 @@
                eof ->
                    fread(RestFormat,eof,N,Inputs,eof);
                _ ->
-                   %% Don't forget to count the newline.
-                   {more,{More,RestFormat,N+1,Inputs}}
+                   %% Don't forget to strip and count the newline.
+                   {more,{tl(More),RestFormat,N+1,Inputs}}
            end;
        Other ->                                %An error has occurred
            {done,Other,More} 
```

现在将我的补丁提交给 erlang-patches，并获得由此产生的名声和荣耀......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T10:21:00.023

除了它似乎是其中一个 erlang 库中的错误之外，我认为您可以（非常）轻松地绕过该问题。

鉴于您的文件是面向行的，我认为最佳做法是您也逐行处理它。

考虑以下结构。它在未打补丁的 erlang 上运行良好，并且因为它使用惰性求值，它可以处理任意长度的文件，而无需先将所有文件读入内存。该模块包含一个应用于每一行的函数示例 - 将一行整数文本表示转换为整数列表。

```
 -module(liner).
-author("Harro Verkouter").
-export([liner/2, integerize/0, lazyfile/1]).

% Applies a function to all lines of the file
% before reducing (foldl).
liner(File, Fun) ->
    lists:foldl(fun(X, Acc) -> Acc++Fun(X) end, [], lazyfile(File)).

% Reads the lines of a file in a lazy fashion
lazyfile(File) ->
    {ok, Fd} = file:open(File, [read]),
    lazylines(Fd).
% Actually, this one does the lazy read ;)
lazylines(Fd) ->
    case io:get_line(Fd, "") of
        eof -> file:close(Fd), [];
        {error, Reason} ->
            file:close(Fd), exit(Reason);
        L ->
            [L|lazylines(Fd)]
    end.

% Take a line of space separated integers (string) and transform
% them into a list of integers
integerize() ->
    fun(X) ->
        lists:map(fun(Y) -> list_to_integer(Y) end,
                string:tokens(X, " \n")) end.

Example usage:
Eshell V5.6.5  (abort with ^G)
1> c(liner).
{ok,liner}
2> liner:liner("triangle.txt", liner:integerize()).
[59,73,41,52,40,9,26,53,6,34,10,51,87,86,81,61,95,66,57,25,
 68,90,81,80,38,92,67,73,30|...]

And as a bonus, you can easily fold over the lines of any (lineoriented) file w/o running out of memory :)

6> lists:foldl( fun(X, Acc) -> 
6>                  io:format("~.2w: ~s", [Acc,X]), Acc+1
6>                  end,
6>              1,  
6>              liner:lazyfile("triangle.txt")).                                        
 1: 59
 2: 73 41
 3: 52 40 09
 4: 26 53 06 34
 5: 10 51 87 86 81
 6: 61 95 66 57 25 68
 7: 90 81 80 38 92 67 73
 8: 30 28 51 76 81 18 75 44 
```

干杯，H。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T15:47:51.487

我注意到有多个实例合并了两个数字，并且它似乎位于从第四行及以后开始的每一行的行边界处。

我发现，如果你在从第五行开始的每一行的开头添加一个空格字符，那就是：

```
59
73 41
52 40 09
26 53 06 34
 10 51 87 86 81
 61 95 66 57 25 68
 90 81 80 38 92 67 73
 30 28 51 76 81 18 75 44
... 
```

数字得到正确解析：

```
39> euler67:solve().
[59,73,41,52,40,9,26,53,6,34,10,51,87,86,81,61,95,66,57,25,
 68,90,81,80,38,92,67,73,30|...] 
```

如果将空格添加到前四行的开头，它也可以工作。

这更像是一种解决方法，而不是实际的解决方案，但它确实有效。我想弄清楚如何为 io:fread 设置格式字符串，这样我们就不必这样做了。

**更新** 这是一个不会强迫您更改文件的解决方法。这假设所有数字都是两个字符（< 100）：

```
read_file(File, Data) ->
case io:fread(File, "", "~d") of
    {ok, [N] } -> 
        if
            N > 100 ->
                First = N div 100,
                Second = N - (First * 100),
                read_file(File, [First , Second | Data]);

            true ->
                read_file(File, [N | Data])
        end;
    eof ->
        lists:reverse(Data)
end. 
```

基本上，该代码捕获任何一个数字，这些数字是两个跨换行符的串联并将它们分成两个。

同样，这是一个暗示 io:fread 中可能存在错误的组合，但应该这样做。

**再次更新**上述内容仅适用于两位数输入，但由于该示例将所有数字（甚至小于 10 的数字）打包成两位数格式，因此适用于本示例。

# sql-server - SQL Server 在执行 BULK INSERT 时是否以任何方式转换文本？

> ID：473338
> 
> 赞同：1
> 
> 时间：2009-01-23T15:35:48.433
> 
> 标签：sql-server

我正在尝试使用 BULK INSERT 语句从文本文件中填充 SQL Server 中的大型（1700 万行）表。nchar(17) 类型的一列有一个 UNIQUE 约束。我已经检查（使用一些 Python 代码）该文件不包含重复项，但是当我执行查询时，我从 SQL Server 收到以下错误消息：

无法在具有唯一索引“IX_tbl_Name”的对象“dbo.tbl_Name”中插入重复的键行。

Server 在执行 BULK INSERT 时会以某种方式转换文本吗？SQL Server 数据库是否禁止在 nchar 列中使用任何标点符号，或者要求对任何标点符号进行转义？有什么办法可以找出是哪一行引起了麻烦？我应该切换到其他方法来插入数据吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T15:38:53.357

您对列的排序规则设置可能会导致数据被视为重复，而您的代码可能会将其视为唯一。在某些排序规则设置下，重音和大写字母等内容可能会导致问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:47:02.607

另一个想法是空值或空值被视为重复值，因此您的 Python 代码可能找不到任何文本重复项，但空值呢？

# c# - 需要引用：使用预处理器是不好的 OO 实践

> ID：473354
> 
> 赞同：17
> 
> 时间：2009-01-23T15:42:44.410
> 
> 标签：c#, oop, c-preprocessor, dos-donts

我相信，像这样的预处理器指令的使用`#if UsingNetwork`是不好的 OO 实践——其他同事不这样做。我认为，当使用 IoC 容器（例如 Spring）时，如果相应地编程，组件可以很容易地配置。在这种情况下，`IsUsingNetwork`可以由 IoC 容器设置属性，或者，如果“使用网络”实现的行为不同，则应该实现并注入该接口的另一个实现（例如：`IService`、、、`ServiceImplementation`）`NetworkingServiceImplementation`。

有人可以提供**OO-Gurus 的**引用或书籍中的**参考资料，这些书籍**基本上是“如果您尝试配置应该通过 IoC 容器配置的行为，预处理器的使用是不好的 OO 实践”？

**我需要这些引用来说服同事重构......**

编辑：我确实知道并同意在编译期间使用预处理器指令来更改目标平台特定的代码很好，这就是预处理器指令的用途。但是，我认为应该使用运行时配置而不是编译时配置来获得良好的设计和可测试的类和组件。换句话说：使用#defines 和#if 超出它们的用途将导致难以测试代码和设计糟糕的类。

有没有人读过这些方面的东西，可以给我，以便我参考？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-28T21:21:07.647

亨利·斯宾塞（Henry Spencer）写了一篇名为[#ifdef Considered Harmful](https://www.usenix.org/legacy/publications/library/proceedings/sa92/spencer.pdf)的论文。

此外，Bjarne Stroustrup 本人在他的著作[The Design and Evolution of C++](https://books.google.com/books?id=GvivU9kGInoC)的第 18 章中不赞成使用预处理器，并希望完全消除它。然而，Stroustrup 也认识到 #ifdef 指令和条件编译的必要性，并继续说明在 C++ 中没有好的替代方案。

最后，Pete Goodliffe 在他的书[Code Craft: The Practice of Writing Excellence Code](http://books.google.com/books?id=i4zCzpkrt4sC)的第 13 章中，给出了一个例子，即使用于其最初的目的，#ifdef 也会让你的代码变得一团糟。

希望这可以帮助。但是，如果您的同事一开始就不会听取合理的论点，我怀疑书名将有助于说服他们；）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-23T17:20:25.693

C# 中的预处理器指令具有非常明确的定义和实际用例。您具体谈论的那些称为条件指令，用于控制代码的哪些部分被编译，哪些不被编译。

不编译部分代码和通过 IoC 控制对象图的连接方式之间有一个非常重要的区别。让我们看一个真实世界的例子：XNA。当您开发计划在 Windows 和 XBox 360 上部署的 XNA 游戏时，您的解决方案通常会在您的 IDE 中至少有两个可以在它们之间切换的平台。它们之间会有一些差异，但其中一个差异是 XBox 360 平台将定义一个条件符号 XBOX360，您可以在源代码中使用以下惯用语：

```
#if (XBOX360)
// some XBOX360-specific code here
#else
// some Windows-specific code here
#endif 
```

当然，您可以使用 Strategy 设计模式和通过 IoC 控制哪个被实例化来排除这些差异，但条件编译提供至少三个主要优点：

1.  你不会发布你不需要的代码。
2.  您可以在代码的正确上下文中看到两个平台的平台特定代码之间的差异。
3.  没有间接开销。适当的代码被编译，另一个不是，就是这样。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-23T16:05:11.587

恕我直言，您谈论的是 C 和 C++，而不是一般的 OO 实践。而且C不是面向对象的。在这两种语言中，预处理器实际上是有用的。只要正确使用它。

我认为这个答案属于[C++ FAQ：[29.8] 你是说预处理器是邪恶的吗？](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.8).

> 是的，这正是我要说的：预处理器是邪恶的。
> 
> 每个`#define`宏有效地在每个源文件和每个作用域中创建一个新关键字，直到该符号为`#undef`d。预处理器允许您创建一个始终被替换的 #define 符号，而与 `{...}`该符号出现的范围无关。
> 
> 有时我们需要预处理器，例如`#ifndef/#define`每个头文件中的包装器，但应尽可能避免。“邪恶”并不意味着“从不使用”。你有时会使用邪恶的东西，尤其是当它们是“两害相权取其轻”的时候。但他们仍然是邪恶的:-)

我希望这个来源足够权威:-)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-23T16:04:06.160

> **“预处理器是邪恶的化身，是地球上所有痛苦的原因”** ——罗伯特（OO Guru）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-27T20:15:52.553

IMO 区分#if 和#define 很重要。两者都可能有用，也都可能被过度使用。我的经验是#define 比#if 更容易被过度使用。

我花了 10 多年的时间做 C 和 C++ 编程。在我从事的项目（DOS / Unix / Macintosh / Windows 的商业可用软件）中，我们主要使用#if 和#define 来处理代码可移植性问题。

我花了足够的时间使用 C++/MFC 来学习如何在过度使用 #define 时厌恶它——我相信 1996 年左右的 MFC 就是这种情况。

然后我花了 7 年多的时间从事 Java 项目。我不能说我错过了预处理器（尽管我肯定错过了 Java 当时没有的枚举类型和模板/泛型之类的东西）。

自 2003 年以来，我一直在使用 C#。我们在调试版本中大量使用了 #if 和 [Conditional("DEBUG")] - 但 #if 只是一种更方便、更有效的方法我们在 Java 中所做的事情。

展望未来，我们已经开始为 Silverlight 准备我们的核心引擎。虽然我们所做的一切都可以在没有#if 的情况下完成，但使用#if 可以减少工作量，这意味着我们可以花更多时间添加客户要求的功能。例如，我们有一个值类，它封装了系统颜色以存储在我们的核心引擎中。下面是前几行代码。由于 System.Drawing.Color 和 System.Windows.Media.Color 之间的相似性，顶部的#define 为我们提供了普通 .NET 和 Silverlight 中的许多功能，而无需重复代码：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Diagnostics;
#if SILVERLIGHT
using SystemColor = System.Windows.Media.Color;
#else
using SystemColor = System.Drawing.Color;
#endif

namespace SpreadsheetGear.Drawing
{
    /// <summary>
    /// Represents a Color in the SpreadsheetGear API and provides implicit conversion operators to and from System.Drawing.Color and / or System.Windows.Media.Color.
    /// </summary>
    public struct Color
    {
        public override string ToString()
        {
            //return string.Format("Color({0}, {1}, {2})", R, G, B);
            return _color.ToString();
        }

        public override bool Equals(object obj)
        {
            return (obj is Color && (this == (Color)obj))
                || (obj is SystemColor && (_color == (SystemColor)obj));
        }
        ... 
```

对我来说，底线是有很多语言特性可以被过度使用，但这并不足以成为将这些特性排除在外或制定严格规则禁止使用它们的充分理由。我必须说，在用 Java 编程这么久之后转向 C# 帮助我欣赏这一点，因为微软 (Anders Hejlsberg) 更愿意提供可能不吸引大学教授的功能，但这些功能让我在工作中更有效率并最终使我能够在任何有发货日期的人的有限时间内构建一个更好的小部件。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-27T21:16:34.880

预处理器#ifdef 的一个问题是它们有效地复制了编译版本的数量，理论上，您应该彻底测试，以便您可以说您交付的代码是正确的。

```
 #ifdef DEBUG
  //...
  #else
  //... 
```

好的，现在我可以制作“Debug”版本和“Release”版本了。这对我来说没问题，我总是这样做，因为我有断言和调试跟踪，它们只在调试版本中执行。

如果有人来写（现实生活中的例子）

```
 #ifdef MANUALLY_MANAGED_MEMORY
  ... 
```

他们编写了一个宠物优化，将其传播到四五个不同的类，然后突然之间你就有了四种可能的方法来编译你的代码。

如果只有另一个 #ifdef-dependant 代码，那么您将有八个可能的版本要生成，更令人不安的是，其中四个可能是发布版本。

当然，运行时 if()，如循环等，会创建您必须测试的分支 - 但我发现要保证配置的每个**编译时间**变化保持正确更加困难。

这就是为什么我认为，作为一项政策，除了 Debug/Release 版本之外的所有#ifdef 都应该是**临时**的，即你正在开发代码中进行实验，你很快就会决定它是否保持一种方式或其他。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-28T17:47:26.423

Bjarne Stroustrap 在这里提供了他的答案（一般来说，不是针对 IoC）

[那么，使用宏有什么问题呢？](http://www.research.att.com/~bs/bs_faq2.html#macro "那么，使用宏有什么问题呢？")

（摘抄）

> 宏不遵守 C++ 范围和类型规则。这通常是微妙和不那么微妙问题的原因。因此，C++ 提供了更适合其他 C++ 的替代方案，例如内联函数、模板和命名空间。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-23T16:16:09.240

C# 中对预处理的支持非常少……几乎没用。那是邪恶的吗？

预处理器与 OO 有什么关系？当然是用于构建配置。

例如，我的应用程序有一个精简版和一个专业版。我可能想在精简版上排除一些代码，而不必求助于构建非常相似的代码版本。

我可能不想发布具有不同运行时标志的专业版的精简版。

托尼

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-23T16:18:31.343

在 c#/VB.NET 中，我不会说它是邪恶的。

例如，在调试 windows 服务时，我将以下内容放在 Main 中，以便在调试模式下，我可以将服务作为应用程序运行。

```
 <MTAThread()> _
    <System.Diagnostics.DebuggerNonUserCode()> _
    Shared Sub Main()

#If DEBUG Then

        'Starts this up as an application.'

        Dim _service As New DispatchService()
        _service.ServiceStartupMethod(Nothing)
        System.Threading.Thread.Sleep(System.Threading.Timeout.Infinite)

#Else

        'Runs as a service. '

        Dim ServicesToRun() As System.ServiceProcess.ServiceBase
        ServicesToRun = New System.ServiceProcess.ServiceBase() {New DispatchService}
        System.ServiceProcess.ServiceBase.Run(ServicesToRun)

#End If

    End Sub 
```

这是配置应用程序的行为，当然不是邪恶的。至少，它不像尝试调试服务启动例程那样邪恶。

如果我读错了您的 OP，请纠正我，但是当一个简单的布尔值就足够时，您似乎在抱怨其他人使用预处理器。如果是这样的话，不要诅咒预处理器，诅咒那些以这种方式使用它们的人。

**编辑：** 回复：第一条评论。我不明白这个例子是如何联系在这里的。问题是预处理器被滥用，而不是它是邪恶的。

我再举一个例子。我们有一个应用程序在启动时在客户端和服务器之间进行版本检查。在开发中，我们经常有不同的版本，不想做版本检查。这是邪恶的吗？

我想我想说的是预处理器不是邪恶的，即使在改变程序行为时也是如此。问题是有人在滥用它。这么说有什么不对？您为什么要关闭语言功能？

**很久以后编辑**：FWIW：几年来我没有为此使用预处理器指令。我确实将 Environment.UserInteractive 与特定的 arg 集（“-c” = 控制台）一起使用，并且我从这里的某个地方找到了一个巧妙的技巧，它不会阻止应用程序但仍等待用户输入。

```
Shared Sub Main(args as string[])
  If (Environment.UserInteractive = True) Then
    'Starts this up as an application.
    If (args.Length > 0 AndAlso args[0].Equals("-c")) Then 'usually a "DeriveCommand" function that returns an enum or something similar
      Dim isRunning As Boolean = true
      Dim _service As New DispatchService()
      _service.ServiceStartupMethod(Nothing)
      Console.WriteLine("Press ESC to stop running")
      While (IsRunning)
        While (Not (Console.KeyAvailable AndAlso (Console.ReadKey(true).Key.Equals(ConsoleKey.Escape) OrElse Console.ReadKey(true).Key.Equals(ConsoleKey.R))))
           Thread.Sleep(1)
         End While                        
         Console.WriteLine()
         Console.WriteLine("Press ESC to continue running or any other key to continue shutdown.")
         Dim key = Console.ReadKey();
         if (key.Key.Equals(ConsoleKey.Escape))
         {
           Console.WriteLine("Press ESC to load shutdown menu.")
           Continue
         }
         isRunning = false
      End While
      _service.ServiceStopMethod()
    Else
      Throw New ArgumentException("Dont be a double clicker, this needs a console for reporting info and errors")
    End If
  Else

    'Runs as a service. '
    Dim ServicesToRun() As System.ServiceProcess.ServiceBase
    ServicesToRun = New System.ServiceProcess.ServiceBase() {New DispatchService}
    System.ServiceProcess.ServiceBase.Run(ServicesToRun)
  End If
End Sub 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-27T21:16:31.620

使用 #if 而不是 IoC 或其他一些机制来控制基于配置的不同功能可能违反了单一职责原则，这是“现代”OO 设计的关键。[这是](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)关于 OO 设计原则的广泛系列文章。

由于根据定义，#if 的不同部分中的部分涉及系统的不同方面，因此您现在将至少两个不同组件的实现细节耦合到使用 #if 的代码的依赖链中。

通过重构这些问题，您创建了一个类，假设它已经完成并经过测试，除非公共代码被破坏，否则将不再需要破解。

在您原来的情况下，您需要记住 #if 的存在，并在三个组件中的任何一个发生更改时考虑到它，以应对重大更改的可能副作用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-27T21:49:20.307

预处理器代码注入对于编译器来说就像触发器对于数据库一样。而且很容易找到关于触发器的此类断言。

我主要认为#define 用于内联短表达式，因为它节省了函数调用的开销。换句话说，这是过早的优化。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-28T21:26:11.303

快速告诉您的同事的一点是：如果在数学语句中使用符号，预处理器会破坏数学语句中的运算符优先级。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-09-01T22:42:57.997

在我的脑海中，我没有关于预处理器指令使用的大师声明，也不能添加对著名指令的引用。但我想给您一个链接，指向 Microsoft 的[MSDN](http://msdn.microsoft.com/en-us/library/aa691094%28v=vs.71%29.aspx)上的一个简单示例。

```
#define A
#undef B
class C
{
#if A
   void F() {}
#else
   void G() {}
#endif
#if B
   void H() {}
#else
   void I() {}
#endif
} 
```

这将导致简单的

```
class C
{
   void F() {}
   void I() {}
} 
```

而且我认为这不是很容易阅读，因为您必须查看顶部才能看到此时确切定义的内容。如果您在其他地方定义了它，这将变得更加复杂。

对我来说，创建不同的实现并将它们注入调用者而不是切换定义来创建“新”类定义看起来要简单得多。（...因此，我理解为什么您将预处理器定义的使用与 IoC 的使用进行比较）。除了使用预处理器指令的代码可读性差之外，我很少使用预处理器定义，因为它们会增加测试代码的复杂性，因为它们会导致多个路径（但这也是外部 IoC 容器注入多个实现的问题）。

Microsoft 本身在 win32 api 中使用了许多预处理器定义，您可能知道/记得 char 和 w_char 方法调用之间的丑陋切换。

也许你不应该说“不要使用它”。告诉他们“如何使用它”和“何时使用它”。如果您想出好的（更好理解的）替代方案并且可以描述使用预处理器定义/makros 的风险，我认为每个人都会同意您的看法。

不需要大师……只要成为大师。;-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-08-17T04:50:09.873

我想问一个新问题，但看起来很适合这里。我同意拥有一个成熟的预处理器对于 Java 来说可能太多了。C 世界中的预处理器涵盖了一个明确的需求，而 Java 世界中根本没有涵盖：我希望编译器根据调试级别完全忽略调试打印输出。现在我们依赖“良好实践”，但实际上这种做法很难实施，并且仍然存在一些冗余 CPU 负载。

在 Java 风格中，可以通过一些指定的方法（如 debug()、warning() 等）来解决，这些方法的调用代码是生成条件的。

实际上，这将是 Log4J 与语言的一点整合。

# c# - 计算剩余时间

> ID：473355
> 
> 赞同：64
> 
> 时间：2009-01-23T15:43:03.817
> 
> 标签：c#, algorithm

确定完成某事的剩余时间的好算法是什么？我知道总共有多少行，已经完成了多少，我应该如何估计剩余时间？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-01-23T15:46:02.717

为什么不？

~~`(linesProcessed / TimeTaken)`~~ `(timetaken / linesProcessed) * LinesLeft = TimeLeft`

`TimeLeft`然后将以任何时间单位表示`timeTaken`。

# 编辑：

感谢您的评论您是对的，这应该是：

`(TimeTaken / linesProcessed) * linesLeft = timeLeft`

所以我们有

`(10 / 100) * 200`= 20 秒现在 10 秒过去
`(20 / 100) * 200`= 40 秒现在还剩 10 秒，我们再处理 100 行
`(30 / 200) * 100`= 15 秒，现在我们都明白为什么复制文件对话框从 3 小时跳到 30 分钟 :-)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-03-15T23:17:22.130

我很惊讶没有人用代码回答这个问题！

@JoshBerke 回答的计算时间的简单方法可以编码如下：

```
DateTime startTime = DateTime.Now;
for (int index = 0, count = lines.Count; index < count; index++) {
    // Do the processing
    ...

    // Calculate the time remaining:
    TimeSpan timeRemaining = TimeSpan.FromTicks(DateTime.Now.Subtract(startTime).Ticks * (count - (index+1)) / (index+1));

    // Display the progress to the user
    ...
} 
```

这个简单的例子非常适合简单的进度计算。
但是，对于更复杂的任务，可以通过多种方式改进此计算！

例如，当您下载大文件时，下载速度很容易波动。要计算最准确的“ETA”，一个好的算法是只考虑过去 10 秒的进度。查看[**ETACalculator.cs**](http://github.com/scottrippey/Progression/blob/master/Progression/Extras/ETACalculator.cs)以了解该算法的实现！

**ETACalculator.cs**来自[**Progression——**](http://github.com/scottrippey/Progression)我编写的一个开源库。它为各种“进度计算”定义了一个非常易于使用的结构。它使报告不同类型进度的嵌套步骤变得容易。如果您担心感知性能（正如@JoshBerke 建议的那样），它将极大地帮助您。[](http://github.com/scottrippey/Progression)

 *** * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-01-23T15:52:18.807

确保管理[感知绩效](http://blog.codinghorror.com/actual-performance-perceived-performance/)。

> 尽管所有进度条在测试中花费的时间完全相同，但有两个特征让用户认为该过程更快，即使不是：
> 
> 1.  顺利完成的进度条
> 2.  接近尾声的进度条

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2011-07-25T21:15:19.120

不要重提一个死问题，但我一直回来参考这个页面。
您可以在 Stopwatch 类上创建一个扩展方法，以获取可以获得估计剩余时间跨度的功能。

```
static class StopWatchUtils
{
    /// <summary>
    /// Gets estimated time on compleation. 
    /// </summary>
    /// <param name="sw"></param>
    /// <param name="counter"></param>
    /// <param name="counterGoal"></param>
    /// <returns></returns>
    public static TimeSpan GetEta(this Stopwatch sw, int counter, int counterGoal)
    {
        /* this is based off of:
         * (TimeTaken / linesProcessed) * linesLeft=timeLeft
         * so we have
         * (10/100) * 200 = 20 Seconds now 10 seconds go past
         * (20/100) * 200 = 40 Seconds left now 10 more seconds and we process 100 more lines
         * (30/200) * 100 = 15 Seconds and now we all see why the copy file dialog jumps from 3 hours to 30 minutes :-)
         * 
         * pulled from http://stackoverflow.com/questions/473355/calculate-time-remaining/473369#473369
         */
        if (counter == 0) return TimeSpan.Zero;
        float elapsedMin = ((float)sw.ElapsedMilliseconds / 1000) / 60;
        float minLeft = (elapsedMin / counter) * (counterGoal - counter); //see comment a
        TimeSpan ret = TimeSpan.FromMinutes(minLeft);
        return ret;
    }
} 
```

例子：

```
int y = 500;
Stopwatch sw = new Stopwatch();
sw.Start();
for(int x = 0 ; x < y ; x++ )
{
    //do something
    Console.WriteLine("{0} time remaining",sw.GetEta(x,y).ToString());
} 
```

希望它对某人有用。

编辑：应该注意，当每个循环花费相同的时间时，这是最准确的。
编辑 2：我创建了一个扩展方法，而不是子类化。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-23T15:47:48.563

通常，您在处理过程中的任何时间点都知道三件事：

1.  到那个时间点 (A) 已经处理了多少个单元/块/项目。
2.  处理这些项目需要多长时间 (B)。
3.  剩余项目数 (C)。

给定这些项目，剩余时间的*估计*（除非处理项目的时间是常数）

B * C / A

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-10-25T09:27:17.950

我做了这个，它工作得很好，随意根据你的变量类型或返回类型更改方法签名，可能你想获得 TimeSpan 对象或只是秒......

```
 /// <summary>
    /// Calculates the eta.
    /// </summary>
    /// <param name="processStarted">When the process started</param>
    /// <param name="totalElements">How many items are being processed</param>
    /// <param name="processedElements">How many items are done</param>
    /// <returns>A string representing the time left</returns>
    private string CalculateEta(DateTime processStarted, int totalElements, int processedElements)
    {
        int itemsPerSecond = processedElements / (int)(processStarted - DateTime.Now).TotalSeconds;
        int secondsRemaining = (totalElements - processedElements) / itemsPerSecond;

        return new TimeSpan(0, 0, secondsRemaining).ToString();
    } 
```

您将需要`DateTime`在处理开始时初始化一个变量，并在每次迭代时将其发送到方法。

不要忘记，如果进程很长，你的窗口可能会被锁定，所以当你将返回值放入控件时，不要忘记使用`.Refresh()`它的方法。

如果您正在使用线程，那么您可以尝试使用该方法设置文本`Invoke(Action)`，使用[此扩展方法](https://stackoverflow.com/questions/8738767/backgroundworker-cross-thread-operation-not-valid/19540412#19540412)可以更轻松地对其进行归档。

如果您使用控制台应用程序，那么您应该不会遇到逐行显示输出的问题。

希望它可以帮助某人。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-23T15:47:11.687

这很大程度上取决于“某物”是什么。如果你可以假设处理每一行的时间是相似的，你可以做一个简单的计算：

```
TimePerLine = Elapsed / LinesProcessed
TotalTime = TimePerLine * TotalLines
TimeRemaining = TotalTime - LinesRemaining * TimePerLine 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-23T15:46:55.087

我知道没有标准算法，我的建议是：

*   创建一个变量来保存 %
*   计算您希望跟踪的任务的复杂性（或估计）
*   考虑到复杂性，不时增加 % 的值。

您可能会看到负载条在某一点上的运行速度比另一点快得多的程序。好吧，这几乎是因为他们就是这样做的。（尽管他们可能只是在主包装器中定期增加增量）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-08-20T08:25:07.673

其中`time$("ms")`表示自 00:00:00.00 以来的当前时间（以毫秒为单位），`lof`表示要处理的总行数，并`x`表示当前行：

```
if Ln>0 then
    Tn=Tn+time$("ms")-Ln   'grand total of all laps
    Rn=Tn*(lof-x)/x^2      'estimated time remaining in seconds
end if
Ln=time$("ms")             'start lap time (current time) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-23T15:44:39.867

这实际上取决于正在做什么......除非每条线花费相同的时间，否则线是不够的。

最好的方法（如果您的行不相似）可能是查看代码的逻辑部分，找出每个部分平均花费多长时间，然后使用这些平均时间来估计进度。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T15:46:03.390

如果你知道完成的百分比，你可以简单地假设时间是线性的，比如

timeLeft = timeSoFar * (1/百分比)

可能会奏效。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-06-25T17:27:05.287

我已经知道完成百分比和经过的时间，所以这对我有帮助：

TimeElapsed * ((100 - %complete) / %complete) = TimeRemaining

然后，每次 %complete 更改时我都会更新此值，从而给我一个恒定变化的 ETA。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-10-09T16:55:53.507

有两种显示时间的方式

1.  已用时间和总体剩余时间：因此已用时间会增加，但剩余时间可能会稳定所需的总时间（如果每秒稳定）

2.  已用时间和剩余时间：
    所以剩余时间 = 所需总时间 - 已用时间

我的想法/公式更可能是这样的：

已处理 - 从正在运行的线程从 0 更新为 Total

我有一个间隔为 1000 毫秒的计时器，它计算每秒处理的时间：

```
processedPerSecond = Processed - lastTickProcessed;
lastTickProcessed = Processed;  //store state from past call 
```

processesPerSecond 和 lastTickProcessed 是定时器方法外的全局变量

现在，如果我们想知道完成处理需要多少秒（在理想的常数假设下） totalSecondsNeeded = TotalLines / PerSecond

但我们想展示案例 2\. TimeLeft 所以 TimeLeftSeconds = (TotalLines - Processed) / PerSecond

```
TimeSpan remaining = new TimeSpan(0, 0, (transactions.Count - Processed) / processedPerSecond);
labelTimeRemaining.Text = remaining.ToString(@"hh\:mm\:ss"); 
```

* * *

当然，如果 PerSecond 跳跃，TimeLeftSeconds 会“跳跃”，所以如果 PerSecond 过去是 10，然后是 30，然后又回到 10，用户会看到它。

有一种计算平均值的方法，但如果进程在最后加速，这可能不会显示实时剩余时间

```
int perSecond = (int)Math.Ceiling((processed / (decimal)timeElapsed.TotalSeconds));  //average not in past second 
```

因此，开发人员可能会选择根据对处理“跳跃”程度的预测来“选择”一种最准确的方法

我们还可以计算并保存每个 PerSecond，然后取最后 10 秒并取平均值，但在这种情况下，用户必须等待 10 秒才能看到第一次计算，或者我们可以显示从每秒第一个开始的剩余时间，然后逐步求平均值到最后 10 秒

我希望我的“跳跃”想法能帮助某人建立令人满意的东西

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-03-03T16:37:01.913

这个怎么样....

我用它浏览了一组记录（在一种情况下，Excel 文件中的行）

L 是当前行号 X 是总行数 dat_Start 在例程开始时设置为 Now()

```
Debug.Print Format((L / X), "percent") & vbTab & "Time to go:" & vbTab & Format((DateDiff("n", dat_Start, Now) / L) * (X - L), "00") & ":" & Format(((DateDiff("s", dat_Start, Now) / L) * (X - L)) Mod 60, "00") 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-08-12T12:36:00.073

PowerShell 函数

```
function CalculateEta([datetime]$processStarted, [long]$totalElements, [long]$processedElements) {
    $itemsPerSecond = $processedElements / [DateTime]::Now.Subtract($processStarted).TotalSeconds
    $secondsRemaining = ($totalElements - $processedElements) / $itemsPerSecond

    return [TimeSpan]::FromSeconds($secondsRemaining)
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-04-10T23:08:54.700

我更喜欢***System.Threading.Timer***而不是*System.Diagnostics.Stopwatch*。

> System.Threading.Timer，在线程池线程上执行单个回调方法

以下代码是使用*Threading.Timer*计算经过时间的示例。

```
public class ElapsedTimeCalculator : IDisposable
{
    private const int ValueToInstantFire = 0;

    private readonly Timer timer;
    private readonly DateTime initialTime;

    public ElapsedTimeCalculator(Action<TimeSpan> action)
    {
        timer = new Timer(new TimerCallback(_ => action(ElapsedTime)));
        initialTime = DateTime.UtcNow;
    }

    // Use Timeout.Infinite if you don't want to set period time.
    public void Fire() => timer.Change(ValueToInstantFire, Timeout.Infinite);

    public void Dispose() => timer?.Dispose();

    private TimeSpan ElapsedTime => DateTime.UtcNow - initialTime;
} 
```

顺便说一句，如果您想模拟和虚拟化单元测试的日期时间，您可以使用 System.Reactive.Concurrency.IScheduler (scheduler.Now.UtcDateTime) 而不是直接使用 DateTime。

```
public class PercentageViewModel : IDisposable
{
    private readonly ElapsedTimeCalculator elapsedTimeCalculator;

    public PercentageViewModel()
    {
       elapsedTimeCalculator = new ElapsedTimeCalculator(CalculateTimeRemaining))
    }

    // Use it where You would like to estimate time remaining.
    public void UpdatePercentage(double percent)
    {
        Percent = percent;
        elapsedTimeCalculator.Fire();
    }

    private void CalculateTimeRemaining(TimeSpan timeElapsed)
    {
        var timeRemainingInSecond = GetTimePerPercentage(timeElapsed.TotalSeconds) * GetRemainingPercentage;

        //Work with calculated time...  
    }

    public double Percent { get; set; }

    public void Dispose() => elapsedTimeCalculator.Dispose();

    private double GetTimePerPercentage(double elapsedTime) => elapsedTime / Percent;

    private double GetRemainingPercentage => 100 - Percent; 
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-06-02T13:01:52.630

在 Python 中：

首先创建一个包含每个条目所用时间的数组，然后计算剩余元素并计算平均所用时间

```
import datetime from datetime
import time

# create average function**
def average(total):
    return float(sum(total)) / max(len(total), 1)

# create array
time_elapsed = []

# capture starting time
start_time = datetime.now()

# do stuff

# capture ending time
end_time = datetime.now()

# get the total seconds from the captured time (important between two days)
time_in_seconds = (end_time - start_time).total_seconds()

# append the time to a array
time_elapsed.append(time_in_seconds)

# calculate the remaining elements, then multiply it with the average time taken
est_time_left = (LastElement - Processed) * average(time_elapsed)

print(f"Estimated time left: {time.strftime('%H:%M:%S', time.gmtime(est_time_left))}") 
```

**`timeit()`带有`k=5000`随机元素和`number=1000`

```
def average2(total):
    avg = 0
    for e in total: avg += e
    return avg / max(len(total),1)

>> timeit average          0.014467999999999925
>> timeit average2         0.08711790000000003
>> timeit numpy.mean:      0.16030989999999967
>> timeit numpy.average:   0.16210096000000003
>> timeit statistics.mean: 2.8182458 
```

# database - 数据库表的泛化与专业化

> ID：473357
> 
> 赞同：7
> 
> 时间：2009-01-23T15:43:34.453
> 
> 标签：database

当我想设计模拟有限父子关系的数据库表时，例如，计算机作为父级，内部的组件作为子级；或简单的组织层次结构，我通常对使用哪种方法感到困惑-

1.  一种“专用表”方法，在该方法中，我为每个可能的实体创建了一个表。在计算机组件示例中，我将有一个 Computer 表和一个 Component 表，其中 ComputerID 作为 FK 在 Component 表中引用回 Computer.ComputerID。或者
2.  一种“通用表方法”，其中我有一个名为 Component 的表，其中 ComponentID 为 PK，ParentComponentID 为 FK，引用其父级的 ComponentID。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T15:50:12.397

我大多数时候选择选项 1 而不是 2 的原因是因为更容易将我的父行从数据库中拉出。否则，您必须编写 sql 语句，以便从具有子行的表中获取行，但只有那些。它很快变得混乱。

如果您正在使用任何常见的关系数据库，请按照设计使用的方式使用它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T15:49:51.680

如果我知道我需要扩展模型以支持层次结构中的新级别，我更喜欢通用表。

通用表的缺点是失去了强类型，我通常通过添加“类型”表（即通用“组件”表的“组件类型”）来解决这个问题。

这允许一个可以扩展的模型，并且仍然提供层次结构中每个组件的强类型。

**编辑：** 马库斯提出了计算机与组件相同的问题。我应该澄清一下，广义表方法应该用于类似的对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T15:54:03.700

当您尝试创建实际上不正确但看起来很优雅的概括时，关系设计存在很大的危险。如果您有一个带有类型字段的通用表，则会引入一种必须在您的代码中解决的间接形式，这会损害性能和代码的清晰度。

另一方面，这种间接性可以有它的用途，出于某些目的，我经常使用它。您必须要问的问题是，计算机和组件是否真的是同一事物的各个方面，或者您是否只是因为听起来不错而将它们混为一谈。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T15:57:01.137

以我的经验，广义表方法很诱人，因为它给了你更多的权力，但从长远来看，你会发现它很难遵循和维护。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T15:50:51.523

两者都使用过，前者肯定更容易被新程序员掌握。在大多数简单的情况下，它也更容易处理。

后者派上用场的地方是事物的层次结构可以改变的地方；或者一个对象改变了它的层次顺序或者层次本身改变了。当层次结构复杂时，它也很有用，因为您不必将其建模为数据库中的表。

# html - 对于图像，使用名称元素有什么好处？名称=“....”

> ID：473364
> 
> 赞同：0
> 
> 时间：2009-01-23T15:45:18.053
> 
> 标签：html

我想知道 alt="" 和 name="" 之间有什么区别

将文件名放在 alt 标签或照片描述中会更好吗？

从 SEO 和验证的角度来看，什么更有意义？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T15:47:57.050

**在搜索引擎优化方面，使用该`ALT`属性更有用。使用 NAME 属性主要用于内部页面锚点。**

例如，该`ALT`属性旨在为使用屏幕阅读器或搜索引擎的人提供描述图像的替代文本。

name 属性主要用于内部锚定，它允许您使用锚点在页面内导航。

**`name`属性的示例用法：**

```
<!-- following ancor can be referenced as http://<your_url>#post-123 -->
<a name="post-123">permanent link to some post</a> 
```

**`alt`属性的示例用法：**

```
<!-- following image shows "FooBar Company Logo" when images can't be shown -->
<img src="logo.jpg" alt="FooBar Company logo" /> 
```

*   有关一般链接的更多信息：http: [//www.w3.org/TR/REC-html40/struct/links.html](http://www.w3.org/TR/REC-html40/struct/links.html)
*   有关如何以及何时使用该`ALT`属性的更多信息，请参阅： [http](http://www.w3.org/QA/Tips/altAttribute) ://www.w3.org/QA/Tips/altAttribute 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T15:54:58.333

*   该`name`属性的存在只是为了提供在 JavaScript 中引用的名称。
*   该`alt`属性为搜索引擎、盲人、无法加载图像等提供替代描述。
*   该`title`属性提供了一个描述，当用户将鼠标悬停在图像上时将显示该描述 - 一些（但不是所有）浏览器将在`alt`没有`title`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T15:49:39.217

我对将文件名放在 ALT 标记中有点谨慎，因为如果图像被关闭，它会显示出来。通常，您将 ALT 标记设置为服务器作为占位符，使用“站点徽标”或其他内容来指示图像是什么。

NAME 标签用于锚定等。如果您想创建一个将长页面滚动到您的图像的链接，您可以通过它来引用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T15:51:33.783

是的，绝对在alt标签中添加描述。这对于视障人士来说非常重要，因为这是屏幕阅读器在看到图像时会阅读的内容。唯一潜在的问题是 alt 标签被某些浏览器视为工具提示文本，但是，您可以通过设置 title="" 来覆盖该行为。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T15:51:59.337

该[`alt`属性](http://www.w3.org/TR/REC-html40/struct/objects.html#adef-alt)旨在为图像提供文本形式的描述性替代方案。因此，如果您有一张显示向日葵的图片，您可以使用：

```
<img src="sunflower.jpg" alt="image of a sunflower on a sunny day"> 
```

该[`name`属性](http://www.w3.org/TR/REC-html40/struct/objects.html#adef-alt)旨在为脚本命名图像，以便您可以使用`images["sunflower"]`. 但是现在您应该改用该`id`属性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T15:53:52.703

您肯定想要使用 ALT 标签 - 出于上述所有原因，并且：根据 W3C，此标签是**强制性**的，因此如果您想创建“兼容代码”（参见例如[w3schools](http://www.w3schools.com/tags/tag_IMG.asp)），则需要它。

# c# - 防止“向 Microsoft 发送错误报告”

> ID：473366
> 
> 赞同：9
> 
> 时间：2009-01-23T15:45:41.423
> 
> 标签：c#, error-handling

我正在做一个相当大的项目，它不太可能会抓住一切。我找到了通知我未处理异常的事件，但是我还没有找到以编程方式关闭 Windows 错误对话框的方法。理想情况下，如果有未处理的异常，我希望触发该事件，提供一个对话框告诉用户存在问题，然后优雅地关闭。有没有办法做到这一点？我意识到我可以将最高层包裹在 try catch 中，但我希望有一些更优雅的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T15:49:13.990

这就是我们所做的。

```
static void Main() {
    try
    {
        SubMain();
    }
    catch (Exception e)
    {
        HandleUnhandledException(e);
    }
}

private static void SubMain()
{
    // Setup unhandled exception handlers
    AppDomain.CurrentDomain.UnhandledException += // CLR
       new UnhandledExceptionEventHandler(OnUnhandledException);
     Application.ThreadException += // Windows Forms
       new System.Threading.ThreadExceptionEventHandler(
           OnGuiUnhandledException);
     Application.EnableVisualStyles();
     Application.SetCompatibleTextRenderingDefault(false);
     Application.Run(new frmMain());
}

// CLR unhandled exception
private static void OnUnhandledException(Object sender,
   UnhandledExceptionEventArgs e)
{
    HandleUnhandledException(e.ExceptionObject);
}

// Windows Forms unhandled exception
private static void OnGuiUnhandledException(Object sender,
   System.Threading.ThreadExceptionEventArgs e)
{
    HandleUnhandledException(e.Exception);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T15:50:09.060

你有点回答了你自己的问题。防止错误对话框的最佳方法是编写处理异常的代码，这样对话框就永远不会出现。我敢打赌这就是 Raymond Chen 的建议（如果我可以这么大胆的话）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T15:49:33.990

[http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception.aspx](http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception.aspx)

虽然如果您将其作为商业项目发布，我鼓励您向 Microsoft 注册，这样您就可以真正获得发送给 MS 的故障转储和错误报告信息

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T21:07:17.100

如果您使用的是 .NET 框架 2.0 或更高版本并且工作线程中存在未处理的异常，我相信您不走运。在 .NET 1.0 和 1.1 中，CLR 只是从主线程以外的线程吞下异常。但是，这在 .NET 2.0 中有所改变，其中线程上未处理的异常会导致应用程序关闭。

您可以订阅 AppDomain.CurrentDomain.UnhandledException 以在发生此类未处理的异常时收到通知，但此时应用程序很可能会关闭，您只是有机会在不可避免的情况发生之前做一些事情，例如在某处记录异常和显示用户友好的消息。UnhandledExceptionEventArgs 有一个名为 IsTerminating 的只读属性，您可以检查该属性以查看应用程序是否正在终止。应用程序终止后，通常会弹出 Microsoft 错误报告对话框。

虽然我不建议这样做，但有一种方法可以通过在应用程序配置文件中设置应用程序兼容性标志来恢复 CLR 1.0 和 1.1 的行为方式。

这不应导致应用程序在出现未处理的异常时终止，并降低获得该错误报告对话框的可能性。

我的建议是仅捕获您在代码中预期并能够处理的异常，并让其他异常冒泡。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T19:41:48.583

如果您的问题与 WinForms 应用程序有关，那么选定的答案将适合您，但它并不完全优雅。

.NET 为这个确切的场景提供了一个助手：

```
Application.SetUnhandledExceptionMode(UnhandledExceptionMode.CatchException)
AddHandler AppDomain.CurrentDomain.UnhandledException, AddressOf CurrentDomain_UnhandledException 
```

[这是有关该方法的 MSDN 文档](http://msdn.microsoft.com/en-us/library/ms157905.aspx)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-01-23T15:52:37.947

您可以尝试使用 HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\AeDebug

该提示来自于 DrWatson 天 .. 可能有效，也可能无效。

# html - IE 字段集背景颜色出血错误

> ID：473374
> 
> 赞同：19
> 
> 时间：2009-01-23T15:47:15.897
> 
> 标签：html, css

**设置：**

> 我有一个带有 fieldset 元素的 HTML 页面。fieldset 元素的背景颜色与页面的背景不同。字段集的边框颜色比背景颜色稍深。

**问题：**

> 在 Firefox 中，只有边框内的区域具有指定的背景颜色。在 IE7 中，背景颜色流过由边框分隔的区域（仅在顶部）。

**问题：**

> 我该怎么做才能使 fieldset 元素的背景保持在 IE7 上由边框分隔的区域内？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-23T16:05:16.253

有关如何解决此问题的信息，请参阅本文：

[http://www.communitymx.com/content/article.cfm?cid=DD9F3](http://www.communitymx.com/content/article.cfm?cid=DD9F3)

**总结：** “由于 IE 的问题似乎源于图例是字段集的子项这一事实，因此修复该错误的方法是将图例与字段集解除关联。图例元素必须嵌套在字段集元素内，当然，为了使 (X)HTML 保持有效，但如果我们绝对定位它，它将从文档流中删除，并由它之外的元素（包括它的父元素）处理，就好像它不存在一样。 "

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-23T15:52:40.067

~~您是否重置了边距和填充？~~

**编辑：**

实际上，Matt Heerema 显然也有类似的问题。他[成功地修复了](http://www.mattheerema.com/web-design/2006/04/getting-fieldset-backgrounds-and-legends-to-behave-in-ie/)它。

“[在 IE 中获取字段集背景和图例](http://www.mattheerema.com/web-design/2006/04/getting-fieldset-backgrounds-and-legends-to-behave-in-ie/)”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-05-08T10:53:11.680

我遇到了同样的问题，一个简单的解决方法是将 fieldset 包装成 a`div`并设置该 div 的背景颜色，而不是将其设置为 fieldset 标记。

# java - 使用 Commons IO 复制时锁定文件

> ID：473379
> 
> 赞同：4
> 
> 时间：2009-01-23T15:47:57.113
> 
> 标签：java, windows, file-io, apache-commons

我正在使用 Apache Commons IO：

```
 FileUtils.copyFileToDirectory(srcFile, destDir) 
```

如何让 Windows 在复制期间锁定目标文件？如果我使用，Windows 会正确锁定文件：

```
 Runtime.getRuntime().exec(
      "cmd /c copy /Y \"" + srcFile.getCanonicalPath() + "\" \""
          + destDir.getCanonicalPath() + "\"").waitFor(); 
```

注意：争用不是本地程序，而是外部程序。正在将文件复制到远程系统。远程系统在完成复制之前正在处理文件。因为系统是 Windows，所以普通副本会锁定文件并阻止外部程序访问。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T16:05:16.450

[java.nio.channels.FileChannel](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html)将允许您使用底层文件系统的本地方法获取文件上的[FileLock](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileLock.html)，假设支持此类功能。

此锁跨机器上的进程运行，甚至是非 java 进程。（实际上，锁是代表特定的 JVM 实例持有的，因此不适合管理一个进程中的多个线程之间的争用，或者同一个 JVM 中的多个进程之间的争用）。

这里有很多警告，但如果您在 Windows 上工作，则值得研究。

从javadoc：

> 此文件锁定 API 旨在直接映射到底层操作系统的本机锁定设施。因此，文件上的锁应该对所有有权访问该文件的程序可见，而不管这些程序是用什么语言编写的。
> 
> 锁是否实际上阻止另一个程序访问锁定区域的内容是系统相关的，因此未指定。某些系统的本机文件锁定工具只是建议性的，这意味着程序必须协同遵守已知的锁定协议以保证数据完整性。在其他系统上，本地文件锁是强制性的，这意味着如果一个程序锁定了文件的某个区域，那么实际上会阻止其他程序以违反锁的方式访问该区域。在其他系统上，本机文件锁是建议性的还是强制性的，可以根据每个文件进行配置。为确保跨平台的一致和正确行为，强烈建议将此 API 提供的锁用作建议锁。
> 
> 在某些系统上，获取文件区域的强制锁定会阻止该区域映射到内存中，反之亦然。结合锁定和映射的程序应该为这种结合失败做好准备。
> 
> 在某些系统上，关闭通道会释放 Java 虚拟机在底层文件上持有的所有锁，无论这些锁是通过该通道还是通过同一文件上打开的另一个通道获得的。强烈建议在程序中使用唯一通道来获取任何给定文件上的所有锁。
> 
> 某些网络文件系统仅在锁定区域是页面对齐的并且是底层硬件页面大小的整数倍时才允许对内存映射文件使用文件锁定。某些网络文件系统不会在超出某个位置（通常为 230 或 231）的区域上实现文件锁定。通常，在锁定驻留在网络文件系统上的文件时应格外小心。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T16:17:40.843

Java 本身不支持文件锁定。

如果文件的争用来自您的程序内部，那么您可能需要在文件副本之上构建额外的同步，以确保并发写入不会相互干扰。但是，如果争用来自软件外部的某个地方，那么您无能为力。您可以尝试将文件写入临时目录，然后重命名它，因为重命名或多或少是原子的（取决于文件系统）。

这将有助于获得有关为什么首先需要锁定文件的更多信息。

> 争论不在于本地程序，而在于外部程序。正在将文件复制到远程系统。远程系统在完成复制之前正在处理文件。因为系统是 Windows，所以普通副本会锁定文件并阻止外部程序访问。

在这种情况下，您应该尝试写入临时文件，然后在文件完全复制后重命名。文件重命名是原子操作（在非网络文件系统上），因此它应该适合您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T16:26:24.710

复制文件时，请始终复制到临时文件名，并在完成写入后重命名文件。这样，另一个进程永远不会看到损坏的文件。

更好的是，您可以写入 *.tmp。然后检查目标文件是否存在。将 dest 文件重命名为 *.bak（如果存在）。最后重命名 *.tmp -> dest。

# debugging - IDebugSymbols::GetNameByOffset 和重载函数

> ID：473389
> 
> 赞同：2
> 
> 时间：2009-01-23T15:49:43.943
> 
> 标签：debugging, windbg, dbgeng

我正在使用[IDebugSymbols::GetNameByOffset](http://msdn.microsoft.com/en-gb/library/cc266210.aspx)并且我发现对于重载相同名称的不同函数，我得到了相同的符号名称。

例如，我正在查找符号的代码可能如下：

```
void SomeFunction(int) {..}
void SomeFunction(float) {..} 
```

在运行时，当我从每个函数中获得指令的地址时，我想使用`GetNameByOffset`并以某种方式将两者区分开来。我已经尝试调用[SetSymbolOptions 来](http://msdn.microsoft.com/en-gb/library/cc266213.aspx)切换[此处](http://msdn.microsoft.com/en-gb/library/cc266462.aspx)`SYMOPT_UNDNAME`记录的和`SYMOPT_NO_CPP`标志，但这不起作用。

有谁知道如何在调试器引擎世界中区分这些符号？

* * *

**编辑：**请参阅我对已接受答案的评论，以对提议的解决方案进行小幅修改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T20:21:07.313

引自 dbgeng.h：

```
    // 交易品种名称可能不是唯一的，尤其是
    // 当重载函数存在时
    // 具有相同的名称。如果 GetOffsetByName
    // 为它的名字找到多个匹配项
    // 可以返回其中任何一个。在那里面
    // 如果它会返回 S_FALSE 来表示
    // 这个歧义被任意解决了。
    // 然后调用者可以使用 SearchSymbols 来
    // 如果需要，查找所有匹配项
    // 执行不同的消歧。
    标准方法（GetOffsetByName）（
        这_
        __在 PCSTR 符号中，
        __out PULONG64 偏移量
        ） 纯的;

```

所以，我会用 IDebugSymbols::GetNameByOffset() 获得名称（我相信它会像“module！name”一样返回），使用 IDebugSymbols::GetOffsetByName() 确保它是一个重载（如果你不确定）（它应该为多个重载返回 S_FALSE），并使用 StartSymbolMatch()/EndSymbolMatch() 查找具有此名称的所有可能性。虽然不是一个班轮（而且对这件事没有真正的帮助......）

另一种选择是与

```
结果
  IDebugSymbols3::GetFunctionEntryByOffset(
    在 ULONG64 偏移中，
    在 ULONG 标志中，
    OUT 可选的 PVOID 缓冲区，
    在 ULONG BufferSize 中，
    OUT OPTIONAL PULONG BufferNeeded
    );
// 它可用于检索特定函数的 FPO 数据：
FPO_DATA fpo;
HRESULT hres=m_Symbols3->GetFunctionEntryByOffset(
        addr, // 偏移量
        0, // 标志
        &fpo, // 缓冲区
        sizeof(fpo), // 缓冲区大小
        0 // 需要缓冲
        ));

```

然后使用 fpo.cdwParams 进行基本参数大小区分（cdwParams=参数大小）

# iphone - Does the Photos App register a URL Handler on the iPhone?

> ID：473393
> 
> 赞同：2
> 
> 时间：2009-01-23T15:50:19.340
> 
> 标签：iphone

I have read the Apple documentation. They list the apps registered, yet in their example they use a handler not mentioned. [https://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/chapter_3_section_6.html](https://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/chapter_3_section_6.html)

This post attempts to list the handlers. But it too appears incomplete since the iPod handler is not listed. [http://quinagh.com/applookup/index.php/2009/01/07/iphone-apps-with-special-url-shortcuts/](http://quinagh.com/applookup/index.php/2009/01/07/iphone-apps-with-special-url-shortcuts/)

Is there a complete list available? Does anyone know if the Photos app has a registered handler or not for certain?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T15:57:50.370

There is, afaik, no way to tell beyond those that are documented.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-14T16:25:57.803

[http://arstechnica.com/apple/guides/2009/03/building-services-into-iphone-applications.ars](http://arstechnica.com/apple/guides/2009/03/building-services-into-iphone-applications.ars)

# objective-c - 示例 Cocoa 应用程序，引用计数，[pool drain] 产生 EXC_BAD_ACCESS？

> ID：473397
> 
> 赞同：2
> 
> 时间：2009-01-23T15:50:38.513
> 
> 标签：objective-c, cocoa, xcode

我正在研究[Mac OS X（第 3 版）的 Cocoa Programming](https://rads.stackoverflow.com/amzn/click/com/0321503619)，在第 4 章中我编写了这个应用程序：

```
int main (int argc, const char * argv[]) {
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];

    //create the date object
    NSCalendarDate *now = [[NSCalendarDate alloc] init];

    //seed random # generator
    srandom(time(NULL));

    NSMutableArray *array;
    array = [[NSMutableArray alloc] init];
    int i;
    for (i=0; i<10; i++){
        //create a date/time that is 'i' weeks from now
        NSCalendarDate *iWeeksFromNow;
        iWeeksFromNow = [now dateByAddingYears:0
                                        months:0
                                          days:(i*7)
                                         hours:0
                                       minutes:0
                                       seconds:0];

        //create a new instance of lottery entry
        LotteryEntry *entry = [[LotteryEntry alloc] init];
        [entry setEntryDate:iWeeksFromNow];

        [array addObject:entry];
        [entry release];
    }
    [now release];
    now = nil;

    for (LotteryEntry *entryToPrint in array) {
        NSLog(@"%@", entryToPrint);
    }
    [array release];
    array = nil;

    NSLog(@"about to drain the pool... (%@)", pool);
    [pool drain];
    NSLog(@"done");
    NSLog(@"GC = %@", [NSGarbageCollector defaultCollector]);
    return 0;
} 
```

LotteryEntry 类如下所示：

```
@implementation LotteryEntry

- (void)setEntryDate:(NSCalendarDate *)date
{
    entryDate = date;
}

- (NSCalendarDate *)entryDate
{
    return entryDate;
}

- (int)firstNumber
{
    return firstNumber;
}

- (int)secondNumber
{
    return secondNumber;
}

- (id)init
{
    return [self initWithDate:[NSCalendarDate calendarDate]];
}

- (id)initWithDate:(NSCalendarDate *)date
{
    if(![super init])
        return nil;

    NSAssert(date != nil, @"Argument must be non-nil");

    firstNumber = random() % 100 + 1;
    secondNumber = random() % 100 + 1;
    entryDate = [date retain];  
    return self;
}

- (NSString *)description
{
    NSString *result;
    result = [[NSString alloc] initWithFormat:@"%@ = %d and %d",
              [entryDate descriptionWithCalendarFormat:@"%b %d %Y"],
              firstNumber,
              secondNumber];
    return result;
}

- (void)dealloc
{
    NSLog(@"deallocating %@", self);
    [entryDate release];
    [super dealloc];
}

@end 
```

如您所见，我在这里保留和释放对象。我很确定我的代码与书中的代码相匹配，但是当我运行应用程序时，在 [pool drain] 处我收到以下消息：

> 程序接收信号：“EXC_BAD_ACCESS”。

我不确定是什么原因造成的。我希望这是我错过的一些愚蠢的事情，但我肯定会欣赏其他几双眼睛。提前致谢！

（旁注：我是 .NET 开发人员，所以引用计数对我来说很陌生！）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T16:17:31.267

看起来您在此方法中也有错误：

```
- (id)initWithDate:(NSCalendarDate *)date
{
    if(![super init])
        return nil;

    NSAssert(date != nil, @"Argument must be non-nil");

    firstNumber = random() % 100 + 1;
    secondNumber = random() % 100 + 1;
    entryDate = [date retain];  
    return self;
} 
```

您实际上是在丢弃 [super init] 的结果，虽然在这种情况下它可能不是问题，但它可能会在其他情况下导致严重问题。您应该“始终”构造您的初始化方法，如下所示：

```
- (id)initWithDate:(NSCalendarDate *)date
{
    if(self = [super init]) {
        NSAssert(date != nil, @"Argument must be non-nil");

        firstNumber = random() % 100 + 1;
        secondNumber = random() % 100 + 1;
        entryDate = [date retain];
}
return self; 
```

如果你不打算从一个 init 方法返回 self（例如它是一个工厂或类似的奇怪的东西），你应该记住释放 self。已经分配了，不归还就不能正常释放。例子：

```
- (id) init
{
    NSObject*    newSelf = [[NSObject alloc] init];

    [self release];
    return newSelf;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T15:55:50.140

哦！只是输入代码让我意识到我的问题。当这种情况发生时，Doncha 喜欢它吗？

我在我的 中保留日期`init`，但我仍然有那个`setEntryDate`没有调用保留的额外方法。删除它并调用该`initWithDate`方法似乎可以解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T16:04:07.503

它与您手头的问题无关，但您应该避免使用`NSCalendarDate`，它已经被弃用了一段时间，并且可能很快就会从 API 中完全删除。

# java - 获取 JUnit 4 中当前正在执行的测试的名称

> ID：473401
> 
> 赞同：257
> 
> 时间：2009-01-23T15:51:14.267
> 
> 标签：java, unit-testing, junit

在 JUnit 3 中，我可以像这样获取当前正在运行的测试的名称：

```
public class MyTest extends TestCase
{
    public void testSomething()
    {
        System.out.println("Current test is " + getName());
        ...
    }
} 
```

这将打印“当前测试是 testSomething”。

在 JUnit 4 中是否有任何开箱即用或简单的方法可以做到这一点？

背景：显然，我不想只打印测试的名称。我想加载存储在与测试同名的资源中的测试特定数据。你知道，[约定优于配置](http://en.wikipedia.org/wiki/Convention_over_Configuration)等等。

* * *

## 回答 #1

> 赞同：413
> 
> 时间：2009-09-15T11:59:51.810

JUnit 4.7 添加了这个似乎使用[TestName-Rule 的](https://github.com/junit-team/junit/wiki/Rules#testname-rule)功能。看起来这将为您提供方法名称：

```
import org.junit.Rule;

public class NameRuleTest {
    @Rule public TestName name = new TestName();

    @Test public void testA() {
        assertEquals("testA", name.getMethodName());
    }

    @Test public void testB() {
        assertEquals("testB", name.getMethodName());
    }
} 
```

* * *

## 回答 #2

> 赞同：126
> 
> 时间：2012-12-21T09:57:04.923

# JUnit 4.9.x 及更高版本

自 JUnit 4.9 起，[`TestWatchman`](http://junit.org/javadoc/latest/org/junit/rules/TestWatchman.html)该类已被弃用，取而代之的是[`TestWatcher`](http://junit.org/javadoc/latest/org/junit/rules/TestWatcher.html)具有调用的类：

```
@Rule
public TestRule watcher = new TestWatcher() {
   protected void starting(Description description) {
      System.out.println("Starting test: " + description.getMethodName());
   }
}; 
```

注意：必须声明包含类`public`。

# JUnit 4.7.x - 4.8.x

以下方法将为类中的所有测试打印方法名称：

```
@Rule
public MethodRule watchman = new TestWatchman() {
   public void starting(FrameworkMethod method) {
      System.out.println("Starting test: " + method.getName());
   }
}; 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2016-12-25T13:00:00.167

# JUnit 5 及更高版本

在**JUnit 5**中，您可以注入`TestInfo`简化了测试元数据注入到测试方法的过程。例如：

```
@Test
@DisplayName("This is my test")
@Tag("It is my tag")
void test1(TestInfo testInfo) {
    assertEquals("This is my test", testInfo.getDisplayName());
    assertTrue(testInfo.getTags().contains("It is my tag"));
} 
```

查看更多：[JUnit 5 用户指南](https://junit.org/junit5/docs/current/user-guide/)，[TestInfo javadoc](https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/TestInfo.html)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-04-19T21:17:43.590

试试这个：

```
public class MyTest {
        @Rule
        public TestName testName = new TestName();

        @Rule
        public TestWatcher testWatcher = new TestWatcher() {
            @Override
            protected void starting(final Description description) {
                String methodName = description.getMethodName();
                String className = description.getClassName();
                className = className.substring(className.lastIndexOf('.') + 1);
                System.err.println("Starting JUnit-test: " + className + " " + methodName);
            }
        };

        @Test
        public void testA() {
                assertEquals("testA", testName.getMethodName());
        }

        @Test
        public void testB() {
                assertEquals("testB", testName.getMethodName());
        }
} 
```

输出如下所示：

```
Starting JUnit-test: MyTest testA
Starting JUnit-test: MyTest testB 
```

注意：如果您的测试是**TestCase的子类，这将*****不起作用***！测试运行，但**@Rule**代码永远不会运行。

 ***** * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-12-29T10:05:52.940

考虑使用 SLF4J（Java 的简单日志记录外观）使用参数化消息提供了一些巧妙的改进。将 SLF4J 与 JUnit 4 规则实现相结合可以提供更有效的测试类日志记录技术。

```
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.MethodRule;
import org.junit.rules.TestWatchman;
import org.junit.runners.model.FrameworkMethod;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class LoggingTest {

  @Rule public MethodRule watchman = new TestWatchman() {
    public void starting(FrameworkMethod method) {
      logger.info("{} being run...", method.getName());
    }
  };

  final Logger logger =
    LoggerFactory.getLogger(LoggingTest.class);

  @Test
  public void testA() {

  }

  @Test
  public void testB() {

  }
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-16T21:45:02.533

一个复杂的方法是通过继承 org.junit.runners.BlockJUnit4ClassRunner 创建自己的 Runner。

然后，您可以执行以下操作：

```
public class NameAwareRunner extends BlockJUnit4ClassRunner {

    public NameAwareRunner(Class<?> aClass) throws InitializationError {
        super(aClass);
    }

    @Override
    protected Statement methodBlock(FrameworkMethod frameworkMethod) {
        System.err.println(frameworkMethod.getName());
        return super.methodBlock(frameworkMethod);
    }
} 
```

然后对于每个测试类，您需要添加一个 @RunWith(NameAwareRunner.class) 注释。或者，如果您不想每次都记住它，可以将该注释放在 Test 超类上。当然，这会限制您对跑步者的选择，但这可能是可以接受的。

此外，从 Runner 中获取当前测试名称并进入您的框架可能需要一点功夫，但这至少可以让您获得名称。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-23T15:57:44.567

JUnit 4 没有任何开箱即用的机制让测试用例获得自己的名称（包括在设置和拆卸期间）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-12-30T23:05:05.233

```
String testName = null;
StackTraceElement[] trace = Thread.currentThread().getStackTrace();
for (int i = trace.length - 1; i > 0; --i) {
    StackTraceElement ste = trace[i];
    try {
        Class<?> cls = Class.forName(ste.getClassName());
        Method method = cls.getDeclaredMethod(ste.getMethodName());
        Test annotation = method.getAnnotation(Test.class);
        if (annotation != null) {
            testName = ste.getClassName() + "." + ste.getMethodName();
            break;
        }
    } catch (ClassNotFoundException e) {
    } catch (NoSuchMethodException e) {
    } catch (SecurityException e) {
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-06-23T15:51:38.087

基于之前的评论并进一步考虑，我创建了 TestWather 的扩展，您可以在 JUnit 测试方法中使用它：

```
public class ImportUtilsTest {
    private static final Logger LOGGER = Logger.getLogger(ImportUtilsTest.class);

    @Rule
    public TestWatcher testWatcher = new JUnitHelper(LOGGER);

    @Test
    public test1(){
    ...
    }
} 
```

测试助手类是下一个：

```
public class JUnitHelper extends TestWatcher {
private Logger LOGGER;

public JUnitHelper(Logger LOGGER) {
    this.LOGGER = LOGGER;
}

@Override
protected void starting(final Description description) {
    LOGGER.info("STARTED " + description.getMethodName());
}

@Override
protected void succeeded(Description description) {
    LOGGER.info("SUCCESSFUL " + description.getMethodName());
}

@Override
protected void failed(Throwable e, Description description) {
    LOGGER.error("FAILURE " + description.getMethodName());
}
} 
```

享受！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-08-12T16:09:36.540

在 JUnit 5[`TestInfo`](https://junit.org/junit5/docs/current/api/org/junit/jupiter/api/TestInfo.html)中，作为 JUnit 4 中 TestName 规则的替代品。

从文档中：

> TestInfo 用于将有关当前测试或容器的信息注入到 @Test、@RepeatedTest、@ParameterizedTest、@TestFactory、@BeforeEach、@AfterEach、@BeforeAll 和 @AfterAll 方法中。

要检索当前执行的测试的方法名称，您有两个选项： `String TestInfo.getDisplayName()`和 `Method TestInfo.getTestMethod()`。

仅检索当前测试方法的名称 `TestInfo.getDisplayName()`可能还不够，因为测试方法的默认显示名称是`methodName(TypeArg1, TypeArg2, ... TypeArg3)`.
复制方法名称`@DisplayName("..")`并不是一个好主意。

作为替代方案，您可以使用 `TestInfo.getTestMethod()`它返回一个`Optional<Method>`对象。
如果检索方法在测试方法中使用，您甚至不需要测试`Optional`包装的值。

```
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.TestInfo;
import org.junit.jupiter.api.Test;

@Test
void doThat(TestInfo testInfo) throws Exception {
    Assertions.assertEquals("doThat(TestInfo)",testInfo.getDisplayName());
    Assertions.assertEquals("doThat",testInfo.getTestMethod().get().getName());
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-03-25T02:25:57.020

## JUnit 5 通过 ExtensionContext

**优势：**

您可以`ExtensionContext`通过覆盖`afterEach(ExtensionContext context)`.

```
public abstract class BaseTest {

    protected WebDriver driver;

    @RegisterExtension
    AfterEachExtension afterEachExtension = new AfterEachExtension();

    @BeforeEach
    public void beforeEach() {
        // Initialise driver
    }

    @AfterEach
    public void afterEach() {
        afterEachExtension.setDriver(driver);
    }

} 
```

```
public class AfterEachExtension implements AfterEachCallback {

    private WebDriver driver;

    public void setDriver(WebDriver driver) {
        this.driver = driver;
    }

    @Override
    public void afterEach(ExtensionContext context) {
        String testMethodName = context.getTestMethod().orElseThrow().getName();
        // Attach test steps, attach scsreenshots on failure only, etc.
        driver.quit();
    }

} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-10-12T13:13:04.333

```
@ClassRule
public static TestRule watchman = new TestWatcher() {
    @Override
    protected void starting( final Description description ) {
        String mN = description.getMethodName();
        if ( mN == null ) {
            mN = "setUpBeforeClass..";
        }

        final String s = StringTools.toString( "starting..JUnit-Test: %s.%s", description.getClassName(), mN );
        System.err.println( s );
    }
}; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-24T21:03:40.500

我建议您将测试方法名称与测试数据集分离。我将建模一个 DataLoaderFactory 类，该类从您的资源中加载/缓存测试数据集，然后在您的测试用例中调用一些接口方法，该方法返回一组测试用例的测试数据。将测试数据绑定到测试方法名称假设测试数据只能使用一次，在大多数情况下，我建议在多个测试中使用相同的测试数据来验证业务逻辑的各个方面。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-04-14T04:52:58.483

您可以使用`Slf4j`和`TestWatcher`

```
private static Logger _log = LoggerFactory.getLogger(SampleTest.class.getName());

@Rule
public TestWatcher watchman = new TestWatcher() {
    @Override
    public void starting(final Description method) {
        _log.info("being run..." + method.getMethodName());
    }
}; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-23T01:11:18.630

我有一个扩展 TestCase 的 Junit4 测试类，因此 @Rule 的示例不起作用（如其他答案中所述）。

但是，如果您的类扩展了 TestCase，您可以使用 getName() 来获取当前的测试名称，这样就可以了：

```
@Before
public void setUp() {
  System.out.println("Start test: " + getName());
}

@After
public void tearDown() {
  System.out.println("Finish test: " + getName());
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-12-02T19:09:39.430

我通常使用这样的东西：

```
/** Returns text with test method name
    @param offset index of method on call stack to print, 1 for a caller of this method.
    */
    static String getName(int offset)
    { 
        Throwable t = new Throwable();
        t.fillInStackTrace();
        return 
               t.getStackTrace()[offset].getMethodName()+":"+t.getStackTrace()[offset].getLineNumber(); 
    }; 
```

这正是打印堆栈跟踪时使用的异常。根据确切的上下文您可能必须找出正确的偏移值。它粗犷而原始坚韧，没有使用任何花哨的现代期货。

# sql-server - 在 SQL Server 2005 中对分层查询进行排序

> ID：473420
> 
> 赞同：7
> 
> 时间：2009-01-23T15:54:32.187
> 
> 标签：sql-server, sql-server-2005, common-table-expression, hierarchical

我有以下问题：我有一个用于维护分层数据的表。我想使用 SQL 2005 中的 CTE。

```
WITH tree (id, parentid, code, name) AS
(
    SELECT id, ofs.ParentID, ofs.code, ofs.name
      FROM OrganizationFeatures ofs
     WHERE ofs.ParentID IS NULL

    UNION ALL

    SELECT ofs.id, ofs.ParentID, ofs.code, ofs.name
      FROM OrganizationFeatures ofs
      JOIN tree ON tree.ID = ofs.ParentID
)

select * from tree 
```

但我想按代码排序，结果如下：

```
1
1/1
1/1/1
1/1/2
1/2/1
1/2/2
2
4/1 
```

等等有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T16:00:55.933

要获得连接的值，您需要在 with 中进行。

要进行排序，您需要在最后一个选择中添加排序依据。

```
WITH tree (id, parentid, code, name) AS
(
    SELECT id, ofs.ParentID, ofs.code, ofs.name
      FROM OrganizationFeatures ofs
     WHERE ofs.ParentID IS NULL

    UNION ALL

    SELECT ofs.id, ofs.ParentID, tree.code+'/'+ofs.code, ofs.name
      FROM OrganizationFeatures ofs
      JOIN tree ON tree.ID = ofs.ParentID
)

select * from tree order by code 
```

此外，如果代码不是 varchar，则必须转换这段代码 ( `tree.code+'/'+ofs.code`) 中的代码列才能使其工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T21:04:56.340

Loki，我有类似的查询，但它没有按我想要的名称排序，而是按代码排序 - 这是星期五，我超载了。

无论如何，运行您的查询给了我一个错误，有必要强制转换；我不得不按照以下方式更改它：

```
WITH tree (id, parentid, name, code) AS
(
    SELECT id, ofs.ParentID, ofs.name, CAST(ofs.name as varchar(255))
      FROM OrganizationFeatures ofs
     WHERE ofs.ParentID IS NULL

    UNION ALL

    SELECT ofs.id, ofs.ParentID, ofs.name, CAST(tree.code+'/'+ofs.name as varchar(255))
      FROM OrganizationFeatures ofs
      JOIN tree ON tree.ID = ofs.ParentID
)

select * from tree order by code 
```

问题是尽管名称是 varchar，但仍需要强制转换为 varchar。很可能 varchar(255) 不足以处理大树。

所以我做了一个版本，上面提到的问题不是那么大：

```
WITH tree (id, parentid, name, code) AS
(
    SELECT id, ofs.ParentID, ofs.name, 
           CAST(ROW_NUMBER() OVER (ORDER BY ofs.name ASC) as varchar(255)) 
      FROM OrganizationFeatures ofs
     WHERE ofs.ParentID IS NULL

    UNION ALL

    SELECT ofs.id, ofs.ParentID, ofs.name, 
           CAST(tree.code +'/' + CAST(ROW_NUMBER() OVER (ORDER BY ofs.name ASC) as varchar(255)) as varchar(255))
      FROM OrganizationFeatures ofs
      JOIN tree ON tree.ID = ofs.ParentID
)

select * from tree order by code 
```

但我不喜欢这种需要强制转换的解决方案。有没有更好的解决方案？

# flexbuilder - Flex Builder 3：语法着色，添加关键字

> ID：473435
> 
> 赞同：0
> 
> 时间：2009-01-23T15:58:38.777
> 
> 标签：flexbuilder, syntax-highlighting

我想知道在哪里可以为 Flex Builder 中的语法着色添加关键字 - 为了我自己的理智，我需要对其进行一些扩展。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T16:14:27.717

窗口 > Flex > 编辑器 > 语法着色

如果您在构建 Flex 应用程序时寻求理智，请尝试 flashdevelop (flashdevelop.org)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T16:17:27.163

我不认为你可以。我无法在设置或随应用程序安装的文件中找到可以更改关键字列表的任何位置。

正如另一张海报所说，试试 FlashDevelop。我比 FlexBuilder 更喜欢它。

# database - 如何传输数据库和站点内容

> ID：473440
> 
> 赞同：0
> 
> 时间：2009-01-23T16:02:06.057
> 
> 标签：database, web-services

我拥有一个包含 20 GB 数据的网站现在我决定更改托管公司。我正在迁移到俄罗斯 VPS，所以有没有办法将我的网站内容传输到俄罗斯 VPS，而无需再次上传。

有没有这样的服务。我听说有一种方法可以使用 shell 访问来做到这一点（但是什么是 shell 访问以及它是如何工作的）thanx 提前伙计们

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:18:06.537

您可以使用 SSH 连接登录到旧主机，然后从那里连接到新主机，再次使用 SSH 连接，然后将所有文件从第一台服务器上传到第二台。对于数据库，在您的第一台服务器上进行数据转储，然后通过 SSH 连接，针对新服务器上的数据库运行数据转储。

根据主机的不同，您通过 SSH 连接的方式会有所不同，但应该有提供者提供的说明。如果您找不到方向，只需向提供商​​的支持发送电子邮件并询问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T16:17:51.937

如果您可以访问服务器本身，您可以从新服务器 ftp 进入您的旧站点，并从新服务器下载所有数据，而无需下载到个人计算机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:18:03.573

如果您当前的提供商支持 FTP，您可以从新 VPS 向当前 FTP 站点发出 FTP 命令。如果您的数据在数据库中 - 备份和传输备份。

您无法避免 40Gb 的传输（20 个来自旧站点，20 个来自新站点）。

这是使 Amazon S3 成为好东西的原因之一。

# c# - 有没有一种快速的方法来删除 C# 中的 using 语句？

> ID：473443
> 
> 赞同：6
> 
> 时间：2009-01-23T16:02:16.727
> 
> 标签：c#, visual-studio-2008, namespaces, using-statement

有没有一种快速的方法来确定您是否在应用程序中使用某些命名空间。我想删除所有不必要的 using 语句，例如 using System.Reflection 等，但我需要一种方法来确定我是否正在使用这些库。我知道 Resharper 工具可以为您执行此操作，但是有没有一种快速、肮脏且免费的方法来执行此操作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-23T16:03:30.203

Visual Studio 2008 也会为您执行此操作，右键单击您的类文件并选择“组织使用”->“删除和排序”。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-23T16:06:19.650

Visual Studio 2008 + [PowerCommmands](http://code.msdn.microsoft.com/PowerCommands) = 在整个解决方案中删除和排序使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T16:04:37.737

VS2008 可以在每个文件的基础上做到这一点。

右键单击源代码，选择“Organize Usings”、“Remove Unused Usings”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T09:40:27.657

我刚刚注意到你的 vs2008 标签，但是对于那些没有 VS2008 的人，你可以在 Resharper 中获得类似的功能。

# c# - Silverlight Toolkit TreeView 控件和可扩展性

> ID：473444
> 
> 赞同：2
> 
> 时间：2009-01-23T16:02:32.590
> 
> 标签：c#, silverlight, treeview, hierarchicaldatatemplate

是否可以在 Silverlight takeit 中配置 TreeView 控件，以便部分或所有层次结构级别将自动展开，并且理想情况下在该级别上不能折叠。

我之所以使用此控件，很大程度上是因为易于处理分层数据以及我可以轻松展开/折叠级别。我被要求有选择地执行此操作（即仅在第一级我应该允许展开/折叠）。我正在检查分层数据模板以尝试实现这一点，但运气不佳，如果需要，肯定会考虑其他选项，包括完全不同的控件。我的老板确实希望我尽可能避免购买控件。

提前致谢。

干杯，

史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T23:04:54.630

仅供社区参考。[我在这里](http://silverlight.net/forums/t/68462.aspx)得到并回答了这个问题。结果是这可以通过数据模板和样式的组合来完成。

# terminology - 一对一与一对多的替代名称

> ID：473445
> 
> 赞同：0
> 
> 时间：2009-01-23T16:02:52.217
> 
> 标签：terminology, cardinality

一对一和一对多关系是否存在普遍接受的计算机科学术语？类似于术语“聚合”、“泛化”和“关联”但严格与关系的基数有关的东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T16:06:11.663

从我读过的所有内容中`one-to-one`，`one-to-many`, 等是指代这些关系的公认方式。他们对他们的内容非常自我描述。

# java - Java当前机器名和登录用户？

> ID：473446
> 
> 赞同：168
> 
> 时间：2009-01-23T16:02:54.510
> 
> 标签：java, environment

是否可以获得当前登录用户的名称（Windows/Unix）和机器的主机名？

我认为它只是一些静态环境类的属性。

我为用户名找到了这个

```
com.sun.security.auth.module.NTSystem NTSystem = new
        com.sun.security.auth.module.NTSystem();
System.out.println(NTSystem.getName()); 
```

这对于机器名称：

```
import java.net.InetAddress;
...
String computerName;
...
try {
    computerName = InetAddress.getLocalHost().getHostName();
}

catch(Exception ex) {
    ...
} 
```

第一个仅适用于Windows吗？

如果您没有设置主机名，第二个会做什么？

* * *

## 回答 #1

> 赞同：271
> 
> 时间：2009-01-23T16:08:23.220

获取当前登录的用户：

```
System.getProperty("user.name"); //platform independent 
```

和机器的主机名：

```
java.net.InetAddress localMachine = java.net.InetAddress.getLocalHost();
System.out.println("Hostname of local machine: " + localMachine.getHostName()); 
```

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2009-01-23T16:28:48.747

获取当前登录的用户：

```
System.getProperty("user.name"); 
```

获取机器的主机名：

```
InetAddress.getLocalHost().getHostName(); 
```

为了回答您问题的最后一部分，[Java API](http://docs.oracle.com/javase/6/docs/api/java/net/InetAddress.html#getHostName%28%29)说 getHostName() 将返回

> 此 IP 地址的主机名，或者如果安全检查不允许该操作，则为 IP 地址的文本表示。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-09-24T12:58:10.647

使用`user.name`不安全，因为可以伪造环境变量。您使用的方法很好，基于 unix 的操作系统也有类似的方法

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-10-27T12:03:29.970

获取当前登录的用户路径：

```
System.getProperty("user.home"); 
```

# iis-7 - 如何在 vista/IIS7 上编辑 c:/inetpub/wwwroot/testsite 中的文件？

> ID：473449
> 
> 赞同：2
> 
> 时间：2009-01-23T16:03:53.417
> 
> 标签：iis-7, windows-vista

我已经安装了 IIS7，并且有一个简单的网站：

c:/inetpub/wwwroot/testsite

我可以将文件复制到那里，但我不能编辑它们：

*   我可以打开它们，但无法将它们保存回来
*   文件本身没有写保护
*   文件夹本身（“testsite”）被写保护，所以我关闭了写保护（右键单击，属性，取消选中只读，以管理员身份继续，等等）它假装改变它，但总是设置它返回只读

在 Vista 上的 IIS7 上编辑 Web 文件的操作方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:18:42.387

你有几个选择：

1.  替换整个文件夹的权限。
2.  以管理员身份登录并执行您需要的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T04:24:16.570

另请注意，c:/inetpub/wwwroot 目录受 UAC 保护。

# ruby - Ruby 字符串可变性

> ID：473450
> 
> 赞同：9
> 
> 时间：2009-01-23T16:03:53.867
> 
> 标签：ruby, string

这可能是一个小问题，我最近一直在努力提高 ruby​​，并开始阅读精彩[的 The Ruby Programming Language](http://oreilly.com/catalog/9780596516178/)。提到的是字符串文字被认为是可变的，因此在循环中最好使用变量而不是文字，因为每次迭代都会实例化一个新字符串。

我的问题是为什么？起初我以为是因为插值，但符号是不可变的，它们支持插值。来自静态背景，对我来说并没有多大意义。

编辑：

在阅读[了thenduks的](https://stackoverflow.com/users/210/thenduks)答案后，我想我可能有它。AFAIK，像 Java 或 C# 这样的语言没有破坏性的字符串方法（它们使用大写，但不是大写！）。因为大写之类的东西！或 <<，文字不能是不可变的。

对此不是 100% 确定的，另一种可能性是发生了编译时实习，这在脚本语言中是不会发生的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T16:11:40.873

不太确定您的问题到底是什么，但请考虑以下代码：

```
10.times { puts "abc".object_id } 
```

这会打印出 10 个不同的 id。为什么？仅仅因为你知道这个字符串不会改变并不意味着 Ruby 会改变。如果您认为`"abc"`应该只创建一次，那么如果您这样做会发生什么：

```
10.times { puts "abc".upcase! } 
```

该`upcase!`方法将字符串变为大写，在下一次迭代中，在第一次迭代中创建的字符串不再相同。

也许发布一个让您感到困惑的代码示例？

# .net - 如何在 StructureMap AutoMocker 中使用 Record/Playback 语法？

> ID：473454
> 
> 赞同：2
> 
> 时间：2009-01-23T16:05:09.293
> 
> 标签：.net, tdd, mocking, structuremap, rhino-mocks

是否可以使用语法

```
using(_mocks.Record())
{
   //...
}
using(_mocks.Playback())
{
   //...
} 
```

使用 StructureMap RhinoAutoMocker？

在 Jeremy Millers[在 StructureMap 2.5 中的原始帖子 AutoMocker 中，](http://codebetter.com/blogs/jeremy.miller/archive/2008/02/09/automocker-in-structuremap-2-5.aspx)这似乎是可能的，因为 RhinoAutoMocker 继承了 MockRepository，但在 StructureMap 的 2.5.2 版本中，这似乎以稍微不同的方式实现。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T09:54:09.873

我终于使用自定义编写的 AutoMocker 和 ServiceLocator 解决了这个问题。

```
public class RecordPlaybackRhinoAutoMocker<TARGETCLASS> : AutoMocker<TARGETCLASS> where TARGETCLASS : class
{
    private RecordPlaybackMocksServiceLocator MockRepository 
    { 
        get 
        { 
            return _serviceLocator as RecordPlaybackMocksServiceLocator; 
        } 
    }

    public RecordPlaybackRhinoAutoMocker()
    {
        _serviceLocator = new RecordPlaybackMocksServiceLocator();
        _container = new AutoMockedContainer(_serviceLocator);
    }

    public IDisposable Record()
    {
        return MockRepository.Record();
    }

    public IDisposable Playback()
    {
        return MockRepository.Playback();
    }
}

public class RecordPlaybackMocksServiceLocator : StructureMap.AutoMocking.ServiceLocator
{

    private readonly MockRepository _mocks;

    public RecordPlaybackMocksServiceLocator()
    {
        _mocks = new MockRepository();
    }

    public T PartialMock<T>(params object[] args) where T : class
    {
        return _mocks.PartialMock<T>(args);
    }

    public object Service(Type serviceType)
    {
        return _mocks.StrictMock(serviceType);
    }

    public T Service<T>() where T : class
    {
        return _mocks.StrictMock<T>();
    }

    public IDisposable Record()
    {
        return _mocks.Record();
    }

    public IDisposable Playback()
    {
        return _mocks.Playback();
    }
} 
```

我仍然不知道是否有内置的方法可以做到这一点。但这很有效，让我免于重写 1200 个测试。

# drag-and-drop - 如何在 Google Earth 插件中处理拖动事件？

> ID：473462
> 
> 赞同：1
> 
> 时间：2009-01-23T16:06:32.317
> 
> 标签：drag-and-drop, kml, google-earth-plugin

我的 javascript 很弱。是否可以修改下面的相同代码来执行以下操作：

*   使加载的对象可拖动
*   当对象被删除时，一个 ajax 请求类似于：

    [http://.../moveTo?lat=new_lat&long=new_long&id=some_way_to_uniquely_id_the_object](http://.../moveTo?lat=new_lat&long=new_long&id=some_way_to_uniquely_id_the_object)

有什么建议可以提供吗？

示例代码：

```
var ge;

// store the object loaded for the given file... initially none of the objects
// are loaded, so initialize these to null
var currentKmlObjects = {
  'red': null,
  'yellow': null,
  'green': null
};

google.load("earth", "1");

function init() {
  // Create checkboxes
  var content = document.getElementById('content');
  var inputHTML = 'Placemarks:<br/>';
  inputHTML += '<input type="checkbox" id="kml-red-check" onclick="toggleKml(\'red\');"/>' +
               '<label for="kml-red-check">Red</label>' +
               '<input type="checkbox" id="kml-yellow-check" onclick="toggleKml(\'yellow\');"/>' +
               '<label for="kml-yellow-check">Yellow</label>' +
               '<input type="checkbox" id="kml-green-check" onclick="toggleKml(\'green\');"/>' +
               '<label for="kml-green-check">Green</label>';
  content.innerHTML = inputHTML;

  google.earth.createInstance('content', initCB, failureCB);
}

function initCB(instance) {
  ge = instance;
  ge.getWindow().setVisibility(true);

  // add a navigation control
  ge.getNavigationControl().setVisibility(ge.VISIBILITY_AUTO);

  // add some layers
  ge.getLayerRoot().enableLayerById(ge.LAYER_BORDERS, true);
  ge.getLayerRoot().enableLayerById(ge.LAYER_ROADS, true);

  // fly to Santa Cruz
  var la = ge.createLookAt('');
  la.set(37, -122,
          0, // altitude
          ge.ALTITUDE_RELATIVE_TO_GROUND,
          0, // heading
          0, // straight-down tilt
          5000 // range (inverse of zoom)
  );
  ge.getView().setAbstractView(la);

  // if the page loaded with checkboxes checked, load the appropriate
  // KML files
  if (document.getElementById('kml-red-check').checked)
    loadKml('red');

  if (document.getElementById('kml-yellow-check').checked)
    loadKml('yellow');

  if (document.getElementById('kml-green-check').checked)
    loadKml('green');

  document.getElementById('installed-plugin-version').innerHTML =
      ge.getPluginVersion().toString();
}

function failureCB(errorCode) {
}

function toggleKml(file) {
  // remove the old KML object if it exists
  if (currentKmlObjects[file]) {
    ge.getFeatures().removeChild(currentKmlObjects[file]);
    currentKmlObject = null;
  }

  // if the checkbox is checked, fetch the KML and show it on Earth
  var kmlCheckbox = document.getElementById('kml-' + file + '-check');
  if (kmlCheckbox.checked)
    loadKml(file);
}

function loadKml(file) {
  var kmlUrl = 'http://earth-api-samples.googlecode.com/svn/trunk/' +
               'examples/static/' + file + '.kml';

  // fetch the KML
  google.earth.fetchKml(ge, kmlUrl, function(kmlObject) {
    // NOTE: we still have access to the 'file' variable (via JS closures)

    if (kmlObject) {
      // show it on Earth
      currentKmlObjects[file] = kmlObject;
      ge.getFeatures().appendChild(kmlObject);
    } else {
      // bad KML
      currentKmlObjects[file] = null;
      alert('Bad KML');

      // uncheck the box
      document.getElementById('kml-' + file + '-check').checked = '';
    }
  });
}

google.setOnLoadCallback(init); 
```

对于奖励积分，我可以在之后重新加载 kml 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T20:10:38.407

要使对象可拖动，您需要设置一些事件侦听器并在回调函数中处理移动。我假设您希望拖动的对象是地标（KmlPlacemark），如果您需要这样的东西......（注意：这是未经测试和写在这里的，所以可能会有一些错别字。）

```
var dragging = false; // the object being dragged

var url = "http://.../moveTo?"; // path to your cgi script

function init() {

// Rest of your method body...

google.earth.addEventListener(ge.getGlobe(), "mousedown", function(e) 
  { 
    // if it is a place mark
    if(e.getTarget().getType() == 'KmlPlacemark') 
    { 
      // set it as the dragging target
      dragging = e.getTarget(); 
     } 
  }); 

google.earth.addEventListener(ge.getGlobe(), "mouseup", function(e)
  {
     // drop on mouse up (if we have a target)
     if(dragging) {
       // build the query string
       // ...you could use getName or getSnippet rather than getId
       var query = "lat=" + dragging.getGeometry().getLatitude() +
       "&long=" + dragging.getGeometry().getLongitude() + 
       "&id=" + dragging.getId(); 
       // send the query to the url
       httpPost(url, query); 
       // clear the dragging target
       dragging = false; 
     }
  }); 

google.earth.addEventListener(ge.getGlobe(), "mousemove", function(e) 
  { 
    // when the mouse moves (if we have a dragging target)
    if(dragging) { 
      // stop any balloon opening
      e.preventDefault(); 
      // drag the object
      // i.e. set the placemark location to cursor the location
      dragging.getGeometry().setLatLng(e.getLatitude(), e.getLongitude());
    } 
  }); 

}

// send a HTTP POST request
// could use jQuery, etc....
function httpPost(url, query) {
    var httpReq = false;
    var self = this;
    // Mozilla/Safari
    if (window.XMLHttpRequest) {
        self.httpReq = new XMLHttpRequest();
    }
    // IE
    else if (window.ActiveXObject) {
        self.httpReq = new ActiveXObject("Microsoft.XMLHTTP");
    }
    self.httpReq .open('POST', url, true);
    self.httpReq .setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    self.httpReq .onreadystatechange = function() {
        if (self.httpReq .readyState == 4) {
            // do something...
            alert(self.httpReq.responseText); 
        }
    }
    self.httpReq.send(query);
} 
```

# php - 验证数组中的每个元素？

> ID：473463
> 
> 赞同：0
> 
> 时间：2009-01-23T16:06:37.497
> 
> 标签：php, arrays, validation

我目前正在尝试验证表单服务器端，它的工作方式是将所有数据放入数组中，表单字段作为键，字段数据作为值，但是我需要检查所有键有一个与其他相关联的值我希望停止提交并且用户必须编辑那里的详细信息然后重新提交，是否有一个快速检查我可以运行而不是将数组分开并检查或在它被放置之前检查在带有开关或丢失 if 语句的数组中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:25:20.393

西科87，

多半您不想同时测试所有字段。例如，您可能有一个联系人字段，其中包含非强制的电话号码输入选项，因此拒绝提交将是有问题的。

在许多情况下，单独测试您的字段会更容易，因此您可以对每个字段给予特别关注。您需要特别注意电子邮件地址，并特别注意生日。

从长远来看，一视同仁可能会导致非常严重的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T17:20:15.540

```
function fieldEmpty($value) {
    return trim($value) == '';
}

if (count(array_filter($array, 'fieldEmpty'))) {
    die('bad');
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:20:42.023

像这样的东西怎么样

```
<?php
$arrayFilled = true;
foreach($array as $key=>$value) {
    $arrayFilled = trim($value) == '' ? false : $arrayFilled;
    if($arrayFilled === false) { break; }
}
if($arrayFilled === false) {
    echo "missing data";
}
else {
    echo "filled array";
} 
```

你可能想要检查的不仅仅是一个空字符串，但我会把它留给你

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-24T05:03:14.467

一种选择是两者都做。

有一个单独的字段选项数组，以字段名称作为键。

```
$fieldTypes = array('nameFirst' => 'name',
                    'nameLast'  => 'name',
                    'phone'     => 'phone',
                    'email'     => 'email');
foreach($input as $key => $value) {
    switch($fieldTypes[$key]) {
        case 'name':
            //run $value against name validation
            break;
        case 'phone':
            //run $value against phone validation
            break;
        case 'email':
            //run $value against email validation
            break;
        default:
            //code here for unknown type
    }
} 
```

现在，它可以以多种方式使用，并且可以轻松扩展以包含诸如是否需要该字段，甚至是错误消息之类的内容。通过将`$fieldTypes`数组转换为多维数组，或包含数据的对象数组。

这样，如果您决定添加一个字段，它可能不会对验证代码进行太多更改。

# asp.net - ASP.NET 成员基于 Web 的管理

> ID：473474
> 
> 赞同：3
> 
> 时间：2009-01-23T16:09:07.320
> 
> 标签：asp.net, asp.net-membership

有谁知道是否有一种方法可以使用您可以远程访问的基于 Web 的界面来管理 asp.net 成员数据库中的用户/角色？

我需要一个不需要安装到默认网站的。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:20:36.890

[这里](http://msdn.microsoft.com/en-us/magazine/cc163807.aspx)有一篇很棒的文章。
带有如何通过 web 服务实现 aspnet 成员数据库的示例。[从这里](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=-1&tabid=19&download=146)
下载asp.net示例 对于下载的使用SQL express进行本地测试的示例，我有点挣扎，但找到了解决方案： 在web.confing中：

```
<connectionStrings>
    <remove name="LocalSqlServer"/>
    <add name="LocalSqlServer" connectionString="Data Source=name of the local machine\SQLEXPRESS;Initial Catalog=ASPNETDB;Integrated Security=True" providerName="System.Data.SqlClient"/>
  </connectionStrings> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:37:03.083

这是一个快速而肮脏的解决方案。将 ASP.NETWebAdminFiles 复制到服务器上的目录。使其成为虚拟目录。打开 App_Code/WebAdminPage.cs 文件并注释掉 488 - 495 左右的行，代码将如下所示：

```
 // Changed by Jason so I can use this remotely!!!
        //  if (!application.Context.Request.IsLocal) {
        //    SecurityException securityException = new SecurityException((string)HttpContext.GetGlobalResourceObject("GlobalResources", "WebAdmin_ConfigurationIsLocalOnly"));
        //    WebAdminPage.SetCurrentException(application.Context, securityException);
        //    application.Server.Transfer("~/error.aspx");
        //  } 
```

然后，您现在可以远程使用此工具。只需使用您的浏览器拉出新创建的虚拟目录并传入正确的参数。例如

```
http://myservername/WebAdminFiles/default.aspx?applicationPhysicalPath=C:\Websites\Application\&applicationUrl=/ApplicationURL 
```

我做的另一件事是在这个文件夹上启用 Windows 身份验证，这样我必须在服务器上拥有一个管理员帐户才能访问这个 url。这很重要，因为一旦启用此工具，任何人都可以浏览和删除用户（如果他们拉出 url）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T16:40:07.103

顺便说一句，ASP.NETAdmin 文件位于您的机器上：

C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\ASP.NETWebAdminFiles

请享用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T19:44:10.023

嗯，用于管理用户和会员信息的 asp .net 对象相当简单，为什么不自己做呢？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-22T11:16:00.493

尝试：

[我的WSAT](http://mywsat.codeplex.com/)

从网站：

> MyWSAT aka ASP.NET WSAT 是一个基于 WebForms 的网站入门工具包，适用于 ASP.NET Membership Provider。这是一个功能丰富的应用程序，可以处理所有基础知识以节省您的时间。使用它作为模板来启动您的网站。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T21:12:32.573

我只是在我的站点的开发版本上修改本地 web.config 中的连接字符串以指向远程数据库，然后从 Visual Studio 中转到：

项目 | ASP.NET 配置

这打开了本地配置站点，但与远程数据库通信，允许我从那里管理用户/角色等。

显然，这假设您有一个要连接的数据库服务器，而不是 APP_DATA 中基于文件的设置。

# javascript - VIM + JSLint？

> ID：473478
> 
> 赞同：121
> 
> 时间：2009-01-23T16:10:29.470
> 
> 标签：javascript, vim, lint

我在 vim 中度过了我的日子，目前正在编写大量 JavaScript。我一直在尝试找到一种方法将 JSLint 或类似的东西集成到 vim 中以改进我的编码。有没有人设法做这样的事情？

编辑：

试过这个：[Javascript Syntax Checking From Vim](http://mikecantelon.com/story/javascript-syntax-checking-vim)，不幸的是输出非常粗糙。

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2011-05-05T06:22:01.220

IMO的最佳实践方式是：

1.  安装[Syntastic Vim 插件](https://www.vim.org/scripts/script.php?script_id=2736)- 适用于多种语言的最佳语法检查器，此外它还与 Vim 的*位置列表*(== *quickfix* ) 窗口集成。

*   我建议[从 GitHub存储库克隆并使用](https://github.com/vim-syntastic/syntastic)[Vundle](https://github.com/VundleVim/Vundle.vim)或[Pathogen](https://www.vim.org/scripts/script.php?script_id=2332)等插件管理器进行安装，因为它更新频率更高。

2.  选择以下两个选项之一：

## JSLint

1.  使用您最喜欢的包管理器（Ubuntu's 、Mac's [home](https://brew.sh/)等）安装`jsl`（JSLint 可执行文件）。`apt-get`[`brew`](https://brew.sh/)

## 社区驱动的[jshint.com](https://jshint.com/)（优于 JSLint）

1.  使用你最喜欢的包管理器安装*node.js。*
2.  安装*节点包管理器*：'curl [https://npmjs.org/install.sh](https://npmjs.org/install.sh) | sh'**编辑：npm 现在是 node.js的一部分**
    *   有关更多信息，请参见[http://npmjs.org](https://www.npmjs.com/)。
3.  全局安装*jshint*：'npm install jshint -g'
4.  将你的 jshint*配置*文件放在你的*$HOME*目录中：'~/.jshintrc'
    *   [这是 JSHint-Node 的示例配置文件](https://github.com/jshint/jshint/blob/master/examples/.jshintrc)，他们从我的网站中提取并添加了更多内容。
    *   [这是我的原始副本，您也可以从](https://github.com/oryband/dotfiles/blob/master/jshintrc).
5.  [用这个](https://github.com/factorylabs/vimfiles/blob/master/home/.vim/syntax_checkers/javascript.vim)覆盖*Syntastic*的`syntax_checkers/javascript.vim`文件-**编辑：使用最新的 SYNTASTIC 版本不再需要。** ***   从[FactorayLab 的非常有用的 Vim GitHub 页面](https://github.com/factorylabs/vimfiles/)[复制](https://github.com/factorylabs/vimfiles/blob/master/home/.vim/syntax_checkers/javascript.vim)的脚本，我建议每个 Vim 用户查看。** 

 **享受！:)

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-30T16:19:34.223

您可以按照[JSLint web-service + VIM 集成](http://wiki.whatwg.org/wiki/IDE)的说明进行操作，或者执行我所做的操作：

下载[http://jslint.webvm.net/mylintrun.js](http://jslint.webvm.net/mylintrun.js)和[http://www.jslint.com/fulljslint.js](http://www.jslint.com/fulljslint.js) 并将它们放在您选择的目录中。

然后将以下行添加到 mylintrun.js 的开头：

```
var filename= arguments[0]; 
```

并将 mylintrun.js ("print(...)") 中的最后一行代码更改为：

```
 print ( filename + ":" + (obj["line"] + 1) + ":" + (obj["character"] + 1) + ":" + obj["reason"] ); 
```

这会在 mylintrun.js 中输出一个可以与 VIM 快速修复窗口 (:copen) 一起使用的错误列表。

现在在 VIM 中设置以下内容：

```
set makeprg=cat\ %\ \\\|\ /my/path/to/js\ /my/path/to/mylintrun.js\ %
set errorformat=%f:%l:%c:%m 
```

您必须将*/my/path/to/js*更改为 SpiderMonkey 的路径，并将*/my/path/to/mylintrun.js*更改为放置 JS 文件的路径。

现在，您可以在 VIM中使用**:make并使用快速修复窗口 (:he** *quickfix* -window) 从错误跳转到错误。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-09-24T17:30:22.787

另一种选择是来自 Jesse Hallet的[jslint.vim 。](http://github.com/hallettj/jslint.vim)它在 GitHub 上可用，可以使用或不使用 Vim 的 QuickFix 窗口。这是一个不错的插件！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-03-24T06:16:13.273

我很高兴使用 node-lint

```
sudo npm -g install jslint 
```

然后在你的某个地方敲这个`.vim`

```
set makeprg=jslint\ %
set errorformat=%-P%f,
        \%E%>\ #%n\ %m,%Z%.%#Line\ %l\\,\ Pos\ %c,
        \%-G%f\ is\ OK.,%-Q 
```

现在 a`:make`将运行 jslint。错误出现在快速修复窗口中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-14T18:24:39.977

以下是 2012 年 11 月更新的 Mac OS 说明。假设您已安装[Homebrew](http://mxcl.github.com/homebrew/)以获取 Node.js，并且您已经安装了 Syntastic for Vim（我使用[https://github.com/carlhuda/janus](https://github.com/carlhuda/janus)自动提供）：

```
$ brew install node.js
$ npm install -g jshint 
```

然后将 '/usr/local/share/npm/bin' 添加到您的 PATH（可能在 ~/.bashrc 中）。例如，添加以下行： `export PATH="$PATH:/usr/local/share/npm/bin"`

重新启动您的终端并检查

`$ jshint`

可以从命令行执行。Syntastic 会自动发现 jsHint。重新启动 MacVim 并享受吧！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-09-12T19:09:22.597

更好的是通过 Lynx 管道处理结果，以处理 JSLint 不幸地选择 HTML 作为输出格式。我有一篇关于如何在这里做的博客文章：

[http://www.fleegix.org/articles/2008-09-06-jslint-in-vim-through-lynx](http://www.fleegix.org/articles/2008-09-06-jslint-in-vim-through-lynx)

# c# - 不使用密钥库的客户端证书

> ID：473494
> 
> 赞同：2
> 
> 时间：2009-01-23T16:14:53.003
> 
> 标签：c#, .net, ssl, client-certificates

我试图弄清楚是否有任何方法可以让 .NET 客户端使用客户端证书而不以任何方式涉及 Windows 密钥库。

我有一个这样的代码片段：

```
test1.Service s = new test1.Service();
X509Certificate c = X509Certificate.CreateFromCertFile(@"C:\test.pem");
s.ClientCertificates.Add(c);
int result = s.TestMethod(); 
```

但是，这仅在我的证书存储中安装了“test.pem”中引用的证书时才有效。我认为这是因为密钥是谈判所必需的。如果我在商店中没有证书/密钥，则证书不会随请求一起发送。

我想要做的是能够从一个或多个文件中提供证书和私钥，并且不以任何方式涉及 Windows 证书存储。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T18:01:37.327

我将发布我自己帖子的答案，但会保持开放状态，看看其他人是否能以不同的方式解决它。

基本上，我在下注。如果您有一个 PKCS12 文件（其中包含密钥和证书），您可以使用 X509Certificate2 类加载该文件并使用它，它不会询问密钥库。

我找不到使用平面 PEM 密钥和证书文件的方法（例如，您需要使用 Python）。

# python - 打印图像时，是什么决定了它在页面上显示的大小？

> ID：473498
> 
> 赞同：5
> 
> 时间：2009-01-23T16:16:33.017
> 
> 标签：python, python-imaging-library, dpi

使用 Python 的图像库我想创建一个 PNG 文件。
我希望在打印此图像时，无需任何缩放，它始终会以已知且一致的“尺寸”打印在打印页面上。

分辨率是否编码在图像中？

如果是这样，我该如何指定它？

即使是这样，当它进入打印机时，这是否有任何相关性？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T16:22:41.427

从 PIL 1.1.5 开始，有一种获取 DPI 的方法：

```
im = ... # get image into PIL image instance
dpi = im.info["dpi"] # retrive the DPI
print dpi # (x-res, y-res)
im.info["dpi"] = new dpi # (x-res, y-res)
im.save("PNG") # uses the new DPI 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-01-16T13:56:56.973

我找到了一种将 dpi 信息放入 png 的非常简单的方法：

im.save('myfile.png',dpi=[600,600])

不幸的是，我没有在任何地方找到这个文档，不得不深入研究 PIL 源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T16:20:13.680

打印机具有不同的打印分辨率。例如，如果您选择 200 DPI 的打印分辨率（或者如果它在打印机驱动程序中设置为默认值），那么 200 像素的图像应该是一英寸大小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T16:32:21.750

图像打印尺寸和分辨率都与打印特定比例和质量的图像相关。请记住，如果图像随后包含在桌面发布工作区（Word、InDesign）甚至网页中，则图像会受到父文档中任何指定分辨率的影响——这不一定会改变相对比例在桌面出版程序的情况下的图像，但会改变图像质量。

是的，所有图像都有一个分辨率属性，它回答了你一半的问题——我不知道 Python ......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T16:27:19.593

很大程度上取决于您用于打印的软件。如果您将图像放置在 Word 文档中，它将根据 DPI 缩放，直到页面的宽度。如果您将其放在网页上，则 DPI 根本无关紧要。

# c# - 使用 .NET 集合编辑器而不使用属性网格控件

> ID：473506
> 
> 赞同：5
> 
> 时间：2009-01-23T16:17:41.763
> 
> 标签：c#, .net, collections, propertygrid

我的表单上有一个 PropertyGrid。我的老板认为这很丑陋。粗野。朴实无华。

他想要一个漂亮、整洁、干净的表格。这里有一个问题：其中一个属性是我们自产的对象的集合。他喜欢这个集合的集合编辑器。

我知道我可以建立自己的收藏编辑器。但是有没有一个干净、简单的解决方案来节省我几个小时的编码时间，这样我就可以直接创建和使用集合编辑器而不使用属性网格？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-23T17:22:20.417

您可以从`UITypeEditor`(via `TypeDescriptor`) 获得此功能，但这并非易事 - 您需要设置 an `IServiceProvider`、 an `IWindowsFormsEditorService`，理想情况下是 an `ITypeDescriptorContext`- 相当麻烦。如果您不熟悉这些工具，手动操作可能会更简单。

或者，看看[SmartPropertyGrid.NET](http://www.visualhint.com/index.php/propertygrid/)，它是`PropertyGrid`.

* * *

更新：这是一个工作示例......绝对不是微不足道的，但随意窃取代码。它仅适用于模态编辑器，不适用于下拉菜单。它也不是“关注点分离”的一个很好的例子。这`MyHelper`堂课很有趣。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing.Design;
using System.Windows.Forms;
using System.Windows.Forms.Design;
class Foo
{
    public Foo() { Bars = new List<Bar>(); }
    public List<Bar> Bars { get; private set; }
}
class Bar
{
    public string Name { get; set; }
    public DateTime DateOfBirth { get; set; }
}
static class Program
{
    [STAThread]
    static void Main()
    {
        Foo foo = new Foo();
        Bar bar = new Bar();
        bar.Name = "Fred";
        bar.DateOfBirth = DateTime.Today;
        foo.Bars.Add(bar);
        Application.EnableVisualStyles();
        using(Form form = new Form())
        using (Button btn = new Button())
        {
            form.Controls.Add(btn);
            btn.Text = "Edit";
            btn.Click += delegate
            {
                MyHelper.EditValue(form, foo, "Bars");
            };
            Application.Run(form);
        }
    }
}

class MyHelper : IWindowsFormsEditorService, IServiceProvider, ITypeDescriptorContext
{
    public static void EditValue(IWin32Window owner, object component, string propertyName) {
        PropertyDescriptor prop = TypeDescriptor.GetProperties(component)[propertyName];
        if(prop == null) throw new ArgumentException("propertyName");
        UITypeEditor editor = (UITypeEditor) prop.GetEditor(typeof(UITypeEditor));
        MyHelper ctx = new MyHelper(owner, component, prop);
        if(editor != null && editor.GetEditStyle(ctx) == UITypeEditorEditStyle.Modal)
        {
            object value = prop.GetValue(component);
            value = editor.EditValue(ctx, ctx, value);
            if (!prop.IsReadOnly)
            {
                prop.SetValue(component, value);
            }
        }
    }
    private readonly IWin32Window owner;
    private readonly object component;
    private readonly PropertyDescriptor property;
    private MyHelper(IWin32Window owner, object component, PropertyDescriptor property)
    {
        this.owner = owner;
        this.component = component;
        this.property = property;
    }
    #region IWindowsFormsEditorService Members

    public void CloseDropDown()
    {
        throw new NotImplementedException();
    }

    public void DropDownControl(System.Windows.Forms.Control control)
    {
        throw new NotImplementedException();
    }

    public System.Windows.Forms.DialogResult ShowDialog(System.Windows.Forms.Form dialog)
    {
        return dialog.ShowDialog(owner);
    }

    #endregion

    #region IServiceProvider Members

    public object GetService(Type serviceType)
    {
        return serviceType == typeof(IWindowsFormsEditorService) ? this : null;
    }

    #endregion

    #region ITypeDescriptorContext Members

    IContainer ITypeDescriptorContext.Container
    {
        get { return null; }
    }

    object ITypeDescriptorContext.Instance
    {
        get { return component; }
    }

    void ITypeDescriptorContext.OnComponentChanged()
    {}

    bool ITypeDescriptorContext.OnComponentChanging()
    {
        return true;
    }

    PropertyDescriptor ITypeDescriptorContext.PropertyDescriptor
    {
        get { return property; }
    }

    #endregion
} 
```

# objective-c - 使用外部框架构建 Objective-C 应用程序

> ID：473515
> 
> 赞同：2
> 
> 时间：2009-01-23T16:20:27.283
> 
> 标签：objective-c, xcode, macos

我正在将[咆哮](http://growl.info/documentation/developer/implementing-growl.php?lang=cocoa)集成到我的 Objective-C 应用程序中。

但是，如果我在没有将 Growl.framework 复制到**~/Library/Frameworks**或相应位置的情况下构建并运行我的应用程序，那么我的应用程序将无法执行。

我并不完全了解 Objective-c 下的框架，但我想知道是否有任何方式将框架包含在我的应用程序中，这样我就不必手动将框架分发给用户？

我相信这就是[tweetweet](http://github.com/zmalltalker/tweettweet/tree/master)在构建过程中所做的，但我还没有完全弄清楚他们是如何做到的。

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T19:44:10.367

是的，在 Xcode 的目标中，您需要创建一个新的“复制文件”构建阶段（右键单击目标 > 添加 > 新构建阶段 > 新复制文件构建阶段）。当弹出更多信息窗口时，单击弹出按钮并选择框架。将此构建阶段拖到复制资源阶段的正下方，然后将要复制的任何框架拖到它上面。

# asp.net-mvc - ASP.NET TempData 在请求之间保持不变

> ID：473520
> 
> 赞同：9
> 
> 时间：2009-01-23T16:20:54.630
> 
> 标签：asp.net-mvc, tempdata

我在我的控制器中使用如下临时数据 - 非常简单，当出现问题时：

```
TempData("StatusMessage") = "You have no items set to Auto-Ship." 
```

然后在每个页面上，我都有一个用户控件，如下所示：

```
<div class="error-container">
<%  If TempData.ContainsKey("ErrorMessage") Then%>
<script> $('div.error-container').show();</script>
<div class="msg-error"><p><%=TempData("ErrorMessage") %></p></div>
<% End If%>
<%  If TempData.ContainsKey("StatusMessage") Then%>
<script> $('div.error-container').show();</script>
<div class="msg-status"><p><%=TempData("StatusMessage")%></p></div>
<% End If%>
<ul></ul>
</div> 
```

问题是，当我确实将错误添加到 tempdata 时，它会在第一个请求中正确显示，但在下一个请求中也会再次显示 - 这显然非常令人困惑，而不是理想的行为。

我没有使用任何 IoC，我确实在使用它时看到了同样问题的帖子。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-23T16:34:46.613

TempData的*唯一目的*是持续到下一个请求。取而代之的是，在下一个请求进入 ViewData 之前，您不想保留的东西。

实际上，这意味着 TempData 只有在重定向时才能安全使用。当不重定向时，“下一个请求”可以是任何东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T16:35:19.733

这是否可以接受（一旦显示错误就删除）：

```
<%  If TempData.ContainsKey("ErrorMessage") Then %>
<script> $('div.error-container').show();</script>
<div class="msg-error"><p><%=TempData("ErrorMessage") %></p></div>
<% 
    TempData.Remove("ErrorMessage")
End If
%> 
```

# algorithm - 词比较算法

> ID：473522
> 
> 赞同：14
> 
> 时间：2009-01-23T16:22:08.590
> 
> 标签：algorithm, string, word, compare, similarity

我正在为我正在处理的项目做一个 CSV 导入工具。客户端需要能够在 excel 中输入数据，将它们导出为 CSV 并将它们上传到数据库。例如，我有这个 CSV 记录：

```
 1,   John Doe,     ACME Comapny   (the typo is on purpose) 
```

当然，这些公司保存在一个单独的表中并通过外键链接，所以我需要在插入之前找到正确的公司 ID。我计划通过将数据库中的公司名称与 CSV 中的公司名称进行比较来做到这一点。如果字符串完全相同，则比较应该返回 0，并返回一些随着字符串变得不同而变大的值，但 strcmp 不会在这里剪掉它，因为：

“Acme Company”和“Acme Comapny”应该有非常小的差异指数，但“Acme Company”和“Cmea Mpnyaco”应该有很大的差异指数或者“Acme Company”和“Acme Comp”。即使字符数不同，也应该有一个小的差异索引。此外，“Acme Company”和“Company Acme”应返回 0。

因此，如果客户在输入数据时输入了一个类型，我可以提示他选择他最可能想要插入的名称。

有没有一种已知的算法可以做到这一点，或者我们可以发明一个:)？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-23T16:25:23.200

您可能想查看[Levenshtein 距离](http://en.wikipedia.org/wiki/Levenshtein_distance)算法作为起点。它将评估两个单词之间的“距离”。

这个关于实现谷歌风格“你的意思是......？”的[SO线程](https://stackoverflow.com/questions/41424/how-do-you-implement-a-did-you-mean) 系统也可以提供一些想法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-23T16:32:06.383

我不知道你在用什么语言编码，但如果是 PHP，你应该考虑以下算法：

[**levenshtein()**](http://us2.php.net/Levenshtein)：返回您必须替换、插入或删除以将一个字符串转换为另一个字符串的最少字符数。
[**soundex()**](http://us2.php.net/manual/en/function.soundex.php)：返回一个单词的四个字符的 soundex 键，它应该与任何发音相似的单词的键相同。
[**metaphone()**](http://us2.php.net/manual/en/function.metaphone.php)：类似于 soundex，可能对您更有效。它比 soundex() 更准确，因为它知道英语发音的基本规则。变音位生成的密钥长度可变。
[**similar_text()**](http://us2.php.net/manual/en/function.similar-text.php)：类似于 levenshtein()，但它可以返回一个百分比值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T16:26:44.353

我在[Levenshtein Distance](http://en.wikipedia.org/wiki/Levenshtein_distance)算法上取得了一些成功，还有[Soundex](http://en.wikipedia.org/wiki/Soundex)。

你用什么语言实现这个？我们也许可以指出具体的例子

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T16:35:33.990

我实际上已经实现了一个类似的系统。我使用了 Levenshtein 距离（正如其他海报已经建议的那样），并进行了一些修改。未修改的编辑距离（应用于整个字符串）的问题在于它对单词重新排序很敏感，因此“Acme Digital Incorporated World Company”与“Digital Incorporated World Company Acme”的匹配度很差，并且这种重新排序在我的数据中很常见。

我修改了它，如果整个字符串的编辑距离太大，算法会退回到相互匹配的单词以找到一个好的单词到单词匹配（二次成本，但如果有太多的话会有一个截止话，所以它工作正常）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T18:40:38.893

我采用了 SoundEx、Levenshtein、PHP 相似性和双变音位，并在 C# 中将它们打包到 String 上的一组扩展方法中。

[整个博客文章在这里](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2009/01/26/string-similarity-and-extension-methods.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T16:29:13.583

有多种算法可以做到这一点，大多数数据库甚至默认包含一种。这实际上是一个相当普遍的问题。

如果它只是关于英语单词，例如 SQL Server 包括 SOUNDEX，可用于比较单词的结果声音。

[http://msdn.microsoft.com/en-us/library/aa259235%28SQL.80%29.aspx](http://msdn.microsoft.com/en-us/library/aa259235%28SQL.80%29.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T16:48:53.543

我正在用 PHP 实现它，我现在正在编写一段代码，它将 2 个字符串分解为单词，并使用 levenshtein 将第一个字符串中的每个单词与第二个字符串的单词进行比较，并接受最低的可能值. 我完成后会发布它。

非常感谢。

更新：这是我想出的：

```
function myLevenshtein( $str1, $str2 )
{
  // prepare the words
  $words1 = explode( " ",  preg_replace( "/\s+/", " ", trim($str1) ) );
  $words2 = explode( " ",  preg_replace( "/\s+/", " ", trim($str2) ) );

  $found = array(); // array that keeps the best matched words so we don't check them again
  $score = 0;       // total score
  // In my case, strings that have different amount of words can be good matches too
  // For example, Acme Company and International Acme Company Ltd. are the same thing
  // I will just add the wordcount differencre to the total score, and weigh it more later if needed
  $wordDiff = count( $words1 ) - count( $words2 );
  foreach( $words1 as $word1 )
  {
    $minlevWord = "";
    $minlev = 1000;
    $return = 0;
    foreach( $words2 as $word2 )
    {
      $return = 1;
      if( in_array( $word2, $found ) )
        continue;
      $lev = levenshtein( $word1, $word2 );
      if( $lev < $minlev )
      {
        $minlev = $lev;
        $minlevWord = $word2;
      }
    }
    if( !$return )
      break;
    $score += $minlev;
    array_push( $found, $minlevWord );
  }

  return $score + $wordDiff;
} 
```

# php - 将文件上传到当前文件夹上方的文件夹

> ID：473525
> 
> 赞同：0
> 
> 时间：2009-01-23T16:23:44.810
> 
> 标签：php

```
$result = mysql_query("SELECT * FROM media WHERE path = '$target'");
if($row = mysql_num_rows($result)==1)
{
echo"<br />Sorry, there is already a file with that name on the server.<br     />Please press back on your browser and save the file under a different name.";
}else{

if(move_uploaded_file($_FILES['uploaded']['tmp_name'], $target))
{
echo "The file ". basename( $_FILES['uploaded']['name']). " has been uploaded";
mysql_query("INSERT INTO media (id, related_page_id, type, title, copy, path, position, assets, time) VALUES ('', '$cat','$type','$name','','$target','$position','$id','$today')");

header("Location: edit.php?category=$cat");
exit();
echo $name;
}
else {
echo $today;
echo "<br />";
echo "Sorry, there was a problem uploading your file. Please press back on your browser and try again.";
}
} 
```

上面的代码曾经工作。现在它不会让我将文件上传到../uploads/，但如果我上传到uploads/，它工作正常。有人对我做错了什么有任何建议吗？谢谢

编辑

```
$target = "../uploads/"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:27:18.547

我知道这听起来很傻，但是文件夹的权限设置是否正确？

# oracle - 如何使 Oracle 错误消息更详细？

> ID：473527
> 
> 赞同：8
> 
> 时间：2009-01-23T16:24:32.827
> 
> 标签：oracle, ado.net, messages

让我发疯的信息是`ORA-01008 - Not all variables bound`。

有没有办法知道我拼错了 42 个可能的变量名中的哪一个而不盯着显示器直到我的眼睛弹出？

**更新：**我`ADO.NET`用来访问数据库。正如@Justin Cave 所建议的那样，它可能确实在Oracle 异常中丢失了一些信息。但我很肯定即使在 SQL Plus 中也不会出现参数名称。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T19:10:01.700

通常，Oracle 会提供任何错误的行号和列号，但取决于您使用的特定 API（除非您碰巧正在编写 OCI 应用程序，这可能不太可能）是否以及如何调用这些 API . 由于答案很可能最终是特定于 API 的，那么您使用的是什么 API，发生错误时您的代码是什么样的（即 JDBC、ODBC、OLE DB 等）？

例如，如果我编写了一个变量名拼写错误的 PL/SQL 块，SQL*Plus 将在错误消息之外报告错误的行号和列号。另一方面，许多 API 默认只会报告 PLS-00201 错误。

```
SQL> declare
  2    i integer;
  3  begin
  4    j := 1;
  5  end;
  6  /
  j := 1;
  *
ERROR at line 4:
ORA-06550: line 4, column 3:
PLS-00201: identifier 'J' must be declared
ORA-06550: line 4, column 3:
PL/SQL: Statement ignored 
```

类似地，如果你执行一个带有无效变量名的 SQL 语句，SQL*Plus 将获取列和行的位置，并在有问题的字符下面放一个 *，即

```
SQL> create table a( col1 number );

Table created.

SQL> insert into a( colN ) values ( 1 );
insert into a( colN ) values ( 1 )
               *
ERROR at line 1:
ORA-00904: "COLN": invalid identifier 
```

大多数 PL/SQL IDE（TOAD、SQL Developer 等）都会通过在后台询问适当的 OCI API 来做类似的事情。然而，具体如何完成这将取决于 API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:51:56.953

我不知道有什么方法可以让 Oracle 使错误更具体。也许将来的某个版本会改进此错误消息。

但是，您可以尝试其他事情，而不仅仅是盯着它看。例如，一次将 SQL 语句中的每个变量转换为文字，直到错误消失。如果可能，请生成变量名称列表，而不是手动键入它们。

# .net - 使用 WS-Security 调用 Web 服务时出现问题

> ID：473531
> 
> 赞同：0
> 
> 时间：2009-01-23T16:26:06.037
> 
> 标签：.net, web-services, security, soap

我正在从我的 .net Web 应用程序调用 Web 服务，并在调用时获得以下 com.ibm.wsspi.wssecurity.SoapSecurityException。

```
WSEC5048E: One of "SOAP Header" elements required. 
```

SOAP 请求似乎是有效的，所以我猜这个问题与使用 WS-Securty 的 web 服务有关。我必须在我的根证书颁发机构存储中安装证书。

如果我可以查看.Net 已包装的肥皂请求可能更容易诊断，但如果不嗅探数据包，我无法弄清楚如何做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-15T15:42:17.943

看来您的请求没有 WS-* 标头，标头不适用于正确的 WS-* 版本（即客户端/服务器不匹配），或者错误实际上是在 RESPONSE 上（即服务没有' t 发回 WS-* 标头）。

我假设您必须将证书安装到您的 CA 存储中，因为您要发送由测试 CA 签名的 x.509 BST？如果是这样，正是这一点让我相信您的服务正在处理请求但错误在响应中？

我经常使用 netcat 来查看发送给侦听器的请求。这是我写的关于如何做到这一点的博客文章：[http](http://dustinbreese.blogspot.com/2008/09/debugging-with-netcat.html) ://dustinbreese.blogspot.com/2008/09/debugging-with-netcat.html 如果您的请求不是通过 TLS 发送的，这确实有效。

# java - 在 Java 中使用 Actions 创建菜单、工具栏和其他组件的正确方法

> ID：473540
> 
> 赞同：8
> 
> 时间：2009-01-23T16:27:36.533
> 
> 标签：java, user-interface, swing

在 Java Swing 应用程序中编写构建菜单的简单方法是执行以下操作：

```
JMenu fileMenu = new JMenu("File");
JMenuItem openItem = new JMenuItem("Open...");
openItem.addActionListener(new ActionListener() { /* action listener stuff */ } )
fileMenu.addMenuItem(openItem); 
```

更有经验的开发人员会认识到可以通过多种机制访问操作——菜单、工具栏按钮，甚至可能是系统中的其他工作流程。那个人更有可能写：

```
Action openAction = new AbstractAction();
openAction.setName("Open...");
openAction.addActionListener(new ActionListener() { /* action listener stuff */ } )
...
JMenuItem openItem = new JMenuItem(openAction); 
```

我的问题是，**管理这些 Action 对象以便它们可以跨菜单、工具栏等使用的最佳方法是什么？**

*   创建一个返回特定操作的工厂类？
*   `private static final Action`像在某些实用程序类中 一样声明所有操作？
*   利用 Java 应用程序框架？
*   还有什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T19:10:46.720

我开发的需要跨菜单、工具栏和其他按钮使用相同操作的应用程序是使用 Swing 应用程序框架完成的。

[Swing 应用程序框架](https://appframework.dev.java.net/)

该框架将允许您拥有一个资源文件，您可以在其中定义所有菜单文本、工具提示和图标。我认为图标是关键，您不必自己加载它们。此外，如果您有任何需要启用/禁用的操作，您可以覆盖该方法来控制其状态。

该网站值得一读。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:47:03.280

您可以使用专用 Map javax.swing.actionmap 对所有 abstractAction 进行分组。请参阅[http://java.sun.com/javase/6/docs/api/javax/swing/ActionMap.html](http://java.sun.com/javase/6/docs/api/javax/swing/ActionMap.html)

此外，每个 JComponent 都有一个内部 actionMap (getActionMap())。

```
class MyComponent
extends JPanel
{
public static final String ACTION_NAME1="my.action.1";

public MyComponent()
 {
 AbstractAction action= new AbstractAction() { ... }
 getActionMap().put(ACTION_NAME1,action);
...

 menu.add(getActionMap().get(ACTION_NAME1));
 }

} 
```

希望能帮助到你

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:40:11.547

`Action`是一个糟糕的抽象 -`ActionListener`焊接到一个穷人的`Map`.

当然不要将它们分配给 a`static`因为它们是可变的并且还需要一些上下文才能有效地操作。

我对 GUI 编程的一般建议是注意它实际上与任何其他编程领域相同。遵循通常的良好做法。值得注意的是，分层，关注点分离，很少使用（实现）继承，不要写一大堆泥巴。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T17:16:35.360

另请参阅[this question](https://stackoverflow.com/questions/448179/organizing-actions-in-a-swing-application#448195)，这与您所问的几乎相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T17:57:33.747

编辑：我觉得人们不相信这是可能的或容易的，所以我做到了——从头开始花了大约一个小时——如果我只使用一种方法作为目标而不是将其反映到每个菜单项的单独方法中。

这是经过[测试的源代码](http://docs.google.com/Doc?id=avjh8kg87sn_54d6vhvzhc)。它有效，但它是一种大方法且丑陋——如果您使用它，请重构它。我可能会在接下来的几天里把它修好一点，我一直想有一个副本以供重复使用。

--- 原帖

首先，请记住将代码与数据分开。这意味着你永远不应该输入：

```
new Menu("File..."); 
```

字符串“文件...”是数据。如果你开始这样想，你会发现你的问题自己回答了。

首先，您需要建立一些数据。您需要将“文件...”和“保存”放入菜单。我通常从一个字符串数组开始（您可以轻松地将其移动到文件中）

```
new String[]{"File...","+Save","Load"...} 
```

这是我开始使用的更简单的模式之一。然后你可以解析出+号并用它来表示“当你添加这个时在菜单中下拉一个级别”

这只是一个愚蠢的约定，如果您不喜欢它，请自行发明。

下一步是将其绑定到要运行的代码。您可以让它们都调用相同的方法，但真是太麻烦了（Giant switch 语句）。一种可能性是在读取数据时使用反射来绑定方法名称。这是一种解决方案（同样可能不符合您的口味）

```
new String[]{"File...[fileMenu]","+Save[saveMenu]","Load[loadMenu]"...} 
```

然后你解析出方括号中的东西，反射性地将它连接到你当前类中的一个方法，你就设置好了。

在这一点上，我总是有一种诱惑，我学会了与之抗争，因为它永远不会成功。诱惑是使用第一组数据（“文件...”）并对其进行操作以适应某些模式并自动绑定到您的代码（在这种情况下，删除所有非字母字符，将第一个字母小写并附加“菜单”以获得正确的方法名称）。随意尝试一下，它非常吸引人并且看起来很漂亮，但是当它不能满足某些需要时（例如在不同的子菜单中具有完全相同名称的两个菜单项），请准备好放弃它。

另一种方法是，如果您的语言支持闭包，那么您实际上可以在同一个地方创建文件名和闭包..

不管怎样，一旦你开始像这样编码，你会发现你所有的菜单结构都是一个 10 行的方法，你可以改变它来满足你的需要。我有一个案例，我必须将一组菜单更改为按钮层次结构，我在 2 分钟内完成了。

最后，您可以使用此模式轻松设置操作对象并轻松更改它们的使用方式（在单个位置，单行代码中），因此您可以对它们进行试验。有很多方法可以使用它们，但如果你不按照我在这里推荐的方式进行操作，你最终将不得不为每次更改重新实现每个菜单项，这真的很烦人——在一次更改之后你如果您刚开始实施数据驱动的解决方案，将会浪费更多的时间。

这真的不是硬代码，应该花一两个小时然后你就不必再写 new Menu("... 了。相信我，这种工具总是值得的。

编辑：

这些天我几乎总是编写数据驱动的代码。通常我会以正常的方式制作一些东西的原型，识别模式并重构——如果重构正确，数据几乎总是会被排除在外，剩下的就是漂亮、紧凑和可维护的。

我可以在不到 1/2 小时内完成我上面建议的事情（也许一个小时来做​​反射版）。这几乎总是与使用未分解版本一样长，从那时起，每次更改您的节省都会成倍增加。

这与人们喜欢 ruby​​ 的方式非常相似，除了使用 ruby​​ 时，他们似乎在代码中插入了更多数据（这使得从代码中完全提取数据变得非常困难，这对于国际化来说始终是一个不错的目标）。

嗯，我有没有提到如果你擅长像这样提取数据，i18n 几乎是免费的？

我建议你找个时间试一试，看看你的想法。如果让您感到不舒服，则无需将控件嵌入字符串中。我倾向于使用字符串/对象数组，因为它们真的很容易输入，在您编码时仍在文件中，并且以后可以轻松外部化，但是如果您喜欢 YML 或 XML 或属性文件，请使用您喜欢的任何文件使用——只需从您的代码中抽象出您的数据！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T18:00:27.923

1.  为您的应用程序创建一个基本操作；这将在以后极大地帮助您
2.  像在代码中一样创建操作，而不是支持基本操作的子类

要组织它们，这将取决于您对它们所做的事情，并且您可能以一种方式组织了一些操作，而另一些则以不同的方式创建了一些操作。这一切都将取决于。

你想要的是有一种一致的方式来在你的代码中定位/创建一个动作。

根据您的 UI，您可能需要区分“静态”操作（即在您的应用程序中始终可用的内容，例如菜单系统）和仅在某些屏幕或某些位置创建的动态操作。

在任何情况下，使用专门的基本操作的具体子类将帮助您保持这些事情的组织性。您**不**希望在代码中到处指定标签、助记符和图标等内容。

# zend-framework - Zend Framework：如何在单个页面上显示多个操作，每个操作都需要不同的授权级别

> ID：473542
> 
> 赞同：0
> 
> 时间：2009-01-23T16:28:27.813
> 
> 标签：zend-framework

想象一下，我有 4 个数据库表和一个界面，该界面在单个网页上呈现用于管理每个表中的数据的表单（使用手风琴设计模式一次只显示一个表单）。每个表单都显示了表格中的行列表，允许用户插入新行或选择要编辑或删除的行。然后使用 AJAX 将请求发送到服务器。

必须根据应用程序 ACL 向不同的用户显示一组不同的表单。

我的问题是：就控制器、动作、视图和布局而言，这个界面的最佳架构是什么？

例如，到目前为止，我有一个控制器，每个表都有添加、编辑和删除操作。每个都有一个 indexAction，但它是一个空函数。我还为每个表扩展了 Zend_Form。为了显示表单，我在 IndexController 中将表单传递给它的视图，并回显每个表单。然后，Javascript 负责填充表单并将请求发送到相应控制器的适当添加/编辑/删除操作。但是，这不允许 ACL 控制表单对不同用户的显示或不显示。

让 indexAction 实例化表单会更好，然后使用类似 $this->render(); 的东西吗？在IndexController 的indexAction 视图中呈现每个视图？ACL 会阻止某些视图被呈现吗？

干杯。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-24T03:47:10.233

您可以在几个地方对 ACL 进行检查：

1.  你有你的循环（或硬编码块）来加载每个表单。
2.  在每个 Form Objects 的构造函数中，可能会抛出一个自定义异常，该异常可以被捕获并适当处理。
3.  `Zend_Form`来自所有自定义 Form 对象的扩展构造函数（可能是最好的方法，因为它有助于减少代码重复）。

请记住，如果您使用 ZF 为更新执行 AJAXy 解决方案，您的控制器也需要在其`init()`方法中运行 ACL 检查，以防止对您的数据库进行未经授权的更改。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-30T07:25:05.560

你解决了这个吗？

我正在构建一个大型数据库应用程序，其中包含许多嵌套的子控制器作为父控制器上显示的仪表板上的面板。简化的源代码如下：来自我的 parentController->indexAction()

```
 $dashboardControllers = $this->_helper->model( 'User' )->getVisibleControllers();
    foreach (array_reverse($dashboardControllers) as $controllerName) // lifo stack so put them on last first
    {
        if ($controllerName == 'header') continue; // always added last
        // if you are wondering why a panel doesn't appear here even though the indexAction is called: it is probably because the panel is redirecting (eg if access denied). The view doesn't render on a redirect / forward
        $this->_helper->actionStack( 'index', $this->parentControllerName . '_' . $controllerName ); 
    }
    $this->_helper->actionStack( 'index', $this->parentControllerName . '_header' ); 
```

如果您有更好的解决方案，我很想听听。对于我的下一个技巧，我需要弄清楚如何根据用户偏好设置在一列、两列或三列中显示这些

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-30T15:11:10.040

我使用 Manning Press 的“Zend Framework in Action”一书中的修改版本（如果您现在需要，可以下载 PDF）。我认为您可以从本书的站点下载随附的代码。你想看看第 7 章的代码。

概述：

控制器是资源，操作是特权。将您的允许和拒绝放在控制器的 init 方法中。我还使用了他们的 Controller_Action_Helper_Acl 的定制版本。

每个控制器都有一个公共静态 getAcls 方法：

```
public static function getAcls($actionName)
{
    $acls = array();
    $acls['roles']      = array('guest');
    $acls['privileges'] = array('index','list','view');

    return $acls;
} 
```

这让其他控制器可以询问此控制器的权限。每个控制器的 init 方法都会调用 $this->_initAcls()，它是在我自己的基本控制器中定义的：

```
public function init()
{
    parent::init(); // sets up ACLs
} 
```

父母看起来像这样：

```
public function init()
{
    $this->_initAcls(); // init access control lists.
}

protected function _initAcls()
{
    $to_call = array(get_class($this), 'getAcls');
    $acls = call_user_func($to_call, $this->getRequest()->getActionName());
    // i.e. PageController::getAcls($this->getRequest()->getActionName());

    if(isset($acls['roles']) && is_array($acls['roles']))
    {
        if(count($acls['roles'])==0)     { $acls['roles'] = null; }
        if(count($acls['privileges'])==0){ $acls['privileges'] = null; }
        $this->_helper->acl->allow($acls['roles'], $acls['privileges']);
    }
} 
```

然后我只有一个名为：

```
aclink($link_text, $link_url, $module, $resource, $privilege); 
```

它调用 {$resource}Controller::getAcls() 并对它们进行权限检查。如果他们有权限，则返回链接，否则返回''。

```
function aclink($link_text, $link_url, $module, $resource, $privilege)
{
    $auth = Zend_Auth::getInstance();

    $acl = new Acl(); //wrapper for Zend_Acl
    if(!$acl->has($resource))
    {
       $acl->add(new Zend_Acl_Resource($resource));
    }

    require_once ROOT.'/application/'.$module.'/controllers/'.ucwords($resource).'Controller.php';

    $to_call = array(ucwords($resource).'Controller', 'getAcls');
    $acls = call_user_func($to_call, $privilege);

    if(isset($acls['roles']) && is_array($acls['roles']))
    {
        if(count($acls['roles'])==0)     { $acls['roles'] = null; }
        if(count($acls['privileges'])==0){ $acls['privileges'] = null; }
        $acl->allow($acls['roles'], $resource, $acls['privileges']);
    }

    $result = $acl->isAllowed($auth, $resource, $privilege);

    if($result)
    {
       return '<a href="'.$link_url.'" class="aclink">'.$link_text.'</a>';
    }
    else
    {
       return '';
    }
} 
```

# windows-vista - Vista 64 位开发注意事项

> ID：473546
> 
> 赞同：4
> 
> 时间：2009-01-23T16:29:17.577
> 
> 标签：windows-vista, 64-bit, development-environment, vista64

我正在将我的开发工作站从 32 位 Vista 迁移到 64 位 Vista。

生产平台是 32 位 Windows Server 和 SQL Server 2008。

有谁知道迁移代码库的任何问题？

编辑：

该系统由web表单、c#代码、存储过程组成。

还有 ajax.net、ssrs、ssis 和来自 dundas 的动态报告/图表。

但是，我认为其他用户可能会欣赏有关此举动的任何经验教训或一般反馈。

发现：

截至 2009 年 1 月 24 日

*   Checkpoint VPN 不支持 Vista 64（实际上似乎很少支持）
*   Cropper 实用程序需要特殊下载和重建才能在 Vista 64 上工作（Cropper 看起来非常漂亮，但它缺少可滚动的窗口捕获）

缺乏对 Vista 64 的支持让我觉得不值得。我希望有人会提到缺少 VPN 支持，但目前没有支持 64 位客户端的 vpn 供应商......所以请注意 - 截至 2009 年 1 月 28 日 - 使用 Vista 64 对那些人来说不是一个好的选择我们当中需要 vpn 的人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T16:50:18.533

我已经做到了这一点——将我的工作站迁移到 Vista 64，同时仍将代码部署到 32 位 Win2008 服务器。

通常，您最大的问题是 WOW64 仿真层——这意味着 32 位进程和 64 位进程看到相同资源（注册表项、系统文件夹等）的不同版本。在 .NET 中，有一个枚举`System.Environment.SpecialFolder`这将使您能够安全地抽象访问程序文件、应用程序数据和其他具有潜在风险的系统文件夹。您还需要强制 IIS 在 32 位兼容模式下运行（它不能同时运行 64 位和 32 位 Web 应用程序）- [http://support.microsoft.com/kb/894435上的说明](http://support.microsoft.com/kb/894435)

不过，没有什么是不可克服的——我在 Vista x64 上成功编译了 COM 可见的 .NET 程序集（将编译器设置为以 x86 CPU 为目标），然后将它们与 ASP.NET 和运行 32 位 COM 对象的旧 ASP 代码一起部署在32位服务器，一切运行良好。在[我的博客](http://dylanbeattie.blogspot.com/2008/12/stuff-you-wish-you-known-when-you.html)上发布了一些您可能会发现有用的注释；我个人遇到的最大头痛是 32 位应用程序（包括我最喜欢的文本编辑器）再也看不到 C:\Windows\System32 了……但即使这样也很容易解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:41:57.830

不要对系统文件夹使用硬编码名称。

（无论如何都是个坏主意）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:40:28.473

我遇到了 Vista 64 的一个问题：

## 程序文件

程序文件可能存储在**Program Files x86**或**Program Files**中，如果您的任何代码对程序的存储位置做出假设，您可能必须围绕此进行编码 - 即使您做了正确的事情并使用了环境变量，因为有 2位置现在有 2 个不同的环境变量。您需要知道您的应用程序将安装在其中的哪一个中，如果您以任何 CPU 为目标，那么如果您以 x86 为目标，这将是不同的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T16:48:48.193

在 64 位 w2k3 服务器 (php) 上向 IIS 添加第 3 方 32 位 ISAPI 处理程序时遇到了很多麻烦，我不得不让 IIS 在 32 位兼容模式下运行。如果这一切都得到管理，我可以认为没有严重的问题。

# vba - Excel 宏 - 逗号分隔的单元格到行保留/聚合列

> ID：473553
> 
> 赞同：4
> 
> 时间：2009-01-23T16:31:47.697
> 
> 标签：vba, excel

[我在这里](https://stackoverflow.com/questions/471435/excel-macro-comma-separated-cells-to-rows#471552)回答了一个类似的问题

场景略有变化，希望可以稍微改变宏。任何帮助表示赞赏。

基于此数据：

```
 <- A (Category) ->   <- B (Items) -> 
1   Cat1                 a,b, c
2   Cat2                 d
3   Cat3                 e
4   Cat4                 f, g 
```

我需要这个：

```
 <- A (Category) ->   <- B (Items) -> 
1   Cat1                 a
2   Cat1                 b
3   Cat1                 c
4   Cat2                 d
5   Cat3                 e
6   Cat4                 f
7   Cat4                 g 
```

这是现有的宏：

```
Option Explicit
Sub Macro1()
    Dim fromCol As String
    Dim toCol As String
    Dim fromRow As String
    Dim toRow As String
    Dim inVal As String
    Dim outVal As String
    Dim commaPos As Integer

    ' Copy from column A to column B.'
    fromCol = "A"
    toCol = "B"
    fromRow = "1"
    toRow = "1"

    ' Go until no more entries in column A.'
    inVal = Range(fromCol + fromRow).Value
    While inVal <> ""

        ' Go until all sub-entries used up.'
        While inVal <> ""
            Range(fromCol + fromRow).Select

            ' Extract each subentry.'
            commaPos = InStr(1, inVal, ",")
            While commaPos <> 0

                ' and write to output column.'
                outVal = Left(inVal, commaPos - 1)
                Range(toCol + toRow).Select
                Range(toCol + toRow).Value = outVal
                toRow = Mid(Str(Val(toRow) + 1), 2)

                ' Remove that sub-entry.'
                inVal = Mid(inVal, commaPos + 1)
                While Left(inVal, 1) = " "
                    inVal = Mid(inVal, 2)
                Wend
                commaPos = InStr(1, inVal, ",")
            Wend

            ' Get last sub-entry (or full entry if no commas).'
            Range(toCol + toRow).Select
            Range(toCol + toRow).Value = inVal
            toRow = Mid(Str(Val(toRow) + 1), 2)
            inVal = ""
        Wend

        ' Advance to next source row.'
        fromRow = Mid(Str(Val(fromRow) + 1), 2)
        Range(fromCol + fromRow).Select
        inVal = Range(fromCol + fromRow).Value
    Wend
End Sub 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T18:03:36.527

我认为这对你有用：

```
Sub ExpandData()
    Const FirstRow = 2
    Dim LastRow As Long
    LastRow = Range("A" & CStr(Rows.Count)).End(xlUp).Row

    ' Get the values from the worksheet
    Dim SourceRange As Range
    Set SourceRange = Range("A" & CStr(FirstRow) & ":B" & CStr(LastRow))

    ' Get sourcerange values into an array
    Dim Vals() As Variant
    Vals = SourceRange.Value

    ' Loop through the rows in the array and split each comma-delimited list of items and put each on its own row
    Dim ArrIdx As Long
    Dim RowCount As Long
    For ArrIdx = LBound(Vals, 1) To UBound(Vals, 1)

        Dim CurrCat As String
        CurrCat = Vals(ArrIdx, 1)

        Dim CurrList As String
        CurrList = Replace(Vals(ArrIdx, 2), " ", "")

        Dim ListItems() As String
        ListItems = Split(CurrList, ",")

        Dim ListIdx As Integer
        For ListIdx = LBound(ListItems) To UBound(ListItems)

            Range("A" & CStr(FirstRow + RowCount)).Value = CurrCat
            Range("B" & CStr(FirstRow + RowCount)).Value = ListItems(ListIdx)
            RowCount = RowCount + 1

        Next ListIdx

    Next ArrIdx

End Sub 
```

# c# - Margin 和 Padding 是否由 ContentControl 实现？

> ID：473555
> 
> 赞同：7
> 
> 时间：2009-01-23T16:32:13.530
> 
> 标签：c#, wpf, custom-controls, padding, margin

我正在开发一个从 System.Windows.Controls.ContentControl 派生的自定义控件。在控件默认模板 (themes\generic.xaml) 中，我使用了一个包装实际内容的 Border 元素。

我的自定义控件是否已经实现了边距和填充（即，根据自定义控件上设置的填充缩小边框）或者我是否可以自己决定应用边距和填充的位置（即，设置边距和填充属性边框元素`{TemplateBinding Margin}`等

提前致谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-23T16:41:18.067

我相信在框架元素中一直执行保证金。但是填充不是。ContentControl 具有“PaddingProperty”，但默认情况下它不执行任何操作。基本上，您将 Content 的 MarginProperty 绑定到内容控件的 Padding 属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-02-27T10:18:09.607

我通过为 ContentControl 定义样式并将 Padding 绑定到模板中定义的 ContentPresenter 的边距解决了这个问题。

```
<Style TargetType="{x:Type ContentControl}">
     <Setter Property="Template">
          <Setter.Value>
               <ControlTemplate TargetType="{x:Type ContentControl}">                          
                    <ContentPresenter Margin="{TemplateBinding Padding}"/>                                
               </ControlTemplate>
          </Setter.Value>
     </Setter>
</Style> 
```

也许这对其他人有帮助。

# iphone - 可以使用 iPhone ImagePicker 对照片进行地理标记吗？

> ID：473560
> 
> 赞同：2
> 
> 时间：2009-01-23T16:33:09.270
> 
> 标签：iphone, geotagging

当调用 ImagePicker 拍照时，不会提示用户允许使用他们的位置来对照片进行地理标记，就像使用本机相机应用程序一样。是否可以在 ImagePicker 中打开或构建地理标记？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T16:48:45.370

好吧，您可以简单地通过 ImagePicker 获取照片，然后提示用户批准获取他们的位置（无论如何您都必须这样做），然后将图像和位置存储在您自己的对象中。

我不相信 Picker 本身会在图像中嵌入纬度/经度。这可能是相机应用程序中其他地方发生的事情。

您可以检查是否使用此库：

[http://code.google.com/p/iphone-exif/downloads/list](http://code.google.com/p/iphone-exif/downloads/list)

祝你好运！

# php - 单元测试：初学者问题

> ID：473561
> 
> 赞同：12
> 
> 时间：2009-01-23T16:33:15.010
> 
> 标签：php, unit-testing

我终于开始进行单元测试，知道我应该做一段时间，但我有几个问题：

*   如果没有方法被覆盖，我应该或不应该在测试子类时重新测试父类？
*   从概念上讲，您如何测试表单的已提交部分？我正在使用 PHP。（**编辑**：我问这个的原因是我有一个高级表单类，它生成一个表单，验证它，过滤它，并通过将类似 JSON 的数组作为输入并委托给各种较小的类来生成任何错误消息。但是，如果不提交表单，我无法测试错误等。**编辑**：[这](https://stackoverflow.com/questions/132342/testing-form-inputs-in-phpunit)看起来可能是一个答案。）
*   如果您在方法中有可选参数，您是否应该为它们存在和不存在时编写测试？
*   单元测试应该以任何方式与测试代码执行时间相结合，还是应该完全分开？
*   是否有任何正当理由不每次都运行完整的测试套件？
*   只是为了让我的术语正确，单元测试中的单元指的是什么？正在测试的课程？方法？参数？还有什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T16:46:32.143

*   测试父母，测试孩子；如果孩子没有覆盖父方法，则无需重新测试。
*   我不确定我是否理解第二个。您可以使用 Selenium 自动测试表单。你是这个意思吗？
*   测试应该包括“快乐路径”和所有边缘情况。如果您有一个可选参数，请编写测试以显示该值存在和不存在的正确操作。
*   单元测试、集成测试、验收测试、负载测试都是不同的想法，可能有一些重叠。
*   我敢打赌有正当的理由，但如果你正在做自动运行测试套件的自动化构建，你为什么不运行它们呢？也许会想到长期运行时间，但这是我能想到的唯一原因。价值在于看到所有这些都继续通过，并且您所做的更改没有破坏任何东西。
*   单元测试对我来说意味着你正在测试的类，它可以有几种方法。我将它们与类联系起来，而不是形式。表单对我来说意味着 UI 和集成测试。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T16:46:11.847

（与您的问题顺序不完全相同）

*   如果完整的测试套件不需要太长时间，您应该始终完整地运行它。您通常不知道更改可能会导致哪些副作用。

*   如果您可以将速度测试与您最喜欢的单元测试工具结合起来，那么您应该这样做。这为您提供了有关更改质量的更多信息。但仅对代码的时间关键部分执行此操作。

*   来自维基百科：“一个单元是应用程序中最小的可测试部分。”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T16:46:48.820

按顺序回答问题：

*   如果父类已经过测试，则避免重复，只测试子类的新方面或子类更改的任何方面。
*   不确定——PHP 做的很少。
*   是 => 测试方法的所有方面。
*   您可以进行一些单元测试来测试性能，但它们将专注于性能，而其他人可能专注于测试功能。不要在同一个测试中混合两者。
*   理想情况下，您应该每次并经常运行它们。有时，如果执行时间很长，您可能需要考虑将它们重构为更小的套件，然后仅在发生变化时执行受影响的套件 - 但仍会定期执行所有操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T16:57:09.843

我会回答我能回答的。

> 如果没有方法被覆盖，我应该或不应该在测试子类时重新测试父类？

您应该全面测试父母，然后*只测试孩子的变化*。

> 如果您在方法中有可选参数，您是否应该为它们存在和不存在时编写测试？

是的，测试任何导致行为改变的东西。

> 单元测试应该以任何方式与测试代码执行时间相结合，还是应该完全分开？

他们应该保持分开。单元测试是测试一个方法做它应该做的事情。您应该在系统级别测试代码执行时间，然后将其分解以查找瓶颈。测试每个单独单元的性能只会导致过早的优化。

> 是否有任何正当理由不每次都运行完整的测试套件？

如果您的测试套件很大并且需要很长时间，您可能希望*在仍在开发时*只运行其中的一个子集。当你（认为你）完成后，你应该运行整个套件，以确保你没有破坏其他任何东西。

> 只是为了让我的术语正确，单元测试中的单元指的是什么？正在测试的课程？方法？参数？还有什么？

“单元”是指被测试的方法。这是将软件分解为有意义的最小单位。A 类的方法可能使用 B 类，但您为该方法编写的任何测试都不应该在意。只需测试该方法。

# javascript - 用于检查复选框是否被选中或未选中的Javascript

> ID：473562
> 
> 赞同：28
> 
> 时间：2009-01-23T16:33:17.567
> 
> 标签：javascript

我有一个 javascript 例程，它正在对一组复选框执行操作，但我想根据用户是选中复选框还是取消选中将单击的复选框设置为选中或未选中的最终操作。

不幸的是，每次我检查它是被选中还是未选中时，它都会返回“on”，表示用户总是在选中该框！任何帮助将不胜感激，我还包括了 javascript。

```
// Uncheck all the checkboxs with the same Tax Credit
for (i=0; i<arrChecks.length; i++)
{
    var attribute = arrChecks[i].getAttribute("xid")
    if (attribute == elementName)
    {
        // if the current state is checked, unchecked and vice-versa
        if (arrChecks[i].value == "on")   // <-- This is always returning true, even if the box is being unchecked
        {
            arrChecks[i].checked = 1;
        } else {
            arrChecks[i].checked = 0;
        }

    } else {
        arrChecks[i].checked = 0;
    }
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-23T16:37:57.077

您应该根据复选框元素的选中属性进行评估。

```
for (i=0; i<arrChecks.length; i++)
{
    var attribute = arrChecks[i].getAttribute("xid")
    if (attribute == elementName)
    {
        // if the current state is checked, unchecked and vice-versa
        if (arrChecks[i].checked)
        {
            arrChecks[i].checked = false;
        } else {
            arrChecks[i].checked = true;
        }

    } else {
        arrChecks[i].checked = false;
    }
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-23T16:36:35.207

a的`value`属性`checkbox`是您设置的：

```
<input type='checkbox' name='test' value='1'> 
```

因此，当有人选中该框时，服务器会收到一个名为of`test`的变量- 您要检查的不是它（无论是否选中，它都不会改变），而是复选框的状态。`value``1``value``checked`

因此，如果您替换此代码：

```
if (arrChecks[i].value == "on") 
{
    arrChecks[i].checked = 1;
} else {
    arrChecks[i].checked = 0;
} 
```

有了这个：

```
arrChecks[i].checked = !arrChecks[i].checked; 
```

它应该工作。为此，您应该使用`true`and`false`而不是`0`and `1`。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T17:00:29.370

要切换复选框，或者您可以使用

```
element.checked = !element.checked; 
```

所以你可以使用

```
if (attribute == elementName)
{
    arrChecks[i].checked = !arrChecks[i].checked;
} else {
    arrChecks[i].checked = false;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-09-21T07:30:25.970

```
function enter_comment(super_id) {
    if (!(document.getElementById(super_id).checked)) {
        alert('selected checkbox is unchecked now')
    } else {
        alert('selected checkbox is checked now');
    }
} 
```

`<input type="checkbox" name="a" id="1" value="1" onclick="enter_comment(this.value)" />`

`<input type="checkbox" name="b" id="2" value="2" onclick="enter_comment(this.value)" />`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-07-22T12:03:55.650

```
function CHeck(){
    var ChkBox = document.getElementById("CheckBox1");
    alert(ChkBox.Checked);
}

<asp:CheckBox ID="CheckBox1" runat="server" onclick="CHeck()" /> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T16:37:39.790

我不确定问题是什么，但我很确定这会解决它。

```
for (i=0; i<arrChecks.length; i++)
    {
        var attribute = arrChecks[i].getAttribute("xid")
        if (attribute == elementName)
        {
            if (arrChecks[i].checked == 0)  
            {
                arrChecks[i].checked = 1;
            } else {
                arrChecks[i].checked = 0;
            }

        } else {
            arrChecks[i].checked = 0;
        }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T16:41:51.747

还要确保在 Firefox 和 IE 中都对其进行测试。JS 操作复选框存在一些令人讨厌的错误。

# c# - asp.net 开源项目作为c#中的学习资源

> ID：473565
> 
> 赞同：9
> 
> 时间：2009-01-23T16:34:03.573
> 
> 标签：c#, asp.net, open-source

我正在寻找 c# 中的开源 asp.net（最好是 .net 2.0）项目。不管是某种商店还是cms或其他任何东西都没有关系。重要的是项目的大小必须至少是中等大小（不是一个开发人员在 2 周内完成的简单应用程序），如果项目包含单元测试和某种案例研究，那将是一个很大的优势.

我想将此项目用作学习资源。我知道有很多关于 asp.net 的书籍和网络资源，但我想看看如何实施更大的项目。我对应用程序某些部分的用户权限的实现、html 和应用程序逻辑之间的分离特别感兴趣，我想看看开发人员是否使用.net web 控件或编写自己的自定义控件。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T16:52:37.590

同样的问题：[**好的 asp.net (C#) 应用程序？**](https://stackoverflow.com/questions/90560/good-asp-net-c-apps)

[BlogEngine.Net](http://www.dotnetblogengine.net/)被提及两次：

> 它在 asp.net 中实现了大量不同的功能和常见需求，并允许它完全可定制且非常易于理解。它可以与 XML 或 SQL（您的选择）一起使用，并且拥有庞大的社区。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:41:01.857

[ScrewTurn Wiki](http://www.screwturn.eu/)是一个不错的开源项目。

> ScrewTurn Wiki 是一个快速、强大且简单的 ASP.NET wiki 引擎，可在几分钟内安装并提供不同的软件包。

我们将它用于我们团队的文档。从代码中可以学到很多不同的东西：主题化、压缩、如何编写 RSS 提要、配置、多语言支持......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:38:47.323

[在http://www.codeplex.com](http://www.codeplex.com)上有很多开源 asp.net 项目，或者您也可以在[http://www.asp.net的 ASP.NET 主页上查看任意数量的示例站点](http://www.asp.net)

# java - JSTL 和经过身份验证的 Web 服务

> ID：473566
> 
> 赞同：1
> 
> 时间：2009-01-23T16:34:22.887
> 
> 标签：java, web-services, authentication, jstl

我可以使用 JSTL 访问经过身份验证的 Web 服务吗？（基于表单的身份验证）

如果我不能使用 JSTL 来做到这一点，还有其他方法可以从 JSP 中做到吗？

* * *

也许我需要提供更多信息。我正在使用核心库：

`<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>`

和导入标签，如：

`<c:import var="xml" url="http://my.service.com/api/xml"/>`

需要基于表单的身份验证的 Web 服务在哪里`http://my.service.com/api/xml`- 如果我尝试在浏览器中访问它，系统会提示我在 Web 表单中输入用户名和密码，而不是弹出窗口。

*抱歉，正如您所知，我不是网络服务专家 - 祈祷一个简单的解决方案 :)*

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T16:42:21.513

JSTL == JSP 标准标签库？如果是这样，我看不出 JSTL 和 JSP 有何不同。

如果将标记添加到 HTML 或 SOAP 标头，则假设 Web 服务知道如何获取它们以及如何使用它们。基于表单的身份验证使用 j_username 和 j_password 作为表单元素参数名称。

我想说安全应该是一个跨领域的问题。过滤器或方面应该能够从 HTTP 标头中获取这些值并为您进行身份验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T07:13:49.457

@Brabster 正如@duffymo 所说，jstl 与Web 服务身份验证无关。

如果您需要避免在某些 JSP 中显示身份验证页面，也许您可​​以使用处理身份验证的自定义标记。您将如何使用 main 方法在一个简单的控制台程序中对您的 Web 服务进行身份验证？如果您知道怎么做，那么将该代码集成到自定义标签中就很容易了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-16T08:19:27.333

这是一个开源库[http://spnego.sourceforge.net/protected_soap_service.html](http://spnego.sourceforge.net/protected_soap_service.html)，其中有一个关于连接到通过集成 Windows 身份验证保护的 Web 服务的示例。

该库被实现为一个 servlet 过滤器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-28T00:14:15.137

从 JSTL 调用 Web 服务进行身份验证的目的是什么，而不是直接从 JSP/JSTL 页面进行，例如：

```
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
<%@ taglib prefix="sql" uri="http://java.sun.com/jstl/sql" %>

<c:remove var="validUser" scope="session"/>
<c:if test="${empty param.user_name || empty param.password}">
 <c:redirect url="login.jsp"/>
</c:if> 

<sql:query var="users">
 SELECT 1 FROM users WHERE user_name = ? AND password = ?
 <sql:param value="${param.user_name}" />
 <sql:param value="${param.password}" />
</sql:query>
<c:if test="${users.rowCount == 0}">
 <c:redirect url="login.jsp"/>
</c:if> 
```

请记住，为了实现表单身份验证，您必须在 web.xml 文件中指明它：

```
<login-config>
 <auth-method>FORM</auth-method>
 <form-login-config>
  <form-login-page>/main/login.jsp</form-login-page>
 </form-login-config>
</login-config> 
```

如果您想要使用标记库来使用一些 Web 服务，您可以使用 Java 社区的 JSP[标记库用于 Web 服务](http://jcp.org/en/jsr/detail?id=267)。

# wpf - 如何在 WPF XAML 中制作加载图形？

> ID：473568
> 
> 赞同：5
> 
> 时间：2009-01-23T16:34:42.277
> 
> 标签：wpf, xaml, listbox

所以我有一个小的 WPF XAML，它可以获取我的 RSS 提要的标题并将它们放在一个 ListBox 中。

但是，加载大约需要 2 秒。

在数据存在之前，如何在 ListBox 中放置某种 AJAXy 旋转图形？

这是代码：

```
<Window x:Class="WpfApplication5.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <StackPanel>
        <StackPanel.Resources>
            <XmlDataProvider x:Key="ExternalColors" Source="http://www.tanguay.info/web/rss" XPath="/"/>
        </StackPanel.Resources>
        <TextBlock Text="RSS Feeds:"/>
        <ListBox Name="lbColor" Height="200" IsSynchronizedWithCurrentItem="True" ItemsSource="{Binding Source={StaticResource ExternalColors}, XPath=//item/title}"/>

        <TextBlock Text="You selected this feed:"/>
        <TextBox
            Text="{Binding ElementName=lbColor, Path=SelectedValue}"
            Background="{Binding ElementName=lbColor, Path=SelectedValue}">
        </TextBox>
    </StackPanel>
</Window> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T12:58:37.383

我的解决方案是在我的数据和 WPF 之间实现一个异步层。这将 WPF 与数据端的任何延迟完全分离，并为我提供了很好的事件和属性来触发和绑定。

[我在View Model 或 Presenter Model 架构](http://blogs.msdn.com/dancre/archive/2006/10/11/datamodel-view-viewmodel-pattern-series.aspx)之上构建了它。我写[了一篇关于基础知识的博文](http://dasz.at/index.php/2008/11/doing-gui-architecture-the-right-way/)和一篇关于[我的异步视图模型方法的长篇](http://dasz.at/index.php/2009/02/a-quick-sketch-of-asynchronous-view-models/)文章。

这是微调器的 XAML。`DataContext`它需要执行加载的视图模型。根据其`State`，`LoadingIndicator`将使自己可见并再次折叠。

```
<UserControl x:Class="App.WPF.CustomControls.LoadingIndicator"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Height="20"
             Width="20">
    <UserControl.Style>
        <Style TargetType="{x:Type UserControl}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding State}"
                             Value="Active">
                    <Setter Property="Visibility"
                            Value="Collapsed" />
                </DataTrigger>
                <DataTrigger Binding="{Binding State}"
                             Value="Loading">
                    <Setter Property="Visibility"
                            Value="Visible" />
                </DataTrigger>
                <DataTrigger Binding="{Binding State}"
                             Value="Invalid">
                    <Setter Property="Background"
                            Value="Red" />
                    <Setter Property="Visibility"
                            Value="Visible" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Style>
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="UserControl.Loaded">
            <BeginStoryboard>
                <Storyboard TargetName="Rotator"
                            TargetProperty="Angle">
                    <DoubleAnimation By="360"
                                     Duration="0:0:2"
                                     RepeatBehavior="Forever" />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </UserControl.Triggers>
    <Rectangle Stroke="Aqua"
               StrokeThickness="2"
               Width="10"
               Height="10">
        <Rectangle.RenderTransform>
            <RotateTransform x:Name="Rotator"
                             Angle="0"
                             CenterX="5"
                             CenterY="5" />
        </Rectangle.RenderTransform>
    </Rectangle>
</UserControl> 
```

[来源版权所有 © 2009 [dasz.at OG](http://dasz.at/)；这项工作是在[麻省理工学院许可下获得许可](http://opensource.org/licenses/mit-license.php)的。]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:38:16.577

您可以创建 spinny-loady-thingy 并将其添加到 ListBox 的 AdornerLayer。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T16:42:26.567

以下视频来自 mix08，并引导您完成您想要的操作。

[第1部分](http://sessions.visitmix.com/?selectedSearch=CT01)

[第2部分](http://sessions.visitmix.com/?selectedSearch=CT02)

（如果可能，请连续观看。它在银光下，但会为您指明正确的方向。）

玩得开心。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T17:47:39.320

您可以利用事件的属性`IsAsynchronous`（我没有尝试）：查看文档。;-)`XmlDataProvider``DataChanged`

# .net - Unity 框架 DependencyAttribute 仅适用于公共属性？

> ID：473575
> 
> 赞同：9
> 
> 时间：2009-01-23T16:36:12.693
> 
> 标签：.net, unity-container

我试图在我的代码中清理一些可访问性的东西，并且无意中破坏了 Unity 依赖注入。过了一会儿，我意识到我标记了一些我不想在我的 DLL 之外暴露给内部的公共属性。然后我开始遇到异常。

因此，似乎在 Unity 中使用 [Dependency] 属性仅适用于公共属性。我认为这是有道理的，因为内部和私有道具对 Unity 程序集不可见，但是拥有一堆你*永远不*希望任何人设置或能够设置的公共属性*感觉真的很脏，除了 Unity。*

 *有没有办法让统一设置内部或私有属性？

这是我希望通过的单元测试。目前只有公共道具测试通过：

```
 [TestFixture]
public class UnityFixture
{
    [Test]
    public void UnityCanSetPublicDependency()
    {
        UnityContainer container = new UnityContainer();
        container.RegisterType<HasPublicDep, HasPublicDep>();
        container.RegisterType<TheDep, TheDep>();

        var i = container.Resolve<HasPublicDep>();
        Assert.IsNotNull(i);
        Assert.IsNotNull(i.dep);
    }

    [Test]
    public void UnityCanSetInternalDependency()
    {
        UnityContainer container = new UnityContainer();
        container.RegisterType<HasInternalDep, HasInternalDep>();
        container.RegisterType<TheDep, TheDep>();

        var i = container.Resolve<HasInternalDep>();
        Assert.IsNotNull(i);
        Assert.IsNotNull(i.dep);
    }

    [Test]
    public void UnityCanSetPrivateDependency()
    {
        UnityContainer container = new UnityContainer();
        container.RegisterType<HasPrivateDep, HasPrivateDep>();
        container.RegisterType<TheDep, TheDep>();

        var i = container.Resolve<HasPrivateDep>();
        Assert.IsNotNull(i);
        Assert.IsNotNull(i.depExposed);
    }
}

public class HasPublicDep
{
    [Dependency]
    public TheDep dep { get; set; }
}

public class HasInternalDep
{
    [Dependency]
    internal TheDep dep { get; set; }
}

public class HasPrivateDep
{
    [Dependency]
    private TheDep dep { get; set; }

    public TheDep depExposed
    {
        get { return this.dep; }
    }
}

public class TheDep
{
} 
```

* * *

更新：

我注意到调用堆栈来设置传递的属性：

```
UnityCanSetPublicDependency()
--> Microsoft.Practices.Unity.dll
--> Microsoft.Practices.ObjectBuilder2.dll
--> HasPublicDep.TheDep.set() 
```

因此，为了至少使内部版本正常工作，我将这些添加到我的程序集的属性中：

```
[assembly: InternalsVisibleTo("Microsoft.Practices.Unity")]
[assembly: InternalsVisibleTo("Microsoft.Practices.Unity.Configuration")]
[assembly: InternalsVisibleTo("Microsoft.Practices.ObjectBuilder2")] 
```

然而，没有任何变化。Unity/ObjectBuilder 仍然不会设置内部属性

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T11:16:30.627

另一种解决方案是在将依赖项传递给类的方法上使用 [InjectionMethod]。

```
public class MyClass {
private ILogger logger;

[InjectionMethod]
public void Init([Dependency] ILogger logger)
{
    this.logger = logger; 
```

...ETC

* * *

并称它为：

```
container.BuildUp<MyClass>(instanceOfMyClass); 
```

它将使用来自统一的依赖关系调用 Init。

没有完全解决问题，我知道...但是

:-) Ĵ

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T16:50:49.077

如果属性是 get-only，则使用[构造函数注入](http://msdn.microsoft.com/en-us/library/cc440940.aspx)而不是属性注入更有意义。

如果 Unity*确实*使用反射来设置私有或内部成员，它将受到代码访问安全约束。具体来说，它不会在低信任环境中工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-10-16T13:03:58.287

这个问题本身似乎是一个误解。

关于核心声明：

> 除了 Unity 之外，您永远不希望任何人设置或能够设置的一堆公共属性。

您想在单元测试中设置它们，或者您将如何传递依赖模拟？即使您没有单元测试，拥有任何东西（除了 Unity 的一些魔法）都无法设置的依赖项也是一个奇怪的想法。您是否希望您的代码如此依赖支持工具？

此外，拥有公共属性根本不是问题，因为您的代码必须依赖于接口，而不是实现（SOLID 原则之一）。如果您不遵循此原则 - 您没有理由使用 Unity。当然，您不会在接口中声明依赖项，因此消费类不知道它们。

你已经被告知最好使用构造函数注入，但是属性注入也有它的优点。它允许以较少的修改添加新的依赖项（特别是，您可以完全避免更改现有的单元测试，只添加新的）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-06-09T19:19:13.093

**Enterprise Library 5.0 的更新**

正如 rally52rs 警告的那样，升级到 EntLib5.0 会破坏他的实施。使用与 Rally 相同的方法，我对新代码库进行了反思，并制定了以下 5.0 兼容版本的 InternalConstructorSelectorPolicy。

*请注意，我的版本专门将自身限制为 FindLongestConstructor 方法中的内部构造函数。在这一点上，我的代码在功能上与 Rally 的不同*。

```
public class InternalConstructorSelectorPolicy : IConstructorSelectorPolicy, IBuilderPolicy 
{
    private IDependencyResolverPolicy CreateResolver(ParameterInfo parameter)
    {
        List<DependencyResolutionAttribute> attrs = parameter.GetCustomAttributes(false).OfType<DependencyResolutionAttribute>().ToList<DependencyResolutionAttribute>();
        if (attrs.Count > 0)
        {
            return attrs[0].CreateResolver(parameter.ParameterType);
        }
        return new NamedTypeDependencyResolverPolicy(parameter.ParameterType, null);
    }

    private SelectedConstructor CreateSelectedConstructor(IBuilderContext context, IPolicyList resolverPolicyDestination, ConstructorInfo ctor)
    {
        SelectedConstructor result = new SelectedConstructor(ctor);
        foreach (ParameterInfo param in ctor.GetParameters())
        {
            string key = Guid.NewGuid().ToString();
            IDependencyResolverPolicy policy = this.CreateResolver(param);
            resolverPolicyDestination.Set<IDependencyResolverPolicy>(policy, key);
            DependencyResolverTrackerPolicy.TrackKey(resolverPolicyDestination, context.BuildKey, key);
            result.AddParameterKey(key);
        }
        return result;
    }

    private static ConstructorInfo FindInjectionConstructor(Type typeToConstruct)
    {
        ConstructorInfo[] injectionConstructors = typeToConstruct
            .GetConstructors(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic)
            .Where<ConstructorInfo>(delegate(ConstructorInfo ctor)
        {
            return ctor.IsDefined(typeof(InjectionConstructorAttribute), true);
        }).ToArray<ConstructorInfo>();
        switch (injectionConstructors.Length)
        {
            case 0:
                return null;

            case 1:
                return injectionConstructors[0];
        }
        throw new InvalidOperationException(string.Format("Multiple constructors found for {0}" , typeToConstruct.Name ));
    }

    private static ConstructorInfo FindLongestConstructor(Type typeToConstruct)
    {
        var constructors =
            Array.FindAll(
                typeToConstruct.GetConstructors(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic),
                ctor => !ctor.IsFamily && !ctor.IsPrivate);  //Filter out protected and private constructors

        Array.Sort<ConstructorInfo>(constructors, new ConstructorLengthComparer());
        switch (constructors.Length)
        {
            case 0:
                return null;

            case 1:
                return constructors[0];
        }
        int paramLength = constructors[0].GetParameters().Length;
        if (constructors[1].GetParameters().Length == paramLength)
        {
            throw new InvalidOperationException(string.Format("Ambiguous constructor found for {0}", typeToConstruct.Name));
        }
        return constructors[0];
    }

    public SelectedConstructor SelectConstructor(IBuilderContext context, IPolicyList resolverPolicyDestination)
    {
        Type typeToConstruct = context.BuildKey.Type;
        ConstructorInfo ctor = FindInjectionConstructor(typeToConstruct) ?? FindLongestConstructor(typeToConstruct);
        if (ctor != null)
        {
            return this.CreateSelectedConstructor(context, resolverPolicyDestination, ctor);
        }
        return null;
    }

    // Nested Types
    private class ConstructorLengthComparer : IComparer<ConstructorInfo>
    {
        // Methods
        public int Compare(ConstructorInfo x, ConstructorInfo y)
        {
            return (y.GetParameters().Length - x.GetParameters().Length);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T18:51:11.457

好吧，在反射器中四处闲逛之后，我想通了。默认情况下，为构造函数注入调用找到构造函数的代码：

```
ConstructorInfo[] constructors = typeToConstruct.GetConstructors() 
```

如果没有 BindingFlags，那只会检测公共构造函数。使用一些技巧（如从反射器复制/粘贴），您可以创建一个 UnityContainerExtension，它与默认实现执行所有相同的操作，但将对 GetConstructors() 的调用更改为：

```
ConstructorInfo[] constructors = typeToConstruct..GetConstructors(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic) 
```

然后将扩展添加到统一容器中。实现的扩展是~100行代码，所以我没有在这里粘贴。如果有人想要，请告诉我...

新的工作测试用例。请注意，所有 Unity 创建的类现在都是内部的：

```
[TestFixture]
public class UnityFixture
{
    [Test]
    public void UnityCanSetInternalDependency()
    {
        UnityContainer container = new UnityContainer();
        container.AddNewExtension<InternalConstructorInjectionExtension>();
        container.RegisterType<HasInternalDep, HasInternalDep>();
        container.RegisterType<TheDep, TheDep>();

        var i = container.Resolve<HasInternalDep>();
        Assert.IsNotNull(i);
        Assert.IsNotNull(i.dep);
    }
}

internal class HasInternalDep
{
    internal HasInternalDep(TheDep dep)
    {
        this.dep = dep;
    }

    internal TheDep dep { get; set; }
}

internal class TheDep
{
} 
```

我确信我可以做一个扩展来做同样的事情来解决非公共属性，但是那个代码要复杂得多:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-30T02:12:21.663

@rally25rs，虽然该帖子已有两年多的历史，但它仍然排名很高（视图/谷歌等）所以我想我会加我的 2 美分。我遇到了同样的问题并最终选择了这个解决方案：[UnityContainer 和内部构造函数](https://stackoverflow.com/questions/6412224/unitycontainer-and-internal-constructor/6412636#6412636)。这意味着评论，但我还不能发表评论。

您可能已经看到并知道这一点，但它可能对其他任何查看的人有用：该`InternalsVisibleTo()`属性永远不会起作用 - 那是因为 Unity 没有直接调用您的类。相反，它使用反射并检查`Type`. 当然，`Type`不会因为属性的存在而改变。要在接收端“享受”内部可见等的好处，您必须显式调用内部 c'tor（或属性）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T17:15:09.963

根据 Kent B 的回答，我改为使用构造函数注入，它适用于公共类。然而，根本问题仍然存在，您想要分配或由 Unity 分配的任何内容都必须是公开的。这包括类本身。

新的单元测试：

```
 [TestFixture]
public class UnityFixture
{
    [Test]
    public void UnityCanSetInternalDependency()
    {
        UnityContainer container = new UnityContainer();
        container.RegisterType<HasInternalDep, HasInternalDep>();
        container.RegisterType<TheDep, TheDep>();

        var i = container.Resolve<HasInternalDep>();
        Assert.IsNotNull(i);
        Assert.IsNotNull(i.dep);
    }
    }

internal class HasInternalDep
{
    internal HasInternalDep(TheDep dep)
    {
        this._Dep = dep;
    }

    private TheDep _Dep;
        internal TheDep dep
        {
            get { return _Dep; }
        }
}

internal class TheDep
{
}
} 
```

使用程序集属性：

```
[assembly: InternalsVisibleTo("Microsoft.Practices.Unity")]
[assembly: InternalsVisibleTo("Microsoft.Practices.Unity.Configuration")]
[assembly: InternalsVisibleTo("Microsoft.Practices.ObjectBuilder2")] 
```

失败并出现错误：

```
The type HasInternalDep does not have an accessible constructor.
at Microsoft.Practices.Unity.UnityContainer.DoBuildUp(Type t, String name) 
```

所以总的来说，如果你想使用 Unity，你基本上只需要将所有内容都标记为公开。对于实用程序/库 .dll 来说真的很难看...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-26T17:43:27.530

这是我的内部构造函数注入器扩展类：

**潜在的大问题：**其中 99% 是来自统一版本 4.1.0.0 的 .NET 反射器的 Unity 代码的复制/粘贴。较新版本的 Unity 可能会更改实现并破坏此扩展，或导致 flakey 错误。你被警告了！

```
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Reflection;
using Microsoft.Practices.ObjectBuilder2;
using Microsoft.Practices.Unity;
using Microsoft.Practices.Unity.ObjectBuilder;
using Microsoft.Practices.Unity.Utility;

namespace MyApp.Unity.Configuration
{
    /// <summary>
    /// This extension changes the behavior of Unity constructor injection to allow the use of non-public constructors.
    /// By default, Unity/ObjectBuilder would call Type.GetConstructors() to get the constructors. With the default binding
    /// flags, this only returns public constructors.
    /// The code here is 99% copy/paste from Reflector's dissassembly of the default Unity/OB implementation.
    /// My only change was to add binding flags to get all constructors, not just public ones.
    /// For more info, see: Microsoft.Practices.Unity.ObjectBuilder.DefaultUnityConstructorSelectorPolicy
    /// </summary>
    public class InternalConstructorSelectorPolicy : IConstructorSelectorPolicy
    {
        protected IDependencyResolverPolicy CreateResolver(ParameterInfo param)
        {
            List<DependencyResolutionAttribute> list = new List<DependencyResolutionAttribute>(Sequence.OfType<DependencyResolutionAttribute>(param.GetCustomAttributes(false)));
            if (list.Count > 0)
            {
                return list[0].CreateResolver(param.ParameterType);
            }
            return new NamedTypeDependencyResolverPolicy(param.ParameterType, null);
        }

        private SelectedConstructor CreateSelectedConstructor(IBuilderContext context, ConstructorInfo ctor)
        {
            SelectedConstructor constructor = new SelectedConstructor(ctor);
            foreach (ParameterInfo info in ctor.GetParameters())
            {
                string buildKey = Guid.NewGuid().ToString();
                IDependencyResolverPolicy policy = this.CreateResolver(info);
                context.PersistentPolicies.Set<IDependencyResolverPolicy>(policy, buildKey);
                DependencyResolverTrackerPolicy.TrackKey(context.PersistentPolicies, context.BuildKey, buildKey);
                constructor.AddParameterKey(buildKey);
            }
            return constructor;
        }

        private ConstructorInfo FindInjectionConstructor(Type typeToConstruct)
        {
            ConstructorInfo[] infoArray = Array.FindAll<ConstructorInfo>(typeToConstruct.GetConstructors(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic), delegate(ConstructorInfo ctor)
            {
                return ctor.IsDefined(typeof(InjectionConstructorAttribute), true);
            });
            switch (infoArray.Length)
            {
                case 0:
                    return null;

                case 1:
                    return infoArray[0];
            }
            throw new InvalidOperationException(string.Format(CultureInfo.CurrentCulture, "Resources.MultipleInjectionConstructors", new object[] { typeToConstruct.Name }));
        }

        private ConstructorInfo FindLongestConstructor(Type typeToConstruct)
        {
            ConstructorInfo[] constructors = typeToConstruct.GetConstructors(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic);
            Array.Sort<ConstructorInfo>(constructors, new ConstructorLengthComparer());
            switch (constructors.Length)
            {
                case 0:
                    return null;

                case 1:
                    return constructors[0];
            }
            int length = constructors[0].GetParameters().Length;
            if (constructors[1].GetParameters().Length == length)
            {
                throw new InvalidOperationException(string.Format(CultureInfo.CurrentCulture, "Resources.AmbiguousInjectionConstructor", new object[] { typeToConstruct.Name, length }));
            }
            return constructors[0];
        }

        public virtual SelectedConstructor SelectConstructor(IBuilderContext context)
        {
            Type typeToConstruct = BuildKey.GetType(context.BuildKey);
            ConstructorInfo ctor = this.FindInjectionConstructor(typeToConstruct) ?? this.FindLongestConstructor(typeToConstruct);
            if (ctor != null)
            {
                return this.CreateSelectedConstructor(context, ctor);
            }
            return null;
        }

        // Nested Types
        private class ConstructorLengthComparer : IComparer<ConstructorInfo>
        {
            // Methods
            public int Compare(ConstructorInfo x, ConstructorInfo y)
            {
                return (y.GetParameters().Length - x.GetParameters().Length);
            }
        }
    }

    /// <summary>
    /// Registeres the InternalConstructorSelectorPolicy with the Unity container.
    /// </summary>
    public class InternalConstructorInjectionExtension : UnityContainerExtension
    {
        protected override void Initialize()
        {
            this.Context.Policies.SetDefault(typeof(IConstructorSelectorPolicy), new InternalConstructorSelectorPolicy());
        }
    }
} 
```

# .net - .Net 的简单 SQL 语句生成器

> ID：473587
> 
> 赞同：0
> 
> 时间：2009-01-23T16:40:18.990
> 
> 标签：.net, sql, .net-2.0

作为一名自由职业者，我已经为一家更大的公司参与了一个正在进行的 .Net 2.0 Web 应用程序项目。他们的 DAL 有许多手动构造和执行 SQL 语句的函数——其中许多很长、很乱，因此难以理解和调试。我写了一个简单的“sql helper”，它可以让我写出这样的东西：

```
sqlh.addValue("名称", 名称);
sqlh.addValue("地址，地址);
sqlh.addLiteral("created", "getDate()");

string sql = String.Format("INSERT INTO [Table1] ({0}) 值 ({1})", sqlh.getInsertFields(), sqlh.getInsertValues());

```

它处理空值，也适用于更新。就是这样。

理想情况下，我会使用 Microsoft 数据应用程序块或 LINQ 或其他东西，但此时不可能进行重大的架构更改。这种方法为我节省了很多时间，但似乎是使用“社区认可”解决方案最好解决的问题。

是否有来自 Microsoft 或其他公司的流行、轻量级的解决方案可以实现类似的结果？

**编辑**

虽然到目前为止描述的 SqlParameter 解决方案是对纯手动语句构建方法的改进，但我认为我仍然更喜欢我的解决方案，在该解决方案中，在查询中添加或删除字段只会影响一行。有更好的吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T16:54:36.277

我创建了自己的存储过程来根据给定的表模式创建插入语句，我认为我非常棒。然后我发现了这个：

> [创建过程 sp_generate_inserts](http://vyaskn.tripod.com/code/generate_inserts.txt)

**编辑**

我知道我在之前的 SO 帖子中发现了该脚本，但我现在找不到它，如果其他人知道或知道，请编辑/或添加评论，我会编辑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:56:01.937

您可以从 Microsoft 获得多种选择：ADO.NET 或 Linq2Sql 是目前流行的选择。但是您提到的链接，从生成 SQL 转换为 ORM 需要大量工作。

为了使 SQL 的创建更加直接和安全，您应该考虑使用 SQL 参数。这是一个例子：

```
using (SqlCommand saveCommand = DbUtil.CreateSqlCommand(context.Transaction)) {
    saveCommand.CommandText =
        "INSERT INTO Hit (" +
            "Id, PersonId, TeamId, PlayerId" +
        ") VALUES (" +
            "@Id, @PersonId, @TeamId, @PlayerId" +
        ")";

    DbUtil.AddParameter(saveCommand, "@Id", SqlDbType.UniqueIdentifier, Guid.NewGuid());
    DbUtil.AddParameter(saveCommand, "@PersonId", SqlDbType.UniqueIdentifier, hit.PersonId);
    DbUtil.AddParameter(saveCommand, "@TeamId", SqlDbType.UniqueIdentifier, hit.TeamId);
    DbUtil.AddParameter(saveCommand, "@PlayerId", SqlDbType.UniqueIdentifier, hit.PlayerId);

    saveCommand.ExecuteNonQuery();
} 
```

这会将您的参数列表与 SQL 分开。此外，我们的 SQL 更加清晰易读。示例中的 DbUtil 只是我编写的一个辅助函数，用于从连接或事务创建我的 sql 命令。也类似于您的 sqlh.addValue，我有一个 DbUtil.AddParameter，它通过接收命令、变量名、数据类型和值来工作。这是一个包含重载方法的示例：

```
internal static SqlParameter CreateSqlParameter(
    string parameterName,
    SqlDbType dbType,
    ParameterDirection direction,
    object value
) {
    SqlParameter parameter = new SqlParameter(parameterName, dbType);

    if (value == null) {
        value = DBNull.Value;
    }

    parameter.Value = value;
    parameter.Direction = direction;
    return parameter;
}

internal static SqlParameter AddParameter(
    SqlCommand sqlCommand,
    string parameterName,
    SqlDbType dbType
) {
    return AddParameter(sqlCommand, parameterName, dbType, null);
}

internal static SqlParameter AddParameter(
    SqlCommand sqlCommand,
    string parameterName,
    SqlDbType dbType,
    object value
) {
    return AddParameter(sqlCommand, parameterName, dbType, ParameterDirection.Input, value);
}

internal static SqlParameter AddParameter(
    SqlCommand sqlCommand,
    string parameterName,
    SqlDbType dbType,
    ParameterDirection direction,
    object value
) {
    SqlParameter parameter = CreateSqlParameter(parameterName, dbType, direction, value);
    sqlCommand.Parameters.Add(parameter);
    return parameter;
}

internal static SqlParameter AddParameter(
    SqlCommand sqlCommand,
    string parameterName,
    SqlDbType dbType,
    ParameterDirection direction
) {
    SqlParameter parameter = CreateSqlParameter(parameterName, dbType, direction, null);
    sqlCommand.Parameters.Add(parameter);
    return parameter;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:51:55.860

SqlCommand 和 SQLParameter 对象可能对您有用：

```
 Dim sc As New SqlClient.SqlCommand

  Dim sp As New SqlClient.SqlParameter("@value", SqlDbType.VarChar)
  sp.Value = "test"

  sc.Parameters.Add(sp)
  sc.CommandText = "select column1, column2 from table where column3=@value"

  sc.ExecuteReader() 
```

它的 vb.net 但你明白了。这将有助于防止 sql 注入，并且看起来整洁且可读。

不要忘记设置您的连接字符串等。

# excel - 如果某个单元格的值在特定时间内超出限制，Excel 可以发出通知吗？

> ID：473591
> 
> 赞同：0
> 
> 时间：2009-01-23T16:41:14.353
> 
> 标签：excel, time, intervals

我想知道如果某个单元格的值在某个时间间隔内超出限制，Excel是否可以通知我？

示例：单元格 A1 的值为 10，限制为 +1 和 -1，间隔为 1 分钟现在我想通知 A1 的值是否在 1 分钟的间隔内低于 9 或高于 11

有谁知道这是否可以做到？

先感谢您！克里斯蒂安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T20:07:55.437

您可以在单元格所在的工作表上使用更改事件，该事件在单元格更改时触发。我不知道为什么，但是当事件在我的 excel 2003 上触发时，安装目标范围什么都不是，但无论哪种方式，您都可以在单元格更改时检查您的单元格，并将先前的值保留在全局变量，以及每个观察单元最后一次更改的时间。知道单元格的最后更改时间及其最后值应该足以让您完成所需的操作......

# ms-access - MS Access 将记录移动到字段中

> ID：473601
> 
> 赞同：3
> 
> 时间：2009-01-23T16:44:18.387
> 
> 标签：ms-access, field, record, denormalization

我与我不拥有且无法更改的数据库建立了 ODBC 连接。我要做的是使相关记录合并为一条记录。关系是一对多。

我有一个学生管理系统，想要导出一个提供自动标注服务（由呼叫收费）的呼叫列表。如果有多个学生住在那里，我希望能够只给一个房子打电话一次。

所需的调出文件结构：

```
PHONE     Inst1                  Inst2                  Inst3
555-5555  John was absent today  Jane was absent today  Joe was absent today 
```

与现有数据相比：

```
PHONE     Inst
555-5555  John was absent today  
555-5555  Jane was absent today  
555-5555  Joe was absent today 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T17:47:21.863

我的第一个倾向是使用交叉表查询。但是，这可能会有点毛茸茸。

如何在模块中剪切一些 VBA 代码以将它们连接在一起，然后插入另一个表（如下所示 - 完全未经测试并且可能在某处损坏）？

```
dim strAbsent as string
dim currPhone as string
dim lastPhone as string
Dim db As Database
Dim rstAbsent As Recordset
Dim rstAbsentReport As Recordset

Set db = CurrentDb
Set rstAbsent = dbV.OpenRecordset("select * from Absent", _
                                    dbOpenDynaset, dbSeeChanges)
Set rstAbsentReport = dbV.OpenRecordset("select * from AbsentReport", _
                                        dbOpenDynaset, dbSeeChanges)

'...
do while not rstAbsentReport.EOF
    currPhone = rstAbsentReport("phone")
    lastPhone = currPhone 
    do while currPhone = lastPhone _
            and not rstAbsentReport.EOF
        strAbsent = strAbsent & ";" & rstAbsentReport ("comment")
        'Yes I know concatenating strings this way is terribly inefficient

        rstAbsentReport.MoveNext
        if not rstAbsentReport.EOF then
            currPhone = rstAbsentReport("phone")
        end if
    last
    rstAbsent.AddNew
    rstAbsent ("call") = strAbsent
    rstAbsent.Update
loop
'... clean up of recordset variables left as an exercise 
```

# sql - 基本的多对多 sql 选择查询

> ID：473604
> 
> 赞同：0
> 
> 时间：2009-01-23T16:44:32.133
> 
> 标签：sql, ms-access, many-to-many

我认为这应该很容易，但它在逃避我。我在帐户和帐户组之间建立了多对多的关系。一个帐户可以在零个或多个组中，所以我使用标准连接表。

```
Accounts 
--------
ID
BankName
AcctNumber
Balance

AccountGroups
-------------
ID
GroupName

JoinAccountsGroups
------------------
AID
GID 
```

我正在使用 MS Access，FWIW。此外，这适用于低带宽情况，因此代码优化不如简单/可读性重要。

我使用 php 作为表示层，所以 Access 的基本结果很好。

至于如何处理多结果情况，我实际上有两件事我正在尝试构建。第一个在一个列中列出了所有组，因此：

```
Bank       AcctNum       Balance    Groups
--------|--------------|----------|----------------
Citi       930938        400        Payroll
HSBC       8372933       100        Monthly, Payroll
Wells      09837         800        -
Chase      8730923       250        Monthly 
```

第二个是主从列表：

```
Name          AcctNum    Balance
------------|----------|----------
Payroll (2)              500
  Citi        930938     400
  HSBC        8372933    100         
..................................
Monthly (2)              350
  HSBC        8372933    100         
  Chase       8730923    250
..................................
Wells         09837      800 
```

对于主从细节，我的计划只是从数据库中获得一个大的结果集，并根据需要在 php 中调整它。由于无论如何都会在 php 中进行一些重要的后处理，也许我应该只做三个单独的查询并在那里进行连接。（因为我更喜欢那种语言。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T20:34:37.410

这

```
SELECT a.BankName, a.AcctNumber, a.Balance, ag.GroupName
FROM (Accounts a 
      LEFT JOIN JoinAccountsGroups jag 
      ON a.ID = jag.AID) 
      LEFT JOIN AccountGroups ag
      ON jag.GID = ag.GroupName; 
```

将为第一个表选择数据，但是要连接组（每月、工资单），您需要一个用户定义的函数 (UDF)，Jet 无法使用该函数，因此需要在 PHP 中进行处理。

您可能希望阅读[了解 SQL 连接](http://www.devshed.com/c/a/MySQL/Understanding-SQL-Joins/)。它指的是 MySQL，但在大多数情况下适用于 Jet。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T21:21:11.760

另一个想法...为什么不在 Access 中使用查询设计器。设计“视图”大约需要 30 秒。然后去看看它写的SQL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:54:04.953

```
SELECT act.acctid AS AcctId, bankName, acctNumber, Balance, 
       NVL(jag.gid, '-') AS GroupID, NVL(gp.groupname, '-') AS GroupName
FROM accounts act 
     LEFT OUTER JOIN JointAccountGroups jag ON (act.id = jag.aid) 
     LEFT OUTER JOIN AccounGroups gp ON (jag.gid = gp.id) 
```

NVL 是一个函数，意思是“如果第一个参数为空，则返回第二个参数；否则，返回第一个参数”。NVL 恰好是 Oracle 的做法——所有数据库都有类似的东西，但它没有标准名称；查看 Access 是如何做到的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T16:57:34.557

SQL Server 为此目的使用 ISNULL()。我不确定这是否适用于 Access。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T17:04:22.700

是的，我将使用表示层作为 NULL。

但我一定是错过了什么。我从您那里得到的错误与我最初的尝试相同：

```
Syntax error (missing operator) in query expression '(act.id = jag.aid) 
                  LEFT OUTER JOIN accountgroups gp ON (jag.gid = gp.id)' 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T17:12:54.523

怎么样：

```
SELECT act.acctid AS AcctId, bankName, acctNumber, Balance, 
      jag.gid AS GroupID, gp.groupname AS GroupName
FROM accounts AS act 
     LEFT OUTER JOIN JointAccountGroups AS jag ON act.id = jag.aid
     LEFT OUTER JOIN AccounGroups AS gp ON jag.gid = gp.id 
```

这会给你一个错误吗？一个更容易弄清楚的错误？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T19:43:04.517

我认为在 Access 中您可能想尝试以下操作：

```
FROM (accounts AS act 
     LEFT OUTER JOIN JointAccountGroups AS jag ON act.id = jag.aid)
     LEFT OUTER JOIN AccounGroups AS gp ON jag.gid = gp.id 
```

我不知道为什么括号很重要，但我尝试了一个测试，它似乎解决了它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T21:19:28.457

另一个尝试：

```
SELECT act.acctid AS AcctId, bankName, acctNumber, Balance, 
    jag.gid AS GroupID, gp.groupname AS GroupName
FROM accounts AS act 
   LEFT OUTER JOIN JointAccountGroups AS jag ON act.id = jag.aid
   LEFT INNER JOIN AccounGroups AS gp ON jag.gid = gp.id 
```

两个 OUTER JOIN 的访问可能有问题，所以我将第二个设置为 INNER JOIN，它应该可以工作

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-25T14:13:32.537

不仅使用前面建议的查询设计器，还要使用 MS Access 关系工具来记录两个外键（AID、GID）和它们引用的主键之间的关系。

这使得在查询设计器中进行自然连接几乎是小菜一碟。您甚至可以在您概述的情况下使用查询向导。

建立查询后，为什么不使用查询作为记录源而不是使用表呢？

我会在 PHP 中做的一件事是将多个结果转换为逗号分隔的列表。

# sql-server - SQL Server - 结合外部和内部联接

> ID：473607
> 
> 赞同：17
> 
> 时间：2009-01-23T16:45:12.630
> 
> 标签：sql-server

我有 3 个表，我必须将表 A 与表 B 内联，但表 A 和表 C 之间有一个左外联。

我可以在同一个查询中结合外部联接和内部联接吗？我可以嵌套查询并获得所需的结果，但我无法在同一个查询中进行这两个连接。似乎在其他 SQL 语言中，加入的顺序很重要。SQL Server 中也是这种情况吗？

* * *

好的，这是场景。

考虑 3 张桌子。表 A、表 F、表 D。

我需要记录集包含 D 中的所有行，无论它是否存在于 F 中（在它与 A 内部连接之后）。因此，我想到了外部连接。我需要的是：

1.  首先在 A 和 F 之间做一个内连接以获得一个集合（这可能是一个空集）
2.  然后用 D 对 (1) 中的记录集进行外连接

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-23T17:06:19.967

如果我理解正确，你想要这样的东西：

```
select
    *
from
    a 
    left outer join c
        inner join b on c.bID = b.ID
    on a.cID = c.ID 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-03-15T05:42:43.273

就我而言，我需要为我的查询添加表别名才能正常工作：

```
SELECT * FROM ("purchased_items" p1
     INNER JOIN "purchase_orders" po1 ON (po1."id" = p1."purchase_order_id")) AS p4
LEFT OUTER JOIN (purchased_items p2
      INNER JOIN "purchase_orders" po2 ON (po2."id" = p2."purchase_order_id")) AS p5
ON (p4.item_variant_id = p5.item_variant_id AND p4.delivery_date < p5.delivery_date) 
WHERE p5.delivery_date IS NULL AND p4.delivered <> 0 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-23T16:48:26.757

当然你可以在同一个查询中加入：-

```
FROM TableA a
INNER JOIN Table b ON a.TableA_ID = b.TableA_ID
LEFT OUTER JOIN Table c ON a.TableA_ID = c.TableA_ID 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T17:29:18.580

顺序*应该*无关紧要。

![维恩图](https://upload.wikimedia.org/wikipedia/commons/6/63/Venn_diagram_cmyk.png)

这是来自维基共享资源的维恩图。无论查询顺序如何，您都将获得圆 A 和 B 之间的重叠，其中 C 的列与 A 和 B 的组合不重叠时为空值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T16:47:13.297

您可以在同一个查询中同时使用内连接和外连接，但它们的顺序很重要。看到这个问题：
[内连接和外连接；表格的顺序很重要吗？](https://stackoverflow.com/questions/187146/inner-join-outer-join-is-the-order-of-tables-in-from-important)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T17:15:44.033

从您的跟进来看，听起来您想要一个“有条件的”内部连接。

本质上，“如果 A 和 B 有记录，则 INNER JOIN 到 C”。

但是，您可能会遇到查询中的 INNER JOIN 未显示 A 没有与 B 或 C 关联的记录的问题。如果它们处于相同的“范围”，则 INNERS 将始终运行，您可以t 有条件地让它们根据它们的顺序运行。

您要么必须使用两个 LEFT 联接并过滤掉不需要的记录，要么使用视图来确定 INNER JOIN 的范围。

前任。A.ID=vw_MyView.A_ID 上的左连接 vw_MyView

MyView 有表 B 和 C 与您的 INNER JOIN。这将允许 INNER JOIN 在视图内运行，然后您可以 LEFT JOIN 到结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T18:08:13.960

The problem may not specifically be the join (Anthony showed you how to do wht you described to us).Remember that people often have problems using left joins becasue they try to put something in the where clause referncing the table on the right side of the join thus converting it from an outer join to an inner join (unless you are looknig for those records where the second table field is null which gives you the records in the first table and not the secodn one).

We could help you better if we say the actual code you were using that wasn;t producting the desired results as well as some sample data and sample results.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T16:50:35.660

是的，您可以同时执行相同的查询，是的，顺序很重要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-09T15:21:28.150

这出现在 1 到 0 或许多有 FK 的情况下。

将连接放在最后
的两种方法`on`
`outer`

不幸的是，您更改了表名。我将使用后面的名称。

```
declare @TableD TABLE (PeopleID int primary key, Name varchar(10));
INSERT INTO @TableD VALUES
       (1, 'Chris')
     , (2, 'Cliff')
     , (3, 'Heather');

declare @TableA TABLE (ThingID int primary key, ThingName varchar(10))
INSERT INTO @TableA VALUES
       (14, 'Bike')
     , (17, 'Trailer')
     , (18, 'Boat');

declare @TableF TABLE (PeopleID int, ThingID int, primary key (PeopleID, ThingID));
INSERT INTO @TableF VALUES
       (1, 18)
     , (1, 17)
     , (2, 14);

SELECT D.Name, A.ThingName
FROM @TableD D 
LEFT JOIN @TableF F
     JOIN @TableA A 
       ON A.ThingID = F.ThingID 
  ON F.PeopleID = D.PeopleID
order by D.Name, A.ThingName;

SELECT D.Name, A.ThingName
FROM @TableF F 
JOIN @TableA A 
  ON A.ThingID = F.ThingID 
right join @TableD D
  ON D.PeopleID = F.PeopleID 
order by D.Name, A.ThingName;

Name       ThingName
---------- ----------
Chris      Boat
Chris      Trailer
Cliff      Bike
Heather    NULL 
```

# .net - 将 Excel 范围/工作表导出到格式化的文本文件

> ID：473610
> 
> 赞同：2
> 
> 时间：2009-01-23T16:46:14.623
> 
> 标签：.net, sql, vba, excel

我的任务是为我们的财务部门创建一个可重复使用的流程，以将我们的工资单上传到州 (WI) 进行报告。我需要创建一些在 Excel 中采用工作表或范围并创建特定格式的文本文件的东西。

***格式***

*   第 1 列 - 一个静态数字，从不更改，位置 1-10
*   第 2 列 - 在运行时为季度/年度填充的动态参数，位置 11-13
*   第 3 列 - SSN，无连字符或空格，从 A 列第 14-22 位填充
*   第 4 列 - 姓氏，从 B 列填充，在 10 处截断，左对齐并填充空白，位置 23-32
*   第 5 列 - 名字，从 C 填充，在 8 处截断，左对齐并填充空白，位置 33-40
*   第 6 列 - 总工资/季度，从 D 填充，去除所有格式，右对齐零填充，位置 41-49
*   第 7 列 - 静态代码，永不更改，位置 50-51
*   第 8 列 - 空白，填空，位置 52-80

我假设有 3 个选项：

1.  VBA
2.  。网
3.  SQL

我首先探索了 .NET 方法，但我只是找不到合适的文档让我继续前进。我仍然喜欢这个，但我离题了。

接下来我有一些 VBA 会将工作表转储为固定宽度的文本。我目前正在追求这一点，这最终导致了我的实际问题。

如何在 Excel 中转换文本范围？我是否需要将其复制到另一张纸上，然后使用必要的格式化功能传递该数据以运行我的转储到文本例程？我目前计划为每列设置一个函数，但我无法弄清楚如何采取下一步行动。我在 Office 编程和一般开发方面相当新，因此任何见解都将不胜感激。

SQL 选项将是我的后备方案，因为我过去曾从 SQL 中进行过类似的导出。我只是更喜欢其他两个，*“我不想负责运行这个”*原则。

提前感谢任何时间。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T03:51:29.600

使用 VBA 似乎是我的最佳选择。这使您可以编写一个宏来处理所有各种格式选项，并且希望它足够简单，让您的财务人员自己运行。

您说您需要在 Excel 中使用工作表或范围的东西。第一列永远不会改变，因此我们可以将其存储在宏中，第 3-7 列来自电子表格，第 8 列只是空白。这使得第 2 列（季度/年为 QYY）成为一个问题。如果在工作簿中的某处指定了季度/年份（例如，存储在单元格中，作为工作表名称，作为工作簿标题的一部分），那么我们可以将其读入。否则您将需要找到一些指定季度的方法/year 宏运行时（例如弹出一个对话框并要求用户输入）

一些简单的代码（我们稍后会担心如何调用它）：

```
Sub ProduceStatePayrollReportFile(rngPayrollData As Range, strCompanyNo As String, _
    strQuarterYear As String, strRecordCode As String, strOutputFile As String) 
```

参数相当明显：保存数据的范围、第 1 列的公司编号、第 2 列的季度/年、第 7 列的固定代码以及我们要将结果输出到的文件

```
' Store the file handle for the output file
Dim fnOutPayrollReport As Integer
' Store each line of the output file
Dim strPayrollReportLine As String
' Use to work through each row in the range
Dim indexRow As Integer 
```

要输出到 VBA 中的文件，我们需要获取文件句柄，因此我们需要一个变量来存储它。我们将在报告行字符串中构建报告的每一行，并使用行索引来处理范围

```
' Store the raw SSN, last name, first name and wages data
Dim strRawSSN As String
Dim strRawLastName As String
Dim strRawFirstName As String
Dim strRawWages As String
Dim currencyRawWages As Currency

' Store the corrected SSN, last name, first name and wages data
Dim strCleanSSN As String
Dim strCleanLastName As String
Dim strCleanFirstName As String
Dim strCleanWages As String 
```

这些变量集分别存储来自工作表的原始数据和要输出到文件的清理数据。将它们命名为“原始”和“干净”可以更容易地发现您意外输出原始数据而不是清理数据的错误。我们需要将原始工资从字符串值更改为数值以帮助格式化

```
' Open up the output file
fnOutPayrollReport = FreeFile()
Open strOutputFile For Output As #fnOutPayrollReport 
```

FreeFile() 获取下一个可用的文件句柄，我们使用它链接到文件

```
' Work through each row in the range
For indexRow = 1 To rngPayrollData.Rows.Count
    ' Reset the output report line to be empty
    strPayrollReportLine = ""
    ' Add the company number to the report line (assumption: already correctly formatted)
    strPayrollReportLine = strPayrollReportLine & strCompanyNo
    ' Add in the quarter/year (assumption: already correctly formatted)
    strPayrollReportLine = strPayrollReportLine & strQuarterYear 
```

在遍历每一行的循环中，我们首先清除输出字符串，然后添加第 1 列和第 2 列的值

```
' Get the raw SSN data, clean it and append to the report line
strRawSSN = rngPayrollData.Cells(indexRow, 1)
strCleanSSN = cleanFromRawSSN(strRawSSN)
strPayrollReportLine = strPayrollReportLine & strCleanSSN 
```

该`.Cells(indexRow, 1)`部分仅表示由 indexRow 指定的行中范围的最左侧列。如果范围从 A 列开始（不一定是这种情况），那么这只是意味着 A。我们稍后需要自己编写`cleanFromRawSSN`函数

```
' Get the raw last and first names, clean them and append them
strRawLastName = rngPayrollData.Cells(indexRow, 2)
strCleanLastName = Format(Left$(strRawLastName, 10), "!@@@@@@@@@@")
strPayrollReportLine = strPayrollReportLine & strCleanLastName

strRawFirstName = rngPayrollData.Cells(indexRow, 3)
strCleanFirstName = Format(Left$(strRawFirstName, 8), "!@@@@@@@@")
strPayrollReportLine = strPayrollReportLine & strCleanFirstName 
```

`Left$(string, length)`将字符串截断为给定长度。格式图片`!@@@@@@@@@@`将字符串格式化为正好十个字符长，左对齐（! 表示左对齐）并用空格填充

```
' Read in the wages data, convert to numeric data, lose the decimal, clean it and append it
strRawWages = rngPayrollData.Cells(indexRow, 4)
currencyRawWages = CCur(strRawWages)
currencyRawWages = currencyRawWages * 100
strCleanWages = Format(currencyRawWages, "000000000")
strPayrollReportLine = strPayrollReportLine & strCleanWages 
```

我们将其转换为货币，以便乘以 100 将美分值移到小数点左侧。`Format`这使得生成正确值变得更加容易。对于 >= 1000 万美元的工资，这不会产生正确的输出，但这是用于报告的文件格式的限制。带 0的`0`格式画板令人惊讶

```
' Append the fixed code for column 7 and the spaces for column 8
strPayrollReportLine = strPayrollReportLine & strRecordCode
strPayrollReportLine = strPayrollReportLine & CStr(String(29, " "))

' Output the line to the file
Print #fnOutPayrollReport, strPayrollReportLine 
```

该`String(number, char)`函数产生一个具有`number`指定序列的 Variant `char`。`CStr`将 Variant 变成一个字符串。该`Print #`语句输出到文件，无需任何额外的格式

```
Next indexRow

' Close the file
Close #fnOutPayrollReport

End Sub 
```

循环到范围中的下一行并重复。当我们处理完所有行后，关闭文件并结束宏

我们仍然需要两件事：一个 cleanFromRawSSN 函数和一个使用相关数据调用宏的方法。

```
Function cleanFromRawSSN(strRawSSN As String) As String

' Used to index the raw SSN so we can process it one character at a time
Dim indexRawChar As Integer

' Set the return string to be empty
cleanFromRawSSN = ""

' Loop through the raw data and extract the correct characters
For indexRawChar = 1 To Len(strRawSSN)
    ' Check for hyphen
    If (Mid$(strRawSSN, indexRawChar, 1) = "-") Then
        ' do nothing
    ' Check for space
    ElseIf (Mid$(strRawSSN, indexRawChar, 1) = " ") Then
        ' do nothing
    Else
        ' Output character
        cleanFromRawSSN = cleanFromRawSSN & Mid$(strRawSSN, indexRawChar, 1)
    End If
Next indexRawChar

' Check for correct length and return empty string if incorrect
If (Len(cleanFromRawSSN) <> 9) Then
    cleanFromRawSSN = ""
End If

End Function 
```

`Len`返回字符串的长度并`Mid$(string, start, length)`返回`length`从`string`开始的字符`start`。此功能可以改进，因为它目前不检查非数字数据

调用宏：

```
Sub CallPayrollReport()

ProduceStatePayrollReportFile Application.Selection, "1234560007", "109", "01", "C:\payroll109.txt"

End Sub 
```

这是最简单的调用方式。范围是用户在活动工作簿的活动工作表上选择的任何内容，其他值是硬编码的。用户应该选择他们想要输出到文件的范围，然后转到工具 > 宏 > 运行并选择`CallPayrollReport`. 为此，宏需要成为包含数据的工作簿的一部分，或者位于用户调用宏之前已加载的不同工作簿中。

在生成每个季度的报告之前，有人需要更改季度/年度的硬编码值。如前所述，如果季度/年度已经存储在工作簿中的某个地方，那么最好将其读入而不是硬编码

希望这是有道理的并且有一些用处

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T20:10:16.727

严格从对您来说最简单的角度考虑这一点，如果您熟悉 SQL，在 Access 的上下文中，您可以使用 Access 作为外部数据源附加到电子表格。它看起来像 Access 中的一个表，并从那里开始工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T05:07:49.977

哇！

我不得不说，我被吹走了。到目前为止，您超出了我对答案的期望，我感到内疚，我只能投票给您一次并标记为例外。我希望得到这样的指导，以了解哪条路径是最好的和一些格式。祝我生日快乐！

Format() 和 FreeFile() 是特别有用的新信息。另外，只是为了表明我正在尝试，我的尝试如下。我非常接近，因为我只是在制定格式细节，但我相信我会根据你的输入重新设计它，因为它似乎是更优雅的方法。

作为最后的说明。我通过 Jeff Atwood 的博客找到了这个地方，我对这个想法感到非常兴奋。作为一个新的、缺乏经验的开发人员，我一直希望有一个可以寻求指导的地方。书籍和文章可以让您达到一定的目的，但没有什么比做过或去过那里的人的建议更重要。到目前为止，StackOverflow 已经交付。

作为参考，我在另一个非常受欢迎的代码论坛上发布了这个完全相同的问题，但还没有收到任何回复。

现在我的尝试：

模块代码

```
 Sub StateANSIIExport()
    Dim Sizes As Variant
    Dim arr As Variant
    Dim aRow As Long, aCol As Long
    Dim rowLimit As Integer, colLimit As Integer
    Dim SpacesPerCell As Integer
    Dim fso As Object
    Dim ts As Object
    Dim TheLine As String
    Dim TestStr As String

    arr = ActiveSheet.UsedRange
    rowLimit = UBound(arr, 1)
    'colLimit = UBound(arr, 2)
    colLimit = 8
    SpacesPerCell = 20      'Set export text "column" width here

    Set fso = CreateObject("Scripting.FileSystemObject")
    Set ts = fso.CreateTextFile(GetDesktopPath() & "EXCELTEXT.txt", True)

    ' Loop thru the rows
    For aRow = 1 To rowLimit
        TheLine = Space(colLimit * SpacesPerCell)     ' your fixed-width output
        ' Loop thru the columns
        For aCol = 1 To colLimit
            Select Case aCol
                Case 1  ' Employer UI Account #
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = "6979430002"
                Case 2  ' Reporting Period (QYY)
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = "109"
                Case 3  ' SSN
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = Cells(aRow, "A")
                Case 4  ' Last Name
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = Cells(aRow, "B")
                Case 5  ' First Name
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = Cells(aRow, "C")
                Case 6  ' Employee Quartly Gross Wages
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = Cells(aRow, "D")
                Case 7   ' Record Code
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = "01"
                Case 8  ' BLANK
                    Mid(TheLine, aCol * SpacesPerCell - SpacesPerCell + 1, SpacesPerCell) = "                             "
            End Select
        Next aCol
        ' Write the line to the file
        ts.WriteLine TheLine
    Next aRow

    ts.Close

    Set ts = Nothing
    Set fso = Nothing

    MsgBox "Done"
End Sub

    Sub MacroToRunTwo()
    Dim S As String
    S = "Hello World From Two:" & vbCrLf & _
        "This Add-In File Name: " & ThisWorkbook.FullName
    MsgBox S
End Sub

Function GetDesktopPath() As String
'Return the current user's desktop path
GetDesktopPath = "C:\Users\patrick\Desktop\"
'GetDesktopPath = Environ("HOMEDRIVE") & Environ("HOMEPATH") & "\Desktop\"
End Function 
```

和工作簿代码：

```
 Private Const C_TAG = "Refracted Solutions" ' C_TAG should be a string unique to this add-in.
Private Const C_TOOLS_MENU_ID As Long = 30007&

Private Sub Workbook_Open()
'''''''''''''''''''''''''''''''''''''''''''''''
' Workbook_Open
' Create a submenu on the Tools menu. The
' submenu has two controls on it.
'''''''''''''''''''''''''''''''''''''''''''''''
Dim ToolsMenu As Office.CommandBarControl
Dim ToolsMenuItem As Office.CommandBarControl
Dim ToolsMenuControl As Office.CommandBarControl

'''''''''''''''''''''''''''''''''''''''''''''''
' First delete any of our controls that
' may not have been properly deleted previously.
'''''''''''''''''''''''''''''''''''''''''''''''
DeleteControls

''''''''''''''''''''''''''''''''''''''''''''''
' Get a reference to the Tools menu.
''''''''''''''''''''''''''''''''''''''''''''''
Set ToolsMenu = Application.CommandBars.FindControl(ID:=C_TOOLS_MENU_ID)
If ToolsMenu Is Nothing Then
    MsgBox "Unable to access Tools menu.", vbOKOnly
    Exit Sub
End If

''''''''''''''''''''''''''''''''''''''''''''''
' Create a item on the Tools menu.
''''''''''''''''''''''''''''''''''''''''''''''
Set ToolsMenuItem = ToolsMenu.Controls.Add(Type:=msoControlPopup, temporary:=True)
If ToolsMenuItem Is Nothing Then
    MsgBox "Unable to add item to the Tools menu.", vbOKOnly
    Exit Sub
End If

With ToolsMenuItem
    .Caption = "&WWCares"
    .BeginGroup = True
    .Tag = C_TAG
End With

''''''''''''''''''''''''''''''''''''''''''''''
' Create the first control on the new item
' in the Tools menu.
''''''''''''''''''''''''''''''''''''''''''''''
Set ToolsMenuControl = ToolsMenuItem.Controls.Add(Type:=msoControlButton, temporary:=True)
If ToolsMenuControl Is Nothing Then
    MsgBox "Unable to add item to Tools menu item.", vbOKOnly
    Exit Sub
End If

With ToolsMenuControl
    ''''''''''''''''''''''''''''''''''''
    ' Set the display caption and the
    ' procedure to run when clicked.
    ''''''''''''''''''''''''''''''''''''
    .Caption = "State ANSII E&xport"
    .OnAction = "'" & ThisWorkbook.Name & "'!StateANSIIExport"
    .Tag = C_TAG
End With

''''''''''''''''''''''''''''''''''''''''''''''
' Create the second control on the new item
' in the Tools menu.
''''''''''''''''''''''''''''''''''''''''''''''
'Set ToolsMenuControl = ToolsMenuItem.Controls.Add(Type:=msoControlButton, temporary:=True)
'If ToolsMenuControl Is Nothing Then
'    MsgBox "Unable to add item to Tools menu item.", vbOKOnly
'    Exit Sub
'End If

'With ToolsMenuControl
    ''''''''''''''''''''''''''''''''''''
    ' Set the display caption and the
    ' procedure to run when clicked.
    ''''''''''''''''''''''''''''''''''''
'    .Caption = "Click Me &Two"
'    .OnAction = "'" & ThisWorkbook.Name & "'!MacroToRunTwo"
'    .Tag = C_TAG
'End With

End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
''''''''''''''''''''''''''''''''''''''''''''''''''''
' Workbook_BeforeClose
' Before closing the add-in, clean up our controls.
''''''''''''''''''''''''''''''''''''''''''''''''''''
    DeleteControls
End Sub

Private Sub DeleteControls()
''''''''''''''''''''''''''''''''''''
' Delete controls whose Tag is
' equal to C_TAG.
''''''''''''''''''''''''''''''''''''
Dim Ctrl As Office.CommandBarControl

On Error Resume Next
Set Ctrl = Application.CommandBars.FindControl(Tag:=C_TAG)

Do Until Ctrl Is Nothing
    Ctrl.Delete
    Set Ctrl = Application.CommandBars.FindControl(Tag:=C_TAG)
Loop

End Sub 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-23T20:00:55.357

根据您文档的格式，我可能会建议导出到 .csv 并使用它。如果您只需要数字，这将是最简单的方法。

# design-patterns - 你的域模型对象中应该有多少逻辑

> ID：473617
> 
> 赞同：15
> 
> 时间：2009-01-23T16:47:17.243
> 
> 标签：design-patterns, n-tier-architecture

刚刚读完Greg Young 的[这篇文章](http://codebetter.com/blogs/gregyoung/archive/2009/01/22/the-data-centric-universe.aspx)，他在其中谈论 Microsoft 推荐带有哑数据传输对象的模式。他暗示，在 Java 社区中，事情正朝着另一个方向发展。

我的问题是您的实体对象中应该有多少逻辑？我工作的地方（C# 商店）的理念是，如果你不能序列化它，就不要把它放在实体中。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-23T18:56:07.390

马特，

我会说你的商店正在编写程序代码。我想明确一点，许多大型系统（包括我曾经参与过的许多系统）都是使用过程代码编写的，这并没有错。它有一个时间和地点。

现在程序代码在域模型中没有位置。如果您想使用更程序化的样式，但可以将其与表模块或 Active Record 模式一起使用。我认为在指导中具有如此破坏性的不是缺少 OO，而是使用具有过程逻辑的域模型。

这导致人们花费大量资源来构建领域层（阻抗不匹配、构建聚合的思考过程时间、隔离、无处不在的语言等），而没有获得领域层（通常是可维护性）将提供的任何好处。换句话说，虽然您可以很好地满足您的功能要求，但您最终会花费大量预算而几乎没有回报。

现在回到什么是“行为”，我想从面向对象而不是“领域驱动设计”的观点来关注这个问题。一个对象通常会封装一些状态并且通常会暴露一些行为。

快速重申：封装状态，暴露行为

那么一个对象应该有哪些行为呢？简而言之，它应该是对其封装的状态进行操作的行为。在理想的行为 OO 世界中，状态永远不会从仅对象行为中暴露出来。如果我们开始看到如下代码，请从战术上将其放入代码中：

```
Customer c = GetCustomerFromRepository();
c.Status = CustomerStatuses.Deleted;
c.LastUpdated = DateTime.Now;
c.UpdatedBy = GetCurrentUser();
CustomerRepository.Save(c); 
```

我们有一个 SRP 违规......此代码是应该是客户对象的行为的代码，因为客户对象的“责任”是。

封装有关客户的状态并公开行为。

因此，我们可以看到最好有一个 Customer.Delete() 方法。（是的，这是我知道的一个坏例子......）

现在我们也可以通过使用 TDD 来解决这个问题。对我们来说，处理行为提供的接缝比处理所有状态都暴露的接缝要容易得多。这样做的原因是我不需要在我的测试中复制逻辑。客户端代码不*关心*删除是如何工作的……它只关心客户公开行为。因此，在我们的测试中，我们不会断言 c.State == CustomerStates.Deleted 和 c.UpdatedBy==GetCurrentUser() 等，我们会简单地断言 delete 方法是通过使用模拟在客户接缝上调用的。

现在回到标题。业务对象中应该包含的逻辑量​​是由其负责封装其状态的逻辑量。有时这很多，有时不是。有些地方你也想使用服务......一个很好的例子是协调许多域对象之间的交互以实现给定的行为，但即使在这里，服务也应该调用域对象上的*行为*。

这有助于澄清一些事情吗？

格雷格

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T19:28:24.017

如果您称它们为“域模型对象”，那么我将假设您指的是 Fowler 的域模型模式。[http://martinfowler.com/eaaCatalog/domainModel.html](http://martinfowler.com/eaaCatalog/domainModel.html)

鉴于该假设，那么您问题的答案是“所有业务逻辑”，因为这本质上是模式的定义。

不幸的是，“域模型”一词最近似乎被淡化为仅表示您的数据的对象模型而没有行为。

如果您还没有这样做，我会鼓励您阅读 PoEAA 并确定您认为域逻辑在您的情况下属于何处。如果您决定使用域模型，那么我鼓励您阅读 Evan 的 DDD 书并了解实体、值对象和服务之间的区别。

希望有帮助！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T19:25:39.873

最近，我一直在玩弄创建具有结构的域模型的想法，并且只有那些对该模型通用的行为（即可以跨多个有界上下文使用的行为），以及针对有界上下文特定行为的扩展方法. 这使域模型接近于 DTO（对于那些喜欢那样的人），并将该域模型的使用限制为仅在有界上下文中允许的行为。因此，这可能是一种中间路线响应的选择。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T18:29:42.717

重点是如何定义逻辑。举一些例子：

1.  我不会将函数 getFullName() 归类为 Person 实体，它只是连接一些字符串，作为逻辑。
2.  计算订单项目值更有可能符合逻辑。
3.  做一些预订交易我肯定会说是合乎逻辑的。

第 1 点和第 2 点可能会让我进入实体。第3点不是。所以我将逻辑定义为：

*   任何与持久性相关的操作（读/写）
*   涉及任何其他（不直接相关，例如主从）实体的任何操作

IMO，任何这些操作都不属于实体。

现在，为什么/何时我不会将第 1 点和第 2 点类型的操作也放入实体中？这是一种相当罕见的情况，但我不会这样做，因为存储在实体中的数据需要以某种方式解释才能被应用程序使用（例如，如果取决于当前用户，字段 X 的内容有不同的含义），这意味着实体的数据本身会产生一些逻辑。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T18:41:34.143

据我了解，与实体相关的所有业务逻辑都应该进入该实体。这包括根据系统的业务规则定义实体的行为或内部结构的任何逻辑。这不应该包括表示逻辑或持久性逻辑（Active Record 设计模式的明显例外），但应该包括诸如数据验证、实体关系、状态机和其他定义实体如何根据实际行为的东西——它试图建模的世界事物。

我尝试查看它的方式是尝试使我的模型尽可能地可重复使用。如果将模型移植到客户端代码（或使用实体的代码）可能不同的不同系统，请始终尝试考虑如何使用模型。如果功能不是实体的一部分，它是否仍会按照相同的业务规则以相同的方式运行？如果答案是否定的，那么该功能应该在实体中。

# asp.net - 这些 Visual Studio 2005 性能工具/向导/会话错误是什么意思？

> ID：473618
> 
> 赞同：2
> 
> 时间：2009-01-23T16:47:26.417
> 
> 标签：asp.net, performance, visual-studio-2005, web-config

在尝试在 ASP.NET 网站上使用性能工具时，我遇到了这些错误的各种组合（取决于我尝试修复它们的方法）：

1.  无法正确配置网站。配置“\web.config”失败。拒绝访问路径“\web.config”。-*我可以通过签出 web.config 文件或取消设置只读属性来使这个消失*
2.  [站点http://localhost:0/](http://localhost:0/)的 web.config 文件包含上一次运行的信息。web.config 文件已生成，因此删除它应该可以解决问题。-*为什么它使用端口 0？我在任何地方都找不到这个设置。“正常”运行使用指定端口，例如 4549*
3.  web.config 文件\web.config 已更改，备份信息丢失。-*什么？！*

有任何想法吗？

我正在运行带有 TFS 2005 的 Visual Studio 2005，它是一个 ASP.NET 2.0 Web 应用程序项目。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T11:39:36.107

我找到了解决上述错误的方法，它允许我使用采样配置文件方法，但是当我尝试使用仪器配置文件方法时，还有另一个可能不相关的问题。

与原始问题一样 - 只需检查 Web.config 或删除只读属性，即可修复错误 1。

要修复错误 2 和 3，请从 Web.config 中删除以下行：

```
<appSettings>
    <add key="microsoft.visualstudio.teamsystems.aspnetdevserver:/" value="3311;True;3204;1" />
    <add key="microsoft.visualstudio.teamsystems.backupinfo" value="1;web.config.backup" />
</appSettings>
<runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
    </assemblyBinding>
</runtime> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T16:49:25.937

当我尝试时，我在 Visual Studio 2008中收到“站点[http://localhost:0/](http://localhost:0/)的 web.config 文件包含以前运行的信息。生成了 web.config 文件，因此删除它应该可以解决问题”为 Web 服务方法运行单元测试。我的 Web 服务的项目目录中有一个 Web.config 文件，但这不是被修改的文件。事实证明，我传递了错误的参数`AspNetDevelopmentServer`，它把 web.config 粘贴在其他目录中。这是我必须放在单元测试方法之上的两行（`[TestMethod]`当然，除了 ）：

```
[AspNetDevelopmentServer("MyWebService", @"MyWebServiceProjectDirectory\")]
[UrlToTest("http://localhost/MyWebService/MyWebService.asmx")] 
```

现在我可以正常运行单元测试了。以前，它会运行一次，然后给我那个 web.config 错误。现在，它多次运行良好而不会抱怨 web.config 文件。

# python - 如何在 Python 中创建守护进程？

> ID：473620
> 
> 赞同：261
> 
> 时间：2009-01-23T16:48:06.617
> 
> 标签：python, daemon

[在 Google 上搜索](http://www.google.co.uk/search?q=python+daemon)会显示 x2 代码片段。第一个结果是[这个代码配方](http://code.activestate.com/recipes/278731/)，它有很多文档和解释，以及下面的一些有用的讨论。

但是，[另一个代码示例](https://gist.github.com/slor/5946334)虽然没有包含太多文档，但包含用于传递命令（例如启动、停止和重新启动）的示例代码。它还创建一个 PID 文件，可以方便地检查守护程序是否已经在运行等。

这些示例都说明了如何创建守护程序。还有其他需要考虑的事情吗？一个样本比另一个样本好，为什么？

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2009-01-23T17:06:11.230

**当前解决方案**

[PEP 3143（标准守护进程库）](https://www.python.org/dev/peps/pep-3143/)的参考实现现在以[python-daemon 的](https://pypi.python.org/pypi/python-daemon)形式提供。

**历史答案**

Sander Marechal 的[代码示例](http://web.archive.org/web/20131017130434/http://www.jejik.com/articles/2007/02/a_simple_unix_linux_daemon_in_python/)优于最初于 2004 年发布的原始代码示例。我曾经为 Pyro 贡献了一个守护程序，但如果我不得不重新做一遍，可能会使用 Sander 的代码。

* * *

## 回答 #2

> 赞同：169
> 
> 时间：2009-03-27T03:38:06.247

[当成为一个表现良好的守护进程](http://www.python.org/dev/peps/pep-3143/#correct-daemon-behaviour)时，有**许多繁琐的事情**需要处理：

*   防止核心转储（许多守护进程以 root 身份运行，核心转储可能包含敏感信息）

*   [在监狱](https://en.wikipedia.org/wiki/Chroot)内行为正确[`chroot`](https://en.wikipedia.org/wiki/Chroot)

*   为用例适当设置 UID、GID、工作目录、umask 和其他进程参数

*   放弃提升`suid`,`sgid`特权

*   关闭所有打开的文件描述符，根据用例排除

*   如果在已经分离的上下文中启动，则行为正确，例如`init`,`inetd`等。

*   为合理的守护程序行为设置信号处理程序，但也可以使用由用例确定的特定处理程序

*   重定向标准流`stdin`，因为守护进程不再有控制`stdout`终端`stderr`

*   将 PID 文件作为协作咨询锁来处理，它[本身就是一整套蠕虫，](https://stackoverflow.com/questions/688343/reference-for-proper-handling-of-pid-file-on-unix)具有许多相互矛盾但有效的行为方式

*   在进程终止时允许适当的清理

*   实际上成为一个守护进程而不会导致[僵尸](https://en.wikipedia.org/wiki/Zombie_process)

其中一些是**标准**的，如规范 Unix 文献（*UNIX 环境中的高级编程，*已故 W. Richard Stevens，Addison-Wesley，1992 年）中所述。其他的，例如流重定向和[PID 文件处理](https://stackoverflow.com/questions/688343/reference-for-proper-handling-of-pid-file-on-unix)，是大多数守护程序用户期望的**常规行为，但标准化程度较低。**

所有这些都包含在**[PEP 3143](http://www.python.org/dev/peps/pep-3143) “标准守护进程库”规范**中。[python-daemon](http://pypi.python.org/pypi/python-daemon/)参考实现适用于 Python 2.7 或更高版本，以及 Python 3.2 或更高版本。

* * *

## 回答 #3

> 赞同：106
> 
> 时间：2012-01-28T17:33:44.723

这是我在开发新的守护程序应用程序时开始使用的基本“Howdy World”Python 守护程序。

```
#!/usr/bin/python
import time
from daemon import runner

class App():
    def __init__(self):
        self.stdin_path = '/dev/null'
        self.stdout_path = '/dev/tty'
        self.stderr_path = '/dev/tty'
        self.pidfile_path =  '/tmp/foo.pid'
        self.pidfile_timeout = 5
    def run(self):
        while True:
            print("Howdy!  Gig'em!  Whoop!")
            time.sleep(10)

app = App()
daemon_runner = runner.DaemonRunner(app)
daemon_runner.do_action() 
```

请注意，您将需要该`python-daemon`库。您可以通过以下方式安装它：

```
pip install python-daemon 
```

然后用 开始，用`./howdy.py start`停止`./howdy.py stop`。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2011-03-23T23:28:03.340

请注意[python-daemon](http://pypi.python.org/pypi/python-daemon/)包，它解决了开箱即用的守护程序背后的许多问题。

除了其他功能之外，它还支持（来自 Debian 软件包描述）：

*   将进程分离到它自己的进程组中。
*   设置适合在 chroot 内运行的进程环境。
*   放弃 suid 和 sgid 特权。
*   关闭所有打开的文件描述符。
*   更改工作目录、uid、gid 和 umask。
*   设置适当的信号处理程序。
*   为标准输入、标准输出和标准错误打开新的文件描述符。
*   管理指定的 PID 锁定文件。
*   为退出处理注册清理函数。

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2013-06-22T20:50:01.287

另一种选择——创建一个普通的、非守护进程的 Python 程序，然后使用[supervisord](http://supervisord.org/ "监督者")对其进行外部守护进程。这可以省去很多麻烦，并且是 *nix 和语言可移植的。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2015-05-18T23:11:12.707

可能不是该问题的直接答案，但 systemd 可用于将您的应用程序作为守护进程运行。这是一个例子：

```
[Unit]
Description=Python daemon
After=syslog.target
After=network.target

[Service]
Type=simple
User=<run as user>
Group=<run as group group>
ExecStart=/usr/bin/python <python script home>/script.py

# Give the script some time to startup
TimeoutSec=300

[Install]
WantedBy=multi-user.target 
```

我更喜欢这种方法，因为很多工作已经为您完成，然后您的守护程序脚本的行为与系统的其余部分类似。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-12-06T06:11:26.273

[YapDi](https://github.com/kasun/YapDi)是一个 python 包。它可用于从脚本内部将 python 脚本转换为守护程序模式。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2014-09-15T16:43:37.000

由于 python-daemon 尚未支持 python 3.x，并且从邮件列表中可以阅读的内容来看，它可能永远不会支持，我编写了 PEP 3143 的新实现：[pep3143daemon](https://pypi.python.org/pypi/pep3143daemon)

pep3143daemon 应至少支持 python 2.6、2.7 和 3.x

它还包含一个 PidFile 类。

该库仅依赖于标准库和六个模块。

它可以用作 python-daemon 的替代品。

这是[文档](http://pep3143daemon.readthedocs.org/en/latest/)。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2016-09-14T08:54:22.400

此函数会将应用程序转换为守护程序：

```
import sys
import os

def daemonize():
    try:
        pid = os.fork()
        if pid > 0:
            # exit first parent
            sys.exit(0)
    except OSError as err:
        sys.stderr.write('_Fork #1 failed: {0}\n'.format(err))
        sys.exit(1)
    # decouple from parent environment
    os.chdir('/')
    os.setsid()
    os.umask(0)
    # do second fork
    try:
        pid = os.fork()
        if pid > 0:
            # exit from second parent
            sys.exit(0)
    except OSError as err:
        sys.stderr.write('_Fork #2 failed: {0}\n'.format(err))
        sys.exit(1)
    # redirect standard file descriptors
    sys.stdout.flush()
    sys.stderr.flush()
    si = open(os.devnull, 'r')
    so = open(os.devnull, 'w')
    se = open(os.devnull, 'w')
    os.dup2(si.fileno(), sys.stdin.fileno())
    os.dup2(so.fileno(), sys.stdout.fileno())
    os.dup2(se.fileno(), sys.stderr.fileno()) 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-09-12T02:43:11.263

恐怕@Dustin 提到的守护程序模块对我不起作用。相反，我安装了[python-daemon](http://pypi.python.org/pypi/python-daemon/)并使用了以下代码：

```
# filename myDaemon.py
import sys
import daemon
sys.path.append('/home/ubuntu/samplemodule') # till __init__.py
from samplemodule import moduleclass 

with daemon.DaemonContext():
    moduleclass.do_running() # I have do_running() function and whatever I was doing in __main__() in module.py I copied in it. 
```

跑步很简单

```
> python myDaemon.py 
```

只是为了完整性，这里是 samplemodule 目录内容

```
>ls samplemodule
__init__.py __init__.pyc moduleclass.py 
```

moduleclass.py 的内容可以是

```
class moduleclass():
    ...

def do_running():
    m = moduleclass()
    # do whatever daemon is required to do. 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2014-02-20T16:21:09.270

在 python 中进行守护程序时要考虑的另一件事：

如果您正在使用 python**日志记录**并且您想在守护进程后继续使用它，请确保调用`close()`处理程序（特别是文件处理程序）。

如果您不这样做，处理程序仍然可以认为它打开了文件，并且您的消息将简单地消失 - 换句话说，确保记录器知道它的文件已关闭！

这假设当您进行守护程序时，您正在不加选择地关闭所有打开的文件描述符 - 相反，您可以尝试关闭除日志文件之外的所有文件（但通常关闭所有文件然后重新打开您想要的文件更简单）。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2019-09-25T03:24:11.490

尽管您可能更喜欢由 python-daemon 模块提供的纯 Python 解决方案，但至少在[BSD](https://www.freebsd.org/cgi/man.cgi?query=daemon&sektion=3)和[Linux](http://man7.org/linux/man-pages/man3/daemon.3.html)`daemon(3)`中，有一个函数可以做正确的事情。`libc`

从 python 调用它很简单：

```
import ctypes

ctypes.CDLL(None).daemon(0, 0) # Read the man-page for the arguments' meanings 
```

剩下要做的唯一事情是创建（和锁定）PID 文件。但是你可以自己处理...

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-11-12T10:33:01.117

我修改了 Sander Marechal 的代码示例中的几行（@JeffBauer 在[接受的答案](https://stackoverflow.com/a/473702/1422096)中提到），以添加一个`quit()`在守护程序停止之前执行的方法。这有时非常有用。

[这里是。](https://gist.github.com/josephernest/77fdb0012b72ebdf4c9d19d6256a1119)

*注意：我不使用“python-daemon”模块，因为文档仍然缺失（另请参阅许多其他 SO 问题）并且相当晦涩（如何使用此模块从命令行正确启动/停止守护程序？）*

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-02-23T16:01:13.103

经过几年和多次尝试（我尝试了这里给出的所有答案，但最后都有一些小缺点），现在我意识到有比直接从 Python 启动、停止、重新启动守护程序更好的方法：改用操作系统工具。

例如，对于 Linux，我没有执行`python myapp start`and `python myapp stop`，而是执行以下操作来启动应用程序：

```
screen -S myapp python myapp.py    
# CTRL+A, D to detach 
```

或在一个命令`screen -dmS myapp python myapp.py`中[启动和分离它](https://unix.stackexchange.com/a/423763/59989)。

然后：

```
screen -r myapp 
```

再次连接到此终端。进入终端后，可以使用 CTRL+C 来停止它。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-01-24T05:37:07.643

使用 Python 创建守护程序的最简单方法是使用[Twisted](http://twistedmatrix.com/trac/)事件驱动框架。它为您处理守护进程所需的所有内容。它使用[反应器模式](http://en.wikipedia.org/wiki/Reactor_pattern)来处理并发请求。

* * *

## 回答 #16

> 赞同：-30
> 
> 时间：2009-01-23T22:06:27.270

80% 的时间，当人们说“守护进程”时，他们只想要一个服务器。由于这个问题在这一点上完全不清楚，因此很难说可能的答案范围是什么。既然一台服务器就足够了，那就从那里开始吧。如果实际需要一个实际的“守护程序”（这种情况很少见），请继续阅读`nohup`作为守护服务器的一种方式。

在实际需要实际守护程序之前，只需编写一个简单的服务器即可。

另请查看[WSGI 参考](http://www.python.org/doc/2.5.2/lib/module-wsgiref.html)实现。

另请查看[Simple HTTP Server](http://www.python.org/doc/2.5.2/lib/module-SimpleHTTPServer.html)。

“有什么额外的事情需要考虑吗？” 是的。大约一百万件事情。什么协议？多少请求？为每个请求提供服务多长时间？他们多久到达一次？你会使用专门的流程吗？线程？子进程？编写守护进程是一项艰巨的工作。

# c++ - 球体世界实现 C++

> ID：473623
> 
> 赞同：6
> 
> 时间：2009-01-23T16:48:34.980
> 
> 标签：c++, data-structures, 3d, 3d-rendering

什么是实现、存储和渲染球形世界的最佳方式，例如在孢子或无限中但没有中间阶段的孢子，以及无限宇宙的多个世界。不对行星本身是如何产生的或它的大小/规模做任何假设。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-24T06:53:17.160

对于渲染，您需要使用某种详细程度算法，以便从靠近行星表面的地方无缝移动到远处。有许多动态 LOD 算法（[参见此处](http://www.vterrain.org/LOD/Papers/)）。一种称为 ROAM 的较旧算法可用于处理球形物体或行星（[球形 ROAM](http://www.gamasutra.com/features/20010810/oneil_01.htm)）。[Geometry clipmaps 是一种更新、更流行的算法，也可以适应](http://www.zib.de/clasen/?page_id=6)球面。

至于存储数据，您可能需要研究纹理、高度图等的程序生成（取决于您的需要）。这类似于 Infinity 和 Spore 的处理方式。[你可以在这里](http://www.infinity-universe.com/Infinity/index.php?option=com_smf&Itemid=75&topic=7598.0)阅读一些关于程序纹理的内容。程序高度图更简单，具体取决于您想要地形的复杂/真实程度。在最简单的级别上，您可以简单地通过 perlin 噪声函数替换顶点高度。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-24T02:33:41.537

如果您正在寻找一些东西来存储有关表面的数据，您可能会查看[HEALpix](http://healpix.jpl.nasa.gov/)。它是天文界专门为绘制天空（另一个球面）而开发的软件。

HEALpix 创建一个网格，描述表面的位置和大小，并为每个表面分配一个 ID。然后，您可以使用该 ID 作为键或索引来访问有关该特定级别的尽可能多的详细信息。

HEASPix 提供了查找相邻表面区域的方法，并且可以为每个网格点提供中心和顶点位置。

它是一种分层网格，允许您根据需要尽可能多地细分每个面，因此理论上您可以根据需要将网格的一部分设置为低分辨率，而将其他部分设置为更高的细节级别。它有一个很好的特性，它是无限可分的（直到你的内存限制），并且在给定分辨率下，网格的每个像素与在该分辨率级别下的所有其他像素具有相同的区域。

分发包提供了很多您可能不需要的东西，但核心库应该很有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-23T19:06:56.277

这可能不是你要找的……但到底是什么。这是一个好故事。

很久以前，当恐龙还在地球上漫游并且内存仍然以千字节为单位时，我使用了一些软件来生成分形行星。

这个想法是创建一个代表地球的 2NxN 矩形。将行星切成两半，每次稍微移动两半。（带有随机相移和幅度的切割的正弦波。另一个用于偏移的随机正弦波。）之后，用水淹没低层区域并按高度对其余区域进行颜色编码。

然后在顶部放置一个直径为 N 的球体并投影，将地图的 NxN 区域包裹在球体的一半周围。围绕地图移动球体，它看起来像是在旋转。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T17:13:31.137

我建议在内存中使用某种多边形模型来实现它们的世界，使用文件来存储它们并使用某种 3d 引擎渲染它们。要么是那个，要么只是一个指针中心和一个半径，以及一个描述世界地理的叠加层。

编辑：感谢您提供更多详细信息。根据您需要多少细节，您需要使用某种方法将纹理分解成更小的部分——您可以只为 20 个面生成纹理并围绕中心点构建一个[二十面体。](http://en.wikipedia.org/wiki/Icosahedron)查看[地图投影](http://en.wikipedia.org/wiki/Map_projection)，了解如何在现实生活中处理这些问题。

# java - 弹簧初始化不正确的影响

> ID：473627
> 
> 赞同：3
> 
> 时间：2009-01-23T16:49:05.587
> 
> 标签：java, spring

我正在使用错误构建的 spring 应用程序。需要引用的对象不是使用 IOC，而是从上下文中提取它们的引用：

```
 BeanFactory b = SingletonBeanFactoryLocator.getInstance().
               useBeanFactory("factory").getFactory();
    Bean foo = (FOO)beanFactory.getBean("foo"); 
```

撇开非 IOC 设计不谈，这样做的其他不利影响是什么？例如，这是否有任何特定的性能影响？有什么方法可以导致创建额外的上下文或对象引用？这可能导致其他任何不愉快的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T17:01:27.963

一个可能直接想到的问题是，如果在函数方法中使用该代码而不是在某些初始化方法中使用该代码，那么 bean 会被重新获取很多，这很可能会减慢速度。

这也不是真正可维护的，如果更改了 bean 的名称，所有对它的引用都必须手动更新，否则什么都不会起作用。这当然会扩展到依赖于其他 bean 的 bean，甚至可能这些 bean 也依赖于其他 bean，例如将 DataSource 作为 bean 到用于非事务性数据库查询的通用 JDBC 模板，该模板被注入到通用容器类中，所有其他类获取此类对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T17:09:21.600

我相信唯一真正的“性能问题”是对 getBean(); 的额外调用；如果这被调用很多次，它可能会产生影响。考虑在这种情况下其他操作的成本也很重要：如果您正在执行诸如查询数据库或与另一个网络进行高延迟连接之类的操作，那么它可能并不重要。但是，如果这发生在 GUI 编程中的屏幕刷新上下文中，那么它可能会非常昂贵。

Spring 为您提供的任何其他特性（AOP、作用域 bean 等）无论是从容器中注入还是从容器中获取，都将以相同的方式运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T17:38:05.690

我想到了“你可以用任何语言编写fortran”这句老话。使用 spring 作为服务定位器听起来你错过了大多数让 spring 变得更好的东西。Spring 也不是一个漂亮的服务定位器。这也使得进行单元测试变得更加困难，因为你失去了一些非常好的松耦合。（您以这种方式拧紧联轴器）

IMO 仅凭这些论点就足以成为转换的理由。我什至不会开始谈论性能，其他人指出这不太可能，除非你处于一些紧密的循环中。

从好的方面来说，您可能真的很容易转换为 spring 注释，这可能是您代码的原始作者没有执行“正确”spring 的原因；他不喜欢所有的xml。有了注释，您就不需要所有的 xml。

# javascript - 触发 window.onload 事件时会加载哪些外部资源，资源的加载顺序是什么？

> ID：473628
> 
> 赞同：9
> 
> 时间：2009-01-23T16:49:54.697
> 
> 标签：javascript, html, browser

由于单个网页可能包含大量外部资源：外部 javascript、外部 css、图像、小程序、flash 等，通常我的传统观念告诉我，当所有链接资源完成下载时会触发 window.onload 事件（虽然外部资源通常由浏览器的实现在多个线程或进程中下载）。通常的情况可能在大多数情况下都有效。但是...如果加载顺序不是我认为理所当然的，那么某些 javascript 错误可能会在某个地方和某个时间蔓延。

经过一番搜索，我发现情况并非我通常认为的那样。从此页面：[https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5214317.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5214317.html)，似乎在触发 onload 事件时未加载图像。但是从这里[window.onload vs <body onload=""/>](https://stackoverflow.com/questions/191157/window-onload-vs-body-onload)，在我看来，图像是在 onload 被触发时加载的。[从这个链接http://forums.mozillazine.org/viewtopic.php?f=25&t=413504&start=0&st=0&sk=t&sd=a](http://forums.mozillazine.org/viewtopic.php?f=25&t=413504&start=0&st=0&sk=t&sd=a)对我来说有更多的困惑。

所以我的第一部分问题是：当 window.onload 被触发时，所有资源是否真的被加载了？

另一个密切相关的问题是：window.onload 被触发之前的资源加载顺序是什么？我知道对于内部资源，例如内部 javascript 或 css，加载顺序是从页面顶部到底部（除非在 IE 中，使用延迟脚本，因为这里说[当页面 DOM 加载时收到通知（但在 window.onload 之前） ）](https://stackoverflow.com/questions/65434/getting-notified-when-the-page-dom-has-loaded-but-before-window-onload)）。但是外部 javascript 和 css 资源呢？例如，如果我这样写我的页面：

```
 <external stylesheet...>
 <external javascript #1...>
 <external javascript #2...>
 <script>
  .....
  window.onload=....
  </script> 
```

然后假设“external javascript #2”中的一个函数调用“external javascript #1”中的一个函数，我可以确定它总是有效吗？此外，如果 window.onload 调用“外部 javascript #1”中的函数也可以按预期工作？

您可能会说资源加载顺序以及何时触发 window.onload 事件取决于浏览器实现，如此处所述[What is the event priority in JavaScript?](https://stackoverflow.com/questions/282245/what-is-the-event-precedence-in-javascript) . 但我仍然想知道是否有公开的规范或约定。那么，请您向我推荐资源或告诉我事实以消除我的困惑吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T19:17:59.157

查看[Cuzillion](http://stevesouders.com/cuzillion/)。它是由雅虎性能团队的 Steve Souders 编写的，旨在准确评估这些事情。

归根结底是：浏览器按照它们在文档中遇到的顺序加载脚本，并且在下载每个脚本时所有其他加载都停止。其他资源（css/图像）是异步加载的，您无法确定它们何时完成。

onload 事件在加载文档及其脚本/样式/图像资源时触发，但如果您在加载页面时执行任何 javascript，您可能不想等待图像。相反，使用类似 jQuery 的“就绪”事件或通过在正文末尾放置一个脚本标签来触发您自己的“DOMReady”事件：

```
<body>
    <!-- your page contents here -->
    <script type="text/javascript">
        // DOM is ready, do scripty stuff now
        DOMReady();
    </script>
</body> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T17:20:31.997

您提供的 SO 链接有点误导；body onload 和 window onload 都调用相同的事件，但事件不会同时触发。Window.onload 将按照您的第一个资源解释的方式在正文加载之前触发。

出于解释的原因，浏览器以串行方式请求 javascript 资源，因为它们可以并行请求其他所有内容。这就是为什么有时你会加载一个页面，并且图像会乱序加载，而 javascript，除非你提到的 ie 情况，否则会按顺序加载。所以是的，资源将被加载。

此外，浏览器首先评估 js 函数，因此在显式定义之前调用函数应该没有任何问题。但是，这不适用于变量。

最后一件事，CSS 是自上而下解释的；无论它们如何加载，浏览器都会解释从顶部开始并向下运行的规则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T17:06:35.457

在 onload 触发之前加载脚本资源。然而，imgs 以惰性异步方式加载，不一定按照它们在文档中列出的顺序。

我至少在 IE 上还发现，并非所有 DOM 元素属性在加载时都能正确计算（例如，客户端和偏移量大小在它们应该具有值时仍然可以为 0）。

# visual-studio-2008 - 在 Visual Studio 中搜索 Crystal Reports 并确定是否正在使用 SQL table/proc

> ID：473645
> 
> 赞同：4
> 
> 时间：2009-01-23T16:52:35.687
> 
> 标签：visual-studio-2008, search, crystal-reports

您好，我的 VS2008 项目中有许多水晶报告。

我正在对我的几个数据库表进行更改，并希望确保对报告进行所有必要的更改。我已经对正在使用的特定存储过程进行了标准的 VS 搜索，但没有找到任何结果。然而，当我进入一份报告并查看“选择专家”时，我发现该程序实际上正在被使用。

有没有办法轻松搜索此程序（和其他程序）的所有报告？还是我必须进入每一份报告并检查？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T13:54:29.343

这是我构建的 VB proc 的一部分，用于生成报告使用的所有表的列表。报告列在“报告表”中，我使用备注字段来存储所有使用过的表的名称。一旦表格被修改，就很容易更新所有请求的报告。

```
Public function tablesUsedByAReport(myReportName as string) as string
Dim m_report As CRAXDRT.Report, _
      m_crystal As CRAXDRT.Application, _
      m_tablesUsedByAReport As String

Dim m_table As CRAXDRT.DatabaseTable, _
      m_section As CRAXDRT.section, _
      m_objet As Object, _
      m_subReport As CRAXDRT.SubreportObject

Set m_crystal = New CRAXDRT.Application
Set m_rapport = m_crystal.OpenReport(m_nomRapport, 1)

'table names in the report'
For Each m_table In m_rapport.Database.tables
    m_tablesUsedByAReport = m_tablesUsedByAReport & m_table.location & ";"
Next m_table

'table names in each of the subreports'
For Each m_section In m_rapport.Sections
    For Each m_objet In m_section.ReportObjects
        If m_objet.Kind = crSubreportObject Then
            Set m_subReport = m_objet
            Set m_report = m_subReport.OpenSubreport
            For Each m_table In m_rapport.Database.tables
                m_tablesUsedByAReport = m_tablesUsedByAReport & m_table.location & ";"
           Next m_table
        End If
    Next m_objet
Next m_section

'my tables list'
tablesUsedByAReport = m_tablesUsedByAReport

End function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T10:02:17.627

我对报告服务报告有类似的问题。我最终使用了一个名为[Agent Ransack](http://www.mythicsoft.com/agentransack/download.aspx)的免费软件应用程序。我确信有很多工具可以做同样的事情，但这就是我使用的。我只是将它指向一个文件夹并将我要查找的表名放在“包含文本字段”中。我将源代码从 TFS 拉到我的 VS 项目文件夹中，这个应用程序很快就可以搜索所有子目录，而且它似乎总能找到我需要的东西。它没有集成到 VS 中，但如果没有人提供更好的解决方案，它可能值得一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T13:58:48.903

我将 Philippe 的代码修改为：

```
Public Function tablesUsedByAReport(ByRef report As CrystalDecisions.CrystalReports.Engine.ReportClass) As String

    Dim m_tablesUsedByAReport As String = String.Empty

    Dim myTables As Tables = report.Database.Tables

    'table names in the report'
    For Each myTable As CrystalDecisions.CrystalReports.Engine.Table In myTables
        m_tablesUsedByAReport = m_tablesUsedByAReport & myTable.Location & ";"
    Next
    For Each subreport As CrystalDecisions.CrystalReports.Engine.ReportDocument In report.Subreports
        For Each mytable As CrystalDecisions.CrystalReports.Engine.Table In subreport.Database.Tables
            m_tablesUsedByAReport = m_tablesUsedByAReport & mytable.Location & ";"
        Next
    Next
    Return m_tablesUsedByAReport

End Function 
```

# svn - 您如何存储程序的依赖项，并在 SCC 中测试项目部署？

> ID：473649
> 
> 赞同：1
> 
> 时间：2009-01-23T16:52:55.640
> 
> 标签：svn, deployment, continuous-integration

我正在从 Visual source safe 迁移到 SVN，所以请原谅我的无知。我正在浏览[这个](http://studenthelp.itee.uq.edu.au/faq/subversion/)关于 SVN 最佳实践的链接。对我来说，有些东西似乎很奇怪。

> SVN 中的第三方软件项目或依赖项的副本是不可接受的

什么 ？？？如果我不将依赖项保存在 SVN 中，Team city 应该如何构建我的项目？新开发人员如何一步到位？我在哪里可以保存我的测试的一些依赖项（比如我的项目中包含原始数据的测试子文件夹）。

我是否在某处遗漏了一个重要概念？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T16:55:17.867

我不同意这种说法。我们将第三方 dll 保存在我们的存储库中，因此构建服务器可以编译项目，而无需我们安装 sdk 或其他软件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T17:08:20.913

这些是昆士兰大学的“良好做法”。通读该文档，您会发现他们的存储库有配额。这可能就是他们不希望存储库中包含第三方二进制文件的原因。那可能是由于许可问题（毕竟，他们是一所大学，可能不允许学生使用许可的库）。

对于您的公司，您可以设置自己的“良好/最佳实践”。绝对允许将第三方库放入存储库中，这取决于您的设置，甚至需要！

一些公司甚至将所有开发工具都放在存储库中，以确保可以使用相同的编译器/ide 再次构建代码。但我不建议这样做——我宁愿将编译器/ide 存储在其他地方而不是存储库中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T17:06:05.800

我也不同意这种说法。我认为该声明的背景是它似乎为大量人员提供了一个共享存储库，因此管理磁盘配额等是主要关注点。

根据需要归档依赖项、工具等是一种很好的做法，以确保您可以在需要时重新创建旧的发布/构建环境。

# vba - 如何从宏中选择基于单元格

> ID：473650
> 
> 赞同：2
> 
> 时间：2009-01-23T16:53:32.537
> 
> 标签：vba, excel

这应该很简单，不知道为什么我会遇到麻烦......在用户输入数据的数据输入范围内，表单的“左”和“右”侧。不必填写任何给定行中的所有数据。我想创建一个宏（并将其分配给热键 IE ctrl-z ），这样如果它被击中，它将把活动单元格定位在当前行和列“X”。换句话说，按 ctrl-Z 将导致光标跳转到“X”列

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T17:43:30.563

在这种情况下，“x”列实际上是 E 列：

```
Sub ToColE()
    Const colE = 5
    Dim offset As Integer
    offset = colE - ActiveCell.Column
    ActiveCell.offset(rowOffset:=0, columnOffset:=offset).Activate
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T17:46:35.750

尝试这个

```
Sub MoveLeftOnForm()
    Dim rn As Integer
    rn = ActiveCell.Row
    Range("B" & rn).Select
End Sub 
```

它假设 B 是表单中最左边的列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T17:43:50.873

以下任何一个语句都可以解决问题。从工具菜单-> 宏分配宏快捷方式。

```
Public Sub SelectStuff()
    Cells(3, 5).Select
    Rows(17).Select
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T18:29:30.110

This code should do it for you:

```
Public Sub SetUpKeyboardShortcut()
    Application.OnKey "^z", "SelectColInSelectedRow"
End Sub

Public Sub SelectColInSelectedRow()
    Const ColToSelect = "X"
    Range(ColToSelect & CStr(Selection.Row)).Select
End Sub 
```

Just call SetUpKeyboardShortcut in the Workbook_Open event in the ThisWorkbook module. I believe the code above needs to be stored in a standard module.

Hope that helps...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T14:26:47.967

这将起作用：

```
Public Sub go()
Cells(ActiveCell.Row, 5).Activate
End Sub 
```

只需将“5”替换为您想要的任何列号。您应该能够从宏菜单上的选项中指定一个 ctrl+z 热键。

# c - 为什么不按 enter 返回 '\n' 到 getch()？

> ID：473661
> 
> 赞同：7
> 
> 时间：2009-01-23T16:56:51.997
> 
> 标签：c, input

```
#include <stdio.h>
#include <conio.h>
main()
{
    char ch,name[20];
    int i=0;
    clrscr();
    printf("Enter a string:");
    while((ch=getch())!='\n')
    {
        name[i]=ch;
        i++;
    }
    name[i] = '\0';
    printf("%s",name);
} 
```

当我将“abc”作为输入时，如果我按下回车键，它就不起作用。谁能告诉我为什么当我按下回车时条件 ch=getch() != '\n' 没有变成假？我还观察到 ch 正在使用 \r 而不是 \n。请告诉我。谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-23T17:02:47.087

使用 '\r' 并**用 '\0' 终止你的字符串。**

此外，您可能会尝试使用 getche() 为用户提供视觉回声并进行一些其他一般性更正：

```
#include <stdio.h>
#include <conio.h>

#define MAX_NAME_LENGTH 20

int main()
{
    char ch, name[MAX_NAME_LENGTH];
    int i=0;
    clrscr();
    printf("Enter a string:");
    while ( ((ch=getche())!='\r') && (i < MAX_NAME_LENGTH - 1) )
    {
        name[i]=ch;
        i++;
    }
    name[i] = '\0';
    printf("%s\n",name);

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T16:58:43.007

尝试 \r 而不是 \n

\n 是换行符 (0x0A) 或十进制 10，\r 是回车符 (0x0D) 或十进制 13。

返回键是回车键。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-08-16T07:17:32.270

键盘的回车键是回车，或 CR。这是通过运行程序并分析结果来发现的。

当你按下回车键时，回车键的 ASCII 值不会被返回，而是 CR 被返回。

因此`(ch=getch())!='\n'`应更改为以下任何等效语句：

```
ch=getch())!='\r' 
ch=getch())!=13     // ASCII for CR: decimal
ch=getch())!=0xd     // hexadecimal for CR
ch=getch())!=0xD     // hexadecimal for CR
ch=getch())!=015     // octal for CR 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T17:00:08.403

在某些系统上，换行符是“\r\n” 回车（回车）是“\r”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T17:01:02.893

这是因为键盘上的返回键在内部表示为“\r”而不是“\n”。为了使该特定示例起作用，您需要改为捕获 '\r'。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T17:02:38.930

在 Windows 上，输入实际上是“\r\n”（回车和换行）。getchar() 将返回 '\n' 我认为。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-09T05:27:20.910

的实际含义`\n`是`\r`+ `\n`。`getch()`函数从键盘读取一个字符。
它不会回显它，也不会等待下一个字符。
所以每当我们输入`\n`字符`getch()`函数时，只读取`\r`字符。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-06-17T15:05:45.507

```
#include <stdio.h>
#include <conio.h>
int main()
{
    char ch,name[20];
    int i=0;
    printf("Enter a string:");
    while(1)
    {
      ch = getch();
      if(ch==13) //enter ASCII value
      {
        name[i]='\0';
        break;
      }
      else
      {
        name[i]=ch;
        i++;
        printf("*");
      }
    }
    printf("%s",name);
    return 0;
} 
```

您还可以通过简单地添加退格功能

```
else if(ch==8) //ASCII value of Backspace
 {
   if(i>0)
   {
     i--;
     printf("\b \b");
   }
 } 
```

到 if else 语句

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-23T17:18:31.923

这取决于您的系统。您还必须知道*getch()*它是 X-Open 或 OpenGroup 发布的 XSI 诅咒标准的一部分，与 Borland 特定的*conio.h*头文件无关。

您必须使用**getchar(3)**或**getc(3)**，它们都属于*[ISO/IEC 9899:1990](http://en.wikipedia.org/wiki/C99)*标准。这两个调用分别只从控制终端/控制台或输入流中检索一个字节。

如果您从 Windows 平台调用它们，您可以使用 Enter 键、*'\r'、'\n'*序列来检索，而不仅仅是 '\n'。然后，您必须围绕**getchar(3)**或**getc(3)**调用创建一个循环。此外，通过*stdin*调用**fgets(3)**可以获取*'\r', '\n'*序列。

 **还有一点，有些平台需要刷新标准输入流，那么您必须将*fflush* **(3)**调用应用到*标准输入*流。

**fgets(3)**和**fflush(3)**属于*ISO/IEC 9899:1990*标准。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-01-23T17:07:18.123

我认为最好简单地使用：

```
scanf("%19s", name); 
```

而不是 getch 的东西。

# c++ - 我看到许多使用“Foo ^ bar”的 C++ 示例——“^”是什么？

> ID：473662
> 
> 赞同：5
> 
> 时间：2009-01-23T16:57:00.670
> 
> 标签：c++

那是.NET相关的吗？它似乎是某种指针，有什么区别？

编辑：

我实际上知道它是 XOR 运算符，但是从这个页面看这个例子。

```
void objectCollection() {
    using namespace System::Collections;

    **ArrayList ^as = gcnew ArrayList;**

    //... } 
```

这是什么？

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-23T16:59:50.043

我假设您正在查看表单的构造：

```
Foo ^bar = gcnew Foo(); 
```

你是对的，在 .NET 中它是一种指针“类似”类型，是 C++/CLI 的一部分，不是标准 ISO C++。

它是对垃圾收集的托管 .NET 对象的引用，而不是常规的非托管 C++ 对象。

正如另一张海报所暗示的，在 .NET 世界之外或在非对象创建上下文中，它是 XOR 运算符。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T16:58:38.670

在 C++ 中，这就是[XOR](http://en.wikipedia.org/wiki/Xor)运算符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T17:02:41.317

[我实际上知道它是 XOR 运算符，但是从这个页面](http://msdn.microsoft.com/en-us/library/ms379600(VS.80).aspx)看这个例子。

```
void objectCollection()
{
    using namespace System::Collections;

    **ArrayList ^as = gcnew ArrayList;**

    //...
} 
```

这是什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T17:02:49.787

在使用托管 C++ 时，这是 .NET 引用类型的句柄。看到[这个](http://en.wikipedia.org/wiki/C%2B%2B/CLI)。

# perl - Perl 有枚举类型吗？

> ID：473666
> 
> 赞同：60
> 
> 时间：2009-01-23T16:57:38.097
> 
> 标签：perl, enums

Perl 是否有一个*符合最佳实践*的枚举类型，或者更重要的是，它是否需要一个？

我正在工作的项目在所有地方都使用字符串来表示通常在 C# 等语言中使用 Enum 的事物。例如，我们在哈希数组中有一组电话号码，每个电话号码都与电话类型（“家庭”、“工作”、“手机”等）相关联：

```
$phone_number->{type} = 'Home'; 
```

在这里使用一组只读变量就足够了，还是应该使用枚举？我[`enum`在 CPAN 上找到了一个模块，](http://search.cpan.org/perldoc/enum)但它似乎使用了违反[Perl Best Practices](http://oreilly.com/catalog/9780596001735/)之一的裸词。我对使用[只读变量](http://search.cpan.org/perldoc/Readonly)的想法是这样的：

```
use Readonly;

Readonly my $HOME   => 'Home';
Readonly my $WORK   => 'Work';
Readonly my $MOBILE => 'Mobile';

$phone_number->{type} = $HOME; 
```

这是一个好方法还是有更好的方法？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-01-23T19:52:07.760

不，没有内置的枚举构造。Perl 并没有做很多严格的输入，所以我认为实际上几乎不需要。

在我看来，[`Readonly`](https://metacpan.org/pod/Readonly)您使用的方法是可靠的。

还有更传统的[`constant`](http://perldoc.perl.org/constant.html)pragma。

```
use constant {
    HOME   => 'Home',
    WORK   => 'Work',
    MOBILE => 'Mobile',
};

$phone_number->{type} = HOME; 
```

在幕后，它为每个返回值的常量设置了一个函数，就像这样。

```
sub HOME () { 'Home' } 
```

[`Readonly`](https://metacpan.org/pod/Readonly)除非您想利用该属性，否则我会坚持使用，例如：

```
package Phone::Type;

use constant {
    HOME => 'Home',
    #...
};

package main;

print Phone::Type->HOME, "\n"; 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-06-24T11:17:46.597

Perl 实际上确实有一个类似于 C 中的枚举类型。试试这个以获取详细信息。

[`perldoc enum`](https://metacpan.org/pod/enum "enum - Perl 中的 C 风格枚举类型和位掩码标志")

例如：

```
use enum qw(HOME WORK MOBILE); 
```

现在我们有：

```
HOME == 0
WORK == 1
MOBILE == 2 
```

您也可以自己设置索引：

```
use enum qw(HOME=0 WORK MOBILE=10 FAX); 
```

现在我们有：

```
HOME == 0
WORK == 1
MOBILE == 10
FAX == 11 
```

[在这里](https://metacpan.org/pod/enum "enum - Perl 中的 C 风格枚举类型和位掩码标志")查看更多详细信息。

请注意，并非每个版本的 Perl 都支持这一点。我知道 v5.8.3 不支持它，而 v5.8.7 支持。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-23T17:06:59.730

Perl 本身不支持这个概念，但是有一些模块可以添加这个功能

[https://metacpan.org/pod/enum](https://metacpan.org/pod/enum)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-23T19:39:58.410

你的方法绰绰有余。

如果您碰巧使用 Moose，您还可以使用 Moose::Util::TypeConstraints 创建枚举。（你应该是。）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-03-23T15:41:04.570

当涉及到这些枚举和命名常量时，恐怕 perl 完全瘫痪了：

*   enum 和 Readonly 不是核心模块（至少在我刚刚检查过的 perl 5.8 中）。因此，在没有自由安装新模块的系统上，这些可能不可用。

*   “use Constant”和“use strict”（应该始终使用）是完全不可用的，因为它会生成大量可怕的错误消息，如下所示：

    使用“strict subs”时不允许使用裸词“FRED”

让我们希望他们已经在 perl 6 中解决了这个烂摊子，如果这能看到曙光的话！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-26T17:55:27.930

这对我来说效果很好......

```
use constant MYENUM => qw(ZERO ONE TWO THREE FOUR);

BEGIN {
    eval "use constant (MYENUM)[$_] => $_;" foreach 0..(MYENUM)-1;
} 
```

然后，您可以使用`ZERO, ONE, TWO`etc 作为常量并使用 . 打印出它们的符号名称`(MYENUM)[$value]`。

# c# - TDD：帮助编写可测试类

> ID：473679
> 
> 赞同：6
> 
> 时间：2009-01-23T17:00:14.660
> 
> 标签：c#, asp.net-mvc, unit-testing, tdd

我有一个快速的小应用程序，并想尝试使用 TDD 进行开发。在我找到 ASP.NET-MVC 之前，我从未使用过 TDD，实际上我什至不知道它是什么。（我的第一个 MVC 应用程序有单元测试，但它们很脆弱，耦合方式，需要太多的维护，并且被放弃了——我来学习单元测试！= TDD）。

应用背景：

我有一个以字符串形式读取的采购订单的文本转储。我需要解析文本并返回新的采购订单号、新的行项目号、旧的采购订单号、旧的采购订单行号。很简单。

现在我只处理新的采购订单详细信息（编号/行）并且有这样的模型：

```
public class PurchaseOrder
{
    public string NewNumber {get; private set;}
    public string NewLine {get; private set;}

    new public PurchaseOrder(string purchaseOrderText)
    {
        NewNumber = GetNewNumber(purchaseOrderText);
        NewLine = GetNewLine(purchaseOrderText);
    }

    // ... definition of GetNewNumber / GetNewLine ...
    //  both return null if they can't parse the text
} 
```

现在我想添加一个方法“IsValid”，只有在“NewNumber”和“NewLine”都为非空时才为真。所以我想像这样测试它：

```
public void Purchase_Order_Is_Valid_When_New_Purchase_Order_Number_And_Line_Number_Are_Not_Null()
{
    PurchaseOrder order = new PurchaseOrder()
    {
        NewNumber = "123456",
        NewLine = "001"
    };

    Assert.IsTrue(order.IsValid);
} 
```

这很容易，但允许公共设置器和无参数构造器似乎是一个糟糕的折衷方案。因此，替代方法是在构造函数中输入“purchaseOrderText”值，但随后我也在测试“GetNewNumber”和“GetNewLine”的代码。

我对如何将其编写为可测试的类感到困惑，同时试图将其锁定在对模型有意义的方面。这似乎是一个常见问题，所以我想我只是缺少一个明显的概念。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T17:08:26.063

一种解决方案是不让构造函数完成工作：

```
public class PurchaseOrder
{
    public PurchaseOrder(string newNumber, string newLine)
    {
        NewNumber = newNumber;
        NewLine = newLine;
    }
    // ...
} 
```

`GetNewNumber`然后测试很容易和孤立 - 你不是`GetNewLine`在同时进行测试。

为了帮助使用`PurchaseOrder`，您可以创建一个将其组合在一起的工厂方法：

```
public static PurchaseOrder CreatePurchaseOrder(string purchaseOrderText)
{
   return new PurchaseOrder(
     GetNewNumber(purchaseOrderText),
     GetNewLine(purchaseOrderText));
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T17:07:46.220

不要将设置器公开，而是将它们设置为内部，然后在您的主项目中创建您的测试程序集 InternalsVisibleTo。这样，您的测试可以看到您的内部成员，但没有其他人可以看到。

在你的主项目中，放这样的东西；

```
[assembly: InternalsVisibleTo( "UnitTests" )] 
```

其中 UnitTests 是您的测试程序集的名称。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T17:10:45.213

在测试项目中为您的类创建一个私有访问器，然后使用该访问器为您的测试设置属性。在 VS 中，您可以通过在类中右键单击，选择 Create Private Accessor，然后选择测试项目来创建私有访问器。在您的测试中，您可以像这样使用它：

```
public void NameOfTest()
{
    PurchaseOrder_Accessor order = new PurchaseOrder_Accessor();
    order.NewNumber = "123456";
    order.NewLine = "001";
    Assert.IsTrue(order.IsValid);
} 
```

如果你有一个默认构造函数，你可以这样做：

```
public void NameOfTest()
{
    PurchaseOrder order = new PurchaseOrder()
    PurchaseOrder_Accessor accessor =
                new PurchaseOrder_Accessor( new PrivateObject(order) );
    accessor.NewNumber = "123456";
    accessor.NewLine = "001";
    Assert.IsTrue(order.IsValid);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T17:15:10.167

我可能会创建一个新的构造函数 public PurchaseOrder(string newNumber, string newLine)。IMO，无论如何您都可能需要它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T17:15:44.940

有点题外话:)

使用 TDD，首先要编写单元测试，然后只需编写足够的代码以通过测试，然后再进行重构。通过首先编写测试，您应该确切地知道什么以及如何编程以使您的代码可测试！

只是我的2美分...

# actionscript-3 - ScrollPane 设置滚动位置

> ID：473684
> 
> 赞同：0
> 
> 时间：2009-01-23T17:01:10.040
> 
> 标签：actionscript-3

我无法从我的动作脚本中控制滚动窗格的滚动（我使用的是动作脚本 3.0）

**这是我的定义：**

```
var scrollPane:ScrollPane = new ScrollPane();
scrollPane.verticalScrollPolicy = "false";
scrollPane.move(374, 0);
scrollPane.setSize(476, 370); 
```

**当我尝试设置它时 - scrollPane.horizo​​ntalScrollPosition = 500; 我收到以下错误**

```
TypeError: Error #1009: Cannot access a property or method of a null object reference.
    at fl.containers::ScrollPane/setScrollDrag()
    at fl.containers::ScrollPane/draw()
    at fl.core::UIComponent/drawNow()
    at fl.containers::BaseScrollPane/set horizontalScrollPosition()
    at Program()
    at Preloader/main()
    at Preloader/enterFrameHandler() 
```

甚至 scrollPane.horizo​​ntalScrollPosition = scrollPane.horizo​​ntalScrollPosition; 抛出相同的错误。

然而 trace(scrollPane.horizo​​ntalScrollPosition); 工作得很好。

我也尝试过 hPosition，但它根本不起作用。任何关于我如何控制滚动位置的线索将不胜感激。

下面是整个代码

```
package {
    import flash.display.*;
    import flash.events.*;
    import flash.filters.*;
    import fl.transitions.Tween;
    import fl.transitions.easing.*;
    import fl.containers.ScrollPane;

    public class Program extends Sprite {
        public function Program() {
            //define variable
            var startX:Number;
            var startY:Number;
            var counter:Number = 0;
            const LIMIT:Number = 100;
            var intMessages:Number = 80;
            var intBoardSize:Number = 476*(Math.round(intMessages/15)+1);
            var intMessageMinX:Number = 35;
            var intMessageMaxX:Number = intBoardSize-99;
            var intMessageMinY:Number = 35;
            var intMessageMaxY:Number = 310;
            var activeGloveName:String = ""
            var intDegreeHigh:Number = 45;
            var intDegreeLow:Number = -45;

            //create objects
            var mcglove:mcGlove = new mcGlove();
            var mcglovetarget:mcGloveTarget = new mcGloveTarget();
            var myDropShadowFilterSmall = new DropShadowFilter (2,45,0x000000,0.65,3,3,2,3,false,false,false);
            var myDropShadowFilterDown = new DropShadowFilter (3,45,0x000000,0.65,5,5,2,3,false,false,false);
            var myDropShadowFilterUp = new DropShadowFilter (5,45,0x000000,0.65,7,7,2,3,false,false,false);
            var topShadow = new DropShadowFilter (3,90,0x000000,0.35,8,8,2,3,false,false,false);
            var holder:MovieClip = new MovieClip();
            var pinkline:Sprite = new Sprite();
            var searchBox:Sprite = new Sprite();
            var topShadowBox:Sprite = new Sprite();
            var aMessages:Array = new Array();

            //Create a glove for each message
            for (var x = 0; x < intMessages; x++){
                aMessages[x] = new mcGlove();
                aMessages[x].scaleX = .28;
                aMessages[x].scaleY = .28;
                counter = 0;
                position(aMessages[x]);
                aMessages[x].rotation = (0, 0, 0, Math.round(Math.random() * (intDegreeHigh - intDegreeLow)) + intDegreeLow);
                aMessages[x].filters = [myDropShadowFilterSmall];
                holder.addChild(aMessages[x]);
                aMessages[x].name = "glove" + x;
                aMessages[x].addEventListener(MouseEvent.MOUSE_DOWN, selectMessage);
                aMessages[x].addEventListener(MouseEvent.MOUSE_UP, releaseMessage);
                aMessages[x].buttonMode = true;
            }

            var scrollPane:ScrollPane = new ScrollPane();
            scrollPane.verticalScrollPolicy = "false";
            scrollPane.move(374, 0);
            scrollPane.setSize(476, 370);
            scrollPane.horizontalLineScrollSize = 120;

            topShadowBox.graphics.beginFill(0x333333);
            topShadowBox.graphics.drawRect(0,0,870,5);
            topShadowBox.x = -10;
            topShadowBox.y = -5;
            topShadowBox.filters = [topShadow];

            pinkline.graphics.beginFill(0xDB9195);
            pinkline.graphics.drawRect(0,0,476,2);
            pinkline.x = 374;
            pinkline.y = 353;

            searchBox.graphics.beginFill(0xDB9195);
            searchBox.graphics.drawRect(0,0,476,25);
            searchBox.x = 374;
            searchBox.y = 370;

            //add to frame
            sortObjects();

            scrollPane.source = holder;

            scrollPane.horizontalScrollPosition = 5;

            //create instance names for referancing/compairing objects
            mcglove.name = "mcglove";
            mcglovetarget.name = "mcglovetarget";

            //position the glove and modify apperiance
            mcglove.x = 163;
            mcglove.y = 211;
            mcglove.filters = [myDropShadowFilterDown];
            mcglovetarget.x = 615;
            mcglovetarget.y = 211;
            mcglovetarget.alpha = 0

            //action listeners
            mcglove.addEventListener(MouseEvent.MOUSE_DOWN, selectGlove);
            mcglove.addEventListener(MouseEvent.MOUSE_UP, releaseGlove);

            function position(target) {
                target.x = Math.round(Math.random() * (intMessageMaxX - intMessageMinX)) + intMessageMinX;
                target.y = Math.round(Math.random() * (intMessageMaxY - intMessageMinY)) + intMessageMinY;
                for (var i:uint=0; i<aMessages.length -1 ; i++) {
                    if(target.hitTestObject(aMessages[i]) && counter < LIMIT){
                        counter++;
                        position(target);
                        return false;
                    };
                }
            } 

            function selectGlove(event:MouseEvent):void {
                event.target.startDrag(true);
                var myTargetName:String = event.target.name + "target";
                var myTarget:DisplayObject = getChildByName(myTargetName);
                mcglove.filters = [myDropShadowFilterUp];
                addChild(myTarget);
                event.target.parent.addChild(event.target);
                addChild(topShadowBox);
                myTarget.alpha = .5;
                startX = event.target.x;
                startY = event.target.y;
            }

            function releaseGlove(event:MouseEvent):void {
                event.target.stopDrag();
                var myTargetName:String = event.target.name + "target";
                var myTarget:DisplayObject = getChildByName(myTargetName);
                event.target.filters = [myDropShadowFilterDown];
                myTarget.alpha = 0;

                if (event.target.dropTarget != null && event.target.dropTarget.parent == myTarget){
                    event.target.removeEventListener(MouseEvent.MOUSE_DOWN, selectGlove);
                    event.target.removeEventListener(MouseEvent.MOUSE_UP, releaseGlove);
                    event.target.x = myTarget.x;
                    event.target.y = myTarget.y;
                    var myTween:Tween = new Tween(getChildByName(event.target.name), "scaleX",Strong.easeOut,getChildByName(event.target.name).scaleX,.28,2,true);
                    var myTween2:Tween = new Tween(getChildByName(event.target.name), "scaleY",Strong.easeOut,getChildByName(event.target.name).scaleY,.28,2,true);
                    holder.addChild(getChildByName(event.target.name));
                    scrollPane.source = holder;
                    holder.getChildByName(event.target.name).x=Math.round(Math.random() * (470+Math.round(scrollPane.horizontalScrollPosition) - Math.round(scrollPane.horizontalScrollPosition))) + Math.round(scrollPane.horizontalScrollPosition);
                    holder.getChildByName(event.target.name).y=Math.round(Math.random() * (intMessageMaxY - intMessageMinY)) + intMessageMinY;
                    holder.getChildByName(event.target.name).addEventListener(MouseEvent.MOUSE_DOWN, selectMessage);
                    holder.getChildByName(event.target.name).addEventListener(MouseEvent.MOUSE_UP, releaseMessage);
                } else {
                    event.target.x = startX;
                    event.target.y = startY;
                }

                //sortObjects();
                addChild(scrollPane);
                addChild(pinkline);
                addChild(topShadowBox);
            }

            function selectMessage(event:MouseEvent):void{
                if (activeGloveName != ""){
                    var activeGlove:DisplayObject = holder.getChildByName(activeGloveName);
                    activeGlove.filters = [myDropShadowFilterSmall];
                    activeGlove.scaleX = .28;
                    activeGlove.scaleY = .28;

                holder.addChild(activeGlove);
                }
                activeGloveName = event.target.name;
                //event.target.dragIt();
                holder.addChild(holder.getChildByName(event.target.name));
                event.target.filters = [new GlowFilter(0xABEEFC, .65, 15, 15, 1, 1, false, false)];
                event.target.scaleX = .35;
                event.target.scaleY = .35;
            }

            function releaseMessage(event:MouseEvent):void{
                event.target.dropIt();
            }

            function sortObjects():void{
                addChild(mcglovetarget);
                addChild(scrollPane);
                addChild(pinkline);
                addChild(searchBox);
                addChild(mcglove);
                addChild(topShadowBox);
            }

            mcglove.buttonMode = true;

        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-16T23:13:17.267

我有同样的问题，并弄清楚是什么原因造成的。至少在我的情况下，问题在于滚动窗格还不是舞台的孩子。

这会导致您描述的错误：

```
sp.verticalScrollPosition = 0;    
this.addChild(sp) 
```

虽然这很好用：

```
this.addChild(sp)
sp.verticalScrollPosition = 0; 
```

希望能帮助到你 ：）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T17:13:56.393

Horizo​​ntalScrollPosition 是 ScrollPane 的一个属性，所以你可以通过

scrollPane.horizo​​ntalScrollPosition = 500;

而不是方法调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T17:21:59.733

如果您查看错误跟踪，则错误发生在

```
fl.containers::ScrollPane/setScrollDrag()。

```

如果你看[这里](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/)，你会发现 scrollDrag ...

*获取或设置一个值，该值指示当用户在滚动窗格内拖动内容时是否发生滚动。*

您永远不会将内容放入滚动窗格

`scrollPane.source = "...";`

我相信这就是发生错误的原因，请在设置 Horizo​​ntalScrollPosition 之前尝试将一些内容放入滚动窗格。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-03T10:58:22.747

你应该先添加`ScrollPane`到`stage`。如果`scrollPane.stage == null`你会有这样的错误。

# java - 它是否有助于 GC 使 Java 中的局部变量为空

> ID：473685
> 
> 赞同：41
> 
> 时间：2009-01-23T17:01:24.563
> 
> 标签：java, variables, garbage-collection, null, local

`myLocalVar = null;`在离开方法之前，我被迫将语句添加到 finally 子句中。原因是为了帮助GC。有人告诉我，下次服务器崩溃时我会在晚上收到短信，所以我最好这样做:-)。

我认为这是没有意义的，因为 myLocalVar 仅限于方法，并且一旦方法退出就会“丢失”。额外的归零只会污染代码，否则是无害的。

我的问题是，这个关于帮助 GC 的神话从何而来？（我被称为“Java 内存书籍”）你知道“权威”的任何文章更深入地解释它吗？有没有可能这不是神话，但真的有帮助？如果是这样，怎么做？将局部变量归零可能会造成任何伤害吗？

为了澄清，方法如下所示：

```
void method() {
  MyClass myLocalVar = null;
  try {
    myLocalVar = get reference to object;
    ... do more here ...
  } finally {
    if (myLocalVar != null) {
      myLocalVar.close(); // it is resource which we should close
    }

    myLocalVar = null; // THIS IS THE LINE I AM TALKING ABOUT
  }
} 
```

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-02T16:00:00.377

有一篇旧的 Sun 文档，*[Java Platform Performance](https://web.archive.org/web/20120626144027/http://java.sun.com:80/docs/books/performance/1st_edition/html/JPAppGC.fm.html)*（遗憾的是，链接现在已损坏，我无法找到新的），其中描述了将超出范围的局部变量归零实际上会产生影响的情况在 GC 上。

但是，该论文提到了一个非常旧的 java 版本。正如[这个问题](https://stackoverflow.com/questions/271613/are-invisible-references-still-a-problem-in-recent-jvms)中提到的（其中还包含论文中描述的问题的概要），这不再影响当前的 JVM 实现。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-23T17:08:22.943

Java GC 应该是“健全的”，但不一定立即“完成”。换句话说，它被设计成永远不会消除仍然可以通过至少一条路径访问的对象（从而导致悬空引用）。它不一定会立即完成，因为它可能需要一些时间才能删除所有可以删除的内容。

我认为大多数 GC 神话来自对这个概念的误解。许多人保留了太多的**实例变量**，这会导致问题，但这当然不是这里的问题。

其他人将局部变量放在实例变量中（例如，通过将其传递给函数），然后认为使局部变量无效会以某种方式消除变量，这当然是不正确的。

最后，有些人过度依赖 GC 并认为它会为他们执行功能关闭（例如，当变量被删除时关闭连接）当然不是这样。我认为这条线的来源是“我真的已经完成了，但我不确定如何确保这一点”。

**所以，是的，你是对的，这是不必要的。**

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-23T17:06:39.357

在这种情况下不是。myLocalVar 在函数返回后立即超出范围，因此将引用设置为 null 绝对没有任何作用。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-23T17:05:31.607

这是一个神话，可以追溯到 java 刚出现时 C++ 的人不信任 gc。

gc 知道它在做什么。清空 var 不会伤害任何东西，但它也不会真正帮助任何东西。就在前几天，杰夫对此发表了一篇[非常有趣的帖子](http://www.codinghorror.com/blog/archives/001211.html)。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-23T17:10:24.763

据我所知，`null`在变量离开作用域之前立即对其进行 ing 对垃圾收集器没有任何影响。

当然，在**某些**情况下它确实有帮助。例如 when`var`不是局部变量而是成员或静态成员。然后销毁引用可能会使对象无法访问，从而有资格被收集。

另一种情况是，如果函数分配大量临时内存来初始化一些数据以供进一步处理，并且可以在开始处理之前丢弃对临时内存的所有引用，则它甚至可能对局部变量有所帮助：

```
SomeResult SomeFunction(SomeClass param) {
    TempData big = new TempData(param);
    IntermediateResult intermediate = big.GetIntermediateResult();
    big = null; // allow GC to reclaim the memory before returning from the function
    intermediate.FurtherProcessing();
    return intermediate.EvenMoreProcessing();
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-24T20:16:20.520

在某些极端情况下，将局部变量归零确实可以提供帮助。这不适用于原始问题中的情况，但无论如何都是有教育意义的......让我们考虑这个程序：

```
public class Main {
    public static void main(String[] args) {
       {
           Main local = new Main();

           // inner = null;
       }

       while (true) {
           // long running method
       }
    }
} 
```

如果`inner = null;`被注释掉，则`local`变量中的对象在 while 循环期间不能被垃圾收集。原因是 Java 虚拟机不知道这样的范围。它只有：

```
D:\workspaces\workspace-3.4\test\src>javap -verbose -c Main
public class Main extends java.lang.Object
  minor version: 0
  major version: 50
  Constant pool:
const #1 = Method       #4.#11; //  java/lang/Object."<init>":()V
const #2 = class        #12;    //  Main
const #3 = Method       #2.#11; //  Main."<init>":()V
const #4 = class        #13;    //  java/lang/Object
const #5 = Asciz        <init>;
const #6 = Asciz        ()V;
const #7 = Asciz        Code;
const #8 = Asciz        main;
const #9 = Asciz        ([Ljava/lang/String;)V;
const #10 = Asciz       StackMapTable;
const #11 = NameAndType #5:#6;//  "<init>":()V
const #12 = Asciz       Main;
const #13 = Asciz       java/lang/Object;

{
public Main();
  Code:
   Stack=1, Locals=1, Args_size=1
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   return

public static void main(java.lang.String[]);
  Code:
   Stack=2, Locals=2, Args_size=1
   0:   new     #2; //class Main
   3:   dup
   4:   invokespecial   #3; //Method "<init>":()V
   7:   astore_1
   8:   goto    8
  StackMapTable: number_of_entries = 1
   frame_type = 8 /* same */

} 
```

没有关于局部变量范围的信息。所以从JVM的角度来看，上面的程序相当于：

```
public class Main
{

    public Main() { }

    public static void main(String args[])
    {
        Main main1 = new Main();
        do
            ;
        while(true);
    }
} 
```

（由 JAD 反编译器生成）

**结论：在像这样的非常特殊的情况下，将局部变量归零是有道理的。但是，如果方法很快就会完成（就像我原来的问题一样），那也无济于事。**

这受到[Zdenek Tronicek 对 java-cz 邮件列表](http://www.java.cz/konference/2009-February/015110.html)的评论的启发（用捷克语，抱歉）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-23T18:00:19.233

你是对的。清空一个无论如何都会立即超出范围的变量是不必要的，并且对 GC 没有任何影响。它所做的只是使代码混乱。在[Effective Java 2nd Edition](http://java.sun.com/docs/books/effective/)中，作者建议不要对局部变量进行不必要的清空。有关完整的文章，请参阅 Effective Java，第 2 版，第 6 项：消除过时的对象引用。

您还可以在 InformIT的文章[创建和销毁 Java 对象中看到这一点。](http://www.informit.com/articles/article.aspx?p=1216151&seqNum=6)阅读*整篇文章*以找到 Joshua Bloch 同意你的地方。

当局部变量超出范围时，它与将对它的引用设为空是完全相同的。

编辑：在 Sun 网站上添加到 Effective Java 2nd Edition 的链接

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-23T17:07:25.940

正如您正确指出的那样，在这种情况下归零是完全没有意义的。

回到 JDK1.3，我确实有一个非常大的对象图的案例，它还包含图中的大量循环引用。清除一些引用确实显着改善了 GC 时间。

我不确定这是否适用于现代 VM。垃圾收集器变得越来越聪明。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-23T18:49:42.723

**这个神话中的另一个可能因素是，如果您在方法结束之前**完成了局部变量，那么它可以产生影响。这将允许 GC 在方法完成之前收集该对象，这可能很有用。

有人可能在某个时候得到了该建议，并将其误解为需要始终清除局部变量。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-23T21:19:56.290

只有两种情况我发现将变量设置为 null 很有用：

*   在一个字段中创建一个大对象的单元测试中。单元测试人员可能会在所有测试的生命周期内保留测试对象和您创建的对象。这可能会导致测试仪内存不足。在这种情况下，通常最好使用局部变量而不是字段，但是如果需要字段，可以在 tearDown 中将其清除。
*   循环引用可以由 GC 清理，但不能使用简单的增量收集。这可能意味着具有循环引用的对象需要更多的工作才能清除，并且可以比其他情况下存活得更久。通常这无关紧要，但如果你想减少你的完整 GC 时间，它可以帮助打破循环引用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T17:12:14.150

我不知道技术细节，但据我记忆，该变量无非是来自当前堆栈帧的引用，并且在删除该引用之前，无法对对象进行垃圾回收。现在，但明确地将其设置为 null，您已确保引用已消失。如果你不这样做，你基本上是让 VM 决定何时清除此引用，这可能是也可能不是在退出范围时（与 C++ 不同，如果对象位于堆栈上并且必须被销毁）。可能是在堆栈帧被下一个覆盖时。我不确定是否真的有一个虚拟机可以做到这一点。

简短的回答虽然没有必要，但标记和扫描最终会得到它。顶多是时间问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-23T17:14:33.337

在某些情况下，空变量（通常是实例或类变量）可能很有用。但是在方法结束之前立即清空*局部*变量绝对没有任何作用。

当您将变量设置为 时`null`，您只是删除了对实际对象的引用。但是当局部变量超出范围时，无论如何都会删除引用；因此，将其设置为 null 作为方法的最后一行是多余的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-23T17:32:14.297

如果您的班级长时间闲逛，则将其引用的对象清空将允许收集它们。

这几乎从来都不是问题，大多数时候将对象归零是没有用的。

当您想到对象分配和释放时，请注意“系统”处理的事情：活动线程、尚未被 dispose()d 处理的窗口以及其他一两件事，但我记不清了现在。

系统中的每个对象都“挂”在一个巨大的倒挂树中的这些挂载点上。如果你从这些“根”上剪下任何树枝，整个树枝都会掉到地上，并由垃圾收集器的割草机收集。

大多数类在其整个生命周期中都需要其所有成员变量——当它们的生命结束时，它们的整个分支被修剪，包括它们的所有成员；因此 - 不需要为空。

（顺便说一下，这些修剪非常有效，甚至超过了 C++ 的免费，因为它们不需要在每个对象被释放时触摸它）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-04T02:39:20.403

如果您不再需要本地范围内的大对象，您可以给 JVM 一个提示并将引用设置为 NULL。

```
public void foobar()
{
    List<SomeObject> dataList = new ArrayList<SomeObject>();

    // heavy computation here where objects are added to dataList 
    // and the list grows, maybe you will sort the list and
    // you just need the first element... 

    SomeObject smallest = dataList.get(0);

    // more heavy computation will follow, where dataList is never used again
    // so give the JVM a hint to drop it on its on discretion
    dataList = null;

    // ok, do your stuff other heavy stuff here... maybe you even need the 
    // memory that was occupied by dataList before... 

    // end of game and the JVM will take care of everything, no hints needed
} 
```

但是在return之前没有意义，因为这是JVM自动完成的。所以我同意之前的所有帖子。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-06T14:43:42.453

将这样的局部变量置空不仅对 GC 而言毫无意义，而且可能会导致将变量不必要地加载到寄存器中以将其置空，从而使情况变得更糟。想象一下，如果在最后一次读取或写入 myLocalVar 之间有 1000 行代码，然后您引用它只是为了使引用无效。该值早已从寄存器中消失，但您必须将其重新加载到内存中才能使用它。

# c# - 在 ASP.NET MVC Beta 中通过 IP 地址限制对特定控制器的访问

> ID：473687
> 
> 赞同：71
> 
> 时间：2009-01-23T17:01:37.293
> 
> 标签：c#, asp.net-mvc, security, web-config, authorization

我有一个 ASP.NET MVC 项目，其中包含一个 AdminController 类并给了我这样的 URls：

> [http://example.com/admin/AddCustomer](http://example.com/admin/AddCustomer)
> 
> [http://examle.com/Admin/ListCustomers](http://examle.com/Admin/ListCustomers)

我想配置服务器/应用程序，以便包含**/Admin**的 URI 只能从 192.168.0.0/24 网络（即我们的 LAN）访问

我想将此控制器限制为只能从某些 IP 地址访问。

在 WebForms 下，/admin/ 是我可以在 IIS 中限制的物理文件夹……但对于 MVC，当然没有物理文件夹。这是否可以使用 web.config 或属性来实现，还是我需要拦截 HTTP 请求来实现这一点？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2011-01-05T14:22:22.153

我知道这是一个老问题，但我今天需要这个功能，所以我实现了它并考虑在这里发布它。

从这里使用 IPList 类 ( [http://www.codeproject.com/KB/IP/ipnumbers.aspx](http://www.codeproject.com/KB/IP/ipnumbers.aspx) )

**过滤器属性FilterIPAttribute.cs：**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Http;
using System.Security.Principal;
using System.Configuration;

namespace Miscellaneous.Attributes.Controller
{

    /// <summary>
    /// Filter by IP address
    /// </summary>
    public class FilterIPAttribute : AuthorizeAttribute
    {

        #region Allowed
        /// <summary>
        /// Comma seperated string of allowable IPs. Example "10.2.5.41,192.168.0.22"
        /// </summary>
        /// <value></value>
        public string AllowedSingleIPs { get; set; }

        /// <summary>
        /// Comma seperated string of allowable IPs with masks. Example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0"
        /// </summary>
        /// <value>The masked I ps.</value>
        public string AllowedMaskedIPs { get; set; }

        /// <summary>
        /// Gets or sets the configuration key for allowed single IPs
        /// </summary>
        /// <value>The configuration key single I ps.</value>
        public string ConfigurationKeyAllowedSingleIPs { get; set; }

        /// <summary>
        /// Gets or sets the configuration key allowed mmasked IPs
        /// </summary>
        /// <value>The configuration key masked I ps.</value>
        public string ConfigurationKeyAllowedMaskedIPs { get; set; }

        /// <summary>
        /// List of allowed IPs
        /// </summary>
        IPList allowedIPListToCheck = new IPList();
        #endregion

        #region Denied
        /// <summary>
        /// Comma seperated string of denied IPs. Example "10.2.5.41,192.168.0.22"
        /// </summary>
        /// <value></value>
        public string DeniedSingleIPs { get; set; }

        /// <summary>
        /// Comma seperated string of denied IPs with masks. Example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0"
        /// </summary>
        /// <value>The masked I ps.</value>
        public string DeniedMaskedIPs { get; set; }

        /// <summary>
        /// Gets or sets the configuration key for denied single IPs
        /// </summary>
        /// <value>The configuration key single I ps.</value>
        public string ConfigurationKeyDeniedSingleIPs { get; set; }

        /// <summary>
        /// Gets or sets the configuration key for denied masked IPs
        /// </summary>
        /// <value>The configuration key masked I ps.</value>
        public string ConfigurationKeyDeniedMaskedIPs { get; set; }

        /// <summary>
        /// List of denied IPs
        /// </summary>
        IPList deniedIPListToCheck = new IPList();
        #endregion

        /// <summary>
        /// Determines whether access to the core framework is authorized.
        /// </summary>
        /// <param name="actionContext">The HTTP context, which encapsulates all HTTP-specific information about an individual HTTP request.</param>
        /// <returns>
        /// true if access is authorized; otherwise, false.
        /// </returns>
        /// <exception cref="T:System.ArgumentNullException">The <paramref name="httpContext"/> parameter is null.</exception>
        protected override bool IsAuthorized(HttpActionContext actionContext)
        {
            if (actionContext == null)
                throw new ArgumentNullException("actionContext");

            string userIpAddress = ((HttpContextWrapper)actionContext.Request.Properties["MS_HttpContext"]).Request.UserHostName;

            try
            {
                // Check that the IP is allowed to access
                bool ipAllowed = CheckAllowedIPs(userIpAddress);

                // Check that the IP is not denied to access
                bool ipDenied = CheckDeniedIPs(userIpAddress);    

                // Only allowed if allowed and not denied
                bool finallyAllowed = ipAllowed && !ipDenied;

                return finallyAllowed;
            }
            catch (Exception e)
            {
                // Log the exception, probably something wrong with the configuration
            }

            return true; // if there was an exception, then we return true
        }

        /// <summary>
        /// Checks the allowed IPs.
        /// </summary>
        /// <param name="userIpAddress">The user ip address.</param>
        /// <returns></returns>
        private bool CheckAllowedIPs(string userIpAddress)
        {
            // Populate the IPList with the Single IPs
            if (!string.IsNullOrEmpty(AllowedSingleIPs))
            {
                SplitAndAddSingleIPs(AllowedSingleIPs, allowedIPListToCheck);
            }

            // Populate the IPList with the Masked IPs
            if (!string.IsNullOrEmpty(AllowedMaskedIPs))
            {
                SplitAndAddMaskedIPs(AllowedMaskedIPs, allowedIPListToCheck);
            }

            // Check if there are more settings from the configuration (Web.config)
            if (!string.IsNullOrEmpty(ConfigurationKeyAllowedSingleIPs))
            {
                string configurationAllowedAdminSingleIPs = ConfigurationManager.AppSettings[ConfigurationKeyAllowedSingleIPs];
                if (!string.IsNullOrEmpty(configurationAllowedAdminSingleIPs))
                {
                    SplitAndAddSingleIPs(configurationAllowedAdminSingleIPs, allowedIPListToCheck);
                }
            }

            if (!string.IsNullOrEmpty(ConfigurationKeyAllowedMaskedIPs))
            {
                string configurationAllowedAdminMaskedIPs = ConfigurationManager.AppSettings[ConfigurationKeyAllowedMaskedIPs];
                if (!string.IsNullOrEmpty(configurationAllowedAdminMaskedIPs))
                {
                    SplitAndAddMaskedIPs(configurationAllowedAdminMaskedIPs, allowedIPListToCheck);
                }
            }

            return allowedIPListToCheck.CheckNumber(userIpAddress);
        }

        /// <summary>
        /// Checks the denied IPs.
        /// </summary>
        /// <param name="userIpAddress">The user ip address.</param>
        /// <returns></returns>
        private bool CheckDeniedIPs(string userIpAddress)
        {
            // Populate the IPList with the Single IPs
            if (!string.IsNullOrEmpty(DeniedSingleIPs))
            {
                SplitAndAddSingleIPs(DeniedSingleIPs, deniedIPListToCheck);
            }

            // Populate the IPList with the Masked IPs
            if (!string.IsNullOrEmpty(DeniedMaskedIPs))
            {
                SplitAndAddMaskedIPs(DeniedMaskedIPs, deniedIPListToCheck);
            }

            // Check if there are more settings from the configuration (Web.config)
            if (!string.IsNullOrEmpty(ConfigurationKeyDeniedSingleIPs))
            {
                string configurationDeniedAdminSingleIPs = ConfigurationManager.AppSettings[ConfigurationKeyDeniedSingleIPs];
                if (!string.IsNullOrEmpty(configurationDeniedAdminSingleIPs))
                {
                    SplitAndAddSingleIPs(configurationDeniedAdminSingleIPs, deniedIPListToCheck);
                }
            }

            if (!string.IsNullOrEmpty(ConfigurationKeyDeniedMaskedIPs))
            {
                string configurationDeniedAdminMaskedIPs = ConfigurationManager.AppSettings[ConfigurationKeyDeniedMaskedIPs];
                if (!string.IsNullOrEmpty(configurationDeniedAdminMaskedIPs))
                {
                    SplitAndAddMaskedIPs(configurationDeniedAdminMaskedIPs, deniedIPListToCheck);
                }
            }

            return deniedIPListToCheck.CheckNumber(userIpAddress);
        }

        /// <summary>
        /// Splits the incoming ip string of the format "IP,IP" example "10.2.0.0,10.3.0.0" and adds the result to the IPList
        /// </summary>
        /// <param name="ips">The ips.</param>
        /// <param name="list">The list.</param>
        private void SplitAndAddSingleIPs(string ips,IPList list)
        {
            var splitSingleIPs = ips.Split(',');
            foreach (string ip in splitSingleIPs)
                list.Add(ip);
        }

        /// <summary>
        /// Splits the incoming ip string of the format "IP;MASK,IP;MASK" example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0" and adds the result to the IPList
        /// </summary>
        /// <param name="ips">The ips.</param>
        /// <param name="list">The list.</param>
        private void SplitAndAddMaskedIPs(string ips, IPList list)
        {
            var splitMaskedIPs = ips.Split(',');
            foreach (string maskedIp in splitMaskedIPs)
            {
                var ipAndMask = maskedIp.Split(';');
                list.Add(ipAndMask[0], ipAndMask[1]); // IP;MASK
            }
        }

        public override void OnAuthorization(AuthorizationContext filterContext)
        {
            base.OnAuthorization(filterContext);
        }
    }
} 
```

**示例用法：**

**1.直接在代码中指定IP**

```
 [FilterIP(
         AllowedSingleIPs="10.2.5.55,192.168.2.2",
         AllowedMaskedIPs="10.2.0.0;255.255.0.0,192.168.2.0;255.255.255.0"
    )]
    public class HomeController {
      // Some code here
    } 
```

**2\. 或者，从 Web.config 加载配置**

```
 [FilterIP(
         ConfigurationKeyAllowedSingleIPs="AllowedAdminSingleIPs",
         ConfigurationKeyAllowedMaskedIPs="AllowedAdminMaskedIPs",
         ConfigurationKeyDeniedSingleIPs="DeniedAdminSingleIPs",
         ConfigurationKeyDeniedMaskedIPs="DeniedAdminMaskedIPs"
    )]
    public class HomeController {
      // Some code here
    }

<configuration>
<appSettings>
    <add key="AllowedAdminSingleIPs" value="localhost,127.0.0.1"/> <!-- Example "10.2.80.21,192.168.2.2" -->
    <add key="AllowedAdminMaskedIPs" value="10.2.0.0;255.255.0.0"/> <!-- Example "10.2.0.0;255.255.0.0,192.168.2.0;255.255.255.0" -->
    <add key="DeniedAdminSingleIPs" value=""/>    <!-- Example "10.2.80.21,192.168.2.2" -->
    <add key="DeniedAdminMaskedIPs" value=""/>    <!-- Example "10.2.0.0;255.255.0.0,192.168.2.0;255.255.255.0" -->
</appSettings>
</configuration> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-23T17:05:17.067

您应该有权访问`UserHostAddress`控制器中的 Request 对象以进行限制。我建议您可能想要扩展`AuthorizeAttribute`并添加您的`IP`地址限制，以便您可以简单地装饰任何需要这种保护的方法或控制器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-08-20T18:49:17.537

我需要一个 MVC4 中这个问题的解决方案，它可以处理 IPv6 和 IP 范围。此外，我需要使用白名单和黑名单进行授权，但当 IP 都不是时，我还需要使用常规授权过程。

这是我从@sabbour 和@Richard Szalay（[如何检查输入IP 是否在特定IP 范围内](https://stackoverflow.com/questions/2138706/how-to-check-a-input-ip-fall-in-a-specific-ip-range "如何检查输入 IP 是否属于特定 IP 范围")）获得很多精彩帖子后得出的解决方案，因此我将其发回此处，以供任何可能有帮助的人使用。

```
public class MagniAuthorizeAttribute : FilterAttribute, IAuthorizationFilter
{

    #region Allowed

    public bool IsPublic { get; set; }
    /// <summary>
    /// Comma seperated string of allowable IPs. Example "10.2.5.41,192.168.0.22"
    /// </summary>
    /// <value></value>        
    public string AllowedSingleIPs { get; set; }

    /// <summary>
    /// Comma seperated string of allowable IPs with masks. Example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0"
    /// </summary>
    /// <value>The masked I ps.</value>
    public string AllowedIPRanges { get; set; }

    /// <summary>
    /// Gets or sets the configuration key for allowed single IPs
    /// </summary>
    /// <value>The configuration key single I ps.</value>
    public string ConfigurationKeyAllowedSingleIPs { get; set; }

    /// <summary>
    /// Gets or sets the configuration key allowed mmasked IPs
    /// </summary>
    /// <value>The configuration key masked I ps.</value>
    public string ConfigurationKeyAllowedMaskedIPs { get; set; }

    #endregion

    #region Denied
    /// <summary>
    /// Comma seperated string of denied IPs. Example "10.2.5.41,192.168.0.22"
    /// </summary>
    /// <value></value>
    public string DeniedSingleIPs { get; set; }

    /// <summary>
    /// Comma seperated string of denied IPs with masks. Example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0"
    /// </summary>
    /// <value>The masked I ps.</value>
    public string DeniedIPRanges { get; set; }

    /// <summary>
    /// Gets or sets the configuration key for denied single IPs
    /// </summary>
    /// <value>The configuration key single I ps.</value>
    public string ConfigurationKeyDeniedSingleIPs { get; set; }

    /// <summary>
    /// Gets or sets the configuration key for denied masked IPs
    /// </summary>
    /// <value>The configuration key masked I ps.</value>
    public string ConfigurationKeyDeniedMaskedIPs { get; set; }

    #endregion

    /// <summary>
    /// Checks the allowed IPs.
    /// </summary>
    /// <param name="userIpAddress">The user ip address.</param>
    /// <returns></returns>
    private bool CheckAllowedIPs(IPAddress userIpAddress)
    {
        List<IPAddress> allowedIPsToCheck = new List<IPAddress>();
        List<IPAddressRange> allowedIPRangesToCheck = new List<IPAddressRange>();

        // Populate the IPList with the Single IPs
        if (!string.IsNullOrEmpty(AllowedSingleIPs))
        {
            SplitAndAddSingleIPs(AllowedSingleIPs, allowedIPsToCheck);
        }

        // Populate the IPList with the Masked IPs
        if (!string.IsNullOrEmpty(AllowedIPRanges))
        {
            SplitAndAddIPRanges(AllowedIPRanges, allowedIPRangesToCheck);
        }

        // Check if there are more settings from the configuration (Web.config)
        if (!string.IsNullOrEmpty(ConfigurationKeyAllowedSingleIPs))
        {
            string configurationAllowedAdminSingleIPs = ConfigurationManager.AppSettings[ConfigurationKeyAllowedSingleIPs];
            if (!string.IsNullOrEmpty(configurationAllowedAdminSingleIPs))
            {
                SplitAndAddSingleIPs(configurationAllowedAdminSingleIPs, allowedIPsToCheck);
            }
        }

        if (!string.IsNullOrEmpty(ConfigurationKeyAllowedMaskedIPs))
        {
            string configurationAllowedAdminMaskedIPs = ConfigurationManager.AppSettings[ConfigurationKeyAllowedMaskedIPs];
            if (!string.IsNullOrEmpty(configurationAllowedAdminMaskedIPs))
            {
                SplitAndAddIPRanges(configurationAllowedAdminMaskedIPs, allowedIPRangesToCheck);
            }
        }

        return allowedIPsToCheck.Any(a => a.Equals(userIpAddress)) || allowedIPRangesToCheck.Any(a => a.IsInRange(userIpAddress));
    }

    /// <summary>
    /// Checks the denied IPs.
    /// </summary>
    /// <param name="userIpAddress">The user ip address.</param>
    /// <returns></returns>
    private bool CheckDeniedIPs(IPAddress userIpAddress)
    {
        List<IPAddress> deniedIPsToCheck = new List<IPAddress>();
        List<IPAddressRange> deniedIPRangesToCheck = new List<IPAddressRange>();

        // Populate the IPList with the Single IPs
        if (!string.IsNullOrEmpty(DeniedSingleIPs))
        {
            SplitAndAddSingleIPs(DeniedSingleIPs, deniedIPsToCheck);
        }

        // Populate the IPList with the Masked IPs
        if (!string.IsNullOrEmpty(DeniedIPRanges))
        {
            SplitAndAddIPRanges(DeniedIPRanges, deniedIPRangesToCheck);
        }

        // Check if there are more settings from the configuration (Web.config)
        if (!string.IsNullOrEmpty(ConfigurationKeyDeniedSingleIPs))
        {
            string configurationDeniedAdminSingleIPs = ConfigurationManager.AppSettings[ConfigurationKeyDeniedSingleIPs];
            if (!string.IsNullOrEmpty(configurationDeniedAdminSingleIPs))
            {
                SplitAndAddSingleIPs(configurationDeniedAdminSingleIPs, deniedIPsToCheck);
            }
        }

        if (!string.IsNullOrEmpty(ConfigurationKeyDeniedMaskedIPs))
        {
            string configurationDeniedAdminMaskedIPs = ConfigurationManager.AppSettings[ConfigurationKeyDeniedMaskedIPs];
            if (!string.IsNullOrEmpty(configurationDeniedAdminMaskedIPs))
            {
                SplitAndAddIPRanges(configurationDeniedAdminMaskedIPs, deniedIPRangesToCheck);
            }
        }

        return deniedIPsToCheck.Any(a => a.Equals(userIpAddress)) || deniedIPRangesToCheck.Any(a => a.IsInRange(userIpAddress));
    }

    /// <summary>
    /// Splits the incoming ip string of the format "IP,IP" example "10.2.0.0,10.3.0.0" and adds the result to the IPAddress list
    /// </summary>
    /// <param name="ips">The ips.</param>
    /// <param name="list">The list.</param>
    private void SplitAndAddSingleIPs(string ips, List<IPAddress> list)
    {
        var splitSingleIPs = ips.Split(',');
        IPAddress ip;

        foreach (string ipString in splitSingleIPs)
        {
            if(IPAddress.TryParse(ipString, out ip))
                list.Add(ip);
        }
    }

    /// <summary>
    /// Splits the incoming ip ranges string of the format "IP-IP,IP-IP" example "10.2.0.0-10.2.255.255,10.3.0.0-10.3.255.255" and adds the result to the IPAddressRange list
    /// </summary>
    /// <param name="ips">The ips.</param>
    /// <param name="list">The list.</param>
    private void SplitAndAddIPRanges(string ips, List<IPAddressRange> list)
    {
        var splitMaskedIPs = ips.Split(',');
        IPAddress lowerIp;
        IPAddress upperIp;
        foreach (string maskedIp in splitMaskedIPs)
        {
            var ipRange = maskedIp.Split('-');
            if (IPAddress.TryParse(ipRange[0], out lowerIp) && IPAddress.TryParse(ipRange[1], out upperIp))
                list.Add(new IPAddressRange(lowerIp, upperIp));
        }
    }

    protected void HandleUnauthorizedRequest(AuthorizationContext context)
    {
        context.Result = new RedirectToRouteResult(new RouteValueDictionary { { "Controller", "Home" },
                                                                                    { "Action", "Login" },
                                                                                    { "OriginalURL", context.HttpContext.Request.Url.AbsoluteUri } });
    }

    protected bool AuthorizeCore(AuthorizationContext context)
    {
        try
        {
            string userIPString = context.HttpContext.Request.UserHostName;
            IPAddress userIPAddress = IPAddress.Parse(userIPString);

            // Check that the IP is allowed to access
            bool? ipAllowed = CheckAllowedIPs(userIPAddress) ? true : (bool?)null;

            // Check that the IP is not denied to access
            ipAllowed = CheckDeniedIPs(userIPAddress) ? false : ipAllowed;

            if (ipAllowed.HasValue)
            {
                return ipAllowed.Value;
            }

            var serverSession = context.HttpContext.Session;

            UserSession session = null;

            //usersession in server session
            if (serverSession[Settings.HttpContextUserSession] != null)
            {
                session = (UserSession)serverSession[Settings.HttpContextUserSession];
                Trace.TraceInformation($"[{MethodBase.GetCurrentMethod().Name}] UserId:" + session.UserId + ". ClientId: " + session.ClientId);
                return true;
            }

            //usersession in database from cookie
            session = UserSession.GetSession(context.HttpContext.Request.Cookies.Get("sessionId").Value);
            if (session != null)
            {
                Trace.TraceInformation($"[{MethodBase.GetCurrentMethod().Name}] Session found for cookie {context.HttpContext.Request.Cookies.Get("sessionId").Value}");
                serverSession[Settings.HttpContextUserSession] = session;
                Trace.TraceInformation($"[{MethodBase.GetCurrentMethod().Name}] UserId:" + session.UserId + ". ClientId: " + session.ClientId);

                return true;
            }
            else
            {
                Trace.TraceInformation($"[{MethodBase.GetCurrentMethod().Name}] No session found for cookie {serverSession["cookie"]}");
                return false;
            }

        }
        catch (Exception ex)
        {
            Trace.TraceError($"[{MethodBase.GetCurrentMethod().Name}] exception: {ex.Message} - trace {ex.StackTrace}");
            return false;
        }
    }

    public void OnAuthorization(AuthorizationContext actionContext)
    {
        if (IsPublic == false && AuthorizeCore(actionContext) == false)
        {
            HandleUnauthorizedRequest(actionContext);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-10-04T12:51:21.800

我发现 sabbour 的解决方案非常好，但需要进行两项更改才能对我的目的更有用：

1.  如果允许列表为空，则允许访问。通过这种方式，您可以通过简单地更改配置（例如，用于测试部署）来允许任何 IP，或者允许除明确拒绝的 IP 之外的所有 IP。为此，我扩展了 IPList 以包含一个 Count 属性，并将其作为 CheckAllowedIPs 的一部分进行检查：

    ```
    return _allowedIpListToCheck.Count == 0 || _allowedIpListToCheck.CheckNumber(userIpAddress); 
    ```

2.  覆盖 HandleUnauthorizedRequest 以始终​​返回 403。 AuthorizeAtrribute 默认返回 401：

    ```
    public override void OnAuthorization(AuthorizationContext actionContext)
    {
        if (AuthorizeCore((HttpContextBase)actionContext.HttpContext))
            return;
        HandleUnauthorizedRequest(actionContext);
    }

    protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)
    {
            filterContext.Result = new HttpStatusCodeResult(403, "IP Access Denied");
    } 
    ```

这是 FilterIpAttribute 类的完整变体：

```
public class FilterIpAttribute:AuthorizeAttribute
{

    #region Allowed
    /// <summary>
    /// Comma seperated string of allowable IPs. Example "10.2.5.41,192.168.0.22"
    /// </summary>
    /// <value></value>
    public string AllowedSingleIPs { get; set; }

    /// <summary>
    /// Comma seperated string of allowable IPs with masks. Example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0"
    /// </summary>
    /// <value>The masked I ps.</value>
    public string AllowedMaskedIPs { get; set; }

    /// <summary>
    /// Gets or sets the configuration key for allowed single IPs
    /// </summary>
    /// <value>The configuration key single I ps.</value>
    public string ConfigurationKeyAllowedSingleIPs { get; set; }

    /// <summary>
    /// Gets or sets the configuration key allowed mmasked IPs
    /// </summary>
    /// <value>The configuration key masked I ps.</value>
    public string ConfigurationKeyAllowedMaskedIPs { get; set; }

    /// <summary>
    /// List of allowed IPs
    /// </summary>
    readonly IpList _allowedIpListToCheck = new IpList();
    #endregion

    #region Denied
    /// <summary>
    /// Comma seperated string of denied IPs. Example "10.2.5.41,192.168.0.22"
    /// </summary>
    /// <value></value>
    public string DeniedSingleIPs { get; set; }

    /// <summary>
    /// Comma seperated string of denied IPs with masks. Example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0"
    /// </summary>
    /// <value>The masked I ps.</value>
    public string DeniedMaskedIPs { get; set; }

    /// <summary>
    /// Gets or sets the configuration key for denied single IPs
    /// </summary>
    /// <value>The configuration key single I ps.</value>
    public string ConfigurationKeyDeniedSingleIPs { get; set; }

    /// <summary>
    /// Gets or sets the configuration key for denied masked IPs
    /// </summary>
    /// <value>The configuration key masked I ps.</value>
    public string ConfigurationKeyDeniedMaskedIPs { get; set; }

    /// <summary>
    /// List of denied IPs
    /// </summary>
    readonly IpList _deniedIpListToCheck = new IpList();
    #endregion

    protected override bool AuthorizeCore(HttpContextBase httpContext)
    {
        if (httpContext == null)
            throw new ArgumentNullException("httpContext");

        string userIpAddress = httpContext.Request.UserIp();

        try
        {
            // Check that the IP is allowed to access
            bool ipAllowed = CheckAllowedIPs(userIpAddress);

            // Check that the IP is not denied to access
            bool ipDenied = CheckDeniedIPs(userIpAddress);

            //Only allowed if allowed and not denied

            bool finallyAllowed = ipAllowed && !ipDenied;

            return finallyAllowed;
        }
        catch (Exception e)
        {
            // Log the exception, probably something wrong with the configuration
        }

        return true; // if there was an exception, then we return true
    }

    /// <summary>
    /// Checks the allowed IPs.
    /// </summary>
    /// <param name="userIpAddress">The user ip address.</param>
    /// <returns></returns>
    private bool CheckAllowedIPs(string userIpAddress)
    {
        // Populate the IPList with the Single IPs
        if (!string.IsNullOrEmpty(AllowedSingleIPs))
        {
            SplitAndAddSingleIPs(AllowedSingleIPs, _allowedIpListToCheck);
        }

        // Populate the IPList with the Masked IPs
        if (!string.IsNullOrEmpty(AllowedMaskedIPs))
        {
            SplitAndAddMaskedIPs(AllowedMaskedIPs, _allowedIpListToCheck);
        }

        // Check if there are more settings from the configuration (Web.config)
        if (!string.IsNullOrEmpty(ConfigurationKeyAllowedSingleIPs))
        {
            string configurationAllowedAdminSingleIPs = ConfigurationManager.AppSettings[ConfigurationKeyAllowedSingleIPs];
            if (!string.IsNullOrEmpty(configurationAllowedAdminSingleIPs))
            {
                SplitAndAddSingleIPs(configurationAllowedAdminSingleIPs, _allowedIpListToCheck);
            }
        }

        if (!string.IsNullOrEmpty(ConfigurationKeyAllowedMaskedIPs))
        {
            string configurationAllowedAdminMaskedIPs = ConfigurationManager.AppSettings[ConfigurationKeyAllowedMaskedIPs];
            if (!string.IsNullOrEmpty(configurationAllowedAdminMaskedIPs))
            {
                SplitAndAddMaskedIPs(configurationAllowedAdminMaskedIPs, _allowedIpListToCheck);
            }
        }

        return _allowedIpListToCheck.Count == 0 || _allowedIpListToCheck.CheckNumber(userIpAddress);
    }

    /// <summary>
    /// Checks the denied IPs.
    /// </summary>
    /// <param name="userIpAddress">The user ip address.</param>
    /// <returns></returns>
    private bool CheckDeniedIPs(string userIpAddress)
    {
        // Populate the IPList with the Single IPs
        if (!string.IsNullOrEmpty(DeniedSingleIPs))
        {
            SplitAndAddSingleIPs(DeniedSingleIPs, _deniedIpListToCheck);
        }

        // Populate the IPList with the Masked IPs
        if (!string.IsNullOrEmpty(DeniedMaskedIPs))
        {
            SplitAndAddMaskedIPs(DeniedMaskedIPs, _deniedIpListToCheck);
        }

        // Check if there are more settings from the configuration (Web.config)
        if (!string.IsNullOrEmpty(ConfigurationKeyDeniedSingleIPs))
        {
            string configurationDeniedAdminSingleIPs = ConfigurationManager.AppSettings[ConfigurationKeyDeniedSingleIPs];
            if (!string.IsNullOrEmpty(configurationDeniedAdminSingleIPs))
            {
                SplitAndAddSingleIPs(configurationDeniedAdminSingleIPs, _deniedIpListToCheck);
            }
        }

        if (!string.IsNullOrEmpty(ConfigurationKeyDeniedMaskedIPs))
        {
            string configurationDeniedAdminMaskedIPs = ConfigurationManager.AppSettings[ConfigurationKeyDeniedMaskedIPs];
            if (!string.IsNullOrEmpty(configurationDeniedAdminMaskedIPs))
            {
                SplitAndAddMaskedIPs(configurationDeniedAdminMaskedIPs, _deniedIpListToCheck);
            }
        }

        return _deniedIpListToCheck.CheckNumber(userIpAddress);
    }

    /// <summary>
    /// Splits the incoming ip string of the format "IP,IP" example "10.2.0.0,10.3.0.0" and adds the result to the IPList
    /// </summary>
    /// <param name="ips">The ips.</param>
    /// <param name="list">The list.</param>
    private void SplitAndAddSingleIPs(string ips, IpList list)
    {
        var splitSingleIPs = ips.Split(',');
        foreach (string ip in splitSingleIPs)
            list.Add(ip);
    }

    /// <summary>
    /// Splits the incoming ip string of the format "IP;MASK,IP;MASK" example "10.2.0.0;255.255.0.0,10.3.0.0;255.255.0.0" and adds the result to the IPList
    /// </summary>
    /// <param name="ips">The ips.</param>
    /// <param name="list">The list.</param>
    private void SplitAndAddMaskedIPs(string ips, IpList list)
    {
        var splitMaskedIPs = ips.Split(',');
        foreach (string maskedIp in splitMaskedIPs)
        {
            var ipAndMask = maskedIp.Split(';');
            list.Add(ipAndMask[0], ipAndMask[1]); // IP;MASK
        }
    }

    public override void OnAuthorization(AuthorizationContext actionContext)
    {
        if (AuthorizeCore((HttpContextBase)actionContext.HttpContext))
            return;
        HandleUnauthorizedRequest(actionContext);
    }

    protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)
    {
            filterContext.Result = new HttpStatusCodeResult(403, "IP Access Denied");
    }
} 
```

[osa 在github](https://gist.github.com/rdingwall/2028849)上建议的获取用户 IP 的扩展方法

```
public static class HttpUtils {

    public static string UserIp(this HttpRequestBase request)
    {
        var ip = request["HTTP_X_FORWARDED_FOR"];

        if (!string.IsNullOrWhiteSpace(ip))
        {
            ip = ip.Split(',').Last().Trim();
        }

        if (string.IsNullOrWhiteSpace(ip))
        {
            ip = request.UserHostAddress;
        }

        return ip;
    }
} 
```

最后是 IPList 修改（完整源代码在[这里](https://www.codeproject.com/Articles/2553/IP-list-Check-an-IP-number-against-a-list-in-C)）：

```
internal class IpArrayList
{
    //[...]
    public int Count
    {
        get { return _ipNumList.Count; }
    }

 }

public class IpList
{
      //[...]
     public int Count
     {
         get { return _usedList.Count; }
     }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-06-30T16:36:30.043

我使用的最简单的方法

第一的：

在配置表（如果有）或任何其他表上添加一行，并将可访问的 IP 插入此表。

第二：

将此操作过滤器添加到您的 startup.cs

```
public class IpAuthAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        base.OnActionExecuting(filterContext);
        string ip = System.Web.HttpContext.Current.Request.UserHostAddress;
        string ips = "";
        using (var db = new DataBase())
        {
            ips = db.Configs.SingleOrDefault().IP;
        }
        if (!ips.Contains(ip))
        {
            filterContext.Result = new RedirectToRouteResult(new System.Web.Routing.RouteValueDictionary(new
            {
                controller = "Account",
                action = "OutOfRange"
            }));
        }
    }
} 
```

然后在您想要在控制器上执行的每个操作上使用它

```
[IpAuth]
public ActionResult Index()
{
    return View();
} 
```

# c# - 如何从 Buttonfield 单击获取 GridView 的当前行？

> ID：473698
> 
> 赞同：1
> 
> 时间：2009-01-23T17:05:23.370
> 
> 标签：c#, asp.net, gridview

我有一个带有 DropDownList（在项目模板中）和一个 ButtonField 的 ASP.NET GridView。

```
<my:GridView AutoGenerateColumns="false" ID="CurrentCardGrid" UseHighlights="False" runat="server" Width="100%">
 <Columns>
  <asp:BoundField HeaderText="ID" ItemStyle-Width="50px" DataField="Id" />
  <asp:TemplateField HeaderText="" ItemStyle-Width="150px">
   <ItemTemplate>
    <asp:DropDownList runat="server" ID="StatusList" Width="140px">
    </asp:DropDownList>
   </ItemTemplate>
  </asp:TemplateField>
  <asp:ButtonField Text="Update" ButtonType="Button" CommandName="Update" />
 </Columns>
</my:GridView> 
```

在代码中，我填充下拉列表并捕获 RowCommand 事件。

我的问题是，在 RowCommand 事件处理程序中，如何获取当前行？我需要从下拉列表中获取值并将行的状态（由 ID 指向）设置为下拉列表中的值。请注意，该行不会处于更新模式。

提前致谢！

汤姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T17:14:12.960

将 e.CommandArgument 转换为事件处理程序中的 int。

从[这里](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)

# c++ - 为什么在这段代码中忽略了析构函数？

> ID：473720
> 
> 赞同：7
> 
> 时间：2009-01-23T17:10:35.667
> 
> 标签：c++, destructor, c++builder

以下代码演示了我在 Turbo C++ Explorer 项目中遇到的一个奇怪问题。D::D() 中的三个堆栈对象之一在超出范围后不会被销毁。

只有在发布模式下编译时才会发生这种情况，auto_ptrs a_ 和 b_ 的类型不同，并且抛出的异常不继承自 std::exception。它似乎在 VC++ 2005 和 C++ Builder 2009 中运行良好。我确实安装了 BDS2006 更新 2、修补程序汇总和修补程序 12。

是我的代码还是编译器？你知道修复吗？不能在 VCL 项目中可靠地使用 auto_ptr 会很不方便。

```
#include <memory>
#include <stdexcept>
#include <iostream>

typedef std::exception my_error; // will work fine if replaced with line below
//class my_error : public std::exception {};

class A {};
class B {};

class C
{
public:
    C(int id) : id_(id) { std::cout << "C::C() " << id_ << std::endl; };
    ~C() { std::cout << "C::~C() " << id_ << std::endl; };
private:
    int id_;
};

class D
{
public:
    D()
    {
        C c1(1);
        C c2(2);
        C c3(3);

        throw my_error();
    };

private:
    std::auto_ptr<A> a_;
    std::auto_ptr<B> b_; // will work fine if replaced with line below
//  std::auto_ptr<A> b_;
//  std::auto_ptr<C> c_; // see expected output
};

#pragma argsused
int main(int argc, char* argv[])
{
    try
    {
        D d;
    }
    catch (...)
    {
        std::cout << "caught exception" << std::endl;
    }

    return 0;
} 
```

预期的：

```
C::C() 1
C::C() 2
C::C() 3
C::~C() 3
C::~C() 2
C::~C() 1
捕捉到异常

```

拿到：

```
C::C() 1
C::C() 2
C::C() 3
C::~C() 2
C::~C() 1
捕捉到异常

```

得到（行 ' `// std::auto_ptr<C> c_;`' 未注释）：

```
C::C() 1
C::C() 2
C::C() 3
C::~C() 1
捕捉到异常

```

**编辑：**进行了建议的更改

**编辑 2：**
我刚刚使用 C++ Builder 2007 (11.0.2902.10471) 对其进行了测试，它显示了同样的问题。只要我检查了项目 -> 选项 -> C++ 编译器 -> 调试中的“调试信息”框，发布配置就会起作用。令我惊讶的是，启用“调试信息”后可执行文件变得更小（从 39.5 KB 降至 31.5 KB）。

**编辑 3：**
在 Turbo C++ Explorer (C++ Builder 2006) (10.0.2288.42451) 中，如果我取消选中项目 -> 选项 -> C++ 编译器 -> 调试中的“内联函数扩展 (-vi)”框，则发布配置有效。将第一行 ( `#include <memory>`) 替换为以下代码也可以正常工作。

```
#pragma option push -vi-
#include <memory>
#pragma option pop 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T17:21:09.827

这似乎是一个编译器错误。我刚刚在 VS2008SP1 中运行了相同的示例并得到了预期的输出。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T17:24:05.343

不管它值多少钱，GCC 3.4.6 都做了预期的事情：

```
$ g++ main.cpp

$ a.out
C::C()
C::C()
C::~C()
C::~C()
caught exception 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T15:50:22.213

这是 C++Builder 2006 中的编译器错误。C++Builder 2009 修复了它；这是我为 BCC v6.1 得到的输出：

```
C::C() 1
C::C() 2
C::C() 3
C::~C() 3
C::~C() 2
C::~C() 1
caught exception
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T17:15:45.657

如果在对象构造函数中抛出异常，则析构函数将不会运行。

编译器无法知道构造函数是否完成得足以让析构函数正确运行。

见[http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.4](http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.4)

编辑：回应下面的评论......在这种情况下，很可能是编译器错误将“不要运行析构函数”规则与错误地不破坏堆栈上的对象混为一谈。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T17:24:47.760

也许 cout 流没有被刷新？你可以试试 cerr 吗？还是直接在析构函数中放一个断点并检查它们是否被命中？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-09T07:28:03.547

我刚刚在免费命令行 bcc5.5.1 和 C++ Builder 6 bcc5.64 上对此进行了测试，它们都按预期工作——考虑到它们的年龄，这令人惊讶。然后我在 C++ Builder 2007, bcc5.93 中尝试了这个，并且那里存在错误。事实上，示例代码可以简化为原始类型，并且错误仍然存​​在：

```
class D
{
public:
    D();

private:
    std::auto_ptr<int>      a_;
    std::auto_ptr<short>    b_;
    std::auto_ptr<char>     c_;
    std::auto_ptr<bool>     d_;
}; 
```

这个极端的例子最终导致 C 类没有调用相应的析构函数！如果您有兴趣进一步诊断此错误，您可以执行的一个技巧是在 D::D() ctor 中插入程序集断点：

```
// Note that D::D() ctor can't be inlined if it contains assembly
// limitation of borland compilers unfortunately
D::D()
{
    __asm int 3;
    C c1(1);
    C c2(2);
    C c3(3);

    throw my_error();
} 
```

然后，您将让它通过调试器运行。当执行到达指定的断点时，程序将停止并将控制权转移回调试器。然后，您可以单步执行程序集以查看问题所在。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T17:26:26.057

看起来像异常处理堆栈展开代码中的错误。尝试在 D 的构造函数中使用它的实例创建一个简单的类 E，看看它是否被调用。

# groovy - 杀死一个使用 Groovy execute() 启动的进程

> ID：473724
> 
> 赞同：5
> 
> 时间：2009-01-23T17:11:00.550
> 
> 标签：groovy, process

我可以使用 Groovy 从 Groovy 运行 Groovy 脚本

> proc = "cmd /c groovy BillingServer.groovy".execute(null, new File("C:\"))

但是，我找不到终止/终止进程的方法。 `waitForOrKill(1)`并`destroy()`像他们已经工作一样“行动”，但外部过程继续运行。调用`exitValue()`失败

> java.lang.IllegalThreadStateException：进程尚未退出

如何终止我已经启动的进程？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T19:07:50.157

我通过`cmd /c`从要执行的字符串中删除来解决这个问题。似乎 cmd 正在产生 groovy，因此`waitForOrKill()`正在杀死 cmd 进程，但 groovy 进程仍在运行。没有`cmd /c`，我将产生一个 groovy 进程，并`waitForOrKill()`成功杀死它。

# c# - 对接口进行编程 - 将它们用于安全类？

> ID：473725
> 
> 赞同：3
> 
> 时间：2009-01-23T17:11:20.923
> 
> 标签：c#, asp.net, interface

好的，我已经阅读了 Stack Overflow 问题[“对接口编程是什么意思”](https://stackoverflow.com/questions/383947/what-does-it-mean-to-program-to-an-interface)并理解了它。我了解使用接口的好处（至少我认为我这样做）。但是，我在将它应用到我目前正在处理的工作中遇到了一点问题，这将是我的第一个接口实现。

我正在创建一个类来对我的站点的用户进行身份验证。我已经使用静态方法编写了它，所以我可以执行 User.Authenticate(username, password)。对我来说，这很好也很容易。展望未来，将有 3 种其他类型的成员可以进行身份​​验证。他们的身份验证方法将指向不同的表等。但是，他们仍然需要进行身份验证、更改密码、更改密码以验证他们的安全问题等。这似乎是一个接口的完美用途，但我有问题围绕着如何准确地做到这一点。

用户的类型是用户、医生、经纪人、雇主。对我来说，每个类都应该实现一个定义上述方法的安全接口。

任何人都可以阐明如何做到这一点，如果我的想法是正确的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T17:20:37.630

您可能想看看[ASP.NET/Microsoft Membership](http://msdn.microsoft.com/en-us/library/tw292whz.aspx)。根据您的描述，听起来您的用户具有不同的角色（医生、经纪人等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T17:17:12.177

“对接口编程”意味着设计一组方法和属性，它们是类将提供的功能或服务的公共“签名”。

您将其声明为接口，然后在实现该接口的类中实现它。

然后要替换该类，可以使用任何其他实现该接口的类。

接口变成了合约。

但是，这不适用于静态方法。

我不确定您的`User.Authenticate(username, password)`服务目的是什么 - 它是否返回一个值来指示用户已通过身份验证？什么是未经身份验证的用户对象？

您可能有某种中央身份验证控制器来对用户进行身份验证，然后根据用户返回不同类别的对象。每个类都将实现（或者可能从用户类继承）通用功能的用户界面，然后扩展它们的特定功能。

我不太确定这个例子是继承还是接口实现的好案例，它真的取决于我们没有的更多设计细节。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T17:20:48.657

在我看来，用户类不应该封装安全功能。安全框架或子系统应验证各种类型的用户。话虽如此，您可能希望子系统接受将被验证的用户对象。如果是这样的话，那么让每个用户类实现一个 ILogon 或一些类似的接口，至少作为一个“标记”接口，将允许您的框架在设计时限制参与者类。

不过一般来说，除非它只是一个标记接口，否则我不会实现一个其实现本身违反支持继承和多态的体系结构的本质的接口。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T17:21:30.060

如果您有三个不同的用户对象，它们用于使用相同的方法和属性对用户进行身份验证，那么这将是一个很好的地方，可以添加它们并与它们中的每一个进行交互，并通过它们对其余的交互进行编码。

Cade 关于无法将接口应用于静态方法是正确的。主要原因是接口应用于实例化对象，静态方法不是该对象的一部分。

```
//Defined Classes
class UserType1 : SecurityInterface
class UserType2 : SecurityInterface
class UserType3 : SecurityInterface

//Use classes
SecurityInterface authentication = GetCorrectUserTypeObject(); //the methds gets the correct UserType object base on who is supposed to authenticate.

authentication.DoAuthenticate(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T17:23:29.277

我会从数据库的角度重新考虑您的设计。在我看来，从身份验证的角度来看，所有这些类型的个人几乎都是相同的，只是他们在系统中可能具有不同的角色。我建议处理此问题的更好方法可能是为每种用户设置用户和角色，而不是使用不同的表。然后，您将身份验证和授权功能拆分为不同的类，但您只需要一个类进行身份验证。唯一需要第二个身份验证类的情况是，如果您的用户针对不同的身份验证存储（例如 SQL 或 AD，而不仅仅是 SQL）进行了身份验证。

我知道这个答案没有解决你的接口问题，所以我会补充一点，我建议你定义一个身份验证接口（或使用 MembershipProvider），然后构造一个实现该接口的类。如果您选择这样做，它将更容易以这种方式进行测试/模拟，并为将来扩展到其他身份验证存储提供必要的基础。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T17:21:22.260

安全性对我来说是一个跨领域的关注点，这意味着面向方面的编程。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T17:25:52.923

您提到的所有用户类型都是用户。我曾在许多网站上工作过，这些网站采用了一种简短的站点方法，在这种方法中，他们将编写该网站的第一种用户视为“用户”，然后后来添加的任何其他类型的用户都被笨拙地添加了。

我的建议：不要称您的一种用户类型为“用户”。他们都是不同类型或角色的用户。

# msmq - 使用 Windows 服务侦听器读取私有队列

> ID：473752
> 
> 赞同：0
> 
> 时间：2009-01-23T17:20:51.387
> 
> 标签：msmq

我正在尝试使用服务从本地系统中的私有队列中读取队列消息。我创建了读取队列并将状态更新到访问数据库的服务。我已经设置了服务，并且服务已启动并正在运行。我不知道如何在 asp.net 应用程序中使用该服务来读取队列。我应该创建一个 DLL 并引用它，它应该没问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T17:44:54.710

我会尝试使该服务也充当某种服务器（WCF）来侦听请求（以及处理私有队列）。然后你的 asp.net 可以连接到它并从它请求它需要的任何信息。

然后，此服务可能是您进入队列的唯一入口点，您编写的任何其他应用程序都可以通过它来访问队列。

# ios - NS前缀是什么意思？

> ID：473758
> 
> 赞同：628
> 
> 时间：2009-01-23T17:22:44.037
> 
> 标签：ios, objective-c, cocoa, cocoa-touch, terminology

Cocoa/Cocoa Touch 中的许多类都有 NS 前缀。这是什么意思？

* * *

## 回答 #1

> 赞同：809
> 
> 时间：2009-01-23T17:52:17.627

Cocoa 框架的原始代码来自[NeXTSTEP](https://en.wikipedia.org/wiki/NeXTSTEP)库 Foundation 和 AppKit（Apple 的 Cocoa 框架仍然使用这些名称），NextStep 工程师选择在其符号前加上 NS。

由于 Objective-C 是 C 的扩展，因此没有 C++ 中的命名空间，因此符号必须以唯一的前缀作为前缀，这样它们就不会发生冲突。这对于在框架中定义的符号尤为重要。

如果您正在编写一个应用程序，这样您的代码可能只会使用您的符号，您不必担心这一点。但是，如果您正在编写供他人使用的框架或库，您还应该为您的符号添加一个唯一前缀。[CocoaDev 有一个页面](http://cocoadev.github.io/ChooseYourOwnPrefix/)，许多 Cocoa 社区的开发人员在该页面上列出了他们“选择的”前缀。您可能还会发现[此 SO 讨论](https://stackoverflow.com/questions/178434/what-is-the-best-way-to-solve-an-objective-c-namepsace-collision#244532)很有帮助。

* * *

## 回答 #2

> 赞同：491
> 
> 时间：2009-01-23T17:24:11.960

它来自[NeXTSTEP](https://en.wikipedia.org/wiki/NeXTSTEP)遗产。

* * *

## 回答 #3

> 赞同：155
> 
> 时间：2009-01-23T18:03:54.157

**N** eXT **S** TEP 或**N** eXTSTEP/ **S**取决于您询问的对象。

一段时间以来，Sun 对 OpenStep 进行了相当大的投资。在 Sun 进入图片之前，基金会中的大多数东西，即使它当时不被称为基础，前缀*NX*，代表**N** e **X** T，并且在 Sun 进入图片之前的某个时候，所有东西都被重命名为*NS*。*S*很可能当时并不代表 Sun，但在 Sun 介入之后，普遍的共识是它代表 Sun 以纪念他们的参与。

我实际上对此有参考，但我现在找不到。如果/当我再次找到它时，我会更新帖子。

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2009-01-23T18:01:30.400

它是 NextStep (= NS) 的遗产。NeXT 是史蒂夫乔布斯在 1985 年离开苹果后成立的计算机公司，NextStep 是它的操作系统（基于 UNIX）以及 Obj-C 语言和运行时。连同它的库和工具，NextStep 后来更名为 OpenStep（这也是 NeXT 与 Sun 共同开发的 API 上的名称），后来又成为 Cocoa。

这些不同的名称实际上非常令人困惑（特别是因为某些名称仅在字符大写或小写方面有所不同..），请尝试以下解释：

[The Merger Openstep Confusion](http://www.objectfarm.org/Activities/Publications/TheMerger/OpenstepConfusion.html)

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2013-03-19T04:53:08.240

来自 Apple 的开发者文档：

> 历史注释：如果你想知道为什么你遇到的这么多类都有一个 NS 前缀，那是因为 Cocoa 和 Cocoa Touch 的过去历史。Cocoa 最初是作为用于为 NeXTStep 操作系统构建应用程序的收集框架而诞生的。当 Apple 在 1996 年收购 NeXT 时，NeXTStep 的大部分内容都并入了 OS X，包括现有的类名。Cocoa Touch 是作为 Cocoa 的 iOS 版本引入的；一些类在 Cocoa 和 Cocoa Touch 中都可用，尽管每个平台也有大量独特的类。NS 和 UI（用于 iOS 上的用户界面元素）之类的两个字母前缀保留供 Apple 使用。

资料来源：[使用 Objective-C 编程](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/DefiningClasses/DefiningClasses.html#//apple_ref/doc/uid/TP40011210-CH3-SW1)

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2017-01-08T12:27:45.693

基本上**NS**来自Next **S** **TEP**，这是苹果收购 Next 时成为 Mac OS X 的原始操作系统。

 **我想解释点别的，这就是为什么需要它。

在 C++ 中有命名空间，几乎任何东西都在**std**

这就是为什么你有 std::string 的原因。

使用了命名空间，因此您更难犯错误，并且您可以编写自己的类字符串而不会与系统冲突。

Objective-C 是 C 的超集，但它不包括命名空间，出于同样的原因，所有系统类都以 NS 或其他一些奇怪的前缀作为前缀。

这与所有 DirectX 类如何以**D3D**为前缀以及所有 OpenGL 类如何以**gl**为前缀是相同的。

这意味着您不应该使用**NS**来命名您自己的类，当您在 Core Animation 中看到**NS**、**CA或在 Core Graphics 中看到****CG**时，您就会明白这是对系统框架的调用。

Swift 改变了这个约定，因为 Swift 支持命名空间，并且它将其核心类型（如 String）映射到 NS 等价物。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2011-10-27T18:08:52.743

来自[Cocoa_(API) 维基百科](http://en.wikipedia.org/wiki/Cocoa_(API))：

（重点补充）

> **Cocoa 类以首字母缩略词“NS”**开头（代表 OpenStep 的 **NeXT-Sun 创建**，或代表 OpenStep 框架的原始专有术语**NeXTSTEP**）：NSString、NSArray 等。
> 
> *Foundation Kit*，或更常见的简称*Foundation*，最早出现在 *OpenStep*中。在 Mac OS X 上，它基于 Core Foundation。Foundation 是一个通用的面向对象库，提供字符串和值操作、容器和迭代、分布式计算、运行循环和其他不直接绑定到图形用户界面的功能。**用于框架中所有类和常量的“NS”前缀**来自**Cocoa 的 OPENSTEP 遗产，由*NeXT*和*Sun***共同开发。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2009-01-24T02:32:46.093

当 NeXT 定义 NextStep API（相对于 NEXTSTEP 操作系统）时，他们使用前缀 NX，就像在 NXConstantString 中一样。当他们用 Sun 编写 OpenStep 规范时（不要与 OPENSTEP 操作系统混淆），他们使用 NS 前缀，就像在 NSObject 中一样。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-09-05T04:04:35.177

Bill Bumgarner [aka @bbum，谁应该知道](https://stackoverflow.com/users/25646/bbum)，于 2005 年发布在[CocoaBuilder 邮件列表中](http://www.cocoabuilder.com/archive/cocoa/136618-what-does-ns-means.html)：

> 在 NS 前缀发挥作用之后，Sun 进入了画面。在从 NeXTSTEP 3.0 迁移到 NeXTSTEP 4.0（也称为 OpenStep）期间，NS 前缀出现在公共 API 中。在 4.0 之前，少数符号使用 NX 前缀，但系统库提供的大多数类根本没有前缀——List、Hashtable、View 等...

似乎每个人都同意前缀 NX（用于 NeXT）一直使用到 1993/1994 年，[Apple 的文档说](https://developer.apple.com/legacy/library/documentation/Cocoa/Conceptual/CocoaFundamentals/WhatIsCocoa/WhatIsCocoa.html#//apple_ref/doc/uid/TP40002974-CH3-SW12)：

> 1994 年 9 月发布的官方 OpenStep API 是第一个在 Foundation 和 Application Kit 之间拆分 API 并且第一个使用“NS”前缀的 API。

# .net - 用于诊断 .NET（ASP.NET 应用程序）中的内存泄漏的工具

> ID：473760
> 
> 赞同：9
> 
> 时间：2009-01-23T17:23:14.160
> 
> 标签：.net, asp.net, memory-leaks

我们需要一个工具来轻松检测 ASP.NET 应用程序中的内存泄漏。我们有一个应用程序，它消耗大量内存。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T17:32:43.453

使用[WinDbg](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)不像使用 dotTrace 那样简单，但它可以帮助您发现应用程序中的许多奇怪之处。除此之外，您可以在 Tess Ferrandez 的[博客](http://blogs.msdn.com/tess/)上找到有关调试 ASP.Net 应用程序的宝贵信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T17:33:08.273

Rob Mariani 写了一篇关于[追踪托管内存泄漏](https://docs.microsoft.com/en-us/archive/blogs/ricom/tracking-down-managed-memory-leaks-how-to-find-a-gc-leak)的好文章，它帮助我追踪了桌面应用程序中的悬空引用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-03T01:22:37.227

我[在 MSDN 上发表了一篇关于该主题的新文章](http://msdn.microsoft.com/en-us/library/ee658248.aspx)。它包含一个工具列表。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T17:25:50.690

好吧，“轻松”是诀窍......但是[dotTRACE](http://www.jetbrains.com/profiler/)可能值得一看。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T17:33:53.797

查看 Microsoft 的[FxCop](http://www.microsoft.com/downloads/details.aspx?familyid=9AEAA970-F281-4FB0-ABA1-D59D7ED09772&displaylang=en)，它还分析性能问题等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T17:34:10.550

[.Net 内存分析器](http://memprofiler.com/)。试用版用过一次。这很有帮助，但我不需要它的频率足以保证购买一个。

我发现要始终确保您处理任何资源，特别是在 DirectoryServices 中，实现 IDisposable。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T17:51:26.320

我阅读了有关[Ants Profiler](http://www.red-gate.com/products/ants_profiler/index.htm)的信息。祝你好运。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-30T06:46:55.643

阅读 Tess，[如果它坏了，你应该修复它](http://blogs.msdn.com/tess/)。它应该让你走上正确的道路。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-03-24T16:23:31.550

我发现这个也很有用：http: [//www.codeproject.com/Articles/19490/Memory-Leak-Detection-in-NET](http://www.codeproject.com/Articles/19490/Memory-Leak-Detection-in-NET)

有趣点总结：

1.  使用 Perfmon 监视当前逻辑线程的 .Net CLR Locks/# 以查看您是否正在创建线程但没有销毁它们。
2.  使用 Perfmon 比较 .Net CLR/# Bytes 与 Process/Private 字节，以查看泄漏的是托管内存还是非托管内存
3.  假设它的托管内存正在泄漏，使用 windbg/sos.dll 跟踪引用

# c# - C#中的内联函数？

> ID：473782
> 
> 赞同：292
> 
> 时间：2009-01-23T17:31:07.343
> 
> 标签：c#, optimization, inline

你如何在 C# 中执行“内联函数”？我不认为我理解这个概念。他们喜欢匿名方法吗？像 lambda 函数？

**注意**：答案几乎完全涉及[内联函数](http://en.wikipedia.org/wiki/Inline_expansion)的能力，即“用被调用者的主体替换函数调用站点的手动或编译器优化”。如果您对[匿名（又名 lambda）函数](http://en.wikipedia.org/wiki/Anonymous_function)感兴趣，请参阅[@jalf 的回答](https://stackoverflow.com/a/473813/116891)或[每个人都在谈论的这个“Lambda”是什么？](https://stackoverflow.com/questions/1085875/what-is-this-lambda-everyone-keeps-speaking-of/1086347#1086347).

* * *

## 回答 #1

> 赞同：417
> 
> 时间：2012-01-05T16:38:01.093

最后在 .NET 4.5 中，CLR 允许使用值来提示/建议¹方法内联。[`MethodImplOptions.AggressiveInlining`](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.methodimploptions%28v=VS.110%29.aspx)它也可以在 Mono 的后备箱中使用（今天提交）。

```
// The full attribute usage is in mscorlib.dll,
// so should not need to include extra references
using System.Runtime.CompilerServices; 

...

[MethodImpl(MethodImplOptions.AggressiveInlining)]
void MyMethod(...) 
```

**1**. Previously "force" was used here. I'll try to clarify the term. As in the comments and the documentation, `The method should be inlined if possible.` Especially considering Mono (which is open), there are some mono-specific technical limitations considering inlining or more general one (like virtual functions). Overall, yes, this is a hint to compiler, but I guess that is what was asked for.

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2009-01-23T17:33:06.527

内联方法只是一种编译器优化，其中函数的代码被滚动到调用者中。

在 C# 中没有执行此操作的机制，并且它们将在支持它们的语言中谨慎使用——如果您不知道为什么应该在某处使用它们，那么它们不应该使用。

编辑：为了澄清，需要谨慎使用它们有两个主要原因：

1.  在不需要的情况下使用内联很容易制作大量二进制文件
2.  从性能的角度来看，当某些东西应该被内联时，编译器往往比你更清楚

最好不要管它，让编译器完成它的工作，然后分析并确定 inline 是否是最适合您的解决方案。当然，有些事情只是内联才有意义（尤其是数学运算符），但让编译器处理它通常是最佳实践。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2010-01-16T22:48:59.897

**更新：**根据[konrad.kruczynski 的回答](https://stackoverflow.com/a/8746128/150605)，以下适用于 .NET 4.0 及以下版本。

您可以使用[MethodImplAttribute 类](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.methodimplattribute.aspx)来*防止*方法被内联...

```
[MethodImpl(MethodImplOptions.NoInlining)]
void SomeMethod()
{
    // ...
} 
```

...但是没有办法做相反的事情并*强制*它被内联。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2009-01-23T17:40:05.187

你混淆了两个不同的概念。函数内联是一种编译器优化，对语义没有影响。无论函数是否内联，函数的行为都是相同的。

另一方面，lambda 函数纯粹是一个语义概念。对如何实现或执行它们没有要求，只要它们遵循语言规范中规定的行为即可。如果 JIT 编译器喜欢，它们可以被内联，如果不喜欢，它们可以被内联。

C# 中没有 inline 关键字，因为它是一种通常可以留给编译器的优化，尤其是在 JIT ed 语言中。JIT 编译器可以访问运行时统计信息，这使其能够比编写代码时更有效地决定内联的内容。如果编译器决定内联一个函数，那么无论哪种方式你都无能为力。:)

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-01-23T17:38:58.543

Cody 说得对，但我想提供一个什么是内联函数的示例。

假设您有以下代码：

```
private void OutputItem(string x)
{
    Console.WriteLine(x);

    //maybe encapsulate additional logic to decide 
    // whether to also write the message to Trace or a log file
}

public IList<string> BuildListAndOutput(IEnumerable<string> x)
{  // let's pretend IEnumerable<T>.ToList() doesn't exist for the moment
    IList<string> result = new List<string>();

    foreach(string y in x)
    {
        result.Add(y);
        OutputItem(y);
    }
    return result;
} 
```

~~编译器~~即时优化器可以选择更改代码以避免在堆栈上重复调用 OutputItem()，这样就好像您已经编写了这样的代码：

```
public IList<string> BuildListAndOutput(IEnumerable<string> x)
{
    IList<string> result = new List<string>();

    foreach(string y in x)
    {
        result.Add(y);

        // full OutputItem() implementation is placed here
        Console.WriteLine(y);   
    }

    return result;
} 
```

在这种情况下，我们会说 OutputItem() 函数是内联的。请注意，即使从其他地方也调用了 OutputItem()，它也可能会这样做。

*编辑以显示更可能被内联的场景。*

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2009-01-23T17:38:36.813

您是指 C++ 意义上的内联函数吗？其中一个普通函数的内容会自动内联复制到调用站点中？最终效果是调用函数时实际上没有发生函数调用。

例子：

```
inline int Add(int left, int right) { return left + right; } 
```

如果是这样，那么没有，没有与此等效的 C#。

或者你的意思是在另一个函数中声明的函数？如果是这样，那么是的，C# 通过匿名方法或 lambda 表达式支持这一点。

例子：

```
static void Example() {
  Func<int,int,int> add = (x,y) => x + y;
  var result = add(4,6);  // 10
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-23T17:38:52.397

是的，唯一的区别是它返回一个值。

简化（不使用表达式）：

`List<T>.ForEach`采取行动，它不期望返回结果。

所以一个`Action<T>`代表就足够了..说：

```
List<T>.ForEach(param => Console.WriteLine(param)); 
```

和说的一样：

```
List<T>.ForEach(delegate(T param) { Console.WriteLine(param); }); 
```

不同之处在于参数类型和委托声明是通过使用来推断的，而简单的内联方法不需要大括号。

然而

`List<T>.Where`接受一个函数，期待一个结果。

因此，`Function<T, bool>`可以预期：

```
List<T>.Where(param => param.Value == SomeExpectedComparison); 
```

这与以下内容相同：

```
List<T>.Where(delegate(T param) { return param.Value == SomeExpectedComparison; }); 
```

您还可以内联声明这些方法并将它们分配给变量 IE：

```
Action myAction = () => Console.WriteLine("I'm doing something Nifty!");

myAction(); 
```

或者

```
Function<object, string> myFunction = theObject => theObject.ToString();

string myString = myFunction(someObject); 
```

我希望这有帮助。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-06-29T20:04:56.580

在某些情况下，我确实希望强制内联代码。

例如，如果我有一个复杂的例程，其中在一个高度迭代的块中做出大量决策，并且这些决策导致要执行的操作相似但略有不同。例如，考虑一个复杂的（非 DB 驱动的）排序比较器，其中排序算法根据许多不同的不相关标准对元素进行排序，例如，如果它们根据快速语言的语法和语义标准对单词进行排序，则可能会这样做识别系统。我倾向于编写辅助函数来处理这些操作，以保持源代码的可读性和模块化。

我知道这些辅助函数应该是内联的，因为如果代码永远不需要被人类理解，那就是编写代码的方式。我当然想确保在这种情况下没有函数调用开销。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-03-04T22:21:07.293

声明“最好不要管这些事情，让编译器完成工作......”（Cody Brocious）完全是垃圾。我已经编写高性能游戏代码 20 年了，但我还没有遇到过一个“足够聪明”的编译器来知道哪些代码应该被内联（函数）。在 c# 中使用“内联”语句会很有用，事实是编译器只是没有确定哪个函数应该始终内联或在没有“内联”提示的情况下不应该内联的所有信息。当然如果函数很小（访问器）那么它可能会自动内联，但是如果它是几行代码呢？废话，编译器无法知道，你不能把它留给编译器来优化代码（超出算法）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-12-22T12:45:43.627

I know this question is about C#. However, you can write inline functions in .NET with F#. see: [Use of `inline` in F#](https://stackoverflow.com/questions/3754862/use-of-inline-in-f)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T17:43:14.667

不，C# 中没有这样的构造，但 .NET JIT 编译器可以决定在 JIT 时间执行内联函数调用。但我其实不知道它是否真的在做这样的优化。
（我认为应该:-)）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-11-22T19:42:07.113

如果您的程序集将被 ngen-ed，您可能需要查看 TargetedPachingOptOut。这将帮助 ngen 决定是否内联方法。[MSDN 参考](http://msdn.microsoft.com/en-us/library/system.runtime.targetedpatchingoptoutattribute.aspx)

不过，它仍然只是一个优化的声明性提示，而不是命令式命令。

* * *

## 回答 #13

> 赞同：-7
> 
> 时间：2009-01-23T17:37:22.307

Lambda 表达式是内联函数！我认为，C# 没有像 inline 或类似的额外属性！

* * *

## 回答 #14

> 赞同：-8
> 
> 时间：2009-01-23T17:44:33.477

C# 不支持像 python 这样的动态语言那样的内联方法（或函数）。但是，匿名方法和 lambda 可以用于类似的目的，包括当您需要访问包含方法中的变量时，如下例所示。

```
static void Main(string[] args)
{
    int a = 1;

    Action inline = () => a++;
    inline();
    //here a = 2
} 
```

# c# - 在 C# 中复制 C++ 的 RAII

> ID：473790
> 
> 赞同：3
> 
> 时间：2009-01-23T17:33:33.860
> 
> 标签：c#, logging, raii

我正在滚动我自己的记录器类，并希望在应用程序经历不同阶段时表示日志的层次结构：

```
log start
    loading
        loaded 400 values
    processing
         couldn't process var "x" 
```

等等

在 C++ 中（是的，我知道），我会使用 RAII 类，它们在创建时将自身推入日志堆栈，并在它们离开范围时弹出。然后，您可以在任何时候离开函数，并且仍然具有一致的日志记录。

显然，在 C# 中，任何变量都必须是新的，因此在下一个垃圾回收周期之前它不会被删除，如果您立即创建一个新的 classlet，您可能会有一个不同步的记录器。

人们将如何尝试在 C# 中解决这个问题？我希望记录器语法对当前函数尽可能不显眼，并且仍然支持具有多个退出点的函数。

我能想到的唯一解决方案是 closeHeirarchy() 调用每个 return 语句 - 你知道我会在某个地方错过一个。

* * *

编辑：我应该明确表示我主要对如何在 c# 中复制 RAII 行为感兴趣。是否有提供相同行为的机制？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T18:22:15.057

[如果您将using](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)语句与 IDisposable 类一起使用，您可以获得您所询问的行为。

做这样的事情：

```
public class LogContext: IDisposable
{
  private readonly Logger _logger;
  private readonly string _context;

  public LogContext(Logger logger, string context){
    _logger = logger;
    _context = context;
    _logger.EnterContext(_context);
  }

  public void Dispose(){
    _logger.LeaveContext(_context);
  }
}

//...

public void Load(){
  using(new LogContext(logger, "Loading")){
    // perform load
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T18:08:16.300

OffTopic：如果您希望“记录器语法对客户端代码尽可能不显眼”，您可能希望在记录器完成后查看面向方面的编程。但也许您应该采取一条不那么痛苦的路线，并使用任何可用的出色记录器（log4Net、NLog、System.Trace 甚至 Spring.Commonlogging）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:00:57.110

[`System.Diagnostics.Trace`](http://msdn.microsoft.com/en-us/library/system.diagnostics.trace.aspx)值得一看。例如，它支持缩进级别。[log4net](http://logging.apache.org/log4net/)项目也值得一试。

# sql - 用于测试查询构建功能的 SQL 查询

> ID：473794
> 
> 赞同：0
> 
> 时间：2009-01-23T17:33:59.520
> 
> 标签：sql, sql-server

我正在考虑构建一个小型应用程序，以帮助其他开发人员通过问答应用程序学习高级查询概念。我需要一些 SQL 专家来列出一堆棘手的查询，并提供使用的示例表模式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T18:03:13.940

I'd give them examples of cursors and ask them how to rework them into set-based queries

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T17:43:19.923

我不久前遇到的问题是管理 Web 应用程序中的事务限制。每个客户都有一系列他们签署的交易规范，并且限制必须足够灵活，以便对特定交易类型、所有交易或交易类型的某个子集设置限制。

那么，如果某个特定的交易规范已经达到了当天的限制，您将如何在单个查询中确定呢？

表格布局看起来像这样。

```
TRANSACTION_SPECS
specid
name

CAPS
capid
dailycap

TRANSACTION_CAPS
specid
capid

TRANSACTIONS
transactionid
specid
date 
```

# architecture - 如何构建大型应用程序

> ID：473797
> 
> 赞同：31
> 
> 时间：2009-01-23T17:34:38.070
> 
> 标签：architecture, distributed

我认为我已经非常擅长编程的基础知识（适用于各种语言）。我可以写一行*好*代码。我可以写一个*很好*的方法。我可以写一堂*好*课。我可以写一组*很好*的类。我可以编写*好的*中小型应用程序。

然而，我不知道如何构建一个*好的*大型应用程序。特别是在涉及多种技术并且随着时间的推移可能会涉及更多技术的情况下。假设一个项目有一个大型 Web 前端，一个连接到其他集成后端的大型服务器后端，最后是一个庞大而复杂的数据库。哦，我已经参与了其中的一些应用程序，我确信我可以构建一个。但是，我不太确定它是否可以称为“好”。

因此，我的问题是参考一本书或其他好的阅读资源，在那里我可以学习如何为一般的大型项目分发和组织代码和数据。例如，我是想非常严格地分层，还是想将其封装成独立的单元？我是想尝试将大部分逻辑保留在同一个池中，还是应该在添加我要添加的任何功能时按照最合乎逻辑的方式进行分发？

我已经看过很多关于这些问题的一般原则（例如，没有意大利面条代码，肉丸代码......）并阅读了一些讨论这个问题的优秀文章，但我从未遇到过可以引导我获得具体**实践**知识的来源。我意识到这个问题的难度，所以我很高兴听到其他人发现有助于他们寻求此类知识的阅读材料。

一如既往，感谢您的回复。

> ****鉴于“好”代码的定义存在争议，在这种情况下，“好”这个词不会被定义（它意味着你认为它应该意味着什么）。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-23T19:47:04.993

作为程序员，我们喜欢相信自己是聪明人，所以很难承认某件事太大太复杂，甚至无法一次考虑。但对于大型软件项目来说确实如此，而且你越早承认自己的**大脑能力有限**并开始想出简化问题的方法，你就会变得更好。

要意识到的另一件主要事情是您将花费大部分时间**来更改现有代码**。构建初始代码库只是蜜月期——您需要在设计代码时牢记这样的想法，6 个月后，您将坐在它面前试图解决一些问题，却不知道这个特定模块是如何工作的，甚至虽然你自己写的。

所以，我们能做些什么？

**最小化**代码中不相关部分之间的耦合。随着时间的推移，代码会以你无法预料的方式发生变化——与不熟悉的产品集成时会出现惊人的问题、需求变化——而这些会导致变化的连锁反应。如果您已经建立了稳定的接口并对其进行了编码，则可以在实现中进行所需的任何更改，而这些更改不会影响使用该接口的代码。您需要**花费时间和精力**来开发经得起时间考验的界面——如果界面也需要更改，您就回到原点。

**建立可用于回归测试的**自动化测试。**是的，前期工作量很大。*但是，当您可以进行更改、运行测试并确定它仍然可以工作*时，它会在未来得到回报，而无需担心如果您将最新的更改提交到源代码控制，是否一切都会失败。**

 ****放下棘手的事情。** 我时不时地看到一些巧妙的 C++ 模板技巧并想，“哇！这正是我的代码所需要的！” 但事实是，代码可读性和易理解性的降低通常根本不值得增加通用性。如果你像我一样天生倾向于尝试以尽可能普遍的方式解决每个问题，那么你需要学会克制它，直到你真正遇到对通用解决方案的*需求*。如果出现这种*需要*，您可能必须重写一些代码——这没什么大不了的。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-23T17:41:46.977

借自 tvanfosson：

> 从一个小应用程序开始，每次有人想要添加新功能时说“是”。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-23T17:43:00.050

这是我们用来指导我们的编码标准和方法的一本书：

[![替代文字](https://i.stack.imgur.com/7jcuO.jpg)](https://i.stack.imgur.com/7jcuO.jpg) [大规模 C++ 软件设计](https://rads.stackoverflow.com/amzn/click/com/0201633620)

我正在开发的这个程序自从第一次在众所周知的餐巾纸上拟定以来，已经开发了将近 10 年。该项目今天仍然很强劲。它并不完美，循环依赖仍然存在问题，一些类接口不是很干净，但大多数类都不是这样，程序可以正常工作，我们的用户很满意。

正如许多其他人之前所做的那样，我还推荐Steve McConnell 的[Code Complete](https://rads.stackoverflow.com/amzn/click/com/0735619670)和[Software Estimation](https://rads.stackoverflow.com/amzn/click/com/0735605351)。我特别喜欢他关于“增长”软件而不是构建或构建的比喻。这种查看软件的方式更适合具有较长生命周期的东西。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-23T19:50:17.297

正如我在其他地方提到的，大型应用程序不仅更大，而且*不同*。如此之多，以至于我们谈到了**小型**和**大型**编程。当您进行大型编程时，问题的性质及其解决方案会发生重大的质变。这条线非常模糊，有许多具体问题会迫使你越过这条线。

其中一些问题包括：

*   大小（例如一个根本不适合单个硬盘驱动器的数据库）
*   复杂性（从多合一应用程序到多个子系统）
*   并发（从零到数千/百万同时用户）
*   可用性（从 9% 的正常运行时间到 99.999% 的正常运行时间）
*   可靠性（从日常故障到几年的 MTBF）
*   速度（从几小时到几毫秒的响应时间）
*   产品化（从您的宠物项目到可销售的商品）
*   等等

如何处理这一切？尽可能地学习和使用每一种有价值的技术，并学会评估哪些是真正有价值的——这需要一段时间，而且没有快速的答案。

但是，有一种简单、明显且一刀切的技术：分而治之。隔离每个主要功能、每个子系统、每个外部依赖项，以便您的主系统仅在其外部边缘接触它们。当你可以在很短的时间内通过简单地调整一个精简的界面来改变每一个，那么你已经完成了一些事情。这将带你走很长的路。

最良好的祝愿。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-23T17:43:19.190

1.  决定哪些特征是最重要的；忘记其余的
2.  决定其中哪些**功能**最重要，而忘记其余的
3.  实施它们（应该需要几个星期，否则重复步骤 1 和 2）
4.  发射
5.  查看哪些功能有效，哪些无效，哪些缺失
6.  返回步骤 1

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-23T17:49:54.370

大型应用程序不是一夜之间创建的。企业应用程序从小块开始，然后将它们组合在一起。如果您设计的应用程序是一种可以扩展的方式，那么与所有周边因素（如数据库、第三方工具等）集成会更容易。如果您访问[infoq.com](http://infoq.com)，您会发现很多很棒的案例有关扩展和架构的研究和材料，例如 Myspace、Amazon 和许多其他公司。除了经验之外，没有什么可以引导您开发出色的大型应用程序。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-23T18:10:55.093

渐进式地使用[测试驱动设计](http://en.wikipedia.org/wiki/Test-driven_development)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-23T17:48:37.727

使用设计模式使其可扩展，这意味着您无需更改所有内容即可插入新功能。

决定你需要什么来构建和构建它。

将其分解为分别执行任务的模块。

计划计划计划计划，在开始之前知道您正在构建什么，然后构建它而不是其他任何东西。

只写你需要的功能，不要添加你认为可能有用的东西，但是......让它足够灵活，以便能够添加你可能需要添加的东西。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-23T20:42:54.397

注意到有多少评论说盲迭代是唯一的方法，这真的很有趣。

迭代很关键（我是一个超级粉丝），但也有人可以计划出大型项目——只是我们中很少有人遇到过这样的项目。

把它想象成我们所有人都在我们的车道上打篮球。我们很好，我们可以得到大多数篮子，实际上在公园里玩得很开心。

然而，仅仅因为我们从未见过职业球员，并不意味着他们不存在，也不能整天在球场上踢我们的每一个屁股。

唯一的问题是没有专业的编程游戏——如果有的话，我们可能会多看到一些。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-23T17:49:25.060

好吧，你可以看看理性统一的过程。检查基本部分，选择一些您认为需要的工件。列出您需要的所有功能并将它们组织在需求列表中。还要仔细规划您的软件架构，这样您以后就不必更改它。使用其中的一些技巧，开发大型应用程序会相对容易一些。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T23:44:25.233

作为负责大型应用程序的人，我会说

*   使用非侵入性框架，例如 Spring
*   减少耦合
*   尽可能创建不可变对象——它们是线程友好的
*   接受您的应用程序可能需要拆分为单独的进程以更好地扩展并为此进行计划。
*   构建一个可靠的工具集并学习这些工具。

**不要恐慌**

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-01-26T11:41:48.270

关于产品和供应商锁定的一些想法：

*   尝试尽可能独立于供应商和平台。这将防止您必须使用新产品/平台/框架等从头开始重新实现所有内容。
*   这实际上意味着使用 Java SE + Java EE + 和开源 RDBMS，如由 Java EE 的 JPA 封装的 PostgreSQL。不要使用额外的库、框架（spring、hibernate、...）等。这样您可以随时切换产品和供应商。
*   我认为您只能使用 Java 获得这种级别的产品和平台独立性。即使你使用了 OSS 库和框架，如果你发现实现不适合你的需求，你必须重做所有事情，你会后悔使用它们。
*   您可以使用[Java Application Verification Kit](http://java.sun.com/j2ee/avk/)检查代码的产品独立性。
*   事先花一些时间在架构上，但也要在整个实施过程中重新设计架构。一本好书（不幸的是只有德语）是 Adam Bien 的“Java EE 5 Architekturen”。

@j_random_hacker：实际上，不——我仍然认为我的第一点是在大型应用程序中使用 java 的论点，而不是反对它。每种语言都是一种语言。因此，当然，您总是必须对一门语言做出承诺。

*   但是 Java SE & EE 包括语言、编译器、虚拟机以及所有必要的库/框架。但是整个 Java SE/EE 平台有不同的实现：来自 Sun、Apache、IBM、HP、Oracle、BEA 的 Java SE (JDK)。Sun、Apache、Red Hat、IBM、Oracle 和其他公司的 Java EE（应用服务器）。带有 C# 的 .Net 只有一个实现（来自 Microsoft 和一个称为 Mono 的有点相似的语言/平台的实现）。
*   我认为 PHP 也只有一种实现。有很多不同的 C++ 编译器。但是它们都实现了稍微不同的 C++ 语言，并且它们没有与共享相同 API 的库捆绑在一起。选择 Java，我知道我可以在六种 Java SE 实现和六种 Java EE 应用服务器之间进行选择来运行该软件，而这些软件又可以在 Linux、Solaris、FreeBSD、HP-UX、IBM z/OS、Windows 上运行, Mac OS X 和各种各样的硬件平台。所以我不必担心，如果我在开发后期甚至生产中发现一个非常糟糕的实施问题 - 我会离开 Sun 并且永远不会回头。（这就是我推荐 Java Application Verification Kit 的原因。通过检查您的源代码，您可以确定 Sun、IBM、甲骨文或任何其他邪恶公司并没有将他们的任何专有东西作为依赖项偷偷带入您的源代码中，这可能会将您绑定到该公司。你像鸟一样自由。）
*   你不能用 PHP 或 Ruby 做到这一点。使用这些语言，如果没有其他人这样做，您将不得不自己修补实现问题，因为在 PHP 或 Ruby 中花费数月的错误修补时间仍然比重写完整的应用程序要少。
*   Sun 已开源：Java SE（完整的 JDK）和 Java EE（Glassfish 应用服务器）。唯一不是“开源”的就是有一个绑定语言规范，由 sun 主导，并得到其他人的大量贡献。这就是为什么您可以从 sun 获取 Java 实现、修改 Java 语言并重新分发该源代码和二进制文件，但如果这不符合语言规范（Sun 保护 Java 商标仅实际应用于事物java)。起初这可能听起来“邪恶”，但它实际上确保存在“Java”之类的东西：您可以编写一个 java 应用程序并在任何 java 实现上运行它。
*   如果您无法忍受任何 Sun 微系统，但想要一个开源 Java，那么您可以只使用[Apache Harmony](http://harmony.apache.org/) (Java SE) 和[Apache Geronimo](http://geronimo.apache.org/) (Java EE)。

# ruby-on-rails - Netflix API、OAuth 和 Ruby 问题

> ID：473801
> 
> 赞同：4
> 
> 时间：2009-01-23T17:37:14.693
> 
> 标签：ruby-on-rails, ruby, api, netflix

我正在尝试将 oauth 与稀有分支 Ruby gem 一起使用。我不断收到错误：

OAuth::Consumer 的实例需要有方法“marshal_load”

我的代码 activate.rb 如下。关于如何解决这个问题的任何想法？谢谢！-亨利

```
require 'oauth/consumer'

def index
  @consumer = OAuth::Consumer.new("CONSUMER KEY","CONSUMER SECRET", {
     :site => "http://api.netflix.com",
     :request_token_url => "https://api-user.netflix.com/oauth/request_token",
     :access_token_url => "http://api.netflix.com/oauth/access_token",
     :authorize_url => "https://api-user.netflix.com/oauth/login",
     :application_name => "AppName"})

  @request_token = @consumer.get_request_token

  session[:request_token]=@request_token
  session[:request_token_secret]=@request_token.secret

  @authorize_url = @request_token.authorize_url({
     :oauth_consumer_key => "CONSUMER KEY"
     :application_name => "AppName",
     :oauth_callback => "http://localhost:3000/activate/callback"
   })

  redirect_to @authorize_url
end

def callback
  @request_token=OAuth::RequestToken.new(session[:request_token],
  session[:request_token_secret])
  @access_token = @request_token.get_access_token

end 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-23T19:57:19.513

令牌不可序列化，因此您不能将其存储在会话中。相反，将令牌密钥和秘密单独存储在会话中，并在您再次需要时使用密钥和秘密创建一个新的 OAuthToken。

您可能需要清除会话存储以摆脱已放入其中的令牌。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-24T16:21:55.110

You need to have the user physically authorize it on the Netflix site. In this case, probably you. As I understand it, you can cache the token once you've gotten it from the manual authorization.

I was having similar problems with the Yammer API and never really got it sorted out. You may want to check out the [Yammer API, Stammer, Ben Scofield did in Ruby](http://github.com/bscofield/stammer/tree/master) that does handle the OAuth magic

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-09T00:59:51.647

我不知道这是否是最好的解决方案，但这就是我解决它的方法：

我在 environment.rb 中添加了以下代码：

```
class OAuth::Consumer
     def marshal_load(*args)
      self
    end 
```

更多的 hack，这肯定会修复 marshal 加载错误。我不知道这是否会导致其他问题。

# security - 简单的后门

> ID：473806
> 
> 赞同：1
> 
> 时间：2009-01-23T17:38:32.820
> 
> 标签：security, language-agnostic, testing

我想知道您过去在应用程序开发过程中使用了哪些后门技术进行测试。哪些是最简单、侵入性最小且最容易在释放前去除的方法？

到目前为止，我提出了两种主要方法：

1) 主动 - 即开发人员将通过特制命令行或在执行期间输入向程序发送某种类型的命令

2) 被动 - 即注册表项或 ini 文件。

一般来说，我认为这个问题没有正确或错误的答案（除非它包括为发布保留后门），但我很想听听其他人多年来采取的方法。:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T17:48:34.217

鉴于更快的开发周期和“糟糕”因素，我几乎放弃了我的应用程序中的后门方法——然而，我加强了我的单元测试并创建了一个“存根”应用程序来测试特定的部分我目前专注于应用程序，而不必费力地通过“真正的”应用程序——（存根是一次性的）我不是创建自己的安全漏洞的大支持者——认为那里有很多人只是等待那份工作...... :)

只是我的2美分...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T17:42:53.793

我相信，如果你的应用程序设计得当，你应该不需要通过“后门”来测试它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T17:43:10.250

我通过输入他们的用户名作为我的密码来设置一个冒充另一个用户。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T18:12:54.107

Although I would not make back doors, I typically keep some kind of functionality that lets me trace data used for processing that may not be obviously visible in the application. Typically a URL parameter or such for web-apps.

This can be really nice when working with complex data that may be hidden in far-off systems. We usually dump it into the html as a comment when the correct parameter has been supplied.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T17:50:29.283

您可以在某些按钮或帮助关于菜单项下隐藏特殊偏好屏幕，这些菜单项仅在您按住 Ctrl-Shift 然后单击时才起作用。

谈到别人说的话——我总是在我的程序中加入一个模拟层。当用户呼叫您时，它将帮助您调试问题（您可以准确地看到他们看到的内容）。

# audio - 使用 J2ME 播放音频

> ID：473809
> 
> 赞同：5
> 
> 时间：2009-01-23T17:38:45.970
> 
> 标签：audio, java-me, media-player, mmapi

使用 J2ME 媒体库播放音频的最佳方式是什么？例如，我应该使用 MMAPI 还是应该只使用 Midlet 的 platformRequest(String s) 方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T14:27:59.730

以下代码应该适用于支持 JSR-135 的 90-95% 的手机。所有各种方法调用的顺序是可移植的关键。这适用于 JAR 本地的声音。任何流式音频将完全是另一个问题:)

```
// loads the InputStream for the sound
InputStream inputStream = this.getClass().getResourceAsStream( musicFile );

// create the standard Player
musicPlayer = Manager.createPlayer( inputStream, musicEncoding );
musicPlayer.prefetch();

// add player listener to access sound events
musicPlayer.addPlayerListener( this );

if( loopMusic )
{    
    // use the loop count method for infinite looping
    musicPlayer.setLoopCount( -1 );
}

// The set occurs twice to prevent sound spikes at the very 
// beginning of the sound.
VolumeControl volumeControl = 
   (VolumeControl) musicPlayer.getControl( "VolumeControl" );
volumeControl.setLevel( curVolume );

// finally start the piece of music
musicPlayer.start();

// set the volume once more
volumeControl = (VolumeControl) musicPlayer.getControl( "VolumeControl" );
volumeControl.setLevel( curVolume );

// finally, delete the input stream to save on resources
inputStream.close();
inputStream = null; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T14:03:24.787

*最好*的，你是什么意思？最好的质量？最佳用户体验？最符合标准？

基本上（这不是我所知道的最好的答案），它取决于平台——这是 J2ME 熟悉的主题——因为实现可以有很大差异，并且 MMAPI 通常利用一些本机媒体播放器软件/硬件。在 BlackBerry 上，MMAPI 运行良好，但有一些怪癖。

我的建议是在 MMAPI 运行良好的地方使用它——它将为您提供最便携的应用程序。试验或浏览您的特定目标设备集的开发板，以查看它在您想要支持的手机上的运行情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T14:34:14.223

在某些设备上，使用平台请求会导致您的应用程序关闭，而在其他设备上，某些平台请求会导致设备崩溃（某些设备上的 HTTP URL 除外）。

因此，您可能需要同时使用这两种方法，根据设备测试选择使用哪一种。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-27T01:23:14.353

正如上面 Shane 的回复中所解释的，本地音频（在 Jar 文件中）更容易支持。对于网络上的内容，随着服务器连接问题、手机内存等许多因素的影响，它变得更加困难。如果您需要支持大量手机，那么建议您使用 2-3 种实现技术并相应地使用。

# smtp - SMTP：错误 554，邮件不符合 RFC

> ID：473812
> 
> 赞同：-1
> 
> 时间：2009-01-23T17:39:53.487
> 
> 标签：smtp

我们的自定义自动电子邮件递送服务正在使用我们的几个客户的 SMTP 服务器解决这个问题。它只发生在其中大约三个上——邮件被 SMTP 服务器的以下响应退回：

```
SMTP error from remote mail server after end of data:
host clients.host.name [XXX.XXX.XXX.XXX]: 554 Message is not RFC compliant 
```

这是我们的自定义应用程序生成的电子邮件标头。请注意，我们自己的电子邮件通过没有任何问题，但我们的应用程序没有。

```
Return-path: <ouremail@our.domain>
Received: from [XXX.XXX.XXX.XXX] (helo=our.stmp.server)
by clients.smtp.server with smtp (Exim 4.69)
(envelope-from <ouremail@our.domain>)
id 1LQNiv-0008MM-IM
for clientsaddress@clients.domain; Fri, 23 Jan 2009 13:13:33 -0200
Subject: Test Mail
From: <ouremail@our.domain>
To: <clientsaddress@clients.domain>
MIME-Version: 1.0
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: ourCompany (ourcompanys.web.site)
Importance: Normal
Content-Type: multipart/mixed;
boundary="OURCOMPANYSsoftsmtp123X4560102897C"
X-Scan-Signature: e932e7231c8991cb29810b36327eaa17

--OURCOMPANYSsoftstmp123X4560102897C
Content-Type: text/plain;
charset="iso-8859-1"
Content-Transfer-Encoding: base64

BASE64ENCODING

--OURCOMPANYSsoftstmp123X4560102897C-- 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T17:48:35.187

程序生成的消息中没有`Message-ID`或`Date`标题。这可能是他们被拒绝的原因。

此外，严格来说 SMTP 要求行以 CRLF 分隔。我不知道这是否是你所拥有的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T18:37:40.967

我也没有看到 Date: 标题。

# windows - Eclipse external tools, white space in path vars

> ID：473835
> 
> 赞同：4
> 
> 时间：2009-01-23T17:46:13.850
> 
> 标签：windows, eclipse

I am setting up a external tool but when I use the argument variables like this one: ${resource_path} for resources that contain spaces in the path (e.g. C:\Program Files) it seems the arguments get passed in split on the spaces in the path.

Does anyone know how to make this work?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T18:00:51.027

Put quotes around the variable: "${resource_path}"

# windows - 帮助我让我的 windows cmd.exe 控制台更像一个 Linux 终端

> ID：473839
> 
> 赞同：31
> 
> 时间：2009-01-23T17:47:16.467
> 
> 标签：windows, linux, shell, terminal, cmd

Windows 终端（围绕文本应用程序的用户界面，如 cmd.exe）真的很烂。

Unix 风格的终端可以做的很多事情是 Windows 终端显然无法做到的，例如，如果您想通过拖动边框在两个维度上重新调整窗口大小怎么办。Windows 终端只允许您更改它的长度。

剪切和粘贴，在 Linux 或 Unix 上，没问题 - 选择框很好地环绕，因此您可以剪切多行表达式。Windows 终端（即使在快速编辑模式下）强制使用一个奇怪的矩形选择框，这没有实际用途 - 您必须重新格式化您在记事本中复制的所有内容！

每当我进入“编辑”模式时它会阻止应用程序这一事实怎么样 - 我敢肯定，有些人希望能够在不停止关键业务服务器的情况下进行剪切和粘贴。

我敢肯定，如果我们全神贯注，我们可以想到更多的错误——但我们不要抱怨..我们能做些什么来让它变得更好？

更新：澄清一下，我不想替换 cmd.exe - Powershell 和 CygWin 都提供了更好的选择。我正在尝试替换控制台应用程序，即围绕 Windows 中所有文本应用程序的 GUI。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-23T17:50:07.320

我个人将[Console2与](http://sourceforge.net/projects/console/)[MYSYS-Git](http://code.google.com/p/msysgit/)附带的 Bash 一起使用。

您还可以使用 PuTTY 和 SSH 连接到真正的 linux 机器；-)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-23T17:51:12.717

也许使用[Console 2 ？](http://sourceforge.net/projects/console/)它现在真的很稳定，并且允许您非常轻松地在 cmd/PowerShell/cygwin/任何其他 shell 之间切换。老实说，微软不太可能很快改进原生 Win32 控制台。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-23T17:49:43.887

我发现这个问题的唯一“解决方案”是安装 Cygwin/X 并改用 XTerm。我每天在工作中都使用它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-07-16T16:17:11.480

您可以独立更改两件事 - 您的终端仿真器和您的 shell。

## 使用更好的终端仿真器

这将允许您正常选择文本（而不是愚蠢的矩形）。我喜欢 Console2，它是快速、轻量级和可靠的[http://sourceforge.net/projects/console/](http://sourceforge.net/projects/console/)

还有ConEmu [https://code.google.com/p/conemu-maximus5/](https://code.google.com/p/conemu-maximus5/)。

还有 Mintty [https://code.google.com/p/mintty/](https://code.google.com/p/mintty/)（与 Putty 使用的终端模拟器相同）。Mintty 无法运行交互式应用程序，例如`nano`或`vi`。Mintty 也不能运行`cmd`，只有 Bash。

无论您选择什么，将“在此处打开控制台”项添加到 Windows 资源管理器上下文菜单都会很有用。[https://stackoverflow.com/a/17663556/284795](https://stackoverflow.com/a/17663556/284795)上的说明

## 使用更好的外壳

### 碰杯

Clink 改进了`cmd`，添加了会话历史记录和 Bash 样式的自动完成功能。 [https://code.google.com/p/clink/](https://code.google.com/p/clink/)

### 重击

最可靠的 Windows 版 Bash 发行版是 MSysGit。它很容易安装，而且你会得到一个免费的 Git [https://code.google.com/p/msysgit/](https://code.google.com/p/msysgit/)

在这一点上，有必要解释一下 MSys 和 Cygwin 之间的区别。MSys 是一系列精心移植到本机 win32 API 的应用程序，而 Cygwin 是一个可以运行任意 Linux 应用程序的仿真层。

根据我的经验，MSys 更舒服，它与 Windows 的互操作性更好（特别是它如何处理路径）。虽然 Cygwin 有更多的应用程序，而且是更新的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-23T20:39:16.447

我发现[iPython](http://ipython.scipy.org/moin/) 在它的 -s 模式下尽可能接近。它还兼作 python 交互式 shell。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-23T17:50:19.940

我对所有 Windows 机器做的第一件事就是安装 [Cygwin](http://www.cygwin.com/)

Cygwin 也有一些扩展，比如 ssh 等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-11-30T21:48:10.137

不是一个直接的答案，但由于您有时必须在 Windows CMD 窗口中工作，因此有 2 个设置对于使其可以忍受是绝对必要的。

当我使用新计算机时，我做的第一件事就是将屏幕缓冲区大小设置为 9999（高度）、300（或母猪宽度）。这使您可以随心所欲地左右滚动，并为检查日志提供重要的缓冲区。不要设置窗口大小，它几乎没用。

我要做的另一件事是检查“快速编辑”模式，这使得复制/过去变得更加容易，您可以通过单击/拖动来快速暂停滚动屏幕（开始选择）。

这并不完全是解决问题的方法，只是相关的建议，可能有助于以不同的方式解决他提到的特定问题（而且是一个非常有用的习惯！）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T17:52:34.383

不要试图在 Windows 上强制 Unix 行为——这有点不自然——你为什么不检查一下[PowerShell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)，微软的下一代 Windows 外壳？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-11T02:08:52.470

我还没有[在 WIndows 上尝试过 KDE](http://windows.kde.org)，但据称它现在可以在撰写时的最新版本中使用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-11T02:21:38.930

要更改 cmd 提示符的大小，您可以从属性框中更改窗口大小，这只会调整窗口本身的大小，或者/并且您可以更改缓冲区大小，这将调整...如何描述它，记住的行数。要访问属性工具箱，请右键单击标题栏和属性。

此外，如果您想从 cmd 提示符快速复制内容，请启用属性窗口中的“快速编辑”框 - 它将使您能够选择内容，并通过右键单击“复制”它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-12-10T10:43:07.340

Cygwin 中有一个本地 Windows 版本的 rxvt。它似乎工作得很好，可以轻松调整大小，例如全屏。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-11-13T00:01:01.210

我在 Windows 上使用[JTerm 桌面](http://jwork.org/jterm/)控制台。它具有所有主要 Linux / Unix 命令的 Java 实现，例如我们的 ls、grep、find、cd、cp、mv 等。它有一些限制，但总的来说它可以工作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-05-22T10:28:53.600

**如果您想要 CYGWIN 替代品**

`npm install -g cash-global`

有[一篇](http://www.makeuseof.com/tag/forget-cygwin-cash-brings-best-linux-windows/)关于`The Cash Shell` .

您也可以在[这里](https://www.npmjs.com/package/cash)`npm`查看包裹。

希望这可以帮助。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-02-11T01:47:55.127

我认为您寻找我可以争论的 Powershell 比 linux bash 或至少具有相同的功能更强大。

# asp.net - 使用 vbscript 将文件从 .net 处理程序路由回 asp.dll

> ID：473840
> 
> 赞同：1
> 
> 时间：2009-01-23T17:47:21.053
> 
> 标签：asp.net, iis-7, asp-classic, isapi

我们正在从 asp classic 迁移到 .net。不幸的是，他们将所有的 .asp 文件命名为 .aspx，这样当他们迁移到 .net 时就不会失去页面排名。这意味着 IIS 将所有 .aspx 文件映射到 asp.dll。

改回映射后，我打算尝试让处理程序获取请求，然后检查文件中是否有任何 vbscript，然后将其交还给 asp.dll，否则它会继续正常处理请求。

我们正在使用 IIS7。

我认为也可以使用 ISAPI 过滤器，但是我必须学习如何为 IIS7 制作 ISAPI 过滤器（如果.net 中没有办法做到这一点，这很好）

想法？谢谢！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T20:33:08.363

恕我直言，您最好使用 ATL Server 支持库并制作 ISAPI 过滤器。请参阅：http: [//msdn.microsoft.com/en-us/library/2chz4bx6 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/2chz4bx6(VS.80).aspx)

另外，除非您知道需要 ASP.NET 处理，否则您真的不想访问 aspnet_isapi.dll；为什么会受到打击？

尽管我可能无法正确理解您的问题...您是否在同一个应用程序中混合了经典的 ASP 和 ASP.NET？如果您必须在两者之间共享会话状态，这可能会相当具有挑战性......

# browser - 显示 TIFF 的好浏览器插件

> ID：473853
> 
> 赞同：0
> 
> 时间：2009-01-23T17:50:13.043
> 
> 标签：browser, plugins, tiff

我正在尝试开发我们拥有的存储文档图像的应用程序的网络版本。但是，很大一部分图像是 tiff 的，IE 无法原生显示。任何人都可以推荐一个可以正确显示它们的好插件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T17:53:18.420

Wouldn't it make more sense to have the web application convert the images to something standard either on the fly or using some caching mechanism and then allowing the user to download the tiff format if necessary?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T18:02:54.797

IIRC, the QuickTime plugin handles TIFF acceptably - however at the cost of having QuickTime around. Unfortunately this is not negligible - QuickTime has never been too friendly on Windows systems.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:12:40.190

QuickTime should work, but keep in mind that TIFF files are usually not optimized for size, and are often much larger than JPEG resp. PNG renderings of the same image.

To avoid slow page loads, it might be better to convert the images to JPEG resp. PNG for display, as others suggested

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T22:00:15.567

我在alternatiff.com 找到了一个不错的，以防有人感兴趣。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T18:03:30.133

quicktime will do it.

# wav - WAV 音频格式：MPEG3 转 PCM

> ID：473854
> 
> 赞同：2
> 
> 时间：2009-01-23T17:50:15.697
> 
> 标签：wav, pcm

如何将具有 MPeg 第 3 层 (MPeg3) 音频格式的 wav 文件转换为 PCM？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T18:01:50.150

You could use [FFMPEG](http://ffmpeg.org) called from the command-line, like so:

```
ffmpeg -i source.wav -f wav -acodec pcm dest.wav 
```

**NOTE**: Untested

Also, Windows binaries are available (I had some from another place as well) [here](http://ffdshow.faireal.net/mirror/ffmpeg/).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T18:06:24.527

[LibMAD](http://www.underbit.com/products/mad/) could be what you are looking for.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T18:06:55.727

If finding a windows binary of ffmpeg is too much work you can install [foobar2k](http://www.foobar2000.org/) and do it from there

# java - Java 中是否有使用泛型（域模型，而不是持久层）的多对多集合？

> ID：473862
> 
> 赞同：19
> 
> 时间：2009-01-23T17:51:13.137
> 
> 标签：java, generics, data-structures

我似乎在 Google 中使用了错误的搜索词...

我已经为多对多关联编写了一个通用类，但我猜这已经完成了。它很可能存在于比我自己更好的实现中。这是我第一次尝试编写泛型类。

为了更好地了解我在寻找什么，我包含了一些我自己的片段：

我用 2 个哈希图支持它：

```
private final Map<T, List<S>> ssForTs = new HashMap<T, List<S>>();
private final Map<S, List<T>> tsForSs = new HashMap<S, List<T>>(); 
```

这是实例化：

```
new ManyToManyAssociations<Integer, Integer>(); 
```

一些可用的方法：

*   公共无效添加关联（T t，S s）
*   公共无效删除关联（T t，S s）
*   公共列表<T> getListOfTs()
*   公共列表<S> getListOfSs()
*   公共列表<T> getTsForSs(S s)
*   公共列表<S> getSsForTs(T t)

方法的名称很差......我很抱歉。

基本用法是：我可以很容易地找到 T 的所有 S，反之亦然。

您可以将链接发布到已经包含此功能的精美库吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T19:41:59.950

到目前为止，这是一个没有我想象的那么简单的问题。我想到的两个 Java Collections 扩展是 duffymo 提到的 Google 和[Apache Commons Collections](http://commons.apache.org/collections/)。两者都没有多对多映射。在谷歌的术语中，它是一个`BiMultiMap`; 在 Apache 中，它将是 a`BidiMultiMap`或`MultiBidiMap`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T17:53:30.230

Looks like [Apache Commons Multimap](http://commons.apache.org/collections/api-release/org/apache/commons/collections/MultiMap.html) might be useful.

**EDIT:** except it's one-to-many, not many-to-many. However, it still might be handy to use instead of your `Map<T, List<S>>` and `Map<S, List<T>>`, or as a reference.

# database - 读取 CLOB 列很慢

> ID：473874
> 
> 赞同：0
> 
> 时间：2009-01-23T17:54:28.607
> 
> 标签：database, oracle, clob

希望有人能对我目前在使用 Oracle DB 时遇到的问题有所了解——我相信这很简单！

我已经设法在示例中重新创建了它，所以这里是数据库结构：

```
CREATE TABLE MyTable(
    ixMyTable NUMBER,
    clobData CLOB
)
/

CREATE OR REPLACE PACKAGE PKGTEST
AS
    PROCEDURE DoSomething(
        cur_OUT OUT SYS_REFCURSOR
        );
END PKGTEST;
/

CREATE OR REPLACE PACKAGE BODY PKGTEST
AS

PROCEDURE DoSomething(
    cur_OUT OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_OUT FOR 
        SELECT ixMyTable, clobData
        FROM MyTable;
END;

END PKGTEST;
/

GRANT EXECUTE ON PKGTEST TO TEST_ROLE
/

BEGIN
    FOR i IN 1 .. 7000 LOOP
        insert into mytable values (i, TO_CLOB('123456'));
    END LOOP;
END;
/ 
```

额外信息：

架构所有者是 TEST_SCHEMA

用户是 CARL

CARL 具有 TEST_ROLE 角色

鉴于上述数据库设置，我有一个 C# 测试应用程序，它使用标准 System.Data.OracleClient.OracleCommand 等来执行 PKGTEST.DoSomething 并将结果放入数据网格（DevExpress）。

很确定网格在这里无关紧要，因为我们通过使用开源 OTL 的 c++ 遇到了同样的问题（幸运的是，不是我的部门）。

好的，解决问题....

从开始到填充网格的时间约为 35-40 秒，哎哟。

但是，如果我执行以下操作：

```
GRANT SELECT ON MyTable TO TEST_ROLE
/ 
```

然后再次执行查询，大约需要 5-6 秒。

在我看来，这与特权等有关，但我不太确定为什么它实际上仍然可以双向工作？

只是把别的东西扔进锅里，如果我把程序改成

```
SELECT ixMyTable, TO_CLOB(TO_NCLOB(clobData))
FROM MyTable; 
```

然后时间约为 5-6 秒，有或没有额外的 SELECT 权限。

任何指针或直接的解决方案将不胜感激！

编辑：

操作系统是 Vista x86 Business

Oracle 服务器是 10.2.0.1

Oracle 客户端是 10.2.0.3

编辑：

正如建议的那样，我尝试从 MS OracleClient 更改为 ODP.NET，这确实可以根据需要加快速度。

不幸的是，受影响的 C# 应用程序只是一个用于查看表/运行 SPROCS 等的内部应用程序。

我们的主要交付物是使用 OTL ( [http://otl.sourceforge.net/otl3_intro.htm](http://otl.sourceforge.net/otl3_intro.htm) ) 进行数据库访问的 C++ 应用程序。目前这不是真的可以改变的东西，所以我真的很想了解造成这种差异的原因，而不必无缘无故地抛出无缘无故的 GRANT SELECTs。

如果缺少 SELECT 权限导致完全失败，那么我可能会忍受这种情况，但缺少 SELECT 似乎会导致访问 CLOB 数据的路径变慢。

我已经标记了 3 个答案 - 谢谢那些 - 但我真的可以有一个理由，所以我会为此添加一个赏金。

PS 我们真的很想在一开始就为我们的 C++ 使用 OCCI，但是由于 Oracle 一直支持在当前版本之前的 IDE，我们无法让它与我们的 Visual Studio 2008 很好地配合使用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T18:04:39.350

您确定每次都从磁盘读取 blob，而不是从磁盘缓存中读取第二次及以下吗？

我已经在性能测试中看到了这个问题，特别是在 Oracle 上，第一次运行测试很糟糕。然后通过一个微小的（并且看似微不足道的变化），性能突然显着提高。但实际上发生的情况是，您正在查询的数据已加载到缓存中，并且可以以 10 倍或 20 倍的速率访问（内存与磁盘）。

进行此测试的正确方法是在查询运行之间反弹数据库。如果 DBA 不允许您为该测试反弹测试生产服务器，请在您的机器上加载 Oracle XE 的副本。

编辑：或者更好：每次都删除并重新创建表。您可能正在这样做，但没有提及。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T19:44:32.423

我会尝试 odp.net [http://www.oracle.com/technology/tech/windows/odpnet/index.html](http://www.oracle.com/technology/tech/windows/odpnet/index.html)而不是 System.Data.OracleClient。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-24T13:37:11.760

按照上面的建议，您可以尝试不同的 ODBC 驱动程序或客户端软件。工作速度如此之快的事实`TO_CLOB(TO_NCLOB())`似乎并不表明这就是问题所在。

首先，我将获取这两个查询并通过 SQLDeveloper 运行它们并获得一个解释计划。这应该为您提供在 Oracle 端执行的基线。添加转换对执行路径应该没有影响。交替运行查询并计时以查看它们的速度。如果没有区别，我建议客户端软件是您的问题。

如果我的假设是正确的，这也可以解释这种`GRANT SELECT`变化。客户端软件正在 CLOB 上进行某种昂贵的转换。授权和/或显式转换允许客户端避免这种情况。我不知道为什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-02-07T09:20:06.877

我知道这是一个很老的问题

我从我使用 Oracle OCCI 库的经验谈起，但我相信这将适用于任何 Oracle 客户端。blob/clob 读取操作慢的原因如下

1.  从具有 blob/clob 列的表中进行选择可防止预取。您可以在 sqlplus 中通过对带有 & 不带 blob/clob 列的表使用`set arraysize 1`&来试验这一点。`set arraysize 5000`对于具有大量记录且没有 blob/clob 列的表，`arraysize`会有很大的不同。对于具有 blob/clob 列的表，它不会有太大的区别。因此读取每条记录都会往返于服务器。在较慢的网络（例如 WAN）上，这会产生很大的影响
2.  获取 blob/clob 列需要分别获取定位器和数据。所以这是到服务器的 2 次往返。现在将它与#1 结合起来，你可以看到为什么它很慢

看这里。 [https://docs.oracle.com/cd/E18283_01/appdev.112/e10646/oci07lob.htm#CHDDHFAB](https://docs.oracle.com/cd/E18283_01/appdev.112/e10646/oci07lob.htm#CHDDHFAB)

您可以通过为 LOB 启用行预取来缓解这种情况。 [https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jajdb/index.html?oracle/jdbc/OracleStatement.html](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jajdb/index.html?oracle/jdbc/OracleStatement.html)

我从来没有让这个为 OCCI 工作，但实现了这里提到的解决方法（[Is there a way to prefetch LOBs data in occi?](https://stackoverflow.com/questions/54784447/is-there-a-way-to-prefetch-lobs-data-in-occi)）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T17:45:08.410

老实说，我认为这里的问题是 OTL 驱动程序和 OracleClient 在处理来自 SYS_REFCURSOR 的 CLOB 时遇到问题。SYS_REFCURSOR 很弱，这意味着游标本身可以返回任何类型的数据，这意味着驱动程序需要不断返回数据库并查询游标的元数据（即获取游标中的数据类型），然后加载 CLOB 流，然后加载数据。显然，如果执行查询的用户可以访问被查询的表，驱动程序可以更好地检索元数据并返回正确的数据。

更改存储过程以返回强大的 ref_cursor 是否有效？

```
CREATE OR REPLACE PACKAGE PKGTEST
    AS
    TYPE C_DoSomething IS REF CURSOR RETURN MyTable%ROWTYPE;
    PROCEDURE DoSomething(
        cur_OUT OUT c_DoSomething
     );
END PKGTEST; 
```

你能改变存储过程来做`TO_CLOB()`，因为这似乎也有效吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T15:53:37.067

您的数据库的 NLS_CHARACTERSET 和 NLS_NCHAR_CHARACTERSET 是什么。跑

```
select * from nls_database_parameters; 
```

得到结果。您的客户端软件的 NLS_LANG 设置是什么？

这可能会更深入地了解该问题，并有助于回答 TO_CLOB(TO_NCLOB()) 调用有多昂贵的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T12:25:00.513

这些不一定都直接相关，但您可能应该检查每一个以防万一。我怀疑这与缓存有关：一旦你完成了第一个查询，然后应用 select，它就会快速运行。如果你想正确地进行性能测试，你必须在中间反弹服务器以摆脱缓存。如果您执行此测试并且它突然表现更好，则尝试将表固定到缓存中。请参阅下面的内联 clob 存储，因为这可能是相关的。

大约一年前，我在 Oracle 10g 中遇到了有关 clob 性能的问题。一旦我们得到了很棒的 dba 的帮助，我们就绕过了他们中的大多数。大约需要 2 个月的时间才能使性能达到足够的速度。

您使用的是哪个版本的 Oracle？在 Oracle 10g（早期版本）中，clob 性能存在大量问题。事实上，在某些情况下，只使用两个表和一个 varchar 列实际上更快（将 varchar 连接在一起，你就有了你的 clob）。我们升级到更高版本，它好多了

另外，您的数据存储在哪里？还有一个选项可以将 clob 存储在表本身中。根据您的数据有多大，您可能会发现这有助于提高性能。如果您将数据存储在 SAN 上，那么还值得查看 SAN 上的缓存大小以及块大小。当缓存大小不正确时，Oracle + SAN 可能会有点有趣。

另一种解决方法：如果您发现持久性很慢，甚至访问很慢，并且您不受 CPU 限制，请压缩数据并将其存储在一个 blob 中。我们在这里也看到了巨大的性能优势。

如果您在处理 clob 的过程中发现性能问题（与内存相关？），我们发现我们会将对象重新创建为新字符串。即使数据较小，驱动程序也会预先创建 32K 大小的字符串。

我确实想知道系统表是否可能是碎片化的？有很多表/模式吗？同义词呢？

另外，当您存储 clob 时，它们不会存储到 Oracle 中的一个大文件中吗？如果我没记错的话，您必须小心碎片化；存储不会被释放以供重复使用。

也许您可以在您的数据库前面放置一个 .NET Web 服务？如果您无法解决性能问题，这可能是一种选择。

# apache - Using Apache proxy to foward traffic to tinyproxy

> ID：473880
> 
> 赞同：1
> 
> 时间：2009-01-23T17:57:48.130
> 
> 标签：apache, proxy, mod-proxy

I need to find a way to proxy some traffic on port 80 to tinyproxy running on a separate port. We have a client working behind a very strict firewall with only port 80 open (and cannot get to sites like meebo.com, etc). I was hoping I could create a CNAME to our domain and a virtual host on apache, catch the request for that new CNAME and forward the traffic right to tinyproxy running on the same box.

I know tinyproxy is setup and working correctly, however, when I try to pass in my traffic through Apache, I don't even see any traffic.

Does anyone have a proposed solution? Here is my VirtualHost entry:

```
<VirtualHost *:80>
    ServerName sub.domain.com
    ProxyPass / http://127.0.0.1:50001/
    ProxyPassReverse / http://127.0.0.1:50001/
</VirtualHost> 
```

where Tinyproxy is running on port 50001.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T18:31:50.090

I don't think it's going to be possible.

ProxyPass is for opaque proxying of web-servers - not redirecting to a proxy. But it might have worked except that AFAIK VirtualHost can only be identified by the Host: header in the http request - so only works for the real request.

In other words - the clients will set a Host: header for the site they want to reach, so your virtualHost is never used.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-02T17:51:17.720

澄清一下，您的域的主机名是[http://sub.domain.com/](http://sub.domain.com/) ...，并且您已验证 Tinyproxy 在通过 tinyproxyhost:50001 请求时为您的站点提供服务？

我会考虑在您的网关上使用 iptables 来选择性地 NAT 请求以端口 80 上的 sub.domain.com 到端口 50001 上的 tinyproxyhost。假设 sub.domain.com 位于地址 12.34.56.78，并且该 tinyproxy 在 10.11.12.13 上运行：

```
iptables -t nat -A PREROUTING -p tcp -d 12.34.56.78 --dport 80 -j DNAT \
    --到 10.11.12.13:50001

```

如果你真的想继续使用 Apache，你确定你已经完全启用了 mod_proxy 吗？确保您的配置中也包含以下内容：

```
代理请求关闭

订单拒绝，允许
允许所有人

```

当您尝试在此配置中访问[http://sub.domain.com时会发生什么？](http://sub.domain.com)您在 Apache 中得到什么`access_log`输出`error_log`？

# excel - 使用自动化从 Excel 中获取文本。如果单元格太窄，请获取#####。我怎样才能避免这种情况？

> ID：473887
> 
> 赞同：1
> 
> 时间：2009-01-23T18:00:31.307
> 
> 标签：excel, automation, ole-automation

我正在使用自动化从 Excel 工作表中获取文本。我这样做是因为我需要格式化的值（获取单元格的值不应用任何格式）。如果单元格所在的列太窄，我会得到“#####”，就像我通过 Excel 查看电子表格一样。我怎样才能避免这种情况？

编辑：

以下是相关代码：

```
// Return the (string) value of a cell
HRESULT CDialogImport::GetCellValue(IRange *irange, int irow, int icol, CString &cstrValue)
{
// Get dispatch interface for the cell at irow,icol
COleVariant vCell;
HRESULT hr = AutoWrap(
                    DISPATCH_PROPERTYGET, 
                    &vCell, 
                    irange, 
                    L"Item", 
                    2,
                    COleVariant((short)(icol+1)), 
                    COleVariant((short)(irow+1)));
if (FAILED(hr)) return hr;

// Use the dispatch interface to get the value of the cell
COleVariant result;
hr = AutoWrap(
                DISPATCH_PROPERTYGET, 
                &result, 
                vCell.pdispVal, 
                L"Text", 
                0);
if (SUCCEEDED(hr))
    {
    cstrValue = result; 
    }

return hr;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T14:42:54.113

该`IRange`接口提供了一个`AutoFit()`方法。

根据[文档](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel.range.autofit(VS.80).aspx)，调用它会使列宽到足以容纳它们的内容。（*这是 .NET 互操作文档，但我希望这里没有区别*）

请注意（强调我的）：

> 表达式必须是**一行或一组行**，或者一**列或一组列**。否则，此方法会产生错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T19:46:06.337

您应该能够获取和设置列宽（rangeobject.ColumnWidth） - 在抓取文本之前增加宽度应该可以解决问题。

# ruby-on-rails - 试图删除 rails 中的 has_and_belongs_to_many 关系

> ID：473891
> 
> 赞同：0
> 
> 时间：2009-01-23T18:01:06.703
> 
> 标签：ruby-on-rails, many-to-many, has-and-belongs-to-many

所以我昨天才开始我的第一个 Rails 项目。我的应用程序中有两个多对多（has_and_belongs_to_many）关系。我在模型游戏和团队之间有一个，另一个在模型统计数据和结果之间。通过自己通过迁移创建连接表，这一切都很好。

然后我决定我不想让统计/结果关系是多对多的，而是多对多的关系，所以我运行了以下迁移并将关系切换到 has_many 和 belongs_to：

```
class FixingResultStatRelationship < ActiveRecord::Migration
  def self.up
    add_column :results, :stat_id, :integer
    drop_table "results_stats"
  end

  def self.down
   remove_column :results, :stat_id
   create_table "results_stats", :id => false do |t|
      t.column "result_id", :integer
      t.column "stat_id", :integer
    end
    add_index "results_stats", "result_id"
    add_index "results_stats", "stat_id"
  end
end 
```

然后，当我这样做时，不仅新的一对多关系不起作用，因为我在调用 Result.find(0).stat 时收到 NoMethodError，而且现在我之前与游戏和团队的工作多对多关系现在也坏了。我以前可以调用 Game.fine(0).teams 来查找并查看结果，现在我也得到了 NoMethodError。有什么想法吗？我很迷茫，任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T18:35:28.540

我刚刚意识到我有 belongs_to :stats 而不是单数 stat。我解决了这个问题并重新加载了服务器，现在一切正常。无论如何，感谢Abie。

# c# - 如何通过元刷新强制缓存图像？

> ID：473892
> 
> 赞同：4
> 
> 时间：2009-01-23T18:01:06.847
> 
> 标签：c#, asp.net, html, caching

我有一个统计页面，上面有一个元刷新标签。

```
<meta http-equiv="refresh" content="10" /> 
```

如何停止它也强制刷新页面中的图像？我尝试设置缓存控件，但浏览器 (IE7) 仍然刷新页面中的 50 多个图像。

```
Response.Cache.AppendCacheExtension("post-check=900,pre-check=3600"); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T23:15:50.207

我通过使用 javascript 手动刷新页面而不是元标记解决了这个问题。这会阻止浏览器在每次重新加载时刷新所有图像，但仍会强制浏览器刷新 ASPX 页面本身。

```
<script>
setTimeout('document.location=document.location',10000)
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T18:14:11.810

也许您的 IE 设置为不缓存图像？你如何生成图像？它们是否包含某种无缓存标头？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T10:34:17.563

这不是一个完整的答案，而是 SSL 下的统计页面，并且图像 src 是否由 css 设置？我依稀记得一个类似的问题，当页面在 SSL 下并且 css 正在更改图像 src 时，图像没有在 IE 中缓存（例如当将鼠标悬停在按钮上时等等......它不仅仅是标准的 html 图像标签...图像正在通过 css 更改 src 属性。）。所以 css、ssl 和 IE 的组合导致了这个问题。抱歉，我不记得我们遇到的确切问题，但通过 javascript 预加载图像（并更改悬停时更改按钮的方式），我们能够解决问题。可能是您要检查的内容。

# debugging - 如何将多个 TestNG 套件结果合并到一份报告中？

> ID：473911
> 
> 赞同：2
> 
> 时间：2009-01-23T18:08:27.627
> 
> 标签：debugging, configuration, report, testng

所以这是我工作中的一个问题。我有一些 TestNG 用例，如果在第一批测试用例中运行，会对其他测试用例造成严重影响。我没有遍历和更改我们所有的测试用例，而是为所涉及的用例创建了一个组。我运行主测试套件，不包括该组，然后进行第二次 Ant 调用以运行受影响的组。这样所有测试用例都通过了，但我最终不得不创建两个 TestNG 报告，这样第一个报告就不会被第二组的结果覆盖。

所以这是我的问题：是否可以将第二个测试结果报告与第一个合并，还是我坚持两者？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T14:00:01.020

我认为您能够做到这一点的唯一方法是在两次运行后处理 TestNG XML 输出。[您应该能够从两次运行中整理 XML 文件，并使用Ant JUnit Report 任务](http://ant.apache.org/manual/Tasks/junitreport.html)将其组合成一个 HTML 报告。

如果您对由此获得的输出不满意，可能是因为 TestNG 奇怪地组织了它的 JUnit XML 输出。如果您使用我的[ReportNG 项目](https://reportng.dev.java.net)中的 JUnitXMLReporter并在其上运行 JUnit Report，您将获得更好的结果（在我看来）。

或者，您可以使用TestNG 的[XSLT 报告](http://code.google.com/p/testng-xslt/)器将两个测试运行的 XML 输出组合成一个 HTML 报告，尽管我不知道它是否支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-15T00:30:44.257

我认为 Jenkins TestNG 插件将采用 *.xml 过滤器来连接多个结果文件。

# sql-server - 在视图中包含临时/变量表有什么问题？

> ID：473912
> 
> 赞同：0
> 
> 时间：2009-01-23T18:09:06.470
> 
> 标签：sql-server, tsql, temp-tables

我的一个朋友问我是否知道为什么他不应该在 SQL-Server 2000 的视图中包含临时表或变量表。我只能认为每次访问视图时都会创建一个新表，但我想知道是还有其他问题。

谢谢，

**编辑：**这是不可能的

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T18:13:05.777

呵呵，你能做到吗？

服务器：消息 4508，级别 16，状态 1，过程测试，第 2 行临时表上不允许视图或函数。以“#”开头的表名表示临时表。

# c++ - 我应该制作自己的框架吗？

> ID：473915
> 
> 赞同：1
> 
> 时间：2009-01-23T18:11:10.273
> 
> 标签：c++, frameworks, interface, portability

我是否应该通过封装 STL 类和/或 Boost 库来制作自己的框架，以便如果我需要更改字符串、向量、列表等的实现，或者我需要编写 MFC、其他其他库甚至函数其他平台需要使用它们的格式，我可以轻松地改变它们以满足标准。这就是我的想法。

```
// In my framework:
namespace MyFX { 
    typedef std::string String;
};

// Port specific (MFC in this case)
CString ToCString(const MyFx::String &str) { /* magic */ }

// Port specific (.NET specific)
System::String^ ToManagedString(const MyFx::String &str) { /* magic */ } 
```

我是否过多地重新发明轮子？

我会在 UI 和其他层之间的 UI 接口中使用*MyFx::String 。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T18:18:00.070

在我看来，这不会有很多好处；根据我的经验，使用这些框架的*目的*是为了避免重新发明轮子。如果你发现你需要编写一个新的字符串类或一个新的向量类，你应该认真考虑一下，并确保你不只是做错了什么。我并不是说没有理由编写自己的字符串类，我只是说它很少见。鉴于此，我建议直接使用所需的框架。

关于转换函数，我相信编译器不会看到你的 ToCString 函数与它看到的有任何不同：

```
CString ToCString( const std::string & ) {...} 
```

这是因为 C++ typedef 不会创建新类型，只是现有类型的别名。

**进一步的想法**

我认为你在这里表达的担忧是很自然的，我知道我的团队已经多次出现过这种担忧。但是，我认为答案仍然如上所述。

虽然 STL 类可能并不完美，但它们是由非常聪明的人设计的，他们在任务中投入了很多心思。因此，您需要编写一个完整的替换字符串类的可能性非常小。此外，在无意中，您（或我）将花费很长时间来实现一个健壮的通用字符串类，该类可以适当地替换 std::string。

另一种可能的思考方式是：您会考虑在 Java 或 C# 中“替换” String 类吗？我认为答案显然是“不”，尽管可能偶尔会在有限的区域使用字符串以外的东西来表示一系列字符。这里也有同样的情况：std::string 与 C++ 与内置字符串类一样接近，而且您几乎可以肯定不需要替换它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-23T18:28:25.073

“我是不是在重复造轮子太多了？” - 是的。不要这样做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T18:17:23.443

> 我应该制作自己的框架吗？

呃……不。

在有业务需要之前，我不会真正担心替换 std::vector ，因为[YAGNI](http://en.wikipedia.org/wiki/You_Ain%27t_Gonna_Need_It)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T18:44:39.893

“这取决于” - 如果您认为将来可能会更改为其他一些库/库（例如，由于移植到其他平台），那么制作一个满足您需求的框架，但让它成为一个门面, 尽可能的薄和简单

这是一个只有您可以做出的时间/风险权衡决定

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T20:14:22.893

另请参阅：[https](https://stackoverflow.com/questions/22795/when-to-notionally-build-your-own-compiler) ://stackoverflow.com/questions/22795/when-to-notionally-build-your-own-compiler ，也许更有趣的是 Joel 的文章引发了这个问题：[为 Not-Invented-Here 综合症辩护](http://www.joelonsoftware.com/articles/fog0000000007.html)。

但简短的回答是：并非没有该死的充分理由。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T07:23:27.490

最大的好处将是您将获得的学习经验。

# linux - Ffmpeg 和 Xing 标头 - iTunes 问题和 Duration 问题

> ID：473921
> 
> 赞同：0
> 
> 时间：2009-01-23T18:13:21.033
> 
> 标签：linux, command-line, mp3, ffmpeg

我从一堆 flv 文件中提取音频作为 MP3。这很好用：

```
ffmpeg -i video.flv -vn -acodec copy audio.mp3 
```

但是，我提取的某些音频的持续时间比应有的要长，并且某些 MP3 文件不断循环播放音频！同样在 WMP 等一些音频播放器中，搜索栏会卡在某一点上。

我发现这是由于 Xing 标头不正确或设置不正确（？）。我希望有人可以帮助我编辑上面的命令，以便解决这个问题，也许可以解释为什么会发生这种情况，以便我学习。

任何帮助高度赞赏:)

## [解决了]

见我的回答。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T18:31:59.487

我已经通过确保我实际转换为 MP3 格式而不是仅仅复制音频编解码器并假设它已经是 MP3 格式来解决上述问题！

# sql-server - 面向 Internet 的应用服务器的典型 SQL Server 身份验证方法

> ID：473924
> 
> 赞同：1
> 
> 时间：2009-01-23T18:14:17.240
> 
> 标签：sql-server, authentication

我在一个面向 Internet 的、基于 ASP.NET 的产品上工作，该产品使用 SQL Server 2005。大多数客户使用传统方法部署我们的软件，应用服务器 (IIS) 位于 DMZ 中，SQL Server 位于二级防火墙后面。

我们想选择一种类型的 SQL Server 身份验证。从安全角度和/或客户角度来看，首选集成身份验证还是 SQL Server 身份验证？

我已经阅读了相关的帖子，如果重要的话，我们的应用程序直接使用 SQL 以及存储过程。我们的应用程序实现了一个安全模型，因此我们不需要能够区分 SQL Server 中的用户。

谢谢，斯科特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T18:18:11.973

要么都行。有人告诉我集成身份验证更安全一些，因为它不会通过网络传递 sql 登录信息。身份验证的类型并不像授予访问数据库的帐户的权限那么重要。

如果您要将它提供给客户端进行安装，我可能会使用 sql 身份验证，因为这不需要另一个系统来验证用户（如活动目录）。

Mithcel 提出了一个关于让客户配置它的好观点。我见过明确禁止 SQL 身份验证的地方，以及无法使用 Active Directory 帐户的其他地方（比如我现在工作的地方）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T18:19:58.570

在您向用户提供产品的环境中工作，我会让他们自己决定如何配置连接。集成安全性和授予 ASP.NET 工作进程通常被称为更安全的路由，但是，某些环境对委派有限制，不允许这样做。

通常我看到人们使用具有强密码的 SQL Server 帐户。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:28:49.877

我主要使用具有难以猜测的帐户名称和非常强大的密码的非集成 SQL 服务器帐户 - 然后只授予该帐户最低限度的权限。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T20:51:31.900

Windows 身份验证比 SQL 身份验证更安全，但是如果 Web 服务器位于 DMZ 中，那么它可能不属于 Windows 域，并且需要 SQL 身份验证。

作为之前安装过供应商软件包的人，我总是建议让客户决定应该如何进行身份验证。这应该包括将用户名和密码设置为他们想要的东西，这样如果有需要保持的标准就不是问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T21:01:40.273

您可能希望在 sql server 后端创建一个用户/登录名，该用户/登录名具有一组受限权限，例如“WebUser”，用于 Web 配置中的连接字符串。确保您不向此用户授予 DDL 权限（除非您的应用程序要求）。

But if you are 100% sure that all the users will be Windows users (part of Windows Domain), setting your SQL Server Authentication to "Windows Authentication" is the safest way to do it since that mode of authentication will inherit the policies of the domain and its users (priveledges, roles, etc).

# .net - OleDB 与 SQLClient 的优缺点是什么？

> ID：473932
> 
> 赞同：18
> 
> 时间：2009-01-23T18:18:58.277
> 
> 标签：.net, sql-server-2005, oledb

一些上下文：我正在开发的系统之一是 .net 2.0 Web 应用程序。VB.net 用于前端，SQL Server 2005 用于后端。由于各种已被时间遗忘的原因，最初的设计者决定使用 .Net OleDB 连接而不是 SQLClient 连接。

经过几年的发展，这个特殊的系统正处于从“beta”到“1.0”状态的边缘。在这一点上我们一直在谈论的一件事是转移到 SQLClient 连接。虽然我知道使用它是最佳实践，并且它是获得 SQL Server 2005 中更高级功能的唯一方法（显然我们没有使用它）使用它的优势是什么？其他？我应该知道任何隐藏的陷阱吗？谁能指出一些显示相对速度的基准？（我听说 SQLClient 应该更快，但我从未见过任何数字来支持它。）

谢谢大家。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-23T18:26:15.483

OleDb 更通用。如果您将来迁移到不同的数据库类型，那么它很有可能会有一个 Ole 驱动程序，而您不必更改那么多代码。

另一方面，如您所说，Sql Server 本机驱动程序应该更快，并且它具有更好的参数支持（参数可以使用名称并且不必*按*顺序排列）。

以我个人的经验，我从未注意到速度差异；我也找不到任何东西来支持这个说法。我怀疑性能优势是真实存在的，但是您必须处理数百万条记录才能开始衡量它。

我确实注意到了一个有意义的区别是错误消息。我在使用旧的 OleDb 应用程序时遇到了问题，我绝望地将其切换到 SqlClient。当然，它仍然没有用，但是更好的错误消息提供了足够的新信息，我能够解决这个问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-07-01T03:59:47.460

OLEDB 比 SQLClient 快得多，但通过 ADO.NET 访问时除外。OLEDB 的驱动程序是用本机非托管代码编写的，但是，当您通过 ADO.NET 访问这些驱动程序时，您必须经过几个层（包括抽象层和 COM 互操作层）。抽象层负责资源管理，例如管理内存句柄以确保正确进行垃圾收集、将数据类型和参数更改为 .NET 类型以及将 oledb 缓冲区转换为行和列绑定。COM 互操作层负责编组从 .NET 到 COM 的传递消息，反之亦然，包括锁定/解锁/转换指针。

不要听任何人在不了解他们如何测试它以及他们使用什么环境（托管代码与托管代码）的情况下对 OleDB 的性能进行虚假指控。唯一让 OleDB 变慢的是需要大量的管道才能使本机代码与托管代码配合得很好。还要记住，SqlClient .NET 库有它自己的管道，它不像大多数人认为的那样是一个 NATIVE .NET 库。.NET 中的 SqlClient 库使用 SNINativeMethodWrapper 和 SNIPacket 类，它们是在非托管代码 (sqlncli.dll) 和托管 .NET 代码之间编组数据的包装器。这是未记录的事实，也是当您在本机非托管代码中使用 OleDB 时 .NET SqlClient 永远无法胜过 OleDB 的原因。

总之，如果您使用 100% 托管代码，您将从 System.data.SqlClient 获得更好的性能。如果您有一个混合环境，您将获得更好的性能直接与 OleDB 或 sqlncli.dll (SQL2005) 或 sqlncli10.dll (SQL 2008) 对话。请记住，Microsoft 正在更新 OleDB 和 ODBC，并且最新的 OleDB 驱动程序确实与最新的非托管本机 SQL 客户端库通信。Microsoft 建议在需要高性能时在非托管应用程序中使用 OleDB。

有关详细信息，请参阅“SQL Server 2008 联机丛书\数据库引擎\开发\开发人员指南\SQL Server 2008 Native Client Programming\SQL Server 2008 Native Client (OLE DB)”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-23T18:30:10.733

我和 Joel 一起讨论这个问题，如果您打算坚持使用 SQL Server，SqlClient 是最好的选择。有性能提升，但您必须开始使用大型集合和大量事务才能开始看到这样做的好处。

总体而言，所提供的错误和功能更适合 SQL Server 的功能，因此如果您愿意，这是一个“更好”的实现。它还支持 MARS，这对某些人来说是“必须做的”开关。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-12T19:15:41.667

下面是一些**PowerShell**代码进行直接比较：

**奥莱数据库：**

```
$ConnectionString      = "server=localhost;database=MyDatabase;trusted_connection=yes;Provider=SQLNCLI10;"
$sql = "SELECT * FROM BigTable"

$conn = New-Object System.Data.OleDb.OleDbConnection($ConnectionString)
$conn.open()
$cmd = New-Object system.Data.OleDb.OleDbCommand($sql,$conn)
#$cmd.CommandTimeout = $timeout
$da = New-Object system.Data.OleDb.OleDbDataAdapter($cmd)
$dt = New-Object system.Data.datatable
[GC]::Collect()
$start = get-date
[void]$da.fill($dt)
$now = get-date
[int]($now - $start).Milliseconds
$conn.close()
#$dt 
```

**SQL客户端：**

```
$ConnectionString      = "Data Source=localhost;Initial Catalog=MyDatabase;Integrated Security=True"
$sql = "SELECT  * FROM BigTable"

$conn=new-object System.Data.SQLClient.SQLConnection($ConnectionString) 
$conn.Open() 
$cmd=new-object System.Data.SQLClient.SQLCommand($sql,$conn)
#   $cmd.CommandTimeout=$timeout
$dt = New-Object system.Data.datatable
$da=New-Object System.Data.SQLClient.SQLDataAdapter($cmd)
[GC]::Collect()
$start = get-date
[void]$da.fill($dt)
$now = get-date
[int]($now - $start).Milliseconds
$conn.close()
#$dt 
```

我有

```
Ole-DB : SQL-Client
538 - 839
767 - 456
592 - 678 
```

因此，对于这种类型的即席查询，我更喜欢 Ole-DB，因为我只需调整连接字符串即可从 Oracle 数据库中提取数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T18:37:18.050

您始终可以使用 SqlClient 和 OleDB 编写包含一些典型操作的示例应用程序，并对它们进行基准测试以比较性能。我怀疑差异会很大，但只有一种方法可以找出答案。

我认为您在使用 OleDb 时不会有任何问题，除非您使用像 XML 这样的外来数据类型，在这种情况下您可能需要更加努力地工作。

# c# - 一般执法

> ID：473934
> 
> 赞同：3
> 
> 时间：2009-01-23T18:20:17.570
> 
> 标签：c#, .net, linq-to-sql, generics, datacontext

我有一个通用类

```
public MyClass<TContext, T> where TContext : DataContext 
```

有效地作用于另一个实例

```
public class MyOtherClass<T> : IEnumerable<T> 
```

我想强制`TContext`执行`Table<T>`. 有没有一种干净的方法来执行此操作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T18:23:10.467

您是否要验证 TContext 是否有一个 Table<T> 成员？如果是这样，唯一的方法是为此合约定义一个接口并更改您的通用约束

```
interface IMyTable<T> {
  Table<T> Table;
}

public MyClass<TContext,T> where TContext : DataContext,IMyTable<T> 
```

**编辑**

杰森对我的回答发表了澄清评论。名称 Table 不是静态的，而是取决于 T 的类型。

如果是这种情况，那么就无法通过通用约束静态地强制执行此操作。您可以做的最好的事情是创建一个实现 IMyTable<> 并提供 DataContext 和 Table 实例的适配器类。

```
interface IMyTable2<T> {
  DataContext DataContext {get; }
  Table<T> Table {get; }
}

class MyAdapter: IMyTable2<T> {
  private MyOtherClass<T> _other;
  public DataContext DataContext { get { return _other.DataContext } }
  public Table<T> Table { get { return _other.TableWithDifferentName; } }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T20:14:18.090

我认为 JaredPar 第一次提出了正确的想法。

```
interface IMyTable<T>
{
  Table<T> TheTable {get;}
}

public class MyClass<TContext,T> where
  TContext : DataContext,IMyTable<T>
{
  //silly implementation provided to support the later example:
  public TContext Source {get;set;}

  public List<T> GetThem()
  {
    IMyTable<T> x = Source as IMyTable<T>;
    return x.TheTable.ToList(); 
  }
} 
```

我想通过添加显式接口实现来扩展他的想法。这解决了 Jason 关于通过 IMyTable 访问表属性的评论。必须以某种方式涉及类型，如果您有`IMyTable<T>`，则涉及类型。

```
public partial class MyDataContext:IMyTable<Customer>, IMyTable<Order>
{
  Table<Customer> IMyTable<Customer>.TheTable
  { get{ return this.GetTable<Customer>(); } }

  Table<Order> IMyTable<Order>.TheTable
  { get{ return this.GetTable<Order>(); } }  
} 
```

现在可以这样做：

```
var z = new MyClass<MyDataContext, Customer>();
z.Source = new MyDataContext();
List<Customer> result = z.GetThem(); 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-23T18:23:50.887

强制执行它的唯一方法是，如果 Table 位于接口中，并且您分配了通用约束......所以类似

```
public class MyOtherClass<T> : IEnumerable<T>, IHasTable<T> 
```

# python - 文件上传状态信息

> ID：473937
> 
> 赞同：2
> 
> 时间：2009-01-23T18:21:26.837
> 
> 标签：python, upload, curl

我正在制作一个小的 python 脚本来在网上上传文件。脚本工作正常，现在我想添加一个简单的进度条，指示剩余的上传量。我的问题是 - 我如何从上传文件的服务器获取上传状态信息，假设有可能......我正在使用 curl 和 pycurl 在 python 中发出 http 请求。任何帮助将不胜感激，谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T18:56:20.027

在此处查看文档：http: [//pycurl.sourceforge.net/doc/callbacks.html](http://pycurl.sourceforge.net/doc/callbacks.html)以获取回调。祝你好运！

# sql - SQL“或”运算符。在以下场景中它是如何工作的？

> ID：473943
> 
> 赞同：0
> 
> 时间：2009-01-23T18:25:09.480
> 
> 标签：sql, sql-server, null, three-valued-logic

我一直在优化查询，遇到了一个让我质疑我一直使用 SQL 的 OR 运算符的情况。（SQL Server 2000 也是）

我有一个查询，其中条件 (WHERE) 子句看起来像这样：

```
WHERE (Column1 = @Param1 or Column1 LIKE @Param1 + '%')
AND (@Param2 = '' OR Column2 = @Param2 OR Column2 LIKE @Param2 + '%') 
```

现在，我一直理解 SQL 中的 OR 评估了这两个表达式。因此，所有对左侧表达式评估为 true 的记录将与所有在右侧表达式评估为 true 的记录一起返回。例如：

```
SELECT * FROM TABLE1
WHERE COL1 = 'Test' OR Col2 = 'Data' 
```

这将返回 COL1 为“测试”的所有记录以及 Col2 为“数据”的任何记录

在上面的示例中，我将 Column2 条件修改为以下内容：

```
AND(Column2 LIKE ISNULL(@Param2, '') + '%') 
```

突然间，我返回了 0 行。

我是否误认为 OR 只评估表达式，直到找到 TRUE 结果，或者是否存在会导致 2 个不同返回不同结果的条件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T18:28:56.010

“OR 只计算表达式，直到找到 TRUE 结果”

它只需要，但这不是你的问题（实际上这是在你原来的情况下拯救你的原因）。您的两个查询并不真正等效。

我认为您`NULL`在 Column2 中有 s 永远不会导致`(Column2 LIKE ISNULL(@Param2, '') + '%')`为真 - 在您的原始版本中`@Param2 = ''`，它掩盖了这种情况，因为它是真的（有时）

也许：

```
(ISNULL(Column2, '') LIKE ISNULL(@Param2, '') + '%') 
```

记住 NULL 的三值逻辑：

```
TRUE and UNKNOWN: UNKNOWN
TRUE or UNKNOWN: TRUE

FALSE and UNKNOWN: FALSE
FALSE or UNKNOWN: UNKNOWN 
```

但我不确定您的优化是否真的有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T18:30:41.763

OR 并非包罗万象，尤其是在括号中。从那以后你所拥有的是：`WHERE X AND Y`。X 和 Y 本身是使用 OR 的布尔表达式这一事实并不重要：它们分别进行评估，然后将结果提供给 AND 运算符。

[编辑]：
再读一遍，我可能误解了你的问题。考虑到这一点，我将不得不选择另一个答案，因为`NULL LIKE '%'`返回 NULL，在这种情况下与 false 相同。你可以试试这个：

```
COALESCE(Column2,'') LIKE COALESCE(@param2,'') + '%' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:37:48.987

仅供参考，您可以进行非常简单的实验，以了解并非所有条件都必须进行评估。

我在 Oracle 中这样做了，但我希望您在 SQL Server 中会得到类似的结果。

```
dev> select * from dual where 1=1 or 1/0 = 3;

D
-
X 
```

OR 之后的条件必须没有被评估，因为它会引发被零除的错误。

这种对布尔运算符的处理通常被称为“短路”，AFAIK 在现代语言中是相当标准的。它也可以应用于 AND 表达式——如果第一个条件为假，则评估第二个条件没有意义，因为整个表达式不可能为 TRUE。

更多信息： [http ://en.wikipedia.org/wiki/Short-circuit_evaluation](http://en.wikipedia.org/wiki/Short-circuit_evaluation)

无论如何，正如凯德所说，你真正的问题可能是对 NULL 的错误处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T18:33:59.027

MS-SQL 将首先评估左侧，除非需要，否则不会继续。

这与 AND 连接器相同，将评估左侧，如果为 false，则不评估右侧。

# c# - starting a program on a remote machine in wmi, but also opening the apps window (in c#)

> ID：473945
> 
> 赞同：0
> 
> 时间：2009-01-23T18:25:29.277
> 
> 标签：c#, .net, .net-2.0, wmi

I've browsed page after page after page of data on the web and everyone seems to say that you cannot have an executable remotely execute an application on another machine via WMI and have the window of that application display.

Does anyone know a way around this?

I have tried created 2 executables. 1 executable uses the Process class and simply starts an executable. Here's the code:

```
 class Program
 {
      static void Main( string[ ] args )
      {
           ProcessStartInfo startInfo = new ProcessStartInfo();
           startInfo.CreateNoWindow = false;
           startInfo.UseShellExecute = false;
           startInfo.FileName = "C:\\folder\\Mexe.exe";
           startInfo.WindowStyle = ProcessWindowStyle.Normal;
           //p.MachineName="server";
           //p.Start(startInfo);
           Process p = Process.Start( startInfo );
      }
 } 
```

This executable resides on the remote machine.

I have another executable that will be on the client's machine. This exe uses WMI in C# to remotely execute the application on the server via the commandline. I get a return code of 0\. Nothing happens on the server.

Any ideas what I might be doing wrong?

I've also thought about creating a scheduled task in task scheduler on the server, but leaving the task disabled.

Anyone have an idea what the C# code would be to have a WMI application kick off this task? Would there be a way to discern whether the task/application started finished?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-24T22:36:54.857

You have to use Win32_ScheduledJob.Create to create an interactive process remotely I believe.

See

[http://msdn.microsoft.com/en-us/library/aa389769%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/aa389769%28VS.85%29.aspx)

You can just schedule it for Now +1 second.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-24T14:42:49.427

If your command line string is OK, the process name (Mexe.exe) should appear in the process list in Windows Task Manager even if it is invisible. I have also seen information that you can use scheduled tasks to make the process visible, but never tried it. Once you confirm that the process gets created you could try creating a scheduled task for it and running it using Win32_Process.Start().

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-28T06:20:15.117

您可能已将“Mexe.exe”作为控制台应用程序。在您的代码中，startInfo 描述了一个 Windows 应用程序。尝试将“Mexe.exe”制作为 Windows 应用程序。我已经为控制台和 Windows 应用程序尝试了您的代码，它适用于 Windows 应用程序。

您也可以直接使用客户端上的一个可执行文件来执行此操作。无需中间服务器可执行文件来调用“Mexe.exe”。只是提高性能的建议..

# embedded - USB 驱动器 LED 闪光灯

> ID：473953
> 
> 赞同：3
> 
> 时间：2009-01-23T18:28:42.467
> 
> 标签：embedded, hardware, usb, led

我最近在阅读有关 Arduino 的[Hello World](http://arduino.cc/en/Tutorial/Blink)应用程序的信息，我心想：“我想知道我是否可以使用我现在拥有的硬件来做到这一点。”

因为我没有 Arduino，所以我抓起一个随身携带的 USB 闪存驱动器，开始在谷歌上搜索有关它的信息。我在这方面没有找到太多有用的信息，所以我现在在这里问：我是否可以访问 USB 驱动器的硬件（例如 LED）并通过一些编程环境与之交互（我认为 C# 应该可能有办法做到这一点）？

此外，与这个主题相关 - 有谁知道 USB 驱动器使用什么样的命令？例如，SCSI 存储设备具有标准化的命令集；ATA 设备具有类似的协议。简单的读/写命令是如何发送到 USB 存储设备的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T20:25:34.683

虽然 USB 协议相当通用，但外围设备实际上是特定于功能的，并且需要主机上的某种设备驱动程序才能正常运行。

虽然 USB 闪存驱动器上有一个微控制器，但大多数 USB 存储设备都遵循通用协议。这就是为什么您不必为插入 Windows 的每个驱动器安装不同的设备驱动程序。

我很确定大容量存储协议没有“打开 LED”消息 :) 虽然实现 USB 驱动器的公司实际上可能有一个特殊的命令来执行此操作（可能用于调试），但我会怀疑它将被发布。

虽然我不是 Windows 上的专家，但我相信为了让您直接访问 USB 堆栈，您必须编写自己的设备驱动程序并将其插入内核中。您能想象一个常规应用程序是否可以将“格式化所有内容”命令发送到任意 USB 设备。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T10:46:22.463

[这是一个 DIY USB 控制 LED 灯的链接，它比插入 USB 记忆棒要多一些工作*。*](http://www.bitrot.de/ledlamp.html)

如果你想打开USB硬盘上的灯，你只需要将数据写入该驱动器上的文件，虽然我认为有些驱动器会一直亮着灯，大多数只是在数据传输时亮起被写。

因此，如果您的 USB 驱动器安装为 F:，您可以创建一个类似 F:\lights.txt 的文件，然后向其中写入几 k 的数据，然后擦除该文件并重新开始。

一个缺点是闪存驱动器会在一段时间后磨损，这会磨损它。您也可以尝试从驱动器读取数据。

如果你想要更精确的控制，你可以得到这样的 USB 数据采集设备[，](http://www.labjack.com/results.php?category=0)它可以让你驱动特定的电气输出，为你想要的任何东西供电，包括灯泡或 LED。它们最初被科学家用来测量实验室设备的输入，我在大学物理课上使用过类似的东西，尽管当时我们使用的是 RS-232。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:32:32.273

我会看[这里](http://www.lvr.com/mass_storage.htm)。他们使用一种叫做大容量存储的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T10:27:57.693

Linux 中的 USB 驱动器看起来像 SCSI 驱动器，因此您可以进行 INQUIRY、READ、WRITE 等操作。通常闪存驱动器的控制器制造商可能有一个特定于供应商的“后门”，一般公众都不知道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-07T12:25:44.730

您可以像 RS232 端口一样控制 USB，希望此 MSDN 链接对您有所帮助 [http://www.microsoft.com/downloads/details.aspx?FamilyID=075318ca-e4f1-4846-912c-b4ed37a1578b&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=075318ca-e4f1-4846-912c-b4ed37a1578b&DisplayLang=en)

# visual-studio-2008 - 如何让 Resharper 使用 Visual Studio 的代码片段

> ID：473956
> 
> 赞同：19
> 
> 时间：2009-01-23T18:29:01.110
> 
> 标签：visual-studio-2008, resharper

我在 VS2008 中安装了 Resharper，它似乎已经接管了我所依赖的一些片段。例如，prop、foreach 等...

我如何告诉 Resharper 让 VS2008 使用它自己的代码片段，或者至少不要覆盖已经存在的代码片段。
更好的是，有没有办法选择性地告诉 Resharper 它可以覆盖哪些片段以及不应该覆盖哪些片段？

我知道 Live Templates 菜单项可以让您进行选择，但是在取消选择“foreach”之后，例如，VS（或者可能是 Resharper）将其视为一个函数。换句话说，当我键入“fore”并点击选项卡进行自动完成时，我最终会得到“foreach()”而不是片段操作。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T18:42:57.820

您可以从 Live Templates 窗口取消选中您不想使用的那些。foreach 模板在迭代组下。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-07-20T16:53:09.483

我知道我迟到了，但您可以使用片段编辑器复制您的片段，然后通过实时模板编辑器将其粘贴到 Resharper。该代码似乎是兼容的。我用我的几个做到了这一点，它工作得很好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-02-18T19:10:26.703

由于 ReSharper 4 Visual Studio 代码片段作为实时模板导入 ReSharper。这意味着您可以通过按 Ctrl+J 来调用任何代码片段。

在 Vs 中导入的所有脚本都在此弹出菜单中可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-07-28T16:11:34.127

Resharper 在某些方面很棒，但在其他方面，当它在多年的肌肉记忆中粗暴对待时，它可能会令人难以置信地令人沮丧。

选项 => 环境 => 智能感知 => 完成行为 => [取消选中]“用实时模板替换关键字”

# c++ - 内存密集型应用程序中的内存管理

> ID：473958
> 
> 赞同：8
> 
> 时间：2009-01-23T18:29:34.527
> 
> 标签：c++, windows, optimization, memory-management

如果您在 Windows 上使用 C++ 开发内存密集型应用程序，您是选择编写自己的自定义内存管理器来从虚拟地址空间分配内存还是允许 CRT 控制并为您进行内存管理？我特别关心堆上小对象的分配和释放造成的碎片。因此，我认为即使有足够的内存，该进程也会耗尽内存但碎片化。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-23T18:34:56.667

我认为你最好的选择是在配置文件**证明**CRT 正在以损害应用程序性能的方式分割内存之前不要实施。CRT、核心操作系统和 STL 人员花费大量时间考虑内存管理。

您的代码很有可能在现有分配器下运行良好而无需更改。这肯定比您第一次获得正确的内存分配器的机会更大。我之前为类似的情况编写过内存分配器，这是一项艰巨的任务。毫不奇怪，我继承的版本充满了碎片问题。

等到配置文件显示存在问题的另一个好处是，您还将知道您是否确实修复了任何问题。这是性能修复中最重要的部分。

只要您使用标准集合类和算法（例如 STL/BOOST），在周期的后期插入新的分配器来修复代码库中确实需要的部分应该不会很困难固定的。您的整个程序不太可能需要手动编码的分配器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-30T16:26:01.957

尽管你们中的大多数人表示不应该编写自己的内存管理器，但在以下情况下它仍然很有用：

*   您有特定的要求或情况，您确信可以编写更快的版本
*   您想编写自己的内存覆盖逻辑（以帮助调试）
*   你想跟踪内存泄漏的地方

如果你想编写自己的内存管理器，将其拆分为以下 4 个部分很重要：

1.  “拦截”对 malloc/free (C) 和 new/delete (C++) 的调用的部分。这对于 new/delete（只是全局 new 和 delete 运算符）非常容易，但对于 malloc/free 这也是可能的（“覆盖”CRT 的功能，重新定义对 malloc/free 的调用，...）
2.  代表内存管理器入口点的部分，由“拦截器”部分调用
3.  实现实际内存管理器的部分。可能你会有多个实现（视情况而定）
4.  用调用堆栈、覆盖区域（又名红色区域）等信息“装饰”分配的内存的部分

如果这 4 个部分被清楚地分开，也很容易将一个部分替换为另一个部分，或者添加一个新部分，例如：

*   添加 Intel Tread Building Blocks 库的内存管理器实现（到第 3 部分）
*   修改第 1 部分以支持新版本的编译器、新平台或全新的编译器

我自己编写了一个内存管理器，我只能指出，用一种简单的方法来扩展你自己的内存管理器真的很方便。例如，我经常要做的是在长时间运行的服务器应用程序中查找内存泄漏。使用我自己的内存管理器，我这样做：

*   启动应用程序并让它“热身”一段时间
*   要求您自己的内存管理器转储已用内存的概览，包括调用时的调用堆栈
*   继续运行应用程序
*   进行第二次转储
*   在调用堆栈上按字母顺序对两个转储进行排序
*   查找差异

尽管您可以使用开箱即用的组件做类似的事情，但它们往往有一些缺点：

*   他们经常严重拖慢应用程序
*   通常他们只能在应用程序结束时报告泄漏，而不是在应用程序运行时

但是，也要现实一点：如果您对内存碎片、性能、内存泄漏或内存覆盖没有问题，那么就没有真正的理由编写自己的内存管理器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T18:34:07.450

曾经有优秀的 VC++ 的第三方 drop-in heap 替换库，但我不记得名字了。当我们开始使用它时，我们的应用程序得到了 30% 的加速。

编辑：它是[SmartHeap](http://www.microquill.com/) - 谢谢，ChrisW

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T18:42:16.717

是 MicroQuill 的 SmartHeap 吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T19:54:37.943

根据我的经验，**当您不断分配和释放大缓冲区**（如超过 16k）时，碎片主要是一个问题，因为如果堆无法为其中一个找到足够大的位置，这些最终会导致内存不足.

在这种情况下，只有那些对象应该有特殊的内存管理，其余的保持简单。如果它们始终具有相同的大小，则可以使用缓冲区重用，如果它们的大小不同，则可以使用更复杂的内存池。

默认堆实现应该没有任何问题，可以在先前分配之间找到较小缓冲区的位置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T18:45:16.820

> 您选择编写自己的自定义内存管理器来从虚拟地址空间分配内存，还是允许 CRT 控制并为您进行内存管理？

标准库通常足够好。如果不是那么，而不是替换它，一个较小的步骤是覆盖特定类，而不是所有类`operator new`。`operator delete`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-23T19:13:30.630

这在很大程度上取决于您的内存分配模式。根据我的个人经验，一个项目中通常有一两个类在内存管理方面需要特别考虑，因为它们经常在您花费大量时间的代码部分中使用。可能还有一些类在某些特定上下文中需要特殊处理，但在其他上下文中可以使用而无需担心。

我经常最终在 std::vector 或类似和明确的东西中管理这些对象，而不是覆盖类的分配例程。在许多情况下，堆确实是矫枉过正，并且分配模式是如此可预测，以至于您不需要在堆上分配，而是在一些更简单的结构中从堆中分配更大的页面，其簿记开销比在上分配每个实例堆。

这些是需要考虑的一些一般性问题：

首先，快速分配和销毁的小对象应该放在堆栈上。最快的分配是那些从未完成的分配。堆栈分配也是在没有任何全局堆锁定的情况下完成的，这对多线程代码很有好处。与像 java 这样的 GC 语言相比，在 c/c++ 中的堆上分配可能相对昂贵，所以除非你需要它，否则尽量避免它。

如果你做了很多分配，你应该小心线程性能。一个经典的陷阱是字符串类，它倾向于对用户隐藏很多分配。如果您在多个线程中进行大量字符串处理，它们最终可能会为堆代码中的互斥锁而争吵。为此，控制内存管理可以大大加快速度。切换到另一个堆实现通常不是这里的解决方案，因为堆仍然是全局的，并且您的线程会为此而战。我认为谷歌有一个在多线程环境中应该更快的堆。自己没试过。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T18:36:35.433

我不会。

我写出比 CRT 更好的代码的机会很渺茫，谁知道每年有多少人投入它。

我会寻找一个专门的图书馆，而不是重新发明轮子。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-01-26T15:13:59.967

一些开源软件（例如 doxygen）使用了一种解决方案，其想法是在超出特定内存量时将一些实例存储到文件中。并在需要时从文件中获取数据。

# python - 在 Python 中创建“运行器”脚本的最佳方法是什么？

> ID：473961
> 
> 赞同：3
> 
> 时间：2009-01-23T18:30:25.740
> 
> 标签：python, metaprogramming

我在一个目录中有一堆 Python 模块，它们都是派生类。我需要一个“运行器”脚本，对于每个模块，实例化其中的类（实际的类名可以由模块文件名构建），然后在每个模块上调用“go”方法。

我不知道那里有多少模块，但我可以通过“bot_*.py”之类的方式列出所有模块

我认为这是关于“元编程”的东西，但怎么可能是最好（最优雅）的方式呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T18:43:50.473

您可以使用[`__import__()`](http://docs.python.org/library/functions.html#__import__)加载每个模块，使用[`dir()`](http://docs.python.org/library/functions.html#dir)查找每个模块中的所有对象，查找所有类对象，实例化它们，然后运行该`go()`方法：

```
import types
for module_name in list_of_modules_to_load:
    module = __import__(module_name)
    for name in dir(module):
        object = module.__dict__[name]
        if type(object) == types.ClassType:
            object().go() 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-23T20:00:25.327

```
def run_all(path):
    import glob, os
    print "Exploring %s" % path
    for filename in glob.glob(path + "/*.py"):
        # modulename = "bot_paperino"
        modulename = os.path.splitext(os.path.split(filename)[-1])[0]
        # classname = "Paperino"
        classname = modulename.split("bot_")[-1].capitalize()
        # package = "path.bot_paperino"
        package = filename.replace("\\", "/").replace("/", ".")[:-3]
        mod = __import__(package)
        if classname in mod.__dict__[modulename].__dict__.keys():
            obj = mod.__dict__[modulename].__dict__[classname]()
            if hasattr(obj, "go"):
                obj.go()

if __name__ == "__main__":
    import sys
    # Run on each directory passed on command line
    for path in sys.argv[1:]:
        run_all(sys.argv[1]) 
```

你需要`__init__.py`在你想要“运行”的每条路径中都有一个。随意更改“bot_”。在 windows 和 linux 上运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T18:49:37.450

这是我想到的一种方法，我必须稍微假设一下模块的结构：

```
主目录/
  跑步者.py
  包裹/
    __init__.py
    bot_moduleA.py
    bot_moduleB.py
    bot_moduleC.py
```

在跑步者中，您可以找到以下内容：

```
 import types
import package

for moduleName in dir(package):
  module = package.__dict__[moduleName]
  if type(module) != types.ModuleType:
    continue

  for klassName in dir(module):
    klass = module.__dict__[klassName]
    if type(klass) != types.ClassType:
      continue
    klass().go() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T19:35:36.607

我会尝试：

```
import glob
import os

filelist = glob.glob('bot_*.py')
for f in filelist:
    context = {}
    exec(open(f).read(), context)
    klassname = os.path.basename(f)[:-3] 
    klass = context[klassname]
    klass().go() 
```

这只会运行与模块名称类似的类，我认为这是你想要的。它也不需要顶级目录是一个包。

请注意 glob 返回完整路径，包括前面的目录，因此使用 os.path.basename(f)[:-3] 来获取类名。

# delphi - 我的应用程序中来自组件的非常奇怪的错误

> ID：473966
> 
> 赞同：0
> 
> 时间：2009-01-23T18:31:52.803
> 
> 标签：delphi, access-violation, save-dialog

好的，我的应用程序完成了它应该做的所有事情，并且每次都做同样的事情，所以它好像测试已经过去了，没有那么麻烦。

它并不总是“有时”崩溃。当我将鼠标悬停在我最近输出的打开文件对话框中的文件上时，它会执行此操作。不是立即等待大约半秒到一秒，我知道那是 openfiledialog 显示文件大小和创建时间以及它是什么类型的文档等数据的时候..（标准）鼠标悬停信息.. 事情这是使用“opendialog”，我没有写这段代码所以这个错误不是我做的吗？？？？？？如果是如何，如果不是如何/我该怎么做才能阻止它..

错误类型是“地址违反访问”...

打开的文件对话框没有过滤器，并且与组件托盘完全一样，并且在我调用“opendialog.execute”后崩溃

我最初认为它可能仍在写入，但在我停止应用程序打开任何新文件后它继续，直到最后一个完成保存过程。

正如我所说，它甚至不会一直 100% 发生，而且它不是特定于机器的.. 在 3 台不同的 win xp 电脑上崩溃。

帮助！！

额外的; 发现我可以打开并运行该文件，只要我不在我创建的文件上弹出提示框，一切都很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T19:23:30.970

在表单上放置一个**TApplicationEvent**组件并为**OnHint**事件添加一个事件处理程序。然后在那里放一个断点，看看你是否可以在它崩溃之前打破它（正如你所说，当它试图显示提示时听起来它正在崩溃）。*然后您可以使用调试 DCU*进行编译并跟踪并查看它崩溃的原因。

我的猜测是您可能仍然有一个文件句柄，该文件句柄可能在文件上具有*排他锁*。检查您的文件句柄并确保您正确关闭它们。如果您在程序运行时尝试*从记事本打开其中一个文件，会发生什么情况？*

间歇性行为可能与导致文件句柄泄露的错误条件下的不同代码路径有关。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T18:48:37.467

打开文件对话框基本上是一个资源管理器实例。这意味着您安装的每个 shell 扩展也会被加载。这样做的一个问题是，一旦您使用打开文件对话框，每个 shell 扩展也使用您的堆栈来存储变量/返回地址，......如果您的堆栈不够大，这可能会导致崩溃。

尝试增加应用程序的堆栈大小。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-23T21:44:58.593

访问冲突很可能根本与打开的对话框无关。我强烈建议您查看您的代码并确保您没有覆盖内存边界 - 如果您使用动态数组检查并确保您没有访问其边界之外的元素；如果您手动分配内存，同样的事情。

如果您还没有使用 FastMM，请使用它。它有一些很好的内存完整性检查。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-23T18:52:00.893

我建议您将调试器附加到该进程，并找出导致程序崩溃的确切原因。[这](http://www.google.si/search?q=delphi+debugger)应该让你开始......

# lisp - 计算列表长度的尾部优化函数的最佳方法是什么？

> ID：473967
> 
> 赞同：2
> 
> 时间：2009-01-23T18:31:57.377
> 
> 标签：lisp, stack, tail-recursion

这是一个论坛发帖人给出的一个例子，我不知道这个尾巴是否优化了。另外，有人可以外行描述尾部优化版本如何胜过普通版本。

```
(defun mylength (s)
  (labels ((mylength-inner (s x)
            (if (car s) (mylength-inner (cdr s) (+ x 1)) x)))
          (mylength-inner s 0))) 
```

非尾部优化版本？

```
(defun l (s) (if (car s) (+ 1 (l (rest s))) 0)) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T18:52:44.417

如果函数返回对自身的直接调用或不返回对自身的调用，则可以对函数进行尾调用优化。函数 mylength-inner 将返回`x`or `(mylength-inner (cdr s) (+ x 1))`，因此它可以进行尾部优化。

这意味着编译器可以把它变成一个循环，而不是递归地调用函数。要么返回 x，要么将 (cdr s) 分配给 s，增加 x，然后从顶部重新开始。（Scheme 标准要求实现可以做这个优化，而 Common Lisp 标准则留给实现。当然，这个优化是非常有用的东西，所以大多数实现都会这样做。）

在非优化版本中，l 不仅返回对 l 的调用，而是返回对 l 的调用并添加一个的结果。这意味着它不能直接变成循环，因此必须进行所有函数调用。

假设编译器想把 l 变成一个循环。将 (rest s) 分配给 s 没有问题，但它把`(1 + ...)`?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T18:51:45.433

尾调用可以优化为不需要调用堆栈上的额外空间，并且它要求函数中的最后一个操作是递归调用，这在您的论坛来源示例中似乎就是这种情况。非尾版本的最后一个操作是加法，所以递归调用需要自己的栈帧。

这遵循一个简单的模式，定义一个内部函数，除了外部函数参数之外，它还接受一个累加器参数，并在你进行时累积你的答案。当你到达终点时，产生累计值。

这里可能有更好的解释：

[http://mitpress.mit.edu/sicp/full-text/book/book-ZH-11.html#%_sec_1.2.1](http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-11.html#%_sec_1.2.1)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T19:43:38.760

FWIW，CL 不保证它会优化尾调用；这取决于实施。SBCL 支持它。这与 Scheme 不同，后者的规范要求编译器消除尾调用。如果你不这样做，你就不是 Scheme。

此外，尾递归在 CL 中相当不习惯。我们有一个`loop`宏，所以使用它:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T21:22:39.067

Scheme 的“教科书”列表长度示例如下：[http](http://www.scheme.com/tspl3/start.html#./start:h8) ://www.scheme.com/tspl3/start.html#./start:h8搜索“长度”。

# python - 用python打乱一个数组，用python随机化数组项顺序

> ID：473973
> 
> 赞同：319
> 
> 时间：2009-01-23T18:34:29.633
> 
> 标签：python, arrays, random, shuffle

用 python 打乱数组的最简单方法是什么？

* * *

## 回答 #1

> 赞同：567
> 
> 时间：2009-01-23T18:37:27.630

```
import random
random.shuffle(array) 
```

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2009-01-23T18:38:14.663

```
import random
random.shuffle(array) 
```

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2017-07-24T03:30:35.220

使用[sklearn执行此操作的替代方法](http://scikit-learn.org/stable/modules/generated/sklearn.utils.shuffle.html)

```
from sklearn.utils import shuffle
X=[1,2,3]
y = ['one', 'two', 'three']
X, y = shuffle(X, y, random_state=0)
print(X)
print(y) 
```

输出：

```
[2, 1, 3]
['two', 'one', 'three'] 
```

优点：您可以同时随机多个数组，而不会中断映射。并且“random_state”可以控制可再现行为的改组。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2011-12-20T22:05:30.333

`random.shuffle`其他答案是最简单的，但是该方法实际上并没有返回任何东西有点烦人 - 它只是对给定的列表进行排序。如果你想链接调用或者只是能够在一行中声明一个洗牌的数组，你可以这样做：

```
 import random
    def my_shuffle(array):
        random.shuffle(array)
        return array 
```

然后您可以执行以下操作：

```
 for suit in my_shuffle(['hearts', 'spades', 'clubs', 'diamonds']): 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2017-03-29T18:37:02.850

万一您想要一个新数组，您可以使用`sample`：

```
import random
new_array = random.sample( array, len(array) ) 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-10-28T09:23:27.887

在处理常规 Python 列表时，`random.shuffle()`将像前面的答案所示那样完成工作。

但说到`ndarray`( `numpy.array`)，`random.shuffle`似乎打破了原来的`ndarray`. 这是一个例子：

```
import random
import numpy as np
import numpy.random

a = np.array([1,2,3,4,5,6])
a.shape = (3,2)
print a
random.shuffle(a) # a will definitely be destroyed
print a 
```

只需使用：`np.random.shuffle(a)`

像`random.shuffle`,`np.random.shuffle`就地打乱数组。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-09-21T18:37:26.350

您可以使用随机键对数组进行排序

```
sorted(array, key = lambda x: random.random()) 
```

键只被读取一次，因此在排序期间比较项目仍然有效。

但看起来`random.shuffle(array)`会更快，因为它是用 C 编写的

这是 O(log(N)) 顺便说一句

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-11-18T09:55:16.463

除了前面的回复，我想介绍另一个功能。

`numpy.random.shuffle`以及`random.shuffle`执行就地洗牌。但是，如果你想返回一个混洗数组`numpy.random.permutation`是要使用的函数。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-01-17T11:09:47.937

我不知道我用过`random.shuffle()`，但它返回“无”给我，所以我写了这个，可能对某人有帮助

```
def shuffle(arr):
    for n in range(len(arr) - 1):
        rnd = random.randint(0, (len(arr) - 1))
        val1 = arr[rnd]
        val2 = arr[rnd - 1]

        arr[rnd - 1] = val1
        arr[rnd] = val2

    return arr 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-11-14T15:41:58.470

```
# arr = numpy array to shuffle

def shuffle(arr):
    a = numpy.arange(len(arr))
    b = numpy.empty(1)
    for i in range(len(arr)):
        sel = numpy.random.random_integers(0, high=len(a)-1, size=1)
        b = numpy.append(b, a[sel])
        a = numpy.delete(a, sel)
    b = b[1:].astype(int)
    return arr[b] 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-02-21T14:01:37.643

请注意，`random.shuffle()`不应在多维数组上使用它，因为它会导致重复。

假设您想沿其第一个维度打乱数组，我们可以创建以下测试示例，

```
import numpy as np
x = np.zeros((10, 2, 3))

for i in range(10):
   x[i, ...] = i*np.ones((2,3)) 
```

因此，沿第一个轴，第 i 个元素对应于一个 2x3 矩阵，其中所有元素都等于 i。

如果我们对多维数组使用正确的洗牌函数，即`np.random.shuffle(x)`，数组将根据需要沿第一个轴洗牌。但是，使用`random.shuffle(x)`会导致重复。您可以通过在改组后运行来检查这一点，`len(np.unique(x))`这会给您 10（如预期的那样），`np.random.shuffle()`但在使用`random.shuffle()`.

# svn - 更改 Xcode 以使用自定义安装的 Subversion 版本

> ID：473977
> 
> 赞同：0
> 
> 时间：2009-01-23T18:35:59.893
> 
> 标签：svn, xcode

有谁知道如何更改 Xcode IDE 中使用的 svn 工具的位置？

我已经安装了一个较新的版本`/opt/subversion/bin`并更新了我的`$PATH`，以便它可以从命令行工作，但无法让 Xcode 识别这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T18:45:56.350

据我所知，Xcode 将其 Subversion 路径硬编码为`/usr/lib/`前缀。您可以对它们进行符号链接（[如此处所述](http://www.lemonteam.com/blog/2008/12/setting-up-subversion-15-on-xcode/)）或复制它们（[参见此处](http://www.talentgrouplabs.com/blog/archive/2008/12/02/xcode-3.1.2-and-subversion-1.5.x-compatibility.aspx)）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-24T19:58:20.773

Mac OS X 中的应用程序不是从 shell 运行的，因此它们不会了解 shell 变量。只是`$PATH`在你的`.bashrc`或`.cshrc`任何东西中添加一些东西根本不会告诉应用程序。

此外，Xcode 3.0 及更高版本直接支持 Subversion，而不是通过其命令行二进制文件调用；这意味着它将使用其中的 Subversion 库，`/usr/lib`而不是您在其他地方安装的任何库。

# bash - 在bash中提取所有匹配的子字符串

> ID：473979
> 
> 赞同：4
> 
> 时间：2009-01-23T18:36:21.533
> 
> 标签：bash, shell

在 bash 中寻找解决方案（将成为更大脚本的一部分）。

给定一个包含表单信息的变量

```
diff -r efb93662e8a7 -r 53784895c0f7 diff.txt
--- diff.txt 2009 年 1 月 23 日星期五 14:48:30 +0000
+++ b/diff.txt 2009 年 1 月 23 日星期五 14:49:58 +0000
@@ -1,9 +0,0 @@
-diff -r 9741ec300459 myfile.c
---- myfile.c 2008 年 8 月 21 日星期四 18:22:17 +0000
-+++ b/myfile.c 2008 年 8 月 21 日星期四 18:22:17 +0000 -@@ -1,4 +1,4 @@
- int myfunc()
- {
-- 返回 1；
-+ 返回 10；
- }

```

我希望将两个文件名（此处为 diff.txt 和 myfile.c，但未来的情况将不限于此数量）提取为格式为“edited: filename1 filename2 ... filenameN”的字符串。

为了澄清，我希望将多个匹配的文件名提取到一个字符串中。

*   命令 "$(expr "$editing" : '.*---[[:space:]]\([[:graph:]]*\)[[:space:]]')" 返回最后一个文件名正确但不是以前的实例。

编辑：需要能够识别已编辑的文件名（可能包括空格），即出现在“---”之后和“Fri/Thu...”之前的文件名。

感谢您的帮助（到目前为止，许多人已经回复了）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T22:44:29.363

仅使用 bash 内置程序，没有外部程序的解决方案是：

```
res="edited: "; var="${var#* --- } --- "
while test -n "$var";do res="$res ${var%% *}"; var="${var#* --- }";done
echo "$res" 
```

它迭代所有出现的“---”。诀窍是通过首先从头开始修剪垃圾（直到第一个 ---）并在末尾附加一个“---”来准备字符串，以便之后在 while 循环中具有更简单的逻辑。

这是通过使用 bash 最有用的功能，# 和 % 来修剪字符串

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T18:57:35.560

我建议使用外部工具 - 这是 perl 的一种方法：

```
$(echo "$variable" | perl -e 'print "edited:"; while (<>) { while (/--- (\S+)/g) { print " $1"; } }') 
```

我确信它可以做得更优雅，但我现在想不出一种不需要更实质性程序的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T19:18:58.887

这是一个简单有效的解决方案：

```
txt=$(cat)
str="edited: "

for word in $txt; do
        if echo $word | grep -qi '^[a-z0-9-_]*\.[a-z]*$'; then
           str="$str $word"
        fi
done

echo $str 
```

运行它：

```
anton@CAPTAIN-FALCON ~/Desktop
$ bash sol.sh
diff -r efb93662e8a7 -r 53784895c0f7 diff.txt --- diff.txt Fri Jan 23 14:48:30 2
009 +0000 +++ b/diff.txt Fri Jan 23 14:49:58 2009 +0000 @@ -1,9 +0,0 @@ -diff -r
 9741ec300459 myfile.c ---- myfile.c Thu Aug 21 18:22:17 2008 +0000 -+++ b/myfil
e.c Thu Aug 21 18:22:17 2008 +0000 -@@ -1,4 +1,4 @@ - int myfunc() - { -- return
 1; -+ return 10; - }
edited: diff.txt diff.txt myfile.c myfile.c 
```

**编辑**：用 grep 闲逛一段时间导致了以下脚本，但我开始怀疑纯 bash 是否是适合这项工作的工具......似乎会有很多极端情况，你会错过一些文件或获取错误的文件名。

```
#! /bin/bash

rawFiles=`cat | grep -ioz ' -* [a-z0-9-_\ ]*\.[a-z]*'`

for file in $rawFiles; do
   if ! echo $file | grep -q '^-*$'; then
      files="$files${file} "
   fi
done

echo "edited: $files" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T18:46:50.763

您能否在设置 $editing 之前执行您的操作 - 那么您可能仍然有换行符？

然后也许一些 sed 将能够提取文件名。

# .net - .NET 库来访问 COM 端口？

> ID：473980
> 
> 赞同：2
> 
> 时间：2009-01-23T18:36:27.537
> 
> 标签：.net, hardware, serial-port

是否有一个库可以让我在串行 COM 端口上发送和接收数据？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-23T18:38:37.970

看[`System.IO.Ports`](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx)

# parsing - Tool or language to count occurrances of errors in a log file

> ID：473998
> 
> 赞同：0
> 
> 时间：2009-01-23T18:40:57.140
> 
> 标签：parsing, logging, text

I am trying to determine the best way to parse a log file and get a count of all of the errors in it by type. Currently, I open the log in a text editor, strip out the date and thread ID, then sort the file. This puts all errors together by type, which I can then count (using the count function in the editor, not manually). I am looking for a way to do this automatically, and possibly use this as an opportunity to learn a new language (I know minimal Perl and Ruby which seem like they may work for this task). The log file looks like (the items in angle brackets are variable for each line, while the pipes are actual characters in the log):

```
<Datetime stamp> | <Thread ID> | ERROR | Foo.Bar: Backend error
<Datetime stamp> | <Thread ID> | ERROR | Foo.Bar: InvalidUserException
<Datetime stamp> | <Thread ID> | ERROR | Foo.Com: Timeout error
<Datetime stamp> | <Thread ID> | ALWAYS | Foo.Bar: Login Transaction [584] executed in [400] milliseconds
<Datetime stamp> | <Thread ID> | ALWAYS | Foo.Bar: Login Transaction [585] executed in [500] milliseconds
<Datetime stamp> | <Thread ID> | ALWAYS | Foo.Bar: Login Transaction [586] executed in [500] milliseconds
<Datetime stamp> | <Thread ID> | ALWAYS | Biz.Dee: Logout Transaction [958] executed in [630] milliseconds
<Datetime stamp> | <Thread ID> | ERROR | Foo.Bar: Backend error 
```

I don't want to use a series of grep commands because I will have to know what to look for - if there is a new error in the log, without adding a new command, it won't get counted.

The output I am looking for is something like this:

```
Foo.Bar: Backend error: 2 occurrences
Foo.Com: Timeout error: 1 occurrence 
```

Ideally, it would be great to also have the average transaction times calculated as well:

```
Foo.Bar: Login Transaction: 3 occurrences with an average of 466 milliseconds
Biz.Dee: Logout Transaction: 1 occurrence with an average of 630 milliseconds 
```

I've seen some tools mentioned in other SO threads ([SMTP log parser](http://scriptolog.blogspot.com/2007/08/smtp-log-parsing.html), [Microsoft log parser](http://www.microsoft.com/technet/scriptcenter/tools/logparser/default.mspx), [Zabbix](http://www.zabbix.com/), and [Splunk](http://www.splunk.com/)), but I would also like to learn something new without unnecessary duplicating an existing tool. Would Perl or Ruby be a good choice for this task? I am not looking for a working script, but a few pointers in the right direction or a good tool to use.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T18:49:45.373

Perl 将是我进行字符串解析的首选。使用 RegEx，您可以立即解析该日志文件。从我所见，您似乎正在处理一个计算机可读的文件。您可以使用 Perl 哈希来进行平均。

如果您更熟悉 C# 和他们的 RegEx，您可能会做同样的事情，但是 Perl 就是为做这样的事情而构建的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T19:04:42.863

这是一个可能的 Perl 起点：

```
#! /usr/bin/perl
use strict;
use warnings;

my %unique_messages;
while (<>)
{
  my ($timestamp, $thread, $type, $message) = $_ =~
    /^
      ([^|]+) \|
      ([^|]+) \|
      ([^|]+) \|
      (.+)
     $/x;

  $unique_messages{$message}++ if $type =~ /ERROR/;
}

print $unique_messages{$_}, ' -> ', $_, "\n" for keys %unique_messages;
exit 0; 
```

产生：

```
% ec.pl < err.log
1 ->  Foo.Com: Timeout error
1 ->  Foo.Bar: InvalidUserException
2 ->  Foo.Bar: Backend error 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-23T19:02:01.450

这是一个 unix （或[Cygwin](http://www.cygwin.com/)）命令行方式：

*   一个[AWK](http://www.vectorsite.net/tsawk.html)命令（解析第 4 个字段，您的字段由管道“|”分隔）
*   用于替换上面的事务 # ([584]) 以使分组更容易的[SED命令（使用 [tid]）](http://www.grymoire.com/Unix/Sed.html)
*   sort 和 uniq 查找和计算重复行：

这是命令行：

```
awk "FS=\"^|\";{print $4}" logfile.txt | sed -e "s/\[[0-9]*\]/[tid]/g" \
| sort | uniq -c | sort 
```

这是输出：

```
 1  Biz.Dee: Logout Transaction [id] executed in [id] milliseconds
   1  Foo.Bar: Backend error
   1  Foo.Bar: InvalidUserException
   1  Foo.Com: Timeout error
   3  Foo.Bar: Login Transaction [id] executed in [id] milliseconds 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T18:58:40.550

我会使用 RegEx 并计算出现次数。你可以用无数种语言来做到这一点，即使是一个简单的 shell 脚本也能做到，例如

```
grep -E ".*ERROR.*\n" logfile | wc -l 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T18:59:07.603

如果您了解/喜欢 .NET，那么 Marc Gravell 和我开发的[Push LINQ](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)框架将是一个理想的候选者。基本上，您预先设置了所有您想要的聚合（分组、求和等），并通过它“推送”日志文件，然后在最后询问结果。这将使您可以在几乎恒定的内存消耗和单次数据传递的情况下完成所有工作。

如果您想了解更多详情，请告诉我。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T19:26:50.277

使用 awk 的另一种可能性：

```
grep ERROR filename.log | awk -F'|' '{ print $4 }' | awk -FS=':' '{count[$1]++}END{for(j in count) print j,": "count[j]" occurence(s)"}' 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T19:28:13.003

您可以使用像 monarch 这样的程序来为平面数据提供结构。我用它来获取文本文件并从中制作可以在数据库中使用的表格。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-15T05:05:40.093

微软日志解析器，如果你对 SQL 没问题。并使用 Windows。免费且非常方便。易于包装在 HTA 中，然后您可以使用 VBS 或 (?) JS 以交互方式构建查询字符串。相信它会为你做小计。当然是分类和分组。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-15T05:11:06.850

在 vim 中，您可以执行`:%s/pattern//n`where pattern 是搜索字符串。******************````