# StackOverflow 问答 000631000-000631999

# language-agnostic - 语言词汇量应该有多大？

> ID：631000
> 
> 赞同：1
> 
> 时间：2009-03-10T16:09:58.047
> 
> 标签：language-agnostic

我今天开始研究即将发布的[C++0x 规范](http://en.wikipedia.org/wiki/C%2B%2B0x)，并开始思考语言词汇的正确大小。最初，引入新关键字让我感到非常恼火。在某种程度上，我认为一种语言中关键字的数量是对其复杂性的估计。也就是说，在 C++ 的情况下，添加新结构会使掌握该语言变得更加困难。这就是为什么 K&R 的书比 C++ 的书要小得多的原因之一。

在那之后，我想到了自然语言，它的词汇量随着时间的推移呈线性增长，与语言无关 (*)。当然，唯一的例外是[Newspeak](http://en.wikipedia.org/wiki/Newspeak)，它说了很多。在这种情况下，词汇量与语言的表达能力有关。

然而，在编程语言中，您可以使用词汇量很小的表达能力很强的语言（例如，Lisp）。

**所以，要表达这个问题，在你看来，一个语言词汇应该是大而冗长还是小而简洁？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T16:40:26.180

> 语言词汇量应该有多大？

**42.**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T16:20:34.480

我不相信这里有一个真正的答案。较小是我的偏好，但我无法量化真正的小。我更希望看到一组精简的操作员没有冗余。这就像在 C# 中一样让我烦恼。它们在功能上太接近了。如果和除非在许多语言中是相同的方式。一个可以很容易地从另一个构建。

我是 Lisp 的忠实粉丝，它非常小，但即使存在语法糖（比如 ' 而不是引号）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:01:00.557

尽可能大，但没有更大？

无论如何，你的问题错过了一个明显的点。如果不使用大量关键字，语言可能会非常复杂。例如，查看`static`C++ 中的关键字。它有什么，3、4 种不同的含义？与使用 3 或 4 个不同的关键字相比，这是否会使语言变得不那么复杂？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T17:38:45.837

我会说尽可能少，同时最大化功能。在简洁性和复杂性之间划清界限的确切位置是非常主观的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T17:11:47.180

我喜欢具有明确扩展方法的小型语言。

（有人维基这个）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T17:12:51.703

好吧，让我们比较一下两种语言——C++ 和 Smalltalk

*   C++ - 大量保留字、复杂语法、庞大的标准文档

*   Smalltalk - 几乎没有保留字，非常简单的语法，微小的标准文档

现在看看这些语言的相对成功。我认为结论很明显——越大越好。

# apache-flex - flex - 在上传之前使用文件参考检查图像尺寸

> ID：631006
> 
> 赞同：1
> 
> 时间：2009-03-10T16:10:41.460
> 
> 标签：apache-flex, actionscript-3, filereference, filereferencelist

在我的 Flex 应用程序中，我使用了一个`FileReferenceList`用户可以在上传之前使用多个文件填充的文件`fileList.browse()`。

我检查每个文件的大小并用于`fileList[i].upload()`上传到我的服务器，这工作正常。

我怀疑这是不可能的，但在上传之前，我想将每个图像转换`FileReference`为图像，以检查它是否在某些尺寸公差范围内。

我意识到我可以做这个服务器端，但理想情况下我希望检查出现在客户端和服务器上。任何人都可以提供任何帮助吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T20:09:30.250

在 Yahoo! 上查看[这篇文章！闪存博客](http://www.yswfblog.com/blog/2008/12/22/flash-10-experiments-the-warholizer-loading-and-processing-local-images/)。Flash 10 允许您在本地处理图像。他们提供了一个很好的示例，其中包含如何处理 FileReference 对象，特别是图像文件的代码。

# ruby-on-rails - 什么是用假数据填充 Rails 开发数据库的好方法

> ID：631007
> 
> 赞同：4
> 
> 时间：2009-03-10T16:10:41.477
> 
> 标签：ruby-on-rails

我正在远离固定装置并填充并寻找一些替代工具来用假数据填充我的开发数据库。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T16:21:54.540

[factory_girl](http://github.com/thoughtbot/factory_girl/tree/master)是我个人的最爱。语法优美，灵活。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:25:18.133

看看[伪造](http://github.com/sevenwire/forgery/tree/master)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T11:41:12.747

这里有一些关于这个主题的 railscasts：

[126 填充数据库](http://railscasts.com/episodes/126-populating-a-database)

[158工厂不是夹具](http://railscasts.com/episodes/158-factories-not-fixtures)

# ruby-on-rails - 使用 ActiveRecord has_many through 关系，我如何在保留对象的同时删除关联

> ID：631013
> 
> 赞同：3
> 
> 时间：2009-03-10T16:11:34.253
> 
> 标签：ruby-on-rails, activerecord

在 Rails 中，如何在保留以前关联的对象的同时删除 has-many through 关联？是否有 ActiveRecord 方法可以执行此操作，或者我确实需要编写 SQL？

一旦关系消失，对象是否有可能保持朋友关系？[ <--蹩脚的玩笑尝试]

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T16:52:19.333

自己找到的。 [collections.delete](http://apidock.com/rails/ActiveRecord/Associations/ClassMethods/has_many)并且只需要确保未将依赖项设置为删除或销毁。不知何故，公开问这个问题似乎让我自己在大约 10 分钟内找出答案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-28T19:02:24.373

> 不知何故，公开问这个问题似乎让我自己在大约 10 分钟内找出答案。

那是因为把它写下来会穿越一条不同的神经通路，这条神经通路显然在你的脑海中还有其他的联系/关联。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-30T14:21:19.187

```
Class A  < ActiveRecord::Base
  has_many :b
end

Class B  < ActiveRecord::Base
  belongs_to :a
end 
```

Abdelete - 删除关联

Abdestroy - 删除关联对象 (b)

# c++ - 更改 CMFCToolbar 中菜单按钮的图像

> ID：631014
> 
> 赞同：10
> 
> 时间：2009-03-10T16:11:59.460
> 
> 标签：c++, mfc, mfc-feature-pack

我在 a 中有一个菜单按钮`CMFCToolbar`，每次在菜单中选择不同的条目时，我想替换按钮的位图，因为每个条目都有自己的图标。

我成功地使用`CMFCToolBarMenuButton::SetImage`了更改图标，但它也更改了菜单条目中的图标。太糟糕了。

[替代文字 http://www.freeimagehosting.net/uploads/137269b0f2.jpg](http://www.freeimagehosting.net/uploads/137269b0f2.jpg) [替代文字 http://www.freeimagehosting.net/uploads/879d03843a.jpg](http://www.freeimagehosting.net/uploads/879d03843a.jpg)

这是一个代码示例：

```
if ( (pToolbar != NULL) && (idBase != 0) )
{
    int ixButtonToReplace                   = pToolbar->CommandToIndex(idBase);
    CMFCToolBarMenuButton* pBtnToReplace    = dynamic_cast<CMFCToolBarMenuButton*>
                                                (pToolbar->GetButton(ixButtonToReplace));
    if ( pBtnToReplace )
    {
        const CObList& listCommands = pBtnToReplace->GetCommands();
        POSITION pos                = listCommands.GetHeadPosition();
        while ( pos != NULL )
        {
            CMFCToolBarMenuButton* pItem = (CMFCToolBarMenuButton*) listCommands.GetNext(pos);
            if ( pItem && (pItem->m_nID == idButtonToReplaceWith) )
            {
                pBtnToReplace->SetImage(pItem->GetImage());
            }
        }
    }
} 
```

有任何想法吗？谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-05-30T11:50:23.660

它开箱即用。您唯一需要的是调用`CMFCToolBar::AddToolBarForImageCollection`，以便 MFC 知道要使用哪些图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-31T14:25:04.120

不确定菜单按钮的意思也改变了？

如果使用单个 setImage 调用更改另一个按钮，则明显表明它们共享某种资源 ID，唯一的解决方案是确保它们具有不同的 ID（这需要确保两个资源分别处理）。但是自从我弄乱了 MFC 资源文件来确认这一点以来，已经有很长时间了。

# filesystems - 如何在 WIN 2000 服务器上监视锁定的文件

> ID：631015
> 
> 赞同：1
> 
> 时间：2009-03-10T16:12:07.027
> 
> 标签：filesystems, system-administration, windows-server-2000, locked-files

我很想知道在win 2000 服务器上监视锁定文件/打开文件句柄的最佳方法是什么。我对一般系统报告感兴趣，它可以显示锁定的文件或句柄随着时间的推移（例如在一晚的过程中），而不必指定要专门监视哪些进程。

谢谢，阿迪

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T16:17:40.273

[Sysinternals](http://technet.microsoft.com/en-us/sysinternals/0e18b180-9b7a-4c49-8120-c47c5a693683.aspx)是 Windows 管理员最好的朋友。也许您可以编写一些包装[Handle](http://technet.microsoft.com/en-us/sysinternals/bb896655.aspx)程序的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T21:54:42.670

好，

经过一些研究，似乎最好的 sysinternals 工具是[File Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)。虽然包装 Handle 程序（如这里所建议的那样）可以工作，但 File Monitor 为此目的提供了一个完全可定制的 GUI。

文件监视器被 WIN2000 SP4 之后的操作系统版本的[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)取代，但由于我必须监视早期版本，文件监视器绝对是要走的路。

# .net - 如何在宿主应用程序代码中访问公共工作流属性？

> ID：631024
> 
> 赞同：1
> 
> 时间：2009-03-10T16:12:37.620
> 
> 标签：.net, workflow, workflow-foundation

我有一个具有公共“状态”属性的工作流，该属性返回一个存储有关工作流的数据的自定义类（它在工作流的执行过程中发生变化）。

在工作流主机（在本例中为 ASP.NET 应用程序）的代码中，获取该属性值的最佳模式/实践是什么？

我查看了 CallExternalMethodActivity，但我排除了它，因为在我的情况下，我需要某种“按需”模型，我可以在其中请求我的工作流在它执行的任何时间点给我它的属性值.

我还研究了跟踪服务，但由于我并不真正关心跟踪任何事件，因此整个跟踪模型似乎存在开销，并且当数据已经是跟踪存储的一部分时，将数据保存到跟踪存储也存在重复性工作流程。

任何建议/代码示例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T15:48:17.410

Matt Milner 有一篇[非常好的文章](http://www.pluralsight.com/community/blogs/matt/archive/2006/11/25/42637.aspx)，其中包含一个工作示例。他正在使用为您完成这项工作的自定义跟踪服务，因此您无需弄乱跟踪配置文件等。

确保您还阅读了文章用户评论，因为它们包含有关持久工作流的一些重要信息。

# css - 是否可以使用另一个样式表来设置 div（及其子项）的样式？

> ID：631027
> 
> 赞同：1
> 
> 时间：2009-03-10T16:13:17.680
> 
> 标签：css

我正在尝试显示打印预览 div（`#preview`在示例中）。有没有办法`print.css`只用于特定的 div 及其覆盖所有本地定义的子项？

本质上，我希望能够做类似的事情：

```
#preview element {
    definition equal to definition of an element in print.css
} 
```

在 main.css 中，但对于一长串定义。它不太干燥，以下选项更加连贯。

第二种方法是包含`print.css`在主文档中并从

```
element {
    definition
} 
```

至：

```
element, #preview element {
     definition
} 
```

但这在我看来有点麻烦。
解决这个问题的最佳方法是什么？

**更新**只是举个例子：
在主文档中我有红色下划线的链接，在印刷版中它们应该是蓝色的未装饰。因此，当动态形成预览内容时，我会弹出所有链接都应为蓝色未装饰的 div。但只有在那个特定的 div ( `#preview`) 中，在文档的其余部分中，它们仍然是红色的并带有下划线。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T16:59:05.777

也许我还没有理解你的问题，但似乎你应该能够通过简单地将 print.css 样式表链接到主样式表之后，并在 print.css 中的所有选择器前面加上“#preview”来做到这一点。

在链接示例中，您需要指定如下样式：

```
#preview a, #preview a:link 
{
    text-decoration:none;
    color:blue;
} 
```

除非您动态创建 print.css 文件，否则这应该非常简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:16:17.720

也许使 div 成为一个 iframe，其中包含 print.css 样式的不同页面

或者，您可以将 print.css 标记上的媒体设置为“打印”，但在打印预览期间，您可以让脚本将媒体更改为“全部”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:00:54.587

```
<link rel="stylesheet" href="/main.css" type="text/css">
<link rel="stylesheet" href="/print.css" type="text/css">
</head>
<body>
<div id="main">
content
</div>

main.css:
selector1 {style}
selector2 {style}
and so on

print.css:
#print selector1 {style}
#print selector2 {style}
and so on 
```

然后，当您生成打印预览时，只需（通过 JavaScript 或其他方式）将主包装器的 id 从“main”更改为“print”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-19T17:24:12.660

将此添加到您的样式表中：

```
@media print {
  #preview a:link {
    color:blue;
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T17:17:03.173

我记得，一个更具体的 CSS 声明总是会覆盖一个不太具体的声明，除非不太具体的声明被标记为重要。

所以......`#preview element { }`将永远覆盖`element { }`

# sql - 从 sqlserver 检索最大记录

> ID：631028
> 
> 赞同：0
> 
> 时间：2009-03-10T16:13:26.727
> 
> 标签：sql, sql-server

我已经为此苦苦挣扎了一段时间。所以决定询问并获得一些帮助。

我有两个这样的表：

```
tblTrans: (DocNumber field is always unique)

DocNumber       TransDate      userId
66-FF-GHIP      03-05-08       someUser
55-RT-JHTP      03-09-09       someOtherUser
77-AF-KPWT      05-08-09       userId1
09-IO-TEAG      04-08-09       thisUser

tblTransDet: (productIdCode field + DocNumber fields are always unique)
DocNumber       ProductIdCode      TransStatus   
66-FF-GHIP      4124               Approved
66-FF-GHIP      2124               Pending
66-FF-GHIP      2340               Approved
77-AF-KPWT      4124               Approved
55-RT-JHTP      4124               Pending
09-IO-TEAG      2124               Pending 
```

如你看到的。ProductIdCode 4124 在 tblTransDet 中重复多次，但 productIdCode 和 DocNumber 的组合始终是唯一的。

我如何检索 docnumber 和 productID ...基于具有最高 transDate 的 docNumber。

所以在这个例子中。最终结果将是

```
77-AF-KPWT    4124
09-IO-TEAG    2124
66-FF-GHIP    2340 
```

如果可以的话，我会更改表格结构:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T16:21:54.943

使用相关子查询 - 这是未经测试的：

```
SELECT
   d.DocNumber, d.ProductId, t.TransDate
FROM
   tblTransDet d, tblTrans t
WHERE
   d.DocNumber = t.DocNumber
AND
   t.TransDate = (SELECT MAX( TransDate) FROM tblTrans
                   WHERE DocNumber = d.DocNumber) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T16:20:05.743

你可以使用子查询

```
WHERE Detail.Date = (SELECT MAX(Date) FROM TransDet) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:29:21.993

```
SELECT  *
FROM    (
        SELECT  d.DocNumber, d.ProductId, t.TransDate,
        ROW_NUMBER() OVER (PARTITION BY d.DocNumber, d.ProductId ORDER BY TransDate DESC) AS rn
        FROM   tblTransDet d, tblTrans t
        WHERE  t.DocNumber = d.DocNumber
        )
WHERE rn = 1 
```

# google-app-engine - Python tzinfo 和夏令时

> ID：631035
> 
> 赞同：4
> 
> 时间：2009-03-10T16:14:37.693
> 
> 标签：google-app-engine, timezone, dst

（我是 Python 和 Google App Engine 的新手，如果我的问题看起来很基础，请原谅我）。

我正忙着在我的 Google App Engine 应用程序中管理多个用户时区。

这是我的限制：

1.  如果用户在输入中输入时间，它将是本地时间（包括 DST，在适当的时候）。
2.  如果用户没有输入时间，系统必须为他们输入当地时间（包括 DST，在适当的时候）。
3.  当向用户显示日期和时间时，它必须是他们的本地时间（包括 DST，在适当的时候）

我知道时间将在内部存储为带有 tzinfo 对象的 UTC，并且 App Engine 将使用 UTC 时间存储模型。

我以前认为我已经通过要求用户在他们的偏好中指定他们的时区来解决这一切。然后，我只需加载他们的首选项并将该 tzinfo 添加到引用该用户的任何日期时间对象中。

然而，我们最近的夏令时打破了它。事实证明，我没有在我的 tzinfo 对象中正确实现 dst() 。据我了解，我必须确定 DST 当前是否打开，如果是，则返回 tzinfo 的正确偏移量。

问题是，我不知道如何确定时区的夏令时是否是当前时间。我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T16:21:35.100

如果可以的话，我建议你看看这个`python-dateutil`包，它为所有时区预先构建了 tz 对象，包括 DST 偏移信息。我认为没有办法在没有支持数据的情况下“只知道”DST 是否开启......它是大多数时区（或至少支持 DST 的时区）的日期驱动，并且日期因当地而异风俗、政治和各种事物。

[http://labix.org/python-dateutil](http://labix.org/python-dateutil)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T21:24:29.833

我在这里看到了一些问题。

如果用户输入时间，它是在本地时区输入的，但是你怎么知道它是哪一个呢？欧洲/维尔纽斯还是欧洲/马德里？或者也许是澳大利亚/墨尔本？如果您不知道时区，日期/时间就会变得“幼稚”。

唯一被认为*合适且准确*的时区数据库（考虑到不断变化的状态）是 Olson timezone db，可用于 Python 作为[pytz](http://pytz.sourceforge.net/)包。它允许在时区之间轻松转换日期/时间：首先您从用户那里获取日期/时间和时区，在用户的时区中本地化日期/时间，然后将其作为 utc，准备保存到您的数据库。显示是其他方式：从数据库中获取日期/时间，以 utc 本地化，然后显示为用户时区。

最后一件事：没有*自动 DST 转换*之类的东西。在日期/时间不明确的情况下，您必须提前知道输入时间的时区。这就是我们人类的现实。

# geometry - 如何找到投影矩形的 3D 坐标？

> ID：631039
> 
> 赞同：3
> 
> 时间：2009-03-10T16:16:03.180
> 
> 标签：geometry, camera, projection

我有以下主要是算法的问题。

*   设 ABCD 为已知尺寸 d1、d2 位于空间某处的矩形。
*   矩形 ABCD 投影在平面 P 上（在一般情况下形成梯形 KLMN）。我知道投影矩阵 H。
*   我还可以找到梯形边缘点 K、L、M、N 的 2D 坐标。

问题如下：

*   给定投影矩阵 H、梯形边缘的坐标以及我们的对象是具有指定几何形状（尺寸 d1、d2）的矩形的知识，我们可以计算点 A、B、C、D 的 3D 坐标吗？

我正在用一个相机抓取简单矩形的图像，我想在空间上重建矩形。我可以抓取多个图像并使用三角测量，但这不是我们所希望的。

仅投影矩阵是不够的，因为光线被投影到同一点。对象具有已知尺寸的事实使我相信问题是可以解决的并且存在有限的解决方案。

如果我弄清楚如何进行这种重建，我就会知道如何对其进行编程。所以我要求一个算法/数学答案。

欢迎任何想法谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T07:10:00.553

我将在这里给出一个相当简短的答案，但我想你会明白我的大致意思。我假设你有一个 3x4 投影矩阵 (P)，所以你应该能够通过找到 P 的正确空向量来获得相机中心：称之为 C。

一旦你有了 C，你就可以计算出与向量 CK、CL、CM 和 CN 方向相同的光线（即 C 和 K、L、M 或 N 的叉积，例如 CxK）

现在您所要做的就是计算满足以下 6 个约束的 3 个点 (u1,u2,u3)（任意假设 KL 和 KN 相邻且 ||KL|| >= ||KN|| if d1 >= d2） ：

1.  u1 位于 CK 上，即 u1.CK = 0
2.  u2 位于 CL 上
3.  u3 位于 CN
4.  ||u1-u2|| = d1
5.  ||u1-u3|| = d2
6.  (u1xu2).(u1xu3) = 0（正交性）

其中，AB = 向量 A 和 B 的点积 ||A|| = A 的欧几里得范数 AxB = A 和 B 的叉积

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:26:00.880

您需要计算投影矩阵的逆矩阵。（你的矩阵不能是单数）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T16:35:08.283

我认为这个问题会产生一组可能的解决方案，至少在 2D 中是这样。对于 2D 案例：

```
 |   
-----------+-----------
          /|\
         / | \
        /  |  \
       /---+---\VP
      /    |    \
     /     |     \
    /      |      \
   /       |       \
  /        |   --   \
 /         |    |    \
/          |    |     \ 
```

在上图中，垂直线段和水平线段将投影到视图平面 (VP) 上的同一条线上。如果你把它按比例画出来，你会看到有两条来自眼睛的光线穿过未投影线的每个端点。这条线可以在许多位置和旋转 - 想象一下将一根棍子放入圆锥体中，它可能会卡在任意数量的位置。

因此，在二维空间中，定义明确的集合中有无限数量的解。

这适用于 3D 吗？

该算法将遵循以下路线：

1.  反转投影矩阵
2.  计算通过矩形顶点的四条射线，有效地创建一个倾斜的金字塔
3.  尝试将您的矩形放入金字塔中。这是一个棘手的问题，我试图在脑海中想象金字塔中的矩形，看看它们是否能以多种方式适应。

编辑：如果你知道到物体的距离，它就会变得微不足道。

编辑 V2：

OK，令Rn为世界空间中的四条射线，即通过逆矩阵变换，用m.Rn表示，其中|Rn| 是一个。因此，矩形的四个点是：

```
P1 = aR1
P2 = bR2
P3 = cR3
P4 = dR4 
```

其中 P1..P4 是矩形圆周周围的点。由此，使用一点向量数学，我们可以推导出四个方程：

```
|aR1 - bR2| = d1
|cR3 - dR4| = d1
|aR1 - cR3| = d2
|bR2 - dR4| = d2 
```

其中 d1 和 d2 是矩形边的长度，a、b、c 和 d 是未知数。

现在，可能无法解决上述问题，在这种情况下，您需要将 d1 与 d2 交换。您可以将每一行展开为：

(a.R1x - b.R2x) ² + (a.R1y - b.R2y) ² + (a.R1z - b.R2z) ² = d1 ²

R1在哪里？和R2？是光线 1 和 2 的 x/y/z 分量。请注意，您在上面求解的是 a 和 b，而不是 x,y,z。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T16:53:02.263

投影矩阵同时封装了透视和比例，因此逆矩阵将为您提供所需的解决方案。我认为您假设它仅包含透视图，并且您需要其他东西来选择正确的比例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T16:34:18.533

m_oLogin 是对的。如果我理解您的目标，相机拍摄的图像是平面 P，对吗？如果是这样，您正在测量 2D 图像的 K、L、M、N。您需要投影矩阵的逆来重建 A、B、C 和 D。

现在我以前从来没有这样做过，但对我来说，你可能会遇到 GPS 仅使用 3 颗卫星修复时会遇到的同样问题 - 有两种可能的解决方案，一种在 P 的“后面”，一个在它的“前面”，正确的？

# sharepoint - 使用 wiki 工具而不是 Sharepoint 的客观原因？

> ID：631047
> 
> 赞同：2
> 
> 时间：2009-03-10T16:17:19.137
> 
> 标签：sharepoint, open-source, wiki, wysiwyg

## 复制

> [开发人员文档：Sharepoint 文档管理与ScrewTurn Wiki](https://stackoverflow.com/questions/587481/developer-documentation-sharepoint-document-management-vs-screwturn-wiki)

我的任务是为一个由几个不同的开发团队组成的开发组织挑选一个 wiki 工具。Sharepoint 已安装，高层管理人员更愿意使用它，但过去它仅在 PM 被迫使用时才使用。没有开发人员会使用需要共享的内容对其进行更新。我在 Sharepoint 中开发并且我喜欢它，所以我没有反对它。但是为了让它工作，我需要一些我可以让每个人都使用的东西，所以 Sharepoint 将无法工作。第一步是说服管理层为什么 Sharepoint 不起作用。我们需要典型的 wiki 功能：

所见即所得，干净的界面，易于使用，将文件附加到页面，支持用户组，开源，本地托管。（也许我现在不考虑其他人？）

谁能提供一个客观原因列表，为什么 Sharepoint 不是我们可以用来迈出第一步的解决方案？那里有很多这样的产品，所以第 2 步应该更容易。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T16:29:22.663

SharePoint 与 wiki 完全相反：wiki 是轻量级、易于使用、显而易见、快速且不会妨碍您的。

详细说明： wiki 允许您快速记下一个想法并将详细信息移动到下一页。在 SP 中，人们开始创建流程、编辑权限、工作流。

Wiki 旨在不妨碍您。SP旨在防止你做“坏事”；不管那可能是什么。Wiki 的驱动力是头脑风暴在开放空间中发挥作用，而 SP 则由 FUD 驱动：谁能看到这些信息？可以用来对付我吗？如何防止某人查看/编辑某些内容？

注意：这不是对 SP 本身的批评；这就是它在大多数组织中的使用方式。如果您查看安全设置和编辑权限，您有时会觉得公司的员工一定都曾是某个知名监狱的囚犯（或应该是）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T16:29:08.733

我完全没有 sharepoint-foo，但是我雇主的 IT 部门设置的 sharepoint 有一个 wiki，我们可以将其用于文档。那还不够好吗？在 mac 上的 firefox 中工作正常，所以我是一个快乐的露营者。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T16:24:09.463

SharePoint 在使用它的许多功能（例如 DM、WCM、工作流、协作等）时是最好的——您可以从将所有这些东西与一个通用界面一起使用的协同作用中获得很多好处。

但是，在任何一个领域，它都远非“同类最佳”应用程序 - 因此，如果您想要针对特定​​工作（例如 wiki）的产品，SharePoint 并不是功能最齐全/易于使用/删除要使用的适用产品 - 将会有产品可以更好地完成该（单一）工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T21:43:33.643

您还可以尝试查看此[问题](https://stackoverflow.com/questions/10961/have-you-used-a-wiki-in-your-project-or-group)以查看其他使用 SharePoint wiki 的体验

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-19T08:13:31.863

我使用过[MediaWiki](http://www.mediawiki.org/)、[Instiki](http://www.instiki.org/)和 Sharepoint。Sharepoint 故意无法与 firefox 一起正常工作。它的 wiki 功能是事后考虑的。各种没人用的附加功能。但它确实吸引了管理者。

[Instiki](http://www.instiki.org/)可以在不到一分钟的时间内启动并运行，[MediaWiki](http://www.mediawiki.org/)拥有您可能需要的一切。Sharepoint 惹恼了我们团队中的大多数人，因此没有人愿意使用它，这意味着丢失了很多知识。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-06T18:12:25.073

Wikis offer workflows, Document management and more too. I would disagree with those who say you can't do this in a wiki. Check out Confluence by Atlassian

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T16:27:57.410

您使用的是哪个版本的 SharePoint WSS 3.0/MOSS 2007 包括 wiki 和博客功能。

尽管 SharePoint wiki 不像大多数人那样功能丰富，但事实是，如果您的开发人员不更新 SharePoint wiki，他们很可能也不会更新任何其他类型的 wiki。

我建议创建一个 SharePoint wiki，然后实际*阅读*起始页，其中给出了*wikiwiki*的定义。我建议只对可以*快速*编写的文档使用 wiki（任何类型） ，以便开发人员可以尽快恢复开发。让结构和准确性随着时间的推移而增长。只需将事实快速输入 wiki。

# sockets - 使用单个 send() 调用发送多个数据报？

> ID：631058
> 
> 赞同：3
> 
> 时间：2009-03-10T16:20:06.337
> 
> 标签：sockets, datagram

当基于数据报的套接字（原始套接字或 UDP）与收集式发送一起使用时，所有数据都连接起来形成一个 IP 数据包。有没有办法使用一次调用发送多个数据报？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-01T09:05:58.217

但是，您正在寻找的电话`sendmmsg()`尚未实施，甚至尚未进行大量讨论。[`recvmmsg()`](http://lwn.net/Articles/334854/)您可以在最新的 2.6.3 Linux 内核中看到它的接收端孪生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T18:18:50.690

您要问的有点有趣，因为顾名思义，收集式 send() 从内存中的多个位置收集数据并将其放在一个缓冲区中，然后再发送。

因此，您有多个数据部分要发送多个数据报。为什么不通过单独的调用发送它们？

您实际上可以在数据报套接字上调用 connect() 来指定默认目标，这样您就可以 send() 或 write() 而无需每次都指定目标地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:29:32.087

我不这么认为...您希望 IP 堆栈如何推断您打算将数据包数据报放在哪里？

# c# - C# 编译器是用 C++ 编写的吗？

> ID：631059
> 
> 赞同：41
> 
> 时间：2009-03-10T16:20:12.983
> 
> 标签：c#, .net, compiler-construction, roslyn

C# 编译器是用 C++ 编写的吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-10T16:22:17.953

是的，但是有计划用 C# 编写 C# 编译器，我相信在[这个播客](http://deepfriedbytes.com/podcast/episode-27-present-and-future-of-the-csharp-language/)中已经讨论过。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-10T16:42:13.617

是的。

Mono C# 编译器是用 C# 编写的。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-10-07T05:42:22.070

.NET 框架是用 Simple Managed C (SMC) 编写的

**历史**

> 在 .NET Framework 的开发过程中，类库最初是使用名为 Simple Managed C (SMC) 的托管代码编译器系统编写的。1999 年 1 月，Anders Hejlsberg 组建了一个团队来构建当时称为 Cool 的新语言，代表“C-like Object Oriented Language”。[16] 微软曾考虑将“Cool”作为语言的最终名称，但出于商标原因选择不这样做。到 .NET 项目在 2000 年 7 月的专业开发者大会上公开宣布时，该语言已重命名为 C#，并且类库和 ASP.NET 运行时已移植到 C#。

来自：[http ://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-05-02T05:22:21.393

有一个新的（截至 2011 年底）由 Microsoft 编写的 C# 和 VB 编译器，称为[Roslyn](http://en.wikipedia.org/wiki/Microsoft_Roslyn)，分别用 C# 和 VB.NET 编写。项目页面在[这里](http://msdn.microsoft.com/en-us/roslyn)。Roslyn 编译器被编写为一个公开丰富的公共 API 的库。InfoWorld有一篇关于它的新闻文章[。](http://www.infoworld.com/d/application-development/microsofts-roslyn-reinventing-the-compiler-we-know-it-176671)

更新：截至 2014 年 4 月 3 日，Roslyn 在 Apache License 2.0 下是开源的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-10T16:42:37.470

是的 - 作为大多数 CLR。如果您想查看 CLR 和/或编译器的内部结构，我强烈推荐 Microsoft（又名 Rotor）的 Shared Source CLI：

*   [微软下载](http://www.microsoft.com/downloads/details.aspx?FamilyId=8C09FD61-3F26-4555-AE17-3121B4F51D4D&displaylang=en)
*   [维基百科](http://en.wikipedia.org/wiki/Shared_Source_Common_Language_Infrastructure)
*   [共享源内幕书](http://callvirt.net/blog/entry.aspx?entryid=b9a94d0c-761a-4d6b-bc2f-d6a5f8c1a4a7)

但是，实际上有一个用 C# 编写的编译器。我相信[Mono](http://www.mono-project.com/Main_Page)是这样写的。下载[Mono 源代码](http://ftp.novell.com/pub/mono/sources-stable/)并亲自了解。

# sqlite - 我可以在创建后将 sqlite 表中的列更改为 AUTOINCREMENT 吗？

> ID：631060
> 
> 赞同：39
> 
> 时间：2009-03-10T16:20:13.107
> 
> 标签：sqlite

建表后可以建字段`AUTOINCREMENT`吗？例如，如果您创建这样的表：

```
create table person(id integer primary key, name text); 
```

然后后来意识到它需要自动递增。我该如何修复它，即在 MySQL 中你可以这样做：

```
alter table person modify column id integer auto_increment 
```

表创建是创建列的唯一机会`AUTOINCREMENT`吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2012-05-05T17:35:48.287

您可以将内容转储到新表中：

```
CREATE TABLE failed_banks_id (id integer primary key autoincrement, name text, city text, state text, zip integer, acquired_by text, close_date date, updated_date date);

INSERT INTO failed_banks_id(name, city, state, zip, acquired_by,close_date, updated_date)
SELECT name, city, state, zip, acquired_by,close_date, updated_date
FROM failed_banks; 
```

并重命名表：

```
DROP TABLE failed_banks;
ALTER TABLE failed_banks_id RENAME TO failed_banks; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-04-26T11:13:12.017

**背景：**

> 新键在表中当前的所有键中都是唯一的，但它可能与之前从表中删除的键重叠。要创建在表的生命周期内唯一的键，请将 AUTOINCREMENT 关键字添加到 INTEGER PRIMARY KEY 声明中。

[http://www.sqlite.org/faq.html#q1](http://www.sqlite.org/faq.html#q1)

**SQLite 限制：**

> SQLite 支持有限的 ALTER TABLE 子集。SQLite 中的 ALTER TABLE 命令允许用户重命名表或向现有表添加新列。无法重命名列、删除列或在表中添加或删除约束。

[http://www.sqlite.org/lang_altertable.html](http://www.sqlite.org/lang_altertable.html)

**黑客似乎存在：**

> 看来可以设置
> 
> PRAGMA 可写模式=ON；
> 
> 然后手动更新 sqlite_master 表，将“id INTEGER PRIMARY KEY”插入到表定义的 SQL 中。我试过了，它似乎工作。但这很危险。如果你搞砸了，你会破坏数据库文件。

[http://www.mail-archive.com/sqlite-users@sqlite.org/msg26987.html](http://www.mail-archive.com/sqlite-users@sqlite.org/msg26987.html)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-10T16:22:08.657

来自[SQLite 常见问题解答](http://www.sqlite.org/faq.html#q1)

简短回答：声明为 INTEGER PRIMARY KEY 的列将自动递增

因此，当您创建表时，将该列声明为 INTEGER PRIMARY KEY，并且该列将随着每个新插入而自动递增。

或者您在事后使用 SQL 语句 ALTER 将列类型更改为 INTEGER PRIMARY KEY，但如果您自己创建表，最好在初始创建语句中进行。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-02-13T01:07:54.227

# 最简单的方法 - 只需导出和重新导入

这是可能的，而且相对容易。将数据库导出为 sql 文件。更改 SQL 文件并重新导入：

```
 sqlite3 mydata.db .dump > /tmp/backup.sql
  vi /tmp/backup.sql
  mv mydata.db mydata.db.old
  sqlite3 mydata.db
  sqlite>.read /tmp/backup.sql 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-03-22T09:31:44.893

**您可以使用 SQLite Expert Personal 4 来做到这一点：**

1）选择表格，然后转到“设计”选项卡>“列”选项卡。

2) 单击“添加”并选择新列名，然后键入 INTEGER 和 Not Null > Ok。

3) 转到“设计选项卡”中的“主键”选项卡。单击“添加”并选择刚刚创建的列。选中“自动增量”框。

4) 单击窗口右下角的“应用”。

如果您返回“数据”选项卡，您将看到包含自动生成数字的新列。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-24T03:44:13.557

虽然 Sqlite 站点为您提供了一个示例，如何使用只有三个字段的表来执行此操作，但对于 30 个字段中的一个，它会变得很讨厌。假设您有一个名为 OldTable 的表，其中包含许多字段，其中第一个是用整数填充的“ID”。制作数据库的副本以进行备份。使用命令程序点命令，

```
 .output Oldtable.txt
    .dump Oldtable
    Drop Table Oldtable; 
```

在 Microsoft Word 或类似 grep 的文本编辑器中打开 Oldtable.txt。查找并用 NULL 替换您的 Integer 字段元素。（您可能需要调整它以适合您的字段）。编辑 Create Table 行，使定义为 Integer 的字段现在是 INTEGER PRIMARY KEY AUTOINCREMENT。另存为 NewTable.txt

回到命令程序点

```
 .read NewTable.txt 
```

完毕。ID 现在是自动递增的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-10T16:52:07.087

创建 SQLite 表后，您不能更改其列。您也不能更改表以向其添加整数主键。

创建表时必须添加整数主键。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-10T16:22:33.867

是的，您安装了 phpmyadmin 吗？我相信如果您转到“结构”选项卡并沿右侧列（列出字段类型的位置）查看 - 我认为您可以在那里更改设置以使其自动递增。还有一个 SQL 查询可以做同样的事情。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-10T16:22:45.753

您可以更改表，更改列定义

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-08-29T09:25:09.040

是的，您可以创建一个自动递增的列。修改表并添加一列。请记住，它是整数主键类型。

* * *

## 回答 #11

> 赞同：-4
> 
> 时间：2011-05-23T19:22:38.407

简单的答案如下，

```
CREATE TABLE [TEST] (
  [ID] INTEGER PRIMARY KEY AUTOINCREMENT, 
  [NAME] VARCHAR(100)); 
```

你就完成了。

# java - 在自动 Eclipse 构建期间将 checkstyle 与 Ant 一起使用

> ID：631066
> 
> 赞同：1
> 
> 时间：2009-03-10T16:21:31.513
> 
> 标签：java, eclipse, ant, build-process, checkstyle

在过去的几个月里，我一直在为我们的应用程序慢慢改进 Eclipse 自动 PDE 构建过程。

我尝试的第一件事是自动化测试用例。下一步是一些脚本代码，用于为[linux](https://stackoverflow.com/questions/449983/create-rpm-package-from-ant-script-under-windows)和[windows](https://stackoverflow.com/questions/177611/is-it-possible-to-automate-the-creation-of-a-inno-setup-package-with-ant)自动生成安装程序。

现在我想在流程中添加一些静态代码分析报告。在我的公司，我们为此使用 Checkstyle。

我知道可以自动化 Checkstyle 插件，使其可以从构建过程生成报告。将 checkstyle 结果与已经生成的单元测试报告一起分发会很有用。

有没有人有一些很好的例子来说明如何以相对轻松的方式实现这一目标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T16:41:45.270

Checkstyle JAR 文件中定义了一个[Checkstyle Ant 任务。](http://checkstyle.sourceforge.net/anttask.html)按如下方式使用它：

```
<taskdef resource="checkstyletask.properties" classpath="/path/to/checkstyle-all-4.4.jar"/> 

<checkstyle config="/path/to/my/checkstyle_config.xml">
  <fileset dir="src/checkstyle" includes="**/*.java"/>
</checkstyle> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T13:48:33.240

你可能想看看像[Hudson](http://hudson-ci.org/)这样的 CI 服务器，你可以用它来自动化你的构建，并且你可以很容易地集成一些用于[FindBugs](http://findbugs.sourceforge.net/)、CheckStyle 等的插件。

# .net - 创建一个我可以拆分的 UDP 数据包

> ID：631088
> 
> 赞同：1
> 
> 时间：2009-03-10T16:25:23.423
> 
> 标签：.net, vb.net, udp, packet

我正在 vb.net 中构建一个简单的 udp lan 聊天应用程序，我想知道我应该如何拆分我的数据包。每个发送的数据包都应该有一个 id、一个用户名和来自哪里的 ip 地址，也许还有一个命令部分，比如加入或离开，以更新我的用户列表和一条短信。我想知道将所有这些放在一个简单的数据包中的最简单方法是什么，然后在收到它时轻松拆分并访问它的不同部分。谢谢。

我正在使用 UDP，因为这仅在局域网中，所以我正在广播到`*.*.*.255`

编辑：谢谢你的回答乔恩，但我已经知道了。我想知道的是最简单和最强大的方式来格式化我的数据包，使它们包括用户名、id、命令和文本消息，然后接收它的用户解密它以仅显示由哪个写入的消息用户，或者如果它是诸如加入或离开之类的命令，以显示加入的适当消息并将用户添加到列表中，例如。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T16:32:29.973

`ToByteArray`使用实例方法和静态方法创建一个适当的类`FromByteArray()`（分别用于序列化为字节数组和从字节数组解析）。然后用于[`UdpClient.Send()`](http://msdn.microsoft.com/en-us/library/08h8s12k.aspx)发送和[`UdpClient.Receive()`](http://msdn.microsoft.com/en-us/library/system.net.sockets.udpclient.receive.aspx)接收。

您可能想要使用`BinaryReader`/`BinaryWriter`和/或`BitConverter`帮助使用`ToByteArray`和`FromByteArray`方法。您可以使用 a`MemoryStream`作为快速内存流来传递给`BinaryReader`/ `BinaryWriter`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T00:43:23.903

我可能只是在 xml 中格式化数据包，然后在接收端使用 linq to xml 将其分开。您也可以使用 JSON 作为格式，但这可能会稍微难以解析。

# asp.net - 中继器 ItemDataBound 完成触发器

> ID：631091
> 
> 赞同：1
> 
> 时间：2009-03-10T16:26:21.907
> 
> 标签：asp.net, repeater

嗨，我有一个中继器，并且在 ItemDataBound 事件期间我正在做各种事情。我的中继器在一个控件中。我注意到的是 ItemDataBound 事件中应该发生的事情发生在托管控件的页面的 Page_Load 之后。有没有办法使用某种 ItemDataBoundComplete 触发器，以便在 ItemDataBound 事件发生后我可以在我的页面上做其他事情？谢谢，如果我不清楚，请告诉我。

[编辑] 我有绑定到 ItemDataBound 的控件，它们在托管控件的页面的 Page_Load 之后才可用。

[解决方案]（就我而言）：

在我的页面中，我使用了以下内容： Control.Page.LoadComplete += new EventHandler(Control_LoadComplete);

然后我执行了我在那次活动中必须做的事情。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T17:59:35.180

您还可以更改为 ListView，它在 html 中支持尽可能多的灵活性，并使用 DataBound 事件（在整个 ListView 完成数据绑定后调用）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T16:29:34.287

什么样的事情？您可以覆盖 OnPreRenderComplete 方法，该方法在页面呈现之前立即调用。

# c# - 在 C# Regex 中转义 C++ 代码

> ID：631094
> 
> 赞同：0
> 
> 时间：2009-03-10T16:27:25.027
> 
> 标签：c#, regex, code-generation

我试图使用 ac# 工具将文字字符串插入 c++ 文件，并且我的任务是自动添加转义符。

以“=> \”开头。但是我无法弄清楚将“实例转换为\”所需的正则表达式

```
 public String AddEscapeCharactersForCode(String content)
    {
        String escaper = "\\\\";
        String ncontent = Regex.Replace(content, "\\\\\"");
        ncontent = Regex.Replace(ncontent, "'", "\\\\'");
        ncontent = Regex.Replace(ncontent, "\n", "\\\\\n");
        return content;
    } 
```

上面的代码对我的字符串没有任何作用，导致未转义的引号和损坏的代码文件 =(

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T16:30:34.283

嗯，你有：

```
// ...
return content; 
```

...它只是返回传入的字符串。因此，所有这些`Regex.Replace`优点都被丢弃了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T16:53:40.750

对于这个简单的任务，您实际上并不需要正则表达式。使用[`String.Replace()`](http://msdn.microsoft.com/en-us/library/system.string.replace.aspx)很简单。

> **String.Replace**方法
> 
> 返回一个新字符串，其中在此实例中出现的所有指定 Unicode 字符或字符串都替换为另一个指定的 Unicode 字符或字符串。

```
s1 = "some \"parts\" may be \"quoted\" here"
// s1 is <some "parts" may be "quoted" here>
s2 = s.replace("\"", "\\\"")
// s2 is <some \"parts\" may be \"quoted\" here> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T16:58:03.517

If you must do it with regex, minimize the number of replacements by using a regular expression that handles backslashes and double quotes in one step.

```
public String AddEscapeCharactersForCode(String content)
{
  content = Regex.Replace(content, "[\"\\\\]", "\\$&");
  content = Regex.Replace(content, "\n", "\\n");
  return content;
} 
```

I think you have too many backslashes in your example. To me the output of the above looks right.

# expert-system - 构建决策树系统以帮助规范系统

> ID：631095
> 
> 赞同：0
> 
> 时间：2009-03-10T16:27:52.963
> 
> 标签：expert-system, decision-tree

我正在寻找一种方法来构建一个可以帮助我们的销售团队指定产品的系统。理想的系统会提出一些在所有产品中都很常见的基本问题。然后，进一步的问题将从这些答案中分支出来。据我所知，这本质上是一个我被要求构建的大型决策树/专家系统。

我想知道是否有人有构建这样一个系统的经验，可以提供一些参考或推荐一个框架/软件来支持这样一个系统？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T16:49:47.077

您可以将问题的答案用作属性值，然后根据这些属性构建决策树来对产品进行分类。你属于这种情况吗？

如果是这样，您在寻找什么？算法？看看像 ID3 这样的东西，它是一种决策树算法，可以适用于像你这样的情况。我不熟悉决策树的任何特定框架/软件。让我知道您是否可以提供有关您需要什么样的帮助的更多详细信息。

# cruisecontrol.net - 让 CC-Tray 工作

> ID：631097
> 
> 赞同：9
> 
> 时间：2009-03-10T16:27:58.783
> 
> 标签：cruisecontrol.net

我试图让 cc-tray 工作而不是使用网络仪表板。我不确定如何为我的 Cruisecontrol 运行的服务器获取正确的 url，而且我在网上找不到任何有用的文档。任何人都可以帮忙吗？

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-09-28T22:39:27.877

我遇到了同样的麻烦，并在添加服务器（http）中设置了这个 URL：[http://yourserver/ccnet/server/local/ViewServerReport.aspx](http://yourserver/ccnet/server/local/ViewServerReport.aspx)。它适用于此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T17:26:36.507

这取决于您使用的版本。使用从正在运行的 CCNet 仪表板实例下载的 CCTray 版本始终是一个好主意（在仪表板的左栏中，您会找到一个链接“下载 CCTray”）。

然后主要是“添加服务器”的问题。较旧的版本需要远程连接，该连接需要在与 CCNet 的连接中打开一些端口。如今，您可以通过 HTTP 进行连接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:20:31.013

如果您使用的是 1.1 之后的版本，那么您需要将 CC 托盘客户端指向 Web 仪表板站点。

您应该确保您已经设置了 Web 服务器的 CCNET 仪表板，然后您可以执行以下操作。

*   文件 > 设置 > 构建项目（单击添加）
*   添加服务器（单击）
*   通过 CruiseControl 仪表板选择
*   输入您的 Web 仪表板站点的地址。也许像“yourserver.com/ccnet”之类的东西。您可以通过浏览到 Web 仪表板然后将 URL 复制到文件夹级别来找到它。
*   单击确定，选择要观看的项目
*   利润！

# wpf - 如何使用触发器制作文本框 Visibility=Hidden

> ID：631098
> 
> 赞同：14
> 
> 时间：2009-03-10T16:28:05.290
> 
> 标签：wpf, .net-3.5, styles, datatrigger

我今天好像很难过。我要做的就是`TextBox`根据绑定到其托管窗口的布尔值数据来隐藏可见。

我只是不会编译，我不明白为什么。请帮忙。

```
<TextBlock Grid.Column="2" Text="This order will be sent to accounting for approval" 
           Foreground="Red" VerticalAlignment="Center" FontWeight="Bold" Padding="5">
    <TextBlock.Style>
        <Style>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=AllowedToSubmit}" Value="True">
                    <Setter Property="Visibility" Value="Hidden" /> 
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </TextBlock.Style>
</TextBlock> 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-10T16:42:21.760

您需要设置[`Style.TargetType`](http://msdn.microsoft.com/en-us/library/system.windows.style.targettype.aspx)它才能识别该`Visibility`属性：

```
<TextBlock Grid.Column="2" VerticalAlignment="Center" FontWeight="Bold" Foreground="Red" Padding="5" Text="This order will be sent to accounting for approval">
    <TextBlock.Style>
        <Style TargetType="{x:Type TextBlock}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=AllowedToSubmit}" Value="True">
                    <Setter Property="Visibility" Value="Hidden"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </TextBlock.Style>
</TextBlock> 
```

~~您的绑定路径`AllowedToSubmit`可能也需要`ElementName`设置为`Window`的名称。~~

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-10T16:51:37.057

另一种选择是直接绑定`TextBlock.Visibility`到属性：

```
<Window>
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    </Window.Resources>
    <TextBlock Visibility="{Binding Path=AllowedToSubmit, Converter={StaticResource BoolToVisibility}}" />
</Window> 
```

如果您希望它像在您的示例中一样工作，其中 true 隐藏了`TextBlock`，那么您可以编写自己的转换器来转换与内置`BooleanToVisibilityConverter`.

# java - instanceof 检测接口产生不一致的结果？

> ID：631099
> 
> 赞同：12
> 
> 时间：2009-03-10T16:28:54.257
> 
> 标签：java, instanceof

有什么棘手的事情我应该知道`instanceof`吗？我通过一些方法传递了一个对象列表，并测试这些对象是否使用`instanceof`. 在某些情况下，`instanceof`正确地将对象识别为实现了接口，而在其他情况下则没有。它似乎给我在不同地方的同一个对象上不一致的结果。我应该在这里注意什么技巧/陷阱？

期待您的评论，您可能有：

1）我知道这`instanceof`是不好的形式。我正在使用一个无法更改的不太完美的对象层次结构，这是我能想到的最不坏的事情。

2）我正在创建一个代码示例，但如果我要在此处粘贴任何有用的内容，我需要大量简化我的代码。与此同时，如果你以前看过这个并且可以阐明一些问题，请这样做。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-10T16:34:51.233

您是否正在动态加载任何类型，可能来自不同的类加载器？我唯一一次看到明显不一致的结果是当我有两行代码*看起来*它们引用相同的类型，但实际上是从不同的类加载器加载了该类型。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-10T17:00:15.650

好的，问题解决了。像往常一样，这个问题没有我想象的那么奇怪。我正在从事的项目不幸的是有一些重复的类名。我正在使用 foo.MyInterface 创建类并测试 bar.MyInterface 的实例。感谢您的回复。它确实帮助我想通了。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-10T16:36:18.373

`instanceof`总是返回`false`. `null`如果左边的静态类型不可能是指定类型的实例，则它不会编译。除此之外，它应该毫无意外地工作。

与 C++（我相信 Smalltalk）不同，对象不能在运行时更改类型。在 C++ 中，类型在构造过程中发生变化，因此不能从构造函数调用方法到派生类 [子类] 方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-10T16:34:43.680

我知道的唯一问题`null`是`instanceof`没有类型。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T16:38:49.367

只要您没有类加载问题，instanceof 就可以始终如一地工作。我猜你知道如果 A 是从 B 继承的，或者 A 实现的某些接口或 A 扩展的类是 instanceof B，则 A instanceof B 返回 true。

如果您在期望为 true 时得到 false，那么您可能正在尝试比较来自不同 ClassLoader 的实例。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-10T16:35:34.413

您可能想要“isAssignable”而不是 instanceof：

```
if (MyInterface.isAssignableFrom(myObject.getClass())) {
  //  do work here
} 
```

这将为实现您的接口的类返回 true。

# c# - 如何通过在 C# 中更新绑定的 DataTable 来平滑更新 GridView？

> ID：631107
> 
> 赞同：0
> 
> 时间：2009-03-10T16:30:15.940
> 
> 标签：c#, winforms, gridview, datatable, datasource

我有一个`GridView`who's`DataSource`设置为`DataTable`. `DataTable`每隔几秒就会由一些后端逻辑更新，此时调用委托来刷新`GridView`。

目前我只是重置`DataSource`, 但这会导致问题 - 它会中断网格视图中正在进行的任何编辑并使选择“跳转”到左上角的单元格。

更新逻辑基本上创建一个新的（关于列和行）`DataTable`。

有没有没有任何缺点的标准方法？我唯一的选择是`DataSource`逐行更新当前，以编程方式插入值吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T02:30:33.623

我对这个问题的很多事情感到困惑。如果您使用的是`GridView`，而不是`DataGridView`，那么您使用的是 ASP.NET、WPF 或 .NET 1.1。它是哪一个？

下一个：你要`DataTable`完全创造一个新的？当然，当您重置`DataSource`. 它不知道您的新架构与`DataTable`它要替换的架构相同。它必须遍历列并重新建立绑定。

此外，它*当然*会丢失当前行。当前行属于旧的`DataTable`，而不是新的。

如果您希望绑定控件在更新基础数据源时保持其状态，请更新*基础*数据源，不要将其替换为新的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:34:45.927

您应该使用一个`BindingList`或一些支持更改通知的数据源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T23:22:25.497

您的更新是否发生在后台线程上？我不知道它是否适用于你的场景，但你可以试试这个[线程绑定列表](http://groups.google.co.uk/group/microsoft.public.dotnet.languages.csharp/msg/f12a3c5980567f06)；查看示例以查看工作人员愉快地编辑网格。

# sharepoint - 页面布局未出现在页面布局列表中

> ID：631113
> 
> 赞同：5
> 
> 时间：2009-03-10T16:31:58.103
> 
> 标签：sharepoint, sharepoint-2007

我有一个功能，可以部署几个网站栏、一个内容类型（从 Page Publishing Content Type 继承）和一个基于我的内容类型的页面布局。

在不同服务器上执行的两次测试中一切都很好，但在第三台服务器上，虽然该功能已正确激活并且我可以在画廊中看到网站栏、内容类型和页面布局，但我无法创建基于新页面在我的页面布局上，因为页面布局没有出现在可用页面布局列表中。

在所有测试中，我都使用了管理员帐户。

有人对此可能的原因有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-13T22:38:40.557

您是否查看过站点设置下的“页面布局和站点模板”页面？在此页面上，您可以启用将可用页面布局限制为指定页面布局列表的选项。

我从事过一个项目，我们需要限制自定义站点定义上可用的页面布局。我们在一项功能中实现了这一点，该功能启用了“有限页面布局”选项并在激活时填充可用页面布局列表。

如果这是您遇到的问题，您可以简单地在 Web 界面中关闭此选项或手动添加新的页面布局，但您也可以考虑实现一个功能接收器，自动将您的自定义页面布局添加到可用布局列表中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T14:30:50.727

谢谢大家的答案。

实际发生的情况是，由于某种原因，页面布局被部署为母版页而不是页面布局。管理员已经手动更改了它，现在它可以工作了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:21:28.940

这只是一个有根据的猜测，但请检查页面布局是否正在等待签入或批准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-19T17:05:22.537

在我的情况下，布局的路径是错误的，所以布局本身最终位于不同的位置，当我纠正我能够看到结果时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-14T06:31:34.773

我手动添加了文件，但它没有出现。当我从 UI 编辑该布局页面的属性并保存它时，它出现了。

# algorithm - 映射网络设备的算法

> ID：631117
> 
> 赞同：0
> 
> 时间：2009-03-10T16:32:45.263
> 
> 标签：algorithm, networking, diagram

有谁知道在网络上映射设备的好方法？

我正在寻找可以建立设备之间的连接布局以构建可视化网络图的东西。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T17:26:45.960

这不是一种算法，而是一种用于发现邻居的协议（或多个协议）。如果您的交换机/设备启用了[链路层发现协议](http://en.wikipedia.org/wiki/Link_Layer_Discovery_Protocol)(LLDP)，您可以使用它来确定物理连接网络。

请注意，较旧的 Cisco 交换机可能没有 LLDP，但会有 CDP，这是一种专有的发现实现。Nortel 和 Extreme 交换机也是如此，它们也有自己的专有协议。但是 LLDP 现在是应该用于发现的标准 ( [802.1AB )。](http://standards.ieee.org/getieee802/download/802.1AB-2005.pdf)

您还可以在 Wikipedia 页面上看到有用于 Linux/Windows/Mac 的 LLDP（和其他专有协议）的实现。此外，VMware ESX 实现了 CDP。

# c# - 消除边界检查的 foreach 循环的特殊情况是什么？

> ID：631123
> 
> 赞同：5
> 
> 时间：2009-03-10T16:34:27.957
> 
> 标签：c#, .net, for-loop, foreach, bounds-check-elimination

消除边界检查的 foreach/for 循环的特殊情况是什么？还有哪个边界检查？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T16:38:17.840

标准

```
for(int i = 0; i < array.Length; i++) {
    ...
} 
```

循环是允许 JIT 安全删除数组边界检查的循环（索引是否在 [0..length-1] 内）

数组上的`foreach`循环等效于数组上的标准`for`循环。

**编辑：** 正如罗伯特·杰普森指出的那样：

> 如果数组是本地的，这将被优化。如果可以从其他位置访问该数组，则仍将执行边界检查。参考：[CLR 中的数组边界检查消除](https://docs.microsoft.com/en-us/archive/blogs/clrcodegeneration/array-bounds-check-elimination-in-the-clr "MSDN 博客 > JIT、NGen 和其他托管代码生成材料 > CLR 中的数组边界检查消除")

谢谢！我自己不知道。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-10T16:58:58.523

SealedSun 是对的。不要像在 C++ 中那样优化。JIT 非常聪明地为您做正确的事情。您始终可以以不同的方式对循环进行编码，然后检查 IL 代码。

```
 static void Main(string[] args)
        {
            int[] array = new int[100];
00000000  push        edi  
00000001  push        esi  
00000002  push        eax  
00000003  xor         eax,eax 
00000005  mov         dword ptr [esp],eax 
00000008  mov         edx,64h 
0000000d  mov         ecx,79174292h 
00000012  call        49E73198 
00000017  mov         esi,eax 
            int sum = 0;
00000019  xor         edx,edx 
0000001b  mov         dword ptr [esp],edx 
            for(int index = 0; index < array.Length; index++)
0000001e  mov         edi,dword ptr [esi+4] 
00000021  test        edi,edi 
00000023  jle         00000033 
            {
                sum += array[index];
00000025  mov         eax,dword ptr [esi+edx*4+8] 
00000029  add         dword ptr [esp],eax 
            for(int index = 0; index < array.Length; index++)
0000002c  add         edx,1 
0000002f  cmp         edi,edx 
00000031  jg          00000025 
            }

            Console.WriteLine(sum.ToString());
00000033  mov         esi,dword ptr [esp] 
00000036  call        493765F8 
0000003b  push        eax  
0000003c  mov         ecx,esi 
0000003e  xor         edx,edx 
00000040  call        49E83A8B 
00000045  mov         edi,eax 
00000047  mov         edx,88h 
0000004c  mov         ecx,1 
00000051  call        49E731B0 
00000056  mov         esi,eax 
00000058  cmp         dword ptr [esi+70h],0 
0000005c  jne         00000068 
0000005e  mov         ecx,1 
00000063  call        4936344C 
00000068  mov         ecx,dword ptr [esi+70h] 
0000006b  mov         edx,edi 
0000006d  mov         eax,dword ptr [ecx] 
0000006f  call        dword ptr [eax+000000D8h] 
00000075  pop         ecx  
        }
00000076  pop         esi  
00000077  pop         edi  
00000078  ret 
```

现在，如果按照您在 C++ 中的方式优化代码，您将得到以下结果：

```
 static void Main(string[] args)
        {
            int[] array = new int[100];
00000000  push        edi  
00000001  push        esi  
00000002  push        ebx  
00000003  push        eax  
00000004  xor         eax,eax 
00000006  mov         dword ptr [esp],eax 
00000009  mov         edx,64h 
0000000e  mov         ecx,79174292h 
00000013  call        49E73198 
00000018  mov         esi,eax 
            int sum = 0;
0000001a  xor         edx,edx 
0000001c  mov         dword ptr [esp],edx 

            int length = array.Length;
0000001f  mov         ebx,dword ptr [esi+4] 
            for (int index = 0; index < length; index++)
00000022  test        ebx,ebx 
00000024  jle         0000003B 
00000026  mov         edi,dword ptr [esi+4] 
            {
                sum += array[index];
00000029  cmp         edx,edi                  <-- HERE
0000002b  jae         00000082                 <-- HERE
0000002d  mov         eax,dword ptr [esi+edx*4+8] 
00000031  add         dword ptr [esp],eax 
            for (int index = 0; index < length; index++)
00000034  add         edx,1 
00000037  cmp         edx,ebx 
00000039  jl          00000029 
            }

            Console.WriteLine(sum.ToString());
0000003b  mov         esi,dword ptr [esp] 
0000003e  call        493765F8 
00000043  push        eax  
00000044  mov         ecx,esi 
00000046  xor         edx,edx 
00000048  call        49E83A8B 
0000004d  mov         edi,eax 
0000004f  mov         edx,88h 
00000054  mov         ecx,1 
00000059  call        49E731B0 
0000005e  mov         esi,eax 
00000060  cmp         dword ptr [esi+70h],0 
00000064  jne         00000070 
00000066  mov         ecx,1 
0000006b  call        4936344C 
00000070  mov         ecx,dword ptr [esi+70h] 
00000073  mov         edx,edi 
00000075  mov         eax,dword ptr [ecx] 
00000077  call        dword ptr [eax+000000D8h] 
0000007d  pop         ecx  
        }
0000007e  pop         ebx  
0000007f  pop         esi  
00000080  pop         edi  
00000081  ret              
00000082  call        4A12746B 
00000087  int         3 
```

顺便说一句 - 这与 foreach 语句相同：

```
 static void Main(string[] args)
        {
            int[] array = new int[100];
00000000  push        edi  
00000001  push        esi  
00000002  push        eax  
00000003  xor         eax,eax 
00000005  mov         dword ptr [esp],eax 
00000008  mov         edx,64h 
0000000d  mov         ecx,79174292h 
00000012  call        49E73198 
00000017  mov         esi,eax 
            int sum = 0;
00000019  xor         edx,edx 
0000001b  mov         dword ptr [esp],edx 
            for(int index = 0; index < array.Length; index++)
0000001e  mov         edi,dword ptr [esi+4] 
00000021  test        edi,edi 
00000023  jle         00000033 
            {
                sum += array[index];
00000025  mov         eax,dword ptr [esi+edx*4+8] 
00000029  add         dword ptr [esp],eax 
            for(int index = 0; index < array.Length; index++)
0000002c  add         edx,1 
0000002f  cmp         edi,edx 
00000031  jg          00000025 
            }

            Console.WriteLine(sum.ToString());
00000033  mov         esi,dword ptr [esp] 
00000036  call        493765F8 
0000003b  push        eax  
0000003c  mov         ecx,esi 
0000003e  xor         edx,edx 
00000040  call        49E83A8B 
00000045  mov         edi,eax 
00000047  mov         edx,88h 
0000004c  mov         ecx,1 
00000051  call        49E731B0 
00000056  mov         esi,eax 
00000058  cmp         dword ptr [esi+70h],0 
0000005c  jne         00000068 
0000005e  mov         ecx,1 
00000063  call        4936344C 
00000068  mov         ecx,dword ptr [esi+70h] 
0000006b  mov         edx,edi 
0000006d  mov         eax,dword ptr [ecx] 
0000006f  call        dword ptr [eax+000000D8h] 
00000075  pop         ecx  
        }
00000076  pop         esi  
00000077  pop         edi  
00000078  ret 
```

不要试图优化没有数字的代码。如您所见，如果您不妨碍 JIT，JIT 将为您做很多事情。在优化之前使用分析器。总是。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T16:39:19.490

有关详细信息，请参阅此：

[http://codebetter.com/blogs/david.hayden/archive/2005/02/27/56104.aspx](http://codebetter.com/blogs/david.hayden/archive/2005/02/27/56104.aspx)

基本上，如果您有一个 for 循环，并且您明确引用 IList.Count 或 Array.Length，JIT 将捕获它，并跳过边界检查。它比预先计算列表长度更快。

我相信，列表或数组上的 foreach 会在内部做同样的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T16:43:58.387

foreach 循环使用枚举器，它是处理循环的类或结构。枚举器具有`Current`从集合中返回当前项的属性。这消除了使用索引来访问集合中的项目，因此不需要额外的步骤来获取项目，包括边界检查。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-03-10T16:39:45.883

什么？我不确定是否甚至可以消除 C# 中的边界检查。如果您想要非托管代码，请使用：

```
int[] array;
fixed (int * i = array)
{
 while (i++)
  Console.WriteLine("{0}", *i);
} 
```

例如 - 它不检查边界，并且死得很惨。:-)

# c# - 如何将 DataGridViewComboBoxColumn 绑定到对象？

> ID：631126
> 
> 赞同：4
> 
> 时间：2009-03-10T16:34:39.657
> 
> 标签：c#, winforms, data-binding, datagridview, datagridviewcombobox

我试图将 a 绑定`DataGridViewComboBoxColumn`到 Foo 的一个实例，但是当我在网格上设置一个值时，我得到一个`ArgumentException`告诉我我无法从 String 转换为 Foo 的消息。

```
var data = (from item in someTable
            select new { Foo = item.foo, Bar = item.Bar }).ToList();
grid.DataSource = data;
column.DataPropertyName = "Foo";
column.DataSource = (from foo in Foo select foo).ToList (); //foo is an instance of Foo
column.DisplayMember = "SomeNameField"; //Foo.SomeNameField contains a description of the instance 
```

我错过了什么吗？是否可以将数据绑定到复杂对象？

**更新：**

我实现了一个 TypeConverter 并覆盖了 CanConvertFrom、CanConvertTo、ConvertTo、ConvertFrom。现在我得到

> FormatException：DataGridViewComboBoxCell 值无效

有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-08-11T20:21:41.270

DataGridViewComboBoxColumn 应该始终在组合框项列表中包含所有可能的值，否则它将抛出“FormatException：DataGridViewComboBoxCell 值无效”。

如果您试图取回从一个组合框列中选择的值，您可以处理 DataGridView CellParsing 事件，并从 DataGridView.EditingControl 获取所选项目，因为它将设置为从已编辑列中编辑控件。这是一个例子：

```
private void dataGridView1_CellParsing(object sender, 
 DataGridViewCellParsingEventArgs e) {
   if (dataGridView1.CurrentCell.OwningColumn is DataGridViewComboBoxColumn) {
       DataGridViewComboBoxEditingControl editingControl = 
                (DataGridViewComboBoxEditingControl)dataGridView1.EditingControl;
       e.Value = editingControl.SelectedItem;
       e.ParsingApplied = true;
   }
} 
```

您还可以通过处理单元格格式事件来自定义对象在每个单元格上的显示方式，这里是显示任何对象或接口的 toString 的代码。

```
private void dataGridView1_CellFormatting(object sender, 
    DataGridViewCellFormattingEventArgs e) {
        if (e.Value != null) {
            e.Value = e.Value.ToString();
            e.FormattingApplied = true;
        }
    } 
```

处理这两个事件应该足以在任何业务对象中显示和编辑数据，然后编写类型转换器。对于这项工作，您设置 DataGridView 和您的组合框列，如下所示：

```
var data = (from item in someTable
        select new { Foo = item.foo, Bar = item.Bar }).ToList();
grid.DataSource = data;
column.DataPropertyName = "Foo";
column.DataSource = (from foo in Foo select foo).ToList (); 
```

无需设置 DisplayMember 或 ValueMember 属性，只需确保您的组合框数据源列表具有 Foo 的所有可能值。

希望它有所帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T16:38:39.397

你错过了一个可能的部分。

```
column.DataPropertyName = "Foo";
column.DisplayMember = "SomeNameField"; 
column.ValueMember = "Bar"; // must do this, empty string causes it to be 
                            // of type string, basically the display value
                            // probably a bug in .NET
column.DataSource = from foo in Foo select foo;
grid.DataSource = data; 
```

更新：

实际上，在再次阅读您的问题后，我认为您正面临着那个注意到的错误。不幸的是，如果不使用自定义 TypeDescriptor/TypeConverter/BindingSource，就无法让它返回绑定对象。

绑定到复杂对象的答案。默认没有。我为我当前的项目写了一个相当不错的。这涉及制作一个返回所有嵌套属性的自定义 TypeDescriptor/TypeConverter/BindingSource。另一个“错误”，您不能使用“。” 对于成员分隔符，我不得不求助于“：”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-11-29T11:21:37.807

实际上，您可以在`DataGridViewComboBoxColumn`.

例如：

```
DataGridViewComboBoxColumn.DataPropertyName = "ValueMode";
DataGridViewComboBoxColumn.DisplayMember = "Label";
DataGridViewComboBoxColumn.ValueMember = "Self"; *
DataGridViewComboBoxColumn.ValueType = typeof(ValueModeItem); 
```

`Self`是：

```
public ValueModeItem Self
{
    get
    {
        return this;
    }
} 
```

非常重要 - 需要覆盖复杂类型的 'Equals' 方法。就我而言：

```
public override bool Equals(object obj)
{
    if (obj is ValueModeItem && obj != null)
    {
        if (...)
            return true;
    }
    return false;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-11-08T16:05:15.533

我一直在遇到同样的问题，直到我发现如果不设置 the 就无法`DisplayMember`设置`DataGridViewComboBoxCell`the `ValueMember`。
同样，设置 the`ValueMember`而不是 the`DisplayMember`也是失败的，您必须定义 none 或同时定义两者。

您的模型是 Foo，您当然希望 ComboBox 的 Value 是项目本身。为此，最简单的方法是在您的 foo 中创建一个属性，然后返回自身。

```
public class Foo
{
    ...
    public Foo This { get {return this; } }
} 
```

然后绑定变为：

```
column.DataPropertyName = "Foo";
column.DataSource = (from foo in Foo select foo).ToList (); //foo is an instance of Foo
column.DisplayMember = "SomeNameField"; //Foo.SomeNameField contains a description of the instance
column.ValueMember = "This"; 
```

这应该可以工作，并且单元格的值应该是 Foo 类型，如预期的那样。

一个有趣的参考：[DataGridViewComboBoxColumn 的问题](http://mikehadlow.blogspot.fr/2006/09/problems-with-datagridviewcomboboxcolu.html)

> 但是，DataGridViewComboBoxColumn 不是这样工作的，尽管如果您不设置 DisplayMember，它将显示 ToString 值，但当它尝试查找 SelectedItem 时出现内部问题，您必须将 DisplayMember 设置为的公共属性你的班。更糟糕的是，如果您不设置 ValueMember 属性，则默认行为是返回 DisplayMember，无法获取实际项目本身。唯一的解决方法是向您的类添加一个返回自身的属性并将该属性设置为 ValueMember。当然，如果您的项目不是您能够更改的东西（例如框架类之一），您将不得不将一个容器对象聚集在一起，该容器对象包含对您的项目的引用。

# database-design - 规范化到不同的数据库？

> ID：631131
> 
> 赞同：0
> 
> 时间：2009-03-10T16:35:11.870
> 
> 标签：database-design

大家对跨多个数据库规范化一个数据库有什么看法。例如，假设您有一个允许不同客户销售产品的数据库。您已经抽象了订单、订单项目等的概念，但每个客户都希望在这里或那里添加不同的字段。

您可以将字段添加到特定表中，创建一个宽表，其中包含并非所有客户端都使用的值，或者您可以创建一个列出列名和值的高表，以便看起来您正在附加在特定对象的列上（例如，当只存在一个工作电话号码时，希望在订单表上有一个家庭电话号码）。

或者，您可以规范化到具有名为 CustomOrder 的表的客户端特定数据库，该表保留通用数据库中的原始订单 ID，然后添加容纳客户端所需的列。

有没有人使用过这样的解决方案？我知道跨数据库很难控制参照完整性，但它确实保持了原始通用数据库的小而精，同时允许客户根据他们的内心内容进行定制。

大家对这种设计有什么看法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:20:09.057

我在那种环境中工作过，这变成了一场真正的噩梦。我们有一个主应用程序，由一个团队管理，其他团队管理客户特定的定制。然后问题就变成了多个客户获得了相似但不完全相同的定制（尽管如果有人在设计自己的之前都查看其他客户在做什么，他们可能会是这样）。由于执行适用于每个人的主要应用程序的团队是由公司而不是个人客户支付的，我们在那里没有足够的人来概括特定客户的需求，以便其他人可以在需要时使用它们，因此创造了 20 种不同的定制解决方案来做同样的事情。此外，由于客户的最后期限往往比一般团队能够处理的要早（100 名开发人员中只有两人），即使某些东西可以很好地泛化，它也会在客户端数据库中处理以满足交易要求。很快就出现了如此大的混乱，以至于重构数据库以修复设计缺陷变得不可能，因为有太多不同的可能应用程序可能会受到影响，没有人敢尝试重构。然后将发生的情况是针对特定问题进行了修复，但旧方法将保留在那里，每个客户端都会选择不同的方式来实现主应用程序数据库中的内容。组织更改试图在创建后将设计团队添加到这个混乱中，然后导致几乎完全停止可以完成的工作，因为如果没有完全重写现有网站（即当然客户没有 不想付费，因为当前版本对他们来说效果很好）。离这个模型很远！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T16:38:31.067

我绝对建议不要创建多个数据库，这听起来像你想要的就是这个[Entity Attribute Value model](http://en.wikipedia.org/wiki/Entity-Attribute-Value_model)。如果您曾经需要扩展创建多个数据库的方法，那将变得更加困难。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:54:26.333

我曾经使用过 Siebel CRM 系统，该系统允许对他们的罐装应用程序进行大量定制。它通过允许扩展表来做到这一点。例如，客户的扩展表将与客户表具有一对一的关系，并且其中包含所有添加的列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T17:05:36.057

拥有这样的东西是个好主意。理论上它工作得很好。但即使对应用程序特定的字段进行特殊处理，您也会遇到麻烦。每个应用程序可能有不同的业务逻辑（验证算法）。现在，在一个应用程序中有效的记录可能在另一个应用程序中无效。我的建议是这样的。

将数据库分开，但引入一些将它们链接在一起的东西。例如，出于报告目的，您可能想知道来自一个应用程序的客户 A 与来自另一个应用程序的客户 B 相同。创建一个表（数据库），链接来自各种数据库的记录。

除非我知道您对特定问题的具体细节，否则我可能不会走得更远。

PS：您所说的称为[Master Data Management](http://en.wikipedia.org/wiki/Master_Data_Management)。有一些商业产品试图解决这个问题，但没有一个让我相信它确实有效（是的，它是用于查询数据，但更新呢？）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T19:32:10.353

我不确定您如何将“规范化”一词与您的建议联系起来。但我会认为它是一种严重的反模式，在我熟悉的任何 SQL 理论或实践文献中都不推荐。

# java - 提高可比性 比较性能

> ID：631136
> 
> 赞同：1
> 
> 时间：2009-03-10T16:36:22.180
> 
> 标签：java, performance, comparable, virtual-functions

我分析了我的代码，发现我的类实现`Comparable<T>`了 8 倍以上的 cpu 时间

```
compareTo(Object) 
```

比在

```
compareTo(T) 
```

我认为减速是因为此方法的虚拟表查找。

**有没有办法强制静态调用函数？**（就像在非虚拟 C++ 方法中一样）

我仍然想使用`Comparable<T>`接口，因为我使用`TreeSet`了这个对象并且我不想重写这个代码。

编辑：不，我没有实现*compareTo(Object)* - 这是由探查器自动生成和报告的

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T16:51:13.813

您看到的原因`compareTo(Object)`是因为[Type Erasure](http://java.sun.com/docs/books/tutorial/java/generics/erasure.html)。它只是意味着在运行时不再需要类型信息来比较值。您减速的最有可能的原因是 1）非常非常大的 TreeSet 有很多元素 2） - 更有可能 - 您的 compareTo 方法做了一些昂贵的事情。因为它被非常频繁地调用（通常 n*ln(n) 次），它应该被有效地实现

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T17:04:42.987

不，在这种情况下您不能强制进行静态调用。

指令可以“非虚拟地”调用实例方法`invokespecial`。当目标在编译时已知时使用此指令，例如构造函数或私有方法。在其他情况下——即使目标方法是`final`——使用`invokevirtual`or`invokeinterface`指令。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T16:42:20.183

由于 java在运行时[不保留](https://stackoverflow.com/questions/373363/why-arent-java-generic-type-parameters-reified-at-runtime)泛型类型，因此理想情况下它们的行为应该相同。可能还有其他原因导致问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T17:10:17.480

> 我认为减速是因为此方法的虚拟表查找。

您不必猜测这是否属实。只需暂停几次，您就会在表演中抓住它。完整显示调用堆栈，包括对库例程的调用。

我的猜测（可能是错误的）是它正在经历 9 码的 OLE 风格调用 hoo-haw。

# c++ - 为什么 param 在以下情况下需要两个参数：

> ID：631145
> 
> 赞同：0
> 
> 时间：2009-03-10T16:37:37.870
> 
> 标签：c++

我对此感到有些困惑：

```
 istream_iterator<string> ii(is);
 istream_iterator<string> eos; 
 vector<string> param (ii, eos); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T16:42:20.950

开始和结束迭代器。空 istream_iterator 表示输入结束。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:43:21.307

接受迭代器的构造`std::vector`函数需要一个范围，即两个迭代器，它们指定输入范围的开始和结束位置（end 通常意味着一个迭代器超过范围的末尾）。

即使您可以不同地使用输入迭代器，您仍然需要将范围传递给`std::vector`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:42:48.403

一开始一结束

随机数据**开始迭代器**有用的数据**结束迭代器**随机数据

如果没有“eos”，向量如何知道它何时到达终点？

# sql-server-2005 - SQL Reporting Services 2005 - 如何获取当前日期作为 ReportParameter

> ID：631150
> 
> 赞同：3
> 
> 时间：2009-03-10T16:38:28.727
> 
> 标签：sql-server-2005, reporting-services, rdl

我有一些工作报告必须部署在 SSRS 上。我要添加的另一项自定义是自动将 FromDate 选择为今天 - 1 个月，并将 ToDate 选择为今天。

具体来说，我想用满足上述要求的片段替换下面的片段：

```
 <ReportParameter Name="FromDate">
  <DataType>String</DataType>
  <DefaultValue>
    <Values>
      <Value>[Date].&amp;[2008-09-26T00:00:00]</Value>
    </Values>
  </DefaultValue>
  <Prompt>From Date</Prompt>
  <ValidValues>
    <DataSetReference>
      <DataSetName>FromDate2</DataSetName>
      <ValueField>ParameterValue</ValueField>
      <LabelField>ParameterCaption</LabelField>
    </DataSetReference>
  </ValidValues>
</ReportParameter>
<ReportParameter Name="ToDate">
  <DataType>String</DataType>
  <Prompt>To Date</Prompt>
  <ValidValues>
    <DataSetReference>
      <DataSetName>ToDate</DataSetName>
      <ValueField>ParameterValue</ValueField>
      <LabelField>ParameterCaption</LabelField>
    </DataSetReference>
  </ValidValues>
</ReportParameter> 
```

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T16:59:27.193

替换硬编码

```
[Date].&amp;[2008-09-26T00:00:00] 
```

公式化

```
=DateAdd("m", -1, Now) 
```

对于“ToDate”，只需传递一个返回当前日期的公式

```
=Now 
```

现在结果看起来像这样。

```
<ReportParameters>
    <ReportParameter Name="FromDate">
        <DataType>DateTime</DataType>
        <DefaultValue>
        <Values>
            <Value>=DateAdd("m", -1, Now)</Value>
        </Values>
        </DefaultValue>
        <AllowBlank>true</AllowBlank>
        <Prompt>FromDate</Prompt>
    </ReportParameter>
    <ReportParameter Name="ToDate">
        <DataType>DateTime</DataType>
        <DefaultValue>
        <Values>
            <Value>=Now</Value>
        </Values>
        </DefaultValue>
        <AllowBlank>true</AllowBlank>
        <Prompt>ToDate</Prompt>
    </ReportParameter>
</ReportParameters> 
```

***[更新]***
看来我忘记`<ReportParameters>`正确*粘贴ToDate*了；它已更新。以上 R​​DL 是通过配置*Report Parameter*生成的。这就是我在 GUI 中配置日期的方式。

*   从日期：
    ![替代文字](https://farm4.static.flickr.com/3614/3346000613_483516b4d3.jpg)

*   迄今为止：
    ![替代文字](https://farm4.static.flickr.com/3363/3346000617_b85cf206ff.jpg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:03:10.883

您实际上不能使用您必须使用的 TSQL 日期格式来使用 .net 方法：

```
=Now()

=DATEADD("m", -1, now()) 
```

# algorithm - 什么是 Splay 树、红黑树、AVL 树、B 树和 T 树？

> ID：631160
> 
> 赞同：2
> 
> 时间：2009-03-10T16:39:54.217
> 
> 标签：algorithm, data-structures, tree, graph-theory

什么是 Splay 树、红黑树、AVL 树、B 树和 T 树？

我正在寻找好的实现。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-10T16:43:47.670

这些都是用于快速搜索二进制数据的数据结构。许多被不同的数据管理系统使用。

它们在存储数据的方法上有所不同。我建议阅读每一个。

展开：[http ://en.wikipedia.org/wiki/Splay_tree](http://en.wikipedia.org/wiki/Splay_tree)

红黑：[http ://en.wikipedia.org/wiki/Red-black_tree](http://en.wikipedia.org/wiki/Red-black_tree)

AVL：[http ://en.wikipedia.org/wiki/Avl_tree](http://en.wikipedia.org/wiki/Avl_tree)

B-树：[http ://en.wikipedia.org/wiki/B-Tree](http://en.wikipedia.org/wiki/B-Tree)

T-树：[http ://en.wikipedia.org/wiki/T-tree](http://en.wikipedia.org/wiki/T-tree)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T16:43:04.783

维基百科上的树数据结构文章对于任何想要了解不同树结构的人来说都是一个很好的起点。我相信所有引用的结构在主树数据结构条目上都有链接。

对于实现，我建议查看 Cormen 的[算法简介](http://en.wikipedia.org/wiki/Introduction_to_Algorithms)文本，也可在 wikipedia 中引用。如果你想要具体的实现，你需要指定你想要的语言。

[http://en.wikipedia.org/wiki/Tree_data_structure](http://en.wikipedia.org/wiki/Tree_data_structure)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:47:46.520

除了在线资源，我还建议您购买一本关于算法的真正书籍。我强烈推荐 Sedgewick：

*   [C++ 中的算法](https://rads.stackoverflow.com/amzn/click/com/0201350882)
*   [Java中的算法](https://rads.stackoverflow.com/amzn/click/com/0201775786)

这些都是很棒的书，可以教授各种算法（树、搜索、图表等）。

# svn - 如何在 TortoiseSVN 中移动我的存储库？

> ID：631164
> 
> 赞同：8
> 
> 时间：2009-03-10T16:41:20.500
> 
> 标签：svn, tortoisesvn, project

我使用单个存储库有一段时间了。现在，我想为不同的编程环境（完全使用不同的语言和项目）创建另一个存储库。

要以结构化的方式执行此操作，我希望有一个根目录，我可以在其中收集不同的存储库。但我找不到有关如何使用 TortoiseSVN 将存储库移动到不同文件夹的信息。“重新定位”选项似乎仅适用于存储库中的项目。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T16:51:54.983

Subversion 的权威指针是[红皮书](http://svnbook.red-bean.com/)。所有 TortoiseSVN 命令都映射到那里描述的命令。

您可能只需将存储库移动到文件系统上并进行必要的服务器更改以使工作副本的 URL 保持最新。特别是，请参阅红皮书的[这一部分。](http://svnbook.red-bean.com/en/1.8/svn.reposadmin.maint.moving-and-removing.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T18:31:45.693

搬家正是要走的路。不是为了实际的搬迁，而是为了向 TortoiseSVN 展示新的位置。

1.  在您想要的位置创建一个新的存储库。
2.  转储您的存储库并将其加载到新的存储库中。
3.  重新定位（重写 URL）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:53:52.693

正如迈克尔所说，你最好的选择是阅读 SVN 书。我还推荐[TortoiseSVN 手册](http://tortoisesvn.net/support)以获取有关 Windows 上服务器设置的信息。

不过有一些评论：

*   如果以适当的方式构建单个存储库，则不需要其他存储库。一个例子是[Apache SVN 存储库](http://svn.apache.org/viewvc/)。拥有一个存储库可以更轻松地进行维护，但是如果您希望每个项目的修订号是连续的，那么唯一的方法就是单独的存储库（不是常见的要求）。

*   如果您决定单独的存储库是要走的路，并且正在使用 svnserve，那么请使用[--root 或 -r](http://svnbook.red-bean.com/en/1.5/svn.serverconfig.svnserve.html)选项。听起来您还想创建一个新的存储库，而不是重新定位现有的存储库，因此转储/加载可能不是适当的操作。

*   **您可以在同一**台服务器上移动存储库，而不必担心干扰客户端工作副本（当然是在停止 SVN 服务器之后！），但这假设您的 SVN 服务器配置正确，即知道更改。这与 TortoiseSVN 无关。TortoiseSVN 是一个 SVN 客户端，TortoiseSVN 执行的唯一服务器操作是创建存储库（为方便起见）。

# javascript - 在 Yahoo! 中使用 JSON！小部件

> ID：631166
> 
> 赞同：0
> 
> 时间：2009-03-10T16:41:47.440
> 
> 标签：javascript, json, yahoo-widgets

哈耶普！

雅虎！Widgets 规范说我可以使用 JSON.parse() 解析 JSON 对象。当我真正尝试这个时，这就是我尝试过的......

```
var parsed = JSON.parse('{"key": "value"}');

print (parsed);

for (p in parsed)
{
    print ("prop: "+p);
} 
```

我得到：

```
ReferenceError: JSON is not defined 
```

这是怎么回事？需要更多的魔法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T11:29:24.320

您是否将小部件设置为使用 4.5 功能？JSON 对象是在 4.5 中引入的，它在旧版本的 Y!WE 中不可用。

```
<?xml version="1.0" encoding="UTF-8"?>
<widget>
    <version>1.0</version>
    <minimumVersion>4.5</minimumVersion>
    <settings>
        <setting name="debug" value="on"/>
    </settings>
</widget> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T12:42:29.573

事实证明，在 onLoad 调用完成之前，“JSON”不可用。据我推测，这只是个人电脑上的问题，而不是 Mac 上的问题。

要使用 JSON，它确实是开箱即用的，但要尝试它，您需要通过计时器回调或其他方式进行操作。

# apache-flex - 我可以让网格布局像 HTML 表格那样伸展吗？

> ID：631168
> 
> 赞同：1
> 
> 时间：2009-03-10T16:42:12.120
> 
> 标签：apache-flex

我使用 mx:Grid 布局组件以与 HTML 表格非常相似的方式布局某些表单元素。但是，当您像 HTML 表格那样调整应用程序的大小时，结果不会水平延伸。我怎样才能让它做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:15:59.450

尝试将 Grid 元素的宽度和高度设置为百分比值。

我在我的一个主要应用程序上使用了一个网格，我将宽度/高度设置为 100%，它调整大小就可以了。

您可能还需要设置行和项目（GridRow 和 GridItem）的宽度和高度，具体取决于您希望如何调整行/列的大小。

**编辑**如果您以编程方式创建网格（例如在 .as 文件中），您需要将这些值设置为百分比，如下所示：

```
var grid:Grid = new Grid();
grid.percentWidth = 100;
grid.percentHeight = 100; 
```

# c# - System.Xml.XPath.XPathException：执行 SelectSingleNode("//(artist|author)") 时，表达式必须计算为节点集

> ID：631173
> 
> 赞同：5
> 
> 时间：2009-03-10T16:42:22.853
> 
> 标签：c#, xml, xpath, selectsinglenode

有人可以解释一下为什么这不起作用吗？

我正在执行

```
XmlNode xmlNode = xmlDocument.SelectSingleNode("//(artist|author)"); 
```

我得到

```
System.Xml.XPath.XPathException：表达式必须计算为节点集。
```

但这有效并且即使有很多艺术家节点也不会引发异常

```
XmlNode xmlNode = xmlDocument.SelectSingleNode("//artist"); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T17:21:26.550

据我所知，您可以使用“|” 就在 XPath 查询的顶层，所以试试这个查询

```
 "//artist|//author" 
```

再见，递归搜索（//）不是很快，所以请确保您的 dom 文档很小。

更新：

[我在规范](http://www.w3.org/TR/xpath#node-sets)中查找了它：

> 3.3 节点集
> 
> 位置路径可以用作表达式。该表达式返回路径选择的节点集。
> 
> 该| 运算符计算其操作数的并集，它必须是节点集。

这意味着无论你在“|”的左边和右边写什么 需要单独用作 xpath 查询，“|” 然后只是从中创建联合。

具体来说，您不能说“递归搜索（称为作者或称为艺术家的事物）”，因为“称为作者的事物”不会评估 xpath 查询（节点集）的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-02T10:35:03.760

1.  `//artist|//author`适用于 XPATH 1.0 和 2.0
2.  `//(artist|author)`适用于 XPATH 2.0

微软是一家懒惰的公司。他们的框架只支持 XPATH 1.0

# ruby - 如何在 Ruby 中不使用 'then' 或 'end' 来编写 'if'

> ID：631174
> 
> 赞同：9
> 
> 时间：2009-03-10T16:42:35.457
> 
> 标签：ruby, syntax, conditional-statements

我找到了三种在 Ruby 中编写相同条件的方法：

```
#1
if 1==1 
  puts "true" 
end

#2
puts "true" if 1==1

#3
if 1==1  then puts "true" end 
```

为什么我不能这样做？

```
#4
if 1==1 puts "true" 
```

我不明白：

1.  为什么#3 中需要**then**和**end ，并且，**
2.  为什么我需要更改顺序才能让#2 工作。

语句#4 似乎是最自然的写法。我不明白为什么这是不可能的。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-10T18:10:57.007

" `if x then y end`" 语法用于多行条件语句，而 " `y if x`" 形式用于简洁的单行条件语句。在第`then`一种情况下，有必要告诉 Ruby 条件已经结束（因为 Ruby 不需要像 C 那样的括号），并且`end`有必要告诉 Ruby 整个`if`块已经结束（因为它可以是多行）。

您可以将 替换`then`为分号，因为换行符也表示条件结束。`end`你不能用 multiline摆脱`if`。如果您想要简洁的单行符，请使用第二种形式或三元运算符。

例如，假设

```
x = true 
```

以下将评估 true，并返回 y

```
x ? y :
=> y 
```

同样，这将评估为 false 并且不返回任何内容

```
!x ? y :
=> 
```

在“：”之后添加一个术语以表示 else 情况

```
!x ? y : z
=> z 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T16:47:32.170

问题是这两种方式实际上都是一种自然的思考方式：

如果这是真的，那就做点什么

如果这是真的，做某事

看？Ruby 试图以这种方式接近英语语法。*end*只是结束块所必需的，而在第二个版本中，块已经用if*关闭*了。

要真正回答您的问题，我认为没有机会将*then*和*end*删除。还记得帕斯卡/德尔福吗？你也有一个*then*那里。只有 C 风格的语言没有它是典型的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:52:05.527

那么使用冒号而不是这样呢？[http://www.java2s.com/Code/Ruby/Statement/layoutanifstatementisbyreplacingthethenwithacolon.htm](http://www.java2s.com/Code/Ruby/Statement/layoutanifstatementisbyreplacingthethenwithacolon.htm)

如果您愿意，有多种方法可以短路。

条件语句只是 Ruby 语法的一部分，使其更像英语。

# api - 如何使用 twitter API 获取 *new* 关注者列表

> ID：631186
> 
> 赞同：12
> 
> 时间：2009-03-10T16:44:39.837
> 
> 标签：api, twitter

我需要定期返回一个 twitter 帐户的所有**新**关注者的列表（即自上次检索关注者列表以来），但 Twitter API 似乎只提供获取该帐户**所有**当前关注者列表的功能。

除了每次获取此完整列表并将其与上次检索时的存储版本进行比较之外，还有其他方法可以获取新的关注者吗？

divvoted.com、mrtweet 等网站必须以某种方式做到这一点！我是否遗漏了某些东西，或者它只需要上面描述的圆形方法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-10T16:48:49.763

是的，您必须保留自上次更新以来的关注者列表，因为 twitter 不会将 api 客户端与状态相关联。“最后一次检索列表”的定义缺少“由谁”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T16:31:09.970

您始终可以尝试从 Twitter 中捕获带有以下消息的邮件：“...正在 Twitter 上关注您”。这可能比使用 Twitter API 更难一些，并且有可能丢失邮件（以防邮件未送达），但它会保护一些有价值的 API 调用。但这不包括取消关注...

如果您尝试按照您描述自己的方式进行操作。Twitter API 按“新关注者优先”的顺序返回关注者，因此在第一次点击（您存储的列表版本中列出的关注者）时，您可以停止寻找新关注者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-28T00:34:27.603

我最近开始为此使用[Zapier](https://zapier.com/)。

他们有一个 Zap，它使用 Twitter API 来获取新的关注者（您或您希望监控的任何用户名）。Zap 监控新的关注者，然后可以将记录添加到 Google 表格、Trello、Slack 等。

它不会告诉你谁没有关注，但你总是可以将你的关注列表与你的完整列表相冲突。

它还会在关注时触发 - 因此有人可以关注、取消关注并再次关注并出现在列表中两次。如果您有关注者列表，则易于管理。

这里有文档： [https ://zapier.com/zapbook/zaps/201/log-new-twitter-followers-google-spreadsheet/](https://zapier.com/zapbook/zaps/201/log-new-twitter-followers-google-spreadsheet/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-22T18:16:20.737

对于授权用户，您可以使用 Twitter Stream API 来跟踪新关注者： [https ://dev.twitter.com/streaming/overview/messages-types#Events_event](https://dev.twitter.com/streaming/overview/messages-types#Events_event)

我将它与 C# 库[https://github.com/linvi/tweetinvi](https://github.com/linvi/tweetinvi)一起使用 ，代码非常简单：

```
Auth.SetUserCredentials("CONSUMER_KEY", "CONSUMER_SECRET", "ACCESS_TOKEN", "ACCESS_TOKEN_SECRET");
var stream = Stream.CreateUserStream();
stream.FollowedByUser += (sender, args) =>
{
    Console.WriteLine("You have been followed by " + args.User);
};
stream.StartStream(); 
```

# javascript - JavaScript 作用域和闭包

> ID：631187
> 
> 赞同：14
> 
> 时间：2009-03-10T16:44:46.590
> 
> 标签：javascript, scope, closures

我正试图绕过关闭（那里有一个笑话），我遇到了这个：

```
(function () { /* do cool stuff */ })(); 
```

这是如何运作的？将函数放在括号中的目的是什么？为什么之后是空的括号？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-10T16:56:30.853

这样做的重点是，在很酷的东西中声明的任何变量都不会在全局命名空间中创建。javascript 中的任何函数都会创建这样的范围。假设您有一些要运行的 javascript。如果你这样做：

```
var b = 1; 
// stuff using b 
```

而其他一些代码使用 b，它将获得您的剩余价值。（或者，更糟糕的是，如果其他代码在您的代码运行之前设置 b，然后尝试获取它的旧值，那么您同时会更改它。）

另一方面，如果你有这段代码，它声明然后调用 a 函数：

```
function a() { 
     var b = 1;
}

a(); 
```

稍后一些其他代码使用 b，它不会看到您的值，因为 b 是函数的本地。当然，问题在于您仍在创建一个全局名称 - 在这种情况下为“a”。所以，我们想要一个没有名字的函数——这就是你得到你描述的代码的原因。它声明一个没有名称的函数，然后调用它。

不幸的是，你不能只说：

```
function() { ... }() 
```

因为这将被解析为函数声明*语句*，然后是语法错误。通过将函数声明包装在括号中，您会得到一个函数*表达式*，然后可以调用它。您可以像任何其他函数表达式（如上面的 a）一样调用它，使用第二组括号。例如，如果函数接受参数，您将在那里传递它们：

```
(function(a) { ... })(1) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T16:50:27.187

这会创建一个函数，调用它，然后丢弃它。

如果你这样看可能会更清楚：

```
var throwaway = function(){
    // do cool stuff
};
throwaway(); 
```

这样做是为了创建一个私有命名空间。函数中的代码可以有函数和变量，不用担心与页面中加载的其他代码冲突。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-18T05:15:02.090

我最近才看到这篇文章。这种类型的函数定义和调用称为**自调用函数**。

```
(function(){  //code })(); 
```

函数内部的代码将在其定义后立即执行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T16:49:51.227

该构造意味着声明一个匿名函数并立即运行它。将代码放在函数体中的原因是因为您在其中定义的变量仍然是函数的本地变量，而不是全局变量。然而，在这个函数中定义的闭包仍然可以看到它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T16:49:52.583

函数周围的括号清楚地表明该函数是一个表达式。后面的括号是对函数的调用。

请注意，该函数没有名称。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-08-14T11:42:49.330

一种闭包方法是将变量传递给函数：

```
(function($, var_1, var_2) {
    // use JQuery, var_1 and var_2 as local variables
})($, var_1, var_2); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T16:50:39.463

将函数声明放在括号内会创建一个表达式，其计算结果为其中的匿名函数。因此，第一个括号计算为一个函数。

最后的“空括号”调用定义的函数，因此“//do cool stuff”立即执行。

这是一种即时执行代码的方法，同时也将变量保持在全局范围之外。

然而，这里说明的内容与闭包无关——至少不是直接的。闭包是关于在父函数已经退出后维护词法范围。

# javascript - Javascript：带有预定义参数的返回函数

> ID：631188
> 
> 赞同：16
> 
> 时间：2009-03-10T16:45:43.983
> 
> 标签：javascript, function

我有一个像

```
function a (p1, p2) { /* ... */ } 
```

并且在某些范围内想要得到这样的东西：

```
function b (/* no params! */) { return a (my1, my2) } 
```

其中 my1 和 my2 在此范围内以某种方式定义。所以我应该得到一个无参数函数b，它在调用时调用具有固定参数my1和my2的a。现在，问题是，为什么这是不对的，这是:)

UPD：好的，我在这些参数中有一些回调，现在知道如何处理它们。我错过的是两次应用该技术。谢谢你。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-10T16:54:57.877

只需创建一个返回新函数 b 的函数：

```
function getB(my1, my2) {
  return function() {
    a(my1, my2);
  }
} 
```

并像这样使用它：

```
var b = getB(my1, my2); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T16:54:34.773

编写一个接受 my1 和 my2 并创建函数 b 的函数：

```
function make_b(my1, my2){
   return function b(){ return a(my1, my2);};
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T16:57:12.160

我不确定我是否正确理解了您，但是您可以查看一个名为[currying](http://en.wikipedia.org/wiki/Currying)的概念。可以在 Javascript 中对函数进行 curry，这样您就可以使用预设的部分或全部参数来获取另一个函数。

您可以在[此处](http://www.dustindiaz.com/javascript-curry/)查看实现。

如果你使用Prototype，你可以通过这种方式获取函数b。

```
var b = a.curry(arg1, arg2); 
```

现在调用`b()`与调用相同`a(arg1, arg2)`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T16:52:03.797

为什么这是不对的？你有错误吗？我试图根据您的描述和我的作品复制一个工作样本，所以也许您可以发布一个更详细的样本：

```
<script>

function a(p1, p2)
{
 return 'hello ' + p1 + ' and ' + p2;
}
function b(my1,my2)
{
 return function()
        {
          return a(my1,my2);
        }
}

var wrapper=b();
alert(wrapper());
</script> 
```

# 编辑

根据您对另一个答案的评论，我更新了我的示例以展示如何包装函数。

# 编辑 2

好的，所以我用变量替换了它们；-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T16:47:13.637

将值放入一个数组（或 JSON）中并返回该数组。

```
function a (p1,p2) { 
   var my = []
   my[0] = p1
   my[1] = p2
   return my
}

function b () {
    return a(my1,nmy2)
} 
```

也许我错过了你的例子中的重点，我不知道。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T17:02:27.547

似乎分为三个部分：

定义一个：

```
 function a(M, N) {
    return M + N;
  } 
```

定义 b：

```
 var X = 10;
  var Y = 25;
  var b = function() {
   return a(X, Y);
} 
```

使用 b：

```
 var thirtyFive = b(); // thirtyFive = 35 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-06-07T05:04:51.130

此示例在页面加载期间使用 onclick 事件处理程序的分配来演示如何创建一个函数引用，其中包含对 setup 函数中本地值的嵌入引用。

```
<html>
<head>
<title>Scope passing Test</title>
<script type="text/javascript">
// Your target function
function a(p1,p2)   {   alert("p1="+p1+ " p2="+p2); }

function yourSetupFunction()
    {
// Declare some local variables that your "a()" function cannot see to test.
var my1 ="Look Ma"  ;
var my2 ="No hands" ;

//  Snag a reference to the <a id="testA"></a> element  
var oAelement=document.getElementById("testA");

oAelement.addEventListener( "click"     ,
                (function(scopePass_My1,scopePass_My2)
                        {
                        return  function()
                            {
                            a(scopePass_My1,scopePass_My2)
                            }
                })(my1,my2) ,true);
    }
</script>
</head>
<body onload="yourSetupFunction()">
<a id="testA" href="#" onclick="return false;">Click to Test</a>
</body>
</html> 
```

真正的魔法只有几行

```
(function(scopePass_My1,scopePass_My2)
            {
            return  function()
            {
                a(scopePass_My1,scopePass_My2)
            }
    })(my1,my2) 
```

第一组括号导致内容被评估为函数引用。

第二组括号 ... (my1,my2) ... 导致函数引用被调用，它返回另一个函数引用，可以看到传入的参数 ... scopePass_My1,scopePass_My2 ... 并且能够传递这些到你的目标函数 a(p1,p2)

希望有帮助。

# php - 如何从数据库中的表生成树结构？

> ID：631193
> 
> 赞同：1
> 
> 时间：2009-03-10T16:47:08.800
> 
> 标签：php, tree

我正在尝试从数据库中的表生成树结构。该表是扁平存储的，每条记录都有一个 parent_id 或 0。最终目标是生成一个选择框和一个节点数组。

我到目前为止的代码是：

```
function init($table, $parent_id = 0) 
{

    $sql = "SELECT id, {$this->parent_id_field}, {$this->name_field} FROM $table WHERE {$this->parent_id_field}=$parent_id ORDER BY display_order";

    $result = mysql_query($sql);

    $this->get_tree($result, 0);

    print_r($this->nodes);
    print_r($this->select);
    exit;
}

function get_tree($query, $depth = 0, $parent_obj = null)
{   
    while($row = mysql_fetch_object($query))
    {   
        /* Get node */
        $this->nodes[$row->parent_category_id][$row->id] = $row;

        /* Get select item */
        $text = "";
        if($row->parent_category_id != 0) {
            $text .= "    ";
        }
        $text .= "$row->name";
        $this->select[$row->id] = $text;

        echo "$depth $text\n";

        $sql = "SELECT id, parent_category_id, name FROM product_categories WHERE parent_category_id=".$row->id." ORDER BY display_order";

        $nextQuery = mysql_query($sql);
        $rows = mysql_num_rows($nextQuery);

        if($rows > 0) {
            $this->get_tree($nextQuery, ++$depth, $row);
        }            
    }
} 
```

它几乎可以工作，但不完全。谁能帮我完成它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T19:00:17.670

你几乎可以肯定，不应该继续你目前的道路。如果您的树变得稍微大一点，您尝试使用的递归方法几乎肯定会破坏您的性能。如果您打算经常阅读树，您可能应该查看嵌套集结构而不是邻接列表。

使用嵌套集，您可以使用单个查询轻松检索正确嵌套的整个树。

有关树的讨论，请参阅这些问题。

[是否可以在单个查询中查询 MySQL 中的树结构表到任何深度？](https://stackoverflow.com/questions/169817/is-it-possible-to-query-a-tree-structure-table-in-mysql-in-a-single-query-to-any)

[在数据库中实现分层数据结构](https://stackoverflow.com/questions/544632/implementing-a-hierarchical-data-structure-in-a-database)

[将平面表解析为树的最有效/优雅的方法是什么？](https://stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:56:32.553

```
 $this->nodes[$row->parent_category_id][$row->id] = $row; 
```

此行正在破坏您的 ORDER BY display_order。将其更改为

```
 $this->nodes[$row->parent_category_id][] = $row; 
```

我的下一个问题是其中的 $row->parent_category_id 部分。不应该只是 $row->parent_id 吗？

编辑：哦，我没有仔细阅读你的资料。摆脱 WHERE 子句。一次阅读整个表格。您需要再次对树进行后期处理。首先，您将数据库读入数组列表。然后你递归地处理数组来做你的输出。

您的数组应如下所示：

```
 Array(0 => Array(1 => $obj, 5 => $obj), 
       1 => Array(2 => $obj),
       2 => Array(3 => $obj, 4 => $obj),
       5 => Array(6 => $obj) );

 function display_tree() {
      // all the stuff above
      output_tree($this->nodes[0], 0); // pass all the parent_id = 0 arrays.
 }

 function output_tree($nodes, $depth = 0) {
     foreach($nodes as $k => $v) {
         echo str_repeat(' ', $depth*2) . $v->print_me();
         // print my sub trees
         output_tree($this->nodes[$k], $depth + 1);
     }
 }

 output:
 object 1
   object 2
     object 3
     object 4
 object 5
   object 6 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:21:35.720

我认为这是这条线：

```
if($row->parent_category_id != 0) {
    $text .= "    ";
} 
```

应该：

```
while ($depth-- > 0) {
    $text .= "    ";
} 
```

你只是缩进一次，而不是它应该缩进的次数。

而这一行：

```
$this->get_tree($nextQuery, ++$depth, $row); 
```

应该：

```
$this->get_tree($nextQuery, $depth + 1, $row); 
```

请注意，您可能应该遵循另一个答案中的建议，一次抓取整个表，然后立即处理它，因为通常您希望最大限度地减少到数据库的往返行程（有一些用例你这样做的方式更优化，例如如果你有一棵非常大的树，并且正在选择它的一小部分，但我怀疑这里的情况）

# linux - 如何以 unix 精神进行编码？（小型单任务工具）

> ID：631200
> 
> 赞同：2
> 
> 时间：2009-03-10T16:47:46.800
> 
> 标签：linux, unix, scripting

我写了一个小脚本，它从我的相机中检索图片和电影，并根据它们的日期重命名它们，然后将它们复制到我的硬盘上，自动管理冲突（相同的名称？相同的大小？相同的 md5？）
效果很好。

但这是一个脚本。
有时我需要检查图片是否已经隐藏在卷中的某个位置，所以我只想应用“冲突管理器”。我想如果我正确地遵循了微型单任务工具的 unix 精神，我可以做到这一点。

什么是最佳资源、最佳实践和您在该主题上的经验？

谢谢你。

编辑：虽然我很想阅读 unix 书籍并对这个主题有深刻的理解，但我首先要寻找伟大的原则。另外，我倾向于将自己限制在在线资源上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T16:51:44.623

我会看一本名为 The [Art of Unix Programming](https://rads.stackoverflow.com/amzn/click/com/0131429019)的书。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T16:51:51.177

看看这本书：

Eric S. Raymond 的 Unix 编程艺术

[http://www.amazon.com/UNIX-Programming-Addison-Wesley-Professional-Computing/dp/0131429019](https://rads.stackoverflow.com/amzn/click/com/0131429019)

这是他的网站： http: [//www.catb.org/~esr/writings/taoup/](http://www.catb.org/~esr/writings/taoup/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T17:07:42.010

我发现大多数代码一开始并不是可重用的，而是逐渐成为可重用的。取出您现有的代码并将“冲突管理器”部分分解到它自己的函数或程序中，然后调用该程序而不是让它成为您原始应用程序的一部分。之后，您将能够重用您需要重用的那部分*代码*。有时不可能预先设计软件以实现可重用性，因为您根本不知道要重用哪些部分。

至于资源，书架上似乎堆满了 Linux 桌面用户和系统管理员的书籍，但很难找到好的 Linux*编程*书籍。几个不错的：

*   [开始 Linux 编程](https://rads.stackoverflow.com/amzn/click/com/0470147628)
*   [专业的 Linux 编程](https://rads.stackoverflow.com/amzn/click/com/0471776130)
*   [Linux 示例编程：基础](https://rads.stackoverflow.com/amzn/click/com/0131429647)
*   [Linux 程序员的工具箱](https://rads.stackoverflow.com/amzn/click/com/0132198576)

最后，Eric Raymond 使[The Art of Unix Programming](http://www.faqs.org/docs/artu/)在线免费提供。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:54:58.873

就个人而言，每当我看到我打算编写的脚本将超过十几行时，我都会使用 python 而不是 shell 脚本。python 脚本的一个巧妙技巧是，它很容易以一种创建“unix 精神”命令行工具和库的风格进行编程。例如，对于您的“冲突管理器”，创建一个文件（python 模块）并将功能放在函数和/或类中，然后最后您可以`if __name__=='__main__':`在解析命令行的地方放置一个 python“main”函数（通常的舞蹈）选项（为此使用内置的 OptionParser 模块，这非常好！）并使用函数/类中的功能。

这样，您既可以将该实用程序用作独立的命令行程序，也可以将模块导入另一个 python 脚本，并通过函数/类使用其中定义的功能，而不是解析输入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T16:54:57.503

[从维基百科开始（数据流编程）](http://en.wikipedia.org/wiki/Dataflow_programming)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T17:21:30.043

Kernighan 和 Plauger所著的[Software Tools](https://rads.stackoverflow.com/amzn/click/com/020103669X) (amazon) 一书是这方面的经典之作。我认为对于任何认真的软件开发学生来说，它都应该是必读的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T16:55:48.747

- UNIX 编程艺术 - 是一本相当不错的书，可以说是“unix 方式”，就目前而言。OTOH，如果方法是“尽可能少地完成工作”，那么您可能已经在那里了。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T16:56:04.987

我认为好的 gnu 代码的一些关键是：

*   正确处理系统信号，例如在收到 SIGTERM 时分离硬盘驱动器文件。
*   正确使用管道和标准输入/输出
*   遵循常见的命令行标志规则

我也会推荐[这](http://plan9.bell-labs.com/cm/cs/upe/)本书。很老了，但我认为解释unix的原理很清楚。

# c++ - 为什么需要第二个 cin.ignore() ？

> ID：631201
> 
> 赞同：5
> 
> 时间：2009-03-10T16:48:11.230
> 
> 标签：c++, input

我注意到，每当我编写一个使用`std::cin`该程序的程序时，如果我希望用户按 Enter 键结束程序，我必须编写`std::cin.ignore()`两次才能获得所需的行为。例如：

```
#include <iostream>

int main(void)
{
    int val = 0;
    std::cout << "Enter an integer: ";
    std::cin >> val;

    std::cout << "Please press Enter to continue..." << std::endl;

    std::cin.ignore();
    std::cin.ignore();  // Why is this one needed?
} 
```

我还注意到，当我不`cin`用于实际输入而只是用于最后的`ignore()`调用时，我只需要一个。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T16:59:53.433

*Discl：我正在简化真正发生的事情。*

第一个用于清除提取运算符 (>>) 未使用的内容。第二个等待另一个\n。

当我们在提取之后执行 std::getline 时，情况完全相同：`the_stream::ignore(std::numeric_limits<streamsize>::max(), '\n');`在调用 std::getline() 之前需要a

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T16:57:56.810

那很奇怪。你在什么平台上运行？根据定义，`ignore`从输入流中提取并丢弃 n 个字符，或者如果它遇到 EOF 则停止。如果您不指定任何参数，它将提取 1 个字符。在 Windows 上，行尾包含 a`\r`和 a `\n`-- 总共两个字符（回车后跟换行符）。

# regex - 长列表、多个正则表达式和性能

> ID：631202
> 
> 赞同：0
> 
> 时间：2009-03-10T16:48:22.993
> 
> 标签：regex

好的，我有一个很长的条目列表（大约 43,800 行），我想选择这个列表的一个子集。该列表位于数据库中，读取数据库的程序可以使用一个或多个正则表达式。

在一次调用数据库程序中使用多个（可能多达 100 个左右）正则表达式来基本上选择我想要的条目是否更好

或者

使用更少数量的正则表达式（最多大约 10 个）来选择更多条目到数组中，然后使用 for 循环和一些简单的 if 语句来过滤掉我不感兴趣的数据会更好吗？

我读过或听说过最好避免过度使用正则表达式，因为它们的计算成本很高？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T16:52:01.410

我会推荐第二种方法，特别是如果你能找到一种方法将正则表达式搜索分叉到不同的线程并获得一些并发性。分而治之，宝贝！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T17:21:49.247

KevDog 的回答似乎是正确的前进方向。

我只是想补充一点，您可能想同时尝试并衡量性能差异。这样，您将消除所有的猜测，它自然会考虑到您可能遇到的任何我们不可能知道的特殊情况。

# asp.net - “无法启用约束”错误在我的 ASP.Net 项目中不断出现（看似随机）

> ID：631210
> 
> 赞同：1
> 
> 时间：2009-03-10T16:49:58.247
> 
> 标签：asp.net, visual-studio-2008, error-handling, dataset

我有一个奇怪的问题，“无法启用约束。一行或多行包含违反非空、唯一或外键约束的值。” 当我尝试构建我的项目时，有时会弹出错误。

引发错误的行是数据集设计器文件中**自动生成**的代码。为了找出有问题的表，我使用了以下代码：

```
 Try
            Me.Adapter.Fill(dataTable) <--Breakpoint here on the offending line

        Catch ex As Exception

            For Each TRow As DataRow In dataTable.Rows
                If TRow.HasErrors Then
                    Trace.Write(TRow.RowError)
                End If
            Next

        End Try 
```

有趣的是，只要我在输入上述代码和断点后运行项目，错误就会消失。我认为这与重新生成的代码有关。所有数据都成功呈现，项目编译没有错误。

然而，这种情况经常发生，足以让我感到沮丧。任何人都知道可能导致错误的原因以及我如何隔离它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T16:55:24.600

您在数据表上放置了什么独特的约束，并且您是否验证过您传入的数据没有任何重复项？如果这是来自共享数据库，则可能其他人正在修改可能导致随机性的数据。

# 编辑

如果该代码与您所拥有的完全相同（请原谅我的 vb.net 不如我的 C# 强大）。它不会吞下异常吗？在 C# 中，我们需要重新抛出错误。

在进入 for 循环之前添加一个 Trace.Write() 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T17:13:58.033

您可能正在使用类型化的数据集，或者对其进行了一些代码配置。此外，您可能正在从一个表中读取数据，然后从另一个表中添加数据。

在任何这些情况下，您都真的想查看模式之间的任何不一致。如果它是类型化数据集/或在代码中配置，请检查其定义，并查找与 sql 表不同的任何内容。如果您从 2 个不同的表中读取，请检查两个表的定义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T16:50:55.557

终于想通了！

没有命中断点的原因是有问题的代码是自动生成的，并且具有属性“DebuggerNonUserCodeAttribute”。此外，在我的 VS 设置中，我已将调试器设置为“仅我的代码”。

当我再次运行代码时，没有命中断点，我注意到断点图标已变为警告。悬停显示：

```
"The breakpoint will currently not be hit. Breakpoints cannot be set in a method or class with the 'DebuggerNonUserCode' attribute when the debugger option 'Just My Code' is enabled." 
```

哎哟!

一旦我删除了“只是我的代码”调试选项，断点就被命中了，我发现其中一行在具有非空约束的列之一中具有 NULL 值。愚蠢的老我！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-18T15:29:11.700

您应该在填写 DataTable 之前使用此代码：

```
var dt = new System.DataTable.DataTable();
dt.Clear();
dt.Rows.Clear();
dt.Columns.Clear(); 
```

# php - 从数据库中获取最新条目

> ID：631214
> 
> 赞同：5
> 
> 时间：2009-03-10T16:50:27.823
> 
> 标签：php, sql, select, date

如何使用 PHP 从 MySQL 数据库中获取最新 DATE 字段的最新条目？

这些行不会按日期顺序排列，所以我不能只取第一行或最后一行。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-10T16:56:33.503

您需要[ORDER BY](http://www.w3schools.com/PHP/php_mysql_order_by.asp)子句，也许还有[LIMIT](http://dev.mysql.com/doc/refman/5.0/en/limit-optimization.html)子句。

```
$query = 'SELECT * FROM `table` ORDER BY `date` DESC LIMIT 1'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T16:57:29.570

```
SELECT * FROM [Table] ORDER BY [dateColumn] DESC 
```

如果您只想要第一行：

在 T-SQL 中：

```
SELECT TOP(1) * FROM [Table] ORDER BY [dateColumn] DESC 
```

在 MySQL 中：

```
SELECT * FROM `Table` ORDER BY `dateColumn` DESC LIMIT 1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:58:18.477

您可以结合使用[LIMIT](http://dev.mysql.com/doc/refman/5.0/en/select.html#id1050031)和[ORDER BY](http://dev.mysql.com/doc/refman/5.1/en/select.html#id2972920)子句。

例如：

```
SELECT * FROM entries ORDER BY timestamp DESC LIMIT 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T16:59:37.553

您没有可以键入的唯一记录 ID 或修订日期字段吗？除了创建的数据和修改日期的字段外，我总是至少有一个自动递增的数字字段。您确定没有可以键入的内容吗？

```
SELECT * FROM table ORDER BY recno DESC LIMIT 1; 
```

或者

```
SELECT * FROM table ORDER BY date_revised DESC LIMIT 1; 
```

所以 PHP 调用将是：

```
$result = mysql_query("SELECT * FROM table ORDER BY date_revised DESC LIMIT 1"); 
```

——尼古拉斯

# spring - Spring Security：如何获取初始目标 url

> ID：631217
> 
> 赞同：18
> 
> 时间：2009-03-10T16:50:45.297
> 
> 标签：spring, spring-security

我正在使用弹簧安全性来限制网址。我正在尝试在同一页面上提供注册和登录页面。

在登录 spring 安全转移到受限页面。但是我正在尝试将目标 url 传递给注册过程，以便在注册后我们可以重定向到受限页面。

如何获取用户被重定向的实际 URL。

有任何想法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-10T17:21:17.203

这就是我从 Spring Security 获取 URL 的方式。

```
SavedRequest savedRequest = (SavedRequest)session.getAttribute(
    AbstractProcessingFilter.SPRING_SECURITY_SAVED_REQUEST_KEY);
字符串 requestUrl = savedRequest.getFullRequestUrl();

```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-11-29T20:31:31.447

他们在 spring security 3.0 中移动了一些东西，所以上面的代码片段不再起作用了。不过，这可以解决问题：

```
protected String getRedirectUrl(HttpServletRequest request) {
    HttpSession session = request.getSession(false);
    if(session != null) {
        SavedRequest savedRequest = (SavedRequest) session.getAttribute(WebAttributes.SAVED_REQUEST);
        if(savedRequest != null) {
            return savedRequest.getRedirectUrl();
        }
    }

    /* return a sane default in case data isn't there */
    return request.getContextPath() + "/";
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-05-24T23:48:47.783

使用弹簧安全 4.1.4：

```
@Override
public void onAuthenticationSuccess(HttpServletRequest request,
        HttpServletResponse response, Authentication authentication)
        throws IOException, ServletException {

    SavedRequest savedRequest = new HttpSessionRequestCache().getRequest(request, response);
    if (savedRequest != null) {
        response.sendRedirect(savedRequest.getRedirectUrl());
    }
    else{
        response.sendRedirect("some/path");
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-06-03T06:42:31.900

```
DefaultSavedRequest savedRequest = (DefaultSavedRequest)session.getAttribute("SPRING_SECURITY_SAVED_REQUEST");

String requestURL = savedRequest.getRequestURL();   // URL <br>
String requestURI = savedRequest.getRequestURI();   // URI 
```

# c# - 是否有 C# 不区分大小写的等于运算符？

> ID：631233
> 
> 赞同：171
> 
> 时间：2009-03-10T16:52:52.123
> 
> 标签：c#, .net, string, operators, case-insensitive

我知道以下内容区分大小写：

```
if (StringA == StringB) { 
```

那么是否有一个运算符会以不敏感的方式比较两个字符串？

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-03-10T16:54:31.480

试试这个：

```
string.Equals(a, b, StringComparison.CurrentCultureIgnoreCase); 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2012-09-10T10:17:04.523

**比较忽略字母大小写的 2 个字符串的最佳方法**是使用[String.Equals](http://msdn.microsoft.com/en-us/library/t4411bks.aspx)静态方法指定序数忽略大小写字符串比较。这也是最快的方法，比将字符串转换为小写或大写并在此之后进行比较要快得多。

我测试了这两种方法的性能，序数忽略大小写字符串比较**快了 9 倍以上**！它也比将字符串转换为小写或大写更可靠（查看土耳其语 i 问题）。所以总是使用[String.Equals](http://msdn.microsoft.com/en-us/library/t4411bks.aspx)方法来比较字符串是否相等：

```
String.Equals(string1, string2, StringComparison.OrdinalIgnoreCase); 
```

如果要执行特定于文化的字符串比较，可以使用以下代码：

```
String.Equals(string1, string2, StringComparison.CurrentCultureIgnoreCase); 
```

请注意，第二个示例使用当前文化的字符串比较逻辑，这使得它比第一个示例中的“序数忽略大小写”比较慢，所以如果您不需要任何文化特定的字符串比较逻辑并且您是达到最佳性能后，使用“序数忽略大小写”比较。

有关更多信息，[请阅读我的博客上的完整故事](http://www.pvladov.com/2012/09/case-insensitive-string-comparison.html)。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-10T19:09:23.483

静态类上有许多属性可以`StringComparer`为您可能想要的任何类型的区分大小写返回比较器：

[`StringComparer`特性](http://msdn.microsoft.com/en-us/library/system.stringcomparer_properties.aspx)

例如，您可以调用

```
StringComparer.CurrentCultureIgnoreCase.Equals(string1, string2) 
```

或者

```
StringComparer.CurrentCultureIgnoreCase.Compare(string1, string2) 
```

它比带参数的`string.Equals`or重载要干净一些。`string.Compare`[`StringComparison`](http://msdn.microsoft.com/en-us/library/system.stringcomparison.aspx)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-03-10T16:54:40.920

```
System.Collections.CaseInsensitiveComparer 
```

或者

```
System.StringComparer.OrdinalIgnoreCase 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-10T16:55:27.797

```
string.Equals(StringA, StringB, StringComparison.CurrentCultureIgnoreCase); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-10T16:56:45.517

或者

```
if (StringA.Equals(StringB, StringComparison.CurrentCultureIgnoreCase)) { 
```

但您需要确保 StringA 不为空。所以可能更好的你使用：

```
string.Equals(StringA , StringB, StringComparison.CurrentCultureIgnoreCase); 
```

正如约翰建议的那样

编辑：更正了错误

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-10T16:56:01.947

您可以使用

```
if (stringA.equals(StringB, StringComparison.CurrentCultureIgnoreCase)) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-10T16:55:11.183

操作员？不，但我认为您可以更改您的文化，以便字符串比较不区分大小写。

```
// you'll want to change this...
System.Threading.Thread.CurrentThread.CurrentCulture
// and you'll want to custimize this
System.Globalization.CultureInfo.CompareInfo 
```

我相信它会改变 equals 运算符比较字符串的方式。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-05-09T12:30:49.057

这里有一个简化语法的想法：

```
public class IgnoreCase
{
    private readonly string _value;

    public IgnoreCase(string s)
    {
        _value = s;
    }

    protected bool Equals(IgnoreCase other)
    {
        return this == other;
    }

    public override bool Equals(object obj)
    {
        return obj != null &&
               (ReferenceEquals(this, obj) || (obj.GetType() == GetType() && this == (IgnoreCase) obj));
    }

    public override int GetHashCode()
    {
        return _value?.GetHashCode() ?? 0;
    }

    public static bool operator ==(IgnoreCase a, IgnoreCase b)
    {
        return string.Equals(a, b, StringComparison.OrdinalIgnoreCase);
    }

    public static bool operator !=(IgnoreCase a, IgnoreCase b)
    {
        return !(a == b);
    }

    public static implicit operator string(IgnoreCase s)
    {
        return s._value;
    }

    public static implicit operator IgnoreCase(string s)
    {
        return new IgnoreCase(s);
    }
} 
```

可用如：

```
Console.WriteLine((IgnoreCase) "a" == "b"); // false
Console.WriteLine((IgnoreCase) "abc" == "abC"); // true
Console.WriteLine((IgnoreCase) "Abc" == "aBc"); // true
Console.WriteLine((IgnoreCase) "ABC" == "ABC"); // true 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-07-24T02:29:46.607

我习惯于在这些比较方法的末尾打字：`, StringComparison.`

**所以我做了一个扩展。**

```
namespace System
{   public static class StringExtension
    {
        public static bool Equals(this string thisString, string compareString,
             StringComparison stringComparison)
        {
            return string.Equals(thisString, compareString, stringComparison);
        }
    }
} 
```

`thisString`请注意，在调用分机之前，您需要检查 null on 。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-10T16:55:31.167

```
if (StringA.ToUpperInvariant() == StringB.ToUpperInvariant()) { 
```

人们报告 ToUpperInvariant() 比 ToLowerInvariant() 快。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-10T17:19:29.160

```
string.Compare(string1, string2, true) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-03-10T10:46:33.310

其他人的回答在这里完全有效，但不知何故，输入`StringComparison.OrdinalIgnoreCase`和使用`String.Compare`.

我编写了简单的字符串扩展方法，您可以在其中指定比较是区分大小写还是不区分大小写的布尔值 - 请参见以下答案：

[https://stackoverflow.com/a/49208128/2338477](https://stackoverflow.com/a/49208128/2338477)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-08-03T16:29:08.423

//您可以通过 s1.ToLower() == s2.ToLower(); 使其不区分大小写

# android - 修改 Android seekbar 小部件以垂直操作

> ID：631238
> 
> 赞同：18
> 
> 时间：2009-03-10T16:54:17.910
> 
> 标签：android, layout, widget, seekbar

我试图让一个垂直搜索栏与模拟器一起使用，但我有点卡住了。我可以让搜索栏以我想要的方式显示，我可以让进度做我想做的事，我可以修改 onTouchEvent 让拇指垂直而不是水平移动。我不能做的是在不使用 setThumbOffset() 的情况下让拇指移动到默认的 29 个水平像素之外。这本身不是问题。问题出在我根本不了解 thumbOffset 的事实——我猜。我想我可以（正确地）调整小部件的大小，我很确定我做得不对。或者，如果我能弄清楚的话，也许我可以使用 thumbOffset 。由于我可以正确计算进度，我想我只会使用小部件的进度* (getTop() - getBottom()) 的线性函数，但这似乎并没有做到。但我无法弄清楚偏移的中心是什么。

顺便说一句，我真的不确定我在 onSizeChanged() 中所做的事情是否正常，或者以后是否会咬我的屁股。

这是 main.xml 布局：

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent" >

    <com.mobilsemantic.mobipoll.SlideBar
        android:id="@+id/slide"
        android:layout_width="wrap_content"
        android:layout_height="fill_parent"
        android:max="100"
        android:progress="0"
        android:secondaryProgress="25" />

        <Button android:id="@+id/button"
            android:layout_width="fill_parent"
            android:layout_height="fill_parent"
            android:text="Hello, I am a Button" />

    <TextView android:id="@+id/tracking"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content" />

</LinearLayout> 
```

和类（忽略调试垃圾）：

```
import android.content.Context;
import android.graphics.Canvas;
import android.util.AttributeSet;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.widget.SeekBar;

public class SlideBar extends SeekBar {

        private int oHeight = 320, oWidth = 29;
        private int oProgress = -1, oOffset = -1;;
        private float xPos = -1, yPos = -1;
        private int top = -1, bottom = -1, left = -1, right = -1;

        public SlideBar(Context context) {
                super(context);
        }
        public SlideBar(Context context, AttributeSet attrs)
        {
                super(context, attrs);
                oOffset = this.getThumbOffset();
                oProgress = this.getProgress();
        }
        public SlideBar(Context context, AttributeSet attrs, int defStyle)
        {
                super(context, attrs, defStyle);
        }

        protected synchronized void onMeasure(int widthMeasureSpec, intheightMeasureSpec)
        {
                int height = View.MeasureSpec.getSize(heightMeasureSpec);
                oHeight = height;
                this.setMeasuredDimension(oWidth, oHeight);

        }
        protected void onSizeChanged(int w, int h, int oldw, int oldh)
        {
                super.onSizeChanged(h, w, oldw, oldh);
        }
        protected void onLayout(boolean changed, int l, int t, int r, int b)
        {
                super.onLayout(changed, l, t, r, b);
                left = l;
                right = r;
                top = t;
                bottom = b;
        }
        protected void onDraw(Canvas c)
        {
                c.rotate(90);
                c.translate(0,-29);
                super.onDraw(c);
        }
        public boolean onTouchEvent(MotionEvent event)
        {
                xPos = event.getX();
                yPos = event.getY();
                float progress = (yPos-this.getTop())/(this.getBottom()-this.getTop());
                oOffset = this.getThumbOffset();
                oProgress = this.getProgress();
                Log.d("offset" + System.nanoTime(), new Integer(oOffset).toString());
                Log.d("progress" + System.nanoTime(), new Integer(oProgress).toString());

                float offset;

                offset = progress * (this.getBottom()-this.getTop());

                this.setThumbOffset((int)offset);

                Log.d("offset_postsetprogress" + System.nanoTime(), new Integer(oOffset).toString());
                Log.d("progress_postsetprogress" + System.nanoTime(), new Integer(oProgress).toString());

                this.setProgress((int)(100*event.getY()/this.getBottom()));
                return true;
        }

} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-04-19T10:45:01.257

我创建了一个可行的解决方案（至少对我来说，无论如何）并创建一个垂直的 SeekBar。 [http://hackskrieg.wordpress.com/2012/04/20/working-vertical-seekbar-for-android/](http://hackskrieg.wordpress.com/2012/04/20/working-vertical-seekbar-for-android/)

此代码将正确选择/取消选择拇指，正确移动，正确更新侦听器（仅在进度更改时！），正确更新/绘制进度等。希望对您有所帮助。

```
public class VerticalSeekBar extends SeekBar {

public VerticalSeekBar(Context context) {
    super(context);
}

public VerticalSeekBar(Context context, AttributeSet attrs, int defStyle) {
    super(context, attrs, defStyle);
}

public VerticalSeekBar(Context context, AttributeSet attrs) {
    super(context, attrs);
}

protected void onSizeChanged(int w, int h, int oldw, int oldh) {
    super.onSizeChanged(h, w, oldh, oldw);
}

@Override
protected synchronized void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    super.onMeasure(heightMeasureSpec, widthMeasureSpec);
    setMeasuredDimension(getMeasuredHeight(), getMeasuredWidth());
}

protected void onDraw(Canvas c) {
    c.rotate(-90);
    c.translate(-getHeight(), 0);

    super.onDraw(c);
}

private OnSeekBarChangeListener onChangeListener;
@Override
public void setOnSeekBarChangeListener(OnSeekBarChangeListener onChangeListener){
    this.onChangeListener = onChangeListener;
}

private int lastProgress = 0;
@Override
public boolean onTouchEvent(MotionEvent event) {
    if (!isEnabled()) {
        return false;
    }

    switch (event.getAction()) {
    case MotionEvent.ACTION_DOWN:
        onChangeListener.onStartTrackingTouch(this);
        setPressed(true);
        setSelected(true);
        break;
    case MotionEvent.ACTION_MOVE:
        // Calling the super seems to help fix drawing problems
        super.onTouchEvent(event);
        int progress = getMax() - (int) (getMax() * event.getY() / getHeight());

        // Ensure progress stays within boundaries of the seekbar
        if(progress < 0) {progress = 0;}
        if(progress > getMax()) {progress = getMax();}

        // Draw progress
        setProgress(progress);

        // Only enact listener if the progress has actually changed
        // Otherwise the listener gets called ~5 times per change
        if(progress != lastProgress) {
            lastProgress = progress;
            onChangeListener.onProgressChanged(this, progress, true);
        }

        onSizeChanged(getWidth(), getHeight() , 0, 0);
        onChangeListener.onProgressChanged(this, getMax() - (int) (getMax() * event.getY() / getHeight()), true);
        setPressed(true);
        setSelected(true);
        break;
    case MotionEvent.ACTION_UP:
        onChangeListener.onStopTrackingTouch(this);
        setPressed(false);
        setSelected(false);
        break;
    case MotionEvent.ACTION_CANCEL:
        super.onTouchEvent(event);
        setPressed(false);
        setSelected(false);
        break;
    }
    return true;
}

public synchronized void setProgressAndThumb(int progress) {
    setProgress(getMax() - (getMax()- progress));
    onSizeChanged(getWidth(), getHeight() , 0, 0);
}

public synchronized void setMaximum(int maximum) {
    setMax(maximum);
}

public synchronized int getMaximum() {
    return getMax();
}
} 
```

我只是将这个垂直的 SeekBar 放在一个 LinearLayout 中，layout_height 设置为 FILL_PARENT，layout_width 设置为 WRAP_CONTENT。

```
<LinearLayout
    android:layout_width="wrap_content"
    android:layout_height="fill_parent"
    android:orientation="vertical" >

    <com.safetyculture.jsadroidtablet.VerticalSeekBar
        android:id="@+id/calculatorVerticalSeekBar"
        android:layout_width="wrap_content"
        android:layout_height="fill_parent"
        android:layout_gravity="bottom"
        android:max="4"
        android:progress="2" />

</LinearLayout> 
```

注意：您必须设置 OnSeekBarChangeListener，否则与 SeekBar 交互将产生 NullPointerException。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-07-28T03:21:07.607

您可以在 [http://560b.sakura.ne.jp/android/VerticalSlidebarExample.zip](http://560b.sakura.ne.jp/android/VerticalSlidebarExample.zip)下载，希望对您有所帮助

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-02-08T18:24:37.507

对于`API 11 and later`, 可以使用`seekbar's XML`属性`(android:rotation="270")`来实现垂直效果。

```
<SeekBar
android:id="@+id/seekBar1"
android:layout_width="match_parent"
android:layout_height="wrap_content"
android:rotation="270"/> 
```

对于较旧的 API 级别（前 API10），请使用：[https](https://github.com/AndroSelva/Vertical-SeekBar-Android) ://github.com/AndroSelva/Vertical-SeekBar-Android 或在此处查看此[示例](https://stackoverflow.com/a/28397530/3496570)

> **您还必须按照 Iftikhar 的建议更新它的高度和宽度**

为了

```
seekBar.setLayoutParams(
                new ViewGroup.LayoutParams(convertDpToPixels(1.0f,mContext), ViewGroup.LayoutParams.WRAP_CONTENT)); 
```

//没有测试..

在哪里

```
public static int convertDpToPixels(float dp, Context context){
    Resources resources = context.getResources();
    return (int) TypedValue.applyDimension(
            TypedValue.COMPLEX_UNIT_DIP,
            dp, 
            resources.getDisplayMetrics()
    );
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T18:50:34.073

看看[安卓源码](http://android.git.kernel.org/?p=platform/frameworks/base.git;a=blob;f=core/java/android/widget/AbsSeekBar.java;h=9ebfa8656688ac7c683d3fcfceacb15614b46957;hb=HEAD)。我认为您至少需要更改 trackTouchEvent 并且可能还有其他一些地方您还需要交换 x,y 坐标以考虑控件的旋转。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-06T02:03:26.917

您能否将搜索栏保持水平，将其置于框架布局中，然后在 java 中将布局旋转 90 度？听起来可行...

# debugging - 如何在 Windowed C++ 项目中获得控制台输入和输出？

> ID：631249
> 
> 赞同：1
> 
> 时间：2009-03-10T16:55:13.913
> 
> 标签：debugging, console, window

我想用 C++ 制作一个调试系统，我可以从控制台获取输入和输出。输出是最重要的，但我也想获得输入以便能够在程序执行期间更改设置。

有没有人有解决这个困境的好方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T17:03:43.177

看看[http://msdn.microsoft.com/en-us/library/ms681944(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms681944(VS.85).aspx)

*   分配控制台
*   附加控制台
*   获取标准句柄
*   写文件
*   读取文件

# mysql - SQL（MySQL）中有没有办法在特定字段上执行“循环” ORDER BY？

> ID：631259
> 
> 赞同：6
> 
> 时间：2009-03-10T16:56:12.133
> 
> 标签：mysql, sql-order-by

SQL（MySQL）中有没有办法在特定字段上执行“循环” ORDER BY？

举个例子，我想拿一张这样的桌子：

```
+-------+------+
| group | name |
+-------+------+
|     1 | A    |
|     1 | B    |
|     1 | C    |
|     2 | D    |
|     2 | E    |
|     2 | F    |
|     3 | G    |
|     3 | H    |
|     3 | I    |
+-------+------+ 
```

并运行按以下顺序生成结果的查询：

```
+-------+------+
| group | name |
+-------+------+
|     1 | A    |
|     2 | D    |
|     3 | G    |
|     1 | B    |
|     2 | E    |
|     3 | H    |
|     1 | C    |
|     2 | F    |
|     3 | I    |
+-------+------+ 
```

请注意，该表可能有很多行，因此我无法在应用程序中进行排序。（我显然在查询中也有一个 LIMIT 子句）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T17:04:15.390

我会尝试类似的东西：

```
SET @counter = 0;
SELECT (@counter:=@counter+1)%3 as rr, grp, name FROM table ORDER by rr, grp 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T17:02:47.700

您可以做的是创建一个临时列，在其中创建集合以提供如下内容：

```
+-------+------+-----+
| group | name | tmp |
+-------+------+-----+
|     1 | A    |   1 |
|     1 | B    |   2 |
|     1 | C    |   3 |
|     2 | D    |   1 |
|     2 | E    |   2 |
|     2 | F    |   3 |
|     3 | G    |   1 |
|     3 | H    |   2 |
|     3 | I    |   3 |
+-------+------+-----+ 
```

要了解如何创建集合，请查看此[问题/答案](https://stackoverflow.com/questions/532878/how-to-perform-grouped-ranking-in-mysql)。

然后它是一个简单的

```
ORDER BY tmp, group, name 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T17:13:27.053

您可以使用 MySQL 变量来执行此操作。

```
SELECT grp, name, @row:=@row+1 from table, (SELECT @row:=0) r ORDER BY (@row % 3);

+------+------+--------------+
| grp  | name | @row:=@row+1 |
+------+------+--------------+
|    1 | A    |            1 |
|    2 | D    |            4 |
|    3 | G    |            7 |
|    1 | B    |            2 |
|    2 | E    |            5 |
|    3 | H    |            8 |
|    1 | C    |            3 |
|    2 | F    |            6 |
|    3 | I    |            9 |
+------+------+--------------+ 
```

# regex - Actionscript 3 处理器中的正则表达式使用是否密集？

> ID：631260
> 
> 赞同：4
> 
> 时间：2009-03-10T16:56:30.853
> 
> 标签：regex, actionscript-3

我很好奇 AS3 正则表达式测试会给最终用户的电脑带来多大的压力。这是应该适度使用的东西，还是大多数计算机可以处理它的详尽使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T03:46:30.900

仅在病理情况下。在实践中，您永远不必担心它。正则表达式非常有效。

例如，许多正则表达式引擎存在严重的性能问题，无法将不以 b 结尾的 'a 字符串与这种类型的表达式匹配。

```
/a*a*a*a*a*a*a*a*a*a*a*a*a*a*a*a*a*a*a*[b]/ 
```

测试将快速识别像这样的奇怪边缘情况。否则，如果您重复检查相同的模式，只需使用常识，例如不要创建多个 RegExp 对象。

# c - C中的函数指针和回调

> ID：631273
> 
> 赞同：13
> 
> 时间：2009-03-10T16:57:54.670
> 
> 标签：c, function, pointers, callback

我已经开始审查回调。我在 SO 上找到了这个链接： [什么是 C 中的“回调”以及它们是如何实现的？](https://stackoverflow.com/questions/142789/what-is-a-callback-in-c-and-how-are-they-implemented) 它有一个很好的回调示例，与我们在工作中使用的非常相似。但是，我试图让它工作，但我有很多错误。

```
#include <stdio.h>

/* Is the actual function pointer? */
typedef void (*event_cb_t)(const struct event *evt, void *user_data);

struct event_cb
{
    event_cb_t cb;
    void *data;
};

int event_cb_register(event_ct_t cb, void *user_data);

static void my_event_cb(const struct event *evt, void *data)
{
    /* do some stuff */
}

int main(void)
{
    event_cb_register(my_event_cb, &my_custom_data);

    struct event_cb *callback;

    callback->cb(event, callback->data);

    return 0;
} 
```

我知道回调使用函数指针来存储函数的地址。但是有几件事我觉得我不明白：

*   “注册回调”和“事件调度程序”是什么意思？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-10T17:12:28.537

此代码在带有 -Wall 的 GCC 下编译和运行。

```
#include <stdio.h>

struct event_cb;

typedef void (*event_cb_t)(const struct event_cb *evt, void *user_data);

struct event_cb
{
    event_cb_t cb;
    void *data;
};

static struct event_cb saved = { 0, 0 };

void event_cb_register(event_cb_t cb, void *user_data)
{
    saved.cb = cb;
    saved.data = user_data;
}

static void my_event_cb(const struct event_cb *evt, void *data)
{
    printf("in %s\n", __func__);
    printf("data1: %s\n", (const char *)data);
    printf("data2: %s\n", (const char *)evt->data);
}

int main(void)
{
    char my_custom_data[40] = "Hello!";
    event_cb_register(my_event_cb, my_custom_data);

    saved.cb(&saved, saved.data);

    return 0;
} 
```

您可能需要检查回调函数是否获取整个 struct event_cb - 通常，您只需传递数据，因为如所示，否则您有两个相同信息的来源（以及指向的指针的备用副本您所在的功能）。可以对此进行很多清理 - 但它确实有效。

* * *

评论中的一个问题是：这是回调的一个很好的例子吗？

简而言之，没有——但部分原因是这里没有足够的基础设施。

从某种意义上说，你可以将传递给`qsort()`or`bsearch()`函数的比较函数视为回调。它是一个指向传递给通用函数的函数的指针，该函数执行通用函数不能为自己做的事情。

回调的另一个示例是信号处理函数。当事件（信号）发生时，您告诉系统调用您的函数。您提前设置机制，以便当系统需要调用函数时，它知道要调用哪个函数。

示例代码试图提供一种更精细的机制——带有上下文的回调。在 C++ 中，这可能是一个仿函数。

我使用的一些代码对内存管理有非常挑剔的要求——当在特定上下文中使用时。因此，为了测试，我使用`malloc()`et al，但在生产中，我必须将内存分配器设置为专门的分配器。然后我在包中提供了一个函数调用，以便繁琐的代码可以使用自己的代理版本覆盖默认内存分配器 - 并且如果代理工作正常，代码将像以前一样运行。这些是回调的一种形式——同样，一种不需要太多（或任何东西）用户上下文数据的形式。

窗口系统具有已注册的事件处理程序（回调），并且 GUI 主事件循环将在事件发生时调用。这些通常需要用户上下文以及 GUI 系统提供的特定于事件的信息。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-10T17:17:19.023

> “注册回调”和“事件调度程序”是什么意思？

“注册回调”是告诉底层系统要调用哪个精确函数，以及（可选地）使用哪些参数，以及可能还为哪个特定类的事件调用回调的行为。

“事件调度程序”从操作系统（或 GUI 等）接收事件，并通过查看已注册回调列表以查看哪些对该事件感兴趣，从而实际调用回调。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T17:09:02.320

没有编译器输出很难，但我可以看到一些问题；

```
int event_cb_register(event_ct_t cb, void *user_data); 
```

应该

```
int event_cb_register(event_cb_t cb, void *user_data); 
```

变量在`my_custom_data`此处使用时不存在；

```
event_cb_register(my_event_cb, &my_custom_data); 
```

这个指针永远不会被初始化；

```
struct event_cb *callback; 
```

并在;

```
callback->cb(event, callback->data); 
```

您不能将类型（“事件”）的名称传递给函数，您必须传递该类型的实例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T17:13:06.460

```
int event_cb_register(event_ct_t cb, void *user_data); 
```

那是什么类型`event_ct_t`？你的意思是`event_cb_t`？

```
struct event_cb *callback; 
```

创建指向结构的未初始化指针`event_cb`。请注意，这主要指向垃圾。

```
callback->cb(event, callback->data); 
```

你试图称之为垃圾。你需要初始化：

```
struct event_cb callback;
callback.cb = my_event_cb;
callback.data = 42; 
```

或一些这样的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T17:11:33.030

注册回调意味着您指定在感兴趣的事件发生时应该调用哪个函数。基本上，您在注册回调时设置函数指针。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-27T20:18:32.273

您创建了您声明的结构的指针，但它不指向任何东西：

```
struct event_cb *callback; 
```

您应该只创建一种结构类型：

```
struct event_cb callback; 
```

然后将其地址传递给函数。

# c++ - const 指针作为构造函数参数

> ID：631282
> 
> 赞同：0
> 
> 时间：2009-03-10T16:59:04.467
> 
> 标签：c++

这是一个奇怪的问题。请注意，这是减少了示例代码，并且故意遗漏了析构函数）。

```
template <class f, class g> class Ptr;

class RealBase
{
};

template <class a, class b, class c = Ptr<a,b> >
class Base : public RealBase
{
public:
    Base(){};
};

template <class d, class e>
class Derived : public Base <d,e>
{
public:
    Derived(){};
    void DerivedMethod(){};
};
typedef Derived<double,double> D_Derived;

template <class f, class g>
class Ptr
{
public:
    Ptr(){};
    Ptr(Base<f,g,Ptr<f,g> >* a){in = a;};
    Base<f,g,Ptr<f,g> >* operator->()
    {
        return in;
    };

    Base<f,g,Ptr<f,g> >& operator*()
    {
        return *in;
    };
private:
    Base<f,g,Ptr<f,g> >* in;
}; 
```

我在向量中使用此示例中的 Ptr 类作为指向 Derived 类的指针。

正如我们所看到的，Ptr 将 a`Base<>*`作为它的构造函数参数。

不幸的是，我需要一个带有 const Base<>* 的构造函数，我不能简单地这样做：

```
Ptr(const Base<>* a) { in = const_cast<Base<>*>(a)}; 
```

有什么想法可以让这个类接受 a`const Base<>*`作为它的构造函数吗？

* * *

编辑：

好的，事实证明我可以通过更改不相关的代码来解决这个问题，所以现在它有点不成问题了=]我花了大约一天时间来修复它=[

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T17:20:51.060

我认为您需要定义一个单独的类来包装指向 const 的指针，因为不仅构造函数的参数，而且运算符的返回类型都应该更改为 const 版本。如果你制作`ConstPtr`a `friend`of `Ptr`，这应该会很好地工作：

```
template<...>
class ConstPtr {
  const Base<...> *in;
  ConstPtr(Base<...>* a) { in = a; }
  ConstPtr(const Base<...>* a) { in = a; }
  ConstPtr(const Ptr<...> &a) { in = a.in; }
  ...
}; 
```

要从原始指针构造包装器，您可以添加一个重载函数，或多或少像这样：

```
template<..., class P>
P make_ptr(Base<...> *t);

template<...>
Ptr<...> make_ptr< ..., Ptr<...> >(Base<...> *t) {
  return Ptr(t);
}

template<...>
ConstPtr<...> make_ptr< ..., ConstPtr<...> >(const Base<...> *t) {
  return ConstPtr(t)
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:04:44.297

您的`Ptr`类有一个非常量指针成员。`const Base*`如果没有一些不安全的演员表，您将无法分配 a 。你想要那个吗？试试这个：

```
template <class f, class g>
class Ptr
{
   public:
    Ptr(){};
    Ptr(Base<f,g,Ptr<f,g> > const* a) { in = *a; }
    Base<f,g,Ptr<f,g> >* operator->()
    {
        return &in;
    };

    Base<f,g,Ptr<f,g> >& operator*()
    {
        return in;
    };

private:
    Base<f,g,Ptr<f,g> > in;
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:16:30.990

根据你的例子你应该做

```
Ptr( const Base< f,g, Ptr< f, g > >* a )
{
   in = const_cast< Base<f,g,Ptr<f,g> >* > ( a );
} 
```

ps：我不喜欢 const_cast 并且在类似的情况下我尽量避免这种情况。可能需要为 const 和非 const 参数执行 Ptr 的两个实现。

# haskell - Haskell中的点运算符：需要更多解释

> ID：631284
> 
> 赞同：95
> 
> 时间：2009-03-10T16:59:13.060
> 
> 标签：haskell, syntax, function-composition

我试图了解点运算符在此 Haskell 代码中的作用：

```
sumEuler = sum . (map euler) . mkList 
```

整个源代码如下。

## 我的理解

点运算符将两个函数`sum`以及结果`map euler`和结果`mkList`作为输入。

但是，`sum`不是函数，而是函数的参数，对吗？那么这里发生了什么？

还有，在`(map euler)`做什么？

## 代码

```
mkList :: Int -> [Int]
mkList n = [1..n-1]

euler :: Int -> Int
euler n = length (filter (relprime n) (mkList n))

sumEuler :: Int -> Int
sumEuler = sum . (map euler) . mkList 
```

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2009-03-10T17:07:51.480

简单地说，`.`就是函数组合，就像在数学中一样：

```
f (g x) = (f . g) x 
```

在您的情况下，您正在创建一个新函数，`sumEuler`也可以这样定义：

```
sumEuler x = sum (map euler (mkList x)) 
```

您示例中的样式称为“无点”样式-省略了函数的参数。在许多情况下，这使得代码更清晰。（第一次看到它可能很难理解，但一段时间后你会习惯它。这是一个常见的 Haskell 习语。）

如果您仍然感到困惑，那么将其与 `.`UNIX 管道之类的东西联系起来可能会有所帮助。如果`f`' 的输出变成`g`' 的输入，其输出变成`h`' 的输入，你可以在命令行上写成`f < x | g | h`. 在 Haskell 中，`.`像 UNIX 一样工作`|`，但“倒退”了 -- `h . g . f $ x`。我发现这种表示法在处理列表时非常有用。而不是一些笨拙的结构`map (\x -> x * 2 + 10) [1..10]`，你可以写`(+10) . (*2) <$> [1..10]`。（而且，如果您只想将该函数应用于单个值；它是`(+10) . (*2) $ 10`. 一致的！）

Haskell wiki 有一篇更详细的好文章：[http ://www.haskell.org/haskellwiki/Pointfree](http://www.haskell.org/haskellwiki/Pointfree)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-10T17:10:05.343

这 。运算符组成函数。例如，

```
a . b 
```

其中*a*和*b*是函数是一个新**函数**，它在其参数上运行 b，然后在这些结果上运行 a。你的代码

```
sumEuler = sum . (map euler) . mkList 
```

与以下内容完全相同：

```
sumEuler myArgument = sum (map euler (mkList myArgument)) 
```

但希望更容易阅读。*map euler*周围有括号的原因是因为它更清楚地说明了由 3 个函数组成：*sum*、*map* euler和*mkList* - *map* euler是一个函数。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-10T18:15:24.157

`sum`是 Haskell Prelude 中的一个函数，而不是`sumEuler`. 它有类型

```
Num a => [a] -> a 
```

函数组合运算符`.` 具有类型

```
(b -> c) -> (a -> b) -> a -> c 
```

所以我们有

```
 euler           ::  Int -> Int
       map                 :: (a   -> b  ) -> [a  ] -> [b  ]
      (map euler)          ::                 [Int] -> [Int]
                    mkList ::          Int -> [Int]
      (map euler) . mkList ::          Int ->          [Int]
sum                        :: Num a =>                 [a  ] -> a
sum . (map euler) . mkList ::          Int ->                   Int 
```

请注意，这`Int`确实是类型类的一个实例`Num`。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-10T17:08:08.377

这 。运算符用于函数组合。就像数学一样，如果你必须使用函数 f(x) 和 g(x) f 。g 变为 f(g(x))。

map 是一个内置函数，它将函数应用于列表。通过将函数放在括号中，函数被视为参数。一个术语是[currying](http://www.haskell.org/haskellwiki/Currying)。你应该查一下。

所做的是它接受一个带有两个参数的函数，它应用参数欧拉。（地图欧拉）对吧？结果是一个新函数，它只接受一个参数。

总和。（地图欧拉）。mkList 基本上是将所有这些放在一起的一种奇特方式。我必须说，我的 Haskell 有点生锈，但也许你可以自己把最后一个功能放在一起？

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-01-28T04:06:22.467

> ## Haskell 中的点运算符
> 
> 我试图了解点运算符在此 Haskell 代码中的作用：
> 
> ```
> sumEuler = sum . (map euler) . mkList 
> ```

## 简短的回答

没有点的等效代码，就是

```
sumEuler = \x -> sum ((map euler) (mkList x)) 
```

或没有 lambda

```
sumEuler x = sum ((map euler) (mkList x)) 
```

因为点 (.) 表示函数组合。

## 更长的答案

`euler`首先，让我们简化to的部分应用`map`：

```
map_euler = map euler
sumEuler = sum . map_euler . mkList 
```

现在我们只有点。这些点表示什么？

从[来源](http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html#.)：

> ```
> (.)    :: (b -> c) -> (a -> b) -> a -> c
> (.) f g = \x -> f (g x) 
> ```

这`(.)`就是[compose 运算符](https://en.wikipedia.org/wiki/Function_composition)。

## 撰写

在数学中，我们可以将函数 f(x) 和 g(x) 的组合，即 f(g(x)) 写成

> (f ∘ g)(x)

可以读作“f 由 g 组成”。

所以在 Haskell 中，f ∘ g 或 f 由 g 组成，可以写成：

```
f . g 
```

组合是关联的，这意味着使用组合运算符编写的 f(g(h(x))) 可以省略括号而不会产生任何歧义。

也就是说，由于 (f ∘ g) ∘ h 等价于 f ∘ (g ∘ h)，我们可以简单地写成 f ∘ g ∘ h。

## 盘旋回来

回到我们之前的简化，这个：

```
sumEuler = sum . map_euler . mkList 
```

只是意味着这`sumEuler`是这些功能的未应用组合：

```
sumEuler = \x -> sum (map_euler (mkList x)) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-10T17:09:09.217

点运算符将左侧 ( `sum`) 的函数应用于右侧函数的输出。在您的情况下，您将多个函数链接在一起 - 您将结果传递`mkList`给 to `(map euler)`，然后将结果传递给`sum`. [这个网站](http://micah.cowan.name/2008/10/10/computers/software-development/adventures-in-haskell-part-2-kewlness/)很好地介绍了几个概念。

# visual-studio - 我有一个使用 GUI 主题的遗留 C++ 项目。我想为这个项目创建一个 Visual Studio 解决方案。这可能吗？

> ID：631300
> 
> 赞同：0
> 
> 时间：2009-03-10T17:03:29.697
> 
> 标签：visual-studio, motif

我有一个使用 GUI 主题的遗留 C++ 项目。我想为这个项目创建一个 Visual Studio 解决方案。这样我就可以从 Visual Studio 构建/运行/调试。目前我在一个windows盒子上。我 ssh 进入一个 Unix 机器并使用 cc 来构建和 dbx 来调试。当我运行应用程序时，我将显示更改为 windows 框并使用 xming 作为 xwindows 显示。

甚至可以使用此设置从 Visual Studio 构建/运行/调试吗？

TIA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T17:15:18.547

我不知道 Windows 的 Motif 实现，我认为这很难做到，因为 Motif 已经与 X-Windows 密切相关了几十年。

我假设您想使用 Visual Studio，因为它是一个更友好的环境？在这种情况下，您可能希望考虑在 Unix 上获得更好的工具，以使您的开发体验更加愉快。Unix 上有各种可用的 IDE（如果那是你的毒药），从无处不在的 Eclipse 到 SunStudio（如果你在 SUN 上），当然还有所有允许你使用更强大的 Unix 编辑器（如 Emacs）的集成工具或 VIM。

如果您的服务器连接缓慢/不稳定/昂贵等，并且您更愿意在桌面上开发，为什么不使用 Linux 版本的虚拟机，或者如果您正在为 Solaris 开发，OpenSolaris 或 Solaris 11 开发人员预览版之一内置于您机器上的虚拟机并在该虚拟机上工作？

# php - 在条件表达式中运行查询数据类型不匹配时出现 Sql 错误

> ID：631304
> 
> 赞同：0
> 
> 时间：2009-03-10T17:04:19.243
> 
> 标签：php, sql

运行下面给出的 SQL 查询时出现以下错误

> '警告：odbc_exec() [function.odbc-exec]：SQL 错误：[Microsoft][ODBC Microsoft Access Driver] 条件表达式中的数据类型不匹配。，SQL 状态 22005?T 在 D:\xampp\htdocs\fypphp 中的 SQLExecDirect \functions.php 在第 543 行'

```
INSERT INTO vehicle_log
(modem_ID, longitude, latitude, sattelite_strength, [timestamp], speed, Heading, Altitude, ReportID, Input, Output)
values
('$modem_id', '$longitude', '$latitude', '$satelite_str', '$timestamp', '$speed', '$heading', '$altitude', '$report_id', '$input', '$output') 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:18:27.850

您可能需要转换您的变量之一。您的列类型是什么？还可以尝试放入一些样本/测试数据来缩小问题范围。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T19:30:37.347

变量的数据类型和表中字段的数据类型是什么？

顺便说一句，如果这是新的发展，我会修复带有 sattelite 一词的专栏，因为拼写错误。多年来，这会让你发疯。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:21:13.803

是否有任何字段为数字，例如 ReportID？然后你应该删除值周围的撇号。

编辑：
以纬度、经度和卫星强度为数字，你应该有：

```
INSERT INTO vehicle_log
(modem_ID, longitude, latitude, sattelite_strength, [timestamp], speed, Heading, Altitude, ReportID, Input, Output)
values
('$modem_id', $longitude, $latitude, $satelite_str, '$timestamp', '$speed', '$heading', '$altitude', '$report_id', '$input', '$output') 
```

如果时间戳是一个日期，你应该有：

```
INSERT INTO vehicle_log
(modem_ID, longitude, latitude, sattelite_strength, [timestamp], speed, Heading, Altitude, ReportID, Input, Output)
values
('$modem_id', $longitude, $latitude, $satelite_str, #$timestamp#, '$speed', '$heading', '$altitude', '$report_id', '$input', '$output') 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-07T21:34:10.433

您正在尝试添加`$modem_id`它可能是自动增量？离开`$mode_id`了，它会自动添加它;ly。

# asp.net - 是否可以在 ASP.NET 3.5（不是 MVC）中使用 Rhino.Commons.HttpModules.UnitOfWorkApplication？

> ID：631316
> 
> 赞同：0
> 
> 时间：2009-03-10T17:06:01.483
> 
> 标签：asp.net, nhibernate, rhino-commons, rhino-tools, unitofworkapplication

我试图找到有关在 ASP.NET（不是 MVC）中使用 UnitOfWorkApplication 的教程/文章。但我能找到的所有信息都是关于如何在 ASP.NET MVC 中使用它。

这是否意味着在我们旧的 webform 应用程序中无法使用 Rhino.Commons.HttpModules.UnitOfWorkApplication ？

我遇到了我在 ASP.NET 页面中使用从 Rhino.Commons.NHRepository 继承的存储库的问题。它需要在调用存储库中的函数之前调用 UnitOfWork.Start()。我在弄清楚如何将它连接到 ASP.NET 中迷失了方向。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T23:05:51.417

是的，它适用于常规 ASP.NET。只需让您的 GlobalApplication 从 UnitOfWorkApplication 继承即可。UnitOfWork.Start() 在请求开始时自动执行（[源代码](https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/commons/Rhino.Commons.NHibernate/HttpModules/UnitOfWorkApplication.cs)）。

如需参考，请查看[wiki 页面](http://ayende.com/Wiki/(S(onigqo455ao5du5550lswy45))/HttpModules.ashx)。

# text - seadragon（或其他）的全景文本可视化？

> ID：631328
> 
> 赞同：1
> 
> 时间：2009-03-10T17:09:14.253
> 
> 标签：text, visualization

我正在将具有 100k 行、最多 1k 个字符/行的文本文件可视化为一个大的、可导航的图像。

类似于 blaise 的 seadragon TED 演讲演示中的荒凉房屋示例，但更简单 - 基本上只是来自 的视图`cat filename.txt`，但视图已缩小，因此整个文件最初可见（每行适合页面宽度，*没有wordwrap*），然后可以放大。

目前海龙有可能吗？如果没有，关于我如何尝试它的任何想法？

（哦，包括超链接会很棒——但我不认为这是可能的。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-15T14:31:23.543

不确定您能否达到 100k 行，但带有 Flash 文本引擎的[OpenZoom SDK可以让您走得更远。](http://openzoom.org/)

**示例** [http://gasi.ch/go/openzoom-fte/](http://gasi.ch/go/openzoom-fte/)

**源代码** [http://github.com/openzoom/sdk/raw/be50b3f1062e68d88dcf20f412e6fdb9b7320ed3/examples/flex/flash-text-engine/src/FlashTextEngine.mxml](http://github.com/openzoom/sdk/raw/be50b3f1062e68d88dcf20f412e6fdb9b7320ed3/examples/flex/flash-text-engine/src/FlashTextEngine.mxml)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T14:54:56.230

第二次投票给这个问题的答案...我想使用 seadragon 或其他技术来达到类似的效果。

# c# - C#中的LINQ WHERE查询问题

> ID：631329
> 
> 赞同：1
> 
> 时间：2009-03-10T17:09:20.587
> 
> 标签：c#, linq

好的，我试图让一个 MVC 示例页面正常工作，并且基本上查询指定了某个 id 的位置，但我对这一切都很陌生，经过一个小时的尝试，我希望你能帮助我！

下面的代码是我的 taskController.cs 中通过 /tasks/complete/2 调用的方法

```
//mark task as complete
    public ActionResult Complete(int id)
    {
        IEnumerable<task> tasks = from t in db.tasks where t.taskID = id select t;

        foreach (task myTask in tasks)
        {
            myTask.isComplete = true;
        }
        db.SubmitChanges();

        return RedirectToAction("Index");
    } 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-10T17:12:07.570

虽然这些术语听起来很相似，但重要的是要记住 LINQ 不是 SQL。尝试使用双等号进行比较：

```
 IEnumerable<task> tasks = from t in db.tasks where t.taskID == id select t; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T17:13:17.193

尝试“==”为“其中 t.taskID == id”

# bids - 如何投标开发项目？

> ID：631332
> 
> 赞同：6
> 
> 时间：2009-03-10T17:10:27.293
> 
> 标签：bids

我有一个附带项目，一家公司希望我开发一个数据库/智能客户端来跟踪他们各种项目的参与者。此应用程序将使用 C# 和 MS SQL Server 编写。

我想知道是否有任何关于如何实际投标工作价格的提示？

1.  我应该收取固定费率吗（如果是这样，您如何收费？）
2.  我应该按小时收费吗（如果是这样，现行费率是多少？）
3.  我应该签订某种合同吗？

任何评论或提示都会非常有帮助，因为我对在我的正常编程工作之外进行“兼职”是完全陌生的。

提前致谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-10T17:13:36.380

是的，您应该签订合同，您需要详细说明预期可交付成果和付款的工作条款和条件。您还需要指出谁拥有源代码。

我更喜欢时间和材料合同，即他们按小时收费。这允许他们更改范围而无需重新协商条款。如果您使用固定投标项目，那么当用户开始了解他们想要什么并更改规范时，您将不得不做出选择。要么免费做，要么协商范围变更。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T17:13:45.350

你的目标是得到这份工作，一旦你得到它，赚到足够的钱让它值得你花时间，对吧？考虑到这一点，如果客户要求，您可以采用统一费率，否则尝试每小时获取一次，因为总会有障碍，并且客户总是会从第一天到最后一分钟向您抛出变化，这将如果您愿意，请浪费您的时间。无论哪种方式，都要获得一份合同，其中指定您要交付的内容以及如何处理变更请求。

我曾经为一个客户做了一系列的固定价格合同，效果很好。然后他们说他们在从总部获得这份合同的签名时遇到了一点问题，但如果我只是做这项工作，他们会确保我最终得到工作报酬。所以我花了两个月的时间来解决这个问题，结果却被告知他们被总部拒绝了，所以我不会得到报酬。我有 90% 的把握在我从他们的服务器上删除我的作品之前，他们已经复制了我的作品，但我无法在法庭上证明。所以我再也不会在没有签订合同的情况下工作。如果他们在第一天没有签订合同，那就滚蛋吧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:16:14.127

如果您是初学者，我建议您不要使用统一费率……除非您准备承担超出报酬的工作风险。本来就很难估计一个项目需要付出的努力。

您可以采取的费率取决于您的市场以及您如何珍惜时间。当你手头有空闲时间或者你只是对这个主题感兴趣时，接受一个低利率的演出可能会很有趣。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T17:19:58.300

好吧，您需要担心一些事情。

合同，是的，这是 100% 需要的，否则你可能得不到报酬。合同的细节是有挑战性的，特别是关于如何收费，这就是你要问的。

如果您按小时收费，您必须担心收费时是否公平，我相信客户会担心这一点。如果您在上班，那么查看您的电子邮件、YouTube 甚至 Stack Overflow（喘气！）都是不公平的。然后还有一个问题，如果你需要学习一些新技能，是否应该收费。例如，如果你必须学习图书馆 A，这是向客户收费还是应该在你自己的时间完成？

使用统一费率，您必须担心保持自己的生产力，以免最终得到较低的小时费率。另一方面，如果这项工作很容易，您可以快速完成，并以良好的时薪告终。这对双方来说可能会更公平，因为没有人会监视你，这样你就不会偷懒，如果你决定在工作时上网，你也不会做不道德的事情。

如果这是一个副业而不是长期工作，我强烈推荐统一费率。确保你正确估计它。猜一猜你认为需要多少小时，加上 20%，然后乘以合理的小时费率。从那时起，另一方很可能对统一费率持更开放的态度，这就像他们在为成品而不是开发商付费一样。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T15:19:37.270

竞标是一种紧绳步行游戏。既不太低也不太高。合同或小时费率总是让投标人发疯。只是在你的出价中，不要削弱太多，否则你最终可能会一无所获。一旦中标者被选中，也可以在将项目价格托管在托管的此类站点中进行投标。可以在以下位置找到一个很好的资源：- [http://www.freelancing-on-net.com/writing_a_successful.php#](http://www.freelancing-on-net.com/writing_a_successful.php#)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-02T22:17:07.020

即使您按小时出价，客户也总是希望至少有一个估算值。在考虑创建软件时，不要忘记考虑所有您没有想到的活动。

具体来说，考虑项目管理、与客户的会议和通话时间、最终用户会议、源代码管理、测试和错误修复。简而言之，您为该客户所做的所有阻止您与其他客户赚钱的事情都需要向该客户收费。您可以使用出价小时数或每小时费率（通常是两者的组合）来说明这一点。

我曾经听到，“准备你最好的估计。然后加倍。” 然后我听到，“准备你最好的估计，然后用 Pi 计算它。” 现在我听到，“准备你最好的估计，然后乘以 Pi，然后加倍。” :)

不幸的是，你要擅长准确地投标项目的唯一方法是投标一些，完成项目，然后看看你在哪里超过或低于。

您总是有动力以低价出价以确保您获得该项目。但是，如果您以一半的成本做一个项目而赔钱，那么获得该项目可能不是一件好事。

# c# - AssemblyInfo.cs 中的版本号在 Visual Studio 之外更新

> ID：631334
> 
> 赞同：2
> 
> 时间：2009-03-10T17:11:19.070
> 
> 标签：c#, visual-studio, msbuild

是否可以在 Visual Studio 之外更新版本号(AssemblyVersion("1.0.2.1")) insdie AssemblyInfo.cs？？？（可能使用脚本或批处理文件）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:28:30.157

它也可以从 MSBuild 完成。

在此处查看 AssemblyInfo 任务： [MSBuild 任务](http://msbuildtasks.tigris.org/)

我们从 CruiseControl.net 使用它，使用起来非常简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T17:18:40.457

我过去曾使用[UpdateVersion](http://code.mattgriffith.net/UpdateVersion/)作为构建脚本的一部分来更新版本号。如果您使用 subversion，您还可以使用 TortoiseSVN 中的 SubWCRev.exe 来更新版本号以包含 SVN 修订号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:17:31.160

我曾经有一个 PowerShell 脚本，可以将版本号写入“AssemblyVersion.cs”，如下所示：

```
// 不要编辑
// 由 UpdateVersion.ps1 生成。

[AssemblyVersion("1.0.2.1")]

```

以这种方式一次在所有项目/程序集中更新了版本号。规范编号存储在其他地方。

写起来很简单，但根据您的确切需求而有所不同，所以我不会尝试在此处发布。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T17:18:25.323

您可以简单地使用任何搜索和替换工具或自己编写一个。

对于当前的项目（使用 msbuild 构建），我正在使用自定义构建步骤（自行编写，因为它既小又简单）搜索 AssemblyVersion 并在 AssemblyInfo.cs 文件中替换它。

# ruby-on-rails - 只从内存中删除，而不是从数据库中删除

> ID：631335
> 
> 赞同：3
> 
> 时间：2009-03-10T17:11:32.813
> 
> 标签：ruby-on-rails, activerecord

我有一个包含商店列表的 ActiveRecord 数组。

```
shops = Shop.find(:all) 
```

我想从商店中删除一条记录而不从数据库中删除它。

`shops.delete(a_shop)`将导致删除 SQL 查询。我只想从 ActiveRecord 数组中删除商店，而不是从数据库中删除。

这可以做到吗？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-19T00:18:24.333

**请注意**，如果您使用 has_many 关系，JP 的答案将不起作用。

扩展示例：

```
class City < ActiveRecord::Base
  has_many :shops
end

city = City.find(:name => "Portland") 
```

然后

```
city.shops.delete(city.shops[0]) 
```

**将从**数据库中删除！

还

```
theshops = city.shops
theshops.delete(ss[0]) 
```

**将从**数据库中删除

从数据库中分离的一种方法是使用紧凑或其他数组函数，如下所示：

```
theshops = city.shops.compact
theshops.delete(ss[0]) 
```

**不会**从数据库中删除

此外，在所有情况下 delete_if 都**不会**从数据库中删除：

```
city.shops.delete_if {|s| s.id == city.shops[0]} 
```

干杯!

不要忘记：如果您对这类事情有疑问，脚本/控制台是您的朋友！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T17:25:32.623

当我进行一些测试时，调用 delete 方法实际上并没有从数据库中删除元素。仅来自数组。

```
shops = Shop.find(:all)
shops.delete(shops[0]) #deletes the first item from the array, not from the DB 
```

从数据库中删除：

```
shops = Shop.find(:all)
Shop.delete(shops[0].id) 
```

看到区别了吗？至少，这是它在我的 Rails 2.1 设置上的工作方式。

-J.P

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:19:22.827

我认为您不能从数组中删除该项目。

但是，您应该能够修改您的 find 以在最初没有该商店的情况下返回数组。就像是：

```
shops = Shop.find(:all, :conditions => "id NOT #{a_shop.id}") 
```

应该符合你想要的。这样一来，您就永远不会在容器中获得商店，但它不会影响数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-10T21:57:49.710

我想建议这种方法来删除内存中的 AR 对象。
将属性添加到负责将 AR 对象标记为已删除的相应模型（例如`deleted`属性）：

类 OrderItem < ActiveRecord::Base ... attr_accessor :deleted

```
 def deleted
   @deleted || 'no'
 end 
```

结尾

将相应的对象标记为已删除：

```
o.order_items {|oi| oi.deleted = 'yes' if oi.id == 1029} 
```

过滤 order_items 只设置未删除的行：

```
o.order_items do |oi| 
 unless oi.deleted == 'yes'
 ...
 end
end 
```

# serial-port - 使用 Readline() 丢弃数据的串行端口

> ID：631340
> 
> 赞同：0
> 
> 时间：2009-03-10T17:12:15.447
> 
> 标签：serial-port, readline

我正在使用串行端口从连接到瘦客户端的秤上读取数据。在 99% 的情况下，数据被正确读取 - 即，秤上的任何内容都是应用程序捕获的内容。但是，有时，看起来数据被丢弃了。例如，它将被读取为 0.007，而不是 90.007。我正在使用 ReadLine 函数：

```
private void CaptureWeight()
    {
         globalCounter++;
         string value = "";
         _sp.DiscardInBuffer();

          while (!this._processingDone)
          {
              try
              {                     

                  value = this._sp.ReadLine();                      

                  if (value != "")
                  {
                      if (value == "ES")
                      {
                          _sp.DiscardInBuffer();
                          value = "";
                      }
                      else
                      {
                          this.Invoke(this.OnDataAcquiredEvent, new object[] { value });
                      }
                  }
              }
              catch (TimeoutException)
              {
                  //catch it but do nothing
              }
              catch
              {
                  //reset the port here?
                  MessageBox.Show("some other than timeout exception thrown while reading serial port");
              }
          }
    } //end of CaptureWeight() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T19:22:28.863

不要调用 DiscardInBuffer。当数据通过[UART](http://en.wikipedia.org/wiki/UART)移入时，操作系统缓冲区被[异步](http://en.wikipedia.org/wiki/Asynchronous_serial_communication)填充。读取所有数据并采取相应措施，因为在丢弃缓冲区时您无法知道缓冲区中的内容！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:36:03.083

“ES”什么时候来？理论上，“ES”之后的值可能无法正确读取，因为您调用了 DiscardInBuffer()。如果在那个时候缓冲区包含下一个读数的一部分，例如 90.007 中的 9，则 9 被丢弃并且您读取 0.007。

尝试仅丢弃最后一个 CR LF 之前的所有内容。但留下不完整的线条。

# c# - 从套接字字节流中正确读取 HTTP POST 请求的最佳方法是什么？

> ID：631346
> 
> 赞同：0
> 
> 时间：2009-03-10T17:13:07.147
> 
> 标签：c#, networking

我正在接受这样的 POST 请求：

```
Socket connection = m_connection;
Byte[] receive = new Byte[1024];

int received = connection.Receive(receive);
Console.WriteLine(received.ToString());

string request = Encoding.ASCII.GetString(receive);
Console.WriteLine(request); 
```

帖子值最终会变得很奇怪，如果我多次发布文本值，它们最终会在它们后面加上很多 +。如果我发布 C:\Users\John Doe\wwwroot，它最终会是：C%3A%5CUsers%5John+Doe%5Cwwwroot

index.html 变为 index.html++++++++++++++++++++++++++++++++++

似乎我以某种方式弄错了编码，但是我尝试了多种编码，并且它们具有相同的怪异之处。从套接字字节流中正确读取 HTTP POST 请求的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:16:27.433

您需要修剪`receive`要传递给 GetString 方法的字节数组。现在，您正在传递所有 1024 个字节，因此 GetString 方法正在尝试尽可能地对它们进行编码。

您需要使用该`received`变量来指示您正在编码的字符串的范围。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T17:21:28.420

首先，您不需要解码输入，HTTP 是 ASCII 并且只使用字节会更快。现在，您要做的是定义最大 HTTP 请求标头大小，比如 4K？然后您将继续读取字节，直到您点击 \r\n\r\n 这标志着 HTTP 请求的结束。您需要强制执行此最大标头大小限制，否则单个恶意用户可能会发送无限的 HTTP 请求，并且您的服务器将耗尽内存。

您应该阅读 HTTP 规范。

根据您的 HTTP 请求，HTTP 内容可能有很多内容，您需要采取相应措施。HTTP 协议本身始终是 ASCII，因此您可以将其视为字节，但内容的编码方式可能非常不同。这通常由 Content-Type: 标头解释。但是，请再次阅读 HTTP 规范。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:24:47.913

您应该使用 System.Web.HttpUtility.UrlDecode 而不是 Encoding.ASCII 来执行解码。

您可能会通过将 Encoding.Default 作为第二个参数传递给此静态方法而侥幸成功。

您正在看到 HTML 表单 POST 的结果，该表单对值进行编码，就好像它们作为搜索字符串附加到 URL 一样。因此，它是一组以 & 分隔的名称=值对。任何带外字符都被编码为其十六进制值 %xx。

UrlDecode 方法将为您解码所有这些。

正如其他人所说，您确实需要将流分块，它可能大于 1K。

严格来说，您应该检查任何 ;CharSet= 属性的 Content-Type 标头。如果存在，您需要确保传递给 UrlDecode 的字符编码适合该 CharSet（例如，如果 CharSet=UTF-8 则使用 E​​ncoding.UTF8）。

# image - 如何在我的 DokuWiki 标题上显示我的徽标？

> ID：631350
> 
> 赞同：19
> 
> 时间：2009-03-10T17:13:33.103
> 
> 标签：image, dokuwiki

我有一个 DokuWiki，我想在页面顶部的标题栏上放置一个徽标？我怎样才能做到这一点？请注意，我指的不是浏览器顶部的标题栏，而是网站本身的标题栏。

我尝试插入 DokuWiki 语法：{{public:logo.jpg?100x100}}，但这只是呈现为纯文本而不是图像。

是否可以在页面标题中放置图像？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2012-10-15T18:29:02.397

简单：将您的徽标重命名为“logo.png”并将其放入 :wiki 命名空间。它会自动显示。

此解决方案适用于模板“ [dokuwiki](https://www.dokuwiki.org/template:dokuwiki) ”（dokuwiki 旧稳定版本“ [Adora Belle](https://www.dokuwiki.org/changes#release_2012-10-13_adora_belle) ”和当前“ [Weatherwax](https://www.dokuwiki.org/changes#release_2013-05-10_weatherwax) ”中的默认模板）：

**更深的：**

我们可以查看 tpl_header.php 文件，第 21 和 23 行：

```
// get logo either out of the template images folder or data/media folder 
```

[...]

```
$logo = tpl_getMediaFile(array(':wiki:logo.png', 'images/logo.png'), false, $logoSize); 
```

好的：tpl_getMediaFile() 函数将在名为 wiki 的媒体命名空间中查找文件 logo.png。

所以我去 dokuwiki 文件管理器并在 wiki 命名空间上上传我的 logo.png 文件。我刷新页面并微笑。

![使用 dokuwiki 文件管理器的解决方案](https://i.stack.imgur.com/CFD9F.png)

希望有帮助

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-02-10T20:43:10.050

在现代版本中，`DokuWiki`您不必制作自己的模板。只需上传一个名为或根命名空间的`logo.png`文件。`wiki``DokuWiki Media Manager`

这是获取徽标的模板代码行： [https ://github.com/splitbrain/dokuwiki/blob/master/lib/tpl/dokuwiki/tpl_header.php#L23](https://github.com/splitbrain/dokuwiki/blob/master/lib/tpl/dokuwiki/tpl_header.php#L23)

你可以看出它首先用 . 签 `logo.png`入`wiki`命名空间，`:wiki:logo.png`然后`logo.png`用 . 签入根命名空间`:logo.png`。

如果两者都没有找到，它会退回到`images/logo.png`，这是默认徽标。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-29T04:31:35.597

（适用于最新版本的 Dokuwiki）

您应该创建自己的模板，并做任何您需要做的事情。

它位于 lib/tpl/

只需使用您自己的名称复制默认目录（稍后将在管理区域中可用），例如“公司”，然后编辑：

```
 <div class="pagename">
    <img src="<?php echo DOKU_TPL; ?>images/logo.png" align="absmiddle"/>
    [[<?php tpl_link(wl($ID,'do=backlink'),tpl_pagetitle($ID,true),'title="'.$lang['btn_backlink'].'"')?>]]
  </div> 
```

您可以根据需要构建 HTML……但上面的示例工作得很好（图像位于 lib/tpl/company/images/ 中）

然后，您可以通过在以下位置更新配置来更改 Wiki 的模板：管理员 > 配置管理器 > 模板

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-10T17:55:05.890

没有配置选项，`\dokuwiki-2009-02-14\lib\tpl\index.php`恐怕你必须破解它。

# java - 在Java中，给定一个对象，是否可以覆盖其中一种方法？

> ID：631361
> 
> 赞同：3
> 
> 时间：2009-03-10T17:16:06.093
> 
> 标签：java, reflection, dependency-injection

我有一个 A 类的对象。我想重写该类的方法之一。这可以做到吗？

更具体地说，我有一个对象被注入到一个字段中。我需要覆盖其中一种方法，然后才能使用它。

我正在尝试查看反射是否可以帮助解决问题。请注意，我尝试覆盖的方法不依赖于该类的私有变量。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T17:20:16.850

查看[动态代理类](http://java.sun.com/j2se/1.3/docs/guide/reflection/proxy.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T17:19:00.580

[CGLIB](http://cglib.sourceforge.net/)应该能够帮助您实现您想要做的事情。查看[增强器类](http://cglib.sourceforge.net/xref/net/sf/cglib/proxy/Enhancer.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T17:20:28.610

是的。

覆盖意味着编写一个新类，编译它，更改注入以使用新类，并将其与应用程序的其余部分打包。当然可以，但我不明白你为什么要反思。

如果您希望这是一个动态的东西，那么您正在谈论面向方面的编程。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-10T17:23:54.280

假设您被赋予了该对象，因此不能对其进行子类化：您可以编写一个代理。按原样转发所有方法，但要覆盖的方法除外。当然，没有其他对该原始对象的引用将使用代理。特别是如果对象本身在内部调用自己的方法，则不会使用“覆盖”方法。

或者，您可以使用 AOP 样式的 hack 重写调用该方法的代码或修改实现类。

可能您想仔细考虑您的设计。

# c# - 从 XmlDataSource 填充 DropDownList

> ID：631365
> 
> 赞同：2
> 
> 时间：2009-03-10T17:16:40.087
> 
> 标签：c#, asp.net, xpath, drop-down-menu

我想使用一个简单的 xml 文件填充我的 DropDownList：

```
<?xml version="1.0" encoding="utf-8" ?>
<Databases>
  <Database>foo</Database>
  <Database>bar</Database>
  <Database>baz</Database>
</Databases> 
```

我的 XPath 是

```
/Databases/Database 
```

我的下拉列表呈现为：

```
<select name="databaseDropDownList" id="databaseDropDownList"> 
                    <option selected="selected" value="System.Web.UI.WebControls.XmlDataSourceNodeDescriptor">System.Web.UI.WebControls.XmlDataSourceNodeDescriptor</option>
                    <option value="System.Web.UI.WebControls.XmlDataSourceNodeDescriptor">System.Web.UI.WebControls.XmlDataSourceNodeDescriptor</option>
                    <option value="System.Web.UI.WebControls.XmlDataSourceNodeDescriptor">System.Web.UI.WebControls.XmlDataSourceNodeDescriptor</option>
</select> 
```

我应该如何提取文本？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T17:52:11.983

我想不起来了，但我认为 XmlDataSource 中有一个错误会阻止您绑定到 xml 节点的值。它仅适用于属性。如果我对此有误，请纠正我。您需要对 XML 文件进行一些修改：

```
<%@ Page Language="C#" %>
<script runat="server">
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string xml =
@"<?xml version=""1.0"" encoding=""utf-8"" ?>
<Databases>
  <Database name=""foo"" />
  <Database name=""bar"" />
  <Database name=""baz"" />
</Databases>";
            databasesSource.Data = xml;
            databasesSource.DataBind();
        }
    }
</script>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Untitled Page</title>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <asp:DropDownList ID="databases" runat="server" DataSourceID="databasesSource" DataValueField="name" DataTextField="name" />
        <asp:XmlDataSource ID="databasesSource" runat="server" XPath="/Databases/Database" />
    </div>
    </form>
</body>
</html> 
```

请注意，我添加了*name*属性，而不是直接使用节点的值。

如果您无法修改原始 XML 文件的结构，您可以使用本文所述的 TransformFile 属性对其[应用](http://weblogs.asp.net/rajbk/pages/431322.aspx)[XSLT](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.xmldatasource.transformfile.aspx)转换。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-06T18:12:28.497

我今天遇到了同样的问题。我的解决方案：

这是我的xml：

```
<?xml version="1.0" encoding="utf-8"?>

<pokemons>
  <pokemon>
    <nome itemname="bulbassaur">bulbassaur </nome>
  </pokemon>
  <pokemon>
    <nome itemname="charmander">chamander </nome>
  </pokemon>
  <pokemon>
    <nome itemname="squirtle"> squirtle </nome>
  </pokemon>
</pokemons> 
```

我把 DataTextField="itemname" 放在 DropDownList 服务器控件上。前任：

```
<asp:DropDownList ID="DropDownList1" runat="server" AutoPostBack="True" 
            DataSourceID="XmlDataSource1" DataTextField="itemname"> 
```

它工作没有问题。可能不是最好的解决方案，...但至少比`System.Web.UI.WebControls.XmlDataSourceNodeDescriptor`.

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-10T17:59:16.257

这是一种方法 - 您可以`ListItems`在 LINQ 查询中投影一个数组：

```
XDocument doc = XDocument.Parse(@"<Databases>
        <Database>foo</Database>
        <Database>bar</Database>
        <Database>baz</Database>
    </Databases>");

YourList.Items.AddRange(
    (from XElement el in doc.Descendants("Database")
    select new ListItem(el.Value)).ToArray()
); 
```

# asp.net-mvc - ASP.NET MVC - 切换要动态使用的 VIew

> ID：631366
> 
> 赞同：1
> 
> 时间：2009-03-10T17:16:44.407
> 
> 标签：asp.net-mvc

动态更改控制器方法使用的视图（视图 aspx）与使用标准命名约定的正确方法是什么。

我猜它与 ViewResult 和 ViewName 有关，但正确的语法是什么？

**更新：**
我忘记了一件事......有没有办法做到这一点，而“动作”或方法名称不是结果 URL 的一部分？

例如，
如果我想要一份美国所有州的列表。
[http://localhost/list/states](http://localhost/list/states)
（显示状态名称的简单列表）

如果我想要一份美国 50 个最大城市的名单。
[http://localhost/list/largest-cities](http://localhost/list/largest-cities)
（显示城市和人口 - 两列网格）

所以我希望能够根据列表名称引入不同的“格式化程序”。

我应该在单个操作/多个视图中执行此操作吗？
然后我可以使用路由隐藏 URL 中的视图名称吗？
解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:18:56.307

只需使用采用视图名称的方法来选择。不过要小心。大多数时候，您可能想要做的是重定向到不同的操作。返回不同的视图不会像重定向那样更改 url。

```
string name = ...figure out which view you want...

return View( name ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T17:18:56.307

如果您需要从控制器动作动态呈现不同的视图，您可以简单地为 base.View() 方法（或 ViewResult 构造函数）提供一个值。视图的位置将始终是（对于 Web 表单视图引擎）：

```
/Views/{Controller}/{View}.aspx 
```

**编辑：（**感谢 Ithi）它也可能在：

```
/Views/Shared/{View}.aspx 
```

# c# - 我可以用吗 具有数据库分页性能的分页器？

> ID：631371
> 
> 赞同：0
> 
> 时间：2009-03-10T17:18:22.267
> 
> 标签：c#, .net, asp.net, data-binding, paging

我有一个在数据库级别处理分页的存储过程，接收 @ **PageSize**和 @ **PageIndex**。给定页面大小，我可以创建另一个返回 @ **PageCount 。**

我可以使用控件寻呼机使数据网格在数据库级别进行分页，而不必在控件之外进行开发吗？

似乎默认使用数据网格分页接收所有查询结果，并在数据库外进行分页。这对我们不利，不必要的超载。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T18:02:36.577

在 aspx 上设置 AllowCustomPaging="true"。当数据绑定时：

```
mygrid.VirtualItemCount = pageCount; 
mygrid.DataSource = mysource; 
mygrid.DataBind(); 
```

根据您的评论“我使用 ADO 连接、命令等，在将结果加载到对象列表（我的实体类）中后，我制作 datagrid.DataSource = List;”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:23:06.530

如果您使用 ObjectDataSource 控件作为 GridView 的 DataSourceID，那么它可以非常无缝地工作。ObjectDataSource 控件有几个参数，您可以在其中告诉它 PageIndex 和 MaxRows 属性的名称。

# c++ - 在库接口中提供对 weak_ptr 的访问是否明智？

> ID：631380
> 
> 赞同：4
> 
> 时间：2009-03-10T17:19:01.000
> 
> 标签：c++, boost, weak-ptr

我编写了一个库，它公开了对几种相关对象类型的引用。所有这些对象的生命周期都由库内部通过`boost::shared_ptr`

库的用户还可以根据库的性质知道任何暴露对象的生命周期。所以他们可以存储指针或保留对这些对象的引用。他们这样做并知道这些对象何时不再有效是合理的。

但我对强迫我的用户讲道理感到内疚。

**`weak_ptr`让库公开其对象是否可以接受？其他图书馆有这样做过吗？**

我已经分析了这个库在应用程序中的使用情况，发现它对任务至关重要，无法`weak_ptr`专门公开。

**让匹配的 API 函数公开引用*或*weak_ptr 或让任何对象能够将 a 公开`weak_ptr`给自身会更明智吗？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-15T02:05:55.223

如果`smart_ptr`库的用户已经可以直接访问 s，那么他们已经可以访问`weak_ptr`s，只需通过相应`weak_ptr`的构造函数即可。但如果`smart_ptr`s 都是图书馆内部的，那就另当别论了。

`weak_ptr`在这种情况下，除了您的库提供的任何其他访问权限之外，我建议让每个对象将s 传递给自己。这为用户提供了最大的灵活性：如果他们需要 a `weak_ptr`，他们可以立即访问它；如果他们需要一个`shared_ptr`，他们可以很容易地得到它；如果他们只需要访问对象本身，他们可以完全忽略智能指针。

当然，我不知道您的库是做什么的，也不知道它是如何使用或设计的。这可能会改变我的建议。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T17:35:36.847

想出复杂的机制来获取你图书馆的对象只会导致人们不使用你的图书馆。如果库的语义要求您需要让人们使用weak_ptrs，那么用户就无法知道对象可能会在某个时候消失。使界面尽可能多地表达有关库使用的信息，减少文档并使其无限易于使用。

您不能围绕糟糕/没有经验的用户进行设计。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T04:59:21.920

如果您让您的客户访问`weak_ptr`s，他们可以锁定它们以创建`shared_ptr`s 并最终延迟对象的销毁。这可能会导致您的库出现问题。

我建议将 a 包装`weak_ptr`在其他类中，然后给调用者 a `shared_ptr`。这样他们就不能打电话了`weak_ptr<T>::lock()`。您似乎有可能影响您如何实现它的性能限制，但`shared_ptr<InterfaceClass>`可能是一个很好的方法，并将类与`weak_ptr`您的库的内部保持一致。

这样，您还可以将这些实现细节保留在库接口之外，并且您可以在不更改接口的情况下更改实现方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T17:27:40.340

我认为暴露weak_ptrs 没有任何问题，特别是考虑到[TR1 具有类似的智能指针](http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2005/n1745.pdf)（PDF）。

TR1 主要由 Visual Studio 和 GCC 实现，但不是其他一些编译器。但是，当它在您关心的所有编译器中实现时，您可能需要重新设计 API 以公开这些智能指针。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T01:57:43.913

如果您想捕获库的无效使用（尝试在对象被删除时访问它们）以及拥有高性能 API（API 中没有weak_ptr和shared_ptr），那么您可以考虑使用不同的API用于调试和非调试版本。

为简单起见，我们假设您只公开了一类对象；调用这个类对象。从 API 返回的用于访问内部对象的指针类型定义为：

```
#ifdef DEBUG
typedef ObjectPtrFacade ObjectPtr 
#else
typedef Object * ObjectPtr;
#endif 
```

这里的外观是你写的类。它的工作原理大致如下：

```
class ObjectPtrFacade {
public:
    ObjectPtrFacade(Object *o) : wptr(o) { }
    // copy constructor and assignment here etc. (not written)
    Object * operator -> () const { return access(); }
    Object & operator * () const { return *access(); }
private:
    Object * access() { 
      assert(wptr.use_count() > 0);
      return (Object *)(wptr.lock());
    }
    weak_ptr<Object> wptr; 
} 
```

这样，每当您构建调试版本时，都会使用一种特殊类型的智能指针，它在访问对象之前断言其 use_count() 大于零，即该对象仍然存在。如果对象已被释放，您会得到一个失败的断言，这比空指针引用要好。

一般来说，如果你有 API 的“愚蠢”用户，当然使用weak_ptr 并没有帮助，因为他们可以调用lock()，然后在weak_ptr 返回一个空的shared_ptr 之后仍然进行空指针引用。 ..

# php - 从另一个 PHP 文件中读取 echo'ed 输出

> ID：631388
> 
> 赞同：20
> 
> 时间：2009-03-10T17:20:00.250
> 
> 标签：php, server-side, echo

我希望 1 个 PHP 文件在同一台服务器上“运行”（包括？）另一个 PHP 文件，并将其回显输出作为字符串访问。

我如何在 PHP 中做到这一点？任何内置功能可以做到这一点？

或者有什么更好的方法来执行另一个 PHP 文件并获取它的输出？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-10T17:22:09.607

您可以使用 PHP 的[输出缓冲](http://ca2.php.net/manual/en/book.outcontrol.php)来完成此操作：

```
ob_start(); // begin collecting output

include 'myfile.php';

$result = ob_get_clean(); // retrieve output from myfile.php, stop buffering 
```

`$result`然后将包含文本。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2017-05-18T01:35:34.980

您不能将外部网站/服务器上的 PHP 脚本包含到本地脚本中 - 除非您在 php.ini 上启用 allow_url_include （如果您有权访问它）

相反，您可以让该网站/服务器呈现页面并通过执行以下操作在本地脚本上获取生成的 HTML 输出：

```
$result = file_get_contents('http://127.0.0.1/myfile.php'); 
```

# wpf - XAML 专家设计

> ID：631396
> 
> 赞同：2
> 
> 时间：2009-03-10T17:21:19.497
> 
> 标签：wpf, xaml, user-interface

我是一个小型 ISV。2个开发商。我有一个我们出售的现有 Windows 应用程序。我想使用 WPF 重写 UI，甚至可能在 Web 上创建一个 Silverlight 版本。我有20年的经验，而且我学东西很快。我确信我可以学习 XAML、WPF 和 Silverlight。但是，我想知道是否应该编写初始 UI。我听过所有关于真正设计师在项目中的价值的讨论。我相信我所听到的大部分内容。所以，我想找一位 XAML 专家设计师来设计我的新 UI 并编写我所有的初始 XAML。

我怎么找到这个人？我在这个人身上寻找什么？我应该要求固定价格合同还是按小时收费更好？我应该提供销售额的百分比作为付款吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T17:48:21.990

在典型的 WPF 或 Silverlight 开发中，根据所需的技能集，涉及 3 个主要的开发过程。每个的百分比是每个的大致时间。

1.  平面设计和信息架构师 - 15% -20%

    *   PhotoShop/Illustrator/烟花/表情设计技巧
    *   分析用户、优化 UI 并以精美方式呈现的技能
2.  开发 [*确切地说是 UX 开发*] - 50 - 60%

    *   原始 XAML 开发
    *   ViewModel 代码开发（MVVM 和 C#）
    *   自定义/用户控件开发
    *   主要使用 Visual Studio
3.  XAML 集成 [具有设计和开发知识的技能组合] 15-30%

    *   定义用户与设计器的交互 (1)
    *   将图形设计转换为 XAML 资产
    *   样式/模板控件
    *   故事板动画并创建效果
    *   主要使用Expression Blend并熟悉Illustrator/Photoshop/Expression Design或其他设计工具

当您对设计策略有了一个粗略的了解后，您就可以开始构建应用程序（第 2 步），并以一种看起来更少消耗所有数据库/Web 服务等的方式完成整个应用程序。图形设计和 XAML 集成可以稍后再进行与 WPF 开发并行。

由于 XAML 相对较新，因此可能很难找到同时具备 (1) 和 (3) 技能的人。而且我不确定如何找到一个好的集成商。但是您肯定可以在周围找到数以千计的优秀设计师/设计商店。大多数设计工具会将设计资产转换/导出为 XAML。但要获得更好的用户体验，您需要专业的集成商。

*   一篇值得阅读的好文章 -[新迭代](http://windowsclient.net/wpf/white-papers/thenewiteration.aspx)
*   了解模型-视图-视图模型模式以正确构建步骤 (2) 也很好 -[具有模型-视图-视图模型设计模式的 WPF 应用程序](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)

注意：如果您同时针对 Silverlight 和 WPF，最好制作异步 Web 服务并让 WPF 和 SL 将其用作数据层。并检查 Prism 和其他 MVVM 实现，这使得 WPF 到 Silverlgiht 端口变得容易

# vbscript - 从 VBScript 中访问网络共享，例如 FileSystemObject

> ID：631401
> 
> 赞同：21
> 
> 时间：2009-03-10T17:21:38.967
> 
> 标签：vbscript, network-shares

是否有一种从 VBS 脚本中访问网络共享的好方法，使用备用凭据（不是运行 VBS 脚本的凭据）？

目的是执行两项任务：

1.  以编程方式导航远程共享文件结构，以确认存在几个远程文件，并将一个文件复制到另一个文件（均为远程文件）
2.  将文件从本地驱动器（使用本地用户名/权限访问）复制到远程驱动器（使用备用凭据访问）

据我所知，FSO（Scripting.FileSystemObject）不在图片中，因为它始终使用使用它的应用程序的凭据运行 - 这将是本地计算机用户。（？）

我在谷歌搜索准备使用“net use”提供远程共享凭据的批处理文件（或对“cmd.exe”的扩展调用）时发现的唯一可行的方法，然后使用 robocopy 等复制文件，来自同一命令外壳“会话”。这对于将文件从本地驱动器复制/部署到远程共享来说可以正常工作，但是以这种方式进行任何类型的文件系统浏览（就像您使用 FSO 一样）都会非常复杂和脆弱。

我考虑过的另一种可能性涉及两个脚本会话 - 您调用脚本（在命令行中提供备用凭据）并运行 cmd.exe 会话，该会话首先执行“网络使用”以将远程共享映射到临时本地驱动器，然后以“实际做事”模式运行并使用 FSO，然后当它完成时（回到 cmd.exe 外壳）再次使用“网络使用”断开临时驱动器。这很笨重（多个窗口，临时驱动器......），我什至不确定它会起作用。

有没有人知道任何一种方式，或者知道可行的替代方案？（在 Windows 2000 机器上坚持使用 VBScript / WScript - 没有 PowerShell！）

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-10T17:53:24.630

好的，我在一个误解下工作 - FSO 不会“拾取”使用“NET USE”（或 Wscript.Network “MapNetworkDrive”）建立的网络凭据。

事实证明确实如此，并且以下示例代码运行良好（无需设置临时网络驱动器）：

```
ServerShare = "\\192.168.3.56\d$"
UserName = "domain\username"
Password = "password"

Set NetworkObject = CreateObject("WScript.Network")
Set FSO = CreateObject("Scripting.FileSystemObject")

NetworkObject.MapNetworkDrive "", ServerShare, False, UserName, Password

Set Directory = FSO.GetFolder(ServerShare)
For Each FileName In Directory.Files
    WScript.Echo FileName.Name
Next

Set FileName = Nothing
Set Directory = Nothing
Set FSO = Nothing

NetworkObject.RemoveNetworkDrive ServerShare, True, False

Set ShellObject = Nothing
Set NetworkObject = Nothing 
```

# unicode - EM Dash #151 有什么区别？和#8212;?

> ID：631406
> 
> 赞同：30
> 
> 时间：2009-03-10T17:22:27.233
> 
> 标签：unicode, utf-8, ascii

我有一个包含 EM Dash（或`&mdash;`HTML）的 ASCII 文件。十六进制值为 0x97。当我们通过一个应用程序传递这个文件时，它以 UTF-8 格式到达，并将字符转换为`&#151;`HTML 格式的 0xC297。但是，当我们通过不同的应用程序传递这个文件时，它会将字符转换为 0xE28094 或`&#8212;`.

什么会导致这些应用程序以不同方式转换这些字符？它可能是代码页设置吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-03-10T17:51:55.493

 是错的。当您使用数字字符引用时，数字指的是 Unicode 代码点。对于低于 256 的数字，与 ISO-8859-1 中的代码点相同。在 8859-1 中，字符 151 属于“C1 控制代码”，而不是破折号或任何其他可见字符。

由于字符 151 是 Windows 代码页 1252（西欧）中的破折号，因此出现了混淆。很多人认为 cp1252 和 ISO-8859-1 是一回事，但实际上并非如此：C1 范围内（128 到 159）的字符是不同的。

第一个应用程序将您的“ASCII”文件* 读取为 ISO-8859-1，但实际上它可能是 cp1252，您需要一种方法来提示应用程序它所期望的编码。

（*：如果文件中有最高位设置的字符，则“ASCII”是用词不当。您可能是指“ANSI”，这实际上也是用词不当，但在 Windows 世界中一直停留在“文本编码”的意思在当前系统默认代码页中”。）

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-01-07T12:36:50.237

*   [`&#151;`不是 em dash](http://www.fileformat.info/info/unicode/char/97/index.htm)，您的文本被错误地从 em dash 翻译为该值。
*   `&#8212;`是破折号的 HTML 十进制实体。具体来说，它引用了代表 em dash 的 Unicode 代码点 8212。
*   如果文件包含破折号，则您的文件不是 ASCII。ASCII 字符只能编码到十进制范围 0 - 127，而 em dash 不是 ASCII 编码可以表示的字符。如果您将 em dash 存储为 0x97（十进制为 151），您可能有一个 ANSI 文本文件（又名 Windows 代码页 1252 (w-1252)）。

**您的第一个应用程序...**
数据以 w-1252 编码的破折号开始。在 w-1252 中，短划线映射到十进制值 151（十六进制的 0x97，或二进制的 10010111）。

在某些时候，破折号由认为文件中的字节是 iso-8859-1 编码文本的代码处理。当该代码将 0x97 解释为字符串/字符时，它[根据 iso-8859-1 编码将 0x97 映射到字符](http://en.wikipedia.org/wiki/ISO/IEC_8859-1#ISO-8859-1)。在 iso-8859-1 中，0x97 映射到字符“保护区域结束”。

接下来，代码认为是“保护区域结束”控制字符的字符串被编码为 utf-8。[以 utf-8 编码的“保护区结束”是两字节序列： 0xC2 0x97](http://www.fileformat.info/info/unicode/char/0097/index.htm)。

**您的第二个应用程序...**
文本文件被正确解释为 w-1252，因此 0x97 被识别为 em dash，在 utf-8 中正确编码为 em dash: 0xE2 0x80 0x94。

 **是什么**影响了这种行为** 在人们将数据输入表单的 Web 应用程序中，我们有相同的 0x97->0xC297 场景。我发现网页的字符集被声明为 iso8859-1，而浏览器处理 w1252 字符的最佳方法是将它们作为 iso 字节发送而不提醒用户或服务器。服务端收到数据认为是iso，转成utf-8，产生0xC297。**

 **基本上任何时候应用程序接触文本时都需要告诉它文本是如何编码的，否则它可能会退回到系统默认值。如果发生这种情况，您将面临数据损坏的风险。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T17:32:07.740

根据 HTML4 规范的[字符实体参考](http://www.w3.org/TR/html401/sgml/entities.html#h-24.2)，破折号是 — ( [U+2014](http://www.fileformat.info/info/unicode/char/2014/index.htm) )。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-10T17:37:47.413

ASCII 文件不能包含字符 0x97，因为 ASCII 字符集的范围仅从 0x00 到 0x7F。因此，您的文件不是 ASCII，而是其他一些单字节编码。例如 windows-1250 编码在 0x97 处有 em-dash。

如果应用程序使用其他编码而不是用于创建文件的编码对文本文件进行解码，则任何高于 0x7F 的字符都是错误的。

在 unicode 中，破折号的字符代码为 0x2014，或十进制的 8212。

[Unicode 字符 'EM DASH' (U+2014)](http://www.fileformat.info/info/unicode/char/2014/index.htm)

例如，在使用 windows-1250 作为编码的网页中，代码`&#151;`将呈现为 em-dash：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>em-dash</title>
    <meta http-equiv="content-type" content="text/html; charset=windows-1250"/>
</head>
<body>
    <div>&#151;</div>
</body>
</html> 
```

# java - 如何在具有单工连接的设备上读取和写入 Java ME 中的网络套接字？

> ID：631407
> 
> 赞同：4
> 
> 时间：2009-03-10T17:22:41.150
> 
> 标签：java, networking, sockets, java-me, mobile

我正在研究移动通信器，并在使用以下方法建立与服务器的连接后（说明我正在使用**StreamConnection**、**InputStream**和**OutputStream** ）我在两个单独的线程之间分配**inputStream**和**outputStream ，我们称它们为****Sender**和**Receiver**。

连接方式：

```
private InputStream inputStream;
private OutputStream outputStream;
private StreamConnection connection;

    public void connect(String host, String port) throws IOException {

        String connectionString = "socket://" + host + ":" + port;
        connection = (StreamConnection) Connector.open(connectionString);

        inputStream = connection.openDataInputStream();
        outputStream = connection.openOutputStream();
    } 
```

**发送**者线程正在等待输出缓冲区中出现任何内容。当输出缓冲区为空时，**发送**者等待（通过调用`wait()`发送者线程上的方法）。任何输入到输出缓冲区的输入都会调用`notify()`发送线程上的方法。

**Receiver**线程使用方法轮询**InputStream**`int available()`，当有东西要接收时，它调用阻塞`int read()`方法。在各种模拟器中，一切都像一个魅力，而我手边很少有设备。

但是，有一部手机似乎行为不端。每当一个线程调用InputThread`available()`对象，而另一个线程调用**OutputStream****对象**时，输入流就结束了。所有后续读取都将返回值**-1**，这意味着 InputStream 已关闭。`read()`**`write()`**

 ******在大量 google-fu 之后，我**[在诺基亚论坛上看到了这篇文章](http://discussion.forum.nokia.com/forum/archive/index.php/t-37472.html)**，其中正在讨论设备的单工/双工属性，而我遇到问题的设备似乎就是这种情况。通常（99% 的时间）对 read() 和 write() 的调用可以同时进行，没有任何问题。

我的问题是：有没有人遇到过类似的问题？您如何/将如何解决一个线程独立读取，而另一个线程独立写入已建立的连接的问题，以便他们在调用 write() 时不会调用 read() 或 available()？

任何方向的任何指针都非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-17T08:57:59.367

通常，当我们谈论多线程应用程序时，几乎不能保证。我建议在您的应用程序中使用单个线程并尝试使用单个工作线程来管理它。有些设备确实存在行为问题，因此我们在一台设备上看到的内容似乎不适用于其他设备。

我在手机游戏上做过很多工作，在不影响游戏速度的情况下必须渲染大量动画。我意识到你可以用一个线程做更多的事情，它使你的应用程序非常便携（几乎没有变化）。

如果您正在等待线程完成 READ 或 WRITE 操作，那么看起来您实际上是在按顺序执行此操作。因此，或多或少，使用多个线程会使事情变得复杂。相反，构建了一个等待通知机制，基于一些预先确定的因素，并允许 SINGLE 线程读取或写入套接字流。线程之间的切换是一个非常昂贵的操作，比这个方案。希望这能回答你的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T19:13:56.927

在这种问题和移动网络运营商过滤数据之间，大多数移动 Java 开发人员使用“http://”协议而不是“socket://”。

当然，这意味着不再使用双工连接，而是发出许多 GET 和 POST 请求。

远非理想，我知道。

# c# - 寻找 .NET 的命令行参数解析器

> ID：631410
> 
> 赞同：80
> 
> 时间：2009-03-10T17:22:46.500
> 
> 标签：c#, .net, command-line, arguments

我正在寻找一个命令行参数解析器，例如来自[http://www.sellsbrothers.com/tools/Genghis/](http://www.sellsbrothers.com/tools/Genghis/)的“命令行解析器” 。

我正在寻找的功能：

*   自动生成使用量
*   应该能够检查必需和可选参数
*   参数应支持带分隔符的 IEnumerable
*   应该支持标志参数
*   最好支持组合参数，例如“/fx”==“/f /x”
*   在诸如“/ftest.txt”==“/f test.txt”之类的参数之后不要强制使用空格会很好

PS： *“命令行解析器”非常好，我真的很喜欢它的设计，但是没有文档，没有新的更新，而且我不知道如何做某些事情，例如如何检查所需的参数。*

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-03-10T17:39:27.613

我个人最喜欢的第 3 方命令行解析库是[Command Line Parser](https://github.com/commandlineparser/commandline)，我认为这就是您所指的那个。最近的版本是不到 2 个月前，并且有定期提交。如果您想要更成熟的产品，您可以查看 mono 项目中的控制台库（抱歉，我目前似乎无法找到指向命名空间的直接链接，但它是 mono 框架的一部分）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-26T12:47:24.577

看看 ndesk.options。

它现在称为[Mono.Options](https://github.com/mono/mono/tree/master/mcs/class/Mono.Options/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T13:07:16.477

[GNU getopt](http://www.gnu.org/software/hello/manual/libc/Getopt.html)是一个流行且非常全面的 C 命令行解析器。这已多次移植（或克隆）用于 C#/.Net。其中一些包括：

*   [getopt#](http://freshmeat.net/projects/getopt-sharp)在freshmeat.net 上
*   [C# getopt](http://www.phpguru.org/static/getopt.html)在 PHPGuru
*   CodeProject上的[XGetoptCS](http://www.codeproject.com/KB/cs/XGetoptCS.aspx)
*   [GetOpt for .NET](http://www.codeproject.com/KB/cs/geoptfordotnet.aspx)在 CodeProject
*   Codeplex 上的[Getopt C#.NET](http://www.codeplex.com/getopt)

任你选！还有其他几个，谷歌可以告诉你这些，

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-10T17:27:06.350

遗憾的是，没有内置支持以标准方式处理它。您是否研究过 PowerShell？我敢打赌，该外壳中有一个类可以完全满足您的要求或类似的功能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-09T19:19:45.793

**编辑：**正如 fatcat1111 所指出的，这个特性没有随 .net 4.0 的最终版本一起提供。

C# 4.0 有一个相当不错的版本。可能还不是很有帮助，但是您可能需要考虑查看一些可以在它出现时轻松跳转到内置的东西。[Bart De Smet 在他的B# 博客](http://community.bartdesmet.net/blogs/bart/archive/2009/02/21/net-4-0-system-shell-commandline-parsing-part-1.aspx)上谈到了它

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-12T09:52:09.683

我建议[NDesk.Options](http://www.ndesk.org/Options)

看这里：

[在 C# 中解析命令行参数的最佳方法是什么？](https://stackoverflow.com/q/491595/735864)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-10T17:27:48.390

考虑一下，一旦您开始使用此解析器，您要么必须自己维护它，要么依赖其他人为您维护它。从最关键、最直接的需求开始，您最好自己编写。我发现为我从事过的大多数基于控制台的应用程序生成一些相当复杂的命令行解析并不需要太多的工作。

我还发现，当解析变得过于复杂时，可能是时候停止使用命令行了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-10T17:44:59.567

我敢打赌这不是你要找的，但是：

这里有人遇到了这个问题，他的第一个想法是“嘿，ocaml 有一个不错的！”，并迅速将其移植到 F#。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-12T12:58:24.510

我正在使用 C# 3.0 食谱中的解析器。

本书的所有例子都可以在这里下载： [http ://examples.oreilly.com/9780596516109/](http://examples.oreilly.com/9780596516109/)

搜索“参数”，您会找到它。您必须做一些小的代码更改才能将它从整个事情中移到您自己的类中，但这不是什么大问题。

它支持除最后两个点（参数组合和缺失空间）之外的所有点。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-01-28T17:11:34.590

BizArk[库](http://bizark.codeplex.com/)包含一个命令行解析器。

基本上，您只需创建一个从 CmdLineObject 继承的类，添加要从命令行填充的属性，将 CmdLineArgAttribute 添加到属性，然后在程序中调用 Initialize。它也支持 ClickOnce URL 参数！

功能（来自网站）...

*   自动初始化：根据命令行参数自动设置类属性。
*   默认属性：在不指定属性名称的情况下发送值。
*   值转换：使用 BizArk 中也包含的强大的 ConvertEx 类将值转换为正确的类型。
*   布尔标志。可以通过简单地使用参数来指定标志（例如，/b 表示真，/b- 表示假）或通过添加值 true/false、yes/no 等来指定。
*   参数数组。只需在命令行名称后添加多个值即可设置定义为数组的属性。例如，/x 1 2 3 将使用数组 { 1, 2, 3 } 填充 x（假设 x 被定义为整数数组）。
*   命令行别名：一个属性可以支持多个命令行别名。例如，帮助使用别名 ?。
*   部分名称识别。您不需要拼出全名或别名，只需拼写足以让解析器消除属性/别名与其他属性/别名的歧义。
*   支持 ClickOnce：即使在 ClickOnce 部署的应用程序的 URL 中将属性指定为查询字符串，也可以初始化属性。命令行初始化方法将检测它是否作为 ClickOnce 运行，因此您的代码在使用时无需更改。
*   自动创建 /? help: 这包括考虑到控制台宽度的漂亮格式。
*   将命令行参数加载/保存到文件：如果您有多个要运行多次的大型复杂命令行参数集，这将特别有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-09-09T19:23:49.000

我是 OptParse 的 C# 端口的粉丝，OptParse 是 Python 中的一个内置库。与此处的大多数其他建议相比，它使用起来相当简单，并且除了自动解析之外还包含许多有用的功能。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-01-23T17:13:34.520

你可能喜欢我的一个[Rug.Cmd](http://cmd.codeplex.com)

易于使用和可扩展的命令行参数解析器。句柄：布尔、加/减、字符串、字符串列表、CSV、枚举。

内置“/？” 帮助模式。

内置'/??' 和 '/?D' 文档生成器模式。

```
static void Main(string[] args) 
{            
    // create the argument parser
    ArgumentParser parser = new ArgumentParser("ArgumentExample", "Example of argument parsing");

    // create the argument for a string
    StringArgument StringArg = new StringArgument("String", "Example string argument", "This argument demonstrates string arguments");

    // add the argument to the parser 
    parser.Add("/", "String", StringArg);

    // parse arguemnts
    parser.Parse(args);

    // did the parser detect a /? argument 
    if (parser.HelpMode == false) 
    {
        // was the string argument defined 
        if (StringArg.Defined == true)
        {
            // write its value
            RC.WriteLine("String argument was defined");
            RC.WriteLine(StringArg.Value);
        }
    }
} 
```

编辑：这是我的项目，因此不应将这个答案视为第三方的认可。也就是说，我确实将它用于我编写的每个基于命令行的程序，它是开源的，我希望其他人可以从中受益。

# windows - 哪些语言不需要外部库/引用/依赖项？

> ID：631412
> 
> 赞同：1
> 
> 时间：2009-03-10T17:23:28.277
> 
> 标签：windows

有一个我需要为没有外部引用或依赖项的窗口组合起来的快速项目；像 C 这样的中坚力量是显而易见的，但是如果您是 .NET 开发人员并且需要非常快速地构建这样的东西，您会使用什么语言/工具？

编辑：最终我希望能够只使用编译器生成的 exe 并将其单独放在 Windows 机器上并运行应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T17:33:49.950

如果您是 .net 开发人员，您可以考虑使用[Remotesoft 的 Salamander](http://www.remotesoft.com/linker/)或其他将所有内容编译为单个可执行文件（包括框架）的类似工具。

此选项允许您在 .net 中进行开发，但不能在您的客户端系统上安装 .net 框架。如果您在非 MS 系统上进行部署，您可以使用 Mono 的部署工具免费完成同样的事情。

一般来说，我会说坚持你所知道的工具和语言。构建一个安装程序来安装 .net 框架比学习一套新的工具、库等更容易。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T17:34:33.647

您几乎可以为任何语言做到这一点（我不包括明显的 C/C++）

*   您可以将 .NET 运行时捆绑到您的 .exe 中并用 C# 编写应用程序
*   您可以使用 Python 编写应用程序，并使用 .exe 等工具将所有内容捆绑到单个 .exe 中`py2exe`。我经常这样做。可以使用 Python 和 PyQt 创建美观且功能强大的应用程序，将所有内容捆绑到一个无依赖的可执行文件中，然后部署给不需要安装其他任何东西的用户。可执行文件有几 MB 大（使用 PyQt 大约为 9），并且可以快速加载和运行。
*   等等。

您目前熟悉哪种语言/环境更为重要。专注于这一点，因为这些工具确实适用于您想要使用的任何东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T17:58:07.523

[Delphi](http://en.wikipedia.org/wiki/Borland_Delphi)一直是为 Windows 制作独立 .EXE 的最佳产品。在这方面，没有任何微软产品能接近它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-27T12:46:08.310

我认为通过[Lazarus IDE的](http://www.lazarus-ide.org/)[Free Pascal](http://www.freepascal.org/)是一个很好的全面答案。

Free Pascal 应用程序是本机且无依赖的，并且支持*很多*平台。太多了，这里就不一一列举了！Free Pascal 本身是一个免费的开源编译器。

为了更方便，我强烈推荐使用 Lazarus IDE。现在，您甚至可以获得用于跨平台 GUI 应用程序（以及控制台）的 RAD IDE，它具有大量内置功能，例如数据库支持。确实是一个非常可爱的一体式平台，通常被低估甚至未知，它可以生成自包含的本机可执行文件。如果您考虑一下，这些工具并不多。您甚至可以从中进行交叉编译，例如在 Windows 上为 Linux 编译 GUI 应用程序，而无需虚拟机。

有一天，我希望 .NET Native 能做到这一点，但它目前还远远不够，我不确定微软是否打算去那里。Google 的 Go 语言也很不错，因为它可以编译为本机跨平台代码，但缺少 GUI 库。Python 可以将其代码打包成可执行文件，但它是一种杂物，而不是本机代码。等等...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T17:33:18.410

C/C++ 将是您的语言，但不要使用任何花哨的库，如 MFC、MSVCRT 等，或者如果您确实将它们静态链接到您的可执行文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T17:25:34.667

“没有外部参考”有点含糊。您是在谈论应用程序的部署解决方案吗？

例如，您可以使用 Tcl，它支持创建包含应用程序代码和可以包含应用程序所需的任何其他文件的虚拟文件系统的单个文件可执行文件的能力。如果您的目标是创建一个无需安装额外文件即可部署的单个文件，请阅读“starkits”和“starpacks”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T17:35:34.567

如果您的目标是预装了 Windows Vista .NET 3.0，如果您的目标是预装了 Windows 7 .NET 3.5，如果您使用这些发行版中包含的库之外的任何其他库，那么您的应用程序将运行。无论如何，安装 .NET 并没有那么大的工作量，只需附带可再发行组件即可。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T17:51:53.247

汇编器。你唯一的依赖是 CPU

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-10T17:55:02.927

这是一个左字段答案...

Tcl

结合[starkits](http://www.equi4.com/starkit/)，您可以创建一个简单的可双击的.exe，而无需安装程序。

当然，缺点是它将用 tcl 编写。

作为额外的奖励，您将能够轻松地将您的应用程序移植到 mac 或 linux（或一系列其他奇怪的操作系统）

* * *

## 回答 #10

> 赞同：-7
> 
> 时间：2009-03-10T17:32:03.810

您认为 .NET Framework 是“外部的”吗？如果您坚持使用 .NET Framework 并使用 C#，那么您的代码应该可以在安装了适当版本的 .NET Framework 的任何地方运行，并且您只需要部署您的 .exe 和 .exe.config。

* * *

没有 .NET Framework 就无法运行 .NET 程序。如果不能要求已安装 .NET Framework，则不能使用 .NET 程序。我正是这个意思。

* * *

我不知道反对票是关于什么的，但让我再次尝试澄清一下。原帖说：

> 像 C 这样的中坚力量是显而易见的，但是如果您是 .NET 开发人员并且需要非常快速地构建这样的东西，您会使用什么语言/工具？

答案是，如果您是 .NET 开发人员，则没有可用于此目的的工具或语言，因为每个 .NET 程序都需要安装 .NET Framework。如果您需要一个完全独立的程序，请不要使用 .NET。正如其他人所回答的那样，您可以将 .NET 捆绑到您的 exe 中。如果您愿意发送一个 .MSI 文件而不仅仅是您的 exe，您也可以在您的应用程序中安装 .NET。

但是，根据定义，.NET 程序不能独立于 .NET Framework。

# javascript - JQuery getJSON - ajax 解析错误

> ID：631418
> 
> 赞同：15
> 
> 时间：2009-03-10T17:25:09.740
> 
> 标签：javascript, jquery, ajax, json, eval

我尝试使用 JQuery getJSON 和 ajax 解析以下 json 响应：

```
[{"iId":"1","heading":"Management Services","body":"<h1>Program Overview</h1><h1>January 29, 2009</h1>"}] 
```

我也尝试过像这样转义“/”字符：

```
[{"iId":"1","heading":"Management Services","body":"<h1>Program Overview <\/h1><h1>January 29, 2009<\/h1>"}] 
```

当我使用 getJSON 时，它不会执行回调。因此，我使用 JQuery ajax 进行了如下尝试：

```
$.ajax({
    url: jURL,
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    beforeSend: function(x) {
        if(x && x.overrideMimeType) {
            x.overrideMimeType("application/j-son;charset=UTF-8");
        }
    },
    success: function(data){
        wId = data.iId;
        $("#txtHeading").val(data.heading);
        $("#txtBody").val(data.body);
        $("#add").slideUp("slow");
        $("#edit").slideDown("slow");
    },//success
    error: function (XMLHttpRequest, textStatus, errorThrown) {
        alert("XMLHttpRequest="+XMLHttpRequest.responseText+"\ntextStatus="+textStatus+"\nerrorThrown="+errorThrown);
    }
}); 
```

ajax 遇到错误并发出以下警报：

```
XMLHttpRequest=[{"iId":"1","heading":"Management Services","body":"<h1>Program Overview </h1><h1>January 29, 2009</h1>"}]

textStatus=parseerror

errorThrown=undefined 
```

然后我尝试了一个简单的 JQuery get 调用以使用以下代码返回 JSON：

```
$.get(jURL,function(data){
    var json = eval("("+data+");");
    wId = json.iId;
    $("#txtHeading").val(json.heading);
    $("#txtBody").val(json.body);
    $("#add").slideUp("slow");
    $("#edit").slideDown("slow");
}) 
```

.get 返回 JSON，但无论我如何修改 JSON（内容类型标头、格式的其他变体等），eval 都会出现错误

我想出的是，在 JSON 中返回 HTML 并对其进行解析似乎存在问题。但是，我希望我可能错过了一些可以让我通过 JSON 获取这些数据的东西。有没有人有任何想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T18:46:47.483

您拥有的 JSON 字符串是一个包含 1 个对象的数组，因此要访问该对象，您必须先访问该数组。使用如下所示的 json.php：

```
[
    {
        "iId": "1",
        "heading": "Management Services",
        "body": "<h1>Program Overview</h1><h1>January 29, 2009</h1>"
    }
] 
```

我刚试过这个

```
$.getJSON("json.php", function(json) {
    alert(json[0].body); // <h1>Program Overview</h1><h1>January 29, 2009</h1>
    alert(json[0].heading); // "Management Services"
    alert(json[0].iId); // "1"
}); 
```

我也试过这个：

```
$.get("json.php", function(data){
    json = eval(data);
    alert(json[0].body); // <h1>Program Overview</h1><h1>January 29, 2009</h1>
    alert(json[0].heading); // "Management Services"
    alert(json[0].iId); // "1" 
}); 
```

他们都为我工作得很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-17T18:43:14.813

If anyone is still having problems with this it's because your response needs to be a JSON string and content-type "application/json".

Example for HTTP in asp.net (c#):

```
public void ProcessRequest(HttpContext context)
    {
        context.Response.ContentType = "application/json";
        context.Response.Write("{ status: 'success' }");
    } 
```

hth,

Matti

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:32:23.387

您是否尝试过对 HTML 进行 XML 编码（即 <H1>）？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T17:36:04.517

您可以将其作为文本返回，然后使用[json.org 解析器](http://www.JSON.org/js.html)
对其进行解析 以查看其工作方式是否有所不同

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-29T07:03:33.050

禁用 Firebug Lite 为我解决了这个问题。

[错误组合：jQuery 1.4、ajax/json、Firebug Lite 和 IE 8](https://stackoverflow.com/questions/3894914/bug-with-combination-of-jquery-1-4-ajax-json-firebug-lite-and-ie-8)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-24T20:49:45.957

请注意，问题中存在语法错误。该行与

```
x.overrideMimeType("application/j-son;charset=UTF-8"); 
```

应该读

```
x.overrideMimeType("application/json; charset=UTF-8"); 
```

这也有很大的不同。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-01T11:31:42.897

删除JsonData前面和最后一个[]，它就可以工作了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-07-23T17:32:02.020

这是一个工作示例并经过测试！

```
<script type="text/javascript">

function fetchData() {
var dataurl = "pie.json";
$.ajax({
    url: dataurl,
    cache: false,
    method: 'GET',
    dataType: 'json',
    success:  function(series) {
        var data = [];
        //alert(series.length);
        for (var i=0; i<series.length;i++){
            data[i]=series[i];
        }

        $.plot(
                $("#placeholder"), 
                data, 
                {
                     series: {
                       pie: {
                         show: true,
                         label: {
                           show: true
                         }
                     }
                    },
                    legend: {
                      show: true
                    }
                  }
       );
     }
});

   //setTimeout(fetchData, 1000);
}
</script> 
```

json源如下（pie.json）：

```
[{ "label": "Series1",  "data": 10},
{ "label": "Series2",  "data": 30},
{ "label": "Series3",  "data": 90},
{ "label": "Series4",  "data": 70},
{ "label": "Series5",  "data": 80},
{ "label": "Series6",  "data": 110}] 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-22T03:59:25.683

昨天在$。ajax还是没有错误，今天是引用错误，有人说是parsererror jquery版本的问题，我用的是jquery-1.3.2.min.js，昨天。这版也做了，今天洗白了。数据来源：无变化。不知道是什么原因？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-06T12:37:37.683

也试试这个

```
$.ajax({
    url: url,
    data:datas,
    success:function(datas, textStatus, jqXHR){
    var returnedData = jQuery.parseJSON(datas.substr(datas.indexOf('{')));
})}; 
```

在我的情况下，服务器在“{”之前以未知字符响应

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-10T17:57:45.980

首先，尝试确定问题是否与一般 JSON 编码/解码有关。尝试更简单的对象，使用数字和纯字符串，然后使用引用的 HTML。

在你让 JSON 工作之后，你真的应该考虑从那里删除 HTML。更好的是只移动数据，并将演示细节留给模板。使用 AJAX 时，这意味着 HTML 中的隐藏模板，并使用 jQuery 复制它并填充数据。检查任何 jQuery[模板插件](http://plugins.jquery.com/taxonomy/term/296)。其中，[jTemplates](http://plugins.jquery.com/project/jTemplates)是最受欢迎的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-10T18:07:20.260

我认为你在问错误的问题。使用 $.getJSON() 要容易得多，如果您遇到问题，最好请求 $.getJSON() 而不是 $.ajax()。您可能还会发现查看 getJSON 函数源代码很有用，因为我知道，您在 mimeTypes 那里有很多无用的东西。那不是办法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-10T18:11:49.097

您尝试解析的值包含在括号 [] 中，这意味着它是一个数组。您正在尝试评估数组。尝试评估数组的第一个元素，它应该可以工作......

```
var json = eval("("+data[0]+");"); 
```

另外，我建议使用[此处](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)提供的 JSON.parse()而不是直接调用 eval()。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-12-21T12:52:17.193

就我而言，错误是由 json 中的 html 标签引起的。

不正确（解析器错误）

```
{"msg": "Gracias,< br >Nos pondremos en contacto."} 
```

正确的

```
{"msg": "Gracias, nos pondremos en contacto."} 
```

浏览器：IE7/IE8

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-11-30T14:01:51.987

不要使用数组框，并确保正确格式化数据：

```
{"account":{"iId":"1","heading":"Management Services","body":"<h1>Program Overview</h1><h1>January 29, 2009</h1>"}} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-05-10T09:28:37.783

可能是因为您的输出缓冲区不为空，所以 AJAX 接收到不属于 JSON 的字节。

在使用or`ob_clean()`输出 json 之前，在服务器端尝试使用清理缓冲区。而且您无需指定，我认为您的默认值将正常工作。`echo``die()``contentType`

我有同样的问题，它解决了它。

希望能帮到你。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-05-24T04:24:40.877

我收到了类似的错误。花了我一段时间才知道——我几乎不知道 PHP 自 PHP5.2 以来（本机）不支持 JSON。严重提醒...

# jquery - JQuery 可拖动的 div

> ID：631419
> 
> 赞同：0
> 
> 时间：2009-03-10T17:25:23.263
> 
> 标签：jquery, jquery-ui, user-interface, draggable

我有一个应用程序，其界面基于带有可拖动选项卡的典型操作系统用户界面。

我想让选项卡像操作系统中的窗口一样，最后点击的选项卡/窗口出现在任何其他窗口的“顶部”。

我知道这与元素的 z-index 有关。这是代码的简化版本：

```
<div class="tab">
content
</div>

$('.tab').draggable({ zIndex: 1000000 }); 
```

当标签处于被拖动的行为中时，就会发生所需的行为。

有没有办法实现上述行为？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:39:58.610

感谢您的快速回复。我找到了一种简单的方法，我完全忽略了 JQuery 文档。

使用堆栈选项：

```
$('.tab').draggable( {stack: { group: '.tab', min: 50 }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T17:31:42.483

完成拖动后，手动设置 div 的 css 的 z-index。

[在这里查看。](http://www.tjkdesign.com/articles/z-index/teach_yourself_how_elements_stack.asp)

# sql-server-2005 - TSQL查看、添加和删除权限

> ID：631425
> 
> 赞同：0
> 
> 时间：2009-03-10T17:25:51.780
> 
> 标签：sql-server-2005, tsql

我在新数据库（Microsoft SQL Server 2005）上创建了几个新表。现在，这些表已准备好供客户端用户使用 System DSN ODBC 对象（使用 SQL 身份验证）通过 Access 2003 查看。我所做的是在数据库中创建一个角色和一个模式，并为我的 SQL 服务器默认使用我的数据库和模式名称创建一个登录用户。

问题是客户不仅可以看到我创建的表，还可以看到数据库中的系统视图对象。我不确定应该如何设置 SQL 登录用户、架构和角色，以便只有我的表可见？不知道为什么系统视图对象默认对登录用户可见。

另一种清理我现在拥有的权限的方法。我确实检查了一些系统视图对象（很长的列表）。他们都拥有我使用公共架构创建的架构的权限。有没有办法通过使用 T-SQL 脚本来查看然后删除与我的架构关联的那些系统视图对象的权限？之后，我需要使用类似的脚本将我的架构权限添加到我创建的表中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T21:32:48.317

好吧，默认情况下，新用户也将是“公共”服务器和数据库角色的成员。系统中的对象。和 INFORMATION_SCHEMA 模式对公共角色的成员可见。

您可以明确拒绝您自己的角色访问这些模式，也可以从登录用户中删除公共角色。

马克

# c# - .NET：如何判断编码是否支持字符串中的所有字符？

> ID：631426
> 
> 赞同：3
> 
> 时间：2009-03-10T17:26:01.373
> 
> 标签：c#, .net, text, encoding, character-encoding

我有很多需要输出的文本，其中包括来自多种语言的各种字符。有时我需要以 Unicode 以外的字符编码（例如 Shift-JIS 或 ISO-8859-2）输出文本，以匹配它要到达的页面。

如果文本包含编码无法处理的字符（例如，ISO-8859-2 编码输出中的日文字符），我最终会在输出中出现奇数字符。我可以逃脱他们，但我宁愿只有在真的有必要时才这样做。

所以，我的问题是：有没有一种方法可以提前判断编码是否可以处理字符串中的所有字符？

编辑：我认为 EncoderFallback 可能是我提出的问题的正确答案。不幸的是，它似乎不适用于我的特定情况。我的想法是将字符转换为它们的 HTML 实体等价物（例如，モ 而不是 モ）。但是，编码器只转换它找到的第一个这样的字符，如果我设置 Response.ContentEncoding 它根本不会调用我的 EncoderFallback。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T17:36:41.240

您可以编写自己的 EncoderFallback 类，在编码之前将其分配给编码器。

使用这种方法，您无需进行任何高级操作（这可能只是处理输出字符串以查找问题）。

相反，您的后备类只需要处理编码没有字符值的替换。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T17:40:22.057

尝试使用[EncoderFallback](http://msdn.microsoft.com/en-us/library/system.text.encoding.encoderfallback.aspx)设置为[EncoderExceptionFallback](http://msdn.microsoft.com/en-us/library/system.text.encoderexceptionfallback.aspx)的 Encoding 对字符串进行编码。例如。：

```
Encoding e= Encoding.GetEncoding(932, new EncoderExceptionFallback(), new DecoderExceptionFallback()); 
```

然后在 GetBytes() 时捕获[EncoderFallbackException 。](http://msdn.microsoft.com/en-us/library/system.text.encoderfallbackexception.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:35:30.510

将其转换为目标编码，将其转换回来并与原始编码进行比较？

尝试 Encoding.GetBytes() 和 Encoding.GetStrings() 来回转换。

作为一种优化，您可以从原始字符串中搜索所有使用的 unicode 字符，然后使用它来尝试编码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T17:45:02.157

我认为这些方法应该已经奏效了。（EncoderFallback 解决方案似乎相当不错。）但是，如果您喜欢它，这里有一个替代方案。

通过调用 encoding.GetEncoder() 为要测试的编码创建编码器。然后，您可以调用 Encoder 对象的 Convert 方法，传入您的文本，并查看*完成*的out 参数的值以确定它是否成功。

如果速度是一个问题，您可能想要对各种方法进行基准测试，但我怀疑它们都会有非常相似的性能配置文件。

# iphone - 有没有办法在 iPhone 上通过触摸？

> ID：631427
> 
> 赞同：23
> 
> 时间：2009-03-10T17:26:12.467
> 
> 标签：iphone, cocoa-touch

我有几个`UIButton`s 用于在主区域点击时设置当前操作。我还想允许用户从按钮直接拖动到主区域并采取相同的操作；本质上，touchesBegan 和 touchesMoved 应该在触摸 UIButtons 时传递给主视图，但也应该发送按钮按下动作。

现在，我在更改控件内部进行了润色。拖拽退出调用touch up inside部分设置控件，然后调用touches begin部分开始主区域触摸操作。

但是，此时 touchesMoved 和 touchesEnded 显然没有被调用，因为这些触摸源自 UIButton。

有没有办法半忽略触摸，以便将它们传递到主要区域，但也允许我先设置控件？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-05-05T00:00:13.287

我知道这个问题已经有两年了（并且已经回答了），但是……

当我自己尝试这个时，触摸被转发，但按钮不再像按钮一样。我也将触摸传递给“超级”，现在一切都很好。

因此，对于可能偶然发现这一点的初学者来说，代码应该是这样的：

```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {  
    [super touchesBegan:touches withEvent:event];
    [self.nextResponder touchesBegan:touches withEvent:event]; 
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-11T01:22:24.927

在文档中，查找[Responder Objects 和 Responder Chain](http://developer.apple.com/IPhone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/EventHandling/EventHandling.html#//apple_ref/doc/uid/TP40007072-CH9-SW2)

您可以通过将触摸转发到响应者链来在对象之间“共享”触摸。你的 UIButton 有一个接收 UITouch 事件的响应器/控制器，我的猜测是，一旦它对它返回的消息进行了解释 - 触摸已经被处理和处理。

苹果建议这样的事情（当然基于触摸的类型）：

`[self.nextResponder touchesBegan:touches withEvent:event];`

而不是处理它传递的触摸事件。

子类 UIButton：

**我的按钮.h**

```
#import <Foundation/Foundation.h>

@interface MyButton : UIButton {

}
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event ;

@end 
```

**我的按钮.m**

```
#import "MyButton.h"

@implementation MyButton

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {  
    printf("MyButton touch Began\n");
    [self.nextResponder touchesBegan:touches withEvent:event]; 
}
@end 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2012-01-05T15:59:54.067

也不需要子类！只需将其粘贴在您的实施顶部，然后再执行其他任何操作：

```
#pragma mark PassTouch

@interface UIButton (PassTouch)
@end

@implementation UIButton (PassTouch)
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesBegan:touches withEvent:event];
    [self.nextResponder touchesBegan:touches withEvent:event];
}
- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesMoved:touches withEvent:event];
    [self.nextResponder touchesMoved:touches withEvent:event];
}
- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesEnded:touches withEvent:event];
    [self.nextResponder touchesEnded:touches withEvent:event];
}
- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesCancelled:touches withEvent:event];
    [self.nextResponder touchesCancelled:touches withEvent:event];
}
@end 
```

# python - Hello world Pyamf 小错误信息

> ID：631436
> 
> 赞同：1
> 
> 时间：2009-03-10T17:27:25.677
> 
> 标签：python, django, apache-flex, pyamf

嗨，我正在尝试使用 Pyamf 将 flex 链接到 django

作为第一步，我尝试了基本的 Hello World [http://pyamf.org/wiki/DjangoHowto](http://pyamf.org/wiki/DjangoHowto)

但这会导致 ErrorFault。

我使用 django 1.0.2

**amfgateway.py**在我的项目的根文件夹中（与设置相同的级别）

```
import pyamf
from pyamf.remoting.gateway.django import DjangoGateway
from django.contrib.auth.models import User

pyamf.register_class(User, 'django.contrib.auth.models.User')

def get_users(requet):
    return User.objects.all()

def echo(request, data):
    return data

services = {
    'myservice.echo': echo,
    'myservice.get_users': get_users,
}

edoGateway = DjangoGateway(services, expose_request=False) 
```

**在 urls.py**

```
urlpatterns = patterns('',

    # test pyamf
    url(r'^gateway/', 'amfgateway.edoGateway'),
    ...
) 
```

然后当我用 pyamf 客户端测试示例时

```
from pyamf.remoting.client import RemotingService

gw = RemotingService('http://127.0.0.1:8000/gateway/')
service = gw.getService('myservice')

print service.echo('Hello World!') 
```

**我明白了**

*ErrorFault level=error code=500 type=u'AttributeError' description=u"找不到路径['/gateway/myservice/echo']的视图，'DjangoGateway'对象没有属性'name' **"** Traceback: u “找不到路径 ['/gateway/myservice/echo'] 的视图，'DjangoGateway' 对象没有属性 ' **name** '”*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T18:54:05.330

我认为您可能需要从 echo def 中取出请求参数，至少 pyamf 示例站点上的方法在方法中没有该参数

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-05T20:48:25.910

尽管错误无关，但 JMP 是正确的 - 您`expose_request=False`在网关上有，并且 echo 的服务定义将第一个参数作为 Django Http 请求对象。

这是行不通的，但是 PyAMF 在这里确实允许一些粒度，您可以使用 expose_request 装饰器，例如：

```
from pyamf.remoting.gateway import expose_request

@expose_request
def echo(request, data):
    return echo 
```

# python - Python中的可中断线程连接

> ID：631441
> 
> 赞同：26
> 
> 时间：2009-03-10T17:28:16.127
> 
> 标签：python, multithreading

**有什么方法可以等待线程终止，但仍然拦截信号？**

考虑以下**C**程序：

```
#include <signal.h>
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <pthread.h>
#include <stdlib.h>

void* server_thread(void* dummy) {
    sleep(10);
    printf("Served\n");
    return NULL;
}

void* kill_thread(void* dummy) {
    sleep(1); // Let the main thread join
    printf("Killing\n");
    kill(getpid(), SIGUSR1);
    return NULL;
}

void handler(int signum) {
    printf("Handling %d\n", signum);
    exit(42);
}

int main() {
    pthread_t servth;
    pthread_t killth;

    signal(SIGUSR1, handler);

    pthread_create(&servth, NULL, server_thread, NULL);
    pthread_create(&killth, NULL, kill_thread, NULL);

    pthread_join(servth, NULL);

    printf("Main thread finished\n");
    return 0;
} 
```

它在一秒钟后结束并打印：

```
Killing
Handling 10 
```

相比之下，这是我用**Python**编写它的尝试：

```
#!/usr/bin/env python
import signal, time, threading, os, sys

def handler(signum, frame):
    print("Handling " + str(signum) + ", frame:" + str(frame))
    exit(42)
signal.signal(signal.SIGUSR1, handler)

def server_thread():
    time.sleep(10)
    print("Served")
servth = threading.Thread(target=server_thread)
servth.start()

def kill_thread():
    time.sleep(1) # Let the main thread join
    print("Killing")
    os.kill(os.getpid(), signal.SIGUSR1)
killth = threading.Thread(target=kill_thread)
killth.start()

servth.join()

print("Main thread finished") 
```

它打印：

```
Killing
Served
Handling 10, frame:<frame object at 0x12649c0> 
```

**如何让它表现得像 C 版本？**

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-10T18:12:29.033

鉴于全局解释器锁，Python 中的线程有点奇怪。如果不使用 eliben 建议的加入超时和 isAlive，您可能无法实现您想要的。

文档中有两个地方给出了这个原因（可能还有更多）。

首先：

来自[http://docs.python.org/library/signal.html#module-signal](http://docs.python.org/library/signal.html#module-signal)：

> 如果在同一个程序中同时使用信号和线程，则必须小心。同时使用信号和线程时要记住的基本事项是：始终在执行的主线程中执行 signal() 操作。任何线程都可以执行alarm()、getsignal()、pause()、setitimer()或getitimer()；只有主线程可以设置新的信号处理程序，并且主线程将是唯一接收信号的线程（这是由 Python 信号模块强制执行的，即使底层线程实现支持向单个线程发送信号）。这意味着信号不能用作线程间通信的手段。改用锁。

第二个，来自[http://docs.python.org/library/thread.html#module-thread](http://docs.python.org/library/thread.html#module-thread)：

> 线程与中断的交互很奇怪：KeyboardInterrupt 异常将被任意线程接收。（当信号模块可用时，中断总是转到主线程。）

**编辑：**在 python 错误跟踪器上对此机制进行了不错的讨论：http: [//bugs.python.org/issue1167930](http://bugs.python.org/issue1167930)。当然，它的结尾是 Guido 说：“这不太可能消失，所以你只需要忍受这个。正如你所发现的，指定超时可以解决问题（在某种程度上）。” YMMV :-)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-11T12:04:39.453

Jarret Hardie 已经[提到它](https://stackoverflow.com/questions/631441/interruptible-thread-join-in-python/631605#631605)：根据[Guido van Rossum](http://bugs.python.org/msg56947)的说法，目前没有更好的方法：如[文档](http://docs.python.org/library/threading.html#threading.Thread.join)中所述，`join(None)`阻塞（这意味着没有信号）。另一种选择 - 以巨大的超时（`join(2**31)`或左右）调用并检查`isAlive`看起来很棒。然而，Python 处理计时器的方式是灾难性的，正如在运行 python 测试程序时使用`servth.join(100)`而不是`servth.join()`：

```
select(0, NULL, NULL, NULL, {0, 1000})  = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 2000})  = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 4000})  = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 8000})  = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 16000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 32000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 50000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 50000}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {0, 50000}) = 0 (Timeout)
--- Skipped 15 equal lines ---
select(0, NULL, NULL, NULL, {0, 50000}Killing 
```

即，Python 每 50 毫秒唤醒一次，导致单个应用程序阻止 CPU 进入休眠状态。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T17:43:59.693

`isAlive`打电话前轮询`join`。当然，这种轮询可以被中断，并且一旦线程不是`isAlive`，`join`就会立即进行。

另一种方法是`join`使用超时进行轮询，检查`isAlive`是否发生超时。与以前的方法相比，这可以花费更少的 CPU。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-21T08:47:08.140

据我了解，类似的问题在[The Little Book of Semaphores](http://greenteapress.com/semaphores/)（免费下载）附录 A 第 3 部分中得到了解决……</p>

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-21T07:53:52.273

我知道我参加聚会有点晚了，但我提出这个问题是希望得到一个比我已经在做的超时加入更好的答案。最后，我做了一些可能是也可能不是信号的可怕混蛋的东西，但它涉及在线程到达其执行结束时使用`signal.pause()`而不是向当前进程发出信号：`Thread.join()`

```
import signal, os, time, sys, threading, random

threadcount = 200

threadlock = threading.Lock()
pid = os.getpid()
sigchld_count = 0

def handle_sigterm(signalnum, frame):
    print "SIGTERM"

def handle_sigchld(signalnum, frame):
    global sigchld_count
    sigchld_count += 1

def faux_join():
    global threadcount, threadlock
    threadlock.acquire()
    threadcount -= 1
    threadlock.release()
    os.kill(pid, signal.SIGCHLD)

def thread_doer():
    time.sleep(2+(2*random.random()))
    faux_join()

if __name__ == '__main__':
    signal.signal(signal.SIGCHLD, handle_sigchld)
    signal.signal(signal.SIGTERM, handle_sigterm)

    print pid
    for i in xrange(0, threadcount):
        t = threading.Thread(target=thread_doer)
        t.start()

    while 1:
        if threadcount == 0: break
        signal.pause()
        print "Signal unpaused, thread count %s" % threadcount

    print "All threads finished"
    print "SIGCHLD handler called %s times" % sigchld_count 
```

如果您想查看 SIGTERM 的运行情况，请延长睡眠时间的长度并从另一个终端`thread_doer`发出命令，其中pid id 是在开始时打印的。`kill $pid``$pid`

我发布这篇文章是为了帮助其他人，就像被告知这很疯狂或有错误一样。我不确定是否仍然需要锁定线程计数 - 我在实验的早期就把它放在那里，并认为我应该把它放在那里以防万一。

# .net - LINQ to SQL 部署问题

> ID：631442
> 
> 赞同：0
> 
> 时间：2009-03-10T17:28:16.550
> 
> 标签：.net, asp.net, linq, linq-to-sql, deployment

我开发了一个 asp.net 应用程序。它使用 LINQ to SQL 访问数据库，使用 Visual Studio 2008 中的 .dbml 设计器。我们正在客户端上安装应用程序，他们决定更改服务器上的数据库名称。现在，应用程序无法运行，因为 LINQ 找不到数据库信息。这不是连接字符串的问题，而是 .dmbl 设计器生成的文件的问题。我想我们有一些选择： 1\. 更改开发数据库名称以匹配客户端名称，重新生成 de dbml，重新编译，然后再次将应用程序发送给客户端。2\. 在客户端安装VS2008并进行必要的修改。

没有一个选项看起来真的很好。这不是世界末日，而是真正的痛苦。希望有更合理的解决方案！有任何想法吗？

* * *

**更新**
在您的答案的帮助下进一步研究了问题后，我认为问题出在架构上。总而言之，数据库有一个新名称和一个新模式。我想 sqlmetal.exe 选项是目前最好的选项。无论如何，如果是这样的话，我仍然认为这是一个真正的痛苦。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T17:44:50.300

我会说是连接字符串的问题，看生成的类：

```
 public SomeDataContext() : 
        base(global::System.Configuration.ConfigurationManager
.ConnectionStrings["someConnectionStringKey"].ConnectionString, mappingSource) 
```

请提供更多信息。也许您的意思是模式更改，在这种情况下，我强烈建议在开发环境中使用相同的模式。

**更新 1：**也许生成的类上的 DatabaseAttribute 让你感到困惑。

> **当连接未提供**名称时，使用 DatabaseAttribute 特性上的 Name 属性来指定数据库的名称

 **资料来源：http: [//msdn.microsoft.com/en-us/library/bb399355.aspx#](http://msdn.microsoft.com/en-us/library/bb399355.aspx#)（我的enpashis）

只需在连接字符串中指定数据库，就可以了。

**更新 2：**如果您生成的类由于某种原因没有上述代码（并且您没有在参数中明确指定一个），请在设计器中打开它，打开属性，并确保它在 Connection 中配置应用程序设置设置为真值的属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:43:16.043

作为 VS2008 类 SQLMetal.exe 的一部分，有一个 exe，它执行生成 DataContext.cs 文件的重要部分。我认为您所要做的就是更改 DBML 文件（它是一个简单的 XML 文件），运行 SQLMetal（生成 .CS），然后运行 ​​csc.exe（.NET 框架的一部分）来生成一个程序集（如果您将 DataContext 单独放在程序集中会更容易）。这基本上归结为选项 2，但需要安装的文件要少得多。

* * *

**更新**：重新阅读你的问题，我意识到改变的不是表名，而是*数据库*名。这是一个不同的问题（尽管上述解决方案也适用于此）。

当 VS2008 从 .dbml 文件生成 DataContext 类时，它会创建两个构造函数：一个不带参数，一个带一个字符串（加上几个 ctor，我们可以忽略）。

零参数 ctor 使用您在创建 dbml 时使用的连接字符串，然后将其嵌入到资源文件中。这是一个*非常*愚蠢的设计，真的应该只用于概念验证代码和演示。

所有真正的生产代码都应该使用带有字符串的ctor——特别是连接字符串——你应该从app.config文件中读出它。

这当然意味着“正确”的解决方案是选项#1——在你的办公室重写代码并重新部署。这是一个麻烦，但从长远来看，这是最好的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T20:34:41.000

操作：

我很惊讶这会导致问题。我使用 Linq to SQL 开发了大约 5 个附加组件。为了避免这种情况，我唯一要做的就是执行以下操作：

使用 (NamedDataContext ctx = new NamedDataContext("{从配置文件/注册表项/等插入连接字符串}")) {

...要针对数据库执行的代码...

}

并且目前还没有遇到任何问题。我很困惑为什么您的应用程序没有配置方法来处理配置数据库连接，因为这通常是大多数应用程序需要内置到其中的第一件事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T20:46:29.800

我个人会告诉客户，从开发的数据库名称更改数据库名称将花费他们 XX 美元的新开发成本，然后看着他们立即更改名称。

# php - 让 imagegrabscreen 工作

> ID：631449
> 
> 赞同：1
> 
> 时间：2009-03-10T17:30:56.870
> 
> 标签：php, gd, screenshot

我正在尝试让[`imagegrabscreen`](http://php.net/imagegrabscreen)（GD 函数）与我的 Apache/Vista PC 一起工作。

我正在使用以下代码：

```
<?php
$im = imagegrabscreen();

header('Content-type: image/png');
imagepng($im);
imagedestroy($im);
?> 
```

目前我得到一个纯黑色的图像，我的辅助显示器的大小（1024 * 768）。我正在使用 Apache 2.2，作为服务运行，关闭 UAC 的 Vista SP1，PHP 5.2.8 和 GD（信息如下）。我已按照`imagegrabscreen`页面上有关允许 Apache 访问桌面的说明进行操作。我还重新启动了服务和 apache 服务器。我得到相同的结果`imagegrabwindow`。

这是一个错误（其他人在运行此方法时遇到问题吗？）还是我做错了什么？

```
Array
(
    [GD Version] => bundled (2.0.34 compatible)
    [FreeType Support] => 1
    [FreeType Linkage] => with freetype
    [T1Lib Support] => 1
    [GIF Read Support] => 1
    [GIF Create Support] => 1
    [JPG Support] => 1
    [PNG Support] => 1
    [WBMP Support] => 1
    [XPM Support] => 
    [XBM Support] => 1
    [JIS-mapped Japanese Font Support] => 
) 
```

**Apache 服务登录详细信息：**

[http://www.kalleload.net/uploads/maogfnfnczfh.png http://www.kalleload.net/uploads/maogfnfnczfh.png](http://www.kalleload.net/uploads/maogfnfnczfh.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T17:17:13.337

我查看了 imagegrabscreen() 的源代码；

在这一点上，我认为它失败了，因为我们都有多显示器设置。

当前代码调用 GetDC(0)，根据 [http://msdn.microsoft.com/en-us/library/dd144871(VS.85).aspx](http://msdn.microsoft.com/en-us/library/dd144871(VS.85).aspx) 应该返回“整个屏幕”的设备上下文，但是“要获取特定显示器的 DC，请使用 EnumDisplayMonitors 和 CreateDC 函数"

我将对此进行更多测试，看看我是否可以提出对多显示器友好的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-28T22:15:53.917

我认为`imagegrabscreen()`仅适用于 Windows XP 而不是 Vista。
你应该检查这个[链接](http://php.net/manual/en/function.imagegrabscreen.php)

# php - mysql_query 中 SELECT 后的 INSERT 语句

> ID：631458
> 
> 赞同：1
> 
> 时间：2009-03-10T17:32:52.747
> 
> 标签：php, mysql

我试图在一个 mysql_query 中执行两个 SQL 语句。

```
$mySql = mysql_query("SELECT itemid, points FROM items WHERE id='1' UPDATE accounts SET userpoints = '1000'"); 
```

这可能吗？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T17:35:55.063

您只能执行一个查询`mysql_query`（即使您使用分号终止符分隔查询）。

您必须单独调用它们（尽管[这家伙](http://www.dev-explorer.com/articles/multiple-mysql-queries)有一种方法可以自动化）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:21:43.690

如果你使用 mysqli 你可以使用[`mysqli_multi_query()`](http://us.php.net/manual/en/mysqli.multi-query.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:38:24.980

我不会尝试这样做，因为您将无法利用不同查询的结果（返回值、mysql_insert_id()、...）

# python - Python 中的字典

> ID：631463
> 
> 赞同：5
> 
> 时间：2009-03-10T17:34:43.850
> 
> 标签：python, dictionary

我正在努力加快字典的使用速度。昨晚我花了三个小时在网上搜索与我正在尝试做的一些事情类似的例子。例如，假设我有两个字典（实际上我有两个字典列表）。

```
d1={key1:1, key2:2}
d2={key1:1, key2:'A', key4:4} 
```

我想更新 d1，使其如下所示：

```
d1={key1:1, key2:[2,'A'], key3:3, key4:4} 
```

我似乎找不到足够的例子让我开始。我有很多书，我也审过它们，但它们似乎都有我在网上找到的相同类型的例子。

有谁知道一个地方或一本书有明确的例子和如何使用字典的描述？

我认为我遇到的问题之一是我不了解在访问字典时如何维护引用。

我可以检查这两个字典是否有一个共同的键：

```
for k in d1.keys():
    for k2 in d2.keys():
        if k==k2:
            print 'true' 
```

但如果他们这样做，我似乎无法将这些值组合成一个列表。

不仅仅是对这个特定示例的直接回答，我将不胜感激有关使用字典的好例子的地方的任何建议。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-10T17:37:22.843

试试这个：

```
import collections
merged = collections.defaultdict(list)
for k in d1:
   merged[k].append( d1[k] )
for k in d2:
   merged[k].append( d2[k] ) 
```

这可能是您正在寻找的。

或者可能是这个。

```
import collections
merged = collections.defaultdict(set)
for k in d1:
   merged[k].add( d1[k] )
for k in d2:
   merged[k].add( d2[k] ) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T17:49:32.130

一个好的起点是获取 iPython ( `easy_install ipython`)，然后使用制表符完成四处寻找，`?`并且`dir`：

```
In [2]: dir {}
------> dir({})

Out[2]: 
['__class__',
 ...
 'keys',
 'pop',
 'popitem',
 'setdefault',
 'update',
 'values']

In [3]: {}.update?
Type:       dict
Base Class: <type 'dict'>
String Form:    {}
Namespace:  Interactive
Length:     0
Docstring:
    dict() -> new empty dictionary.
    dict(mapping) -> new dictionary initialized from a mapping object's
        (key, value) pairs.
    dict(seq) -> new dictionary initialized as if via:
        d = {}
        for k, v in seq:
            d[k] = v
    dict(**kwargs) -> new dictionary initialized with the name=value pairs
        in the keyword argument list.  For example:  dict(one=1, two=2) 
```

（仅举例）

无论如何，您在检查两个字典之间通用的键时遇到的问题：有一些事情需要考虑（也许看看`set`课程？），但我会这样做：

```
common_keys = [k for k in dict1 if k in dict2] 
```

（即，“dict1 中的每个键`k`，如果该键也在 dict2 中”）（还要注意，测试字典成员资格是 O(1) 操作，所以这将在 O(|dict1|) 中运行）

**编辑**：好的，所以这并不能解决将两个字典合并为一个列表的问题......但是洛特的回答对此有好处，或者您可以使用以下`setdefault`方法：

```
new = {}
for (k, v) in dict1.items():
    new.setdefault(k, []).append(v)
for (k, v) in dict2.items():
    new.setdefault(k, []).append(v) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T17:55:08.123

我相信这就是你想要的：

```
>>> d1={'key1':1, 'key2':2}
>>> d2={'key1':1, 'key2':'A', 'key4':4}
>>> d = {}
>>> d.update(d1)
>>> for i in d2:
        if i in d and d2[i] != d[i]:
            d[i] = [d[i], d2[i]]
        else:
            d[i] = d2[i]            
>>> d
{'key2': [2, 'A'], 'key1': 1, 'key4': 4} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T17:37:53.467

这里有一些很好的链接：

[http://www.diveintopython.org/getting_to_know_python/dictionaries.html](http://www.diveintopython.org/getting_to_know_python/dictionaries.html)
[http://docs.python.org/tutorial/datastructures.html#dictionaries](http://docs.python.org/tutorial/datastructures.html#dictionaries)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T17:42:18.653

Python 字典的工作方式也很像 PHP 中的关联数组，如果您有使用该语言的经验的话。

Python 文档中的内置类型页面也有一个很好的字典部分，该部分还有一个可用的函数列表：

[http://docs.python.org/library/stdtypes.html#mapping-types-dict](http://docs.python.org/library/stdtypes.html#mapping-types-dict)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T18:04:25.307

好吧，对于您的第一种情况，您可能需要一个帮助器，它将两个对象组合成一个包含两个对象的列表，并将两个列表组合成一个包含两个列表中的项目的列表，

当然，这是假设您总是将键合并到列表中，但您不希望您的键最终成为“列表列表”

```
def listify( obj ): 
   if type(obj) != type([]): return [obj]
   else: return obj

def merge( v1, v2 ):
    return listify(v1) + listify(v2)

#so now you can merge two dictionaries:
dict1 = dict(a = 2, b = 5, c = 7 )
dict2 = dict(b = 4, d = 9, f = 10 )
dikt = {}

for k in set( dict1.keys() + dict2.keys() ):
    dikt[k] = merge( dict1.get(k, []), dict2.get(k, []) )
#resutls in:
# {'a': [2], 'c': [7], 'b': [5, 4], 'd': [9], 'f': [10]} 
```

您可能会注意到，`dict.keys()`返回一个键列表， `set`返回一个没有重复项的列表，因此`set( d1.keys(), d2.keys() )`返回 d1 和 d2 的键的并集

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T20:30:38.403

[@SilentGhost 答案](https://stackoverflow.com/questions/631463/dictionaries-in-python/631549#631549)的变体（所有其他答案都会产生错误的字典）：

```
>>> d1 = dict(key1=1, key2=2)
>>> d2 = dict(key1=1, key2='A', key4=4)
>>> d = dict(d1)
>>> for k, v2 in d2.iteritems():
...     v = d.get(k, None)
...     d[k] = [v, v2] if v is not None and v != v2 else v2
...
>>> d
{'key2': [2, 'A'], 'key1': 1, 'key4': 4} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-11T01:40:11.453

也许这样做有点尴尬，因为您尝试创建的数据结构并不像它应该的那样自然。例如，不要让一些值是单独的值，而有些是列表，为什么不将所有内容都保存在列表中呢？例如

```
{'key1': [1], 'key2': [2, 'A'], 'key4': [4]} 
```

在 Python 中可以有一个混合数据类型的集合，但是如果你保持它的连贯性，你的代码通常会更干净。如果你使用这种数据结构，插入就像

```
# Inserting a (key, value) pair
if key in my_dict:
    my_dict[key].append(value)
else:
    my_dict[key] = [value] 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-02-23T15:27:56.383

这是另一个变体。

```
d1 = {'key1'=1, 'key2'=2}
d2 = {'key1'=1, 'key2'='A', 'key4'=4)
d = d2
for k, v in d.iteritems():
... if k in d1.keys() and v!=d1[k]:
... d[k] = [d1[k], v2]
d
{'key2': [2, 'A'], 'key1': 1, 'key4': 4} 
```

# java - 在 Java 中解压缩 Gzip 存档

> ID：631484
> 
> 赞同：5
> 
> 时间：2009-03-10T17:41:25.613
> 
> 标签：java, gzip, archive

我正在尝试用 Java 解压缩大约 8000 个 gzip 格式的文件。我的第一次尝试是使用 GZIPInputStream 但性能很糟糕。

任何人都知道解压缩 gzip 档案的任何替代方法吗？我尝试了 ZipInputStream，但它无法识别 gzip 格式。

先感谢您。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T17:47:37.157

您需要使用缓冲。写入小块数据将是低效的。压缩实现在 Sun JDK 中的本机代码中。即使不是缓冲性能，通常也应该超过合理的文件或网络 I/O。

```
OutputStream out = new BufferedOutputStream(new GZIPOutputStream(rawOut));

InputStream in = new BufferedInputStream(new GZIPInputStream(rawIn)); 
```

由于本机代码用于实现解压缩/压缩算法，因此在使用后关闭流（而不仅仅是底层流）要非常小心。我发现有大量的“Deflaters”对性能**非常**不利。

`ZipInputStream`处理文件的存档，这与压缩流完全不同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T17:50:31.877

当你说它`GZipInputStream`的表现很糟糕时，你能更具体一点吗？您是否发现它是 CPU 瓶颈还是 I/O 瓶颈？您是否在输入和输出上都使用缓冲？如果您可以发布您正在使用的代码，那将非常有帮助。

如果您在多核机器上，您可以尝试仍然使用`GZipInputStream`但使用多个线程，每个核心一个，还有一个共享的文件队列仍有待处理。（任何一个文件都只能由一个线程处理。）如果您受 I/O 限制，这*可能会使事情变得更糟，但它可能值得一试。*

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-03-10T17:45:53.620

对于这种规模，假设您的平台要求有限，您可能希望采用原生方式。您可以使用 JNI 调用库或使用`ProcessBuilder`.

# css - 切换可见性时如何防止 GWT Flash/ActionScript 组件重新加载？

> ID：631486
> 
> 赞同：2
> 
> 时间：2009-03-10T17:42:02.520
> 
> 标签：css, apache-flex, flash, actionscript, gwt

我有一个使用我创建的 Flash/PaperVision3D 组件的 Google Web Toolkit (GWT) 应用程序。GWT 应用程序将 Flash 组件的实例放置在选项卡面板中的不同选项卡上。在应用程序执行期间，一切正常，直到用户开始在选项卡之间单击。在 GWT 级别，JavaScript 正在更改 style.display 属性以隐藏和显示“选项卡”的内容。似乎 Flash 组件（通过编写“嵌入”标签脚本包含在页面中）每次可见时都会重新加载/重新启动。

如何防止它重新启动/重新加载？对于 DIV 标记被设置为 style.display = 'none' 这一事实，我没有太多控制权，因为它是由自动生成的 GWT 代码控制的。Flex/Flash 开发中是否有一些设置允许它这样做？或者也许在嵌入标签中？甚至在 JavaScript 级别？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T02:16:13.493

显然这是一个[Firefox 错误](https://bugzilla.mozilla.org/show_bug.cgi?id=90268)。在 Internet Explorer 中似乎没有问题。

一种可能的解决方案是，已经将 Flash 元素隐藏并绝对定位（“位置：绝对；可见性：隐藏；”），然后通过在用户单击选项卡时调用的 JavaScript 函数将它们变为可见性。

根据 Flash 文件的复杂性，您还可以使用[ExternalInterface](http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002200.html)对象，它允许 JavaScript 函数和 ActionScript 之间的通信。您可以保存电影的当前状态，然后在用户单击选项卡时将此状态信息转储回。

抱歉，我无法提供更多帮助。

# asp.net - 我应该创建几个小型应用程序数据库还是一个大型应用程序数据库？

> ID：631488
> 
> 赞同：2
> 
> 时间：2009-03-10T17:42:57.137
> 
> 标签：asp.net, sql-server, migration

我们正在为客户将几个旧的大型机应用程序迁移到更新的 ASP.NET + SQL Server 2005 应用程序。每个应用程序通常被认为是独立的，它们之间没有共享数据，并且执行诸如管理专门的库存需求或休假政策之类的事情。数据很小，不应超过单个 SQL Server。是为所有这些应用程序创建一个大型数据库以共享，还是为每个应用程序创建多个较小的数据库更好？

一般来说，我们更喜欢每个应用程序一个小型数据库，但可以提出一个案例，即更大的数据库更容易管理备份和安全性。做出此决定时应考虑哪些因素？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T17:46:09.830

您应该使用单独的数据库。它们都可以从同一个 SQL Server 实例运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:46:34.400

我强烈推荐每个应用程序的小型数据库方法。如果一个应用程序崩溃并损坏了它的表，您不希望不得不拼凑并只对某些表进行选择性恢复。能够删除和加载对于维护和您将来必须进行的任何不可预见的更新要好得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T17:46:47.800

这取决于这些应用程序是否应该共享数据。如果是这样，那么最好在它们后面有一个数据库。如果不是，那么最好将它们分开，以便将来您可以更自由地移动（隔离）应用程序。

想想你的应用程序将如何被使用。因为当您有一个数据库，例如一张客户表时，当您有多个应用程序访问同一个表时，您可能会遇到锁定问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T17:47:32.430

如果数据存储在应用程序之间没有任何重叠，我将使用每个应用程序一个数据库的方法。这样，如果其中一个超出当前数据库服务器的容量，您可以相对轻松地将其移到自己的服务器上。

此外，从备份/恢复的角度来看，恢复单个应用程序的数据库以使其启动和运行可能更容易，而不是必须恢复整个集合（因为它们位于单个数据库中）然后再恢复您实际需要恢复服务的位。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T17:47:46.017

我建议您创建一个包含多个目录的数据库解决方案。每个目录都是独立的，并且被理解为一个单独的数据库，尽管在同一个解决方案下为您提供了您之前提到的好处，例如备份和管理。之后，每个目录都将包含自己的数据表等。目录之间不会像表到表那样将数据关联起来。

# grails - 带有以“/”结尾的 URL 模式的 Grails UrlMappings

> ID：631490
> 
> 赞同：4
> 
> 时间：2009-03-10T17:43:27.277
> 
> 标签：grails, url-rewriting, url-mapping

我的 Grails UrlMappings 类中有以下 UrlMapping：

```
 "/$something/" {
      controller = "controllerName"
      action = "actionName"
      constraints {
      }
  } 
```

对“/foobar/”和“/foobar”的请求都被路由到正确的控制器和动作。

但是，使用 g:link 创建的 URL:s 并不像预期的那样以斜杠 ("/") 结尾。

普惠制代码...

```
<g:link controller="controllerName" action="actionName" params="[something: 'foobar']">...</g:link> 
```

... 生成 HTML 输出 ...

```
<a href="/foobar">...</a> 
```

如何让 Grails 生成 URL 模式指定的链接？这包括结尾的斜线。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T17:17:22.233

不幸的是，这对于 Grails 的默认 URL 映射是不可能的。斜线以特殊方式处理。这种行为在 Grails 核心中是硬编码的。不过可以使用插件覆盖它。

作为一种解决方法（可能不适用），我可以提供以这种方式使用它：

```
<g:link uri="/foobar/">Foo Link</g:link> 
```

这应该产生一个带有斜杠的链接。

# asp.net - 没有 VS 2008 的 LINQ to SQL

> ID：631499
> 
> 赞同：1
> 
> 时间：2009-03-10T17:45:54.837
> 
> 标签：asp.net, linq-to-sql

在回答我之前的一个问题时，有人鼓励我查看 LINQ to SQL。我喜欢我所看到的，但我很难接受它。我为每个数据库表编写了必要的类，但我不确定应该将代码放在哪里。我一直在 Internet 上搜索教程，但它们似乎都假设使用 Visual Studio 2008 来生成文件。我们公司没有 Visual Studio 2008，现在不是购买它的合适时机，特别是因为该应用程序使用常规 ADO.NET 连接和命令对象可以正常工作。

有人可以解释如何让 LINQ to SQL 手动启动和运行，或者指向一个解释它的教程吗？我在 VB.NET 中编码

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T17:52:42.900

您可以从命令行使用 SQLMetal，而不是使用 IDE。或者您甚至可以使用[此 UI](http://www.softpedia.com/get/Internet/Servers/Database-Utils/SqlMetal-Builder.shtml)来运行 SQLMetal。

您还可以使用[Visual Studio Express](http://www.microsoft.com/Express/)。与其他 VS 版本相比，该功能集有点有限，但它仍然是一个非常好的产品，并且包括对 Linq2SQL 的支持。在这种情况下，让 Linq2SQL 启动并运行归结为创建一个新的 dbml 文件并将一些数据库表拖入其中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T17:55:55.610

我不建议尝试在没有 Visual Studio 2008 的情况下使用 LINQ。如果没有额外的 C# 3 语言功能（VS2005 不支持），您将很难过。

但是，为什么不安装 VS2008 的[Visual Basic Express版本，这样您](http://www.microsoft.com/express/vb/)*现在*就可以了解 LINQ并准备好在公司其他人愿意购买完整版时使用它呢？VS2005 和 VS2008 幸福地生活在一起。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:54:50.353

您还可以使用[PLINQO](http://code.google.com/p/codesmith/wiki/PLINQO)生成 DBML 文件。它需要[CodeSmith](http://www.codesmithtools.com/)（标准或专业）。这实际上正是我用于 DAL 的。只是一个需要考虑的想法。

# vb.net - dll返回未正确终止的字符串时该怎么办

> ID：631505
> 
> 赞同：1
> 
> 时间：2009-03-10T17:47:12.713
> 
> 标签：vb.net, dll, string

我有一个第三方 dll，它有一个返回字符串的函数。当我调用该函数时，我得到了例如“123456”。至少它看起来像那样，但是当我做 mystring.length 它不返回任何长度。如果我设置标签的文本属性，它会显示“123456”。

当我有从 dll 获得的字符串时，我将它发送到 web 服务函数：

```
rem call dll and get string
dim mystring as string=mydll.getstring()

rem Send it to the webservice
webservice.SaveString(mystring) 
```

当我发送从 dll 获得的字符串时，web 服务会因 webexeption（“protocoll 错误”）而崩溃。如果我改为这样发送：

```
rem call dll and get string
dim mystring as string=mydll.getstring()

rem Send it to the webservice
dim FixedString as string = mid(mystring,1,6)
webservice.SaveString(mystring) 
```

然后它工作，一切都很好。这让我认为我从 DLL 获得的字符串在某种程度上没有正确终止。而且我不知道如何从 vb.net 修复它（我无法更改 DLL），而且我事先不知道字符串会有多长时间。

该 dll 仅在连接特定硬件时才在现场工作，因此我不能坐在办公室尝试在开发环境中解决此问题。所以在我再次去找客户之前，我想有一些可能的解决方案。

**编辑1：** 我试图做一个从1循环到100的循环（因为我不知道真正的长度）并试图将所有<>“”的字符复制到一个新变量中，但它没有用。我没有尝试其他变体，因为一天结束了，我不得不离开客户站点。

**编辑 2：**
我与之交谈的 DLL 是用 VB6 制作的。该 DLL 正在与其他用 C++ 制作的 DLL（我认为）进行通信。

我的程序 <-> vb6-DLL <-> c++-DLL <-> 硬件

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:57:20.643

查看有关字符串的[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.string.aspx#)，尤其是有关以下内容的部分：

> 在 .NET Framework 中，String 对象可以包含嵌入的空值，这些空值算作字符串长度的一部分。但是，在某些语言（例如 C 和 C++）中，空字符表示字符串的结尾，不被视为字符串的一部分，也不计入字符串长度的一部分。这意味着 C 和 C++ 程序员或用 C 或 C++ 编写的库可能对字符串做出的以下常见假设在应用于 String 对象时不一定有效：
> 
> strlen 或 wcslen 函数返回的值不一定等于 String.Length。
> 
> strcpy_s 或 wcscpy_s 函数创建的字符串不一定与 String.Copy 方法创建的字符串相同。
> 
> 您应该确保实例化 String 对象的本机 C 和 C++ 代码以及通过平台调用传递 String 对象的代码不假定嵌入的 null 标记了字符串的结尾。

相反，我会做类似的事情：

```
rem call dll and get string
dim mystring as string=string.intern(mydll.getstring()) 
```

（注：这个我没试过）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T17:49:30.553

一种可能性是将其转换为字节数组并获取数组的大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:55:06.797

顺便说一句，字符串在 .NET 中不是以空值结尾的。

我同意上面的答案，即尝试转换为字节并查看字节。

如果第三方不能返回一个有效的字符串，那么你也不能依赖它来避免你的程序崩溃。这是托管 DLL，还是非托管代码？您的程序是多线程的吗？如果是，这个第三方非托管 DLL 是否在多线程环境中工作？它可能没有，在这种情况下，您必须序列化对该 DLL 的所有访问。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T13:30:19.717

VB6 中的字符串是 BSTR（请参阅此处[或](http://www.velocityreviews.com/forums/t287906-data-type-vc-ltgt-vb6.html)Google[了解更多信息](http://www.google.ru/search?hl=ru&q=VB6+BSTR&lr=&aq=f&oq=)）。

BSTR 可能不是以空值结尾的，但它们都以一个整数开头，表示它们的长度。所以你有一个指向一个内存块的指针，它包含一个整数和一个 Unicode 字符数组，这个指针指向一个字符串，但是还有一个 4 字节的整数存储一个整数。您不应该自己访问长度，而应该调用 SysStringLen()（Win32 函数）来获取此类字符串的长度。

# c++ - C++ 中的前后递增/递减运算符在循环中是否具有相同的性能？

> ID：631506
> 
> 赞同：1
> 
> 时间：2009-03-10T17:47:21.120
> 
> 标签：c++, for-loop

考虑以下两个示例。

```
class ClassOne
{
 //class definition is here
};

std::vector< ClassOne > myListOfObjects;

std::vector< ClassOne >::const_iterator iter = myListOfObjects.begin();

Example 1: 
for( ; iter < myListOfObjects.end(); **++iter**)
{
   //some operations
}

OR

Example 2: 
for( ; iter < myListOfObjects.end(); **iter++**)
{
   //some operations
} 
```

哪个更快？++iter 或 iter++ 在循环的上下文中。

### 关闭原因：

复制自布赖恩的帖子（使问题更简洁）。

您也可以尝试以下类似问题之一：[here](https://stackoverflow.com/questions/561588/)或[here](https://stackoverflow.com/questions/24901/)或[here](https://stackoverflow.com/questions/53455/)或[here](https://stackoverflow.com/questions/484462/)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T17:50:52.453

不，它们没有相同的性能：

*   Postincrement 将创建一个副本然后递增，然后返回该副本
*   Preincrement 将递增然后返回原始值

所以（除非你正在处理像整数这样的简单事情）预增量更快。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T17:52:13.200

如[this answer](https://stackoverflow.com/questions/561588/what-is-more-efficient-i-or-i/561609#561609)中所述， pre 更快。只有在处理原语（int、char 等）时它们才相同。在这种情况下，他们正在调用重载运算符。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T17:55:55.577

这取决于。在幼稚的编译器中，预增量会更快。在伪代码中，他们每个人的作用如下：

```
preincrement() {
  val = val + 1;
  return val;
}

postincrement() {
 tmp = val; // take a temporary copy of the old value
 val = val + 1;
 return tmp;
} 
```

在实践中，编译器*通常*会在可以摆脱的情况下将后增量转换为前增量。但对于复杂类型，它可能无法做到这一点。作为一般规则，尽可能使用前增量，并且仅在需要该操作的特定语义时才使用后增量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T17:49:32.723

处理非原始类型时：**++iter 总是更有效。**

++iter 更高效的原因归结为每个人需要做的工作才能获得它们的返回值。返回值是否被实际使用并不重要。

区别：

*   ++iter 返回**对自身的引用**，因此不需要临时副本。（递增，返回对自身值的引用）

*   iter++ 返回变量的临时副本（使用旧值创建临时变量，增量，返回临时变量）

    ```
    _Myt _Tmp = *this;
    ++*this;
    return (_Tmp); 
    ```

* * *

您也可以尝试以下类似问题之一：[here](https://stackoverflow.com/questions/561588/)或[here](https://stackoverflow.com/questions/24901/)或[here](https://stackoverflow.com/questions/53455/)或[here](https://stackoverflow.com/questions/484462/)。尽管它们不适用于迭代器，但它们并不完全相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T17:49:18.870

我几乎肯定它们在机器代码中简化为相同的东西，只是顺序不同。我会说它们是相同的，但我建议您编写一个快速测试应用程序来检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T17:51:34.917

一般来说，预增量更好，前提是您没有对后增量的特定需求。

但是，这是编译器特定的事情。大多数现代编译器将为前缀表示法创建更少的操作。但是，对于类方法重载，这并不总是得到优化，因为它取决于类的实现方式。

# c - 非空终止字符字符串上的strlen（）？

> ID：631516
> 
> 赞同：27
> 
> 时间：2009-03-10T17:49:43.737
> 
> 标签：c

`strlen(const char *s)`定义 when不是`s`null 终止的，如果是，它返回什么？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-10T17:51:10.113

不，它没有定义。它可能会导致内存访问冲突，因为它会一直计数，直到它到达值为 0 的第一个内存字节。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-10T17:51:25.900

来自 C99 标准：

> **strlen**函数返回终止空字符之前的字符数。

如果没有空字符，则表示结果未定义。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-12T09:43:15.947

可能是你需要[strnlen](http://refspecs.freestandards.org/LSB_3.0.0/LSB-Core-generic/LSB-Core-generic/baselib-strnlen-3.html)吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T17:53:04.447

不是真的，它会导致[不好的事情](https://buildsecurityin.us-cert.gov/daisy/bsi-rules/home/g1/852-BSI.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T20:37:37.640

如果您的字符串不是 NUL 终止的，则该函数将继续查找，直到找到一个。

如果幸运的话，这将导致您的程序崩溃。

如果你不走运，你会得到比预期更大的长度，其中包含很多“意外”值。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T17:51:13.780

它没有定义。它会导致未定义的行为，这意味着任何事情都可能发生，您的程序很可能会崩溃。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T17:51:12.203

它将返回在找到 '\0' 之前遇到的字符数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T17:55:05.033

strlen() 仅适用于以空字符结尾的字符串（做一些有用的事情）；如果您传入除此之外的任何内容，您将得到一个完全未定义的结果。如果你很幸运，它不会导致崩溃:)

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2017-08-04T13:07:51.277

男人 3 strcspn

> size_t strcspn(const char *s, const char *reject);

冒号分隔的字符串长度：

```
size_t len = strcspn(str, ":"); 
```

逗号分隔字符串的长度：

```
size_t len = strcspn(str, ","); 
```

制表符分隔字符串的长度：

```
size_t len = strcspn(str, "\t"); 
```

# oracle - 我的 oracle 侦听器自行关闭，会发生什么？

> ID：631518
> 
> 赞同：0
> 
> 时间：2009-03-10T17:50:26.497
> 
> 标签：oracle, installation, tnsnames, ora-12560, ora-12514

我正在设置一个虚拟机来尝试复制我们的生产环境，以便进行部署测试。VM 是运行**Windows Server 2003**和**Oracle 10g的****VMWare 服务器**。我通过 tnsnames 连接标识符连接到 oracle。

 ****我启动并运行了一次，复制了 VM 文件，并认为一切都很好。但是现在我在尝试让 oracle 在我制作的备份上运行时遇到了一些问题。话虽如此，我完全有可能对这个或我没有注意到或忘记的工作 VM 进行了一些更改，因此我认为这不一定是虚拟化问题。

我不是预言家，而且我们没有太多的 dba，所以我有点在这条小溪上。这是我的问题：

*   当我启动机器时，我可以执行 lsnrctl services 并看到包含我的应用程序数据库的服务有 1 个实例正在运行。当我尝试通过 sqlplus 连接时，我得到 ORA-01033：Oracle 初始化或关机正在进行中
*   如果我等待一段时间，我看到服务从 lsnrctl 服务列表中消失，显然我无法连接 sqlplus (ORA-12514)
*   如果我转到 Windows 服务管理 mmc 控制台，我可以看到应该容纳该 oracle 实例的 Windows 服务确实仍在运行。
*   我可以重新启动windows服务。此时我可以再次在 lsnrctl 服务下看到它，但再次尝试通过 sqlplus 连接到它会导致 ORA-01033。一段时间后，它关闭并消失。
*   在任何时候尝试 sqlplus "/ as sysdba" 都会导致 ORA-12560: TNS:protocol adapter error
*   没有任何用处被写入 Windows 事件日志

关于什么可能导致这种情况的任何想法？关于下一步我可以尝试什么的任何提示？

**更新：** 本着 stackoverflow 的精神，让我们保持打开状态，以防有人后来寻求建议，但在我的情况下，完全卸载/安装 oracle 并重新导入数据库是最方便的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T18:15:16.123

创建控制文件后是否运行了“alter database open”？

请参阅[http://www.dba-oracle.com/t_ora_01033_initialization_shutdown_progress.htm](http://www.dba-oracle.com/t_ora_01033_initialization_shutdown_progress.htm)

或者你有一个损坏的文件？

见[http://basmv.blogspot.com/2007/10/oracle-ora-01033-error.html](http://basmv.blogspot.com/2007/10/oracle-ora-01033-error.html)

人们似乎已经解决了许多与您类似的问题。只需谷歌“ORA-01033”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T18:41:20.430

在虚拟机（在我的情况下为虚拟 PC）下的 Windows Server 2003 R2 中运行 Oracle 10g（我认为是 10.2）时，我也遇到了奇怪的问题。无论出于何种原因，在我打开本地 Oracle 管理工具之一之前，Oracle 永远不会完成启动数据库。我相信它是数据库配置助手。

如果我为现有数据库选择配置选项，数据库将成功启动。从那时起，我会告诉我的虚拟机保存并退出，而不是关闭映像。

我从一开始就没有弄清楚是什么导致了这个问题......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T16:18:47.237

Windows 上的 Oracle 有点奇怪。

不仅 oracle_home 需要正确设置/选择，oracle 的版本需要相同，并且窗口注册表中的 oracle 条目是有效的。如果它们不正确，您将无法使用 sqlplus "/ as sysdba" 连接到数据库。

除此之外，转到保存数据库的 alert.log 的位置。查看警报日志文件，查看数据库是否在启动过程中的位置，以及它是否已完全启动。如果它没有完全打开，那么它需要打开。

由于您无法以 sysdba 身份登录数据库，这将是一个挑战。解决 sysdba 登录问题，以便您可以在本地以 sysdba 身份登录实例，然后您可以解决使数据库联机的问题。最好的办法是在新 vm 上安装与原始服务器上完全相同的 oracle 版本，在 vm 上创建与 prod 服务器上相同的 oracle 服务，干净地关闭 prod 服务器，从 prod 复制所有数据库文件服务器到您的 vm 到它们存在的确切位置，不要忘记 spfile。在他们各自的机器上启动服务，看看它是否有效。Prod 不应该受到影响，因此它应该重新启动正常。在 vm 上查看警报日志以查找错误并更正它们。

如果一切都失败了，请使用 Rman 将您的产品复制到 vm，这应该可以。

# asp.net - ASP.NET recaptcha 和 JQuery 的问题

> ID：631536
> 
> 赞同：-1
> 
> 时间：2009-03-10T17:52:46.007
> 
> 标签：asp.net, jquery, recaptcha

我想在 JQuery 对话框上有一个 Recaptcha。虽然线

```
$("#newsletterDialog").dialog({ 
    autoOpen: true, 
    modal: false, 
    resizable: false, 
    draggable: false, 
    width: 400 
}) 
```

会破坏jquery，所以

```
validator.Challenge = Context.Request.Form[RECAPTCHA_CHALLENGE_FIELD]; 
```

失败（即某些隐藏字段敌人的操作错误）。此外 Firefox 挂起，所以我无法按照我习惯的方式进行调试（我认为这不仅仅是因为那条线）。

有什么线索吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-11T09:32:01.240

似乎特定的 Firefox 问题是通过没有解决的

```
$("#newsletterDialog").dialog inside    $(document).ready(function()) 
```

（即立即执行而不是在以后的事件中执行）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T21:40:42.800

我认为最好的解决方案是在对话框 DIV 中使用验证码的 iframe。但是，它使一些编程变得更加困难（必须转到父文档）。

# vb.net - Microsoft Visual Basic 构建的默认文件夹是什么？

> ID：631541
> 
> 赞同：3
> 
> 时间：2009-03-10T17:53:35.940
> 
> 标签：vb.net, visual-studio, visual-studio-2008

我对 Microsoft Visual Basic 2008 和编程语言本身完全陌生。我的问题是我正在关注如何制作浏览器的教程。浏览器在调试模式下工作，我点击顶部构建下的构建。在底部它说构建成功，但我不知道程序实际保存到哪里。我有 Windows XP SP3。有人请帮忙。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T17:56:26.277

输出窗口的最后一行应该为您提供构建文件的位置。例如，当我强制构建时，一个简单的控制台应用程序构建具有以下行

```
ConsoleApplication1 -> C:\Users\jaredpar\Documents\Visual Studio 2008\Projects\ConsoleApplication25\ConsoleApplication1\bin\Debug\ConsoleApplication1.exe 
```

如果这不能为您提供所需的信息，请尝试以下操作

1.  打开解决方案探索（查看 -> 解决方案资源管理器）
2.  在解决方案资源管理器中选择项目
3.  按 F4

这将打开属性窗口。其中一项将是“项目文件夹”。转到那里列出的文件夹。将有一个名为“Bin”的子目录，在该“Debug”下。您的二进制文件将位于该文件夹中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T17:59:46.537

可以通过进入项目属性来更改输出文件夹，但默认情况下它们是项目根目录下的 /bin/Debug/ 和 /bin/Release/（包含 .csproj 或 .vbproj 文件）。Debug 和 Release 文件夹对应于活动构建配置，例如，如果当前构建配置为 Release，则输出文件将复制到 /bin/Release。有关构建配置的更多信息，请参阅[此内容。](http://msdn.microsoft.com/en-us/library/kkz9kefa.aspx)另外，请注意在 /bin 的同一父目录中有一个 /obj 目录 - 它存储在构建过程中使用的临时文件（例如，它包含您编译的 EXE/DLL 没有任何依赖项）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:34:30.407

如上所述，Noldrin 说，默认目录是项目文件夹下的 bin 目录，但也可以通过在 vs 资源管理器中右键单击项目，选择属性，然后当项目属性面板出现时，在编译下你应该有bin/release 默认为项目保存目录下的 bin 目录，您可以将其更改为 c:\bin 并且输出将存储在根目录下的 bin 目录中。如果您正在处理，这是一个坏主意多个项目（默认情况下要好得多）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T20:37:49.353

最短的路线，如果您只是想构建和运行，而不仅仅是构建......是按 F5

但正如其他人所说，它在 bin/Debug 或 Bin/release 中，具体取决于您的构建模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T17:56:35.950

在 VS 解决方案资源管理器中右键单击您的项目名称。在 Windows 资源管理器中单击打开文件夹。从那里打开 bin\debug 文件夹。

# asp.net - 跨子域的 Asp.Net 配置文件

> ID：631542
> 
> 赞同：3
> 
> 时间：2009-03-10T17:54:02.803
> 
> 标签：asp.net, subdomain

有什么方法可以跨另一个子域访问一个子域中设置的个人资料信息？还是个人资料信息应用程序特定？

我正在一个子域中设置配置文件值，并希望在另一个子域中访问该配置文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T22:13:38.017

如果您的应用程序向配置文件提供者指定了相同的 applicationName 值，那么只要它们同意用户的身份，它们就应该访问相同的配置文件信息。

如果您使用表单身份验证，那么您可以确保身份验证 cookie 对所有应用程序可见

```
<forms domain="parentdomain.com" ... /> 
```

您的应用程序还需要共享一个 machineKey，以确保它们可以解密其他人创建的 cookie。

如果您使用匿名身份识别，那么您也可以与

```
<anonymousIdentification domain="parentdomain.com" ... /> 
```

# c# - 缓存 ASP.NET AJAX 服务 javascript 代理

> ID：631543
> 
> 赞同：2
> 
> 时间：2009-03-10T17:54:43.943
> 
> 标签：c#, wcf, .net-3.5, caching, asp.net-ajax

我们有许多小而有用的 WCF 服务，它们使用 WebScriptServiceHostFactory 类托管并通过 ASP.NET AJAX 使用。我们注意到，在我们的生产环境中，客户端没有缓存 javascript 代理。无论如何允许这些文件被缓存？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T21:27:28.860

您是否尝试将缓存数据添加到 http 标头？

```
// Add HttpCaching data to the http headers

if (!IsJavascriptDebug && (
    AssemblyModifiedDate.ToUniversalTime() < DateTime.UtcNow))
{
    HttpCachePolicy cache = context.Response.Cache;
    cache.SetCacheability(HttpCacheability.Public);
    cache.SetLastModified(AssemblyModifiedDate);
} 
```

不是我的代码，取自 codeproject。[链接文本](http://www.codeproject.com/KB/cpp/WebserviceAndJavaProxy.aspx)

# java - 我应该为我的注释创建一个常量类吗？

> ID：631550
> 
> 赞同：3
> 
> 时间：2009-03-10T17:55:11.897
> 
> 标签：java, annotations, constants

哪个更好？

1.  `@SuppressWarnings("unchecked")`
2.  `@SuppressWarnings(AnnotationConstants.UNCHECKED)`

`AnnotationConstants`典型的常量类在哪里...

```
public final class AnnotationConstants {
    private AnnotationConstants() { }

    public static final String UNCHECKED = "unchecked";

    ...
} 
```

我知道有很多支持和反对常量类的一般论点——而这正是我**不**感兴趣的。我想知道**专门**用于注释的常量类是个好主意还是坏主意。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T17:57:36.213

对于这个*具体*的例子，我会坚持使用文字。毕竟，你是在试图抑制警告——如果你使用了错误的文字，警告将不会被抑制，这会引起你对问题的注意。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T18:08:10.167

请我说两句。

在 Spring 中，您可以说 @Scope(Scopes.SESSION) 或 @Scope(Scopes.REQUEST) 之类的东西，它会将特定类型的行为附加到注解中，因此我会说*始终*使用常量类，这有利于可追溯性.

如果您只是抑制警告，那么您几乎不可能真正追踪到这一点，所以只需使用文字即可。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:58:04.863

我同意 Holsam 的 SuppressWarnings - 使用字符串

如果您正在编写自己的注释，我建议在可能的情况下使用枚举来表示可以表示为一组常量的事物

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T17:56:24.157

对于`@SuppressWarning`和喜欢，我不这么认为。我更喜欢直接编写常量，并尽可能让编译器检查它们。Eclipse 在这方面做得很好。

# c# - 使用互操作将对象数组从 VB6 返回到 C#

> ID：631559
> 
> 赞同：4
> 
> 时间：2009-03-10T17:57:25.027
> 
> 标签：c#, vb6, interop

我需要使用互操作将一组初始化对象从 VB6 返回到 C#。我的 VB 函数看起来像

```
Public Function CreateMyObjArray(ByVal MaxCount As Integer) As MyObj()

  Dim i As Integer
  Dim temparray() As MyObj
  ReDim temparray(MaxCount) As MyObj

  For i = 0 To MaxCount
      Set temparray(i) = New MyObj
  Next i

  CreateMyObjArray = temparray

End Function 
```

现在，当我在传递数组后从 C# 调用它时

```
Array InData = m_MyObjGenerator.CreateMyOjbArray(5); 
```

我收到消息所在的 system.argumentexceptionerror

"引发了 'System.ArgumentException' 类型的异常。\r\n参数名称: typeName@0"

如果我的函数没有参数，我也会收到此错误。该函数在 VB 中以表单形式工作。同样，以下函数返回一个 MyObj 就好了

```
Public Function CreateMyObj() As MyObj
 Set CreateMyObj = New MyObj
End Function 
```

我知道我可以在 C# 版本中列出新的 MyObj，然后 .ToArray() 它，但我真的很想让它工作。谢谢。

**解决方案** 找到了如何做到这一点。我必须使用没有 /sysarray 标志的 tlbimp.exe（VS 必须在内部使用）。在那之后，我能够让一切正常工作。谢谢你们的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T18:15:46.340

很抱歉，我无法尝试一些代码来真正帮助您解决这个问题。

话虽如此，设置`InData`为`Object`.

```
Object InData = m_MyObjGenerator.CreateMyOjbArray(5); 
```

该语句执行后，使用监视窗口确定`InData`. 修改代码（将`InData`from`Object`的类型更改为您使用监视窗口发现的类型）。

希望有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:20:23.443

首先让我们清理一下VB：

```
Public Function CreateMyObjArray(ByVal MaxCount As Integer) As MyObj()     
  ''// MaxCount = 5 would allocate 6 array items with your old code
  ''// Also: do this in one line rather than with an expensive "ReDim"
  Dim temparray(MaxCount-1) As MyObj 

  Dim i As Integer
  For i = 0 To MaxCount -1 
      Set temparray(i) = New MyObj
  Next i

  CreateMyObjArray = temparray
End Function 
```

最后，您的 C# 应该如下所示：

```
MyObj[] InData = m_MyObjGenerator.CreateMyObjArray(5); 
```

MyObj 是与您的 vb 代码交谈时使用的编组类型。正如另一张海报所建议的那样，您可以将其设置为`Object`并逐步执行，让 Visual Studio 告诉您确切使用的类型。

# visual-studio-2005 - ASP .NET 开发服务器端口

> ID：631563
> 
> 赞同：2
> 
> 时间：2009-03-10T17:58:06.523
> 
> 标签：visual-studio-2005, visual-web-developer

假设在使用 VWD 进行调试时，ASP .NET 开发服务器在端口 4754 上运行。（托盘图标）。

调试页面在[http://localhost:4750](http://localhost:4750)打开，每次我必须在地址栏中输入正确的地址。[http://localhost:4754](http://localhost:4754)

换句话说，[http://localhost](http://localhost)端口始终是 ASP .NET 开发服务器端口减去 4

为什么调试页面没有在与托盘图标中显示的端口相同的端口中打开？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T18:08:11.867

您是否使用 ESET 安全性？

我遇到了这个问题，但我一直无法解决它。[我遇到了这个链接](http://www.wahooga.com/index.php/2008/02/20/visual-studio-development-web-server-automatic-port-numbering-problem/)，也许它会对你有所帮助。如果主要文章没有解决问题，请务必检查该页面上的评论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:29:00.660

默认情况下，Visual Studio 将自动分配端口。我不确定为什么你的页面没有与 cassini 服务器同步，但我可以将 Visual Studio 配置为使用静态端口。转到项目的选项页面并查找`Web`选项卡。应该有一个`Servers`部分带有选项`Use Visual Studio Development Server`，您可以在其中选择`Auto-assign Port`或`Specific`移植。您可以尝试设置一个特定的端口，看看是否能得到更好的结果。（这些说明是使用 VS2005 和 VB 项目作为指南编写的 - ymmv）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:09:56.213

在使用什么端口和打开什么页面方面，网站的项目设置是什么？是否有多个站点可以调用另一个端口来使用？

# java - GWT-DnD（拖放）布局问题

> ID：631576
> 
> 赞同：0
> 
> 时间：2009-03-10T18:02:48.633
> 
> 标签：java, gwt, drag-and-drop

以下是使用此处的拖放库时：

[http://code.google.com/p/gwt-dnd/](http://code.google.com/p/gwt-dnd/)

将绝对面板放置在相对面板中时，似乎禁用了拖动功能。一个简单的例子：

```
 private AbsolutePanel leftPanelTree = new AbsolutePanel();
    private HorizontalPanel drawingAppPanel = new HorizontalPanel();
    private VerticalPanel leftPanel = new VerticalPanel();
    private VerticalPanel rightPanel = new VerticalPanel();
    private Label rightSideFiller = new Label("Right Side");
    private Label leftSideFiller = new Label("Left Side");
    private Image newImage = new Image("images/link.gif");
    private PickupDragController newDragController = 
        new PickupDragController(leftPanelTree, true);

        public DrawingApplication() {
                initWidget(drawingAppPanel);

                newDragController.makeDraggable(newImage);
                leftPanelTree.setWidth("300px");
                leftPanelTree.setHeight("200px");
                leftPanelTree.addStyleName("panelBorderTest");
                leftPanelTree.add(newImage, 1, 1);

                drawingAppPanel.setWidth("100%");
                drawingAppPanel.setHeight("100%");
                drawingAppPanel.setBorderWidth(2);

                drawingAppPanel.add(leftPanel);
                drawingAppPanel.add(rightPanel);

                leftPanel.setBorderWidth(2);
                leftPanel.setHeight("100%");
                leftPanel.setWidth("100%");
                leftPanel.add(leftSideFiller);
                //leftPanel.add(leftPanelTree);

                rightPanel.add(rightSideFiller);
        } 
```

但是，如果我将图像添加到 RootPanel（并相应地更改边界面板）或将绝对面板直接添加到 RootPanel，则拖动功能起作用。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T18:40:02.897

毕竟问题不在我的代码中，调用 RootPanel.get().clear(); 这导致该库基本上无法运行。在此问题下有一个可用的修复程序：

[http://code.google.com/p/gwt-dnd/issues/detail?id=55](http://code.google.com/p/gwt-dnd/issues/detail?id=55)

但它并不容易找到。希望这将在未来的版本中修补，如果有的话。

# c# - LINQ to DataTable 结果过滤

> ID：631579
> 
> 赞同：1
> 
> 时间：2009-03-10T18:03:22.160
> 
> 标签：c#, linq

我试图让这个 LINQ 查询返回完全匹配（如果它们存在）或“startswith”结果（如果不存在）。现在它返回两者。

# 例子

SearchParam = "mundt" 结果 = *Mundt, Mark* | *蒙特，克里斯*| *芒特，洛瑞*

```
public static DataTable SearchPerson(string SearhParam)
    {
        var context = new ConnectDataContext(Properties.Settings.Default.ConnectConnectionString);
        var myQuery = (from person in context.tblPersons
                          where person.LastName.StartsWith(SearhParam) || person.LastName == SearhParam
                          orderby person.LastName
                          select new { person.PersonID, person.LastName, person.FirstName, person.SSN });

        var dataTable = myQuery.CopyLinqToDataTable();

        return dataTable;
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T18:10:02.300

尝试：

```
 var persons = (from person in context.tblPersons
                          orderby person.LastName
                          select new { person.PersonID, person.LastName, person.FirstName, person.SSN });
        var filteredPersonsList = persons.Where(p=>p.LastName == SearhParam).ToList();
        if( filteredPersons.Count == 0 )
             filteredPersonList = persons.Where(p=>p.LastName.StartsWith(SearhParam))
                       .ToList();
        var dataTable = filteredPersonsList.CopyLinqToDataTable();

        return dataTable; 
```

注意：它对 db 进行 2 次点击，一次查找完全匹配，一次查找 startwith（如果没有找到第一个）。

另一种选择是同时获取它们，然后在内存中重新过滤。

# wxwidgets - 弹出菜单单选项目检查

> ID：631580
> 
> 赞同：0
> 
> 时间：2009-03-10T18:04:24.573
> 
> 标签：wxwidgets

我在 Windows 上使用带有 wxTaskBarIcon 的弹出菜单（wxWidgets-2.8.9）。如果我用单选项目填充弹出菜单，单击时它们不会改变状态。弹出菜单列表中的第一项被标记为选中。但是选择任何其他项目不会改变这一点。

目前没有项目点击事件处理程序（应用程序更像是 UI 原型）。我应该手动更新此处理程序中的项目检查状态还是仍然是框架职责？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T18:19:46.393

您应该`EVT_UPDATE_UI(yourCommandID, yourEventHandler)`用于检查/取消检查和启用/禁用菜单项。在您的 UpdateUI 事件处理程序中，您应该指定启用项目的情况例如，您有带有命令 ID_RADIO_1 和 ID_RADIO_2 的单选按钮组，并且应该根据条件检查它们，`bool m_SomeConditionVariable`然后您应该为它们创建 2 个事件处理程序，例如

```
void OnRadio1UpdateUI(wxUpdateUIEvent & event)
{
    event.Checked(m_SomeConditionVariable == true);
}

void OnRadio2UpdateUI(wxUpdateUIEvent & event)
{
    event.Checked(m_SomeConditionVariable == false);
} 
```

在这种情况下，仅当变量为假时才会检查第一个单选项目，而当变量为真时将检查第二个单选项目。

您也可以使用计算条件而不是存储变量，例如

```
void OnRadio2UpdateUI(wxUpdateUIEvent & event)
{
    // Item will be enabled only when text control has non-empty value
    event.Enabled(!m_SomeTextCtrl->GetValue().Trim().IsEmpty());
} 
```

# database - 数据环境

> ID：631584
> 
> 赞同：1
> 
> 时间：2009-03-10T18:05:34.243
> 
> 标签：database, vb6

关于如何将日期参数传递给 VB6 中数据环境的 command1 对象的任何指南？是的，我确实搜索过，但没有遇到任何:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T18:44:00.237

转到您命令的设计器视图。右键单击命令并选择*属性*，然后出现选项卡*参数*。现在您可以定义所有类型的所有参数。选择您要更改的参数，并将*数据类型*选择为“adDate”，将主机数据类型选择为“日期（VT_DATE）”。为此，您应该将查询写入命令的 CommandText 属性。

我使用 ADO OLE 提供程序对此进行了测试。如果您使用另一个提供程序，那么数据类型组合框可能包含不同的值。

# ruby - 如何为 RDoc::usage() 定义没有 === 标题的部分？

> ID：631585
> 
> 赞同：2
> 
> 时间：2009-03-10T18:05:58.877
> 
> 标签：ruby, comments, markup, rdoc, manpage

我喜欢通过 help2man 和 txt2man 使用“--help”输出生成手册页。Ruby 的 RDoc 系统非常方便，但我似乎无法完全按照我想要的方式配置 RDoc::usage。这是一个示例脚本：

```
#!/usr/bin/env ruby
#
# === Name
#
#   foobar - Example command for StackOverflow question
#
# === Synopsis
# 
#   Usage: foobar [--help]
#
# === Options
#
#   --help      This help message

require 'rdoc/usage'

RDoc::usage('name', 'synopsis', 'options') 
```

脚本的输出如下所示：

```
Name
    foobar - Example command for StackOverflow question

Synopsis
    Usage: foobar [--help]

Options
    --help      This help message 
```

但我真的很想为我的使用输出抑制“名称”和“概要”标题，但仍将它们标记为输出到手册页的部分。

使用 ':section:' 标记适用于 RDoc::Rdoc，但不适用于 RDoc::usage。是否有一种明显的方法可以在不打印标题的情况下标记 usage.rb 部分？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T19:50:13.870

查看源代码[`RDoc::usage_no_exit`](http://www.ruby-doc.org/stdlib/libdoc/rdoc/rdoc/classes/RDoc.html#M002195)；你有两种方法可以抓住它的胆量来实现你的愿望：

1.  设置`ENV['RI']`为强制执行不同的格式化选项（包括指定自定义格式化程序类），或
2.  重新定义默认 RI::TextFormatter 的[display_heading](http://www.ruby-doc.org/stdlib/libdoc/rdoc/rdoc/classes/RI/TextFormatter.html#M001907)（和/或其他方法）以（不）显示标题或其他任何内容

    ```
    require 'rdoc/usage'
    require 'rdoc/ri/ri_formatter'

    module RI
      class TextFormatter
        def display_heading
          # nop
        end
      end
    end

    RDoc::usage('name') 
    ```

# sql-server-2005 - SQL Analysis Services - 具有“多”基数的维度属性

> ID：631586
> 
> 赞同：1
> 
> 时间：2009-03-10T18:06:56.767
> 
> 标签：sql-server-2005, service, analysis

我正在使用下表创建一个多维数据集：

**客户** CustomerID、名称

**客户代表** CustomerID, RepID

**代表** RepID，名称

这里重要的是代表和客户之间存在多对多的关系。我希望能够提出“与代表‘A’合作的客户的销售额是多少？”这个问题。在数据源视图中，我设置了两个 customerid 列和两个 repid 列之间的关系。我在维度构建器中设置了 rep 属性，当我尝试构建多维数据集时出现此错误：

**高级关系引擎中的错误。根据数据源视图中的关系，无法访问连接所需的“Rep”表。**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-06T06:03:08.120

您没有显示销售与客户/销售代表的关系，但我猜您在销售事实表中有一个 CustomerID。

您需要将 Customer 和 Rep 设置为 2 个单独的维度。客户维度将直接连接到销售事实。

要加入 Rep 维度，您需要从“Customer Rep”表创建一个度量值组，然后使用“Customer Rep”度量值组在 Rep 和 Sales Fact 之间创建多对多关系。

[这里](http://www.sqlbi.eu/Projects/Manytomanydimensionalmodeling/tabid/80/language/en-US/Default.aspx)有一个关于多对多关系的非常好的白皮书

# .net - 使用 Alpha 通道调整图像大小

> ID：631589
> 
> 赞同：1
> 
> 时间：2009-03-10T18:07:11.680
> 
> 标签：.net, graphics, image-processing, gdi+, image-scaling

我正在编写一些代码来生成图像 - 本质上我有一个很大的源图像并且包括透明区域。

我使用 GDI+ 打开该图像并添加其他对象。

我接下来要做的是将这个新图像保存得更小，所以我使用了 Bitmap 构造函数，它接受一个源 Image 对象以及一个高度和宽度，然后保存它。

我原以为 alpha 通道会像颜色通道一样平滑，但这并没有发生——它确实产生了几个半透明的像素，但总的来说它是非常块状的。是什么赋予了？

```
Using img As New Bitmap("source100x100.png")
 ''// Drawing stuff
 Using simg As New Bitmap(img, 20, 20)
  simg.Save("target20x20.png")
 End Using
End Using 
```

编辑：我认为我想要的是 SuperSampling，就像 Paint.NET 在设置为“最佳质量”时所做的那样

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T18:43:01.580

在新位图上绘制图像，而不是从图像创建新位图。

只需指定大小即可创建一个空位图，然后使用该方法为该位图`Graphics.FromImage`创建一个对象。`Graphics`使用`DrawImage`方法将图像绘制到新位图上。

对象中有`Interpolationmode`和之类`PixelOffsetMode`的`Graphics`属性，您可以使用它们来控制图像的缩放和绘制方式。

# c# - .NET WinForm 在面板内写入会导致滚动跳转

> ID：631591
> 
> 赞同：0
> 
> 时间：2009-03-10T18:07:22.493
> 
> 标签：c#, winforms, .net-3.5

我有一个 FlowPanelControl 和一个自定义用户控件（包含标签和按钮）。我将自定义用户控件的实例添加到面板的控件集合中，它们按预期在彼此下方流动；显示垂直滚动条也很好。

当用户单击添加的用户控件之一中的按钮时，它会启动计时器并将经过的时间写入标签。当存在多个用户控件实例时，会有多个带有标签的按钮；所有这些都可以根据需要启动和停止。把它们想象成一个迷你秒表。

我的问题是写入标签正在更改包含流面板的滚动条位置。如果滚动到底部并且要启动的最后一个用户控件位于列表的第一个位置，则它会将焦点移回顶部。

我曾尝试阻止对按钮的关注，但不认为这是问题所在。

有谁知道这可能是什么原因造成的？任何帮助将不胜感激，谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T14:11:27.667

我通过将标签更改为文本框解决了我的问题。将值写入列表中的某个控件时，滚动不再闪烁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-11T18:11:34.907

您可以使用 TableLayoutPanel" 来避免滚动条改变它的位置。

# batch-file - 在 nant 中调用批处理文件

> ID：631592
> 
> 赞同：6
> 
> 时间：2009-03-10T18:07:24.053
> 
> 标签：batch-file, nant

如何在 nant 脚本中调用批处理文件？？？（也许有一个调用批处理文件的目标）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T17:43:54.063

实际上，这很容易 - 我将尝试说明：

```
 <target name="run-command">
   <exec program="ConsoleTest.exe" basedir="${test.dir}">
     <arg value="-cp" />
   </exec>
 </target> 
```

basedir 是可选的，它指定从何处运行程序。但是，如果您的程序在路径上（如 ping），您可能不必担心它。

也看看[官方文档](http://nant.sourceforge.net/release/latest/help/tasks/exec.html):)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T12:57:12.690

在放入批处理文件之前，您是否考虑过[nantcontrib](http://nantcontrib.sourceforge.net/)中的任务？我需要将一些小的 javascript 文件一起 smoosh 并且打算使用批处理文件，但事实证明 nantcontrib 有一个 concat 任务，例如。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:53:43.440

使用[执行任务](http://nant.sourceforge.net/release/latest/help/tasks/exec.html)。

# java - Spring Controller销毁方法？

> ID：631596
> 
> 赞同：2
> 
> 时间：2009-03-10T18:08:18.980
> 
> 标签：java, spring, servlets, jakarta-ee

Spring 是否`Controller`有任何类型的销毁/清理方法？我在 JavaDocs 中找不到`Controller`和`AbstractController`. 我正在寻找与`javax.servlet.Servlet`' 方法等效的`destroy()`方法。

原因是我在我的 Spring 控制器中启动了一个线程。我希望线程在控制器从服务器中取出时终止（例如当容器关闭时）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T18:14:22.710

只需使用常规的 spring 生命周期方法。因为所有 Spring Controller 都是 Spring bean，所以它们将遵循常规的生命周期。

[http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-lifecycle-disposablebean](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-lifecycle-disposablebean)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T23:58:24.483

我不认为在控制器中启动线程是一个好主意。这不是他们的目的，IMO。

# java - 如何使用 JUnit 测试异步进程

> ID：631598
> 
> 赞同：239
> 
> 时间：2009-03-10T18:09:31.630
> 
> 标签：java, unit-testing, asynchronous, junit

您如何测试使用 JUnit 触发异步进程的方法？

我不知道如何让我的测试等待进程结束（它不完全是一个单元测试，它更像是一个集成测试，因为它涉及多个类而不仅仅是一个）。

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2009-12-02T00:31:32.717

另一种方法是使用[CountDownLatch](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/CountDownLatch.html)类。

```
public class DatabaseTest {

    /**
     * Data limit
     */
    private static final int DATA_LIMIT = 5;

    /**
     * Countdown latch
     */
    private CountDownLatch lock = new CountDownLatch(1);

    /**
     * Received data
     */
    private List<Data> receiveddata;

    @Test
    public void testDataRetrieval() throws Exception {
        Database db = new MockDatabaseImpl();
        db.getData(DATA_LIMIT, new DataCallback() {
            @Override
            public void onSuccess(List<Data> data) {
                receiveddata = data;
                lock.countDown();
            }
        });

        lock.await(2000, TimeUnit.MILLISECONDS);

        assertNotNull(receiveddata);
        assertEquals(DATA_LIMIT, receiveddata.size());
    }
} 
```

**注意**你不能只使用与常规对象**同步**作为锁，因为快速回调可以在调用锁的等待方法之前释放锁。请参阅Joe Walnes 的[这篇博文。](http://joe.truemesh.com/blog/000279.html)

**编辑**由于@jtahlborn 和@Ring 的评论，删除了CountDownLatch 周围的同步块

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2010-07-21T20:40:52.110

您可以尝试使用[Awaitility](https://github.com/awaitility/awaitility)库。它使测试您正在谈论的系统变得容易。

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2014-05-22T14:14:26.167

如果您使用[CompletableFuture](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html)（Java 8 中引入）或[SettableFuture](https://google.github.io/guava/releases/snapshot/api/docs/com/google/common/util/concurrent/SettableFuture.html)（来自[Google Guava](https://code.google.com/p/guava-libraries/)），您可以在测试完成后立即完成，而不是等待预设的时间。您的测试将如下所示：

```
CompletableFuture<String> future = new CompletableFuture<>();
executorService.submit(new Runnable() {         
    @Override
    public void run() {
        future.complete("Hello World!");                
    }
});
assertEquals("Hello World!", future.get()); 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-03-10T18:53:30.620

恕我直言，让单元测试创​​建或等待线程等是不好的做法。您希望这些测试在几秒钟内运行。这就是为什么我想提出一种两步法来测试异步进程。

1.  测试您的异步进程是否正确提交。您可以模拟接受异步请求的对象，并确保提交的作业具有正确的属性等。
2.  测试您的异步回调是否在做正确的事情。在这里，您可以模拟最初提交的作业并假设它已正确初始化并验证您的回调是否正确。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-03-10T18:12:49.950

启动该过程并使用[`Future`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Future.html).

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2014-01-13T19:22:01.820

我发现对测试异步方法非常有用的一种方法是`Executor`在待测对象的构造函数中注入一个实例。在生产中，执行器实例被配置为异步运行，而在测试中它可以被模拟为同步运行。

所以假设我正在尝试测试异步方法`Foo#doAsync(Callback c)`，

```
class Foo {
  private final Executor executor;
  public Foo(Executor executor) {
    this.executor = executor;
  }

  public void doAsync(Callback c) {
    executor.execute(new Runnable() {
      @Override public void run() {
        // Do stuff here
        c.onComplete(data);
      }
    });
  }
} 
```

在生产中，我会`Foo`用一个`Executors.newSingleThreadExecutor()`Executor 实例来构建它，而在测试中我可能会用一个同步执行器来构建它，它执行以下操作 -

```
class SynchronousExecutor implements Executor {
  @Override public void execute(Runnable r) {
    r.run();
  }
} 
```

现在我对异步方法的 JUnit 测试非常干净——

```
@Test public void testDoAsync() {
  Executor executor = new SynchronousExecutor();
  Foo objectToTest = new Foo(executor);

  Callback callback = mock(Callback.class);
  objectToTest.doAsync(callback);

  // Verify that Callback#onComplete was called using Mockito.
  verify(callback).onComplete(any(Data.class));

  // Assert that we got back the data that we expected.
  assertEquals(expectedData, callback.getData());
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2015-07-24T04:42:08.263

测试线程/异步代码本质上没有任何问题，特别是如果线程是您正在测试的代码*的重点*。测试这些东西的一般方法是：

*   阻塞主测试线程
*   从其他线程捕获失败的断言
*   解锁主测试线程
*   重新抛出任何失败

但对于一项测试来说，这是很多样板文件。更好/更简单的方法是只使用[ConcurrentUnit](https://github.com/jhalterman/concurrentunit)：

```
 final Waiter waiter = new Waiter();

  new Thread(() -> {
    doSomeWork();
    waiter.assertTrue(true);
    waiter.resume();
  }).start();

  // Wait for resume() to be called
  waiter.await(1000); 
```

这种`CountdownLatch`方法的好处是它不那么冗长，因为任何线程中发生的断言失败都会正确地报告给主线程，这意味着测试应该失败。将`CountdownLatch`方法与 ConcurrentUnit进行比较的文章[在这里](http://jodah.net/testing-multi-threaded-code)。

我还为那些想要了解更多细节的人写了一篇关于该主题[的博客文章。](http://jodah.net/testing-multi-threaded-code)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-11-14T13:12:45.830

如何调用`SomeObject.wait`和`notifyAll`如[here](http://my.safaribooksonline.com/book/programming/java/0596003870/junit/jextprockbk-chp-4-sect-15)所述或使用**Robotiums** `Solo.waitForCondition(...)`方法或使用[我编写的类](https://github.com/doridori/AndroidUtilDump/blob/master/android/AndroidUtilDump/src/couk/doridori/android/lib/testing/FutureAsyncTester.java)来执行此操作（请参阅评论和测试类以了解如何使用）

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-04-17T02:55:48.987

我找到了一个库[socket.io](https://github.com/socketio/socket.io-client-java)来测试异步逻辑。[使用LinkedBlockingQueue](https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/LinkedBlockingQueue.html)看起来简单而简短。这是[示例](https://github.com/socketio/socket.io-client-java/blob/master/src/test/java/io/socket/client/ServerConnectionTest.java)：

```
 @Test(timeout = TIMEOUT)
public void message() throws URISyntaxException, InterruptedException {
    final BlockingQueue<Object> values = new LinkedBlockingQueue<Object>();

    socket = client();
    socket.on(Socket.EVENT_CONNECT, new Emitter.Listener() {
        @Override
        public void call(Object... objects) {
            socket.send("foo", "bar");
        }
    }).on(Socket.EVENT_MESSAGE, new Emitter.Listener() {
        @Override
        public void call(Object... args) {
            values.offer(args);
        }
    });
    socket.connect();

    assertThat((Object[])values.take(), is(new Object[] {"hello client"}));
    assertThat((Object[])values.take(), is(new Object[] {"foo", "bar"}));
    socket.disconnect();
} 
```

使用 LinkedBlockingQueue 以 API 阻塞直到获得结果，就像同步方式一样。并设置超时以避免假设等待结果的时间过多。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-10-23T13:39:24.337

值得一提的是，Concurrency in Practice 中有一个非常有用的章节`Testing Concurrent Programs`，[它](https://rads.stackoverflow.com/amzn/click/com/B004V9OA84)描述了一些单元测试方法并给出了问题的解决方案。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-10-21T09:45:54.003

JUnit 5 有`Assertions.assertTimeout(Duration, Executable)`/ `assertTimeoutPreemptively()`（请阅读每个 Javadoc 以了解区别）而 Mockito 有`verify(mock, timeout(millisecs).times(x))`.

```
Assertions.assertTimeout(Duration.ofMillis(1000), () -> 
    myReactiveService.doSth().subscribe()
); 
```

和：

```
Mockito.verify(myReactiveService, 
    timeout(1000).times(0)).doSth(); // cannot use never() here 
```

超时在管道中可能是不确定的/脆弱的。所以要小心。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-12-29T01:35:38.233

如果测试结果是异步产生的，这就是我现在使用的。

```
public class TestUtil {

    public static <R> R await(Consumer<CompletableFuture<R>> completer) {
        return await(20, TimeUnit.SECONDS, completer);
    }

    public static <R> R await(int time, TimeUnit unit, Consumer<CompletableFuture<R>> completer) {
        CompletableFuture<R> f = new CompletableFuture<>();
        completer.accept(f);
        try {
            return f.get(time, unit);
        } catch (InterruptedException | TimeoutException e) {
            throw new RuntimeException("Future timed out", e);
        } catch (ExecutionException e) {
            throw new RuntimeException("Future failed", e.getCause());
        }
    }
} 
```

使用静态导入，测试读起来还不错。（注意，在这个例子中我开始一个线程来说明这个想法）

```
 @Test
    public void testAsync() {
        String result = await(f -> {
            new Thread(() -> f.complete("My Result")).start();
        });
        assertEquals("My Result", result);
    } 
```

如果`f.complete`未调用，则测试将在超时后失败。您也可以使用`f.completeExceptionally`提前失败。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-03-03T20:52:52.667

这里有很多答案，但一个简单的答案是创建一个完整的 CompletableFuture 并使用它：

```
CompletableFuture.completedFuture("donzo") 
```

所以在我的测试中：

```
this.exactly(2).of(mockEventHubClientWrapper).sendASync(with(any(LinkedList.class)));
this.will(returnValue(new CompletableFuture<>().completedFuture("donzo"))); 
```

我只是确保无论如何都会调用所有这些东西。如果您使用以下代码，则此技术有效：

```
CompletableFuture.allOf(calls.toArray(new CompletableFuture[0])).join(); 
```

当所有 CompletableFutures 完成时，它将直接穿过它！

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-12-06T07:27:16.790

尽可能避免使用并行线程进行测试（大多数情况下）。这只会使您的测试变得不稳定（有时通过，有时失败）。

只有当您需要调用其他库/系统时，您可能需要等待其他线程，在这种情况下，请始终使用[Awaitility](http://code.google.com/p/awaitility/)库而不是`Thread.sleep()`.

永远不要只调用`get()`或`join()`在你的测试中，否则你的测试可能会永远在你的 CI 服务器上运行，以防未来永远不会完成。`isDone()`在调用`get()`. 对于 CompletionStage，即`.toCompletableFuture().isDone()`.

当您测试这样的非阻塞方法时：

```
public static CompletionStage<String> createGreeting(CompletableFuture<String> future) {
    return future.thenApply(result -> "Hello " + result);
} 
```

那么你不应该只是通过在测试中传递一个完整的 Future 来测试结果，你还应该确保你的方法`doSomething()`不会通过调用`join()`or阻塞`get()`。如果您使用非阻塞框架，这一点尤其重要。

为此，请使用您设置为手动完成的未完成未来进行测试：

```
@Test
public void testDoSomething() throws Exception {
    CompletableFuture<String> innerFuture = new CompletableFuture<>();
    CompletableFuture<String> futureResult = createGreeting(innerFuture).toCompletableFuture();
    assertFalse(futureResult.isDone());

    // this triggers the future to complete
    innerFuture.complete("world");
    assertTrue(futureResult.isDone());

    // futher asserts about fooResult here
    assertEquals(futureResult.get(), "Hello world");
} 
```

这样，如果您添加`future.join()`到 doSomething()，测试将失败。

如果您的 Service 使用 ExecutorService，例如 in `thenApplyAsync(..., executorService)`，那么在您的测试中注入一个单线程 ExecutorService，例如来自 guava 的：

```
ExecutorService executorService = Executors.newSingleThreadExecutor(); 
```

如果您的代码使用了 forkJoinPool 等`thenApplyAsync(...)`，请重写代码以使用 ExecutorService（有很多很好的理由），或者使用 Awaitility。

为了缩短示例，我在测试中将 BarService 设置为实现为 Java8 lambda 的方法参数，通常它是您将模拟的注入引用。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-03-25T22:03:52.310

对于那里的所有 Spring 用户，这就是我现在通常进行集成测试的方式，其中涉及异步行为：

当异步任务（例如 I/O 调用）完成时，在生产代码中触发应用程序事件。大多数情况下，无论如何处理生产中异步操作的响应都需要此事件。

有了这个事件，您就可以在测试用例中使用以下策略：

1.  执行被测系统
2.  监听事件并确保事件已触发
3.  做你的断言

要打破这一点，您首先需要触发某种域事件。我在这里使用 UUID 来识别已完成的任务，但你当然可以自由地使用其他东西，只要它是唯一的。

（请注意，以下代码片段也使用[Lombok](https://projectlombok.org)注释来摆脱样板代码）

```
@RequiredArgsConstructor
class TaskCompletedEvent() {
  private final UUID taskId;
  // add more fields containing the result of the task if required
} 
```

生产代码本身通常如下所示：

```
@Component
@RequiredArgsConstructor
class Production {

  private final ApplicationEventPublisher eventPublisher;

  void doSomeTask(UUID taskId) {
    // do something like calling a REST endpoint asynchronously
    eventPublisher.publishEvent(new TaskCompletedEvent(taskId));
  }

} 
```

然后我可以使用 Spring`@EventListener`在测试代码中捕获已发布的事件。事件监听器涉及更多一点，因为它必须以线程安全的方式处理两种情况：

1.  生产代码比测试用例更快，并且在测试用例检查事件之前事件已经触发，或者
2.  测试用例比生产代码更快，测试用例必须等待事件。

A`CountDownLatch`用于第二种情况，如此处其他答案中所述。另请注意，`@Order`事件处理程序方法上的注释确保在生产中使用的任何其他事件侦听器之后调用此事件处理程序方法。

```
@Component
class TaskCompletionEventListener {

  private Map<UUID, CountDownLatch> waitLatches = new ConcurrentHashMap<>();
  private List<UUID> eventsReceived = new ArrayList<>();

  void waitForCompletion(UUID taskId) {
    synchronized (this) {
      if (eventAlreadyReceived(taskId)) {
        return;
      }
      checkNobodyIsWaiting(taskId);
      createLatch(taskId);
    }
    waitForEvent(taskId);
  }

  private void checkNobodyIsWaiting(UUID taskId) {
    if (waitLatches.containsKey(taskId)) {
      throw new IllegalArgumentException("Only one waiting test per task ID supported, but another test is already waiting for " + taskId + " to complete.");
    }
  }

  private boolean eventAlreadyReceived(UUID taskId) {
    return eventsReceived.remove(taskId);
  }

  private void createLatch(UUID taskId) {
    waitLatches.put(taskId, new CountDownLatch(1));
  }

  @SneakyThrows
  private void waitForEvent(UUID taskId) {
    var latch = waitLatches.get(taskId);
    latch.await();
  }

  @EventListener
  @Order
  void eventReceived(TaskCompletedEvent event) {
    var taskId = event.getTaskId();
    synchronized (this) {
      if (isSomebodyWaiting(taskId)) {
        notifyWaitingTest(taskId);
      } else {
        eventsReceived.add(taskId);
      }
    }
  }

  private boolean isSomebodyWaiting(UUID taskId) {
    return waitLatches.containsKey(taskId);
  }

  private void notifyWaitingTest(UUID taskId) {
    var latch = waitLatches.remove(taskId);
    latch.countDown();
  }

} 
```

最后一步是在测试用例中执行被测系统。我在这里使用带有 JUnit 5 的 SpringBoot 测试，但这对于使用 Spring 上下文的所有测试应该是一样的。

```
@SpringBootTest
class ProductionIntegrationTest {

  @Autowired
  private Production sut;

  @Autowired
  private TaskCompletionEventListener listener;

  @Test
  void thatTaskCompletesSuccessfully() {
    var taskId = UUID.randomUUID();
    sut.doSomeTask(taskId);
    listener.waitForCompletion(taskId);
    // do some assertions like looking into the DB if value was stored successfully
  }

} 
```

请注意，与此处的其他答案相比，如果您并行执行测试并且多个线程同时执行异步代码，则此解决方案也将起作用。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-12-01T17:10:59.433

我更喜欢使用等待和通知。它简单明了。

```
@Test
public void test() throws Throwable {
    final boolean[] asyncExecuted = {false};
    final Throwable[] asyncThrowable= {null};

    // do anything async
    new Thread(new Runnable() {
        @Override
        public void run() {
            try {
                // Put your test here.
                fail(); 
            }
            // lets inform the test thread that there is an error.
            catch (Throwable throwable){
                asyncThrowable[0] = throwable;
            }
            // ensure to release asyncExecuted in case of error.
            finally {
                synchronized (asyncExecuted){
                    asyncExecuted[0] = true;
                    asyncExecuted.notify();
                }
            }
        }
    }).start();

    // Waiting for the test is complete
    synchronized (asyncExecuted){
        while(!asyncExecuted[0]){
            asyncExecuted.wait();
        }
    }

    // get any async error, including exceptions and assertationErrors
    if(asyncThrowable[0] != null){
        throw asyncThrowable[0];
    }
} 
```

基本上，我们需要创建一个最终的 Array 引用，以便在匿名内部类中使用。我宁愿创建一个 boolean[]，因为我可以设置一个值来控制我们是否需要 wait()。当一切都完成后，我们只需释放 asyncExecuted。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-08-29T08:18:29.637

如果您想测试逻辑，请不要异步测试它。

例如，测试这个适用于异步方法结果的代码。

```
public class Example {
    private Dependency dependency;

    public Example(Dependency dependency) {
        this.dependency = dependency;            
    }

    public CompletableFuture<String> someAsyncMethod(){
        return dependency.asyncMethod()
                .handle((r,ex) -> {
                    if(ex != null) {
                        return "got exception";
                    } else {
                        return r.toString();
                    }
                });
    }
}

public class Dependency {
    public CompletableFuture<Integer> asyncMethod() {
        // do some async stuff       
    }
} 
```

在测试中模拟具有同步实现的依赖项。单元测试是完全同步的，运行时间为 150 毫秒。

```
public class DependencyTest {
    private Example sut;
    private Dependency dependency;

    public void setup() {
        dependency = Mockito.mock(Dependency.class);;
        sut = new Example(dependency);
    }

    @Test public void success() throws InterruptedException, ExecutionException {
        when(dependency.asyncMethod()).thenReturn(CompletableFuture.completedFuture(5));

        // When
        CompletableFuture<String> result = sut.someAsyncMethod();

        // Then
        assertThat(result.isCompletedExceptionally(), is(equalTo(false)));
        String value = result.get();
        assertThat(value, is(equalTo("5")));
    }

    @Test public void failed() throws InterruptedException, ExecutionException {
        // Given
        CompletableFuture<Integer> c = new CompletableFuture<Integer>();
        c.completeExceptionally(new RuntimeException("failed"));
        when(dependency.asyncMethod()).thenReturn(c);

        // When
        CompletableFuture<String> result = sut.someAsyncMethod();

        // Then
        assertThat(result.isCompletedExceptionally(), is(equalTo(false)));
        String value = result.get();
        assertThat(value, is(equalTo("got exception")));
    }
} 
```

您不测试异步行为，但您可以测试逻辑是否正确。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-09-03T17:31:09.137

假设您有以下代码：

```
public void method() {
        CompletableFuture.runAsync(() -> {
            //logic
            //logic
            //logic
            //logic
        });
    } 
```

尝试将其重构为如下内容：

```
public void refactoredMethod() {
    CompletableFuture.runAsync(this::subMethod);
}

private void subMethod() {
    //logic
    //logic
    //logic
    //logic
} 
```

之后，以这种方式测试 subMethod：

```
org.powermock.reflect.Whitebox.invokeMethod(classInstance, "subMethod"); 
```

这不是一个完美的解决方案，但它会测试异步执行中的所有逻辑。

# python - 从用 C 语言创建的二进制文件中读取双精度的最佳方法是什么？

> ID：631607
> 
> 赞同：6
> 
> 时间：2009-03-10T18:13:05.067
> 
> 标签：python, c, double

AC 程序将连续的双精度数输出到二进制文件中。我希望将它们读入 Python。我尝试使用`struct.unpack('d',f.read(8))`

编辑：我在 C 中使用以下内容编写了一个随机双数

```
r = drand48();
fwrite((void*)&r, sizeof(double), 1, data); 
```

错误现在已修复，但我无法读取第一个值。对于全 0.000.. 数字，它读取为 3.90798504668055，但其余的都很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-11T00:22:48.830

我认为您实际上是在正确读取数字，但对显示感到困惑。当我从您提供的文件中读取数字时，我得到“ `3.907985046680551e-14`” - 这几乎是但不完全为零（0.000000000000039 的扩展形式）。我怀疑您的 C 代码只是以低于 python 的精度打印它。

[编辑] 我刚刚尝试在 C 中读取文件，我得到了相同的结果（虽然精度稍低：3.90799e-14）（使用 printf("%g", val)），所以我认为如果这个值是不正确的，它发生在写作方面，而不是阅读方面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T18:24:38.253

您能否详细说明“没有工作”？命令崩溃了吗？数据出来错了吗？究竟发生了什么？

如果命令崩溃：

*   请分享命令的错误输出

如果数据只是错误地出现：

*   创建和读取数据的系统是否具有相同的字节顺序？如果一个是大端，另一个是小端，那么您需要在格式字符串中指定字节顺序转换。

*   *如果两台计算机的字节序相同，那么数据究竟*是如何写入文件的？你知道吗？如果你这样做了，那么写入文件的值是什么，你得到的错误值是什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T23:19:34.830

首先，你试过[泡菜](http://www.python.org/doc/1.5.2p2/lib/module-pickle.html)吗？还没有人展示任何 Python 代码......这是一些用于在 python 中读取二进制文件的代码：

```
import Numeric as N
import array
filename = "tmp.bin"
file = open(filename, mode='rb')
binvalues = array.array('f')
binvalues.read(file, num_lon * num_lat) 
data = N.array(binvalues, typecode=N.Float)   

file.close() 
```

这里的 f 指定单精度、4 字节浮点数。找到每个条目的数据大小并使用它。

对于非二进制数据，您可以执行以下简单操作：

```
 tmp=[]
   for line in open("data.dat"):
                tmp.append(float(line)) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T18:56:14.497

*   `f.read(8)`可能返回少于 8 个字节
*   数据可能有不同的对齐方式和/或字节序：

    ```
    >>> for c in '@=<>':
    ...     print repr(struct.pack(c+'d', -1.05))
    ...
    '\xcd\xcc\xcc\xcc\xcc\xcc\xf0\xbf'
    '\xcd\xcc\xcc\xcc\xcc\xcc\xf0\xbf'
    '\xcd\xcc\xcc\xcc\xcc\xcc\xf0\xbf'
    '\xbf\xf0\xcc\xcc\xcc\xcc\xcc\xcd'
    >>> struct.unpack('<d', '\xbf\xf0\xcc\xcc\xcc\xcc\xcc\xcd')
    (-6.0659880001157799e+066,)
    >>> struct.unpack('>d', '\xbf\xf0\xcc\xcc\xcc\xcc\xcc\xcd')
    (-1.05,) 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T22:29:12.160

*最好*的方法是使用 ASCII 文本文件：

> 0.0
> 3.1416
> 3.90798504668055

因为它是可移植的，并且在一定程度上可以与任何类型的浮点实现一起使用。

从 a 的内存地址读取原始二进制数据`double`根本不可移植，并且在某些不同的实现中必然会失败。

您当然可以使用二进制格式来保持紧凑性，但是以这种格式编写的可移植 C 函数看起来根本不像您的代码片段。

至少，代码应该被一系列 ifs/ifdefs 包围，检查`double`当前机器使用的 s 的内存表示是否与 Python 解释器所期望的完全匹配。

编写这样的代码会很困难，这就是为什么我建议使用简单、干净、可移植和人类可读的 ASCII 文本解决方案。

这就是*我*对“最好”的定义。

# javascript - Ajax 同步回调

> ID：631609
> 
> 赞同：3
> 
> 时间：2009-03-10T18:14:35.190
> 
> 标签：javascript, jquery, ajax, callback, synchronous

我在本地文件夹中有一个 pageTest.html，此页面调用 service.ashx?i=...（返回值参数通过递增 +1）并遵循 Ajax 代码：

```
.
.
getIncr: function(parameters, success){
       $.ajax({
               async: false, 
               type: methodType,
               url: getTarget,
               data: "n="+parameters,
               dataType:"jsonp",
               success: success
             });
    }
.
. 
```

html页面调用这个函数m次（带脚本..）：

```
 .    
  var start = function(){
  .
  .
  var val = 0;
  .      
  .
  for(i=0; i<m; i++)
  {
      Foo.getIncr(val, function(returned_n){
          val = returned_n;
      });

  }

}; 
```

在页面加载期间，调用以“异步模式”执行，但我在 Ajax 中设置了“ **async: false ”。**我阅读了这个问题并找到了原因，即如果在不同的域中，Ajax 无法同步从 page.html 到 service.ashx 的调用。是否有在 page.html 中对 service.ashx 执行同步调用的解决方案（在不同的域中）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-15T23:13:29.280

好吧，问题是您无法发出同步 JSONP 请求。正如安迪指出的那样，它的实现方式是通过所谓的“脚本标签破解”。jQuery 无法在等待填充脚本标记时停止 javascript 应用程序的执行。

因此，您正在调用 jQuery 的正确方法来发出 JSONP 请求，但是因为它是 JSONP，所以不应用异步选项并且无法绕过它。您必须异步处理请求。

附带说明一下，无论如何在同步模式下使用 $.ajax 并不是一个好主意。如果请求需要太多时间才能完成，浏览器将停止，您的用户可能会收到一个弹出窗口，说明页面没有响应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T18:44:10.750

您根本不能使用 XMLHttpRequest 跨域。不管是同步的还是异步的。

由于您似乎使用的是 JSON（和 jsonp），因此您应该能够通过脚本标签破解来实现您想要的。我相信 jQuery 内置了这个（顺便说一句，你使用的是 jQuery 吗？）：

[http://docs.jquery.com/Release:jQuery_1.2/Ajax#Cross-Domain_getJSON_.28using_JSONP.29](http://docs.jquery.com/Release:jQuery_1.2/Ajax#Cross-Domain_getJSON_.28using_JSONP.29)

# c++ - 非静态和静态数据和函数

> ID：631610
> 
> 赞同：4
> 
> 时间：2009-03-10T18:14:38.077
> 
> 标签：c++, static

是否可以在静态成员函数中调用非静态数据成员？并且是否也可以在静态成员函数中调用非静态成员函数？

你怎么做呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T18:19:52.027

是的 - 你可以，这就是如何

```
class Foo
{
    public:
     static void staticFunc( const Foo &  foo)
     {
           foo.memberFunc();      

     }
      void memberFunc() const
      {
           staticFunc(*this);

      } 

}; 
```

这是一种设计，除了递归之外，演示了如何调用静态和非静态成员函数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T18:24:43.120

由于人们一心要投反对票，因此总结如下：

> 您可以从静态成员函数中访问非静态成员，前提是您传入类实例、或其指针或引用。对象的限定（换句话说，静态成员签名）将决定您是否可以只调用`const`或同时调用内部`const`的`non-const`成员函数。

非静态成员数据/函数依赖于`this`指针——它基本上是指向访问/调用成员数据/函数的对象的指针。静态是类级别的，与单个对象无关。但是，如果您将类实例的引用/指针/或实例本身传递给静态函数，则可以进行调用。

```
#include <iostream>
struct Eg {
 Eg() : x(42), y(-42) {}

static void foo(Eg const&f) {
    std::cout << "foo\n";
    f.bar();

    // we are good -- x is mutable
    std::cout << f.x << std::endl;
    f.x = 24;
    std::cout << f.x << std::endl;

    std::cout << f.y << std::endl;

    // you need non-const access for the following
    // so they don't work -- see foo signature
    //f.y = -24; compile error -- const l-value    

   // f.barbar(); same as above
}

void bar() const { // const required since we have a const reference
 std::cout << "bar\n";
}

void barbar() { // const required since we have a const reference
 std::cout << "bar\n";
}

  // note well the members
  mutable int x;
  int y;
};

int main() {
   Eg ex;

   Eg::foo(ex); // or ex.foo(ex);
} 
```

看看单例/工厂方法模式——你会感兴趣的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T18:16:38.210

您需要对象的实例才能调用非静态成员函数或访问非静态数据成员。静态没有这个，所以一般他们不能，除非他们从某个地方得到一个（即，你有一个静态函数用来获取指向对象的指针的全局表。）

但是静态不应该访问非静态数据。. . 如果必须，它们不应该是静态的。你能告诉我们你想要做什么吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T18:16:31.253

您将需要一些现有对象来调用*其*非静态成员函数或访问*其*非静态数据成员。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T18:16:34.093

通常不会，除非您有一个指向实例的静态指针。

问题是静态方法没有它正在工作的特定实例。如果传入实例，则可以调用非静态成员函数，否则不能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T18:17:12.093

不，这是不可能的，除非您能以某种方式访问​​定义类的实例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T18:19:48.780

两者都是：

```
class A {

   int x;

   void f() {
      staticfunc(); 
   }

   static void staticfunc() {
      A a;
      a.x = 42;
      a.f();
   }
}; 
```

当然上面的相互递归会导致一些问题:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-11T10:56:26.530

典型的用例是将 C API 回调传递给 C++ 项目中的对象实例。

```
 // declared in some external C API
typedef void __stdcall EnumDataCallback( void* context, void* data );
void EnumData( EnumDataCallback* callback, void* context ); 

// in consuming C++ Project
class MyDataManager
{
public:
  void PollData()
  {
       ::EnumData( &MyObject::StaticEnumData, this );
  }
private:
  static void __stdcall StaticEnumData( void* context, void* data )
  {
    MyDataManager* instance = (MyDataManager*)(context);
    instance->EnumData( data );
  }
  void EnumData( void* data )
  {
    // actual callback code
  }
}; 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-06-27T05:32:02.500

static members are the part of a class .these are the data members which are independent of any other class variable . and since they are independent of other class member so scope resolution operator can be used with them . these are the global members within the class. while non static members are created forveach instance of class..

# ajax - AJAX 错误处理建议和最佳实践

> ID：631622
> 
> 赞同：3
> 
> 时间：2009-03-10T18:18:06.570
> 
> 标签：ajax, error-handling

我想要一些关于在 AJAX 驱动的应用程序中处理错误的最佳方法的建议。具体来说，用于记录错误的方法以及您如何解决这些错误。

一个明显的优先事项是我不希望丢失任何用户输入。我希望提出某种回退机制，以便如果 AJAX 发布失败，可以使用相同的数据尝试自然形式的 POST。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T06:38:57.943

**使用[命令模式](http://en.wikipedia.org/wiki/Command_pattern)：**用户操作可以被认为是命令，例如“用户输入了这个文本”或“用户把这个东西移到了这里”。每个命令都可以是存储在 FIFO 队列中的对象。随着更多的命令被执行，随后的 Ajax 调用将它们发送到服务器。如果 Ajax 发布失败，命令会简单地在队列中建立，直到客户端能够发布它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T19:31:06.823

所以你的问题实际上是“我如何确保没有任何客户端错误？”

您需要对其进行广泛的测试。

无论如何，帖子都是帖子，如果一个失败，另一个也可能失败。

如果您想要一个想法，您可以开始保留客户端 javascript 日志，如果发生错误，您可以发布到存储日志以安全保存的一般错误处理页面。

但是，如果出现错误怎么办？你可以继续下去，但实际上：只要彻底测试它，你就会得到最少的客户端错误。

# design-patterns - 存储库模式问题 - 在不同存储库中使用存储库是否可以接受？

> ID：631624
> 
> 赞同：1
> 
> 时间：2009-03-10T18:19:18.440
> 
> 标签：design-patterns, repository, repository-pattern, entities

所以我基本上每个实体都有一个存储库，但是我的模型有一个关系部门，其中实体在模型中没有直接关系。所以我需要做的是查询该间接关系并返回实体集合。在与您实际查询的存储库不同的存储库上初始化和调用查询是否合适？如果没有，最好的解决方案是什么 - 帮助类？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T18:48:36.870

我同意 - 尝试识别聚合根。如果您不熟悉聚合根：[请阅读此处](http://domaindrivendesign.org/discussion/messageboardarchive/Aggregates.html)

不过，在我看来，您最初的问题仍然有效，您可能仍然依赖于其他存储库。根据您的域模型，拥有这些依赖项可能是可以的。如果您有这样的依赖关系，那么将它们与接口松散耦合是一个很好的设计。然后，您可以使用某种依赖注入来简化测试等。另一种选择是让工厂为您提供正确的存储库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:41:24.360

每个实体的存储库可能不是一个好主意。应该存在用于聚合根对象的存储库。为它们定义聚合根对象和提供者存储库。当存储库依赖于其他存储库时，这可能会清除一些混乱。

# sql - 归一化总和 (SQL) 的汇总列 - 第 1 部分

> ID：631625
> 
> 赞同：0
> 
> 时间：2009-03-10T18:19:29.483
> 
> 标签：sql, mysql

我有一张这样的桌子：

```
object_id | vote
1 | 2
1 | -1
1 | 5
2 | 3
2 | 1
3 | 4
3 | -2 
```

我想要这个结果（对于这个特定的例子，object_ids 1 和 2 是一个组的一部分，在别处定义，我正在寻找 normalized_score 以便总和 = 1。object_id 3 是一个未使用组的一部分。）：

```
object_id | normalized_score
1 | 6/10
2 | 4/10 
```

[下午 3:05 添加] 10 这里是 (1,2) 中 object_id 的投票总和。（1,2）还有一整套逻辑，我只是​​想提出最简洁的问题，这样人们就不必担心那部分了。

[下午 3:10 补充] 正如评论中所指出的，如果其中一个对象的分数低于 0，则会出现问题。这是规则，“如果任何结果 ID 的分数是 -x，并且这是集合的最低分数，则将 x 添加到所有分数以将最低分数归零”。尽管在 SQL 之外，我可以在自己的时间执行此操作 - 因此，只有当有人有能力尝试在 SQL 中解决它时，它才是一种奖励。

如果我进行自我加入，我可以获得总和。我不知道如何获得归一化的总和。理想情况下，这将适用于 MySQL 5.x 和 Sqlite3。否则，我可以使用两个单独的查询来执行此操作，然后在后处理中完成工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T18:32:20.263

评论是完全正确的.. 但我会假设 10 只是你从你的鼻子中挑选的一些数字。

SELECT object_id AS ObjectID, SUM(vote) + '/10' AS NormalizedVote FROM table GROUP BY object_id

享受。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T22:27:08.890

```
-- SQL解决方案
选择
  object_id 作为 ObjectID，
  (SUM(CASE SIGN(vote) WHEN 1 THEN vote ELSE 0 END) -
    ((CASE SIGN(MIN(vote)) WHEN -1 THEN MIN(vote) ELSE 0) *
     (COUNT(1)))) + '/10' 作为标准化投票
从表
按 object_id 分组

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T12:28:37.680

不补偿反对票的解决方案（我包括这个是因为它更容易阅读/理解）：

```
SELECT object_id
,      SUM(vote) + '/' + total AS normalized_score
FROM   tabel
,      (
       SELECT sum(vote) AS total
       FROM   tabel
       ) 
GROUP BY object_id, total 
```

完整解决方案：

```
SELECT object_id
,      SUM(vote + minvote) + '/' + (total + minvote * count) AS normalized_score
FROM   tabel
,      (
       SELECT sum(vote) AS total
       ,      CASE WHEN MIN(vote) < 0 THEN
                  -MIN(vote)
              END AS minvote
       ,      COUNT(*) AS count
       FROM   tabel
       ) 
GROUP BY object_id, total, minvote, count 
```

（我无权访问 MySQL，所以我在 Oracle 中编写了一个查询并用 || 替换为 +。希望它在 MySQL 中有效或至少有帮助:)）

# math.h - erf(x) 和 math.h

> ID：631629
> 
> 赞同：5
> 
> 时间：2009-03-10T18:20:23.193
> 
> 标签：math.h

根据[这个站点](http://www.opengroup.org/onlinepubs/000095399/functions/erf.html)，误差函数 erf(x) 来自 math.h。但实际上在 math.h 中查找，它不存在，并且 gcc 无法编译以下测试程序，而 g++ 可以：

```
#include <math.h>
#include <stdio.h>

int main(int argc, char* argv[]) {
  double x;
  double erfX;
  x = 1.0;
  erfX = erf(x);

  printf("erf(%f) = %f", x, erfX);
}

$ gcc mathHTest.c
/tmp/ccWfNox5.o: In function `main':
mathHTest.c:(.text+0x28): undefined reference to `erf'
collect2: ld returned 1 exit status
$ g++ mathHTest.c 
```

g++ 有哪些 gcc 没有引入的内容？在 /usr/include 中，我唯一能找到 erf(x) 的地方是 tgmath.h，我不包括在内。所以 g++ 必须获取与 gcc 不同的标头，但是哪些标头呢？

编辑：我没有在 libm 中使用 gcc 链接，因此出现链接错误。但是，我仍然不明白为什么 erf() 不在 math.h 中。它来自哪里？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-11-27T13:15:30.973

我遇到了类似的问题，需要找到确切的定义，`erf`所以让我对此进行扩展。正如 Chris Dodd 所说，该函数声明在`bits/mathcalls.h`其中包含`maths.h`.

`bits/mathcalls.h`：

```
...
#if defined __USE_MISC || defined __USE_XOPEN || defined __USE_ISOC99
__BEGIN_NAMESPACE_C99
/* Error and gamma functions.  */
__MATHCALL (erf,, (_Mdouble_));
__MATHCALL (erfc,, (_Mdouble_));
__MATHCALL (lgamma,, (_Mdouble_));
__END_NAMESPACE_C99
#endif
... 
```

宏魔法扩展`__MATHCALL (erf,, (_Mdouble_));`为

```
extern double erf (double) throw (); extern double __erf (double) throw (); 
```

实际代码在`libm.a`或`libm.so`（`gcc -lm`）中：

```
$ nm /usr/lib/libm.a
...
s_erf.o:
00000400 T __erf
00000000 T __erfc
         U __ieee754_exp
00000400 W erf
00000000 W erfc
... 
```

源码可以从[gnu libc](http://www.gnu.org/s/libc/#Availability "gnu libc")网页获取。对于实际实现的粗略想法，这里有几行源代码：

`sysdeps/ieee754/dbl-64/s_erf.c`：

```
/* double erf(double x)
 * double erfc(double x)
 *                           x
 *                    2      |\
 *     erf(x)  =  ---------  | exp(-t*t)dt
 *                 sqrt(pi) \|
 *                           0
 *
 *     erfc(x) =  1-erf(x)
 *  Note that
 *              erf(-x) = -erf(x)
 *              erfc(-x) = 2 - erfc(x)
 *
 * Method:
 *      1\. For |x| in [0, 0.84375]
 *          erf(x)  = x + x*R(x^2)
 *          erfc(x) = 1 - erf(x)           if x in [-.84375,0.25]
 *                  = 0.5 + ((0.5-x)-x*R)  if x in [0.25,0.84375]
 *         where R = P/Q where P is an odd poly of degree 8 and
 *         Q is an odd poly of degree 10.
 *                                               -57.90
 *                      | R - (erf(x)-x)/x | <= 2
 *
 *
 *         Remark. The formula is derived by noting
 *          erf(x) = (2/sqrt(pi))*(x - x^3/3 + x^5/10 - x^7/42 + ....)
 *         and that
 *          2/sqrt(pi) = 1.128379167095512573896158903121545171688
 *         is close to one. The interval is chosen because the fix
 *         point of erf(x) is near 0.6174 (i.e., erf(x)=x when x is
 *         near 0.6174), and by some experiment, 0.84375 is chosen to
 *         guarantee the error is less than one ulp for erf.
 *
 *      2\. For |x| in [0.84375,1.25], let s = |x| - 1, and     
 ... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T19:14:51.380

'erf' 实际上是在 bits/mathcalls.h 中声明的，它是由 math.h #included 的。实际的声明被宏魔法严重遮蔽，使其对 C 和 C++ 都做正确的事情

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T19:12:41.197

您还需要链接数学库 ( `libm`)：

```
$ gcc mathHTest.c -lm 
```

所有正常的数学库函数实际上都在那里，而不是在标准 C 库 ( `libc`) 中。

根据我的测试，`g++`确实包含`libm`自动，但`gcc`没有。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-30T14:55:54.157

我在 x86 处理器上使用来自 cygwin 的 gcc 时遇到了同样的问题。“-lm”库包含参数（在文件列表之后！）完美运行。

# c - 请求一个简单的 C 代码示例，说明如何使用泛型或无类型（通过 void *）数组

> ID：631632
> 
> 赞同：3
> 
> 时间：2009-03-10T18:21:12.177
> 
> 标签：c, data-structures

我正在努力在 C 中创建一个通用（或无类型）数组（我知道 C++ 使这更容易）。简而言之，我想分配一个数组来保存一个特定已知类型的数组（在运行时）。在实际实现中，它取决于用户输入。

我一直在尝试使用在几个谷歌点击中找到的建议后使用枚举/结构场景，但我担心我对 void 指针的缺乏经验和缺乏具体示例会阻止我获得一段工作代码。（通常我只会买一本书，但我在一个我不会说这种语言并且没有英语编程书籍的国家。）

问题归结为以下简化：我有一个图像（只有 1D），像素值可能是 int、float 或 double。我确实有一个函数可以告诉我类型。我要做的就是将像素存储在适当类型的数组中。（实际上，这些图像非常大，我的动机是节省内存并防止为每种类型编写代码块。）

我一直在尝试类似以下的方法，但也许它不是最好的（可能的数据结构的代码片段）：

```
enum type {
    typeint, typefloat, typedouble
};

struct genericarray {
    enum type type;
    void *storage;
}; 
```

不知何故，我想将这些像素存储在通用数组的实例中。到目前为止，我所有的尝试都变成了“警告：取消引用 'void *' 指针”各方，我承认我不理解。

我永远感激任何帮助，特别是一些简化的例子，如何获得一个工作的通用数组。该示例可以只使用 for 循环来初始化。我可以弄清楚如何加载我的实际图像。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T19:24:14.150

我将把整个事情封装如下：

```
#include "stdlib.h"
#include "stdio.h"

// structure
enum type { typeint, typefloat, typedouble };

struct genericarray
{
    enum type type;
    void ** storage;
};

typedef struct genericarray genericarray;

// allocate
void allocate(long numItems, enum type varType, genericarray * array)
{
    (*array).type = varType;
    switch (varType)
    {
        case typeint:
            (*array).storage = malloc(numItems*sizeof(int));
            break;
        case typefloat:
            (*array).storage = malloc(numItems*sizeof(float));
            break;
        case typedouble:
            (*array).storage = malloc(numItems*sizeof(double));
    }
}

// release
void release(genericarray array)
{
    free(array.storage);
}

// usage
int main(int argCount, char ** argList)
{
    genericarray image_1;
    genericarray image_2;

    int iv;
    float fv;

    allocate(10, typeint, &image_1);
    allocate(10, typefloat, &image_2);

    ((int *)(image_1.storage))[5] = 42;
    iv = ((int *)(image_1.storage))[5];
    printf("image_1[5] = %d\n", iv);

    ((float *)(image_2.storage))[5] = 3.14159;
    fv = ((float *)(image_2.storage))[5];
    printf("image_2[5] = %f\n", fv);

    release(image_2);
    release(image_1);

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:30:28.177

```
enum type {
    typeint, typefloat, typedouble
}

struct genericarray {
    enum type type;
    union { int i; float f; double d; } storage;
}; 
```

是你需要的（恕我直言）

编辑：要使用 void* 作为 int/float/double 的容器，您必须分配它：（数组是您的旧类型的 genericarray - 使用 void* 存储）

```
array.storage = malloc(sizeof(int)); 
```

并取消引用为：

```
(*((int*)array.storage)) 
```

替换 float 为 type == typefloat 等的情况。

你还必须释放它

```
free(array.storage); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T18:31:31.950

那是因为你不能取消引用一个 void 指针而不先将它转换为其他东西。这是因为 C 实现需要知道取消引用的指针是什么类型的对象。

除了已经建议的联合之外，您还可以使用您提到的方法，但如果您想取消引用存储，则必须有条件地转换（隐式或显式转换）：

```
int *iptr;
double *dptr; 

switch (x.type)
{
    case typedouble:
        dptr = x.storage; // implcit conversion example
        // reference your "image" as dptr[i] now
        break;
    case typeint:
        iptr = (int *)x.storage; // explicit conversion, actually unnecessary
        // reference your "image" as iptr[i] now
        break;
 } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T18:36:14.950

您实际上并没有指定给出错误的行，但我想它们可能看起来有点像

```
struct genericarray ga;
float fValue;

fValue = ga.storage[idx]; 
```

您可以做的是添加演员表

```
fValue = ((float*)ga.storage)[idx]; 
```

我建议创建一些宏或函数来设置和获取值

```
#define GET_STORAGE(_type, _src, _idx) \
  ((_type*)_src.storage)[_idx]
#define SET_STORAGE(_type, dst, _idx, _src) \
  ((_type*)_dst.storage)[_idx] = _src 

fValue = GET_STORAGE(float, ga, 3);

SET_STORAGE( float, ga, 3, sin(ang) ); 
```

我看到 'Chris Young' 在他的回答中使用了 switch 语句，这对这些访问函数来说是一件好事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T18:33:34.100

您想要定义一个结构，该结构具有一个项目，该项目是您需要使用的三种类型的联合，然后动态分配该类型的缓冲区。

# c++ - 返回一个需要由智能指针持有的“指针”

> ID：631633
> 
> 赞同：9
> 
> 时间：2009-03-10T18:21:17.887
> 
> 标签：c++, boost, tr1

我有一个项目，我想更多地使用智能指针。总的来说，我在这个目标上是成功的。但是，我遇到了一件我不确定“最佳实践”是什么的事情。

基本上我想从一个函数返回一个“指针”，但**要求**用户将它保存在一个智能指针中。不仅如此，我不想强​​制使用特定的智能指针（共享与作用域）。

问题主要在于似乎没有正确的方法将 a 升级`scoped_ptr`到 a `shared_ptr`（我认为这将是理想的解决方案）。我理解他们为什么不这样做，因为它会允许转让所有权，这可能会导致一些类似的问题`std::auto_ptr`。

*但是，在这种*情况下，转让所有权似乎是一个好主意。所以我的想法是这样的：

```
// contrived example of factory pattern
std::auto_ptr<A> func() { return std::auto_ptr<A>(new A); } 
```

这可以“正常”工作，因为两者都`scoped_ptr`具有`shared_ptr`从 a 获取所有权的构造函数`std::auto_ptr`。

所以我的问题是，这是好的做法吗？有更好的解决方案吗？我能想到的唯一真正的选择是使用模板模板作为返回值，如下所示：

```
// similar to above example
template <template <typename> class P>
P<A> func() { return P<A>(new A); } 
```

这实际上可以很好地工作，只是我认为它需要一些工作才能让它与 a 一起工作`scoped_ptr`。

想法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T18:56:07.820

使用`std::auto_ptr`是**一种**很好的做法，实际上[这样的例子](http://www.research.att.com/~bs/bs_faq2.html#memory-leaks)是由 Bjarne Stroustrup 提出的。

的移动语义`auto_ptr`为您提供了正确的工具来处理它。

例如：

```
auto_ptr<Foo> make_foo()
{
    return auto_ptr<Foo>(new Foo);
}

Foo *raw_pointer=make_foo().release();
shared_ptr<Foo> shared_pointer=make_foo();
auto_ptr<Foo> auto_pointer=make_foo(); 
```

如果你返回`shared_ptr`，你不能回退到正常指针，`auto_ptr`你可以。您总是可以升级`auto_ptr`到共享但不能升级到其他方向。

另一个重要的点是`shared_ptr`使用原子引用计数，这比简单但完全有效的工作要慢得多`auto_ptr`。

PS：`scoped_ptr`只是`auto_ptr`for Poors 的版本 --- 它是不可复制的并且没有默认构造函数。它更像是“不那么混乱”的版本`auto_ptr`，相比之下`shared_ptr`它不在 tr1\. `scoped_ptr`一般来说，使用over没有太大的优势 `auto_ptr`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T18:26:17.063

如果您建立一个工厂，您只需返回一个指针即可。您工厂的用户可以自行决定如何以及在何处放置此指针。
如果您需要强制使用智能指针，则必须限制选择，因为您不希望他们使用“错误”的指针。
所以 boost::shared_ptr。但最好将其 typedef 到 MyClassPtr 或 MyClass::ptr。
尽管如此，它们就像“新”的工厂。当我想要时，我将 new 的结果放入 std::auto_ptr 中。但是当我不想要智能指针时，我不想一直被迫调用“释放”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-18T02:20:25.487

使用 C++11，您应该能够使用`std::unique_ptr`其他智能指针类型具有采用`std::unique_ptr`. 如果您维护此类资源的内部列表，那么您可能希望使用`std::shared_ptr`.

# c++ - 如何在 Visual Studio 2008 中创建自定义清理（清理后）事件？

> ID：631636
> 
> 赞同：21
> 
> 时间：2009-03-10T18:22:04.250
> 
> 标签：c++, visual-studio, visual-studio-2008, visual-c++

在我们的构建过程中，对于每个项目，我们使用 Post Build 事件将我们的可执行文件复制到单独的部署目录中。这很有效，但问题是我们在执行清洁解决方案/清洁项目后遇到了陈旧文件的问题。我想设置一个“清理”事件来删除复制的文件，而 Visual Studio 2008 似乎没有在项目属性页面中提供选项。

它有：

```
Build Events:
   Pre-Build Event
   Pre-Link Event
   Post-Build Event
Custom Build Step
   General 
```

我想找到的是在清理项目时执行任意命令行的某种方法。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2010-10-18T04:24:57.200

您可以在 csproj 文件中使用 MSBuild 目标语法。例如

```
 <Target Name="AfterClean">
    <Delete Files="$(OutDir)\$(TargetName).exe" ContinueOnError="true" />
  </Target> 
```

有一种直接在 MSBuild 团队博客中描述的 Visual Studio IDE 中编辑 .csproj 文件的简洁方法，但这是我的第一篇文章，所以我只能包含一个超链接。（简单地说：卸载项目，然后右键单击它以查看条目“Edit [project].csproj”...您的 csproj 将在 IDE 中以 xml 文件的形式出现，其中包含元素和属性的智能感知。太棒了！）

自定义目标的完整列表在[这里](https://docs.microsoft.com/en-us/visualstudio/msbuild/how-to-extend-the-visual-studio-build-process?view=vs-2019)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-08-09T21:02:28.197

对于 Visual C++ 项目，您需要将文件添加到“General”项目配置属性下的“Extensions to Delete On Clean”部分。尽管它声称需要扩展，但它实际上是在使用 glob，并且很乐意接受完整路径并扩展 MSBuild 变量。这对我有用：

> `$(ProjectDir)\deployment\*.*`

我不确定您是否可以通过这种方式删除目录，但它至少可以获取文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-03-27T19:34:52.030

如果您使用“项目属性--> 配置属性--> 自定义构建设置”，您必须记住填写“输出”字段，否则它将无法运行。

从：

[http://blogs.msdn.com/b/visualstudio/archive/2010/04/26/custom-build-steps-tools-and-events.aspx](http://blogs.msdn.com/b/visualstudio/archive/2010/04/26/custom-build-steps-tools-and-events.aspx)

“Outputs 属性是以分号分隔的文件列表，并且必须列出在执行自定义构建步骤时生成的任何文件。如果将 Outputs 属性留空，您的自定义构建步骤将永远不会执行，因为 MSBuild 将确定没有输出过时。如果您的步骤不生成文件，但您仍希望它在每次构建时执行，则制作一个假文件名就可以解决问题，因为该文件永远不会存在，MSBuild 将始终确定自定义构建步骤已过时。”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T18:45:37.987

您将需要手动编辑 .csproj 文件并添加“AfterClean”目标。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T21:40:04.463

不幸的是，没有记录的方法可以插入自定义清理步骤。您可以在预构建事件中清理您的输出，但这仍然会在清理后留下工件。

从 MSDN，这里是各种构建步骤的调用顺序：

1.  预建事件
2.  单个文件的自定义构建步骤
3.  代理生成器
4.  MIDL
5.  资源编译器
6.  C/C++ 编译器
7.  预链接事件
8.  链接者或图书管理员（视情况而定）
9.  BSCMake
10.  项目的自定义构建步骤
11.  部署工具。
12.  构建后事件

    MSDN：[了解自定义构建步骤](http://msdn.microsoft.com/en-us/library/e85wte0k.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-16T22:20:05.050

其他人并没有完全按照我的意愿去做，我只是找到了一个更好的方法。在 VS2010 中针对 C++ Win32 项目进行了测试，转到项目属性 --> 配置属性 --> 自定义构建设置。您可以添加自定义命令行，并告诉 VS 在执行命令之前或之后执行什么操作。

# c - 在某些情况下忽略 SIGCHLD，但在其他情况下不忽略

> ID：631641
> 
> 赞同：3
> 
> 时间：2009-03-10T18:24:39.330
> 
> 标签：c, unix, system

在我的程序中，我根据用户输入 fork() 几次。

在某些情况下，我想处理 SIGCHLD 并说出类似“Process #Finished”之类的内容。但在其他情况下，我想忽略这个信号。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T18:38:52.387

信号处理是为进程全局设置的。如果您想在某些孩子终止但其他孩子不终止时捕获像 SIGCHLD 这样的异步信号，您不能决定提前忽略它。

您每次都需要在父级中处理信号，然后决定是否要在处理程序中忽略它。

至少，您的处理程序应该对子项（siginfo_t 结构中的 si_pid）执行 wait() 以获取其返回码。此时，您可以检查进程 ID 并决定还要做什么。如果您不想打印，则无需打印任何内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-11T01:55:20.387

你想捕捉信号 SIGCHLD 然后调用一个函数。您想使用`signal()`( ) 来执行此操作`man signal`。在下面的示例`child_died()`中，在捕获信号 SIGCHLD 后调用（此时子进程已死）。如果您需要将信息从子级传递给`child_died()`需要条件的父级，则需要使用管道 ( `man pipe`)。这是信号和管道的示例：

```
#include <signal.h>
#include <strings.h>
#include <stdio.h>

#define MAX_SIZE 256

void child_died(int);

int fd[2];

int main()
{
    int pid;
    extern int fd[];
    char *str;

    pipe(fd);
    signal(SIGCHLD, child_died);

    if ((pid = fork()) < 0) {
        // error
        printf("Error\n");
    } else if (pid == 0) {
        // child
        printf("In child process\n");
        close(fd[0]);
        str = strdup("Message from child process.\n");
        write(fd[1], str, strlen(str) + 1);
    } else {
        // parent
        wait();
        printf("Now in parent\n");
    }

    return 0;
}

void child_died(int s)
{
    char *str;
    close(fd[1]);
    read(fd[0], str, MAX_SIZE);
    printf("%s", str);
} 
```

保存为 sigchld.c 并编译：`gcc -Wall sigchld.c -o sigchld`

如果您想将一个 int（如子 pid）或其他一些数据类型从子进程传递给父进程，您要么必须将其转换为字符串并再次返回，要么找到另一种方法。

如果您想忽略 SIGCHLD，那么在我的示例中，您可以将该逻辑放入`child_died()`. 只需使用一个简单的`if`. 我不知道您如何决定何时忽略信号以及何时打印您想要的内容，这就是我在上面的代码中包含管道内容的原因。我想你会使用来自子进程的一些信息，并且由于`child_died()`在父进程上调用，你需要一种将数据从子进程传输到父进程的方法。

我希望这有帮助。可能有更好或更简单的方法来实现这一点，我不知道。如果有那么请发表评论。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T18:47:31.257

您可以`waitpid`在阻塞或非阻塞模式下使用函数来等待来自给定子节点的信号，然后进行一些处理。实际上，您**必须**使用`wait`某种方式，正如格雷厄姆的回答中所述...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T18:45:28.920

如果您忽略 SIGCHLD，那么进程表将充满僵尸。

# asp.net - 面包屑 - ASP.NET - VS2008

> ID：631643
> 
> 赞同：4
> 
> 时间：2009-03-10T18:24:57.800
> 
> 标签：asp.net, sitemappath

在我的旧网络应用程序 asp.net 1.1 天中，我有自定义的“面包屑”用于网站导航。我想使用 VS-2008 重做我的网站。这是否具有可以放置在母版页上的内置面包屑？如果是这样，谁能指出我正确的方向？

这就是我的设想

母版页具有类似导航选项的选项卡，当他们单击某个导航选项时，我将启用 SiteNavigation 控件并突出显示母版页中的选定选项卡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T23:45:25.767

使用 SiteMapPath 控件。如果面包屑数据是静态的，请使用 Web.sitemap 文件来定义它并设置好。如果它是 SiteMapProvider 类的动态子类来定义您自己的逻辑并使用标准的 SiteMapPath 控件来显示它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:39:27.017

.NET 2.0+ 确实有一个面包屑类型的控件，它与 SiteMap.xml 一起使用，它还允许您添加站点地图。它相当容易使用，但站点必须是静态布局的，否则您必须创建一个自定义站点地图提供程序（这并不难）。查看描述使用面包屑的[此博客条目](http://geekswithblogs.net/azamsharp/archive/2006/08/16/88197.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:39:04.070

您正在寻找的是 sitemappath 对象，它要求在项目中包含站点地图

# java - Java StringBuilder 和线程安全

> ID：631645
> 
> 赞同：14
> 
> 时间：2009-03-10T18:26:53.443
> 
> 标签：java, multithreading, thread-safety, stringbuilder

我正在构建一个由多个部分组成的字符串，并且想要使用其中一个`StringBuffer`或`StringBuilder`这样做。从 Java 5 文档中，我认为这`StringBuilder`是最好的，但需要注意的是

> 的实例`StringBuilder`对于多线程使用是不安全的。

从这个陈述中，我明白我不应该有一个`StringBuilder`由多个线程共享的实例。但是这个案例呢：

```
//Is this safe?
//foo() is called simultaneously by multiple threads
String foo(String a, String b) {
    return new StringBuilder(a).append(b).toString();
} 
```

在这里，函数中可能同时有多个线程，同时使用`StringBuilder`该类（例如，静态变量的并发访问，如果有的话），但每个线程都有自己单独的`StringBuilder`. 从文档中，我不能完全确定这是否算作多线程使用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-10T18:28:23.767

这完全没问题。只要局部变量不访问或改变实例或类变量，它们就不会出现线程安全问题。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-10T18:29:05.857

是的，这是安全的，因为 StringBuilder 对象仅在本地使用（每个调用 foo() 的线程都会生成自己的 StringBuilder）。

您还应该注意，您发布的代码实际上与由此生成的字节码相同：

```
String foo(String a, String b) {
    return a + b;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-11T02:38:55.273

您拥有的代码是安全的。

这段代码不是。

```
public class Foo
{
    // safe
    private final static StringBuilder builder;

    public static void foo()
    {
        // safe
        builder = new StringBuilder();
    }

    public static void foo(final String a)
    {
        // unsafe
        builder.append(a);
    }

    public synchronized void bar(final String a)
    {
        // safe
        builder.append(a);
    }
} 
```

仅使用本地数据的局部变量没有线程安全问题。一旦开始处理在类或实例方法/变量级别可见的数据，您只能遇到线程安全问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-10T18:32:49.950

同意其他答案 - 只是一个注释。

如果存在多个线程正在使用 StringBuffer 的情况，这可能是一个完全被破坏的用例，因为这意味着单个字符串是以准随机顺序构建的，因此使 StringBuffer 成为线程没有意义安全的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T18:38:01.467

我不确定是否需要此代码，因为我猜 Java 会自动选择 StringBuilder。如果您没有性能问题，请使用 a + b。

如果需要性能，请尝试：

```
return new StringBuilder(
a.length() + b.length()).append(a).append(b).toString(); 
```

它会正确调整缓冲区的大小，并防止 VM 调整其大小并在途中创建要收集的垃圾。

# sql-server - 如何在实体框架之上最好地过滤 ado.net 数据服务公开的实体？

> ID：631649
> 
> 赞同：0
> 
> 时间：2009-03-10T18:27:32.490
> 
> 标签：sql-server, entity-framework, wcf-data-services

我想通过 ADO.NET 数据服务提供的 API 公开一组简单的博客文章、标签和类别。

在演示中看起来很简单：使用实体框架设计器创建实体数据模型，添加数据服务，将其指向实体，完成。到目前为止，一切都很好。

但是有些帖子、标签和类别是未发布的（私有的），所以我不希望它们出现在数据服务中。过滤它们的最佳位置在哪里？

我可以在数据库中创建一个视图 - 但是 EDM 设计器将视图视为只读，找不到主键，并且不创建与其他实体的关联。

或者我可以创建一个查询拦截器来在 ado.net 数据服务级别添加过滤。但这似乎离我的领域模型太远了。

那么我在这里缺少什么吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-23T11:19:20.427

您应该使用 QueryInterceptors 进一步过滤您的数据。

# c# - C# 3 中的委托和事件提供了哪些新功能？

> ID：631651
> 
> 赞同：0
> 
> 时间：2009-03-10T18:28:14.860
> 
> 标签：c#, .net, c#-3.0

我觉得我没有利用 .NET 3.5 及更高版本中可用的委托/事件的所有功能。并且或多或少仍在使用 2.0 中可用的代表权力。如果您告诉我现在应该如何使用委托/事件、技巧、捷径，我将不胜感激。

谢谢。

**编辑**

***乔恩建议他在这个主题上发表文章，我在这里发帖是为了更容易导航：***

我的一些可能相关的文章：

*   [活动](http://www.yoda.arachsys.com/csharp/events.html)
*   [C# 2.0 中的委托](http://www.yoda.arachsys.com/csharp/csharp2/delegates.html)
*   [闭包](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)
*   [C# 2 虚张声势的指南](http://csharpindepth.com/Articles/General/BluffersGuide2.aspx)
*   [C# 3 虚张声势的指南](http://csharpindepth.com/Articles/General/BluffersGuide3.aspx)

我的书，C# in Depth，有一整章专门介绍委托（第 5 章）。不幸的是，这不是免费的之一:(

附言。我找不到这个问题的副本，但确实浏览了很多关于这个主题的内容。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T18:34:00.353

我的一些可能相关的文章：

*   [活动](http://pobox.com/~skeet/csharp/events.html)
*   [C# 2.0 中的委托](http://pobox.com/~skeet/csharp/csharp2/delegates.html)
*   [闭包](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)
*   [C# 2 虚张声势的指南](http://csharpindepth.com/Articles/General/BluffersGuide2.aspx)
*   [C# 3 虚张声势的指南](http://csharpindepth.com/Articles/General/BluffersGuide3.aspx)

我的书[C# in Depth](http://manning.com/skeet)有一整章专门介绍委托（第 5 章）。不幸的是，这不是免费的之一:(

总结中的主要变化（正如 Jared 所说，这些是语言变化 - .NET 本身并没有太大变化，只是它们变得通用，并且框架提供了方便`Func`和`Action`委托）：

C# 2：

*   方法组转换：

    ```
    // Old:
    button.Click += new EventHandler(HandleClick);
    // New:
    button.Click += HandleClick; 
    ```

*   匿名方法：

    ```
    button.Click += delegate { Console.WriteLine("Click!"); }; 
    ```

*   协方差/逆变：

    ```
    EventHandler generalHandler = LogEvent;
    button.Click += generalHandler;
    button.KeyPress += generalHandler; // Event type is KeyPressEventHandler 
    ```

C# 3：

*   Lambda 表达式：

    ```
    button.Click += (sender, args) => Console.WriteLine("Click!"); 
    ```

    或更重要的是：

    ```
    var people = list.Where(person => person.Name != "Jon")
                     .OrderBy(person => person.Age); 
    ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T18:35:18.323

代表完全没有改变 2.0 -> 3.5。改变的是他们周围的很多物品

1.  System.Core.dll（最终）以 Func<> 和 Action<> 的形式添加了可重用的委托
2.  C# 和 VB 通过 lambda 表达式获得了一点函数式的味道。这为表达委托操作的语言提供了非常简洁的语法。C# 在 2.0 中有匿名方法，但它们无法与 lambda 表达式的简洁性相提并论

    ```
    list.Where(x => x > 42);
    ```

3.  LINQ 在它的基础中公开了一系列纯粹在委托上运行的 API。

所以真的 delegetase 没有改变，只是用途。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:39:16.550

您是否考虑过使用委托来进行快速而肮脏的异步操作？您可以调用 BeginInvoke 和 EndInvoke 方法对 ThreadPool 执行异步操作。

```
// Definition.
delegate string TransformDelegate(string input);

// Client code.  This is some lengthy operation.  You can also
// assign a function here if you want.
TransformDelegate t = (x) => ...;

// Begin invoking.
t.BeginInvoke("input", (ar) => 
{
    // Call end invoke.
    string result = t.EndInvoke(ar);

    // Dispose of wait handle, known issue documented here.
    // https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=94068
    using (IDisposable d = ar.WaitHandle) { }

    // Process end result here.  Remember, on another thread now.
}, null); 
```

# c# - 如何将此 LINQ 查询表达式从 C# 转换为 VB.NET？

> ID：631656
> 
> 赞同：1
> 
> 时间：2009-03-10T18:29:51.313
> 
> 标签：c#, vb.net, linq, c#-to-vb.net

我有以下 C# LINQ 查询表达式：

```
var duplicatedSSN =
         from p in persons
         group p by p.SSN into g
         where g.Count() > 1
         select g.Key; 
```

谁能帮我把它转换成 VB.NET？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T18:46:33.177

试试这个

```
Dim duplicateSSN = From p in persons _
                   Group By Key=p.SSN _
                   Into g = Group _
                   Where g.Count() > 1 _
                   Select Key 
```

# javascript - javascript：设置 a.onclick 在第一次运行时不起作用

> ID：631659
> 
> 赞同：0
> 
> 时间：2009-03-10T18:31:01.967
> 
> 标签：javascript, events

我使用这样的代码来动态创建一些基于链接的控件：

```
<script type="text/javascript">
    function BuildControls (id, ...)
    {  
        var div = document.getElementById (id);  
        /* some stuff with var sp=document.createElement('span'); */
        var a = document.createElement ('a');
        a.innerHTML = on ? 'Cancel' : captions_do[i];
        a.className = class_do;
        a.style.display = on2 ? '' : 'none';
        a.id = 'iAccept'+id+'_'+i+'Control';
        div.appendChild (sp);
        div.innerHTML+='<br />';
        div.appendChild (a);
        a.onclick = function () {alert ('wtf')};
        div.innerHTML+='<br />';
    }
</script>
...
<div id="someid"></div>  
<script type="text/javascript">  
    BuildControls ('someid', ...);
</script> 
```

所以当我点击链接时，它什么也不做。如果我明确调用 a.onclick() ，它会起作用。怎么了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:26:43.050

> div.innerHTML+='<br />';

这是语法糖：

> div.innerHTML= div.innerHTML+'<br />';

这使得正在发生的事情更清楚：您只需将 div 的全部内容序列化为 HTML，添加一个小字符串，然后将结果解析回 HTML。即使它完美地工作，那也将是非常低效的。

当您序列化一个元素时，您会丢失任何附加到它的非基于属性的信息，包括 JavaScript 属性、事件处理程序和侦听器。告别您的 onclick。

*永远不要使用“innerHTML+=”。这总是一个错误。*

另一种方法是在未附加到文档的独立 div 上设置 innerHTML，然后将其 childNodes 一个接一个地附加到您真正想要的元素上。

但是对于这么简单的事情，您应该只使用标准的 DOM 方法：

```
div.appendChild(document.createElement('br')); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T18:50:03.903

您发布的代码在 IE7 和 Firefox 中运行良好 - 一定有什么东西在`/* ... */`破坏它。

# c++ - snprintf 格式字符串安全漏洞问题

> ID：631661
> 
> 赞同：6
> 
> 时间：2009-03-10T18:31:03.870
> 
> 标签：c++, c, security, printf

我们对这行代码有一个 Coverity 错误：

```
snprintf( tempStr, size, testStrings[testID], A2DtoV(testResults[testID].value),
A2DtoV(testResults[testID].min),A2DtoV(testResults[testID].max)); 
```

错误说：

```
non_const_printf_format_string: "format string is not a string literal, 
potential security vulnerability if user controlled" 
```

我将 testStrings 更改为 const，但这并没有做任何事情：

```
static const char *testStrings[] = {"1", ... etc}; 
```

关于这个错误的真正含义有什么想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-10T18:40:24.720

你的代码很好。

问题是，如果您将用户控制的字符串作为 printf 格式字符串传递，则可能会出现安全错误。

例如，`printf(userName);`

如果 userName 由用户提供，用户可以传递“%s”，并让您的函数开始访问堆栈上随机地址的数据，这可能会导致崩溃。printf 将尝试从堆栈中弹出其他参数，从而导致堆栈损坏。像这样的拒绝服务攻击可能是最好的情况，可以通过让 printf 将值转储到堆栈上来泄露信息，甚至还有一些方法可以让 printf 风格的函数修改堆栈上的返回地址。

由于您的字符串不是用户控制的，因此忽略此消息是安全的。典型的解决方法是用 替换我给出的 printf 示例`printf("%s", userName);`，这对您的情况似乎没有帮助，因为 const 字符串似乎包含格式字符串。

维基百科在这里有更多关于格式字符串漏洞的信息：[http ://en.wikipedia.org/wiki/Format_string_vulnerabilities](http://en.wikipedia.org/wiki/Format_string_vulnerabilities)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:38:41.497

想法是`testStrings[testID]`可以以某种方式更改的值以包含额外的格式说明符。

因为`snprintf()`无法检查参数的数量是否与格式说明符的数量匹配，所以它只会从堆栈中获取下一个地址作为下一个格式说明符的值，然后可能会发生奇怪的事情。

它被称为[格式字符串攻击](http://en.wikipedia.org/wiki/Format_string_attack)。

# c++ - 在 C++ 中访问环境变量

> ID：631664
> 
> 赞同：88
> 
> 时间：2009-03-10T18:31:46.723
> 
> 标签：c++, environment-variables

我想访问`$HOME`我正在编写的 C++ 程序中的环境变量。如果我用 C 编写代码，我只会使用该`getenv()`函数，但我想知道是否有更好的方法来做到这一点。这是我到目前为止的代码：

```
std::string get_env_var( std::string const & key ) {                                 
    char * val;                                                                        
    val = getenv( key.c_str() );                                                       
    std::string retval = "";                                                           
    if (val != NULL) {                                                                 
        retval = val;                                                                    
    }                                                                                  
    return retval;                                                                        
} 
```

我应该使用`getenv()`C++ 访问环境变量吗？有没有一些我可能遇到的问题，我可以通过一点知识来避免？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-03-10T18:45:44.600

`getenv()`在 C++ 中使用没有错。它由 定义`stdlib.h`，或者如果您更喜欢标准库实现，您可以通过命名空间（即）包含`cstdlib`和访问该函数。这绝对没有错。实际上，如果您关心可移植性，则首选这两个版本中的任何一个。`std::``std::getenv()`

如果您*不*关心可移植性并且正在使用托管 C++，则可以使用 .NET 等效项 - [`System::Environment::GetEnvironmentVariable()`](http://msdn.microsoft.com/en-us/library/system.environment.getenvironmentvariable.aspx). 如果您想要 Windows 的非 .NET 等效项，您可以简单地使用[`GetEnvironmentVariable()`](http://msdn.microsoft.com/en-us/library/ms683188(VS.85).aspx)Win32 函数。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-03-23T05:30:25.707

我会稍微重构一下代码：

```
std::string getEnvVar( std::string const & key ) const
{
    char * val = getenv( key.c_str() );
    return val == NULL ? std::string("") : std::string(val);
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-10T18:44:08.520

*   如果您在 Windows 上，您可以使用 Win32 API [GetEnvironmentVariable](http://msdn.microsoft.com/en-us/library/ms683188.aspx)
*   在其他基于 linux/unix 的系统上使用[getenv](http://www.manpagez.com/man/3/getenv/)

为什么在 Windows 中使用 GetEnvironmentVariable，[来自 MSDN getenv](http://msdn.microsoft.com/en-us/library/tehxacec.aspx)：

> getenv 仅对运行时库可访问的数据结构进行操作，而不对操作系统为进程创建的环境“段”进行操作。因此，对 main 或 wmain 使用 envp 参数的程序可能会检索到无效信息。

并[来自 MSDN GetEnvironment](http://msdn.microsoft.com/en-us/library/ms683188.aspx)：

> 此函数可以检索系统环境变量或用户环境变量。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-10T18:39:45.800

在 c++ 中，您必须使用 std::getenv 和`#include <cstdlib>`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-08-11T14:25:12.383

@Vlad's answer的一个版本，带有一些错误检查，可以区分空值和缺失值：

```
inline std::string get_env(const char* key) {
    if (key == nullptr) {
        throw std::invalid_argument("Null pointer passed as environment variable name");
    }
    if (*key == '\0') {
        throw std::invalid_argument("Value requested for the empty-name environment variable");
    }
    const char* ev_val = getenv(key);
    if (ev_val == nullptr) {
        throw std::runtime_error("Environment variable not defined");
    }
    return std::string(ev_val);
} 
```

笔记：

*   您还可以将上述异常的使用替换为`std::optional<std::string>`或者，在将来，替换为[`std::expected`](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0323r7.html)（如果最终被标准化）。
*   我在这里选择了安全性而不是信息性，而不是将密钥连接到异常的字符串中。如果您做出替代选择，请尝试将复制限制`key`在合理范围内（例如 100 个字符？200 个字符？），我还会检查这些字符是否可打印，并[清理](https://stackoverflow.com/questions/34221156/c-sanitize-string-function)这些字符。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-01-31T09:00:58.340

是的，我知道这是一个旧线程！
尽管如此，***根据定义***，常见错误并不新鲜。:-)

我看到的不只是使用 std::getenv() 的唯一原因是添加**已知默认值或在****框架**中采用通用模式/API 。在这种情况下，我也会避免异常（尽管通常不是这样），因为非值返回通常足以对环境变量进行有效响应。增加处理异常的复杂性是***违反直觉的***。

这基本上是我使用的：

```
const char* GetEnv( const char* tag, const char* def=nullptr ) noexcept {
  const char* ret = std::getenv(tag);
  return ret ? ret : def; 
}

int main() {
  int ret=0;
  if( GetEnv("DEBUG_LOG") )  {
    // Setup debug-logging
  } else {
     ...
  }
  return (-1==ret?errno:0);
} 
```

这个和其他答案之间的差异可能看起来很小，但我发现当你养成编码习惯时，这些小细节是非常有益的。

就像 getenv() 返回一个***非常量***指针一样，这很容易导致坏习惯！

# javascript - 有没有办法尝试在 HTML/JavaScript 中加载文件并在未加载时进行后备？

> ID：631671
> 
> 赞同：0
> 
> 时间：2009-03-10T18:33:47.950
> 
> 标签：javascript, html

我刚刚切换到开始为我的站点使用 CDN 来存储外部图像/静态文件，我想知道如何构建备份以防这个 CDN 失败。有没有办法引用 HTML/JavaScript 文件中的外部链接，如果该文件在第一个外部主机中不可用，您可以为该文件指定一个后备位置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-11T03:53:19.760

第一个答案可能不适用于所有浏览器。您可以让 some/remote/script.js 设置一些变量“loaded=true”，然后在下一个脚本块中检查它。

```
<script>
loaded=false
</script>
<script src="some/remote/script.js"></script>
<script>
if(loaded==false){
  //do what you want here if it didn't load
}
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-27T20:09:59.297

这里有一篇很好的文章：http: [//happyworm.com/blog/2010/01/28/a-simple-and-robust-cdn-failover-for-jquery-14-in-one-line/](http://happyworm.com/blog/2010/01/28/a-simple-and-robust-cdn-failover-for-jquery-14-in-one-line/)

在使用 Microsoft Ajax CDN 获取 jquery 的站点上，这对我来说非常方便。当我们在 HTTPS 页面上使用 jquery 时，我们有一些客户的机器不信任来自 CDN 的 SSL 证书。本地回退是解决该问题的好方法。

我们通过检查脚本将添加到全局命名空间中的变量来确定是否注入回退。例如

```
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js">    </script>
<script type="text/javascript">
//<![CDATA[
if (typeof jQuery == 'undefined') {document.write(unescape("%3Cscript src='/Scripts/jquery.min.js' type='text/javascript' %3E%3C/script%3E"));}
//]]>
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:51:47.737

（**编辑：第一次尝试是错误的**）

```
<script src="some/remote/script.js">
    // Set a flag in the above script
</script>
<script>
    if ( ! flag ) {
        // This code runs if script.js fails to load for some reason
    }
</script>

<object data="http://cdn/file.png" type="image/png">
    <!-- You can nest objects in here too -->
    <img src="http://local/file.png" alt="Fallback Image"/>
</object> 
```

所以我想你可以对所有事情都使用脚本方法；如果远程文件无法加载，请使用回退代码更改所有路径以指向您的备份服务器。

# javascript - Javascript IE7：预期对象

> ID：631674
> 
> 赞同：2
> 
> 时间：2009-03-10T18:34:40.803
> 
> 标签：javascript, html, internet-explorer, internet-explorer-7

我在 IE7 中的脚本上的第 1 行字符 1（无论它在哪里）出现错误“Object Expected”。它在 Firefox 中运行良好，并且错误控制台不打印任何内容。

我尝试了多种方法来调用我的函数，但没有一个有效：

```
<a href="javascript:doit()">Turingmaschine starten</a>
<a href="#" onclick="doit()">Turingmaschine starten</a> 
```

可能是什么问题呢？

```
<script type="text/javascript" language="JavaScript">

var state;
var index;
var program;
var data;

const S=0;
const X=1;
const S2=2;
const X2=3;
const M=4;
const E="SE";

function doit()
{
    state=document.getElementById("stat").value;
    program = document.getElementById("prog").value.split("\n");
    index = document.getElementById("dat").value.indexOf("Z")>>1;
    data = document.getElementById("dat").value.replace(/Z,/, "").split(",");

    for (var i = 0; i<program.length; i++)
    {
        program[i]=program[i].split(",");
    }

    while(state!=E)
    {
        var i;
        for (i = 0; i<program.length; i++)
        {
            if (program[i][S]==state && program[i][X]==data[index])
            {
                state = program[i][S2];
                data[index] = program[i][X2]
                index+= parseInt(program[i][M]);

                data.splice(index,0,"Z");

                if (data[data.length-1]!="*")
                {
                    data.push("*");
                }
                if (data[0]!="*")
                {
                    data.unshift("*");
                    index++;
                }
                document.getElementById("out").value+=state+": "+data+"\r\n";

                data.splice(index,1);

                break;
            }
        }

        if (i==program.length)
            break;
    }

    document.getElementById("out").value+="Done.\r\n";
}

</script> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T18:41:51.113

`Const`IE 不支持。它特定于 Firefox 和 Opera 9.0+。此外，如果您发布此代码的用途，也许我们可以帮助重构它。

[https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Statements/const#Description](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Statements/const#Description)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T18:19:35.900

我有一个类似的问题，我所做的只是改变：

```
<script language="javascript" type="application/javascript" src="abc.js"></script> 
```

对此：

```
<script language="javascript" src="abc.js"></script> 
```

所以只是删除`type="application/javascript"`了一部分。

干杯

# c# - ThreadSafe 字典...键值对可枚举？（。网）

> ID：631678
> 
> 赞同：0
> 
> 时间：2009-03-10T18:36:05.777
> 
> 标签：c#, dictionary

我正在阅读（考虑编写我自己的线程安全字典）我发现了以下实现。

[http://devplanet.com/blogs/brianr/archive/2008/09/26/thread-safe-dictionary-in-net.aspx](http://devplanet.com/blogs/brianr/archive/2008/09/26/thread-safe-dictionary-in-net.aspx)

总的来说，它看起来不错，但有一件事让我感到困惑。

以下内容： 无法枚举线程安全字典。相反，枚举键或值集合

在这两个中都可以找到

```
public virtual IEnumerator<KeyValuePair<TKey, TValue>> GetEnumerator()
{
    throw new NotSupportedException("Cannot enumerate a threadsafe dictionary.  Instead, enumerate the keys or values collection");
}

IEnumerator IEnumerable.GetEnumerator()
{
    throw new NotSupportedException("Cannot enumerate a threadsafe dictionary.  Instead, enumerate the keys or values collection");
} 
```

我不明白为什么可以枚举键或值，而不是字典的kvp？

有人可以为我解释一下吗？提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T18:42:01.830

SO 用户和 MS 员工[JaredPar](https://stackoverflow.com/users/23283/jaredpar)在他的博客上有一个关于构建绝对值得您花时间的线程安全集合的简短系列：

*   [为什么线程安全的集合这么难？](http://blogs.msdn.com/jaredpar/archive/2009/02/11/why-are-thread-safe-collections-so-hard.aspx)
*   [用于可变线程安全集合的更有用的 API](http://blogs.msdn.com/jaredpar/archive/2009/02/16/a-more-usable-thread-safe-collection.aspx)

**[更新：]**
再次阅读它们，如果你没有时间，第二篇文章可能会独立存在。

总而言之：您发现在线发布的大多数“线程安全”集合通常不是很有用，或者一次只有一个线程安全操作，这使得“决策”成员喜欢`.Count`或`.Contains`无用（它们在下一行时已经“陈旧”了代码运行）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T13:48:56.450

I can answer that question directly, since I wrote that dictionary :)

Obtaining an enumerator on the dictionary will get a reference to the internal KVP sets. You would have to hold the read lock until you are done enumerating, which could be a long while.

The reason I say to enumerate the keys or values instead, is that I **copy** the list of keys and values when it is requested, therefore I am not returning a reference to the dictionaries internal list, which if you altered out of lock, could cause issues. Although, I suppose you could implement the same pattern on the KVP's as well if you wanted since they are read only.

```
 public virtual ICollection<TKey> Keys
    {
        get
        {
            using (new ReadOnlyLock(this.dictionaryLock))
            {
                return new List<TKey>(this.dict.Keys);
            }
        }
    }

    public virtual ICollection<TValue> Values
    {
        get
        {
            using (new ReadOnlyLock(this.dictionaryLock))
            {
                return new List<TValue>(this.dict.Values);
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:42:03.890

当您枚举 KVP 的集合时，您将进入和退出整个字典的锁定。因此，在您的枚举的循环体中，您并未处于锁定状态，更改 KVP 可能会导致竞争条件。

# .net - 如何根据其命名空间正确命名一个类？

> ID：631680
> 
> 赞同：0
> 
> 时间：2009-03-10T18:36:08.680
> 
> 标签：.net, class, naming-conventions, namespaces

人们经常可以看到类名带有对其所属命名空间的引用。最流行的示例之一是 .NET 的“Xml”命名空间，其中定义的每个类都以“Xml”标记为前缀。

这对我来说似乎一直是多余的，但最近我意识到在某些情况下它可能有用......但仍然是多余的。

我想知道人们实际上是如何处理这个问题的。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T18:42:22.783

我采取“在适当的时候”的方法。这个想法是您希望使用最有意义的名称来命名您的类。在某些情况下，这确实意味着类名与命名空间有些冗余，但请记住，命名空间通常不被视为代码中类名的一部分，而是作为 using 指令的一部分。

命名空间用于在逻辑上将相关类等分组在一起，以帮助开发人员找到正确的类并帮助最大限度地减少名称冲突的机会。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T18:44:42.747

我倾向于遵从[微软](http://msdn.microsoft.com/en-us/library/ms229002.aspx)在命名问题上的指导。

* * *

回复：斯科特的评论。

我认为 MS 在这个问题上非常清楚，这类似于您对 OP 的回复。例如：

> 不要引入通用类型名称，例如 Element、Node、Log 和 Message。在常见情况下，它很可能会导致类型名称冲突。您应该限定通用类型名称（FormElement、XmlNode EventLog、SoapMessage）。

在 OP 的问题中，引用了 Xml 命名空间。如果您查看其中那些类的名称，它们是非常常见的名称，没有附加在它们前面的“Xml”——属性、字典、文档等。

无论如何，就像我说的，我尝试遵循他们的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T19:51:46.453

我喜欢 System.Xml 类具有 Xml 前缀。它帮助我将它们与通用对应物区分开来。什么是文档与 XmlDocument？加上前缀就更清楚了。在我看来，无论如何。

In my own classes, I try to follow this spirit. If I'm taking a somewhat generic word and wrapping it in my class, I may choose to use the namespace as a prefix. For example:

`MyProject.Client.Application` will collide with `Application`, which is a .NET class.

`MyProject.Client.ClientApplication` will avoid collision problems while still remaining clear as to what the class does (at least, in terms of my project).

# java - java中的包帮助 - 导入不起作用

> ID：631682
> 
> 赞同：33
> 
> 时间：2009-03-10T18:36:51.127
> 
> 标签：java, import, packages

我是 C++ 开发人员 - 不是 Java 开发人员，但必须让这段代码工作......

我有 2 个公共课程将被另一个产品使用。我在每个 java 文件中都使用了 package 指令。

```
package com.company.thing;

class MyClass ... 
```

当我尝试编译使用我添加的测试应用程序时

```
import com.company.thing.*; 
```

javac 编译器失败，出现关于 com.company 的错误不存在。（即使我将它编译在与我刚刚打包的类文件相同的目录中）

我确信我正在做一些愚蠢而愚蠢的事情。

我已经阅读了[http://java.sun.com/docs/books/tutorial/java/package/usepkgs.html](http://java.sun.com/docs/books/tutorial/java/package/usepkgs.html)页面并尝试设置一个目录结构，如 /com/company/thing 等，但要么我有完全搞砸了，或者我错过了其他东西。

编辑感谢您的建议-我以前尝试过类路径。它没有帮助。

我尝试编译

```
javac -classpath <parent> client.java 
```

结果是：

```
package com.company does not exist 
```

我在 \com\company\product 中有要导入的代码（两个 java 文件）。我编译的很好。（它们包含 MyClass）我什至为它们制作了一个 jar 文件。我将 jar 文件复制到父目录。

然后我做了（在带有客户端java文件的父目录中）

```
javac -cp <jarfile> *.java 
```

结果是：

```
cannot access MyClass
bad class file: MyClass.class(:MyClass.class)
class file contains wrong class: com.company.product.MyClass
Please remove or make sure it appears in the correct subdirectory of the classpath. 
```

编辑

如果我使用 MyClass 的完全限定名称并在父目录中编译它，我可以编译和运行客户端代码。我现在完全糊涂了。

编译时没有设置类路径 - 只是

```
javac *.java 
```

在父目录中 - 它工作正常。

我可以编译一个测试应用程序，但是当我必须将它集成到生产代码中时，这不会削减它。还在寻求帮助。

编辑：

最后 - 不知道为什么它以前不起作用 - 但我清理了整个目录结构中的所有文件，现在它可以工作了。

谢谢

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-10T19:48:55.197

好的，只是为了澄清已经发布的内容。

你应该有目录`com`，包含目录`company`，包含目录`example`，包含文件`MyClass.java`。

从包含 的文件夹中`com`，运行：

```
$ javac com\company\example\MyClass.java

```

然后：

```
$ java com.company.example.MyClass
我的班级你好！

```

这些都必须从源代码树的根目录完成。否则，`javac`将`java`无法找到任何其他包（实际上，`java`甚至无法运行`MyClass`）。

### 一个简短的例子

我创建了文件夹“testpackage”和“testpackage2”。在 testpackage 中，我创建了包含以下代码的 TestPackageClass.java：

```
package testpackage;

import testpackage2.MyClass;

public class TestPackageClass {
    public static void main(String[] args) {
        System.out.println("Hello from testpackage.TestPackageClass!");
        System.out.println("Now accessing " + MyClass.NAME);
    }
} 
```

在 testpackage2 中，我创建了包含以下代码的 MyClass.java：

```
package testpackage2;
public class MyClass {
    public static String NAME = "testpackage2.MyClass";
} 
```

从包含两个新文件夹的目录中，我运行：

```
C:\examples>javac 测试包\*.java

C:\examples>javac testpackage2\*.java

```

然后：

```
C:\examples>java testpackage.TestPackageClass
您好，来自 testpackage.TestPackageClass！
现在访问 testpackage2.MyClass

```

这会让事情变得更清楚吗？

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-10T18:41:40.460

是的，这是一个类路径问题。您需要告诉编译器和运行时您的 .class 文件所在的目录是 CLASSPATH 的一部分。您需要添加的目录是包结构开头的“com”目录的父目录。

您可以使用 javac.exe 和 java.exe 的 -classpath 参数来执行此操作。

还应该询问您使用的 3rd 方类是如何打包的。如果它们在 JAR 中，并且我建议您将它们合二为一，则将 .jar 文件添加到类路径中：

```
java -classpath .;company.jar foo.bar.baz.YourClass 
```

谷歌搜索“Java 类路径”。它会找到这样[的](http://www.kevinboone.com/classpath.html)链接。

还有一件事：“导入”没有加载类。它所做的一切都是为了节省您的打字时间。当您包含导入语句时，您不必在代码中使用完全解析的类名 - 您可以键入“Foo”而不是“com.company.thing.Foo”。这就是它所做的一切。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T18:41:27.573

听起来您的目录结构走在了正确的轨道上。编译依赖代码时，`-classpath`指定`javac`. 使用目录的父目录*，*`com`其中`com`又包含`company/thing/YourClass.class`

所以，当你这样做时：

```
javac -classpath <parent> client.java 
```

`<parent>`应该指的是 的父级`com`。如果你在`com`，那就是`../`。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-10T18:49:39.690

你得到了一堆很好的答案，所以我只是提出一个建议。如果您要在这个项目上工作超过 2 天，请下载 eclipse 或 netbeans 并在其中构建您的项目。

如果您通常不是 java 程序员，那么它将给您的帮助将是无价的。

如果您只花费 2 小时，那么 1/2 小时的下载/安装是不值得的。

两者都有“修复导入”的热键/菜单项，这样您就不必再担心导入了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T19:30:27.380

标准的 Java 类加载器是目录结构的坚持者。类路径中的每个条目都是一个目录或 jar 文件（实际上是 zip 文件），然后它会搜索给定的类文件。例如，如果您的类路径是“.;my.jar”，它将在以下位置搜索 com.example.Foo：

```
./com/example/
my.jar:/com/example/ 
```

也就是说，它将在具有包的“修改名称”的子目录中查找，其中“。” 替换为文件分隔符。

此外，值得注意的是，您不能嵌套 .jar 文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-10T10:00:44.537

只需在系统变量和用户变量菜单下添加类路径条目（我的意思是您的父目录位置）...遵循：右键单击我的电脑>属性>高级>环境变量

# asp.net - 网站连接问题

> ID：631684
> 
> 赞同：0
> 
> 时间：2009-03-10T18:37:09.003
> 
> 标签：asp.net, traceroute

我们让人们抱怨我们的网站加载缓慢。它位于带宽相当不错的本地 ISP 处。但最近我收到了很多客户端断开连接的错误。

我将 ping 添加到错误日志中，以便我可以查看生成客户端断开连接错误的人的响应时间。其中大多数都提出了超时。我正在考虑分拆一个线程来执行 traceRoute 并将结果通过电子邮件发送给我。

做到这一点的最佳方法最有可能将该部分构建为一个小型独立应用程序吗？有没有办法在我的 asp.net 应用程序中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T18:44:44.757

你得到 ping 超时？如果是这种情况，请向 ISP 发送报告。这真的不应该发生，他们可能不得不最终解决它。它可以是像片状电缆一样简单的东西......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T18:43:04.013

您需要的是众多网站监控服务之一。只需谷歌搜索“网站监控服务跟踪路由”。

[当您的站点关闭并且有些站点（例如http://www.websitepulse.com/services/website.monitoring.php](http://www.websitepulse.com/services/website.monitoring.php)）在报告中还包含跟踪路由时，您会收到一封电子邮件通知。

使用其中一项服务的另一个优势是，您的站点正受到来自世界各地的监控，因此如果您的 ISP 运行多个冗余主干，其中大部分仍应被覆盖。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:46:05.083

我不确定是否有在 .net 中调用 tracert 的本机方式，但您总是可以点击 cmd 提示符：

```
Process process = new Process();
process.StartInfo.FileName = "tracert.exe";
process.StartInfo.Arguments = "who you are trying to tracert";
process.Start(); 
```

...我相当肯定，只要应用程序能够执行，它就会起作用

# java - 当数据正确显示时，为什么我在这个 Spring MVC Web 应用程序中得到一个 Hibernate LazyInitializationException？

> ID：631695
> 
> 赞同：11
> 
> 时间：2009-03-10T18:39:42.803
> 
> 标签：java, hibernate, spring, web-applications, netbeans

我正在尝试使用 Spring MVC 创建一个 Web 应用程序，并将 Hibernate 作为其 ORM 层。但是，由于我对这两个框架都缺乏经验，我正在苦苦挣扎。

以下代码将正确显示我正在寻找的所有记录，但仍会在我的日志中抛出堆栈跟踪。我很难找到有关集成 Hibernate 和 SpringMVC 的完整文档（我查看了 springsource.org 并阅读了互联网上的各种文章）。谁能指出我在这里做错了什么？

请注意，我花了一些时间试图在互联网上寻找答案，包括查看[这个](https://stackoverflow.com/questions/345705/hibernate-lazyinitializationexception-could-not-initialize-proxy)SO question。不幸的是，这没有帮助。

我还应该注意到，这个应用程序的 ORM 部分已经在一个独立的 Java 应用程序中使用和测试，没有任何问题。所以我相信 Spring MVC 和 Hibernate 的集成导致了这个问题。

这是著名的延迟初始化问题的堆栈跟踪（截断）；

```
2009-03-10 12:14:50,353 [http-8084-6] ERROR org.hibernate.LazyInitializationException.<init>(LazyInitializationException.java:19) - could not initialize proxy - no Session
org.hibernate.LazyInitializationException: could not initialize proxy - no Session
    at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:57)
    at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:111)
    at org.hibernate.proxy.pojo.cglib.CGLIBLazyInitializer.invoke(CGLIBLazyInitializer.java:150)
    at com.generic.orm.generated.SearchRule$$EnhancerByCGLIB$$92abaed6.toString(<generated>)
    at java.lang.String.valueOf(String.java:2827)
    at java.lang.StringBuffer.append(StringBuffer.java:219)
    at org.apache.commons.lang.builder.ToStringStyle.appendDetail(ToStringStyle.java:578)
    at org.apache.commons.lang.builder.ToStringStyle.appendInternal(ToStringStyle.java:542)
    at org.apache.commons.lang.builder.ToStringStyle.append(ToStringStyle.java:428)
    at org.apache.commons.lang.builder.ToStringBuilder.append(ToStringBuilder.java:840)
    at org.apache.commons.lang.builder.ReflectionToStringBuilder.appendFieldsIn(ReflectionToStringBuilder.java:606)
..... 
```

这是我的网页控制器的代码；

```
private List<Report> getReports() {
    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    List<Report> reports = session.createCriteria(Report.class).list();
    Hibernate.initialize(reports);

    session.getTransaction().commit();
    return reports;
} 
```

在使用此显示 html 的网页上使用哪个；

```
<table border="1">
    <c:forEach items="${model.reports}" var="report">
        <tr>
            <td><c:out value="${report.id}"/></td>
            <td><c:out value="${report.username}"/></td>
            <td><c:out value="${report.thresholdMet}"/></td>
            <td><c:out value="${report.results}"/></td>
            <td><c:out value="${report.searchRule.name}"/></td>
            <td><c:out value="${report.uuid}"/></td>
        </tr>
    </c:forEach>
</table> 
```

注意：我添加了 report.searchRule.name 以测试是否可以获取报告对象中的对象。它显示正常。

在我的 applicationContext.xml 中；

```
<bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
    <property name="configLocation">
        <value>classpath:hibernate.cfg.xml</value>
    </property>
    <property name="hibernateProperties">
        <props>
            <prop key="hibernate.dialect">${hibernate.dialect}</prop>
        </props>
    </property>
</bean> 
```

以下是 ORM 映射，以防万一；

hibernate.cfg.xml（根据要求）

```
<hibernate-configuration>
  <session-factory>
    <property name="hibernate.connection.driver_class">com.microsoft.sqlserver.jdbc.SQLServerDriver</property>
    <property name="hibernate.connection.url">jdbc:sqlserver://<removed></property>
    <property name="hibernate.connection.username"><removed></property>
    <property name="hibernate.connection.password"><removed></property>
    <property name="hibernate.current_session_context_class">thread</property>
    <property name="hibernate.show_sql">false</property>
    <mapping resource="com/generic/orm/generated/Report.hbm.xml"/>
    <mapping resource="com/generic/orm/generated/FieldRule.hbm.xml"/>
    <mapping resource="com/generic/orm/generated/Reconciliation.hbm.xml"/>
    <mapping resource="com/generic/orm/generated/SearchRule.hbm.xml"/>
    <mapping resource="com/generic/orm/generated/IndexTemplate.hbm.xml"/>
    <mapping resource="com/generic/orm/generated/Field.hbm.xml"/>
    <mapping resource="com/generic/orm/generated/ErrorCode.hbm.xml"/>
  </session-factory>
</hibernate-configuration> 
```

来自report.hbm.xml

```
<hibernate-mapping>
    <class name="com.generic.orm.generated.Report" table="Report" schema="dbo" catalog="CoolRecon">
        <id name="id" type="int">
            <column name="ID" />
            <generator class="native" />
        </id>
        <timestamp name="timeStamp" column="TimeStamp" />
        <many-to-one name="searchRule" class="com.generic.orm.generated.SearchRule" fetch="select">
            <column name="SearchRuleName" length="50" not-null="true" />
        </many-to-one>
        <many-to-one name="errorCode" class="com.generic.orm.generated.ErrorCode" fetch="select">
            <column name="ErrorCodeId" />
        </many-to-one>
        <many-to-one name="reconciliation" class="com.generic.orm.generated.Reconciliation" fetch="select">
            <column name="ReconciliationName" length="100" />
        </many-to-one>
        <property name="username" type="string">
            <column name="Username" length="50" />
        </property>
        <property name="supersheetDate" type="timestamp">
            <column name="SupersheetDate" length="23" not-null="true" />
        </property>
        <property name="milliSecondsTaken" type="long">
            <column name="MilliSecondsTaken" not-null="true" />
        </property>
        <property name="thresholdMet" type="boolean">
            <column name="ThresholdMet" not-null="true" />
        </property>
        <property name="results" type="int">
            <column name="Results" not-null="true" />
        </property>
        <property name="exception" type="string">
            <column name="Exception" length="750" />
        </property>
        <property name="uuid" type="string">
            <column name="UUID" length="36" not-null="true" />
        </property>
    </class>
</hibernate-mapping> 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-11T02:23:23.063

我刚刚经历了这个 LazyInitialization 马拉松。

核心问题是您试图在 的生命周期之外访问休眠管理的实体`Session`，即在 Spring MVC 的 Web 视图中。就我而言，这是一个`List<>` `@OneToMany`关联，默认情况下会延迟加载。

有几种不同的方法——Mark 提到了一种方法，您可以在其中对惰性关联进行“虚拟”迭代。您还可以通过配置（类范围）（在 JPA 中是这样`@Fetch(value = FetchType.EAGER)`）或更具体地通过 HQL 强制预加载。但是[如果你的懒惰联想是`Lists`](http://jroller.com/eyallupu/entry/hibernate_exception_simultaneously_fetch_multiple).

我找到的最干净的解决方案是使用 Spring [`OpenEntityManagerInViewFilter`](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/orm/jpa/support/OpenEntityManagerInViewFilter.html)（有一个`OpenSessionInViewFilter`用于 Hibernate）——一个简单的 servlet 过滤器`web.xml`（在其他 servlet 过滤器之前），Spring 将自动创建一个线程安全、事务感知的`Session` *per-HTTP -请求*。没有了`LazyInitializationException`！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-10T21:58:03.997

我只是在猜测，但从堆栈跟踪来看，似乎在 SearchRule 上调用了 toString。SearchRule 是否有任何可能尚未加载的子对象？如果 SearchRule.toString 试图获取可能导致 LazyInitializationException 的未初始化子对象的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T21:46:52.683

Hibernate.initialize(list) 调用不会初始化集合中引用的目标实体对象。您需要遍历报告并初始化每个单独的对象。初始化报告的调用将代理集合转换为报告代理的具体集合。试试下面的代码：

```
for(Report r : reports)
   Hibernate.initialize(r); 
```

`lazy="false"`钝斧方法是通过添加到您的 hbm 类来关闭延迟加载。如果每次检索到整个对象时总是迭代整个对象（进行初始化步骤 OBE），这可能是有意义的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-11T12:43:04.510

好吧，我是个白痴。我的问题是我浏览了堆栈跟踪但并没有真正阅读它。这是完整的堆栈跟踪（或其中之一，我的日志中显示了 3 个略有不同的版本）。

```
org.hibernate.LazyInitializationException: could not initialize proxy - no Session
    at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:57)
    at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:111)
    at org.hibernate.proxy.pojo.cglib.CGLIBLazyInitializer.invoke(CGLIBLazyInitializer.java:150)
    at com.generic.orm.generated.SearchRule$$EnhancerByCGLIB$$de674d10.toString(<generated>)
    at java.lang.String.valueOf(String.java:2827)
    at java.lang.StringBuffer.append(StringBuffer.java:219)
    at org.apache.commons.lang.builder.ToStringStyle.appendDetail(ToStringStyle.java:578)
    at org.apache.commons.lang.builder.ToStringStyle.appendInternal(ToStringStyle.java:542)
    at org.apache.commons.lang.builder.ToStringStyle.append(ToStringStyle.java:428)
    at org.apache.commons.lang.builder.ToStringBuilder.append(ToStringBuilder.java:840)
    at org.apache.commons.lang.builder.ReflectionToStringBuilder.appendFieldsIn(ReflectionToStringBuilder.java:606)
    at org.apache.commons.lang.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:759)
    at org.apache.commons.lang.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:287)
    at org.apache.commons.lang.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:121)
    at com.generic.orm.generated.Report.toString(Report.java:141)
    at java.lang.String.valueOf(String.java:2827)
    at java.lang.StringBuilder.append(StringBuilder.java:115)
    at java.util.AbstractCollection.toString(AbstractCollection.java:422)
    at java.lang.String.valueOf(String.java:2827)
    at java.lang.StringBuilder.append(StringBuilder.java:115)
    at java.util.AbstractMap.toString(AbstractMap.java:490)
    at org.netbeans.modules.web.monitor.server.MonitorFilter.recordRequestAttributes(MonitorFilter.java:1376)
    at org.netbeans.modules.web.monitor.server.MonitorFilter.recordRequestData(MonitorFilter.java:1184)
    at org.netbeans.modules.web.monitor.server.MonitorFilter.getDataBefore(MonitorFilter.java:803)
    at org.netbeans.modules.web.monitor.server.MonitorFilter.doFilter(MonitorFilter.java:361)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:630)
    at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:436)
    at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:374)
    at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:302)
    at org.springframework.web.servlet.view.InternalResourceView.renderMergedOutputModel(InternalResourceView.java:167)
    at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:239)
    at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1158)
    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:900)
    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:808)
    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:476)
    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:431)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.netbeans.modules.web.monitor.server.MonitorFilter.doFilter(MonitorFilter.java:390)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)
    at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)
    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)
    at java.lang.Thread.run(Thread.java:619) 
```

Netbeans 显然在做某种服务器端监控，它调用 toString，因为 toString 调用的东西没有正确初始化，所以这很奇怪。所以我的问题是双重的，基于反射的 ToString 对于休眠 pojos 来说似乎是一个坏主意，而 Netbeans 正在通过尝试观察它来改变我的运行时行为。

感谢大家的帮助，我想我只是太仔细地研究这个问题太久了，需要退后一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-12T13:11:47.397

> @PersistenceContext(type=PersistenceContextType.EXTENDED)

是工作:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-09T09:26:59.757

实际上，有三种方法可以避免延迟初始化异常：

*   在映射文件中将惰性属性设置为 false。我不推荐这种方法，因为它会增加数据库负载，因此会降低性能。

*   保持会话打开。在处理数据之前不要关闭会话。如果会话在请求期间打开，您可以获得关联的图表，但您需要确保该操作在同一事务中执行。

*   急切地获取关联。在 HQL 查询中使用关键字“fetch”来检索关联。从我的角度来看，这是避免延迟初始化问题的最佳解决方案。在 HQL 中，您只需在 from 子句中添加 fetch 关键字即可急切地获取关联。

这是一个例子：

```
from Doctor doc
left join fetch doc.patients
where doc.name like ‘Doctor A%’ 
```

我已经写了一篇关于这个问题的帖子，其中包含一些代码示例和 github 项目的链接：

[http://ignaciosuay.com/how-to-avoid-hibernate-lazy-initialization-exception/](http://ignaciosuay.com/how-to-avoid-hibernate-lazy-initialization-exception/)

# java - 将字符串编码为 Latin-1 时如何最小化问号？

> ID：631700
> 
> 赞同：1
> 
> 时间：2009-03-10T18:41:01.693
> 
> 标签：java

在将 java 字符串编码为 Latin-1（即字符集 ISO-8859-1）时，我目前在执行编码之前将德语符号 β ('\u03B2') 转换为 ß ('\u00DF')。我试图在可能的情况下避免编码中的问号。

任何人都可以建议可以替换可编码字符的其他不可编码字符吗？或者更好的是，一个为我做这件事的 Java 库？

更新：一些背景知识：我有一个 Java 程序，它将数据导出到 CSV 文件中，以便可以将它们读入第三方应用程序。一位客户抱怨某些字符没有被转换——他给了我“straβe”的例子。虽然从技术上讲 β 是 Beta 的希腊符号，但快速的谷歌搜索显示相当多的人用它来表示 ß。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T18:57:18.020

U+03B2 是希腊字母“beta”。U+00DF 是德语的“升 s”。真的不是一回事！如果你想要一个拉丁字符，字母 B 不是更适合 β 吗？关于您的场景或用例的一些背景知识将有助于指导合适的建议。

Unicode 中有成千上万个字形，其中只有少数可以用 Latin-1 编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:00:20.010

首先，您确定您的输入文本是否正确输入或编码？

u+03B2 是“希腊小写字母 BETA”，而不是德语 eszett。

u+00DF 是 eszett 或 "LATIN SMALL LETTER SHARP S"

Java 可以将后者映射到 ISO-8859-1，因为它在[http://unicode.org/Public/MAPPINGS/ISO8859/8859-1.TXT](http://unicode.org/Public/MAPPINGS/ISO8859/8859-1.TXT)中定义。

一般没有办法解决这个问题 - Unicode 的全部意义在于它包含（大量）根本无法用 ISO-8859-* 表示的字符。

[我建议生成数据中未在http://unicode.org/Public/MAPPINGS/ISO8859/8859-1.TXT](http://unicode.org/Public/MAPPINGS/ISO8859/8859-1.TXT)文档中列出的所有 unicode 字符的列表。然后对于每个未映射的字符，您必须通过手/眼从 ISO-8859-1 范围内选择适当的替换。

# c# - 如何在 .net c# 中显示消息框？

> ID：631714
> 
> 赞同：2
> 
> 时间：2009-03-10T18:43:15.573
> 
> 标签：c#, asp.net

我正在使用 asp.net c# 设计 Web 应用程序。我正在使用gridview控件。

在 gridview 我有添加，编辑和删除按钮

我有一个问题是任何人都知道当用户按下取消或更新或删除按钮时，按摩框将显示并询问“你想更新记录”并且选项是“是”和“否”，如果用户按下“是”则只记录保存其他明智的取消。

**

```
*****> At the time of user press "Cancel
> Update" i want to check if any data is
> changed give message "Data is changed
> Do you want to cancel it" Yes or no if
> press yes then cancel other wise stay
> there.. how it's possible becz is ajax
> extender ask all time the time***** 
```

**

在 Web 应用程序中怎么可能？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:20:54.967

我通过扩展 Button 控件采取了稍微不同的方法。只是更通用的目的。

```
<bo:LinkButton id="Button1" runat="server" ConfirmText="Delete?" />

public class LinkButton : System.Web.UI.WebControls.LinkButton
{
    [Bindable(true), Category("Behavior"), DefaultValue("")]
    public string AlertText
    {
        get { return (string)ViewState["AlertText"] ?? string.Empty; }
        set { ViewState["AlertText"] = value; }
    }

    [Bindable(true), Category("Behavior"), DefaultValue("")]
    public string ConfirmText
    {
        get { return (string)ViewState["ConfirmText"] ?? string.Empty; }
        set { ViewState["ConfirmText"] = value; }
    }

    protected override void CreateChildControls()
    {
        string script = string.Empty;

        if (AlertText.Length > 0)
        {
            script += string.Format("alert('{0}');", AlertText);
        }

        if (ConfirmText.Length > 0)
        {
            script += string.Format("return confirm('{0}');", ConfirmText);
        }

        if (script.Length > 0)
        {
            OnClientClick = script;
        }

        base.CreateChildControls();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T18:44:34.320

您可以使用 Ajax ASP.NET 扩展器进行按钮确认。

```
<TemplateColumn>
    <ItemTemplate>
      <asp:LinkButton id="lbDelete" runat="server" CommandName="Delete" Text="Delete"/>
      <cc1:ConfirmButtonExtender ID="cbeDelete" runat="server" 
          ConfirmText="Are you sure you want to delete this record?"
          TargetControlID="lbDelete" />
    </ItemTemplate>
    <ItemTemplate>
      <asp:LinkButton id="lbCancelUpdate" runat="server" CommandName="Cancel" Text="Cancel"/>
      <cc1:ConfirmButtonExtender ID="cbeCancel" runat="server" 
          ConfirmText="Are you sure you want to cancel any changes?"
          TargetControlID="lbCancelUpdate" />
    </ItemTemplate>
</TemplateColumn> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:45:52.307

在这些按钮的客户端脚本中，您想要执行类似的操作

```
if (confirm('Are you sure you want to delete this item'))
{
   //Do logic for delete item
} 
```

# 编辑

去把它放在你电脑上的一个 .html 文件中，然后在浏览器中打开它（如果它的 ie7 你会得到安全警告，只是允许它，从 url 启动时不会发生这种情况）：

```
<html>
<body>
<script>

if (confirm('You want to delete me?')
{
 alert('deleted');
}
</script>
</body>
</html> 
```

确认是一个函数；-)

# sql-server - 无法在 SQL Server 中使用用户定义函数在视图上创建索引

> ID：631715
> 
> 赞同：11
> 
> 时间：2009-03-10T18:43:29.800
> 
> 标签：sql-server, indexing, views, user-defined-functions

在 SQL Server 2005 中，我尝试在将用于全文索引的索引视图中使用用户定义函数。我已经能够让 UDF 与存储过程和有问题的视图一起使用。但是，当我尝试在视图上创建索引时，出现以下错误...

**无法在视图“DevDatabase.dbo.View_PersonSearch”上创建索引，因为视图引用的函数“dbo.GetCurrentImage”执行用户或系统数据访问。**

我被这件事难住了。下面是我正在尝试做的一个例子。我错过了什么，或者这甚至可能吗？

*用户定义函数*

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER FUNCTION [dbo].[GetCurrentImage](@Person_ID int) 
RETURNS int
WITH SCHEMABINDING
AS
BEGIN

    -- Declare the return variable here
    DECLARE @Img_ID int

    SET @Img_ID = (**sql that selects image** )

    RETURN @Img_ID

END
GO 
```

*使用索引创建查看*

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[View_PersonSearch]
WITH SCHEMABINDING
AS
    SELECT  Person_ID,
            (**Select fields to search on**) AS SearchArea,
            dbo.GetCurrentImage(Person_ID) AS FK_Img_ID
FROM    dbo.Person
GO

CREATE UNIQUE CLUSTERED INDEX Index_Person_ID ON [View_PersonSearch](Person_ID)
GO 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-10T18:48:06.857

根据[此页面](http://blog.sqlauthority.com/2007/04/28/sql-server-restrictions-of-views-t-sql-view-limitations/)：

> 索引视图中引用的任何函数都必须是确定性的；每次使用相同的参数调用确定性函数时，它们都会返回相同的值。

GetCurrentImage 的参数不是确定性的——它使用一个选择，这意味着结果可能会随着数据的变化而变化——所以任何使用它的视图都不能被索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-08-06T16:16:13.743

最近有一个文档：[https ://docs.microsoft.com/en-us/sql/relational-databases/views/create-indexed-views?view=sql-server-2016](https://docs.microsoft.com/en-us/sql/relational-databases/views/create-indexed-views?view=sql-server-2016)

在`Additional Requirements`它下面说：`The data access property of a user-defined function must be NO SQL, and external access property must be NO.`

您可以使用以下语句检查您的 UDF

```
 SELECT ObjectPropertyEx(Object_Id('dbo.GetCurrentImage'), N'IsDeterministic') AS deterministic, 
        ObjectPropertyEx(Object_Id('dbo.GetCurrentImage'), N'IsPrecise') AS precise, 
        ObjectPropertyEx(Object_Id('dbo.GetCurrentImage'), N'IsSystemVerified') AS verified, 
        ObjectPropertyEx(Object_Id('dbo.GetCurrentImage'), N'UserDataAccess') AS UserDataAccess,
        ObjectPropertyEx(Object_Id('dbo.GetCurrentImage'), N'SystemDataAccess') AS SystemDataAccess; 
```

前三个应该给出`1`，后两个必须是`0`在索引视图中使用的函数。

# django - django更新模型表单

> ID：631722
> 
> 赞同：1
> 
> 时间：2009-03-10T18:44:54.150
> 
> 标签：django, modelform

我有一个模型如下

```
class UserPrivacy(models.Model):
    user = models.ForeignKey(User)
    profile = models.SmallIntegerField(default=1, choices=PRIVACY_TYPE)
    contact = models.SmallIntegerField(default=1, choices=PRIVACY_TYPE)
    friends = models.SmallIntegerField(default=1, choices=PRIVACY_TYPE)
    location = models.SmallIntegerField(default=1, choices=PRIVACY_TYPE) 
```

我的模型如下

```
class PrivacyForm(ModelForm):
    class Meta:
        model = UserPrivacy
        exclude = ('user','location') 
```

我的函数看起来像这样来显示和更新表单。

```
def show_privacy(request):
    if not request.user.is_authenticated():
        return HttpResponseRedirect('/')

    if request.method == 'POST':
        form = PrivacyForm(request.POST, instance=User.objects.get(pk=request.session['id']))
        if form.is_valid():
            form.save()

    else:
        form = PrivacyForm()

    return render_to_response('settings_privacy.html', {'form': form}, context_instance=RequestContext(request)) 
```

我在数据库中的 user_id 是 1.. 但是当我发布表单时它永远不会更新。我知道 form.save() 被调用是因为在那里打印并显示在开发服务器中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T19:16:06.210

Andy Hume 在对您问题的评论中是正确的。

您有一个基于 UserPrivacy 模型的 ModelForm，但您正在向它传递一个 User 实例。

你想要做的是：

```
form = PrivacyForm(request.POST, instance=UserPrivacy.objects.get(user=request.user) 
```

# mysql - Sphinx：使用多个索引近似字符串排序的最佳方法是什么？

> ID：631729
> 
> 赞同：1
> 
> 时间：2009-03-10T18:45:47.877
> 
> 标签：mysql, search, sphinx

我正在使用[Sphinx](http://www.sphinxsearch.com)并希望实现字符串排序。我知道这可以使用属性和[String Ordinals](http://www.sphinxsearch.com/docs/current.html#attributes)来完成，但是，我还想实现[实时索引更新](http://www.sphinxsearch.com/docs/current.html#live-updates)，并且字符串序数不适用于多个索引。

使用多个索引近似字符串排序的最佳方法是什么？我正在考虑从字符串的前几个字母生成整数，例如：

```
select concat(ord('t'),ord('e'),ord('s')); 
```

将允许我将字符串“test”的前三个字符添加到整数属性（假设它将作为整数添加到 sphinx，即使它是 MySQL 中的字符串）。这会给我近似排序，这可能已经足够好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-12-30T20:27:14.663

我最终创建了一个将字符串转换为序数的 MySQL 函数：

```
CREATE DEFINER=`root`@`localhost` 
    FUNCTION `stringToOrd`(str varchar(100)) RETURNS int(11)
READS SQL DATA
DETERMINISTIC
SQL SECURITY INVOKER
BEGIN

    DECLARE ordinal INT;
    SELECT ((ORD(SUBSTRING(str,1,1)) * 16777216) 
        + (ORD(SUBSTRING(str,2,1)) * 65536)
        + (ORD(SUBSTRING(str,3,1)) * 256) + (ORD(SUBSTRING(str,4,1)))) 
        into ordinal;
    return ordinal;
END 
```

该函数仅使用字符串的前四个字符，因此排序将是近似的。在 sphinx 索引查询期间调用此函数（在 sphinx 配置文件中）。然后在 sphinx 搜索调用期间使用该属性进行排序。

这已经在生产环境中成功运行了 6 个多月。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-20T15:31:45.577

jonstjohn 的回答对我帮助很大！我使用了他的代码，但没有将其变成 UDF。我还将所有字符串都转换为大写，因此在按字母顺序排序时不会有任何奇怪：

所以结果是这样的：

(..)

sql_query =

选择 \

ID \

姓名 \

((ORD(SUBSTRING(UPPER(name),1,1)) * 16777216) \

*   (ORD(SUBSTRING(UPPER(name),2,1)) * 65536) \

*   (ORD(SUBSTRING(UPPER(name),3,1)) * 256) \

*   (ORD(SUBSTRING(UPPER(name),4,1)))) 作为 name_ord \

从 \

我的表

sql_attr_uint = name_ord

(..)

对于主索引和增量索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-24T14:33:36.147

请注意，例如 ord('&') 是 38 和 ord('a') 是 97 所以如果你的话是 [az][AZ] 没关系，但如果你有像 h&b 这样的东西，例如它会在 hub 之前

曼弗雷德

# c# - 正则表达式匹配 img 标签的 url

> ID：631733
> 
> 赞同：1
> 
> 时间：2009-03-10T18:46:32.647
> 
> 标签：c#, .net, regex

这个正则表达式：

```
<IMG\s([^"'>]+|'[^']*'|"[^"]*")+> 
```

给定此文本时似乎无休止地处理

```
<img src=http://www.blahblahblah.com/houses/Images/
    single_and_multi/roof/feb09/01_img_trrnjks_vol2009.jpg' /> 
```

我希望它 - 找不到匹配项（很快） - 因为文本中只有一个单引号。我在 C# 中也发生过这种情况，并且还使用了 Expresso 正则表达式工具。如果文本短得多，它似乎可以工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T18:53:39.870

```
<IMG\s([^"'>]+|'[^']*'|"[^"]*")+> 
```

取出几个分支，开始和结束：

```
([^"'>]+)+ 
```

这个匹配“你好”有多少种方式？

```
(hell)(o)
(hel)(lo)
(hel)(l)(o)
(he)(llo)
(he)(l)(lo)
(he)(l)(l)(o)
... and so on 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T18:54:38.260

听起来像是正则表达式引擎回溯很多的情况之一。Friedl 的 Mastering Regular Expressions 有一些关于这个主题的好材料。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:58:48.983

其他评论者提到复杂性是性能问题的可能原因。我要补充一点，如果你想匹配类似于 IMG 标签的东西，我认为你想要一个更像这样的正则表达式：

```
<IMG(\s+[a-z]+=('[^']*'|"[^"]*"|[^\s'">]+))+> 
```

当然，仍然存在此正则表达式无法捕获的有效 HTML 变体。就像`/`右括号（xhtml 中需要）或右括号前的空格一样。它会传递一些无效的情况，例如不受支持的属性名称。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:21:05.047

我认为这就是您所尝试的，我认为您长时间运行的原因正如其他地方所提到的那样，由于贪婪地抓取非引号或 > 与字符串处理器进行或运算（也使用 greedy ["'>] 匹配。

这似乎使用正确格式或格式错误的标签快速运行。

```
<img(\s+((\w+)=(('[^']*?')|("[^"]*?"))))+? /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:21:15.010

您能否发布您想要查找或提取的内容？你想弄清楚 img 标签指向什么吗？这将大大增加能够提供更好答案的机会。

# performance - 您是否使用过多核来提高速度？你做了什么，值得付出努力吗？

> ID：631752
> 
> 赞同：1
> 
> 时间：2009-03-10T18:52:46.283
> 
> 标签：performance, multicore

所以在发布之前我没有看正确的位置..

```
I was looking at the result of the computer language benchmark game:

<http://shootout.alioth.debian.org/u32q/index.php>

And it seems that most of the fastest solutions are still C/C++ using just 
a single core of the 4 core machine that runs the tests.

I was wondering if multi-core is worth it at all for single tasks or if you 
really need some more speed just tune up your code, rewrite in C/C++ instead. 
```

当您单击完整的基准测试链接，例如：[http](http://shootout.alioth.debian.org/u32q/benchmark.php?test=knucleotide&lang=all) ://shootout.alioth.debian.org/u32q/benchmark.php?test=k核苷酸&lang =all 时，很明显有不少解决方案使用多核。

听到您的个人经历仍然很有趣：

您是否曾成功使用 4 或 8 个内核来实际提高单个任务的性能？

你使用了什么工具/语言？

改进有多大？

值得付出努力吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T18:58:41.573

> 似乎最快的解决方案仍然是 C/C++，只使用运行测试的 4 核机器中的一个核心。

不，并非所有代码都如此。事实上，在我看过的代码中，都使用了多个并行线程，因此也使用了多个内核。事实上，一些（例如[k-核苷酸](http://shootout.alioth.debian.org/u32q/benchmark.php?test=knucleotide&lang=gpp&id=2)）使用像 OpenMP （或者，也有趣的是，[SSE 并行化](http://shootout.alioth.debian.org/u32q/benchmark.php?test=nbody&lang=gpp&id=4)）这样的奇特架构来帮助并行化。

**编辑**事实上，**每个**问题的最快 C++ 解决方案都使用并行线程，但有三个例外：

1.  [fasta benchmark](http://shootout.alioth.debian.org/u32q/benchmark.php?test=fasta&lang=gpp&id=4)，由于随机生成器的使用，很难（但完全可能）并行化。
2.  [pidigits](http://shootout.alioth.debian.org/u32q/benchmark.php?test=pidigits&lang=gpp&id=2)，使用 GMP 库。
3.  [n-body](http://shootout.alioth.debian.org/u32q/benchmark.php?test=nbody&lang=gpp&id=4)，可以并行化。

…大多数其他解决方案也使用 SSE2 支持。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T18:54:01.553

为了提高多核系统上单个任务的性能，您必须将任务设计为分成不同的部分（ala mapreduce）并将每个部分交给不同的核心。很多程序都这样做，它确实提高了性能。

目前有一些压缩算法支持多个处理器，例如 7zip。做这样的事情并不是很困难，但如果你的任务不能分解成合作的部分，你就不会从一个以上的核心获得任何帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T18:59:39.450

这实际上取决于算法的工作原理以及您正在处理的数据集的大小，以及它是否可以很好地跨多个内核扩展。保持在同一个内核上会给您带来很多优势，包括利用处理器流水线以及使用寄存器和缓存——所有这些都非常快。

随着多核在未来变得越来越重要，我们可能会看到一些有趣的跨核优化变得可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:05:56.657

您如何定义“单一任务”？尽管如此，许多单一的概念性任务仍可以拆分为许多独立的子任务。这就是多核*可以*提供性能提升的地方。

当然，这需要您实际构建程序，以便这些子任务实际上能够独立处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-11T02:59:43.290

在执行蒙特卡罗模拟时，我经常使用多核。在这种情况下，这绝对是天赐之物，因为有时这些模拟需要很长时间，并且每次运行都独立于其他运行。事实上，现在我正在等待蒙特卡罗模拟在我的四核上运行。

另一个用例是使用交叉验证测试机器学习算法时。数据集可以加载一次并存储在不可变对象中。然后，可以独立执行每个交叉验证迭代。对于这样的事情，关键是要小心内存分配并避免其中涉及的隐式锁定获取。如果您分配和释放/垃圾收集的频率不够高，则所用内核的加速可能接近线性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-11T03:21:08.213

我已经看到在处理管道上轻松获得了 4 倍的改进。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-11T03:46:26.233

某些类型的任务可以是微不足道的多线程，因此可以提高具有多个内核的系统的性能。

图像处理是一个可以从多核中受益的领域。例如，应用图像过滤器是一个独立于图像其他部分的结果的过程。因此，正如前面在[Alex Fort 的回答](https://stackoverflow.com/questions/631752/have-you-used-multi-core-for-speed-what-did-you-do-and-was-it-worth-the-effort/631759#631759)中提到的，通过将问题（在这种情况下为图像过滤）拆分为多个部分并在多个线程中运行处理，我能够看到处理时间的减少。

事实上，多线程不仅在多核处理器上提高了性能，而且在我的基于 Intel Atom N270 的系统上也提高了性能，该系统只有一个内核，但通过同时多线程（[超线程](http://en.wikipedia.org/wiki/Hyper-threading)）提供两个逻辑内核。

我使用多个线程（通过将处理分成四个线程）和单个线程执行了一些应用图像过滤器的测试。

对于多线程，[`ExecutorService`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html)from[`java.concurrent`包](http://java.sun.com/j2se/1.5.0/docs/guide/concurrency/)用于协调多线程处理。实现这个功能相当简单。

虽然不是确切的数字，也不是完美的基准，但在双核 Core 2 Duo 上，多线程代码的处理时间与单线程代码相比减少了 30-50%，而在超线程 Atom 上，减少了 20 -30%。

与涉及将问题拆分为多个部分的其他问题一样，这种处理方法的可扩展性将取决于拆分和组合问题的步骤所花费的时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-11T04:30:49.250

我用跨平台的 REALbasic 编写了一个 CD 标签编辑程序（因此不能只依赖 GDI+ 或 Cocoa）。它允许对多个蒙版图像进行分层，并通过剪切来标记形状。

我从语言中内置的图像 blit 和缩放例程切换到使用最多可以使用 4 个内核的[插件](http://www.einhugur.com/Html/PictureEffects/index.html)，并实现了关键用户操作的显着加速，尤其是在缩放时。

对于插入式解决方案来说，这是一个很好的域分离——我将单个图像传递给二进制插件，它在内部将工作划分为处理器。作为一个库解决方案，它不需要我的程序的多核意识。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-11T04:34:43.077

使-j 6

在 7 分钟的构建中花费了 6 分钟。:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-11T04:37:45.863

我想提醒大家[阿姆达尔定律，](http://en.wikipedia.org/wiki/Amdahl%27s_law)它描述了增加并行性所获得的收益递减，并且还用于模拟给定算法可以预期的加速程度。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-11-03T21:11:17.310

我在一个解决 SVM 的项目中使用 16 个内核（在 Amazon EC2 实例中）实现了高速加速，我的加速从 10 倍到 16 倍，具体取决于算法使用的数据集：

[https://github.com/RobeDM/LIBIRWLS](https://github.com/RobeDM/LIBIRWLS)

这是我写的论文：

[http://www.sciencedirect.com/science/article/pii/S0167865516302173](http://www.sciencedirect.com/science/article/pii/S0167865516302173)

# asp.net - 如何以编程方式设置 Policy Url？

> ID：631762
> 
> 赞同：1
> 
> 时间：2009-03-10T18:54:23.347
> 
> 标签：asp.net, dotnetopenauth

在以编程方式使用 dotnetopenid 时，我在文档中找不到有关如何将策略 URL 添加到请求的任何内容？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-12T14:04:43.900

听起来您所说的策略 URL 是您可以与简单注册请求一起发送的隐私策略 URL。您要查找的属性是 ClaimsRequest.PolicyUrl。这是一个请求昵称并包含您的隐私政策的片段：

```
IAuthenticationRequest req = rp.CreateRequest(/*...*/);
req.AddExtension(new ClaimsRequest {
    Nickname = DemandLevel.Request,
    PolicyUrl = new Uri("http://yourprivacypolicy"),
});
req.RedirectToProvider(); 
```

# wpf - WPF 等效于 Windows 窗体中的“Control.CheckForIllegalCrossThreadCalls”

> ID：631766
> 
> 赞同：3
> 
> 时间：2009-03-10T18:55:28.897
> 
> 标签：wpf, vb.net, multithreading, winforms, exception

我想在我的 WPF 应用程序中禁用跨线程异常。在 Windows 窗体应用程序中，我会这样做：

```
Control.CheckForIllegalCrossThreadCalls = False 
```

如何在 WPF 应用程序中执行相同的操作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T19:28:26.400

在 WPF 中，检查非法跨线程调用的责任在于通过 CheckAccess() 成员的 Dispatcher 对象。像 DependencyObject 这样的对象使用它们关联的 Dispatcher 来检查几乎所有 API 调用上的非法线程访问。

与 WinForms 不同，没有办法在 WPF 中禁用此检查。它默认是打开的，不能被禁用。

至于为什么会这样（这里有点猜测）。CheckForIllegalCrossThreadCalls 成员是在 .net 2.0 中添加的。原因是从不同的线程访问控件已经是非法的，只是没有强制执行。这导致了许多不可预测的用户场景，而不是主动崩溃，控件将具有不可预测的行为。

在 2.0 中，WinForms 团队添加了 CheckForIllegalCrossThreadCalls 作为主动防止这些场景发生的一种方式。但是因为有些人*已经摆脱了它，*他们不得不插入一种方法来关闭它，以便应用程序向后兼容。

如果您需要关闭此功能，则您的代码中存在错误。通过查找和修复错误而不是禁用检查，您会得到更好的服务。

# c++ - C ++首先选择非空元素

> ID：631770
> 
> 赞同：1
> 
> 时间：2009-03-10T18:56:25.433
> 
> 标签：c++, naming, std

**[根据更新要求更新问题]**
我已经实现了以下函数，它应该返回第一个非空元素或抛出异常。
您还可以发明更经典和更短的名称，例如“max”、“min”、“pair”吗？

```
template <typename T>
T select_first_not_empty( const T& a, const T&b )
{
    static T null = T();

    if ( a == null && b == null )
        throw std::runtime_error( "null" );

    return
        a != null ? a : b;
}

int main()
{
    const int a1 = 2;
    const int b1 = 0;

    const int* a2 = 0;
    const int* b2 = new int(5);

    const std::string a3 = "";
    const std::string b3 = "";

    std::cout << select_first_not_empty( a1, b1 ) << std::endl;
    std::cout << select_first_not_empty( a2, b2 ) << std::endl;
    std::cout << select_first_not_empty( a3, b3 ) << std::endl;

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T19:11:37.737

你可以尝试下一步

```
template < typename T >
T get_valuable( const T& firstValue, 
                const T& alternateValue, 
                const T& zerroValue = T() )
{
    return firstValue != zerroValue ? firstValue : alternateValue;
}

// usage
char *str = "Something"; // sometimes can be NULL
std::string str2 ( get_valuable( str,  "" ) );

// your function
template <typename T>
T select_first_not_empty( const T& a, 
                          const T& b, 
                          const T& zerroValue = T() )
{
    const T result = get_valuable( a, b, zerroValue );
    if ( result == zerroValue )
    {
        throw std::runtime_error( "null" );
    }
    return result;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T19:00:22.473

~~如果 T 的 ctor 做了任何重要的事情，看起来你每次通过“select_first_not_empty”都做了三遍。~~

如果您正在寻找更好的名称，Oracle 将类似的名称称为“COALESCE”。

不过，我不确定重点是什么。如果我真的想知道是否设置了某些东西，我会使用可空指针而不是引用。“NULL”比使用带内值（如 0 或“”）更好地指示不设置变量的意图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:09:21.283

C# 有一个类似功能的内置操作符`??`，我相信它被称为合并。

Perl 的`||`（短路逻辑或）运算符也有类似的功能：它返回第一个参数的值为真而不是返回 0 或 1：

```
0 || 7 
```

返回 7，而不是 1，或者`true`像 C\C++ 或 C# 程序员所期望的那样。

C++ 内置的最接近这一点的是 find_if 算法：

```
vector<int> vec;
vec.push_back(0);
vec.push_back(0);
vec.push_back(7);

vector<int>::iterator first_non_0 = 
    find_if(vec.begin(), vec.end(), bind2nd(not_equal_to<int>(), 0)); 
```

# ide - 如何使用 IntelliJ IDEA 8.0.1 将 Grails 更新到 1.1？

> ID：631773
> 
> 赞同：0
> 
> 时间：2009-03-10T18:56:38.113
> 
> 标签：ide, grails, intellij-idea

我正在运行 IntelliJ IDEA 8.0.1，并希望将我的 Grails 安装升级到今天（2009 年 3 月 10 日）发布的 Grails 1.1。当升级完成并尝试“运行应用程序”我的应用程序时，我收到错误消息

> “未配置 Grails”。

这似乎是一个已知问题 - 但是否有任何解决方法或修复？我很想升级到 Grails 1.1，但我不愿意将它换成 IntelliJ。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T13:01:38.490

IntelliJ IDEA 8.1 支持 Grails 1.1 SDK

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T16:16:35.140

Grails 1.1 不适用于 Intellij Idea 8.0.1。

我认为更新的 Intellij 8.1.1 EAP 将适用于 Grails 1.1。如果您在尝试使用旧版本的 grails（即 0.6）时遇到问题

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-10T19:00:32.363

我必须在家里尝试一下，但我想知道您在创建 Grails 模块时是否只需要指向 Grails 1.1 SDK？

我在 IntelliJ 8.1 中使用 Python 插件。当我创建一个新的 Python 模块时，我必须指定在哪里可以找到 Python SDK。

我假设它与 Grails 类似。

如果 Grails 插件是假设 Grails 1.0 编写的，那你就完蛋了。在插件升级之前无法解决这个问题。

# diff - 对 CVS 使用不同的 diff 命令？

> ID：631781
> 
> 赞同：7
> 
> 时间：2009-03-10T18:59:10.027
> 
> 标签：diff, cvs, meld

是否可以在 CVS 中使用不同的差异程序？我想使用像 meld 这样的东西来为我提供存储库和我的更改的并排图形视图。我无法控制使用不同的 CMS。理想的是一些未记录的命令行参数，它可以像这样工作：

```
cvs diff -prog /usr/bin/meld foo.cc 
```

这会给我一个我签出的 foo.cc 的修改版本与存储库版本的差异，但使用 diff 程序融合。

我意识到一个未记录的命令行参数是不可能的，所以如果你必须把它一起破解，那对我有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T11:33:47.220

我使用 tkcvs 和 tkdiff（也不是最新版本）

*   [http://www.twobarleycorns.net/tkcvs.html](http://www.twobarleycorns.net/tkcvs.html)
*   [http://tkdiff.sourceforge.net/](http://tkdiff.sourceforge.net/)
*   [http://wiki.tcl.tk/3773](http://wiki.tcl.tk/3773)

很酷的是 tkcvs 也支持颠覆。

tkdiff 在命令行上工作并接受 cvs 标签...

*   tkdiff -rfoo_v5_0 -rfoo_v6_5 silly.c（比较两个不同的版本，而不是本地目录中的版本）
*   tkdiff spring.h（将我的本地版本与存储库进行比较）
*   tkdiff -r1.6 happy.c（将我的本地版本与特定存储库版本进行比较）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:03:40.860

如果您使用[WinCVS](http://www.wincvs.org/)，您可以在首选项中设置一个 Diff 应用程序，例如[WinMerge](http://winmerge.org/)。

在 WinCVS 首选项中，选项卡 WinCVS，“外部差异程序”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-19T20:25:33.833

我终于找到了Vim 的[cvsmenu 插件](http://www.vim.org/scripts/script.php?script_id=1245)。它对我来说就像一个魅力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T22:31:35.947

Meld 本身就支持这一点。[请参阅meld.sourceforge.net](http://meld.sourceforge.net)的“工作副本”[屏幕截图](http://meld.sourceforge.net/screenshots.html)

# c++ - 将析构函数设为私有有什么用？

> ID：631783
> 
> 赞同：213
> 
> 时间：2009-03-10T18:59:52.460
> 
> 标签：c++, private, destructor

将析构函数设为私有有什么用？

* * *

## 回答 #1

> 赞同：194
> 
> 时间：2009-03-10T19:02:44.747

基本上，只要您希望某个其他类负责您的类对象的生命周期，或者您有理由阻止对象的破坏，您都可以将析构函数设为私有。

例如，如果您正在做某种引用计数的事情，您可以让对象（或已“加好友”的管理器）负责计算对自身的引用数量，并在数量达到零时将其删除。当仍有对它的引用时，私有 dtor 会阻止其他任何人删除它。

再举一个例子，如果你有一个对象，它有一个管理器（或它本身），它可能会破坏它，或者可能拒绝破坏它，这取决于程序中的其他条件，例如打开的数据库连接或正在写入的文件。您可以在类或管理器中有一个“request_delete”方法来检查该条件，它将删除或拒绝，并返回一个状态告诉您它做了什么。这比仅仅调用“删除”要灵活得多。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-03-10T19:06:44.377

这样的对象永远不能在堆栈上创建。总是在堆上。删除必须通过朋友或会员完成。产品可能使用单个对象层次结构和自定义内存管理器——此类场景可能使用私有 dtor。

```
#include <iostream>
class a {
    ~a() {}
    friend void delete_a(a* p);
};

void delete_a(a* p)  {
    delete p;
}

int main()
{
    a *p = new a;
    delete_a(p);

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-03-10T19:03:14.993

当您不希望用户访问析构函数时，即您希望对象仅通过其他方式被销毁。

[http://blogs.msdn.com/larryosterman/archive/2005/07/01/434684.aspx](http://blogs.msdn.com/larryosterman/archive/2005/07/01/434684.aspx)给出了一个示例，其中对象是引用计数的，并且只能在计数变为零时由对象本身销毁。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-03-11T01:14:16.740

COM 使用此策略删除实例。COM 将析构函数设为私有，并提供一个用于删除实例的接口。

下面是一个 Release 方法的示例。

```
int MyRefCountedObject::Release() 
{
 _refCount--;
 if ( 0 == _refCount ) 
 {
    delete this;
    return 0;
 }
 return _refCount;
} 
```

ATL COM 对象是这种模式的主要示例。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-05-17T18:40:57.440

添加到这里已经存在的答案；在实现需要在堆上分配创建的对象的[工厂](http://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29)时，私有构造函数和析构函数非常有用。通常，对象将由静态成员或朋友创建/删除。典型用法示例：

```
class myclass
{
public:
    static myclass* create(/* args */)  // Factory
    {
        return new myclass(/* args */);
    }

    static void destroy(myclass* ptr)
    {
        delete ptr;
    }
private:
    myclass(/* args */) { ... }         // Private CTOR and DTOR
    ~myclass() { ... }                  // 
}

int main ()
{
    myclass m;                          // error: ctor and dtor are private
    myclass* mp = new myclass (..);     // error: private ctor
    myclass* mp = myclass::create(..);  // OK
    delete mp;                          // error: private dtor
    myclass::destroy(mp);               // OK
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-10T19:03:49.767

该类只能自行删除。如果您正在尝试创建一些引用计数对象，这很有用。然后只有 release 方法可以删除对象，可能会帮助您避免错误。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-10T20:17:33.740

我知道你问的是私人析构函数。这是我如何使用受保护的。这个想法是您不想通过指向类的指针来删除主类，从而向主类添加额外的功能。
在下面的示例中，我不希望通过 HandlerHolder 指针删除 GuiWindow。

```
class Handler
{
public:
    virtual void onClose() = 0;
protected:
    virtual ~Handler();
};

class HandlerHolder
{
public:
    void setHandler( Handler* );
    Handler* getHandler() const;
protected:
    ~HandlerHolder(){}
private:
    Handler* handler_;
};

class GuiWindow : public HandlerHolder
{
public:
    void finish()
    {
        getHandler()->onClose();
    }

    virtual ~GuiWindow(){}
}; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-03-10T09:53:55.337

直接是错误的。这是在堆栈上创建的具有私有 c-tor 和 d-tor 的对象示例（我在这里使用静态成员函数，但也可以使用友元函数或友元类来完成）。

```
#include <iostream>

class PrivateCD
{
private:
    PrivateCD(int i) : _i(i) {};
    ~PrivateCD(){};
    int _i;
public:
    static void TryMe(int i)
    {
        PrivateCD p(i);
        cout << "inside PrivateCD::TryMe, p._i = " << p._i << endl;
    };
};

int main()
{
    PrivateCD::TryMe(8);
}; 
```

此代码将产生输出：在 PrivateCD::TryMe 内部，p._i = 8

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-10T19:09:11.907

这可能是一种处理 Windows 中每个模块可以使用不同堆（例如[调试](http://msdn.microsoft.com/en-us/library/19f56tw3(VS.71).aspx)堆）的问题的方法。如果没有正确处理该问题，则[可能会发生](https://stackoverflow.com/questions/443147/c-mix-new-delete-between-libs)[坏事](http://blogs.msdn.com/oldnewthing/archive/2006/09/15/755966.aspx) 。

# sharepoint - 如何在 Sharepoint 2007 中了解文档库中文档的 KB？

> ID：631789
> 
> 赞同：2
> 
> 时间：2009-03-10T19:01:21.363
> 
> 标签：sharepoint, sharepoint-2007

我在 Sharepoint 2007 中有一个网站。我需要在 SPWeb/站点的文档库中查询文档并了解文档的 KB。

实际上，我必须从链接字段中提取文档的 url，然后查找 KB？

任何人都可以提供查询？还是方法？我可以用 SPSiteDataQuery 做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:10:17.953

有一个内部名称为 File_x0020_Size (SPBuiltInFieldId.File_x0020_Size = {8fca95c0-9b7d-456f-8dae-b41ee2728b85}) 的字段

您可能可以使用它来查询文件大小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T04:55:01.843

如果上面的答案不适合你，你可以使用对象模型来解决。SPListItem 有一个 File 属性，它是一个 SPFile 对象。它有一个 Length 属性，它是以字节为单位的文件大小/长度。显然，这种方法需要迭代每个 SPListItem。

# c# - 使用 ASP.Net/C# 从 rapidshare 进行身份验证和下载

> ID：631794
> 
> 赞同：0
> 
> 时间：2009-03-10T19:03:34.993
> 
> 标签：c#, asp.net

我正在寻找一种方法来从 rapidshare 验证我的高级帐户，然后在通过验证后开始下载。我已经在其他语言中看到过很多次这样做，但是用我知道的一种语言（C#）似乎是不可能的。

我已经完成了整个项目并将其转换为 C#，以便我可以更轻松地调试它，但它根本没有帮助，主要是因为原始项目从未使用过身份验证，而且我不知道该怎么做。我不应该在 ASP.Net 中这样做。

如果有人可以帮助进行身份验证，我应该能够正确下载。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:09:37.227

我不知道您是如何进行下载的，也不知道他们最终使用的是什么类型的身份验证，但是如果它是基本 HTTP（例如 twitter），您可以将 NetworkCredential 类与 WebClient 一起使用。类似于以下内容：

```
WebClient client = new WebClient();
client.Credentials = new NetworkCredential(user, pass);
string data = client.DownloadString(new Uri(some_url)); 
```

# ruby - GServer 接收消息

> ID：631798
> 
> 赞同：1
> 
> 时间：2009-03-10T19:04:04.977
> 
> 标签：ruby

我使用下面的代码创建一个 TCP/IP 服务器，然后使用客户端代码调用它，但由于某种原因，服务器没有收到客户端发送的消息。请指教。谢谢

服务器：

```
class MyServer < GServer
  def initialize(port=20607, host=GServer::DEFAULT_HOST)
    super(port, host, Float::MAX, $stderr, true)
  end

  def serve(sock)
    begin
      @clients << sock
      stock.accept
      message = sock.gets.chomp
      puts "message: " << message
      this.stop if message == "#quitserver"
      # TODO: code that process commmands comes here
    rescue

    ensure
      @clients.delete(sock)
    end
  end
end 
```

客户：

```
require 'socket'
streamSock = TCPSocket.new( "127.0.0.1", 20607 )
puts "Socket created..." unless streamSock.nil?
sleep 5
streamSock.puts "hello world"
sleep 5
streamSock.close
puts "Socket closed." 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T19:29:46.710

哎呀我的错误，@clients 数组未声明。工作中 ：）

# .net - 从未使用 SpecifiedPickupDirectory 从 Exchange 2007 发送密件抄送

> ID：631799
> 
> 赞同：1
> 
> 时间：2009-03-10T19:04:20.203
> 
> 标签：.net, email, exchange-server, smtpclient

我正在使用 Exchange 2007 拾取目录从我的 ASP.NET 应用程序发送电子邮件`System.Net.Mail.SmtpClient`。因此我正在使用`SmtpClient.DeliveryMethod = SmtpDeliveryMethod.SpecifiedPickupDirectory`. 它可以正常发送电子邮件，但后来我注意到密件抄送根本不起作用。放置在拾取文件夹中的文件似乎具有正确的设置，但 Exchange 忽略了 X-Receiver 列表。这是正在创建的 EML 文件的示例：

```
X-Sender: "Joe" <joe@example.com>
X-Receiver: david@example.com
X-Receiver: contact@example.com
X-Receiver: lindsey@example.com
MIME-Version: 1.0
From: "Joe" <joe@example.com>
To: david@example.com
Date: 10 Mar 2009 9:32:27 -0500
Subject: Test Message
Content-Type: text/html; charset=us-ascii
Content-Transfer-Encoding: quoted-printable

<p>Test Message</p> 
```

contact@ 和 lindsey@ 是密件抄送收件人。当我使用网络发送时，它工作正常。BCC 仅停止使用拾取目录。所以你知道，我使用的是 Windows Server 2008 和 ASP.NET 3.5 / C#。

## 解决方法

Exchange 2007 似乎忽略了 X-Receiver，而是希望看到 Bcc:。所以我求助于 mailMessage.Headers.Add("Bcc", bccList) 其中 bccList 是电子邮件地址的分号分隔列表。这很好用。

但是正如 Chase Seibert 指出的那样，如果您在电子邮件客户端中查看消息的标题，您仍然可以看到列出的所有 X-Receiver。尽管密件抄送已被剥离，因此对收件人隐藏。因此，您获得了密件抄送的效果，可能有人会打开邮件并查看所有密件抄送。我认为抑制 X-Receivers 列表的最佳方法是不在 mailMessage.Bcc 属性中包含任何内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T01:45:34.327

这在 Windows 2003 Server 中绝对有效，只有操作系统附带的 MS SMTP 实现。我的理解是 Exchange 使用相同的服务进行发送。

虽然这可能无法回答您的问题，但我想指出 Pickup 方法有一个您可能不知道的缺点。*通常，MS SMTP在入站传输期间*从 EML 中去除 BCC 和 X-Recipient 标头。

当您将 EML 放入 Pickup 时，您将跳过此步骤。因此，如果远程收件人查看电子邮件标题，他们实际上将能够看到密件抄送收件人。尝试向 gmail 帐户发送电子邮件并密件抄送其他人。如果您在 Gmail 中查看标头，您将看到密件抄送收件人。

我建议改用 SMTP 来传递此消息。

# sharepoint - SharePoint... 我的应用程序的 Web 服务界面值得吗？

> ID：631806
> 
> 赞同：1
> 
> 时间：2009-03-10T19:06:36.860
> 
> 标签：sharepoint

我希望听到在他们的站点上安装了 SharePoint 的人的横截面。我正在尝试决定是否让用户只使用基于 Web 的界面来签出和编辑我的应用程序的文件，然后依靠它们足够复杂以知道返回到 SharePoint Web 界面并执行签入.

我的假设是，对于使用 SharePoint 的普通组织来说，这对于很大一部分用户来说是难以理解的。因此，我开始在我的应用程序中使用 SharePoint Web 服务，以便用户可以打开文件、编辑它们，然后在文件关闭时签入（可选）——所有这些都在我的应用程序中进行。但是，我最初估计完成此任务的开发时间不足。所以现在我想做一些成本/收益分析。

大多数用户如何快速自然地“获得”SharePoint 的签出/本地编辑/签入周期？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T19:48:56.680

正如 OTisler 所提到的，Office 2003 中的情况有些混乱。事实上，Office 2007 中的**情况要**好得多，因为 Word、Excel、PP 等都可以识别 MOSS，并在其菜单、信息栏 w/ MOSS 元数据等

FWIW，我已经完成了一些项目，其中一个大型（> 1,000 个用户/站点）用户群正在与之交互，最大的问题是“他/她检查了我的文件！” 这只是教育用户答案是打电话给违规用户，而不是帮助台的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T19:11:13.913

我对整个 Checkout-edit-Check in 过程的体验非常消极。它永远不会与大型组一起使用，并且您总是让人们抱怨他们想要的文件已被签出。我们特别遇到了 Sharepoint 2003 的问题，我不知道它在 SP 2007 中是否更好

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T20:37:53.957

在某些情况下，office 会创建一个[隐式结帐](http://www.wssdemo.com/Blog/archive/2008/11.aspx)。这肯定会引发用户，他们很难纠正这一点。

我真的无法帮助对此进行成本/收益分析，但我知道用户总是需要一段时间才能解决问题。在与大型组织打交道时，绝对值得将库的签入功能限制为仅需要它的那些库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T06:19:47.053

我们的员工（大约 40 人）使用 VSS 来管理空军的课件开发。去年我们过渡到 SharePoint 2007 和 Office 2007，遇到了一些问题，但没有一个是无法克服的。错误配置的浏览器和糟糕的网络性能对用户体验的负面影响最大。由于每个人都已经体验过整个签入/签出流程，因此主要是让人们了解该流程在 SharePoint 中的工作方式。

无论经验水平如何，都有一个简单的先决条件：培训、培训、培训！这是让客户满意的关键。建立合理的期望和现实的实施时间表。让他们知道即将发生什么以及为什么，然后正确培训他们如何使用该产品。

对于我们的 300 多名空军用户（外部客户），我们在 6 个月时开始看到使用量快速增长。关键是在组织的各个层面识别早期采用者并将其作为技术倡导者参与进来。让他们向同行推销利益。起初采用会很慢，但随着消息的传开，会迅速恢复。

在您开始使用这些功能之前，让系统保持稳定并让您的客户感到舒适。如果您的系统或应用程序在部署的早期阶段被认为不可靠或过于复杂（培训！），您可能永远无法获得足够数量的满意用户。

# c++ - 在 typedef 中使用类型时包含在头文件中的规则

> ID：631808
> 
> 赞同：1
> 
> 时间：2009-03-10T19:06:50.680
> 
> 标签：c++, header-files

如果我创建

```
typedef double (MyClass::*MemFuncGetter)(); 
```

在头文件中，我需要包含“MyClass.h”还是**转发声明**就足够了？

头文件：

```
#ifndef _TEST_
#define _TEST_

#include "MyClass.h" //do I need this?
//or I can just say class MyClass;

typedef double (MyClass::*MemFuncGetter)();

#endif 
```

这里的链接规则是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T19:20:26.730

只需类的前向声明就可以了：

```
#ifndef _TEST_
#define _TEST_

class MyClass;
typedef double (MyClass::*MemFuncGetter)();

#endif 
```

但请注意，由于不包括整个类，编译器必须做额外的工作来处理 MyClass 是多虚拟继承混乱的情况，因为它不知道。在某些情况下，这可能意味着每个函数指针实际上最多占用 20 个字节的内存。而如果你已经定义了整体，每个函数指针只需要 4 个。（当然，大小都取决于编译器）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T19:13:02.037

创建文件 MyClassFwd.h 并放在那里

```
class MyClass;
typedef double (MyClass::*MemFuncGetter)(); 
```

并包括 forward decl - 这已经足够了。不要复制和粘贴 typedef。在您的“MyClass.h”中只需包含“MyClassFwd.h”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T19:13:35.843

您至少需要有一个`MyClass`范围内的声明——至少是一个前向声明。typedef 创建一个别名。它不会创建新类型或更改链接。链接将是 的链接`MemFuncGetter`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:37:52.167

是的，前向声明就足够了。

# python - 如何使用 SVN 和 distutils 为 Python 包分配版本号？

> ID：631813
> 
> 赞同：4
> 
> 时间：2009-03-10T19:08:49.380
> 
> 标签：python, svn, distutils

我正在编写一个 Python 包。包需要在内部知道它的版本号，同时还要在`setup.py`脚本中包含这个版本`distutils`。

这样做的最佳方法是什么，以便不需要在两个不同的地方维护版本号？我不想`setup.py`从我的库的其余部分导入脚本（这看起来很傻），我不想从`setup.py`脚本中导入我的库（同样）。理想情况下，我只需设置一个关键字`svn`并自动将其替换到文件中，但这似乎在`svn`. 我可以在两个地方读取一个包含版本号的通用文本文件——这是最好的解决方案吗？

**澄清**一下：我想在*一个*地方维护版本号。是的，我可以在包中放一个变量，然后再在`setup.py`文件中放一个变量。但随后它们不可避免地会不同步。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T19:50:52.073

在你的主包里面，你可能有一个`__init__.py`，对吧？

目录结构：

```
> ./packageTest
>   ./packageTest/__init__.py
>   ./packageTest/setup.py 
```

在`__init__.py`文件中，添加以下行：

```
# package directory __init__.py
__version__ = 1.0 
```

setup.py 文件：

```
# setup.py
from packageTest import __version__
... 
```

现在在从包目录导入的任何模块中（我将调用 packageTest），您可以这样做：

```
from packageTest import setup
print 'Setup.py version:', setup.__version__  
# prints Setup.py version: 1.0 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T20:04:51.400

在你的包中导入安装脚本是愚蠢的（特别是因为在你的库安装后它可能不再存在），但是在 setup.py 中导入你的库应该没问题。单独的文本文件也可以，但是如果您想在运行时访问版本号，则必须将文本文件与您的包一起安装。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T20:14:27.367

我的项目也有类似的问题。[我编写了一个名为build.py](https://fisheye.springframework.org/browse/se-springpython-py/trunk/springpython/build.py?r=470)的顶级 test/build/package/deploy 脚本（请注意，不是基于 distutils）。它读取一个包含集中版本号的[属性文件。](https://fisheye.springframework.org/browse/se-springpython-py/trunk/springpython/springpython.properties?r=468)我没有直接维护 setup.py 文件，而是保留了一个[模板文件](https://fisheye.springframework.org/browse/se-springpython-py/trunk/springpython/src/build.py?r=461)，我的 build.py 脚本将其读入，将 version 变量替换为 props 文件中的值，然后写出 setup.py 脚本。然后我的脚本文件将执行它，生成一个包或上传到 pypi。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-16T15:45:55.903

另请参阅[将版本嵌入 python 包的标准方法？](https://stackoverflow.com/questions/458550/standard-way-to-embed-version-into-python-package)这是关于如何将版本信息从一个位置（一个名为 的文件`_version.py`）传播到其他代码查找它的位置（例如，一个名为的属性`__version__`和`PEP 0345`元数据）。

然后看看 Brian Warner 的[新“versioneer”工具](https://github.com/warner/python-versioneer)，它`_version.py`根据版本控制历史生成文件。

另外，请查看我[对将版本嵌入python包的标准方式的回答？](https://stackoverflow.com/a/7071358/2742805)，越多的人意识到有一种方法可以避免从安装脚本导入模块的问题，越好。

# java - 如何在 JavaDocs 中引用“*/”

> ID：631817
> 
> 赞同：57
> 
> 时间：2009-03-10T19:09:24.387
> 
> 标签：java, comments, javadoc

我需要包含`*/`在我的 JavaDoc 注释中。问题是这也是关闭评论的相同顺序。引用/逃避这个的正确方法是什么？

例子：

```
/**
 * Returns true if the specified string contains "*/".
 */
public boolean containsSpecialSequence(String str) 
```

**跟进**：看来我可以使用`&#47;`斜线。唯一的缺点是直接在文本编辑器中查看代码时，这并不是那么可读。

```
/**
 * Returns true if the specified string contains "*&#47;".
 */ 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-10T19:15:04.497

使用 HTML 转义。

所以在你的例子中：

```
/**
 * Returns true if the specified string contains "*&#47;".
 */
public boolean containsSpecialSequence(String str) 
```

`&#47;`转义为“/”字符。

Javadoc 应该将不受干扰的转义序列插入到它生成的 HTML 中，并且应该在浏览器中呈现为“*/”。

如果你想非常小心，你可以转义两个字符：`&#42;&#47;`转换为`*/`

**编辑：**

> *跟进：看来我可以使用 / 为斜线。唯一的缺点是，当直接查看代码时，这并不是那么可读。*

所以？重点不是让您的代码可读，而是让您的代码**文档**可读。大多数 Javadoc 注释都嵌入了复杂的 HTML 以进行解释。地狱，C# 的等价物提供了一个完整的 XML 标记库。我在那里看到了一些非常复杂的结构，让我告诉你。

**编辑 2：** 如果它太困扰您，您可能会嵌入一个解释编码的非 javadoc 内联注释：

```
/**
 * Returns true if the specified string contains "*&#47;".
 */
// returns true if the specified string contains "*/"
public boolean containsSpecialSequence(String str) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2014-07-11T10:52:51.663

没有人提到[{@literal}](http://docs.oracle.com/javase/7/docs/technotes/guides/javadoc/whatsnew-1.5.0.html)。这是另一种方法：

```
/**
 * Returns true if the specified string contains "*{@literal /}".
 */ 
```

不幸的是，您一次无法逃脱`*/`。有一些缺点，这也修复了：

> > 唯一的缺点是直接在文本编辑器中查看代码时，这并不是那么可读。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-10T21:03:15.690

```
/**
 * Returns true if the specified string contains "*&#47;".
 */ 
```

这是“正确”的解决方案，但为了便于阅读，我可能会选择：

```
/**
 * Returns true if the string contains an asterisk followed by slash.
 */ 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-10T19:15:27.273

使用实体

```
*&#47; 
```

在您的文档中，它将显示为“*/”

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-10T19:39:35.640

我偶然发现的另一种方式，只是为了完整性：添加一些不会改变 * 和 / 之间的输出的 HTML 标记。

```
 /**
   * *<b/>/
   */ 
```

与 HTML 转义解决方案相比，这似乎是一种丑陋的 hack，但它也能在 HTML 输出中产生正确的结果。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-10T19:44:32.447

我建议您在附近的某处添加一行评论，例如

```
// *&#47; is html for */ 
```

# php - 如何使用 MAMP + MacOSx + PHP 在 localhost 上设置 cookie？

> ID：631819
> 
> 赞同：4
> 
> 时间：2009-03-10T19:09:38.847
> 
> 标签：php, cookies, mamp

我正在我的 Mac 笔记本上开发，我使用 MAMP。我正在尝试使用 PHP 设置 cookie，但我不能。我已经离开了域，我尝试使用“\”作为域。没运气。

```
setcookie("username", "George", false, "/", false);
setcookie("name","Joe"); 
```

我一定遗漏了一些明显的东西。我需要一个快速简单的解决方案。有吗？

我没有做任何花哨的事情，只是加载（通过 MAMP）页面 [http://localhost:8888/MAMP/lynn/setcookie.php](http://localhost:8888/MAMP/lynn/setcookie.php)

该脚本的顶部有 setcookie 代码，甚至在编写 HTML 标记之前。（尽管我也在 BODY 中尝试过）。我在各种浏览器中加载页面，然后打开 cookie 列表。我知道浏览器接受 cookie，因为我在列表中看到了当前的。只是不是我的新的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T19:12:31.523

从文档：

> setcookie() 定义了一个 cookie 与其余的 HTTP 标头一起发送。与其他标头一样，必须在脚本的任何输出之前发送 cookie（这是协议限制）。这要求您在任何输出之前调用此函数，包括和标记以及任何空格。

是这样吗？

**编辑：**

您能看到服务器发送的 cookie，例如通过使用 Firefox 扩展*Tamper Data*或 telnet 吗？你能看到它在下一个请求中被浏览器发回吗？setcookie() 的返回值是多少？它不适用于所有浏览器，还是仅适用于某些浏览器？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T22:06:14.650

```
<?php
ob_start();
if (isset($_COOKIE['test'])) {
    echo 'cookie is fine<br>';
    print_r($_COOKIE);
} else {
    setcookie('test', 'cookie test content', time()+3600);  /* expire in 1 hour */
    echo 'Trying to set cookie. Reload page plz';    
} 
```

试试这个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-08T00:47:54.177

取出“localhost”并只使用一个空白字符串对我有用。

# tfs - 如何轻松获得一组在 TFS 中共享标签的文件？

> ID：631820
> 
> 赞同：1
> 
> 时间：2009-03-10T19:10:09.393
> 
> 标签：tfs

我正在使用 TFS，我希望能够获取所有带有标签 XYZ 的文件。我能看到的唯一方法是执行“获取特定版本”，标签，浏览标签，选择一个文件，点击获取。对每个文件重复。如果我有 20 个文件要获取，那么这将是乏味且容易出错的。在存储库的根级别获取标签名称不起作用，它不会在子目录中找到文件。有人告诉我它可以在他的系统上运行，所以我不确定问题是什么。

有人建议使用标签作为解决此问题的方法：我希望能够将多个解决方案中的一组文件标记为属于一个组。我希望能够一次获取组中的所有文件并将它们放在一个目录中。TFS可以做到这一点吗？有问题的文件都是 SQL procs 等，因此它们实际上并不需要成为运行解决方案的一部分，它们只是脚本。但它们在逻辑上确实属于一起，因为它们都将在添加新数据库后运行。

更新：我的结论是 TFS 中的标签已损坏或毫无价值。如果有人愿意教育我，请随意。但是我今天已经花足够的时间在他们身上，以决定他们不再值得。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T03:44:39.540

只需使用文件夹中的标签选项执行“获取特定版本”，它将递归应用。从命令行看，这看起来像：

tf get * /r /version:Lyourlabelname

# date - 公元 1 年后的第一个闰年是从星期一开始的？

> ID：631822
> 
> 赞同：1
> 
> 时间：2009-03-10T19:10:48.237
> 
> 标签：date

我之所以这么问，是因为它对我正在做的一些数学运算非常有用。

如果没有人先找到它，我会在找到它时发布它

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T19:26:39.523

根据 Mathematica 的“ `DayOfWeek`”函数，公元 20 年是第一个这样的闰年。

```
DayOfWeek[{20,1,1}] == Monday 
```

但是，在欧洲从儒略历切换到公历之前，应该考虑什么是一周中的哪一天，有很多警告。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:16:17.507

从星期一开始的第一个闰年是[20 年](http://en.wikipedia.org/wiki/20)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T19:17:02.293

根据[这个](http://cobalt.archives.nd.edu/cgi-bin/petcal.pl?century=0000s&day=Thursday&month=February&date=29)20 年。我认为它使用的是公历。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-10T19:13:37.263

啊，我读了句子的“闰年”部分。所以不是[3 年](http://en.wikipedia.org/wiki/3)，而是 20 年。当然，这是使用[儒略历](http://en.wikipedia.org/wiki/Julian_calendar)，目前我们使用的是[公历](http://en.wikipedia.org/wiki/Gregorian_calendar)。儒略历有闰日（2 月 24 日），但每 100 年也不例外。有关更多信息，包括随时间的差异，请参阅[Proleptic Gregorian calendar](http://en.wikipedia.org/wiki/Proleptic_Gregorian_calendar)。

# c# - .NET 对象大小

> ID：631825
> 
> 赞同：5
> 
> 时间：2009-03-10T19:11:52.947
> 
> 标签：c#, .net, memory, memory-management

.net 中堆分配对象的大小是多少，包括管理开销？我假设对象是沿 4 字节边界分配的，还是使用了不同的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T19:14:03.563

x86 上的 4 字节边界。x64 上可能有 8 字节边界。

x86 上有一个 8 字节的开销，用于类型引用和同步块。在 x64 上发现 12 或 16 字节我不会感到惊讶。

出于某种原因，在 x86 上，一个实例`System.Object`似乎只占用 12 个字节，这使得 12 个字节成为可能的绝对最小大小——但一个具有 a 的类`int` *也*占用 12 个字节。我不知道为什么会这样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:13:23.970

取决于机器，在 32 位机器上它通常是 4 字节。但是，在 64 位盒上，它是 8 字节，依此类推。

# wpf - WPF ComboBox 绑定不可更改

> ID：631828
> 
> 赞同：0
> 
> 时间：2009-03-10T19:12:44.737
> 
> 标签：wpf, xaml, combobox

我正在尝试将 ComboBox 绑定到来自对象的数据。该对象包含一个表示允许状态的列表和一个表示其当前值的字符串。我遇到的问题是，当表单加载时，它正确地将组合框的值设置为其当前值，但我无法将值更改为其他任何值。如果我单击下拉列表并选择一个新值，它将关闭下拉列表但保留原始值。

每个组合框都在 DataGrid 中的一行中，并且 ComboBox 包含在 DataGrid 的 RowDetailsTemplate 中。

XAML：

```
<ComboBox
   x:Name="cmbStatus"
   ItemsSource="{Binding Path=AllowedStateValues}"
   SelectedItem="{Binding Path=State}"    
   Height="20"
   Width="100" /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:49:59.110

尝试将绑定*模式*设置为*TwoWay*。如果这不起作用，请使用*PresentationTraceSources.TraceLevel*属性到*High*，以获取完整的详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T19:26:26.670

状态声明：

```
private string _state;
    public string State { 
        get { return _state; }
        set
        {
            if (AllowedStateValues != null && AllowedStateValues.Contains(value))
            {
                _state = value;

            }
        }

    } 
```

更改时我没有引发事件，但是更改组合框时似乎也没有调用设置器

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-31T17:15:55.547

我只是有同样的问题。原来我的问题在于我的 Equals 覆盖了被绑定的项目。检查并确保多个不相等的对象没有被比较为相等。

# flash - 不想在 Flash 中打开新窗口

> ID：631835
> 
> 赞同：2
> 
> 时间：2009-03-10T19:14:05.017
> 
> 标签：flash, window, hyperlink

我在 Flash 中有一个主页，它链接到 Dreamweaver 中的页面。在线时，我不希望在定向到 url 时打开新窗口。（现在，我有一个动作脚本可以转到 URL，并打开一个新窗口）。反正有没有保持不变？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T19:17:01.577

你在用[`navigateToURL`](http://livedocs.adobe.com/flex/3/langref/flash/net/package.html#navigateToURL())吗？`_self`作为第二个参数传递。请参阅文档：

> **`window:String (default = null)`**— 显示请求参数指示的文档的浏览器窗口或 HTML 框架。您可以输入特定窗口的名称或使用以下值之一：

```
* "_self" specifies the current frame in the current window.
* "_blank" specifies a new window.
* "_parent" specifies the parent of the current frame.
* "_top" specifies the top-level frame in the current window. 
```

> 如果您没有为此参数指定值，则会创建一个新的空窗口。在独立播放器中，您可以指定新的（“_blank”）窗口或命名窗口。其他值不适用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:15:48.787

只需将链接目标设置为`_self`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T19:16:07.087

尝试：

```
getUrl("http://theurl.com/page.html", "_self"); 
```

# java - 部署到 OC4j：无法找到/读取文件 META-INF/application.xml

> ID：631837
> 
> 赞同：1
> 
> 时间：2009-03-10T19:14:51.130
> 
> 标签：java, deployment, oc4j, continuum

Continuum 构建服务器部署到我的 oc4j 实例我收到以下错误，似乎每隔一个构建。

09/03/10 13:47:49 通知 ==> 操作失败并出现错误：无法在 C:\oc4j\j2ee\home\applications\rrs 中找到/读取文件 META-INF/application.xml (META-INF/应用程序.xml)

Continuum 在 windows 环境下运行

任何投入将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-15T12:33:15.943

我不使用 Continuum，但在某些应用程序部署过程中会遇到此 OC4J 消息。

错误消息显示您正在部署的 EAR 中缺少 application.xml 文件。您正在主实例中部署一个名为 rss 的应用程序。在 rss.ear 文件中必须存在一个 META-INF/application.xml，其内容如下：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE application PUBLIC "-//Sun Microsystems, Inc.//DTD J2EE Application 1.3//EN"
        "http://java.sun.com/dtd/application_1_3.dtd">
<application>
    <display-name>rss</display-name>
    <module>
           <ejb>rss.jar</ejb>
    </module>
</application> 
```

在构建过程的某些步骤中，您必须定义并包含 application.xml 文件。也许您使用的工具可以做到这一点，但需要一些配置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-29T15:08:25.123

我听说有时这是一个 Windows 问题。我还注意到，在使用 oc4j 服务器适配器的 Eclipse 中，当我的发布命令由于任何错误而无法部署我的战争时，我会看到这种行为。然后下次我尝试发布/部署时会显示“无法找到/读取文件 META-INF/application.xml”的错误，并且部署失败，必须重复一次。就好像失败的部署在错误的地方留下了一些残余物。不是解决方案只是一些观察...

# c# - 多态类型和 IXmlSerializable

> ID：631852
> 
> 赞同：9
> 
> 时间：2009-03-10T19:18:04.677
> 
> 标签：c#, xml-serialization

.NET 中的 XML 序列化允许通过构造函数的`extraTypes[]`参数实现多态对象。`XmlSerializer`它还允许为实现`IXmlSerializable`.

但是，我无法将这两个功能结合起来——正如这个最小的示例所示：

```
using System;
using System.IO;
using System.Xml;
using System.Xml.Schema;
using System.Xml.Serialization;

namespace CsFoo
{
    public class CustomSerializable : IXmlSerializable
    {
        public XmlSchema GetSchema() { return null; }
        public void ReadXml(XmlReader xr) { }
        public void WriteXml(XmlWriter xw) { }
    }

    class CsFoo
    {
        static void Main()
        {
            XmlSerializer xs = new XmlSerializer(
                typeof(object),
                new Type[] { typeof(CustomSerializable) });

        xs.Serialize(new StringWriter(), new CustomSerializable());
    }
} 
```

最后一行抛出`System.InvalidOperationException`此消息：

> 类型 CsFoo.CustomSerializable 不能在此上下文中使用 CsFoo.CustomSerializable 作为参数、返回类型或类或结构的成员，参数、返回类型或成员必须声明为类型 CsFoo.CustomSerializable（它不能是对象）。CsFoo.CustomSerializable 类型的对象不能用于无类型集合，例如 ArrayLists。

通过动态生成的 XML 程序集，我们最终通过调用返回到 .NET 标准库代码：

```
System.Xml.Serialization.XmlSerializationWriter.WriteTypedPrimitive(
     String, String, Object, Boolean) : Void 
```

反过来，这会导致：

```
protected Exception CreateUnknownTypeException(Type type)
{
    if (typeof(IXmlSerializable).IsAssignableFrom(type))
    {
        return new InvalidOperationException(
            Res.GetString("XmlInvalidSerializable",
            new object[] { type.FullName }));
    }

    // Rest omitted... 
```

反射器显示`XmlInvalidSerializable`资源与上面的字符串对应——即， `WriteTypedPrimitive`不喜欢`IXmlSerializable`。

如果我们生成一个非多态序列化器，像这样：

```
XmlSerializer xs = new XmlSerializer(typeof(CustomSerializable)); 
```

.NET 将生成对以下内容的调用：

```
System.Xml.Serialization.XmlSerializationWriter.WriteSerializable(
    IXmlSerializable, String, String, Boolean) : Void 
```

这处理`IXmlSerializable`得当。有人知道为什么.NET 在多态情况下不使用这个函数吗？查看 XML 序列化程序生成的 C#，在我看来这可以很容易地完成。这是我从 XML 序列化程序获得的一些代码，其中包含未经测试的解决方案：

```
void Write1_Object(string n, string ns, global::System.Object o, 
   bool isNullable, bool needType)
{
    if ((object)o == null)
    {
        if (isNullable) WriteNullTagLiteral(n, ns);
        return;
    }
    if (!needType)
    {
        System.Type t = o.GetType();
        if (t == typeof(global::System.Object))
        {
        }
>>> patch begin <<<
+         else if (typeof(IXmlSerializable).IsAssignableFrom(t))
+         {
+             WriteSerializable((System.Xml.Serialization.IXmlSerializable)
                   ((global::CsFoo.CustomSerializable)o), 
+                  @"CustomSerializable", @"", true, true);
+         }
>>> patch end <<<
        else
        {
            WriteTypedPrimitive(n, ns, o, true);
            return;
        }
    }
    WriteStartElement(n, ns, o, false, null);
    WriteEndElement(o);
} 
```

这是出于技术原因还是仅是功能限制？不支持的功能，还是我的白痴？我的 intertubes 谷歌技能让我失望。

我确实在这里找到了一些相关的问题，其中“ [C# Xml-Serializing a derived class using IXmlSerializable](https://stackoverflow.com/questions/527902/c-xml-serializing-a-derived-class-using-ixmlserializable) ”最为相关。它让我相信这根本不可能。

`IXmlSerializable`在这种情况下，我目前的想法是在根基类中注入一个默认实现。然后一切都将是`IXmlSerializable`.NET 不会抱怨。我可以使用 Reflection.Emit为每种具体类型生成`ReadXml`和`WriteXml`主体，生成看起来与使用库之一相同的 XML。

有些人在遇到 XML 序列化问题时会想“我知道，我将使用 Reflection.Emit 来生成代码”。现在他们有两个问题。

* * *

PS注意; 我知道 .NET 的 XML 序列化的替代方案，并且知道它有局限性。我也知道保存 POCO 比处理抽象数据类型要简单得多。但是我有一堆遗留代码，并且需要对现有 XML 模式的支持。

`SomeOtherXML`因此，虽然我很欣赏那些表明这在, `YAML`, `XAML`, `ProtocolBuffers`, `DataContract`, `RandomJsonLibrary`,`Thrift`或您的库中是多么容易的回复`MorseCodeBasedSerializeToMp3`——嘿，我可能会学到一些东西——但我希望的是一个 XML 序列化程序的解决方法，如果不是解决方案的话。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-28T03:18:59.903

使用时，我能够重现您的问题`object`：

```
XmlSerializer xs = new XmlSerializer(
    typeof(object),
    new Type[] { typeof(CustomSerializable) }); 
```

但是，我随后创建了一个派生类`CustomSerializable`：

```
public class CustomSerializableDerived : CustomSerializable
{
} 
```

并试图序列化它：

```
XmlSerializer xs = new XmlSerializer(
    typeof(CustomSerializable),
    new Type[] { typeof(CustomSerializableDerived) }); 
```

这行得通。

因此，问题似乎仅限于您将“对象”指定为要序列化的类型的情况，但如果您指定了具体的基本类型，则不会。

我会在早上做更多的研究。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-13T23:21:23.157

首先海报声明

> .NET 中的 XML 序列化允许通过 XmlSerializer 构造函数的 extraTypes[] 参数实现多态对象。

具有误导性。根据[MSDN](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx) ， extratypes 用于：

> 如果**属性**或**字段返回**一个**数组**，则 extraTypes 参数指定可以插入到数组中的对象。

这意味着如果在您的序列化对象图中的某处通过数组返回多态对象，则可以处理它们。

虽然我还没有真正找到如何将多态类型序列化为根 XML 对象的解决方案，但我能够使用标准 XML 序列化程序或 IXmlSerializable 序列化对象图中的多态类型。我的解决方案见下文：

```
using System.IO;
using System.Xml;
using System.Xml.Schema;
using System.Xml.Serialization;

namespace CsFoo
{
  public class Foo
  {
    [XmlElement("BarStandard", typeof(BarStandardSerializable))]
    [XmlElement("BarCustom", typeof(BarCustomSerializable))]
    public Bar BarProperty { get; set; }
  }

  public abstract class Bar
  { }

  public class BarStandardSerializable : Bar
  { }

  public class BarCustomSerializable : Bar, IXmlSerializable
  {
    public XmlSchema GetSchema() { return null; }
    public void ReadXml(XmlReader xr) { }
    public void WriteXml(XmlWriter xw) { }
  }

  class CsFoo
  {
    static void Main()
    {
        StringWriter sw = new StringWriter();
        Foo f1 = new Foo() { BarProperty = new BarCustomSerializable() };
        XmlSerializer xs = new XmlSerializer(typeof(Foo));

        xs.Serialize(sw, f1);
        StringReader sr= new StringReader(sw.ToString());
        Foo f2 = (Foo)xs.Deserialize(sr);
    }
  }
} 
```

请注意，使用

```
XmlSerializer xs = new XmlSerializer(typeof(Foo), 
            new Type[] { typeof(BarStandardSerializable),
            typeof(BarCustomSerializable)}); 
```

或者

```
[XmlInclude(typeof(BarCustomSerializable))]
[XmlInclude(typeof(BarStandardSerializable))]
public abstract class Bar
{ } 
```

如果没有定义 XmlElement，将导致代码在序列化时失败。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-29T01:09:14.100

为了使 IxmlSerializable 工作，该类需要有一个 null 构造函数。

考虑一个基类

*   MyBaseXmlClass:IXmlSerializable
    -- 实现 GetSchema
*   MyXmlClass:MyBaseXmlClass
    -- ReadXml
*   *   写XML

# iphone - NavigationController 中的静态 SegmentedControl，加载适当的 ViewController

> ID：631853
> 
> 赞同：0
> 
> 时间：2009-03-10T19:18:28.390
> 
> 标签：iphone, objective-c

我有 2 个单独的 TableViewControllers。在一个特定的实例中，我希望能够加载一个 ViewController，它将在 NavigationController 中放置一个 SegmentedControl ......这反过来将加载适当的 TableViewController。

目前我有 SegmentedControl 只是推送正确的 TableViewController，如果我手动启动推送它工作正常。但是，如果我尝试在 ViewDidAppear 之前的任何时间进行推送，则推送的 TableViewController 将不会显示任何内容..它会跟踪一切正常。

需要注意的是，这 2 个 TableViewConrollers 都足够不同，以至于我不能只使用一个控制器并切换数据源。

有什么建议么 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T20:48:00.670

您可能希望拥有一个包含两个表控制器的视图控制器，而不是将表视图控制器推送到导航控制器。然后，将其中一个表视图添加为视图控制器视图的子视图。即当分段控制器切换时，您执行以下操作：

```
[self.tableController1.view removeFromSuperview];
[self.view addSubview self.tableConttroller2.view]; 
```

您可能还必须向`view[Will/Did][Appear/Disappear]`表控制器发送适当的消息，以确保它们已正确初始化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T03:10:48.927

我实际上为我的问题找到了一个更好的解决方案，所以如果有人有兴趣......

## 在 viewController 中创建子导航控制器...

*   在 viewController 中创建一个 UINavigationController
*   将它的委托分配给 viewController
*   将 navigationController 的视图作为子视图添加到 viewController
*   隐藏 viewController 的 navigationBar (self.navigationController.navigationBarHidden = YES;)
*   在 viewController 中实现以下 2 个协议：

```
 -(void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated{
    [viewController viewWillAppear:animated];
}
-(void)navigationController:(UINavigationController *)navigationController didShowViewController:(UIViewController *)viewController animated:(BOOL)animated{
    [viewController viewDidAppear:animated];
} 
```

Bam，你在 UINavigationController>viewController 中有一个 UINavigationController
希望这对某人有帮助！

# regex - 使用带有正则表达式的目录名批量重命名文件

> ID：631856
> 
> 赞同：1
> 
> 时间：2009-03-10T19:19:34.410
> 
> 标签：regex, file

给定以下文件/目录结构：

```
/photos/1/original/filename1.jpg
/photos/1/thumb/filename1.jpg
/photos/2/original/filename2.jpg
/photos/2/thumb/filename2.jpg
/photos/3/original/filename3.jpg
/photos/3/thumb/filename3.jpg 
```

...ETC。我正在寻找将文件/目录结构转换为的正则表达式：

```
/photos/1/original.jpg
/photos/1/thumb.jpg
/photos/2/original.jpg
/photos/2/thumb.jpg
/photos/3/original.jpg
/photos/3/thumb.jpg 
```

...ETC。我有脚本可以在 ruby​​ 或 perl 中重命名文件……只是缺少正确的正则表达式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T19:22:34.840

Perl 解决方案

```
$newfn = $oldfn;
$newfn =~ s/(original|thumb)[^\.]*/$1/;
rename($oldfn, $newfn); 
```

根据要求，匹配任何关键字，而不仅仅是“original”或“thumb”，假设 /photos/nn 保持不变：

```
$newfn = $oldfn;
$newfn =~ s?(photos/\d+/[^/]*)/[^\.]*?$1?;
rename($oldfn, $newfn); 
```

如果目录为空，则调整此解决方案以删除目录

```
$newfn = $oldfn;
$newfn =~ s?(/photos/\d+/)([^/]*)/[^\.]*?$1$2?;
rename($oldfn, $newfn);
unlink($1$2); 
```

我不确定如果在您取消链接时目录不为空，这会做什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T20:33:00.100

这是一个红宝石解决方案：

```
require 'fileutils'

old_file = "/photos/1/original/filename1.jpg"
new_file = old_file.sub(/(\d+)\/(\w+)\/.+(\.\w+)/, '\1/\2\3')
FileUtils.mv(old_file, new_file) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:07:59.160

改编 Paul Tomblin 的解决方案并提供更通用的重命名：

```
my $newfn = $oldfn;
$newfn =~ s%(/\d+/[^/]+)/[^/]+(\.[^./]+)$%$1$2%; 
```

让我们用 'x' 选项扩展它：

```
$newfn =~ s%
                (              # start remembering
                /\d+/          # /397/
                [^/]+          # original, thumb, othername, ...
                )              # stop remembering
                /              # directory
                [^/]+          # filename within directory
                (\.[^./]+)$    # remember extension matching to end of name
           %
                $1$2           # /397/original.png
           %x; 
```

（未经测试 - 可能有错别字。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T20:41:05.617

注意：虽然这不能直接回答您的问题，但我认为您仍然会发现这很有用。Linux 和 cygwin 都有命令“ `rename`”和“ `mmv`”（多次移动），可以满足这个需求。鉴于您的目录结构和您的请求，您可以使用以下`rename`命令轻松解决此问题：

```
cd /photos/1/original
rename filename original *.jpg
mv *.jpg ..
cd ../thumb
rename filename thumb *.jpg
mv *.jpg ..
cd ../2
  .... (repeat for other directories) 
```

您必须检查手册页`mmv`，但看起来您可以执行以下操作（未经测试）：

```
cd /photos
mmv "*/original/filename*.jpg" "./#1/original#2.jpg"
mmv "*/thumb/filename*.jpg" "./#1/thumb#2.jpg" 
```

这将重命名文件并将文件移动到您希望处理的整个文件树的所需目录中。双引号是强制性的。

# c# - 类设计 C# 命名空间分离

> ID：631863
> 
> 赞同：0
> 
> 时间：2009-03-10T19:20:43.190
> 
> 标签：c#, architecture, class-design

我仍在尝试锻炼功能分离以及它如何应用于类创建和命名空间包含。我有一个自定义类 SoftwareComponent，当呈现给用户时，它最常显示为 ListItem。创建 ToListItem 方法是个好主意吗？我担心，因为我现在在类中放置了一个依赖项，这将需要包含 System.Web.UI.WebControls 命名空间。

```
 public ListItem ToListItem()
    {
        ListItem li = new ListItem();
        li.Text = ComponentName + " (+" + ComponentCost + ")";
        li.Selected = Selected;

        return li;
    } 
```

我的另一个倾向是根据其在类本身之外的属性从 SoftwareComponent 创建一个 ListItem。请就哪种方法更合适/更好提供任何想法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T19:32:47.340

你不能提供这个额外的方法作为扩展方法吗？它似乎更适合成为实用程序类的一部分，可以通过创建提供此功能的静态方法而不是在主类上将其作为第一类方法提供来作为选择包含在内。

```
public static class SoftwareComponentExtensions
{
    public static ListItem ToListItem(this SoftwareComponent component)
    {
        ListItem li = new ListItem(component.ComponentName + " (+" + component.ComponentCost + ")");
        li.Selected = component.Selected;

        return li;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:32:33.863

听起来 SoftwareComponent 是一个域对象 - 一个描述您的应用程序所使用的世界中的“事物”的对象。

我尽量避免使这些域对象依赖于域之外的任何东西——这可能是较低级别（它是如何存储的？它是否序列化？存储在数据库中）或 UI 级别。

我同意这样做很困难，通常您最终会使用单独的类层次结构来管理 - ui 类、数据库映射等。因此，根据您构建的东西的大小，在域对象中包含 UI 或数据库代码或将内容排除在外是一种权衡。

对于特定问题，您可以查看 C#3.5 扩展方法。它们是使静态方法看起来像是在类中定义的一种花招​​——只要它们不访问私有/受保护的东西（它们只能像任何其他方法一样访问公共方法），你就可以摆脱它们. 但是，我将它们用于您想做的事情（域对象的 UI 级“方法”），但这些事情在别处定义。

但请记住，对于静态类中的旧静态方法来说，扩展方法只不过是语法糖。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T19:36:49.593

我不会让 SoftwareComponent 知道 ListItems 等。显然，必须**有人**知道如何获取 SoftwareComponent 并将其片段塞入 ListItem，但我认为这不是 SoftwareComponent 关心的问题。

每次需要让它为另一个 UI 元素工作或从它的属性构造一些新类时，问问自己是否会添加一个新的 ToXYZ() 方法。不太可能，我猜。

# php - 上传冲突的 PHP 临时文件名

> ID：631871
> 
> 赞同：10
> 
> 时间：2009-03-10T19:22:01.813
> 
> 标签：php, file-upload, temporary-files

当一个用户上传一个文件时，它会随机被另一个用户的上传替换，我终于找到了 PHP 的问题，并且 tmp 文件名被重用了。有没有办法来解决这个问题？有没有办法制作更好的随机名称？它似乎随着时间的推移而退化，因为随机文件名种子变弱了？这是 PHP 5.2.8 和 FreeBSD 7.0

这是一个日志，显示如何使用相同的 tmp 文件名并被另一个上传覆盖：http: [//pastebin.com/m65790440](http://pastebin.com/m65790440)

任何帮助是极大的赞赏。我已经尝试解决这个问题超过 4 个月，并且随着时间的推移变得更糟。谢谢你。

编辑：请记住，这不是 PHP 代码问题，这发生在它到达任何 PHP 代码之前，通过 $_FILES['name']['tmp_name'] 收到的文件在收到并被跟踪时不正确返回它在到达上传处理脚本之前被其他人的上传覆盖

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-07-19T16:52:57.477

在将相关代码追踪到 FreeBSD 7 的 libc 实现中的[_gettemp](http://fxr.watson.org/fxr/source/stdio/mktemp.c?v=FREEBSD7-LIBC#L99)之后，我不清楚文件的内容是如何`tmp_name`无效的。（要跟踪它，您可以下载 PHP 5.2.8 的副本并读取`main/rfc1867.c`1018 行调用 in `main/php_open_temporary_file.c`，该函数从第 227 行开始，它在从第 97 行开始的函数中执行它的主要工作，然而，它本质上是只是系统上 mkstemp 的一个包装器，它位于第 66 行（链接）的[FreeBSD libc 实现中，它使用](http://fxr.watson.org/fxr/source/stdio/mktemp.c?v=FREEBSD7-LIBC#L66)[_gettemp](http://fxr.watson.org/fxr/source/stdio/mktemp.c?v=FREEBSD7-LIBC#L99)（与上面相同）实际生成随机文件名。但是[mkstemp 的手册页](http://www.unix.com/man-page/FreeBSD/3/mktemp/)在 BUGS 部分中提到该[`arc4random()`函数](http://fxr.watson.org/fxr/source/gen/arc4random.c?v=FREEBSD7-LIBC)是不可重入的。它*可能*有 2 个同时请求进入关键代码部分并返回相同的可能性`tmp_name`- 我对 Apache 如何与 mod_php 或 php-cgi 一起工作知之甚少，无法在此处发表评论（尽管使用 FastCGI/php-cgi 可能有效 - 我可以'此时不能成功评论）。

但是，针对最简单的解决方案，如果您没有完全体验到文件`tmp_name`本身无效，而是与其他上传的文件发生冲突（例如，如果使用 tmp_name 的文件名部分作为存储文件名中唯一性的唯一来源），由于[生日悖论](http://en.wikipedia.org/wiki/Birthday_problem)，您可能会面临碰撞。在[另一个问题](https://stackoverflow.com/questions/467973/best-way-to-copy-millions-of-files-between-2-servers)中，您提到要移动大约 5,000,000 个文件，在[另一个问题](https://stackoverflow.com/questions/609064/php-file-uploads-being-hijacked-by-partial-uploads)中，您提到每天要接收 30-40k 上传。这让我觉得这是生日悖论碰撞的主要情况。mktemp[手册页](http://www.unix.com/man-page/FreeBSD/3/mktemp/)提到（如果像 PHP 那样使用六个“X”）有 56,800,235,584 个可能的文件名（62 ** 6 或 62 ** n，其中 n =“X”的数量等）。但是，鉴于您有超过 500 万个文件，发生冲突的概率[大约为 100%](http://www.google.com/search?q=1-e**%28%28-5000000*%284999999%29%2F2%29%2F%282*56800235584%29%29)（另一个启发式方法表明，如果 ((files*(files-1)) /2)/(62**6) 表示任何东西，其中文件 = 5,000,000)。如果这是您面临的问题（很可能，*如果*不向生成的上传文件名添加进一步的熵），您可以尝试类似`move_uploaded_file($file['tmp_name'], UPLOADS.sha1(mt_rand().$file['tmp_name']).strrchr($file['name'], '.'))`的方法 - 为随机文件名添加更多随机性，防止冲突。另一种方法是在第 134 行添加两个“X”`main/php_open_temporary_file.c`并重新编译。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T19:32:24.237

听起来您的 PHP 安装或 PHP 内部用于生成随机文件名的任何系统调用（很可能是[tempnam](http://www.opengroup.org/onlinepubs/000095399/functions/tempnam.html)）都存在严重问题。

对于其他人：PHP 在处理用户代码之前在内部处理上传的文件。这些名称存储在`$_FILES['file']['tmp_name']`（其中“文件”是表单上文件输入元素的（引用）名称）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:28:10.630

PHP 是否在 apache 下运行`mod_php`？

您可以尝试**[创建一个每个进程的临时上传目录](http://www.php.net/mkdir)**，其名称包含您的 php [`getmypid()`](http://us2.php.net/getmypid)，然后是[`ini_set`](http://www.php.net/ini_set)您的 PHP 进程'`upload_tmp_dir`到该目录。`php`如果为每个请求生成一个新进程，这将不起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:28:58.257

上传文件后将文件移动到用户目录。这些临时文件应该被删除。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-10T19:25:57.233

我建议使用 GUID 生成器作为文件名，因为你得到了这么多。

# asp.net - IIS6 | 应用程序池 | ASP.NET 框架

> ID：631874
> 
> 赞同：3
> 
> 时间：2009-03-10T19:22:39.987
> 
> 标签：asp.net, iis-6

在 IIS6 中，可以在同一个应用程序池中运行多个 ASP.NET 应用程序。这很好，除了 IIS6 中没有任何东西可以阻止您在同一个池中运行多个 .NET 版本。

当您在 IIS7 中创建应用程序池时，您必须明确声明 .NET 版本将在该池中运行。在 IIS7 中，在同一个应用程序中运行多个 .NET 版本是不可能的。

如何在我的 IIS6 服务器上强制执行此类规则，以防止我的部署团队产生此类问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T19:28:30.487

我做什么：

步骤 1\. 创建以下应用程序池：

.NET 1.1 应用程序
.NET 2.0 应用程序

步骤 2。禁用“默认应用程序池”

现在，任何时候在 IIS 中配置新应用程序时，它都不会立即运行，因为默认应用程序池已禁用。这会强制配置应用程序的人员选择适用于应用程序的 .NET 框架版本的应用程序池。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T04:26:35.780

我们倾向于每个站点使用一个应用程序池，以便每个应用程序都隔离在自己的进程空间中。应用程序池回收只会影响单个应用程序，每个工作进程最终都会拥有自己的 4gb 内存空间。编程不当的应用程序没有机会影响其他应用程序，从而导致高度孤立的部署模型。

我们还在运行 32 位应用程序池的 x64 操作系统构建上进行了标准化。虽然使用这种技术存在开销，因为每个应用程序 ppol 都包含一个单独的 .Net 框架副本，但我们认为应用程序空间的增加粒度增加了我们部署的稳定性。您还可以将每个应用程序作为其自己的域身份运行，从而进一步隔离内存空间并消除在 Web 配置中模拟身份的任何需要。

使用 IIS 7，您可以将每个应用程序池作为 32 位或 64 位运行，因此您可以在 64 位应用程序池中运行大内存应用程序。IIS 7 应用程序池的安全性也得到了简化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T19:26:36.670

如果我没记错的话，您还可以在 IIS6 (Windows 2003) 中设置应用程序池。每个正在使用的框架版本创建一个应用程序池。

我不知道强制执行应用程序使用的 .NET 框架版本的任何可能性。如果您设置了一个应用程序池以使用 .NET 1.1，并且您在该应用程序池中运行了一个 .NET 2.0 应用程序，您将在应用程序中遇到异常（黄屏死机），因为它不会找到一些引用的程序集和类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:27:18.027

我不认为你可以。我所做的是在 IIS 6 中命名我的应用程序池，以便它们显示它们托管的 .Net 版本。这样在创建新应用程序时很容易选择正确的应用程序池。

# javascript - 使用文本框水印时 Javascript 事件不会冒泡

> ID：631875
> 
> 赞同：1
> 
> 时间：2009-03-10T19:23:15.930
> 
> 标签：javascript, jquery, jquery-events, watermark

我正在尝试在文本框上实现一个简单的水印，当文本框获得焦点时它会消失。我发现这个 jQuery 插件看起来很好用：

[http://remysharp.com/2007/01/25/jquery-tutorial-text-box-hints/](http://remysharp.com/2007/01/25/jquery-tutorial-text-box-hints/)

水印的工作方式与以下代码所宣传的一样：

```
<script type="text/javascript" src="/includes/_jQuery/_Library/jquery-1.3.1.min.js"></script>
<script type="text/javascript" src="/includes/_jQuery/_plugs/_hint/jquery.hint.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("input[title!=]").hint();
    });
</script>

<table>
    <tr>
        <td><input type="text" title="Blah" /></td>
    </tr>
</table> 
```

但是，当向表格的单击事件添加警报时，我发现当您单击文本框有文本的部分时，该事件不会冒泡。但是，当您单击没有文本的文本框部分时，它会很好地冒泡。这是我用来创建警报的 jQuery 代码：

```
 $("table").click(function() {
            alert("blah");
        }); 
```

有谁知道为什么单击文本框的一部分时事件没有冒泡，而另一个则没有？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T20:16:58.530

> 有没有人知道为什么单击文本框的一部分时事件没有冒泡

这似乎是影响文本输入和文本区域的 Firefox 特定错误。您只需几行代码即可重现它，它与 jQuery 无关或与插件无关：

```
<form onclick="alert('hello')">
    <input type="text" value="hello!" onfocus="this.value=''">
</form> 
```

（虽然我认为该插件确实存在一些相当严重的问题。它忘记在局部变量上使用“var”，让它们泄漏到全局范围。这使得同一页面上的多个“.blur”元素失败。加上“空”值仍将作为标题字符串提交到表单，并且您无法区分用户键入的与标题字符串匹配的“真实”值。）

*只有在焦点事件中更改*输入值时，该事件才会冒泡。推测性地，我的猜测是 Firefox 在内部识别 click() 发生在输入内的文本上，并期望将该事件冒泡到每个文本的祖先。但是当直接父级上的单击事件导致 onfocus 触发时，该函数正在从其父级中删除文本。现在没有发生 click 事件，没有父链可以冒泡。

# iphone - iPhone 添加对 Backgrounder 的支持

> ID：631878
> 
> 赞同：0
> 
> 时间：2009-03-10T19:24:14.913
> 
> 标签：iphone

我正在尝试为我的个人使用创建一个使用 Backgrounder 的应用程序。Backgrounder 是否有任何先决条件可以使用该应用程序，因为它拒绝将我的应用程序置于后台。

我看过 Backgrounder 的 wiki 和 Google 代码页，上面写着“如果您希望在后台运行非 AppStore 3rd-party 应用程序，建议您联系应用程序的作者并请求适当的后台支持添加。 ”

但是没有关于它的其他信息......并且邮件列表是......在哪里？加入这个小组也是一个谜。

什么构成“适当的背景支持”？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-11T09:17:44.817

尝试查看它[http://code.google.com/p/iphone-backgrounder/wiki/Documentation](http://code.google.com/p/iphone-backgrounder/wiki/Documentation)

希望这可以帮助。

一个。

# c - 库初始化——Win32实现中的pthread_once

> ID：631879
> 
> 赞同：4
> 
> 时间：2009-03-10T19:24:43.477
> 
> 标签：c, winapi, initialization

你好。我正在尝试为我的库创建一个完全线程安全的初始化函数，但我无法轻易找到 pthread_once 的替代方法，它应该很容易解决问题。我来到了这段代码：

```
 void libInit (void)
{
#ifdef WIN32
    static volatile int initialized = 0;
    static HANDLE mtx;

    if (!initialized)
    {
        if (!mtx)
        {
            HANDLE mymtx;
            mymtx = CreateMutex(NULL, 0, NULL);
            if (InterlockedCompareExchangePointer(&mtx, mymtx, NULL) != NULL)
                CloseHandle(mymtx);
        }

        WaitForSingleObject(mtx);
        if (!initialized)
        {
            libInitInternal();
            initialized = 1;
        }
        ReleaseMutex(mtx);
    }
#else
    static pthread_once_t initialized = PTHREAD_ONCE_INIT;

    pthread_once(&initialized, libInitInternal);
#endif
} 
```

该`libInitInternal()`调用导致一个线程不安全的函数，该函数初始化库。

我想听听关于我可能做错了什么或您是否知道更好的解决方案的任何建议。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-11T02:31:03.530

我认为您想使用[一次性初始化](http://msdn.microsoft.com/en-us/library/aa363808(VS.85).aspx)功能。在同步模式下，所有线程都会阻塞，直到第一个调用它的线程完成。似乎类似于 pthread_once()。

这里有[示例代码](http://msdn.microsoft.com/en-us/library/ms686934(VS.85).aspx)。

所以在你的情况下，你会说：

```
BOOL CALLBACK CallLibInitInternal(PINIT_ONCE InitOnce, PVOID Parameter, PVOID *lpContex) {
    libInitInternal();
    return TRUE;
}

void libInit() {
#ifdef WIN32
    static INIT_ONCE s_init_once;
    InitOnceExecuteOnce(&s_init_once, CallLibInitInternal, NULL, NULL);
#else
...
#endif
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T16:58:50.823

您可能想检查[pthreads-win32](http://sourceware.org/pthreads-win32/)在其[pthread_once()](http://sourceware.org/cgi-bin/cvsweb.cgi/pthreads/pthread_once.c?rev=1.8.2.6&content-type=text/x-cvsweb-markup&cvsroot=pthreads-win32)实现中的作用。或者只是使用它，如果这被证明更容易的话。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-11T02:15:27.450

在查看**pthread_once()**的以下源代码（来自[此处](http://www.filewatcher.com/p/libc-5.4.35.tar.bz2.1334800/libc/sysdeps/pthreads/mit/pthread_once.c.html)）之后，看起来您走在正确的轨道上。

```
int pthread_once(pthread_once_t *once_control, void (*init_routine)(void))
{
    /* 首先检查速度 */
    if (once_control->state == PTHREAD_NEEDS_INIT) {
        pthread_mutex_lock(&(once_control->mutex));
        if (once_control->state == PTHREAD_NEEDS_INIT) {
            初始化例程（）；
            一次控制->状态= PTHREAD_DONE_INIT；
        }
        pthread_mutex_unlock(&(once_control->mutex));
    }
    返回（确定）；
}

```

顺便说一句，我将使用**pthread_once()**来替换我的代码中一些相当复杂的函数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-12T17:55:58.913

使用 GCC 或 clang 时，可以使用构造函数和析构函数属性。它们适用于共享库和静态库，并分别在 main 运行之前和之后执行代码。此外，您可以指定多个构造函数和析构函数。比单例方法干净得多，并且不需要您记住从 main() 调用 libInit()。

```
static void __attribute__((constructor))
your_lib_init(void)
{
    fprintf(stderr, "library init\n");
}

static void __attribute__((destructor))
vensim_ctx_destroy(void)
{
    fprintf(stderr, "library destroy\n");
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T22:19:24.680

我会看看这篇文章。这是 C++ 单例的解决方案，但我相信您也可以将解决方案用于您的代码：[http ://www.ddj.com/cpp/199203083?pgno=1](http://www.ddj.com/cpp/199203083?pgno=1)

遗憾的是，QLock 本身的清单不见了，看起来他们好像在试图出售 CD，但似乎有足够的描述来自己写一张。

# python - Windows上python中的base64 png

> ID：631884
> 
> 赞同：11
> 
> 时间：2009-03-10T19:25:42.710
> 
> 标签：python, windows, base64

如何在 Windows 上使用 python 将 png 图像编码为 base64？

```
iconfile = open("icon.png")
icondata = iconfile.read()
icondata = base64.b64encode(icondata) 
```

以上在 Linux 和 OSX 中运行良好，但在 Windows 上它将编码前几个字符，然后缩短。为什么是这样？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-10T19:29:26.880

[以二进制模式打开文件](http://docs.python.org/tutorial/inputoutput.html#reading-and-writing-files)：

```
open("icon.png", "rb") 
```

我对 Windows 不是很熟悉，但我想发生的事情是文件包含一个字符 (0x1A)，当它以文本模式打开时， [Windows 将其解释为文件的结尾（出于遗留原因）。](http://www.google.com/search?q=windows+end+of+file+character)另一个问题是在 Windows 上以文本模式（不带“b”）打开文件会导致行尾被重写，这通常会破坏二进制文件，其中这些字符实际上并不表示行尾。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-10T22:16:13.953

为了增加 Miles 的答案，[PNG 文件中的前八个字节](http://www.libpng.org/pub/png/spec/1.2/PNG-Rationale.html#R.PNG-file-signature)是专门设计的：

*   89 - 第一个字节是一个检查位 8 没有被剥离
*   "PNG" - 让别人读到它是 PNG 格式
*   0d 0a - DOS 行尾指示符，检查是否有 DOS->unix 转换
*   1a - DOS 文件结束符，检查文件是否以二进制模式打开
*   0a - unix 行尾字符，检查是否有 unix->DOS 转换

您的代码按照设计在 1a 处停止。

# branch - 分支地狱，风险与生产力的临界点在哪里？

> ID：631900
> 
> 赞同：7
> 
> 时间：2009-03-10T19:29:34.667
> 
> 标签：branch, versioning

我的公司正在考虑将我们的版本号扩展另一个档次（例如从major.minor.servicepack 到major.minor.servicepack.customerfix），以允许客户特定的修复。

从表面上看，这让我觉得这是个坏主意，因为我的经验是产品的分支越多（我相信客户修复程序是代码库的分支），开销就越大，工作量越分散，最终开发效率就越低组变成。

我见过很多风险与生产力的讨论，但仅仅说“我认为这是一个坏主意”还不够。关于过于规避风险并采用繁重的、客户特定的源代码分支开发模型的实际成本有哪些文献？

一点澄清。我希望这个模型意味着客户可以控制哪些错误修复进入他们自己的私有分支。我认为他们很少会升级到通用后备箱（它甚至可能不存在于这个模型中）。我的意思是，如果你可以控制自己的私人现实泡沫，你为什么要这样做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T19:33:16.607

不能帮助文学，但客户特定的分支*是*一个坏主意。去过也做过。调试这些东西简直是地狱，因为当然你必须拥有所有这些客户特定的版本*来*重现错误......一段时间后，公司不得不对应用程序进行*完全*重写，因为代码库已经完全变了*不可维护*。（将客户特定的部分移动到配置文件中，这样每个客户都在同一个代码行上。）

不要去那里。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T20:23:52.493

我同意它通常处理客户修复的开销很高，但我不会说不要这样做。

如果他们想要那么多关注，我会说向客户收取一条胳膊和一条腿（以及他们一些）。否则不要做客户分支机构。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:51:54.720

在我的旅行中，我个人没有看到任何关于大多数良好实践的明确文献，尽管我怀疑那里有很多东西。

版本号提供了一种非常简单的机制，可以将特定的版本与特定的代码更改集联系起来。从技术上讲，版本号有多少级别并不重要，只要开发人员努力确保每发布一个“唯一”版本，都有一个“唯一”版本号。

逻辑规定，为了限制支持成本（这是巨大的，通常比开发成本更糟糕），一个合理的组织更愿意在现场运行最少数量的“独特”版本。一个会很棒，但是在现实世界中通常有很多。这是成本与便利性的问题。

通常，第一个数字表示这一系列版本不向后兼容。下一个数字说它大部分是，但有一些事情发生了变化，最后一个数字说有些东西是固定的，但文件都是正确的。使用这种方式，您不需要第四个数字，即使您已应部分客户的要求进行了一些特定的修复。选择更多地由客户端驱动不应该对您的编号方案产生任何影响（因此这是一个坏主意）。

基于客户要求的分支是绝对的疯狂。一个主干是必不可少的，因此每次分支时都会产生大量技术债务。分行够多，你再也付不起利息了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T22:24:54.247

您将进入客户分支的更改描述为“修复”。因为它们是修复，我假设它们也将在主干中制作，并且实际上只是未来错误修复的高级交付。如果是这种情况，为什么不创建一个新的“服务包”（来自问题：major.minor.servicepack）并将该版本提供给客户。

1.  例如，您发布版本 1.2.3。
2.  客户 #1 需要修复，创建版本 1.2.4 并将其提供给客户 #1。
3.  客户 #2 需要一个修复，板条箱版本 1.2.5，将其提供给客户 #2，并宣传他们也可以“免费”获得临时修复。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T22:47:33.690

不确定文献但是......如果您甚至有机会支持客户特定的修复，那么至少有一个分支和版本控制策略似乎是明智的。尽管我希望永远不要使用该策略。

我想危险在于您最终会形成一种文化，在这种文化中，客户特定的修复变得可以接受并成为常态，而不是解决导致需要修复的真正问题。

我猜真正的成本将在很大程度上取决于它是否只是在下一个版本之前让客户满意的临时错误修复，或者它是否更像是一次性定制。如果只是前者，而且数量不是太高，我也不会太担心。但是，如果它的定制我会被吓傻。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-11T05:35:34.040

**如果您能找到一种方法来编译您的一个产品并在他们的中央构建的“配置”中打开/关闭每个客户的功能，这可能是值得弄清楚的事情。**

这样的事情最好通过基于配置文件/配置/角色的设置来完成。

您可能必须保护一组客户端的自定义设置，或者他们都可以从中受益。那部分取决于你。

通过这种方式，您可以构建自定义视图、自定义代码、自定义角色、自定义代码等等。但是，它们是一个项目的一部分。

不要不惜一切代价维护同一产品的多个代码库。我做过一次，如果每个系统处于最糟糕的位置，则每个系统至少需要 1 小时进行一小时的更改。这是自杀。

一定要分享你最终做了什么！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-06-11T15:47:06.943

以我的经验，当很难解释应该如何通过分支传播错误修复时，就达到了临界点。

分支地狱是一个问题，因为人们不知道哪个分支中有什么。如果传播规则过于复杂，人们在分支之间传播更改时就会开始犯错误，这就是你创建分支地狱的方式。

如果“Cisco”分支提出了一个缺陷并且我们修复了它，我们应该将修复传播到“IBM”分支的当前版本，还是只传播到“IBM”分支的下一个版本？如果 IBM 提出同样的缺陷会怎样？如果 IBM 甚至不使用包含缺陷的特性怎么办？如果 IBM 稍后提出与高优先级相同的缺陷怎么办？对于多个客户分支，传播规则从来都不是简单的，因此它们几乎可以保证分支地狱。

# delphi - 如何关闭特定的 Delphi 警告和提示？

> ID：631902
> 
> 赞同：6
> 
> 时间：2009-03-10T19:29:55.867
> 
> 标签：delphi, compiler-construction, warnings, delphi-2007

在 CodeGear Delphi 2007 中，如何关闭特定的警告和提示？我正在尝试关闭 H2077 - 分配给“varname”的值从未使用过。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-10T21:20:38.753

您无法像警告一样禁用特定提示。提示是那些不会对您的运行时代码产生任何潜在不利影响的东西。例如，当您看到提示“分配给 'varname' 的值从未使用过”时，它只是建议您可能应该在代码中“清理”一些内容，但它不会导致任何潜在的运行时错误（除了您的当然是自己的逻辑错误:-)。提示总是最好通过调整代码来解决。

另一方面，警告是那些**可能**导致意外运行时行为并且**确实**应该解决的事情。例如，在为其赋值之前使用变量显然是未初始化变量的情况，这可能导致“坏事”。在绝大多数情况下，应该通过“修复”代码来解决警告。即便如此，在某些情况下，您可能会将警告视为“误报”，并确定代码运行正常。在这些情况下，您可以禁用特定警告。禁用所有警告是危险的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-10T19:34:19.367

提示？[没有具体](https://stackoverflow.com/questions/444443/can-specific-delphi-hints-be-disabled)的。

您必须全部禁用它们：

```
{$HINTS OFF} 
```

警告？

```
{$WARN _name_of_warning_ OFF|ON|ERROR} 
```

在这里查看[完整列表](https://stackoverflow.com/questions/376785/identifiers-for-delphis-warn-compiler-directive)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-10T19:47:22.377

您为什么不更改代码以使提示消失？这些提示通常非常准确。如果你真的觉得这行代码（我猜是一些变量初始化或其他）对你的代码的读者有用，即使它与编译器无关，你可以用注释替换它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-10T20:59:27.430

拉斯说的话。此外，您可以通过按两次 CTRL-O 获得完整的警告列表及其当前设置。它会在当前单元的顶部转储一个列表。您可以浏览那里找到您需要更改的那个。请记住稍后删除该列表，否则以后查看代码的人会讨厌您。;)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-05-08T18:30:18.693

要删除具有以下内容的代码行的提示：

> H2077 分配给“%s”的值从未使用过

您可以将其包装在：

```
{$HINTS OFF}
//...
{$HINTS ON} 
```

例如，从越野车`Vcl.ComCtrls.pas`：

```
procedure TTrackBarStyleHook.Paint(Canvas: TCanvas);
//....
begin
   if not StyleServices.Available then Exit;

   {$HINTS OFF}
   Thumb := ttbTrackBarDontCare; //value assigned to 'Thumb' never used
   {$HINTS ON}

   //...
end; 
```

> **注意**：任何发布到公共领域的代码。无需归属。

# django - 你怎么知道 memcached 是否在做任何事情？

> ID：631903
> 
> 赞同：87
> 
> 时间：2009-03-10T19:30:01.793
> 
> 标签：django, memcached, django-cache

我正在测试使用 memcached 来缓存 django 视图。如何判断 memcached 是否真的在缓存 Linux 命令行中的任何内容？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-10T19:59:11.070

你可以使用官方的 perl 脚本：

```
memcached-tool 127.0.0.1:11211 stats 
```

或者只使用 telnet 和 stats 命令，例如：

```
# telnet localhost [memcacheport]
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
stats
STAT pid 2239
STAT uptime 10228704
STAT time 1236714928
STAT version 1.2.3
STAT pointer_size 32
STAT rusage_user 2781.185813
STAT rusage_system 2187.764726
STAT curr_items 598669
STAT total_items 31363235
STAT bytes 37540884
STAT curr_connections 131
STAT total_connections 8666
STAT connection_structures 267
STAT cmd_get 27
STAT cmd_set 30694598
STAT get_hits 16
STAT get_misses 11
STAT evictions 0
STAT bytes_read 2346004016
STAT bytes_written 388732988
STAT limit_maxbytes 268435456
STAT threads 4
END 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2011-08-08T23:18:51.157

我知道这个问题很老，但这是用 django 测试 memcached 的另一种有用方法：

正如@Jacob 提到的，您可以以非常详细的模式（而不是作为守护进程）启动 memcached：

```
memcached -vv 
```

要测试您的 django 缓存配置，您可以使用低级缓存 api。

1.  首先，启动 python 解释器并加载你的 django 项目设置：

    ```
    python manage.py shell 
    ```

2.  在 shell 中，您可以使用低级缓存 API 来测试您的内存缓存服务器：

    ```
    from django.core.cache import cache
    cache.set('test', 'test value') 
    ```

如果您的缓存配置正确，您应该会在 memcache 中看到类似于以下内容的输出：

```
<32 set :1:test 0 300 10
>32 STORED 
```

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2009-04-09T16:35:52.587

启动 memcache 不是作为守护进程而是正常的，所以运行`memcached -vv`非常冗长。您将看到 get 和 set 何时进入 memcache 服务器。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-18T14:47:26.873

测试 memcache 工作的简单方法是在提供的每个页面上潜入注释掉的时间戳。如果对一个页面的多个请求的时间戳保持不变，则该页面正在被 memcache 缓存。

在 Django 设置中，我还设置了缓存机制以在文件系统上使用文件缓存（真的很慢），但是在打开页面后，我可以看到文件路径中放置了实际的缓存文件，因此我可以确认缓存是活跃于 Django。

我使用这两个步骤来解决我的缓存问题。我实际上没有在 Django 中正确打开缓存。激活缓存的较新方法是使用“django.middleware.cache.CacheMiddleware”中间件（不是具有两个必须是第一个/最后一个中间件设置的中间件的中间件。）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-08-07T12:22:21.240

在命令行中，尝试以下命令：

```
echo stats | nc 127.0.0.1 11211 
```

如果它没有返回任何东西，则内存缓存没有运行。否则它应该返回一堆统计数据，包括正常运行时间（以及命中和未命中计数）

参考文章在这里， [https://www.percona.com/blog/2008/11/26/a-quick-way-to-get-memcached-status/](https://www.percona.com/blog/2008/11/26/a-quick-way-to-get-memcached-status/)

要每 2 秒查看一次更改：

```
watch "echo stats | nc 127.0.0.1 11211" 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-03-07T01:34:45.607

Memcached 实际上可以自行写入日志文件，而无需手动重新启动它。`/etc/init.d/memcached`init 脚本（在EL7+ 上；呃）可以使用在（或在 EL5+ 上）`/usr/lib/systemd/system/memcached.service`中指定的选项调用 memcached 。这些选项包括详细程度和日志文件路径。`/etc/memcached.conf``/etc/sysconfig/memcached`

简而言之，您只需将这两行添加（或取消注释）到该 conf/sysconfig 文件中...

```
-vv
logfile /path/to/log 
```

...并使用`service memcached restart`(EL3-7) 或`/etc/init.d/memcached restart`(debuntus)重新启动守护进程

然后你可以用传统的方式来监控这个日志，比如`tail -f /path/to/log`，例如。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-04-12T17:18:02.373

在 Bash 中，您可以通过以下命令查看 memcache 的统计信息：

```
exec 3<>/dev/tcp/localhost/11211; printf "stats\nquit\n" >&3; cat <&3 
```

要刷新缓存，请使用`memflush`命令：

```
echo flush_all >/dev/tcp/localhost/11211 
```

并检查统计数据是否增加。

要转储所有缓存的对象，请使用`memdump`或`memcdump`命令（`memcached`/`libmemcached`包的一部分）：

```
memcdump --servers=localhost:11211 
```

或者：

```
memdump --servers=localhost:11211 
```

如果您使用的是 PHP，要查看是否支持，请检查：`php -i | grep memcached`。

* * *

## 追踪

要检查 memcached 进程究竟在处理什么，您可以使用网络嗅探器或调试器（例如`strace`在 Linux 上或`dtrace`/`dtruss`在 Unix/OS X 上）。检查下面的一些示例。

### 追踪

```
sudo strace -e read,write -fp $(pgrep memcached) 
```

要以更好的方式格式化输出，请检查：[如何将 shell 中的 strace 解析为纯文本？](https://stackoverflow.com/q/36557017/55075)

### 桁架

Dtruss 是 dtrace 包装器，可在 Unix 系统上使用。运行它：

```
sudo dtruss -t read -fp $(pgrep memcached) 
```

### Tcpdump

```
sudo tcpdump -i lo0 -s1500 -w- -ln port 11211 | strings -10 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-09-07T17:17:54.407

对于扩展节点的响应，您可以使用`socat UNIX-CONNECT:/var/run/memcached.sock STDIN`调试 unix 套接字。

例子：

```
$ socat UNIX-CONNECT:/var/run/memcached.sock STDIN
stats
STAT pid 931
STAT uptime 10
STAT time 1378574384
STAT version 1.4.13
STAT libevent 2.0.19-stable
STAT pointer_size 32
STAT rusage_user 0.000000
STAT rusage_system 0.015625
STAT curr_connections 1
STAT total_connections 2
STAT connection_structures 2 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-08-25T22:20:42.867

您可以通过以下脚本测试 memcached 或任何服务器

```
lsof -i :11211 | grep 'LISTEN'>/dev/null 2>/dev/null;echo $? 
```

如果它返回 0 则服务器实际上正在运行，或者如果 1 不是这样，如果您想知道服务器实际上正在某个端口上运行，请使用以下脚本

```
lsof -i :11211 | grep 'LISTEN'>/dev/null 2>/dev/null;
if [ $? -eq 0]; then
    echo "Your memcache server is running"
else
    echo "No its not running"
fi 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-10T19:37:19.187

您可以使用 curl 获取页面数百次并计算结果吗？您还可以查看在执行此操作时在服务器上运行一个模拟繁重 CPU/磁盘负载的进程。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-06-23T21:51:46.420

我编写了一个`expect`脚本`is-memcached-running`来测试 memcached 是否在主机/端口组合上运行（运行为`is-memcached-running localhost 11211`）：

```
#! /usr/bin/env expect
set timeout 1
set ip [lindex $argv 0]
set port [lindex $argv 1]
spawn telnet $ip $port
expect "Escape character is '^]'."
send stats\r
expect "END"
send quit\r
expect eof 
```

如果您根据`Makefile`规则运行系统，则可以使您的启动依赖于断言它已启动并运行（或帮助您获得该状态）的 make 目标。当检查无法让我们轻松调试失败的 ci 运行时，它是冗长的，当它丢失时安装 memcached，并且是简短的，否则：

```
#! /bin/bash
if [[ "$(type -P memcached)" ]]; then
  echo 'memcached installed; checking if it is running'
  memcached_debug=`mktemp memcache-check.XXXXX`
  if is-memcached-running localhost 11211 >$memcached_debug 2>&1; then
    echo 'Yep; memcached online'
  else
    cat $memcached_debug
    echo
    echo '****** Error: memcached is not running! ******'
    if [[ "$OSTYPE" =~ ^darwin ]]; then
      echo
      echo 'Instructions to auto-spawn on login (or just start now) are shown'
      echo 'at the end of a "brew install memcached" run (try now, if you did'
      echo 'not do so already) or, if you did, after a "brew info memcached".'
      echo
    fi
    exit 1
  fi
  rm -f $memcached_debug
else
  echo memcached was not found on your system.

  if [[ "$OSTYPE" =~ ^darwin ]]; then
    brew install memcached
  elif [[ "$OSTYPE" =~ ^linux ]]; then
    sudo apt-get install memcached
  else
    exit 1
  fi
fi 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-03-21T14:17:34.497

在 Aryashree 发布之后，如果 memcached 没有在本地运行，这有助于我得到一个错误：

```
import subprocess

port = 11211
res = subprocess.Popen(f"echo stats | nc 127.0.0.1 {port}", 
        shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

if res.stdout:
    lines = res.stdout.read() 
    lineArr = lines.split('\r\n')
    pidlineArr = lineArr[0].split(' ')
    pid = pidlineArr[-1]
    print(f"[MemCached] pid {pid} Running on port {port}")

else:
    raise RuntimeError(f"No Memcached is present on port {port}") 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-12-09T17:37:39.143

我正在使用夹层，唯一对我有用的答案是 Jacobs 的答案。所以停止守护进程并运行`memcached -vv`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-02-23T15:17:41.677

如果您使用 RHEL 或 Centos 8 将 memcached 日志内容获取到 /var/log/messages（无需轮换即可快速）

[https://serverfault.com/questions/208538/how-to-specify-the-log-file-for-memcached-on-rhel-centos/1054741#1054741](https://serverfault.com/questions/208538/how-to-specify-the-log-file-for-memcached-on-rhel-centos/1054741#1054741)

# html - 消息的语义 HTML

> ID：631905
> 
> 赞同：2
> 
> 时间：2009-03-10T19:30:23.120
> 
> 标签：html, semantic-markup

我正在制作一个小型网络聊天实用程序，并正在寻找有关将哪些元素用于消息的建议。

这是我目前正在考虑使用的内容：

```
<p id="message-1">
    <span class="timestamp" id="2009-03-10T12:04:01+00:00">
        12:04
    </span>
    <cite class="admin">
        Ross
    </cite> 
    Lorem ipsum dolor sit amet.
</p> 
```

我会在这里利用 CSS 在时间戳周围添加括号、`cite`d 用户的图标等。我认为为每条消息使用 a 会很愚蠢（而且不正确）`blockquote`，尽管我认为`cite`它指的是用户是正确的那张贴了这条消息。

我知道这不是 a) 一门精确的科学和 b) 完全必要的，但我更喜欢使用有意义的元素而不是`span`贯穿始终。还有其他我应该考虑的因素吗？任何微格式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T19:52:49.557

HTML 在可定制的方式中不是很语义化。尽管如此，您的格式在任何浏览器中都应该是可以理解的（正如您所指出的，使用适当的 CSS）。

我在上面的代码示例中看到的内容与 XML 非常相似。对于您的需求来说，这可能会很麻烦且过大，但我想指出，您*可以*将 XML 与 XSLT 一起使用来替代 (X)HTML。通过这种方式，您可以获得尽可能语义化的标签，而无需妥协 HTML 标签的限制。

w3schools 有[一篇](http://www.w3schools.com/XML/xml_xsl.asp)关于该主题的文章。我可以发誓我在其中看到了一个`sun.com`用 XML 完成的网页，但我再也找不到它了。

如果您不打算由第三方软件解释或解析它，我仍然建议不要使用这种方法，并坚持使用经过验证的 HTML。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-11T16:04:55.397

If you're going for semantic HTML, you'll probably want to know that [HTML5](http://www.whatwg.org/specs/web-apps/current-work/multipage/text-level-semantics.html#the-cite-element) doesn't consider your use of the `<cite>` element correct anymore.

> A person's name is not the title of a work — even if people call that person a piece of work — and the element must therefore not be used to mark up people's names.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T19:45:21.507

对我来说似乎是合理的，除了“id”无效。NAME 标记不能以数字开头或包含“+”。

另外，如果两个人同时说话，您将拥有非唯一的 ID。也许该数据应该放在另一个属性中，例如“标题”（因此您可以将鼠标悬停以查看确切的时间戳）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T19:54:36.260

```
<ol>
    <li class="message" value="1">
        <span class="timestamp" id="2009-03-10T12:04:01+00:00">
            12:04
        </span>
        <cite class="admin">
            <address class="email">
                <a href="mailto:ross@email.com">
                    Ross
                </a>
            </address>
        </cite> 
        Lorem ipsum dolor sit amet.
    </li>
</ol> 
```

我会尝试类似上面的方法。请注意，我已将所有内容放在有序列表中，因为注释可以以适合有序列表的线性方式进行解释。此外，我在您的 Cite 标记中嵌入了一个带有 Anchor 元素的地址标记。不幸命名的 Address 元素实际上是为了传达作者的联系信息，因此您可能希望在此处链接到作者的电子邮件地址。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T19:47:12.627

你的建议已经很好了。如果您想更进一步，并且能够使用相同的标记（以较重的 html 为代价）允许大量不同的演示选项，您可能需要执行以下操作：

```
<dl class="message" id="message-1">
    <dt class="datetime">Datetime</dt>
    <dd class="datetime">
        <span class="day">Wed</span>
        <span class="dayOfMonth">11</span>
        <span class="month">Mar</span>
        <span class="year">2009</span>
        <span class="hourMin">17:34</span>
        <span class="sec">33</span>
    </dd>
    <dt class="author">Author</dt>
    <dd class="author">Ross</dd>
    <dt class="message">Message</dt>
    <dd class="message">Lorem ipsum dolor sit amet</dd>
</dl> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T20:13:59.863

由于您在问题中提到了微格式，因此您无疑已经熟悉[微格式 wiki](http://microformats.org/wiki/Main_Page)。它包含大量适用于不同情况的示例。

另一种可能性是借用[SIOC](http://en.wikipedia.org/wiki/SIOC)的部分内容，其中包括论坛的本体——非常类似于聊天。

通过重用现有格式，您可以利用[Operator](https://addons.mozilla.org/firefox/addon/4106)等插件和工具，并可能免费从您的应用中获得更多收益。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-11T16:39:43.287

我会使用 XML 和 XSLT 来转换（样式）数据。

这在语义上是有意义的，但您也可以使用适合存档的格式（即 XML）进行对话 - 我假设您将拥有某种日志或“历史记录”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-18T21:25:05.340

正如@bobince 所说，`id="2009-03-10T12:04:01+00:00"`是无效的。

你应该改变这个：

```
<span class="timestamp" id="2009-03-10T12:04:01+00:00">
    12:04
</span> 
```

对此：

```
<time class="timestamp" datetime="2009-03-10T12:04:01+00:00">
    12:04
</time> 
```

[您可以在HTML5 Doctor](http://html5doctor.com/the-time-element/)和[W3C](http://www.w3.org/html/wg/drafts/html/master/text-level-semantics.html#the-time-element)获得有关该`time`标签的更多信息：

> HTML5 上的`time`标签提供了一个新元素，用于为机器明确编码日期和时间，同时仍以人类可读的方式显示它们。
> 
> 该`time`元素表示 24 小时时钟上的时间，或预测公历中的精确日期，可选择带有时间和时区偏移量。

...

我同意`ol`@Robotsu 发布的有序列表 ( ) 解决方案，除了我刚刚发布的时间标签和不正确的`address`内部`cite`标签！

# php - 清理垃圾的工具 PHP

> ID：631916
> 
> 赞同：0
> 
> 时间：2009-03-10T19:33:09.760
> 
> 标签：php

我刚刚继承了一个 70k 行的 PHP 代码库，现在我需要在其中添加增强功能。我见过更糟糕的情况，至少这个代码库使用 MVC 架构并且是面向对象的。但是，没有模板系统，并且许多类已被弃用 - 仅被调用一次。我认为我的方法可能如下：

1.  找到在线服务器上 48 小时内没有被触及的所有文件，并将它们作为删除的候选者（幸好有在线服务器）。
2.  实现一个模板系统（Smarty）并尝试在模板中找到重复的代码。
3.  很多方法都复制和粘贴了代码……我不知道我有多想弄乱它。

我的问题是：是否有我应该采取或您会采取的步骤？你的处理方法是什么？是否有工具可以帮助查找重复的 PHP 代码？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T20:37:12.833

> 找到直播服务器上48小时内没有被触碰过的所有文件，作为删除的候选（幸好有直播服务器）

通过“触摸”，我假设您将统计文件以查看它是否已被系统的任何部分访问。我会花一个半月而不是 48 小时。在较旧的 PHP 代码库中，您经常会发现周围有一堆代码，这些代码每周或每月一次通过本地 cron 作业调用，或者第三方定期将其作为伪服务远程调用. 通过等待 6 周，更有可能捕获所有正在调用的文件。

> 实现一个模板系统（Smarty）并尝试在模板中找到重复的代码。

为什么？严肃的问题，是否有理由实施模板系统？（不精通 PHP 的设计师、开发人员会因为在视图中包含过多的逻辑而给您带来麻烦，或者您是创建模板的人，并且您知道自己在 smarty 中的工作速度比在 PHP 中快得多）。如果没有，请避免使用 PHP。

另外，实现一个纯 smarty 模板系统有多现实？我很有可能像这样的旧 PHP 系统将有大量的“业务逻辑”与他们的视图混合在一起，这些视图无法在纯 smarty 中实现，如果您允许混合 PHP/Smarty，您的开发人员将使用PHP 每次。

> 很多方法都复制和粘贴了代码……我不知道我有多想弄乱它。

我不知道有什么代码分析工具可以开箱即用，但是可以使用[标记器功能](http://us3.php.net/manual/en/ref.tokenizer.php)来做一些事情。

## 你真正应该做什么

我不想劝阻你或让你士气低落，但你为什么要清理这段代码？现在它正在做应该做的事情。愚蠢，但它正在这样做。每个重构项目都会将当前的、未记录的、可能是业务关键的功能置于风险之中，并且在该工作结束时，您将拥有一个执行完全相同的事情的应用程序。这是 70k 行听起来像是伪劣的代码，只有你关心修复，不管其他人告诉你他们的优先级是什么。如果他们的优先级是干净的代码，那么他们的代码就已经是干净的了。一个人无法改变一种文化。除非有一个直接的商业案例来清理该代码（将项目开源作为商业策略？），否则遗留代码不会去任何地方。

这是旧 PHP 应用程序需要考虑的一组不同的优先级

1.  是否有一个单例数据库对象或一对对象允许开发人员轻松设置单独的读取（从属）和写入（主）连接。许多遗留 PHP 应用程序将在单个页面调用中实例化到同一个数据库的多个连接，这是一场性能噩梦。

2.  开发人员是否有避免 SQL 注入的直接方法？将其提供给他们以获取新代码（参数化 SQL），并考虑修复旧 SQL 以使用此新方法，但还要考虑您可以在网络级别采取的安全措施。

3.  获得一个包含所有遗留代码的某种测试框架，并将其视为黑盒。使用这些测试来创建一个集中的 API，开发人员可以使用它来代替他们一直在使用的无数函数调用和复制/粘贴代码。

4.  为配置值开发一个集中式系统，大多数遗留 PHP 代码都是定义和类常量的糟糕组合，这意味着任何配置更改都意味着代码推送，这意味着潜在的 DOOM。

5.  开发一个连接到源代码控制系统的 lint 来强制所有新代码的代码健全性，[不仅仅是为了样式](http://pear.php.net/package/PHP_CodeSniffer)，而是为了确保业务逻辑不在视图之外，以安全的方式构建 SQL，那些未使用旧的复制/粘贴库等。

6.  开发一个理智的、可跟踪的构建和/或推送系统，并阻止人们在生产中对代码进行黑客攻击

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T20:14:55.027

我不知道任何特定的工具，但我致力于重构一些相当大的 PHP 项目。

我会推荐一个模板系统，无论是 Smarty 还是严格的 PHP 系统，都可以清楚地向从事该项目的任何人解释。

采取离散的、可管理的部分并定期重构（例如，这周，我将重新编写它）。不要咬得比你能咀嚼的更多，也不打算完全重写。

此外，我对可疑函数和文件进行定期代码搜索（我使用 Eclipse 并搜索项目中的文件）。有些人太害怕做出大的改变，但我宁愿在大胆的一面犯错，而不是接受凌乱和组织不良的代码。准备好测试，测试，测试！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T06:00:38.847

您需要确定重构的充分理由。删除重复代码并不是一个很好的方法；它需要与真正需要的改进相结合，例如减少内存占用（如果网络服务器正在挣扎，这很有用）。

一旦你记住了这一点，现在你就可以开始重构了。并确保您也有一个版本控制存储库。只是不要检查损坏的代码。

不要对一次性课程过于草率。许多小型 PHP 框架都是这样工作的。不过，通常它们可以更好地抽象出来。此外，很多 PHP 代码也不理解数据层抽象，结果导致 SQL 代码散布在业务逻辑甚至显示代码中。此问题通常与没有自定义数据库处理程序相结合，如果您突然不得不教它有关复制或缓存的知识，这将是一个问题。这是另一个方向的相同抽象问题。

一个非常实用的步骤：一旦你开始抽象出重复的代码，你就会找到打开多个文件的理由。如果您使用的是 shell 和 Unix 编辑器，那么 screen 将极大地帮助您。

# c# - 短暂的对象

> ID：631919
> 
> 赞同：11
> 
> 时间：2009-03-10T19:33:32.520
> 
> 标签：c#, .net, memory-management, garbage-collection

生成大量“年轻”（在垃圾收集间隔期间从未提升到下一代）的临时对象（即用于临时结果）的开销是多少？我假设“新”操作非常便宜，因为它实际上只是一个指针增量。然而，处理这些临时“垃圾”的隐性成本是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-10T19:38:03.583

不是很多——垃圾收集器对于 gen0 来说非常快。它还会自行调整，根据每次运行时设法收集的数量来调整 gen0 的大小。（如果设法收集很多，它将减小 gen0 的大小以便下次更早收集，反之亦然。）

最终的测试是*您的*应用程序的性能如何。Perfmon 在这里非常方便，显示在 GC 中花费了多少时间，每一代有多少次收集等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T19:38:34.677

正如您所说，分配本身非常便宜。生成大量短期对象的成本是更频繁的垃圾收集，因为它们是在第 0 代的预算用尽时触发的。但是，第 0 代收集相当便宜，因此只要您的对象确实是短暂的，开销很可能并不显着。

另一方面，在循环中连接大量字符串的常见示例会显着推动垃圾收集器，因此这完全取决于您创建的对象数量。考虑分配并没有什么坏处。

垃圾回收的代价是托管线程在压缩期间被挂起。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:38:42.303

一般来说，这不是你应该担心的事情，听起来它开始非常接近“微优化”。GC 的设计假设一个“调整良好的应用程序”将在 Gen0 中拥有所有分配 - 这意味着它们都“年轻而死”。任何时候你分配一个新对象，它总是在 Gen0 中。在通过 Gen0 阈值并且 Gen0 中没有足够的可用空间来容纳下一次分配之前，不会发生收集。

“新建”操作其实是一堆东西：

1.  分配内存
2.  运行类型构造函数
3.  返回指向内存的指针
4.  递增下一个对象指针

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T19:41:56.010

尽管新操作的设计和编写效率很高，但它不是免费的，并且确实需要时间来分配新的内存。内存分配库需要跟踪哪些块可用于分配，并将新分配的内存归零。

创建大量年轻时死亡的对象也会更频繁地触发垃圾收集，并且该操作可能会很昂贵。尤其是“停止世界”垃圾收集器。

这是 MSDN 上关于其工作原理的文章：http: [//msdn.microsoft.com/en-us/magazine/bb985011.aspx](http://msdn.microsoft.com/en-us/magazine/bb985011.aspx)

注意：它描述了调用垃圾收集是多么昂贵，因为它需要在开始垃圾收集之前构建对象图。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T19:38:55.703

如果这些对象从未从第 0 代中提升出来，那么您将看到相当不错的性能。我能看到的唯一隐藏成本是，如果您超出第 0 代预算，您将强制 GC 压缩堆，但 GC 会自我调整，所以这不是什么大问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T19:39:15.627

垃圾收集在 .Net 中是分代的。短暂的物体将首先且频繁地收集。Gen 0 集合很便宜，但根据您创建的对象数量的规模，它可能非常昂贵。我会运行一个分析器来确定它是否会影响性能。如果是，请考虑将它们切换为结构。这些不需要收集。

# css - IE6 红十字和边框图像周围

> ID：631920
> 
> 赞同：3
> 
> 时间：2009-03-10T19:34:00.413
> 
> 标签：css, internet-explorer, image

## 主要更新：

## **我在网站上有一个 PNG 修复程序。当我删除 PNG 修复红色十字和边框消失。奇怪的是，问题似乎只与这个特定的图像有关。同一页面上还有其他 Alpha Blended PNG，可以很好地呈现。**

图像没有损坏（您可以看到），也不是链接。但是 IE6 和 7 都在它周围放了一个盒子，并在上面放了一个红十字。它还剥离了样式。

[![替代文字](https://i.stack.imgur.com/myzpJ.png)](https://i.stack.imgur.com/myzpJ.png)

更新：图像不是背景图像，图像绝对没有损坏。您实际上可以看到图像，在 Safari、Firefox、Chrome 和 Opera 中运行良好。

这是一个普通的旧常规图像标签

```
<div class='container'>
    <img src='../images/leader_concierge.png' class='page_leader'  width="917" height="257" />
</div> 
```

这是CSS

```
.page_leader { margin: 10px 0; } 
```

这在 safari 中也是一样的

[![替代文字](https://i.stack.imgur.com/aXN5O.png)](https://i.stack.imgur.com/aXN5O.png)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-21T03:11:13.770

您缺少替换 gif。

所有 PNG 修复方法都需要一个透明的 gif 来替换 png 图像，这是替换工作方式的一部分。如果该 gif 丢失，那么即使 PNG 绘制得很好，您也会得到这种损坏的图像外观。

对于 iepngfix.htc，它期望文件位于 /images/spacer.gif

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:54:06.730

在带有 Web Developer Toolbar 的 Firefox 中，您可以查看损坏的图像。在 Firefox 中，图像仍然会损坏，但您不会看到像 IE6 和 IE7 那样的显示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:15:38.330

请注意，在 xhtml 中（好吧，您关闭了 img 标签）您应该使用 " 而不是 '。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T03:18:46.313

如果您使用的是 iepngfix.htc，您需要打开它并设置空白图像路径。图片必须是 1x1 .gif。

看起来我只是勉强被打败了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-29T02:08:57.643

是的，我遇到了同样的问题，而且 iepngfix.htc 也允许在 IE6 中透明。

是的，按照说明，所需的随附 gif 图像位于 images 文件夹中。

所以我进入了 htc 文件并输入了确切的链接，现在一切正常！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-10T19:57:39.387

Firefox 和“其他浏览器”更优雅地处理损坏的图像，但图像几乎可以肯定是损坏的 - 他们只是没有渲染它。也许尝试养成定期检查您的站点日志以查找 404 的习惯，因为在现代浏览器中您的图像损坏并不总是很明显。

编辑：鉴于您最近的发现，也许可以用 TweakPng 之类的方式打开有问题的[png](http://entropymine.com/jason/tweakpng/) - 您可能会发现有导致这种行为的块可以安全地删除。将受影响的 png 与正常工作的 png 进行比较，并删除有问题的块。

# reporting-services - 动态列

> ID：631923
> 
> 赞同：1
> 
> 时间：2009-03-10T19:34:19.663
> 
> 标签：reporting-services

这是我的问题。我正在传递一个参数，假设它被称为`ShapesSelected`. `ShapeSelected = ",Square, Triangle, Circle,"`.
问题`ShapeSelected`可能是任何形状，所以它永远不会`static`。

基于此参数，我想在报告中的表格右侧添加 3 列。这可能吗？我已经开始`Custom Code`在报告属性中对其进行编码，但我被困在如何添加列中。

```
Public Function GetReportShapes( ByVal ShapesSelected As String )                 
    Dim Shapes() As String
    Dim result As String
    Dim i As Integer

    Entities = Split(ShapesSelected ,", ")

    For i = 0 To UBound ( Shapes)
             Select case Shapes(i)
               case "Square": 'add Square Column here
                    case "Rectangle": add Rectange Column here  
               case "Triangle": add Triangle Column here
        End Select  
    Next i

End Function 
```

因此呈现这样的列：

```
Square  Triangle   Circle 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:38:39.170

添加您需要的所有列，并使用带有 vb 表达式的隐藏或可见属性（我忘记了）来打开和关闭它们。

# cocoa - 创建核心数据反向关系

> ID：631924
> 
> 赞同：3
> 
> 时间：2009-03-10T19:34:29.397
> 
> 标签：cocoa, core-data

我正在尝试编写我的第一个 Cocoa 应用程序，而 Core Data 使我的数据对象建模变得困难。我有两个要操作的实体：`Account`和`Transaction`. `Account`有一个人类可读的名称，仅此而已。`Transaction`存储一个货币价值，并引用两个名为`debitAccount`and的帐户`creditAccount`（我正在开发一个双帐簿会计应用程序）。

我希望能够找到所有`Transactions`给定的`Account`，无论他们使用`debitAccount`还是`creditAccount`. 我怎样才能做到这一点？有没有一种方法可以轻松地与 Cocoa UI 绑定一起工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T20:45:45.187

如果我对您的理解正确，您希望 Transaction 通过两个关系与 Account 相关联：`debitAccount`并且`creditAccount`，是吗？你想知道创建反向关系。

简而言之，一种关系只能是另一种关系的逆。因此，您将无法创建一个关系，比如说，`transactions`它是`debitAccount`and的倒数`creditAccount`。相反，你必须创建两个关系，比如`debitTransactions`和`creditTransactions`（我相信你会为这些想出更合适的名字......）

现在，由于关系被建模为集合（特别是`NSSet`s），您可以合并特定帐户的`creditTransactions`和`debitTransactions`关系以获取该帐户涉及的所有事务。

一个（可能更好的）替代方案是引入一个中间实体，其名称与`TransactionAccount`两者具有一对一的关系，`Account`以及`Transaction`一个属性，例如`accountRole`将帐户标识为相对于该特定帐户的借方或贷方帐户交易。您将在两者上创建逆对多关系，`Transaction`并`Account`使用类似`transactionAccounts`. 这样，您可以编写如下内容：

```
[account valueForKeyPath:@"transactionAccounts.transaction"] 
```

获取特定帐户的所有交易。您可以使用 an`NSPredicate`将集合过滤为仅帐户为借记/贷记帐户的交易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T16:36:55.667

对我来说效果最好（并且最有意义）的解决方案是创建一个子类`NSManagedObject`用作我的`Account`实体：

```
@interface Account : NSManagedObject {

}
-(NSArray*)getTransactions;
@end 
```

我在里面有实际的查找逻辑`-getTransactions`，手工操作并不难。到目前为止效果很好，特别是因为方法名称符合 KVO。

为了让 Core Data 返回`Account`s 而不是`NSManagedObject`s，我必须在 Xcode 的数据建模工具中更改实体的“Class”属性。

# c# - 向 WCF ServiceContract 添加方法会破坏现有客户端吗？

> ID：631935
> 
> 赞同：13
> 
> 时间：2009-03-10T19:38:09.480
> 
> 标签：c#, .net, wcf

我们有一个现有的 ServiceContract

```
[ServiceContract(Namespace = "http://somesite.com/ConversationService")]
public interface IConversationService
{
        [OperationContract(IsOneWay = true)]
        void ProcessMessage(Message message);

        [OperationContract(IsOneWay = true)]
        void ProcessMessageResult(MessageResult result);
} 
```

我们需要给它添加一个方法

```
[ServiceContract(Namespace = "http://somesite.com/ConversationService")]
public interface IConversationService
{
        [OperationContract(IsOneWay = true)]
        void ProcessMessage(Message message);

        [OperationContract(IsOneWay = true)]
        void ProcessMessageResult(MessageResult result);

        [OperationContract(IsOneWay = true)]
        void ProcessBlastMessage(BlastMessage blastMessage);
} 
```

这会破坏任何使用此服务的现有 wcf 客户端吗？还是我们必须更新所有现有的 wcf 客户端？

编辑：此服务同时使用 netTcpBinding 和 netMsmqBinding

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T19:49:07.020

我认为您现有的客户将继续工作。毕竟这与 SOAP 和 Web 服务非常相似，因为客户端将连接到给定的 URL 并请求特定的服务。如果您将方法拿走，您将面临破损的风险（我相信只有在使用该方法时），但添加应该是无痛的。

我只涉足 WCF，但以这种方式使用 ASP.NET Web 服务取得了巨大成功。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T21:24:18.277

不，我不希望 - 添加*不会*改变任何现有方法/函数调用的新功能/新服务方法不会影响“旧”客户端。当然，在他们的代理从元数据重新创建或手动调整之前，他们不会知道新方法。

但是现有的调用应该不受影响，只要它们的签名（它们交换的数据）保持不变。

马克

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-11-17T22:39:40.423

我刚刚使用 WCF 客户端 Windows 应用程序 (UWP) 对此进行了测试，并且在更新 WCF 服务应用程序后它继续工作。所以**不**：如前所述，当您添加方法时，您的客户不会中断。

不过，我认为值得一提的是，使用 Visual Studio 2015 更新服务客户端是多么容易：

1.  确保您的 WFC 服务正在运行。

2.  只需转到`Solution Explorer`,

3.  扩张`Service References`

4.  右键单击您的服务参考

5.  点击`Update Service Reference`

6.  如果您收到错误消息，请重复最后一步。由于某种原因，我不得不尝试几次。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-11T09:56:40.993

我对此持更极端的看法。为什么要改变任何东西？相反，为什么不创建一个新合约，继承旧合约并添加新操作呢？新合同可以在同一服务的单独端点中公开。

这可能是没有正式证据的偏执狂，但在我看来，如果可以构建一个可以区分差异的客户端，那么当您进行更改时，一些客户端可能会“崩溃”。考虑一下，当您更改服务合同时，您不仅仅是在更改服务代码 - 您正在更改任何碰巧更新其服务引用的客户端中的代理代码。一些更保守的客户可能会认为这是重新测试其客户端代码的理由——毕竟，他们很可能有规定，无论何时对其代码进行任何更改，他们都必须重新测试他们的代码。

现有客户端将引用原始端点，因此不会受到添加新端点的影响 - 如果执行“更新服务引用”，则不会更改任何代码。

此外，如果不必考虑，为什么还要*考虑呢？*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T19:49:38.143

通常，在 SOA 解决方案中*添加*消息不会违反合同。我相信只要你不使用二进制协议（net.tcp），你就会保持向后兼容性。

不过，我不确定它是否会破坏您的客户端使用二进制绑定？

# .net - 枚举类型的 .NET WPF XAML 命名空间映射

> ID：631947
> 
> 赞同：1
> 
> 时间：2009-03-10T19:41:09.647
> 
> 标签：.net, wpf, data-binding, xaml, enums

我将我的**W3CErrorOrWarning**类型对象的集合绑定到 WPF 窗口中的控件。

它的属性之一被命名为“类型”。它是**W3CErrorOrWarningType**类型，它是一个简单的枚举：

```
枚举 W3CErrorOrWarningType
    验证错误
    验证警告
结束枚举

```

我正在尝试以这种方式使用它...

```
<Window ...
        xmlns:enums="clr-namespace:WpfApplication1.XhtmlTextBox.W3CValidator.W3CResponse.W3CErrorOrWarning"
        ... />
    ...
    <DataTemplate>
        <Image Name="TypeIcon" ... />
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding Type}">
                <DataTrigger.Value>
                    <enums:W3CErrorOrWarningType>
                        ValidationError
                    </enums:W3CErrorOrWarningType>
                </DataTrigger.Value>
                <Setter TargetName="TypeIcon"
                        Property="Source" 
                        Value="images/Error.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Type}">
                <DataTrigger.Value>
                    <enums:W3CErrorOrWarningType>
                        ValidationWarning
                    </enums:W3CErrorOrWarningType>
                </DataTrigger.Value>
                <Setter TargetName="TypeIcon"
                        Property="Source" 
                        Value="images/Warning.png"/>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate> 
```

我收到此错误：

> 未定义的 CLR 命名空间。“clr-namespace” URI 指的是程序集中未包含的命名空间“WpfApplication1.XhtmlTextBox.W3CValidator.W3CResponse.W3CErrorOrWarning”。

我的**WpfApplication1**项目包含一个用户控件**XhtmlTextBox**。该用户控件包含一个名为**W3CValidator**的类，该类包含一个名为**W3CResponse的类，该类包含一个名为****W3CErrorOrWarning**的类，该类包含一个名为**W3CErrorOrWarningType**的枚举。

 **如何在我的 Window 的 XAML 中输入此类型的命名空间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T20:00:17.120

编辑：我认为它错了，第一次但是......

您是否在命名空间中包含枚举名称？

我应该：

```
xmlns:enums="clr-namespace:WpfApplication1.XhtmlTextBox.W3CValidator.W3CResponse 
```

考虑到以上都是命名空间而不是类型，如果 W3CResponse 是一种类型，那么您不能直接在 XAML 中使用嵌套枚举，XAML 不支持嵌套类。

[将自定义类作为 XAML 元素的要求](http://msdn.microsoft.com/en-us/library/ms753379.aspx)

> 您的自定义类不能是嵌套类

# c++ - 在 C++ 中前向声明指向结构的指针

> ID：631952
> 
> 赞同：4
> 
> 时间：2009-03-10T19:42:23.497
> 
> 标签：c++, struct, forward-declaration

我正在使用具有如下声明的 3rd 方库：

```
typedef struct {} __INTERNAL_DATA, *HandleType; 
```

我想创建一个在构造函数中采用*HandleType的类：*

```
class Foo
{
    Foo(HandleType h);
} 
```

**不**包括定义*HandleType*的标头。通常，我只是前向声明这种类型，但我无法弄清楚它的语法。我真的很想说：

```
struct *HandleType; 
```

但这在 GCC 中表示“* 之前的预期标识符”。我能看到的唯一解决方案是像这样编写我的类：

```
struct __INTERNAL_DATA;
class Foo
{
    Foo(__INTERNAL_DATA *h);
} 
```

但这依赖于库的内部细节。也就是说，它使用名称__INTERNAL_DATA，这是一个实现细节。

似乎应该可以在不使用 __INTERNAL_DATA （库实现的一部分）的情况下前向声明 HandleType （公共 API 的一部分）。有人知道怎么做吗？

编辑：添加了有关我正在寻找的内容的更多详细信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T19:46:53.440

**更新：**

> 我在 Foo 的实现 .cpp 中使用它，但我想避免将它包含在 Foo 的标头 .h 中。也许我只是太迂腐了？:)

是的，你是:) 继续向前声明。

如果 HandleType 是接口的一部分，则必须有一个标头声明它。使用该标题。

你的问题仍然是一个模糊的问题。你正试图保护你做不到的事情。

您可以将以下行添加到客户端库中：

```
typedef struct INTERNAL_DATA *HandleType; 
```

但是，如果名称/结构发生变化，您可能会遇到一些铸造问题。

尝试模板：

```
template <class T>
class Foo
{
    Foo(T h);
}; 
```

前向声明很好。如果您打算使用指针或引用，您只需要`__INTERNAL_DATA`在作用域中声明一个类 ( )。但是，如果您要使用成员函数或对象，则需要包含标头。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T20:05:26.000

```
 typedef struct {} __INTERNAL_DATA, *HandleType; 
```

如果它是这样定义的（都在一行上），那么 __INTERNAL DATA 与 HandleType 一样是公共接口的一部分。

但是，我认为`__INTERNAL_DATA`实际上并不存在。很可能，HandleType 实际上（内部）是一个 int。这个奇怪的定义只是一种定义它的方式，它与 int 大小相同，但不同，因此如果您尝试在应该传递 HandleType 的地方传递 int，编译器会给您一个错误。库供应商可以很容易地将其定义为“int”或“void*”，但这样我们就可以进行一些类型检查。

因此`__INTERNAL_DATA`，这只是一个约定，不会改变。

* * *

更新：上面有点打嗝......好吧，`__INTERNAL_DATA`绝对不存在。我们知道这是一个事实，因为我们可以*将*它的定义视为一个空结构。我猜第 3 方库使用“C”外部链接（没有名称管理），在这种情况下，*只需复制 typedef - 就可以了。*

在库本身内部，HandleType*将*有完全不同的定义；也许`int`，也许是“struct MyStruct {.......} *”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:09:22.167

如果该类型在第 3 方库中，那么前向声明的巨大好处（由于标头的更改而隔离重建）实际上会丢失。

如果您担心编译时间（它是一个相当大的头文件），那么也许您可以将它放在预编译头文件中，或者只包含库中的相关头文件。

例如，许多库标题看起来像

```
// library.h
#include "Library/Something.h"
#include "Library/SomethingElse.h" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T20:16:16.630

我不太确定您要做什么，但是以下内容将在不包括实际头文件的情况下起作用：

```
// foo.h
class Foo
{
    public:
    template<typename T>Foo(T* h) { /* body of constructor */ }
}; 
```

请注意，您仍然必须访问`__INTERNAL_DATA`构造函数体内的公共成员。

**编辑：**正如 James Curran 所指出的，该`__INTERNAL_DATA`结构没有成员，因此可以使用它，如上所述，没有问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T20:20:50.847

如果您真的，真的，真的不想将 _INTERNAL_DATA 暴露给调用者，那么您唯一真正的选择是使用**typedef void* HandleType**；然后在您的库中，您可以做任何您想做的事情，包括更改 *HandleType 的整个实现。

只需创建一个辅助函数来访问您的真实数据。

```
inline _INTERNAL_DATA* Impl(HandleType h) {
    return static_cast<_INTERNAL_DATA*>(h);
} 
```

# .net - 如何使用带有 Linq dbml 类的 web.config 的自定义配置类

> ID：631953
> 
> 赞同：1
> 
> 时间：2009-03-10T19:42:27.053
> 
> 标签：.net, asp.net, linq-to-sql

我有一个使用自定义配置类在 web.config 中存储应用程序设置的 Web 项目。我这样做是为了能够在 web.config 中存储和访问基于服务器名称的配置设置。这样，当项目从开发转移到登台再到生产时，我不必记住更改 web.config 设置，如连接字符串和其他可能因服务器而异的设置。这些类将根据部署它的服务器从 web.config 检索正确的配置设置。

这工作得很好。但是，现在我使用生成的 dbml 类将项目转换为使用 Linq。这很好，但生成的类坚持使用来自 web.config 的简单连接字符串。由于这些类是自动生成的，我不能简单地更改代码以使用我的自定义配置类。有人可以解释如何让生成的类调用我的自定义对象来检索正确的连接字符串吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:46:57.120

将连接字符串显式提供给 DataContext 构造函数会是一种更好的做法。这样，您的应用程序可以通过您的 webconfig 帮助程序获取正确的连接字符串，并且始终可以为数据上下文提供绝对正确的连接字符串。而不是依靠上下文从 webconfig 中选择合适的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:56:35.943

替代：

web.config 文件的`<connectionStrings>`元素可以采用 configSource 属性，该属性指定保存该部分数据的 XML 文件的名称。我将其设置为：

```
 <connectionStrings configSource="connections.config" /> 
```

放置一个不同的connections.config，其中包含特定于每台PC 环境的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T19:52:29.260

我没有答案，但您可能想看看 Microsoft 的示例应用程序 StockTrader，它实现了中央配置服务，我相信它使用了 Linq。我很长时间没有看过它，但它可以为您提供您正在寻找的洞察力。

抱歉，我没有直接的答案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T20:37:53.207

好像你已经得到了答案，但我想我会提供这个：

```
public MyDataContext() : 
        base(global::System.Configuration.ConfigurationManager.ConnectionStrings["MyConnectionString"].ConnectionString, mappingSource)
{
    OnCreated();
} 
```

您可以手动修改您的 .designer.cs 部分类文件并用您自己的覆盖默认的 Context 构造函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T20:45:30.210

您可以简单地将连接字符串作为参数传递给 DataContext 类的构造函数。

在这种情况下，只需像以前一样从配置中检索连接字符串，并在创建 DataContext 时将其移交。

# html - 构建 HtmlElement 对象树

> ID：631955
> 
> 赞同：4
> 
> 时间：2009-03-10T19:44:19.373
> 
> 标签：html, browser, webbrowser-control, dom

我`WebBrowser`在 C# 桌面应用程序中使用 MSIE 控件，并且正在寻找一种方法来构建和维护`HtmlElement`此控件之外的对象树。我试图在多个复杂页面之间快速切换，而不会产生每次重新解析 HTML 的开销（而且我不想维护多个根据需要显示/隐藏的控件）。我发现a）我只能`HtmlElement`通过控件创建对象，b）一旦我从控件`HtmlDocument`中删除对象的“主干” ，它就会“消失”，即使我一直保持对根元素的强引用。我怎样才能做到这一点？`HtmlElement``HtmlDocument`

PS 如果它们允许我完成上述操作，我愿意考虑替代浏览器控件（例如 Gecko）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-13T00:32:53.690

这会做到的

```
// On screen webbrowser control
webBrowserControl.Navigate("about:blank");
webBrowserControl.Document.Write("<div id=\"div1\">This will change</div>");
var elementToReplace = webBrowserControl.Document.GetElementById("div1");
var nodeToReplace = elementToReplace.DomElement as mshtml.IHTMLDOMNode;

// In memory webbrowser control to load fragement into
// It needs this base object as it is a COM control
var webBrowserFragement = new WebBrowser();
webBrowserFragement.Navigate("about:blank");
webBrowserFragement.Document.Write("<div id=\"div1\">Hello World!</div>");
var elementReplacement = webBrowserFragement.Document.GetElementById("div1");
var nodeReplacement = elementReplacement.DomElement as mshtml.IHTMLDOMNode;

// The magic happens here!
nodeToReplace.replaceNode(nodeReplacement); 
```

我怀疑这会提高性能，因为文本渲染器很快，如果您有一个带有隐藏 div 的大页面或在其他对象的内存中有多个 div，消耗的内存仍然相同？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T23:19:10.153

您可以使用 MSHTML 库 (mshtml.dll) 来实现这一点。基本上你会使用一个 about:blank 页面，然后动态地写入和删除其中的内容。

请参阅[有关此主题的博客文章](http://ryanfarley.com/blog/archive/2004/12/23/1330.aspx)

您还可以编写一个自定义界面包装器，从 mshtml 公开您需要的功能，而不是引用整个东西（近 8MB），并且在 VS 中使用 f12 非常容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T20:28:10.907

你真的需要彻底删除它们吗？如何将 DOM 中的“分支”作为样式 =“display:none”的 DIV 的子级。这样它们是真实的、活动的 DOM 对象，但不可见。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T05:16:30.280

我认为您也可以使用[htmlagilitypack](http://www.codeplex.com/htmlagilitypack) 它允许您解析一次，使用 XPath 或通过迭代器查询 HTML 树，并在完成后使用保存方法重新编写树。根据您的结构，您可能只是围绕类创建一个适配器，因为它仅适用于整个 html 文档并且您只希望它适用于元素，但这应该不会太难。

# delphi - 功能区控制错误？（导致vista中断）

> ID：631961
> 
> 赞同：2
> 
> 时间：2009-03-10T19:45:34.020
> 
> 标签：delphi, delphi-2009, ribbon

我发现当我采用仅包含功能区和状态栏的简单表单时，它会被截断。您在状态栏上方看到的控件后来被删除。无论碰巧存在什么控制，都会发生相同的截止。后来我删除了状态栏并在那里放置了一个备忘录控件，结果相同。

没有丝带栏：（ [来源：][[xrw.bc.ca](http://xrw.bc.ca/download/so/OnVista1.png)][）][![不带色带条](https://i.stack.imgur.com/9Roz8.png)](https://i.stack.imgur.com/9Roz8.png)

带丝带栏：（ [来源：][[xrw.bc.ca](http://xrw.bc.ca/download/so/OnVista2.png)][）][![带条形条](https://i.stack.imgur.com/sorOi.png)](https://i.stack.imgur.com/sorOi.png)

我已经用边缘的一些 2、4 和 8 像素来说明这一点。

[![未最大化](https://i.stack.imgur.com/2ILhB.png)](https://i.stack.imgur.com/2ILhB.png)
[（来源：[xrw.bc.ca](http://xrw.bc.ca/download/so/OnVista3.png)）][（来源：][[xrw.bc.ca](http://xrw.bc.ca/download/so/OnVista4.png)][）]
[![最大化](https://i.stack.imgur.com/LL22J.png)](https://i.stack.imgur.com/LL22J.png)

正如 Chris Lively 在下面所说，显然是对尺寸的错误计算。我该如何纠正这个？

谢谢您的意见！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T23:40:58.743

我误解了我之前的答案的问题。

对于这个计算错误的问题，我可以（很快）想出一个解决方法。

您可以使用带有 SC_MAXIMIZE wParam 参数的 WM_SYSCOMMAND 的自定义消息处理程序。然后，您可以使用以下方法调整表单大小：

```
type
  TForm1 = class(TForm)
    // other stuff
    procedure WMSyscommand(var Msg: TWMSYSCOMMAND); message WM_SYSCOMMAND;

procedure TForm1.WMSysCommand(var Msg: TWMSYSCOMMAND);
var
  R: TRect;
begin
  // Test for SC_MAXIMIZE. If found...
  if Msg.CmdType = SC_MAXIMIZE then
  begin
    SystemParametersInfo(SPI_GETWORKAREA, 0, @R, 0);
    Top := R.Top;
    Left := R.Left;
    Width := R.Right - R.Left;
    Height := R.Bottom - R.Top;
    Msg.Result := 0; // Message handled
  end
  else
    DefaultHandler(Msg);
end; 
```

上面的代码（在启用 Aero/Glass 的 Vista 32 位家庭高级版上测试）工作正常。

[![色带左端的图像](https://i.stack.imgur.com/YW4Dq.png)](https://i.stack.imgur.com/YW4Dq.png)

[![色带右端的图像](https://i.stack.imgur.com/yL7no.png)](https://i.stack.imgur.com/yL7no.png)

[![状态栏图片](https://i.stack.imgur.com/owYLs.png)](https://i.stack.imgur.com/owYLs.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-13T21:28:20.397

Ken White 提出的解决方案有几个问题：

*   最大化按钮保持活动状态，可以在最大化窗口上使用调整大小手柄
*   无法将窗口恢复到以前的大小。

所以我提出以下建议：

```
// add to form object
procedure WMGetMinMaxInfo(var mmInfo : TWMGETMINMAXINFO); message WM_GETMINMAXINFO;

// implementation
procedure TfrmMain.WMGetMinMaxInfo(var mmInfo: TWMGETMINMAXINFO);
var
  R: TRect;
begin
  with mmInfo.MinMaxInfo^ do
  begin
    SystemParametersInfo(SPI_GETWORKAREA, 0, @R, 0);
    ptMaxPosition.X := R.Left;
    ptMaxPosition.Y := R.Top;
    ptMaxSize.X     := R.Right - R.Left;
    ptMaxSize.Y     :=  R.Bottom - R.Top-1;
  end;
end; 
```

不理想，因为我必须（出于某种原因）将 maxHeight 调整为 -1 以使默认处理程序不会重新声明自身并将窗口移动到 -8,-8,... 但它对我有用。

# iphone - 如何在 iPhone 应用程序中嵌入 openads (Openx) 广告

> ID：631964
> 
> 赞同：1
> 
> 时间：2009-03-10T19:46:47.463
> 
> 标签：iphone, openx

我曾尝试在 iPhone 应用程序中使用 iframe、javascript 和图像标签广告标签，但它们都不起作用。当用户单击图像时，浏览器会启动，但没有任何反应（您会得到一个空白页面）。有人知道如何进行吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-11T12:13:28.077

继续：调试它。标准的 OpenX 点击 URL 将执行重定向。浏览器停留在哪个 URL 上？

我对 iPhone 应用程序一无所知，但我知道与 OpenX 的接口。您可能应该考虑使用 OpenX API，它允许您将所需的所有信息拉入应用程序的“后端”，然后根据需要使用它。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2010-06-07T22:50:15.803

iphone 中的 Proplem 必须处于活动状态 在 iphone safari 设置中启用 java

# c++ - 使用 Visual Studio 创建 C++ DLL

> ID：631969
> 
> 赞同：2
> 
> 时间：2009-03-10T19:47:16.620
> 
> 标签：c++, winapi, visual-c++, dll

我正在使用 Visual Studio 2008 Express Edition 创建一个简单的 C++ DLL 项目。我在命名空间中有一些类，其中的一些非静态函数和构造函数用`__declspec(dllexport)`. 所有这些功能都已实现。

我还有一个`extern "C" BOOL APIENTRY DllMain`简单地返回的函数`TRUE`。

当我点击调试（或发布）时，它成功构建，没有错误也没有警告。输出文件夹（“Debug/”或“Release/”）获取诸如“BuildLog.htm”、每个源文件一个“.obj”文件、“vc90.pdb”、“vc90.idb”、“[DLLNAME”等文件].dll.embed.manifest"、"[DLLNAME].dll.embed.manifest.res"、"[DLLNAME].dll.intermediate.manifest" 但...不是 DLL 本身。

这是我第一次尝试编译这个项目（所以我以前从未成功编译过）并且我对 C++/DLL 的经验很少，尽管我之前确实知道独立 C++ 并创建过 Linux C 共享对象。

我究竟做错了什么？我是否缺少任何特定的必需文件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T19:49:22.230

我会在目录结构（解决方案所在的那个）中查找更高一点的目录结构，看看您的 Debug/Release 文件夹（带有 DLL）是否在那里。

我认为默认是将实际的 DLL 放在解决方案目录中的文件夹中，而不是项目目录中（我认为假设您希望为解决方案构建的所有 DLL 都放在同一个地方）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T19:50:20.560

右键单击`<ProjectsName>`in `Solution Explorer View`，选择`Properties`，转到`Configuration Properties > General`选项卡并签出该`Output Directory`字段。该路径可能包含一些宏，如`$(SolutionDir)$(ConfigurationName)`等。单击它，选择`Edit`，然后在弹出一个窗口时选择`Macros`查看它们的实际含义，例如`SolutionDir`映射到哪个目录。您可以从那里推断出输出 dll 的路径。

# sql - SQL 约束问题

> ID：631979
> 
> 赞同：3
> 
> 时间：2009-03-10T19:49:48.737
> 
> 标签：sql, sql-server, constraints

在 Sql Server 2005 中，我有一个包含两个整数列的表，分别称为 Id1 和 Id2。我需要它们在表中是唯一的（使用跨越两列的唯一索引很容易）。如果值在两列之间转置，我还需要它们在表中是唯一的。

例如，SELECT * FROM MyTable 返回

```
Id1   Id2
---------
2     4
5     8
7     2
4     2  <--- values transposed from the first row 
```

如何创建一个约束以防止最后一行输入到表中，因为它们是第一行的转置值？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T19:53:31.193

创建一个绑定到用户定义函数的检查约束，该函数对表执行选择以检查转置值。

```
Create table mytable(id1 int, id2 int)
go

create Function dbo.fx_Transposed(@id1 int, @id2 int)
returns bit as 
Begin
    Declare @Ret bit
    Set @ret = 0
    if exists(Select 1 from MyTable 
        Where id2 = @id1 and id1 = @id2)
    Set @ret = 1
    Return @ret
End
GO
Alter table mytable add
CONSTRAINT [CHK_TRANSPOSE] CHECK 
 (([dbo].[fx_Transposed]([ID1],[ID2])=(0)))
GO
Insert into mytable (id1, id2) values (1,2)

Insert into mytable (id1, id2) values (2,1) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T20:02:11.500

Id1 和 Id2 之间的顺序有什么意义吗？如果不是，并且这是一个大表，除了唯一索引之外，强制执行 Id1 < Id2 可能会更好。这会影响任何输入记录的过程，因此可能不可行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T20:06:54.793

我将创建一个在插入和更新时执行的触发器，它将使用选择语句验证在转置和不转置时两列中的值是唯一的。这将允许您拒绝对表进行的任何更改，这些更改会在更改时破坏您的唯一性规则，并且您可以删除唯一索引，因为它只强制执行部分要求。

# c# - 如何访问文件外在 Global.asax 中声明的对象？

> ID：631986
> 
> 赞同：1
> 
> 时间：2009-03-10T19:50:54.817
> 
> 标签：c#, asp.net, .net-3.5

我在 global.asax 文件中声明了一个对象，如下所示。

```
<object Id="WFRuntime" RunAt="Server" Class="System.Workflow.Runtime.WorkflowRuntime" Scope="application"> 
```

虽然我可以在 global.asax 文件方法中访问此对象，但我无法在 asp.net Web 应用程序的其他地方使用它。我正在使用 .net 3.5 框架。

有什么方向吗？

谢谢，苏格拉底。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T19:56:51.263

首先，确保您的 Global.asax 文件有代码隐藏

```
<%@ Application Codebehind="Global.asax.cs" Inherits="YourSite.Global" Language="C#" %> 
```

如果您没有，请创建一个 Global.asax.cs 文件。如果您有网站而不是 Web 项目，则它*必须位于 App_Code 目录中。*它必须看起来像这样：

```
namespace YourSite {
    public class Global : HttpApplication {
        public System.Workflow.Runtime.WorkflowRuntime WFRuntime { get; set; }
    }
} 
```

这应该使您网站中的所有页面都可以引用 ((Global)Context.Application).WFRuntime。

或者，您可以将 WFRuntime 成员设为静态，然后在整个站点中使用“Global.WFRuntime”。

# emacs - HTML 4.01 严格编辑的最佳 Emacs 模式是什么？

> ID：631987
> 
> 赞同：3
> 
> 时间：2009-03-10T19:51:00.700
> 
> 标签：emacs, html4

我一直在使用 nxml-mode 来编辑 XHTML。但是，它不适用于标签不必关闭的 HTML4 文档。有没有人找到一个好的 Emacs 模式来编辑这些文件？

示例文档：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-gb">
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Test</title>
  </head>
  <body>
  </body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:07:29.053

我发现 html-mode 效果很好。您可能还想考虑 html-helper-mode，它比普通的 html-mode 具有更多的功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T21:22:11.963

我使用了 html-helper-mode 一段时间，但又切换回 html-mode，因为 html-helper-mode 中的缩进很有趣，我没有时间解决它。所以我的投票也支持 html-mode。

# automation - Citrix 中的 UI 自动化

> ID：631988
> 
> 赞同：5
> 
> 时间：2009-03-10T19:51:19.793
> 
> 标签：automation, citrix

我希望能够使用像 WatiN 这样的工具来自动化需要与通过使用在 Citrix 上运行的 IE 实例访问的 Web 应用程序交互的东西。到目前为止，使用 SendKeys 似乎不可能在基本级别与窗口交互，因为内部 UI 组件似乎没有句柄。

有没有人能够做到这一点或类似的事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-10-01T16:45:41.230

您可以尝试[使用 UiPath](http://uipath.com/automate/citrix-automation)来处理[Citrix 自动化](http://www.uipath.com/automate/citrix-automation)（以及桌面或 Web）。

这是一个[完整的教程](http://pages.uipath.com/tutorials/citrix-automation-data-entry)，展示了在虚拟桌面环境中用于数据输入、数据抓取或单击和键入的不同 Citrix 自动化技术。

您可以通过代码 (SDK) 使用它，也可以直接从 UiPath Studio 创建可视化自动化（工作流程）。

考虑到 Citrix/虚拟桌面作为图像流式传输到客户端计算机，因此您无法访问 UI 树元素。

**注意：**我在 UiPath 工作，所以我知道它可以胜任。您还应该尝试其他可视化自动化工具，例如 Automation Anywhere、WinAutomation、Jacada，并排使用它们并选择最适合您的工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T15:48:52.177

Citrix 有一个支持自动化 Citrix 应用程序的测试/监控工具。我相信它被称为Edge Sight。另一种选择是 Tevron CitraTest。

但是，如果它是您尝试自动化的 Web 应用程序，为什么不直接在您自己的工作站上自动化 IE。有许多支持自动化 IE 的自动化工具，包括免费的和收费的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-14T19:40:39.103

我只听说过 EdgeSite 的 Citra Test。无论如何处理封闭的Citrix环境很麻烦。

首先，没有任何自动化软件或脚本环境可以轻松地与 Citrix 应用程序的对象进行交互。根本没有可用的钩子。通过 Citrix 访问的 IE 更像是图像而不是应用程序。

您可以在聆听低级别通信时进行一些交互，但这几乎就像逆向工程 citrix 专有技术并注入您的数据。

您可以尝试使用识别图像并在屏幕坐标上操作的软件，但这很糟糕。它容易出现很多很多错误。此外，甚至不敢将它与 Citrix 和双/多屏幕设置一起使用。那只是一团糟。

在服务器上安装自动化软件并通过 Citrix 访问它作为您的 IE 将是最好的解决方案（除了通过您的工作站 IE 正常访问已测试的应用程序）。

不幸的是，在大多数情况下，仅通过 Citrix 访问的应用程序意味着没有测试自动化：/

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-27T00:59:00.683

我最近看了一个**Macro Scheduler**的演示。看起来很有希望，但我没有使用它。链接在这里。[http://www.youtube.com/watch?gl=US&v=HBok9MXX4Yg](http://www.youtube.com/watch?gl=US&v=HBok9MXX4Yg)

另一种选择是尝试在您正在访问的 citrix 服务器上安装**Quick Test Pro或任何其他 UI 自动化工具。**QTP 在此设置中工作。这并不容易，但它是可行的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-17T16:43:10.007

我使用 AutoIT 与 Citrix 中的桌面应用程序并行运行，以监视和关闭长时间运行的对话框。

# asp.net - 涉及搜索和会话状态的架构问题

> ID：631990
> 
> 赞同：1
> 
> 时间：2009-03-10T19:51:32.460
> 
> 标签：asp.net, architecture

我有一个可以过滤和排序的数千行网格。在每一行上，您都可以单击一个详细信息按钮，这将为您带来一个新页面，其中包含有关该页面的详细信息。因为这是一个按钮，所以您不能中键单击或右键单击并在新选项卡中打开。此外，单击返回时，您会丢失过滤器和搜索结果。

为了解决这个问题，我考虑了以下几点：将按钮切换为链接，过滤和搜索时，使用get而不是post请求。这样，您可以通过右键单击或中键切换到新页面，并且如果您确实正常点击链接，则返回将正常工作。

然而，并未进行此更改。我们被要求在详细信息页面上添加“下一个结果/上一个结果”按钮集，以便您导航。虽然不是一个优雅的解决方案，但它至少可以工作。

我建议将查询字符串参数添加到详细信息页面，这将基于过滤器重新生成搜索查询，并允许您在代码中获取下一个和上一个结果。

一位团队成员对此解决方案提出了质疑。他认为重新查询数据库是对服务器资源的浪费。相反，提出了一种解决方案来添加包含结果列表的会话变量。然后，您可以使用它进行导航。

我对此提出了质疑，因为您不能在不破坏导航的情况下打开多个选项卡，并且新结果不会实时附加到列表中。此外，如果您担心优化，会话将是最后使用的东西，因为它会占用内存并阻止服务器复制......除非您将结果存储回数据库中。

最好的解决方案是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T20:12:21.897

Session 听起来不像是赢家，不会与大量用户一起扩展。

重复访问数据库似乎没有必要，但这取决于成本 - 有多少用户，他们刷新/过滤的频率以及该查询的成本是多少？

如果您确实使用查询字符串，则可以通过参数缓存页面。

该按钮上的一些 AJAX 代码如何检索详细信息 - 保留底层网格并在 div/面板或新窗口/选项卡中显示详细信息。

# c# - 这个对象是一个整体类型。我可以在不到五行代码中获得它的价值吗？

> ID：631994
> 
> 赞同：4
> 
> 时间：2009-03-10T19:52:13.910
> 
> 标签：c#, type-conversion

我有一个数据阅读器。我想将其中的值与值 42 进行比较。我知道它是一个整数类型（例如，MySQL 称为`INT`、`TINYINT`、`SMALLINT`、`MEDIUMINT`、`BIGINT`、`JUMBODELUXEINT`等）。我不想将实际类型硬连接到 C# 代码中。我想出的最好的是

```
object x = reader.GetValue(i);
uint k = x is byte ? (byte) x
    : x is short ? (uint) (short) x
    : x is ushort ? (ushort) x
    : x is int ? (int) (int) x
    : (uint) x;
if (k == 42) { ... } 
```

这似乎令人难以置信的冗长。我尝试使用`Equals`但具有相同值的不同整数类型似乎测试不相等。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T19:54:57.007

只是检查[`Convert.ToUInt32(object)`](http://msdn.microsoft.com/en-us/library/ec671dkh.aspx)......是的，它工作正常：

```
using System;

class Test
{
    static void Main()
    {
        Check((byte)10);
        Check((short)10);
        Check((ushort)10);
        Check((int)10);
        Check((uint)10);
    }

    static void Check(object o)
    {
        Console.WriteLine("Type {0} converted to UInt32: {1}",
                          o.GetType().Name, Convert.ToUInt32(o));
    }
} 
```

换句话说，您的代码可以是：

```
object x = reader.GetValue(i);
uint k = Convert.ToUInt32(x);
if (k == 42) { ... } 
```

或者，鉴于所有`uint`s 都可以表示为 long，如果您使用的是数据阅读器，您可以尝试一下`reader.GetInt64(i)`吗？我不知道转换是否会为您完成，但可能值得一试。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T19:54:32.767

```
if(Convert.ToUInt32(reader.GetValue(i)) == 42) { ... } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T19:57:39.997

你也可以像这样反过来做 Skeet 和 Daniel 的答案：

```
if (k == Convert.ChangeType(42, k.GetType()) { ... } 
```

不过我还没有测试过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T19:56:00.500

我不确定我是否理解正确，但我认为这应该可行：

```
int x = int.Parse(reader.GetValue(i).ToString());
if(x == 42) { // do your logic } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T19:58:13.537

你可以试试这个：

```
unit k = Convert.ToUInt32(x); 
```

不过，重命名变量会更好。*上周*1 个字母的变量太棒了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T19:58:23.177

这应该有效：

```
object x = reader.GetValue(i);

uint k;
try
{
    k = Convert.ToUInt32(x);
}
catch(InvalidCastException e) { ... }
if (k == 42) { ... } 
```

# python - 以编程方式确定 python 模块是否已安装或处于开发模式

> ID：631996
> 
> 赞同：1
> 
> 时间：2009-03-10T19:52:42.317
> 
> 标签：python, packaging

我倾向于在“setup.py develop”模式下开发我的应用程序。当程序安装“setup.py”时，我希望配置自动切换到生产模式。

这可以通过糟糕的黑客来完成，比如检查安装目录是否包含“setup.py”，但我想知道 pkg_resources 是否可以以某种方式为我做到这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T20:08:36.960

`os.environ['development_mode']`在您的开发机器上设置一个环境变量并测试（或您选择的设置）不是更容易，更清洁吗？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T21:16:28.340

确实，[`pkg_resources`会这样做](http://peak.telecommunity.com/DevCenter/PkgResources#distribution-attributes)：

```
dist = pkg_resources.get_distribution('your-app')
if dist.precedence == pkg_resources.DEVELOP_DIST:
    # package is in development mode
    ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T21:18:00.677

另一种选择是使用[virtualenv](http://pypi.python.org/pypi/virtualenv)。那么您的开发环境可能与您的生产环境相同。在我看来，Setuptools 是一个非常依赖的东西。****************