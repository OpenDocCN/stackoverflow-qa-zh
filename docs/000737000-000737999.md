# StackOverflow 问答 000737000-000737999

# c# - 删除循环中的控件

> ID：737005
> 
> 赞同：5
> 
> 时间：2009-04-10T07:58:29.123
> 
> 标签：c#, .net, winforms

昨天我写了一段代码来删除满足某些条件的表单中的所有控件。天真地写它，这是我想出的。

```
for (int i = 0; i < this.Controls.Count; ++i)
{
    if (this.Controls[i].Name.Length == 2)
    {
        this.Controls.Remove(this.Controls[i);
    }
} 
```

但碰巧代码是错误的。然后我将其更改为：

```
foreach (Control ctr in this.pbBoardImage.Controls)
{
    if (ctr.Length == 2)
    {
        this.Controls.Remove(ctr);
    }
} 
```

但这仍然是不正确的。我知道正确的方法是：

```
for (int i = this.Controls.Count - 1; i >= 0; i--)
{
    if (this.Controls[i].Name.Length == 2)
    {
        this.Controls.Remove(this.Controls[i]);
    }
} 
```

然而，它仍然感觉不优雅。我不能使用 List.RemoveAll，因为 this.Controls 不是 List。那么我可以要求一种更优雅的方式，最好不使用循环吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-10T08:02:20.330

不知道你为什么不喜欢这个答案......我已经强调了重要的`RemoveAt`; 但是，作为 .NET 3.5/C# 3.0 中的替代方案：LINQ：

```
 var qry = from Control control in Controls
                  where control.Name.Length == 2
                  select control;

        foreach(var control in qry.ToList()) {
            Controls.Remove(control);
        } 
```

* * *

（原来的）

你不能`Remove`在里面`foreach`- 它破坏了迭代器。这里的一种常见方法是*向后*迭代：

```
for (int i = this.Controls.Count - 1; i >= 0; i--) {
    if (this.Controls[i].Name.Length == 2) {
        this.Controls.RemoveAt(i); // <=========== *** RemoveAt
    }
} 
```

这避免了“关闭”问题等。

# c - 监控低级挂钩 [C]

> ID：737007
> 
> 赞同：2
> 
> 时间：2009-04-10T07:59:40.417
> 
> 标签：c, windows, keyboard

有什么方法可以监控 Windows 环境中的低级键盘挂钩。假设我正在制作一个试图查找键盘记录器的程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T12:02:43.217

*> 没有官方 API 可以查询已安装的键盘挂钩。*

是的，有。（你太年轻了，不知道这个......）
你必须阅读 PEB。
在[Win32 api Group](http://news://nntp.aioe.org/comp.os.ms-windows.programmer.win32) 上查看所有 Windows 源代码（每个 api，无论是否未记录）都已被反汇编

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T08:11:19.967

[关于阅读钩子的讨论](http://www.codeguru.com/forum/archive/index.php/t-327312.html)

您可能会遇到的一个问题是，有些恶意软件不作为您可以轻松枚举的“进程”而存在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T08:19:16.797

没有官方 API 可以查询已安装的键盘挂钩。由于 Microsoft 不共享 Windows 的源代码，因此您必须安装一个键盘挂钩并单步执行汇编代码才能确定 Windows 将这些信息保存在何处。然后，您可以编写一个设备驱动程序来监视此内存区域的更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-08T19:52:24.733

另一个问题是，至少有一个键盘记录器通过将自身注入键盘的处理器内存并从那里运行来工作。几乎不可能检测到，如果可以的话，您必须了解很多关于键盘如何工作的知识。

摘要：如果您以任何方式成功完成此任务，您可能不会涵盖所有可能的键盘记录器。坏消息，恐怕。

# sql-server - T-SQL 中的临时函数或存储过程

> ID：737009
> 
> 赞同：36
> 
> 时间：2009-04-10T08:01:36.450
> 
> 标签：sql-server, tsql, stored-procedures

是否有机会在 MS SQL 2005 上创建临时存储过程或函数？我只想在我的查询中使用这个存储过程，所以在执行后它就会消失。

我有一个查询，我想对一些数据执行 EXEC。但是对于我将处理此命令的每个表，我需要更改它的某些部分。所以我想我会创建一个临时 SP，它会根据我提供的参数（如表名等）为我返回一个查询，然后由 EXEC 执行这个查询。

而且这个存储过程以后对我来说没有用，所以我想暂时使用它，这样当我结束执行查询时 - 它就会消失。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2014-02-10T20:03:02.117

这个问题有点老了，但其他答案未能提供创建临时过程的语法。语法与临时表相同：#name 用于本地临时对象，##name 用于全局临时对象。

```
CREATE PROCEDURE #uspMyTempProcedure AS
BEGIN
  print 'This is a temporary procedure'
END 
```

这在官方文档的“过程名称”部分中有描述。[http://technet.microsoft.com/en-us/library/ms187926%28v=sql.90%29.aspx](http://technet.microsoft.com/en-us/library/ms187926%28v=sql.90%29.aspx)

我正在使用这种技术对原始 T-SQL 单元测试的代码进行重复数据删除。一个真正的单元测试框架会更好，但这总比没有好，然后“垃圾收集”。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-10T08:18:44.240

重新编辑 - 听起来您应该对`nvarchar`包含 TSQL 的（参数化）使用 sp_ExecuteSQL。

在 sp_ExecuteSQL 上搜索；一个简单的例子：

```
DECLARE @SQL nvarchar(4000),
 @Table varchar(20) = 'ORDERS',
 @IDColumn varchar(20) = 'OrderID',
 @ID int = 10248

 SET @SQL = 'SELECT * FROM [' + @Table + '] WHERE ['
  + @IDColumn + '] = @Key'

  EXEC sp_executesql @SQL, N'@Key int', @ID 
```

请注意，表名和列名必须连接到查询中，但`@Key`可以参数化值（例如 ）。

* * *

有一个临时存储过程 - 但它是每个连接，而不是每个 sp。

但是，您可能想查看 Common Table Expressions - 它们可能是您所追求的（尽管您只能从它们中读取一次）。

也许如果你能澄清你想要*做*什么？

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-04-10T08:05:01.073

只需在查询中使用存储过程的 SQL。无需在数据库中创建存储过程，与查询中的普通查询相比，它不会给您带来任何优势。

# eclipse - 如何突出显示 Eclipse 的 Emacs 键绑定中的选择？

> ID：737016
> 
> 赞同：8
> 
> 时间：2009-04-10T08:07:32.910
> 
> 标签：eclipse, emacs

我已经在网上搜索过这个，但没有运气。任何的想法？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-17T15:55:41.670

尝试使用此处提供的 Emacs+ 插件：

[http://www.mulgasoft.com/emacsplus](http://www.mulgasoft.com/emacsplus)

它提供了大量的功能 - 包括您正在寻找的选择突出显示 - 这确实有助于从 Emacs 迁移。我只使用了几天，但它看起来很稳定，并且与编辑器集成得很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-10T10:49:15.813

[如此处](http://lists.apple.com/archives/webobjects-dev/2007/Dec/msg00042.html)所述，您可以将 emacs 键绑定设置为在 Eclipse 的组件编辑器中工作。

去`Preferences -> General -> Keys`。

*   如果您还没有这样做，请将 Scheme 更改为 Emacs，这样您就可以轻松地发现 emacs 键绑定。
*   按类别排序并查看“ `Text Editing`”类别
*   找到您关心的命令，例如`Next Column`，`Previous Column`
*   选择该命令并单击“ `Copy Command`”
*   通过按键设置与按键的绑定，例如按下`Control-f`生成“ `^F`”。
*   将“ ”更改`When:`为“ `Editing Components`”。
*   对您关心的所有键绑定重复此操作。

因此，如果在 emacs 中，选择是通过`Control-Space`在区域的开头设置标记 ( ) 来完成的，然后将点移动到区域的末尾，您可以将适当的快捷方式关联到：

```
Text Editing > Select Text Start
Text Editing > Select Text End 
```

# sql - 区分空查询结果和 NULL 查询结果

> ID：737017
> 
> 赞同：2
> 
> 时间：2009-04-10T08:07:37.387
> 
> 标签：sql, sql-server, database, tsql

我在 SQL Server 2005 中有一个包含测量数据的表格，如果有的话，每人每年一个值。我的 TSQL 代码在循环中获取这些值并处理它们：

```
...
SET @val = (SELECT measurement FROM tbl_data WHERE persid = @curpersid AND yr = @curyear)
... 
```

现在，对于某个人和年份，该表可以包含 (i) 有效测量值，(ii) NULL 值或 (iii) 根本没有对应的行。

如何有效区分这些情况？(ii) 和 (iii) 都将导致 @val 为 NULL，因此使用当前代码，它们无法区分......

非常感谢任何提示，wwwald

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T08:14:04.500

如果您可以使用测量永远无法使用的值，则可以使用 COALESCE()。

```
SET @val = (SELECT COALESCE(measurement, someValueThatDoesNotOccur) FROM tbl_data WHERE persid = @curpersid AND yr = @curyear) 
```

无行：@val == null

测量为 NULL：@val 等于某个值

否则是一个 vlaid 测量

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T08:12:53.397

也许检查`@@ROWCOUNT`？但是，这有点冒险，因为您需要确保在检查之前不要执行任何其他操作`@@ROWCOUNT`（它在大多数操作后更新）。

或者，阅读另一列，例如主键：

```
SELECT @val = measurement, @id = id
FROM tbl_data WHERE persid = @curpersid AND yr = @curyear 
```

现在检查`@id`- 如果是`NULL`，则没有行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T14:24:59.880

我质疑你为什么要循环播放？循环在 SQL Server 中是一件坏事，因为它是性能杀手。大多数事物都有更好的基于集合的解决方案。如果您告诉我们除了设置变量的值之外您在循环中做了什么，那么您的问题可能会有更好的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T08:15:54.730

好吧，这有点像黑客，但是：

```
SET @val = -99999  -- or some other value that will never occur in the table
SELECT @val = measurement FROM tbl_data WHERE persid = @curpersid AND yr = @curyear 
```

现在，如果 @val 仍然是 -9999 则没有行，如果测量值为空，则为空。

# javascript - 如何禁用右键单击我的网页？

> ID：737022
> 
> 赞同：378
> 
> 时间：2009-04-10T08:12:09.357
> 
> 标签：javascript

我可以在不使用 JavaScript 的情况下禁用右键单击我的网页吗？我问这个是因为大多数浏览器都允许用户禁用 JavaScript。

如果没有，如何使用 JavaScript 禁用右键单击？

* * *

## 回答 #1

> 赞同：675
> 
> 时间：2009-04-10T08:22:49.753

您可以使用 JavaScript 通过为“contextmenu”事件添加事件侦听器并调用该[`preventDefault()`](https://developer.mozilla.org/en/docs/Web/API/Event/preventDefault)方法来做到这一点：

```
document.addEventListener('contextmenu', event => event.preventDefault()); 
```

话虽这么说：**不要这样做。**

为什么？因为它除了烦人的用户之外什么也没有。许多浏览器也有一个安全选项来禁止禁用右键单击（上下文）菜单。

不知道你为什么想要。如果您出于某种错误的信念认为您可以通过这种方式保护您的源代码或图像，请再想一想：您不能。

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2009-04-10T08:28:11.313

**别**

只是，不要。

无论您做什么，都无法阻止用户完全访问您网站上的每一点数据。只需关闭浏览器上的 Javascript（或使用 NoScript 之类的插件），您编写的任何 Javascript 都可以变得毫无意义。此外，没有办法禁止任何用户简单地为您的站点“查看源代码”或“查看页面信息”（或使用 wget）。

这不值得努力。它实际上不会起作用。它将使您的网站对用户充满敌意。他们会注意到这一点并停止访问。这样做没有任何好处，只会浪费精力和流量。

不。

**更新：**随着时间的推移，这个小话题似乎已被证明颇具争议。即便如此，我仍然支持这个问题的答案。有时正确的答案是建议而不是字面上的回应。

偶然发现这个问题并希望了解如何创建*自定义*上下文菜单的人应该看看其他地方，例如这些问题：

*   [为我的 web-app 制作自定义右键单击上下文菜单](https://stackoverflow.com/questions/4495626/making-custom-right-click-context-menus-for-my-web-app)，它依赖于 jQuery
*   [如何将自定义右键菜单添加到](https://stackoverflow.com/questions/4909167/how-to-add-a-custom-right-click-menu-to-a-webpage)使用纯 javascript/html的网页

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2012-08-10T13:37:09.953

*最初的问题是关于如何在用户可以禁用 JavaScript 的情况*下停止右键单击：这听起来很邪恶（因此是负面反应） - 但所有重复项都重定向到这里，即使许多重复项要求不那么邪恶的目的。

例如在 HTML5 游戏中使用右键单击按钮。这可以通过上面的内联代码来完成，或者更好的是这样的：

```
document.addEventListener("contextmenu", function (e){
    e.preventDefault();
}, false); 
```

但是，如果您正在制作游戏，请记住右键单击按钮会触发`contextmenu`事件 - 但它也会触发常规事件`mousedown`和`mouseup`事件。因此，您需要检查事件的**which**属性以查看触发事件的是鼠标左键( `which === 1`)、中键 ( `which === 2`) 还是鼠标右键 ( )。`which === 3`

这是 jQuery 中的一个示例 - 请注意，按下鼠标右键将触发三个事件：`mousedown`事件、`contextmenu`事件和`mouseup`事件。

```
// With jQuery
$(document).on({
    "contextmenu": function (e) {
        console.log("ctx menu button:", e.which); 

        // Stop the context menu
        e.preventDefault();
    },
    "mousedown": function(e) { 
        console.log("normal mouse down:", e.which); 
    },
    "mouseup": function(e) { 
        console.log("normal mouse up:", e.which); 
    }
}); 
```

因此，如果您在游戏中使用鼠标左右键，则必须在鼠标处理程序中执行一些条件逻辑。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2013-06-07T15:17:26.040

如果您不关心每次尝试右键单击时都用消息提醒用户，请尝试将其添加到您的正文标签

```
<body oncontextmenu="return false;"> 
```

这将阻止对上下文菜单的所有访问（不仅来自鼠标右键，还来自键盘）。

但是，正如其他答案中提到的那样，添加右键单击禁用器确实没有意义。任何具有基本浏览器知识的人都可以查看源代码并提取他们需要的信息。

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2014-01-27T12:04:17.687

如果您是 jquery 粉丝，请使用此

```
 $(function() {
        $(this).bind("contextmenu", function(e) {
            e.preventDefault();
        });
    }); 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2009-04-10T08:24:03.900

首先，如果不使用客户端功能，您将无法实现这一目标。这是 javascript 运行的地方。

其次，如果您试图控制最终用户可以从您的网站消费什么，那么您需要重新考虑如何显示该信息。图片有一个公共 url，可以通过 HTTP 获取，无需浏览器。

身份验证可以控制谁可以访问哪些资源。

图像中嵌入水印可以证明图像来自特定的人/公司。

归根结底，资源管理实际上是用户/访客管理。

互联网第一条规矩，不想拍就不要公开！

互联网第二条规矩，不想拿就不要放到网上！

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2009-04-10T08:47:38.303

如果您的目标是阻止人们下载您的图像，正如大多数人所说，禁用右键单击几乎是无效的。

假设您正在尝试保护图像，则替代方法是 -

使用 Flash 播放器，用户无法下载它们，但他们可以轻松地进行屏幕截图。

如果你想更尴尬，让图像成为一个div的背景，包含一个透明的图像，à la -

```
<div style="background-image: url(YourImage.jpg);">
   <img src="transparent.gif"/>
</div> 
```

将足以阻止随意盗窃您的图像（请参见下面的示例），但与所有这些技术一样，只要对 html 有基本的了解，就可以轻松击败。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2009-04-10T08:13:37.793

如果不使用 Javascript，您将无法完成您的要求。您可能选择使用的任何其他技术只能帮助在服务器端编写网页以发送到浏览器。

根本就没有好的解决方案，没有Javascript就没有解决方案。

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2014-02-01T11:30:11.600

如果您的目标是禁止用户简单地保存您的图像，您还可以检查单击的目标是否为图像，在这种情况下仅禁用右键单击。所以右键单击可以用于其他目的。取自上面的代码：

```
document.addEventListener("contextmenu", function(e){
    if (e.target.nodeName === "IMG") {
        e.preventDefault();
    }
}, false); 
```

这只是为了消除保存图像的最简单方法，但仍然可以完成。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2012-09-21T12:27:18.460

```
<!DOCTYPE html>
<html>
<head>
<script type='text/javascript' src='http://code.jquery.com/jquery-1.4.4.min.js'></script>
<script type='text/javascript'>//<![CDATA[ 
$(function(){
$('img').bind('contextmenu', function(e){
return false;
}); 
});//]]>  
</script>
</head>
<body>
    <img src="http://www.winergyinc.com/wp-content/uploads/2010/12/ajax.jpg"/>
</body> 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2020-10-22T12:56:16.663

如果您只想禁用右键单击以在网页上**保存图像，请使用此 CSS 解决方案：**

```
your-img-tag {
  pointer-events: none;
} 
```

**在同一图像上实施之前：** [![前](https://i.stack.imgur.com/hzkAi.png)](https://i.stack.imgur.com/hzkAi.png)

**在同一图像上实施后：** [![后](https://i.stack.imgur.com/aimrt.png)](https://i.stack.imgur.com/aimrt.png)

经测试可在**Chrome**和**Firefox**中运行。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2015-08-06T04:19:28.807

像下面那样做（它也适用于Firefox）：

```
$(document).on("contextmenu",function(e){

     if( e.button == 2 ) {
         e.preventDefault();
          callYourownFucntionOrCodeHere();
     }
return true;
}); 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-02-19T14:05:52.427

将此代码放入`<head>`页面的标签中。

```
<script type="text/javascript"> 
function disableselect(e){  
return false  
}  

function reEnable(){  
return true  
}  

//if IE4+  
document.onselectstart=new Function ("return false")  
document.oncontextmenu=new Function ("return false")  
//if NS6  
if (window.sidebar){  
document.onmousedown=disableselect  
document.onclick=reEnable  
}
</script> 
```

这将禁用对整个网页的右键单击，但仅在启用 JavaScript 时。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2018-08-30T06:57:22.663

我曾使用此代码禁用任何网页中的右键单击，它工作正常。您可以使用此代码

```
jQuery(document).ready(function(){
  jQuery(function() {
        jQuery(this).bind("contextmenu", function(event) {
            event.preventDefault();
            alert('Right click disable in this site!!')
        });
    });
});
```

```
<html>
  <head>
    <title>Right click disable in web page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
  <body>
    You write your own code
  </body>
</html>
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-04-10T08:52:11.787

当然，根据此处的所有其他评论，这根本行不通。

我曾经为客户端构建了一个简单的 Java 小程序，它强制通过屏幕捕获来完成对图像的任何捕获，您可能想考虑一种类似的技术。它在限制范围内有效，但我仍然认为这是浪费时间。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2015-12-29T06:33:05.470

```
 <script>
        window.oncontextmenu = function () {
            console.log("Right Click Disabled");
            return false;
        }
    </script> 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-10-17T17:00:47.977

禁用右键单击您的网页很简单。只需几行 JavaScript 代码就可以完成这项工作。下面是 JavaScript 代码：

```
$("html").on("contextmenu",function(e){
   return false;
}); 
```

在上面的代码中，我选择了标签。在您添加这三行代码后，它将禁用右键单击您的网页。

来源：[**使用 jQuery 在网页上禁用右键单击、复制、剪切**](https://www.codespeedy.com/disable-right-click-copy-cut-on-web-page-using-jquery/)

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-10-19T10:43:45.327

**试试这个**

```
<script language=JavaScript>
//Disable right mouse click Script

var message="Function Disabled!";

function clickIE4(){
if (event.button==2){
alert(message);
return false;
 }
}

function clickNS4(e){
if (document.layers||document.getElementById&&!document.all){
if (e.which==2||e.which==3){
alert(message);
return false;
}
}
}

if (document.layers){
document.captureEvents(Event.MOUSEDOWN);
document.onmousedown=clickNS4;
}
else if (document.all&&!document.getElementById){
document.onmousedown=clickIE4;
}

document.oncontextmenu=new Function("alert(message);return false")

</script> 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2020-12-31T14:03:32.643

就这样做

**无需编写 JAVASCRIPT 代码**

`<body oncontextmenu="return false">`

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-10-10T01:03:26.037

我知道我迟到了，但我想为我将要提供的答案创建一些假设和解释。

### 我可以禁用右键单击吗

> 我可以在不使用 Javascript 的情况下禁用右键单击我的网页吗？

是的，通过使用 JavaScript，您可以禁用任何发生的事件，并且您主要只能通过 javaScript 来做到这一点。怎么样，你只需要：

1.  一个工作硬件

2.  一个网站或某个地方，您可以从中了解密钥代码。因为你会需要它们。

现在假设您想阻止输入键，这里是代码：

```
function prevententer () {
 if(event.keyCode == 13) {
  return false;
 }
} 
```

对于右键单击使用此：

```
event.button == 2 
```

在 的地方`event.keyCode`。你会阻止它。

> 我想问这个是因为大多数浏览器都允许用户通过 Javascript 禁用它。

你是对的，浏览器允许你使用`JavaScript`，而 javascript 为你完成了整个工作。你不需要设置任何东西，只需要头部的脚本属性。

### 为什么不应该禁用它？

对此的主要和快速的答案是，**用户不会喜欢它**。每个人都需要自由，没有人我的意思是没有人想要被阻止或禁用，几分钟前我在一个站点，该站点阻止了我的右键单击，我觉得为什么？您需要保护您的源代码吗？然后在这里`ctrl+shift+J`我打开了`Console`，现在我可以去`HTML-code`标签了。来吧，阻止我。这不会向您的应用程序添加任何安全层。

右键单击中有很多有用的菜单，例如复制、粘贴、在 Google 中搜索“文本”（在 Chrome 中）等等。因此，用户希望轻松访问而不是记住很多键盘快捷键。任何人仍然可以复制上下文、保存图像或做任何他想做的事情。

**浏览器使用鼠标导航：**某些浏览器（例如*Opera*）使用鼠标导航，因此如果您禁用它，用户肯定会讨厌您的用户界面和脚本。

所以这是基本的，我打算写更多关于保存源代码的内容嘿嘿嘿但是，让它成为你问题的答案。

### 参考键码：

**键鼠按键代码：**

[http://www.w3schools.com/jsref/event_button.asp](http://www.w3schools.com/jsref/event_button.asp)

[https://developer.mozilla.org/en-US/docs/Web/API/event.button](https://developer.mozilla.org/en-US/docs/Web/API/event.button)（也会受到用户的赞赏）。

**为什么不禁用右键单击：**

[http://www.sitepoint.com/dont-disable-right-click/](http://www.sitepoint.com/dont-disable-right-click/)

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2021-05-06T05:04:27.653

简单方法：

```
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false"> 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2013-12-11T13:03:24.107

```
 $(document).ready(function () {
            document.oncontextmenu = document.body.oncontextmenu = function () { return false; }
        }); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-01-02T18:22:22.653

有几点需要考虑：

chrome商店中的“启用右键单击”之类的浏览器插件的存在是有原因的，您将无法绕过它们。您实际上无法阻止人们下载您的内容，因为他们实际上必须下载它才能在他们的浏览器中看到它；人们尝试但它总是在那里。

一般来说，如果内容不应该公开，就不要放到网上。

此外，无法右键单击是一个可访问性问题，在许多情况下构成对盲人、残疾人或老年人的非法歧视。检查您当地的法律，但在美国，它以联邦 ADA 的形式积极违反法律，因为可能有视力问题的盲人或老年人是受法律保护的阶层。

因此，与其这样做并浪费大量时间和精力，不如不要费心去尝试这样做。它可能只会让您的公司被起诉或让他们未能通过合规审计。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2020-01-31T14:16:40.997

试试这个代码来禁用检查元素选项

```
 jQuery(document).ready(function() {
    function disableSelection(e) {
        if (typeof e.onselectstart != "undefined") e.onselectstart = function() {
            return false
        };
        else if (typeof e.style.MozUserSelect != "undefined") e.style.MozUserSelect = "none";
        else e.onmousedown = function() {
            return false
        };
        e.style.cursor = "default"
    }
    window.onload = function() {
        disableSelection(document.body)
    };

    window.addEventListener("keydown", function(e) {
        if (e.ctrlKey && (e.which == 65 || e.which == 66 || e.which == 67 || e.which == 70 || e.which == 73 || e.which == 80 || e.which == 83 || e.which == 85 || e.which == 86)) {
            e.preventDefault()
        }
    });
    document.keypress = function(e) {
        if (e.ctrlKey && (e.which == 65 || e.which == 66 || e.which == 70 || e.which == 67 || e.which == 73 || e.which == 80 || e.which == 83 || e.which == 85 || e.which == 86)) {}
        return false
    };

    document.onkeydown = function(e) {
        e = e || window.event;
        if (e.keyCode == 123 || e.keyCode == 18) {
            return false
        }
    };

    document.oncontextmenu = function(e) {
        var t = e || window.event;
        var n = t.target || t.srcElement;
        if (n.nodeName != "A") return false
    };
    document.ondragstart = function() {
        return false
    };
}); 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2017-05-10T12:19:06.373

Javascript：

```
document.getElementsByTagName("html")[0].setAttribute("oncontextmenu", "return false"); 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-04-13T05:46:55.750

**重要提示：**是否允许这种预防取决于**浏览器**和**操作系统！**

***你应该*这样做吗？** **没有**。因为它不会阻止用户，但只会惹恼他/她。

**你能用吗？** **是**的。示例：在某些您希望自定义弹出菜单的网络应用程序中，在游戏中用户可能会因为错误地右键单击而感到恼火，以及其他情况。

**Ubuntu 16.04**中的 Chrome (v65) = 您可以禁用右键单击。

Mac OS 10.11 中的 Chrome (v65) = 您**不能**禁用右键单击。

Windows 7 中的 Chrome (v65) = 您**不能**禁用右键单击。

Mac OS 10.11 中的 Firefox (v41) = 您可以**禁用**右键单击。

Windows 7 中的 Firefox (v43) = 您可以**禁用**右键单击。

```
// Vanilla JS way
document.addEventListener('contextmenu', function(e){
    e.preventDefault();
});

// jQuery way
$(document).bind('contextmenu', function(e) {
    e.preventDefault();
}); 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2021-02-20T10:25:13.473

是的，您可以使用 HTML 和 Javascript 禁用它。
只需添加`oncontextmenu="return false;"`您的身体或元素。
它非常简单，只使用有效的 HTML 和 Javascript，没有 jQuery。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2022-01-06T23:15:09.740

我想添加一个注释（用于`chrome 97`）不确定这是与 chrome 还是我的环境相关的错误。
右键单击我的应用程序的特定元素会在新选项卡中打开一个页面，使用`mousedown`并且`oncontextmenu="return false"`我仍然有上下文菜单出现，即使在新打开的页面上（我认为只有已安装的 chrome 扩展的菜单出现在该上下文菜单上这个“错误”应该在未来版本的浏览器中得到修复）。

但与此同时，我使用这个简单的 hack 修复了它

```
function onMouseDown () {
  setTimeout(() => window.open('the link', '_blank'), 100)
} 
```

我只是推迟标签打开。我认为发生此错误是因为右键单击被新打开的页面捕获，而不是来自我尝试打开选项卡的应用程序的原始页面。

希望它可以使您免于头痛。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2019-07-18T06:31:37.060

使用此功能禁用右键单击。您可以禁用左键单击和点击也可以通过`checking 1 and 0`相应的

```
document.onmousedown = rightclickD;
            function rightclickD(e) 
            { 
                e = e||event;
                console.log(e);
                if (e.button == 2) {
                //alert('Right click disabled!!!'); 
                 return false; }
            } 
```

# windows-services - win服务中的ninject内核引用

> ID：737036
> 
> 赞同：4
> 
> 时间：2009-04-10T08:18:52.773
> 
> 标签：windows-services, ninject

我有简单的赢服务，定期执行一些任务。我应该如何将 Ninject 内核传递给我的所有任务类？

创建基本任务类的静态变量并在服务启动时对其进行初始化是个好主意吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T12:04:39.637

我宁愿将内核注入到每个类实例中，而不是基础任务类上的静态变量。如果您决定需要多个内核（无论出于何种原因），这将提供更多的灵活性。基类中的静态变量看起来很*糟糕*，因为没有更好的术语。

# java - 您会推荐哪个用于 Java 的 SOAP XML 对象序列化库？

> ID：737040
> 
> 赞同：3
> 
> 时间：2009-04-10T08:22:05.697
> 
> 标签：java, .net, delphi, xml-serialization, soap-serialization

对于与其他平台/语言（.NET、Delphi）的**Java 对象交换**，您会推荐哪个 Java SOAP XML 对象序列化库？

通信场景可能如下所示：

*   Java 对象编写器 -> SOAP XML 文本 -> .NET 或 Delphi 对象读取器
*   .NET 或 Delphi 对象编写器 -> SOAP XML 文本 -> Java 对象读取器

我知道有 XStream XML 序列化库和 JSON 作为替代解决方案，但是由于 Delphi 和 .Net 具有对 SOAP XML 序列化对象的内置支持，这将提供一种“标准化”方式，支持嵌套对象、数组等高级功能等等。

**编辑：** 同时，我发现了**JAXB** - ( [https://jaxb.dev.java.net/](https://jaxb.dev.java.net/) )、**JAXMe**和**JiBX** - 将 XML 绑定到 Java 代码 ( [http://jibx.sourceforge.net/](http://jibx.sourceforge.net/) )。但默认情况下，它们不会生成 SOAP 序列化 XML。

一个可能的解决方案是一个 Web 服务库，它能够在没有 HTTP 服务器的情况下运行，并为 SOAP XML 内容（不是一个完整的请求，只是一个序列化对象）提供一个简单的文件接口。**Axis 2**和**CXF**看起来很有趣。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T18:29:53.167

我更喜欢 JAX-WS（带有 JAXB 2.1 数据绑定）而不是我使用过的其他库（JAX-RPC、Axis 1 和 2，但不是 XFire）。JAXB 2 数据绑定使用泛型，这使得 maxoccurs > 1 的属性的映射令人愉快。JAX-WS 本身有很好的文档记录，并提供了相当好的 API。在某些情况下，方法和参数注释可能会有点失控——注释形式的 XML 地狱。它通常不是那么糟糕。

JAX-WS 堆栈的优点之一是 Metro 项目，它是 Sun 与 Microsoft 共同开发的，并且与支持 Web 服务的 .NET 3.0 互操作性很好，甚至可以以一种可行的方式实现 MTOM。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T05:35:23.110

我会推荐[CXF](http://cxf.apache.org)。它是一个非常好的服务堆栈，包括 JAXB 数据绑定和 JAX-WS 支持。如果您需要更高级的消息转换和路由，您可能希望查看像[Mule](http://www.mulesource.org)这样的开源集成平台，其中包括 CXF（也支持 Axis 和 XStream）。它是轻量级的，可以在没有应用服务器的情况下嵌入或运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T00:53:31.507

除了可以正常工作的 Axis2 之外，Sun 的 JAX-WS（版本 2）和[Apache CXF](http://cxf.apache.org/)（nee XFire）也值得一试，Soap 是您的事。CXF 可能是 3 个中最成熟的，所以这是我最喜欢的，但所有 3 个都很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T00:17:04.857

用于此的标准库可能是 Apache Axis [1](http://ws.apache.org/ "阿帕奇轴")。我建议使用axis2而不是axis 1.4-虽然它工作得很好。

请记住，所有 SOAP 扩展都使互操作性的梦想成为……一个梦想。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T22:45:55.363

我想你已经回答了你自己的问题。

XStream（输出为 JSON）是一个很好的干净的解决方案。如果您为类型加上别名，您将获得干净的输出格式。之后，使用哪个 SOAP 堆栈就无关紧要了，只要它很好并且可以与 Delphi/.NET 互操作即可。

# php - 向客户端发送文件

> ID：737045
> 
> 赞同：16
> 
> 时间：2009-04-10T08:23:27.317
> 
> 标签：php, download, client, text-files

我想通过 Php 在服务器中编写一个文本文件，并让客户端下载该文件。

我该怎么做？

本质上，客户端应该能够从服务器下载文件。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-10T09:21:18.097

这是最好的方法，假设您不希望用户看到文件的真实 URL。

```
<?php
  $filename="download.txt";
  header("Content-disposition: attachment;filename=$filename");
  readfile($filename);
?> 
```

此外，您可以使用 mod_access 保护您的文件。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-10T08:37:42.337

除了已经发布的数据之外，您可能还想尝试一个标题。

它只是对如何处理它的*建议，用户代理可以选择忽略它，如果知道如何处理，只需在窗口中显示文件：*

```
<?php

 header('Content-Type: text/plain');         # its a text file
 header('Content-Disposition: attachment');  # hit to trigger external mechanisms instead of inbuilt 
```

有关 Content-Disposition 标头的更多信息，请参阅[Rfc2183](http://www.ietf.org/rfc/rfc2183.txt)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-10T08:28:49.783

PHP 有许多非常简单的、类似 C 的函数用于写入文件。这是一个简单的例子：

```
<?php
// first parameter is the filename
//second parameter is the modifier: r=read, w=write, a=append
$handle = fopen("logs/thisFile.txt", "w");

$myContent = "This is my awesome string!";

// actually write the file contents
fwrite($handle, $myContent);

// close the file pointer
fclose($handle);
?> 
```

这是一个非常基本的示例，但您可以在此处找到有关此类操作的更多参考：

[PHP fopen](http://us.php.net/fopen)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T08:43:06.817

如果您将内容类型设置为 application/octet-stream，浏览器将始终提供文件作为下载，并且永远不会尝试在内部显示它，无论它是什么类型的文件。

```
<?php
  filename="download.txt";
  header("Content-type: application/octet-stream");
  header("Content-disposition: attachment;filename=$filename");

  // output file content here
?> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-10T08:31:34.567

只需在网站上发布一个链接到[http://example.com/textfile.php](http://example.com/textfile.php)

在该 PHP 文件中，您输入以下代码：

```
<?php
header('Content-Type: text/plain');
print "The output text";
?> 
```

这样您就可以创建动态内容（来自数据库）...如果这不是您要查找的内容，请尝试使用 Google 提供“内容类型”。

# java - 在 swing 程序中使用 printStackTrace() 好吗？

> ID：737048
> 
> 赞同：1
> 
> 时间：2009-04-10T08:26:09.387
> 
> 标签：java, exception, exception-handling

我正在开发一个小型摇摆应用程序，我不确定是否应该使用 printStackTrace()。

如果我遇到异常，我会通过 JOptionPane 向用户显示一条消息，例如：找不到文件等。

但与此同时，我正在使用 printStackTrace()，我不确定既不向用户显示堆栈跟踪也不打印任何东西……以防万一需要。

我可以将 printStackTrace 留在那里还是为什么不留？

谢谢你的建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T08:38:23.490

一个更好的主意是使用任何 Logging API 替换它们，例如[Log4J](http://logging.apache.org/log4j/1.2/index.html)。当然，正如 Paul 提到的，在适当的时候向用户显示有意义的错误消息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-10T08:27:48.477

将堆栈跟踪记录到日志文件中，无论如何它们对最终用户没有任何意义

向用户打印有意义的错误消息。即找不到文件等

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T08:35:53.027

printStackTrace() 包含仅与开发人员相关的信息，因此最好避免将它们暴露给用户

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T09:17:11.010

我同意日志框架对于任何体面大小的程序都是一个好主意。话虽如此，大多数用户都非常愿意发送任何错误的屏幕截图，因此，从支持的角度来看，在任何错误屏幕中包含（一些）额外细节可以让生活更轻松。

# delphi - 日志文件监视器

> ID：737053
> 
> 赞同：4
> 
> 时间：2009-04-10T08:28:51.577
> 
> 标签：delphi, file-io, file-locking

是否可以在另一个应用程序更新文件时打开文本文件并读取内容，这样不会导致锁定冲突？

我需要监视一个应用程序的日志文件，每次发生事件时该文件都会由另一个应用程序更新。

在尝试读取文件之前，我会检查文件是否正在使用中，但这似乎并非在所有情况下都有效。

谢谢，彼得

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T08:59:50.957

这取决于第一个应用程序如何打开该文件。

即，当调用 CreateFile API 打开文件时，有 dwShareMode 参数告诉 api 如何打开它（如果给定 0，则不能从其他应用程序 IIRC 访问它）。否则从该文件读取应该没有问题。如果我没记错的话，要检查该文件是否以只读方式打开，您可以调用类似

```
CreateFile(pchar(fName), GENERIC_READ or GENERIC_WRITE, 0, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0) ; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T01:28:08.790

1.  从 Sysinternals 下载进程监视器。
2.  打开过滤器对话框并为您的日志文件添加一个“路径”过滤器。
3.  启动日志写入应用程序（我称其为“logwriter”）。
4.  查找并单击 logwriter 执行 CreateFile 的事件。
5.  在“详细信息”下，它应该具有“所需访问权限：通用写入”。它应该有“ShareMode：Read”，对应`FILE_SHARE_READ`于对 CreateFile 的调用。它的意思是，“我，记录者，允许其他人*阅读*我的文件”。
6.  现在运行你的日志阅读应用程序（“logreader”），并做同样的练习。
7.  详细信息应具有“所需访问权限：通用读取”。它应该有“ShareMode：Read，Write”，意思是“我，logreader，允许其他人，包括logwriter，对日志文件进行读写”。

我认为这些是最明智的价值观，它们会防止锁定。其他组合可能是允许的。这里有[一张桌子](http://msdn.microsoft.com/en-us/library/aa363874(VS.85).aspx)。

现在，您还没有说当它“似乎不适用于所有情况”时会发生什么。接下来要做什么将取决于细节。希望以上内容将为您提供足够的信息来找出问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T08:33:14.267

您不会遇到锁定冲突，因为写入应用程序不太可能锁定文件。执行您建议的操作通常没有问题（这是 UNIX **tail -f**命令所做的），并且可以忽略确实发生的那些小故障。过去我写过几个日志监控应用程序，它们的工作原理是这样的，没有任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T08:35:03.687

尝试使用[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)在文件更新时获取事件。

一个对德尔福更友好的[链接](http://www.delphibasics.co.uk/NameSpace.asp?Name=System.IO&Part=FileSystemWatcher)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T01:40:50.443

除了让文件共享正常工作（这可能取决于其他程序的要求）之外，一些程序会在访问之间关闭文件。

过去，我的程序等待文件可用，然后快速打开它，获取所需的数据并关闭它，我已经取得了成功。至少在 DOS 中，尝试访问锁定的文件会导致重试几次，并且我提高了此设置，因此如果其他程序在我拥有该文件时尝试获取该文件，它们只会被延迟并且永远不会看到错误。

我什至能够更新文件（我确保*不会*在两者之间关闭它！）而其他程序却一无所知。

丑陋至极，但我们无法更改其他程序，所以这是完成工作的唯一方法。它在内部部署了多年，我从未听到过该系统用户的窥视。当另一个程序控制的机器退役时，它终于消失了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-02T13:49:44.177

XpoLog 将在不更改您的环境或代码的情况下完成任务，XpoLog 日志监视器

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-02T14:56:35.210

Avar 是对的——你受制于这里的写作程序。如果他们锁定了文件，那么您可以做几件事：

1 - 检查[“最后修改”日期时间](http://delphi.about.com/cs/adptips1999/a/bltip1199_4.htm)的变化 - 如果发生变化，那么你就知道发生*了什么*事。

2 - 如果 mod datetime 确实发生了变化，那么（取决于文件的大小）创建文件的副本并**检查**.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-03T04:21:32.700

我们使用“Win32 的尾巴”，

我知道它不是德尔福，但它可能有用

[http://tailforwin32.sourceforge.net/](http://tailforwin32.sourceforge.net/)

# batch-file - 您可以从命令行运行 AIR 应用程序吗？

> ID：737054
> 
> 赞同：5
> 
> 时间：2009-04-10T08:30:52.650
> 
> 标签：batch-file, air

这个问题最终旨在回答这个问题：批处理脚本可以运行 AIR 应用程序吗？目标是在 Web 服务器上设置 AIR 应用程序并使其通过批处理运行。我只需要知道默认情况下这是否可行。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T10:05:28.337

Adobe 的 Oliver Goldman[发布了如何从命令行启动应用程序](http://blogs.adobe.com/simplicity/2008/11/how_to_launch_an_air_app_from_the_command_line.html)：

> 在 Windows 和 Linux 上，在命令行调用基于 AIR 的应用程序很简单。在 Windows 上，在应用程序的安装目录中，您会找到一个带有应用程序名称的可执行文件；这就是从命令行运行的东西。在 Linux 上，可执行文件位于“bin”子目录中。
> 
> 在 Mac OS 上，事情稍微复杂一些。在 Finder 中，应用程序 *看起来*是一个文件，但它们实际上是一个带有“.app”扩展名和特定内部文件夹结构的文件夹。要使用参数从命令行启动它们，您必须深入研究此结构并找到可执行文件。例如，要启动一个名为 HelloWorld 的应用程序，您需要运行：
> 
> `/Applications/HelloWorld.app/Contents/MacOS/HelloWorld`

您还可以使用[AIR Debug Launcher](http://help.adobe.com/en_US/AIR/1.5/devappshtml/WS5b3ccc516d4fbf351e63e3d118666ade46-7fd7.html)。它允许您根据其文件从命令行启动应用程序，`application.xml`而无需安装它。

# svn - 视觉错误

> ID：737059
> 
> 赞同：0
> 
> 时间：2009-04-10T08:32:42.787
> 
> 标签：svn, netbeans, visualsvn-server

我正在使用 NetBeans IDE 和 VisualSVN 1.7。我收到以下错误。

```
Failed to execute WebDAV PROPPATCH
svn: Commit failed (details follow):
svn: At least one property change failed; repository is unchanged
RA layer request failed
svn: Error setting property 'ignore': 
Could not execute PROPPATCH. 
```

我该如何解决这个错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T10:15:51.743

听起来您的 SVN 客户端正在尝试通过不允许使用 proppatch 动词的代理进行操作。

尝试配置您的 SVN 客户端以绕过您的 Web 代理服务器或配置您的 Web 代理服务器以允许为您的 SVN 服务器使用所有 HTTP 动词。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T12:24:37.457

请检查 svn 属性“忽略”中的结束行字符。大多数客户端标准化行尾，但看起来 netbeans 没有。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-29T00:08:10.463

Assuming you are using a proxy like one of the answers suggested, did you remember to put a pre-revprop-change.bat file in the directory of the proxy? The contents should be at least

```
@exit 0 
```

No or necessary.

# java - 使用 Google Collections 创建 Weak Multimap

> ID：737060
> 
> 赞同：9
> 
> 时间：2009-04-10T08:32:56.997
> 
> 标签：java, weak-references, guava, multimap

是否有与用于 MultiMaps 的漂亮 MapMaker 的等价物？目前我像这样创建缓存：

```
 public static Map<Session,List<Person>> personCache = new MapMaker().weakKeys().makeMap(); 
```

MultiMap 的重点是避免嵌套列表值。有没有办法用弱键构造多图？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T21:04:14.150

不幸的是没有。然而。您能否在我们的问题数据库中提交 MultimapMaker 功能请求？ [http://google-collections.googlecode.com](http://google-collections.googlecode.com)

# c++ - 一个简单的 cobol 程序需要重新编码为 C++ 程序来读取包装安全软件传递的环境变量

> ID：737061
> 
> 赞同：1
> 
> 时间：2009-04-10T08:32:58.837
> 
> 标签：c++, cobol

我有一个 COBOL exe 程序，它调用一个 COBOL dll，而后者又使用一个 dos 中断“x91”调用一个 COBOL 程序——调用程序使用一个“x91”来激活一个 EXE 文件，就好像它是作为操作系统命令行输入的一样入口。包装我的 cobol 代码的安全程序是包装我的程序的第三方程序。作者建议我的程序读取环境变量以确保安全性没有被黑客入侵。我一直无法让我的 cobol 读取变量，所以我认为用 C 编写程序，可以读取变量。目前的程序所做的只是创建一个小的顺序文件，向其中写入一条记录并关闭文件 - 为了安全起见，我有第三方安全软件包装的程序，它会生成我想要验证的变量，以允许程序将记录与安全检查的内容一起写入通过或未通过的内容。调用程序（cobol dll）然后测试文件是否存在，读取记录并验证是否已将安全代码写入文件。

COBOL 程序需要翻译成 C++，因为安全包装代码的作者说他不能与 cobol 可执行文件交互。

*   现在的程序很小
*   它所做的只是创建一个小的顺序平面文本文件，向其中写入一条记录，然后写入记录并关闭文件。
*   该程序需要检查由安全程序生成的某些“环境”变量的存在和值，该安全程序围绕生成文件的小程序，并在被包装的程序运行时运行。

例如，变量“LICENSE”返回当前使用的许可证的名称。感谢您的任何意见。

安全软件的作者无法提供一个小的可执行文件来检查他的变量，所以我希望从头开始创建一个来模拟我一直提到的小 cobol 程序（阅读安全程序包装的环境变量并保护我的小程序，创建一个文件，向其中写入一条记录，其内容取决于环境变量的值，然后关闭文件）。这样，调用 DLL 将收到由 'x91' 调用操作系统（需要用 C++ 编写而不是现在的 Cobol 编写的那个）执行的小程序编写的文件，验证其内容，或者允许主程序进行与否。主要软件由我从大型机遗留代码移植到 PC 的 500 多个程序组成。

激活新的小包装程序的 DOS 调用将适用于任何可执行程序，所以这真的不是问题..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T19:04:11.287

I know nothing about COBOL, but there are pretty clear instructions for using it to read Windows environment variables [here](http://www.simotime.com/nxcsys01.htm).

After looking over that, I am *glad* I don't know anything about COBOL.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T08:42:56.507

几点：

*   我真的不认为您的代码是由“DOS 中断”执行的，因为您不能在 Windows 中使用这些代码，您的问题暗示您正在使用这些代码。顺便说一句，请添加 SO 标签来表明这一点。
*   你说它不能读取环境变量，但是调用应用程序（用相同的语言编写）可以创建它们？这似乎也不太可能。
*   您想在代码中的哪个位置读取环境变量以及您想用它做什么？

作为一个快速的解决方案，我建议让包装代码将环境变量值写入一个文件，然后读取它。如果您真的想要 C 或 C++ 解决方案，则必须澄清您的问题。

**编辑：**请注意 StackOverflow 是一个回答编程问题的网站 - 它不是一个为您提供免费软件的网站。如果问题像你说的那样简单（并且需要 C 解决方案，我仍然不相信），请聘请 C 程序员半天来编写它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T08:52:34.267

由于我们在这里并不都说 COBOL，而且代码相当小，因此编写一些解释 COBOL 功能的伪代码可能符合您的最佳利益。

我可能*会*在 Perl 中找到一个可以完全满足您需求的单行代码，但目前，我不知道您到底想要*什么*，所以我无法帮助您。（即使您*确实*想要一个 Perl -单线 ;) )

# java - 从 servlet 访问 Oracle 8i 表时的奇怪行为

> ID：737065
> 
> 赞同：0
> 
> 时间：2009-04-10T08:34:57.197
> 
> 标签：java, oracle, servlets, cachedrowset

首先介绍一下背景，我使用的是 jdk 1.6。我在 Oracle 8i DB 中有一个 2 列的表，其中包含一个非常简单的代码到字图。没有奇怪的字符。两列都是 varchar。

在我的台式机上，当我执行以下操作时：

```
 OracleDataSource ods = new OracleDataSource();

        ods.setDriverType("thin");
        ods.setServerName("DBserver.db");
        ods.setDatabaseName("DB");
        ods.setPortNumber(1527);
        ods.setUser("user");
        ods.setPassword("password");

        Connection connection = ods.getConnection();
        Statement stmt = connection.createStatement();
        ResultSet res = stmt.executeQuery(SQL);

        CachedRowSet crs = new CachedRowSetImpl();
        crs.populate(res);
        while (crs.next()) {
            System.out.println("ID: " + crs.getString(1) +
                               ",  Name: " + crs.getString(2));
        } 
```

一切正常，我得到了我期望的结果（getString(1) 和 getString(2) 的返回值与它们存储在表中的完全一样）

**然而：**

当我在 Tomcat 服务器上的 servlet 中执行完全相同的代码时（我使用简单的 applet servlet 模型来访问表并返回对 applet 的响应），crs.getString(int) 返回如下字符串：0x53， 0x54、0x4E 等等。

我不确定这意味着什么，如果能提供任何帮助，我将不胜感激。我想知道从哪里开始解决问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T08:44:04.427

Oracle 8i 很老了。我相信 1999 年或 2000 年。您的 jdk 和 Tomcat 以及 Oracle 和 JDBC 的组合是否经过认证/支持？

# java - 使用 JDO/DataNucleus 将 java.util.Properties 持久化为序列化对象

> ID：737067
> 
> 赞同：1
> 
> 时间：2009-04-10T08:35:39.177
> 
> 标签：java, jdo, datanucleus

Google AppEngine 文档说我可以像这样使用 JDO 持久化可序列化对象

```
import javax.jdo.annotations.Persistent;
import DownloadableFile;

// ...
@Persistent(serialized = "true")
private DownloadableFile file; 
```

但是如果我将它与属性一起使用

```
@Persistent(serialized="true")
private Properties initProps; 
```

我明白了

> DataNucleus Enhancer（1.1.0 版）：类的增强
> 
> “ServletRegistration”类中的“initProps”字段已定义为 Map，但未指定键类型！

我可以用额外的注释来解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T08:04:34.053

添加@Key(types=String.class) @Value(types=String.class)

因为“属性”有点小技巧，因为它也可以包含非字符串，并且不允许通用规范，所以你需要限制它。AppEngine 的下一个版本将具有不需要此附加信息的 DataNucleus 版本。

# asp.net - 为什么 url 重写在服务器中不起作用

> ID：737070
> 
> 赞同：0
> 
> 时间：2009-04-10T08:37:16.923
> 
> 标签：asp.net, url

在 asp.net 3.5 中，我正在重写 url

```
 http://www.dotoobeta/blogs/1108 
```

到以下

```
 http://www.dotoobeta/blogs/blogs.aspx 
```

我正在使用`UrlRewritingNet.UrlRewriter.dll`它，它在本地运行良好，但它不适用于我的其他服务器。我也已经修改了 IIS 中的配置。

解决办法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T09:35:25.100

也许您的服务器未配置为通过 ASP.NET 管道路由[http://www.dotoobeta/blogs/1108等请求。](http://www.dotoobeta/blogs/1108)如果服务器上有 IIS 6 或更高版本，则可以配置通配符处理程序并通过 ASP.NET 处理所有内容。不要忘记取消选中“验证该文件是否存在”复选框，否则它将不适用于不存在的路径。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-22T06:40:46.233

我有类似的问题，它是由架构引起的。我也必须像这样添加 64 位映射：

```
 <add name="aspnet_isapi"    path="*" verb="*" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll" resourceType="Unspecified" requireAccess="None" preCondition="classicMode,runtimeVersionv2.0,bitness32" />
  <add name="aspnet_isapi-64" path="*" verb="*" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework64\v2.0.50727\aspnet_isapi.dll" resourceType="Unspecified" requireAccess="None" preCondition="classicMode,runtimeVersionv2.0,bitness64" /> 
```

# asp.net - ASP.NET：如何在同一个 aspx 页面中动态添加两个 Web 用户控件？

> ID：737075
> 
> 赞同：0
> 
> 时间：2009-04-10T08:43:27.690
> 
> 标签：asp.net

如何在同一个 aspx 页面中动态添加两个 Web 用户控件？当我尝试这样做时，我收到以下错误

无法将“ASP.webusercontroladult_ascx”类型的对象转换为“WebUserControl”类型。

我能够动态添加 1 个 Web 用户控件

```
for (int i = 0; i < 2; i++)
{
    Control uc = (WebUserControl)Page.LoadControl("WebUserControlAdult.ascx"); 
    Panel1.Controls.Add(uc);
    Panel1.Controls.Add(new LiteralControl(@"<br />"));
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T08:56:10.437

您是否尝试过为用户控件设置 ID？IE

```
 Control uc = (WebUserControl)Page.LoadControl("WebUserControlAdult.ascx");
 uc.id = "Dyn" + i.tostring();
 Panel1.Controls.Add(uc); 
```

还是将 UserControl 转换为错误的类型？也许

```
(WebUserControlAdult)Page.LoadControl ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T09:12:30.257

问题似乎出在演员阵容而不是循环中。

在您的情况下，我没有看到显式转换的要求。您可以简单地执行以下操作：

```
for (int i = 0; i < 2; i++)
{
  Control uc = Page.LoadControl("WebUserControlAdult.ascx"); 
  Panel1.Controls.Add(uc);
  Panel1.Controls.Add(new LiteralControl(@"<br />"));
} 
```

这应该有效。但是，如果您需要设置`WebUserControlAdult`类公开的一些显式属性，则需要进行强制转换。在这种情况下，您应该转换为 usercontrol 类类型（如@benophobia 所示）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T13:39:17.087

处理动态用户控件可能会让人头疼。

根据我的经验，每当您创建动态用户控件时，您必须设置它的 ID，以便 ASP.net 可以在回发时重新分配它，并在回发后保留控件值，您应该在 Page_Init 上重新加载用户控件事件。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T09:13:29.460

如果您的 WebUserControl 是数据绑定控件，您可能需要考虑使用[Repeater Controls](http://www.sitepoint.com/article/asp-net-repeater-control/)。

使用中继器控件，您只需要将控件放入`ItemTemplate`中继器中，例如，

```
<asp:Repeater ID="bunchOfControls" runat="server">
    <HeaderTemplate>
        <ul>
    </HeaderTemplate>
    <ItemTemplate>
        <li>
            <namespace:WebUserControlAdult runat="server />
        </li>
    </ItemTemplate>
    <FooterTemplate>
        </ul>
    </FooterTemplate>
</asp:Repeater> 
```

# vim - 如何在 VIM 中递归使用 Global？

> ID：737078
> 
> 赞同：3
> 
> 时间：2009-04-10T08:45:02.897
> 
> 标签：vim, recursion, global

":g-2-g/3/" 中是否有问题，或者全局中的递归是否丢失了？我无法理解错误的原因：

> E147：不能做：全局递归

如何在 VIM 中进行递归全局搜索？

**[尼尔对运营商的初步建议\| ]**

```
g/1.*2\|2.*1/ 
```

一个缺点是组合会随着 n 个数字扩展。对于三个数字，组合数为 3！(=6) 即

```
g/1.*2.*3\|2.*1.*3\|3.*1.*2\|1.*3.*2\|2.*3.*1\|3.*2.*1/ 
```

对于 n 个数字，组合的数量是 n!。

**[使用运算符 \& 的解决方案]**

Brian Carper 和 Neil Butterworth 找到了解决方案。非常感谢他们！

```
g/.*1\&.*2\&.*3/ 
```

它适用于整条线：

```
g/.*1\&.*2\&.*3\&.*/ 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T11:33:24.817

**新信息：**这就是你想要的——“\&”序列是“与”运算符：

```
g/.*1\&.*2\&.*3/ 
```

Brian Carper（见评论，再次感谢）的解释：

> `/1\&2/`行不通，因为两个分支都需要“在同一位置”匹配。`/.*1\&.*2/`让 match 将自身锚定在行的前面，然后扩展它需要找到数字的程度

# asp.net - IIS 6：启用虚拟路径

> ID：737079
> 
> 赞同：0
> 
> 时间：2009-04-10T08:45:34.707
> 
> 标签：asp.net, iis, iis-6, httpmodule

我开发了一个简单的文件浏览 HTTP 模块，它使用虚拟路径（即磁盘上实际不存在的路径）。该应用程序。在我的 IIS 7 上运行良好，但在 Win 2003 上，IIS 不会将 HTTP 请求转发到我的 Web 应用程序 - 而只是向浏览器返回“找不到页面”。

如何禁用此默认行为并允许我的 Web. 应用程序。处理 IIS 6 上的所有请求，无论文件是否实际上是磁盘？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T08:49:26.647

将通配符映射添加到 ASP.NET ISAPI 引擎（您可以从任何 ASP.Net 扩展映射复制位置），并确保未选中“验证该文件是否存在”。

您可以在虚拟目录应用程序配置中找到通配符映射。

# variables - Vim：如何在 vimrc 中使用变量？

> ID：737083
> 
> 赞同：7
> 
> 时间：2009-04-10T08:48:18.100
> 
> 标签：variables, vim

这是我想要做的，一个增加全局变量的简单函数。它工作正常。

```
let g:high_ind = 1

fun! IncHighlightInd()
  let g:high_ind = (g:high_ind + 1) %10
  return g:high_ind
endf 
```

我想在一个`map`

```
map <C-h> :call IncHighlightInd() <CR> :Highlight g:high_ind <CR> 
```

但`g:high_ind`不被识别为变量。如何使用这个变量？

或者更有趣的是，是否可以执行以下操作？

```
map <C-h> :Highlight IncHighlightInd() <CR> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-10T13:36:27.750

你必须使用 :exe 或 c_CTRL-R_=:

```
nnoremap <c-h> :exe ":Highlight ".IncHighLightInd()<cr>
nnoremap <c-h> :Highlight <c-r>=IncHighLightInd()<cr><cr> 
```

顺便说一句，我怀疑你应该看看这个页面：在 vim.wikia 上[突出显示多个单词。](http://vim.wikia.com/wiki/Highlight_multiple_words)

# visual-studio - 视觉工作室 2008 安装

> ID：737088
> 
> 赞同：0
> 
> 时间：2009-04-10T08:50:29.577
> 
> 标签：visual-studio, visual-studio-2008

我从系统中清除了 windows 临时文件和 %temp% 。（我安装了 vs 2008）但现在我无法创建新项目（窗口应用程序），无论 VS 2008 安装文件是否与 temp. 错误显示 doc settings/temp/ .... 缺少某些文件 ....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T08:59:21.943

不太确定您是否真的缺少项目模板，或者项目模板本身是否失败，但如果是前者，请尝试

打开 cmd.exe，转到 \Common7\IDE。运行“devenv /installvstemplates”

另见此处： http: [//msdn.microsoft.com/en-us/library/ms247116 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms247116(VS.80).aspx)

HTH 亚历克斯

# xml - 如何使文本每次只重复一次？

> ID：737091
> 
> 赞同：0
> 
> 时间：2009-04-10T08:53:10.863
> 
> 标签：xml, xslt

例如，我有这样的 XML 代码：

```
<quotes>
  <quote>
    <character>
      <name>LA FEU</name>
    </character>
  </quote>

  <quote>
    <character>
      <name>LA FEU</name>
    </character>
  </quote>

   <quote>
    <character>
      <name>LA FEU</name>
    </character>
  </quote>
</quotes> 
```

我的 XSLT 代码将其转换为 HTML：

```
<html>
      <body>
        <pre>
            <xsl:for-each select="quotes/quote">
            <!--Output name of the character in underline-->
            Name of character: <xsl:apply-templates select="//name"/> 
          </xsl:for-each>

        </pre>
      </body>
 </html> 
```

输出如下： 角色名称：LAFEULAFEULAFEU

如何让 NAME 每次只重复一次？你能帮帮我吗？谢谢，例如角色名称：LAFEU 角色名称：LAFEU

# 角色名称：拉弗

==================================================== ================================================

我想再问一件事与这个问题有关。如果 CHARACTER 在 QUOTES 下很多层，如下所示：

```
 <quotes>
      <quote>
        <!--play 1-->
        <play>
          <playtitle>All's Well That Ends Well</playtitle>
          <act>
            <acttitle>ACT IV</acttitle>
            <scene>
              <scenetitle>SCENE I</scenetitle>
              <speech>
                <name>
                  <name>LAFEU</name>
                </name>
................ 
```

如何在 For-each 语句中引用 NAME ，我试试这个，但不起作用

```
 <xsl:for-each select="quotes/quote">
            <!--Output name of the character in underline-->
            Name of character: <xsl:value-of select="play/*/name"/> 
   </xsl:for-each> 
```

你能帮我解决这个问题吗？谢谢你

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T09:10:03.057

在您的 XSLT 代码中试试这个：

```
<xsl:for-each select="quotes/quote/character">
    <!--Output name of the character in underline-->
    Name of character: <xsl:apply-templates select="name"/> 
</xsl:for-each> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T10:00:04.323

更新：这个解决方案是为了避免在有序集合上出现双打，我重读了你的问题，并看到我可能会误解。我在这里留下我的答案，因为它至少向您展示了如何摆脱不需要的 for-each 结构。

但是，您提出的问题恐怕是初学者的水平。你应该先学习基础知识。现在你在问：“请为我做我的工作”。

如果我可以建议，请先在这里查看：http: [//www.w3schools.com/xml/xml_xsl.asp](http://www.w3schools.com/xml/xml_xsl.asp)

像这样 ：

注意：（几乎）永远不要使用 for-each！！！！肯定不是这里！！ [看到这里](http://peterhelsen.blogspot.com/2009/03/never-ever-use-xslfor-each-element.html) 如果你坚持它但是，如果你想在一个 for-each 关闭中，你可以使用相同的前置兄弟逻辑。

```
<xsl:stylesheet version="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
  <html>
    <body>
      <pre>    
        <xsl:apply-templates select="//quote[not(./character/name = preceding-sibling::quote/character/name)]/character/name" />    
      </pre>
    </body>
  </html> 
</xsl:template>

 <xsl:template match="name">
    <pre>
    <xsl:value-of select="."/>
    </pre>
  </xsl:template> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T09:22:41.887

干得好！我已尝试对您的 XSLT 进行尽可能少的更改以实现所需的输出。

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="html"/>
  <xsl:template match="/">
    <html>
      <body>
        <pre>
          <xsl:for-each select="quotes/quote">
            <!--Output name of the character in underline-->
            Name of character: <xsl:apply-templates select="character/name"/> 
          </xsl:for-each>
        </pre>
      </body>
    </html>
  </xsl:template>
</xsl:stylesheet> 
```

这具有以下输出：

```
<html>
  <body>
    <pre>
        Name of character: LA FEU
        Name of character: LA FEU
        Name of character: LA FEU
    </pre>
  </body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T04:40:43.093

我刚刚找到了解决这个问题的好方法：使用应用模板，非常感谢你们:)。

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <!--Handle the document: set up HTML page-->
  <xsl:template match="/">
    <html>
      <body>
        <pre>
          THIS IS ANOTHER TEST
          <!--Display number of quotes in the document-->
          There is <xsl:value-of select="count(/*/quote)"/> quotes in the document       
          <xsl:apply-templates/>
        </pre>
      </body>
    </html>
  </xsl:template>
  <!--Create the title for the play-->
  <xsl:template match="playtitle">
    Play title: <xsl:value-of select="."/>
  </xsl:template>
  <!--Create the title for the scene-->
  <xsl:template match="scenetitle">
    Scene title: <xsl:value-of select="."/>
  </xsl:template>
  <!--create the title for act-->
  <xsl:template match="acttitle">
   Act title: <xsl:value-of select="."/>
  </xsl:template>
  <!--create the name for the character-->
  <xsl:template match="name">
     Character name: <span style="font-weight:bold;text-decoration:underline;"> 
     <xsl:value-of select="."/>   
    </span>
  </xsl:template>
  <!--create the text for the quote-->
  <xsl:template match="line">
         Quote text:
            <xsl:value-of select="."/>
  </xsl:template>
</xsl:stylesheet> 
```

# javascript - 如何从客户端获取文本框值并从中创建查询字符串？

> ID：737094
> 
> 赞同：2
> 
> 时间：2009-04-10T08:55:12.153
> 
> 标签：javascript, jquery, query-string

我正在使用 jquery 进行模式对话框。我想从一页打开模型对话框并将一些额外的查询字符串发送到模式对话框页面。像这样的东西：

```
 <asp:HyperLink ID="hypClientSearch" runat="server" NavigateUrl="~/SomePage.aspx?KeepThis=true&additionalQS='<%= txtBox.Text %>'&TB_iframe=true&height=650&width=800&modal=true" CssClass="thickbox" > 
```

这个例子不起作用。有谁知道解决方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T09:47:09.177

除了赫尔吉的回答。
如果您想使用 jQuery 获取文本框的值（当您需要使用其他选择器时使用 id），您可以使用：

```
var textBoxValue = $(textBoxSelector, window.opener.document).val(); 
```

**编辑**
哦，我刚刚注意到您使用的是模态。然后页面在 iFrame 中打开，您可以使用以下方法从 iFrame 中获取值：

```
var textBoxValue = $(textBoxSelector, window.parent.document).val(); 
```

此外，如果您需要在 iFrame 请求中将其发送到服务器，请尝试在单击时编辑链接的 href 属性：

```
$('#hypClientSearch').click( function() {
 var textBoxContent = $(textBoxSelector).val();
 $(this).attr('href', 'somepage.aspx?textbox='+textBoxContent+'&otherVarsForModal=foo');
 //we let the event bubble for the modal plugin, so ne returning false here
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T09:39:07.027

在模式对话框打开时尝试此操作（这是客户端 javascript）：

```
var textBoxValue = window.opener.document.getElementById("txtBoxId").value; 
```

然后，您使用 Javascript 将附加信息插入对话框中的正确位置，例如使用 JQuery。

# windows - 将批处理文件（.bat 文件）中的值返回到文本文件

> ID：737098
> 
> 赞同：3
> 
> 时间：2009-04-10T08:57:35.987
> 
> 标签：windows, batch-file

我有一个如下所示的 .bat 文件

```
@echo off 
for /f "delims=" %%a in ('C:\MyProj\Sources\SearchString.vbs') do (
set ScriptOut=%%a)
#echo Script Result = %ScriptOut%
echo %ScriptOut% >C:\ThreePartition\Sources\myfile.txt 
```

我希望将我的输出变量 ScriptOut 存储到文本文件中。任何人都可以建议将任何方法添加到我现有的批处理文件中。

谢谢麦迪

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T09:25:45.310

我是否正确理解您的文件被覆盖并且您希望附加它？如果是这样，试试这个：

```
echo %ScriptOut% >> C:\ThreePartition\Sources\myfile.txt 
```

（注意双“>>”）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T09:37:04.177

您在那里的`for`循环执行该脚本并为脚本返回的每一行运行。基本上这意味着您的环境变量`%ScriptOut%`仅包含输出的*最后*一行（因为每次循环处理另一行时它都会被覆盖）。所以如果你的脚本返回

```
a
b
c 
```

那么`%ScriptOut%`将只包含`c`. 如果最后一行为空或仅包含空格 iot 将有效删除`%ScriptOut%`这就是为什么当您执行

```
echo %ScriptOut% 
```

你只会得到`ECHO is on.`，因为在变量替换之后剩下的就是`echo`. 您可以使用

echo.%ScriptOut%

在这种情况下，您将得到一个空行（这将是`%ScriptOut%`此时包含的内容。

如果您想打印脚本返回到文件的每一行，那么您只需执行

```
cscript C:\MyProj\Sources\SearchString.vbs > C:\ThreePartition\Sources\myfile.txt 
```

或者`>>`，如果您希望将输出附加到文件中，请使用重定向，正如[Stanislav Kniazev 指出的那样](https://stackoverflow.com/questions/737098/return-a-value-from-batch-files-bat-fileto-a-text-file/737146#737146)。

如果您只想存储最后一个*非空*行，那么以下方法可能有效：

```
for /f "delims=" %%a in ('C:\MyProj\Sources\SearchString.vbs') do (
  if not "%%a"=="" set ScriptOut=%%a
) 
```

只有在循环变量不为空的情况下才会设置`%ScriptOut%`。

# c# - ASP.Net MVC - 如何处理 JSON 动作中的异常（返回 JSON 错误信息），但也发布过滤器的异常？

> ID：737101
> 
> 赞同：7
> 
> 时间：2009-04-10T08:58:54.110
> 
> 标签：c#, json, asp.net-mvc, exception, filter

我正在使用过滤器来记录由如下所示的操作引发的异常：

```
public override void OnActionExecuted(ActionExecutedContext filterContext) {
  if (filterContext.Exception != null) {
    //logger.Error(xxx);
  }
  base.OnActionExecuted(filterContext);
} 
```

现在我想处理我所有的 JSON 操作以返回带有异常信息的 JSON 结果。这允许 Ajax 调用确定服务器上是否有任何错误，而不是接收错误页面源，这对 Ajax 来说是无用的。我已经在我的 AppControllerBase 中为 JSON 操作实现了这个方法：

```
public ActionResult JsonExceptionHandler(Func < object > action) {
  try {
    var res = action();
    return res == null ? JsonSuccess() : JsonSuccess(res);
  } catch (Exception exc) {
    return JsonFailure(new {
      errorMessage = exc.Message
    });
  }
} 
```

这很好用，但显然 catch() 语句会阻止所有过滤器处理异常，因为实际上没有抛出异常。有什么方法可以让过滤器（filterContext.Exception）可以使用异常吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T21:40:36.557

您可以将异常存储在 RequestContext 中并在过滤器中拦截它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T10:18:39.870

解决方案：

**行动：**

```
public ActionResult JsonExceptionHandler(Func < object > action) {
  try {
    var res = action();
    return res == null ? JsonSuccess() : JsonSuccess(res);
  } catch (Exception exc) {
    controller.ControllerContext.HttpContext.AddError(exc);
    return JsonFailure(new {
      errorMessage = exc.Message
    });
  }
} 
```

**筛选：**

```
public override void OnActionExecuted(ActionExecutedContext filterContext) {
  var exception = filterContext.Exception ? ? filterContext.HttpContext.Error;
  if (exception != null) {
    //logger.Error(xxx);
  }

  if (filterContext.Result != null &&
    filterContext.HttpContext.Error != null) {
    filterContext.HttpContext.ClearError();
  }

  base.OnActionExecuted(filterContext);
} 
```

# c++ - pthread 返回 251

> ID：737102
> 
> 赞同：1
> 
> 时间：2009-04-10T08:59:14.423
> 
> 标签：c++, multithreading, pthreads

pthread_create 返回值 251 而不创建线程。有谁知道问题是什么？请帮忙。该机器是HP-UX。

我是多线程的新手。

```
 #include <stdio.h>
   #include <stdlib.h>
   #include <pthread.h>

   void *print_message_function( void *ptr );

   main()
   {
        pthread_t thread1, thread2;
        char *message1 = "Thread 1";
        char *message2 = "Thread 2";
        int  iret1, iret2;
        /* Create independent threads each of which will
         * execute function */

        iret1 = pthread_create( &thread1, NULL, print_message_function, (void*) message1);
        iret2 = pthread_create( &thread2, NULL, print_message_function, (void*) message2);

        /* Wait till threads are complete before
         * main continues. Unless we  */
        /* wait we run the risk of executing an
         * exit which will terminate   */
        /* the process and all threads before the
         * threads have completed.   */

        pthread_join( thread1, NULL);
        pthread_join( thread2, NULL);
        printf("Thread 1 returns: %d\n",iret1);
        printf("Thread 2 returns: %d\n",iret2);
        exit(0);
   }

   void *print_message_function( void *ptr )
   {
        char *message;
        message = (char *) ptr;
        printf("%s \n", message);
   } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T09:04:29.277

编辑：在 HP-UX11 上。pthread_create 失败并出现错误 251：函数不可用。

检查链接顺序中 -lc 是否位于 -lpthread 之前。如果是这种情况，则调用将解析为 C 库中的存根，并可能导致此错误。

* * *

您是否与-lpthread 链接？

您应该使用 errno.h 来查看系统上的错误 251，或者这应该会给您更详细的消息：

```
printf("%s\n", strerror(errno)); 
```

此外，在使用 pthread 时，您应该检查几乎每次调用 pthread* 的返回值（请参阅每个函数的[手册](http://www.manpagez.com/man/3/pthread_create/)以检查可能返回的错误）

对于 pthread_create，您至少有 2 个可能的错误（取决于您的系统和 pthread 实现）：

如果出现以下情况，pthread_create() 将失败：

[EAGAIN] 系统缺乏创建另一个线程所需的资源，否则将超出系统对进程 [PTHREAD_THREADS_MAX] 中线程总数的限制。

[EINVAL] attr 指定的值无效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T09:11:27.637

这在我的 Linux 机器上编译并运行，结果如下：

```
Thread 1
Thread 2
Thread 1 returns: 0
Thread 2 returns: 0 
```

所以看起来问题不在于您的代码，而在于环境。我已经有 10 多年没有使用 HP-UX 了，所以我无法帮助您。

# c++ - 从 Derived* 转换为 Base*&

> ID：737108
> 
> 赞同：6
> 
> 时间：2009-04-10T09:01:31.343
> 
> 标签：c++, polymorphism, compilation

我试图通过传递对指针的引用而不是指向指针的指针来回答[这里提到的问题，如下所示：](https://stackoverflow.com/questions/736982/c-polymorphism-not-supported-for-pointer-to-pointer)

```
class Parent 
{
};

class Child : public Parent 
{
};

void RemoveObj(Parent*& pObj)
{
    delete pObj;
    pObj = NULL;
}

int main()
{
    Parent* pPObj = new Parent;
    Child*  pCObj = new Child;
    pPObj = new Parent();
    pCObj = new Child();

    RemoveObj(pPObj);
    RemoveObj(pCObj); // This is line 32
    return 1;
} 
```

但这会在第 32 行产生以下编译器错误：

> 错误 C2664：“RemoveObj”：无法将参数 1 从“子 *”转换为“父 *&”

我同意不允许从 Child** 转换为 Parent**。但是为什么也不允许这种转换呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-10T09:17:03.833

类型的对象`Child*`不能绑定到 a的原因与 a不能转换为 a`Parent*&`的原因完全相同。允许它允许程序员（有意或无意地）在没有强制转换的情况下破坏类型安全。`Child**``Parent**`

```
class Animal {};

class DangerousShark : public Animal {};

class CuteKitten : public Animal {};

void f(Animal*& animalPtrRef, Animal* anotherAnimalPtr)
{
    animalPtrRef = anotherAnimalPtr;
}

void g()
{
    DangerousShark myPet;
    CuteKitten* harmlessPetPtr;

    f(harmlessPetPtr, &myPet); // Fortunately, an illegal function call.
} 
```

**编辑**

我认为一些混淆是由于“convert”和“conversion”这两个词的松散使用而产生的。

与可以重新分配的对象不同，引用不能被反弹，所以在引用的上下文中，当我们谈到转换时，我们只能关注初始化一个新的引用。

引用总是绑定到一个对象，从 OP 的问题来看，很明显他的目标是获得一个直接绑定到现有对象的引用。仅当用于初始化引用的对象与引用的类型*兼容*时，才允许这样做。本质上，只有当类型相同，或者对象的类型派生自引用的类型并且引用类型至少与初始化对象一样具有 cv 限定时。特别是，指向不同类型的指针不兼容引用，无论指向类型的关系如何。

在其他情况下，可以使用可以转换为引用类型的东西来初始化引用。但是，在这些情况下，引用必须是 const 而不是 volatile，并且转换将创建一个临时对象，并且引用将绑定到这个临时对象而不是原始对象。正如所指出的，这不适合 OP 激励示例的要求。

总之， a`Child`可以直接绑定到 a`Parent&`但 a`Child*`不能直接绑定到 a `Parent*&`。A`Parent* const&`可以用 a 初始化`Child*`，但引用实际上会绑定到`Parent*`从对象复制初始化的临时`Child*`对象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T09:09:11.497

*   你的类没有虚函数。请参阅[常见问题解答 20.7](http://www.parashift.com/c++-faq-lite/virtual-functions.html#faq-20.7)

*   因为`Parent *&`是对指向`Parent`对象的指针的引用。您正在传递一个指向 a 的指针`Child`——这些是不兼容的类型。您可以将临时绑定到 const 引用，即，如果您将参数更改为：

    `void RemoveObj(Parent* const& foo);`

但是，您将无法对此做太多事情。

> 这只是一个测试代码，所以我没有制作任何虚拟析构函数。如果我在第二次调用 RemoveObj() 时理解正确，我会得到一个临时 Parent* 对象，它可以作为对函数的 const 引用传递。这个对吗？

我强烈建议您在标准 C++98 模式下运行以下程序，一次在中，然后在您注释掉`foo(b)`和取消注释后再次运行`delete b`。接下来，尝试放入一个`virtual`before `~s()`。差异应该是不言自明的！

```
#include <iostream>
using namespace std;
struct s { 
  s() {cout << __func__ << endl; }
  ~s() {cout << __func__ << endl; } 
};

struct t : s { 
   t() {cout << __func__ << endl; }
   ~t() {cout << __func__ << endl; } 
};

void foo(s* const& x) { delete x; }

int main() {
 t* b = new t;
 foo(b);
 //delete b;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T09:43:20.667

您可以转换 a `Child* to a Parent*`: 这会创建一个临时的。但是您不能将非常量引用绑定到该临时文件。

那不是问题`**/*&/etc`。您正在尝试做的事情是完全可以的并且是有道理的。鲨鱼大战小猫有同样的问题：不是混合小猫和鲨鱼的问题。您不能将非常量引用绑定到该未命名指针。

这不是`Parent** vs. Child**`问题：在那里，如果 a`Child**`是 a `Parent**`，那么可以分配`p[0] = new NotAChild;`。所有都是 A 子类型的对象的集合不是 A 的集合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T09:09:19.860

type*& 是 type** 的另一种语法形式， Parent*& 和 Child*& 以及 Parent** 和 Child** 彼此无关 - 这些是不在一个类层次结构中的不同类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T09:24:17.310

由于 Dirk 提到的原因，这不起作用。如果您真的需要 RemoveObj 方法，那么我只需将您新分配的 Child 对象保存为 Parent*：

```
#include <iostream>

class Parent 
{
public:
    virtual ~Parent()
    {
        std::cout << "Parent destructor" << std::endl;
    }
};

class Child : public Parent 
{
public:
    virtual ~Child() 
    {
        std::cout << "Child destructor" << std::endl;
    }
};

void RemoveObj(Parent*& pObj)
{
    delete pObj;
    pObj = NULL;
}

int main (int argc, const char * argv[]) {

    Parent* pPObj = new Parent;
    Parent*  pCObj = new Child;

    RemoveObj(pPObj);    
    RemoveObj(pCObj); // This is line 32

    return 0;
} 
```

# ruby - Ruby 中的双重检查锁定安全吗？

> ID：737110
> 
> 赞同：3
> 
> 时间：2009-04-10T09:02:08.283
> 
> 标签：ruby, concurrency

本文[指出](http://en.wikipedia.org/wiki/Double_checked_locking_pattern)，当可以使用对仅部分初始化的对象的引用来更新共享变量时，双重检查锁定在某些语言/硬件组合上是不安全的。

I was wondering: does this also apply to Ruby? Is this something that varies by the Ruby implementation on the platform that it is run on or is the correct behavior detailed in the language specification?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-09-06T21:22:07.260

Double checking in Java is dangerous because a value might be assigned to the variable before the constructor is actually finished. This doesn't happen in Ruby: constructing an object is the same as assigning the result of a function call to a variable, because constructors are just normal functions. The assignment will only happen after the constructor has completely finished.

On MRI, an assignment is atomic. There is no official Ruby language or memory model specification but alternative implementations tend to try hard to mimic MRI's behavior even down to the most obscure details. Atomicity of assignment statement is a fairly important behavior so I expect that assignments on alternative Ruby implementations is atomic as well.

If you don't mind accidentally constructing two objects during contention, with one object being garbage collected later because it's duplicate, then you can use the ||= operator, like this:

```
@singleton ||= FooBar.new 
```

||= atomically assigns the result of the given expression to the variable, but only if the variable wasn't already set. You can end up with two FooBar.new instances but only one will be reachable. Ruby on Rails uses this technique internally to avoid using mutexes in some places.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T07:02:34.320

Ruby 的哪个实现？Ruby 1.8、1.9 和 JRuby 具有完全不同的线程实现，因此可能无法说清楚。

我没有您的问题的答案，但您似乎正在尝试在 Ruby 中编写快速并发代码。我对 Ruby 1.8 的经验是，这不是一个合理的目标。Ruby 1.9 可能更好，但仍然像 Python 一样具有全局解释器锁。

如果您正在编写 Ruby 代码，并且您正在考虑这些潜在的不安全优化以产生一些额外的性能，那么您可能应该考虑使用另一种语言。惯用的 Ruby 倾向于在效率和速度之前强调可读性和表现力。试图从 MRI 中提高速度并提高可靠性对我来说是一种挫败感。

我从事 Ruby 项目已经有一段时间了，该项目刚刚进入我们认真研究优化的阶段。在 JRuby 中运行该项目并用 Java 库替换在 Ruby 中实现的瓶颈导致速度和可靠性显着提高，而我们的工作相对较少。

JRuby 并不完美，但它的 Java 集成已被证明是有用且简单的。如果无法在您的项目中使用 JRuby，或者您对 C 而不是 Java 很熟悉，并且确定您可以编写安全的 C 而不会出现内存泄漏，那么为 Ruby 1.8 或 1.9 编写 C 扩展可能是最佳途径。

如果这个问题本质上是完全学术性的，我深表歉意。也许如果你能让我们知道你到底想做什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-08T22:37:55.933

Dirkjan Bussink (@dbussink) 在 RubyConf 上就这个话题发表了演讲。一旦可用，您将想要查看他的演讲。

# exception - NETCFv35.Messages.EN.wm.cab？

> ID：737112
> 
> 赞同：1
> 
> 时间：2009-04-10T09:03:59.480
> 
> 标签：exception, windows-mobile, compact-framework

在 .NET Compact Framework 3.5 中，默认情况下没有安装它们的实际错误消息字符串。非常适合将紧凑型框架塞进内存较少的 Windows 移动设备中，但当您是开发人员并且设备出现问题时就不是很好了。

从默认占位符消息中，我知道有一个 CAB 可用于安装这些消息，以防有可用空间并且需要它们。我已经在手机上安装了 NETCFv35.Messages.EN.wm.cab。但是，对于每个抛出的异常，我仍然会收到以下 Exception.Message ：

> “Er is een foutmelding beschikbaar voor deze uitzondering, maar deze kan niet worden weergegeven omdat deze berichten optioneel zijn, en momenteel niet zijn geïnstalleerd op dit apparaat. Installeer NETCFv35.Messages.EN.wm.cab voor Windows Mobile 5.0 en hoger of NETCFv35\. Messages.EN.cab voor andere 平台。开始通过 opnieuw om het bericht weer te geven。

即使您不阅读荷兰语，该消息的一般含义也应该足够清楚。有趣的是，尽管我的 Vista VS2008 开发笔记本电脑和我的 HTC TyTN II（开发）手机上都有标准的 WM6 UK ROM，但这条消息是荷兰语的。（？）

如果有人回答以下任何问题，我将不胜感激：

*   荷兰消息是否可能来自 NETCFv35 本身？TyTN II WM6 ROM中没有，应该是VS2008或者我自己安装的。框架本身是否有本地化？
*   荷兰语消息是否可能来自我第一次看到该消息后安装的 NETCFv35.Messages.EN.wm.cab？即使它的名字中有“EN”？
*   我怎么知道？
*   在空白的 WM6 Professional 模拟器中运行应用程序让 VS2008 在其上安装 NETCFv35，然后我会收到英文的异常消息。
*   底线：谁知道我必须做什么才能从手机中获取实际的 Exception.Message 文本？荷兰语或英语都可以。;-)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T19:42:58.737

您是否尝试过[这里](http://blogs.msdn.com/martijnh/archive/2008/01/03/fixing-exception-messages-on-the-net-compact-framework-3-5.aspx)提出的建议？这是一篇关于在 .NET Compact Framework 3.5 上修复异常消息的 MSDN 博客文章。

# sql - 暂时关闭约束 (MS SQL)

> ID：737115
> 
> 赞同：226
> 
> 时间：2009-04-10T09:04:51.507
> 
> 标签：sql, sql-server, sql-server-2005, constraints, entity-relationship

我正在寻找一种方法来暂时关闭所有数据库的约束（例如表关系）。

我需要将一个数据库的表复制（使用插入）到另一个数据库。我知道我可以通过以正确的顺序执行命令来实现这一点（不破坏关系）。

但是如果我可以暂时关闭检查约束并在操作完成后重新打开它会更容易。

这可能吗？

* * *

## 回答 #1

> 赞同：282
> 
> 时间：2014-10-24T16:30:45.313

```
-- Disable the constraints on a table called tableName:
ALTER TABLE tableName NOCHECK CONSTRAINT ALL

-- Re-enable the constraints on a table called tableName:
ALTER TABLE tableName WITH CHECK CHECK CONSTRAINT ALL
---------------------------------------------------------

-- Disable constraints for all tables in the database:
EXEC sp_msforeachtable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL'

-- Re-enable constraints for all tables in the database:
EXEC sp_msforeachtable 'ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL'
--------------------------------------------------------- 
```

* * *

## 回答 #2

> 赞同：232
> 
> 时间：2009-04-10T09:36:55.737

~~您只能在 SQL 2005+~~中禁用 FK 和 CHECK 约束。请参阅[更改表](http://msdn.microsoft.com/en-us/library/ms190273(SQL.90).aspx)

```
ALTER TABLE foo NOCHECK CONSTRAINT ALL 
```

或者

```
ALTER TABLE foo NOCHECK CONSTRAINT CK_foo_column 
```

不能禁用主键和唯一约束，但如果我理解正确的话，这应该没问题。

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2009-04-10T15:00:14.243

而且，如果你想验证你没有破坏你的关系并引入孤儿，一旦你重新武装你的支票，即

```
ALTER TABLE foo CHECK CONSTRAINT ALL 
```

或者

```
ALTER TABLE foo CHECK CONSTRAINT FK_something 
```

然后您可以重新运行并对任何已检查的列进行更新，如下所示：

```
UPDATE myUpdatedTable SET someCol = someCol, fkCol = fkCol, etc = etc 
```

那时的任何错误都将是由于未能满足约束。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-21T15:13:54.350

您实际上可以在单个 SQL 命令中禁用所有数据库约束，然后调用另一个单个命令重新启用它们。看：

*   [可以使用 TSQL 暂时禁用外键约束吗？](https://stackoverflow.com/questions/159038/can-foreign-key-constraints-be-temporarily-disabled-using-tsql/161410#161410)

我目前正在使用 SQL Server 2005，但我几乎可以肯定这种方法也适用于 SQL 2000

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-12T07:56:42.860

**禁用和启用所有外键**

```
CREATE PROCEDURE pr_Disable_Triggers_v2
    @disable BIT = 1
AS
    DECLARE @sql VARCHAR(500)
        ,   @tableName VARCHAR(128)
        ,   @tableSchema VARCHAR(128)

    -- List of all tables
    DECLARE triggerCursor CURSOR FOR
        SELECT  t.TABLE_NAME AS TableName
            ,   t.TABLE_SCHEMA AS TableSchema
        FROM    INFORMATION_SCHEMA.TABLES t
        ORDER BY t.TABLE_NAME, t.TABLE_SCHEMA

    OPEN    triggerCursor
    FETCH NEXT FROM triggerCursor INTO @tableName, @tableSchema
    WHILE ( @@FETCH_STATUS = 0 )
    BEGIN

        SET @sql = 'ALTER TABLE ' + @tableSchema + '.[' + @tableName + '] '
        IF @disable = 1
            SET @sql = @sql + ' DISABLE TRIGGER ALL'
        ELSE
            SET @sql = @sql + ' ENABLE TRIGGER ALL'

        PRINT 'Executing Statement - ' + @sql
        EXECUTE ( @sql )

        FETCH NEXT FROM triggerCursor INTO @tableName, @tableSchema

    END

    CLOSE triggerCursor
    DEALLOCATE triggerCursor 
```

> 首先，foreignKeyCursor 游标被声明为收集外键列表及其表名的 SELECT 语句。接下来，打开游标并执行初始 FETCH 语句。此 FETCH 语句会将第一行的数据读入局部变量 @foreignKeyName 和 @tableName。循环游标时，您可以检查@@FETCH_STATUS 的值是否为 0，这表示获取成功。这意味着循环将继续向前移动，因此它可以从行集中获取每个连续的外键。@@FETCH_STATUS 可用于连接上的所有游标。因此，如果您正在循环多个游标，请务必在 FETCH 语句之后的语句中检查 @@FETCH_STATUS 的值。@@FETCH_STATUS 将反映连接上最近 FETCH 操作的状态。@@FETCH_STATUS 的有效值为：
> 
> 0 = FETCH 成功
> -1 = FETCH 不成功
> -2 = 获取的行丢失
> 
> 在循环内部，代码根据意图是禁用还是启用外键约束（使用 CHECK 或 NOCHECK 关键字）以不同方式构建 ALTER TABLE 命令。然后将该语句打印为一条消息，以便可以观察其进度，然后执行该语句。最后，当所有行都被遍历时，存储过程关闭并释放游标。

请参阅[MSDN 杂志中的禁用约束和触发器](http://msdn.microsoft.com/en-us/magazine/cc163442.aspx)

# drupal - 在 Drupal 部分显示 YouTube 视频

> ID：737120
> 
> 赞同：0
> 
> 时间：2009-04-10T09:06:41.473
> 
> 标签：drupal

感谢[SOers 的帮助，现在我可以使用](https://stackoverflow.com/questions/736755/multiple-sections-in-content-block-for-drupal)[Panels 模块](http://drupal.org/project/panels)在 Drupal 页面中创建几个部分。我想在其中一个部分中嵌入一个 YouTube 视频，无论如何要这样做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T09:47:41.093

将“嵌入”代码直接粘贴到节点正文中，并将输入格式设置为过滤的 HTML。不需要任何额外的模块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T03:54:03.983

使用来自 drupal.org 的模块 Embedded Media Field。

使用此模块的优点是它验证嵌入代码文本的结构以确保有效的 YouTube 链接。胜过自己编写代码。

获取并安装模块，启用它。需要在 CCK 模块组中启用“嵌入式媒体字段”和“嵌入式视频”选项。

然后在“内容管理”中有一个“嵌入式媒体字段配置”链接。在该页面上展开“嵌入式视频字段”部分，然后展开“YouTube 配置”选项。勾选想要“允许来自 YouTube 的内容”。

现在，您可以将嵌入式视频字段添加到内容类型，并在需要时添加主题。

# xml - 使用 XPath 定位 XML 的某些部分的问题

> ID：737148
> 
> 赞同：0
> 
> 时间：2009-04-10T09:26:48.833
> 
> 标签：xml, xslt, xpath

### 重复

> [如何使文本每次只重复一次？](https://stackoverflow.com/questions/737091/how-to-make-the-text-repeat-only-once-every-for-each)

我在使用 XPATH 指向 XML 中的某些元素时遇到问题。这是我的 XML 代码：

```
 <character>
      <name>some name </some name>
    </character>

  </quote>
 <quote>
  ....
  </quote>
 </quotes> 
```

这里是我的 XSLT 代码：

```
<xsl:for-each select="quotes/quote">
    <xsl:value-of select="quotes/quote/character/name"/>
 </xsl:for-each> 
```

我尝试做的是尝试列出每个引用的字符名称。但是这段代码不起作用你能帮我解决这个问题吗？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T09:44:25.033

在内部`for-each`，上下文节点是`quote`- 所以*看起来*你只需要：

```
<xsl:for-each select="quotes/quote">
    <xsl:value-of select="character/name"/>
</xsl:for-each> 
```

当然，纯粹主义者会争辩说最好使用 a `match`：

```
<xsl:apply-templates select="quotes/quote" />
...
<xsl:template match="quote">
    <xsl:value-of select="character/name"/>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T09:44:10.413

错误是：
您使用**引号/引号**两次

你可以试试这个：

```
<xsl:for-each select="quotes/quote">
  <xsl:value-of select="character/name"/>
</xsl:for-each> 
```

# c# - 如何获取类的属性列表？

> ID：737151
> 
> 赞同：702
> 
> 时间：2009-04-10T09:29:55.393
> 
> 标签：c#, .net, reflection, properties

如何获取一个类的所有属性的列表？

* * *

## 回答 #1

> 赞同：943
> 
> 时间：2009-04-10T09:33:45.587

反射; 例如：

```
obj.GetType().GetProperties(); 
```

对于一个类型：

```
typeof(Foo).GetProperties(); 
```

例如：

```
class Foo {
    public int A {get;set;}
    public string B {get;set;}
}
...
Foo foo = new Foo {A = 1, B = "abc"};
foreach(var prop in foo.GetType().GetProperties()) {
    Console.WriteLine("{0}={1}", prop.Name, prop.GetValue(foo, null));
} 
```

* * *

根据反馈...

*   要获取静态属性的值，请将`null`其作为第一个参数传递给`GetValue`
*   要查看非公共属性，请使用（例如）`GetProperties(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance)`（返回所有公共/私有实例属性）。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2009-04-10T09:34:46.053

您可以使用**反射**来执行此操作：（来自我的库 - 这将获取名称和值）

```
public static Dictionary<string, object> DictionaryFromType(object atype)
{
    if (atype == null) return new Dictionary<string, object>();
    Type t = atype.GetType();
    PropertyInfo[] props = t.GetProperties();
    Dictionary<string, object> dict = new Dictionary<string, object>();
    foreach (PropertyInfo prp in props)
    {
        object value = prp.GetValue(atype, new object[]{});
        dict.Add(prp.Name, value);
    }
    return dict;
} 
```

这个东西不适用于具有索引的属性-为此（它变得笨拙）：

```
public static Dictionary<string, object> DictionaryFromType(object atype, 
     Dictionary<string, object[]> indexers)
{
    /* replace GetValue() call above with: */
    object value = prp.GetValue(atype, ((indexers.ContainsKey(prp.Name)?indexers[prp.Name]:new string[]{});
} 
```

此外，仅获取公共属性：（[请参阅 MSDN 上的 BindingFlags 枚举](http://msdn.microsoft.com/en-us/library/system.reflection.bindingflags(VS.71).aspx)）

```
/* replace */
PropertyInfo[] props = t.GetProperties();
/* with */
PropertyInfo[] props = t.GetProperties(BindingFlags.Public) 
```

这也适用于匿名类型！
要获取名称：

```
public static string[] PropertiesFromType(object atype)
{
    if (atype == null) return new string[] {};
    Type t = atype.GetType();
    PropertyInfo[] props = t.GetProperties();
    List<string> propNames = new List<string>();
    foreach (PropertyInfo prp in props)
    {
        propNames.Add(prp.Name);
    }
    return propNames.ToArray();
} 
```

只是值几乎相同，或者您可以使用：

```
GetDictionaryFromType().Keys
// or
GetDictionaryFromType().Values 
```

但这有点慢，我想。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2014-07-24T02:57:04.577

```
public List<string> GetPropertiesNameOfClass(object pObject)
{
    List<string> propertyList = new List<string>();
    if (pObject != null)
    {
        foreach (var prop in pObject.GetType().GetProperties())
        {
            propertyList.Add(prop.Name);
        }
    }
    return propertyList;
} 
```

此函数用于获取类属性列表。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2017-07-14T16:22:06.943

根据@MarcGravell 的回答，这里有一个适用于 Unity C# 的版本。

```
ObjectsClass foo = this;
foreach(var prop in foo.GetType().GetProperties()) {
    Debug.Log("{0}={1}, " + prop.Name + ", " + prop.GetValue(foo, null));
} 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2009-04-10T09:35:05.227

您可以将`System.Reflection`命名空间与方法一起使用`Type.GetProperties()`：

```
PropertyInfo[] propertyInfos;
propertyInfos = typeof(MyClass).GetProperties(BindingFlags.Public|BindingFlags.Static); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-09-20T06:20:27.403

这就是我的解决方案

```
public class MyObject
{
    public string value1 { get; set; }
    public string value2 { get; set; }

    public PropertyInfo[] GetProperties()
    {
        try
        {
            return this.GetType().GetProperties();
        }
        catch (Exception ex)
        {

            throw ex;
        }
    }

    public PropertyInfo GetByParameterName(string ParameterName)
    {
        try
        {
            return this.GetType().GetProperties().FirstOrDefault(x => x.Name == ParameterName);
        }
        catch (Exception ex)
        {

            throw ex;
        }
    }

    public static MyObject SetValue(MyObject obj, string parameterName,object parameterValue)
    {
        try
        {
            obj.GetType().GetProperties().FirstOrDefault(x => x.Name == parameterName).SetValue(obj, parameterValue);
            return obj;
        }
        catch (Exception ex)
        {
            throw ex;
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2020-08-26T09:34:26.977

尝试这个：

```
var model = new MyObject();
foreach (var property in model.GetType().GetProperties())
{
    var descricao = property;
    var type = property.PropertyType.Name;
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-04-10T09:33:54.433

您可以使用反射。

```
Type typeOfMyObject = myObject.GetType();
PropertyInfo[] properties =typeOfMyObject.GetProperties(); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-09-19T08:08:43.100

这是改进的@lucasjones 答案。在他回答之后，我在评论部分提到了改进。我希望有人会发现这很有用。

```
public static string[] GetTypePropertyNames(object classObject,  BindingFlags bindingFlags)
{
    if (classObject == null)
    {
        throw new ArgumentNullException(nameof(classObject));
    }

        var type = classObject.GetType();
        var propertyInfos = type.GetProperties(bindingFlags);

        return propertyInfos.Select(propertyInfo => propertyInfo.Name).ToArray();
 } 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2021-05-20T08:04:34.793

以下代码将为您提供类属性/属性/表列的列表

```
var Properties = typeof(className).GetProperties().Select(x=>x.Name).Tolist(); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-06-04T13:43:49.223

我也面临这样的要求。

从这次讨论中我得到了另一个想法，

```
Obj.GetType().GetProperties()[0].Name 
```

这也显示了属性名称。

```
Obj.GetType().GetProperties().Count(); 
```

这显示了属性的数量。

谢谢大家。这是很好的讨论。

# sql-server - 如何以编程方式禁用主键约束？

> ID：737152
> 
> 赞同：7
> 
> 时间：2009-04-10T09:29:57.017
> 
> 标签：sql-server, sql-server-2005, tsql

我的 MS SQL Server 2005 表中有一个带有主键的表。我想禁用它。现在我得到错误：

违反 PRIMARY KEY 约束“PK_Name”。无法在对象“dbo.Table”中插入重复键。

我希望不会发生此错误，并希望像使用没有约束的普通列一样使用 PRIMARY KEY，而不是在对其进行更改后恢复此约束。如何禁用此约束？

我想在 PRIMARY KEY 约束禁用时执行的查询很复杂，并且会更改主键列中的值。在此查询的某些点中，当我在主键列中有重复值时，它会遇到这种情况。但在我的查询结束时，我的所有值都是唯一的。

我对这个约束了解不多，因为我不是这个表的设计者。我有它的名字，但如果它是集群的等等，我现在没有（这个专栏的配置是什么）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-10T09:36:10.153

```
ALTER TABLE mytable DROP CONSTRAINT PK_Name 
```

要重新启用它：

```
ALTER TABLE mytable ADD CONSTRAINT PK_Name PRIMARY KEY /* CLUSTERED */ (pk_column) 
```

`CLUSTERED`如果您希望自己被聚集，请取消注释`PRIMARY KEY`（即表行本身正在被排序）

要确定 是否`PRIMARY KEY`聚集在 not 上，请发出：

```
EXEC sp_help 'mytable' 
```

并查看`6th`返回的结果集。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T09:54:10.860

没有主键的关系表是一件非常糟糕的事情。每行必须以某种方式是唯一的。如果没有一个候选键被指定为主键，则整行必须是唯一的。

我不确定为什么必须删除主键约束，但我会考虑这样做而不用其他候选键之一替换它是一个应该调查的危险信号。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T11:12:36.677

要找出主键是什么（假设您的表是 dbo.T1）：

```
select si.name as name,  
(case  when (si.status & 16) > 0 then 1 else 0 end) as isclust,
si.keycnt as keycnt,
si.indid as indid
from sysindexes si
left join sysobjects so on so.id = si.id 
where  si.indid > 0 
and  si.indid < 255 
and so.xtype <> 'S'
and so.id = OBJECT_ID('dbo.T1')
and (si.status & 2048) > 0 
```

这会给你类似的东西：

```
名称 isclust keycnt indid
-------------------------------------------------- -------------
PK_T1 1 2 1

```

在这里你有你的主键名称（PK_T1），无论它是否聚集，其中的字段数（2）和索引ID（稍后你会需要它）。

接下来运行以下命令：

```
select INDEX_COL('dbo.T1', 1, 1) --returns Field1
select INDEX_COL('dbo.T1', 1, 2) --returns Field2 
```

这将为您提供索引中两个字段的名称。第一个参数是你的表名，第二个是之前获得的索引 id，第三个参数从 1 循环到 keycnt（在上一步返回）。

有了这些信息，您应该能够重建主键，如下所示：

```
ALTER TABLE dbo.T1 ADD CONSTRAINT PK_T1 PRIMARY KEY CLUSTERED (Field1, Field2) 
```

更新：这可能不如前面提到的解析 sp_help 结果准确[（](https://stackoverflow.com/questions/737152/how-to-disable-primary-key-constraint-programmatically/737165#737165)您会错过排序顺序和文件组），但以编程方式更容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T09:58:08.073

不要违反 PKEY 约束。恕我直言，这是最好的解决方案，您将避免重建 PKEY 的成本，如果您不能（重复剩余）怎么办？

或者

阅读架构以了解如何重建 PKEY 约束，然后使用之前发布的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T10:44:25.123

将整个表转换为临时表可能是一个更好的主意，`SELECT`如果可能的话，在运行中进行转换，然后将其复制回来。如果你不能即时转换，添加一个简单的整数行索引作为临时表的主键要容易得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-12-26T19:23:10.430

以下为我工作（您必须是 db_owner 才能执行此操作）

--声明一个变量以获取表上的约束并分配给一个变量

```
DECLARE @PK_CONST_NAME AS varchar(100)<br>
SET @PK_CONST_NAME = (SELECT NAME FROM SYS.KEY_CONSTRAINTS WHERE OBJECT_NAME(PARENT_OBJECT_ID) = '[TABLENAME]') 
```

--存储查询的变量

```
SET @DropAlterQuery = ''<br>
SET @RecreateAlterQuery = '' 
```

-- 构造查询

```
SET @DropAlterQuery = CONCAT('ALTER TABLE [TABLENAME] DROP CONSTRAINT ',@PK_CONST_NAME) 
```

-- 执行为删除约束构造的查询

```
EXEC(@DropAlterQuery) 
```

-- 改变列大小（现在这个语句作为约束被删除）

```
ALTER TABLE [TABLENAME]
ALTER COLUMN BATCH_ID VARCHAR(200) NOT NULL 
```

-- 构造查询

```
SET @RecreateAlterQuery = CONCAT(CONCAT('ALTER TABLE [TABLENAME] ADD CONSTRAINT ',@PK_CONST_NAME), ' PRIMARY KEY (<<PRIMARY KEY COLUMN1>>, <<PRIMARY KEY COLUMN2>>, <<PRIMARY KEY COLUMN2>>... So on)') 
```

-- 执行为重新创建删除的约束构造的查询

```
EXEC(@RecreateAlterQuery) 
```

# asp.net-3.5 - 如何在用户控件上获取文本框的值

> ID：737154
> 
> 赞同：3
> 
> 时间：2009-04-10T09:30:38.997
> 
> 标签：asp.net-3.5

我有一个用户控件，上面有一个文本框，现在这个用户控件位于我在 aspx 页面上使用的另一个用户控件上，如何获取第一个用户控件上的文本框的值。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-10T09:37:25.487

在您的用户控件中编写一个属性以公开其内容，例如，

```
public string TextBoxValue
{
    get { return txtControl1.Text; }
} 
```

这样您就可以获得文本框的值，而无需将整个文本框控件公开为公共对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T10:04:47.667

Jon Limjap 的回答为此类问题提供了最佳解决方案 - 使用公共属性公开控件值。

但是，如果您不想这样做（或者您必须为很多控件这样做并且希望避免为每个控件创建公共属性），您可以使用反射在 ChildControls 中“找到控件”所需的用户控件：

```
TextBox txt = UserControl1.FindControl("myTextBox") as TextBox;

if (txt != null)
{
  string val = txt.Text;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-01T10:55:30.183

在**.aspx**页面的顶部，在标记上方添加以下行。

```
<%@ Register TagPrefix="Test" TagName="TestControl" Src="Test.ascx" %> 
```

该指令注册控件，以便在处理页面时可以识别它。TagPrefix 确定控件的唯一命名空间，TagName 是用户控件的名称，Src 是用户控件的路径。声明用户控件，例如

```
<Test:TestControl id="TestControl" runat="Server"/> 
```

在 .aspx 页面中访问和设置用户控件的值：用户可以通过属性、使用 javascript 和 aspx 页面的代码隐藏从 .aspx 页面访问和设置用户控件的值。详细信息如下所示使用属性如果 test.ascx 控件有两个文本框和提交按钮。您可以通过在 .ascx 页面中声明公共属性从 .aspx 页面访问控件中文本框的值。

```
public string FirstName
{
get{return txtFirstName.Text;}
set{txtFirstName.Text = value;}
} 
```

在 .aspx 页面中，您可以使用 FirstName 访问

```
TestControl.FirstName
You can set the FirstName of the control from aspx page using
TestControl.FirstName = "Suzzanne" 
```

注意：[参考](http://www.c-sharpcorner.com/UploadFile/Santhi.M/PassingValuesfrmUCtoASPX11212005050040AM/PassingValuesfrmUCtoASPX.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-30T03:02:49.943

我认为从请求中获取价值更容易。您可以编写这样的通用方法来找到它：

```
 string get_value(string control_name)
    {
        var key = Request.Form.AllKeys.First(x => x.ends_with(control_name));
        return Request.Form[key];
    } 
```

# c# - 使用图像填充面板 .Winforms

> ID：737158
> 
> 赞同：0
> 
> 时间：2009-04-10T09:33:58.223
> 
> 标签：c#, .net, winforms

我有这个代码显示在带有 pIctureBox 的面板图像中：

```
private void ARR(int cNumber, string exc)
    {
       int Xpos = 8;
        int Ypos = 8;
        Image img;
            Image.GetThumbnailImageAbort myCallback = 
            new Image.GetThumbnailImageAbort(ThumbnailCallback);
        imgArray = new System.Windows.Forms.PictureBox[cNumber]; // assign number array 
        for (int i = 0; i < cNumber; i++)
        {
            imgArray[i] = new System.Windows.Forms.PictureBox(); 
            if (Xpos > 432) // six images in a line
            {
                Xpos = 8; // leave eight pixels at Left 
                Ypos = Ypos + 72;  // height of image + 8
            }     
            imgArray[i].Left = Xpos;
            imgArray[i].Top = Ypos;
            imgArray[i].Width = 64;
            imgArray[i].Height = 64;
            imgArray[i].Visible = true;         
            imgArray[i].SizeMode = PictureBoxSizeMode.StretchImage;
            img = Image.FromFile(exc);
            imgArray[i].Tag = exc[i]; 
            imgArray[i].Image = img.GetThumbnailImage(64, 64, myCallback, IntPtr.Zero);
            panel1.Controls.Add(imgArray[i]);
            Xpos = Xpos + 72;
        }

    } 
```

私人列表GetPicture4（字符串文件夹）{

```
 DirectoryInfo dir = new DirectoryInfo(Folder);
        List<string> str = new List<string>();
        FileInfo[] files = dir.GetFiles("*.jpg", SearchOption.AllDirectories);   
        NumOfFiles = files.Length;
        imgExtension = new string[NumOfFiles];

        for (int i = 0; i < NumOfFiles; i++)
        {

        foreach (FileInfo file in files)
        {
            ARR(NumOfFiles, file.FullName);
            str.Add(file.FullName);

      }
        return str;
    } 
```

在文件夹“音乐”中有 30 个文件.jpg 但是当我调试面板时显示 30 张图片但相同的文件“jpg”。我不明白错误在哪里:(。你有什么建议或想法我错了吗？非常感谢。

很好的问候

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T10:06:55.447

还没弄明白，但你的代码不起作用：

```
private List<string> GetPicture4(string Folder)  //you need to define the type of list you are returning
{
    DirectoryInfo dir = new DirectoryInfo(Folder);
    List<string> str = new List<string>();
    FileInfo[] files = dir.GetFiles("*.jpg", SearchOption.AllDirectories);   
    int NumOfFiles = files.Length; //here you are missing a type, int in this case
    imgExtension = new string[NumOfFiles];

    for (int i = 0; i < NumOfFiles; i++)
    {
        ARR(i, files[i].FullName); //pass i instead of NumOfFiles else in ARR the creating of the picturebox gets the same ID everytime
        str.Add(files[i].FullName);
    }

    return str;
} 
```

编辑：添加功能怎么样：

```
imgArray = new System.Windows.Forms.PictureBox[cNumber]; // assign number array 
```

这条线不应该在这里。您已经在循环中创建了一个

# java - JPA中的双向关系

> ID：737173
> 
> 赞同：1
> 
> 时间：2009-04-10T09:41:33.353
> 
> 标签：java, jpa

我有两个实体类，用户和 MyCharacter。用户有一个 MyCharacters 列表，每个 MyCharacter 都有一个对用户（所有者）的引用。我想要完成的是，我对两个关系使用相同的连接表，这意味着在 MyCharacter 中找到的所有者关系将自动使用与 User=>MyCharacter 相同的连接表。这意味着 MyCharacter 中的 getOwner() 方法应该可以工作，而无需我在某些时候显式调用 setOwner(user)。

为了更清楚这一点，这是我当前失败的单元测试（最后一个断言失败）

```
 @Test
public void testTwoWayRelation() {
    User user = new User();
    MyCharacter character = new MyCharacter();
    List<MyCharacter> chars = new ArrayList<MyCharacter>();
    chars.add(character);
    user.setCharacters(chars);

    facade.store(user);
    assertNotNull(character.getId());

    character = facade.find(MyCharacter.class, character.getId());

    assertNotNull(character.getOwner());
} 
```

下面列出了我的实体类。

```
 @Entity
@Table(name = "myuser")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    protected Long id;

    @OneToMany(cascade = { CascadeType.PERSIST })
    protected List<MyCharacter> characters;

    public User() {

    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public List<MyCharacter> getCharacters() {
        return characters;
    }

    public void setCharacters(List<MyCharacter> characters) {
        this.characters = characters;
    }

}

@Entity
public class MyCharacter{
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    protected Long id;

    @ManyToOne
    @JoinTable(name = "myuser_mycharacter", joinColumns = @JoinColumn(name = "characters_id"), inverseJoinColumns = { @JoinColumn(name = "user_id") })
    protected User owner;

    public MyCharacter() {

    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public User getOwner() {
        return owner;
    }

    public void setOwner(User owner) {
        this.owner = owner;
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T10:41:05.380

这就是我们在项目中使用 jpa 连接两个实体的方式：

```
 @Entity
    @Table(name = "Period")
    public class Period implements Serializable {
      private List<Delay> delays = new ArrayList<Delay>();

      @OneToMany(mappedBy="period") //name of the field in joined entity
      public List<Delay> getDelays() {
        return delays;
      }
    }

   @Entity
   @Table(name = "Delay")
   public class Delay implements Serializable {

    private Period period;

    @ManyToOne
    @JoinColumn(name = "PERIODID")
    public Period getPeriod() {
       return period;
    }   
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T11:22:54.297

我不确定我是否正确理解了您的问题，但您可以尝试在 MyCharacter.owner 上设置 mappedBy：

```
@ManyToOne(mappedBy="characters") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T10:18:46.917

[这是 Oracle 的一篇文章](http://www.oracle.com/technology/pub/articles/gupta-jpa.html)，解释了如何映射这种关系。

当您在 Java 中使用它时，根据您的 JPA 框架，您将需要将其添加`MyCharacter`到列表中`User` *并将*`user`字段设置为`MyCharacter`或两者中的一个（因为框架将为您管理另一端）。我建议编写一个小测试来弄清楚什么是有效的（无论如何，您应该为使用对象的所有方式编写测试用例）。

从数据库加载对象时，您不需要这样做，因为所有框架都能正确处理这种情况。

# html - 类似 Facebook 的好友列表

> ID：737178
> 
> 赞同：0
> 
> 时间：2009-04-10T09:43:34.363
> 
> 标签：html, css

我想设计一个与 Facebook 几乎相同的朋友列表页面，如何有一个带有一些文本的缩略图图像（与图形顶部对齐），然后被一个柔和的框包围。

有人可以为此提供一些示例 HTML/CSS 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T09:51:16.327

我可以建议您使用 Firefox 浏览器并安装 Firebug 插件。然后从任何你喜欢的地方检查你想要`plagiarise`的任何东西。如果您从事 Web 开发，Firebug 是必备品 :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-22T12:34:07.617

从长远来看，通过 Firebug 查看和学习他们的 html/css 可能是最好的，但这个细分也可能很有用：[How to Style an Application Like Facebook](http://devtacular.com/articles/bkonrad/how-to-style-an-application-like-facebook)。

# web-services - 在 symfony 中将表单数据作为 Web 服务发送

> ID：737180
> 
> 赞同：1
> 
> 时间：2009-04-10T09:44:23.457
> 
> 标签：web-services, forms, symfony1

我正在使用 symfony 创建一个到 WiFi 网络的限制性门户，并且我想将一个表单作为 Web 服务发送到其他想要使用该门户的站点。我应该如何解决这个问题？我意识到我可以走 SOAP/WSDL 路线，但由于 symfony 已经是 RESTful 的，在我看来，我可以走 RESTful 路线而痛苦和性能损失要小得多。

现在，我有一个工作表单，但我只是偶然尝试使用 cURL 将表单带到远程站点。由于路由设置不正确（我认为），该表单无法远程工作。有人可以帮我弄这个吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-22T10:47:23.520

要在某处调用 restfull 服务，您只需调用其 URL 并读取结果。你有什么例子不工作吗？“其他”服务是否支持 restfull 呼叫？：） 但愿如此。

调用 rest 服务真的就像打开一个在 URL 中带有一些参数的网站一样简单。所以我想知道什么不应该工作。如果您没有阻止对该远程服务的访问，则可以使用一些 simplexmlreader 等直接读取 restful 服务。

# asp.net-mvc - 网站本地化取决于域名扩展

> ID：737183
> 
> 赞同：0
> 
> 时间：2009-04-10T09:45:33.500
> 
> 标签：asp.net-mvc, localization, web-config

我目前正在用 ASP.Net MVC 构建我的个人网站，我想要**两个版本**：一个法语版本和一个英语版本。

我有**两个域名**，我想将英文版与“ **.com** ”域匹配，将法语版与“ **.fr** ”域匹配：

*   当您访问 www.mywebsite.fr 时，您将获得法语版本
*   当您访问 www.mywebsite.com 时，您将获得英文版

所以，我的问题是：推荐的处理方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T09:51:30.193

快速概述：使用[ASP.NET 本地化](http://msdn.microsoft.com/en-us/library/c6zyy3s9.aspx)基础结构来启用本地化（有[很多东西](http://blog.eworldui.net/post/2008/05/ASPNET-MVC---Localization.aspx)可用于本地化基于 ASP.NET MVC 的站点）并将部分添加到您的`Web.config`映射`.com`到`en-US`和.`.fr``fr-Whatever`

# c# - C#中的闪烁文本

> ID：737195
> 
> 赞同：4
> 
> 时间：2009-04-10T09:53:32.013
> 
> 标签：c#

如何使用 C# 在控制台中闪烁文本？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T10:31:14.093

Person-b 是在正确的轨道上，但他们的代码需要一些更改：

```
 static void Main()
    {
        string txt = "Hello, world!";
        while (true)
        {
            WriteBlinkingText(txt, 500, true);
            WriteBlinkingText(txt, 500, false);
        }
    }

    private static void WriteBlinkingText(string text, int delay, bool visible)
    {
        if (visible)
            Console.Write(text);
        else
            for (int i = 0; i < text.Length; i++)
                Console.Write(" ");
        Console.CursorLeft -= text.Length;
        System.Threading.Thread.Sleep(delay);
    } 
```

**编辑**：稍微重构了代码

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-01-26T12:29:29.283

为此，您必须使用：

控制台清除

这将清除控制台中的所有信息，但允许您模拟闪烁的文本，通过执行以下代码，您可以这样做：（这是在 VB 中，但很容易翻译）

```
Dim Flash As Integer
Flash = 0
While Flash < 100 (Any number can be put here for duration)
Flash = Flash + 1
console.Backgroundcolor = consolecolor.Black
console.clear
system.threading.thread.sleep(25)
console.Backgroundcolor = consolecolor.White
console.clear
system.threading.thread.sleep(25)
End While 
```

例如，这将给出一个闪烁的屏幕，对于闪烁的文本只需调整它：

```
Dim FlashWord As Integer
FlashWord = 0
While FlashWord < 100 (Any number can be put here for duration)
FlashWord = FlashWord + 1
console.Foregroundcolor = consolecolor.Black
console.clear
Console.Writeline("Hello World")
system.threading.thread.sleep(25)
console.Foregroundcolor = consolecolor.White
console.clear
Console.Writeline("Hello World")
system.threading.thread.sleep(25)
End While 
```

这将模拟“闪烁”，唯一的缺点是您会丢失以前的屏幕信息，但仅此而已，而且效果非常好！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T10:16:26.703

```
string txt = "Hello, world!";
while ( doingSomething )
{
  Console.Write(txt);
  System.Threading.Thread.Sleep(20);
  Console.CursorLeft -= txt.Length;
  for ( int i = 0; i < txt.Length; i++ )
    Console.Write(" ");
} 
```

这段代码不会让它闪烁

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T10:18:22.237

没有直接支持，您需要根据计时器用空格（或不同颜色）覆盖文本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-17T19:38:26.510

我改进了 Matthew 的代码，`\r`并使用了一些花哨的用法`String`：

```
static void Main()
{
    string txt = "Hello, world!";
    WriteBlinkingText(txt, 500);
}

private static void WriteBlinkingText(string text, int delay)
{
    bool visible = true;
    while (true)
    {
        Console.Write("\r" + (visible ? text : new String(' ', text.Length)));
        System.Threading.Thread.Sleep(delay);
        visible = !visible;
    }
} 
```

我也认为该`WriteBlinkingText`方法应该是独立的，所以循环在这里，但这只是个人品味的问题我猜:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-03-07T14:58:20.947

```
 private void timer1_Tick(object sender, EventArgs e)//This might work better for you :)
    {
        Random rand = new Random();
        for (int i = 0; i < 255; i++)
        {
            int A = rand.Next(i);
            int R = rand.Next(i);
            int G = rand.Next(i);
            int B = rand.Next(i);
            label2.ForeColor = Color.FromArgb(A, R, G, B);
        }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-11-06T20:48:41.963

* * *

[![在此处输入图像描述](https://i.stack.imgur.com/JollQ.gif)](https://i.stack.imgur.com/JollQ.gif)

为什么不使用退格键并在同一屏幕行上重写文本？

```
string blink = "Password Please!"

while (!System.Console.KeyAvailable)
   {
      Console.Write(blink);
      Thread.Sleep(650);

      for (int j = 1; j <= blink.Length + 2; j++)
          {
             Console.Write("\b"+(char)32+"\b");
             if (j == blink.Length + 2) Thread.Sleep(650);
          }
   } 
```

* * *

# php - PHP中eregi()的好替代品

> ID：737198
> 
> 赞同：12
> 
> 时间：2009-04-10T09:56:55.610
> 
> 标签：php, string

我经常发现自己在做这样的快速检查：

```
if (!eregi('.php', $fileName)) {
    $filename .= '.php';
} 
```

但正如[`eregi()`](http://php.net/eregi)PHP 5.3 中不推荐使用的那样，代码现在会引发错误。

是否有另一个函数的行为方式与 完全相同`eregi()`？我对正则表达式一无所知，也不想学习，所以`preg_match()`etc 对我不起作用。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-10T10:02:27.187

[stristr](http://php.net/stristr)获得与 eregi 完全相同的结果（至少在您不使用正则表达式时）：

```
if (!stristr($fileName, '.php'))
    $filename.='.php'; 
```

您也可以通过这种方式制作“假”eregi：

```
if (!function_exists('eregi')) {
    function eregi($find, $str) {
        return stristr($str, $find);
    }
} 
```

**更新**：请注意，`stristr`它不接受正则表达式`eregi`，对于这种特定情况（检查扩展名），您最好使用 vartec 的解决方案。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-10T10:14:26.147

您当然知道，这并没有达到您期望的效果？在正则表达式 '.' 表示任何字符，因此`eregi('.php',$fileName)`表示带有任何字符后跟“php”的文件名。因此，例如“blabla2PHP.txt”将匹配您的正则表达式。

现在你想要做的是：

```
$file_ext = pathinfo($filename, PATHINFO_EXTENSION);
if(strtolower($file_ext) != 'php') 
   $filename .= '.php'; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-04-16T08:43:16.657

很好的选择`eregi()`是`preg_match()`使用*`i`*修饰符：

```
if (! preg_match('/.php/i',$fileName))
      $filename.='.php'; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-08-13T20:10:14.143

试试这个，自从我最近更新到 PHP 5 以来，我经常使用它。

之前：

```
if(eregi('-', $_GET['id'])
{
   return true;
} 
```

现在我正在使用它 - 它同样有效。

```
if(preg_match('/(.+)-(.+)/', $_GET['id'])) {
{
   return true;
} 
```

只需将您的代码替换为以下代码，您的代码中就不应该有任何差异。如果您想知道为什么 PHP 删除 eregi() 是因为它在大量使用时存在性能问题，所以最好使用 preg_match() ，因为它在搜索方面更具体，因此它具有更好的性能和渲染时间。

让我知道这对你有用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-10T11:11:08.460

如果你选择“假”eregi，你应该在假函数中触发一个通知：trigger_error('Some code still use eregi',E_USER_NOTICE); 通过这种方式，您将轻松捕获忘记的eregi 呼叫并替换它们。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-10T17:17:39.793

也许您应该考虑重构您的代码来执行此操作：

```
if (substr($fileName, -4, 4) !== '.php')
    $fileName .= '.php'; 
```

如该问题的其他答案中所述，`eregi('.php')`将在文件中搜索任何后跟“php”的任何内容（不仅仅是在末尾）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-11T15:48:10.187

我一般 create and endsWith 函数；或其他用于此类内容的简单字符串操作函数。

```
function endsWith($string, $end){
    return substr($string, -strlen($end)) == $end;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-26T23:03:17.340

if (!stristr($fileName, '.php')) $filename.='.php';

moff 的答案是向后的参数。

[http://php.net/manual/en/function.stristr.php](http://php.net/manual/en/function.stristr.php)

# asp.net - 如何使用 LINQ 查询应用全文搜索？

> ID：737199
> 
> 赞同：2
> 
> 时间：2009-04-10T09:57:09.447
> 
> 标签：asp.net, linq

[我想在上一个问题](https://stackoverflow.com/questions/736952/the-best-way-to-build-dynamic-linq-query)中使用全文搜索工具

例如名称可以是 vikas patel。我们将 Name 作为 'pat' 传递，它也应该提供上述记录。

还告诉我有关日期比较的信息，例如在不指定时间的情况下它会给我所有相似的日期记录。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T10:22:01.057

据我所知，LINQ-to-SQL（等）永远不会将查询表达式转换为 FTS。你有两个选择：

```
dataConetxt.ExecuteQuery<YourResultObject>(yourCustomTSQL) 
```

或编写一个 SP 来完成它，并通过 LINQ-to-SQL / Entity Framework / 等调用 SP。我相信 SP 方法是推荐的选项。您*可能*能够在用户定义函数 (UDF) 中访问 FTS - 这将在 LINQ 中提供可组合性，但并非所有提供商都支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-25T15:40:23.460

您可以使用 SQL 中的函数执行此操作，并将其作为方法公开在您的上下文中。

我在我的博客上谈论它

[http://sqlblogcasts.com/blogs/simons/archive/2008/12/18/LINQ-to-SQL---Enabling-Fulltext-searching.aspx](http://sqlblogcasts.com/blogs/simons/archive/2008/12/18/LINQ-to-SQL---Enabling-Fulltext-searching.aspx)

# asp.net-mvc - MVC - 如何从母版页的文件夹中放置随机图像

> ID：737207
> 
> 赞同：2
> 
> 时间：2009-04-10T10:01:30.000
> 
> 标签：asp.net-mvc

我有一个 MVC 应用程序，我希望在母版页的顶部有一系列来自文件夹的随机图像。

为此，我必须编写代码，而不是在哪里编写代码？它必须在一个地方完成。

我可能会在会话开始时设置图像，以便它们被浏览器缓存并提高站点的性能。

马尔科姆

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T17:41:33.573

**缓存是关键**

正如其他人所说，您必须使用缓存，因为您正在对不经常更改的数据执行重复的磁盘 I/O。

我的示例创建并缓存了`List<T>`每个后续请求所需的图像文件路径。 `System.Web.Caching`非常适合这一点，因为您可以`CacheDependency`直接在图像目录上创建对象——如果文件被更改或添加，您的缓存将自动失效。然后在下次请求时重新创建它。

**避免重复`HashSet<T>`**

我敢打赌，您不希望在您的标题中出现两张相同的图片！

随机化使用`Random.Next`不排除以前生成的重复项。我使用 a`HashSet<T>`作为穷人的唯一随机发生器，因为`HashSet<T>`它只允许您添加唯一值。

**该模型**

此操作应该是 MVC 中模型的一部分。您可以将其更改为与您认为合适的其他数据获取类一起使用。

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Web;
using System.Web.Caching;

public class RandomImage
{
    public static string[] GetImages(string folder, int count)
    {
        HttpContext context = HttpContext.Current;
        string virtualFolderPath = string.Format("/content/{0}/", folder);
        string absoluteFolderPath = context.Server.MapPath(virtualFolderPath);

        Cache cache = context.Cache;
        var images = cache[folder + "_images"] as List<string>;

        // cache string array if it does not exist
        if (images == null)
        {
            var di = new DirectoryInfo(absoluteFolderPath);
            images = (from fi in di.GetFiles()
                            where fi.Extension.ToLower() == ".jpg" || fi.Extension.ToLower() == ".gif"
                            select string.Format("{0}{1}", virtualFolderPath, fi.Name))
                            .ToList();

            // create cach dependency on image randomFolderName
            cache.Insert(folder + "_images", images, new CacheDependency(absoluteFolderPath));
        }

        Random random = new Random();
        var imageSet = new HashSet<string>();
        if (count > images.Count())
        {
            throw new ArgumentOutOfRangeException("count");
        }

        while (imageSet.Count() < count)
        {
            //using an hashset will ensure a random set with unique values.
            imageSet.Add(images[random.Next(count)]);
        }

        return imageSet.ToArray();
    }
} 
```

**控制器**

访问控制器中的方法，例如....

```
string[] images = Models.RandomImage.GetImages("myPictures", 4); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T10:06:01.797

编写一个辅助函数，该函数将从应用程序启动时生成的文件名数组中获取随机文件名。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T10:10:27.637

好吧，要获取图像：

```
string[] get_images(string folder) {
     string[] files = Directory.GetFiles(folder, "*.jpg"/* or whatever */);
     List<string> rand = new List<string>();
     Random r = new Random();
     for ( int i = 0; i < numImages; i++ ) {
         rand.Add(Path.GetFileName(files[r.Next(files.Length-1)]));
     }
     return rand.ToArray();
} 
```

然后在母版页中：

```
<% PrintImages(); %> 
```

PrintImages() 在哪里：

```
string[] img = get_images(Server.MapPath("~/Content/RandomImages"));
foreach (string i in img) { Response.Write("<img src=\"/Content/RandomImages/"+i+"\" />"); } 
```

这是一个粗略的解决方案，缓存会很好 - 这真的会破坏磁盘。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T10:31:28.867

在我做任何更复杂的事情之前，我想确保每次简单地读取目录并生成文件名是一个真正的瓶颈。它当然效率较低，但代码可以说更简单。如果它不是瓶颈，那么负责呈现视图的控制器操作就是代码的正确位置。请注意，如果您希望图像每次都更改，则需要关闭操作的输出缓存（如果还没有）。

如果事实证明读取文件名和构建链接确实是一个瓶颈——它可能比读取实际文件花费的时间少得多——并且目录中的文件可以在应用程序运行时更改，然后构建一个集合并将它们存储在登录会话中是一种合理的处理方式。需要注意的是，如果应用程序还负责上传图像（以便它知道它们何时更改），您可能能够在应用程序启动时加载它们并将它们保存在由应用程序更新的全局实例中作为图像上传（或删除）。

一旦你有了你的图像集合（通过每次读取，从会话或全局实例中读取），使用随机数生成器来选择你想要显示的图像或你想要使用类似的东西旋转的集合jQuery Cycle 插件，将它（它们）传递给视图并让它呈现图像标签。

# javascript - jQuery 淡化所有其他图像

> ID：737216
> 
> 赞同：5
> 
> 时间：2009-04-10T10:08:00.047
> 
> 标签：javascript, jquery, css-selectors

我用jQuery制作了这段代码来淡化图像（**但不是**将鼠标移到上面的那个）并且**所有图像**同时淡化！

```
$(".playThumb").fadeTo("normal", 1);

$(".playThumb").hover(function() {
    $(".playThumb").each(function() {
        if ( $(this) != $(this) ) {
            $(this).fadeTo("fast", 0.3);
        }
    });
}, function() {
    $(".playThumb").each(function() {
            $(this).fadeTo("fast", 1);
    });
});

<a href="#"><img src="001.jpg" class="playThumb" />
<a href="#"><img src="002.jpg" class="playThumb" />
<a href="#"><img src="003.jpg" class="playThumb" />
<a href="#"><img src="004.jpg" class="playThumb" /> 
```

如果有人可以帮助我淡化**除我将鼠标指向的图像之外的**所有其他图像吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-10T10:13:09.830

您可以使用[`not`](http://docs.jquery.com/Traversing/not)过滤掉悬停的元素：

```
$(".playThumb").fadeTo("normal", 1);

$(".playThumb").hover(function() {
    $(".playThumb").not(this).fadeTo("fast", 0.3);
}, function() {
    $(".playThumb").not(this).fadeTo("fast", 1);
}); 
```

# c# - 如何调整颜色的亮度？

> ID：737217
> 
> 赞同：28
> 
> 时间：2009-04-10T10:08:29.747
> 
> 标签：c#, gdi+

我想使现有颜色变暗以用于渐变画笔。有人可以告诉我该怎么做吗？

C#、.net 2.0、GDI+

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-10T10:15:01.933

作为一种简单的方法，您可以只考虑 RGB 值：

```
 Color c1 = Color.Red;
    Color c2 = Color.FromArgb(c1.A,
        (int)(c1.R * 0.8), (int)(c1.G * 0.8), (int)(c1.B * 0.8)); 
```

（这应该使它变暗；或者，例如，* 1.25 使其变亮）

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-22T16:40:28.720

您也可以尝试使用

```
ControlPaint.Light(baseColor, percOfLightLight) 
```

[ControlPaint.Light](http://msdn.microsoft.com/en-us/library/3wz9t9fy(VS.80).aspx)

或者

```
ControlPaint.Dark(baseColor, percOfDarkDark) 
```

[ControlPaint.Dark](http://msdn.microsoft.com/en-us/library/h3fxkc2x.aspx)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-10T10:09:47.250

从 RGB 转换为 HSV（或 HSL），然后向下调整 V（或 L），然后再转换回来。

虽然`System.Drawing.Color`提供了获取色调 (H)、饱和度 (S) 和亮度的方法，但它并没有提供太多其他转换的方式，值得注意的是从 HSV（或 HSV 值）创建新实例，但转换非常简单实施。维基百科文章提供了不错的融合，从这里开始：“ [HSL 和 HSV](http://en.wikipedia.org/wiki/HSL_and_HSV) ”。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-10T10:15:06.813

以下是 Richard 提到的转换的一些 C# 代码：

[C# 中的 RGB 到 HSL / HSL 到 RGB](http://geekymonkey.com/Programming/CSharp/RGB2HSL_HSL2RGB.htm)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-09-14T09:01:17.773

虽然上述方法确实会使颜色变暗，但它们会调整色调方式，因此结果看起来不太好。最好的答案是使用[Rich Newman 的 HSLColor](https://stackoverflow.com/a/4087601/550073)类并调整亮度。

```
public Color Darken(Color color, double darkenAmount) {
    HSLColor hslColor = new HSLColor(color);
    hslColor.Luminosity *= darkenAmount; // 0 to 1
    return hslColor;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-04-14T15:33:07.477

您必须跟踪该值不低于 0 或高于 255

最好的方法是使用 Math.Max/Math.MIN

```
dim newValue as integer = ...
'correct value if it is below 0 or above 255
newValue = Math.Max(Math.Min(newValue,255),0) 
```

# visual-studio - 在 Visual Studio 中关闭自动格式化

> ID：737222
> 
> 赞同：165
> 
> 时间：2009-04-10T10:14:18.220
> 
> 标签：visual-studio, visual-studio-2008, formatting, code-formatting

与 Visual Studio 的默认设置相比，我更喜欢我自己的代码格式样式。我在工具→选项中关闭了自动格式化选项。在大多数情况下，它有效。

但是，在使用任何内置重构之后，Visual Studio 会使用其默认设置破坏我的设置。我如何阻止 VS 这样做？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2011-03-30T22:03:41.913

我在页面中编写VB时遇到了这个问题`aspx`。

解决方案是转到“工具 > 选项 > 文本编辑器 > 基本 > VB 特定”并关闭“漂亮列表”。

* * *

注意 - 在 Visual Studio 2015 中，可以在以下位置找到：

工具 > 选项 > 文本编辑器 > 基本 > 高级

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2016-07-18T21:16:40.690

禁用漂亮的列表。这是重新格式化您正在做的事情的选项。我对它有同样的不适，并且在这样做之后，我的代码保持我想要的方式并且它不会回到以前的设置。

[![在此处输入图像描述](https://i.stack.imgur.com/nsY2u.png)](https://i.stack.imgur.com/nsY2u.png)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2018-07-05T08:28:50.413

正如@TheMatrixRecoder 所建议的那样，我为我找到了一些东西，所以也许这会对其他人有所帮助。 [![VS 2017 选项可以在这里找到](https://i.stack.imgur.com/Qxbpj.png)](https://i.stack.imgur.com/Qxbpj.png)

当您在行尾放置分号或按回车时，Unitick 这些选项可防止烦人的自动格式化。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-02-07T11:40:09.730

就我而言，它是 ReSharper。

## 测试是否 ReSharper

StackOverflow：[如何在 Visual Studio 中禁用 ReSharper 并再次启用它？](https://stackoverflow.com/questions/2189792/how-can-i-disable-resharper-in-visual-studio-and-enable-it-again)

## 防止 ReSharper 重新格式化代码

StackOverflow：[有没有办法标记代码告诉 ReSharper 不要格式化它？](https://stackoverflow.com/questions/2176429/is-there-a-way-to-mark-up-code-to-tell-resharper-not-to-format-it)

### 2017-03-01 更新

最后是 ReSharper：

[![在此处输入图像描述](https://i.stack.imgur.com/o0rpT.png)](https://i.stack.imgur.com/o0rpT.png)

## 2020-12-18 更新

在最新版本的 ReSharper 上，有更多选项：取消勾选此页面上的所有内容，并确保所有下拉菜单都设置为`None`.

ReSharper“打字辅助”就像一个3岁的孩子试图“帮助”建造一座卡片城堡。一个简单的退格键或回车键将（较差地）重新格式化整个代码块，要求将其撤消或痛苦地格式化回原始代码。

如果这还不够，这会增加打字时的延迟，所以有时感觉就像在滑雪板上跑步。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-03-15T17:39:50.873

您可能已经安装了[Power Tool](https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerPack2017)。

在这种情况下，您可以从“工具 > 选项 > 生产力工具 > PowerCommands > 常规”中将其关闭

[![在此处输入图像描述](https://i.stack.imgur.com/Ow8wu.png)](https://i.stack.imgur.com/Ow8wu.png)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-01-16T07:40:09.817

帮助我防止自动格式化的 VS2015 设置：

（和工具>选项>文本编辑器>基本>高级，就像[Tango91](https://stackoverflow.com/questions/737222/turn-off-auto-formatting-in-visual-studio/5493003#5493003)建议的那样）

[![在此处输入图像描述](https://i.stack.imgur.com/N6rAT.png)](https://i.stack.imgur.com/N6rAT.png)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-08-09T12:48:09.550

在 VS2017 中，您可以在设置菜单中选择编码语言后更改它。在“格式化”子菜单中有一个名为“新行”的选项。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-11-16T17:17:19.020

我看到这里有很多答案可以解决特定情况的问题。

对于我的情况，我不断发现 IDE 会自动格式化 ASP 页面中的 JavaScript 代码。

要禁用，我取消选中此框： [![在此处输入图像描述](https://i.stack.imgur.com/yBDWi.png)](https://i.stack.imgur.com/yBDWi.png)

此外，我发现使用工具栏中的搜索查询 ( `CTRL+Q`) 并仅搜索文本非常有帮助`format on paste`。正如您在滚动条中看到的那样，有很多选项需要检查！

[![在此处输入图像描述](https://i.stack.imgur.com/fZ6NB.png)](https://i.stack.imgur.com/fZ6NB.png)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-08-08T05:51:10.260

不能关闭分号或右大括号的重新格式化。我觉得微软会冒昧地告诉任何人如何格式化代码，这让我很生气。我见过的最难以辨认的代码是在那里工作的时候。

我希望相邻的作业垂直对齐；VS 将它们重新格式化为等号两侧的一个空格，而不管左侧变量的长度如何。这是不能容忍的。并且在编辑器选项上关闭它会被忽略；鉴于上述开场白之类的评论，我确信这是故意的。

一致性只有在导致理想结果时才是一种美德。这不是一个。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-10T10:19:10.657

我怀疑您是否可以在重构后禁用重新格式化。重构会更改代码，因为它只是文本，我怀疑您想要的是它只是将未格式化的文本转储到您的源代码中。将 VS 遵循的代码样式设置为您喜欢并遵循的样式会不会更容易一些？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-01-20T10:04:22.107

按照 TOOLS->OPTIONS->Text Editor->CSS->Formatting 选择“Compact Rules”并取消选中“Hearerchical indentation”

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-08-04T13:04:15.020

每次在 Visual Studio 2015、2017 中的 cshtml 文件中粘贴任何内容时，我都会很生气。我尝试了不同的设置，最终找到了正确的设置：选项 => 文本编辑器 => HTML => 高级 => 粘贴（粘贴时格式化）= > 错误的 [![在此处输入图像描述](https://i.stack.imgur.com/KKPXW.jpg)](https://i.stack.imgur.com/KKPXW.jpg)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-07-09T07:11:52.973

它可以是 Clang 格式的情况。以前，整个文件在文件保存时会自动格式化，这让我抓狂（对于未启用 Clang 格式的存储库）。

将“工具 -> 选项 -> LLVM/Clang -> ClangFormat -> 保存时格式化 -> 启用”设置为 False 后，这种行为就消失了。

[![保存时的 ClangFormat 格式](https://i.stack.imgur.com/4Wxwm.png)](https://i.stack.imgur.com/4Wxwm.png)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-10T10:22:03.380

您可以调整代码格式的设置。我总是关闭所有额外的换行符，然后它就可以很好地格式化代码。

如果您尽可能地根据自己的喜好调整设置，那么无论何时使用重构都应该让您的工作量最少。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-03-15T16:51:34.800

您可能需要检查 Tools-> Options-> Xaml Styler -> Format xaml on save

[![在此处输入图像描述](https://i.stack.imgur.com/qDZv7.png)](https://i.stack.imgur.com/qDZv7.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-04-19T18:24:29.587

除了 Tango 对实际解决方案的回答之外，可能还有一些人实际上想要与自动格式保持同步，但又不想让它搞砸您的相关更改。我建议您修改文件以激活自动格式化，签入这些更改，然后继续进行您希望进行的实际更改。

这样您的代码可以保持最新，但您的签入将是相关的。

# asp.net - 在页面身份验证方面需要帮助

> ID：737237
> 
> 赞同：0
> 
> 时间：2009-04-10T10:19:55.023
> 
> 标签：asp.net

我已经将我的登录页面设置为三个角色，管理员，员工，用户。当我以管理员身份登录时，它重定向到 Admin/Default.aspx，当我以员工身份登录时，它重定向到 Employee/Default.aspx，当我以用户身份登录时，它的重定向到 User/Default.aspx，我的意思是这 3 个角色的所有功能都可以正常工作。假设我创建了新用户说 Sumit 为他我没有赋予任何角色，在这种情况下，它应该被重定向到 Default.aspx 页面，而不是重定向到 User/Default.aspx 页面。有人可以帮我看看是什么原因？？？这是我的整个代码：

登录.aspx.cs：

```
 protected void Login1_LoggedIn(object sender, EventArgs e)
    {
        Session["UserName"] = Login1.UserName;
        Session["Password"] = Login1.Password;
        string username = Login1.UserName.Trim();
        string password = Login1.Password.Trim();
        LoginBusinessLayer LB = new LoginBusinessLayer();      
        try
        {          
            if (LB.GetLogin(username,password) == true)
            {
                 if (Session["RoleName"].Equals("admin"))
                 {
                     FormsAuthentication.RedirectFromLoginPage(Login1.UserName, false);
                     Response.Redirect("Admin/Default.aspx");
                 }
                 else if (Session["RoleName"].Equals("employee"))
                 {
                     FormsAuthentication.RedirectFromLoginPage(Login1.UserName, false);
                     Response.Redirect("Employee/Default.aspx");
                 }
                 else if (Session["RoleName"].Equals("user"))
                 {
                     FormsAuthentication.RedirectFromLoginPage(Login1.UserName, false);
                     Response.Redirect("User/Default.aspx");
                 }
                 else
                 {
                     Response.Redirect("Default.aspx");//Control is not coming in this else part
                 }
            }
        }
        catch(SqlException ex)
        {
            Response.Write(ex.Message);
        }
        finally
        {
            LB = null;
        }
    } 
```

业务层.cs：

```
public class LoginBusinessLayer
{
        public bool GetLogin(string userid, string userrole)
        {
            LoginDataLayer LD = new LoginDataLayer();
            LD.GetUser(userid,userrole);
            return true;
        }
} 
```

数据层.cs：

```
public class LoginDataLayer
{
        SqlConnection con;
        SqlCommand com;
        SqlDataReader dr;
        string check;    
        public bool GetUser(string userid, string rolename)
        {
            if (HttpContext.Current.Session["UserName"] != null)
            {
                con = new SqlConnection(ConfigurationManager.ConnectionStrings["ConnectionString"].ConnectionString);
                con.Open();
                check = "Select ur.UserId,ur.UserName,rl.RoleName from aspnet_Users as ur,aspnet_Roles rl,aspnet_UsersInRoles as ir where ur.UserName = '"+HttpContext.Current.Session["UserName"] + "' and ur.UserId=ir.UserId and ir.RoleId=rl.RoleId";
                com = new SqlCommand(check, con);
                dr = com.ExecuteReader(CommandBehavior.CloseConnection);
                while (dr.Read())
                {
                    if (dr.HasRows)
                    {
                        HttpContext.Current.Session["UserId"] = dr["UserId"].ToString();
                        HttpContext.Current.Session["RoleName"] = dr["RoleName"].ToString();
                        return true;
                    }
                }
                con.Close();          
            }
            return false;
          }
} 
```

以上红色高亮代码不起作用。非常感谢您的回复。谢谢， 苏米特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T10:29:08.233

哦，废话！你的数据层怎么知道`HttpContext`& 的东西？为什么要保留用户信息`Session`？你不知道'IPrincipal.IsInRole()`吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T11:57:08.787

在其他部分尝试这个...（“~/Default.aspx”）

别的

{

Response.Redirect("~/Default.aspx");//控制不在这个else部分

}

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T14:33:06.680

这段代码有很多问题，没有一个能告诉我为什么没有设置你的角色名称。session["RoleName"] 中有什么值？我的猜测是用户。:)

现在来看一些代码。您不应该使用 Session 将信息传递给您的业务层。你有方法参数，所以使用它们。目前你只是忽略它们。

你有一个很好的小 SQL 注入可能性。您正在获取不受信任的用户数据 (Login1.Text) 并将其直接放入您的 SQL 命令中。这很糟糕，很糟糕，很糟糕。使用 SQLParameters 重写它。

如果您找到该用户，则不会关闭您的 SQL 连接。你刚回来。使用 using 语句来包装您的连接对象，以便正确关闭连接。

尽管方法参数是用户名和角色名，但您使用用户名和密码调用 GetLogin。但没关系，因为无论如何你都会忽略它们。:) 您应该使用用户名和密码来查找角色名。您应该对密码进行哈希处理并与存储的哈希密码进行比较。您的 GetLogin 应该返回一些用户类或至少是角色名称。

您忽略了 GetUser 的返回值，因此即使您没有找到您所说的用户。

所以要回答你的问题，我不知道为什么你的角色名称设置为用户，很可能是存储在数据库中的内容。但是，您确实需要解决这些其他问题。

# c++ - 允许在没有动态分配的情况下运行时的数组大小？

> ID：737240
> 
> 赞同：77
> 
> 时间：2009-04-10T10:21:05.957
> 
> 标签：c++, c, array-initialization

我已经使用 C++ 几年了，今天我看到了一些代码，但这怎么可能是完全合法的呢？

```
int main(int argc, char **argv)
{
    size_t size;
    cin >> size;
    int array[size];
    for(size_t i = 0; i < size; i++)
    {
        array[i] = i;
        cout << i << endl;
    }

    return 0;
} 
```

^(在 GCC 下编译。)

`new`如果没有or ，如何在运行时确定大小`malloc`？

只是为了仔细检查，我已经用谷歌搜索了一些和我的所有类似代码都声称会给出存储大小错误。

甚至 Deitel 的 C++ 如何编程 p。常见编程错误 4.5 下的 261 个状态：

> 只有常量可以用来声明自动和静态数组的大小。

照亮我。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-04-10T10:22:48.543

这在 C99 中有效。

C99 标准支持堆栈上的可变大小数组。可能您的编译器也选择支持此构造。

请注意，这与`malloc`和不同`new`。`gcc`在堆栈上分配数组，`int array[100]`就像调整堆栈指针一样。没有进行堆分配。这很像[`_alloca`](https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/alloca?view=vs-2019)。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-10T11:00:25.473

这称为 VLA（可变长度数组）。它在 c99 中是标准的，但 gcc 允许它在 c++ 代码中作为扩展。如果您希望它拒绝代码，请尝试使用`-std=standard`和选项。`-ansi``-pedantic`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-10T10:29:50.850

它仅在 C99中[有效。](http://www.informit.com/guides/content.aspx?g=cplusplus&seqNum=215)下次您可以尝试在[可靠的编译器](http://www.comeaucomputing.com/tryitout/)中检查您的代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-10T10:33:33.197

它是有效的 C99，它不是有效的 C++。这是两种语言之间的不少差异之一。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-03T19:37:14.347

此代码在 GNU GCC 编译器中运行。

```
#include<bits/stdc++.h>

int main(int argc, char **argv)

{
    size_t size;

   std:: cin >> size;

    int array[size];

    for(size_t i = 0; i < size; i++)

{

array[i] = i;

        std:: cout << i;

 }

    return 0;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-05T07:05:07.170

如果您使用的是 Dev-Cpp 编译器，您可以动态地为数组指定大小我已经尝试过并且没有错误，但是在 Visual c++ 和 Visual Studio 编译器上这是不可能的。我认为原因是 dev-c++ 为未初始化的 int 分配了一个正数，当我们给它一个数字时，它被给定的数字替换。但也许其他编译器将 null 赋予未初始化的变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-10-21T08:27:26.850

我最近遇到了一个需要堆栈分配数组的场景。（它是 v8 的包装器，每个方法调用都需要一个 args 数组）。

std::vector 会进行堆内存分配，其性能是不可接受的。

这是我的解决方案，使用模板分配案例数组：

```
template<size_t Argc>
static void call(...) {
    v8::Local<v8::Value> v8Args[Argc];

    // use v8Args
    ...
}

template<typename It>
static void callV8Function(size_t argc, It argvBegin, It argvEnd,) {
    // C++ don't have dynamic stack allocation (like C99 does)
    // try to avoid heap-allocation...
    if (argc <= 4) {
        return callV8FunctionOnStack<4>(...);
    } else if (argc <= 8) {
        return callV8FunctionOnStack<8>(...);
    } else if (argc <= 16) {
        return callV8FunctionOnStack<16>(...);
    } else if (argc <= 32) {
        return callV8FunctionOnStack< 32>(...);
    } else {
        std::vector<v8::Local<v8::Value>> v8Args(argc);
        // fallback to vector
   }
} 
```

（当然，我可以只使用 32 大小的数组，但这并不那么优雅。）

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-10-13T14:38:02.990

C++14 标准支持可变长度数组 (VLA)，该标准最近已被接受，正在等待发布。

# java - Java - 将对象列表映射到具有其属性属性值的列表

> ID：737244
> 
> 赞同：45
> 
> 时间：2009-04-10T10:22:39.417
> 
> 标签：java, list, properties

我的 ViewValue 类定义如下：

```
class ViewValue {

private Long id;
private Integer value;
private String description;
private View view;
private Double defaultFeeRate;

// getters and setters for all properties
} 
```

在我的代码中的某处，我需要将 ViewValue 实例列表转换为包含来自相应 ViewValue 的 id 字段值的列表。

我使用 foreach 循环来做到这一点：

```
List<Long> toIdsList(List<ViewValue> viewValues) {

   List<Long> ids = new ArrayList<Long>();

   for (ViewValue viewValue : viewValues) {
      ids.add(viewValue.getId());
   }

   return ids; 
```

}

有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2016-06-10T09:18:20.813

我们可以使用 java 8 在一行代码中完成

```
List<Long> ids = viewValues.stream().map(ViewValue::getId).collect(Collectors.toList()); 
```

欲了解更多信息：**[Java 8 - 流](https://www.tutorialspoint.com/java8/java8_streams.htm)**

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-10-30T08:52:55.303

您可以使用 Commons BeanUtils 和 Collections 在单行中
*完成：（当其他人为您完成代码时，为什么还要编写自己的代码？）*

```
import org.apache.commons.beanutils.BeanToPropertyValueTransformer;
import org.apache.commons.collections.CollectionUtils;

...

List<Long> ids = (List<Long>) CollectionUtils.collect(viewValues, 
                                       new BeanToPropertyValueTransformer("id")); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-02-16T08:36:06.123

使用谷歌收藏。例子：

```
 Function<ViewValue, Long> transform = new Function<ViewValue, Long>() {
        @Override
        public Long apply(ViewValue from) {
            return from.getId();
        }
    };
    List<ViewValue> list = Lists.newArrayList();
    List<Long> idsList = Lists.transform(list, transform); 
```

**更新：**

在 Java 8 上，您不需要 Guava。你可以：

```
import com.example.ViewValue;
import java.util.ArrayList;
import java.util.List;
import java.util.function.Function;
import java.util.stream.Collectors;

Function<ViewValue, Long> transform = ViewValue::getId;
List<ViewValue> source = new ArrayList<>();
List<Long> result = source.stream().map(transform).collect(Collectors.toList()); 
```

要不就：

```
List<ViewValue> source= new ArrayList<>();
List<Long> result = source.stream().map(ViewValue::getId).collect(Collectors.toList()); 
```

**下一个更新（Javaslang 到 Vavr 名称更改后的最后一个）：**

目前值得一提的是使用~~Javaslang 库 ( [http://www.javaslang.io/](http://www.javaslang.io/) )~~ Vavr 库 ( [http://www.vavr.io/](http://www.vavr.io/) ) 的解决方案。假设我们的列表包含真实对象：

```
List<ViewValue> source = newArrayList(new ViewValue(1), new ViewValue(2), new ViewValue(2)); 
```

我们可以使用 Javaslang 库中的 List 类进行转换（从长远来看，收集并不方便）：

```
List<Long> result = io.vavr.collection.List.ofAll(source).map(ViewValue::getId).toJavaList(); 
```

但是您会看到只有 Javaslang 列表的强大功能：

```
io.vavr.collection.List<ViewValue> source = javaslang.collection.List.of(new ViewValue(1), new ViewValue(2), new ViewValue(3));
io.vavr.collection.List<Long> res = source.map(ViewValue::getId); 
```

我鼓励查看该库中可用的集合和新类型（我特别喜欢 Try 类型）。您将在以下地址找到文档：~~[http](http://www.javaslang.io/javaslang-docs/)~~ [://www.javaslang.io/javaslang-docs/ http://www.vavr.io/vavr-docs/](http://www.vavr.io/vavr-docs/)。

PS。由于 Oracle 和名称中的“Java”字样，他们不得不将库名称从 javaslang 更改为其他名称。他们决定Vavr。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-04-10T10:30:09.743

编辑：此答案基于您需要为代码中其他地方的不同实体和不同属性做类似事情的想法。如果您*只需*要按 ID 将 ViewValues 列表转换为 Longs 列表，请坚持使用您的原始代码。但是，如果您想要一个更可重用的解决方案，请继续阅读......

我会为投影声明一个接口，例如

```
public interface Function<Arg,Result>
{
    public Result apply(Arg arg);
} 
```

然后你可以编写一个通用的转换方法：

```
public <Source, Result> List<Result> convertAll(List<Source> source,
    Function<Source, Result> projection)
{
    ArrayList<Result> results = new ArrayList<Result>();
    for (Source element : source)
    {
         results.add(projection.apply(element));
    }
    return results;
} 
```

然后你可以像这样定义简单的投影：

```
private static final Function<ViewValue, Long> ID_PROJECTION =
    new Function<ViewValue, Long>()
    {
        public Long apply(ViewValue x)
        {
            return x.getId();
        }
    }; 
```

并像这样应用它：

```
List<Long> ids = convertAll(values, ID_PROJECTION); 
```

（显然使用 K&R 支撑和更长的行使投影声明更短：）

坦率地说，使用 lambda 表达式所有这些都会好很多，但没关系......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-11T15:09:24.947

我已经为这个用例实现了一个小型函数库。其中一种方法具有以下签名：

```
<T> List<T> mapToProperty(List<?> objectList, String property, Class<T> returnType) 
```

它接受字符串并使用反射来创建对属性的调用，然后它返回一个由 objectList 支持的 List，其中 get 和 iterator 使用此属性调用实现。

mapToProperty 函数是根据通用映射函数实现的，该函数将函数作为映射器，正如另一篇文章所述。非常有用。

我建议你阅读基本的函数式编程，特别是看看 Functors（实现映射函数的对象）

编辑：反射真的不必很昂贵。JVM 在这方面改进了很多。只需确保编译一次调用并重用它。

编辑2：示例代码

```
public class MapExample {
    public static interface Function<A,R>
    {
        public R apply(A b);
    }

    public static <A,R> Function<A,R> compilePropertyMapper(Class<A> objectType, String property, Class<R> propertyType)
    {
        try {
            final Method m = objectType.getMethod("get" + property.substring(0,1).toUpperCase() + property.substring(1));

            if(!propertyType.isAssignableFrom(m.getReturnType()))
                throw new IllegalArgumentException(
                    "Property "+property+" on class "+objectType.getSimpleName()+" is not a "+propertyType.getSimpleName()
                );

            return new Function<A,R>() 
            {
                @SuppressWarnings("unchecked")
                public R apply(A b)
                {
                    try {
                        return (R)m.invoke(b);
                    } catch (Exception e) {
                        throw new RuntimeException(e);
                    }
                };
            };

        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public static <T1,T2> List<T2> map(final List<T1> list, final Function<T1,T2> mapper)
    {
        return new AbstractList<T2>()
        {
            @Override
            public T2 get(int index) {
                return mapper.apply(list.get(index));
            }

            @Override
            public int size() {
                return list.size();
            }
        };
    }

    @SuppressWarnings("unchecked")
    public static <T1,T2> List<T2> mapToProperty(List<T1> list, String property, Class<T2> propertyType)
    {
        if(list == null)
            return null;
        else if(list.isEmpty())
            return Collections.emptyList();

        return map(list,compilePropertyMapper((Class<T1>)list.get(0).getClass(), property, propertyType));
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-10T10:33:17.270

您可以使用包装器：

```
public class IdList impements List<Long>
{
    private List<ViewValue> underlying;

    pubic IdList(List<ViewValue> underying)
    {
        this.underlying = underying;
    }

    public Long get(int index)
    {
        return underlying.get(index).getId()
    }

    // other List methods
} 
```

尽管这是更乏味的工作，但它可以提高性能。

您也可以使用反射来实现您和我的解决方案，但这对性能非常不利。

恐怕在 Java 中没有简单的通用解决方案。在 Groovy 中，您只需使用 collect()，但我相信这也涉及反射。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-10T10:31:07.040

这取决于你对`List<Long>`, 和`List<ViewValue>`

例如，您可以通过创建自己的包装 a 的 List 实现获得足够的功能`List<ViewValue>`，`iterator()`使用迭代 ViewValues 的迭代器实现实现，返回 id。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-07-17T22:47:16.440

您可以从对象列表的属性（例如 id 作为键和某些属性作为值）填充映射，如下所示

```
Map<String, Integer> mapCount = list.stream().collect(Collectors.toMap(Object::get_id, Object::proprty)); 
```

# c# - 寻找集体智慧 .Net / C# 资源

> ID：737247
> 
> 赞同：8
> 
> 时间：2009-04-10T10:23:45.000
> 
> 标签：c#, .net, algorithm, cluster-analysis, collective-intelligence

首先，我意识到这是一个与这个问题非常相似的问题：[哪些是 .net/java 中集体智能的优秀开源库？](https://stackoverflow.com/questions/345982/which-are-the-good-open-source-libraries-for-collective-intelligence-in-net-java)

...但是那个问题的所有答案都是以 Java 为中心的，所以我再次询问，这次更多的是寻找 .Net（理想的 C#）想法。

一点背景；我最近阅读了[Toby Segran 的关于 CI 的优秀书籍](https://rads.stackoverflow.com/amzn/click/com/0596529325)，我刚刚拿到了[Satnam Alag 的书](https://rads.stackoverflow.com/amzn/click/com/1933988312)（我相信它也很优秀，但我才刚刚打开它）。这些都是以 Python 和 Java 为中心的，我在阅读代码示例时没有任何问题，但由于我是一名 C# 开发人员，因此在我的母语中使用其中的一些想法会很有趣。我已经搜索了网络和 SO，但没有想出太多。在某种程度上，这是个好消息，也许我可以将一些东西移植到 .Net（欢迎提出建议），但在我这样做之前，我也真的很想看看任何现有的项目。

那么，有没有在 .Net 中从事 OS 项目的 CI 粉丝，我是否错过了一些显而易见且有趣的书籍/网站/博客？

我意识到 CI 是一个相当广泛的领域，所以为了缩小范围，我主要对集群/预测/推荐领域感兴趣，但对其他想法持开放态度。

**编辑**：刚刚发现这本书即将由 Manning 出版，这可能会让 CI 粉丝感兴趣：[智能网络算法](http://www.manning.com/marmanis/)。

**编辑**澄清以回应 Moose 的评论；我真正在寻找的是使用 CI 技术和 .Net 的库、框架或大型项目（理想的操作系统）。代码示例很棒，但正如 Moose 在他的评论中所说，获取 Java 示例并移植它们很容易。例如，有一个用 Java 编写的名为[WEKA](http://en.wikipedia.org/wiki/Weka_%28machine_learning%29)的有趣项目，我没有理由不能使用它并进行试验，我只是想知道 .Net 中是否发生了类似的事情。我刚刚浏览了有关[Lucene](http://en.wikipedia.org/wiki/Lucene)的信息，我看到有一个 C# 端口，所以这是一个开始……还有更多吗？

**编辑**这不是 C#，而是 .Net；[Robert Pickering 已开始在此处](http://github.com/robertpi/fscollintelli/tree/master)收集 F# CI 资源。看起来很有趣，但我仍在寻找 C# 信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T03:06:34.887

这是基于评级的协同过滤的斜率预测器的链接：

[斜坡一的 C# 实现](http://www.cnblogs.com/kuber/articles/SlopeOne_CSharp.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-09T07:03:28.393

微软研究院（完全披露：我在微软工作，虽然不在发布此工具的小组中）刚刚发布了一个名为 Infer.NET 的 .NET 机器学习库。

[链接文本](http://research.microsoft.com/en-us/um/cambridge/projects/infernet/default.aspx) 您可能想检查一下。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-07-06T19:15:39.577

这个图书馆有：

**监督**

*   感知器
*   内核感知器
*   神经网络
*   决策树

**无监督**

*   层次聚类
*   均值

它被称为[.NET 的机器学习](http://machine.codeplex.com)。

# linq - LINQ：如何执行更新，如 UPDATE 设置更新（ , ) LINQ 中的 SELECT FROM 子句？

> ID：737250
> 
> 赞同：1
> 
> 时间：2009-04-10T10:27:03.620
> 
> 标签：linq

我想根据我阅读的 csv 更新和插入一些记录。插入不是问题，但是如何在一条语句中更新一堆数据呢？我还不清楚如何加入他们。

```
Update Item
Set
  Name = t.Name
From
  Item i, TextFile t
Where
  i.ItemNo = t.ItemNo 
```

对于 Name = t.Name，我创建了一个私有项目`UpdateItem(Item originalItem, Item newItem)`，其中存在更新逻辑。

我想知道调用此函数并使用更改的记录执行 db.SubmitChanges()。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T10:50:22.423

我假设 TextFile 是您从 CSV 文件中读取的对象的内存集合，而 Items 是数据库数据上下文中的表。在这种情况下，如果不先将数据库中的所有项目也提取到内存集合中，我认为您将无法进行实际连接——这可能是一项昂贵的操作。下面的示例仅从文本文件中选择这些项目及其匹配的新名称到一个新集合中，然后遍历该集合并在项目上设置名称。它不会使用您的 UpdateItem 方法。

```
var textFile = ...collection of objects from CSV...

var textIDs = textFile.Select( t => t.ItemNo );

using (var db = new DataContext())
{
  var toUpdate = db.Items
                   .Where( i => textIDs.Contains( i.ItemNo ) )
                   .ToList()  // <--- this will force the query
                   .Select( i => new
                    {
                        Item = i,
                        NewName = textFile.Where( t => t.ItemNo == i.ItemNo )
                                          .Single()
                                          .Name
                    });

  foreach (var item in toUpdate)
  {
      item.Item.Name = item.NewName;
  }

  db.SubmitChanges();
} 
```

# latex - 更改 Latex 部分编号表示

> ID：737255
> 
> 赞同：2
> 
> 时间：2009-04-10T10:30:03.767
> 
> 标签：latex, formatting, document, roman-numerals

我正在尝试更改部分编号在我正在处理的 Latex 文档中的显示方式。我想做的是：

**小节标题**
    (i) 正常重量的小节标题
        (a) Lorem ipsum（未使用小节标题）...

我想出了以下内容，但在缩进等方面是不正确的。

`\renewcommand{\thesubsection}{(\textnormal{\roman{subsection}})} \renewcommand{\thesubsubsection}{\indent(\textnormal{\alph{subsubsection}})}`

谁能指出我正确的方向？谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T10:38:58.957

使用`titlesec`包。[手册在`titlesec`这里](http://mirror.ctan.org/macros/latex/contrib/titlesec/titlesec.pdf)，还有很多其他资源可以在其他地方获得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T10:40:14.540

我没有直接的答案，但[memoir 包](http://www.ctan.org/tex-archive/macros/latex/contrib/memoir/)提供了一些定制帮助，并且有很好的文档记录。

# c++ - 如何将 C++ 代码转换为 C

> ID：737257
> 
> 赞同：51
> 
> 时间：2009-04-10T10:30:24.907
> 
> 标签：c++, c, code-translation

我有一些 C++ 代码。在代码中定义了许多类，它们的成员函数、构造函数、这些类的析构函数、少量模板类和大量 C++ 内容。现在我需要将源代码转换为纯 C 代码。

我有以下问题：

1.  是否有任何工具可以将 C++ 代码和头文件转换为 C 代码？

2.  我是否必须完全重写代码（我将不得不删除构造函数、析构函数并将该代码移动到一些函数`init()`中`deinit()`；将类更改为结构，使现有的成员函数作为那些新定义的结构中的函数指针，然后调用那些使用函数指针等的函数）？

3.  如果我必须自己手动转换，在从 C++ 到 C 的转换时，我需要注意哪些 C++ 特定的代码数据结构/语义？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-10T10:37:45.263

确实有这么一个工具，Comeau 的 C++ 编译器。. 它将生成您无法手动维护的 C 代码，但这没问题。您将维护 C++ 代码，并即时转换为 C。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-10T10:48:32.727

[http://llvm.org/docs/FAQ.html#translatecxx](http://llvm.org/docs/FAQ.html#translatecxx)

它处理一些代码，但对于更复杂的实现会失败，因为它还没有完全更新一些现代 C++ 约定。因此，请尝试经常编译您的代码，直到您对允许的内容有所了解。

对于 9.0.1 版，命令行中的使用语法如下：

```
clang -c CPPtoC.cpp -o CPPtoC.bc -emit-llvm
clang -march=c  CPPtoC.bc -o CPPtoC.c 
```

对于旧版本（不确定转换版本），请使用以下语法：

```
llvm-g++ -c CPPtoC.cpp -o CPPtoC.bc -emit-llvm
llc -march=c  CPPtoC.bc -o CPPtoC.c 
```

请注意，它创建了 C 的 GNU 风格，而不是真正的 ANSI C。在您对代码投入过多之前，您需要测试它是否对您有用。例如，一些嵌入式系统只接受 ANSI C。

另请注意，它会生成功能但相当不可读的代码。我建议评论和维护您的 C++ 代码，而不用担心最终的 C 代码。

编辑：虽然此功能的官方支持已被删除，但用户仍然可以使用Julia 语言开发人员[的](https://github.com/JuliaComputing/llvm-cbe)非官方支持来实现上述功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-10-03T23:05:29.643

也许好的 ol' [cfront](http://www.softwarepreservation.org/projects/c_plus_plus/cfront)会做？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-10T10:38:13.827

虽然您可以在 C 中执行 OO（例如，通过向`theType *this`方法添加第一个参数，并手动处理诸如多态的 vtable 之类的东西），但作为设计，这永远不会特别令人满意，而且看起来很丑陋（即使有一些预处理器黑客）。

我建议至少看一个重新设计来比较这将如何工作。

总体而言，很大程度上取决于关键问题的答案：如果您有工作的 C++ 代码，为什么要使用 C？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-01-10T16:35:36.233

编译器由两个主要块组成：“前端”和“后端”。编译器的前端分析源代码并构建所述源代码的某种形式的“中间表示”，这比源代码更容易通过机器算法分析（即，源代码例如 C++ 旨在帮助*人类程序员*编写代码，中间形式旨在帮助简化分析所述中间形式的*算法*）。编译器的后端采用中间形式，然后将其转换为“目标语言”。

现在，通用编译器的目标语言是各种处理器的汇编语言，但没有什么可以禁止编译器后端以其他语言生成代码，只要所述目标语言（至少）与通用 CPU 汇编程序。

现在，正如您可能想象的那样，C 绝对与 CPU 的汇编程序一样灵活，因此从技术角度实现 C++ 到 C 编译器确实没有问题。

所以你有：C++ ---frontEnd---> someIntermediaryForm ---backEnd---> C

你可能想看看这些人：[http](http://www.edg.com/index.php?location=c_frontend) ://www.edg.com/index.php?location=c_frontend （上面的链接只是说明*可以*做什么，他们以数万美元的价格许可他们的前端)

PS 据我所知，GNU 没有这样的 C++ 到 C 编译器，这完全打败了我（如果我是对的）。因为 C 语言相当小，而且它的内部机制相当简陋，所以 C 编译器需要大约一个人年的工作（我可以第一手告诉你，因为我可能几年前自己编写了这样一个编译器，它会产生一个 [ virtual] 堆栈机器中间代码），并且能够拥有一个维护的、最新的 C++ 编译器，而只需要编写一次 C 编译器将是一件很棒的事情......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-12T18:37:54.180

这是一个旧线程，但显然`C++ Faq`有一个[部分](http://www.parashift.com/c++-faq/convert-to-c.html) *[（存档 2013 版本）](https://web.archive.org/web/20130313032659/www.parashift.com/c++-faq/convert-to-c.html)*。如果联系作者，这显然会更新，所以从长远来看，这可能会更新，但这是当前版本：

> 取决于你的意思。如果您的意思是，是否可以将 C++ 转换为可读且可维护的 C 代码？那么抱歉，答案是否定的——C++ 特性不直接映射到 C，而且生成的 C 代码不适合人类遵循。相反，如果您的意思是，是否存在将 C++ 转换为 C 的编译器，以便在没有 C++ 编译器的平台上进行编译？那么你很幸运——继续阅读。
> 
> 将 C++ 编译为 C 的编译器会对程序进行完整的语法和语义检查，并且恰好使用 C 代码作为生成目标代码的一种方式。这样的编译器不仅仅是某种花哨的宏处理器。（请不要给我发电子邮件声称这些是预处理器——它们不是——它们是完整的编译器。）可以通过转换为 C 来实现 ISO 标准 C++ 的所有功能，并且除了异常处理之外，它通常会导致在目标代码中的效率与传统 C++ 编译器生成的代码相当。
> 
> 以下是一些执行 C 编译的产品：
> 
> *   [Comeau Computing](http://www.comeaucomputing.com)提供了一个基于[Edison Design Group 前端](http://www.edg.com/)的编译器，用于输出 C 代码。
> *   [LLVM](http://llvm.org/)是一个可下载的编译器，它发出 C 代码。另请参阅[此处](https://web.archive.org/web/20130313032659/http://llvm.cs.uiuc.edu/)和[此处](https://web.archive.org/web/20130313032659/http://www.nondot.org/~sabre/Projects/)。这是[通过 LLVM 进行 C++ 到 C 转换的示例](https://web.archive.org/web/20110224052016/http://paste.lisp.org:80/display/73134)。
> *   [Cfront](http://www.softwarepreservation.org/projects/c_plus_plus/index.html#cfront)是 C++ 的原始实现，由 Bjarne Stroustrup 和 AT&T 的其他人完成，它生成 C 代码。但是它有两个问题：自 90 年代中期开始经历所有权变更的迷宫以来，很难获得许可证，同时开发停止，因此它没有得到错误修复，也不支持任何较新的语言特性（例如，异常、命名空间、RTTI、成员模板）。
>     
>     
> *   与流行的神话相反，在撰写本文时，还没有将 C++ 转换为 C 的 g++ 版本。这样的事情似乎是可行的，但我不知道是否有人实际做过（目前）。
>     
>     
> 
> 请注意，您通常需要指定目标平台的 CPU、操作系统和 C 编译器，以便生成的 C 代码专门针对该平台。这意味着： (a) 您可能无法获取为平台 X 生成的 C 代码并在平台 Y 上编译它；(b) 自己进行翻译会很困难——使用其中一种工具可能会更便宜/更安全。
> 
> 再说一次：不要给我发电子邮件说这些只是预处理器——它们不是——它们是编译器。

# c# - zlib 从 C++ 到 C#（如何将 byte[] 转换为流和流到 byte[]）

> ID：737258
> 
> 赞同：6
> 
> 时间：2009-04-10T10:30:41.037
> 
> 标签：c#, byte, zlib

我的任务是使用 zlib 解压缩数据包（收到），然后使用算法从数据中制作图片

好消息是我有 C++ 代码，但任务是用 C# 来完成

C++

```
 //Read the first values of the packet received

        DWORD image[200 * 64] = {0}; //used for algoritm(width always = 200 and height always == 64)
        int imgIndex = 0; //used for algoritm
        unsigned char rawbytes_[131072] = {0}; //read below
        unsigned char * rawbytes = rawbytes_; //destrination parameter for decompression(ptr)
        compressed = r.Read<WORD>(); //the length of the compressed bytes(picture)
        uncompressed = r.Read<WORD>(); //the length that should be after decompression
        width = r.Read<WORD>(); //the width of the picture
        height = r.Read<WORD>(); //the height of the picture

        LPBYTE ptr = r.GetCurrentStream(); //the bytes(file that must be decompressed)

        outLen = uncompressed; //copy the len into another variable

        //Decompress

        if(uncompress((Bytef*)rawbytes, &outLen, ptr, compressed) != Z_OK)
        {
            printf("Could not uncompress the image code.\n");
            Disconnect();
            return;
        }

        //Algoritm to make up the picture
        // Loop through the data
        for(int c = 0; c < (int)height; ++c)
        {
            for(int r = 0; r < (int)width; ++r)
            {
                imgIndex = (height - 1 - c) * width + r;
                image[imgIndex] = 0xFF000000;
                if(-((1 << (0xFF & (r & 0x80000007))) & rawbytes[((c * width + r) >> 3)])) 
                    image[imgIndex] = 0xFFFFFFFF;
            }
        } 
```

我正在尝试使用 zlib.NET 执行此操作，但所有演示都有要解压缩的代码（C#）

```
 private void decompressFile(string inFile, string outFile)
    {
        System.IO.FileStream outFileStream = new System.IO.FileStream(outFile, System.IO.FileMode.Create);
        zlib.ZOutputStream outZStream = new zlib.ZOutputStream(outFileStream);
        System.IO.FileStream inFileStream = new System.IO.FileStream(inFile, System.IO.FileMode.Open);          
        try
        {
            CopyStream(inFileStream, outZStream);
        }
        finally
        {
            outZStream.Close();
            outFileStream.Close();
            inFileStream.Close();
        }
    }

    public static void CopyStream(System.IO.Stream input, System.IO.Stream output)
    {
        byte[] buffer = new byte[2000];
        int len;
        while ((len = input.Read(buffer, 0, 2000)) > 0)
        {
            output.Write(buffer, 0, len);
        }
        output.Flush();
    } 
```

我的问题：我不想在解压后保存文件，因为我必须使用 C++ 代码中显示的算法。

如何将 byte[] 数组转换为类似于 C# zlib 代码中的流以解压缩数据，然后如何将流转换回字节数组？

另外，如何将 zlib.NET 代码更改为不保存文件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T10:34:34.490

只需使用 MemoryStreams 而不是 FileStreams：

```
// Assuming inputData is a byte[]
MemoryStream input = new MemoryStream(inputData);
MemoryStream output = new MemoryStream(); 
```

然后你可以使用`output.ToArray()`之后得到一个字节数组。

请注意，通常最好使用`using`语句而不是单个 try/finally 块 - 否则如果第一次调用`Close`失败，则不会进行其余的调用。你可以像这样嵌套它们：

```
using (MemoryStream output = new MemoryStream())
using (Stream outZStream = new zlib.ZOutputStream(output))
using (Stream input = new MemoryStream(bytes))
{
    CopyStream(inFileStream, outZStream);
    return output.ToArray();
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-10-02T03:25:46.527

我刚刚遇到了同样的问题。

为了完整性......（因为这让我难过了几个小时）

对于 ZLib.Net，在调用 return output.ToArray() 之前，您还必须调用 finish()，这通常发生在 Close() 期间

否则，您将从内存流中获得一个空/不完整的字节数组，因为 ZStream 实际上还没有写入所有数据：

```
public static void CompressData(byte[] inData, out byte[] outData)
{
    using (MemoryStream outMemoryStream = new MemoryStream())
    using (ZOutputStream outZStream = new ZOutputStream(outMemoryStream, zlibConst.Z_DEFAULT_COMPRESSION))
    using (Stream inMemoryStream = new MemoryStream(inData))
    {
        CopyStream(inMemoryStream, outZStream);
        outZStream.finish();
        outData = outMemoryStream.ToArray();
    }
}

public static void DecompressData(byte[] inData, out byte[] outData)
{
    using (MemoryStream outMemoryStream = new MemoryStream())
    using (ZOutputStream outZStream = new ZOutputStream(outMemoryStream))
    using (Stream inMemoryStream = new MemoryStream(inData))
    {
        CopyStream(inMemoryStream, outZStream);
        outZStream.finish();
        outData = outMemoryStream.ToArray();
    }
} 
```

在此示例中，我还使用了 zlib 命名空间：

```
using zlib; 
```

最初在这个线程中找到： [ZLib解压](https://stackoverflow.com/questions/1327412/zlib-decompression)

我还没有足够的积分来投票，所以...

感谢 Tim Greaves 关于 ToArray 之前完成的提示

和 Jon Skeet 关于嵌套流的 using 语句的提示（我比 try/finally 更喜欢它）

# visual-studio - Visual Studio 剪贴板问题

> ID：737265
> 
> 赞同：5
> 
> 时间：2009-04-10T10:33:37.830
> 
> 标签：visual-studio

到目前为止，在我使用的所有 Visual Studio 版本中，复制/粘贴操作都有问题。使用该应用程序一段时间后（在许多情况下非常短的时间），当我复制一些单词或行并粘贴时，没有任何内容被粘贴。然后我点击 ctrl+c 多次，然后内容被复制，我可以成功粘贴。

这使我养成了总是按 ctrl+c 多次复制某些内容的习惯。

有什么办法可以纠正这个吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T11:02:38.573

每次使用“CTRL-L”删除一行时，剪贴板都会变得混乱。

我使用一个小程序[ClipX](http://www.bluemars.org/clipx/)来跟踪我的剪贴板。如果 Visual Studio 从我的剪贴板中删除了该项目，我仍然可以粘贴该条目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T10:57:54.043

尝试做：`CTRL + L`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-19T06:26:27.277

这也可能是由于使用 shift + delete 引起的（它实际上是复制该行并同时删除）

shift+delete 经常删除非常方便。

# iphone - 如何本地化 Info.plist 文件中 CFBundleDisplayName 的值？

> ID：737266
> 
> 赞同：4
> 
> 时间：2009-04-10T10:34:20.887
> 
> 标签：iphone, localization

当我在 Xcode 中查看 Info.plist 文件时，属性列表编辑器向我显示了一个看起来像变量的值：

```
${PRODUCT_NAME} 
```

如何/在哪里可以为我的应用设置本地化名称？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-10T10:39:51.653

您可以创建一个名为 InfoPlist.strings 的本地化文件，其中包含应用程序的名称：

```
CFBundleDisplayName = "Name of the App"; 
```

（就像 Localizable.strings 一样）

# xslt - xsl:for-each 有什么不好？

> ID：737269
> 
> 赞同：6
> 
> 时间：2009-04-10T10:36:20.447
> 
> 标签：xslt

我一次又一次地听到关于您应该如何避免使用 XSLT for-each。这是你内心的命令式编程恶魔，应该被放逐。

它有什么不好？

这种最佳实践是否取决于 XML 的*大小*（即 100 与 10,000 个节点）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T13:20:45.807

**`<xsl:apply-templates>`和`<xsl:-for-each>`没有人指出的本质区别**：

1.  **[`<xsl:apply-templates>`](http://www.w3.org/TR/xslt#element-apply-templates)真的不仅仅是更好，更优雅的等价物[`<xsl:for-each>`](http://www.w3.org/TR/xslt#element-for-each)：**

`xsl:apply-templates`比 更丰富、更深入`xsl:for-each`，甚至仅仅是因为**我们不知道将在选择的节点上应用什么代码——在一般情况下，对于 node-list 的不同节点，该代码将是不同的**。

此外，***可以在编写 xsl:apply 模板之后以及由不知道原作者的人编写将要应用的代码***。

* * *

_2。另一方面，如果确切地知道 an**是如何处理的，则****使用[`<xsl:for-each>`](http://www.w3.org/TR/xslt#element-for-each)绝不是有害的`<xsl:for-each>`**。

问题在于，许多在命令式编程方面有经验的 XSLT 新手`<xsl:for-each>`在他们最喜欢的 PL 中将“循环”代替为“循环”，并认为它允许他们执行不可能的事情——比如增加一个计数器或任何其他修改一个已经定义的`<xsl:variable>`.

一个必不可少的用途`<xsl:for-each>`是更改当前文档——这通常[**是为了能够在文档上使用不同于当前源 XML 文档的 key() 函数**](http://clover.slavic.pitt.edu/~repertorium/plectogram/keys/keys.html)，例如有效地访问驻留的查找表在它自己的 xml 文档中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-10T10:49:31.070

模板倾向于更好地拆分代码。此外，for-each 循环还受到以下事实的困扰：人们经常想到它们的操作方式与主流编程语言中 for 循环的工作方式相同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T10:42:32.990

快速回答：XSLT 本质上是功能性的，命令式循环不是很实用。

一般来说，充分利用 XSLT 的基本方法是尽可能多地使用模式匹配（`xsl:apply-template`而不是循环、ifs 和 call-template ¹）。

最后，这一切都与风格有关，并且在 XSLT 的短片中几乎没有什么区别，但更多的功能将有助于解决更长/更复杂的问题。

¹除了创建返回值而不是修改输出的函数时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T10:52:48.347

不鼓励使用 a`for-each`来调用模板，而不是广泛使用`for-each`本身。甚至[Muenchian 的分组方法也](http://www.jenitennison.com/xslt/grouping/index.xml)依赖于`xsl:key`带有`xsl:for-each`循环的构造。

编写好的 XSLT 的想法是，您的 XML 结构应该决定匹配和应用哪些模板。因此，只要有可能，使用`apply-templates`来选择节点，而不是使用 来应用选择`for-each`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T10:48:28.247

通过使用`apply-templates`，也许与`mode`， 可以更容易地包含对该位置可能感兴趣的更多类型元素的适当转换。

例如，如果你有一个包含图书馆内容的 XML，并且你一直使用 for-each 来选择书籍，那么你开始记录 DVD、CD、Ginger Nut 饼干等，你将不得不检查所有的 for - 每个部分不仅包括书籍。如果您使用过应用模板，则可以简单地为新元素创建新的匹配项。

# mysql - 全文搜索引擎对比——Lucene、Sphinx、Postgresql、MySQL？

> ID：737275
> 
> 赞同：326
> 
> 时间：2009-04-10T10:38:14.153
> 
> 标签：mysql, postgresql, full-text-search, lucene, sphinx

我正在构建一个 Django 站点，并且正在寻找一个搜索引擎。

几个候选人：

*   Lucene/Lucene 与 Compass/Solr

*   狮身人面像

*   Postgresql 内置全文搜索

*   MySQl 内置全文搜索

选择标准：

*   结果相关性和排名
*   搜索和索引速度
*   易于使用且易于与 Django 集成
*   资源要求 - 站点将托管在[VPS](http://en.wikipedia.org/wiki/Virtual_private_server)上，因此理想情况下，搜索引擎不需要大量 RAM 和 CPU
*   可扩展性
*   额外的功能，例如“你的意思是？”、相关搜索等

任何对上述搜索引擎或未在列表中的其他引擎有经验的人——我很想听听您的意见。

编辑：至于索引需求，随着用户不断向网站输入数据，这些数据需要不断地被索引。它不一定是实时的，但理想情况下，新数据会出现在索引中，延迟不超过 15 - 30 分钟

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2009-04-10T15:08:56.173

很高兴看到有人对 Lucene 发表意见——因为我对此一无所知。

另一方面，狮身人面像，我很了解，所以让我们看看我是否能提供一些帮助。

*   结果相关性排名是默认值。您可以根据需要设置自己的排序，并为特定字段赋予更高的权重。
*   索引速度非常快，因为它直接与数据库对话。任何缓慢都来自复杂的 SQL 查询和未索引的外键以及其他此类问题。我也从未注意到搜索有任何缓慢。
*   我是 Rails 人，所以我不知道用 Django 实现它有多容易。不过，Sphinx 源代码附带了一个 Python API。
*   搜索服务守护程序 (searchd) 的内存使用量非常低 - 您也可以设置索引器进程使用[多少内存的限制。](http://www.sphinxsearch.com/docs/manual-0.9.8.html#conf-mem-limit)
*   可扩展性是我的知识比较粗略的地方 - 但是将索引文件复制到多台机器并运行多个 searchd 守护程序很容易。不过，我从其他人那里得到的总体印象是，它在高负载下非常好，因此在多台机器上扩展它并不是需要处理的事情。
*   不支持'did-you-mean'等-尽管这些可以使用其他工具轻松完成。Sphinx 虽然使用字典来做词干，所以“驾驶”和“驾驶”（例如）在搜索中会被认为是相同的。
*   Sphinx 不允许字段数据的部分索引更新。常见的方法是维护一个包含所有最近更改的增量索引，并在每次更改后重新索引（这些新结果会在一两秒内出现）。由于数据量很小，这可能需要几秒钟的时间。不过，您仍然需要定期重新索引主数据集（尽管多久定期取决于数据的波动性 - 每天？每小时？）。不过，快速的索引速度让这一切都变得非常轻松。

我不知道这对您的情况有多适用，但[Evan Weaver 比较了一些常见的 Rails 搜索选项](http://blog.evanweaver.com/articles/2008/03/17/rails-search-benchmarks/)（Sphinx、Ferret（Ruby 的 Lucene 端口）和 Solr），并运行了一些基准测试。可能有用，我猜。

我还没有深入研究 MySQL 全文搜索的深度，但我知道它在速度方面和功能方面都无法与 Sphinx、Lucene 或 Solr 竞争。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-04-10T11:12:37.690

我不知道Sphinx，但至于Lucene vs 数据库全文搜索，我认为Lucene 的性能是无与伦比的。只要您正确设置了 Lucene 索引，您应该能够在不到 10 毫秒的时间内完成几乎*任何搜索，无论您需要搜索多少条记录。*

不过最大的障碍来了：就个人而言，我认为将 Lucene 集成到您的项目中并不*容易*。当然，设置它并不难，因此您可以进行一些基本的搜索，但是如果您想充分利用它并获得最佳性能，那么您肯定需要一本关于 Lucene 的好书。

至于 CPU 和 RAM 要求，在 Lucene 中执行搜索不会对您的 CPU 执行过多的任务，尽管索引您的数据是，尽管您不经常这样做（可能一天一次或两次），所以这不是很大的障碍。

它并不能回答您所有的问题，但简而言之，如果您有大量数据要搜索，并且想要出色的性能，那么我认为 Lucene 绝对是您的最佳选择。如果您不打算搜索那么多数据，那么您不妨进行数据库全文搜索。在我的书中，设置 MySQL 全文搜索肯定更容易。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2015-01-19T10:49:34.130

# [阿帕奇索尔*_*](http://lucene.apache.org/solr/)

* * *

除了回答 OP 的疑问之外，让我从**简单的介绍**到**详细的安装**和**实现，对*****Apache Solr***进行一些见解。

 ******> # 简单介绍

* * *

> *任何对上述搜索引擎或未在列表中的其他引擎有经验的人——我很想听听您的意见。*

**Solr**不应该用于解决实时问题。对于搜索引擎，**Solr**几乎是游戏，并且可以*完美*运行。

**Solr**在高流量 Web 应用程序上运行良好（*我在某处读到它不适合此，但我支持该声明*）。它使用 RAM，而不是 CPU。

> *   结果相关性和排名

**提升**可帮助您将结果排在首位。假设，您尝试在*firstname*和*lastname*字段中搜索名称*john*，并且您想为*firstname*字段提供相关性，那么您需要**提升***firstname*字段，如图所示。

 *****```
http://localhost:8983/solr/collection1/select?q=firstname:john^2&lastname:john 
```

如您所见，*名字*字段的得分**提高了 2。**

更多关于[SolrRelevancy](https://wiki.apache.org/solr/SolrRelevancyFAQ)

> *   搜索和索引速度

速度快得令人难以置信，而且毫不妥协。我搬到**Solr**的原因。

关于索引速度，**Solr**还可以处理来自数据库表的**JOINS 。**更高更复杂的**JOIN**确实会影响索引速度。但是，巨大的**RAM**配置可以轻松解决这种情况。

RAM 越高，Solr 的索引速度越快。

> *   易于使用且易于与 Django 集成

从未尝试过集成**Solr**和**Django**，但是您可以使用[Haystack](http://haystacksearch.org/)来实现。我发现了一些有趣的[文章](http://www.alexanderinteractive.com/blog/2012/08/getting-started-with-solr-and-django/)，这里是它的[github](https://github.com/broderboy/django-solr-demo)。

> *   资源要求 - 站点将托管在 VPS 上，因此理想情况下搜索引擎不需要大量 RAM 和 CPU

**Solr**在 RAM 上繁殖，因此如果 RAM 很高，您不必担心**Solr**。

**如果您有数十亿条记录， Solr 的**RAM 使用量会在全索引时猛增，您可以巧妙地利用 Delta 导入来解决这种情况。如前所述，**Solr** *只是一种近乎实时的解决方案*。

> *   可扩展性

**Solr**具有高度可扩展性。看看[SolrCloud](https://cwiki.apache.org/confluence/display/solr/SolrCloud)。它的一些关键特性。

*   分片（或分片是在多台机器之间分配索引的概念，比如如果您的索引变得太大）
*   负载平衡（如果[Solrj](http://wiki.apache.org/solr/Solrj)与 Solr 云一起使用，它会使用它的循环机制自动处理负载平衡）
*   [分布式搜索](http://wiki.apache.org/solr/DistributedSearch)
*   高可用性

> *   额外的功能，例如“你的意思是？”、相关搜索等

对于上述场景，您可以使用与**Solr**打包的[SpellCheckComponent](http://wiki.apache.org/solr/SpellCheckComponent)。还有很多其他功能，[SnowballPorterFilterFactory](http://lucene.apache.org/solr/3_6_1/org/apache/solr/analysis/SnowballPorterFilterFactory.html)有助于检索记录，例如，如果您键入的是*books*而不是*book*，您将看到与*book*相关的结果。

 ****** * *

这个答案广泛关注**Apache Solr** & **MySQL**。Django 超出范围。

假设您在 LINUX 环境下，您可以继续阅读本文。（我的是 Ubuntu 14.04 版本）

> # 详细安装

## 入门

从[这里](http://apache.mirrors.hoobly.com/lucene/solr/4.8.1/)下载**Apache Solr**。那将是版本**4.8.1**。你可以下载新版本，我发现这个很稳定。

 **下载存档后，将其解压缩到您选择的文件夹中。说.. `Downloads`或其他..所以它看起来像`Downloads/solr-4.8.1/`

根据您的提示.. 在目录中导航

`shankar@shankar-lenovo: cd Downloads/solr-4.8.1`

所以现在你在这里..

`shankar@shankar-lenovo: ~/Downloads/solr-4.8.1$`

## 启动 Jetty 应用服务器

**Jetty**在`solr-4.8.1`目录的示例文件夹中可用，因此在其中导航并启动 Jetty 应用程序服务器。

`shankar@shankar-lenovo:~/Downloads/solr-4.8.1/example$ java -jar start.jar`

现在，不要关闭终端，将其最小化并放在一边。

> （提示：在 start.jar 之后使用 & 使 Jetty Server 在后台运行）

要检查**Apache Solr**是否成功运行，请在浏览器上访问此 URL。[http://localhost:8983/solr](http://localhost:8983/solr)

## 在自定义端口上运行 Jetty

它默认在端口 8983 上运行。您可以在此处或直接在`jetty.xml`文件中更改端口。

`java -Djetty.port=9091 -jar start.jar`

## 下载 JConnector

这个 JAR 文件充当**MySQL**和 JDBC 之间的桥梁，[在此处下载平台独立版本](http://dev.mysql.com/downloads/connector/j/)

下载后解压文件夹，复制`mysql-connector-java-5.1.31-bin.jar`粘贴到**lib**目录下。

`shankar@shankar-lenovo:~/Downloads/solr-4.8.1/contrib/dataimporthandler/lib`

## 创建要链接到 Apache Solr 的 MySQL 表

要使用**Solr**，您需要有一些表和数据要搜索。为此，我们将使用**MySQL**创建一个表并推送一些随机名称，然后我们可以使用**Solr**连接到**MySQL**并索引该表及其条目。

### 1.表结构

```
CREATE TABLE test_solr_mysql
 (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(45) NULL,
  created TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id)
 ); 
```

### 2.填充上表

```
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Jean');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Jack');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Jason');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Vego');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Grunt');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Jasper');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Fred');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Jenna');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Rebecca');
INSERT INTO `test_solr_mysql` (`name`) VALUES ('Roland'); 
```

## 进入核心并添加 lib 指令

### 1.导航到

```
shankar@shankar-lenovo: ~/Downloads/solr-4.8.1/example/solr/collection1/conf 
```

### 2.修改solrconfig.xml

将这两个指令添加到此文件中..

```
 <lib dir="../../../contrib/dataimporthandler/lib/" regex=".*\.jar" />
  <lib dir="../../../dist/" regex="solr-dataimporthandler-\d.*\.jar" /> 
```

现在添加**DIH**（数据导入处理程序）

```
<requestHandler name="/dataimport" 
  class="org.apache.solr.handler.dataimport.DataImportHandler" >
    <lst name="defaults">
      <str name="config">db-data-config.xml</str>
    </lst>
</requestHandler> 
```

### 3.创建 db-data-config.xml 文件

如果文件存在则忽略，将这些行添加到该文件。如您所见，您需要提供**MySQL**数据库的凭据。数据库名称、用户名和密码。

```
<dataConfig>
    <dataSource type="JdbcDataSource" driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost/yourdbname" user="dbuser" password="dbpass"/>
    <document>
   <entity name="test_solr" query="select CONCAT('test_solr-',id) as rid,name from test_solr_mysql WHERE '${dataimporter.request.clean}' != 'false'
      OR `created` > '${dataimporter.last_index_time}'" >
    <field name="id" column="rid" />
    <field name="solr_name" column="name" />
    </entity>
   </document>
</dataConfig> 
```

> （提示：您可以拥有任意数量的实体，但要注意 id 字段，如果它们相同，则将跳过索引。）

### 4.修改schema.xml文件

如图所示，将此添加到您的**schema.xml**中。

```
<uniqueKey>id</uniqueKey>
<field name="solr_name" type="string" indexed="true" stored="true" /> 
```

> # 执行

## 索引

这是真正的交易。您需要对从**MySQL**到**Solr**的数据进行索引，以便使用 Solr 查询。

### 第 1 步：转到 Solr 管理面板

在浏览器上点击 URL [http://localhost:8983/solr 。](http://localhost:8983/solr)屏幕是这样打开的。

![这是主要的 Apache Solr 管理面板](https://i.stack.imgur.com/8grrc.png)

如标记所示，转到**日志记录**以检查上述任何配置是否导致错误。

### 第 2 步：检查您的日志

好的，现在你在这里，你可以有很多黄色消息（警告）。确保您没有将错误消息标记为红色。早些时候，在我们的配置中，我们在**db-data-config.xml**上添加了一个选择查询，假设该查询有任何错误，它会显示在这里。

![这是 Apache Solr 引擎的日志记录部分](https://i.stack.imgur.com/8l6n5.png)

很好，没有错误。我们可以走了。如图所示，让我们从列表中选择**collection1并选择****Dataimport**

### 第 3 步：DIH（数据导入处理程序）

使用 DIH，您将通过 Solr 接口中的配置文件 db-data-config.xml 从 Solr 连接到**MySQL**，**并**从**数据库****中**检索10 条记录，这些记录被索引到**Solr**上。

 ******为此，请选择**full-import**，然后检查选项*Clean*和*Commit*。现在单击**执行**，如图所示。

或者，您也可以使用像这样的直接**完全导入查询..**

```
http://localhost:8983/solr/collection1/dataimport?command=full-import&commit=true 
```

![数据导入处理程序](https://i.stack.imgur.com/sHvSO.png)

单击**Execute**后，**Solr**开始对记录进行索引，如果有任何错误，它会说**Indexing Failed**并且您必须返回**Logging**部分查看出了什么问题。

假设此配置没有错误，并且索引编制成功完成，您将收到此通知。

![索引成功](https://i.stack.imgur.com/WlD07.png)

### 第 4 步：运行 Solr 查询

似乎一切都很顺利，现在您可以使用**Solr** Queries 来查询被索引的数据。单击左侧的**查询**，然后按底部的**执行按钮。**

您将看到如图所示的索引记录。

列出所有记录的相应**Solr**查询是

```
http://localhost:8983/solr/collection1/select?q=*:*&wt=json&indent=true 
```

![索引数据](https://i.stack.imgur.com/aZP9W.png)

好吧，所有 10 条索引记录都有了。比如说，我们只需要以**Ja**开头的名称，在这种情况下，您需要定位列 name `solr_name`，因此您的查询是这样的。

```
http://localhost:8983/solr/collection1/select?q=solr_name:Ja*&wt=json&indent=true 
```

![以 Ja* 开头的 JSON 数据](https://i.stack.imgur.com/qeArE.png)

这就是您编写**Solr**查询的方式。要了解更多信息，请查看这篇漂亮的[文章](http://lucene.apache.org/core/3_5_0/queryparsersyntax.html)。

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2010-12-09T04:20:35.857

我很惊讶没有发布更多关于 Solr 的信息。Solr 与 Sphinx 非常相似，但具有更高级的功能（AFAIK，因为我没有使用过 Sphinx - 只阅读过它）。

以下链接中的答案详细介绍了有关 Sphinx 的一些内容，这些内容也适用于 Solr。 [全文搜索引擎对比——Lucene、Sphinx、Postgresql、MySQL？](https://stackoverflow.com/questions/737275/pros-cons-of-full-text-search-engine-lucene-sphinx-postgresql-full-text-searc/737931#737931)

Solr 还提供以下附加功能：

1.  支持复制
2.  多核（将这些视为具有自己的配置和索引的独立数据库）
3.  布尔搜索
4.  突出显示关键字（如果您有 regex-fu，在应用程序代码中很容易做到；但是，为什么不让专门的工具为您做得更好）
5.  通过 XML 或分隔文件更新索引
6.  通过 HTTP 与搜索服务器通信（甚至可以返回 Json、Native PHP/Ruby/Python）
7.  PDF、Word文档索引
8.  动态字段
9.  刻面
10.  聚合字段
11.  停用词、同义词等。
12.  更多像这样...
13.  使用自定义查询直接从数据库索引
14.  自动建议
15.  缓存自动预热
16.  快速索引（与 MySQL 全文搜索索引时间相比）——Lucene 使用二进制倒排索引格式。
17.  提升（用于增加特定关键字或短语等相关性的自定义规则）
18.  字段搜索（如果搜索用户知道他/她想要搜索的字段，他们会通过键入字段，然后是值来缩小搜索范围，并且只搜索该字段而不是所有内容 - 更好的用户体验）

顺便说一句，还有更多功能；但是，我只列出了我在生产中实际使用的功能。顺便说一句，开箱即用，MySQL 支持上面列表中的 #1、#3 和 #11（有限）。对于您正在寻找的功能，关系数据库不会削减它。我会立即消除那些。

此外，另一个好处是 Solr（实际上是 Lucene）是一个文档数据库（例如 NoSQL），因此任何其他文档数据库的许多好处都可以通过 Solr 实现。换句话说，您可以将其用于搜索之外（即性能）。发挥创意 :)

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-09-17T22:57:50.507

我现在正在研究 PostgreSQL 全文搜索，它具有现代搜索引擎的所有正确功能，非常好的扩展字符和多语言支持，与数据库中的文本字段紧密集成。

但它没有像 + 或 AND（使用 & | ！）这样的用户友好型搜索运算符，而且我对它在他们的文档站点上的工作方式并不感到兴奋。虽然它在结果片段中将匹配项加粗，但匹配项的默认算法并不是很好。此外，如果你想索引 rtf、PDF、MS Office，你必须找到并集成一个文件格式转换器。

OTOH，它比 MySQL 文本搜索要好得多，后者甚至不索引三个字母或更少的单词。这是 MediaWiki 搜索的默认设置，我真的认为这对最终用户没有好处：[http ://www.searchtools.com/analysis/mediawiki-search/](http://www.searchtools.com/analysis/mediawiki-search/)

**在我见过的所有情况下，Lucene/Solr 和 Sphinx 都非常棒**。它们是可靠的代码，并且随着可用性的显着改进而发展，因此这些工具都可以让搜索满足几乎所有人的需求。

对于 SHAILI - SOLR 包括 Lucene 搜索代码库，并具有成为一个不错的独立搜索引擎的组件。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2014-01-21T19:07:12.123

对于这个非常古老的问题，我只有两分钱。我强烈建议您看一下[ElasticSearch](http://www.elasticsearch.org/)。

> Elasticsearch 是一个基于 Lucene 的搜索服务器。它提供了一个分布式的、支持多租户的全文搜索引擎，具有 RESTful Web 界面和无模式 JSON 文档。Elasticsearch 是用 Java 开发的，并根据 Apache 许可条款作为开源发布。

与其他 FTS（全文搜索）引擎相比的优势是：

*   RESTful 接口
*   更好的可扩展性
*   大型社区
*   由 Lucene 开发人员构建
*   广泛的文档
*   [有许多](http://www.elasticsearch.org/guide/en/elasticsearch/client/community/current/integrations.html)可用的开源库（包括 Django）

我们在我们的项目中使用这个搜索引擎并且对它非常满意。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-09-28T00:51:39.907

SearchTools-Avi 说“MySQL 文本搜索，它甚至不索引三个字母或更少的单词。”

仅供参考，MySQL 全文最小字长*至少*从MySQL 5.0 开始是可调整的。谷歌'mysql全文最小长度'以获得简单的说明。

也就是说，MySQL 全文有局限性：一方面，一旦达到一百万条左右的记录，更新就会变得很慢，......

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-06-20T21:00:33.780

我会将[mnoGoSearch](http://www.mnogosearch.org/)添加到列表中。非常高性能和灵活的解决方案，它像 Google 一样工作：索引器从多个站点获取数据，您可以使用基本标准，或发明自己的钩子以获得最大的搜索质量。它也可以直接从数据库中获取数据。

该解决方案在今天并不为人所知，但它满足了最大的需求。您可以编译和安装它，也可以在独立服务器上，甚至在您的主服务器上，它不需要像 Solr 那么多的资源，因为它是用 C 语言编写的，即使在小型服务器上也能完美运行。

一开始你需要自己编译，所以需要一些知识。我为 Debian制作了一个小[脚本，这可能会有所帮助。](https://github.com/fedir/mnogosearch-typo3/blob/master/installation-debian.sh)欢迎任何调整。

由于您使用的是Django框架，您可以在中间使用PHP客户端，或者在Python中找到解决方案，我看到了[一些](http://mail.python.org/pipermail/xml-sig/2002-September/008623.html) [文章](http://blog.garambrogne.net/post/2004/04/15/14-mnogosearch-et-python)。

当然，mnoGoSearch 是开源的，GNU GPL。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-06-30T12:02:57.293

我们刚刚从 Elasticsearch 切换到 Postgres Full Text。由于我们已经使用过 Postgres，我们现在省去了保持索引最新的麻烦。但这只会影响全文搜索。但是，在某些用例中 Elasicsearch 明显更好。也许是方面或类似的东西。

# c# - 构建动态列表c#

> ID：737284
> 
> 赞同：1
> 
> 时间：2009-04-10T10:43:25.577
> 
> 标签：c#, list

此代码可以正常进行 Web 服务调用：

```
int numberOfGuests = Convert.ToInt32(search.Guest);
var list = new List<Guest>();
Guest adult = new Guest();
adult.Id = 1;
adult.Title = "Mr";
adult.Firstname = "Test";
adult.Surname = "Test";
list.Add(adult);
Guest adult2 = new Guest();
adult2.Id = 2;
adult2.Title = "Mr";
adult2.Firstname = "Test";
adult2.Surname = "Test";
list.Add(adult2);

Guest[] adults = list.ToArray(); 
```

如何使用`numberofguests`变量动态构建列表以创建列表？输出必须与显示的输出完全匹配，否则 Web 服务调用将失败，因此成人.id = 1、成人2.id = 2、成人3.id = 3 等...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T10:46:37.487

你知道循环吗？

```
for (int i = 1; i <= numberofGuests; i++) {
    var adult = new Guest();
    adult.Id = i;
    adult.Title = "Mr";
    adult.Firstname = "Test";
    adult.Surname = "Test";
    list.Add(adult)
} 
```

这将在循环中运行一次从 1 到 的代码`numberOfGuests`，将变量设置`i`为当前值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T11:02:28.963

Linq 方式:-)

```
 var list = (from i in Enumerable.Range(1, numberOfGuests)
        select new Guest 
        {
          Id = i,
          Title = "Mr.",
          Firstname = "Test",
          Surname = "Test"
        }).ToList(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T10:47:03.430

你需要一个[for 循环](http://msdn.microsoft.com/en-us/library/ch45axte.aspx)。或者，更好的是，一本不错的 C# 书籍——这些都是 C# 的真正基础。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T11:03:02.720

您是在问如何动态显示列表吗？我不太确定这里的问题是什么，因为其他答案说如果你知道`numberofGuests`那么你可以使用循环来遍历你的列表。

我怀疑您首先想知道如何获取此信息，对吗？如果您想向页面动态添加控件（您之前的帖子建议这是 ASP.Net 我认为？），以便您只显示正确数量的控件，然后查看这些相关问题：

[在 ASP.NET Repeater 中动态添加控件](https://stackoverflow.com/questions/128083/dynamically-adding-controls-in-asp-net-repeater)

[ASP.NET - 如何动态生成标签](https://stackoverflow.com/questions/733831/asp-net-how-to-dynamically-generate-labels)

# cakephp - Cakephp 使用两种模型

> ID：737287
> 
> 赞同：-1
> 
> 时间：2009-04-10T10:46:17.660
> 
> 标签：cakephp

在我的 CakePHP`forms_controller`中，我有：

```
var $uses=array('Form','Field');
// ...
$this->set('retrived',$this->Field->find("all",array('conditions'=>array('Field.formname'=>$formname,)))); 
```

在视图中：

```
<?php foreach ($retrived as $r): ?>
    <?php echo $r['Field']['fieldname']; ?><br>  
<?php endforeach; ?> 
```

我没有得到答案

实际上我的表字段会像：

```
fieldname   
  formname  
  type  
  value 
```

我的更多细节`forms_controller`：

```
function views()
{
    if (!empty($this->params['form'])) 
    {
        $this->set('fieldctr',$this->params['form']['formfieldctr']);
          $fieldctr=$this->params['form']['formfieldctr'];

        if(!empty($this->params['form']['formnameelements']))
        {
            $this->set('formname',$this->params['form']['formnameelements']);//formname
            $this->Form->saveField('name',$this->params['form']['formnameelements']);
        }
        else 
        { 
            $this->set('formname','MyForm');//formname
            $this->Form->saveField('name','MyForm');
        }

        $this->Form->saveField('body',$this->params['form']['formelements']);//inserts into database

        $ret = $this->Form->query("Select id from forms order by id DESC LIMIT 1");
        $newid=$ret[0]['forms']['id'];echo $newid;
        $upd=$this->Form->query("update forms set ctr=$fieldctr where id= $newid");
        $formname=$this->params['form']['formnameelements'];  

        $n="$formname";

        $array = $this->params['form']['formfieldnameelements'];
        $comma_separated = explode(",", $array);
        for($i=0;$i<$fieldctr;$i++)
        {
            echo $comma_separated[$i]; 
            echo "     ";
            $n="$comma_separated[$i]";

            //insert the fields of each form to the table fields
            $this->data['Field']['fieldname'] = $comma_separated[$i];
            $this->data['Field']['formname'] = $formname;

            $this->Field->saveAll($this->data);
        } 
```

上面的方法是我在表单表中插入表单名的地方。

并在字段表中插入该表单名及其字段名：

```
function formupdate()
{
    $this->set('fieldctr',$this->params['form']['formfieldctr']);
    $fieldctr=$this->params['form']['formfieldctr'];

    $this->set('formname',$this->params['form']['formnameelements']);//formname
    $formname=$this->params['form']['formnameelements'];

    $ret = $this->Field->query("SELECT fieldname FROM fields WHERE fields.formname = "."'$formname'"."order by id ASC");
    for($q=0;$q<$fieldctr;$q++)
    {
        $fieldname[$q]=$ret[$q]['fields']['fieldname'];
    }

    $this->set('retrived',$this->Field->find("all",array('conditions'=>array('Field.formname'=>$formname))));

    $array = $this->params['form']['formfieldvalueelements'];
    $comma_separated = explode(",", $array);

    for($i=0;$i<$fieldctr;$i++)
    {
        echo $comma_separated[$i]; 
        echo "     ";
        $n="$comma_separated[$i]";

        echo $fieldname[$i];

        $this->Field->updateAll(array('Field.value' => "'$comma_separated[$i]'"),array('Field.fieldname' => $fieldname[$i],'Field.formname'=>$formname));
        }
    $this->set('retrived',$this->Field->find("all",array('conditions'=>array('Field.formname'=>$formname,))));

} // end of function formupdate 
```

在上述`formupdate`方法中，我在字段表中插入了该字段的相应值的值......所有值都正确插入 - 但在我`formupdate.ctp`看来：

我的视图中没有显示任何内容......即使内容在表格中......

请解决我的问题

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T15:23:59.947

根据您的模型名称，我认为可以肯定地得出结论，您正在尝试输出一些 HTML。由于问题并不完整（代码在哪里？），我们无法判断它有什么问题。

一个疯狂的猜测是，您的浏览器正在那里剥离或忽略某些东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:34:59.670

阿鲁娜，

请发布您正在使用的代码！错误可能很小，但是在不知道您在做什么的情况下，无法提供比博士更多的帮助。莱克特做到了。

当您说字段表已正确更新时，您的意思是您可以安全地调用 Model::save() 方法吗？然后您是否在控制器中调用 Model::read() 或 Model::find()，然后使用其中的返回值来设置可以在视图中访问的变量？

# c# - 为什么更喜欢属性而不是公共变量？

> ID：737290
> 
> 赞同：18
> 
> 时间：2009-04-10T10:47:07.020
> 
> 标签：c#, syntax

其他能够在设置器中检查值是否有更根本的原因更喜欢属性而不是公共变量？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-10T10:49:19.370

我们以前有过这个主题，但我现在找不到任何东西。

简而言之：您的需求可能会发生变化：现在没有健全性检查，将来可能需要。但是，如果您将公共字段更改为属性，这会破坏二进制兼容性：每个使用您的代码/库的客户端都必须重新编译。

这很*糟糕*，因为它可能会花费很多钱。

从一开始就使用属性可以避免这个问题。这甚至适用于不属于库的代码。为什么？因为你永远不知道：代码（即使是高度特定于领域的！）可能证明是有用的，所以你想将它重构为一个库。如果您已经在使用属性代替公共/受保护字段，那么这个重构过程显然会变得更加容易。

此外，在 C# 3.0 中编写公共属性很容易，因为您可以使用自动实现的属性，从而节省大量代码：

```
public DataType MyProperty { get; set; } 
```

将为您实现必要的支持字段和 getter/setter 代码。

我将添加一个个人说明：.NET 在这方面的行为有些懒惰。编译器可以动态地将公共字段更改为属性，从而避免了这个问题。VB6 已经为 COM 公开的类做到了这一点，我认为 VB.NET 和 C# 完全没有理由不这样做。也许编译器团队中的某个人（Jared？）可以对此发表评论。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-10T11:00:22.417

简而言之：

*   您可以控制访问（只读、
    只写、读/写）
*   您可以在设置属性时验证值（检查 null 等）
*   可以做额外的处理，比如延迟初始化
*   您可以更改底层实现。例如，一个属性现在可能由成员变量支持，但您可以将其更改为由 DB 行支持，而不会破坏任何用户代码。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-10T10:49:57.747

[杰夫·阿特伍德（Jeff Atwood）在博客上写过](https://blog.codinghorror.com/properties-vs-public-variables/)：

> 有充分的理由来制作一个琐碎的财产，正如上面所描述的：
> 
> *   反射在变量和属性上的工作方式不同，所以如果你依赖反射，使用所有属性会更容易。
> *   您不能对变量进行数据绑定。
> *   将变量更改为属性是[一项重大更改](http://blogs.msdn.com/abhinaba/archive/2006/04/11/572694.aspx)。
> 
> 很遗憾，变量和属性之间存在如此多无意义的摩擦。大多数时候他们做同样的事情。[Kevin Dente](http://weblogs.asp.net/kdente/)提出了一些新语法，可以让我们两全其美：
> 
> ```
> public property int Name; 
> ```
> 
> 但是，如果变量和属性之间的区别是一个持续存在的问题，我想知道是否需要更激进的解决方案。**我们不能完全抛弃变量来支持属性吗？**属性不做与变量完全相同的事情，但对可见性有更好的精细控制吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T10:50:44.903

将来将字段更改为属性被视为*重大更改*。字段被认为是类的实现细节，并且公开它们会破坏封装。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-10T10:54:19.980

您还可以使用属性保护写访问并允许读访问：

```
public int Version { get; private set; } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T10:52:43.073

如果你在一个封闭的环境中工作——你不开发 SDK，所有的类都在同一个项目框架中使用——没有区别。

通常的论点是“将来您可能需要对值进行一些检查，因此使用属性更容易”。我根本不买。

使用公共字段更具可读性，更少装饰，更易于使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-10T10:50:25.857

使用属性使您的代码更加面向对象。通过公开成员变量，您可以公开您的实现。

另请参阅C#'s Programming Guide 中的此[链接](http://msdn.microsoft.com/en-us/library/x9fsa0sw.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-10T10:53:06.583

是的。

考虑一个现在包含一个字符串的公共变量，您可以简单地设置它。但是，如果您决定该公共变量应该包含一个应该用字符串初始化的对象，那么您将不得不使用原始对象更改所有代码。但是，如果您使用 setter，则只需更改 setter 即可使用提供的字符串初始化对象。

# python - Pygame：Sprite 动画理论 - 需要反馈

> ID：737303
> 
> 赞同：3
> 
> 时间：2009-04-10T10:53:05.337
> 
> 标签：python, 2d, pygame, sprite

在对一些代码进行了一些调整后，我从某人那里得到了一个字符图像在其方向和上下左右输入方面移动，我把它放在一起：（希望代码不会太乱）

[角色移动代码 + IMG](http://animania1.ca/ShowFriends/dev/dirmove.rar)

Sprite 表仅纵向运行，因此基本上每个 sprite 部分都是不同的动作。现在有没有一种方法可以制作一个与当前代码一起运行的代码，以便从一组“动作”循环下来以制作动画？

例如：“向左跑”是精灵 3。那么在我们指定该列之后，是否可以循环运行动画的多少帧（比如说 4）以制作动画？

示例图片： [http ://animania1.ca/ShowFriends/dev/example.jpg](http://animania1.ca/ShowFriends/dev/example.jpg)[![替代文字](https://i.stack.imgur.com/OCcL9.jpg)](https://i.stack.imgur.com/OCcL9.jpg)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T11:35:13.440

这应该很容易。

如果将帧号记录在变量中，则可以将其与帧数取模，以获得要显示的动画帧号。

```
frame_count = 0
animation_frames = 4
while quit == False:
    # ...
    # snip
    # ...
    area = pygame.Rect(
        image_number * 100,
        (frame_count % animation_frames) * 150,
        100,
        150
    )
    display.blit(sprite, sprite_pos, area)
    pygame.display.flip()
    frame_count += 1 
```

如果不同的动作有不同的帧数，则必须在更新 image_number 时更新 animation_frames。

此外，这假设可以从*任何*帧开始播放动画。如果不是这种情况，您需要记录动作开始时的帧数，并将其从模数之前的帧数中删除：

```
 area = pygame.Rect(
        image_number * 100,
        ((frame_count - action_start_frame) % animation_frames) * 150,
        100,
        150
    ) 
```

关于您的事件处理的说明。如果你按住，比如说，向左，然后点击向右，但一直按住向左，精灵会停止移动，因为你处理的最后一个事件是一个按键事件，尽管我仍然按住左键。

如果这不是您想要的，您可以通过记录您感兴趣的键的向上/向下状态或使用[pygame.key.get_pressed](http://www.pygame.org/docs/ref/key.html#pygame.key.get_pressed)接口来绕过它。

另一方面，您的目标似乎是固定帧速率，同时根据上一帧所用时间确定您的精灵移动多远。在我看来，这可能并不理想。

2D 动作游戏通常需要以可预测的方式运行。如果某些 CPU 繁重的进程在您的计算机的后台启动并导致您的游戏不再能够每秒产生 60 帧，那么最好放慢速度，而不是让您的对象开始跳过帧之间的巨大距离。想象一下，如果这发生在像合金弹头这样的 2D 动作游戏中，你必须四处跳来躲避子弹？

这也使任何物理计算变得更加简单。你必须根据它是什么类型的游戏来做出判断。

# javascript - JavaScript：使用 innerHTML 或（大量）createElement 调用来添加复杂的 div 结构会更好吗？

> ID：737307
> 
> 赞同：25
> 
> 时间：2009-04-10T10:55:39.027
> 
> 标签：javascript, dom

我正在研究一个需要为一组约 100 个元素中的每个元素创建一次复杂的 div 块的问题。

除了内容之外，每个单独的元素都是相同的，它们看起来（在 HTML 中）如下所示：

```
<div class="class0 class1 class3">
<div class="spacer"></div>
<div id="content">content</div>
<div class="spacer"></div>
<div id="content2">content2</div>
<div class="class4">content3</div>
<div class="spacer"></div>
<div id="footer">content3</div>
</div> 
```

我可以：

`innerHTML`1)使用字符串连接创建所有元素以添加内容。

2) 使用`createElement`,`setAttribute`和`appendChild`来创建和添加每个 div。

选项 1 下载的文件稍小，但选项 2 的渲染速度似乎稍快一些。

除了性能之外，是否有充分的理由选择一条路线或另一条路线？我应该测试的任何跨浏览器问题/性能问题？

...或者我应该尝试模板和克隆方法吗？

非常感谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-10T11:51:41.777

两者都不。使用 jQuery、Prototype、Dojo 或 mooTools 之类的库，因为这两种方法都充满了麻烦：

*   [您知道 IE 表格上的 innerHTML 是只读的吗？](https://stackoverflow.com/questions/155426/why-does-ie-give-unexpected-errors-when-setting-innerhtml)
*   [您是否知道它也损坏了 select 元素](http://support.microsoft.com/kb/276228)？
*   [createElement 的问题如何？](http://webbugtrack.blogspot.com/2007/10/bug-235-createelement-is-broken-in-ie.html)

主要 javascript 库的编写者花费了大量时间并拥有完整的错误跟踪系统，以确保当您调用他们的 DOM 修改工具时它们确实可以工作。

如果你正在编写一个库来与上述工具竞争（如果你是的话，祝你好运），那么我会选择基于性能的方法，innerHTML 过去总是胜出，因为innerHTML 是一个本机方法，可以肯定的是，它将保持最快。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-08-07T22:21:59.863

取决于什么对你来说“更好”。

# 表现

从性能的角度来看，createElement+appendChild 胜出很多。看看我在比较两者时创建的[这个 jsPerf ，结果一目了然。](http://jsperf.com/innerhtml-vs-createelement-and-appendchild)

```
innerHTML: ~120 ops/sec
createElement+appendChild: ~145000 ops/sec 
```

（在我的装有 Chrome 21 的 Mac 上）

此外，innerHTML 会触发页面重排。

在带有 Chrome 39 的 Ubuntu 上[测试](http://jsperf.com/innerhtml-vs-createelement-with-span)得到类似的结果

```
innerHTML: 120000 ops/sec
createElement: 124000 ops/sec 
```

可能会进行一些优化。在带有基于 QtWebkit 的浏览器 Arora（wkhtml 也是 QtWebkit）的 Ubuntu 上，结果是

```
innerHTML: 71000 ops/sec
createElement: 282000 ops/sec 
```

似乎 createElement 平均速度更快

# 可维护性

从可维护性的角度来看，我相信字符串模板对您有很大帮助。我使用[Handlebars](http://handlebarsjs.com/)（我喜欢）或[Tim](https://github.com/premasagar/tim)（用于需要最小足迹的项目）。当您“编译”（准备）您的模板并准备好将其附加到 DOM 时，您可以使用 innerHTML 将模板字符串附加到 DOM。我避免重排的技巧是为包装器创建元素，并在该包装器元素中，将模板与innerHTML一起放置。我仍在寻找一种完全避免innerHTML 的好方法。

# 兼容性

您不必担心，这两种方法都得到广泛的浏览器的完全支持（不像 altCognito 说的那样）。您可以检查[createElement](http://www.quirksmode.org/dom/w3c_core.html#creatingelements)和[appendChild](http://www.quirksmode.org/dom/w3c_core.html#t90)的兼容性图表。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-10T12:03:02.827

altCognito 提出了一个很好的观点 - 使用库是要走的路。但如果是手工操作，我会使用选项 #2 - 使用 DOM 方法创建元素。它们有点丑，但你可以制作一个隐藏丑陋的元素工厂函数。连接 HTML 字符串也很丑陋，但更容易出现安全问题，尤其是 XSS。

不过，我绝对不会单独附加新节点。我会使用 DOM DocumentFragment。将节点附加到 documentFragment 比将它们插入实时页面要快得多。当您完成构建片段时，它会一次全部插入。

[John Resig 比我解释得更好](http://ejohn.org/blog/dom-documentfragments/)，但基本上你只是说：

```
var frag = document.createDocumentFragment();
frag.appendChild(myFirstNewElement);
frag.appendChild(mySecondNewElement);
...etc.
document.getElementById('insert_here').appendChild(frag); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T11:02:09.183

就我个人而言，我使用 innerHTML 是因为我已经习惯了这种方式，而对于类似的事情，W3C 方法给代码添加了很多混乱。

但是，这只是减少 div 数量的一种可能方法，您是否有任何理由使用间隔元素而不是仅编辑内容 div 的边距？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-10T14:55:45.347

由于您提到了模板和克隆，您可能对这个问题感兴趣：

*   [深度克隆与设置 innerHTML：什么更快？](https://stackoverflow.com/questions/676249/deep-cloning-vs-setting-of-innerhtml-whats-faster)

另一种选择是使用 DOM 包装器，例如[DOMBuilder](http://code.google.com/p/dombuilder/)：

```
DOMBuilder.apply(window);
DIV({"class": "class0 class1 class3"},
  DIV({"class": "spacer"}),
  DIV({id: "content"}, "content"),
  DIV({"class": "spacer"}),
  DIV({id: "content2"}, "content2"),
  DIV({"class": "class4"}, "content3"),
  DIV({"class": "spacer"}),
  DIV({id: "footer"}, "content3")
); 
```

就个人而言，如果每个项目都需要创建*完全相同的*结构，我会采用克隆方法。如果在创建内容将进入的结构中涉及任何逻辑，我宁愿维护类似上面的内容，也不愿摆弄字符串。如果结果证明这种方法太慢，我会退回到 innerHTML。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-10T11:11:13.450

我认为他们之间没有太多选择。在过去（IE6、FF1.5），innerHTML 更快（[benchmark](http://ajaxian.com/archives/benchmark-dom-vs-innerhtml)），但现在在大多数情况下似乎没有明显差异。

根据[Mozilla 开发人员的说法。docs](https://developer.mozilla.org/en/DOM/element.innerHTML)在某些情况下，innerHTML 行为在浏览器之间（尤其是在表格内）会有所不同，因此 createElement 将为您提供更高的一致性 - 但 innerHTML 通常更少输入。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-05-24T03:36:18.263

两者都不。使用克隆节点。

```
var div = document.createElement('div');
var millionDivs = [div];
while (millionDivs.length < 1e6) millionDivs.push(div.cloneNode()) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-10T11:12:06.320

据我所知，最快的方法是尽可能避开 DOM 编辑。这意味着，最好创建一个大字符串，然后将其放入innerHTML。但是有一点要注意：不要对大字符串做太多的操作，使用字符串数组然后将它们全部连接起来会更快。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-10T12:10:28.097

对于像这样的复杂问题，我通常使用 innerHTML 方法，因为它们 a) 更易于阅读和修改代码 b) 更方便在循环中使用。正如顶帖所说，不幸的是，他们在`<table>`、`<thead>`、`<tbody>`、`<tr>`、`<tfoot>`、`<select>`、`<pre>`元素上的 IE(6,7,8) 中失败了。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-11T00:35:38.260

> 1）将所有元素创建为带有字符串连接的innerHTML以添加内容。
> 
> 2) 使用createElement、setAttribute 和appendChild 来创建和添加每个div。

3）妥协。一次性创建所有元素作为 innerHTML（这避免了很多子节点列表操作缓慢），然后使用数据/属性访问写入每个项目上更改的内容（避免所有令人讨厌的东西，因为必须使用 HTML 转义内容） . 例如。就像是：

```
var html= (
    '<div class="item">'+
        '<div class="title">x</div>'+
        '<div class="description">x</div>'+
    '</div>'
);
var items= [
    {'id': 1, 'title': 'Potato', 'description': 'A potato'},
    {'id': 2, 'title': 'Kartoffel', 'description': 'German potato'},
    // ... 100 other items ...
];

function multiplyString(s, n) {
    return new Array(n+1).join(s);
}

var parent= document.getElementById('itemcontainer');
parent.innerHTML= multiplyString(html, items.length);
for (var i= 0; i<items.length; i++) {
    var item= items[i];
    var node= parent.childNodes[i];

    node.id= 'item'+item.id;
    node.childNodes[0].firstChild.data= item.title;
    node.childNodes[1].firstChild.data= item.description;
} 
```

也可以结合 Neall 关于 DocumentFragments 的提示。

# linq-to-sql - Linq to SQL - 多对多映射

> ID：737308
> 
> 赞同：1
> 
> 时间：2009-04-10T10:56:29.133
> 
> 标签：linq-to-sql, orm, linq-to-entities

在我的项目中，我有“Player”（PlayerID 和数据）表、“Games”表（GameID、Name），并制作了多对多表“PlayerGames”（PlayerID、GameID - 我创建了外键关系）

PlayerID 和 GameID 是其表中的主键，元组 (PlayerID,GameID) 是“PlayerGames”表中的主键

我尝试使用 Visual Studio 中的设计器将这些表映射到类中。

但是在玩家类中，我没有带有游戏列表的“游戏”属性。相反，我拥有 EntitySet 类型的 PlayerGames 属性。

我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-05T23:32:52.520

您可能还想查看[CodeSmith 的 PLINQO](http://plinqo.com/Home.ashx)。它不是免费的，但它是 Linq to Sql 的超级版本，它支持多对多关系等。

# c# - 有没有一种简单的方法可以选择在导出表单 SSRS reportviewer 控件上打开 Excel？

> ID：737311
> 
> 赞同：0
> 
> 时间：2009-04-10T10:59:09.033
> 
> 标签：c#, sql-server, winforms, excel, reporting-services

如果我们从 ReportingServices 报告网站导出到 Excel，用户可以选择打开/保存/取消。但是，winforms 的 reportviewer 控件不提供 Open 选项。用户必须保存文件，然后手动打开它。

我想知道是否其他人已经过这座桥，也许可以为我节省一些时间。我相当有信心我们可以使用一些 reportviewer 事件并添加一些办公自动化来打开 Excel。我只是希望避免这种情况。

任何想法表示赞赏。

需要注意的是，在浏览器窗口中显示 RS 网站并不是一个真正的选择，因为我们以编程方式构建数据源并且报告是本地的，而不是 RS 服务器上的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-19T12:36:44.400

我认为您最好的选择是通过代码自动保存和打开。简而言之，将报告保存到用户的临时目录，然后使用 .Net 调用启动 Excel 作为进程；将文件路径传递给保存在临时目录中的副本。

希望这可以帮助，

账单

# java - 我应该使用 DataInputStream 还是 BufferedInputStream

> ID：737318
> 
> 赞同：16
> 
> 时间：2009-04-10T11:02:16.000
> 
> 标签：java, io

我想从文本文件中读取每一行并将它们存储在 ArrayList 中（每一行都是 ArrayList 中的一个条目）。

到目前为止，我了解 BufferedInputStream 写入缓冲区，并且只有在缓冲区为空时才进行另一次读取，这最大限度地减少或至少减少了操作系统操作的数量。

我说得对吗——我说得通吗？

如果是上述情况，在什么情况下会有人想使用 DataInputStream。最后，我应该使用这两者中的哪一个以及为什么 - 或者这无关紧要。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-10T11:05:53.043

使用一个普通的`InputStream`（例如`FileInputStream`）包裹在 an 中，`InputStreamReader`然后包裹在一个`BufferedReader`- 然后调用`readLine`.`BufferedReader`

`DataInputStream`适合阅读原语，长度前缀字符串等。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-10T11:14:04.863

这两个类并不相互排斥 - 如果您的需要适合，您可以同时使用它们。

正如您所了解的，BufferedInputStream 是关于读取数据块而不是一次读取一个字节。它还提供了方便的 readLine() 方法。但是，它也用于在流中进一步查看数据，然后在需要时回滚到流的前一部分（参见 mark() 和 reset() 方法）。

DataInputStream/DataOutputStream 为读取/写入某些数据类型提供了便利的方法。例如，它有一个写入/读取 UTF 字符串的方法。如果您要自己执行此操作，则必须决定如何确定字符串的结尾（即使用终止符字节或指定字符串的长度）。

这与 BufferedInputStream 的 readLine() 不同，正如该方法听起来的那样，它只返回一行。writeUTF()/readUTF() 处理字符串——该字符串可以有任意多的行。

BufferedInputStream 适用于大多数文本处理目的。如果您正在做一些特殊的事情，例如尝试将类的字段序列化到文件中，您会希望使用 DataInput/OutputStream，因为它可以更好地控制二进制级别的数据。

希望有帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-09-18T19:26:00.170

您始终可以同时使用两者：

```
final InputStream inputStream = ...;
final BufferedInputStream bufferedInputStream =
        new BufferedInputStream(inputStream);
final DataInputStream dataInputStream =
        new DataInputStream(bufferedInputStream); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-10-30T05:58:00.727

**InputStream：**从流（网络或文件）中读取字节的基类，提供从流中读取字节和删除流末尾的能力。

**DataInputStream：**将数据直接作为原始数据类型读取。

**BufferInputStream：**从输入流中读取数据，使用缓冲区优化访问数据的速度。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-07-16T08:41:58.220

当您需要以与平台无关的方式解释由其他 Java 语言编写的文件中的原始类型时，您应该使用 DataInputStream。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-10T11:09:49.430

我会提倡使用[Jakarta Commons IO](http://commons.apache.org/io/)和[readlines()](http://commons.apache.org/io/api-1.2/org/apache/commons/io/IOUtils.html#readLines%28java.io.InputStream%29)方法（任何种类）。

它会处理缓冲/关闭等，并给你一个文本行列表。我会很高兴地使用缓冲等滚动我自己的输入流包装，但是十分之九的 Commons IO 工作正常并且足够/更简洁/不易出错等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-08-15T06:20:15.120

区别在于：

*   **DataInputStream**处理二进制数据，而BufferedReader**处理**字符数据。

*   **所有原始数据类型都可以通过DataInputStream**类中的相应方法来处理，而从**BufferedReader**类中只能读取字符串数据，需要将它们解析成各自的原始数据。

*   **DataInputStream**是过滤流的一部分，而**BufferedReader**不是。

*   **DataInputStream**消耗较少的内存空间，因为它是二进制流，而**BufferedReader**消耗更多的内存空间，因为它是字符流。

*   要处理的数据在**DataInputStream中是有限的，而要处理的字符数在****BufferedReader**中范围很广。

# asp.net-mvc - 如何在asp.net mvc中动态分配控制器名称和动作名称

> ID：737322
> 
> 赞同：0
> 
> 时间：2009-04-10T11:03:08.493
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

如何在asp.net mvc中动态分配控制器名称和动作名称

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T12:27:34.577

在 HttpApplication.Application_Start 上，您可以动态地将任何路由（控制器和动作名称）添加到 RouteTable.Routes，您可以使用此事件中可用的任何信息或从[配置文件](http://andrewmyhre.wordpress.com/2008/08/02/load-aspnet-mvc-routes-dynamically-at-runtime-from-a-repository/)或[数据库](http://www.iansuttle.com/blog/post/ASPNET-MVC-Store-Routes-in-the-Database.aspx)填充路由。
例如

```
new Route( "Admin/{actionName}/{slug}/", CreateRouteHandler())  
{  
   Defaults = new RouteValueDictionary(defaults),  
   Url = new RouteValueDictionary(dataTokens)  
} 
```

您无法更改 RouteHandler 中的操作，您可以以不同的方式处理当前的 HttpRequest，[例如](http://haacked.com/archive/2008/03/11/using-routing-with-webforms.aspx).

# vb.net - Linq 更新问题

> ID：737324
> 
> 赞同：1
> 
> 时间：2009-04-10T11:03:38.337
> 
> 标签：vb.net, linq

我在使用 Linq 更新数据库时遇到了一些问题...

```
 Public Shared Function Save(ByRef appointment As MyLinq.Appointment, ByRef db As MyEntities) As Boolean

        If appointment.id = 0 Then
            db.AddToAppointments(appointment)
        Else
            db.AttachTo("Appointments", appointment)
            'db.ApplyPropertyChanges("Appointments", appointment)
        End If

        Return db.SaveChanges() > 0

    End Function 
```

所以插入工作正常，我已经尝试了更新的两行代码但没有成功...第一行正常但没有执行更新，第二行抛出异常...

有人可以指出我缺少什么吗？

编辑：

抱歉回复晚了...我遇到了一些互联网连接问题...

我必须“让它工作”，所以现在我的更新代码正在从数据库中获取记录，更新然后执行“SaveChanges”方法。它可以工作，但我不高兴必须查询数据库来执行更新......如果你知道我如何在没有更新的情况下做到这一点，我将不胜感激:)

克里斯：这是一次不错的尝试，但我的刷新方法只允许我选择“RefreshMode.ClientWins”或“RefreshMode.StoreWins”我尝试使用 ClientWins 没有成功......

Razzie：我很抱歉，但我没有保存异常，它不再发生......它说我的记录没有关联的密钥（或类似的东西）

Jon Skeet：在 Vb.Net 中，我们必须指定参数是 ByVal 还是 ByRef，我们不能像在 C# 中那样省略

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T11:54:49.133

您拥有的代码看起来与我以前使用的代码（linq to sql）不完全一样，但看起来确实有点相似；这是实体框架吗？

我知道使用 Linq to SQL，仅将对象附加到数据上下文是不够的，您还必须确保数据上下文知道原始值是什么，以便它知道要更新哪些列。在 Linq to SQL 中可以这样实现：

```
db.Refresh(RefreshMode.KeepCurrentValues, appointment) 
```

也许环顾四周，看看您是否可以在您使用的任何框架中实现类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T16:31:14.517

ApplyPropertyChanges() 调用很重要，否则您附加的项目将被假定处于未[更改](http://msdn.microsoft.com/en-us/library/bb896248.aspx)状态。但是...为了使 ApplyPropertyChanges 正常工作，原始对象必须存在于 ObjectContext 中，这意味着要么再次查询它（我认为您现在正在这样做），要么使用您最初从中提取项目的相同对象上下文。

更多信息在这里 - [http://msdn.microsoft.com/en-us/library/system.data.objects.objectcontext.applypropertychanges.aspx](http://msdn.microsoft.com/en-us/library/system.data.objects.objectcontext.applypropertychanges.aspx)

# c# - 将网页从 MS Word 导出

> ID：737350
> 
> 赞同：0
> 
> 时间：2009-04-10T11:18:25.010
> 
> 标签：c#

是否可以将网页内容导出到 MS Word？如果是，请提供一些链接以供参考。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T11:28:33.347

^A ^C ^V ^S ?

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T14:02:16.160

从浏览器导出到任何东西都不会像网页本身那样好。

如果您只需要网站的图像，请保存图像或将页面打印为 PDF 文件。

如果您真的想编辑内容，那么**MS Word 不是正确的工具**。在 SO 中询问任何开发人员 - MS Word 生成了我们见过的最糟糕的 HTML。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T11:26:54.457

如果您在 IE 中安装了 MS Office，您可以将页面或表格导出到 Excel。但是如果你按 ctrl+A 然后你可以将它复制粘贴到 MS Word 文档中。它看起来并不完全相同，因为 .docx 不是 .html。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T11:37:12.063

在Firefox中打开并保存页面。在 ms word 中打开保存的页面。

# java - 为什么 Java main() 方法接受 String args 数组？

> ID：737358
> 
> 赞同：3
> 
> 时间：2009-04-10T11:24:33.590
> 
> 标签：java, programming-languages

既然它可能是 Java 语言中使用最广泛的方法之一，为什么它必须接受一个字符串数组并且没有它就无法工作？例如，我总是可以忍受：

```
public static void main() {} 
```

超过

```
public static void main(String[] args) {} 
```

这是否有比仅仅能够接受命令行参数更高的目的，特别是因为绝大多数 Java 程序都是 GUI 驱动的并且不需要通过命令行接收参数？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-10T11:30:17.617

我同意它可以更灵活。例如，在 C# 中，所有这些都是可接受的入口点：

```
static void Main()
static void Main(string[] args)
static int Main()
static int Main(string[] args) 
```

返回的版本`int`使用返回值作为进程的退出代码。如果您不关心接收任何参数，则可以使用不带任何参数的版本之一。程序启动时给出的任何参数都将被忽略。

所以是的，它*可以*更灵活——但它从来没有让我觉得它是 Java 中的一个重大问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-10T11:28:51.210

即使是 gui 驱动的 java 应用程序也会从一些 main 方法开始。“更高的目的”从来都不是接受命令行参数。

目的只是接受论点。时期。每当您启动任何程序而不仅仅是 Java 时，您总是需要一些语法来传递参数

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-10T14:13:36.803

程序**总是**采用命令行参数。由程序员决定它们是否用于任何事情。

因此，在没有字符串数组的情况下实现 main 会导致更复杂的启动逻辑和潜在的混乱和错误行为，因为不少写单个参数声明（在整个程序中！）

考虑到 Java 的整体冗长性以及对 Eclipse 等 IDE 中样板代码的通用模板的支持，我看不出真正的问题在哪里。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T11:27:41.070

“这有更高的目的吗（..）”

是的：遗产。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-10T11:26:21.760

就需要做什么而言，“绝大多数”程序所做的并没有太大的区别。仍然有很多命令行程序是由命令行参数驱动的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-10T11:28:33.393

许多 GUI 程序提供了接受命令行开关以控制它们在启动时的行为的工具。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-10T11:30:21.267

我想这是因为许多 Java 程序至少会采用一些参数。与 C 一样（Java 的语法灵感，如果没有别的），Java 认为将这些作为参数提供给`main`.

甚至一个 GUI 程序也会经常使用命令行参数。仅仅因为它启动的 shell 通常不要求这些参数（默认情况下），并不意味着它们不受支持。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-10T11:29:19.210

还有许多通过命令行接收 args 的 java 程序。想想 javac、ant、maven 等

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-07T08:57:12.090

Java 应用程序可以从命令行接受任意数量的参数。这允许用户在启动应用程序时指定配置信息。例如，我们可以从命令行本身传递用户名、密码。

```
class Test {

    static void connectDB(String username, String password) {       
        System.out.print(String.format("Username: %s, Password: %s", username, password));
        // code to connect DB
    }

    public static void main(String args[]) {
        connectDB(args[0], args[1]);
    }
} 
```

现在使用编译程序`javac Test.java` 并使用执行 `java Test rootuser Test1234`

输出将是：

```
Username: rootuser, Password: Test1234 
```

所以，我们可以使用 commandline-argument 这种目的。

# caching - 用于设置音频文件缓存的最佳技术

> ID：737362
> 
> 赞同：1
> 
> 时间：2009-04-10T11:26:58.500
> 
> 标签：caching, audio, proxy, squid

我们有一个客户端应用程序，允许用户下载全长 192Kb/s MP3 音频文件。因为文件作为企业存储在我们外部，所以我们需要能够：

1）将文件从外部位置复制到本地服务器缓存中

2）将该文件复制到请求它的客户端

显然，对同一文件的进一步请求将来自缓存，并且不需要转到外部。

现在，我们已经有一个执行此操作的当前系统（使用 Squid 缓存），但问题是 2 仅在 1 完全完成后执行。这意味着，如果一个 10 分钟长的 192kb/s 曲目需要 75 秒从外部位置复制到缓存中，则客户端的 HTTP 超时时间大约为 60 秒！这不符合我们的要求。

似乎我们需要的是一个可以在客户端从外部位置获取数据时传输到客户端的缓存。我的问题是：

1) 这可以用 Squid Cache 来完成吗（这是传统的现任者，而不是我的选择）？

2）如果不是，哪种技术最适合这种情况（成本不是真正的问题）？

如果有任何不清楚的地方，请告诉我！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T12:21:12.190

这是我不久前写的一个 asp.net 处理程序，用于代理来自另一台服务器的一些内容。写入文件并第二次使用该文件并不难。在循环中刷新响应将使其在下载时交付：

```
namespace bla.com
{
    /// <summary>
    /// Summary description for $codebehindclassname$
    /// </summary>
    [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    public class Proxy : IHttpHandler
    {
        private static Regex urlRegex=new Regex(@"http://some_regex_here_to_prevent_abuse_of_proxy.mp3",RegexOptions.Compiled);
        public void ProcessRequest(HttpContext context)
        {
            var targetUrl = context.Request.QueryString["url"];
            MatchCollection matches = urlRegex.Matches(targetUrl);

            if (matches.Count != 1 || matches[0].Value != targetUrl)
            {
                context.Response.StatusCode = 403;
                context.Response.ContentType = "text/plain";
                context.Response.Write("Forbidden");
                return;
            }

            HttpWebRequest req = (HttpWebRequest) WebRequest.Create(targetUrl);
            Stream responseStream;
            using (HttpWebResponse response = (HttpWebResponse)req.GetResponse())
            {
                responseStream = response.GetResponseStream();
                context.Response.ContentType = response.ContentType;

                byte[] buffer = new byte[4096];
                int amt;
                while ((amt = responseStream.Read(buffer, 0, 4096))>0)
                {

                    context.Response.OutputStream.Write(buffer, 0, amt);
                    Debug.WriteLine(amt);
                } 
                responseStream.Close();
                response.Close();
            }
            context.Response.Flush();
        }

        public bool IsReusable
        {
            get
            {
                return false;
            }
        }
    }
} 
```

# c# - 如何查找表之间的关系

> ID：737378
> 
> 赞同：0
> 
> 时间：2009-04-10T11:34:32.520
> 
> 标签：c#, ms-access

考虑我有使用 MS Access 创建的“n”个表。

现在我需要找到表之间的关系。即表格如何相互关联，因为在表格中所做的更改将反映在其他表格中。？

有没有用c#找到这个

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T11:42:55.527

我不知道如何从 C# 中找到。但是在ms-access中我们可以看到很容易找到。

打开访问数据库文件。并单击菜单（工具-> 关系）。您可以查看当前的关系船。

感谢和问候哈拉纳德

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T11:40:37.700

谷歌搜索`MSysObjects`（例如，参见[这个](http://www.perfectparadigm.com/tip001.html)）或使用[GetSchema](http://aspalliance.com/542) on `OleDbConnection`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T19:06:04.370

I don't believe you need to automate Access to do this. All that's needed, I think, is ADOX. This article shows how to use ADOX to copy relationships in VBA:

[ACC2002: How to use ADOX to Import Relationships](http://support.microsoft.com/kb/304322/EN-US/)

Relationships are defined under the ADOX.Table.Keys property. I can't help you convert that to C#, but that code shows you what parts of the ADOX object model you need to use for this and ought to help you figure it out, I hope.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T11:38:10.767

请参阅：[如何使用 Visual C# 自动化 Microsoft Access](http://support.microsoft.com/kb/317114)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-20T07:36:23.703

```
DataTable schemaTable = 
    oledbConnection.GetOleDbSchemaTable(OleDbSchemaGuid.Foreign_Keys,
        new object[] {null, null, "OneTableName"}); 
```

或者

```
DataTable schemaTable = 
    oledbConnection.GetOleDbSchemaTable(OleDbSchemaGuid.Foreign_Keys,
        new object[] {null, null, "OneTableName", null, null, "OtherTableName"}); 
```

# sql - 使用按增量变量分组来计算 SQL 语句中的行数

> ID：737380
> 
> 赞同：0
> 
> 时间：2009-04-10T11:35:16.483
> 
> 标签：sql

我试图从语音通话记录中获取分析结果的表。每个调用（一行）的持续时间以秒为单位（只是 int 值，而不是 datetime）。我正在尝试获取按 15 秒跨度分组的记录数，如下所示：

```
+-------------------+
|Period | Count     |
+-------------------+
| 0-15  | 213421    |
|15-30  | 231123    |
|30-45  | 1234      |
+-------------------+ 
```

周期开始为 0，结束为 86400。

我尝试了一些组合，为 start 和 end 设置变量，然后将它们增加 15，但我不是很成功，我不明白出了什么问题。

请帮忙。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T12:06:13.210

以下查询符合您的需求：

```
SELECT
  (duration - duration % 15),
  COUNT(*)
FROM
  call
GROUP BY
  (duration - duration % 15)
ORDER BY
  1; 
```

您还可以添加一些字符串格式，以防您需要完全按照您描述的输出：

```
SELECT
  (duration - duration % 15)::text || '-' || (duration - duration % 15 + 15)::text,
  COUNT(*)
FROM
  call
GROUP BY
  (duration - duration % 15)
ORDER BY
  1; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T11:41:14.610

在`MySQL`：

```
SELECT  CONCAT(span * 15, '-', span * 15 + 15), COUNT(*) AS cnt
FROM    (
        SELECT  v.*, FLOOR(period / 15) AS span
        FROM    voice_calls v
        ) q
GROUP BY
        span 
```

**更新：**

您发布的解决方案将起作用，假设总是有超过 5760 行。

但是您最好创建一个虚拟行集`5760`并将其用于`OUTER JOIN`：

```
CREATE TABLE spans (span INT NOT NULL PRIMARY KEY);

INSERT
INTO    spans
VALUES  (0),
        (1),
        ...
        (5759)

SELECT  span * 15, COUNT(*)
FROM    spans
LEFT JOIN
        calls
ON      call.duration >= span * 15
        AND call.duration < span * 15 + 15
GROUP BY
        span 
```

它将更加高效和理智，因为它既不会下溢（如果少于中的`5760`行`calls`），也不会在有数百万行的情况下花费太多时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T11:41:37.950

我认为这样的查询应该有效；但是，您必须自己在显示器上旋转结果（例如，此查询水平获取结果，您必须垂直显示它们）：

```
SELECT
    SUM(CASE WHEN CallLength BETWEEN 0 AND 15 THEN CallLength ELSE 0 END) AS ZeroToFifteen,
    SUM(CASE WHEN CallLength BETWEEN 16 AND 30 THEN CallLength ELSE 0 END) AS FifteenToThirty
FROM CallTable 
```

但是在重新阅读问题之后，将案例陈述提高到 86400 可能是不可能的......哦，好吧:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T11:57:53.667

这终于奏效了：

```
SET @a:=-15, @b:=0;
SELECT  t.start_time, t.end_time, count(c.duration)
FROM    calls c,
        (
        SELECT  (@a:=@a+15) as start_time, (@b:=@b+15) as end_time 
        FROM    `calls`  
        GROUP BY
                 cdr_id
        ) as t
WHERE   c.duration BETWEEN t.start_time and t.end_time
GROUP BY
        t.start_time, t.end_time 
```

# python - 如何在不安装的情况下将 Python 扩展模块打包为可加载的蛋？

> ID：737383
> 
> 赞同：0
> 
> 时间：2009-04-10T11:37:52.920
> 
> 标签：python, setuptools, egg, waf, build-tools

我正在修改我们的构建脚本以基于[出色的 Waf 工具](http://code.google.com/p/waf/)（我确实使用 SCons 很长时间了，但它太慢了） *。*

无论如何，我遇到了以下情况，我找不到解决办法：

*   我有一个依赖于许多先前构建的 egg 文件的产品。
*   我正在尝试使用[PyInstaller](http://www.pyinstaller.org/)打包产品作为构建过程的一部分。
*   我首先构建依赖项。
*   接下来我要运行 PyInstaller 来打包依赖于我构建的鸡蛋的产品。我需要 PyInstaller 能够在打包过程中加载这些 egg 文件。

这听起来很简单：您计算出`PYTHONPATH`应该是什么，构建`sys.environ`正确设置变量的副本，然后使用`subprocess.Popen`传递先前配置的环境作为 env 参数来调用 PyInstaller 脚本。

问题是，`PYTHONPATH`如果您添加的鸡蛋是打包为 zipsafe 的扩展模块，那么单独设置似乎是不够的。在这种情况下，事实证明嵌入式库无法导入。

如果我解压缩鸡蛋（将目录重命名为 .egg），我可以在没有进一步设置的情况下导入它们，但在这种情况下这不是我想要的。

我还可以通过执行以下操作从子外壳中导入鸡蛋：

*   设置`PYTHONPATH`为包含您要导入的鸡蛋的目录（不是鸡蛋本身的路径）
*   加载一个 python shell 并使用`pkg_resources.require`它来定位鸡蛋。

完成此操作后，鸡蛋将正常加载。同样，这不切实际，因为我需要能够以准备好从关闭导入这些鸡蛋的方式运行我的 python shell。

肮脏的选择是在调用真正的目标脚本之前输出一个执行上述操作的包装脚本，但这似乎是错误的做法：必须有更好的方法来做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T12:32:33.910

呵呵，我觉得这是我的错。问题似乎是`zipsafe`扩展包的 setup.py 中的标志设置为 False，这似乎完全影响了您对其进行处理的能力。

现在我已将其设置为 True，我可以导入 egg 文件，只需将每个文件添加到`PYTHONPATH`.

我希望其他人有一天会发现这个答案有用！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T18:32:32.547

尽管您有解决方案，但您始终可以尝试“virtualenv”，它会创建一个 python 虚拟环境，您可以在其中安装和测试 Python 包，而不会弄乱核心系统 python：

[http://pypi.python.org/pypi/virtualenv](http://pypi.python.org/pypi/virtualenv)

# php - PHP 最简单的表单验证库？

> ID：737385
> 
> 赞同：34
> 
> 时间：2009-04-10T11:39:47.983
> 
> 标签：php, validation, crud

我需要一个简单的 php 库，可以用来轻松地将规则和字段名称传递给，然后可以轻松地执行验证。还应该有一种简单的方法来检索错误。

有什么建议么？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-04-10T18:51:18.167

我自己编写了一个简单的类，将我多年来收集的一些正则表达式与 PHP 的 sanatize 和 filter 函数结合起来。

```
<?
/**
 * Pork Formvalidator. validates fields by regexes and can sanatize them. Uses PHP filter_var built-in functions and extra regexes 
 * @package pork
 */

/**
 * Pork.FormValidator
 * Validates arrays or properties by setting up simple arrays
 * 
 * @package pork
 * @author SchizoDuckie
 * @copyright SchizoDuckie 2009
 * @version 1.0
 * @access public
 */
class FormValidator
{
    public static $regexes = Array(
            'date' => "^[0-9]{4}[-/][0-9]{1,2}[-/][0-9]{1,2}\$",
            'amount' => "^[-]?[0-9]+\$",
            'number' => "^[-]?[0-9,]+\$",
            'alfanum' => "^[0-9a-zA-Z ,.-_\\s\?\!]+\$",
            'not_empty' => "[a-z0-9A-Z]+",
            'words' => "^[A-Za-z]+[A-Za-z \\s]*\$",
            'phone' => "^[0-9]{10,11}\$",
            'zipcode' => "^[1-9][0-9]{3}[a-zA-Z]{2}\$",
            'plate' => "^([0-9a-zA-Z]{2}[-]){2}[0-9a-zA-Z]{2}\$",
            'price' => "^[0-9.,]*(([.,][-])|([.,][0-9]{2}))?\$",
            '2digitopt' => "^\d+(\,\d{2})?\$",
            '2digitforce' => "^\d+\,\d\d\$",
            'anything' => "^[\d\D]{1,}\$"
    );
    private $validations, $sanatations, $mandatories, $errors, $corrects, $fields;

    public function __construct($validations=array(), $mandatories = array(), $sanatations = array())
    {
        $this->validations = $validations;
        $this->sanatations = $sanatations;
        $this->mandatories = $mandatories;
        $this->errors = array();
        $this->corrects = array();
    }

    /**
     * Validates an array of items (if needed) and returns true or false
     *
     */
    public function validate($items)
    {
        $this->fields = $items;
        $havefailures = false;
        foreach($items as $key=>$val)
        {
            if((strlen($val) == 0 || array_search($key, $this->validations) === false) && array_search($key, $this->mandatories) === false) 
            {
                $this->corrects[] = $key;
                continue;
            }
            $result = self::validateItem($val, $this->validations[$key]);
            if($result === false) {
                $havefailures = true;
                $this->addError($key, $this->validations[$key]);
            }
            else
            {
                $this->corrects[] = $key;
            }
        }

        return(!$havefailures);
    }

    /**
     *
     *  Adds unvalidated class to thos elements that are not validated. Removes them from classes that are.
     */
    public function getScript() {
        if(!empty($this->errors))
        {
            $errors = array();
            foreach($this->errors as $key=>$val) { $errors[] = "'INPUT[name={$key}]'"; }

            $output = '$$('.implode(',', $errors).').addClass("unvalidated");'; 
            $output .= "alert('there are errors in the form');"; // or your nice validation here
        }
        if(!empty($this->corrects))
        {
            $corrects = array();
            foreach($this->corrects as $key) { $corrects[] = "'INPUT[name={$key}]'"; }
            $output .= '$$('.implode(',', $corrects).').removeClass("unvalidated");';   
        }
        $output = "<script type='text/javascript'>{$output} </script>";
        return($output);
    }

    /**
     *
     * Sanatizes an array of items according to the $this->sanatations
     * sanatations will be standard of type string, but can also be specified.
     * For ease of use, this syntax is accepted:
     * $sanatations = array('fieldname', 'otherfieldname'=>'float');
     */
    public function sanatize($items)
    {
        foreach($items as $key=>$val)
        {
            if(array_search($key, $this->sanatations) === false && !array_key_exists($key, $this->sanatations)) continue;
            $items[$key] = self::sanatizeItem($val, $this->validations[$key]);
        }
        return($items);
    }

    /**
     *
     * Adds an error to the errors array.
     */ 
    private function addError($field, $type='string')
    {
        $this->errors[$field] = $type;
    }

    /**
     *
     * Sanatize a single var according to $type.
     * Allows for static calling to allow simple sanatization
     */
    public static function sanatizeItem($var, $type)
    {
        $flags = NULL;
        switch($type)
        {
            case 'url':
                $filter = FILTER_SANITIZE_URL;
            break;
            case 'int':
                $filter = FILTER_SANITIZE_NUMBER_INT;
            break;
            case 'float':
                $filter = FILTER_SANITIZE_NUMBER_FLOAT;
                $flags = FILTER_FLAG_ALLOW_FRACTION | FILTER_FLAG_ALLOW_THOUSAND;
            break;
            case 'email':
                $var = substr($var, 0, 254);
                $filter = FILTER_SANITIZE_EMAIL;
            break;
            case 'string':
            default:
                $filter = FILTER_SANITIZE_STRING;
                $flags = FILTER_FLAG_NO_ENCODE_QUOTES;
            break;

        }
        $output = filter_var($var, $filter, $flags);        
        return($output);
    }

    /** 
     *
     * Validates a single var according to $type.
     * Allows for static calling to allow simple validation.
     *
     */
    public static function validateItem($var, $type)
    {
        if(array_key_exists($type, self::$regexes))
        {
            $returnval =  filter_var($var, FILTER_VALIDATE_REGEXP, array("options"=> array("regexp"=>'!'.self::$regexes[$type].'!i'))) !== false;
            return($returnval);
        }
        $filter = false;
        switch($type)
        {
            case 'email':
                $var = substr($var, 0, 254);
                $filter = FILTER_VALIDATE_EMAIL;    
            break;
            case 'int':
                $filter = FILTER_VALIDATE_INT;
            break;
            case 'boolean':
                $filter = FILTER_VALIDATE_BOOLEAN;
            break;
            case 'ip':
                $filter = FILTER_VALIDATE_IP;
            break;
            case 'url':
                $filter = FILTER_VALIDATE_URL;
            break;
        }
        return ($filter === false) ? false : filter_var($var, $filter) !== false ? true : false;
    }       

} 
```

现在，对于您在此处看到的某些 javascript，这需要 mootools，但您可以轻松地将其更改为您最喜欢的 javascript 框架。它所做的只是查找元素，并向其添加“未验证”的 CSS 类。

用法就像我一直想要的一样简单：

例子：

```
$validations = array(
    'name' => 'anything',
    'email' => 'email',
    'alias' => 'anything',
    'pwd'=>'anything',
    'gsm' => 'phone',
    'birthdate' => 'date');
$required = array('name', 'email', 'alias', 'pwd');
$sanatize = array('alias');

$validator = new FormValidator($validations, $required, $sanatize);

if($validator->validate($_POST))
{
    $_POST = $validator->sanatize($_POST);
    // now do your saving, $_POST has been sanatized.
    die($validator->getScript()."<script type='text/javascript'>alert('saved changes');</script>");
}
else
{
    die($validator->getScript());
} 
```

仅验证一个元素：

```
$validated = new FormValidator()->validate('blah@bla.', 'email'); 
```

只净化一个元素：

```
$sanatized = new FormValidator()->sanatize('<b>blah</b>', 'string'); 
```

这个类最酷的地方在于，您可以发送带有 ajax 或 iframe 目标的表单并执行生成的脚本。无需刷新页面或将相同的表单数据重新发送回浏览器 :) 此外，如果脚本需要更改，没有难以分析的过度设计框架，只需按照您想要的方式进行更改即可 :)

哦，是的，随意在任何你想要的地方使用它。没有许可证

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-07-29T17:49:57.113

上面 SchizoDuckie 的回答很棒。在获得作者许可的情况下，我在我正在从事的项目中使用了他的代码。我使用此代码时遇到的一个问题是，如果未提交必填字段，则不会注册错误。我已经修改了代码以涵盖这种情况。我还删除了生成 HTML 和 javascript 的代码，因为我的项目需要根据 MVC 模式将 UI 与逻辑分离。修改后的代码只返回 JSON 编码的结果。我在这里重新发布修改后的代码，以防它对其他人有用。

```
<?
/**
* Pork Formvalidator. validates fields by regexes and can sanatize them. Uses PHP       filter_var built-in functions and extra regexes 
* @package pork
*/

/**
* Pork.FormValidator
* Validates arrays or properties by setting up simple arrays
* 
* @package pork
* @author SchizoDuckie
* @copyright SchizoDuckie 2009
* @version 1.0
* @access public
*/
class FormValidator
{
    public static $regexes = Array(
            'date' => "^[0-9]{4}[-/][0-9]{1,2}[-/][0-9]{1,2}\$",
            'amount' => "^[-]?[0-9]+\$",
            'number' => "^[-]?[0-9,]+\$",
            'alfanum' => "^[0-9a-zA-Z ,.-_\\s\?\!]+\$",
            'not_empty' => "[a-z0-9A-Z]+",
            'words' => "^[A-Za-z]+[A-Za-z \\s]*\$",
            'phone' => "^[0-9]{10,11}\$",
            'zipcode' => "^[1-9][0-9]{3}[a-zA-Z]{2}\$",
            'plate' => "^([0-9a-zA-Z]{2}[-]){2}[0-9a-zA-Z]{2}\$",
            'price' => "^[0-9.,]*(([.,][-])|([.,][0-9]{2}))?\$",
            '2digitopt' => "^\d+(\,\d{2})?\$",
            '2digitforce' => "^\d+\,\d\d\$",
            'anything' => "^[\d\D]{1,}\$",
            'username' => "^[\w]{3,32}\$"
);

private $validations, $sanatations, $mandatories, $equal, $errors, $corrects, $fields;

public function __construct($validations=array(), $mandatories = array(), $sanatations = array(), $equal=array())
{
    $this->validations = $validations;
    $this->sanatations = $sanatations;
    $this->mandatories = $mandatories;
    $this->equal = $equal;
    $this->errors = array();
    $this->corrects = array();
}

/**
 * Validates an array of items (if needed) and returns true or false
 *
 * JP modofied this function so that it checks fields even if they are not submitted.
 * for example the original code did not check for a mandatory field if it was not submitted.
 * Also the types of non mandatory fields were not checked.
 */
public function validate($items)
{
    $this->fields = $items;
    $havefailures = false;

    //Check for mandatories
    foreach($this->mandatories as $key=>$val)
    {
        if(!array_key_exists($val,$items))
        {
            $havefailures = true;
            $this->addError($val);
        }
    }

    //Check for equal fields
    foreach($this->equal as $key=>$val)
    {
        //check that the equals field exists
        if(!array_key_exists($key,$items))
        {
            $havefailures = true;
            $this->addError($val);
        }

        //check that the field it's supposed to equal exists
        if(!array_key_exists($val,$items))
        {
            $havefailures = true;
            $this->addError($val);
        }

        //Check that the two fields are equal
        if($items[$key] != $items[$val])
        {
            $havefailures = true;
            $this->addError($key);
        }
    }

    foreach($this->validations as $key=>$val)
    {
            //An empty value or one that is not in the list of validations or one that is not in our list of mandatories
            if(!array_key_exists($key,$items)) 
            {
                    $this->addError($key, $val);
                    continue;
            }

            $result = self::validateItem($items[$key], $val);

            if($result === false) {
                    $havefailures = true;
                    $this->addError($key, $val);
            }
            else
            {
                    $this->corrects[] = $key;
            }
    }

    return(!$havefailures);
}

/* JP
 * Returns a JSON encoded array containing the names of fields with errors and those without.
 */
public function getJSON() {

    $errors = array();

    $correct = array();

    if(!empty($this->errors))
    {            
        foreach($this->errors as $key=>$val) { $errors[$key] = $val; }            
    }

    if(!empty($this->corrects))
    {
        foreach($this->corrects as $key=>$val) { $correct[$key] = $val; }                
    }

    $output = array('errors' => $errors, 'correct' => $correct);

    return json_encode($output);
}

/**
 *
 * Sanatizes an array of items according to the $this->sanatations
 * sanatations will be standard of type string, but can also be specified.
 * For ease of use, this syntax is accepted:
 * $sanatations = array('fieldname', 'otherfieldname'=>'float');
 */
public function sanatize($items)
{
    foreach($items as $key=>$val)
    {
            if(array_search($key, $this->sanatations) === false && !array_key_exists($key, $this->sanatations)) continue;
            $items[$key] = self::sanatizeItem($val, $this->validations[$key]);
    }
    return($items);
}

/**
 *
 * Adds an error to the errors array.
 */ 
private function addError($field, $type='string')
{
    $this->errors[$field] = $type;
}

/**
 *
 * Sanatize a single var according to $type.
 * Allows for static calling to allow simple sanatization
 */
public static function sanatizeItem($var, $type)
{
    $flags = NULL;
    switch($type)
    {
            case 'url':
                    $filter = FILTER_SANITIZE_URL;
            break;
            case 'int':
                    $filter = FILTER_SANITIZE_NUMBER_INT;
            break;
            case 'float':
                    $filter = FILTER_SANITIZE_NUMBER_FLOAT;
                    $flags = FILTER_FLAG_ALLOW_FRACTION | FILTER_FLAG_ALLOW_THOUSAND;
            break;
            case 'email':
                    $var = substr($var, 0, 254);
                    $filter = FILTER_SANITIZE_EMAIL;
            break;
            case 'string':
            default:
                    $filter = FILTER_SANITIZE_STRING;
                    $flags = FILTER_FLAG_NO_ENCODE_QUOTES;
            break;

    }
    $output = filter_var($var, $filter, $flags);            
    return($output);
}

/** 
 *
 * Validates a single var according to $type.
 * Allows for static calling to allow simple validation.
 *
 */
public static function validateItem($var, $type)
{
    if(array_key_exists($type, self::$regexes))
    {
            $returnval =  filter_var($var, FILTER_VALIDATE_REGEXP, array("options"=> array("regexp"=>'!'.self::$regexes[$type].'!i'))) !== false;
            return($returnval);
    }
    $filter = false;
    switch($type)
    {
            case 'email':
                    $var = substr($var, 0, 254);
                    $filter = FILTER_VALIDATE_EMAIL;        
            break;
            case 'int':
                    $filter = FILTER_VALIDATE_INT;
            break;
            case 'boolean':
                    $filter = FILTER_VALIDATE_BOOLEAN;
            break;
            case 'ip':
                    $filter = FILTER_VALIDATE_IP;
            break;
            case 'url':
                    $filter = FILTER_VALIDATE_URL;
            break;
    }
    return ($filter === false) ? false : filter_var($var, $filter) !== false ? true :     false;
}           
}
?> 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-10T11:51:04.820

如果您想自己编写一些程序并且您拥有 PHP 5.2.0 或更高版本。然后您可以查看[过滤器功能。](http://is2.php.net/manual/en/function.filter-var.php)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-05-02T09:47:42.357

github上也有这个库：[https ://github.com/blackbelt/php-validation](https://github.com/blackbelt/php-validation)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-10T12:28:33.577

[Zend Forms](https://docs.zendframework.com/zend-form/quick-start/#validating-forms)可以在没有整个 Zend 框架的情况下使用

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-10T12:05:27.050

Code Igniter 框架中包含一个，请看[这里](https://www.codeigniter.com/user_guide/libraries/form_validation.html)

我建议开始使用其中一个 PHP 框架；）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-10T12:00:10.947

您有一个名为**symfony forms**的 symfony 框架的一部分，它可以与整个框架分开使用。

查看[框架文档](http://www.symfony-project.org/forms/1_2/en/)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-03-28T10:45:39.720

这个 phpro.org 验证类看起来非常适合简单的数据验证：

[https://phpro.org/classes/Validation-Class.html](https://phpro.org/classes/Validation-Class.html)

它支持长度等规则。

# sql-server - 如何控制更新查询执行的顺序？

> ID：737401
> 
> 赞同：0
> 
> 时间：2009-04-10T11:51:17.100
> 
> 标签：sql-server, tsql

我在 MS SQL 2005 中有一个表。并且想做：

```
update Table
set ID = ID + 1
where ID > 5 
```

问题是 ID 是主键，当我这样做时出现错误，因为当此查询涉及 ID 为 8 的行时，它会尝试将值更改为 9，但此表中有旧行的值为 9 和存在违反约束。

因此，我想控制更新查询以确保它按降序执行。

所以没有 ID = 1,2,3,4 等等，而是 ID = 98574（或其他），然后是 98573、98572 等等。在这种情况下，不会违反约束。

那么如何控制更新执行的顺序呢？有没有一种简单的方法来以编程方式完成这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T12:07:10.773

`Transact SQL`将约束检查推迟到语句完成。

这就是为什么这个查询：

```
UPDATE  mytable
SET     id = CASE WHEN id = 7 THEN 8 ELSE 7 END
WHERE   id IN (7, 8) 
```

不会失败，尽管它交换`id`'s`7`和`8`.

查询完成后似乎留下了一些重复的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T11:55:19.337

试试这个：

```
update Table
set ID = ID * 100000 + 1
where ID > 5

update Table
set ID = ID / 100000
where ID > 500000 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T12:04:21.497

别忘了括号...

更新表集 ID = (ID * 100000) + 1 其中 ID > 5

如果此处的 ID 太大，您始终可以使用循环。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T15:31:34.137

就我个人而言，我不会以这种方式更新 id 字段，我会创建一个从旧表到新表的工作表。它存储两个 id，然后所有更新都由此完成。如果您没有使用级联删除（这可能会偶然锁定您的表很长时间），那么从子表开始并进行处理，否则从 pk 表开始。除非您处于单用户模式，否则不要这样做，或者如果其他用户正在更改内容而表彼此不一致，您可能会遇到一些令人讨厌的数据完整性问题。

PK 没有什么可以用改变来愚弄的，如果可能的话，不应该改变。

在以这种方式对生产数据进行任何更改之前，请确保进行完整备份。如果您无法恢复，搞砸这件事可能会让您失去工作。

# ssis - 检查数据库恢复是否完成

> ID：737407
> 
> 赞同：1
> 
> 时间：2009-04-10T11:55:56.027
> 
> 标签：ssis, restore

我们得到了由另一个来源管理的每晚备份/恢复。我们需要在恢复后立即执行一个 SSIS 包。

目前，所有流程都是通过估计每一步可以花费多长时间来及时执行的，这很容易出错。

问题是，我如何检查恢复是否完成并执行 SSIS 包？

**注意：**使用 SSIS 无法执行备份/恢复。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T12:29:35.243

好吧，我不知道一个完美的解决方案，但您可以尝试以下方法。

```
SELECT DATABASEPROPERTYEX ('DB_NAME', 'STATUS') 
```

这将为您提供数据库的状态，如果仍在恢复，则为“正在恢复”。恢复开始后，您可以在设置为运行的作业代理中创建重复作业。当数据库完成恢复后，状态将为“在线”，您可以从 SQL 执行 SSIS 包，作业结束。

我不知道一个优雅的解决方案，但希望它有所帮助。

# c# - StreamReader 消耗的字节数

> ID：737408
> 
> 赞同：9
> 
> 时间：2009-04-10T11:56:28.070
> 
> 标签：c#, .net

有没有办法知道 StreamReader 使用了多少字节流？

我有一个项目，我们需要读取一个文件，该文件有一个文本标题，后跟二进制数据的开头。我最初尝试读取这个文件是这样的：

```
private int _dataOffset;
void ReadHeader(string path) 
{
    using (FileStream stream = File.OpenRead(path)) 
    {
        StreamReader textReader = new StreamReader(stream);

        do 
        {
            string line = textReader.ReadLine();
            handleHeaderLine(line);
        } while(line != "DATA") // Yes, they used "DATA" to mark the end of the header

        _dataOffset = stream.Position;
    }
}

private byte[] ReadDataFrame(string path, int frameNum) 
{
    using (FileStream stream = File.OpenRead(path)) 
    {
        stream.Seek(_dataOffset + frameNum * cbFrame, SeekOrigin.Begin);

        byte[] data = new byte[cbFrame];
        stream.Read(data, 0, cbFrame);

        return data;
    }
    return null;
} 
```

问题是，当我设置`_dataOffset`为时`stream.Position`，我得到了 StreamReader 已读取到的位置，而不是标题的末尾。我一想到这是有道理的，但我仍然需要能够知道标头的结尾在哪里，而且我不确定是否有办法做到这一点并且仍然可以利用 StreamReader。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T12:13:45.640

您可以通过多种方式找出`StreamReader`实际返回的字节数（而不是从流中读取），恐怕它们都不太简单。

1.  获取结果`textReader.CurrentEncoding.GetByteCount(totalLengthOfAllTextRead)`然后在流中寻找到这个位置。
2.  使用一些反射技巧来检索与内部缓冲区中当前字节位置相对应的对象的私有变量的值`StreamReader`（与流不同 - 通常在后面，但当然不超过等于）。从 .NET Reflector 判断，这个变量似乎被命名为`bytePos`.
3.  根本不用费心使用 a`StreamReader`而是实现构建在`Stream`or之上的自定义 ReadLine 函数`BinaryReader`（`BinaryReader`保证永远不会比您要求的更远）。此自定义函数必须逐个字符地从流中读取，因此您实际上必须使用低级`Decoder`对象（除非编码是 ASCII/ANSI，在这种情况下，由于单字节编码，事情会更简单一些）。

选项 1 将是我想象中效率最低的（因为您正在有效地重新编码刚刚解码的文本），选项 3 最难实现，尽管可能是最优雅的。我可能会建议不要使用丑陋的反射黑客（选项 2），即使它看起来很诱人，因为它是最直接的解决方案并且只需要几行代码。（老实说，`StreamReader`该类确实应该通过公共属性公开这个变量，但可惜它没有。）所以最后，这取决于你，但方法 1 或 3 应该足够好地完成这项工作。 .

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T13:43:13.647

如果您需要计算字节数，我会使用 BinaryReader。您可以根据需要获取结果并对其进行转换，但我发现其当前位置的想法更可靠（因为它以二进制形式读取，因此不受字符集问题的影响）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T12:10:14.527

所以数据是utf8（StreamReader的默认编码）。这是一种多字节编码，因此不建议使用 IndexOf。你可以：

```
Encoding.UTF8.GetByteCount(string) 
```

到目前为止，在您的数据上，为缺少的行结尾添加 1 或 2 个字节。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T15:35:44.237

换行符很容易识别，无需先解码流（除了一些很少用于文本文件的编码，如 EBCDIC、UTF-16、UTF-32），因此您可以将每一行读取为字节，然后解码整行：

```
using (FileStream stream = File.OpenRead(path)) {
   List<byte> buffer = new List<byte>();
   bool hasCr = false;
   bool done = false;
   while (!done) {
      int b = stream.ReadByte();
      if (b == -1) throw new IOException("End of file reached in header.");
      if (b == 13) {
         hasCr = true;
      } else if (b == 10 && hasCr) {
         string line = Encoding.UTF8.GetString(buffer.ToArray(), 0, buffer.Count);
         if (line == "DATA") {
            done = true;
         } else {
            HandleHeaderLine(line);
         }
         buffer.Clear();
         hasCr = false;
      } else {
         if (hasCr) buffer.Add(13);
         hasCr = false;
         buffer.Add((byte)b);
      }
   }
   _dataOffset = stream.Position;
} 
```

您当然可以继续读取数据，而不是关闭流并再次打开它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T12:06:24.147

所以你的最后一行包含“数据”+未知数量的数据字节。您可以通过使用 IndexOf() 和最后读取的行来提取位置。然后重新调整stream.Position。

但我不确定在这种情况下你是否应该使用 ReadLine() 。也许最好逐字节读取，直到达到“数据”标记。

# c# - get 和 set 函数在 C++ 程序员中很流行吗？

> ID：737409
> 
> 赞同：45
> 
> 时间：2009-04-10T11:56:34.323
> 
> 标签：c#, c++, properties

我最初来自 C# 世界，我正在学习 C++。我一直想知道 C++ 中的 get 和 set 函数。在 C# 中，它们的使用非常流行，像 Visual Studio 这样的工具通过使它们非常容易和快速地实现来促进使用。但是，在 C++ 世界中似乎并非如此。

这是 C# 2.0 代码：

```
public class Foo
{
    private string bar;

    public string Bar
    {
        get { return bar; }
        set { bar = value; }
    }
} 
```

或者，在 C# 3.0 中：

```
public class Foo { get; set; } 
```

可能人们会说，那有什么意义呢？为什么不直接创建一个公共字段，然后在需要时将其设为属性；老实说，我实际上不确定。我只是出于良好的实践而这样做，因为我已经看到它这样做了很多次。

现在因为我已经习惯了，我觉得我应该把这个习惯带到我的 C++ 代码中，但这真的有必要吗？我认为它不像 C# 那样经常完成。

无论如何，这是我收集到的 C++：

```
class Foo
{
public:
    std::string GetBar() const; // Thanks for the tip, @Daniel Earwicker.
    void SetBar(std::string bar);
private:
    std::string bar;
}

std::string Foo::GetBar() const
{
    return bar;
}

void Foo::SetBar(std::string bar)
{
    // Also, I always wonder if using 'this->' is good practice.
    this->bar = bar;
} 
```

现在，对我来说，这似乎是一项艰巨的工作；考虑使用 Visual Studio 的工具，C# 实现实际上需要几秒钟的时间来实现，而 C++ 花了我更长的时间来输入 - 我觉得它不值得付出努力，尤其是当替代方案是 5 行长时：

```
class Foo
{
public:
    std::string Bar;
} 
```

据我所知，这些是优点：

*   您可以更改 get 和 set 函数的实现细节，因此您可以返回更有趣的东西，而不是返回私有字段。
*   您可以稍后删除 get/set 并使其仅读/写（但对于面向公众的界面，这似乎不好）。

以及缺点：

*   需要很长时间才能打字，这*真的*值得吗？一般来说。在某些情况下，优势使其值得付出努力，但我的意思是，就“良好实践”而言，是吗？

### 回答：

为什么我选择[了票数较少的答案](https://stackoverflow.com/questions/737409/are-get-and-set-functions-popular-with-c-programmers/737437#737437)？我实际上非常接近选择[veefu 的答案](https://stackoverflow.com/questions/737409/are-get-and-set-functions-popular-with-c-programmers/737552#737552)；然而，我个人的观点（这显然是有争议的）是，这个答案过度怂恿了布丁。

另一方面，我选择的答案似乎对双方都有争议。我认为如果过度使用 getter 和 setter*是*邪恶的（我的意思是，当它没有必要并且会破坏业务模型时），但我们为什么不应该有一个名为 的函数`GetBalance()`？

当然，这将比`PrintBalance()`;更加通用。如果我想以不同于班级希望的方式向用户展示它怎么办？现在，在某种意义上`GetBalance()`可能不足以证明“getter 和 setter 是好的”，因为它没有（或者可能不*应该*）有一个伴随的 setter，而且说起来，一个被调用的函数`SetBalance(float f)`可能是坏的（在我看来）因为这意味着函数的实现者必须在类之外操作帐户，这不是一件好事。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-10T12:08:16.933

我认为在 C++ 中提供访问器比在 C# 中更重要。

C++ 没有对属性的内置支持。在 C# 中，您几乎可以在不更改用户代码的情况下将公共字段更改为属性。在 C++ 中，这[更难](http://www.codeguru.com/cpp/cpp/cpp_mfc/article.php/c4031)。

为了减少输入，您可以将琐碎的 setter/getter 实现为内联方法：

```
class Foo
{
public:
    const std::string& bar() const { return _bar; } 
    void bar(const std::string& bar) { _bar = bar; } 
private:
    std::string _bar;
}; 
```

并且不要忘记[getter 和 setter 有点邪恶。](https://stackoverflow.com/questions/565095/java-are-getters-and-setters-evil)

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-04-10T13:02:18.393

冒着争论的风险，我将支持我在阅读“Holub on Patterns”时第一次遇到的相反观点。这是一个非常具有挑战性的观点，但经过反思对我来说是有意义的：

**Getter 和 Setter 是邪恶的**

使用 getter 和 setter 违背了面向对象设计的基础：数据抽象和封装。从长远来看，过度使用 getter 和 setter 会降低代码的敏捷性和可维护性。它们最终暴露了你的类的底层实现，将实现细节锁定到类的接口中。

想象一下，您的 'std::string Foo::bar' 字段需要从 std::string 更改为另一个字符串类，例如，更好地优化或支持不同的字符集。您需要更改私有数据字段、getter、setter 以及调用这些 getter 和 setter 的此类的所有客户端代码。

与其将您的类设计为“提供数据”和“接收数据”，不如将它们设计为“执行操作”或“提供服务”。问问自己为什么要编写“GetBar”函数。你用这些数据做什么？也许您正在显示该数据或对其进行一些处理。这个过程是否更好地暴露为 Foo 的方法？

这并不是说 getter 和 setter 没有它们的用途。在 C# 中，我认为使用它们的根本原因是与 Visual Studio GUI 设计 IDE 交互，但如果你发现自己用 C++ 编写它们，最好退后一步，看看你的设计，看看有没有什么不见了。

我将尝试模拟一个示例来说明。

```
// A class that represents a user's bank account
class Account {
  private:
    int balance_; // in cents, lets say 
  public:
    const int& GetBalance() { return balance_; }
    void SetBalance(int b) { balance_ = b; }
};

class Deposit {
  private:
    int ammount_;
  public:
    const int& GetAmount() { return ammount_; }
    void SetAmmount(int a) { _balance = a; }
};

void DoStuffWithAccount () {
  Account a;
  // print account balance
  int balance = a.GetBalance();
  std::cout << balance;

  // deposit some money into account
  Deposit d(10000);
  a.SetBalance( a.GetBalance() + d.GetValue());
} 
```

很快就会发现这是非常糟糕的设计。

1.  整数是一种糟糕的货币数据类型
2.  存款应该是账户的一项功能

getter 和 setter 使解决问题变得更加困难，因为客户端代码 DoStuffWithAccount 现在绑定到我们用来实现帐户余额的数据类型。

所以，让我们通过这段代码，看看我们可以改进什么

```
// A class that represents a user's bank account
class Account {
  private:
    float balance_;
  public:
    void Deposit(float b) { balance_ += b; }
    void Withdraw(float w) { balance_ -= w; }
    void DisplayDeposit(std::ostream &o) { o << balance_; }
};

void DoStuffWithAccount () {
  Account a;
  // print account balance
  a.DisplayBalance(std::cout);

  // deposit some money into account
  float depositAmt = 1000.00;
  a.Deposit(depositAmt);
  a.DisplayBalance(std::cout);
} 
```

“浮动”是朝着正确方向迈出的一步。当然，您可以将内部类型更改为“float”并且仍然支持 getter/setter 习惯用法：

```
class Account {
  private:
    // int balance_; // old implementation
    float balance_; 
  public:
    // support the old interface
    const int& GetBalance() { return (int) balance_; }
    void SetBalance(int b) { balance_ = b; }
    // provide a new interface for the float type
    const float& GetBalance() { return balance_; } // not legal! how to expose getter for float as well as int??
    void SetBalance(float b) { balance_ = b; }
}; 
```

但很快就会意识到，getter/setter 安排会使您的工作量加倍并使事情复杂化，因为您需要同时支持使用整数的代码和将使用浮点数的新代码。存款功能可以更轻松地扩展存款类型的范围。

类账户类可能不是最好的例子，因为“获取”账户余额是账户的自然操作。不过，总体而言，您必须小心使用 getter 和 setter。不要养成为每个数据成员编写 getter 和 setter 的习惯。如果您不小心，很容易将自己暴露并锁定在实现中。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-10T12:02:46.883

在您的示例中：

```
class Foo
{
public:
    const std::string GetBar(); // Should this be const, not sure? 
```

你可能是这个意思：

```
std::string GetBar() const; 
```

将 放在`const`末尾意味着“此函数不会修改调用它的 Foo 实例”，因此在某种程度上它将其标记为纯 getter。

纯吸气剂经常出现在 C++ 中。中的一个例子`std::ostringstream`是`str()`函数。标准库通常遵循为一对 getter/setter 函数使用相同函数名的模式 -`str`再次作为示例。

至于打字是否工作量太大，是否值得——这似乎是一个奇怪的问题！如果您需要让客户访问某些信息，请提供 getter。如果你不这样做，那就不要。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-10T12:09:24.123

[编辑] 似乎我需要强调设置器需要验证参数并强制执行不变量，因此它们通常不像这里那么简单。[/编辑]

* * *

不是全部，因为额外的打字。现在我倾向于更频繁地使用它们，因为 Visual Assist 给了我“封装场”。

如果您在类声明中仅实现默认的 setter / getter 内联（我倾向于这样做 - 更复杂的 setter 移动到主体，但），那么繁琐的工作就不会更多了。

一些注意事项：

**constness ：** 是的，getter 应该是 const。但是，如果按值返回，则将返回值设为 const 是没有用的。对于可能复杂的返回值，您可能希望使用 const & 虽然：

```
std::string const & GetBar() const { return bar; } 
```

**Setter 链接：**许多开发人员喜欢这样修改 setter：

```
Foo & SetBar(std::string const & bar) { this->bar = bar; return *this; } 
```

这允许这样调用多个设置器：

```
Foo foo;
foo.SetBar("Hello").SetBaz("world!"); 
```

不过，它并没有被普遍接受为一件好事。

**[__declspec(property)](http://msdn.microsoft.com/en-us/library/yhfk0thd(VS.80).aspx)**：Visual C++ 提供了这种非标准扩展，以便调用者可以再次使用属性语法。这稍微增加了课堂上的跑腿，但使调用者代码看起来更友好。

* * *

所以，总而言之，在 C++ 中需要做更多的工作，但需要做出一些决定。典型的 ;）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-10T13:18:55.017

对此没有真正严格的约定，就像在 C# 或 Java 中那样。许多 C++ 程序员只会将变量设为 public 以省去麻烦。

正如其他答案所说，您不应该经常需要 set ，并且在某种程度上需要 get 方法。

但是，如果您确实制作了它们，则无需输入过多的内容：

```
class Foo
{
public:
    std::string Bar() const { return bar; }
    void Bar(const std::string& bar) { this->bar = bar; }
private:
    std::string bar;
}; 
```

在类中声明内联函数可以节省输入，并向编译器提示您希望内联函数。而且它的打字量并不比 C# 等价物多多少。需要注意的一件事是我删除了 get/set 前缀。相反，我们只有两个 Bar() 重载。这在 C++ 中相当常见（毕竟，如果它不带任何参数，我们知道它是 getter，如果它带一个参数，它就是 setter。我们不需要名称来告诉我们），而且它节省了更多的打字。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-10T18:43:27.403

我几乎从不在自己的代码中使用 getter 和 setter。[Veefu 的回答](https://stackoverflow.com/questions/737409/are-get-and-set-functions-popular-with-c-programmers/737552#737552)对我来说看起来不错。

如果您坚持使用 getter 和/或 setter，您可以使用宏来减少样板。

```
#define GETTER(T,member) const T& Get##member() const { return member; }
#define SETTER(T,member) void Set##member(const T & value) { member = value; }

class Foo
{
public:
    GETTER(std::string, bar)
    SETTER(std::string, bar)
private:
    std::string bar;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-10T16:08:02.007

获取和设置作为数据成员的数据成员：**Bad**。
获取和设置抽象元素：**好**。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-10T20:23:59.363

在银行示例中的 API 设计方面反对 Get/Set 的论点是正确的。如果它们允许用户破坏您的业务规则，请不要公开字段或属性。

但是，一旦您决定确实需要某个字段或属性，请始终使用属性。

c# 中的自动属性非常好用，并且有很多场景（数据绑定、序列化等）不使用字段，但需要属性。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-10T12:03:15.400

如果您正在开发 COM 组件，那么是的，它*非常*受欢迎。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-10T13:09:13.323

如果您必须在任何语言中使用 get 和 set，它们都会给人们带来痛苦。

埃菲尔的情况要好得多，不同之处在于您必须提供以获得答案的信息量 - 具有 0 参数的函数与访问成员变量相同，您可以在它们之间自由更改。

当您控制界面的两侧时，界面的定义似乎不是一个大问题。但是，当您想要更改实现细节并且它会像 C++ 中的常见情况那样导致重新编译客户端代码时，您希望能够尽可能地减少这种情况。因此[pImpl](http://www.codeproject.com/KB/tips/PIMPL.aspx)和 get/set 将在公共 API 中得到更多使用，以避免这种损害。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-03-17T13:54:40.410

如果您在变量值中有约束，Get 和 Set 方法很有用。例如，在许多数学模型中，存在将某个浮点变量保持在 [0,1] 范围内的约束。在这种情况下，Get 和 Set（特别是 Set）可以起到很好的作用：

```
class Foo{
public:
    float bar() const { return _bar; } 
    void bar(const float& new_bar) { _bar = ((new_bar <= 1) && (new_bar >= 0))?new_bar:_bar; } // Keeps inside [0,1]
private:
    float _bar;     // must be in range [0,1]
}; 
```

此外，某些属性必须在读取之前重新计算。在这些情况下，重新计算每个 cicle 可能会花费大量不必要的计算时间。因此，优化它的一种方法是仅在读取时重新计算。为此，请重载 Get 方法，以便在读取变量之前对其进行更新。

否则，如果不需要验证输入值或更新输出值，则公开属性不是犯罪，您可以接受。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-10T12:58:39.307

是的，get 和 set 在 c++ 世界中很流行。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-21T12:17:03.073

如果您使用 C++/CLI 作为 C++ 的变体，那么它在语言中具有本机属性支持，因此您可以使用

```
property String^ Name; 
```

这与

```
String Name{get;set;} 
```

在 C# 中。如果您需要更精确地控制 get/set 方法，那么您可以使用

```
property String^ Name
{
   String^ get();
   void set(String^ newName);
} 
```

在标题和

```
String^ ClassName::Name::get()
{
   return m_name;
}

void ClassName::Name::set(String^ newName)
{
   m_name = newName;
} 
```

在 .cpp 文件中。我不记得了，但我认为您可以对 get 和 set 方法（公共/私有等）具有不同的访问权限。

科林

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2009-04-10T13:13:39.333

如果你定义了一个属性，编译器会发出 set_ 和 get_ ，所以它实际上只是节省了一些输入。

这是一个有趣的讨论。这是我最喜欢的书[“CLR via C#”中的内容。](https://rads.stackoverflow.com/amzn/click/com/0735621632)

这是我引用的内容。

> 就个人而言，我不喜欢属性，我希望 Microsoftm.NET Framework 及其编程语言不支持它们。原因是属性看起来像字段，但它们是方法。众所周知，这会引起大量的混乱。当程序员看到似乎正在访问字段的代码时，程序员会做出许多假设，但对于属性可能不正确。例如，
> 
> *   一个属性可以是只读的或只写的；字段访问始终是
>     可读写的。如果您定义
>     一个属性，最好同时提供
>     get 和 set 访问器方法。
> *   属性方法可能会抛出异常；字段访问永远不会引发
>     异常。
>     
>     
> *   属性不能作为 out 或 ref 参数传递给方法；一个字段可以。
>     
>     
> *   一个属性方法可能需要很长时间才能执行；现场访问总是
>     立即完成。使用属性的一个常见
>     原因是
>     执行线程同步，这可以永远停止线程，因此， 如果需要线程同步，则
>     不应使用属性 。在那种情况下，一种方法是优选的。此外，如果您的类可以远程访问（例如， 您的类是从 System.MashalByRefObject 派生的），调用 属性方法将非常 慢，因此，方法 优先于属性。在我 看来，从 MarshalByRefObject 派生的类不应该使用
>     
>     
>     
>     
>     
>     
>     
>     
>     
>     特性。
>     
>     
> *   如果连续多次调用，一个属性方法可能
>     每次返回不同的值；一个
>     字段每次返回相同的值
>     。System.DateTime 类有一个只读的 Now 属性，它返回
>     当前日期和时间。每次查询此属性时，它都会
>     返回不同的值。这是一个
>     错误，Microsoft 希望他们可以通过将 Now 设为方法而不是属性
>     来修复该类。
>     
>     
>     
> *   属性方法可能会导致可观察到的副作用；字段访问永远不会。换句话说，类型的用户应该能够以 他或她选择
>     的任何顺序设置类型定义的各种属性，而不会 注意到类型中的任何不同行为 。
>     
>     
>     
>     
>     
> *   属性方法可能需要额外的内存或返回对 实际上不属于对象状态的
>     某些内容的引用，因此修改返回的对象 对原始对象没有影响； 查询一个字段总是返回一个对 保证是原始对象状态的一部分的对象的 引用。使用返回副本的 属性可能 会让开发人员感到非常困惑，并且 此特征通常没有记录。

# c - 奇怪的代码崩溃问题？

> ID：737411
> 
> 赞同：1
> 
> 时间：2009-04-10T11:56:55.713
> 
> 标签：c, crash, printf

我有一个 MSVC 6.o 工作区，其中包含所有 C 代码。
代码在没有任何优化开关的情况下运行，即使用选项 O0，并且处于调试模式。此代码是从某个第 3 方获得的。它按原样执行。

但是当我`printf`在某些函数中添加一些语句进行调试，然后执行代码时，它就崩溃了。

我怀疑它是跨内存页/内存段或类似的某种代码/数据溢出。但是代码没有任何内存映射说明符，或链接器命令文件提及段/内存映射等。

我如何缩小原因，以及解决这个古怪问题的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T13:35:36.927

您可以通过查看 Visual Studio 中的堆栈跟踪来尝试确定崩溃发生的位置。您应该能够看到最终导致崩溃的函数调用序列是什么，这可能会提示您出现了什么问题。

单独的 printf() 也可能导致崩溃。一个可能的原因（但在 Windows 上不太可能）是调用 printf() 时溢出的堆栈太小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T12:13:47.777

在 Linux 上，我喜欢[valgrind](http://valgrind.org/)。这是[Windows 上类似 valgrind 的工具的 Stack Overflow 线程](https://stackoverflow.com/questions/413477/is-there-a-good-valgrind-substitute-for-windows)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T12:15:47.977

在 printf 中打印 cstring 对象时使用 string.getbuffer。宽字符和普通字符串可能存在问题。printf("%s",str.Getbuffer()); str.ReleaseBuffer(); 干杯，阿图尔。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-26T16:32:48.697

通常，在尝试处理崩溃时，您的第一个调用端口应该是调试器。

如果使用得当，这将使您能够将问题缩小到特定的代码行，并有望在崩溃时为您提供运行时内存的视图。这将使您能够看到崩溃的直接原因。

# php - PHP写入文件

> ID：737415
> 
> 赞同：2
> 
> 时间：2009-04-10T11:59:18.577
> 
> 标签：php, file

下面是我用来将地图数组“翻译”为 SQL 代码的一些代码，以便在更新游戏地图时轻松更新数据库。如您所见，它将 SQL 代码打印到屏幕上，以便我可以复制和粘贴它。

随着我的地图变得更大，这将变得低效，因为它会由于大量输出而导致浏览器崩溃，所以我想知道是否可以让它创建一个 .txt 文件并将所有数据写入其中而不是打印到屏幕？

```
<?php
if (isset($_POST['code'])){
$map = $_POST['code'];
$map = preg_replace("/,\\s*}/i", "}", $map);
$map = str_replace("{", "[", $map);
$map = str_replace("}", "]", $map);
$map = json_decode('[' . $map . ']');

$arrayCount1 = 0;
$arrayCount2 = -1;

$H = sprintf('%05d', 00000);
$V = sprintf('%05d', 00000);
$id = 1;

echo "INSERT INTO `map` (`id`, `horizontal`, `verticle`, `image`) VALUES" . "<br />";

for ($count1 = 0; $count1 < sizeof($map[0]); $count1++){
$arrayCount2++;
$arrayCount1 = 0;
$V = sprintf('%05d', $V + 1);
$H = sprintf('%05d', 00000);

for ($count2 = 0; $count2 < sizeof($map); $count2++){
echo "(" . $id . ", '" . $H . "', '" . $V . "', '" . $map[$arrayCount1][$arrayCount2] . "')," . "<br />";
$arrayCount1++;
$id++;
$H = sprintf('%05d', $H + 1);
}
}
}
?> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T12:04:19.533

那应该很简单。添加

```
// second parameter 'a' stands for APPEND
$f = fopen('/path/to/the/file/you/want/to/write/to', 'a'); 
```

到脚本的开头。

添加

```
fclose($f); 
```

到你的脚本结束时干净地关闭文件句柄（即使句柄会自动关闭终止脚本）。

并将你所有`echo`的和`print`s 更改为

```
fwrite($f, '<<your string>>'); 
```

**编辑：**

这样，如果数据量变得非常大，您甚至可以使用[压缩流包装器即时压缩数据。](http://de.php.net/manual/en/wrappers.compression.php)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-10T12:39:13.660

还有一种更简单的方法：

```
ob_start();
# Your code here ...
file_put_contents('yourfile.txt', ob_get_clean()); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-10T12:18:13.680

如果这是您计划定期或通过不同脚本编写的内容，请考虑使用flock() 锁定文件并防止数据损坏。

```
 $fp = fopen("/tmp/lock.txt", "w+");

if (flock($fp, LOCK_EX)) { // do an exclusive lock
    fwrite($fp, "Write something here\n");
    flock($fp, LOCK_UN); // release the lock
} else {
    echo "Couldn't lock the file !";
}

fclose($fp); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T12:04:48.143

```
$str = <<<your string comes here>>>
if( $fh = @fopen( "myfile.txt", "a+" ) ) {
            fputs( $fh, $str, strlen($str) );
            fclose( $fh );
} 
```

这应该做...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T12:03:58.457

写入所有行，然后将文件发送到客户端。

检查[此](https://stackoverflow.com/questions/737045/send-a-file-to-client)帖子以获取更多说明

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T12:21:51.597

+我的 2 美分：

您可以检查您的数据库服务器的海量数据加载功能，因为它们中的大多数可以比执行数千次插入更快地批量加载文件。

# wpf - 向上/向下滚动列表框

> ID：737418
> 
> 赞同：3
> 
> 时间：2009-04-10T12:00:56.310
> 
> 标签：wpf, listbox, scroll

我有一个*ItemsControl*，您可以使用向上/向下翻页按钮按预期滚动。我用*ListBox*切换它，以在选择项目时应用（通过触发器）新的 DataTemplate 。

一切正常，直到使用 pageup 或 pagedown 按钮。它不是滚动一页，而是滚动到结尾或开头。

我之前的尝试：

*   DataTemplate 更改时不更改项目高度
*   完全删除 IsSelected=True 触发器
*   所有 SelectionMode 值

我错过了一些微不足道的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-12T15:15:38.730

```
private void RaiseKeyDownUpEventsOnEntitiesBox(Key key)
{
    KeyEventArgs keyEventArgs = new KeyEventArgs(
        InputManager.Current.PrimaryKeyboardDevice,   
        Keyboard.PrimaryDevice.ActiveSource, 
        System.Environment.ProcessorCount, key);
    keyEventArgs.RoutedEvent = UIElement.KeyDownEvent; 
    entitiesBox.RaiseEvent(keyEventArgs);
    keyEventArgs.RoutedEvent = UIElement.KeyUpEvent; 
    entitiesBox.RaiseEvent(keyEventArgs);
} 
```

向下翻页

```
RaiseKeyDownUpEventsOnEntitiesBox(Key.Next); 
```

向上翻页

```
RaiseKeyDownUpEventsOnEntitiesBox(Key.Prior); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T14:19:37.710

确实，我错过了一些微不足道的事情。我忘了删除 ItemsControl 之外的 ScrollViewer。我想，这会造成混乱，因为 ListBox 有自己的 ScrollViewer。

这就提出了另一个问题。以前的 ScrollViewer 从后面的代码自动向下滚动。现在，我无法访问 ListBox 的 ScrollViewer，我无法调用它的*LineDown*方法。这是我的解决方法：

```
// Responses is the ItemsSource
Responses.Add(e); 
// xResponses is the ListBox
var item = xResponses.ItemContainerGenerator.ContainerFromIndex(0);
ScrollBar.LineDownCommand.Execute(null, item as IInputElement); 
```

一开始，**item**可能评估为 null，但这不会产生问题。添加了一些项目之后，幸运的是在我们需要滚动之前，成功返回了一个容器。请注意，这里的索引并不重要，我们只需要ScrollViewer中的**IInputElement 。**

# .net - 如何设计功耗更低的移动应用程序？

> ID：737419
> 
> 赞同：2
> 
> 时间：2009-04-10T12:02:00.490
> 
> 标签：.net, mobile

我很快将从事一个关于移动应用程序的项目。此应用程序将在带有 Windows Mobile 的 PDT 上运行，我们将使用 Visual Studio 和 .NET 来开发它。

此应用程序将密集使用 Wifi，并且需要消耗尽可能少的电量。我在互联网上发现了很多关于嵌入式软件和实时系统的东西，它们涉及电源管理。不过这东西跟硬件很相关，不谈软件设计。

我还发现了一些有趣的最佳实践，但主要集中在应用程序的代码上（例如，尽快关闭句柄或使用少量 I/O）。

我想知道您是否知道有关此类应用程序的架构或设计的一些线索。

我还看到了有关使用事件驱动架构的建议：它在节能方面有用吗？它可以与 Compact Framework 一起使用吗？

## 编辑

所以 Dave 给了我们一些线索，我们可以称之为架构决策。所以我想我清楚地看到了在两个不同层面可以做些什么：

*   在高层次上，例如戴夫的决定；
*   在低抽象层次上，接近于代码、技巧和技巧，以最大限度地减少电池消耗。

在中间抽象层（在设计阶段）呢？是否有一些低功耗软件设计（设计模式等）的方法？

链接：

[http://msdn.microsoft.com/en-us/library/aa455167.aspx](http://msdn.microsoft.com/en-us/library/aa455167.aspx)

[http://www.eventhelix.com/RealTimeMantra/Basics/](http://www.eventhelix.com/RealTimeMantra/Basics/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T12:36:32.060

也许您可以链接到您发现的最佳实践。除了他们之外，您还期待什么样的潜在客户？我想[这](http://rdaarchitecture.blogspot.com/2008/09/windows-mobile-and-power-management.html)是您发现的一部分，而[这](http://software.intel.com/en-us/articles/maximizing-power-savings-on-mobile-platforms/)更针对笔记本电脑多核处理器。

Windows Mobile 充其量是一个软实时系统，与硬实时相去甚远。我怀疑你会在这种描述和建议中找到很多用处。

否则，我会说你有相当标准的东西。如果可以，请远离 Wifi 以及其他设备。如果您有可用的内存，请使用缓存（但要衡量正在发生的事情，以免缓存成为负担）。永远不要进行空闲循环，但使用 Thread.Sleep() 或更好的方法，尝试使所有内容都由事件驱动，并具有较短的处理突发。线程可以成为您的朋友，明智地使用。

而且，当然，像疯了一样的个人资料。您的代码在 CPU 使用率方面的效率越高越好。

但更具体的建议必须取决于您要解决的问题。为什么您的应用程序 Wifi 密集型？它需要接收或发送什么信息？谁是用户，他们搬到哪里？是否涉及繁重的计算？您需要呈现多少用户界面？您是否针对特定硬件（特定 CPU 和 WLAN 接口将具有不同的功耗行为）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T12:15:26.510

尽可能少地使用 wifi 和其他耗电量大的功能。如果可行，请在一定数量的请求未决时进行批量 wifi 传输，而不是按需进行。

# java - 在 Linux 中运行以从 Java 源文件创建 UML 类图的免费实用程序

> ID：737431
> 
> 赞同：26
> 
> 时间：2009-04-10T12:04:49.530
> 
> 标签：java, uml, utilities

我更喜欢在纸上记下 UML 图，然后使用 Java 实现它们。如果有一个实用程序可以为我创建 UML 图，我可以在线共享并包含在数字文档中，这将是很好的。换句话说：我想从 Java 源代码创建 UML 图。

该实用程序必须能够：

*   在 Linux 中运行。
*   处理泛型，即在参数和返回类型中正确显示 List<Foo>。
*   显示类继承和接口实现。

如果该实用程序能够：

*   在 Windows 和 Mac OS X 中运行。
*   以某种不错的方式显示枚举。
*   以图表格式生成输出，我可以使用其他一些实用程序对其进行修改。
*   从命令行运行。
*   将 UML 生成限制为我可以指定的一组包。
*   处理不属于我的源代码的类/接口。它可以包括在 UML 图中外部的第一个类/接口。也许用另一种颜色表示它是由其他人创建的库/框架。
*   专注于这项任务，而不是试图解决整个文档问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T12:44:38.780

我们试验过的一种方法是[UMLGraph](http://www.umlgraph.org/index.html)和[GraphViz](http://www.graphviz.org/)的组合。我们当时正在做的是使 UML 创建成为我们 CruiseControl 构建的自动部分：javadoc 将使用内置的 UML 图构建。它非常漂亮。

我想您会发现[UMLGraph 文档](http://www.umlgraph.org/doc/index.html)几乎可以回答您的所有问题。具体来说，您应该能够从命令行创建所需的类图。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T12:20:41.163

几个月前，我写了一个名为“java2dot”的**简单工具。**它不能满足您的所有要求，但它可能会有所帮助。

[http://plindenbaum.blogspot.com/2008/10/javadoc-is-not-enough-java2dia.html](http://plindenbaum.blogspot.com/2008/10/javadoc-is-not-enough-java2dia.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T12:28:00.257

[doxygen](http://www.doxygen.org/)几乎可以满足您的一切需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T12:44:29.857

目前尚不清楚您是想从 UML 创建代码还是将代码逆向工程到 UML。如果您想从 UML 创建代码，Netbeans UML 项目类型可能是最简单的 Java 工具集。

如果你想独处

[StarUML](http://staruml.sourceforge.net/en/download.php)是一种较旧的 UML 建模工具。它遵循 2 之前的大多数 UML 指南。它可以处理泛型，但前提是您手动输入它们。但是，如果我没记错的话，我认为它不会正确生成泛型。您必须在生成后调整代码。

虽然不是免费的，但我个人认为如果你经常做 UML， [Umodel](http://www.altova.com/products/umodel/uml_tool.html)是物有所值的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-10T14:14:01.063

tigris.org 的 ArgoUML：请参见[此处](http://argouml-stats.tigris.org/documentation/manual-0.26/ch10s03.html#s3.ref.menu_import_sources)：它是多平台的。如果您更喜欢 GNU/linux 应用程序并且使用 KDE，则可以使用[Umbrello](http://uml.sourceforge.net/feature.php)。

# iphone - 如何在 iPhone 上将图像插入 SQLite？

> ID：737443
> 
> 赞同：2
> 
> 时间：2009-04-10T12:12:38.997
> 
> 标签：iphone, cocoa-touch, sqlite

我想在 sqlite3 中插入​​图像，我使用“create table table1(photo blob,name varchar(10));”创建了表 现在我想在其中插入图像，那么将图像插入其中的语法是什么？在另一个表中，我想存储图像的位置，所以对于第二个表，我的创建表和插入表语法是什么。你能帮我吗？？？？我如何检查它是否从命令行正确插入？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-02T15:05:12.563

您可以通过以下代码行在 sqlite3 中插入​​图像。

**1)=首先准备SQLite插入语句**

```
 static sqlite3_stmt *insert_statement; //Declare Insert statement    
    - (void)InsertIntoDatabase{  // start insert method
         const char *sql = "INSERT INTO <yourtable> (<column1>, <BLOBColumnName>) VALUES (? , ?)" ;
           if(sqlite3_prepare_v2(database, sql, -1, &insert_statement, NULL) != SQLITE_OK)
              NSAssert1(0, @"Error while creating insert statement. '%s'", sqlite3_errmsg(database));} 

//For simple integer column**
   sqlite3_bind_int(insert_statement, 1, <value column 1>);

//For image column**
  NSString *webUrl = @"http://yourwebsite/youImage.jpg";        
  UIImage *myImage =  [self GetRawImage:webUrl]; //Get image from method below
                     if(myImage != nil){
                     NSData *imgData = UIImagePNGRepresentation(myImage);
                     sqlite3_bind_blob(insert_statement, 2, [imgData bytes], [imgData length], NULL);
                     }
                     else {
                      sqlite3_bind_blob(insert_statement, 2, nil, -1, NULL);
                     }
    } // end of insert method 
```

**2)=获取原始图像文件的方法。**

```
 - (UIImage *)GetRawImage:(NSString *)imageUrlPath
    {  
    NSURL *imageURL = [NSURL URLWithString:imageUrlPath];  
    NSData *data = [NSData dataWithContentsOfURL:imageURL];  
    UIImage *image = [[UIImage alloc] initWithData:data];   
    return image; 
    } 
```

！做起来很简单

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T09:45:14.623

为什么不简单地将图像保存在 iphone 文件系统上，而只将其位置信息保存在 sqlite 中？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T23:11:21.253

您可以获取图像的原始 NSData 并保存...

```
NSData *imageData = UIImagePNGRepresentation(image); 
```

# vb.net - 在托管代码中启动另一个 EXE

> ID：737444
> 
> 赞同：2
> 
> 时间：2009-04-10T12:13:34.720
> 
> 标签：vb.net, visual-studio-2008, .net-3.5

是否可以在托管代码中启动另一个 EXE？此时，我所能做的就是使用：

```
System.Diagnostics.Process.Start(exeName) 
```

是否有另一种方法可以在同一个项目中调用另一个 EXE？

谢谢！联合部队

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-10T12:24:30.653

```
 Process process = new Process();
            process.StartInfo.FileName = "c:\test.exe";
            process.StartInfo.Arguments = "/e /s";
            process.Start(); 
```

这样你就可以为你的进程获得很多选项，例如 process.WaitForExit() 所以你可能不会异步运行你的进程等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T12:23:31.763

如果它是托管的，您可以使用 Assembly.ExecuteAssembly。这将执行当前进程中的主入口点，而不是启动一个新进程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T12:18:46.907

使用相对路径，它应该可以工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T12:35:52.937

相对路径使用 CurrentDirectory，用户可以在启动应用程序时轻松更改它，并且它可以在执行期间更改。我建议使用您可以确定的东西：

有很多不同的方法可以获取可执行文件的路径：

```
AppDomain.CurrentDomain.BaseDirectory

Assembly.GetExecutingAssembly().Location 
```

# sql - Order By 查询忽略标点符号

> ID：737447
> 
> 赞同：0
> 
> 时间：2009-04-10T12:13:59.243
> 
> 标签：sql, database, postgresql

这是使用 Postgresql。

表中的列包含带有标点符号的字符串值。取值有“aac”、“.aaa”、“aa_b”等。当该列在order by子句中指定时，结果的顺序几乎是随机的。以句点开头的字符串应该出现在顶部，这不会发生。它们出现在中间的某个地方。

令人惊讶的是，这种行为只出现在一个数据库中。相同的查询在其他主机上的数据库上运行良好。

这可能是什么原因？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T12:22:28.770

“order by”（字符串比较）行为取决于[集群的 locale](http://www.postgresql.org/docs/current/static/locale.html#AEN26966)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T12:28:58.130

首先，检查 EXPLAIN 并查看它是如何进行排序的。

*   如果它正在调用用户定义的比较函数，请查看该函数。
*   如果它正在遍历索引，请查看该索引是否使用了不正确的排序函数（不是传递函数或类似函数）。

如果 EXPLAIN 没有显示任何奇怪的东西，请检查集群的语言环境 - 也许它正在使用忽略某些字符的语言环境进行比较。

# javascript - JQuery 自动完成中的 formatResult 和 formatItem 选项有什么作用？

> ID：737453
> 
> 赞同：10
> 
> 时间：2009-04-10T12:16:11.190
> 
> 标签：javascript, jquery, django

这里有点迷糊，JQuery Autocomplete 插件中的formatResult 和formatItem 是做什么的？

我有一个返回逗号分隔字符串（来自 Django）的函数，但是我的自动完成功能无法将字符串拆分为单独的条目/行，我如何使用自动完成功能来实现这一点？

例如，返回的结果看起来像这样，这是自动完成显示的内容：- **[“one”，“oneTwo”，“Onethree”，“anotherOne”]**

我希望在自动完成字段中显示时将其拆分如下：-

```
one
oneTwo
Onethree
anotherOne 
```

我有一种感觉我可以使用 formatResult 和 formatItem 但我不知道如何，那里没有好的例子！

我在 html 模板中的代码：

```
 function autoFill(){
           $("#tags").autocomplete("/taglookup/", {
        width: 320,
        max: 4,
        highlight: false,
        multiple: true,
        multipleSeparator: " ",
        scroll: true,
        scrollHeight: 300
         });
       } 
```

我正在使用 Dajango 来处理 GET 请求。

加思

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-10T12:36:55.133

`formatItem`格式化项目以在下拉列表中显示，同时`formatResult`格式化项目以在选择后显示在输入框中。

默认情况下，自动完成期望从指定的 url 获取数据，格式如下：

```
foo|bar|baz|bing
zaz|ding|blop|grok 
```

其中每一行是一行数据；每一行都是它传递给`formatItem`和的数据`formatResult`。您可能希望采取阻力最小的路径并以它喜欢的方式返回数据。

如果您想使用不符合自动完成假设的数据，则需要使用（据我所知，未记录）解析选项来识别解析 ajax 请求结果的函数。在我看来，您的 django 视图正在返回一个数组，而不是返回一个格式化的字符串。要将数组格式化为 jquery 所希望的那样：

```
return HttpResponse('|'.join(your_array), mimetype='text/plain') 
```

以下是使用非标准自动完成数据 (JSON) 进行自动完成的示例：

```
<script type="text/javascript"> 
  format_item = function (item, position, length){ 
    return item.title; 
  } 

 // Handle data from ajax request 
 prep_data = function(data){ 
   tmp = $.evalJSON(data); 
   parsed_data = []; 
   for (i=0; i < tmp.length; i++) { 
     obj = tmp[i]; 
     // Other internal autocomplete operations expect 
     // the data to be split into associative arrays of this sort 
     parsed_data[i] = { 
        data: obj , 
        value: obj.isbn13, 
        result: obj.title 
     }; 
   } 
   return parsed_data 
 } 

 $(document).ready(function(){ 
   $("#fop").autocomplete({ 
          url : "{% url book-search %}", 
          // undocumented 
          parse: prep_data, 
          formatItem: format_item, 
          }); 
 }) 

</script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-31T18:09:59.547

到目前为止，我还无法让 formatMatch 和 formatResult 工作。我仍在研究使用它们的“正确”方式。但是，作为一种解决方法，您可以使用 parse 选项，如下所示。为了清楚起见，在这个例子中，formatItem 和 parse 是有效的，而 formatResult 和 formatMatch 是无效的。

```
jQuery(function(){
   $('#profile-tabs_addresses_grid_b_a_PostalCode').autocomplete
('http://test.mydomain.com/locality/postalcodes/', {
       minChars:1,
       delay:400,
       cacheLength:100,
       matchContains:true,
       max:10,
       formatItem:function(item, index, total, query){
           return item.PostalCode + ': ' + item.Region + ', ' +
item.City + ', ' + item.Country;
       },
       formatMatch:function(item){
           return item.PostalCode;
       },
       formatResult:function(item){
           return item.PostalCode;
       },
       dataType:'json',
       parse:function(data) {
                       return $.map(data, function(item) {
                               return {
                                       data: item,
                                       value: item.PostalCode,
                                       result: item.PostalCode
                               }
                       });
               }});
}); 
```

这是从数据 url 返回的 json 数据（添加空格以便于查看）：

```
[
       {City:"St. Louis", Country:"USA", PostalCode:"63103", ID:3,
Region:"Missouri"},
       {City:"St. Louis", Country:"USA", PostalCode:"63109", ID:1,
Region:"Missouri"},
       {City:"St. Louis", Country:"USA", PostalCode:"63119", ID:2,
Region:"Missouri"}
] 
```

当我在邮政编码框中输入 6 时，它会显示所有三个选项，格式正确为：

```
63103: Missouri, St. Louis, USA
63109: Missouri, St. Louis, USA
63119: Missouri, St. Louis, USA 
```

当我选择一个时，文本框只会收到所选的邮政编码。

# javascript - 覆盖“this”变量问题或如何调用成员函数？

> ID：737454
> 
> 赞同：1
> 
> 时间：2009-04-10T12:17:24.853
> 
> 标签：javascript, jquery, oop, event-handling, prototypejs

我有这个类，我使用 jQuery 和[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)的组合：

```
var MyClass = Class.create({
    initElements: function(sumEl) {
       this.sumEl = sumEl;
       sumEl.keyup(this.updateSumHandler);
    },

    updateSumHandler: function(event) {
       // Throws error here: "this.updateSum is not a function"
       this.updateSum();
    },

    updateSum: function() {
       // does something here
    }
}); 
```

`this.updateSum()`毕竟我怎么打电话？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T12:31:42.447

您需要使用闭包。

```
 initElements: function(sumEl) {
        this.sumEl = sumEl;
        var ref = this;
        sumEl.keyup( function(){ref.updateSumHandler();});
 }, 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T12:35:33.733

完全未经测试的建议：

```
sumEl.keyup(this.updateSumHandler.bind(this)); 
```

`.bind()`返回一个新函数，其中第一个参数 of`bind`为您关闭作为函数的`this`上下文。它还可以关闭参数，查看[文档](http://www.prototypejs.org/api/function/bind)。

对我来说，`Function.bind()`这是用 JavaScript 编写的最好的函数 :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T13:30:40.683

DOMEvent 处理程序通常使用它们注册为上下文/“this”的元素来调用。这也是 jQuery 所做的。

对您来说最简单的选择是使用 jQuery 处理事件数据的能力

```
var MyClass = Class.create({
 initElements: function(sumEl) {
        this.sumEl = sumEl;
        sumEl.bind("keyup", this, this.updateSumHandler);
 },

 updateSumHandler: function(event) {
    // event.data is the initial this

    // call updateSum with correct context
    event.data.updateSum.call(event.data);
 },

 updateSum: function() {
        // does something here
 }
}); 
```

另一种可能性是使用闭包在构造函数中定义 updateHandler

```
var MyClass = Class.create({
 initElements: function(sumEl) {
        this.sumEl = sumEl;

        // save this as that so we can access it from the anonymous function
        var that = this;
        sumEl.keyup(function()
        {
           that.updateSum();
        });
 },

 updateSum: function() {
        // does something here
 }
}); 
```

这是其他答案之一试图做的工作示例。它之所以有效，是因为匿名函数总是可以访问周围函数中的变量——但它只有在函数真正定义在以“that”作为局部变量的函数中时才有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T12:32:37.623

这是您需要在`initElements`函数中使用的著名 Javascript 习语：

```
var that = this; 
```

稍后在您的处理程序中只需引用`that`而不是`this`：

```
var MyClass = Class.create({
    initElements: function(sumEl) {
        this.sumEl = sumEl;
        var that = this;
        sumEl.keyup(this.updateSumHandler);
    },
    updateSumHandler: function(event) {
        that.updateSum();
    },
    updateSum: function() {
        // does something here
    }
}); 
```

[Stuart Langridge](http://www.kryogenix.org/code/browser/secrets-of-javascript-closures/)在 Fronteers 2008 会议上关于*Javascript 闭包*的演讲中详细介绍了它。

# .net - 编写用于从文本文件中读取值的 nant 脚本

> ID：737459
> 
> 赞同：4
> 
> 时间：2009-04-10T12:19:18.140
> 
> 标签：.net

任何人都可以向我发送一个示例 nant.build 文件，该文件从名为 file.txt 的文本文件中读取一个值。

谢谢麦迪

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-10T12:29:12.997

```
<?xml version="1.0" encoding="utf-8" ?>
<project xmlns="http://nant.sf.net/release/0.86-beta1/nant.xsd" 
         name="Company.Portal.Domain" default="GetFile">
   <call target="GetFile" />
   <target name="GetFile">
     <echo message="Retrieving file contents"/>
     <property name="file.contents" value="0" />
     <loadfile file="file.txt" property="file.contents" />
     <property name="file.contents" value="${string::trim(file.contents)}" />
     <echo message="contents of file is  ${file.contents}"/>
   </target>
</project> 
```

当然，如果您愿意，可以跳过第 6、9 和 10 行。[编辑]

```
<if test="${file.contents=='someValue'}">
    <echo>Some value found</echo>
</if> 
```

[在此链接](http://nant.sourceforge.net/release/latest/help/tasks/if.html)获取完整的详细信息

[编辑2]

由于您想获取文本文件第 3 行的值，请执行此操作

```
<?xml version="1.0"?>
<project name="Read3rdLine" default="main">
    <property name="myInt" value="0"/>
    <property name="x" value="0"/>
    <property name="LineToRead" value="3"/>

    <target name="main" description="compiles the source code">
    <property name="i" value="0"/>
    <foreach item="Line" in="file.txt" property="x" trim="Both">
      <property name="i" value="${int::parse(i) + 1}"/>
      <if test="${i==LineToRead}">
          <property name="myInt" value="${x}"/>
      </if>
    </foreach>
    <echo>found  ${myInt} at line ${LineToRead}</echo>
    </target>
</project> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-04-22T11:01:02.467

我发现使用正则表达式更灵活，因为它不依赖于特定位置的行并且更易于编码。

```
<loadfile file="${filename}" property="assemblyInfo" />
<regex input="${assemblyInfo}" pattern="(?'assemblyVersion'AssemblyVersion[0-9.()&quot;]+)" /> 
```

语法有点奇怪，但第二行的结果是`assemblyVersion`用正则表达式分组模式匹配的字符串填充属性调用： (? )

# ruby-on-rails - 如何删除特殊字符？

> ID：737475
> 
> 赞同：48
> 
> 时间：2009-04-10T12:25:02.087
> 
> 标签：ruby-on-rails, ruby, regex

我正在练习使用 Ruby 和正则表达式来删除某些不需要的字符。例如：

```
input = input.gsub(/<\/?[^>]*>/, '') 
```

对于特殊字符，例如 ☻ 或 ™：

```
input = input.gsub('&#', '') 
```

这只留下数字，好的。但这仅在用户输入特殊字符作为代码时才有效，如下所示：

```
&#153; 
```

**我的问题：** 如果用户输入没有代码的特殊字符，我如何删除特殊字符，如下所示：

```
™ ☻ 
```

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-04-10T12:40:13.877

首先，我认为定义什么构成“正确输入”并删除其他所有内容可能更容易。例如：

```
input = input.gsub(/[^0-9A-Za-z]/, '') 
```

如果这不是您想要的（您想支持非拉丁字母等），那么我认为您应该列出要删除的字形（如 ™ 或 ☻），并逐个删除它们，因为很难以编程方式区分中文、阿拉伯文等字符和象形文字。

最后，您可能希望通过转换为 HTML 转义序列或从 HTML 转义序列转换输入来规范化您的输入。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-10T13:28:47.537

如果您只想要 ASCII 字符，那么您可以使用：

```
original = "aøbauhrhræoeuacå" 
cleaned = ""
original.each_byte { |x|  cleaned << x unless x > 127   }
cleaned   # => "abauhrhroeuac" 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-10-14T13:50:23.770

您可以使用[参数化](http://apidock.com/rails/ActiveSupport/Inflector/parameterize)：

```
'@!#$%^&*()111'.parameterize
 => "111" 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-10T12:37:59.687

您可以匹配所有想要的字符，然后将它们连接在一起，如下所示：

```
original = "aøbæcå"
stripped = original.scan(/[a-zA-Z]/).to_s
puts stripped 
```

哪个输出`"abc"`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-11-20T14:19:06.517

受 Can Berk Güder 的启发，一种更简单的方法是：

为了删除特殊字符：

```
input = input.gsub(/\W/, '') 
```

为了保留单词字符：

```
input = input.scan(/\w/) 
```

最后输入是一样的！试试看：[http ://rubular.com/](http://rubular.com/)

# java - 我应该包含什么 jar 在基于休眠的应用程序中使用 javax.persistence 包？

> ID：737496
> 
> 赞同：45
> 
> 时间：2009-04-10T12:33:27.933
> 
> 标签：java, hibernate, jar

可以从 Glassfish 项目（glassfish-persistence-api）中获取它，还是可能有一个 Hibernate jar？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-08-24T11:43:03.267

如果您使用的是 Maven，添加以下依赖项应该可以

```
<dependency>
    <groupId>javax.persistence</groupId>
    <artifactId>persistence-api</artifactId>
    <version>1.0</version>
</dependency> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-10T19:27:56.457

如果您正在开发 OSGi 系统，我建议您从[Springsource Enterprise Bundle Repository](http://www.springsource.com/repository/app/)下载“捆绑”版本。

否则可以使用包含**javax.persistence**包的常规 jar 文件

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-10-28T12:27:31.917

您可以使用与休眠捆绑在一起的**ejb3-persistence.jar 。**此 jar 仅包含 javax.persistence 包。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-04-07T17:07:51.477

在最新最好的 Hibernate 中，我能够通过在 lib/jpa 目录中包含 hibernate-jpa-2.0-api-1.0.0.Final.jar 来解决依赖关系。我在最近的下载中没有找到 ejb-persistence jar。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-10T12:39:08.870

hibernate.jar 和 hibernate-entitymanager.jar 只包含包 org.hibernate.*。所以你应该从 Glassfish 项目中获取它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-12-04T18:35:45.523

对于 JPA 2.1，可以在此处找到 javax.persistence 包：

```
<dependency>
   <groupId>org.hibernate.javax.persistence</groupId>
   <artifactId>hibernate-jpa-2.1-api</artifactId>
   <version>1.0.0.Final</version>
</dependency> 
```

请参阅：[Maven Central 上的 hibernate-jpa-2.1-api](http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.hibernate.javax.persistence%22%20AND%20a%3A%22hibernate-jpa-2.1-api%22) 该模式似乎是随着 JPA 版本的更改而更改工件名称。如果这种情况继续下去，预计新版本将在此处到达 Maven 中心：[Hibernate JPA 版本](http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.hibernate.javax.persistence%22)

以上 JPA​​ 2.1 APi 可以与 Hibernate 4.3.7 结合使用，具体如下：

```
<dependency>
   <groupId>org.hibernate</groupId>
   <artifactId>hibernate-entitymanager</artifactId>
   <version>4.3.7.Final</version>
</dependency> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-08-02T15:50:44.393

一般来说，我同意上述建议添加 Maven 依赖项的答案，但我更喜欢以下解决方案。

为完整的 JavaEE 配置文件添加 API 类的依赖项：

```
<properties>
    <javaee-api.version>7.0</javaee-api.version>
    <hibernate-entitymanager.version>5.1.3.Final</hibernate-entitymanager.version>
</properties>

<depencies>
    <dependency>
        <groupId>javax</groupId>
        <artifactId>javaee-api</artifactId>
        <version>${javaee-api.version}</version>
        <scope>provided</scope>
    </dependency>
</dependencies> 
```

还添加与特定 JPA 提供程序的依赖项，如 antonycc 建议：

```
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-entitymanager</artifactId>
    <version>${hibernate-entitymanager.version}</version>
</dependency> 
```

API依赖部分注意`<scope>provided</scope>`：这意味着相应的jar不会被导出到artifact的`lib/`，而是由应用服务器提供。确保您的应用程序服务器实现指定版本的 JavaEE API。

# ruby - IRB 的 Ruby 控制台替代方案（Windows）

> ID：737497
> 
> 赞同：-1
> 
> 时间：2009-04-10T12:35:15.730
> 
> 标签：ruby, console, irb

我正在为 Windows 上的 IRB 控制台寻找一些免费的轻量级 GUI 替代品。我最想看到的：

1.  编写脚本的区域（这样我就可以编辑、运行、编辑...）

*   使用当前变量的命令行
*   输出窗口查看结果
*   智能
*   断点/调试是一个加号

实际上，类似于 powershell_ise.exe 的东西会很棒。

[![Powershell ISE](https://i.stack.imgur.com/JJUnc.jpg)](https://i.stack.imgur.com/JJUnc.jpg)
[（来源：[microsoft.co.il](https://blogs.microsoft.co.il/blogs/scriptfanatic/WindowsLiveWriter/48e74fc0142c_B193/iseeditor_thumb_1.jpg)）]

PS 我**不是**在寻找 IDE（NetBeans、Aptana 等）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T14:20:11.890

SciTE 是如何失败的？有点好奇，因为如果您从文件中工作，感觉就像您在寻找什么。Ctrl-F5 执行等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T13:06:15.030

看看[电子文本编辑器。](http://www.e-texteditor.com/)

它不是一个完整的 IDE，但它允许您执行 Ruby 代码，并将输入内联，在 #=> 注释之后，或放入新窗口。

你得到了一些你想要的东西，而不是调试器和控制台。但是运行内联的东西在那里有点帮助。

它基于 TextMate，这真是太棒了。但仅限 OS X。哦，而且要花钱。

# python - Python 2.2.3 中的 SQLite

> ID：737511
> 
> 赞同：1
> 
> 时间：2009-04-10T12:40:39.057
> 
> 标签：python, sql, linux, sqlite, hosting

我使用 SQLite 在 python 中编写了一个网络应用程序，它在我家的服务器上运行良好（使用 apache 和 python 2.5.2）。我现在正试图将它上传到我的网络主机，那里的服务器使用没有 SQLite 的 python 2.2.3。
任何人都知道在 python 2.2.3 中使用 SQLite 的方法，例如我可以上传和导入的模块？我尝试过从较新版本的 python 中删除模块，但它们似乎不兼容。
谢谢，
迈克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T13:26:57.680

没有开箱即用的解决方案；您要么必须将 SQLlite 模块从 Python 2.5 反向移植到 Python 2.2，要么要求您的网络托管商升级到最新的 Python 版本。

Python 2.2 真的很古老！至少出于安全原因，他们应该升级（自 2003 年 5 月 30 日起不再有 2.2 的安全修复程序！）。

请注意，您可以并行安装多个版本的 Python。只需确保在脚本中使用“/usr/bin/python25”而不是“/usr/bin/python”。为了确保所有旧的东西仍然有效，在安装 Python 2.5 之后，你只需要修复两个符号链接“/usr/bin/python”和“/usr/lib/python”，它们现在应该指向 2.5。将它们弯曲回 2.2，你就很好了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T13:21:35.027

看这里： http: [//oss.itsystementwicklung.de/download/pysqlite/](http://oss.itsystementwicklung.de/download/pysqlite/)

来自发行说明（[http://oss.itsystementwicklung.de/trac/pysqlite/browser/doc/install-source.txt](http://oss.itsystementwicklung.de/trac/pysqlite/browser/doc/install-source.txt)）

> 3.  Python：Python 2.3 或更高版本

你可能无法做你想做的事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T00:40:31.587

如果您对 Web 服务器有 shell 访问权限，您可能可以构建自己的 Python 和 SQLite 版本。这将让您使用最新版本。下载源代码，然后在配置时执行“./configure --prefix=$HOME/packages”之类的操作。

接下来，摆弄你的 .profile 或 .bashrc 或其他任何东西，以确保 $HOME/packages/bin 在你的路径中排在第一位。这将导致您的私有 Python 覆盖您的 Web 服务器安装的那个。

此页面可能会为您提供有关如何在 Dreamhost 等服务器上执行此操作的更多信息：[http://wiki.dreamhost.com/Python](http://wiki.dreamhost.com/Python)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-01T05:06:17.007

万一有人遇到这个问题，pysqlite 和 APSW 都不适用于 Python 2.2 的原因是因为 Python 2.3 添加了简化的 GIL API。在 Python 2.3 之前，它需要大量代码来跟踪 GIL。（GIL 是 Python 使用的锁，用于确保多线程时的正确行为。）

向后移植到 2.2 需要删除所有线程代码。试图让它在 2.2 下也是线程安全的将是一场噩梦。他们引入简化的 GIL API 是有原因的！

我仍然对旧 Python 版本的流行程度感到惊讶。Python 2.3 的 APSW 仍会定期下载。

# python - 访问python中的对象时返回默认成员

> ID：737512
> 
> 赞同：1
> 
> 时间：2009-04-10T12:41:35.947
> 
> 标签：python, dynamic-data

我正在编写一个“环境”，其中每个变量都由一个值和一个描述组成：

```
class my_var:
   def __init__(self, value, description):
      self.value = value
      self.description = description 
```

创建变量并将其放入字典中：

```
my_dict["foo"] = my_var(0.5, "A foo var") 
```

这很酷，但 99% 的变量操作都是使用“值”成员。所以我必须这样写：

```
print my_dict["foo"].value + 15  # Prints 15.5 
```

或者

```
my_dict["foo"].value = 17 
```

我希望对象 my_dict["foo"] 上的所有操作都可以默认为“value”成员。换句话说，我想写：

```
print my_dict["foo"] + 15     # Prints 5.5 
```

和类似的东西。

我发现的唯一方法是重新实现**所有**下划线成员（eq、add、str 等），但我觉得这是错误的方式。有没有我可以使用的神奇方法？

一种解决方法是拥有更多字典，如下所示：

```
my_dict_value["foo"] = 0.5
my_dict_description["foo"] = "A foo var" 
```

但我不喜欢这个解决方案。你有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T12:59:31.350

两个一般说明。

1.  请使用大写的类名。

2.  请（除非使用 Python 3.0）子类对象。 `class My_Var(object):`， 例如。

现在回答你的问题。

假设你这样做

```
x= My_Var(0.5, "A foo var") 
```

python如何区分`x`复合对象和x的值（`x.value`）？

你想要以下行为吗？

*   有时`x`表示整个复合对象。

*   有时`x`意味着`x.value`。

你如何区分这两者？你将如何告诉 Python 你的意思？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T13:03:45.927

[您可以通过在http://docs.python.org/reference/datamodel.html](http://docs.python.org/reference/datamodel.html)的“模拟数字类型”部分中实现运算符来创建一个主要行为类似于“值”但具有附加属性“描述”的对象

```
class Fooness(object):
    def __init__(self,val, description):
        self._val = val
        self.description = description

    def __add__(self,other):
        return self._val + other

    def __sub__(self,other):
        return self._val - other

    def __mul__(self,other):
        return self._val * other

    # etc

    def __str__(self):
        return str(self._val)

f = Fooness(10,"my f'd up fooness")
b = f + 10
print 'b=',b
d = f - 7
print 'd=',d

print 'f.description=',f.description 
```

产生：

```
b= 20
d= 3
f.description= my f'd up fooness 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T13:06:11.600

我个人只会使用两本字典，一本用于值，一本用于描述。你对魔法行为的渴望不是很 Pythonic。

话虽如此，您可以实现自己的 dict 类：

```
class DescDict(dict):
    def __init__(self, *args, **kwargs):
        self.descs = {}
        dict.__init__(self)

    def __getitem__(self, name):
        return dict.__getitem__(self, name)

    def __setitem__(self, name, tup):
        value, description = tup
        self.descs[name] = description
        dict.__setitem__(self, name, value)

    def get_desc(self, name):
        return self.descs[name] 
```

您将按如下方式使用此类：

```
my_dict = DescDict()
my_dict["foo"] = (0.5, "A foo var")  # just use a tuple if you only have 2 vals
print my_dict["foo"] + 15            # prints 15.5
print my_dict.get_desc("foo")        # prints 'A foo var' 
```

如果您决定走魔术行为路线，那么这应该是一个很好的起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T12:58:38.637

我认为你必须做这么多工作来制作一个花哨的捷径这一事实表明你正在违背常规。你在做什么违反了 LSP；这是违反直觉的。

```
my_dict[k] = v;
print my_dict[k] == v # should be True 
```

即使是两个单独的字典也比改变字典的含义更可取。

# visual-studio-2008 - Debug -> Exceptions 窗口在哪里？

> ID：737514
> 
> 赞同：0
> 
> 时间：2009-04-10T12:44:15.257
> 
> 标签：visual-studio-2008, exception, debugging

我今天一定很慢或者什么，我找不到这个菜单选项。我附上了我的 IDE 调试菜单的屏幕截图：

[![IDE](https://i.stack.imgur.com/RMKxy.jpg)](https://i.stack.imgur.com/RMKxy.jpg)

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T12:49:38.223

右键单击菜单并从下拉菜单中选择自定义。单击命令，然后选择调试类别。在右侧将异常命令拖动到您想要的工具栏或菜单位置。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T12:54:22.440

Ctrl + Alt + E。在调试期间一直使用它。希望您可以将选定/排除的例外保存为以后会话的过滤器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T12:47:50.643

试试 Ctrl + D, E

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T12:48:33.437

以前有没有？看工具——选项——通用——调试

# entity-framework - 实体框架：忽略列

> ID：737520
> 
> 赞同：35
> 
> 时间：2009-04-10T12:46:02.613
> 
> 标签：entity-framework

我有一个希望从中构建 EF 模型的数据库，但是我不想包含数据库中的某些列，因为相关列仅在服务器上维护，不应由任何应用程序操作。

这两列都是 DateTime（如果这有什么不同的话），其中一列可以为空并由更新触发器维护，而另一列不可为空并使用表定义中的默认值进行设置。

我想我正在寻找类似于 Linq2Sql 中的“服务器生成”选项的东西；但我找不到这样的选择。

谁能告诉我如何解决这个问题？

警告：

多年来，我一直试图在我的工作地点引入业务对象建模，但由于需要手动操作的额外代码量，它总是被拒绝。由于设计器和代码生成，EF 目前被视为一种可行的解决方案，因此任何涉及手动启动 XML 的选项只会让我的其他同事远离 EF。因此，我正在寻找可以使用设计器或代码来完成的事情。

**编辑：**

我想我在这里寻找的是......

(a) 一种在没有 EF 引用存储中的列 (ssdl) 的情况下创建模型的方法，因此不希望以任何方式对其进行操作 (b) 一种在我创建时以编程方式针对属性设置“StoreGeneratedPattern”属性的方法ObjectContext （简单的答案是在 .ssdl 中手动操作它，但是如果我从数据库中刷新模型并且我无法沿着 .csdl、.msl 和 .ssdl 手动操作的路线前进，这将被覆盖）。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-10T14:28:23.943

你能用实体框架做到这一点吗？是的; 这很简单。你能用实体框架设计器做到这一点吗？不幸的是，这要困难得多。

您遇到的问题是该列存在于 EDMX 的存储架构 (SSDL) 中。使用 GUI 设计器删除列只是将其从客户端模式中删除，而不是从映射或存储模式中删除。但是，进入 EDMX 并删除它很简单。完成此操作后，您还可以将其从 EDMX 的客户端模式部分的映射中删除，并且实体框架将不再抱怨它未映射。

问题解决了，对吧？

嗯，不。当您使用 GUI 设计器从数据库更新 EDMX 时，存储模式将被丢弃并重新生成。所以你的专栏会回来。据我所知，没有办法告诉 GUI 设计者永远不要映射特定的列。因此，每次使用 GUI 设计器更新时，您都必须重新执行此操作。幸运的是，EDMX 是 XML，因此您可以使用 XML 转换、LINQ 或您选择的 XML 工具来执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T13:13:49.740

您不能创建包含所需列的视图并通过实体函数向导将其导入并将其映射到您的实体吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-05-14T02:33:25.407

您可以修改文本模板以在生成实体类时忽略这些列。例如，如果您在文档摘要中添加了“IGNORE”，则可以修改模板以通过替换来忽略它们；

```
Dim simpleProperties as IEnumerable(Of EdmProperty) = typeMapper.GetSimpleProperties(entity) 
```

和;

```
Dim simpleProperties as IEnumerable(Of EdmProperty) = typeMapper.GetSimpleProperties(entity).Where(Function(p) p.Documentation is nothing orelse p.Documentation.Summary.IndexOf("IGNORE")<0) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T13:20:41.300

右键单击图形表示中的字段并选择删除。我发现有时当您一次对建模进行大量更改并开始忘记更改时会出错。您最好的选择可能是重建 EF 生成的模型。

请记住，当您“从数据库更新”时，生成模型上的旧字段不会被删除，您必须手动删除它们。例如，如果您在数据库中将 DateField1 重命名为 DateField2，然后“从数据库更新模型”，您现在将在生成的模型上看到 DateField1 和 DateField2。这可能是错误的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T12:58:37.810

您根本不希望该列出现在模型中吗？

尝试在设计器视图中选择列并按下删除键。

**编辑**

您可以将属性的设置器设为私有。然后您的应用程序将无法修改该值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-01T15:46:35.943

Timestamp 是与 DateTime 不同的数据类型。时间戳似乎被识别为引擎管理的属性，很像身份属性。您不能“更新”时间戳属性。因此，EDM 可以正确管理它（就像它管理身份一样）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-02-28T16:13:39.900

在 EDMX 设计器中，选择属性并将 StoreGeneratedPattern 设置为 Computed。

# php - php中同一字符串中的多个字符串替换

> ID：737522
> 
> 赞同：0
> 
> 时间：2009-04-10T12:46:43.457
> 
> 标签：php, string, preg-replace

我有以下字符串替换问题，我在这里得到了很好的解决

PFB 样本字符串

```
$string = 'The quick sample_text_1 56 quick sample_text_2 78 fox jumped over the lazy dog.';

$patterns[0] = '/quick/';
$patterns[1] = '/quick/';
$patterns[2] = '/fox/';

$replacements[2] = 'bear';
$replacements[1] = 'black';
$replacements[0] = 'slow';

echo preg_replace($patterns, $replacements, $string); 
```

我需要根据我发送的号码替换“快速”

即，如果我对函数的输入是`56`，则需要将`quick`之前`56`替换为`bear`，如果我对函数的输入是`78`，则需要将快速之前`78`替换为`black`

有人可以帮我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T13:16:18.783

我认为正则表达式会使这变得困难，但你应该能够只使用[`strpos()`](http://php.net/strpos),[`substr()`](http://php.net/substr)和[`str_replace()`](http://php.net/str_replace).

*   用于`strpos`在 56 和 78 的字符串中查找位置。

*   然后在这些点使用 将字符串切割成子字符串`substr`。

*   现在，将 'quick' 替换为正确的变量，具体取决于将 56 还是 78 发送到函数以及您正在处理的子字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T13:15:58.080

而不是使用`preg_replace`，用于[`substr_replace`](http://us3.php.net/manual/en/function.substr-replace.php)进行字符串替换和[strpos](http://us3.php.net/manual/en/function.strpos.php)根据您传递的参数在字符串中查找起点和终点。您的模式是一个简单的字符串，因此它不需要正则表达式，并且 substr_replace 将允许您在字符串中指定起点和终点以进行替换（这似乎是您正在寻找的）。

**编辑：**

根据您的评论，听起来您必须进行大量检查。我没有测试过这个，所以它可能有一两个错误，但试试这样的函数：

```
function replace($number, $pattern, $replacement)
{
    $input = "The quick sample_text_1 56 quick sample_text_2 78 fox jumped over the lazy dog.";
    $end_pos = strpos($input, $number);
    $output = "";
    if($end_pos !== false && substr_count($input, $pattern, 0, $end_pos))
    {
        $start_pos = strrpos(substr($input, 0, $end_pos), $pattern);
        $output = substr_replace($input, $replacement, $start_pos, ($start_pos + strlen($pattern)));
    }
    return $output;
} 
```

此函数执行以下操作：

1.  `$end_pos !== false`首先，检查字符串 ( )中是否存在“数字”参数
2.  检查您的模式在字符串开头和数字位置之间是否存在至少一次 ( `substr_count($input, $pattern, 0, $end_pos)`)
3.  使用`strrpos`函数获取模式在子字符串中最后一次出现的位置
4.  使用模式的起始位置和长度插入替换字符串`substr_replace`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T13:20:19.177

你做错了。相反，根据您的函数输入，您应该使用正确的查找和替换值。只需根据您的函数输入值创建查找和替换值的映射。喜欢：

```
$map = array(
  56 => array('patterns' => array(), 'replacements' => array()),
  78 => array(...)
); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-19T07:46:02.333

尝试这个：

```
$searchArray = array("word1", "sound2", "etc3");
$replaceArray = array("word one", "sound two", "etc three");
$intoString = "Here is word1, as well sound2 and etc3";
//now let's replace
print str_replace($searchArray, $replaceArray, $intoString);
//it should print "Here is word one, as well sound two and etc three" 
```

# c# - 如何更改 DataGridView 中的选项卡顺序？

> ID：737523
> 
> 赞同：2
> 
> 时间：2009-04-10T12:47:33.813
> 
> 标签：c#, winforms, datagridview

我的客户希望在通过 DataGridView 单元格切换时，下一个当前单元格不是默认单元格。实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T13:30:37.750

创建自己的 DataGridView，重写 ProcessTabKey 方法。你在那里逻辑吗，使用 SetCurrentCellAddressCore 设置下一个活动单元格。

请注意，该方法的默认实现考虑了许多不同的条件，例如选择模式、编辑模式、行状态、边界等。

**编辑**

或者，您可以处理 KeyUp/KeyDown 事件。虽然，它有一些奇怪的行为而且我没有花太多时间，但这应该可以：

将网格的 StandardTab 属性设置为 True，并添加以下代码：

```
private void Form1_Load(object sender, EventArgs e)
{
    // TODO: Load Data

    dataGridView1.CurrentCell = dataGridView1.Rows[0].Cells[0];

    if (dataGridView1.CurrentCell.ReadOnly)
        dataGridView1.CurrentCell = GetNextCell(dataGridView1.CurrentCell);
}

private void dataGridView1_KeyUp(object sender, KeyEventArgs e)
{
    if (e.KeyCode == Keys.Tab)
    {
        dataGridView1.CurrentCell = GetNextCell(dataGridView1.CurrentCell);
        e.Handled = true;
    }
}

private DataGridViewCell GetNextCell(DataGridViewCell currentCell)
{
    int i = 0;
    DataGridViewCell nextCell = currentCell;

    do
    {
        int nextCellIndex = (nextCell.ColumnIndex + 1) % dataGridView1.ColumnCount;
        int nextRowIndex = nextCellIndex == 0 ? (nextCell.RowIndex + 1) % dataGridView1.RowCount : nextCell.RowIndex;
        nextCell = dataGridView1.Rows[nextRowIndex].Cells[nextCellIndex];
        i++;
    } while (i < dataGridView1.RowCount * dataGridView1.ColumnCount && nextCell.ReadOnly);

    return nextCell;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-06T01:26:06.197

Ruslan 先生的代码对我不起作用。通过获取他的想法，我对代码进行了一些更改。

```
private void dataGridView1_KeyUp(object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.Tab)
        {
            if(dataGridView1.CurrentCell.ReadOnly)
                dataGridView1.CurrentCell = GetNextCell(dataGridView1.CurrentCell);
            e.Handled = true;
        }
    }

    private DataGridViewCell GetNextCell(DataGridViewCell currentCell)
    {
        int i = 0;
        DataGridViewCell nextCell = currentCell;

        do
        {
            int nextCellIndex = (nextCell.ColumnIndex + 1) % dataGridView1.ColumnCount;
            int nextRowIndex = nextCellIndex == 0 ? (nextCell.RowIndex + 1) % dataGridView1.RowCount : nextCell.RowIndex;
            nextCell = dataGridView1.Rows[nextRowIndex].Cells[nextCellIndex];
            i++;
        } while (i < dataGridView1.RowCount * dataGridView1.ColumnCount && nextCell.ReadOnly);

        return nextCell;
    } 
```

# asp.net-mvc - 如何更改 ControllerActionInvoker 类的 ActionInvokeMethod 中的默认操作方法？

> ID：737539
> 
> 赞同：0
> 
> 时间：2009-04-10T12:54:49.457
> 
> 标签：asp.net-mvc, routing

如何更改类中的默认操作`ActionInvokeMethod`方法`ControllerActionInvoker`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T13:37:35.173

这在该功能中不受控制。这来自您的 RouteTable。

例如：

```
routeCollection.MapRoute(null, "{controller}/{action}/{id}", new {action = "Index", id = (string) null}, new {controller = @"[^\.]*"}); 
```

请注意，匿名对象有 action = "Index"

这告诉路由引擎，如果操作不存在，则将其值设置为“索引”。

这可能就是您要在 RouteTable 中修改的路线。如果我在我的应用程序中将其更改为“SomeOtherAction”，那将是触发的默认操作。

希望这可以帮助...

# java - 从 Servlet 发出 URL 请求并保留 Header 信息

> ID：737543
> 
> 赞同：0
> 
> 时间：2009-04-10T12:56:02.823
> 
> 标签：java, servlets, jakarta-ee, urlconnection

我需要从 servlet 发出请求，但我还需要保留所有标头信息。那是在请求对象中。

例如，如果我从 doGet 方法执行以下操作，是否有一种简单的方法可以将该信息传递给 URL Connection 对象？

```
URL url = new URL();
URLConnection uc = url.openConnection();
uc.setDoOutput(true);
uc.setDoInput(true);
uc.setUseCaches(false);

uc.setRequestProperty("Content-type",
"application/x-www-form-urlencoded");

DataOutputStream dos = new DataOutputStream(uc.getOutputStream());
dos.writeBytes(strInEnc);
dos.flush();
dos.close();

InputStreamReader in = new InputStreamReader(uc.getInputStream());
int chr = in.read();
while (chr != -1) {
taResults.append(String.valueOf((char) chr));
chr = in.read(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T14:06:01.940

使用 的[`addRequestProperty`](http://java.sun.com/javase/6/docs/api/java/net/URLConnection.html#addRequestProperty(java.lang.String,%20java.lang.String))方法`URLConnection`。

```
Enumeration<?> names = req.getHeaderNames();
while (names.hasMoreElements()) {
  String key = (String) names.nextElement();
  Enumeration<?> values = req.getHeaders(key);
  while (values.hasMoreElements()) {
    uc.addRequestProperty(key, (String) values.nextElement());
  }
} 
```

如果您使用 HttpClient，您将有一组类似的循环，除非它具有对传递的内置支持`ServletRequest`。（如果没有，为什么还要麻烦一大堆额外的依赖项和非标准 API？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T13:08:39.673

您可以使用 request.getHeaderNames() 方法枚举所有标头。但是，我建议使用[HttpClient](http://hc.apache.org/httpclient-3.x/)而不是 UrlConnection 来发出请求。

# silverlight - Silverlight 和 SQLDataSource

> ID：737553
> 
> 赞同：0
> 
> 时间：2009-04-10T13:02:28.317
> 
> 标签：silverlight, sqldatasource

不能在 Silverlight 应用程序的 aspx 页面中使用 SQLDataSource 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T13:04:24.130

不，但是看看**[RIA 服务](http://blogs.msdn.com/brada/archive/2009/03/19/what-is-net-ria-services.aspx)**。它提供了类似的功能......

*   [Brad Abrams：什么是 .NET RIA 服务？](http://blogs.msdn.com/brada/archive/2009/03/19/what-is-net-ria-services.aspx)
*   [Nikhil Kothari 的博客：.NET RIA 服务：从愿景到架构](http://www.nikhilk.net/NET-RIA-Services-Vision-Architecture.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T13:05:22.863

silverlight 是客户端，您不能使用 sqldatasource

Silverlight 提供的功能本质上只是完整 .NET 框架的一个子集。

如果您需要 Silverlight 应用程序中的数据，则必须调用 Web 服务，该服务将向您提供所需数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T13:46:11.870

选择 ADO .net 数据服务

[http://www.devx.com/MSDN/Article/40735/1763/page/1](http://www.devx.com/MSDN/Article/40735/1763/page/1)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T13:07:42.517

不，您不能使用 SQLDataSource，我将不得不将您转回您之前[关于](https://stackoverflow.com/questions/716875/how-do-i-integrate-a-silverlight-front-end-and-a-database-back-end)同一主题的问题。

# hosting - 为什么 p2p 虚拟主机没有被广泛使用？

> ID：737560
> 
> 赞同：50
> 
> 时间：2009-04-10T13:03:55.100
> 
> 标签：hosting, p2p

我们可以看到使用对等原则的系统的增长。但是有一个领域（还没有）广泛使用点对点：网络托管。

已经启动了几个项目，但是没有大的解决方案可以允许用户使用并为对等虚拟主机做出贡献。

我不是指非开放项目（例如 Google Web Hosting，它使用 Google 资源，而不是用户的资源），而是开放项目，每个用户通过让其资源（cpu、带宽）为托管全球网络托管做出贡献能得到的。

我可以想到这样的系统的几个资产：

*   自动负载均衡
*   更好的地方
*   没有存储限制
*   自由

那么，为什么这样的系统还没有被广泛使用呢？

## 编辑

我认为“97.2%，请种子！！” 出现问题是因为所有用户都没有为所有文件播种。但是，如果构建了一个所有用户对所有内容均等贡献的系统，则不会再出现此问题。多亏了这一点，点对点存储系统（如 Wuala）是可靠的。

专有代码的问题是相关的，以及用户可能不知道他托管的内容（可能是“坏”）的事实。

我添加了另一个问题：延迟可能高于专用服务器。

## 编辑 2

代码和数据的机密性可以通过加密来实现。例如，使用 Wuala，所有文件都是加密的，我认为这个系统中没有已知的安全漏洞（但我可能错了）。

播种机确实不会有很多好处，或者很少。但这会阻止人们依赖网络托管公司。我认为，这种去中心化的网站托管方式更接近于互联网的最初理念。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-10T13:37:25.533

这就是[Freenet](http://freenetproject.org/)的本质，

> Freenet 是一款免费软件，可让您在 Internet 上发布和获取信息，而不必担心受到审查。为了实现这种自由，网络是完全去中心化的，信息的发布者和消费者是匿名的。没有匿名性，就永远不可能有真正的言论自由，没有去中心化，网络将很容易受到攻击。
> 
> [...]
> 
> 用户通过提供带宽和一部分硬盘驱动器（称为“数据存储”）来存储文件来为网络做出贡献。与其他点对点文件共享网络不同，Freenet 不允许用户控制数据存储中存储的内容。取而代之的是，文件会根据它们的受欢迎程度而被保留或删除，最不受欢迎的会被丢弃，以便为更新或更受欢迎的内容让路。数据存储中的文件被加密，以减少希望审查 Freenet 内容的人起诉的可能性。

最大的问题是它很慢。在传输速度和（主要是）延迟方面。。即使你可以让很多人上传吞吐量不错，它仍然永远不会像一两个专用服务器那样快。对于 Freenet 来说，速度很好（发布数据无需担心审查），但不适用于托管您的网站..

更大的问题是内容必须是静态文件，这排除了它用于大多数高流量网站的可能性。为了提供动态数据，每个对等点都必须执行代码（可怕），并且可能必须从一个数据库（这将是另一个很大的延迟，同样是因为延迟）

我认为“云计算”与我们暂时看到的 P2P 网络托管差不多。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-03-12T20:08:21.000

P2P 网站托管尚未广泛使用，因为允许为个人客户提供更高上行速率的配套技术尚未广泛使用，这是我想研究的内容*。

为此需要的是无线网状网络，它应该允许普通用户利用他们的路由器能够提供的全部上行速度，而不是仅仅向他们提供一些暴利的 ISP 口粮，同时他们在其他路由器之间传递信息，以便它最终达到了它的目标。

为了托管一个 P2P 网站，需要在无线网状通信、多冗余 RAID 存储、洪流共享和某种加密密钥层次结构之间进行某种技术组合，以允许不同用户以不同的能力更改正在存储的数据。传输，允许托管动态的东西，例如论坛。系统必须自我更新以合并后者，可能通过对所有分布式数据包进行时间戳记。

可能还有其他可能的催化剂会导致 p2p 托管的广泛使用，但我认为任何将硬件的物理架构返回到实际将互联网连接到其原始网络通信理论的任何东西都是一个很好的候选者。

当然，与往常一样，尚未实施的主要原因是因为其中很少或没有钱。如果有以下任何一种情况，这个想法将被更快地采纳：

1.  有人找到了一种在很大程度上将其腐蚀为消费主义的方法

2.  路由器制造商意识到对 WiMesh-ready 路由器的需求很大

3.  [全球范式](http://www.thezeitgeistmovement.com)正在从利润动机转向创造事物，通过创造丰富和追求最佳效率来造福全人类

*如果您有兴趣开发此概念，请参阅 p2pint dot darkbb dot com

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-10T13:08:11.580

对于我们的业务，我可以想到两个不使用对等托管的原因：

1.  响应能力。由于大量共享资源，对等托管解决方案通常是可靠的，但它们也非常不稳定。所以浏览体验会断断续续。
2.  专有数据/代码。如果我为我的站点编写了自定义逻辑，我不希望网络上的每个人都可以访问。您还会遇到客户数据的隐私问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T13:09:16.460

你看过多少次“97.2%，请播种！！” 对于任何随机洪流？

试想一下，如果网络的一小部分以这种方式变得不可用，将会造成怎样的破坏。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-10T13:09:46.083

如果我将我的一些电脑 CPU 和带宽捐赠给一些 p2p 网络托管服务，我怎么能确定它最终不会被用于提供儿童色情或其他类似恶心的内容？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T13:33:07.680

听起来这个想法会给单个播种机（带宽）增加很多成本，而不会带来很多好处。

# c++ - C++ 中的动态绑定

> ID：737567
> 
> 赞同：5
> 
> 时间：2009-04-10T13:06:35.390
> 
> 标签：c++, dynamic-binding

我需要对 C++ 中的动态绑定进行一些澄清。我对以下内容感到困惑：

1.  在 C 中，您可以拥有一个函数指针数组并分配具有相同签名的不同函数并根据索引调用它们；这是动态绑定吗？

2.  在 C++ 中，您可以拥有一个基类指针数组，但您可以调用派生类的不同函数，通过将派生类对象地址分配给基类指针数组并使用虚函数，这是动态绑定吗？

3.  哪个术语是正确的 -`Dynamic binding`或`Link-Time Binding`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T13:10:58.873

答案

1.  不，这比动态绑定更接近动态调度。动态绑定是指在运行时绑定**命名方法的方式。**这里没有名字。
2.  是的。如果方法是虚拟的，那么这就是动态绑定的定义。该名称在编译时已知，但在不知道运行时对象类型的情况下无法确定调用的方法
3.  我不确定你在这里的意思。动态绑定是更惯用的术语。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T13:13:50.427

我将这两种用法都称为动态绑定。在 C++ 中，语言为您提供了机制，因此您不必像在 C 中那样自行开发。

（我曾经使用过一个应用程序，其中每个主要对象都伴随着一个`struct`其字段是函数指针的传递。结构的目的是允许应用程序实现**运行时**动态绑定 - 即更改分配的函数对象在运行时，取决于对象的状态。据我所知，这个“功能”从未被利用过。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T13:11:02.117

动态绑定是在运行时将接口绑定到其实现 - 程序自动决定调用哪些代码作为接口实现的任何情况。所以一般来说1）和2）都是动态绑定，但是这个词通常只用于2）。

链接时绑定（又名早期绑定）与动态绑定（又名后期绑定）相反。在链接时绑定中，编译器/链接器确切地知道要调用什么代码并直接调用该代码。在动态绑定中，编译器/链接器不知道——确切的实现是在运行时确定的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T13:12:18.590

您是否尝试过用 C 语言编写代码？您为此使用了哪个编译器？C 语言中不能有两个同名的函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T13:16:26.253

您将动态绑定的概念与实现混淆了。动态绑定，即根据接收对象的类型选择调用哪个方法，可以使用某种形式的动态调度来实现，即你的（1），但我们一般定义名称只指情况（2）。

# c++ - 我必须为我的 C++ 类字段使用指针吗？

> ID：737575
> 
> 赞同：13
> 
> 时间：2009-04-10T13:10:51.167
> 
> 标签：c++, pointers, reference

在阅读了关于[指针和引用之间区别](https://stackoverflow.com/questions/57483/difference-between-pointer-variable-and-reference-variable-in-c)的问题后，我决定在我的类字段中使用引用而不是指针。然而，这似乎是不可能的，因为它们不能被声明为未初始化（对吗？）。

在我现在正在处理的特定场景中，我不想使用普通变量（顺便说一句，它们的正确术语是什么？）因为它们在我声明它们时会自动初始化。

在我的代码片段中， bar1 使用默认构造函数自动实例化（这不是我想要的）， &bar2 导致编译器错误，因为您不能使用未初始化的引用（正确吗？），并且 *bar3 很高兴，因为指针可以被声明为未初始化（顺便说一句，将其设置为 NULL 是最佳实践吗？）。

```
class Foo
{
public:
    Bar bar1;
    Bar &bar2;
    Bar *bar3;
} 
```

看起来我必须在这种情况下使用指针，这是真的吗？另外，使用变量的最佳方法是什么？-> 语法有点麻烦……运气不好？那么[智能指针](https://stackoverflow.com/questions/417481/pointers-smart-pointers-or-shared-pointers)等呢？这相关吗？

### 更新1：

尝试在我的类中实现引用变量字段并在构造函数中对其进行初始化后，为什么我会收到以下错误？

```
../src/textures/VTexture.cpp: In constructor ‘vimrid::textures::VTexture::VTexture()’:
../src/textures/VTexture.cpp:19: error: uninitialized reference member ‘vimrid::textures::VTexture::image’ 
```

这是真正的代码：

```
// VTexture.h
class VTexture
{
public:
    VTexture(vimrid::imaging::ImageMatrix &rImage);
private:
    vimrid::imaging::ImageMatrix &image;
}

// VTexture.cpp
VTexture::VTexture(ImageMatrix &rImage)
    : image(rImage)
{
} 
```

我也试过在标题中这样做，但没有运气（我得到同样的错误）。

```
// VTexture.h
class VTexture
{
public:
    VTexture(vimrid::imaging::ImageMatrix &rimage) : image(rImage) { }
} 
```

### 更新 2：

**弗雷德拉森**- 是的！有一个默认构造函数；我忽略了它，因为我认为它与问题无关（我多么愚蠢）。删除默认构造函数后，我导致编译器错误，因为该类与 std::vector 一起使用，它需要有默认构造函数。所以看起来我必须使用默认构造函数，因此必须使用指针。惭愧……是吗？:)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-10T13:13:30.223

**对问题 1 的回答：**

> 然而，这似乎是不可能的，因为它们 [references] 不能被声明为未初始化（对吗？）。

对。

* * *

**对问题 2 的回答：**

> 在我的代码片段中， bar1 使用默认构造函数自动实例化（这不是我想要的）， &bar2 导致编译器错误，因为您不能使用未初始化的引用（正确吗？），

您在构造函数的初始化列表中初始化类的引用：

```
class Foo
{
public:
    Foo(Bar &rBar) : bar2(rBar), bar3(NULL)
    {
    }

    Bar bar1;
    Bar &bar2;
    Bar *bar3;
} 
```

* * *

**对问题 3 的回答：**

> 在我现在正在处理的特定场景中，我不想使用普通变量（顺便说一下，它们的正确术语是什么？）

它们没有正确的名称，通常您可以只为大多数讨论（除了这个）说出指针，并且您需要讨论的所有内容也适用于引用。您可以通过初始化器列表以相同的方式初始化非指针、非引用成员。

```
class Foo
{
public: 
  Foo()  : x(0), y(4)
  {
  }

  int x, y;
}; 
```

* * *

**对问题 4 的回答：**

> 指针可以声明为未初始化（顺便说一句，将其设置为 NULL 是最佳做法吗？）。

它们可以被声明为未初始化的是。最好将它们初始化为 NULL，因为这样您就可以检查它们是否有效。

```
int *p = NULL;
//...

//Later in code
if(p)
{
  //Do something with p
} 
```

* * *

**对问题 5 的回答：**

> 看起来我必须在这种情况下使用指针，这是真的吗？另外，使用变量的最佳方法是什么？

您可以使用指针或引用，但不能重新分配引用并且引用不能为 NULL。指针就像任何其他变量一样，就像 int 一样，但它拥有一个内存地址。数组是另一个变量的别名。

指针有自己的内存地址，而数组应该被视为共享它引用的变量的地址。

使用引用，在它被初始化和声明之后，您可以像使用它引用的变量一样使用它。没有特殊的语法。

使用指针，要访问它所保存的地址处的值，您必须`dereference`指向指针。你可以通过在它前面放一个 * 来做到这一点。

```
int x=0;
int *p = &x;//p holds the address of x
int &r(x);//r is a reference to x
//From this point *p == r == x
*p = 3;//change x to 3
r = 4;//change x to 4
//Up until now
int y=0;
p = &y;//p now holds the address of y instead. 
```

* * *

**对问题 6 的回答：**

> 那么智能指针等呢？这相关吗？

使用智能指针（参见 boost::shared_ptr），以便在堆上分配时无需手动释放内存。我上面给出的例子都没有分配在堆上。这是一个使用智能指针会有所帮助的示例。

```
void createANewFooAndCallOneOfItsMethods(Bar &bar)
{
    Foo *p = new Foo(bar);  
    p->f();
    //The memory for p is never freed here, but if you would have used a smart pointer then it would have been freed here.  
} 
```

* * *

**对问题 7 的回答：**

> 更新1：
> 
> 尝试在我的类中实现引用变量字段并在构造函数中对其进行初始化后，为什么我会收到以下错误？

问题是您没有指定初始化列表。请参阅我对上述问题 2 的回答。冒号后的所有内容：

```
class VTexture
{
public:
    VTexture(vimrid::imaging::ImageMatrix &rImage)
      : image(rImage)
    { 
    }
private:
    vimrid::imaging::ImageMatrix &image;
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-10T13:12:55.903

它们可以被初始化。您只需要使用成员初始化器列表。

```
Foo::Foo(...) : bar1(...), bar2(...), bar3(...)
{
  // Whatever
} 
```

以这种方式初始化所有成员变量是个好主意。否则，对于原始类型以外的其他类型，C++ 无论如何都会使用默认构造函数对其进行初始化。在大括号内分配它们实际上是重新分配它们，而不是初始化它们。

另外，请记住，成员初始化器列表指定了如何初始化成员变量，而不是顺序。成员按照声明它们的顺序进行初始化，而不是按照初始化程序的顺序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T21:19:19.480

使用[空对象设计模式](http://en.wikipedia.org/wiki/Null_Object_pattern)

我正在使用`int`s 但它与任何类型都相同。

```
//header file
class Foo
{
public:
   Foo( void );
   Foo( int& i );
private:
   int& m_int;
};

//source file
static int s_null_Foo_m_i;

Foo::Foo( void ) :
   m_i(s_null_Foo_m_i)
{ }

Foo::Foo( int& i ) :
   m_i(i)
{ } 
```

现在您必须确保 Foo 在默认构造时有意义。您甚至可以检测 Foo 何时被默认构造。

```
bool Foo::default_constructed( void )
{
   return &m_i == &s_null_Foo_m_i;
} 
```

我完全同意这种观点，总是更喜欢引用而不是指针。有两种值得注意的情况是您无法摆脱参考成员：

1.  Null 具有有意义的值。

    这可以通过空对象设计模式来避免。

2.  该类必须是可分配的。

    编译器不会为具有引用成员的类生成赋值运算符。您可以自己定义一个，但您将无法更改引用的绑定位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T13:29:17.177

当你定义 Bar 和 Bar * 时，还有一个副作用

```
class Foo
{
public:
    Bar bar1; // Here, you create a dependency on the definition of Bar, so the header //file for bar always needs to be included.
    Bar &bar2;
    Bar *bar3; //Here, you create a pointer, and a forward declaration is enough, you don't have to always include the header files for Bar , which is preferred.
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T13:20:33.763

```
class Foo {
public:
    Bar bar1;
    Bar &bar2;
    Bar *bar3;

    // member bar2 must have an initializer in the constructor
    Bar::Bar(Bar& _bar2) : bar1(), bar2(_bar2), bar3(new Bar()) {}

    Bar::~Bar() {delete bar3;}
} 
```

请注意，这`bar2`不仅仅是在 ctor 中初始化的；`bar`它使用作为参考参数传入的对象进行初始化。该对象和`bar2`字段将在新`Foo`对象的生命周期内绑定在一起。这通常是一个非常糟糕的主意，因为很难确保两个对象的生命周期能够很好地协调（即，您永远不会在处理对象之前处理传入的 bar`Foo`对象。）

这就是为什么最好使用实例变量（如`bar1`）或指向堆上分配的对象的指针（如`bar3`.）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T13:27:10.083

仅仅因为 -> 语法繁琐而使用引用并不是最好的理由......引用比指针有一个很大的优势，因为如果没有强制转换，空值是不可能的，但也有初始化的缺点和意外非法绑定的风险然后超出范围的临时对象（例如，在隐式转换之后）。

是的，诸如 boost 之类的智能指针几乎总是处理复合成员的正确答案，偶尔也适用于关联成员 (shared_ptr)。

# .net - 如何搜索允许标记的数据库列？

> ID：737578
> 
> 赞同：2
> 
> 时间：2009-04-10T13:11:02.647
> 
> 标签：.net, sql-server-2005, search, full-text-search, markup

可以使用 markdown、bbcode、html 等将文本存储在数据库中。我应该从搜索词中删除任何允许的标签吗？您的标记解析器是否有任何方法可以帮助完成该任务？

我打算使用*类似 '%searchword%' 的*查询。全文搜索是否为这种简单的文本搜索提供了任何优势？

更新：似乎有很多方法可以做到这一点。我会再澄清一下我的情况。这是一个公司的招聘网站，大约有 5 或 7 个 varchar 列可供搜索（其中 4 个允许标记），在任何给定时间大约有 150 个有效的招聘信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T13:25:44.627

如果您的文本中有任何类型的标记（例如 HTML），则在索引和搜索期间您可能无法获得很高的语言准确性。在这种情况下，您有两种选择——首选方法是将文本数据简单地存储在 varbinary(max) 列中，并指明其文档类型以便对其进行过滤。如果这不是一个选项，您可以考虑使用中性分词器，并在可能的情况下将标记数据（例如 HTML 中的“br”）添加到干扰词列表中。

**另见**：

*   [SQL Server 2005 对 HTML 文档的全文搜索](http://www.developmentnow.com/blog/SQL+Server+2005+Full+Text+Search+On+HTML+Documents.aspx)

**替代品**：

*   [Lucene.Net](http://incubator.apache.org/lucene.net/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T13:14:29.550

我会使用一些外部全文搜索工具——例如，Lucene。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T13:23:01.653

我会将该字段的条纹版本存储在单独的字段中并使用全文索引搜索。剥离的字段将使用触发器更新到最新版本

# c++ - 首选单例或函数范围本地静态对象的原因是什么？

> ID：737583
> 
> 赞同：0
> 
> 时间：2009-04-10T13:13:18.900
> 
> 标签：c++, design-patterns

Marshall Clines[的“C++ FAQ Lite”](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.12)和 Scott Meyers 的 Effective C++ 都建议使用返回本地静态对象的函数来避免非本地静态对象初始化顺序可能出现的问题。

简而言之（来自 Scott Meyers 第 3 版的“Effective C++”）：

```
FileSystem& tfs()
{
  static FileSystem fs;
  return fs;
} 
```

两位作者都补充说，这类似于单例模式，只是这不能确保本地 fs 是文件系统的唯一实例。

现在，在资源管理类 T 的一个实例就足够的情况下，您有什么理由更喜欢 Singleton 类或这种本地静态方法？尽管我们的应用程序不需要多个实例，但不一定要将类 T 限制为仅使用一个实例。

显然，在进行 TDD 时，拥有一个全局对象是一个问题，但在这种情况下，这两种方法都是全局的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T13:18:50.743

您可以同时使用：

```
class Singleton {

   public:

      static Singleton & Instance() {
          static Singleton s;
          return s;
      }

   private:

       Singleton() {}
}; 
```

现在可以创建单例的唯一方法是通过实例函数（因为构造函数是私有的），因此您可以保证只存在一个单例。如果您想使用问题中描述的自由函数方法，您可以考虑使该函数成为 Singleton 类的朋友，同时保留私有构造函数。

请注意，此构造（与所有涉及静态变量的构造一样）不是线程安全的。如果线程安全是一个问题，您需要在访问静态 Singleton 变量时考虑使用[双重检查锁定模式之类的东西。](http://en.wikipedia.org/wiki/Double_checked_locking_pattern)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T13:20:50.830

当您不能拥有多个对象时使用 Singleton 说一个`CEO`类 - 显然两个或多个`CEO`s 会破坏您的公司；）对于 Singleton，根据定义，您不能创建多个对象

*   私人演员
*   静态访问器。

然而，函数作用域的本地对象完全不同。这个成语并不排除周围有其他此类物体的可能性。这通常出现`Logger`在您可以创建自己的`Logger`对象的类的情况下，并且库编写器还为您提供了一个`DefaultLogger()`用于快速而丑陋的日志记录的功能，它只是包装了一个`static Logger`对象。

请注意，Singleton 对象访问器的某些实现可以使用函数范围变量惯用语。

# macos - Mac OS X：CGGetLastMouseDelta 和以编程方式移动鼠标

> ID：737594
> 
> 赞同：6
> 
> 时间：2009-04-10T13:17:48.263
> 
> 标签：macos, events, mouse

我正在开发 MATLAB 的 PsychToolbox 的扩展，允许在心理物理实验期间更好地控制鼠标（特别是，防止屏幕边界限制拖动操作......它应该感觉你可以在所有方向上“无限”移动鼠标） . 由于 MATLAB 不支持创建额外的线程（无论如何这对于这种情况来说都是不必要的复杂），我不能使用 Carbon 或 Cocoa 事件管理器。

CGGetLastMouseDelta 对我需要做的事情几乎是完美的（它让我知道鼠标移动的数量” **，因为应用程序收到了最后一个鼠标移动事件**" 忽略屏幕边界），但是有一个小问题。以编程方式移动鼠标时（使用 CGWarpMouseCursorPosition 或 CGDisplayMoveCursorToPoint），不会生成任何事件。因此，CGGetLastMouseDelta 似乎根本不知道鼠标已经移动。在换句话说，如果我以编程方式将鼠标移动 50 像素并向下移动 50 像素，CGGetLastMouseDelta 之后会为鼠标增量返回 (0, 0)。这在我的上下文中是不受欢迎的行为，需要丑陋的解决方法。我试过移动鼠标通过事件系统发布事件，如下（这是“mexFunction”，MATLAB 调用 C 代码的方式）：

```
void mexFunction(int nlhs, mxArray *plhs[], int nrhs, const mxArray *prhs[]) {
    CGEventRef event;
    CGPoint offset;
    CGPoint currentLocation;
    CGPoint newLocation;

    if (nrhs != 2)
        mexErrMsgTxt("The global x and y coordinates (and only those) must be supplied.");

    event = CGEventCreate(NULL);
    currentLocation = CGEventGetLocation(event);
    CFRelease(event);

    offset = CGPointMake((CGFloat) mxGetScalar(prhs[0]), (CGFloat) mxGetScalar(prhs[1]));
    newLocation = CGPointMake(currentLocation.x + offset.x, currentLocation.y + offset.y);

    event = CGEventCreateMouseEvent(NULL, kCGEventMouseMoved, newLocation, kCGMouseButtonLeft);
    CGEventPost(kCGHIDEventTap, event);
    CFRelease(event);
} 
```

这愉快地移动了鼠标，但似乎根本没有改变 CGGetLastMouseDelta 的行为。有谁知道 CGGetLastMouseDelta 返回的确切规格（以及何时？）。Apple 关于这些东西的文档（Quartz 参考）像往常一样几乎没有用（或者至少缺少必要的细节）。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T16:38:34.423

一个好主意可能是用来`CGAssociateMouseAndMouseCursorPosition(0)`断开鼠标移动与光标的连接。然后你就不会遇到屏幕边界的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-17T11:32:46.153

选项 (1) 生成您自己的事件，该事件指定您导致鼠标移动。*选项 (2) 从我移动鼠标*例程中
调用您的鼠标移动事件处理函数。

 *# apache-flex - flex datagrid 焦点单元格

> ID：737597
> 
> 赞同：0
> 
> 时间：2009-04-10T13:19:29.600
> 
> 标签：apache-flex, actionscript-3, air

我有一个数据网格，其中的列具有自定义 itemRenderer（画布上的文本流）。现在我想对每个单元格的文本流执行查找文本操作。为此，我能够在焦点单元格上进行查找文本操作。但是现在我的要求是找到所有的文本。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T15:05:26.180

如果您使用的是自定义 itemRenderer，是否可以从 data 属性派生出可搜索的文本？这样，您只需为 dataGrid 设置 dataProvider 并进行搜索。

```
<mx:itemRenderer>
    <mx:Component>
        <ns1:customTextBox searchedText={data.searchedText} text={data.text}/>    
    </mx:Component>
</mx:itemRenderer> 
```

然后您修改 data.searchedText，它链接到您的 dataProvider（请记住使用 ArrayCollection，以便它响应 dataChange 事件）。

# windows - windows命令行合并工具

> ID：737599
> 
> 赞同：2
> 
> 时间：2009-04-10T13:20:00.723
> 
> 标签：windows, git, command-line, merge, conflict

是否有适用于 Windows 的命令行合并工具？我正在考虑可以与其他工具（例如 git、unison）结合使用以解决冲突的工具。

实际上，它不需要严格基于命令行，只要它与其他命令行工具（如我提到的，例如 git）“合作”，就可以了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:15:26.923

[Araxis Merge](http://www.araxis.com/merge/command_line.html)是适用于 Windows 和 Mac 的出色差异/合并工具，它们还提供命令行和 .NET API 版本的差异/合并引擎。

Araxis Merge 是我目前知道的唯一一个可以比较和合并具有不同文本编码的两个文件的工具，例如并排的 UTF-8 和 ANSI 文件。

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T13:30:54.973

我使用过[KDiff3](http://kdiff3.sourceforge.net/)并且听说过有关[WinMerge](http://winmerge.org/)的好消息。我不确定你在寻找什么命令行合作；我将这些工具与 TortoiseSVN 结合使用，没有任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T13:32:44.670

图形合并工具（如 WinMerge）的问题在于，例如，Git[**等待*退出代码***（或 diff 工具退出后用户的验证）](https://stackoverflow.com/questions/585844/merging-with-git-mergetool/586002#586002)，这意味着用户首先关闭外部 diff 工具。

纯粹的命令行差异工具对于合并目的不是很实用......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T17:59:01.963

Beyond Compare 3 Pro 支持命令行合并，可以交互或非交互方式处理它们（自动合并没有窗口）。它设置退出代码，因此它可以与其他工具集成，并且它确实处理合并具有不同编码的文件。

# sql-server - C++ 编程中的 SQLSERVER 管理对象

> ID：737610
> 
> 赞同：0
> 
> 时间：2009-04-10T13:22:46.567
> 
> 标签：sql-server

如何在 C++(CPP) 中使用 SQLSERVER SMO 列出所有可用的服务器并查找使用 VS2003/VS2005 IDE 安装的数据库。

我需要澄清一下

1)Vs2003是否支持SQLSMO？？2）在VS2003中使用SMO是否需要任何额外的文件（参考）？如果是，那是什么？

提前致谢...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T14:12:45.153

SMO（SQL Server 管理对象）随 SQL Server 2005 一起发布，至少需要 .NET 2.0。VS 2003 仅支持 .NET 1.x。

在 .NET 1.x 中，您必须恢复到 SQL-DMO——一组基于 COM 的组件，用于管理 SQL Server 数据库对象。

马克

# html - Textarea CSS IE7 和“输入键”创建内联空间

> ID：737614
> 
> 赞同：1
> 
> 时间：2009-04-10T13:24:34.143
> 
> 标签：html, css, internet-explorer-7, textarea

在 ie7 下，我在 textareas 上有一个奇怪的问题。当我输入一些东西并按下输入时，如果换行，似乎会添加一个空格。

它似乎与 CSS 相关，因为当我删除 Javascript 时，错误仍然存​​在。当我删除 CSS 时，它按预期工作。

当我在我的样式中删除所有提到的 textarea 时，错误并没有消失。所以也许它是更复杂的东西的父样式。

欢迎所有提示

[http://g.imagehost.org/download/0038/textarea_bug](http://g.imagehost.org/download/0038/textarea_bug)

这是文件

[http://www.2shared.com/file/5302450/2f33f63c/page.html](http://www.2shared.com/file/5302450/2f33f63c/page.html)

**单击右下角的链接以“下载 zip”**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T14:13:38.940

问题似乎是您的重置样式。文本区域有空格：正常，这显然是 IE7 不喜欢的。

将此标签放在您的重置线下方。我在 IE7 和 chrome 中对此进行了测试。

```
textarea { white-space:pre; } 
```

# wpf - 是否有用于 WPF 的虚拟化 WrapPanel 可用？商业或免费的

> ID：737621
> 
> 赞同：3
> 
> 时间：2009-04-10T13:29:30.793
> 
> 标签：wpf, wrappanel

是否有可用的虚拟化 WrapPanel？商业或免费的。

我看过一些博客（包括 dan），但它在我的应用程序中似乎效果不佳，尤其是当我有不同大小的子项目时。

即使尺寸相同，那些免费的也不能很好地工作。

市面上有没有商用的？我找不到任何东西。

请给出意见。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-24T21:00:39.550

对于商业的，我会说尝试 Binarymission 我不能发布链接，因为我是新用户，但如果你用谷歌搜索“binarymission”，你会到达那里。它是一个商业 WPF + Winforms UI 库网站。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-19T21:41:33.153

还有：

[http://virtualwrappanel.codeplex.com/](http://virtualwrappanel.codeplex.com/)这是免费的（MIT 许可证）

和

[http://www.codeproject.com/KB/WPF/VirtualizingWrapPanel.aspx](http://www.codeproject.com/KB/WPF/VirtualizingWrapPanel.aspx)也是免费的（代码项目开放许可证（CPOL））

# postgresql - "select abc from (select 1) as abc" 产生 "(1)" 而不是 "1"

> ID：737625
> 
> 赞同：1
> 
> 时间：2009-04-10T13:32:07.713
> 
> 标签：postgresql, alias

在 Postgre 中，为什么

```
select abc from (select 1) as abc 
```

产生：

```
(1) 
```

和

```
select * from (select 1) as abc 
```

产生：

```
1 
```

这对我来说真的很奇怪。MySQL、Oracle 等是这种情况吗？我花了几个小时弄清楚为什么我的条件失败了......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T13:37:16.237

您的查询返回的行具有不同的类型：第一个是[`ROW(INT)`](http://www.postgresql.org/docs/8.0/interactive/rowtypes.html)，而第二个是`INT`。

`MySQL`而其他人则缺乏此功能。

在您的第一个查询中，您选择一个整体`ROW`作为单列。这个查询

```
SELECT abc FROM (SELECT 1, 2) abc 
```

将产生`(1, 2)`，这也是一个单列并且具有类型`ROW`。

要选择`INT`值，请使用：

```
SELECT  abc.col
FROM    (
        SELECT  1 AS col
        ) abc 
```

# asp.net - ASP.NET MVC 控制器操作每个请求执行 4 次

> ID：737645
> 
> 赞同：2
> 
> 时间：2009-04-10T13:40:22.670
> 
> 标签：asp.net, asp.net-mvc, firebug

有没有人遇到过这样的事情？基本上，我在控制器上有一个操作，它仅通过存储库模式查询数据库，将一些数据添加到 ViewData 然后返回视图。但由于某种原因**，每个请求都会调用此操作 4 次**。

整个动作本身只有大约 10 行长：

```
public ActionResult Details(int id, string slug) {
    Product p = productRepository.GetProduct(id);

    IEnumerable<Image> imgs = productRepository.GetImages(p.ProductId);
    if (imgs.Count() > 0) {
        ViewData["MainImage"] = imgs.First();
        ViewData["Images"] = imgs;
    }

    Brand brand = productRepository.GetBrand(p.ProductId);
    ViewData["Brand"] = brand;

    var categories = productRepository.GetCategories(p.ProductId, true);
    ViewData["ProductCategories"] = categories;

    return View("Details", p);
} 
```

另外，我的 Global.asax 中定义的路由如下：

```
routes.MapRoute(
    "SlugsAfterId",
    "{controller}.mvc/{action}/{id}/{slug}",
    new { controller = "Products", action = "Browse", id = "" }
);

// The default route that comes with ASP.NET MVC
routes.MapRoute(
    "Default",                                              // Route name
    "{controller}.mvc/{action}/{id}",                           // URL with parameters
    new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
); 
```

任何人都可以对此有所了解吗？我完全被难住了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-10T14:12:01.333

看起来这些请求可能是客户端请求，如图像、css 或 js 文件。

# snmp - SNMP MIB Visualizer 推荐？

> ID：737647
> 
> 赞同：2
> 
> 时间：2009-04-10T13:41:18.130
> 
> 标签：snmp, mib

是否有任何免费的 MIB 可视化工具？我已经分配了一些 SNMP 陷阱规范化/丰富工作，并从 Cisco ONS 15454 开始。MIB 似乎比我见过的其他 MIB 更复杂。许多对象交叉引用，包括一些在其他 MIB 中定义并导出的对象。一个尝试追踪警报端口号的简单示例：

报警定义：

```
Cerent454AlarmEntry ::= SEQUENCE {
    cerent454AlarmIndex          INTEGER,
    cerent454AlarmObjectType     Cerent454EntityClass,
    cerent454AlarmSlotNumber     INTEGER,
    cerent454AlarmPortNumber     CerentPortNumber,
    cerent454AlarmLineNumber     INTEGER,
    cerent454AlarmObjectIndex    INTEGER,
    cerent454AlarmType           Cerent454AlarmType,
    cerent454AlarmState          CerentNotificationClass,
    cerent454AlarmTimeStamp      TimeStamp,
    cerent454AlarmObjectName     DisplayString,
    cerent454AlarmAdditionalInfo DisplayString
} 
```

来自同一文件 (CERENT-454.mib) 的 CerentPortNumber 引用：

```
IMPORTS
    (...)
    CerentPortNumber
        FROM CERENT-TC

(...)
cerent454AlarmPortNumber OBJECT-TYPE
    SYNTAX      CerentPortNumber
    ACCESS      read-only
    STATUS      mandatory
    DESCRIPTION 
        "This will indicate what is the port
         of the object which raised this alarm."
    ::= { cerent454AlarmEntry 40 } 
```

CerentPortNumber 的实际语法，来自 CERENT-TC.mib：

```
CerentPortNumber ::=
      INTEGER
      {        unknown   (1),
               port0     (5),
               port1    (10),
               port2    (20),
               (...)
               port62  (620),
               port63  (630),
               port64  (640),
               portAll (10240)
             } 
```

也许这并不像它感觉的那么复杂，但这只是一个小例子。感觉应该有一个基于 GUI 的“资源管理器”类型的应用程序，它可以让我轻松查看这些引用，而无需在文件和文件中的位置之间来回切换。有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T13:46:54.700

我使用[iReasoning 的 MIB Browser](http://www.ireasoning.com/mibbrowser.shtml)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T13:44:56.403

我以前使用的是[MIB Browser](http://www.snmp-browser.com/)。

但是在谷歌上寻找 MIB 查看器会给你很多其他的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T13:45:55.217

我希望您可以在一定程度上使用 Mgsoft-MIB 浏览器试用版。

问候哈拉纳德

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-19T12:48:29.707

您可以在 Linux 领域使用 tkmib 和 snmpb。

# c++ - 在 C++ 中的错误条件下退出构造函数的最佳技术是什么

> ID：737653
> 
> 赞同：25
> 
> 时间：2009-04-10T13:43:05.927
> 
> 标签：c++, constructor

在 C++ 中的错误条件下退出构造函数的最佳技术是什么？特别是，这是打开文件的错误。

感谢您的回复。我抛出一个异常。这是代码（不知道这是否是*最好*的方法，但它很简单）

```
// Test to see if file is now open; die otherwise 
if ( !file.is_open() ) {
    cerr << "Failed to open file: " << m_filename << endl;
    throw ("Failed to open file");
} 
```

我认为我喜欢 C++ 的一个原因是您不必在方法声明中声明抛出的异常。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-10T13:43:46.033

最好的建议可能是 parashift 所说的。但请阅读下面的注意事项。

[请参阅 parashift 常见问题解答 17.2](http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.2)

> [17.2] 如何处理失败的构造函数？
> 
> 抛出异常。
> 
> 构造函数没有返回类型，因此不可能使用返回码。因此，发出构造函数失败信号的最佳方法是抛出异常。如果您没有使用异常的选项，“最坏”的解决方法是通过设置内部状态位将对象置于“僵尸”状态，这样对象的行为就好像它已经死了，即使它是技术上还活着。
> 
> “僵尸”对象的想法有很多缺点。您需要添加一个查询（“检查器”）成员函数来检查这个“僵尸”位，以便您的类的用户可以找出他们的对象是否真的活着，或者它是否是僵尸（即“活死人”对象） ，并且几乎在您构造一个对象的每个地方（包括在更大的对象或对象数组中），您都需要通过 if 语句检查该状态标志。您还需要在其他成员函数中添加 if：如果对象是僵尸，则执行无操作或者更讨厌的操作。
> 
> 在实践中，“僵尸”的东西变得非常丑陋。当然你应该更喜欢异常而不是僵尸对象，但是如果你没有使用异常的选项，僵尸对象可能是“最不坏”的选择。

* * *

**在构造函数中抛出异常的注意事项：**

但是要非常小心，因为如果在构造函数中抛出异常，则不会调用类的析构函数。所以你需要小心在抛出异常之前破坏你已经构造的对象。相同的警告通常适用于异常处理，但在处理构造函数时可能不太明显。

```
class B
{
public:
    B()
    {

    }

    virtual ~B()
    {
        //called after D's constructor's exception is called
    }
};

class D : public B
{
public:
    D()
    {
        p = new char[1024];
        throw std::exception("test");
    }

    ~D()
    {
      delete[] p;
      //never called, so p causes a memory leak
    }

    char *p;
};

int main(int argc, char **argv)
{

    B *p;
    try
    {
        p = new D();
    }
    catch(...)
    {

    }

    return 0;
} 
```

**具有 CreateInstance 方法的受保护/私有构造函数：**

解决此问题的另一种方法是使您的构造函数私有或受保护，并创建一个可以返回错误的 CreateInstance 方法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-10T14:21:54.367

正如其他人所提到的，您可以抛出异常，或者您也可以重构您的代码，以便您的构造函数不会失败。例如，如果您正在处理一个禁用或不允许异常的项目，那么后者是您的最佳选择。

要使构造函数不会失败，请将可能失败的代码重构为`init()`方法，并让构造函数做的工作尽可能少，然后要求类的所有用户`init()`在构造后立即调用。如果`init()`失败，您可以返回错误代码。确保在您的班级文档中记录这一点！

当然，这有点危险，因为程序员可能会忘记调用`init()`. 编译器无法强制执行此操作，因此请谨慎行事，并尝试使您的代码`init()`在未调用时快速失败。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-10T13:47:00.800

一般来说，你应该抛出一个异常。另一种方法是拥有一些构造不正确的对象，用户必须以某种方式对其进行测试，而他们将不可避免地无法做到这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T13:48:48.470

如果您正在构建的对象由于错误而无效，并且需要由调用者处理，那么您几乎必须抛出异常。这允许编译器执行正确的资源释放。

（编写异常安全的构造函数需要一点小心——简而言之，你需要尽可能使用初始化列表，而不是使用构造函数主体——但如果你有这样的情况，抛出异常，这很关键是一个很大的可能性。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T13:45:46.933

如果您在错误后对象无法执行其操作 - 您必须抛出。如果可以 - 记录您的错误并更改构造逻辑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T13:47:17.960

抛出异常。在这里查看更多信息：[在构造函数中处理错误](http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.2)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-10T14:05:34.093

从错误的构造函数中退出只有一种好方法，即引发异常。

真的是错误吗？您是否要向构造函数添加太多内容？

通常人们会尝试在构造函数中加入一些初始交互，比如将文件名添加到文件构造函数中。您是否希望它立即打开该文件，或者您只是设置一些状态，它与 file.open(filename) 是否不同，如果它失败了可以吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-10T14:57:42.253

最好的办法是抛出异常。这就是他们的目的，任何复制你得到的行为的尝试都可能在某个地方失败。

如果由于某种原因您不能使用异常，请使用`nothrow`. 标准 18.4.1.1 第 9 条中的示例是：

```
t* p2 = new(nothrow) T;    // returns 0 if it fails 
```

这在技术上是一种新的放置形式，但它应该返回一个完全形成的对象或一个您需要测试的空指针，除非没有人会这样做。

如果您的类可以有一个存在但未正确初始化的对象，您可以有一个数据成员作为该类是否有用的标志。同样，没有人会在实时代码中检查该标志。

请记住，如果您确实需要保证不会失败的分配，则需要提前分配内存并使用placement new，并删除所有可能抛出到另一个例程的初始化，而有人会失败称呼。任何分配内存的事情都可能失败，尤其是在通常不支持异常的更受限类型的系统上。

真的，例外是最好的方法。

# sql - Postgres - 如何检查空数组

> ID：737669
> 
> 赞同：72
> 
> 时间：2009-04-10T13:49:29.547
> 
> 标签：sql, arrays, postgresql

我正在使用 Postgres，我正在尝试编写这样的查询：

```
select count(*) from table where datasets = ARRAY[] 
```

即我想知道某列有多少行有一个空数组，但 postgres 不喜欢这样：

```
select count(*) from super_eds where datasets = ARRAY[];
ERROR:  syntax error at or near "]"
LINE 1: select count(*) from super_eds where datasets = ARRAY[];
                                                             ^ 
```

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-04-10T13:56:32.727

语法应该是：

```
SELECT
     COUNT(*)
FROM
     table
WHERE
     datasets = '{}' 
```

您使用引号和花括号来显示数组文字。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-10T15:17:10.847

您可以使用 array_upper 和 array_lower 函数在空数组上返回 null 的事实，因此您可以：

```
select count(*) from table where array_upper(datasets, 1) is null; 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2020-05-07T17:04:57.843

如果你像我一样在 2020 年找到这个问题，那么正确答案是

```
select count(*) from table where cardinality(datasets) = 0 
```

`cardinality`在 PostgreSQL 9.4 中添加，也就是 ~2015

[https://www.postgresql.org/docs/9.4/functions-array.html](https://www.postgresql.org/docs/9.4/functions-array.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-03-08T21:48:26.607

```
解决方案查询：

```

```
select id, name, employee_id from table where array_column = ARRAY[NULL]::array_datatype; 
```

```
例子：

```

表_emp：

```
id (int)| name (character varying) | (employee_id) (uuid[])
1       | john doe                 | {4f1fabcd-aaaa-bbbb-cccc-f701cebfabcd, 2345a3e3-xxxx-yyyy-zzzz-f69d6e2edddd }
2       | jane doe                 | {NULL}

select id, name, employee_id from tab_emp where employee_id = ARRAY[NULL]::uuid[];

    -------
2       | jane doe                 | {NULL} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T13:57:01.710

```
SELECT  COUNT(*)
FROM    table
WHERE   datasets = ARRAY(SELECT 1 WHERE FALSE) 
```

# git - 如何读取 git-ls-tree 输出的模式字段

> ID：737673
> 
> 赞同：111
> 
> 时间：2009-04-10T13:53:06.527
> 
> 标签：git, file-permissions, git-ls-tree

```
$ git ls-tree fb3a8bdd0ce
100644 blob 63c918c667fa005ff12ad89437f2fdc80926e21c    .gitignore
100644 blob 5529b198e8d14decbe4ad99db3f7fb632de0439d    .mailmap
100644 blob 6ff87c4664981e4397625791c8ea3bbb5f2279a3    COPYING
040000 tree 2fb783e477100ce076f6bf57e4a6f026013dc745    Documentation
100755 blob 3c0032cec592a765692234f1cba47dfdcc3a9200    GIT-VERSION-GEN
100644 blob 289b046a443c0647624607d471289b2c7dcd470b    INSTALL
100644 blob 4eb463797adc693dc168b926b6932ff53f17d0b1    Makefile
100644 blob 548142c327a6790ff8821d67c2ee1eff7a656b52    README
... 
```

我知道最后 3 位八进制数字是文件模式，但前 3 位数字是什么？我在 git 用户手册中找不到它。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2011-12-01T19:44:04.353

从 Git[`index-format.txt`](https://github.com/git/git/blob/master/Documentation/technical/index-format.txt)文件中，关于模式：

```
32-bit mode, split into (high to low bits)

    4-bit object type
      valid values in binary are 1000 (regular file), 1010 (symbolic link)
      and 1110 (gitlink)

    3-bit unused

    9-bit unix permission. Only 0755 and 0644 are valid for regular files.
    Symbolic links and gitlinks have value 0 in this field. 
```

此外，如方法所示，允许目录对象类型（二进制 0100）和组可写（0664 权限）常规文件。常规的不可执行组可写文件是早期版本的 Git 支持的非标准模式。[`fsck.c`](https://github.com/git/git/blob/master/fsck.c) `fsck_tree`

这使得有效模式（二进制和八进制）：

*   `0100000000000000`( `040000`): 目录
*   `1000000110100100`( `100644`): 常规非可执行文件
*   `1000000110110100`( `100664`): 常规不可执行的组可写文件
*   `1000000111101101`( `100755`): 常规可执行文件
*   `1010000000000000`( `120000`)：符号链接
*   `1110000000000000`（`160000`）：Gitlink

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2009-04-10T14:52:52.857

6 位数字显示使用经典 UNIX 符号的文件模式。前两位数字显示文件类型，第三位是关于 set-uid/set-gid/sticky 位，您知道最后三位。

以下是`man 2 stat`在我的 GNU/Linux 系统上记录它的方式：

```
 The following flags are defined for the st_mode field:

       S_IFMT     0170000   bit mask for the file type bit fields
       S_IFSOCK   0140000   socket
       S_IFLNK    0120000   symbolic link
       S_IFREG    0100000   regular file
       S_IFBLK    0060000   block device
       S_IFDIR    0040000   directory
       S_IFCHR    0020000   character device
       S_IFIFO    0010000   FIFO
       S_ISUID    0004000   set UID bit
       S_ISGID    0002000   set-group-ID bit (see below)
       S_ISVTX    0001000   sticky bit (see below)
       S_IRWXU    00700     mask for file owner permissions
       S_IRUSR    00400     owner has read permission
       S_IWUSR    00200     owner has write permission
       S_IXUSR    00100     owner has execute permission
       S_IRWXG    00070     mask for group permissions
       S_IRGRP    00040     group has read permission
       S_IWGRP    00020     group has write permission
       S_IXGRP    00010     group has execute permission
       S_IRWXO    00007     mask for permissions for others (not in group)
       S_IROTH    00004     others have read permission           
       S_IWOTH    00002     others have write permission
       S_IXOTH    00001     others have execute permission 
```

# java - Java 中的 MSXML 解析器

> ID：737682
> 
> 赞同：0
> 
> 时间：2009-04-10T13:57:57.573
> 
> 标签：java, xml, msxml, xml-parsing

我们的应用程序是用 VC++ 编写的，我们使用 MSXML 进行解析。现在我们想将 MSXML 文档对象从我们的应用程序传递到 java 应用程序进行处理。我怎样才能做到这一点？java (swing) 是否支持 MSXML 或 MSXML 对象？我们正在使用 DOM 解析器。

任何帮助表示赞赏，

谢谢，KK

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T14:01:57.470

为什么不只传递 XML 文档本身（即序列化为文本）？你会省去一个大麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T16:59:48.937

不，Java 不支持 MSXML 对象。或许，您应该做的是将文档序列化为字符串，然后以某种方式将该字符串传输到 Java 应用程序。

传输它的一种方法是将其保存到 VC++ 应用程序中的磁盘文件中，然后从 Java 应用程序中的磁盘文件中读取它。另一种方法是通过 HTTP 接口通过网络发送。在这种情况下，Java 应用程序必须有一个 HTTP 侦听器在 TCP 端口上等待。另一种选择是使用 MSMQ：将字符串放在 VC++ 中的队列中，从 Java 中的 MSMQ 中提取消息。您可以使用一个简单的套接字类。还有更多选择。

但在所有情况下，您都将传输 XML 的字符串表示形式，而不是实际的内存中 MSXML 对象。

# c# - 如何安全地将数据库值分配给对象属性？

> ID：737683
> 
> 赞同：1
> 
> 时间：2009-04-10T13:58:17.043
> 
> 标签：c#, .net

我有一些（多一点）代码，其中来自 DataReader 的对象值被分配给业务对象属性。这段代码看起来很不整洁，有很多空合并、解析等。我想知道如何实现一种更简洁的方法，将对象值从 DataReader 转换为对象属性的适当值。

一种选择是为每种数据类型提供离散的转换函数，其中我的对象属性上的数据类型仅限于一小组 CLR 原始类型。我不使用可为空的类型，因为我只是将不整洁的地方移到其他地方使用这些值的地方。

我的第二个选择是为所使用的大约四种数据类型中的每一种创建一个扩展方法，仅限于这些分配发生的利基名称空间。像这个相当简单的例子：

```
 public static void SafelyAssign(this string target, object value)
    {
        if (value is string)
        {
            target = (string)value ?? "";
        }
        else
        {
            target = value.ToString();
        }
    } 
```

我还有什么其他选择？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:08:11.450

我喜欢的一个解决方案是从[CSLA.Net](http://www.lhotka.net/cslanet/Default.aspx)框架中采用的。创建一个实现 IDataReader的[SafeDataReader 。](http://www.lhotka.net/cslacvs/viewvc.cgi/branches/V3-5-x/cslacs/Csla/Data/SafeDataReader.cs?revision=3286&view=markup)我会尝试找到一个链接，但这里有一个如何获得安全 int 的示例。此解决方案不需要 CSLA.Net 框架，这正是他解决问题的方式，我觉得非常方便。

```
public class SafeDataReader : IDataReader, ISafeDataRecord
{
    /// <summary>
    /// Gets an integer from the datareader.
    /// </summary>
    /// <remarks>
    /// Returns 0 for null.
    /// </remarks>
    public int GetInt32(string name)
    {
        return GetInt32(_dataReader.GetOrdinal(name));
    }
    /// <summary>
    /// Gets an integer from the datareader.
    /// </summary>
    /// <remarks>
    /// Returns 0 for null.
    /// </remarks>
    public int GetInt32(int i)
    {
        if (_dataReader.IsDBNull(i))
            return 0;
        else
            return _dataReader.GetInt32(i);
    }

    public object this[string name]
    {
        get
        {
            object val = _dataReader[name];
            if (DBNull.Value.Equals(val))
                return null;
            else
                return val;
        }
    }
    public Nullable<T> GetNullable<T>(string name) where T:struct
    {
        int index = _dataReader.GetOrdinal(name);

        if (_dataReader.IsDBNull(index))
        {
            return null;
        }
        else
        {
            return new Nullable<T>((T)_dataReader[index]);
        }
    }
} 
```

编辑：好的，我们如何使用这个安全的数据阅读器？所以让我们假设我们有一个 cmd 对象，它是所有设置

```
 using (SafeDataReader reader=new SafeDataReader(cmd.ExecuteDataReader())
   {
       //Assume MyColumn was null here, this will still work because 
       //since a string can be null 
       string myString=reader["MyColumn"];

       //In this case myInt will be set to 0 if MyColumn is DBNull
       int myInt=reader.GetInt("MyColumn");

   } 
```

您也可以使用 GetNullable 方法，虽然这不是他的课程的一部分，我不确定它来自哪里，但它看起来对我来说是正确的。

这有多便携？好吧，既然它正在实现 IDataReader 它应该是非常便携的；并且只要调用代码不期望返回 DBNull.Value 就应该能够被换入和换出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T14:04:49.400

我不会重新发明轮子，而是简单地使用。

```
oReader.GetString(oReader.GetOrdinal("MyColumn")) 
```

这将使您的价值成为特定类型。重要的是要注意，如果您在此过程中具有空值，您仍然可能会遇到问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T14:39:15.167

我更有可能扩展 SQLDataReader（下面的 Int32 示例）

```
// safe int32 assignment (using column name)
public static int GetInt32Safe(this SqlDataReader dr, string column)
{ 
    object value = dr[column];
    if (value != DBNull.Value)
    {
        return (int)value;
    }
    else
    {
        return 0;
    }
}

// safe int32 assignment (using column index)
public static int GetInt32Safe(this SqlDataReader dr, int colno)
{ 
    if (!dr.IsDBNull(colno))
    {
        return dr.GetInt32(colno);
    }
    else
    {
        return 0;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T15:31:31.280

我更喜欢使用可为空的类型。以下方法可用于任何类型。您只需要提供列名。如果您不使用 Nullable 类型，则可以摆脱 IsNullable 检查。

```
public static bool IsNullableType(Type valueType)
{
    return (valueType.IsGenericType && 
        valueType.GetGenericTypeDefinition().Equals(typeof(Nullable<>)));
}

public static T GetValue<T>(this IDataReader reader, string columnName)
{
    object value = reader[columnName];
    Type valueType = typeof(T);
    if (value != DBNull.Value)
    {
        if (!IsNullableType(valueType))
        {
            return (T)Convert.ChangeType(value, valueType);
        }
        else
        {
            NullableConverter nc = new NullableConverter(valueType);
            return (T)Convert.ChangeType(value, nc.UnderlyingType);
        }
    }            
    return default(T);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T16:24:40.653

我选择了一条稍微不同的路线来解决这个问题。我选择制作一个类似于 Parse() 方法的通用静态库，并使用 Parse() 方法在任何对象上实现此目的。它开始是因为我在紧凑的框架上，它没有 TryParse() 方法。这有点工作，我相信还有更有效的方法；但它工作得很好，并且被我的同事很好地接受了。

此外，性能比我预期的要好。由于我大量使用异常，我预计性能会有所下降。其中一种方法的示例是：

```
 public static class Parser{
  public static DateTime GetDateTime(object value){
    return GetDateTime(value, default(DateTime));
  }

  public static DateTime GetDateTime(object value, DateTime defaultValue){
    try{
      return DateTime.Parse(value.ToString());
    }
    catch{
      return defaultValue;
    }
  }
} 
```

这使我可以拨打任何电话；包括数据阅读器。

```
 DateTime dateTime = Parser.GetDateTime(oReader("BirthDate")); 
```

正如我所说，我最初的意图是在 CF 上实现 TryParse() 方法，但即使在桌面上也对我们来说效果很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-11T10:40:15.140

作为一项临时措施，我创建了一个扩展方法`AssignObjectValue`，对我分配给的五种原始类型中的每一种都调用。这使我可以在每个分配上调用“相同”方法，而不管 LHS 类型如何。我本来希望能够为此使`=`操作员超载，但我现在很高兴。我的代码看起来像这样：

```
 cDoc.DocType.AssignObjectValue(dr["DocType"]);           // int
        cDoc.DocID.AssignObjectValue(dr["docID"]);
        cDoc.CustomerNo.AssignObjectValue(dr["customerNo"]);     // string
        cDoc.InvTitle.AssignObjectValue(dr["InvTitle"]);
        cDoc.TaxPercent.AssignObjectValue(dr["taxPercent"]);     // double
        cDoc.TaxTypeID = GetTaxTypeIDForDocType(cDoc.DocType);
        cDoc.Remarks.AssignObjectValue(dr["remarks"]);
        cDoc.Cost.AssignObjectValue(dr["cost"]);                 // double
        cDoc.InvDate.AssignObjectValue(dr["InvDate"]);           // date 
```

这或多或少是我想去的地方。我最终将基于映射字典在循环中进行分配，而不是在代码中显式地进行分配，所以我认为我的“半”解决方案对于投入临时修复的时间来说还不错。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-15T15:48:20.667

这个作为 SqlDataReader 的扩展方法怎么样：

```
public static T GetValueNotNull<T>(this SqlDataReader reader, object checkValue)
    {
        T outValue;
        if (checkValue == DBNull.Value)
            outValue = default(T);
        else
            outValue = (T)checkValue;
        return outValue;
    } 
```

而不是为每个原始类型使用一个泛型，如果值为 DBNull，则返回指定类型的默认值。我认为这可以在必要时针对任何类型的 DataReader 而不是 SqlDataReader 进行调整。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-04-01T23:20:48.697

我的解决方案是：

```
private static T GetValue<T>(object o) {
    if (typeof(DBNull) != o.GetType()) {
        return (T) o;
    }
    return default(T);
} 
```

什么时候，`Status = GetValue<string>(currentDataRow["status"])`

# masking - 数据屏蔽/加扰

> ID：737691
> 
> 赞同：1
> 
> 时间：2009-04-10T14:01:39.407
> 
> 标签：masking, data-masking

这是专门针对医疗保健领域的。在将数据从生产环境复制到测试环境时，您使用哪些解决方案/工具来屏蔽 PHI 数据

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-04-11T06:25:18.310

并非特定于医疗保健行业，但我们对电信客户有类似的要求。我们希望能够在测试系统中提供有代表性的数据，但要确保没有复制敏感信息。

为此，我们尝试了许多不同的方法，包括我们选择的方法：

1.  将用于代替直接表访问的视图 - 这些视图基本上会将来自真实表的非敏感信息与来自单独表的虚拟信息连接起来。虚拟信息替换了真实表中的所有敏感信息。

2.  通过清理过滤器传输数据。这基本上会卸载生产数据库并将其传递给替换敏感信息的匿名程序。对于简单的情况，地址之类的东西都设置相同。

3.  与上面的 (2) 类似，但过滤器可以使用来自特定查找数据的数据。例如，地址可以由 4 位街道编号、从 1000 个最常见的街道名称中选择的名称、街道类型（ST、RD、CRES、WAY、PLACE 等）和城镇数据库组成。电话号码可以是十位数的任意序列（取决于电信公司的要求），但不能重复。

# vb6 - 设置打印机对象时出现“无效的过程调用或参数”

> ID：737702
> 
> 赞同：3
> 
> 时间：2009-04-10T14:03:33.490
> 
> 标签：vb6, printers

我有一个 VB6 应用程序，当程序尝试将 Printers 对象设置为 Printers 集合中的特定打印机时，它给出错误 5“无效的过程调用或参数”。有问题的打印机是某种通过打印服务器运行的复印机/打印机。将 Printer 对象设置为集合中定义的其他打印机时，不会发生该错误。在这种情况下可能导致错误 5 的任何想法？我不确定在 VB6 中使用“Set Printer = x”语句时究竟会发生什么 - 它是否正在尝试与实际的打印机驱动程序交互？是否有可能由于某种原因驱动程序未被 VB6 打印机对象识别为有效打印机，从而导致“无效参数”错误？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:19:42.717

“无效的过程调用或参数”是针对 VB 运行时错误 5。

我怀疑您看到的错误 5 是 Win32 错误代码，意思是“访问被拒绝”。

显然 VB 运行时错误与 Win32 错误不同 - 我怀疑它与早于 MS-DOS 的 VB 的根源有关：http: [//blogs.msdn.com/ericlippert/archive/2004/09/09/227461.aspx](http://blogs.msdn.com/ericlippert/archive/2004/09/09/227461.aspx) . 我不确定您应该如何确定何时使用哪种解释

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T14:37:55.607

您正在使用这样的代码将其设置正确吗？不只是试图通过字符串设置它？

```
 Dim strDeviceName As String
   Dim prnCurrent    As Printer

   For Each prnCurrent In Printers

      If UCase$(prnCurrent.DeviceName) = strDeviceName Then

         Set Printer = prnCurrent

         Exit For

      End If

   Next prnCurrent 
```

为了停止更改默认打印机，请在设置打印机之前运行此代码。这样您就不必重新设置默认打印机。这也使您的打印机选择对您的程序来说是独一无二的，这是大多数人想要的。

```
' deassociate printer object from default system printer
Printer.TrackDefault = False 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-16T16:12:32.110

我在 MS Access 2007 VBA 中通过包含服务器名称和打印机名称解决了这个问题。

```
Application.Printer = Application.Printers("\\servername\printername") 
```

代替

```
Application.Printer = Application.Printers("printername") 
```

希望这对其他人有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-22T23:53:40.510

我遇到了这个错误，经过几个小时的挫折后找到了我的答案。这是一个区分大小写的问题。当我应该有一个小写的“s”时，我有一个大写的“S”。

所以当代码看起来像这样时：

```
XeroxReport = "\\Share\Red Xerox 430"
Set Application.Printer = Application.Printers(XeroxReport) 
```

我会收到错误 5

但是当我将其更改为：

```
XeroxReport = "\\share\Red Xerox 430"
Set Application.Printer = Application.Printers(XeroxReport) 
```

很快它就奏效了

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-14T19:47:45.767

您可能想查看以下页面：

[http://support.microsoft.com/kb/322710](http://support.microsoft.com/kb/322710)

每当在 VB6 中打印时，我总是使用此对话框而不是 VB6 附带的常用对话框。它更可靠。

# .net - 如何从 ASP.NET 使用 Silverlight？

> ID：737705
> 
> 赞同：2
> 
> 时间：2009-04-10T14:05:10.413
> 
> 标签：.net, asp.net, silverlight

如何在我的 ASP.NET 应用程序中使用在 Silverlight 中创建的 XAP 文件？我的意思是要在页面中完成哪些注册和更改才能使 Silverlight 内容显示在我的 aspx 页面中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T14:18:21.067

在您的页面上使用 Silverlight ASP.NET 控件并引用您的 .xap，它应该在您的 ClientBin 文件夹中。

```
<asp:Silverlight ID="Silverlight1" runat="server" 
Source="../ClientBin/Something.xap" MinimumVersion="2.0" 
Width="100%" Height="100%" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T14:06:56.273

您将需要一个引用您的 XAP 文件的 aspx 页面

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T14:18:48.507

如果您在 Visual Studio 中创建新的 Silverlight 应用程序，则创建项目时的选项之一是让 Visual Studio 创建一个显示您的 Silverlight 应用程序的 ASP.NET 项目。您可能可以从该代码开始，然后将其集成到您的应用程序中。

# winforms - 分层时的winforms Form Transparency问题

> ID：737706
> 
> 赞同：1
> 
> 时间：2009-04-10T14:05:22.720
> 
> 标签：winforms, user-interface

（我的第一个问题！）谁能告诉我为什么在winforms中，分层透明区域会失去透明度并在以前透明的区域显示黑色？

这些表单显示为从模态对话框启动的模态对话框。(2 deep) 在这个应用程序中，模态对话框以阴影框效果显示，因此整个屏幕被半透明黑色填充，然后显示模态窗体。

第一种模态形式具有圆角。第一个模态表单显示得很漂亮。当从第一个模态对话框触发第二个模态对话框时（也具有完全透明的黑色层和圆角），未覆盖的原始模态对话框的客户端矩形（圆角后面的正方形）变为黑色。

谁能告诉我为什么会这样，我需要想出一个解决办法。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T17:12:53.697

尝试在单独的线程上显示对话框，或者只显示第二个。

这可能很棘手，也请阅读[此](https://stackoverflow.com/questions/428494/is-it-possible-to-use-showdialog-without-blocking-all-forms)线程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T17:01:10.753

谢谢大家的帮助。事实证明，答案很简单。我今天在不同的场景中运行这些控件时意识到了这一点。（这有点尴尬，但至少这个线程会完成）

当显示这些模态对话框时，屏幕被 50% 透明的黑色矩形覆盖，并在顶部模态显示一个表单。

第二个模态对话框以同样的方式显示，50% 的透明黑色覆盖在拥有的表单上。所以，直到今天我才意识到，当 50% 透明叠加在 50% 透明之上时会发生什么。！！！！！！

无论如何，操作员错误。我只需要想办法用透明黑色覆盖圆角面板的区域，问题就消失了。

# joomla - 如何使用相同的用户/密码创建多个 joomla 网站？

> ID：737718
> 
> 赞同：2
> 
> 时间：2009-04-10T14:08:40.903
> 
> 标签：joomla

如何使用相同的用户/密码创建多个 joomla 网站？如果有人在这些网站中的任何一个上创建用户，他的用户可以在所有网站上使用，如果有人更改密码/任何数据，他们也会在其他网站上更新。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:26:51.927

默认情况下，Joomla 有几种认证方法。因此，如果您能够使用 LDAP 服务器或 OpenID，则可以启用相关插件 - 您将在一台服务器上拥有所有凭据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T14:39:14.703

假设您使用的是 1.5，请查看文件`plugins/authentication`夹中的文件。基本上，您创建一个扩展 JPlugin 类的类并使用此标头实现该方法：

```
function onAuthenticate( $credentials, $options, &$response ); 
```

它应该返回一个布尔值，并且任何额外的信息都可以放在响应对象中。您可以进行所需的任何数据库查找。

所以，一旦你设置好了，你可以做的是创建一个新的数据库，它只保存用户帐户的详细信息。然后，您的新身份验证插件可以连接到该数据库以检查密码，甚至可能复制任何更新的帐户信息。

# mysql - MySQL 的 DIV 运算符是否有 CEIL 版本？

> ID：737720
> 
> 赞同：1
> 
> 时间：2009-04-10T14:09:12.447
> 
> 标签：mysql, math, performance

使用 MySQL

`a DIV b`

比

`FLOOR(a / b)`.

但我需要四舍五入，所以我正在使用，

`CEIL(a / b)`

DIV 没有天花板版本似乎很奇怪，但我找不到。有没有什么无证的东西藏在某个地方？或者任何其他非浮点方式来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:23:01.773

选择：

(a + b - 1) DIV b

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T14:21:33.697

因为`a > 0`你可以写

```
(a - 1) div b + 1 
```

# vb.net - 是否可以自定义 DataBound ComboBox 的 DisplayMember？

> ID：737730
> 
> 赞同：1
> 
> 时间：2009-04-10T14:13:46.023
> 
> 标签：vb.net, data-binding, combobox

# 解决方案

这就是我想出的：

```
Public Class IndexedDropDownItem
    Private _KeyCode, _Display As String
    Public Property KeyCode() As String
        Get
            Return _KeyCode
        End Get
        Set(ByVal value As String)
            _KeyCode = value
        End Set
    End Property
    Public Property Display() As String
        Get
            Return _Display
        End Get
        Set(ByVal value As String)
            _Display = value
        End Set
    End Property
    Sub New(ByVal KeyIndex As String, ByVal ItemDisplay As String)
        KeyCode = KeyIndex
        Display = ItemDisplay
    End Sub
    Public Overrides Function ToString() As String
        Return String.Format("{0} - {1}", KeyCode, Display)
    End Function
End Class 
```

执行：

```
With myDropDown
    Dim oItem As IndexedDropDownItem = Nothing
    For Each dr As Data.DataRow In oTemp.Rows
        oItem = New IndexedDropDownItem(dr.Item("key_code"), _ 
                                        dr.Item("descript"))
        .Items.Add(oItem)
        oItem = Nothing
    Next
End With 
```

操作：

```
Dim _KeyCode, _Display As String
With CType(dataPathComboBox.SelectedItem, IndexedDropDownItem)
    _KeyCode = .KeyCode
    _Display = .Display
End With 
```

我希望这会帮助别人！

* * *

我有一个从 DataTable 填充的 ComboBox：

```
With myComboBox
    .DataSource = myDataTable
    .DisplayMember = "descript"
    .ValueMember = "key_code"
End With 
```

我希望能够让 DisplayMember 显示“key_code - descript”，同时保留我设置的值。

这甚至可能吗？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:31:19.990

由于您使用的是数据表，因此您需要创建一个计算值的新列。

我个人已经开始使用对象来进行数据绑定，并且在我的类中使用它我只需添加另一个公共属性“ListDisplayText”来为我进行格式化。

# php - 用字母 php 断一个单词

> ID：737745
> 
> 赞同：3
> 
> 时间：2009-04-10T14:17:25.547
> 
> 标签：php

我想从表单中接受一个字符串，然后使用 PHP 将其分解为一个字符数组，例如：

```
$a = 'professor';
$b[0] == 'p';
$b[1] == 'r';
$b[2] == 'o';
.
.
.
.
.
$b[8] = 'r'; 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-10T14:23:35.797

你不需要这样做。在 PHP 中，您可以直接从字符串中访问您的字符，就好像它在数组中一样：

```
$var = "My String";
echo $var[1]; // Will print "y". 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-10T14:26:42.233

```
str_split($word); 
```

~~这比将 $word 作为数组访问要快。~~（而且更好的是，您可以使用 . 进行迭代`foreach()`。）[文档](http://us2.php.net/str_split)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T22:44:03.573

如果您真的想要数组类型变量中的单个字符，而不是只需要按索引访问字符，请使用：

```
$b = str_split($a) 
```

否则，只需使用 $a[0]、$a[1] 等...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T22:09:06.683

请小心，因为上面的示例仅在您处理 ASCII（单字节）字符串时才有效。

# apache-flex - FLEX 新手 - 从 Java 翻译异步通信

> ID：737746
> 
> 赞同：1
> 
> 时间：2009-04-10T14:17:32.300
> 
> 标签：apache-flex, actionscript-3, flex3, asynchronous

我目前正在将一个 Java 项目转换为 Flex 3。该项目的很大一部分涉及异步通信。

该程序将连接到一个流，开始下载数据。连接后不久，它需要通过 HTTP 下载相同格式（关键帧）的上下文数据。在流或关键帧期间的不同点，可能需要额外的 HTTP 调用，例如获取加密密钥。

在 Java 中，我将使用阻塞调用来执行 HTTP 请求以获取密钥，该密钥将在 HTTP 完成时有效地暂停关键帧或流，然后将继续原处。

不幸的是，Flex 是单线程的，并且 HTTP 请求是通过异步回调实现的，因此不可能以相同的方式实现代码。

作为 Flex 的新手，我不确定通常的做法是什么。目前，我打算保存状态并退出，依靠 HTTP 完成重新启动暂停的流。或者也许使用计时器......

但是对于流，我是否应该将接收到的数据与处理它分离并在处理 HTTP 请求时对其进行缓冲？或者忽略进度事件并让 Flex 和/或操作系统缓冲它是否安全？

有没有人对可以使这一切变得更容易的架构有任何建议？

谢谢！

**编辑**：感谢到目前为止的答案...

急切地-我不确定我是否理解您的意思，但我会调查一下。

brd6644 - 其中一个连接（流）已经是原始套接字。问题是关于暂停它并从中途从另一个来源获取一些其他数据。

CookieOfFortune - 看起来很有用，谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T14:32:12.297

Flex 有一个[`HTTPService`](http://livedocs.adobe.com/flex/3/langref/mx/rpc/http/HTTPService.html)类。从您的问题描述的外观来看，我会说创建多个这样的对象并将它们绑定到不同的事件处理程序——这取决于您对特定请求所需的处理类型。

```
<mx:HTTPService url="{myURL}" id="myHTTPData" method="GET" 
                result="cacheData()" fault="downloadFault" 
                resultFormat="object">

<mx:HTTPService url="{myURL2}" id="mySessKey" method="GET" 
                result="saveSessKey()" fault="authFault" 
                resultFormat="object"> 
```

最好围绕 HTTPService 创建一个自定义包装器并使用它们来代替。这将允许您使用自定义事件处理程序轻松创建对象（并在完成后释放它们）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T14:49:07.373

通过原始 ActionScript 套接字 API 进行连接怎么样？您可以根据需要读取数据并分派事件，每个事件都会触发单独的 HTTPService 调用以获取数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T14:53:43.510

当您使用 HTTPService 的 send() 方法时，将返回一个 AsyncToken。您可以使用 AsyncToken 来同步您的事件。

```
private function streamResultHandler(event:ResultEvent):void
{
    ...
    for(var str : frame)
    {
        if(str == "getEncryptionKey")
        {
            var token:AsyncToken = keyHTTPService.send();
            var tokenResult:Object = token.result;
            var key = keyBuffer;
            ...
        }
    }
}

private function keyHTTPServiceResultHandler(event:ResultEvent):void
{
    keyBuffer = event.result;
} 
```

# regex - 如何在 Perl 中删除 < 和 > 之间的字符？

> ID：737751
> 
> 赞同：5
> 
> 时间：2009-04-10T14:18:25.747
> 
> 标签：regex, perl, multiline

我需要编写一个 Perl 脚本来读取文件，并删除 < > 中的任何内容，即使它们位于不同的行上。也就是说，如果输入是：

```
Hello, world. I <enjoy eating
bagels. They are quite tasty.
I prefer when I ate a bagel to
when I >ate a sandwich. <I also
like >bananas. 
```

我希望输出为：

```
Hello, world. I ate a sandwich. bananas. 
```

如果文本与正则表达式位于 1 行，我知道如何执行此操作。但我不知道如何用多行来做到这一点。最终，我需要能够有条件地删除模板的某些部分，以便为配置文件生成参数化文件。我认为 perl 会是一门很好的语言，但我仍然掌握了它的窍门。

**编辑**：还需要 1 个以上的 <> 实例

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T14:24:24.827

您可能想查看一个 Perl 模块[Text::Balanced](http://perldoc.perl.org/Text/Balanced.html)，它是核心发行版的一部分。我想它会对你有所帮助。通常，如果主题文本可能具有一组内部分隔符，则希望避免使用正则表达式来执行此类操作，它会变得非常混乱。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-10T14:28:46.410

在 Perl 中：

```
#! /usr/bin/perl   
use strict;

my $text = <>;
$text =~ s/<[^>]*>//g;
print $text; 
```

正则表达式替换以 < 到第一个 > （包括）开头的任何内容，并将其替换为任何内容。g 是全局的（不止一次）。

编辑：纳入 Hynek 和混乱的评论

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-10T14:51:00.723

```
local $/;
my $text = <>;
s/<.*?>//gs;
print $text; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T14:40:56.630

无效的单线方式

```
perl -0777 -pe 's/<.*?>//gs' 
```

和程序一样

```
local $/;
my $text = <>;
s/<.*?>//gs;
print $text; 
```

这取决于您要在此处转换多大的文本更有效地逐行使用

```
perl -pe 'if ($a) {(s/.*?>// and do {s/<.*?>//g; $a = s/<.*//s;1}) or $_=q{}} else {s/<.*?>//g; $a = s/<.*//s}' 
```

和程序一样

```
my $a;
while (<>) {
    if ($a) {
        if (s/.*?>//) {
            s/<.*?>//g;
            $a = s/<.*//s;
        }
        else { $_ = q{} }
    }
    else {
        s/<.*?>//g;
        $a = s/<.*//s;
    }
    print;
} 
```

# sql - varchar(max) MS SQL Server 2000，有问题吗？

> ID：737755
> 
> 赞同：13
> 
> 时间：2009-04-10T14:19:34.807
> 
> 标签：sql, sql-server, varchar

我继承了一个当前运行 SQL Server 2000 作为其后端的 asp.net 网站项目。

我一直在使用 SQL Server 2005 Express 对数据库的本地副本进行一些数据库更改。我已经使用`varchar(max)`列创建了一个表。它们用于存储任意长度的 XHTML 片段。

在 stackoverflow 上浏览时，我遇到了这个问题： [总是使用 nvarchar(MAX) 有什么缺点吗？](https://stackoverflow.com/questions/148398/are-there-any-disadvantages-to-always-using-nvarcharmax)

用户 mattruma 说他发现了`varchar(max)`在 SQL Server 2000 上使用的“困难方法”。

`varchar(max)`如果实时数据库在 SQL Server 2000 上运行，我应该使用什么来代替？

提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-10T14:24:11.897

`VARCHAR(Max)`是在 SQL Server 2005 中引入的，并且不适用于 SQL Server 2000。`VARCHAR(8000)`假设它足够大，您需要使用其中任何一个。否则你将需要使用`TEXT`

**编辑**

此外，如果您切换到`VARCHAR(8000)`记住，单行不能超过 8060 个字节是有限制的。因此，如果您填满一张`varchar(8000)`表格并有一堆其他大列，您将收到错误消息。这就是`Text`进来的地方。

`Text`具有性能影响，因为默认情况下它存储在单独的位置，并且它们在表中保留一个指针。有一个设置选项可以更改此行为，以便将文本类型保留在表格中，直到它们达到特定大小。如果您有大部分小斑点，则可能需要启用此功能。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-10T14:29:41.867

`varchar(MAX)`如果您的实时数据库是不支持它们的 SQL Server 2000，那么这些限制听起来是一个有争议的问题。如果要存储的字符数超过 8K，则几乎只剩下另一个选项，即一`TEXT`列。但是，请注意`TEXT`列也有很多限制。

例如，您不能轻松地对它们进行排序或分组，也不能将它们与其他列进行比较。那就是你不能说`Select * from mytable where Mytext1 = mytext2`。

其他相关问题：

*   无论您采用何种方式支持 Unicode， 我都建议您使用`NText`or列。`NVarchar`
*   如果该表有很多其他列，并且该`varchar(8000)`列很可能经常接近满，那么您可能会遇到 8K 的行限制问题。请记住这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T14:23:48.137

使用 TEXT 列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T14:28:08.470

这取决于您的需求。您可以使用 TEXT 列而不是 VARCHAR(MAX) 但您必须确保您的实现不需要在该字段上进行搜索，因为您不能在 TEXT 和 NTEXT 字段上进行类似的比较。

如果您可以将自己限制为 8000 个字符，我会使用 VARCHAR(8000) 列来存储信息。

# c# - C#图形绘制库？

> ID：737771
> 
> 赞同：54
> 
> 时间：2009-04-10T14:23:10.963
> 
> 标签：c#, graphics, graph-theory

我正在寻找一个（免费）库，它允许我绘制[CFG](http://en.wikipedia.org/wiki/Control_flow_graph)（控制流图）。像[yFiles 之](http://yworks.com/)类的东西，但免费或最好是开源的？理想情况下，该库将允许用户浏览图形（并对其进行修改），即图形不仅仅是静态的先验渲染位图。想法？

**更新：**
[Glee](http://research.microsoft.com/en-us/downloads/f1303e46-965f-401a-87c3-34e1331d32c5/default.aspx)与上面提到的 QuickGraph 库相结合似乎工作得很好。谢谢

**Update2：** [Graph#](http://graphsharp.codeplex.com/)似乎是目前最强大的库。还有一个关于如何使用它的不错的[教程。](http://sachabarber.net/?p=815)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-10T14:33:13.090

您可能想查看[QuickGraph](http://www.codeplex.com/quickgraph)。

[NodeXL](http://www.codeplex.com/NodeXL)可能也很有趣（可视化库）。它是 WPF，但如果您需要 WinForms，您可以使用容器来托管它。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-17T17:36:17.197

试试这个（高效的 Sugiyama 算法是你的朋友）：

[图形＃](http://codeplex.com/graphsharp)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-05-16T18:58:19.710

[https://graphx.codeplex.com/](https://graphx.codeplex.com/)

受 Graph# 启发，积极开发且可扩展性更强。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-17T17:52:31.200

我使用[GraphViz](http://www.graphviz.org/)来生成这种图表。我的应用程序生成**.dot**文件，然后可以将其传递到 GraphViz。它支持多种文件格式，例如 bmp、jpg、png、pdf、svg 等。

# c# - 左位移 255（作为一个字节）

> ID：737781
> 
> 赞同：18
> 
> 时间：2009-04-10T14:26:09.253
> 
> 标签：c#, bit-manipulation, bit-shift

谁能解释为什么以下内容无法编译？

```
byte b = 255 << 1 
```

错误：

> 常量值“510”不能转换为“字节”

我期待以下二进制文件：

```
1111 1110 
```

类型转换难倒了我。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-10T14:32:07.540

C# 中的数字文字是`int`, not `byte`（并且位移将由编译器评估，因此只剩下 510 ）。因此，您试图为`byte`不适合的 a 分配一个值。您可以使用 255 进行掩码：

```
byte b = (255 << 1) & 0xFF 
```

将结果再次减少到 8 位。与 Java 不同，C# 不允许溢出未被检测到。基本上，在尝试将 510 分配给一个字节时，您有两个明智的选择：要么钳制在最大值，然后得到 255，要么丢弃不适合的位，在这种情况下，你会得到 254。

您也可以使用`unchecked`lassevk[提到](https://stackoverflow.com/questions/737781/left-bit-shifting-255-as-a-byte/737810#737810)的：

```
byte b = unchecked((byte)(255 << 1)); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-10T14:30:31.130

您将 255 移动 1 位，然后尝试将其分配给一个字节。 `255 << 1 is 510`，并且 510 不适合一个字节。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-10T14:33:19.800

```
byte b = 0xff & (255 << 1); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-10T14:34:34.197

`<<`运算符的结果是`Int32`，而不是您放入其中的内容。

您需要转换班次的结果，而不是输入。此外，它会产生溢出（它毕竟大于一个字节），因此您需要指定您需要未经检查的强制转换。

换句话说，这将起作用：

```
Byte b = unchecked((Byte)(255 << 1)); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-10T14:30:02.660

你试过铸造它吗？

```
byte b = (byte)(255 << 1) 
```

* * *

这是一种有趣的方法——如果将上面的代码包装在这样的`unchecked`块中，上面的代码就可以工作：

```
unchecked
{
    byte b = (byte)(255 << 1);
} 
```

由于它`unchecked`的值被截断为预期值 254。所以可以通过强制转换来做到这一点！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T14:29:48.433

```
255 << 1 
```

会给你超过一个字节。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-10T14:36:29.900

由于 << 的优先级高于 & 您可以保存括号：

```
byte b = 255 << 1 & 0xff; 
```

# c# - C#：带有泛型的“默认”关键字

> ID：737783
> 
> 赞同：7
> 
> 时间：2009-04-10T14:26:57.693
> 
> 标签：c#, generics, resharper

我编写了以下方法来从可序列化类 (POCO) 列表中返回不可序列化类 (LINQ 类) 的列表：

```
List<UnSerializableEntity> ToListOfUnserializables(List<SerializableEntity> entityList)
{
    var tempList = new List<UnSerializableEntity>();
    entityList.ForEach(e =>
    {
        if (e != null)
        {
            tempList.Add(ConvertFromSerializableToUnserializable(e));
         }
     });
     return tempList;
} 
```

现在，Resharper 已经“抱怨”了这一行：`if (e != null)`，并建议将其更改为：

```
if (!Equals(e, default(SerializableEntity))) 
```

我的问题是，**这种变化实际上改善或阻止了哪些事情的发生？** 而且我知道这种情况下的默认关键字必须与泛型有关，但我不确定它究竟代表什么。

*PS。`UnSerializableEntity`并且`SerializableEntity`是类泛型。*

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-10T14:29:05.207

如果`SerializableEntity`是值类型，则永远不可能是`null`. 因此，您的`if`语句主体将始终执行，因为它正在检查`null`. 关键字将`default`返回泛型类型的默认值。对于引用类型，默认值为`null`。对于值类型，它为零（或任何零代表该值类型）。

如果您只想将引用类型作为实体，则应该对泛型参数设置约束。例如：

```
List<UnSerializableEntity> ToListOfUnserializables(List<SerializableEntity> entityList)
    where SerializableEntity : class 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-14T15:06:18.953

肯特的回答是准确的，但要更明确地回答您关于 Resharper 的问题以及它为什么抱怨：

在引用类型（类）的情况下，检查 null 就足够了，因为这被认为是引用类型的“默认”值。但是，对于值类型（例如结构），“默认值”永远不会为空。因此，由于您的 SerializableEntity 和 UnSerializableEntity 是泛型，您可以将它们指定为引用或值类型，因此您所做的 null 检查可能不是您想要的。您要检查的是确保参数是您真正想要关注的内容。在引用类型的情况下，您不想关心空对象。在值类型的情况下，您不想关心“清零”值。

例如：假设您将 DateTime 指定为您正在处理的数据类型。您真的要添加没有设置任何值的日期时间吗？DateTime 的默认值为 1/1/0001，不为空，因此您需要使用`if (!Equals(e, default(SerializableEntity)))`not进行检查`if (e != null)`

# sas - SAS 9.2 中的 metadata_newobj 函数有错误吗？

> ID：737794
> 
> 赞同：0
> 
> 时间：2009-04-10T14:30:23.753
> 
> 标签：sas, sas-metadata

我有一个 SAS 应用程序，我正在使用新发布的 SAS 9.2 进行测试。我调用了 metadat_newobj 函数来在 SAS 元数据存储库中创建一个新的库对象：

```
rc = metadata_newobj( "SASLibrary", URI, Name ); 
```

在 9.1.3 中，当函数成功执行 (rc = 0) 时，URI 变量将填充新创建的库对象的 URI。

在 SAS 9.2 中，虽然返回值为 0（成功）并且确实创建了库对象（我使用管理控制台手动检查），但 URI 变量保持空白，因此任何后续设置属性等操作都会失败。

两个版本的文档都将 URI 列为此函数的输出参数。

有没有人有这方面的知识？

**编辑：**我使用的代码如下：

```
put libraryName=;
rc = metadata_newobj("SASLibrary", libraryUri, libraryName);
if rc ne 0 then do;
  /* Error handler */
  return;
end;
put libraryUri=; 
```

和输出：

```
libraryName=HRLIB10
libraryUri= 
```

我正在尝试使用它来解决这个问题`PROC METADATA`，这似乎是有效的。:\

**编辑#2：**我刚刚意识到我没有提到这是在 SCL 代码中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:57:25.353

它对我有用。根据您提供的示例，我建议在 NAME 周围加上引号。也可以在运行 metadata_newobj 之前使用长度语句来设置 uri。否则，为了分享，如果你用其他技术解决了问题，请告诉我们。

这是我跑的：

```
data _null_;
    length uri $256;
    rc=0;
    rc=metadata_newobj("SASLibrary",
                       uri,
                       "testlib");
    put uri=;
run; 
```

这是我的日志：

```
NOTE: Variable uri is uninitialized.
uri=OMSOBJ:SASLibrary\A5M6IOB0.AZ000007
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T18:35:17.803

我没有发现任何表明 metadata_newobj 在新版本中发生了变化。但是，它只是拒绝为我工作。所以我将我的函数转换为使用`PROC METADATA`，现在它可以在 SAS 9.1.3*和*SAS 9.2中使用

谢谢大家。

# javascript - 函数作为参数（带参数）——JavaScript

> ID：737802
> 
> 赞同：3
> 
> 时间：2009-04-10T14:32:15.527
> 
> 标签：javascript

如果我有一些看起来像这样的 OO javascript：

```
function someFunction(a, b, c) {
  // do something with a, b, and c
}

function theLoader() {
    loadFunction: someFunction,
    load: function() {
      // invoke the loadFunction with the proper parameter set
    }
}

var myLoader = new theLoader();
myLoader.load(); 
```

让我们假设“theLoader”应该是抽象的和通用的。我可以调用它并将“loadFunction”设置为几乎任何东西，所以我不知道在任何给定时间参数会是什么。'load' 方法必须调用 'loadFunction' 并且能够以某种方式获取设置给它的参数....

我怎样才能完成我想做的事情？如果这是一个不好的方法，我们可以完全重构代码。我想保持对'loadFunction'的限制，所以我不必以特殊方式编写加载器函数。

归根结底，我想将 Loader 打包到它自己的 .js 文件中，而不必担心它。

所以——如果你知道答案，请帮助兄弟！

谢谢，克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:44:14.687

使用`apply`或`call`执行函数调用。可在此处找到功能说明：

*   [http://www.javascriptkit.com/jsref/function.shtml](http://www.javascriptkit.com/jsref/function.shtml)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T14:39:15.120

你应该让你的`loadFunction`跟随一个接口，并使用多态性来调用它。话虽如此，您确实需要以`someFunction`某种*方式*捕获参数。

你能允许`load`函数接受需要的参数`loadFunction`吗？

```
myLoader.load(1, '2', 'foo'); // calls this.loadFunction(1, '2', 'foo') 
```

或者，允许`theLoader`在构造函数中使用它们？

```
function theLoader() {
    this.loadFunctionArgs = arguments;
}

theLoader.prototype = {
    loadFunction: someFunction,
    load: function() {
        return this.loadFunction.apply(this, this.loadFunctionArgs)
    }
}

var myLoader = new theLoader(1, '2', 'foo');
myLoader.load(); // calls someFunction(1, '2', 'foo') 
```

我一点也不知道这是否适合您的应用程序。用 JavaScript 做当然没问题（就语言而言，我的意思是）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T15:07:00.577

我认为您正在寻找的是：

```
function theLoader() {
    this.load = function() {
        if (this.loadFunction) {
            return this.loadFunction.apply(this, arguments);
        }
    };
}
// Usage
var loader = new Loader();
loader.loadFunction = someFunction;
loader.load(1, 2, 3, 4); 
```

此外，您将对象文字表示法与函数文字混合，这是不正确的。

# file-transfer - 需要快速文件复制程序

> ID：737803
> 
> 赞同：0
> 
> 时间：2009-04-10T14:32:45.183
> 
> 标签：file-transfer

有一个名为 TeraCopy 的程序。它加速文件复制的方式非常好。我需要加快文件传输到闪存盘的速度，但不能指望每个人都购买 TeraCopy。有谁知道任何可以做同样事情的例程或组件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T14:48:40.887

尝试设计一个文件复制例程，将文件复制操作分成 N 个部分，并使用多线程并行处理这 N 个部分。我猜这就是下载加速器和 TeraCopy 等工具的工作方式。来吧，试试吧，这将是一次愉快的冒险。我记得看过一个关于 pftp（并行文件传输协议）的演示，基本上是 FTP 使用多线程并行执行任务。它确实显着提高了性能，因此它也可能在 USB 驱动器或任何类型的媒体上得到改进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T14:37:29.383

您受到用于连接闪存设备的管道速度的限制。如果是 USB 2.0，那么理论上你的最快速度将是 480 Mbit/s。当然，你会得到慢得多的结果，因为我们不住在实验室里：D。

如果您真的想加快复制速度，请使用您的一些 CPU 功能在将信息传输到介质之前对其进行压缩。然后，您可以在它到达后解压缩它。您必须编写一个执行此操作的程序，或者您可以使用现成的解决方案。

# c - 比较 C 中具有任意位数的两个值

> ID：737808
> 
> 赞同：0
> 
> 时间：2009-04-10T14:34:01.763
> 
> 标签：c, casting, function-pointers

我在 C 中创建了一个动态类型系统，以便创建一个可以包含不同位宽值的字典。动态对象的结构是：

```
typedef struct
{
    void* Pointer;
    unsigned char Size;   
} Dynamic; 
```

我需要比较其中两个保存 A2D 读数的 Dynamics，然后将差异与 delta 值进行比较，以确定是否发生了变化。我能够想出的一种解决方案是将它们转换为 char 数组并逐字节比较它们，但这并不正确。我还有一个想法，即根据 Dynamics 占用的字节数（或者可能是类型）创建一个函数指针数组，并为每种支持的类型创建一个比较函数。任何人都可以提出不同的方法吗？感觉就像我错过了什么。

更新：

感谢您告诉我有关 memcmp 的信息，但我仍然有如何获得这两个值的增量的问题？据我所知，memcmp 只是返回一个指示哪个值更大的指标，而不是它们之间的差异。

更新到更新：

事实证明 memcmp 对我没用，因为我正在编译的架构是小端。

如果我要自己做一个 bignum 实现，那么 ephemient 感觉是正确的方法，但我决定我只是将值 memcpy 到我必须处理的最大可能类型（即 unsigned long long）中并使用它们进行数学运算。我想不出任何为什么这不起作用，但我认识到我可能是非常错误的，因为 C / 直接内存操作不是我的强项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T14:44:44.310

这样的事情就足够了吗？

```
#include <string.h>
int compare(Dynamic *a, Dynamic *b) {
    if (a->Size != b->Size) return a->Size - b->Size;
    return memcmp(a->Pointer, b->Pointer, a->Size);
} 
```

如果它们执行非常相似的操作，则创建一堆专门的函数似乎有点矫枉过正。

### 附录

如果要计算差异...

```
int diff(Dynamic *a, Dynamic *b, Dynamic *d) {
    int i, borrow = 0;
    signed char *ap = a->Pointer, *bp = b->Pointer, *dp = d->Pointer;

    assert(a->Size == b->Size && b->Size == d->Size);

    for (i = 0; i < a->Size; ap++, bp++, dp++, i++) {
        // symmetric difference
        *dp = *ap ^ *bp;

        // arithmetic difference, assuming little-endian
        *dp = borrow += *bp - *ap;
        borrow >>= 8;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T14:45:57.943

也许我也错过了一些东西......但你为什么不使用 memcmp ？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T15:28:34.657

如果您正在尝试实现 bignum 功能（并且您可能会考虑[其他人的](http://www.cs.sunysb.edu/~skiena/392/programs/bignum.c)（第一次谷歌点击“C 中的 bignum”）），您几乎肯定希望通过减法计算差异。大多数 CPU 仅通过执行此操作来实现比较，然后将结果的符号或零用于 <、> 或 ==。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T14:40:49.047

听着，我是个数学极客，我知道，但根本问题听起来像是“天啊，这些东西*的*自然顺序是什么？”

底层数据的原始位是否像 Bignum？然后将它们转换为 unsigned char 并在循环中比较它们。稍微考虑一下您比较的顺序将使其最有效。有趣的一点是，当 A 的长度 ≠ B 的长度时：根据定义，A≠B 是 A≠B，还是您要比较的数值，在这种情况下，0x00 的前导字节不重要？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T14:43:46.777

如果您只需要比较是否相等 - 使用 memcmp()。如果您需要计算有多少位（或字节）不同 - 实现一个类似于 memcmp() 的函数，该函数贯穿两个 char 数组，比较并计算不匹配的模式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T14:46:35.743

我认为可变位大小是由于某些值大于其他值。如果您可以保证位数始终意味着设置了位数，那么您可以先比较大小，如果大小相等，则进行无符号字节比较。例如“01”只需要存储1位，所以它的大小为1，而“100101”需要6位存储，所以它的大小是6。如果size(a) > size(b)，那么(a) > (b)。

这些是存储在大端还是小端？

# objective-c - NSPopUpButton、绑定和缩短寿命

> ID：737809
> 
> 赞同：7
> 
> 时间：2009-04-10T14:34:04.337
> 
> 标签：objective-c, cocoa, macos

我正在尝试了解使用 NSPopUpButton 的难度。它是迄今为止在 Cocoa 中编程最困难的用户元素（至少就我而言）。

我想到的用例如下：

*   我有一个名为 Port 的类，它代表一个串行端口。
*   属性中有一个名称字段。
*   在 NSPopUpButton 中，我想显示每个端口的名称字段。
*   当用户选择特定端口时，它会在弹出窗口中按预期标记
*   当用户随后点击连接按钮时，我可以确定选择了阵列中的哪个端口。
*   我想使用绑定来实现这一点，因为我认为一旦我了解它，这将是更优雅的解决方案。

因此，在我的 AppController.h 中，我期待两个属性，我大概可以将它们创建为属性并合成：

```
NSMutableArray *allPorts;
Port *currentlySelectedPort; 
```

我的 .m 中的一项操作：

```
-(void)didSelectConnect:(id)sender{
    NSLog(@"Selected port name is:%@",[currentlySelectedPort name]);
} 
```

在 Port.h 我有

```
NSString *name;
NSString *baudRate;
... etc ... 
```

我创建了一个简单的项目，其中只包含一个弹出窗口（和一个标签），并在各种文章之后，我设法用元素填充 NSMutableArray，然后我使用 ArrayController 来显示值，然后在选择时设置标签的值（使用对象控制器）。然而，尽管这很聪明，但它不适合我试图实现的用例。所以我转向这里寻求帮助

米

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-10T15:21:56.703

好的，与 的绑定`NSPopUpButton`有点复杂，因为它需要两件事：值的绑定，以及选择其中一个值的绑定。更复杂的是，有几种完全合法的方法可以做到这一点，而您选择哪一种完全取决于您的程序结构，在某种程度上，还取决于个人喜好。

因此，为了获取值列表，您需要绑定`content`属性。在您的情况下，您可能会将其绑定`arrangedObjects`到`NSArrayController`. 在此设置中，每个菜单项代表一个对象。默认情况下，菜单项的标题是通过调用`description`数组中的每个项返回的字符串。如果要对菜单标题使用不同的属性，也可以绑定`contentValues`数组。只需确保您指定`contentValues`的键路径具有`content`作为其前缀的键路径（例如，您可以使用`arrangedObjects`for`content`和`arrangedObjects.name`for `contentValues`）

这将为您提供代表对象的菜单项。您接下来需要的是某种识别所选方法的方法。您可以使用三种不同的绑定`selectedIndex`：`selectedObject`和`selectedValue`。它们分别表示用户选择的数组对象的索引、对象值（`content`数组中的对象之一）和所选项目的字符串标题（`contentValues`如果您绑定了该属性，则为数组中的对象之一）。

因此，在您的情况下，您可能会绑定`selectedObject`到`selectedSerialPort`控制器类上的属性。当用户单击“连接”按钮时，您只需参考该`selectedSerialPort`属性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-10T15:52:28.250

您可以[在此处下载示例 Xcode 项目](http://bitbucket.org/abizern/popup/get/tip.zip)。这与您的描述非常接近。

The important thing is to look at the connections between the array controller, the AppController and the popup box.

Basically, this just demonstrates what Alex said.

# ssl - 如何判断一个页面是否是 ASP 中的 SSL？

> ID：737813
> 
> 赞同：5
> 
> 时间：2009-04-10T14:36:29.777
> 
> 标签：ssl, asp-classic

如何判断一个页面是否在“经典”ASP 中使用 SSL？我不能使用 Javascript，因为我输出的是`<noscript>`标签的结果。

这不能在 IIS 中更改或修改。它必须在脚本文件本身中。

*   [https://example.com/something.asp](https://example.com/something.asp)应该说是
*   [http://example.com/something.asp](http://example.com/something.asp)应该说 NO

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-10T14:41:48.063

您应该能够通过以下方式获取此信息

```
Request.ServerVariables("HTTPS") 
```

请参阅[此处](http://www.w3schools.com/asp/coll_servervariables.asp)了解更多信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-05-07T23:11:29.880

我用它来将图像链接更改为 https 以避免奇怪的 IE 消息：

```
<%
dim socket
If Request.ServerVariables("HTTPS") = "on" then 
socket = "https"
else
socket = "http"
End if
%> 
```

然后

```
 <img src="<%response.write(socket)%>://website.com/images/logo.png" class="logo" alt="logo" /> 
```

# c# - LINQ to SQL 更新时自动插入行副本

> ID：737821
> 
> 赞同：0
> 
> 时间：2009-04-10T14:40:25.303
> 
> 标签：c#, linq, linq-to-sql, exception

我正在使用这个简单的代码来尝试更新一行

```
 var MyDB = new SKN2DataContext();
    var s_case = MyDB.SupportCases.FirstOrDefault(sc => sc.Id == 3);
    s_case.OpenDate = DateTime.Now;
    MyDB.SubmitChanges(); 
```

在最后一行我看到了以下异常

> “SupportCase”类型对象的成员“Id”的值已更改。不能更改定义对象身份的成员。考虑添加一个具有新身份的新对象，然后删除现有对象。

当我通过在 QuickWatch 中调用 GetChangeList 看到发生了什么时，它表示 DataContext 正在尝试执行和更新（我期望的）以及同一行的插入（为什么？？？）。我不知道为什么 DataContext 试图进行插入。

**编辑**只是为了记录 OpenDate 不包含在主键中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T14:44:00.333

是`OpenDate`主键的一部分吗？我会先看看那里。

是`s_case`不是`null`？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T12:44:26.720

*   隔离您正在使用的代码，以确保没有其他原因导致它（如共享上下文）
*   在 linq2sql 设计器中重新添加表。

# vim - 如何将 Meta 键映射到 vim 中的控制键？

> ID：737823
> 
> 赞同：5
> 
> 时间：2009-04-10T14:40:45.507
> 
> 标签：vim

如何映射我的 Windows 键（在 Ubuntu 中定义为 Meta_L 键），以便它也可以用作Vim中的`Ctrl`+键？`L`在某些情况下，这对我来说是一个更舒服的映射。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T15:32:47.160

`<C->`您必须重新映射所有用于使用的序列`<M->`并将它们放在单独的 .vimrc 中。

要接收当前映射的完整列表，请使用

```
:redir > ~/mappings | map | redir END 
:e ~/mappings
:g!/<C-/d 
```

之后，您将拥有所有使用 key 的映射。将相同的映射添加到您的 .vimrc 替换

```
:help map 
```

这不是一分钟的工作，而是如何完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T18:59:30.190

看起来像`Ctrl`并且`Alt`被硬编码到 Vim 源代码中。`Ctrl`如果您不介意影响所有其他程序，您可以将您的 Windows 键映射到全局。一些窗口管理器将支持这样做，否则您可以使用[xmodmap](http://www.xfree86.org/4.2.0/xmodmap.1.html)。[Vim wiki](http://vim.wikia.com/wiki/Avoid_the_escape_key)有一些关于将 Windows 键映射到另一个的信息，`Esc`这是类似的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-12T06:02:17.277

您还可以转到系统设置 > 键盘 > 和 Alt/Win 键行为 > 控件映射到 Alt 键，Alt 映射到 Win 键。这比用拇指控制要好得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T13:51:12.777

作为使用 xmodmap 的替代方法，如果您使用 GNOME，您可以进入控制中心 → 键盘首选项 → 布局选项 → Alt/Win 行为 → 控件映射到 Win 键。（或者，运行`gnome-keyboard-properties`）

当然，这会改变一切，而不仅仅是 vim。

# python - 后续：Python 仿真软件的多处理或多线程

> ID：737826
> 
> 赞同：0
> 
> 时间：2009-04-10T14:41:10.357
> 
> 标签：python, multithreading, multicore, simulation, multiprocessing

[这是对此](https://stackoverflow.com/questions/731993/multiprocessing-or-multithreading)的跟进。（您不必阅读所有答案，只需阅读问题）

人们向我解释了进程和线程之间的区别。一方面，我想要进程，这样我就可以充分利用 CPU 的所有内核，另一方面，进程之间的信息传递不太理想，我不想拥有我正在处理的巨大对象的两个副本和。

所以我一直在想一种方法来做到这一点，结合进程和线程；告诉我这是否有意义。我的程序中的主要进程是 GUI 进程。我会让它产生一个“渲染管理器”线程。渲染管理器线程将负责渲染模拟，但是，它不会自己渲染它们，而是派生其他进程来为它完成工作。

这些是目标：

1.  渲染应该利用所有可用的核心。
2.  GUI 永远不应该变得迟缓。

我希望渲染管理器成为线程的原因是它必须与 GUI 共享大量信息：即模拟时间线。

那么你认为这是一个好的设计吗？你有什么改进的建议吗？

**更新：**

对不起，我对“渲染”这个词的使用令人困惑。渲染是指计算模拟，而不是在屏幕上渲染。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T21:40:26.043

在使用流程之前，请确保：

*   您的算法可以在所有处理器之间并行化。
*   你需要这种并行性。

在我看来，一个好的经验法则是：

1.  让它起作用。
2.  改正它。
3.  快一点。

所以我建议先“简单地”使用线程。也许您会意识到，即使使用一个线程计算模拟，它也足够快。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:41:59.040

> 我的程序中的主要进程是 GUI 进程。我会让它产生一个“渲染管理器”线程。渲染管理器线程将负责渲染模拟，但是，它不会自己渲染它们，而是派生其他进程来为它完成工作。

我不是图形技术方面的专家，但这听起来很像 GPU 的用途。也许[pygame](http://www.pygame.org/news.html)更符合您的要求？

# c++ - 接受指针和引用的 C++ 函数

> ID：737830
> 
> 赞同：1
> 
> 时间：2009-04-10T14:42:08.420
> 
> 标签：c++, pointers, reference, overloading

我正在用 C++ 编写一个库，并且有一些可与模块一起使用的函数。一个示例如下所示：

```
void connect(Module *a, Module *b); 
```

问题是，如果函数也接受引用，有时会很方便（一些模块可能分配在堆栈上，一些在堆上，所有 &s 和 *s 很快就会变得无聊和混乱）。

现在我有内联函数，它接受引用，将它们转换为指针并调用原始函数。

```
inline void connect(Module &a, Module &b){
    connect(&a, &b);
} 
```

我不太喜欢这个解决方案，因为对于更多功能，它会产生大量代码来编写、读取、编译......

正在考虑的另一件事是添加`Module::operator Module *()`将返回的内容`this`。

您对此有何看法？我错过了史诗般的失败的可能性吗？

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-10T14:47:24.710

为什么不直接调用函数

```
connect(&a, &b); 
```

就像在您的内联函数中一样，每当您必须使用引用调用它时？这清楚地表明该函数接受指针，而 that`a`和`b`不是指针。您只需再输入两个字符。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-10T14:47:28.877

任何时候使用运算符重载，都会增加史诗般失败的可能性。问题是*您*知道您的意思不是`*`标准的指针运算符，但是天真地阅读您的代码的人却没有。

最好的解决方案是返回并重构/重新考虑您的代码，因此您不需要两个接口来执行相同的操作，

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-10T15:14:26.750

我不确定在您的情况下这是否是一个好主意，但通常，您可以使用参数适配器：

```
struct ModulePtrOrRef
{
  Module * m_p;
  Module(Module * p) : m_p(p) {}
  Module(Module & p) : m_p(&p) {}
}

void connect(ModulePtrOrRef a, ModulePtrOrRef b)
{
  connect_impl(a.m_p, b.m_p);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-10T14:49:51.367

正如您所观察到的，您可以重载该函数以获取指针或引用，但我会仅仅因为方便而拒绝这样做，并坚持使用一个函数 - 这就是所有主要库的工作方式。

在该函数中使用哪种参数类型？这取决于 - 我的个人准则：

*   如果 NULL 对象有意义，请使用指针。

*   如果常见的用例是传递的对象通常是动态创建的，请使用指针。

*   如果实现在内部使用指针，请使用指针。

*   否则，使用参考。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-10T15:26:53.010

我始终遵循 Google 的 C++ 样式指南中列出的约定：

[http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Reference_Arguments](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Reference_Arguments)

这基本上说只使用 const & 和 * 其他所有内容。我认为这有助于非常清楚哪些参数是不能修改的输入（const &'s），以及哪些东西将被修改（*'s）。如果您遵循这样的约定，您可以避免挖掘源代码。

指针真的一点也不差，所以没有理由回避它们。事实上，*大多数时候*它只是意味着使用“->”而不是“.”。取消引用，这看起来更酷，并且非常值得编写更清晰的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T14:48:12.417

我非常不愿意做这样的事情——这可能是一个令人困惑的界面。

一般来说，我更喜欢使用 const 引用的接口，但如果传入的对象将被修改，我倾向于使用指针而不是非常量引用，因为它给接口的用户一个指示，表明传入的对象可能被修改。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-10T14:49:13.443

您需要两个函数的原因是，指向模块的指针从根本上是不同于模块引用的类型。没有办法解决这个问题。

对我来说，指针不好。总是。仅当您需要某物的地址而不是对某物的引用时才使用它们。而且很少需要对象的实际地址。我会做以下事情：

1.  将基于指针的函数变成基于引用的函数。
2.  在不必要的地方停止使用指针。您当然应该避免使用指针*和*引用。

此外，您可能想调查 const-ness。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-10T15:09:00.947

我会避免在公共 API 中内联。

const & 在可能的情况下优于 & 或 *

我不知道这些东西是如何联系起来的，也不知道“a”与“b”有什么关系

```
void connect(Module *a, Module *b); 
```

重新安排模块接口更明确是否有意义

```
Module a;
a.connectOutput(b); 
```

命名参数有助于上下文；）

# perl - 如何将函数返回值从引用转换为数组？

> ID：737831
> 
> 赞同：3
> 
> 时间：2009-04-10T14:42:22.100
> 
> 标签：perl, arrays, reference

我在 Perl 中有这段代码：

```
sub f {
    return [1,2,3]
}

print f; 
```

该函数`f`返回对数组的引用，如何在没有附加变量的情况下将返回值转换为数组，就像这里一样？

```
sub f {
    return [1,2,3]
}

$a = f;
print @$a; 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T14:56:22.020

你只是想这样做吗？

```
print @{ f() }; 
```

您可以取消引用任何返回引用的内容。它不一定是变量。它甚至可以是很多代码：

```
print @{ @a = grep { $_ % 2 } 0 .. 10; \@a }; 
```

[Perl v5.20 添加了一个实验性的 post dereference](http://www.effectiveperlprogramming.com/2014/09/use-postfix-dereferencing/)：

```
print f()->@* 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T15:36:29.087

### 您可以重写子例程以在不同的上下文中返回不同的内容。

```
sub f {
  my @return = 1..3;

  return  @return if wantarray;
  return \@return;
  # if you want to return a copy of an array:
  # return [@return];
}

say f;        #   list context => wantarray == 1
say scalar f; # scalar context => wantarray == 0
f();          #   void context => wantarray == undef 
```

```
123
数组（0x9238880）

```

```
my $a_s  = f; # scalar
my($a_l) = f; # list

my @b_l  =        f; # list
my @b_s  = scalar f; # scalar

my %c_l  =        f; # list
my %c_s  = scalar f; # scalar

$a_s ==   [ 1..3 ];
$a_l ==     1;

@b_l == (   1..3   );
@b_s == ( [ 1..3 ] );

%c_l == ( 1 => 2, 3 => undef );
%c_s == ( ARRAY(0x9238880) => undef ); 
```

*注意：这是 Perl6 子例程处理标量/列表上下文的方式*

# c# - 如何向 PostSharp 属性添加参数？

> ID：737833
> 
> 赞同：15
> 
> 时间：2009-04-10T14:43:15.873
> 
> 标签：c#, postsharp

我有一个简单的 PostSharp 日志记录属性：

```
[Serializable]
public class MethodLoggingAttribute : OnMethodBoundaryAspect
{
    private ILog _logger;
    public override void OnEntry(MethodExecutionEventArgs eventArgs)
    {
        _logger = LogManager.GetLogger(eventArgs.Method.DeclaringType.ToString());
        _logger.DebugFormat("Entered {0}", eventArgs.Method.Name);
    }
} 
```

我想通过将有关方法参数的信息添加到日志条目来使此属性更加灵活，但前提是它需要。

```
[Serializable]
public class MethodLoggingAttribute : OnMethodBoundaryAspect
{
    private ILog _logger;
    public override void OnEntry(MethodExecutionEventArgs eventArgs)
    {
        _logger = LogManager.GetLogger(eventArgs.Method.DeclaringType.ToString());

        // if ShowParameters = true
        _logger.DebugFormat("Entered {0} with args:{1}", eventArgs.Method.Name, args);
        // else
        _logger.DebugFormat("Entered {0}", eventArgs.Method.Name);
        // endif
    }
} 
```

带有 IF 的伪代码是我不知道该怎么做的。如何将其传递给属性？我希望它看起来像这样，但我不知道如何在属性代码中处理它：

```
[MethodLogging(ShowParameters=true)]
public void SomeCrazyMethod(int CustomerId, string SecretName) {...} 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-24T10:35:31.703

只需声明一个属性

```
[可序列化]
公共类 MethodLoggingAttribute : OnMethodBoundaryAspect
{
    私人 ILog _logger;
    公共覆盖无效 OnEntry(MethodExecutionEventArgs eventArgs)
    {
        _logger = LogManager.GetLogger(eventArgs.Method.DeclaringType.ToString());
        如果（显示参数 = 真）
        {
            _logger.DebugFormat("输入的 {0} 带有 args:{1}", eventArgs.Method.Name, args);
        }
        别的
        {
            _logger.DebugFormat("输入 {0}", eventArgs.Method.Name);
        }
    }

    私人布尔 m_ShowParameters;

    公共布尔显示参数
    {
        得到 { 返回 m_ShowParameters; }
        设置 { m_ShowParameters = 值；}
    }
}

```

然后您可以按照您提到的方式指定它。

# sql - SQLite 优化多选插入

> ID：737834
> 
> 赞同：5
> 
> 时间：2009-04-10T14:43:17.903
> 
> 标签：sql, sqlite

我已经使用 SQL 多年了，但很少有比简单的插入和选择等更多的东西......所以我不是 SQL 专家。我想知道是否可以帮助我优化我在 SQLite 上执行的更复杂的 SQL 语句，从 PHP 到 PDO。

该声明似乎工作正常，只是似乎比我预期的要花更长的时间（或者也许我只是期待太多）。

这是 SQL：

```
INSERT OR IGNORE INTO MailQueue(SubscriberID, TemplateID)
    SELECT Subscribers.ID, '1' AS TemplateID
    FROM Subscribers 
    INNER JOIN SubscriberGroups ON Subscribers.ID=SubscriberGroups.SubscriberID
    WHERE SubscriberGroups.GroupID IN ('1', '2', '3')
    AND Subscribers.ID NOT IN 
        ( 
        SELECT Subscribers.ID FROM Subscribers 
        INNER JOIN SubscriberGroups ON Subscribers.ID=SubscriberGroups.SubscriberID
        WHERE SubscriberGroups.GroupID IN ('4', '5', '6')
        ); 
```

我得到的是一个或多个组中的订阅者列表。我想将订阅者添加到邮件队列中，选择属于一个或多个组 (1,2,3) 的订阅者，但排除那些也在另一组组 (4,5,6) 中的订阅者。

首先，上面的 SQL 是典型的如何做到这一点的吗？

其次，我应该有哪些指标才能使这项工作尽可能高效？

目前，在一个 avg spec LAMP 上通过大约 5000 个订阅者记录（和少数组）大约需要 30 秒。

归根结底，性能并不是那么重要，但我想更好地理解这些东西，因此非常感谢任何洞察力。

布拉德

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T14:47:07.083

额外的连接很可能会杀死你。如果你这样做：

```
SELECT Subscribers.ID, '1' AS TemplateID
FROM Subscribers 
WHERE EXISTS( SELECT *
                FROM SubscriberGroups
               WHERE Subscribers.ID=SubscriberGroups.SubscriberID
                                 AND SubscriberGroups.GroupID IN ('1', '2', '3') )

  AND NOT EXISTS( SELECT *
                    FROM SubscriberGroups
                   WHERE Subscribers.ID=SubscriberGroups.SubscriberID 
                     AND SubscriberGroups.GroupID IN ('4', '5', '6')
    ); 
```

您还需要确保在 SubscriberGroups( SubscriberID, GroupID ) 上有一个索引

我的猜测是订阅者已经有了 ID 索引，对吧？

编辑：另一种选择，可能会也可能不会更快。查看每个查询计划以查看...

这可能是一次索引扫描，它*可能*比两次索引查找更快，但这取决于 SQLite 的优化器......

```
SELECT Subscribers.ID, '1' AS TemplateID
FROM Subscribers 
INNER JOIN( SELECT SUM( CASE WHEN GroupID IN('1', '2', '3') THEN 1 ELSE 0 END ) AS inGroup,
                   SUM( CASE WHEN GroupID IN('4', '5', '6') THEN 1 ELSE 0 END ) AS outGroup,
                   SubscriberID
                            FROM SubscriberGroups
                         WHERE SubscriberGroups.GroupID IN ('1', '2', '3', '4', '5', '6' )
          ) SubscriberGroups
       ON Subscribers.ID=SubscriberGroups.SubscriberID
      AND inGroup  > 0
      AND outGroup = 0 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-10T16:05:40.670

另一种编写可能更快的 SQL 的方法（我没有要测试的 SQLite）：

```
SELECT
     S.ID,
     '1' AS TemplateID     -- Is this really a string? Does it need to be?
FROM
     Subscribers S
LEFT OUTER JOIN SubscriberGroups SG ON
     SG.SubscriberID = S.ID
WHERE
     SG.SubscriberID IS NULL AND
     EXISTS
     (
          SELECT
               *
          FROM
               SubscriberGroups SG2
          WHERE
               SG2.SubscriberID = S.ID AND
               SG2.GroupID IN ('1', '2', '3')  -- Again, really strings?
     ) 
```

马特的方法也应该很好用。这完全取决于 SQLite 如何决定创建查询计划。

另外，请注意我的评论。如果这些确实在您的数据库中定义为 INT 数据类型，则将有一些额外的处理来在两种不同的数据类型之间进行转换。如果它们是数据库中的字符串，那有什么原因吗？这些列中是否有非数字值？

# .net - ReSharper 和 var

> ID：737835
> 
> 赞同：54
> 
> 时间：2009-04-10T14:43:41.553
> 
> 标签：.net, resharper, implicit

> **可能重复：**
> [为什么 ReSharper 想要对所有内容都使用“var”？](https://stackoverflow.com/questions/1873873/why-does-resharper-want-to-use-var-for-everything)

我有 ReSharper 4.5，到目前为止发现它非常宝贵，但我有一个担忧；
似乎想让每个变量声明都是隐式的（var）。
作为一个相对较*新*的开发人员，在这方面我应该信任 ReSharper 多少？

从绘制选项卡标题的方法中获取以下代码片段。

```
TabPage currentTab = tabCaseNotes.TabPages[e.Index];
Rectangle itemRect = tabCaseNotes.GetTabRect(e.Index);
SolidBrush fillBrush = new SolidBrush(Color.Linen);
SolidBrush textBrush = new SolidBrush(Color.Black);
StringFormat sf = new StringFormat
{
    Alignment = StringAlignment.Center,
    LineAlignment = StringAlignment.Center
}; 
```

Resharper 希望我将所有 5 个更改为*var*。我已阅读以下类似的帖子[Use of var keyword in C#](https://stackoverflow.com/questions/41479/use-of-var-keyword-in-c)，但我想从 ReSharper 的角度了解。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-10T14:49:24.517

Resharper is primarily concerned with helping you refactor code, and the `var` keyword generally makes refactoring easier. For example, if the return values of any of those functions ever change to a *compatibile* type, you don't have to change any of this code. It's therefore now a little easier to refactor your `tabCaseNotes` type, for example.

Personally, I'm often inclined to leave your first two lines alone, because I like to see the type name for a variable explicitly listed *somewhere* on the line where the variable is declared. If anything, I might look for an interface to use instead, so that I also gain the same "generic-ness" as with the `var` keyword without losing any important readable type information. However, I would definitely use `var` for `fillBrush`, `textBrush`, and `sf`.

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-10T14:59:08.427

You don't need to have the type in the line to make it more readable, its a matter of personal preference. I do like the var variation:

```
var currentTab = tabCaseNotes.TabPages[e.Index];
var itemRect = tabCaseNotes.GetTabRect(e.Index);
var fillBrush = new SolidBrush(Color.Linen);
var textBrush = new SolidBrush(Color.Black);
var sf = new StringFormat
   {
      Alignment = StringAlignment.Center,
      LineAlignment = StringAlignment.Center
   }; 
```

**Update:** I will add a controversial view on it. Unless I am reading code from a book, I don't usually care what's the specific type for understanding some lines of code I am reading. Consider the .GetTableRectangle(e.Index), for which you are not showing the code that operates on it:

```
var itemRect = tabCaseNotes.GetTableRectangle(e.Index);
//do some operations on itemRect 
```

While reading that specific code I will get more to understand it from the operations on itemRect than from its type. It can be IRectangle, Rectangle, CustomRectangle, and still won't say much on what the code is doing with it. Instead I care more for the itemRect.Height, itemRect.Width or itemRect.GetArea() along with the logic involved.

**Update 2:** As others have pointed out you can turn it off. Make sure to keep the team with the same practices, or you will probably end up with making changes one way or the other each time a different person touches the code. See: [http://www.jetbrains.com/resharper/features/codeTemplate.html](http://www.jetbrains.com/resharper/features/codeTemplate.html)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-10T14:57:50.300

Resharper doesn't *want* you to use `var`, it is giving you the option. If you do use `var` it will then give you the option to use an explicit type, so you can't win:-).

**EDIT** - interesting [link](http://resharper.blogspot.com/2008/03/varification-using-implicitly-typed.html) discussing the topic.

It seems it can be turned off, go to Resharper -> Options -> Code Inspection -> Inspection Severity and scroll down a little to see the options related to `var`.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-10T14:47:18.797

Resharper 认为这是最佳实践，但正如您在链接帖子中所读到的，有些人不同意。我喜欢使用显式声明来提高可读性，但对每个人来说都是如此。如果要使用显式声明，可以在 Resharper 中禁用该规则。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-01-09T23:26:13.863

In C#, I prefer to use `var` everywhere. Why? For the same reason that I use `firstName` instead of `strFirstName` or `amount` rather than `intAmount`. Sure, the more verbose way is more readable on a piece of paper or—as you pointed out—a book, but none of my code has shown up in a book yet.

Now, I asked a co-worker of mine a while back about this `intAmount` business and he brought up a very good point. He said that it's useful in a straight-up text editor, but when you have Intellisense, you can get the same information and more by just hovering over the variable.

Lastly, although I appreciate the happy medium that others have pointed out (i.e. using `var` with the `new` statement) and the argument is valid and strong, I'm inclined to steer away from that on the sole basis of consistency and short-hand readability. My consistency argument is that if readability is so important to you, then why don't you also use `intAmount` so you can tell the data type later on in the code?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T14:48:08.907

这个问题是开始火焰战争的好方法。然而，你应该做任何你和你一起工作的人认为最易读的事情。关于 var 的争论双方都有很好的论据。

也就是说，如果您认为显式声明类型更具可读性，那是您的事。您不必做 Resharper 告诉您的所有事情。如果您愿意，您甚至可以禁用该规则。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-10T15:03:05.953

You can indeed turn it off, and I have. I'll admit that it's nice in some cases where the class type name is long, like:

```
SuperDisconfibulator sd=new SuperDisconfibulator(); 
```

would be a good candidate for being shortened to var, but personally that's the only time that I would want it to change. I don't think its a good idea to use it when a variable is being assigned from the return value of a method (like in your second line), because it might not be immediately clear what exactly the variable type it is it returns.

# linux - 获取它指向的链接路径？

> ID：737837
> 
> 赞同：2
> 
> 时间：2009-04-10T14:43:52.143
> 
> 标签：linux, solaris, aix, symlink, hp-ux

是否有可能获得它指向的链接的绝对路径？有没有简单的系统命令？

我需要以下所有操作系统 HP-UX 11i、1123u、1123i AIX 5.2 和 5.3 Suse Linux 10 Solaris 10

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T15:59:09.687

您没有指定语言，所以我假设您想要一个可以在您使用的任何 shell 中运行的命令。该[`ls`](http://opengroup.org/onlinepubs/007908799/xcu/ls.html)命令具有`-l`（即 ell）选项，可打印出有关文件的大量信息。最后一点信息是完整路径，所以你应该可以说

```
ls -l file | awk '{print $NF}' 
```

在任何符合 SUS2 的机器上（应该是所有的商业 UNIX）。但是，如果文件或指向该文件的任何目录有空格，则会出现问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T15:06:35.040

如果您正在寻找系统调用，则需要[`readlink(2)`](http://www.opengroup.org/onlinepubs/009695399/functions/readlink.html). 这是标准化的，因此应该在所有符合 POSIX 的系统上都可用。

这是它的用法示例，取自前面给出的链接：

```
#include <unistd.h>

char buf[1024];
ssizet_t len;

if ((len = readlink("/modules/pass1", buf, sizeof(buf)-1)) != -1)
    buf[len] = '\0'; 
```

如果您正在寻找一个命令行实用程序，它看起来不像有一个标准化的，但[GNU](http://www.gnu.org/software/coreutils/manual/html%5Fnode/readlink-invocation.html) (Linux) 和[BSD](http://www.freebsd.org/cgi/man.cgi?query=readlink&apropos=0&sektion=0&manpath=FreeBSD+7.1-RELEASE&format=html)都有`readlink(1)`.

# asp.net - 如何在会员 asp.net 2008 中获得 CURRENT USERNAME

> ID：737839
> 
> 赞同：11
> 
> 时间：2009-04-10T14:44:12.753
> 
> 标签：asp.net, logging, asp.net-membership

我在 asp.net 2008 中使用了会员资格。我建立了一个登录系统，其中包含一些卷......等等

我有一个数据库和表，KEY 是“用户名”，现在我想知道如何获取登录成员的用户名？

例如：我以 TURKI 身份登录 我想获取用户名 TURKI

我真的需要帮助...

谢谢，

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-10T14:47:38.047

```
User.Identity.Name 
```

用户是页面的属性。如果您需要在其他地方访问它，您可以使用：

```
HttpContext.Current.User.Identity.Name 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-10T17:42:25.590

使用 MVC 时对 Freddy 答案的修改 - 必须使用：

```
HttpContext.User.Identity.Name 
```

略有变化，但我想我会发布它，以防其他人试图在 MVC 中执行此操作遇到同样的障碍。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-10T14:47:47.127

Context.User.Identity.Name

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T14:48:58.093

您可以使用此处描述的 Membership.GetUser() 方法：

[http://msdn.microsoft.com/en-us/library/system.web.security.membership.getuser.aspx](http://msdn.microsoft.com/en-us/library/system.web.security.membership.getuser.aspx)

此外，如果您确实获得了 MembershipUser，您还可以获得唯一标识用户的“ProviderUserKey”，可能将其用作您的表的 FK，这样您的用户就可以更新他们的用户名，而无需更改您的所有密钥表。

# sql - 通过带有可为空字段的联结表加入

> ID：737844
> 
> 赞同：1
> 
> 时间：2009-04-10T14:46:03.403
> 
> 标签：sql

一个“普通 SQL 问题”:) 我有两个表，第三个表充当“半连接表”，这意味着有时只有两个外键中的一个。有没有办法加入它们？

例如，给定以下数据：

表 D id: 1,2,3,4,5
表 C id: 1,2,3
表连接 (D.id, C.id): (1,1) (2, NULL) (3, NULL) ( 4,2) (5,3)

有没有办法检索以下内容？
([D 行 id 1 的字段],[C 行 id 1 的字段])
([D 行 id 2 的字段],[NULL C 字段])
([D 行 id 3 的字段],[NULL C 字段] )
([D 行 id 4 的字段], [C 行 id 2 的字段])
([D 行 id 5 的字段], [C 行 id 3 的字段])

如果相关，我正在使用 PostgreSQL。
谢谢你的时间！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T14:49:51.740

```
SELECT  d.*, c.*
FROM    d
JOIN    junction j
ON      j.d_id = d.id
LEFT JOIN
        с
ON      c.id = j.c_id 
```

# linq - 无法对表执行创建、更新或删除操作，因为它没有主键

> ID：737850
> 
> 赞同：23
> 
> 时间：2009-04-10T14:47:27.283
> 
> 标签：linq, insert, identity

我一直在尝试在具有标识列 RequestID 的表中插入行（这也是主键）

```
 HelpdeskLog logEntry = new HelpdeskLog { RequestBody = message.Body };
    if (attachment != null)
        logEntry.Attachments = Helper.StreamToByteArray(attachment.ContentStream);
    Database.HelpdeskLogs.InsertOnSubmit(logEntry); 
```

但是我的代码不可避免地会引发以下错误

> 无法对表执行创建、更新或删除操作，因为它没有主键。

尽管确实存在主键列

这就是我试图做的：

1.  在调试器中查看插入到对象模型中的标识列的值。它是 0
2.  手动（使用 SQL）将假值插入表中 - 工作正常，标识值按预期生成
3.  确保 SQLMetal 是否正确生成了表映射。一切OK，主键属性生成正确

然而，这两种方法都没有帮助。什么套路，有人知道吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-07-13T17:49:38.803

我的 C# 代码中也出现了这个问题，并意识到我忘记了 IsPrimaryKey 名称：

```
 [Table (Name = "MySessionEntries" )]
  public class SessionEntry
  {
     [Column(IsPrimaryKey=true)]  // <---- like this
     public Guid SessionId { get; set; }
     [Column]
     public Guid UserId { get; set; }
     [Column]
     public DateTime Created { get; set; }
     [Column]
     public DateTime LastAccess { get; set; }
  } 
```

即使您的数据库表（在本例中为*MySessionEntries*）已经定义了主键，这也是必需的，因为除非您使用 linq2sql 工具将数据库定义拉入 Visual Studio，否则 Linq 不会自动发现该事实。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-11-15T09:48:27.027

LINQ 不允许在没有主键的情况下将数据插入表中。要使用没有主键的表实现插入数据，您可以使用存储过程或创建查询并使用 LINQ 执行。下面的链接提供了很好的解释。

[无法对 Table(Employee) 执行创建、更新或删除操作，因为它没有主键](http://www.a2zmenu.com/LINQ/Cannot%20perform%20Create,%20Update%20or%20Delete%20operations%20on%20Table(Employee)%20because%20it%20has%20no%20primary%20key.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-10T14:55:57.950

删除表，然后重新插入。在执行此操作之前，您必须确保字段旁边有一个小键。重新编译您的项目，一切都应该没问题。

仅仅因为您更新了数据库并不意味着 DBML 文件会自动更新。它没有，对不起。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T14:54:45.783

由于该表在 SQL Server 中具有主键，因此在 linq2sql 设计器中重新添加该表。

如果不是这种情况，您可以在设计器上手动配置哪些属性是主键的一部分。

# ruby-on-rails - 在 git 中管理 schema.rb 的首选方法是什么？

> ID：737854
> 
> 赞同：51
> 
> 时间：2009-04-10T14:48:08.063
> 
> 标签：ruby-on-rails, git, workflow, schema.rb

我不想添加`schema.rb`到`.gitignore`，因为我希望能够从该文件加载新的数据库模式。但是，保持它处于检查状态会导致各种虚假冲突，这些冲突很容易通过新的`db:migrate:reset`.

基本上我想要一种方法：

2.  将 schema.rb 保存在存储库中以进行部署时数据库设置
3.  将 schema.rb 保存在 '.gitignore' 中以进行一般开发

会有一两个人负责更新`schema.rb`并知道它是正确的。

有没有办法让我也吃蛋糕？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-10T17:24:36.080

恐怕您正在寻找的神奇解决方案不存在。该文件通常在版本控制中进行管理，然后对于版本行上的任何冲突，只需选择两个日期中的较晚日期。只要您还运行所有相关的迁移，就不会以这种方式不同步。如果两个开发人员对 schema.rb 的相似区域进行了修改，并且除了版本之外您还遇到了冲突，那么您将面临正常的合并冲突解决方案，但在我看来，这些通常很容易理解和解决。我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-09-02T19:32:11.800

您可以做的另一件事是使用：

```
git update-index --assume-unchanged /path/schema.rb 
```

这会将文件保留在存储库中，但不会跟踪更改。您可以随时使用以下方式切换跟踪：

```
git update-index --no-assume-unchanged /path/schema.rb 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-07-29T18:29:47.533

对我来说真正有效的是删除和 .gitignore `schema.rb`，然后在每个开发人员 .gitignore 时为他们重新生成它`rake db:migrate`。

您仍然可以实现您想要的，而无需从 0 迁移并冒着多年前迁移中断的风险，只需定期进行迁移的“汇总”即可。您可以通过以下方式做到这一点：

1.  运行所有未完成的迁移`rake db:migrate`
2.  把你的内容`schema.rb`放在`ActiveRecord::Schema.define`块中
3.  将其粘贴到您的 initial_schema 迁移中`def up`（覆盖已经存在的内容）
4.  删除所有其他迁移

现在，您的 initial_schema 迁移是新系统的起点，您不必担心`schema.rb`可能无法正确解决的冲突。这并不神奇，但它有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T17:22:17.583

在预提交 git 挂钩中执行 rake db:dump 就足够了吗？

以下不一定会解决（1）或（2），但它可能会解决合并问题，然后（1）和（2）可能会消失。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T17:38:28.980

而不是使用`.gitignore`，使用单独的分支：`Develop`哪些省略`schema.rb` 和哪些包括。仅在 Develop 分支中进行代码更改，从不合并到. 保存在单独的分支中：`Test``Deploy``schema.rb``Test``Develop``schema.rb`

```
Developer A             
    Develop      --------             
    Local Schema          \           Your Repo
    Test                    --------->    Dev A
                            --------->    Dev B
Developer B               /               Master
    Develop      --------                 Schema
    Local Schema                          Test
    Test                                  Deploy 
```

在 Git 中，分支是指向文件内容集合的指针，因此它们可以包含或排除特定文件以及跟踪文件版本。这使它们成为构建特定工作流程的灵活工具。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-26T13:59:31.677

您可以定义合并策略。我找到了这个解决方案，但不记得来源

```
[merge "railsschema"]
name = newer Rails schema version
driver = "ruby -e '\n\
    system %(git), %(merge-file), %(--marker-size=%L), %(%A), %(%O), %(%B)\n\
    b = File.read(%(%A))\n\
    b.sub!(/^<+ .*\\nActiveRecord::Schema\\.define.:version => (\\d+). do\\n=+\\nActiveRecord::Schema\\.define.:version => (\\d+). do\\n>+ .*/) do\n\
      %(ActiveRecord::Schema.define(:version => #{[$1, $2].max}) do)\n\
    end\n\
    File.open(%(%A), %(w)) {|f| f.write(b)}\n\
    exit 1 if b.include?(%(<)*%L)'" 
```

把这个“某处”和

```
git-config --global core.attributesfile "somewhere" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-20T00:54:44.190

我构建了一个 gem 来解决这个问题。

它对列、索引名称和外键进行排序，删除多余的空格并运行 Rubocop 进行一些格式化以统一 schema.rb 文件的输出。

[https://github.com/jakeonrails/fix-db-schema-conflicts](https://github.com/jakeonrails/fix-db-schema-conflicts)

将其添加到 Gemfile 后，您只需运行`rake db:migrate`或`rake db:schema:dump`正常运行即可。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-01-23T22:05:06.060

1.  提交`schema.rb`文件。
2.  运行 git pull （或继续你正在做的事情）

每次迁移数据库时，`schema.rb`文件都会更新并出现在`git status`. 在处理某事并偶尔做某事`git pull`时，这可能很烦人，因为您必须在拉取文件之前提交`schema.rb`文件以解决冲突。这意味着每次迁移数据库时，都需要提交`schema.rb`文件。

# reporting-services - 页眉/页脚中的数据集字段在 PDF 导出中消失

> ID：737867
> 
> 赞同：0
> 
> 时间：2009-04-10T14:49:45.967
> 
> 标签：reporting-services, report

我被要求对我们的一个 RDL 做一些小改动。本质上，我的页眉/页脚中有一些字段可以从结果数据集中提取信息（这是通过在报表正文中创建隐藏的文本框，然后在页脚中创建一个其值设置为的文本框来完成的`ReportItems!txtHiddenMsg.Value`）。

不幸的是，页脚中的消息是动态的：它在页脚中以客户的母语显示客户 ID 和自定义“感谢您的业务”消息，并且报告中包含多个客户 ID，因此页脚文本实际上从一页到另一页的变化。这意味着不可能对页脚中的文本进行硬编码或将其绑定到不同的数据集。

报表在 ReportViewer 中呈现得很好，但在导出为 PDF 时字段会消失。我不知道如何表达这个问题，所以如果措辞尴尬，我深表歉意：

**如何将页眉/页脚中的字段绑定到数据集字段，并且该字段不会从 PDF 导出中消失？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T15:02:59.430

不幸的是，唯一可行的解​​决方案是[aspose.pdf](http://www.aspose.com/categories/ssrs-rendering-extensions/aspose.pdf-for-reporting-services/default.aspx) PDF 导出似乎无法检测到间接。

我的 BI 同事对此进行了尝试，发现它比标准解决方案更好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:29:35.623

我做了一些侦探工作，发现我们的其他一些报告将列绑定到页眉/页脚，并且它们导出得很好。看来我的报告是例外而不是常态。

问题的原因：包含我的隐藏文本框的*行*设置为不可见（我这样做是为了不必单独切换文本框）。似乎 PDF 导出中有一个~~错误~~未记录的功能，它忽略了不可见行中的文本。

解决方案：我使该*行*可见并将所有文本框设置为不可见。现在报告输出正常，导出看起来也很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-05T08:46:35.793

尝试使用**隐藏/内部**报表参数，并将默认值设置为从数据集中读取。

# javascript - 客户端 Javascript 可以在客户端工作时检测服务器何时关闭 http 连接？

> ID：737878
> 
> 赞同：1
> 
> 时间：2009-04-10T14:53:01.797
> 
> 标签：javascript, connection, detect

在我的应用程序中，客户端是浏览器中的一组 Javascript 函数，它执行一些工作 - 例如，播放剪辑。它使用 XmlHttpRequest 与服务器通信。但是，允许服务器突然关闭连接，因为似乎没有其他方法可以中断客户端。客户端能否在播放剪辑时检测到连接已关闭，然后打印一条消息并擦除页面？任何帮助表示赞赏。谢谢，阿尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T15:19:16.473

如果剪辑被流式传输到客户端，您可以停止提供它。

但是，似乎正在下载剪辑，然后通过浏览器播放。在这种情况下，最好使用 CookieOfFortune 所描述的看门狗方法：定期（大约每秒一次）轮询服务器并让它以微小的确认消息进行响应。当连接关闭时，让服务器以否定消息响应。

不幸的是，如果不使用类似彗星的系统，很难让服务器“发送”一条指示会话关闭的消息。

但请记住，只要客户下载了剪辑，他们就可以根据需要完整播放它。不幸的是，除了切换到流媒体方法之外，没有其他方法可以阻止这种情况。如果保护您的内容是一个优先事项，我建议进行此更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:00:42.463

您可能可以轮询 XmlHttpRequest 对象，因此只需尝试每隔一段时间发送一次心跳以查看连接是否已关闭。否则，服务器将不得不发送一些信号来告诉客户端它将关闭连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T19:16:28.067

似乎服务器**无法**通知客户端连接已关闭；但是，建议的轮询方法不如通知那样有效。

我通过指定在 NEXT Get 请求中解决它，客户端将被告知其会话无效。

这是通过 URL 重写实现的 - 在 Javascript 函数发送的每个请求上附加“jsessionid=[id]”。servlet 存储当前会话 ID。

# .net - 在哪里可以看到 ASP.NET 2.0 Web 项目中的引用和 Web 引用列表

> ID：737881
> 
> 赞同：4
> 
> 时间：2009-04-10T14:53:39.063
> 
> 标签：.net, asp.net, asp.net-2.0

在 1.x 中，每个 Web 项目在解决方案资源管理器中都有一个引用和 Web 引用项，我可以展开和删除/添加/刷新。

他们在 2.x 中不再拥有它

参考资料去哪儿了？

**编辑：我意识到我拥有的是一个网站，而不是一个 Web 应用程序项目**

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-10T14:54:30.230

在解决方案资源管理器中右键单击项目 -> 属性页 -> 参考

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:01:50.183

默认情况下，我相信引用节点隐藏在解决方案资源管理器中。您可以在解决方案资源管理器中选择要查看引用的项目，然后单击解决方案资源管理器顶部的显示所有文件选项。这将显示项目中的所有隐藏文件和文件夹，包括但不限于 References 文件夹。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T15:16:47.557

在 .NET 1.x 中，Web 开发是使用 Web 应用程序完成的。简而言之，IDE 将它们编译为单个程序集。

在 .NET 2.0 中，引入了一种新的项目类型 - 网站。网站不会编译为单个程序集，而是可以直接部署到 IIS 站点或虚拟目录。

您添加到程序集的任何引用（通过 Koistya 提到的属性页面）实际上是网站 BIN 文件夹中这些程序集的 DLL 的副本。然而，Web 引用略有不同。Web 引用是一个代理类，它提供对 XML 服务端点的代码访问。总之，它不是DLL，不能简单的添加到BIN文件夹中。

通过 Visual Studio 添加 Web 引用时，会自动生成一个代理类并将其添加到您的项目中。对于 Web 项目，您可以通过**网站 -> 添加 Web 引用**菜单生成 Web 引用。您必须知道服务端点的 URL。

此向导的结果是 discomap 和 wsdl 文件，它们位于您站点的 App_WebReferences 文件夹中，位于基于您在对话框中选择的命名空间的目录结构中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T15:17:21.177

在 Visual Studio 2005 中，Microsoft 引入了网站“项目”。这是一个更简单的模型，它不像所有其他项目类型那样使用项目文件。他们摆脱了我们从第一天开始就使用的 Web 应用程序项目。

由于普遍的愤怒，他们在 Visual Studio 2005 SP1 中恢复了 Web 应用程序项目。

您可能正在查看网站，而不是 Web 应用程序项目。正如上面所说的“Koistya Navin .NET”，查看“项目”属性。

就个人而言，我在大多数情况下推荐 Web Applicaton Projects。我不得不承认网站“项目”有一些很酷的东西：能够更改您的代码隐藏，保存它，然后刷新浏览器以查看更改的结果，这真是太好了。无需编译。不过，我仍然认为这不值得混淆。

# networking - 广播

> ID：737899
> 
> 赞同：3
> 
> 时间：2009-04-10T14:58:31.063
> 
> 标签：networking, udp, broadcasting

如果可能的话，任何人都可以向我提供代码或链接以使用 UDP 发送和接收广播消息吗？

我遇到了一个问题，希望你们能帮我解决它。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T15:12:08.770

这是一个 C# 示例：

```
using System;
using System.Net;
using System.Net.Sockets;
using System.Threading;

class MainClass {
    static void Main(string[] args)
    {
        ThreadPool.QueueUserWorkItem(StartUDPListener);

        UdpClient udpClient = new UdpClient();
        udpClient.Send(new byte[]{0x00}, 1, new IPEndPoint(IPAddress.Broadcast, 4567));

        Console.ReadLine();
   }

   private static void StartUDPListener(object state) {
       UdpClient udpServer = new UdpClient(new IPEndPoint(IPAddress.Broadcast, 4567));

       IPEndPoint remoteEndPoint = null;
       udpServer.Receive(ref remoteEndPoint);

       Console.WriteLine("UDP broadcast received from " + remoteEndPoint + ".");   
   }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T07:09:32.990

这是广播发送方和接收方的示例代码。

它应该很容易移植到任何可以访问标准 Berkly Sockets API 的语言。

```
#!/usr/bin/perl -w
# broadcast sender script
use strict;
use diagnostics;
use Socket;

my $sock;
my $receiverPort = 9722;
my $senderPort = 9721;

socket($sock, PF_INET, SOCK_DGRAM, getprotobyname('udp'))   || die "socket: $!";
setsockopt($sock, SOL_SOCKET, SO_REUSEADDR, pack("l", 1))   || die "setsockopt: $!";
setsockopt($sock, SOL_SOCKET, SO_BROADCAST, pack("l", 1)) or die "sockopt: $!";
bind($sock, sockaddr_in($senderPort, inet_aton('192.168.2.103')))  || die "bind: $!";

while (1) {
    my $datastring = `date`;
    my $bytes = send($sock, $datastring, 0, 
                     sockaddr_in($receiverPort, inet_aton('192.168.2.255')));
    if (!defined($bytes)) { 
        print("$!\n"); 
    } else { 
        print("sent $bytes bytes\n"); 
    }
    sleep(2);
}

#!/usr/bin/perl -w
# broadcast receiver script
use strict;
use diagnostics;
use Socket;

my $sock;

socket($sock, PF_INET, SOCK_DGRAM, getprotobyname('udp'))   || die "socket: $!";
setsockopt($sock, SOL_SOCKET, SO_REUSEADDR, pack("l", 1))   || die "setsockopt: $!";
bind($sock, sockaddr_in(9722, inet_aton('192.168.2.255')))  || die "bind: $!"; 

# just loop forever listening for packets
while (1) {
    my $datastring = '';
    my $hispaddr = recv($sock, $datastring, 64, 0); # blocking recv
    if (!defined($hispaddr)) {
        print("recv failed: $!\n");
        next;
    }
    print "$datastring";
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-02T14:20:57.090

我刚刚开始学习这个，但这是我的第一个工作示例，它可能会对你有所帮助。

## 收货人代码：

```
using System;
using System.Net;
using System.Net.Sockets;
using System.Text;

class UDPReceiver
{
    static void Main(string[] args)
    {
        IPEndPoint endPoint;
        using (UdpClient client = new UdpClient(9998))
        {
            bool connected = true;
            while (connected)
            {
                byte[] dataBytes = client.Receive(ref endPoint);
                string dataString = Encoding.UTF8.GetString(dataBytes);

                if (dataString.ToLower() != "exit")
                    Console.WriteLine(dataString);
                else
                    connected = false;
            }
        }
    }
} 
```

* * *

## 发件人代码：

```
using System;
using System.Net;
using System.Net.Sockets;
using System.Text;

class UDPSender
{
    static void Main(string[] args)
    {
        using (UdpClient client = new UdpClient())
        {
            bool connected = true;

            while (connected)
            {
                string dataString = Console.ReadLine();
                byte[] dataBytes = Encoding.UTF8.GetBytes(dataString);
                client.Send(dataBytes, dataBytes.Length, new IPEndPoint(IPAddress.Broadcast, 9998));
                if (dataString.ToLower() == "exit")
                    connected = false;
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T12:21:09.693

我不打算发布代码，只是一些观察：

1.  发送 UDP 广播就像发送单播数据包一样——只是目的地址不同。这*可以*是`INADDR_BROADCAST`(255.255.255.255)，但这可能会导致具有多个网络接口的系统出现问题。最好发送到您要发送的接口的特定广播地址。唯一重要的警告是，您可能需要`SO_BROADCAST`在您的操作系统允许发送广播之前设置套接字选项。

2.  接收 UDP 广播与接收单播数据包*完全一样。*不需要特殊代码，但您应该将接收器绑定到`INADDR_ANY`.

# java - 在哪里可以找到一组带有注入错误的 Java 测试程序？

> ID：737905
> 
> 赞同：1
> 
> 时间：2009-04-10T14:59:35.353
> 
> 标签：java

我需要一些相当简单的带有注入错误的 Java 测试程序来测试我正在处理的东西。

编辑：“注入错误”是指损坏的算法，可能导致程序崩溃的错误等等......

Edit2：我正在做一些事情，试图向程序员提供一些关于错误原因的提示，所以程序应该相当简单并且包含已知的错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T15:10:10.320

也许像[WebGoat 之类的](http://code.google.com/p/webgoat/)？这是一个存在安全错误的 java web 应用程序。

我不确定这些是否是您正在寻找的“注入错误”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:26:38.330

我已经破解了一些 J2EE 和 Swing 示例程序以[进行研究，](http://www.cs.cmu.edu/~udekel/papers/udekel_emoose_icse2009.pdf)如果您需要，我可以分享源代码。

# c# - 将事件 (tabControl_DrawItem) 提取到类库

> ID：737906
> 
> 赞同：0
> 
> 时间：2009-04-10T14:59:59.720
> 
> 标签：c#, winforms, events, refactoring, tabcontrol

我在尝试将其提取到类文件中的 TabConttrols DrawItem 事件下有以下代码。我遇到了麻烦，因为它与一个事件有关。任何提示或指针将不胜感激。

```
 private void tabCaseNotes_DrawItem(object sender, DrawItemEventArgs e)
    {
        TabPage currentTab = tabCaseNotes.TabPages[e.Index];
        Rectangle itemRect = tabCaseNotes.GetTabRect(e.Index);
        SolidBrush fillBrush = new SolidBrush(Color.Linen);
        SolidBrush textBrush = new SolidBrush(Color.Black);
        StringFormat sf = new StringFormat
                              {
                                  Alignment = StringAlignment.Center,
                                  LineAlignment = StringAlignment.Center
                              };

        //If we are currently painting the Selected TabItem we'll
        //change the brush colors and inflate the rectangle.
        if (System.Convert.ToBoolean(e.State & DrawItemState.Selected))
        {
            fillBrush.Color = Color.LightSteelBlue;
            textBrush.Color = Color.Black;
            itemRect.Inflate(2, 2);
        }

        //Set up rotation for left and right aligned tabs
        if (tabCaseNotes.Alignment == TabAlignment.Left || tabCaseNotes.Alignment == TabAlignment.Right)
        {
            float rotateAngle = 90;
            if (tabCaseNotes.Alignment == TabAlignment.Left)
                rotateAngle = 270;
            PointF cp = new PointF(itemRect.Left + (itemRect.Width / 2), itemRect.Top + (itemRect.Height / 2));
            e.Graphics.TranslateTransform(cp.X, cp.Y);
            e.Graphics.RotateTransform(rotateAngle);
            itemRect = new Rectangle(-(itemRect.Height / 2), -(itemRect.Width / 2), itemRect.Height, itemRect.Width);
        }

        //Next we'll paint the TabItem with our Fill Brush
        e.Graphics.FillRectangle(fillBrush, itemRect);

        //Now draw the text.
        e.Graphics.DrawString(currentTab.Text, e.Font, textBrush, (RectangleF)itemRect, sf);

        //Reset any Graphics rotation
        e.Graphics.ResetTransform();

        //Finally, we should Dispose of our brushes.
        fillBrush.Dispose();
        textBrush.Dispose();
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T15:39:29.500

取决于您要达到的目标。您总是可以将 TabControl 子类化，或者您可以将绘图代码封装在您将 TabControl 传递给的类中。

```
public class TabRenderer
{
    private TabControl _tabControl;

    public TabRenderer(TabControl tabControl)
    {
        _tabControl = tabControl;
        _tabControl.DrawMode = TabDrawMode.OwnerDrawFixed;
        _tabControl.DrawItem += TabControlDrawItem;
    }

    private void TabControlDrawItem(object sender, DrawItemEventArgs e)
    {
        // Your drawing code...
    }
} 
```

# c# - 所有枚举项到字符串（C#）

> ID：737917
> 
> 赞同：29
> 
> 时间：2009-04-10T15:03:27.230
> 
> 标签：c#, .net, enums

如何将所有元素从枚举转换为字符串？

假设我有：

```
public enum LogicOperands {
        None,
        Or,
        And,
        Custom
} 
```

我要存档的内容类似于：

```
string LogicOperandsStr = LogicOperands.ToString();
// expected result:  "None,Or,And,Custom" 
```

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-04-10T15:10:37.807

```
string s = string.Join(",",Enum.GetNames(typeof(LogicOperands))); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-10T15:08:18.217

你必须做这样的事情：

```
var sbItems = new StringBuilder()
foreach (var item in Enum.GetNames(typeof(LogicOperands)))
{
    if(sbItems.Length>0)
        sbItems.Append(',');
    sbItems.Append(item);
} 
```

或在 Linq 中：

```
var list = Enum.GetNames(typeof(LogicOperands)).Aggregate((x,y) => x + "," + y); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T15:12:04.043

```
string LogicOperandsStr 
     = Enum.GetNames(typeof(LogicOoperands)).Aggregate((current, next)=> 
                                                       current + "," + next); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T15:45:39.110

尽管@Moose 的答案是最好的，但我建议您缓存该值，因为您可能会经常使用它，但在执行期间它 100% 不太可能发生变化——除非您正在修改和重新编译枚举。:)

像这样：

```
public static class LogicOperandsHelper
{
  public static readonly string OperandList = 
    string.Join(",", Enum.GetNames(typeof(LogicOperands)));
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T15:07:38.657

```
foreach (string value in Enum.GetNames(typeof(LogicOoperands))
{
    str = str + "," + value;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-12T18:11:11.570

将枚举转换为可以交互的东西的简单通用方法：

```
public static Dictionary<int, string> ToList<T>() where T : struct
{
   return ((IEnumerable<T>)Enum.GetValues(typeof(T))).ToDictionary(item => Convert.ToInt32(item), item => item.ToString());
} 
```

进而：

```
var enums = EnumHelper.ToList<MyEnum>(); 
```

# qa - 浴缸曲线是否适用于现代软件？

> ID：737918
> 
> 赞同：8
> 
> 时间：2009-04-10T15:04:20.113
> 
> 标签：qa

![浴缸曲线](https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Bathtub_curve.jpg/350px-Bathtub_curve.jpg)
当然软件不会磨损，但几十年前人们普遍认为，在应用程序的生命周期代码维护后期引入的错误比修复的要多。

但是浴缸曲线是否适用于用**现代**软件工程方法 开发的**现代软件呢？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-10T15:11:50.003

简短的回答是“是”。长答案是浴缸分布不是一个很好的模型，因为故障的工作方式缺乏连续性。例如，输入值 42 会导致除零错误；那么这些故障的分布将恰好是输入中 42 个值的分布。正如您所说，它不像硬件：软件不会随着时间的推移而失败，它会在错误时失败。

现在，您可能在这里误用了这些词：您的意思是*缺陷*而不是*失败*。*失败*是一种不正确行为的发生；*缺陷*是实现中的缺陷，是“错误” 。

软件中缺陷的出现往往具有浴缸般的分布，但实际上并不像您的图片那样干净：错误往往会在早期被观察到并逐渐减少，然后在补丁和新版本中激增，一般上升趋势开始深入软件的生命周期。但是，即使这样也需要仔细定义，因为您实际上是在谈论每单位时间观察到的缺陷。

现在，话虽如此，现代 SE 实践倾向于改变实际比率，而不是随着时间的推移观察到的缺陷的分布。这里的“现代”也值得稍微定义一下：航天飞机 HAL 软件的缺陷率非常低，使用了 20 年前“现代”的 SE 技术：强大的规范、结构化编程、严格的审查以及 OCD 版本控制和测试。*极限编程往往具有较低的“缺陷”率，但许多更传统的方法称之为“缺陷”的东西 XP 称之为“用户输入”——因为它应*该做什么没有有限和严格的定义，“缺陷”只是另一个故事。

有一些不错的研究表明 XP/TDD 确实会导致低缺陷率，但如果缺陷/单位时间分布是不同的形状，我会感到非常惊讶。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T15:35:32.677

浴缸曲线实际上是硬件故障的描述（而且是一个很好的故障）而不是软件。

但是，软件也有类似的情况。一般来说，在大多数软件生产中，我们创造复杂性的能力继续略微超过我们处理复杂性的能力 --- iow 有某种彼得原则在工作，软件系统（集体）变得复杂，直到它们变得无法管理，并且然后呆在那里。因此，虽然今天我们在处理 1990 年代的一些系统性问题方面比当时要好得多，但我们在处理 00 年代的系统性问题方面并没有好多少。这就是人生。

不过，我不认为这看起来很像浴缸。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T15:10:57.087

并非如此，大多数错误是在软件的初始部署期间发现的。在那之后，它通常是一组渐进的错误，主要是由修改代码或添加新功能引起的。与最初的代码发布完全不同。随着制作原始产品的开发人员死亡，升级停止，错误也停止了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T15:15:52.113

我认为图表中有一些（小）真相。在第一个或两个版本之后，您将引入新功能和新错误以及对以前错误的错误修复，所以我认为您会不断收到新错误。但一段时间后，代码库变得脆弱且难以维护，因此我相信新错误的流量会急剧上升。那是最终（希望）你可以说服你的老板停止修补并开​​始重新设计的时候。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T15:48:21.210

我认为这在很大程度上取决于它的维护情况。我有一个大型 GUI 应用程序，实际上我是唯一维护它的程序员，而且它的缺陷频率多年来一直在稳步下降，而且我预计它在未来的任何时候都不会上升。

但是，如果我让初级程序员维护它，我不会有同样的感觉，因为维护程序员很容易编写一个“足够好”的修复程序而不是“正确的”修复程序。我不能完全责怪他，他可能没有原始程序员所做的代码知识。

关于浴缸的右侧，如果您考虑外部因素，例如操作系统，那么可能存在一些相关性，因为我有一些应用程序被较新版本的 Windows 破坏，通常不是应用程序的故障。但这是一个相对较小的数字。

# c# - 邮件附件未附加

> ID：737919
> 
> 赞同：0
> 
> 时间：2009-04-10T15:04:37.023
> 
> 标签：c#, .net, email

我正在编写一个简单的电子邮件帮助程序类，它将由 Windows 服务调用。当我测试电子邮件附件没有与电子邮件的其余部分一起发送时。

mailAttachmentFilePath 是一个 ArrayList（仅用于说明），而 mail 代表 MailMessage 类。

```
if (mailAttachmentFilePath.Count > 0)
        {
            foreach (string file in mailAttachmentFilePath)
            {
                Attachment data = new Attachment(file);
                mail.Attachments.Add(data);
                data.Dispose();
            }
        } 
```

我确定我错过了一些东西，但我不知道它是什么......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T15:08:01.993

发送电子邮件后执行 data.Dispose() ：D。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T15:09:39.073

删除 data.Dispose()。附件是通过引用添加的，因此当您调用 dispose 时，它​​实际上是在释放附件。您也不需要 if 语句。试试这个：

```
 foreach (string file in mailAttachmentFilePath)
    {
        Attachment data = new Attachment(file);
        mail.Attachments.Add(data);
    } 
```

# ssis - 如何在 SSIS 中设置 ERRORLEVEL？

> ID：737923
> 
> 赞同：0
> 
> 时间：2009-04-10T15:06:51.327
> 
> 标签：ssis, batch-file, batch-processing, errorlevel

我有一个运行 SSIS 作业的批处理文件。我不知道 SSIS 工作是如何运行的，我接手了一个涉及它的项目。

批处理文件使用 %ERRORLEVEL% 来检测 SSIS 作业中发生的错误。它也必须扩展以报告其他错误。

如何在 SSIS 中设置 ERRORLEVEL？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T13:08:05.480

这似乎是不可能的。根据[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms162810.aspx)，dtexec 只能返回 0-6 的错误代码。如果您需要更详细的错误捕获，则需要存储和解析 dtexec 的输出。

# xml - 使用 XSL 过滤大部分 XML？

> ID：737943
> 
> 赞同：0
> 
> 时间：2009-04-10T15:11:06.197
> 
> 标签：xml, xslt

我需要将大量 XML 文件（Fedora 导出）转换为不同类型的 XML。尝试使用 XSL 样式表并使用 msxsl 转换器进行检查。

假设我有这样的 xml 文件（假设在 AAA、OBJ、amd 所有其他节点中实际上还有其他节点），Source.XML：

```
<DOC>
<AAA>
    <STUFF>example</STUFF>
    <OBJ>
        <OBJVERS id="A1" CREATED="2008-02-18T13:28:08.245Z"/>
        <OBJVERS id="A2" CREATED="2008-02-19T10:42:41.965Z"/>
        <OBJVERS id="A13" CREATED="2009-03-16T12:43:11.703Z"/>
    </OBJ>
</AAA>
<FFF/>
<GGG/>
<DDD>
    <FILE />
</DDD>
</DOC> 
```

我需要看起来像这样（Target.XML）：

```
 <MYOBJ>
      <ELEM>contents of OBJVERS with the biggest id OR 
creation date (whichever is easier to do) go here</ELEM>
      <IMAGE> contents of <FILE> node go here</IMAGE>
    </MYOBJ> 
```

我遇到的主要问题是，由于我是 XSL 新手（对于这个特定任务，没有足够的时间来正确学习它）是我不明白如何告诉 XSL 处理器不要处理其他任何东西，我一直例如，从 获取输出。

更新：基本上，我同时解决了这个问题。我将发布我自己的答案并关闭问题。

Update2：好的，安德鲁的回答也有效，所以我只是接受它。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T16:48:09.443

*这个问题的表述非常松散，无助于提供更有意义的解决方案*。

**这就是说，下面的转换**：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>

    <xsl:template match="/">
      <MYOBJ>
        <ELEM>
           <xsl:for-each select="/*/AAA/OBJ/OBJVERS">
             <xsl:sort select="@CREATED" order="descending"/>

             <xsl:if test="position() = 1">
                <xsl:copy-of select="."/>
             </xsl:if>
           </xsl:for-each>
        </ELEM>

        <IMAGE>
          <xsl:copy-of select="/*/DDD/FILE"/>
        </IMAGE>
      </MYOBJ>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于人为和人为提供的 XML 文档**时（实际上它的结构和命名很糟糕，并且违反了许多设计 XML 文档的原则）：

```
<DOC>
    <AAA>
        <STUFF>example</STUFF>
        <OBJ>
            <OBJVERS id="A1" CREATED="2008-02-18T13:28:08.245Z"/>
            <OBJVERS id="A2" CREATED="2008-02-19T10:42:41.965Z"/>
            <OBJVERS id="A13" CREATED="2009-03-16T12:43:11.703Z"/>
        </OBJ>
    </AAA>
    <FFF/>
    <GGG/>
    <DDD>
        <FILE />
    </DDD>
</DOC> 
```

**产生人们可以猜到的是想要的结果**：

```
<MYOBJ>
   <ELEM>
      <OBJVERS id="A13" CREATED="2009-03-16T12:43:11.703Z"/>
   </ELEM>
   <IMAGE>
      <FILE/>
   </IMAGE>
</MYOBJ> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:43:25.653

这不是完整的解决方案，因为它不会在选择第一个之前对 OBJVERS 进行排序。但是如果你能解决选择正确的OBJVERS的问题，那么我认为剩下的就可以了。

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
<xsl:output method="xml"/>
<xsl:template match="/">
    <MYOBJ>
        <xsl:for-each select="/DOC/AAA/OBJ/OBJVERS[position()==1]">
            <ELEM><xsl:copy-of select="*"/></ELEM>
        </xsl:for-each>
        <IMAGE><xsl:copy-of select="/DOC/DDD/FILE/*" /></IMAGE>
    </MYOBJ>
</xsl:template> 
```

# .net - .NET 配置部分设计器 - 我的收藏在哪里？

> ID：737946
> 
> 赞同：2
> 
> 时间：2009-04-10T15:11:20.083
> 
> 标签：.net, configuration, app-config, designer, config-designer-csd

我正在使用 .NET 的[配置部分设计器](http://csd.codeplex.com/)来构建一个简单的`ConfigurationElementCollection`. 似乎一切都构建得很好，并且代码是自动生成的，因为子元素在 Intellisense 中是可见的*。*

不幸的是，即使我在配置部分向集合中添加了元素，它们在运行时并不存在；它显示集合的`Length`属性为 0 - 即使集合是空的，正如您在我的示例 XML 中看到的那样，我已经清楚地将它们放在那里：

### 示例配置

```
<logParserSettings xmlns="LogParser">
  <domainControllers>
    <domainController ID="0" name="Local" serverType="Local" enabled="true"/>
    <domainController ID="1" name="DC1" serverType="WindowsServer2003" enabled="false" />
    <domainController ID="2" name="DC2" serverType="WindowsServer2008" enabled="false" />
  </domainControllers>
</logParserSettings> 
```

### 各种各样的

*   在设计器中，我所拥有的就是您在此处看到的 a `ConfigurationSection`、 a`ConfigurationElementCollection`和 a `ConfigurationElement`- 没有额外的配置元素/部分/组
*   我没有在运行时添加或删除任何东西
*   我已经尝试过生成和不生成`Singleton`属性，但是单例实例和设置类的实例似乎都不起作用
*   对于 ID 属性，该`Is Key`属性设置为 true，所有其他属性都标记为 true`Is Required`

有没有人遇到过这个？如果是这样，我必须进行哪些更改才能使其按预期工作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-10T18:48:53.507

好吧，通过将问题指定为特定元素，我严重过度复杂化了真正的问题，结果证明即使是简单的测试属性`ConfigurationSection`也不会返回预期值。我也意识到我无法访问`AppSettings`，这导致了一个肆虐的线索。

最终原因？该项目被编译为类库。配置文件[仅在应用程序级别可用](http://www.velocityreviews.com/forums/showpost.php?p=517169&postcount=3)。由于我使用 NUnit 来运行测试，因此测试项目中的配置文件覆盖了类库的开发文件。这对于任何没有陷入 ASP.NET 领域的开发人员来说可能是显而易见的。

`configSection`通过在`app.config`测试项目中添加以下内容：

```
<section name="customConfigSection" type="ClassLibraryNamespace.SettingsClass, ClassLibraryNamespace"/> 
```

并填写相应的部分，可以按预期访问数据。

希望这可以节省一些人的调试时间。

# python - Python中的暂存盘？

> ID：737947
> 
> 赞同：2
> 
> 时间：2009-04-10T15:11:33.827
> 
> 标签：python, windows, memory-management

我知道在某些 Windows XP 程序中，比如 Photoshop，有一种叫做“暂存盘”的东西。我理解这意味着，如果我错了，请纠正我，是 Photoshop 在硬盘驱动器上管理自己的虚拟内存，而不是让 Windows 管理它。我知道这样做的原因是 Windows XP 对进程可以占用多少总内存的一些限制，而不管 HD 空间如何。我认为它大约是 3 GB。到目前为止我做对了吗？

我正在用 Python 制作一个应用程序来运行模拟。它会占用大量内存，并且可以在 Windows XP 上运行。它可以使用暂存盘吗？如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T15:20:11.217

除非你真的用完内存，否则想想这是浪费时间。

当您最终确实耗尽内存时，您需要使用一个临时文件来存储您的进程需要但无法放入内存的对象。

在文件中使用 pickle 或搁置（请参阅[Data Persistence](http://docs.python.org/library/persistence.html)）您的对象。如果该文件恰好位于名为“scratch”的磁盘上，那很好。

有时，出于性能原因，您希望临时文件与其他工作文件位于单独的磁盘上。在某些环境（SAN、NAS、存储阵列）中，您的磁盘是虚拟的，寻找“临时”磁盘并没有任何性能优势。在其他环境中（即您拥有所有硬件），您可以将临时文件放在其他驱动器上，使该驱动器成为“临时”磁盘。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T15:32:49.390

> 我知道这样做的原因是 Windows XP 对进程可以占用多少总内存的一些限制，而不管 HD 空间如何。我认为它大约是 3 GB。

仅供参考，这更像是 32 位操作系统的限制，而不是 Windows XP 的问题。你会在 32 位 Vista、linux、bsd 中遇到同样的问题……你明白了。如果你走 64 位路线，你就不会有这些问题。

例如，Windows XP x64 允许[每个进程最多 8 TB 的内存](http://en.wikipedia.org/wiki/Windows_xp_tablet_pc_edition#Advantages)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T15:18:21.080

如果您的应用程序处理非常大的文件，暂存盘将使您的应用程序受益，

是这样吗？

如果没有，那么我认为您不会在暂存盘中找到有益于您的应用程序的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T15:31:20.923

[内存映射文件](http://docs.python.org/library/mmap.html)可能是您正在寻找的。Python 的实现允许您在内存中使用像可变字符串这样的文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-10T16:04:59.297

Win32 API 提供了这个：[链接文本](http://msdn.microsoft.com/en-us/library/aa366527(VS.85).aspx)。您也许可以通过 PyWin32 使用这些功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T17:40:44.280

您可以将 S.Lott 关于使用 pickle 的答案（您应该使用 cPickle 以获得更好的性能）与 SqlLite 结合使用。

sqlite 内置于 python 2.5 及更高版本中，因此您需要做的就是导入 :)，然后将腌制对象作为字符串存储在那里，您将有一个很好的快速访问数据的方法（与构建您的自己的方法），这也将帮助您保持井井有条。

注意：cPickle 与使用中的 pickle 几乎相同。唯一的区别是它是用 C 编写的

有用的 Python 文档：

*   [sqlite3 模块](http://docs.python.org/library/sqlite3.html)
*   [泡菜模块](http://docs.python.org/library/pickle.html)

**编辑**：有一个用户控制的内存使用限制可能是个好主意。当用户有 8GB 的​​ RAM 时，将一堆数据存储在磁盘上并等待慢速磁盘 I/O 将是一种耻辱；）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-17T16:59:51.317

您可能正在寻找像 ZODB 这样的东西。然而，尽管 ZODB 努力做到透明，但没有任何解决方案是 100% 没有伪影的。您必须在编写代码时意识到您的对象主要存在于数据库中，但是您的对象有多种表示形式，存在缓存/同步问题等。没有什么能让这个非常困难的问题对您来说完全微不足道.

# xml - 使用 XSLT 重命名 XML 元素

> ID：737973
> 
> 赞同：2
> 
> 时间：2009-04-10T15:23:46.603
> 
> 标签：xml, xslt

我需要更改原始 XML 中的一些元素名称。我正在尝试使用 XSLT 执行此操作，但无法使其正常工作。

这是一个 XML 示例：

```
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="test.xsl" type="text/xsl"?>
<html>
<body>
    <section>Jabber</section>       
            <itemtitle>JabberJabber</itemtitle>
                    <p>Always Jabber Jabber Jabber</p>
            <h3>Emboldened Requests </h3>
                    <p>Somemore Jabber Here</p>
                    <img scr="bigpicture.jpg"></img>
            <poll><p>Which statement best characterizes you?</p></poll>
            <pcredit>Left: Jumpin Jasper/Jumpy Images</pcredit>
</body>
</html> 
```

我需要将其更改为：

```
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="test.xsl" type="text/xsl"?>
<html>
<body>
   <div class="issuehead">Jabber</div>   
   <div class="issuetitle">JabberJabber</div>
      <p>Always Jabber Jabber Jabber</p>
   <h3>Emboldened Requests </h3>
      <p>Somemore Jabber Here</p>
   <img scr="bigpicture.jpg"></img>
   <div class="poll"><p>Which statement best characterizes you?</p></div>
   <div class="pcredit">Left: Jumpin Jasper/Jumpy Images</div>
</body>
</html> 
```

这是我做的 XSLT，但我无法让它工作：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.1"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:output method="html" />

<xsl:template match="/">

<html>
<head>  
</head>
<body>
   <xsl:apply-templates/>
</body>    
</html>

  <xsl:template match="section">
    <div class="issuehead"><xsl:value-of select="."/></div>
  </xsl:template>

  <xsl:template match="itemtitle">
    <div class="issuetitle"> <xsl:value-of select="."/></div>
  </xsl:template>

  <xsl:template match="img"></xsl:template>

  <xsl:template match="poll">
    <div class="poll"><xsl:value-of select="."/></div>
  </xsl:template>

  <xsl:template match="pcredit">
    <div class="pcredit"><xsl:value-of select="."/></div>
  </xsl:template>

  <xsl:template match="p"></xsl:template>

  <xsl:template match="h3"></xsl:template>

 </xsl:template>
</xsl:stylesheet> 
```

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T15:39:04.803

对于这样的事情，从*身份转换*开始：

```
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:template match="node( ) | @*">
    <xsl:copy>
        <xsl:apply-templates select="@* | node( )"/>
    </xsl:copy>
</xsl:template>

</xsl:stylesheet> 
```

这只会复制每个节点。但是随后您添加了其他模板来执行您需要的操作：

```
<xsl:template match="section"> 
  <div class="issuehead">
      <xsl:apply-templates select="@* | node( )"/>
  </div>
</xsl:template> 
```

这种模式应该可以得到你想要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T15:58:58.890

以下模板实现了您正在寻找的结果：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
        xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <xsl:output method="html" />

    <!-- Copy all elements and attributes from the source to the target -->
    <xsl:template match="@*|node()">
        <xsl:copy>
            <xsl:apply-templates select="@*|node()" />
        </xsl:copy>
    </xsl:template>

    <!-- Transform the given elements to divs with class names matching the source element names -->
    <xsl:template match="itemtitle|poll|pcredit">
        <div class="{local-name(.)}">
          <xsl:value-of select="."/>
        </div>
    </xsl:template>

    <!-- Transform the section element to a div of class 'issuehead' -->
    <xsl:template match="section">
        <div class="issuehead">
            <xsl:value-of select="."/>
        </div>
    </xsl:template>

</xsl:stylesheet> 
```

如果您想要格式更好的标记，请修改 xsl:output 标记，如下所示：

```
<xsl:output method="xml" 
    version="1.0" 
    encoding="UTF-8" 
    indent="yes" 
    omit-xml-declaration="yes" 
    doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN" 
    doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"
/> 
```

# c++ - 寻找一组丰富的c++跨平台库

> ID：737979
> 
> 赞同：0
> 
> 时间：2009-04-10T15:26:23.790
> 
> 标签：c++, mono

他们是否有任何提供类似于单声道但用于 c++ 语言的功能的库？我知道 boost 存在，但我更喜欢单声道而不是 boost。

我正在寻找比基础库集中可用的更多功能，例如更轻松地播放声音（跨平台）、GUI、加载图像、时间等。我想我正在寻找人们可能认为的引擎或大型库.

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-10T15:32:25.913

Mono 是一个 .NET 实现。Mono 不是图书馆。C++ 没有 Mono。至少，现在还没有。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-10T17:29:12.887

我想你想要一个多平台的框架，比如[Qt](http://qt.nokia.com/)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-10T15:46:12.870

如果您想使用 .Net 上的托管 C++，那么您只需使用 Mono。他们有一个页面描述[如何去做](http://mono-project.com/CPlusPlus)。唯一的问题是您必须在 Windows 上编译，因为目前还没有任何类型的 GCC 可以为 C++ 输出 .Net CLI。

不过，老实说，如果你打算使用 Mono，你还不如转向 C#。这是一种更简洁的语言，IMO。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-06-12T16:14:08.593

我不确定您的确切要求，但就大型多功能包而言：Qt 已被一些人提及。[wxWidgets](http://www.wxwidgets.org/ "wxWidgets")（以前的 wxWindows）是另一种选择。 [GTK](http://www.gtk.org/ "GTK")是多平台的。

[当您使用“引擎”一词（通常是与游戏相关的术语）时，您可能会对SDL](http://libsdl.org)感兴趣，它已被众多游戏（专业和业余爱好者）使用。 [SFML](http://sfml-dev.org)是一种选择。 [ClanLib](http://clanlib.org/wiki/Main_Page)是我听说过的另一个长期存在的库，尽管我承认对它知之甚少。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-16T11:57:57.357

CLI 只能在所有受支持的平台上托管 C++ 编译代码，只要编译代码仅包含 CIL 而不是本机代码。

欲了解更多详情，请访问 [http://www.mono-project.com/CPlusPlus](http://www.mono-project.com/CPlusPlus)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T15:36:15.920

试试 STL 集合...与 .NET 无关，但它们是一个很好的集合集合 (lol)，让 C++ 的生活更轻松。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-28T22:57:45.147

听起来您真正在寻找的是一个 C++ 框架，它提供了 .NET/Mono 框架中的各种功能。[Qt](http://qt.nokia.com/)是一个流行的选择。

[在 C++ 互操作性的话题上，Mono 最近在CXXI](https://github.com/mono/cxxi)方面取得了很大进展。

（[来自这篇文章](http://tirania.org/blog/archive/2011/Dec-19.html)）：简短的故事是新的 CXXI 技术允许 C#/.NET 开发人员：

*   从 C# 或任何其他 .NET 语言轻松使用现有的 C++ 类
*   从 C# 实例化 C++ 对象
*   从 C# 代码调用 C++ 类中的 C++ 方法
*   从 C# 代码调用 C++ 内联方法（前提是您的库是使用 -fkeep-inline-functions 编译的或者您提供了代理库）
*   从 C# 继承 C++ 类
*   用 C# 方法覆盖 C++ 方法
*   向 C# 代码和 C++ 公开 C++ 类或混合 C++/C# 类的实例，就好像它们是本机代码一样。

CXXI 是 Google Summer of Code 两个暑期工作的成果，旨在提高 Mono 与 C++ 语言的互操作性。

# asp.net - 如何在 ASP.NET 中动态添加文本框？

> ID：737981
> 
> 赞同：3
> 
> 时间：2009-04-10T15:26:45.990
> 
> 标签：asp.net, asp.net-3.5

我的 asp.net 页面有以下要求：

1.  用户可以通过单击链接“添加新类别”超链接在页面 A 上动态添加文本框

2.  他单击页面 A 上的提交按钮并被重定向到页面 B。

3.  当他单击此页面中的页面 A 链接时，应保留他添加的文本框。

有人可以帮我写代码吗？

感谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T15:32:11.013

在 ButtonClick 方法中编写。

```
TextBox tb = new TextBox();

Parent.Controls.Add( tb ); 
```

Parent 是您要将文本框添加到的控件，例如面板。

你也可以看看[这个资源](http://www.4guysfromrolla.com/articles/081402-1.aspx#postadlink)。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-10T15:32:45.273

动态添加用户控件很简单。但在这种情况下，我认为您不需要这样做，而是应该考虑创建一个带有文本框的转发器，当用户单击“添加类别”时，将一项添加到转发器数据源。

这样，您可以同时处理控件创建和状态持久性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T13:42:16.707

处理动态用户控件可能会让人头疼。

根据我的经验，每当您创建动态用户控件时，您必须设置它的 ID，以便 ASP.net 可以在回发时重新分配它，并在回发后保留控件值，您应该在 Page_Init 上重新加载用户控件事件。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-02-25T12:52:21.290

动态创建文本框：

假设你有这样的页面![在此处输入图像描述](https://i.stack.imgur.com/8adEP.png)

当您在文本框中输入“1”并单击添加按钮时，输出将就像在下面显示一个文本框..我这样设计， ![在此处输入图像描述](https://i.stack.imgur.com/nVSIQ.png)

我有一个用于显示动态文本框的文本框和占位符。双击添加按钮...在 btnadd_click 中，您必须编写以下代码

受保护的无效btnadd_Click（对象发送者，EventArgs e）{

```
 int i;
       for (i = 0; i < Convert.ToInt32(txtno.Text); i++)

    {

        TextBox txtbox = new TextBox();
        phtxt.Controls.Add(txtbox);

        phtxt.Controls.Add(new LiteralControl("<br>"));

    }

  } 
```

调试它......输出是， ![在此处输入图像描述](https://i.stack.imgur.com/0k6gk.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T15:39:18.843

正如其他人所说，动态添加文本框相当简单，只需创建文本框并将其添加到控件集合中，无论您需要它显示在哪里。然后，您需要存储该用户获取此附加文本框的信息。假设这是长期的，您需要将此信息存储在后端存储中。每当您构建页面时，您都需要首先阅读商店信息以查看要创建的文本框。

我建议按以下方式进行。在 Onload 事件中，如果您之前没有这样做过，请从您的数据库中加载动态信息。向页面添加任何必要的控件并将此信息存储在视图状态中。在任何后续回发中，从 viewstate 中读取信息以添加其他控件。这将使您不必在每次回发时不断地从数据库中读取。

# database - 如何使用 Hibernate 在不丢失数据的情况下更新数据库模式？

> ID：737989
> 
> 赞同：29
> 
> 时间：2009-04-10T15:29:58.337
> 
> 标签：database, hibernate, schema, migrate

假设您正在使用 Hibernate 和 JBoss 开发 Java EE 应用程序。您有一个正在运行的服务器，上面有一些重要数据。您偶尔（1-2 周）发布应用程序的下一个版本，并且它们在持久层中有很多变化：

*   新实体
*   移除的实体
*   属性类型更改
*   属性名称更改
*   关系变化

您如何有效地建立一个更新数据库模式并保留数据的系统？据我所知（我可能弄错了），Hibernate 不执行更改列、删除/更改约束。

谢谢你，Artem B。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-15T03:22:22.320

[LiquiBase](http://www.liquibase.org)是您最好的选择。它有一个[hibernate 集成](http://www.liquibase.org/manual/hibernate)模式，使用 Hibernate 的 hbm2ddl 来比较你的数据库和你的 hibernate 映射，但它不会自动更新数据库，它会输出一个 liquibase 更改日志文件，可以在实际运行之前对其进行检查。

虽然更方便，但任何比较数据库和休眠映射的工具都会出错。有关示例，请参见[http://www.liquibase.org/2007/06/the-problem-with-database-diffs.html](http://www.liquibase.org/2007/06/the-problem-with-database-diffs.html)。使用 liquibase，您可以在开发时建立一个数据库更改列表，该格式可以在带有分支和合并的代码中存活。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T15:57:13.903

我个人会跟踪迁移 SQL 脚本中的所有更改。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-10-27T21:58:21.357

您可以使用[https://github.com/Devskiler/jpa2ddl](https://github.com/Devskiller/jpa2ddl)工具，该工具提供 Maven 和 Gradle 插件，并且能够基于 JPA 实体为[Flyway生成自动模式迁移。](http://flywaydb.org/)它还包括所有属性、方言、用户类型、命名策略等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T16:04:25.070

[http://liquibase.org/](http://liquibase.org/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-11T15:30:10.340

对于一个应用程序，我使用 SchemaUpdate，它内置于 Hibernate，直接来自引导程序类，因此每次应用程序启动时都会检查架构。这负责添加新的列或表，这主要发生在成熟的应用程序中。为了处理特殊情况，比如删除列，引导程序只是在 try/catch 中手动运行 ddl，所以如果它已经被删除一次，它只会默默地抛出一个错误。我不确定我是否会在生产应用程序中处理关键任务数据，但在几年和数百次部署中，我从来没有遇到过问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-07-17T09:28:04.003

作为 Nathan Voxland 关于[LiquiBase](http://www.liquibase.org)的进一步回应，下面是一个在 Windows 下为 mySql 数据库执行迁移的示例：

例如，将 mysql**连接器**放在 liquibase 发行版中的**lib**文件夹下。

在 liquibase 发行版的根目录中创建一个文件属性**liquibase.properties并插入此循环行：**

```
driver: com.mysql.jdbc.Driver
classpath: lib\\mysql-connector-java-5.1.30.jar
url: jdbc:mysql://localhost:3306/OLDdatabase
username: root
password: pwd 
```

以其他名称生成或检索更新的数据库，例如**NEWdatabase**。

现在，您将使用以下命令行提取文件**Migration.xml中的差异：**

```
liquibase diffChangeLog --referenceUrl="jdbc:mysql://localhost:3306/NEWdatabase" 
--referenceUsername=root --referencePassword=pwd > C:\Users\ME\Desktop\Migration.xml 
```

最后使用刚刚生成的**Migration.xml**文件执行更新：

```
java -jar liquibase.jar --changeLogFile="C:\Users\ME\Desktop\Migration.xml" update 
```

注意：所有这些命令行都应该从 liquibase.bat/.sh 和 liquibase.jar 所在的 liquibase 主目录执行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-11T01:25:11.713

我使用 hbm2ddl ant 任务来生成我的 ddl。有一个选项可以在您的数据库中执行更改表/列。

请查看 hbm2ddl 蚂蚁任务的“更新”属性：

[http://www.hibernate.org/hib_docs/tools/reference/en/html/ant.html#d0e1137](http://www.hibernate.org/hib_docs/tools/reference/en/html/ant.html#d0e1137)

> 更新（默认值：false）：尝试创建一个更新脚本，表示数据库中的内容与映射指定的内容之间的“增量”。忽略创建/更新属性。（不要*对*生产数据库使用，完全不保证可以生成正确的增量，也不保证底层数据库可以实际执行所需的操作）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-09T09:07:32.113

您也可以使用**[DBMigrate](http://code.google.com/p/dbmigrate/)**。它类似于 Liquibase ：

> 与 Ruby on Rails 的 'rake migrate' 类似，此库可让您管理 Java 应用程序的数据库升级。

# continuous-integration - 我可以访问 CruiseControl.net 构建标签吗？

> ID：737991
> 
> 赞同：2
> 
> 时间：2009-04-10T15:31:11.453
> 
> 标签：continuous-integration, cruisecontrol.net

有什么方法可以访问 CruiseControl.NET 的构建标签号？（也许通过使用批处理文件。）基本上，我想`LastSuccessfulIntegrationLabel`在构建之前检索值“”并在批处理文件中使用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T17:51:34.190

您不能在批处理脚本中简单地使用**CCNetLabel**环境变量吗（请参阅底部的[http://confluence.public.thoughtworks.org/display/CCNET/Executable+Task ）？](http://confluence.public.thoughtworks.org/display/CCNET/Executable+Task)

如果在构建**之前**需要它，可以将批处理设置为作为`<prebuild>`任务运行：[http ://confluence.public.thoughtworks.org/display/CCNET/Project+Configuration+Block](http://confluence.public.thoughtworks.org/display/CCNET/Project+Configuration+Block)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T17:15:27.427

确定它在状态文件中。这是我在 PowerShell 中的操作方法

```
$xml = [xml](gc $statefile)

[string]$buildnum =$xml.IntegrationResult.Label 
```

# .net - 什么是 .NET 中的代码访问安全性

> ID：737995
> 
> 赞同：9
> 
> 时间：2009-04-10T15:31:35.400
> 
> 标签：.net

**.NET 中的CAS** （代码访问安全）是什么，如何实现？使用它有什么好处？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-10T15:36:26.230

简而言之，CAS 是 .NET 的安全沙箱。本地应用程序通常具有完全信任，这意味着它们可以做任何事情。托管在浏览器中的 .NET 应用程序无能为力。在这两者之间，几乎任何安全设置都可以使用 CAS 进行微调。

它的好处：即使在登录用户的上下文中，也可以很好地控制 .NET 应用程序可以做什么。关于它的最好的部分，IMO，是安全检查遍历堆栈，因此即使某些代码有权做某事，如果该方法被另一个*无权*做某事的程序调用，该请求也会失败（除非采取特殊措施）。

缺点：这是一个非常复杂的学习对象。很多陷阱。但希望我提供的链接将引导您了解您需要了解的任何细节。

# c++ - Linux 上运行程序的目录？

> ID：737996
> 
> 赞同：4
> 
> 时间：2009-04-10T15:31:35.680
> 
> 标签：c++, linux, unix

嘿，我一直在编写一个程序（一种电子书查看类型的东西），它从可执行文件所在的文件夹中的文件夹加载文本文件。这给我带来了一些问题，因为如果我使用命令“./folder/folder/program”从另一个目录运行程序，例如，我的程序将找不到文本，因为工作目录不正确。我不能有一个绝对目录，因为我希望程序是可移植的。有没有办法获得可执行文件运行的精确目录，即使它是从不同的目录运行的。我听说可以结合 argc[0] 和 getcwd() 但是当目录中有空间时 argc 会被截断，（我认为？）所以我想尽可能避免这种情况。

我在 Linux 上使用 g++，提前谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-10T15:38:57.847

编辑 - 不要使用 getcwd()，它只是用户不在可执行文件所在的位置。

详情请看[这里](http://www.linuxquestions.org/questions/programming-9/how-do-i-get-the-application-path-in-c-426517/?highlight=executable+path)。

在 Linux 上 /proc/<pid>/exe 或 /proc/self/exe 应该是指向可执行文件的符号链接。和其他人一样，我认为更重要的问题是“你为什么需要这个？” 使用可执行路径查找辅助文件并不是真正的 UNIX 形式。相反，您使用环境变量或默认位置，或遵循其他约定之一来查找辅助文件的位置（即 ~/.<myapp>rc）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T15:38:31.250

当您将一本书添加到您的图书馆时，您可以记住它的绝对路径。
当您的程序依赖于它将从工作目录而不是从其他某个目录启动的事实时，这还不错。这就是为什么有各种带有“工作目录”参数的“链接”。

您不必以您想要的方式处理此类情况。只需检查所有必要的文件和目录结构是否到位，如果没有，请在说明中记录错误。

或者每次当您的程序启动并且没有找到必要的文件时，程序可以要求将路径指向图书库。

我仍然看不到知道您当前目录名称的原因。

```
#include <boost/filesystem/convenience.hpp>

#include <iostream>
#include <ostream>

int main(int argc, char** argv)
{
    boost::filesystem::path argvPath( argv[0] );
    boost::filesystem::path executablePath( argvPath.parent_path() );
    boost::filesystem::path runPath( boost::filesystem::initial_path() );

    std::cout << executablePath << std::endl;
    std::cout << runPath << std::endl;
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T15:37:54.887

您可以通过阅读命令行来获取正在运行的程序的路径。在 linux 中，您可以通过将 /proc 文件夹读取为 /proc/PID/CommandLine 来获取命令行

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T16:14:31.880

`argv[0]`有空格时不截断。但是，当从 PATH 环境变量中列出的目录运行程序时，它将只有程序名称而不是路径。

无论如何，您在这里尝试做的对于 Unix/Linux 程序来说都不是好的设计。数据文件不与程序文件存储在同一目录中，因为这样做会使应用适当的安全策略变得困难。

在我看来，获得所需内容的最佳方法是使用 shell 脚本来启动实际程序。这与 Firefox 在 Linux 系统上的启动方式非常相似。shell 将脚本的名称放入`$0`其中，并且此变量将始终具有路径。然后您可以使用环境变量或命令行参数为您的程序提供数据文件的位置，如下所示：

```
dir=`dirname "$0"`
cd "$dir/../data/"
"$dir/real-program" 
```

我会安排你的程序，使它的文件有点像这样：

```
install-dir/bin/program
install-dir/bin/real-program
install-dir/etc/config
install-dir/data/book-file.mobi 
```*************************