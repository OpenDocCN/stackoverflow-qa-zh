# StackOverflow 问答 000429000-000429999

# jruby - 我可以将 Java 类文件导入 JRuby 吗？

> ID：429002
> 
> 赞同：8
> 
> 时间：2009-01-09T17:44:10.470
> 
> 标签：jruby, jruby-java-interop

文档似乎表明，为了让我将 Java 类导入 JRuby，它们必须位于 JAR 文件中：

“为了在 JRuby 的 jar 文件中使用资源，jar 文件必须位于类路径中，或者您可以使用 require 方法使其可用”（[http://wiki.jruby.org/wiki/Calling_Java_from_JRuby#Require_a_jar_file_to_make_resources_in_the_jar_discoverable_within_JRuby](http://wiki.jruby.org/wiki/Calling_Java_from_JRuby#Require_a_jar_file_to_make_resources_in_the_jar_discoverable_within_JRuby)）

是否可以直接导入 .class 文件？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-09T18:09:10.373

我设法回答了我自己的问题:)

如果你的类文件被编译为“target”的相对路径，例如 foo.Bar 位于“target/foo/Bar.class”，那么你执行以下操作：

```
require 'java'
require 'target/foo/Bar'

module Foo
  include_package 'foo'
end

puts Foo::Bar.new 
```

结果：

```
foo.Bar@1582a7c 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-09T17:04:59.533

我想你也可以：

```
require 'java'
$CLASSPATH << "target" 
```

进而

```
foo.bar.baz.Class.new() # ... 
# or 
java_import 'foo.bar.baz.Class' 
```

# javascript - 与发送 JSON 和构建 HTML 相比，在 AJAX 中发送 HTML 有多危险？

> ID：429005
> 
> 赞同：11
> 
> 时间：2009-01-09T17:45:18.673
> 
> 标签：javascript, html, ajax, security, json

> **可能重复：**
> [为什么返回生成的 HTML 而不是 JSON 是一种不好的做法？或者是吗？](https://stackoverflow.com/questions/1284381/why-is-it-a-bad-practice-to-return-generated-html-instead-of-json-or-is-it)

在我看来，任何对此的拦截都可能立即带来麻烦，因为任何人都可以将任何 HTML/脚本发送回客户端。

我对此感兴趣的唯一原因是，每次 DOM 结构/CSS 发生变化时前端开发人员都会感到巨大的痛苦，所以你现在必须弄清楚你可能在 Javascript HTML 构建过程中的哪个位置更新。

你们如何处理这个问题？我可以做些什么来降低任何风险，或者这只是个坏主意？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-09T18:04:17.280

我倾向于使用以下规则：

1.  请求并返回 HTML 以获得快速片段，然后使用客户端（静态）Javascript 插入它们。非常适合警报消息。

2.  请求并返回大型数据集的 JSON。当您想在客户端进行过滤、分组或排序而不以不同的形式重新请求数据时，这非常有用。

3.  为大型数据集请求并返回 JSON，但在 JSON 记录中为每条记录包含（转义的）HTML 片段。这意味着比（2）更多的渲染时间和更多的带宽使用，但可以减少通常复杂的 HTML 渲染的重复。

4.  请求并返回 Javascript，`eval`它是客户端的。这最适用于隐藏、显示、移动和删除等交互。它也可以用于插入，但通常类型 (1) 或 (5) 更适合插入。

5.  请求并返回 Javascript，`eval`它在客户端，但在 Javascript 中包含转义的 HTML，因此服务器正在执行 HTML 呈现。

我可能最常使用 5 和 1。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T17:50:32.907

在我看来，当 DOM 结构或 CSS 发生更改时，要弄清楚后端服务器中需要更改的位置会更加麻烦。

将所有这些保存在一个地方（HTML 文件）可能是将 ajax 通信限制为 JSON 的最佳理由。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T18:00:31.827

对于 JSON 原始 html，您仍然担心内容的安全性，毕竟 JSON 是 JavaScript 代码。我想如果你不信任你的 HTML 数据的来源，那么你就会受到各种跨站点脚本攻击。考虑以 JSON 格式发送数据并使用 Javascript 模板库，如 Yahoo UI 库中的模板库，请参阅[http://developer.yahoo.com/yui/docs/YAHOO.lang.html#method_substitute](http://developer.yahoo.com/yui/docs/YAHOO.lang.html#method_substitute) 然后让前端人员维护模板.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T18:08:13.527

我不确定我是否100％理解这个问题......但是......

我们使用 GWT 并在客户端和服务器之间发送 XML。我已经使用 GWT 代码生成器实现了一个 XML 映射系统，因此在 XML 和 JavaScript 对象之间转换的代码是根据对象本身自动生成的（使用 java 类中的注释）。

直接发送 HTML 只会使您的应用程序功能降低，因为它不再能够以任何方式解释数据，而只是用它来更新屏幕。这也使现在需要生成 HTML 的服务器端变得复杂......我会认真避免这种策略。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T18:16:26.833

我在javascript方面有一种`/task/action/parameter`成语。我的后端严格返回我需要的 JSON 数据，客户端 (js) 负责显示它。假设我加载了这个页面`/#/item/product/5`，javascript 知道它必须调用“item”对象，方法“product”并传入参数 5。

这对于为链接添加书签非常有效，因此当有人决定`mysite.com/#/item/product/5`每次加载该页面时都添加书签时，它确切地知道要调用什么对象..方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T18:19:44.143

我认为在安全性方面没有太大区别 - 您可以解析不安全的 JSON 以及不安全的 HTML/JS。

它更多的是关于应用程序的正确分层 - 如果您直接将 HTML 注入页面，则必须在业务逻辑级别创建特定于视图的代码，在我看来，这对干净且易于交换的层不利。

只是我的2美分...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-09T22:40:31.153

> 我对此感兴趣的唯一原因是，每次 DOM 结构/CSS 发生变化时前端开发人员都会感到巨大的痛苦，所以你现在必须弄清楚你可能在 Javascript HTML 构建过程中的哪个位置更新。

你一定做错了。

从 AJAX 返回的数据应该只是*语义数据*，即只要布局改变就不会改变的东西。将数据转换为 DOM 操作最好留给母版页本身中定义的 Javascript 函数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-12T06:17:05.187

我将此作为评论，但我正在推动它。

JSON 本质上是安全的，问题在于人们如何使用它。

使用 eval 来评估它是问题所在，而不是格式，因为格式受到 JSON 规范的隐式限制。损坏的 JSON 会使 eval 不安全。所以……不要那样做。不要使用 eval，使用专用的 JSON 解析器。

相同的逻辑可以应用于 HTML。将 HTML 视为“数据”，将其视为简单的 XML，并对其进行处理，而不是盲目地将其添加到您的页面中。

恶作剧更难通过这种方式。

# security - 为什么 Web 应用坚持定义严格的密码规则？

> ID：429006
> 
> 赞同：1
> 
> 时间：2009-01-09T17:46:33.570
> 
> 标签：security, passwords, salt

你们都遇到过各种网站，这些网站强制您使用 6 个字符长的密码，必须有 1 个数字，并且必须与“烦人”押韵。

显然有一些遗留的原因，为什么有时这是必要的，但有时这都是为了安全。我发现这很烦人，因为我有一组标准密码，这些密码通常不符合这些特殊规则，所以我必须创建并记住一个新密码。

如果您担心用户密码的复杂程度，似乎在安全方面还有更重要的事情需要担心。如果有人真的可以掌握该密码，那么您显然需要担心更大的问题。在依靠用户担心您的安全之前，请尽自己的一份力量并锁定您的系统端。

**我的实际问题是：这些复杂的密码规则有哪些替代方法来降低彩虹表或暴力哈希反向器的风险，而不依赖用户承担记住复杂事物的重任？**

一些想法：盐渍，...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-09T17:53:17.520

无论您选择什么，几乎每个网站都会对您的密码进行加盐和加密。问题不在于遗留代码、服务器端的数据库安全或类似的东西，开发人员在大多数情况下都会涵盖这些内容。问题是愚蠢的用户提交的密码很容易被破解。规则的重点是强迫您不要选择太愚蠢的密码。

这是一个参考链接。[http://www.codinghorror.com/blog/archives/001206.html](http://www.codinghorror.com/blog/archives/001206.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T17:55:22.070

密码规则的原因是尝试并确保“更强”的密码，这实际上意味着平均需要更多的尝试才能通过暴力攻击找到密码。大多数人，即使在经历了许多例子之后，比如[最近的 Twitter 混乱](http://pajamasmedia.com/edgelings/2009/01/08/no-patch-for-human-stupidity/)，也会使用 Joe 密码，或者容易受到可行的暴力攻击的字典单词。

最好的办法是询问密码背后的数据的价值是多少，然后破解密码的成本（努力）是多少。如果值很小，你不需要复杂的规则，也许你根本不需要密码。如果价值很高，那么你需要让它变得更加困难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T17:49:41.147

使用 KeePass

[http://keepass.info/](http://keepass.info/)

它肯定会减少麻烦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-10T03:04:27.297

好的，这就是整个故事。

首先，让我们定义一个方案的“好”程度。使用密码等，衡量标准是暴力攻击获得访问权限的平均试验次数。

假设您的密码是从包含*n 个字符的字母**S*中提取的，密码的长度是*k*。那么可能的密码总数是*n* *^k*。

 **那么，平均而言，蛮力攻击将在大约*n ^k /2*或*n ^(k-1 次)*试验中找到成功的密码。

为方便起见，并且出于某些信息论的考虑，我不打算讨论，我们通常将其表示为*位数*，即*lg n ^k*其中*lg*表示以 2 为底的对数。因为我们习惯于思考比特作为离散的东西，我们实际上通常取那个数字的上限，即大于*lg n ^k*的最小整数，但实际上小数值是完全合法的。

对于可打印字符、8 个字符的密码以及没有其他规则，该数字在 100 ⁸或大约 10 ^(16)附近；大约是 53 位。唯一的问题是那些随机密码几乎是不可能记住的；它们往往会出现在黄色便签上，并且容易受到这种攻击。不过，这是一个有限的情况。通过蛮力猜测需要大约 100 万亿次尝试。如果每次尝试花费一分钱，那么理论上，您的数据可能价值高达 1 万亿美元，然后才值得窃贼花费时间。

另一方面，常用的字典词只有大约 50,000 个。这大约是 16 位，或者通过蛮力尝试大约需要 25,000 次。假设每次尝试花费一美分：那么您的数据最好不要超过 250.00 美元。

这两个都是规则的应用

*R = P×H*

其中*R*是风险，*P*是坏想法发生的概率，*H*（*风险*）是坏事发生的成本。

现在，一分钱的尝试太高了，但您现在拥有所需的工具。弄清楚数据的价值，您可以使用此方法来决定您需要多广泛的规则集。（但要小心，如果您将规则设置*得太*严格，那么可接受密码集的熵会变小，直到您陷入老笑话，经过深思熟虑后，安全性确定最佳密码是 '*8h% Jd!'，因此所有用户现在都将开始使用该密码。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T17:44:58.907

任何未经培训的用户（大多数 Web 应用程序的正常类型）会发现自然且容易记住的任何内容都很容易破解。不管你做什么来存储它，因为破解软件可以通过未经培训的用户可能使用的所有密码。仅当用户具有良好的密码时，加盐和散列才有效。

解决方案是要求用户记住更复杂的内容（您正在拒绝），或者根据用户拥有的内容进行验证，而不是用户可以记住的内容。这可以是一个写下来的密码，其中一个安全密钥会产生不可预测的数字，每隔几秒钟就会改变一次，或者更深奥的东西。

网站可以做的是允许各种强密码。我讨厌我想使用具有“无特殊字符”等规则的强密码（通常是金融或医疗）的网站。（当然，我不喜欢重复使用强密码；我不希望任何破解我的 HMO 安全性的人从我的 Barnes & Noble 帐户中自由订购。）

这可能不是您想要的答案，但坏人的能力足以压倒大多数人都喜欢的那种随意的安全性。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-09T18:15:15.463

Keepass 的另一个优点是它可以在 Windows 的大多数情况下直接从 USB 闪存驱动器运行（例如，甚至不必安装它）。将 keepass 和您的数据库文件都放在 USB 密钥上，您就有了一个快速简便的便携式密码参考数据库。确保你用一个很好的强密码保护keepass，就像你松开你的USB驱动器一样，你不希望所有的东西都进入你的密码数据库。

# java - auto-detecting components using spring annotations

> ID：429010
> 
> 赞同：2
> 
> 时间：2009-01-09T17:48:37.483
> 
> 标签：java, spring, annotations

I've managed to configure to spring to auto-detect my components using the @Autowire annotation. However the problem is that not all the components are being Auto wired.
Specifically My DAO's are being bound but my service objects aren't. I have to explicitly create a bean for my service object in the spring xml config file.

Any clue as to why this is happening?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T17:55:46.267

If spring is not complaining about anything but it's still not being wired, there are a few probable causes, from most to least likely:

*   The service implementation is missing the proper annotation; i.e @Component, @Controller, @Service or one of the other annotations.
*   If the implementation is not annotated it has to be present as an xml bean definition.
*   The classpath-scan you have set up in the xml file does not hit the service.
*   Your jar file with services is packed without directory structure.

# php - PHP/MySQL 新手

> ID：429012
> 
> 赞同：5
> 
> 时间：2009-01-09T17:49:23.750
> 
> 标签：php

我是一名 CS 毕业生，对“web 2.0”类型的东西了解甚少，我们主要关注 Java 和 C。我想进入 PHP，你们会推荐什么作为入门的最佳书籍/网站? 那里有很多，我不想花 50 美元买一个以 hello world 程序结尾的东西。谢谢 ：-）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-09T18:08:19.190

我会避免使用 PHP 书籍。从你在大学的数据库课程中，你会相当熟悉 MySQL——我从他们的[参考手册](http://dev.mysql.com/doc/refman/5.1/en/)中得到了我需要的大部分内容。

PHP 很奇怪，因为正如您所说，那里有一百万零一个教程，但是一旦您超越了最基本的知识，您可能会再次发现您最终会回到[他们的平台文档](http://www.php.net/docs.php)而不是其他任何东西。您可能会发现该教程是一个很好的起点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-09T18:28:51.380

**开始一个项目！**

为自己编写个人博客。自己写一切（我的意思是一切！）。这将帮助您快速熟悉该语言。

完成构建您的基本博客了吗？升级吧！为评论、RSS 提要和发布电子邮件订阅制作垃圾邮件过滤器，确保其安全。完成博客后，转到一个更大、更复杂的项目，然后循环继续。

如果遇到任何问题，请使用[PHP 文档和此站点。](http://www.php.net/docs.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-09T19:16:55.587

PeachPit 的 Visual QuickStart Guides 是我发现的一些最好的语言介绍。不可否认，QuickStart 系列只教到中级水平。不过，这些示例很简单，但也很完整，应该可以让您开始使用 PHP。

*   [用于万维网的 PHP，第 2 版](https://rads.stackoverflow.com/amzn/click/com/0321245652)(PHP 4/5)
*   [用于万维网的 PHP，第 3 版](https://rads.stackoverflow.com/amzn/click/com/0321442490)(PHP 6)

如果您想要更完整的参考资料，您可以阅读[Rasmus Lerdorf](http://en.wikipedia.org/wiki/Rasmus_Lerdorf)帮助编写的书。

*   [PHP 编程，第 2 版](https://rads.stackoverflow.com/amzn/click/com/0596006810)(PHP 5)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T18:37:03.250

首先是 PHP 和 mysql 刚到你最近的巴恩斯和贵族（或边境），我还没有读过它（它会在星期天送到我这里）但我相信它是最好的开始方式！

更新-阅读它，它值得花钱和花时间，去吧！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T18:41:58.777

我发现的问题是，当我有机会购买它们时，所有的书都已经过时了。是否有任何书籍谈论 PDO 对象或任何新的重要内容？

但是对于较旧的东西和基础知识，我喜欢[Sams Teach Yourself PHP in 10 minutes](https://rads.stackoverflow.com/amzn/click/com/0672327627)，因为它可以让你直接进入并弄脏你的手。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T18:45:09.677

使用网络语言的最佳选择是尝试制作一个简单的应用程序。无论是博客、论坛还是网站的小型 CMS——都无所谓。PHP 的伟大之处在于它有一个庞大的在线社区（在 Stack Overflow 和其他地方）

需要立即注意的重要一点是，如果为了便于参数化查询，最好使用数据库类而不是 mysql_ 函数。例如 PDO 和 mysqli

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-09T18:54:19.940

PHP 真正的优点之一是其中编写了如此多的开源代码。

我发现学习一门语言的最好方法是查看其他人的项目，看看他们是如何构建应用程序的。

[http://php.opensourcecms.com/](http://php.opensourcecms.com/)有数百个不同的开源 PHP 项目的链接，这些项目将向您展示如何从博客、CMS、CRM、Wiki、照片库、论坛和电子商务中构建任何东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-09T20:19:09.753

当我开始学习 PHP 时，我最喜欢的书是一本 7 合一的“傻瓜”书：

[http://www.dummies.com/store/product/Apache-MySQL-and-PHP-Web-Development-All-in-One-Desk-Reference-For-Dummies.productCd-0764549693,navId-322467.html](http://www.dummies.com/store/product/Apache-MySQL-and-PHP-Web-Development-All-in-One-Desk-Reference-For-Dummies.productCd-0764549693,navId-322467.html)

正如其他人所说，一旦你开始，你会花更多的时间在官方 PHP 文档（[http://www.php.net/docs.php](http://www.php.net/docs.php)）上，但是像上面这样的一本书可以帮助你从 Apache 到 PHP 再到数据库的整个堆栈的鸟瞰图，这可能是您在编程课程中没有接触过的内容，但会非常有帮助。

当我拿到这本书时，它已经过时了，不得不改掉一些旧的/坏习惯，所以你会通过确保你得到的任何东西都是最新的来为自己服务。

此外，正如其他人所说，在现有开源项目的基础上构建可以教会您很多关于项目结构和常见编程技术的知识。那里有很多“糟糕”的 PHP 代码，但也有很多好的代码可供您学习。

安装 WordPress 并尝试编写插件或设置照片库并为其添加一些功能。PHP 是一种很好的边做边学的语言。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-09T21:21:36.617

避免绿色的——它们还没有成熟。

但是，说真的，如果你学过 C 和 Java，PHP 只是使用不同的语法并做一些更短/更快的事情（尽管有代价）。没有声明（除非为了您自己的安心和类变量），因为变量没有类型。甚至语法也相当接近 C。

我想说与 C 的主要区别在于 PHP 主要用于 Web 编程，而不是选择有关 PHP 的书，您可以选择一本有关构建 Web 服务/网站的书，并仅从参考和示例中学习 PHP。

许多 PHP 书籍的问题还在于它们经常向您展示做一件事的最简单方法。不幸的是，它并不总是最聪明的，尤其是在 web 编程中——不是最安全的，就像一本关于 C 的书向您展示指针算法，但没有警告缓冲区溢出。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-09T23:39:10.177

PHP 是一种非常简单的语言。没有像闭包或属性这样的花哨的东西。如果你了解 Java，那么学习 php 只是了解它的脚本部分（即它不需要编译）和变量名之类的东西以 '$' 开头等。哦，了解它们的数组结构相当灵活。

其他一切都归结为在 www.php.net 参考中搜索功能。

事实上，没有“高级 php”之类的东西，除非你想编写自己的需要 C 的 php 扩展。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-01-09T19:25:25.553

我唯一的建议是避免使用原始 MySQL。当您发现自己需要大量使用 SQL 时，是时候使用 CodeIgniter 之类的框架了。

# sql-server-2005 - SQL Server Mgt Studio 不显示表格？

> ID：429014
> 
> 赞同：0
> 
> 时间：2009-01-09T17:49:35.217
> 
> 标签：sql-server-2005, sql-server-2000, ssms, database-security

我在 SQL Server 2000 标准版中有一个名为“dbo.T668”的表（不要因为命名约定而责备我）。

我正在使用 SQL Server Management Studio 2005 在服务器上工作，出于某种奇怪的原因，我在表列表中根本看不到该表。我看到所有其他表，但不是这个。

如果我打开查询编辑器并键入“select * from dbo.T668”，它会返回所有记录，所以我有权访问表格并从中选择 - 是否有允许您访问表格的设置但在 SQL 管理器中看不到？或者这是 SQL 2000 和 SQL 2005 之间的不兼容？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T17:51:20.050

你确定这是一张桌子而不是一个视图？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T17:55:59.853

如果您最近刚刚创建它，请确保您点击顶部的刷新按钮，无论如何对我来说似乎并不总是同步。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T17:52:54.650

哦！

对它做了一个 sp_help，你是，对，它是一个视图......这个数据库中有 2000 个表，所以我想我只是错过了它。

啊。

# asp.net-mvc - 使用 ASP.NET MVC Ajax 调用的全局“加载”通知

> ID：429022
> 
> 赞同：4
> 
> 时间：2009-01-09T17:51:16.523
> 
> 标签：asp.net-mvc, ajax

我有兴趣提供一般的“我正在拨打 ajax 电话”通知......类似于大多数谷歌的服务在忙于拨打电话时会有一点红色加载通知。有没有一种方法可以全局利用某些事件，如果有活动呼叫，我可以使用它来显示/隐藏该通知？

我们没有使用 jQuery ajax api，我们使用的是 MVC Ajax 的东西……比如 Ajax.BeginForm 或 Ajax.ActionLink。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-25T19:11:03.710

我不确定为什么前面的答案被接受，但您可以在 AjaxOptions 中使用**LoadingElementId****参数**，方法是指定页面中*显示*CSS 属性设置为*none*的元素的 ID 。

 ****```
new AjaxOptions { UpdateTargetId = "somebox", LoadingElementId = "status-waiting" } 
```

MVC 将为您完成其余的工作：当请求启动时，DIV 将被显示，一旦完成 - 再次隐藏。您所要做的就是设置框的样式（定位它，提供“加载”图像等）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-09T18:08:09.063

如果您使用 JQuery[进行 AJAX](http://docs.jquery.com/Ajax/jQuery.ajax)调用，您可以使用以下内容：

```
jQuery.ajax({
    url: 'url_to_send_ajax_request_to',
    beforeSend: function(XMLHttpRequest) {
        jQuery('#id_of_some_div_that_contains_loading_text').show();
    },    
    complete: function(XMLHttpRequest, textStatus) {
        jQuery('#id_of_some_div_that_contains_loading_text').hide();
    }
}); 
```

beforeSend*处理*程序可用于显示包含加载文本或图像的隐藏 div，而*完整*处理程序将用于隐藏它（无论调用是否成功）。

或者，如果您想为所有 AJAX 请求全局设置它，您可以使用[ajaxSetup](http://docs.jquery.com/Ajax/jQuery.ajaxSetup)函数：

```
jQuery.ajaxSetup({
    beforeSend: function(XMLHttpRequest) {
        jQuery('#id_of_some_div_that_contains_loading_text').show();
    },    
    complete: function(XMLHttpRequest, textStatus) {
        jQuery('#id_of_some_div_that_contains_loading_text').hide();
    }
}); 
```

# validation - 使用 Enterprise Library 4.1 的动态 DateTimeRangeValidator？

> ID：429034
> 
> 赞同：1
> 
> 时间：2009-01-09T17:53:51.043
> 
> 标签：validation, enterprise-library

我正在尝试添加 - 365 天和 + 365 天的范围，但似乎在 EL 4.1 中使用此属性仅接受特殊的 ISO 格式字符串......因此我不能简单地将普通字符串添加到此验证例程.

```
<DateTimeRangeValidator(DateTime.Now.AddDays(2), DateTime.Now.AddDays(4))> _ 
```

我想做与上述类似的事情 - 仅供参考

有谁知道如何强制此属性接受此 ISO 格式的字符串而无需手动编码此值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T19:26:19.937

我认为您想要的是“RelativeDateTimeValidator”，请参见[此处的 CodeProject 文章](http://www.codeproject.com/KB/cs/VAB.aspx)。

更新：CP 链接似乎死了，[这里是 MSDN 链接](http://msdn.microsoft.com/en-us/library/ff649529.aspx)。

# crystal-reports - .rpt 设计过程中如何让 Crystal Reports 页面宽度变大

> ID：429035
> 
> 赞同：12
> 
> 时间：2009-01-09T17:54:24.693
> 
> 标签：crystal-reports

我正在寻找一种方法来调整页面宽度 Crystal Reports 让我可以在我的 .rpt 文件中放置字段。

到目前为止，我发现如果我右键单击报告，选择“设计”/“打印机设置”，我可以选择我想要打印报告的纸张尺寸。如果我选择“方向/横向”，我可以增加页面的宽度，并且可以在报告中放置更多字段。

我的目标：将我的所有字段放在我的报告中（大约 25 个）并将数据导出到 Excel。现在我没有足够的宽度将所有字段放在 .rpt 文件中。

有没有办法将页面的宽度增加到任意数字？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-09T17:59:11.703

找到它：[http ://www.crystalreportsbook.com/forum/forum_posts.asp?TID=754](http://www.crystalreportsbook.com/forum/forum_posts.asp?TID=754)

基本上在您的系统中添加一个虚拟打印机，它可以采用更大的纸张尺寸并选择它作为您的报告打印机。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-04-23T12:30:25.860

1.  通过更改您的报告纸张大小。使其符合法律/信件等将增加报告的宽度，以便您可以轻松地在报告中显示列数（超过 10 个）。

    为此，请右键单击 --> 设计 --> 打印机设置 --> 纸张 --> 尺寸。

2.  另一种方法是改变你的报告方向。默认为纵向。您可以通过以下方式将其更改为横向

    右键单击 --> 设计 --> 打印机设置 --> 方向 --> 横向（单选按钮。）

3.  文件--> 打印机设置--> 属性方向选择纵向

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-09T08:11:08.537

1.  转到打印机和传真机
2.  选择打印机
3.  转到文件/服务器属性
4.  转到单击新表单
5.  转到新表单 --> 写一个 PaperSize 的名称
6.  转到新表单 --> 写一个 PaperSize 的名称
7.  转到测量单位 --> 设置纸张尺寸宽度和高度，边距
8.  点击`OK`
9.  转到水晶报表 - > 页面设置
10.  页面选项 - > 选择您新创建的纸张尺寸

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-14T01:22:20.683

使用 microsoft xps 文档编写器作为您的虚拟打印机，并根据我上面的帖子所述从服务器属性创建一个新表单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-01T21:50:04.300

[我想我应该从接受的答案](https://stackoverflow.com/a/429057/107537)中添加实际步骤，而不是去寻找链接来做它（它指向另一个链接）。在水晶报告中对我有用的是：

1.  文件 > 打印机设置
2.  选择打印机“Microsoft Office Document Image writer”
3.  纸张 > 自定义尺寸
4.  `Properties`（打印机名称旁边）
5.  输入自定义尺寸，然后`OK`，`OK`您就完成了！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T17:59:49.067

我将打印机设置为荒谬的宽度并使用它。本的链接是正确的想法。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-07-22T20:45:09.490

我意识到这是一个非常古老的话题，问题是关于设计模式的，但由于这个问题在我的谷歌搜索中不断出现，我希望这可能会对某人有所帮助。所以，我只是想以编程方式添加它，这可以在没有像这样的虚拟打印机的情况下完成：

```
var repDoc = new ReportDocument();
repDoc.Load(rpt_path);

ISCDReportClientDocument clientDoc = repDoc.ReportClientDocument;
clientDoc.PrintOutputController.ModifyUserPaperSize(repDoc.PrintOptions.PageContentHeight, repDoc.PrintOptions.PageContentWidth * 2); 
```

# php - PHP 和宏（lisp 风格）？

> ID：429039
> 
> 赞同：0
> 
> 时间：2009-01-09T17:54:55.533
> 
> 标签：php, macros, eval

嗨，我正在学习 LISP，好吧，我整天编程 php 为生，所以我在 php.net 上乱搞，发现了 eval 函数……所以我开始玩了！

我很想知道更多关于如何使用 eval 来做疯狂的事情，我知道你可以用这个和所有东西来制作函数......但我想问为什么下一个代码不起作用：

```
$var = "echo \"FOZZ\";";
for($i = 0; $i < 100; $i++)
    $var  = "eval(\"".$var."\");";
print $var;   
eval($var); 
```

eval 还有什么其他有趣的东西！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T18:03:59.447

你的陈述是 'eval("eval("echo"FOZZ";");")'。您的双引号相互干扰并导致错误。

您可能想尝试将第一行更改为 $var = "echo \'FOZZ\';";

注意：请小心使用 eval。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-01T05:22:38.520

对于 web 编程的常见情况，我开发了一个名为 xilla_tags 的库，它可以轻松编写 lisp 风格的 PHP 代码，这比传统方法更具可读性。

对于 xilla_tags，请参见[xilla 标签示例](http://quantblog.wordpress.com/2009/10/01/xilla_tags-php-library-make-html-with-lispy-php-code/)。

关于 PHP 中的 lisp 样式，Jacob Hannsen 在他的 bitchware 网站上有一篇很棒的文章，用于更一般的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T18:04:33.643

它不起作用，因为您需要在带引号的字符串中转义引号。由于`$var`包含引号，因此您需要在每次迭代将引号填充到另一层 eval 中时对其进行转义。

但无论如何，我不容忍这样`eval()`过度使用。使用它一次应该很少，并且只在最必要的情况下使用。 `eval()`在任何编程语言中都是等待发生的[意外。](http://en.wikipedia.org/wiki/Code_injection)

# java - 从 Seam 电子邮件生成绝对 URL

> ID：429050
> 
> 赞同：1
> 
> 时间：2009-01-09T17:57:17.293
> 
> 标签：java, email, url, jsf, seam

有没有办法诱使`h:outputLink`or`s:link`标记生成绝对 URL？在 Seam 电子邮件中，我希望能够执行类似的操作

```
<s:link view="/someView.xhtml">
    <f:param name="a" value="#{a.nastyParam}" />
    <f:param name="b" value="#{b.nastyParam}" />
    <h:outputText value="Come do something awesome!" />
</s:link> 
```

并生成一个绝对 URL，而无需大惊小怪地弄乱 URL 编码、预先添加协议、主机、上下文路径等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T18:19:23.490

没关系......在问这个之前，我应该更仔细地查看我的“Seam in Action”副本。在标签上设置`urlBase`属性就可以了。`m:message`

# sql - SQL Server 2005 中的存储过程是否应授予 CONTROL 权限？

> ID：429051
> 
> 赞同：7
> 
> 时间：2009-01-09T17:57:40.193
> 
> 标签：sql, sql-server, sql-server-2005, permissions, controls

我遇到了一个问题，即在 SQL Server 2005 中授予对特定存储过程的 EXECUTE 权限不起作用。一些测试人员弄乱了权限 - 并发现如果他们还授予存储过程的 CONTROL 权限 - 那么它运行良好。他们现在确信授予 CONTROL 权限是可行的方法。

我知道这不可能是真的——事实上我认为真正的问题是用户没有选择/插入/更新/删除存储过程所针对的表的权限。问题是，我似乎无法在网上找到任何可以证明这一点的东西。

我对么？有人知道任何有关此的文档吗？

提前致谢。

回复评论的更多信息：存储过程正在执行多次删除。它首先删除将被删除的“主”记录孤立的所有记录，然后最后删除父记录。

此外，我们看到的错误表明用户没有足够的权限 - 或者存储过程不存在。我们已经确认我们使用了正确的用户，并且已向该用户授予 EXECUTE 权限。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T19:06:04.830

如果存储过程是使用 EXECUTE AS CALLER 创建的（我相信这是默认设置），那么调用者必须拥有执行存储过程所需的所有权限，除了对过程执行 EXECUTE 之外。

来自 EXECUTE AS 的 SQL Server 文档：

> CALLER 指定模块内的语句在模块调用者的上下文中执行。执行模块的用户不仅必须对模块本身具有适当的权限，而且还必须对模块引用的任何数据库对象具有适当的权限。

请注意，由于 SQL Server 使用所有权链处理权限检查的方式，严格来说这并不总是正确的，我猜测在过程上授予 CONTROL（将所有权状态授予被授予者）会导致这些权限检查绕过。

如果您使用 EXECUTE AS OWNER 创建过程，那么您不需要授予该过程的 EXECUTE 之外的任何权限。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T18:49:17.577

执行应该是所有需要的。

存储过程是否访问其所在数据库之外的表？

如果是这样，请尝试对存储过程在同一数据库之外使用的表设置适当的用户权限。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-09T18:49:28.217

如果您只需要能够执行存储过程，那么显然 CONTROL 权限*不是*要走的路。是的，它可以工作，就像在本地系统帐户下运行您的网站一样。

如果 EXECUTE 权限的授予者也是受影响的表的所有者，那么执行 sp 应该没有问题。否则，您应该授予显式权限或考虑使用 ALTER AUTHORIZATION 语句调整所有权。

为了奖励可管理性，创建一个数据库角色以应用显式权限，而不是直接将它们分配给用户。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-25T20:26:24.313

这可能已经解决了，但在我的情况下，我需要授予控制权限（在测试服务器上，而不是实时服务器上）的原因是因为存储过程的原始开发人员在设计时错过了 GO 语句，因此 GRANT EXECUTE 行在存储过程中。我们在现场修复了它，但看起来修复从未在测试中实施。

# language-agnostic - 如果短网址是很好的做法，为什么像亚马逊或 Facebook 这样的大网站不实施它们呢？

> ID：429065
> 
> 赞同：3
> 
> 时间：2009-01-09T18:02:32.150
> 
> 标签：language-agnostic

短而近的 url（例如在这个网站上）是 Web 开发中为了获得良好的 SEO（可能还有其他原因）而备受关注的良好实践。

如果是这样，那么像 Amazon 和 Facebook 这样的大网站为什么在他们的页面中仍然有长得离谱的 URL（比如关于部分等）？

将此功能实施到一个非常大的实时站点是否存在工程问题？（我认为最好先计划和考虑这些事情）。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T18:04:15.920

因为这不是他们的优先事项。普通用户不关心 URL。

该站点是作为一个 MVC 应用程序构建的，其核心是简单的 URL。

我的应用程序并不总是有优雅的 URL，因为我的客户从未说过，“我希望 URL 更短”。

我同意你的观点，一个干净的 URL 有一些价值，但除非你把它作为一个目标，否则以后很难工作，更难证明它的合理性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-24T21:24:17.563

I would also guess that "good for SEO" reasoning has alot less weight with the big sites because ... they're big - they get the lions share of the traffic anyway. Amazon.com has all the SEO rank because there are so many other places that point to them.

Similar reasons apply to other large sites. MLB.com doesnt give a damn about SEO friendly URLs - if you're following the Yankees, you already know about the site, and most roads lead there anyway. Being the "official" or "biggest" site for something means a large amount of the SEO rank flows to you regardless of your URL choice because links on other sites will likely go to you anyway.

And as pointed out, they bigger sites are often older ones that carry alot of historical baggage, and migration to new urls can be a large amount of effort that is harder to justify.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-09T18:07:10.953

而且因为它们是在时间之初建造的，尤其是亚马逊；这些规则（如短 URI）通常是由于先驱者的可怕例子而产生的。（请记住，背后中箭的是先驱者。）

但是，在采用了他们所拥有的约定之后，对于亚马逊来说，为了获得更好的 URI 的微小优势而更改几乎每一行代码肯定是不值得的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T18:37:30.160

像 Facebook 这样的许多页面并不意味着通过搜索引擎进行搜索或链接到朋友。它们是用来浏览的。正如您所描述的那样，这确实没有什么动力去创建干净的 URI。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-09T18:06:39.363

前段时间我对此有点抱怨。也许这有点过火了，但我想我明白了:)

[干净的 URL 是后端还是前端](https://stackoverflow.com/questions/203278/are-clean-urls-a-backend-or-a-frontend-thing#203363)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T18:30:27.913

我认为这里有一个更简单的答案。像 Facebook 和 Amazon 这样的大型网站很大，因此需要更复杂的 URI 模式。毕竟，你认为亚马逊和 Facebook 有多少关于页面？

我想可能有一种方法可以将它们从现在的状态中简化，但我认为干净的 URI 本身是一个额外的好处，而不是一个目标。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-09T18:42:51.023

对于亚马逊，大部分 URL 并不重要。它携带有关用户和推荐人的信息——搜索引擎蜘蛛可能没有的东西。

此外，亚马逊和 Facebook 并不真的希望他们网站上的*每一*本书都被编入索引。如果您在 Google 中输入一本书的标题，亚马逊希望顶部链接成为该书的主要描述页面——而不是某些用户的 Listmania 页面谈论它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-09T18:27:07.013

我想说这与后退按钮有很大关系。您是典型的用户，希望后退按钮将他们带回他们最后看到的内容。长而复杂的 URL 有助于以可靠的方式实现这一点。用户输入比 mydomain.com 更长的 URL 的频率是多少？我会说很少。开发人员可能会更频繁地这样做。

# oop - 帮助非 oop 开发人员了解基于接口的编程的最佳比喻是什么？

> ID：429068
> 
> 赞同：4
> 
> 时间：2009-01-09T18:03:36.093
> 
> 标签：oop, interface

我很难让我的团队熟悉基于界面的编程……有人有什么建议吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-09T19:58:58.700

为了帮助您的团队熟悉这个想法，最好的方法是演示基于接口的开发可以完成什么，并将其与没有它需要如何完成相同的事情进行对比。为了让他们“真正”接受并开始理解它，他们首先需要理解并感受到它所解决的问题的痛苦。他们真的需要与他们自己或团队进行“每次发生 Y 时我都不得不做 X”的对话。在我的“成长”岁月里，我父亲向我灌输的一件事就是这个小宝石：

> 不管它被告诉过多少次，在你提出这个问题之前，你永远不会得到答案。

一旦发生这种对话（由个人或团队自行发起），这就是真正的学习发生的地方。诀窍是营造一个能够激发这类问题的环境。如果您可以向他们表明他们想要接口解决的问题的答案，那么他们会自己提出问题。

展示接口有用性的一个很好的例子如下：

你被指派在国际数学大会上担任保镖。你被告知只让那些可以为“什么是二加二”这个问题提供正确答案的人进入。由于这是一项国际赛事，自然有很多人试图参加，他们会说许多不同的语言。首先，您的策略是弄清楚（或猜测）请求进入的人说什么语言，然后找到一个说同样语言的口译员并通过他提出问题。事实证明这是可行的，很快你就会学会快速识别一些语言，现在知道哪些口译员会说这种语言，但是当有人说你能说的语言时，这肯定是一种痛苦。t 识别直接出现，您必须花费所有时间来弄清楚它是什么，然后找到合适的口译员。所以，知道必须有更好的方法，你试着想出一种改进的方法来完成你的工作，那就是你的时候。你得到一令纸和一些记号笔，每次有人来参加会议时，你在一张纸上写下以下内容：

```
2 + 2 = 
```

瞧，它起作用了！每个人都很快给出了答案。您不必弄清楚对方说什么语言或找翻译。哎呀，你甚至不在乎他们说什么语言，他们只是回答问题，因为他们都懂数学！您没有单独找出每个案例，而是使用了参加数学大会的每个人都理解的“IKnowMath”界面。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-09T18:10:25.473

[一个接口是一个合同](http://geekswithblogs.net/elinden/archive/2008/06/03/using-interfaces---design-by-contract-again.aspx)。它只是指定 Class 的特定类别（在这里很难绕过单词*class*）作为公共 API 应该提供什么。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-09T18:17:56.987

界面就像一个班级的着装要求。如果一个类实现了一个接口，它的公共成员（它对其他类的外观，如果你愿意的话）将至少包括接口声明的内容。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-09T18:17:52.633

我建议你向他们展示它可以带来的好处。想象一下这个 C# 场景：

```
class User
{
    public String GetFirstName() { return "foo"; }
}

class App
{
    void Run()
    {
        User user = new User();
        String firstName = user.GetFirstName();
    }
} 
```

在这里，我们有一个`User`类，它将从某个地方获取名字并返回它。现在您的应用程序已与此类耦合，并且以后很难更改您从哪里获得名字，因为您在`User`任何地方都使用过该类。如果您实现了一项服务并希望开始调用该服务以获得`FirstName`价值，会发生什么？您将需要进行一些重构。

考虑这种方法：

```
interface IUser
{
    String GetFirstName();
}

class User : IUser
{
    public String GetFirstName() { return "foo"; }
}

static class UserFactory
{
    public static IUser GetUser() { return new User(); }
}

class App
{
    void Run()
    {
        IUser user = UserFactory.GetUser();
        String firstName = user.GetFirstName();
    }
} 
```

现在您可以在任何您想要的类中实现接口，例如：

```
class UserService : IUser
{
    public String GetFirstName() { return "bar"; }
} 
```

只需更改工厂方法，例如：

```
static class UserFactory
{
    public static IUser GetUser() { return new UserService(); }
} 
```

并且您的应用程序代码将不再明智。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-09T18:16:15.290

**他们**熟悉什么？

当我学习 C++ 时，老师在我现有的 C 知识基础上建立，例如：

*   以文件 I/O 的 C 库例程为例：使用文件句柄打开、读取和关闭
*   展示如何将这些重写为 File 类的方法：创建、调用 read 方法、调用 File 实例的析构函数

在此基础上，我可能会将 IFile 接口与 File 类进行比较，说 IFile 根本不公开任何实现细节：如果应用程序使用 IFile 而不是 File，那么您可以更改底层文件系统/实现细节）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-09T18:26:31.913

在我们公司教新的初级员工时，我成功使用的另一种方法是将界面视为“查看对象的一种方式”，从字面上看。

模拟：取一个 3D 对象，比如一根管子。根据您看它的方向，它看起来（“表现为”）圆形、矩形或 3D 对象。然后，铸造的概念可以很容易地等同于“尝试旋转对象，以便您可以使其看起来像您想要/需要的方式”，这取决于您正在寻找的对象和视图，它成功或失败。

模拟并不是真正的 100%，但它可以帮助人们制作一些非常抽象的东西，让人们还没有将这个概念理解为具体的东西。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-09-06T06:37:56.507

Head First 设计模式的副本或至少 Head First 设计模式中的代码示例

讲故事的方式就像它在 Head First Design Patterns 中所做的那样实际上对怀疑论者很有效

关于爱德华兹

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-06T06:13:06.807

告诉他们接口是一个花招。因为意思是公开隐藏的：P

接口描述...一个接口。它们告诉您如何与实现它的类进行交互。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-10-14T15:19:13.940

我喜欢乐高积木的类比，它们是类和实例，分别是顶部/底部的钉子/孔，以及尺寸和形状，它们是接口。例如，我可能需要一个 2x4 网格中带有钉子的矩形块。这些是我感兴趣的界面——固定的男性/女性界面，以及矩形界面。这些可以通过矩形积木乐高的一个实例来满足，或者由两个半大小的乐高“组成”的东西的另一个实例来满足，每个乐高有 2x2 钉子，因此仍然遵守所述界面。因为所有乐高积木都有一个共同的界面（男性和女性钉子），我们可以根据需要混合和组合，无论乐高积木来自我可以构建巨型机器人蚂蚁的新套装之一，还是只是一个普通的旧方形或矩形. 乐高积木，装在你以前拿回来的大桶里。天啊，我什至可以把官方乐高和品牌X乐高混在一起，因为“男/女挂钩界面”很好理解。

对接口进行编程允许我们混合和匹配可重用的代码组件，就像我们做乐高积木一样。

# vb.net - 选取框 ProgressBar 对 BackgroundWorker 无响应

> ID：429076
> 
> 赞同：4
> 
> 时间：2009-01-09T18:05:51.283
> 
> 标签：vb.net, progress-bar, backgroundworker, marquee

在我的代码中，当单击按钮时，进度条设置为选取框，然后调用我的 BackgroundWorker，但是当调用 BackgroundWorker 时，进度条冻结或消失。我使用 BackgroundWorker 将 ReportViewer 的 RefreshReport 方法与 UI 线程分开。任何帮助表示赞赏。谢谢！

```
 Private Sub btnOtherReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnOtherReport.Click
        rvReport.ProcessingMode = ProcessingMode.Remote
        rvReport.ShowParameterPrompts = False
        rvReport.ServerReport.ReportServerUrl = New Uri("REPORT_SERVER_URL")
        rvReport.ServerReport.ReportPath = "REPORT_PATH"
        rvReport.BackColor = Color.White

        BackgroundWorker1.RunWorkerAsync()
    End Sub

    Private Sub BackgroundWorker1_DoWork(ByVal sender As Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker1.DoWork
        RefreshReport()
    End Sub

    Private Sub BackgroundWorker1_RunWorkerCompleted(ByVal sender As Object, ByVal e As System.ComponentModel.RunWorkerCompletedEventArgs) Handles BackgroundWorker1.RunWorkerCompleted
        pbReports.Style = ProgressBarStyle.Blocks
        pbReports.Value = 100
    End Sub

    Public Sub RefreshReport()
        rvReport.BeginInvoke(New MethodInvoker(AddressOf rvReport.RefreshReport))
    End Sub 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T19:37:30.210

问题是当你调用`.BeginInvoke()`你的`RefreshReport()`方法时。该`BackgroundWorker.DoWork()`方法已经在另一个线程中引发，因此您只需调用`rvReport.RefreshReport()`. 它应该如下所示：

```
Private Sub BackgroundWorker1_DoWork(ByVal sender As Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker1.DoWork
    rvReport.RefreshReport()
End Sub 
```

真的就这么简单，可能还可以使用 a`Monitor`来锁定您的报表对象并防止重新输入。

现在，当您调用`.BeginInvoke()`报告过程时，它会启动，但它根本不会阻塞，因此该`DoWork()`方法没有什么可做的。它只是立即返回。此时 BackgroundWorker 认为它已经完成，因此调用该`.RunWorkerCompleted()`方法，这会停止您的进度条。

* * *

基于注释，`rvReport`是一个可视化控件而不是一个组件或简单的数据访问类。在这种情况下，您应该知道 .Net 中的可视控件不是线程安全的，因此*永远*不应该直接执行任何需要花费几分钟才能完成的操作。`.BeginInvoke()`您在该方法中跳过的循环具有在*主 UI 线程*`RefreshReport()`中调用您长时间运行的函数的效果。

 *要解决此问题，您需要关闭跨线程检查以便不抛出异常（简单，但不推荐）或更改您使用控件的方式，以便主要工作发生在其他地方并且控件只是在以下情况下引发事件东西准备好了。如果您无法将控件修改到该程度，则这是控件中的设计缺陷。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-09T19:09:22.093

问题是当背景有处理器时，进度条没有机会重新绘制。因此，您需要在处理时从主等待线程调用 System.Windows.Forms.Application.DoEvents()。这将获得控制并导致进度条重新绘制。

因此，在 BackgroundWorker1.RunWorkerAsync 调用之后，您可以添加一个循环来调用 DoEvents 直到引发事件，然后在 RunWorkerCompleted 中引发事件以让调用代码退出。由于这不允许主代码继续运行，您可以将调用置于后台调用或另一个线程中。

# testing - 测试 Outlook VSTO 插件

> ID：429087
> 
> 赞同：4
> 
> 时间：2009-01-09T18:08:14.477
> 
> 标签：testing, outlook, vsto, add-in

我正在尝试编写一个非常简单的 Outlook VSTO 插件来检查正在发送的一些简单属性的电子邮件。我的问题是我似乎无法使用 Outlook 安装/测试插件。我添加了单元测试，以确保我编写的代码可能完成了它应该做的事情，但最终的集成水平却让我望而却步。有关如何在 Outlook 中测试我的代码的任何建议？提前致谢。

如果您愿意，我也可以发布代码并更好地解释它的作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T18:13:00.990

如果您在 Visual Studio 中进行编码，调试会自动将其放置在 Outlook 中并打开 Outlook。只需确保在开始之前关闭 Outlook，因为这似乎会导致问题。否则，在创建 dll 的 bin 文件夹中有一个 vsto 文件，单击该文件将安装它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-03-04T11:54:39.483

我们也遇到了很多问题，即安装后无法删除不良插件。我们采取的通常步骤是：

*   卸载 VSTO 加载项（使用 vstoinstaller /u 命令）
*   删除 %userprofile%\AppData\Local\Apps\2.0 目录中的目录
*   删除 %userprofile%\AppData\Local\assembly\dl3 目录中的目录
*   清除 ClickOnce 应用缓存 (rundll32 dfshim,CleanOnlineAppCache)

如果这些仍然不起作用，如果您要在 Visual Studio 之外安装 vsto 加载项（如果您想这样做），一种解决方法是临时将主程序集属性中的程序集名称更改为其他名称。然后这会使 Outlook/安装程序误以为这是一个以前从未见过的全新加载项。

希望这可以帮助。

# java - 假设 Spring MessageSource 实现是线程安全的是否安全？

> ID：429089
> 
> 赞同：4
> 
> 时间：2009-01-09T18:08:24.447
> 
> 标签：java, multithreading, spring, internationalization

是否可以安全地假设 org.springframework.context.MessageSource 接口的所有实现在初始化后都是线程安全的？

我希望它是安全的，但现在我正在查看 Spring 源代码，并且有 org.springframework.context.support.ReloadableResourceBundleMessageSource 不时重新加载属性，并且文档没有说明线程安全。 ..

编辑：似乎 ReloadableResourceBundleMessageSource 确实在需要的地方同步了......但是我原来的问题仍然存在。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T18:54:30.610

只看了源代码 - 任何地方都没有同步关键字，并且可写状态。不，它不是线程安全的。

话虽如此，从您的应用程序的角度来看，脏读的危害是什么？错误的标签或消息值？您可能不必担心缺少值，因为如果修改 JSP 或类以使用新消息，您将不得不重新部署整个应用程序。我觉得你在这里很安全。

# php - PHP 中位标志的最佳实践

> ID：429104
> 
> 赞同：14
> 
> 时间：2009-01-09T18:16:04.463
> 
> 标签：php, mysql, flags

我正在用 PHP + MySQL 编写一个小型应用程序，并且已经到了有一个对象有几个（到目前为止是 8 个，但预计不会增加）与之关联的标志的地步。这些标志几乎没有关系，尽管有些组合没有意义。该对象代表数据库中的一行（也有一些保存/加载它的方法），所以这个问题也适用于选择存储方法。

问题是 -**如何在代码和数据库中最好地表示它们？**我可以想到几种方法：

将它们存储在 DB 中的一种方法是在单个整数字段中作为按位标志。在 PHP 方面，我可以想象几种表示它们的方式：

*   只需导出整数值并定义几个标志常量；让每个需要标志的地方都发挥自己的按位魔法；
*   定义类方法`GetFlag()`，`SetFlag()`并对`UnsetFlag()`私有整数变量执行按位魔术；然后将这些方法作为参数传递给标志常量之一。
*   定义方法`GetFlagA()`等`GetFlagB()`（以及 Set 和 Unset 对应项）；
*   定义一堆成员变量，每个变量代表一个标志；将它们设置为从数据库加载并在保存时收集它们。
*   创建一个成员变量，它是所有标志值的数组。使用预定义的常量作为数组索引来访问每个标志。还在加载/保存时填充/收集数组。

另一种方法是将它们作为单独的 BIT 字段存储在数据库中。在 PHP 中，这将转换为几个成员变量。恕我直言，这会使查询复杂化。

最后一种方法是为所有标志定义另一个表，并为标志和原始对象之间的多对多关系定义一个中间表。恕我直言，所有解​​决方案中最混乱的，考虑到否则只有 3 张桌子。

我没有做过太多的 PHP 开发，所以我不知道最佳实践是什么。在 C# 中，我可能会将它们存储为按位标志，并创建对私有整数执行按位魔术的属性。但是 PHP 没有属性（我使用的是最新的稳定版本）...

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-10T02:43:17.747

在您的[模型](http://en.wikipedia.org/wiki/Entity-relationship_model)中，该对象具有 8 个布尔属性。这意味着您的数据库表中有 8 个布尔（MySQL 为 TINYINT）列，对象中有 8 个 getter/setter 方法。简单而传统。

重新考虑您当前的方法。想象下一个必须维护这个东西的人会说什么。

```
CREATE TABLE mytable (myfield BIT(8)); 
```

好的，看起来我们将在这里发生一些二进制数据。

```
INSERT INTO mytable VALUES (b'00101000'); 
```

等等，有人再告诉我这些 1 和 0 分别代表什么。

```
SELECT * FROM mytable;
+------------+
| mybitfield |
+------------+
| (          | 
+------------+ 
```

什么？

```
SELECT * FROM mytable WHERE myfield & b'00101000' = b'00100000'; 
```

哇！？哇！？

*刺自己的脸*

* * *

-- 与此同时，在另一个宇宙中，仙女与独角兽玩耍，程序员并不讨厌 DBA……--

```
SELECT * FROM mytable WHERE field3 = 1 AND field5 = 0; 
```

幸福和阳光！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T18:46:25.463

如果您确实必须使用位标志，则使用 SET 列将它们存储在数据库中，代码中的关联数组以及打开/关闭标志的方法。如果您需要该格式的数组，请添加单独的方法以将数组转换为单个整数。

使用低级位运算符没有任何好处，因此您不妨使代码可读。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-23T22:49:59.780

我编写了这个简单的函数来填补 PHP 和 MySQL ENUM 之间的空白：

```
function Enum($id)
{
    static $enum = array();

    if (func_num_args() > 1)
    {
        $result = 0;

        if (empty($enum[$id]) === true)
        {
            $enum[$id] = array();
        }

        foreach (array_unique(array_map('strtoupper', array_slice(func_get_args(), 1))) as $argument)
        {
            if (empty($enum[$id][$argument]) === true)
            {
                $enum[$id][$argument] = pow(2, count($enum[$id]));
            }

            $result += $enum[$id][$argument];
        }

        return $result;
    }

    return false;
} 
```

用法：

```
// sets the bit flags for the "user" namespace and returns the sum of all flags (15)
Enum('user', 'anonymous', 'registed', 'active', 'banned');

Enum('user', 'anonymous'); // 1
Enum('user', 'registed', 'active'); // 2 + 4 = 6
Enum('user', 'registed', 'active', 'banned'); // 2 + 4 + 8 = 14
Enum('user', 'registed', 'banned'); // 2 + 8 = 10 
```

您只需要确保以与 MySQL ENUM 相同的顺序定义枚举列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T18:23:57.380

假设您使用 5.0.5 之后的 MySQL 版本，您可以将列定义为 BIT[*此处的位数*]。至于 PHP 方面，我可能会使用 Get/SetFlagA、Get/SetFlagB 方法，不需要 unset 方法，因为您可以简单地将布尔值传入 set 方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T18:27:09.947

我会远离按位运算，因为仅通过查看数据库就很难知道设置了哪些标志（除非您出于某种原因试图变得超级高效）。在其他两个选项之间，我认为这取决于这些标志中的每一个具有多少意义。鉴于已经有 8 个，我会倾向于另一张表，它们之间存在多对多关系（抱歉选择了你最不喜欢的）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T19:28:14.613

> 将它们存储在 DB 中的一种方法是在单个整数字段中作为按位标志。

如果你想这样做，你可以使用 __get 和 __set[重载方法](http://us3.php.net/language.oop5.overloading)，这样你就可以简单地检索字段，然后根据需要进行按位运算。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-09T21:35:40.097

好的，在考虑了更多之后，我决定为每个标志使用一个成员变量。我本可以使用 getter/setter 方法，但我不会在代码中的其他任何地方使用它们，所以这会过时。另外，通过这种方式，我还可以从 DB 存储方法中抽象出来，以后可以在需要时轻松更改它。

至于数据库 - 我现在将继续使用按位整数 - 主要是因为我几乎完成了软件并且不想再更改它。它根本不会改变可读性。

# javascript - 仅显示第一张图片的随机横幅

> ID：429107
> 
> 赞同：1
> 
> 时间：2009-01-09T18:17:00.607
> 
> 标签：javascript, banner

我有一个外部 JavaScript，其中包含：

```
function random_imglink(){  
    var myimages=new Array()  
    myimages[1]="http://sevir.sitegoz.com/jchs/Banner1.png"
    myimages[2]="http://sevir.sitegoz.com/jchs/banner2.png"
    myimages[3]="http://sevir.sitegoz.com/jchs/banner3.png"
    myimages[4]="http://sevir.sitegoz.com/jchs/banner4.png"
    myimages[5]="http://sevir.sitegoz.com/jchs/banner5.png"
    myimages[6]="http://sevir.sitegoz.com/jchs/banner6.png"

    var ry=Math.floor(Math.random()*myimages.length)
    if (ry==0)
        ry=1
    document.write('<img src="'+myimages[ry]+'" border=0>')
} 
```

我的 HTML 包含：

```
<script language="JavaScript">
    <!--
    random_imglink()
    //-->
</script> 
```

但只有第一张图片加载。
我的网站在[这里](http://sevir.sitegoz.com/jchs/index.htm)，每次加载（或重新加载）任何页面时，横幅都应该改变，但只显示第一张图片，有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T18:22:03.140

Apache 服务器区分大小写。您将“Banner1”大写，但没有其他横幅。当我尝试导航到其他图像（使用小写“b”）时，我被重定向到托管站点 - 告诉我文件名不存在。

这可能不是您没有获得其他图像的原因，但它肯定没有帮助。

# c# - 如何管理空检查的冲击？

> ID：429112
> 
> 赞同：22
> 
> 时间：2009-01-09T18:18:39.747
> 
> 标签：c#, .net

很多时候，在编程中，我们会遇到`null`检查数量特别多的情况。我说的是这样的事情：

```
if (doc != null)
{
  if (doc.Element != null)
  {
    ... and so on
  }
  else
    throw new Exception("Element cannot be null");
} else {
  throw new Exception("document cannot be null");
} 
```

基本上，整个事情变成了一个难以理解的噩梦，所以我想知道：有没有更简单的方法来描述我在上面尝试做的事情？（除了空检查，我`string.IsNullOrEmpty`不时得到类似的东西。）

**接受的答案：**我接受了具有[此链接](http://blog.getpaint.net/2008/12/06/a-fluent-approach-to-c-parameter-validation/)的答案，因为所描述的方法具有创新性，并且正是我想要的。谢谢肖恩！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-09T19:10:00.610

查看这篇文章：[一种流畅的 C# 参数验证方法](http://blog.getpaint.net/2008/12/06/a-fluent-approach-to-c-parameter-validation)

它是由 Paint.NET 开发人员之一编写的。他使用扩展方法来简化和清理空检查代码。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-09T18:25:17.860

将它们向前推到函数的开头，并将它们排除在执行工作的代码部分之外。像这样：

```
if (doc == null)
    throw new ArgumentNullException("doc");
if (doc.Element == null)
    throw new ArgumentException("Element cannot be null");
AndSoOn(); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-09T18:24:13.073

如果你只是要抛出一个异常，为什么不让语言运行时为你抛出它呢？

```
doc.Element.whatever("foo"); 
```

您仍然会收到带有完整回溯信息的 NullPointerException（或 C# 中的任何内容）。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-09T18:52:23.377

您可能对**[Spec#](http://research.microsoft.com/en-us/projects/specsharp/)**感兴趣：

> Spec# 是 API 契约的一种正式语言，它使用 **非空类型**、前置条件、后置条件、对象不变量和模型程序（将整个运行历史考虑在内的行为契约）的构造扩展了 C#。

您可以让调用者负责确保参数不为空。Spec# 使用感叹号表示：

```
public static void Clear(int[]! xs) // xs is now a non-null type
{
    for (int i = 0; i < xs.Length; i++)
    {
        xs[i] = 0;
    }
} 
```

现在是 Spec# 编译器，它将检测可能的 null 取消引用：

```
int[] xs = null;
Clear(xs);   // Error: null is not a valid argument 
```

作为旁注，您可能还想确保您没有违反[Demeter 法则](http://en.wikipedia.org/wiki/Law_of_Demeter)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-09T18:25:34.193

单独（静态？）函数调用：

```
public static void CheckForNullObject( object Obj, string Message) {
    if(Obj == null){
        throw new Exception(Message);
    }
} 
```

虽然这不是最好的选择，但它会更具可读性。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-09T18:26:17.000

也许一个类的构造函数应该只在属性被初始化为适当的值时才创建对象？话虽如此，只有在创建时具有最少数量的属性时才会创建实例，而不是您可以创建一个 Validate(Doc doc) 方法，该方法基本上会做同样的事情，即检查对象的有效性。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-09T18:27:53.877

您可能对[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)感兴趣。

在过去，它帮助我在很多情况下摆脱了空检查。

示例 (C++)

```
 class IThing
   { 
        public:
          virtual void DoThing() = 0;
   }; 

   class NullThing : public IThing
   { 
        public:
          virtual void DoThing() { /*no-op*/}
   }; 

   class RealThing : public IThing
   { 
        public:
          virtual void DoThing() { /*does something real*/}
   }; 

   int main()
   {
         NullThing theNullInstance; /* often a singleton or static*/
         IThing* thingy = &theNullInstance; /*the null value*/

         // Do stuff that may or may not set  thingy to a RealThing

         thingy->DoThing(); // If is NullThing, does nothing, otherwise does something

         // Can still check for null 
         // If NullThing is a singleton
         if (thingy == &theNullInstance)
         {
              printf("Uhoh, Null thingy!\n"); 
         }
   } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-09T18:28:38.867

如果一个典型的`NullReferenceException`会做，不要费心检查，让运行时抛出它。如果您需要添加上下文错误信息，用于记录或调试目的（或其他），请继续将您的验证分解为不同的方法。在这种情况下，我仍然鼓励您抛出`NullReferenceException`嵌套的原始异常。

当我被迫手动浏览深层 XML 文档时，我不得不做类似的事情。

一般来说，我会尝试在我的类中的接口边界强制执行空值正确性。然后我可以在我的私有方法中忽略空检查。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-09T18:29:41.080

如果您因为嵌套的 if 觉得它不可读，我的建议是这样重写：

```
if (doc == null)
{
  throw new Exception("document cannot be null");
}

if (doc.Element == null)
{
    throw new Exception("Element cannot be null");
}

doc.Element.someMethod() 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-09T18:23:52.277

该代码示例几乎不可读...当变量可能为空时，您将不得不检查空值。但是，如果您想减少这一点，请确保返回对象的方法永远不会返回 null 并且始终返回完全有效且构造的对象。在你让它返回 null 的情况下让它抛出一个异常。返回 null 或 -1 或其他一些奇怪的约定不应代替错误处理。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-09T18:36:56.853

看看“[也许单子](http://incrediblejourneysintotheknown.blogspot.com/2008/12/maybe-monad-in-c.html)”。

它满足了您对在 C# 中执行详细 Null 检查的可读方式的需求。

还有[Maybe codeplex 项目](http://maybe.codeplex.com/)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-09T18:48:01.513

有几个选项（其他人已经提到了一些），所以我只是添加到列表中。

1.  对于某些类型，使用空对象是有意义的。在这种情况下，您必须确保方法永远不会返回简单的 null，而是始终返回一个实例（可能是 null 对象）。

2.  如果您想使用 Paige 建议的静态方法，您甚至可以将其转换为扩展方法。你可以做类似的事情：

    ```
     private static void ThrowIfNull(this object o, string message) {
        if (o != null) return;
        throw new ArgumentNullException(message);
     } 
    ```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-09T19:55:37.087

合同是减少空相关问题和多余检查的关键要素。

在某些情况下，有些方法可能/应该返回 null。如果您调用这样的方法，那么您*只需检查*. 最好尽早检查。

并且有些方法不允许返回 null。不要检查它们的返回值。每个方法都有责任确保它履行自己的合同，因此作为该方法的调用者，您*不必关心*。

有一些工具和语言功能可以帮助您记录和检查空值检查和合同的正确性。抱歉，我不能再解释了，因为我不是 C# 程序员。

如果你想深入了解，我推荐这四个问题。它们大多以 Java 为中心，但对于 C# 来说几乎一切都是正确的，有时答案甚至是针对 .net 和 c# 定制的。

*   [如何避免 Java 中的“！= null”语句？](https://stackoverflow.com/questions/271526/how-to-avoid-null-statements-in-java)
*   [如何在 getter 链中跟踪 NullPointerException](https://stackoverflow.com/questions/410890/how-to-trace-a-nullpointerexception-in-a-chain-of-getters)
*   [返回 '​​null' 或抛出异常](https://stackoverflow.com/questions/175532/return-null-or-throw-exception)
*   [如何显示方法是否可能返回 null](https://stackoverflow.com/questions/411447/how-to-show-if-a-method-may-return-null)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-09T18:28:38.337

不要捕获异常，除非您能够对它们进行智能处理。

在这种情况下，您的异常处理程序在默认情况下几乎没有什么价值——也就是说，让异常传播回调用链。

在您的应用程序/线程的顶层，应该始终有异常处理程序来处理这些未捕获的异常。

编辑：被否决，我觉得被误解了，也许我太敏感了;-)。原始海报抛出的异常没有价值。他们不帮助最终用户，也不帮助开发人员。

应用程序中的顶级异常处理程序应该捕获这样的异常并记录它。日志应该包括堆栈跟踪。这告诉开发人员错误来自哪里，并消除了许多实际上毫无用处的代码行。

如果异常增加了一些价值，那么我同意抛出它是合理的。但这里不是这样。更糟糕的是，一旦你声明这是一个好的原则，你会看到更多的代码行检查空引用，以至于代码会被它们弄得乱七八糟。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-01-09T18:44:39.147

为了解决那些主张允许运行时抛出 NullReferenceException 的人：

我[开始了一个主题](https://stackoverflow.com/questions/368742/throwing-argumentnullexception)，即主动抛出 ArgumentNullException 还是让运行时抛出 NullReferenceException 是否是个好主意。基本共识是采用主动方法而不是 NullReferenceException 方法是一个好主意。我不一定说他们是对的，而在这里提倡其他观点的人是错误的。我只是说社区可能不同意你的观点。

我*想*指出的是，如果您进行**大量**此类检查，则很有可能您做错了什么。要么你的方法做得太多，要么你传递了太多的“流浪汉”参数（除了传递给另一个函数之外没有其他用途的参数）。也许您应该考虑是否可以将代码更多地分解为单独的方法，或者将一些参数封装到一个对象中。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-09T19:05:20.057

如果您恰好使用 C#，请考虑为[nullable](http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx)。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-09T20:00:53.300

如果您要检查传递给部分公共 API 的参数，那么您应该像 Dan Monego 所写的那样在方法的最开始使用“保护子句”。如果您使用 IsNotNull 和其他方法（也许您真的只需要其中一个）创建或重用 Assert 之类的辅助类，则代码将很容易阅读。

您的代码将如下所示：

```
Assert.IsNotNull(doc, "document");
Assert.IsNotNull(doc.Element", "Element");

//... and so on 
```

如果您要检查传递给您的私有方法之一的参数，那么您不应该进行此类检查，而是应该添加合同（在方法文档中或使用某些特殊声明，如果您正在使用某些工具）并始终期望使用正确的参数调用此方法。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-12-06T22:43:11.520

这是一个使用 LINQ 表达式的解决方案，检查链中的所有成员访问并在一切有效时返回实际值：

```
public static T CheckedGet<T>(Expression<Func<T>> expr) where T : class
{
    CheckAccess(expr);
    return expr.Compile().Invoke();
}

public static void CheckAccess(Expression expr)
{
    switch (expr.NodeType)
    {
        case ExpressionType.Lambda:
            CheckAccess((expr as LambdaExpression).Body);
            break;
        case ExpressionType.MemberAccess:
            {
                CheckAccess((expr as MemberExpression).Expression);
                var value = Expression.Lambda(expr).Compile().DynamicInvoke();
                if (value == null)
                {
                    throw new NullReferenceException(expr.ToString());
                }
            }
            break;
        case ExpressionType.ArrayIndex:
            {
                var binaryExpr = expr as BinaryExpression;
                CheckAccess(binaryExpr.Left);
                var arrayLength = (int)Expression.Lambda(Expression.ArrayLength(binaryExpr.Left)).Compile().DynamicInvoke();
                var arrayIndex = (int)Expression.Lambda(binaryExpr.Right).Compile().DynamicInvoke();
                if (arrayIndex >= arrayLength)
                {
                    throw new IndexOutOfRangeException(expr.ToString());
                }
                var value = Expression.Lambda(expr).Compile().DynamicInvoke();
                if (value == null)
                {
                    throw new NullReferenceException(expr.ToString());
                }
            }
            break;
        case ExpressionType.Constant:
            return;
    }
} 
```

有用法，例如：

```
var val = CheckedGet(() => classA.PropertyA.ArrayB[0].FieldC); 
```

它将通过适当的异常检查所有成员的访问权限`null`和有效的数组长度。

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2009-01-09T18:34:16.533

你总是可以写：

```
if (doc == null && doc.Element == null
{

} 
```

但是你失去了我上面一篇文章的解决方案的粒度（例如，异常中的单独消息）。

# java - Java中调用“父”组件的方法

> ID：429114
> 
> 赞同：4
> 
> 时间：2009-01-09T18:19:36.843
> 
> 标签：java, class, methods

我认为最好在示例程序代码中显示以下情况。我有一个扩展的 Java 类`JPanel`。在这个类中有两个对象，它们是另外两个`JPanels`。在其中一个`JPanel`对象中是一个`JTable`对象。我为此添加了一个侦听器来`JTable`检测双击。当它检测到双击时，我想在顶级类中触发一个方法。如何在 Java 中引用此方法？

```
public class TopPanel extends JPanel {

  JPanel OnePanel;
  JPanel TwoPanel;

  public void MethodToFire;

}

public class OnePanel extends JPanel {

  JTable TheTable;

}

public class TheTable extends JTable {

  public TheTable {
    this.addMouseListener(new MouseAdapter(){
      public void mouseClicked(MouseEvent e){
          if (e.getClickCount() == 2){ SYNTAX CALLING THE METHOD IN TopPanel  }
      }
    } );
  }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-09T18:29:11.410

解决这个问题的一种方法是使用组合而不是继承。您可以将 JPanel 传递到 JTable 的子类中。

```
 public class TopPanel extends JPanel 
{
  private TheTable table;

  public TopPanel()
  {
    table = new TheTable(this);
  }

  public void methodToFire() { }
}

public class TheTable extends JTable 
{
  private TopPanel panel;

  public TheTable(TopPanel panel)
  {
    this.panel = panel;

    this.addMouseListener(new MouseAdapter() {
      public void mouseClicked(MouseEvent e) {
        doThing();
      }
    } );
  }

  private void doThing()
  {
    this.panel.methodToFire(); 
  }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T18:28:55.747

要访问 Outer 类上的方法，您需要使用 Outer.this.method() 的语法。

因此，在这种情况下，要从侦听器访问“TheTable”类的方法，您应该使用`TheTable.this.callMethod()`.

我认为它`TopPanel`已经添加了`TheTable`. 在这种情况下，您可以执行以下操作：

```
mouseClicked(...) {
   TopTable t = (TopTable)TheTable.this.getParent();
   t.MethodToFire();
} 
```

这是对问题的直接回答，不一定是“最佳”方法。类型安全的组合方法将是一个更好的长期解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-09T18:34:12.240

似乎您正在绕道而行-为什么不从最外面的班级做所有事情呢？毕竟，这是听众存在的原因之一：

```
 public class TopPanel {
        public TopPanel() {
            // Construct everything here
            OnePanel.TheTable.addMouseListener(new MouseAdapter(){
              public void mouseClicked(MouseEvent e){
                 if (e.getClickCount() == 2){ MethodToFire }
              }
              } );

        }

    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-09T18:47:19.127

您可以让 TheTable 在按下鼠标时触发一个事件，您的 TopPanel 可以监听该事件。这样做的好处是不会使 Table 和 Panel 类相互依赖。

代码涉及更多一点，但解耦可能是值得的。

```
public class TopPanel extends JPanel 
{
  private TheTable table;

  public TopPanel()
  {
    table = new TheTable(this);
    table.addTheTableListener(new TheTableListener() {
      public void tableSelected() {  // or tableSelected(TableSelectionEvent e) if you want to make a TableSelectionEvent
        methodToFire();
      }
    });
  }

  public void methodToFire() { }
}

public class TheTable extends JTable 
{
  private TopPanel panel;
  private EventListenerList listeners;

  public TheTable(TopPanel panel)
  {
    this.panel = panel;
    listeners = new EventListenerList();

    this.addMouseListener(new MouseAdapter() {
      public void mouseClicked(MouseEvent e) {
        fireTableSelected();
      }
    } );
  }

  public void addTheTableListener(TheTableListener l) {
    listeners.add(l);
  }

  // also write removeListener

  private void fireTableSelected()
  {
    for (TheTableListener l : listeners) {
      l.tableSelected(); 
  }
}

public interface TheTableListener extends EventListener
{
    public void tableSelected();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T18:29:18.633

我不认为 Java 有这样做的直接语法，除非你开始使用反射（这当然是可能的，但我认为它不是很干净）。

在您要拨打电话的地方，您的“this”指的是 MouseAdapter 的匿名子类。

最简洁的方法可能是在 TheTable 中创建一个私有方法，我们称之为 X，并让适配器调用该函数。

现在，因为该方法 X 在 TheTable 中，它不知道它在面板内，因此它没有任何方法来激活该功能。如果您确定每个表格都在一个面板内，那么您可以将一个面板引用字段添加到您的 Table 类中，在它创建时对其进行初始化（您可能需要修改 OnePanel 上的构造函数），然后从TheTable 中的方法。

如果您最终尝试探索的面板方法不是 JPanel 的一部分，您可能需要创建和传递接口。

# iphone - 为 iPod 开发需要哪些软件和硬件？在电脑上？

> ID：429124
> 
> 赞同：1
> 
> 时间：2009-01-09T18:22:14.700
> 
> 标签：iphone, cocoa, cocoa-touch, ipod-touch

我想在 iPod 上运行一个简单的应用程序。我是一位经验丰富的程序员，但没有 iPod 或任何 Mac 或 Apple 操作系统的经验。开始使用 PC 作为开发平台进行开发的硬件和软件方面的基本要素是什么？PC 是否需要运行 Linux？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-09T18:31:41.543

您不能在 iPod 上运行应用程序，除非它是 iPhone 或 iPod Touch。对于该平台，您需要一台运行 Leopard、Xcode（免费）和 SDK（免费）的 Mac。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T18:39:15.227

你可以研究一下[Hackintosh](http://lifehacker.com/348653/install-os-x-on-your-hackintosh-pc-no-hacking-required)这个词——然后你就可以运行 Xcode。自己没有做，您可能需要购买一些特定的硬件:)

您可能会发现这个[先前的线程](https://stackoverflow.com/questions/7571/cocoa-and-objective-c-resources)很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T18:31:27.317

您需要使用 Macintosh 和 Xcode 为 iPhone/iPod touch 开发软件。

本周宣布了一些名为 ModelBaker 的新软件，它允许您创建 Ajax iPhone 应用程序，但它也只能在 Macintosh 上运行。

# c++ - C++ 中的覆盖和重载

> ID：429125
> 
> 赞同：34
> 
> 时间：2009-01-09T18:22:45.103
> 
> 标签：c++, overriding, overloading

是的，我确实理解它们之间的区别。我想知道的是：为什么要覆盖一个方法？这样做有什么好处？在重载的情况下：唯一的优点是您不必为函数考虑不同的名称？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-01-09T18:49:32.663

*重载*通常意味着您在同一范围内有两个或多个具有相同名称的函数。调用时更好地匹配参数的函数获胜并被调用。需要注意的是，与调用虚函数相反，调用的函数是在编译时选择的。这完全取决于参数的静态类型。如果你有一个 for`B`和一个 for的重载`D`，并且参数是对 的引用`B`，但它确实指向一个`D`对象，那么`B`在 C++ 中选择了 for 的重载。这称为*静态调度*，而不是*动态调度*. 如果你想和另一个同名的函数做同样的事情，你就重载了，但是你想为另一个参数类型做同样的事情。例子：

```
void print(Foo const& f) {
    // print a foo
}

void print(Bar const& bar) {
    // print a bar
} 
```

他们都打印了他们的论点，所以他们被重载了。但是第一个打印一个 foo，第二个打印一个 bar。如果你有两个函数做不同的事情，当它们具有相同的名称时，它被认为是不好的样式，因为这可能会导致混淆调用函数时实际会发生什么。重载的另一个用例是当您为函数提供附加参数时，它们只是将控制权转发给其他函数：

```
void print(Foo & f, PrintAttributes b) { 
    /* ... */ 
}

void print(Foo & f, std::string const& header, bool printBold) {
    print(f, PrintAttributes(header, printBold));
} 
```

如果经常使用重载所采用的选项，这对调用者来说可能很方便。

*覆盖*是完全不同的东西。它不与超载竞争。这意味着如果您在基类中有虚函数，则可以在派生类中编写具有相同签名的函数。派生类中的函数*会覆盖*基类的函数。样本：

```
struct base {
    virtual void print() { cout << "base!"; }
}

struct derived: base {
    virtual void print() { cout << "derived!"; }
} 
```

现在，如果您有一个对象并调用`print`成员函数，则始终调用派生的打印函数，因为它覆盖了基函数之一。如果函数`print`不是虚拟的，那么派生的函数不会覆盖基函数，而只会*隐藏*它。如果您有一个接受基类的函数以及从它派生的每个函数，则覆盖可能很有用：

```
void doit(base &b) {
    // and sometimes, we want to print it
    b.print();
} 
```

现在，即使在编译时编译器只知道 b 至少是基类，派生类的 print 也会被调用。这就是虚函数的意义所在。没有它们，将调用基类的打印函数，而派生类中的打印函数不会覆盖它。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2014-06-10T18:55:24.160

这将使想法更加清晰。![在此处输入图像描述](https://i.stack.imgur.com/xmKaT.gif)

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-01-09T18:50:17.513

您因三个原因过*载功能：*

1.  提供两个（或更多）执行相似、密切相关的事情的函数，由它接受的参数的类型和/或数量来区分。人为的例子：

    ```
    void Log(std::string msg); // logs a message to standard out
    void Log(std::string msg, std::ofstream); // logs a message to a file 
    ```

2.  提供两种（或更多）方式来执行相同的操作。人为的例子：

    ```
    void Plot(Point pt); // plots a point at (pt.x, pt.y)
    void Plot(int x, int y); // plots a point at (x, y) 
    ```

3.  提供在给定两种（或更多）不同输入类型的情况下执行等效操作的能力。人为的例子：

    ```
    wchar_t      ToUnicode(char c);
    std::wstring ToUnicode(std::string s); 
    ```

在*某些*情况下，值得争论的是，与重载函数相比，不同名称的函数是更好的选择。在构造函数的情况下，重载是唯一的选择。

* * *

Override*一个*函数是完全不同的，并且服务于一个完全不同的目的。函数覆盖是多态性在 C++ 中的工作方式。您重写一个函数以更改该函数在派生类中的行为。这样，基类提供接口，派生类提供实现。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-09T18:26:10.620

当您从基类继承并希望扩展或修改其功能时，覆盖很有用。即使对象被转换为基类，它也会调用您的覆盖函数，而不是基类。

重载不是必需的，但有时它确实使生活更轻松或更易读。可以说它会使情况变得更糟，但那是不应该使用的时候。例如，您可以拥有两个执行相同操作但作用于不同类型事物的函数。例如`Divide(float, float)`应该不同于`Divide(int, int)`，但它们基本上是相同的操作。难道你不想记住一个方法名称“Divide”，而不是必须记住“DivideFloat”、“DivideInt”、“DivideIntByFloat”等等？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-09T21:24:11.353

人们已经定义了重载和覆盖，所以我不会详细说明。

> > [ASAFE](https://stackoverflow.com/users/50754/asafe)问：
> > 
> > [重载]的唯一优势是您没有想到函数的多个名称？

## 1.您不必考虑多个名称

这已经是一个巨大的优势，不是吗？

让我们与已知的 C API 函数及其虚构的 C++ 变体进行比较：

```
/* C */
double fabs(double d) ;
int abs(int i) ;

// C++ fictional variants
long double abs(long double d) ;
double abs(double d) ;
float abs(float f) ;
long abs(long i) ;
int abs(int i) ; 
```

这意味着两件事：第一，您必须通过选择正确的函数来告诉编译器它将提供给函数的数据类型。第二，如果你想扩展它，你需要找到花哨的名字，你的函数的用户必须记住正确的花哨的名字。

而他/她想要的只是获得某个数值变量的绝对值......

**一个动作意味着一个且只有一个函数名。**

请注意，您不限于更改一个参数的类型。只要有意义，任何事情都可以改变。

## 2.对于运营商来说，是强制性的

让我们看看运营商：

```
// C++
Integer operator + (const Integer & lhs, const Integer & rhs) ;
Real operator + (const Real & lhs, const Real & rhs) ;
Matrix operator + (const Matrix & lhs, const Matrix & rhs) ;
Complex operator + (const Complex & lhs, const Complex & rhs) ;

void doSomething()
{
   Integer i0 = 5, i1 = 10 ;
   Integer i2 = i0 + i1 ; // i2 == 15

   Real r0 = 5.5, r1 = 10.3 ;
   Real r2 = r0 + r1 ; // r2 = 15.8

   Matrix m0(1, 2, 3, 4), m1(10, 20, 30, 40) ;
   Matrix m2 = m0 + m1 ; // m2 == (11, 22, 33, 44)

   Complex c0(1, 5), c1(10, 50) ;
   Complex c2 = c0 + c1 ; // c2 == (11, 55)
} 
```

在上面的示例中，您**确实希望**避免使用除 + 运算符之外的任何其他内容。

请注意，C 对内置类型（包括 C99 复杂类型）具有隐式运算符重载：

```
/* C */
void doSomething(void)
{
   char c = 32 ;
   short s = 54 ;
   c + s ; /* == C++ operator + (char, short) */
   c + c ; /* == C++ operator + (char, char) */
} 
```

所以即使在非对象语言中，也会用到这个重载的东西。

## 3.对于对象，是强制性的

让我们看看对象基本方法的使用： 它的构造函数：

```
class MyString
{
   public :
      MyString(char character) ;
      MyString(int number) ;
      MyString(const char * c_style_string) ;
      MyString(const MyString * mySring) ;
      // etc.
} ; 
```

有些人可能认为这类似于函数重载，但实际上，它更类似于运算符重载：

```
void doSomething()
{
   MyString a('h') ;                  // a == "h" ;
   MyString b(25) ;                   // b == "25" ;
   MyString c("Hello World") ;        // c == "Hello World" ;
   MyString d(c) ;                    // d == "Hello World" ;
} 
```

## 结论：重载很酷

在 C 中，当您给出函数的名称时，参数隐含地是调用签名的一部分。如果你有“double fabs(double d)”，那么编译器的 fabs 签名是未修饰的“fabs”，这意味着**你**必须知道它只需要双精度数。

在 C++ 中，函数的名称并不意味着它的签名是强制的。它在调用时的签名是它的名称和它的参数。因此，如果您编写 abs(-24)，编译器将知道它必须调用什么 abs 重载，并且您在编写它时会发现它更自然：您需要 -24 的绝对值。

无论如何，任何使用运算符在任何语言中进行某种程度编码的人都已经使用过重载，无论是 C 还是 Basic 数字运算符、Java 字符串连接、C# 委托等。为什么？**因为它更自然**。

而上面展示的例子只是冰山一角：使用模板时，重载变得非常有用，但这是另一回事。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-09T18:32:13.573

教科书的例子是类 Animal 和方法 speak()。Dog 子类将 speak() 覆盖为“吠叫”，而 Cat 子类将 speak() 覆盖为“喵”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-09T20:15:16.063

重载的一种用途是在模板中使用。在模板中，您编写可用于不同数据类型的代码，并以不同类型调用它。如果采用不同参数的函数必须以不同的方式命名，则不同数据类型的代码通常必须不同，模板就无法工作。

虽然您可能还没有编写模板，但您几乎可以肯定会使用其中的一些模板。流是模板，向量也是。如果没有重载，因此没有模板，您需要调用与 ASCII 流不同的 Unicode 流，并且您必须使用数组和指针而不是向量。

# sql - 按查询挑战分组

> ID：429136
> 
> 赞同：1
> 
> 时间：2009-01-09T18:25:33.273
> 
> 标签：sql, mysql

我有这些表：

```
customer
--------
customer_id int
name        varchar(255)

order
-----
order_id    int
customer_id int
discount    boolean 
```

我可以通过如下查询获得每个客户的订单数量：

```
select c.id, count(o.order_id)
from customer c 
left join order as o using c.customer_id = o.customer_id
group by 1 
```

或者，我可以通过以下方式获取每个客户的折扣订单数量：

```
select c.id, count(o.order_id)
from customer c 
left join order as o using c.customer_id = o.customer_id and o.discount = true
group by 1 
```

但是我想不出一种方法可以在一个查询中同时获得两者。我尝试了以下方法：

```
select c.id, count(o.order_id), count(o2.order_id)
from customer c 
left join order as o using c.customer_id = o.customer_id
left join order as o2 using c.customer_id = o2.customer_id and o2.discount = true
group by 1 
```

但它没有用。是否可以在单个（MySql）查询中计算两者？

干杯，唐

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T18:30:24.653

像这样的东西怎么样

```
select c.id, count(o.order_id),sum(if(o.discount,1,0))
from customer c 
left join order as o using c.customer_id = o.customer_id
group by c.id 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T18:34:27.920

你可以做类似的事情

```
select 
 c.id,
 sum(case o.discount when true then 1 else 0 end) as 'total discounted',
 count(o.order_id) as 'total orders'
from customer as c
 left join order as o using c.customer_id = o.customer_id 
group by c.id 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T19:12:18.670

其他答案很接近，但我是这样写的：

```
SELECT c.id, COUNT(o.order_id) AS order_count, 
  SUM(o.discount = true) AS discount_order_count
FROM customer c 
  LEFT OUTER JOIN order AS o USING (customer_id)
GROUP BY c.id; 
```

请注意 requires 括号的用法，`USING`它只接受将与 比较的列列表`=`。您不能像使用`USING`语法一样使用语法给出完整的比较表达式`ON`。

您还可以简化内部的表达式，`SUM()`因为相等比较返回 1 或 0。

另请参阅“[查询：计算每个项目的多个聚合](https://stackoverflow.com/questions/281866/query-count-multiple-aggregates-per-item#281894)”

# c++ - 调整大小时菜单项闪烁

> ID：429141
> 
> 赞同：1
> 
> 时间：2009-01-09T18:26:09.217
> 
> 标签：c++, winapi

非常感谢大家的帮助，这几天一直困扰着我。

我正在使用 Windows Vista，并使用直接的 Windows API（无 MFC）用 C++ 编写我的程序。

当我调整窗口大小时，菜单项会闪烁。我的窗口类不使用 CS_HREDRAW 或 CS_VREDRAW。我对 CLIENT AREA 使用了双缓冲，所以客户区不会闪烁，只有非客户区上的菜单。

现在我可以通过自己处理 WM_NCPAINT 来解决这个问题，但我真的不想处理所有非客户区的绘图。我也处理 WM_ERASEBKGND，但这也只对 CLIENT AREA 有帮助。我真的不知道如何解决这个问题。我已经广泛搜索了谷歌，并阅读并尝试了所有内容

[http://catch22.net/tuts/flicker](http://catch22.net/tuts/flicker)

已建议。再次感谢你们。我希望你能帮助我理解为什么我的菜单项闪烁（虽然不是菜单栏，也不是边框，也不是窗口标题栏）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-11T02:19:13.410

我很高兴地说我解决了这个问题！我只是使用 CreateWindowEx() 将 WS_EX_COMPOSITED 传递给带有菜单栏的窗口的创建！效果很好，还可以处理子窗口的闪烁。以为我会与你们分享，以防万一你们遇到同样烦人的闪烁。

# .net - N 层 POCO/DTO 困境

> ID：429149
> 
> 赞同：4
> 
> 时间：2009-01-09T18:27:21.240
> 
> 标签：.net, orm, separation-of-concerns

当只有恶意数据集并且 microsoft 应用程序阻塞时，您在层之间的传输对象将是数据集/数据表或 DTO/POCO。我属于喜欢使用 DTO/POCO 的帮派。

现在随着 SubSonic、Entity Framework、NHibernate 等映射层的突然浪潮，我还应该使用我最喜欢的 POCO 吗？我主要这样做，当使用 ASP.net webforms 时，99% 的时间最终使用 ObjectDataSource 绑定到控件和特定于每种类型的功能。

我是否应该放弃对 POCO 的热爱并传递 IQueryables 或 Entities 或类似的东西并利用其他 DataSource 对象？

使用这些对象而不是 DTO 的优缺点是什么？它将如何影响我的应用程序设计和性能？

编辑：我什么时候可以使用其他数据源，如 Linq Datasorce 和 Entity 数据源等？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-09T18:31:25.790

POCO 和 DTO 万岁。它们是轻量级的、易于序列化的、强类型的、可绑定的。他们从来没有任何性能问题，总是让我的更高级别的代码更干净。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T18:47:49.047

使用 nHibernate 或其他可以映射到 POCO 的 ORM :-) 然后您可以根据您想要在生产者和消费者之间分离多少来决定传递 DTO 或 POCO。

我要问的问题是，您是否打算将数据拉入实体/IQueryables，然后将它们转换为 DTO？这是一个非常有效的模式，特别是如果您要转换服务边界并且不想公开您的域模型；但是有一个权衡。根据数据的大小，对性能的影响最小，但这是您需要测量的。

最近我不得不在下拉列表中显示一堆组织对象的列表。组织有很多属性和其他子对象。我的下拉菜单中不需要的只是一个 ID 和名称，以及一些额外的属性......

这是我的 HQL 查询，用于搜索数据库并使用 nHibernate 返回 DTO 列表：

```
 return CurrentSession.CreateQuery(
            "select new OrganizationListDTO(o.Id,o.Name,o.xxx,o.xxx)" +
            " from Organization i where i.State=:state")
            .SetParameter("state", state)
            .List<IOrganizationListDTO>(); 
```

这里的要点是，即使您使用 ORM，您仍然可以利用 DTO 进行类似查询的报告，并让它完成所有繁重的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-25T23:41:22.073

我也在这个十字路口。对于 SOA，除了技术限制之外，还必须考虑其他一些原则——那就是如果你想保持在正确的轨道上。我已经看到一些人将这场辩论更进一步（包括我自己最初）并质疑如何交换业务对象（BO）。但我开始意识到这违反了 SOA 最基本的原则之一——自治。这样做会突然将您的服务绑定到业务细节。这只是我想提出来与 DataContract 和“实体”问题进行比较的一个场景。我认为这些原则更重要——即使是为了一点冗余（即专用 DTO）的成本。我更倾向于为此使用适配器模式，以保持消息传递“基础架构” 以及丰富的面向组件的模型，例如单独的 EDM。此外，使这种“适配器模式”成为一个全面的实体服务候选者，使其在 SOA 世界中更加优雅、可重用和自主。Thomas Erl 在他的著作《面向服务的架构（概念、技术和设计）》中出色地描述了“以实体为中心的服务”的概念。另一件需要思考的事情：如果我的“实体”不存在于单一来源中（即数据库的一部分和文本文件或电子表格的一部分）怎么办？通过接受 DTO 和/或成熟的以实体为中心的服务的额外努力，您可以将其隐藏起来并提高更高的敏捷性。Thomas Erl 在他的著作《面向服务的架构（概念、技术和设计）》中出色地描述了“以实体为中心的服务”的概念。另一件需要思考的事情：如果我的“实体”不存在于单一来源中（即数据库的一部分和文本文件或电子表格的一部分）怎么办？通过接受 DTO 和/或成熟的以实体为中心的服务的额外努力，您可以将其隐藏起来并提高更高的敏捷性。Thomas Erl 在他的著作《面向服务的架构（概念、技术和设计）》中出色地描述了“以实体为中心的服务”的概念。另一件需要思考的事情：如果我的“实体”不存在于单一来源中（即数据库的一部分和文本文件或电子表格的一部分）怎么办？通过接受 DTO 和/或成熟的以实体为中心的服务的额外努力，您可以将其隐藏起来并提高更高的敏捷性。一部分在数据库中，一部分在文本文件或电子表格中）？通过接受 DTO 和/或成熟的以实体为中心的服务的额外努力，您可以将其隐藏起来并提高更高的敏捷性。一部分在数据库中，一部分在文本文件或电子表格中）？通过接受 DTO 和/或成熟的以实体为中心的服务的额外努力，您可以将其隐藏起来并提高更高的敏捷性。

底线：如果您不关心 SOA 原则并且正在开发更多“临时”，那么请选择。但是，如果您处于企业或 B2B 职位，并且根本无法冒 SOA 打算驯服的臭名昭著的“临时蠕变”的风险，那么您可能会以 SOA 实体为中心的服务作为一等公民并照此管理它们。考虑计算的发展方向（SOA、SaaS、PaaS 等），以及它们共享的范例和原则。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-09T19:01:07.570

我发现域和 DTO 的并行对象树令人反感。即使我使用代码生成器，要维护的额外代码也不会给我带来太多好处。我认为层纯度是超卖的。我不是 DTO 的粉丝。

# python - 如何在 Python 中处理 YAML 流

> ID：429162
> 
> 赞同：6
> 
> 时间：2009-01-09T18:29:48.770
> 
> 标签：python, command-line, streaming, yaml

我有一个命令行应用程序，它以以下形式连续输出 YAML 数据：

```
- col0：基准0
  col1：基准1
  col2：基准2
- col0：基准0
  col1：基准1
  col2：基准2
...

```

它为所有永恒做这件事。我想编写一个 Python 脚本来连续读取这些记录中的每一个。

PyYAML 库似乎最擅长获取完全加载的字符串并将其解释为完整的 YAML 文档。有没有办法将 PyYAML 置于“流”模式？

还是我唯一的选择是自己分块数据并将其一点一点地输入 PyYAML？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-10T17:33:00.727

这是我最终使用的，因为似乎没有内置的方法来完成我想要的。这个函数应该足够通用，它可以读取 YAML 流并在遇到顶级对象时返回它们。

```
def streamInYAML(stream):
    y = stream.readline()
    cont = 1
    while cont:
        l = stream.readline()
        if len(l) == 0:
            cont = 0
        else:
            if l.startswith(' '):
                y = y + l
            else:
                yield yaml.load(y)
                y = l 
```

谁能做得更好？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T19:12:47.467

文档中对流的所有引用似乎都指的是文档流...我从未尝试以您描述的方式使用它，但似乎将数据分块成这样的文档流是一个合理的方法。

# python - 我可以使用 urllib 提交 SOAP 请求吗？

> ID：429164
> 
> 赞同：3
> 
> 时间：2009-01-09T18:30:09.347
> 
> 标签：python, soap

我有一个已知可以使用 SoapUI 之类的工具工作的 SOAP 请求，但我正在尝试使用 urllib 让它工作。

这是我迄今为止尝试过的，但没有奏效：

```
import urllib
f = "".join(open("ws_request_that_works_in_soapui", "r").readlines())
urllib.urlopen('http://url.com/to/Router?wsdl', f) 
```

我找不到关于如何将文档发布到 SOAP 服务器的规范。

urllib 不是必需的要求。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-09T19:23:51.033

好吧，我回答了我自己的问题

```
import httplib

f = "".join(open('ws_request', 'r'))

webservice = httplib.HTTP('localhost', 8083)
webservice.putrequest("POST", "Router?wsdl")
webservice.putheader("User-Agent", "Python post")
webservice.putheader("Content-length", "%d" % len(f))
webservice.putheader("SOAPAction", "\"\"")
webservice.endheaders()
webservice.send(f) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T19:25:15.337

简短的回答：是的，你可以。

长答案：

看一下这个[例子](http://users.skynet.be/pascalbotte/rcx-ws-doc/postxmlpython.htm)，它不使用 urllib，但会让你知道如何准备 SOAP 请求。

至于 urllib，我建议使用[urllib2](https://docs.python.org/2/library/urllib2.html)，是的，您可以使用它提交 SOAP 请求，按照与前面示例相同的步骤准备请求。

# c# - 将小数提高到小数的幂？

> ID：429165
> 
> 赞同：29
> 
> 时间：2009-01-09T18:30:11.593
> 
> 标签：c#, bigdecimal, decimal

.net 框架在 Math 类中提供了一种为 double 供电的方法。但是根据精度要求，我需要将小数提高到小数幂 [ Pow(decimal a, decimal b) ]。框架有这样的功能吗？有谁知道具有这种功能的库？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-21T18:30:02.217

为了解决我的问题，我找到了一些[扩展级数](http://mathworld.wolfram.com/MaclaurinSeries.html "扩展系列")，我让它们实现了求解方程 X^n = e^(n * ln x)。

```
// Adjust this to modify the precision
public const int ITERATIONS = 27;

// power series
public static decimal DecimalExp(decimal power)
{
    int iteration = ITERATIONS;
    decimal result = 1; 
    while (iteration > 0)
    {
        fatorial = Factorial(iteration);
        result += Pow(power, iteration) / fatorial;
        iteration--;
    }
    return result;
}

// natural logarithm series
public static decimal LogN(decimal number)
{
    decimal aux = (number - 1);
    decimal result = 0;
    int iteration = ITERATIONS;
    while (iteration > 0)
    {
        result += Pow(aux, iteration) / iteration;
        iteration--;
    }
    return result;
}

// example
void main(string[] args)
{
    decimal baseValue = 1.75M;
    decimal expValue = 1/252M;
    decimal result = DecimalExp(expValue * LogN(baseValue));
} 
```

Pow() 和 Factorial() 函数很简单，因为幂始终是 int（在 de 幂级数内）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-09-13T14:45:51.683

对于正整数 Exponent 和十进制底，这应该是最快的：

```
// From http://www.daimi.au.dk/~ivan/FastExpproject.pdf
// Left to Right Binary Exponentiation
public static decimal Pow(decimal x, uint y){
    decimal A = 1m;
    BitArray e = new BitArray(BitConverter.GetBytes(y));
    int t = e.Count;

    for (int i = t-1; i >= 0; --i) {
        A *= A;
        if (e[i] == true) {
            A *= x;
        }
    }
    return A;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-05-25T13:28:51.263

这是一个 C# 程序，用于手动实现 Math.Pow()，其精度高于 .NET 基于 double 的实现。剪切并粘贴到 linqpad 中以立即运行，或将 .Dump()s 更改为 Console.WriteLines。

我已经对结果进行了测试。测试如下：

1.  目标 = 0.4% pa，每日复利 10 000
2.  答案 = 应该是 10 040
3.  如何 = 十进制 b=10000；for (int i = 0; i<365; i++) { b *= rate; } 其中速率 = (1.004)^(1/365)

我测试了 3 种速率的实现：（1）手动计算（2）Excel（3）Math.Pow

手动计算的准确度最高。结果是：

```
Manually calculated rate:   1.0000109371043837652682334292
Excel rate:                 1.000010937104383712500000M [see formula =(1.004)^(1/365)]
Math.Pow rate:              1.00001093710438

Manual - .4%pa on R10,000:  10040.000000000000000000000131 
Excel - .4%pa on R10,000:   10039.999999999806627646709094 
Math.Pow - .4%pa on R10,000:10039.999999986201948942509648 
```

我还在那里留下了一些额外的工作 - 我用来确定可以适合 ulong (= 22) 的最高阶乘。

Linqpad代码：

```
/*
a^b = exp(b * ln(a))
    ln(a) = log(1-x) = - x - x^2/2 - x^3/3 - ...   (where |x| < 1)
        x: a = 1-x    =>   x = 1-a = 1 - 1.004 = -.004
    y = b * ln(a)
    exp(y) = 1 + y + y^2/2 + x^3/3! + y^4/4! + y^5/5! + ...
        n! = 1 * 2 * ... * n        
*/

/*
//
// Example: .4%pa on R10,000 with daily compounding
//

Manually calculated rate:   1.0000109371043837652682334292
Excel rate:                 1.000010937104383712500000M =(1.004)^(1/365)
Math.Pow rate:              1.00001093710438

Manual - .4%pa on R10,000:  10040.000000000000000000000131 
Excel - .4%pa on R10,000:   10039.999999999806627646709094 
Math.Pow - .4%pa on R10,000:10039.999999986201948942509648 

*/

static uint _LOOPS = 10;    // Max = 22, no improvement in accuracy after 10 in this example scenario
//  8: 1.0000109371043837652682333497
//  9: 1.0000109371043837652682334295
// 10: 1.0000109371043837652682334292
// ...
// 21: 1.0000109371043837652682334292
// 22: 1.0000109371043837652682334292

// http://www.daimi.au.dk/~ivan/FastExpproject.pdf
// Left to Right Binary Exponentiation
public static decimal Pow(decimal x, uint y)
{
    if (y == 1)
        return x;

    decimal A = 1m;
    BitArray e = new BitArray(BitConverter.GetBytes(y));
    int t = e.Count;

    for (int i = t-1; i >= 0; --i) {
        A *= A;
        if (e[i] == true) {
            A *= x;
        }
    }
    return A;
}

// http://stackoverflow.com/questions/429165/raising-a-decimal-to-a-power-of-decimal
// natural logarithm series
public static decimal ln(decimal a)
{
    /*
    ln(a) = log(1-x) = - x - x^2/2 - x^3/3 - ...   (where |x| < 1)
        x: a = 1-x    =>   x = 1-a = 1 - 1.004 = -.004
    */
    decimal x = 1 - a;
    if (Math.Abs(x) >= 1)
        throw new Exception("must be 0 < a < 2");

    decimal result = 0;
    uint iteration = _LOOPS;
    while (iteration > 0)
    {
        result -= Pow(x, iteration) / iteration;
        iteration--;
    }
    return result;
}

public static ulong[] Fact = new ulong[] {
    1L,
    1L * 2,
    1L * 2 * 3,
    1L * 2 * 3 * 4,
    1L * 2 * 3 * 4 * 5,
    1L * 2 * 3 * 4 * 5 * 6,
    1L * 2 * 3 * 4 * 5 * 6 * 7,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16 * 17,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16 * 17 * 18,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16 * 17 * 18 * 19,
    1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16 * 17 * 18 * 19 * 20,
    14197454024290336768L, //1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16 * 17 * 18 * 19 * 20 * 21,        // NOTE: Overflow during compilation
    17196083355034583040L, //1L * 2 * 3 * 4 * 5 * 6 * 7 * 8 * 9 * 10 * 11 * 12 * 13 * 14 * 15 * 16 * 17 * 18 * 19 * 20 * 21 * 22    // NOTE: Overflow during compilation
};

// http://stackoverflow.com/questions/429165/raising-a-decimal-to-a-power-of-decimal
// power series
public static decimal exp(decimal y)
{
    /*
    exp(y) = 1 + y + y^2/2 + x^3/3! + y^4/4! + y^5/5! + ...
    */

    uint iteration = _LOOPS;
    decimal result = 1; 
    while (iteration > 0)
    {
        //uint fatorial = Factorial(iteration);
        ulong fatorial = Fact[iteration-1];
        result += (Pow(y, iteration) / fatorial);
        iteration--;
    }
    return result;
}

void Main()
{   
    decimal a = 1.004M;
    decimal b = 1/365M;

    decimal _ln = ln(a);
    decimal y = b * _ln;
    decimal result = exp(y);
    result.Dump("Manual rate");

    decimal excel = 1.000010937104383712500000M;    // =(1.004)^(1/365)
    excel.Dump("Excel rate");

    decimal m = (decimal)Math.Pow((double)a,(double)b);
    m.Dump("Math.Pow rate");

    //(result - excel).Dump("Diff: Manual - Excel");
    //(m - excel).Dump("Diff: Math.Pow - Excel");

    var f = new DateTime(2013,1,1);
    var t = new DateTime(2014,1,1);
    Test(f, t, 10000, result, "Manual - .4%pa on R10,000");
    Test(f, t, 10000, excel, "Excel - .4%pa on R10,000");
    Test(f, t, 10000, m, "Math.Pow - .4%pa on R10,000");
}

decimal Test(DateTime f, DateTime t, decimal balance, decimal rate, string whichRate)
{
    int numInterveningDays = (t.Date - f.Date).Days;
    var value = balance;
    for (int i = 0; i < numInterveningDays; ++i)
    {
        value *= rate;
    }
    value.Dump(whichRate);
    return value - balance;
}

/*

// Other workings:

//
// Determine maximum Factorial for use in ln(a)
//

ulong max    =  9,223,372,036,854,775,807 * 2   // see http://msdn.microsoft.com/en-us/library/ctetwysk.aspx
Factorial 21 = 14,197,454,024,290,336,768
Factorial 22 = 17,196,083,355,034,583,040
Factorial 23 = 8,128,291,617,894,825,984 (Overflow)

public static uint Factorial_uint(uint i)
{
    // n! = 1 * 2 * ... * n
    uint n = i;
    while (--i > 1)
    {
        n *= i;
    }
    return n;
}

public static ulong Factorial_ulong(uint i)
{
    // n! = 1 * 2 * ... * n
    ulong n = i;
    while (--i > 1)
    {
        n *= i;
    }
    return n;
}

void Main()
{
    // Check max ulong Factorial
    ulong prev = 0;
    for (uint i = 1; i < 24; ++i)
    {
        ulong cur = Factorial_ulong(i);
        cur.Dump(i.ToString());
        if (cur < prev)
        {
            throw new Exception("Overflow");
        }
        prev = cur;
    }
}
*/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T18:37:07.947

我认为这在很大程度上取决于您计划插入的数字。如果“a”和“b”不是“好”数字，那么您可能会得到一个无法存储的非终止值，如果 C# BigDecimal 的行为与 Java BigDecimal 完全一样，在这种情况下它可能会引发异常。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-01-09T18:36:39.227

你确定你真的想这样做吗？`decimal`乘法比 's 慢大约 40 倍，`double`所以我希望小数`Math.Pow()`实际上无法使用。

但是，如果您只期望整数幂，我建议您使用已经在 SO 上讨论过的基于整数的幂算法。

# javascript - 可以添加大量 DOM 节点而不会导致浏览器阻塞吗？

> ID：429174
> 
> 赞同：1
> 
> 时间：2009-01-09T18:32:49.077
> 
> 标签：javascript, ajax, dom

我的网站上有一个显示表格的网页，每 10 秒重新加载 XML 源数据（使用 XmlHttpRequest），然后更新表格以向用户显示数据的任何添加或删除。为此，JavaScript 函数首先清除表中的所有元素，然后为每个数据单元添加一个新行。

最近，我在 Internet Explorer 中与由 DOM 销毁和创建代码引起的一些内存泄漏作斗争（其中大部分与 JavaScript 对象和 DOM 对象之间的循环引用有关，而我们正在使用的 JavaScript 库悄悄地保留了一个引用创建的每个 JS 对象，`new Element(...)`直到页面被卸载）。

随着内存问题的解决，我们现在发现了一个基于 CPU 的问题：当用户有大量数据要查看时（100+ 个数据单元，这等于`<tr>`要创建 100 个节点，加上每个节点的所有表格单元格）列），该进程占用 CPU 直到 Internet Explorer 提示用户：

> 停止运行此脚本？
> 此页面上的脚本导致 Internet Explorer 运行缓慢。如果它继续运行，您的计算机可能会变得无响应。

似乎运行行和单元格创建代码乘以 100 多条数据是导致 CPU 使用率飙升的原因，该函数需要“太长时间”（从 IE 的角度来看）运行，从而导致 IE 生成给用户的这个警告。我还注意到，虽然“更新屏幕”功能针对 100 行运行，但 IE 不会重新呈现表格内容，直到该功能完成（因为 JS 解释器在该时间段内使用 100% CPU，我假设） .

所以我的问题是：JavaScript 中有没有办法告诉浏览器暂停 JS 执行并重新渲染 DOM？如果没有，是否有任何策略来处理创建大量 DOM 节点并且*不让*浏览器阻塞？

我能想到的一种方法是异步处理“更新表”逻辑；也就是说，一旦完成重新加载 XML 数据的 Ajax 方法，将数据放入某种数组中，然后设置一个函数（使用`setInterval()`）运行，该函数一次处理一个数组元素。然而，这似乎有点像在 JavaScript 环境中重新创建线程，这似乎会变得非常复杂（即，如果在我仍在重新创建表的 DOM 节点时触发另一个 Ajax 数据请求怎么办？等等）

* * *

**更新**：只是想解释为什么我接受 RoBurg 的回答。在进行一些测试时，我发现`new Element()`我的框架中的方法（我正在使用[mootools](http://mootools.net/)）大约是`document.createElement()`IE7 中传统方法的 2 倍。我运行了一个测试来创建 1000`<spans>`并将它们添加到 a中，在 IE7 上`<div>`使用大约需要 1800 毫秒（在虚拟 PC 上运行），传统方法大约需要 800 毫秒。`new Element()`

我的测试还揭示了一种更快的方法，至少对于像我这样的简单测试是这样：使用[John Resig 描述的 DocumentFragments](http://ejohn.org/blog/dom-documentfragments/)。使用 IE7 在同一台机器上运行相同的测试需要 247 毫秒，比我原来的方法提高了**9倍！**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T18:43:17.497

100`<tr>`并没有那么多……你还在使用那个框架`new Element()`吗？这可能是它的原因。

你应该测试`new Element()`vs `document.createElement()`vs的速度`.innerHTML`

还可以尝试在“内存中”构建 dom 树，然后将其附加到最后的文档中。

最后请注意，您不会经常查看 .length 或其他类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T18:41:03.977

我在大约 3000 行复杂数据的表中遇到了类似的问题，所以你的代码有些地方不完全正确。它是如何在 Firefox 中运行的？你能检查几个不同的浏览器。

您是否在任何地方绑定到 onPropertyChange？这是一个非常危险的 ie 事件，它让我更早地引起了严重的 ie 特定头痛。你在任何地方都使用 CSS 选择器吗？这些在ie上是出了名的慢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T18:41:24.753

您可以创建一个字符串表示并将其添加为`innerHTML`一个节点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T18:43:36.763

您可以 cloneNode(false) 要重复的元素，然后将其用于循环，而不是每次都生成元素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T21:59:23.950

避免使用一个大`for`循环在一大步中渲染所有数据。而是考虑将数据分解成更小的块。

`while`使用循环渲染每个较小的块。在该块完成后，用`setTimeout`[time 1ms] 调用下一个块，让浏览器“喘口气”。

您可以完全避免使用`while`循环，而只使用`setTimeout`.

使用该`setTimeout`技术**会**稍微降低执行速度，但您不应收到警告消息。

要注意的另一件事是不要将每个元素单独附加到文档中。研究创建一个 new `tbody`，将新行附加到 new `tbody`，并将 附加`tbody`到表中。

还有很多其他的事情会导致应用程序缓慢。将它们全部冲洗掉会很有趣。

这里有一个关于警告的巧妙研究：[http](http://ajaxian.com/archives/what-causes-the-long-running-script-warning) ://ajaxian.com/archives/what-c​​auses-the-long-running-script-warning 。

# php - 困惑如何编写这个简单的 UPDATE/INSERT

> ID：429186
> 
> 赞同：1
> 
> 时间：2009-01-09T18:36:45.810
> 
> 标签：php, mysql, insert

好的，我很困惑如何为我在本地开发的这个简单应用程序编写插入/更新，以了解有关数据库交互的更多信息。

我有一个“编辑”页面，该页面由数据库填充并列出最多 9 个用户链接（在本例中为**user_id 2**），如下所示：

```
<input type="text" name="link1" value="www.yahoo.com">  
<input type="text" name="link2" value="www.google.com">  
<input type="text" name="link3" value="www.amazon.com">  
<input type="text" name="link4" value="">  
<input type="text" name="link5" value="">  
<input type="text" name="link6" value="">  
<input type="text" name="link7" value="">  
<input type="text" name="link8" value="">  
<input type="text" name="link9" value="">  
<input type="submit" name="submitted" value="update"> 
```

*这里应该显示 9 个文本输入，前 3 个输入填充了来自下面链接表的 url……这些输入似乎没有出现在我的问题中，即使它们出现在我的预览中。*

我的**链接**表只有 2 列，如下所示：

```
user_id     linkurl
1           http://www.abcnews.com

2           http://www.yahoo.com
2           http://www.google.com        
2           http://www.amazon.com

3           http://www.ebay.com
3           http://www.craigslist.org 
```

我该如何编写插入/更新查询，例如，编辑第三个链接并添加第四个，可能是第五个、第六个、第七个、第八个和第九个？

在同一页面上，我还有一个用户个人信息部分，我可以使用如下查询轻松更新：

```
$query = "UPDATE users
          SET first_name='$firstname', last_name='$lastname', email='$email', state='$state'"  

if($newpass1){
    $query .= ", pass=md5('$newpass1')";
}

$query .= " WHERE user_id = {$_SESSION['user_id']}"; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T18:46:21.017

我能想到的最简单的方法是将您的 html 更改为这样的内容

```
<input type="text" name="link1" value="www.yahoo.com">  
<input type="hidden" name="oldlink1" value="www.yahoo.com">  
<input type="text" name="link2" value="">  
<input type="hidden" name="oldlink2" value=""> 
```

然后当您阅读它时检查隐藏元素是否为空白，如果是则插入，如果不使用更新语句中的值

```
UPDATE table_name SET linkurl='www.mynewlink.com' 
WHERE linkurl='www.yahoo.com' and user_id=1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T18:44:54.543

我真的不明白你遇到了什么麻烦。如果您展示了一些您尝试过的东西并没有达到您想要的效果，这可能会有所帮助。

我的一条建议是你可能想在链接表中添加一个 link_id 列。这将使唯一标识每一行并保留原始输入顺序变得更加容易。（我不知道 MySQL 的实现，但在一般 RDBMS 理论中，您不应该假设行是按照它们插入的顺序存储的。）

**更多细节：** 我认为 link_id 将是 1 到 9 之间的数字，以便 user_id 和 link_id 一起唯一标识链接表中的一行。我认为这不能通过自动增量实现，但我不知道 mysql。当您从表中选择时，它将类似于“SELECT url FROM links WHERE user_id = 3 ORDER BY link_id”；这将使链接保持正确的顺序。提交表单时，我认为您会根据字段编号确定 link_id 的值。假设您的环境有办法确定受 SQL 操作影响的行数，我建议您尝试像“UPDATE links SET url = 'newvalue' WHERE user_id = 3 AND link_id = 4”这样的更新，那么如果报告 0 行已更新，而是执行 INSERT。

PS 我知道你说这是一个学习项目，但是随着你的深入，请阅读 SQL 注入以及如何避免它！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T18:46:37.787

所以我可能会删除用户的所有现有条目，然后重新填充它们：

```
$query = "DELETE FROM links WHERE user_id = {$_SESSION['user_id']}";
foreach ($i = 1; $i < 10; $i++) {
  if (!empty($_POST['link' . $i])) {
    $query = "INSERT INTO links (user_id, linkurl) VALUES ({$_SESSION['user_id']}, '" . $_POST['link' . $i] . "')";
  }
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-09T19:23:48.820

我建议向表中添加一个唯一的行标识符（例如 SQL Server 中的标识列）并使用它来决定要更新哪些记录。没有行标识符的操作必然是插入。

# perl - 在 Perl 中解析 Excel 文件的最佳方法是什么？

> ID：429193
> 
> 赞同：12
> 
> 时间：2009-01-09T18:37:53.560
> 
> 标签：perl, excel, parsing

在 Perl 中解析 Excel 文件的最简单方法是什么？将其转换为文本文件也可以。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-09T20:01:48.743

最好的方法是使用[Spreadsheet::ParseExcel](http://search.cpan.org/~dougw/Spreadsheet-ParseExcel-0.65/lib/Spreadsheet/ParseExcel.pm)。

这是一个例子：

```
#!/usr/bin/perl -w

use strict;
use warnings;

use Spreadsheet::ParseExcel;

my $parser   = Spreadsheet::ParseExcel->new();
my $workbook = $parser->parse('Book1.xls');

for my $worksheet ( $workbook->worksheets() ) {

    my ( $row_min, $row_max ) = $worksheet->row_range();
    my ( $col_min, $col_max ) = $worksheet->col_range();

    for my $row ( $row_min .. $row_max ) {
        for my $col ( $col_min .. $col_max ) {

            my $cell = $worksheet->get_cell( $row, $col );
            next unless $cell;

            print "Row, Col    = ($row, $col)\n";
            print "Value       = ", $cell->value(),       "\n";
            print "Unformatted = ", $cell->unformatted(), "\n";
            print "\n";
        }
    }
} 
```

要使用 Perl 将 Excel 文件转换为文本，我推荐使用 Spreadsheet::ParseExcel 的[excel2txt 。](http://search.cpan.org/~kclark/excel2txt/excel2txt)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-09T18:40:23.023

[使用Spreadsheet::ParseExcel](http://search.cpan.org/~jmcnamara/Spreadsheet-ParseExcel-0.44/lib/Spreadsheet/ParseExcel.pm)我很幸运。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-09T18:43:10.290

理想情况下，“最好”的方法是使用我们心爱的[CPAN](http://search.cpan.org)中的模块。

**每当**您遇到问题时，**立即问：为什么我还没有检查 CPAN？**

但是我不能确定哪个模块，这里有一个列表让你开始，试试它们，看看有什么用。

*   [电子表格::ParseExcel](http://search.cpan.org/dist/Spreadsheet-ParseExcel)
*   [DBD::Excel](http://search.cpan.org/dist/DBD-Excel)
*   [XML::Excel](http://search.cpan.org/dist/XML-Excel)
*   [文件::提取](http://search.cpan.org/dist/File-Extract)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-06T20:24:04.393

```
@echo off  
ECHO CHECK THE VERSION FROM THE PROJECT
    echo see also this [link][1]
for /f "tokens=*" %%i in ('Type Version.txt') do set _Version=%%i
ECHO The _Version is %_Version%

ECHO remove the output html files
del *.html /q
ECHO remove the output log files
del *.log /q

::pause
ECHO %0 > %0.log
ECHO %0.error.log >%0.error.log

set BaseDir=D:\perl\sfw\ExcelToHtml.%_Version%
echo BaseDir is %BaseDir%  1>>%0.log 2>>%0.error.log
ECHO.

set LogLevel=3
echo LogLevel is %LogLevel%  1>>%0.log 2>>%0.error.log
ECHO.

::set ExcelFileToParse="%BaseDir%\CoDA_ETL_Integration.xls"
SET ExcelFileToParse="%BaseDir%\TODO.xls"
echo ExcelFileToParse is %ExcelFileToParse%  1>>%0.log 2>>%0.error.log
echo.

set OutputDir=%BaseDir%
echo OutputDir is %Outputdir%  1>>%0.log 2>>%0.error.log
echo.

ECHO SET THE UNICODE FOR PERL FOR UTF-8
SET PERL_UNICODE=S
ECHO %%PERL_UNICODE%% IS %PERL_UNICODE%

::set PerlScript=parseExcelToCsv.pl
set PerlScript=ExcelToHtml.pl
echo PerlScript is %PerlScript%  1>>%0.log 2>>%0.error.log
ECHO.

echo Action !!!  1>>%0.log 2>>%0.error.log
echo perl %BaseDir%\%PerlScript% %LogLevel% %ExcelFileToParse% %OutputDir%  1>>%0.log 2>>%0.error.log
perl %BaseDir%\%PerlScript% %LogLevel% %ExcelFileToParse% %OutputDir% 1>>%0.log 2>>%0.error.log

%0.error.log
%0.log

::debug pause

use strict;
use Spreadsheet::ParseExcel;
use utf8 ; 
use Encode ; 

package ExcelToHtml ; 

my $DebugLevel = 3 ; 
print defined($ARGV[0]) ? $DebugLevel = $ARGV[0] : "Using max DebugLevel = $DebugLevel", " \n";
my $minimumAmountOfCommandLineArgs = 3 ; 
my ( $ExcelFileToParse , $OutputDir , $BaseFileName ) = (); 

sub main {
    logMsg("$0 SCRIPT START " , 1 );
    #Action !!! call here methods
    checkCommandLineArgs();     
    buildNames (); 

    ParseExcelAndlogMsgFiles ( $ExcelFileToParse  , $BaseFileName , $OutputDir) ; 

    logMsg("$0 SCRIPT STOP " , 1 );

} #eof MAIN 

sub buildNames 
{

    $ExcelFileToParse = "$ARGV[1]" ; 
    $OutputDir="$ARGV[2]" ;
    $BaseFileName = $ExcelFileToParse ; 
    logMsg( "\$ExcelFileToParse is $ExcelFileToParse" ) ; 
    logMsg ( "\$OutputDir is $OutputDir" ) ; 
    logMsg ("\$BaseFileName is $BaseFileName \n" );
    $BaseFileName =~ s/^(.*)(\\|\/)(.*)/$3/;    #strip the directory part 
    logMsg ("\$BaseFileName is $BaseFileName ");
    $BaseFileName =~ s/^(.*)(\.)(.*)/$1/ ;  #strip the file extension
    logMsg ( "\$BaseFileName is $BaseFileName "); 

} #eof sub buildNames

sub ParseExcelAndlogMsgFiles {

my $ExcelFileToParse = shift ; 
my $BaseFileName = shift ; 
my $OutputDir = shift ; 
my $strToReturn = "";

my $parser   = Spreadsheet::ParseExcel->new();
my $workbook = $parser->Parse("$ExcelFileToParse");

for my $worksheet ( $workbook->worksheets() ) {

        my ( $row_min, $row_max ) = $worksheet->row_range();
        my ( $col_min, $col_max ) = $worksheet->col_range();

        for my $row ( $row_min .. $row_max ) {
                my $rowStr = "" ; 
                for my $col ( $col_min .. $col_max ) {

                        my $cell = $worksheet->get_cell( $row, $col );
                        next unless $cell;

                        logMsg ( " Row, Col    = ($row, $col)") ; 
                        logMsg ( "\$cell->encoding() is " . $cell->encoding()) ;

                        logMsg (" Value = ", $cell->value() );
                        $rowStr .=  makeCell($cell->value() )      ;                #The Value

                        logMsg ( "Unformatted = ", $cell->unformatted()) ; 

                } #eof col
            $rowStr = makeRow( $rowStr ); 
            $strToReturn .= $rowStr ; 
     } #eof for my row

        my $worksheetName = $worksheet->{'Name'}  ; 
        my $FileSheet = "$OutputDir/$BaseFileName" .  '.' . $worksheetName . '.' . 'html' ; 
        $strToReturn = makeTable ( $strToReturn );
        $strToReturn = makeFile ( $strToReturn );
        logMsg ( "\$strToReturn  is $strToReturn " ) ; 
        PrintToFile ( $FileSheet, $strToReturn )  ; 
        $strToReturn = "" ;
        $FileSheet = "" ;
        } #eof for my worksheet

} #eof sub

sub trim    
{
        $_[0]=~s/^\s+//;
        $_[0]=~s/\s+$//;
        return $_[0];
}

# =========================================== eof sub trim 
# Action !!!

sub makeRow 
{
    my $row = shift ; 
    return "<tr>" .  $row .  "</tr> \n"  ; 
}

sub makeCell 
{
    my $cell = shift ; 
    return "<td>"  .  "$cell" . " </td>" ; 
}

sub makeTable
{
    my $table = shift ; 
    return "\n <table> " . $table . "</table> \n" ; 

}

sub makeFile
{
    my $file = shift ; 

    $file = "<html> <head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/></head><body> $file </body></html>\n" ; 
    return $file ; 
}

sub checkCommandLineArgs
{

        if ( @ARGV != $minimumAmountOfCommandLineArgs )
        {
            logErrorMsg ( "Not enougn command line args supplied exit 1" , 1 );
            die "usage: $0 1 args \n" ; 
            exit 1 ; 
        } #eof if
        else 
        {
                foreach (@ARGV) { logMsg ( "$_ " ) ;  }
        } #eof else         if ( @ARGV != 4 )

} #eof sub checkCommandLineArgs

#log a message according to the DebugLevel
sub logMsg 
{
    my $msg = shift ;
    my $importance = shift ; 

    my $CurrentPerlScriptName = "$0" ; 
    my $niceMonth = GetANiceMonth (); 
    my $logFile = "$CurrentPerlScriptName" . '_' . "$niceMonth" .  '.log' ; 
    $msg = GetANiceTime () .' --- ' .   $msg . " \n" ; 

    if ( $importance == 1 ) 
    {
        $msg = "\n============================================================ \n" . $msg ; 
        $msg = $msg . "============================================================ \n" ;
    }

    #debug nothing
    if ( $DebugLevel == 0 ) {   return ; } 

    #just logMsg the message
    if ( $DebugLevel == 1 ) 
    {
        logMsg ( $msg ); 
    } #eof if ( $DebugLevel == 1 ) 

    #logMsg the message in 
    if ( $DebugLevel == 2 ) 
    {
        #READ ALL ROWS OF A FILE TO ALIST 
        open (LOG, ">> $logFile") || print "could not open the \$logFile $logFile !!!\n"; 
        print LOG $msg  ; 
        close LOG;
    }

    #logMsg the message in 
    if ( $DebugLevel == 3 ) 
    {
        #READ ALL ROWS OF A FILE TO ALIST 
        open (LOG, ">> $logFile") || print "could not open the \$logFile $logFile !!!\n"; 
        print LOG $msg  ; 
        close LOG;
        print $msg ; 
    } #eof if ( $DebugLevel == 3 ) 

} #eof sub logMsg 

#log a message according to the DebugLevel
sub logErrorMsg 
{
    my $errorMsg = shift ; 
    my $importance  = shift ; 

    my $CurrentPerlScriptName = "$0" ; 
    my $niceMonth = GetANiceMonth (); 
    my $errorLogFile = "$CurrentPerlScriptName" . "_" .  "$niceMonth" . '.error.log' ; 
    $errorMsg = GetANiceTime () .' --- ' .   $errorMsg . " \n" ; 

        if ( $importance == 1 ) 
        {
            $errorMsg = "\n============================================================ \n" . $errorMsg ; 
            $errorMsg= $errorMsg. "============================================================ \n" ;
        }

    #debug nothing
    if ( $DebugLevel == 0 ) {   return ; } 

    #just logMsg the message
    if ( $DebugLevel == 1 )  {      print $errorMsg ;       } 

    #logMsg the message in a error log file
    if ( $DebugLevel == 2 ) 
    {
        #READ ALL ROWS OF A FILE TO ALIST 
        open (ERRLOG, ">> $errorLogFile") || print "could not open the \$errorLogFile $errorLogFile !!!\n"; 
        print ERRLOG $errorMsg ; 
        close ERRLOG;
    }

    #logMsg the message in 
    if ( $DebugLevel == 3 ) 
    {
        #READ ALL ROWS OF A FILE TO ALIST 
        open (ERRLOG, ">> $errorLogFile") || print "could not open the \$errorLogFile $errorLogFile !!!\n"; 
        print ERRLOG $errorMsg  ; 
        close ERRLOG;
        print $errorMsg ; 
    } #eof if ( $DebugLevel == 3 ) 

} #eof sub logErrorMsg 

#GET A NICE TIME 
sub GetANiceTime {
 # Purpose: returns the time in yyyymmdd-format 
 my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time); 
 #---- change 'month'- and 'year'-values to correct format ---- 
 $min = "0$min" if ($min < 10); 
 $hour = "0$hour" if ($hour < 10);
 $mon = $mon + 1;
 $mon = "0$mon" if ($mon < 10); 
 $year = $year + 1900;
 $mday = "0$mday" if ($mday < 10); 
 return "$year\.$mon\.$mday" . "-" . "$hour\:$min\:$sec"; 
} #eof sub GetANiceTime

sub GetANiceMonth {
 # Purpose: returns the time in yyyymmdd-format 
 my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time); 
 #---- change 'month'- and 'year'-values to correct format ---- 
 $mon = $mon + 1;
 $mon = "0$mon" if ($mon < 10); 
 $year = $year + 1900;
 return "$year\.$mon" ; 
} #eof sub GetANiceTime

sub PrintToFile {
my $FileOutput = shift ; 
my $StringToPrint = shift ; 
#READ ALL ROWS OF A FILE TO ALIST 
open (FILEOUTPUT, ">$FileOutput") || 
            print "could not open the \$FileOutput $FileOutput!\n"; 
print  FILEOUTPUT $StringToPrint ; 
close FILEOUTPUT ;

#debug $strToReturn .=  $StringToPrint; 

}
# =========================================== eof sub PrintToFile

#Action !!!
main();

1 ; 

__END__

#VersionHistory: 
#1.0\. --- Yordan Georgiev --- Initial creation 
#1.1 --- Yordan Georgiev --- Added conditional logging 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-15T13:50:08.593

[http://search.cpan.org/dist/Spreadsheet-Read/Read.pm](http://search.cpan.org/dist/Spreadsheet-Read/Read.pm)

Spreadsheet::Read 尝试透明地读取*任何*电子表格并以通用方式返回其内容，独立于执行实际电子表格扫描的解析模块。

# wpf - WPF：提升页面模式的弹出窗口的最佳方法？

> ID：429200
> 
> 赞同：16
> 
> 时间：2009-01-09T18:41:26.050
> 
> 标签：wpf, popup

我正在使用导航样式页面而不是 Windows 构建 WPF 应用程序。我想在一个页面内显示一个窗口，这个窗口必须是该页面的模态窗口，但允许用户转到其他页面，并返回与模态窗口处于相同状态的同一页面。

我尝试过使用 WPF 弹出控件，但问题是每次您离开页面时控件都会隐藏。我想我可以编写代码再次显示它，但没有以正确的方式接缝。

在 WPF 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-25T00:44:17.163

这个[StackOverflow 答案](https://stackoverflow.com/questions/173652/how-do-i-make-modal-dialog-for-a-page-in-my-wpf-application/173769#173769)可能会对您有所帮助。我创建了一些其他用户要求的示例代码。[我已将其添加到此处](http://bradleach.wordpress.com/2009/02/25/control-level-modal-dialog/)的博客文章中。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-11-12T10:46:19.630

Why not just use nested message pumps to create modal controls

[http://www.deanchalk.com/wpf-modal-controls-via-dispatcherframe-nested-message-pumps/](http://www.deanchalk.com/wpf-modal-controls-via-dispatcherframe-nested-message-pumps/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-25T00:34:27.170

您可以创建一个弹出类，它使用装饰层将自己置于其他所有内容之上。

为具有名为*IsOpen*的属性的弹出窗口创建一个基类，并在更改时将控件的可见性设置为适当的值。

要停止单击弹出窗口下方的控件，您可以使弹出窗口占据页面的完整大小。除了弹出窗口的实际中间之外，您将使其大部分透明。如果您希望它对弹出窗口完全透明，则需要覆盖弹出窗口上的 HitTestCore。

像这样的东西：

```
protected override HitTestResult HitTestCore(PointHitTestParameters hitTestParameters)
{
    // We want this control to behaive as a single rectangle and we don't much care
    // whether or it has a solid background.  So we override this method so we can have    // mouse over info for the entire panel regardless of background.

    // run the base hit test first, because if it finds something we don't want to overrule it.
    HitTestResult result = base.HitTestCore(hitTestParameters);

    // If we didn't get a hit generate a new hit test result, because HitTestCore is never called unless
    // the mouse is over the controls bounding rectangle.
    if (result == null)
        result = new PointHitTestResult(this, hitTestParameters.HitPoint);

    return result;
} 
```

我希望这可以为您指明正确的方向。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T18:57:37.217

Windows 不喜欢你这样做——这不是 WPF 的事情。使用覆盖面板并使用 visible 或 zorder 属性。

[维基百科](http://en.wikipedia.org/wiki/Dialog_box)有一个很好的讨论。

# c# - 为什么我的自定义用户控件的孩子没有被初始化？

> ID：429202
> 
> 赞同：5
> 
> 时间：2009-01-09T18:41:29.030
> 
> 标签：c#, .net, asp.net, user-controls, controls

**更新：** *我一直在试验我的控件，我想我已经接近了。请继续阅读以获取更新信息。*

我有 2 个 ASP.NET 2.0 用户控件，其中一个位于另一个*内部*。在内部控件内部，我有一个`HtmlAnchor`标签控件，我试图从外部控件设置一个 URL。当我尝试`HRef`从呈现页面的标记中设置属性时，`HtmlAnchor`控件会`null`抛出异常。

*在内部或外部控件的 OnInit 事件之前*以及主页的“ ”事件之前调用URL`set`属性。我假设这是因为我在渲染控件的页面上的父控件的标记中设置子控件的 URL，这意味着值是在之前设置的。这是我正在使用的代码的（精简版）版本：*`OnPreInit``OnInit()`*

 *```
[ParseChildren(true)]// <- Setting this to false makes the 
                     //    page render without an exception 
                     //    but ignores anything in the markup.
[PersistChildren(false)]
public partial class OuterControl : System.Web.UI.UserControl
{
    // The private '_Inner' control is declared 
    // in the .ascx markup of the control
    [PersistenceMode(PersistenceMode.InnerProperty)]
    public InnerControl Inner
    {
        get{ return _Inner; }
        set{ _Inner = value; }
    }
}

public partial class InnerControl : System.Web.UI.UserControl
{
    // The private 'linkHref' control is declared
    // in the .ascx markup of the control
    public string Url
    {
        get { return linkHref.HRef; }
        set { linkHref.HRef = value; }
    }
} 
```

OuterControl 在我的 Default.aspx 页面上使用，如下所示：

```
<uc1:OuterControl ID="OuterCtrl1" runat="server">
    <Inner Url="#" />
</uc1:OuterControl> 
```

在上面的标记示例中，如果我尝试呈现此页面，则会引发异常，因为`linkHref`控件为空。使用我的调试器，我可以看到 InnerControl 中的每个控件都是空的，但是当访问该属性`OnInit()`时，还没有触发 InnerControl 和 OuterControl 的事件。`Url`

**更新**
我认为添加属性 ' `ParseChildren`' 和 ' `PersistChildren`' 会有所帮助。我以前在服务器控件中使用过它们，但从未在用户控件中使用过，尽管效果似乎相似。我认为我没有正确解释这两个属性的文档，但它可以阻止抛出异常。但是页面标记被忽略了。

有谁知道有这个工作的方法。我不明白为什么这些控件之前设置的值`OnInit()`。当我尝试使用 ASPX 标记设置它们的值时，构造函数`InnerControl`被调用了两次。一次根据标记设置值（我假设），然后再次设置`OnInit()`（我猜这就是为什么标记值被忽略的原因）。

这种努力是没有希望的，还是我只是从错误的角度接近它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-17T16:14:01.910

问候丹，

我之前遇到过类似的问题，嵌套控件的混乱，所以我发现自己渴望提供帮助，我也将它标记为最喜欢的，因为我喜欢它。

我将问题重现如下：-

**创建了一个名为 Inner 的用户控件：**

内部.ascx

```
<%@ Control Language="C#" AutoEventWireup="true" CodeFile="Inner.ascx.cs" Inherits="Inner" %>
<a runat="server" id="linkHref">I'm inner</a> 
```

内部.ascx.cs

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class Inner : System.Web.UI.UserControl
{
    public string Url
    {
        get
        {
            return this.linkHref.HRef;
        }
        set
        {
            this.linkHref.HRef = value;
        }
    }
} 
```

**创建了一个名为 Outer 的用户控件：**

外部.ascx

```
<%@ Control Language="C#" AutoEventWireup="true" CodeFile="Outer.ascx.cs" Inherits="Outer" %>
<%@ Register src="Inner.ascx" tagname="Inner" tagprefix="uc1" %>
<uc1:Inner ID="_Inner" runat="server" /> 
```

外层ascx.cs

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class Outer : System.Web.UI.UserControl
{
    [PersistenceMode(PersistenceMode.InnerProperty)]
    public Inner Inner
    {
        get
        {
            return this._Inner;
        }
    }
} 
```

**然后创建了一个名为 Default 的页面：**

默认.aspx

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %>

<%@ Register src="Outer.ascx" tagname="Outer" tagprefix="uc1" %>
<%@ Reference Control="~/Inner.ascx" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <uc1:Outer ID="Outer1" runat="server">
            <Inner Url="http://google.com" />
        </uc1:Outer>
    </div>
    </form>
</body>
</html> 
```

有了所有这些，“默认”页面运行良好。

我在您的代码中发现奇怪的是这一行：

```
public InnerControl Inner
    {
        //...
        set{ _Inner = value; }
    } 
```

为内部控件创建设置器有什么意义？我无法理解。内部控件实例应该是从外部控件中的标记创建的，并且正是这个创建的实例，其 html 锚点应该被操纵。如果我将这些行添加到 Outer.ascx.cs 的 Inner 属性中

```
set
{
    this._Inner = (ASP.inner_ascx)value;
} 
```

与原始情况一样，我将得到一个空引用异常。我认为 setter 指示 ASP.Net 页面构建器创建另一个 Inner 控件实例并使用 Inner 属性对其进行设置。我不确定，但如果您有时间，您可以通过检查页面生成器生成的 cs 文件来确切了解这是如何发生的，它们位于临时 ASP.Net 文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-03T03:55:18.763

如果 OuterControl.ascx 看起来像

```
<%@ Register TagPrefix="uc1" TagName="InnerControl" Src="InnerControl.ascx" %>
<uc1:InnerControl runat="server" ID="_Inner" /> 
```

那么问题是该`OuterControl.Inner`属性有一个`set`访问器。删除`set`访问器以解决问题：

```
[PersistenceMode(PersistenceMode.InnerProperty)]
public InnerControl Inner
{
    get { return _Inner; }
} 
```

**说明：**如果`OuterControl.Inner`有`set`访问器...

1.  首先，ASP.NET 实例化`ASP.outercontrol_ascx`（从`OuterControl`, 派生的动态生成的类），然后实例化`ASP.innercontrol_ascx`（从 派生的动态生成的类）的实例`InnerControl`。
2.  接下来，因为该`Inner`属性有一个`set`访问器，ASP.NET 创建一个新实例`InnerControl`（*不是* `ASP.innercontrol_ascx`您可能期望的）并尝试将其`Url`属性初始化为`"#"`. 当然，这是`NullReferenceException`因为`linkHref`是由`ASP.innercontrol_ascx`而不是由创造的`InnerControl`。
3.  最后（如果没有抛出异常），ASP.NET 设置`Inner`为`InnerControl`它在步骤 2 中创建的实例。

如果`OuterControl.Inner`没有`set`访问器，则在第 2 步中，ASP.NET 只需设置`OuterCtrl1.Inner.Url`为`"#"`，并跳过第 3 步。

**注意：**其他几个答案表明控件是在`Init`. 这是不正确的；在标记中声明的控件是在页面生命周期的早期创建和初始化的，in `FrameworkInitialize`（发生在之前`PreInit`）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T22:42:22.597

你说：

> ```
> // The private 'linkHref' control is declared
> // in the .ascx markup of the control 
> ```

如果你把它设为受保护的控件，它会改变什么吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T19:13:46.187

您是否在页面的 OnInit 方法上设置 HRef？如果是这样，请尝试将作业移至 Page_Load。

从最外到最内的控件Init。这意味着如果您确实在 Page 的 OnInit 上分配了值，则控件尚未初始化。

这是一个关于页面生命周期的不错的文档：http: [//www.codeproject.com/KB/aspnet/lifecycle.aspx](http://www.codeproject.com/KB/aspnet/lifecycle.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-17T10:44:06.350

控制树是在 Init() 之后构建的；事实上， Init() 是在视图状态被反序列化之前将控件添加到树的地方。在构建控制树之前，您无法访问 linkHref。

一种可能的解决方案是存储 URL，直到您可以使用它。在内部控件中，将 Url 属性更改为一个简单的字符串：

```
public string Url { get; set; } 
```

在内部控件的 Load 或 PreRender 事件处理程序中，将字符串传播到（现已初始化的）linkHref 对象：

```
linkHref.HRef = value; 
```

# iphone - 没有连接到调试器时，有没有办法在 iPhone 上捕获 NSLog 的输出？

> ID：429205
> 
> 赞同：14
> 
> 时间：2009-01-09T18:42:23.690
> 
> 标签：iphone, cocoa-touch, nslog

我正在记录一堆数据`NSLog()`。当我的 iPhone 没有连接到我的开发机器并在调试器下运行时，有没有办法捕获日志数据？

例如，我可以将它重定向到一个文件，然后稍后通过 Xcode 读回日志文件吗？我需要这样做以便在 WiFi 很差时测试我的应用程序，这需要我远离办公桌。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-09T20:50:29.550

下面的方法将在您的应用程序的 Documents 文件夹中创建一个文件名“console.log”，以便您以后阅读它。

在程序开始时调用此方法：

```
- (void) redirectConsoleLogToDocumentFolder
{
  NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
  NSString *documentsDirectory = [paths objectAtIndex:0];
  NSString *logPath = [documentsDirectory stringByAppendingPathComponent:@"console.log"];
  freopen([logPath cStringUsingEncoding:NSASCIIStringEncoding],"a+",stderr);
} 
```

日志永远不会被删除，因此请谨慎使用。

在现场测试应用程序后，将手机重新连接到 Mac，在 Xcode 中打开管理器。在“摘要”面板中，您拥有手机上所有应用程序的列表。展开你正在调试的那个，你会看到一个名为“Application Data”的包。

单击其名称右侧的箭头并保存。您将以一个文件夹结尾，该文件夹的名称为您的 Bundle Identifier，后跟一个日期。

在此文件夹中，您将找到您的 Documents 文件夹，其中应包含 console.log

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-09T19:09:55.820

我很确定 NSLog() 调用将被写入系统控制台日志，因此如果您在离线后将 iPhone 连接到计算机，您应该能够在 XCode Organizer 中查看控制台日志。唯一需要注意的是控制台日志的大小是有限的，因此如果您进行大量日志记录，旧条目可能会被删除。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-06-19T22:17:51.707

App Store 中还有一个[控制台应用程序，但它仅适用于 iOS 6 及更早版本。](http://itunes.apple.com/us/app/console/id317676250?mt=8)

当 iOS 7 出来时，[它实际上停止了工作](https://stackoverflow.com/a/19045750/17152)。（它现在只能读取自己的控制台日志，而不是整个系统的日志。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-14T01:58:09.103

马克·诺瓦科夫斯基是对的。控制台输出记录在手机上，当您将 Mac 连接到手机时，控制台输出在管理器窗口中可用。

只需在设备面板中选择您的手机，然后选择控制台选项卡。最近的控制台输出就在那里。很酷。

我只是想通了。这在您描述需要远离计算机的情况下非常有帮助。

顺便说一句，我有一个解决方案来满足您测试弱 WiFi 信号的需求。只需将您的手机用铝箔包裹起来，USB 数据线从铝箔包装中伸出即可。如果您正在运行它，您可以单步执行调试器中的代码。您无法操纵用户界面，但可以降低/消除 3D、WiFi 和 GPS 等无线电信号。如果你想降低信号强度但又不想完全取消，你可能需要尝试用箔纸部分覆盖手机，在覆盖物上打小孔等。

一个警告：不要一次将手机用箔纸包裹超过几分钟。它可能会过热。

# multithreading - 在 Delphi 中实现 C# BackgroundWorker 的最佳方法是什么？

> ID：429210
> 
> 赞同：9
> 
> 时间：2009-01-09T18:43:19.370
> 
> 标签：multithreading, delphi

我经常使用 C# 的[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx "后台工作者")对象来启动线程并执行任务。在 Delphi 中完成同样事情的最简单方法是什么？

这是 C# 中的一些代码：

```
private void button1_Click(object sender, EventArgs e)
{
  BackgroundWorker bg = new BackgroundWorker();
  bg.DoWork += new DoWorkEventHandler(bg_DoWork);
  bg.RunWorkerCompleted += new RunWorkerCompletedEventHandler(bg_RunWorkerCompleted);
  test_number++;
  object[] arguments = { "test", test_number };
  bg.RunWorkerAsync(arguments);
}

void bg_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
{
      // done.
}

void bg_DoWork(object sender, DoWorkEventArgs e)
{
     // do actual work here
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-09T18:58:22.723

查看Primoz Gabrijelcic 的 OmniThreadLibrary 或[Andreas Hausladen 的](http://otl.17slon.com/)[AsyncCalls](http://andy.jgknet.de/blog/?page_id=100)，它们都应该为您提供类似的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-08T10:48:10.993

对于您的解决方案，这是：[delphi-components/backgroundworker](http://www.delphiarea.com/products/delphi-components/backgroundworker/ "这 （：")这个组件就像 c# backgroundworker 的事件、属性等。

# sharepoint - SharePoint“用户不存在或不是唯一的”错误，现场还原

> ID：429211
> 
> 赞同：1
> 
> 时间：2009-01-09T18:43:27.713
> 
> 标签：sharepoint

我们在开发服务器上备份了一个站点，并将其恢复到不同域的生产服务器。
为了清除站点上的所有用户，我们在我们的开发站点上为根 Web 上的所有用户使用了 web.SiteUsers.Remove()。
在使用 stsadm 进行备份并还原到生产服务器时，我们现在在失败的还原过程中收到错误“用户不存在或不是唯一的”（在 stsadm -o restore 命令本身）。
任何指向解决方案或我们做错了什么的指针都将受到欢迎。我们希望在恢复生产之前从网站集中删除用户。

亲切的问候，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T22:56:34.050

在安装报告服务时，我们遇到了与您的问题相反的问题。在 WSS_Content DB 下，一些表（我记得的 .AllLists、.Webs）具有引用我们的 .UserInfo 表中未在我们的域中退出的用户的条目。原来它是开发域中的用户。我们的 SQL 人员必须通过数据库将这些条目设置为域中确实存在的用户的 ID（警告！不支持！请参阅下面的更新！）。我敢打赌，您的站点备份有类似的引用，MOSS 试图在导入时枚举。这是使我们走上正确道路的链接：

[http://objectmix.com/sharepoint/298701-stsadm-export-user-cannot-found-zone-authentication.html](http://objectmix.com/sharepoint/298701-stsadm-export-user-cannot-found-zone-authentication.html)

更新（17APR09）：有人已经对作者检查/重置位进行了排序，而无需手动编辑数据库：

[http://blog.krichie.com/2008/09/12/resetting-the-author-on-a-sharepoint-site-or-wherefore-art-thou-author-redux/](http://blog.krichie.com/2008/09/12/resetting-the-author-on-a-sharepoint-site-or-wherefore-art-thou-author-redux/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-11T13:44:12.280

也许您可以使用`stsadm -o migrateuser`（[http://www.toddklindt.com/blog/Lists/Posts/Post.aspx?ID=75](http://www.toddklindt.com/blog/Lists/Posts/Post.aspx?ID=75)）或`stsadm -o deleteuser`在恢复之前使用？你可能想看看这个[参考](http://technet.microsoft.com/en-us/library/cc287951.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T03:45:15.833

如果您只是指 AD 用户，那么这个名为[Sharepoint AD Information Sync](http://www.boostsolutions.com/ad-sync.html)的工具可能会对您有所帮助。正如它的名字所说，它的同步功能很特别。

否则我宁愿闭嘴，因为我没有备份经验。

# asp.net - 为什么我的 ASP.NET 应用程序在迁移后崩溃了？

> ID：429216
> 
> 赞同：1
> 
> 时间：2009-01-09T18:44:39.943
> 
> 标签：asp.net, .net-3.5, .net-2.0, migration, windows-server-2008

我的 Web 应用程序在带有 .NET Framework 2.0 的 Windows Server 2003 中运行良好。当我使用 .NET Framework 3.5 迁移到 Windows Server 2008 时。

在两个服务器中运行相同的代码时，它们之间的区别如下：对于给定的异步 ASHX (IHttpAsyncHandler)，前一个服务器自动使用 Connection 和 Content-Length 标头响应请求。由于新服务器没有使用之前的代码自动生成这些标头，因此我必须手动更改代码以执行此操作，否则 Web 客户端无法确定响应的结束。

我的问题是，.NET Framework 3.5 不应该保持与.NET 2.0 的完全向后兼容性吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T18:46:14.120

将 ApplicationPool 模式设置为经典。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T18:51:01.943

问题不在于 .Net Framework，而在于 IIS7 和 IIS6 之间的不同。正如[leppie](https://stackoverflow.com/users/15541/leppie)所说，您需要将应用程序池设置为经典模式。

# mysql - ColdFusion 和从 MySQL 获取数据

> ID：429219
> 
> 赞同：4
> 
> 时间：2009-01-09T18:45:45.463
> 
> 标签：mysql, coldfusion

我在一个 CF 站点上工作，需要从 MySQL 表中获取数据。

我可以很好地创建 CFQuery 并检查返回的记录，但是如何获取返回的记录并循环遍历它们并从每一行的特定字段中获取数据。

我可以写 if/end if 等，我只是不记得如何访问数据。

-杰森

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-09T19:15:42.203

假设您使用 firstname 列进行了名为 the_query 的查询：

```
<cfoutput query="#the_query#">
   #firstName# ... etc <br>
</cfoutput> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-09T20:40:26.340

所有现有的答案/评论似乎都涉及不同的方面，因此这是一种尝试将所有这些信息整合到一个清晰的解释中。
（此答案设置为社区 wiki - 请酌情编辑。）

* * *

要从查询中访问变量，请使用：

```
QueryName.ColumnName[RowNum]
QueryName["ColumnName"][RowNum] 
```

这些都将在创建查询后的任何时候起作用。
两者都可以在内部使用`cfoutput`来显示变量，或者在内部`cfset`分配变量。

第二个对动态变量很有用，并且可以接受如下变量：

```
QueryName[DynamicColumnName][RowNum]
QueryName["Partial#DynamicName#"][RowNum]
QueryName["Partial"&DynamicName][RowNum] 
```

* * *

为方便起见，而不是手动循环查询：

```
<cfloop index="CurrentRow" from="1" to="#QueryName.RecordCount#">
    <cfoutput>#QueryName.ColumnName[CurrentRow]#</cfoutput>
</cfloop> 
```

你可以简单地做：

```
<cfloop query="QueryName">
    <cfoutput>#QueryName.ColumnName[CurrentRow]#</cfoutput>
</cfloop> 
```

作为进一步的捷径，您可以执行以下操作：

```
<cfoutput query="QueryName">
    #QueryName.ColumnName[CurrentRow]#
</cfoutput> 
```

而且，当在 a`<cfloop query="">`或 a中时，`<cfoutput query="">`您可以简单地执行以下操作：

```
<cfoutput query="QueryName">
    #ColumnName#
</cfoutput> 
```

但是，最后一个快捷方式仅用于显示 - 如果您这样做：

```
<cfset ColumnName = "NewValue" /> 
```

这不会修改原始查询数据。相反，您需要执行以下操作：

```
<cfset QueryName.ColumnName[CurrentRow] = "NewValue" /> 
```

这将修改查询的结果（但不会修改数据库中的值）。

* * *

要显示已运行的实际 SQL 查询，使用 CF8（也包括 Railo 和 OpenBD），您可以执行以下操作：

```
<cfdump var="#QueryName#"/> 
```

它将向您显示查询的结果和已运行的实际 SQL。

要使用 CF7 显示实际 SQL，您需要在标签中添加一个`result="QueryInfo"`，`cfquery`然后`<cfdump var="#QueryInfo#"/>`将显示 SQL。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-09T19:21:15.003

或者，您可以使用 CFLOOP 标签达到类似的效果

例如，假设您想对数量大于零的那些行的“价格”字段求和。（想象一个购物车）

```
<CFSET TOTAL=0>
<CFLOOP QUERY="the_query">
    <CFIF quantity gt 0>
        <CFSET TOTAL=TOTAL+PRICE>
    </CFIF>
</CFLOOP> 
```

顺便说一句，不鼓励在 CFOUTPUT Query 参数中使用井号/井号/八字

[编辑：] 要转储查询堆栈的内容，请在 "<!--- :: CFTimer :: --->" 行之前添加到 [cf_root]\wwwroot\WEB-INF\debug.cfm：

```
<CFIF IsDefined("DumpQueries") >
    <cfset DQ_Queries= QueryToArray( CFDEBUG_QUERIES ) />    
    <CFLOOP From="1" to ="#CFDEBUG_QUERIES.recordcount#" index="i">
        <CFSET DQ_Queries[i].BODY =  DQ_Queries[i].BODY >
        <CFSAVECONTENT Variable="dump_content">
        <CFDUMP Var="#DQ_Queries[i]#" Expand="NO" Label="#DQ_Queries[i].NAME#">
        </CFSAVECONTENT>
        <CFOUTPUT>#REReplaceNoCase(dump_content,"expand"">BODY</td>[[:space:]]*<TD>[[:space:]]*","expand"">BODY</td><td><PRE>")#</CFOUTPUT>     
    </CFLOOP>
</CFIF> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-09T19:30:42.330

有很多方法可以做到这一点。如上所述，您可以将 cfoutput 与查询属性一起使用。您还可以引用“queryname.columnname”。

如果您需要访问特定的行/列，可以使用数组表示法，如下所示：

```
queryname.columnname[rownum] 
```

（请记住，CF 从 1 开始计数，而不是 0）。对于动态列访问，您可以使用

```
queryname[columnvariable][rownum] 
```

如果您的列名是 CF 中的非法变量名（如 8thCol），您可以稍微修改一下：

```
queryname['8thCol'][rownum] 
```

希望有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T19:20:46.033

一旦在 CFQUERY 中定义了查询，就可以将结果放入 CFOUTPUT 标记中。您可以使用语法 #[query name].[field name]# 指定要显示的字段。

# c# - 捕获无关进程的输出

> ID：429225
> 
> 赞同：3
> 
> 时间：2009-01-09T18:47:03.823
> 
> 标签：c#

我只是想知道是否可以捕获在 Windows 上运行的单独进程的输出？

例如，如果我有一个控制台应用程序正在运行，我是否可以运行第二个应用程序，一个表单应用程序，并让该应用程序捕获控制台应用程序的输出并将其显示在文本框中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T19:13:45.720

如果您是启动进程的人，您可以重定向进程的标准输出/标准错误（标准输出/错误流）。举个例子看看[这个](http://channel9.msdn.com/forums/Coffeehouse/250664-C-Execute-External-App-and-capture-output/)。

捕获不是由您启动的进程的输出流，那是完全不同的事情。我不确定它是否可以完成。

但是如果你可以控制这两个应用的源代码，还有其他的通信方式，比如管道/远程处理/WCF，等等……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:14:57.713

你可以这样做：

```
 Process[] p = Process.GetProcessesByName("myprocess.exe");

    StreamReader sr = p[0].StandardOutput;

    while (sr.BaseStream.CanRead)
    {
        Console.WriteLine(sr.ReadLine());
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-04T22:50:16.080

选择的答案远非正确。首先 p[0].StandardOutput 已经是一个 StreamReader 其次，你不能读取其他进程的 StandardOutput，你会收到一个异常！

# seo - 编写可以切换为公共或私有的 SEO 友好页面

> ID：429245
> 
> 赞同：2
> 
> 时间：2009-01-09T18:51:51.660
> 
> 标签：seo

我们的应用程序希望能够基于用户个人资料信息创建静态的、可搜索的页面，这些页面可以链接到其他公共个人资料。

我以LinkedIn为例……似乎他们实际上将页面自动生成为可索引和可​​搜索的静态文件。

有人可以建议我们如何做到这一点吗？我认为需要有一个 cron 作业来运行并写入路径和文件名。

用户可能希望将整个页面保密，在这种情况下，我想它需要删除它。

有很多子要求，但这是一般概念，希望开始获得想法和反馈。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T18:58:17.280

如果您在创建/更新配置文件信息时或每当用户更改设置以保持信息公开/私密时实时生成静态页面，则可以不使用 cron 作业。这样，您就不会不断地循环遍历所有用户，也不会依赖另一个组件（您的 cron 作业）来运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:25:42.573

一种替代方法是采用明确的 RESTful 信息架构，以便配置文件资源（“页面”）可以通过永久 URL 进行寻址。生成的资源可能是静态页面。或不。这将是搜索引擎爬虫和任何访问资源的网络浏览器都看不到的实现细节。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T19:27:47.283

如果您不考虑与身份验证相关的问题或谁可以看到什么，那么 umnik700 的答案是相当死板的。考虑一下您在登录 Facebook 时看到的个人资料与那些相同个人资料的公开面向、可搜索的对应项之间的区别。即使是对搜索引擎隐私考虑较少的 MySpace，其可见性也取决于您与其他人的关系，默认情况下，对于私人个人资料，“此个人资料已被用户设置为私人”或某种程度.

如果您希望突然扩展一个社交工具，个人正在获取他们的个人信息，我会建议 umnik700 的答案（动态生成内容，而不是 URL，用于个人资料的公共版本），其推论如下：您需要能够支持从极其严格到完全开放的隐私偏好，并默认为至少在更严格、更私密的配置文件版本上出错的版本。如果您现在只是推出可搜索的个人内容，而以前从未有任何方法可以在网站之外找到它，那么重要的是不要滥用以不同借口提供的信息。

我知道这可能需要比您希望该项目需要的更多可扩展性和附加功能，但否则很可能会被视为违反您的用户群的默认信任。无论如何，做到这一点的最佳策略可能会要求您更多地依赖您的数据库，因此可能是时候重新设计它了——包括添加一些隐私偏好。

# selenium - Selenium：如何使用 javascript 从表单字段中清除值？

> ID：429251
> 
> 赞同：2
> 
> 时间：2009-01-09T18:52:55.463
> 
> 标签：selenium, fixtures, fitnesse, selenium-fitnesse-bridge

我正在使用 selenium IDE 和 Selenium-Fitnesse Bridge 夹具，我正在尝试测试当我从表单字段中清除默认值时，我的表单会显示一条错误消息。

因此，当我使用 Selenium IDE 进行录制时，它所做的就相当于告诉 Selenium 什么都不输入。

```
| 类型 | 文本字段 | |
```

问题在于我正在使用的 Fitnesse 夹具期望第二个参数不为空。

Selenium 有没有办法“清除值”而不是“不输入任何内容”？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T19:05:39.760

您可以通过 javascript 执行此操作：

```
| verifyEval | javascript{this.browserbot.getCurrentWindow().document.getElementById('CONTROL_ID').value = ''} || 
```

有效地，verifyEval 语句允许您执行任何您想要的 javascript。使使用 Selenium 完成的一些难题变得更加简单。

我使用[本教程](http://www.theautomatedtester.co.uk/seleniumtraining/Selenium_JavaScript.htm)（今天信不信由你）来解决问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T23:24:39.323

我用它来让它工作。`reg_start_date`是我的输入字段的 id。

```
| storeEval | window.document.getElementById('reg_start_date').value = '' | 
```

从硒参考：

> 请注意，默认情况下，代码片段将在“selenium”对象本身的上下文中运行，因此`this`将引用 Selenium 对象。用于`window`引用应用程序的窗口，例如`window.document.getElementById('foo')`

此外，请避免使用 javascript{} 包装 javascript 代码，它不会起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-27T11:49:08.530

我们一开始也有这个问题。尝试：| 类型 | 文本字段 | 空白 |

查找有关使用空白和 null 的 Fitnesse 文档的更多信息。

:)

# perl - 如何在长时间运行的 Perl 程序中找到内存泄漏？

> ID：429254
> 
> 赞同：39
> 
> 时间：2009-01-09T18:53:42.297
> 
> 标签：perl, memory-leaks, garbage-collection

Perl 对 GC 使用引用计数，很容易意外地进行循环引用。我看到我的程序似乎正在使用越来越多的内存，并且可能会在几天后溢出。

有没有办法在 Perl 中调试内存泄漏？附加到程序并获取各种类型的对象将是一个好的开始。如果我知道哪些对象比预期的多得多，我可以检查对它们的所有引用并希望修复泄漏。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-09T19:21:30.897

*Perl永远不会*自己将内存还给系统可能是相关的：这完全取决于`malloc()`与此相关的所有规则。

了解如何`malloc()`分配内存对于回答更大的问题很重要，并且它因系统而异，但通常大多数`malloc()`实现都针对程序按堆栈顺序分配和释放进行了优化。Perl 使用引用计数来跟踪内存，这意味着释放意味着（与`malloc()`在下面使用的基于 GC 的语言不同）实际上并不难*判断*释放将在哪里发生以及以什么顺序发生。

可能你可以重新组织你的程序以利用这个事实——通过`undef($old_object)`显式调用——并以正确的顺序，以类似于 C 程序员所说的方式`free(old_object);`

对于长时间运行的程序（几天、几个月等），我有大量的加载/复制/转储周期，我使用垃圾收集`exit() and exec()`，而在其他范围内不可行的地方，我只是打包我的数据结构（使用`Storable`）和文件描述符（使用`$^F`）和`exec($0)`- 通常设置一个类似的环境变量，*即使您自己没有任何泄漏，您*`$ENV{EXEC_GC_MODE}`也可能需要类似的东西，因为 Perl 正在泄漏您的系统无法弄清楚如何回馈的小块.*`malloc()`*

 *当然，如果您的代码确实存在泄漏*，*那么我的其余建议会更相关。它最初发布[到关于这个主题的另一个问题](https://stackoverflow.com/questions/295385/are-there-any-tools-for-finding-memory-leaks-in-my-perl-program#295461)，但它没有*明确*涵盖长期运行的程序。

* * *

所有 perl 程序内存泄漏要么是一个持有引用的 XS，要么是一个循环数据结构。[如果您知道哪些结构可能包含循环，则Devel::Cycle](http://search.cpan.org/dist/Devel-Cycle/)是查找循环引用的好工具。[Devel::Peek](http://search.cpan.org/dist/Devel-Peek/)可用于查找引用计数高于预期的对象。

如果您不知道该去哪里寻找，[Devel::LeakTrace::Fast](http://search.cpan.org/dist/Devel-LeakTrace-Fast/)可能是一个不错的选择，但您需要一个为调试而构建的 perl。

如果您怀疑泄漏在 XS 空间内，那就更难了，而[Valgrind](http://valgrind.org/)可能是您最好的选择。[Test::Valgrind](http://search.cpan.org/dist/Test-Valgrind/)可能会帮助您减少需要搜索的代码量，但这在 Windows 上不起作用，因此您必须将（至少是泄漏的部分）移植到 Linux 才能做到这一点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T23:20:12.010

[Devel::Gladiator](http://p3rl.org/Devel::Gladiator)是该领域的另一个有用工具。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-09T19:00:27.133

似乎 cpan 模块[Devel::Cycle](http://search.cpan.org/~lds/Devel-Cycle-1.10/lib/Devel/Cycle.pm)是您正在寻找的。它需要对您的代码进行一些更改，但它应该可以帮助您找到参考资料而不会出现太多问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-09T19:14:03.317

[valgrind](http://valgrind.org/)是一个很棒的 linux 应用程序，它可以定位运行代码中的内存泄漏。如果您的 Perl 代码在 linux 上运行，您应该检查一下。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-07-20T11:37:22.657

除了其他评论之外，您可能会发现我在 LPW2013 上的[Perl Memory Use 演讲很有用。](http://www.slideshare.net/Tim.Bunce/perl-memory-use-lpw2013)我建议观看[截屏视频](https://archive.org/details/Perl-Memory-Profiling-LPW2013)，因为它解释了幻灯片，最后有一些可爱的视觉效果和一些问答。

我还建议查看我在演讲中提到的 Paul Evans [Devel::MAT](https://metacpan.org/pod/Devel::MAT)模块。

# .net - 如何管理 FxCop 压倒性的报告

> ID：429255
> 
> 赞同：10
> 
> 时间：2009-01-09T18:53:59.923
> 
> 标签：.net, coding-style, fxcop

我最近开始使用它。但是，在针对我公司最大的项目之一运行它之后。它出现了堆积如山的问题。

问题列表如此之多，如果不是全部的话，需要几天的时间才能找到并解决一些问题。

现在，我知道修复 FxCop 告诉您修复的所有内容并不是很实际。但是因为我是这个小工具的新手......

**有效使用 FxCop 有哪些好的提示和技巧？**

在新项目和现有项目上？

如果还提供我公司的程序员通常会写好代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T19:01:36.133

起初，您可以从一小组规则开始。然后增加您应用的规则数量。

你也必须看看[这个](https://stackoverflow.com/questions/27009/how-does-one-implement-fxcop-static-analysis-on-an-existing-code-base)问题的答案......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T18:56:00.933

通过运行一次 fxCop 并排除它找到的所有内容来创建基线。

将此保存为 .fxcop 文件并使用它来运行未来的检查。

然后，当您对代码进行更改时，您将创建新的、可管理的违规行为。例如，如果您更改方法的签名，FxCop 将重新标记事物。

如果您有时间，您可以通过取消排除它们来一次解决一类违规行为。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-09T20:04:27.740

绝对过滤掉对您的组织不重要的那些。例如，整个国际化块对于我们的一个项目在很大程度上并不重要，因此我们只是将其排除在外，仅此一项就足以使列表易于管理。（在那个区块中有一些我们想要实施的很棒的建议，但它们当时对应用程序并不重要。）

您还可以创建一些 FxCop 项目，将异常分组，直到将数量减少到可管理的程度（“立即修复这些问题”、“尽快修复这些问题”、“随时修复这些问题”）。

我很确定我花了整整一周的时间排除/包括违规行为，直到我们有一个适合我们政策的列表。然后另一个 2-3 只是修复违规行为。:-(

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T01:24:44.833

FxCop 的特点是，它是*针对特定用例设计*的出色工具。它旨在帮助类库开发人员。因此，如果您是 Developer Express 或 Infragistics，并且您正在创建一个供全球开发人员使用的代码库，那么您需要良好的命名、良好的全球化和许多其他的东西。

因此，如果您将所有表单命名为 frmMain，FxCop 会抱怨，因为这在类库中看起来很难看。但是，如果您只是在开发内部 WinForms 应用程序，则不必在意。同样，您会为有关 IFormatProvider、指定文本方向的 MessageBox 重载等所有内容而发疯。但除非您正在为全球受众创建代码，否则您可以忽略这些。

重要的是要了解 FxCop 的目标受众。您可以根据您与该受众不同的方式忽略某些建议。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-09T19:07:56.743

按规则类型对输出进行排序...然后通过排序列表查看损坏的规则类型的哪个子集是重要的并且值得修复 IYO。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-09T19:13:04.223

并非 fxCop 报告的所有问题都是“必须解决”的问题。例如，使用字符串连接将用户输入插入数据库命令比匈牙利语或捕获异常等样式问题要糟糕得多，而不是更具体的异常。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-19T12:36:53.373

FxCop 的替代方法是使用工具[NDepend](http://www.ndepend.com/)。该工具允许**在 C# LINQ 查询**（我们称之为[CQLinq](http://www.ndepend.com/Features.aspx#CQL)）上编写代码规则。*免责声明：我是该工具的开发人员之一*

默认提出超过[200 条代码规则。](http://www.ndepend.com/DefaultRules/webframe.html)*借助众所周知的*C# LINQ 语法，自定义现有规则或创建自己的规则非常简单。

*为了保持低误报的数量*（即**避免过多的报告**），CQLinq 提供了独特的功能，通过以 notmycode 为前缀的特殊代码查询来**定义**JustMyCode**集合**。有关此功能的更多说明，请参见[此处](http://www.ndepend.com/Doc_CQLinq_Syntax.aspx#NotMyCode)。例如，这里有两个*notmycode*默认查询：

 ****   [丢弃 JustMyCode 中生成的和设计器的方法](http://www.ndepend.com/DefaultRules/webframe.html?Q_Discard_generated_and_designer_Methods_from_JustMyCode.html)
*   [丢弃 JustMyCode 生成的类型](http://www.ndepend.com/DefaultRules/webframe.html?Q_Discard_generated_Types_from_JustMyCode.html)

*为了保持低误报的数量*，使用 CQLinq，您还可以将规则结果集中在添加的代码或重构的代码上，因为[过去定义了基线](http://www.ndepend.com/Doc_CI_Diff.aspx)。请参阅以下规则，该规则检测自基线以来添加或重构的过于复杂的方法：

```
warnif count > 0 
from m in Methods
where m.CyclomaticComplexity > 20 &&
      m.WasAdded() || m.CodeWasChanged()
select new { m, m.CyclomaticComplexity } 
```

最后，请注意，使用 NDepend 代码规则可以[在 Visual Studio 中实时](http://www.ndepend.com/Doc_VS_CQL.aspx)验证，并在构建过程中，在[生成的 HTML+javascript 报告](http://www.ndepend.com/Doc_CI_Report.aspx#CQLRule)中进行验证。

# delphi - 为什么我的单位是“用不同版本编译的”我自己的文件？

> ID：429275
> 
> 赞同：12
> 
> 时间：2009-01-09T19:01:06.227
> 
> 标签：delphi, compiler-construction, delphi-2009, delphi-units

我正在构建一个使用插件的程序。不幸的是，插件框架的动态链接迫使 RTL 和 VCL 从我的项目 EXE 中退出并进入 BPL 版本，并且它们没有启用调试信息。

所以我构建了一个静态链接到我的插件的测试框架，这样我就可以在跟踪代码时实际看到我在做什么。但是现在，每次我尝试重新编译时，都会出现错误：“unit turbu_skills was compiled with a different version of turbu_database.GDatabase”

我以前见过这个错误，但只有当我一直在改变我可能不应该改变的东西时，比如 RTL 或 VCL 库。我不明白为什么它用我自己的代码来做。turbu_skills 和 turbu_database 单元都是我自己编写的单元。GDatabase 是一个全局单例变量，它的类定义我已经好几周没有改变了。任何触发重新编译的更改都会导致此错误，即使我没有触及任何一个单元中的任何内容。

执行完整构建 (SHIFT-F9) 会使其正确编译。但是，如果我在一个单位（*任何单位）中按***空格**键并按F9，我会再次收到错误消息。发生了什么事，我该如何阻止它？这不会发生在主应用程序中，只会发生在测试框架中。

 *编辑：我有我所有单位的来源。删除 DCU 和类似文件无济于事。将整个项目复制到另一台计算机，删除所有 DCU 并在那里构建没有帮助。我的程序布局和编译器之间存在客观的、可重现的冲突，我想摆脱它。

如果有人想测试它，可以在[http://www.turbu-rpg.com/downloads/Turbu_source_setup.exe找到源代码。](http://www.turbu-rpg.com/downloads/Turbu_source_setup.exe)它需要已安装 JVCL 的 Delphi 2009；安装程序包将负责其余的工作。也许拥有可用的源代码将帮助某人追踪这一点。我当然希望如此，因为无论问题在哪里，它都超出了我的范围。该问题可以在 testing.exe 和 turbu.groupproj 的 turbu.exe 中找到。

编辑 2：原来这是另一个跨单元泛型问题。Grr。我设法编写了一个解决方法。我只是希望他们能尽快解决泛型问题。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-09T19:52:35.360

错误“单元是用不同版本的...编译的”是一个烦人的错误。它发生在如下情况：

```
 +--------+
     | unit A |
     +--------+
      |      |
      |      |
      V      |
  +--------+ |
  | unit B | |
  +--------+ |
      |      |
      |      |
      V      V
     +--------+
     | unit C |
     +--------+ 
```

单元 A 和 B 都使用单元 C，单元 B 使用 C。单元 B 和 C 已编译，由于某种原因，单元 B 的源代码不可用。现在单元 C 已更改（任何更改都可以并重新编译）并且单元 C 的 dcu 与单元 B 使用的单元 C 不同，因此单元 B 也需要重新编译。但不幸的是，源代码不可用，所以编译器放弃了。

目前尚不完全清楚您的情况有什么问题。

您有一个链接到插件的测试框架。那么单元 X 和 Y 适合在哪里，您是否识别出上面显示的模式？

但一个完整的构建解决了这个问题的事实暗示了这个方向。这不是我第一次看到部分重新编译的问题。所以我总是使用完整版。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T00:49:55.087

我讨厌这个问题。我发现它时不时会弹出，尽管在您的情况下听起来与您使用插件所做的事情直接相关，但我过去通过查找和删除软件包的所有 dcus、bpls 和 dcps 解决了这个问题我们已经编写然后重建包。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-10-19T18:54:06.313

我如何解决 Delphi XE7 中的“路径疯狂”：

```
 Rule1: Always separate the DCU from the PAS files

  Tools -> Option -> Library path: 
                 Path to global (3rd party) libraries (DCU folder) that never change.

                    c:\Delphi\Tools\FastMM\
                    c:\MyProjects\Packages\Third party packages\$(Platform)
                    c:\MyProjects\Packages\DragDrop\$(Platform)
                    c:\MyProjects\Packages\Graphics32\$(Platform)

  Project -> Options -> Search path: 
                 Path to personal libraries, that changes often. 
                 Enter the path to the DCU folder first, then path to PAS file. 
                 This way, the compiler will use the DCU files first, instead of recomilin every time from PAS files. 
                 It will recompile anyway if you do a Build.

                    c:\MyProjects\Packages\cCommonControls\$(Platform)_$(Config)
                    c:\MyProjects\Packages\cCommonControls\

  Project -> Options -> Output directory: 
                 Leave it empty so the exe file is generated in project's folder 

  Project -> Options -> DCU output directory: 
                 Use .\$(Platform)_$(Config) in order to enforce Rule1 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-02T21:35:03.947

当我忘记根据需要将 DPK Build**控件**从**Rebuild**更改为在**Options...|Description中****显式重建**时，这种情况经常发生在我身上。

 *** * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-21T00:10:22.020

为了将来参考，只需将编译器指向“问题单元”的源代码版本即可为我解决此问题（即将包含源代码的文件夹添加到搜索路径）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-10T11:06:36.793

检查您在源目录中的某处没有紧张的旧 dcu 文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-02T21:08:01.837

就我而言，我将“问题”单元的位置添加到项目的搜索路径中。只要它可以找到它，它就会编译。当然，如果您有多个版本的文件，这可能会使事情复杂化......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-28T00:13:56.733

1.  您的实际 .dpr 文件包含对不正确版本的 .pas 文件的引用。

    查看 > 项目管理器 > 展开树并检查所有单元的路径。

2.  搜索路径列表中有重复文件，先找到不正确的版本

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-18T06:29:15.777

编译器肯定有问题。我发现在 uses 子句中更改单元的顺序将允许您获得“一次免费编译”。之后，错误再次发生，您将重新进行重建。:-(

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-12T17:05:34.557

您使用的是修改后的 VCL 吗？您在界面部分中引用的单位也决定了您的界面。我建议确保您的项目中没有可能引用相同名称（包括 VCL/RTL）的任何单元的两个不同版本。也许这是一件愚蠢的事情，因为后台编译使用的单元版本与磁盘编译不同。所以编辑它会触发后台编译器，然后会打乱同步。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-01-04T08:00:57.950

对我来说，问题是我安装了 Delphi 所需的最少组件。当我打开一个使用完整的 Delphi 安装编译的项目时，它发生在我身上。使用完整的 Delphi 安装从另一台机器处理 Delphi 安装文件夹中“Source”文件夹中的文件解决了我的问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-09-02T19:04:14.577

Unit ppParameter 是使用不同版本的 ppRelatv 编译的。Tpp相对：

删除程序文件夹/计算机中的所有 .dcu，然后重新编译或重新构建。然后您的程序将再次运行良好。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-01-13T18:30:39.943

我的案例和解决方案：

*   我们有一个构建 exe 文件的主应用程序和
*   一些为此 exe 构建 dll 文件的插件项目
    （dll 项目还需要一些应用程序源文件）

有时在编译 dll 文件时会出现“使用不同版本编译”的问题

问题是这样的：

*   exe 项目被设置为在一个单独的目录中创建它的所有 dcu 文件：例如`App\DCUs`
*   dll 项目在搜索路径中有这个 DCUs 目录，但也有一些应用程序的源目录：例如`App\Utils`、`App\Core`等。
*   因此，当您编译 dll 项目时，再次编译了一些应用程序源文件（现在可能使用不同版本的其他依赖项）：
    我们最终得到了同一`*.pas`文件的 2 个不同 dcu

`App\DCUs`解决方案很简单：从 dll 项目的搜索路径中删除目录。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-03-06T09:21:40.893

我刚刚在 Delphi XE 中收到了相同的错误消息。关闭Delphi，再次打开并重新编译我的项目后，我的问题就解决了。

# c# - .NET 的断开式架构

> ID：429281
> 
> 赞同：0
> 
> 时间：2009-01-09T19:04:46.627
> 
> 标签：c#, .net, architecture

我正在使用 WinForm 和 WCF 处理 n 层应用程序

引擎服务（Windows 服务） => WCF 服务 => Windows 窗体客户端应用程序

问题是即使引擎服务关闭，WinForm 客户端应用程序也需要 100% 可用。

那么，我怎样才能建立一个断开连接的架构，以使我的 winform 应用程序始终可用？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T19:08:49.567

通常，您实现应用程序内部的队列。

队列会将请求转发到 Web 服务。如果 Web 服务关闭，它会保持排队状态。队列机制应该经常检查 Web 服务是否处于活动状态，然后转发它存储的所有内容。

或者，您可以直接访问 Web 服务，然后在初始失败时将其发布到队列中。但是，队列仍然需要每隔一段时间检查 Web 服务。

**编辑：** 澄清一下，是的，所有业务逻辑都需要在客户端可用。否则，您需要在客户端连接备份时提供“验证”机制。

然而，这并不是一件坏事。因为无论如何您都应该将业务逻辑放在它自己的程序集中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:10:47.427

看看智能客户端工厂：http: [//msdn.microsoft.com/en-us/library/aa480482.aspx](http://msdn.microsoft.com/en-us/library/aa480482.aspx)

只是为了突出目标（这是从上面的链接中截取的）：

*   它们具有丰富的用户界面，可以利用 Microsoft Windows 桌面的强大功能。
*   它们连接到多个后端系统以与它们交换数据。
*   它们通过集成的用户界面呈现来自多个不同来源的信息，因此数据看起来像是来自一个后端系统。
*   **它们利用本地存储和处理资源在无网络连接或间歇性网络连接期间启用操作。**
*   它们很容易部署和配置。

# 编辑

我会用通常的 CYA 声明来回答这个问题，这真的取决于。让我给你一些例子。以一个应用程序为例，它会监视文件系统以查找以任意数量的不同格式（DB2、Flatfile、xml）生成的文件。然后应用程序将导入文件，向用户显示文档的统一视图。并允许他下电子商务订单。

在这个应用程序中，您可以选择检测压缩文件并上传到服务器进行转换（应用数据规范化等业务逻辑）。但是，如果互联网连接中断，会发生什么。现在用户必须等待他的连接才能下他的电子商务订单。

更好的解决方案是在转换文件的客户端中运行业务规则。现在假设，您有一些业务逻辑，这些逻辑将基于订单确定其他规则，例如将其路由到的销售人员或定价折扣......这些可能放在服务器上是有意义的。

您需要问的问题是，当服务器不存在时，我需要什么功能才能使我的应用程序正常运行。属于此类别的任何事物都需要成为客户端。

我也从未使用过 Click Once 部署，我们不得不推出我们自己的更新程序，这是另一个线程的故事，但您应该能够轻松地发送更新。您还可以在从 URL 加载的程序集中对业务逻辑进行编码，以便在客户端运行时轻松更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T19:28:02.070

您可以离线进行所有处理，并使用[Microsoft Sync Framework](http://msdn.microsoft.com/en-us/sync/default.aspx)之类的东西在客户端和服务器之间同步数据。

假设服务器和客户端都是.net，您可以使用相同的代码库在服务器和客户端上进行数据验证。这样，您将拥有一个同时服务于服务器和客户端的代码库。

您可以使用[CSLA.NET](http://www.lhotka.net/cslanet/)等框架来简化此验证过程。

# web-services - 如何将身份验证密钥传递给 RESTful Web 服务？

> ID：429302
> 
> 赞同：1
> 
> 时间：2009-01-09T19:11:09.717
> 
> 标签：web-services, authentication, rest

我使用的一些现有 Web 服务具有如下所示的方法：

```
List<Employee> employees = 
        employeeService.GetEmployees(accessKey, allDepartments); 
```

accessKey 有两个用途；它既是身份验证又是识别。只有有效的访问代码才会得到响应（身份验证），并且它作为指向特定客户数据的链接服务。

如果要以宁静的方式完成服务，我不确定如何实现。我绝对不想做这样的事情：

```
http://www.business.com/<GuidHere>/Employees/ 
```

因为这会显示 accessKey，这有点秘密，（即，它通常在使用它的客户端上的加密文件中）我们不能在 URI 中显示 GUID。使用宁静的架构如何实现这样的事情？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-09T19:14:24.970

您可以使用 HTTP 标头发送身份验证令牌。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:30:54.233

如果这是一个 RESTful *Web 服务*，我假设它正在被机器使用，那么为什么不在 url 中传递访问密钥呢？

在一天结束时，您需要将其放在某个地方并将它们隐藏在浏览器中的隐藏表单字段中（如果该服务是可浏览的）并没有太大的安全性。

如果密钥如此敏感，为什么不在每个会话的服务器上对称加密并传递该值呢？

只是一些想法。
凯夫

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T21:42:28.213

If time isn't an issue implementing OAuth security may be useful. OAuth uses a public key, and also a secret. The mess is hashed (in most cases) and the server will use the public key + it's copy of the secret to do the same hashing and make sure its result matches the requests.

The benefit is you wouldn't need to use HTTPS or POST. Get* REST api methods should be using the HTTP GET method (I'm not sure if being RESTful is your goal, just thought I would point that out). I agree with Mr. Pang, use [http://www.business.com/employees](http://www.business.com/employees). The query string could contain the list of department ids.

For your case the service call wouldn't have the 'accessKey' argument, rather it would become the public key (I imagine) and be used in either the headers, query string, or as a POST param.

Some good info on OAuth: [http://www.hueniverse.com/hueniverse/](http://www.hueniverse.com/hueniverse/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T19:21:47.123

正如特洛伊奥尔福德指出的那样，我最初的建议是不正确的。在这种情况下，您不应该使用 POST。您应该使用带有 HTTP 标头中的身份验证信息的 GET 请求。查看[基本访问身份验证](http://en.wikipedia.org/wiki/Basic_access_authentication)的一种方法。

# c++ - 引用了未解析的外部符号 CompleteAuthToken

> ID：429322
> 
> 赞同：1
> 
> 时间：2009-01-09T19:15:46.730
> 
> 标签：c++, windows-mobile, sspi

在将桌面应用程序移植到 windows mobile 时，我遇到了以下错误：

> 错误 LNK2019：函数中引用了无法解析的外部符号 CompleteAuthToken

阅读 MSDN 它告诉我，Windows CE 2.10 及更高版本支持 CompleteAuthToken，我应该链接到 Secur32.lib，但添加该库并不能修复未解决的符号错误。有任何想法吗？

注意：我使用的是 Visual Studio 2008 + Windows Mobile 6.0 SDK。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T21:52:16.243

我认为 MSDN 文档是错误的。查看 Platform Builder 源代码，我看到 CompleteAuthToken() 在 schannel.def 中，并且它内置在 schannel.lib 中，而不是 secure32.lib 中。看看做出这种改变是否有帮助。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-09T19:44:13.567

您是否包含 Security.h？

[http://msdn.microsoft.com/en-us/library/aa374764(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa374764(VS.85).aspx)

# css - 带尾巴的推拉门

> ID：429325
> 
> 赞同：1
> 
> 时间：2009-01-09T19:16:41.190
> 
> 标签：css

我有一个`<H2>`带有圆角的背景。我正在寻找一种方法来创建一条`1px`从盒子移动到右侧容器末端的线。有人有想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T19:39:06.777

好吧，我终于放弃了，在我的 h2 中插入了一些 div。:(

**CSS**

```
#内容h2 {
    背景： url(../images/bg-page-title.png) -900px 0px 无重复；
    字体：1.4em Georgia、Times、Arial 粗体；
    高度：40px；
    边距：0px 20px；
    文本转换：大写；
}

#内容h2 .head {
    背景：url(../images/bg-page-title.png) 不重复；
    向左飘浮;
    填充：8px 20px；
    高度：100%；
}

#内容 h2 .tail {
    背景： url(../images/bg-page-title.png) -857px 0px 无重复 #ffffff;
    向左飘浮;
    高度：100%；
    宽度：15px；
}
```

**HTML**

```
<h2>
    <div class="head">找工作</div>
    <div class="tail"> </div>
</h2>
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T19:22:41.537

在背景图像中包含线条

# c# - 如何在 Visual Studio 2008 中使用 c# 为其他窗口创建工作区窗口？

> ID：429330
> 
> 赞同：0
> 
> 时间：2009-01-09T19:17:53.107
> 
> 标签：c#, visual-studio, layout

我想创建一个带有状态栏和菜单的工作区，并且在这个工作区容器内有各种类型的较小窗口。

例如，如果您在 Excel 中取消最大化工作表而不是主窗口，则它会成为更大工作区中的一个窗口。

我试过搜索结果，但主要问题是知道正确的术语。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T19:20:16.033

您想要一个 MDI（多文档界面）表单

只需将主窗体的 IsMdiContainer 属性设置为 True，您应该能够将其他窗体添加为 mdi 子窗体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:23:04.593

检查 MDI 编程。这是几个链接

[创建 MDI 应用程序 (CodeProject)](http://www.codeproject.com/KB/cs/myBestMDI.aspx)

[用 C# 开发 MDI 应用程序 (C-Sharp Corner)](http://www.c-sharpcorner.com/UploadFile/ggaganesh/DevelopingMDIAppplicationsinCSharp11272005225843PM/DevelopingMDIAppplicationsinCSharp.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T19:29:54.720

在 Windows 窗体窗体上，有 IsMdiContainer 属性。设置将使表单成为 MDI（多文档界面）父级。任何您想显示为父窗口的子窗口，只需将 MdiParent 设置为您将 IsMdiContainer 设置为 true 的表单。请注意 WPF 不支持 MDI。一个建议可能是尝试一个选项卡式界面，就像许多 Web 浏览器在您使用 WPF（或者即使您不是）时使用的那样。

顺便说一句，Excel 不再那样工作了，我相信微软几乎已经放弃了 MDI。仅供参考。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T19:33:55.973

该“工作区”将是普通的 Form 实例，其 IsMdiContainer 属性设置为“true”，所有内部窗口（Form 类的其他实例）必须将其 MdiParent 属性设置为该外部表单。您可以添加状态栏和菜单（与任何其他控件一样），就像对任何其他表单执行此操作一样。

MSDN 中的“Form.IsMdiContainer Property”文章有很好的例子来说明如何使用它。

# asp.net - 如何将 ASP.NET 查询字符串值传递到 silverlight 2 控件？

> ID：429334
> 
> 赞同：0
> 
> 时间：2009-01-09T19:20:12.647
> 
> 标签：asp.net, silverlight, silverlight-2.0

我有一个 ASP.NET 页面。我想要做的是传入查询字符串中的 ID 字段。

所以如果我的页面是

[http://www.mysite.com/default.aspx?id=35](http://www.mysite.com/default.aspx?id=35)

我希望此页面上的 silverlight 控件可以访问 id 字段。我的 silverlight 控件将获取网格的数据，它需要使用 id。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T20:07:38.903

您可以使用 HTML DOM Bridge 来做到这一点：

```
using System.Windows.Browser;

string queryString = HtmlPage.Document.DocumentUri.Query; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T20:54:56.623

虽然这涵盖了启动参数中的概念（这可能是您正在做的事情），但这里有一个关于它的演练。[http://silverlight.net/learn/learnvideo.aspx?video=72312](http://silverlight.net/learn/learnvideo.aspx?video=72312)

# java - 调整 TYPE_CUSTOM BufferedImages 的大小？

> ID：429337
> 
> 赞同：3
> 
> 时间：2009-01-09T19:21:09.790
> 
> 标签：java, bufferedimage

当我从磁盘读取 JPEG 文件时，Java 有时会给我一个 BufferedImage，它的 getType() 返回 TYPE_CUSTOM——也就是说，它有一个自定义颜色模型。我想调整这个 BufferedImage 的大小，但我不确定如何构造目标对象。有人可以提供使用以下构造函数的示例代码吗？

[BufferedImage(ColorModel cm, WritableRaster raster, boolean isRasterPremultiplied, Hashtable 属性)](http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html#BufferedImage(java.awt.image.ColorModel,%20java.awt.image.WritableRaster,%20boolean,%20java.util.Hashtable))

我想创建一个与源相同类型的 BufferedImage，只是更大，然后将内容传输过来。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T19:54:54.590

回答我自己的问题，看起来[ImageTypeSpecifier](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageTypeSpecifier.html)就是答案。具体来说：

1.  调用[ImageTypeSpecifier.createFromRenderedImage(RenderedImage image)](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageTypeSpecifier.html#createFromRenderedImage(java.awt.image.RenderedImage))`ImageTypeSpecifier`以使用自定义颜色模型从图像中取回一个。
2.  在步骤 1 中调用[ImageTypeSpecifier.createBufferedImage(int width, int height)](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageTypeSpecifier.html#createBufferedImage(int,%20int))`ImageTypeSpecifier`以创建与原始图像具有相同颜色模型的新图像。

# flash - 跟踪 Flash 广告的点击次数

> ID：429350
> 
> 赞同：2
> 
> 时间：2009-01-09T19:23:59.787
> 
> 标签：flash

当网站有第三方 Flash 广告时，网站是否可以跟踪 Flash 的点击？由于 Flash 文件不是由站点创建的，因此无法更改。但该网站希望确认广告代理商通过自己的点击跟踪报告的点击次数。

附加到对象或嵌入标签的 JavaScript onclick（或其他鼠标事件）不起作用。

我最近尝试的是在 flash 上放置一个浮动的不可见 div 并将 click 事件附加到它上面。但是，这在 IE 中效果不佳。

我正在考虑的另一种方法是使用我自己的 Flash 加载程序 SWF。新的 SWF 会将广告 SWF 文件加载为它显示的电影。然后，每当点击发生时，加载程序 flash 就会触发我的点击跟踪 JS，然后允许点击事件继续到广告 flash。这听起来可能/可行吗？

**附录：**关于加载器方法我有两个问题：
1）域example.com的flash可以从ads.mordor.com加载swf文件吗？
2) 可以在另一个 swf 中加载的 swf 都获得点击事件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T19:40:20.797

你的装载机技术似乎是最理智的。好处之一是，您可以使其通用，以便它可以加载您想要的任何广告，页面上的实例数量可以根据需要进行，同时始终产生相同的点击数据。这简化了捕获不同 Flash 广告有时会产生的多种点击数据的需要。

这是我开始工作的一些代码，对于大片段提前抱歉。

**ImportMe.as**（在舞台上有一个名为 myButton 的按钮实例）

```
package
{
    import flash.display.MovieClip;
    import flash.display.SimpleButton;
    import flash.events.MouseEvent;

    public class ImportMe extends MovieClip
    {
        public function ImportMe()
        {
            myButton.addEventListener(MouseEvent.CLICK, button_OnClick);
        }

        private function button_OnClick(event:MouseEvent):void
        {
            // shifts the button right 10 pixels to prove the event fired
            myButton.x += 10;
        }
    }
} 
```

**Tester.as**（加载之前代码生成的 ImportMe.swf 剪辑）

```
package
{
    import flash.display.MovieClip;
    import flash.display.Loader;
    import flash.net.URLRequest;
    import flash.events.*;

    public class Tester extends MovieClip
    {
        public function Tester()
        {
            var request:URLRequest = new URLRequest("importme.swf");
            var loader:Loader = new Loader();
            loader.addEventListener(Event.COMPLETE, loader_OnComplete);
            loader.addEventListener(MouseEvent.CLICK, loader_OnClick);
            loader.load(request);
            addChild(loader);
        }

        private function loader_OnComplete(event:Event):void
        {
            trace("loaded");
        }

        private function loader_OnClick(event:MouseEvent):void
        {
            trace("clicked");
        }
    }
} 
```

这个例子唯一没有测试的是外部事件是否会在内部剪辑执行 url 重定向之前触发。

# .net - 如何将命令行参数传递给 ClickOnce 应用程序？

> ID：429351
> 
> 赞同：24
> 
> 时间：2009-01-09T19:24:37.973
> 
> 标签：.net, clickonce

我有一个从开始菜单（本地）启动的 Clickonce 应用程序。我希望能够指定一个参数，以便应用程序可以加载某些数据。该应用程序存在于文件共享中，并且仅使用 URL 启动一次（如[MSDN 上所述](http://msdn.microsoft.com/en-us/library/ms172242(VS.80).aspx)）。这意味着此链接中描述的方法将不起作用；用户将使用开始菜单中的 .appref-ms 快捷方式启动应用程序。

我一直无法找到解决方案。是否有可能以某种方式将参数传递给单击一次应用程序？如果是这样，怎么做？如果没有，有哪些替代方案？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-10T04:03:23.043

由于您通过 Url 访问部署清单，因此您可以通过查询字符串（例如`http://clickonce.example.com/shell.application?p1=this&p2=that`）传递所有这些信息

我打算输入步骤，然后用谷歌搜索，发现[这个博客](http://briannoyes.net/harvesting-clickonce-command-line-arguments/)基本上列出了所有步骤。我在一个实例中做过类似的事情，没有任何问题。唯一稍微困难的事情是你必须在设置好之后重新魔法，但如果你一开始就部署它，你就已经知道如何设置了。

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-07-23T17:48:18.200

此处的所有答案仅适用于 Online ClickOnce 应用程序。 [此 MSDN 论坛帖子](http://social.msdn.microsoft.com/Forums/windows/en-US/b3360e34-633c-49d8-99c3-8108e557ef47/clickonce-and-command-line-parameters)和[此博客帖子](http://robindotnet.wordpress.com/2010/03/21/how-to-pass-arguments-to-an-offline-clickonce-application/)讨论了一些为离线 ClickOnce 应用程序执行此操作的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T23:13:24.720

也许你可以第一次在 URL 上传递一个参数，让应用程序注意到这一点，并将参数写入配置文件或环境变量等。

在后续运行中，从配置文件加载

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T23:01:06.620

您将参数作为查询字符串传递并使用 HttpUtility.ParseQueryString，如[本 MSDN 文章中所述](http://msdn.microsoft.com/en-us/library/ms172242.aspx)。

# java - 为初创公司采取的最低限度的安全预防措施是什么？

> ID：429352
> 
> 赞同：3
> 
> 时间：2009-01-09T19:25:13.840
> 
> 标签：java, security, lamp, infrastructure

我正在与一家初创公司合作，主要从事系统管理工作，并且遇到了一些我不太满意的安全问题。我想判断我的期望是否准确，所以我正在寻找一些洞察力，以了解其他人在这种情况下做了什么，以及出现了哪些风险/问题。特别是，诸如将管理工具置于 vpn 之后、定期安全更新（操作系统和工具）等措施的重要性。

请记住，由于这是一家初创公司，主要目标是尽快推出尽可能多的功能，因此我需要尽可能多的理由来获取安全资源（即停机时间）升级，应用程序安全修复的开发时间）。

背景资料：

*   应用程序是 LAMP 以及自定义的 java 客户端服务器。
*   在接下来的 3 个月中，我预计该网站有大约 1 万名匿名访问者和多达 1000 名经过身份验证的用户。
*   年轻的观众（16-25 岁）肯定会包含高于平均水平的黑帽观众。

提前感谢您的回复，我会欢迎任何相关的建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T19:44:04.347

此外，不要忘记您需要保护您的服务器免受当前（即即将过去的）员工的影响。由于员工破坏，几家初创公司被彻底消灭，例如[http://www.geek.com/articles/news/disgruntled-employee-kills-journalspace-with-data-wipe-2009015/](http://www.geek.com/articles/news/disgruntled-employee-kills-journalspace-with-data-wipe-2009015/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T19:32:35.213

声誉就是这里的一切，尤其是对于初创公司。作为一家初创公司，您在可靠性/安全性/...方面的历史并不长 - 所以一切都取决于用户在开始使用您的应用程序时是否给您“怀疑的好处”。

如果您的服务器被黑客入侵并且您的用户注意到了这一点，那么您的声誉就会消失。一旦它消失了，你的应用程序和你的功能是否是“下一个新事物”都没有关系。安全漏洞是否轻微无关紧要 - 人们将不再信任您的应用程序/公司。

所以，我认为安全是重中之重。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-09T19:39:46.807

如果从一开始就没有考虑到安全性并将其内置到应用程序及其基础架构中，那么以后对其进行改造将变得更加困难。现在是构建常规操作系统/工具修补、升级等流程的时候了。

*   用户将在网站上创建/存储什么样的数据？
*   违规将对您的用户产生什么影响？
*   违规将对您的公司产生什么影响？
*   您能否在违规后重新获得用户的信任？

由于您的公司依赖于保留现有用户并吸引新用户，因此您应该按照用户对违规行为的反应来表达您的担忧。上级会明白，用户是你的生计。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-09T19:40:45.930

我同意 Stefan 关于声誉的看法。您不想因为缺乏安全性而被黑客入侵。这不仅会伤害您的网站和公司，而且会因为您负责而对您不利。

我个人的意见是尽可能多地做，因为无论你做多少都会有漏洞。

不幸的是，测试和文档等安全性通常是事后才想到的。您确实应该确保在您的站点/软件生命周期的早期进行风险评估，并继续进行评估。我认为修补所有软件的安全漏洞很重要。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-09T19:32:12.530

这些可能很明显：

*   限制密码尝试。
*   清理您的数据库输入
*   防止XSS攻击的措施

还值得一提的是，正如您所说，应适当设置网络架构。您绝对应该拥有一个尽可能多地锁定的像样的防火墙。有些人建议将您的系统放在不同品牌的双重防火墙之间，这样如果其中一个存在严重漏洞，第二个很可能没有相同的漏洞并且您会很安全。这一切都取决于你能负担得起，因为它是一家初创公司。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-09T22:46:18.113

如果您明确地试图吸引那些倾向于尝试破解系统的用户，那么您很可能会打赌您的系统*会*受到攻击。

您应该向管理层建议，如果他们不认真对待安全问题，那么您应该继续在网站上发布公司的银行对账单和会计账簿（以明文形式），并带有主页上的显眼链接. 至少这样，您可以告诉他们，最终结果将大致相同，但他们不太可能破坏其他一切来获得他们正在寻找的东西。

我认为声誉问题可能与这些观众的演员阵容略有不同——他们可能会原谅你被黑客入侵，但他们可能*不会*原谅你容易成为目标。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-09T19:29:22.257

确保您知道您的服务器正在运行什么版本和补丁级别，不仅仅是操作系统，还包括所有相关组件以及实际执行机器的所有内容。然后确保你永远不会落后超过一天。不这样做会导致很大的痛苦，而且你大部分都没有听说过——我过去的大多数雇主都不会公开承认被黑客入侵，因为这对他们造成了不好的影响，所以你可以假设系统被左右黑客攻击了对公司造成严重后果，您只是没有听说过大多数此类事件。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-09T22:29:10.397

这里的一些基本“安全”措施虽然比主动更被动，但需要考虑一些事情。

1) 备份策略，当然不仅适用于那些入侵您网站的人，但如果可能的话，最好将所有内容恢复到黑客攻击前的日子，确保它是可靠的，最重要的是在近乎实时的恢复演习中进行了测试
2 ) 缓解措施，至少在餐巾纸上制定计划，以便在服务器被黑客入侵时如何应对
3) 保险，找到了解网络业务世界以及这些事情造成的损害的保险公司，购买保单
4) 某人已经提到了员工破坏问题，您是在事先筛选您的员工，对吗？背景调查很便宜，而且可以挖掘东西......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-13T19:04:05.550

我最好的建议是监控。

没有完美的安全性，一切都是为了接受风险并在必要时预防风险。但是，如果您没有适当的监控，您将无法知道某事（攻击）是否成功以及它是如何发生的。

因此，请保持系统更新并安装一些轻量级工具来正确监控它。**如果您有自定义应用程序，请在此处添加登录。**登录错误生成的错误（输入错误）、密码失败或任何用户生成的错误。

至于轻量级的监控工具，有不少免费/开源的：

*   [OSSEC](http://www.ossec.net)（查找异常、更改和日志）
*   [modsecurity](http://modsecurity.org)（基于网络的监控）
*   [Sucuri](http://sucuri.net)（whois/dns/黑名单监控）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-08-29T09:07:14.380

查看 Mod Security 以了解软件设置中的各种可能性：在 Google 上搜索“mod_security howto example”

开始的简单示例：[http ://www.ghacks.net/2009/07/15/install-mod_security-for-better-apache-security/](http://www.ghacks.net/2009/07/15/install-mod_security-for-better-apache-security/)

# c# - 如何确定我的 .Net 应用程序是否使用快捷方式启动？

> ID：429362
> 
> 赞同：0
> 
> 时间：2009-01-09T19:28:41.290
> 
> 标签：c#, .net, clickonce

是否可以查明您当前的 .Net 应用程序是否已使用快捷方式或 Clickonce 应用程序参考 (*.appref-ms) 文件启动？如果是这样，怎么做？

一些背景知识：我在使用 Microsoft Clickonce 时遇到了一个问题，我无法将命令行参数传递给应用程序。这似乎是该技术按设计工作的方式。我正在探索传递此参数的不同方法；其中之一是拥有一组不同的 Clickonce 开始菜单快捷方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T21:15:17.393

尝试测试[ApplicationDeployment.IsNetworkDeployed](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.isnetworkdeployed.aspx)属性。我知道如果它是 ClickOnce 应用程序，这将是正确的，但我不确定在您的情况下它是否是错误的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T19:33:07.613

我不确定什么是“应用程序参考文件”；您的意思是像在资源管理器中双击 EXE 文件还是从命令行运行该文件？

没有任何*先验*方法可以检测您的程序是如何启动的。通常的解决方法是配置快捷方式文件以在命令行上传递参数。然后，在运行时检查该参数是否存在。如果您在那里找到它，则假定该程序是从快捷方式启动的。这种方法的关键是在资源管理器中双击 EXE 文件时不能包含参数，因此如果找到命令行参数，就知道程序不是以这种方式启动的。

# database - 什么成本更高：数据集还是多次更新？

> ID：429363
> 
> 赞同：0
> 
> 时间：2009-01-09T19:28:50.243
> 
> 标签：database, dataset

如果我的程序要通过多次更新来访问数据库，最好将表拉入数据集，更改值，然后将其发送回数据库。有谁知道什么更贵？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T19:34:58.937

无论如何，数据库需要根据您对本地 DataSet 所做的编辑来执行所有这些更新。据我了解，这将与顺序更新一样昂贵。唯一的优点是它更容易迭代数据集，而不是一个接一个地推拉结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:38:40.630

昂贵的是用于处理可能发生的潜在异常的所有变通方法代码，因为您选择“哪个成本更低”而不是“哪个最简单”。过早的优化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T19:30:08.290

取决于`DataSet`. 如果您的数据集太大，则不值得。否则，这可能是一个好方法。但是，即使不使用`DataSet`. 您可以编写一个带有`XML`参数的存储过程，该参数将为您执行批量更新。

# c++ - 通过 QDirectPainter 绘画

> ID：429365
> 
> 赞同：2
> 
> 时间：2009-01-09T19:29:34.110
> 
> 标签：c++, qt, qpainter

谁能详细建议我如何使用`QDirectPainter`类直接在帧缓冲区上绘制小部件。如果您提供一个工作示例，我会更有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T23:18:57.947

QDirectPainter 不会也不能绘制任何东西。它在那里提供对帧缓冲区的访问，即通过其[QDirectPainter::frameBuffer () 函数](http://doc.trolltech.com/4.5/qdirectpainter.html#frameBuffer)。一旦你有了帧缓冲区的指针，你应该能够直接操作像素。

一种可能有效的方法是通过光栅引擎将您的小部件绘制到 QImage（注意颜色深度、字节顺序、像素位置等以匹配您的帧缓冲区）。这很容易通过在 QImage 上打开 QPainter 来实现。绘制过程完成后，将图像缓冲区的相关部分blit到帧缓冲区。

# gis - 是否有等效的 GIS“Hello World”？

> ID：429370
> 
> 赞同：14
> 
> 时间：2009-01-09T19:30:12.970
> 
> 标签：gis, geospatial

是否有与 GIS 应用程序的“Hello World”程序等效的程序？

我希望更加熟悉 GIS 应用程序的开发。有哪些流行的（免费/低成本）教程和/或示例应用程序可以帮助人们入门？有没有您认为对 GIS 初学者来说必不可少的书籍？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T20:31:28.853

您可以从一些基本的桌面绘图软件开始，例如[uDig](http://udig.refractions.net/)或[Quantum GIS](http://www.qgis.org)。并下载一些[Shape 文件](http://www.google.com/search?q=free+gis+data)。

从那里您可能想看看[PostGIS](http://postgis.refractions.net/)。对于 Web 开发，从[MapServer](http://mapserver.org/)和[OpenLayers](http://openlayers.org/)开始。

也值得一看这本书[Mapping Hacks](http://mappinghacks.com/)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-10T01:12:25.963

也许这些来自 Pragmatic Programmers 的书可以帮助你：

[桌面 GIS：使用开源工具绘制地球地图](http://www.pragprog.com/titles/gsdgis/desktop-gis)

[![](https://i.stack.imgur.com/4LL6t.jpg)](https://i.stack.imgur.com/4LL6t.jpg)
[（来源：[pragprog.com](http://www.pragprog.com/images/covers/original/gsdgis.jpg)）]

[面向 Web 开发人员的 GIS：向 Web 应用程序添加位置](http://www.pragprog.com/titles/sdgis/gis-for-web-developers)

[![](https://i.stack.imgur.com/NCwCy.jpg)](https://i.stack.imgur.com/NCwCy.jpg)
[（来源：[pragprog.com](http://www.pragprog.com/images/covers/original/sdgis.jpg)）]

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-09T20:21:54.240

试一试吧：

折线：

```
(   0, 100), ( 0,     0), (   0,  50), (  80,  50), (  80,   0), (  80, 100)
( 180, 100), ( 100, 100), ( 100,  50), ( 140,  50), ( 100,  50), ( 100,   0), ( 180,   0)
( 200, 100), ( 200,   0), ( 280,   0)
( 300, 100), ( 300,   0), ( 380,   0)
( 400,  50), ( 440, 100), ( 480,  50), ( 440,   0), ( 400,  50)
( 600, 100), ( 620,   0), ( 640,  50), ( 660,   0), ( 680, 100)
( 700,  50), ( 740, 100), ( 780,  50), ( 740,   0), ( 700,  50)
( 800,   0), ( 800, 100), ( 880,  75), ( 800,  50), ( 880,   0)
( 900, 100), ( 900,   0), ( 980,   0)
(1000,   0), (1000, 100), (1080,  50), (1000,   0) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-26T17:37:06.030

如果您的公司有 ESRI 软件，我建议您获取 ArcMap，打开 VBA 编辑器并从帮助文件中复制和粘贴一些简单的代码示例。

如果您没有桌面软件，请尝试[http://openlayers.org/](http://openlayers.org/)与 Google 地图等效的开源软件。它有一个很好的 API 和示例。

我想说 GIS 中的“Hello World”等价物是单击地图并弹出一个消息框，其中包含单击的纬度和经度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-24T06:51:29.137

您对基于桌面的 GIS 开发还是基于 Web 的开发感兴趣？

ESRI 是该领域的领导者。www.esri.com 在他们的网站上四处逛逛。

网站的资源部分有很多信息。您可以在网站上使用 JavaScript API 并使用它们托管的数据进行使用。这里有几个入门部分和演练。

[http://resources.esri.com/gateway/index.cfm](http://resources.esri.com/gateway/index.cfm)

这是 JavaScript API 资源站点 [http://resources.esri.com/arcgisserver/apis/javascript/arcgis/index.cfm?fa=home的链接](http://resources.esri.com/arcgisserver/apis/javascript/arcgis/index.cfm?fa=home)

您可以下载 ArcExplorer 并使用它。我认为它是可定制的。您可以使用它查看 shapefile 和地理数据库。 [http://resources.esri.com/arcgisexplorer/900/index.cfm?fa=home](http://resources.esri.com/arcgisexplorer/900/index.cfm?fa=home)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-04-30T10:55:28.810

## 矩形<->地理坐标变换

我觉得无论出于何种原因，每个通才 GIS 开发人员迟早都必须自己进行项目坐标。给定一个纬度、经度对和一个表示地球表面（或其一部分）的位图图像，在图像中定位地理坐标 - 反之亦然，获取图像中特定像素的地理坐标。Lambert 圆柱投影可能是最容易开始的地方，因为[数学相对简单](https://en.wikipedia.org/wiki/Lambert_cylindrical_equal-area_projection)，并且等面积投影如今风靡一时，但[球面墨卡托投影](https://en.wikipedia.org/wiki/Mercator_projection#Derivation_of_the_Mercator_projection)并不难，而且仍然很常用，尤其是在网络上。

在此之后，您可以进入许多不同的方向 - 一些投影涉及更复杂的数学，或者您可以继续使用更简单的数学模型但使地球的形状复杂化（[它是一个椭圆体！](https://en.wikipedia.org/wiki/Figure_of_the_Earth#Ellipsoid_of_revolution)不，[它是一个土豆！](https://www.universetoday.com/116801/the-potsdam-gravity-potato-shows-earths-gravity-variations/)），仿射和透视变换，或各种其他很棒的东西。但归根结底，GIS 是关于坐标的，您经常需要让不同的坐标相互交流，所以我认为这是一个很好的起点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-09T19:46:48.023

[ESRI](http://www.esri.com)他们的工具绝对不便宜，但被广泛使用。他们确实有很好的学习资源和教程材料，尽管许多人确实认为您已经拥有他们的产品。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-09-03T12:11:30.410

你当然应该从 QuantumGis (QGIS) 开始。它是开源的，相对快速且易于使用。从网上下载任何 shapefile，确保您可以自己解释（例如带有欧洲国家边界的 shapefile）。想想你能用这些数据做什么，或者你想做什么。然后我建议你学习一些基本的 Python（GDAL、Shapely、Fiona）教程，最后用 POSTGis 和 MapServer 结束。我并不是说你应该在一天、一个月或一年内全部学会，慢慢来，确保你了解所有内容。我建议这样的东西，因为这就是我开始的方式并且它起作用了。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-11-05T22:01:23.753

试用[http://code.google.com/p/tf-net/](http://code.google.com/p/tf-net/) (Topology Framework .NET) 并浏览介绍性主题。虽然它是面向 .NET 的，但它可以让您了解基本的 GIS 任务：

*   空间谓词（基于 DE-9IM 模型）
*   叠加函数（交集、差、并集、对称差）
*   缓冲
*   凸包
*   面积和距离函数
*   拓扑有效性检查
*   坐标系操作（变换）
*   拓扑图操作
*   通用几何 I/O 支持：WKT、WKB、GML、SHP ...

# asp.net - 自动运行 Web 应用程序

> ID：429374
> 
> 赞同：0
> 
> 时间：2009-01-09T19:31:08.197
> 
> 标签：asp.net

我有一个 asp.net 更新网络应用程序。用户进入页面，点击更新按钮，程序运行。我们还希望这个程序每晚都作为计划任务运行。这可能吗？你会怎么处理这个？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T19:34:38.033

您可以在您的程序上创建一个到您的 Web 应用程序页面的快捷方式（例如 update.aspx?command=update），然后将服务器的调度程序设置为在您希望的时间运行该快捷方式。

我只建议您使用一个没有任何内容并且只会响应特定命令的页面，这样可以降低您不希望页面被“绊倒”的风险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:08:52.237

更好的方法是将应用程序分解为域层 dll，然后您的 aspx 页面可以使用该 dll，您还可以编写一个使用相同 dll 的控制台应用程序。您可以设置计划任务以每晚运行控制台应用程序。

# c# - C# 控制台应用程序无法运行

> ID：429376
> 
> 赞同：0
> 
> 时间：2009-01-09T19:32:08.460
> 
> 标签：c#, console, visual-studio-express

我正在使用 Visual Studio 2008 Express，并尝试创建一个简单的控制台应用程序来测试它。当我尝试编译它时，它编译得很好，但是当我尝试运行它时，它抱怨缺少清单文件。据我所知，VStudio 应该会自动创建清单文件，但由于它是一个没有任何依赖关系的简单控制台应用程序，所以我要求 VS 创建没有清单文件的应用程序。它没有改变任何事情。它一直要求一份清单文件，说明该应用程序应该有一个。我记得以前 VS Express 版本的 vshost 进程中的旧错误，所以我尝试禁用它。当我这样做时，错误消息更改为说应用程序无法正确加载并将关闭，两者都可以选择是否创建清单。我很确定这是我对 VS Express 的一些错误配置，但我真的找不到在哪里。有人遇到过类似的问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T19:47:49.347

我认为您应该只创建清单文件。设置大约需要 30 秒，我敢肯定，您在谷歌搜索和尝试解决问题上浪费了更多时间。

这是关于程序集清单的 MSDN 文章（在 .NET 3.5 中）：

[http://msdn.microsoft.com/en-us/library/1w45z383.aspx](http://msdn.microsoft.com/en-us/library/1w45z383.aspx)

**编辑**并注意拒绝此答案的人：这是一个有用的答案，我告诉你原因。在实施软件项目时，有时我们都会犯错误并浪费大量时间尝试以一种没有意义的方式做某事。能够尽早意识到“我做错了”而不是试图强行提出不可行的解决方案，这是一项非常重要的工程技能。

# c# - 使用具有私有和公共 const 属性的 XmlSerializer

> ID：429380
> 
> 赞同：7
> 
> 时间：2009-01-09T19:32:50.923
> 
> 标签：c#, xml-serialization

让 XmlSerializer 也序列化类或结构的私有和“公共 const”属性的最简单方法是什么？对我来说，并非所有输出都是公开的。将其设为私有或添加 const 会导致值不被序列化。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-09T19:43:54.207

`XmlSerializer`只查看公共字段和属性。如果您需要更多控制，您可以实现[IXmlSerializable](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)并序列化您想要的任何内容。当然，序列化一个常量没有多大意义，因为你不能反序列化为一个常量。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-07-28T21:47:21.270

即使无法序列化私有属性，您也可以使用内部设置器序列化属性，如下所示：

```
public string Foo { get; internal set; } 
```

为此，您需要使用 sgen.exe 预先生成序列化程序集，并将此程序集声明为朋友：

```
[assembly:InternalsVisibleTo("MyAssembly.XmlSerializers")] 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-09T19:45:36.200

查看 .NET 3.0 中引入的 DataContractSerializer。它也使用 XML 格式，并且在很多方面都优于 XmlSerializer，包括处理私有数据。有关完整比较，请参阅[http://www.danrigsby.com/blog/index.php/2008/03/07/xmlserializer-vs-datacontractserializer-serialization-in-wcf/](http://www.danrigsby.com/blog/index.php/2008/03/07/xmlserializer-vs-datacontractserializer-serialization-in-wcf/)。

如果您只有 .NET 2.0，则有可以处理私有数据的 BinarySerializer，但它当然是二进制格式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-09T20:16:15.063

考虑`const`成员是没有意义的，因为它们不是每个实例；但如果您只是指非公共实例成员：考虑`DataContractSerializer`(.NET 3.0) - 这类似于`XmlSerializer`，但可以序列化非公共属性（尽管它是“选择加入”）。

请参阅[此处了解更多信息](https://stackoverflow.com/questions/420662/can-an-internal-setter-of-a-property-be-serialized#420710)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-14T08:52:03.080

另一种使用 Newtonsoft.Json 的解决方案：

```
 var json = Newtonsoft.Json.JsonConvert.SerializeObject(new { root = result });
   var xml = (XmlDocument)Newtonsoft.Json.JsonConvert.DeserializeXmlNode(json); 
```

当然，这个不幸的是通过 json 绕道而行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-08T16:33:07.677

这是我将不可变值放入将序列化为 XML 的属性中的解决方案：

```
[XmlElement]
public string format { get { return "Acme Order Detail XML v3.4.5"; } set { } } 
```

# c# - 更新 Windows 服务程序集而不重新启动它？

> ID：429383
> 
> 赞同：3
> 
> 时间：2009-01-09T19:33:25.740
> 
> 标签：c#, .net, windows-services

如何在不重新启动服务的情况下更新某些 Windows 服务分离程序集？

注意：此 Windows 服务托管 WCF 服务，因此无需重新启动服务，因此不要关闭 WCF 客户端 ..

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T19:52:55.140

AFAIK，您将必须在其自己的 AppDomain 中运行可重新启动的内容，并设置域以将 ShadowCopyFiles 设置为 true。您也可以选择自己的 CachePath，将相关的 dll 复制到其中。

从此以后，您可以使用 FileSystemWatcher 检查您的 dll 的原始位置是否有任何更改。

一旦有，卸载 AppDomain，清除缓存，然后像以前一样设置 AppDomain。

为了简单地启动一个具有明确定义的新 AppDomain 的开始、停止点，这些点将在您的新 AppDomain 中[执行](http://realfiction.net/2008/05/20/A-simple-way-to-start-your-code-in-a-different-AppDomain/)

# database-design - 如何规范化用户生成的大型公司名称数据集？

> ID：429385
> 
> 赞同：0
> 
> 时间：2009-01-09T19:34:17.707
> 
> 标签：database-design, normalization

用例：用户 1 上传 100 个公司名称（例如 Microsoft、Bank of Sierra）

用户 2 上传 100 个公司名称（例如 The Gap、Uservoice、Microsoft, Inc.）

我希望用户 1 的 Microsoft 概念和用户 2 的 Microsoft 概念映射到具有 Microsoft 唯一索引的集中维护实体。

如果有人上传了一个不在中央存储库中的名称，我想我希望它按原样输入。但是，如果第一个条目拼写错误会发生什么（例如 Vergin Mobile 而不是 Virgin Mobile？）我们如何才能最好地纠正它并将新上传的内容与同一索引相关联？

从技术上讲，中央存储库应该完全是一个单独的数据库吗？甚至用户生成的信息是否也应该与针对它发生的业务交易位于一个单独的数据库中？

从对问题的大定义开始，并希望将其与您的输入结合起来，谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T19:44:35.143

[FWIW，这与数据库规范化](http://en.wikipedia.org/wiki/Database_normalization)无关。这是一项数据清理任务。

在一般情况下，数据清理不能完全自动化。许多人尝试过，但不可能检测到输入数据可能格式错误的所有方式。您可以使用以下技术自动化某些百分比的案例：

*   强制用户从列表中选择公司名称，而不是键入它们。当然，这最适合单个条目，而不是批量上传。
*   将`SOUNDEX`输入`SOUNDEX`的公司名称与数据库中已有的公司名称进行比较。这对于识别*可能的*匹配很有用，但它也可能给出误报。所以你需要一个人来审查它们。

最终，您需要设计您的软件，以便管理员可以轻松地“合并”条目（并更新来自其他数据库表的任何引用），因为它们被发现彼此重复。使用级联外键没有优雅的方法可以做到这一点，您只需要编写一堆 UPDATE 语句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T19:52:51.130

有一种称为主数据管理的完整类型的系统尝试为不同的域（例如合作伙伴、地址、产品）执行此操作。通常是大型、功能齐全的系统，没有什么可以以临时方式正确完成。这些事情一开始听起来很容易，但很快就会变得非常困难。

抱歉，我在这里不太高兴，但这很快就会变成一场噩梦......类似于试图解决一个 np-complete 问题......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T19:42:27.813

当您尝试在此站点上输入新问题时，您是否看到会发生什么？所有之前的问题可能是相同的？

可能即使这样也不够。这里是不够的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T19:44:37.123

链接在某种程度上做到了这一点。但是，他们不进行批量上传......基本上你想设置某种差异计算器，这将导致对一些潜在匹配采取行动。

删除“Inc”、“The”等单词是一种规则，然后是拼写错误的模式匹配或紧密匹配的单词。

从工作流程的角度来看，批量上传并不是一件容易的事。您将需要一个已获批准的已知数据字典，然后必须审查每次上传/添加。最终添加的数量会减少。

我同意这不是数据库问题 - 这是一个工作流程问题。

编辑

我将有一个批准的列表，然后是一些将潜在的“好”名称传播到批准列表的规则。你如何实现它留给读者作为练习......

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-09T19:41:57.707

```
company table    
  id
  name

company_synonym table
  company_id
  name 
```

此模式结构解决了您列出的问题。

# tcl - TCL：递归搜索子目录以获取所有 .tcl 文件

> ID：429386
> 
> 赞同：11
> 
> 时间：2009-01-09T19:34:24.350
> 
> 标签：tcl

我有一个主要的 TCL proc，它在其他文件夹和后续子目录中获取大量其他 tcl proc。例如，在主进程中它有：

```
source $basepath/folderA/1A.tcl
source $basepath/folderA/2A.tcl
source $basepath/folderA/3A.tcl
source $basepath/folderB/1B.tcl
source $basepath/folderB/2B.tcl
source $basepath/folderB/3B.tcl 
```

当我总是知道我将在文件夹 A 和文件夹 B 中获取所有内容时，这样做似乎有点愚蠢。是否有一个功能（或简单的方法）可以让我只获取整个文件夹中的所有 .tcl 文件？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-12T10:58:29.570

基于 ramanman 的回复，这是一个使用内置 TCL 文件命令解决问题的例程，它递归地沿着目录树向下工作。

```
# findFiles
# basedir - the directory to start looking in
# pattern - A pattern, as defined by the glob command, that the files must match
proc findFiles { basedir pattern } {

    # Fix the directory name, this ensures the directory name is in the
    # native format for the platform and contains a final directory seperator
    set basedir [string trimright [file join [file normalize $basedir] { }]]
    set fileList {}

    # Look in the current directory for matching files, -type {f r}
    # means ony readable normal files are looked at, -nocomplain stops
    # an error being thrown if the returned list is empty
    foreach fileName [glob -nocomplain -type {f r} -path $basedir $pattern] {
        lappend fileList $fileName
    }

    # Now look for any sub direcories in the current directory
    foreach dirName [glob -nocomplain -type {d  r} -path $basedir *] {
        # Recusively call the routine on the sub directory and append any
        # new files to the results
        set subDirList [findFiles $dirName $pattern]
        if { [llength $subDirList] > 0 } {
            foreach subDirFile $subDirList {
                lappend fileList $subDirFile
            }
        }
    }
    return $fileList
 } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-30T17:31:36.450

在船上使用 tcllib 变得微不足道：

```
package require fileutil
foreach file [fileutil::findByPattern $basepath *.tcl] {
    source $file
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-10T07:41:22.107

也许更独立于平台并使用内置命令而不是管道到进程：

```
foreach script [glob [file join $basepath folderA *.tcl]] {
  source $script
} 
```

对文件夹 B 重复此操作。

如果您有更严格的选择标准，并且不担心在任何其他平台上运行，使用 find 可能会更灵活。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-09T20:01:19.633

这是一种方法：

```
set includes [open "|find $basedir -name \*.tcl -print" r]

while { [gets $includes include] >= 0 } {
  source $include
}

close $includes 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-15T21:43:33.043

根据先前的答案，此版本处理由符号链接创建的循环，并在此过程中消除了由于符号链接而导致的重复文件。

```
# findFiles
# basedir - the directory to start looking in
# pattern - A pattern, as defined by the glob command, that the files must match
proc findFiles {directory pattern} {

    # Fix the directory name, this ensures the directory name is in the
    # native format for the platform and contains a final directory seperator
    set directory [string trimright [file join [file normalize $directory] { }]]

    # Starting with the passed in directory, do a breadth first search for
    # subdirectories. Avoid cycles by normalizing all file paths and checking
    # for duplicates at each level.

    set directories [list]
    set parents $directory
    while {[llength $parents] > 0} {

        # Find all the children at the current level
        set children [list]
        foreach parent $parents {
            set children [concat $children [glob -nocomplain -type {d r} -path $parent *]]
        }

        # Normalize the children
        set length [llength $children]
        for {set i 0} {$i < $length} {incr i} {
            lset children $i [string trimright [file join [file normalize [lindex $children $i]] { }]]
        }

        # Make the list of children unique
        set children [lsort -unique $children]

        # Find the children that are not duplicates, use them for the next level
        set parents [list]
        foreach child $children {
            if {[lsearch -sorted $directories $child] == -1} {
                lappend parents $child
            }
        }

        # Append the next level directories to the complete list
        set directories [lsort -unique [concat $directories $parents]]
    }

    # Get all the files in the passed in directory and all its subdirectories
    set result [list]
    foreach directory $directories {
        set result [concat $result [glob -nocomplain -type {f r} -path $directory -- $pattern]]
    }

    # Normalize the filenames
    set length [llength $result]
    for {set i 0} {$i < $length} {incr i} {
        lset result $i [file normalize [lindex $result $i]]
    }

    # Return only unique filenames
    return [lsort -unique $result]
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-09-14T17:48:25.277

与 schlenk 相同的想法：

```
package require Tclx
for_recursive_glob scriptName $basepath *.tcl {
    source $scriptName
} 
```

如果您只想要文件夹 A 和文件夹 B 而不是 $basepath 下的其他文件夹：

```
package require Tclx
for_recursive_glob scriptName [list $basepath/folderA $basepath/folderB] *.tcl {
    source $scriptName
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-24T08:36:24.380

Joseph Bui 的回答效果很好，只是它跳过了初始文件夹中的文件。

改变：

```
设置目录 [列表]
```

到：

```
设置目录 [list $directory]
```

修理

# asp.net - ASP.NET 向导和框架 3.5

> ID：429392
> 
> 赞同：0
> 
> 时间：2009-01-09T19:36:35.593
> 
> 标签：asp.net, .net-3.5, wizard

将我们的 Web 应用程序升级到 .NET 3.5 后，我们注意到 Wizard 控件存在一个奇怪的问题。通常在重新启动 IIS 并加载包含控件的页面后，左侧导航窗格将不会显示。再次点击此页面将解决此问题。它在开发环境中也可见，尽管它是间歇性的，而且我没有可重复的步骤序列。有没有其他人遇到过类似的问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-10-13T22:39:03.817

框架 3.5 中没有对向导控件进行任何更改，因此与更新框架无关

# iphone - iPhone 内存调试

> ID：429401
> 
> 赞同：1
> 
> 时间：2009-01-09T19:39:07.570
> 
> 标签：iphone, cocoa, memory-management

我正在使用 Instruments 来尝试确定我的应用程序中是否有一些地方可以更有效地使用内存。我花时间对 Instruments 有所了解，但我通常是一个新手，有来自 Java 背景的寻找内存管理问题。通过调用此方法，我似乎使用了大约 1.82mb：

```
+ (NSString *)stringFromDateWithFormat:(NSDate *)date withFormat:(NSString *)format
{
    NSDateFormatter *dateFormatter;
    NSString *result;

    if (nil == date || nil == format)
        return nil;

    result = nil;
    if (nil != (dateFormatter = [[NSDateFormatter allocWithZone:[self zone]] init])) {
        [dateFormatter setDateFormat:format];   

        if (nil != (result = [dateFormatter stringFromDate:date])) {
            [dateFormatter release];
            return result;
        } 

        [dateFormatter release]; 
    } 
    return nil;
} 
```

当我发布日期格式化程序时，我想知道 NSString*结果*是否是我的问题。在我看来，stringFromDate 库调用会返回一个自动释放的对象，所以我无法“手动”管理它。有点不确定如何优化此方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T20:50:31.263

这个方法在循环中被调用了很多次吗？自动释放的对象只有在它们所在的 NSAutoreleasePool 被释放时才会被释放。据我了解，创建默认自动释放池并释放每个事件循环。您可能在单个事件循环过程中创建了太多自动释放的对象。解决方案是在适当的地方创建自己的 NSAutoreleasePool，并释放它以清除自动释放的对象。一个极端的例子说明了这一点：

```
int i;
NSAutoreasePool* pool = nil;
for (i = 0; i < 1000000; ++i) {
    /* Create a new pool every 10000 iterations */
    if ((i % 10000) == 0) {
        if (pool) [pool release];
        pool = [[NSAutoreleasePool alloc] init];
    }
    [someObj someMethodThatCreatesAutoreleasedObjects];
}
[pool release]; 
```

在该示例中，当前池每 10,000 次迭代释放一次，并创建一个新池。您可以在有关自动释放池的[内存管理编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Concepts/AutoreleasePools.html#//apple_ref/doc/uid/20000047)部分中阅读有关内存管理的更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T20:08:04.190

无论如何，您都需要返回一个自动释放的对象，因此您实际上不需要对结果字符串做任何事情。我没有看到任何与内存相关的错误，但您的代码肯定比需要的更冗长。请记住，在 Objective-C 中，如果您在 nil 上调用方法，您将返回 nil（或 0 表示整数，但**不**表示浮点值）。您可以取出所有这些 if 语句和两个返回路径，您的代码仍然可以以相同的方式工作。另外，我只会使用 alloc 而不是 allocWithZone。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T20:09:17.883

我不是 100% 的。我也只是在学习 Mac/Iphone 开发。但是您可以使用自动释放池来帮助进行内存管理。它用于解决发布问题。

这是一篇关于[内存管理](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Concepts/ObjectOwnership.html#//apple_ref/doc/uid/20000043)的文章。查看左侧菜单。

# python - 计算列表中元素出现次数的pythonic方法是什么？

> ID：429414
> 
> 赞同：9
> 
> 时间：2009-01-09T19:42:32.587
> 
> 标签：python

这就是我所做的。python有更好的方法吗？

```
对于 a_list 中的 k：   
  如果 kvMap.has_key(k):
    kvMap[k]=kvMap[k]+1   
  别的：
    kvMap[k]=1

```

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-09T20:01:37.230

使用默认字典

```
from collections import defaultdict
kvmap= defaultdict(int)
for k in a_list:
    kvmap[k] += 1 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-09T19:49:50.343

单元素：

```
a_list.count(k) 
```

所有元素：

```
counts = dict((k, a_list.count(k)) for k in set(a_list)) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-09T19:55:59.660

我不知道，它对我来说基本上看起来不错。您的代码简单易读，这是我认为 pythonic 的重要组成部分。

你可以像这样修剪它：

```
for k in a_list:
     kvMap[k] = 1 + kvMap.get(k,0) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-12-27T04:29:36.637

这么老的问题，但考虑到添加到 a`defaultdict(int)`是一个如此常见的用途，它`collections`有一个特殊的名称也就不足为奇了（从 Python 2.7 开始）

```
>>> from collections import Counter
>>> Counter([1, 2, 1, 1, 3, 2, 3, 4])
Counter({1: 3, 2: 2, 3: 2, 4: 1})
>>> Counter("banana")
Counter({'a': 3, 'n': 2, 'b': 1}) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-09T21:00:17.440

另一个解决方案利用 setdefault()：

```
for k in a_list:
    kvMap[k] = kvMap.setdefault(k, 0) + 1 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-10T13:56:17.467

如果您的列表已排序，另一种方法是使用[itertools.groupby](http://docs.python.org/library/itertools.html?highlight=groupby#itertools.groupby)。这可能不是最有效的方法，但它仍然很有趣。它返回 item > count 的字典：

```
>>> import itertools
>>> l = [1,1,2,3,4,4,4,5,5,6,6,6,7]
>>> dict([(key, len([e for e in group]))
          for (key, group)
          in itertools.groupby(l)])
{1: 2, 2: 1, 3: 1, 4: 3, 5: 2, 6: 3, 7: 1} 
```

# javascript - 将 DOM 冻结为 JavaScript：将 DOM 修改函数重写为无操作

> ID：429416
> 
> 赞同：3
> 
> 时间：2009-01-09T19:43:23.333
> 
> 标签：javascript, dom, sandbox

我正在编写一段代码，要求`DOM`网站在任意 JavaScript 运行时保持冻结状态。属性更改很好，但我无法更改页面的原始标签结构！

我知道在 JavaScript 中有一个基本数量的函数可以修改`DOM`：

```
appendChild( nodeToAppend )
cloneNode( true|false )
createElement( tagName )
createElemeentNS( namespace, tagName )
createTextNode( textString )
innerHTML
insertBefore( nodeToInsert, nodeToInsertBefore )
removeChild( nodetoRemove )
replacechild( nodeToInsert, nodeToReplace ) 
```

我最初的想法是简单地将这些函数覆盖为无操作：

```
>>> document.write('<p>Changing your DOM. Mwwhaha!</p>')
>>> document.write = function() {}
>>> document.write('<p>No-op now!</p>') 
```

`document`虽然对对象执行此操作很容易，但`DOM`可以从许多不同的 JavaScript 对象调用修改函数！如果我可以在顶层覆盖这些函数，也许它会起作用？

来自 sktrdie 的更新：

```
>>> HTMLElement.prototype.appendChild = function(){}
>>> $("a").get(0).appendChild(document.createElement("div"))
# Still works argh.
>>> HTMLAnchorElement.prototype.appendChild = function(){}
>>> $("a").get(0).appendChild(document.createElement("div"))
# No-op yeah! 
```

所以看起来我可以只收集所有`DOM`元素的构造函数并运行它们进行无操作，但这仍然看起来很混乱......

**如何保护`DOM`任意 JavaScript 不被修改？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T20:24:30.990

您是否尝试过**HTMLElement** .prototype.appendChild = function(){} 在更高级别覆盖 DOM 方法？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T21:04:27.133

虽然这确实很老套，但维护当前 DOM 结构的唯一方法是存储 DOM 的“快照”并定期检查它。

```
//place in anonymous function to prevent global access
(function() {
  //storing the whole DOM as objects would be ideal, but too memory intensive, so a string will have to do.
  var originalDOM = document.body.innerHTML;

  var checkDOM = function() {
    if (document.body.innerHTML != originalDOM)  document.body.innerHTML = originalDOM
    //check that the code is running
    if (arbitraryCodeIsRunning)  setTimeout("checkDOM", 100);
  }
  checkDOM();
})(); 
```

可能不是您要寻找的东西，但经过一些测试，这是我能想到的唯一维护 DOM 结构的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T19:47:32.920

不要这样做。使用白名单。请。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T19:47:57.723

您可以将所有内容都放在一个`<div>`标签中，然后隐藏该标签，将其替换为另一个显示“正在加载...”的标签。然后在加载后，您可以隐藏加载`<div>`并将其替换为原始文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T20:39:46.060

没有办法做到这一点。我做了几个测试，无论我如何尝试覆盖这些方法，它们仍然存在。我相信它们的实现比可执行的 javascript 可以访问的级别更高，因此您无法真正触摸它们。

# asp.net - 在被动 STS 的依赖方中指定必需/可选声明类型

> ID：429419
> 
> 赞同：0
> 
> 时间：2009-01-09T19:44:01.273
> 
> 标签：asp.net, federated-identity, geneva-framework, claims-based-identity, passive-sts

我有一个 asp.net 应用程序（依赖方），它使用被动 STS 进行身份验证和检索声明值。依赖方正在使用 FederatedAuthenticationModule (FAM) 来启用到 sts 的被动重定向。我找到了有关如何在使用 InformationCards 时指定所需声明的文档，但尚未找到有关如何使用 FAM 进行配置的详细信息。

有没有人有这方面的例子？我能找到的最接近的例子是在日内瓦框架示例中，但它们处理的是不适用的活动 STS 和 WCF。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T14:12:33.000

我还在日内瓦框架论坛上发布了[这个问题并收到了答案。](http://social.msdn.microsoft.com/Forums/en-US/Geneva/thread/a4e33125-952c-4995-b3ef-b794e7d75c17)事实证明，在被动模型中，依赖方无法指定声明类型。被动 STS 完全负责确定它将检索的声明。

为了使这更灵活，我可能会创建一个包含允许的受众 uri 和他们需要的声明的数据存储，以便被动 sts 可以检索 RP 需要的声明。

# python - 在python中从pdf中提取流

> ID：429437
> 
> 赞同：1
> 
> 时间：2009-01-09T19:47:57.960
> 
> 标签：python, pdf, stream, reportlab, pypdf

如何从包含它的 pdf 文件中提取该流的一部分（名为 BLABLABLA 的流）？

```
<</Contents 583 0 R/CropBox[0 0 595.22 842]/MediaBox[0 0 595.22 842]/Parent 29 0  /Resources<</ColorSpace<</CS0 563 0 R>>/ExtGState<</GS0 568 0 R>>/Font<</TT0 559 0 R/TT1 560 0 R/TT2 561 0 R/TT3 562 0 R>>/ProcSet[/PDF/Text/ImageC]/Properties<</MC0<</BLABLABLA 584 0 R>>/MC1<</SubKey 582 0 R>>>>/XObject<</Im0 578 0 R>>>>/Rotate 0/StructParents 0/Type/Page>> 
```

或者，在其他世界中，我如何从 pdf 流中提取子键？

我想使用一些 python 的库（如 pyPdf 或 ReportLab），但即使是一些 C/C++ 库也应该适合我。

谁能帮我？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-11T22:06:59.113

IIUC，PDF 中的流只是二进制数据序列。我认为您想要提取对象的一部分。您是否想要一个标准对象，例如图像或文本？如果有一个真实的例子，给你示例代码会容易得多。

这可能会帮助您入门：

```
import pyPdf
pdf = pyPdf.PdfFileReader(open("pdffile.pdf"))
list(pdf.pages) # Process all the objects.
print pdf.resolvedObjects 
```

# web-services - Httplistener 中的“指定的网络名称不再可用”

> ID：429439
> 
> 赞同：13
> 
> 时间：2009-01-09T19:48:21.983
> 
> 标签：web-services, network-programming, httplistener

我已经构建了一个简单的 Web 服务，它只使用 HttpListener 来接收和发送请求。有时，服务会因“指定的网络名称不再可用”而失败。当我写入 HttpListenerResponse 的输出缓冲区时，它似乎被抛出。

这是错误：

> ListenerCallback() 错误：指定的网络名称在 System.Net.HttpResponseStream.Write(Byte[] buffer, Int32 offset, Int32 size) 不再可用

这是代码的有罪部分。responseString 是发送回客户端的数据：

```
buffer = System.Text.Encoding.UTF8.GetBytes(responseString);

response.ContentLength64 = buffer.Length;
output = response.OutputStream;
output.Write(buffer, 0, buffer.Length); 
```

它似乎并不总是一个巨大的缓冲区，两个例子是 3,816 字节和 142,619 字节，这些错误相隔大约 30 秒抛出。我不认为我的单个客户端应用程序会超载 HTTPlistener。客户端偶尔会突发发送/接收数据，几次交换接连发生。

大多数谷歌搜索显示这是一个常见的 IT 问题，当出现网络问题时，会显示此错误——大多数帮助针对的是系统管理员诊断应用程序的问题，而不是开发人员追踪错误。我的应用程序已经在不同的机器、网络等上进行了测试，我认为这不仅仅是一个网络配置问题。

这个问题的原因可能是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-04T17:11:08.227

`ContentLength64`当指定 a 并且`KeepAlive`is时，我也得到了这个`false`。似乎客户端正在检查`Content-Length`标头（所有可能的帐户都正确设置了标头，因为我得到任何其他值的异常）然后说“Whelp I'm done KTHXBYE”并稍微关闭连接在底层`HttpListenerResponse`流期望它之前。现在，我只是捕捉到异常并继续前进。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-11-30T13:58:38.187

当您尝试响应无效请求时会出现此问题。看看[这个](https://docs.microsoft.com/en-us/dotnet/api/system.net.httplistenerexception?view=net-5.0)。我发现解决这个问题的唯一方法是：

```
listener = new HttpListener();
listener.IgnoreWriteExceptions = true; 
```

只需在实例化您的侦听器后将**IgnoreWriteExceptions**设置为 true，错误就消失了。

* * *

**更新：**
为了更深入的解释，`Http`协议基于`TCP`协议，该协议与每个对等方写入数据的流一起工作。`TCP`协议是点对点的，每个点都可以关闭连接。当客户端向您发送请求时`HttpListener`，将进行 TCP 握手，然后服务器将处理数据并通过写入连接的流来响应客户端。如果您尝试写入已被远程对等方关闭的流，则会发生“指定的网络名称不再可用”的异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-05T07:36:43.540

到目前为止，我在使用 HttpListener 时只遇到过一次这个特殊的异常。当我的应用程序在断点上停留了一段时间后，当我恢复执行时发生了这种情况。

也许涉及某种内部超时？您的应用程序以突发方式发送数据，这意味着它可能在很多时候完全处于非活动状态。异常是否在一段时间不活动后立即发生？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-18T07:04:58.937

这里有同样的问题，但其他线程建议忽略异常。

[HttpListener 的 C# 问题](https://stackoverflow.com/questions/4801868/c-sharp-problem-with-httplistener)

可能这不是正确的做法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-27T10:53:09.317

对我来说，我发现每当客户端在完全加载之前关闭网页时，都会给我这个异常。我所做的只是添加一个 try catch 块并在发生异常时打印一些东西。换句话说，我只是忽略了异常。

# unit-testing - 项目受源代码控制时更改后的 MS 测试不一致的失败测试？

> ID：429441
> 
> 赞同：0
> 
> 时间：2009-01-09T19:49:02.217
> 
> 标签：unit-testing, mstest

我注意到，如果我有一组回归测试并决定将我的一个对象 (DTO) 上的属性从 int 更改为 decimal，例如，我会进行所有其他更改并且测试正常通过。但是如果这个项目是在源代码控制下（特别是VSS）这个小的变化会导致一些奇怪的事情发生......

类似于这个问题

[Visual Studio 中的测试单独成功，一组失败](https://stackoverflow.com/questions/400304/testing-in-visual-studio-succeeds-individually-fails-in-a-set)

但有点不同。我可以进行此更改，并尝试运行我的测试，任何对这种新数据类型有断言的测试都将失败，但如果我然后单击“调试检查测试”，然后它会运行先前失败的测试——它们通过了。测试代码 /etc 没有变化

有谁知道为什么会发生这种情况？我讨厌在源代码控制之外工作，但是如果我的测试不可靠......为什么在这种情况下还要使用它们......我为测试代码而活：P

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-06T05:53:15.737

考虑到问题的年龄，我怀疑这对你来说仍然是一个问题，但我想知道你是否有一个 bin 或 obj 文件夹在源代码控制下或其中的程序集？

如果它们是，那么当您编译应用程序时（在 MSTest 运行之前），源代码控制程序集将处于只读模式，并且不会被编译器覆盖，因此您的测试将针对过时的二进制文件。

# python - 无需猴子补丁即可将 Django 用户与 Google Apps 同步

> ID：429443
> 
> 赞同：1
> 
> 时间：2009-01-09T19:49:53.010
> 
> 标签：python, django, google-apps, monkeypatching

我正在编写一个 Django 应用程序，并且我希望在本地创建帐户时使用 Provisioning API 在我们的 Google Apps 托管电子邮件上创建一个帐户。

我只会使用信号，但由于我希望跨站点同步密码，所以我已经做了猴子补丁`User.objects.create_user`并`User.set_password`使用包装器来分别创建 Google 帐户和更新密码。

Monkeypatching 似乎不受欢迎，所以我想知道，有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T05:08:58.583

您是否考虑过对 User 模型进行子类化？这可能会产生一组不同的问题，并且仅适用于较新的版本（不确定更改何时生效，我在主干上）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-06T05:02:04.623

猴子补丁绝对是坏事。很难说什么，因为你给出的代码/信息太少了。但是我假设您在某些时候（在视图中，在表单中）有明文密码，那么为什么不手动同步呢？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T00:28:07.620

只要您可以更改所有代码以使用新类，子类化似乎是最佳途径。我认为最新版本的 Django 支持这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-21T07:56:22.283

我使用 Django 1.0.2 子类化用户。您基本上创建了另一个链接到 user_id 的表。

```
class User(MyBaseModel):
    user = models.OneToOneField(User, help_text="The django created User object") 
```

然后在运行时

```
@login_required
def add(request) :
    u = request.user.get_profile() 
```

然后，您可以轻松地覆盖所需的方法。

对于那些没有听说过猴子补丁的人：[http](http://en.wikipedia.org/wiki/Monkey_patch) ://en.wikipedia.org/wiki/Monkey_patch 。它是从**游击补丁**派生的。

# c# - C# 'var' 关键字与显式定义的变量

> ID：429446
> 
> 赞同：33
> 
> 时间：2009-01-09T19:50:32.853
> 
> 标签：c#, performance, resharper

我目前正在使用 ReSharper 的 30 天试用版，到目前为止，我对它提出的建议印象深刻。然而，一个建议让我感到困惑。

当我明确定义一个变量时，例如：

```
List<String> lstString = new List<String>(); 
```

ReSharped 添加了一条弯曲的绿线并告诉我：

> 使用隐式类型局部变量声明。

如果我遵循它的建议，ReSharper 会将代码行更改为：

```
var lstString = new List<String>(); 
```

`List<String>`那么，将 a 更改为 a是否会带来某种性能提升`var`，或者这仅仅是 ReSharper 的一个特性？我一直被教导明确定义一个变量，而不是使用一个动态，是更优化的。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-01-09T19:54:35.403

> 那么，将 List 更改为 var 是否会带来某种性能提升

不，但这不是重构的唯一正当理由。更重要的是，它消除了冗余并使代码更短，而不会损失任何清晰度。

> 我一直被教导明确定义一个变量，而不是使用一个动态，是更优化的。

你误解了什么`var`意思。这*绝不*是动态的，因为它产生相同的输出。这只是意味着编译器自己计算出变量的类型。它显然有能力这样做，因为这是用于测试类型安全性和正确性的相同机制。

它还删除了完全无用的代码重复。对于简单类型，这可能并不多。但请考虑：

```
SomeNamespace.AndSomeVeryLongTypeName foo = new SomeNamespace.AndSomeVeryLongTypeName(); 
```

显然，在这种情况下，将名称加倍不仅没有必要，而且实际上是有害的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-09T19:51:15.520

没有。它们发出**完全相同的 IL**。

这只是风格问题。

`var`有一个好处是可以让您更轻松地更改函数的返回类型，而无需更改源代码的其他部分。例如，将返回类型从 更改`IEnumerable<T>`为`List<T>`。但是，它可能更容易引入错误。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-09T19:54:03.173

该`var`关键字实际上并未声明具有动态类型的变量。该变量仍然是静态类型的，它只是从上下文中推断出类型。

当你有一个长类型名时，它是一个很好的快捷方式（通用类型名可以很长）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T19:56:58.220

更少的打字=更高的生产力:)

# optimization - 直接从数据库或缓存生成网页？

> ID：429448
> 
> 赞同：4
> 
> 时间：2009-01-09T19:51:18.123
> 
> 标签：optimization, architecture

[我不是在问 SO 的架构，但它会对这个问题有所帮助。]

在 SO 上，当用户点击他/她的名字并点击“回复”时，他们会看到其他用户对他们参与的评论线程、问题和答案的回复。我有一种偷偷摸摸的怀疑，我错过了那里的某些响应，这让我想知道：**如果你必须构建那个东西，你会在每次用户请求时动态地从数据库中提取所有内容吗？**或者当应用程序中有新的相关活动时你会修改它吗？或者你会在每晚的守护进程中构建它吗？

我想真正的答案是它每次都是动态构建的，但是表格以这样的方式非规范化，以减少事情的耗时。**你会如何建造它？**

我问的是任何平台，当然，不仅仅是.Net。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T19:53:44.093

我每次都会从数据库中动态提取它。我认为这可以从用户体验中获得最佳结果，然后我会应用过早优化是邪恶的原则。以后如果有性能问题，我会考虑缓存。

我认为将其作为守护进程/推送过程实际上会导致完成更多的整体工作。也就是说，更新会比用户请求信息的频率更高。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:03:48.597

显然，当发布答案或评论时，您需要确定应在其回复选项卡中通知的用户。然后只需在包含响应文本、时间戳和它所属的用户的响应表中添加一行。这样，您可以使用简单的动态生成选项卡

```
select * from responses where user=<userid> order by time desc limit 30 
```

或类似的东西。

**ps**对可以编写删除旧回复的查询的任何人的额外功劳 - 假设每个人的回复选项卡中都应该有最后 30 个回复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-10T05:09:02.727

我希望用户 ID 将是聚集索引的自然选择。如果您有一个“活动”布尔字段，那么您不必担心锁；除了更新（未索引的）活动列之外，该表可以是只写的。我敢打赌它已经这样工作了，因为看起来一切都是可以恢复的。

Don't need no stinking extra-credit response remover.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-10T05:24:10.493

I would assume this is denormalized in the database. The Comment table probably has both and answer_id and an answer_uid so the SQL to find comments on you answers just run against the comment table. The same setup would work on the Answer table. Each answer has a question_id and a question_uid.

Having said that, these are probably the same table and you have response_to_id and response_to_uid and that makes lots of code simpler and makes the "recent" tab a single select as well. In fact the difference between the two selects is one uses the uid and one uses the response_to_uid.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-11T01:01:25.673

I'd say that your UI and your database should both be driven by your Application Domain; so they will reflect each other based on their common provenance there.

Some quick notes to illustrate, using simplified Object Role Modeling as discussed by Fowler et al.

Entities

Users
Questions
Answers
Comments

Entity Roles
(Note: In Object Role Modeling, most Roles are reflexive. Some, e.g. booleans here, are monopolar)

Question has User
Question has QuestionVersions
Question as Answers
Question has Comments

Answer has AnswerVersions
Answer has Comments

Question has User
QuestionVersion has Text
QuestionVersion has Timestamp
QuestionVersion has IsDeleted (could be inferred from nonNULL timestamp eg)
QuestionVersion has DeltedByUser
QuestionVersion has DeletedTimestamp

Answer has User
AnswerVersion has Text
AnswerVersion has Timestamp
AnswerVersion has IsDeleted
AnswerVersion has DeltedByUser
AnswerVersion has DeletedTimestamp

Comment has Text
Comment has User
Comment has Timestamp
Comment IsDeleted (boolean)

(note - no versions on comments)

I think that's the basics. These assertions drive ERDs in ORM. Hopefully it's self-evident how they drive the User Stories as well.

I don't think an implementation of a normalized design like this would require denormalization - especially since I think it's clear (from behavior) that queries => UI displays are cached to be refreshed 1X per minute.

# c# - 是否可以使用 Acrobat.dll 在 ac# 应用程序中打开 PDF？

> ID：429449
> 
> 赞同：2
> 
> 时间：2009-01-09T19:51:36.953
> 
> 标签：c#, acrobat

我知道我可以在我的 c# 可执行文件（不是网络应用程序）中显示一个 PDF 文件：

```
private AxAcroPDFLib.AxAcroPDF axAcroPDF1;
axAcroPDF1.LoadFile(@"somefile.pdf");
axAcroPDF1.Show(); 
```

但那是浏览器中的常规 pdf 查看器。我不想要那个。我希望使用 Adob​​e 控件在我的 C# 应用程序中使用完整的 Adob​​e Standard 或 Professional 功能。例如，如果我使用上面的代码，它会加载到 C# 应用程序中，我可以看到 adobe 工具栏（打印、保存等），但这对我来说没用，因为我需要像 save 这样的东西，而 activex 无法完成上面的查看器。具体来说，您无法保存，就像您无法在浏览器中一样。

因此，我引用了 acrobat.dll 并尝试使用：

```
Acrobat.AcroAVDocClass _acroDoc = new Acrobat.AcroAVDocClass();
Acrobat.AcroApp _myAdobe = new Acrobat.AcroApp();
Acrobat.AcroPDDoc _pdDoc = null;
_acroDoc.Open(myPath, "test");
pdDoc = (Acrobat.AcroPDDoc)(_acroDoc.GetPDDoc());
_acroDoc.SetViewMode(2);
_myAdobe.Show(); 
```

它会打开 adobe acrobat，但会在我的 c# 应用程序之外打开它。我需要它像 activex 库一样在我的 c# 应用程序中打开。可以用这些库来完成吗？

如果我无法在我的 c# 应用程序中打开它，我希望能够“保持”我的 c# 应用程序绑定到它，以便 c# 应用程序知道我何时关闭 adobe 应用程序。至少这样我会有一定的控制力。这意味着我会打开，adobe 应用程序会打开。我关闭了 adobe 应用程序，我的 C# 应用程序意识到了这一点，并使用 activex 库加载了新更改的文档（因为我不再需要更改能力，只是显示。）

我的电脑上安装了完整版的 adobe acrobat。它不是读者。

感谢您的任何帮助。

编辑：在 adobe acrobat sdk 中有一个 vb 示例。我相信它被称为activeview。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T14:03:34.407

您可以查看[ABCpdf](http://www.websupergoo.com/abcpdf-1.htm)。我不知道它是否有这个功能，但我们已经将它用于我们的几个应用程序

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-11T11:04:17.203

使用网络浏览器控件将是显示内容的一种选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T19:25:56.783

Best option is to write a listener which tells your calling code when Adobe.exe is no longer running. Something like the following (with tweaks for your uses) should work:

```
public void Open(string myPath)
{
    Acrobat.AcroAVDocClass _acroDoc = new Acrobat.AcroAVDocClass();
    Acrobat.AcroApp _myAdobe = new Acrobat.AcroApp();
    Acrobat.AcroPDDoc _pdDoc = null;
    _acroDoc.Open(myPath, "test");
    _pdDoc = (Acrobat.AcroPDDoc) (_acroDoc.GetPDDoc());
    _acroDoc.SetViewMode(2);
    _myAdobe.Show();
    NotifyAdobeClosed += new EventHandler(Monitor_NotifyAdobeClosed);
    MonitorAdobe();
}
private void Monitor_NotifyAdobeClosed(object sender, EventArgs e)
{
    NotifyAdobeClosed -= Monitor_NotifyAdobeClosed;
    //Do whatever it is you want to do when adobe is closed.
}

private void MonitorAdobe()
{
    while(true)
    {
        var adcount = (from p in Process.GetProcesses()
                       where p.ProcessName.ToLower() == "acrobat"
                       select p).Count();
        if (adcount == 0)
        {
            OnNotifyAdobeClosed();
            break;
        }
    }
}

public event EventHandler NotifyAdobeClosed;
public void OnNotifyAdobeClosed()
{
    if (NotifyAdobeClosed != null)
        NotifyAdobeClosed(this, null);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:10:21.970

[IText#](http://sourceforge.net/projects/itextsharp/)可以帮助你。

您可以创建 PDF，我相信您可以使用它来阅读和修改它们。

至于在应用程序中显示.....我不确定如何使用 iText 显示它们或者是否可能（尚未尝试过），抱歉。iText 确实允许您转换为 RTF，这可能是一种方法。

# php - PHP中的数组发布

> ID：429450
> 
> 赞同：14
> 
> 时间：2009-01-09T19:51:57.403
> 
> 标签：php, arrays, post

我正在尝试发布一个充满复选框的数组并在下一页中打开它..

它只给了我最后一个结果，有人知道为什么吗？或如何解决？

```
<form name="input" action="createevent.php" method="post">

Event title: 
<input type="text" name="Eventtitle" size="20">
<br>Event Description 
<input type="text" name="Description" size="20">
<br>
Please select the days that you are free to arrange this meeting.<br>
Monday
<input type="checkbox" name="day" value="Monday" />
<br />
Tuesday
<input type="checkbox" name="day" value="Tuesday" />
<br />
Wednesday
<input type="checkbox" name="day" value="Wednesday" />
<br />
Thursday
<input type="checkbox" name="day" value="Thursday" />
<br />
Friday
<input type="checkbox" name="day" value="Friday" />
<br />
Saturday
<input type="checkbox" name="day" value="Saturday" />
<br />
Sunday
<input type="checkbox" name="day" value="Sunday" />
<br /><br />
<input type="submit" value="Submit"> 
```

无论您选择多少，它只会在下一页上给出一个结果。$day = sizeof($_POST['day']);

只给出'1'的答案。当我将它们带到下一页时，我希望能够单独选择它们。

谢谢！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-09T19:59:46.080

如果 POST 以`[]`.

所以你需要 have`name="day[]"`而不是 just `name="day"`。

（请注意，这适用于任何 POST 值，也适用于关联数组，而不仅仅是自动递增——你可以这样做`name="foo[bar]"`，你会得到`$_POST['foo']['bar']`......）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-09T19:58:55.923

您只得到一个结果的原因是因为您要发布多个具有相同名称的字段，因此默认情况下最后一个会覆盖所有以前的字段。尝试在您的 HTML 中创建一个数组，如下所示：

```
Monday
<input type="checkbox" name="day[]" value="Monday" />
<br />
Tuesday
<input type="checkbox" name="day[]" value="Tuesday" />
<br />
Wednesday
<input type="checkbox" name="day[]" value="Wednesday" /> 
```

依此类推……

# function - 在 Visual Studio 中自动生成函数文档

> ID：429452
> 
> 赞同：106
> 
> 时间：2009-01-09T19:52:34.503
> 
> 标签：function, visual-studio-2008, header, auto-generate

我想知道是否有办法（希望是键盘快捷键）在 Visual Studio 中创建自动生成函数头。

例子：

```
Private Function Foo(ByVal param1 As String, ByVal param2 As Integer) 
```

它会自动变成这样......

```
'---------------------------------- 
'Pre: 
'Post:
'Author: 
'Date: 
'Param1 (String): 
'Param2 (Integer): 
'Summary: 
Private Function Foo(ByVal param1 As String, ByVal param2 As Integer) 
```

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2009-01-09T21:21:05.570

制作“三个单一的评论标记”

在 C# 中是`///`

默认吐出：

```
/// <summary>
/// 
/// </summary>
/// <returns></returns> 
```

以下是[编辑 VS 模板的一些技巧。](https://dbouwman.wordpress.com/2007/06/12/streamline-coding-with-visual-studio-templates/)

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-01-09T21:26:04.267

[幽灵医生](http://submain.com/products/ghostdoc.aspx)！

右键单击该功能，选择“记录此”并

```
private bool FindTheFoo(int numberOfFoos) 
```

变成

```
/// <summary>
/// Finds the foo.
/// </summary>
/// <param name="numberOfFoos">The number of foos.</param>
/// <returns></returns>
private bool FindTheFoo(int numberOfFoos) 
```

（是的，它都是自动生成的）。

它支持 C#、VB.NET 和 C/C++。它默认映射到`Ctrl`++ `Shift`。`D`

请记住：您应该在文档中添加方法签名之外的信息。不要只停留在自动生成的文档上。像这样的工具的价值在于它会自动生成可以从方法签名中提取的文档，因此您添加的任何信息都应该是*新*信息。

话虽如此，我个人更喜欢方法是完全自文档化的，但有时你会拥有强制外部文档的编码标准，然后这样的工具将为你节省大量的无脑打字。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2016-05-10T11:16:46.353

```
/// 
```

是获取方法描述注释块的快捷方式。但请确保在添加之前已编写函数名称和签名。首先写下函数名称和签名。

然后在函数名称上方输入 ///

你会自动得到它

[![在此处输入图像描述](https://i.stack.imgur.com/xtpSX.gif)](https://i.stack.imgur.com/xtpSX.gif)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-05-01T19:02:58.337

Visual Assist 也有一个[很好的解决方案](http://www.wholetomato.com/products/features/documentMethod.asp)，并且是高度可定制的。

在对其进行调整以生成 doxygen 风格的评论后，这两次点击将产生 -

```
/**
* Method:    FindTheFoo
* FullName:  FindTheFoo
* Access:    private 
* Qualifier:
* @param    int numberOfFoos
* @return   bool
*/
private bool FindTheFoo(int numberOfFoos)
{

} 
```

（在默认设置下，它有点不同。）

* * *

编辑：自定义“文档方法”文本的方式在 VassistX->Visual Assist Options->Suggestions 下，选择“编辑 VA Snippets”，语言：C++，类型：重构，然后转到“文档方法”并自定义。上面的例子是通过以下方式生成的：

[![va_doxy](https://i.stack.imgur.com/6hO1r.png)](https://i.stack.imgur.com/6hO1r.png)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2016-01-04T08:41:32.027

通常，如果您在要注释的内容（方法、类）上方添加三个单个注释标记，Visual Studio 会自动创建它。

在 C# 中，这将是**`///`**.

如果 Visual Studio 不这样做，您可以在

> 选项->文本编辑器->C#->高级

并检查

> 为 /// 生成 XML 文档注释

[![图示说明](https://i.stack.imgur.com/QrxUC.png)](https://i.stack.imgur.com/QrxUC.png)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-07-17T19:50:42.177

在visual basic中，如果你先创建你的函数/子，然后在它上面的那一行，你输入'三遍，它会自动生成相关的xml文档。当您在智能感知中将鼠标悬停以及使用该功能时，也会出现这种情况。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-09T19:59:50.463

您可以使用代码片段来插入您想要的任何行。

此外，如果您在函数标头上方的行中键入三个单引号 (''')，它将插入您可以填写的 XML 标头模板。

这些 XML 注释可以由文档软件解释，它们作为 assembly.xml 文件包含在构建输出中。如果您将该 XML 文件与 DLL 一起保存并在另一个项目中引用该 DLL，则这些注释将在智能感知中可用。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-04-21T01:27:20.857

我正在开发一个名为 Todoc 的开源项目，该项目分析单词以在保存文件时自动生成正确的文档输出。它尊重现有的评论，并且非常快速和流畅。

[http://todoc.codeplex.com/](http://todoc.codeplex.com/)

# mysql - 用户何时可以定义字段的架构设计

> ID：429468
> 
> 赞同：5
> 
> 时间：2009-01-09T19:55:54.510
> 
> 标签：mysql, database, database-design, schema

问候堆垛机，

我正在尝试为允许用户创建调查并将其展示给公众的应用程序提出最佳数据库模式。大多数调查（但不是全部）将包括一堆“标准”人口统计字段，例如名字、姓氏等。当然，用户可以创建无限数量的“自定义”问题。

我想到的第一件事是这样的：

```
Survey
  ID
  SurveyName

SurveyQuestions
  SurveyID
  Question

Responses
  SurveyID
  SubmitTime

ResponseAnswers
  SurveyID
  Question
  Answer 
```

但这每次我想查询数据时都会很糟糕。它似乎危险地接近[内平台效应](http://thedailywtf.com/Articles/The_Inner-Platform_Effect.aspx)

一个改进是在响应表中包含尽可能多的字段：

```
Responses
  SurveyID
  SubmitTime
  FirstName
  LastName
  Birthdate
  [...] 
```

然后，至少从这些常见列中查询数据是很简单的，我可以查询，比如说，每个回答过他们出生日期的调查的人的平均年龄。

但这似乎会使代码复杂一些。现在要查看调查中提出了哪些问题，我必须检查启用了哪些常见响应字段（我猜是使用调查中的位域）以及 SurveyQuestions 表中的内容。而且我必须担心特殊情况，例如，如果有人试图创建一个“自定义”问题，该问题与“响应”表中的“常见”问题重复。

这是我能做的最好的吗？我错过了什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T20:23:39.103

您的第一个模式是两者中更好的选择。此时，您不必担心性能问题。担心做出好的、灵活的、可扩展的设计。您可以稍后使用各种技巧来缓存数据并加快查询速度。使用不太灵活的数据库模式来解决甚至可能无法实现的性能问题是一个糟糕的决定。

此外，许多（可能是大多数）调查结果仅由少数人（活动组织者、管理员等）定期查看，因此您不会一直在数据库中查询所有结果。即使你是，表现也会很好。无论如何，您可能会以某种方式对结果进行分页。

第一个模式更加灵活。默认情况下，您可以包括姓名和地址等问题，但对于匿名调查，您根本无法创建它们。如果调查创建者只想查看每个人对 500 个问题中的三个问题的答案，那是一个非常简单的 SQL 查询。您可以设置级联删除以在删除调查时自动删除回复和问题。使用此模式也可以更轻松地生成统计信息。

这是您提供的架构的略微修改版本。我假设您可以弄清楚哪些数据类型在哪里:-)

```
    调查
      调查 ID（索引）
      标题

    问题
      question_id（索引，自动递增）
      survey_id（链接到调查->survey_id）
      问题

    回应
      response_id（索引，自动递增）
      survey_id（链接到调查->survey_id）
      提交时间

    答案
      answer_id（索引，自动递增）
      question_id（链接到 questions-question_id）
      回答

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T19:59:08.467

我建议您始终对数据库模式采用标准化方法，然后再决定是否出于性能原因需要创建解决方案。过早的优化可能很危险。过早的数据库反规范化可能是灾难性的！

我建议您坚持使用原始模式，然后在必要时创建一个报告表，该表是您的规范化模式的非规范化版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:08:56.717

一项可能有助于或可能不会帮助简化事情的更改是不将 ResponseAnswers 链接回 SurveyID。相反，为每个响应和每个问题创建一个 ID，并让您的 ResponseAnswers 表包含字段 ResponseID、QuestionID、Answer。尽管这需要为每个单元保留唯一的标识符，但这将有助于使事情更加规范化。响应答案不需要与他们正在回答的调查相关联，只需他们正在回答的特定问题和与之关联的响应信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:11:16.103

我在以前的工作中创建了一个客户调查系统，并提出了一个与您所拥有的非常相似的架构。它用于发送调查（在纸上）并将响应制成表格。

几个小区别：

*   调查**不是匿名**的，这在印刷表格中非常清楚。这也意味着您示例中的人口统计数据是事先知道的。

*   调查附带了一组问题，因此一个问题可以用于多个调查，并且可以独立于它出现的调查进行分析。

*   处理不同类型的问题变得很有趣——我们有 1-3 级（例如，更差/相同/更好）、1-5 级（非常差、差、好的、好、非常好）、是/否和评论.

    有特殊的代码来处理评论，但其他问题类型通常通过有一个问题类型表和每个类型的另一个有效答案表来处理。

为了使查询更容易，您可能可以创建一个函数来根据调查 ID 和问题 ID 返回响应。

# .net - 抽象类的命名约定

> ID：429470
> 
> 赞同：110
> 
> 时间：2009-01-09T19:56:12.730
> 
> 标签：.net, naming-conventions, abstract-class

我清楚地记得，有一次，微软推动的指导方针是将“Base”后缀添加到抽象类中，以消除它是抽象的事实。因此，我们有像`System.Web.Hosting.VirtualFileBase`, `System.Configuration.ConfigurationValidatorBase`, `System.Windows.Forms.ButtonBase`, 和当然的类`System.Collections.CollectionBase`。

但我注意到，最近，框架中的许多抽象类似乎并没有遵循这个约定。例如，以下类都是抽象的，但不遵循此约定：

*   `System.DirectoryServices.ActiveDirectory.DirectoryServer`

*   `System.Configuration.ConfigurationElement`

*   `System.Drawing.Brush`

*   `System.Windows.Forms.CommonDialog`

这就是我可以在几秒钟内鼓起的。所以我去查了官方文档是怎么说的，以确保我没有疯。我在 MSDN 的[Design Guidelines for Developing Class Libraries中找到了](http://msdn.microsoft.com/en-us/library/ms229042.aspx)[类、结构和接口的名称](http://msdn.microsoft.com/en-us/library/ms229040.aspx)。奇怪的是，我找不到将“Base”添加到抽象类名称末尾的指南。并且该指南不再适用于 1.1 版框架。

那么，我会失去它吗？这个指南曾经存在吗？是不是一句话就被抛弃了？在过去的两年里，我是否一直在自己创造长的班级名称？

有人在这里扔我一根骨头。

**更新** 我没疯。该指南存在。[Krzysztof Cwalina 在 2005 年对此表示不满。](https://docs.microsoft.com/en-us/archive/blogs/kcwalina/i-dont-like-the-base-suffix)

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-01-09T20:02:41.033

在[框架设计指南](http://www.amazon.co.uk/Framework-Design-Guidelines-Conventions-Libraries/dp/0321246756/ref=sr_1_2?ie=UTF8&qid=1231531546&sr=8-2)第 174 页中指出：

> **如果该类旨在用于公共 API，请**避免使用“Base”后缀命名基类。****

 **另外：http: [//blogs.msdn.com/kcwalina/archive/2005/12/16/BaseSuffix.aspx](http://blogs.msdn.com/kcwalina/archive/2005/12/16/BaseSuffix.aspx)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-09T20:09:16.933

此外，如果抽象类有一些将要使用的静态成员，“Base”可能会变得丑陋。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-09T20:00:36.530

我不记得有这样的指导方针。我相信你应该使用有意义的命名。有时抽象类只是为了给某些类（作为工具）提供通用功能而设计的，我认为应该有后缀。但是，在某些情况下，您希望将其用作多态层次结构的基础，而它本身并不完整。在这些情况下，我建议像普通类一样命名。

如您所见，您可能不会声明一个接受 ButtonBase 作为参数的方法。它旨在为子类提供最少的功能。但是，您可以将 a`ConfigurationElement`视为具有不同形式但本身并不完整的实体（因此它是抽象的）

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-10-27T14:58:26.030

有时 Base 仍然是必需的，尤其是当您同时提供一个具体类和一个抽象类以供某人扩展以创建具体实现时。
例如 Controller 和 ControllerBase（实际上 Controller 也是抽象的，但提供的功能比 ControllerBase 多得多）

在针对接口进行编程时，基本后缀很难看，所以我认为当抽象类主要像接口一样使用时，微软不使用它的指南适用。可能是公共 API 的意思。

关键是在某些情况下，使用 Base 后缀没有更好的选择。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-01-25T15:58:41.857

我理解避免使用基本后缀的倾向，但我也理解需要*一些*后缀。现在，[这篇文章](https://blogs.msdn.microsoft.com/kcwalina/2005/12/16/i-dont-like-the-base-suffix/)的评论建议使用“类型”作为后缀作为不使用任何后缀的第二选择。我认为这令人困惑，但是“这样一个不明确的词往往表明它是一个不明确的课程”的想法让我印象深刻。

**作为替代方案：**我更喜欢使用“种类”作为后缀，将对象声明为“属于或属于特定种族或家庭”（[维基词典：-kind](https://en.wiktionary.org/wiki/-kind)）。

示例：`DataProvider`并且`ReflectiveDataProvider`都是`DataProviderKind`

受到生物学的启发，例如“犬狼疮”属于“Canoidea”家族，它非常粗略地翻译为“狗样”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-05-18T12:08:19.220

微软表示，在：

[https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-classes-structs-and-interfaces](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-classes-structs-and-interfaces)

"✓ CONSIDER CONSIDER 派生类的名称以基类的名称结尾。这非常易读，并且清楚地解释了关系。代码中的一些示例是：ArgumentOutOfRangeException，这是一种 Exception，和 SerializableAttribute，这是一个kind 属性。但是，在应用此准则时使用合理的判断很重要；例如，Button 类是一种 Control 事件，尽管 Control 没有出现在其名称中。

一般来说，这隐含地排除了在名称中使用“Base”。

# c# - 我是否需要在 ASP.NET 中处理 Web 服务引用？

> ID：429478
> 
> 赞同：10
> 
> 时间：2009-01-09T19:58:14.100
> 
> 标签：c#, asp.net, web-services, dispose

垃圾收集器是否清理 Web 服务引用，或者在我调用完我调用的任何方法后，我是否需要在服务引用上调用 dispose？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-09T20:03:55.273

[您可以使用单例模式](http://csharpindepth.com/Articles/General/Singleton.aspx)只保留每个 Web 服务的单个实例，而不用担心如何处理您的 Web 服务。Web 服务是无状态的，因此它们可以安全地在 Web 服务器上的连接和线程之间共享。

这是一个 Web 服务类的示例，您可以使用它来保存对 Web 服务实例的引用。这个单例是惰性的并且是线程安全的。建议如果你让你的单例变得懒惰，它们也通过遵循相同的逻辑保持线程安全。要了解有关如何执行此操作的更多信息，请阅读有关[实施单例](http://csharpindepth.com/Articles/General/Singleton.aspx)的 C# 深度文章。

另外请记住，您可能会遇到 WCF Web 服务的问题。我建议阅读[WCF 的实例管理技术文章](http://msdn.microsoft.com/en-us/magazine/cc163590.aspx)，特别是单例部分，了解更多详细信息。

```
public static class WS
{
    private static object sync = new object();
    private static MyWebService _MyWebServiceInstance;

    public static MyWebService MyWebServiceInstance
    {
        get
        {
            if (_MyWebServiceInstance == null) 
            {
              lock (sync)
              {
                if (_MyWebServiceInstance == null)
                {
                    _MyWebServiceInstance= new MyWebService();
                }
              }
            }
            return _MyWebServiceInstance;
        }
    }
} 
```

然后当你需要访问你的网络服务时，你可以这样做：

```
WS.MyWebServiceInstance.MyMethod(...) 
```

或者

```
var ws = WS.MyWebServiceInstance;
ws.MyMethod(...) 
```

我已经在几个项目中成功地使用了这种模式并且效果很好，但是正如 tvanfosson 在下面的评论中提到的，更好的策略是使用 DI 框架来管理您的 Web 服务实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:27:23.450

我认为 DataService 从 Component 继承 Dispose。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T06:19:01.853

应手动处理实现 IDispose 的对象以协助垃圾收集器。

如果您的反对是短暂的，请使用`using`块。对于可以保留的对象，请确保保留它们的对象在也处置它们时处置它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T03:59:20.663

你想在这里完成什么？

如果您担心性能，那么我会更担心托管 Web 服务的服务器的响应能力和网络速度，因为它们会极大地影响您必须等待 Web 服务调用完成的时间长度（除非它是异步的）。

MSDN 上的示例不调用“Dispose”，并且很明显垃圾收集器会完成其工作，因此除非您在需要每秒处理内存中超过 100,000 条记录的实时系统上工作，否则您可能不需要上来通过一种方式来处理资源或管理内存。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-07-03T04:22:40.840

我认为上述答案中 Seabizkit 的担忧是非常合理的。这里引用它：

> @DanHerbert 当两个线程调用单例时会发生什么......让我解释一下......对象上有一个锁......以使其线程安全。这是否意味着如果 theard1 调用访问 webInstance，则 thread2 将等待 thread1 完成。或者是纯粹用于创建实例的锁。假设您有 10 个呼叫者....锁定是否意味着他们被链接...或异步，我想您会得到我要问的内容，如果不清楚，请告诉我。– Seabizkit 2016 年 10 月 13 日 10:01 <

在我进行了一些测试之后，我可以告诉**您，当多个不同的线程使用单个“客户端”对象时，您将无法获得任何良好的性能**。如果创建了十个线程并且它们都使用相同的单例“客户端”，那么它们将不得不排队等待，直到完成所有先前的调用。

要查看证明，请在此处阅读并运行此 c-sharpcorner 文章中的示例： [https ://www.c-sharpcorner.com/article/increase-performance-with-an-object-pool-or-why -singleton-may-cause-performance/](https://www.c-sharpcorner.com/article/increase-performance-with-an-object-pool-or-why-singleton-may-cause-performance/) 标题为“使用对象池提高性能或为什么 Singleton 可能导致性能问题”。

很抱歉打破了单例 Web 服务用户的泡沫。此外，您将很难找到 Microsoft 的示例，其中 Web 服务客户端被“囚禁”在单例中。

# php - 从 Mysql 表字段中提取数据并将其放入数组中

> ID：429483
> 
> 赞同：0
> 
> 时间：2009-01-09T19:59:49.057
> 
> 标签：php, mysql, arrays

我可以找到很多教程，向您展示如何将数组加载到数据库字段中，但似乎无法弄清楚如何将字段中的每个条目作为单独的项目拉入数组中。看起来很简单，只是无法让它工作，有什么帮助吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T20:07:55.923

如果使用现代 PDO 库，请使用[`PDOStatement->fetchAll()`](http://www.php.net/manual/en/pdostatement.fetchall.php)参数`fetch_style`设置为`PDO::FETCH_COLUMN`.

基于该页面的示例：

```
$sth = $dbh->prepare("SELECT field FROM dbtable");
$sth->execute();
$array = $sth->fetchAll(PDO::FETCH_COLUMN); 
```

如果使用旧的 MySQL API（不推荐，示例省略错误检查）

```
$array = array();
$result = mysql_query("SELECT field FROM dbtable");
while ($row = mysql_fetch_row($result)) {
     $array[] = $row[0];
}
mysql_free_result($result); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T21:11:05.873

下面的示例假设您的`SELECT`语句存储在 中`$select`，而您的连接存储在`$db`. 之后存储结果的二维数组`$rows`。

如果您正在使用`mysql`（对于`mysqli`程序，只需替换`mysql_`为`mysqli_`）：

```
$result = mysql_query($select, $db);

$rows = [];
while ($row = mysql_fetch_assoc($result) {
    $rows[] = $row;
} 
```

使用`mysqli`类：

```
$result = $db->query($select);

$rows = [];
while ($row = $result->fetch_assoc()) {
    $rows[] = $row;
}

$result->close() 
```

使用`PDO`：

```
$stmt = $db->query($select);
$stmt->execute();

$rows = $stmt->fetchAll(PDO::FETCH_ASSOC); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T20:07:07.157

```
$big_2_dimensional_array_of_data;

foreach ($big_array_of_data as $row) {
  $query = "INSERT INTO table_name (field1, field2, ...) VALUES($row[0], $row[1], ...)
  mysql_query($query);
} 
```

我认为类似的东西

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:14:54.240

在阅读了他的问题几次之后，我猜他想要做的是这样的：

```
$query = "SELECT field1, field2, ... fieldn FROM table;";
$r = mysql_query($query,$conn);
$row = mysql_fetch_assoc($r); 
```

我还是不太确定他到底想要什么……

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T20:21:49.683

我对这个问题的解释是，提问者在表格中插入了许多行，并且不知道如何处理将它们一次取出一个。（这个问题也可能是指数据序列化然后卡在一个字段中......但我希望不是！）

所以，这里是如何获取多行：

```
$query = "SELECT field1, field2, ... fieldn FROM table;";
$r = mysql_query($query,$conn);
$data = array();
while($row = mysql_fetch_assoc($r)) {
    $data[] = $row;
} 
```

您现在将获得查询返回的所有行 in `$data`，因此可以通过以下方式访问它：`$data[2]['field1']`

# macos - Macintosh C 创建导航窗口以选择应用程序

> ID：429486
> 
> 赞同：0
> 
> 时间：2009-01-09T20:00:36.717
> 
> 标签：macos, macos-carbon

我正在为 mac 编写一个 C 程序，我需要允许用户选择一个应用程序来发送一个苹果事件。我可以创建一个导航窗口，使用`NavCreateChooseFileDialog()`，但我不能让它启用任何 .app 文件。如果我使用 限制类型`NavDialogSetFilterTypeIdentifiers`，它将只允许我选择文件夹名称中没有 .app 的应用程序，例如 MS Office。其他一切都是灰色的。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-10T08:19:09.970

请记住，.app 包是目录，因此您可能需要启用某种允许目录（或更可能是启用包）选项。

很抱歉，我无法提供更具体的帮助。我从 Carbon 开始，但从未接触过导航服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T22:57:48.667

确保在 inOptions.optionFlags 中为 NavCreateChooseFileDialog 设置标志 kNavSupportPackages，并将“APPL”放在类型列表中（最好仍然使用该参数而不是 NavDialogSetFilterTypeIdentifiers()，这样您将在 10.3- 上运行）并且您应该好好去吧，我刚试过。

或者，如果您不介意使用 Cocoa，您可以使用 -[NSOpenPanel runModalForTypes:[NSArray arrayWithObjects:@"app", nil]] （其中还列出了非 .app 应用程序），然后您只是一个 FSPathMakeRef ((UInt8*)[路径文件系统表示], &fsRef, NULL); 远离 FSRef。

请记住，在任何一种情况下，您获得的文件都可能是别名，因此您必须尝试解析别名。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-04-15T06:01:51.747

这对我有用：

```
NSOpenPanel * panel = [ NSOpenPanel openPanel ] ;
panel.allowedFileTypes = @[ (__bridge id)kUTTypeApplication ] ;

[ panel runModal ] ; 
```

# javascript - Javascript：如何从类函数之一中的函数访问类属性

> ID：429487
> 
> 赞同：4
> 
> 时间：2009-01-09T20:00:52.223
> 
> 标签：javascript, oop, class-design

在我的某个类的某个函数中，我需要使用`setInterval`中断代码的执行。但是，在`setInterval`函数中，“this”不再指代“myObject”类。如何从`setInterval`函数中访问变量“名称”？

```
function myObject() {
    this.name = "the name";
}

myObject.prototype.getName = function() {
    return this.name;
}

myObject.prototype.test = function() {
    // this works
    alert(this.name);

    var intervalId = setInterval(function() {
        // this does not work
        alert(this.name);

        clearInterval(intervalId);
    },0);
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-09T20:04:26.007

```
myObject.prototype.test = function() {
    // this works
    alert(this.name);
    var oThis = this;
    var intervalId = setInterval(function() {
        // this does not work
        alert(oThis.name);

        clearInterval(intervalId);
    },0);
} 
```

这应该有效。匿名函数的“this”与 myObject 的“this”不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:32:53.610

这是原型绑定函数

```
Function.prototype.bind = function( obj ) {
    var _this = this;
    return function() {
        return _this.apply( obj, arguments );
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T20:05:44.210

这就是 Prototype 中的绑定：

```
function myObject() {
    this.name = "the name";
}

myObject.prototype.getName = function() {
    return this.name;
}

myObject.prototype.test = function() {
    // this works
    alert(this.name);

    var intervalId = setInterval(function() {
        // this does not work
        alert(this.name);

        clearInterval(intervalId);
    }.bind(this),0);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T22:43:11.630

请注意，s13james 的答案是不完整的，因为`bind()`它不是标准功能，必须在其他地方提供 - 一种方法是使用prototype.js Javascript 框架，而另一种方法是使用 meouw 的代码示例自己完成。

如果您不使用`bind()`（我必须说这很漂亮），那么 djangel 的响应就是您可以做的，也是我最常做的。

# client-server - 移动 CLI 验证/逻辑服务器端有什么问题吗？

> ID：429489
> 
> 赞同：1
> 
> 时间：2009-01-09T20:01:08.527
> 
> 标签：client-server, command-line-interface

我有一个客户端/服务器应用程序。其中一个客户端是 CLI。CLI 执行一些基本验证，然后向服务器发出 SOAP 请求。响应被解释并且相关信息被呈现给用户。每个命令都涉及对 Web 服务的请求。

每次在服务器端修改服务时，都需要发布一个新的 CLI。

我想知道的是，如果让我的 CLI 变得异常纤薄会不会有什么问题。它所要做的就是将命令字符串发送到服务器，在那里将对其进行验证、解释并返回响应字符串。

（即使是 TAB 完成也可以在服务器的配合下完成。）

我觉得在我的情况下，这将简化开发并减少维护工作。

有我忽略的陷阱吗？

**更新**

可扩展性问题不是高优先级。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T20:03:46.850

一般来说，你会没事的，但是如果可以及早拒绝错误的请求，客户端验证是减少工作量的好方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:15:37.293

我认为这真的只是一个品味问题。验证必须在某处进行；您只是在客户端的复杂性与软件中的相同复杂性之间进行权衡。这对你的架构来说不一定是坏事。您实际上只是提供了一项附加服务，为呼叫者提供了一种访问现有服务的替代方法。我要注意的唯一陷阱是代码重复。如果您发现您的 CLI 验证与您的某些服务执行相同的操作（例如解析数字），请重构以避免重复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:16:12.270

> 我想知道的是，如果让我的 CLI 变得异常纤薄会不会有什么问题。
> 
> ...
> 
> 我觉得在我的情况下，这将简化开发并减少维护工作。

多年来，人们一直在使用 telnet/SSH 远程处理在服务器上运行的 CLI。如果无论如何所有智能都必须在服务器上，那么可能没有理由让您的 CLI 成为具有智能的分布式客户端。让它成为一个终端会话 - 如果你可以使用 SSH，这就是我要做的 - 然后客户端部分完成一次（或者可能只是一个现成的软件）和所有的维护和升级发生在服务器上（欢迎来到 1978）。

当然，这仅在确实不需要客户聪明的情况下才真正适用（这听起来像您的情况）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:05:25.210

在请求字符串中使用名称/值对实际上非常普遍。但是，到那时，为什么还要使用 SOAP 呢？而是迁移到 RESTful 架构？

# winforms - MVP 和 UserControls 和调用

> ID：429500
> 
> 赞同：14
> 
> 时间：2009-01-09T20:04:19.767
> 
> 标签：winforms, design-patterns, user-interface, mvp

我在尝试了解一些 MVP 内容时获得了一些乐趣，因为它与用户控件有关。我正在使用.NET WinForms（或类似的东西）和监督控制器模式（嗯，我想我是:)。

用户控件本身就是 MVP 应用程序的一部分（它的视图和相关的演示者等）。Presenter 总是首先启动，它启动模型，然后是视图。View 构建它的 UI，其中一部分将用于 NEW UC，即 View。

现在（表单）Presenter 需要了解 UC Presenter，但我认为它对 View 的组成方式一无所知。例如，表单 Presenter 不知道 UC 是表单控件集合的一部分，也不应该知道。

此外，不应改变设计经验；IOW 视图（表单）的开发人员应该能够从工具箱中选择一个用户控件并将其拖放到表单上。

所以，关于我的问题。首先，我上面的假设是否正确？有点误入歧途？弄乱？你在想什么？

其次，让表单 View 调用 UC View 并且表单 Presenter 调用 UC Presenter 并有一些机制告诉 UC View 它的 Presenter 是正确的（足够吗？）？这违反了我的“演讲者优先”规则，但我不知道该怎么做。

任何其他想法、建议、评论都乐于接受。

--nwahmaet

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-15T15:33:19.030

演示者应该被认为是演示层中的“自治状态”。这意味着它负责确保视图对模型状态的表示是同步的。我提出这个的原因是因为 MVP 的“模式”经常迷失在应该*如何分离事物的教条观点中。*这似乎是 Martin Fowler 决定尝试[澄清围绕 MVP](http://martinfowler.com/eaaDev/ModelViewPresenter.html)模式的术语的原因之一。

我最喜欢的 MVP 风格是[被动视图](http://martinfowler.com/eaaDev/PassiveScreen.html)，所以我的回答是基于此。

我经常使用被动视图模式来实现复合用户控件和表单。基本上有3种不同的配置：

1.  层次结构中所有用户控件的一位演示者。使用界面展平视图。
2.  复合树中每个用户控件的一个演示者。每个父 Presenter 负责实例化和初始化其子 Presenter。用户控件是在设计时创建的，并且能够在没有演示者的情况下运行（没有演示行为）
3.  复合树中每个用户控件的一个演示者。所有的演示者都通过更高级别的控制器类松散耦合。控制器类负责构建演示者，将它们连接起来，并协调它们的事件。

尽管它对我来说是最后的解决方案（因为它的复杂性），但我认为最后一个选择是您正在寻找的解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T01:25:20.897

在我正在开发的应用程序中，几个月来我一直在遇到这个确切的问题。我最近得出的结论是，在许多情况下，在不“破坏”模式的情况下，可能无法在窗口和用户控制级别应用 MVP 模式。

我的想法是用户控件是视图实现的一部分，演示者不应该知道视图实现内部发生了什么，这意味着扩展的窗口级演示者不应该知道用户控件的演示者，因此它们之间不应该有任何通信，包括前者对后者的实例化。可能有人认为用户控件的演示者是窗口视图实现的一部分，因此窗口视图可以实例化用户控件演示者。但它不能注入演示者需要的模型类，因为视图不应该知道它们。

我认为我得出的结论是所有用户控件都是特定于视图实现的，因此应该完全包含在更大模式的视图筒仓中。因此，他们没有自己的演示者……至少没有与控制实现本身捆绑在一起。相反，它们应该由父窗口的演示者通过在视图界面上公开的传递字段间接操作。简而言之，用户控件不是通过其自己的界面向演示者公开的，而是通过其父视图实现的通用传递接口。将此称为“局部视图界面”。

然后，您的演示者可以包含可重用的子演示者类的实例，该类仅适用于此部分视图界面和模型的相关部分。这将允许您避免在每次需要使用控件时重新编写演示者代码以从模型进行转换，并且它可以防止窗口视图需要了解模型以便将信息传递给控件的演示者。

这有效地做的是它进一步将用户控件作为一个模块从您的数据模型中分离出来。如果您将用户控件作为一个整体视为视图实现的一个元素，那么这是有道理的。作为一个可重用的单元，它是一个视图功能，它的任何部分都不应该与您的数据模型相关联。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T20:30:11.367

您的问题很笼统，可以应用多种方案。

在这种情况下，我的猜测是您应该查看观察者模式。

你有一个接口，任何使用该视图的东西都可以实现。然后，当应用程序使用这些接口的集合进行初始化时，它会注册自己。任何需要更新该视图的命令都将遍历集合，通知每个视图都应该更新。

与典型示例不同，视图将是用户控件。您可以灵活地使任何 UI 元素实现该界面，因此除了用户控件之外，您还可以使用对话框、完整表单等。

最后记住用户控件不是视图，而是视图的实现。无论您采用哪种方案，您都可以根据需要定义视图的深度，并让用户控件实现该接口。

# oracle - 是否有在 pl/sql for 循环中说“下一个”的替代方法？

> ID：429508
> 
> 赞同：3
> 
> 时间：2009-01-09T20:05:50.513
> 
> 标签：oracle, plsql, controls, for-loop

所以我有一个 for 循环来处理一个 ID 列表并且有一些相当复杂的事情要做。不涉及所有丑陋的细节，基本上是这样的：

```
    宣布
      l_selected APEX_APPLICATION_GLOBAL.VC_ARR2；

      ……剪……
    开始

      -- 获取列表ID
      l_selected := APEX_UTIL.STRING_TO_TABLE(:P4_SELECT_LIST);
      -- 在一个很好的循环中处理每个
      FOR i IN 1..l_selected.count
      环形
        - 做一些数据检查的东西......

        -- 在这里我们将寻找重复的条目，所以如果发现重复我们可以 noop
        开始
          从 org_county_accountable 中选择county_id 到v_dup_check
          其中organization_id = :P4_ID AND County_id = v_county_id；
          -  下一个;！不；！但没有下一个！
        当 NO_DATA_FOUND THEN 时出现异常
          dbms_output.put_line('没有找到副本，继续');
        结尾;
        -- 这里有我们只想在没有欺骗的情况下执行的代码
        如果 v_dup_check 为空 那么
          -- 如果不是重复记录，请继续...

        别的
          -- 重置重复检查变量
          v_dup_check := NULL;
        结尾;
      结束循环；
    结尾;

```

我通常如何处理这个问题是通过选择一个值，然后将以下代码包装在 IF 语句中检查以确保重复检查变量为 NULL。但这很烦人。我只想说NEXT；或 NOOP；或者其他的东西。特别是因为我已经必须捕获 NO_DATA_FOUND 异常。我想我可以给甲骨文写一封信，但我很好奇其他人是如何处理这个问题的。

我也可以将它包装在一个函数中，但我正在寻找更清洁/更简单的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T20:28:43.773

Oracle 11g 向 PL/SQL 中添加了 C 风格的“继续”循环结构，这在语法上听起来就像您正在寻找的那样。

出于您的目的，为什么不在进入循环之前消除重复项？这可以通过使用表函数查询 l_selected 来完成，然后过滤掉您不想要的记录，而不是遍历**每个**值。就像是...

```
declare

l_selected APEX_APPLICATION_GLOBAL.VC_ARR2;

cursor no_dups_cur (p_selected APEX_APPLICATION_GLOBAL.VC_ARR2) is 
  select * from (
  select selected.*, 
         count(*) over (partition by county_id) cnt -- analytic to find counts grouped by county_id
    from table(p_selected) selected -- use table function to treat VC_ARR2 like a table 
    ) where cnt = 1 -- remove records that have duplicate county_ids
    ;

begin

l_selected := APEX_UTIL.STRING_TO_TABLE(:P4_SELECT_LIST);

for i in no_dups_cur(l_selected) loop

  null; -- do whatever to non-duplicates 

end loop;

end; 
```

只需用您自己的逻辑替换确定“重复”的逻辑（您的示例中没有足够的信息来真正回答该部分）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T20:28:21.357

与其捕获`NO_DATA_FOUND`，不如将匹配条目的数量选择到变量中，例如`l_count`，如果该计数为零，则继续进行？类似于以下内容：

```
    宣布
      l_selected APEX_APPLICATION_GLOBAL.VC_ARR2；
      l_count 整数；

      ……剪……
    开始

      -- 获取列表ID
      l_selected := APEX_UTIL.STRING_TO_TABLE(:P4_SELECT_LIST);
      -- 在一个很好的循环中处理每个
      FOR i IN 1..l_selected.count
      环形
        - 做一些数据检查的东西......

        -- 这里我们将计算重复的条目，所以如果发现重复我们可以 noop
        从 org_county_accountable 中选择 COUNT(*) 到 l_count
         其中organization_id = :P4_ID AND County_id = v_county_id；
        如果 l_count = 0 那么
          -- 这里有我们只想在没有欺骗的情况下执行的代码
          -- 如果不是重复记录，请继续...

        万一;
      结束循环；
    结尾;

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:55:22.737

`when_no_data_found exception`也可以计算行数（请参阅 Pourquoi Litytestdata），但您也可以在块中执行您想要执行的操作。

```
declare 
  l_selected    apex_application_global.vc_arr2;
  l_county_id   org_county_accountable.count_id%type;
begin
  l_selected := apex_util.string_to_table(:p4_select_lst);
  for i in l_selected.first..l_selected.last loop
    begin
      select count_id
      into   l_county_id
      from   org_county_accountable
      where  organization_id = :p4_id
      and    county_id       = v_county_id;
    exception
      when no_data_found then 
        -- here we have code we only want to execute if there are no dupes already
        -- if not a duplicate record, proceed...
    end;
  end loop;
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-20T18:03:28.723

```
<xmp>
<<next_loop>>
loop
...
...
if ....
then
   goto next_loop;

</xmp> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T20:26:04.170

这是 GOTO 语句*可能*有用的情况。请参阅控制结构中的[Oracle 文档](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/controlstructures.htm#BCGFGDAA)以了解如何执行此操作。此外，您可能想在此处搜索以了解如何查询记录的存在。运行查询并等待异常并不是最优的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-14T17:31:18.480

另一种方法 - 将检查转换为本地函数：

```
DECLARE
  l_selected APEX_APPLICATION_GLOBAL.VC_ARR2;

  ...snip...
  FUNCTION dup_exists 
     ( p_org_id org_county_accountable.organization_id%TYPE
     , p_county_id org_county_accountable.county_id%TYPE
     ) RETURN BOOLEAN 
  IS
    v_dup_check org_county_accountable.county_id%TYPE;
  BEGIN
    SELECT county_id INTO v_dup_check FROM org_county_accountable
    WHERE organization_id = p_org_id AND county_id = p_county_id;
    RETURN TRUE;
  EXCEPTION WHEN NO_DATA_FOUND THEN
    RETURN FALSE;
  END;
BEGIN

  -- get the list ids
  l_selected := APEX_UTIL.STRING_TO_TABLE(:P4_SELECT_LIST);
  -- process each in a nice loop
  FOR i IN 1..l_selected.count
  LOOP
    -- do some data checking stuff...

    -- here we have code we only want to execute if there are no dupes already
    IF NOT dup_exists (:P4_ID, v_county_id) THEN
      -- if not a duplicate record, proceed...

    END;
  END LOOP;
END; 
```

当然，如果您愿意，可以重写本地函数以使用 count 方法：

```
 FUNCTION dup_exists 
     ( p_org_id org_county_accountable.organization_id%TYPE
     , p_county_id org_county_accountable.county_id%TYPE
     ) RETURN BOOLEAN 
  IS
    l_count INTEGER;
  BEGIN
     SELECT COUNT(*) INTO l_count 
       FROM org_county_accountable
      WHERE organization_id = p_org_id AND county_id = p_county_id;
     RETURN (l_count > 0);
  END; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T17:53:33.770

另一种方法是引发和处理用户定义的异常：

```
DECLARE
  l_selected APEX_APPLICATION_GLOBAL.VC_ARR2;
  duplicate_org_county EXCEPTION;

  ...snip...
BEGIN

  -- get the list ids
  l_selected := APEX_UTIL.STRING_TO_TABLE(:P4_SELECT_LIST);
  -- process each in a nice loop
  FOR i IN 1..l_selected.count 
  LOOP
    BEGIN
      -- do some data checking stuff...

      -- here we will look for duplicate entries, so we can noop if duplicate is found
      BEGIN
        SELECT county_id INTO v_dup_check FROM org_county_accountable
        WHERE organization_id = :P4_ID AND county_id = v_county_id;
        RAISE duplicate_org_county;
      EXCEPTION WHEN NO_DATA_FOUND THEN
        dbms_output.put_line('no dups found, proceeding');
      END;
      -- here we have code we only want to execute if there are no dupes already

    EXCEPTION
      WHEN duplicate_org_county THEN NULL;
    END;
  END LOOP;
END; 
```

我通常不会这样做，但如果有六个理由跳转到下一条记录，这可能比多个嵌套的 IF 更可取。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-02T13:42:31.230

我知道这是一个老歌，但我不禁注意到上面的答案都没有考虑游标[属性](http://docstore.mik.ua/orelly/oracle/langpkt/ch01_09.htm)：

有四个与游标相关的属性：ISOPEN、FOUND、NOTFOUND 和 ROWCOUNT。可以使用 % 分隔符访问这些属性，以获取有关游标状态的信息。

游标属性的语法是：

```
cursor_name%attribute 
```

其中 cursor_name 是显式游标的名称。

因此，在这种情况下，您可以出于您的目的使用 ROWCOUNT （表示到目前为止获取的行数），如下所示：

```
declare 
   aux number(10) := 0;
   CURSOR cursor_name is select * from table where something;
begin
     select count(*) into aux from table where something;
     FOR row IN cursor_name LOOP
        IF(aux > cursor_name%ROWCOUNT) THEN 'do something is not over';
        ELSE 'do something else';
        END IF;
     END LOOP;
end; 
```

# php - 为什么 iframe 内容为空？

> ID：429510
> 
> 赞同：0
> 
> 时间：2009-01-09T20:06:38.327
> 
> 标签：php, javascript, iframe

我试图理解这段代码：

在 display.php 中：

```
<html>
...
<body>
  <table>
     <tr>
       <td>
         User info: <iframe id="SpControlFrame1" name="SpControlFrame1" src="javascript:'';"path_src="index.php?cmd=YYY" ></iframe>
        </td>
     </tr>
   </table>
 </body>
 </html> 
```

在另一个文件中，我有一个 switch 语句：

主文件

```
switch ("cmd") {
 case ZZZ:
   include("foo.php");
   break;
 case YYY:
   include("blah.php")
   break;
} 
```

废话.php：

```
<?php
 //some functions for processing
?>
<html>
 <head>
  ...
 </head>
 <body>
   <input type="text" size="12" name="username">
   <input type="button" value="submit">
  </body>
</html> 
```

1）那么，有人能解释一下这里发生了什么吗？iframe 嵌入在页面中，不会导致重新加载或类似的事情。

2）我正在尝试在另一个页面上复制此功能，但 iframe 始终为空（我已使用 IE 开发人员工具栏对此进行了验证）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T20:15:36.123

如果没有看到有问题的代码，我真的无法说出发生了什么。您的示例假定有问题的代码是服务器端的，并且当满足特定变量/条件时，iframe 由 blah.php 创建或填充。

您必须确保在创建另一个 iframe 时调用相同的代码。也许您可以扩展有问题的代码？原始来源和新来源（不是 iframe，而是包含文档）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T10:20:46.730

这对你有什么作用？

```
User info: <iframe id="SpControlFrame1" name="SpControlFrame1" src="index.php?cmd=YYY" ></iframe> 
```

# apache - 阿帕奇重写

> ID：429514
> 
> 赞同：0
> 
> 时间：2009-01-09T20:07:55.127
> 
> 标签：apache, mod-rewrite

我想将所有请求代理到 Mongreel，除了一些在 apache 上使用 fastcgi 运行的 ruby​​ 应用程序。

所以基本上我有[http://domain.com/](http://domain.com/) Mongreel 应用程序
[http://domain.com/appa](http://domain.com/appa)由 apache 处理的 ruby​​ 应用程序 http://domain.com/app_testb 由 apache
[处理](http://domain.com/app_testb)的ruby​​ 应用程序

我的 httpd.conf 看起来像这样：

```
RewriteEngine On
RewriteCond $1 !^(appa|app_testb)
RewriteRule ^(.*)$ http://127.0.0.1:port/$1 [P] 
```

但它失败了。 [http://doamin.com](http://doamin.com)按预期工作，代理到 Mongreel，但其他 2 个应用程序不由 apache 处理。知道我的配置有什么问题吗？

**更新**或者我怎样才能为除 /appa/* 和 /app_testb/* 之外的所有东西启用 mod_proxy ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T20:15:44.627

正确的方法是

```
重写引擎开启
RewriteCond %{REQUEST_URI} !appa
RewriteCond %{REQUEST_URI} !appb
重写规则 ^(.*)$ http://127.0.0.1:port/$1 [P]

```

RewriteConds 看不到规则中匹配的内容

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T20:58:38.283

看来我找到了一种方法：

```
ProxyPass /appa !
ProxyPass /app_testb !
ProxyPass / http://127.0.0.1:port/
ProxyPassReverse / http://127.0.0.1:port/ 
```

# iphone - 自动释放 iPhone

> ID：429524
> 
> 赞同：2
> 
> 时间：2009-01-09T20:09:49.163
> 
> 标签：iphone, cocoa-touch, memory-management, autorelease

在开发 iPhone 应用程序即将结束时，我想知道在为 iphone 开发时使用 autorelease 有多糟糕。我面临着一些相当随机的崩溃，到目前为止，除了马虎的内存使用之外，我无法确定它是什么。

作为一个 Cocoa 新手，我记得最初阅读了一份指南文档，该文档强烈建议避免自动释放以支持 iPhone 的手动保留/释放。然而，一个更“高级”的 Cocoa 开发人员很早就加入了（具有讽刺意味的是，自那以后他就被解雇了），他在所有地方都使用了 autorelease。诚然，我进入了“猴子看猴子做”模式，它似乎又回来困扰着我（我现在是该项目的唯一开发人员）。

那么接下来该怎么做呢？在我看来，我必须对代码进行分支并尝试在可能的情况下通过并替换自动释放代码，让我的手指交叉，以免我无意中破坏了应用程序。似乎很多库调用会导致自动释放对象，如 stringWithFormat 以及我自己不使用 alloc 的几乎任何东西。我应该注意的任何其他问题和/或建议？感谢可可大师。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-09T20:14:54.380

使用 release 而不是 autorelease 可以提高内存使用率（这在 iPhone 上很好），但如果您不遵循保留/释放规则，它对崩溃毫无帮助。如果你对你应该做什么仍然有点模糊，我会阅读一些关于 Obj-C 内存管理的教程，然后使用调试器和崩溃报告来追踪这些崩溃，找出你在哪里过度释放对象. [这](http://www.cocoadev.com/index.pl?MemoryManagement)和[这](http://www.cocoadev.com/index.pl?RulesOfThumb)是两个很好的起点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-10T10:39:12.607

比自动发布或手动发布选择更重要的是您`alloc`和`dealloc`您`NSAutoreleasePool`的 s. 由于大多数 Cocoa 框架都`autorelease`自由使用，因此您需要有一个适当的池耗尽策略。一旦做到这一点，是否选择`release`或`autorelease`成为问题就变得不那么重要了。

话虽如此，您应该担心的唯一领域是紧密循环——`NSAutoreleasePool`每隔几次迭代分配和释放一次以获得最佳结果；并且当您生成另一个`NSThread`没有 Runloop 的池时，创建一个池并每隔一段时间将其排空就会变得空闲。由于大多数应用程序只为每个事件分配少量数据，`UIKit`因此在调度事件之前分配池并在调度返回后释放它的策略非常有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-20T05:10:26.367

如果您认为您不知道如何使用自动释放，请查看 iTunes U 上的 CS193p FALL 2010 -> Lecture number 4。

它教你所有关于内存管理和东西的知识（如果你跳过前 10 分钟左右）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:47:51.893

出于 iPhone 性能的原因，Apple 建议您尽可能不要使用自动释放的对象。相反，当你完成它们时，显式地释放你的对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-27T03:24:33.797

使用自动释放池意味着您可能会留下一些未使用的内存。由于 iPhone 的内存较少，如果您尽快释放不需要的内存，而不是让它在等待自动释放时占用资源，您可能会提高性能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-08T07:28:49.073

当您自动释放时，您基本上是在说：“我不再需要它，但其他人可以自由地拿起它（在自动释放池耗尽之前）”。当您明确释放一个对象时，您是在说：“我不再需要它，除非其他人已经说过（获得），否则应该立即释放它。”

因此，自动释放通常不是错误的事情。当您想将对象传递回消息的发送者而不要求发送者负责释放对象时，它是必需的。

# asp.net-mvc - 从 ASP.NET MVC 中的表中解析表单发布值？

> ID：429527
> 
> 赞同：1
> 
> 时间：2009-01-09T20:10:02.627
> 
> 标签：asp.net-mvc

好的，我是来自 webforms 背景的 MVC 新手，所以请原谅这里的任何无知。这是我的场景。我有一个包含应用程序列表和相关权限的表。每个表格行包含 3 条信息：一个复选框、一些描述该行的文本和一个允许用户为应用程序选择适当权限的下拉列表。我想发布这些数据，并且只使用表中被检查的行（行的 id 作为复选框名称嵌入）。从那里，我想从 DropDownList 中获取选定的值，并调用必要的代码来更新数据库。这是我的查看页面的代码：

```
 <%foreach (var app in newApps)
              { %>
                <tr>
                    <td><input type="checkbox" name="AddApps" value="<%=app.ApplicationId %>" /></td>
                    <td><%=Html.Encode(app.ApplicationName)%></td>
                    <td><%=Html.DropDownList("AppRole", new SelectList(app.Roles, "RoleId", "RoleDescription"))%></td>
                </tr>
              <%} %> 
```

当我在表单发布上到达控制器时，如何从 FormCollection 中检索适当的值？过去，当我只有通过调用 Request.Form["CheckBoxName"] 并解析字符串来检索复选框值时，我已经这样做了。

还是我完全错了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T22:04:06.420

为了发布您的数据，控制器可以读取它必须在表单中的信息，您已经成功了一半：

```
 <% using(Html.BeginForm("Retrieve", "Home")) %>//Retrieve is the name of the action while Home is the name of the controller
       <% { %>
            <%foreach (var app in newApps)              { %>  
          <tr> 
               <td><%=Html.CheckBox(""+app.ApplicationId )%></td>      
          <td><%=Html.Encode(app.ApplicationName)%></td>
                <td><%=Html.DropDownList("AppRole", new SelectList(app.Roles, "RoleId", "RoleDescription"))%></td> 
           </tr>  
        <%} %>
       <input type"submit"/>
     <% } %> 
```

在你的控制器上：

```
 public ActionResult Retrieve()
    {
        //since all variables are dynamically bound you must load your DB into strings in a for loop as so:
      List<app>=newApps;
      for(int i=0; i<app.Count;i++)
      {

        var checkobx=Request.Form[""+app[i].ApplicationId];
        // the reason you check for false because the Html checkbox helper does some kind of freaky thing for value true: it makes the string read "true, false"
          if(checkbox!="false")
          {
          //etc...almost same for other parameters you want that are in thr form
          }

       }
    //of course return your view
    return View("Index");//this vaires by the name of your view ex: if Index.aspx
   } 
```

该站点提供了有关如何处理下拉列表助手的更多详细信息：

[http://quickstarts.asp.net/previews/mvc/mvc_HowToRenderFormUsingHtmlHelpers.htm](http://quickstarts.asp.net/previews/mvc/mvc_HowToRenderFormUsingHtmlHelpers.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T22:08:57.300

Request.Form 仍然有效，只是您的复选框都具有相同的名称。

因此，一种方法是为复选框赋予不同的名称，例如“AddApps-app.id”，并使用 Request.Form。

然而，更优雅和可测试的方式是使用列表绑定。

在这个模型中，您给表单元素一个特定的结构化名称，默认模型绑定器会将每组表单元素包装到控制器中的类型化记录列表中。[这在这篇博文中得到了充分的解释](http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx/ "模型绑定到列表")。

这里的优点是您的控制器仅处理应用程序类型的实例，因此对视图的结构方式没有隐式依赖。因此，单元测试非常容易。

# c# - C#中变量名前的@符号是什么意思？

> ID：429529
> 
> 赞同：583
> 
> 时间：2009-01-09T20:10:42.000
> 
> 标签：c#, variables, naming, specifications, reserved-words

> **可能重复：**
> [C# 中变量名中的 @ 字符的用途/含义是什么？](https://stackoverflow.com/questions/91817/whats-the-use-meaning-of-the-character-in-variable-names-in-c)

我知道可以在字符串文字之前使用 @ 符号来更改编译器解析字符串的方式。但是，当变量名以 @ 符号为前缀时，这意味着什么？

* * *

## 回答 #1

> 赞同：738
> 
> 时间：2009-01-09T20:12:58.063

@ 符号允许您使用保留字。例如：

```
int @class = 15; 
```

上述工作，当以下不会：

```
int class = 15; 
```

* * *

## 回答 #2

> 赞同：444
> 
> 时间：2009-01-09T20:17:46.493

@ 符号在 C# 中有两个用途：

首先，它允许您使用保留关键字作为变量，如下所示：

```
int @int = 15; 
```

第二个选项允许您指定一个字符串，而不必转义任何字符。例如 '\' 字符是一个转义字符，所以通常你需要这样做：

```
var myString = "c:\\myfolder\\myfile.txt" 
```

或者你可以这样做：

```
var myString = @"c:\myFolder\myfile.txt" 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-01-09T20:26:27.070

其他答案忘记的重要一点是，“@keyword”在 CIL 中被编译为“keyword”。

因此，如果您有一个框架，例如，F#，它要求您定义一个具有名为“class”的属性的类，您实际上可以这样做。

它在实践中并没有*那么*有用，但没有它会阻止 C# 进行某些形式的语言互操作。

我通常看到它不是用于互操作，而是为了避免关键字限制（通常在局部变量名上，这是*唯一*的效果），即。

```
private void Foo(){
   int @this = 2;
} 
```

但我强烈反对！只需找到另一个名称，即使变量的“最佳”名称是保留名称之一。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-01-09T20:13:41.683

它允许您使用 C# 关键字作为变量。例如：

```
class MyClass
{
   public string name { get; set; }
   public string @class { get; set; }
} 
```

# windows - 适用于 Windows 的轻量级进程执行计时器

> ID：429536
> 
> 赞同：0
> 
> 时间：2009-01-09T20:13:33.943
> 
> 标签：windows, performance, unix, time

是否有一个轻量级的进程执行计时器，如 Windows 中包含的 Unix[时间](http://en.wikipedia.org/wiki/Time_(Unix))？有时我只是想要一个粗略的估计，而不必使用真正的分析器。虽然我可以自己动手，但我更喜欢使用现有的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T20:17:32.050

您可以在 cygwin.org 上获取 cygwin 的发行版 - 它有许多命令行工具，您发现在 Unix 上对 WIN32 很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:35:29.173

您可以使用[procmon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)或从 msys/cygwin 获取“时间”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:51:28.580

我使用 Windows Resource Kit 中的[timethis](http://www.microsoft.com/downloads/details.aspx?familyid=913795CD-7026-4143-AE85-1F5E096F9BE0&displaylang=en)工具。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:18:47.257

```
 System.Diagnostics.Stopwatch sw = new System.Diagnostics.Stopwatch();
    sw.Start();
    //do your processing
    sw.Stop();

    Console.WriteLine(sw.ElapsedMilliseconds); 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-01-09T20:34:25.477

Ctrl-Alt-Delete：然后选择“任务管理器”，有一个进程选项卡

# c# - 我可以按类型获取 C# 委托的签名吗？

> ID：429552
> 
> 赞同：61
> 
> 时间：2009-01-09T20:16:19.603
> 
> 标签：c#, reflection, delegates

如果您有委托的类型信息，是否有一种直接的方法使用反射来获取委托的参数列表？

例如，如果我声明一个委托类型如下

```
delegate double FooDelegate (string param, bool condition); 
```

然后获取该委托类型的类型信息，如下所示

```
Type delegateType = typeof(FooDelegate); 
```

是否可以从该类型信息对象中检索返回类型 (double) 和参数列表 ({string, bool})？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-01-09T20:19:44.167

```
 MethodInfo method = delegateType.GetMethod("Invoke");
    Console.WriteLine(method.ReturnType.Name + " (ret)");
    foreach (ParameterInfo param in method.GetParameters()) { 
        Console.WriteLine("{0} {1}", param.ParameterType.Name, param.Name);
    } 
```

# windows - 计划任务：使用 Windows 批处理脚本清理目录

> ID：429567
> 
> 赞同：2
> 
> 时间：2009-01-09T20:21:12.277
> 
> 标签：windows, batch-file, cmd

我有一个共享磁盘，我想每周使用某种计划任务清理一次。我想使用一个批处理脚本，以便系统管理员可以在需要时轻松修改它或在其他目录上重用它。

该目录包含具有多个文件扩展名的文件，但需要删除的文件以 .bkf 结尾，并且必须超过 2 周。

有没有人有这个 Windows 服务器的批处理脚本解决方案（不确定哪个版本）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T21:07:14.833

如果您有 PowerShell（或可以安装），请查看此链接： [http://thepowershellguy.com/blogs/posh/archive/2007/12/13/hey-powershell-guy-how-can-i-delete-files-that-are-a-specified-number-of-hours-旧的.aspx](http://thepowershellguy.com/blogs/posh/archive/2007/12/13/hey-powershell-guy-how-can-i-delete-files-that-are-a-specified-number-of-hours-old.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-03T17:29:09.793

看看这个页面 -[从命令行调度任务](http://forums.techarena.in/windows-server-help/748580.htm)

它向您展示了从命令行创建计划任务的热度。您也许可以将它与其他 dos 命令结合使用来获得结果。

唯一需要在批处理文件中的是

```
@echo off
cls
del C:\some\directory\*.bkf 
```

并且删除路径也可以作为参数发送到这个批处理脚本，以便目录是可变的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-11T13:40:05.157

我最终只是编写了一个接受参数并安排它的 EXE。不幸的是，其他解决方案没有所需的灵活性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-11T18:30:38.990

你看过forfiles.exe吗？

[http://blog.stevienova.com/2007/02/27/forfiles-delete-files-older-than-x-amount-of-days/](http://blog.stevienova.com/2007/02/27/forfiles-delete-files-older-than-x-amount-of-days/)

# iis-7 - IIS7 - MaxProcesses 做什么？

> ID：429575
> 
> 赞同：1
> 
> 时间：2009-01-09T20:23:15.813
> 
> 标签：iis-7

有谁知道这个值是干什么用的？

如果它设置为 1，那么似乎您一次只能有一个请求发送到服务器。例如，我们有一个可以正常加载的经典 ASP 文件，但其中也有图像（来自服务器上的同一脚本）。页面将加载，但图像永远不会加载......页面永远旋转。

提高 IIS7 中的 MaxProcesses 值可以解决此问题，但是每次生成新进程时，我们都会遇到会话值不持久的问题，以及当 MaxProcesses 设置为 1 时我们无法获得的长页面加载问题。

可能还有其他一些我不知道的设置与此配合使用。

[请参阅此问题以获取答案](https://stackoverflow.com/questions/587420/iis7-only-serves-up-one-page-at-a-time-its-a-making-me-crazy)（服务器端调试已打开）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T20:25:38.257

获取或设置与应用程序池关联的工作进程数。默认 = 1；非 1 值表示 Web 园。在这种情况下，如果要保留会话，则需要为会话选择一个 out of proc 方法（例如使用 SQL Server）。

# clickonce - 单击一旦 Setup.exe 使用 IIS 返回 404

> ID：429580
> 
> 赞同：7
> 
> 时间：2009-01-09T20:24:42.270
> 
> 标签：clickonce

每当我尝试安装 Click Once 应用程序时，我总是从 setup.exe 文件中收到 404 错误。我检查了 Web 服务器指向的物理文件夹，并确认 setup.exe 存在于正确的位置。

如果我使用 file://path/to/index.html 打开网页，CO 部署也可以正常工作

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-09T20:26:03.793

为自己记录答案，以便我以后查找

在 IIS 中，检查以确保在文件夹的“属性”、“主目录”选项卡、“应用程序设置”部分中，它正在运行“仅脚本”而不是“脚本和可执行文件”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T20:27:42.700

在主目录选项卡上 IIS 的网站属性中，确保您已将执行权限设置为仅脚本而**不是**脚本和可执行文件。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-27T11:37:51.590

如果您使用的是 IIS 7 或更高版本，请转到**处理程序映射**功能，并删除**CGI**映射。然后您的*setup.exe*将用作通常的静态文件。

# c# - 使用 GridView 和 ItemTemplates (ASP.net/C#)

> ID：429586
> 
> 赞同：1
> 
> 时间：2009-01-09T20:26:19.427
> 
> 标签：c#, asp.net, gridview

我有一个通过数据库填充的 GridView，在我拥有的 GridView 标记内：

```
<Columns>
  <asp:TemplateField>
    <ItemTemplate><asp:Panel ID="bar" runat="server" /></ItemTemplate>
  </TemplateField>
</Columns> 
```

现在，我希望能够（在代码中）将宽度属性应用于生成的每一行的“栏”面板。我将如何定位这些行？根据数据库中该行的值，每行的宽度属性将是唯一的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T20:30:53.583

```
<asp:Panel ID="bar" runat="server" Width='<%# Eval("Width") %>' /> 
```

如果您愿意，您可以更改`Eval("Width")`为计算宽度的表达式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T21:37:11.390

如果可以的话，我建议你不要使用 Eval，因为它有点慢。在这种情况下，我通常更喜欢将我的数据源转换为他的基本类型：

```
<Columns>
  <asp:TemplateField>
    <ItemTemplate>
    <asp:Panel ID="bar" runat="server" Width='<%# ((yourCustomData)Container.DataItem).Width %>' />
    </ItemTemplate>
  </TemplateField>
</Columns> 
```

where`yourCustomData`是数据源的行类型（即 a 的元素`List<>`）。

这种方法确实比 Eval 快。

编辑：哦，不要忘记在页面中包含对包含的名称空间的引用`yourCustomData`

```
<%@ Import Namespace="yourNameSpace.Data" %> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:56:52.753

我建议您将回调处理程序附加到 OnRowDataBound 事件。每个行绑定都会触发一个事件，您可以在回调处理程序中处理该事件。

在该回调处理程序中，您可以获得有关绑定到行的项目的信息，并根据数据库中的值应用宽度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:31:31.273

您将要处理 GridView 的`RowCreated`事件。这发生在 GridView 创建每一行之后，您可以通过编程方式访问该行以及其中包含的所有控件。

[这是该活动的 MSDN 页面。](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowcreated.aspx)

# c# - 在 asp.net MVC 中导出 HTML 表

> ID：429588
> 
> 赞同：7
> 
> 时间：2009-01-09T20:26:29.270
> 
> 标签：c#, asp.net-mvc

我试图导出一个名为 Table 的 HTML 表，该表在 C# 中动态绑定到 ViewData.Model。我有一个名为 export 的方法，它是基于另一个方法的操作调用的。所以之前的一切都设置好了..我只是不知道如何将数据导出到 CSV 或 Excel 文件..所以当我进入导出方法时，我不知道接下来要做什么来导出表格. 有人能帮我吗

```
 public void Export(List<data> List)
    {
     //the list is the rows that are checked and need to be exported
       StringWriter sw = new StringWriter();

     //I don't believe any of this syntax is right, but if they have Excel export to excel and if not export to csv  "|" delimeted

   for(int i=0; i<List.Count;i++)
    {
              sw.WriteLine(List[i].ID+ "|" + List[i].Date + "|" + List[i].Description);

    }
    Response.AddHeader("Content-Disposition", "attachment; filename=test.csv");
    Response.ContentType = "application/ms-excel";
    Response.ContentEncoding = System.Text.Encoding.GetEncoding("utf-8");
    Response.Write(sw);
    Response.End(); 

    } 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-12T00:48:35.887

我不太了解“导出动态绑定到 ViewData.Model 的名为 Table 的 HTML 表”的全部内容，所以我将忽略它并专注于您的*Export(List<data> list)*方法。顺便说一句，你从来没有真正提到出了什么问题以及在哪里。

我看到你写过“如果他们有 Excel 导出到 excel，如果没有导出到 csv”——我个人会在这两种情况下将其导出为 CSV 文件，因为 excel 可以处理 csv 文件没有问题。

因此，考虑到这一点，这将是我基于您的代码的导出方法。

```
public void Export(List<DataType> list)
{
    StringWriter sw = new StringWriter();

    //First line for column names
    sw.WriteLine("\"ID\",\"Date\",\"Description\"");

    foreach(DataType item in list)
    {
        sw.WriteLine(string.format("\"{0}\",\"{1}\",\"{2}\"",
                                   item.ID,
                                   item.Date,
                                   item.Description));
    }

    Response.AddHeader("Content-Disposition", "attachment; filename=test.csv");
    Response.ContentType = "text/csv";
    Response.ContentEncoding = System.Text.Encoding.GetEncoding("utf-8");
    Response.Write(sw);
    Response.End(); 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-16T11:54:21.423

这是一个很好的例子，但我认为这需要全球化修改。

```
String ltListSeparator = CultureInfo.CurrentUICulture.TextInfo.ListSeparator;
sw.WriteLine(string.format("{0}" + ltListSeparator + "{1}" + ltListSeparator + "{2}", item.ID, item.Date, item.Description)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:42:57.600

我认为您的控制器操作方法将需要将数据项包装在一个 html 表中，您可能希望以任何您喜欢的方式执行此操作，因此您的 html+ 数据将存储在一个字符串中，然后您可以执行以下操作 - （它不是完全为 MVC 构建，但易于修改）。

```
 Response.ClearContent();    
        Response.AddHeader("content-disposition", attachment);    
        Response.ContentType = "application/ms-excel";                
        Response.Write(yourDataAndHtmlAsString);
        Response.End(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:32:58.943

CSV 是一种简单的格式，可以很容易地构建为字符串。

[http://en.wikipedia.org/wiki/Comma-separated_values](http://en.wikipedia.org/wiki/Comma-separated_values)

您可以创建一个您认为最终产品应该是什么样子的 excel 电子表格，另存为 CSV，在记事本中打开它，然后尝试使用字符串生成器复制它。

# sql-server - SQL Cluster - 使用数据源（本地）

> ID：429590
> 
> 赞同：4
> 
> 时间：2009-01-09T20:26:51.657
> 
> 标签：sql-server, cluster-computing

在连接字符串中使用 (local) 不适用于我的集群。我假设它在当前活动节点上寻找默认实例，而不是虚拟 SQL 名称。任何人都知道如何使这项工作？

编辑说明：我想使用 (local) 而不是 localhost - 我不想更改任何应用程序生成的代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-12T04:28:13.960

名称（本地）或（.）将始终使用共享内存接口，而不是 TCP 或命名管道，并且两者都不能用于需要 TCP 或 TCP 上的命名管道的集群实例。您不能针对非本地实例使用共享内存接口，在集群的情况下，该实例可能是本地的，也可能不是本地的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-10T01:15:01.950

您必须使用集群的虚拟 SQL 服务名称，不幸的是 localhost 和 (local) 在集群上不起作用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:31:18.810

你试过没有（和）的“localhost”

# printing - 自动将文本添加到图像和格式化以进行打印的最佳方法？

> ID：429594
> 
> 赞同：0
> 
> 时间：2009-01-09T20:27:58.597
> 
> 标签：printing, automation, photoshop, text-files

**这是我所拥有的：**

四分之一页传单（每页 4 个）作为 PSD 或 JPG 文本文件，每行一个文本条目。

**我想做的事：**

打印出 100 张传单（在 25 张纸上） 以某种方式通过某种脚本语言或 Photoshop 自动化任务自动将文本添加到图像中。然后格式化要打印的页面，生成一个 25 页的 PDF 文件或一次生成四个并逐页发送到打印机。

任何人都有这样的经验，或者对我应该如何做这件事有任何建议？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-09T20:35:55.927

您可以使用 Microsoft Word 自动化生成具有正确文本和图像的 Word 文件，然后直接打印。这将是更简单的解决方案之一，您可以将整个事物实现为单词宏 (VBA)。

更复杂的解决方案是使用 VB6 或 .net 将文本和图像打印到表单中，然后打印表单。

您可以编写一个脚本，生成带有图像和文本的 html 页面，然后使用浏览器打印出 html。

# apache-flex - 在 Flex MVC 环境中重用函数的最佳方式是什么？

> ID：429599
> 
> 赞同：0
> 
> 时间：2009-01-09T20:29:10.293
> 
> 标签：apache-flex, model-view-controller, actionscript, code-reuse, cairngorm

我正在为我当前的项目使用 Cairngorm MVC 架构。

我有几个命令使用相同类型的返回值的函数。我想把这个函数放在一个地方，并重用它，而不是在每个命令中复制代码。做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-10T00:40:14.670

您在这里有很多选择——在您的模型或控制器中公开定义的函数，例如：

```
var mySharedFunction:Function = function():void
{
   trace("foo");
} 
```

... 新类或现有类的静态方法等。不过，最佳实践可能取决于函数需要做什么。你能详细说明吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-10T18:56:52.383

为您的命令创建一个抽象基类并将您的函数添加到受保护的范围内。如果您需要在其他任何地方重用它，请将其重构为实用程序类的公共静态方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-11T04:57:23.183

在您的 Cairngorm 类之一中创建静态类或静态方法。

```
class MyStatic
{
    public static function myFunction(value:String):String
    {
        return "Returning " + value;
    }
} 
```

然后你想在哪里使用你的功能：

```
import MyStatic;

var str:String = MyStatic.myFunction("test"); 
```

另一种选择是创建一个顶级函数（la “trace”）。看看我在[这里](http://www.typeoneerror.com/global-top-level-functions-in-actionscript-3/ "顶层函数")写的这篇文章。

# apache-flex - BlazeDS 与 GraniteDS

> ID：429606
> 
> 赞同：13
> 
> 时间：2009-01-09T20:31:37.620
> 
> 标签：apache-flex, blazeds

有人有评估 BlazeDS 和 GraniteDS 的经验吗？我很好奇哪个更适合与 Spring/Hibernate 集成。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-10T18:53:13.483

如果您只是在寻找简单的 RPC 和消息传递，我会选择 Blaze。这些实现更成熟，得到了更好的证明，尤其是在消息传递方面。Granite 中的消息传递基于 Comet，并且在我记忆中仍然很新。更多详情如下...

Blaze DS 基本上是一个堆栈，其中包括 RPC 和一些基于 HTTP 的简单消息传递服务。使用 FlexFactory 的 SpringFactory 实现可以轻松实现与 Spring 的集成：只需 google 类名，您就会找到代码。它不为与 Hibernate 相关的事情提供任何额外的支持。

Granite DS 在功能方面发展迅速。与 Blaze DS 相比，它与 LCDS 的竞争更大。它包括解析 Hibernate 对象图和以干净的方式处理惰性代理的能力。他们还有一个名为“Tide”的工具，可以在 Flex 客户端中创建一个 Session 的模拟，以确保实体的唯一性。它们还明确支持通过 Spring、EJB3 和 Seam 公开的服务。Granite 还有一个实用程序，用于从您的 Java 类生成 AS3 类（尽管如果您愿意，自己编写这并不难）。

大约一年前，我与 Granite 一起工作，但在正确解析对象图时遇到了一些问题；Flash Player 会抛出一些令人讨厌的低级异常。我的猜测是文档和实现已经成熟，因此这些不再是问题。但是，我仍然有点犹豫是否推荐它，因为我遇到了问题并且切换到 Blaze 立即解决了这些问题，一点问题都没有。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-29T14:03:21.523

关于 Cliff 评论的一些旁注：

1.  GraniteDS 创建于 2006 年底，大约比 BlazeDS 早一年。它广泛用于要求苛刻的生产环境，至少可以认为比 BlazeDS 成熟和成熟。
2.  GraniteDS 消息传递是在 1.0 版本中引入的（2007 年末，在第一个 BlazeDS 版本发布几周后），它现在非常成熟，并且在要求苛刻的生产环境中也得到了证明。
3.  Cliff 遇到的 Flash 播放器异常通常是由于未能在 SWF 中编译所有生成的 AS3 类引起的。只需使用 Flex 编译器选项来强制包含这些缺失的类，它们是数据图模型的一部分，在反序列化时需要，但未在 MXML/AS3 代码中显式使用。
4.  大多数 GraniteDS 用户来自 BlazeDS/LCDS，因为这两个框架不能正确处理复杂的数据模型（没有或错误的延迟加载支持、糟糕的事务隔离等）

因此，恕我直言，除非您正在开发具有相当琐碎数据模型的小型应用程序，否则您应该使用 GraniteDS。

# .net - 如果我运行的是 .net 3.5 或 3.5 sp1，我可以在哪里查找？

> ID：429614
> 
> 赞同：2
> 
> 时间：2009-01-09T20:34:07.820
> 
> 标签：.net

我想验证计算机是否运行 .net 3.5 或 3.5 sp1，我在哪里查找此信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T20:37:59.170

在注册表中：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP 
```

此处已涵盖此主题： [确定最高 .NET Framework 版本](https://stackoverflow.com/questions/182910/determine-highest-net-framework-version#182935)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T20:36:59.717

[你可以在这里](http://www.walkernews.net/2008/05/16/how-to-check-net-framework-version-installed/)找到答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:42:15.040

如果您想快速获得答案而无需大量工作，您可以在 IE 中[访问 http://www.smallestdotnet.com/](http://www.smallestdotnet.com/)，它会告诉您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T20:37:13.070

打开VS，如果有的话，点击帮助，然后点击关于。它应该告诉你.net 版本、VS 版本和其他插件。

# ms-access - 在 ms-access 中合并单元格

> ID：429615
> 
> 赞同：1
> 
> 时间：2009-01-09T20:34:20.970
> 
> 标签：ms-access

我正在使用访问 03。假设我正在为各方数据库建模。每个聚会都有一些人被邀请。每一方也有一个地点和日期。当以表格形式呈现信息时，我希望能够合并重复出现的单元格。就像是：

```
 _________________ ____________ ___________
|                 |            | invitee 1 |
|                 |            |-----------|
| partly location | party date | invitee 2 |
|                 |            |-----------|     
|                 |            | invitee 3 |
 ------------------------------------------ 
```

这与您可以在 ms-excel 中执行的操作非常相似。有什么办法吗？

编辑：建议使用子表格。但是，似乎在使用子表单时，我一次只能显示一个聚会，我需要使用箭头在它们之间滚动，而我想一次显示所有聚会

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T20:37:48.607

在表格上，您可以使用带有派对地点和派对日期的主表格，然后使用带有受邀者列表的子表格。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-10T01:54:07.750

Access just doesn't have the feature. You can do it in a report, but not a form. There are a couple of things that might come close. If you do a datasheet subform with a datasheet parent form, you will get expanding and collapsing cells. IIRC you can expand all cells on initial presentation programmatically.

You'll have to nest datasheet subforms to get to the third column in your example.

It might also be possible to use the form view to nest a couple of subforms to the level you need, but I think at some point you're going to run into some ugly scroll bars. It will be tough to make it look decent.

I'd give the collapsing datasheets a shot. Beyond that, I think you're looking at custom, 3rd party controls, which can be a pain in Access.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:38:47.810

不是通过使用访问的数据网格视图。

您可以通过使用子表单来构建表单来实现这一点，这样主表单将显示位置和日期，子表单将显示受邀者列表

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T21:46:09.870

Flex Grid Control 可能会执行您想要的操作，但您需要编写一些 VBA 代码，请查看我的 Flex Grid Demo 程序以获取一些示例。

访问[http://www.rogersaccesslibrary.com/forum/forum_posts.asp?TID=180](http://www.rogersaccesslibrary.com/forum/forum_posts.asp?TID=180)

高温高压

彼得·希布斯。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T13:09:19.927

使用 Access 03 绝对可以做到这一点。只需创建两个表：tblParty 和 tblInvitees。tblParty 表将保存位置和日期信息。tblInvitees 表将保存被邀请者的姓名。使用“PartyID”在两个表之间创建链接。您可以在表格中输入信息，但最好以表格/子表格的方式进行，因为这样更容易查看。

# svn - 您将什么部署到客户端 SVN 分支或标签

> ID：429622
> 
> 赞同：2
> 
> 时间：2009-01-09T20:36:47.877
> 
> 标签：svn, tags, release-management, branch

不久前，我们使用 Microsoft VSS 作为我们的版本控制工具，并用于在每个版本结束后创建我们的代码分支并将其部署到我们的客户。

现在我们已经转移到 SVN 并且最近有很多关于标签/分支的讨论，我们应该在开发特定版本之后标记/分支我们的代码吗？

SVN 实际上为此目的推荐了“标签”，但也建议不要进一步对其进行任何更改，那么我们将在哪里修复此版本中出现的令人发指的错误？

正在做的另一件事是创建标签和分支，将标签部署到客户端，如果出现任何错误，将对分支进行修复，然后再次标记:-(

其他人做什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T20:46:08.543

1.  当你发布时，为它创建一个标签。例如，release-1.1.0
2.  如果您对该版本有错误修复/更改，请首先从该标签创建一个分支，即“稳定分支”，通常以“.x”作为最后一个版本号命名。例如，stable-1.1.x
3.  将错误修复/更改从主干合并到稳定分支
4.  将更改提交到稳定分支
5.  一旦你觉得稳定分支上有足够的错误修复/更改来证明新版本的合理性，请从稳定分支创建一个标签，例如 release-1.1.1
6.  继续在主干上工作，将错误修复合并回稳定分支
7.  重复 3-6

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T20:43:58.533

在 Subversion 中，它们是相同的 - 它们以相同的方式实现并且结果相同（除了您的 repo 层次结构）。它们只是对存储库特定版本的引用。没有制作真正的副本。当你开始在一个分支上工作时（真正意义上的），那么你就是在一个新的地方使用该资源的一个新副本。

如果/需要时，您总是可以从标签中创建分支，因此没有理由创建分支和标签。

如果它可以帮助您保持一致，那么请继续执行它，但实际上在您开始签入/对分支进行修订之前它不会做任何事情。

（标签/分支都是用 cp 命令制作的）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-09T20:40:47.680

是的，您通常会创建一个与主干平行的维护分支，并从中标记错误修复版本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-10T11:14:48.773

在代码行的特定版本（例如主干）上创建一个标签，并且总是从您的标签中发布。svn 中的标签虽然不是由 svn 本身强制执行的，但它是快照和参考点。利用这个隐含的概念，只发布从您和其他人知道对应于特定版本的标签创建的构建。

使用分支将维护补丁提交到特定版本（例如，如果您需要修补您的版本，则从您的标签创建一个分支）并通过在您发布时标记您的分支来为您的补丁遵循相同的做法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T20:40:31.677

发布分支上的标签。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T20:45:17.047

由于源代码控制概念在这里仍然很新，尤其是 SVN，所以我们只在主干上工作。在我们有不应该上线的提交之前工作得很好，而当时部署的人并没有意识到这一点。

一旦每个人都对这里的 SVN 感到满意，并且我至少可以找到另一个熟悉合并的人，我将设置一个“实时”分支，所有已批准的生产提交都可以合并到该分支中。

标签很好，因为您可以为开发周期命名，“beta”、“alpha”、“release Candidate 1”等。但最重要的是，您需要一个可以依赖于生产使用的良好分支。标签只是让确定里程碑变得更容易。

# c++ - 如何加快浮点数到整数的转换？

> ID：429632
> 
> 赞同：20
> 
> 时间：2009-01-09T20:38:19.527
> 
> 标签：c++, c, performance, optimization, floating-point

我们在我们的项目中进行了大量的浮点到整数的转换。基本上，像这样

```
for(int i = 0; i < HUGE_NUMBER; i++)
     int_array[i] = float_array[i]; 
```

执行转换的默认 C 函数结果非常耗时。

是否有任何解决方法（可能是手动调整功能）可以稍微加快这个过程？我们不太关心精度。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-10T06:26:53.393

这里的大多数其他答案只是试图消除循环开销。

只有[deft_code 的答案](https://stackoverflow.com/a/429812/768469)才能触及可能真正问题的核心——在 x86 处理器上将浮点数转换为整数是非常昂贵的。deft_code 的解决方案是正确的，尽管他没有给出引用或解释。

这是技巧的来源，有一些解释以及特定于您是要向上、向下还是向零取整的版本：[了解您的 FPU](http://www.stereopsis.com/sree/fpu2006.html)

很抱歉提供一个链接，但实际上这里写的任何内容，除了复制那篇优秀的文章，都不会让事情变得清晰。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-09T21:27:17.353

```
inline int float2int( double d )
{
   union Cast
   {
      double d;
      long l;
    };
   volatile Cast c;
   c.d = d + 6755399441055744.0;
   return c.l;
}

// this is the same thing but it's
// not always optimizer safe
inline int float2int( double d )
{
   d += 6755399441055744.0;
   return reinterpret_cast<int&>(d);
}

for(int i = 0; i < HUGE_NUMBER; i++)
     int_array[i] = float2int(float_array[i]); 
```

双参数没有错！有办法直接用浮点数来做这个技巧，但是试图覆盖所有的角落情况会变得很难看。如果您想截断而不是使用 6755399441055743.5（少 0.5），此函数将以当前形式将浮点数舍入到最接近的整数。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-13T23:26:15.287

我对进行浮点到整数转换的不同方式进行[了一些测试。](http://assemblyrequired.crashworks.org/2009/01/13/sse2-fastest-rounding-on-x86/)简短的回答是假设您的客户拥有支持 SSE2 的 CPU 并设置 /arch:SSE2 编译器标志。这将允许编译器使用比幻数技术快两倍的 SSE*标量指令。*

否则，如果您有很长的浮动字符串要研磨，请使用 SSE2 打包操作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-09T20:51:28.283

SSE3 指令集中有一条 FISTTP 指令可以执行您想要的操作，但至于它是否可以被利用并产生比 libc 更快的结果，我不知道。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-09T20:47:25.250

时间是否足以超过启动几个线程的成本？

假设您的机器上有一个多核处理器或多个可以利用的处理器，那么跨多个线程并行化将是一项微不足道的任务。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-10T09:41:18.073

关键是要避免 _ftol() 函数，它不必要地慢。对于这样的长数据列表，最好的选择是使用 SSE2 指令 cvtps2dq 将两个压缩浮点数转换为两个压缩 int64。这样做两次（在两个 SSE 寄存器中获得四个 int64），您可以将它们混洗在一起以获得四个 int32（丢失每个转换结果的前 32 位）。您不需要组装即可执行此操作；MSVC 将编译器内在函数暴露给相关指令—— [_mm_cvtpd_epi32()](http://msdn.microsoft.com/en-us/library/d2ch40w8(VS.80).aspx)如果我的记忆正确的话。

如果你这样做，你的 float 和 int 数组必须 16 字节对齐，这样 SSE2 加载/存储内在函数才能以最大效率工作，这一点非常重要。另外，我建议您稍微使用软件管道，并在每个循环中一次处理*16 个*浮点数，例如（假设这里的“函数”实际上是对编译器内在函数的调用）：

```
for(int i = 0; i < HUGE_NUMBER; i+=16)
{
//int_array[i] = float_array[i];
   __m128 a = sse_load4(float_array+i+0);
   __m128 b = sse_load4(float_array+i+4);
   __m128 c = sse_load4(float_array+i+8);
   __m128 d = sse_load4(float_array+i+12);
   a = sse_convert4(a);
   b = sse_convert4(b);
   c = sse_convert4(c);
   d = sse_convert4(d);
   sse_write4(int_array+i+0, a);
   sse_write4(int_array+i+4, b);
   sse_write4(int_array+i+8, c);
   sse_write4(int_array+i+12, d);
} 
```

这样做的原因是 SSE 指令有很长的延迟，因此如果您立即将加载到 xmm0 并在 xmm0 上执行相关操作，那么您将遇到停顿。一次“运行”多个寄存器可以稍微隐藏延迟。（理论上，一个神奇的无所不知的编译器可以解决这个问题，但实际上它不会。）

如果此 SSE juju 失败，您可以向 MSVC 提供 /QIfist 选项，这将导致它发出单个操作码**拳头**而不是调用 _ftol；这意味着它将简单地使用恰好在 CPU 中设置的任何舍入模式，而不确保它是 ANSI C 的特定截断操作。微软文档说 /QIfist 已被弃用，因为他们的浮点代码现在很快，但反汇编程序会告诉你这是不合理的乐观。甚至 /fp:fast 也只会导致调用 _ftol_sse2，尽管它比令人震惊的 _ftol 更快，但它仍然是一个函数调用，然后是一个潜在的 SSE 操作，因此不必要地慢。

顺便说一下，我假设您使用的是 x86 架构——如果您使用的是 PPC，则有等效的 VMX 操作，或者您可以使用上面提到的幻数乘法技巧，然后使用 vsel（以屏蔽掉非尾数位）和对齐的存储。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-09T20:49:11.563

您可以使用一些神奇的汇编代码将所有整数加载到处理器的 SSE 模块中，然后执行等效代码将值设置为整数，然后将它们作为浮点数读取。我不确定这会更快。我不是 SSE 专家，所以我不知道该怎么做。也许其他人可以插话。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-09T23:32:25.400

在 Visual C++ 2008 中，编译器会自行生成 SSE2 调用，如果您使用最大化优化选项进行发布构建，并查看反汇编（尽管必须满足某些条件，请使用您的代码）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-10T04:13:27.080

请参阅这篇英特尔文章以加快整数转换：

[http://software.intel.com/en-us/articles/latency-of-floating-point-to-integer-conversions/](http://software.intel.com/en-us/articles/latency-of-floating-point-to-integer-conversions/)

根据 Microsoft 的说法，/QIfist 编译器选项在 VS 2005 中已弃用，因为整数转换已加快。他们忽略了它是如何加速的，但查看拆卸列表可能会提供线索。

[http://msdn.microsoft.com/en-us/library/z8dh4h17(vs.80).aspx](http://msdn.microsoft.com/en-us/library/z8dh4h17(vs.80).aspx)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-10T06:10:41.120

大多数 c 编译器都会为每个浮点到 int 的转换生成对 _ftol 或其他东西的调用。减少浮点一致性开关（如 fp:fast）可能会有所帮助 - 如果您理解并接受此开关的其他效果。除此之外，如果您没问题并了解不同的舍入行为，请将其放入紧密组装或 sse 内在循环中。对于像您的示例这样的大型循环，您应该编写一个函数，该函数设置一次浮点控制字，然后仅使用 fistp 指令进行批量舍入，然后重置控制字 - 如果您可以使用仅 x86 的代码路径，但至少你不会改变四舍五入。阅读 fld 和 fistp fpu 指令以及 fpu 控制字。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-09T21:26:16.683

你用的是什么编译器？在微软较新的 C/C++ 编译器中，在 C/C++ -> Code Generation -> Floating point model 下有一个选项，有选项：fast、precision、strict。我认为精确是默认设置，并且在某种程度上通过模拟 FP 操作来工作。如果您使用的是 MS 编译器，该选项是如何设置的？将其设置为“快速”是否有帮助？无论如何，拆卸是什么样的？

正如上面三十七所说，CPU`float<->int`基本上可以在一条指令中进行转换，而且它不会比这更快（缺少 SIMD 操作）。

另请注意，现代 CPU 对单（32 位）和双（64 位）浮点数使用相同的 FP 单元，因此除非您试图节省存储大量浮点数的内存，否则真的没有理由偏爱`float`双精度数。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-09T21:35:08.257

[在英特尔上](http://software.intel.com/en-us/articles/fast-floating-point-to-integer-conversions/)，您最好的选择是内联 SSE2 调用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-10T02:59:28.447

我对你的结果感到惊讶。你用的是什么编译器？您是否一直在优化编译？您是否使用[valgrind](http://valgrind.org)和 Kcachegrind 确认这是瓶颈所在？你用的是什么处理器？汇编代码是什么样的？

转换本身应编译为一条指令。一个好的优化编译器应该展开循环，以便每个测试和分支完成多个转换。如果这没有发生，您可以**手动展开循环**：

```
for(int i = 0; i < HUGE_NUMBER-3; i += 4) {
     int_array[i]   = float_array[i];
     int_array[i+1] = float_array[i+1];
     int_array[i+2] = float_array[i+2];
     int_array[i+3] = float_array[i+3];
}
for(; i < HUGE_NUMBER; i++)
     int_array[i]   = float_array[i]; 
```

如果你的编译器真的很可怜，你可能需要用常见的子表达式来帮助它，例如，

```
int *ip = int_array+i;
float *fp = float_array+i;
ip[0] = fp[0];
ip[1] = fp[1];
ip[2] = fp[2];
ip[3] = fp[3]; 
```

请报告更多信息！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-09-26T19:50:40.040

如果您不太关心舍入语义，则可以使用该`lrint()`函数。这允许更自由的舍入，并且可以更快。

从技术上讲，它是一个 C99 函数，但您的编译器可能会在 C++ 中公开它。一个好的编译器也会将它内联到一条指令中（现代 G++ 会）。

[打印文档](http://pubs.opengroup.org/onlinepubs/009695399/functions/lrint.html)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-10-11T15:57:02.967

四舍五入只有极好的技巧，只有使用 6755399441055743.5（0.5 少）进行四舍五入是行不通的。

6755399441055744 = 2^52 + 2^51 在尾数末尾溢出小数，在 fpu 寄存器的位 51 - 0 中留下您想要的整数。

在 IEEE 754
6755399441055744.0 =

符号 指数 尾数
0 10000110011 10000000000000000000000000000000000000000000000000000

然而，6755399441055743.5 也将编译为 0100001100111000000000000000000000000000000000000000000000000000

0.5 溢出结束（四舍五入），这就是为什么它首先起作用的原因。

要进行截断，您必须将 0.5 添加到您的 double 中，然后执行此操作，保护数字应负责以这种方式舍入到正确的结果。还要注意 64 位 gcc linux，其中 long 相当烦人地意味着 64 位整数。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-01-10T04:54:43.160

如果您有非常大的数组（大于几 MB - CPU 缓存的大小），请为您的代码计时并查看吞吐量是多少。您可能正在使内存总线饱和，而不是 FP 单元。查找您的 CPU 的最大理论带宽，看看您离它有多近。

如果你受到内存总线的限制，额外的线程只会让情况变得更糟。您需要更好的硬件（例如更快的内存、不同的 CPU、不同的主板）。

* * *

回应拉里格里茨的评论......

你是对的：FPU 是一个主要瓶颈（使用 xs_CRoundToInt 技巧可以让内存总线非常接近饱和）。

以下是 Core 2 (Q6600) 处理器的一些测试结果。这台机器的理论主存带宽为 3.2 GB/s（L1 和 L2 带宽要高得多）。该代码是使用 Visual Studio 2008 编译的。32 位和 64 位的结果相似，并且使用 /O2 或 /Ox 优化。

```
只写...
  1866359 个刻度与 33554432 个数组元素（33554432 触摸）。带宽：1.91793 GB/s
  154749 个刻度，262144 个数组元素（33554432 个触摸）。带宽：23.1313 GB/s
  108816 个刻度，8192 个数组元素（触摸 33554432 个）。带宽：32.8954 GB/s

使用铸造...
  5236122 个刻度与 33554432 个数组元素（33554432 个触摸）。带宽：0.683625 GB/s
  2014309 滴答声与 262144 个数组元素（33554432 触摸）。带宽：1.77706 GB/s
  1967345 个刻度，包含 8192 个数组元素（33554432 个触摸）。带宽：1.81948 GB/s

使用 xs_CRoundToInt...
  1490583 个刻度与 33554432 个数组元素（33554432 触摸）。带宽：2.40144 GB/s
  1079530 个刻度，262144 个数组元素（33554432 个触摸）。带宽：3.31584 GB/s
  1008407 个刻度，包含 8192 个数组元素（33554432 个触摸）。带宽：3.5497 GB/s
```

(Windows) 源代码：

```
// floatToIntTime.cpp : Defines the entry point for the console application.
//

#include <windows.h>
#include <iostream>

using namespace std;

double const _xs_doublemagic = double(6755399441055744.0);
inline int xs_CRoundToInt(double val, double dmr=_xs_doublemagic) { 
  val = val + dmr; 
  return ((int*)&val)[0]; 
} 

static size_t const N = 256*1024*1024/sizeof(double);
int    I[N];
double F[N];
static size_t const L1CACHE = 128*1024/sizeof(double);
static size_t const L2CACHE = 4*1024*1024/sizeof(double);

static size_t const Sz[]    = {N,     L2CACHE/2,     L1CACHE/2};
static size_t const NIter[] = {1, N/(L2CACHE/2), N/(L1CACHE/2)};

int main(int argc, char *argv[])
{
  __int64 freq;
  QueryPerformanceFrequency((LARGE_INTEGER*)&freq);

  cout << "WRITING ONLY..." << endl;
  for (int t=0; t<3; t++) {
    __int64 t0,t1;
    QueryPerformanceCounter((LARGE_INTEGER*)&t0);
    size_t const niter = NIter[t];
    size_t const sz    = Sz[t];
    for (size_t i=0; i<niter; i++) {
      for (size_t n=0; n<sz; n++) {
        I[n] = 13;
      }
    }
    QueryPerformanceCounter((LARGE_INTEGER*)&t1);
    double bandwidth = 8*niter*sz / (((double)(t1-t0))/freq) / 1024/1024/1024;
    cout << "  " << (t1-t0) << " ticks with " << sz 
         << " array elements (" << niter*sz << " touched).  " 
         << "Bandwidth: " << bandwidth << " GB/s" << endl;
  }

  cout << "USING CASTING..." << endl;
  for (int t=0; t<3; t++) {
    __int64 t0,t1;
    QueryPerformanceCounter((LARGE_INTEGER*)&t0);
    size_t const niter = NIter[t];
    size_t const sz    = Sz[t];
    for (size_t i=0; i<niter; i++) {
      for (size_t n=0; n<sz; n++) {
        I[n] = (int)F[n];
      }
    }
    QueryPerformanceCounter((LARGE_INTEGER*)&t1);
    double bandwidth = 8*niter*sz / (((double)(t1-t0))/freq) / 1024/1024/1024;
    cout << "  " << (t1-t0) << " ticks with " << sz 
         << " array elements (" << niter*sz << " touched).  " 
         << "Bandwidth: " << bandwidth << " GB/s" << endl;
  }

  cout << "USING xs_CRoundToInt..." << endl;
  for (int t=0; t<3; t++) {
    __int64 t0,t1;
    QueryPerformanceCounter((LARGE_INTEGER*)&t0);
    size_t const niter = NIter[t];
    size_t const sz    = Sz[t];
    for (size_t i=0; i<niter; i++) {
      for (size_t n=0; n<sz; n++) {
        I[n] = xs_CRoundToInt(F[n]);
      }
    }
    QueryPerformanceCounter((LARGE_INTEGER*)&t1);
    double bandwidth = 8*niter*sz / (((double)(t1-t0))/freq) / 1024/1024/1024;
    cout << "  " << (t1-t0) << " ticks with " << sz 
         << " array elements (" << niter*sz << " touched).  " 
         << "Bandwidth: " << bandwidth << " GB/s" << endl;
  }

  return 0;
} 
```

# ruby-on-rails - Rails：FasterCSV - 独特的出现

> ID：429640
> 
> 赞同：1
> 
> 时间：2009-01-09T20:39:37.167
> 
> 标签：ruby-on-rails, ruby, fastercsv

我的 CSV 文件是这样导入的：

```
records = FasterCSV.read(path, :headers => true, :header_converters => :symbol) 
```

我怎样才能获得我的数据的**唯一出现**？例如，这里有一些示例数据：

```
ID,Timestamp
test,2008.12.03.20.26.32
test,2008.12.03.20.26.38
test,2008.12.03.20.26.41
test,2008.12.03.20.26.42
test,2008.12.03.20.26.43
test,2008.12.03.20.26.44
cnn,2008.12.03.20.30.37
cnn,2008.12.03.20.30.49 
```

如果我只是打电话`records[:id]`，我会得到：

```
testtesttesttesttesttestcnncnn 
```

我想得到这个：

```
testcnn 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T20:52:47.627

如果您的数据不是**大量**的，您可以使用[Set](http://www.ruby-doc.org/stdlib/libdoc/set/rdoc/index.html)类。

这是一个例子：

```
p ['cnn','test','test','test','test','cnn','cnn'].to_set.to_a
=> ["cnn", "test"] 
```

这是一个简单的基准：

```
require 'set'
require 'benchmark'

Benchmark.bm(5) do |x|
  x.report("Set")   do
    a = []
    20_000.times do |i|
      a << 'cnn'<< 'test'
    end
    a.to_set.to_a
  end
end

=>
           user     system      total        real

Set    0.110000   0.000000   0.110000 (  0.109000) 
```

# python - 如何在 Python 中做漂亮的 OSD

> ID：429648
> 
> 赞同：2
> 
> 时间：2009-01-09T20:41:12.580
> 
> 标签：python

是否有一个库可以用 Python 在屏幕上显示漂亮（主要在 Linux 上，但最好在其他操作系统上也可用）？我知道有 python-osd 但它使用看起来很旧的[libxosd 。](http://sourceforge.net/projects/libxosd)我不会说它*漂亮*。

[也许是libaosd](http://cia.vc/stats/project/libaosd)的 Python 绑定。但我没有找到任何。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T21:36:28.397

实际上，xosd 并没有那么老。我和原作者（Andre Renaud，最高级的程序员）一起上大学。它的级别很低，但很简单——xosd.c 只有 1365 行长。调整它以显示几乎任何你想要的东西并不难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T04:54:23.827

在 X 上使用 PyGTK 可以抓取屏幕背景并将图像与标准 Pango 布局合成。

[我在http://svn.sacredchao.net/svn/quodlibet/trunk/plugins/events/animosd.py](http://svn.sacredchao.net/svn/quodlibet/trunk/plugins/events/animosd.py)有一些代码可以做到这一点。它有点丑陋和长，但主要是直截了当的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-07-11T20:20:30.493

基于@user79758 的回答，`animosd.py`该帖子中的链接不再可用，但该链接仍然是：[http ://hefesto.intra.ial.sp.gov.br/share/pyshared/quodlibet/plugins/events/ animosd.py](http://hefesto.intra.ial.sp.gov.br/share/pyshared/quodlibet/plugins/events/animosd.py)（[存档](http://web.archive.org/web/20190711182113/http://hefesto.intra.ial.sp.gov.br/share/pyshared/quodlibet/plugins/events/animosd.py)）。

无论如何，它是`quodlibet`音乐播放器的一部分，在 Ubuntu 18.04 中仍然存在；我安装了它

```
sudo apt install quodlibet 
```

然后，获得一个最小的例子并不是一件容易的事。我的包括在下面`animosd_test.py`；只需运行它：

```
python2 animosd_test.py 
```

你会得到这个：

[![animost_test](https://i.stack.imgur.com/i8bnV.gif)](https://i.stack.imgur.com/i8bnV.gif)

`animosd_test.py`：

```
#!/usr/bin/env python2

#from quodlibet.ext.events.animosd.osdwindow import OSDWindow
import sys
import os
from collections import namedtuple

from quodlibet.packages.senf import environ, argv as sys_argv
from quodlibet.cli import process_arguments, exit_

import quodlibet
try:
  # we want basic commands not to import gtk (doubles process time)
  assert "gi.repository.Gtk" not in sys.modules
  sys.modules["gi.repository.Gtk"] = None
  startup_actions, cmds_todo = process_arguments(sys_argv)
finally:
  sys.modules.pop("gi.repository.Gtk", None)

quodlibet.init()

#from quodlibet.ext.events import animosd
from quodlibet.ext.events.animosd import osdwindow
from quodlibet.ext.events.animosd.config import get_config
from quodlibet.ext.events.animosd.osdwindow import OSDWindow

from quodlibet.util import cached_property, print_exc

#~ window = OSDWindow(self.Conf, song)
#~ window.add_events(Gdk.EventMask.BUTTON_PRESS_MASK)
#~ window.connect('button-press-event', self.__buttonpress)
#~ window.connect('fade-finished', self.__fade_finished)
#~ self.__current_window = window

#~ window.set_opacity(0.0)
#~ window.show()
#~ window.fade_in()

from gi.repository import Gtk, GObject, GLib, Pango, PangoCairo, Gdk
from quodlibet import qltk
import cairo
from math import pi

class OSDWindowMin(Gtk.Window):

  __gsignals__ = {
    'fade-finished': (GObject.SignalFlags.RUN_LAST, None, (bool,)),
  }

  POS_X = 0.5
  """position of window 0--1 horizontal"""

  MARGIN = 50
  """never any closer to the screen edge than this"""

  BORDER = 20
  """text/cover this far apart, from edge"""

  FADETIME = 0.3
  """take this many seconds to fade in or out"""

  MS = 40
  """wait this many milliseconds between steps"""

  @cached_property
  def Conf(self):
    return get_config('animosd')

  #def __init__(self, conf, song):
  def __init__(self):
    Gtk.Window.__init__(self, Gtk.WindowType.POPUP)
    self.set_type_hint(Gdk.WindowTypeHint.NOTIFICATION)

    screen = self.get_screen()
    rgba = screen.get_rgba_visual()
    if rgba is not None:
      self.set_visual(rgba)

    #self.conf = conf
    self.conf = self.Conf
    self.iteration_source = None
    self.fading_in = False
    self.fade_start_time = 0

    mgeo = screen.get_monitor_geometry(self.conf.monitor)
    textwidth = mgeo.width - 2 * (self.BORDER + self.MARGIN)

    scale_factor = self.get_scale_factor()
    #cover_pixbuf = app.cover_manager.get_pixbuf(
    #  song, conf.coversize * scale_factor, conf.coversize * scale_factor)
    coverheight = 0
    coverwidth = 0
    #~ if cover_pixbuf:
      #~ self.cover_surface = get_surface_for_pixbuf(self, cover_pixbuf)
      #~ coverwidth = cover_pixbuf.get_width() // scale_factor
      #~ coverheight = cover_pixbuf.get_height() // scale_factor
      #~ textwidth -= coverwidth + self.BORDER
    #~ else:
      #~ self.cover_surface = None
    self.cover_surface = None

    layout = self.create_pango_layout('')
    layout.set_alignment((Pango.Alignment.LEFT, Pango.Alignment.CENTER,
                Pango.Alignment.RIGHT)[self.conf.align])
    layout.set_spacing(Pango.SCALE * 7)
    layout.set_font_description(Pango.FontDescription(self.conf.font))
    #try:
    #  layout.set_markup(pattern.XMLFromMarkupPattern(conf.string) % song)
    #except pattern.error:
    #  layout.set_markup("")
    layout.set_markup("AAAA")
    layout.set_width(Pango.SCALE * textwidth)
    layoutsize = layout.get_pixel_size()
    if layoutsize[0] < textwidth:
      layout.set_width(Pango.SCALE * layoutsize[0])
      layoutsize = layout.get_pixel_size()
    self.title_layout = layout

    winw = layoutsize[0] + 2 * self.BORDER
    if coverwidth:
      winw += coverwidth + self.BORDER
    winh = max(coverheight, layoutsize[1]) + 2 * self.BORDER
    self.set_default_size(winw, winh)

    rect = namedtuple("Rect", ["x", "y", "width", "height"])
    rect.x = self.BORDER
    rect.y = (winh - coverheight) // 2
    rect.width = coverwidth
    rect.height = coverheight

    self.cover_rectangle = rect

    winx = int((mgeo.width - winw) * self.POS_X)
    winx = max(self.MARGIN, min(mgeo.width - self.MARGIN - winw, winx))
    winy = int((mgeo.height - winh) * self.conf.pos_y)
    winy = max(self.MARGIN, min(mgeo.height - self.MARGIN - winh, winy))
    self.move(winx + mgeo.x, winy + mgeo.y)

  def do_draw(self, cr):
    if self.is_composited():
      self.draw_title_info(cr)
    else:
      # manual transparency rendering follows
      walloc = self.get_allocation()
      wpos = self.get_position()

      if not getattr(self, "_bg_sf", None):
        # copy the root surface into a temp image surface
        root_win = self.get_root_window()
        bg_sf = cairo.ImageSurface(cairo.FORMAT_ARGB32,
                       walloc.width, walloc.height)
        pb = Gdk.pixbuf_get_from_window(
          root_win, wpos[0], wpos[1], walloc.width, walloc.height)
        bg_cr = cairo.Context(bg_sf)
        Gdk.cairo_set_source_pixbuf(bg_cr, pb, 0, 0)
        bg_cr.paint()
        self._bg_sf = bg_sf

      if not getattr(self, "_fg_sf", None):
        # draw the window content in another temp surface
        fg_sf = cairo.ImageSurface(cairo.FORMAT_ARGB32,
                       walloc.width, walloc.height)
        fg_cr = cairo.Context(fg_sf)
        fg_cr.set_source_surface(fg_sf)
        self.draw_title_info(fg_cr)
        self._fg_sf = fg_sf

      # first draw the background so we have 'transparancy'
      cr.set_operator(cairo.OPERATOR_SOURCE)
      cr.set_source_surface(self._bg_sf)
      cr.paint()

      # then draw the window content with the right opacity
      cr.set_operator(cairo.OPERATOR_OVER)
      cr.set_source_surface(self._fg_sf)
      cr.paint_with_alpha(self.get_opacity())

  @staticmethod
  def rounded_rectangle(cr, x, y, radius, width, height):
    cr.move_to(x + radius, y)
    cr.line_to(x + width - radius, y)
    cr.arc(x + width - radius, y + radius, radius,
         - 90.0 * pi / 180.0, 0.0 * pi / 180.0)
    cr.line_to(x + width, y + height - radius)
    cr.arc(x + width - radius, y + height - radius, radius,
         0.0 * pi / 180.0, 90.0 * pi / 180.0)
    cr.line_to(x + radius, y + height)
    cr.arc(x + radius, y + height - radius, radius,
         90.0 * pi / 180.0, 180.0 * pi / 180.0)
    cr.line_to(x, y + radius)
    cr.arc(x + radius, y + radius, radius,
         180.0 * pi / 180.0, 270.0 * pi / 180.0)
    cr.close_path()

  @property
  def corners_factor(self):
    if self.conf.corners != 0:
      return 0.14
    return 0.0

  def draw_conf_rect(self, cr, x, y, width, height, radius):
    if self.conf.corners != 0:
      self.rounded_rectangle(cr, x, y, radius, width, height)
    else:
      cr.rectangle(x, y, width, height)

  def draw_title_info(self, cr):
    cr.save()
    do_shadow = (self.conf.shadow[0] != -1.0)
    do_outline = (self.conf.outline[0] != -1.0)

    self.set_name("osd_bubble")
    qltk.add_css(self, """
      #osd_bubble {
        background-color:rgba(0,0,0,0);
      }
    """)

    cr.set_operator(cairo.OPERATOR_OVER)
    cr.set_source_rgba(*self.conf.fill)
    radius = min(25, self.corners_factor * min(*self.get_size()))
    self.draw_conf_rect(cr, 0, 0, self.get_size()[0],
              self.get_size()[1], radius)
    cr.fill()

    # draw border
    if do_outline:
      # Make border darker and more translucent than the fill
      f = self.conf.fill
      rgba = (f[0] / 1.25, f[1] / 1.25, f[2] / 1.25, f[3] / 2.0)
      cr.set_source_rgba(*rgba)
      self.draw_conf_rect(cr,
                1, 1,
                self.get_size()[0] - 2, self.get_size()[1] - 2,
                radius)
      cr.set_line_width(2.0)
      cr.stroke()

    textx = self.BORDER

    if self.cover_surface is not None:
      rect = self.cover_rectangle
      textx += rect.width + self.BORDER
      surface = self.cover_surface
      transmat = cairo.Matrix()

      if do_shadow:
        cr.set_source_rgba(*self.conf.shadow)
        self.draw_conf_rect(cr,
                  rect.x + 2, rect.y + 2,
                  rect.width, rect.height,
                  0.6 * self.corners_factor * rect.width)
        cr.fill()

      if do_outline:
        cr.set_source_rgba(*self.conf.outline)
        self.draw_conf_rect(cr,
                  rect.x, rect.y,
                  rect.width, rect.height,
                  0.6 * self.corners_factor * rect.width)
        cr.stroke()

      cr.set_source_surface(surface, 0, 0)
      width, height = get_surface_extents(surface)[2:]

      transmat.scale(width / float(rect.width),
               height / float(rect.height))
      transmat.translate(-rect.x, -rect.y)
      cr.get_source().set_matrix(transmat)
      self.draw_conf_rect(cr,
                rect.x, rect.y,
                rect.width, rect.height,
                0.6 * self.corners_factor * rect.width)
      cr.fill()

    PangoCairo.update_layout(cr, self.title_layout)
    height = self.title_layout.get_pixel_size()[1]
    texty = (self.get_size()[1] - height) // 2

    if do_shadow:
      cr.set_source_rgba(*self.conf.shadow)
      cr.move_to(textx + 2, texty + 2)
      PangoCairo.show_layout(cr, self.title_layout)
    if do_outline:
      cr.set_source_rgba(*self.conf.outline)
      cr.move_to(textx, texty)
      PangoCairo.layout_path(cr, self.title_layout)
      cr.stroke()
    cr.set_source_rgb(*self.conf.text[:3])
    cr.move_to(textx, texty)
    PangoCairo.show_layout(cr, self.title_layout)
    cr.restore()

  def fade_in(self):
    self.do_fade_inout(True)

  def fade_out(self):
    self.do_fade_inout(False)

  def do_fade_inout(self, fadein):
    fadein = bool(fadein)
    self.fading_in = fadein
    now = GObject.get_current_time()

    fraction = self.get_opacity()
    if not fadein:
      fraction = 1.0 - fraction
    self.fade_start_time = now - fraction * self.FADETIME

    if self.iteration_source is None:
      self.iteration_source = GLib.timeout_add(self.MS,
          self.fade_iteration_callback)

  def fade_iteration_callback(self):
    delta = GObject.get_current_time() - self.fade_start_time
    fraction = delta / self.FADETIME

    if self.fading_in:
      self.set_opacity(fraction)
    else:
      self.set_opacity(1.0 - fraction)

    if not self.is_composited():
      self.queue_draw()

    if fraction >= 1.0:
      self.iteration_source = None
      self.emit('fade-finished', self.fading_in)
      return False
    return True

def __buttonpress(window, event):
  window.hide()
  #if self.__current_window is window:
  #  self.__current_window = None
  window.destroy()

#def __fade_finished(window, fade_in):
#  if fade_in:
#    GLib.timeout_add(self.Conf.delay, self.start_fade_out, window)
#  else:
#    window.hide()
#    if self.__current_window is window:
#      self.__current_window = None
#    # Delay destroy - apparently the hide does not quite register if
#    # the destroy is done immediately.  The compiz animation plugin
#    # then sometimes triggers and causes undesirable effects while the
#    # popup should already be invisible.
#    GLib.timeout_add(1000, window.destroy)

window = OSDWindowMin()
window.connect("destroy", Gtk.main_quit) # must be present, else program does not exit when on-screen display window is clicked!
window.add_events(Gdk.EventMask.BUTTON_PRESS_MASK)
window.connect('button-press-event', __buttonpress)
#window.connect('fade-finished', self.__fade_finished)
#window.show_all#()
window.set_opacity(0.0)
window.show()
window.fade_in()
Gtk.main() 
```

# objective-c - 在 Objective C 中为 NSMutableArray 对象使用指针

> ID：429655
> 
> 赞同：0
> 
> 时间：2009-01-09T20:42:45.663
> 
> 标签：objective-c, cocoa-touch, sqlite

从可可触摸中的 NSMutableArray 检索对象时，以下代码可以吗？我应该每次都分配（[alloc]）新的 Page 对象还是只是指向它好吗？之后我是否需要对 Page *pageObj 做任何事情，例如将其设置为 nil？

```
const char *sql = "insert into Page(Book_ID, Page_Num, Page_Text) Values(?, ?, ?)";
for (i = 0; i < ([[self pagesArray] count] - 1); i++) {
    if(addStmt == nil) {
        if(sqlite3_prepare_v2(database, sql, -1, &addStmt, NULL) != SQLITE_OK) {
            NSAssert1(0, @"Error while creating add statement. '%s'", sqlite3_errmsg(database));
        }
    }
    Page *pageObj = [[self pagesArray] objectAtIndex:i];
    if(pageObj.isNew) {
        sqlite3_bind_int(addStmt, 1, self.book_ID); 
        sqlite3_bind_int(addStmt, 2, pageObj.page_Number);  
        sqlite3_bind_text(addStmt, 3, [[pageObj page_Text] UTF8String], -1, SQLITE_TRANSIENT);
        if(SQLITE_DONE != sqlite3_step(addStmt)) {
            NSAssert1(0, @"Error while inserting data. '%s'", sqlite3_errmsg(database));
        }
        NSLog(@"Inserted Page: %i into DB. Page text: %@", pageObj.page_Number, pageObj.page_Text);
    }
    //Reset the add statement.
    sqlite3_reset(addStmt);                     
} 
```

谢谢。我也明白这可能应该在交易中，但我还没有完全得到它的工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T20:53:45.657

您声明指针的方式是正确的。您不需要 alloc，因为当您想要引用数组中的现有对象时，它会创建一个新对象。如果您要将引用保留在该方法之外，您可能希望保留它，但由于您只是暂时使用它，因此可以不这样做。

实际的指针变量将在每次循环中被销毁并重新创建，因此无需将其设置为 nil。即使您在循环之外声明了变量，只需将其分配给一个新对象就可以了。唯一一次将它设置为 nil 是在释放存储在指针中的对象时（或者该对象可能在其他地方释放）。如果您在这种情况下没有将其设置为 nil，则在对象被释放后，指针将引用无效的内存位置，通常会导致崩溃。

我可以看到一个错误，您通过从计数中减去 1 来跳过 for 循环中数组中的最后一个元素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-10T16:08:56.153

除了前面提到的计数错误，它看起来不错。

就事务而言，我强烈建议将这个写循环包装在一个中。它将大大提高您的写入性能，我发现它也有助于内存使用。我使用以下类方法开始事务：

```
+ (BOOL)beginTransactionWithDatabase:(sqlite3 *)database;
{
    const char *sql1 = "BEGIN EXCLUSIVE TRANSACTION";
    sqlite3_stmt *begin_statement;
    if (sqlite3_prepare_v2(database, sql1, -1, &begin_statement, NULL) != SQLITE_OK)
    {
        return NO;
    }
    if (sqlite3_step(begin_statement) != SQLITE_DONE) 
    {
        return NO;
    }
    sqlite3_finalize(begin_statement);
    return YES;
} 
```

这个结束交易：

```
+ (BOOL)endTransactionWithDatabase:(sqlite3 *)database;
{
    const char *sql2 = "COMMIT TRANSACTION";
    sqlite3_stmt *commit_statement;
    if (sqlite3_prepare_v2(database, sql2, -1, &commit_statement, NULL) != SQLITE_OK)
    {
        return NO;
    }
    if (sqlite3_step(commit_statement) != SQLITE_DONE) 
    {
        return NO;
    }
    sqlite3_finalize(commit_statement);
    return YES;
} 
```

我可能应该存储 SQL 语句以供以后重用，但这些事务语句的调用频率远低于我的其他查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:45:47.937

当然不是。您之前已经分配过它并且只是引用同一个对象。无需重新分配。此外，您不需要将其设置为零。

# perl - Perl 中的 new Some::Class 和 Some::Class->new() 有什么区别？

> ID：429657
> 
> 赞同：27
> 
> 时间：2009-01-09T20:43:31.043
> 
> 标签：perl, methods, module

许多年前，我记得一位程序员同事这样建议：

```
new Some::Class;    # bad! (but why?)

Some::Class->new(); # good! 
```

可悲的是，现在我不记得/他的原因了。:( 即使构造函数实际上并不存在于 Some::Class 模块中，而是从某处的父级继承，这两种形式都可以正常工作。

这两种形式都与 Some::Class::new() 不同，后者不会将类的名称作为第一个参数传递给构造函数——所以这种形式总是不正确的。

即使这两种形式是等价的，我发现 Some::Class->new() 更清楚，因为它遵循在模块上调用方法的标准约定，而在 perl 中，'new' 方法不是特别 - 构造函数可以被称为任何东西，并且 new() 可以做任何事情（当然我们通常期望它是一个构造函数）。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-09T21:23:58.157

使用`new Some::Class`被称为“间接”方法调用，这很糟糕，因为它在语法中引入了一些歧义。

它可能失败的一个原因是如果您有一个对象数组或散列。你可能会期待

```
dosomethingwith $hashref->{obj} 
```

等于

```
$hashref->{obj}->dosomethingwith(); 
```

但它实际上解析为：

```
$hashref->dosomethingwith->{obj} 
```

这可能不是你想要的。

另一个问题是，如果您的包中恰好有​​一个与您尝试调用的方法同名的函数。例如，如果某个模块您`use`导出了一个名为 的函数`dosomethingwith`怎么办？在这种情况下，`dosomethingwith $object`是模棱两可的，并且可能导致令人费解的错误。

完全使用`->`语法可以消除这些问题，因为编译器始终清楚方法以及您希望方法操作的内容。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-09T20:49:16.370

请参阅perlobj 文档中的[间接对象语法以了解其缺陷。](http://perldoc.perl.org/perlobj.html#Indirect-Object-Syntax)[freido 的回答](https://stackoverflow.com/a/429798/2766176)涵盖了其中之一（尽管我倾向于在函数调用周围使用明确的括号来避免这种情况）。

Larry 曾经开玩笑说，它的存在是为了让 C++ 感到高兴`new`，尽管人们会告诉你永远不要使用它，但你可能一直都在使用它。考虑一下：

```
print FH "Some message"; 
```

你有没有想过我的文件句柄后面没有逗号？间接对象​​表示法中的类名后面没有逗号？这就是这里发生的事情。您可以将其重写为 print 上的方法调用：

```
FH->print( "Some message" ); 
```

`print`如果你做错了，你可能会经历一些奇怪的事情。在显式文件句柄之后放置一个逗号会将其变成一个参数：

```
print FH, "some message";     # GLOB(0xDEADBEEF)some message 
```

可悲的是，我们在 Perl 中有这种愚蠢。并非语法中的所有内容都是最好的主意，但是当您从众多来源中汲取灵感时，就会发生这种情况。有些想法必须是坏的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-10T00:51:06.130

间接对象​​语法不受欢迎，有充分的理由，但这与构造函数无关。你几乎永远不会在调用包中有一个 new() 函数。相反，您应该使用 Package->new() 有两个（更好？）原因：

1.  正如你所说，所有其他类方法都采用 Package->method() 的形式，所以一致性是一件好事

2.  如果您正在向构造函数提供参数，或者您正在获取构造函数的结果并立即在其上调用方法（例如，如果您不关心将对象保留在周围），那么说起来更简单，例如

> ```
> $foo = Foo->new(type => 'bar', style => 'baz');
> Bar->new->do_stuff; 
> ```

比

> ```
> $foo = new Foo(type => 'bar', style => 'baz');
> (new Bar)->do_stuff; 
> ```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-01-10T20:24:35.060

另一个问题是`new Some::Class`在运行时发生。如果出现错误并且您的测试永远不会分支到该语句，那么您永远不会知道它，直到它发生在生产中。`Some::Class->new`除非您正在进行动态编程，否则最好使用。

# .net - 如何在 .NET 中翻转/旋转 PrintDocument？

> ID：429672
> 
> 赞同：3
> 
> 时间：2009-01-09T20:47:28.383
> 
> 标签：.net, vb.net, orientation, printdocument

我有一个文档，我想在打印时翻转/旋转 180 度。（这是由于打印机中标签纸的方向所致）。

有一个属性`PrintDocument.PrinterSettings.LandscapeAngle`，但它是只读的。

我认为这个属性受打印机驱动程序的影响，因此不是“可设置的”。

有没有一种很好的方法可以将打印件旋转 180 度而不必做任何太讨厌的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T20:56:31.317

你要[`PrintDocument.DefaultPageSettings.Landscape`](http://msdn.microsoft.com/en-us/library/system.drawing.printing.pagesettings_members.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-27T09:42:57.317

我想这取决于你定义为“任何太讨厌的东西”:-)

[PrintDocument](http://msdn.microsoft.com/en-us/library/system.drawing.printing.printdocument.aspx)类有一个可供您使用的[Graphics](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.aspx)对象，该对象又具有一个TranslateTransform[和](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.translatetransform.aspx)RotateTransform[方法](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.rotatetransform.aspx)，可让您在需要的地方获取内容。

通常值得在操作图形对象之前对其进行复制，以便在完成后再次恢复它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-24T09:57:39.993

在 VB.NET 中打印表单并翻转/旋转 PrintDocument 并将 DefaultPageSettings 设置为横向

```
Dim WithEvents mPrintDocument As New PrintDocument
Dim mPrintBitMap As Bitmap
Private Sub m_PrintDocument_PrintPage(ByVal sender As Object, ByVal e As System.Drawing.Printing.PrintPageEventArgs) Handles mPrintDocument.PrintPage
    mPrintBitMap.RotateFlip(RotateFlipType.Rotate90FlipNone)
    mPrintDocument.PrinterSettings.DefaultPageSettings.Landscape = True
    ' Draw the image centered.     
    Dim lWidth As Integer = e.MarginBounds.X + (e.MarginBounds.Width - mPrintBitMap.Width) \ 2
    Dim lHeight As Integer = e.MarginBounds.Y + (e.MarginBounds.Height - mPrintBitMap.Height) \ 2

    e.Graphics.DrawImage(mPrintBitMap, lWidth, lHeight)
    ' There's only one page.   
    e.HasMorePages = False
End Sub
Private Sub B_print_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles B_print.Click
    ' Copy the form image into a bitmap.    
    mPrintBitMap = New Bitmap(Me.Width, Me.Height)
    Dim lRect As System.Drawing.Rectangle
    lRect.Width = Me.Width
    lRect.Height = Me.Height
    Me.DrawToBitmap(mPrintBitMap, lRect)
    ' Make a PrintDocument and print.    
    mPrintDocument = New PrintDocument

    mPrintDocument.Print()

End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-26T22:43:59.103

您在将其分配给打印机 GDI 之前是否尝试过旋转它自己的图像？这就是我所做的：

```
 _currentPage = Image.FromStream((MemoryStream)_queue.Dequeue());
                pageHeight = _currentPage.Height;
                pageWidth = _currentPage.Width;

                if (pageHeight < pageWidth)
                {
                    _currentPage.RotateFlip(RotateFlipType.Rotate90FlipNone);
                    pageHeight = _currentPage.Height;
                    pageWidth = _currentPage.Width;                      

                } 
```

# sql-server - 在 OPENQUERY 中使用查询结果

> ID：429684
> 
> 赞同：0
> 
> 时间：2009-01-09T20:49:59.160
> 
> 标签：sql-server, sql-server-2005, oracle, oracle10g, openquery

我有一个链接到 Oracle 数据库的 SQL Server 2005 数据库。我想要做的是运行查询以从中提取一些 ID 号，然后找出哪些在 Oracle 中。

所以我想获取这个查询的结果：

```
SELECT pidm
FROM sql_server_table 
```

并执行类似这样的操作来查询 Oracle 数据库（假设之前查询的结果存储在 @pidms 中）：

```
OPENQUERY(oracledb,
'
SELECT pidm
FROM table
WHERE pidm IN (' +
@pidms + ')')
GO 
```

但是我很难想出一个好的方法来做到这一点。我想我可以对类似于这两个的查询进行内部连接。不幸的是，有很多记录可以在有限的时间范围内提取，所以我认为这不是一个非常高效的选择。

有什么建议么？理想情况下，我希望使用尽可能少的动态 SQL 来做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T21:28:58.863

啊啊啊，小鬼。勾起不好的回忆！:)

你可以加入，但你会这样做：

```
select sql.pidm,sql.field2 from sqltable as sql
inner join
(select pidm,field2 from oracledb..schema.table) as orcl
on 
sql.pidm = orcl.pidm 
```

我不确定你是否可以编写一个 PL/SQL 过程来从 sql 中获取一个表变量......但也许......不，我对此表示怀疑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T20:53:02.867

将 openquery 结果存储在临时表中，然后在 SQL 表和临时表之间进行内部联接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:53:44.487

我不认为你可以加入，因为 OPENQUERY 需要一个纯字符串（正如你上面写的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-07T17:13:52.017

BG：实际上，通过 OpenQuery 将 SQLServer 加入到 Oracle 是有效的，避免了 #tmp 表并允许在没有参数*的情况下加入到 SQL - 例如。

```
[SQL SP] LEFT JOIN OPENQUERY(ORADB,
'SELECT  COUNT(distinct O.ORD_NUM) LCNT, 
 O.ORD_MAIN_NUM  
 FROM CUSTOMER.CUST_FILE C
 JOIN CUSTOMER.ORDER_NEW O 
 ON C.ID = O.ORD_ID
 WHERE  C.CUS_ID NOT IN (''2'',''3'') 
 GROUP BY O.ORD_MAIN_MACNUM') LC 
 ON T.ID = LC.ORD_MAIN_ID* 
```

干杯，比尔吉布斯

# c# - 正确通知所有侦听器系统范围的手动重置事件，然后立即重置它

> ID：429692
> 
> 赞同：7
> 
> 时间：2009-01-09T20:52:38.780
> 
> 标签：c#, windows, multithreading, events

我通过执行以下操作创建了一个系统范围的手动重置事件：

```
EventWaitHandle notifyEvent = new EventWaitHandle(false, EventResetMode.ManualReset, notifyEventName, out createdEvent); 
```

几个进程创建了这个事件（例如，它在它们之间共享）。它用于通知何时更新。

我希望能够设置此事件，以便向所有等待它的进程发出信号，然后立即将其重置，以便阻止事件的后续等待。

如果我做一个

```
notifyEvent.Set();
notifyEvent.Reset(); 
```

它有时会通知所有监听进程。

如果我做一个

```
notifyEvent.Set();
Thread.Sleep(0);
notifyEvent.Reset(); 
```

更多进程得到通知（我认为这会发生，因为调度程序有机会运行）。

如果我这样做

```
notifyEvent.Set();
Thread.Sleep(100);
notifyEvent.Reset(); 
```

然后一切似乎都很好，所有进程（例如~8）都会得到一致的通知。我不喜欢在 Sleep 呼叫中使用“幻数”。

有没有更好的方法来通知其他进程中 OS 事件的所有侦听器发生了事件，以便在通知时侦听它的每个人都收到事件信号，然后立即重置事件，以便其他任何人去侦听到事件会阻塞？

**更新：**信号量似乎不太适合这里，因为事件的侦听器数量会随着时间而变化。事先不知道当需要通知一个事件时会有多少听众。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-10-31T09:47:28.283

我遇到了同样的问题，令人惊讶的是，在网络上找不到针对这种松散耦合/触发并忘记/多个侦听器类型的事件的任何好的解决方案，所以这就是我想出的。

注意`Set()`和`Reset()`调用之间的超时解决方案还有一个竞争条件问题（除了它依赖于任意超时值的事实之外）：如果发布者在这些调用之间被杀死，那么所有监听器都会看到这个事件永远设置（除非发布者再次上线）。

所以要求是：

*   有一个发布者（尽管代码中并没有真正强制执行）
*   可以有任意数量的侦听器（在同一进程或其他进程中），介于 0 和 N 之间（编译二进制文件后 N 是固定的）。
*   听众可以随心所欲地来来去去，而不会打扰发布者
*   发布者可以随心所欲地来来去去而不会打扰听众

诀窍是使用 AutoReset 事件，因为它们没有竞争条件问题，而是为每个侦听器定义一个。我们事先不知道侦听器的数量，但我们可以确定最大侦听器数量（上面描述的“N”）：

```
const int MAX_EVENT_LISTENERS = 10;
const string EVENT_NAME = "myEvent_"; 
```

这是向所有潜在听众提出事件的发布者代码：

```
public static void RaiseEvent()
{
    for (int i = 0; i < MAX_EVENT_LISTENERS; i++)
    {
        EventWaitHandle evt;
        if (EventWaitHandle.TryOpenExisting(EVENT_NAME + i, out evt))
        {
            evt.Set();
            evt.Dispose();
        }
    }
} 
```

这是获取事件通知的侦听器代码：

```
...
EventWaitHandle evt = GetEvent();
do
{
    bool b = evt.WaitOne();
    // event was set!
}
while (true);
....

// create our own event that no other listener has
public static EventWaitHandle GetEvent()
{
    for (int i = 0; i < MAX_EVENT_LISTENERS; i++)
    {
        bool createdNew;
        EventWaitHandle evt = new EventWaitHandle(false, EventResetMode.AutoReset, EVENT_NAME + i, out createdNew);
        if (createdNew)
            return evt;

        evt.Dispose();
    }
    throw new Exception("Increase MAX_EVENT_LISTENERS");
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-10T12:04:58.783

您错误地使用了 EventWaitHandle 类。不应使用重置事件来通知多个线程。相反，您需要为每个线程创建一个重置事件，然后当您准备好循环所有线程并使用 Set()。主线程不应调用 Reset() 方法。可以这么说，每个线程都应该负责关闭它们身后的大门。

这是一个基本示例：

```
static class Program
{
    static void Main()
    {
        List<ThreadState> states = new List<ThreadState>();
        ThreadState myState;
        Thread myThread;
        string data = "";

        for (int i = 0; i < 4; i++)
        {
            myThread = new Thread(Work);
            myState = new ThreadState();
            myState.gate = new EventWaitHandle(false, EventResetMode.ManualReset);
            myState.running = true;
            myState.index = i + 1;
            states.Add(myState);
            myThread.Start(myState);
        }

        Console.WriteLine("Enter q to quit.");

        while (data != "q")
        {
            data = Console.ReadLine();
            if (data != "q")
                foreach (ThreadState state in states)
                    state.gate.Set();
        }

        foreach (ThreadState state in states)
        {
            state.running = false;
            state.gate.Set();
        }

        Console.WriteLine("Press any key to quit.");
        Console.ReadKey();
    }

    static void Work(Object param)
    {
        ThreadState state = (ThreadState)param;
        while (state.running)
        {
            Console.WriteLine("Thread #" + state.index + " waiting...");
            state.gate.WaitOne();
            Console.WriteLine("Thread #" + state.index + " gate opened.");
            state.gate.Reset();
            Console.WriteLine("Thread #" + state.index + " gate closed.");
        }
        Console.WriteLine("Thread #" + state.index + " terminating.");
    }

    private class ThreadState
    {
        public int index;
        public EventWaitHandle gate;
        public bool running;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:03:36.480

您在这里使用了错误的同步类型。您应该使用 Semaphore 类而不是事件，并使用您希望允许的同时访问数。

您可能还需要两个信号量，第二个用于检查触发事件的代码（响应事件的代码将锁定），以防您不想快速连续发生两个事件并且让一段代码进入另一个事件的尾部。

# asp.net - 使用 DataPager 而不检索每个请求的所有行

> ID：429707
> 
> 赞同：4
> 
> 时间：2009-01-09T20:54:58.557
> 
> 标签：asp.net, pagination

我有一个 ListView，我正在将数据绑定到一组对象，如下所示：

```
int total;
List<Client> clientList = 
    clientData.GetClients(criteria, pageNum, pageSize, out total);
uxClientList.DataSource = clientList;
uxClientList.DataBind(); 
```

其中 pageNum、pageSize 和 total 参数便于在数据访问层进行分页。到现在为止还挺好。

现在我可以在页面上抛出一个 DataPager，将它指向 ListView 并获得一个不错的分页 UX。[当您以编程方式而不是以声明方式与数据源控件绑定时，还有更多内容](http://nayyeri.net/blog/using-datapager-and-listview-controls-with-a-custom-data-source-in-the-asp.net/)，但这里的问题是 DataPager 期望每次都检索整个结果集，它应该从中计算分页，所以它看到单页结果作为可用记录总数返回，并呈现为好像只有一页可用结果一样。换句话说，如果我们切换到 GetClients 的非分页版本，上述场景可以很好地使用 DataPager：

```
List<Client> clientList = clientData.GetClients(criteria);
uxClientList.DataSource = clientList;
uxClientList.DataBind(); 
```

显然，由于我们的数据访问层足以为我们提供一次检索页面的方法，因此这比每次都检索所有记录更可取。如果我们可以明确地通知 DataPager 可用记录总数，这样它仍然可以自动创建分页输出，但一次只需要一页就可以了。

我还没有找到一个简单的方法来做到这一点，我也没有在搜索中找到任何东西。诚然，我目前对 DataPager 的实现没有深入的了解，所以希望我忽略了一些东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-10T00:01:24.780

看看 ListViewPagedDataSource 和它的[AllowServerPaging](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listviewpageddatasource.allowserverpaging.aspx)属性，我想这**可能**是你正在寻找的......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T23:52:43.283

你没有忽略任何事情。

处理大型结果集时，您需要关闭分页并添加自己的分页控件。

以我的经验 << < > >> 就足够了。无论如何，没有人超过第 3 页。

# algorithm - 图像识别和 3D 渲染

> ID：429718
> 
> 赞同：5
> 
> 时间：2009-01-09T21:00:06.627
> 
> 标签：algorithm, image-recognition, 3d-rendering

拍摄对象的图像（在这种情况下是预定义的对象）并开发一种算法以从具有不同复杂性背景的照片中仅剪切该对象是多么困难。

除此之外，照片的对象（比如房子、汽车、狗——但总是一种类型）需要转换为 3d 渲染。我知道有可用的 3d 渲染引擎（收费、免费或带有某些条款），但要使其工作，需要以各种方式测量对象（主体）——例如，如果这是一个人，我们需要测量身高、肩膀的曲率、脸的半径、每个手指的长度等。

解决这个问题的可行性是多少？有人知道这个研究领域有什么好的链接吗？我已经看到了这个问题的开源解决方案，这让我想到了在跟踪对象以将其裁剪出来的同时测量对象是否容易。

谢谢

* * *

本质上我想拍一张 2d 图像（典型图像：这比包含多个对象的复杂照片更容易，等等）

![http://benmartin3d.com/WIP/Project1/image1small.jpg](https://i.stack.imgur.com/Z736K.jpg),

但实际上我想把它变成一个 3d 图像，所以我想做的不是构建一个 3d 渲染/建模引擎吗？

此外，我提供的链接进入 3ds max，设置了一些属性，并进行了渲染。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T21:21:45.693

听起来你想做几件事，都在计算机视觉领域。

1.  对象识别（即找到预定义的对象）
2.  3D重建（从图像制作3d模型）
3.  图像分割（只从背景中切出您担心的对象）

我按照从易到难的顺序对它们进行了排名（根据我有限的理解）。总之，我会说这是一个非常复杂的问题。我会查看以下 Wikipedia 链接以获取更多信息：

[计算机视觉概述（维基百科）](http://en.wikipedia.org/wiki/Computer_vision)

[八点算法（用于 3d 重建）](http://en.wikipedia.org/wiki/Eight-point_algorithm)

[图像分割](http://en.wikipedia.org/wiki/Segmentation_(image_processing))

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T22:08:40.623

没错，这是一组极其困难的问题，尤其是从 2D 图像推断 3D 信息的问题。对于我们的视觉系统如何从 2D 图像推断 3D 信息的理解非常有限，其中一种方法被称为[“Shape from Shading”](http://www.google.com/search?q=shape+from+shading)，链接的谷歌搜索显示我们知道多少（以及因此知道多少）。

抢

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-11T14:15:32.387

这是一项非常艰巨的任务。最难的部分不是从图像中识别或分割对象，而是从 2-D 图像中推断对象的 3-D 几何形状。如果您可以使用立体相机（或激光扫描仪，如果您可以使用的话，您将获得更大的成功；）。

对于二维图像，请尝试在谷歌上搜索“shading-from-shading”。这是一种从 2-D 图像推断 3-D 形状的方法。它确实对照明条件和表面属性（BRDF 和几何形状）做出了假设，这些假设在许多情况下可能会失败，但如果您仅将它用于预定义的对象类别（例如人脸），它可以很好地工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T21:26:27.573

假设这是可能的，那将是非常困难的，尤其是只有一张物体的图像。光栅化器必须猜测物体的深度和距离。

您所描述的听起来与[Microsoft PhotoSynth](http://livelabs.com/photosynth/)非常相似。

# regex - 正则表达式模式 - 允许字母数字、一堆特殊字符，但不允许一定的字符序列

> ID：429719
> 
> 赞同：2
> 
> 时间：2009-01-09T21:00:08.327
> 
> 标签：regex, validation, match

我有以下正则表达式：

```
(?!^[&#]*$)^([A-Za-z0-9-'.,&@:?!()$#/\\]*)$ 
```

所以允许 AZ、aZ、0-9 和这些特殊字符`'.,&@:?!()$#/\`

如果按此顺序在字符串中的任何位置遇到以下字符集，我想不匹配：

```
&# 
```

当我只使用“&#”作为输入运行这个正则表达式时，它与我的模式不匹配，我得到一个错误，太好了。当我使用它运行正则表达式时，`'.,&@:?!()$#/\ABC123`它确实符合我的模式，没有错误。

但是，当我运行它时：

```
'.,&#@:?!()$#/\ABC123 
```

它也不会出错。我在检查 序列时做错了。

有人能告诉我我做错了什么吗，我对这些事情不是很好。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T21:20:57.413

借用一种技术来匹配带引号的字符串，`&`从你的字符类中删除，添加一个替代`&` **not**跟随`#`，并允许字符串可选地以 结尾`&`：

> `^((?:[A-Za-z0-9-'.,@:?!()$#/\\]+|&[^#])*&?)$`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T21:09:57.747

我实际上会分两部分来做：

1.  检查您允许的字符集。为此，我会查找不允许的字符，如果匹配则返回 false。这意味着我有一个很好的简单表达：
    `[^A-Za-z0-9'\.&@:?!()$#^]`
2.  检查您的禁止子字符串。而且由于它只是一个子字符串，因此我什至可能不会为此部分使用正则表达式。

你没有提到你的语言，但如果在 C# 中：

```
bool IsValid(string input)
{
    return !(   input.Contains("&#")  
               || Regex.IsMatch(@"[^A-Za-z0-9'\.&@:?!()$#^]", input) 
            );
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:16:35.347

假设 Perl 兼容 RegExp

不匹配字符串 '&#'：

> `(?![^&]*&#)^([A-Za-z0-9-'.,&@:?!()$#/\\]*)$`

尽管您不需要括号，因为您正在匹配整个字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T21:20:27.803

`^((?!&#)[A-Za-z0-9-'.,&@:?!()$#/\\])*$`

请注意，最后一个 \ 被转义（加倍）`\\`所以如果不在反引号中，则会自动变成 \

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T21:30:29.547

我建议在条件中使用两个正则表达式：

```
 if (string has sequence "&#")
      return false
    else
      return (string matches sequence "A-Za-z0-9-'.,&@:?!()$#/\") 
```

我相信你的第二个“主要”正则表达式

```
^([A-Za-z0-9-'.,&@:?!()$#/\])$" 
```

有几个错误：

*   它只会测试你的集合中的一个角色
*   正则表达式中的`\`字符是一个标记，表示下一个字符是某种“类”字符的一部分（例如`\n`= 是换行符）。字符序列`\]`实际上导致您的括号列表不被终止。

你可能会更好地使用

```
^[A-Za-z0-9-'.,&@:?!()$#/\\]+$ 
```

请注意，斜线字符由双斜线表示。

该`+`字符表示至少有一个被测试的字符必须与正则表达式匹配；如果可以传递零长度字符串，请将 替换`+`为`*`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-10T04:44:27.690

仅供参考，虽然 Ben Blank 的正则表达式有效，但它比需要的复杂。我会这样做：

```
^(?:[A-Za-z0-9-'.,@:?!()$#/\\]+|&(?!#))+$ 
```

因为我使用了否定的前瞻而不是否定的字符类，所以正则表达式不需要任何额外的帮助来匹配字符串末尾的 & 符号。

# asp.net-mvc - 如何摆脱验证警告

> ID：429722
> 
> 赞同：2
> 
> 时间：2009-01-09T21:01:11.400
> 
> 标签：asp.net-mvc, visual-studio, response

完整的警告是 Validation (): Element 'html' 出现的次数太少

这是一个 JSON 视图，您可能会猜到它返回一个 JSON 结果，因此没有 html。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T21:35:54.153

ASP.NET MVC 能够将 JSON 数据作为正确的 json 响应返回。看来您正在使用 HTTP 响应，它期望 HTML 存在于其中。

这是[使用 JSON.NET 构建 JSON ActionResult](http://james.newtonking.com/archive/2008/10/16/asp-net-mvc-and-json-net.aspx)的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-10T05:07:05.927

[http://www.dev102.com/2008/08/19/jquery-and-the-aspnet-mvc-framework/](http://www.dev102.com/2008/08/19/jquery-and-the-aspnet-mvc-framework/)这里也是另一个教程。

# jquery - 使用 jquery ajax 函数调用 Web 服务两次

> ID：429736
> 
> 赞同：0
> 
> 时间：2009-01-09T21:05:30.097
> 
> 标签：jquery, ajax

我在 jquery 中使用 $.ajax 函数来调用 asmx 服务。当我查看来自提琴手的请求时，我看到我每次调用都有两个请求。一个具有 text/html 的内容类型，当然返回 401 未授权状态，另一个具有正确的内容类型并返回正确的数据。谁能告诉我为什么要这样做以及如何修复它或是否需要修复？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T21:07:54.427

当您禁用匿名请求（您可能启用了 Windows 身份验证）时，这是正常的。401 是要求提供凭据的挑战。

# windows - 通过注册表检测已安装的程序

> ID：429738
> 
> 赞同：64
> 
> 时间：2009-01-09T21:06:13.730
> 
> 标签：windows, registry

我需要开发一个过程来检测用户计算机是否安装了某些程序，如果是，是什么版本。我相信我需要一个包含注册表位置和密钥的列表来查找并将其提供给程序，这不是问题。有没有更好的方法来实现这一点？

我的第一个想法是在卸载条目中检查注册表，但似乎我希望检测的应用程序之一没有。所有使用应用程序进入的注册表的标准位置是什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-09T21:26:54.703

在 64 位系统上，x64 密钥是：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall 
```

大多数程序都列在那里。看钥匙： `DisplayName` `DisplayVersion`

请注意，最后一个并不总是设置！

在 64 位系统上，x86 密钥（通常具有更多条目）是：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-01-09T21:41:23.067

用户特定设置应写入 HKCU\Software，机器特定设置应写入 HKLM\Software。在这些键下，结构`[software vendor name]\[application name]`（例如`HKLM\Software\Microsoft\Internet Explorer`）可能是最常见的，但这只是一种惯例，而不是自然法则。

许多（大多数？）应用程序也将其卸载条目添加到`HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\[app name]`，但同样，并非所有应用程序都这样做。

这些是最重要的键；但是，注册表的内容不必准确地代表已安装的软件 - 可能该应用程序安装了一次，但随后被手动删除，或者卸载程序没有删除它的所有痕迹。如果您想确定，请检查文件系统以查看应用程序是否仍然存在于其注册表项所说的位置。

编辑：

如果您是管理员组的成员，您可以检查`HKEY_USERS`配置单元 - 每个用户的 HKCU 实际上都驻留在那里（您需要知道用户 SID，或者通过所有这些）。

注意：正如@Brian Ensink 所说，“已安装”是一个有点模糊的概念——我们是否试图找到用户可以运行的内容？有些软件甚至根本不写入注册表：搜索“便携式应用程序”以查看经过专门修改以直接从媒体 (CD/USB) 运行且*不会*在计算机上留下任何痕迹的应用程序。我们可能还必须扫描磁盘、网络磁盘以及用户下载的任何内容，以及 Internet 上全球可访问的 Windows 共享（是的，这些东西是合法存在的 -`\\live.sysinternals.com\tools`想到了）。在这个方向上，用户可以运行的内容没有真正的限制，除非系统策略阻止。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-09T21:40:18.200

您可以使用 MSI API 枚举 Windows Installer 安装的所有内容，但这不会列出机器上可用的所有软件。在不了解您需要什么的情况下，我认为“已安装”的概念有点模糊。有很多方法可以将软件部署到系统中，从大型复杂的安装程序到 ZIP 文件以及介于两者之间的所有内容。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-12T16:00:08.837

应用程序不需要有任何注册表项。事实上，许多应用程序根本不需要安装。U3 USB 记忆棒就是一个很好的例子；它们上的程序只是从文件系统运行。

如前所述，大多数优秀的应用程序都可以通过它们的卸载注册表项找到。这实际上是一对密钥，每个用户和每个机器（HKCU/HKLM - Piskvor 只提到了 HKLM 一个）。但是，它并不（总是）给你安装目录。

如果它在 HKCU，那么您必须意识到这`HKEY_CURRENT_USER`实际上意味着“当前用户”。其他用户有自己的 HKCU 条目，以及自己安装的软件。你找不到那个。在具有漫游配置文件的公司网络上读取*每个* `HKEY_USERS`配置单元都是一场灾难。您真的不想从远程 [美国|中国|欧洲] 办公室获取 1000 个帐户。

即使安装了应用程序，并且您知道在哪里，它也可能与您所拥有的“版本”概念不同。最好的来源是可执行文件中的“版本”资源。那确实是复数形式，因此您必须找到所有这些，从所有中提取版本资源，并在发生冲突时确定合理的东西。

所以——祝你好运。失败的方法有很多种。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-07-14T20:37:44.890

您可以使用 PowerShell 脚本查看寄存器并获取已安装程序的详细信息。下面的脚本将生成一个包含已安装程序的完整列表的文件。使用“.ps”扩展名保存它并双击该文件。

```
#
# Generates a full list of installed programs.
#

# Temporary auxiliar file.
$tmpFile = "tmp.txt"

# File that will hold the programs list.
$fileName = "programas-instalados.txt"

# Columns separator.
$separator = ","

# Delete previous files.
Remove-Item $tmpFile
Remove-Item $fileName

# Creates the temporary file.
Create-Item $tmpFile

# Searchs register for programs - part 1
$loc = Get-ChildItem HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall
$names = $loc |foreach-object {Get-ItemProperty $_.PsPath}
foreach ($name in $names)
{
    IF(-Not [string]::IsNullOrEmpty($name.DisplayName)) {      
        $line = $name.DisplayName+$separator+$name.DisplayVersion+$separator+$name.InstallDate
        Write-Host $line
        Add-Content $tmpFile "$line`n"        
    }
}

# Searchs register for programs - part 2
$loc = Get-ChildItem HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall
$names = $loc |foreach-object {Get-ItemProperty $_.PsPath}
foreach ($name in $names)
{
    IF(-Not [string]::IsNullOrEmpty($name.DisplayName)) {      
        $line = $name.DisplayName+$separator+$name.DisplayVersion+$separator+$name.InstallDate
        Write-Host $line
        Add-Content $tmpFile "$line`n"
    }
}

# Sorts the result, removes duplicate lines and
# generates the final file.
gc $tmpFile | sort | get-unique > $filename 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-09T21:21:42.980

似乎寻找特定于已安装程序的东西会更好，但 HKCU\Software 和 HKLM\Software 是要寻找的地方。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-15T01:01:59.540

除了上面提到的所有注册表项之外，您可能还需要查看 HKEY_CURRENT_USER\Software\Microsoft\Installer\Products 以获取仅为当前用户安装的程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-29T15:02:00.350

Win32_Product 从不显示所有内容，仅显示通过 MSI 安装程序安装的软件（据我所知。）

有很多软件包是通过其他安装程序安装的，这些安装程序没有出现在其中。需要另一种方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-08-11T04:30:31.633

HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Compatibility Assistant\Persisted

# sql - 在 SQL Server 2005 中检查登录是否存在的最佳方法是什么

> ID：429745
> 
> 赞同：1
> 
> 时间：2009-01-09T21:08:08.983
> 
> 标签：sql, sql-server, sql-server-2005

我正在寻找检查 SQL Server 2005 中是否存在数据库登录的最佳方法。我目前正在使用

```
IF suser_sid('loginname') IS NOT NULL 
```

但 suser_sid() 在某些不存在登录名的情况下会返回一个值。

在 SQL 2000 中，我们使用

```
SELECT * FROM [Master].[dbo].[sysxlogins] WHERE [name] ='loginname' 
```

但该表在 SQL 2005 中不存在。

有一个关于[检查用户是否存在的](https://stackoverflow.com/questions/356000)类似问题，这很有帮助，但我正在寻找登录名的存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T21:11:54.717

对于 sql2005...

```
select * from master.sys.syslogins WHERE [name] ='loginname' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-22T14:39:40.353

`syslogins`微软不推荐。最好使用`sys.server_principals`.

```
select * from sys.server_principals where name = 'login_name' 
```

# jquery - jQuery：颜色渐变旋转

> ID：429756
> 
> 赞同：2
> 
> 时间：2009-01-09T21:12:56.243
> 
> 标签：jquery

我需要一个可以在某事完成时调用的函数，例如fadeOut、fadeIn 等等...

我需要的功能是使用 jQuery 进行 bg-color/font-color 旋转。我希望它在两种颜色之间褪色 X 秒。用了谷歌没有结果。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T21:14:55.647

有一个插件：

[http://plugins.jquery.com/project/color](http://plugins.jquery.com/project/color)

# c# - IDataReader 和“HasColumn”，最好的方法？

> ID：429758
> 
> 赞同：6
> 
> 时间：2009-01-09T21:13:36.960
> 
> 标签：c#, ado.net, idatareader

我已经看到了两种常见的方法来检查 IDataReader 中是否存在列：

```
public bool HasColumn(IDataReader reader, string columnName)
{
  try
  {
      reader.getOrdinal(columnName)
      return true;
  }
  catch 
  {
       return false;
  }
} 
```

或者：

```
public bool HasColumn(IDataReader reader, string columnName)
{

    reader.GetSchemaTable()
         .DefaultView.RowFilter = "ColumnName='" + columnName + "'";

    return (reader.GetSchemaTable().DefaultView.Count > 0);
} 
```

就个人而言，我使用了第二个，因为我讨厌为此使用异常。

但是，在大型数据集上，我相信 RowFilter 可能必须对每列进行一次表扫描，这可能非常慢。

想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-14T01:05:37.253

我想我对这颗古老的宝石有一个合理的答案。

我会采用第一种方法，因为它更简单。如果您想避免异常，您可以缓存字段名称并在缓存上执行 TryGet。

```
public Dictionary<string,int> CacheFields(IDataReader reader)
{

    var cache = new Dictionary<string,int>();
    for (int i = 0; i < reader.FieldCount; i++)
    {
        cache[reader.GetName(i)] = i;
    }
    return cache;
} 
```

这种方法的好处是它更简单，并为您提供更好的控制。另外，请注意，您可能想研究不区分大小写或不区分假名的比较，这会使事情变得有点棘手。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T23:22:47.167

很大程度上取决于您如何使用 HasColumn。您是只调用一次或两次，还是在循环中重复调用它？该列可能存在还是事先完全未知？

设置行过滤器可能每次都会进行表扫描。（此外，理论上，GetSchemaTable() 可以在每次调用时生成一个全新的表，这会更加昂贵——我不相信 SqlDataReader 会这样做，但在 IDataReader 级别，谁知道呢？）但如果你只调用一次或两次我无法想象这是一个那么大的问题（除非你有成千上万的列或其他东西）。

（但是，我至少将 GetSchemaTable() 的结果存储在方法内的本地 var 中，以避免快速连续调用它两次，如果不将其缓存在某个地方，那么您的特定 IDataReader 确实会重新生成它。）

如果你事先知道在正常情况下你要求的那一列会出现，那么异常方法就更可口了（因为不存在的那一列，其实是个例外）。即使没有，它的性能也可能会稍微好一些，但是除非你反复调用它，否则你应该问问自己性能是否真的那么重要。

如果你重复调用它，你可能应该考虑另一种方法，例如：调用 GetSchemaTable() 一次，循环遍历表，并将字段名称加载到字典或其他一些专为快速设计的结构中查找。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T20:05:20.003

我不会担心性能影响。即使您有一个包含 1000 列的表（这将是一个巨大的表），您仍然只进行 1000 行的“表扫描”。这很可能是微不足道的。

过早的优化只会引导您进行不必要的复杂实现。实施您认为最好的版本，然后衡量性能影响。如果与您的性能要求相比它是不可接受的，那么请考虑替代方案。

# java - 在 linux 平台上使用套接字时是否存在文件描述符泄漏？

> ID：429762
> 
> 赞同：6
> 
> 时间：2009-01-09T21:14:35.147
> 
> 标签：java, linux, sockets, file-descriptor

如果我通过调用例如打开和关闭套接字

```
Socket s = new Socket( ... );
s.setReuseAddress(true);
in = s.getInputStream();
...
in.close(); 
s.close(); 
```

Linux 声明此套接字仍处于打开状态，或者至少存在连接的文件描述符。通过 lsof 查询此进程的打开文件时，有一个关闭连接的条目：

```
COMMAND  PID   USER   FD   TYPE DEVICE     SIZE   NODE NAME
java    9268 user    5u  sock    0,4           93417 can't identify protocol 
```

该条目将一直保留到程序关闭为止。有没有其他方法可以最终关闭套接字？我有点担心我的 java 应用程序可能会阻塞许多文件描述符。这可能吗？或者即使设置了 ReuseAdress，java 是否保留这些套接字以重新使用它们？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T21:40:48.997

如果这些套接字都处于 TIME_WAIT 状态，这是正常的，至少有一小会儿。用 netstat 检查；套接字通常会挂起几分钟，以确保在将端口重新用于新套接字之前成功丢弃来自套接字的散乱数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T23:04:55.300

您可能还想检查`/proc/<pid>/fd`，该目录将包含您当前打开的所有文件描述符。如果在您关闭套接字后文件消失了，您将不会遇到任何问题（至少不会与您的文件描述符有关：）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-09T08:08:23.507

我认为这不是你的程序的问题。

在 SUN_Java 中，当 socket 相关的 native lib 加载时，会创建一个 MAGIC_SOCK fd。

在 MAGIC_SOCK 上写入将导致 Connect Rest 异常，在 MAGIC_SOCK 上读取将导致 EOF。

magic_sock 的 peer 已经完全关闭，magic_sock 本身是 half_closed，状态会一直保持“无法识别协议”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T21:19:39.897

也许它是某个其他协议的套接字（“无法识别协议”嗯？）在实现内部用于执行某些操作，该套接字是在第一个套接字上创建的。

您是否尝试过反复创建套接字并关闭它们，以查看这些套接字是否真的存在？这似乎是一次性的。

Java 可能在内部使用套接字做很多事情——它们可能是 Unix、Netlink（在 Linux 下）或其他类型的套接字。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T22:47:29.140

创建一个小的 bash 脚本来监视某个应用程序或 pid 的打开套接字，并让它在测试您的 java 应用程序时运行。

无论如何，我怀疑这件事是否存在任何类型的泄漏，因为套接字在 linux/unix 世界中非常常用，而且这种问题会很快冒出来

# google-maps - 自定义 Google 地图信息窗口？

> ID：429763
> 
> 赞同：-1
> 
> 时间：2009-01-09T21:14:40.983
> 
> 标签：google-maps

我在一个客户的网站上工作，一个地方教会。我使用地图页面上的链接功能嵌入了谷歌地图。地图上的信息窗口包括“评论”，教会对此表示关注。有没有办法从信息窗口中删除它？我不想自己删除任何评论，只是信息窗口上的那个链接？

这可能吗？是否有任何其他自定义选项（除了大小）可以通过查询字符串进行操作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T23:41:23.713

大约 2 年前，我使用 API 和一些代码操作创建了一个完全控制气泡内容的[自定义地图。](http://biesdesign.com/ross/index.php)单击上面的链接进行演示。我已经清理了这个答案的代码，但要实现你需要用适当的值替换所有 YOUR__BLANK__HERE 文本。

**第 1 步：**调用 gMaps API

```
<script src="http://maps.google.com/maps?file=api&v=2&key=YOUR_API_KEY_HERE"
        type="text/javascript">
</script> 
```

**第 2 步：**在文档正文中，创建一个 id 为“map”的元素。使用 CSS 调整大小和位置。它需要高度和宽度。

```
 <div id="map" class="content"></div> 
```

**第 3 步：**在 DOM 中定义好 div 后，可以安全地插入以下脚本标签：

```
<script type="text/javascript">
//<![CDATA[

// Check to see if this browser can run the Google API
if (GBrowserIsCompatible()) {

  var gmarkers = [];
  var htmls = [];
  var to_htmls = [];
  var from_htmls = [];
  var i=0;

  // A function to create the marker and set up the event window
  function createMarker(point,name,html) {
    var marker = new GMarker(point);

    // The info window version with the "to here" form open
    to_htmls[i] = html +
       '<br />Start address:<form action="http://maps.google.com/maps" method="get">' +
       '<input type="text" SIZE=40 MAXLENGTH=40 name="saddr" id="saddr" value="" /><br>' +
       '<INPUT value="Get Directions" TYPE="SUBMIT">' +
       '<input type="hidden" name="daddr" value="' + point.lat() + ',' + point.lng() + 
              // "(" + name + ")" + 
       '"/>';
    // The inactive version of the direction info
    html = html + '<br><a href="javascript:tohere('+i+')">Get Directions<'+'/a>';

    GEvent.addListener(marker, "click", function() {
      marker.openInfoWindowHtml(html);
    });
    gmarkers[i] = marker;
    htmls[i] = html;
    i++;
    return marker;
  }

  // functions that open the directions forms
  function tohere(i) {
    gmarkers[i].openInfoWindowHtml(to_htmls[i]);
  }

  // Display the map, with some controls and set the initial location 
  var map = new GMap2(document.getElementById("map"));
  map.setCenter(new GLatLng(
    YOUR_LATITUDE_HERE,
    YOUR_LONGITUDE_HERE
    ), 
    YOUR_ZOOM_LEVEL_HERE // a value of 13 worked for me
  );

  // Set up one marker with an info window 
  var marker = createMarker(
    new GLatLng(
      YOUR_LATITUDE_HERE,
      YOUR_LONGITUDE_HERE
    ),
    'YOUR_MARKER_NAME_HERE',
    '<i>YOUR_HTML_HERE<'+'/i>');

  /* repeat the process to add more markers
  map.addOverlay(marker);
  var marker = createMarker(
    new GLatLng(
      YOUR_LATITUDE_HERE,
      YOUR_LONGITUDE_HERE
    ),
    'YOUR_MARKER_NAME_HERE',
    '<i>YOUR_HTML_HERE<'+'/i>');
  map.addOverlay(marker);*/
}

// display a warning if the browser was not compatible
else {
  alert("Sorry, the Google Maps API is not compatible with this browser");
}

// This Javascript is based on code provided by the
// Blackpool Community Church Javascript Team
// http://www.commchurch.freeserve.co.uk/   
// http://www.econym.demon.co.uk/googlemaps/

//]]>
</script> 
```

使用此代码，气泡包含您在 YOUR_HTML_HERE 中指定的 html 以及指向“获取路线”的链接，该链接（单击时）会变成一个要求起始地址的文本框。不幸的是，查询的结果会在新的浏览器窗口中打开（因为在最初发布 API 时不包括方向功能）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T21:28:07.023

我想我找到了自己问题的答案。信息窗口本身无法修改，但通过链接到地址本身的地图而不是作为商业实体的教堂就可以了。行车路线链接仍然存在，这主要是他们想要的。

# oracle - ORA-28579: 从外部过程代理回调期间出现网络错误

> ID：429777
> 
> 赞同：0
> 
> 时间：2009-01-09T21:17:56.593
> 
> 标签：oracle, oracle10g, external-process

有人在尝试从 Oracle 查询调用外部 C 函数时看到此错误吗？我使用的是 Oracle 10g，每次尝试调用库中的两个函数之一时都会出现此错误。对另一个函数的调用每次都返回正常，尽管工作的函数都是独立的，没有调用任何 OCI* 函数。

这是用于调用失败的 C 代码的存储过程：

```
CREATE OR REPLACE PROCEDURE index_procedure(text in clob, tokens in out nocopy clob, location_needed in boolean)
as language c
name "c_index_proc"
library lexer_lib
with context
parameters
(
  context,
  text,
  tokens,
  location_needed
); 
```

任何帮助，将不胜感激。我在此错误消息中发现的所有内容都表明要采取的措施是：联系 Oracle 客户支持。

编辑：我已经将其范围缩小到我知道在标记 clob 上调用 OCIlobTrim（将其截断为 0 长度）后 libclntsh 中存在段错误。这是我用来调用此过程的代码。

```
declare text CLOB; tokens CLOB;
begin
dbms_lob.createtemporary(tokens, TRUE);
dbms_lob.append(tokens, 'token');
dbms_lob.createtemporary(text, TRUE);
dbms_lob.append(text, '<BODY>Test Document</BODY>');
index_procedure(text, tokens, FALSE);
dbms_output.put_line(tokens);
end;
/ 
```

此设置是否存在可能导致 OCIlobTrim 问题的问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T21:33:02.833

看起来这是那些错误之一，基本上意味着任何数量的事情都可能与外部程序出错。

10.2.0.3 中有一个已知错误，不知道是否相关：

> 当尝试从使用 ODCITable/ANYDATASET 接口在“C”中实现的流水线表函数中选择数据时，会发生 ORA-28579。ODCITableDescribe 工作正常，但 ODCITableFetch 生成 ORA-28579 错误。

我会建议：

1.  在数据库服务器跟踪目录和外部 proc 所在的目录中查找发生错误时生成的任何日志或跟踪文件。
2.  以某种方式检测您的外部过程，以便您可以尝试自己跟踪其执行。
3.  联系 Oracle 支持

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T19:54:49.063

好吧，升级到 10.2.0.4（使用 10.2.0.1）至少给了我一个可以理解的错误，而不是一个相当无用的核心文件和 ORA-28579。

事实证明，我正在调试的代码假设调用 OCILobRead 将一次性返回所有数据。任何使用固定宽度字符集的客户端都是这种情况。

对于使用可变宽度字符集的客户端，情况并非如此，OCILobRead 实际上是在读取部分数据并返回 OCI_NEED_DATA，并且未来对 OCIlobTrim 和 OCILobWrite 的调用失败，因为对 OCILobRead 的调用仍然挂起。解决方案是循环 OCILobRead 调用，直到不再返回 OCI_NEED_DATA 并且我们的缓冲区中有所有需要的数据。

对 OCIBreak 的调用也将允许 OCILobTrim 和 OCILobWrite 函数继续，尽管我们不会拥有所有需要的输入数据。

# mysql - MySQL 问题 - 唯一键无法正常运行，还是我误解了？

> ID：429805
> 
> 赞同：14
> 
> 时间：2009-01-09T21:26:05.110
> 
> 标签：mysql, nullable, composite-key, unique-key

我正在尝试创建一个关系，其中可能包含四个不同部分中的任何一个，但相同部分的任何集合都应该被视为唯一的。

示例：分配必须有一个指定的公司，可以选择有一个指定的位置、工作组和程序。分配可能没有没有位置的工作组。

假设我们有公司 A、B、C；位置 X、Y、Z；工作组 I、J、K 和程序 1、2、3。

所以有效的关系可能包括 A - X - I - 1 A - Z - 2 B - Y C C - 3 B - Z - K

但无效的关系将包括 A - K（无位置的工作组） Y - K - 1（无公司）

所以，为了创建我的表，我创建了

```
companyID INT NOT NULL,
FOREIGN KEY companyKEY (companyID) REFERENCES company (companyID),
locationID INT,
FOREIGN KEY locationKEY (locationID) REFERENCES location (locationID),
workgroupID INT,
FOREIGN KEY workgroupKEY (workgroupID) REFERENCES workgroup (workgroupID),
programID INT,
FOREIGN KEY programKEY (programID) REFERENCES program (programID),
UNIQUE KEY companyLocationWorkgroupProgramKEY (companyID, locationID, workgroupID, programID) 
```

我认为这将处理我的所有关系，除了如果有工作组（我认为我可以很高兴地以编程方式或使用触发器来完成）分配位置的必要性之外

但是，当我测试此架构时，它允许我输入以下内容...

```
INSERT INTO test VALUES (1, null, null, null), (1, null, null, null); 
```

……毫无怨言。我猜 (1, null, null, null) 不等于自身，因为包含了空值。如果是这种情况，有什么办法可以处理这种关系吗？

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-09T21:32:41.740

这是一个功能（尽管也不是我所期望的）。

[该线程](http://lists.mysql.com/mysql/203863)建议将您的密钥设置为主键以获得您期望的行为：

> 这是一个特性 - NULL 值是未定义的值，因此两个 NULL 值不相同。可能有点令人困惑，但当你考虑它时，它是有道理的。
> 
> UNIQUE 索引确实确保非 NULL 值是唯一的；您可以指定您的列不接受 NULL 值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T21:32:25.143

我能想到在没有额外的触发器/编程的情况下处理这个问题的唯一方法是在每个引用的表中都有一个“以上都不是”值，这样你的测试看起来像

```
INSERT INTO test VALUES (1, NO_LOCATION, NO_WORKGROUP, NO_PROGRAM),
                        (1, NO_LOCATION, NO_WORKGROUP, NO_PROGRAM) 
```

其中`NO_*`标识符是您的 ID 列的正确类型/长度。正如您所期望的那样，这将失败。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:35:03.797

在 MySQL NULL != NULL 或任何东西中。所以这就是 UNIQUE 不起作用的地方。您应该为空白使用另一个默认值，例如零

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-10T04:55:23.610

我认为重要的是要注意，有一种正确的方法可以解释和处理 NULL 值，并且 OP 表现出的行为正是预期的。您可以无视这种行为，并且可以以任何您想要的方式处理您的查询，而不会引起我的反对，但最好“接受”描述某种形式的最佳实践的答案，而不是非标准的个人偏好。

或者，如果您不同意共识最佳实践，您可以不接受任何答案。

这不是一场尽快让答案被接受的竞赛。我认为，审议和合作也应该成为这个过程的一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-07-12T03:23:51.600

我看到这是在 2009 年提出的。但是经常从 MySQL 请求它：[https](https://bugs.mysql.com/bug.php?id=8173) ://bugs.mysql.com/bug.php?id=8173和[https://bugs.mysql.com/bug.php?id =17825](https://bugs.mysql.com/bug.php?id=17825)例如。人们可以点击影响我来尝试获得 MySQL 的关注。

从 MySQL 5.7 开始，我们现在可以使用以下解决方法：

```
ALTER TABLE test 
ADD generatedLocationID INT AS (ifNull(locationID, 0)) NOT NULL,
ADD generatedWorkgroupID INT AS (ifNull(workgroupID, 0)) NOT NULL,
ADD generatedProgramID INT AS (ifNull(programID, 0)) NOT NULL,
ADD UNIQUE INDEX (companyID, generatedLocationID, generatedWorkgroupID, generatedProgramID); 
```

生成列是虚拟生成列，没有存储空间。当用户插入（或更新）时，唯一索引会导致生成的列的值动态生成，这是一个非常快速的操作。

# perl - 我应该如何处理 Perl 方法中的错误，我应该从方法中返回什么？

> ID：429806
> 
> 赞同：5
> 
> 时间：2009-01-09T21:26:06.967
> 
> 标签：perl, language-agnostic, error-handling

我用一个小模块包装了 Perl 的[Net::SSH::Expect](http://search.cpan.org/perldoc?Net::SSH::Expect)，以减少编写用于 HP [iLO](http://en.wikipedia.org/wiki/HP_Integrated_Lights-Out)卡的新配置脚本所需的样板代码。一方面我希望这个包装器尽可能精简，以便非程序员同事可以使用它，但我也希望它尽可能写得好。

它是这样使用的：

```
my $ilo = iLO->new(host => $host, password => $password);
$ilo->login;

$ilo->command("cd /system1");
$ilo->command("set oemhp_server_name=$system_name", 'status=0'); 
```

这是`iLO::command()`：

```
sub command {
    my ($self, $cmd, $response) = @_;

    $response = 'hpiLO-> ' unless defined($response);

    # $self->{ssh} is a Net::SSH::Expect object
    croak "Not logged in!\n" unless ($self->{ssh});

    $self->{ssh}->send($cmd);
    if ($self->{ssh}->waitfor($response, $self->{CMD_TIMEOUT}, '-re')) {
        return {
            before => $self->{ssh}->before(),
            match => $self->{ssh}->match(),
            after => $self->{ssh}->after(),
        };
    } else {
        carp "ERROR: '$cmd' response did not match /$response/:\n\n",
            $self->{ssh}->before()),
            "\n";
        return undef;
    }
} 
```

我有两个相关的查询。首先，我应该如何处理与预期响应不匹配的响应？我想我现在正在做的事情是令人满意的——通过返回，`undef`我表示有些东西坏了，我`croak()`会输出一个错误（虽然很难优雅）。但这感觉就像是代码的味道。如果 Perl 有异常，我会提出一个异常并让调用代码决定是否忽略它/退出/打印警告，但它没有（嗯，在 5.8 中）。也许我应该返回一些`iLO::response`带有错误消息和内容的其他对象（或其他东西）`$ilo->before()`（这只是 Net::SSH::Expect's `before()`）？但是如果我这样做——并且必须将每一个都包装`$ilo->command`在一个测试中以捕获它——我的脚本将再次充满样板文件。

其次，我应该为成功回报什么？同样，我的哈希或多或少包含来自 Net::SSH::Expect 的响应，但它在某种程度上感觉不“正确”。虽然这个例子是用 Perl 编写的，但我用其他语言编写的代码发出了同样熟悉的气味：我永远不知道如何或从方法返回什么。你能告诉我什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T21:55:23.117

在 Perl 中引发异常的常用方法是使用[die](http://perldoc.perl.org/functions/die.html)。捕获它们的常用方法是使用带有块作为参数的 eval，并在 eval 完成后测试 $@ [。](http://perldoc.perl.org/functions/eval.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-09T22:09:02.557

如果您熟悉 Java 等语言的异常，请考虑`die`as`throw`和`eval`as`try`和`catch`。而不是返回`undef`，你可以做这样的事情：

```
if ($self->{ssh}->waitfor($response, $self->{CMD_TIMEOUT}, '-re')) {
    return {
        before => $self->{ssh}->before(),
        match => $self->{ssh}->match(),
        after => $self->{ssh}->after(),
    };
}

die "ERROR: '$cmd' response did not match /$response/:\n\n" 
. $self->{ssh}->before(); 
```

然后，在您的调用代码中：

```
eval { 
    $ilo->command("set oemhp_server_name=$system_name", 'status=0');
};

if ( my $error = $@ ) { 
    # handle $error here
} 
```

就像其他语言中的异常一样，这允许您随时退出子方法，而不必担心在调用堆栈上传播返回值。他们将被第一个`eval`找到他们的街区抓住。此外，您可以`die`再次重新抛出您无法处理的异常备份堆栈。

更好的是，您可以使用`die`抛出一个对象，您的异常处理程序可以询问有用的信息和错误消息。我喜欢为此目的使用[Exception::Class 。](http://search.cpan.org/~drolsky/Exception-Class-1.23/lib/Exception/Class.pm)[Error](http://search.cpan.org/~uarun/Error-0.15/Error.pm)模块也提供了一些语法糖来执行类似 Java 的 try/catch 块。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-10T02:41:07.813

你会在 googlespace 中找到很多关于这类事情的讨论。无论您决定什么，最佳实践是不要重载任何值，因此返回值意味着不同的东西。它应该始终是错误代码，或者永远不应该是错误代码。人们不必查看实际值来确定它是否是错误代码。

查看 CPAN 上流行的 Perl 模块（或您已经使用的模块）以了解它们的作用。[我什至在Mastering Perl](http://www.masteringperl.org)中谈到了这一点，但我并没有给出一个非黑即白的答案。与所有真实代码一样，真正的答案是“视情况而定”。

有很多不同的方法可以做到这一点。不幸的是，这意味着人们以各种方式这样做。既然如此，我将*一致性*作为最重要的规则。大多数代码已经做了什么（不算错误的方式）？如果我必须适应现有的代码库，我会尝试使用大多数代码已经使用的相同类型的接口。

如果没有明确的赢家，请使用几种不同的风格编写用例。哪一个更适合问题或更自然地表达了大多数用户将采取的步骤？这并不总是只为`die`and阅读`eval`。使用您未实现的接口编写示例脚本。您要使用哪种样式？我发现在实现接口之前实际编写脚本比我想象的要多得多。如果我正在写东西供其他人使用，我会向他们展示不同风格的脚本，并询问他们更喜欢哪一个。

而且，如果所有这些都失败了，那就去争取 2d6。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T22:34:00.433

除了使用“die”作为异常之外，还可以添加另一个方法：

```
if (!$ilo->commandSucceeded("set oemhp_server_name=$system_name", 'status=0')) {
     #recover here
} 
```

当然，command() 的内部实现就变成了

```
die ... if !commandSucceeded; 
```

# deployment - 如何使用 Capistrano 部署到单个特定服务器

> ID：429816
> 
> 赞同：60
> 
> 时间：2009-01-09T21:28:28.427
> 
> 标签：deployment, capistrano, release-management

我有一个生产系统，其中有多个服务器担任多个角色。我想通过部署到该特定服务器来测试新的应用服务器，而不必重新部署到生产中的每个服务器。有没有办法让 Capistrano 部署到特定的服务器？理想情况下，我希望能够运行类似的东西

```
cap SERVER=app2.example.com ROLE=app production deploy 
```

如果我只想部署到 app2.example.com。

谢谢！

[更新]我通过执行尝试了wulong建议的解决方案：

```
cap HOSTS=app2.server.hostname ROLE=app qa deploy 
```

但 capistrano 似乎试图在该服务器上执行除应用程序任务之外的其他角色的任务。也许我需要更新我的 cap 版本（我正在运行 v2.2.0）？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-01-22T19:59:02.817

我最终在 capistrano 用户列表上发布了一个问题[，](http://groups.google.com/group/capistrano/browse_thread/thread/592ab63dda72d7e)并得到了 Jamis 的以下回复（为清楚起见，我在此处进行了一些编辑）：

* * *

尝试 HOSTS 环境变量：

```
cap HOSTS=app2.example.com production deploy 
```

请注意，这样做会将 app2 视为处于每个角色中，而不仅仅是恰好在其中声明的任何角色中。

如果您想要进行常规部署，但仅对 app2 执行操作，并且仅当 app2 在配方文件中声明时，您可以改用 HOSTFILTER 变量：

```
cap HOSTFILTER=app2.example.com production deploy 
```

[...]

考虑这个具体的例子。假设您的脚本定义了三个服务器 A、B 和 C。它定义了一个任务“foo”，它（默认情况下）希望在 A 和 B 上运行，而不是在 C 上运行。像这样：

```
role :app, "A", "B"
role :web, "C"

task :foo, :roles => :app do
  run "echo hello"
end 
```

现在，如果你这样做`cap foo`，它将在 A 和 B 上运行 echo 命令。

如果这样做`cap HOSTS=C foo`，它将在 C 上运行 echo 命令，而不管任务的 :roles 参数如何。

如果你这样做`cap HOSTFILTER=C foo`，它根本不会运行 echo 命令，因为 (AB) 和 (C) 的交集是一个空集。（foo 的主机列表中没有与 C 匹配的主机。）

如果这样做`cap HOSTFILTER=A foo`，它将仅在 A 上运行 echo 命令，因为与 (A) 相交的 (AB) 是 (A)。

最后，如果你这样做`cap HOSTFILTER=A,B,C foo`，它将在 A 和 B（但不是 C）上运行 echo 命令，因为 (AB) 与 (ABC) 相交是 (AB)。

总结一下：HOSTS 完全覆盖任务的主机或角色声明，并强制所有内容针对指定的主机运行。另一方面，HOSTFILTER 只是根据给定列表过滤现有主机，只选择那些已经在任务服务器列表中的服务器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-11T00:49:46.633

以下应该是开箱即用的：

```
cap HOSTS=app2.example.com ROLE=app deploy 
```

如果要部署到具有相同角色的 >1 台服务器：

```
cap HOSTS=app2.example.com,app3.example.com,app4.example.com ROLE=app deploy 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-24T02:00:02.043

我有类似的问题并尝试了以下方法。有用：

```
cap production ROLES=web HOSTS=machine1 stats 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-10T02:27:34.877

您应该可以在 deploy.rb 中执行以下操作：

```
task :production do
  if ENV['SERVER'] && ENV['ROLE']
    role ENV['ROLE'], ENV['SERVER']
  else
    # your full config
  end
end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-11T07:53:37.883

您还可以通过这种方式指定任务级主机参数：

```
task :ship_artifacts, :hosts => ENV['DEST_HOST']  do

end 
```

# c# - 如何以编程方式显示文件的上下文菜单？

> ID：429818
> 
> 赞同：1
> 
> 时间：2009-01-09T21:28:48.893
> 
> 标签：c#, .net

在 C# 程序中，我想显示文件的上下文菜单。

例如：如果用户点击我程序中的文件名，我想显示实际的右键菜单。实际上，我的意思是系统上下文菜单。我不需要以编程方式访问内容。我只需要显示它。

有什么想法可以让我开始吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2021-06-04T16:06:43.033

> 显示实际的右键菜单...系统上下文菜单。

不能从 exe 中完成从 win32 exe 中提取控件的操作。必须编写具有相同外观和感觉的自己的上下文菜单。

* * *

在 WPF 中，您可以将 a 添加`ContextMenu`到单击事件打开的文件列表中。

```
 <ListBox Name="myFileListBox">
    <ListBox.ContextMenu>
         <ContextMenu>
             <MenuItem Header="Delete" Click="MenuItemDelete_Click"/>
         </ContextMenu>
    </ListBox.ContextMenu>

    <ListBoxItem>File.txt</ListBoxItem>
    <ListBoxItem>test.txt</ListBoxItem>
    <ListBoxItem>Roland.Txt</ListBoxItem>   
</ListBox> 
```

# asp.net-mvc - 在哪里可以找到 ASP MVC 文档？

> ID：429823
> 
> 赞同：5
> 
> 时间：2009-01-09T21:31:04.070
> 
> 标签：asp.net-mvc, model-view-controller, documentation

谁能告诉我在哪里可以找到完整的 ASP.NET MVC beta 文档？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-09T21:37:21.933

几个好的起点：

*   [http://www.asp.net/learn/mvc/](http://www.asp.net/learn/mvc/)

*   [http://weblogs.asp.net/scottgu/archive/2007/10/14/asp-net-mvc-framework.aspx](http://weblogs.asp.net/scottgu/archive/2007/10/14/asp-net-mvc-framework.aspx)

*   [http://www.asp.net/mvc/](http://www.asp.net/mvc/)

我希望在发布时能够提供更多*完整的文档。*

MVC 也是开源的，并且在 CodePlex 上，所以你当然可以直接浏览源代码。

项目在这里： http: [//www.codeplex.com/aspnet](http://www.codeplex.com/aspnet)和这里： http: [//www.codeplex.com/MVCContrib](http://www.codeplex.com/MVCContrib)

文档在这里：[http ://www.codeplex.com/MVCContrib/Wiki/View.aspx?title=Documentation&referringTitle=Home](http://www.codeplex.com/MVCContrib/Wiki/View.aspx?title=Documentation&referringTitle=Home)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-21T11:18:01.987

您可以在此处的 MSDN 站点上找到它[ASP.NET 模型视图控制器 (MVC)](http://msdn.microsoft.com/en-us/library/dd394709.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:36:50.983

[http://www.asp.net/mvc/](http://www.asp.net/mvc/)将是开始寻找的最合乎逻辑的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T12:33:41.283

有一本书[通过曼宁出版社出版](http://manning.com/palermo/)。它尚未发布，但您可以通过他们的早期访问程序下载多汁的东西。如果您想在一个地方获得大量信息，那可能是一个不错的选择。

# algorithm - “等候名单问题”

> ID：429839
> 
> 赞同：5
> 
> 时间：2009-01-09T21:35:49.240
> 
> 标签：algorithm, language-agnostic, theory

> 一些学生想进入一个班级的部分，有些学生已经注册了一个部分但想改变部分，所以他们都进入了候补名单。只有当有人从该部分掉线时，学生才能进入新部分。没有学生愿意放弃他们已经在的部分，除非可以确保进入他们正在等待的部分。每个部分的等候名单是先到先得。
> 
> 让尽可能多的学生进入他们想要的部分。

上述问题可能很快演变为僵局。我的问题是；这个问题有已知的解决方案吗？

* * *

一个简单的解决方案是依次选择每个部分并强制等待列表中的第一个学生进入该部分，然后检查当事情解决时是否有人最终退出（部分数量为 O(n) 或更多）。这在某些情况下可行，但我认为可能有更好的选择，包括强制一个以上的学生进入一个部分（O(n) 或更多学生数量）和/或一次操作多个部分（O （坏的） ：-）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T21:48:50.447

好吧，这只是归结为在类的有向图中找到循环，对吗？每个链接都是一个想要从一个节点到另一个节点的学生，任何时候你找到一个循环，你就删除它，因为这些学生可以相互解决他们的需求。当你没有周期时，你就完成了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T22:26:13.070

好的，让我们试试。我们有 8 名学生 (1..8) 和 4 个部分。每个学生都在一个部分，每个部分有 2 名学生的空间。大多数学生都想转行，但不是全部。

在下表中，我们看到学生的当前部分、他们需要的部分以及队列中的位置（如果有）。

```
+------+-----+-----+-----+
| stud | now | req | que |
+------+-----+-----+-----+
|    1 |   A |   D |   2 |
|    2 |   A |   D |   1 |
|    3 |   B |   B |   - |
|    4 |   B |   A |   2 |
|    5 |   C |   A |   1 |
|    6 |   C |   C |   - |
|    7 |   D |   C |   1 |
|    8 |   D |   B |   1 |
+------+-----+-----+-----+ 
```

我们可以在图表中显示这些信息：

```
+-----+           +-----+           +-----+
|  C  |---[5]--->1|  A  |2<---[4]---|  B  |
+-----+           +-----+           +-----+
   1               |   |               1
   ^               |   |               ^
   |              [1] [2]              |
   |               |   |               |
  [7]              |   |              [8]
   |               V   V               |
   |               2   1               |
   |              +-----+              |
   \--------------|  D  |--------------/
                  +-----+ 
```

我们试图找到一个有空缺的部分，但没有找到。所以因为所有部分都满了，我们需要一个肮脏的把戏。所以让我们随机选择一个非空队列。在这种情况下，A 部分假设它有一个额外的位置。这意味着学生 5 可以进入 A 部分，在 C 部分留下一个空缺，由学生 7 占据。这在 D 部分留下一个空缺，由学生 2 占据。我们现在在 A 部分有一个空缺。但我们假设该部分A有一个额外的位置，所以我们可以去掉这个假设，得到一个更简单的图。

如果路径从未返回到 A 部分，则撤消移动并将 A 标记为无效起点。用另一个部分重试。如果没有剩余的有效部分，我们就完成了。

现在我们有以下情况：

```
+-----+           +-----+           +-----+
|  C  |           |  A  |1<---[4]---|  B  |
+-----+           +-----+           +-----+
                   |                   1
                   |                   ^
                  [1]                  |
                   |                   |
                   |                  [8]
                   V                   |
                   1                   |
                  +-----+              |
                  |  D  |--------------/
                  +-----+ 
```

我们用另一个随机部分重复这个技巧，这解决了图形。

如果您从几个当前未分配的学生开始，则添加一个额外的虚拟部分作为他们的起点。当然，这意味着任何部分都必须有空缺，否则问题无法解决。

请注意，由于队列中的顺序，可能没有解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T21:49:04.720

这实际上是一个 Graph 问题。您可以将这些等待列表依赖项中的每一个视为有向图上的边。如果这个图有一个循环，那么你有你描述的情况之一。一旦您确定了一个循环，您可以通过“过度填充”其中一个类来选择任何点来“打破”循环，并且您将知道事情会正确解决，因为图中存在一个循环。

# objective-c - 如何从类的实例调用方法？

> ID：429841
> 
> 赞同：2
> 
> 时间：2009-01-09T21:36:18.363
> 
> 标签：objective-c

```
-(NSDictionary *)properties;
+(NSDictionary *)ClassProperties; 
```

现在，如何从子类中调用 ClassProperties？

```
-(NSDictionary *)properties {
    return [? ClassProperties];
} 
```

关键是`ClassProperties`获取类中的属性列表，所以我不能调用基类定义。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-09T23:49:07.753

按照马克的回应，您可以更一般地调用该方法

```
[[self class] ClassProperties] 
```

事实上，如果你的基类和所有子类都实现了`+ (NSDictionary *)ClassProperties`，那么你的基类就可以做到这一点

```
- (NSDictionary *)properties {
    return [[self class] ClassProperties];
} 
```

然后你的任何子类都不需要知道`- (NSDictionary *)properties`. 将根据实际情况调用正确的类方法`self`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T21:39:03.290

您可以只使用子类的类名。

# c++ - C ++中的双重调度/多方法

> ID：429849
> 
> 赞同：9
> 
> 时间：2009-01-09T21:39:26.987
> 
> 标签：c++, design-patterns, polymorphism, late-binding, double-dispatch

我有一个关于 C++ 双重调度的问题。在下面的代码中，我希望第二组的结果与第一组的结果相匹配。

我不知道实际类型（除非我尝试 dynamic_cast），但我知道该对象继承自 BaseClass 类型。实现这一目标的最有效（性能方面）的方法是什么？

在谷歌搜索了一段时间后，我发现了双重调度和 loki 多方法。我在 Shape 示例中遇到的问题是，在我的应用程序中，Processor 和 BaseClass 是完全独立的，并且没有可以相互调用的通用方法。其次，只有一个处理器（即没有任何东西继承自它）。

谢谢你的帮助。

```
#include <iostream>
#include <string>
using namespace std;

class BaseClass{
public:
       BaseClass(){}
       virtual void myFunction(){cout << "base myFunction called" << endl;}
};

class Derived1: public BaseClass{
public:
       Derived1():BaseClass(){}
       void myFunction(){cout << "Derived1 myFunction called" << endl;}
};

class Derived2: public BaseClass{
public:
       Derived2():BaseClass(){}
       void myFunction(){cout << "Derived2 myFunction called" << endl;}
};

class Derived3: public BaseClass{
public:
       Derived3():BaseClass(){}
       void myFunction(){cout << "Derived3 myFunction called" << endl;}

};

class Processor{
public:
       Processor(){}
       virtual void processObj(BaseClass* bc){cout << "got a base object" << endl; bc->myFunction();}
       virtual void processObj(Derived1* d1){cout << "got a derived1 object" << endl; d1->myFunction();}
       virtual void processObj(Derived2* d2){cout << "got a derived2 object" << endl; d2->myFunction(); }
};

int main() {
   BaseClass *bcp=new BaseClass();
   Derived1 *dc1p=new Derived1();   
   Derived2 *dc2p=new Derived2();
   Derived3 *dc3p=new Derived3();

   Processor p;//can also use Processor* p = new Processor()

   //first set results
   p.processObj(bcp);
   p.processObj(dc1p);
   p.processObj(dc2p);
   p.processObj(dc3p);

   BaseClass *bcp1=bcp;
   BaseClass *dc1p1=dc1p;   
   BaseClass *dc2p1=dc2p;
   BaseClass *dc3p1=dc3p;

   //second set results
   p.processObj(bcp1);
   p.processObj(dc1p1);
   p.processObj(dc2p1);
   p.processObj(dc3p1);

   return 0;
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-09T21:53:41.950

您错过了双重调度的“双重”部分。

这种模式的重点是确保调用处理器的正确方法——接受正确类型的方法。由于处理器最初不知道传递给它的对象的类型，因此您需要*对象*告诉处理器它的类型是什么。

本质上，每个对象都需要一个虚`processMe(Processor &p)`方法，处理器调用它。`processMe`调用的执行`p.processObject(this)`。但这一次，“this”有一个已知类型！因此，您最终得到的不是无限递归，而是`proceessObject`被称为

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-09T21:48:58.340

[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)就是为处理这种情况而设计的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-09T21:46:06.113

您必须在 BaseClass 上放置一个虚拟方法才能从派生类调用 processObj。

```
class BaseClass{
public:
       BaseClass(){}
       virtual void ProcessThis(Processor &p) { p.processObj(this); }
       virtual void myFunction(){cout << "base myFunction called" << endl;}
};

class Derived1: public BaseClass{
public:
       Derived1():BaseClass(){}
       void ProcessThis(Processor &p) { p.processObj(this); }
       void myFunction(){cout << "Derived1 myFunction called" << endl;}
};

class Derived2: public BaseClass{
public:
       Derived2():BaseClass(){}
       void ProcessThis(Processor &p) { p.processObj(this); }
       void myFunction(){cout << "Derived2 myFunction called" << endl;}
};

class Derived3: public BaseClass{
public:
       Derived3():BaseClass(){}
       void ProcessThis(Processor &p) { p.processObj(this); }
       void myFunction(){cout << "Derived3 myFunction called" << endl;}

};

class Processor{
public:
       Processor(){}
       virtual void processObj(BaseClass* bc){cout << "got a base object" << endl; bc->myFunction();}
       virtual void processObj(Derived1* d1){cout << "got a derived1 object" << endl; d1->myFunction();}
       virtual void processObj(Derived2* d2){cout << "got a derived2 object" << endl; d2->myFunction(); }
};

int main() {
   BaseClass *bcp=new BaseClass();
   Derived1 *dc1p=new Derived1();   
   Derived2 *dc2p=new Derived2();
   Derived3 *dc3p=new Derived3();

   Processor p;//can also use Processor* p = new Processor()

   //first set results
   bcp->ProcessThis(p);
   dc1p->ProcessThis(p);
   dc1p->ProcessThis(p);
   dc3p->ProcessThis(p);

   BaseClass *bcp1=bcp;
   BaseClass *dc1p1=dc1p;   
   BaseClass *dc2p1=dc2p;
   BaseClass *dc3p1=dc3p;

   //second set results
   bcp1->ProcessThis(p);
   dc1p1->ProcessThis(p);
   dc2p1->ProcessThis(p);
   dc3p1->ProcessThis(p);

   Processor p2;
   bcp1->ProcessThis(p2);
   dc1p1->ProcessThis(p2);
   dc2p1->ProcessThis(p2);
   dc3p1->ProcessThis(p2);

   return 0;
} 
```

您基本上想要访问者模式，但只有一种类型的访问者。您可能会为自己节省一些未来的努力，并将 Processor 变成一个抽象类并实现一个具体的 ProcessorImpl 类，从而使将来添加另一个处理器类变得微不足道，或者您可以等到这种情况出现并暂时保持原样.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T22:25:09.327

太感谢了。这解决了我的问题，我明白双重调度意味着什么！这是后代的完整代码（有人请教我如何正确格式化）：

```
#include <iostream>
using namespace std;

class BaseClass;
class Derived1;
class Derived2;
class Derived3;

class Processor {
public:
       Processor(){}
       virtual void processObj(BaseClass* bc);
       virtual void processObj(Derived1* d1);
       virtual void processObj(Derived2* d2);
};

class BaseClass{
public:
       BaseClass(){}
       virtual void ProcessThis(Processor &p) { p.processObj(this); }
       virtual void myFunction(){cout << "base myFunction called" << endl;}
};

class Derived1: public BaseClass{
public:
       Derived1():BaseClass(){}
       void ProcessThis(Processor &p) { p.processObj(this); }
       void myFunction(){cout << "Derived1 myFunction called" << endl;}
};

class Derived2: public BaseClass{
public:
       Derived2():BaseClass(){}
       void ProcessThis(Processor &p) { p.processObj(this); }
       void myFunction(){cout << "Derived2 myFunction called" << endl;}
};

class Derived3: public BaseClass{
public:
       Derived3():BaseClass(){}
       void ProcessThis(Processor &p) { p.processObj(this); }
       void myFunction(){cout << "Derived3 myFunction called" << endl;}

};

void Processor::processObj(BaseClass* bc){cout << "got a base object" << endl; bc->myFunction();}
void Processor::processObj(Derived1* d1){cout << "got a derived1 object" << endl; d1->myFunction();}
void Processor::processObj(Derived2* d2){cout << "got a derived2 object" << endl; d2->myFunction(); }

int main() {
   BaseClass *bcp=new BaseClass();
   Derived1 *dc1p=new Derived1();   
   Derived2 *dc2p=new Derived2();
   Derived3 *dc3p=new Derived3();

   Processor p;//can also use Processor* p = new Processor()

   //first set results

   bcp->ProcessThis(p);
   dc1p->ProcessThis(p);
   dc2p->ProcessThis(p);
   dc3p->ProcessThis(p);

   BaseClass *bcp1=bcp;
   BaseClass *dc1p1=dc1p;   
   BaseClass *dc2p1=dc2p;
   BaseClass *dc3p1=dc3p;

   //second set results

   bcp1->ProcessThis(p);
   dc1p1->ProcessThis(p);
   dc2p1->ProcessThis(p);
   dc3p1->ProcessThis(p);

   Processor p2;
   bcp1->ProcessThis(p2);
   dc1p1->ProcessThis(p2);
   dc2p1->ProcessThis(p2);
   dc3p1->ProcessThis(p2);

   return 0;
} 
```

# c# - 从 .Net 中的 Excel 导入时的科学记数法

> ID：429853
> 
> 赞同：9
> 
> 时间：2009-01-09T21:40:24.440
> 
> 标签：c#, .net, excel, oledb

我有一个从 Excel 导入数据然后处理它的 C#/.Net 作业。我们的客户放下文件，我们处理它们。我对原始文件没有任何控制权。

我使用 OleDb 库来填充数据集。该文件包含一些数字，如 30829300、30071500 等……这些列的数据类型是“文本”。

当我导入数据时，这些数字会转换为科学计数法。有没有办法防止这种情况发生？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-10-12T21:35:40.863

此问题的一种解决方法是更改​​您的 select 语句，而不是 SELECT * 这样做：

```
"SELECT Format([F1], 'General Number')  From [Sheet1$]"
 -or-
"SELECT Format([F1], \"#####\")  From [Sheet1$]" 
```

但是，如果您的单元格包含超过 255 个字符并出现以下错误，这样做会崩溃：“多步 OLE DB 操作生成错误。检查每个 OLE DB 状态值（如果可用）。没有完成任何工作。”

幸运的是，我的客户并不关心在这种情况下出错。

这个页面也有很多好东西可以尝试： [http ://www.dicks-blog.com/archives/2004/06/03/external-data-mixed-data-types/](http://www.dicks-blog.com/archives/2004/06/03/external-data-mixed-data-types/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T22:13:22.643

OleDb 库通常**会**在 Excel 电子表格中弄乱您的数据。这主要是因为它强制所有内容进入固定类型的列布局，从每列的前 8 个单元格中的值*猜测*每列的类型。如果它猜错了，你最终会将数字字符串转换为科学记数法。布莱赫！

为避免这种情况，您最好跳过 OleDb 并自己直接阅读工作表。您可以使用 Excel 的 COM 接口（也是 blech！）或第三方 .NET Excel 兼容阅读器来执行此操作。 [SpreadsheetGear](http://www.spreadsheetgear.com/)就是这样一个运行良好的库，并且具有与 Excel 的 COM 接口非常相似的接口。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-04-23T09:36:46.930

使用此连接字符串：

```
Provider=Microsoft.ACE.OLEDB.12.0; data source={0}; Extended Properties=\"Excel 12.0;HDR=NO;IMEX=1\" 
```

使用 Excel 2010，我注意到以下内容。如果在您运行 OLEDB SELECT 时 Excel 文件已打开，那么您将获得当前版本的单元格，而不是保存的文件值。此外，为长数字、十进制值和日期返回的字符串值如下所示：

```
5.0130370071e+012
4.08
36808 
```

如果文件未打开，则返回值为：

```
5013037007084
£4.08
Monday, October 09, 2000 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-27T15:12:15.830

如果您使用 Open XML SDK 2.0 Productivity Tool 查看实际的 .XSLX 文件（或简单地解压缩文件并在记事本中查看 XML），您将看到 Excel 2007 实际上以科学格式存储原始数据。

例如 0.00001 存储为 1.0000000000000001E-5

```
<x:c r="C18" s="11" xmlns:x="http://schemas.openxmlformats.org/spreadsheetml/2006/main">
  <x:v>1.0000000000000001E-5</x:v>
</x:c> 
```

查看 Excel 中的单元格，其在单元格和编辑栏中均显示为 0.00001。因此，OleDB 导致问题并不总是正确的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T21:42:15.107

我发现最简单的方法是为具有大“数字”的列选择 Zip 格式，而不是文本格式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T21:47:40.823

您是否尝试在阅读时将该字段的值转换为 (int) 或 (Int64)？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T04:23:22.590

在 google 上查找 IMEX=1 连接字符串选项和 TypeGuessRows 注册表设置。事实上，没有简单的方法来解决这个问题，因为读者通过查看前几行（默认为 8 行）来推断列数据类型。如果行包含所有数字，那么你就不走运了。

我过去使用的一个不幸的解决方法是使用 HDR=NO 连接字符串选项并将 TypeGuessRows 注册表设置值设置为 1，这会强制它读取第一行作为有效数据来确定其数据类型，而不是一个标题。这是一个黑客，但它的工作原理。代码将第一行（包含标题）读取为文本，然后相应地设置数据类型。

更改注册表是一件痛苦的事情（并不总是可能），但我建议之后恢复原始值。

如果您的导入数据没有标题行，那么另一种选择是预处理文件并在违规列中的每个数字之前插入一个 ' 字符。这会导致列数据被视为文本。

所以总而言之，有很多黑客可以解决这个问题，但没有什么是万无一失的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-09T16:06:58.187

我遇到了同样的问题，但无需借助 Excel COM 接口或第 3 方软件即可解决此问题。它涉及一些处理开销，但似乎对我有用。

1.  首先读入数据得到列名
2.  然后使用这些列中的每一个创建一个新的 DataSet，将它们的每个 DataTypes 设置为字符串。
3.  再次将数据读入这个新数据集中。瞧——科学记数法现在消失了，一切都以字符串的形式读入。

这是一些说明这一点的代码，作为额外的奖励，它甚至是 StyleCopped！

```
public void ImportSpreadsheet(string path)
{
    string extendedProperties = "Excel 12.0;HDR=YES;IMEX=1";
    string connectionString = string.Format(
        CultureInfo.CurrentCulture,
        "Provider=Microsoft.ACE.OLEDB.12.0;Data Source={0};Extended Properties=\"{1}\"",
        path,
        extendedProperties);

    using (OleDbConnection connection = new OleDbConnection(connectionString))
    {
        using (OleDbCommand command = connection.CreateCommand())
        {
            command.CommandText = "SELECT * FROM [Worksheet1$]";
            connection.Open();

            using (OleDbDataAdapter adapter = new OleDbDataAdapter(command))
            using (DataSet columnDataSet = new DataSet())
            using (DataSet dataSet = new DataSet())
            {
                columnDataSet.Locale = CultureInfo.CurrentCulture;
                adapter.Fill(columnDataSet);

                if (columnDataSet.Tables.Count == 1)
                {
                    var worksheet = columnDataSet.Tables[0];

                    // Now that we have a valid worksheet read in, with column names, we can create a
                    // new DataSet with a table that has preset columns that are all of type string.
                    // This fixes a problem where the OLEDB provider is trying to guess the data types
                    // of the cells and strange data appears, such as scientific notation on some cells.
                    dataSet.Tables.Add("WorksheetData");
                    DataTable tempTable = dataSet.Tables[0];

                    foreach (DataColumn column in worksheet.Columns)
                    {
                        tempTable.Columns.Add(column.ColumnName, typeof(string));
                    }

                    adapter.Fill(dataSet, "WorksheetData");

                    if (dataSet.Tables.Count == 1)
                    {
                        worksheet = dataSet.Tables[0];

                        foreach (var row in worksheet.Rows)
                        {
                            // TODO: Consume some data.
                        }
                    }
                }
            }
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-07-24T04:41:39.467

我从其他地方得到了一个解决方案，但它对我来说非常有效。无需更改任何代码，只需将 excel 列单元格格式设置为“常规”而不是“数字”或“文本”等任何其他格式，然后甚至 Select * from [$Sheet1] 或 Select Column_name from [$Sheet1] 将读取即使是超过 9 位的大数值，它也很完美

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-03-08T13:54:41.517

我在这个州周围搜索了一下。这是我的解决步骤

*   对于模板excel文件

1 格式 Excel 列作为文本 2 编写宏以禁用数字 -> 文本转换的错误警告

```
 Private Sub Workbook_BeforeClose(Cancel As Boolean)
Application.ErrorCheckingOptions.BackgroundChecking = Ture
End Sub
Private Sub Workbook_Open()
Application.ErrorCheckingOptions.BackgroundChecking = False
End Sub 
```

*   关于代码隐藏

3-在读取要导入的数据时，尝试将传入的数据解析为 Int64 或 Int32 ....

# c# - C# 文件/目录权限

> ID：429864
> 
> 赞同：16
> 
> 时间：2009-01-09T21:45:17.927
> 
> 标签：c#

我正在编写一个应用程序来管理用户对文件的访问。一个很长的故事的简短版本是我必须使用目录和文件权限才能做到这一点。我们廉价的 CEO 没有文件管理系统...

无论如何...除了用户可以查看目录中的哪些文件但实际上看不到文件内容的情况外，我一切正常。（文件中可能包含敏感的 HR 数据。）

我尝试了 FileSystemRights.ListDirectory，但这似乎（尽管 MS 文档）也将 ReadData 设置为 true。我关闭了 ReadData（读取文件的能力），我突然无法再次访问该目录。两者似乎是联系在一起的。

关于设置哪些权限来实现这一目标的任何想法？

我目前的代码是：

```
SetSecurity(pth, usr, FileSystemRights.ListDirectory, AccessControlType.Allow);

...

public void SetSecurity(string dirName, string account,
    FileSystemRights rights, AccessControlType controlType)
{
    // Get a FileSecurity object that represents the
    // current security settings.
    DirectorySecurity dSecurity = Directory.GetAccessControl(dirName);

    dSecurity.AddAccessRule(new FileSystemAccessRule(account, rights, controlType));

    // Set the new access settings.
    Directory.SetAccessControl(dirName, dSecurity);
} 
```

谢谢。

- 杰瑞

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-09T21:58:11.660

FileSystemRights 枚举将 ReadData 和 ListDirectory 都映射到值 1，因此就 .NET 而言，两者是 100% 等效的。

您是否尝试过 Traverse 而不是 ListDirectory？

编辑：根据[这篇](http://support.microsoft.com/kb/308419)知识库文章，Windows XP 似乎也认为它们是相同的，只有一个仅适用于文件，一个仅适用于目录。

编辑 2：只要您将 ReadData/ListDirectory 访问规则设置为不被子对象继承，您应该能够将其应用于目录而不将其应用于目录中的文件。FileSystemAccessRule 类确实支持更改继承标志。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T22:04:00.977

这些文件可能从父级继承安全属性。

在调用 Directory.SetAccessControl(); 之前，您可以尝试调用[DirectorySecurity.SetAccessRuleProtection(true, false)](http://msdn.microsoft.com/en-us/library/system.security.accesscontrol.objectsecurity.setaccessruleprotection.aspx)以防止文件继承。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T22:04:17.590

是的。Traverse（我认为它命名错误）允许我在文件夹中执行程序，但不能查看文件夹的内容。老实说，不确定为什么这很有用。

我正要告诉 CEO，这是不可能的，然后眼睁睁地看着火花再次飞扬。:P

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-01T05:55:41.597

这是在实例化 FileSystemAccessRule 时未设置的继承和传播值。

# c# - 域实体属性名称

> ID：429865
> 
> 赞同：1
> 
> 时间：2009-01-09T21:45:19.937
> 
> 标签：c#, class, dns

对于域实体，属性名称是否应该以实体名称开头？IE 我的班级 Warehouse 有一个属性 WarehouseNumber。该属性应该命名为 WarehouseNumber 还是简称为 Number？

想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T21:46:38.517

我不喜欢使用前缀，我发现它更容易输入，而且更易读，实体的上下文几乎总是显而易见的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T21:53:06.973

想想你所代表的概念、它们出现的上下文以及它们的相对频率。

在这种情况下，数据是`Warehouse`和`Number`。在 a 的上下文中`Warehouse`，`Number`是适当限定的。在 a 之外`Warehouse`，`WarehouseNumber`将是适当限定的，即`Order.WarehouseNumber`。

`Warehouse.WarehouseNumber`，那么，将是多余的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T22:37:13.703

我永远不会在代码中为它们添加前缀。您应该始终使用有意义的变量、属性和方法名称，从而使前缀变得多余。

```
var currentWarehouse = warehouseService.Find(id);

var number = currentWarehouse.Number; 
```

或者

```
var number = order.Warehouse.Number; 
```

在将它们存储在数据库中时，我对此事的决定较少。有话要说：

```
select   *
from     dbo.Warehouse
where    WarehouseId in (
             select   WarehouseId
             from     ...
         ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-10T00:07:18.183

这是那些对象关系阻抗不匹配mofos之一。在 OO 中，肯定实体名称的前缀似乎不合适。然而，在 RDMBS 中，实体前缀唯一地标识了一个属性，并鼓励避免这种情况：

选择邮政编码--OMG！！！我来自哪张桌子！C.PostCode 或 S.PostCode??!??!

来自客户 C

INNER JOIN 供应商 S ON C.PrefferredSupplierID = S.SupplierID

我的建议是任意选择一个约定并大致坚持下去。毕竟这是一个节省时间的惯例！可能没关系.. :)

# vb.net - WinForms ReportViewer：初始渲染缓慢

> ID：429877
> 
> 赞同：6
> 
> 时间：2009-01-09T21:49:05.857
> 
> 标签：vb.net, reporting-services, reportviewer, performance

**更新 2.4.2010** 是的，这是一个老问题，但我想我会提供更新。所以，我再次使用 ReportViewer，它在初始加载时仍然呈现缓慢。唯一的区别是 SQL 数据库位于报告服务器上。

* * *

**更新 3.16.2009**

我已经完成了分析，并不是 SQL 导致 ReportViewer 在第一次调用时呈现缓慢。在第一次调用时，ReportViewer 控件锁定 UI 线程并使程序无响应。大约 5 秒后，ReportViewer 将解锁 UI 线程并显示“正在生成报告”，然后最终显示报告。我知道 5 秒并不多，但这不应该发生。我的同事在他的程序中做同样的事情，并且 ReportViewer 会根据任何请求立即显示“正在生成报告”。

唯一的区别是报告服务器在一台服务器上，而数据在另一台服务器上。但是，当我在 SSRS 中开发报告时，没有任何延迟。

* * *

**更新**

我注意到只有第一次加载 ReportViewer 需要很长时间；相同或不同报告的每个后续加载都加载得很快。

* * *

我有一个在**远程处理模式下使用的****WinForms** ReportViewer，当调用 ReportViewer.RefreshReport() 方法时，它最多可能需要 30 秒才能呈现。但是，报告本身运行得很快。

 **这是设置我的 ReportViewer 的代码：

```
rvReport.ProcessingMode = ProcessingMode.Remote
rvReport.ShowParameterPrompts = False
rvReport.ServerReport.ReportServerUrl = New Uri(_reportServerURL)
rvReport.ServerReport.ReportPath = _reportPath 
```

这是 ReportViewer 最多可能需要 30 秒才能呈现的地方：

```
rvReport.RefreshReport() 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-29T19:11:21.007

我在其他论坛上找到了答案。 [MSDN](http://social.msdn.microsoft.com/Forums/en/vscrystalreports/thread/f70cad38-dea9-4c4b-a812-9b2f2a7b4c08)解释说，一个 DLL 正在搜索一些 Verisign Web 服务器并且它需要永远......有两种方法可以关闭它，一种是 Internet Explorer 中的复选框，另一种是在应用程序的 app.config 文件中添加一些行.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T00:46:25.100

总结已经提出的各种想法，可以是

*   客户端上报表查看器基础结构的启动时间
*   客户端缓存加载时间
*   服务器上的查询执行时间
*   报告服务器的渲染时间

尝试运行报告，关闭客户端，重新启动客户端并再次运行报告。如果第二次报告速度快得多，请重复此实验，但在报告运行之间加载、运行和卸载另一个大型应用程序。

如果第二个报告的运行速度继续快得多，那么您看到的差异更多地与 SQL Server 的 I/O 缓存有关，而不是客户端上发生的情况。您可以通过运行一个从报表中未使用的表中提取大量数据的查询来故意替换 MSSQL 缓存，从而进一步测试这一点。

以上所有内容都很有趣，但并不重要。如果您想确保快速的报告响应，Reporting Services 为计划生成报告提供了广泛的支持，这样当消费者请求报告时，唯一的延迟就是网络传递。

如果您的用户坚持报告最新（实时）数据，他们将不得不指定更严格的约束参数或习惯等待。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-10T03:57:51.887

您可以在本地和服务器两种模式下提取报告。如果您在本地模式下运行，它将把数据和报告定义都拉到您的机器上，然后将它们都渲染。在服务器模式下，它将让 SSRS 完成所有工作，然后拉回信息进行渲染。

如果您使用的是本地模式，则可能是硬件问题。如果您有一个庞大的数据集，那么需要将*大量*数据存储在内存中。

除此之外，这不是很多信息可以继续......

更新：由于您注意到这只是第一次调用需要一段时间，您是否进行了任何分析以确定大部分工作是在后端 SQL 调用上完成还是花费在实际的报告呈现中？

如果后续调用速度更快，则您可能（顺便）在一个或另一个级别缓存。您可以缓存报告（[http://www.sqlservercurry.com/2007/12/configure-report-to-be-cached-ssrs-2005.html](http://www.sqlservercurry.com/2007/12/configure-report-to-be-cached-ssrs-2005.html)）或者可能是正在缓存返回数据的执行计划深入 SQL Server。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-16T12:10:51.750

ReportServer 总是需要一段时间才能唤醒，因为它在 IIS 下运行。每个 AppPool 都有一个进程超时。我们的 ASP.NET 应用程序的报表查看器也有同样的问题。您可以尝试在 IIS 设置中增加 AppPool 保持活动时间。

看这里：

*   [http://www.sqlreportingservices.net/Ask/5536.aspx](http://www.sqlreportingservices.net/Ask/5536.aspx)
*   [http://www.developmentnow.com/g/115_2005_9_0_0_597422/First-run-of-reports-is-SLOW.htm](http://www.developmentnow.com/g/115_2005_9_0_0_597422/First-run-of-reports-is-SLOW.htm)

我假设您当然正在运行 SQL2005 SSRS。

一种选择是升级到 SSRS 不再依赖 IIS 的 2008。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-17T18:49:08.787

开箱即用的思考方式：报表服务器是否与运行应用程序的机器不同？网络可能需要很长时间才能解析“reportServerURL”。一旦解析，名称将被缓存，因此后续调用会更快..

我之前遇到过配置错误的 DNS 服务器的问题。尝试将“reportServerUrl”替换为“reportServerIPAddress”并查看对 ReportViewer 的初始调用是否更快。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-04-16T20:46:14.103

我遇到了同样的问题。

我发现更改默认打印机（此处网络速度慢）可以解决问题。

ReportViewer 从默认打印机获取一些信息，由于这里的网络非常慢，我有 10 秒的延迟

希望能帮助到你

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T12:07:10.520

好像您要直接跟踪 SSRS 报告。您可能想要改为使用 SSRS Web 服务。这可能会提高你的表现。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-14T15:34:17.500

**更新**

我注意到只有第一次加载 ReportViewer 需要很长时间；相同或不同报告的每个后续加载都加载得很快。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-11T11:26:14.460

您已设置为在服务器上运行，这意味着 SRS 服务器需要在第一次进行渲染时会因以下一个或所有原因而延迟（这些是最慢的，还有其他的，但它们是更快）：

*   DNS解析：需要将URL解析为IP地址。完成此操作后，它会在本地缓存，从而加快速度。
*   ASP.NET/IIS 需要时间来预热。必须进行各种编译和初始加载 - 加载后它将保留在服务器内存中，直到您重新启动 IIS 或发生默认清理时间。
*   Reporting Services 需要时间来预热，就像 ASP.NET/IIS 一样。

要对此进行测试，请使用网络监视器，例如[Netmon](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/iisbook/c05_netstat_and_netmon.mspx)（如果您是 Microsoft 粉丝）或[Wireshark](http://www.wireshark.org/)（我的建议），并观察从您的计算机到服务器的流量。您将看到 DNS 请求，然后是 HTTP 请求，延迟将出现在返回的数据中。在第二次调用时，您会看到返回和 DNS 检查的速度大不相同。

为了防止这种情况，您可以做一个预热脚本 - 我不知道 SRS 有一个，但这里有一个指向 SharePoint 的[链接](http://blogs.msdn.com/joelo/archive/2006/08/13/697044.aspx)，因为它具有完全相同的问题，所以不难更改。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-03-04T12:42:08.870

据我所知，我认为这是微软很难解决的问题。

最初，报告加载器仅在报告的首次渲染时很慢，随后的报告加载正常（快一点）。

为了帮助解决这个问题，请放置一个带有标签 (Label1) 和计时器 (Timer1) 控件的启动窗体。设置 Label1.Text="请等待（大约 15 秒）"。设置 Timer1.Interval=3。在 Startup Form 的 form_Load 事件中，设置 Timer1.Start。在 Timer1 的 Tick 事件中放置“frmMyReportForm.reportViewer1.SetDisplayMode(Microsoft.Reporting.WinForms.DisplayMode.Normal)”

“frmMyReportForm” 项目中包含reportviewer 控件的任何表单。

所有的延迟都会在这里捕获，这样当您生成实际报告时，就不会出现延迟。

我希望这可能对我的开发人员有帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T14:59:10.823

这是您的问题的可能解决方案：在使用应用程序访问任何报告之前，尝试从 Web 访问第**一个报告。**

如果问题没有出现，您可以创建一个“预加载”第一个报告的应用程序，以允许报告服务启动。

我已经在 Microsoft 的一些演示应用程序中看到了这种解决方案。使用 Analysis Services 和 Reporting Services 的应用程序。

否则祝你好运

# database - 选择一种存储用户配置文件的方法？

> ID：429878
> 
> 赞同：7
> 
> 时间：2009-01-09T21:49:24.423
> 
> 标签：database, database-design, entity-attribute-value

我正在为网站开发用户配置文件系统，并且正在考虑采取什么更好（可扩展）的方法。我提出了两种解决方案，正在寻找输入或可能是我可能错过的东西的指针。

*下面的 create table 语句并不意味着可执行，而只是为了让您了解所涉及的表的布局。*

我最初的想法是这样的：

```
CREATE TABLE user(
    id INT UNSIGNED NOT NULL AUTO_INCREMENT,

    user_email VARCHAR(320),

    user_joined DATATIME,
    user_last_seen DATATIME,

    user_name_first VARCHAR,
    user_name_last VARCHAR,

    user_name_alias VARCHAR,

    user_location_country VARCHAR,
    user_location_region VARCHAR,
    user_location_city VARCHAR

    # ...
); 
```

显然，这根本不是非常可扩展的，并且添加额外的属性我很烦人。一个优点是我可以快速搜索匹配一组特定属性的用户。我做了一些环顾四周，这是一种非常常见的方法（例如 Wordpress）。

我的第二种方法（我目前正在使用的方法）更具可扩展性，但我有点担心性能：

```
CREATE TABLE user(
    id INT UNSIGNED NOT NULL AUTO_INCREMENT,

    user_email VARCHAR(320)
);

CREATE TABLE user_profile(
    user_id INT UNSIGNED NOT NULL,

    visibility ENUM('PRIVATE', 'PUBLIC'),

    name VARCHAR,
    value VARCHAR
); 
```

使用这种方法，每次使用都有一组与之关联的键值对，这使得添加其他属性以及在用户登录时加载用户配置文件变得微不足道。但是，我丢失了第一种方法中的所有类型信息（例如，DATETIME 现在存储为格式化字符串），因此一些搜索变得烦人。这确实让我可以更好地控制选择用户想要公开显示的属性。

混合方法会更好地让我平衡两种方法的优缺点吗？SO使用什么方法？还有另一种我没有想到或错过的方法吗？

**扩展：**使用混合方法将用户表中的属性插入到 user_profile 表中以控制它们对其他用户的可见性是否有利，或者这可能被视为额外开销？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T21:55:58.090

我会使用混合方法。一些基本属性，如用户名、电子邮件、lastlogindate 等应该添加到您的用户表中。次要的项目可以作为键/值对添加。

这样，您仍然可以轻松搜索最重要的信息并继续添加配置文件项，而无需更改架构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T22:45:16.587

混合解决方案不是一个好的解决方案。本质上，您将其他属性存储到属性包表中。从长远来看，这将使报告和查询变得复杂。此外，将日期、int、decimal、ntext 等存储为 varchar 不会成为可伸缩性的可接受的性能交换。如果需要，您将如何在该表之外创建关系？

更好的方法是为用户信息创建一个用户表。然后随着您的需求扩展，创建代表新功能的新类。这些新类可能会有相应的表。这样，当与用户关联的属性属于他们自己的空间时，您的“用户”类就不会呈指数增长。是的，将来您可能真的拥有属于用户表的新属性。那时您需要返回并调整您的模式和 DBAL，但这是易于理解的代码价格。

在您的示例中，您在第一个用户表中有用户的地址信息。我要做的一件事是我知道我不仅需要为用户存储地址。所以我将有一个单独的 Address 表，然后在 User 表中包含一个可为空的 AddressId。这样，当我有一个 Stores 表、一个 Events 表时，我也可以在其中包含 AddressId 关系。这种方法的一个副作用是，当我返回并向地址对象添加纬度/经度时，我的数据模型中的每个人也会获得这些新属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T22:16:16.303

出于性能和设计可扩展性的原因，我也会选择混合解决方案。

我倾向于认为表`users`（我也喜欢表名上的复数）需要分解成一组核心数据，这些数据通常由其他对象作用，以及规范中基本只写数据的扩展位，如“区域” , "middleinitial", "shoesize" 可以转移到一个可扩展且更新频率较低的区域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-10T00:05:20.687

为什么不使用 XML 字段来存储不必要的附加信息。

这可以在配置文件中进行配置，您甚至可以更进一步，从配置中生成 UI 控件。

# asp.net - 如何使用 IHTTPAsyncHandler？

> ID：429881
> 
> 赞同：1
> 
> 时间：2009-01-09T21:50:39.193
> 
> 标签：asp.net, ihttpasynchandler

想象一下，我有一些代码要从文件的开头到结尾读取，如下所示：

```
while(sw.readline != null)
{

} 
```

我希望这是完全异步的。当从 IHTTPAsyncHandler 派生时，这段代码会去哪里，获取每一行内容的代码会去哪里？

* * *

## 回答 #1

> 赞同：-2
> 
> 时间：2009-01-09T23:06:37.217

我最近在我的 ASP.NET 页面中添加了一些异步进程，以便在用户等待结果时允许一些长时间运行的进程发生。我发现 IHTTPAsyncHandler 很不合适。它所做的只是允许您在页面开始处理时启动一个新线程。您仍然必须创建自己的线程并创建 AsyncRequestResult。

相反，我最终只是在我的代码隐藏中使用了一个普通线程，更简洁：

```
using System;
using System.Web;
using System.Threading;

namespace Temp {
    public partial class thread : System.Web.UI.Page {
        protected void Page_Load(object sender, EventArgs e) {
            Thread thread = new Thread(new ThreadStart(myAsyncProcess));
            thread.Start();
        }

        private void myAsyncProcess() {
            // Long running process
        }
    }
} 
```

# c# - 为什么 with() 结构不包含在 C# 中，而它在 VB.NET 中真的很酷？

> ID：429890
> 
> 赞同：10
> 
> 时间：2009-01-09T21:54:19.437
> 
> 标签：c#, vb.net, with-statement

我是 C# 开发人员。我真的很喜欢花括号，因为我来自 C、C++ 和 Java 背景。但是，我也喜欢 .NET 系列的其他编程语言，例如 VB.NET。如果您已经在 .NET 中编程了一段时间，那么在 C# 和 VB.NET 之间来回切换并不是什么大问题。这在我工作的公司中是非常普遍的做法。作为 C# 人，我非常喜欢`with`VB.NET 编译器提供的 XML 文字和关键字。我希望微软也将这些功能包含在 C# 中。

我只是好奇，其他开发人员对此有何评论！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-09T21:59:03.263

就我个人而言，我不喜欢在构造之后使用 WITH ——如果在初始化后需要对对象执行几项操作，通常该行为应该封装在类型本身中。如果您真的想做 WITH 之类的事情，只需声明一个短变量并可选地引入一个新范围。

但是，能够紧凑地初始化具有多个属性的对象很有用——这正是 C# 3 允许您编写的原因*：*

```
MyObject x = new MyObject { Name="Fred", Age=20, Salary=15000 }; 
```

这有一些限制（C# 4 中的可选参数和命名参数将有助于克服这些限制），但它比没有导致潜在的混乱/歧义要好。

（在 XML 文字方面，我再次与 C# 团队合作 - XML 是一种非常具体的技术，可以放入语言中。如果他们能想出一个*通用*的形式，恰好可以创建 XML，但可以用来创建其他树这也很好——就像查询表达式不直接绑定到 IEnumerable 或 IQueryable 一样。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-09T22:17:16.737

`With`您可以通过创建一个快速的单字母变量名称来替换 VB.Net 。它实际上是更少的代码，因为`With`还需要`End With`稍后。

例如，我过去经常需要做的一件事是遍历数据表中的行以获取控制/中断样式报告。

在 vb.net 中，可能如下所示：

```
Dim CurCustomerName As String 
Dim CustomerSalesTotal As Decimal

Dim ds As DataSet = GetReportData()
With ds.Tables(0).Rows
   Dim i As Integer = 0
   While i < .Count
       ''//{
       CurCustomerName = .Item(i)("CustName")
       CustomerSalesTotal = 0
       PrintHeaderLine(CurCustomerName)

       While i < .Count AndAlso CurCustomerName = .Item(i)("CustName")
            ''//{
            PrintItemLine(.Item(i)("OrderTotal"))
            CustomerSalesTotal += .Item(i)("OrderTotal")

            i+= 1
       End While ''//}
       PrintSubTotalLine(CustomerSalesTotal)
   End While ''//}
End With 
```

C# 看起来像这样：

```
string CurCustomerName;
Decimal CustomerSalesTotal;

DataSet ds = GetReportData();
DataRowCollection r = ds.Tables[0].Rows;
int i=0;
while (i<r.Count)
{
    CurCustomerName = r[i]["CustName"];
    CustomerSalesTotal = 0;
    PrintHeaderLine(CurCustomerName);

    while (i<r.Count && CurCustomerName == r[i]["CustName"])
    {
        PrintItemLine(r[i]["OrderTotal"]);
        CustomerSalesTotal += r[i]["OrderTotal"];

        i++;
    }
    PrintSubTotalLine(CustomerSalesTotal);
} 
```

这里要注意的是，C# 版本实际上需要更少的输入，因为 VB 无法`WITH`与数组索引结合，并且必须通过`.Item`属性来处理某些事情。这没什么大不了的，但想象一下如果报告有 20 个字段而不是 2 个，并且必须打破 3 个项目而不是 1 个。

当然，您也可以使用 C# 中为 VB 演示的技术。但要注意的主要事情是，这`WITH`并没有真正给你太多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T22:24:56.457

这是关于开发人员的偏好，但我同意你的意见。我的偏好是尽量减少变量的数量，以及它们所处的范围。C# 的哲学似乎大同小异。但是在这种情况下，这里的响应似乎表明添加（并让自己负责）一个变量是一件好事，与对我来说与 lambda 非常相似的构造相比。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-10T00:53:57.233

我觉得在初始化期间只允许“质量”属性设置是相当随意的。我真的不明白为什么这会是“坏的”：

```
MyObj myObj = ObjFactoryFunction();

...

if(someCondition)
  myObj { Prop1 = 1, Prop2 = 2 }; 
```

我觉得这个示例代码干净简洁。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T07:47:45.353

`with`通常，当我看到对C# 功能的请求时，我会看到可以从重构中受益的代码。通常，当重构完成时，假设的需求`with`就消失了。

当我在对象中构建一个流畅的接口时，我喜欢我的代码的运行方式；它与`with`. 如果我在设计`MessageBox.Show()`，我可能会写：

```
new MessageBox()
    .SetText("Hello World!")
    .SetButtons(MessageBox.Buttons.OK)
    .SetIcon(MessageBox.Icon.Information)
    .Show(); 
```

您还可以看到与 Linq 类似的内容：

```
var q = Enumerable.Range(1, 100)
            .Where(x => x % 2 == 0)
            .Select(x => x * x); 
```

感觉有点像`with`，但似乎很自然地适合我已经拥有的语言。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T05:01:12.833

如果最终将“With”或类似功能与其他迄今为止流行的专有 VB 功能一起添加到 C# 中，我不会感到惊讶。最近在 PDC 和其他地方的 C# 4.0 预览演示文稿中有很多关于从 C# 4.0 和 VB 10 开始增加的“关注语言奇偶校验”的讨论。

# mysql - 绕过 MySQL 的 SET NAMES UTF8

> ID：429893
> 
> 赞同：2
> 
> 时间：2009-01-09T21:55:03.460
> 
> 标签：mysql

mysql手册说 SET NAMES 'x' 相当于

```
SET character_set_client = x; 
SET character_set_results=x; 
SET character_set_connection=x; 
```

根据我的 SERVER 变量配置文件，我将这三个变量都设置为 utf8。

但是，如果我真的执行 SHOW VARIABLES %character_set%，它会显示连接、客户端、结果和服务器的错误字符集。这意味着我必须对每个连接使用 SET NAMES 命令。

我显然做错了什么，可能是一些简单的事情，但这让我很难过。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-09T22:15:07.850

所以我找到了答案——出于某种原因，我不得不设置：skip-character-set-client-handshake

我不知道为什么，但它现在有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T22:16:58.220

也许您的 mysql 模块/连接默认为另一个字符集？

# datetime - 如何使用 TypeConverters 将 System.Datetime 转换为自定义类型

> ID：429897
> 
> 赞同：0
> 
> 时间：2009-01-09T21:55:58.200
> 
> 标签：datetime, typeconverter, complex-data-types

出于某种原因，我需要将 a`DateTime`转换/转换为许多自定义对象之一

事实证明，以一种很好的通用方式很难做到这一点。

我正在考虑在 object 上实现扩展方法或扩展`DateTimeConverter`.

但是，处理这个问题的通用方法是什么，我有一个对象和一个目标类型，目前我正在使用`System.ConvertTo(..)`，但这显然是有限的，因为它只支持转换为 .NET 类型并且不能扩展。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-10T11:25:58.003

您可以为您的 TimeStamp 添加一个构造函数，该构造函数将 DateTime 作为参数。

```
public class TimeStamp
{
   public TimeStamp(DateTime dateTime, ...)
   {
    // Your code here to convert from dateTime to TimeStamp
   }
} 
```

然后后来...

```
 DestType Convert<DestType>( Object linqResult )   
 {
  DestType result;
  if( linqResult is DateTime && DestType is TimeStamp )
  {
   DateTime dbTime = linqResult as DateTime;
   result = new TimeStamp( dbTime );
  }
  ...
  return result;
 } 
```

您甚至可以使用各种反射和构造函数等对其进行扩展。但是，如果您想将一个对象建立在另一个对象的基础上（例如日期时间的时间戳），则构造函数似乎很自然。

希望这有帮助，TJB

# user-interface - 从数据库设计到 UI 还是反过来？

> ID：429905
> 
> 赞同：8
> 
> 时间：2009-01-09T21:59:56.570
> 
> 标签：user-interface, database-design, architecture

在开始或计划一个新项目时，您是否总是倾向于考虑 db 架构，或者您是否走另一种方式开始设计 UI，然后向下移动？

还是你有不同的发展方式？

不是真正的敏捷/瀑布/规格/故事问题，只是一种了解人们在从事个人/专业或其他项目时倾向于哪种方式的方法。

我已经决定这两者都是过去最好的方法，并且目前处于 UI 第一阵营，但这可以而且将会改变！

干杯约翰

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-09T22:42:05.533

对于普通用户来说，UI***就是***软件。他们不关心数据的存储方式、您使用的平台等。因此，如果您的软件将被人们使用，我强烈建议您从 UI 开始——原型或模型。向用户展示并获得反馈。然后建立业务层和数据层。

我发现这有助于收集需求。非技术用户更有可能告诉您“哦，等等，我们需要此页面上的另一个字段”而不是“我们需要此表模式中的另一个属性”。他们也可能会说“我们这里需要另一个按钮”，这通常会转化为一些额外的业务逻辑等。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-09T22:15:04.590

我两者都做。我通常会画出屏幕外观的原型，然后尝试从中开发数据模型。我发现这不是直接进入数据库，而是与我的 UI 一样工作得更好，我可以看到对属性（或数据库中的字段）的需求，否则我不会想到。然后我从那里开发模型并来回反弹，直到两者都满足需求，然后我担心数据库模式。通常，尽管模型本身会为我定义架构，但已经处理好了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-09T22:07:34.697

这似乎是非常情境化的。在我所做的工作中，大部分工作都是从数据库开始的，因为我处理的数据库是企业资源——它们被多个 UI 使用。围绕可能经常变化的特定 UI 的变幻莫测设计数据库将是有害的。

另一方面，在某些情况下，将注意力集中在 UI 上可能会更有益，而让数据库设计稍后再进行 - 例如，可能在嵌入式 DB 移动应用程序中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-09T22:01:52.370

首先布置你的屏幕，这样你就知道你在数据库中需要什么。

如果您从数据库开始，那么您通常会从一组关于应用程序如何运行的假设开始。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-09T22:04:37.200

我倾向于从中间开始，弄清楚应用程序将做什么以及如何做，然后在 UI 和数据库设计之间来回切换，因为它们可以相互通知。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-09T22:08:38.237

通常，我先从数据库开始，然后构建适合它的 UI。通常会有一些来回，因为我可能需要更改数据库以适应 UI 的要求，反之亦然。

这条路线，首先从数据库开始，是我在学校的教学方式，并且一直困扰着我。

与我一起工作的一位程序员将从输出开始。他首先要弄清楚需要做什么（即需要发布哪些报告等），然后研究需要哪些数据才能到达那里。UI 和数据库是同时构建的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-09T22:08:59.907

在我从事的项目中，我发现 UI 是我的许多需求的来源——它是最终用户关心的部分（或者至少是考虑的部分）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-09T22:11:47.903

本质上，我首先要找出**功能**应该是什么。我不处理 UI 或它的外观或应该如何输入，我处理的是用户想要做什么。

然后我围绕它建立一个数据模型。有时它是一个非常简单的数据模型（特别是如果它是一个简单的需求，比如“播放电影”），有时它非常复杂。

只有在做出决定之后，我才会尝试设计一个既反映模型又反映用户期望输入如何工作的 UI。

随心所欲地接受它；它对我来说相当有效。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-09T22:20:57.760

最重要的是，首先要专注于确保系统能够解决它打算解决的问题。

收集需求以定义工作流程、数据、用户交互的复杂性等，然后从那里开始构建。

当然，你总是需要在这里和那里调整一些东西，但根据我的经验，我发现那些订阅一种或另一种哲学的人（即总是从 db 开始并建立与 ui 并向下潜水）很多次最终会结束使用不适合该问题的解决方案。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-09T22:25:34.613

首先对域进行建模 - 这将告诉您如何构建数据库。接下来找到您的需求——用户需要对应用程序做什么？这将告诉您需要存在哪些功能。有了这些，您就可以创建数据库模式和软件模型（无论是面向对象的，还是功能性的，或者其他什么，您都将获得必要的信息）。然后制作一个漂亮的 UI 来公开您构建的功能 - 当然，UI 构建*也*可以与功能同步完成，但两者都应该在确定域的外观之后进行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-09T22:29:39.007

我最近刚停止设计我的数据模型。我与一位开发人员一起工作，让我开始使用领域驱动设计。我现在坐下来先设计我的领域模型，然后再设计我的数据模型。同时，我考虑了 UI 可能带来的任何挑战。

# eclipse - Eclipse、ant 和自定义任务

> ID：429907
> 
> 赞同：17
> 
> 时间：2009-01-09T22:00:29.347
> 
> 标签：eclipse, ant, build-process

抱歉，我对 Ant 的经验并不丰富。

我喜欢 eclipse 的“Export ant buildfile”功能，但我需要插入一些自定义任务（复制文件、计算运行时使用的校验和等）。

如何将自定义 ant 任务与 Eclipse 导出的 antfile 集成？另外，一旦我这样做了，内部构建（运行...）会选择它，还是从现在开始我总是必须使用外部 ant 文件来构建？

哦，我不想编辑从 Eclipse 导出的 build.xml，因为我希望以后能够重新生成它。

**编辑/更新：**

我花了一段时间才弄清楚发生了什么——所以我想我应该在这里写一些笔记来澄清一下。

当您在目录中创建一个新的 ant 文件并放入`<?eclipse.ant.import ?>`自定义 ant 脚本的第一行（我称为我的 test.xml）时，下次您将构建文件从 Eclipse 导出到该目录时，它将看到该标记并添加`<import file="test.xml"/>`

通过该导入，“自定义”文件 (test.xml) 中的目标成为导出的 build.xml（或导出时选择的任何名称）中的有效目标。

在此之后，只要您在 Eclipse 中选择“build.xml”，目标窗格还将包括来自“test.xml”的目标

此外，在那之后，您可以进入您的项目属性/构建器并添加一个“Ant Build”类型的新构建器，然后选择用于构建、清理等的目标。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-09T22:33:58.123

ant 导出过滤器将包含同一目录中的任何 xml 文件，该文件具有特殊的

```
<?eclipse.ant.import?> 
```

元素作为它的第一个孩子。

**例子：**

```
<?xml version="1.0" encoding="UTF-8"?>
<?eclipse.ant.import?>
<project name="project" default="default" basedir=".">
    ...
</project> 
```

Eclipse 现在将在 中包含以下行`build.xml`：

```
<import file="custom_build.xml"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T22:06:29.770

如果您编写自己的 Ant 脚本，则可以编写自己的目标，使用[Ant 任务](http://ant.apache.org/manual/Tasks/ant.html)委托给生成的*build.xml*。

此外，您可以配置项目的“构建器”（项目属性 » 构建器）以在构建项目时手动或自动运行任何不同的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-30T17:23:59.183

PDE 支持从生成的 build.xml 到您自己的自定义 ant 脚本的自定义回调。

在 eclipse 安装中从 org.eclipse.pde.build 复制文件“templates/plugins/customBuildCallbacks.xml”，并在 build.properties 文件中设置“customBuildCallbacks=true”。

另请参阅[Eclipse 帮助页面](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.pde.doc.user/tasks/pde_custom_callbacks.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T22:22:07.897

您可以为这些任务使用单独的 ant 构建文件。这就是你所需要的。

# mysql - 如何使这个查询更容易编写

> ID：429912
> 
> 赞同：2
> 
> 时间：2009-01-09T22:03:24.830
> 
> 标签：mysql, optimization

我有一个查询，它从一个表中提取问题并从另一个表中提取答案。

```
SELECT 
  questions.question, 
  questions.answers, 
  (SELECT COUNT(answer) FROM answers WHERE question_id = 1 AND answer = 1 
          GROUP BY answer) as ans1, 
  (SELECT COUNT(answer) FROM answers WHERE question_id = 1 AND answer = 2 
          GROUP BY answer) as ans2 
FROM questions 
WHERE questions.id = 1 
```

虽然这可行，但我不喜欢为每个答案添加一个额外的子查询（`questions.answers`是一个逗号分隔的潜在答案字符串）。这是可行的，但我相信一定有更好的方法。最主要的是不同的问题有不同数量的答案。

有没有更好的方法来做到这一点，或者这是一种可以接受的做事方式？我想查询中的多个子选择将来可能会对性能产生（小）影响（不是我还在进行性能测试）。

如果适用，我预计每个问题的答案不会超过 5 个。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-09T22:11:14.050

```
SELECT q.question, q.answers,
  SUM(a.answer = 1) AS ans1,
  SUM(a.answer = 2) AS ans2
FROM questions q
 LEFT OUTER JOIN answers a ON (q.id = a.question_id)
WHERE q.id = 1
GROUP BY q.id; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T22:07:39.923

对我来说看起来很不错。您可以省略子查询中的“分组依据”子句，因为无论如何您只选择了一个“答案”值。

我怀疑如果您为每个答案保存一个可能答案的列表，您的架构可能会出现问题。这可能应该在一个单独的表中，每个答案由一行表示。分隔符分隔的字符串在数据库设计中是一种很大的代码味道，就像您期望相同的数据的重复一样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T22:14:03.950

也许？

```
SELECT 
    questions.question, 
    questions.answers, 
    (case when answers.answer = 1 then COUNT(answer) end ) as ans1, 
    (case when answers.answer = 2 then COUNT(answer) end ) as ans2 
    FROM questions left join answers on answers.question_id = questions.id
    WHERE questionss.id = 1
    group by questions.id 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-09T22:11:19.417

不能用吗？

```
SELECT 
  questions.question, 
  questions.answers, 
  COUNT(answer)

FROM questions inner join answers
on questions.id = answer.question_id
WHERE questions.id = 1
GROUP BY
questions.question, 
questions.answers 
```

你会得到行而不是列，但结果相似。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T22:16:39.797

将一个表中的多行链接到另一个表中的一个或多个行的标准方法是使用链接表。这样的表将在其每一行中存储一个表的 ID 和与第一个表相关的另一个表的 ID。

对于您的问题和答案，将问题的可能答案存储在链接表（我可能称之为`question_answered`）中可能如下所示：

`question_id | answer_id`

`1 1`

`1 2`

`2 3`

`4 4`

`4 5`

`4 6` `

如您所见，问题 1 有两个可能的答案，问题 2 有 1 个可能的答案，问题 3 没有答案，而问题 4 收到了 3 个不同的答案。

虽然我不确定“answer = 1”或“answer = 2”在您的上下文中是什么意思，但使用链接表计算问题的所有答案很容易，因为：

`SELECT question, count(answer_id) FROM questions AS q INNER JOIN question_answered AS qa ON qa.question_id = q.id) GROUP BY q.id`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T22:18:14.630

```
 SELECT    questions.question,
                       questions.answers,
                       A.answer,
                       COUNT(A.answer)
        FROM      questions Q
LEFT JOIN      answers A
            ON      Q.id = A.question_id
     WHERE      questions.id = 1
          AND      A.answer IN (1,2)
GROUP BY     A.answer 
```

# installation - MSDN 订阅 ISO 提取

> ID：429919
> 
> 赞同：4
> 
> 时间：2009-01-09T22:06:00.567
> 
> 标签：installation

从 MSDN Subscription 下载 ISO 后，您使用什么来提取 ISO 的内容？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-09T22:07:37.663

7-Zip

[http://www.7-zip.org/](http://www.7-zip.org/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-09T22:24:53.837

我通常将 ISO 挂载到虚拟 CD/DVD 驱动器。我在不同时间使用过以下免费软件包。据我所知，这些安装没有工具栏、间谍软件或其他垃圾。我目前通常使用 MagicISO - 几乎可以正常工作。

我不知道这些在 Vista 或 x64 上的情况如何（我仍然主要使用 32 位 WinXP）。

*   Microsoft 不受支持的虚拟 CD 工具：

    [http://download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe](http://download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe)

*   MagicISO 的 MagicDisk

    [http://www.magiciso.com/tutorials/miso-magicdisc-overview.htm](http://www.magiciso.com/tutorials/miso-magicdisc-overview.htm)

*   SlySoft 的虚拟 CloneDrive：

    [http://static.slysoft.com/SetupVirtualCloneDrive.exe](http://static.slysoft.com/SetupVirtualCloneDrive.exe)

当然，除了说我已经成功使用它们之外，我不能保证任何这些——你的里程可能会有所不同。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-09T22:12:08.043

要查看 ISO 中的内容，您可以：

*   将 ISO 映像挂载为驱动器
*   在 cd/dvd 上刻录 ISO
*   使用[WinRAR](http://www.rarlab.com/)查看/提取内容

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-09T23:32:34.900

DaemonTools 是一个很棒的免费虚拟驱动器，可以挂载 ISO 文件

[http://forum.daemon-tools.cc/download.php](http://forum.daemon-tools.cc/download.php)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-09T22:10:22.507

如果我想刻录 Alex Feinman 的（免费）[ISO 记录器。](http://isorecorder.alexfeinman.com/isorecorder.htm)[WinRAR](http://www.rarlab.com/)如果我只想打开它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-09T22:25:24.990

[http://www.imgburn.com/](http://www.imgburn.com/)是很棒的免费 ISO 刻录机，还可以验证刻录的光盘。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-09T22:07:20.050

在我做 DL 的所有时候，文件都是 ISO。

如果您的问题是如何处理它：（即您不知道 iso 文件是什么）

您将其刻录到 CD/DVD。那是磁盘映像。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-09T22:08:56.223

根据 ISO，我会将其刻录到光盘或将其安装到虚拟驱动器并从虚拟驱动器安装（如果 ISO 是操作系统，则不是真正的选项）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-12T05:06:27.673

如果您正在运行 Vista，（我发现）很多虚拟驱动器模拟器在 Vista 上无法运行，但对我来说在 Vista 上运行的一个是[Softpedia 的免费软件 Virtual CloneDrive。](http://www.softpedia.com/get/CD-DVD-Tools/Virtual-CD-DVD-Rom/Virtual-CloneDrive.shtml)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-21T17:55:30.337

我使用酒精 52% 的免费版本——它可以让您将 ISO 挂载为虚拟 CD 驱动器。这适用于 Windows 7、Vista、XP 和 2003 和 2008 版本的服务器。

如果您有兴趣，可以在这里下载 - [http://trial.alcohol-soft.com/en/](http://trial.alcohol-soft.com/en/)

# c# - 如何使用 Rhino Mocks 模拟索引属性？

> ID：429933
> 
> 赞同：14
> 
> 时间：2009-01-09T22:09:23.510
> 
> 标签：c#, .net, rhino-mocks

如何使用 Rhino Mocks 模拟索引属性？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-09T22:18:18.437

我假设您的意思是使用`this[]`

```
 var mockClass = MockRepository.GenerateMock<MockClass>();

  mockClass.Expect( m => m["key"] ).Return( "value" );  // return a value
  mockClass.Expect( m => m["key2"] = "value2" );  // set a value

  ... some test in here using something that depends on mockClass...

  mockClass.VerifyAllExpectations(); 
```

# asp.net - 单击时更改 asp:CheckBox 的文本

> ID：429937
> 
> 赞同：4
> 
> 时间：2009-01-09T22:11:17.420
> 
> 标签：asp.net, javascript, checkbox

如何在没有回发的情况下更改 CheckBox 的文本？

```
<asp:CheckBox ID="CheckBox1" runat="server" Text="Open" /> 
```

当在客户端上单击 CheckBox 时，我想将文本切换为“打开”或“关闭”。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-09T22:27:58.463

```
function changeCheckboxText(checkbox)
{
  if (checkbox.checked)
    checkbox.nextSibling.innerHTML = 'on text';
  else
    checkbox.nextSibling.innerHTML = 'off text';
} 
```

称为：

```
<asp:CheckBox runat="server" ID="chkTest" onclick="changeCheckboxText(this);" /> 
```

仅供参考，更改复选框标签的文本通常是不好的做法，因为它往往会使用户感到困惑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T22:26:54.567

如果您有兴趣使用像 jQuery 这样的框架 javascript，我提出了一个解决方案，如下所示：

```
$("input[id$=CheckBox1]").click(function() {
    if ($(this).attr("checked")) { 
        $(this).next("label:first").text("Open");
    }
    else {
        $(this).next("label:first").text("Close");
    }
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T22:20:13.190

3 个简单的选项

使用 JavaScript 更改文本客户端 - 通过在 .CS 类中注册事件，如下所示：

```
CheckBox1.Attributes.Add("JavaScipt") 
```

使用带有[JQuery的 HTML 复选框](http://jquery.com/)

或者放入一个[Ajax 更新面板](http://www.asp.net/ajax/)

[一些 AJax 入门视频](http://www.asp.net/learn/ajax-videos/)

# asp.net - 是否有任何可用于 ASP.NET 的基于事件的日历

> ID：429944
> 
> 赞同：0
> 
> 时间：2009-01-09T22:13:44.013
> 
> 标签：asp.net, events, calendar

嗨，我正在寻找一个活动日历，用户可以进入并添加他们的活动..然后其他人可以查看它...

我正在寻找的是这样的东西..

[http://www.torontoparentsguide.com/Events/tabid/92/Default.aspx](http://www.torontoparentsguide.com/Events/tabid/92/Default.aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T22:20:17.263

取决于您正在寻找什么样的功能。

如果您想要一个可以开发自己的后端的日历 API，[DayPilot是一个很好的解决方案。](http://www.daypilot.org/)

如果您只想要一个“独立”应用程序，那么[VCalendar](http://www.ultraapps.com/app_overview.php?app_id=19)是一个更好的解决方案。

两者都是开源的，但根据您的需要，使用其中一个会更容易。

# asp.net - ASP.net 异常默认页面中的“在 Visual Studio 中打开”链接

> ID：429957
> 
> 赞同：0
> 
> 时间：2009-01-09T22:19:57.467
> 
> 标签：asp.net, visual-studio, browser, macros, add-in

当我的 ASP.NET 应用程序崩溃时（当它显示默认异常页面时），我希望能够在浏览器中单击调用堆栈的一行，Visual Studio 将在给定行打开代码文件。

你认为有可能吗？也许使用宏/加载项？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-10T06:31:03.683

您可以使其链接到代码文件并将该代码文件扩展名 mime 类型设置为使用 Visual Studio 作为查看器。

也许。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T18:17:19.793

为什么不将 VisualStudio 附加到 IIS 并将其配置为在抛出异常时中断？

# .net - 有哪些很好的资源可用于将移动设备上的联系人数据与 .NET 应用程序同步？

> ID：429960
> 
> 赞同：0
> 
> 时间：2009-01-09T22:20:32.847
> 
> 标签：.net, contacts, sync, mobile-devices

基本上，我们希望能够以某种方式将我们的 .NET 应用程序的联系人与移动设备（Pocket PC、iPhone、Blackberry 等）上的联系人同步，最好是一次性交易，可以与所有设备交互，但这似乎不太可能。

我们最好不要为移动设备编写应用程序（或至少是非常简单的应用程序），但能够与这些设备的内置联系人功能同步，从设备发送到我们的应用程序，反之亦然。对于电子邮件，我们将我们的应用程序设置为 IMAP 服务器，而移动设备可以通过这种方式同步，这样的方式是理想的，但我怀疑这样的标准不存在。

是否有任何具有灵活 API 的商业库允许我们这样做？

按优先顺序排列的是 PocketPC、iPhone、Blackberry，但我们将不胜感激有关其中任何一个的信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T23:11:11.573

有 API 进出 .Net 和 gmail，也许您可​​以使用中央 Google 帐户作为管道：

[Google 帐户开发者指南：.NET - 联系人](http://code.google.com/apis/contacts/docs/2.0/developers_guide_dotnet.html)

然后有一些方法可以从 gMail 联系人转到 Goosync 等智能[手机](http://www.goosync.com/)。

编辑：另一种选择可能是使用[SyncMLDotNet](http://sourceforge.net/projects/syncmldotnet)为您的应用程序编写一个 syncML 驱动程序，并通过诸如[Funambol](http://en.wikipedia.org/wiki/Funambol)之类的免费服务器同步到设备。

# c# - 什么时候使用反射？模式/反模式

> ID：429962
> 
> 赞同：32
> 
> 时间：2009-01-09T22:21:18.367
> 
> 标签：c#, reflection

我了解反射 API（在 c# 中），但我不确定在什么情况下会使用它。有哪些模式 - 使用反射的反模式？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-01-09T22:30:34.107

在我正在开发的一个产品中，我们经常使用它，但反射是一种复杂而缓慢的野兽。不要仅仅因为它听起来有趣或有趣就去寻找使用它的地方。当您遇到无法以任何其他方式解决的问题时（动态加载插件或框架的程序集、程序集检查、构建时不知道类型的工厂等），您将使用它。当然值得看一下反射教程，看看它是如何工作的，但不要陷入“有一把锤子，一切看起来都像钉子”的陷阱。它有非常专业的用例。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-09T22:27:50.693

我在 C# 中使用反射的唯一地方是在工厂模式中，在那里我根据配置文件信息创建对象（在我的例子中，网络侦听器）。配置文件提供了程序集的位置、其中的类型名称以及所需的任何其他参数。工厂选择了这些东西并基于它创建了监听器。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-09T22:27:18.137

我不知道这是否是一种模式，但我使用反射从 DAO 的类定义中生成 SQL。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-10T01:02:09.557

我在很多地方都使用过反射。主要的大类包括：

1.  **自动生成的 GUI**（即属性编辑器）。您可以遍历对象的属性并使用 UI 元素工厂的注册表来构建表单。我使用属性上的属性来指导 UI 创建。
2.  **序列化**。我已经编写了使用反射来序列化和反序列化对象的序列化框架。
3.  **网络服务**。与序列化类似，我使用反射来创建和使用 SOAP 消息以及生成 WSDL。
4.  **领域特定语言**。解释性脚本语言通常会使用反射绑定到对象和方法。
5.  **调试工具**。此类工具可以使用反射来检查对象的状态。方便在故障条件下创建日志消息。

模式明智，我不确定模式是什么。所有用途之间的一个共同点是按名称引用和后期绑定——您希望在运行时绑定到一个成员。当您动态加载程序集并且不知道您需要创建/操作的对象类型时，通常会出现这种情况。

使用反射很强大，但它不会让你在聚会上更受欢迎。仅在耦合故意较弱的情况下使用它。太弱了，以至于您希望它在运行时中断。一个很好的例子是 WPF 中的数据绑定。

我不确定反模式，但肯定会与在运行时做的事情有关，而这些事情应该在编译时完成......

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-09T22:27:23.393

没有硬性规定。基本上，如果没有充分的理由，您不会使用反射。当没有反射你无法做你想做的事情时，或者当你的代码没有反射会变得更长或更难理解时，使用反射。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-09T22:49:38.153

我发现反射（结合运行时类加载）对于实现插件是必不可少的：

1.  在已知位置搜索罐子/程序集
2.  枚举支持您的插件支持的接口的类的 jars / 程序集
3.  在运行时实例化插件

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-09T22:25:32.790

我不打算放弃任何模式，但我建议在你真正需要它之前避免反射是个好主意。对于无法提前控制对象类型的互操作和可扩展性情况，它特别有用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-09T22:38:58.067

我在单元测试中大量使用反射，尤其是当我检查的是匿名类型时。我还将它用作轻松克隆/复制模型对象的一种方式。无需为每个模型对象编写代码，我可以使用反射轻松创建特定类型的对象，询问传入对象的公共属性并调用克隆对象相应属性的设置器。我还将它与设计器生成的类一起使用，这些类实现了相同的方法签名，但没有关联的接口。在这些情况下，我可以询问对象以查看它是否具有所需的方法，如果有则调用它。LINQ2SQL 实体就是这样，所以在我的假数据上下文包装器 OnSubmit 方法中，我使用反射来获取 OnValidate 方法并调用它进行单元测试。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-09T22:39:19.283

我在二进制序列化程序（[protobuf-net](http://code.google.com/p/protobuf-net/)）中使用它。我只使用反射来构建模型 - 当它被使用时（即在 [de] 序列化期间），它使用委托等来获得最佳性能。

[我还在HyperDescriptor](http://www.codeproject.com/KB/cs/HyperPropertyDescriptor.aspx)中使用它（连同 ComponentModel 和 Reflection.Emit）来构建加速的属性访问（大约是常规反射速度的 100 倍）。

[如果您正在构建自己的`Expression`s](http://marcgravell.blogspot.com/2008/10/express-yourself.html)，则需要使用反射。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-09T22:44:29.927

+1 关于工厂模式的使用——在那里非常强大。

除了工厂模式，我每次使用它时，我可能不应该......

我用它在启动时动态加载实现某些接口的类（我的是程序集中的菜单项），我真的很后悔这种用法。我希望我会从配置文件中加载（后来添加了一个显示可用接口加载的表单）。这很酷，但非常慢......

一种反模式是使用它访问类设计者标记为私有的属性，而不知道他们为什么将它们标记为私有。我已经使用 DataGridView WinForms 控件来取消设置布尔变量，这样我就可以在移动补码时移动“伴生”列。再一次，它非常酷，但是如果新版本更改了该私有属性（它很可能在 3.0 或 3.5 中消失......），该代码将严重失败。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-09T22:29:52.187

在不了解反射的目的的情况下，我进行了 2 年的开发。它有非常小众的用途，但当它是适合这项工作的工具时，它会非常强大。

我想我想说的是，只有在你确定这是实现你想要的唯一方法时才使用它。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-09T22:30:35.993

我在类似于 Harper Shelby 提到的情况下使用它，其中配置文件在运行时指定要实例化的对象。在我的特殊情况下，没有什么比工厂更精细——只有一组实现通用接口的类，以及一个读取配置文件并创建适当对象并返回接口的简单函数。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-10T01:21:25.307

我使用反射的主要地方：从数据库中提取类型。

我有一个类需要知道要调用哪个库。请记住，随着新工具被添加到列表中，该类需要在不重新编译的情况下识别新工具，因此 switch 语句是不可能的。

相反，我将反射字符串存储在告诉类“创建其中一个......”的数据库中，因为我（程序员）始终确保该类是从单个基类派生的，所以这个想法有效。它干净高效。

但我同意，如果您在这些“自动生成的代码”场景之外使用反射，那么在将来维护代码时，您可能会为自己打开一个受伤的世界。

（进入智者的声音，老圣人）
反射具有不可思议的力量……用智慧来使用力量。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-09T22:32:51.620

当我需要打破其他人（通常是框架）的封装时，我最常使用它。也就是说，我需要更改一些私有字段，或者调用私有方法，或者在我无权更改的库中创建某个内部类的实例。一个很好的例子是我对[这个问题](https://stackoverflow.com/questions/421516/how-to-write-c-service-that-i-can-also-run-as-a-winforms-program)[的回答](https://stackoverflow.com/questions/421516/how-to-write-c-service-that-i-can-also-run-as-a-winforms-program#421678)中的代码。在这种情况下，框架方法的行为是不可接受的，所以我使用反射以更可接受的方式做同样的事情。[`ServiceBase.Run`](http://msdn.microsoft.com/en-us/library/tks2stkt.aspx)

不过，反射还有许多其他用途，包括[鸭子类型](http://www.deftflux.net/blog/page/Duck-Typing-Project.aspx)、使用[属性](http://oreilly.com/catalog/progcsharp/chapter/ch18.html)和[后期绑定](http://www.codeproject.com/KB/cs/cscpplatebind.aspx)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-09T23:10:10.670

反射允许您解决原本需要您重复代码的问题。如果您发现自己在复制和粘贴代码，并且看不到 OO 模式如何提供帮助，也许如果您可以打电话给他们，那么“r 团队”可以提供帮助。

只是开个玩笑。多年来我无法理解反思的意义。如果您可以编写代码来执行一项工作，那为什么还需要使用反射呢？

假设您有很多 GUI 对象，例如表单或“表格”对象。它绑定到像客户这样的业务对象：

```
public class Customer
{
   public string FirstName;
   public string LastName;

} 
```

您的用户不希望看到列标题“FirstName”或“LastName”。他们想要“基督徒姓名”和姓氏。您不想在所有 GUI 对象中对文字字符串进行编码，以防他们改变主意为“名字”和“父亲的姓氏”（我知道，废话示例）。

如果您使用属性定义您的类：

```
public class Customer
{
   [Description("Christian Name")]
   public string FirstName;

   [Description("Surname")]
   public string LastName;

} 
```

您可以使用反射来提取列名。如果您需要更改**所有**GUI 对象描述客户对象的方式，您现在可以在一个地方完成。

我不知道有任何反模式。我的建议是加入并尝试一下。您将开始看到反射为您提供优雅解决方案的各种方式。绩效经常被引用为不使用反思的原因。relfection 会产生性能开销，但除非你能证明开销会损害你需要的算法，否则我会打折扣。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-03-15T05:05:21.480

当您想提高后期绑定对象的性能时。您可以发出直接调用绑定类型所需的代码，然后通过您发出的方法进行调用。尽管您无法像使用早期绑定那样快速执行调用，但您将比后期绑定执行得更好。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-11-20T17:09:46.630

我个人用的不多。当我没有不同的编码方式时，我倾向于使用它。

这是一个简单的例子：

```
public static void LogException(Exception exc, string source)
{
    try
    {
        // Logic for logging exceptions
    }
    catch(Exception ex)
    {
        //If logging fails  for some reason 
        //then we still log it using reflection
        LogException(ex, "Error while logging an exception");
    }
} 
```

# .net - “没有找到您要查的资源。” url 末尾有“点”时出错

> ID：429963
> 
> 赞同：53
> 
> 时间：2009-01-09T22:21:37.807
> 
> 标签：.net, asp.net-mvc, routing, routes

我正在使用 ASP .NET MVC Beta，当我使用这个结尾有一个“点”的 url 时，我得到了 HTTP 404（找不到资源）错误：

[http://localhost:81/Title/Edit/Code1](http://localhost:81/Title/Edit/Code1)。

如果我删除最后的点或点在中间的某个地方，我不会收到错误消息。

我试图调试，但我在 MvcHandler 中的 ProcessRequest 之前从“System.Web.CachedPathData.GetConfigPathData(String configPath)”得到错误。

网址末尾不允许“点”吗？或者有没有办法修复路由定义来处理这个url？

* * *

例如：我有一个名为 Detail1 [Id(integer), Code(string), Description(string)] 的表，它通过它的 Id 列与 Master1 具有 FK 关系。每当我选择 Master1 的记录时，我也会选择它的 Detail1 记录来获取它的 Code 字段。为了不每次都进行此连接（因为通常不仅有一个细节，还有多个），我选择不使用 Id 列并制作 Detail1 的代码 PK。

但是当我摆脱 Id 并使用 Code as PK 时，我的路线也开始使用 Code 字段，例如：Detail1\Edit\Code1

此代码可以包含任何内容或结尾，包括 DOT。在某些情况下，我可以在最后禁止 DOT，但有时它真的很有意义。

而且我也看过这篇[文章](http://weblogs.asp.net/scottgu/archive/2008/04/16/asp-net-mvc-source-refresh-preview.aspx)，路线可以非常灵活，所以我不认为我的很奇怪。

所以这就是为什么我做一些如此不标准的事情。有什么建议么？

还有为什么在 url 的末尾有一个 DOT 很奇怪？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2010-08-22T17:37:04.377

如果您使用的是 .NET 4.0，则可以在 web.config 的 system.web 部分设置此标志，并且允许：

```
<httpRuntime relaxedUrlToFileSystemMapping="true" /> 
```

我已经对其进行了测试，并且可以正常工作。[哈克](http://haacked.com/archive/2010/04/29/allowing-reserved-filenames-in-URLs.aspx)对此进行了解释。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-03-11T12:34:04.947

在 1.0 及更高版本的每个 ASP.NET 版本中，这可以通过多种方式解决。我知道这是创建此线程后的两年，但无论如何，它是这样的：

## 原因

创建自定义错误处理程序或在 IIS 中配置自定义页面以重定向 404 将不起作用。原因是 ASP.NET 认为这个 URL 很危险。在内部`System.Web.Util.FileUtil`，ASP.NET 调用私有方法`IsSuspiciousPhysicalPath`，该方法尝试将路径映射到（虚拟但合法）文件名。

当生成的合法路径不等于原始路径时，处理停止并且 ASP.NET 代码返回 404（它不向 IIS 或 web.config 询问自定义 404，它自己返回一个，这使得它如此很难对此做些什么）。

Windows 资源管理器的工作方式相同。尝试创建一个以一个或多个点结尾的文件名，即`test.txt.`. 您会发现生成的名称是`text.txt`.

## ASP.NET中以点结束URL的解决方案

解决方案很简单（一旦你知道，它总是如此）。就在它发出这个 404 之前，它会调用[`Application_PreSendRequestHeaders`](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.presendrequestheaders.aspx)一个简单的事件，您可以在其中注册`Global.asax.cs`（或 VB 等价物）。以下代码将向浏览器返回一个简单的文本，但重定向或任何其他有效响应也是可能的。

```
protected void Application_PreSendRequestHeaders(object sender, EventArgs e)
{

    HttpResponse response = this.Context.Response;
    HttpRequest request = this.Context.Request;
    if (request.RawUrl.EndsWith("."))
    {
        response.ClearContent();
        response.StatusCode = 200;
        response.StatusDescription = "OK";
        response.SuppressContent = false;
        response.ContentType = "text/plain";
        response.Write("You have dot at the end of the url, this is allowed, but not by ASP.NET, but I caught you!");
        response.End();
    }
} 
```

*注意：当“aspx”不是*URL 的一部分时，此代码也有效。即[http://example.com/app/somepath](http://example.com/app/somepath)。将调用该事件。另请注意，某些路径仍然不起作用（例如，以多个点、井号标签或 < 符号结尾，会导致 400- 错误请求）。再说一次，它确实适用于以引号、空格+斜线或由空格分隔的多个点结尾。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-11-15T12:18:27.793

好吧，在 .NET 4.5 中，我通过在 url 末尾添加“/”解决了这个问题。

因此，在您的情况下，它将是“http://localhost:81/Title/Edit/Code1./”。这是我唯一做的事情，我不必添加 httpRuntime 设置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-12-15T13:19:43.907

将此添加到处理程序

```
 <add name="ExtensionlessUrlHandler-Integrated-4.0-ForApi"
 path="api/*"
 verb="*"
 type="System.Web.Handlers.TransferRequestHandler"
 preCondition="integratedMode,runtimeVersionv4.0" />
</handlers> 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-10T15:48:46.007

也许`http://localhost:81/Title/Edit/Code1%2E`会奏效。

我用十六进制 ascii 代码逃脱了这个时期。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-01-10T17:04:14.920

为什么不能有一个以点结尾的 URI？

因为 URI 是一个资源请求，并且在所有相关操作系统上都存在一个[历史命令，点字符是](http://en.wikipedia.org/wiki/Filename_extension#Historical_limitations)[扩展分隔符](http://en.wikipedia.org/wiki/Filename)。最后一个点被视为表示文件扩展名，因此点终止没有意义。

还值得一读：

*   [RFC1738](http://www.ietf.org/rfc/rfc1738)
*   [RFC3986](http://www.ietf.org/rfc/rfc3986)

# excel - 在 Excel 中创建自定义查找函数时遇到问题。匹配和连接范围的问题

> ID：429964
> 
> 赞同：2
> 
> 时间：2009-01-09T22:21:57.040
> 
> 标签：excel, vba, function, range, concatenation

我在处理我的大型电子表格时遇到了一些问题。我将大量原始数据引入数据表，然后对数据进行多次查找。使用我想出的内置函数

```
=IF(ISNA(INDEX(Data!$L$7:$L$1100,MATCH(Data!$I$2&$B$199&$B29&Data!$J$5,Data!$K$7:$K$1100&Data!$J$7:$J$1100&Data!$I$7:$I$1100&Data!$N$7:$N$1100,0))),"0",INDEX(Data!$L$7:$L$1100,MATCH(Data!$I$2&$B$199&$B29&Data!$J$5,Data!$K$7:$K$1100&Data!$J$7:$J$1100&Data!$I$7:$I$1100&Data!$N$7:$N$1100,0))) 
```

不漂亮！基本上，它使用 4 个变量进行两次相同的查找，并将它们与 4 个连接数组进行匹配，然后使用该点作为我想要的值的索引。

我在每行 4 张纸和每张纸 96 行中有 8 个（略有不同）。编辑它们很痛苦！

由于本月数据集大幅增长，外部波段 (x1100) 已被超越（经验教训，大是不够的）。不幸的是，该功能的限制不允许我使用 L:L 或类似的任何有用的东西。

我尝试将代码重写为用户定义的函数，我可以在其中输入 4 个变量并获得答案，但是在组合数组时失败了。

我已经在原始函数名称中给出了上面列出的范围以使事情变得更容易（并将它们扩展为使用更广泛的范围值），因此我可以重写所有函数以仅使用命名范围，但这仍然让我陷入困境如果我需要更改代码。

这是我到目前为止所拥有的：

```
 Function Windows_Util(itma As String, env As String)

v = "Windows Server" & env & itma & ""
r = Concat(Range("Utilchassis"))
r = r & Concat(Range("Utilenv"))
r = r & Concat(Range("UtilITMA"))
r = r & Concat(Range("UtilOS"))

m = WorksheetFunction.Match(v, r, 0)

i = WorksheetFunction.Index(Range("Utilavg"), m)

If WorksheetFunction.IsNA(i) Then
    Windows_Util = 0
Else
    Windows_Util = i
End If

End Function

Function Concat(myRange As Range, Optional myDelimiter As String)

Dim r As Range

Application.Volatile

For Each r In myRange
   If Len(r.Text) Then
       Concat = Concat & IIf(Concat <> "", myDelimiter, "") & r.Text
   End If
Next

End Function 
```

这不行！它不仅连接不正确（每个范围单独连接，而不是逐行组合），而且它不喜欢其中一个查询中的某种类型。（调试这些东西并不容易，因为函数实际上完成了（它没有任何语法错误），所以我没有可以使用的内置步骤。

非常感谢任何帮助。

希望我已经提供了足够的细节来理解我正在尝试做的事情。

干杯，

史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-11T02:22:21.330

我不确定您希望如何连接 Ranges，但我认为您应该看看[Application.Union(Range, Range, ...) method](http://msdn.microsoft.com/en-us/library/bb178176.aspx)。

在文章的示例中：

```
Set bigRange = Application.Union(Range("Range1"), Range("Range2")) 
```

另请参阅[Tushar Mehta 撰写的 Daily Dose of Excel 中的文章](http://www.dailydoseofexcel.com/archives/2007/08/17/two-new-range-functions-union-and-subtract/)，他在其中描述了以下自定义 Union(Range, Range) 方法，该方法可以更好地处理“Nothing”（空）输入：

```
Function Union(Rng1 As Range, Rng2 As Range) As Range
    If Rng1 Is Nothing Then
        Set Union = Rng2
    ElseIf Rng2 Is Nothing Then
        Set Union = Rng1
    Else
        Set Union = Application.Union(Rng1, Rng2)
    End If
End Function 
```

相反，如果您要使用范围地址的字符串连接，那么您必须添加逗号，正如 Barrowc 在他的帖子中所展示的那样。例如`Range("MyRange1, MyRange2")`，将合并名为“MyRange1”和“MyRange2”的两个范围，而没有逗号的空格分隔符，例如`Range("MyRange1 MyRange2")`将返回这两个范围的 INTERSECTION（重叠）。

但是，我建议避免串联字符串地址并改用该`Application.Union(Range, Range)`方法。

希望这可以帮助...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-10T04:30:55.547

怎么样：

```
r = Range("Utilchassis,Utilenv,UtilITMA,UtilOS") 
```

这似乎与您的 Concat 功能相同

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-19T06:27:20.040

当有多个要匹配的标准时，在 VBA 中使用 MATCH 函数可能会很棘手。在工作表中所做的事情——将不同单元格连接的条件与相同数量的连接范围匹配，在这两种情况下都使用 & 运算符——在 VBA 中是无法实现的，因为 VBA“&”运算符只将字符串作为参数，并且因为在 VBA 中连接范围的其他方式、Union 函数和通过 Range 的多个地址参数进行的赋值，似乎不会产生一个可以与 VBA Match 函数一起使用的数组。

但是，可以通过构造一个结合 MATCH 和数组比较的工作表公式，然后使用 VBA Evaluate 函数执行该公式来实现相同的效果。有关此方法如何工作的详细信息，请参阅我对 [这个 SO 问题的回答。](https://stackoverflow.com/questions/14406340/excel-vba-type-mismatch-in-range-concatenation-for-multiple-range-match-attempt/14410770#14410770)

以下代码实质上重新实现了 Steve 提供的原始工作表公式，而不依赖于工作表中先前命名的范围或代码中指定的标准值（与工作表中的特定单元格相反）。它被编写为一个子函数，但可以很容易地转换为用户定义的函数。

```
 Sub x4match()

    Dim adr1 As String, adr2 As String, adr3 As String, adr4 As String
    Dim Rng1 As Range, Rng2 As Range, Rng3 As Range, Rng4 As Range
    Dim name1 As String, name2 As String, name3 As String, name4 As String
    Dim idx As Variant
    Dim resultRng As Range
    Dim result As Variant

    With ThisWorkbook.Worksheets("Data")

       adr1 = "I2"
       adr2 = "B199"
       adr3 = "B29"
       adr4 = "J5"

       Set Rng1 = .Range("K7:K1100")
       Set Rng2 = .Range("J7:J1100")
       Set Rng3 = .Range("I7:I1100")
       Set Rng4 = .Range("N7:N1100")
       Set resultRng = .Range("L7:L1100")

       .Names.Add Name:="name1", RefersTo:=Rng1
       .Names.Add Name:="name2", RefersTo:=Rng2
       .Names.Add Name:="name3", RefersTo:=Rng3
       .Names.Add Name:="name4", RefersTo:=Rng4

       idx = Evaluate("IFERROR( MATCH(1, --(" & adr1 & "=name1) * --(" & _
                     adr2 & "=name2) * --(" & adr3 & "=name3) * --(" & _ 
                     adr4 & "=name4), 0), 0)")

       If idx <> 0 Then
          result = .Cells(resultRng.Row + idx - 1, resultRng.Column).Value
       End If

      .Names("name1").Delete
      .Names("name2").Delete
      .Names("name3").Delete
      .Names("name4").Delete

    End With

  End Sub 
```

# hosting - 哪个发行版最适合托管 LAMP + memcache？（答案获得 Linode 或 Slicehost 推荐）

> ID：429968
> 
> 赞同：5
> 
> 时间：2009-01-09T22:24:08.737
> 
> 标签：hosting, lamp, slicehost, distro

尽管我的 Linux 经验很少，但我还是被 VPS 所吸引（而且对 cPanel/共享主机的废话感到厌烦）不去尝试。

我是个聪明的孩子，很快就学会了。我在 Linux 上上了一堂课，知道了基本命令、如何通过管道传输命令、一些脚本和 shell 的东西——所有这些我都快忘记了……但我已经准备好再次学习了。由于我将使用 Linode 或 Slicehost，因此我有机会搞砸了很多。

那么，哪个发行版最适合我？我在这里寻找易用性和管理性，特别是在安装 LAMP + memcache 并在今天结束之前启动并运行它方面。

Linode 还是 Slicehost？两者有什么本质上的区别吗？Linode 似乎更便宜。

最后，为了不让我选择的任何主机的推荐字段为空，请提供您的信息，获胜的答案将获得推荐:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-09T22:32:18.640

使用 Linode 几个月了，设置虚拟“盒子”只用了不到一个小时，从那以后我们就没有碰过它，所以从我（作为开发人员）的角度来看，它得到了两个大拇指。

使用 Ubuntu 并且自初始设置以来没有遇到任何问题。

没有使用过 Slicehost，但坦率地说，在 Linode 设置简单之后，不需要切换/尝试其他任何东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T22:43:34.920

我在以前的工作中使用了 Slicehost 几个月，从未遇到任何问题。你基本上可以用你的切片做任何你想做的事情，这非常漂亮。对于快速修复，您可以使用他们的基于 Web 的终端和管理员控制台在任何地方进行远程管理。对 Linode 了解得不够多，无法说出一个是否比另一个更好，但听起来你已经用你的短名单将小麦与谷壳分开了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T22:42:51.023

这取决于对您来说最重要的是什么——安全、更新、支持、社区。

不同的发行版有不同的定位——例如，我们使用非常稳定和安全的 Centos——但这是有代价的，因为它通常落后于最新的技术和更新（因为这些需要时间来成熟:)）。

查看[此页面](http://distrowatch.com/dwres.php?resource=major)，了解每个发行版的优缺点概述。

# c# - 来自 Visual Studio 的 Gac 多个项目

> ID：429979
> 
> 赞同：1
> 
> 时间：2009-01-09T22:27:06.733
> 
> 标签：c#, gac, com+, visual-studio-addins

我们目前在 Visual Studio 中将“gacutil /i $(TargetPath)”作为外部工具，它适用于 gac'n 单个项目。

我希望能够选择多个项目并对它们进行 gac，因此我将一个批处理脚本放在一起进行测试。

```
set randomfile=%random%

echo %1 %2 %3 > %randomfile%

gacutil.exe /f /il %randomfile% 
```

当我从命令行对其进行测试时，它看起来应该可以工作。然后，当我将它连接为“MultiGac.bat $(TargetPath)”并选择多个项目并尝试它不起作用时。

有没有人编写过任何工具来完成，例如使用插件或外部工具进行品尝？也使用 regsvcs 怎么样？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-07T02:27:34.920

必须编写一个插件来扫描所有项目，并对其进行注册。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-07T02:40:00.113

批处理文件中的环境变量应使用双 % 作为前缀：

```
对于 (*.dll) 中的 %%i 执行 gacutil.exe /f /il %%i

```

# compression - 压缩格式对档案内的随机访问有很好的支持？

> ID：429987
> 
> 赞同：68
> 
> 时间：2009-01-09T22:29:44.513
> 
> 标签：compression, gzip, archive, zlib, random-access

这类似于上一个[问题](https://stackoverflow.com/questions/236414/)，但那里的答案不能满足我的需求，我的问题略有不同：

我目前对一些包含排序数据的非常大的文件使用 gzip 压缩。当文件未压缩时，二进制搜索是一种方便且有效的方式来支持在已排序数据中查找某个位置。

但是当文件被压缩时，事情就变得棘手了。我最近发现了[zlib](http://www.zlib.net/)的`Z_FULL_FLUSH`选项，它可以在压缩期间用于在压缩输出中插入“同步点”（`inflateSync()`然后可以开始从文件中的各个点读取）。没关系，尽管我已经拥有的文件必须重新压缩才能添加此功能（奇怪`gzip`的是没有此选项，但如果必须，我愿意编写自己的压缩程序）。

从[一个来源](https://web.archive.org/web/20090530165348/http://newsgroups.derkeiler.com/Archive/Comp/comp.compression/2006-02/msg00327.html)看来，这甚至`Z_FULL_FLUSH`不是一个完美的解决方案......不仅不是所有 gzip 档案都支持它，而且检测档案中的同步点的想法可能会产生误报（与同步的幻数巧合）点，或者由于`Z_SYNC_FLUSH`也产生同步点但它们不能用于随机访问）。

有更好的解决方案吗？如果可能，我想避免使用用于索引的辅助文件，并且对准随机访问的显式默认支持会有所帮助（即使它是大粒度的——比如能够以每 10 MB 的间隔开始读取）。是否有另一种压缩格式比 gzip 更支持随机读取？

**编辑**：正如我所提到的，我希望在压缩数据中进行二进制搜索。我不需要寻找特定的（未压缩的）位置——只需要在压缩文件中寻找一些粗粒度的位置。我只想支持“将数据从大约 50%（25%、12.5% 等）开始解压缩到此压缩文件中”之类的支持。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-10-24T19:48:35.027

看看**dictzip**。它与 gzip 兼容并允许粗略的随机访问。

其手册页的摘录：

> **dictzip**使用**gzip** (1) 算法 (LZ77) 以与 gzip 文件格式完全兼容的方式压缩文件。gzip 文件格式的扩展（额外字段，在 RFC 1952 的 2.3.1.1 中描述）允许将额外数据存储在压缩文件的标题中。gzip 和 zcat 等程序将忽略这些额外数据。但是，[dictzcat --start] 将利用这些数据对文件执行伪随机访问。

我在 Ubuntu 中有包 dictzip。或者它的源代码在[dictd-*.tar.gz](http://sourceforge.net/projects/dict/)中。它的许可证是 GPL。你可以自由学习。

### 更新：

我改进了 dictzip，使其没有文件大小限制。 [我的实现](https://github.com/fidlej/idzip)在 MIT 许可下。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-09T23:19:55.317

我不知道任何支持随机访问未压缩数据中特定位置的压缩文件格式（好吧，多媒体格式除外），但您可以自己酿造。

例如，bzip2 压缩文件由大小 <1MB 的未压缩的独立压缩块组成，这些压缩块由魔术字节序列分隔，因此您可以解析 bzip2 文件，获取块边界，然后解压缩正确的块。这需要一些索引来记住块从哪里开始。

尽管如此，我认为最好的解决方案是将您的文件拆分为您选择的块，然后使用一些存档器（如 zip 或 rar）对其进行压缩，这些存档器支持对存档中的单个文件的随机访问。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-05-03T11:53:47.397

.xz[文件格式](http://tukaani.org/xz/format.html)（使用 LZMA 压缩）似乎支持这一点：

> **随机访问读取**：可以将数据拆分为独立压缩的块。每个 .xz 文件都包含一个块索引，当块大小足够小时，这使得有限的随机访问读取成为可能。

这应该足以满足您的目的。一个缺点是 liblzma 的 API（用于与这些容器交互）似乎没有很好的文档记录，因此可能需要一些努力来弄清楚如何随机访问块。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-12-17T01:42:32.667

存在提供对 gzip 和 bzip2 档案的随机访问的解决方案：

*   **gzip** [zran.c 来自 zlib 源代码](https://github.com/madler/zlib/blob/master/examples/zran.c)
*   **bzip2** [Node.JS 版本的 seek-bzip](https://github.com/cscott/seek-bzip)（James Taylor 的原始 C 版本似乎已经从互联网上消失了......）

（[我正在寻找 7zip 的东西](https://github.com/madler/zlib/blob/master/examples/zran.c)）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-02-04T13:11:23.670

`bgzip`可以以可索引的变体压缩文件`gzip`（并且可以通过 解压缩`gzip`）。`tabix`这与索引器一起用于一些生物信息学应用程序。

请参阅此处的说明： http: [//blastedbio.blogspot.fr/2011/11/bgzf-blocked-bigger-better-gzip.html](http://blastedbio.blogspot.fr/2011/11/bgzf-blocked-bigger-better-gzip.html)和此处：[http](http://www.htslib.org/doc/tabix.html) ://www.htslib.org/doc/tabix.html 。

我不知道它在多大程度上适用于其他应用程序。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-07-24T21:10:31.430

如果之前已经创建了索引，则可以随机访问 gzip 格式，如[zlib 的*zran.c*源代码](https://github.com/madler/zlib/blob/master/examples/zran.c)所示。

我在 zlib 的*zran.c*上开发了一个命令行工具，它为 gzip 文件创建索引：[https ://github.com/circulosmeos/gztool](https://github.com/circulosmeos/gztool)

**它甚至可以为仍在增长的 gzip 文件**（例如由 rsyslog 直接以 gzip 格式创建的日志）创建索引，从而在实践中将创建索引的时间减少到零。请参阅`-S`（*监督*）选项。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-09T22:41:07.283

我不确定这在您的确切情况下是否实用，但是您不能将每个大文件压缩成较小的文件，例如每个 10 MB 吗？您最终会得到一堆文件：file0.gz、file1.gz、file2.gz 等。基于原始大文件中的给定偏移量，您可以在名为`"file" + (offset / 10485760) + ".gz"`. 未压缩存档中的偏移量为`offset % 10485760`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-08-07T20:52:23.410

因为无损压缩在某些区域比其他区域效果更好，如果您将压缩数据存储到方便长度 BLOCKSIZE 的块中，即使每个块具有完全相同数量的压缩字节，某些压缩块将扩展为比其他块更长的明文.

*您可能会在 2000 年 11 月的计算机*杂志 [http://doi.ieeecomputersociety.org/10.1109](http://doi.ieeecomputersociety.org/10.1109/2.881693)中查看 Nivio Ziviani、Edleno Silva de Moura、Gonzalo Navarro 和 Ricardo Baeza-Yates 的“压缩：下一代文本检索系统的关键” [/2.881693](http://doi.ieeecomputersociety.org/10.1109/2.881693)

他们的解压器将 1、2 或 3 个完整字节的压缩数据解压缩（使用词汇表）成一个完整的单词。可以直接在压缩文本中搜索单词或短语，这比搜索未压缩文本还要快。

他们的解压器让你可以用一个普通的（字节）指针指向文本中的任何单词，并从那个点立即开始解压。

您可以给每个单词一个唯一的 2 字节代码，因为您的文本中可能有少于 65,000 个唯一单词。（KJV 圣经中有近 13,000 个独特的单词）。即使有超过 65,000 个单词，将前 256 个两字节代码“单词”分配给所有可能的字节也非常简单，因此您可以拼出不在 65,000 左右“最常见的词库”中的单词单词和短语”。（通过将常用单词和短语打包成两个字节所获得的压缩通常值得偶尔使用每个字母两个字节来拼写单词的“扩展”）。有多种方法可以选择能够提供足够压缩的“常用词和短语”词典。例如，您可以调整 LZW 压缩器以转储“短语” 它不止一次地使用一个词典文件，每个短语一行，并在所有数据上运行它。或者，您可以任意将未压缩的数据拆分为词典文件中的 5 字节短语，每个短语一行。或者您可以将未压缩的数据拆分为实际的英文单词，然后将每个单词（包括单词开头的空格）放入词典文件中。然后使用“sort --unique”来消除该词典文件中的重复单词。（选择完美的“最佳”词典词表是否仍然被认为是 NP 难的？）并将每个单词（包括单词开头的空格）放入词典文件中。然后使用“sort --unique”来消除该词典文件中的重复单词。（选择完美的“最佳”词典词表是否仍然被认为是 NP 难的？）并将每个单词（包括单词开头的空格）放入词典文件中。然后使用“sort --unique”来消除该词典文件中的重复单词。（选择完美的“最佳”词典词表是否仍然被认为是 NP 难的？）

将词典存储在巨大压缩文件的开头，将其填充到某个方便的 BLOCKSIZE，然后存储压缩文本——一系列两字节“单词”——从那里到文件末尾。大概搜索者会读一遍这个词典，并在解压缩过程中将它以某种快速解码的格式保存在 RAM 中，以加快将“两字节代码”解压缩为“可变长度短语”的速度。我的初稿会从每个短语列表一个简单的一行开始，但您稍后可能会切换到使用某种增量编码或 zlib 以更压缩的形式存储词典。

您可以在压缩文本中选择任何随机偶数字节偏移量，然后从那里开始解压缩。我认为不可能制作更细粒度的随机访问压缩文件格式。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-02-10T16:52:46.720

两种可能的解决方案：

1.  让操作系统处理压缩，创建和挂载包含所有文本文件的压缩文件系统（SquashFS、clicfs、cloop、cramfs、e2compr 或其他），并且不要在应用程序中对压缩做任何事情。

2.  直接在每个文本文件上使用 clicfs（每个文本文件一个 clicfs），而不是压缩文件系统映像。将“mkclicfs mytextfile mycompressedfile”视为“gzip <mytextfile >mycompressedfile”和“clicfs mycompressedfile directory”作为通过文件“directory/mytextfile”随机访问数据的一种方式。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-04-08T03:14:55.180

我不知道它是否被提及，但[Kiwix 项目](https://en.wikipedia.org/wiki/Kiwix)在这方面做得很好。[通过他们的程序 Kiwix，他们提供对ZIM 文件档案](https://en.wikipedia.org/wiki/ZIM_(file_format))的随机访问。压缩效果也不错。该项目源于对 Wikipedia 离线副本的需求（未压缩形式已达到 100 GB 以上，包括所有媒体）。他们成功地获取了一个 25 GB 的文件（没有大多数媒体的 Wikipedia 的单文件实施例）并将其压缩为一个区区 8 GB 的 zim 文件存档。通过 Kiwix 程序，您可以调用 Wikipedia 的任何页面以及所有相关数据，其速度比上网还快。

尽管 Kiwix 程序是一种基于 Wikipedia 数据库结构的技术，但它证明了您可以同时拥有出色的压缩率和随机访问。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-09-04T07:26:19.120

这是一个非常古老的问题，但看起来[zindex](https://github.com/mattgodbolt/zindex)可以提供一个很好的解决方案（虽然我没有太多经验）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-23T15:07:36.277

razip 支持具有比 gzip/bzip2 更好的性能的随机访问，而 gzip/bzip2 必须针对这种支持进行调整 - 以“正常”随机访问为代价来减少压缩：

[http://sourceforge.net/projects/razip/](http://sourceforge.net/projects/razip/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-10-26T21:02:04.010

我是用于压缩特定类型生物数据的开源工具的作者。这个工具，称为`starch`，按染色体分割数据，并使用这些分割作为索引，以便快速访问较大档案中的压缩数据单元。

对每条染色体数据进行转换以消除基因组坐标中的冗余，并使用`bzip2`或`gzip`算法压缩转换后的数据。偏移量、元数据和压缩基因组数据被连接到一个文件中。

源代码可从我们的[GitHub](https://github.com/bedops/bedops)站点获得。我们已经在 Linux 和 Mac OS X 下编译了它。

对于您的情况，您可以将（10 MB 或其他）偏移量存储在自定义存档格式的标头中。您解析标头，检索偏移量，并通过+递增地`fseek`通过文件。`current_offset_sum``header_size`

# c++ - C 和 C++ 如何在堆栈上存储大对象？

> ID：429995
> 
> 赞同：22
> 
> 时间：2009-01-09T22:33:48.170
> 
> 标签：c++, c, memory, stack

我试图弄清楚 C 和 C++ 如何在堆栈上存储大对象。通常，堆栈是一个整数的大小，所以我不明白更大的对象是如何存储在那里的。他们只是占用多个堆栈“插槽”吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-01-10T01:18:21.753

* * *

## 栈和堆并没有你想象的那么不同！

* * *

诚然，某些操作系统确实有堆栈限制。（其中一些也有令人讨厌的堆限制！）

但这不再是 1985 年了。

这些天，我运行 Linux！

我的默认*堆栈大小*限制为 10 MB。我的默认*堆大小*是无限的。无限制堆栈大小非常简单。(*cough* [tcsh] *unlimit stacksize* *cough*. or *setrlimit()* .)

*栈*和*堆*最大的区别是：

1.  *堆栈*分配只是偏移一个指针（如果堆栈变得足够大，可能会分配新的内存页面）。 *堆*必须搜索其数据结构以找到合适的内存块。（并且可能也分配新的内存页。）
2.  *当前块结束时堆栈*超出范围。 *调用 delete/free 时，堆*超出范围。
3.  *堆*可能会碎片化。 *堆栈*永远不会碎片化。

在Linux下，*栈*和*堆*都是通过虚拟内存来管理的。

就分配时间而言，即使在严重碎片化的内存中进行堆搜索也无法在新的内存页面中进行映射。 **时间上的差异可以忽略不计！**

根据您的操作系统，通常只有在您实际使用它们映射的那些新内存页面时。（**不是**在*malloc()*分配期间！）（这是一个*懒惰的评估*事情。）

（*new*将调用构造函数，它可能会使用那些内存页面......）

* * *

您可以通过在*堆栈*或*堆上*创建和销毁大型对象来破坏 VM 系统。系统是否可以/是否可以回收内存取决于您的操作系统/编译器。如果它没有被回收，堆可能能够重用它。（假设它没有被另一个*malloc()*重新利用。）同样，如果堆栈没有被回收，它只会被重用。

虽然换出的页面需要换回，这将是你最大的时间打击。

* * *

在所有这些事情中，**我最担心内存碎片**！

寿命（当它超出范围时）始终是决定因素。

但是当您长时间运行程序时，碎片会逐渐增加内存占用。不断的交换最终杀死了我！

* * *

* * *

* * *

## 修改为：

* * *

## 伙计，我被宠坏了！

只是这里没有加起来……我想要么*我*太离谱了。或者其他人都是。或者，更有可能的是，两者兼而有之。或者，只是也许，两者都不是。

不管答案是什么，我必须知道发生了什么事！

...这会很长。忍受我...

* * *

在过去的 12 年中，我大部分时间都在 Linux 下工作。大约 10 年前，在各种风格的 Unix 下。我对计算机的看法有些偏颇。我被宠坏了！

我在 Windows 上做了一些工作，但还不够权威。可悲的是，Mac OS/Darwin 也没有……尽管 Mac OS/Darwin/BSD 已经足够接近，以至于我的一些知识得以延续。

* * *

使用 32 位指针，地址空间不足 4 GB (2^32)。

实际上，*STACK* + *HEAP*的组合[通常限制在 2-4 GB 之间，因为其他东西需要在那里映射。](http://www.cdf.utoronto.ca/~csc369h/summer/lectures/week11-linuxvm.pdf)

（有共享内存、共享库、内存映射文件、您运行的可执行映像总是很好等）

* * *

在 Linux/Unix/MacOS/Darwin/BSD 下，您可以在运行时人为地将*HEAP*或*STACK*限制为您想要的任意值。但最终有一个硬系统限制。

这是*"limit"*与*"limit -h"*的区别（在 tcsh 中） 。或者（在 bash 中）*"ulimit -Sa"* vs *"ulimit -Ha"*。或者，以编程方式，*struct rlimit*中的*rlim_cur*与*rlim_max*。

 ** * *

现在我们进入有趣的部分。关于***Martin York 的代码***。（谢谢马丁*！*很好的例子。尝试一下总是好的！。）

*马丁*大概在 Mac 上运行。（最近的一个。他的编译器版本比我的更新！）

当然，他的代码默认不会在他的 Mac 上运行。但是如果他首先调用*“unlimit stacksize”*（tcsh）或*“ulimit -Ss unlimited”*（bash），它会运行得很好。

* * *

## 事件的核心：

* * *

在一个古老的（过时的）Linux RH9 2.4.x 内核盒上进行测试，分配大量的*STACK*   **或**   *HEAP*，其中一个本身的上限在 2 到 3 GB 之间。（可悲的是，机器的 RAM+SWAP 的最高值略低于 3.5 GB。它是一个 32 位操作系统。这**不是**唯一运行的进程。我们用我们拥有的东西来凑合……）

***所以在Linux下，堆栈*大小和*堆*大小真的没有限制，除了人工的......**

* * *

## 但：

* * *

在 Mac 上，堆栈大小的硬性限制为**65532 KB**。它与事物在内存中的布局方式有关。

* * *

[通常，您将理想化的系统视为在内存地址空间的一端具有*堆栈，在另一端具有**堆*，并且它们相互构建。当他们相遇时，你已经失去了记忆。](http://www.cdf.utoronto.ca/~csc369h/summer/lectures/week11-linuxvm.pdf)

Mac 似乎将其*共享系统库*以固定的偏移量固定在两者之间。您仍然可以使用“无限堆栈大小”运行***Martin York 的代码***，因为他只分配了 8 MiB (< 64 MiB) 的数据。 **但是他会在他用完*HEAP之前用完**STACK*。**

 ***我在Linux上。我不会。** [对不起孩子。这是镍。去给自己一个更好的操作系统。](https://stackoverflow.com/questions/84556/whats-your-favorite-programmer-cartoon#88675)

[Mac 有一些解决方法。但是它们变得丑陋和混乱，并涉及调整内核或链接器参数。](http://homepage.mac.com/eric.c/hpc/contents/documentation/How%20to%20increase%20the%20stack%20size%20on%20Mac%20OS%20X.pdf)

从长远来看，除非 Apple 做一些真正愚蠢的事情，否则 64 位地址空间将在某个时候让整个堆栈限制变得过时。

* * *

## 继续碎片化：

* * *

每当您将某些东西推到*堆栈*上时，   它都会附加到末尾。只要当前块退出，它就会被删除（回滚）。

结果，*堆栈*中没有孔。这都是一大块已用内存。最后可能只有一点未使用的空间，都可以重复使用。

相反，当*HEAP*被分配和释放时，你最终会出现未使用的内存漏洞。随着时间的推移，这些会逐渐导致内存占用增加。不是我们通常所说的核心泄漏，但结果是相似的。

内存碎片**不是**避免*HEAP*存储的理由。这只是在编码时需要注意的事情。

* * *

## 这带来了**SWAP THRASHING**：

* * *

*   如果您已经分配/使用了大量堆。
*   如果你有很多零散的洞。
*   如果你有大量的小分配。

然后，您可以得到大量变量，所有变量都在代码的一个小的局部区域内使用，这些变量分散在大量的虚拟内存页面中。（就像你在这个 2k 页面上使用 4 个字节，在那个 2k 页面上使用 8 个字节，等等很多页面......）

所有这些都意味着您的程序需要交换大量页面才能运行。或者它会不断地交换页面。（我们称之为颠簸。）

另一方面，如果在*STACK*上进行了这些小分配，它们都将位于连续的内存段中。需要加载的 VM 内存页面更少。（4+8+... < 2k 获胜。）

> *旁注：我提请注意这一点的原因源于我认识的一位电气工程师，他坚持将所有阵列都分配在 HEAP 上。我们正在为图形做矩阵数学。一个 *LOT* 的 3 或 4 个元素数组。单独管理新/删除是一场噩梦。甚至在课堂上被抽象出来也引起了悲伤！*

* * *

## 下一个话题。穿线：

* * *

是的，默认情况下，线程仅限于非常小的堆栈。

您可以使用 pthread_attr_setstacksize() 更改它。虽然取决于您的线程实现，但如果多个线程共享相同的 32 位地址空间，那么**大的单个每个线程堆栈将是一个问题！** 就是没有那么多空间！同样，转换到 64 位地址空间 (OS) 会有所帮助。

```
pthread_t       threadData;
pthread_attr_t  threadAttributes;

pthread_attr_init( & threadAttributes );
ASSERT_IS( 0, pthread_attr_setdetachstate( & threadAttributes,
                                             PTHREAD_CREATE_DETACHED ) );

ASSERT_IS( 0, pthread_attr_setstacksize  ( & threadAttributes,
                                             128 * 1024 * 1024 ) );

ASSERT_IS( 0, pthread_create ( & threadData,
                               & threadAttributes,
                               & runthread,
                               NULL ) ); 
```

* * *

## 关于*Martin York 的*堆栈框架：

* * *

也许你和我在想不同的事情？

当我想到*堆栈帧*时，我想到了调用堆栈。每个函数或方法都有自己的*堆栈帧*，由返回地址、参数和本地数据组成。

我从未见过对*堆栈框架*大小的任何限制。*整个堆栈*存在限制，但这就是所有*堆栈帧*的组合。

[Wiki 上有一个很好的图表和*堆栈帧的讨论。*](http://en.wikipedia.org/wiki/Call_stack#Structure)

* * *

## 最后一点：

* * *

在 Linux/Unix/MacOS/Darwin/BSD 下，可以通过编程方式更改最大*STACK*大小限制以及*limit* (tcsh) 或*ulimit* (bash)：

```
struct rlimit  limits;
limits.rlim_cur = RLIM_INFINITY;
limits.rlim_max = RLIM_INFINITY;
ASSERT_IS( 0, setrlimit( RLIMIT_STACK, & limits ) ); 
```

Just don't try to set it to INFINITY on a Mac... And change it before you try to use it. ;-)

* * *

## Further reading:

* * *

*   [http://www.informit.com/content/images/0131453483/downloads/gorman_book.pdf](http://www.informit.com/content/images/0131453483/downloads/gorman_book.pdf)
*   [http://www.redhat.com/magazine/001nov04/features/vm/](http://www.redhat.com/magazine/001nov04/features/vm/)
*   [http://dirac.org/linux/gdb/02a-Memory_Layout_And_The_Stack.php](http://dirac.org/linux/gdb/02a-Memory_Layout_And_The_Stack.php)
*   [http://people.redhat.com/alikins/system_tuning.html](http://people.redhat.com/alikins/system_tuning.html)
*   [http://pauillac.inria.fr/~xleroy/linuxthreads/faq.html](http://pauillac.inria.fr/~xleroy/linuxthreads/faq.html)
*   [http://www.kegel.com/stackcheck/](http://www.kegel.com/stackcheck/)

* * *

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-01-09T22:47:40.280

堆栈是一块内存。堆栈指针指向顶部。可以将值压入堆栈并弹出以检索它们。

例如，如果我们有一个使用两个参数调用的函数（1 个字节大小，另一个 2 个字节大小；假设我们有一台 8 位 PC）。

两者都被压入堆栈，这将堆栈指针向上移动：

```
03: par2 byte2
02: par2 byte1
01: par1 
```

现在调用该函数并将返回地址放入堆栈：

```
05: ret byte2
04: ret byte1
03: par2 byte2
02: par2 byte1
01: par1 
```

好的，在函数中我们有 2 个局部变量；2个字节之一和4个字节之一。对于这些，堆栈上保留了一个位置，但首先我们保存堆栈指针，以便我们通过向上计数知道变量从哪里开始，通过向下计数找到参数。

```
11: var2 byte4
10: var2 byte3
09: var2 byte2
08: var2 byte1
07: var1 byte2
06: var1 byte1
    ---------
05: ret byte2
04: ret byte1
03: par2 byte2
02: par2 byte1
01: par1 
```

如您所见，只要还有空间，您就可以将任何东西放入堆栈。否则，您将获得为该站点命名的现象。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-09T22:55:25.677

`Push`和`pop`指令通常不用于存储本地堆栈帧变量。在函数的开头，堆栈帧是通过将堆栈指针递减函数的局部变量所需的字节数（与字长对齐）来建立的。这会为这些值“在堆栈上”分配必要的空间量。然后通过指向此堆栈帧的指针访问所有局部变量（`ebp`在 x86 上）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-09T22:54:12.827

堆栈是一大块内存，用于存储局部变量、函数调用返回的信息等。堆栈的实际大小因操作系统而异。例如，在 Windows 上创建新线程时，[默认大小为 1 MB](http://msdn.microsoft.com/en-us/library/ms686774(VS.85).aspx)。

如果您尝试创建一个需要比堆栈上当前可用内存更多的内存的堆栈对象，则会发生堆栈溢出并发生坏事。一大类漏洞利用代码故意尝试创建这些或类似的条件。

堆栈没有分成整数大小的块。它只是一个扁平的字节数组。它由 size_t 类型（不是 int）的“整数”索引。如果您创建一个适合当前可用空间的大型堆栈对象，它只是通过向上（或向下）堆栈指针来使用该空间。

正如其他人指出的那样，最好将堆用于大型对象，而不是堆栈。这避免了堆栈溢出问题。

**编辑：**如果您使用的是 64 位应用程序并且您的操作系统和运行时库对您很好（请参阅 mrree 的帖子），那么在堆栈上分配大型临时对象应该没问题。如果您的应用程序是 32 位和/或您的操作系统/运行时库不是很好，您可能需要在堆上分配这些对象。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-09T22:52:46.230

每当您输入一个函数时，堆栈都会增长以适应该函数中的局部变量。给定一个`largeObject`使用 400 字节的类：

```
void MyFunc(int p1, largeObject p2, largeObject *p3)
{
   int s1;
   largeObject s2;
   largeObject *s3;
} 
```

当您调用此函数时，您的堆栈将如下所示（详细信息将根据调用约定和体系结构而有所不同）：

```
 [... rest of stack ...]
   [4 bytes for p1] 
   [400 bytes for p2]
   [4 bytes for p3]
   [return address]
   [old frame pointer]
   [4 bytes for s1]
   [400 bytes for s2]
   [4 bytes for s3] 
```

有关堆栈如何操作的一些信息，请参阅[x86 调用约定](http://en.wikipedia.org/wiki/X86_calling_conventions)。MSDN 还为一些不同的调用对流提供了一些不错的图表，包括[示例代码](http://msdn.microsoft.com/en-us/library/a5s9345t.aspx)和[生成的堆栈图](http://msdn.microsoft.com/en-us/library/25687bhx.aspx)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-09T23:04:53.817

正如其他人所说，不清楚你所说的“大物体”是什么意思......但是，既然你问

> 他们只是占用多个堆栈“插槽”吗？

我将假设您只是指任何大于整数的东西。不过，正如其他人所指出的，堆栈没有整数大小的“槽”——它只是一段内存，其中的每个字节都有自己的地址。编译器通过该变量的*第一个*字节的地址跟踪每个变量 - 这是您使用 address-of 运算符 (`&var`)，而指针的值就是其他变量的地址。编译器还知道每个变量是什么类型（你在声明变量时告诉它）​​，它知道每个类型应该有多大——当你编译程序时，它会做任何必要的数学运算来计算出这些变量有多少空间调用函数时将需要变量，并将结果包含在函数入口点代码（PDaddy 提到的堆栈帧）中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-09T22:41:07.343

在 C 和 C++ 中，您不应该在堆栈上存储大对象，因为堆栈是有限的（正如您所猜测的那样）。每个线程的堆栈通常只有几兆字节或更少（可以在创建线程时指定）。当您调用“new”来创建一个对象时，它不会放在堆栈上-而是放在堆上。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-09T22:43:36.560

堆栈大小是有限的。通常堆栈大小是在创建进程时设置的。如果在 CreateThread() 调用中未另外指定，则该进程中的每个线程都会自动获取默认堆栈大小。所以，是的：可以有多个堆栈“槽”，但每个线程只有一个。而且它们不能在线程之间共享。

如果将大于剩余堆栈大小的对象放入堆栈，则会发生堆栈溢出，并且应用程序将崩溃。

因此，如果您有非常大的对象，请将它们分配在堆上，而不是堆栈上。堆仅受虚拟内存量的限制（比堆栈大一个数量级）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-09T22:36:26.450

通过“堆栈是整数的大小”，您的意思是“堆栈指针是整数的大小”。它指向堆栈的顶部，这是一个巨大的内存区域。嗯，大于整数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-09T22:39:55.367

您可以拥有足够大（或足够多）的对象，将它们放在堆栈上是没有意义的。在这种情况下，您可以将对象放在堆上并将指向它的指针放在堆栈上。这是按值传递和按引用传递之间的区别。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-09T22:39:56.457

如何定义大对象？我们说的是大于还是小于分配的堆栈空间的大小？

例如，如果您有这样的事情：

```
void main() {
    int reallyreallybigobjectonthestack[1000000000];
} 
```

根据您的系统，您可能会遇到段错误，因为根本没有足够的空间来存储对象。否则，它会像任何其他对象一样存储。如果您在实际物理内存中进行讨论，那么您不必担心这一点，因为操作系统级别的虚拟内存将负责处理该问题。

此外，堆栈的大小不太可能是整数的大小，它完全取决于您的操作系统和应用程序[虚拟地址空间](http://en.wikipedia.org/wiki/Virtual_address_space)的布局。

# .net - 加载不受信任的程序集

> ID：429998
> 
> 赞同：2
> 
> 时间：2009-01-09T22:34:11.087
> 
> 标签：.net, security

我的应用程序有一个插件模型，允许第三方开发人员编写将在主应用程序中执行的程序集。到目前为止，实际用途一直是只允许受信任的开发人员提供插件。

我想将框架公开给不受信任的开发人员。为此，我想将程序集限制为不涉及任何本地资源（硬件、注册表、数据库等）的内存操作，并且只允许使用最大内存量。

目前，对于受信任的程序集，我只是使用 Assembly.Load 和反射来实例化对象。我需要的是关于如何限制从外部程序集加载的代码的权限的很好的入门知识。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T23:16:17.850

[http://msdn.microsoft.com/en-us/library/ms972968.aspx](http://msdn.microsoft.com/en-us/library/ms972968.aspx) - 展示如何将插件加载到单独的 AppDomain 中。

[http://msdn.microsoft.com/en-us/library/ms130766.aspx](http://msdn.microsoft.com/en-us/library/ms130766.aspx) - 这个用于创建 AppDomain 的重载将允许您指定插件在不受信任时拥有的权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T23:11:23.710

基本上，您需要将程序集加载到单独的 AppDomain 中。它几乎解释了如何执行此操作以及如何限制将其他程序集加载到 MSDN 文档中的新 AppDomain 中。您还需要阅读 CAS。这允许您为加载的程序集提供一个 API，同时限制它可以在不同的信任级别调用哪些方法。

# regex - 用于在选择标记内提取选项的正则表达式

> ID：429999
> 
> 赞同：0
> 
> 时间：2009-01-09T22:34:15.300
> 
> 标签：regex, vb6

我需要在``特定的选择标签中提取选项。是否可以使用一个正则表达式来完成，或者我必须先捕获 select 的内部 html，然后再捕获选项？这是一个html的例子：

```
<select id="select_id">
  <option selected value="">Select Type</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
</select> 
```

......

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T22:36:36.387

虽然可以构建一个可以做你想做的事情的正则表达式，但我真的认为你会更乐意通过 DOM 来做，除非你有理由不使用 DOM。没有建议语言或平台的标签，因此很难得到比这更具体的标签。

尝试使用正则表达式解析 HTML 而不是将其加载到 DOM 或通过 Javascript 使用浏览器中可用的 DOM 的任何具体原因？

如果您只有这样的片段，则可以使用

```
value="(\d*)" 
```

其中 (\d*) 将捕获每个选项的值。

我看到的问题是你必须通过另一个正则表达式来缩小你的搜索范围才能得到这样一个简单的查询。就像是

```
<select.*>(.*?)</select> 
```

在大多数情况下，在外循环中会起作用。不过，DOM 是你的朋友，可以避免这样的黑客攻击。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-10T22:17:42.947

我会寻找一些库 DOM 支持，但如果必须，请执行类似以下操作：

```
"<select.*?>.*?<option value=\"(\d+)\">" + select_id + "</option>.*?</select>" 
```

`select_id`选项选择在哪里。另外，请确保您启用了多行支持。*********************