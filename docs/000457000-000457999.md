# StackOverflow 问答 000457000-000457999

# svn - 从 Subversion 迁移到 Team Foundation Server

> ID：457000
> 
> 赞同：9
> 
> 时间：2009-01-19T09:24:00.247
> 
> 标签：svn, tfs, migration, tfs-migration

我们正在寻找将 Subversion 存储库移动到 Team Foundation Server 的任何经过验证的迁移路径。似乎有一个名为 CS-Converter( [ComponentSoftware homepage](http://www.componentsoftware.com/Products/converter/svn2tfs.htm) ) 的停产产品，但找不到任何人使用它。

CS-Converter 是一款可靠的产品吗，是否还有其他我没有找到的资源，或者是否有人有一些个人经验可以指导我们？

更新：澄清一下，我们实际上需要将现有的存储库从 Subversion 移动到 Team Foundation Server（订单从高处开始），所以虽然 SVNBridge 很好，但它确实可以完成这项工作。我们需要一种经过验证的安全方法来迁移存储库

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T09:56:30.367

也许[这个讨论](http://social.msdn.microsoft.com/Forums/en-US/tfsversioncontrol/thread/dafc9550-1c17-40ae-ad0a-fc463b336507/)对你来说很有趣。

[Krysoft](http://www.kyrosoft.com)提到了另一个软件，它已经过测试并证明运行良好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-12T16:36:23.057

一些 SVN 项目在 TFS 支持符号链接之前无法迁移，Windows 本身已经可以很好地支持这些符号链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T09:30:10.217

CodePlex 网站团队推出了他们自己的本土 TFS 桥接软件**[SvnBridge](http://www.codeplex.com/SvnBridge)**：

> SvnBridge 允许您将 TortoiseSVN 和其他 Subversion 客户端与 Team Foundation Server 一起使用。它将您的 Subversion 客户端进行的调用转换为 TFS 支持的 API。
> 
> SvnBridge 通过在本地机器上运行一个可执行文件来工作，该可执行文件充当 TFS 的桥梁。您将 SvnBridge 指向 TFS 服务器，并将 TortoiseSVN 指向运行在本地计算机上的网桥。这允许您将 TortoiseSVN 与任何 TFS 服务器一起使用，而无需以任何方式更改 TFS 服务器（无需说服您的系统管理员任何事情！）。

您可能想尝试一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T10:22:37.443

老实说，最简单的方法是编写脚本。由于 TFS 具有托管对象模型，因此编写 subversion 调用脚本以获取项目的每个版本然后使用对象模型检查 TFS 应该不会太难。

可能最难的部分是使用 TFS 脚本更容易地编写颠覆。听起来是一个有趣的项目。:)

# actionscript-3 - 如何使用 ActionScript 或 Air 使用文本转语音？

> ID：457002
> 
> 赞同：2
> 
> 时间：2009-01-19T09:24:48.573
> 
> 标签：actionscript-3, air, text-to-speech, sapi

我想从我的 ActionScript 或 Air 应用程序中使用 SAPI Text-To-Speech 引擎。这可能吗 ？还有什么其他选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T10:39:02.340

Director / Shockwave 可以连接到操作系统的本机语音 API。对于 Flash，您可以在服务器上生成语音并将其下载为 mp3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T09:48:38.247

我觉得你应该玩[炼金术](http://labs.adobe.com/wiki/index.php/Alchemy:Documentation:Developing_with_Alchemy:C_API)。

# eclipse - 为什么 eclipse 试图编译不在我的构建路径中的文件？

> ID：457003
> 
> 赞同：4
> 
> 时间：2009-01-19T09:26:22.457
> 
> 标签：eclipse

我有一个相当大的项目，其中包含许多通过 svn:externals 链接的第三方依赖项。其中包括 tomcat 和 blazeDS，它们由我们的安装程序通过 ant 打包。问题是这些项目包含数十个示例 JSP 页面，当尝试构建项目时，eclipse 会阻塞它们，产生数百个错误。

我们的项目设置是这样的：

```
src/
    main/
    test/
third-party/
    blazeDS/
    tomcat/
    etc. 
```

现在，在 Eclipse 中，我的项目的构建路径设置为*仅*包含 src/main 和 src/test 中的子文件夹。然而，出于某种原因，它仍然试图在第三方之下构建一切。我点击了第三方并选择了“从构建路径中删除”，但这没有效果。我什至尝试将第三方文件夹添加到构建路径，然后排除“ **”、“** /*”和“**/*.jsp”，但同样没有效果。

这里发生了什么？

编辑：感谢您的建议，但不幸的是，它们似乎无法解决问题。我没有安装 CheckStyle 插件（我使用的是 Eclipse 3.4.1，唯一的自定义插件是 subclipse 和 flex builder），我尝试禁用除 Java 之外的所有额外构建器，但仍然抛出错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T09:45:16.787

我通常对CheckStyle插件有这种问题，您需要在其属性中指定（右键单击项目->属性-> CheckStyle）：

“从检查文件中排除非位于源目录中的文件”

否则，它会分析（并报告警告/错误）文件，这些文件不是首先要编译的候选文件。

* * *

其他几个建议：

*   尝试使用`-clean`选项重新启动您的 Eclipse（Eclipse 软件版本的“你重新启动了吗？”；））。请注意，它可能会重置您的工作区视角，因此您可能想尝试使用工作区的副本来代替。
*   尝试删除您的项目（您的项目的工作区引用，而不是其实际内容），然后重新导入它（注意您的[自定义启动器](https://stackoverflow.com/questions/337304#337317)，它们可能会在此过程中被删除）。
*   检查您是否在 src 或 test 中没有任何**[链接目录](https://stackoverflow.com/questions/300328#300346)**，这将指向第三方（/**）：这将解释不需要的编译。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T09:29:34.540

可能是您的 Eclipse 项目被配置为具有额外的构建器。您可以在项目的属性中检查（右键单击项目-> 属性-> 构建器）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-24T06:42:28.270

在我的情况下，这是因为在构建路径中的另一个文件中引用了该文件（我已从构建路径中排除）。我想`SegModel.hpp`从构建路径中排除，但在另一个文件中，我已经指定`template short K::KEstimate<SegModel>(SegModel& m, short stepCode);`

# php - 理解 PHP 中的输入转义

> ID：457014
> 
> 赞同：4
> 
> 时间：2009-01-19T09:32:57.263
> 
> 标签：php, mysql, escaping, sql-injection, magic-quotes

一直让我感到困惑的一件事是输入转义以及您是否受到保护免受 SQL 注入等攻击。

假设我有一个使用 HTTP POST 将数据发送到 PHP 文件的表单。我在输入字段中输入以下内容并提交表单：

```
"Hello", said Jimmy O'Toole. 
```

如果您在接收此 POST 数据的 PHP 页面上打印/回显输入，则会显示为：

```
\"Hello\", said Jimmy O\'Toole. 
```

这是令人困惑的地方。如果我将此输入字符串放入 (My)SQL 并执行它，它会很好地进入数据库（因为引号被转义），但这会停止 SQL 注入吗？

如果我接受输入字符串并在其上调用类似[`mysqli real_escape_string`](http://www.php.net/mysqli_real_escape_string)的东西，结果如下：

```
\\"Hello\\", said Jimmy O\\'Toole. 
```

所以当它通过 (My)SQL 进入数据库时​​，它最终会变成：

```
\"Hello\", said Jimmy O\'Toole. 
```

这显然有太多的斜线。

因此，如果输入通过 HTTP POST 转义，您是否必须再次转义以使其对（My）SQL 安全？或者我只是在这里没有看到明显的东西？

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-19T09:38:55.973

啊，[魔术语录](http://php.net/magic_quotes)的奇迹。它正在从您的 POST 表单中进行那些不必要的转义。你应该禁用（或中和）它们，你的许多头痛就会消失。

这是该主题的示例性文章：[http ://www.sitepoint.com/blogs/2005/03/02/magic-quotes-headaches/](http://www.sitepoint.com/blogs/2005/03/02/magic-quotes-headaches/)

回顾：禁用魔术引号，使用`real_escape_string()`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T09:42:32.127

我不会依赖转义，而是使用参数化的 SQL 查询，让 mysql 驱动程序做它需要的任何转义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T09:44:37.257

发生的事情是您在 PHP 配置中打开了[**Magic Quotes 。**](http://www.php.net/magic_quotes)

**强烈**建议您关闭魔术引号 - 事实上，它们已从 PHP 6 中完全删除。

禁用魔术引号后，您将看到与您在表单中输入时完全相同的 POSTed 文本：`"Hello", said Jimmy O'Toole.` 现在很明显，您需要使用 mysql 转义函数甚至更好的准备好的语句（使用准备好的语句，您可以'不要忘记转义字符串，因为它已为您完成）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T09:45:13.697

看起来您的 PHP 服务器启用了[魔术引号](http://en.wikipedia.org/wiki/Magic_quotes)功能 - 这就是您的第一组斜杠的来源。从理论上讲，应该没有必要调用转义函数——但是当应用程序在禁用魔术引号的服务器上运行时，你突然对 SQL 注入敞开了大门，而你却认为你不是。

正如 chakrit 所写，转义并不是保护自己的最佳方式 - 用户[参数化查询](http://www.php.net/mysqli_stmt_bind_param)更安全。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T09:36:27.163

明显是黑客的关键词。

我认为正常转义就足够了，但*仅仅*保护引号可能还不够。

请参阅此[SQL Injection cheatsheet](http://ferruh.mavituna.com/sql-injection-cheatsheet-oku/)，这是一个很好的测试列表，您可以运行它来查看过多的斜杠是否是一件好事。

并且不要忘记转义其他类型的值，即数字字段和日期时间字段都可以像字符串一样容易地注入。

# c# - 正则表达式查找网页中的所有链接

> ID：457015
> 
> 赞同：0
> 
> 时间：2009-01-19T09:33:00.743
> 
> 标签：c#, html, regex

我正在尝试在网站上找到源代码中的所有链接，谁能告诉我我需要在我的正则表达式中找到这些表达式吗？

* * *

重复（除其他外）：[用于解析网页链接的正则表达式？](https://stackoverflow.com/questions/6173/regular-expression-for-parsing-links-from-a-webpage)

谷歌发现更多：[html链接正则表达式站点：stackoverflow.com](http://www.google.com/search?q=html+links+regex+site%3Astackoverflow.com)

* * *

## 回答 #1

> 赞同：-3
> 
> 时间：2009-01-19T09:51:01.610

我不确定这些将如何转换为 C#（我自己还没有在 C# 中进行任何开发），但我可以在 JavaScript 或 ColdFusion 中这样做。它可能会让您了解如何在 C# 中执行此操作。

在 JavaScript 中，我*认为*这会起作用：

```
rex = /.*href="([^"]+)"/; 
a = source.replace(rex,'\n$1').split('\n'); 
```

之后 a 将是一个包含链接的数组......虽然我不确定这是否会完全按照我认为的方式工作。这里的想法是替换创建一个换行分隔的列表（因为您不能在 URL 中使用换行符），然后您可以使用 split() 拆分列表以获取您的数组。

相比之下，在 ColdFusion 中，您将不得不做一些稍微不同的事情：

```
a = REMatch('href="[^"]+"',source); 
for (i = 1; i < ArrayLen(a); i++) {
  a[i] = mid(a[i],6,len(a[i])-1); 
} 
```

同样，我还没有对其进行测试，但是 rematch 返回了表达式实例的数组，然后 for-next 循环删除了实际 URL 周围的 href=""。

# c++ - 我的 C++ 异常类真正需要多精益？

> ID：457020
> 
> 赞同：11
> 
> 时间：2009-01-19T09:36:49.080
> 
> 标签：c++, exception

有很多地方可以找到设计异常类的指南。几乎在我所见的任何地方，都有异常对象不应该做的事情列表，这会影响这些类的设计。

例如，[Boost 人建议](http://www.boost.org/community/error_handling.html)类不包含任何`std::string`成员，因为它们的构造函数可能会抛出异常，这会导致运行时立即终止程序。

现在，在我看来，这是相当理论上的。如果`std::string`的构造函数抛出，它要么是一个错误（我传入了一个空指针），要么是一个内存不足的情况（如果我在这里错了，请纠正我）。由于我在桌面上，所以我只是假装我有无限量的内存，**无论如何，内存不足对我的应用程序来说都是致命的**。

考虑到这一点，我为什么不应该`std::string`在我的异常类中嵌入对象呢？事实上，为什么我的异常类不能功能齐全，并且还要处理日志记录、堆栈跟踪等。我知道单一职责原则，在我看来这是一个公平的权衡让异常类完成所有这些。当然，如果我的解析器需要报告语法错误，那么功能齐全的异常会比围绕静态分配的字符数组构建的异常更有帮助。

所以：精益 C++ 异常类——它在现实世界中有多大意义？有哪些取舍？关于这个话题有很好的讨论吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T11:09:04.060

You could use the Boost.Exception library to help define your exception hierarchy. The Boost.Exception library supports the:

> transporting of arbitrary data to the catch site, which is otherwise tricky due to the no-throw requirements (15.5.1) for exception types.

The limitations of the framework will provide you with reasonably defined design parameters.

[Boost.Exception](http://www.boost.org/doc/libs/1_37_0/libs/exception/doc/boost-exception.html)
See also: [Boost.System](http://www.boost.org/doc/libs/1_37_0/libs/system/doc/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T16:38:28.263

在考虑允许代码处理异常之前，异常的首要任务是能够准确地向用户和/或开发人员报告出了什么问题。一个不能报告 OOM 只是使程序崩溃而没有提供任何关于它为什么崩溃的线索的异常类并不值得。现在 OOM 越来越普遍，32 位虚拟内存快用完了。

向异常类添加大量辅助方法的问题在于，它会迫使您进入您不一定想要或不需要的类层次结构。现在需要从 std::exception 派生，以便您可以使用 std::bad_alloc 做一些事情。当您使用的库具有不是从 std::exception 派生的异常类时，您会遇到麻烦。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T08:25:08.397

看看他们都在内部使用 std::string 的 std 异常。
（或者我应该说我的 g++ 实现确实如此，我确信标准对这个问题保持沉默）

```
/** Runtime errors represent problems outside the scope of a program;
  *  they cannot be easily predicted and can generally only be caught as
  *  the program executes.
  *  @brief One of two subclasses of exception.
 */
class runtime_error : public exception
{
    string _M_msg;
  public:
    /** Takes a character string describing the error.  */
    explicit runtime_error(const string&  __arg);

    virtual ~runtime_error() throw();

    /** Returns a C-style character string describing the general cause of
     *  the current error (the same string passed to the ctor).  */
    virtual const char* what() const throw();
}; 
```

我通常从 runtime_error （或其他标准异常之一）派生我的异常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T09:42:32.017

作为一般情况，异常类应该是简单的、自给自足的结构，并且从不分配内存（就像`std::string`那样）。第一个原因是分配或其他复杂操作可能会失败或产生副作用。另一个原因是异常对象是按值传递的，因此是堆栈分配的，因此它们必须尽可能轻量级。更高级别的功能应该由客户端代码处理，而不是异常类本身（除非出于调试目的）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-06T13:31:45.633

> 因为我在桌面上，所以我只是假装我有无限量的内存，无论如何，内存不足对我的应用程序来说都是致命的。

因此，当您的应用程序发生致命故障时，您不希望它干净地终止吗？让析构函数运行，文件缓冲区或日志被刷新，甚至可能向用户显示错误消息（或者更好的是，错误报告屏幕）？

> 考虑到这一点，我为什么不应该在我的异常类中嵌入 std::string 对象？事实上，为什么我的异常类不能是全功能的，还要处理日志记录、堆栈跟踪等。我知道单一职责原则，在我看来这是一个公平的权衡让异常类完成所有这些。

为什么这是一个公平的权衡？*为什么这*是一个权衡？权衡意味着您对单一职责原则做出*一些*让步，但据我所知，您不会那样做。你只是说“我的例外应该做一切”。这几乎不是一个权衡。

与 SRP 一样，答案应该很明显：通过让异常类完成所有操作，您可以获得什么？为什么记录器不能是一个单独的类？为什么一定要通过异常来执行？它不应该由异常*处理程序处理吗*? 您可能还需要本地化，并提供不同语言的语法错误消息。因此，您的异常类应该在构造时出去并读取外部资源文件，寻找正确的本地化字符串？这当然意味着另一个潜在的错误来源（如果找不到字符串），增加了异常的复杂性，并且要求异常知道其他不相关的信息（用户使用的语言和区域设置）。格式化的错误消息可能取决于它的显示方式。也许在记录时、在消息框中显示或打印到标准输出时应该采用不同的格式。异常类要处理的更多问题。还有更多可能出错的事情，更多可能发生错误的代码。

你的异常尝试做的越多，出错的事情就越多。如果它尝试记录，那么如果磁盘空间不足会发生什么？也许您还假设磁盘空间是无限的，而忽略如果发生这种情况，您将丢弃所有错误信息？如果您没有对日志文件的写权限怎么办？

根据经验，我不得不说，没有什么比*没有得到有关刚刚发生的错误的任何信息更烦人的事情了，因为发生了错误*。如果您的错误处理无法处理发生的错误，那么它并不是真正的错误处理。如果您的异常类无法在不引起更多异常的情况下处理被创建和抛出，*那有什么意义*呢？

通常，使用 SRP 的原因是添加到类中的复杂性越高，确保正确性和*理解*代码的难度就越大。这仍然适用于异常类，但您还有第二个问题：添加到异常类的复杂性越多，发生错误的机会就越大。通常，您不希望*在抛出异常*时发生错误。毕竟，您已经在处理另一个错误。

但是，“异常类不应包含 a 的规则与“`std::string`不允许异常类分配内存”的规则并不完全相同。`std::exception`后者是这样做的。它毕竟存储了一个 C 风格的字符串。Boost 只是说不存储可能抛出异常的对象。所以如果你分配内存，你只需要能够处理分配失败的情况。

> 当然，如果我的解析器需要报告语法错误，那么功能齐全的异常会比围绕静态分配的字符数组构建的异常更有帮助。

刚才说他不介意应用程序在发生错误时终止而没有向用户提供任何反馈的人说。;)

是的，您的异常应该包含生成友好、可读的错误消息所需的所有数据。在解析器的情况下，我会说它必须是这样的：

*   输入文件名（或允许我们在需要时获取文件名的句柄或指针）
*   发生错误的行号
*   或许位置就行
*   发生的语法错误的类型。

基于此信息，您可以*在处理错误时*为用户生成友好、可靠的错误消息。如果您愿意，您甚至可以将其本地化。您可以*在处理异常时*对其进行本地化。

通常，异常类是供程序员使用的。它们不应包含或构建针对*用户*的文本。正确创建可能很复杂，并且应该在处理错误时完成。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-14T07:17:20.407

C++ 标准要求异常具有无抛出复制构造函数。如果你有一个 std::string 成员，你就没有一个无抛出复制构造函数。如果系统无法复制您的异常，它将终止您的程序。

在设计异常类型层次结构时使用虚拟继承也是一个好主意，如[http://www.boost.org/doc/libs/release/libs/exception/doc/using_virtual_inheritance_in_exception_types.html](http://www.boost.org/doc/libs/release/libs/exception/doc/using_virtual_inheritance_in_exception_types.html)中所述。

但是，不要求异常对象简单或不分配内存。事实上，异常对象本身通常是在堆上分配的，因此系统可能会耗尽内存以尝试抛出异常。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-06T13:08:08.957

我认为拒绝在异常类中使用 std::string 是不必要的纯粹主义。是的，它可以扔。所以呢？如果您的 std::string 实现仅因为您正在构建消息“无法解析文件 Foo”而引发*内存不足以外的其他原因*，那么该实现存在问题，而不是您的代码。

至于内存不足，即使您构造一个不带字符串参数的异常，您也会遇到这个问题。添加 20 个字节的有用错误消息不太可能成败。在桌面应用程序中，大多数 OOM 错误发生在您尝试错误地分配 20 GB 内存时，而不是因为您一直以 99.9999% 的容量愉快地运行并且某些事情让您超过了顶峰。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-19T09:41:58.537

> ...无论如何，内存不足对我的应用程序来说都是致命的。

不幸的是，这正是大多数人所说的，因为他们不想处理否则会出现的复杂性。另一方面，如果您确实遵循标准设定的要求，您将获得更强大的软件，即使在低内存条件下也可以恢复。

撇开火星探测器不谈，想想这样一个简单的例子，比如编写一个文本处理器。您想实现复制/粘贴功能。用户选择一些文本并按 Ctrl+C。您更喜欢什么结果：崩溃或消息“内存不足”？（如果没有足够的内存来显示消息框，则什么也不会发生。）第二种情况无疑对用户更加友好，她可以关闭其他应用程序并继续处理她的文档。

事实上，保证无抛出复制构造函数并不难。您应该只在指向动态分配的内存的异常中存储一个共享指针：

```
class my_exception : virtual public std::exception {
public:
    // public interface...
private:
    shared_ptr<internal> representation;
}; 
```

假设异常是针对异常情况，原子计数开销可以忽略不计。事实上，这就是 Boost.Exception 所做的。

话虽如此，我也推荐jalf的答案。

# jquery - 使用jquery制作动画

> ID：457021
> 
> 赞同：-1
> 
> 时间：2009-01-19T09:37:05.897
> 
> 标签：jquery, html

我需要为正方形设置动画，就像在 div 中移动一样。在我满足条件之前，它不应该停止。

请帮我写这个..我可以举一些例子......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T09:49:18.197

[jQuery 文档](http://docs.jquery.com/Core/queue)有一个移动正方形的动画队列示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T09:45:50.607

如果您要告诉它应该如何制作动画，或者给出一个到目前为止您尝试过的示例，您可能会获得更多帮助。

# sql - SQL 中的代码重用和模块化

> ID：457032
> 
> 赞同：15
> 
> 时间：2009-01-19T09:41:21.957
> 
> 标签：sql, sql-server

代码重用和模块化是 SQL 存储过程编程的好主意吗？

如果是这样，将这些功能添加到 SQL 存储过程代码库的最佳方法是什么？

我通常为常见和重复的任务创建标量值函数。我发现它不仅可以简化类似于现有程序的新程序的开发，而且还有助于进行错误跟踪和故障排除。

不过，由于性能问题，我尽量远离表值函数。

我的经验法则是，如果它是一个计算，并且在多个地方使用，那么我创建一个标量值函数。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T14:32:17.127

您会发现在查询中使用函数对性能来说是一场灾难。这些函数成为优化器的黑匣子，因此您最终将函数调用重新编码到查询中，以使其在表中出现大量行时快速运行。

处理常见计算的更好方法是将它们插入到带有触发器的新列中，或者插入/更新查询中。这样，您可以索引计算的值并直接使用它，而不是每次需要时都计算出来。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T09:54:10.963

在代码重用方面，Sql 并没有给您很大的灵活性。当涉及到不涉及修改表的计算或其他任务时，我通常会创建函数。但是所有涉及写入表的任务以及我通常使用存储过程来更好地控制事务的那种事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T13:25:59.710

您可以将代码分解为单独的存储过程，以帮助将复杂的存储过程分解为更易于管理的块。您也可以这样做来打破在函数中不起作用的常见逻辑。将其视为类似于提取方法重构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T10:15:09.893

从应用程序端查看它的另一种方法是使用绑定来重用您的 SQL 查询。但这可能不是你要找的

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T17:05:03.090

为了跟进这一点，我确实遇到了一些性能问题，而且优化器似乎无法为函数内的代码选择正确的索引。

所以我必须使用索引提示（带关键字）指定正确的索引，以解决性能问题。

# c# - 为什么“带有循环索引的猴子”不好？

> ID：457036
> 
> 赞同：17
> 
> 时间：2009-01-19T09:43:57.007
> 
> 标签：c#, for-loop

Steve McConnell 的清单项目之一是[您不应该胡乱使用循环索引](http://www.matthewjmiller.net/files/cc2e_checklists.pdf)（第 16 章，第 25 页，*循环索引*，PDF 格式）。

这很直观，并且是我一直遵循的一种做法，除非我当时学会了如何编程。

在最近的一次代码审查中，我发现了这个尴尬的循环，并立即将其标记为可疑。

```
 for ( int i=0 ; i < this.MyControl.TabPages.Count ; i++ )
        {
            this.MyControl.TabPages.Remove ( this.MyControl.TabPages[i] );
            i--;
        } 
```

这几乎很有趣，因为它设法将索引保持为零，直到所有 TabPages 都被删除。

这个循环可以写成

```
 while(MyControl.TabPages.Count > 0)
            MyControl.TabPages.RemoveAt(0); 
```

而且由于控件实际上与循环几乎同时编写，它甚至可以写成

```
 MyControl.TabPages.Clear(); 
```

从那以后，我就代码审查问题受到了挑战，并发现我对**为什么**这是不好的做法的表述并不像我希望的那样有力。我说过更难理解循环的流程，因此更难维护和调试，最终在代码的生命周期内成本更高。

有没有更好的说明为什么这是不好的做法？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-19T09:47:30.870

我觉得你的表达很棒。或许可以这样写：

> 既然逻辑可以表达得更清楚，它应该。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-19T09:47:15.143

好吧，这增加了一些混乱 - 你可以很容易地写：

```
while(MyControl.TabPages.Count > 0)
{
    MyControl.TabPages.Remove(MyControl.TabPages[0]);
} 
```

或（更简单）

```
while(MyControl.TabPages.Count > 0)
{
    MyControl.TabPages.RemoveAt(0);
} 
```

或（最简单的）

```
MyControl.TabPages.Clear(); 
```

综上所述，我不必眯着眼睛去思考任何极端情况。很清楚什么时候会发生什么。如果您正在修改循环索引，您很快就会使其一目了然。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-19T09:57:41.753

这一切都与期待有关。

当使用循环计数器时，您期望循环的每次迭代都会以相同的数量递增（递减）。

如果你弄乱了循环计数器（或者如果你喜欢猴子），你的循环不会像预期的那样表现。这意味着它更难理解，它增加了你的代码被误解的机会，这会引入错误。或者（错误地）引用一个聪明但虚构的人物：

```
complexity leads to misunderstanding

misunderstanding leads to bugs

bugs leads to the dark side. 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T10:12:37.790

我同意你的挑战。如果他们想保留一个 for 循环，代码：

```
for ( int i=0 ; i < this.MyControl.TabPages.Count ; i++ ) {
    this.MyControl.TabPages.Remove ( this.MyControl.TabPages[i] );
    i--;
} 
```

减少如下：

```
for ( int i=0 ; i < this.MyControl.TabPages.Count ; ) {
    this.MyControl.TabPages.Remove ( this.MyControl.TabPages[i] );
} 
```

然后到：

```
for ( ; 0 < this.MyControl.TabPages.Count ; ) {
    this.MyControl.TabPages.Remove ( this.MyControl.TabPages[0] );
} 
```

但是如果存在**while**循环或**Clear()**方法，显然更可取。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-19T09:50:08.493

[我认为你可以通过调用 Knuth 的文学编程](http://en.wikipedia.org/wiki/Literate_programming)概念来建立一个更有力的论点，即程序*不*应该为计算机编写，而是为了与*其他程序员*交流概念，因此更简单的循环：

```
 while (this.MyControl.TabPages.Count>0)
 {
            this.MyControl.TabPages.Remove ( this.MyControl.TabPages[0] );
 } 
```

更清楚地说明了意图 - 删除第一个标签页，直到没有留下任何标签页。我认为大多数人会比原始示例更快地理解。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T09:51:52.140

这可能更清楚：

```
while (this.MyControl.TabPages.Count > 0)
{
  this.MyControl.TabPages.Remove ( this.MyControl.TabPages[0] );
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T09:52:13.247

可以使用的一个论点是调试这样的代码要困难得多，因为索引被更改了两次。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-19T10:03:28.153

原始代码高度冗余，无法将 for 循环的操作转变为必要的。增量是不必要的，并由减量平衡。这些应该是前增量，而不是后增量，因为从概念上讲后增量是错误的。与标签页数的比较是半冗余的，因为这是一种检查容器是否为空的骇人听闻的方式。

简而言之，这是不必要的聪明，它增加而不是消除冗余。由于它既可以明显更简单，也可以明显更短，这是错误的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-12T22:11:59.390

使用索引的唯一原因是如果有人选择性地擦除事物。即使在那种情况下，我认为最好说：

```
  我=0；
  而（我 < MyControl.Tabpages.Count）
    if (wantToDelete(MyControl.Tabpages(i))
      MyControl.Tabpages.RemoveAt(i);
    别的
      我++；
```

而不是在每次删除后对循环索引进行金星。或者，更好的是，让索引向下计数，以便在删除项目时不会影响未来需要删除的项目的索引。如果删除了许多项目，这也可能有助于最大限度地减少每次删除后移动项目所花费的时间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-19T10:06:25.590

我认为指出循环迭代不是像任何人所期望的那样由“i++”控制的事实，而是由疯狂的“i--”设置控制就足够了。

我还认为通过评估计数来改变“i”的状态，然后改变循环中的计数也可能导致潜在的问题。我希望for循环通常具有“固定”次数的迭代，并且for循环条件的唯一部分更改为循环变量“i”。

# c++ - 循环中的条件评估？

> ID：457040
> 
> 赞同：3
> 
> 时间：2009-01-19T09:45:46.333
> 
> 标签：c++, loops, evaluation, conditional-statements

```
string strLine;//not constant
int index = 0;
while(index < strLine.length()){//strLine is not modified}; 
```

`strLine.length()`评估多少次

我们是否需要在循环之前使用`nLength`with`nLength`分配给`strLine.length()`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T10:17:50.697

`length`每次您通过循环时都会对其进行评估，但是由于`length`是恒定时间`O(1)`（如果字符串被更改，则破坏代码）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T11:52:57.370

length() 在源文件中包含的标头中定义，因此它可以由编译器内联，它的内部调用也可以内联，因此如果编译器能够检测到您的字符串实例在循环中没有更改然后它可以优化对字符串长度的访问，因此它只会被评估一次。无论如何，我认为存储字符串长度的值并不是真正必要的。也许它可以为您节省一些纳秒，但是您的代码会更大，并且当您决定在循环内更改该字符串时会有一些风险。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T09:48:19.150

每次调用它...（每次评估）。如果您不更改字符串长度，则最好使用临时变量，例如：

```
string strLine;
int stringLength = strLine.length();
int index = 0;
while(index < stringLength); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T20:50:18.380

我认为其中潜伏着第二个问题，那就是“哪个实现更清晰？”

如果从语义上讲，您的意思是 strLine 的长度在循环体内永远不会改变，那么通过分配给一个命名良好的变量来使其显而易见。我什至会把它设为常量。这使其他程序员（和您自己）清楚地知道比较值永远不会改变。

这样做的另一件事是，当您在调试器中单步执行代码时，可以更轻松地查看该值是什么。悬停在本地比在函数调用上的效果要好得多。

说，“把它作为一个函数调用；编译器会优化它”让我觉得过早的悲观。即使 length() 是 O(1)，如果没有内联（你不能保证优化没有被禁用），它仍然是一个重要的函数调用。通过使用局部变量，您可以阐明您的含义，并获得可能不平凡的性能优化。

做让你的意图最清楚的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T11:01:01.000

strLine.length() 将被评估 while( i < strLine.length() )

话虽如此，如果字符串是常量，大多数编译器都会对此进行优化（使用适当的设置）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T20:58:28.347

如果您要使用临时变量，请使用 const 限定符，因此编译器可以添加优化，知道值不会改变：

```
string strLine;//not constant
int index = 0;
const int strLenght = strLine.Length();
while(index < strLine.length()){//strLine is not modified}; 
```

无论如何，编译器本身可能会在访问 Length() 方法时进行这些优化。

编辑：我的组装有点生锈，但我认为评估只进行一次。鉴于此代码：

```
int main()
{
    std::string strLine="hello world";

    for (int i=0; i < strLine.length(); ++i)
    {
        std::cout << strLine[i] <<std::endl;
    }
} 
```

生成此程序集：

```
 for (int i=0; i < strLine.length(); ++i)
0040104A  cmp         dword ptr [esp+20h],esi 
0040104E  jbe         main+86h (401086h) 
```

但是对于这段代码

```
 std::string strLine="hello world";
 const int strLength = strLine.length();
 for (int i=0; i < strLength ; ++i)
 {
    std::cout << strLine[i] <<std::endl;
 } 
```

生成这个：

```
 for (int i=0; i < strLength ; ++i)
0040104F  cmp         edi,esi 
00401051  jle         main+87h (401087h) 
```

如果不使用 const 限定符，则会生成相同的程序集，因此在这种情况下它没有区别。

尝试使用 VSC++ 2005

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T21:25:11.693

如前所述，由于该`string::length`函数可能完全在标头中定义，并且要求为 O(1)，因此几乎可以肯定会评估为简单的成员访问，并内联到您的代码中。由于您没有将字符串声明为易失性，因此允许编译器想象没有外部代码会更改它，并优化对单个内存访问的调用并将值留在寄存器中，如果它发现这是一个好主意。

通过自己获取和缓存值，您增加了编译器能够做同样事情的机会。在许多情况下，编译器甚至不会生成将字符串长度写入堆栈的代码，而只是将其留在寄存器中。当然，如果您调用编译器无法内联的不同函数，则必须将值写入堆栈以防止函数调用占用寄存器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T12:36:11.760

既然你没有改变字符串，你不应该使用

```
const string strLine; 
```

只是，因为那时编译器会获得更多关于什么可以改变和什么不能改变的信息——但不确定 C++ 编译器究竟能变得多么聪明。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-19T09:48:14.220

`strLine.length()`每次您绕过循环时都会对其进行评估。

你是对的，因为它使用起来会更有效`nLength`，特别是如果`strLine`很长。

# c# - C# 内部访问修饰符

> ID：457044
> 
> 赞同：4
> 
> 时间：2009-01-19T09:46:52.913
> 
> 标签：c#

我想密封命名空间中的类。我正在查看“内部”访问修饰符，但这似乎只是在程序集中密封类。我可以在命名空间中密封类吗？

还是我必须将东西移动到单独的组件中？但是我会遇到视觉工作室拒绝循环装配引用的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T09:52:29.330

不，没有特定于命名空间的修饰符。一种选择是使用继承和“受保护”修饰符，但在基类上有一个内部构造函数，这样外部代码就不能对其进行子类化。这可能会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T09:52:04.947

使用 C# 是不可能的。

**命名空间级成员只能是`public`或`internal`**

但是，您可以在 C# 中使用嵌套类

```
namespace A {
    public class B {

        protected class C { }
    }

    public class D {

        void E() {
            var F = new A.B();    // ok!
            var G = new A.B.C();  // error!
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T09:51:46.960

您仍然可以使用 internal 关键字并通过 AssemblyInfo.cs 文件中的[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)属性将内部类公开给另一个程序集。

# c - 如何使用 win32 API 在系统托盘图标中显示文本？

> ID：457050
> 
> 赞同：9
> 
> 时间：2009-01-19T09:48:19.057
> 
> 标签：c, winapi, system-tray

尝试创建一个小型监视器应用程序，使用 win32 API 在 C 中的系统托盘中显示当前互联网使用百分比。

还希望根据相对于月份剩余天数的使用量来使用彩色背景或彩色文本。

**编辑：**澄清我希望系统托盘图标是动态的。随着百分比的变化，我更新系统托盘图标。寻找仅使用普通旧 win32（即没有 MFC 或 WTL）的解决方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-19T12:26:11.343

好的，这是我的 win32 解决方案：

```
HICON CreateSmallIcon( HWND hWnd )
{
    static TCHAR *szText = TEXT ( "100" );
    HDC hdc, hdcMem;
    HBITMAP hBitmap = NULL;
    HBITMAP hOldBitMap = NULL;
    HBITMAP hBitmapMask = NULL;
    ICONINFO iconInfo;
    HFONT hFont;
    HICON hIcon;

    hdc = GetDC ( hWnd );
    hdcMem = CreateCompatibleDC ( hdc );
    hBitmap = CreateCompatibleBitmap ( hdc, 16, 16 );
    hBitmapMask = CreateCompatibleBitmap ( hdc, 16, 16 );
    ReleaseDC ( hWnd, hdc );
    hOldBitMap = (HBITMAP) SelectObject ( hdcMem, hBitmap );
    PatBlt ( hdcMem, 0, 0, 16, 16, WHITENESS );

    // Draw percentage
    hFont = CreateFont (12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                    TEXT ("Arial"));
    hFont = (HFONT) SelectObject ( hdcMem, hFont );
    TextOut ( hdcMem, 0, 0, szText, lstrlen (szText) );

    SelectObject ( hdc, hOldBitMap );
    hOldBitMap = NULL;

    iconInfo.fIcon = TRUE;
    iconInfo.xHotspot = 0;
    iconInfo.yHotspot = 0;
    iconInfo.hbmMask = hBitmapMask;
    iconInfo.hbmColor = hBitmap;

    hIcon = CreateIconIndirect ( &iconInfo );

    DeleteObject ( SelectObject ( hdcMem, hFont ) );
    DeleteDC ( hdcMem );
    DeleteDC ( hdc );
    DeleteObject ( hBitmap );
    DeleteObject ( hBitmapMask );

    return hIcon;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T09:56:05.733

文字是指“提示”？

假设您在系统托盘上有您的图标

```
NOTIFYICONDATA _stNotifyIconData;

// For a simple Tip
_stNotifyIconData.uFlags = NIF_TIP;
strcpy_s(_stNotifyIconData.szTip, "Little Tip"); // Copy Tip    
Shell_NotifyIcon(NIM_MODIFY, &_stNotifyIconData);

// For a Ballon Tip
_stNotifyIconData.uFlags = NIF_INFO;
strcpy_s(_stNotifyIconData.szInfoTitle, "Title of the Ballon"); // Title
strcpy_s(_stNotifyIconData.szInfo, "Text..." ); // Copy Tip
_stNotifyIconData.uTimeout = 3000;  // 3 Seconds
_stNotifyIconData.dwInfoFlags = NIIF_INFO;

Shell_NotifyIcon(NIM_MODIFY, &_stNotifyIconData); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T10:01:14.367

系统托盘只接受要显示的图标，而不是文本。

要在此处显示文本，您必须首先创建内存位图，在其上绘制文本，然后将该内存位图转换为内存图标并让系统托盘显示该图标。

下面的示例代码：

```
CDC dcMem;
dcMem.CreateCompatibleDC(NULL);

CBitmap* pOld = dcMem.SelectObject( &m_bmpIcon );

CBrush back( RGB(0,0,0) );
dcMem.FillRect( CRect(0,0,16,16), &back );

CBrush brush( COLORDOWN );
dcMem.FillRect( rcRecv, &brush );

dcMem.SelectObject( pOld );

HICON hIcon = CreateIconIndirect( &m_TaskBarIconInfo ); 
```

# php - 如何在 PHP 5.x（symfony）中拒绝 utf-8 中的外国字母？

> ID：457054
> 
> 赞同：2
> 
> 时间：2009-01-19T09:49:25.700
> 
> 标签：php, validation, utf-8, symfony1

我必须在验证时禁用用户在我的网站中输入的中文、日文、西里尔文（等等）字母（仅服务器端验证）。同时，我希望允许所有带有拉丁重音符号的字符。我使用 symfony 1.1 和 PHP 5.2，当然也使用 utf-8。有什么提示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T10:49:08.747

您可以随时转换为 latin1，然后再转换回来。那将丢弃任何非 latin1 字符。例如。：

```
$str = utf8_encode(utf8_decode($str)); 
```

我想知道你为什么首先想要这个？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T18:52:22.937

如果您需要选择，您将无法避免使用正则表达式和/或创建允许的字符列表。

是的，这既不容易也不容易，但如果你想挑剔字符，你可能需要具体一点。

# mysql - 将表从 MyISAM 更改为 InnoDB 会使系统变慢

> ID：457060
> 
> 赞同：1
> 
> 时间：2009-01-19T09:51:17.180
> 
> 标签：mysql, innodb, myisam

您好我正在使用 Mysql 5.0.x

我刚刚将很多表从 MyISAM 更改为 InnoDB

使用 MyISAM 表大约需要**1 分钟**来安装我们的数据库使用 InnoDB 大约需要**15 分钟**来安装相同的数据库

**为什么 InnoDB 需要这么长时间？**

**我能做些什么来加快速度？**

数据库安装执行以下步骤

1) 删除架构

2) 创建架构

3) 创建表

4) 创建存储过程

5) 插入默认数据

6）通过存储过程插入数据

编辑：

插入默认数据需要大部分时间

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T23:29:49.617

修改插入数据步骤以在开始时启动事务并在结束时提交它。你会得到改进，我保证。（如果您有大量数据，您可能希望将事务分解为每个表。）

如果您的应用程序根本不使用事务，那么您应该将参数设置`innodb_flush_log_at_trx_commit`为 2。这会给您带来很多性能，因为您几乎肯定会启用 auto_commit 并且这会生成比 InnoDB 配置的默认参数更多的事务. 此设置阻止它在每次提交时不必要地刷新磁盘缓冲区。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T11:22:38.867

15分钟对我来说似乎并不过分。毕竟，这是一次性成本。

我不确定，但我想部分解释是参照完整性不是免费的。InnoDB 必须做更多的工作来保证它，所以它当然会占用更多的时间。

在创建表后，可能需要更改您的脚本以添加约束。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T12:27:05.197

就像 duffymo 说的，在插入数据之前禁用你的约束（索引和外键/主键）。

也许你应该在通过存储过程插入数据之前恢复一些索引，如果它使用很多*选择*语句

# c# - 获取当前鼠标光标类型

> ID：457069
> 
> 赞同：10
> 
> 时间：2009-01-19T09:54:22.803
> 
> 标签：c#, delphi, winapi, vb6

如何获取当前的 GLOBAL 鼠标光标类型（沙漏/箭头/..）？在 Windows 中。

全局 -**即使鼠标不在我的应用程序**之外，或者即使我的程序是无风的，我也需要它。

在 C#、Delphi 或纯 winapi 中，没关系...

非常感谢您提前！！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2014-06-28T23:44:14.860

多年后，是时候回答我自己的问题了。以下是在 C# 中检查当前全局光标是否为沙漏的方法（如果需要，请根据自己的需要扩展代码）：

```
private static bool IsWaitCursor()
{
    var h = Cursors.WaitCursor.Handle;

    CURSORINFO pci;
    pci.cbSize = Marshal.SizeOf(typeof(CURSORINFO));
    GetCursorInfo(out pci);

    return pci.hCursor == h;
}

[StructLayout(LayoutKind.Sequential)]
struct POINT
{
    public Int32 x;
    public Int32 y;
}

[StructLayout(LayoutKind.Sequential)]
struct CURSORINFO
{
    public Int32 cbSize;        // Specifies the size, in bytes, of the structure. 
    // The caller must set this to Marshal.SizeOf(typeof(CURSORINFO)).
    public Int32 flags;         // Specifies the cursor state. This parameter can be one of the following values:
    //    0             The cursor is hidden.
    //    CURSOR_SHOWING    The cursor is showing.
    public IntPtr hCursor;          // Handle to the cursor. 
    public POINT ptScreenPos;       // A POINT structure that receives the screen coordinates of the cursor. 
}

[DllImport("user32.dll")]
static extern bool GetCursorInfo(out CURSORINFO pci); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T12:12:11.793

要获取有关全局光标的信息，请使用[GetCursorInfo](http://msdn.microsoft.com/en-us/library/ms648389.aspx "MSDN 上的 GetCursorInfo")。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T10:00:30.390

使用（在德尔福中）

```
Screen.MouseCursor. 
```

对于当前鼠标光标。

一般 Win32 (user32) 给出：

```
function GetCursor: HCURSOR; stdcall; 
```

这应该适用于其他 win32 语言。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-15T11:51:40.830

OEM 游标是共享资源，因此请求特定游标的所有进程都将检索相同的句柄。应用程序可以在启动时缓存标准系统游标句柄，然后它可以使用[GetCursorInfo](http://msdn.microsoft.com/en-us/library/ms648389.aspx)获取全局游标句柄，并在缓存中查找此句柄以检索其*类型*- 如果它是系统游标。

下面的 Delphi 示例代码演示。[在创建表单时使用LoadImage](http://msdn.microsoft.com/en-us/library/ms648045%28VS.85%29.aspx)将光标句柄填充到数组中。计时器通过使用[GetCursorInfo](http://msdn.microsoft.com/en-us/library/ms648389.aspx)定期轮询全局游标，代码在数组中查找句柄以从名称的常量数组中检索游标的名称：

```
const
  HighCursor = 13;

type
  TForm1 = class(TForm)
    Timer1: TTimer;
    Label1: TLabel;
    procedure FormCreate(Sender: TObject);
    procedure Timer1Timer(Sender: TObject);
  private
    FCursorHandles: array [0..HighCursor] of HCURSOR;
  public
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

const
  OEMCursors: array [0..HighCursor] of Integer = (OCR_NORMAL, OCR_IBEAM,
      OCR_WAIT, OCR_CROSS, OCR_UP, OCR_SIZENWSE, OCR_SIZENESW, OCR_SIZEWE,
      OCR_SIZENS, OCR_SIZEALL, OCR_NO, OCR_HAND, OCR_APPSTARTING,
      32651 {OCR_HELP?});

  CursorNames: array [0..HighCursor] of string = ('OCR_NORMAL', 'OCR_IBEAM',
      'OCR_WAIT', 'OCR_CROSS', 'OCR_UP', 'OCR_SIZENWSE', 'OCR_SIZENESW',
      'OCR_SIZEWE', 'OCR_SIZENS', 'OCR_SIZEALL', 'OCR_NO', 'OCR_HAND',
      'OCR_APPSTARTING', 'OCR_HELP');

procedure TForm1.FormCreate(Sender: TObject);
var
  i: Integer;
begin
  for i := 0 to HighCursor do
    FCursorHandles[i] := LoadImage(0, MakeIntResource(OEMCursors[i]),
        IMAGE_CURSOR, 0, 0, LR_DEFAULTCOLOR or LR_DEFAULTSIZE or LR_SHARED);
end;

procedure TForm1.Timer1Timer(Sender: TObject);

  function GetCursorName(Cursor: HCURSOR): string;
  var
    i: Integer;
  begin
    for i := 0 to HighCursor do
      if Cursor = FCursorHandles[i] then begin
        Result := CursorNames[i];
        Exit;
      end;
    Result := 'Unknown Cursor';  // A custom cursor.
  end;

var
  CursorInfo: TCursorInfo;
begin
  CursorInfo.cbSize := SizeOf(CursorInfo);
  if GetCursorInfo(CursorInfo) then
    Label1.Caption := GetCursorName(CursorInfo.hCursor)
  else
    Label1.Caption := 'Fail: ' + SysErrorMessage(GetLastError);
end; 
```

请注意，当使用 Delphi 时，不必缓存光标句柄，因为 Delphi 通过其[Screen.Cursors](http://docs.embarcadero.com/products/rad_studio/delphiAndcpp2009/HelpUpdate2/EN/html/delphivclwin32/Forms_TScreen_Cursors.html)列表进行缓存。示例代码不使用它是为了具有更好的可移植性。

另请注意，“winuser.h”中没有“OCR_HELP”，但提供的与“IDC_HELP”对应的常量似乎工作正常（尽管我在 W7 中找不到使用“帮助选择”光标的对话框） .

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T10:08:18.347

编辑：在德尔福

在大多数可视对象中，您可以使用*Cursor*属性，否则使用*Screen.Cursor*属性。将其设置回***crDefault 会***取消您对之前设置的任何更改。

# javascript - 如何禁用标签的标签

> ID：457070
> 
> 赞同：40
> 
> 时间：2009-01-19T09:54:39.903
> 
> 标签：javascript, html, dom-events

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2009-01-19T10:09:40.433

或者，您可以选择纯 HTML 解决方案。

```
<a href="http://foo.bar" tabindex="-1">inaccessible by tab link</a> 
```

[HTML5 规范](http://www.w3.org/TR/html5/editing.html#attr-tabindex)说：

> **如果值为负整数**
> 用户代理必须设置元素的 tabindex 焦点标志，但不应允许使用顺序焦点导航到达该元素。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-19T10:16:23.540

我必须防止 div 和 overflow: auto css rule 之前有一个制表位，而我所做的是（转置为 a's）：

```
var links = document.getElementsByTagName( 'a' );

for( var i = 0, j =  links.length; i < j; i++ ) {
    links[i].setAttribute( 'tabindex', '-1' );
} 
```

使用 tabindex 而不是模糊意味着焦点将跳到下一个元素。

您确定要禁用 tabindex 吗？这对于没有鼠标的导航至关重要。

刚刚注意到纯 HTML 中的类似答案

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T09:56:50.180

尝试

```
<a onfocus="this.blur();" href = "bla">Bla</a> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-16T11:43:41.440

标签`<a>`必须能够被标签索引。它使导航更容易。

使用`<p>`或`<span>`代替，宽度`onclick="window.location.href='URL'"`事件属性。

例子：

```
<span onclick="window.location.href='http://www.w3schools.com'">text that redirects you to W3S on click, where you can read more about HTML standards.</span> 
```

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2009-01-19T09:57:29.023

# communication - 如何与客户进行良好的沟通

> ID：457071
> 
> 赞同：2
> 
> 时间：2009-01-19T09:54:52.007
> 
> 标签：communication, scrum

我有一个挑战，我需要一些意见。

我目前正在为一个新的开发部门招聘程序员。我正在寻找工作出色的人——他们可能“缺乏”一些我通常要求他们具备的其他东西（例如说挪威语和（说实话））——社交技能，以便能够会见客户（我之前曾与其中几个合作过:)））。

我的问题是关于客户（客户）和开发团队之间的沟通。

背景：我们的战略是在未来两年内成为我们的客户扩展开发部门。例如，他们将我们视为他们自己的部门，只是坐在其他地方。虽然我们正朝着这个目标前进，但我们将不得不在较小的项目上赚钱。工作就在那里，所以我不担心我们无法生存。

但是——我们都知道，与客户进行良好的沟通是为客户提供他们真正想要的东西（我们顺便提一下）而不是其他东西的关键要素之一。我如何设法与不会说这种语言的人一起做到这一点，或者再一次，甚至没有与客户沟通的技能（你们都知道一个非常聪明的人正在与一个几乎不知道的客户陷入深层次的技术问题Firefox 和 Opera 的区别）？

我已经找到了一个解决方案，我将成为与客户的接口，客户将参与计划会议等，并且团队仍将在其中进行演示。但是关于开发团队和客户之间的持续沟通（每天），我将是负责沟通的人。

我知道这不是最佳解决方案——作为中间人，很多信息会在客户、我和团队之间消失。有没有人遇到过类似的情况？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T10:07:16.883

创建一个维基。为您的客户创建一个页面，其中包含图片、业务信息、注意事项等。

让每个人都为 wiki 做出贡献，包括客户。

随着时间的推移，此页面（或如果您将信息拆分为多个页面的页面）将允许

*   新开发人员可以更快地了解客户
*   查看可能出现的问题
*   您的开发人员会为 wiki 做出贡献，因为他们有一个有形的文档，每个人都可以看到他们为客户做出了多少贡献。
*   让客户感觉好像他是开发过程的一部分
*   由于 wiki 实际上是一个协作文档，因此每个人之间都会出现一种共同语言。它可能与说您的客户的语言不同，但它将是您的客户和开发人员的语言的组合。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T21:18:08.697

当我们为特定客户执行“测试计划”时，我们遇到了类似的情况。当客户有问题时，他们只能在项目的那个阶段求助于开发人员，因为例如帮助台还不熟悉新功能。

我们还使用了一个“中间人”来与客户进行沟通，然后将其传递给开发人员，这对我们来说效果很好。有什么好处？客户总是很清楚该联系谁，沟通是一致的，一些更简单的问题可以得到回答，而不需要完全“bug”开发团队，而一些更困难的问题可以从多余的解释中“归结”到在将问题交给开发人员之前解决真正的问题，既让开发人员有更多时间专注于他们最擅长的事情。

当然，如果你想让它工作，你必须确保及时在开发人员和客户之间传递信息，但我认为这是值得的（事实上，我们的开发人员更喜欢这样方式）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T13:55:08.280

沟通技巧可以说比技术技能更重要。一个沟通不畅的程序员很可能会造成足够的干扰，从而否定他们在技术上带来的东西。

话虽如此，您仍然必须意识到，并非每个人都是“面向客户”的最佳人选。您可以指定团队中的一名或多名成员作为与客户的联络人，并在可能的情况下通过他们进行沟通。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T15:13:57.617

开发人员应与客户隔离。开发人员通常是早餐吃 C++ 模板的铁杆技术人员。客户通常非常不懂技术。客户就一些琐碎的问题向开发人员提出了一个表述不当的问题，这通常会激怒开发人员，至少会导致暂时的生产力损失。所以最好让有特殊报酬的人在两者之间工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T10:01:31.573

不要低估在同一个地方的价值。如果缺乏沟通技巧，能够指出并说“看看这个”会比试图在会议或电子邮件中解释所有内容更快、更有效。但是从“他们认为我们是他们自己的部门，只是坐在其他地方”，这听起来不像是你的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T10:09:55.503

一般来说，我希望至少有一些开发人员愿意学习与客户进行适当的沟通。让这些开发人员参与沟通（即使一开始很痛苦）。英语是一种非常通用的语言，您的客户可能会并且愿意说它。

屏蔽不想与客户交流或学习交流的开发者。它们可能会损害您与客户的关系，并且会损害您与员工的关系。

请注意允许客户和您的开发人员之间进行书面联系。书面交流经常被误解，尤其是当那些没有太多经验的人写出仔细平衡的电子邮件、备忘录或信件时。

随着您与客户建立关系，您将了解彼此的个性，并且沟通会更加顺畅。

# asp.net - 作为使用 Visual Studio 的 ASP.NET Web 开发人员，我应该安装 IIS 吗？

> ID：457082
> 
> 赞同：6
> 
> 时间：2009-01-19T10:00:08.347
> 
> 标签：asp.net, visual-studio-2008

我们使用 Visual Studio 进行 ASP.NET 开发。

我们刚刚讨论过的一个问题是我们的开发人员是否应该安装 IIS。

使用 ASP.NET 开发服务器，您可以在没有 IIS 的情况下运行 Web 应用程序。一旦您对所有内容感到满意，您就可以将其部署到运行 IIS 的测试服务器，然后再部署到 Live。

在我看来，所有开发人员也应该在他们自己的机器上安装 IIS，因为这最终将成为应用程序的最终平台。

这些争论基本上是开发人员是否应该拥有尽可能接近“实时”的环境，或者开发人员是否应该只拥有他们需要的工具，而不是被其他东西弄得乱七八糟。

这些都不是关键任务，我相信每个人都会有不同的意见。我只是有兴趣听听其中的一些！

罗宾

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T11:04:59.650

我会毫不含糊地说**是**的。IIS 和 Cassini*不*一样，不将代码暴露在生产环境中可能会导致[问题](https://stackoverflow.com/questions/305830/what-is-cassinis-aka-vs-dev-server-stack-limit)。最好尽早让自己养成这个习惯。

*（显然你可以用“Apache”或任何你的网络服务器技术替换“IIS”）*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T10:11:22.007

我想说你不需要安装 IIS，但你应该在某个时候在 IIS 上进行测试。

开发 Web 服务器有两个“问题”：

*   它仅适用于本地请求
*   所有请求都通过 ASP.net

特别是第二点可以真正打开射击你的脚的方法。“为什么人们可以访问 SuperSecretPicture.jpg？我的 Web.config 中有一个处理程序可以阻止它！”。

但是，如果您了解这些限制，那么我发现开发 Web 服务器更好地开始，因为您可以首先关注您的代码，然后关注您的环境，但 YMMV。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T10:14:13.983

底线是如果您的应用程序由 IIS 提供服务，那么您应该在 IIS 上进行测试。如果这意味着您的本地计算机或开发服务器上的 IIS 取决于您。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T10:22:18.473

安装它有什么危害？至少如果您安装了它，您可以选择使用或不使用它。您需要从外部托管的应用程序调试 Web 服务调用的那一天，您不想在安装它时搞乱。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T10:30:40.017

取决于 - 您是否为您的开发盒运行服务器版本的 Windows？

因为，例如XP版本的IIS与2000/2003服务器不同，所以你会得到不同的体验。同样，如果您在 Vista 上进行开发但计划在 2003 上进行部署，这将不是一个“完整”的体验。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T10:12:28.040

出于开发目的，我们在本地机器上安装了 IIS。我们需要针对 IIS 测试 Web 应用程序，但我们也不想将其发布到我们的实时服务器或我们的测试服务器，因为这需要大量工作。相反，我们只是在本地托管它，每次通过 Visual Studio 修改文件时，我们都可以立即看到更改，而无需通过文件复制过程。

我认为这根本不是一件坏事，只要一切安全，你就会没事的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T10:42:05.157

理想情况下，您的测试服务器应该镜像您的生产服务器。这应该不言而喻。在我看来，你的开发环境应该尽可能接近，同时首先满足你的需求（我更喜欢让开发环境尽可能地自我维持，以防我与网络断开连接）。

我使用开发服务器进行开发没有问题，使用 IIS（本地或远程，视情况而定）进行测试 - 但这也取决于项目要求。例如，我更喜欢在本地 IIS 服务器上托管 Web 服务。YMMV。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T15:24:12.937

我们使用虚拟机在笔记本电脑上进行开发。这样，如果虚拟操作系统（或主机操作系统，就此而言）崩溃，您只需从网络（我们有备份的地方）复制您的 vpc 就可以了。此外，它使运行“标准”开发平台变得更容易，该平台尽可能接近生产。

对我们来说，我们必须安装 IIS，因为我们正在开发 Sharepoint '07 webparts。

# c# - 如何为我的 ASP.NET 文本框获取正确的 ClientID？

> ID：457117
> 
> 赞同：2
> 
> 时间：2009-01-19T10:09:53.833
> 
> 标签：c#, .net, asp.net, javascript, asp.net-3.5

我在创建的 ASP.NET 项目中创建了 Table 的一个子类。该表使用一个类来格式化和创建 TableRows 和 TableCells，我们可以称之为 RowCreator。所以 MyTable 调用 rowCreator.CreateRow() 并返回一个 TableRow 里面有很多好东西。

在这个 TableRow 中有一个 TextBox，它应该在 onblur 事件上触发一个 javascript 方法，它是由 RowCreator 类添加的。

`textBox.Attributes.Add("onblur", "javascriptMethod('" + textbox.ClientID + "');");`

我还尝试创建了一个 textBox 的子类，它实现了一个添加 onblur 事件的方法：

`Attributes.Add("onblur", "javascriptMethod('" + this + "');")`

这是行不通的。ID 只是文本框子类的命名空间。

并且 JavaScript 方法非常简单：

`function javascriptMethod(boxId) { alert(boxId); }`

问题是，我猜这是因为尚未将文本框控件添加到控件集合中，因此 boxId 不是正确的客户端 ID。它与服务器端 ID 相同。有没有一种方法可以获取正确的 ID，而无需先在页面上使用 Controls.Add 添加行？还有其他建议吗？

我什至这样做的原因是每当它被改变时从一个javascript函数中读取文本框内容。也许有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T10:16:14.260

您可以将 javascript 调用更改为：

```
textBox.Attributes.Add("onblur", "javascriptMethod(this);"); 
```

然后您可以在您的 javascript 方法中访问文本框：

```
function javascriptMethod(textbox) { alert(textbox.id); } 
```

这样您就不需要使用文本框控件的 ClientID。

# bash - $(...) 和 `...` 有什么区别

> ID：457120
> 
> 赞同：10
> 
> 时间：2009-01-19T10:10:20.527
> 
> 标签：bash, syntax

问题就像标题中所说的那样简单：以下两个表达式之间有什么区别？

```
$(...)
`...` 
```

例如，这两个变量是否`test1`不同`test2`？

```
test1=$(ls)
test2=`ls` 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T10:15:32.217

结果是一样的，但新的 $() 语法更清晰，更容易阅读。尝试筑巢时至少加倍如此。使用旧语法嵌套并不容易，但使用新语法可以正常工作。

比较：

```
$ echo $(ls $(pwd)) 
```

相对：

```
$ echo `ls \`pwd\`` 
```

您需要转义嵌入的反引号，因此打字和阅读都要复杂得多。

根据[此页面](http://tldp.org/LDP/abs/html/commandsub.html)，它们处理嵌入式双反斜杠的方式至少有一个细微差别。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T10:16:08.173

您可能想阅读`man bash`：

> 当使用旧式反引号形式的替换时，反斜杠保留其字面含义，除非后面跟着 $、` 或 . 前面没有反斜杠的第一个反引号终止命令替换。使用 $(command) 形式时，括号之间的所有字符组成命令；没有人受到特殊对待。

那在手册页的“命令替换”部分下。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-19T10:17:42.273

使用 `` 是历史语法，POSIX 采用了现在标准的 ` $(...) 语法。见[第 2.6.3 节](http://www.opengroup.org/onlinepubs/9699919799/nframe.html)

# .net - 如何从程序集中继承类而不强制用户引用两个程序集

> ID：457128
> 
> 赞同：2
> 
> 时间：2009-01-19T10:12:51.520
> 
> 标签：.net, inheritance, assemblies

我在两个不同的 .NET 程序集中有两个类 A 和 B：AssemblyA 和 AssemblyB。

我希望B类继承A类，但我希望它使用B类只需要引用AssemblyB（而不是AssemblyA和AssemblyB）。

由于项目限制，我需要将两个程序集分开，所以我不能使用合并工具来合并这两个程序集。

请注意，类的实际继承不是必须的——我希望能够在 AssemblyB 中运行来自 A 的逻辑，作为 B 类的一部分，并且尽可能少地重写功能。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T10:18:15.800

不。这样想 - 假设你我输入以下内容：

```
public class B : A
{
      public void Foo()
      {
            this.// Cursor is here
      }
} 
```

如果 Intellisense 不知道 A 类中的内容，您如何期望它知道可用的内容？编译器如何能够验证方法调用等？

您*必须*了解继承链的所有父类。这意味着引用这两个项目。如果您不想这样做，请不要使用继承 - 让 B 组成 A 而不是从它派生。用户在执行时仍然需要 A 的二进制文件，但我*认为*他们不需要在 Visual Studio 中添加引用。（另一方面，如果他们要调试代码，他们可能无论如何都想确保二进制文件在正确的位置......）

# c - 从哪里开始（自学）C，或者我应该学习一门不同的语言？

> ID：457129
> 
> 赞同：14
> 
> 时间：2009-01-19T10:13:42.283
> 
> 标签：c

最近，我越来越多地发现，拥有广泛的编程基础知识是件好事。遗憾的是，我是（众多）自学成才的 PHP 开发人员之一，并且不后悔选择了这条路。

但是，我仍然认为我应该从零开始将我的知识扩展到一些“真正的”编程语言，并从那里积累我的知识。我无意改变我的职业道路，但我确实认为跳出网络开发的框框思考会很好。

我宁愿不上课或上课，因为我根本没有时间做这件事。所以：

*   **从零级开始，逐步自学 C 的最佳方法是什么？**

*   **由于我的主要目标是学习更多的编程基础知识，C 甚至是一个不错的选择吗？**

*   **如果不是，那会是什么语言？**

* * *

**到目前为止的总结：**

首先，感谢所有伟大的回应。这些将非常有帮助。尽管大多数人似乎都同意从 C 开始并不是一个糟糕的选择，但我也看到有人说**跳过 C 并使用 C++ 甚至 C#**可能是一个更好的主意，因为这些语言更流行。

**我个人的观点仍然是****从零级开始**会很好，即使语言本身并没有*直接*对我所做的事情做出贡献。我仍然相信它会*间接地*让我成为一个更好的程序员。但是话又说回来，就像说过的那样，我对这些语言的了解非常有限，所以我也很想听听**您**对此事的看法。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-19T10:16:04.120

阅读[Kernighan 和 Ritchie](http://en.wikipedia.org/wiki/The_C_Programming_Language_(book)) “C 编程语言”。这是经典。

这是该语言的原始创造者所写的书。它很短，可读性很好，写得很好。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-19T10:22:46.350

我不得不不同意前两个推荐著名的“K&R”指南的答案。我完全无法从那本书中学到任何东西。我在读了这本书的前三分之一大约三遍后就放弃了。也许我只是个笨蛋。

相反，我建议阅读这本精彩的书：[C Programming: A Modern Approach](https://rads.stackoverflow.com/amzn/click/com/0393979504)（免责声明：amazon 链接）

我从那本书中学到了我需要了解的关于 C 的所有知识，它涵盖了所有需要完成的历史，同时仍然保持“现代”的观点。

警告：我不是“为 C”来 C 语言的，我通过它来实现我的最终目标，在 Apple 的 Mac OS X 上为桌面应用程序编写 Objective-C 和 Cocoa 编程。如果你真的想要非常深入的知识C，把上面提到的两本书都拿到了，读完Modern C再读K&R指南可能没坏处

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-19T10:15:41.420

我学习 C 的第一步是一本《The C Programming Language》——这是一本简单的书，但语言本身非常简单。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-23T18:05:28.673

好吧，如果您想“从零级开始”，我建议您学习汇编。是的组装。我学了6502，喜欢的可以学x86或者arm或者mips。找一个模拟器或中断器并阅读一些教程。您将准确了解 CPU 的工作原理，并且代码将更有意义（例如为什么 getkeys 在您执行 pollkeys 等之前不会更新）。

之后我推荐 C#，因为它不像 c/c++ 那样讨厌（我主要使用 c++）。您将了解如何在汇编中表示 C# 行。与 c 和 c++ 不同，C# 允许您做更多您想做的事情（这里列出了我们可以在 c++ 中做的事情，我们将在下一个标准[http://en.wikipedia.org/wiki/ C%2B%2B0x](http://en.wikipedia.org/wiki/C%2B%2B0x)，C# 有一些）。

如果您想学习很多东西，可以尝试学习我在这里推荐的语言[https://stackoverflow.com/questions/498964/the-difficulty-in-learning-new-languages-by-yourself/578618#578618](https://stackoverflow.com/questions/498964/the-difficulty-in-learning-new-languages-by-yourself/578618#578618)我认为组装后是个好主意。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-19T10:21:30.847

如果您会说德语，我建议您[阅读 Galileo Computing 的一本开放书](http://openbook.galileocomputing.de/c_von_a_bis_z/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-19T10:19:50.740

如果您想学习编程基础知识，另一个选择是阅读 Knuth 的[The Art of Computer Programming](http://en.wikipedia.org/wiki/The_Art_of_Computer_Programming)。这将从一开始就向您介绍基础知识。为了进一步理解，请自己在 C 中实现算法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-19T10:23:20.173

印第安纳大学和普渡大学有关于 C 编程的大学课程。该课程有视频讲座，您可以在[此处](http://wally.cs.iupui.edu/n305/)找到。

如果您也对 C++ 感兴趣，可以在[Web Lecture Archive Project](http://www.wlap.org/)中找到一堆名为“C++ for Particle Physicists”的讲座。[你可以在这里](http://www.wlap.org/cern/lectures/tech/c/)找到那些讲座。讲座由斯坦福大学的 Paul Kunz 主持。

如需更多 C++ 讲座，您还可以查看Reconnect Networks 中的[这些讲座](http://www.youtube.com/user/reconnetworks)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-19T10:18:18.857

C是主流教育的不错选择。然而，在阅读书籍之前，我会先学习一些 IDE 教程，这样你才能掌握构建项目和 makefile 的窍门，这两个将是你最初将面临的最大挑战，而且很少在任何书籍中涉及它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-19T10:24:01.090

阅读“C 编程语言”。写一些简短的练习（有些在书中）。使用编译器，例如[gcc](http://gcc.gnu.org/)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-19T10:28:00.413

*C 编程语言*是一个很好的起点。

此外，C 本身是学习编程基础的良好起点：您几乎可以在任何地方找到 C 软件和 C 开发人员，并且许多其他语言都植根于 C，例如 C++、C#、Objective-C...

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-19T12:10:39.347

在阅读了许多人建议的“C 编程语言”之后，我将开始研究开源项目并从实际示例中学习。有很多，而且很难找到合适的，但是从阅读好的代码中学习是向好的编码员学习的最佳选择:)
如果你身边有一个：结对编程或只是相互代码审查是最好的学习方式.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-19T12:30:04.613

1) C 编程语言 K&R 2) 阅读大量 C 源代码。[谷歌代码搜索](http://www.google.com/codesearch)

就这些。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-22T23:14:47.347

如果您想阅读一些好的源代码，我可以衷心推荐 Simon Tatham 的拼图合集（[http://www.chiark.greenend.org.uk/~sgtatham/puzzles/](http://www.chiark.greenend.org.uk/~sgtatham/puzzles/)，向下滚动到底部以获取开发人员文档）。从中，你可以学到：

*   如何在 C 中进行类似面向对象的编程（从某种意义上说，每个游戏都是一个实现“游戏”接口的类）。
*   如何编写可移植的 C（将所有不可移植的东西隐藏在您自己的界面后面）。
*   如何评论和记录您的代码。
*   如何在 C 中进行 GUI 编程。
*   如何在 C 中实现数据结构（我记得联合查找和 2-4 棵树正在完成）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-19T14:42:47.917

我相信你目前的做法是不正确的。C 目前是 C++ 的一个子集，没有现代 OO 语言的许多概念。在大多数情况下，它被归入遗留系统，大多数与遗留代码无关的新开发不是用 C 编写的。就我个人而言，我从 C++（自学）开始，然后转向 C#。从 C++ 开始为您提供了了解面向对象以及低级别发生的事情所需的所有基础知识。但是，对于刚入门的人，我现在推荐 C#，原因很简单，即它更容易起步并开始运行。此外，c# 中的一些概念在 C 世界中几乎没有类似物，并且使编程更加直观（LINQ、lambdas 等）。虽然内存管理很重要（偶尔会出现在 C# 中），但管理起来很痛苦，并且在您启动时更容易不用担心。你越早开始一个有趣的项目，你放弃的可能性就越小。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-10-19T08:33:47.193

1)[克尼根和里奇](http://cm.bell-labs.com/cm/cs/cbook/)

2)[编写可靠的代码](https://rads.stackoverflow.com/amzn/click/com/1556155514)

3)[代码完成](http://cc2e.com/)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-10-19T08:22:03.943

**关于学习 C**

如果你真的想学习 C，[Kernighan 和 Ritchie “The C Programming Language”一书]( [http://en.wikipedia.org/wiki/The_C_Programming_Language_(book))](http://en.wikipedia.org/wiki/The_C_Programming_Language_(book)))是一个很好的开始。

然而现在，在我看来，学习 C 只是一种思维练习——你可以学习很多重要的细节，例如：

1.  `==`等号运算符 ( ) 和赋值指令 ( ) 的区别`=`，
2.  表达式可以有值（即`a = 1`有值 1），
3.  指针算术，
4.  直接内存操作（即`memset()`, `memcpy()`）。

这些东西对于开发者来说是很有趣的，但是它们中的大部分在今天的主流应用程序开发中都没有使用（除了上面的两个第一点）。

但是，如果您尝试参加一些计算机竞赛，C 语言可能会很有用。

**我的推荐**

我会学习 C#，因为它是现代的、精心设计的（在我看来）面向对象的编程语言，具有良好的免费 IDE—— [Visual Studio 速成版](http://www.microsoft.com/exPress/)，良好的支持（广泛的社区，大量的源代码要研究，很多教程和示例）。使用 C#，您可以编写控制台应用程序、桌面应用程序或 Web 应用程序，通过解决广泛的实际问题使学习变得容易。

此外，在 .NET 平台上还有其他一些有趣的选择—— [IronPyton](http://www.codeplex.com/wikipage?ProjectName=IronPython)或功能性[F#](http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/)。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2009-01-19T10:21:06.887

Let us C by Yeshvant P Kanitkar

# c# - Dictionary 上 .NET 二进制序列化的奇怪行为

> ID：457134
> 
> 赞同：17
> 
> 时间：2009-01-19T10:15:20.923
> 
> 标签：c#, .net, serialization, dictionary, binary

至少在我的预期中，我在 .NET 的二进制序列化中遇到了一个奇怪的行为。

a 的所有加载项都在回调`Dictionary`之后添加到它们的父项。`OnDeserialization`反之`List`则相反。这在现实世界的存储库代码中可能真的很烦人，例如当您需要向字典项添加一些委托时。请检查示例代码并观察断言。

这是正常行为吗？

```
[Serializable]
public class Data : IDeserializationCallback
{
    public List<string> List { get; set; }

    public Dictionary<string, string> Dictionary { get; set; }

    public Data()
    {
        Dictionary = new Dictionary<string, string> { { "hello", "hello" }, { "CU", "CU" } };
        List = new List<string> { "hello", "CU" };
    }

    public static Data Load(string filename)
    {
        using (Stream stream = File.OpenRead(filename))
        {
            Data result = (Data)new BinaryFormatter().Deserialize(stream);
            TestsLengthsOfDataStructures(result);

            return result;
        }
    }

    public void Save(string fileName)
    {
        using (Stream stream = File.Create(fileName))
        {
            new BinaryFormatter().Serialize(stream, this);
        }
    }

    public void OnDeserialization(object sender)
    {
        TestsLengthsOfDataStructures(this);
    }

    private static void TestsLengthsOfDataStructures(Data data)
    {
        Debug.Assert(data.List.Count == 2, "List");
        Debug.Assert(data.Dictionary.Count == 2, "Dictionary");
    }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-19T10:43:31.147

是的，您在`Dictionary<TKey, TValue>`反序列化中发现了一个恼人的怪癖。您可以通过手动调用字典的`OnDeserialization()`方法来解决它：

```
public void OnDeserialization(object sender)
{
    Dictionary.OnDeserialization(this);
    TestsLengthsOfDataStructures(this);
} 
```

顺便说一句，您也可以使用`[OnDeserialized]`属性而不是`IDeserializationCallback`：

```
[OnDeserialized]
public void OnDeserialization(StreamingContext context)
{
    Dictionary.OnDeserialization(this);
    TestsLengthsOfDataStructures(this);
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-19T10:42:37.153

我可以重现这个问题。环顾谷歌，发现：[http](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=94265) ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=94265虽然我不确定这是完全相同的问题，但它似乎非常相似。

编辑：

我认为添加此代码可能已经解决了问题？

```
 public void OnDeserialization(object sender)
    {
            this.Dictionary.OnDeserialization(sender);
    } 
```

没有时间进行详尽的测试，我想击败 Marc 得到答案 ;-)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T10:42:18.183

有趣...对于信息，我尝试使用基于属性的方法（如下），它的行为相同...非常好奇！我无法解释 - 我只是回复确认转载，并提及`[OnDeserialized]`行为：

```
[OnDeserialized] // note still not added yet...
private void OnDeserialized(StreamingContext context) {...} 
```

编辑 - 在[这里](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=94265)找到“连接”问题。尝试添加到您的回调：

```
Dictionary.OnDeserialization(this); 
```

# php - 如何使用 PHP XML Dom 中的属性值删除特定节点？

> ID：457153
> 
> 赞同：1
> 
> 时间：2009-01-19T10:21:19.660
> 
> 标签：php, xml, dom, xml-attribute

我的问题是最好的短语： [Remove a child with a specific attribute, in SimpleXML for PHP](https://stackoverflow.com/questions/262351/remove-a-child-with-a-specific-attribute-in-simplexml-for-php)

除了我没有使用 simpleXML。

我是 PHP 的 XML 新手，所以我可能不是最好的方法

我为每个单独的用户使用 $dom->save($xml) 创建了一个 xml。（由于未公开的原因，未将所有内容放在一个 xml 中）

它给了我那个 xml 声明`<?xml version="1.0"?>`（不知道如何将它传递给其他人，但这不是重点，希望如此）

```
<?xml version="1.0"?>
<details>
 <person>name</person>
 <data1>some data</data1>
 <data2>some data</data2>
 <data3>some data</data3>
 <category id="0">
  <categoryName>Cat 1</categoryName>
  <categorydata1>some data</categorydata1>
 </category>
 <category id="1">
  <categoryName>Cat 2</categoryName>
  <categorydata1>some data</categorydata1>
  <categorydata2>some data</categorydata2>
  <categorydata3>some data</categorydata3>
  <categorydata4>some data</categorydata4>
 </category>
</details> 
```

当我运行一个使用删除按钮激活的函数时，我想删除一个具有名为 id 的特定属性和 php 中的 DOM 类的类别。

以下是我试图开始工作的函数的调试。我能知道我做错了什么吗？

```
function CatRemove($myXML){
        $xmlDoc = new DOMDocument();
        $xmlDoc->load( $myXML );
        $categoryArray = array();

        $main = $xmlDoc->getElementsByTagName( "details" )->item(0);

        $mainElement = $xmlDoc->getElementsByTagName( "details" );
        foreach($mainElement as $details){
            $currentCategory = $details->getElementsByTagName( "category" );
            foreach($currentCategory as $category){
                $categoryID = $category->getAttribute('id');
                array_push($categoryArray, $categoryID);
                if($categoryID == $_POST['categorytoremoveValue']) {
                    return $categoryArray;
                }
            }
        }

        $xmlDoc->save( $myXML );
    } 
```

好吧，当我将返回插入 if 之外时，上面一直打印出一个 [0]->0 的数组。有没有更好的办法？我也尝试过使用 getElementbyId ，但我不知道如何工作。

我宁愿不使用属性，但如果这会使事情变得更容易。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T16:10:51.937

好的，让我们试试这个完整的使用示例：

```
function CatRemove($myXML, $id) {
    $xmlDoc = new DOMDocument();
    $xmlDoc->load($myXML);
    $xpath = new DOMXpath($xmlDoc);
    $nodeList = $xpath->query('//category[@id="'.(int)$id.'"]');
    if ($nodeList->length) {
        $node = $nodeList->item(0);
        $node->parentNode->removeChild($node);
    }
    $xmlDoc->save($myXML);
}

// test data
$xml = <<<XML
<?xml version="1.0"?>
<details>
 <person>name</person>
 <data1>some data</data1>
 <data2>some data</data2>
 <data3>some data</data3>
 <category id="0">
  <categoryName>Cat 1</categoryName>
  <categorydata1>some data</categorydata1>
 </category>
 <category id="1">
  <categoryName>Cat 2</categoryName>
  <categorydata1>some data</categorydata1>
  <categorydata2>some data</categorydata2>
  <categorydata3>some data</categorydata3>
  <categorydata4>some data</categorydata4>
 </category>
</details>
XML;
// write test data into file
file_put_contents('untitled.xml', $xml);
// remove category node with the id=1
CatRemove('untitled.xml', 1);
// dump file content
echo '<pre>', htmlspecialchars(file_get_contents('untitled.xml')), '</pre>'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T10:41:22.710

所以你想删除`category`一个特定的节点`id`？

```
$node = $xmlDoc->getElementById("12345");
if ($node) {
    $node->parentNode->removeChild($node);
} 
```

您还可以使用 XPath 来获取节点，例如：

```
$xpath = new DOMXpath($xmlDoc);
$nodeList = $xpath->query('//category[@id="12345"]');
if ($nodeList->length) {
    $node = $nodeList->item(0);
    $node->parentNode->removeChild($node);
} 
```

我没有测试过它，但它应该可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:07:30.253

你可以试试这个修改后的版本：

```
function CatRemove($myXML, $id){
    $doc = new DOMDocument();
    $doc->loadXML($myXML);
    $xpath = new DOMXpath($doc);
    $nodeList = $xpath->query("//category[@id='$id']");
    foreach ($nodeList as $element) {
        $element->parentNode->removeChild($element);
    }

    echo htmlentities($doc->saveXML());
} 
```

它对我有用。只需根据您的需要进行调整。它不打算按原样使用，而只是概念证明。您还必须从字符串中删除 xml 声明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-12T12:03:29.597

修改上述功能以从邮件列表中删除电子邮件

```
function CatRemove($myXML, $id) {
    $xmlDoc = new DOMDocument();
    $xmlDoc->load($myXML);
    $xpath = new DOMXpath($xmlDoc);
    $nodeList = $xpath->query('//subscriber[@email="'.$id.'"]');
    if ($nodeList->length) {
        $node = $nodeList->item(0);
        $node->parentNode->removeChild($node);
    }
    $xmlDoc->save($myXML);
}
$xml = 'list.xml';
$to = $_POST['email'];//user already submitted they email using a form 
CatRemove($xml,$to); 
```

# asp.net - ASP.NET 中移动设备的日历（日期选择器）控件

> ID：457157
> 
> 赞同：1
> 
> 时间：2009-01-19T10:22:41.453
> 
> 标签：asp.net, mobile, calendar, datepicker, mobile-website

我正在寻找适用于移动设备的日历控件（[又名](http://en.wiktionary.org/wiki/AKA)日期选择器）。问题是大多数设备都没有 JavaScript，或者 JavaScript 支持很差。

[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)的内置控件使用 JavaScript 进行回发。ASP.NET 有一个移动日历控件，但它不是完全可本地化的（在显示逐步日期选择器的低端设备上，它的按钮始终是英文的）。

我正在考虑覆盖内置日历控件以直接用参数化链接替换 ​​JavaScript 回发。

我的*复合*问题是-

有没有一种很好的无 JavaScript 日历控件，一种在 ASP.NET 的内置控件中摆脱 JavaScript 的方法，或者一种本地化 ASP.NET 的移动日历控件的方法？

如果以上所有内容都不存在，那么用参数化链接替换回发是一个好方法吗？其他建议是什么？

目前，我不关心格式 - 我的目标设备可以很好地显示日期选择器。我只关心让它工作的小问题......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-19T10:42:58.463

您可以生成一些下拉 ( `<select>`) 框并将它们用作简单的日期选择器。不过，您需要进行一些服务器端验证，因为没有 JavaScript 意味着用户可以选择无效的日期（例如，2 月 31 日）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-15T21:01:19.847

我最终做的是构建一个自定义日历控件。

目前，我使用了一张桌子，但当我想支持更多设备时，它必须改变。因为我的目标是从右到左的语言，所以一张桌子已经很痛苦了。

@troelskn - 我没有选择，`<select>`因为他们不适合使用移动设备的用户，但感谢您的建议。

# arrays - 从排序的字符串数组中找到第一个前缀匹配的最有效算法？

> ID：457160
> 
> 赞同：16
> 
> 时间：2009-01-19T10:23:41.107
> 
> 标签：arrays, string, algorithm, sorting, search

输入：

1）一个巨大的字符串SA排序数组；

2）一个前缀字符串P；

输出：

匹配输入前缀的第一个字符串的索引（如果有）。如果没有这样的匹配，那么输出将为-1。

例子：

```
SA = {"ab", "abd", "abdf", "abz"}
P = "abd" 
```

输出应为 1（索引从 0 开始）。

做这种工作的最算法方法是什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-19T10:48:22.477

如果您只想这样做一次，请使用[二分搜索](http://en.wikipedia.org/wiki/Binary_search)，另一方面，如果您需要对许多不同的前缀但在同一个字符串数组上执行此操作，则在构建基数树之后构建[基数树](http://en.wikipedia.org/wiki/Radix_tree)可能是一个好主意树每次查找都会非常快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T10:27:30.693

这只是修改后的二分搜索：

*   只检查每个元素中与搜索字符串中一样多的字符；和
*   如果找到匹配项，请继续向后搜索（线性搜索或通过进一步的二分搜索），直到找到不匹配的结果，然后返回最后一个匹配结果的索引。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T10:28:43.623

可以使用[Suffix Tree](http://en.wikipedia.org/wiki/Suffix_tree)在线性时间内完成。构建后缀树需要线性时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T10:27:14.300

FreeBSD 内核使用[基数树](http://en.wikipedia.org/wiki/Radix_tree)作为其路由表，您应该检查一下。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T10:36:11.427

我目前考虑的解决方案是，尝试查找“虚拟前缀”，而不是查找“前缀”。

例如，前缀是“abd”，尝试查找虚拟前缀“abc(255)”。(255) 仅表示最大字符数。找到“abc(255)”后。如果有的话，下一个单词应该是匹配“abd”的第一个单词。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T17:36:24.620

您是否可以预先计算所有可能的前缀？

如果是这样，您可以这样做，然后使用二进制搜索在预先计算的表中查找前缀。将下标存储为带有前缀的所需值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-02-15T07:20:07.777

**我的解决方案：** 使用二进制搜索。

```
private static int search(String[] words, String searchPrefix) {

        if (words == null || words.length == 0) {
            return -1;
        }
        int low = 0;
        int high = words.length - 1;
        int searchPrefixLength = searchPrefix.length();

        while (low <= high) {
            int mid = low + (high - low) / 2;

            String word = words[mid];
            int compare = -1;

            if (searchPrefixLength <= word.length()) {
                compare = word.substring(0, searchPrefixLength).compareTo(searchPrefix);
            }

            if (compare == 0) {
                return mid;
            } else if (compare > 0) {
                high = mid - 1;
            } else {
                low = mid + 1;
            }

        }
        return -1;
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-04-01T16:04:20.403

这是一个可能的解决方案（在 Python 中），它具有*O(k.log(n))*时间复杂度和*O(1)*额外空间复杂度（考虑 n 个字符串和 k 个前缀长度）。

执行仅考虑字符串的给定字符索引的二进制搜索背后的基本原理。如果这些存在，则继续下一个字符索引。如果在任何字符串中都找不到任何前缀字符，则立即返回。

```
from typing import List

def first(items: List[str], prefix: str, i: int, c: str, left: int, right: int):
    result = -1

    while left <= right:
        mid = left + ((right - left) // 2)
        if ( i >= len(items[mid]) ):
            left = mid + 1
        elif (c < items[mid][i]):
            right = mid - 1
        elif (c > items[mid][i]):
            left = mid + 1
        else:
            result = mid
            right = mid - 1

    return result

def last(items: List[str], prefix: str, i: int, c: str, left: int, right: int):
    result = -1

    while left <= right:
        mid = left + ((right - left) // 2)
        if ( i >= len(items[mid]) ):
            left = mid + 1
        elif (c < items[mid][i]):
            right = mid - 1
        elif (c > items[mid][i]):
            left = mid + 1
        else:
            result = mid
            left = mid + 1

    return result

def is_prefix(items: List[str], prefix: str):
    left = 0
    right = len(items) - 1
    for i in range(len(prefix)):
        c = prefix[i]
        left = first(items, prefix, i, c, left, right)
        right = last(items, prefix, i, c, left, right)

        if (left == -1 or right == -1):
            return False

    return True

# Test cases
a = ['ab', 'abjsiohjd', 'abikshdiu', 'ashdi','abcde Aasioudhf', 'abcdefgOAJ', 'aa', 'aaap', 'aas', 'asd', 'bbbbb', 'bsadiojh', 'iod', '0asdn', 'asdjd', 'bqw', 'ba']
a.sort()
print(a)
print(is_prefix(a, 'abcdf'))
print(is_prefix(a, 'abcde'))
print(is_prefix(a, 'abcdef'))
print(is_prefix(a, 'abcdefg'))
print(is_prefix(a, 'abcdefgh'))
print(is_prefix(a, 'abcde Aa'))
print(is_prefix(a, 'iod'))
print(is_prefix(a, 'ZZZZZZiod')) 
```

此要点可在[https://gist.github.com/lopespm/9790d60492aff25ea0960fe9ed389c0f获得](https://gist.github.com/lopespm/9790d60492aff25ea0960fe9ed389c0f)

# sql-server - 语法错误：通用插入的存储过程

> ID：457166
> 
> 赞同：0
> 
> 时间：2009-01-19T10:28:30.350
> 
> 标签：sql-server, visual-studio, sql-server-2005, stored-procedures

我在编译这段代码时遇到问题..谁能告诉语法有什么问题

```
CREATE PROCEDURE spGenericInsert
    (
        @insValueStr nvarchar(200)  
        @tblName nvarchar(10) 
    )

AS

BEGIN

    DECLARE @insQueryStr nvarchar(400)
    DECLARE @insPrimaryKey nvarchar(10)
    DECLARE @rowCountVal integer
    DECLARE @prefix nvarchar(5)

    IF @tblName='HW_Master_DB'
        SET @rowCountVal=(SELECT COUNT(*) FROM HW_Master_DB)
    ELSE IF @TableName='SW_Master_DB'
        SET @rowCountVal=(SELECT COUNT(*) FROM SW_Master_DB)
    ELSE IF @TableName='INV_Allocation_DB'
        SET @rowCountVal=(SELECT COUNT(*) FROM INV_Allocation_DB)
    ELSE IF @TableName='REQ_Master_DB'
        SET @rowCountVal=(SELECT COUNT(*) FROM REQ_Master_DB)

    IF @tblName = 'DEFECT_LOG' 
        SET @prefix='DEF_'
    ELSE IF @tblName='INV_Allocation_DB'
        SET @prefix='INV_'
    ELSE IF @tblName='REQ_Master_DB'
        SET @prefix='REQ_'
    ELSE IF @tblName='SW_Master_DB'
        SET @prefix='SWI_'
    ELSE IF @tblName='HW_Master_DB'
        SET @prefix='HWI_'  

    SET @insPrimaryKey= @prefix + RIGHT(replicate('0',5)+ convert(varchar(5),@rowCountVal),5) -- returns somethin like 'DEF_00005'

    SET @insQueryStr= 'INSERT INTO ' + @tblName + ' VALUES (' + @insPrimaryKey + ',' + @insValueStr + ')'

    EXEC(@insQueryStr)

END 
```

* * *

我知道整数标识列..但我必须在表中使用 AlphaNumeric ID 在高度多用户的 Intranet 系统中插入新值。

记录不会从表中删除。所以问题是保持同步插入记录与自动生成的 ID 字段。

任何建议如何做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T10:35:40.630

任君挑选：

*   `@TableName`未定义
*   `@tblName`对比`@TableName`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T10:39:06.147

我无法立即看出语法有什么问题（[Jonathan Lonowski 敏锐的眼光已经解决了这个问题](https://stackoverflow.com/questions/457166/problem-with-code-syntax-stored-procedure-for-generic-insert#457178)），但代码有一些问题：

1.  您创建动态 SQL，因此您的代码容易受到 SQL 注入攻击。两个输入参数都以危险的方式使用。通过为每个表创建一个存储过程来解决这个问题。因此，您不必再生成 SQL。

2.  没有检查表是否不在使用的列表中。

3.  您的主键生成算法可以/将在多用户场景中创建重复键，或者如果从表中删除行。通过使用[身份](http://msdn.microsoft.com/en-us/library/aa933196(SQL.80).aspx)列或您正在使用的数据库中的[某些其他功能来解决。](http://www.google.be/search?rlz=1C1GGLS_nlBE306BE306&aq=1&oq=sql+server+rowg&sourceid=chrome&ie=UTF-8&q=sql+server+rowguidcol)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T10:54:46.520

老实说，你似乎在为自己感到头疼。检查整数标识和[`IDENTITY`语法](http://msdn.microsoft.com/en-us/library/ms186775.aspx)。

除非您确实***需要***使用“DEF_00005”格式的密钥，否则它们会让您的生活更轻松。

```
CREATE TABLE DemoTable (
    Key INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    Value VARCHAR(200)
);

INSERT INTO DemoTable (Value) VALUES ('Something');

SELECT * FROM DemoTable;

  | Key | Value     |
  |-----|-----------|
  | 1   | Something | 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T10:35:53.017

除了遗漏很多分号之外，您还必须给我们更多信息才能继续。

实际上，SQL Server 可能不需要分号，所以忽略它...

但[这里](http://www.sql-server-performance.com/articles/dba/stored_procedures_basics_p1.aspx)是开始学习 SQL Server 中存储过程的好地方。您也可以在[Google 上搜索](http://www.google.com/search?q=sql+server+stored+procedure+tutorial)更多内容。

# c# - 如何在Sql server 中确定公共假期？

> ID：457176
> 
> 赞同：20
> 
> 时间：2009-01-19T10:34:07.467
> 
> 标签：c#, sql, sql-server

我有一个用 c# 编写的应用程序，不能在公共假期或周末运行。我环顾四周，没有找到任何地方（官方）提供未来 50 年的所有公共假期。

如果我能得到这些，我只需将它们批量插入到我的 sql server 假期表中并使用它。但是，我无法在任何地方找到这些数据。

有谁知道 Sql server 是否支持公共假期或某种算法来解决它们？或者有没有人有官方可以批量插入的地方。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-11-17T19:19:16.277

我只是通过互联网收集信息，然后用这种简单的方法来计算美国银行假日。

* * *

## 美国银行假期

## ============================

```
DECLARE @Year char(4)
, @Date datetime
, @Holiday datetime

SET @Year = 2010

---- New Years Day
SET @Date=CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-01-01' ) 
IF DATENAME( dw, @Date ) = 'Saturday'
    SET @Date=@Date-1
ELSE IF DATENAME( dw, @Date ) = 'Sunday'
    SET @Date=@Date+1
SELECT @Date [New Years Day], DATENAME( dw, @Date ) [DayOfWeek]

---- Martin L King's Birthday ( 3rd Monday in January )
SET @Date = CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-01-01' ) 
SET @Holiday = DATEADD( wk, DATEDIFF( wk, 0, dateadd( dd, 18-datepart( day, @Date ), @Date ) ), 0 ) -- 3rd Monday of the Month
SELECT @Holiday [Martin L King's Birthday], DATENAME( dw, @Holiday ) [DayOfWeek]

---- President’s Day ( 3rd Monday in February )
SET @Date = CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-02-01' ) 
SET @Holiday = DATEADD( wk, DATEDIFF( wk, 0, dateadd( dd, 18-datepart( day, @Date ), @Date ) ), 0 ) -- 3rd Monday of the Month
SELECT @Holiday [President’s Day], DATENAME( dw, @Holiday ) [DayOfWeek]

---- Memorial Day ( Last Monday in May )
SET @Date = CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-05-01' ) 
SET @Holiday = DATEADD( wk, DATEDIFF( wk, 0, dateadd( dd, 30-datepart( day, @Date ), @Date ) ), 0 ) -- 5th Monday of the Month
SELECT @Holiday [Memorial Day], DATENAME( dw, @Holiday ) [DayOfWeek]

---- Independence Day ( July 4 )
SET @Date=CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-07-04' ) 
IF DATENAME( dw, @Date ) = 'Saturday'
    SET @Date=@Date-1
ELSE IF DATENAME( dw, @Date ) = 'Sunday'
    SET @Date=@Date+1
SELECT @Date [Independence Day], DATENAME( dw, @Date ) [DayOfWeek]

---- Labor Day ( 1st Monday in September )
SET @Date = CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-09-01' ) 
SET @Holiday = DATEADD( wk, DATEDIFF( wk, 0, dateadd( dd, 6-datepart( day, @Date ), @Date ) ), 0 ) -- 1st Monday of the Month
SELECT @Holiday [Labor Day], DATENAME( dw, @Holiday ) [DayOfWeek]

---- Columbus Day ( 2nd Monday in October )
SET @Date = CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-10-01' ) 
SET @Holiday = DATEADD( wk, DATEDIFF( wk, 0, dateadd( dd, 12-datepart( day, @Date ), @Date ) ), 0 ) -- 2nd Monday of the Month
SELECT @Holiday [Columbus Day], DATENAME( dw, @Holiday ) [DayOfWeek]

---- Veteran’s Day ( November 11 )
SET @Date=CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-11-11' ) 
IF DATENAME( dw, @Date ) = 'Saturday'
    SET @Date=@Date-1
ELSE IF DATENAME( dw, @Date ) = 'Sunday'
    SET @Date=@Date+1
SELECT @Date [Veteran’s Day], DATENAME( dw, @Date ) [DayOfWeek]

---- Thanksgiving Day ( 4th Thursday in November )
SET @Date = CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-11-04' ) 
SET @Holiday = DATEADD( wk, DATEDIFF( wk, 0, dateadd( dd, 22-datepart( day, @Date ), @Date ) ), 0 )+3 -- 4th Thursday of the Month
SELECT @Holiday [Thanksgiving Day], DATENAME( dw, @Holiday ) [DayOfWeek]

---- Christmas Day ( December 25 )
SET @Date=CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-12-25' ) 
IF DATENAME( dw, @Date ) = 'Saturday'
    SET @Date=@Date-1
ELSE IF DATENAME( dw, @Date ) = 'Sunday'
    SET @Date=@Date+1
SELECT @Date [Christmas Day], DATENAME( dw, @Date ) [DayOfWeek]

---- New Years Eve Day
SET @Date=CONVERT( datetime, CONVERT(varchar, YEAR( @Year ) )+'-12-31' ) 
IF DATENAME( dw, @Date ) = 'Saturday'
    SET @Date=@Date-1
ELSE IF DATENAME( dw, @Date ) = 'Sunday'
    SET @Date=@Date+1
SELECT @Date [New Years Day], DATENAME( dw, @Date ) [DayOfWeek] 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-19T10:36:34.857

公众假期不是非常依赖于地区吗？

以编程方式，没有办法*计算*这一点。或者，您需要找到每个地区的官方假期列表。即便如此，你也不会得到你想要的粒度。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-19T10:39:59.890

据我所知，没有任何“官方”来源，这确实高度依赖于语言环境。您必须手动管理这些。一个好的来源似乎是：

[http://en.wikipedia.org/wiki/List_of_holidays_by_country](http://en.wikipedia.org/wiki/List_of_holidays_by_country)

即使在这种情况下，管理起来也非常棘手。例如，我住在比利时，该国不同地区有不同的假期。例如，与其他劳动力相比，政府工作人员有不同的假期，这是在相同的语言环境代码中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-19T10:47:54.647

在我们的应用程序中，我们将它作为用户配置的一部分。有一个地方供用户根据需要设置他们认为的公共假期/银行假期。为了便于使用，可以按往年的日期复制它们。这也使他们能够设置“自定义”公共假期，也许是公司将其视为假期但不是国家官方的一天……

然而，在程序上，绝对没有任何假设。它实际上只是一个用户维护的日期表。

（这包括英国，因为如上所述，一些假期会有所不同并且不是一成不变的，有时会有特殊的一次性日子。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-19T10:38:22.543

在接下来的 50 年里，公共假期很少。在一些国家，他们在接下来的几年里会出名，而在一些国家则不然。它们也因州甚至城市而异。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-19T11:32:15.867

有一个可用的网络服务——

[http://www.holidaywebservice.com/Holidays/servicesAvailable_HolidayService.aspx](http://www.holidaywebservice.com/Holidays/servicesAvailable_HolidayService.aspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-01-04T14:55:19.900

您可以使用 Nager.Date 库来计算公共假期。 [https://github.com/nager/Nager.Date](https://github.com/nager/Nager.Date)

努吉特

```
PM> install-package Nager.Date 
```

例子：

```
var publicHolidays = DateSystem.GetPublicHoliday(CountryCode.GB, 2017);
foreach (var publicHoliday in publicHolidays)
{
    var name = publicHoliday.LocalName;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-19T11:23:27.320

Ahhh, holiday calendars. The bane of any investment bank programmer's life. There's no way of doing it other than maintaining your own list, I'm afraid!

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-19T13:05:18.583

您将需要为此维护一个假期表。为了适当的国际化，您甚至需要为此维护哪些日子是周末，因为即使这样也不是通用的。同样，您可能需要按地区维护假期，以便您的程序知道伦敦的用户有休息日，但土耳其的用户没有。

这应该由用户完全配置。如您所知，公司所有者的生日可能是“标准”休息日。试着在网上找到那个假期。

最后，您不想存储 50 年的假期数据。它只会是不准确的，并且可能会减慢您的所有代码。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-02-26T18:54:33.080

对于我们在美国的许多人来说，有一个可以确定性计算的标准商务假期列表。

从 Vonpato 的代码中汲取灵感，我整理了一个 SQL 语句，该语句利用 SQL Server 2008 中的新窗口函数（ over(partition by ..) ）来确定一个月内第 N 个或最后一个工作日出现.

这应该针对“DimDate”运行，这是一个标准的日期维度表，例如在数据仓库中找到的。 [http://www.codeproject.com/Articles/647950/Create-and-Populate-Date-Dimension-for-Data-Wareho](http://www.codeproject.com/Articles/647950/Create-and-Populate-Date-Dimension-for-Data-Wareho)

```
SELECT 
    case 
        when DayNameOfWeek = 'Saturday' then dateadd(day, -1, FullDate) 
        when DayNameOfWeek = 'Sunday' then dateadd(day, 1, FullDate) 
    else FullDate end as 'Holiday Date'
FROM (
    select row_number() over (partition by DayNameOfWeek, MonthOfYear, CalendarYear order by FullDate) as WeekdayOrdinal,
    count(*) over (partition by DayNameOfWeek, MonthOfYear, CalendarYear ) as MaxOrdinal,    *  
    from DimDate  
) D
WHERE
        (D.[MonthName] = 'January'  and [DayOfMonth]  = 1)                                              /* New Years Day    */
    OR  (D.[MonthName] = 'January'  and DayNameOfWeek = 'Monday')   and WeekdayOrdinal = 3              /* MLK Day          */
    OR  (D.[MonthName] = 'February' and DayNameOfWeek = 'Monday')   and WeekdayOrdinal = 3              /* President's Day  */
    OR  (D.[MonthName] = 'May'      and DayNameOfWeek = 'Monday')   and WeekdayOrdinal = MaxOrdinal     /* Memorial Day     */
    OR  (D.[MonthName] = 'September' and DayNameOfWeek = 'Monday')  and WeekdayOrdinal = 1              /* Labor Day        */
    OR  (D.[MonthName] = 'October'  and DayNameOfWeek = 'Monday')   and WeekdayOrdinal = 2              /* Columbus Day     */
    OR  (D.[MonthName] = 'November' and [DayOfMonth] = 11)                                              /* Veteran's Day    */
    OR  (D.[MonthName] = 'November' and DayNameOfWeek = 'Thursday') and WeekdayOrdinal = 4              /* Thanksgiving     */
    OR  (D.[MonthName] = 'December' and [DayOfMonth]  = 25 )                                            /* Christmas        */
ORDER BY FullDate 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-07-28T23:23:07.923

对于那些在感恩节找不到 11 月最后一个星期四的人，我首先找到该月的最后一天，然后使用 WHILE() 循环减去一天并检查日期名称，直到日期名称为星期四：

```
DECLARE @LastThursday DateTime = DATEADD(s,-1,DATEADD(mm,DATEDIFF(m,0,CONVERT(datetime,CONVERT(varchar,YEAR(GETDATE()))+'-11-01'))+1,0))

WHILE DATENAME(weekday,@LastThursday) <> 'Thursday'
BEGIN
    SET @LastThursday = DATEADD(day,DATEDIFF(day,0,@LastThursday)-1,0)
END

SELECT @LastThursday 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-19T12:52:10.090

如果只是英格兰，那么您可以自己解决！你需要一个可靠的算法来确定复活节，否则我会说你可以在一小时内完成。

但你是指英国还是英国？因为苏格兰有不同的假期（圣诞节、除夕和圣安德鲁节），北爱尔兰、威尔士以及很可能的马恩岛和海峡群岛也应该以不同的方式进行交易。

如其他地方所述，一旦您的范围变宽，它就会变得更加复杂。有当地的假期，半天，银行开门但证券交易所不开门的日子，各种各样的恐怖。

如果你真的不能自己管理假期并且没有可以被赋予责任的用户，那么我建议回到你的“不能在公共假期运行”约束并寻找可能的方法删除...

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-19T11:23:57.633

In addition to allowing the user to configure what days are holidays, it would be nice if you allowed the user to select a calendar to import or even to subscribe to. [iCalShare](http://icalshare.com/index.php?topic=holidays) has a nice list. However, it's probably too much work for a feature that's merely nice.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-01T21:33:48.380

如果有帮助，我有一个文本文件，其中列出了为所有主要和次要金融中心定义的银行假日计算规则。通常的定义方式是按商业中心，如伦敦、纽约、法兰克福等地，而不是按国家/地区。作为一个例子，这里是伦敦和其他一些地方的规则和解释。如果有人想要全部，请告诉我。这批货最早应该从 1990 年到 2030 年工作。显然，在文件放在一起之后（我认为是 2006 年），它不会宣布任何新的假期。

```
/*
 *   This file describes holiday calendars in the following way:
 *  1\. The "n"th "dow" in the month "m", means the 3rd Wednesday in August = "ALWAYS,3,WED,AUG"
 *  2\. The last etc "dow" in month "m", e.g. the last Monday in June = "LAST,MON,JUN"
 *  3\. A set date which if on a Sat or Sun is taken on the Monday, eg 13th Aug. = "FWDFROM,13,AUG"
 *  4\. A set date which if on a Sat is taken on Fri, if Sun on the Mon = "CLOSESTTO,13,AUG"
 *  5\. A set date which, if on a Sat is unchanged, but if a Sun is taken on the Mon = "FWDFROMSUN,13,AUG"
 *  6\. A set date which is unchanged if it happens to be on a weekend = "REMAINS,13,AUG"
 *  7\. The first day on or after day "x" in month "m" e.g. 1st Monday on or after 16th Jan = "FIRSTAFTER,16,MON,JAN"
 *  8\. A holiday which is a set number of days relative to Easter Sunday, e.g Easter Monday = "EASTER,1"
 *  9\. A holiday on one specified date only. e.g. 13th Aug 1997 = "ONEOFF,13,AUG,1997"
 *  10.A specific date which has been added but is not a holiday and must be removed. = "REMOVE,13,AUG,1997"
 *  Note REMOVE only works on a date which is already in the calendar: you cannot remove a date which is yet to be added.
 *   If there is any text after the definition of the holiday it will appear in the date calendar description,
 *   e.g. you can have "FWDFROM,25,DEC,Christmas Day", if you wish.
 */

LON: HolidayCalendar {  
 Config: String {
     FWDFROM,1,JAN,New Year's Day;
     EASTER,-2,Good Friday;
     EASTER,1,Easter Monday;
     ALWAYS,1,MON,MAY,Early May Bank Holiday;
     LAST,MON,MAY,Spring Bank Holiday;
     REMOVE,27,MAY,2002,Spring Bank Holiday;
     ONEOFF,3,JUN,2002,Spring Bank Holiday;
     ONEOFF,4,JUN,2002,Spring Bank Holiday;
     LAST,MON,AUG,Summer Bank Holiday;
     FWDFROM,25,DEC,Christmas;
     FWDFROM,26,DEC,Boxing Day;
     ONEOFF,31,DEC,1999,Millenium;
 }
 EndDate: 31-Dec-2030;
 Name: London;
 StartDate: 01-Jan-1990;
 Weekend: SAT,SUN,;
}

HKG: HolidayCalendar {  
 Config: String {   
     FWDFROM,1,JAN,New Year's Day;
     ONEOFF,16,FEB,1999,Chinese New Year;   
     ONEOFF,17,FEB,1999,Chinese New Year;   
     ONEOFF,18,FEB,1999,Chinese New Year;   
     FWDFROM,5,FEB,2000,Chinese New Year;   
     FWDFROM,6,FEB,2000,Chinese New Year;   
     FWDFROM,7,FEB,2000,Chinese New Year;   
     CLOSESTTO,5,APR,Ching Ming;    
     EASTER,-2,Good Friday; 
     EASTER,1,Easter Monday;    
     FWDFROM,1,MAY,Labour Day;  
     ONEOFF,18,JUN,1999,Dragon Boat Festival;   
     FWDFROM,1,JUL,SAR Establishment Day;   
     FWDFROM,1,OCT,National Day;
     FWDFROM,2,OCT,National Day;
     ONEOFF,25,SEP,1999,Mid Autumn Festival;
     ONEOFF,17,OCT,1999,Chung Yeung;
     FWDFROM,25,DEC,Christmas;
     FWDFROM,26,DEC,Boxing Day;
     ONEOFF,4,MAY,1998,May bank holiday;
     ONEOFF,25,MAY,1998,May bank holiday;
     ONEOFF,3,MAY,1999,May bank holiday;
     ONEOFF,31,MAY,1999,May bank holiday;
     ONEOFF,1,JUL,1997;
     ONEOFF,2,JUL,1997;
 }
 EndDate: 31-Dec-2030;
 Name: Hong Kong;
 StartDate: 01-Jan-1990;
 Weekend: SAT,SUN,;
}

MIL: HolidayCalendar {
 Config: String {
     FWDFROM,1,JAN,New Year's Day;
     REMAINS,6,JAN,Epiphany;
     REMAINS,25,APR,Liberation Day;
     REMAINS,1,MAY,May Day;
     REMAINS,15,AUG,Assumption;
     REMAINS,1,NOV,All Saint's;
     REMAINS,8,DEC,Immaculate Conception;
     EASTER,1,Easter Monday;
     FWDFROM,25,DEC,Christmas;
     FWDFROM,26,DEC,Boxing Day;
 }
 EndDate: 31-Dec-2030;
 Name: Milan;
 StartDate: 01-Jan-1990;
 Weekend: SAT,SUN,;
}

FFT: HolidayCalendar {
 Config: String {
     REMAINS,1,JAN,New Year's Day;
     EASTER,-2,Good Friday;
     EASTER,1,Easter Monday;
     REMAINS,1,MAY,Labour Day;
     EASTER,39,Ascension Day;
     EASTER,50,Whit Monday;
     EASTER,60,Corpus Christi;
     REMAINS,3,OCT,Day of German Unity;
     REMAINS,24,DEC,Christmas Eve;
     REMAINS,25,DEC,Christmas Day;
     REMAINS,26,DEC,Boxing Day;
 }
 EndDate: 31-Dec-2030;
 Name: Frankfurt;
 StartDate: 01-Jan-1990;
 Weekend: SAT,SUN,;
}

ZUR: HolidayCalendar {
 Config: String {
     REMAINS,1,JAN,New Year's Day;
     REMAINS,2,JAN,New Year's Holiday;
     EASTER,-2,Good Friday;
     EASTER,1,Easter Monday;
     EASTER,39,Ascension Day;
     EASTER,50,Whit Monday;
     REMAINS,1,AUG,August Bank Holiday;
     REMAINS,1,MAY, LABOUR DAY;
     REMAINS,25,DEC,Christmas;
     REMAINS,26,DEC,Boxing Day;
 }
 EndDate: 31-Dec-2030;
 Name: Zurich;
 StartDate: 01-Jan-1990;
 Weekend: SAT,SUN,;
}

NYK: HolidayCalendar {
 Config: String {
     REMAINS,1,JAN,New Year's Day;
     ALWAYS,3,MON,JAN,Martin Luther King;
     ALWAYS,3,MON,FEB,President's Day;
     LAST,MON,MAY,Memorial Day;
     CLOSESTTO,4,JUL,Independence Day;
     ALWAYS,1,MON,SEP,Labor Day;
     ALWAYS,2,MON,OCT,Columbus Day;
     REMAINS,11,NOV,Veteran's Day;
     ALWAYS,4,THU,NOV,Thanksgiving;
     FWDFROMSUN,25,DEC,Christmas Day;
     ONEOFF,12,NOV,2001,Veteran's Day;
 }
 EndDate: 31-Dec-2030;
 Name: New York;
 StartDate: 01-Jan-1990;
 Weekend: SAT,SUN,;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-06-01T09:19:21.593

发现另一项针对全球公共假期的服务，据称被日历出版商使用：

[http://www.qppstudio.net/index.htm](http://www.qppstudio.net/index.htm)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-19T11:31:31.393

添加其他人已经说过的内容，将您自己的内容放在表格中是唯一真正的方法。一个典型的例子是女王金禧年的额外银行假期。这只是提前几年宣布的，你不可能提前五十年得到它。

因此，存在许多商业服务以可靠的方式提供这些数据。一个是[GoodBusinessDay.com](http://www.goodbusinessday.com/)，但我没有这方面的经验。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-19T13:04:12.687

[google calendar public hollydays](http://www.google.com/calendar/render?mode=gallery&cat=POPULAR) 也许您可以使用 google Calendar 网络服务检索您的国家/地区数据。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-06-23T19:31:33.537

该算法可能会减少遵守基督教节日的国家/地区的手动配置量。转换为 C# 应该很简单：

[http://en.wikipedia.org/wiki/Computus#Anonymous_Gregorian_algorithm](http://en.wikipedia.org/wiki/Computus#Anonymous_Gregorian_algorithm)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-11-17T20:17:03.663

金融机构将订阅定期更新不同地区银行日历的服务。

请注意，银行假期和普通假期之间通常存在差异。在美国，这方面的一个例子是今年独立日，联邦政府在 7 月 3 日承认了这个假期，但纽约联邦储备银行是开放的。

[2009 年美国联邦假期](http://www.opm.gov/Operating_Status_Schedules/fedhol/2009.asp)

[2009 年美国联邦储备银行假期](http://www.newyorkfed.org/aboutthefed/holiday_schedule.html)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-03-19T16:16:20.020

让我们简化一下：

* * *

```
case

-- New Year's Day
when DATEPART(MM, @DATE) = 1
    and DATEPART(DD, @DATE) = 1
    and DATEPART(DW, @DATE) in (2,3,4,5,6) then 'Y'
when DATEPART(MM, @DATE) = 12
    and DATEPART(DD, @DATE) = 31
    and DATEPART(DW, @DATE) = 6 then 'Y'
when DATEPART(MM, @DATE) = 1
    and DATEPART(DD, @DATE) = 2
    and DATEPART(DW, @DATE) = 2 then 'Y'

-- Memorial Day (last Monday in May)
when DATEPART(MM, @DATE) = 5
    and DATEPART(DD, @DATE) between 25 and 31
    and DATEPART(DW, @DATE) = 2 then 'Y'

-- Independence Day
when DATEPART(MM, @DATE) = 7
    and DATEPART(DD, @DATE) = 4
    and DATEPART(DW, @DATE) in (2,3,4,5,6) then 'Y'
when DATEPART(MM, @DATE) = 7
    and DATEPART(DD, @DATE) = 3
    and DATEPART(DW, @DATE) = 6 then 'Y'
when DATEPART(MM, @DATE) = 7
    and DATEPART(DD, @DATE) = 5
    and DATEPART(DW, @DATE) = 2 then 'Y'

-- Labor Day (first Monday in September)
when DATEPART(MM, @DATE) = 9
    and DATEPART(DD, @DATE) between 1 and 7
    and DATEPART(DW, @DATE) = 2 then 'Y'

-- Thanksgiving Day (fourth Thursday in November)
when DATEPART(MM, @DATE) = 11
    and DATEPART(DD, @DATE) between 22 and 28
    and DATEPART(DW, @DATE) = 5 then 'Y'

-- Black Friday (day after Thanksgiving)
when DATEPART(MM, @DATE) = 11
    and DATEPART(DD, @DATE) between 23 and 29
    and DATEPART(DW, @DATE) = 6 then 'Y'

-- Christmas Day
when DATEPART(MM, @DATE) = 12
    and DATEPART(DD, @DATE) = 25
    and DATEPART(DW, @DATE) in (2,3,4,5,6) then 'Y'
when DATEPART(MM, @DATE) = 12
    and DATEPART(DD, @DATE) = 24
    and DATEPART(DW, @DATE) = 6 then 'Y'
when DATEPART(MM, @DATE) = 12
    and DATEPART(DD, @DATE) = 26
    and DATEPART(DW, @DATE) = 2 then 'Y'

else 'N' end 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-03-24T11:21:00.460

在一些国家（即波兰），复活节的假期数量会增加。

在这篇文章的末尾，您可以找到一个代码来计算取决于它的食客日期和几个假期。

不可移动的假期，即 1 月 1 日、圣诞节假期、独立日等，可以存储在表中的某个位置。

请记住，在一些国家/地区，您的地区/州可以有额外的公共假期，但应该可以计算您所在国家或地区的所有假期。

在英国，即您有银行假期，其中有一些您可以在代码中使用的规则。- 五月的第一个星期一 - 五月的最后一个星期一 - 八月的最后一个星期一等。

请查看此链接了解更多详情 [http://en.wikipedia.org/wiki/Public_holidays_in_the_United_Kingdom](http://en.wikipedia.org/wiki/Public_holidays_in_the_United_Kingdom)

**如何在 SQL 中计算复活节日期：**

[http://www.smart.net/~mmotes/nature1876.html](http://www.smart.net/~mmontes/nature1876.html)

[http://ghiorzi.org/easterda.htm](http://ghiorzi.org/easterda.htm)

```
declare @a int
declare @b int
declare @c int
declare @d int
declare @e int
declare @f int
declare @g int
declare @h int
declare @i int
declare @j int
declare @k int
declare @l int
declare @m int
declare @n int
declare @Year int
declare @Month int
declare @Day int
declare @EasterSunday datetime
declare @EasterMonday datetime
declare @Pentecost datetime
declare @CorpusChristi datetime

SET @Year = 2014

SET @a = @Year%19;
SET @b = @Year/100;
SET @c = @Year%100;
SET @d = @b/4;
SET @e = @b%4;
SET @f = @c/4;
SET @g = @c%4;

   SET @h = (@b + 8)/25;
   SET @i = (@b - @h + 1)/3;
   SET @j = (19*@a + @b -  @d - @i + 15) % 30;
   SET @k = (32 + 2*@e + 2*@f - @j - @g) % 7;
   SET @m = (@a + 11*@j + 22*@k) / 451;
   SET @n = @j + @k - 7*@m + 114;

   SET @Month = @n/31;
   SET @Day = (@n % 31) + 1;

--PRINT @Year
--PRINT @Month
--PRINT @Day

SET @EasterSunday = dateadd(month,((@Year-1900)*12)+@Month-1,@Day-1)
SET @EasterMonday = dateadd(day,1,@EasterSunday)
SET @Pentecost = dateadd(day,49,@EasterSunday)
SET @CorpusChristi = dateadd(day,60,@EasterSunday)

PRINT 'Easter Sunday: ' + CONVERT(VARCHAR, @EasterSunday,120) + ' [' + DATENAME(dw, @EasterSunday) + ']'
PRINT ''

PRINT 'Easter Monday: ' + CONVERT(VARCHAR, @EasterMonday,120) + ' [' + DATENAME(dw, @EasterMonday) + ']'
PRINT ''

PRINT 'Pentecost: ' + CONVERT(VARCHAR, @Pentecost,120) + ' [' + DATENAME(dw, @Pentecost) + ']'
PRINT ''

PRINT 'CorpusChristi: ' + CONVERT(VARCHAR, @CorpusChristi,120) + ' [' + DATENAME(dw, @CorpusChristi) + ']'
PRINT '' 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-01-19T15:55:30.553

看到[这个答案](https://stackoverflow.com/a/20596034/7428718)，很容易在[http://www.joebooth-consulting.com/sqlServer/sqlServer.html#CalendFunc](http://www.joebooth-consulting.com/sqlServer/sqlServer.html#CalendFunc)实现 Joe Booth 的解决方案。

我确实需要通过在武装部队日之后添加阵亡将士纪念日来调整 Holiday_List 函数，如下所示：

```
IF @nYear>=1868 INSERT INTO @Holidays (Holiday_name,Holiday_date) VALUES ('Memorial Day',dbo.FloatingDate(0,2,6,@nYear)) -- Last Monday in May 
```

如果假期是周末，我还提出了这个案例陈述，将日期调整为前一个或下一个工作日：

```
case 
    when DATENAME(WEEKDAY,Holiday_date)='Saturday' 
        then dateadd(d,-1,Holiday_date) 
    when DATENAME(WEEKDAY,Holiday_date)='Sunday' 
        then dateadd(d,1,Holiday_date) 
    else
        Holiday_date
    end as adjusted 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-09-23T22:01:31.803

我觉得这个话题很奇怪。在尝试用 MS、PHP 或在这种情况下的 SQL 语言中查找和编写复杂的函数后，我得出的结论是，这是一个毫无意义的练习。我最终得到的代码包含超过 2000 个字符，需要数小时才能正确调试。如果您考虑一下，您所要做的就是写下 7 个数字，表示每个假期的第 1-365 天，并在接下来的 100 年中每年写一行。您只需要加载那几年或下一年的假期一次。因此，请保留 7 列和 100 行的表格，并用正确的日期填充它们。您只需每 100 年执行一次此操作，花费不到一个小时，而且它是便携式的。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-04-22T23:48:18.040

我尝试了“答案”并花时间对其进行了大量修改以使其更具可读性。真的不需要那些“-DATEPART”选项，因为我们在之前设置了日期。它工作得很好，但在 2020 年 MLK 日遇到了问题，所以我对它的信任动摇了。

此外，我不喜欢它很难阅读的事实。我发现了这一点，它更容易通过。它的工作原理与日期维度表非常相似，并且在我尝试的 3 年中进行了准确的测试。

[https://www.codeproject.com/Tips/1168430/US-Federal-Holidays-SQL](https://www.codeproject.com/Tips/1168430/US-Federal-Holidays-SQL)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-11-04T08:51:30.730

英国的银行假期大多是可计算的，但绝对不是全部可计算的。

英国政府提供了一个 API ( [https://www.gov.uk/bank-holidays.json](https://www.gov.uk/bank-holidays.json) ) 为您提供此信息。

# asp.net - 我们如何使用 asp.net、webservice 和 sql 数据库集成 jQuery 自动完成功能？

> ID：457183
> 
> 赞同：1
> 
> 时间：2009-01-19T10:36:42.797
> 
> 标签：asp.net, jquery, subsonic, autocomplete

我正在尝试实现为“jQuery Autocomplete and ASP.NET”提供的代码，但由于您使用亚音速查询数据库而无法集成它。

那么你能告诉我如何使用C#查询sqldatabase并将查询结果绑定到asp.net中webservice的插件吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-27T18:54:45.677

这是一个非常简单的任务，关键是 jQuery 自动完成扩展器需要一个值数组。这是我如何解析来自 ASMX Web 服务的标准 XML 结果以与 jQuery 自动完成扩展器一起使用的示例。

由于 ASP.NET 喜欢重写您的 ID，您可以传入 ClientID 以获取动态 ID。

```
 $("#<%= TextBox1.ClientID %>").autocomplete("/Demo/WebSvc.asmx/SuggestCustomers", {
        parse: function(data) {
            var parsed = [];

            $(data).find("string").each(function() {
                parsed[parsed.length] = {
                    data: [$(this).text()],
                    value: $(this).text(),
                    result: [$(this).text()]
                };
            });
            return parsed;
        },
        dataType: "xml"
    }); 
```

以下是相关 Web 服务的外观，记得取消注释 Web 服务上的 [ScriptService] 属性：

```
[WebService(Namespace = "http://tempuri.org/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[ScriptService]
public class WebSvc: WebService
{
    [WebMethod]
    public string[] SuggestedCustomers(string q)
    {
        // Do Query

        // Add items into string array
        List<string> items = new List<string>();
        while (dr.Read())
        {
            items.Add(dr[0].ToString());
        }

        // Return array
        return items.ToArray();
    }

} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-19T10:52:42.920

我不精通asp.net，但基本上像大多数网络编码问题一样，这涉及将您的问题分解成更小的问题。

从架构的角度来看，您的组件可能包括以下...

*   可能使用您的数据库等来回答或为您的查询产生结果的服务层。
*   一个 Web 组件或服务入口点，它使用上面提到的完整服务以 browesrr 可以轻松理解的格式返回数据 - 例如 JSON。
*   一些使用 jquery 的 javascript 调用在上面的直接点中定义的端点。
*   为上述所有组件编写单元测试 - 不要忘记测试失败案例，因为众所周知，软件有时会失败......

# ruby - ZenTest的源码问题

> ID：457185
> 
> 赞同：0
> 
> 时间：2009-01-19T10:38:32.387
> 
> 标签：ruby, zentest

这是猴子从 autotest 修补 Dir[] 方法的一种方法

```
class Dir
  class << self
    alias :old_index :[]
    def [](*args)
      $-w, old_warn = false, $-w
      old_index(*args)
    ensure
      $-w = old_warn
    end
  end
end 
```

你能帮忙解释一下这条线`$-w, old_warn = false, $-w`吗？提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T10:44:19.770

您可以在 Ruby 中将多个变量分配给一行中的多个值。

该行等效于以下内容：

```
old_warn = $-w
$-w = false 
```

如果你问目的是什么；`$-w`是 Ruby 中的一个全局变量，它指向一个布尔值，指示用户在运行脚本时是否将`-w`标志传递给`ruby`可执行文件。换句话说，该变量指示脚本/程序当前是否应该打印“警告”。

本质上，整个代码块的目的是确保在执行其核心之前关闭警告。警告标志的旧值被保存到一个新变量中；警告标志关闭；然后当执行完成时，警告标志被重新设置回原来的样子。

# algorithm - 加密字符串的长度

> ID：457193
> 
> 赞同：18
> 
> 时间：2009-01-19T10:39:48.843
> 
> 标签：algorithm, encryption, cryptography

我需要创建一个数据库列，该列将存储使用三重 DES 加密的字符串。如何确定加密字符串列的长度？

（也欢迎回答三重 DES 以外的算法。）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-20T21:35:43.043

DES、3DES 和 AES 等分组密码只能对字节块进行操作。DES 和 3DES 对 8 字节的块进行操作，而 AES 对 16 字节的块进行操作。

为了解决这个问题，您通常在加密之前对明文应用可逆填充。它通常总是“PKCS”-填充（也称为 PKCS5-或 PKCS7-填充）。

PKCS 填充添加至少一个字节，以便填充文本的长度可与块长度整除（3DES 为 8 个字节）。padding-bytes 的值是添加的字节数。外汇。ABCDEF 被填充到 ABCDEF0505050505 和 0011223344556677 被填充到 0011223344566770808080808080808。请注意，这很容易删除：您只需查看填充字节的最后一个字节，验证它是否在 1 和块长度之间，然后删除该字节数从最后开始（验证每个删除的字节是否具有正确的值）。

最后，回答您的问题：假设您使用 3DES 和 CBC 加密和 PKCS 填充 - 您可能是 - 长度为 n 的字符串的加密将具有长度：

```
n + 8 - (n % 8) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-19T10:52:23.360

使用三重 DES 不会更改字符串的长度，但会四舍五入到下一个 64 位边界。如果您打算“显示”它，则必须对其进行编码（不过就像在[Base64](http://en.wikipedia.org/wiki/Base64)中一样。

至于其他算法，实在是太多了，很难回答。块密码将始终填充输入以匹配其块大小，而许多流密码则不会。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T10:42:13.003

[三重 DES](http://en.wikipedia.org/wiki/Triple_DES)使用三个 56 位 DES 密钥，提供 168 位密钥。它的块大小是**64-bit**。

# python - 裁剪 .pdf 文件的页面

> ID：457207
> 
> 赞同：23
> 
> 时间：2009-01-19T10:43:23.267
> 
> 标签：python, pdf, pypdf

我想知道是否有人有任何以编程方式处理 .pdf 文件的经验。我有一个 .pdf 文件，我需要将每一页裁剪到一定大小。

在快速谷歌搜索后，我找到了 python 的 pyPdf 库，但我的实验失败了。当我更改页面对象上的cropBox 和trimBox 属性时，结果不是我所期望的，而且看起来很随机。

有没有人有这方面的经验？代码示例将不胜感激，最好是在 python 中。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-21T16:12:44.507

[pyPdf](https://pypi.org/project/pyPdf/)在这方面做了我所期望的。使用以下脚本：

```
#!/usr/bin/python
#

from pyPdf import PdfFileWriter, PdfFileReader

with open("in.pdf", "rb") as in_f:
    input1 = PdfFileReader(in_f)
    output = PdfFileWriter()

    numPages = input1.getNumPages()
    print "document has %s pages." % numPages

    for i in range(numPages):
        page = input1.getPage(i)
        print page.mediaBox.getUpperRight_x(), page.mediaBox.getUpperRight_y()
        page.trimBox.lowerLeft = (25, 25)
        page.trimBox.upperRight = (225, 225)
        page.cropBox.lowerLeft = (50, 50)
        page.cropBox.upperRight = (200, 200)
        output.addPage(page)

    with open("out.pdf", "wb") as out_f:
        output.write(out_f) 
```

生成的文档有一个 200x200 点的裁切框，从媒体框内的 25,25 点开始。裁剪框在裁切框内 25 个点。

这是我的示例文档在使用上述代码处理后在 acrobat Professional 中的外观： [![裁剪页面截图](https://i.stack.imgur.com/vM7e6.png)](https://i.stack.imgur.com/vM7e6.png)

此文档在 acrobat reader 中加载时将显示为空白。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2018-08-01T06:44:04.370

使用它来获取 pdf 的尺寸

```
from PyPDF2 import PdfFileWriter,PdfFileReader,PdfFileMerger

pdf_file = PdfFileReader(open("/Users/user.name/Downloads/sample.pdf","rb"))
page = pdf_file.getPage(0)
print(page.cropBox.getLowerLeft())
print(page.cropBox.getLowerRight())
print(page.cropBox.getUpperLeft())
print(page.cropBox.getUpperRight()) 
```

在此获取页面参考之后，然后应用裁剪命令

```
page.mediaBox.lowerRight = (lower_right_new_x_coordinate, lower_right_new_y_coordinate)
page.mediaBox.lowerLeft = (lower_left_new_x_coordinate, lower_left_new_y_coordinate)
page.mediaBox.upperRight = (upper_right_new_x_coordinate, upper_right_new_y_coordinate)
page.mediaBox.upperLeft = (upper_left_new_x_coordinate, upper_left_new_y_coordinate)

#for example :- my custom coordinates 
#page.mediaBox.lowerRight = (611, 500)
#page.mediaBox.lowerLeft = (0, 500)
#page.mediaBox.upperRight = (611, 700)
#page.mediaBox.upperLeft = (0, 700) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2021-07-04T13:57:09.727

# 我怎么知道要裁剪的坐标？

感谢以上所有答案。

步骤 1\. 运行以下代码得到 (x1, y1)。

```
from PyPDF2 import PdfFileWriter, PdfFileReader

input = PdfFileReader(open("test.pdf","rb"))
page = input.getPage(0)
print(page.cropBox.getUpperRight()) 
```

步骤 2\. 以全屏模式查看 pdf 文件。

步骤 3\. 将屏幕捕获为图像文件 screen.jpg。

Step 4\. 通过 M$paint 或 GIMP 打开 screen.jpg。这些应用程序显示光标的坐标。

步骤 5\. 记住以下坐标，(x2, y2), (x3, y3), (x4, y4) 和 (x5, y5)，其中 (x4, y4) 和 (x5, y5) 确定您想要的矩形庄稼。

[![在此处输入图像描述](https://i.stack.imgur.com/L6kux.png)](https://i.stack.imgur.com/L6kux.png)

Step 6\. 通过以下公式获取 page.cropBox.upperLeft 和 page.cropBox.lowerRight。这是一个计算[工具](https://jsfiddle.net/p9L6rsco/)。

```
page.cropBox.upperLeft = (x1*(x4-x2)/(x3-x2),(1-y4/y3)*y1)
page.cropBox.lowerRight = (x1*(x5-x2)/(x3-x2),(1-y5/y3)*y1) 
```

步骤 7\. 运行以下代码以裁剪 pdf 文件。

```
from PyPDF2 import PdfFileWriter, PdfFileReader

output = PdfFileWriter() 
input = PdfFileReader(open('test.pdf', 'rb')) 

n = input.getNumPages()

for i in range(n):
  page = input.getPage(i)
  page.cropBox.upperLeft = (100,200)
  page.cropBox.lowerRight = (300,400)
  output.addPage(page) 

outputStream = open('result.pdf','wb') 
output.write(outputStream) 
outputStream.close() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T16:24:51.767

您可能正在寻找免费的解决方案，但如果您有钱可以花钱，[PDFlib](http://pdflib.com)是一个很棒的库。它从来没有让我失望过。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T22:54:55.833

您可以将 PDF 转换为 Postscript（pstopdf 或 ps2pdf），然后对 Postscript 文件进行文本处理。之后，您可以将输出转换回 PDF。

如果您要处理的 PDF 都由同一个应用程序生成并且有些相似，这会很好地工作。如果它们来自不同的来源，通常很难处理 Postscript 文件 - 结构变化很大。但是，即使您可以使用一些正则表达式来修复页面大小等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T23:39:01.797

Acrobat Javascript API 有一个 setPageBoxes 方法，但 Adob​​e 不提供任何 Python 代码示例。只有 C++、C# 和 VB。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-11-22T11:26:49.167

# 裁剪 .pdf 文件的页面

```
from PIL import Image
def ImageCrop():
    img = Image.open("page_1.jpg")
    left = 90
    top = 580
    right = 1600
    bottom = 2000
    img_res = img.crop((left, top, right, bottom))
    with open(outfile4, 'w') as f:
        img_res.save(outfile4,'JPEG')
ImageCrop() 
```

# wiki - Tomorrow's Wiki 应该包含哪些功能？

> ID：457211
> 
> 赞同：2
> 
> 时间：2009-01-19T10:44:51.550
> 
> 标签：wiki

“明天的”wiki 应该包括哪些功能？他们如何结合 AJAX 等 Web 2.0 特性？他们目前还缺少哪些其他功能？您希望从您最喜欢的 Wiki 的下一个版本中看到什么*？*

编辑：如何将 Wiki 集成到其他产品中？wiki 可以有哪些“巧妙的用途”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T10:47:23.867

我个人已经厌倦了`wikis`。`Wiki`作为一个软件已经过时了，现在它是`wiki`一个*功能*（比如我最喜欢的新网站，堆栈溢出）。

`community wiki`当我们引入“*建议的编辑*”时，更多编辑的主要优势就出现了。

使用“*建议的编辑*”，任何人，甚至是匿名用户，都可以编辑任何内容——只要另一位有经验的用户审查并批准他们的编辑。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T23:37:46.757

在 Stack Overflow 上，Preview-as-you-type 确实非常好用。许多维基不这样做。

让页面之间的链接变得非常容易，例如。当您键入时，wiki 会找到您可能引用的页面。这样您就可以创建链接，而无需知道目标页面的确切标题，也无需在 shift 键上弹跳到 WriteInCamelCase 或放入方括号。也可以很容易地链接到 wiki 之外的其他网站（我所说的“简单”并不是指像 wikisisters，如果我没记错的话，它就像 foowiki:ALinkLikeThis）。

同样，如果您可以在文本中自动生成链接，例如，您可以拥有一个邮件系统来维基化您的电子邮件。例如，您为 Joel Spolsky 创建了一个 wiki 页面，收件箱中对 Joel 电子邮件的引用成为该页面的链接，您可以通过单击“这里的链接”找到该页面。（这可能需要一些类似于贝叶斯过滤的东西来修剪对其他 Joels 的杂散引用......您的贝叶斯分类器会知道，如果上下文很聪明并且可以完成任务，它就是 Spolsky。如果它是飞翔的维京小猫，它更有可能是 Joel维奇）。

用于跟踪更改的各种 RSS 提要也很不错。（差异、全文、我编辑过的页面上的更改……）

维基百科已经发展了一个相当庞大的分类系统（“虚构的猫”，有人吗？）；在 wiki 的平面命名空间上进行分类可以为用户提供另一种方式来找到他们的方式。Wikipedia 这样做了一点，但到目前为止方式相当有限：有相关类别列表的链接，但你不能，例如，寻找一个名为“Smith”的作曲家。

同样，wiki 为您提供了这张互连节点的大图，说明您的社区对相关概念的看法有多接近。这很有趣吗？那有用吗？不是谷歌的人会想这些东西吗？

PS。如果您相信 Paul Graham 将 Web 2.0 定义为“民主、不要虐待用户和 Javascript 现在可以使用”，那么 wiki 已经是 Web 2.0 的三分之二了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-01T12:26:38.377

我正在选择一个 wiki 工具，并在过去一周查看了许多软件包。我敢肯定有几十个我什至还没有听说过，可能是好的。但总的来说，这是我对这个问题的“初学者的想法”。

**应该放弃 Wiki 标记。**仅限于 wiki 标记的 wiki 只会对“nix hacks”和其他对以艰难的方式做事感到兴奋并坚持认为其他人都是愚蠢的人有用。我的意思是，我个人觉得莫尔斯电码没问题。我不明白一个漂亮、干净的破折号有什么问题。或者烟雾信号，它们很好，除了碳足迹。但是时代在变，我们也必须随之改变。

真实用户（业务用户、客户、客户）需要富文本编辑。时期。而当 wiki 尝试同时支持富文本和 wiki 标记时，结果并不理想。该模型令人困惑并且（显然）难以实施。例如，wikiwiki 上的 fckeditor 扩展就是一场噩梦。这不值得。

**Wiki 需要更好的访问控制。**所有内容都应该对所有人开放的想法对于像这样一个开放的、公共的、非盈利的 wiki 来说是很好的。但在商业世界中，情况并非如此。限制访问不是邪恶的，而是现实。Wiki 工具需要在提供访问控制方面做得更好：基于角色或组成员资格对页面和页面组的访问，其中组可以由任何人临时组成，用户可以属于多个组，页面可以可根据页面创建者的心血来潮访问多个组。

这是我最想要的两件事，而且我还没有在开源中找到它，至少不是开箱即用的。当然，这就是为什么开源是开源的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T21:47:28.123

我真的很喜欢[MediaWiki](http://www.mediawiki.org/wiki/MediaWiki)。它[被广泛使用](http://www.mediawiki.org/wiki/Sites_using_MediaWiki/en)并且免费/免费。标记语法很简单，允许您进行足够的基本样式设置，而无需使用自定义 HTML 或使用 WYSIWYG。我假设“sexy web 2.0”是指 Flash/AJAX，但我喜欢 MediaWiki，因为它可以与基本的 HTML/Javascript 一起干净地工作（您不必等待自定义小部件加载等...）。

使 wiki 发挥其潜力的原因在于围绕它们开发的社区比软件本身更多。你需要找到一个利基市场，让人们既对中心话题充满热情（但不是疯狂地疯狂）并且有足够的技术实力来登录网站并编辑一些文本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T15:29:11.710

有一些使用 wiki 进行[测试](http://en.wikipedia.org/wiki/FitNesse)和[软件开发](http://portal.acm.org/citation.cfm?id=1296970)的有趣工作。EG，向[文学编程](http://www-cs-faculty.stanford.edu/~knuth/lp.html)的运动——允许页面作为代码和文档存在，这些代码和文档被编译成一个或另一个（或者，我想，两者同时存在）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T15:39:45.510

他们在年度 WikiSym 会议上定期召开会议。

我认为 Wiki 的一个方向是从开放式文档集合转向“每个人都可以编辑但具有更多结构”的应用程序，例如 SO。

我看到的另一个方向是与其他项目支持工具更直接的集成，例如项目规划、问题管理和所有这些东西。

就个人而言，我认为下一个大方向将是某种基于多媒体的 Wiki，而不仅仅是可以将多媒体嵌入文本的 Wiki。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T22:47:50.060

“维基”最终只是一种模式：

*   由所有/大多数访问者打开编辑
*   集成修订跟踪和回滚以降低错误成本
*   文章之间交叉链接的简单语法，以及引用时自动创建存根文章

这不是一个完美的描述，但它的组合并不是特别神奇。成功的 wiki 将这些东西与大量创建和维护内容的人结合在一起。

下一步，IMO，不是关于 web 2.0 的光泽，而是更多关于更好的结构信息的集成。添加“这点到那个点”之外的任何元数据都是蛮力手动标记的练习。也许是微格式？也许开发更结构化的知识库软件，使用维基式的编辑 UI 但更智能的后端？我不确定，但我认为更好地处理结构化数据确实是下一波浪潮。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-17T05:47:13.817

可扩展性。

查看 DekiWiki，他们在这方面做得很好。

[DekiWiki 扩展](http://wiki.developer.mindtouch.com/Deki/Extensions)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-19T15:18:49.110

未来的 wiki 将完全可在线编辑，每个人同时进行。查看[EtherPad](http://etherpad.com/)以了解该技术的演示。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-06T12:48:29.267

对我来说，就 wiki 的企业风格使用而言，我有几个想法；

*   一种有效的方式来保持和同步基于 Web 的中央 wiki 与多个离线桌面风格的 wiki，供旅途中的人们使用
*   将 wiki 作为一个功能而不是 wiki 作为一个系统，因此我们可以将 wiki 协作系统集成到其他事物中

# python - 理解展平一系列序列？

> ID：457215
> 
> 赞同：42
> 
> 时间：2009-01-19T10:47:39.187
> 
> 标签：python, sequences, list-comprehension

如果我有序列序列（可能是元组列表），我可以使用 itertools.chain() 来展平它。但有时我觉得我宁愿把它写成一种理解。我只是不知道该怎么做。这是一个非常容易理解的案例：

假设我想交换序列中每一对的元素。我在这里使用字符串作为序列：

```
>>> from itertools import chain
>>> seq = '012345'
>>> swapped_pairs = zip(seq[1::2], seq[::2])
>>> swapped_pairs
[('1', '0'), ('3', '2'), ('5', '4')]
>>> "".join(chain(*swapped_pairs))
'103254' 
```

我在序列的偶数和奇数切片上使用 zip 来交换对。但我最终得到了一个现在需要展平的元组列表。所以我使用链（）。有没有办法我可以用理解来表达它？

如果您想针对交换对的元素的基本问题发布您自己的解决方案，请继续，我会投票赞成任何教给我新知识的东西。但我只会将针对我的问题的答案标记为已接受，即使答案是“不，你不能。”。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-19T10:58:49.290

有领悟？好...

```
>>> seq = '012345'
>>> swapped_pairs = zip(seq[1::2], seq[::2])
>>> ''.join(item for pair in swapped_pairs for item in pair)
'103254' 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-03-16T18:44:22.503

我发现最快的是从一个空数组开始并扩展它：

```
In [1]: a = [['abc', 'def'], ['ghi'],['xzy']]

In [2]: result = []

In [3]: extend = result.extend

In [4]: for l in a:
   ...:     extend(l)
   ...: 

In [5]: result
Out[5]: ['abc', 'def', 'ghi', 'xzy'] 
```

这比 Alex Martelli 尝试中的示例快两倍多：[Making a flat list out of lists in Python](https://stackoverflow.com/questions/952914/making-a-flat-list-out-of-list-of-lists-in-python)

```
$ python -mtimeit -s'l=[[1,2,3],[4,5,6], [7], [8,9]]*99' '[item for sublist in l for item in sublist]'
10000 loops, best of 3: 86.3 usec per loop

$ python -mtimeit -s'l=[[1,2,3],[4,5,6], [7], [8,9]]*99'  'b = []' 'extend = b.extend' 'for sub in l:' '    extend(sub)'
10000 loops, best of 3: 36.6 usec per loop 
```

我想出这个是因为我有一种预感，在幕后，extend 会为列表分配适量的内存，并且可能使用一些低级代码来移动项目。我不知道这是否属实，但是谁在乎，它更快。

顺便说一句，这只是线性加速：

```
$ python -mtimeit -s'l=[[1,2,3],[4,5,6], [7], [8,9]]'  'b = []' 'extend = b.extend' 'for sub in l:' '    extend(sub)'
1000000 loops, best of 3: 0.844 usec per loop

$ python -mtimeit -s'l=[[1,2,3],[4,5,6], [7], [8,9]]' '[item for sublist in l for item in sublist]'
1000000 loops, best of 3: 1.56 usec per loop 
```

您也可以使用`map(results.extend, a)`，但这会比较慢，因为它正在构建自己的 None 列表。

它还为您提供了一些不使用函数式编程的好处。IE

*   您可以扩展现有列表而不是创建一个空列表，
*   你仍然可以一眼看懂代码，几分钟、几天甚至几个月后。

顺便说一句，最好避免列表推导。小的还不错，但一般来说，列表推导式实际上并不能为您节省很多打字时间，但通常更难理解，也很难更改或重构（见过三级列表推导式吗？）。[谷歌编码指南建议不要使用它们，除非在简单的情况下。](http://google-styleguide.googlecode.com/svn/trunk/pyguide.html#List_Comprehensions)我的观点是它们只在“丢弃”代码中有用，即作者不关心可读性的代码，或者已知永远不需要将来维护的代码。

比较这两种写同一件事的方式：

```
result = [item for sublist in l for item in sublist] 
```

有了这个：

```
result = []
for sublist in l:
    for item in sublist:
        result.append(item) 
```

YMMV，但第一个让我停下了脚步，我不得不考虑一下。在第二个中，从缩进中可以明显看出嵌套。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T10:54:08.083

您可以使用 reduce 来实现您的目标：

```
In [6]: import operator
In [7]: a = [(1, 2), (2,3), (4,5)]
In [8]: reduce(operator.add, a, ())
Out[8]: (1, 2, 2, 3, 4, 5) 
```

这将返回一个元组而不是一个列表，因为原始列表中的元素是连接在一起的元组。但是您可以轻松地从中构建一个列表，并且 join 方法也接受元组。

顺便说一下，列表推导式不是正确的工具。基本上，列表推导通过描述该列表的元素应该是什么样子来构建一个新列表。您希望将元素列表减少到只有一个值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T14:34:44.487

```
>>> a = [(1, 2), (3, 4), (5, 6)]
>>> reduce(tuple.__add__, a)
>>> (1, 2, 3, 4, 5, 6) 
```

或者，不知道内部序列的类型（只要它们都相同）：

```
>>> reduce(a[0].__class__.__add__, a) 
```

# visual-studio - 如何在 XAML 编辑器中复制行？

> ID：457221
> 
> 赞同：0
> 
> 时间：2009-01-19T10:50:10.040
> 
> 标签：visual-studio, xaml, hotkeys

在 Visual Studio.NET 中编码时，我经常使用（无选择）CTRL-C、CTRL-V 快速复制一行。

不幸的是，这在 XAML 编辑器中的工作方式不同（它将新行粘贴到当前行的中间）。

有谁知道在 XAML 中复制一行的热键？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T10:53:35.370

如果将 .xaml 扩展名映射到标准 XML 编辑器，则此问题将与 XAML 编辑器性能不佳等其他问题一起得到解决。

工具/选项/文本编辑器/文件扩展名

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-28T05:08:10.450

在 Visual Studio 2010（和 Visual Studio 11 开发人员预览版）的 XAML 编辑器中，复制和粘贴一行具有预期的行为：

*   在没有选定文本时调用副本会导致整个当前行被复制。
*   没有选定文本时的后续粘贴将导致复制的行插入到当前行的上方。

# c# - 实现 C# 接口的 C++ 标头

> ID：457225
> 
> 赞同：0
> 
> 时间：2009-01-19T10:52:55.743
> 
> 标签：c#, c++, header-files

可以从 C# 接口生成 C++ 头文件吗？

例子：

### C#接口：

```
public interface A { 
    void M( ushort u ); 
} 
```

### C++ 头文件：

```
public ref class B : A 
{ 
    void M( unsigned short u ); 
} 
```

返回“错误 C3766”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T11:00:10.520

接口也必须是公共的。试试这个（注意第二个公共关键字）：

```
public ref class B : public A { void M( unsigned short u ); } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T16:23:19.353

您必须使用 virtual 关键字。这按预期编译：

```
public ref class B : ClassLibrary1::A {
public:
    virtual void M(unsigned short u) {}
}; 
```

其中 ClassLibrary1 是在其中进行 C# 接口声明的命名空间。

# java - 如何在 Java 中清除软引用？

> ID：457229
> 
> 赞同：21
> 
> 时间：2009-01-19T10:54:56.177
> 
> 标签：java, garbage-collection, soft-references

我有一个缓存，其中包含对缓存对象的软引用。我正在尝试为使用缓存的类的行为编写功能测试，专门用于清除缓存对象时发生的情况。

问题是：我似乎无法可靠地清除软引用。简单地用完一堆内存并不能解决问题：在清除任何软引用之前，我得到了 OutOfMemory。

有没有办法让 Java 更急切地清理软引用？

* * *

**[在这里](https://stackoverflow.com/questions/299659/what-is-the-difference-between-a-soft-reference-and-a-weak-reference-in-java)****找到**：

> “虽然可以保证在抛出 OutOfMemoryError 之前所有 SoftReferences 都会被清除，因此理论上它们不会导致 OOME。”

那么这是否意味着上述情况一定意味着我在某个地方有内存泄漏，某个类在我的缓存对象上持有硬引用？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-19T11:11:41.090

> 问题是：我似乎无法可靠地清除软引用。

这不是 SoftReferences 独有的。由于 Java 中垃圾收集的性质，不能保证任何可垃圾收集的东西实际上会在任何时间点被收集。即使有一些简单的代码：

```
Object temp = new Object();
temp = null;
System.gc();
```

不能保证第一行中实例化的对象在此时或实际上在任何时候都被垃圾收集。这只是在内存管理语言中你必须忍受的事情之一，你放弃了对这些事情的声明权。是的，这有时会使最终测试内存泄漏变得困难。

* * *

也就是说，根据您引用的 Javadocs，在抛出 OutOfMemoryError 之前绝对应该清除 SoftReferences（事实上，这就是它们的全部意义，也是它们与默认对象引用不同的唯一方式）。因此，听起来好像存在某种内存泄漏，因为您持有对相关对象的更硬引用。

如果您使用`-XX:+HeapDumpOnOutOfMemoryError`JVM 的选项，然后将堆转储加载到类似[jhat](http://java.sun.com/javase/6/docs/technotes/tools/share/jhat.html)的东西中，您应该能够看到对您的对象的所有引用，从而查看除了您的软引用之外是否还有任何引用。或者，您可以在测试运行时使用分析器实现相同的目的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-02T22:46:46.770

还有以下 JVM 参数用于调整软引用的处理方式：

```
-XX:SoftRefLRUPolicyMSPerMB=<值>
```

其中 'value' 是每个空闲 Mb 内存的软引用保留的毫秒数。默认值为 1s/Mb，因此如果一个对象只能软可达，那么如果只有 1Mb 的堆空间可用，它将持续 1s。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-09-28T07:20:26.197

[您可以使用这段代码](https://stackoverflow.com/questions/3785713/how-to-make-the-java-system-release-soft-references/3810234#3810234)强制在您的测试中清除所有 SoftReference 。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T14:21:58.350

如果你真的想要，你可以在你的 SoftReference 上调用 clear() 来清除它。

也就是说，如果 JVM 抛出 OutOfMemoryError 并且您的 SoftReference 尚未被清除，那么这意味着您必须在其他地方对该对象进行硬引用。否则将使 SoftReference 的合同无效。否则，您永远无法保证清除 SoftReference：只要仍有可用内存，JVM 就不需要清除任何 SoftReference。另一方面，允许在下次执行 GC 循环时清除它们，即使它不需要这样做。

此外，您可以考虑查看 WeakReferences，因为 VM 在清除它们时往往更积极。从技术上讲，VM 不需要清除 WeakReference，但是如果对象被认为是死的，它应该在下次执行 GC 循环时清除它们。如果您正在尝试测试清除缓存时会发生什么，使用 Wea​​kReferences 应该可以帮助您的条目更快地消失。

另外，请记住，这两者都依赖于 JVM 执行 GC 循环。不幸的是，没有办法保证其中之一会发生。即使您调用 System.gc()，垃圾收集器也可能会认为它只是在做一些漂亮的事情并选择什么都不做。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-19T16:35:12.590

在典型的 JVM 实现 (SUN) 中，您需要多次触发 Full GC 才能清理软引用。这样做的原因是因为软引用需要 GC 做更多的工作，例如一种允许您在对象被回收时得到通知的机制。

恕我直言，在应用程序服务器中使用大量软引用是邪恶的，因为开发人员无法控制它们何时发布。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T11:09:42.793

垃圾收集和其他引用（如软引用）是非确定性的，这实际上不可能可靠地执行操作，因此此时软引用肯定会被清除，因此您的测试可以判断您的缓存如何反应。我建议您通过模拟等以更明确的方式模拟参考清除 - 您的测试将是可重复的并且更有价值，而不仅仅是让 GC 清理参考的 Hopi g。使用后一种方法是一件非常糟糕的事情，只会引入额外的问题，而不是帮助您提高缓存的质量以及它的协作组件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T11:11:39.403

根据文档和我的经验，我会说是的：您必须在其他地方有参考。

我建议使用一个调试器，它可以显示对一个对象的所有引用（例如调试 Java 6 时的 Eclipse 3.4），并且只检查何时抛出 OOM。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T13:51:23.107

如果你使用 eclipse，有一个名为[Memory Analyzer](http://www.eclipse.org/mat/ "内存分析器")的工具可以让 heap dump 调试更容易。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-16T13:21:45.913

缓存对象是否有终结器？终结器将为对象创建新的强引用，因此即使清除 SoftReference，内存也不会被回收，直到稍后的 GC 循环

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-03-07T06:39:16.353

如果您有一个缓存是 SoftReferences 的 Map 并且您希望它们被清除，您可以 clear() 映射，它们都将被清除（包括它们的引用）

# sql-server - 在 SQL Server 中具有类型化 XML 列有哪些优势？

> ID：457233
> 
> 赞同：1
> 
> 时间：2009-01-19T10:56:40.947
> 
> 标签：sql-server, xml, validation, xsd

从我所读到的 SQL Server 中的 XML 列可以是类型化的（具有模式）或非类型化的。使用类型化 XML 的优势是什么？

仅仅是验证了 XML 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T11:02:07.847

First is validation.

Second you can formulate XML queries based on the XSD and know that the XML content is compatible with your queries.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T15:32:37.443

它还有助于错误和调试 - 请参阅[Silent XQuery Failures](http://blogs.msdn.com/denisruc/archive/2007/04/19/silent-xquery-failures.aspx)

# winforms - 在不存在控制对象的情况下在 UI 线程上运行代码

> ID：457237
> 
> 赞同：12
> 
> 时间：2009-01-19T10:57:48.513
> 
> 标签：winforms, invoke, ui-thread, invokerequired

我目前正在尝试编写一个组件，它的某些部分应该在 UI 线程上运行（解释会很长）。因此，最简单的方法是将控件传递给它，并在其上使用 InvokeRequired/Invoke。但我认为将控件引用传递给“数据/背景”组件不是一个好的设计，所以我正在寻找一种在 UI 线程上运行代码而不需要可用控件的方法. WPF中的Application.Dispatcher.Invoke之类的...

任何想法，谢谢马丁

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-02T23:03:32.987

有一种更好、更抽象的方法可以在 WinForms 和 WPF 上运行：

```
System.Threading.SynchronizationContext.Current.Post(theMethod, state); 
```

这是因为 WindowsForms 安装了一个[`WindowsFormsSynchronizationContext`](http://msdn.microsoft.com/en-us/library/system.windows.forms.windowsformssynchronizationcontext.aspx)对象作为当前同步上下文。WPF 做了类似的事情，安装它自己的专用同步上下文 ( [`DispatcherSynchronizationContext`](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchersynchronizationcontext.aspx))。

`.Post`对应`control.BeginInvoke`,`.Send`对应`control.Invoke`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-02-24T15:18:14.533

首先，在您的表单构造函数中，保留对对象的类范围引用`SynchronizationContext.Current`（实际上是 a `WindowsFormsSynchronizationContext`）。

```
public partial class MyForm : Form {
    private SynchronizationContext syncContext;
    public MyForm() {
        this.syncContext = SynchronizationContext.Current;
    }
} 
```

然后，在您班级的任何地方，使用此上下文向 UI 发送消息：

```
public partial class MyForm : Form {
    public void DoStuff() {
        ThreadPool.QueueUserWorkItem(_ => {
            // worker thread starts
            // invoke UI from here
            this.syncContext.Send(() =>
                this.myButton.Text = "Updated from worker thread");
            // continue background work
            this.syncContext.Send(() => {
                this.myText1.Text = "Updated from worker thread";
                this.myText2.Text = "Updated from worker thread";
            });
            // continue background work
        });
    }
} 
```

您将需要以下扩展方法来使用 lambda 表达式：[http ://codepaste.net/zje4k6](http://codepaste.net/zje4k6)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T20:08:57.290

你是对的，将控件传递给线程是不好的。Winforms 控件是单线程的，将它们传递给多个线程可能会导致竞争条件或破坏您的 UI。相反，您应该将线程的功能提供给 UI，并在 UI 良好且准备就绪时让它调用线程。如果您想让后台线程触发 UI 更改，请公开一个后台事件并从 UI 订阅它。线程可以随时触发事件，并且 UI 可以在可能时响应它们。

在不阻塞 UI 线程的线程之间创建这种双向通信需要大量工作。这是一个使用 BackgroundWorker 类的高度缩写示例：

```
public class MyBackgroundThread : BackgroundWorker
{
    public event EventHandler<ClassToPassToUI> IWantTheUIToDoSomething;

    public MyStatus TheUIWantsToKnowThis { get { whatever... } }

    public void TheUIWantsMeToDoSomething()
    {
        // Do something...
    }

    protected override void OnDoWork(DoWorkEventArgs e)
    {
        // This is called when the thread is started
        while (!CancellationPending)
        {
            // The UI will set IWantTheUIToDoSomething when it is ready to do things.
            if ((IWantTheUIToDoSomething != null) && IHaveUIData())
                IWantTheUIToDoSomething( this, new ClassToPassToUI(uiData) );
        }
    }
}

public partial class MyUIClass : Form
{
    MyBackgroundThread backgroundThread;

    delegate void ChangeUICallback(object sender, ClassToPassToUI uiData);

    ...

    public MyUIClass
    {
        backgroundThread = new MyBackgroundThread();

        // Do this when you're ready for requests from background threads:
        backgroundThread.IWantTheUIToDoSomething += new EventHandler<ClassToPassToUI>(SomeoneWantsToChangeTheUI);

        // This will run MyBackgroundThread.OnDoWork in a background thread:
        backgroundThread.RunWorkerAsync();
    }

    private void UserClickedAButtonOrSomething(object sender, EventArgs e)
    {
        // Really this should be done in the background thread,
        // it is here as an example of calling a background task from the UI.
        if (backgroundThread.TheUIWantsToKnowThis == MyStatus.ThreadIsInAStateToHandleUserRequests)
            backgroundThread.TheUIWantsMeToDoSomething();

        // The UI can change the UI as well, this will not need marshalling.
        SomeoneWantsToChangeTheUI( this, new ClassToPassToUI(localData) );
    }

    void SomeoneWantsToChangeTheUI(object sender, ClassToPassToUI uiData)
    {
        if (InvokeRequired)
        {
            // A background thread wants to change the UI.
            if (iAmInAStateWhereTheUICanBeChanged)
            {
                var callback = new ChangeUICallback(SomeoneWantsToChangeTheUI);
                Invoke(callback, new object[] { sender, uiData });
            }
        }
        else
        {
            // This is on the UI thread, either because it was called from the UI or was marshalled.
            ChangeTheUI(uiData)
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T18:52:55.427

传递 System.ComponentModel.ISynchronizeInvoke 怎么样？这样你就可以避免传递一个控件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T05:06:24.917

将 UI 操作放在要操作的表单上的方法中，并将委托传递给在后台线程上运行的代码，à la APM。您不必使用`params object p`，您可以强烈键入它以适合您自己的目的。这只是一个简单的通用示例。

```
delegate UiSafeCall(delegate d, params object p);
void SomeUiSafeCall(delegate d, params object p)
{
  if (InvokeRequired) 
    BeginInvoke(d,p);        
  else
  {
    //do stuff to UI
  }
} 
```

这种方法基于委托引用特定实例上的方法这一事实。通过使实现成为表单的方法，您可以将表单作为`this`. 以下在语义上是相同的。

```
delegate UiSafeCall(delegate d, params object p);
void SomeUiSafeCall(delegate d, params object p)
{
  if (this.InvokeRequired) 
    this.BeginInvoke(d,p);        
  else
  {
    //do stuff to UI
  }
} 
```

# ruby-on-rails - 有没有办法在不先实例化对象的情况下验证 ActiveRecord 上的特定属性？

> ID：457239
> 
> 赞同：10
> 
> 时间：2009-01-19T10:58:00.103
> 
> 标签：ruby-on-rails, ruby, validation, activerecord

例如，如果我有一个用户模型并且我只需要验证登录（这可能在通过 ajax 验证表单时发生），如果我使用在用户模型中定义的相同模型验证而不实际实例化用户实例，那就太好了.

所以在控制器中我可以编写类似的代码

```
User.valid_attribute?(:login, "login value") 
```

无论如何我可以做到这一点吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-19T11:28:31.320

由于验证对实例进行操作（并且它们使用实例的 errors 属性作为错误消息的容器），因此您不能在没有实例化对象的情况下使用它们。话虽如此，您可以将这种需要的行为隐藏到类方法中：

```
class User < ActiveRecord::Base
  def self.valid_attribute?(attr, value)
    mock = self.new(attr => value)
    unless mock.valid?
      return mock.errors.has_key?(attr)
    end
    true
  end
end 
```

现在，您可以致电

```
User.valid_attribute?(:login, "login value") 
```

正如你所愿。

（理想情况下，您应该将该类方法直接包含在 ActiveRecord::Base 中，这样它就可用于每个模型。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-10-26T17:58:08.740

谢谢米兰的建议。受此启发，我创建了一个简单的模块，可用于将此功能添加到任何类。请注意，最初的 Milans 建议有一个逻辑错误，如下所示：

```
return mock.errors.has_key?(attr) 
```

显然应该是：

```
return (not mock.errors.has_key?(attr)) 
```

我已经测试了我的解决方案，它应该可以工作，但我不保证。这是我光荣的解决方案。如果你拿走模块的东西，基本上是一个 2-liner。它接受方法名称作为字符串或符号。

```
module SingleAttributeValidation

  def self.included(klass)
    klass.extend(ClassMethods)
  end

  module ClassMethods
    def valid_attribute?(attr, value)
      mock = self.new(attr => value)
      (not mock.valid?) && (not mock.errors.has_key?(attr.class == Symbol ? attr : attr.to_sym))
    end
  end
end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T11:29:03.347

要使用您的标准验证例程：

```
 User.new(:login => 'login_value').valid? 
```

如果这对您不起作用，请为此构建一个自定义类方法：

```
 class User < ActiveRecord::Base

  validate do |user|
    user.errors.add('existing') unless User.valid_login?(user.login)
  end

  def self.valid_login?(login)
    # your validation here
    !User.exist?(:login=> login)
  end
end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-10-29T23:46:21.337

我花了很长时间让它在 Rails 3.1 中工作。这终于奏效了。（不确定这是否是最好的方法，我是新手。）。我遇到的问题是该值被设置为 ActiveSupport::SafeBuffer 类型，并且验证失败。

```
def self.valid_attribute?(attr, value)
  mock = User.new(attr => "#{value}") # Rails3 SafeBuffer messes up validation
  unless mock.valid?
    return (not mock.errors.messages.has_key?(attr))
  end
  return true
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T11:45:25.873

我已经使用了自定义类解决方案，但我只是想确保没有更好的方法

```
class ModelValidator
  def self.validate_atrribute(klass, attribute, value)
    obj = Klass.new
    obj.send("#{attribute}=", value)
    obj.valid?
    errors = obj.errors.on(attribute).to_a
    return (errors.length > 0), errors 
  end
end 
```

我可以像使用它一样

有效，错误 = ModelValidator.validate_attribute(User, "login", "humanzz")

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T12:51:44.087

```
class User < ActiveRecord::Base
  validates_each :login do |record, attr, value|
    record.errors.add attr, 'error message here' unless User.valid_login?(value)
  end

  def self.valid_login?(login)
    # do validation
  end
end 
```

只需调用 User.valid_login?(login) 即可查看登录本身是否有效

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T13:05:19.533

您建议的“valid_attribute”方法的实现：

```
class ActiveRecord:Base
  def self.valid_attribute?(attribute, value)
    instance = new
    instance[attribute] = value
    instance.valid?

    list_of_errors = instance.errors.instance_variable_get('@errors')[attribute]

    list_of_errors && list_of_errors.size == 0
  end
end 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-25T03:27:01.593

怎么样：

User.columns_hash.has_key?('lo​​gin')

# c# - foreach 到 linq 提示通缉

> ID：457243
> 
> 赞同：2
> 
> 时间：2009-01-19T10:59:14.453
> 
> 标签：c#, linq

我如何在 linq 中执行此操作？

```
var p = new pmaker();

 foreach (var item in itemlist)
 {
   var dlist = new List<Dummy>();
   foreach (var example in item.examples)
   { 
     dlist.Add(example.GetDummy()); 
   }
   p.AddStuff(item.X,item.Y,dlist);
 }

// .. do stuff with p 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T11:08:00.347

怎么样：

```
var qry = from item in itemlist
          select new {item.X, item.Y,
              Dummies = item.examples.Select(
                ex => ex.GetDummy())
          };
foreach (var item in qry)
{
    p.AddStuff(item.X, item.Y, item.Dummies.ToList());
} 
```

不确定它是否更清晰，虽然......我个人认为我可能只使用原始`foreach`版本......也许会分开`GetDummy`一点：

```
foreach (var item in itemlist)
{
    var dlist = item.examples.Select(ex => ex.GetDummy()).ToList();
    p.AddStuff(item.X,item.Y,dlist);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T11:58:39.950

如果`itemlist`是一个`List<T>`集合，你可以这样做：

```
var p = new pmaker();
itemlist.ForEach(item => 
  p.AddStuff(item.X, item.Y, 
      (from ex in item.examples
       select ex.GetDummy()).ToList())
); 
```

但如果这样更清楚？我认为不是，您不应该仅仅因为喜欢就使用 LINQ 和委托，而是因为它更好地说明了代码的意图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T12:44:48.873

扩展 Marc 的答案，您可以使用`All`将项目添加到 p，但它`All`有点滥用，除非`p.AddStuff`可能失败。

```
(var qry = from item in itemlist
      select new {item.X, item.Y,
          Dummies = item.examples.Select(
            ex => ex.GetDummy())
      }).All(item=>{p.AddStuff(item.X, item.Y, item.Dummies.ToList()); return true;}); 
```

如果`p.AddStuff`可能失败并且您想确保添加了所有项目，那么这样做是完全合适的：

```
bool allAdded = (var qry = from item in itemlist
      select new {item.X, item.Y,
          Dummies = item.examples.Select(
            ex => ex.GetDummy())
      }).All(item=>p.AddStuff(item.X, item.Y, item.Dummies.ToList())); 
```

# python - What is the best real time plotting widget for wxPython?

> ID：457246
> 
> 赞同：16
> 
> 时间：2009-01-19T11:00:38.630
> 
> 标签：python, wxpython, wxwidgets

I would like to show a real time graph with one or two curves an up to 50 samples per second using Python and wxPython. The widget should support both Win32 and Linux platforms.

Any hints are welcome.

Edited to add:

I don't need to update the display at 50 fps, but up need to show up to 50 samples of data on both curves, with a reasonable update rate for the display (5..10 fps should be okay).

Edited to add:

I have used mathplotlib in a project with good success. I have then settled for wx.lib.plot for other projects, which I found to be simpler, but somewhat easier to use and consuming less CPU cycles. As wx.lib comes as part of the standard wxPython distribution is is particularly easy to use.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-09-30T01:24:00.377

如果您想以最少的代码占用量获得高性能，那么看看 Python 的内置绘图库 tkinter。无需编写特殊的 C/C++ 代码或使用大型绘图包即可获得优于 50 fps 的性能。

![截屏](https://i.stack.imgur.com/CGK8y.png)

以下代码在 2.2 GHz Core 2 duo 上以 400 fps 滚动 1000x200 条形图，在 3.4 GHz Core i3 上以 1000 fps 滚动。中央例程“scrollstrip”在右边缘绘制一组数据点和相应的颜色以及一个可选的垂直网格条，然后将条形图向左滚动 1。要绘制水平网格条，只需将它们包含在数据和颜色中数组作为常量以及变量数据点。

```
from tkinter import *
import math, random, threading, time

class StripChart:

    def __init__(self, root):
        self.gf = self.makeGraph(root)
        self.cf = self.makeControls(root)
        self.gf.pack()
        self.cf.pack()
        self.Reset()

    def makeGraph(self, frame):
        self.sw = 1000
        self.h = 200
        self.top = 2
        gf = Canvas(frame, width=self.sw, height=self.h+10,
                    bg="#002", bd=0, highlightthickness=0)
        gf.p = PhotoImage(width=2*self.sw, height=self.h)
        self.item = gf.create_image(0, self.top, image=gf.p, anchor=NW)
        return(gf)

    def makeControls(self, frame):
        cf = Frame(frame, borderwidth=1, relief="raised")
        Button(cf, text="Run", command=self.Run).grid(column=2, row=2)
        Button(cf, text="Stop", command=self.Stop).grid(column=4, row=2)
        Button(cf, text="Reset", command=self.Reset).grid(column=6, row=2)
        self.fps = Label(cf, text="0 fps")
        self.fps.grid(column=2, row=4, columnspan=5)
        return(cf)

    def Run(self):
        self.go = 1
        for t in threading.enumerate():
            if t.name == "_gen_":
                print("already running")
                return
        threading.Thread(target=self.do_start, name="_gen_").start()

    def Stop(self):
        self.go = 0
        for t in threading.enumerate():
            if t.name == "_gen_":
                t.join()

    def Reset(self):
        self.Stop()
        self.clearstrip(self.gf.p, '#345')

    def do_start(self):
        t = 0
        y2 = 0
        tx = time.time()
        while self.go:
            y1 = 0.2*math.sin(0.02*math.pi*t)
            y2 = 0.9*y2 + 0.1*(random.random()-0.5)
            self.scrollstrip(self.gf.p,
               (0.25+y1,   0.25, 0.7+y2,   0.6,     0.7,   0.8),
               ( '#ff4', '#f40', '#4af', '#080', '#0f0', '#080'),
                 "" if t % 65 else "#088")

            t += 1
            if not t % 100:
                tx2 = time.time()
                self.fps.config(text='%d fps' % int(100/(tx2 - tx)))
                tx = tx2
#            time.sleep(0.001)

    def clearstrip(self, p, color):  # Fill strip with background color
        self.bg = color              # save background color for scroll
        self.data = None             # clear previous data
        self.x = 0
        p.tk.call(p, 'put', color, '-to', 0, 0, p['width'], p['height'])

    def scrollstrip(self, p, data, colors, bar=""):   # Scroll the strip, add new data
        self.x = (self.x + 1) % self.sw               # x = double buffer position
        bg = bar if bar else self.bg
        p.tk.call(p, 'put', bg, '-to', self.x, 0,
                  self.x+1, self.h)
        p.tk.call(p, 'put', bg, '-to', self.x+self.sw, 0,
                  self.x+self.sw+1, self.h)
        self.gf.coords(self.item, -1-self.x, self.top)  # scroll to just-written column
        if not self.data:
            self.data = data
        for d in range(len(data)):
            y0 = int((self.h-1) * (1.0-self.data[d]))   # plot all the data points
            y1 = int((self.h-1) * (1.0-data[d]))
            ya, yb = sorted((y0, y1))
            for y in range(ya, yb+1):                   # connect the dots
                p.put(colors[d], (self.x,y))
                p.put(colors[d], (self.x+self.sw,y))
        self.data = data            # save for next call

def main():
    root = Tk()
    root.title("StripChart")
    app = StripChart(root)
    root.mainloop()

main() 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-19T14:40:50.027

创建一个可以从您的数据源读取并真正以 50 FPS 更新的 C++ 小部件并不难。这种方法的美妙之处在于，很少（如果有的话）Python 代码将以 50FPS 的速度执行，它们都在 C++ 中，这取决于您如何将更新的数据传递给小部件。

您甚至可以从 Python 端将事件处理程序推送到自定义实时数据查看器中，以处理所有鼠标事件和用户交互，而只保留 C++ 中的呈现。

这将是一个扩展 wxWidget 的 wxWindow 类的小型 C++ 类

类 RealtimeDataViewer: 公共 wxWindow { ...

并覆盖 OnPaint

无效 OnPaint(wxPaintEvent &WXUNUSED(event)) { ....

然后它会得到一个设备上下文，并开始绘制线条和形状......

然后，您必须获取 .h 文件，并将其复制到 .i 中，并对其稍作调整以使其成为 SWIG 可用于扩展 wxPython 的定义。

构建过程可以由 Python 自己的 distutils 使用以下参数进行设置：

```
 ext_modules=[Extension('myextension', sources, 
                          include_dirs=includeDirs
                          library_dirs=usual_libs,
                          )], 
```

让它看起来很棒并且运行良好需要几天的工作......但这可能是真正加速您的项目进入未来的一种选择。

所有这些都在 Mac、Windows 和 Linux 上运行良好。

wxPython 真的是一个隐藏的宝石，它将通过更专业支持的 IDE/设计器工具真正接管世界。

也就是说，先试试 matplotlib，它有很多漂亮的优化渲染，而且还可以实时更新。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T12:57:15.197

如果你真的想要每秒 50 帧的快速东西，我认为你需要像 PyGame 这样的东西，并直接与显示器对话，而不是绘图模块。

检查相关线程：

*   [在 Python 中从离散像素值绘制图像的最快方法是什么？](https://stackoverflow.com/questions/434583/what-is-the-fastest-way-to-draw-an-image-from-discrete-pixel-values-in-python#434801)
*   [https://stackoverflow.com/search?q=python+pygame](https://stackoverflow.com/search?q=python+pygame)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-09-30T05:21:06.350

我将[PyQtGraph](http://www.pyqtgraph.org/)用于这种事情。它在实时绘图方面比 Matplotlib 快得多，并且具有许多不错的便利功能，例如绘图画布中的上下文菜单，具有自动缩放和滚动功能，无需任何额外工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T11:27:17.780

Maybe [Chaco](http://code.enthought.com/chaco/)? I don't know if it can do 50 frames per second, but I saw in a demonstration how it did very smooth realtime plotting. It should definitely be faster than matplotlib.

# asp.net-mvc - Blog Architecture Design, using MVC and DDD

> ID：457249
> 
> 赞同：2
> 
> 时间：2009-01-19T11:01:56.210
> 
> 标签：asp.net-mvc, domain-driven-design, repository-pattern, blogs

I'm designing a blog architecture on asp.net mvc. Lets say i only have 2 entities: post and comment. do i need a controller and a repository for each one? how goes the mechanism for displaying a post with it's comments? do the post controller looks in the posts repository for the post, then asks the comment controller to retrieve all the comments connected to this post, gets them from the comments controller and passes them to the view? or maybe i should write a service which is responsible for querying both repositories and returning the results to the posts controller, which passes them to the view?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T11:17:03.590

Perhaps the first thing to note is what features will your blog have and make available for its primary functions :

*   editing
*   subscription
*   comments
*   authenticating users - eg identifying the blog owner and posters.

What other ideas will yourblog have ? Are you going to try out some new Kool ideas that you might not have seen elsewhere ? If so like what ?

The first questions that need answers are your requirements then you can start worrying about architecture and technology stacks and how to codethis or that type questions. Either way your ideas and questions are most eagerly wanted here :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T16:47:03.643

我不确定您使用的是什么 ORM，但我只会有一个 Posts 存储库。当我要求发表文章时，应附上所有评论（根据具体情况懒惰或急切地加载）。在 DDD 术语中，如果您想以这种方式查看它，我认为您会将其描述为 Posts 实体是“Posts”聚合的根。

不过，我认为在一个控制器中拥有两个存储库没有任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-09T18:14:26.377

您可以查看示例，例如

*   [基格](http://www.codeplex.com/Kigg)
*   [氧化物](http://www.codeplex.com/oxite)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-24T14:08:56.000

您可能会对讨论 ASP.NET MVC + CSLA + DDD的[另](https://stackoverflow.com/questions/775465/is-asp-net-mvc-csla-ddd-possible)一篇文章感兴趣。它提供了将它们一起使用的很好的项目示例。

# sql - 如何选择一列唯一的一组随机记录？

> ID：457257
> 
> 赞同：0
> 
> 时间：2009-01-19T11:03:53.460
> 
> 标签：sql, random

今天我一直在努力解决这个 SQL 查询要求，我想知道是否有人可以帮助我。

我有一张运动问题表。其中一列是与问题相关的团队。我的要求是返回一组独特的随机问题。

因此，假设我们有下表并想要 5 个问题：

```
Question        Answer        Team
-----------------------------------
question 1      answer 1      team A
question 2      answer 2      team B
question 3      answer 3      team B
question 4      answer 3      team D
question 5      answer 3      team A
question 6      answer 3      team C
question 7      answer 3      team F
question 8      answer 3      team C
question 9      answer 3      team G
question 10     answer 3      team D 
```

一个有效的结果将返回：

```
question 1      answer 1      team A
question 2      answer 2      team B
question 4      answer 3      team D
question 6      answer 3      team C
question 7      answer 3      team F 
```

我觉得应该可以通过巧妙地使用 Distinct 和 Take 将其作为一个干净的 SQL 语句来完成，但我还没有能够做到这一点。

迄今为止最好的解决方案来自[Mladen Prajdic](https://stackoverflow.com/users/31345/mladen-prajdic)。我刚刚稍微更新了它以改善它的随机性：

```
SELECT TOP 10 * 
FROM    (SELECT ROW_NUMBER() OVER(PARTITION BY Team ORDER BY Team, NEWID()) AS RN, *
    FROM Question
    ) teams
WHERE   RN = 2
ORDER BY NEWID() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T11:17:44.133

对于 sql 2005，您可以这样做：

```
select top 5 * 
from    (
            select ROW_NUMBER() over(partition by team order by team) as RN, *
            from @t 
        ) t
where RN = 1
order by NEWID() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T11:16:54.230

在 oracle 中，这应该可以满足您的需要；对于不同的数据库，您显然需要使用他们的随机数源。可能有更好的方法；让我们希望其他人会向我们指出这一点：p

```
select question, answer, team
from
(
select question, answer, team, r
from
(
select 
    question, 
    answer, 
    team,
    rank() over (partition by team order by dbms_random.value) r 
from questions
)
where r = 1
order by dbms_random.value
) where rownum<=5; 
```

测试代码：

```
create table questions(question varchar2(16), answer varchar2(16), team varchar2(16));

insert into questions(question, answer, team)
values ('question 1',      'answer 1',      'team A');

insert into questions(question, answer, team)
values ('question 2',      'answer 2',      'team B');

insert into questions(question, answer, team)
values ('question 3',      'answer 3',      'team B');

insert into questions(question, answer, team)
values ('question 4',      'answer 3',      'team D');

insert into questions(question, answer, team)
values ('question 5',      'answer 3',      'team A');

insert into questions(question, answer, team)
values ('question 6',      'answer 3',      'team C');

insert into questions(question, answer, team)
values ('question 7',      'answer 3',      'team F');

insert into questions(question, answer, team)
values ('question 8',      'answer 3',      'team C');

insert into questions(question, answer, team)
values ('question 9',      'answer 3',      'team G');

insert into questions(question, answer, team)
values ('question 10',    'answer 3',      'team D');

commit; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T11:22:01.363

在 PostgreSQL（它有不同的 on）中，我可能会做这样的事情：

```
select distinct on (Team) Question, Answer, Team from test order by Team, random() limit 5; 
```

刚刚测试过。似乎工作。

# sql-server - Maintaining audit log for entities split across multiple tables

> ID：457259
> 
> 赞同：3
> 
> 时间：2009-01-19T11:05:12.523
> 
> 标签：sql-server, triggers, history, logging, audit

We have an entity split across 5 different tables. Records in 3 of those tables are mandatory. Records in the other two tables are optional (based on sub-type of entity).

One of the tables is designated the entity master. Records in the other four tables are keyed by the unique id from master.

After update/delete trigger is present on each table and a change of a record saves off history (from deleted table inside trigger) into a related history table. Each history table contains related entity fields + a timestamp.

So, live records are always in the live tables and history/changes are in history tables. Historical records can be ordered based on the timestamp column. Obviously, timestamp columns are not related across history tables.

Now, for the more difficult part.

1.  Records are initially inserted in a single transaction. Either 3 or 5 records will be written in a single transaction.
2.  Individual updates can happen to any or all of the 5 tables.
3.  All records are updated as part of a single transaction. Again, either 3 or 5 records will be updated in a single transaction.
4.  Number 2 can be repeated multiple times.
5.  Number 3 can be repeated multiple times.

The application is supposed to display a list of point in time history entries based on records written as single transactions only (points 1,3 and 5 only)

I'm currently having problems with an algorithm that will retrieve historical records based on timestamp data alone.

Adding a HISTORYMASTER table to hold the extra information about transactions seems to partially address the problem. A new record is added into HISTORYMASTER before every transaction. New HISTORYMASTER.ID is saved into each entity table during a transaction. Point in time history can be retrieved by selecting the first record for a particular HISTORYMASTER.ID (ordered by timestamp)

Is there any more optimal way to manage audit tables based on AFTER (UPDATE, DELETE) TRIGGERs for entities spanning multiple tables?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T16:47:08.357

您的 HistoryMaster 似乎类似于我们在其中一个系统中处理多个相关项目的历史记录的方式。通过单点挂起历史表中的所有相关更改，很容易创建一个使用历史主机作为中心并附加相关信息的视图。它还允许您*不在不需要*审计的历史记录中创建记录。

在我们的例子中，主表被称为 EntityAudit（实体是保留的“主要”项目），所有数据都存储在与审计相关的 EntityHistory 表中。在我们的案例中，我们将数据层用于业务规则，因此很容易将审计规则插入数据层本身。我认为*当且仅当*所有修改都使用该数据层时，数据层才是这种跟踪的最佳点。如果您有多个应用程序使用不同的数据层（或根本没有），那么我怀疑创建主记录的触发器几乎是唯一的方法。

如果您在审核中没有要跟踪的*其他*信息（我们跟踪进行更改的用户，例如，不在主表上的内容），那么我会考虑将额外的审核 ID 放在“主要”记录本身上。您的描述似乎并不表明您对单个表的微小更改感兴趣，而只是对更新整个实体集的更改感兴趣（尽管我可能会错过阅读）。如果您不关心次要编辑，我只会这样做。在我们的案例中，我们需要跟踪*所有*更改，甚至是相关记录。

请注意，使用 Audit/Master 表的优势在于，与源表相比，您对 History 表所做的更改*最少*：单个 AuditID（在我们的示例中为 Guid，尽管自动编号在非分布式数据库）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-15T23:35:06.390

您可以将 TimeStamp / RowVersion 数据类型列添加到实体主表，并将所有审计记录与之关联吗？

但是对任何“子”表的更新都需要更新主实体表以强制 TimeStamp / RowVersion 更改:(

或者在其中粘贴一个 GUID，只要相关记录之一发生更改，您就可以对其进行更新。

通过大声思考，最好将一个表以 1:1 的比例连接到主实体，该表仅包含主实体 ID 和记录的“版本号”——TimeSTamp / RowVersion、GUI​​D、递增的数字，或别的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T06:29:02.817

我认为这是试图在应用程序堆栈的最低级别（数据库）捕获“抽象”审计事件的症状。

如果可能，请考虑在业务层中捕获审计事件。这将允许您捕获每个逻辑事务的历史记录，而不是逐行记录。日期/时间对于解决此类问题是不可靠的，因为它对于不同的行可能不同，而对于并发（或紧密间隔的）事务则相同。

我知道您已经问过如何在数据库触发器中执行此操作。我不了解 SQL Server，但在 Oracle 中，您可以通过使用**DBMS_TRANSACTION.LOCAL_TRANSACTION_ID**系统包返回当前事务的 ID 来克服这个问题。如果您可以检索等效的 SQLServer 值，则可以使用它来将当前事务的记录更新绑定到一个逻辑包中。

# javascript - HTML 水平滚动条的高度是多少？

> ID：457262
> 
> 赞同：4
> 
> 时间：2009-01-19T11:06:48.570
> 
> 标签：javascript, html, scroll, height

对于叠加层，我需要知道垂直滚动条的高度。

我能做些什么来获得这个价值？FireFox 和 Internet Explorer 的高度是否相同？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T11:38:28.570

> 我能做些什么来获得这个价值？

```
function getScrollSizes() { // call after document is finished loading
    var el= document.createElement('div');
    el.style.visibility= 'hidden';
    el.style.overflow= 'scroll';
    document.body.appendChild(el);
    var w= el.offsetWidth-el.clientWidth;
    var h= el.offsetHeight-el.clientHeight;
    document.body.removeChild(el);
    return new Array(w, h);
} 
```

> FireFox 和 Internet Explorer 的高度是否相同？

不，Internet Explorer 和 Internet Explorer 中的高度甚至不一样。dpi 设置、主题和操作系统版本等变量也会影响它。

# mysql - 我应该计数（*）还是不？

> ID：457263
> 
> 赞同：75
> 
> 时间：2009-01-19T11:07:27.493
> 
> 标签：mysql, performance, innodb

我知道做这样的查询通常是个坏主意：

```
SELECT * FROM `group_relations` 
```

但是当我只想要计数时，我是否应该进行此查询，因为它允许表更改但仍会产生相同的结果。

```
SELECT COUNT(*) FROM `group_relations` 
```

或者更具体的

```
SELECT COUNT(`group_id`) FROM `group_relations` 
```

我感觉后者可能会更快，但还有其他需要考虑的事情吗？

**更新**：在这种情况下，我使用的是 InnoDB，抱歉没有更具体。

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-01-19T11:12:40.183

如果有问题的列不为空，则您的两个查询都是等效的。当 group_id 包含空值时，

```
select count(*) 
```

将计算所有行，而

```
select count(group_id) 
```

只会计算 group_id 不为空的行。

此外，一些数据库系统，如 MySQL，在您请求 count(*) 时采用了优化，这使得此类查询比特定查询快一点。

就个人而言，当只是数数时，我正在做 count(*) 以保证空值的安全。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-19T11:10:50.950

如果我没记错的话，在 MYSQL 中 COUNT(*) 计算所有行，而 COUNT(column_name) 仅计算给定列中具有非 NULL 值的行。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-19T11:32:24.650

COUNT(*) 计算所有行，而 COUNT(column_name) 将仅计算指定列中没有 NULL 值的行。

MySQL 中需要注意的重要事项：

COUNT() 在 MyISAM 表上对于 * 或非空列非常快，因为行数被缓存。InnoDB 没有行计数缓存，因此 COUNT(*) 或 COUNT(column_name) 的性能没有差异，无论该列是否可以为空。你可以在 MySQL 性能博客上阅读更多关于[这篇文章的差异。](http://www.mysqlperformanceblog.com/2007/04/10/count-vs-countcol/)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-19T11:14:41.317

如果您尝试`SELECT COUNT(1) FROM`group_relations 它会更快一些，因为它不会尝试从您的列中检索信息。

编辑：我刚刚做了一些研究，发现这只发生在某些数据库中。在 sqlserver 中使用 1 或 * 相同，但在 oracle 中使用 1 更快。

[http://social.msdn.microsoft.com/forums/en-US/transactsql/thread/9367c580-087a-4fc1-bf88-91a51a4ee018/](http://social.msdn.microsoft.com/forums/en-US/transactsql/thread/9367c580-087a-4fc1-bf88-91a51a4ee018/)

显然它们在 mysql 中没有区别，就像 sqlserver 一样，解析器似乎将查询更改为 select(1)。对不起，如果我以某种方式误导了你。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-19T21:36:00.463

我自己对此很好奇。阅读文档和理论答案都很好，但我喜欢用经验证据来平衡这些。

我有一个 MySQL 表 (InnoDB)，其中有 5,607,997 条记录。该表在我自己的私有沙箱中，所以我知道内容是静态的，没有其他人在使用服务器。我认为这有效地消除了所有外部对性能的影响。我有一个带有 auto_increment 主键字段 (Id) 的表，我知道它永远不会为空，我将用于我的 where 子句测试 (WHERE Id IS NOT NULL)。

我在运行测试中看到的唯一其他可能的故障是缓存。第一次运行查询总是比使用相同索引的后续查询慢。我将在下面将其称为缓存播种调用。只是为了把它混在一起，我用一个 where 子句运行它，我知道无论任何数据如何（TRUE = TRUE），我都知道它总是评估为真。

这就是我的结果：

查询类型

```
 |  w/o WHERE          | where id is not null |  where true=true 
```

数数（）

```
 |  9 min 30.13 sec ++ | 6 min 16.68 sec ++   | 2 min 21.80 sec ++
      |  6 min 13.34 sec    | 1 min 36.02 sec      | 2 min 0.11 sec 
      |  6 min 10.06 se     | 1 min 33.47 sec      | 1 min 50.54 sec 
```

计数（编号）

```
 |  5 min 59.87 sec    | 1 min 34.47 sec      | 2 min 3.96 sec 
      |  5 min 44.95 sec    | 1 min 13.09 sec      | 2 min 6.48 sec 
```

计数(1)

```
 | 6 min 49.64 sec    | 2 min 0.80 sec       | 2 min 11.64 sec
      | 6 min 31.64 sec    | 1 min 41.19 sec      | 1 min 43.51 sec 
```

++这被认为是缓存播种调用。预计会比其他人慢。

我想说结果不言自明。COUNT(Id) 通常会超出其他项。添加 Where 子句会显着减少访问时间，即使它是您知道将评估为 true 的子句。最佳点似乎是 COUNT(Id)...其中 Id 不为空。

我很想看看其他人的结果，可能是使用较小的表或针对不同字段的 where 子句而不是您计算的字段。我敢肯定还有其他我没有考虑到的变化。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-07-08T06:40:54.680

## 寻找替代品

如您所见，当表变大时，`COUNT`查询会变慢。我认为最重要的是考虑您要解决的问题的性质。例如，许多开发人员`COUNT`在为大型记录集生成分页时使用查询，以确定结果集中的总页数。

知道`COUNT`查询会变慢，您可以考虑另一种显示分页控件的方法，该方法仅允许您避开缓慢的查询。谷歌的分页就是一个很好的例子。

## 非规范化

如果您绝对必须知道与特定计数匹配的记录数，请考虑数据非规范化的经典技术。与其在查找时计算行数，不如考虑在记录插入时增加一个计数器，并在删除记录时减少该计数器。

如果您决定这样做，请考虑使用幂等事务操作来保持这些非规范化值同步。

```
BEGIN TRANSACTION;
INSERT INTO  `group_relations` (`group_id`) VALUES (1);
UPDATE `group_relations_count` SET `count` = `count` + 1;
COMMIT; 
```

或者，如果您的 RDBMS 支持，您可以使用数据库触发器。

根据您的架构，使用像 memcached 这样的缓存层来存储、递增和递减非规范化的值可能是有意义的，并且在缺少缓存键时简单地使用慢速 COUNT 查询。如果您有非常不稳定的数据，这可以减少整体写入争用，但在这种情况下，您需要考虑[解决狗桩效应的方法](http://blog.kovyrin.net/2008/03/10/dog-pile-effect-and-how-to-avoid-it-with-ruby-on-rails-memcache-client-patch/)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-19T11:39:31.860

MySQL ISAM 表应该对 COUNT(*) 进行优化，跳过全表扫描。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-19T12:00:07.480

COUNT 中的星号与用于选择表的所有字段的星号无关。说 COUNT(*) 比 COUNT(field) 慢纯属胡说八道

我直觉选择 COUNT(*) 比选择 COUNT(field) 快。如果 RDBMS 检测到您在 COUNT 而不是字段上指定了“*”，则它不需要评估任何内容来增加计数。然而，如果您在 COUNT 上指定字段，RDBMS 将始终评估您的字段是否为空或不计算它。

但如果您的字段可以为空，请在 COUNT 中指定该字段。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-09T20:56:11.173

**COUNT(*) 事实和神话：**

**误解**：“InnoDB 不能很好地处理 count(*) 查询”：

如果您有 WHERE 子句，则所有存储引擎都会以相同的方式执行大多数 count(*) 查询，否则 InnoDB 将不得不执行全表扫描。

**事实**：没有 where 子句的 InnoDB 不会优化 count(*) 查询

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-22T22:49:55.240

最好按索引列（例如主键）进行计数。

```
SELECT COUNT(`group_id`) FROM `group_relations` 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-19T11:14:51.003

正如塞巴斯蒂安已经说过的那样，这应该取决于您实际想要实现的目标，即明确您的意图！如果您*只是*计算行数，则选择 COUNT(*)，或者计算单个列，则选择 COUNT(column)。

也可能值得检查您的数据库供应商。当我过去使用 Informix 时，它对 COUNT(*) 进行了优化，与计算单个或多个列相比，它的查询计划执行成本为 1，这将导致更高的数字

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-19T11:44:07.717

> 如果您尝试 SELECT COUNT(1) FROM group_relations 它会更快一些，因为它不会尝试从您的列中检索信息。

COUNT(1) 曾经比 COUNT(*) 快，但现在不是这样了，因为现代 DBMS 足够聪明，知道你不想知道列

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-27T19:28:37.693

我从 MySQL 得到的关于此类事情的建议是，总的来说，从长远来看，尝试基于此类技巧优化查询可能是一个诅咒。在 MySQL 的历史上有一些例子，有人依赖于优化器工作方式的高性能技术最终成为下一个版本的瓶颈。

编写回答您所问问题的查询——如果您想要计算所有行的数量，请使用 COUNT(*)。如果要计算非空列的数量，请使用 COUNT(col) WHERE col IS NOT NULL。适当地索引，并将优化留给优化器。尝试进行自己的查询级优化有时会降低内置优化器的效率。

也就是说，您可以在查询中做一些事情来使优化器更容易加速它，但我不相信 COUNT 是其中之一。

编辑：不过，上面答案中的统计数据很有趣。在这种情况下，我不确定优化器中是否真的有什么东西在起作用。我只是在谈论一般的查询级优化。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-22T23:01:59.943

> 我知道做这样的查询通常是个坏主意：
> 
> ```
> SELECT * FROM `group_relations` 
> ```
> 
> 但是当我只想要计数时，我是否应该进行此查询，因为它允许表更改但仍会产生相同的结果。
> 
> ```
> SELECT COUNT(*) FROM `group_relations` 
> ```

正如您的问题所暗示的那样，`SELECT *`不明智的原因是对表的更改可能需要更改您的代码。这不适用于`COUNT(*)`. 想要给你的特殊行为是非常罕见的`SELECT COUNT('group_id')`——通常你想知道记录的数量。这就是`COUNT(*)`目的，所以使用它。

# asp.net - Add ons in a compiled language

> ID：457275
> 
> 赞同：0
> 
> 时间：2009-01-19T11:14:12.130
> 
> 标签：asp.net, add-on

We are developing a CMS in ASP.NET. We love the idea of add-ons (like in Wordpress, where any developer can add a menu button or a widget) and would like to enable developers to do the same with our system.

However I think that the fact that C# is a compiled language is an obstacle in the way of add-ons.

Am I right? Or is there a way to create add-ons for a ASP.NET application?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T11:32:39.143

C# 是一种编译语言这一事实​​根本不是问题。事实上，.NET 框架应该使加载其他代码相对容易（正如 Java 所做的那样，出于同样的原因）。查看[Managed Extensibility Framework](http://code.msdn.microsoft.com/mef)，它是关于在托管代码中加载附加组件的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T11:43:07.750

这根本不是障碍。[MEF](http://www.codeplex.com/MEF)已经提到过，你也可以使用：

*   [系统插件](http://www.google.com/search?q=system.addin)
*   [单声道插件](http://www.mono-project.com/Mono.Addins)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T11:16:25.417

I'm not sure for ASP.NET specifically, but in the only compiled programming language I know (Objective-C/Cocoa), there's the concept of Bundles that can be loaded dynamically. I'm not sure how that works on the backend, but I'd guess that there is some similar system for C#/ASP.NET.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T11:28:03.163

我不知道它是如何在 Wordpress 中完成的，但应该有很多方法。您可以允许开发人员使用已编译的代码上传他们的程序集，或者您可以允许他们上传 C# 或 IronPython 或任何支持的代码并动态编译它。也许您可以使用[WebParts](http://msdn.microsoft.com/en-us/library/e0s9t4ck.aspx)来完成您的任务。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T11:32:17.927

Microsoft 已创建[托管可扩展性框架 (MEF)](http://CodePlex.Com/MEF/)，专门针对此问题：为 .NET 应用程序提供 .NET 插件。它是 Visual Studio（未来版本）用于编写托管插件的框架。

但是，*请*考虑为此使用动态脚本语言！像这样的问题*正是*它们专门设计的。如果您在应用程序中托管[动态语言运行时](http://CodePlex.Com/DLR/)，这不仅意味着您的用户可以*使用*脚本语言扩展应用程序，甚至可以使用存在 DLR 实现的*任何*动态语言（脚本或其他）：Ruby、Python、Smalltalk 、Scheme、JavaScript、PHP，应有尽有。最大的缺点：DLR 尚未发布。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T11:35:37.407

在 C# 中，您可以创建任何程序集，将它们链接为 DLL 文件，然后做任何您想做的事情。

通常的情况是定义某种必须由所有插件实现的插件接口。

然后，您可以从文件系统加载所有插件（通过迭代插件 DLL），找到实现接口的类，实例化它并使用它。

如果您想为插件提供可卸载性和安全性，您可以创建一个应用程序域并将插件加载到该域，这会增加复杂性，但也会增加稳定性（糟糕的插件不会使您的应用程序崩溃）。

如果您想要一个具体的答案，请更具体地询问:-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T11:37:12.817

把钩子放在适当的位置并不难。您必须提前定义附加功能将出现的位置。例如：绘制菜单时，您可以使用反射在其他 dll（具有特定名称和位置）中搜索“BuildMenu”功能。您将为此函数签名定义 API。它可能必须返回要添加到基本菜单项集合的项目列表。

# java - JUnit 4 测试套件

> ID：457276
> 
> 赞同：102
> 
> 时间：2009-01-19T11:14:13.440
> 
> 标签：java, junit, test-suite

如何使用 JUnit 4 创建测试套件？

我看到的所有文档似乎都不适合我。如果我使用 Eclipse 向导，它不会给我一个选项来选择我创建的任何测试类。

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2009-01-19T11:22:20.147

```
import org.junit.runners.Suite;
import org.junit.runner.RunWith;

@RunWith(Suite.class)
@Suite.SuiteClasses({TestClass1.class, TestClass2.class})
public class TestSuite {
  //nothing
} 
```

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2011-02-10T00:41:41.977

你可以像这样创建一个套件。例如，一个`AllTest`套件看起来像这样。

```
package my.package.tests;

@RunWith(Suite.class)
@SuiteClasses({
    testMyService.class,
    testMyBackend.class,
    ...
})

public class AllTests {} 
```

现在您可以通过几种不同的方式运行它：

1.  右键单击并在 Eclipse 中作为 Junit 测试运行
2.  创建一个可运行的 Java 应用程序；**主类**='org.junit.runner.JUnitCore' 和**Args** ='my.package.tests.AllTests'
3.  从命令行运行：

    ```
    $ java -cp build/classes/:/usr/share/java/junit4.jar:/usr/share/java/hamcrest-core.jar org.junit.runner.JUnitCore my.package.tests.AllTests 
    ```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-19T11:19:41.977

我认为 TestSuite 已经失宠了。这可能是 4.x 之前的风格，但据我所知现在不是。

我只是注释我想要的测试，然后运行课程。运行所有带注释的测试。我可能会使用 Ant，但大多数时候我让 IntelliJ 为我运行它们。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-09-24T22:31:06.723

以下是在 Eclipse 中创建 JUnit 套件的步骤：

1.  在 eclipse 'Java' 透视图的 'Package Explorer' 视图中，在 eclipse java 项目内的包中选择您的单元测试。
2.  右键单击任何一个选定的测试。
3.  在弹出菜单中，选择新建、其他...</li>
4.  打开“Java”文件夹，然后打开“JUnit”文件夹
5.  选择“JUnit Test Suite”，然后选择“下一步”按钮
6.  选择按钮“完成”
7.  结果：创建了“AllTests.java”套件文件，并自动包含测试
8.  在eclipse中选择运行按钮
9.  结果：套件中的所有测试都运行
10.  您现在可以使用 ANT、Jenkins 或其他构建配置持续集成工具指向此套件文件。

版本信息：这适用于 Eclipse Neon 和 JUnit 4。您也可以在步骤 6 中选择“完成”之前选择 JUnit 3。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T11:20:05.673

在我的脑海中创建一个TestSuite 并调用addTests。如果您想查看某些源代码，请尝试任何开源库，例如 hibernate 或 apache 中的某些东西，并在源代码的测试目录下查看测试套件...

# java - sun.java2d.loops.ProcessPath$Point

> ID：457281
> 
> 赞同：0
> 
> 时间：2009-01-19T11:15:48.553
> 
> 标签：java, memory, loops, profiling, point

我突然使用大量内存分析应用程序，我得到了这个：

sun.java2d.loops.ProcessPath$Point

因为被分配了近 11.000.000 次。

它是什么，有解决办法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T11:25:28.347

我最初的反应是质疑这是否实际上使用了大量的内存/CPU 周期？这些`sun.`包是 Sun 的 JVM 的内部实现，因此它们很可能是您的代码正在做什么的低级细节。如果这些对象占用了大量内存，这可能是个问题，但仅仅看到 1100 万次分配并不表明有任何异常。

**编辑**：一点谷歌搜索似乎表明这是一个用于编码对 2D 平面上特定点的引用的对象。很有可能，如果您正在做任何涉及图形的事情，那么是的，您会生成大量的图形。此外，每个只存储两个整数（x 和 y 坐标）和一个布尔值，因此它们在总体方案中将是非常小的对象。即使这 1100 万个分配中没有一个被垃圾回收（而且我预计大多数是局部变量，所以会很快被回收），那么它们也不会占堆的很大一部分，除非你是在具有少量 RAM 的设备上运行。

换句话说，在别处寻找你的问题。查看占用大量当前堆空间的对象可能会更有帮助，甚至查看当前引用的对象数量，以便找到您的泄漏。阅读有关如何使用您选择的工具查找和消除内存泄漏的指南的文档。查看总分配很少有用，除非您知道给定的类应该有多少（例如，检查单例是否只创建一次可能会很好）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T12:04:41.793

我解决了内存问题。我正在做一些讨厌的参考处理我的代码中的一些地方。

# database - What is the benefit of Connection and Statement Pooling?

> ID：457287
> 
> 赞同：22
> 
> 时间：2009-01-19T11:17:17.660
> 
> 标签：database, connection-pooling, c3p0

Can someone explain what is Connection and Statement Pooling and what is the benefit over unpooled DataSources? I am trying to understand when it is a good idea to use a technology like c3p0 or proxool in a project. I need first to understand what they do and when it interesting to use them. Thank you very much.

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2013-04-19T15:34:49.680

## 快乐的连接

每次创建新连接都非常容易。**一行：**仅此而已。没什么好想的。伟大的生活。

## 坚持，稍等。你吃盘子吗？

![在此处输入图像描述](https://i.stack.imgur.com/Ygrk1.png)

每次使用后你会扔掉你的盘子吗？

不，你把它洗干净放在盘子架上，这样你下一顿饭就可以再用了。每次都买新盘子是不可能的。如果你这样做了，你将浪费足够的钱在一年内购买一台新 iPad。

再次考虑连接池。

但是这一次，连接是你的盘子，连接池是你的盘子架。你的钱包和你的能量代表了系统资源（内存和带宽）。

## 洗还是花？

你更愿意做什么：

一个。洗碗

湾。还是每顿饭都跑到商场买新盘子？

虽然连接池涉及一些任务，但从长远来看，与每次创建新连接相比，它的工作量更少。关键是要知道您的家人（应用程序）在任何一天需要多少板（连接）。

池可用于数据库连接、线程、实体 bean 和其他工厂派生对象。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-19T11:23:28.803

Creating a network connection to a database server is (relatively) expensive. Likewise asking the server to prepare a SQL statement is (relatively) expensive.

Using a connection/statement pool, you can reuse existing connections/prepared statements, avoiding the cost of initiating a connection, parsing SQL etc.

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-19T11:24:01.453

I am not familiar with c3p0, but the benefits of pooling connections and statements include:

1.  Performance. Connecting to the database is expensive and slow. Pooled connections can be left physically connected to the database, and shared amongst the various components that need database access. That way the connection cost is paid for once and amortized across all the consuming components.

2.  Diagnostics. If you have one sub-system responsible for connecting to the database, it becomes easier to diagnose and analyze database connection usage.

3.  Maintainability. Again, if you have one sub-system responsible for handing out database connections, your code will be easier to maintain than if each component connected to the database itself.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T11:22:30.757

Connecting and disconnecting from a database is an expensive operation. By using pooling you can write your code to open and close connections but the pool decides when to actually do it, leaving a certain number of connections open for a certain time.

Statement pooling? Are you talking about statement caching?

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-24T11:55:46.490

引用*JAVA Persistance with Hibernate一书*

> 使用游泳池的三个原因：
> 
> *   获取新连接的成本很高。一些数据库管理系统甚至为每个连接启动一个全新的服务器进程。
>     
>     
> *   维护许多空闲连接对于数据库管理系统来说是昂贵的，并且池可以优化空闲连接的使用（或者如果没有请求则断开连接）。
>     
>     
> *   对于某些驱动程序来说，创建准备好的语句也很昂贵，并且连接池可以缓存跨请求连接的语句。

# mysql - Symfony Propel criteria

> ID：457290
> 
> 赞同：1
> 
> 时间：2009-01-19T11:18:02.263
> 
> 标签：mysql, symfony1, criteria, propel

Is there any possible way to convert the MySQL object into criteria object? I tried this query:

```
select 
  p.disrepid, 
  p.subject, p.body, 
  c.disrepid as disrepid1, 
  c.subject as subject1, 
  c.body as body1 
from discusreply as p, discusreply as c 
where p.distopid=' . $this->id . ' 
  and (c.disrepid = p.parentid or c.parentid = p.distopid) 
order by p.disrepid ASC 
```

I tried a lot for converting this query into a `Criteria`, But nothing happened. I want this criteria object for passing this into Pager class for completing the pagination. `$pager->setCriteria($c);`.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-06T21:52:10.777

您可以使用自己的 SQL 执行查询，但没有自动方式将 sql 转换为 Criteria 对象。

```
$con = Propel::getConnection(DATABASE_NAME);
$sql = "SELECT books.* FROM books 
    WHERE NOT EXISTS (SELECT id FROM review WHERE book_id = book.id)";
$stmt = $con->createStatement();
$rs = $stmt->executeQuery($sql, ResultSet::FETCHMODE_NUM);
$books = BookPeer::populateObjects($rs); 
```

这会一起绕过 Criterion 对象。您提到想要一个标准对象，以便您可以将其输入寻呼机。您可以改为在寻呼机中设置自定义选择方法，然后该寻呼机将执行您的自定义查询。如果您需要向其中传递参数，我建议使用您自己的寻呼机类扩展 sfPropel，该类可以选择将参数传递给您的对等选择方法，因此您根本不必使用 Criteria 对象。作为一种快速的替代方法，您可以执行以下操作，将您的 Criteria 用作您选择参数的容器：

```
$c = new Criteria();
$c->add(DiscussreplyPeer::ID, $myId);
$pager = new sfPropelPager();
$pager->setCriteria($c);
$pager->setPeerMethod('getReplies'); 
```

然后在你的同龄人中：

```
public static function getReplies(Criteria $c) {
    $map = $c->getMap();
    $replyId = $map[DiscussreplyPeer::ID]->getValue();

    $con = Propel::getConnection(DATABASE_NAME);
    $sql = "select p.disrepid, p.subject, p.body, c.disrepid as disrepid1, c.subject as subject1, c.body as body1 from discusreply as p, discusreply as c where p.distopid=? and (c.disrepid = p.parentid or c.parentid = p.distopid) order by p.disrepid ASC";

    $stmt = $con->prepareStatement($sql);
    $stmt->setString(1, $replyId);

    $rs = $stmt->executeQuery();

    $results = array();
    while ($rs->next()) {
      // for example
        $results['disrepid'] = $rs->getInt('disrepid');
    }

    return $results;
} 
```

有关推进和 symfony 的更多提示可以在以下位置找到： [http ://stereointeractive.com/blog/2007/06/12/propel-queries-using-custom-sql-peer-classes-and-criterion-objects/](http://stereointeractive.com/blog/2007/06/12/propel-queries-using-custom-sql-peer-classes-and-criterion-objects/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T16:26:55.820

[该站点](http://propel.jondh.me.uk/)对学习编写标准有很大帮助——您可以使用它从伪 SQL 生成标准代码。我还建议获取[Symfony/Propel 备忘单](http://trac.symfony-project.org/wiki/CheatSheets)。

特别是对于您的查询，您将需要以下内容：

```
$c = new Criteria();
$c->addJoin(discusreply::DISREPID, discusreply::PARENTID, Criteria::INNER_JOIN);  
$c->clearSelectColumns();
$c->addSelectColumn(discusreplyPeer::Disrepid); 
...
$c->add(discusreplyPeer::DISTOPID, $this->id, Criteria::EQUAL);
... 
$c->addAscendingOrderByColumn(discusreply::DISREPID); 
```

我不确定 Criteria 系统是否支持内部连接的多个子句，因此您可能必须为此查询恢复到 ad-hoc SQL（如果可以的话，我很想知道如何）。以下代码将创建一个 ResultSet 对象，类似于您从简单的数据库抽象层中获得的对象。

```
$sql = "SELECT ...";
$dbh = Propel::getConnection([DB]);
$sth = $dbh->createStatement();
$res = $sth->executeQuery($sql, ResultSet::FETCHMODE_NUM); 
```

我认为在这样的查询上使用 ad-hoc 方法没有什么缺点，因为当您只返回特定列时，您将不得不处理 ResultSet 对象而不是特定于表的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T15:40:17.360

[您可以尝试使用此站点](http://propel.jondh.me.uk/)从 sql 自动生成条件。

# asp.net - ASP.NET 用户配置文件与使用 Cookie

> ID：457292
> 
> 赞同：3
> 
> 时间：2009-01-19T11:20:01.773
> 
> 标签：asp.net, cookies, profile

我认为，在几乎所有情况下，用户偏好数据都可以存储在 cookie 中，其结果（几乎）与使用 User Profile API 时一样好。使用 cookie（对于经过身份验证的用户）的缺点似乎是 cookie 可以被删除或超时，在这种情况下，用户首选项数据将丢失。对于匿名用户，如果偏好数据需要跨会话持久保存，那么即使使用用户配置文件也必须使用 cookie。

那么使用用户配置文件或 cookie 存储用户偏好的最大优点/缺点是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T12:07:35.330

在网站上注册的好处之一是它可以记住我的偏好——如果您将该信息存储在我机器上的 cookie 中，而不是在您的服务器上，那么当我从另一台计算机登录您的网站时，我必须再次设置我所有的偏好 - 从可用性的角度来看，这相当糟糕。

对于匿名用户，将首选项存储在 cookie 中似乎相当明智——您不知道他们是谁，也不知道他们是否会回来，而且正如您所说，您无法从一个会话到下一个会话是 - 但是您最好将某种令牌存储在 cookie 中并将其映射到服务器上的首选项存储。

另外，我注意到不同的浏览器对 cookie 有不同的实现——例如，IE 现在可以从一个域[接收 50 个 cookie](http://support.microsoft.com/kb/941495)（从原来的 20 个增加），但它仍然限制[为整个 cookie 集合的总数为 4096 个字节](http://support.microsoft.com/kb/306070)（和以前的） - 其他浏览器将支持每个 cookie 4KB，而不是每个域。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T11:31:48.473

Cookie 的最大长度是有限的，并且它们使用的是您无法控制的实现方式（毕竟，它们是您的访问者浏览器的一项功能）。就个人而言，我不喜欢依赖我无法控制的未知第三方实现，如果必须，我会尝试以最简单的方式使用它。

因此，从我来的地方，我总是将用户数据存储在服务器上，然后传递一个指向该信息的 cookie。

除了不信任浏览器可能有大量数据（这些数据可能会丢失、错误存储或根本不存储，这不仅取决于浏览器，还取决于某些防病毒应用程序等），这还有其他各种优点：

*   您正在向用户隐藏您的实现：如果您将数据存储在 cookie 中，那么任何人都可以看到它，并且可以随意分析或修改。这甚至可能导致用户将 cookie 更改为喜欢的内容，从而迫使您保留您可能想要摆脱的东西，因为某些用户随时依赖于您的特定实现。
*   由于 cookie 以纯文本形式存储在共享机器上，每个人都无法再轻易看到之前用户所做的所有设置，也无法随意更改它们。

但最重要的一点仍然是与不太正常的浏览器实现断开连接（仅存储小令牌是常见的、经过测试的用例）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T11:37:21.553

将所有偏好数据保存在 cookie 中的另一个缺点是，无论何时对数据进行更改，都必须在来自客户端的每个请求以及来自服务器的任何响应中发送所有这些数据。虽然这在宽带时代似乎是一个小问题，但它仍然是一个额外的开销。使用 Profiles API 意味着数据保存在服务器上，浏览器只需要发送一个会话标识 cookie。

此外，正如您所说，对于匿名用户，如果 cookie 被删除，则将无法再访问 Profiles DB 中保存的用户首选项。但是，对于您网站的注册用户而言，情况并非如此。如果他们删除了他们的 cookie，服务器仍然能够在他们下次登录时检索他们的用户偏好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T11:32:21.423

不要忘记使用 cookie 的最大缺点之一是它们可以被复制，因此在它们上存储身份验证信息是很危险的。

我不熟悉用户配置文件 API，但我猜它会将信息存储在服务器上（？）。如果是这种情况，那么如果您有很多用户，您可能会遇到问题。

总的来说，如果能保证信息的持久性，最好的解决方案可能是使用用户配置文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T12:16:38.493

请记住，可以编写将用户数据保存在 cookie 中的 ProfileProvider，因此如果您确定要保存的状态适合 cookie（大小、安全性等），则可以两全其美。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T16:19:08.463

实际上，在使用 ASP.NET 配置文件提供程序时，您不需要将偏好数据保存在匿名用户的 cookie 中。只需将当前的用户 ID（这是一些看起来很糟糕的与会话相关的字符串）存储在 cookie 中。这在后续访问中成为以前的 UserID，然后您可以获取旧的个人资料信息并将其迁移到当前个人资料，甚至可以将它们验证为旧的匿名个人资料。

# windows - 在 Slapd 中，如何处理“连接表已满（64/64）”错误？

> ID：457306
> 
> 赞同：0
> 
> 时间：2009-01-19T11:24:35.150
> 
> 标签：windows, ldap, openldap

我正在开发一个在 Windows 服务器上运行的应用程序，它需要大量使用 LDAP。现在我们被困在 Windows 平台上的 slapd LDAP 服务器——它不是很好，但由于各种原因，我们被困在这个架构上。

我们的系统随需求扩展，所以在高峰期会有更多的应用服务器。每个应用程序服务器都是多线程的，最多可以与单个 LDAP 服务器建立 16 个并发连接。

每当系统尝试与 LDAP 服务器建立超过 64 个并发连接时，slapd 将阻止任何进一步的连接尝试。

很明显 slapd 连接池已经被最大化了，但是我该如何让它更大呢？我们运行 Slapd 的机器是一个非常强大的 8 核服务器，所以理论上我们可以有几百个并发连接。此外，该项目的前一个版本在双核服务器上的 Ubuntu Linux 上运行 slapd。它能够毫无问题地处理我们两倍的负载，所以看起来我们的问题是 Windows 特有的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-22T16:59:38.793

找到答案：

您必须重新编译 slapd 并更改源代码，有一个 C++ 宏指定连接限制。

# c# - 设置目录的访问权限 - 接收异常“无法设置标志”

> ID：457307
> 
> 赞同：5
> 
> 时间：2009-01-19T11:25:02.873
> 
> 标签：c#, security

我正在尝试 progamrtaiclly 允许对目录上的 ASPNET 帐户进行写访问。我正在使用以下代码执行此操作：（请注意，我希望 ASPNET 的“允许写入访问”也传播到子对象：

```
static void Main(string[] args)
            {

                FileSecurity fileSecurity;

                fileSecurity = new FileSecurity();

                fileSecurity.SetAccessRuleProtection(true, false);

                fileSecurity.AddAccessRule(new FileSystemAccessRule("ASPNET",FileSystemRights.Write,InheritanceFlags.ObjectInherit|InheritanceFlags.ContainerInherit,PropagationFlags.InheritOnly,AccessControlType.Allow));                                   

                File.SetAccessControl("C:\\TestDir1", fileSecurity);
            } 
```

此代码导致异常：“无法设置标志。\r\n参数名称：inheritanceFlags”

有什么问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T12:56:41.127

得到了解决方案，显然我必须这样做：

```
DirectoryInfo dirInfo = new DirectoryInfo("C:\\TestDir2");
            DirectorySecurity dirSecurity = dirInfo.GetAccessControl();

            dirSecurity.AddAccessRule(new FileSystemAccessRule("ASPNET", FileSystemRights.Write|FileSystemRights.DeleteSubdirectoriesAndFiles, InheritanceFlags.ContainerInherit | InheritanceFlags.ObjectInherit, PropagationFlags.InheritOnly, AccessControlType.Allow));

            dirInfo.SetAccessControl(dirSecurity); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-08-29T20:55:27.740

正如您所指出的，最初的问题是您正在使用`FileSecurity`该类（适用于文件，而不是目录）并尝试为目录设置 ACL，但这也可能由于以下任何原因而发生：

1.  **为目录**设置规则时，您指定 `InheritanceFlags.None`继承标志，但提供传播标志以外`PropagationFlags.None`的任何值（您不能传播不存在的继承）。
2.  **为文件**设置规则时，为各个参数指定除`InheritanceFlags.None`和以外的任何值 `PropragationFlags.None`（文件不是容器，因此不能指定继承）。

[您可以在 CheckFlags 方法](http://referencesource.microsoft.com/#mscorlib/system/security/accesscontrol/acl.cs,1972)的源代码中看到 .NET Framework 执行的相关检查。

# c# - 组合两个表达式（表达式 >)

> ID：457316
> 
> 赞同：296
> 
> 时间：2009-01-19T11:29:08.450
> 
> 标签：c#, linq, lambda, expression

我有两个类型的表达式，`Expression<Func<T, bool>>`我想对这些表达式进行 OR、AND 或 NOT，并获得一个相同类型的新表达式

```
Expression<Func<T, bool>> expr1;
Expression<Func<T, bool>> expr2;

...

//how to do this (the code below will obviously not work)
Expression<Func<T, bool>> andExpression = expr AND expr2 
```

* * *

## 回答 #1

> 赞同：406
> 
> 时间：2009-01-19T11:32:55.960

嗯，可以用`Expression.AndAlso`/ `OrElse`etc组合逻辑表达式，但问题是参数；你`ParameterExpression`在 expr1 和 expr2 中使用相同的东西吗？如果是这样，那就更容易了：

```
var body = Expression.AndAlso(expr1.Body, expr2.Body);
var lambda = Expression.Lambda<Func<T,bool>>(body, expr1.Parameters[0]); 
```

这也适用于否定单个操作：

```
static Expression<Func<T, bool>> Not<T>(
    this Expression<Func<T, bool>> expr)
{
    return Expression.Lambda<Func<T, bool>>(
        Expression.Not(expr.Body), expr.Parameters[0]);
} 
```

否则，根据 LINQ 提供程序，您可能可以将它们与`Invoke`：

```
// OrElse is very similar...
static Expression<Func<T, bool>> AndAlso<T>(
    this Expression<Func<T, bool>> left,
    Expression<Func<T, bool>> right)
{
    var param = Expression.Parameter(typeof(T), "x");
    var body = Expression.AndAlso(
            Expression.Invoke(left, param),
            Expression.Invoke(right, param)
        );
    var lambda = Expression.Lambda<Func<T, bool>>(body, param);
    return lambda;
} 
```

在某个地方，我有一些代码可以重写表达式树替换节点以消除对 的需要`Invoke`，但它很长（而且我不记得我把它放在哪里了......）

* * *

选择最简单路线的通用版本：

```
static Expression<Func<T, bool>> AndAlso<T>(
    this Expression<Func<T, bool>> expr1,
    Expression<Func<T, bool>> expr2)
{
    // need to detect whether they use the same
    // parameter instance; if not, they need fixing
    ParameterExpression param = expr1.Parameters[0];
    if (ReferenceEquals(param, expr2.Parameters[0]))
    {
        // simple version
        return Expression.Lambda<Func<T, bool>>(
            Expression.AndAlso(expr1.Body, expr2.Body), param);
    }
    // otherwise, keep expr1 "as is" and invoke expr2
    return Expression.Lambda<Func<T, bool>>(
        Expression.AndAlso(
            expr1.Body,
            Expression.Invoke(expr2, param)), param);
} 
```

从 .NET 4.0 开始，有一个`ExpressionVisitor`类允许您构建 EF 安全的表达式。

```
 public static Expression<Func<T, bool>> AndAlso<T>(
        this Expression<Func<T, bool>> expr1,
        Expression<Func<T, bool>> expr2)
    {
        var parameter = Expression.Parameter(typeof (T));

        var leftVisitor = new ReplaceExpressionVisitor(expr1.Parameters[0], parameter);
        var left = leftVisitor.Visit(expr1.Body);

        var rightVisitor = new ReplaceExpressionVisitor(expr2.Parameters[0], parameter);
        var right = rightVisitor.Visit(expr2.Body);

        return Expression.Lambda<Func<T, bool>>(
            Expression.AndAlso(left, right), parameter);
    }

    private class ReplaceExpressionVisitor
        : ExpressionVisitor
    {
        private readonly Expression _oldValue;
        private readonly Expression _newValue;

        public ReplaceExpressionVisitor(Expression oldValue, Expression newValue)
        {
            _oldValue = oldValue;
            _newValue = newValue;
        }

        public override Expression Visit(Expression node)
        {
            if (node == _oldValue)
                return _newValue;
            return base.Visit(node);
        }
    } 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2012-09-19T14:53:17.223

您可以使用 Expression.AndAlso / OrElse 来组合逻辑表达式，但您必须确保 ParameterExpressions 相同。

[我在使用 EF 和PredicateBuilder](http://www.albahari.com/nutshell/predicatebuilder.aspx)时遇到了问题，所以我自己制作了没有诉诸调用的方法，我可以像这样使用它：

```
var filterC = filterA.And(filterb); 
```

我的 PredicateBuilder 的源代码：

```
public static class PredicateBuilder {

    public static Expression<Func<T, bool>> And<T>(this Expression<Func<T, bool>> a, Expression<Func<T, bool>> b) {    

        ParameterExpression p = a.Parameters[0];

        SubstExpressionVisitor visitor = new SubstExpressionVisitor();
        visitor.subst[b.Parameters[0]] = p;

        Expression body = Expression.AndAlso(a.Body, visitor.Visit(b.Body));
        return Expression.Lambda<Func<T, bool>>(body, p);
    }

    public static Expression<Func<T, bool>> Or<T>(this Expression<Func<T, bool>> a, Expression<Func<T, bool>> b) {    

        ParameterExpression p = a.Parameters[0];

        SubstExpressionVisitor visitor = new SubstExpressionVisitor();
        visitor.subst[b.Parameters[0]] = p;

        Expression body = Expression.OrElse(a.Body, visitor.Visit(b.Body));
        return Expression.Lambda<Func<T, bool>>(body, p);
    }   
} 
```

以及用于替换 lambda 中的参数的实用程序类：

```
internal class SubstExpressionVisitor : System.Linq.Expressions.ExpressionVisitor {
        public Dictionary<Expression, Expression> subst = new Dictionary<Expression, Expression>();

        protected override Expression VisitParameter(ParameterExpression node) {
            Expression newValue;
            if (subst.TryGetValue(node, out newValue)) {
                return newValue;
            }
            return node;
        }
    } 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2011-12-15T15:36:29.317

如果您的提供程序不支持 Invoke 并且您需要组合两个表达式，则可以使用 ExpressionVisitor 将第二个表达式中的参数替换为第一个表达式中的参数。

```
class ParameterUpdateVisitor : ExpressionVisitor
{
    private ParameterExpression _oldParameter;
    private ParameterExpression _newParameter;

    public ParameterUpdateVisitor(ParameterExpression oldParameter, ParameterExpression newParameter)
    {
        _oldParameter = oldParameter;
        _newParameter = newParameter;
    }

    protected override Expression VisitParameter(ParameterExpression node)
    {
        if (object.ReferenceEquals(node, _oldParameter))
            return _newParameter;

        return base.VisitParameter(node);
    }
}

static Expression<Func<T, bool>> UpdateParameter<T>(
    Expression<Func<T, bool>> expr,
    ParameterExpression newParameter)
{
    var visitor = new ParameterUpdateVisitor(expr.Parameters[0], newParameter);
    var body = visitor.Visit(expr.Body);

    return Expression.Lambda<Func<T, bool>>(body, newParameter);
}

[TestMethod]
public void ExpressionText()
{
    string text = "test";

    Expression<Func<Coco, bool>> expr1 = p => p.Item1.Contains(text);
    Expression<Func<Coco, bool>> expr2 = q => q.Item2.Contains(text);
    Expression<Func<Coco, bool>> expr3 = UpdateParameter(expr2, expr1.Parameters[0]);

    var expr4 = Expression.Lambda<Func<Recording, bool>>(
        Expression.OrElse(expr1.Body, expr3.Body), expr1.Parameters[0]);

    var func = expr4.Compile();

    Assert.IsTrue(func(new Coco { Item1 = "caca", Item2 = "test pipi" }));
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2020-02-05T22:30:23.580

这里没有什么新东西，但是将[这个答案](https://stackoverflow.com/a/12497283/331281)与[这个答案](https://stackoverflow.com/a/8522600/331281)结合起来并稍微重构了它，这样即使我也能理解发生了什么：

```
public static class ExpressionExtensions
{
    public static Expression<Func<T, bool>> AndAlso<T>(this Expression<Func<T, bool>> expr1, Expression<Func<T, bool>> expr2)
    {
        ParameterExpression parameter1 = expr1.Parameters[0];
        var visitor = new ReplaceParameterVisitor(expr2.Parameters[0], parameter1);
        var body2WithParam1 = visitor.Visit(expr2.Body);
        return Expression.Lambda<Func<T, bool>>(Expression.AndAlso(expr1.Body, body2WithParam1), parameter1);
    }

    private class ReplaceParameterVisitor : ExpressionVisitor
    {
        private ParameterExpression _oldParameter;
        private ParameterExpression _newParameter;

        public ReplaceParameterVisitor(ParameterExpression oldParameter, ParameterExpression newParameter)
        {
            _oldParameter = oldParameter;
            _newParameter = newParameter;
        }

        protected override Expression VisitParameter(ParameterExpression node)
        {
            if (ReferenceEquals(node, _oldParameter))
                return _newParameter;

            return base.VisitParameter(node);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-06-01T12:48:34.803

我需要达到相同的结果，但使用更通用的东西（因为类型未知）。感谢马克的回答，我终于弄清楚了我想要实现的目标：

```
 public static LambdaExpression CombineOr(Type sourceType, LambdaExpression exp, LambdaExpression newExp) 
    {
        var parameter = Expression.Parameter(sourceType);

        var leftVisitor = new ReplaceExpressionVisitor(exp.Parameters[0], parameter);
        var left = leftVisitor.Visit(exp.Body);

        var rightVisitor = new ReplaceExpressionVisitor(newExp.Parameters[0], parameter);
        var right = rightVisitor.Visit(newExp.Body);

        var delegateType = typeof(Func<,>).MakeGenericType(sourceType, typeof(bool));
        return Expression.Lambda(delegateType, Expression.Or(left, right), parameter);
    } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-10-16T20:46:01.607

我建议对*PredicateBuilder*和`ExpressionVisitor`解决方案进行另一项改进。我调用了它`UnifyParametersByName`，你可以在我的 MIT 库中找到它：[LinqExprHelper](https://github.com/jarekczek/LinqExprHelper)。它允许组合任意 lambda 表达式。通常会问关于谓词表达式的问题，但这个想法也扩展到投影表达式。

以下代码采用了一种方法，该方法`ExprAdres`使用内联 lambda 创建复杂的参数化表达式。`LinqExprHelper`由于迷你库，这个复杂的表达式只编码一次，然后重复使用。

```
public IQueryable<UbezpExt> UbezpFull
{
    get
    {
        System.Linq.Expressions.Expression<
            Func<UBEZPIECZONY, UBEZP_ADRES, UBEZP_ADRES, UbezpExt>> expr =
            (u, parAdrM, parAdrZ) => new UbezpExt
            {
                Ub = u,
                AdrM = parAdrM,
                AdrZ = parAdrZ,
            };

        // From here an expression builder ExprAdres is called.
        var expr2 = expr
            .ReplacePar("parAdrM", ExprAdres("M").Body)
            .ReplacePar("parAdrZ", ExprAdres("Z").Body);
        return UBEZPIECZONY.Select((Expression<Func<UBEZPIECZONY, UbezpExt>>)expr2);
    }
} 
```

这是子表达式构建代码：

```
public static Expression<Func<UBEZPIECZONY, UBEZP_ADRES>> ExprAdres(string sTyp)
{
    return u => u.UBEZP_ADRES.Where(a => a.TYP_ADRESU == sTyp)
        .OrderByDescending(a => a.DATAOD).FirstOrDefault();
} 
```

我试图实现的是执行参数化查询而无需复制粘贴，并且能够使用非常漂亮的内联 lambda。如果没有所有这些帮助表达式的东西，我将不得不一口气创建整个查询。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2021-02-23T15:33:56.857

我在这里结合了一些漂亮的答案，可以**轻松支持更多的表达式运算符**。

这是基于@Dejan 的答案，但**现在添加 OR 也很容易**。我选择不`Combine`公开该功能，但您可以这样做更加灵活。

```
public static class ExpressionExtensions
{
    public static Expression<Func<T, bool>> AndAlso<T>(this Expression<Func<T, bool>> leftExpression,
        Expression<Func<T, bool>> rightExpression) =>
        Combine(leftExpression, rightExpression, Expression.AndAlso);

    public static Expression<Func<T, bool>> Or<T>(this Expression<Func<T, bool>> leftExpression,
        Expression<Func<T, bool>> rightExpression) =>
        Combine(leftExpression, rightExpression, Expression.Or);

    public static Expression<Func<T, bool>> Combine<T>(Expression<Func<T, bool>> leftExpression, Expression<Func<T, bool>> rightExpression, Func<Expression, Expression, BinaryExpression> combineOperator)
    {
        var leftParameter = leftExpression.Parameters[0];
        var rightParameter = rightExpression.Parameters[0];

        var visitor = new ReplaceParameterVisitor(rightParameter, leftParameter);

        var leftBody = leftExpression.Body;
        var rightBody = visitor.Visit(rightExpression.Body);

        return Expression.Lambda<Func<T, bool>>(combineOperator(leftBody, rightBody), leftParameter);
    }

    private class ReplaceParameterVisitor : ExpressionVisitor
    {
        private readonly ParameterExpression _oldParameter;
        private readonly ParameterExpression _newParameter;

        public ReplaceParameterVisitor(ParameterExpression oldParameter, ParameterExpression newParameter)
        {
            _oldParameter = oldParameter;
            _newParameter = newParameter;
        }

        protected override Expression VisitParameter(ParameterExpression node)
        {
            return ReferenceEquals(node, _oldParameter) ? _newParameter : base.VisitParameter(node);
        }
    }
} 
```

用法没有改变，仍然像这样：

```
Expression<Func<Result, bool>> noFilterExpression = item => filters == null;

Expression<Func<Result, bool>> laptopFilterExpression = item => item.x == ...
Expression<Func<Result, bool>> dateFilterExpression = item => item.y == ...

var combinedFilterExpression = noFilterExpression.Or(laptopFilterExpression.AndAlso(dateFilterExpression));

efQuery.Where(combinedFilterExpression); 
```

*（这是一个基于我的实际代码的示例，但将其视为伪代码）*

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2022-03-05T08:25:49.520

```
 public static Expression<Func<T, bool>> And<T>(this Expression<Func<T, bool>> exp, Expression<Func<T, bool>> newExp)
    {
        // get the visitor
        var visitor = new ParameterUpdateVisitor(newExp.Parameters.First(), exp.Parameters.First());
        // replace the parameter in the expression just created
        newExp = visitor.Visit(newExp) as Expression<Func<T, bool>>;

        // now you can and together the two expressions
        var binExp = Expression.And(exp.Body, newExp.Body);
        // and return a new lambda, that will do what you want. NOTE that the binExp has reference only to te newExp.Parameters[0] (there is only 1) parameter, and no other
        return Expression.Lambda<Func<T, bool>>(binExp, newExp.Parameters);
    }
    class ParameterUpdateVisitor : ExpressionVisitor
    {
        private ParameterExpression _oldParameter;
        private ParameterExpression _newParameter;

        public ParameterUpdateVisitor(ParameterExpression oldParameter, ParameterExpression newParameter)
        {
            _oldParameter = oldParameter;
            _newParameter = newParameter;
        }

        protected override Expression VisitParameter(ParameterExpression node)
        {
            if (object.ReferenceEquals(node, _oldParameter))
                return _newParameter;

            return base.VisitParameter(node);
        }
    } 
```

* * *

## 回答 #9

> 赞同：-9
> 
> 时间：2015-11-13T15:11:18.143

我认为这很好用，不是吗？

```
Func<T, bool> expr1 = (x => x.Att1 == "a");
Func<T, bool> expr2 = (x => x.Att2 == "b");
Func<T, bool> expr1ANDexpr2 = (x => expr1(x) && expr2(x));
Func<T, bool> expr1ORexpr2 = (x => expr1(x) || expr2(x));
Func<T, bool> NOTexpr1 = (x => !expr1(x)); 
```

# php - 逻辑运算符：AND 比 OR 更好吗？

> ID：457317
> 
> 赞同：0
> 
> 时间：2009-01-19T11:29:19.697
> 
> 标签：php, error-handling, logic

对不起，如果这是一个 comp-sci 101 问题。我只是不确定我是否遗漏了一些明显的东西。

因此，假设某些用户输入引发了错误，我想抓住它并返回一些反馈。错误将是一个数字，0 - 8。0 表示“无错误”。如果错误为 3，我想给用户非常具体的反馈（比方说，不允许数字）。对于其他 7 种可能性，我只想结束脚本并回显错误。

我正在解决这个问题并决定这样做：

```
$no_errors ($_error != 0 || $_error != 3) ? FALSE : TRUE;
if (!$no_errors)
echo $error_msg['$_error'];
$error_3 ($no_errors && $_error == 3) ? TRUE : FALSE;
if ($error_3)
   bunch of stuff happens;
else
   bunch of other stuff; 
```

无论如何，然后我注意到第一行的 OR 运算符，并认为使用 AND 运算符可能会更好/更安全。但我思考得越多，我看到的差异就越小。

所以真正的问题是，如果你想消除特定变量的两种可能性，AND 和 OR 是否相同，或者在逻辑/功能上是否更优化？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-19T11:37:53.970

如果您使用 switch 语句，它将更具可读性：

```
switch ($_error) {
    case 0;
        nothing happens;
        break;
    case 3:
        bunch of stuff happens;
        break;
    default:
        bunch of other stuff;
        break;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T11:37:21.553

首先，我认为我会建议使用另一种识别错误的方法，而不是使用“幻数”。它们很难维护，因为您很容易忘记“3”的含义。看起来您的语言是 PHP，它支持异常。我建议改用它们，你可以在这里阅读更多关于它们的信息：http: [//dk.php.net/exceptions](http://dk.php.net/exceptions)

至于逻辑运算符，实际上并没有任何被认为是“好的做法”。使用你想要的。如果您无法确定表达式何时是真/假，请尝试制作真值表：[http ://en.wikipedia.org/wiki/Truth_table](http://en.wikipedia.org/wiki/Truth_table)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T11:33:29.110

性能方面，请记住，在大多数语言中，评估都是惰性的。使用 OR，如果第一个条件为真，它将返回真而不评估第二个条件。对于 AND，如果第一个条件为假，它将返回假，而不评估第二个条件。

否则，运营商本身的表现并没有真正的不同。使用对您来说最易读的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T11:36:19.433

最好的是可以帮助**您**更快地阅读代码的那个。这是您可以在这里以及可能在数百万其他地方进行的唯一真正的优化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T11:36:32.567

这看起来更容易阅读：

```
 if($_error==3)
      do stuff;
    else if($_error>0)
      do some other stuff
    else
      do normal stuff 
```

没有人注意到你可能会赢的微秒。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T11:38:36.590

逻辑上以下是相同的（请原谅我的伪代码）

```
(! expression_one || ! expression_two) /** this is the same as the one below **/
! (expression_one && expression_two) 
```

从功能上讲，哪一个更优化？它们都和彼此一样最佳。如果第一个表达式为真（在 || 情况下）或假（在 && 情况下），两种方式（&& 和 ||）都允许短路

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T12:39:57.260

1.  就我个人而言，我会消除这些数字的使用，而是使用常量。除了更易于维护之外，它们还使编码本身变得更加容易，并允许您在明天更新值，例如，如果某些情况迫使您将数字从 3 更改，您必须仔细查看所有代码
2.  正如 gkrogers 所建议的那样，在完成同样的事情时切换更容易阅读和维护

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T11:35:20.667

(A || B) = !(A && B)。所以真的没什么区别

编辑： (A || B) = !(A && B) 是错误的。感谢评论。正确的形式是 (!A || !B) = !(A && B)。

我很抱歉

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-19T11:46:49.427

性能方面，我相信它们非常相似（参见 wvanbergen 的帖子），但是在行为上存在明显差异。我认为您当前的帖子可能没有达到您希望的效果。如果您在第一行中 $_error = 3，那么您将有 $no_errors = false。当您正在检查两个都需要满足的条件时，这两个条件可能更合适。

有时我发现检查我的逻辑的最简单方法就是大声说出我想说的话。例如，“如果错误代码**不是**0**也不** 是3 ，我们**没有错误”**

我通常发现在这种只有几个变量的情况下，我用英语写句子的方式为我提供了最直观（和准确）的方法来确定逻辑运算符。

如果您在此过程后发现代码看起来很乱，那么您可能会发现[这个](http://en.wikipedia.org/wiki/De_Morgan%27s_laws)关于德摩根定律的链接很有用

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-19T12:33:49.363

如果您使用：

```
$no_errors ($_error != 0 && $_error != 3) ? FALSE : TRUE; 
```

这意味着如果 $error != 0 AND $error != 3 这是无效的逻辑，因为 $error 不能 == 到 3 和 0 它可以是 3 OR 0 但不能同时是两者。
在上面的示例中，如果 $error = 0 那么它将评估为 FALSE 因为它不是 3 && 0 您正在寻找它是 3 || 0。

# sql-server - 语法问题：在存储过程中使用变量

> ID：457330
> 
> 赞同：1
> 
> 时间：2009-01-19T11:33:07.083
> 
> 标签：sql-server, visual-studio, sql-server-2005, stored-procedures

谁能告诉下面的代码有多正确。我正在尝试创建一个存储过程，该过程返回名称传递给它的表的行数。

```
CREATE PROCEDURE spROWCOUNTER
(
    @tablename nvarchar(20)
    @rowCountVal int OUTPUT
)

AS

DECLARE @strQuery nvarchar(300)

SET @strQuery = 'SELECT @rowCountVal=COUNT(*) FROM '+@tablename

EXEC(@strQuery)

RETURN @rowCountVal 
```

错误信息 ：

*   '@rowCountVal' 附近的语法不正确
*   必须声明标量变量“@tablename”
*   必须声明标量变量“@rowCountVal”

* * *

而下面的代码工作正常

```
ALTER PROCEDURE spROWCOUNTER
(
    @rowCountVal int OUTPUT
)

AS

SELECT @rowCountVal=COUNT(*) FROM DEFECT_LOG

RETURN @rowCountVal 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T12:14:59.900

```
CREATE PROCEDURE spROWCOUNTER   
    @tablename nvarchar(20),    
    @rowCountVal int OUTPUT
AS

SELECT @rowCountVal = ISNULL(SUM(spart.rows), 0)
FROM sys.partitions spart 
WHERE spart.object_id = object_id(@tablename) AND spart.index_id < 2

RETURN @rowCountVal 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T11:39:39.817

语法问题很容易解决。参数之间**缺少逗号**(",")。插入逗号，存储过程编译：

```
( @tablename nvarchar(20), @rowCountVal int OUTPUT ) 
```

然后，有一个**主要问题**：您无法访问 EXEC 语句中的 @rowCountVal 参数。为了解决这个问题，你可以使用内置的存储过程`sp_executesql`。

阅读[SQL Server MVP Erland Sommarskog 撰写的这篇好文章](http://www.sommarskog.se/dynamic_sql.html#sp_executesql)。

*顺便说一句：您不必“返回”变量。返回值通常用于返回一些状态值。如果你传递一个输出参数，它会自动返回。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T12:24:53.577

我会使用 sp_executesql 而不是 exec。然后您可以将@rowCountVal 作为输出变量传入动态sql。

```
create PROCEDURE spROWCOUNTER
(
    @tablename nvarchar(20),
    @rowCountVal int OUTPUT
)

AS

DECLARE @strQuery nvarchar(300)

SET @strQuery = 'SELECT @rowCountVal = COUNT(*) FROM '+@tablename

exec sp_executesql @strQuery, N'@tablename nvarchar(20), @rowCountVal int OUTPUT',   @tablename = @tablename, @rowCountVal = @rowCountVal output

RETURN @rowCountVal 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T12:55:42.067

在执行语句中，您可以使用临时表来共享数据：

```
CREATE PROCEDURE spROWCOUNTER   
    @tablename nvarchar(20),    
    @rowCountVal int OUTPUT
AS

CREATE TABLE #Result( Rows INT )
EXEC( 'INSERT INTO #Result( Rows ) SELECT COUNT(*) FROM ' + @tablename )

SELECT @rowCountVal = Rows FROM #Result

RETURN @rowCountVal 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T14:21:15.060

如果您希望将行计数作为一个函数，您还可以检查[Speeding the Performance of Table Counts in SQL Server 2005](http://www.sql-server-performance.com/articles/per/Speeding_up_the_Performance_of_Table_Counts_p1.aspx)

文章中提供的函数显然比对非常大的表调用 count(*) 更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T12:06:57.700

是的，我错过了逗号。但即使在那之后，该值也不会存储在`@rowCountVal`.

```
SET @strQuery = 'SELECT @rowCountVal=COUNT(*) *FROM '+ @tablename

EXEC(@strQuery) 
```

查询不返回也不显示任何值。

* * *

顺便说一句，我想从其他存储过程中调用这个 proc 来获取`rowcounts`. 以下语句是否有效：

```
set @rCount = exec spROWCOUNTER('DEFECT_LOG') 
```

# java - System.exit(0) 的使用

> ID：457338
> 
> 赞同：13
> 
> 时间：2009-01-19T11:37:18.323
> 
> 标签：java, exit-code

```
public class WrapperTest {
    static {
        print(10);
    }

    static void print(int x) {
        System.out.println(x);
        System.exit(0);
    }
} 
```

上面的代码`System.exit(0)`是用来停止程序的。该方法采用什么论据？为什么我们把它作为`0`. 谁能解释一下这个概念？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-19T11:40:51.013

来自[JAVA 文档](http://java.sun.com/javase/6/docs/api/java/lang/System.html#exit(int))：

> 该参数用作状态码；按照惯例，非零状态码表示异常终止。

[维基百科](http://en.wikipedia.org/wiki/Exitcode)增加了额外的信息。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-19T11:39:54.120

它是 Java 进程将报告给调用进程的返回值。

它并没有真正的精确定义，但通常的约定是这`0`意味着成功，任何非零值都表示失败。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T11:42:07.643

参数是 java 进程将返回的返回码（0 表示“成功”）。当 Java 程序是批处理脚本的一部分时，或者通过构建工具（如 Ant）时，可以使用它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T11:43:45.127

看看[这里](http://docs.oracle.com/javase/8/docs/api/java/lang/System.html)

该参数用作状态码；按照惯例，**非零状态码表示异常终止。**

# c# - C#如何在winforms应用程序中隐藏光标？

> ID：457360
> 
> 赞同：17
> 
> 时间：2009-01-19T11:45:23.143
> 
> 标签：c#, winforms, mouse-cursor

我正在开发一个触摸屏应用程序，只要光标在主窗体中，我就需要隐藏它。

有任何想法吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-19T11:49:35.223

我知道这是一个愚蠢的问题！简单的说

```
Cursor.Hide(); 
```

是我在表单构造函数中所需要的。

# asp.net-mvc - ASPNET MVC：找出引用者路径的方法（原文如此）？

> ID：457362
> 
> 赞同：7
> 
> 时间：2009-01-19T11:46:15.277
> 
> 标签：asp.net-mvc, redirect, routing, referer

我的控制器上有一些 POST 操作，这些操作来自一对 GET 操作。当验证失败时，我想呈现 POST 来自的操作的视图。例如：

~/accounts POST 到 ~/accounts/disable - 在验证错误时呈现“索引”视图 ~/accounts/profile POST 到 ~/accounts/disable - 在验证错误时呈现“profile”视图

我可以从服务器变量中获取引用者（原文如此）并对其进行解析以找出操作，但希望要么有内置的东西可以满足我的需求，要么其他人已经这样做了，我可以从中借鉴.

似乎 ControllerContext.RouteData 属性只有关于当前请求的信息，而不是引用（原文如此）请求......？

我正在使用 ASP.NET MVC 测试版。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T23:23:21.843

MVC Contrib 在 String 上包含一个扩展方法来获取路由（具体来说，[在这里](http://mvccontrib.googlecode.com/svn/trunk/src/MvcContrib.TestHelper/MvcContrib.TestHelper/RouteTestingExtensions.cs)）。理论上这会让你做

```
RouteData referrer = Request.UrlReferrer.PathAndQuery.Route(); 
```

或者，当然，将其包装在 HttpRequest 的扩展方法中，这样你就可以做到

```
RouteData referrer = Request.ReferrerRoute(); 
```

但是，它用于单元测试并使用 Rhino Mocks 来创建 GetRouteData() 所需的 HttpContextBase。好消息是它似乎很少模拟它，所以如果你创建自己的从 HttpContextBase 派生的 FakeHttpContext 类，你也许可以避免 Rhino Mocks。

# delphi - 当 TSQLConnection.Connected = true 时如何使 Delphi DUnit 测试失败

> ID：457363
> 
> 赞同：8
> 
> 时间：2009-01-19T11:46:18.273
> 
> 标签：delphi, dunit

使用 Delphi IDE 时，在各种属性中填充字段或表列表时，它会默默地将 SQLConnection.Connected 更改为“true”。

因为我不想使用 Connected = true 发布，所以当 TSQLConnection.Connected 在 dfm 中为真时，我需要我的 dunit 测试失败。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T16:45:53.753

GExperts 有一个“设置组件属性”专家，我们将其配置为在每次编译时关闭数据库连接。自从这样做以来，我们就没有遇到过问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T15:46:54.543

您可以编写自己的不存储其 Connected 属性的 TSQLConnection 后代：

```
 TdzAdoConnection = class(TADOConnection)
  published
    property Connected stored false;
  end; 
```

并使用该组件而不是 TSqlConnection。

（以上是针对 TAdoConnection 的，但 TSQLConnection 也应该可以正常工作。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T12:19:51.590

我用另一种方式解决了这个问题。我编写了一个小实用程序来加载 DFM 文件，并查找不应该存在的属性。包括 database.connected = true 值。

这可以修改为使用任何适当的属性。我也把代码的核心放在这里了。

为了使它真正有用，你应该在你的构建脚本中使用这个实用程序（我使用 FinalBuilder）。我的脚本首先循环 .dfm 文件，剥离任何这些属性，然后编译并运行单元测试。如果它们通过了，那么它将继续构建主应用程序。对我来说，这是比单元测试失败更好的方法，因为您可以从有保证的已知良好点开始。

```
nState := 0;
bFound := False;
for nFileLoop := 0 to memoFile.Lines.Count - 1 do
begin
  szLine := memoFile.Lines[nFileLoop];

  case nState of      //
  0:
     begin
        if(0 <> Pos('TADOConnection', szLine)) then
        begin
           szSeeking := 'Connected';
           nState := 1;
        end
        else if(0 <> Pos('TADOTable', szLine)) then
        begin
           szSeeking := 'Active';
           nState := 1;
        end
        else if(0 <> Pos('TADOQuery', szLine)) then
        begin
           szSeeking := 'Active';
           nState := 1;
        end
        else if(0 <> Pos('TDBISAMTable', szLine)) then
        begin
           szSeeking := 'Active';
           nState := 1;
        end
        else if(0 <> Pos('TDBISAMDatabase', szLine)) then
        begin
           szSeeking := 'Connected';
           nState := 1;
        end
        else if(0 <> Pos('TDBISAMSession', szLine)) then
        begin
           szSeeking := 'Active';
           nState := 1;
        end
        else if(0 <> Pos('TDBISAMQuery', szLine)) then
        begin
           szSeeking := 'Active';
           nState := 1;
        end;
     end;
  1 :
     begin
        bFound := True;
        if(0 <> Pos('end', szLine)) then
        begin
           nState := 0;
        end
        else if(0 <> Pos(szSeeking, szLine)) then
        begin
           nPos := Pos('=', szLine);
           if nPos > 0 then
           begin
              memoFile.Lines[nFileLoop] := Copy(szLine, 1, nPos) + ' False';
           end;
        end;
     end;
  end;      // case
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-14T16:58:11.370

[OpenCTF](http://openctf.sourceforge.net/) - Delphi 的组件测试框架可能很有趣，它会自动为所有表单/数据模块中的所有组件的指定属性创建单元测试。它是开源的并且易于使用。

《入门》文档：[http ://www.habarisoft.com/download/OpenCTFGettingStarted.pdf](http://www.habarisoft.com/download/OpenCTFGettingStarted.pdf)

> OpenCTF 组件测试框架有助于为 Delphi 应用程序中的所有（可视和非可视）VCL 组件构建自动测试。它基于 DUnit 框架。

一些使用示例：

*   检测缺失或错误的属性值 - 例如没有分配操作的按钮、没有关联数据集的数据源
*   检测未分配的事件处理程序 - 例如缺少 OnExecute 事件
*   检查所有数据集是否可以打开
*   检查标签顺序
*   找到不可见的组件（例如，最好在运行时隐藏的不可见的 TabSheets）

[OpenCTF http://www.mikejustin.com/images/OpenCTF.gif](http://www.mikejustin.com/images/OpenCTF.gif)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-01T18:52:06.597

解决此问题的另一种方法是在您的 SCM 中实现预提交挂钩。我使用 TortoiseSVN，并且我已经做了类似的事情来防止东西潜入。例如，我们有一个“皮肤”库，它试图将十几个皮肤单元添加到您在 IDE 中打开的任何表单中。（我们有一个注册表补丁可以“修复”这种行为，但如果开发人员重新安装组件，它每隔一段时间就会“取消”）。所以我在 .ini 文件中有一个“禁止字符串列表”，它位于 SVN 预提交挂钩中。

在我们的环境中，所有生产代码都构建在专用的“构建机器”上，因此如果代码没有被签入，它就不会进入构建。问题解决了。

# c# - 是否有任何适用于 Windows 窗体、数据库驱动的应用程序开发/原型设计的框架？

> ID：457365
> 
> 赞同：9
> 
> 时间：2009-01-19T11:47:12.343
> 
> 标签：c#, database, winforms, frameworks, prototyping

我正在编写简单的数据库驱动应用程序，80% 的功能是对大约 15 个表的 CRUD 操作。来自 Web 开发背景，我认为我可以使用 Rails 脚手架或 Django 管理员来涵盖几乎所有这些 CRUD 案例。所以我开始寻找类似 Rails/Django 的框架，但寻找 Windows 窗体应用程序（当然，我知道“富客户端”应用程序开发与 Web 开发有很大不同，我并不期待任何真正相似的东西）。

令我惊讶的是，除了各种 ORM（我们称之为模型层）之外，在 View-Controller 层方面我似乎别无选择。也许我错过了什么？

PS。我评估了 Visual Studio 数据集设计器，但它似乎只适用于最简单的情况，并且需要额外的代码来完成任何不重要的任务。

（添加）到目前为止，我发现：

1.  [TrueView for .NET](http://evolving-software.co.uk/)（感谢 Vijay Patel）
2.  [NConstruct](http://www.nconstruct.com/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T12:21:02.353

如果您可以使用 .net3.5，我将开始查看实体框架

[介绍实体框架](http://msdn.microsoft.com/en-us/library/bb399567.aspx)

[如何：将对象绑定到 Windows 窗体控件（实体框架）](http://msdn.microsoft.com/en-us/library/bb738575.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T22:27:25.097

你可以试试 DevExpress [eXpressAppFramework](http://devexpress.com/Products/NET/Application_Framework/)。如果我对您的理解正确，它应该可以满足您的要求。它可以与 Winforms 和 ASP.NET 一起使用，并且还附带一个 ORM 框架。[这里](http://tv.devexpress.com/)有一些演示产品的视频。如果您需要提出具体问题，[这里](http://community.devexpress.com/forums/)有论坛。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-21T05:27:46.533

您是否检查[**了适用于 Windows 窗体的 Rocket Framework**](http://rocketframework.codeplex.com/)

为了满足您的要求，一切都完美无缺。

*   这使用实体框架作为后端
*   使用对象数据源将对象自动绑定到 UI
*   使用 Generic 最大限度地减少您需要编写的代码量

此外，文档也做得很好，**架构也非常好和稳定**..

我现在正在使用它，它为我服务得很好

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T17:12:29.940

据我所知，Winforms 的 MVC 框架不存在。我已经考虑过了，但我认为无论你多么努力，它都会变得过于狭窄。事实上，您没有被绑定到浏览器中的单个页面，这完全抛弃了许多标准。根据您的需要，您可以拥有一个类似于 Web 和 Web 意识形态的单一[MDI](http://en.wikipedia.org/wiki/Multiple_document_interface)表格，或者您可以拥有一个 MDI 表格，其中可以填写 MDI 表格和标准表格，他们可能需要与每个人交谈其他以确保它们是最新的，即使在后台，这在网络表单中也不是问题。

与此同时，线程成为一个大问题，因为在网络上等待半秒是没有意义的，而如果程序冻结了那么长时间，你就会遇到问题。与 MDI/Form Design 问题相比，线程化的方法甚至更多。

我几乎一直生活在 WinForms 世界中，我倾向于从一个非常通用的 MVC 实现开始，让它根据需要发展以满足当前的需求。我还能够在一个新建项目中应用整个先前的实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T20:47:04.673

无耻插件：您可以尝试我们的[TrueView for .NET](http://evolving-software.co.uk)框架。

它基于领域驱动设计和裸对象模式。它在运行时提供了一个自动生成的“探索者”风格的 UI（没有代码生成步骤），但您可以使用自己的实现来覆盖表单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T22:41:28.117

您将使用的数据库的 API 是什么？如果它是 SOAP Web 服务，您可以使用 CodePlex 的 Microsoft [Smart Client Factory](http://www.codeplex.com/smartclient)。如果它是本地 SQL Server 数据库，您应该考虑实体框架。

# javascript - 禁用链接和s上的浏览 器工具提示

> ID：457366
> 
> 赞同：12
> 
> 时间：2009-01-19T11:47:22.843
> 
> 标签：javascript, jquery, accessibility, microformats

当用户将鼠标悬停在某些链接和元素上时，我想禁止 Web 浏览器的默认工具提示显示。我知道这是可能的，但我不知道如何。任何人都可以帮忙吗？

这样做的原因是为了抑制微格式日期时间的工具提示。BBC 放弃了对 hCalendar 的支持，因为机器可读日期的外观对于有认知障碍的人和一些屏幕阅读器用户来说是一个可访问性问题。[http://www.bbc.co.uk/blogs/bbcinternet/2008/07/why_the_bbc_removed_microforma.html](http://www.bbc.co.uk/blogs/bbcinternet/2008/07/why_the_bbc_removed_microforma.html)

**编辑：**

我按照 Aron 的建议创建了一个 jquery 插件......

```
// uFsuppress plugin v1.0 - toggle microformatted dates
(function($){
$.ufsuppress = function() {
    $(".dtstart,.dtend,.bday").hover(function(){
        $(this).attr("ufdata",$(this).attr("title"));
        $(this).removeAttr("title");
    },function(){
        $(this).attr("title",$(this).attr("ufdata"));
        $(this).removeAttr("ufdata");
    });
}
})(jQuery);

// Usage
$.ufsuppress(); 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-19T11:57:01.870

**据我所知，实际上不可能*禁止*显示标题标签。**

但是，有一些解决方法。

假设您的意思是要保留链接和元素上的 title 属性，您可以使用 Javascript 删除 title 属性`onmouseover()`并再次将其设置为`onmouseout()`。

```
// Suppress tooltip display for links that have the classname 'suppress'
var links = document.getElementsByTagName('a');
for (var i = 0; i < links.length; i++) {
    if (links[i].className == 'suppress') {
        links[i]._title = links[i].title;
        links[i].onmouseover = function() { 
            this.title = '';
        }
        links[i].onmouseout = function() { 
            this.title = this._title;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-06-13T04:10:20.503

将此元素添加到您的 html

```
 onmouseover="title='';" 
```

例如，我有一个 asp.net 复选框，我存储了一个隐藏变量，但不希望用户将其视为工具提示。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-08-07T13:49:50.887

[使用jQuery 插件 timeago](http://timeago.yarp.com/)时遇到了这个线程。实际上，使用 CSS 属性的解决方案非常简单`pointer-events`。发布此内容是为了通过搜索引擎来到这里的人们的利益:)

```
.suppress {
    pointer-events:none;
} 
```

请注意，您不应该将其用于应点击某些内容的链接之类的内容。在这种情况下，请使用公认的 JS 解决方案。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-19T11:57:11.857

在原型中这样的东西会用“dtstart”类来清空[日期时间微格式的所有标题属性：](http://microformats.org/wiki/datetime-design-pattern)

```
$$('abbr.dtstart').each(function(abbr){abbr.title=' '}) 
```

注意我使用了一个空格， Mozilla 文档中[element.title](https://developer.mozilla.org/en/DOM/element.title)状态

> 根据[错误 264001](https://bugzilla.mozilla.org/show_bug.cgi?id=264001)，将 title 设置为空字符串会触发默认继承行为。要取消继承，标题必须设置为非空空格字符串。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-19T12:48:28.913

这对解决您的问题无济于事，但可能很有趣：除此之外，还有另一个通用属性`title`可用于存储数据 - `lang`！

只需将您要存储的数据转换为连续字符串并为其添加前缀`'x-'`即可根据 RFC 1766 声明私有使用。

* * *

在评论中，sanchothefat 澄清说他想用微格式中的 abbr-design-pattern 解决可用性问题。但是还有其他模式在语义上比这个模式更有意义（或者，在我看来更是如此）。我会做什么：

```
<p>
 The party is at
  <dfn class="micro-date">10 o'clock on the 10th
   <var>20051010T10:10:10-010</var></dfn>.
</p> 
```

结合这些风格

```
dfn.micro-date {
    font-weight: inherit;
    font-style: inherit;
}
dfn.micro-date var {
    display: none;
} 
```

在我看来，语义上最正确的方法是使用`dl`定义列表——这在段落中是不允许的。这可以通过以下模式解决：

```
<p>
 The party is at <q cite="#micro-dates">10 o'clock on the 10th</q>.
</p>

<dl id="micro-dates">
 <dt>10 o'clock on the 10th</dt>
 <dd>20051010T10:10:10-010</dd>
</dl> 
```

这需要更复杂的样式表：

```
q[cite='#micro-dates']:before {
    content: '';
}
q[cite='#micro-dates']:after {
    content: '';
}
dl#micro-dates {
    display: none;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-09-01T07:37:14.297

这就是我所做的。

```
$('.fancybox').hover(
    function(){
        $(this).attr('alt',$(this).attr('title'));
        $(this).attr('title','');
    },
    function(){
        $(this).attr('title',$(this).attr('alt'));
        $(this).removeAttr('alt');
    }
).click(function(){
    $(this).attr('title',$(this).attr('alt'));
    $(this).removeAttr('alt');
}); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-06T21:37:48.827

您可以挂钩 'mouseenter' 事件并返回 false，这将停止显示本机工具提示。

```
$(selector).on( 'mouseenter', function(){
    return false;
}); 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2016-09-27T12:49:53.083

有可能抑制这种行为`jQuery`

```
var tempTitle;
$('[title]').hover(
  function(e) {
    debugger;
    e.preventDefault();
    tempTitle = $(this).attr('title');

    $(this).attr('title', '');
    // add attribute 'tipTitle' & populate on hover
    $(this).hover(
      function() {
        $(this).attr('tipTitle', tempTitle);
      }
    );
  },
  // restore title on mouseout
  function() {
    $(this).attr('title', tempTitle);
  }
);
```

```
.progress3 {
  position: relative;
  width: 100px;
  height: 100px;
  background: red;
}
.progress3:hover:after {
  background: #333;
  background: rgba(0, 0, 0, .8);
  border-radius: 5px;
  bottom: 26px;
  color: #fff;
  content: attr(data-tooltip);
  left: 20%;
  padding: 5px 15px;
  position: absolute;
  z-index: 98;
  width: 220px;
}
.progress3:hover:before {
  border: solid;
  border-color: #333 transparent;
  border-width: 6px 6px 0 6px;
  bottom: 20px;
  content: "";
  left: 50%;
  position: absolute;
  z-index: 99;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<div title='abc' data-tooltip="This is some information for our tooltip." class="progress3">
  title='abc' will not be displayed
</div>
```

[小提琴](http://jsfiddle.net/xameeramir/7cuumng4/embedded/result/#Result)

# c# - 如何使用 C# 在安装包中使用启动条件选项

> ID：457368
> 
> 赞同：0
> 
> 时间：2009-01-19T11:49:38.143
> 
> 标签：c#, installation-package

我希望我的应用程序（在开始安装之前）检查**Nokia_PC_Suite_rel_7_0_8_2** 我的步骤是：

1）我添加了注册表搜索，它的属性是

```
Property = PCSUITERUNTIMEEXISTS, RegKey = HKEY_LOCAL_MACHINE\SOFTWARE\PCSuite\Product, Root= vsdrrHKLM, Value = Nokia Pc Suite 
```

注意：我`Value`从注册表编辑器中获得了属性的值，我双击 PCSiute 然后我找到 Product 当我点击它时，我发现一个带有 2 个文本的对话：

1.  值名称
2.  价值数据

2）我添加了名为“PCSuite Runtime installed, if not prompt user”的新启动条件，其属性为：

```
 condition = PCSUITERUNTIMEEXISTS //(it's a drop down list so I selected the condition I created in "Registry Search"), 
Messege = [ProductName] requires Nokia_PC_Suite_rel_7_0_8_2  runtime. 
Please run setup.exe to install the prerequisites for this application. 
```

现在在 setup.exe 中，我添加了 Nokia_PC_Suite_rel_7_0_8_2.exe 作为先决条件，因此当用户双击 setup.exe 时，如果他取消了整个安装，他将要求他安装 Nokia_PC_Suite_rel_7_0_8_2。

真正发生的是，当我单击 .msi 文件时，总是显示消息（“[ProductName] 需要 Nokia_PC_Suite_rel_7_0_8_2 运行时。请运行 setup.exe 以安装此应用程序的先决条件。”）尽管我的 PC 上安装了 PCSuite 版本.

那么该怎么办？如果他发现 PCSuite 没有显示该消息，我希望他继续安装，以便用户转到 setup.exe。此外，当我卸载 PCSuite 并单击 onsetup.exe 时，它​​开始安装 PCSuite，完成后他显示上一条消息并退出安装。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-24T16:51:59.790

快速测试表明您需要从 RegKey 中省略 HKEY_LOCAL_MACHINE\。因此，您的搜索注册表项将如下所示：

```
Property: PCSUITERUNTIMEEXISTS
RegKey: SOFTWARE\PCSuite\Product
Root: vsdrrHKLM
Value:  Nokia Pc Suite 
```

Nokia Pc Suite needs to be a value (not a Key) that has data. I noticed in my testing just having a Value in the Registry Key that has no data the check will still fail.

If you are just trying to check for the existence of a **KEY** leave the value blank.

# entity-framework - 我应该共享实体框架上下文还是为每个操作创建一个新上下文？

> ID：457369
> 
> 赞同：22
> 
> 时间：2009-01-19T11:50:30.450
> 
> 标签：entity-framework, .net-3.5

关于使用和重用 entity-framework 的最佳实践，我不是很清楚`Context`。

我的问题是，我应该尝试创建 1 个上下文并将其多次重复用于不同的查询，还是应该为每个查询创建一个新的上下文？

例如，如果我有一个包含 10 个图表的表单，所有图表的数据都是从同一个表中查询的，那么这 10 个查询应该来自一个上下文还是 10 个不同的上下文？

从代码封装的角度来看，我更喜欢创建 10 个新的上下文，这是一个好主意吗？它是否可扩展？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-22T21:11:20.910

这完全取决于您的应用程序。

一个关键的考虑因素是 ObjectContext 不是线程安全的，因此对于 Web 应用程序 ObjectContext 每个请求是要走的路。

对于 Win Forms 应用程序，您可以查看具有更长寿命的 ObjectContexts。但是，如果您希望更紧密地确定范围，我会先尝试，而不是过早地优化它。

更多关于丹尼西蒙斯博客[的信息](http://blogs.msdn.com/dsimmons/archive/2008/02/17/context-lifetimes-dispose-or-reuse.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T12:14:53.053

恕我直言 - 我可能是错的，但我就是这样做的......

如果您在谈论模型 - 上下文，请使用一个。由于您只需要一个模型 - 查询的上下文 - 即这是数据库模型。

如果您在谈论 ObjectContext - 每个查询（Linq）一个。看看这个[实体框架的性能注意事项](http://msdn.microsoft.com/en-us/library/cc853327.aspx)

# c# - C#：如何将 BITMAP 字节数组转换为 JPEG 格式？

> ID：457370
> 
> 赞同：25
> 
> 时间：2009-01-19T11:50:58.810
> 
> 标签：c#, .net, jpeg, bmp

如何使用 .net 2.0 将字节数组格式的 BITMAP 转换为 JPEG 格式？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-19T11:56:35.663

你是什​​么类型的`byte[]`？原始文件流数据？在这种情况下，如何（`System.Drawing.dll`在客户端应用程序中使用）：

```
 using(Image img = Image.FromFile("foo.bmp"))
    {
        img.Save("foo.jpg", ImageFormat.Jpeg);
    } 
```

或者，如果您确实有 a ，请`FromStream`与 a 一起使用：`new MemoryStream(arr)``byte[]`

```
 byte[] raw = ...todo // File.ReadAllBytes("foo.bmp");
    using(Image img = Image.FromStream(new MemoryStream(raw)))
    {
        img.Save("foo.jpg", ImageFormat.Jpeg);
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T12:08:58.523

如果它只是原始像素数据的缓冲区，而不是完整的图像文件（包括标题等，例如 JPEG），那么您不能使用 Image.FromStream。

我认为您可能正在寻找的是 System.Drawing.Bitmap.LockBits，返回 System.Drawing.Imaging.ImageData; 这提供了使用指向内存的指针来读取和写入图像像素的访问。

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2012-04-12T13:50:45.850

```
public static Bitmap BytesToBitmap(byte[] byteArray)
{
  using (MemoryStream ms = new MemoryStream(byteArray))
  {
    Bitmap img = (Bitmap)Image.FromStream(ms);
    return img;
  }
} 
```

# linux - 适用于 Mac OS X 或 Linux 的 Java 微型版 (JME) SDK

> ID：457378
> 
> 赞同：1
> 
> 时间：2009-01-19T11:54:14.247
> 
> 标签：linux, macos, java-me

这个问题从标题就很清楚了。

是否有适用于 Mac OS X 或 Linux 的 Java Micro Edition 的 SDK？还是需要 Windows XP 来开发 JME 应用程序？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T12:01:18.307

不，有一个“但是”

主要供应商没有可用于 Mac 的 WTK（无线工具包）（[NetBeans Wiki 参考](http://wiki.netbeans.org/FaqJ2MEOtherOpSys)），因此基本上您无法调试或测试代码。但是，您可以使用第三方公司的模拟器：[MPowerPlayer](http://mpowerplayer.com/)

如果您在除 windows 之外的任何其他操作系统中使用 netbeans，您仍然可以使用工具/插件菜单下载和添加 J2ME 包。然后，您可以将 MPowerPlayer 作为 J2ME 平台添加到 IDE。Netbeans（我猜任何其他支持 J2ME WTK 的 IDE）都会将其识别为有效的 WTK，

我已经在我的博客中发布了一个关于此的特定条目，但它是西班牙语的，尽管也许你可以关注这些图像。试一试，不要犹豫，问任何问题： [Mac Os 中的 J2ME 和 NetBeans](http://crazypointer.blogspot.com/2008/08/j2medesarrollo-de-aplicaciones-j2me-en.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T10:18:55.000

官方上 Sun 的 WTK 仅在 Linux 和 Windows 上可用，但是这两个 SDK 都可以在 Mac 上用于编译 J2ME 应用程序。不幸的是，模拟器和预验证器将不起作用（因为它们不是基于 Java 的），因此您将无法测试您的应用程序。

要解决这个问题，您可以使用 MicroEmulator 或 MPowerPlayer 进行仿真和预验证（您也可以使用 PhoneME 进行预验证）。

这是使用[Eclipse](http://javablog.co.uk/2007/08/29/j2me-development-on-os-x/)设置开发环境的一个很好的指南，这对[Netbeans](http://javablog.co.uk/2008/01/17/j2me-development-on-os-x-revisited/)很有用。

但是，如果我能给个建议（我从事J2ME开发工作两年了，我是Mac用户），最好通过虚拟机在Windows或Linux上开发，因为这两个模拟器没有非常符合 JSR 的标准并且不包括所有这些。此外，在 OSX 上，您将很难测试蓝牙或 LocationAPIs 等功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T11:56:53.090

Netbeans 有一个 JME SDK

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T16:11:38.750

可能这有帮助，我找到了一个适用于 Mac OS X 的 Java ME Developer Studio，由 Motorola 开发，我还没有测试过，它只是 EA 版本，我会试试这个，我会让你在随后的帖子中知道，

[http://developer.motorola.com/docstools/motodevstudio/javame/downloads/](http://developer.motorola.com/docstools/motodevstudio/javame/downloads/)

干杯

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-15T18:01:44.753

奇怪的是......我刚刚在**5 分钟前**在 Linux 上设置了这个。

你会需要：

[http://linux.com/archive/feature/122050](http://linux.com/archive/feature/122050)

[http://java.sun.com/products/sjwtoolkit/download.html](http://java.sun.com/products/sjwtoolkit/download.html) <-- WTK

WTK 安装程序将询问您的 JDK 在哪里。做

```
find . -name "jar" -type f 
```

然后你在哪里

```
/usr/lib/jvm/foo/bar/bin/jar 
```

敲击“jar”并将该路径提供给安装程序。这将安装包含电话模拟器的**ktoolbar 。**

下载netbeans并安装移动插件

**这不是纯 J2ME，但包含了大部分 API**

我正在使用它为我的 SE-C902 开发应用程序

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-01T22:22:46.357

是的，可以在此处下载 OSX 的官方 SDK：[https](https://www.oracle.com/technetwork/java/javame/downloads/sdk30-mac-jsp-137878.html) ://www.oracle.com/technetwork/java/javame/downloads/sdk30-mac-jsp-137878.html 。Microemulator, [http://www.microemu.org](http://www.microemu.org)也很好用，我听说有人成功使用了 MPowerPlayer。

# git - 如何在 git 中编辑不正确的提交消息（我已推送）？

> ID：457379
> 
> 赞同：156
> 
> 时间：2009-01-19T11:56:23.837
> 
> 标签：git, commit-message

我想修改历史更深的提交消息，并且我已经推送了许多新的提交。

如何更改提交消息？可能吗？

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2009-01-19T12:07:31.460

来自 Linus Torvalds 的消息可能会回答您的问题：

[修改/编辑旧的提交消息](http://www.gelato.unsw.edu.au/archives/git/0702/38650.html)

简短的回答：你不能（如果被推）。

* * *

提取（Linus 将 BitKeeper 称为 BK）：

> 旁注，只是出于历史兴趣：在 BK 你可以。
> 
> 如果你习惯了（就像我一样），它真的很实用。我会使用 Andrew 的补丁炸弹，发现有问题，然后在推出之前对其进行编辑。
> 
> 我可以用 git 做同样的事情。让提交消息不成为名称的一部分已经很容易了，并且仍然保证历史未被触及，并允许“稍后修复评论”的事情。
> 
> 但我没有。
> 
> 其中一部分纯粹是“内部一致性”。Git 只是一个*更干净*的 系统，这要归功于所有内容都受 SHA1 保护，并且无论对象类型如何，所有对象都被同等对待。是的，有四种不同的对象，它们都非常不同，它们不能以相同的方式使用，但同时，即使它们在磁盘上的编码可能不同，*从概念上讲*它们都可以正常工作相同。
> 
> 但内部一致性并不是不灵活的真正借口，如果我们能在错误发生后纠正错误，显然会非常灵活。所以这不是一个非常有力的论据。
> 
> git 不允许您更改提交消息的*真正原因最终非常简单：这样，您就可以信任这些消息。*如果您允许人们事后更改它们，则这些消息本质上不是很值得信赖。

* * *

为了完整起见，您*可以按照*[sykora](https://stackoverflow.com/questions/457379#457402)的建议重写本地提交历史记录以反映您想要的内容（使用一些 rebase 和 reset --hard，喘气！）

但是，一旦您*再次*发布修改后的历史记录（带有`git push origin +master:master`，`+`强制推送发生的标志，即使它不会导致“快进”提交）......您[可能会遇到一些麻烦](https://stackoverflow.com/questions/253055#432518)。

从另一个 SO 问题中提取：

> 实际上，我曾经用 --force 推送到 git.git 存储库并被 Linus BIG TIME 责骂。它会给其他人带来很多问题。一个简单的答案是“不要这样做”。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-10-16T21:31:46.490

目前[git replace](http://www.kernel.org/pub/software/scm/git/docs/git-replace.html)可能会解决问题。

详细：创建临时工作分支

```
git checkout -b temp 
```

重置为要替换的提交

```
git reset --hard <sha1> 
```

用正确的信息修改提交

```
git commit --amend -m "<right message>" 
```

用新的提交替换旧的提交

```
git replace <old commit sha1> <new commit sha1> 
```

回到你所在的分支

```
git checkout <branch> 
```

删除临时分支

```
git branch -D temp 
```

推

```
guess 
```

完毕。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-01-29T13:02:11.783

您可以使用`git rebase -i`（针对您分支的分支）“i”进行交互。

`pick`将您希望更改的提交注释旁边的替换为`r`（或`reword`），保存并退出，然后您将能够进行编辑。

`git push`再一次，你就完成了！

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2017-01-07T06:56:34.830

假设你有一棵这样的树：

```
dd2e86 - 946992 - 9143a9 - a6fd86 - 5a6057 [master] 
```

首先，`checkout`一个临时分支：

```
git checkout -b temp 
```

在`temp`分支上，`reset --hard`要更改其消息的提交（例如，该提交是`946992`）：

```
git reset --hard 946992 
```

用于`amend`更改消息：

```
git commit --amend -m "<new_message>" 
```

之后，树将如下所示：

```
dd2e86 - 946992 - 9143a9 - a6fd86 - 5a6057 [master]
           \
            b886a0 [temp] 
```

然后，`cherry-pick`所有在`946992`from `master`to之前的`temp`提交并提交它们，`amend`如果您也想更改它们的消息，请使用：

```
git cherry-pick 9143a9
git commit --amend -m "<new_message>
...
git cherry-pick 5a6057
git commit --amend -m "<new_message> 
```

树现在看起来像这样：

```
dd2e86 - 946992 - 9143a9 - a6fd86 - 5a6057 [master]
               \
                b886a0 - 41ab2c - 6c2a3s - 7c88c9 [temp] 
```

现在强制将临时分支推送到远程：

```
git push --force origin temp:master 
```

最后一步，`master`在本地删除分支，从服务器`git fetch origin`拉取分支`master`，然后切换到分支`master`并删除分支`temp`。

现在您的本地和远程都将更新所有消息。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-05-29T20:35:29.517

在我们的商店中，我介绍了将可识别命名的带注释标签添加到具有错误消息的提交的约定，并使用注释作为替换。

尽管这对运行随意的“git log”命令的人没有帮助，但它确实为我们提供了一种方法来修复评论中不正确的错误跟踪器引用，并且我所有的构建和发布工具都理解这个约定。

这显然不是一个通用的答案，但它可能是人们可以在特定社区内采用的东西。我敢肯定，如果这被大规模使用，最终可能会出现某种瓷器支撑物……

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-19T12:08:40.990

（来自[http://git.or.cz/gitwiki/GitTips#head-9f87cd21bcdf081a61c29985604ff4be35a5e6c0](http://git.or.cz/gitwiki/GitTips#head-9f87cd21bcdf081a61c29985604ff4be35a5e6c0)）

> 如何更改历史更深的提交
> 
> 由于 Git 中的历史是不可变的，因此修复除最近提交（不是分支头的提交）之外的任何内容都需要从更改的提交中重写历史并转发。
> 
> 您可以为此使用 StGIT，必要时初始化分支，取消提交到您要更改的提交，必要时弹出它，进行更改然后刷新补丁（如果要更正提交消息，请使用 -e 选项），然后推送一切和 stg 提交。
> 
> 或者你可以使用 rebase 来做到这一点。创建新的临时分支，使用 git reset --hard 将其倒回到您要更改的提交，更改该提交（它将是当前头部的顶部），然后使用 git rebase --onto 在更改的提交之上重新设置分支。
> 
> 或者您可以使用 git rebase --interactive，它允许进行各种修改，例如补丁重新排序、折叠、...

我认为这应该回答你的问题。但是，请注意，如果您已将代码*推*送到远程存储库并且人们已从中提取代码，那么这将弄乱他们的代码历史以及他们所做的工作。所以要小心。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-02T08:16:16.270

如果您使用的是 Git Extensions：进入 Commit 屏幕，底部应该有一个“Amend Commit”复选框，如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/6WaTd.png)](https://i.stack.imgur.com/6WaTd.png)

# asp.net - 如何在 ASP.NET 中禁用下层渲染？

> ID：457399
> 
> 赞同：3
> 
> 时间：2009-01-19T12:07:47.433
> 
> 标签：asp.net, xhtml, asp.net-2.0, w3c

如何禁用 ASP.NET 2.0 站点的下层呈现？

我有一个所有其他页面都继承自的母版页，并且不希望将服务器控件的“下级”版本发送给 Google 和 W3C 验证器。如果可以为我网站上所有页面上的所有用户禁用此功能，最好的办法是。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T12:19:14.713

有很多方法可以做到这一点。

在页面级别（以声明方式或在代码中）您可以使用页面的[ClientTarget](http://msdn.microsoft.com/en-us/library/system.web.ui.page.clienttarget.aspx)属性：

```
ClientTarget="Uplevel" // Will force to IE6 capabilities. 
```

或者，正如 Annakata 刚刚发布的那样，使用[浏览器上限](http://msdn.microsoft.com/en-us/library/x3k2ssx2.aspx)设置

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T12:16:07.840

有一个本机组件和一些配置可能性。

谷歌搜索“浏览器功能”或“browsercaps”会抛出一些很好的链接，但这里有一些来自 MSDN 的可靠链接。

*   [ASP.NET Web 服务器控件和浏览器功能](http://msdn.microsoft.com/en-us/library/x3k2ssx2(VS.85).aspx)

*   [browserCaps 元素（ASP.NET 设置架构）](http://msdn.microsoft.com/en-us/library/sk9az15a.aspx)

# python - 是否有适用于 Python 的 erf() 的简单实现？

> ID：457408
> 
> 赞同：63
> 
> 时间：2009-01-19T12:10:58.863
> 
> 标签：python, math

我可以自己实现错误函数 erf，但我不想这样做。是否有一个没有外部依赖项的 python 包包含此函数的实现？我发现[了这个](http://pylab.sourceforge.net/packages/included_functions.html)，但这似乎是一些更大的包的一部分（甚至不清楚是哪一个！）。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2011-07-12T09:31:08.903

从 v.2.7 开始。标准*数学*模块包含*erf*函数。这应该是最简单的方法。

[http://docs.python.org/2/library/math.html#math.erf](http://docs.python.org/2/library/math.html#math.erf)

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-01-19T14:46:13.170

我建议将 SciPy 用于 Python 中的数值函数，但如果你想要没有依赖关系的东西，这里有一个错误函数，错误小于 1.5 * 10 ^(-7)对于所有输入。

```
def erf(x):
    # save the sign of x
    sign = 1 if x >= 0 else -1
    x = abs(x)

    # constants
    a1 =  0.254829592
    a2 = -0.284496736
    a3 =  1.421413741
    a4 = -1.453152027
    a5 =  1.061405429
    p  =  0.3275911

    # A&S formula 7.1.26
    t = 1.0/(1.0 + p*x)
    y = 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*math.exp(-x*x)
    return sign*y # erf(-x) = -erf(x) 
```

该算法来自[数学函数手册](https://rads.stackoverflow.com/amzn/click/com/0486612724)，公式 7.1.26。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-01-19T12:47:09.697

我建议您下载[numpy](http://sourceforge.net/project/showfiles.php?group_id=1369&package_id=175103)（在 python 中具有高效矩阵）和[scipy](http://www.scipy.org/)（使用 numpy 的 Matlab 工具箱替代品）。erf功能在于scipy。

```
>>>from scipy.special import erf
>>>help(erf) 
```

您也可以使用 pylab 中定义的 erf 函数，但这更多是为了绘制您使用 numpy 和 scipy 计算的结果的结果。如果您想要这些软件的一体化安装，您可以直接使用[Python Enthought 发行版](http://www.enthought.com/products/epd.php)。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-20T21:44:09.143

可以在 mpmath 模块 ( [http://code.google.com/p/mpmath/](http://code.google.com/p/mpmath/) )中找到纯 python 实现

从文档字符串：

```
>>> from mpmath import *
>>> mp.dps = 15
>>> print erf(0)
0.0
>>> print erf(1)
0.842700792949715
>>> print erf(-1)
-0.842700792949715
>>> print erf(inf)
1.0
>>> print erf(-inf)
-1.0 
```

对于大 real `x`，`\mathrm{erf}(x)`非常快地接近 1::

```
>>> print erf(3)
0.999977909503001
>>> print erf(5)
0.999999999998463 
```

误差函数是一个奇函数：

```
>>> nprint(chop(taylor(erf, 0, 5)))
[0.0, 1.12838, 0.0, -0.376126, 0.0, 0.112838] 
```

:func:`erf`实现任意精度评估并支持复数::

```
>>> mp.dps = 50
>>> print erf(0.5)
0.52049987781304653768274665389196452873645157575796
>>> mp.dps = 25
>>> print erf(1+j)
(1.316151281697947644880271 + 0.1904534692378346862841089j) 
```

**相关功能**

另请参见 :func: `erfc`，它对 large 更准确`x`，以及 :func:`erfi`给出 的反导数 `\exp(t^2)`。

菲涅耳积分 :func:`fresnels`和 :func:`fresnelc` 也与误差函数有关。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-19T15:54:40.440

为了回答我自己的问题，我最终使用了以下代码，改编自我在网上其他地方找到的 Java 版本：

```
# from: http://www.cs.princeton.edu/introcs/21function/ErrorFunction.java.html
# Implements the Gauss error function.
#   erf(z) = 2 / sqrt(pi) * integral(exp(-t*t), t = 0..z)
#
# fractional error in math formula less than 1.2 * 10 ^ -7.
# although subject to catastrophic cancellation when z in very close to 0
# from Chebyshev fitting formula for erf(z) from Numerical Recipes, 6.2
def erf(z):
    t = 1.0 / (1.0 + 0.5 * abs(z))
        # use Horner's method
        ans = 1 - t * math.exp( -z*z -  1.26551223 +
                            t * ( 1.00002368 +
                            t * ( 0.37409196 + 
                            t * ( 0.09678418 + 
                            t * (-0.18628806 + 
                            t * ( 0.27886807 + 
                            t * (-1.13520398 + 
                            t * ( 1.48851587 + 
                            t * (-0.82215223 + 
                            t * ( 0.17087277))))))))))
        if z >= 0.0:
            return ans
        else:
            return -ans 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-10-26T06:41:50.393

我有一个函数可以进行 10^5 次 erf 调用。在我的机器上...

scipy.special.erf 的时间为 6.1 秒

erf 数学函数手册耗时 8.3s

erf Numerical Recipes 6.2 需要 9.5 秒

（三次运行平均值，代码取自上述海报）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-12-23T14:37:14.753

对于那些追求更高性能的人来说，一个注意事项是：如果可能的话，进行矢量化。

```
import numpy as np
from scipy.special import erf

def vectorized(n):
    x = np.random.randn(n)
    return erf(x)

def loopstyle(n):
    x = np.random.randn(n)
    return [erf(v) for v in x]

%timeit vectorized(10e5)
%timeit loopstyle(10e5) 
```

给出结果

```
# vectorized
10 loops, best of 3: 108 ms per loop

# loops
1 loops, best of 3: 2.34 s per loop 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-24T08:28:00.877

SciPy 具有该`erf`功能的实现，请参见[scipy.special.erf](https://docs.scipy.org/doc/scipy-1.4.1/reference/generated/scipy.special.erf.html)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-07T12:03:58.847

在[Python 的 math.erf 函数文档](https://github.com/python/cpython/blob/main/Modules/mathmodule.c)中，它在近似值中使用了多达 50 个术语：

```
Implementations of the error function erf(x) and the complementary error
   function erfc(x).
   Method: we use a series approximation for erf for small x, and a continued
   fraction approximation for erfc(x) for larger x;
   combined with the relations erf(-x) = -erf(x) and erfc(x) = 1.0 - erf(x),
   this gives us erf(x) and erfc(x) for all x.
   The series expansion used is:
      erf(x) = x*exp(-x*x)/sqrt(pi) * [
                     2/1 + 4/3 x**2 + 8/15 x**4 + 16/105 x**6 + ...]
   The coefficient of x**(2k-2) here is 4**k*factorial(k)/factorial(2*k).
   This series converges well for smallish x, but slowly for larger x.
   The continued fraction expansion used is:
      erfc(x) = x*exp(-x*x)/sqrt(pi) * [1/(0.5 + x**2 -) 0.5/(2.5 + x**2 - )
                              3.0/(4.5 + x**2 - ) 7.5/(6.5 + x**2 - ) ...]
   after the first term, the general term has the form:
      k*(k-0.5)/(2*k+0.5 + x**2 - ...).
   This expansion converges fast for larger x, but convergence becomes
   infinitely slow as x approaches 0.0\.  The (somewhat naive) continued
   fraction evaluation algorithm used below also risks overflow for large x;
   but for large x, erfc(x) == 0.0 to within machine precision.  (For
   example, erfc(30.0) is approximately 2.56e-393).
   Parameters: use series expansion for abs(x) < ERF_SERIES_CUTOFF and
   continued fraction expansion for ERF_SERIES_CUTOFF <= abs(x) <
   ERFC_CONTFRAC_CUTOFF.  ERFC_SERIES_TERMS and ERFC_CONTFRAC_TERMS are the
   numbers of terms to use for the relevant expansions. 

#define ERF_SERIES_CUTOFF 1.5
#define ERF_SERIES_TERMS 25
#define ERFC_CONTFRAC_CUTOFF 30.0
#define ERFC_CONTFRAC_TERMS 50

   Error function, via power series.
   Given a finite float x, return an approximation to erf(x).
   Converges reasonably fast for small x. 
```

# c++ - 在 C++ 中发送崩溃报告、产品注册等的正常方式是什么？

> ID：457419
> 
> 赞同：6
> 
> 时间：2009-01-19T12:19:06.180
> 
> 标签：c++, windows, communication

发送崩溃报告、产品注册等的正常方式是什么？换句话说，您如何保证您的 C++ Windows 应用程序可以“打电话回家”？

我无论如何都不是新手，但我完全迷失在这个领域。我以前从来没有做过，所以会很感激任何建议。

亲切的问候，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T12:48:25.840

对于崩溃报告，我强烈建议利用 Microsoft 的[WinQual](https://winqual.microsoft.com/)服务，而不是尝试创建自己的服务。它是免费的，并且与 Windows 无缝集成，至少从 XP 开始。它在最基本的层面上也不需要任何代码或客户端更改。要利用更高级的功能，您可以使用[Windows 错误报告](http://msdn.microsoft.com/en-us/library/bb513641(VS.85).aspx)API。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T12:25:34.013

我编写的代码只是使用用户默认的电子邮件应用程序和纯文本信息创建了一封包含所需信息的电子邮件。我**总是**得到用户的许可才能发送它，清楚地解释为什么我认为这些信息是必要的。未经他们的明确许可，不会发送任何内容。

我也更喜欢使用纯文本（内存转储等并不总是可能的），这样他们就可以检查正在发送的内容，而不是个人或识别信息。

我对这些东西非常小心，因为这样做可能会产生法律影响，至少在我经营的司法管辖区是这样。无论如何，出于礼貌，应始终在用户许可的情况下完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T12:54:13.863

就崩溃报告而言，初学者可以使用[WER](http://en.wikipedia.org/wiki/Windows_Error_Reporting)。它有它的缺点（最大的问题是你必须在 microsoft 注册它并且所有报告都发送到中央 microsoft 服务器）并且最适合驱动程序软件。

如果您需要其他任何东西（在此处添加您自己的愿望），您可以推出自己的解决方案（codeproject.com 搜索提供了一些替代方案 - 只需转到“崩溃报告”）。

关于产品注册 - 还必须有第 3 方解决方案可用。我还没有听说过任何“内置”的东西，但这是一个很大的话题——你必须更具体地了解你所追求的功能。

# delphi - Delphi 中是否有用于浮点数的 TSpinEdit？

> ID：457426
> 
> 赞同：7
> 
> 时间：2009-01-19T12:23:35.000
> 
> 标签：delphi, controls

Delphi 中的浮点数真的没有 TSpinEdit 控件吗？看起来有[第三方组件](http://www.tmssoftware.com/site/advspin.asp)提供了一个可以工作的控件。

你如何为浮动实现 TSpinEdit？我一直在使用 TEDit 字段和位于其旁边的 TSpinButton 创建自己的字段，但似乎应该有更好的方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T12:27:55.303

TJvSpinEdit 是[JEDI 可视化组件库](http://homepages.codegear.com/jedi/jvcl/)的一部分。据我所知，它有一个名为 ValueType 的属性，您可以将其设置为 vtFloat。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T12:26:24.090

据我所知，Delphi 中不存在这样的组件。

我还使用了来自 3rd 方库的组件[SpTBXLib](http://www.silverpointdevelopment.com/sptbxlib/index.htm)，这对其他东西也非常有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T12:30:02.290

即使没有，您也可以使用两个按钮和一个文本框轻松创建一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T12:34:53.853

Delphi 中没有，但您可以创建自己的。我已经为我的开源项目这样做了，您可以[将其](https://monex.svn.sourceforge.net/svnroot/monex/trunk/Komponente/SteviloEdit/)作为您自己的起点来查看。

**编辑**：您还需要以下两个文件才能使其正常工作：

*   [KomponenteSplosno.pas](https://monex.svn.sourceforge.net/svnroot/monex/trunk/Komponente/Splosno/KomponenteSplosno.pas)
*   [RisanjeSplosno.pas](https://monex.svn.sourceforge.net/svnroot/monex/trunk/Knjiznice/RisanjeSplosno.pas)

# flash - MovieClipLoader 失败（与缓存有关）

> ID：457430
> 
> 赞同：0
> 
> 时间：2009-01-19T12:25:36.370
> 
> 标签：flash, actionscript-2

我有一个小的 Flash 文件，它只加载并显示一个缩放以适合内容区域的图像。我们将这些与 javascript 库一起使用，因此我们在一个 html 页面上有多个实例（嵌入了 swfObject） 我一直在使用 MovieClipLoader 来加载 jpg，但它不再有效。

我们更新了服务器，据我所知，只有与缓存相关的相关内容发生了变化。以前总是重新加载所有图像和 swf。现在它们应该从缓存中加载。

我可以从萤火虫看到 swf 实际上正在加载 jpg 它只是不显示任何内容。这发生在许多浏览器/操作系统/闪存插件组合上。有时一些图像显示，有时没有。

moviecliploader 事件处理程序（onloadinit、onloaderror）中的代码永远不会运行。

任何关于如何使这项工作的想法将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-20T06:33:04.880

过去我在使用多个 MovieClipLoader 实例时遇到过麻烦。与您类似，一些加载器似乎超时，从不显示它们应该加载的图像。有人告诉我这是由于 HTTP 同时线程限制，据说一次下载两个（但从未得到确认）。

如果您在页面上使用多个 swf 文件，而不是使用一个主闪存来加载所有文件，则尤其如此。

我通过在 Flash 中创建一个简单的排队系统解决了这个问题，其中最多可以同时加载两个 movieClipLoader。无论何时完成，它都会触发下一次下载，依此类推，直到处理完所有下载。那效果很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T07:39:23.107

我不能使用单个主闪光灯。我们需要为每个图像使用单独的闪存加载器。据我所知，不可能创建一个处理 1 到 N 个闪存加载程序的排队系统。

经过大量测试后，我发现当 Flash 加载时，第 1 帧中的动作根本没有运行，所以这似乎不是 MovieClipLoader 的错误。我添加了一个简单的代码，在舞台上绘制一条蓝线到第一帧，当加载失败时，这条线根本不会出现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T14:05:13.390

我找到了解决方案。

原来问题与缓存有关，但与 MovieClipLoader 无关。

我正在根据 Stage.width 和 Stage.height 缩放加载的图像。我发现 flash 有时会在短时间内给出 0 的宽度和高度。即使舞台上有可见的东西，这也可能发生。以前这不是问题，因为一旦加载图像，尺寸就正确了。现在，当图像来自缓存时，尺寸有时为 0。

解决方案是在 onEnterFrame 处理程序中检查舞台尺寸，并且仅在尺寸大于 0 的情况下继续加载

# c++ - 如果指针已标记为 const，是否限制 C 中的帮助？

> ID：457441
> 
> 赞同：25
> 
> 时间：2009-01-19T12:30:17.780
> 
> 标签：c++, c, optimization, restrict-qualifier

只是想知道：当我向指针添加限制时，我告诉编译器该指针不是另一个指针的别名。假设我有一个类似的功能：

```
// Constructed example
void foo (float* result, const float* a, const float* b, const size_t size)
{
     for (size_t i = 0; i < size; ++i)
     {
         result [i] = a [0] * b [i];
     }
} 
```

如果编译器必须假设`result`可能与 重叠`a`，则它必须每次重新获取 a。但是，正如`a`所标记`const`的，编译器也可以假设 a 是固定的，因此获取它一次是可以的。

问题是，在这种情况下，使用限制的推荐方法是什么？我当然不希望编译器`a`每次都重新获取，但我找不到关于`restrict`应该如何在这里工作的好信息。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-19T12:35:52.387

您的指针是 const，告诉任何调用您的函数的人您不会触及通过该变量指向的数据。不幸的是，编译器仍然不知道 result 是否是 const 指针的别名。您始终可以将非常量指针用作 const 指针。例如，许多函数将 const char（即字符串）指针作为参数，但如果您愿意，您可以向它传递一个非 const 指针，该函数只是向您保证它不会使用该特定指针改变任何东西的指针。

基本上，为了更接近您的问题，您需要在 a 和 b 中添加限制，以便“承诺”编译器使用此函数的人不会将结果作为别名传递给 a 或 b。当然，假设你能够做出这样的承诺。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-10-25T15:10:02.020

这里的每个人似乎都很困惑。到目前为止，在任何答案中都没有一个 const 指针示例。

声明`const float* a`不是const 指针，而是 const 存储**。**指针仍然是可变的。`float *const a`是一个指向可变浮点数的 const 指针。

所以问题应该是，有什么意义`float *const restrict a`（或者`const float *const restrict a`如果你愿意的话）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2017-04-28T02:46:08.067

是的，你需要限制。 **Pointer-to-const 并不意味着没有任何东西可以改变数据，只是你不能通过那个指针来改变它**。

`const`主要是一种机制，要求编译器帮助您跟踪您希望允许函数修改哪些内容。 **`const`不是向编译器承诺函数真的不会修改数据**。

与 不同`restrict`的是，使用指向`const`可变数据的指针基本上是对其他人的承诺，而不是对编译器的承诺。到处丢弃`const`不会导致优化器 (AFAIK) 出现错误行为，除非您尝试修改编译器放入只读内存的内容（请参阅下面的`static const`变量）。如果编译器在优化时看不到函数的定义，它必须假设它`const`通过该指针丢弃和修改数据（即该函数不尊重`const`其指针参数的性质）。

但是，编译器确实知道`static const int foo = 15;`无法更改，并且即使您将其地址传递给未知函数，它也会可靠地内联该值。（这就是为什么`static const int foo = 15;`不比`#define foo 15`优化编译器慢的原因。好的编译器会`constexpr`尽可能地优化它。）

* * *

**请记住，这`restrict`是对编译器的承诺，即您通过该指针访问的内容不会与其他任何内容重叠**。如果这不是真的，那么您的功能不一定会达到您的预期。例如，不要打电话`foo_restrict(buf, buf, buf)`就地操作。

以我的经验（使用 gcc 和 clang），`restrict`主要对您存储的指针有用。放在源指针上也没有什么坏处，但是如果你的函数所做的*所有*`restrict`存储都是通过指针，通常你可以通过将它放在目标指针上来获得所有可能的 asm 改进。*`restrict`*

 *如果您的循环中有任何函数调用，`restrict`则在源指针上确实可以让 clang（但不是 gcc）避免重新加载。在 Godbolt 编译器资源管理器上查看[这些测试用例](https://gcc.godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,source:'void+maybe_cast_away_const(const+int+*,+int)%3B%0Avoid+value_only(int)%3B%0A%0A//+The+address+of+these+static+variables+only+escapes+the+compilation+unit+as+a+pointer-to-const.%0A//+so+the+compiler+knows+that+maybe_cast_away_const+can!'t+find+a+pointer+to+them+in+a+global.%0Astatic+int+static_data+%3D+11%3B%0Aconst+static+int+static_const_data+%3D+10%3B%0Aint+pointer_to_static(void)%0A%7B%0A++++//+passing+the+value+forces+a+load+before+the+call%0A%0A++++maybe_cast_away_const(%26static_data,+static_data)%3B%0A++++//value_only(static_data)%3B++//+with+this,+static_data+is+optimized+away+as+a+constant%0A++++//maybe_cast_away_const(%26static_const_data,+static_const_data)%3B+//+still+optimized+away,+compiler+knows+that+a+static+const+is+really+read-only+(e.g.+casting+away+const+would+segfault)%0A%0A++++//+and+this+forces+the+compiler+to+have+it+in+a+reg+after%0A++++return+5+%2B+static_data%3B%0A%7D%0A%0A%0A//+Without+__restrict__,+the+compiler+has+to+assume+that+value_only+might+modify+*src+as+a+side-effect%0A//+since+our+caller+might+have+stored+src+in+a+global+that+value_only+can+see.%0A//+clang+takes+advantage+of+this,+gcc+reloads+anyway.%0Aint+arg_pointer_valonly(const+int+*__restrict__+src)%0A%7B%0A++++value_only(*src)%3B%0A++++return+5+%2B+*src%3B++//+clang:+no+reload+because+of+__restrict__%0A%7D%0A%0Aint+arg_pointer_escape(const+int+*__restrict__+src)%0A%7B%0A++++maybe_cast_away_const(src,+*src)%3B%0A++++return+5+%2B+*src%3B%0A%7D%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:36.21252948964307,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:clang400,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-xc+-O3+-std%3Dc11+-Wall+-fno-tree-vectorize+-fno-unroll-loops++-march%3Dhaswell',source:1),l:'5',n:'0',o:'x86-64+clang+4.0.0+(Editor+%231,+Compiler+%231)',t:'0')),k:29.885115337785457,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g63,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-xc+-O3+-std%3Dc11+-Wall+-fno-tree-vectorize++-march%3Dhaswell',source:1),l:'5',n:'0',o:'x86-64+gcc+6.3+(Editor+%231,+Compiler+%232)',t:'0')),k:33.90235517257147,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4)，特别是这个：

```
void value_only(int);  // a function the compiler can't inline

int arg_pointer_valonly(const int *__restrict__ src)
{
    // the compiler needs to load `*src` to pass it as a function arg
    value_only(*src);
    // and then needs it again here to calculate the return value
    return 5 + *src;  // clang: no reload because of __restrict__
} 
```

gcc6.3（针对 x86-64 SysV ABI）决定`src`在函数调用期间将（指针）保存在调用保留寄存器中，并`*src`在调用后重新加载。要么 gcc 的算法没有发现这种优化的可能性，要么认为它不值得，或者 gcc 开发人员故意没有实现它，因为他们认为它不安全。IDK 哪个。但是既然clang做到了，我猜根据C11标准它*可能是合法的。*

clang4.0 对此进行了优化，使其仅加载`*src`一次，并在函数调用期间将值保存在调用保留寄存器中。没有`restrict`，它不会这样做，因为被调用的函数可能（作为副作用）`*src`通过另一个指针进行修改。

**此函数的调用者可能传递了全局变量的地址，例如**. `*src`但是除了通过指针之外的任何修改都会违反对编译器`src`的承诺。`restrict`由于我们不传递`src`给`valonly()`，编译器可以假设它不修改值。

C 的 GNU 方言允许使用[`__attribute__((pure))`或`__attribute__((const))`声明一个函数没有副作用](https://stackoverflow.com/questions/29117836/attribute-const-vs-attribute-pure-in-gnu-c)，允许在没有副作用的情况下进行这种优化`restrict`，但 ISO C11 (AFAIK) 中没有可移植的等效项。当然，允许函数内联（通过将其放入头文件或使用 LTO）也允许这种优化，并且对于小函数来说要好得多，尤其是在循环内调用时。

* * *

编译器通常非常积极地进行标准允许的优化，即使它们让一些程序员感到惊讶并破坏了一些恰好可以工作的现有不安全代码。（C 是如此可移植，以至于许多东西在基本标准中都是未定义的行为；大多数好的实现确实定义了标准保留为 UB 的许多东西的行为。）C 不是一种可以安全地向编译器抛出代码的语言，直到它做你想做的事，而不检查你是否以正确的方式做事（没有有符号整数溢出等）

* * *

**如果您查看用于编译函数的 x86-64 asm 输出（来自问题），您可以很容易地看到差异。我把它放在[Godbolt 编译器资源管理器](https://gcc.godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,source:'%23include+%3Cstdlib.h%3E%0A%0A//+I+used+-fno-tree-vectorize+-fno-unroll-loops%0A//+only+so+the+asm+is+easy+to+read.++(Clang+likes+to+unroll+by+4+even+when+not+vectorizing)%0A%0A//+When+auto-vectorizing+without+__restrict__,%0A//+gcc+and+clang+check+for+overlap+(with+a+bunch+of+integer+code)%0A//+before+running+the+vectorized+loop%0A%0Avoid+foo_norestrict+(float*+result,+const+float*+a,+const+float*+b,+const+size_t+size)%0A%7B%0A++++//+a%5B0%5D+is+reloaded+inside+the+loop%0A+++++for+(size_t+i+%3D+0%3B+i+%3C+size%3B+%2B%2Bi)+%7B%0A+++++++++result%5Bi%5D+%3D+a%5B0%5D+*+b%5Bi%5D%3B%0A+++++%7D%0A%7D%0A%0Avoid+foo_restrict_dst+(float*__restrict__+result,+const+float*+a,+const+float*+b,+const+size_t+size)%0A%7B%0A++++//+The+load+of+a%5B0%5D+is+hoisted+out+of+the+loop%0A+++++for+(size_t+i+%3D+0%3B+i+%3C+size%3B+%2B%2Bi)+%7B%0A+++++++++result%5Bi%5D+%3D+a%5B0%5D+*+b%5Bi%5D%3B%0A+++++%7D%0A%7D%0A%0A%0Avoid+foo_restrict_src+(float*+result,+const+float*__restrict__+a,+const+float*+b,+const+size_t+size)%0A%7B%0A++++//+The+load+of+a%5B0%5D+is+hoisted+out+of+the+loop,%0A++++//+since+__restrict__+promises+that+it+doesn!'t+overlap+with+result%5Bi%5D%0A+++++for+(size_t+i+%3D+0%3B+i+%3C+size%3B+%2B%2Bi)+%7B%0A+++++++++result%5Bi%5D+%3D+a%5B0%5D+*+b%5Bi%5D%3B%0A+++++%7D%0A%7D%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:38.96274343585585,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:clang400,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-O3+-std%3Dc%2B%2B11+-Wall+-fno-tree-vectorize+-fno-unroll-loops++-march%3Dhaswell',source:1),l:'5',n:'0',o:'x86-64+clang+4.0.0+(Editor+%231,+Compiler+%231)',t:'0')),k:36.87541633523677,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g63,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-O3+-std%3Dc%2B%2B11+-Wall+-fno-tree-vectorize++-march%3Dhaswell',source:1),l:'5',n:'0',o:'x86-64+gcc+6.3+(Editor+%231,+Compiler+%232)',t:'0')),k:24.161840228907373,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4)**上。

`restrict`在这种情况下，穿上`a`足以让 clang 提升 的负载`a[0]`，但不是 gcc。

使用`float *restrict result`，clang 和 gcc 都会提升负载。

例如

```
# gcc6.3, for foo with no restrict, or with just const float *restrict a
.L5:
    vmovss  xmm0, DWORD PTR [rsi]
    vmulss  xmm0, xmm0, DWORD PTR [rdx+rax*4]
    vmovss  DWORD PTR [rdi+rax*4], xmm0
    add     rax, 1
    cmp     rcx, rax
    jne     .L5 
```

对比

```
# gcc 6.3 with   float *__restrict__ result
# clang is similar with const float *__restrict__ a but not on result.
    vmovss  xmm1, DWORD PTR [rsi]   # outside the loop
.L11:
    vmulss  xmm0, xmm1, DWORD PTR [rdx+rax*4]
    vmovss  DWORD PTR [rdi+rax*4], xmm0
    add     rax, 1
    cmp     rcx, rax
    jne     .L11 
```

因此，总而言之，**放置`__restrict__`所有保证不与其他内容重叠的指针**。

* * *

顺便说一句，`restrict`只是 C 中的一个关键字。一些 C++ 编译器支持`__restrict__`或`__restrict`作为扩展，所以你应该`#ifdef`在未知的编译器上使用它。

自从

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-08-25T16:21:39.673

在*C-99 标准 (ISO/IEC 9899:1999 (E))*中有`const * restrict`7.8.2.3 节中的示例：

### strtoimax 和 strtoumax 函数

### 概要

```
#include <inttypes.h>
intmax_t strtoimax(const char * restrict nptr,
                   char ** restrict endptr, int base);
--- snip --- 
```

因此，如果假设标准对于 是多余的，则不会提供这样的示例`const *`，`* restrict`那么它们确实不是多余的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T16:29:42.533

如上一个答案所述，您需要添加“限制”。我还想评论您的情况，即“结果可能与 a 重叠”。这不是编译器检测到“a”可能发生变化的唯一原因。它也可以由另一个具有指向“a”的指针的线程更改。因此，即使您的函数没有更改任何值，编译器仍会假定“a”可能会更改。

# sql-server - 在 Management Studio 中测试 ssis 转换表达式并创建表达式

> ID：457442
> 
> 赞同：0
> 
> 时间：2009-01-19T12:30:50.867
> 
> 标签：sql-server, tsql, ssis

我正在尝试从另一个字符串中删除部分字符串，例如：

```
declare @url varchar (20)
set @url = 'www.test.com~~34235645463544563554'

select @url, substring(@url,1,CHARINDEX('~~',@url)-1) 
```

我正在尝试删除 '~~34235645463544563554'

我习惯于使用内置的 tsql 函数（如上所示）来执行此操作，但尝试在 ssis 的一个步骤中执行与“派生列转换”相同的操作。有人可以建议我如何做到这一点，以及是否有一种简单的方法可以在管理工作室中快速测试这一点？即使用 ssis 中编写的表达式来测试预期结果。我宁愿不运行整个事情，因为它是一个大包。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T12:10:45.273

最后我使用了一个脚本组件：

```
Dim debugOn As Boolean
debugOn = False
If debugOn Then MsgBox(Row.trackingCode)
If Row.trackingCode <> "" Then
    ' find the delimiter location
    Dim endLocation As Integer
    If debugOn Then MsgBox("index of ~~ is " & Row.trackingCode.ToString().IndexOf("~~", 0))
    ' chk if we have ~~ in field, if not in field then -1 is returned
    If Row.trackingCode.ToString().IndexOf("~~", 0) > -1 Then
        ' if ~~ at the beginning ie no tracking code
        If Row.trackingCode.ToString().IndexOf("~~", 0) = 1 Then
            endLocation = Row.trackingCode.ToString().IndexOf("~~", 0)
        ElseIf Row.trackingCode.ToString().IndexOf("~~", 0) > 1 Then
            endLocation = Row.trackingCode.ToString().IndexOf("~~", 0) - 1
        End If
        If debugOn Then MsgBox("end of track code is " & endLocation)
        Row.trackingCode = Row.trackingCode.Substring(1, endLocation)
    End If
End If 
```

# windows - 如何仅通过命令行使用 TumbleWeed 安全传输

> ID：457443
> 
> 赞同：0
> 
> 时间：2009-01-19T12:33:15.637
> 
> 标签：windows, file-transfer, tumbleweed

有人告诉我们，我们必须使用一款名为 TumbleWeed Secure Transport 的软件在我们自己和另一家公司之间传输文件。我可以让它与 GUI 一起工作，但不能与命令行一起工作。

我遇到的部分问题是即使使用命令行也会打开 GUI：

```
C:\Progra~1\Tumbleweed\STClient\STclient.exe httpsu://user:pass@hostname.com:443/inbox/ C:\temp\File /prefNoAskSched /prefASC 
```

GUI 根本不会消失，并且 batfile 不会返回，直到手动关闭 GUI。

我们不想使用 GUI，因为如果我们让用户触摸它，用户就有刹车的坏习惯，因此自动化似乎更安全。

有没有人有过这个应用程序的经验？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T09:47:03.707

我设法让它与以下命令行一起工作：

```
C:\Progra~1\Tumbleweed\STClient\STclient.exe httpsu://user:password6@hostaddress.com:443 /inbox/ C:\temp\ACEJON /Remote-Site SITENAME /prefNoAskSched /prefASC /hidden /log /quitWhenDone 
```

# nginx - 如何使用 Nginx 阻止推荐垃圾邮件？

> ID：457447
> 
> 赞同：10
> 
> 时间：2009-01-19T12:35:02.153
> 
> 标签：nginx, referrer-spam

我在 Nginx 服务器下运行两个杂种。我不断收到对不存在文件的请求。IP 地址经常更改，但引用 URL 保持不变。我想解决这个问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-19T23:36:36.123

**[https://calomel.org/nginx.html](https://calomel.org/nginx.html)**

阻止大多数“推荐人垃圾邮件”——“更多的是烦恼而不是问题”

**nginx.conf**

```
 ## Deny certain Referers (case insensitive)
    ## The ~* makes it case insensitive as opposed to just a ~
 if ($http_referer ~* (babes|click|diamond|forsale|girl|jewelry|love|nudit|organic|poker|porn|poweroversoftware|sex|teen|video|webcam|zippo))
    {  return 403;   } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2015-11-07T01:19:25.733

随着列表变长，使用 Nginx[地图模块](http://nginx.org/en/docs/http/ngx_http_map_module.html)更高效且更易于管理。

**把它放在你的 http {} 块中：**

```
map $http_referer $bad_referer {
    hostnames;

    default                           0;

    # Put regexes for undesired referers here
    "~social-buttons.com"             1;
    "~semalt.com"                     1;
    "~kambasoft.com"                  1;
    "~savetubevideo.com"              1;
    "~descargar-musica-gratis.net"    1;
    "~7makemoneyonline.com"           1;
    "~baixar-musicas-gratis.com"      1;
    "~iloveitaly.com"                 1;
    "~ilovevitaly.ru"                 1;
    "~fbdownloader.com"               1;
    "~econom.co"                      1;
    "~buttons-for-website.com"        1;
    "~buttons-for-your-website.com"   1;
    "~srecorder.co"                   1;
    "~darodar.com"                    1;
    "~priceg.com"                     1;
    "~blackhatworth.com"              1;
    "~adviceforum.info"               1;
    "~hulfingtonpost.com"             1;
    "~best-seo-solution.com"          1;
    "~googlsucks.com"                 1;
    "~theguardlan.com"                1;
    "~i-x.wiki"                       1;
    "~buy-cheap-online.info"          1;
    "~Get-Free-Traffic-Now.com"       1;
} 
```

**把它放在你的 server {} 块中：**

```
if ($bad_referer) { 
    return 444; # emtpy response
} 
```

它对我有用。

[从http://fadeit.dk/blog/post/nginx-referer-spam-blacklist](http://fadeit.dk/blog/post/nginx-referer-spam-blacklist)得到这个

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T12:47:07.200

我以前也遇到过类似的情况，我需要根据行为而不是防火墙可以自行解决的其他任意规则来阻止人们。

我解决这个问题的方法是让我的逻辑（在你的情况下是 Rails）做阻塞......但还有很长的路要走：

*   让您的逻辑将阻止列表维护为换行符分隔的纯文本文件。
*   以 root 身份创建一个 bash（或其他）脚本以读取此文件并将其列表对象添加到防火墙的阻止列表中
*   创建一个 cron 作业以再次以 root 身份调用脚本

我这样做的原因（而不仅仅是授予 Django 更改防火墙配置的权限）很简单：安全性。如果我的应用程序被黑客入侵，我不希望它伤害其他任何东西。

bash 脚本是这样的：

```
exec < /path/to/my/djago-maintained/block-list
while read line
do

    iptables -A INPUT --source $line/32 -j DROP

done 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-25T06:36:56.813

我创建了用于检查黑名单中的传入 IP 的模块[https://github.com/oneumyvakin/ngx_http_blacklist_lookup_module](https://github.com/oneumyvakin/ngx_http_blacklist_lookup_module)

它使用来自 projecthoneypot.org、blocklist.de 和 uceprotect.net 的黑名单

# c# - 异步方法调用

> ID：457450
> 
> 赞同：4
> 
> 时间：2009-01-19T12:35:25.087
> 
> 标签：c#, .net

如何异步调用方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T12:37:24.100

如何异步调用 Visual C# 方法：http:
[//support.microsoft.com/kb/315582](http://support.microsoft.com/kb/315582)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-19T12:38:06.360

您可能应该使用`ThreadPool.QueueUserWorkItem`（[ThreadPool.QueueUserWorkItem 方法](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.queueuserworkitem.aspx)）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T12:44:26.457

我猜 BackgroundWork 是执行异步操作的最简单方法。

# c# - 删除常规数组的元素

> ID：457453
> 
> 赞同：149
> 
> 时间：2009-01-19T12:36:38.267
> 
> 标签：c#, .net, arrays

我有一组 Foo 对象。如何删除数组的第二个元素？

我需要类似于`RemoveAt()`但用于常规数组的东西。

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2009-01-19T12:56:14.077

如果您不想使用列表：

```
var foos = new List<Foo>(array);
foos.RemoveAt(index);
return foos.ToArray(); 
```

你可以试试这个我没有实际测试过的扩展方法：

```
public static T[] RemoveAt<T>(this T[] source, int index)
{
    T[] dest = new T[source.Length - 1];
    if( index > 0 )
        Array.Copy(source, 0, dest, 0, index);

    if( index < source.Length - 1 )
        Array.Copy(source, index + 1, dest, index, source.Length - index - 1);

    return dest;
} 
```

并像这样使用它：

```
Foo[] bar = GetFoos();
bar = bar.RemoveAt(2); 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-01-19T12:41:11.813

数组的本质是它们的长度是不可变的。您不能添加或删除任何数组项。

您必须创建一个短一个元素的新数组，并将旧项目复制到新数组中，不包括要删除的元素。

所以最好使用 List 而不是数组。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2010-12-12T18:42:39.737

我使用此方法从对象数组中删除元素。在我的情况下，我的数组长度很小。因此，如果您有大型阵列，您可能需要另一种解决方案。

```
private int[] RemoveIndices(int[] IndicesArray, int RemoveAt)
{
    int[] newIndicesArray = new int[IndicesArray.Length - 1];

    int i = 0;
    int j = 0;
    while (i < IndicesArray.Length)
    {
        if (i != RemoveAt)
        {
            newIndicesArray[j] = IndicesArray[i];
            j++;
        }

        i++;
    }

    return newIndicesArray;
} 
```

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2014-09-11T18:00:35.713

LINQ 单线解决方案：

```
myArray = myArray.Where((source, index) => index != 1).ToArray(); 
```

该`1`示例中的 是要删除的元素的索引 - 在此示例中，根据原始问题，第二个元素（`1`在 C# 从零开始的数组索引中是第二个元素）。

一个更完整的例子：

```
string[] myArray = { "a", "b", "c", "d", "e" };
int indexToRemove = 1;
myArray = myArray.Where((source, index) => index != indexToRemove).ToArray(); 
```

`myArray`运行该代码段后，的值为`{ "a", "c", "d", "e" }`。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2013-07-24T18:08:28.070

这是一种删除数组元素的方法，从 .Net 3.5 开始，无需复制到另一个数组 - 使用相同的数组实例[`Array.Resize<T>`](http://msdn.microsoft.com/en-us/library/bb348051.aspx)：

```
public static void RemoveAt<T>(ref T[] arr, int index)
{
    for (int a = index; a < arr.Length - 1; a++)
    {
        // moving elements downwards, to fill the gap at [index]
        arr[a] = arr[a + 1];
    }
    // finally, let's decrement Array's size by one
    Array.Resize(ref arr, arr.Length - 1);
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-19T15:30:01.333

这是我的旧版本，适用于[.NET](http://en.wikipedia.org/wiki/.NET_Framework)框架的 1.0 版，不需要泛型类型。

```
public static Array RemoveAt(Array source, int index)
{
    if (source == null)
        throw new ArgumentNullException("source");

    if (0 > index || index >= source.Length)
        throw new ArgumentOutOfRangeException("index", index, "index is outside the bounds of source array");

    Array dest = Array.CreateInstance(source.GetType().GetElementType(), source.Length - 1);
    Array.Copy(source, 0, dest, 0, index);
    Array.Copy(source, index + 1, dest, index, source.Length - index - 1);

    return dest;
} 
```

这是这样使用的：

```
class Program
{
    static void Main(string[] args)
    {
        string[] x = new string[20];
        for (int i = 0; i < x.Length; i++)
            x[i] = (i+1).ToString();

        string[] y = (string[])MyArrayFunctions.RemoveAt(x, 3);

        for (int i = 0; i < y.Length; i++)
            Console.WriteLine(y[i]);
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-10-08T02:42:34.820

不完全是解决这个问题的方法，但如果情况是微不足道的并且你珍惜你的时间，你可以尝试这个为空类型。

```
Foos[index] = null 
```

然后检查逻辑中的空条目..

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-01-02T17:03:35.513

像往常一样，我参加聚会迟到了……

我想在已经存在的不错的解决方案列表中添加另一个选项。=)
我认为这是扩展的好机会。

参考：http: [//msdn.microsoft.com/en-us/library/bb311042.aspx](http://msdn.microsoft.com/en-us/library/bb311042.aspx)

因此，我们定义了一些静态类，并在其中定义了我们的方法。
之后，我们可以随意使用我们的扩展方法。=)

```
using System;

namespace FunctionTesting {

    // The class doesn't matter, as long as it's static
    public static class SomeRandomClassWhoseNameDoesntMatter {

        // Here's the actual method that extends arrays
        public static T[] RemoveAt<T>( this T[] oArray, int idx ) {
            T[] nArray = new T[oArray.Length - 1];
            for( int i = 0; i < nArray.Length; ++i ) {
                nArray[i] = ( i < idx ) ? oArray[i] : oArray[i + 1];
            }
            return nArray;
        }
    }

    // Sample usage...
    class Program {
        static void Main( string[] args ) {
            string[] myStrArray = { "Zero", "One", "Two", "Three" };
            Console.WriteLine( String.Join( " ", myStrArray ) );
            myStrArray = myStrArray.RemoveAt( 2 );
            Console.WriteLine( String.Join( " ", myStrArray ) );
            /* Output
             * "Zero One Two Three"
             * "Zero One Three"
             */

            int[] myIntArray = { 0, 1, 2, 3 };
            Console.WriteLine( String.Join( " ", myIntArray ) );
            myIntArray = myIntArray.RemoveAt( 2 );
            Console.WriteLine( String.Join( " ", myIntArray ) );
            /* Output
             * "0 1 2 3"
             * "0 1 3"
             */
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-09-22T00:04:48.190

试试下面的代码：

```
myArray = myArray.Where(s => (myArray.IndexOf(s) != indexValue)).ToArray(); 
```

或者

```
myArray = myArray.Where(s => (s != "not_this")).ToArray(); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-19T12:40:49.973

这就是我是如何做到的......

```
 public static ElementDefinitionImpl[] RemoveElementDefAt(
        ElementDefinition[] oldList,
        int removeIndex
    )
    {
        ElementDefinitionImpl[] newElementDefList = new ElementDefinitionImpl[ oldList.Length - 1 ];

        int offset = 0;
        for ( int index = 0; index < oldList.Length; index++ )
        {
            ElementDefinitionImpl elementDef = oldList[ index ] as ElementDefinitionImpl;
            if ( index == removeIndex )
            {
                //  This is the one we want to remove, so we won't copy it.  But 
                //  every subsequent elementDef will by shifted down by one.
                offset = -1;
            }
            else
            {
                newElementDefList[ index + offset ] = elementDef;
            }
        }
        return newElementDefList;
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-19T12:41:15.183

在普通数组中，您必须将 2 以上的所有数组条目打乱，然后使用 Resize 方法调整其大小。使用 ArrayList 可能会更好。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-06-21T21:06:02.393

```
 private int[] removeFromArray(int[] array, int id)
    {
        int difference = 0, currentValue=0;
        //get new Array length
        for (int i=0; i<array.Length; i++)
        {
            if (array[i]==id)
            {
                difference += 1;
            }
        }
        //create new array
        int[] newArray = new int[array.Length-difference];
        for (int i = 0; i < array.Length; i++ )
        {
            if (array[i] != id)
            {
                newArray[currentValue] = array[i];
                currentValue += 1;
            }
        }

        return newArray;
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-04-23T15:14:00.527

这是我根据一些现有答案制作的一小部分辅助方法。它利用参考参数的扩展和静态方法来实现最大理想：

```
public static class Arr
{
    public static int IndexOf<TElement>(this TElement[] Source, TElement Element)
    {
        for (var i = 0; i < Source.Length; i++)
        {
            if (Source[i].Equals(Element))
                return i;
        }

        return -1;
    }

    public static TElement[] Add<TElement>(ref TElement[] Source, params TElement[] Elements)
    {
        var OldLength = Source.Length;
        Array.Resize(ref Source, OldLength + Elements.Length);

        for (int j = 0, Count = Elements.Length; j < Count; j++)
            Source[OldLength + j] = Elements[j];

        return Source;
    }

    public static TElement[] New<TElement>(params TElement[] Elements)
    {
        return Elements ?? new TElement[0];
    }

    public static void Remove<TElement>(ref TElement[] Source, params TElement[] Elements)
    {
        foreach (var i in Elements)
            RemoveAt(ref Source, Source.IndexOf(i));
    }

    public static void RemoveAt<TElement>(ref TElement[] Source, int Index)
    {
        var Result = new TElement[Source.Length - 1];

        if (Index > 0)
            Array.Copy(Source, 0, Result, 0, Index);

        if (Index < Source.Length - 1)
            Array.Copy(Source, Index + 1, Result, Index, Source.Length - Index - 1);

        Source = Result;
    }
} 
```

性能方面，它是不错的，但它可能会得到改进。`Remove`依赖，`IndexOf`并为您希望通过调用删除的每个元素创建一个新数组`RemoveAt`。

`IndexOf`是唯一的扩展方法，因为它不需要返回原始数组。`New`接受某种类型的多个元素以生成所述类型的新数组。所有其他方法都必须接受原始数组作为参考，因此无需在之后分配结果，因为这已经在内部发生了。

我会定义一个`Merge`合并两个数组的方法；但是，这已经可以`Add`通过传入一个实际数组而不是多个单个元素的方法来完成。因此，`Add`可以用以下两种方式加入两组元素：

```
Arr.Add<string>(ref myArray, "A", "B", "C"); 
```

或者

```
Arr.Add<string>(ref myArray, anotherArray); 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2019-02-05T21:36:38.367

我知道这篇文章已有 10 年历史，因此可能已经死了，但我会尝试这样做：

**使用 System.Linq 中的 IEnumerable.Skip() 方法**。它将跳过数组中的选定元素，并返回数组的另一个副本，该副本仅包含除选定对象之外的所有内容。然后对要删除的每个元素重复此操作，然后将其保存到变量中。

例如，如果我们有一个名为“Sample”的数组（类型为 int[]），其中包含 5 个数字。我们想删除第二个，所以尝试“Sample.Skip(2);” 应该返回相同的数组，除了没有第二个数字。

* * *

## 回答 #15

> 赞同：-5
> 
> 时间：2012-04-17T12:27:56.220

**第一步**
您需要将数组转换为列表，您可以编写这样的扩展方法

```
// Convert An array of string  to a list of string
public static List<string> ConnvertArrayToList(this string [] array) {

    // DECLARE a list of string and add all element of the array into it

    List<string> myList = new List<string>();
    foreach( string s in array){
        myList.Add(s);
    }
    return myList;
} 
```

**第二步**
编写扩展方法将列表转换回数组

```
// convert a list of string to an array 
public static string[] ConvertListToArray(this List<string> list) {

    string[] array = new string[list.Capacity];
    array = list.Select(i => i.ToString()).ToArray();
    return array;
} 
```

**最后一步**
编写最终方法，但请记住在转换回数组之前删除索引处的元素，如代码所示

```
public static string[] removeAt(string[] array, int index) {

    List<string> myList = array.ConnvertArrayToList();
    myList.RemoveAt(index);
    return myList.ConvertListToArray();
} 
```

示例代码可以在[我的博客](http://bamaracoulibaly.blogspot.co.uk/)上找到，继续跟踪。

# .net - .NET 1.1 和 .NET 2 配置文件一起工作

> ID：457454
> 
> 赞同：0
> 
> 时间：2009-01-19T12:37:09.480
> 
> 标签：.net, vb.net, interop, app-config, config

我继承了一个相当大的项目，其中包括一个用 VB6 编写的应用程序和几个用 VB6、VB.NET 1.1 和 VB.NET 2 编写的 DLL 和 ActiveX 控件。我想更改一个用 VB 编写的 DLL 的设置之一.NET 2 在其 application.dll.config 文件中，但它似乎没有任何效果。

我的主要 VB6 应用程序（我将其称为 Alpha）有一个配置文件 (Alpha.exe.cnfig)，其中包含我的 VB.NET 1.1 DLL（我将其称为 Bravo）使用的设置。调用 Bravo 后，Alpha 调用 Charlie（我的 VB.NET 2 DLL）。但是，即使我在 DLL 所在的子目录中更改了 Charlie.dll.config 中的应用程序设置，它也没有任何效果。我曾尝试将 Charlie 的设置放在 Alpha 的配置文件中，但这会导致 Bravo 因自动化错误而失败（我认为这是因为配置文件的格式从 .NET 1.1 和 .NET 2 更改）。

下面是一个简化的目录结构和文件位置示例：

\Application\Alpha\Alpha.exe（我的 VB6 应用程序）
\Application\Alpha\Alpha.exe.config（此配置文件由 Bravo.dll 使用）
\Application\Assembly\Bravo.dll（我的 VB.NET 1.1 DLL）
\Application\Controls\Charlie\Charlie.dll（我的 VB.NET 2 DLL）
\Application\Controls\Charlie\Charlie.dll.config（这个文件被 Charlie.dll 忽略）

我已经重新编译了我的 VB.NET 2 DLL，更改了默认设置，我这样做是为了检查设置本身没有代码错误，这工作正常。但是，我希望能够通知客户如何更改配置文件，以便他可以将其设置为他想要的任何内容，而无需在每次他想要不同的设置时重新编译 DLL。

我只想更改 app.config 而不是 machine.config 或 user.config。

以下是 Alpha.exe.config 的示例：

```
<configuration>
    <appSettings>
        <add key="MySetting" value="MyValue" />
    </appSettings>
</configuration> 
```

这是 Charlie.dll.config 的示例

```
<configuration>
    <applicationSettings>
        <Charlie.My.MySettings>
            <setting name="MySetting" serializeAs="String">
                <value>MyValue</value>
            </setting>
        </Charlie.My.MySettings>
    </applicationSettings>
</configuration> 
```

如果我尝试将 applicationSettings 部分~~在下面~~在 Alpha.exe.config 中的 appSettings 部分（即作为配置元素的另一个子元素）的正下方，Bravo.dll 将失败。

非常感谢您提供的任何帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-19T12:53:13.833

问题似乎是因为 Bravo.dll 以 1.1 为目标，所以会加载 1.1 版本的框架，并且正如您所说，applicationSettings 部分是 .NET 2.0 中的新内容。解决办法是强制VB exe加载2.0框架。`startup/supportedRuntime`在 Alpha.exe.config 文件中添加一个元素应该可以解决问题。您还需要一些配置部分声明，因此最后 Alpha.exe.config 应如下所示：

```
<configuration>
    <startup>
        <supportedRuntime version="v2.0.50727" />
    </startup>
    <configSections>
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
        <section name="Charlie.My.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
    </configSections>
    <appSettings>
        <add key="MySetting" value="MyValue" />
    </appSettings>
    <applicationSettings>
        <Charlie.My.MySettings>
            <setting name="MySetting" serializeAs="String">
                <value>MyValue</value>
            </setting>
        </Charlie.My.MySettings>
    </applicationSettings>
</configuration> 
```

# java - 如何在 J2ME 中生成哈希值？

> ID：457460
> 
> 赞同：0
> 
> 时间：2009-01-19T12:39:23.690
> 
> 标签：java, java-me, hash, midp

如何在 J2ME 中为字节数组生成哈希值？

它不必非常安全，但应该很快。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T12:51:48.063

正如 Josh Bloch 在他的 Effective Java 书中所建议的：

```
public int hashCode() {
   int result = 17;
   for (int i = 0; i < array.length; i++) {
      result = 31*result + (int)array[i];
   }
   return result;
} 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-01-19T12:48:08.540

如果您已经依赖于[Apache Commons Lang](http://commons.apache.org/lang/)，您也可以使用[`HashCodeBuilder`](http://commons.apache.org/lang/api/org/apache/commons/lang/builder/HashCodeBuilder.html)：

```
new HashCodeBuilder().append(bytes).toHashCode(); 
```

# java - 将 JComboBox 放入 JTable

> ID：457463
> 
> 赞同：15
> 
> 时间：2009-01-19T12:40:21.347
> 
> 标签：java, jtable, jcombobox

我想将单个 JComboBoxes 放入 JTable 的每个单元格中。IE。每个单元格的 JComboBox 内容并不相同。

我基本上希望能够只调用以下代码将一行 JComboBox 添加到 JTable 中。有人有什么想法吗？谢谢

```
JComboBox cb1 = new JComboBox(...);
JComboBox cb2 = new JComboBox(...);
model.addRow(new Object[] {"Row name", cb1, cb2} );

JComboBox cb3 = new JComboBox(...);
JComboBox cb4 = new JComboBox(...);
model.addRow(new Object[] {"Row name 2", cb3, cb4} ); 
```

我能找到的最接近的示例代码如下。但它适用于单个列的 JComboBox 内容相同的地方。不是我需要的解决方案。

```
TableColumn col = table.getColumnModel().getColumn(vColIndex);
col.setCellEditor(new MyComboBoxEditor(values)); 
```

在哪里

```
public class MyComboBoxEditor extends DefaultCellEditor {
    public MyComboBoxEditor(String[] items) {
        super(new JComboBox(items));
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-03T20:13:14.717

使用以下代码扩展 JTable：

```
@Override
public TableCellEditor getCellEditor(int row, int column) {
   Object value = super.getValueAt(row, column);
   if(value != null) {
      if(value instanceof JComboBox) {
           return new DefaultCellEditor((JComboBox)value);
      }
            return getDefaultEditor(value.getClass());
   }
   return super.getCellEditor(row, column);
} 
```

这将为您获得 a 值的每个组合框创建一个唯一的 JComboBox 单元格编辑器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-22T05:07:01.540

我相信这会解决你的问题。提及您需要在 .getColumn(int column) 中设置组合框的列

```
private void addComboToTable(JComboBox combo) {
    TableColumn gradeColumn = YourTable.getColumnModel().getColumn(0);
    JComboBox comboBox = combo;
    comboBox.removeAllItems();
    try {
        comboBox.addItem("Item 1");
        comboBox.addItem("Item 2");
        comboBox.addItem("Item 3");
    } catch (NullPointerException e) {
    } catch (Exception e) {
        e.printStackTrace();
    }
    gradeColumn.setCellEditor(new DefaultCellEditor(comboBox));
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T13:45:45.880

您需要覆盖：

```
Component getTableCellRendererComponent(JTable table, Object value, boolean isSelected, boolean hasFocus, int row, int column) 
```

...在 TableCellEditor 中。传递给此方法的值就是您可以放入 JComboBox 的值。这意味着该特定单元格的“价值”需要是可以翻译成集合的东西。它可能只是一个对象列表，也可能是一个 POJO，其中包含可以制成 JComboBox 的字段。

因此，只需编辑 MyComboBoxEditor 以覆盖该方法并更改您的模型以允许实际代表几个其他对象的对象。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-24T21:39:17.217

JComboBox 内容对于每一行选择都是相同的，因为 JTable 不提供每列拥有多个编辑器的功能。您必须扩展 JTable 类以支持额外的行选择。

这篇文章解释的很好： [http ://www.javaworld.com/javaworld/javatips/jw-javatip102.html](http://www.javaworld.com/javaworld/javatips/jw-javatip102.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-05-24T15:47:59.993

除了 cellEditor 之外，还需要使用 cellRenderer 来绘制单元格中的组合框，看看这个：

```
 public void example(){  

      TableColumn tmpColum =table.getColumnModel().getColumn(1);
      String[] DATA = { "Data 1", "Data 2", "Data 3", "Data 4" };
      JComboBox comboBox = new JComboBox(DATA);

      DefaultCellEditor defaultCellEditor=new DefaultCellEditor(comboBox);
      tmpColum.setCellEditor(defaultCellEditor);
      tmpColum.setCellRenderer(new CheckBoxCellRenderer(comboBox));
      table.repaint();
   }

/**
   Custom class for adding elements in the JComboBox.
*/
class CheckBoxCellRenderer implements TableCellRenderer {
        JComboBox combo;
        public CheckBoxCellRenderer(JComboBox comboBox) {
            this.combo = new JComboBox();
            for (int i=0; i<comboBox.getItemCount(); i++){
                combo.addItem(comboBox.getItemAt(i));
            }
        }
        public Component getTableCellRendererComponent(JTable jtable, Object value, boolean isSelected, boolean hasFocus, int row, int column) {
            combo.setSelectedItem(value);
            return combo;
        }
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-19T20:35:03.343

```
@Override
public TableCellEditor getCellEditor(int row, int column) {
   Object value = super.getValueAt(row, column);
   if(value != null) {
      if(value instanceof JComboBox) {
           return new DefaultCellEditor((JComboBox)value);
      }
            return getDefaultEditor(value.getClass());
   }
   return super.getCellEditor(row, column);
} 
```

然后，覆盖`toString`.`JComboBox`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T13:17:56.013

[此页面](http://java.sun.com/docs/books/tutorial/uiswing/components/table.html#combobox)可能会对您有所帮助，尽管您似乎仅限于在列中的所有单元格中使用相同的组合框。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T01:55:19.263

您需要创建 JTable 的子类来覆盖 TableCellEditor getCellEditor(int row, int column) 方法。

这使您可以为任何行和列组合设置任意单元格编辑器。默认方式是为整列设置单元格编辑器。

（您还可以通过覆盖 getCellRenderer 来设置单个单元格渲染器。）

* * *

## 回答 #9

> 赞同：-8
> 
> 时间：2009-01-19T16:47:59.053

最简单的方法是实现自己的[TableModel](http://java.sun.com/javase/6/docs/api/javax/swing/table/TableModel.html)

```
public class MyModel extends AbstractTableModel {
    List rows;

    public int getRowCount() {
        return rows.size();
    }

    public int getColumnCount() {
         return 4;
    }

    public Object getValueAt(int row, int column) {
        return rows.get(row).getCol(col);  //assuming your row "Object" has a getCol()
    }

    public Class<?> getColumnClass(int col) {
        return Boolean.class;
    }

    public void setValueAt(Object aValue, int rowIndex, int columnIndex) {
        rows.get(rowIndex).getCol(columnIndex).setValue(aValue);
    }

} 
```

将此加载到您的 JTable 中。如果您没有替换布尔值的默认单元格渲染器，由于您实现了 getColumnClass()，所有单元格都将被渲染为复选框。使用我们的 setValueAt() 收集这些复选框的所有用户输入。

# security - 密码复杂性策略 - 有任何证据吗？

> ID：457471
> 
> 赞同：7
> 
> 时间：2009-01-19T12:45:48.340
> 
> 标签：security, passwords

不止一次我被要求为我正在开发的软件实施密码选择规则。典型的建议包括：

*   密码长度必须至少为*N 个*字符；
*   密码必须包含小写、大写和数字；
*   不得重复使用最后*M*个密码（或*P*天内使用的密码）。

等等。

*不过，对密码设置任何*限制总是让我感到烦恼- 通过限制可用密码，您可以减少所有允许密码的空间大小。这不是让密码*更容易*猜到吗？

同样，通过让用户创建复杂、频繁更改的密码，写下密码的诱惑力增加，同时也降低了安全性。

**是否有任何量化证据表明密码限制规则使系统更安全？**

**如果有，使用什么“最安全”的密码限制策略？**

* * *

**编辑**Ólafur Waage 友好地指出了[一篇关于字典攻击的 Coding Horror 文章，](http://www.codinghorror.com/blog/archives/001206.html)其中有很多有用的分析，但令我震惊的是，字典攻击可以通过在失败的身份验证尝试后简单地添加延迟来大大减少（正如 Jeff 建议的那样） .

考虑到这一点，有什么证据表明强制复杂密码更安全？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-19T12:59:19.390

> 不过，对密码设置任何限制总是让我感到困扰——通过限制可用密码，您可以减少所有允许密码的空间大小。这不是让密码更容易猜到吗？

理论上，是的。在实践中，您不允许的“弱”密码代表所有可能密码的一小部分，在没有限制时通常不成比例地选择这些密码，并且攻击者知道首先攻击。

> 同样，通过让用户创建复杂、频繁更改的密码，写下密码的诱惑力增加，同时也降低了安全性。

正确的。强迫用户每月更改密码是一个非常非常糟糕的主意，除非在每个人都真正了解安全需求的极端高安全环境中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T12:54:18.027

这些规则肯定会有所帮助，因为它可以阻止愚蠢的用户使用像“mypassword”这样的密码，不幸的是这种密码经常发生。

所以实际上，你是在强迫用户输入一组非常大的潜在密码。排除所有只有小写字母的密码集并不重要，因为剩余的密码集仍然大几个数量级。

但是我最大的烦恼是我在主要网站上遇到的密码限制，比如

*   没有特殊字符
*   最大长度

为什么会有人这样做？为什么？？？？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T12:48:11.083

[Jeff 关于字典攻击](http://www.codinghorror.com/blog/archives/001206.html)的文章对此进行了很好的阅读。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T15:01:20.673

1.  **永远不要**阻止用户做他们真正想做的事，除非这样做有技术限制。
2.  您可能会因为使用字典单词或 3 个字符的密码或仅使用数字等愚蠢的事情而唠叨用户，但请参阅上面的 #1。
3.  没有充分的技术理由只要求字母数字、或至少一个大写字母或至少一个数字；见上面的#1。

我忘记了哪个网站对密码有这样的建议：“选择一个你很容易记住但别人很难猜到的密码。” 但随后他们开始要求至少一个大写字母和一个数字。

密码的问题在于它们无处不在，以至于没有过目不忘的人基本上不可能在不写下来的情况下真正记住它们，因此如果有人可以访问这个写下来的密码列表，就会留下一个严重的安全漏洞.

我能够自己管理的唯一方法是拆分我的大部分密码——我刚刚检查了我的列表，到目前为止我已经达到了 130 个！——分为两部分，一个在所有情况下都是相同的，另一个是独特但简单的。（对于需要高安全性的网站，如银行账户，我打破了这条规则。）

通过将“复杂性”定义为所有存在的多种类型的字符，它迫使人们为不同的站点采用一组不同的约定，这使得记住相关密码变得更加困难。

我承认网站限制允许的密码字符集的唯一原因是它需要可以在键盘上键入。如果您必须假设需要从多个国家/地区访问该帐户，那么键盘可能并不总是支持用户主键盘上的相同字符。

这些天中的某一天，我将不得不就该主题发表一篇博客文章。:(

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-19T15:41:56.457

我的旧极限定理：

随着密码的安全性接近足够，它将出现在附在计算机或显示器上的便签上的可能性接近 1。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T13:15:00.280

也有人可能会指出最近在 twitter 上发生的惨败，他们的管理员密码之一原来是“幸福”，这属于字典攻击。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T13:16:01.087

对于这样的问题，我问自己[Bruce Schneier 会做什么](http://www.schneier.com/blog/archives/2007/01/choosing_secure.html)- 链接的文章是关于如何选择通过典型攻击难以猜测的密码。

另请注意，如果您在尝试失败后添加延迟，您可能还希望在成功尝试后添加延迟，否则延迟只是攻击失败的信号，应该发起其他尝试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T13:11:56.417

虽然这不能直接回答您的问题，但我个人发现我遇到的最令人讨厌的规则是您不能重复使用以前使用的任何密码。在同一个地方工作多年，并且必须每 2/3 个月更改一次密码，使用我一年多前选择的密码的能力似乎并不特别不安全或不安全。如果我过去使用过“安全”密码（字母数字，以防万一），肯定会在一年或 2 年后重用它们（取决于您必须多久更改一次密码），这对我来说似乎是可以接受的. 这也意味着我不太可能使用“更简单”的密码，如果我想不出任何容易记住和难以猜测的东西，这可能会发生！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-09T16:50:48.717

首先让我说最小长度、区分大小写和所需特殊字符等细节应该取决于谁有权访问以及密码允许他们做什么。如果是发射核导弹的密码，那么登录播放付费在线版愤怒的小鸟应该比密码更严格。

但是我有一个区分大小写的特定牛肉。

首先，用户讨厌它。人脑认为“A=a”。当然，开发人员的大脑通常并不典型。;-) 但开发人员也因区分大小写而感到不便。

其次，CapsLock 键太容易误击。它在 Tab 和 Shift 键之间，但它应该在 Esc 键上方。它的位置是很久以前在打字机时代建立的，打字机没有可用的替代字体。在那些日子里，把它放在那里很有用。

所有密码都有风险......您正在平衡风险和易用性，是的，可用性很重要。

**我的论点：** 是的，对于给定的密码长度，区分大小写更安全。但除非有人让我这样做，否则我会选择更长的最小密码长度。即使我们假设只允许使用字母和数字，每个添加的字符也会将可能密码的数量乘以 36。

数学方面比我懒的人可以告诉您组合数量的差异，例如最小 8 个字符的区分大小写的密码和 12 个字符的不区分大小写的密码。我认为大多数用户更喜欢后者。

此外，并非所有应用都会将用户名暴露给其他人，因此黑客可能需要找到两个字段。

只要密码的大部分不是空格，我也更喜欢在密码中允许空格。

在我现在正在开发的项目中，我的管理屏幕允许管理员更改密码要求，这些要求适用于所有未来的密码。他还可以强制所有用户在下次登录后随时更新密码（以符合新要求）。我这样做是因为我觉得我的东西不需要区分大小写，但管理员（可能为软件付费）可能不同意，所以我让那个人决定。

我的银行卡的 PIN 码只有四位数。由于它只是数字，因此不区分大小写。哎呀，这是我的钱！如果您不考虑其他因素，这听起来很不安全，如果不是因为黑客必须窃取我的卡来获取我的钱。（并为他拍照。）

另一个问题：使用 StackOverflow 并重复他们在某处文章中读到的硬性规则的开发人员。“永远不要硬编码任何东西。” （好像这是可能的。）“所有查询都必须参数化”（如果用户不参与查询，则不是。）等。

请原谅吐槽。;-) 我保证我尊重分歧。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-02-08T15:02:08.150

对于这个特殊的问题，我个人倾向于根据输入文本的特征给密码一个“分数”，并拒绝不符合分数的密码。

例如：

```
Contains Lower Case Letter +1

Contains different Lower Case Letter +1

Contains Upper Case Letter +1

Contains different Upper Case Letter +1

Contains Non-Alphanumeric character: +1

Contains different Non-Alphanumeric character: +1

Contains Number: +1

Contains Non Consecutive or repeated Second Number: +1 

Length less than 8: -10 

Length Greater than 12: +1

Contains Dictionary word: -4 
```

然后只允许分数大于 4 的密码，（并在用户通过 javascript 创建密码时提供反馈）

# c# - C# 将数据保存在分隔字符串中是不好的做法

> ID：457480
> 
> 赞同：3
> 
> 时间：2009-01-19T12:49:04.933
> 
> 标签：c#

在应用程序中使用像 "name=Gina;postion= HouseMatriarch;id=1234" 这样的字符串来保存状态数据是不好的做法。我知道我也可以使用 struct 、 class 或 hashtable 来保存这些信息。

在数据库字段中保存分隔键/值对是否可以接受 - 仅用于在设计时不知道数据类型的地方。

谢谢...我只是想确保我保持良好的设计实践

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-19T12:56:03.563

是的，将您的数据保存在“name=Gina;postion= HouseMatriarch;id=1234”之类的字符串中是非常糟糕的做法。这种数据结构应该存储在结构或对象中，因为很难访问、验证和处理字符串中的数据。编写代码来解析字符串以获取数据将花费您更多的时间，而不仅仅是使用 C# 的语言结构。

如果另一个选项只是为这些字段添加列，我还建议不要在数据库字段中存储键/值对。如果您在设计时不知道数据的类型，那么您可能没有正确地进行设计。当您不知道您的字段必须保存哪些数据类型时，您将如何构建应用程序？或者也许您应该详细说明应用程序的上下文以使意图更清晰。并非全是黑白的:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T12:53:10.057

好吧，如果您的应用程序仅在其他系统之间传递此数据，我认为将其视为字符串不会有任何问题。但是，如果您需要使用数据，我肯定会介绍必要的类型来处理它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T12:54:46.123

这种方法的一个直接问题是嵌入的转义字符。鉴于您的示例，如果用户按如下方式输入他们的姓名会发生什么：

彼得；呃

或者

Pe=;ter

或者

pe;姓名=Yeo​​i;

我不确定您要保存的状态数据是什么，并且在没有任何上下文的情况下很难提出有效的建议。也许第一步是用键值对替换它，至少这可以解决上面提到的问题，并且意味着您不必定期解析字符串。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T13:02:49.710

我认为如果您创建一个结构或类来保存数据，然后添加一个自定义属性来返回（并设置）您一直使用的字符串，您会发现您的应用程序更易于维护。此方法将获取字段并将其格式化为您已经使用的字符串并执行相反的操作（获取字符串并填充字段）这样您就可以保持与旧算法的最大兼容性。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-19T13:05:59.690

我尽量不以任何基于字符串的格式保存数据。但是我遇到了几种情况，在这些情况下，无法提前知道数据的结构（例如，客户/最终用户可以动态添加字段）。

与您的方法相反，我们决定将数据存储在 XML 中，例如，在您的情况下，这将类似于以下内容：

```
<user id="1234">
 <name>Gina</name>
 <postion>HouseMatriarch</position>
</user> 
```

这为您带来以下优势：

*   处理数据的类（读/写）已经在框架中可用（例如 XmlDocument 或 XML 序列化）
*   您可以轻松地与其他系统交换数据（如果/需要时）
*   您可以将数据存储在文件中
*   您可以将数据存储在数据库列（xml 数据类型）中。您甚至可以在使用 SQL Server 时查询该列（尽管我会尽量避免将数据存储在 XML 中，但必须进行查询）
*   使用 XML 可以随时向您的数据添加其他字段

**更新**：我不确定为什么我的回答被否决了那么多——也许是因为不好的例子。因此，我想明确一点：我不会将 XML 用于诸如用户的 ID/主键之类的属性，也不会用于诸如“名称”、“电子邮件”等标准属性。但对于“扩展/动态”属性（如上所述）我仍然认为这是一个简单而优雅的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T12:56:28.850

如果您想将结构化数据存储在字符串中，我认为您应该使用标准表示法，例如 JSON。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T13:04:58.880

这是不好的做法，因为您必须付出大量的努力来构造字符串并稍后解析它们。还有其他更强大的序列化数据以在系统之间传递的方法。

对于核心业务数据，适当设计的类将更易于维护，并且所有属性都是强类型的，当您错误输入属性名称时，您会很早就知道。

至于键值对，我会说它们有时还可以，有时不行。如果有很多可能的值，但实际拥有的值不多，那么使用 KVP 完全可以。塞巴斯蒂安·迪茨（Sebastian Dietz）为每个字段设置一个单独的列的替代方法会导致在这种情况下出现很多空字段。这也意味着每次您需要一张新桌子时都要进行额外的工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-19T14:21:26.010

没有一个答案提到标准化，所以我想我会的。当涉及到数据库字段时，规范化的关键原则之一是表中的每个字段只代表一件事。分隔字段违反了该原则。

Red Gate Software 的一位员工按照您可能会觉得有用的思路发布了[这篇文章。](http://www.simple-talk.com/sql/database-administration/ten-common-database-design-mistakes/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-19T13:59:21.907

好吧，这只是意味着它不像哈希表那样可搜索或可索引。它还需要一些处理才能进入其他代码位可以轻松使用的状态。例如，查询该数据中的 id 的一些代码将是可怕的，例如：

```
if(dataStringThing.Substring(26, 4) == SomeIdInStringFormat) 
```

所以是的，在大多数情况下，这是不好的做法。但是，在其他情况下，这可能是您需要保留数据的默认格式或性能意味着您只应在需要时对其进行解析。所以这可能不是一件坏事。

如果您有理由将其保留为该格式，我会建议自己，最好将其转换为一个分隔字段的类，但也可以在该类上创建一个 ToString() 实现，如果您也将其恢复为原始格式需要这个。如果它的性能是一个问题，那么修改这个对象以仅在第一次访问这些字段时将源解析为类中的字段。

孤立地重复任何事情必然是一种不好的做法。不良做法取决于上下文。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-19T14:32:45.397

它（希望）显然不应该是一个正常的选择。但在某些情况下它是有用的或必要的。

我想不出任何不涉及它成为具有某些外部服务（例如数据库连接字符串）的通信协议的一部分的情况，因此您可能会被这种格式所困扰。

如果您可以选择格式（也许您正在编写只能使用字符串进行通信的系统的双方），那么至少选择结构化和众所周知的东西。其他地方已经给出了这样的例子，但主要的例子自然是 XML 或 JSON。CSV 或其他一些分隔格式在非常简单的情况下（例如数据库连接字符串）可能很有用 - 但要特别注意转义分隔符（如“Bobby Tables”笑话（已在另一条评论中引用）很好地说明 - 谷歌如果你不熟悉那个，给他）。

您提到的数据库表明这可能是重点所在。您是否正在尝试序列化应用程序对象？（还有其他方法可以做到这一点）。正如另一位海报所说，这可能是一个需要重新思考的设计的标志。但是，如果您确实需要在数据库中存储未知数据类型，那么 XML 可能是一个合适的选择 - 特别是如果您的数据库支持 XML 字段。不过，这有点雷区，所以请确保您首先熟悉它们的工作原理。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-19T14:44:29.193

我认为当您使用 StringList 来管理您的字符串时，它并没有那么糟糕。特别是当配置字符串（或配置数据库字段）的结构必须是灵活的时。但通常你不应该这样做，因为这个缺点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-19T18:31:29.657

这完全取决于您要完成的工作。

如果您需要一个 heirarcical 格式的数据或大量保留数据类型的字段，那么不......解析字符串是一个坏主意。

但是，如果您只需要跨服务传输字符串并且字节保存很重要，那么标签-数据对可能正是您所需要的。

如果您确实使用已解析的字符串，那么能够获取内部数据并快速管理它很重要。如果你想要一个示例 TDP 类，我今天在我的网站上发布了一个：

[http://www.jerryandcheryl.net/jspot/2009/01/tag-data-pairs.html](http://www.jerryandcheryl.net/jspot/2009/01/tag-data-pairs.html)

我希望这会有所帮助。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-19T20:13:53.617

我建议考虑这些使用因素。

如果您在自己的代码中处理数据，那么您可以使用任何您想要的数据结构。但是，您可能在开发自己的复杂数据结构的实现时遇到问题，因此请考虑使用预构建的。许多都带有您可能使用的任何编程平台，而更多的则记录在各种书籍、文章和讨论中，包括印刷版和在线版。如果您正确地将您的工作与他人隔离，那么您可以安全地做任何您想做的事情。

另一方面，如果您需要与他人共享该数据，则应谨慎考虑。如果您必须通过 API 或通过存储机制（数据库、文件等）或通过某种传输（套接字、HTTP 等）共享数据，那么您应该首先考虑其他人。如果您希望从您的努力中获得成功和尊重，那么您需要注意标准和惯例以及成本。值得庆幸的是，您可以想象到的任何此类用途几乎都已经完成，因此您可以利用其他人的努力。

在数据库中，考虑其他人（和您自己）将如何插入、更新、删除和选择数据。例如，与其他方法相比，在数据库中使用 XML 会使所有这些步骤变得不必要地困难和昂贵。注意数据库规范化——如果您还不熟悉，请学习它。

如果您正在处理文本，请注意字符编码并使其明确。

如果您正在做的事情有现有的标准或惯例，请遵守它。如果有一个令人信服的理由偏离，那么接受证明它的责任，解释它，让其他人容易适应你的选择。

如果您控制通信/传输介质的双方，请随意优化。如果您不这样做，则在互操作性方面犯了错误。请记住，这两种场景之间的主要区别在于嵌入数据的自我描述水平：互操作性有很多，优化基于共享假设而放弃了它。富含文本的数据更易于理解，但二进制更快。

想想你的听众。

# c# - 构造函数中的虚拟成员调用

> ID：457482
> 
> 赞同：10
> 
> 时间：2009-01-19T12:51:05.180
> 
> 标签：c#, visual-studio-2008, resharper

在我的应用程序中，我在不同的上下文中运行相同的 winform 来控制按钮的可见性、启用文本字段和 winform 标题文本。我决定这样做的方法是简单地将一个字符串传递给表单构造函数，并使用几个 if 语句检查它，这些语句又包含所需的 winform 调整。

```
if (formContext == "add")
{
    Text = "Add member";
}
if (formContext == "edit")
{
    Text = "Change role";
    userTextBox.Enabled = false;
    searchButton.Visible = false;
} 
```

这工作正常，但是“文本”关键字得到 ReSharper 添加的蓝色波浪线，并带有以下消息：构造函数中的虚拟成员调用。这是一个潜在的问题，还是只是某种过于热情的 ReSharper 信息。

任何关于改进我的实施的澄清或建议将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T12:57:21.080

基类 ctor 中的虚拟成员调用*可能*会导致一些逻辑在子类的 ctor 被调用之前在子类中运行（因此在对象有机会将自身初始化为一致状态之前）。

这只是一个很好的提醒，因此您知道您正在做的事情可能会导致一些令人讨厌的意外行为。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-19T13:20:37.850

除了现有答案之外，您还可以为表单添加 Load 事件处理程序：

```
Load += delegate
{
    if (formContext == "add")
    {
        Text = "Add member";
    }
    if (formContext == "edit")
    {
        Text = "Change role";
        userTextBox.Enabled = false;
        searchkButton.Visible = false;
    }
}; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T15:18:37.003

封你的课就好了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T14:41:45.970

我建议重写你的类如下：

```
public partial class Form1 : Form
{
    public enum FormContextMode
    {
        Add,
        Edit
    }

    private FormContextMode m_mode = FormContextMode.Add; 

    public Form1( FormContextMode mode )
    {
        InitializeComponent();
        m_mode = mode;
        Load += delegate { UpdateForm(); };
    }

    private void UpdateForm()
    {
        if( m_mode == FormContextMode.Add )
        {
            Text = "Add member";    
        }
        else if( m_mode == FormContextMode.Edit )
        {
            Text = "Change role";
            userTextBox.Enabled = false;
            searchkButton.Visible = false;
        }
    }
} 
```

# c# - ADO.Net：从 SQL 服务器表中获取表定义

> ID：457485
> 
> 赞同：6
> 
> 时间：2009-01-19T12:51:55.380
> 
> 标签：c#, sql-server, ado.net

我正在使用 C# 编写一个方法，该方法返回有关表的以下信息：列名、列类型、列大小、外键。

有人可以指出我如何实现这一目标的正确方向吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T13:14:28.547

这实际上取决于您如何与数据库进行通信。如果您使用的是 LinqToSQL 或其他类似的 ORM，这将非常容易，但如果您想通过查询获取这些值，我建议您使用 INFORMATION_SCHEMA 视图，因为这些视图快速且易于查询。

例如

```
select * from information_schema.columns where table_name = 'mytable' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T12:54:57.247

要获得 FK 和 Schema，您应该能够使用：

```
DA.FillSchema() 

DS.Table("Name").PrimaryKey 
```

或使用下面演示的方法调用**sp_fkey**

[来自](http://social.msdn.microsoft.com/Forums/en-US/winformsdatacontrols/thread/fad53def-d4d3-4a46-9fe2-f7d2f1251b42/)AND[另一个链接](http://www.java2s.com/Code/CSharp/Database-ADO.net/GettableSchema.htm)的代码片段

```
 private void LoanSchema()
    {

         private List<String> tablesList = new List<String>();
         private Dictionary<String, String> columnsDictionary = new Dictionary<String, String>();

          string connectionString = "Integrated Security=SSPI;" +
          "Persist Security Info = False;Initial Catalog=Northwind;" +
          "Data Source = localhost";
          SqlConnection connection = new SqlConnection();
          connection.ConnectionString = connectionString;
          connection.Open();

          SqlCommand command = new SqlCommand();
          command.Connection = connection;
          command.CommandText = "exec sp_tables";
          command.CommandType = CommandType.Text;

          SqlDataReader reader = command.ExecuteReader();

           if (reader.HasRows)
           {
               while (reader.Read())
                  tablesList.Add(reader["TABLE_NAME"].ToString());
           }
           reader.Close();

           command.CommandText = "exec sp_columns @table_name = '" +
           tablesList[0] + "'";
           command.CommandType = CommandType.Text;
           reader = command.ExecuteReader();

            if (reader.HasRows)
            {
                while (reader.Read())
                          columnsDictionary.Add(reader["COLUMN_NAME"].ToString(), reader["TYPE_NAME"].ToString());
             }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T12:55:34.327

您可以使用 SqlDataAdapter.FillSchema() 方法。

或者，您可以在将 SqlDataAdapter 的 MissingSchemaAction 属性设置为 AddWithKey 后使用 SqlDataAdapter.Fill() 方法。但是，如果您只想要架构，则必须确保您的查询不返回任何行。这可以通过在查询中添加 WHERE 1=2 之类的语句来完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-13T20:49:20.237

如果您使用的是 MS SQL Server，那么您肯定应该看看 SMO 命名空间（服务器管理对象）。

您可以在 .net 中使用一些对象来负责数据库中的各种事物（包括但不限于表、列、约束等）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T12:56:01.627

我认为您需要 System.Data.DataTable 类：http:
[//msdn.microsoft.com/en-us/library/system.data.datatable.aspx](http://msdn.microsoft.com/en-us/library/system.data.datatable.aspx)

# php - PHP MySql Where Field = <4 Words

> ID：457494
> 
> 赞同：2
> 
> 时间：2009-01-19T12:55:28.383
> 
> 标签：php, mysql

我需要使用一个查询，当它少于 4 个单词时，它会从一个字段中提取数据，这可能吗？如果可以，你能给出一些指示吗？我想如果不可能的话，它可以循环遍历结果，直到找到一个 3 个单词，然后在找到一个单词时结束 while 语句。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-19T13:12:05.060

```
SELECT column FROM table where LENGTH(column) - LENGTH(REPLACE(column, ' ', ''))+1 < 4 
```

[学分和完整解释](http://www.mwasif.com/2008/12/count-number-of-words-in-a-mysql-column/)

这里[正则表达式解决方案](http://www.experts-exchange.com/Database/MySQL/Q_22682620.html)。

```
select * from TABLE where column not regexp '^.+( .+){4}$' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T13:18:14.500

在每条记录的基础上调用函数在性能方面几乎总是一个坏主意 - 磁盘空间通常比 CPU 容量“便宜”得多（我将其括在引号中，因为我不是在谈论美元成本）。

正如我的 DBA 导师曾经告诉我的那样，大多数数据库往往“读多于写”；在这种情况下，理想的解决方案是在插入或更新行时使用触发器来计算该列中的单词数并将它们存储在另一列中。理想的原因是单词的数量仅在您更新字段时发生变化，因此最好在此时执行耗时的计算，而不是（不必要地）每次读取记录时执行。

由于您将一个（短）整数添加到一个长（字符串）中，因此添加的所需空间将是最小的，但是您会发现您的查询仅使用整数字段就会尖叫（确保您对其进行索引）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T13:46:56.470

我打算建议一个`LIKE '% % % %'`，但我不完全确定这是否可行。

# php - 使用 CodeIgniter 进行用户身份验证

> ID：457497
> 
> 赞同：13
> 
> 时间：2009-01-19T12:55:44.500
> 
> 标签：php, codeigniter, authentication

我正在使用 PHP 编写一个 Web 应用程序。我想为此使用 MVC 模式，并决定使用[CodeIgniter](http://codeigniter.com/)。我的应用程序将有一些页面需要身份验证，而有些页面则不需要。我想以一种非常通用的方式设计它，这样就不应该有代码重复。任何人都可以为此指出一些好的“设计/类结构”吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-19T18:12:14.500

编写一个自定义库，您可以在每个页面视图的代码点火器应用程序中自动加载该库。它应该具有以下功能：

*   验证用户，即。检查用户是否登录
*   登录即。设置会话变量或其他东西
*   注销你

然后在您的控制器类中，您可以调用构造函数中的身份验证函数，然后根据结果正常继续或将它们重定向到带有拒绝访问消息的登录屏幕。

在代码点火器 wiki 上搜索“身份验证”，有许多结果可能会有所帮助：[http ://codeigniter.com/wiki/](http://codeigniter.com/wiki/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-07-07T12:32:44.783

“Ion Auth”精简、编程良好、使用广泛并且得到积极维护。

[http://github.com/benedmunds/CodeIgniter-Ion-Auth](http://github.com/benedmunds/CodeIgniter-Ion-Auth)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T18:01:12.230

如果“某些页面”是指某些控制器（您的视图的网关），那么您可能需要调查控制器继承。使用您自己的扩展默认 CodeIgniter 控制器并在构造函数中进行身份验证检查（检查会话以获取已登录标志或其他内容，如果未登录则重定向到登录页面）。然后，所有需要身份验证的控制器都需要扩展您的新父控制器。就是这样。

前往 CodeIgniter 论坛并搜索一些不同的方法来扩展控制器。这是一个[http://codeigniter.com/forums/viewthread/89768/#452890](http://codeigniter.com/forums/viewthread/89768/#452890)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T02:44:06.930

我最近也在研究同样的事情，我发现了一个名为[Kohana](http://kohanaframework.org/)的 CodeIgniter 分支，其中包含一个不错的[身份验证模块](http://docs.kohanaphp.com/addons/auth)。如果您设置在 CI 上，也许将 Kohana 的身份验证模块向后调整为 CI 会节省您一些时间？如果您刚刚开始您的项目并且可以使用 PHP5，请考虑切换；它们是非常相似的框架。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T09:06:14.160

可能您可以将 CL_AUTH 库用于 CI。我用过它，效果很好。你可以在这里找到它[http://www.jasonashdown.co.uk/cl_auth_doc/](http://www.jasonashdown.co.uk/cl_auth_doc/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-17T18:29:14.823

访问[GitHub](https://github.com/)并搜索 Codeigniter Auth 或 Authentication，或查看[CodeIgniter Wiki](https://github.com/bcit-ci/CodeIgniter/wiki/Contributions#libraries)，您会发现许多具有不同功能的库.. 探索它们并选择您需要的！但要小心，很多都是针对 CI 2 的，而且你必须首先[ucfirst 类](http://www.codeigniter.com/userguide3/installation/upgrade_300.html#step-2-update-your-classes-file-names)与 CI 3 一起使用，否则它们根本不起作用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-23T16:48:17.850

Use [flexi auth](http://haseydesign.com/flexi-auth/) a modified version of the popular [Ion Auth](https://github.com/benedmunds/CodeIgniter-Ion-Auth) library. It's more advanced and do all the job out-of-the-box.

> flexi auth is a free open source user authentication/login library for use with the CodeIgniter 2.0+ framework.

I know it's too late but I hope someone else will find it helpful. **Cheers!**

# python - 如何将图片从画布复制到剪贴板？

> ID：457514
> 
> 赞同：4
> 
> 时间：2009-01-19T12:59:53.617
> 
> 标签：python, clipboard, tkinter

我有一些 Tkinter 画布和一些线条和文字的图片。有没有一种简单的方法可以将其复制到剪贴板？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T17:27:01.300

您可以使用[`.postscript`](http://infohost.nmt.edu/tcc/help/pubs/tkinter/canvas-methods.html)画布的方法来获取内容的封装 PostScript (EPS) 表示。然后，使用[ImageMagick](http://www.imagemagick.org)的 Python 绑定（[PythonMagick](http://www.imagemagick.org/download/python/)或[PythonMagickWand](http://www.procoders.net/?p=39)）将 EPS 转换为 Windows 增强型元文件 (EMF)。[最后，使用CF_ENHMETAFILE](http://msdn.microsoft.com/en-us/library/ms649013(VS.85).aspx)剪贴板格式将其复制到剪贴板（例如使用[nosklo 的解决方案](https://stackoverflow.com/questions/457514/how-to-copy-a-picture-from-canvas-to-clipboard#458236)） 。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-19T16:38:14.300

要使用 windows 剪贴板，您必须将图像数据转换为 win api 接受的格式。然后，只需使用此功能：

```
import win32clipboard

def send_to_clibboard(clip_type, data): 
    win32clipboard.OpenClipboard()
    win32clipboard.EmptyClipboard()
    win32clipboard.SetClipboardData(clip_type, data) 
    win32clipboard.CloseClipboard() 
```

在哪里`clip_type`可以`win32clipboard.CF_BITMAP`，`win32clipboard.CF_TIFF`或许多其他。

# java - Java Applets 以蜗牛的速度加载

> ID：457515
> 
> 赞同：2
> 
> 时间：2009-01-19T13:00:18.500
> 
> 标签：java, applet

我的 php 网页上有一个 Java Applet 应用程序（achart）......这里的问题是 Java Applet 需要更多时间来加载......我正在考虑用一些类似的技术替换这些小程序，但速度很快......我指望阿贾克斯......我还有什么其他选择......？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:52:03.750

Java 小程序加载缓慢。*耸耸肩*这是野兽的本性....

如果您有多个 jar，您应该检查您提供给 applet 的类路径的顺序。请注意，每个 jar 仅在需要加载类时“按需”下载。它在第一个 jar 中查找，如果找不到它在第二个中查找的类，依此类推...您可以通过确保启动应用程序所需的所有类都在第一个 jar 中来减少启动时间(s) 列出。

此外，如果您尝试加载不在类路径中的类或资源，它必须在返回之前搜索所有 jar 并点击服务器代码库以查看那里。它可能会大大减少您的启动时间。

在 java 控制面板中打开小程序跟踪，您应该更好地了解如何从 jar 中加载类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T15:03:14.320

你有没有把你的罐子收拾好......

您是否尝试过使用 jdk 1.6.10+ 的 Java 部署工具包（[http://blogs.oracle.com/vaibhav/entry/java_deployment_toolkit_6u10](http://blogs.oracle.com/vaibhav/entry/java_deployment_toolkit_6u10)）.....

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T19:59:09.917

如果小程序的 JAR 库的大小需要很长时间才能下载，您可以使用[ProGuard 工具](http://proguard.sourceforge.net/)缩小大小。下面是一些 Java 库[的压缩率比较。](http://proguard.sourceforge.net/results.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T13:02:16.357

如果您想要它的简单图表，请查看： [http ://code.google.com/apis/chart/](http://code.google.com/apis/chart/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T13:07:08.173

雅虎有一些不错的 actionscript 3 (flash) 图表组件[http://developer.yahoo.com/flash/astra-flash/charts/](http://developer.yahoo.com/flash/astra-flash/charts/)

正如蒂姆已经指出的那样，谷歌有一项服务可以将图表生成为图像。

或者，您可以尝试加快您正在使用的小程序的交付 - 检查它们是否具有 Expires 标头，以便它们仅偶尔下载一次而不是每个页面（这对第一次查看没有帮助，但是之后会加快速度）

编辑：如果您只针对特定浏览器，您可以尝试使用 javascript 和 Canvas 元素创建图表，但 Internet Explorer 绝对不支持。[https://developer.mozilla.org/en/Canvas_tutorial](https://developer.mozilla.org/en/Canvas_tutorial)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-07T14:41:22.397

我知道这个答案有点晚了，但是，可能是你对 java 的效率很低，或者你的机器很慢，我有一个 java 程序，它有很多代码，并且可以访问 SQLite 数据库，它运行得很好快速，五秒内加载。如果您的程序中有任何未使用的内容，则将其删除，还可以尝试对其进行 jaring 和签名（不确定最后两件事是否会有所帮助。）

# c# - 使用 Live API 的 Hotmail 警报

> ID：457519
> 
> 赞同：2
> 
> 时间：2009-01-19T13:02:49.977
> 
> 标签：c#, live, email, hotmail

我希望编写一个 C# 应用程序，以在用户收到他的 hotmail 帐户上的电子邮件时提醒他。我已经通过了

[http://www.codeproject.com/KB/IP/httpmail.aspx](http://www.codeproject.com/KB/IP/httpmail.aspx)

但似乎微软现在已经停止了它。 [http://www.eweek.com/article2/0,1759,1652391,00.asp](http://www.eweek.com/article2/0,1759,1652391,00.asp)

我查看了 Live SDK，但在其中找不到任何与邮件相关的 API，有人可以建议我应该在哪里寻找吗？我是一个充满激情的研究人员，对我来说只需一个小指针就足够了。感谢所有的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T03:03:20.860

如果您正在寻找类似于 MSN Messenger 在收到新消息时所做的事情（至少它对我来说是这样的），那么您可以尝试使用数据包嗅探器来查看当弹出窗口发生时哪些数据包进出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-08T15:32:49.803

*   POP3 可供所有用户使用
*   IMAP 仅适用于高级用户。
*   HttpMail 仅适用于高级用户。（它的记录也很差）

我有[一个类似的问题，但对于 Java，](https://stackoverflow.com/questions/965460/access-hotmail-unread-mail-count-via-java)它可能有用也可能没用。

# jboss - 登录 JBoss 门户

> ID：457526
> 
> 赞同：3
> 
> 时间：2009-01-19T13:05:02.593
> 
> 标签：jboss, portlet, jboss-portal

如何在`JBoss`Portal 的管理员模式下创建自定义链接以登录和注销？

# c# - 从 c# 读取 ldap 组成员

> ID：457537
> 
> 赞同：2
> 
> 时间：2009-01-19T13:10:41.597
> 
> 标签：c#, ldap, directoryentry

我有这段代码可以连接到 Active Directory 并获取所有存在的组，它可以工作并在结果中返回所有组：

```
DirectoryEntry dirEnt = new DirectoryEntry();

using (DirectorySearcher srch = new DirectorySearcher(dirEnt, "(objectClass=Group)"))
            {
                srch.PageSize = 1000;
                SearchResultCollection results = srch.FindAll();
            } 
```

我现在想返回特定组的用户，即管理员，我该怎么做？

我曾尝试将 (objectClass=Group) 更改为 (objectClass=Group)(cn= *admin* ) 但它没有返回任何结果。

祝一切顺利

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T13:50:46.807

以下是有关如何在 Active Directory 中使用的参考：

[Howto：（几乎）通过 C# 在 Active Directory 中的所有内容](http://www.codeproject.com/KB/system/everythingInAD.aspx)

# javascript - 根据它们的构造方式，回调也可以定义为闭包吗？

> ID：457549
> 
> 赞同：4
> 
> 时间：2009-01-19T13:16:03.490
> 
> 标签：javascript, closures, callback

在 JavaScript 中，我知道闭包可以定义为嵌套函数，该函数可以访问其包含函数的变量。例如：

```
function outerFunction(x, y) {
    function innerFunction() {
        return x + y + 10;
    }
    return innerFunction;
} 
```

`onreadystatechange`现在，下面的代码正在为请求对象的属性建立一个回调；但是，**我想知道根据定义，这是否也被认为是一个闭包**：

```
/* This is a contrived example, I know. 
 * Bear with me - it demonstrates the point I'm trying to convey. */

function submitHandler() {

    var oRequest = createRequest(); // assume I'm getting an instance of the xhr
    var sUsername = 'Tom';          // assume this is needed for work in the handler
    var This = this;
    oRequest.onreadystatechange = function() {
        This.handleResponse(oRequest, sUsername)
    }

}

function handleResponse(oResponse, sUsername) {
    if(oResponse.readyState === 4 && oResponse.status === 200) {
        // do work with the username
    } else {
        // we're not done yet...
    }
} 
```

我意识到该`handleResponse`函数也可以在 的上下文中编写为匿名函数`submitHandler`，但我发现如果在函数回调范围之外定义回调，更复杂的 Ajax 代码可以更易读和更容易维护。同样，这是一个人为的例子，我正在使用它来简单地展示我的问题的重点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T13:19:59.100

是的，您假设它是定义上的闭包是正确的。

听起来你知道你的东西，但[这里有一篇关于 javascript 闭包的好文章](http://www.jibbering.com/faq/faq_notes/closures.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T13:25:14.843

我完全同意太多的内联闭包函数不会提高可读性。另一方面，我非常不喜欢`var self = this`写闭包的风格，这`this`只是一种变体，因为它的声明仍然过于冗长，并且您引入了自己的新“关键字”，无论是`this`还是`self`.

你想要的是咖喱/绑定方法。

```
function $A(o)
{
    var a = [];
    for (var i = 0; i < o.length; ++i)
        a.push(o[i]);
    return a;
}

Function.prototype.bind = function()
{
   var _method = this;
   var a = $A(arguments)
   var o = a.shift();

   return function()
   {
       return _method.apply(o, a.concat($A(arguments)));
   }
}

Function.prototype.curry = function()
{
   var _method = this;
   var a = $A(arguments);

   return function()
   {
       return _method.apply(null, a.concat($A(arguments)));
   }
} 
```

这些方法取自[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)库。即使在不使用原型库的项目中，我也会使用它们，因为它们非常有用！

在你的情况下，这意味着而不是写：

```
var This = this;
oRequest.onreadystatechange = function() {
    This.handleResponse(oRequest, sUsername)
} 
```

你现在可以写：

```
oRequest.onreadystatechange = this.handleResponse.curry(oRequest,sUsername); 
```

但是，如果您想转移 this 关键字的含义，您可以这样做

```
oRequest.onreadystatechange = this.handleResponse.bind(this,oRequest,sUsername); 
```

`handleResponse`，当被调用时，将具有与 相同的`this`上下文`submitHandler`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T13:37:12.620

您的第一个示例不是闭包。如果您返回了 innerFunction 但您正在执行 innerFunction 并返回结果，那将会是这样。

第二个示例有效并且正在使用闭包。这种特定技术的一个警告是，您最终可能会在某些浏览器实现中出现相当严重的内存泄漏（IE 当然也可能是其他浏览器）。您将在 oRequest 中保存的 xhr、引用函数的 onreadystatechange 和作为保存 xhr 的范围的函数范围之间创建循环引用。不仅 xhr 将保留在内存中，如果响应很大（尤其是 XML 时），响应也会迅速吞噬内存。

在处理响应期间，将 onreadystatechange 属性设置为空的全局级别函数。这将打破循环。

# sql-server - 通用插入存储过程：运行时错误

> ID：457551
> 
> 赞同：1
> 
> 时间：2009-01-19T13:17:13.660
> 
> 标签：sql-server, stored-procedures, visual-studio-2005

以下代码为要插入的新记录生成主键并将记录插入到表中，表的名称和要插入的值作为存储过程的参数给出。我收到运行时错误。我正在使用 Visual Studio 2005 来处理 SQL Server 2005 Express Edition

```
ALTER PROCEDURE spGenericInsert

(
    @insValueStr nvarchar(300), 
    @tblName nvarchar(10) 
)

AS

DECLARE @sql nvarchar(400)
DECLARE @params nvarchar(200)
DECLARE @insPrimaryKey nvarchar(10)
DECLARE @rowCountVal integer
DECLARE @prefix nvarchar(5)

--following gets the rowcount of the table--
SELECT @rowCountVal = ISNULL(SUM(spart.rows), 0)
    FROM sys.partitions spart 
    WHERE spart.object_id = object_id(@tblName) AND spart.index_id < 2

SET @rowCountVal = @rowCountVal+1

--Following Creates the Primary Key--
IF @tblName = 'DEFECT_LOG' 
    SET @prefix='DEF_'
ELSE IF @tblName='INV_Allocation_DB'
    SET @prefix='INV_'
ELSE IF @tblName='REQ_Master_DB'
    SET @prefix='REQ_'
ELSE IF @tblName='SW_Master_DB'
    SET @prefix='SWI_'
ELSE IF @tblName='HW_Master_DB'
    SET @prefix='HWI_'  

SET @insPrimaryKey= @prefix + RIGHT(replicate('0',5)+ convert(varchar(5),@rowCountVal),5) -- returns somethin like 'DEF_00005'

-- Following is for inserting into the table --

SELECT @sql =   N' INSERT INTO @tableName VALUES ' +
        N' ( @PrimaryKey , @ValueStr )'

SELECT @params = N'@tableName nvarchar(10), ' +
                    N'@PrimaryKey nvarchar(10), ' +
                    N'@ValueStr  nvarchar(300)'

EXEC sp_executesql @sql, @params, @tableName=@tblName, @PrimaryKey=@insPrimaryKey, @ValueStr=@insValueStr 
```

输出消息：

```
Running [dbo].[spGenericInsert] ( @insValueStr = 2,"Hi",1/1/1987, @tblName = DEFECT_LOG ).

Must declare the table variable "@tableName".

No rows affected.

(0 row(s) returned)

@RETURN_VALUE = 0

Finished running [dbo].[spGenericInsert]. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T13:20:03.950

您将不得不将表名直接连接到字符串中，因为这不能参数化：

```
SELECT @sql =   N' INSERT INTO [' + @tblName + '] VALUES ' +
            N' ( @PrimaryKey , @ValueStr )'

SELECT @params = N'@PrimaryKey nvarchar(10), ' +
                N'@ValueStr  nvarchar(300)' 
```

为防止注入攻击，您应该将此表名列入白名单。如果表有其他不可为空的列等，这也不是健壮的。

**注意：**不过，就我个人而言，我认为这不是 TSQL 的好用处；在客户端（C＃或其他）中构造命令并将其作为参数化命令执行可能更合适。有动态 SQL 的用例，但我不确定这是一个很好的例子。

更好的是，使用您首选的 ORM 工具（LINQ-to-SQL、NHibernate、LLBLGen、实体框架等）为您完成所有这些工作，并专注于您的实际问题领域。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T13:29:32.263

白名单本质上意味着确保传入的表是您希望它们能够插入的有效表。让我们假设表名是用户提供的，然后用户可以开始将记录插入系统表中。

您可以通过弹跳 sysobjects 表的表名来进行白名单检查：

select * from sysobjects where name=@tblname and xType='U'

然而，正如 Marc 所建议的那样，这不是 TSQL 的好用处，最好在应用程序层中将其作为参数化查询来处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T16:46:09.620

同意 Marc 的观点——总的来说，这是一个非常糟糕的想法。通用插入/更新或删除最终会导致数据库出现问题。

另一点是，当两个用户同时针对同一个表运行时，这个过程会出现问题，因为他们会尝试插入相同的主键。

# c# - 如何使用 SubSonic 和 MySQL 更新更改

> ID：457565
> 
> 赞同：0
> 
> 时间：2009-01-19T13:21:43.977
> 
> 标签：c#, mysql, subsonic

我试图使用 SubSonic 2.1、MySQL 和 C# 进行[TDD](http://en.wikipedia.org/wiki/Test-driven_development)，当我开始使用下面的代码测试更新现有记录时，

```
public void Test2()
{
    User.Insert("jmarcus1", "jmarcus1", "jackass", "marcus", 3, false);
    User users = new User();
    int ulevel = 1;
    User.Update(2, "jmarcus1", "jmarcus1", "jackass", "marcus", ulevel, false);
    Assert.AreEqual(1, users.Ulevel);
} 
```

与以下

```
------ Test started: Assembly: SalMan.dll ------

Starting the MbUnit Test Execution
Exploring SalMan, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
MbUnit 2.4.2.130 Addin
Found 3 tests
[success] TestFixture1.Test
[success] TestFixture1.Test1
[failure] TestFixture1.Test2
TestCase 'TestFixture1.Test2'
failed: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'WHERE `userid` = 1; SELECT 1 AS id' at line 1
    MySql.Data.MySqlClient.MySqlException
    Message: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'WHERE `userid` = 1; SELECT 1 AS id' at line 1
    Source: MySql.Data
    StackTrace:
    at MySql.Data.MySqlClient.MySqlStream.OpenPacket()
    at MySql.Data.MySqlClient.NativeDriver.ReadResult(UInt64& affectedRows, Int64& lastInsertId)
    at MySql.Data.MySqlClient.MySqlDataReader.GetResultSet()
    at MySql.Data.MySqlClient.MySqlDataReader.NextResult()
    at MySql.Data.MySqlClient.MySqlCommand.ExecuteReader(CommandBehavior behavior)
    at MySql.Data.MySqlClient.MySqlCommand.ExecuteScalar()
    C:\svn\subsonicproject\trunk\SubSonic\DataProviders\MySqlDataProvider.cs(280,0): at SubSonic.MySqlDataProvider.ExecuteScalar(QueryCommand qry)
    C:\svn\subsonicproject\trunk\SubSonic\DataProviders\DataService.cs(533,0): at SubSonic.DataService.ExecuteScalar(QueryCommand cmd)
    C:\svn\subsonicproject\trunk\SubSonic\ActiveRecord\ActiveRecord.cs(182,0): at SubSonic.ActiveRecord`1.Save(String userName)
    D:\My Documents\Visual Studio 2008\Projects\SalMan\SalMan\Generated\User.cs(352,0): at Salman.User.Update(Int32 varUserid, String varUsername, String varPassword, String varFname, String varLname, Int32 varUlevel, Boolean varStatus)
    D:\My Documents\Visual Studio 2008\Projects\SalMan\SalMan\Tests\TestFixture1.cs(40,0): at salman.TestFixture1.Test2()

[reports] generating HTML report
TestResults: file:///C:/Documents%20and%20Settings/*****************/Application%20Data/MbUnit/Reports/SalMan.Tests.html

2 passed, 1 failed, 0 skipped, took 7.66 seconds. 
```

有没有人有解决方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T19:14:11.897

在我看来，您的参数不正常。PK 应该是第一件事——你确定他们排对了吗？

你在使用 ActiveRecord 吗？如果是这样-您是否尝试过：

```
User u=new User();
u.UserName("jmarcus1");
u.Name="jackass"
u.Ulevel=1;
...
u.Save();

User u=new User("jmarcus1");
u.UILevel=2;
u.Save(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T05:52:53.430

显然，解决方案是，按照 Rob 上面的出色建议，

```
User u = User.FetchByID(2);
u.Ulevel = ulevel;
u.save(); 
```

在您指定要更新的记录之前，我不太确定上面的代码段是否适用于更新。

然而，我对 Rob 的问题是，为什么 "u.Update(2, "jmarcus",..." 会出现上述错误？

# iphone - iPhone 开发 - iphone 应用程序的内存限制

> ID：457568
> 
> 赞同：5
> 
> 时间：2009-01-19T13:22:19.797
> 
> 标签：iphone, memory

任何人都可以在这里指出正确的方向。我想在我的应用程序收到内存警告时做出响应（我想知道如何响应此通知）。另外，我的应用程序可以连接多少内存？

任何文章或书籍参考都会很棒。谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T20:49:57.973

如果您的应用程序收到内存警告（例如在您的视图控制器的`didReceiveMemoryWarning`方法中），您需要释放所有非关键数据。例如，您使用的任何缓存或可以重新生成的东西都应该被转储。

例如，如果您的应用程序处理一些数字并将结果存储在一个大数组中，如果您没有积极使用该数组，则应该释放它。然后，当您再次需要它时重新生成它。

更多信息在这里： [观察低内存警告](http://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/chapter_3_section_5.html#//apple_ref/doc/uid/TP40007072-CH7-SW49)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-19T14:25:33.180

我非正式地听说当您的应用程序达到大约 22 MB 时会发出警告。（包括所有分配的内存——iPhone 将所有内容保存在物理 RAM 中，不会分页到任何其他存储。）鉴于手机只有 128 MB 的总 RAM，这似乎是合理的。

该限制不包括共享系统库使用的内存，例如 Objective-C 运行时。虽然我对此并不完全确定，但我不认为 UIWebView 组件包含 WebKit 的内存使用情况，因为我相信 WebKit 总是被加载（但同样，不是 100% 确定这一点）。

当您达到此限制时，最好的办法是释放您可以轻松地从输入文件重新生成或重新读取的任何内容，例如视图、图像和缓存数据。

# c# - 我的自定义线程池有什么问题？

> ID：457572
> 
> 赞同：0
> 
> 时间：2009-01-19T13:24:54.220
> 
> 标签：c#, .net, multithreading, lambda

我创建了一个自定义线程池实用程序，但似乎有一个我找不到的问题。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Threading;

namespace iWallpaper.S3Uploader
{
public class QueueManager<T>
{
    private readonly Queue queue = Queue.Synchronized(new Queue());
    private readonly AutoResetEvent res = new AutoResetEvent(true);
    private readonly AutoResetEvent res_thr = new AutoResetEvent(true);
    private readonly Semaphore sem = new Semaphore(1, 4);
    private readonly Thread thread;
    private Action<T> DoWork;
    private int Num_Of_Threads;

    private QueueManager()
    {
        Num_Of_Threads = 0;
        maxThread = 5;
        thread = new Thread(Worker) {Name = "S3Uploader EventRegisterer"};
        thread.Start();

        //   log.Info(String.Format("{0} [QUEUE] FileUploadQueueManager created", DateTime.Now.ToLongTimeString()));
    }

    public int maxThread { get; set; }

    public static FileUploadQueueManager<T> Instance
    {
        get { return Nested.instance; }
    }

    /// <summary>
    /// Executes multythreaded operation under items
    /// </summary>
    /// <param name="list">List of items to proceed</param>
    /// <param name="action">Action under item</param>
    /// <param name="MaxThreads">Maximum threads</param>
    public void Execute(IEnumerable<T> list, Action<T> action, int MaxThreads)
    {
        maxThread = MaxThreads;
        DoWork = action;
        foreach (T item in list)
        {
            Add(item);
        }
    }
    public void ExecuteNoThread(IEnumerable<T> list, Action<T> action)
    {
        ExecuteNoThread(list, action, 0);
    }
    public void ExecuteNoThread(IEnumerable<T> list, Action<T> action, int MaxThreads)
    {
        foreach (T wallpaper in list)
        {
            action(wallpaper);
        }
    }
    /// <summary>
    /// Default 10 threads
    /// </summary>
    /// <param name="list"></param>
    /// <param name="action"></param>
    public void Execute(IEnumerable<T> list, Action<T> action)
    {
        Execute(list, action, 10);
    }

    private void Add(T item)
    {
        lock (queue)
        {
            queue.Enqueue(item);
        }
        res.Set();
    }

    private void Worker()
    {
        while (true)
        {
            if (queue.Count == 0)
            {
                res.WaitOne();
            }

            if (Num_Of_Threads < maxThread)
            {
                var t = new Thread(Proceed);
                t.Start();
            }
            else
            {
                res_thr.WaitOne();
            }
        }
    }

    private void Proceed()
    {
        Interlocked.Increment(ref Num_Of_Threads);
        if (queue.Count > 0)
        {
            var item = (T) queue.Dequeue();

            sem.WaitOne();
            ProceedItem(item);
            sem.Release();
        }
        res_thr.Set();
        Interlocked.Decrement(ref Num_Of_Threads);
    }

    private void ProceedItem(T activity)
    {
        if (DoWork != null)
            DoWork(activity);

        lock (Instance)
        {
            Console.Title = string.Format("ThrId:{0}/{4}, {1}, Activity({2} left):{3}",
                                          thread.ManagedThreadId, DateTime.Now, queue.Count, activity,
                                          Num_Of_Threads);
        }
    }

    #region Nested type: Nested

    protected class Nested
    {
        // Explicit static constructor to tell C# compiler
        // not to mark type as beforefieldinit
        internal static readonly QueueManager<T> instance = new FileUploadQueueManager<T>();
    }

    #endregion

} 
```

}

问题在这里：

```
Console.Title = string.Format("ThrId:{0}/{4}, {1}, Activity({2} left):{3}",
                                      thread.ManagedThreadId, DateTime.Now, queue.Count, activity,
                                      Num_Of_Threads); 
```

标题中总是有一个线程 ID。程序似乎在一个线程中工作。

示例用法：

```
 var i_list = new int[] {1, 2, 4, 5, 6, 7, 8, 6};
        QueueManager<int>.Instance.Execute(i_list,
          i =>
          {
              Console.WriteLine("Some action under element number {0}", i);

          }, 5); 
```

PS：这很混乱，但我仍在努力。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-19T13:48:46.577

我查看了您的代码，这里有几个我看到的问题。

1.  您锁定队列对象，即使它是同步队列。这是不必要的
2.  您不一致地锁定队列对象。它应该为每次访问锁定或不锁定，具体取决于同步行为。
3.  Proceed 方法不是线程安全的。这两行是问题

    ```
        if (queue.Count > 0) {
          var item = (T)queue.Dequeue();
        ...
        }

    ```

    使用同步队列只能保证单个访问是安全的。所以 .Count 和 .Dequeue 方法都不会弄乱队列的内部结构。但是想象一下两个线程同时运行这些代码行的场景，队列的计数为 1

    *   线程 1：如果 (...) -> true
    *   线程 2：如果 (...) -> true
    *   线程1：出队->成功
    *   Thread2: dequeue -> 失败，因为队列为空
4.  Worker 和 Proceed 之间存在可能导致死锁的竞争条件。下面两行代码应该切换。

    代码：

    ```
        res_thr.Set()
        Interlocked.Decrement(ref Num_Of_Threads);
    ```

    第一行将解除对 Worker 方法的阻塞。如果它运行得足够快，它将返回查看，注意 Num_Of_Threads < maxThreads 并直接返回 res_thr.WaitOne()。如果当前没有其他线程正在运行，那么这将导致您的代码出现死锁。使用少量最大线程（例如 1）很容易达到此目的。反转这两行代码应该可以解决问题。

5.  maxThread 计数属性似乎没有超过 4 的用处。 sem 对象被初始化为只接受 4 个最大并发条目。实际执行一个项目的所有代码都必须经过这个信号量。因此，无论 maxThread 设置多高，您都有效地将最大并发项目数限制为 4。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-19T13:59:14.697

编写健壮的线程代码并非易事。有许多线程池可供您参考，但也请注意并行扩展（可作为[CTP](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)或更高版本在 .NET 4.0 中使用）包括许多开箱即用的附加线程构造（在TPL/CCR）。例如`Parallel.For`/ `Parallel.ForEach`，它处理工作窃取和有效处理可用内核。

有关预滚动线程池的示例，请参阅 Jon Skeet 的`CustomThreadPool` [此处](http://www.yoda.arachsys.com/csharp/miscutil/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T13:59:23.963

我想你可以简单地做很多事情。

这是我使用的线程池的修改形式（我没有测试修改）：

唯一同步。您需要的原语是一个监视器，锁定在线程池上。您不需要信号量或重置事件。

```
internal class ThreadPool
{
    private readonly Thread[] m_threads;
    private readonly Queue<Action> m_queue;
    private bool m_shutdown;
    private object m_lockObj;

    public ThreadPool(int numberOfThreads)
    {
        Util.Assume(numberOfThreads > 0, "Invalid thread count!");
        m_queue = new Queue<Action>();
        m_threads = new Thread[numberOfThreads];
        m_lockObj = new object();

        lock (m_lockObj)
        {
            for (int i = 0; i < numberOfWriteThreads; ++i)
            {
                m_threads[i] = new Thread(ThreadLoop);
                m_threads[i].Start();
            }
        }

    }

    public void Shutdown()
    {
        lock (m_lockObj)
        {
            m_shutdown = true;
            Monitor.PulseAll(m_lockObj);

            if (OnShuttingDown != null)
            {
                OnShuttingDown();
            }
        }
        foreach (var thread in m_threads)
        {
            thread.Join();
        }
    }
    public void Enqueue(Action a)
    {
        lock (m_lockObj)
        {
            m_queue.Enqueue(a);
            Monitor.Pulse(m_lockObj);
        }
    }

    private void ThreadLoop()
    {
        Monitor.Enter(m_lockObj);

        while (!m_shutdown)
        {
            if (m_queue.Count == 0)
            {
                Monitor.Wait(m_lockObj);
            }
            else
            {
                var a = m_queue.Dequeue();
                Monitor.Pulse(m_lockObj);
                Monitor.Exit(m_lockObj);
                try
                {
                    a();
                }
                catch (Exception ex)
                {
                    Console.WriteLine("An unhandled exception occured!\n:{0}", ex.Message, null);
                }
                Monitor.Enter(m_lockObj);
            }
        }

        Monitor.Exit(m_lockObj);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T13:47:26.687

您可能应该使用内置的线程池。运行您的代码时，我注意到您启动了一堆线程，但由于队列计数<1，您只需退出，这将一直持续到队列实际填充，然后您的下一个线程处理所有内容。这是一个非常昂贵的过程。如果您有事可做，您应该只启动线程。

# c++ - 捕获访问冲突异常？

> ID：457577
> 
> 赞同：94
> 
> 时间：2009-01-19T13:27:03.390
> 
> 标签：c++, exception-handling

例子

```
int *ptr;
*ptr = 1000; 
```

我可以在不使用任何微软特定的情况下使用标准 C++ 捕获内存访问冲突异常吗？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-05-28T02:07:04.103

读它哭泣！

我想到了。如果您不从处理程序中抛出，则处理程序将继续，异常也将继续。

当你抛出你自己的异常并处理它时，魔法就会发生。

```
#include "stdafx.h"
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <tchar.h>

void SignalHandler(int signal)
{
    printf("Signal %d",signal);
    throw "!Access Violation!";
}

int main()
{
    typedef void (*SignalHandlerPointer)(int);

    SignalHandlerPointer previousHandler;
    previousHandler = signal(SIGSEGV , SignalHandler);
    try{
        *(int *) 0 = 0;// Baaaaaaad thing that should never be caught. You should write good code in the first place.
    }
    catch(char *e)
    {
        printf("Exception Caught: %s\n",e);
    }
    printf("Now we continue, unhindered, like the abomination never happened. (I am an EVIL genius)\n");
    printf("But please kids, DONT TRY THIS AT HOME ;)\n");

} 
```

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2011-11-22T22:43:09.780

有一种非常简单的方法可以使用 try -> catch (...) 块在**Visual Studio**中捕获任何类型的异常（除以零、访问冲突等） 。一个小的项目设置调整就足够了。只需在项目设置中启用 /EHa 选项。请参阅**Project Properties -> C/C++ -> Code Generation -> 将 Enable C++ Exceptions 修改为 "Yes With SEH Exceptions"**。就是这样！

在此处查看详细信息： [https ://docs.microsoft.com/en-us/cpp/cpp/structured-exception-handling-c-cpp?view=msvc-160](https://docs.microsoft.com/en-us/cpp/cpp/structured-exception-handling-c-cpp?view=msvc-160)

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-01-19T13:30:17.627

没有。当你做坏事时，C++ 不会抛出异常，这会导致性能下降。诸如访问冲突或除以零错误之类的事情更像是“机器”异常，而不是您可以捕获的语言级别的事情。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2017-02-26T04:35:08.763

至少对我来说，`signal(SIGSEGV ...)`另一个答案中提到的方法**不适用于 Win32 和 Visual C++ 2015**。*对*我有用的是使用`_set_se_translator()`found in `eh.h`。它是这样工作的：

**第 1 步**）确保在*Project Properties / C++ / Code Generation / Enable C++ Exceptions中启用***Yes with SEH Exceptions (/EHa) ，如***Volodymyr Frytskyy*的回答中所述。

 ****第 2 步**）调用`_set_se_translator()`，为新的异常*翻译器*传入一个函数指针（或 lambda） 。它之所以称为翻译器，是因为它基本上只接受低级异常并将其重新抛出为更容易捕获的东西，例如`std::exception`：

```
#include <string>
#include <eh.h>

// Be sure to enable "Yes with SEH Exceptions (/EHa)" in C++ / Code Generation;
_set_se_translator([](unsigned int u, EXCEPTION_POINTERS *pExp) {
    std::string error = "SE Exception: ";
    switch (u) {
    case 0xC0000005:
        error += "Access Violation";
        break;
    default:
        char result[11];
        sprintf_s(result, 11, "0x%08X", u);
        error += result;
    };
    throw std::exception(error.c_str());
}); 
```

**步骤 3** ) 像往常一样捕获异常：

```
try{
    MakeAnException();
}
catch(std::exception ex){
    HandleIt();
}; 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-19T13:33:42.923

这种情况取决于实现，因此需要供应商特定的机制才能进行陷阱。对于 Microsoft，这将涉及 SEH，而 *nix 将涉及一个信号

一般来说，虽然捕获访问冲突异常是一个**非常**糟糕的主意。几乎没有办法从 AV 异常中恢复，尝试这样做只会导致更难在程序中找到错误。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-01-19T15:10:30.310

如前所述，在 Windows 平台上没有非 Microsoft/编译器供应商的方式来执行此操作。然而，在正常的 try { } catch (exception ex) { } 方式中捕获这些类型的异常显然是有用的，用于错误报告和更优雅的应用程序退出（正如 JaredPar 所说，应用程序现在可能有麻烦了） . 我们在一个简单的类包装器中使用 _se_translator_function，它允许我们在一个 try 处理程序中捕获以下异常：

```
DECLARE_EXCEPTION_CLASS(datatype_misalignment)
DECLARE_EXCEPTION_CLASS(breakpoint)
DECLARE_EXCEPTION_CLASS(single_step)
DECLARE_EXCEPTION_CLASS(array_bounds_exceeded)
DECLARE_EXCEPTION_CLASS(flt_denormal_operand)
DECLARE_EXCEPTION_CLASS(flt_divide_by_zero)
DECLARE_EXCEPTION_CLASS(flt_inexact_result)
DECLARE_EXCEPTION_CLASS(flt_invalid_operation)
DECLARE_EXCEPTION_CLASS(flt_overflow)
DECLARE_EXCEPTION_CLASS(flt_stack_check)
DECLARE_EXCEPTION_CLASS(flt_underflow)
DECLARE_EXCEPTION_CLASS(int_divide_by_zero)
DECLARE_EXCEPTION_CLASS(int_overflow)
DECLARE_EXCEPTION_CLASS(priv_instruction)
DECLARE_EXCEPTION_CLASS(in_page_error)
DECLARE_EXCEPTION_CLASS(illegal_instruction)
DECLARE_EXCEPTION_CLASS(noncontinuable_exception)
DECLARE_EXCEPTION_CLASS(stack_overflow)
DECLARE_EXCEPTION_CLASS(invalid_disposition)
DECLARE_EXCEPTION_CLASS(guard_page)
DECLARE_EXCEPTION_CLASS(invalid_handle)
DECLARE_EXCEPTION_CLASS(microsoft_cpp) 
```

原始类来自这篇非常有用的文章：

[http://www.codeproject.com/KB/cpp/exception.aspx](http://www.codeproject.com/KB/cpp/exception.aspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-20T08:29:34.910

不是异常处理机制，但是可以使用C语言提供的signal()机制。

```
> man signal

     11    SIGSEGV      create core image    segmentation violation 
```

写入 NULL 指针可能会导致 SIGSEGV 信号

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-19T15:38:06.667

像这样的违规意味着代码存在严重错误，并且不可靠。我可以看到一个程序可能想要尝试以一种希望不会覆盖以前的数据的方式保存用户的数据，希望用户的数据还没有损坏，但是根据定义没有标准方法处理未定义的行为。

# c# - Silverlight：访问企业数据的最佳实践

> ID：457584
> 
> 赞同：2
> 
> 时间：2009-01-19T13:30:32.277
> 
> 标签：c#, silverlight, data-access

我开始为我公司的一个新项目整理一份系统架构文档。基本上，我们有一个相当大的业务层，它遵循企业库数据模式，我需要从一个新的 silverlight 应用程序访问这些数据对象。

我的问题是在 Silverlight 中访问这些对象的最佳方法是什么？我最初的想法是使用 WCF，但我不确定如何最好地重建客户端中的对象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T14:17:04.320

新的 .net 标准是 WCF（代号 indigo）

**性能** 您可以选择一些传输协议 tcp（最快）、http、https，具体取决于您的安全/消息加密级别。（还有一些，netpipe 等）

**我的项目的典型端点/服务布局，****每个版本**的服务 都有**一个**端点，所以如果它的版本 1，那么我用[http://localhost:8080/YourEnterpriseName/Project/Version1/结束它](http://localhost:8080/YourEnterpriseName/Project/Version1/)

 **我还发现，响应/请求方法是请求数据的最佳方式，其中您需要对服务器进行的每个调用都有 2 个类（一个请求，一个响应）。（使用 knowntype，我稍后再填写）

此外，Shawn Wildermuth 和 Miguel Castro 在 dnrtv [http://www.dnrtv.com/default.aspx?showNum=127](http://www.dnrtv.com/default.aspx?showNum=127) on Silverlight Data [http://www.dnrtv.com/default.aspx?showNum=122](http://www.dnrtv.com/default.aspx?showNum=122) on Extreme上做了播客WCF

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T14:06:11.703

查看这本书，[使用 Silverlight 2 的数据驱动服务](https://rads.stackoverflow.com/amzn/click/com/0596523092)。我发现这是解决这个问题的最佳资源。我所做的是创建一个轻量级 WCF 层，该层从现有 DAL 中检索对象，然后将这些对象传递回客户端。

# php - 在 php 中构建“多语言”脚本的最佳方法是什么？

> ID：457586
> 
> 赞同：8
> 
> 时间：2009-01-19T13:31:54.143
> 
> 标签：php, sql, xml, multilingual

我正在建立一个网站，它需要 7 种语言？我想知道是否有一个好的做法可以用来获取多语言的php脚本？

*   对我来说很容易
*   对翻译人员来说很容易

另外你认为，我应该将它存储在 DB、XML 还是 PHP 文件中？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-19T13:42:07.213

有很多用于存储翻译的选项：

*   [TMX](http://www.gala-global.org/lisa-oscar-standards)：一种相对较新的 XML 翻译格式。似乎越来越受欢迎。
*   [Gettext](http://www.gnu.org/software/gettext/)是另一种开放的翻译格式。长期以来一直是事实上的标准。
*   ini 文件 - 易于编辑，非常简单的格式
*   PHP 文件（数组） - PHP 程序员易于编辑，性能良好
*   CSV 格式 - 使用起来相对简单。

我建议您使用[Zend_Translate 之](http://framework.zend.com/manual/en/zend.translate.using.html)类的东西，它支持多个适配器并提供一种在应用程序中嵌入翻译的基本方法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-19T13:48:45.437

与 daddz 相反，我建议不要在 PHP 中使用 gettext：

*   区域设置是按进程设置的。这意味着当您使用多线程 apache 或任何其他在进程内运行 PHP 的多线程 Web 服务器时，在一个线程中调用 setlocale 将影响其他线程。

    因为您不知道哪个线程/进程正在处理哪个请求，所以您会遇到用户间歇性地获取错误语言环境的可怕问题。

*   您在 PHP 中设置的语言环境会影响函数`printf`，甚至`strtotime`. 如果您使用 gettext/setlocale，您肯定会被后端代码中的“奇怪”数字格式所吸引

使用 Eran 提供的任何其他解决方案，或者自己快速做一些事情（PHP 数组工作得很好）。还使用将在核心 PHP 5.3 中的 intl-extension 进行数字和日期格式化和整理。

在基于 Web 的解决方案上一遍又一遍地使用 gettext 证明就像打开众所周知的蠕虫罐头一样。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T13:36:46.600

我建议[Gettext](http://en.wikipedia.org/wiki/Gettext)。

它是跨平台的、开源的、广泛使用的并可用于 php：[PHP Gettext](http://php.net/manual/en/intro.gettext.php)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T18:54:51.090

我已经建立了多语言 CMS。所有内容都存储在数据库中，主表用于通用（不是特定语言的值），而单独的表用于特定语言的内容。

例如，让我们想象存储产品 - 我们有一个“产品”表（包含唯一 ID、创建日期、图像 url 等）和一个“产品本地”表（包含任何特定于语言的字段）。

使用这种方法很容易维护内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T14:00:26.303

我没有这方面的经验，`gettext`所以不评论这个话题，但我使用以下方法建立了一些多语言网站：

**方法一**

我不会说我的格式是最好的，只是它是有效的。我也用过数组。取决于内容的存储位置。

例如，我将有一个关联的文本数组，其中包含标识哪些文本的索引：

```
$text['english']['welcome'] = "Welcome to my site. blah blah blah";
$text['english']['login'] = "Please enter your username and password to login"; 
```

并且可能使用常量或配置变量设置您的语言。

**方法二**

我建立了两个具有相同结构和后端的站点，但每个站点都使用不同的数据库并单独维护`data_french`：`data_english`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-27T15:56:00.357

您可能会发现这篇关于该主题的文章很有趣：

[http://cubicspot.blogspot.com/2011/12/cross-platform-multilingual-support-in.html](http://cubicspot.blogspot.com/2011/12/cross-platform-multilingual-support-in.html)

作者提倡“懒惰的程序员”策略——只在需要多语言内容时才这样做——并且似乎推荐使用 IANA 语言代码的 PHP 数组方法。这篇文章虽然有点模糊。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-30T05:36:42.063

检查这个论坛。如果有人帮助您翻译，我认为您可能需要一种不同的方法。

[多语言 PHP 网站的最有效方法](https://stackoverflow.com/questions/2806886/most-efficient-approach-for-multilingual-php-website)

# java - 如何限制 Java webapp 中的登录尝试？

> ID：457590
> 
> 赞同：12
> 
> 时间：2009-01-19T13:33:23.003
> 
> 标签：java, login, throttling

我想实现一种有效的机制来限制我的 Java Web 应用程序中的登录尝试，以防止对用户帐户的暴力攻击。

[杰夫解释了原因，但没有解释如何。](http://www.codinghorror.com/blog/archives/001206.html)

Simon Willison[在 Python 中展示了 Django 的实现](http://simonwillison.net/2009/Jan/7/ratelimitcache/)：这对我没有帮助，因为我既不能使用 memcached，也不能使用 Django。

从头开始移植他的想法似乎也不是一件好事——我不想重新发明轮子。

我找到了一个[Java 实现](https://svn.igniterealtime.org/svn/repos/openfire/tags/openfire_3_6_0a/src/java/org/jivesoftware/admin/LoginLimitManager.java)，虽然它看起来很幼稚：它不是 LRU 缓存，而是在 15 分钟后清除所有条目。

EHCache 可能是 memcached 的替代方案，但我没有任何经验，如果此任务有更好的替代方案，我真的不想引入另一种技术。

那么，在 Java 中实现登录限制的好方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T13:52:25.867

我认为即使是 EHCache 也在用凝固汽油弹杀死一只苍蝇。问题很简单，实现也很简单。

我建议在顶层使用 servlet 过滤器，以便尽可能少地进行处理。

创建一个类来存储以下内容：

*   尝试次数（计数）
*   时间

现在，代码在一个 sunchronized 块中很简单：

```
if userid not in attemptMap:
    attemptMap.add ( userid, new attemptItem ( userid, 1, now ) )
else
    tmp = attemptMap.get ( userid )
    if (acquire lock for tmp) :
      if tmp.time + 30 > now :
          tmp.count = 0
          tmp.time = now
      tmp.count++
      if tmp.count > 3 :
          error=true
      release lock for tmp
    else : error=true 
```

就是这样（只要代码是同步的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T02:55:36.533

没有提到的一个是让他们在多次错误尝试后回答忘记密码的问题+输入他们的密码

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T13:45:25.817

我刚刚完成了由方面安全性运行的网络安全课程，其中提出的一个建议是在*任何*登录尝试中都包含一个自然延迟 - 理论是 1 或 2 秒的延迟对于真正的-user 但会严重阻碍暴力攻击。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T15:29:39.040

我使用了带有用户详细信息的登录尝试计数字段。当它达到 50 时，正确的密码将被拒绝，用户必须执行密码重置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T15:41:16.443

登录尝试之间的时间呈指数增长怎么办？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T04:11:09.547

EHCache 非常好，更重要的是不是由您编写的，因此您不必重新实现功能并且可能会出错。

我的解决方案将在登录代码中涉及 ​​EHCache 或更简单的东西（如果它是一个小应用程序并且我并不真正关心并发性能）。

您将存储每个 IP 的失败计数和时间戳。

*   每次您尝试登录时，请检查是否允许他们使用失败计数和时间戳。
*   每次您进行允许的登录尝试并失败时，将失败计数增加 1 并记录失败时间。
*   每次您进行允许的登录尝试并成功时，都会清除该 IP 的信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-06-17T08:36:28.323

保持错误的登录尝试次数，如果达到 N，则阻止用户并要求验证码或密码重置以继续。

# c++ - 你可以使用 Boost.Regex 来解析流吗？

> ID：457595
> 
> 赞同：10
> 
> 时间：2009-01-19T13:36:09.987
> 
> 标签：c++, regex, boost, stream

我在玩 Boost.Regex 来解析单词和数字的字符串。这是我到目前为止所拥有的：

```
#include <iostream>
#include <string>
#include <boost/foreach.hpp>
#include <boost/regex.hpp>
#include <boost/range.hpp>

using namespace std;
using namespace boost;

int main()
{
    regex re
    (
        "("
            "([a-z]+)|"
            "(-?[0-9]+(\\.[0-9]+)?)"
        ")"
    );

    string s = "here is a\t list of Words. and some 1239.32 numbers to 3323 parse.";
    sregex_iterator m1(s.begin(), s.end(), re), m2;

    BOOST_FOREACH (const match_results<string::const_iterator>& what, make_iterator_range(m1, m2)) {
        cout << ":" << what[1].str() << ":" << what.position(1) << ":" << what.length(1) << endl;
    }

    return 0;
} 
```

有没有办法告诉正则表达式从流而不是字符串解析？似乎应该可以使用任何迭代器。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T20:16:04.800

Boost.IOStreams 有一个[regex_filter](http://www.boost.org/doc/libs/1_55_0/libs/iostreams/doc/classes/regex_filter.html)允许对流执行相当于 regex_replace 的操作。但是，从实现来看，它似乎“作弊”，因为它只是将整个流加载到缓冲区中，然后在该缓冲区上调用 Boost.Regex。

可以通过Boost.Regex的“[部分匹配”支持对流的内容进行正则表达式搜索，而不必将其完全加载到内存中。](http://www.boost.org/doc/libs/1_55_0/libs/regex/doc/html/boost_regex/partial_matches.html)查看页面末尾的示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T15:23:46.960

regex_iterator 构造函数需要双向迭代器，但 std::istream_iterator 只是一个 InputIterator，因此您似乎无法对任何标准流类和/或对象（cin、ifstream 等）执行此操作。如果您有一个暴露双向迭代器的自定义流，它应该可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-20T07:29:38.330

有限状态机需要能够“备份”，以防它现在尝试的失败。这对于无法“备份”的输入迭代器来说是不可能的。

# cocoa-touch - UITextView 放入 UITableViewCell 时有时不显示内容

> ID：457596
> 
> 赞同：5
> 
> 时间：2009-01-19T13:36:21.467
> 
> 标签：cocoa-touch

我想知道是否还有其他人面临同样的问题。我在 UITableViewCell 中有一个 UITextView 字段。有时它不显示文本。当我单击或滚动表格视图时，它会出现。有什么猜测吗？

* * *

细节：

我在*viewDidLoad*方法中调用了一个方法，该方法调用 Web 服务来检索一些数据。收到数据后，我设置了*UILabel*和*UITextView*的值。*UILabel*值看起来很好，但*UITextView*（有时）在我移动到子视图或上下滚动以重新访问包含*UITextView*的区域之前不会显示该值。我在*UITableViewCell中显示**UILabel*和*UITextView*对象。*我在UILabel*和*UITextView*设置值后立即调用*[tableView reloadData]*，但我没有重新创建*UITableViewCell******.*****

 ***感谢您的回复和指点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-16T07:45:26.697

我通过调用解决了这个问题`[myTableView reloadData];`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-15T23:36:25.353

我或多或少遇到了同样的问题——自定义 UITableViewCell 子类中的 UITextView 在您触摸（并因此滚动）UITextView 之前不会显示其文本。这只会发生在表中的第一个单元格中。我不知道为什么会发生这种情况，但是只需以编程方式“轻推” UITextView 的 contentOffset 即可轻松解决该问题。

```
problemCell.textView.contentOffset = CGPointMake(0.0, 1.0);
problemCell.textView.contentOffset = CGPointMake(0.0, 0.0); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T09:39:43.967

这可能与 UITextView 和 UITableView 都是 UIScrollView 的子类有关。因此，您在滚动视图中有一个滚动视图，如果这是您的问题的原因，我不会感到惊讶。

如果您不需要编辑表格内的文本，只需使用多行 UILabel。

如果您绝对必须在 UITableView 中有一个 UITextView，也许禁用其中一个滚动也可以解决问题。（我认为属性名称是`scrollEnabled`or `scrollingEnabled`。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-15T15:14:34.357

确保您正在调用`[super viewWillAppear:]`并且`[super viewDidAppear:]`在您覆盖 viewWillAppear 或 viewDidAppear 的所有位置。

可能所有其他 viewDidWhatever 和 viewWillWhatever 方法也是如此。

您遇到的问题表明，当您第一次显示表格时，UITextView 没有收到将自己绘制在屏幕上的消息，但在需要刷新时确实收到了消息。

# web-services - Delphi 的另一个 WSDL 导入器？

> ID：457603
> 
> 赞同：4
> 
> 时间：2009-01-19T13:39:00.013
> 
> 标签：web-services, delphi, wsdl

Delphi(6-7-2005-2007-2009) Wsdl Importer 很糟糕 :( 我正在寻找另一个用于 delphi 的 wsdl 导入器。（如 Lazarus 的 Web 服务工具包）有人知道吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T15:14:34.907

你从[这里](http://cc.codegear.com/Item/24535)得到版本了吗，我在 D7 上遇到了一些问题，我从 Babet 那里得到了链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-09-07T15:09:23.593

The [Free Pascal Web Service Toolkit](http://wiki.lazarus.freepascal.org/Web_Service_Toolkit) seems to support Delphi as well:

> "Web Service Toolkit” is a web services package for FPC, Lazarus and Delphi; “Web Service Toolkit” is meant to ease web services consumption and creation by FPC, Lazarus and Delphi users.

It includes a WSDL importer wizard and a command-line importer:

![WSDL importer](https://i.stack.imgur.com/HUE4n.png) [http://wiki.lazarus.freepascal.org/images/2/24/Wst_lazarus_importer.PNG](http://wiki.lazarus.freepascal.org/images/2/24/Wst_lazarus_importer.PNG)

And a graphical type library editor:

[http://wiki.lazarus.freepascal.org/images/0/0a/Wst_type_lib_edtr.PNG](http://wiki.lazarus.freepascal.org/images/0/0a/Wst_type_lib_edtr.PNG)

# .net - 如何测量 .NET 中的代码性能？

> ID：457605
> 
> 赞同：50
> 
> 时间：2009-01-19T13:44:27.473
> 
> 标签：.net, performance, benchmarking

我正在使用 DateTime 对一行 C# 代码进行一些真正快速而肮脏的基准测试：

```
long lStart = DateTime.Now.Ticks;
// do something
long lFinish = DateTime.Now.Ticks; 
```

问题在于结果：

```
开始时间 [633679466564559902]
完成时间 [633679466564559902]

开始时间 [633679466564569917]
完成时间 [633679466564569917]

开始时间 [633679466564579932]
完成时间 [633679466564579932]

```

...等等。

鉴于开始时间和结束时间相同，Ticks 显然不够精细。

那么，我怎样才能更好地衡量性能呢？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-19T13:48:27.730

该类`Stopwatch`自 .NET 2.0 起可用，是实现此目的的最佳方式。它是一个非常高性能的计数器，精确到几分之一毫秒。看一下[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)，很清楚。

编辑：如前所述，建议多次运行代码以获得合理的平均时间。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-19T13:46:47.673

重复执行你的代码。问题似乎是您的代码执行速度比测量仪器的粒度要快得多。最简单的解决方案是多次执行您的代码（数千次，也许是数百万次），然后计算平均执行时间。

编辑：此外，由于当前优化编译器（以及 CLR 和 JVM 等虚拟机）的性质，测量单行代码的执行速度可能会非常误导，因为测量会对速度产生很大影响. 更好的方法是分析整个系统（或至少更大的块）并检查瓶颈在哪里。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-27T01:01:19.680

我觉得这些很有用

[http://accelero.codeplex.com/SourceControl/changeset/view/22633#290971](http://accelero.codeplex.com/SourceControl/changeset/view/22633#290971) [http://accelero.codeplex.com/SourceControl/changeset/view/22633#290973](http://accelero.codeplex.com/SourceControl/changeset/view/22633#290973) [http://accelero.codeplex.com/SourceControl/变更集/视图/22633#290972](http://accelero.codeplex.com/SourceControl/changeset/view/22633#290972)

TickTimer 是 Stopwatch 的精简副本，它在构建时启动并且不支持重新启动。如果当前硬件不支持高分辨率计时，它也会通知您（秒表吞下了这个问题）

所以这

```
var tickTimer = new TickTimer();
//call a method that takes some time
DoStuff();
tickTimer.Stop();
Debug.WriteLine("Elapsed HighResElapsedTicks " + tickTimer.HighResElapsedTicks);
Debug.WriteLine("Elapsed DateTimeElapsedTicks " + tickTimer.DateTimeElapsedTicks);
Debug.WriteLine("Elapsed ElapsedMilliseconds " + tickTimer.ElapsedMilliseconds);
Debug.WriteLine("Start Time " + new DateTime(tickTimer.DateTimeUtcStartTicks).ToLocalTime().ToLongTimeString()); 
```

会输出这个

```
Elapsed HighResElapsedTicks 10022886
Elapsed DateTimeElapsedTicks 41896
Elapsed ElapsedMilliseconds 4.18966178849554
Start Time 11:44:58 
```

DebugTimer 是 TickTimer 的包装器，它将结果写入 Debug。（注意：它支持 Disposable 模式）

所以这

```
using (new DebugTimer("DoStuff"))
{
    //call a method that takes some time
    DoStuff();
} 
```

将其输出到调试窗口

```
DoStuff: Total 3.6299 ms 
```

IterationDebugTimer 用于计时多次运行操作并将结果写入 Debug 所需的时间。它还将执行不包括在内的初始运行，以忽略启动时间。（注意：它支持 Disposable 模式）

所以这

```
int x;
using (var iterationDebugTimer = new IterationDebugTimer("Add", 100000))
{
    iterationDebugTimer.Run(() =>
    {
        x = 1+4;
    });
} 
```

会输出这个

```
Add: Iterations 100000 
Total 1.198540 ms 
Single 0.000012 ms 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-19T21:01:17.543

只是为了补充其他人已经说过的关于使用秒表和测量平均值的内容。

确保在测量之前调用您的方法。否则，您还将测量 JIT 编译代码所需的时间。这可能会严重扭曲您的数字。

此外，请确保您测量发布模式代码，因为调试版本的优化默认关闭。调整调试代码是没有意义的恕我直言。

并确保你测量的是你真正想要测量的东西。当优化开始时，编译器/JIT 编译器可能会重新排列代码或将其完全删除，因此您最终可能会测量出与预期略有不同的东西。至少看看生成的代码以确保代码没有被剥离。

根据您要测量的内容，请记住，真实系统对运行时的压力不同于典型的测试应用程序。一些性能问题与例如对象如何被垃圾收集有关。这些问题通常不会出现在简单的测试应用程序中。

实际上，最好的建议是使用真实数据来衡量真实系统，因为沙盒测试可能会变得非常不准确。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-12-15T13:11:04.083

[https://andreyakinshin.gitbooks.io/performancebookdotnet/content/science/microbenchmarking.html](https://andreyakinshin.gitbooks.io/performancebookdotnet/content/science/microbenchmarking.html)

[https://github.com/PerfDotNet/BenchmarkDotNet](https://github.com/PerfDotNet/BenchmarkDotNet)

“确实，微基准测试非常困难。如果一个操作需要 10-100ns，那么操作测量是一个很大的挑战。我建议您使用 BenchmarkDotNet 进行基准测试。它是一个可以帮助您进行诚实基准测试并获得测量结果的库良好的精度。当然，您可以编写自己的基准测试而不需要任何额外的库。在本节中，我们将讨论为什么它可能是一个坏主意以及在开始之前您应该了解的内容。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-19T13:47:15.627

使用真正的分析器，例如[dotTrace](https://www.jetbrains.com/profiler/)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-19T13:50:21.097

`Stopwatch`假设您使用的是 .NET 2.0 或更高版本，则可以使用.

```
System.Diagnostics.Stopwatch.StartNew(); 
```

该类`Stopwatch`还具有公共只读字段[`IsHighResolution`](https://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.ishighresolution.aspx)，可以让您知道秒表是否基于高分辨率性能计数器。如果不是，则基于系统计时器。

我不确定秒表基于高分辨率性能计数器需要什么。有一些 API 调用，但我认为如果秒表不使用高分辨率，那么 API 可能不存在。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-19T13:50:59.177

查看[Is DateTime.Now 是衡量函数性能的最佳方法的答案吗？](https://stackoverflow.com/questions/28637/is-datetime-now-the-best-way-to-measure-a-functions-performance#28648)如需解释或阅读我[关于高性能测量的博客文章](http://blog.freakcode.com/2008/09/high-precision-performance-measurement.html)

问题是 DateTime 的分辨率约为 15ms，不能比这更精确了。然而，秒表可以。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-08-08T16:41:30.030

`Stopwatch`课堂样本

```
 using System.Diagnostics;
    ......
    ...
    ..
    Stopwatch sw = new Stopwatch();
    sw.Start();
    //Your Code Here

    sw.Stop();
    Console.WriteLine("Elapsed={0}",sw.Elapsed); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-19T14:24:03.807

这是 MSDN 上关于如何[为 Windows 实现持续更新、高分辨率时间提供程序的一篇不错的文章](http://msdn.microsoft.com/en-us/magazine/cc163996.aspx)

这是本文的[示例源代码](http://download.microsoft.com/download/8/7/4/8742bb70-c5c1-4833-80b2-6bcf2fadf69b/HighResolutionTimer.exe)(C++)。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-05-02T20:16:56.503

我的偏好是 @Evgeniy 提到的 BenchmarkDotNet [。](https://github.com/dotnet/BenchmarkDotNet)可能他的回复被绕过了，因为没有代码片段，但由于这是一个复杂的项目，因此至少值得先看看库，然后再去定制一些东西。

因为有些代码总是引人注目，这里是引用站点的示例：

```
using System;
using System.Security.Cryptography;
using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

namespace MyBenchmarks
{
    [ClrJob(baseline: true), CoreJob, MonoJob, CoreRtJob]
    [RPlotExporter, RankColumn]
    public class Md5VsSha256
    {
        private SHA256 sha256 = SHA256.Create();
        private MD5 md5 = MD5.Create();
        private byte[] data;

        [Params(1000, 10000)]
        public int N;

        [GlobalSetup]
        public void Setup()
        {
            data = new byte[N];
            new Random(42).NextBytes(data);
        }

        [Benchmark]
        public byte[] Sha256() => sha256.ComputeHash(data);

        [Benchmark]
        public byte[] Md5() => md5.ComputeHash(data);
    }

    public class Program
    {
        public static void Main(string[] args)
        {
            var summary = BenchmarkRunner.Run<Md5VsSha256>();
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-02-18T19:12:15.950

另一种选择是使用[Fody](https://github.com/Fody/Fody)自动插入计时器代码。这使您的代码更易于阅读，因为它分离了您的横切关注点。我认为这接近于所谓的[面向方面编程](https://en.wikipedia.org/wiki/Aspect-oriented_programming)，但在编译后完成。

有关执行方法计时的 fody 插件，请参阅[https://github.com/Fody/MethodTimer 。](https://github.com/Fody/MethodTimer)

*引用自述文件：*

**使用拦截器，在您的程序集中的某处：**

```
public static class MethodTimeLogger {
  public static void Log(MethodBase methodBase, long milliseconds)
  {
    //Do some logging here
  } 
} 
```

**你的代码，**

```
public class MyClass
{
    [Time]
    public void MyMethod()
    {
        //Some code u are curious how long it takes
        Console.WriteLine("Hello");
    }
} 
```

**编译成这样：**

```
public class MyClass
{
    public void MyMethod()
    {
        var stopwatch = Stopwatch.StartNew();
        try
        {
            //Some code u are curious how long it takes
            Console.WriteLine("Hello");
        }
        finally
        {
            stopwatch.Stop();
            MethodTimeLogger.Log(methodof(MyClass.MyMethod), stopwatch.ElapsedMilliseconds);
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-07-24T11:49:18.157

一次性风格`Stopwatch`最适合我。

```
class VWatch : IDisposable {
    Stopwatch watch = new Stopwatch();
    public VWatch() {
        this.watch.Start();
    }
    public void Dispose() {
        this.watch.Stop();
        Console.WriteLine("Finished. Elapsed={0}", this.watch.Elapsed);
    }
} 
```

进而：

```
using (new VWatch()) {
    /// do something for time measurement
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-19T20:39:21.443

有时最好看看为什么需要对操作进行计时？它运行缓慢吗？或者你只是好奇？优化的第一条规则是“不要这样做”。因此，根据您实际测量的内容，可能会改变对哪种工具最适合该任务的看法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-07-27T14:12:55.157

最容易使用像[ANTS Performance Profiler](http://www.red-gate.com/products/dotnet-development/ants-performance-profiler)这样的分析器，或者其他可用的分析器之一。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-08-14T12:31:41.493

我做了一个从滴答声返回毫秒的扩展。

```
public static int GetTotalRunningTimeInMilliseconds(this DateTime start)
{
    var endTicks = DateTime.Now.Ticks - start.Ticks;
    return TimeSpan.FromTicks(endTicks).Milliseconds;
} 
```

用法：

```
 var start = DateTime.Now;

 //...your long running code here

 var endTime = start.GetTotalRunningTimeInMilliseconds(); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-12-14T11:11:27.530

我做了一个非常简单的方法来测量[Action](https://docs.microsoft.com/en-gb/dotnet/api/system.action?view=netframework-4.5)的执行速度，这对我来说有好处，我可以在需要时重用它，以及我必须测量的任何代码。

对我来说，一个 DateTime 就足够了，但它很容易从 DateTime 适应到[Stopwatch](https://docs.microsoft.com/en-gb/dotnet/api/system.diagnostics.stopwatch?view=netframework-4.5)。

```
public static TimeSpan MeasureTime(Action action)
{
    DateTime start = DateTime.Now;

    if (action == null)
    {
        throw new ArgumentNullException("action");
    }

    try
    {
        action();
    }
    catch (Exception ex)
    {
        Debugger.Log(1, "Measuring",ex.ToString());
    }

    return DateTime.Now - start;
} 
```

* * *

如何使用它？：

```
private static void StressTest()
{
    List<TimeSpan> tss = new List<TimeSpan>();

    for (int i = 0; i < 100; i++)
    {
        // here is the measuring:
        var ts = MeasureTime(() => instance.Method("param1"));

        tss.Add(ts);
    }

    Console.WriteLine("Max: {0}", tss.Max());
    Console.WriteLine("Min: {0}", tss.Min());
    Console.WriteLine("Avg: {0}", TimeSpan.FromMilliseconds(tss.Average(i => i.TotalMilliseconds)));
} 
```

或者：

```
var ts = MeasureTime(() =>
                        {
                            // Some intensive stuff here
                            int a = 1;

                            // more here
                            int b = 2;

                            // and so on
                        }); 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2015-09-10T06:48:08.723

为了通过测量之间的差异来衡量性能，我使用了这个类。StopWatch 类没有该`Split`方法。

```
/// <summary>
/// Stopwatch like class that keeps track of timelapses.
/// Probably low-res because of the usage of DateTime.
/// </summary>
public class ChronoMeter
{
    /// <summary>
    /// The name given when the Chronometer was constructed.
    /// </summary>
    public string Name { get; private set; }
    /// <summary>
    /// The moment in time Start was called.
    /// </summary>
    public DateTime Started { get; private set; }

    /// <summary>
    /// All time recordings are added to this list by calling Split and Stop.
    /// </summary>
    public List<ChronoRecord> Records { get; private set; }

    private readonly Stopwatch _stopWatch = new Stopwatch();

    private bool _hasBeenStopped = false;

    /// <summary>
    /// Constrcutor
    /// </summary>
    /// <param name="pName">The name is used in logging</param>
    /// <param name="pLoggingType">The type of logging appriate for the information yielded by this time recording.</param>
    public ChronoMeter(string pName)
    {
        Name = pName;
        Records = new List<ChronoRecord>();
    }

    /// <summary>
    /// Not calling Stop is bad practise. Therefore a little safety net zo the end is still recorderd.
    /// Keep in mind that the garbase collector invokes the destructor, so the moment of time probably doesn't make much sense.
    /// It is more to notify that you should have used Stop for the latest split.
    /// </summary>
    ~ChronoMeter()
    {
        if (!_hasBeenStopped)
        {
            Stop("Destructor safety net");
        }
    }

    /// <summary>
    /// TimeElapsedSinceStart of a ChronoRecord is relative to the moment ChronoMeter was started by calling this function.
    /// </summary>
    public void Start()
    {
        _stopWatch.Start();
        Started = DateTime.Now;
    }

    /// <summary>
    /// Splits the timerecording and add a record of this moment to the list of split records.
    /// </summary>
    /// <param name="pSplitName"></param>
    public void Split(string pSplitName)
    {
        _stopWatch.Stop();
        var created = Started + _stopWatch.Elapsed;
        var previousRecord = Records.LastOrDefault();
        Records.Add(new ChronoRecord(pSplitName, Started, created, previousRecord));
        _stopWatch.Start();
    }

    /// <summary>
    /// Indicates you are done and the records will be written to the log.
    /// </summary>
    public void Stop(string pSplitName)
    {
        Split(pSplitName);
        _stopWatch.Stop();
        _hasBeenStopped = true;
    }

    public class ChronoRecord
    {
        public string Name { get; private set; }
        public TimeSpan TimeElapsedSinceStart { get; private set; }
        public TimeSpan TimeElapsedSincePrevious { get; private set; }
        public DateTime Start { get; private set; }
        public DateTime Created { get; private set; }

        public ChronoRecord(string pName, DateTime pStartDateTime, DateTime pCreated, ChronoRecord pPreviousRecord=null)
        {
            if (pCreated == default(DateTime)) //Ignore DefaultDateTimeComparison
            {
                pCreated = DateTime.Now;
            }
            Created = pCreated;
            Name = pName;
            Start = pStartDateTime;

            TimeElapsedSinceStart = Created - Start;
            if (pPreviousRecord != null)
            {
                TimeElapsedSincePrevious = Created - pPreviousRecord.Created;
            }
            else
            {
                TimeElapsedSincePrevious = TimeElapsedSinceStart;
            }
        }
    }
} 
```

# c++ - 钻石继承和纯虚函数

> ID：457609
> 
> 赞同：7
> 
> 时间：2009-01-19T13:46:44.817
> 
> 标签：c++, function, inheritance, virtual

想象一下标准的钻石继承。A 类定义了纯虚函数 fx，B 类定义了 fx 的实现，C 类和 D 类对 fx 没有任何作用。当尝试在 D 类的实例上调用 fx 时，您将收到“模糊函数调用”错误，尽管 fx 只有一种实现。这可以通过 B 和 C 以虚拟方式从 A 继承来解决。这是解决问题的*正确*方法吗？虚拟继承究竟如何处理虚函数表的合并？

A--->B--->D

\--->C--------^

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-19T14:02:51.493

... 注意，Herb Sutter 写了 3 篇关于多重继承的优秀文章[(1) here](http://www.gotw.ca/gotw/037.htm)，[(2) here](http://www.gotw.ca/gotw/038.htm)和[(3) here](http://www.gotw.ca/gotw/039.htm)。[他在这里](http://www.gotw.ca/gotw/)的本周大师中写了一大堆有用的文章。强烈推荐 ...

首先，我不确定我的层次结构是否正确。我认为它是这样的：

```
struct A {
    virtual void F() = 0;
};

struct B : A { void F() { } };
struct C : A { };
struct D : B, C { }; 
```

`A`嗯，D 是抽象的，因为在 D 类型的对象中有两个子对象：一个`B`通过 B 的格子变得具体，另一个在通过的格子中仍然是抽象的`C`。我认为你有一个指针`D`并尝试调用`F`. 是的，出现了歧义，因为编译器`F`在两个单独的格中找到了两个函数：

```
D -> B::F
D -> C -> A::F 
```

看起来像这样：

```
 F()   F()
     A     A
     |     |
 F() B     C
      \   /
        D 
```

您可以通过虚拟地从 A 派生来正式解决这种情况：

```
struct B : virtual A { void F() { } };
struct C : virtual A { };
struct D : B, C { }; 
```

然后你有这种情况，称为钻石继承：

```
 F()  
        A
      /   \
 F() B     C
      \   /
        D 
```

并进行查找，它发现有`B::F`覆盖`A::F`。虽然`A::F`仍然可以通过 到达`D::C::A`，但这不再是一个歧义，因为`A`是继承的 virtual。

这是否是您特定问题的正确解决方案 - 当然不确定。通常有比从类派生虚拟更好的方法。关于合并虚函数表的问题 - 这完全取决于实现。，据我所知，如果我们派生虚拟`GCC`，它将在 的虚拟表中保留一个指向 A 实例的指针。`D`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T13:58:34.043

> 这是解决问题的*正确*方法吗？

“钻石”继承是有问题的，解决方案的*正确*解释需要一点解释。*我建议您阅读 Meyers 的Effective C++*的以下章节：

*   第 26 条，*防范潜在的歧义*
*   第 43 条，*明智地使用多重继承*。

# spring - websphere portal 6.1 开发 - 使用哪个 web 框架？

> ID：457614
> 
> 赞同：1
> 
> 时间：2009-01-19T13:47:26.580
> 
> 标签：spring, frameworks, websphere, portal, appfuse

我正在使用 websphere 门户服务器 6.1 开始一个门户项目。这涉及很多 portlet，我倾向于使用 JSR286 规范而不是 JSR168

另外，我想使用 Spring Portlet MVC，但 3.0 版本仍在 M2 中，并且没有为添加的新功能提供适当的文档。

我应该开始使用 Spring v2.5.6 并稍后迁移吗？以后会不会涉及很多返工？

有更好的选择吗？

另外，是否有像 AppFuse 这样的预打包框架？

谢谢，

高拉夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:16:06.853

我认为您应该查看 Spring Portlet MVC 的路线图，也许您可​​以开始使用 M2 版本并稍后升级。如果您打算使用 AJAX，那么 286 规范为 portlet 提供了 AJAX 支持（资源 url），而 168 规范则必须使用 servlet 来破解。另一个区别是事件体系结构，其中 portlet 可以使用 jsr 286 api 进行通信，而 168 则不能直接使用。

我知道struts 的人也打算做一个[286](http://boss.bekk.no/display/BOSS/Struts+2+Portlet+2.0+Plugin)插件。花点时间权衡利弊。

作为最后一点，我建议您使用轻量级门户进行开发，然后在 websphere 上进行部署（尽管您的 portlet 必须完全兼容），因为众所周知 webspehere 速度很慢。

# c++ - 编译 c++ dll 时选择哪个字符集

> ID：457620
> 
> 赞同：3
> 
> 时间：2009-01-19T13:48:32.317
> 
> 标签：c++, character-encoding

有人可以提供一些有关 Visual Studio 项目属性表中不同字符集的信息。

选项有：
无
Unicode
多字节

我想就选择哪个做出明智的决定。
谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T14:02:38.310

所有新软件都应启用 Unicode。对于 Windows 应用程序，这意味着 UTF-16 字符集，对于几乎所有其他人来说，UTF-8 通常是最佳选择。Windows 编程中的其他字符集选择只能用于与旧应用程序的兼容性。它们不支持与 Unicode 相同的字符范围。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T14:08:24.523

`Multibyte`每个字符恰好占用 2 个字节，`none`恰好是 1，`unicode`不同。

`None`不好，因为它不支持非拉丁符号。如果一些非英语用户试图将他们的名字输入到编辑框中，这是非常无聊的。不要使用`none`.

如果您不使用自定义计算字符串长度，从程序员的角度来看`multibyte`，`unicode`只要使用`TEXT`宏来包装您的字符串常量，就不会有所不同。

一些库明确要求某些编码（`DirectShow`等），只需使用他们想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T09:41:37.367

正如 Shiny 先生所建议的那样，Unicode 是正确的选择。如果您想进一步了解该决定的含义，请查看此处：[http ://www.mihai-nita.net/article.php?artID=20050306b](http://www.mihai-nita.net/article.php?artID=20050306b)

# sql-server - 将列从 varchar 转换为 nvarchar 是否会更改存储在列中的字符串的编码？

> ID：457628
> 
> 赞同：0
> 
> 时间：2009-01-19T13:51:36.570
> 
> 标签：sql-server, character-encoding

如果我有一个仅包含 varchar 列的数据库，字符串以 Latin-1 编码（并相应地设置了排序规则），将使用 ALTER TABLE 命令将列转换为 nvarchar 将列内容的编码更改为 unicode (UTF-16)，或者我必须自己转换它们吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T13:59:36.710

是的，编码将被更改。你不必转换任何东西。

# java - 如何从 Java 方法返回多个对象？

> ID：457629
> 
> 赞同：188
> 
> 时间：2009-01-19T13:51:44.213
> 
> 标签：java, return

我想从 Java 方法返回两个对象，想知道这样做的好方法是什么？

我能想到的可能方法是：返回一个`HashMap`（因为这两个对象是相关的）或返回一个`ArrayList`对象`Object`。

更准确地说，我要返回的两个对象是（a）`List`对象和（b）逗号分隔的相同名称。

我想从一种方法返回这两个对象，因为我不想遍历对象列表以获取逗号分隔的名称（我可以在此方法的同一循环中执行此操作）。

不知何故，返回 a`HashMap`看起来不是一种非常优雅的方式。

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2009-01-19T13:58:01.720

如果要返回两个对象，通常希望返回封装这两个对象的单个对象。

你可以像这样返回一个`NamedObject`对象列表：

```
public class NamedObject<T> {
  public final String name;
  public final T object;

  public NamedObject(String name, T object) {
    this.name = name;
    this.object = object;
  }
} 
```

然后你可以轻松地返回一个`List<NamedObject<WhateverTypeYouWant>>`.

另外：为什么要返回以逗号分隔的名称列表而不是`List<String>`? 或者更好的是，返回 a `Map<String,TheObjectType>`，键是对象的名称和值（除非您的对象已指定顺序，在这种情况下， a`NavigableMap`可能是您想要的。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2009-01-19T14:09:11.853

如果你知道你将返回两个对象，你也可以使用一个泛型对：

```
public class Pair<A,B> {
    public final A a;
    public final B b;

    public Pair(A a, B b) {
        this.a = a;
        this.b = b;
    }
}; 
```

**编辑**上述更完整的实现：

```
package util;

public class Pair<A,B> {

    public static <P, Q> Pair<P, Q> makePair(P p, Q q) {
        return new Pair<P, Q>(p, q);
    }

    public final A a;
    public final B b;

    public Pair(A a, B b) {
        this.a = a;
        this.b = b;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((a == null) ? 0 : a.hashCode());
        result = prime * result + ((b == null) ? 0 : b.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        @SuppressWarnings("rawtypes")
        Pair other = (Pair) obj;
        if (a == null) {
            if (other.a != null) {
                return false;
            }
        } else if (!a.equals(other.a)) {
            return false;
        }
        if (b == null) {
            if (other.b != null) {
                return false;
            }
        } else if (!b.equals(other.b)) {
            return false;
        }
        return true;
    }

    public boolean isInstance(Class<?> classA, Class<?> classB) {
        return classA.isInstance(a) && classB.isInstance(b);
    }

    @SuppressWarnings("unchecked")
    public static <P, Q> Pair<P, Q> cast(Pair<?, ?> pair, Class<P> pClass, Class<Q> qClass) {

        if (pair.isInstance(pClass, qClass)) {
            return (Pair<P, Q>) pair;
        }

        throw new ClassCastException();

    }

} 
```

注释，主要是关于 Java 和泛型的生锈：

*   两者都是不可变`a`的`b`。
*   `makePair`static 方法可以帮助您进行样板类型，Java 7 中的菱形运算符将减少烦人。有一些工作可以使这个非常好：泛型，但现在应该没问题。（参见 PECS）
*   `hashcode`并由`equals`eclipse生成。
*   该`cast`方法中的编译时间转换是可以的，但似乎不太正确。
*   我不确定是否需要通配符`isInstance`。
*   我只是为了回应评论而写的，仅用于说明目的。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2013-04-03T20:42:29.833

如果您调用的方法是私有的，或者从一个位置调用，请尝试

```
return new Object[]{value1, value2}; 
```

调用者看起来像：

```
Object[] temp=myMethod(parameters);
Type1 value1=(Type1)temp[0];  //For code clarity: temp[0] is not descriptive
Type2 value2=(Type2)temp[1]; 
```

David Hanak 的 Pair 示例没有语法优势，并且仅限于两个值。

```
return new Pair<Type1,Type2>(value1, value2); 
```

调用者看起来像：

```
Pair<Type1, Type2> temp=myMethod(parameters);
Type1 value1=temp.a;  //For code clarity: temp.a is not descriptive
Type2 value2=temp.b; 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2016-02-18T17:43:39.107

您可以使用以下任何一种方式：

```
private static final int RETURN_COUNT = 2;
private static final int VALUE_A = 0;
private static final int VALUE_B = 1;
private static final String A = "a";
private static final String B = "b"; 
```

1) 使用**数组**

```
private static String[] methodWithArrayResult() {
    //...
    return new String[]{"valueA", "valueB"};
}

private static void usingArrayResultTest() {
    String[] result = methodWithArrayResult();
    System.out.println();
    System.out.println("A = " + result[VALUE_A]);
    System.out.println("B = " + result[VALUE_B]);
} 
```

2) 使用**数组列表**

```
private static List<String> methodWithListResult() {
    //...
    return Arrays.asList("valueA", "valueB");
}

private static void usingListResultTest() {
    List<String> result = methodWithListResult();
    System.out.println();
    System.out.println("A = " + result.get(VALUE_A));
    System.out.println("B = " + result.get(VALUE_B));
} 
```

3) 使用**哈希映射**

```
private static Map<String, String> methodWithMapResult() {
    Map<String, String> result = new HashMap<>(RETURN_COUNT);
    result.put(A, "valueA");
    result.put(B, "valueB");
    //...
    return result;
}

private static void usingMapResultTest() {
    Map<String, String> result = methodWithMapResult();
    System.out.println();
    System.out.println("A = " + result.get(A));
    System.out.println("B = " + result.get(B));
} 
```

4）使用您的**自定义容器类**

```
private static class MyContainer<M,N> {
    private final M first;
    private final N second;

    public MyContainer(M first, N second) {
        this.first = first;
        this.second = second;
    }

    public M getFirst() {
        return first;
    }

    public N getSecond() {
        return second;
    }

    // + hashcode, equals, toString if need
}

private static MyContainer<String, String> methodWithContainerResult() {
    //...
    return new MyContainer("valueA", "valueB");
}

private static void usingContainerResultTest() {
    MyContainer<String, String> result = methodWithContainerResult();
    System.out.println();
    System.out.println("A = " + result.getFirst());
    System.out.println("B = " + result.getSecond());
} 
```

5) 使用**AbstractMap.simpleEntry**

```
private static AbstractMap.SimpleEntry<String, String> methodWithAbstractMapSimpleEntryResult() {
    //...
    return new AbstractMap.SimpleEntry<>("valueA", "valueB");
}

private static void usingAbstractMapSimpleResultTest() {
    AbstractMap.SimpleEntry<String, String> result = methodWithAbstractMapSimpleEntryResult();
    System.out.println();
    System.out.println("A = " + result.getKey());
    System.out.println("B = " + result.getValue());
} 
```

6) 使用一**对****Apache Commons**

```
private static Pair<String, String> methodWithPairResult() {
    //...
    return new ImmutablePair<>("valueA", "valueB");
}

private static void usingPairResultTest() {
    Pair<String, String> result = methodWithPairResult();
    System.out.println();
    System.out.println("A = " + result.getKey());
    System.out.println("B = " + result.getValue());
} 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-01-19T14:09:42.307

当我用 Java 编码时，我几乎总是最终定义 n-Tuple 类。例如：

```
public class Tuple2<T1,T2> {
  private T1 f1;
  private T2 f2;
  public Tuple2(T1 f1, T2 f2) {
    this.f1 = f1; this.f2 = f2;
  }
  public T1 getF1() {return f1;}
  public T2 getF2() {return f2;}
} 
```

我知道这有点难看，但它可以工作，你只需要定义一次元组类型。元组是 Java 真正缺乏的东西。

编辑：David Hanak 的例子更优雅，因为它避免定义 getter 并且仍然保持对象不可变。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-01-19T13:59:03.607

在 Java 5 之前，我有点同意 Map 解决方案并不理想。它不会为您提供编译时类型检查，因此可能会在运行时导致问题。但是，在 Java 5 中，我们有了泛型类型。

因此，您的方法可能如下所示：

```
public Map<String, MyType> doStuff(); 
```

MyType 当然是您要返回的对象的类型。

基本上我认为在这种情况下返回 Map 是正确的解决方案，因为这正是您想要返回的 - 字符串到对象的映射。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-02-04T18:57:55.663

Apache Commons 为此提供了元组和三元组：

*   `ImmutablePair<L,R>` 由两个 Object 元素组成的不可变对。
*   `ImmutableTriple<L,M,R>` 由三个 Object 元素组成的不可变三元组。
*   `MutablePair<L,R>` 由两个 Object 元素组成的可变对。
*   `MutableTriple<L,M,R>` 由三个 Object 元素组成的可变三元组。
*   `Pair<L,R>` 由两个元素组成的一对。
*   `Triple<L,M,R>` 由三个元素组成的三元组。

来源：[https ://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/package-summary.html](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/package-summary.html)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-01-19T14:28:40.893

或者，在我想从一个方法返回许多东西的情况下，我有时会使用回调机制而不是容器。这在我无法提前指定将生成多少对象的情况下非常有效。

对于您的特定问题，它看起来像这样：

```
public class ResultsConsumer implements ResultsGenerator.ResultsCallback
{
    public void handleResult( String name, Object value )
    {
        ... 
    }
}

public class ResultsGenerator
{
    public interface ResultsCallback
    {
        void handleResult( String aName, Object aValue );
    }

    public void generateResults( ResultsGenerator.ResultsCallback aCallback )
    {
        Object value = null;
        String name = null;

        ...

        aCallback.handleResult( name, value );
    }
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2017-06-01T16:24:45.457

虽然在您的情况下，[评论](https://stackoverflow.com/questions/457629/how-to-return-multiple-objects-from-a-java-method#comment7726206_457629)可能是一个不错的选择，但在 Android 中，您可以使用[`Pair`](https://developer.android.com/reference/android/util/Pair.html) . 简单地

```
return new Pair<>(yourList, yourCommaSeparatedValues); 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-03-29T09:58:47.720

使用以下条目对象示例：

```
public Entry<A,B> methodname(arg)
{
.......

return new AbstractMap.simpleEntry<A,B>(instanceOfA,instanceOfB);
} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2013-12-12T13:47:45.753

关于一般的多个返回值的问题，我通常使用一个小的帮助类来包装单个返回值并作为参数传递给方法：

```
public class ReturnParameter<T> {
    private T value;

    public ReturnParameter() { this.value = null; }
    public ReturnParameter(T initialValue) { this.value = initialValue; }

    public void set(T value) { this.value = value; }
    public T get() { return this.value; }
} 
```

（对于原始数据类型，我使用较小的变化来直接存储值）

一个想要返回多个值的方法将被声明如下：

```
public void methodThatReturnsTwoValues(ReturnParameter<ClassA> nameForFirstValueToReturn, ReturnParameter<ClassB> nameForSecondValueToReturn) {
    //...
    nameForFirstValueToReturn.set("...");
    nameForSecondValueToReturn.set("...");
    //...
} 
```

也许主要的缺点是调用者必须提前准备返回对象以防他想使用它们（并且该方法应该检查空指针）

```
ReturnParameter<ClassA> nameForFirstValue = new ReturnParameter<ClassA>();
ReturnParameter<ClassB> nameForSecondValue = new ReturnParameter<ClassB>();
methodThatReturnsTwoValues(nameForFirstValue, nameForSecondValue); 
```

优点（与提出的其他解决方案相比）：

*   您不必为各个方法及其返回类型创建特殊的类声明
*   参数有一个名称，因此在查看方法签名时更容易区分
*   每个参数的类型安全

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-19T13:58:15.263

所有可能的解决方案都将是一个杂项（如容器对象、您的 HashMap 想法、通过数组实现的“多个返回值”）。我建议从返回的列表中重新生成逗号分隔的列表。代码最终会变得更干净。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-09-22T19:21:49.110

保持简单并为多个结果情况创建一个类。此示例接受一个 ArrayList 和来自 databasehelper getInfo 的消息文本。

您在哪里调用返回您编码的多个值的例程：

```
multResult res = mydb.getInfo(); 
```

在例程 getInfo 中，您编写代码：

```
ArrayList<String> list= new ArrayList<String>();
add values to the list...
return new multResult("the message", list); 
```

并定义一个类 multResult ：

```
public class multResult {
    public String message; // or create a getter if you don't like public
    public ArrayList<String> list;
    multResult(String m, ArrayList<String> l){
        message = m;
        list= l;
} 
```

}

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-19T14:05:06.560

正如我所看到的，这里实际上有三个选择，解决方案取决于上下文。您可以选择在生成列表的方法中实现名称的构造。这是您选择的选择，但我认为这不是最好的选择。您正在生产者方法中创建与不需要存在的消费方法的耦合。其他呼叫者可能不需要额外信息，您将为这些呼叫者计算额外信息。

或者，您可以让调用方法计算名称。如果只有一个呼叫者需要此信息，您可以停止。您没有额外的依赖关系，虽然涉及一些额外的计算，但您避免了使您的构造方法过于具体。这是一个很好的权衡。

最后，您可以让列表本身负责创建名称。如果计算需要由多个调用者完成，这是我会走的路线。我认为这将负责创建与对象本身最密切相关的类的名称。

在后一种情况下，我的解决方案是创建一个专门的 List 类，该类返回它包含的对象名称的逗号分隔字符串。使类足够聪明，以便在添加和删除对象时动态构造名称字符串。然后返回这个列表的一个实例，并根据需要调用名称生成方法。尽管将名称的计算简单地延迟到第一次调用该方法并随后存储它（延迟加载）可能几乎同样有效（并且更简单）。如果您添加/删除一个对象，您只需要删除计算值并在下一次调用时重新计算它。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2013-05-21T00:54:34.727

可以做一些像动态语言（Python）中的元组之类的事情

```
public class Tuple {
private Object[] multiReturns;

private Tuple(Object... multiReturns) {
    this.multiReturns = multiReturns;
}

public static Tuple _t(Object... multiReturns){
    return new Tuple(multiReturns);
}

public <T> T at(int index, Class<T> someClass) {
    return someClass.cast(multiReturns[index]);
}
} 
```

并像这样使用

```
public Tuple returnMultiValues(){
   return Tuple._t(new ArrayList(),new HashMap())
}

Tuple t = returnMultiValues();
ArrayList list = t.at(0,ArrayList.class); 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-04-28T13:47:36.637

我采用了与其他答案中描述的方法类似的方法，并根据我的要求进行了一些调整，基本上我创建了以下类（以防万一，一切都是 Java）：

```
public class Pair<L, R> {
    final L left;
    final R right;

    public Pair(L left, R right) {
        this.left = left;
        this.right = right;
    }

    public <T> T get(Class<T> param) {
        return (T) (param == this.left.getClass() ? this.left : this.right);
    }

    public static <L, R> Pair<L, R> of(L left, R right) {
        return new Pair<L, R>(left, right);
    }
} 
```

然后，我的要求很简单，在到达数据库的存储库类中，对于获取方法而不是从数据库中检索数据，我需要检查它是失败还是成功，然后，如果成功，我需要使用返回列表，如果失败，停止执行并通知错误。

因此，例如，我的方法是这样的：

```
public Pair<ResultMessage, List<Customer>> getCustomers() {
    List<Customer> list = new ArrayList<Customer>();
    try {
    /*
    * Do some work to get the list of Customers from the DB
    * */
    } catch (SQLException e) {
        return Pair.of(
                       new ResultMessage(e.getErrorCode(), e.getMessage()), // Left 
                       null);  // Right
    }
    return Pair.of(
                   new ResultMessage(0, "SUCCESS"), // Left 
                   list); // Right
} 
```

其中 ResultMessage 只是一个具有两个字段（代码/消息）的类，而 Customer 是具有来自数据库的一堆字段的任何类。

然后，要检查结果，我只是这样做：

```
void doSomething(){
    Pair<ResultMessage, List<Customer>> customerResult = _repository.getCustomers();
    if (customerResult.get(ResultMessage.class).getCode() == 0) {
        List<Customer> listOfCustomers = customerResult.get(List.class);
        System.out.println("do SOMETHING with the list ;) ");
    }else {
        System.out.println("Raised Error... do nothing!");
    }
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-07-02T09:19:32.303

```
public class MultipleReturnValues {

    public MultipleReturnValues() {
    }

    public static void functionWithSeveralReturnValues(final String[] returnValues) {
        returnValues[0] = "return value 1";
        returnValues[1] = "return value 2";
    }

    public static void main(String[] args) {
        String[] returnValues = new String[2];
        functionWithSeveralReturnValues(returnValues);
        System.out.println("returnValues[0] = " + returnValues[0]);
        System.out.println("returnValues[1] = " + returnValues[1]);
    }

} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-01-19T14:59:39.803

为什么不创建一个`WhateverFunctionResult`包含您的结果的对象，*以及*解析这些结果所需的逻辑，然后迭代等等。在我看来，要么：

1.  这些结果对象紧密联系在一起/相关并且属于一起，或者：
2.  它们是不相关的，在这种情况下，您的功能没有很好地定义它试图做什么（即做两件不同的事情）

我看到这种问题一次又一次地出现。不要害怕创建自己的容器/结果类，其中包含数据和相关的功能来处理它。如果您只是简单地以 a`HashMap`或类似的方式传递这些东西，那么您的客户每次想要使用结果时都必须拆开这张地图并摸索内容。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-19T14:06:15.450

在 C++ (STL) 中，有一个用于捆绑两个对象的 pair 类。在 Java 泛型中，pair 类不可用，尽管有一些[需求](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6229146)。你可以很容易地自己实现它。

但是，我同意其他一些答案，即如果您需要从一个方法返回两个或更多对象，最好将它们封装在一个类中。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-10-08T20:15:24.460

这并不能完全回答这个问题，但由于这里给出的每个解决方案都有一些缺点，我建议尝试稍微重构你的代码，这样你只需要返回一个值。

**案例一。**

你需要在你的方法内外都有一些东西。为什么不在外面计算并传递给方法呢？

代替：

```
[thingA, thingB] = createThings(...);  // just a conceptual syntax of method returning two values, not valid in Java 
```

尝试：

```
thingA = createThingA(...);
thingB = createThingB(thingA, ...); 
```

这应该可以满足您的大部分需求，因为在大多数情况下，一个值是在另一个值之前创建的，您可以通过两种方法拆分创建它们。缺点是该方法`createThingsB`与 相比有一个额外的参数`createThings`，并且可能您将完全相同的参数列表两次传递给不同的方法。

* * *

**案例二。**

有史以来最明显的解决方案和案例一的简化版本。这并不总是可能的，但也许这两个值都可以相互独立地创建？

代替：

```
[thingA, thingB] = createThings(...);  // see above 
```

尝试：

```
thingA = createThingA(...);
thingB = createThingB(...); 
```

为了让它更有用，这两种方法可以共享一些共同的逻辑：

```
public ThingA createThingA(...) {
    doCommonThings(); // common logic
    // create thing A
}
public ThingB createThingB(...) {
    doCommonThings(); // common logic
    // create thing B
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-03-24T10:05:36.930

将列表传递给您的方法并填充它，然后返回带有名称的字符串，如下所示：

```
public String buildList(List<?> list) {
    list.add(1);
    list.add(2);
    list.add(3);
    return "something,something,something,dark side";
} 
```

然后像这样调用它：

```
List<?> values = new ArrayList<?>();
String names = buildList(values); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-09-23T11:16:53.877

您可以使用`HashMap<String, Object>`如下

```
public HashMap<String, Object> yourMethod()
{

   .... different logic here 

  HashMap<String, Object> returnHashMap = new HashMap<String, Object>();
  returnHashMap.put("objectA", objectAValue);
  returnHashMap.put("myString", myStringValue);
  returnHashMap.put("myBoolean", myBooleanValue);

  return returnHashMap;
} 
```

然后在不同范围内调用该方法时，您可以将每个对象转换回其初始类型：

```
// call the method
HashMap<String, Object> resultMap = yourMethod();

// fetch the results and cast them
ObjectA objectA = (ObjectA) resultMap.get("objectA");
String myString = (String) resultMap.get("myString");
Boolean myBoolean = (Boolean) resultMap.get("myBoolean"); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-12-31T15:13:37.497

我注意到还没有返回多个值的无自定义类、n 长度、无强制转换、类型安全的答案。

这是我的尝试：

```
import java.util.Objects;

public final class NTuple<V, T extends  NTuple<?, ?>> {
    private final V value;
    private final T next;

    private NTuple(V value, T next) {
        this.value = value;
        this.next = next;
    }

    public static <V> NTuple<V, ?> of(V value) {
        return new NTuple<>(value, null);
    }

    public static <V,  T extends  NTuple<?, ?>> NTuple<V, T> of(V value, T next) {
        return new NTuple<>(value, next);
    }

    public V value() {
        return value;
    }

    public T next() {
        return next;
    }

    public static <V> V unpack0(NTuple<V, ?> tuple) {
        return Objects.requireNonNull(tuple, "0").value();
    }

    public static <V, T extends NTuple<V, ?>> V unpack1(NTuple<?, T> tuple) {
        NTuple<?, T> tuple0 = Objects.requireNonNull(tuple, "0");
        NTuple<V, ?> tuple1 = Objects.requireNonNull(tuple0.next(), "1");
        return tuple1.value();
    }

    public static <V, T extends NTuple<?, NTuple<V, ?>>> V unpack2(NTuple<?, T> tuple) {
        NTuple<?, T> tuple0 = Objects.requireNonNull(tuple, "0");
        NTuple<?, NTuple<V, ?>> tuple1 = Objects.requireNonNull(tuple0.next(), "1");
        NTuple<V, ?> tuple2 = Objects.requireNonNull(tuple1.next(), "2");
        return tuple2.value();
    }
} 
```

样品用途：

```
public static void main(String[] args) {
    // pre-java 10 without lombok - use lombok's var or java 10's var if you can
    NTuple<String, NTuple<Integer, NTuple<Integer, ?>>> multiple = wordCount("hello world");
    String original = NTuple.unpack0(multiple);
    Integer wordCount = NTuple.unpack1(multiple);
    Integer characterCount  = NTuple.unpack2(multiple);

    System.out.println(original + ": " + wordCount + " words " + characterCount + " chars");
}

private static NTuple<String, NTuple<Integer, NTuple<Integer, ?>>> wordCount(String s) {
    int nWords = s.split(" ").length;
    int nChars = s.length();
    return NTuple.of(s, NTuple.of(nWords, NTuple.of(nChars)));
} 
```

优点：

*   无自定义容器类 - 无需仅为返回类型编写类
*   n-length - 可以处理任意数量的返回值
*   no-cast - 无需从 Object 进行投射
*   类型安全 - 通过 Java 的泛型检查类型

缺点：

*   对于大量返回值效率低下
    *   根据我对 python 的多个返回值的经验，这在实践中不应该发生
*   重类型声明
    *   可以通过 lombok/Java 10 缓解`var`

* * *

## 回答 #24

> 赞同：-4
> 
> 时间：2013-04-02T00:55:43.820

在 C 中，您可以通过将指向占位符的指针作为参数传递给结果：

```
void getShoeAndWaistSizes(int *shoeSize, int *waistSize) {
    *shoeSize = 36;
    *waistSize = 45;
}
...
int shoeSize, waistSize;
getShoeAndWaistSize(&shoeSize, &waistSize);
int i = shoeSize + waistSize; 
```

让我们在 Java 中尝试类似的东西。

```
void getShoeAndWaistSizes(List<Integer> shoeSize, List<Integer> waistSize) {
    shoeSize.add(36);
    waistSize.add(45);
}
...
List<Integer> shoeSize = new List<>();
List<Integer> waistSize = new List<>();
getShoeAndWaistSizes(shoeSize, waistSize);
int i = shoeSize.get(0) + waistSize.get(0); 
```

* * *

## 回答 #25

> 赞同：-5
> 
> 时间：2009-01-19T15:13:27.700

将哈希传递给方法并填充它......

公共无效构建响应（字符串数据，地图响应）；

# java - 什么架构？跨集群分发内容构建

> ID：457633
> 
> 赞同：0
> 
> 时间：2009-01-19T13:53:46.487
> 
> 标签：java, architecture, cluster-computing

我正在构建一个内容服务应用程序，该应用程序由两种类型的节点（ContentServers 和 ContentBuilders）组成的集群。

我们的想法是始终提供新鲜的内容。如果内容是最近构建的，则内容是新鲜的，即 Content.buildTime < MAX_AGE。

要求：

*ContentServers 只需要查找内容并提供它（例如从分布式缓存或类似的），除了对每个内容项的第一次请求外，无需等待任何内容的构建。

*ContentBuilders 应该是负载平衡的，应该在内容到期之前重建内容，应该只构建实际被请求的内容。构建的内容应该可以被所有 ContentServer 快速检索

我应该使用什么架构？我目前正在考虑一个分布式缓存（也许是 EhCache）来保存构建的内容和一个消息队列（也许是 JMS/ActiveMQ）来将内容请求中继给构建器，尽管我会考虑任何其他选项/建议。我如何确定 ContentBuilders 不会同时构建相同的东西，并且只会在内容接近到期时构建内容？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T14:41:47.873

老实说，我会重新考虑你的方法，我会告诉你为什么。

我在分布式大容量系统（特别是金融交易）和您的解决方案上做了很多工作——如果容量足够高（我会假设它是这样，否则您不会考虑使用集群解决方案；您这些天可以从一个现成的盒子中获得大量的电力）——然后你会用远程调用杀死自己（即从另一个节点调用数据）。

我将在这里谈论 Tangosol/Oracle Coherence，因为这是我最有经验的，尽管 Terracotta 将支持其中的部分或大部分功能并且是免费的。

在 Coherence 术语中，您拥有的是分区缓存，如果您有*n 个*节点，则每个节点拥有总数据的*1/n*。通常，您具有至少一个级别的冗余，并且该冗余尽可能均匀地分布，因此其他*n-1*个节点中的每一个都拥有*1/n-1*个备份节点。

这种解决方案的想法是尝试确保尽可能多的缓存命中是本地的（对于同一个集群节点）。此外，特别是分区缓存，写入相对更容易（并且每个缓存条目拥有的备份节点越多，成本就会越高）——尽管后写缓存可以最大限度地减少这一点——并且读取相当便宜（这就是你想出你的要求）。

因此，您的解决方案将确保**每次**缓存命中都将到达远程节点。

还要考虑生成内容无疑比提供内容要昂贵得多，我认为这就是您提出这个想法的原因，因为这样您就可以拥有比服务器更多的内容生成器。这是一种更分层的方法，我将其描述为水平切片。

如果您可以垂直分割您的应用程序，您将获得更好的可伸缩性。我的意思是每个节点负责存储、生成和提供所有内容的子集。这有效地消除了节点间通信（不包括备份），并允许您通过简单地为每个节点提供不同大小的内容子集来调整解决方案。

理想情况下，您选择的任何数据分区方案都应该可以由您的 Web 服务器重现，这样它就可以准确地知道要访问哪个节点来获取相关数据。

现在您可能有其他理由按照您提议的方式进行操作，但我只能在可用信息的背景下回答这个问题。

我还将向您指出我为回答另一个问题而编写[的 Java 网格/集群技术摘要。](https://stackoverflow.com/questions/383920/what-is-the-best-library-for-java-to-grid-cluster-enable-your-application#383929)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T06:03:24.463

您可能想尝试[Hazelcast](http://www.hazelcast.com)。它是开源的，peer2peer，分布式/分区映射和队列，支持驱逐。导入一个罐子，你很高兴！超级简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T14:14:42.500

如果内容构建可以并行化（构建器 1 执行 1..1000，构建器 2 执行 1001..2000），那么您可以创建一个配置文件来传递此信息。ContentBuilder 将负责监控其区域是否过期。

如果这不可能，那么您需要某种经理来协调内容构建。该管理器也可以扮演负载均衡器的角色。管理器可以与 ContentBuilder 捆绑在一起，也可以是它自己的一个节点。

我认为分布式缓存和 JMS 消息传递的想法是好的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T07:32:11.020

听起来您需要某种形式的分布式缓存、分布式锁定和消息传递。

[Terracotta 为您提供了这三者 - 分布式缓存、分布式锁定和消息传递](http://www.terracotta.org)，并且您的编程模型只是 Java（不需要 JMS）。

我在这里写了一篇关于如何确保缓存只填充其内容一次且仅一次的博客：[什么是记忆器以及为什么要关心它](http://javathink.blogspot.com/2008/09/what-is-memoizer-and-why-should-you.html)。

我同意 Cletus - 如果您需要高性能，则需要考虑分区，但与大多数解决方案不同，Terracotta 无需分区即可正常工作，直到您需要它，然后当您应用分区时，它只会根据你的分区算法。

# c# - C# 2.0 解析 Excel 电子表格的最快方法

> ID：457636
> 
> 赞同：4
> 
> 时间：2009-01-19T13:55:20.820
> 
> 标签：c#, excel, interop

> **可能重复：**
> [从 C# 读取 Excel 文件](https://stackoverflow.com/questions/15828/reading-excel-files-from-c-sharp)

从 Csharp 的 excel 中读取大量数据的最快方法是什么。示例代码会很棒。.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T14:11:01.693

在我们的桌面环境中，我通过 COM 使用 Excel 达到了性能、灵活性和稳定性之间的最佳组合。

访问 Excel 总是通过同一个线程。

我使用后期绑定（在 VB.Net 中）使我的应用程序版本独立。

应用程序的其余部分是用 C# 开发的，只有这部分和其他一些小部分是用 VB 开发的，因为它们在 VB.Net 中更容易。

```
Dim workBook As Object = GetObject(fileName)
Dim workSheet As Object = workBook.WorkSheets.Item(WorkSheetNr)
Dim range As Object = workSheet.Cells.Item(1, 1)

Dim range2 As Object = range.CurrentRegion

Dim rrow As Integer = range2.Row ' For XL97, first convert to integer. XL97 will generate an error ' 
Dim rcolumn As Integer = range2.Column

Dim top As Object = workSheet.Cells.Item(rrow, rcolumn)
Dim bottom As Object = top.Offset(range2.Rows.Count - 1, range2.Columns.Count - 1)

range = workSheet.Range(top, bottom)

Dim values As Object(,)

values = range.Value 
```

这里有一个包含 Excel 值的二维数组。最后一条语句将数据从 Excel 获取到 .Net。

由于 Excel 工作表大小的限制，这些不能变得非常大，因此内存应该不是问题。

我们已经在多个系统上进行了一些性能测试。它经过优化以创建尽可能少的（进程外）COM 调用。

这种方式给了我们最好的性能，特别是因为数据直接在一个数组中，并且访问这些数据比通过数据集更快。

此解决方案中的缓慢是启动 Excel。但是，如果您需要处理多个文件，一个接一个，启动 Excel 的成本只需一次。

此外，我不会在服务器环境中使用此解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-17T11:32:02.273

```
public class ExcelHeaderValues
{ 

        public static string CUSIP = "CUSIP";
        public static string ORIG = "ORIG";
        public static string PRICE = "PRICE";
        public static int COLUMNCOUNT = 3;
}

public class ExcelParser
    {
        private ArrayList collOutput = null;

        string sSheetName = String.Empty;
        string[] strValidColumn;
        int validRowCnt = 0;
        string sColumnPositions = String.Empty;

        OleDbCommand ExcelCommand;
        OleDbDataAdapter ExcelAdapter;
        OleDbConnection ExcelConnection = null;
        DataSet dsSheet = null;
        string path = string.Empty;
        string identifier = string.Empty;

        public ExcelParser()
        {
            collOutput = new ArrayList();
        }      

        public void Extract()
        {
            bool headermatch = false;
            string strCusip = string.Empty, strOrig = string.Empty, strPrice = string.Empty, strData = string.Empty;
            string strCusipPos = string.Empty, strPricePos = string.Empty, strOrigPos = string.Empty;

            string strColumnHeader = String.Empty;
            int reqColcount = 0;
            string[] strTemp;
            bool bTemp = false;
            bool validRow = false;

            DataTable schemaTable = GetSchemaTable();

            validRowCnt = 0;
            foreach (DataRow dr in schemaTable.Rows)
            {
                if (dsSheet != null)
                {
                    dsSheet.Reset();
                    dsSheet = null;
                }
                strCusipPos = string.Empty;
                strOrigPos = string.Empty;
                strPricePos = string.Empty;

                if (isValidSheet(dr))
                {
                    sColumnPositions = string.Empty;
                    validRowCnt = 0;
                    foreach (DataRow dataRow in dsSheet.Tables[0].Rows)
                    {
                        sColumnPositions = string.Empty;
                        if (headermatch == false)
                        {
                            sColumnPositions = string.Empty;
                            foreach (DataColumn column in dsSheet.Tables[0].Columns)
                            {
                                strColumnHeader = dataRow[column.ColumnName].ToString().ToUpper().Trim();
                                strColumnHeader = strColumnHeader.ToUpper();
                                if (strColumnHeader == ExcelHeaderValues.ORIG.ToUpper() || strColumnHeader == ExcelHeaderValues.CUSIP.ToUpper() || strColumnHeader == ExcelHeaderValues.PRICE.ToUpper())
                                {
                                    bTemp = true;
                                    validRow = true;
                                    reqColcount = ExcelHeaderValues.COLUMNCOUNT;
                                }
                                if (bTemp)
                                {
                                    bTemp = false;
                                    sColumnPositions += column.ColumnName + "^" + strColumnHeader + ";";
                                }
                            }
                            strValidColumn = sColumnPositions.Trim().Split(';');
                            if (validRow == true && reqColcount == strValidColumn.Length - 1)
                            {
                                headermatch = true;
                                break;
                            }
                            validRowCnt++;
                        }
                    }
                    if (headermatch == true)
                    {
                        try
                        {
                            if (dsSheet.Tables[0].Rows.Count > 0)
                            {
                                if (strValidColumn.Length > 0)
                                {
                                    for (int i = 0; i < strValidColumn.Length - 1; i++)
                                    {
                                        if (strValidColumn[i].ToUpper().Contains("CUSIP"))
                                        {
                                            strTemp = strValidColumn[i].ToString().Split('^');
                                            strCusipPos = strTemp[0].ToString();
                                            strTemp = null;
                                        }

                                        if (strValidColumn[i].ToUpper().Contains("PRICE"))
                                        {
                                            strTemp = strValidColumn[i].ToString().Split('^');
                                            strPricePos = strTemp[0].ToString();
                                            strTemp = null;
                                        }

                                        if (strValidColumn[i].ToUpper().Contains("ORIG"))
                                        {
                                            strTemp = strValidColumn[i].ToString().Split('^');
                                            strOrigPos = strTemp[0].ToString();
                                            strTemp = null;
                                        }
                                    }
                                }
                                for (int iData = validRowCnt; iData < dsSheet.Tables[0].Rows.Count; iData++)
                                {
                                    if (strCusipPos.Trim() != "")
                                        strCusip = dsSheet.Tables[0].Rows[iData][strCusipPos].ToString().Trim();
                                    if (strOrigPos.Trim() != "")
                                        strOrig = dsSheet.Tables[0].Rows[iData][strOrigPos].ToString().Trim();
                                    if (strPricePos.Trim() != "")
                                        strPrice = dsSheet.Tables[0].Rows[iData][strPricePos].ToString().Trim().ToUpper();

                                    strData = "";
                                    if (strCusip.Length == 9 && strCusip != "" && strPrice != "" && strOrig != "" && !strPrice.ToUpper().Contains("SOLD"))
                                        strData = strCusip + "|" + Convert.ToDouble(strOrig) * 1000000 + "|" + strPrice + "|||||";
                                    if (strData != null && strData != "")
                                        collOutput.Add(strData);

                                    strCusip = string.Empty;
                                    strOrig = string.Empty;
                                    strPrice = string.Empty;
                                    strData = string.Empty;
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            throw ex;
                        }
                    }
                    headermatch = false;
                    sColumnPositions = string.Empty;
                    strColumnHeader = string.Empty;
                }
            }
        }

        private bool isValidSheet(DataRow dr)
        {
            bool isValidSheet = false;
            sSheetName = dr[2].ToString().ToUpper();

            if (!(sSheetName.Contains("$_")) && !(sSheetName.Contains("$'_")) && (!sSheetName.Contains("Print_Titles".ToUpper())) && (dr[3].ToString() == "TABLE" && ((!sSheetName.Contains("Print_Area".ToUpper())))) && !(sSheetName.ToUpper() == "DLOFFERLOOKUP"))
            {
                if (sSheetName.Trim().ToUpper() != "Disclaimer$".ToUpper() && sSheetName.Trim().ToUpper() != "Summary$".ToUpper() && sSheetName.Trim().ToUpper() != "FORMULAS$" )
                {
                    string sQry = string.Empty;        
                    sQry = "SELECT * FROM [" + sSheetName + "]";
                    ExcelCommand = new OleDbCommand(sQry, ExcelConnection);
                    dsSheet = new DataSet();
                    ExcelAdapter = new OleDbDataAdapter(ExcelCommand);
                    isValidSheet = false;
                    try
                    {
                         ExcelAdapter.Fill(dsSheet, sSheetName);
                        isValidSheet = true;
                    }
                    catch (Exception ex)
                    {
                        isValidSheet = false;
                        throw new Exception(ex.Message.ToString());
                    }
                    finally
                    {
                        ExcelAdapter = null;
                        ExcelCommand = null;
                    }
                }
            }           
            return isValidSheet;
        }

        private DataTable GetSchemaTable()
        {
            DataTable dt = null;
            string connectionString = String.Empty;
            connectionString = GetConnectionString();
            ExcelConnection = new OleDbConnection(connectionString);
            try
            {
                ExcelConnection.Open();
                dt = ExcelConnection.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, new object[] { null, null, null, "TABLE" });
            }

            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        private string GetConnectionString()
        {
            string connStr = String.Empty;
            try
            {

                if (path.ToLower().Contains(".xlsx"))
                {
                    connStr = "Provider=Microsoft.ACE.OLEDB.12.0;" + "Data Source='" + path + "';" + "Extended Properties='Excel 12.0;HDR=No;IMEX=1;'";
                }
                else if (path.ToLower().Contains(".xlsm"))
                {
                    connStr = "Provider=Microsoft.ACE.OLEDB.12.0;" + "Data Source='" + path + "';" + "Extended Properties='Excel 12.0 Macro;HDR=No;IMEX=1;'";

                }
                else if (path.ToLower().Contains(".xls"))
                {
 connStr = "provider=Microsoft.Jet.OLEDB.4.0;Data Source='" + path + "';Extended Properties='Excel 8.0;HDR=No;IMEX=1;'";

                }
                else
                {connStr = "Provider=Microsoft.ACE.OLEDB.12.0;" + "Data Source='" + path + "';" + "Extended Properties='HTML Import;IMEX=1;HDR=No;'";

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return connStr;
        }

} 
```

# ruby-on-rails - 路由到新操作 (Rails)

> ID：457637
> 
> 赞同：3
> 
> 时间：2009-01-19T13:55:22.990
> 
> 标签：ruby-on-rails

我在我的 PostsController 中有一个名为“tagged”的操作，我想返回所有带有任何术语标签的帖子。

在我的 routes.rb 我有以下（在顶部）：

```
map.connect 'posts/tagged/:tag', { :controller => 'posts', :action => 'tagged', :tag => /[a-z\-]+/ } 
```

然而导航到 posts/tagged/yes 会返回 RecordNotFound 错误：

```
Couldn't find Post without an ID 
```

在我的 tagged.html.erb 文件中，我最终将使用acts_as_taggable_on_steroids 中的 find_tagged_with 方法，但现在我已经放置了一个简单的 Post.find(:all) 来消除出错的可能性。

似乎我的 map.connect 被覆盖了，即使我将整个 routes.rb 文件注释掉，除了我的新行，也会发生同样的错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T19:23:17.960

Why not add a RESTful route for the "tagged" action?

```
map.resources :posts, :member => { :tagged => :put } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T14:10:55.563

好的，因为您可以注释掉默认路由，这意味着您的问题根本不在您的路由中。这是您在帖子控制器中标记的操作可能有这样的东西。

```
 def tagged
    @post = Post.find(params[:id])

    respond_to do |format|
      format.html # show.html.erb
      format.xml  { render :xml => @post }
    end
  end 
```

或者如果你花更多的时间，它看起来像这样：

```
 def tagged
    @post = Post.find(params[:tagged])

    respond_to do |format|
      format.html # show.html.erb
      format.xml  { render :xml => @post }
    end
  end 
```

你想要的是这样的：

```
 def tagged
    @post = Post.find(:all, :conditions => {:tagged => params[:tagged]})

    respond_to do |format|
      format.html # show.html.erb
      format.xml  { render :xml => @post }
    end
  end 
```

无论如何，您应该为这些东西编写功能测试，而不是在浏览器中进行测试。

# python - 使用python将utf-16编码的rss流存储到sqlite3的正确程序是什么

> ID：457641
> 
> 赞同：2
> 
> 时间：2009-01-19T13:57:37.027
> 
> 标签：python, sqlite, wsgi

我有一个 python sgi 脚本，它尝试提取发布到它的 rss 项目并将 rss 存储在 sqlite3 db 中。我使用 Flup 作为 WSGIServer。
获取发布内容： postData = environ["wsgi.input"].read(int(environ["CONTENT_LENGTH"]))

要尝试存储在数据库中：

```
from pysqlite2 import dbapi2 as sqlite
ldb = sqlite.connect("/var/vhost/mysite.com/db/rssharvested.db")
lcursor = ldb.cursor()
lcursor.execute("INSERT into rss(data) VALUES(?)", (postData,)) 
```

这导致只有 rss 的前几个字符存储在记录中：ÿþ< 我相信初始字符是 rss 的 BOM。

我已经尝试了我能想到的所有排列，包括首先将 rss 编码为 utf-8，然后尝试存储，但结果是相同的。我无法解码，因为某些字符无法表示为 unicode。

运行 python 2.5.2 sqlite 3.5.7

提前感谢您对此问题的任何见解。

* * *

这是 postData 中包含的初始数据示例，由 repr 函数修改，写入文件并使用 less 查看：

'\xef\xbb\xbf

谢谢大家的回复！很有帮助。

* * *

我提交的示例没有通过stackoverflow html过滤器将再次尝试，将小于和大于转换为实体（预览表明这有效）。

\xef\xbb\xbf<?xml version="1.0" encoding="utf-16"?><rss xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd= "http://www.w3.org/2001/XMLSchema"><channel><item d3p1:size="0" xsi:type="tFileItem" xmlns:d3p1="http://htinc.com/opensearch- ex/1.0/">

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T14:04:45.390

关于插入编码 - 在任何体面的数据库 API 中，您应该只插入`unicode`字符串和`unicode`字符串。

对于阅读和解析位，我推荐 Mark Pilgrim 的[Feed Parser](http://www.feedparser.org/)。它可以正确处理 BOM，并且许可证允许商业用途。 *如果您不对 RSS 数据进行任何实际解析，这可能有点过于繁琐。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T18:34:14.470

您确定您的传入数据被编码为 UTF-16（也称为 UCS-2）吗？

UTF-16 编码的 unicode 字符串通常包含大量 NUL 字符（当然也适用于 ASCII 中存在的所有字符），因此 UTF-16 数据几乎不能存储在环境变量中（POSIX 中的 env vars 是 NUL 终止的）。

请提供`postData`变量内容的样本。使用 输出它们`repr()`。

在那之前，可靠的建议是：在所有 DB 交互中，Python 端的字符串应该是 unicode 字符串；数据库接口应该处理所有必要的翻译/编码/解码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T14:36:03.487

在插入 SQL 之前，您应该将字符串转换为 unicode 兼容的字符串。如果引发 UnicodeError 异常，则对 string.encode("utf-8") 进行编码。

或者，您可以在他的编码模式上自动检测编码并对其进行编码。 [自动检测编码](http://code.activestate.com/recipes/52257)

# c# - Visual Studio 2008 自动化测试项目可以读取 app.config 之类的配置文件？（C#.NET）

> ID：457644
> 
> 赞同：0
> 
> 时间：2009-01-19T13:58:14.013
> 
> 标签：c#, .net, visual-studio-2008, app-config

我的 TestProject 中有一个 app.config 文件，但是当我尝试使用 ConfigurationManager 读取它时，它是从其他地方读取的，它不是我的 app.config 的。如何纠正这个？

当前配置：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <connectionStrings>
    <add name="Production" connectionString="Server=127.0.0.1,2345;Uid=user;Pwd=password;Initial Catalog=DATABASE_DATA"/>
  </connectionStrings>
</configuration> 
```

当前代码：

```
ConfigurationManager.ConnectionStrings[0].ConnectionString 
```

预期输出：

```
"Server=127.0.0.1,2345;Uid=user;Pwd=password;Initial Catalog=DATABASE_DATA" 
```

实际输出：

```
"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|aspnetdb.mdf;User Instance=true" 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T14:04:57.837

尝试按名称引用它。

```
ConfigurationManager.ConnectionStrings["Production"].ConnectionString 
```

默认情况下，配置文件会自动集成具有该 SQLEXPRESS 连接字符串的 machine.config。

# java - Java 字符集和 Windows

> ID：457655
> 
> 赞同：4
> 
> 时间：2009-01-19T13:59:58.520
> 
> 标签：java, windows

我有一个 Java 程序，它在外部进程中运行 msinfo32.exe（系统信息），然后读取 msinfo32.exe 生成的文件内容。当 Java 程序将文件内容加载到 String 中时，String 字符是不可读的。为了使字符串可读，我必须使用 String(byte[] bytes, String charsetName) 创建字符串并将 charsetName 设置为 UTF-16。但是，在 Windows2003 的一个实例上运行时，只有 UTF-16LE（小端序）会产生可打印的字符串。

我怎样才能提前知道要使用哪种字符编码？

此外，我们将不胜感激有关该主题的任何背景信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-19T14:59:28.540

一些 Microsoft 应用程序使用[字节顺序标记](http://en.wikipedia.org/wiki/Byte_Order_Mark)来指示 Unicode 文件及其字节顺序。我可以在我的 Windows XP 机器上看到导出的 .NFO 文件以 0xFFFE 开头，所以它是 little-endian。

```
FF FE 3C 00 3F 00 78 00 6D 00 6C 00 20 00 76 00         __<_?_x_m_l_ _v_
65 00 72 00 73 00 69 00 6F 00 6E 00 3D 00 22 00         e_r_s_i_o_n_=_"_
31 00 2E 00 30 00 22 00 3F 00 3E 00 0D 00 0A 00         1_._0_"_?_>_____
3C 00 4D 00 73 00 49 00 6E 00 66 00 6F 00 3E 00         <_M_s_I_n_f_o_>_
0D 00 0A 00 3C 00 4D 00 65 00 74 00 61 00 64 00         ____<_M_e_t_a_d_ 
```

另外，我建议您切换到使用[Reader](http://java.sun.com/javase/6/docs/api/java/io/InputStreamReader.html)实现而不是 String 构造函数来解码文件；这有助于避免读取半个字符的问题，因为它被截断，因为它位于字节数组的末尾。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T14:59:19.117

您可以尝试使用库来猜测编码，例如我曾经使用过[这个解决方案](http://glaforge.free.fr/wiki/index.php?wiki=GuessEncoding)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T14:09:27.830

您无法真正知道使用了什么字符编码（除非您创建了创建正在处理的输出的工具）。您可以尝试检测预定义的编码列表并选择不会导致任何解码错误但取决于可能与许多不同编码匹配的输入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T19:03:24.927

它的工作方式是，如果有人给您一个文件并说它是 UTF-16，他们希望您检查前两个字节（BOM）以找出它是大端还是小端。但是如果他们告诉你编码是*UTF-16LE*，那就意味着没有 BOM；您不需要它，因为他们已经告诉您字节顺序是 little-endian。Java 精确地遵循这些规则，这是一个真正的麻烦，因为没有其他人这样做。

现代 Windows 操作系统的本机字符编码是 UTF-16，little-endian。不幸的是，个别程序在字节顺序标记方面似乎并不一致。而且您不能一直使用 UTF-16LE，因为如果 BOM*存在*，它将作为垃圾字符传递。正如 McDowell 所描述的，提前知道是使用 UTF-16 还是 UTF-16LE 的唯一方法是检查前两个字节。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T14:21:55.933

如果您事先不知道字符编码，并且在各个平台之间有所不同，那么您需要以某种方式分析字节数组以尝试猜测它。有一些可用的检测算法，但它可能对您的应用程序来说太过分了。

你能调整你的应用程序来产生一个已知的输出吗？不需要是整行，只有第一个字符就可以了。如果是，那么您可以将生成的字节数组与各种编码中的预期进行比较并进行检测。UTF8、UTF-16 big endian 和 little endian 的字节数组对于简单字符串将是不同的事件。

# wcf - 在 WCF 中读取调用者的 IP 地址（OperationContext 为空）？

> ID：457668
> 
> 赞同：8
> 
> 时间：2009-01-19T14:06:17.070
> 
> 标签：wcf, validation

我正在使用 UserNamePasswordValidator.Validate(string username, string password) 验证用户，并且该服务正在托管自己（例如，没有 IIS）。

我遇到的问题是，如果用户验证失败，我想跟踪用户的 IP 地址。这在用户得到验证时工作正常，因为 OperationContext 已被初始化（它在 validate 方法中为 null，直到稍后才创建）。

有谁知道如何在 validate 方法中或在 validate 方法执行之前获取客户端 IP 地址？

是的，我知道如何使用 RemoteEndpointMessageProperty 获取 IP 地址，但就像我说的，如果验证失败，它永远不会走那么远:-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T18:14:15.883

我整个星期都在研究这个问题，但我无法想出一篇关于这个问题的博客文章或 MSDN 文章。

据我所知，您无法在验证阶段记录 IP 地址。

我可以建议的唯一解决方法是在 IIS 中托管并使用那里的博客，它们会记录 IP 地址。不幸的是，这很痛苦，但这可能是唯一的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-26T09:29:30.857

如果您在 IIS 中托管，那么这将变得更加简单。这块配置直接来自我的托管 Web 项目，并强制 ASP.NET 请求通过 IIS 管道，而不是直接分派到 IIS 的 ASP 错误位。

aspNetCompatibilityEnabled：当此属性设置为 true 时，对 Windows Communication Foundation (WCF) 服务的请求会流经 ASP.NET HTTP 管道，并且禁止通过非 HTTP 协议进行通信。

请参阅：http: [//msdn.microsoft.com/en-us/library/ms731336.aspx](http://msdn.microsoft.com/en-us/library/ms731336.aspx)

```
<serviceHostingEnvironment aspNetCompatibilityEnabled="true" /> 
```

我使用 AuthenticationService 并利用 HttpContext 来获取有关客户端的所有有趣的东西，其中大部分对于确保用户没有从六个不同的子网登录以及玩 cookie 等事情很有用。

虽然我认为这适用于 MS AuthenticationService，但您拥有的任何其他服务都需要此属性：

[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]

如果您想追求您的非 IIS 托管服务路线，那么我会使用反射查看 MS API 中可用的内容，在停止时使用调试器在 WCF 上四处寻找，展开所有这些非公共成员。

我想问题将是对一些 WCF 的引用，该 WCF 已初始化，从中开始戳。设置服务主机时，您可能必须向其中一个调度程序注册某种侦听器。

[http://msdn.microsoft.com/en-us/library/system.servicemodel.dispatcher.channeldispatcher.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.dispatcher.channeldispatcher.aspx)

编辑：

添加此链接，因为我的想法是，您需要先获取 WCF 中位于堆栈下方的内容，然后才能访问您的代码：

[http://blogs.msdn.com/sonuarora/archive/2007/06/11/passing-soap-actions-to-adapter-inbound-handler-for-filtering-type-of-listeners.aspx](http://blogs.msdn.com/sonuarora/archive/2007/06/11/passing-soap-actions-to-adapter-inbound-handler-for-filtering-type-of-listeners.aspx)

# javascript - Onclick syntax problem when passing two variables, classic asp

> ID：457669
> 
> 赞同：2
> 
> 时间：2009-01-19T14:07:26.023
> 
> 标签：javascript, asp-classic, ado

My onclick function works beautifully when i pass one variable and doesn't respond once i try to pass two variables. is something wrong with my syntax?

everything supporting this code has been tested and works fine so i'm certain something is wrong with the syntax the onclick line of code. any help would be awesome.

```
------------onclick code---------------------------------------------------
    Response.Write "<td class=""alt""><input type=""button"" onclick=""deleteRecordAtt(" & AttID &","& StoredPath & " )"" value=""remove"" /></td></tr>"

-----------function reference code in main page---------------------------------------

function deleteRecordAtt(AttID, StoredPath){
if(confirm("This will delect the attachment path"))
{
document.location.href="delete_attachments.asp?EMAIL_LETTERS_HOLD_ID="+AttID+"&RedirURL="+escape(document.location.href);
}
}
-----------function code in source page ----------------------------------------------

<%

Dim AttID, RedirectURL, StoredPath
Dim objConn

AttID=request("EMAIL_LETTERS_HOLD_ID")
RedirectURL=request("RedirURL")

Set objConn = CreateObject("ADODB.Connection")
objConn.Open "DSN=MyDSN"
objConn.Execute("UPDATE EMAIL_SEND_ATTACHMENTS set ATTACHMENTS = Replace(LTRIM(RTRIM(ATTACHMENTS)), '"& StoredPath & "' ,'') WHERE EMAIL_LETTERS_HOLD_ID= "& AttID & " ")
objConn.Close
Set objConn = Nothing

response.redirect RedirectURL
%> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T14:51:03.080

> onclick=""deleteRecordAtt(" & AttID &","& StoredPath & " )""

Concatenating strings without escaping - never a good idea. Presumably AttID is an integer which is why you get away with that one argument, but StoredPath is a string. As you haven't escaped or wrapped that string, your Write above will end up with HTML code like (assuming 'storedpath' is, for example, a filename):

```
onclick="deleteRecordAtt(123, file.gif)" 
```

an unquoted 'file.gif' is not parsable as JavaScript of course: a syntax error results. Make sure you have got script errors turned on in your browser so you can see when something like this goes wrong, instead of it just silently failing.

The naive solution is to add wrapping quotes:

```
onclick=""deleteRecordAtt(" & AttID &", '"& StoredPath & "' )"" 
```

which results in:

```
onclick="deleteRecordAtt(123, 'file.gif')" 
```

which will work. But what if your StoredPath variable has a single quote in it? Or a < or & character - these always need encoding using Server.HTMLEncode() anyway, unless you want cross-site-scripting security holes in your app.

What you would need would be a VBScript function to escape characters into JavaScript string literals, by escaping out-of-band characters into JavaScript \xNN hex character escapes. A simple version would start with something like (untested, I am not a VBScript coder):

```
<%
    jsLiteral= Replace(StoredPath, "\", "\x5C")
    jsLiteral= Replace(jsLiteral, "'", "\x27")
    jsLiteral= "'" & jsLiteral & "'"
%>
<input ... onclick="deleteRecordAtt(<%= AttID %>, <%= Server.HTMLEncode(jsLiteral) >)"> 
```

Edit to add re question edit:

> objConn.Execute("UPDATE EMAIL_SEND_ATTACHMENTS set ATTACHMENTS = Replace(LTRIM(RTRIM(ATTACHMENTS)), '"& StoredPath & "' ,'') WHERE EMAIL_LETTERS_HOLD_ID= "& AttID & " ")

Again, concatenating strings without escaping. This one gives you an SQL injection error - a single quote character in your StoredPath variable causes the query to blow up. And if an attacker said something like:

```
StoredPath=', ''));DROP TABLE EMAIL_SEND_ATTACHMENTS;-- 
```

then whoops, goodbye database! More likely is that you'll get hit by one of the many automated SQL injection attacks currently spreading Russian malware around the web.

Escape your SQL string literals or, better, use parameterised queries.

> i click yes, and nothing happens

Again make sure JavaScript errors are turned on so you can see any problems. I don't know if it's the issue in this case, but:

```
document.location.href="delete_attachments.asp?EMAIL_LETTERS_HOLD_ID="+AttID+"&RedirURL="+escape(document.location.href); 
```

should read:

```
location.href= "delete_attachments.asp?EMAIL_LETTERS_HOLD_ID="+AttID+"&RedirURL="+encodeURIComponent(location.href); 
```

JavaScript's escape() shouldn't ever be used as it is subtly and annoyingly incompatible with proper URL encoding as performed by encodeURIComponent().

Also location - short for window.location - is actually a different object to document.location, and is the correct one to use if you wish to move the browser to a new page. Writing to document.location is not supposed to work, although it might still do on some browsers sometimes if you are lucky.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T14:27:37.950

Could it be a problem in the javascript deleteRecordAtt function?
maybe the second parameter is treated as a variable that does not exist?
It would help if you add the Javascript function as well.

# php - 在许多页面上组织许多表单

> ID：457670
> 
> 赞同：0
> 
> 时间：2009-01-19T14:07:48.580
> 
> 标签：php, forms, organization

我正在构建一个包含大约 50 个表单的 Web 应用程序。

我有一个非常好的表单构建类，可以很好地处理这些表单的创建和提交，并且它包含错误处理程序等。那里不需要帮助。

但是，这些表格分散在 120 页中。对于这些页面/表单的理想组织结构，我真的可以从你们那里得到一些权衡。这里有一些想法。两者都有优点和缺点。

1.  每个页面在页眉中创建表单，检测 $_POST['action'] 变量的存在并在那里处理表单。

2.  每个表单由表单函数文件中的函数构建，并在页面标题中调用它时返回表单对象，并且在处理时，由于 $_POST 是超全局的，因此处理函数也在页面标题中调用.

3.  对于每个页面，例如 profile.php，在标题中包含一个文件，该文件包含一个 profile.forms.php，其中发生了上面的方法 #1 或 #2。

想法？

* * *

请注意，每页很少有超过一个表格。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T14:11:13.800

去 3\. - 以后维护代码比一页更改 120 页更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T03:40:25.957

斯库塔感谢您的帮助。我最终使用了#2，在充实了整个项目之后，我对结果非常满意。它的实施灵活且一致，我能够通过最少的培训轻松地将其他编码人员引入该项目。

# c# - C#如何保存运行时字体设置

> ID：457671
> 
> 赞同：5
> 
> 时间：2009-01-19T14:08:17.597
> 
> 标签：c#

我允许用户能够为列表视图做出自己的字体选择。您认为最好的方法是什么。我应该将其保存到注册表还是应用程序文件夹中的文件，以及应保存哪些属性以确保在重新启动应用程序时正确重新显示字体？

感谢您的建议。

编辑：

感谢所有答案。在回答您的一个问题时 - 该机器不会用于多个用户。

我应该保存什么才能重新创建设置。

如果我将它保存到一个分隔字符串，字体类可以解析这个吗？“微软无衬线字体，8.25pt，风格=粗体”

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-19T14:28:07.103

关于保存应用程序设置的位置/方式，请参见此[答案](https://stackoverflow.com/questions/453161/best-pratice-to-save-application-settings-in-windows-application#453230)

您可以将字体保存为字符串，稍后使用以下代码加载它：

```
Font font1 = new Font("Arial", 12, FontStyle.Italic);
TypeConverter converter = TypeDescriptor.GetConverter(typeof(Font));
// Saving Font object as a string
string fontString = converter.ConvertToString(font1);
// Load an instance of Font from a string
Font font = (Font)converter.ConvertFromString(fontString); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T14:12:34.517

您也可以使用[隔离存储](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)。

实际上，您需要知道应用程序是否曾经在同一台机器上的用户配置文件之间共享。如果没有，您可以将其存储在配置文件中。如果是，那么您可以使用注册表（可维护）或隔离存储（安全）。

编辑：上次更新后，您可以在应用程序配置中保存键入的值。例如，如果我想保存一种颜色，我可以将值保存为 System.Color 类型，运行时会为我解析它。查看[本文](http://www.codeproject.com/KB/cs/SystemConfiguration.aspx?display=Print)以获取更多信息和示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T14:12:47.993

您可能应该使用配置文件（很可能是用户设置部分）...但最好避免将内容保存到应用程序文件夹...除非您指的是应用程序数据文件夹。

# c# - 检查一个类是否派生自一个泛型类

> ID：457676
> 
> 赞同：343
> 
> 时间：2009-01-19T14:10:18.140
> 
> 标签：c#, generics, reflection

我的项目中有一个带有派生类的泛型类。

```
public class GenericClass<T> : GenericInterface<T>
{
}

public class Test : GenericClass<SomeType>
{
} 
```

有什么方法可以确定一个`Type`对象是否来自`GenericClass`?

```
t.IsSubclassOf(typeof(GenericClass<>)) 
```

不起作用。

* * *

## 回答 #1

> 赞同：475
> 
> 时间：2009-01-19T14:19:44.533

试试这个代码

```
static bool IsSubclassOfRawGeneric(Type generic, Type toCheck) {
    while (toCheck != null && toCheck != typeof(object)) {
        var cur = toCheck.IsGenericType ? toCheck.GetGenericTypeDefinition() : toCheck;
        if (generic == cur) {
            return true;
        }
        toCheck = toCheck.BaseType;
    }
    return false;
} 
```

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2009-01-19T19:08:08.927

（因大量改写而重发）

JaredPar 的代码答案非常棒，但是如果您的泛型类型不是基于值类型参数，我有一个提示，那就是没有必要。我对为什么“is”运算符不起作用感到困惑，因此我还记录了我的实验结果以供将来参考。请增强此答案以进一步提高其清晰度。

## 提示：

如果您确定您的 GenericClass 实现继承自抽象的非泛型基类（例如 GenericClassBase），您可以毫无问题地问同样的问题，如下所示：

```
typeof(Test).IsSubclassOf(typeof(GenericClassBase)) 
```

* * *

## IsSubclassOf()

我的测试表明 IsSubclassOf() 不适用于无参数泛型类型，例如

```
typeof(GenericClass<>) 
```

而它将与

```
typeof(GenericClass<SomeType>) 
```

因此，假设您愿意基于 SomeType 进行测试，以下代码将适用于 GenericClass<> 的任何派生：

```
typeof(Test).IsSubclassOf(typeof(GenericClass<SomeType>)) 
```

我能想象的唯一一次你想通过 GenericClass<> 进行测试是在插件框架场景中。

* * *

## 关于“is”运算符的思考

在设计时，C# 不允许使用无参数泛型，因为此时它们本质上不是完整的 CLR 类型。因此，您必须声明带有参数的泛型变量，这就是为什么“is”运算符在处理对象方面如此强大的原因。顺便说一句，“is”运算符也不能评估无参数泛型类型。

“is”运算符将测试整个继承链，包括接口。

因此，给定任何对象的实例，下面的方法就可以解决问题：

```
bool IsTypeof<T>(object t)
{
    return (t is T);
} 
```

这有点多余，但我想我会继续为每个人想象它。

给定

```
var t = new Test(); 
```

以下代码行将返回 true：

```
bool test1 = IsTypeof<GenericInterface<SomeType>>(t);

bool test2 = IsTypeof<GenericClass<SomeType>>(t);

bool test3 = IsTypeof<Test>(t); 
```

另一方面，如果你想要一些特定于 GenericClass 的东西，你可以让它更具体，我想，像这样：

```
bool IsTypeofGenericClass<SomeType>(object t)
{
    return (t is GenericClass<SomeType>);
} 
```

然后你会像这样测试：

```
bool test1 = IsTypeofGenericClass<SomeType>(t); 
```

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2011-02-04T11:21:20.177

我研究了其中一些样本，发现在某些情况下缺少它们。此版本适用于所有类型的泛型：类型、接口及其类型定义。

```
public static bool InheritsOrImplements(this Type child, Type parent)
{
    parent = ResolveGenericTypeDefinition(parent);

    var currentChild = child.IsGenericType
                           ? child.GetGenericTypeDefinition()
                           : child;

    while (currentChild != typeof (object))
    {
        if (parent == currentChild || HasAnyInterfaces(parent, currentChild))
            return true;

        currentChild = currentChild.BaseType != null
                       && currentChild.BaseType.IsGenericType
                           ? currentChild.BaseType.GetGenericTypeDefinition()
                           : currentChild.BaseType;

        if (currentChild == null)
            return false;
    }
    return false;
}

private static bool HasAnyInterfaces(Type parent, Type child)
{
    return child.GetInterfaces()
        .Any(childInterface =>
        {
            var currentInterface = childInterface.IsGenericType
                ? childInterface.GetGenericTypeDefinition()
                : childInterface;

            return currentInterface == parent;
        });
}

private static Type ResolveGenericTypeDefinition(Type parent)
{
    var shouldUseGenericType = true;
    if (parent.IsGenericType && parent.GetGenericTypeDefinition() != parent)
        shouldUseGenericType = false;

    if (parent.IsGenericType && shouldUseGenericType)
        parent = parent.GetGenericTypeDefinition();
    return parent;
} 
```

这里还有单元测试：

```
protected interface IFooInterface
{
}

protected interface IGenericFooInterface<T>
{
}

protected class FooBase
{
}

protected class FooImplementor
    : FooBase, IFooInterface
{
}

protected class GenericFooBase
    : FooImplementor, IGenericFooInterface<object>
{

}

protected class GenericFooImplementor<T>
    : FooImplementor, IGenericFooInterface<T>
{
}

[Test]
public void Should_inherit_or_implement_non_generic_interface()
{
    Assert.That(typeof(FooImplementor)
        .InheritsOrImplements(typeof(IFooInterface)), Is.True);
}

[Test]
public void Should_inherit_or_implement_generic_interface()
{
    Assert.That(typeof(GenericFooBase)
        .InheritsOrImplements(typeof(IGenericFooInterface<>)), Is.True);
}

[Test]
public void Should_inherit_or_implement_generic_interface_by_generic_subclass()
{
    Assert.That(typeof(GenericFooImplementor<>)
        .InheritsOrImplements(typeof(IGenericFooInterface<>)), Is.True);
}

[Test]
public void Should_inherit_or_implement_generic_interface_by_generic_subclass_not_caring_about_generic_type_parameter()
{
    Assert.That(new GenericFooImplementor<string>().GetType()
        .InheritsOrImplements(typeof(IGenericFooInterface<>)), Is.True);
}

[Test]
public void Should_not_inherit_or_implement_generic_interface_by_generic_subclass_not_caring_about_generic_type_parameter()
{
    Assert.That(new GenericFooImplementor<string>().GetType()
        .InheritsOrImplements(typeof(IGenericFooInterface<int>)), Is.False);
}

[Test]
public void Should_inherit_or_implement_non_generic_class()
{
    Assert.That(typeof(FooImplementor)
        .InheritsOrImplements(typeof(FooBase)), Is.True);
}

[Test]
public void Should_inherit_or_implement_any_base_type()
{
    Assert.That(typeof(GenericFooImplementor<>)
        .InheritsOrImplements(typeof(FooBase)), Is.True);
} 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2013-09-16T12:29:23.783

在我看来，这个实现在更多情况下有效（无论子级和参数的数量如何，通用类和接口有或没有初始化参数）：

```
public static class ReflexionExtension
{
    public static bool IsSubClassOfGeneric(this Type child, Type parent)
    {
        if (child == parent)
            return false;

        if (child.IsSubclassOf(parent))
            return true;

        var parameters = parent.GetGenericArguments();
        var isParameterLessGeneric = !(parameters != null && parameters.Length > 0 &&
            ((parameters[0].Attributes & TypeAttributes.BeforeFieldInit) == TypeAttributes.BeforeFieldInit));

        while (child != null && child != typeof(object))
        {
            var cur = GetFullTypeDefinition(child);
            if (parent == cur || (isParameterLessGeneric && cur.GetInterfaces().Select(i => GetFullTypeDefinition(i)).Contains(GetFullTypeDefinition(parent))))
                return true;
            else if (!isParameterLessGeneric)
                if (GetFullTypeDefinition(parent) == cur && !cur.IsInterface)
                {
                    if (VerifyGenericArguments(GetFullTypeDefinition(parent), cur))
                        if (VerifyGenericArguments(parent, child))
                            return true;
                }
                else
                    foreach (var item in child.GetInterfaces().Where(i => GetFullTypeDefinition(parent) == GetFullTypeDefinition(i)))
                        if (VerifyGenericArguments(parent, item))
                            return true;

            child = child.BaseType;
        }

        return false;
    }

    private static Type GetFullTypeDefinition(Type type)
    {
        return type.IsGenericType ? type.GetGenericTypeDefinition() : type;
    }

    private static bool VerifyGenericArguments(Type parent, Type child)
    {
        Type[] childArguments = child.GetGenericArguments();
        Type[] parentArguments = parent.GetGenericArguments();
        if (childArguments.Length == parentArguments.Length)
            for (int i = 0; i < childArguments.Length; i++)
                if (childArguments[i].Assembly != parentArguments[i].Assembly || childArguments[i].Name != parentArguments[i].Name || childArguments[i].Namespace != parentArguments[i].Namespace)
                    if (!childArguments[i].IsSubclassOf(parentArguments[i]))
                        return false;

        return true;
    }
} 
```

这是我的~~70~~ 76 个测试用例：

```
[TestMethod]
public void IsSubClassOfGenericTest()
{
    Assert.IsTrue(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(BaseGeneric<>)), " 1");
    Assert.IsFalse(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(WrongBaseGeneric<>)), " 2");
    Assert.IsTrue(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), " 3");
    Assert.IsFalse(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(IWrongBaseGeneric<>)), " 4");
    Assert.IsTrue(typeof(IChildGeneric).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), " 5");
    Assert.IsFalse(typeof(IWrongBaseGeneric<>).IsSubClassOfGeneric(typeof(ChildGeneric2<>)), " 6");
    Assert.IsTrue(typeof(ChildGeneric2<>).IsSubClassOfGeneric(typeof(BaseGeneric<>)), " 7");
    Assert.IsTrue(typeof(ChildGeneric2<Class1>).IsSubClassOfGeneric(typeof(BaseGeneric<>)), " 8");
    Assert.IsTrue(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(BaseGeneric<Class1>)), " 9");
    Assert.IsFalse(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(WrongBaseGeneric<Class1>)), "10");
    Assert.IsTrue(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(IBaseGeneric<Class1>)), "11");
    Assert.IsFalse(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(IWrongBaseGeneric<Class1>)), "12");
    Assert.IsTrue(typeof(IChildGeneric).IsSubClassOfGeneric(typeof(IBaseGeneric<Class1>)), "13");
    Assert.IsFalse(typeof(BaseGeneric<Class1>).IsSubClassOfGeneric(typeof(ChildGeneric2<Class1>)), "14");
    Assert.IsTrue(typeof(ChildGeneric2<Class1>).IsSubClassOfGeneric(typeof(BaseGeneric<Class1>)), "15");
    Assert.IsFalse(typeof(ChildGeneric).IsSubClassOfGeneric(typeof(ChildGeneric)), "16");
    Assert.IsFalse(typeof(IChildGeneric).IsSubClassOfGeneric(typeof(IChildGeneric)), "17");
    Assert.IsFalse(typeof(IBaseGeneric<>).IsSubClassOfGeneric(typeof(IChildGeneric2<>)), "18");
    Assert.IsTrue(typeof(IChildGeneric2<>).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), "19");
    Assert.IsTrue(typeof(IChildGeneric2<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), "20");
    Assert.IsFalse(typeof(IBaseGeneric<Class1>).IsSubClassOfGeneric(typeof(IChildGeneric2<Class1>)), "21");
    Assert.IsTrue(typeof(IChildGeneric2<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<Class1>)), "22");
    Assert.IsFalse(typeof(IBaseGeneric<Class1>).IsSubClassOfGeneric(typeof(BaseGeneric<Class1>)), "23");
    Assert.IsTrue(typeof(BaseGeneric<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<Class1>)), "24");
    Assert.IsFalse(typeof(IBaseGeneric<>).IsSubClassOfGeneric(typeof(BaseGeneric<>)), "25");
    Assert.IsTrue(typeof(BaseGeneric<>).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), "26");
    Assert.IsTrue(typeof(BaseGeneric<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), "27");
    Assert.IsFalse(typeof(IBaseGeneric<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<Class1>)), "28");
    Assert.IsTrue(typeof(BaseGeneric2<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<Class1>)), "29");
    Assert.IsFalse(typeof(IBaseGeneric<>).IsSubClassOfGeneric(typeof(BaseGeneric2<>)), "30");
    Assert.IsTrue(typeof(BaseGeneric2<>).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), "31");
    Assert.IsTrue(typeof(BaseGeneric2<Class1>).IsSubClassOfGeneric(typeof(IBaseGeneric<>)), "32");
    Assert.IsTrue(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(BaseGenericA<,>)), "33");
    Assert.IsFalse(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(WrongBaseGenericA<,>)), "34");
    Assert.IsTrue(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "35");
    Assert.IsFalse(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(IWrongBaseGenericA<,>)), "36");
    Assert.IsTrue(typeof(IChildGenericA).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "37");
    Assert.IsFalse(typeof(IWrongBaseGenericA<,>).IsSubClassOfGeneric(typeof(ChildGenericA2<,>)), "38");
    Assert.IsTrue(typeof(ChildGenericA2<,>).IsSubClassOfGeneric(typeof(BaseGenericA<,>)), "39");
    Assert.IsTrue(typeof(ChildGenericA2<ClassA, ClassB>).IsSubClassOfGeneric(typeof(BaseGenericA<,>)), "40");
    Assert.IsTrue(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(BaseGenericA<ClassA, ClassB>)), "41");
    Assert.IsFalse(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(WrongBaseGenericA<ClassA, ClassB>)), "42");
    Assert.IsTrue(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "43");
    Assert.IsFalse(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(IWrongBaseGenericA<ClassA, ClassB>)), "44");
    Assert.IsTrue(typeof(IChildGenericA).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "45");
    Assert.IsFalse(typeof(BaseGenericA<ClassA, ClassB>).IsSubClassOfGeneric(typeof(ChildGenericA2<ClassA, ClassB>)), "46");
    Assert.IsTrue(typeof(ChildGenericA2<ClassA, ClassB>).IsSubClassOfGeneric(typeof(BaseGenericA<ClassA, ClassB>)), "47");
    Assert.IsFalse(typeof(ChildGenericA).IsSubClassOfGeneric(typeof(ChildGenericA)), "48");
    Assert.IsFalse(typeof(IChildGenericA).IsSubClassOfGeneric(typeof(IChildGenericA)), "49");
    Assert.IsFalse(typeof(IBaseGenericA<,>).IsSubClassOfGeneric(typeof(IChildGenericA2<,>)), "50");
    Assert.IsTrue(typeof(IChildGenericA2<,>).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "51");
    Assert.IsTrue(typeof(IChildGenericA2<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "52");
    Assert.IsFalse(typeof(IBaseGenericA<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IChildGenericA2<ClassA, ClassB>)), "53");
    Assert.IsTrue(typeof(IChildGenericA2<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "54");
    Assert.IsFalse(typeof(IBaseGenericA<ClassA, ClassB>).IsSubClassOfGeneric(typeof(BaseGenericA<ClassA, ClassB>)), "55");
    Assert.IsTrue(typeof(BaseGenericA<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "56");
    Assert.IsFalse(typeof(IBaseGenericA<,>).IsSubClassOfGeneric(typeof(BaseGenericA<,>)), "57");
    Assert.IsTrue(typeof(BaseGenericA<,>).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "58");
    Assert.IsTrue(typeof(BaseGenericA<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "59");
    Assert.IsFalse(typeof(IBaseGenericA<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "60");
    Assert.IsTrue(typeof(BaseGenericA2<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "61");
    Assert.IsFalse(typeof(IBaseGenericA<,>).IsSubClassOfGeneric(typeof(BaseGenericA2<,>)), "62");
    Assert.IsTrue(typeof(BaseGenericA2<,>).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "63");
    Assert.IsTrue(typeof(BaseGenericA2<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericA<,>)), "64");
    Assert.IsFalse(typeof(BaseGenericA2<ClassB, ClassA>).IsSubClassOfGeneric(typeof(IBaseGenericA<ClassA, ClassB>)), "65");
    Assert.IsFalse(typeof(BaseGenericA<ClassB, ClassA>).IsSubClassOfGeneric(typeof(ChildGenericA2<ClassA, ClassB>)), "66");
    Assert.IsFalse(typeof(BaseGenericA2<ClassB, ClassA>).IsSubClassOfGeneric(typeof(BaseGenericA<ClassA, ClassB>)), "67");
    Assert.IsTrue(typeof(ChildGenericA3<ClassA, ClassB>).IsSubClassOfGeneric(typeof(BaseGenericB<ClassA, ClassB, ClassC>)), "68");
    Assert.IsTrue(typeof(ChildGenericA4<ClassA, ClassB>).IsSubClassOfGeneric(typeof(IBaseGenericB<ClassA, ClassB, ClassC>)), "69");
    Assert.IsFalse(typeof(ChildGenericA3<ClassB, ClassA>).IsSubClassOfGeneric(typeof(BaseGenericB<ClassA, ClassB, ClassC>)), "68-2");
    Assert.IsTrue(typeof(ChildGenericA3<ClassA, ClassB2>).IsSubClassOfGeneric(typeof(BaseGenericB<ClassA, ClassB, ClassC>)), "68-3");
    Assert.IsFalse(typeof(ChildGenericA3<ClassB2, ClassA>).IsSubClassOfGeneric(typeof(BaseGenericB<ClassA, ClassB, ClassC>)), "68-4");
    Assert.IsFalse(typeof(ChildGenericA4<ClassB, ClassA>).IsSubClassOfGeneric(typeof(IBaseGenericB<ClassA, ClassB, ClassC>)), "69-2");
    Assert.IsTrue(typeof(ChildGenericA4<ClassA, ClassB2>).IsSubClassOfGeneric(typeof(IBaseGenericB<ClassA, ClassB, ClassC>)), "69-3");
    Assert.IsFalse(typeof(ChildGenericA4<ClassB2, ClassA>).IsSubClassOfGeneric(typeof(IBaseGenericB<ClassA, ClassB, ClassC>)), "69-4");
    Assert.IsFalse(typeof(bool).IsSubClassOfGeneric(typeof(IBaseGenericB<ClassA, ClassB, ClassC>)), "70");
} 
```

用于测试的类和接口：

```
public class Class1 { }
public class BaseGeneric<T> : IBaseGeneric<T> { }
public class BaseGeneric2<T> : IBaseGeneric<T>, IInterfaceBidon { }
public interface IBaseGeneric<T> { }
public class ChildGeneric : BaseGeneric<Class1> { }
public interface IChildGeneric : IBaseGeneric<Class1> { }
public class ChildGeneric2<Class1> : BaseGeneric<Class1> { }
public interface IChildGeneric2<Class1> : IBaseGeneric<Class1> { }

public class WrongBaseGeneric<T> { }
public interface IWrongBaseGeneric<T> { }

public interface IInterfaceBidon { }

public class ClassA { }
public class ClassB { }
public class ClassC { }
public class ClassB2 : ClassB { }
public class BaseGenericA<T, U> : IBaseGenericA<T, U> { }
public class BaseGenericB<T, U, V> { }
public interface IBaseGenericB<ClassA, ClassB, ClassC> { }
public class BaseGenericA2<T, U> : IBaseGenericA<T, U>, IInterfaceBidonA { }
public interface IBaseGenericA<T, U> { }
public class ChildGenericA : BaseGenericA<ClassA, ClassB> { }
public interface IChildGenericA : IBaseGenericA<ClassA, ClassB> { }
public class ChildGenericA2<ClassA, ClassB> : BaseGenericA<ClassA, ClassB> { }
public class ChildGenericA3<ClassA, ClassB> : BaseGenericB<ClassA, ClassB, ClassC> { }
public class ChildGenericA4<ClassA, ClassB> : IBaseGenericB<ClassA, ClassB, ClassC> { }
public interface IChildGenericA2<ClassA, ClassB> : IBaseGenericA<ClassA, ClassB> { }

public class WrongBaseGenericA<T, U> { }
public interface IWrongBaseGenericA<T, U> { }

public interface IInterfaceBidonA { } 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-19T17:21:47.020

JaredPar 的代码有效，但仅适用于一级继承。对于无限级别的继承，请使用以下代码

```
public bool IsTypeDerivedFromGenericType(Type typeToCheck, Type genericType)
{
    if (typeToCheck == typeof(object))
    {
        return false;
    }
    else if (typeToCheck == null)
    {
        return false;
    }
    else if (typeToCheck.IsGenericType && typeToCheck.GetGenericTypeDefinition() == genericType)
    {
        return true;
    }
    else
    {
        return IsTypeDerivedFromGenericType(typeToCheck.BaseType, genericType);
    }
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-20T22:38:46.403

这是我创建的一个小方法，用于检查对象是否派生自特定类型。对我有用！

```
internal static bool IsDerivativeOf(this Type t, Type typeToCompare)
{
    if (t == null) throw new NullReferenceException();
    if (t.BaseType == null) return false;

    if (t.BaseType == typeToCompare) return true;
    else return t.BaseType.IsDerivativeOf(typeToCompare);
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-05-22T11:18:56.047

这可能有点矫枉过正，但我​​使用如下扩展方法。他们检查接口和子类。它还可以返回具有指定泛型定义的类型。

例如，对于问题中的示例，它可以针对泛型接口和泛型类进行测试。返回的类型可用于`GetGenericArguments`确定泛型参数类型是“SomeType”。

```
/// <summary>
/// Checks whether this type has the specified definition in its ancestry.
/// </summary>   
public static bool HasGenericDefinition(this Type type, Type definition)
{
    return GetTypeWithGenericDefinition(type, definition) != null;
}

/// <summary>
/// Returns the actual type implementing the specified definition from the
/// ancestry of the type, if available. Else, null.
/// </summary>
public static Type GetTypeWithGenericDefinition(this Type type, Type definition)
{
    if (type == null)
        throw new ArgumentNullException("type");
    if (definition == null)
        throw new ArgumentNullException("definition");
    if (!definition.IsGenericTypeDefinition)
        throw new ArgumentException(
            "The definition needs to be a GenericTypeDefinition", "definition");

    if (definition.IsInterface)
        foreach (var interfaceType in type.GetInterfaces())
            if (interfaceType.IsGenericType
                && interfaceType.GetGenericTypeDefinition() == definition)
                return interfaceType;

    for (Type t = type; t != null; t = t.BaseType)
        if (t.IsGenericType && t.GetGenericTypeDefinition() == definition)
            return t;

    return null;
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2015-02-19T19:52:30.413

这一切都可以通过 linq 轻松完成。这将找到作为通用基类 GenericBaseType 子类的任何类型。

```
 IEnumerable<Type> allTypes = Assembly.GetExecutingAssembly().GetTypes();

    IEnumerable<Type> mySubclasses = allTypes.Where(t => t.BaseType != null 
                                                            && t.BaseType.IsGenericType
                                                            && t.BaseType.GetGenericTypeDefinition() == typeof(GenericBaseType<,>)); 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-09-19T15:54:23.247

添加到@jaredpar 的答案中，这是我用来检查接口的内容：

```
public static bool IsImplementerOfRawGeneric(this Type type, Type toCheck)
{
    if (toCheck.GetTypeInfo().IsClass)
    {
        return false;
    }

    return type.GetInterfaces().Any(interfaceType =>
    {
        var current = interfaceType.GetTypeInfo().IsGenericType ?
                    interfaceType.GetGenericTypeDefinition() : interfaceType;
        return current == toCheck;
    });
}

public static bool IsSubTypeOfRawGeneric(this Type type, Type toCheck)
{
    return type.IsInterface ?
          IsImplementerOfRawGeneric(type, toCheck)
        : IsSubclassOfRawGeneric(type, toCheck);
} 
```

前任：

```
Console.WriteLine(typeof(IList<>).IsSubTypeOfRawGeneric(typeof(IList<int>))); // true 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-12-05T22:00:47.143

简单的解决方案：只需为泛型类创建并添加第二个非泛型接口：

```
public interface IGenericClass
{
}

public class GenericClass<T> : GenericInterface<T>, IGenericClass
{
} 
```

然后只需以您喜欢的任何方式使用`is`, `as`,`IsAssignableFrom`等来检查它。

```
if (thing is IGenericClass)
{
    // Do work
{ 
```

显然，只有当您有能力编辑泛型类（OP 似乎有）时才有可能，但它比使用神秘的扩展方法更优雅和可读。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-03-12T11:54:05.740

基于上述 fir3rpho3nixx 和 David Schmitt 的出色答案，我修改了他们的代码并添加了 ShouldInheritOrImplementTypedGenericInterface 测试（最后一个）。

```
 /// <summary>
    /// Find out if a child type implements or inherits from the parent type.
    /// The parent type can be an interface or a concrete class, generic or non-generic.
    /// </summary>
    /// <param name="child"></param>
    /// <param name="parent"></param>
    /// <returns></returns>
    public static bool InheritsOrImplements(this Type child, Type parent)
    {
        var currentChild = parent.IsGenericTypeDefinition && child.IsGenericType ? child.GetGenericTypeDefinition() : child;

        while (currentChild != typeof(object))
        {
            if (parent == currentChild || HasAnyInterfaces(parent, currentChild))
                return true;

            currentChild = currentChild.BaseType != null && parent.IsGenericTypeDefinition && currentChild.BaseType.IsGenericType
                                ? currentChild.BaseType.GetGenericTypeDefinition()
                                : currentChild.BaseType;

            if (currentChild == null)
                return false;
        }
        return false;
    }

    private static bool HasAnyInterfaces(Type parent, Type child)
    {
        return child.GetInterfaces().Any(childInterface =>
            {
                var currentInterface = parent.IsGenericTypeDefinition && childInterface.IsGenericType
                    ? childInterface.GetGenericTypeDefinition()
                    : childInterface;

                return currentInterface == parent;
            });

    }

    [Test]
    public void ShouldInheritOrImplementNonGenericInterface()
    {
        Assert.That(typeof(FooImplementor)
            .InheritsOrImplements(typeof(IFooInterface)), Is.True);
    }

    [Test]
    public void ShouldInheritOrImplementGenericInterface()
    {
        Assert.That(typeof(GenericFooBase)
            .InheritsOrImplements(typeof(IGenericFooInterface<>)), Is.True);
    }

    [Test]
    public void ShouldInheritOrImplementGenericInterfaceByGenericSubclass()
    {
        Assert.That(typeof(GenericFooImplementor<>)
            .InheritsOrImplements(typeof(IGenericFooInterface<>)), Is.True);
    }

    [Test]
    public void ShouldInheritOrImplementGenericInterfaceByGenericSubclassNotCaringAboutGenericTypeParameter()
    {
        Assert.That(new GenericFooImplementor<string>().GetType()
            .InheritsOrImplements(typeof(IGenericFooInterface<>)), Is.True);
    }

    [Test]
    public void ShouldNotInheritOrImplementGenericInterfaceByGenericSubclassNotCaringAboutGenericTypeParameter()
    {
        Assert.That(new GenericFooImplementor<string>().GetType()
            .InheritsOrImplements(typeof(IGenericFooInterface<int>)), Is.False);
    }

    [Test]
    public void ShouldInheritOrImplementNonGenericClass()
    {
        Assert.That(typeof(FooImplementor)
            .InheritsOrImplements(typeof(FooBase)), Is.True);
    }

    [Test]
    public void ShouldInheritOrImplementAnyBaseType()
    {
        Assert.That(typeof(GenericFooImplementor<>)
            .InheritsOrImplements(typeof(FooBase)), Is.True);
    }

    [Test]
    public void ShouldInheritOrImplementTypedGenericInterface()
    {
        GenericFooImplementor<int> obj = new GenericFooImplementor<int>();
        Type t = obj.GetType();

        Assert.IsTrue(t.InheritsOrImplements(typeof(IGenericFooInterface<int>)));
        Assert.IsFalse(t.InheritsOrImplements(typeof(IGenericFooInterface<String>)));
    } 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-01-21T22:43:41.370

贾里德帕尔，

如果我将 typeof(type<>) 作为 toCheck 传递，这对我不起作用。这是我改变的。

```
static bool IsSubclassOfRawGeneric(Type generic, Type toCheck) {
    while (toCheck != typeof(object)) {
        var cur = toCheck.IsGenericType ? toCheck.GetGenericTypeDefinition() : toCheck;
          if (cur.IsGenericType && generic.GetGenericTypeDefinition() == cur.GetGenericTypeDefinition()) {
            return true;
        }
        toCheck = toCheck.BaseType;
    }
    return false;
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-12-20T07:12:21.753

@EnocNRoll - Ananda Gopal 的回答很有趣，但如果实例没有事先实例化，或者您想检查泛型类型定义，我建议使用这种方法：

```
public static bool TypeIs(this Type x, Type d) {
    if(null==d) {
        return false;
    }

    for(var c = x; null!=c; c=c.BaseType) {
        var a = c.GetInterfaces();

        for(var i = a.Length; i-->=0;) {
            var t = i<0 ? c : a[i];

            if(t==d||t.IsGenericType&&t.GetGenericTypeDefinition()==d) {
                return true;
            }
        }
    }

    return false;
} 
```

并像这样使用它：

```
var b = typeof(char[]).TypeIs(typeof(IList<>)); // true 
```

`t`当（要测试的）和都是泛型类型时，有四种条件情况，`d`并且两种情况都包含在`t==d`其中*（1）既不是泛型定义`t`也不`d`是泛型定义*或*（2）它们都是泛型定义*。其余的情况是其中一个是泛型​​定义，只有当`d`已经是泛型定义时，我们才有机会说*a`t`是 a`d`*但反之亦然。

它应该适用于您要测试的任意类或接口，并返回就好像您使用`is`运算符测试该类型的实例一样。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-24T12:53:18.853

```
Type _type = myclass.GetType();
PropertyInfo[] _propertyInfos = _type.GetProperties();
Boolean _test = _propertyInfos[0].PropertyType.GetGenericTypeDefinition() 
== typeof(List<>); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-03-17T12:44:55.123

你可以试试这个扩展

```
 public static bool IsSubClassOfGenericClass(this Type type, Type genericClass,Type t)
    {
        return type.IsSubclassOf(genericClass.MakeGenericType(new[] { t }));
    } 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-11-17T19:08:18.610

这场比赛迟到了……我也对 JarodPar 的回答有另一种排列方式。

这是反射器提供的 Type.IsSubClassOf(Type)：

```
 public virtual bool IsSubclassOf(Type c)
    {
        Type baseType = this;
        if (!(baseType == c))
        {
            while (baseType != null)
            {
                if (baseType == c)
                {
                    return true;
                }
                baseType = baseType.BaseType;
            }
            return false;
        }
        return false;
    } 
```

从那里，我们看到它并没有做任何事情，并且类似于 JaredPar 的迭代方法。到目前为止，一切都很好。这是我的版本（免责声明：未经彻底测试，所以如果你发现问题，请告诉我）

```
 public static bool IsExtension(this Type thisType, Type potentialSuperType)
    {
        //
        // protect ya neck
        //
        if (thisType == null || potentialSuperType == null || thisType == potentialSuperType) return false;

        //
        // don't need to traverse inheritance for interface extension, so check/do these first
        //
        if (potentialSuperType.IsInterface)
        {
            foreach (var interfaceType in thisType.GetInterfaces())
            {
                var tempType = interfaceType.IsGenericType ? interfaceType.GetGenericTypeDefinition() : interfaceType;

                if (tempType == potentialSuperType)
                {
                    return true;
                }
            }
        }

        //
        // do the concrete type checks, iterating up the inheritance chain, as in orignal
        //
        while (thisType != null && thisType != typeof(object))
        {
            var cur = thisType.IsGenericType ? thisType.GetGenericTypeDefinition() : thisType;

            if (potentialSuperType == cur)
            {
                return true;
            }

            thisType = thisType.BaseType;
        }
        return false;
    } 
```

基本上，这只是 System.Type 的一种扩展方法——我这样做是为了故意将“thisType”类型限制为具体类型，因为我的直接用途是针对 Type 对象查询“where”谓词。我敢肯定，如果你需要的话，你们所有聪明的人都可以把它变成一个高效的、通用的静态方法:) 代码做了一些答案的代码没有做的事情

1.  开放到一般的“扩展” - 我正在考虑继承（想想类）以及实现（接口）；更改方法和参数名称以更好地反映这一点
2.  输入空值验证（meah）
3.  相同类型的输入（类不能扩展自身）
4.  如果所讨论的类型是接口，则短路执行；因为 GetInterfaces() 返回所有实现的接口（甚至是在超类中实现的接口），您可以简单地循环遍历该集合，而不必爬上继承树

其余的和JaredPar的代码基本一样

# c# - TabControl 上下文菜单

> ID：457677
> 
> 赞同：7
> 
> 时间：2009-01-19T14:10:42.897
> 
> 标签：c#, winforms, tabcontrol, contextmenu

在 Windows 窗体应用程序中，我在 TabControl 上设置了 ContextMenuStrip 属性。

1.  如何告诉用户单击了当前选择的选项卡以外的选项卡？
2.  如何限制上下文菜单仅在单击带有标签的顶部选项卡部分时才显示，而不是在选项卡的其他位置显示？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-05-09T20:35:13.707

上下文菜单的打开事件可以用来解决这两个问题

```
private void contextMenuStrip1_Opening(object sender, CancelEventArgs e)
{            
    Point p = this.tabControl1.PointToClient(Cursor.Position);
    for (int i = 0; i < this.tabControl1.TabCount; i++)
    {
        Rectangle r = this.tabControl1.GetTabRect(i);
        if (r.Contains(p))
        {
            this.tabControl1.SelectedIndex = i; // i is the index of tab under cursor
            return;
        }
    }
    e.Cancel = true;
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-19T14:28:48.633

不要费心在 TabControl 上设置 contextMenuStrip 属性。而是这样做。连接到 tabControl 的 MouseClick 事件，然后手动显示上下文菜单。这只会在单击顶部的选项卡本身而不是实际页面时触发。如果单击页面，则 tabControl 不会收到单击事件，而 TabPage 会收到。一些代码：

```
public Form1()
{
    InitializeComponent();
    this.tabControl1.MouseClick += new MouseEventHandler(tabControl1_MouseClick);
}

private void tabControl1_MouseClick(object sender, MouseEventArgs e)
{
    if (e.Button == MouseButtons.Right)
    {
        this.contextMenuStrip1.Show(this.tabControl1, e.Location);
    }

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-06-18T01:11:34.907

有点晚了，但我已经为你的问题的第一部分找到了解决方案。您可以通过向应用程序发送鼠标左键单击来确定右键单击了哪个选项卡。这将选择选项卡，因此现在您可以使用 TabControl.SelectedTab 属性来获取用户右键单击的选项卡。

```
 [DllImport("user32.dll", CharSet = CharSet.Auto, CallingConvention = CallingConvention.StdCall)]
    private static extern void mouse_event(long dwFlags, long dx, long dy, long cButtons, long dwExtraInfo);

    private const int MOUSEEVENTF_LEFTDOWN = 0x02;
    private const int MOUSEEVENTF_LEFTUP = 0x04;
    private const int MOUSEEVENTF_RIGHTDOWN = 0x08;
    private const int MOUSEEVENTF_RIGHTUP = 0x10;

    private static void SendLeftMouseClick()
    {
        int x = Cursor.Position.X;
        int y = Cursor.Position.Y;
        mouse_event(MOUSEEVENTF_LEFTDOWN | MOUSEEVENTF_LEFTUP, x, y, 0, 0);
    }

    public Form1()
    {
        InitializeComponent();

        tabControl1.MouseDown += new MouseEventHandler(tabControl1_MouseDown);
        tabControl1.MouseUp += new MouseEventHandler(tabControl1_MouseUp);
    }

    void tabControl1_MouseDown(object sender, MouseEventArgs e)
    {
        if (e.Button == MouseButtons.Right)
        {
            // Send a left mouse click to select the tab that the user clicked on.
            SendLeftMouseClick();
        }
    }

    void tabControl1_MouseUp(object sender, MouseEventArgs e)
    {
        if (e.Button == MouseButtons.Right)
        {
            // To show a context menu for only the tab button but not the content of the tab,
            // we must show it in the tab control's mouse up event.
            contextMenuStrip1.Show((Control)sender, e.Location);
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-22T13:56:57.113

我一直在为完全相同的问题寻找解决方案。
在测试了@nisar 和@BFree 的答案后，我得出了这个结论（我在表单的某个地方的面板中也有 TabControl`）：

*   创建tabcontrol1
*   订阅 MouseClick 事件
*   创建 contextMenuTabs、ContextMenuStrip

```
private void tabControl1_MouseClick(object sender, MouseEventArgs e)
{
    if (e.Button == MouseButtons.Right)
    {
        Point ee = new Point(e.Location.X - panel1.Left, e.Location.Y - panel1.Top);
        for (int i = 0; i < this.tabControl1.TabCount; i++)
        {
            Rectangle r = this.tabControl1.GetTabRect(i);
            if (r.Contains(ee))
            {
                if (this.tabControl1.SelectedIndex == i)
                    this.contextMenuTabs.Show(this.tabControl1, e.Location);
                else 
                    {
                      //if a non seelcted page was clicked we detected it here!!
                    }

                break;
            }
        }
    }
} 
```

# ldap - 如何在 J2SE 中使用 Novell eDirectory 服务？

> ID：457682
> 
> 赞同：1
> 
> 时间：2009-01-19T14:11:38.620
> 
> 标签：ldap, java, edirectory

如何在 J2SE 中使用 Novell eDirectory 服务？JNDI 将与 eDirectory 一起使用吗？我可以使用哪些资源来了解您建议的任何一个或多个库？

我现在只想尝试通过 LDAP 检索信息，如果我让事情按我想要的方式工作，我以后可能需要能够修改对象。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T14:59:24.657

JNDI 应该与 eDirectory 一起使用.....

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-08T11:44:33.880

尝试; [http://developer.novell.com/wiki/index.php/Jldap](http://developer.novell.com/wiki/index.php/Jldap)和[http://developer.novell.com/wiki/index.php/Novell_LDAP_Extended_Library](http://developer.novell.com/wiki/index.php/Novell_LDAP_Extended_Library)

将它与 OpenLDAP 一起成功使用，并且对于 eDirectory 也应该足够了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T18:28:02.487

您要使用的任何 LDAP 界面都应该可以正常工作于 eDirectory。

请注意，LDAP 服务器的配置可能不允许明文密码，因此通过 SSL（您已经将证书导入密钥库）或通过 TLS（即时检索树 CA 的公钥）绑定到端口 636 .

如果您对 eDirectory 服务器具有管理访问权限，则可以轻松更改它，但最好还是确认您可以让它通过 SSL/TLS（也称为 LDAPS）工作。

如果你真的需要它，你可以向管理员询问一个只有某个测试分区副本的服务器（因此在它的视图中没有真实的用户数据），并通过明文对此进行测试。

在 eDirectory 中添加分区的新副本、分割或合并分区非常容易，所有这些都可以实时完成。

在一台服务器上托管许多分区的副本同样非常容易。（官方的限制是，对树中的数量或分区，或服务器上的副本没有限制，但在旧版本（8.x 之前）中它曾经是 256）

如果您被允许访问 eDirectory 服务器，您想请求访问 Dstrace（这有几个版本，请参阅[Dstrace 的许多方面](http://www.novell.com/communities/node/4418/the-many-faces-dstrace)）。有一个网络接口（服务器：Netware 上的 8008，Windows 上的 8010，Unix/Linux 上通常为 8028）或其他接口。如果您启用 LDAP 跟踪选项（并关闭所有其他选项），您可以相当完整地调试服务器端正在发生的事情。查看错误、沟通或缺乏沟通等。

# java - 使用 Java 将 HTML 文件读取到 DOM 树

> ID：457684
> 
> 赞同：12
> 
> 时间：2009-01-19T14:12:28.820
> 
> 标签：java, html, dom, parsing

是否有能够使用 Java 将 HTML 文档读入 DOM 树的解析器/库？我想使用`DOM/Xpath`Java 提供的标准 API。

大多数库似乎都有自定义 API 来解决此任务。此外，大多数可用的解析器似乎都不支持将 HTML 转换为 XML-DOM。

对一个好的 HTML DOM 解析器有什么想法或经验吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T14:29:17.150

[JTidy](http://jtidy.sourceforge.net/)，或者通过将流处理为 XHTML，然后使用您最喜欢的 DOM 实现重新解析，或者如果提供给您的有限 DOM imp 就足够了，则使用 parseDOM。

或者[Neko](http://nekohtml.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-21T12:45:36.393

由于 HTML 文件通常存在问题，因此您需要首先使用解析器/扫描器清理它们。我用过 JTidy，但从来没有开心过。NekoHTML 工作正常，但这些工具中的任何一个都只是对预期的内容做出最佳猜测。您实际上是在要求让程序更改文档的标记，直到它符合模式。这可能会导致结构（标记）、样式或内容丢失。这是不可避免的，除非您通过浏览器手动扫描（然后您也必须信任浏览器），否则您不会真正知道丢失了什么。

这真的取决于你的目的——如果你有成千上万个带有大量无关（非 HTML）标记的丑陋文档，那么手动过程可能是不合理的。如果您的目标是一些重要文件的准确性，那么手动修复它们是一个合理的建议。

一种方法是手动过程，在编辑周期中通过格式正确和/或验证解析器重复传递源代码，使用错误消息最终修复损坏的标记。这确实需要对 XML 有一定的了解，但这并不是一个糟糕的教育。

在 Java 5 中，必要的 XML 特性（称为 JAXP API）现在已内置到 Java 本身中；您不需要任何外部库。

您首先获取 DocumentBuilderFactory 的实例，设置其功能，创建 DocumentBuilder（解析器），然后使用 InputSource 调用其 parse() 方法。InputSource 有许多可能的构造函数，下面的示例中使用了 StringReader：

```
import javax.xml.parsers.*;
// ...

DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
dbf.setValidating(false);
dbf.setNamespaceAware(true);
dbf.setIgnoringComments(false);
dbf.setIgnoringElementContentWhitespace(false);
dbf.setExpandEntityReferences(false);
DocumentBuilder db = dbf.newDocumentBuilder();
return db.parse(new InputSource(new StringReader(source))); 
```

这将返回一个 DOM 文档。如果您不介意使用外部库，那么还有 JDOM 和 XOM API，虽然它们比 JAXP 中的 SAX 和 DOM API 有一些优势，但它们确实需要添加非 Java 库。DOM 可能有点麻烦，但是在使用了这么多年之后，我不再介意了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-29T10:57:47.653

这是一个可能有用的链接。它是 Java 中的开源 HTML 解析器列表 Java中的[开源 HTML 解析器](http://java-source.net/open-source/html-parsers)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T14:31:20.733

[TagSoup](http://home.ccil.org/~cowan/XML/tagsoup/)可以为所欲为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-02-08T07:30:02.503

使用[https://jsoup.org](https://jsoup.org)，这很简单，而且 power.can 可以读取和更改 html。

样本：

```
Document doc = Jsoup.parse(page);  //page can be a file or string.
Element main = doc.getElementById("MainView");
Elements links = doc.select(".link"); 
```

对于创建元素可以使用j2html，[https: //j2html.com](https://j2html.com)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-19T14:24:13.853

[Apache 的 Xerces2 解析器](http://xerces.apache.org/xerces2-j/)应该可以满足您的需求。

# c# - 如何在一个 SQL 查询中检索值并在存储过程中使用它？

> ID：457688
> 
> 赞同：1
> 
> 时间：2009-01-19T14:13:49.007
> 
> 标签：c#, sql, sql-server, asp.net-2.0

我正在编写一个 Silverlight 客户端，它通过我也在开发的 ASP.NET 2.0 Web 服务与 SQL 数据库进行交互。其中一项服务需要返回存储过程的结果，并且运行良好。但是，在执行存储过程之前，需要从不同的位置检索存储过程的一个参数，并且这个对数据库的额外请求会导致明显的减速（当我缓存检索到的值而不是每次调用都获取它时很明显）。

不幸的是，缓存该值对我的情况无效，我宁愿将该值的检索和随后的存储过程执行组合到一个查询中，以便服务器可以优化请求。但是，我的 SQL 并不强大，而且我一点也不知道该怎么做。

这个值，我们称之为`tasktype`，是通过一个键引用的，`id`。存储过程`getrecords`接受一些参数，包括`tasktype`，但可以假设其他参数值在调用查询时是已知的。存储过程返回一个记录表。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T14:21:42.673

好吧，它可能是这样的：

```
 cmd.CommandType = CommandType.Text;
    cmd.Parameters.AddWithValue("@id", ...); // your id arg
    cmd.Parameters.AddWithValue(... , ...); // your other args...
    cmd.CommandText = @"
DECLARE @TaskType int -- or whatever

SELECT @TaskType = // some existing query based on @id

EXEC getrecords @TaskType, ...
"; 
```

但是，您可能必须澄清如何获得任务类型。

您应该可以将其用作`IDataReader`，或使用`DataTable.Load`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T14:29:31.347

您应该能够创建一个 UDF，它将获取 tasktype 的值并从您的数据检索存储过程中调用它。

就像是

```
CREATE FUNCTION dbo.TaskType()
Returns int
   SELECT ... stuff that gets task type
END 
```

然后从您的数据检索存储过程调用

```
DECLARE tasktype int

SELECT tasktype = dbo.TaskType 
```

或类似的东西......可能需要一些返工:-)

# wpf - WPF：自定义窗口

> ID：457689
> 
> 赞同：8
> 
> 时间：2009-01-19T14:14:03.450
> 
> 标签：wpf, window

有很多文章描述了如何在 WPF 中创建自定义形状的窗口，但没有一篇（至少我找不到）描述了如何构建一个可重用的窗口，例如在其他窗口中继承它。

我试图从我的自定义窗口创建一个 ControlTemplate。问题在于关闭按钮和 MoveDrag() 方法。

如果我将事件连接到 ControlTemplate 中的其他控件之一，它们的 Parent 属性为空，因此我无法拖动或关闭窗口。

有谁知道如何创建可重用的自定义窗口模板或其他东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T21:15:37.217

不幸的是，WPF 中没有视觉继承之类的东西。（没有更具体的 xaml 继承）

对于您的特定问题，您可以创建一个 CustomForm 作为模板（中间有一个大的空容器），而不是继承，然后将所有其他表单创建为填充该容器的用户控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T06:59:23.737

以下将返回包含控件的窗口对象：

```
Window.GetWindow(myControl) 
```

# git-svn - 如何将 Git 存储库提交到空的存储库 SVN 服务器？

> ID：457694
> 
> 赞同：14
> 
> 时间：2009-01-19T14:15:24.743
> 
> 标签：git-svn

我在服务器上设置了一个空的 svn，并且一直在本地进行提交。现在我希望将我的 repo 提交到 svn 服务器。为此，我尝试了：

```
git-svn checkout http://remote.svn.server.com
git-svn dcommit 
```

Git抱怨说：

```
Use of uninitialized value in concatenation (.) or string at /usr/bin/git-svn line 411.
Committing to  ...
Unable to determine upstream SVN information from HEAD history 
```

由于我首先在本地计算机上开始，并且在线回购是空的，所以我找不到任何有关如何使这项工作的信息。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-11T15:18:51.843

我最近需要这样的东西，这个过程相对简单。

Brandon Dimcheff 有一个很好的教程，[“Commit a linear git history to subversion”](http://brandon.dimcheff.com/2009/01/04/commit-a-linear-git-history-to-subversion/)（替换[旧的断开链接](http://its.arubything.com/2009/1/4/commit-a-linear-git-history-to-subversion)），这些步骤都基于该教程。

从 Git 版本 1.6.3 开始，这些是步骤：

```
$ svnadmin create svn_repository
$ svn mkdir -m "Initial setup" file:///full/path/to/svn_repository/trunk

$ mkdir gitrepo && cd gitrepo
$ git init
$ echo 'Hello from Git' > file.txt
$ git add file.txt
$ git commit -m "Hello from Git"

$ git svn init --trunk=trunk file:///full/path/to/svn_repository/
$ git svn fetch

$ git branch -a # Lists remotes/trunk

$ git rebase --onto remotes/trunk --root master
# => Applying: Hello from Git etc.

$ git svn dcommit
# => Committing to ... Committed r2 ... etc 
```

您现在可以执行`svn checkout`svn_repository 并查看您的 Git 存储库。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-20T00:21:28.030

这是我要做的：

```
git-svn clone http://remote.svn.server.com otherdir 
```

然后在其他目录中从您以前的目录中提取本地更改。然后你应该有一个通过 git-svn “连接”的 git repo，你应该能够在它上面使用 dcommit。

[这](http://wiki.apache.org/general/GitAtApache)也可能是一个有用的阅读。

# java - 在 C#、Java 和 PHP 中读取 Excel 文件和评估公式时，我有哪些选择？

> ID：457696
> 
> 赞同：1
> 
> 时间：2009-01-19T14:15:48.813
> 
> 标签：java, c#, php, import-from-excel

我见过各种读取（和写入）Excel 电子表格的方法。例如：

*   在 .Net 中作为 ADO.Net 源（根据[Reading Excel files from C#](https://stackoverflow.com/questions/15828/reading-excel-files-from-c)）；
*   在带有[JExcelAPI](http://jexcelapi.sourceforge.net/) ("jxl") 或 Apache [POI](http://poi.apache.org/)的 Java 中；
*   在使用 Excel 电子表格编写器的 PHP 中（根据通过 PHP和PHP[格式化 Excel 文件中的文本](https://stackoverflow.com/questions/279917/format-text-in-excel-file-via-php)[：使用 PEAR 写入 excel 文件](https://stackoverflow.com/questions/388816/phpwriting-to-excel-file-using-pear)）。

但我感兴趣的不仅仅是读/写 Excel 文件。我想要一些可以评估任意 Excel 公式的东西。到目前为止，我已经看到了这种情况：

*   [C# Excel Interop](http://support.microsoft.com/kb/302084)，尽管这似乎需要您运行 Excel；和
*   [POI-HSSF](http://poi.apache.org/spreadsheet/index.html)：这个公式支持似乎不完整。

有更好的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T14:28:21.770

如果您只针对 Windows 平台，那么您确实无法替代运行 Excel，并通过 COM 桥接器控制它。

正如您所发现的，任何其他解决方案都可能是

*   不完整，和/或
*   不兼容和/或
*   不一致的

用 Excel。

不幸的是，这确实为您的软件增加了对 Excel 的依赖。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T14:57:27.000

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)与 Excel 足够兼容，[Microsoft 使用它](http://www.spreadsheetgear.com/customers/microsoft.msn.money.asp)在其 MSN Money 网站上计算基于 Excel 的计算器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:13:53.033

如果您想评估 Excel 公式，坦率地说，Excel 是唯一可靠的方法。因此，通过 COM 桥运行 Excel 是可行的方法。

我以前在 Java 中使用[JACOB](http://sourceforge.net/projects/jacob-project/)做过这个，效果很好。Excel 负责所有功能。您只需填充您的电子表格（在内存中），然后让 Excel 完成剩下的工作。

# css - CSS、WordPress 和 IE

> ID：457698
> 
> 赞同：0
> 
> 时间：2009-01-19T14:16:15.787
> 
> 标签：css, wordpress, internet-explorer, css-float

我想使用浮动在 CSS 中定位三个项目。

1.  在左上角--标志
2.  在标志的右侧，导航，它是一个无序列表，即向左浮动。
3.  在右上角，2 行注册时事通讯字段 - 复制顶行和表单字段，第二个提交底部

我给了每个它自己的 Div 标签，但看不到让它与 float 一起工作。只有在调整网站大小时看起来不太好的绝对定位。我现在在 div 中放置了一个表格，但我会喜欢一个纯 CSS 解决方案。

我可以让徽标向左浮动，注册字段向右浮动，但似乎无法正确定位导航。要么它一直向左走，要么我把它放在标志和字段下方。

任何建议，将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T17:21:06.897

下面的呢？

```
 .floatleft_logo
    {
        float: left;
        width: 200px;
    }

    .floatleft_nav
    {
        float: left;
        width: 600px;
    }
    .floatright_email
    {
        float: right;
        width: 300px;
        margin-left:-250px;
    } 
```

将这三个都放在一个 850 像素宽的容器 div 中，这对我来说在测试页面中有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T14:25:10.857

如果我理解正确，也许您可​​以将第一个和第二个元素设置为 float:left，然后将第三个元素的边距设置为等于第一个和第二个的宽度？

您还可以将第一个元素设置为向左浮动，将第三个元素设置为向右浮动，第二个元素的边距等于第一个元素的宽度。就像一个三列布局。

# html - 如何从 SQL Server 中的字符串中去除 HTML 标记？

> ID：457701
> 
> 赞同：133
> 
> 时间：2009-01-19T14:17:18.890
> 
> 标签：html, sql, sql-server, string, sql-server-2005

我在 SQL Server 2005 中有包含 HTML 标记的数据，我想去掉所有这些，只留下标记之间的文本。理想情况下，还可以替换诸如`&lt;`with之类的东西`<`。

有没有一种简单的方法可以做到这一点，或者有人已经得到了一些示例 T-SQL 代码？

我没有能力添加扩展存储过程等，所以更喜欢纯 T-SQL 方法（最好是向后兼容 SQL 2000）。

我只想用剥离的 HTML 检索数据，而不是更新它，所以理想情况下它将被编写为用户定义的函数，以便于重用。

所以例如转换这个：

```
<B>Some useful text</B>&nbsp;
<A onclick="return openInfo(this)"
   href="http://there.com/3ce984e88d0531bac5349"
   target=globalhelp>
   <IMG title="Source Description" height=15 alt="Source Description" 
        src="/ri/new_info.gif" width=15 align=top border=0>
</A>&gt;&nbsp;<b>more text</b></TD></TR> 
```

对此：

```
Some useful text > more text 
```

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2009-01-19T14:24:47.690

有一个 UDF 可以执行此处描述的操作：

[用于剥离 HTML 的用户定义函数](http://blog.sqlauthority.com/2007/06/16/sql-server-udf-user-defined-function-to-strip-html-parse-html-no-regular-expression/)

```
CREATE FUNCTION [dbo].[udf_StripHTML] (@HTMLText VARCHAR(MAX))
RETURNS VARCHAR(MAX) AS
BEGIN
    DECLARE @Start INT
    DECLARE @End INT
    DECLARE @Length INT
    SET @Start = CHARINDEX('<',@HTMLText)
    SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText))
    SET @Length = (@End - @Start) + 1
    WHILE @Start > 0 AND @End > 0 AND @Length > 0
    BEGIN
        SET @HTMLText = STUFF(@HTMLText,@Start,@Length,'')
        SET @Start = CHARINDEX('<',@HTMLText)
        SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText))
        SET @Length = (@End - @Start) + 1
    END
    RETURN LTRIM(RTRIM(@HTMLText))
END
GO 
```

编辑：请注意这是针对 SQL Server 2005 的，但如果您将关键字 MAX 更改为 4000 之类的东西，它也可以在 SQL Server 2000 中使用。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2016-09-16T13:03:49.200

源自@Goner Doug 的回答，更新了一些内容：
- 尽可能使用 REPLACE
- 预定义实体的转换`&eacute;`（我选择了我需要的实体 :-)
- 列表标签的一些转换`<ul> and <li>`

```
ALTER FUNCTION [dbo].[udf_StripHTML]
--by Patrick Honorez --- www.idevlop.com
--inspired by http://stackoverflow.com/questions/457701/best-way-to-strip-html-tags-from-a-string-in-sql-server/39253602#39253602
(
@HTMLText varchar(MAX)
)
RETURNS varchar(MAX)
AS
BEGIN
DECLARE @Start  int
DECLARE @End    int
DECLARE @Length int

set @HTMLText = replace(@htmlText, '<br>',CHAR(13) + CHAR(10))
set @HTMLText = replace(@htmlText, '<br/>',CHAR(13) + CHAR(10))
set @HTMLText = replace(@htmlText, '<br />',CHAR(13) + CHAR(10))
set @HTMLText = replace(@htmlText, '<li>','- ')
set @HTMLText = replace(@htmlText, '</li>',CHAR(13) + CHAR(10))

set @HTMLText = replace(@htmlText, '&rsquo;' collate Latin1_General_CS_AS, ''''  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&quot;' collate Latin1_General_CS_AS, '"'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&amp;' collate Latin1_General_CS_AS, '&'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&euro;' collate Latin1_General_CS_AS, '€'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&lt;' collate Latin1_General_CS_AS, '<'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&gt;' collate Latin1_General_CS_AS, '>'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&oelig;' collate Latin1_General_CS_AS, 'oe'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&nbsp;' collate Latin1_General_CS_AS, ' '  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&copy;' collate Latin1_General_CS_AS, '©'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&laquo;' collate Latin1_General_CS_AS, '«'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&reg;' collate Latin1_General_CS_AS, '®'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&plusmn;' collate Latin1_General_CS_AS, '±'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&sup2;' collate Latin1_General_CS_AS, '²'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&sup3;' collate Latin1_General_CS_AS, '³'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&micro;' collate Latin1_General_CS_AS, 'µ'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&middot;' collate Latin1_General_CS_AS, '·'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ordm;' collate Latin1_General_CS_AS, 'º'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&raquo;' collate Latin1_General_CS_AS, '»'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&frac14;' collate Latin1_General_CS_AS, '¼'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&frac12;' collate Latin1_General_CS_AS, '½'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&frac34;' collate Latin1_General_CS_AS, '¾'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&Aelig' collate Latin1_General_CS_AS, 'Æ'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&Ccedil;' collate Latin1_General_CS_AS, 'Ç'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&Egrave;' collate Latin1_General_CS_AS, 'È'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&Eacute;' collate Latin1_General_CS_AS, 'É'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&Ecirc;' collate Latin1_General_CS_AS, 'Ê'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&Ouml;' collate Latin1_General_CS_AS, 'Ö'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&agrave;' collate Latin1_General_CS_AS, 'à'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&acirc;' collate Latin1_General_CS_AS, 'â'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&auml;' collate Latin1_General_CS_AS, 'ä'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&aelig;' collate Latin1_General_CS_AS, 'æ'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ccedil;' collate Latin1_General_CS_AS, 'ç'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&egrave;' collate Latin1_General_CS_AS, 'è'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&eacute;' collate Latin1_General_CS_AS, 'é'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ecirc;' collate Latin1_General_CS_AS, 'ê'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&euml;' collate Latin1_General_CS_AS, 'ë'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&icirc;' collate Latin1_General_CS_AS, 'î'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ocirc;' collate Latin1_General_CS_AS, 'ô'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ouml;' collate Latin1_General_CS_AS, 'ö'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&divide;' collate Latin1_General_CS_AS, '÷'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&oslash;' collate Latin1_General_CS_AS, 'ø'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ugrave;' collate Latin1_General_CS_AS, 'ù'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&uacute;' collate Latin1_General_CS_AS, 'ú'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&ucirc;' collate Latin1_General_CS_AS, 'û'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&uuml;' collate Latin1_General_CS_AS, 'ü'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&quot;' collate Latin1_General_CS_AS, '"'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&amp;' collate Latin1_General_CS_AS, '&'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&lsaquo;' collate Latin1_General_CS_AS, '<'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&rsaquo;' collate Latin1_General_CS_AS, '>'  collate Latin1_General_CS_AS)

-- Remove anything between <STYLE> tags
SET @Start = CHARINDEX('<STYLE', @HTMLText)
SET @End = CHARINDEX('</STYLE>', @HTMLText, CHARINDEX('<', @HTMLText)) + 7
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '')
SET @Start = CHARINDEX('<STYLE', @HTMLText)
SET @End = CHARINDEX('</STYLE>', @HTMLText, CHARINDEX('</STYLE>', @HTMLText)) + 7
SET @Length = (@End - @Start) + 1
END

-- Remove anything between <whatever> tags
SET @Start = CHARINDEX('<', @HTMLText)
SET @End = CHARINDEX('>', @HTMLText, CHARINDEX('<', @HTMLText))
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '')
SET @Start = CHARINDEX('<', @HTMLText)
SET @End = CHARINDEX('>', @HTMLText, CHARINDEX('<', @HTMLText))
SET @Length = (@End - @Start) + 1
END

RETURN LTRIM(RTRIM(@HTMLText))

END 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2016-08-31T15:28:52.560

这是此函数的更新版本，其中包含[RedFilter 答案](https://stackoverflow.com/a/457725/1501497)（Pinal 的原始版本）与 LazyCoders 添加和 goodeye 错字更正以及我自己添加的用于处理`<STYLE>`HTML 内的内联标签。

```
ALTER FUNCTION [dbo].[udf_StripHTML]
(
@HTMLText varchar(MAX)
)
RETURNS varchar(MAX)
AS
BEGIN
DECLARE @Start  int
DECLARE @End    int
DECLARE @Length int

-- Replace the HTML entity &amp; with the '&' character (this needs to be done first, as
-- '&' might be double encoded as '&amp;amp;')
SET @Start = CHARINDEX('&amp;', @HTMLText)
SET @End = @Start + 4
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '&')
SET @Start = CHARINDEX('&amp;', @HTMLText)
SET @End = @Start + 4
SET @Length = (@End - @Start) + 1
END

-- Replace the HTML entity &lt; with the '<' character
SET @Start = CHARINDEX('&lt;', @HTMLText)
SET @End = @Start + 3
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '<')
SET @Start = CHARINDEX('&lt;', @HTMLText)
SET @End = @Start + 3
SET @Length = (@End - @Start) + 1
END

-- Replace the HTML entity &gt; with the '>' character
SET @Start = CHARINDEX('&gt;', @HTMLText)
SET @End = @Start + 3
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '>')
SET @Start = CHARINDEX('&gt;', @HTMLText)
SET @End = @Start + 3
SET @Length = (@End - @Start) + 1
END

-- Replace the HTML entity &amp; with the '&' character
SET @Start = CHARINDEX('&amp;amp;', @HTMLText)
SET @End = @Start + 4
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '&')
SET @Start = CHARINDEX('&amp;amp;', @HTMLText)
SET @End = @Start + 4
SET @Length = (@End - @Start) + 1
END

-- Replace the HTML entity &nbsp; with the ' ' character
SET @Start = CHARINDEX('&nbsp;', @HTMLText)
SET @End = @Start + 5
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, ' ')
SET @Start = CHARINDEX('&nbsp;', @HTMLText)
SET @End = @Start + 5
SET @Length = (@End - @Start) + 1
END

-- Replace any <br> tags with a newline
SET @Start = CHARINDEX('<br>', @HTMLText)
SET @End = @Start + 3
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, CHAR(13) + CHAR(10))
SET @Start = CHARINDEX('<br>', @HTMLText)
SET @End = @Start + 3
SET @Length = (@End - @Start) + 1
END

-- Replace any <br/> tags with a newline
SET @Start = CHARINDEX('<br/>', @HTMLText)
SET @End = @Start + 4
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, CHAR(13) + CHAR(10))
SET @Start = CHARINDEX('<br/>', @HTMLText)
SET @End = @Start + 4
SET @Length = (@End - @Start) + 1
END

-- Replace any <br /> tags with a newline
SET @Start = CHARINDEX('<br />', @HTMLText)
SET @End = @Start + 5
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, CHAR(13) + CHAR(10))
SET @Start = CHARINDEX('<br />', @HTMLText)
SET @End = @Start + 5
SET @Length = (@End - @Start) + 1
END

-- Remove anything between <STYLE> tags
SET @Start = CHARINDEX('<STYLE', @HTMLText)
SET @End = CHARINDEX('</STYLE>', @HTMLText, CHARINDEX('<', @HTMLText)) + 7
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '')
SET @Start = CHARINDEX('<STYLE', @HTMLText)
SET @End = CHARINDEX('</STYLE>', @HTMLText, CHARINDEX('</STYLE>', @HTMLText)) + 7
SET @Length = (@End - @Start) + 1
END

-- Remove anything between <whatever> tags
SET @Start = CHARINDEX('<', @HTMLText)
SET @End = CHARINDEX('>', @HTMLText, CHARINDEX('<', @HTMLText))
SET @Length = (@End - @Start) + 1

WHILE (@Start > 0 AND @End > 0 AND @Length > 0) BEGIN
SET @HTMLText = STUFF(@HTMLText, @Start, @Length, '')
SET @Start = CHARINDEX('<', @HTMLText)
SET @End = CHARINDEX('>', @HTMLText, CHARINDEX('<', @HTMLText))
SET @Length = (@End - @Start) + 1
END

RETURN LTRIM(RTRIM(@HTMLText))

END 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-08-12T21:49:55.967

如果您的 HTML 格式正确，我认为这是一个更好的解决方案：

```
create function dbo.StripHTML( @text varchar(max) ) returns varchar(max) as
begin
    declare @textXML xml
    declare @result varchar(max)
    set @textXML = REPLACE( @text, '&', '' );
    with doc(contents) as
    (
        select chunks.chunk.query('.') from @textXML.nodes('/') as chunks(chunk)
    )
    select @result = contents.value('.', 'varchar(max)') from doc
    return @result
end
go

select dbo.StripHTML('This <i>is</i> an <b>html</b> test') 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-09-14T06:49:24.290

这是一个不需要 UDF 的版本，即使 HTML 包含没有匹配结束标签的标签也可以工作。

```
TRY_CAST(REPLACE(REPLACE(REPLACE([HtmlCol], '>', '/> '), '</', '<'), '--/>', '-->') AS XML).value('.', 'NVARCHAR(MAX)') 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-05-21T19:56:29.830

这不是一个全新的解决方案，而是对*afwebservant*解决方案的更正：

```
--note comments to see the corrections

CREATE FUNCTION [dbo].[StripHTML] (@HTMLText VARCHAR(MAX))  
RETURNS VARCHAR(MAX)  
AS  
BEGIN  
 DECLARE @Start  INT  
 DECLARE @End    INT  
 DECLARE @Length INT  
 --DECLARE @TempStr varchar(255) (this is not used)  

 SET @Start = CHARINDEX('<',@HTMLText)  
 SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText))  
 SET @Length = (@End - @Start) + 1  

 WHILE @Start > 0 AND @End > 0 AND @Length > 0  
 BEGIN  
   IF (UPPER(SUBSTRING(@HTMLText, @Start, 4)) <> '<BR>') AND (UPPER(SUBSTRING(@HTMLText, @Start, 5)) <> '</BR>')  
    begin  
      SET @HTMLText = STUFF(@HTMLText,@Start,@Length,'')  
      end  
-- this ELSE and SET is important
   ELSE  
      SET @Length = 0;  

-- minus @Length here below is important
   SET @Start = CHARINDEX('<',@HTMLText, @End-@Length)  
   SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText, @Start))  
-- instead of -1 it should be +1
   SET @Length = (@End - @Start) + 1  
 END  

 RETURN RTRIM(LTRIM(@HTMLText))  
END 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-09-26T02:57:01.853

将 XQuery 与单列一起使用如何：

```
DECLARE @MalformedXML xml, @StrippedText varchar(max)
SET @MalformedXML = @xml.query('for $x in //. return ($x)//text()')
SET @StrippedText = CAST(@MalformedXML as varchar(max)) 
```

这将遍历所有元素并仅返回 text() 。

为避免元素之间的文本没有空格连接，请使用：

```
DECLARE @MalformedXML xml, @StrippedText varchar(max)
SET @MalformedXML = @xml.query('for $x in //. return concat((($x)//text())[1]," ")')
SET @StrippedText = CAST(@MalformedXML as varchar(max)) 
```

并回应“您如何将其用于列：

```
 SELECT CAST(html_column.query('for $x in //. return concat((($x)//text()) as varchar(max))
  FROM table 
```

对于上述代码，请确保您`html_column`的数据类型为`xml`，如果不是，则需要将 html 的转换版本保存为`xml`. 当您加载 HTML 数据时，我会将此作为单独的练习，因为如果 SQL 发现格式错误的 xml，例如不匹配的开始/结束标签、无效字符，它将引发错误。

当您想要构建搜索短语、剥离 HTML 等时，它们非常适合。

请注意，这将返回 xml 类型，因此在适当的情况下将 CAST 或 COVERT 转换为文本。这种数据类型的 xml 版本是无用的，因为它不是格式良好的 XML。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-11-13T21:35:59.957

试试这个。它是[RedFilter](https://stackoverflow.com/a/457725/1501497)发布的版本的修改版本……此 SQL 删除了除 BR、B 和 P 之外的所有标签，并带有任何附带的属性：

```
CREATE FUNCTION [dbo].[StripHtml] (@HTMLText VARCHAR(MAX))
RETURNS VARCHAR(MAX)
AS
BEGIN
 DECLARE @Start  INT
 DECLARE @End    INT
 DECLARE @Length INT
 DECLARE @TempStr varchar(255)

 SET @Start = CHARINDEX('<',@HTMLText)
 SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText))
 SET @Length = (@End - @Start) + 1

 WHILE @Start > 0 AND @End > 0 AND @Length > 0
 BEGIN
   IF (UPPER(SUBSTRING(@HTMLText, @Start, 3)) <> '<BR') AND (UPPER(SUBSTRING(@HTMLText, @Start, 2)) <> '<P') AND (UPPER(SUBSTRING(@HTMLText, @Start, 2)) <> '<B') AND (UPPER(SUBSTRING(@HTMLText, @Start, 3)) <> '</B')
   BEGIN
      SET @HTMLText = STUFF(@HTMLText,@Start,@Length,'')
   END

   SET @Start = CHARINDEX('<',@HTMLText, @End)
   SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText, @Start))
   SET @Length = (@End - @Start) - 1
 END

 RETURN RTRIM(LTRIM(@HTMLText))
END 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-09-15T16:14:04.013

如果您不想使用 UDF 功能，请尝试此操作。

```
SELECT COLUMN1, TRY_CONVERT(xml, COLUMN2).value('.', 'nvarchar(max)') as COL2, COLUMN3
FROM   DBO.TABLENAME 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-02-05T16:58:38.197

虽然 Arvin Amir 的答案接近于一个完整的单线解决方案，但您可以在任何地方使用；他的选择语句中有一个小错误（缺少行尾），我想处理最常见的字符引用。

我最终做的是：

```
SELECT replace(replace(replace(CAST(CAST(replace([columnNameHere], '&', '&amp;') as xml).query('for $x in //. return concat((($x)//text())[1]," ")') as varchar(max)), '&amp;', '&'), '&nbsp;', ' '), '&#x20;', ' ')
FROM [tableName] 
```

如果没有字符参考代码，它可以简化为：

```
SELECT CAST(CAST([columnNameHere] as xml).query('for $x in //. return concat((($x)//text())[1]," ")') as varchar(max))
FROM [tableName] 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-08-27T05:44:34.663

Patrick Honorez 代码需要稍作改动。

它为包含`&lt;`或的 html 返回不完整的结果`&gt;`

这是因为该部分下面的代码

> -- 删除标签之间的任何内容

实际上会将 < > 替换为空。解决方法是在最后应用以下两行：

```
set @HTMLText = replace(@htmlText, '&lt;' collate Latin1_General_CS_AS, '<'  collate Latin1_General_CS_AS)
set @HTMLText = replace(@htmlText, '&gt;' collate Latin1_General_CS_AS, '>'  collate Latin1_General_CS_AS) 
```

# c# - C# 运行时应用程序诊断

> ID：457703
> 
> 赞同：1
> 
> 时间：2009-01-19T14:18:26.000
> 
> 标签：c#, runtime, diagnostics

我正在开发 ac# GUI，想知道是否有任何（最好是免费的）运行时诊断程序可用。

我正在寻找一种方法来监视用户与我的 GUI 的交互以及何时调用哪些函数。最好我不想添加调试代码堆栈，因为这有可能改变我正在寻找的错误的行为。

目前我正在使用 Spy++，但我发现它有点沉重，因为我对这个及其生成的数据堆栈有点陌生。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T14:37:51.687

[EQATEC 分析器](http://www.eqatec.com/tools/profiler)使用起来非常简单。也免费。开始以 Compact Framework 为目标，但从 2.00 开始，现在也更倾向于桌面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T14:27:39.570

我推荐[ANTS profiler](http://www.red-gate.com/Products/ants_profiler/index.htm)。

有一个试用版，前两周免费。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T14:35:50.833

除了 ANTS profiler 之外，看看 JetBrain 的[dotTrace](http://www.jetbrains.com/profiler)

# visual-studio - 如何让 Visual Studio 使用系统类型 (Int32) 而不是内置别名 (int) 生成代码

> ID：457705
> 
> 赞同：8
> 
> 时间：2009-01-19T14:18:37.170
> 
> 标签：visual-studio, coding-style, code-generation

我可以让 Visual Studio 将[内置别名](http://msdn.microsoft.com/en-us/library/ya5y69ds.aspx)转换为系统类型吗？例如，如果我定义以下接口

```
public interface IExample
{
    Int32 DoWork(String input);
} 
```

并使用VS自动生成界面，我得到了内置类型。

```
public class Demo : IExample
{
    public int DoWork(string input) { }
} 
```

我希望那些自动更改为系统类型

```
public class Demo : IExample
{
    public Int32 DoWork(String input) { }
} 
```

我不是在寻找一个完整的可安装解决方案，只是一个起点。我可以在 VS 中编写一个与文本完成或保存相关的脚本吗？我是否应该编写一个具有项目上下文菜单项的附加组件 - '将别名转换为系统类型'？

* * *

*注意：我更喜欢 System 类型，因为它们像其他类型一样由 VS 格式化。内置别名的格式类似于关键字。此外，这是我目前工作的编码风格指南。*

*更新：从 MS 中可以清楚地看出，现有的 VS 代码生成将始终生成内置别名。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T14:25:28.843

这两种类型的含义完全相同，没有一种可能意味着不同的含义。

唯一的区别是它们的外观，如果这对您很重要，您可以编写一个宏，将任何内置别名替换为系统类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-04T13:45:05.363

内置别名的格式类似于关键字，因为它们**是**关键字。编译器为您执行从语言数据类型关键字到底层 CLR 类型的转换。

Visual Studio 中没有任何内容会自动为您进行此翻译，因此您需要编写自己的实用程序来完成此操作。有几种不同的方法可以做到这一点——你可以编写一个宏或一个 VS 插件——但是（恕我直言）它们都不是简单的编写和确保正确性。

你说这既是个人喜好也是编码风格的要求。我认为格式问题似乎放错了地方。通常更容易/更干净/更喜欢使用语言别名而不是 CLR 类型。除了文本编辑器中的语法着色之外，两者之间绝对没有区别，也没有理由为您的类型使用 CLR 名称。强制使用 CLR 类型而不是语言别名的编码风格要求中给出的原因（如果有的话）是什么？

# c++ - VDMEnumProcessWOW 在 Vista 上不返回任何进程

> ID：457709
> 
> 赞同：2
> 
> 时间：2009-01-19T14:19:52.487
> 
> 标签：c++, winapi

我正在尝试使用 VDMEnumProcessWOW 在 Vista 上查找所有 16 位主机进程。我称之为它，即使我确实运行了一个 16 位应用程序，它似乎也没有找到任何结果。

我还尝试使用从 Windows 任务管理器为 ntvdm.exe 获得的进程 ID 调用 VDMEnumTaskWOWEx，但这也没有返回任何结果。

ntvdm.exe 的用户名为 joeBlogs，我编写的调用 VDMEnumProcessWOW 的应用程序在 SYSTEM 帐户下作为服务运行。问题是我需要让它们在同一个会话中运行吗？

EnumProcesses 跨会话工作正常，但 VDMEnumProcessWOW 不同，还是我还缺少其他东西？到目前为止，我在这方面看到的文档有点稀疏。

VDM 确实包含函数文档中说需要的 WowExec.exe 任务。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T16:09:51.033

[您可以通过此链接](http://support.microsoft.com/hotfix/KBHotfix.aspx?kbnum=953347&kbln=en-us)请求修补程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T14:56:24.740

是的，一位同事刚刚回答了这个问题。他以前遇到过这个问题。看来 VDMEnumProcessWOW 不能跨会话工作。

此外，Vista 在枚举 16 位进程时还有其他一些问题（我不确定它们的症状是什么）。有一个 Microsoft 提供的 HotFix 是完成这项工作所必需的。

# c++ - C++ 类默认构造函数

> ID：457719
> 
> 赞同：1
> 
> 时间：2009-01-19T14:22:52.327
> 
> 标签：c++, constructor, class, default

早些时候我问为什么这被认为是不好的：

```
class Example
{
 public: 
  Example(void);
  ~Example(void);
  void f() {}
}

int main(void)
{
 Example ex(); // <<<<<< what is it called to call it like this?

 return(0);
} 
```

现在，我知道它正在创建一个函数原型，而不是返回一个示例类型。我仍然不明白为什么它会在 g++ 和 MS VC++ 中工作。

我的下一个问题是使用上述方法，这个调用有效吗？

```
int main(void)
{
 Example *e = new Example();

 return(0);
} 
```

? 那和简单地调用 Example e() 有什么区别？？？就像我知道它是一个函数原型一样，但似乎有些编译器会原谅它并允许它调用默认构造函数？我也试过这个：

```
class Example
{
 private:
  Example();

 public:
  ~Example();
};

int main(void)
{
 Example e1(); // this works
 Example *e1 = new Example(); // this doesn't

 return(0);
} 
```

所以我有点困惑:(对不起，如果这被问了一百万次。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-19T14:28:20.413

很简单，丹尼尔：

```
Example *e = new Example(); 
```

这看起来不像是一个名为“Example”的函数，是吗？函数具有返回值、名称和参数。上面的内容如何适应？

> 示例 e1(); // 这行得通

是的，因为您不会在任何地方创建任何实例`Example`。您只需告诉代码在某处周围的命名空间中定义了一个函数，并且您可能想要调用该函数。是的，为了返回 Example 的对象，确实会创建一个实例。但这并不意味着此时会创建一个实例。相反，当您调用它时，会在函数中创建一个实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T14:27:48.307

这个[问题](https://stackoverflow.com/questions/420099/is-this-type-variableoftype-function-or-object#420225)将有助于理解这种行为

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T14:28:24.110

嗯...好吧这个：

示例 e1();

不工作。您可能认为它确实如此，或者某些编译器正在接受它，但它并没有创建一个名为 e1 的 Example 实例，它只是声明了一个函数原型。删除括号，它会做你想要的。

这：

示例* e1 = 新示例（）；

不会工作，因为构造函数是私有的。如果您将构造函数设为公共，它将在堆上创建对象，并且 e1 将是指向该对象的指针。完成后，您将需要删除该对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T14:28:47.570

对于“新示例（）”是否有效的第一个问题。是的，这是完全合法的 C++ 代码。虽然为了完全正确，您需要在从 main() 返回之前删除对象，否则会导致内存泄漏。

例子：

```
int main(void)
{
 Example *e = new Example();
 delete e;
 return(0);
} 
```

对于最后一个问题。“示例 e1();”行 是有效的，因为它声明了一个函数原型。这实际上并不会导致机器代码被执行（可能是堆栈空间）。简单的说，有一个没有参数的函数原型，返回一个Example类型。

第二行虽然肯定会失败。此时，您正在尝试实际执行 Example 的构造函数。这是不合法的，因为函数的可访问性是私有的，因此编译器错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T14:38:00.813

我认为您应该区分“this parses”、“this compiles”、“this links”和“this works”，并尝试自己像 C++ 解析器/编译器/链接器一样思考以查看第一个示例

```
Example e1(); // function prototype 
```

看起来像一个函数声明。解析器*将*因此理解它，因此您不能调用例如成员函数 on `e1`。编译器将生成一个引用某个函数的符号（它还没有看到），但由于该函数没有被使用，它不会抱怨。如果添加此代码，它将：

```
e1.f();// since e1 is a function, it has no member 'f' => compiler error 
```

（作为旁注：此代码也将编译：

```
int a_function_prototype(int); // another prototype.
e1(); // should work!
a_function_prototype(5); 
```

但在编译器完成后，链接器将开始寻找实际的函数体，但不会找到。）

现在因为线

```
Example* e = new Example(); 
```

包含`new` 编译器识别的关键字，并且它知道它只能在新对象的分配+构造中找到，它将生成这样做的代码。

# cygwin - 试图在cygwin上编译slapd，这个automake错误是什么意思？

> ID：457724
> 
> 赞同：0
> 
> 时间：2009-01-19T14:24:29.483
> 
> 标签：cygwin, compilation, automake

我正在尝试在 cygwin 上编译一个非常旧的 slapd（LDAP 服务器）版本。以前它在 Linux 机器上运行，但由于我无法控制的原因，它必须在 Windows 服务器上运行。有人建议我们可以使用 cygwin 来编译源代码。

不幸的是，在“配置”期间构建失败并显示错误消息：

```
检查如何运行 C 预处理器... cc -E
检查 gcc...（缓存）cc
检查 C 编译器 (cc ) 是否工作...否
配置：错误：安装或配置问题：C编译器无法创建
e 可执行文件。
```

config.log 的最后几行是：

```
配置：失败的程序是：
#line 2822 “配置”
#include "confdefs.h"

int main() {
返回 __EMX__;
; 返回0；}
配置：2845：检查如何运行 C 预处理器
配置：2866：cc -E conftest.c >/dev/null 2>conftest.out
配置：2950：检查 gcc
configure:3063: 检查 C 编译器 (cc ) 是否工作
配置：3079：cc -o conftest conftest.c 1>&5
/usr/lib/gcc/i686-pc-cygwin/3.4.4/../../../../i686-pc-cygwin/bin/ld：找不到
 -luser32
collect2: ld 返回 1 个退出状态
配置：失败的程序是：

#line 3074 “配置”
#include "confdefs.h"

主要（）{返回（0）；}
```

更新：这是一台 win32 计算机 - cygwin 不包含一个名为 user32 的共享对象，但 Windows XP 确实包含一个名为 user32.dll 的对象 - 知道这是否是链接器正在寻找的对象吗？

UPDATE2： w32api 已经安装，（3.13-1） - 我注意到有一个 user32.lib 作为 visual-stuido 2003 .Net 的一部分 - 有没有办法让 Cygwin 中的 GCC 使用它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T14:31:37.613

根本原因似乎是

> /usr/lib/gcc/i686-pc-cygwin/3.4.4/../../../../i686-pc-cygwin/bin/ld：找不到-luser32

这要么是 cygwin 安装的问题，要么是配置脚本太旧，无法识别和处理安装。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T16:44:16.300

如果 -luser32 失败，请尝试安装`w32api`Cygwin 软件包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T16:16:18.353

经过多次试验和错误，我找到了这个问题的正确答案：这个错误的原因是 Cygwin 环境没有正确设置。

域上的登录用户，因此默认情况下未正确设置 /etc/passwd 和 /etc/group 文件。解决方案是创建一个本地用户帐户，然后重新构建 passwd 和组文件。

在那之后，GCC 可以构建得很好。

听起来很疯狂，我知道。

# security - 针对 web 应用程序的密码列表攻击的最佳实践

> ID：457727
> 
> 赞同：2
> 
> 时间：2009-01-19T14:24:53.133
> 
> 标签：security, web-applications, passwords, brute-force

我想防止机器人入侵受密码保护的弱帐户。（例如，这发生在 ebay 和其他大型网站上）

因此，我将使用 ip、尝试次数和上次尝试的时间戳（memcache-fall-out）设置一个（mem-）缓存值。

但是机器人试图用一个密码打开任何账户呢？例如，机器人尝试使用密码“password123”的所有 500.000 个用户帐户。也许10会打开。

所以我的尝试是用try缓存ip并将max-tries设置为~50。我会在成功登录后删除它。因此，好的机器人每 49 次尝试重置锁定，就会使用有效帐户登录。

有什么办法可以做到吗？大平台对此做了什么？我能做些什么来防止白痴通过重试 50 次来阻止代理上的所有用户？

如果没有最佳实践——这是否意味着任何平台都是暴力破解的？至少提示何时重置计数器？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T14:29:48.537

我认为您可以将您的解决方案与验证码混合使用：

1.  计算每个 IP 的尝试次数
2.  如果在给定时间内来自给定 IP 地址的尝试次数过多，请在您的登录表单中添加验证[码。](http://fr.wikipedia.org/wiki/Captcha)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T14:27:53.160

有些网站在开始让您输入验证码和用户名/密码之前，可能会给您两到三次尝试。一旦您成功登录，验证码就会消失。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T14:27:38.603

前几天有一篇关于[Coding Horror的比较不错的文章。](http://www.codinghorror.com/blog/archives/001206.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T14:30:12.793

[虽然代码专注于 Django，但Simon Willison 的博客](http://simonwillison.net/2009/Jan/7/ratelimitcache/ "使用 memcached 进行速率限制")上对最佳实践方法进行了一些非常好的讨论。他使用 memcached 来跟踪 IP 和登录失败。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T14:30:40.610

当用户设置密码时，您可以使用[密码强度检查器](http://www.microsoft.com/protect/yourself/password/checker.mspx)来确保他们没有使用容易暴力破解的密码。

编辑：为了清楚起见，这不应被视为您要解决的问题的完整解决方案，而应与其他一些答案一起考虑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T14:31:02.170

您永远无法阻止一组机器人从许多不同的 IP 地址尝试此操作。

来自同一个 IP 地址：我会说，如果您看到“可疑”行为的示例（无效的用户名，或多个有效帐户尝试不正确的登录），只需阻止登录几秒钟即可。如果是合法用户，他们不会介意等待几秒钟。如果它是一个机器人，这将使它们减慢到不切实际的程度。如果您继续看到来自 IP 地址的行为，只需阻止它们 - 但为合法用户留下一个带外门（拨打电话 #x，或通过电子邮件发送此地址）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T20:37:24.973

**请注意：** IP 地址可以在数千甚至数百万用户之间共享！！！例如，由于 AOL 的网络架构，大多数/所有 AOL 用户都显示为一组非常小的 IP 地址。大多数 ISP 将其庞大的用户群映射到一小组公共 IP 地址。

**您不能假设一个 IP 地址只属于一个用户。**

**您不能假设单个用户将只使用单个 IP 地址。**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-30T06:41:56.120

检查以下问题，讨论针对分布式暴力和字典攻击的最佳实践：

[最好的分布式蛮力对策是什么？](https://stackoverflow.com/questions/479233/what-is-the-best-distributed-brute-force-countermeasure)

# .net - 每 4 分钟对运行中的 SQL Server 数据库进行完整备份的意义

> ID：457733
> 
> 赞同：2
> 
> 时间：2009-01-19T14:27:24.953
> 
> 标签：.net, sql-server, backup

我有一个客户在重度使用的数据库上每 4 分钟将数据库的完整备份设置到网络路径。我强烈建议客户不要这样做，而是进行事务备份。

但是以这种方式进行完整备份时可能发生的坏事是什么？除此之外，备份永远不会有正确的数据，因为在进行备份时数据库被大量使用。以及服务器的工作量。

我与该客户有几个与 sql 相关的问题 (webservice<-sqlconnection->sql)，并且想从技术上了解此备份方案是否可能是问题的一部分？

当然，我将通过在测试时停止备份并查看事件日志等来开始对此进行调查。但我很好奇是否有人可以直接说“不，这会锁定 X 并抛出 Y 并且很糟糕”或其他什么。;)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T14:44:03.500

如果它是一个小型数据库，我猜是这样，除了一点额外的负载之外，它可能不会造成任何伤害，但如果他们需要确保不会丢失数据，他们应该每天进行完整备份每隔几分钟进行一次日志备份而不是完整备份，并将日志传送到备用服务器，或设置镜像。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T14:40:48.873

可能您可以运行第二个 MSSQL 服务器以实现冗余？并且两台服务器都在raid镜像中？

或者您可以使用[Red Gate 之](http://www.red-gate.com/)类的工具每 5 分钟备份一次数据。**它快**死了！并且有很多压缩/加密。我们每 10 分钟对一个包含 100 万条记录的数据库进行备份。没问题！

您真的必须问您的客户为什么要每 4 分钟备份一次数据库？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T14:42:04.503

只要您将数据文件置于任何 MSSQL 的“备份模式”等效项中，备份就应该是有效的，但这似乎是一种非常重要的备份方式。即使是“每小时完整备份、连续基于日志的备份”也将是一个巨大的改进。

当然，这在很大程度上取决于数据库的大小，如果是 5-10 Meg 的数据库，开销可能会相反，但这似乎不太可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T16:18:07.243

我想这是一个小型数据库，但是一旦超过 4 分钟的窗口，您就可以关闭数据库：第二次备份开始，进一步减慢处理和早期备份的速度，等待第三次备份开始......

# asp.net - ASP.NET 页面级缓存（带有经过身份验证的站点）

> ID：457749
> 
> 赞同：5
> 
> 时间：2009-01-19T14:29:19.457
> 
> 标签：asp.net, caching

据我了解，页面级缓存没有考虑到，对于经过身份验证的站点，不同的用户可能会请求完全相同的页面 (URL)，而呈现的页面本身是不同的（因为它包含用户特定的内容）。

除非您激活无 cookie 身份验证（然后 sessionID 成为 URL 的一部分），否则所有用户都将看到相同的缓存页面（无论他们是谁）。

它是否正确？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T14:56:21.493

是的，你在这一点上是 100% 正确的。

通常我会转向用户控件，以便能够缓存不会因用户而异的项目的用户控件。

然后，如果您必须缓存用户特定的数据，则可以使用 Session 或其他缓存存储。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T15:08:13.780

根据页面上有多少动态内容，您可以使用 Substitution 控件在缓存页面上呈现动态内容。

此控件绑定到一个静态方法（请记住，页面生命周期尚未运行，因为这是页面的缓存版本，并且在 Page_Load 等中创建的任何对象都不可用），该方法返回动态内容并且可以放置在您想要的任何位置在页面上。

```
<asp:Substitution ID="mySubstitution" runat="server" MethodName="GetLoggeninUserName" /> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T15:09:12.030

另一个选项是 Scott Guthrie 所说的“甜甜圈缓存”：

> [使用 ASP.NET 2.0 输出缓存替换功能实现“甜甜圈缓存”](http://weblogs.asp.net/scottgu/archive/2006/11/28/tip-trick-implement-donut-caching-with-the-asp-net-2-0-output-cache-substitution-feature.aspx)

这允许您进行页面级缓存，同时在非缓存“洞”中实现某些元素。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T04:42:30.300

是的，您是正确的，如果您使用的是 ASP.NET 2.0 或更高版本，Andy（和 Zhaph）指出的替换控件是您的最佳答案。为非用户特定的内容创建单独的用户控件是一种不太理想的方法，只有在您坚持使用 ASP.NET v1.x 时才应该使用它（所以我认为您应该将 Andy 标记为答案）。

# sql-server - SQL Server 作业输出中的 SQLSTATE 01000

> ID：457761
> 
> 赞同：1
> 
> 时间：2009-01-19T14:33:06.267
> 
> 标签：sql-server, sql-server-agent

我已经运行了包含定期“打印”语句的 SQL Server 作业，这样我就可以查看作业历史记录并了解发生了什么。但是输出中充满了 [SQLSTATE 01000]。鉴于此输出可以容纳多少是有限的，我希望尽可能多的空间来存储我关心的信息。

有什么方法可以抑制“打印”命令的 [SQLSTATE 01000] 输出？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-02T13:58:51.430

问题（对不起。“功能”）与 SQL 代理中的 PRINT 命令有关。我通过创建一个表变量来解决这个问题，其中有一列用于“输出”，并在我完成脚本时填充它，然后在作业的最后从表变量中选择。通过 SQL 代理将输出通过管道传输到文件会给我一份工作日志。在工作中的任何时候，如果遇到错误，我会在退出前转储表的内容。（我通常在执行它之前将要执行的命令包含在表变量中）。只需在作业结束时用一个 SELECT 语句替换所有 PRINT 语句，就可以摆脱那些讨厌的 [SQLSTATE 01000] 后缀

每...该死的...行...

干杯，肯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T00:11:42.917

你可能不走运。这是 PRINT 语句的正常输出。我认为没有任何方法可以压制他们。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-27T02:19:01.977

如果您只想从输出中删除 [SQLSTATE 01000] 或包含 [SQLSTATE 01000] 的任何内容，则不是肯定的。所以这是两种方式。

```
Print replace(@PrintThis, '[SQLSTATE 01000]', ''); 
```

基本上这将替换 [SQLSTATE 01000] 什么都没有。

接下来使用 CHARINDEX(expression1, expression1 [, start_location])，在 expression2 中搜索 expression1，如果找到则返回其起始位置。搜索从 start_location 开始。

```
@result = CHARINDEX('[SQLSTATE 01000]', @PrintThis)
if (@result > 0)
    Print @PrintThis 
```

因此，如果 CHARINDEX < 0，则字符串 [SQLSTATE 01000] 不存在且不打印

如果错过了您正在尝试做的事情，请回复。

我希望这有帮助，

布雷特

# formatting - 格式化数字，不包括尾随零

> ID：457763
> 
> 赞同：0
> 
> 时间：2009-01-19T14:33:44.613
> 
> 标签：formatting, xslt, numbers

第一次SO用户:)

我知道我可以像这样格式化一个数字：

```
format-number($value, '###,###.00') 
```

但是如果 $value 为零，我想删除点和零。

所以，

```
37368 -> 37,368
2.666667 -> 2.66 
```

这是否可能仅使用数字格式（看起来不像）或者我必须按照以下方式做一些事情

```
if (int(value) == value ) {...} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T16:40:42.657

```
format-number($value, '###,###.##') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T14:53:34.120

xpath 2.0 包含条件逻辑[if..then..else](http://www.xml.com/lpt/a/1573)但在更有可能的情况下，您在 xpath 1.0 中，恐怕您将不得不依赖 XSLT 为您执行此操作，即：

```
<xsl:variable name="myvar">
  <xsl:choose>
    <xsl:when test="$value > 0">
      <xsl:select="format-number($value, '###,###.00')"/>
    </xsl:when>
    <xsl:otherwise>0</xsl:otherwise>
  </xsl:choose>>
</xsl:variable> 
```

..或混合扩展（.NET 可以在本地执行此操作，否则 EXSLT 存在，可能有更多可用选项）

据我所知，没有 xpath 函数可以让你摆脱困境，但我可能会错过一些异国情调的东西。

# frameworks - JavaBeans 激活框架：值得学习吗？

> ID：457767
> 
> 赞同：0
> 
> 时间：2009-01-19T14:35:43.877
> 
> 标签：frameworks, java

最近我偶然发现了一个名为*javax.activation.DataHandler*的类。但是在阅读 JDK6 的 javadoc 时，我无法理解该框架的**目的**和**基本原理**。如果您在实际项目中使用过该框架，请分享您的经验并解释开发人员可以从中*“赚取”*什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T16:26:11.283

我在使用 CXF 的 JAX-WS Web 服务中使用它来使用 MTOM 流式传输附件：

```
@XmlMimeType("application/octet-stream")
private DataHandler data; 
```

JAX-WS 生成的客户端也将使用该类。从该类中，您可以根据需要访问底层输入/输出流。当调用包含 DataHandler 的 Web 服务方法时，客户端可以写入 OutputStream，而在服务器端，您可以从 InputStream 中读取。这样，数据永远不会缓冲在客户端或服务器的内存中。

我确信这个类还有其他用途，但这只是我遇到的一个。

那么值得学习吗？那是给我的。

# javascript - YUI 复选框按钮 - 检索选中的值

> ID：457774
> 
> 赞同：2
> 
> 时间：2009-01-19T14:37:58.537
> 
> 标签：javascript, yui

（我试过在 YUI 消息组上发布这个但没有任何运气）

谁能告诉我如何检索 yui 按钮的选中状态？我尝试通过在代码中创建按钮，然后将其作为 HTML 按钮输出，但这只会更改标题属性。

当我改用复选框时，不会检查任何复选框（使用 jQuery 遍历它们时）。

有没有更简单的方法呢？使用 3.0 Node API 还是 Element？

编辑：为了澄清这个问题是如何产生的，我使用了 YUI ASP.NET 控件。他们像这样向页面添加控件

```
Sys.Application.add_init(function() {    $create(YUIAspNet.Button, {"ButtonID":"yuiMyButton_btn","ButtonName":"yuiMyButton$btn","TabIndex":0,"ButtonType":"checkbox","Text":"Technology"}, null, null, $get("yuiMyButton"));}); 
```

如您所见，找到所有按钮并不像我希望的那样简单。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T15:15:28.087

抱歉，您是在谈论[复选框按钮](http://developer.yahoo.com/yui/examples/button/btn_example03.html)吗？采用：

```
myButton.get("checked") 
```

其中 myButton 是`YAHOO.widget.Button`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T13:52:40.823

克里斯，我是 YUI ASP.NET 项目的发起人。我经常看 YUI 邮件列表，我一定错过了你的问题。

对于您和其他任何有问题并最终阅读此内容的人，我有一个更通用的答案，不仅适用于复选框按钮，还适用于所有控件。

在客户端，您可以通过在自定义包装客户端对象上调用 .get_YUIControl() 方法来访问 YUI 对象，然后您可以控制原始 YUI 对象。YUI 文档非常好，你可以找到一个很好的描述来描述你想要完成的事情。

# java - 您如何访问泛型的 Class 对象？

> ID：457777
> 
> 赞同：3
> 
> 时间：2009-01-19T14:38:35.633
> 
> 标签：java, generics

如何访问泛型的类对象？

目前，我正在这样做：

```
List<String> list= new ArrayList<String>();
list.getClass(); 
```

这个可以吗？或者，应该怎么走？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T14:42:49.913

这将返回与 ArrayList.class 相同的内容。Java 泛型在运行时擦除泛型类型；换句话说，从“列表”你永远不会知道元素类型是字符串。有一个很好的常见问题解答

[http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T15:20:40.743

确实，擦除使获取给定对象的泛型类型信息变得不可能，因为泛型仅保存在源代码的结构中。然而，这并不意味着不可能获得泛型类型参数，并且在许多重要的情况下（例如，为给定的类/方法构建接口）您能够做到这一点。如果你通过反射获得了一个类的元素，你可以获得关于所使用的声明类型的通用信息。

例如，获取一个`java.lang.reflect.Method`通过反射，并在其上调用例如[getGenericReturnType()](http://java.sun.com/javase/6/docs/api/java/lang/reflect/Method.html#getGenericReturnType())。这将返回一个 的实例`java.lang.reflect.Type`，它可以只是一个`Class`，但也可以是一个实例，`ParameterizedType`甚至`WildcardType`在适当的地方。后两种情况都允许您查看声明的泛型类型。除了检查之外，我不知道有任何特别优雅的方式来处理这个问题`instanceof`，但如果你需要，信息就在那里。

这可以提供关于字段的泛型类型、方法参数和返回类型以及类本身（包括它自己的泛型参数以及它的超类和实现的接口的泛型参数）的信息。如果您需要在反射上下文中对泛型方法进行类型安全的参数检查，这将非常有用。

# jquery - 使用 Jquery 将评论回复表单插入页面

> ID：457778
> 
> 赞同：5
> 
> 时间：2009-01-19T14:39:31.433
> 
> 标签：jquery, multithreading, forms, comments

我一直在制作一个线程评论系统，作为正确学习 php 和 javascript/jquery 的一种方式。我过去做过一些零碎的工作，但我下定决心要好好学习它。

我无法将回复表单插入到正在回复的评论下方的评论树中。我知道这可能是非常基本的，但是当有人单击链接时，如何将 html 插入页面。

这段代码对我不起作用：

```
$(document).ready(function(){
    $(function() {
        $('a#reply').click(function() {

            $(this).append("the html blah");    

        });
    });

}); 
```

有人看到我哪里出错了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T14:58:46.497

```
$(document).ready(function(){
        $('a#reply').click(function() {
            $(this).after("the html blah");
            return false;
        });
}); 
```

你可能需要'return false;' 当您单击链接时，在那里阻止页面重新加载。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T16:01:12.877

如果其他建议均无效，则可能是您的链接选择器无法正常工作。在您提供的示例中，您似乎正在寻找这样的链接：

```
<a id='reply' href='#'>add comment</a> 
```

那是对的吗？您没有提到您是如何生成 html 的，但我知道 asp.net 的服务器端 id ！= 客户端 id 并且您需要像这样修改您的选择器：

```
$('a[id$=reply]') 
```

无论如何，这是一个完整的示例，其中包含对我来说很好的 html：

```
<html>
    <head>
        <script type="text/javascript" src='scripts\jquery-1.2.6.min.js'></script>
    </head>
    <body>
        <div style='height:400px'>
            Space to demonstrate that clicking the link does not scroll the page.
        </div>
        <div id='main'>
            <a href='#' id='clicky'>here</a>
        </div>
    </body>
    <script>
        $(function(){
            $('a#clicky').click(function(){
                $(this).after('Hello There')
                return false;
            });
        });
    </script>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T14:47:43.960

要添加到 rodbv 的答案，您将在链接中添加文本“html blah blah” **，**因为您使用的是`append`. 将其更改为：

```
$(this).after("the html"); 
```

它会在链接**之后**写出html 。

# sql - 使用 SQL Server Express 的报告服务

> ID：457791
> 
> 赞同：4
> 
> 时间：2009-01-19T14:42:15.173
> 
> 标签：sql, sql-server-2005

SQL Server Express 2005 是否包含报告服务。如果是，我安装了 SQL SErver express 2005 版，但我看不到报告服务。

帮助...

先进的服务，没有帮助..

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-19T14:44:31.940

您需要安装[带有高级服务的 SQL Server Express 2005](http://www.microsoft.com/downloads/details.aspx?familyid=4C6BA9FD-319A-4887-BC75-3B02B5E48A40&displaylang=en)。

# flash - 离开页面时，Internet Explorer 不会卸载 SWF

> ID：457792
> 
> 赞同：4
> 
> 时间：2009-01-19T14:42:44.737
> 
> 标签：flash, internet-explorer, openlaszlo

我正在使用开源 OpenMeetings 编写会议门户，这是一个使用 OpenLaszlo 编译的 Flash 应用程序。因此，我可以访问混合了 Laszlo 标记和 JavaScript 的 SWF 源代码，但不能访问 ActionScript。

我遇到的问题是，当用户在 Internet Explorer 中离开应用程序时，他们的麦克风保持连接状态，他们可以听到对方/对方可以听到他们的声音。这意味着 IE 没有正确地销毁 Flash 对象。

我在自己的系统上重现此错误时遇到了麻烦，但它确实发生在我同事的计算机上。

我尝试使用 JavaScript 来捕获卸载事件并将 innerHTML 设置为“”，这会从页面中删除 Flash 对象，但麦克风等仍然保持连接。

这只发生在 Internet Explorer 上。这是我们软件的一个主要错误，因为我们处理教育问题，因此一个学生在不知情的情况下保持“在线”可能会让我们提起诉讼！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-04-29T17:45:09.983

这里涵盖的选项似乎最适合我们：
[http ://blog.vokle.com/index.php/2009/03/10/why-ie-doesnt-drop-flash-netconnections-netstreams-and-how-to -fix-it/](http://blog.vokle.com/index.php/2009/03/10/why-ie-doesnt-drop-flash-netconnections-netstreams-and-how-to-fix-it/)
我们还使用 SWFObject 中的“removeSWF”函数，如下所示：

```
 <!--[if IE]>
    <script type="text/javascript">
        function cleanupForIE() {
            try {
                //get using the id of your swf instance
                var swf = document.getElementById('myswf');  
                swf.disconnect();
            } catch(e) {
                alert("Error on unload: " + e);
            }
            swfobject.removeSWF("flashContent");
        }
        window.attachEvent("onbeforeunload", cleanupForIE);
    </script>
    <![endif]--> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T15:21:02.630

不幸的是，我无法提供链接，因为它是一个内部站点。

它只是一个简单的在 div 中嵌入 src="..."，在卸载时我将 div 的 innerHTML 设置为 ""。这并没有比关闭浏览器窗口更好，而且我从来没有直接引用嵌入对象，只是引用它包含的 div。我觉得这可能与电影仍在“播放”的事实有关。谷歌上的一些搜索结果有人抱怨类似的问题（关闭浏览器窗口后仍然可以听到 FLV 音频）并且修复似乎明确地从 ActionScript 中停止了电影。（当然我对编译的电影没有这种控制权，它是从 OpenLaszlo 生成的）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-14T14:13:59.057

从技术上讲，可以添加该功能 - 如果尚未添加。OpenMeetings 现在是一个[Apache Incubator 项目](http://incubator.apache.org/openmeetings/)，只需通过邮件列表联系开发人员，他们应该能够为您提供帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T15:08:36.557

是否存在对该对象的任何 JavaScript 引用？

```
 //e.g.
 var conf = document.getElementById( 'mySWFObject' ); 
```

如果是这样，是否明确调用删除工作？

```
 delete window.conf; 
```

（否则，您可以发布代码/站点的链接，我们可以检查一下吗？）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T09:32:56.617

也许您可以询问进行 OpenLaszlo 开发的人是否构建了一个监听 Removed From Stage 事件的 destory 方法。在那里你明确停止所有播放。

# php - 在 php 中识别文件类型的最佳方法

> ID：457797
> 
> 赞同：7
> 
> 时间：2009-01-19T14:43:21.457
> 
> 标签：php, file-type

在 php 中发现文件的文件类型的最佳方法是什么？我听说浏览器可能会被欺骗，那么有什么更好的方法呢？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-19T14:54:17.503

您可以使用[finfo_file](http://www.php.net/manual/en/function.finfo-file.php)

```
<?php
echo finfo_file(finfo_open(FILEINFO_MIME), "foo.png");
?> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-19T15:00:28.740

看看“魔术数字”。文件的前几个字节通常标识它是什么类型的文件。例如，GIF 的前几个字节是 47 49 46 38 37 61 或 47 49 46 38 39 61，ASCII 用于 GIF89a 或 GIF87a。还有许多其他的“神奇数字”。请参阅[http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files](http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files)

编辑：我相信这比 PHP 上的 MIME 函数更可靠。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-19T14:50:02.443

我认为您的意思是[finfo_file()](http://ar.php.net/manual/en/function.finfo-file.php)发现 mimetype

来自 php.net 示例：

```
<?php
$finfo = finfo_open(FILEINFO_MIME); // return mime type ala mimetype extension
foreach (glob("*") as $filename) {
    echo finfo_file($finfo, $filename) . "\n";
}
finfo_close($finfo);
?> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T16:24:26.107

您不能信任浏览器返回的 Content-Type。它基于文件扩展名，很容易被欺骗。

正如**stalepretzel**提到的，猜测文件内容类型的最佳方法是使用幻数。如果你的服务器在 *nix 机器上运行，你可以使用这个函数：

```
<?php

function get_file_type($file) {
  if(function_exists('shell_exec') === TRUE) {
    $dump = shell_exec(sprintf('file -bi %s', $file));
    $info = explode(';', $dump);
    return $info[0];
  }
  return FALSE;
}

?>

Usage: $file_type = get_file_type('my_file_name.ext'); 
```

PD：查看 /usr/share/magic.mime 以获取更多信息。

# c - 显式关闭文件句柄还是让操作系统在 Unix C 编程中关闭它们？

> ID：457803
> 
> 赞同：3
> 
> 时间：2009-01-19T14:44:51.173
> 
> 标签：c, unix, filehandle

在 Unix C 编程中，在进程退出之前显式关闭文件句柄是否被认为是一种好习惯，或者让操作系统关闭文件句柄从而避免不必要的代码是否是一种好习惯？

这两者中的哪一个通常被认为是首选的选择？

例子：

```
int main (int argc, char* argv[])
{
    int sd;
    sd = socket(...);

    // Snip

   close(sd); // Good or bad practice?
   return 0;
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-19T14:50:30.617

通常，执行打开和关闭的代码不知道进程是否会立即退出 - 因此最好包含显式代码。

即使代码驻留在顶级 main() 函数中，万一代码被重用，它仍然是一个好主意。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-19T14:49:09.777

自己关闭它们被认为是一种很好的做法。

可能是因为这是一个好习惯，以防在您完成使用特定“文件”后的一段时间内您的程序增长并且退出不会发生。

例外是您的进程未打开的标准输入、标准输出和标准错误。

顺便说一句，UNIX 术语是“文件描述符”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T14:49:12.320

如果可以的话，绝对是关闭它们的好习惯。

如果您的程序发生更改以使文件尽快关闭而不是稍后关闭，则您无需记住`close()`稍后在文件 I/O 重构时添加它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T14:49:37.263

自大学以来我就没有使用过 unix，但是通过依赖 unix 关闭文件句柄，您可以减少代码的使用方式。

如果您的代码需要移植到另一个平台，或者如果您的代码需要修改以作为长期运行的服务运行，而没有明确的资源管理，您很快就会耗尽资源，那么您正在为自己构建一场噩梦。

希望你觉得这有帮助，

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T14:48:57.640

如果您的程序将继续运行但不再需要描述符，那么关闭描述符是非常好的做法。

再说一次，它取决于文件描述符类型。例如，关闭（）套接字将刷新它，如果失败，您可能需要重试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T15:00:27.367

我认为它几乎是“通用的”，如果您打开了操作系统资源，您应该在使用完它们后立即关闭它们。这样您就可以释放这些资源，以便其他应用程序可以使用它们。

通过依靠操作系统来关闭您的句柄，他只会在他认为您不再需要它们时关闭它们（例如应用程序退出）。您应该始终释放系统资源。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T15:38:38.757

关闭您打开的任何文件被认为是好的最重要的原因是，您可以发现 I/O 错误并将其报告给用户。出于同样的原因，如果您写入 stdout 和 stderr，则刷新（或可能关闭）它们可能是一个好主意。

# java - Spring构造函数参数？

> ID：457814
> 
> 赞同：4
> 
> 时间：2009-01-19T14:49:34.190
> 
> 标签：java, spring

我的一些类具有从构造函数填充的最终字段以及可以从 getter 和 setter 分配的属性。

如果我可以使用spring来做到这一点，那么以这种方式创建对象的springcontext.xml文件是什么样的？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-19T14:57:47.217

```
<bean id="testWithConstructorArg"
        class="com.Test">
        <constructor-arg ref="referencingSomething"/>
</bean> 
```

更多：[http ://www.javalobby.org/java/forums/t18396.html](http://www.javalobby.org/java/forums/t18396.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T15:02:15.320

`<bean id="myBean" class ="com.example.MyClass">`
`<constructor-arg type="java.lang.String">`
`<value>hello world</value>`
`</constructor-arg>`
`</bean>`

然后你可以`<paramater name="blah" value="whatever"/>`像往常一样使用普通的setter/getter。

# sql - SAP DB：SQL 字符串长度函数？

> ID：457816
> 
> 赞同：0
> 
> 时间：2009-01-19T14:49:46.187
> 
> 标签：sql, database, string

SAP DB 是否有一个函数来获取 SQL 中字符串的长度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T11:44:20.430

实际上，该`length()`函数存在，尽管它没有列在文档的[字符串函数列表](http://www.sapdb.org/7.4/htmhelp/71/81736bb9b311d2a97100a0c9449261/content.htm)中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-04T18:13:59.437

我使用 len() 函数

编辑：没关系 - 我在 MSSQL

# javascript - 在 setInterval 函数中传递参数

> ID：457826
> 
> 赞同：356
> 
> 时间：2009-01-19T14:52:16.353
> 
> 标签：javascript, parameters, setinterval

请告知如何将参数传递给名为 using 的函数`setInterval`。

我的例子`setInterval(funca(10,3), 500);`不正确。

* * *

## 回答 #1

> 赞同：600
> 
> 时间：2009-01-19T14:53:48.957

您需要创建一个匿名函数，以便不会立即执行实际函数。

```
setInterval( function() { funca(10,3); }, 500 ); 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-01-19T14:54:32.903

将它们作为参数添加到 setInterval：

```
setInterval(funca, 500, 10, 3); 
```

您问题中的语法使用 eval，这是不[推荐的做法](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval)。

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2012-10-01T03:42:03.940

现在使用 ES5，绑定方法函数原型：

```
setInterval(funca.bind(null,10,3),500); 
```

**[参考这里](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind)**

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2014-01-10T06:03:33.183

```
 setInterval(function(a,b,c){

          console.log(a + b +c);  

      }, 500, 1,2,3);

           //note the console will  print 6
          //here we are passing 1,2,3 for a,b,c arguments
         // tested in node v 8.11 and chrome 69 
```

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2011-12-14T19:37:51.237

您可以将参数作为函数对象的属性传递，而不是作为参数：

```
var f = this.someFunction;  //use 'this' if called from class
f.parameter1 = obj;
f.parameter2 = this;
f.parameter3 = whatever;
setInterval(f, 1000); 
```

然后在您的函数`someFunction`中，您将可以访问参数。这在范围自动转到全局空间的类中特别有用，并且您会丢失对调用 setInterval 的类的引用。使用这种方法，上例中“someFunction”中的“parameter2”将具有正确的范围。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2015-07-14T14:40:04.683

```
setInterval(function,milliseconds,param1,param2,...) 
```

更新：2018 - 使用“传播”运算符

```
function repeater(param1, param2, param3){
   alert(param1);
   alert(param2);
   alert(param3); 
}

let input = [1,2,3];
setInterval(repeater,3000,...input);
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2009-01-19T14:55:23.307

您可以使用匿名函数；

```
setInterval(function() { funca(10,3); },500); 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2016-07-02T00:12:38.270

到目前为止，最实用的答案是 tvanfosson 给出的答案，我所能做的就是给你一个 ES6 的更新版本：

```
setInterval( ()=>{ funca(10,3); }, 500); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-01-25T17:23:58.317

引用论点就足够了：

```
OK --> reloadIntervalID = window.setInterval( "reloadSeries('"+param2Pass+"')" , 5000)

KO --> reloadIntervalID = window.setInterval( "reloadSeries( "+param2Pass+" )" , 5000) 
```

注意每个参数的单引号`'`。

通过 IE8、Chrome 和 FireFox 测试

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-10-17T20:24:34.923

```
const designated = "1 jan 2021"

function countdown(designated_time){

    const currentTime = new Date();
    const future_time = new Date(designated_time);
    console.log(future_time - currentTime);
}

countdown(designated);

setInterval(countdown, 1000, designated); 
```

有很多方法可以做到这一点，我个人认为这是干净和甜蜜的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2021-07-17T10:45:31.243

这个答案的最佳解决方案是下一个代码块：

```
setInterval(() => yourFunction(param1, param2), 1000); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-07-02T00:04:52.717

我知道这个话题太老了，但这是我关于在`setInterval`函数中传递参数的解决方案。

**html:**

```
var fiveMinutes = 60 * 2;
var display = document.querySelector('#timer');
startTimer(fiveMinutes, display); 
```

JavaScript：

```
function startTimer(duration, display) {
    var timer = duration,
        minutes, seconds;

    setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;
        --timer; // put boolean value for minus values.

    }, 1000);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-12-04T07:10:41.567

这行得通`setInterval("foo(bar)",int,lang);`.... **Jon Kleiser**引导我找到答案。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-02-16T07:46:40.337

另一个解决方案包括像这样传递你的函数（如果你有动态变量）： setInterval('funca('+x+','+y+')',500);

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-03-04T15:33:53.377

您可以使用名为 underscore js 的库。它为 bind 方法提供了一个很好的包装，并且语法也更简洁。让您在指定范围内执行函数。

[http://underscorejs.org/#bind](http://underscorejs.org/#bind)

_.bind（函数，范围，*参数）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-01-02T11:57:14.143

这个问题将是使用闭包的一个很好的演示。这个想法是函数使用外部范围的变量。这是一个例子......

```
setInterval(makeClosure("Snowden"), 1000)

function makeClosure(name) {
var ret

ret = function(){
    console.log("Hello, " + name);
}

return ret;
} 
```

函数“makeClosure”返回另一个函数，该函数可以访问外部范围变量“name”。因此，基本上，您需要将任何变量传递给“makeClosure”函数，并在分配给“ret”变量的函数中使用它们。有影响地，setInterval 将执行分配给“ret”的函数。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-04-16T14:48:04.527

我对 Vue 应用程序也有同样的问题。在我的情况下，这个解决方案只有在匿名函数被声明为箭头函数时才有效，关于`mounted ()`生命圈钩子的声明。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-10-08T12:38:32.460

此外，在 IE Support > 9 的情况下，您可以传递更多变量内部设置间隔，您的函数将采用这些间隔。例如：

```
function myFunc(arg1, arg2){};
setInterval(myFunc, 500, arg1, arg2); 
```

问候！

# xhtml - W3C XHTML 1.0 严格兼容的图像映射？

> ID：457837
> 
> 赞同：0
> 
> 时间：2009-01-19T14:56:01.760
> 
> 标签：xhtml, imagemap

无论如何要使图像映射符合 W3C XHTML 1.0 Strict 标准吗？

我正在处理[这个页面](http://www.xebra.com/indexnew.html)，当我点击我的 W3C Validator 徽章时，我收到了一个验证错误。

```
There is no attribute "type", <area type="rect" coords="21,19,155,76" ... 
```

是否有任何符合 XHTML 1.0 Strict 标准的标签替换了图像映射 <map> 和 <area> 标签？

我确实去了 w3c 并查看了他们的规范，我唯一能找到的是带有嵌套 <li> 的 <nl> 标记，但我尝试了它们，但它们在我尝试的任何浏览器中都不起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-19T15:02:41.950

验证失败，因为属性的正确名称是**`shape`**，即该行应该是

```
<area shape="rect" coords="21,19,155,76" ... 
```

但是，`rect`无论如何都是默认值，因此您可以删除该`type`属性。

来源：[XHTML 1.0 Trans DTD](http://www.w3.org/TR/xhtml1/dtds.html#a_dtd_XHTML-1.0-Transitional)，搜索`ELEMENT area`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T15:00:26.260

图像地图的使用不像以前那样多，但是一些网站（Facebook、MySpace、Flickr）使用它们来标记照片。这是一个链接，向您展示实现类似结果的方法。

[CSS 图像映射](http://www.frankmanno.com/ideas/css-imagemap/)

[CSS 图像映射，Redux](http://www.frankmanno.com/ideas/css-imagemap-redux/)

[列表分开：图像地图之夜](http://www.alistapart.com/articles/imagemap/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:04:33.350

改用`a`链接元素并使用 CSS 来定位它们。*类似*（虽然不完全一样）这样的东西：

```
<div id="myheader">
    <a href="#" class="link1"><span>Link text for people without CSS</span></a>
</div> 
```

和

```
#myheader {position:relative}
#myheader a {position:absolute;display:block}
#myheader a.link1 {top:5px;left:10px;width:20px;height:50px}
#myheader a span {display:none} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T19:34:01.047

## 成功！

多亏了[Ozone Asylum](http://www.ozoneasylum.com/)的某个人，我找到了答案，他将我带到了一篇关于[css sprites](http://www.alistapart.com/articles/sprites/)[的 List Apart 文章](http://www.alistapart.com/articles/sprites/)。你可以做同样的事情，只是没有那么困难。（但它可以是 XHTML 兼容的！）

我实际上在[这里](http://www.route6radio.com/)做了一个，只需单击红色大箭头即可查看示例...

公平地说，虽然我承认，它看起来有点俗气......客户选择的照片，不是我的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-20T07:20:51.393

我做了一些研究，似乎浏览器还不支持 XHTML Strict 兼容的图像映射。

我的最后一个绊脚石是大多数浏览器都需要 usemap 属性中的“#”才能工作，这现在是无效的。

您可以通过检测浏览器是否接受内容类型 application/xhtml+xml 并仅使用该类型进行响应来绕过对 name 属性的需求。（然后它修复了 Chrome，我认为 Firefox 不会破坏 IE）。

我使用了几个 css 解决方案并最终使用了 Oli 的建议。简单而且有效。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-19T15:12:57.530

老实说，如果您正在制作图像映射，那么您可能使用了不正确的 XHTML 语义。您应该真正发布您正在尝试做的事情，看看它们是否是可行的替代方案。

# .net - 如何自定义我的 WCF 服务以仅在一个 EndPoint 中使用 DataContractSurrogate？

> ID：457846
> 
> 赞同：1
> 
> 时间：2009-01-19T14:58:26.297
> 
> 标签：.net, wcf, datacontractserializer

在我的 wcf 服务中，我对使用 DataContractSurrogate 感兴趣，同时在特定端点（例如 WebHttpBinding）中公开 ServiceContract。

1.  我该怎么做 ？实施 IEndpointBehavior？
2.  除此之外，我是否需要实现 IWsdlExportExtension？

谢谢，
阿迪尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T16:10:17.507

查看 MSDN 页面上数据合同代理的“实施代理”部分。

[您可以在此处](http://msdn.microsoft.com/en-us/library/ms733064.aspx)找到该页面。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-20T12:05:01.620

[http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/e4e7b153-a213-4ee2-84fa-1d76838a58b5/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/e4e7b153-a213-4ee2-84fa-1d76838a58b5/)

# .net - HTTPWebRequest 远程证书名称不匹配

> ID：457848
> 
> 赞同：3
> 
> 时间：2009-01-19T14:59:08.837
> 
> 标签：.net, ssl, httpwebrequest

我正在尝试使用 SSL 调用`HTTPWebRequest`，但它不断失败，说它无法建立信任。我添加了一个回调`ServicePointManager.ServerCertificateValidationCallback`并返回`true`总是有效的。但是，我希望事情比这更安全一些。查看`SslPolicyErrors`验证方法中的内容，我似乎遇到了`RemoteCertificateNameMismatch`错误。什么没有正确匹配导致这种错误？

（编辑：请参阅答案中的评论）我正在访问的站点使用基于 SSL 的 HTTPBasic 和类似 v1.api.serviceprovider.com 的 URL，并带有颁发给 *.serviceprovider.com 的证书。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T15:02:23.387

一般证书问题：

*   不是由受信任的证书提供商颁发的证书（必须在您的信任链中）
*   证书过期

此特定错误通常意味着未为您访问的站点颁发证书。例子：

*   “www.yoursite.com”和“yoursite.com”之间的区别（它们是不同的；一些大牌弄错了，这真的让我很恼火......）
*   作为 IP 地址而不是证书上的名称访问；或 v/v
*   负载均衡器将您重定向到“server1,yoursite.com”，但为您提供“yoursite.com”的证书
*   一个负载均衡器默默地将您传递给“server1”，它正在为“server1”而不是站点颁发证书
*   （**编辑见评论**）为多个级别颁发的通配符证书 - 即当您点击 foo.bar.somesite.org 时颁发给 *.somesite.org

通过导航到该站点并阅读浏览器向您发出的警告并检查已颁发的证书，其中大部分都可以轻松识别。

# .net - 如何将 Silverlight 2.0 画布保存到数据库并将其导出为 PDF

> ID：457851
> 
> 赞同：2
> 
> 时间：2009-01-19T14:59:27.680
> 
> 标签：.net, silverlight, xaml, pdf

我有一个 Silverlight 2.0 项目，允许用户将文本和图像添加到画布。他们可以移动、旋转和调整文本/图像的大小。我想知道将 Silverlight 对象序列化到数据库并能够生成要打印的画布的 PDF 的最佳方法。

我已经阅读了一些关于调用 Web 服务并传递序列化数据，然后保存和生成 PDF 的文章。我的主要问题是如何有效地序列化 Silverlight 对象，以便在用户返回时重新绘制它们，以及是否有一种简单的方法可以将画布保存为 PDF 或图像。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T18:30:06.227

我们在构建 colaab 时遇到了完全相同的问题，这是一个 Silverlight 2 协作系统，可在以下位置获得：

[http://www.colaab.com](http://www.colaab.com)

选项似乎是：

1.  创建一个服务器端进程以打开 Web 浏览器并正确设置页面，然后使用[WebShot](http://www.websitescreenshots.com/)等软件对其进行截图。

2.  将 Xaml 从您的可视化树发送到服务器（[SilverlightContrib](http://silverlightcontrib.org/)中有一个方便的类可以从对象模型中获取 Xaml）。一旦你在服务器端得到它，使用完全成熟的 .NET 框架 WPF 支持将它导出为 PNG。这在服务器端不受支持，因为 WPF 是一种客户端技术。

3.  使用 HTML Bridge 调用浏览器的打印功能

4.  等待 Silverlight 3 -“更好的打印和 RenderTargetBitmap（AKA 位图屏幕截图）是我们计划在下一个版本中使用的两个功能。”

谢谢，

鲍勃

——鲍勃汤姆森风暴想法

[http://www.colaab.com](http://www.colaab.com) [http://blog.stormideas.com](http://blog.stormideas.com) 推特：前进

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T16:09:20.410

不幸的是，没有一种简单的方法可以将画布保存为 pdf 或图像。我们最近遇到了类似的问题，并求助于运行一项服务，该服务实质上在内存中创建了一个 IE 浏览器，托管 Silverlight 应用程序，然后从那里截取它。有点繁琐......我希望像 Canvas.ToImage() ;)

抱歉没有更好的答案！

我很快就会发现有关序列化的信息。

# c# - 使用 asp.net 下载文件

> ID：457856
> 
> 赞同：3
> 
> 时间：2009-01-19T14:59:39.663
> 
> 标签：c#, .net, asp.net, file, download

有一个数据文件和一些图像文件，我必须每晚使用 asp.net 下载到我们的本地服务器。做这个的最好方式是什么？

更新

好的，在查看回复后，我发现我最初使用 asp.net 的帖子是一个糟糕的选择。您将如何为 C# 中的控制台应用程序编写它。我不确定我使用哪些类来连接远程服务器并从远程服务器下载文件。

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T15:45:42.347

> > “你将如何用 C# 为控制台应用程序编写它。”

创建 C# 控制台应用程序。添加对 System.Net 的引用。

```
 using System;
using System.Net;

namespace Downloader
{
    class Program
    {
        public static void Main(string[] args)
        {
            using (WebClient wc = new WebClient())
            {
                wc.DownloadFile("http://www.mydomain.com/resource.img", "c:\\savedImage.img");
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-06-20T17:28:57.143

要从远程 URL 下载任何文件，您可以在 System.Net 命名空间内的 C# 中使用 WebClient。

公共文件结果歌曲（字符串歌曲）{

```
 WebClient client = new WebClient();
        var stream = client.OpenRead("http://www.jplayer.org/audio/mp3/Miaow-03-Lentement.mp3");

        return File(stream, "audio/mpeg");

    } 
```

对于每晚下载数据，您可以使用任务调度程序。 [http://www.quartz-scheduler.net/](http://www.quartz-scheduler.net/)可以帮你安排任务

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:02:55.693

要每天晚上执行此操作，您可以将其设置为服务器上的计划任务，以访问特定的 asp.net 网页以执行您想要的代码。

您的 ASP.NET 页面将包含用于下载文件和执行所需处理的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T15:05:56.250

您通常不会通过 ASP.NET 执行此操作。网页代码仅在发出 HTTP/HTTPS 请求时执行，并且通常由最终用户使用 Web 浏览器或 Web 爬虫触发。

您想使用 FTP 之类的东西来下载文件，并使用 Windows 服务来自动启动下载。

* * *

更新以响应问题更新：

您可以通过简单的[google 搜索](http://www.google.com/search?q=FTP+download+in+c%23)找到大量有关通过 .NET 中的 FTP 下载的信息。

查看这个[C# FTP 客户端库](http://www.codeproject.com/KB/IP/ftplib.aspx)。

这里有一些关于在 .NET 中创建 Windows 服务的不错的链接：

[http://www.codeproject.com/KB/dotnet/simplewindowsservice.aspx](http://www.codeproject.com/KB/dotnet/simplewindowsservice.aspx)

[http://www.developer.com/net/net/article.php/2173801](http://www.developer.com/net/net/article.php/2173801)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T15:27:09.980

System.Net.WebClient 类上的 DownloadFile 方法可能是一个不错的起点。你给它一个 URL 字符串和一个文件名，剩下的就交给它了。 [MSDN 上的 System.NET.WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)

您甚至可以使用此类设置自定义用户代理字符串并上传文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T15:32:40.080

如果你不能用 FTP 来做，你想使用 HttpWebRequest 和 HttpWebResponse 来完成这项工作。[来自 MSDN](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getresponse.aspx)：

```
using System;
using System.Net;
using System.Text;
using System.IO;

    public class Test
    {
        // Specify the URL to receive the request.
        public static void Main (string[] args)
        {
            HttpWebRequest request = (HttpWebRequest)WebRequest.Create (args[0]);

            // Set some reasonable limits on resources used by this request
            request.MaximumAutomaticRedirections = 4;
            request.MaximumResponseHeadersLength = 4;
            // Set credentials to use for this request.
            request.Credentials = CredentialCache.DefaultCredentials;
            HttpWebResponse response = (HttpWebResponse)request.GetResponse ();

            Console.WriteLine ("Content length is {0}", response.ContentLength);
            Console.WriteLine ("Content type is {0}", response.ContentType);

            // Get the stream associated with the response.
            Stream receiveStream = response.GetResponseStream ();

            // Pipes the stream to a higher level stream reader with the required encoding format. 
            StreamReader readStream = new StreamReader (receiveStream, Encoding.UTF8);

            Console.WriteLine ("Response stream received.");
            Console.WriteLine (readStream.ReadToEnd ());
            response.Close ();
            readStream.Close ();
        }
    }

/*
The output from this example will vary depending on the value passed into Main 
but will be similar to the following:

Content length is 1542
Content type is text/html; charset=utf-8
Response stream received.
<html>
...
</html>

*/ 
```

# winapi - 如何在运行时检查 Win32 中的 windows 版本？

> ID：457872
> 
> 赞同：16
> 
> 时间：2009-01-19T15:02:52.667
> 
> 标签：winapi

如何在运行时检查 Win32 中的 windows 版本？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-19T15:04:21.167

使用[`GetVersionEx()`](http://msdn.microsoft.com/en-us/library/ms724451(VS.85).aspx)或[`VerifyVersionInfo()`](http://msdn.microsoft.com/en-us/library/ms725492(VS.85).aspx)功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-12-02T11:56:52.963

GetVersionEx 已被弃用。我们将需要使用[Version Helper 函数](https://msdn.microsoft.com/en-us/library/windows/desktop/dn424972(v=vs.85).aspx)。

# php - php 服务器到服务器的帖子？

> ID：457874
> 
> 赞同：4
> 
> 时间：2009-01-19T15:03:07.440
> 
> 标签：php, curl

我想让一台服务器向另一台服务器发出 http post 请求。我可以通过基本的 php 安装（在我的情况下为 Dreamhost）来做到这一点吗？如果是这样，请指出我正确的方向！谢谢，-摩根

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T15:08:03.857

如果我是你，我会[使用 Curl 。](http://www.askapache.com/htaccess/sending-post-form-data-with-php-curl.html)

编辑：看起来[它在 DH 上受支持](http://wiki.dreamhost.com/index.php/CURL)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T15:09:00.703

[http://blog.brezovsky.net/en-text-3.html](http://blog.brezovsky.net/en-text-3.html)

```
 function httpSocketConnection($host, $method, $path, $data)
    {
        global $Db;

        $method = strtoupper($method);        

        if ($method == "GET")
        {
            $path.= '?'.$data;
        }    

        $filePointer = fsockopen($host, 80, $errorNumber, $errorString);

        if (!$filePointer) 
        {
            throw new Exception("Chyba spojeni $errorNumber $errorString");
        }

        $requestHeader = $method." ".$path."  HTTP/1.1\r\n";
        $requestHeader.= "Host: ".$host."\r\n";
        $requestHeader.= "User-Agent:      Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\r\n";
        $requestHeader.= "Content-Type: application/x-www-form-urlencoded\r\n";

        if ($method == "POST")
        {
            $requestHeader.= "Content-Length: ".strlen($data)."\r\n";
        }

        $requestHeader.= "Connection: close\r\n\r\n";

        if ($method == "POST")
        {
            $requestHeader.= $data;
        }            

        fwrite($filePointer, $requestHeader);

        $responseHeader = '';
        $responseContent = '';

        do 
        {
            $responseHeader.= fread($filePointer, 1); 
        }
        while (!preg_match('/\\r\\n\\r\\n$/', $responseHeader));

        if (!strstr($responseHeader, "Transfer-Encoding: chunked"))
        {
            while (!feof($filePointer))
            {
                $responseContent.= fgets($filePointer, 128);
            }
        }
        else 
        {

            while ($chunk_length = hexdec(fgets($filePointer))) 
            {
                $responseContentChunk = '';

                $read_length = 0;

                while ($read_length < $chunk_length) 
                {
                    $responseContentChunk .= fread($filePointer, $chunk_length - $read_length);
                    $read_length = strlen($responseContentChunk);
                }

                $responseContent.= $responseContentChunk;

                fgets($filePointer);

            }

        }

        return chop($responseContent);

    } 
```

# .net - PickupDirectoryFromIis、Sender 属性和 SMTP MAIL FROM 信封

> ID：457880
> 
> 赞同：4
> 
> 时间：2009-01-19T15:04:49.777
> 
> 标签：.net, email, smtp, system.net.mail

当您发送电子邮件时，`System.Net.Mail`您可以使用属性设置 SMTP MAIL FROM 信封`MailMessage.Sender`。

如果将 smtp 网络`deliveryMethod`属性设置为“网络”，则使用 Sender 值设置 MAIL FROM 信封。

如果您将 smtp 网络`deliveryMethod`属性设置为“PickupDirectoryFromIis”，则 MAIL FROM 信封使用该`MailMessage.From`属性而不是 Sender 属性。

我需要保留 PickupDirectoryFromIis 作为我`deliveryMethod`的性能问题。

任何建议如何保持我需要的 SMTP MAIL FROM 信封的价值？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-07T01:40:53.687

如果你使用怎么办：

```
 <smtp deliveryMethod="SpecifiedPickupDirectory" from="me@mydomain.com">
    <specifiedPickupDirectory pickupDirectoryLocation="c:\Temp\Mail" />
  </smtp> 
```

??

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-20T16:01:59.960

报告为错误： [https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=483878](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=483878)

# c++ - 为什么不可能有对void的引用？

> ID：457896
> 
> 赞同：49
> 
> 时间：2009-01-19T15:09:15.913
> 
> 标签：c++, reference, void-pointers

为什么不可能引用 void？我在 C++ 标准中找到的唯一内容是这一行，位于**8.3.2.1**

> *指定类型“对cv* void的引用”的声明符格式不正确。

为什么会这样？为什么我不能编写一个接受 a 的“通用”函数`void&`？

为了清楚起见，我没有想到使用 void 引用可能比使用模板更好的有用应用程序，但我只是对禁止这种构造的理由感到好奇。

* * *

为了澄清一点，我知道“按原样”使用对 void 的引用与取消引用指向 void 的指针一样毫无意义。但是，我可以将它转换为对某种类型的引用*以便*使用它，不是吗？事实上，我不明白为什么下面的代码片段可以工作......

```
void foo(void *data)
{
    int *i = reinterpret_cast<int*>(data);
    // do something with i
} 
```

...虽然这个不能：

```
void foo(void &data)
{
    int &i = reinterpret_cast<int&>(data);
    // do something with i
} 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-19T15:26:16.957

如果你确实提到了 void，你会用它做什么？它不会是数字、字符、指针或类似的东西。您假设的通用函数无法对其执行任何操作，除了获取其地址（而不是其大小）。

“void”有两个用途：否认任何类型知识（如在 void * 中），以及不指定任何东西而不是某物（void 函数返回）。在这两种情况下，除了它可能有一个地址之外，不可能说任何关于 void 的东西。

如果你想不出某种有用的方法，而我想不出，那至少是某物无用的证据，这很可能至少是这里的部​​分理由。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-19T15:18:09.937

首先问问你自己，你将如何取消引用一个 void 指针？

```
void *p = /*something*/ ;
cout << *p << endl; 
```

上面的代码是没有意义的，我们有 void 的原因之一是我们可以说“我需要在这里做一些通用的指针工作，我既不知道也不关心我指向什么”。根据定义，编译器不知道 void * 指向什么，因此它不能取消引用它。您可以 - 通过强制转换 - 但编译器不能。

对 void 的引用也存在同样的问题，根据定义，指向的数据没有类型，因此不能以任何有意义的方式引用它。

要引用它，您 - 程序员 - 需要将其转换为另一种类型，然后您可以对它进行类型化引用。

不确定我是否按照我的意愿解释了这一点。

鲁本，有什么想法吗？

**编辑：**回答您的编辑。

使用第一个函数，传递 void* 数据。data 是一个完全有效的项目，你可以用它来计算，或者如果你实现了一些日志记录，你可以记录它。

```
logger << data; 
```

你会得到地址数据点。如果您尝试取消引用数据，编译器会给您一个错误（目前没有方便的 C++ 编译器，因此不确定实际错误）。例如

```
void* data = /* some assignment */;
logger << *data; // compiler error. 
```

现在，编译器不会让您出于任何原因取消引用 void* （这没有意义），同样代表对 void &data 的引用，只是因为它是引用*，所以一直隐式取消引用*。编译器不会让您在一个操作上取消引用 void*，它不会让您不断地取消引用它。

```
void& data = /* some assignment *.;
logger << data; // means same as logger << *data above 
```

**除了**获取地址之外，您无法对数据做**任何**事情，并且语言中内置了一种非常好的 - 且安全的方法来做到这一点，即

 **```
void* data; 
```

这更有意义吗？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-19T15:15:31.440

引用是对某事物实例的引用。某事的实例不能是 type `void`。任何事物的实例都必须具有特定的类型（可能还有基本类型）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T17:38:05.553

以下是我已经说过的和我想到的不同事情的摘要。

## 不允许引用 void 的两个主要原因

* * *

1**他们完全没用。**

事实上，如果我们回顾 C 的时代，空指针有两个用途：

*   内存管理（例如 malloc）
*   通用性（编写可以接受任何类型参数的函数）

当 C++ 出现时，模板成为实现泛型的最佳解决方案。然而，自定义内存管理仍然是可能的，并且 C++ 和 C 之间的互操作性是一个主要问题，因此保留了 void*。假设的 void 引用对内存管理没有帮助，并且已经涵盖了通用性，因此基本上它几乎没有用处（除了下面描述的非空性保证）。

2**你将无法用它做任何事情**

使用 void 指针时，不允许取消引用它；转置到引用的情况下，这意味着您不能使用（总是假设的）无效引用。所以

```
void *data = // something
// using *data and data-> is forbidden

void &data = // something
// using data is forbidden 
```

但是，我们可以考虑一个用例，其中引用不必被“取消引用”（这个短语非常不正确，但你明白我的意思），但我们只需要它的地址。假设我有以下功能：

```
void foo(void *dataptr)
{
    assert(dataptr != NULL); // or != 0
    // do something with dataptr
} 
```

为了避免这种烦人的断言，我可以这样编写函数：

```
void foo(void &dataref)
{
    void *data = &dataref;
    // do something with data
} 
```

但是，要使其正常工作，`&dataref`需要等效于`dataptr`，**但情况并非如此**：`&dataref`等效于`&*dataptr`!

因此，即使取地址也意味着取消引用，至少在概念上是这样（在幕后，第一个等价可能是真的，但在语义层面上却不是）。因此，我们绝对不能使用数据，所以空引用是一种异常。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-19T16:16:41.800

从技术上讲，所有可以保证的是对对象的引用是它的别名。引擎盖下的引用参数传递是通过指针完成的，这是一个实现细节。这可能会令人困惑，因为引用重用了也是地址的 & 运算符，但请记住，该运算符实际上在不同的上下文中具有不同的含义（在变量或参数声明中，它表示引用类型，否则它是地址，除非它是按位与）。因为它在技术上只是对象的别名，所以正如 Worrier 解释的那样，引用“总是被取消引用”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-20T01:08:59.583

好的，有一件事困扰着我。如上所述， a 的想法`void*`是您仍然有一个包含地址的有效变量，但类型被忽略了。这似乎是允许的，因为我们仍然可以使用地址数据——在这种情况下，类型有点多余（或不太重要）。取消引用它是不好的，因为尝试*访问成员*没有意义，例如`p.mem`. 我们不知道要引用哪个类，因此不知道要跳转到的内存，要跟随的 vtable 指针。

然而，它本身似乎是有道理的，`p`因为它只引用对象，但没有引用它的数据。这样做不需要类信息，只需要地址。我知道这绝对没有用，但它在定义事情何时发生故障时很重要。允许这个概念，C++ 引用（不断取消引用但不访问任何东西）例如`void& ref = static_cast< &void >(obj)`也是有意义的，因此将允许无效引用。我并不是说任何人都应该与负责人讨论，但从“有意义”的角度来看，这似乎是正确的，不是吗？

正如 Luc Touraille 上面指出的（至少，这是我的解释），它可以实现，但问题是语义问题。我可以得出的合理解释是，由于对象变量是内存序列的“标签”，因此类型具有重要的语义价值。因此，指针被认为是具有地址值的变量，将类型视为有些多余 - 不是定义它的关键。

有人会同意吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T17:06:42.697

您可以将引用视为取消引用的指针。从语法上讲，您将引用视为不是指针：您不需要 * 运算符来取消引用它，您可以使用 . 而不是 -> 来访问其成员。

但是，您不能取消引用`void`指针。正如 Binary Worrier 指出的那样，试图这样做会给你一个编译器错误。如果你不能有一个取消引用的 void 指针，那意味着你不能有一个 void 引用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T18:39:07.380

如果它们是，它们在语义上与指针没有区别，并且相当于语法糖。一个参考说，“我指的是这种类型的东西。” 允许 void 或 null 引用会削弱与指针的差异。

当然，引用仍然有可能引用一个不再存在的对象，但这是一个例外。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-20T02:51:37.277

以下*不是*对无效引用概念的辩护。我提供它作为来自野外的轶事。问问自己，这闻起来是不是很有趣。

我的公司是最早在商业上使用 C++ 的公司之一，最初是使用[Cfront](http://en.wikipedia.org/wiki/Cfront)编译的。早期的开发人员仍在学习该语言，并且通常使用书中的每一个技巧（无处不在的操作员！）。这是他们认为很酷的一个技巧：

```
void Foo::something(int action, ostream &os = *(ostream *)0)
{
   ostream *os_p = &os;
   if (&os == (ostream *)0) {
      os_p = &cerr;
   }
   // continue with method
} 
```

所以在这里你有，不是一个 void 引用，而是一个具有潜在*void*绑定的类型化引用！片刻的思考可能应该为这个特殊的习语提出更好的替代方案......

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-01-19T15:16:39.050

**void**是根据定义不存在的东西，因此拥有它的地址是不合逻辑的。

# .net - 是否可以查看注册到 StructureMap 的所有服务/类型？

> ID：457900
> 
> 赞同：0
> 
> 时间：2009-01-19T15:10:33.713
> 
> 标签：.net, inversion-of-control, structuremap

我只是在尝试结构映射，并希望能够查看我的哪些类注册了哪些服务。

例如使用城堡温莎，我可以调出调试器并查看 container.Kernel.GraphNodes 以查看所有当前注册的服务/类型配对的列表。

对 StructureMap 内部结构是否有类似的看法？同样，这只是我打算用来帮助自己熟悉其注册表 dsl 的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T08:34:54.757

ObjectFactory.WhatDoIHave() 或 container.WhatDoIHave() 其中容器是一个容器。链接可能有用： http: [//nhibernate.codebetter.com/blogs/jeremy.miller/archive/2008/11/30/a-gentle-quickstart-for-structuremap-2-5.aspx](http://nhibernate.codebetter.com/blogs/jeremy.miller/archive/2008/11/30/a-gentle-quickstart-for-structuremap-2-5.aspx)

# php - 使用 PHP/MySQL 实现购物车的最佳方法

> ID：457903
> 
> 赞同：7
> 
> 时间：2009-01-19T15:11:14.570
> 
> 标签：php, shopping-cart

我在一个客户的网站上工作，他们要求提供购物车。他们需要使用securetrading.net 进行付款，所以我不需要询问任何信用卡详细信息。我需要做的就是跟踪他们购物车中的物品。

我已经阅读了有关使用 PHP 会话的信息，但我担心那里的安全性。如果我存储的唯一信息是产品代码和数量，这不是问题吗？否则，是否值得使用 MySQL 数据库？

如果这似乎是一件显而易见的事情，我很抱歉，但这是我第一次实施这种事情！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-19T18:55:33.243

有简单/小型 php/MySQL 购物车的教程，可以在会话中保持购物车状态，甚至还有可下载的演示代码和在线演示。

[http://v3.thewatchmakerproject.com/journal/276/building-a-simple-php-shopping-cart](http://v3.thewatchmakerproject.com/journal/276/building-a-simple-php-shopping-cart)

当成熟的在线购物程序只是“夸大其词”时，我使用了它。与您一样，无需获取 cc 数据、用户注册等……只需将所选项目发送到支付网关的购买流程，然后就可以忘记它了。这就是客户想要的，这就是他最终得到的（我的第一选择是 magento，但对于客户 3 种产品来说太复杂了）。

当然，您需要对其进行扩展以满足您的需要，但对于一些简单的事情来说，这是一个很好的起点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T15:16:14.450

我会使用预制开源解决方案。当你处理别人的钱时，你真的不想让愚蠢的安全问题出现。

[Magento 浮现](http://www.magentocommerce.com)在脑海中。这肯定是我一段时间以来见过的最狡猾的......如果[你自己破解它，](http://www.magentocommerce.com/boards/viewthread/4617/)似乎有安全交易支持。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T15:15:14.840

我会使用 PHP 会话，因为您只存储产品代码/数量。是的，这些对“攻击”是开放的——但攻击将类似于更改产品代码（确保在将信息传递到支付网关之前添加有效代码检查）和数量（再次检查数量如有需要，随时可用）

会话变量容易受到用户的攻击，但如果有人想“欺骗”我的系统并检查 4 个项目而不是 1 个项目，那根本不是问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T15:42:15.100

请记住，会话只会持续到会话。如果您的客户离开并明天回来继续购物，他们会发现他们的购物篮又是空的。

如果您打算使用会话来快速完成工作，请尝试设计您的代码，以便将来改变主意并切换到 Mysql 解决方案变得容易。

但是，除非您有非常具体的要求，否则只需在数百个免费解决方案中找到一个，即可为您节省大量时间。

# build - 如何在 bjam 中使用带有空格的文件名？

> ID：457909
> 
> 赞同：3
> 
> 时间：2009-01-19T15:12:56.327
> 
> 标签：build, bjam, boost-build, build-tools

我需要在 Jamfile 中描述一个外部库。库的位置保存在环境变量中。

```
set EX_LIB_PATH=C:\Program Files\Ext 
```

这是来自 Jamfile 的片段：

--剪辑--

```
lib extlin : : <file>$(EXT_LIB_PATH)/lib/library.lib ; 
```

- 旋转 -

bjam 抱怨说找不到“C:\Program”。可以做些什么来让 Jamfile 中的 lib 规则调用接受带有嵌入空间的路径？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-04-05T15:41:25.543

有点晚了，但作为参考，试试这个：

```
lib extlin : : <file>"$(EXT_LIB_PATH:J=\ )/lib/library.lib" ; 
```

在 Boost.Jam 版本 3.1.10 上为我工作。操作系统=新台币。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T15:25:02.547

你试过把它放在引号里吗？

```
lib extlin : : <file>"$(EXT_LIB_PATH)/lib/library.lib" ; 
```

这是一个问题，确切地说，bjam 何时扩展了变量名，以及如果在后面的其他东西有一个带有空格的文件名的问题。但我相信这应该有效。

# git - Git 工作流程和变基与合并问题

> ID：457927
> 
> 赞同：1020
> 
> 时间：2009-01-19T15:16:52.623
> 
> 标签：git, version-control, git-merge, git-rebase

几个月来，我和其他开发人员一起在一个项目中使用了 Git。我有几年的[SVN](http://en.wikipedia.org/wiki/Apache_Subversion)经验，所以我想我给这段关系带来了很多包袱。

我听说 Git 非常适合分支和合并，但到目前为止，我还没有看到它。当然，分支非常简单，但是当我尝试合并时，一切都变得糟糕透顶。现在，我已经习惯了 SVN，但在我看来，我只是将一个低于标准的版本控制系统换成了另一个。

我的搭档告诉我，我的问题源于我想随意合并的愿望，并且在许多情况下我应该使用 rebase 而不是合并。例如，这是他制定的工作流程：

```
clone the remote repository
git checkout -b my_new_feature
..work and commit some stuff
git rebase master
..work and commit some stuff
git rebase master
..finish the feature
git checkout master
git merge my_new_feature 
```

本质上，创建一个特性分支，总是从主分支变基到分支，然后从分支合并回主分支。需要注意的重要一点是，分支始终保持在本地。

这是我开始的工作流程

```
clone remote repository
create my_new_feature branch on remote repository
git checkout -b --track my_new_feature origin/my_new_feature
..work, commit, push to origin/my_new_feature
git merge master (to get some changes that my partner added)
..work, commit, push to origin/my_new_feature
git merge master
..finish my_new_feature, push to origin/my_new_feature
git checkout master
git merge my_new_feature
delete remote branch
delete local branch 
```

有两个本质区别（我认为）：我总是使用合并而不是变基，并且我将我的功能分支（和我的功能分支提交）推送到远程存储库。

我对远程分支的推理是我希望在工作时备份我的工作。我们的存储库会自动备份，如果出现问题可以恢复。我的笔记本电脑没有，或者没有那么彻底。因此，我讨厌在我的笔记本电脑上有没有在其他地方镜像的代码。

我对合并而不是 rebase 的理由是，merge 似乎是标准的，而 rebase 似乎是一个高级功能。我的直觉是我想做的不是高级设置，所以 rebase 应该是不必要的。我什至仔细阅读了关于 Git 的新实用程序设计书，它们广泛地涵盖了合并，几乎没有提到变基。

无论如何，我在最近的一个分支上遵循我的工作流程，当我试图将它合并回 master 时，一切都变得糟糕透顶。与本应无关紧要的事情发生了很多冲突。这些冲突对我来说毫无意义。我花了一天的时间整理一切，最终以强制推送到远程 master 达到高潮，因为我的本地 master 已经解决了所有冲突，但远程 master 仍然不高兴。

像这样的“正确”工作流程是什么？Git 应该让分支和合并变得超级容易，而我只是没有看到它。

**2011-04-15 更新**

这似乎是一个非常受欢迎的问题，所以我想我会用我第一次问起的两年经验来更新。

事实证明，最初的工作流程是正确的，至少在我们的例子中是这样。换句话说，这就是我们所做的并且它有效：

```
clone the remote repository
git checkout -b my_new_feature
..work and commit some stuff
git rebase master
..work and commit some stuff
git rebase master
..finish the feature, commit
git rebase master
git checkout master
git merge my_new_feature 
```

事实上，我们的工作流程有点不同，因为我们倾向于进行*squash 合并*而不是原始合并。（**注意：这是有争议的，见下文。**）这允许我们将整个功能分支变成 master 上的单个提交。然后我们删除我们的功能分支。这允许我们在 master 上逻辑地构建我们的提交，即使它们在我们的分支上有点混乱。所以，这就是我们要做的：

```
clone the remote repository
git checkout -b my_new_feature
..work and commit some stuff
git rebase master
..work and commit some stuff
git rebase master
..finish the feature, commit
git rebase master
git checkout master
git merge --squash my_new_feature
git commit -m "added my_new_feature"
git branch -D my_new_feature 
```

**Squash Merge Controversy** - 正如一些评论者所指出的，squash 合并将丢弃您功能分支上的所有历史记录。顾名思义，它将所有提交压缩为一个。对于小功能，这是有道理的，因为它将它压缩成一个包。对于更大的功能，这可能不是一个好主意，特别是如果您的个人提交已经是原子的。这真的取决于个人喜好。

**Github 和 Bitbucket（其他？）Pull Requests** - 如果您想知道合并/rebase 与 Pull Requests 的关系，我建议您按照上述所有步骤操作，直到您准备好合并回 master。无需手动与 git 合并，您只需接受 PR。请注意，这不会进行 squash 合并（至少默认情况下不会），但非 squash、非快进是 Pull Request 社区中公认的合并约定（据我所知）。具体来说，它是这样工作的：

```
clone the remote repository
git checkout -b my_new_feature
..work and commit some stuff
git rebase master
..work and commit some stuff
git rebase master
..finish the feature, commit
git rebase master
git push # May need to force push
...submit PR, wait for a review, make any changes requested for the PR
git rebase master
git push # Will probably need to force push (-f), due to previous rebases from master
...accept the PR, most likely also deleting the feature branch in the process
git checkout master
git branch -d my_new_feature
git remote prune origin 
```

我开始爱上 Git，再也不想回到 SVN。如果你在挣扎，那就坚持下去，最终你会看到隧道尽头的曙光。

* * *

## 回答 #1

> 赞同：414
> 
> 时间：2012-06-27T04:25:29.937

# TL;博士

git rebase 工作流程并不能保护您免受不擅长解决冲突的人或习惯于 SVN 工作流程的人的伤害，就像[避免 Git 灾难：血腥故事](http://www.randyfay.com/node/89)中所建议的那样。它只会让冲突解决对他们来说更加乏味，并且更难从糟糕的冲突解决中恢复过来。相反，请使用 diff3，这样一开始就不会那么困难。

* * *

# Rebase 工作流程并不适合解决冲突！

我非常支持清理历史记录。但是，如果**我遇到冲突，我会立即中止变基并进行合并！**人们推荐使用 rebase 工作流程作为解决冲突的合并工作流程的更好替代方案，这真的让我很生气（这正是这个问题的意义所在）。

如果它在合并期间“全部下地狱”，它会在 rebase 期间“下地狱”，并且可能还有更多的地狱！原因如下：

## 原因 #1：解决一次冲突，而不是每次提交一次

当您变基而不是合并时，您将不得不执行冲突解决，次数与您提交变基的次数一样多，对于相同的冲突！

### 真实场景

我从 master 分支出来重构一个分支中的复杂方法。我的重构工作总共包含 15 次提交，因为我正在努力重构它并获得代码审查。我重构的一部分涉及修复以前存在于 master 中的混合制表符和空格。这是必要的，但不幸的是它会与之后在 master 中对此方法所做的任何更改相冲突。果然，当我正在研究这个方法时，有人对 master 分支中的相同方法进行了简单、合法的更改，该更改应该与我的更改合并。

当需要将我的分支与 master 合并时，我有两个选择：

**git merge：** 我遇到了冲突。我看到他们对 master 所做的更改并将其与我的分支（的最终产品）合并。完毕。

**git rebase：** 我的*第一次*提交发生了冲突。我解决了冲突并继续变基。我与*第二次*提交发生冲突。我解决了冲突并继续变基。我与*第三次*提交发生冲突。我解决了冲突并继续变基。我与*第四次*提交发生冲突。我解决了冲突并继续变基。我与*第五次*提交发生冲突。我解决了冲突并继续变基。我与*第六次*提交发生冲突。我解决了冲突并继续变基。我和我的*第七个人发生冲突*犯罪。我解决了冲突并继续变基。我与我的*第八次*提交发生冲突。我解决了冲突并继续变基。我与*第九次*提交发生冲突。我解决了冲突并继续变基。我与*第十次*提交发生冲突。我解决了冲突并继续变基。我与*第十*一次提交发生冲突。我解决了冲突并继续变基。我与*第十二*次提交发生冲突。我解决了冲突并继续变基。我与我的*第十三*次提交发生冲突。我解决了冲突并继续变基。我和我的*十四岁发生冲突*犯罪。我解决了冲突并继续变基。我与我的*第十五次*提交发生冲突。我解决了冲突并继续变基。

*如果这*是您首选的工作流程，那您一定是在开玩笑。所需要的只是一个空白修复，它与对 master 所做的更改发生冲突，并且每次提交都会发生冲突并且必须解决。这是一个只有空格冲突的*简单场景。***天堂禁止您发生真正的冲突，涉及跨文件的主要代码更改，并且必须*多次*解决。**

**随着您需要做的所有额外的冲突解决，它只会增加您犯错误**的可能性。但是 git 中的错误很好，因为您可以撤消，对吗？当然除了...

## 原因 #2：使用 rebase，没有撤消！

我想我们都同意解决冲突可能很困难，而且有些人很不擅长。它很容易出错，这就是为什么 git 可以很容易地撤消它的原因！

**当你合并**一个分支时，git 会创建一个合并提交，如果冲突解决不顺利，它可以被丢弃或修改。即使您已经将错误的合并提交推送到公共/权威存储库，您也可以使用`git revert`撤消合并引入的更改并在新的合并提交中正确重做合并。

**当您重新**设置分支时，如果冲突解决可能出错，您就完蛋了。现在每个提交都包含错误的合并，您不能只重做 rebase*。充其量，您必须返回并修改每个受影响的提交。不好玩。

在 rebase 之后，无法确定提交的最初部分是什么，以及由于冲突解决不当而引入的内容。

[*如果您可以从 git 的内部日志中挖掘旧的 refs，或者如果您创建第三个分支以指向变基之前的最后一次提交，则可以撤消变基。]

# 摆脱冲突解决：使用 diff3

以这个冲突为例：

```
<<<<<<< HEAD
TextMessage.send(:include_timestamp => true)
=======
EmailMessage.send(:include_timestamp => false)
>>>>>>> feature-branch 
```

从冲突来看，不可能说出每个分支发生了什么变化或它的意图是什么。在我看来，这是解决冲突令人困惑和困难的最大原因。

diff3来救援！

```
git config --global merge.conflictstyle diff3 
```

当您使用 diff3 时，每个新的冲突都会有一个第 3 部分，即合并的共同祖先。

```
<<<<<<< HEAD
TextMessage.send(:include_timestamp => true)
||||||| merged common ancestor
EmailMessage.send(:include_timestamp => true)
=======
EmailMessage.send(:include_timestamp => false)
>>>>>>> feature-branch 
```

首先检查合并的共同祖先。然后比较每一方以确定每个分支的意图。您可以看到 HEAD 将 EmailMessage 更改为 TextMessage。它的意图是改变用于TextMessage的类，传递相同的参数。您还可以看到 feature-branch 的意图是为 :include_timestamp 选项传递 false 而不是 true。要合并这些更改，请结合两者的意图：

```
TextMessage.send(:include_timestamp => false) 
```

一般来说：

1.  比较每个分支的共同祖先，并确定哪个分支具有最简单的变化
2.  将该简单更改应用于另一个分支的代码版本，使其包含更简单和更复杂的更改
3.  删除所有冲突代码部分，而不是您刚刚将更改合并到的部分

# 替代：通过手动应用分支的更改来解决

最后，即使使用 diff3，有些冲突也很难理解。尤其是当 diff 发现在语义上不常见的共同行时（例如，两个分支碰巧在同一位置有一个空行！），就会发生这种情况。例如，一个分支更改类主体的缩进或重新排序类似的方法。在这些情况下，更好的解决策略可以是检查合并任一侧的更改并手动将差异应用到另一个文件。

让我们看看我们如何在合并冲突的场景中解决`origin/feature1`冲突`lib/message.rb`。

1.  确定我们当前签出的分支 ( `HEAD`, 或`--ours`) 还是我们正在合并的分支 ( `origin/feature1`, 或`--theirs`) 是更易于应用的更改。将 diff 与三点 ( ) 一起使用显示了自上次偏离 以来`git diff a...b`发生的变化，或者换句话说，将 a 和 b 的共同祖先与 b 进行比较。`b``a`

    ```
    git diff HEAD...origin/feature1 -- lib/message.rb # show the change in feature1
    git diff origin/feature1...HEAD -- lib/message.rb # show the change in our branch 
    ```

2.  查看更复杂的文件版本。这将删除所有冲突标记并使用您选择的一侧。

    ```
    git checkout --ours -- lib/message.rb   # if our branch's change is more complicated
    git checkout --theirs -- lib/message.rb # if origin/feature1's change is more complicated 
    ```

3.  签出复杂更改后，拉起更简单更改的差异（参见步骤 1）。将此差异中的每个更改应用于冲突文件。

* * *

## 回答 #2

> 赞同：386
> 
> 时间：2009-01-19T15:32:24.947

“冲突”是指“同一内容的平行演化”。因此，如果它在合并期间“全部下地狱”，则意味着您在同一组文件上进行了大规模的演变。

变基比合并更好的原因是：

*   你用主人之一重写你的本地提交历史（然后重新应用你的工作，然后解决任何冲突）
*   最终的合并肯定是一个“快进”的合并，因为它将拥有 master 的所有提交历史，加上只有你的更改才能重新应用。

我确认在这种情况下正确的工作流程（公共文件集的演变）**首先是 rebase ，然后是 merge**。

但是，这意味着，如果您推送本地分支（出于备份原因），则不应被其他任何人拉取（或至少使用）该分支（因为提交历史记录将被连续的 rebase 重写）。

* * *

关于那个主题（rebase 然后合并工作流程），[barraponto](https://stackoverflow.com/users/207119/barraponto)在评论中提到了两个有趣的帖子，都来自[randyfay.com](https://www.randyfay.com/)：

*   [**Git 的 Rebase 工作流程**](https://randyfay.com/content/rebase-workflow-git)：提醒我们先获取，rebase：

> 使用这种技术，您的工作总是在公共分支之上进行，就像一个与当前`HEAD`.

[（ bazaar 也存在](http://fourkitchens.com/blog/2009/04/20/alternatives-rebasing-bazaar)类似的技术）

*   [**避免 Git 灾难：一个血腥故事**](https://randyfay.com/content/avoiding-git-disasters-gory-story)：关于`git push --force`（而不是`git pull --rebase`例如）

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2009-05-12T20:54:12.417

在我的工作流程中，我尽可能地变基（并且我尝试经常这样做。不让差异累积会大大减少分支之间冲突的数量和严重性）。

然而，即使在大部分基于 rebase 的工作流程中，也有合并的地方。

回想一下，合并实际上创建了一个具有两个父节点的节点。现在考虑以下情况：我有两个独立的功能分支 A 和 B，现在想在依赖 A 和 B 的功能分支 C 上开发东西，而 A 和 B 正在接受审查。

然后我要做的是：

1.  在 A 之上创建（和结帐）分支 C。
2.  与 B 合并

现在分支 C 包含来自 A 和 B 的更改，我可以继续开发它。如果我对 A 进行任何更改，那么我会通过以下方式重建分支图：

1.  在 A 的新顶部创建分支 T
2.  将 T 与 B 合并
3.  将 C 变基到 T
4.  删除分支 T

这样我实际上可以维护任意的分支图，但是做一些比上述情况更复杂的事情已经太复杂了，因为没有自动工具在父项更改时进行变基。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-04-10T01:06:06.243

**几乎在任何情况下都不要使用 git push origin --mirror。**

它不会询问您是否确定要这样做，而且您最好确定，因为它会清除所有不在本地机器上的远程分支。

[http://twitter.com/dysinger/status/1273652486](https://web.archive.org/web/20140403061125/https://twitter.com/dysinger/status/1273652486)

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-01-19T16:15:02.367

在你的情况下，我认为你的伴侣是正确的。变基的好处在于，对于局外人来说，您的更改看起来就像它们都是以干净的顺序发生的一样。这表示

*   您的更改很容易查看
*   您可以继续进行良好的小型提交，但您可以一次将这些提交的集合公开（通过合并到 master 中）
*   当您查看公共主分支时，您会看到不同开发人员针对不同功能的不同系列提交，但它们不会全部混合

您仍然可以继续将您的私有开发分支推送到远程存储库以进行备份，但其他人不应将其视为“公共”分支，因为您将进行变基。顺便说一句，执行此操作的一个简单命令是`git push --mirror origin`.

[使用 Git 打包软件](http://www.golden-gryphon.com/software/misc/packaging.html)一文很好地解释了合并与变基之间的权衡。这是一个有点不同的上下文，但原则是相同的——它基本上归结为你的分支是公共的还是私有的，以及你计划如何将它们集成到主线中。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-05-25T20:52:22.290

看了你的解释后，我有一个问题：难道你从来没有做过

```
git checkout master
git pull origin
git checkout my_new_feature 
```

在您的功能分支中执行“git rebase/merge master”之前？

因为**您的**主分支不会从您朋友的存储库中自动更新。您必须使用`git pull origin`. 即，也许你总是从一个永不改变的本地主分支变基？然后到了推送时间，您正在推送一个存储库，其中包含您从未见过的（本地）提交，因此推送失败。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-01-19T19:30:25.967

> 无论如何，我在最近的一个分支上遵循我的工作流程，当我试图将它合并回 master 时，一切都变得糟糕透顶。与本应无关紧要的事情发生了很多冲突。这些冲突对我来说毫无意义。我花了一天的时间整理一切，最终以强制推送到远程 master 达到高潮，因为我的本地 master 已经解决了所有冲突，但远程 master 仍然不高兴。

在您的合作伙伴和您建议的工作流程中，您都不应该遇到没有意义的冲突。即使您有，如果您遵循建议的工作流程，那么在解决后不应要求“强制”推送。这表明您实际上并没有合并您要推送的分支，而是必须推送一个不是远程提示的后代的分支。

我认为你需要仔细看看发生了什么。其他人是否可以（有意或无意地）在您创建本地分支和您尝试将其合并回本地分支之间重绕远程主分支？

与许多其他版本控制系统相比，我发现使用 Git 涉及的工具更少，并且允许您着手解决对源流至关重要的问题。Git 不执行魔法，因此冲突的更改会导致冲突，但它应该通过跟踪提交父级来轻松完成写入操作。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2012-03-22T16:16:53.250

“即使你是一个只有几个分支的开发人员，养成使用 rebase 和正确合并的习惯也是值得的。基本的工作模式如下所示：

*   从现有分支 A 创建新分支 B

*   在分支 B 上添加/提交更改

*   来自分支 A 的变基更新

*   将分支 B 的更改合并到分支 A"

[https://www.atlassian.com/git/tutorials/merging-vs-rebasing/](https://www.atlassian.com/git/tutorials/merging-vs-rebasing/)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-08-25T05:40:35.623

根据我的观察，即使在合并之后，git merge 也倾向于保持分支分离，而 rebase 然后合并将其合并为一个分支。后者更清晰，而在前者中，即使在合并之后也更容易找出哪些提交属于哪个分支。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-01-19T15:25:30.750

使用 Git 没有“正确”的工作流程。使用任何漂浮你的船。但是，如果您在合并分支时经常遇到冲突，也许您应该与其他开发人员更好地协调您的工作？听起来你们两个一直在编辑相同的文件。此外，请注意空格和颠覆性关键字（即“$Id$”等）。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-12-19T14:59:52.973

我只使用 rebase 工作流，因为它在视觉上更清晰（不仅在 GitKraken 中，而且在 Intellij 和 in 中`gitk`，但我最推荐第一个）：你有一个分支，它起源于 master，它又回到了 master . 当图表干净而美丽时，您将知道**永远不会下地狱**。

[![在此处输入图像描述](https://i.stack.imgur.com/B85dm.png)](https://i.stack.imgur.com/B85dm.png)

我的工作流程与您的工作流程几乎相同，但只有一点不同：我在分支上提交到最新更改`squash`之前，在本地分支中提交一个，因为：`rebase``master`

> `rebase`基于*每个提交工作*

这意味着，如果您有 15 次提交更改了相同的行，`master`则如果您不压缩，则必须检查 15 次，但重要的是最终结果，对吗？

所以，整个工作流程是：

1.  **签出`master`并拉取以确保您拥有最新版本**

2.  从那里创建一个新分支

3.  在那里做你的工作，你可以自由地提交几次，然后推送到远程，不用担心，因为它是**你的**分支。

4.  如果有人告诉你，“嘿，我的 PR/MR 被批准了，现在它被合并到 master”，你可以获取它们/拉取它们。您可以随时或在第 6 步中执行此操作。

5.  完成所有工作后，提交它们，**如果您有多个提交，则将**它们压缩（它们都是您的工作，您更改一行代码多少次无关紧要；唯一重要的是最终版本）。推不推，无所谓。

6.  再次结帐`master`，`pull`以确保您拥有最新`master`的本地信息。您的图表应与此类似：

[![在此处输入图像描述](https://i.stack.imgur.com/GntcK.png)](https://i.stack.imgur.com/GntcK.png)

如您所见，您位于本地分支上，该分支源自 上的过时状态`master`，而`master`（本地和远程）随着您同事的更改而向前发展。

7.  结帐回您的分支，然后变基为 master。您现在将只有一次提交，因此您**只需解决一次**冲突。（在 GitKraken 中，您只需将分支拖到`master`并选择“Rebase”；我喜欢它的另一个原因。）之后，您将像：

[![在此处输入图像描述](https://i.stack.imgur.com/tCSGE.png)](https://i.stack.imgur.com/tCSGE.png)

8.  所以现在，您拥有 latest 上的所有更改`master`，以及您的分支上的更改。您现在可以推送到您的遥控器，**如果您之前推送过，则必须强制推送**；Git 会告诉你不能简单地快进。这很正常，因为 rebase，你已经改变了你的分支的起点。但你不应该害怕：*明智地使用武力，但不要害怕*。最后，遥控器也是**你的分支**`master`，所以即使你做错了也不会影响。

9.  创建 PR/MR 并等到它被批准，`master`你的贡献也会随之而来。恭喜！因此，您现在可以签出`master`、提取更改并**删除本地分支以清理图表**。如果在将远程分支合并到 master 时没有这样做，远程分支也应该被删除。

最终的图表再次清晰明了：

[![在此处输入图像描述](https://i.stack.imgur.com/CljEO.png)](https://i.stack.imgur.com/CljEO.png)

# jquery - JQuery 切换函数在 IE 中呈现奇怪的文本（丢失 ClearType？）

> ID：457929
> 
> 赞同：3
> 
> 时间：2009-01-19T15:17:06.460
> 
> 标签：jquery, internet-explorer, toggle, cleartype

我有这个小脚本可以在单击按钮时切换联系表单：

```
$(document).ready(function(){

    $("#button").click(function () {
      $("#form").toggle("slow");
    });

}); 
```

在 Firefox 中一切正常，但在 IE 中，切换的淡入效果似乎没有 100% 完成，并且文本在完成渲染之前被“冻结”，失去了所有精细分辨率。

我阅读了这个[主题](https://stackoverflow.com/questions/411058/ie-is-losing-cleartype)，但我不知道如何将它应用于我的问题。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-19T15:19:21.637

这可能是您正在寻找的。此外，网上[还有另一种类似方法的功能演示：](http://malsup.com/jquery/fadetest.html)

```
//-------------------------------------------------------------------------------------------------------
// ClearTypeFadeTo / ClearTypeFadeIn / ClearTypeFadeOut
//
// Custom fade in and fade out functions for jQuery that will work around
// IE's bug with bold text in elements that have opacity filters set when
// also using Window's ClearType text rendering.
//
// New Parameter:
// bgColor    The color to set the background if none specified in the CSS (default is '#fff')
//
// Examples:
// $('div').ClearTypeFadeIn({ speed: 1500 });
// $('div').ClearTypeFadeIn({ speed: 1500, bgColor: '#ff6666', callback: myCallback });
// $('div').ClearTypeFadeOut({ speed: 1500, callback: function() { alert('Fade Out complete') } });
//
// Notes on the interaction of ClearType with DXTransforms in IE7
// http://blogs.msdn.com/ie/archive/2006/08/31/730887.aspx
(function($) {
    $.fn.ClearTypeFadeTo = function(options) {
        if (options)
            $(this)
                .show()
                .each(function() {
                    if (jQuery.browser.msie) {
                        // Save the original background color
                        $(this).attr('oBgColor', $(this).css('background-color'));
                        // Set the bgColor so that bold text renders correctly (bug with IE/ClearType/bold text)
                        $(this).css({ 'background-color': (options.bgColor ? options.bgColor : '#fff') })
                    }
                })
                .fadeTo(options.speed, options.opacity, function() {
                    if (jQuery.browser.msie) {
                        // ClearType can only be turned back on if this is a full fade in or
                        // fade out. Partial opacity will still have the problem because the
                        // filter style must remain. So, in the latter case, we will leave the
                        // background color and 'filter' style in place.
                        if (options.opacity == 0 || options.opacity == 1) {
                            // Reset the background color if we saved it previously
                            $(this).css({ 'background-color': $(this).attr('oBgColor') }).removeAttr('oBgColor');
                            // Remove the 'filter' style to restore ClearType functionality.
                            $(this).get(0).style.removeAttribute('filter');
                        }
                    }
                    if (options.callback != undefined) options.callback();
                });
    };

    $.fn.ClearTypeFadeIn = function(options) {
        if (options)
            $(this)
                .css({ opacity: 0 })
                .ClearTypeFadeTo({ speed: options.speed, opacity: 1, callback: options.callback });
    };

    $.fn.ClearTypeFadeOut = function(options) {
        if (options)
            $(this)
                .css({ opacity: 1 })
                .ClearTypeFadeTo({ speed: options.speed, opacity: 0, callback: options.callback });
    };
})(jQuery); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-28T19:56:09.813

对 Paul 来说，除了已接受的答案解决方案之外，创建切换功能很简单。

```
$.fn.ClearTypeToggle = function(options) {
    if ($(this).css('opacity') == 1) {
        $(this).ClearTypeFadeOut(options);
    } else {
        $(this).ClearTypeFadeIn(options);
    }
} 
```

# c# - 将选定的 TreeView 节点滚动到视图中

> ID：457932
> 
> 赞同：25
> 
> 时间：2009-01-19T15:18:22.543
> 
> 标签：c#, winforms, treeview

我有一个`System.Windows.Forms.TreeView`停靠在面板内。我正在设置以编程方式选择的节点。我将使用什么方法或属性让树视图将所选内容滚动到视图中？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-19T15:19:05.537

```
node.EnsureVisible(); 
```

例如：

```
if(treeView.SelectedNode != null) treeView.SelectedNode.EnsureVisible(); 
```

（见[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.treenode.ensurevisible.aspx)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-03-22T21:41:07.210

我对此也有疑问，并发现 treeview.ExpandAll() 忽略了 EnsureVisible() 效果并避免滚动到节点位置。

如果您想要一个完整的扩展树并在您选择的节点上滚动，只需在 ExpandAll() 之后调用 EnsureVisible()。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-04-04T19:08:34.983

要确保所选项目的可见性：

```
private void EnsureItemVisible()
{
    if(treeView1.SelectedNode == null)
    {
        return;
    }

    for (int i = treeView1.SelectedNode.Index + treeView1.VisibleCount / 2; i >= 0; i--)
    {
        if (treeView1.Nodes.Count > i && treeView1.Nodes[i] != null)
        {
            treeView1.Nodes[i].EnsureVisible();
            break;
        }
    }

    for (int i = treeView1.SelectedNode.Index - treeView1.VisibleCount / 2; i < treeView1.Nodes.Count; i++)
    {
        if (i >= 0 && treeView1.Nodes[i] != null)
        {
            treeView1.Nodes[i].EnsureVisible();
            break;
        }
    }
} 
```

处理 TreeView 选择已更改：

```
private void TreeView_AfterSelect(object sender, TreeViewEventArgs e)
{   
    EnsureItemVisible();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-26T09:53:36.253

`node.EnsureVisible()`对于只有一层节点的树，我遇到了一些问题。

要解决此问题，请使用`BindingIndex`标识选定的节点。然后选定的节点将在视图中滚动。

该示例显示`myTable`了一个 LINQ 查询。

```
node.BindingIndex = Convert.ToInt32(mytable.Id); 
```

我希望这对你们中的一些人有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-09-30T18:19:27.140

我发现可靠工作的是：

1.  展开所需节点
2.  通过树的最后一个节点上的 EnsureVisible() 强制滚动到 END
3.  通过该节点上的 EnsureVisible() 滚动回所需节点

这导致所需的节点和展开的子节点被放置在树视图显示区域的顶部。

```
 TVFolders.BeginUpdate();
        TVFolders.Nodes.Clear();
        TreeNode tn = new TreeNode()
        {
            Text = RootFolderPath,
            Name = RootFolderPath
        };
        TVFolders.Nodes.Add(tn);
        //      load the treeview (also tracks the last node added to the tree as lastNode)
        PopulateTreeView(TVFolders.Nodes[0], RootFolderPath, 6, true);
        //      if user/caller has specified a start path, select and expand it
        if (_SelectedPath != null)
        {
            //      find the node corresponding to the requested path
            TreeNode[] tns = TVFolders.Nodes.Find(_SelectedPath, true);
            //      assumes first return is the "best" one
            if (tns.Length > 0)
            {
                //      select the requested node
                TVFolders.SelectedNode = tns[0];
                //      expand to show children
                TVFolders.SelectedNode.Expand();
                //      scroll to the last node on the tree (may push our node off top)
                if (lastNode != null)
                {
                    lastNode.EnsureVisible();
                }
                //      scroll to our node, which will now be at the top of the display area
                TVFolders.SelectedNode.EnsureVisible();
            }
        }
        TVFolders.Visible = true;
        TVFolders.EndUpdate(); 
```

# java - 在java中创建包级关联数组

> ID：457933
> 
> 赞同：4
> 
> 时间：2009-01-19T15:18:25.350
> 
> 标签：java, oracle, jdbc, associative-array

是否可以创建包级 oracle 关联数组的 java 表示。例如，给定以下内容：

```
CREATE OR REPLACE PACKAGE MyPackage AS
    TYPE t_numbers IS TABLE OF NUMBER INDEX BY PLS_INTEGER; 
```

我发现我无法编写以下 java：

```
ArrayDescriptor descriptor =
    ArrayDescriptor.createDescriptor("MyPackage.t_numbers", connection); 
```

（抛出 SQLException “无效的名称模式”）。

引用包级关联数组的 ArrayDescriptor 的正确语法是什么？这样的事情还存在吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T15:59:55.640

请参阅[http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:3696816290928](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:3696816290928)尤其是[http://download.oracle.com/docs/cd/B10501_01/java .920/a96654/oci_func.htm#1017512](http://download.oracle.com/docs/cd/B10501_01/java.920/a96654/oci_func.htm#1017512)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-08-24T18:43:10.047

您还可以使用[OracleConnection.createOracleArray()](https://docs.oracle.com/database/121/JAJDB/oracle/jdbc/OracleConnection.html#createOracleArray_java_lang_String__java_lang_Object_)

注意`arrayTypeName`应该是`table of`类型。

此外，您可能会发现我[对 getArray() 和 writeArray() 的回答](https://stackoverflow.com/a/45867910/197733)很有用。

# asp.net - 通过 Session 传递 LinqDataSource：“Dispose 后访问的 DataContext。”

> ID：457934
> 
> 赞同：0
> 
> 时间：2009-01-19T15:18:34.773
> 
> 标签：asp.net, session, linqdatasource

我需要从数据库中传递一些结果。我没有传递整个数据集或构造的 sql 查询，而是尝试传递 LinqDataSource 配置的对象。

在源页面上，我使用用户在页面上显示的控件（搜索框、组合框等）上设置的值来配置 LinqDataSource 对象属性**Where**和**WhereParameters 。**我传递对象以避免接收器页面上的 LinqDataSource 重新配置。

但是，即使它在我的开发系统上运行良好，在将它部署到专用服务器上后，我收到一条错误消息，提示如下：

> 无法访问已处置的对象。
> 
> 对象名称：“Dispose 后访问的 DataContext。”。

在源页面和接收者页面上，LinqDataSource 对象都声明为：

```
<asp:LinqDataSource ID="myLinqDS" runat="server" 
    ContextTypeName="MyProject.MyDBNamedpace.MyDataContext" 
    TableName="TheTable"
    OrderBy="field1, field2"
</asp:LinqDataSource> 
```

要传递数据源对象，我这样做：

```
SetLinqDataSourceWhereAndHisParameters(); //just set Where and WhereParameters
Guid guid = Guid.NewGuid();
Session[guid.ToString()] = myLinqDS;
ScriptManager.RegisterStartupScript(this.Page,
    typeof(Page),
    "Redirect",
    String.Format(@"window.open(""{0}"");",
        this.ResolveClientUrl("~/PageToDisplayTheData.aspx?guid=" +
        System.Web.HttpUtility.UrlEncode(guid.ToString())
    ),
true); 
```

并在 PageToDisplayTheData.aspx 的代码隐藏中检索：

```
myLinqDS =
   (LinqDataSource)Session[System.Web.HttpUtility.UrlDecode(Request.QueryString[guid])];
aDataList.DataSource = myLinqDS;
aDataList.DataBind(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T08:24:24.873

您**不**应该将 DataContext 存储在 Session （或任何地方）中，原因如下：

*   DataContext 不是线程安全的
*   DataContext 被设计为一个工作单元工具

如果您在 DataContext 中查询一个集合，它会在内部缓存，因此当您重新查询它时，您不会往返于数据库。但这可能导致数据停滞，因为这些值不能反映底层数据库的实际状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T15:53:38.790

你的目标是什么？如果您想让应用程序不必返回数据库，那么无论如何您都需要缓存整个数据集。如果您只是想不必重新创建查询，为什么不将查询作为一种方法添加到您的数据上下文中并从那里到处引用它。

```
public partial class MyDataContext
{
    public Table<MyTable> OrderedTable()
    {
         return this.TheTable.OrderBy( t => t.field1 )
                             .ThenBy( t => t.field2 );
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T17:44:26.693

只需将属性从一个对象复制到另一个对象即可：

```
LinqDataSource received=
(LinqDataSource)Session[System.Web.HttpUtility.UrlDecode(Request.QueryString[guid])];

myLinqDS.Where = received.Where;
foreach (Parameter p in received.WhereParameters)
    myLinqDS.WhereParameters.Add(p); 
```

但我仍然不知道为什么它可以在 VS2008 内部 Web 服务器上运行，但不能在运行 IIS 的主服务器上运行。

# visual-studio - XML 注释：使用还是不使用？

> ID：457936
> 
> 赞同：2
> 
> 时间：2009-01-19T15:18:41.433
> 
> 标签：visual-studio, xml-comments

我的同事在开发我们的软件时很少（如果有的话）使用 XML 注释（我不能说我更好）。我最近看到了使用它们的好处，但是如果它们记录的代码写得很清楚（表达/描述性变量/函数名称，一些内联注释），它们真的值得吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-19T15:24:38.270

XML 注释对于生成文档很有用。如果代码写得很清楚，那么您不需要注释来帮助您理解代码。

然而，文档注释对类的用户很有用，因为它（应该）包含对类或方法功能的描述，而不是对代码的描述。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-01T21:28:39.117

我认为代码注释非常重要，尤其是在面向公众的方法和属性方面。当人们说他们的代码是描述性的时，他们可能是善意的，也许确实如此，但想想看这个的新人：

```
Linker.Extract(IpoValidator validator, MeanDexIndicator Indicator) 
```

除非他了解该方法的上下文，否则他可能无法弄清楚其目的。人们似乎对评论的主要问题是他们不是很有帮助。这是因为人们写了不好的评论。你应该谈论正在发生的事情而不是它是什么。我可以看到该方法是一种提取方法，因此评论如下：

```
 <Summary>Extracts The Fumble <\Summary> 
```

是浪费能源。以下是更好的：

```
 <Summary>
 The Fumble needs to be extracted before the bopper can be used. In order for 
 extraction to work a validator and indicator need to be provided. Once extracted 
 the bopper is available in the property Linker.Bopper. On fail this 
 method will raise the CrappedOutException.
 </Summary> 
```

看到不同？

我倾向于只使用摘要参数和返回，因为它们都以智能感知显示，其他所有内容都像评论一样，并且可能会浪费时间，因为它们并不总是显示出来。

至于在更改某些内容后拒绝更新评论的人。代码审查应该抓住这一点。就我个人而言，我对私有方法和道具两个使用 xml 注释，但那一个是个人选择。关于面向公众的方法和属性？我是非可选的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:27:09.873

XML 注释对 API 非常有用，即使是在小组中使用的 API。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T15:27:21.073

我们发现它很有用，因为 vs 会自动检查以确保某些评论存在。此外，任何新进入组织并使用过 vs 的人都知道注释是如何工作的，我们不必解释新的注释代码系统。有时我们会从中生成文档，但实际上使用它更容易，因为它为您填写了许多内容（如一些参数标签等）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T15:41:41.513

就内部代码和评论而言，这是[Jeffery Palermo](http://jeffreypalermo.com/)[的一篇文章](http://jeffreypalermo.com/blog/limiting-code-comments-increases-maintainability/)，我刚刚阅读并同意。

总结：大量评论只会降低可读性，帮助不大，好的评论可能非常有用，但会增加维护软件的成本，甚至在不维护时会导致重大问题并提供虚假信息。精心设计和命名的代码是无可替代的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-19T16:36:34.630

是否存在在功能上被忽略但可以由某些 XSLT 处理以直接转换为文档的注释标记？注释很好（我使用它们），但我认为注释标签的价值和它的直接转换可以胜过将注释用作文档。因此，总而言之，使用注释标签作为其他人阅读的文档，使用注释作为自己的注释或“幕后”的东西（即，“天哪，在世界爆炸之前解决这个问题！”）

# scheme - 将整数转换为列表？

> ID：457951
> 
> 赞同：1
> 
> 时间：2009-01-19T15:22:56.417
> 
> 标签：scheme

我目前正在尝试将整数转换为列表。

例如

1234 => 由 1、2、3、4 组成的列表

我有这个：

```
(string->list (number->string 1234)) 
```

不幸的是，它添加了#'s 和\'s。我猜这是一个数字的字符串表示。我怎样才能删除这些符号。因为我需要重新排序整数，并打印出一个列表。

这是上面命令的输出：

(#\1 #\2 #\3 #\4)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-19T15:31:31.237

这是我编写的一个函数，它通过每次除以 10 来分解数字：

```
(define (num->list num)
  (if (< num 10)
      (list num)
      (append (num->list (floor (/ num 10)))
              (list (- num (* 10 (floor (/ num 10)))))))) 
```

显然，这只适用于正整数，但如果你需要负数，它可以很容易地修改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T20:33:33.653

正如乔纳森所说，#\ 表示它是一个字符。所以你必须将字符转换为数字。这是一个简单的方法。

```
(map (lambda (c) (- (char->integer c) 48))
         (string->list (number->string 1234))) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:40:37.740

我不熟悉方案，但一种稍微更密集的代码、独立于语言的方法是使用数学循环来获取每个数字。

如果 1234 是 x： digit_1 = x%10 digit_2 = x%100 - digit_1 digit_3 = x%1000 - digit_2 - digit_1 等。

您需要在每个站点添加一个检查，如果 x < 1000，则在数字 3 之后停止。根据语言，您可以通过各种方式为此添加一个循环。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-19T20:13:38.077

当您将字符串转换为列表时，您正在构建一个字符列表，这就是您得到 # 的原因。#\ 是字符分隔符。因此，当您完成列表操作后，您可以相当轻松地将其重新转换回字符串。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-02-11T15:32:17.980

我只是帮你注意：

```
(floor (/ num 10)) 
```

与在方案中使用商程序相同：

```
(quotient num) 
```

这是它的例子：

```
Welcome to DrRacket, version 6.1.1 [3m].
Language: Pretty Big; memory limit: 128 MB.

> (floor (/ 235 10))
23
> (quotient 235 10)
23 
```

这样我们可以重写@Kyle 函数将如下所示：

```
(define (numberToList number)
   (if (< number 10) (list number)
       (append (numberToList (quotient number 10))
               (list (- number (* 10 (quotient number 10))))))) 
```

# model-view-controller - 网络理论和MVC

> ID：457961
> 
> 赞同：3
> 
> 时间：2009-01-19T15:25:50.733
> 
> 标签：model-view-controller, networking, theory, complexity-theory

我设计了一个不允许视图（表单）之间通信的 MVC。如果一个表单需要与另一个表单通信，它会在控制器上引发一个事件，其他表单可以订阅该事件。总体思路是将通信路径保持在最低限度，有助于降低复杂性。每个 View 都与 RootController 通信，RootController 是一个单例，或者是一个子控制器，View 通过 RootController 访问它。同样，它使通信路径保持向下，因为一切都通过 RootController。

这是否遵循一般网络理论，其中添加到网络的节点越多，网络就越复杂。“并且”，这些节点中的每一个直接通信越多，引入网络的复杂性就越大。谁能指出这个领域/理论到底叫什么？参考？

我对 MVC 所做的事情是否类似于让网络上的所有节点都通过一个中央节点相互通信？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T15:39:41.297

我认为您可能想查找图论（这是网络拓扑的基础）。

而且您的解决方案听起来确实类似于让一切都通过网络中的中央节点进行通信。这是一个简单的好模式（每个新节点只需要一个连接来连接到所有东西）但不利于可伸缩性，因为您将达到 RootController 正在做的工作量巨大的地步。每个新节点都会让您更接近中心节点的主要性能瓶颈。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T15:38:19.927

实际上，这听起来像是[中介](http://en.wikipedia.org/wiki/Mediator_pattern)模式……所有的通信都是通过一个中央集线器发生的……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T15:35:00.387

听起来像一个基本的[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T16:45:00.120

好吧，如果你有一个完整的图（其中一个给定的节点直接连接到每个其他节点），那么它将是 n(n-1)/2 条边和 O(n^2)...这就是你重新寻找？

对于轮辐式，您正在查看 n-1 条边和 O(n) 复杂度。

然而，在我从事的许多 Rails 应用程序中，允许视图调用其他视图从来没有（我记得）引起很多问题......如果没有它，实际上很难处理整个“部分”事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T15:43:40.993

我不确定网络/图论在这里是否真的有用。所有“路径”的长度都是 1。显然，您拥有的表单越多以及这些表单之间的交互越多，您的应用程序就越复杂。如果您正在为您的应用程序建模，我认为您最好查看[消息传递](http://en.wikipedia.org/wiki/Message_passing)，而不是图论。

# xml - 使用 LINQ to XML 将 HTML 标记保留在 XML 中

> ID：457970
> 
> 赞同：5
> 
> 时间：2009-01-19T15:27:55.737
> 
> 标签：xml, linq, linq-to-xml

我有一个 xml 文件，我使用 LINQ to XML 从中提取 html。这是文件的示例：

```
<?xml version="1.0" encoding="utf-8" ?>
<tips>
    <tip id="0">
    This is the first tip.
</tip>
<tip id="1">
    Use <b>Windows Live Writer</b> or <b>Microsoft Word 2007</b> to create and publish content.
</tip>
<tip id="2">
    Enter a <b>url</b> into the box to automatically screenshot and index useful webpages.
</tip>
<tip id="3">
    Invite your <b>colleagues</b> to the site by entering their email addresses.  You can then share the content with them!
</tip>
</tips> 
```

我正在使用以下查询从文件中提取“提示”：

```
Tip tip = (from t in tipsXml.Descendants("tip")
                   where t.Attribute("id").Value == nextTipId.ToString()
                   select new Tip()
                   {
                     TipText= t.Value,
                     TipId = nextTipId
                   }).First(); 
```

我遇到的问题是 Html 元素被剥离了。我希望使用像 InnerHtml 这样的东西来代替 Value，但这似乎并不存在。

有任何想法吗？

提前谢谢大家，

戴夫

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-19T15:36:08.293

调用`t.ToString()`而不是`Value`. 这会将 XML 作为字符串返回。您可能希望使用采用 SaveOptions 的重载来禁用格式化。我现在不能检查，但我怀疑它会包含元素标签（和元素），所以你需要把它去掉。

请注意，如果您的 HTML 不是有效的 XML，您最终会得到一个无效的整体 XML 文件。

XML 文件的格式是否完全不受您的控制？对内部的任何 HTML 进行 XML 编码会更好。

编辑：避免获取外部部分的一种方法可能是做这样的事情（当然，在从您的查询中调用的单独方法中）：

```
StringBuilder builder = new StringBuilder();
foreach (XNode node in element.Nodes())
{
    builder.Append(node.ToString());
} 
```

这样，您将获得带有后代和散布文本节点的 HTML 元素。基本上它相当于 InnerXml，我强烈怀疑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-24T09:43:23.387

只需用于`string.Concat(tip.Nodes())` 获取带有 html 标签的内容

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T15:51:51.290

> TipText=t.Value,

[XElement.value](http://msdn.microsoft.com/en-us/library/system.xml.linq.xelement.value.aspx)仅返回直接位于元素内部的文本。嵌套元素中的文本 - HTML 或其他 - 将不包括在内，当然任何 &-entity-references 都将以解码后的形式出现。

如果您希望内容作为带有标记的字符串，您可以调用 XElement.ToString()，可能使用 SaveOptions.DisableFormatting。但请注意，这包括包装 <tip> 元素 - 也就是说，在 Web 浏览器 DOM 术语中，它是 outerHTML 而不是 innerHTML。要获得 innerHTML，您必须将子 XElement.Nodes 的所有 ToString() 连接在一起。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-25T15:38:31.420

只需使用：

```
string.Concat(element.Nodes()) 
```

获取带有*HTML*标签的内容。

# c# - 如何测试与 C# 的串行/超级终端集成？

> ID：457971
> 
> 赞同：2
> 
> 时间：2009-01-19T15:28:21.117
> 
> 标签：c#, .net, serial-port, hyperterminal

我必须为 USB 秤开发软件，当您按下它上的按钮时，它会通过 USB 发送串行通信。我可以在超级终端中看到这些值。

我将使用 .NET 类进行串行通信来捕获数据。

问题是，我没有秤。秤连接到我可以 RDP 进入的远程计算机。当我想测试时，我可以要求客户按下秤上的按钮。

我不能要求客户每天按下按钮 100 次，我需要有一种方法来开发，对秤会报告的内容有一个相当好的想法，并且只有在我认为我有解决方案时才进行测试。

我正在本地寻找可以模仿比例并发送到我的 .NET Serial 类的东西，与比例相同的输出。理想情况下，如果我可以记录秤的数据，然后在另一台机器上播放，那就完美了。

我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T15:31:41.563

1）抽象出你的通信代码。在测试模式下，从数据文件流而不是串行流中提供逻辑函数。

或者

2）如果您有 2 个串行端口（或两个 pc），则设置一个通过一个端口进行对话的规模仿真器应用程序，并将其插入运行软件的另一个端口。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T15:43:14.660

如果您采用串行端口仿真路线，请查看[com0com](http://com0com.sourceforge.net/)。我一直用它来伪造与实验室仪器的通信，而且效果很好。当您的笔记本电脑缺少串行端口时非常有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-19T15:40:28.020

你有两个问题：

1.  测试您的 .NET Serial 类以验证它们可以通过串行端口处理接收数据（任何数据）
2.  测试您的应用程序以验证它可以处理您从秤获得的特定类型的数据

您可以通过将任何可以生成数据的东西（例如另一台带有超级终端的 PC）连接到您 PC 的本地串行端口来测试 1.。

您可以通过（出于测试目的）将您的串行类替换为充当“串行类+比例”组合的“模拟对象”的软件（即，使用您的串行类将使用的 API 输入您的程序）来测试 2.使用，您希望从秤收到的数据）。

您还可以通过以下方式测试 1 和 2：

*   编写一个程序，通过发送秤将发送的数据类型来伪装成秤
*   **运行此程序以从**串行端口发送数据
*   使用**空调制解调器**连接两个串行端口背靠背（以便从一个端口发送的数据被另一个端口接收到您的软件中）。

# validation - Unix 文件名中应限制哪些字符？

> ID：457994
> 
> 赞同：73
> 
> 时间：2009-01-19T15:34:01.700
> 
> 标签：validation, unix, file

考虑一个带有自由文本条目的“**另存为”对话框，用户在其中输入文件名作为自由文本，然后单击“****保存**”按钮。软件然后验证文件名，如果名称有效，则保存文件。

在 Unix 文件系统上，应在验证中应用哪些规则：

*   在转义特殊字符等方面，名称稍后将不难操作。
*   规则没有那么严格，以至于保存文件变得对用户不友好。

所以基本上，应该从 Unix 文件名限制的*最小字符集是什么？*

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-01-19T15:37:25.187

*最小值*为斜杠( '/') 和 NULL ('\0')

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-01-19T15:36:35.580

首先，您所描述的是[黑名单](http://en.wikipedia.org/wiki/Blacklist)。您更好的选择是将您的字符[列入白名单](http://en.wikipedia.org/wiki/Whitelist)，因为（从用户的角度）插入字符比删除字符更容易。

就unix环境中的好处而言：

*   阿兹
*   AZ
*   0-9
*   下划线 ( `_`)
*   破折号 ( `-`)
*   期间 ( `.`)

应该涵盖你的基础知识。空间可以是好的，但会让事情变得困难。Windows 用户喜欢它们，unix/linux 不喜欢。因此，根据您的目标受众进行相应选择。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2015-12-10T04:17:36.123

虽然接受的答案可能是事实，但我认为有一些限制可能会对脚本或其他东西造成烦扰是有好处的：

*   正斜杠 (/)
*   反斜杠 (\)
*   空 (\0)
*   勾选 (`)
*   以破折号 (-) 开头
*   星星 （*）
*   管道 (|)
*   分号 (;)
*   引号（" 或 '）
*   冒号 （：）

（ - 也许空间，虽然我不愿意添加。）

正如您所看到的，您最好按照@Gavin 的建议将白名单列入白名单...

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-01-19T16:49:39.597

经常被遗忘：冒号 (:) 不是一个好主意，因为它通常用于 $PATH 之类的东西，即“自动”找到可执行文件的目录列表。这可能会导致与 DOS/Windows 目录名称混淆，当然冒号用于驱动器名称。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-01-19T15:49:02.573

不要忘记您可以`.`在开头添加一个点 ( ) 来隐藏文件和文件夹...否则，我会遵循 *NIX 名称约定（来自 Wikipedia）：

大多数 UNIX 文件系统

*   案例处理：区分大小写
*   允许的字符集：任何。
*   保留字符：`/`, `null`.
*   最大长度：255。
*   注释：前导 . 表示 ls 和文件管理器默认不会显示文件

[链接到有关文件名的维基百科文章](http://en.wikipedia.org/wiki/Filename)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2017-04-26T09:05:05.990

# 编码 FTW

正如[Bombe](https://stackoverflow.com/users/43582/bombe)在他们的回答中指出的那样，限制用户输入至少是令人沮丧的，如果不是非常烦人的话。不过，作为开发人员，我们应该假设与我们代码的每次交互都是恶意的，并将它们视为恶意。

为了在实际应用中解决这两个问题，而不是将某些字符列入白名单或黑名单，我们不应该使用用户输入作为文件名。

相反，使用`[a-f0-9]`我们自己设计的安全名称（十六进制字符仅用于最终安全），或者从用户输入**编码（例如**[PHP 的 bin2hex](http://php.net/manual/en/function.bin2hex.php)），或者随机生成的 ID（例如[PHP 的 uniqid](http://php.net/manual/en/function.uniqid.php)），然后通过某种方法映射（采取你的选择）到用户输入。

编码/解码可以在不依赖映射的情况下即时完成，因此非常理想。用户永远不需要知道文件的*真正*名称；只要他们可以获取/设置文件，并且它*似乎*被称为他们想要的，每个人都是赢家。

通过这种方法，用户可以随心所欲地调用他们的文件，黑客将是唯一受挫的*人*，您的文件系统会爱上您:-)

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-01-19T15:38:57.383

让用户输入他想要的任何名称。人为地限制字符范围只会惹恼用户，并没有真正的目的。**********