# StackOverflow 问答 000164000-000164999

# c++ - 为什么 fread 提前到达 EOF？

> ID：164002
> 
> 赞同：30
> 
> 时间：2008-10-02T19:02:22.383
> 
> 标签：c++, c, file-io, stdio, feof

我正在编写一个将文件读入内存的 C 库。它跳过文件的前 54 个字节（标题），然后将其余部分作为数据读取。我使用 fseek 确定文件的长度，然后使用 fread 读取文件。

循环运行一次然后结束，因为到达 EOF（没有错误）。最后，bytesRead = 10624，ftell(stream) = 28726，缓冲区包含 28726 个值。我希望 fread 在到达 EOF 时读取 30,000 个字节并且文件位置为 30054。

C 不是我的母语，所以我怀疑我在某个地方遇到了一个愚蠢的初学者错误。

代码如下：

```
const size_t headerLen = 54;

FILE * stream;
errno_t ferrno = fopen_s( &stream, filename.c_str(), "r" );
if(ferrno!=0) {
  return -1;
}

fseek( stream, 0L, SEEK_END );
size_t bytesTotal = (size_t)(ftell( stream )) - headerLen; //number of data bytes to read
size_t bytesRead = 0;
BYTE* localBuffer = new BYTE[bytesTotal];
fseek(stream,headerLen,SEEK_SET);
while(!feof(stream) && !ferror(stream)) {
    size_t result = fread(localBuffer+bytesRead,sizeof(BYTE),bytesTotal-bytesRead,stream);
    bytesRead+=result;
} 
```

* * *

根据您使用的参考，很明显在模式标志中添加“b”就是答案。为白痴徽章寻求提名。:-)

[该参考文献](http://www.cplusplus.com/reference/clibrary/cstdio/fopen.html)在第二段第二句中谈到了它（尽管不在他们的表格中）。

[MSDN](http://msdn.microsoft.com/en-us/library/z5hh6ee9(VS.80).aspx)直到页面的一半才讨论二进制标志。

[OpenGroup](http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html)提到了“b”标签的存在，但表示它“没有任何作用”。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-10-02T19:04:41.193

也许这是一个二进制模式问题。尝试使用`"r+b"`as 模式打开文件。

**编辑**：如评论`"rb"`中所述，可能更符合您的原始意图，因为`"r+b"`它将打开它以进行读/写并且`"rb"`是只读的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T20:00:01.450

还值得注意的是，简单地将 binmode.obj 包含到您的链接命令中将为您完成所有文件打开的操作。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2014-06-26T13:05:07.397

基于先前答案的解决方案：

```
 size_t bytesRead = 0;
    BYTE* localBuffer = new BYTE[bytesTotal];
    fseek(stream,headerLen,SEEK_SET);
        while(!feof(stream) && !ferror(stream)) {
        size_t result = fread(localBuffer+bytesRead,sizeof(BYTE),bytesTotal-
        bytesRead,stream);
    bytesRead+=result;
} 
```

# sql-server - Sql Server 2005 连接限制

> ID：164008
> 
> 赞同：1
> 
> 时间：2008-10-02T19:03:40.180
> 
> 标签：sql-server, sql-server-2005

Sql Server 2005 Developers Edition 是否有连接限制。我们有很多线程在抓取连接，我知道 ADO.NET 会进行连接池，但我得到了 OutOfMemory 异常。我们取出数据库连接，它工作正常。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T19:07:06.897

这是 Euan Garden（Visual Studio Team Edition 的项目经理）博客上对这个问题的回答：

*DE 在内存、数据库大小或 procs 方面没有限制，它本质上是企业版。然而，有一个许可限制阻止它在生产中使用。*

因此，您可能只需要确保正确关闭连接对象。**using**块将非常适合这样的工作......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T19:06:14.840

您可能没有正确关闭或处置您的连接对象。确保您的代码看起来像这样：

```
using (SqlConnection conn = new SqlConnection("connectionstring"))
{
    conn.Open();

    // database access code goes here
} 
```

using 块将自动关闭并处理您的连接对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:29:16.983

32767 企业版

<ServerProductVersion>9.00.3235.00</ServerProductVersion>
<ServerProductLevel>SP2</ServerProductLevel>
<ServerEdition>企业版</ServerEdition>
<ServerEngineEdition>3</ServerEngineEdition>

我如何检查...

CREATE FUNCTION [dbo].svfV1GetSessionAndServerEnvironmentMetaData 返回 xml 作为开始

```
-- Declare the return variable here
DECLARE @ResultVar xml

-- Add the T-SQL statements to compute the return value here
SET @ResultVar =
    (
        SELECT  
            @@SPID                                          as  SPID,
            @@ProcID                                        as  ProcId,
            @@DBTS                                          as  DBTS,
            getdate()                                       as  DateTimeStamp,
            System_User                                     as  SystemUser,
            Current_User                                    as  CurrentUser,
            Session_User                                    as  SessionUser,
            User_Name()                                     as  UserName,
            Permissions()                                   as  UserSessionPermissionsBitmap,
            Host_Id()                                       as  HostId,
            Host_Name()                                     as  HostName,
            App_Name()                                      as  AppName,

            ServerProperty('ProcessId')                     as  ServerProcessId,
            ServerProperty('MachineName')                   as  ServerMachineName,
            ServerProperty('ServerName')                    as  ServerServerName,
            ServerProperty('ComputerNamePhysicalNetBIOS')   as  ServerComputerNamePhysicalNetBIOS,
            ServerProperty('InstanceName')                  as  ServerInstanceName,
            ServerProperty('ProductVersion')                as  ServerProductVersion,
            ServerProperty('ProductLevel')                  as  ServerProductLevel,

            @@CONNECTIONS                                   as  CumulativeSqlConnectionsSinceStartup,
            @@TOTAL_ERRORS                                  as  CumulativeDiskWriteErrorsSinceStartup,
            @@PACKET_ERRORS                                 as  CumulativeNetworkPacketErrorsSinceStartup,

            --Note:  
            --If the time returned in @@CPU_BUSY, or @@IO_BUSY exceeds approximately 49 days of cumulative CPU time, 
            --you receive an arithmetic overflow warning. In that case, 
            --the value of @@CPU_BUSY, @@IO_BUSY and @@IDLE variables are not accurate. 
        --  @@CPU_BUSY * @@TIMETICKS                        as  CumulativeMicroSecondsServerCpuBusyTimeSinceStartup,
        --  @@IO_BUSY * @@TIMETICKS                         as  CumulativeMicroSecondsServerIoBusyTimeSinceStartup,
        --  @@IDLE * @@TIMETICKS                            as  CumulativeMicroSecondsServerIdleTimeSinceStartup,

            ServerProperty('BuildClrVersion')               as  ServerBuildClrVersion,
            ServerProperty('Collation')                     as  ServerCollation,
            ServerProperty('CollationID')                   as  ServerCollationId,
            ServerProperty('ComparisonStyle')               as  ServerComparisonStyle,
            ServerProperty('Edition')                       as  ServerEdition,
            ServerProperty('EditionID')                     as  ServerEditionID,
            ServerProperty('EngineEdition')                 as  ServerEngineEdition,
            ServerProperty('IsClustered')                   as  ServerIsClustered,
            ServerProperty('IsFullTextInstalled')           as  ServerIsFullTextInstalled,
            ServerProperty('IsIntegratedSecurityOnly')      as  ServerIsIntegratedSecurityOnly,
            ServerProperty('IsSingleUser')                  as  ServerIsSingleUser,
            ServerProperty('LCID')                          as  ServerLCID,
            ServerProperty('LicenseType')                   as  ServerLicenseType,
            ServerProperty('NumLicenses')                   as  ServerNumLicenses,
            ServerProperty('ResourceLastUpdateDateTime')    as  ServerResourceLastUpdateDateTime,
            ServerProperty('ResourceVersion')               as  ServerResourceVersion,
            ServerProperty('SqlCharSet')                    as  ServerSqlCharSet,
            ServerProperty('SqlCharSetName')                as  ServerSqlCharSetName,
            ServerProperty('SqlSortOrder')                  as  ServerSqlSortOrder,
            ServerProperty('SqlSortOrderName')              as  ServerSqlSortOrderName,

            @@MAX_CONNECTIONS                               as  MaxAllowedConcurrentSqlConnections,

            SessionProperty('ANSI_NULLS')                   as  SessionANSI_NULLS,
            SessionProperty('ANSI_PADDING')                 as  SessionANSI_PADDING,
            SessionProperty('ANSI_WARNINGS')                as  SessionANSI_WARNINGS,
            SessionProperty('ARITHABORT')                   as  SessionARITHABORT,
            SessionProperty('CONCAT_NULL_YIELDS_NULL')      as  SessionCONCAT_NULL_YIELDS_NULL,
            SessionProperty('NUMERIC_ROUNDABORT')           as  SessionNUMERIC_ROUNDABORT,
            SessionProperty('QUOTED_IDENTIFIER')            as  SessionQUOTED_IDENTIFIER
        FOR XML PATH('SequenceIdEnvironment')
    )   
-- Return the result of the function 
```

## 返回@ResultVar

结尾

在我的 SQL Server 数据库引擎实例上返回

<SequenceIdEnvironment>
  <SPID>56</SPID>
  <ProcId>1666821000</ProcId>
  <DBTS>AAAAAAAAB9A=</DBTS>
  <DateTimeStamp>2008-10-02T15:09:26.560</DateTimeStamp> ...
  <CurrentUser> dbo</CurrentUser>
  <SessionUser>dbo</SessionUser>
  <UserName>dbo</UserName>
  <UserSessionPermissionsBitmap>67044350</UserSessionPermissionsBitmap>
  <HostId>3852 </HostId> ...
  <AppName>Microsoft SQL Server Management Studio - 查询</AppName>
  <ServerProcessId>508</ServerProcessId> ...
  <ServerProductVersion>9.00.3235.00</ServerProductVersion>
  <ServerProductLevel>SP2</ServerProductLevel>
  <CumulativeSqlConnectionsSinceStartup> 169394 </ CumulativeSqlConnectionsSinceStartup>
  <CumulativeDiskWriteErrorsSinceStartup> 0 </ CumulativeDiskWriteErrorsSinceStartup>
  <CumulativeNetworkPacketErrorsSinceStartup> 0 </ CumulativeNetworkPacketErrorsSinceStartup>
  <ServerBuildClrVersion> V2.0.50727 </ ServerBuildClrVersion>
  <ServerCollation> SQL_Latin1_General_CP1_CI_AS </ ServerCollation>
  <ServerCollationId> 872468488 </ ServerCollationId>
  <ServerComparisonStyle>196609</ServerComparisonStyle>
  <ServerEdition>企业版</ServerEdition> ...
  <ServerEngineEdition>3</ServerEngineEdition>
  <ServerIsClustered> 0</ServerIsClustered>
  <ServerIsFullTextInstalled>1</ServerIsFullTextInstalled>
  <ServerIsIntegratedSecurityOnly>0</ServerIsIntegratedSecurityOnly>
  <ServerIsSingleUser>0</ServerIsSingleUser> ...
  <ServerResourceLastUpdateDateTime>2008-03-12T18:59:08.633</ServerResourceLastUpdateDateTime>
  <ServerResourceVersion>9.00.3235< /ServerResourceVersion>
  <ServerSqlCharSet>1</ServerSqlCharSet>
  <ServerSqlCharSetName>iso_1</ServerSqlCharSetName>
  <ServerSqlSortOrder>52</ServerSqlSortOrder>
  <ServerSqlSortOrderName>nocase_iso</ServerSqlSortOrderName> **
  <MaxAllowedConcurrentSqlConnections>32767< /MaxAllowedConcurrentSqlConnections> **
  <SessionANSI_NULLS>1</SessionANSI_NULLS>
  <SessionANSI_PADDING>1</SessionANSI_PADDING>
  <SessionANSI_WARNINGS>1</SessionANSI_WARNINGS>
  <SessionARITHABORT>1</SessionARITHABORT>
  <SessionCONCAT_NULL_YIELDS_NULL>1</SessionCONCAT_NULL_YIELDS_NULL>
  <SessionNUMERIC_ROUNDABORT>0</SessionNUMERIC_ROUNDABORT>
  <SessionQUOTED_IDENTIFIER>1</SessionQUOTED_IDENTIFIER>1</SessionQUOTED_IDENTIFIER
>序列Id环境>

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T19:06:52.793

.NET 是否存在内存不足异常？如果错误出现在服务器上，您可能会看到连接被拒绝消息。

# c++ - 读取一些整数，然后在 C++ 中读取一行文本

> ID：164022
> 
> 赞同：1
> 
> 时间：2008-10-02T19:07:17.020
> 
> 标签：c++, string, input, newline, iostream

我正在读取 C++ 程序中的输入。首先是一些整数，然后是一个字符串。当我尝试使用 读取字符串时`getline(cin,stringname);`，它不会读取用户键入的行：相反，我得到一个空行，从用户`Enter`在键入整数后按下时开始。

```
cin>>track.day; //Int
cin>>track.seriesday; //Int
getline(cin,track.comment); //String 
```

如何清除`cin`(`cin.clear()`不起作用) 以使字符串不会用“enter”键填充自己？

这是一个正常的输入接收，代码顶部没有什么特别的，我遇到了这样的问题，但我忘记了我需要清除的解决方案，`cin`这样字符串就不会被“enter”键填充。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T19:22:49.197

我认为您的整数 cin 不是在句子前阅读新行。cin 在遇到非数字（包括空格）时跳过前导空格并停止读取数字。

所以：

```
std::cin >> num1;
std::cin >> num2;
std::cin.ignore(INT_MAX, '\n'); // ignore the new line which follows num2
std::getline(std::cin, sentence); 
```

可能对你有用

# c# - 哪些准则适用于确定何时将类成员实现为属性与方法？

> ID：164023
> 
> 赞同：5
> 
> 时间：2008-10-02T19:07:30.250
> 
> 标签：c#, .net

SubMain的[.NET 编码标准 PDF](http://submain.com/landing/codeit.right/?utm_campaign=codeit.right&utm_medium=textad&utm_source=stackoverflow)已开始出现在“赞助者”区域中，似乎表明属性仅适用于逻辑数据成员（请参阅文档的第 34-35 页）。在以下情况下，方法被认为是合适的：

*   该操作是一种转换，例如 Object.ToString()。
*   该操作非常昂贵，以至于您希望与用户交流他们应该考虑缓存结果。
*   使用 get 访问器获取属性值会产生可观察到的副作用。
*   连续调用该成员两次会产生不同的结果。
*   执行顺序很重要。
*   该成员是静态的，但返回一个可以更改的值。
*   该成员返回一个数组。

大多数开发人员是否同意上面的属性与方法论点？如果是这样，为什么？如果不是，为什么不呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T19:31:47.197

它们看起来很合理，并且基本上符合 MSDN 成员设计指南：

[http://msdn.microsoft.com/en-us/library/ms229059.aspx](http://msdn.microsoft.com/en-us/library/ms229059.aspx)

人们有时似乎忘记的一点 (*) 是调用者应该能够以任何顺序设置属性。对于支持设计器的类尤其重要，因为您不能确定生成的代码将设置属性的顺序。

(*) 我记得 Codeplex 上的 Ajax 控制工具包的早期版本有很多错误，因为开发人员忘记了这个错误。

至于“连续两次调用成员会产生不同的结果”，每个规则都有一个例外，如属性 DateTime.Now 所示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T19:13:43.137

这些是有趣的指导方针，我同意它们。有趣的是，他们正在根据“除以下之外的一切都是属性”来设置规则。也就是说，它们是通过将某些东西定义为以后可能导致问题的属性来避免问题的良好指南。

归根结底，属性只是一种结构化方法，因此我使用的经验法则是基于面向对象的——如果成员代表实体拥有的数据，则应将其定义为属性；如果它代表实体的行为，它应该作为一种方法来实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T19:18:50.067

完全同意。

根据编码指南，属性是“名词”，方法是“动词”。请记住，用户可能会经常调用该属性，同时认为这将是一种“廉价”操作。

另一方面，通常期望方法可能“花费更多时间”，因此用户考虑缓存方法结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T19:41:58.607

这些指南的有趣之处在于，它们显然是具有扩展属性和扩展方法的论据。耻辱。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T21:49:10.250

我个人从未得出结论或直觉认为属性很快，但指导方针说它们应该是，所以我只是接受它。

在避免 FxCop 警告的同时，我总是在为我缓慢的“get”方法命名而苦苦挣扎。GetPeopleList() 对我来说听起来不错，但 FxCop 告诉我它作为一个属性可能会更好。

# c++ - 在 Win32 上，如何将线程移动到另一个 CPU 内核？

> ID：164026
> 
> 赞同：7
> 
> 时间：2008-10-02T19:07:51.170
> 
> 标签：c++, c, multithreading, winapi, multicore

我想确保线程被移动到特定的 CPU 核心，并且调度程序永远不能从它移动。

有`SetThreadAffinityMask()`电话，但没有`GetThreadAffinityMask()`。

我需要这个的原因是，如果调度程序将该线程移动到另一个 CPU，高分辨率计时器会变得混乱。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-02T19:09:35.533

您可能应该只使用 SetThreadAffinityMask 并相信它正在工作。

[MSDN](http://msdn.microsoft.com/en-us/library/ms684251.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-03T03:57:31.207

如果您可以调用一个函数，该函数返回一个数字，该数字指示线程正在哪个 CPU 上运行，而不使用关联，那么一旦函数返回，答案通常会是错误的。因此，在以提升的 IRQL 运行的内核代码之外，检查返回的掩码`SetThreadAffinityMask()`与您将获得的一样接近，[甚至这正在发生变化](http://kernelmustard.com/2008/09/30/bad-idea-making-assumptions-about-cpu-number/)。

听起来您正在尝试解决`RDTSC`时钟偏差问题。如果您`RDTSC`直接使用该指令，请考虑`QueryPerformanceCounter()`改为调用：

*   `QueryPerformanceCounter()`如果芯片组支持并且在系统的 ACPI 表中，则在 Windows Vista 上使用[HPET 。](http://en.wikipedia.org/wiki/High_Precision_Event_Timer)
*   [如果您调用 ，使用AMD 处理器驱动程序](http://www.amd.com/us-en/Processors/TechnicalResources/0,,30_182_871_9706,00.html)的基于 AMD 的系统将主要补偿多核时钟偏差`QueryPerformanceCounter()`，但这对于`RDTSC`直接使用的应用程序没有任何作用。[AMD Dual-Core Optimizer](http://www.amd.com/us-en/Processors/TechnicalResources/0,,30_182_871_9706,00.html)是针对直接使用的应用程序的 hack ，`RDTSC`但如果时钟偏差量由于 C1 时钟斜坡（在 C1 电源状态下时钟速度降低）而发生变化，您仍然会有时钟偏差。而且这些实用程序可能不是很普遍，因此使用affinity with`QueryPerformanceCounter()`仍然是一个好主意。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T20:12:31.967

肯说的。但是，如果您不相信它正在工作，您可以再次调用 SetThreadAffinityMask，并确认返回值与您期望的掩码匹配。（但是当然，如​​果你不信任这个函数，那么你就不能信任第二个调用......）

不要被 GetProcessAffinityMask 的存在弄糊涂了。该函数不是用来验证 SetProcessAffinityMask 是否有效，但例如，您可以构造一个线程亲缘关系，它是进程亲缘关系的子集。

只需查看返回值并验证它不是 0 就可以了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T20:21:03.410

不需要 Get *Thread* AffinityMask。只需获取 Get *Process* AffinityMask 的值，关闭一些位，然后调用 SetThreadAffinityMask。线程继承进程的关联掩码，并且由于它们的关联在您的控制之下，您已经知道线程的关联掩码（它是您设置的那个）。

# virtualization - VMWare 服务器与 ESXi - 有什么区别？

> ID：164034
> 
> 赞同：2
> 
> 时间：2008-10-02T19:09:24.707
> 
> 标签：virtualization, vmware-server, esxi

我无法弄清楚这两个程序之间有什么区别。具体来说，我有兴趣在后台运行虚拟服务器，作为守护进程（Linux 主机操作系统）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-02T19:16:08.060

VMware Server 在普通操作系统 Windows 或 Linux 上作为应用程序运行。ESXi 安装它自己的管理程序作为基本操作系统。

如果您问这个问题，那么您可能应该从 VMware Server 开始。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T19:10:50.380

从 VMware 网站来看，Server 是一个托管应用程序，即它在主机操作系统内运行。ESX 在裸机上运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T16:44:34.543

就像这些家伙提到的那样。不过 ESXi 是免费的。不像前面说的那么贵。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2022-01-25T13:50:54.327

VmWare 是允许将服务器存储划分为分区的应用程序。使用 VMware Server，用户可以获得 ESXi 管理程序和 vSphere 平台。而ESXi是ESXserve的高级版本。ESXi，VMware还与2009年发布的服务器虚拟化软件vSphere合作。虚拟机是VMware基础设施旗舰VM软件的继承者。vSphere 是在大型服务器空间上管理和实施虚拟机的完整平台，您可以在[此处查看差异](https://monovm.com/blog/kvm-vs-vmware/)

# c++ - 停靠 CControlBar 派生窗口

> ID：164039
> 
> 赞同：0
> 
> 时间：2008-10-02T19:10:11.287
> 
> 标签：c++, visual-studio, winapi, visual-c++, mfc

如何将 CControlBar 派生窗口停靠在拆分器窗口 (CSplitterWnd) 的中间？我希望在移动分离器时重新定位条。

为了让我更清楚地了解我所追求的，想象一下 Visual Studio 中对话框编辑器中的垂直标尺（仅限 MFC）。每当调整树视图的大小时，它都会重新定位。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T10:15:48.067

阿尔夫，

在 VS 的情况下，没有使用拆分器：资源视图是一个可调整大小的 ControlBar（它看起来和感觉像一个拆分器，但它不是 CSplitterWnd）。其余的是子框架（选项卡式或 MDI。转到工具/选项/环境/常规并选择多个文档来说服自己）。标尺是子框架的一部分（控制栏？）。

在您的情况下，我认为您不想要 3 个窗格拆分器。您需要一个 2 窗格拆分器，并且控制栏应该是您的视图的一部分（它本身不是 CControlBar）。除非您在这种情况下使用 MDI，否则您可以在子框架中将其设置为真正的 ControlBar。

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T23:06:54.177

Serge，对不起，我不是很清楚。拆分器将位于资源视图和标尺栏之间。它看起来像这样：

资源视图 | 垂直尺 | 看法

无论如何，我找到了（现在显而易见的）答案：将主框架分成三个窗口：

```
m_wndSplitter.CreateStatic(this, 1, 3);

m_wndLeftPane.Create(&m_wndSplitter,WS_CHILD|WS_VISIBLE,m_wndSplitter.IdFromRowCol(0, 0));
m_ruler.Create(&m_wndSplitter,WS_CHILD|WS_VISIBLE,m_wndSplitter.IdFromRowCol(0, 1));

m_wndSplitter.CreateView(0, 2, pContext->m_pNewViewClass, CSize(300, 0), pContext);
SetActiveView((CScrollView*)m_wndSplitter.GetDlgItem(m_wndSplitter.IdFromRowCol(0, 2))); 
```

# algorithm - 基本编程/算法概念

> ID：164048
> 
> 赞同：17
> 
> 时间：2008-10-02T19:12:45.947
> 
> 标签：algorithm, language-agnostic, theory

我即将（与其他程序员）在我的高中开始一个编程和算法俱乐部。选择的语言是 C++ - 抱歉，我无法更改。我们可以假设学生在上述主题方面几乎没有经验。

你认为我应该关注的最基本的概念是什么？

我知道教一些对我来说已经很明显的东西并不是一件容易的事。我意识到应该对第一次会议给予极大的关注——不要吓跑学生——因此我问你。

**编辑：**我注意到程序员和初学者之间的主要区别可能是“程序员的思维方式”——我的意思是，将问题概念化为算法。我知道这只是练习的问题，但是您知道任何可以刺激该领域发展的练习/概念/事物吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-02T19:20:14.557

**让编程变得有趣！**

可能要讨论的事情是编程比赛，您的俱乐部可以自己举办或者可以在当地参加。我参加了大学（ACM）级别的编程比赛，我知道他们也有较低级别的比赛。

这类活动真的可以激发一些竞争精神，拉近俱乐部成员的距离。

事情也不一定总是与编程有关。或许建议举办一个局域网聚会，在那里您可以玩游戏、讨论编程等，这也是一个好主意。

***就编程/算法相关的实际主题而言，我建议作为一个小组在这个编程竞赛入门“编程挑战***”中尝试一些编程问题：[亚马逊链接](https://rads.stackoverflow.com/amzn/click/com/0387001638)

他们从相当基本的编程问题开始，然后慢慢发展为需要各种数据结构的问题，例如：

*   堆栈
*   队列
*   字典
*   树木
*   ETC

大多数问题都是用 C++ 给出的。

最终，他们进入更高级的问题，包括图遍历和流行的图算法（[Dijkstra](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)等）、组合问题等。每个问题都很有趣，并且以类似“故事”的小格式给出。但请注意，其中一些非常难！

编辑：在让人们出席您的俱乐部会议时，比萨和苏打水也不会受到伤害。我们的 ACM 俱乐部每次会议（每月一次）都有披萨。尽管我们大多数人仍然会出现，但它是一个很好的破冰船。特别是对于新的俱乐部或会员。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T20:27:08.780

## 打破它

对我来说，编程的独特之处在于需要将**任务分解为计算机足够小的步骤**。这因语言而异，但您可能不得不编写一个“for 循环”才能数到 100，这一事实需要您习惯。

“自上而下”的方法可能有助于这个概念。您首先为您的程序创建一个主函数，例如

```
filterItemsByCriteria();
```

您不知道这将如何工作，因此您将其分解为进一步的步骤：

*（注意：我不懂 C++，所以这只是一个通用示例）*

```
filterItemsByCritera() {
  makeCriteriaList();
  查看项目（）；
  removeNonMatchingItems();
}

```

然后你进一步分解每一个。很快您就可以定义制作标准列表等所需的所有小步骤。当所有小功能都起作用时，大功能就会起作用。

这有点像孩子们玩的游戏，他们一直在问“为什么？” 在您说完所有内容之后，除了您必须不断问“如何？”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:14:53.007

链接列表 - 一个经典的面试问题，并且有充分的理由。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T19:14:58.093

我会尝试使用 C 子集，而不是尝试从 OO 开始。这可以在他们了解一些基础知识后进行介绍。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T20:43:37.583

问候！

我认为您在强制使用特定语言并研究特定主题和课程方面已经*超越*了自己。听起来您（和一些响应者）将“为编程俱乐部提供建议”与“领导编程课程”混淆了. 它们是非常不同的东西。

我会把团队召集在一起，团队应该决定他们到底*想*从俱乐部中得到什么。本质上，为俱乐部制定一份“章程”。然后（并且只有那时）您才能做出决定，例如首选语言/平台、见面的频率、会议上会发生什么等。

事实证明，最好的方法是“调查”，探索不同的语言/平台。或者可能会证明最好的方法是“主题”方法，其中定期更改主题（如读书俱乐部）（本月是指针，下个月是排序，以下是递归等）和然后以各种语言进行示例和讨论。

顺便说一句，我会考虑俱乐部的“语言不可知论”方向。鼓励孩子们探索不同的语言和平台。

祝你好运，伟大的工作！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T19:55:06.750

嗯，这是一个编程俱乐部，所以应该很有趣！所以我会说马上投入一些经验。首先解释什么是 main() 方法，然后让学生编写一个 hello world 程序。逐步改进 hello world 程序，使其具有功能并打印出用户输入。

我想说对于初学者来说不要太快进入算法，让他们先玩 C++。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T20:31:36.553

上面有人提到，“让编程变得有趣”。今天有趣的是，人们不是为了学习而学习。大多数人想要**即时满足**。

使用编程教一些逻辑。这有助于（并且是）解决问题。我脑海中的分类是猜谜游戏。

*   让他们编写一个程序来猜测 0 到 100 之间的数字。
*   让他们做一个黑杰克克隆……我已经基本做到了:-(

制作纸质说明。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T20:38:40.810

1.  解释“煎鸡蛋”的故事。询问听觉他们会做什么来让自己煎鸡蛋。让他们记下他们想到的步骤。可能您会收到少于 5 步的算法。然后向他们解释，如果我们要教计算机煎鸡蛋，应该写下多少步骤。就像是：

> ```
> 1) Go to the Fridge 
> 2) Open the fridge door 
> 3) Search for eggs 
> 4) If there are no eggs - go to the shop to buy eggs ( this is another function ;) ) 
> 5) If there are eggs - calculate how many do you need to fry 
> 6) Close the fridge door 
> 7) e.t.c. :) 
> ```

2.  从 C 的基础——语法语义等开始，同时解释非常基本的算法，如冒泡排序。
3.  在听觉熟悉结构化编程之后（这可能需要几周或几个月，具体取决于您上课的频率），您可以进阶到 C++ 和 OOP。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-02T19:14:52.697

伪代码应该是第一个。

编辑：如果他们是完全的编程初学者，那么我会让前半部分只是关于编程。一旦你达到了谈论算法有意义的程度，那么伪代码就变得非常重要了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T19:18:04.623

Deitel&Deitel 的 C++ 编程中的内容是一个不错的介绍，每章末尾提出的练习都是不错的玩具问题。

基本上，你在谈论： - 控制结构 - 函数 - 数组 - 指针和字符串

您可能想要跟进对 STL 的介绍（“好的，现在我们已经完成了艰难的工作......这是一个更简单的选择”）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T19:19:25.180

首先让他们了解诸如排序之类的问题。这是非常基本的，他们应该能够很快地联系起来。一旦他们看到问题，然后向他们提供解决问题的工具/解决方案。

我记得当我第一次展示合并排序示例时的感受。我可以按照所有步骤进行操作，但我到底是为了什么？然后渴望解决问题，他们会更好地理解工具和解决方案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T19:21:07.393

从一个简单的“hello world”程序开始。这介绍了变量、写入流和程序流等基础知识。

然后从那里添加复杂性（链表、文件 io、获取用户输入等）。

我说从 hello world 开始的原因是因为孩子会很快看到正在运行的程序。这几乎是即时的反馈——因为他们从一开始就编写了一个正在运行的程序。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T19:21:34.507

IMO，[Big-O](http://en.wikipedia.org/wiki/Big_O_notation)是初级程序员学习的比较重要的概念之一。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-02T19:25:13.687

进行调试比赛。提供包含错误的代码示例。进行比赛，看看谁能找到最多或最快。

有一本很棒的书，How Not to Program in C++，你可以从它开始。

你总是从错误中学到最好的东西，而我更喜欢从别人的错误中学习。

它还可以让那些没有经验的人通过看代码来学习，即使代码几乎可以工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-02T19:29:52.287

除了[这个问题](https://stackoverflow.com/questions/26771/rewarding-code-projects-for-complete-beginners)的答案之外，还有一些重要的话题需要讨论。这是一个如何组织课程的示例。

第一课：术语和语法

涵盖的术语：变量、运算符、循环（迭代）、方法、保留字、数据类型、类

涵盖的语法：赋值、操作、if/then/else、for 循环、while 循环、选择、输入/输出

第二课：基本算法构建

涵盖一些简单的算法，涉及一些输入，可能是 for 或 while 循环。

第三课：更高级的算法主题

这适用于递归、矩阵操作和高级数学。您不必涉及太复杂的主题，但要引入足够的复杂性以在实际项目中有用。

最后一课：小组项目

制作一个团队可以参与的项目。

这些不一定是单日课程。您可以将主题分散到多天。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-02T19:45:28.130

感谢您的回复！

你将如何教他们解决实际问题？

我认识一群知道C++语法和一些基本算法的学生，但是他们在解决实际问题时无法应用他们所知道的知识——他们不知道方法，将他们的想法转化为一组的方法严格的步骤。我不谈论动态编程、贪心等“高级”方法，而是谈论基本的算法思维方式。

我认为这只是因为他们正在经历糟糕的学习过程。在其他科学领域——例如数学——它们非常出色。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-02T19:59:00.843

仅仅因为你熟悉算法并不意味着你可以实现它们，仅仅因为你会编程并不意味着你可以实现算法。

从每个主题开始简单（将编程与设计算法分开）。一旦他们掌握了每个概念，就慢慢开始将这两个概念结合在一起。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-02T20:03:18.167

哇。C++ 是最糟糕的语言之一，就你需要的不相关的废话数量而言（我猜 Java 会更糟）。

在样板繁重的环境中教授初学者时，通常从“这是一个简单的 C 程序。我们将讨论文件顶部的所有这些废话是什么，但现在，专注于 ' 之间的行int main(void)' 和 'return' 语句，这是完成所有有用工作的地方”。

一旦你过了这一点，要涵盖的基本概念包括基本数据结构（数组、链表、树和字典）和基本算法（排序、搜索等）。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-02T20:40:00.790

通过教授构建软件的概念，让您的俱乐部学习如何用任何语言实际编程。与其用完购买十几个 Visual Studio 许可证，不如让学生使用编译器、制作系统、源文件、对象和库，以便将他们的 C 代码转换为程序。我觉得这确实是一个开始，实际上使这些孩子能够了解如何在任何平台上制作软件，而无需许多教育机构喜欢依赖的拐杖。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-02T21:25:48.013

至于选择的语言 - 恭喜 - 你会发现 C++ 非常丰富，可以让你想到数学捷径和数百万种方法来让你的代码表现得更好（或实现花哨的模式）。

对于这个问题：当我开始编程时，我总是试图将一个现实生活中的问题分解成几个步骤，然后当我看到它们转换的任务或数据之间的相似性时，我总是试图找到一种更懒惰、更简单、更简单的方法来解决实施它。

当学习模式和真正的算法时，优雅就出现了。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-06T17:18:37.963

汉克：大O？？？你的意思是告诉初学者他们的代码是 O(n^2) 而你的代码是 n log n ??

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-18T00:49:57.317

我可以看到几种不同的方法来解决这个问题：

1) 基本的编程构建块。什么是条件语句，例如 switch 和 if/else？什么是重复语句，例如 for 和 while 循环？我们如何将这些结合起来以使程序成为我们想要的步骤序列？您可以采取一些简单的方法，例如添加杂货账单或将温度或距离从公制转换为英制，反之亦然。什么是基本变量类型，例如字符串、整数或双精度？同样在这里，您可以使用布尔代数来获得高级想法，或者可能教如何以 2 或 16 为基数进行算术运算，有些人可能会觉得这很容易，而另一些人觉得很难。

2）算法上什么是相似的构建块。排序是一个非常简单的话题，可以广泛讨论和分析，以试图找出如何使排序更快，而不是仅仅交换看起来无序的元素，如果你学习了冒泡排序，这是最脑残的方法。

3) 编译和运行时元素。什么是调用栈？什么是堆？如何处理内存以运行程序，例如代码片段和数据片段？我们如何打开和操作文件？什么是编译和链接？什么是make文件？其中一些很简单，但也可以让人大开眼界，看看事情是如何运作的，这可能是俱乐部大部分时间所涵盖的内容。

接下来的两个更具挑战性，但可能很有趣：

4）讨论算法背后的各种想法，例如：1）分而治之，2）动态编程，3）蛮力，4）数据结构的创建，5）将问题简化为已经解决的类似问题，例如斐波那契数是给初级程序员的经典递归问题，以及 6) 如果你在一个硬币面额为 a、b 和 c 的国家，那么“贪婪”的想法就像在一个做出改变的例子中一样。如果您想要一些异国情调的东西，您也可以使用一些图论示例，例如最小权重生成树，或者旅行推销员想要一些易于描述但难以解决的东西。

5) 数学函数。你将如何编程一个阶乘，它是从 1 到 n 的所有数字的乘积？您将如何计算各种算术级数或几何级数的总和？或者从一组 n 中计算 r 个元素的组合或排列的数量？给定一组点，逼近满足此要求的多项式，例如，在称为 x 和 y 的二维平面中，您可以给出 2 个点，如果您已经解决了成对的线性方程组，则让人们找出斜率和 y 截距是多少已经。

6) 可以使用链表和数组实现的列表。哪种情况更适合各种情况？如何实现插入、删除、查找和排序等基本功能？

7) 抽象数据结构。什么是栈和队列？你如何构建和测试类？

8) 指针。这只会导致大量的话题，比如如何分配/取消分配内存，什么是内存泄漏？

这些是我对各种起点的建议。我认为开始讨论可能会导致一些有趣的地方，如果你可以让几个不介意一周又一周地谈论同一主题的人在一起，因为如果你想得到分类，分类可能是一个很好的话题进入事物的细微之处。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-01-21T22:02:43.207

你们可以从“[从头开始的 C++ 标准库](https://rads.stackoverflow.com/amzn/click/com/0789721287)”构建 TinyPIM 项目，然后，当它工作时，开始设计自己的扩展。

# logging - 日志文件流应该在每次写入时打开/关闭还是在桌面应用程序的生命周期内保持打开状态？

> ID：164053
> 
> 赞同：38
> 
> 时间：2008-10-02T19:14:35.973
> 
> 标签：logging

日志类应该在每次写入日志文件时打开/关闭日志文件流，还是应该在应用程序的整个生命周期中保持日志文件流打开，直到所有日志记录完成？

我在桌面应用程序的上下文中询问。我看到人们用两种方式都这样做，并且想知道哪种方法可以为记录器产生最佳的全面结果。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-02T19:16:00.667

**如果您有频繁的读/写，则使用单个 open/close**使文件在整个生命周期内保持打开状态会更有效。

您可能希望**定期或在每次写入后刷新，**但万一您的应用程序崩溃，您可能没有将所有数据写入文件。在基于 Unix 的系统上使用 fflush，在 Windows 上使用 FlushFileBuffers。

如果您也在 Windows 上运行，则可以使用带有 FILE_FLAG_NO_BUFFERING 的 CreateFile API 在每次写入时直接转到文件。

最好在整个生命周期**内保持文件打开**，**因为**每次打开/关闭文件时，如果文件正在使用中，您可能会失败。例如，您可能有**一个备份应用程序，它在备份文件时运行并打开/关闭您的文件**。这**可能会导致您的程序无法访问您自己的文件**。理想情况下，您希望始终保持文件打开并在 Windows (FILE_SHARE_READ) 上指定共享标志。在基于 Unix 的系统上，共享将是默认设置。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-02T21:52:19.527

一般来说，正如其他人所说，保持文件打开以提高性能（打开是一个相对较慢的操作）。但是，您需要考虑如果您保持文件打开并且人们删除日志文件或截断它会发生什么。这取决于开放时间使用的标志。（我正在解决 Unix - 类似的考虑可能适用于 Windows，但我会接受比我更有知识的人的更正）。

如果有人看到日志文件增长到 1 MiB，然后将其删除，那么应用程序将不会更明智，并且 Unix 将保持日志数据的安全，直到日志被应用程序关闭。更重要的是，用户会感到困惑，因为他们可能创建了一个与旧日志文件同名的新日志文件，并且对应用程序“停止记录”的原因感到困惑。当然，它没有；它只是记录到其他人无法访问的旧文件。

如果有人注意到日志文件已经增长到 1 MiB，然后将其截断，那么应用程序也不会更明智。但是，根据打开日志文件的方式，您可能会得到奇怪的结果。如果文件不是用 O_APPEND (POSIX-speak) 打开的，那么程序将继续在日志文件中的当前偏移量处写入，文件的前 1 MiB 将显示为零字节流——这很恰当混淆查看文件的程序。

如何避免这些问题？

*   使用 O_APPEND 打开日志文件。
*   定期[`fstat()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/fstat.html)在文件描述符上使用并检查是否`st_nlink`为零。

如果链接计数变为零，则有人删除了您的日志文件。是时候关闭它，然后重新打开一个新的。与[`stat()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/stat.html)or相比[`open()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/open.html)，`fstat()`应该很快；它基本上是直接从内存中的东西中复制信息，不需要名称查找。因此，您可能应该在每次要写作时都这样做。

建议：

*   确保有一种机制告诉程序切换日志。
*   确保在消息中记录完整的日期和时间。

我的应用程序会显示时间而不是日期。今天早些时候，我有一个消息文件，其中包含 8 月 17 日的一些条目（其中一条消息不小心在时间之后的消息中包含了日期），然后是今天的一些条目，但我只能说是因为我创建了它们。如果我在一周内查看日志文件，我无法确定它们是在哪一天创建的（尽管我会知道它们的创建时间）。这种事情很烦人。

你也可以看看像 Apache 这样的系统是做什么的——它们有处理日志文件的机制，还有处理日志轮换的工具。注意：如果应用程序确实保持单个文件打开，不使用附加模式，并且不计划日志轮换或大小限制，那么对于日志文件增长或在开始时有大块零，您无能为力 - 其他而不是定期重新启动应用程序。

您应该确保尽快完成对日志的所有写入。如果使用文件描述符，则只有内核缓冲；这可能是可以接受的，但请考虑`O_SYNC`或`O_DSYNC`选项`open()`。如果您使用文件流 I/O，请确保每次写入后跟[`fflush()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/fflush.html). 如果您有一个多线程应用程序，请确保每个应用程序都[`write()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/write.html)包含完整的消息；不要尝试单独编写消息的各个部分。使用文件流 I/O，您可能需要使用[`flockfile()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/flockfile.html)和亲戚来将操作分组在一起。使用文件描述符 I/O，您可以使用[`dprintf()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/dprintf.html)对文件描述符执行格式化的 I/O（尽管并不完全清楚是否`dprintf()`会单独调用`write()`），或者也许[`writev()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/writev.html)在单个操作中写入单独的数据段。

顺便说一句，“包含”零的磁盘块实际上并未在磁盘上分配。你真的可以通过创建每个几个 GiB 的文件来搞砸人们的备份策略，但是除了最后一个磁盘块之外的所有文件都只包含零。基本上（为简洁起见，省略了错误检查和文件名生成）：

```
int fd = open("/some/file", O_WRITE|O_CREATE|O_TRUNC, 0444);
lseek(fd, 1024L * 1024L * 1024L, 0);
write(fd, "hi", 2);
close(fd); 
```

这会占用磁盘上的一个磁盘块 - 但在（未压缩）备份时占用 1 GiB（和更改），在恢复时占用 1 GB（和更改）。反社会，但可能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T19:23:05.530

为了性能，**保持打开**。为安全起见，请**经常冲洗**。

这意味着运行时库在它有大量数据之前不会尝试缓冲写入——在写入之前你可能会崩溃！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T19:18:41.610

我倾向于让它们保持打开状态——但使用设置为允许其他**读者**的文件共享权限打开它们，并确保在每条消息中刷新日志输出。

我讨厌那些甚至不让你在运行时查看日志文件的程序，或者日志文件没有被刷新并且落后于正在发生的事情的程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T19:20:19.110

通常最好让它们保持打开状态。

如果您担心能够从另一个进程读取它们，则需要确保用于打开/创建它们的共享模式允许其他人读取它们（但显然不能写入它们）。

如果您担心在崩溃时丢失数据，您应该定期刷新/提交它们的缓冲区。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-02T19:22:37.717

这是一个权衡。每次打开和关闭文件都更有可能在程序崩溃时在磁盘上更新文件。另一方面，在打开文件、寻找结尾以及向其附加数据时会产生一些开销。

在 Windows 上，您将无法在文件打开时移动/重命名/删除文件，因此打开/写入/关闭可能有助于长时间运行的进程，您可能偶尔希望存档旧日志内容而不中断作家。

在我完成这种日志记录的大多数情况下，我保持文件打开，并使用 fflush() 使程序崩溃时文件更有可能是最新的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T19:17:04.533

打开和关闭。如果系统崩溃，可以将您从损坏的文件中拯救出来。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T19:17:05.797

我看不出有任何理由关闭它。

另一方面，关闭和重新打开需要一些额外的时间。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T19:17:42.503

我可以想到几个您不想打开文件的原因：

*   如果在多个不同的应用程序、用户或应用程序实例之间共享一个日志文件，您可能会遇到锁定问题。
*   如果您没有正确清除流缓冲区，则当该应用程序崩溃并且您最需要它们时，您可能会丢失最后几个条目。

另一方面，打开文件可能会很慢，即使在附加模式下也是如此。最后，这取决于您的应用程序在做什么。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T19:18:26.510

每次关闭文件的好处是操作系统会保证将新消息写入磁盘。如果您让文件保持打开状态并且您的程序崩溃，那么整个内容可能不会被写入。您也可以通过执行 fflush() 或您使用的语言中的任何等效项来完成相同的事情。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T19:21:58.793

作为您的应用程序的用户，我希望它不要打开文件，除非它是应用程序的真正要求。在系统崩溃等情况下可能会出错的另一件事。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T19:28:01.340

我会在每次写入（或一批写入）**时打开和关闭。**如果这样做会导致桌面应用程序出现性能问题，那么您可能过于频繁地写入日志文件（尽管我确信大量写入可能有正当理由）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T20:33:18.157

对于大型密集型应用程序，我通常会在应用程序期间保持日志文件打开，并有一个单独的线程定期将内存中的日志内容刷新到 HDD。文件的打开和关闭操作需要系统调用，如果你深入到较低的级别，这是很多工作。

# mysql - 当代码库没有 ORM 时对 MySQL 数据库进行版本控制

> ID：164073
> 
> 赞同：3
> 
> 时间：2008-10-02T19:19:04.403
> 
> 标签：mysql, project-management, versioning

我一直在考虑这个问题，但还没有提出任何稳定/优雅的想法。

我知道使用 MyISAM 表，您可以获得表 def 更新时间，但对于 InnoDB，情况并非如此，而且我发现查看 .frm 文件以了解何时可能修改了定义甚至不可靠。 ..别管数据集是否已更改。

我有一个想法，每 30 分钟 mysqldumping 模式的内容，用 AWK 脚本将其分开，然后将其与上一个版本进行比较……但这似乎有点过分，如果涉及的数据集很大，可能会成为问题.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T20:08:54.423

如果你运行`mysqldump -d`它只转储模式：

```
[gary.richardson@server ~]$ mysqldump -d -u root mysql user
-- MySQL dump 10.11
--
-- Host: localhost    Database: mysql
-- ------------------------------------------------------
-- Server version       5.0.45

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `user`
--

DROP TABLE IF EXISTS `user`;
CREATE TABLE `user` (
  `Host` char(60) collate utf8_bin NOT NULL default '',
  `User` char(16) collate utf8_bin NOT NULL default '',
  `Password` char(41) character set latin1 collate latin1_bin NOT NULL default '',
  `Select_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Insert_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Update_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Delete_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Create_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Drop_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Reload_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Shutdown_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Process_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `File_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Grant_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `References_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Index_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Alter_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Show_db_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Super_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Create_tmp_table_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Lock_tables_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Execute_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Repl_slave_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Repl_client_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Create_view_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Show_view_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Create_routine_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Alter_routine_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `Create_user_priv` enum('N','Y') character set utf8 NOT NULL default 'N',
  `ssl_type` enum('','ANY','X509','SPECIFIED') character set utf8 NOT NULL default '',
  `ssl_cipher` blob NOT NULL,
  `x509_issuer` blob NOT NULL,
  `x509_subject` blob NOT NULL,
  `max_questions` int(11) unsigned NOT NULL default '0',
  `max_updates` int(11) unsigned NOT NULL default '0',
  `max_connections` int(11) unsigned NOT NULL default '0',
  `max_user_connections` int(11) unsigned NOT NULL default '0',
  PRIMARY KEY  (`Host`,`User`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='Users and global privileges';
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2008-10-02 20:06:38 
```

然后你可以做你的解析。

您的问题还有另一种解决方案，但需要遵守纪律。您可以将 COMMENT 字段添加到列和表中：

```
CREATE TABLE example (
  name varchar(32) COMMENT='Name of a person'
) COMMENT='example table'; 
```

我喜欢在里面放一个版本号。您可以将其绑定到您的 RCS：

```
CREATE TABLE example (
  name varchar(32) COMMENT='Name of a person'
) COMMENT='VERSION=1.2.3 example table'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T20:15:29.400

这让我想起了这个问题： [您如何管理具有分支的中型项目的数据库修订？](https://stackoverflow.com/questions/156044/how-do-you-manage-database-revisions-on-a-medium-sized-project-with-branches#156054) 但也许我是一般...

[http://odetocode.com/Blogs/scott/archive/2008/01/30/11702.aspx](http://odetocode.com/Blogs/scott/archive/2008/01/30/11702.aspx)

我目前正在处理的代码库没有 ORM，但我们仍然使用基于上述博客的解决方案。有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T19:23:12.630

是的，这很难。这就是我使用innodb的原因。转储/导入更容易，我们甚至将模式放在 VC 下。

# javascript - IFRAME 完成加载时的 Javascript 回调？

> ID：164085
> 
> 赞同：150
> 
> 时间：2008-10-02T19:21:44.647
> 
> 标签：javascript, events, dom, iframe

当 IFRAME 完成加载时，我需要执行回调。我无法控制 IFRAME 中的内容，因此无法从那里触发回调。

这个 IFRAME 是以编程方式创建的，我需要在回调中将其数据作为变量传递，以及销毁 iframe。

有任何想法吗？

**编辑：**

这是我现在拥有的：

```
function xssRequest(url, callback)
{
    var iFrameObj = document.createElement('IFRAME');
    iFrameObj.src = url;            
    document.body.appendChild(iFrameObj);   

    $(iFrameObj).load(function() 
    {
        document.body.removeChild(iFrameObj);
        callback(iFrameObj.innerHTML);
    });
} 
```

此回调在 iFrame 加载之前进行，因此回调没有返回数据。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-16T18:31:38.953

首先，通过函数名称*xssRequest*听起来您正在尝试跨站点请求 - 如果这是正确的，您将无法读取 iframe 的内容。

另一方面，如果 iframe 的 URL 在您的域上，您可以访问正文，但我发现如果我使用超时来删除 iframe，则回调可以正常工作：

```
// possibly excessive use of jQuery - but I've got a live working example in production
$('#myUniqueID').load(function () {
  if (typeof callback == 'function') {
    callback($('body', this.contentWindow.document).html());
  }
  setTimeout(function () {$('#frameId').remove();}, 50);
}); 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2013-05-03T16:12:24.027

我正在使用 jQuery，令人惊讶的是，这似乎加载了，因为我刚刚测试并加载了一个沉重的页面，并且在看到 iframe 加载之前我没有收到警报几秒钟：

```
$('#the_iframe').load(function(){
    alert('loaded!');
}); 
```

因此，如果您不想使用 jQuery，请查看他们的源代码，看看此函数与 iframe DOM 元素的行为是否不同，稍后我会自己查看它，因为我有兴趣并在此处发布。我也只在最新的 chrome 中测试过。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-05T05:33:44.137

在将 word docs 和 pdf 等文档流式传输到 iframe 并找到一个运行良好的解决方案的情况下，我不得不这样做。关键是处理`onreadystatechanged`iframe 上的事件。

假设您的框架的名称是“myIframe”。首先在您的代码启动中的某个地方（我在 iframe 之后的任何地方内联）添加类似这样的内容来注册事件处理程序：

```
document.getElementById('myIframe').onreadystatechange = MyIframeReadyStateChanged; 
```

我无法在 iframe 上使用 onreadystatechage 属性，我不记得为什么，但该应用程序必须在 IE 7 和 Safari 3 中运行，所以这可能是一个因素。

以下是如何获取完整状态的示例：

```
function MyIframeReadyStateChanged()
{
    if(document.getElementById('myIframe').readyState == 'complete')
    {
        // Do your complete stuff here.
    }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-02-12T10:32:50.050

您的 iframe 的 innerHTML 是空白的，因为您的 iframe 标记没有包围父文档中的任何内容。为了从 iframe 的 src 属性引用的页面中获取内容，您需要访问 iframe 的 contentDocument 属性。但是，如果 src 来自不同的域，则会引发异常。这是一项安全功能，可防止您在其他人的页面上执行任意 JavaScript，这会造成跨站点脚本漏洞。这是一些示例代码，说明了我在说什么：

```
<script src="http://prototypejs.org/assets/2009/8/31/prototype.js" type="text/javascript"></script>

<h1>Parent</h1>

<script type="text/javascript">
function on_load(iframe) {
  try {
    // Displays the first 50 chars in the innerHTML of the
    // body of the page that the iframe is showing.
    // EDIT 2012-04-17: for wider support, fallback to contentWindow.document
    var doc = iframe.contentDocument || iframe.contentWindow.document;
    alert(doc.body.innerHTML.substring(0, 50));
  } catch (e) {
    // This can happen if the src of the iframe is
    // on another domain
    alert('exception: ' + e);
  }
}
</script>
<iframe id="child" src="iframe_content.html" onload="on_load(this)"></iframe> 
```

为了进一步说明示例，请尝试将其用作 iframe 的内容：

```
<h1>Child</h1>

<a href="http://www.google.com/">Google</a>

<p>Use the preceeding link to change the src of the iframe
to see what happens when the src domain is different from
that of the parent page</p> 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-12-10T08:16:19.070

当 i 框架内容在 IE 上完全加载时，我想隐藏等待的微调器 div，我尝试了 Stackoverflow.Com 中提到的所有解决方案，但没有任何效果。

然后我有了一个想法，当 i 帧内容完全加载时，可能会触发 $(Window) 加载事件。这正是发生的事情。所以，我写了这个小脚本，并且像魔术一样工作：

```
 $(window).load(function () {
     //alert("Done window ready ");
     var lblWait = document.getElementById("lblWait");
     if (lblWait != null ) {
         lblWait.style.visibility = "false";
         document.getElementById("divWait").style.display = "none";
     }
 }); 
```

希望这可以帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-10T08:23:47.677

我和你有类似的问题。我所做的是我使用了一个叫做 jQuery 的东西。然后您在 javascript 代码中执行的操作是：

```
$(function(){ //this is regular jQuery code. It waits for the dom to load fully the first time you open the page.

    $("#myIframeId").load(function(){
       callback($("#myIframeId").html());
       $("#myIframeId").remove();

    });

}); 
```

似乎您在从中获取 html 之前删除了 iFrame。现在，我确实看到了一个问题：p

希望这可以帮助 ：）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-15T13:52:53.307

我的项目中有一个类似的代码可以正常工作。使我的代码适应您的功能，解决方案可能如下：

```
function xssRequest(url, callback)
{
    var iFrameObj = document.createElement('IFRAME');
    iFrameObj.id = 'myUniqueID';
    document.body.appendChild(iFrameObj);       
    iFrameObj.src = url;                        

    $(iFrameObj).load(function() 
    {
        callback(window['myUniqueID'].document.body.innerHTML);
        document.body.removeChild(iFrameObj);
    });
} 
```

也许你有一个空的innerHTML，因为（一个或两个原因）：1.你应该对body元素使用它2.你已经从你的页面DOM中删除了iframe

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-25T13:33:03.917

我认为加载事件是正确的。不正确的是您用来从 iframe 内容 dom 中检索内容的方式。

您需要的是 iframe 中加载的页面的 html，而不是 iframe 对象的 html。

您所要做的就是使用`iFrameObj.contentDocument`. 这将返回 iframe 中加载的页面的 dom，如果它位于当前页面的同一域中。

我会在删除 iframe 之前检索内容。

我已经在 Firefox 和 Opera 中进行了测试。

`$(childDom).html()`然后我认为您可以使用或检索您的数据`$(childDom).find('some selector') ...`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-10-24T07:49:52.850

如果 iFrame 已加载或等待 iFrame 完全加载，此函数将立即运行您的回调函数。

这也解决了以下问题：

1.  Chrome 使用一个页面初始化每个 iFrame，该`about:blank`页面将包含`readyState == "complete"`. 稍后，它会将 `about:blank 替换为实际的 iframe src 值。所以，readyState 的初始值不会代表你实际 iFrame 的 readyState。因此，除了检查 readyState 值之外，此函数还解决了 about:blank 问题。

2.  `DOMContentLoaded`事件不适用于 iFrame。因此，`load`如果 iFrame 尚未加载，它会使用事件来运行回调函数。该`load`事件相当于`readyState == "complete"`which has been 用于检查 iFrame 是否已加载。因此，在任何情况下，回调函数都会在 iFrame 完全加载后运行。

3.  iFrame src 可以具有重定向，因此加载与原始 src url 不同的页面。此功能也适用于该场景。

**将您想要在 iFrame 完成加载时运行的回调函数和`<iframe>`元素传递给此函数：**

```
function iframeReady(callback, iframeElement) {
    const iframeWindow = iframeElement.contentWindow;
    if ((iframeElement.src == "about:blank" || (iframeElement.src != "about:blank" && iframeWindow.location.href != "about:blank")) && iframeWindow.document.readyState == "complete") {
        callback();
    } else {
        iframeWindow.addEventListener("load", callback);
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T19:34:53.117

我过去遇到过完全相同的问题，我发现解决它的唯一方法是将回调添加到 iframe 页面中。当然，这仅在您可以控制 iframe 内容时才有效。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2018-03-26T08:07:51.540

使用`onload`属性将解决您的问题。

这是一个例子。

```
function a() {
alert("Your iframe has been loaded");
}
```

```
<iframe src="https://stackoverflow.com" onload="a()"></iframe>
```

这是你想要的吗？

[点击这里](https://www.w3schools.com/tags/ev_onload.asp)了解更多信息。

# c# - 让您的收藏成为线程安全的？

> ID：164088
> 
> 赞同：9
> 
> 时间：2008-10-02T19:22:26.687
> 
> 标签：c#, java, multithreading, collections

在设计集合类时，有什么理由不私下实现锁定以使其线程安全？还是我应该把这个责任留给收藏品的消费者？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-02T19:42:01.587

> 是否有任何理由不私下实现锁定以使其线程安全？

这取决于。您的目标是编写一个可被多个线程访问的集合类吗？如果是这样，使其线程安全。如果没有，不要浪费你的时间。这种事情就是人们在谈论“过早优化”时所指的

解决您遇到的问题。不要试图解决你认为未来几年可能会有的未来问题，因为你看不到未来，你总是会错的。

注意：您仍然需要以可维护的方式编写代码，这样如果您*确实*需要加入并为集合添加锁定，这不会太难。我的观点是“不要实现你不需要也不会使用的功能”

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-02T19:28:44.987

对于 Java，您应该不同步以提高速度。如果需要，集合的消费者可以包装在[同步包装器中。](http://java.sun.com/docs/books/tutorial/collections/implementations/wrapper.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-09-26T15:15:38.400

线程安全集合可能具有欺骗性。Jared Par 发表了几篇关于线程安全集合的有趣文章：

> 问题是有几个级别的线程安全集合。我发现，当大多数人说线程安全集合时，他们真正的意思是“在从多个线程修改和访问时不会损坏的集合”</p>
> 
> ...
> 
> 但如果构建数据线程安全列表如此简单，微软为什么不在框架中添加这些标准集合呢？
> 
> 回答： ThreadSafeList 是一个几乎无法使用的类，因为该设计会导致您走上错误代码的道路。
> 
> 在您检查列表的常用方式之前，此设计中的缺陷并不明显。例如，下面的代码尝试从列表中抓取第一个元素（如果有的话）。

```
static int GetFirstOrDefault(ThreadSafeList<int> list) {
    if (list.Count > 0) {
        return list[0];
    }
    return 0; } 
```

> 这段代码是一个经典的竞争条件。考虑列表中只有一个 > 元素的情况。如果另一个线程在 if 语句和 return 语句之间删除了该元素，return 语句将抛出异常，因为它试图访问列表中的无效索引。即使 ThreadSafeList 是数据线程安全的，也无法保证一个调用的返回值在对同一对象的下一次调用中的有效性

[http://blogs.msdn.com/b/jaredpar/archive/2009/02/11/why-are-thread-safe-collections-so-hard.aspx](http://blogs.msdn.com/b/jaredpar/archive/2009/02/11/why-are-thread-safe-collections-so-hard.aspx)

[http://blogs.msdn.com/b/jaredpar/archive/2009/02/16/a-more-usable-thread-safe-collection.aspx](http://blogs.msdn.com/b/jaredpar/archive/2009/02/16/a-more-usable-thread-safe-collection.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T19:30:45.187

集合类需要尽可能快。因此，不要使用锁。

调用代码将知道集合类不知道锁最好的位置。在最坏的情况下，应用程序将不得不添加一个额外的锁，这意味着会发生两个锁，使其性能提高一倍。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T19:25:13.327

我个人会把它留给消费者。它将使您的集合类更通用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-02T19:30:10.287

只需在您的文档中明确说明您没有使其成为线程安全并将其排除在外，或者，对于您的应用程序，如果您希望它是线程安全的，则使其成为线程安全的，并在您的文档中注明。唯一的规则是记录它。除此之外，为您制作课程，如果其他人想使用它，他们可以。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T19:30:27.510

如果我正在寻找一个集合类并且我需要线程安全功能而您的类没有它们，我将立即跳到那里的下一个产品以查看它们提供的内容。你的收藏不会再引起我的注意了。

注意开头的“如果”。有些客户会想要它，有些不会，有些则不在乎。如果您要为消费者构建工具包，那么为什么不同时提供这两种工具呢？这样我可以选择使用哪一个，但如果我想要线程安全，你仍然需要我的注意，我不必自己写。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-02T19:46:53.120

使集合线程安全是杀死 Java 的 Vector 和 Hashtable 类的原因。如前所述，客户端将其包装在线程安全的包装器中，或者在方法子集上同步数据访问，比每次访问类时都进行同步命中要容易得多。几乎没有人使用 Vector 或 Hashtable，如果他们使用了，他们会被嘲笑，因为它们的替代品（ArrayList 和 HashMap）要快得多。不幸的是，因为我（来自 C++ 背景）更喜欢“向量”名称（STL），但 ArrayList 仍然存在。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T19:30:59.740

不使其线程安全的主要原因是性能。线程安全代码可能比非安全代码慢 100 倍，因此如果您的客户不想要该功能，那是相当大的浪费。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-02T19:37:55.247

请注意，如果您尝试使任何类线程安全，则需要确定常见的使用场景。

例如，在集合的情况下，仅将所有属性和方法单独设置为线程安全对于消费者来说可能不够好，因为首先读取计数，然后循环或类似的，如果读后计数改变了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T20:13:13.273

基本上，将您的集合设计为线程安全的，并在您的类的两种方法中实现锁定：lock() 和 unlock()。在任何需要的地方打电话给他们，但不要让他们空着。然后子类你的集合实现 lock() 和 unlock() 方法。两个课程的价格。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-03T04:26:51.963

不让你的集合线程安全的一个很好的理由是提高单线程性能。示例：ArrayList over Vector。将线程安全性推迟给调用者允许通过避免锁定来优化非同步用例。

使您的集合线程安全的一个非常好的理由是提高多线程性能。示例：基于 HashMap 的 ConcurrentHashMap。因为 CHM 内化了多线程关注点，它可以比外部同步更有效地对更大的并发访问进行条带锁定。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T19:30:13.360

即使您知道您触摸的元素没有被其他任何人使用，这也会使您无法同时从多个线程访问集合。

一个示例是具有基于整数的索引访问器的集合。每个线程可能从它的 id 知道它可以访问哪些索引值，而不必担心脏读/写。

另一种可能对性能造成不必要影响的情况是，仅从集合中读取数据而不写入数据。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-02T19:32:29.177

我同意把它留给消费者是正确的做法。If 为消费者提供了更大的灵活性，即是否同步 Collection 实例或同步不同的对象。例如，如果您有两个都需要更新的列表，则使用单个锁将它们放在单个同步块中可能是有意义的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-02T19:35:08.263

如果您创建一个集合类，请不要使其成为线程安全的。做正确（例如正确和快速）是相当困难的，而且当您做错时给您的消费者带来的问题（heisenbugs）也很难调试。

相反，实现一个 Collection API 并在需要时使用 Collections.synchronizedCollection(yourCollectionInstance) 来获得一个线程安全的实现。

只需在您的类 javadoc 中引用适当的 Collections.synchronizedXXX 方法即可；它将清楚地表明您在设计中考虑了线程安全，并确保消费者可以使用线程安全选项。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-02T23:01:25.367

这是一个好的开始。

[线程安全字典](http://devplanet.com/blogs/brianr/archive/2008/09/26/thread-safe-dictionary-in-net.aspx)

但是你会注意到你失去了集合的一大特点——枚举。您不能对枚举器进行线程安全，这实际上并不可行，除非您实现自己的枚举器，该枚举器将实例锁定返回给集合本身。我怀疑这会导致严重的瓶颈和潜在的死锁。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-03-08T03:33:16.577

从 JDK 5 开始，如果您需要一个线程安全的集合，我首先会看看 java.util.concurrent 中已经实现的集合之一是否可以工作。正如*Java Concurrency In Practice*的作者（包括编写大部分类的人）指出的那样，正确实现这些是非常困难的，尤其是在性能很重要的情况下。

引用[http://download.oracle.com/javase/6/docs/api/java/util/concurrent/package-summary.html](http://download.oracle.com/javase/6/docs/api/java/util/concurrent/package-summary.html)

> **并发集合**
> 
> 除了队列之外，这个包还提供设计用于多线程上下文的集合实现：ConcurrentHashMap、ConcurrentSkipListMap、ConcurrentSkipListSet、CopyOnWriteArrayList 和 CopyOnWriteArraySet。当期望许多线程访问给定的集合时，ConcurrentHashMap 通常比同步的 HashMap 更可取，而 ConcurrentSkipListMap 通常比同步的 TreeMap 更可取。当预期的读取和遍历次数大大超过对列表的更新次数时，CopyOnWriteArrayList 比同步的 ArrayList 更可取。

# c - 长数组的序列化（在 C 中）

> ID：164093
> 
> 赞同：2
> 
> 时间：2008-10-02T19:22:53.830
> 
> 标签：c, arrays, string, serialization

在 C 程序中，我有一个 long* 想要序列化（从而转换为字符）。long 不适合单个字符，并且大小因处理器而异（可以是 4 字节或 8 字节）。

有什么好方法可以进行序列化和反序列化？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T22:28:46.573

这是可移植的，但远不如使用 printf/scanf 效率低

```
void longtochar(char *buffer, unsigned long number) {
    int i;
    for (i=0; i<sizeof(long); i++) {
        buffer[i] = number & 0xFF; // place bottom 8 bits in char
        number = number >> 8; // shift down remaining bits
    }
    return; // the long is now stored in the first few (2,4,or 8) bytes of buffer
} 
```

并再次打开包装（假设 long 大小相同）

```
long chartolong(char *buffer) {
    long number = 0;
    int i;
    for (i=sizeof(long)-1; i>=0; i--) {
        number = number << 8; // left shift bits in long already
        number += buffer[i]; // add in bottom 8 bits
    }
    return number;
} 
```

请注意 BIG 假设，即 long 在两个系统上的长度相同。安全的做法是#include <stdint.h> 并使用它提供的类型（uint32_t 或 uint16_t）。

此外，我的代码将其作为无符号长。我现在无法访问 C 编译器，所以我无法确认它是否适用于有符号整数。如果记忆对我有用，它的行为可能是未定义的（尽管我如何处理它可能并不重要）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T19:31:54.263

您可能正在解决错误的问题。您应该序列化为固定大小的 int，例如使用 int32_t。您可能希望在整个程序中使用这种固定大小的类型，否则当 64 位程序无法保存到较小的大小（或使用 int64_t）时，您会遇到问题。

如果知道您永远不必在 32 位平台上加载 64 位保存，那么请不要打扰。只需将 sizeof(long) 字节写入文件，然后读回 sizeof(long) 字节。但在数据的早期放置一个标志来指示源平台以避免错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:51:55.133

您不必序列化为字符 - 您可以 fwrite as longs（到文件）。要序列化为 char 数组，请在开头输入一个字节以指示 int 的大小和字节顺序 - 您稍后将需要它。

IE

```
char *p = &long_array[0]; 
```

要以 char 的形式访问长数组，只需将其转换 - 并将数组的长度乘以 sizeof(long) 即可获得 chars 的大小。

一个简单的例子说明了这一点：

```
#include <stdio.h>

main()
{
    int aaa[10];
    int i;
    char *p;

    for(i=0;i<sizeof(aaa)/sizeof(aaa[0]);i++)
    {
        aaa[i] = i;
        printf ("setting aaa[%d] = %8x\n",i,aaa[i]);
    }

    aaa[9] = 0xaabbccdd;

    printf ("sizeof aaa (bytes) :%d\n",sizeof(aaa));
    printf ("each element of aaa bytes :%d\n",sizeof(aaa[0]));

    p = (char*) aaa;
    for(i=0;i<sizeof(aaa);i++)
        printf ("%d: %8x\n",i,(unsigned char)p[i]);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T19:26:44.367

```
long * longs;

// ...

int numChars = numLongs * sizeof(long);
char* longsAsChars = (char*) longs;
char* chars = malloc(numChars);
memcpy(chars, longsAsChars, numChars); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T19:29:47.620

在 C 中，您可以获得 long 的大小

```
sizeof(long) 
```

但是，如果您存储的 long 必须可以在多个平台之间传输，您应该始终将其序列化为 4​​ 个字节。无论如何，4byte 处理器无法读取更大的数字。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T19:26:28.393

如果您创建一个指向长数组开头的 char 指针，当您通过 char“数组”递增时，您一次将获得 8 位。但是请注意，long 不会以 null 结尾（可能是），因此您需要跟踪它的结尾在哪里。

例如：

```
long list[MAX];
char *serial = list;
int chunk = sizeof(long);
int k;
for(k=0; k<(MAX*chunk); k++){
  // do something with the "char"
} 
```

# ruby - 需要帮助改进 Ruby DSL 以控制 Arduino 控制的饮料分配器（酒吧猴子）

> ID：164095
> 
> 赞同：6
> 
> 时间：2008-10-02T19:23:12.613
> 
> 标签：ruby, language-design, dsl, arduino

我正在用 Ruby 编写 DSL 来控制我正在从事的 Arduino 项目；巴迪诺。这是一个酒吧猴子，将由软件控制以提供饮料。Arduino 通过串行端口接收命令，告诉 Arduino 要打开哪些泵以及打开多长时间。

它当前读取一个配方（见下文）并将其打印出来。串行通信的代码以及我在下面提到的其他一些想法仍然需要处理。

这是我的第一个 DSL，我正在处理前面的示例，所以它的边缘非常粗糙。任何批评、代码改进（对于 Ruby DSL 最佳实践或习语有什么好的参考吗？）或任何一般性评论。

我目前有一份 DSL 的草稿，所以饮料配方如下所示（[Github 链接](http://github.com/mwilliams/barduino-tender/tree/571fb9128c02ce72b1f891d841930bf526f1432c/examples/water.rb)）：

```
desc "Simple glass of water"
recipe "water" do
  ingredients(
  "Water" => 2.ounces
  )
end 
```

这反过来被解释，目前结果如下（[Github 链接](http://github.com/mwilliams/barduino-tender/tree/571fb9128c02ce72b1f891d841930bf526f1432c/barduino-tender.rb)）：

```
[mwilliams@Danzig barduino-tender]$ ruby barduino-tender.rb examples/water.rb
Preparing: Simple glass of water

Ingredients:
 Water: 2 ounces 
```

这对于 DSL 来说是一个好的开始，但是，我确实认为它可以实现得更好一些。我有以下一些想法：

1.  使用成分的名称和它所连接的数字泵来定义可用的“成分”。也许使用哈希？成分 = {“水” => 1，“伏特加” => 2}。这样，当一种成分被解释时，它可以 a）通过串行端口发送泵号，然后是 Arduino 分配的盎司数 b）告诉用户成分不存在并中止，因此没有分配 c）如果它们被改变，很容易有能力改变或添加新的成分。
2.  让菜谱看起来不像代码，这是 DSL 的主要目的，也许构建一个菜谱构建器？使用可用的成分提示用户输入饮料名称、涉及的成分和多少？

Github 项目在[这里](http://github.com/mwilliams/barduino-tender/tree/master)，请随时 fork 并提出拉取请求，或在此处发布您的代码建议和示例以供其他用户查看。如果您完全好奇，[这里](http://github.com/mwilliams/barduino/tree/master)是使用 Ruby Arduino 开发框架的 Arduino 代码。

**更新**

我修改和清理了一些东西，以反映 Orion Edwards 对食谱的建议。现在看起来如下所示。

```
description 'Screwdriver' do 
  serve_in 'Highball Glass'
  ingredients do
    2.ounces :vodka
    5.ounces :orange_juice
  end
end 
```

我还添加了一个哈希（键是成分和它所连接的泵号的值）。我认为这提供了很大的进步。我暂时将这个问题留待任何进一步的建议，但最终会选择 Orion 的答案。更新的 DSL 代码在[这里](http://github.com/mwilliams/barduino-tender/tree/master/barduino-tender.rb)。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T20:16:28.553

在不查看实现细节（或您的 github 链接）的情况下，我会尝试编写这样的 DSL：

（从这里偷：[http](http://supercocktails.com/1310/Long-Island-Iced-Tea-) ://supercocktails.com/1310/Long-Island-Iced-Tea- ）

```
describe "Long Island Iced Tea" do
  serve_in 'Highball Glass'

  ingredients do
    half.ounce.of :vodka
    half.ounce.of :tequila
    half.ounce.of :light_rum
    half.ounce.of :gin
    1.dash.of :coca_cola
    #ignoring lemon peel as how can a robot peel a lemon?
  end

  steps do
    add :vodka, :tequila, :light_rum, :gin
    stir :gently
    add :coca_cola
  end
end 
```

希望有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-13T21:16:24.823

如果你想让食谱看起来更自然，为什么不（来自 Orion Ewards 使用的相同食谱，谢谢！）：

```
Recipe for Long Island Iced Tea #1
Ingredients:
  1/2 oz Vodka
  1/2 oz Tequila
  1/2 oz Light Rum
  1/2 oz Gin
  1 Dash Coca-Cola
  # ignored Twist of Lemon Peel (or Lime) 
```

然后将[Treetop](http://treetop.rubyforge.org/)添加到混合物中。你可以有如下规则：

```
grammar Cocktail
  rule cocktail
    title ingredients
  end

  rule title
    'Recipe for' S text:(.*) EOF
  end

  rule ingredients
    ingredient+
  end

  rule ingredient
    qty S liquid
  end
# ...
end 
```

树顶编译器将转换为一个不错的 ruby​​ 模块。然后：

```
parser = CocktailParser.new
r = parser.parse(recipe) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T05:50:06.507

Orion 的 DSL 看起来很不错。我可能建议您“更新”代码的唯一更改是

1.  替换`description` 为`recipe`。这是一个更具描述性的术语
2.  由于成分和动作的集合是固定的，因此将成分绑定到变量而不是符号，即您已在`vodka = :vodka`某个地方定义。它更容易说

    混合伏特加、杜松子酒和triple_sec # 而不是使用:vodka、:gin 和:triple_sec。

无论如何，这是一个小问题。

# c++ - 在 c++ 中，为什么编译器在 const 也可以工作时选择非常量函数？

> ID：164102
> 
> 赞同：20
> 
> 时间：2008-10-02T19:24:25.683
> 
> 标签：c++, constants, overload-resolution, const-reference, const-method

例如，假设我有一个类：

```
class Foo
{
public:
    std::string& Name()
    {
        m_maybe_modified = true;
        return m_name;
    }

    const std::string& Name() const
    {
        return m_name;
    }
protected:
    std::string m_name;
    bool m_maybe_modified;
}; 
```

在代码的其他地方，我有这样的东西：

```
Foo *a;
// Do stuff...
std::string name = a->Name(); // <-- chooses the non-const version 
```

有谁知道为什么编译器会在这种情况下选择非常量版本？

这是一个有点做作的例子，但我们试图解决的实际问题是定期自动保存一个对象，如果它已经改变，并且指针必须是非常量的，因为它可能会在某个时候改变。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-02T19:30:20.333

脑海中浮现出两个答案：

1.  非常量版本是更接近的匹配。

2.  如果它为非常量情况调用 const 重载，那么在什么情况下它会*调用*非常量重载？

您可以通过强制转换`a`为`const Foo *`.

**编辑：**来自[C++ 注释](http://www.icce.rug.nl/documents/cplusplus/cplusplus07.html)

> 早些时候，在 2.5.11 节中介绍了函数重载的概念。那里指出，成员函数可能仅通过其 const 属性重载。在这些情况下，编译器将使用***与对象的 const 限定最匹配的成员函数：***

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-02T19:31:59.363

因为 a 不是 const 指针。因此，非常量函数是更接近的匹配。以下是调用 const 函数的方法：

```
const Foo* b = a;
std::string name = b->Name(); 
```

如果您同时具有 const 和非常量重载，并且想在非常量对象上调用 const 重载，则这可能表明设计不佳。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-02T19:46:58.890

编译器在确定时不会考虑您如何使用返回值；这不是规则的一部分。它不知道你是否在做

```
std::string name = b->Name(); 
```

或者

```
b->Name() = "me"; 
```

它必须选择适用于这两种情况的版本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T20:49:10.893

您可以添加一个等效于“Name() const”的“cName”函数。这样，您可以调用函数的 const 版本，而无需先转换为 const 对象。

这对于 C++0x 中的新关键字 auto 非常有用，这就是为什么他们更新库以包含 cbegin()、cend()、crbegin()、crend() 以返回 const_iterator，即使对象不是非常量。

您正在做的事情可能最好通过一个 setName() 函数来完成，该函数允许您更改名称，而不是返回对底层容器的引用，然后“可能”它被修改。

# java - 从 Selenium 测试 onbeforeunload 事件

> ID：164105
> 
> 赞同：12
> 
> 时间：2008-10-02T19:24:47.353
> 
> 标签：java, javascript, html, selenium, onbeforeunload

我正在尝试为使用 onbeforeunload 事件在离开前提示用户的网页编写 Selenium 测试。Selenium 似乎无法识别出现的确认对话框，也无法提供点击 OK 或 Cancel 的方法。有没有办法做到这一点？如果相关的话，我正在使用 Java Selenium 驱动程序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T21:19:35.813

您可以编写一个用户扩展（或只是 storeEval 中的一些 JavaScript 等）来测试是否设置了 window.onbeforeunload，然后在从页面继续之前将其替换为 null。丑陋，但应该让你离开页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-11-06T19:15:01.500

我只需要为我的应用程序执行此操作，`onbeforeunload`如果用户在文档处于未保存状态时离开页面，处理程序会显示提示。Python代码：

```
driver.switch_to.alert.accept() 
```

Java 等价物是：

```
driver.switchTo().alert().accept(); 
```

如果警报不存在，上面的代码将失败，`NoAlertPresentException`因此在接受提示之前无需单独测试来检查存在。

我正在运行 Selenium 2.43.0，但我认为这已经有一段时间了。

如果我根本不希望出现提示，因为这不是我正在测试的内容，我会在浏览器中运行自定义 JavaScript以在离开页面之前设置`window.onbeforeunload`为。`null`我把它放在测试拆解代码中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-11-04T18:31:37.103

faced same problem with "beforeunlaod" event listner, [LUMINUS](https://chrome.google.com/webstore/detail/luminous-javascript-event/baacpbikplogpeecclpnajnlghmcldkb/related)! a chrome addon that helps me just block the event listener in the plugin thats all..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T21:46:54.233

当我面对使用 Selenium 对浏览器的有限控制时，我求助于[MozLab](http://hyperstruct.net/projects/mozlab)插件，它解决了我的问题，如果仅适用于一个浏览器平台。

# rss - RSS 项目更新

> ID：164124
> 
> 赞同：5
> 
> 时间：2008-10-02T19:29:44.690
> 
> 标签：rss, syndication

我正在为我们使用的自定义任务系统开发 RSS 提要，但我仍在思考事情应该如何工作。我想要的是每个用户的提要，显示分配给他们的任务，另外还有每个任务的提要，显示任务的更新。

我现在想知道的是关于用户提要。当更新分配给用户的案例时，我目前有代码来更改该项目的 pubDate 条目和频道的 lastBuildDate。我希望这会使该项目在读者中显示为未读，以便用户知道再次查看该项目，但情况似乎并非如此。我是否应该更改指南，即使它确实是相同的项目？那会有什么副作用？

有什么我想念的吗？我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T21:02:56.807

更改 <pubDate> 确实表明条目已更改，但不要求给定的 RSS 阅读器对此进行任何操作。（严格来说，没有要求 RSS 阅读器做任何事情，但让我们保持合理。）一些阅读器*确实*将更新的条目标记为已更改。例如，Bloglines.com 可以*选择性地*检测 <description> 中的更改，并在这种情况下再次将条目标记为新条目。

根据您的读者，更改 <title>、<description> 或 <pubDate> 可能会给您想要的行为。但正如 GateKiller 上面提到的，您最安全的选择是使用新的 <guid> 使其成为一个全新的条目。当您使用它时，您可能希望利用它来添加直接链接或有关更新的详细信息。

当然，如果您同时编写 RSS 的生产者和消费者，并且您的目标是提要始终包含完整的分配任务集，那么只需更新 <pubDate> 就可以了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T19:41:50.727

解决方案是同时更改 GUID，这意味着在其中包含更新的时间。GUID 为提要中的每个项目提供唯一性，如果您在其中输入更新日期，则该 GUID 将被标记为未读。

# python - 如何部署 Python 桌面应用程序？

> ID：164137
> 
> 赞同：33
> 
> 时间：2008-10-02T19:31:51.360
> 
> 标签：python, deployment

我已经开始使用在桌面上运行的个人 python 应用程序。我使用 wxPython 作为 GUI 工具包。如果对这种类型的应用程序有需求，我可能希望将其商业化。

我不知道如何部署“现实生活”的 Python 应用程序，尽管我[`py2exe`](http://www.py2exe.org/)过去使用过并取得了不同程度的成功。我将如何混淆代码？我可以以某种方式只部署字节码吗？

一个理想的解决方案不会危及我的知识产权（源代码），不需要直接安装 Python（尽管我确信它需要有一些嵌入式解释器），并且是跨平台的（Windows、Mac 和Linux）。有谁知道这方面的任何工具或资源？

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-02T20:02:01.880

您可以分发已编译的 Python 字节码（.pyc 文件）而不是源代码。您无法阻止在 Python（或任何其他语言，真的）中进行反编译。您可以使用[pyobfuscate](http://www.lysator.liu.se/~astrand/projects/pyobfuscate/)之类的混淆器，让竞争对手更讨厌破译您的反编译源。

正如 Alex Martelli[在这个线程](http://mail.python.org/pipermail/python-list/2006-April/1079623.html)中所说，如果你想对你的代码保密，你不应该在其他人的机器上运行它。

IIRC，我上次使用[cx_Freeze](http://python.net/crew/atuining/cx_Freeze/)时，它​​为 Windows 创建了一个 DLL，消除了安装本机 Python 的必要性。这至少值得一试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T19:56:36.077

哇，里面有很多问题：

*   可以直接从 Python 解释器运行字节码 (.pyc) 文件，但我还没有看到任何可用的字节码混淆工具。

*   我不知道有任何“一体化”部署解决方案，但是：

    *   对于 Windows，您可以使用 NSIS（[http://nsis.sourceforge.net/Main_Page](http://nsis.sourceforge.net/Main_Page)）。这里的问题是，虽然 OSX/*nix 带有 python，但 Windows 没有。如果您不愿意使用 py2exe 构建二进制文件，我不确定 Python 运行时环境的分发会涉及哪些许可问题（更不用说技术问题了）。

    *   您可以使用“bundle”格式打包 OS X 发行版，*NIX 有自己的安装软件约定——通常是“make install”脚本。

希望这会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T10:57:05.343

也许 IronPython 可以为您提供一些东西？我敢打赌那些 .exe/.dll 文件可以被锁定。不确定这些功能在单声道上是如何工作的，因此不知道这在 Linux/OS X 上是如何工作的......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T11:37:20.897

我一直在 Windows 上成功使用 py2exe。代码需要稍作修改，以便代码分析获取所需的所有模块，但除此之外，它还可以工作。

至于 Linux，有几种重要的分发格式：

*   DEB（Debian、Ubuntu 和其他衍生产品）
*   RPM（RedHat、Fedora、openSuSE）

制作 DEB 并不是特别困难，尤其是当您已经在使用 distutils/setuptools 时。[政策文档](http://wiki.debian.org/DebianPython/NewPolicy)中给出了一些提示，可以在[存储库](http://svn.debian.org/wsvn/python-apps/packages/)中找到打包 Python 应用程序的示例。

我对 RPM 没有任何经验，但我确信有足够的例子可以找到。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-07T09:55:15.293

尝试使用 scraZ 混淆器 ( [http://scraZ.me](http://scraZ.me) )。这是字节码的混淆器，而不是源代码。免费版有很好的，但不是完美的混淆方法。PRO版本对字节码有非常非常强大的保护。（在字节码混淆后，不可能进行反编译）

# language-agnostic - 寄存器与堆栈

> ID：164143
> 
> 赞同：73
> 
> 时间：2008-10-02T19:32:50.437
> 
> 标签：language-agnostic, vm-implementation, stack-based

使用基于寄存器的虚拟机与使用基于堆栈的虚拟机相比，究竟有哪些优缺点？

对我来说，基于寄存器的机器似乎更易于编程和更高效。那么为什么 JVM、CLR 和 Python VM 都是基于堆栈的呢？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-02T19:43:47.433

在硬件中实现的基于寄存器的机器将更加高效，这仅仅是因为对较慢 RAM 的访问更少。然而，在软件中，即使是基于寄存器的架构也很可能在 RAM 中具有“寄存器”。在这种情况下，基于堆栈的机器将同样有效。

此外，基于堆栈的 VM 将使编写编译器变得更加容易。您不必处理寄存器分配策略。本质上，您可以使用无限数量的寄存器。

**更新：**我假设一个解释的虚拟机写了这个答案。对于 JIT 编译的 VM，它可能不成立。我遇到了[这篇论文](http://static.usenix.org/events/vee05/full_papers/p153-yunhe.pdf)，这似乎表明 JIT 编译的 VM 使用寄存器架构可能更有效。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-10-02T21:53:11.553

Parrot VM 的常见问题解答和相关文档中已经在一定程度上回答了这个问题： [A Parrot Overview](http://www.parrotcode.org/docs/overview.html) 该文档中的相关文本是这样的：

> Parrot VM 将具有寄存器架构，而不是堆栈架构。它还将具有极低级别的操作，比 Perl 和 Python 等中级操作更类似于 Java。
> 
> 这个决定的原因主要是通过在某种程度上类似于底层硬件，可以将 Parrot 字节码编译成高效的本地机器语言。
> 
> 此外，许多高级语言的程序由嵌套的函数和方法调用组成，有时使用词法变量来保存中间结果。在非 JIT 设置下，基于堆栈的 VM 将多次弹出然后推送相同的操作数，而基于寄存器的 VM 将简单地分配正确数量的寄存器并对其进行操作，这可以显着减少操作量和 CPU 时间。

您可能还想阅读以下内容：[解释器设计的寄存器与堆栈](http://www.sidhe.org/%7Edan/blog/archives/000189.html) 稍微引用一​​下：

> 毫无疑问，为堆栈机器生成代码更容易。大多数大一编译器学生都可以做到这一点。为寄存器机器生成代码有点困难，除非你把它当作一个带有累加器的堆栈机器。（这是可行的，尽管从性能的角度来看不太理想）定位的简单性并不是什么大不了的事，至少对我来说不是，部分原因是实际上很少有人会直接定位它——我的意思是，来吧，你知道有多少人真正尝试为任何人都会关心的事情编写编译器？数字很​​小。另一个问题是，许多具有编译器知识的人已经习惯了以寄存器机器为目标，因为这就是所有常用的硬件 CPU。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2011-03-11T11:58:53.680

传统上，虚拟机实现者更喜欢基于堆栈的架构而不是基于寄存器的架构，因为“VM 实现的简单性”易于编写编译器后端 - 大多数 VM 最初设计为托管单一语言和代码密度以及堆栈架构的可执行文件总是小于寄存器架构的可执行文件。简单性和代码密度是性能的代价。

研究表明，与基于堆栈的体系结构相比，基于寄存器的架构需要执行的 VM 指令平均减少 47%，并且寄存器代码比相应的堆栈代码大 25%，但由于代码较大，这会增加获取更多 VM 指令的成本每个 VM 指令的大小仅涉及​​ 1.07% 的额外实际机器负载，可以忽略不计。基于寄存器的 VM 的整体性能是执行标准基准测试所需的时间平均减少了 32.3%。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-02T19:52:11.577

构建基于堆栈的 VM 的一个原因是实际的 VM 操作码可以更小更简单（无需编码/解码操作数）。这使生成的代码更小，也使 VM 代码更简单。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-02T19:38:18.880

你需要多少个寄存器？

我可能还需要至少一个。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-02T20:35:17.667

对我来说，“基于寄存器”的虚拟机会“更直接地编程”或“更高效”对我来说并不明显。也许您认为虚拟寄存器会在 JIT 编译阶段提供捷径？情况肯定不是这样，因为真正的处理器可能比 VM 有更多或更少的寄存器，并且这些寄存器可能以不同的方式使用。（例如：将要递减的值最好放在 x86 处理器上的 ECX 寄存器中。）如果真机的寄存器比 VM 多，那么您浪费的资源更少，而且使用“寄存器”没有任何收获基于”的编程。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-14T22:03:45.033

基于堆栈的虚拟机更简单，代码更紧凑。作为一个真实的例子，一个朋友（大约 30 年前）在 Cosmac 上用自制的 Forth VM 构建了一个数据记录系统。Forth VM 是在具有 2k ROM 和 256 字节 RAM 的机器上的 30*字节代码。*

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-02T20:01:14.723

基于堆栈的 VM 更容易为其生成代码。

基于寄存器的 VM 更容易为其创建快速实现，并且更容易为其生成高度优化的代码。

对于您的第一次尝试，我建议从基于堆栈的 VM 开始。

# c# - 比较两个 DataTables 以确定其中一个而不是另一个中的行

> ID：164144
> 
> 赞同：18
> 
> 时间：2008-10-02T19:33:12.997
> 
> 标签：c#, datatable

我有两个从 CSV 文件生成的 DataTables`A`和`B`。我需要能够检查哪些行存在于哪些行中`B`不存在于`A`.

有没有办法进行某种查询来显示不同的行，或者我必须遍历每个 DataTable 上的每一行以检查它们是否相同？如果表变大，后一种选择似乎非常密集。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-02T20:19:48.377

假设你有一个适当类型的 ID 列（即给出一个哈希码并实现相等） - 在这个例子中是字符串，它有点伪代码，因为我对 DataTables 不太熟悉并且没有时间查看它刚刚起来:)

```
IEnumerable<string> idsInA = tableA.AsEnumerable().Select(row => (string)row["ID"]);
IEnumerable<string> idsInB = tableB.AsEnumerable().Select(row => (string)row["ID"]);
IEnumerable<string> bNotA = idsInB.Except(idsInA); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-02T19:55:02.990

> 我是否必须遍历每个 DataTable 上的每一行以检查它们是否相同。

当您从 CSV 文件加载数据时，您不会有任何索引或任何东西，因此在某些时候，必须遍历每一行，无论是您的代码还是库， 管他呢。

无论如何，这是一个算法问题，这不是我的专长，但我的幼稚方法如下：

1：你能利用数据的任何属性吗？每个表中的所有行是否都是唯一的，您可以按照相同的标准对它们进行排序吗？如果是这样，您可以这样做：

*   按 ID 对两个表进行排序（使用一些有用的东西，例如快速排序）。如果他们已经排序，那么你就赢了。
*   一次遍历两个表，跳过任一表中 ID 的任何间隙。匹配 ID 的平均重复记录。

这使您可以在 (sort time * 2 ) + 一次通过中完成，所以如果我的 big-O-notation 是正确的，那就是 (whatever-sort-time) + O(m+n) 非常好.
（修订：这是[ΤZΩΤZΙΟΥ描述](https://stackoverflow.com/questions/164144/c-how-to-compare-two-datatables-a-b-how-to-show-rows-which-are-in-b-but-not-in-a#164213)的方法）

2：另一种方法，它可能或多或少取决于您的数据有多大：

*   遍历表 1，对于每一行，将其 ID（或计算的哈希码，或该行的某些其他唯一 ID）粘贴到字典（或哈希表，如果您更喜欢这样称呼它）。
*   遍历表 2，对于每一行，查看字典中是否存在 ID（或哈希码等）。您正在利用字典速度非常快的事实 - 我认为是 O(1)？抬头。这一步会非常快，但你会付出所有这些字典插入的代价。

我真的很想看看比我更了解算法的人会为这个提出什么:-)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-02T19:46:10.140

您可以使用 DataTable 上的 Merge 和 GetChanges 方法来执行此操作：

```
A.Merge(B); // this will add to A any records that are in B but not A
return A.GetChanges(); // returns records originally only in B 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-02T20:29:39.287

到目前为止的答案假设您只是在寻找重复的主键。这是一个非常简单的问题——例如，您可以使用 Merge() 方法。

但我理解您的问题意味着您正在寻找重复的 DataRows。（根据您对问题的描述，两个表都是从 CSV 文件导入的，我什至假设原始行没有主键值，并且在导入期间通过自动编号分配了任何主键。）

幼稚的实现（对于 A 中的每一行，将其 ItemArray 与 B 中的每一行进行比较）确实在计算上会很昂贵。

一种更便宜的方法是使用散列算法。对于每个 DataRow，将其列的字符串值连接成一个字符串，然后对该字符串调用 GetHashCode() 以获取一个 int 值。为 DataTable B 中的每个 DataRow创建一个`Dictionary<int, DataRow>`包含以哈希码为键的条目。然后，对于 DataTable A 中的每个 DataRow，计算哈希码，并查看它是否包含在字典中。如果不是，您知道 DataRow 在 DataTable B 中不存在。

这种方法有两个弱点，这两个弱点都源于两个字符串可能不相等但产生相同的哈希码。如果您在 A 中找到一行其哈希在字典中，则需要检查字典中的 DataRow 以验证这两行是否真的相等。

第二个弱点更严重：B 中的两个不同 DataRows 不太可能但有可能散列到相同的键值。出于这个原因，字典实际上应该是 a `Dictionary<int, List<DataRow>>`，并且您应该对列表中的每个 DataRow 执行上一段中描述的检查。

让它工作需要做大量的工作，但它是一个 O(m+n) 算法，我认为它会尽可能好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T19:47:16.720

仅供参考：

一般来说，关于算法，比较两组可排序的（通常是 id）不是 O(M*N/2) 操作，但如果这两组是有序的，则 O(M+N) 操作。因此，您使用指向另一个表开头的指针扫描一个表，并且：

```
other_item= A.first()
only_in_B= empty_list()
for item in B:
    while other_item > item:
        other_item= A.next()
        if A.eof():
             only_in_B.add( all the remaining B items)
             return only_in_B
    if item < other_item:
         empty_list.append(item)
return only_in_B 
```

上面的代码显然是伪代码，但如果您决定自己编写代码，应该会给您大致的要点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-03T10:36:59.860

感谢所有的反馈。

不幸的是，我没有任何索引。我将提供更多关于我的情况的信息。

我们有一个报告程序（替换 Crystal 报告）安装在整个欧盟的 7 台服务器中。这些服务器有很多关于它们的报告（每个国家/地区并不完全相同）。它们由使用 XML 文件进行配置的命令行应用程序调用。所以一个 XML 文件可以调用多个报告。

命令行应用程序由我们的通宵进程安排和控制。因此可以从多个位置调用 XML 文件。

CSV 的目标是生成所有正在使用的报告以及调用它们的位置的列表。

我正在浏览所有参考的 XML 文件，查询调度程序并生成所有报告的列表。（这还不错）。

我遇到的问题是我必须保留所有可能已从生产中删除的报告的列表。所以我需要将旧的 CSV 与新的数据进行比较。为此，我认为最好将其放入 DataTables 并比较信息（这可能是错误的方法。我想我可以创建一个保存它的对象并比较差异然后创建迭代它们）。

我对每份报告的数据如下：

String - 任务名称 String - 动作名称 Int - ActionID（动作 ID 可以在多个记录中，因为单个动作可以调用多个报告，即 XML 文件）。字符串 - 名为字符串的 XML 文件 - 报告名称

我将尝试 MusiGenesis 给出的 Merge 想法（谢谢）。（重读一些帖子不确定合并是否会起作用，但值得一试，因为我以前没有听说过它，所以需要学习一些新东西）。

HashCode 的想法听起来也很有趣。

感谢所有的建议。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-18T05:00:17.113

```
public DataTable compareDataTables(DataTable First, DataTable Second)
{
        First.TableName = "FirstTable";
        Second.TableName = "SecondTable";

        //Create Empty Table
        DataTable table = new DataTable("Difference");
        DataTable table1 = new DataTable();
        try
        {
            //Must use a Dataset to make use of a DataRelation object
            using (DataSet ds4 = new DataSet())
            {
                //Add tables
                ds4.Tables.AddRange(new DataTable[] { First.Copy(), Second.Copy() });

                //Get Columns for DataRelation
                DataColumn[] firstcolumns = new DataColumn[ds4.Tables[0].Columns.Count];
                for (int i = 0; i < firstcolumns.Length; i++)
                {
                    firstcolumns[i] = ds4.Tables[0].Columns[i];
                }
                DataColumn[] secondcolumns = new DataColumn[ds4.Tables[1].Columns.Count];
                for (int i = 0; i < secondcolumns.Length; i++)
                {
                    secondcolumns[i] = ds4.Tables[1].Columns[i];
                }
                //Create DataRelation
                DataRelation r = new DataRelation(string.Empty, firstcolumns, secondcolumns, false);
                ds4.Relations.Add(r);
                //Create columns for return table
                for (int i = 0; i < First.Columns.Count; i++)
                {
                    table.Columns.Add(First.Columns[i].ColumnName, First.Columns[i].DataType);
                }
                //If First Row not in Second, Add to return table.
                table.BeginLoadData();
                foreach (DataRow parentrow in ds4.Tables[0].Rows)
                { 
                    DataRow[] childrows = parentrow.GetChildRows(r);

                    if (childrows == null || childrows.Length == 0)
                        table.LoadDataRow(parentrow.ItemArray, true);
                    table1.LoadDataRow(childrows, false);

                }
                table.EndLoadData();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
        return table;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-07-09T22:48:32.343

我找到了一个简单的方法来解决这个问题。与以前的“例外方法”答案不同，我使用了两次例外方法。这不仅告诉您删除了哪些行，还告诉您添加了哪些行。如果您只使用一种 except 方法 - 它只会告诉您一种差异，而不是两者。此代码经过测试并且可以工作。见下文

```
//Pass in your two datatables into your method

        //build the queries based on id.
        var qry1 = datatable1.AsEnumerable().Select(a => new { ID = a["ID"].ToString() });
        var qry2 = datatable2.AsEnumerable().Select(b => new { ID = b["ID"].ToString() });

        //detect row deletes - a row is in datatable1 except missing from datatable2
        var exceptAB = qry1.Except(qry2);

        //detect row inserts - a row is in datatable2 except missing from datatable1
        var exceptAB2 = qry2.Except(qry1); 
```

然后根据结果执行您的代码

```
 if (exceptAB.Any())
        {
            foreach (var id in exceptAB)
            {
   //execute code here
            }

        }
        if (exceptAB2.Any())
        {
            foreach (var id in exceptAB2)
            {
//execute code here
            }

        } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-06-30T18:28:29.007

您不能在将 CSV 文件加载到 DataTables*之前简单地比较它们吗？*

```
string[] a = System.IO.File.ReadAllLines(@"cvs_a.txt");
string[] b = System.IO.File.ReadAllLines(@"csv_b.txt");

// get the lines from b that are not in a
IEnumerable<string> diff = b.Except(a);

//... parse b into DataTable ... 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T05:03:04.673

```
 try
        {
            if (ds.Tables[0].Columns.Count == ds1.Tables[0].Columns.Count)
            {
               for (int i = 0; i < ds.Tables[0].Rows.Count; i++)
               {
                    for (int j = 0; j < ds.Tables[0].Columns.Count; j++)
                   {
       if (ds.Tables[0].Rows[i][j].ToString() == ds1.Tables[0].Rows[i][j].ToString())
                       {

                        }
                        else
                        {

                           MessageBox.Show(i.ToString() + "," + j.ToString());

                       }

                                               }

                }

            }
            else
            {
               MessageBox.Show("Table has different columns ");
            }
        }
        catch (Exception)
        {
           MessageBox.Show("Please select The Table");
        } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-01-29T18:33:45.283

我继续 tzot 的想法...

如果你有两个可排序的集合，那么你可以使用：</p>

```
List<string> diffList = new List<string>(sortedListA.Except(sortedListB)); 
```

如果您需要更复杂的对象，您可以自己定义一个比较器并仍然使用它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-08-13T09:11:39.350

通常的使用场景考虑的是一个用户，他`DataTable`手头上有一个并通过添加、删除或修改一些`DataRows`.

执行更改后，将`DataTable`知道`DataRowState`每一行的正确性，并跟踪`Original` `DataRowVersion`已更改的任何行。

在这种通常情况下，可以`Merge`将更改返回到源表（其中所有行都是`Unchanged`）。合并后，可以通过调用`GetChanges()`.

在更不寻常的情况下，用户有两个`DataTables`具有相同架构（或者可能只有相同的列并且缺少主键）。这两个`DataTables`仅包含`Unchanged`行。用户可能想找出他需要对两个表之一应用什么更改才能到达另一个表。也就是说，需要添加、删除或修改哪些行。

我们在这里定义了一个函数`GetDelta()`来完成这项工作：

```
using System;
using System.Data;
using System.Xml;
using System.Linq;
using System.Collections.Generic;
using System.Data.DataSetExtensions;

public class Program
{
    private static DataTable GetDelta(DataTable table1, DataTable table2)
    {
        // Modified2 : row1 keys match rowOther keys AND row1 does not match row2:
        IEnumerable<DataRow> modified2 = (
            from row1 in table1.AsEnumerable()
            from row2 in table2.AsEnumerable()
            where table1.PrimaryKey.Aggregate(true, (boolAggregate, keycol) => boolAggregate & row1[keycol].Equals(row2[keycol.Ordinal]))
                  && !row1.ItemArray.SequenceEqual(row2.ItemArray)
            select row2);

        // Modified1 :
        IEnumerable<DataRow> modified1 = (
            from row1 in table1.AsEnumerable()
            from row2 in table2.AsEnumerable()
            where table1.PrimaryKey.Aggregate(true, (boolAggregate, keycol) => boolAggregate & row1[keycol].Equals(row2[keycol.Ordinal]))
                  && !row1.ItemArray.SequenceEqual(row2.ItemArray)
            select row1);

        // Added : row2 not in table1 AND row2 not in modified2
        IEnumerable<DataRow> added = table2.AsEnumerable().Except(modified2, DataRowComparer.Default).Except(table1.AsEnumerable(), DataRowComparer.Default);

        // Deleted : row1 not in row2 AND row1 not in modified1
        IEnumerable<DataRow> deleted = table1.AsEnumerable().Except(modified1, DataRowComparer.Default).Except(table2.AsEnumerable(), DataRowComparer.Default);

        Console.WriteLine();
        Console.WriteLine("modified count =" + modified1.Count());
        Console.WriteLine("added count =" + added.Count());
        Console.WriteLine("deleted count =" + deleted.Count());

        DataTable deltas = table1.Clone();

        foreach (DataRow row in modified2)
        {
            // Match the unmodified version of the row via the PrimaryKey
            DataRow matchIn1 = modified1.Where(row1 =>  table1.PrimaryKey.Aggregate(true, (boolAggregate, keycol) => boolAggregate & row1[keycol].Equals(row[keycol.Ordinal]))).First();
            DataRow newRow = deltas.NewRow();

            // Set the row with the original values
            foreach(DataColumn dc in deltas.Columns)
                newRow[dc.ColumnName] = matchIn1[dc.ColumnName];
            deltas.Rows.Add(newRow);
            newRow.AcceptChanges();

            // Set the modified values
            foreach (DataColumn dc in deltas.Columns)
                newRow[dc.ColumnName] = row[dc.ColumnName];
            // At this point newRow.DataRowState should be : Modified
        }

        foreach (DataRow row in added)
        {
            DataRow newRow = deltas.NewRow();
            foreach (DataColumn dc in deltas.Columns)
                newRow[dc.ColumnName] = row[dc.ColumnName];
            deltas.Rows.Add(newRow);
            // At this point newRow.DataRowState should be : Added
        }

        foreach (DataRow row in deleted)
        {
            DataRow newRow = deltas.NewRow();
            foreach (DataColumn dc in deltas.Columns)
                newRow[dc.ColumnName] = row[dc.ColumnName];
            deltas.Rows.Add(newRow);
            newRow.AcceptChanges();
            newRow.Delete();
            // At this point newRow.DataRowState should be : Deleted
        }

        return deltas;
    }

    private static void DemonstrateGetDelta()
    {
        DataTable table1 = new DataTable("Items");

        // Add columns
        DataColumn column1 = new DataColumn("id1", typeof(System.Int32));
        DataColumn column2 = new DataColumn("id2", typeof(System.Int32));
        DataColumn column3 = new DataColumn("item", typeof(System.Int32));
        table1.Columns.Add(column1);
        table1.Columns.Add(column2);
        table1.Columns.Add(column3);

        // Set the primary key column.
        table1.PrimaryKey = new DataColumn[] { column1, column2 };

        // Add some rows.
        DataRow row;
        for (int i = 0; i <= 4; i++)
        {
            row = table1.NewRow();
            row["id1"] = i;
            row["id2"] = i*i;
            row["item"] = i;
            table1.Rows.Add(row);
        }

        // Accept changes.
        table1.AcceptChanges();
        PrintValues(table1, "table1:");

        // Create a second DataTable identical to the first.
        DataTable table2 = table1.Clone();

        // Add a row that exists in table1:
        row = table2.NewRow();
        row["id1"] = 0;
        row["id2"] = 0; 
        row["item"] = 0;
        table2.Rows.Add(row);

        // Modify the values of a row that exists in table1:
        row = table2.NewRow();
        row["id1"] = 1;
        row["id2"] = 1;
        row["item"] = 455;
        table2.Rows.Add(row);

        // Modify the values of a row that exists in table1:
        row = table2.NewRow();
        row["id1"] = 2;
        row["id2"] = 4;
        row["item"] = 555;
        table2.Rows.Add(row);

        // Add a row that does not exist in table1:
        row = table2.NewRow();
        row["id1"] = 13;
        row["id2"] = 169;
        row["item"] = 655;
        table2.Rows.Add(row);

        table2.AcceptChanges();

        Console.WriteLine();
        PrintValues(table2, "table2:");

        DataTable delta = GetDelta(table1,table2);

        Console.WriteLine();
        PrintValues(delta,"delta:");

        // Verify that the deltas DataTable contains the adequate Original DataRowVersions:
        DataTable originals = table1.Clone();
        foreach (DataRow drow in delta.Rows)
        {
            if (drow.RowState != DataRowState.Added)
            {
                DataRow originalRow = originals.NewRow();
                foreach (DataColumn dc in originals.Columns)
                    originalRow[dc.ColumnName] = drow[dc.ColumnName, DataRowVersion.Original];
                originals.Rows.Add(originalRow);
            }
        }
        originals.AcceptChanges();

        Console.WriteLine();
        PrintValues(originals,"delta original values:");
    }

    private static void Row_Changed(object sender, 
        DataRowChangeEventArgs e)
    {
        Console.WriteLine("Row changed {0}\t{1}", 
            e.Action, e.Row.ItemArray[0]);
    }

    private static void PrintValues(DataTable table, string label)
    {
        // Display the values in the supplied DataTable:
        Console.WriteLine(label);
        foreach (DataRow row in table.Rows)
        {
            foreach (DataColumn col in table.Columns)
            {
                Console.Write("\t " + row[col, row.RowState == DataRowState.Deleted ? DataRowVersion.Original : DataRowVersion.Current].ToString());
            }
            Console.Write("\t DataRowState =" + row.RowState);
            Console.WriteLine();
        }
    }

    public static void Main()
    {
        DemonstrateGetDelta();
    }
} 
```

上面的代码可以在[https://dotnetfiddle.net/](https://dotnetfiddle.net/)中测试。结果输出如下所示：

```
table1:
     0     0     0     DataRowState =Unchanged
     1     1     1     DataRowState =Unchanged
     2     4     2     DataRowState =Unchanged
     3     9     3     DataRowState =Unchanged
     4     16     4     DataRowState =Unchanged

table2:
     0     0     0     DataRowState =Unchanged
     1     1     455     DataRowState =Unchanged
     2     4     555     DataRowState =Unchanged
     13     169     655     DataRowState =Unchanged

modified count =2
added count =1
deleted count =2

delta:
     1     1     455     DataRowState =Modified
     2     4     555     DataRowState =Modified
     13     169     655     DataRowState =Added
     3     9     3     DataRowState =Deleted
     4     16     4     DataRowState =Deleted

delta original values:
     1     1     1     DataRowState =Unchanged
     2     4     2     DataRowState =Unchanged
     3     9     3     DataRowState =Unchanged
     4     16     4     DataRowState =Unchanged 
```

请注意，如果您的表没有`PrimaryKey`，`where`则 LINQ 查询中的子句会稍微简化一些。我会让你自己弄清楚。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-05-26T08:51:10.237

只需使用 linq 即可实现。

```
private DataTable CompareDT(DataTable TableA, DataTable TableB)
    {
        DataTable TableC = new DataTable();
        try
        {

            var idsNotInB = TableA.AsEnumerable().Select(r => r.Field<string>(Keyfield))
            .Except(TableB.AsEnumerable().Select(r => r.Field<string>(Keyfield)));
            TableC = (from row in TableA.AsEnumerable()
                      join id in idsNotInB
                      on row.Field<string>(ddlColumn.SelectedItem.ToString()) equals id
                      select row).CopyToDataTable();
        }
        catch (Exception ex)
        {
            lblresult.Text = ex.Message;
            ex = null;
         }
        return TableC;

    } 
```

# javascript - Internet Explorer TextRange 中的字符偏移

> ID：164147
> 
> 赞同：4
> 
> 时间：2008-10-02T19:34:12.103
> 
> 标签：javascript, html, internet-explorer, selection, dhtml

据我所知，没有简单的方法可以从 Internet Explorer 中的 TextRange 对象中检索字符偏移量。W3C Range 对象有一个节点，以及该节点内文本的偏移量。IE 似乎只有像素偏移。有创建、扩展和比较范围的方法，因此可以编写一个算法来计算字符偏移量，但我觉得我一定遗漏了一些东西。

那么，计算 Internet Explorer TextRange 开头的字符偏移量的最简单方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T18:03:24.037

我使用基于此插入符号位置技巧的方法：

```
// Assume r is a range:
var offsetFromBody = Math.abs( r.moveEnd('character', -1000000) ); 
```

由于 moveEnd 返回实际移动的字符数，因此 offset 现在应该是距文档开头的偏移量。这适用于测试原始插入符号移动，但对于扩展选择和获取包含范围锚的确切节点，您需要更复杂的东西：

```
// where paramter r is a range:
function getRangeOffsetIE( r ) {
  var end = Math.abs( r.duplicate().moveEnd('character', -1000000) );
  // find the anchor element's offset
  var range = r.duplicate();
  r.collapse( false );
  var parentElm = range.parentElement();
  var children = parentElm.getElementsByTagName('*');
  for (var i = children.length - 1; i >= 0; i--) {
    range.moveToElementText( children[i] );
    if ( range.inRange(r) ) {
      parentElm = children[i];
      break;
    }
  }
  range.moveToElementText( parentElm );
  return end - Math.abs( range.moveStart('character', -1000000) );
} 
```

这应该返回正确的插入符号文本偏移量。当然，如果您已经知道目标节点，或者能够提供上下文，那么您可以跳过整个循环搜索混乱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-26T01:30:56.597

我建议[IERange](http://code.google.com/p/ierange/)，或者只是它的`TextRange`-to-`DOM Range`算法。

## 更新，2011 年 8 月 9 日

我现在建议使用我自己的[Rangy](http://code.google.com/p/rangy)库，它在想法上与 IERange 相似，但更全面地实现和支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-25T12:57:38.793

我使用了一个稍微简单的解决方案，使用了 textRange 的偏移值：

```
function getIECharOffset() {
  var offset = 0;

  // get the users selection - this handles empty selections
  var userSelection = document.selection.createRange();

  // get a selection from the contents of the parent element
  var parentSelection = userSelection.parentElement().createTextRange();

  // loop - moving the parent selection on a character at a time until the offsets match
  while (!offsetEqual(parentSelection, userSelection)) {
    parentSelection.move('character');
    offset++;
  }

  // return the number of char you have moved through
  return offset;
}

function offsetEqual(arg1, arg2) {
  if (arg1.offsetLeft == arg2.offsetLeft && arg1.offsetTop == arg2.offsetTop) {
    return true;
  }
  return false;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T20:13:54.147

您可以遍历 body 元素的`TextRange.text`属性，使用`String.substring()`它与您想要字符偏移的 TextRange 进行比较。

```
function charOffset(textRange, parentTextRange)
 { var parentTxt = parentTextRange.text;
   var txt       = textRange.text;
   var parentLen = parentTxt.length;

   for(int i=0; i < parentLen ; ++i) 
    { if (parentTxt.substring(i, txt.length+i) == txt) 
       { var originalPosition = textRange.getBookmark();

         //moves back one and searches backwards for same text
         textRange.moveStart("character",-1);
         var foundOther = textRange.findText(textRange.text,-parentLen,1);

         //if no others were found return offset
         if (!foundOther) return i;

         //returns to original position to try next offset
         else textRange.moveToBookmark(originalPosition);
       }
    }

   return -1;
 } 
```

[[参考`findText()`](http://msdn.microsoft.com/en-us/library/ms536422(VS.85).aspx)]

# sql-server - 是否有用于平均执行时间的 SQL Server 性能计数器？

> ID：164154
> 
> 赞同：5
> 
> 时间：2008-10-02T19:35:41.897
> 
> 标签：sql-server, performance

我想调整生产 SQL 服务器。进行调整（例如更改并行度）后，我想知道它是否有助于或损害查询执行时间。

这似乎是一个明显的性能计数器，但在过去的半小时里，我一直在搜索 Google 和 perfmon 中的计数器列表，但我无法找到 SQL Server 的性能计数器来给我所有的平均执行时间查询命中服务器。ASP.NET 请求执行时间的 SQL Server 等效项。

是否存在我缺少的一个？是否有另一种有效的方法来监控服务器的平均查询时间？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T11:30:21.890

我不相信有 PerfMon，但 SQL Server Management Studio 中有一份报告：

右键单击数据库，选择**Reports > Standard Reports > Object Execution Statistics**。这将为您提供一些关于数据库中正在运行的内容、花费多长时间、需要多少内存/io 处理等的非常好的统计信息。

您还可以在所有数据库的服务器级别上运行它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T20:15:02.600

您可以使用查询分析器（它是 SQL Server 的工具之一）并查看它们是如何在内部执行的，以便您可以优化索引等。这不会告诉您平均值或返回客户端的往返行程。为此，您必须将其登录到客户端并自己分析数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-14T01:44:58.500

我设法通过将跟踪保存到 SQL 来做到这一点。跟踪打开时

`File`> `Save As`>`Trace Table`

选择 SQL，并在其导入后运行

```
select avg(duration) from dbo.[YourTableImportName] 
```

您可以非常轻松地执行其他统计数据、最大值、最小值、计数等...查询跟踪结果的更好方法

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-02-10T10:08:49.027

另一种解决方案是多次运行查询并获得平均查询时间：

```
DO $proc$
DECLARE
    StartTime timestamptz;
    EndTime timestamptz;
    Delta double precision;
BEGIN
    StartTime := clock_timestamp();
    FOR i IN 1..100 LOOP
        PERFORM * FROM table_name;
    END LOOP;
    EndTime := clock_timestamp();
    Delta := 1000 * (extract(epoch FROM EndTime) - extract(epoch FROM StartTime)) / 100;
    RAISE NOTICE 'Average duration in ms = %', Delta;
END;
$proc$; 
```

在这里，它运行了 100 次查询：

```
PERFORM * FROM table_name; 
```

只需替换`SELECT`为`PERFORM`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T21:53:10.537

分析器将为您提供有关服务器上查询执行时间和活动的统计信息。如果不将它们与特定的作业和查询计划联系起来，总体查询时间可能会或可能不会很重要。

其他性能瓶颈指标是资源争用计数器（一般统计信息、锁存器、锁）。您可以通过性能计数器看到这些。此外，寻找大量表扫描或其他不使用索引的操作可以告诉您索引可能是必要的。

在加载的服务器上，增加并行性不太可能对性能产生重大影响，因为在任何给定时间已经有许多查询处于活动状态。并行性使您获胜的地方在于不经常运行的大型批处理作业，例如 ETL 流程。如果您需要减少此类进程的运行时间，那么并行性可能是一个不错的选择。在繁忙的服务器上，与许多用户一起处理事务性工作负载时，系统资源将因工作负载而忙碌，因此并行性不太可能成为大赢家。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T19:53:32.527

什么时间和哪些查询的平均值？您需要进一步定义“平均”的含义，否则它没有意义，这可能就是为什么它不是简单的性能计数器的原因。

您可以通过运行跟踪来捕获此信息，将其捕获到表中，然后您可以以多种方式之一对执行时间进行切片和切块。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T21:01:13.377

它不能完全满足您的需要，但我强烈建议您尝试 SQL Server 2005 性能仪表板报告，可以在[此处](http://www.microsoft.com/downloads/details.aspx?FamilyId=1d3a4a0d-7e0c-4730-8204-e419218c1efc&displaylang=en)下载。它包括前 20 个查询及其平均执行时间的报告，以及许多其他有用的查询（按 IO 排列的热门查询、等待统计信息等）。如果您确实安装它，请务必记下它的安装位置并按照“附加信息”部分中的说明进行操作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-06-12T03:56:15.430

您可以使用**活动监视器**。它内置在 SSMS 中。它将让您实时跟踪服务器上所有当前昂贵的查询。

打开**活动监视器**：

1.  在 Sql Server Management Studio (SSMS) 中，右键单击服务器并选择**Activity Monitor**。
2.  打开**最近的昂贵查询**以查看 CPU 使用率、平均查询时间等。

希望有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-08-05T21:10:47.137

'SQL Server:Batch Resp Statistics' 组中有计数器，可以跟踪 SQL 批处理响应时间。计数器根据响应时间间隔进行划分，例如，从 0 毫秒到 1 毫秒，...，从 10 毫秒到 20 毫秒，...，从 1000 毫秒到 2000 毫秒等等，因此可以选择合适的计数器所需的时间间隔。

希望能帮助到你。

# apache-flex - Flex 图形资源：SWF 还是 SWC？

> ID：164162
> 
> 赞同：12
> 
> 时间：2008-10-02T19:37:24.170
> 
> 标签：apache-flex, actionscript-3, flash, asset-management

为 Flex 应用程序、SWF 或 SWC 存储图形资源哪种格式更好？

是否有任何真正的差异，如果有，它们是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-07T05:27:40.643

单独 SWF 中的资源在运行时加载和包含。

SWC 中的资产在编译时被加载和包含/编译。

您还可以在编译时直接在主应用 SWF 中嵌入资产（查看嵌入元数据）。

当然，您也可以在运行时直接加载单个资源（例如 PNG）。

至于哪个更好，这实际上取决于您要做什么以及如何使用资产。

麦克风

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T21:39:54.750

SWC 是您在寻找要编译到您的应用程序中的库时使用的。您可以访问这些类并可以导入各个部分。在嵌入图形时，SWF 更有可能是您要查找的内容。

以下是您可能感兴趣的文档：

[http://livedocs.adobe.com/flex/3/html/help.html?content=layoutperformance_06.html#223998](http://livedocs.adobe.com/flex/3/html/help.html?content=layoutperformance_06.html#223998)

我在使用 SVG 处理图像方面取得了很大的成功，但是由于 Flex 只实现了一部分功能，因此有一些注意事项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T01:48:41.987

我没有这样做的真正理由，所以它可能不正确，但我通常为需要在运行时加载的东西创建 SWF，为需要在设计时可用的东西创建 SWC。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T18:28:45.047

SWC 只是一个 SWF 和一些打包到 zip 文件中的元数据。除了不支持 SWC 的运行时加载这一事实之外，我认为使用这两种格式之间没有任何重大区别。

# algorithm - 快速排序：选择枢轴

> ID：164163
> 
> 赞同：125
> 
> 时间：2008-10-02T19:37:42.500
> 
> 标签：algorithm, sorting, pseudocode, quicksort

在实现快速排序时，您必须做的一件事就是选择一个枢轴。但是当我看下面这样的伪代码时，我不清楚我应该如何选择枢轴。列表的第一个元素？还有什么？

```
 function quicksort(array)
     var list less, greater
     if length(array) ≤ 1  
         return array  
     select and remove a pivot value pivot from array
     for each x in array
         if x ≤ pivot then append x to less
         else append x to greater
     return concatenate(quicksort(less), pivot, quicksort(greater)) 
```

有人可以帮我理解选择支点的概念，以及不同的场景是否需要不同的策略。

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-10-02T19:41:36.657

选择随机枢轴可以最大限度地减少遇到最坏情况 O(n ² ) 性能的机会（总是选择第一个或最后一个会导致接近排序或接近反向排序数据的最坏情况性能）。在大多数情况下，选择中间元素也是可以接受的。

此外，如果您自己实现这一点，则存在就地工作的算法版本（即，无需创建两个新列表然后将它们连接起来）。

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2008-10-02T19:42:39.760

这取决于您的要求。随机选择一个支点会使创建产生 O(N^2) 性能的数据集变得更加困难。“三个中位数”（第一个、最后一个、中间）也是一种避免问题的方法。不过，请注意比较的相对表现；如果您的比较代价高昂，那么 Mo3 会进行比随机选择（单个枢轴值）更多的比较。比较数据库记录的成本可能很高。

* * *

更新：将评论纳入答案。

[mdkess](https://stackoverflow.com/users/31455/mdkess)断言：

> “3 的中位数”不是第一个最后一个中间值。选择三个随机索引，并取其中间值。关键是要确保您对枢轴的选择不是确定性的——如果是，则可以很容易地生成最坏情况的数据。

我对此作出回应：

*   [P Kirschenhofer、H Prodinger、C Martínez 对Hoare 的三分中位数查找算法的分析](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.39.1103)（1997 年）支持您的论点（“三分中位数”是三个随机项）。

*   portal.acm.org 上有一篇文章描述了Hannu [Erkiö](http://portal.acm.org/citation.cfm?id=1176.1243&coll=GUIDE&dl=GUIDE&CFID=20869026&CFTOKEN=55062919)的“The Worst Case Permutation for Median-of-Three Quicksort”，发表在 The Computer Journal，第 27 卷，第 3 期，1984 年。[更新 2012-02- 26：得到[文章](http://comjnl.oxfordjournals.org/content/27/3/276)的文字。第 2 节“算法”开始：“*通过使用 A[L:R] 的第一个、中间和最后一个元素的中值，可以在大多数实际情况下实现有效的划分为大小相当的部分。*'因此，它正在讨论第一个中间最后一个 Mo3 方法。]

*   另一篇有趣的短文是由 MD McIlroy 撰写的，[“A Killer Adversary for Quicksort”](http://www.cs.dartmouth.edu/~doug/mdmspe.pdf)，发表在 Software-Practice and Experience, Vol. 上。29（0），1-4（0 1999）。它解释了如何使几乎所有快速排序的行为都呈二次方。

*   AT&T 贝尔实验室技术杂志，1984 年 10 月“构建工作排序例程的理论与实践”指出，“Hoare 建议围绕几条随机选择的行的中值进行分区。Sedgewick [...] 建议选择第一个 [. ..] 最后 [...] 和中间”。这表明文献中已知两种用于“三中位数”的技术。（2014 年 11 月 23 日更新：这篇文章似乎可以从[IEEE Xplore](http://ieeexplore.ieee.org/iel7/6731004/6771897/06771921.pdf?arnumber=6771921)或[Wiley](http://onlinelibrary.wiley.com/doi/10.1002/j.1538-7305.1984.tb00067.x/abstract)获得——如果你有会员资格或准备付费的话。）

*   [JL Bentley 和 MD McIlroy 于 1993 年 11 月在 Software Practice and Experience 第 23(11) 卷中发表的“Engineering a Sort Function”](http://www.cs.fit.edu/~pkc/classes/writing/samples/bentley93engineering.pdf)对这些问题进行了广泛的讨论，他们选择了一种自适应分区算法，部分基于数据集的大小。有很多关于各种方法的权衡的讨论。

*   谷歌搜索“三中位数”非常适合进一步跟踪。

谢谢你提供的详情; 我以前只遇到过确定性的“三中位数”。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-02T19:46:49.420

呵呵，我刚教过这门课。

有几种选择。
简单：选择范围的第一个或最后一个元素。（对部分排序的输入不好）更好：选择范围中间的项目。（对部分排序的输入更好）

但是，选择任意元素存在将大小为 n 的数组划分为大小为 1 和 n-1 的两个数组的风险。如果你经常这样做，你的快速排序就有变成 O(n^2) 的风险。

我看到的一个改进是选择中位数（第一、最后、中间）；在最坏的情况下，它仍然可以达到 O(n^2)，但从概率上讲，这是一种罕见的情况。

对于大多数数据，选择第一个或最后一个就足够了。但是，如果你发现你经常遇到最坏的情况（部分排序的输入），第一个选择是选择中心值（对于部分排序的数据来说，这是一个统计上很好的支点）。

如果您仍然遇到问题，请走中间路线。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-25T21:50:38.060

永远不要选择一个固定的支点——这可能会被攻击以利用您算法的最坏情况 O(n ² ) 运行时，这只是自找麻烦。快速排序的最坏情况运行时发生在分区结果为一个包含 1 个元素的数组和一个包含 n-1 个元素的数组时。假设您选择第一个元素作为分区。如果有人向您的算法提供一个按降序排列的数组，那么您的第一个枢轴将是最大的，因此数组中的其他所有内容都将移动到它的左侧。然后当你递归时，第一个元素将再次成为最大的，所以你再一次把所有的东西都放在它的左边，依此类推。

更好的技术是**median-of-3 方法**，您可以在其中随机选择三个元素，然后选择中间值。你知道你选择的元素不会是第一个或最后一个，而且，根据中心极限定理，中间元素的分布将是正常的，这意味着你会倾向于中间（因此, nlog(n) 时间)。

如果您绝对想保证算法的 O(nlog(n)) 运行时间，那么用于查找数组中值的**columns-of-5 方法**在 O(n) 时间内运行，这意味着快速排序中的递归方程最坏的情况是：

```
T(n) = O(n) (find the median) + O(n) (partition) + 2T(n/2) (recurse left and right) 
```

根据主定理，这是 O(nlog(n))。然而，常数因子会很大，如果最坏情况下的性能是您最关心的问题，请改用合并排序，它平均只比快速排序慢一点，并保证 O(nlog(n)) 时间（并且将比这个蹩脚的中位数快速排序要快得多）。

[中位数算法的中位数说明](https://stackoverflow.com/questions/12545795/explanation-of-the-median-of-medians-algorithm)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-26T03:54:41.723

不要试图变得太聪明并结合枢轴策略。如果您通过选择第一个、最后一个和中间随机索引的中值来将 3 的中值与随机枢轴相结合，那么您仍然容易受到许多发送 3 二次方中值的分布的影响（所以它实际上比普通随机枢轴）

例如，管风琴分布 (1,2,3...N/2..3,2,1) 第一个和最后一个都为 1，随机索引将是大于 1 的某个数字，取中位数为 1 (第一个或最后一个），你会得到一个非常不平衡的分区。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-03-10T02:19:41.167

这样做更容易将快速排序分为三个部分

1.  交换或交换数据元素功能
2.  分区函数
3.  处理分区

它只比一个长函数效率低一点，但更容易理解。

代码如下：

```
/* This selects what the data type in the array to be sorted is */

#define DATATYPE long

/* This is the swap function .. your job is to swap data in x & y .. how depends on
data type .. the example works for normal numerical data types .. like long I chose
above */

void swap (DATATYPE *x, DATATYPE *y){  
  DATATYPE Temp;

  Temp = *x;        // Hold current x value
  *x = *y;          // Transfer y to x
  *y = Temp;        // Set y to the held old x value
};

/* This is the partition code */

int partition (DATATYPE list[], int l, int h){

  int i;
  int p;          // pivot element index
  int firsthigh;  // divider position for pivot element

  // Random pivot example shown for median   p = (l+h)/2 would be used
  p = l + (short)(rand() % (int)(h - l + 1)); // Random partition point

  swap(&list[p], &list[h]);                   // Swap the values
  firsthigh = l;                                  // Hold first high value
  for (i = l; i < h; i++)
    if(list[i] < list[h]) {                 // Value at i is less than h
      swap(&list[i], &list[firsthigh]);   // So swap the value
      firsthigh++;                        // Incement first high
    }
  swap(&list[h], &list[firsthigh]);           // Swap h and first high values
  return(firsthigh);                          // Return first high
};

/* Finally the body sort */

void quicksort(DATATYPE list[], int l, int h){

  int p;                                      // index of partition 
  if ((h - l) > 0) {
    p = partition(list, l, h);              // Partition list 
    quicksort(list, l, p - 1);        // Sort lower partion
    quicksort(list, p + 1, h);              // Sort upper partition
  };
}; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T19:42:50.757

如果您正在对一个可随机访问的集合（如数组）进行排序，通常最好选择物理中间项。有了这个，如果数组都准备好排序（或几乎排序），两个分区将接近偶数，您将获得最佳速度。

如果您正在对仅具有线性访问权限的内容（如链表）进行排序，那么最好选择第一个项目，因为它是访问速度最快的项目。然而，在这里，如果列表已经排序，那么你就搞砸了——一个分区将始终为空，而另一个分区拥有一切，从而产生了最糟糕的情况。

然而，对于链表，选择除第一个之外的任何内容只会让事情变得更糟。它选择列出列表中的中间项目，您必须在每个分区步骤中逐步完成它 - 添加一个 O(N/2) 操作，该操作完成 logN 次，总时间为 O(1.5 N *log N)那就是如果我们在开始之前就知道列表有多长——通常我们不知道，所以我们必须一路走过去数一数，然后走一半找到中间，然后一步一步走第三次做实际分区：O(2.5N * log N)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-02T19:46:15.477

这完全取决于您的数据是如何排序的。如果您认为它将是伪随机的，那么您最好的选择是选择随机选项或选择中间选项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-17T14:57:55.667

理想情况下，枢轴应该是整个数组的中间值。这将减少获得最坏情况性能的机会。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-05T05:05:52.897

快速排序的复杂性随着枢轴值的选择而变化很大。例如，如果您总是选择第一个元素作为枢轴，算法的复杂性会变得像 O(n^2) 一样糟糕。这是选择枢轴元素的一种聪明方法 - 1\. 选择数组的第一个、中间、最后一个元素。2\. 比较这三个数，找出大于一且小于其他数的数，即中位数。3\. 将此元素作为枢轴元素。

通过这种方法选择枢轴将数组分成近两半，因此复杂性降低到 O(nlog(n))。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-19T10:04:39.287

平均而言，中位数为 3 对较小的 n 有利。对于较大的 n，中位数为 5 会更好一些。第九个，即“三个中值的三个中值”对于非常大的 n 甚至更好。

随着 n 的增加，采样越高，您获得的效果就越好，但随着样本的增加，改进会显着减慢。而且您会产生采样和分类样本的开销。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-08-09T01:29:00.600

我建议使用中间指数，因为它可以很容易地计算出来。

您可以通过四舍五入（array.length / 2）来计算它。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-10-08T19:50:26.530

在真正优化的实现中，选择枢轴的方法应该取决于数组大小——对于大数组，花更多时间选择一个好的枢轴是值得的。如果不进行全面分析，我猜“O(log(n)) 元素的中间”是一个好的开始，并且这具有不需要任何额外内存的额外好处：在较大的分区上使用尾调用并在-位置分区，我们几乎在算法的每个阶段都使用相同的 O(log(n)) 额外内存。

# sql-server-2005 - SQL Server 2005 中 UNION 的性能非常差（未完成）

> ID：164167
> 
> 赞同：1
> 
> 时间：2008-10-02T19:39:03.077
> 
> 标签：sql-server-2005, tsql, union

警告：这是从我的系统生成的实际代码：

```
;WITH RESULTS AS (
SELECT 1174 AS BatchRunID, 'STATINV' AS Program, m.APPL_CD, m.ALBASE, 'CountFocusRecords' AS Measure, COUNT(*) AS Value
FROM [MISWork].[SX_FOCUS_NATIVE_200806] AS m WITH(NOLOCK)
INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)
ON cat.APPL_CD = m.APPL_CD
AND cat.ALBASE = m.ALBASE
AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'
GROUP BY m.APPL_CD, m.ALBASE
UNION
SELECT 1174 AS BatchRunID, 'STATINV' AS Program, c.APPL_CD, c.ALBASE, 'CountBiminiRecords' AS Measure, COUNT(*) AS Value
FROM [MISWork].[SX_STATINV] AS c WITH(NOLOCK)
INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)
ON cat.APPL_CD = c.APPL_CD
AND cat.ALBASE = c.ALBASE
AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'
GROUP BY c.APPL_CD, c.ALBASE
UNION
SELECT 1174 AS BatchRunID, 'STATINV' AS Program, m.APPL_CD, m.ALBASE, 'RecordsInFocusMissingInBimini' AS Measure, COUNT(*) AS Value
FROM [MISWork].[SX_FOCUS_NATIVE_200806] AS m WITH(NOLOCK)
LEFT JOIN [MISWork].[SX_STATINV] AS c WITH(NOLOCK)
ON m.[YEAR] = c.[YEAR]
    AND m.[MONTH] = c.[MONTH]
    AND m.[BANK_NO] = c.[BANK_NO]
    AND m.[COST_CENTER] = c.[COST_CENTER]
    AND m.[GLACCOUNT_NO] = c.[GLACCOUNT_NO]
    AND m.[CUSTACCOUNT] = c.[CUSTACCOUNT]
    AND m.[APPL_CD] = c.[APPL_CD]
    AND m.[ALBASE] = c.[ALBASE]
INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)
ON cat.APPL_CD = m.APPL_CD
AND cat.ALBASE = m.ALBASE
AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'
WHERE c.[YEAR] IS NULL
GROUP BY m.APPL_CD, m.ALBASE
UNION
SELECT 1174 AS BatchRunID, 'STATINV' AS Program, c.APPL_CD, c.ALBASE, 'RecordsInBiminiMissingInFocus' AS Measure, COUNT(*) AS Value
FROM [MISWork].[SX_FOCUS_NATIVE_200806] AS m WITH(NOLOCK)
RIGHT JOIN [MISWork].[SX_STATINV] AS c WITH(NOLOCK)
ON m.[YEAR] = c.[YEAR]
    AND m.[MONTH] = c.[MONTH]
    AND m.[BANK_NO] = c.[BANK_NO]
    AND m.[COST_CENTER] = c.[COST_CENTER]
    AND m.[GLACCOUNT_NO] = c.[GLACCOUNT_NO]
    AND m.[CUSTACCOUNT] = c.[CUSTACCOUNT]
    AND m.[APPL_CD] = c.[APPL_CD]
    AND m.[ALBASE] = c.[ALBASE]
INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)
ON cat.APPL_CD = c.APPL_CD
AND cat.ALBASE = c.ALBASE
AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'
WHERE m.[YEAR] IS NULL
GROUP BY c.APPL_CD, c.ALBASE
) SELECT * FROM RESULTS ORDER BY Program, APPL_CD, ALBASE, Measure 
```

代码就在那里，没有锁定或阻塞。

UNION 的各个组件在几秒钟内返回。该代码通常用于检查 STAT 组中所有其他程序的输出结果，但仅针对该程序停止。

删除 CTE，没有效果，每小时坐 30 分钟，无论您想在取消前等待多长时间。

去掉 UNION，11 秒内返回 4 个结果集，全部 4 个结果集共有 19 条记录。

只一起运行前两个 - 工作正常，只运行最后两个一起，也很好。前3个一起，也很好。

我已经修改了代码以将这些输出到#temp 表，以满足其他要求，所以我只是将其更改为按顺序将每个输出到#temp 表，但我从未见过 SQL 就这样停止没有阻塞或任何证据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T20:23:53.933

更改为 UNION ALL，因为您永远不会有欺骗（测量列被硬编码为不同）。UNION 必须首先对行进行排序，然后找到重复项并消除。

我真正的猜测是这是一个并行化问题。尝试在最后添加 OPTION (MAXDOP 1)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T16:15:53.267

我继续进行回归测试 200808，但基本查询是相同的，具有不同的 batchrunid 和不同的已知良好表。

```
<?xml version="1.0"?>
<ShowPlanXML xmlns="http://schemas.microsoft.com/sqlserver/2004/07/showplan" Version="1.0" Build="9.00.3239.00">
  <BatchSequence>
    <Batch>
      <Statements>
        <StmtSimple StatementText="&#13;&#10;;WITH RESULTS AS (&#13;&#10;SELECT 1251 AS BatchRunID, 'STATINV' AS Program, m.APPL_CD, m.ALBASE, 'CountFocusRecords' AS Measure, COUNT(*) AS Value&#13;&#10;FROM [MISWork].[SX_FOCUS_NATIVE_200808] AS m WITH(NOLOCK)&#13;&#10;INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)&#13;&#10;ON cat.APPL_CD = m.APPL_CD&#13;&#10;AND cat.ALBASE = m.ALBASE&#13;&#10;AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'&#13;&#10;GROUP BY m.APPL_CD, m.ALBASE&#13;&#10;UNION&#13;&#10;SELECT 1251 AS BatchRunID, 'STATINV' AS Program, c.APPL_CD, c.ALBASE, 'CountBiminiRecords' AS Measure, COUNT(*) AS Value&#13;&#10;FROM [MISWork].[SX_STATINV] AS c WITH(NOLOCK)&#13;&#10;INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)&#13;&#10;ON cat.APPL_CD = c.APPL_CD&#13;&#10;AND cat.ALBASE = c.ALBASE&#13;&#10;AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'&#13;&#10;GROUP BY c.APPL_CD, c.ALBASE&#13;&#10;UNION&#13;&#10;SELECT 1251 AS BatchRunID, 'STATINV' AS Program, m.APPL_CD, m.ALBASE, 'RecordsInFocusMissingInBimini' AS Measure, COUNT(*) AS Value&#13;&#10;FROM [MISWork].[SX_FOCUS_NATIVE_200808] AS m WITH(NOLOCK)&#13;&#10;LEFT JOIN [MISWork].[SX_STATINV] AS c WITH(NOLOCK)&#13;&#10;ON m.[YEAR] = c.[YEAR]&#13;&#10;    AND m.[MONTH] = c.[MONTH]&#13;&#10;    AND m.[BANK_NO] = c.[BANK_NO]&#13;&#10;    AND m.[COST_CENTER] = c.[COST_CENTER]&#13;&#10;    AND m.[GLACCOUNT_NO] = c.[GLACCOUNT_NO]&#13;&#10;    AND m.[CUSTACCOUNT] = c.[CUSTACCOUNT]&#13;&#10;    AND m.[APPL_CD] = c.[APPL_CD]&#13;&#10;    AND m.[ALBASE] = c.[ALBASE]&#13;&#10;INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)&#13;&#10;ON cat.APPL_CD = m.APPL_CD&#13;&#10;AND cat.ALBASE = m.ALBASE&#13;&#10;AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'&#13;&#10;WHERE c.[YEAR] IS NULL&#13;&#10;GROUP BY m.APPL_CD, m.ALBASE&#13;&#10;UNION&#13;&#10;SELECT 1251 AS BatchRunID, 'STATINV' AS Program, c.APPL_CD, c.ALBASE, 'RecordsInBiminiMissingInFocus' AS Measure, COUNT(*) AS Value&#13;&#10;FROM [MISWork].[SX_FOCUS_NATIVE_200808] AS m WITH(NOLOCK)&#13;&#10;RIGHT JOIN [MISWork].[SX_STATINV] AS c WITH(NOLOCK)&#13;&#10;ON m.[YEAR] = c.[YEAR]&#13;&#10;    AND m.[MONTH] = c.[MONTH]&#13;&#10;    AND m.[BANK_NO] = c.[BANK_NO]&#13;&#10;    AND m.[COST_CENTER] = c.[COST_CENTER]&#13;&#10;    AND m.[GLACCOUNT_NO] = c.[GLACCOUNT_NO]&#13;&#10;    AND m.[CUSTACCOUNT] = c.[CUSTACCOUNT]&#13;&#10;    AND m.[APPL_CD] = c.[APPL_CD]&#13;&#10;    AND m.[ALBASE] = c.[ALBASE]&#13;&#10;INNER JOIN MISProcess.SXProcessCatalog AS cat WITH(NOLOCK)&#13;&#10;ON cat.APPL_CD = c.APPL_CD&#13;&#10;AND cat.ALBASE = c.ALBASE&#13;&#10;AND COALESCE(cat.ProcessName, 'STATINV') = 'STATINV'&#13;&#10;WHERE m.[YEAR] IS NULL&#13;&#10;GROUP BY c.APPL_CD, c.ALBASE&#13;&#10;) SELECT * FROM RESULTS ORDER BY Program, APPL_CD, ALBASE, Measure&#13;&#10;&#13;&#10;" StatementId="1" StatementCompId="1" StatementType="SELECT" StatementSubTreeCost="1209.5" StatementEstRows="13965.1" StatementOptmLevel="FULL">
          <StatementSetOptions QUOTED_IDENTIFIER="false" ARITHABORT="true" CONCAT_NULL_YIELDS_NULL="false" ANSI_NULLS="false" ANSI_PADDING="false" ANSI_WARNINGS="false" NUMERIC_ROUNDABORT="false"/>
          <QueryPlan CachedPlanSize="504" CompileTime="1244" CompileCPU="1099" CompileMemory="5016">
            <MissingIndexes>
              <MissingIndexGroup Impact="29.2539">
                <MissingIndex Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]">
                  <ColumnGroup Usage="EQUALITY">
                    <Column Name="[APPL_CD]" ColumnId="7"/>
                    <Column Name="[ALBASE]" ColumnId="8"/>
                  </ColumnGroup>
                  <ColumnGroup Usage="INCLUDE">
                    <Column Name="[YEAR]" ColumnId="1"/>
                    <Column Name="[MONTH]" ColumnId="2"/>
                    <Column Name="[BANK_NO]" ColumnId="3"/>
                    <Column Name="[COST_CENTER]" ColumnId="4"/>
                    <Column Name="[GLACCOUNT_NO]" ColumnId="5"/>
                    <Column Name="[CUSTACCOUNT]" ColumnId="6"/>
                  </ColumnGroup>
                </MissingIndex>
              </MissingIndexGroup>
              <MissingIndexGroup Impact="29.6796">
                <MissingIndex Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]">
                  <ColumnGroup Usage="EQUALITY">
                    <Column Name="[APPL_CD]" ColumnId="7"/>
                    <Column Name="[ALBASE]" ColumnId="8"/>
                  </ColumnGroup>
                </MissingIndex>
              </MissingIndexGroup>
            </MissingIndexes>
            <RelOp NodeId="0" PhysicalOp="Parallelism" LogicalOp="Gather Streams" EstimateRows="13965.1" EstimateIO="0" EstimateCPU="0.121489" AvgRowSize="45" EstimatedTotalSubtreeCost="1209.5" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
              <OutputList>
                <ColumnReference Column="Union1039"/>
                <ColumnReference Column="Union1040"/>
                <ColumnReference Column="Union1041"/>
                <ColumnReference Column="Union1042"/>
                <ColumnReference Column="Union1043"/>
                <ColumnReference Column="Union1044"/>
              </OutputList>
              <Parallelism>
                <OrderBy>
                  <OrderByColumn Ascending="1">
                    <ColumnReference Column="Union1041"/>
                  </OrderByColumn>
                  <OrderByColumn Ascending="1">
                    <ColumnReference Column="Union1042"/>
                  </OrderByColumn>
                  <OrderByColumn Ascending="1">
                    <ColumnReference Column="Union1043"/>
                  </OrderByColumn>
                </OrderBy>
                <RelOp NodeId="1" PhysicalOp="Sort" LogicalOp="Sort" EstimateRows="13965.1" EstimateIO="0.00281532" EstimateCPU="0.220682" AvgRowSize="45" EstimatedTotalSubtreeCost="1209.37" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                  <OutputList>
                    <ColumnReference Column="Union1039"/>
                    <ColumnReference Column="Union1040"/>
                    <ColumnReference Column="Union1041"/>
                    <ColumnReference Column="Union1042"/>
                    <ColumnReference Column="Union1043"/>
                    <ColumnReference Column="Union1044"/>
                  </OutputList>
                  <MemoryFractions Input="0.0191727" Output="1"/>
                  <Sort Distinct="0">
                    <OrderBy>
                      <OrderByColumn Ascending="1">
                        <ColumnReference Column="Union1041"/>
                      </OrderByColumn>
                      <OrderByColumn Ascending="1">
                        <ColumnReference Column="Union1042"/>
                      </OrderByColumn>
                      <OrderByColumn Ascending="1">
                        <ColumnReference Column="Union1043"/>
                      </OrderByColumn>
                    </OrderBy>
                    <RelOp NodeId="2" PhysicalOp="Concatenation" LogicalOp="Concatenation" EstimateRows="13965.1" EstimateIO="0" EstimateCPU="0.000349132" AvgRowSize="45" EstimatedTotalSubtreeCost="1209.15" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                      <OutputList>
                        <ColumnReference Column="Union1039"/>
                        <ColumnReference Column="Union1040"/>
                        <ColumnReference Column="Union1041"/>
                        <ColumnReference Column="Union1042"/>
                        <ColumnReference Column="Union1043"/>
                        <ColumnReference Column="Union1044"/>
                      </OutputList>
                      <Concat>
                        <DefinedValues>
                          <DefinedValue>
                            <ColumnReference Column="Union1039"/>
                            <ColumnReference Column="Expr1006"/>
                            <ColumnReference Column="Expr1014"/>
                            <ColumnReference Column="Expr1025"/>
                            <ColumnReference Column="Expr1036"/>
                          </DefinedValue>
                          <DefinedValue>
                            <ColumnReference Column="Union1040"/>
                            <ColumnReference Column="Expr1007"/>
                            <ColumnReference Column="Expr1015"/>
                            <ColumnReference Column="Expr1026"/>
                            <ColumnReference Column="Expr1037"/>
                          </DefinedValue>
                          <DefinedValue>
                            <ColumnReference Column="Union1041"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_STATINV]" Alias="[c]" Column="APPL_CD"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_STATINV]" Alias="[c]" Column="APPL_CD"/>
                          </DefinedValue>
                          <DefinedValue>
                            <ColumnReference Column="Union1042"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_STATINV]" Alias="[c]" Column="ALBASE"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_STATINV]" Alias="[c]" Column="ALBASE"/>
                          </DefinedValue>
                          <DefinedValue>
                            <ColumnReference Column="Union1043"/>
                            <ColumnReference Column="Expr1008"/>
                            <ColumnReference Column="Expr1016"/>
                            <ColumnReference Column="Expr1027"/>
                            <ColumnReference Column="Expr1038"/>
                          </DefinedValue>
                          <DefinedValue>
                            <ColumnReference Column="Union1044"/>
                            <ColumnReference Column="Expr1005"/>
                            <ColumnReference Column="Expr1013"/>
                            <ColumnReference Column="Expr1024"/>
                            <ColumnReference Column="Expr1035"/>
                          </DefinedValue>
                        </DefinedValues>
                        <RelOp NodeId="4" PhysicalOp="Compute Scalar" LogicalOp="Compute Scalar" EstimateRows="7140" EstimateIO="0" EstimateCPU="0.0001785" AvgRowSize="42" EstimatedTotalSubtreeCost="362.728" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                          <OutputList>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                            <ColumnReference Column="Expr1005"/>
                            <ColumnReference Column="Expr1006"/>
                            <ColumnReference Column="Expr1007"/>
                            <ColumnReference Column="Expr1008"/>
                          </OutputList>
                          <ComputeScalar>
                            <DefinedValues>
                              <DefinedValue>
                                <ColumnReference Column="Expr1006"/>
                                <ScalarOperator ScalarString="(1251)">
                                  <Const ConstValue="(1251)"/>
                                </ScalarOperator>
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Column="Expr1007"/>
                                <ScalarOperator ScalarString="'STATINV'">
                                  <Const ConstValue="'STATINV'"/>
                                </ScalarOperator>
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Column="Expr1008"/>
                                <ScalarOperator ScalarString="'CountFocusRecords'">
                                  <Const ConstValue="'CountFocusRecords'"/>
                                </ScalarOperator>
                              </DefinedValue>
                            </DefinedValues>
                            <RelOp NodeId="6" PhysicalOp="Compute Scalar" LogicalOp="Compute Scalar" EstimateRows="7140" EstimateIO="0" EstimateCPU="0.0001785" AvgRowSize="23" EstimatedTotalSubtreeCost="362.728" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                              <OutputList>
                                <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                <ColumnReference Column="Expr1005"/>
                              </OutputList>
                              <ComputeScalar>
                                <DefinedValues>
                                  <DefinedValue>
                                    <ColumnReference Column="Expr1005"/>
                                    <ScalarOperator ScalarString="CONVERT_IMPLICIT(int,[globalagg1083],0)">
                                      <Convert DataType="int" Style="0" Implicit="1">
                                        <ScalarOperator>
                                          <Identifier>
                                            <ColumnReference Column="globalagg1083"/>
                                          </Identifier>
                                        </ScalarOperator>
                                      </Convert>
                                    </ScalarOperator>
                                  </DefinedValue>
                                </DefinedValues>
                                <RelOp NodeId="7" PhysicalOp="Hash Match" LogicalOp="Aggregate" EstimateRows="7140" EstimateIO="0" EstimateCPU="0.114864" AvgRowSize="27" EstimatedTotalSubtreeCost="362.728" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                                  <OutputList>
                                    <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                    <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                    <ColumnReference Column="globalagg1083"/>
                                  </OutputList>
                                  <MemoryFractions Input="0.5" Output="0.980827"/>
                                  <Hash>
                                    <DefinedValues>
                                      <DefinedValue>
                                        <ColumnReference Column="globalagg1083"/>
                                        <ScalarOperator ScalarString="SUM([partialagg1082])">
                                          <Aggregate Distinct="0" AggType="SUM">
                                            <ScalarOperator>
                                              <Identifier>
                                                <ColumnReference Column="partialagg1082"/>
                                              </Identifier>
                                            </ScalarOperator>
                                          </Aggregate>
                                        </ScalarOperator>
                                      </DefinedValue>
                                    </DefinedValues>
                                    <HashKeysBuild>
                                      <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                      <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                    </HashKeysBuild>
                                    <BuildResidual>
                                      <ScalarOperator ScalarString="[DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[APPL_CD] as [m].[APPL_CD] = [DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[APPL_CD] as [m].[APPL_CD] AND [DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[ALBASE] as [m].[ALBASE] = [DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[ALBASE] as [m].[ALBASE]">
                                        <Logical Operation="AND">
                                          <ScalarOperator>
                                            <Compare CompareOp="IS">
                                              <ScalarOperator>
                                                <Identifier>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                                </Identifier>
                                              </ScalarOperator>
                                              <ScalarOperator>
                                                <Identifier>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                                </Identifier>
                                              </ScalarOperator>
                                            </Compare>
                                          </ScalarOperator>
                                          <ScalarOperator>
                                            <Compare CompareOp="IS">
                                              <ScalarOperator>
                                                <Identifier>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                                </Identifier>
                                              </ScalarOperator>
                                              <ScalarOperator>
                                                <Identifier>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                                </Identifier>
                                              </ScalarOperator>
                                            </Compare>
                                          </ScalarOperator>
                                        </Logical>
                                      </ScalarOperator>
                                    </BuildResidual>
                                    <RelOp NodeId="8" PhysicalOp="Parallelism" LogicalOp="Repartition Streams" EstimateRows="28560" EstimateIO="0" EstimateCPU="0.0614707" AvgRowSize="27" EstimatedTotalSubtreeCost="362.613" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                                      <OutputList>
                                        <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                        <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                        <ColumnReference Column="partialagg1082"/>
                                      </OutputList>
                                      <Parallelism PartitioningType="Hash">
                                        <PartitionColumns>
                                          <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                          <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                        </PartitionColumns>
                                        <RelOp NodeId="9" PhysicalOp="Hash Match" LogicalOp="Partial Aggregate" EstimateRows="28560" EstimateIO="0" EstimateCPU="1.7277" AvgRowSize="27" EstimatedTotalSubtreeCost="362.551" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                                          <OutputList>
                                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                            <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                            <ColumnReference Column="partialagg1082"/>
                                          </OutputList>
                                          <MemoryFractions Input="0" Output="0"/>
                                          <Hash>
                                            <DefinedValues>
                                              <DefinedValue>
                                                <ColumnReference Column="partialagg1082"/>
                                                <ScalarOperator ScalarString="COUNT(*)">
                                                  <Aggregate Distinct="0" AggType="COUNT*"/>
                                                </ScalarOperator>
                                              </DefinedValue>
                                            </DefinedValues>
                                            <HashKeysBuild>
                                              <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                              <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                            </HashKeysBuild>
                                            <BuildResidual>
                                              <ScalarOperator ScalarString="[DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[APPL_CD] as [m].[APPL_CD] = [DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[APPL_CD] as [m].[APPL_CD] AND [DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[ALBASE] as [m].[ALBASE] = [DUASFIN].[MISWork].[SX_FOCUS_NATIVE_200808].[ALBASE] as [m].[ALBASE]">
                                                <Logical Operation="AND">
                                                  <ScalarOperator>
                                                    <Compare CompareOp="IS">
                                                      <ScalarOperator>
                                                        <Identifier>
                                                          <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                                        </Identifier>
                                                      </ScalarOperator>
                                                      <ScalarOperator>
                                                        <Identifier>
                                                          <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                                        </Identifier>
                                                      </ScalarOperator>
                                                    </Compare>
                                                  </ScalarOperator>
                                                  <ScalarOperator>
                                                    <Compare CompareOp="IS">
                                                      <ScalarOperator>
                                                        <Identifier>
                                                          <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                                        </Identifier>
                                                      </ScalarOperator>
                                                      <ScalarOperator>
                                                        <Identifier>
                                                          <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                                        </Identifier>
                                                      </ScalarOperator>
                                                    </Compare>
                                                  </ScalarOperator>
                                                </Logical>
                                              </ScalarOperator>
                                            </BuildResidual>
                                            <RelOp NodeId="10" PhysicalOp="Hash Match" LogicalOp="Inner Join" EstimateRows="879583" EstimateIO="0" EstimateCPU="62.0602" AvgRowSize="19" EstimatedTotalSubtreeCost="360.824" Parallel="1" EstimateRebinds="0" EstimateRewinds="0">
                                              <OutputList>
                                                <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                                <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                              </OutputList>
                                              <MemoryFractions Input="1" Output="0.5"/>
                                              <Hash>
                                                <DefinedValues/>
                                                <HashKeysBuild>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISProcess]" Table="[SXProcessCatalog]" Alias="[cat]" Column="APPL_CD"/>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISProcess]" Table="[SXProcessCatalog]" Alias="[cat]" Column="ALBASE"/>
                                                </HashKeysBuild>
                                                <HashKeysProbe>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="APPL_CD"/>
                                                  <ColumnReference Database="[DUASFIN]" Schema="[MISWork]" Table="[SX_FOCUS_NATIVE_200808]" Alias="[m]" Column="ALBASE"/>
                                                </HashKeysProbe>
                                                <ProbeResidual> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T17:14:13.883

If you can post the query execution plan in XML format, that'll help us determine what parts of the query are causing problems. In SSMS, click Query, Display Estimated Execution Plan, and when it comes up, right-click on it and save as XML.

# c++ - 你如何构造一个带有嵌入 null 的 std::string？

> ID：164168
> 
> 赞同：98
> 
> 时间：2008-10-02T19:39:03.340
> 
> 标签：c++, null, stdstring

如果我想构造一个带有如下行的 std::string ：

```
std::string my_string("a\0b"); 
```

我想在结果字符串中包含三个字符（a，null，b），我只得到一个。什么是正确的语法？

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2008-10-02T19:56:53.250

### 自 C++14 起

我们已经能够创建[文字`std::string`](https://en.cppreference.com/w/cpp/string/basic_string/operator%22%22s)

```
#include <iostream>
#include <string>

int main()
{
    using namespace std::string_literals;

    std::string s = "pl-\0-op"s;    // <- Notice the "s" at the end
                                    // This is a std::string literal not
                                    // a C-String literal.
    std::cout << s << "\n";
} 
```

### C++14 之前

问题是`std::string`采用 a 的构造函数`const char*`假设输入是 C 字符串。C-strings 被`\0`终止，因此当它到达`\0`字符时解析停止。

为了弥补这一点，您需要使用从 char 数组（而不是 C 字符串）构建字符串的构造函数。这需要两个参数 - 一个指向数组的指针和一个长度：

```
std::string   x("pq\0rs");   // Two characters because input assumed to be C-String
std::string   x("pq\0rs",5); // 5 Characters as the input is now a char array with 5 characters. 
```

注意：C++`std::string`没有**终止** `\0`（如其他帖子中所建议的那样）。但是，您可以使用 方法提取指向包含 C-String 的内部缓冲区的指针`c_str()`。

另请查看[Doug T](https://stackoverflow.com/questions/164168/how-do-you-construct-a-stdstring-with-an-embedded-null#164257)下面关于使用`vector<char>`.

另请查看[RiaD](https://stackoverflow.com/a/34723611/14065)以获得 C++14 解决方案。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-02T19:54:04.770

如果您正在像使用 c 样式字符串（字符数组）一样进行操作，请考虑使用

```
std::vector<char> 
```

您可以更自由地以与处理 c 字符串相同的方式将其视为数组。您可以使用 copy() 复制到字符串中：

```
std::vector<char> vec(100)
strncpy(&vec[0], "blah blah blah", 100);
std::string vecAsStr( vec.begin(), vec.end()); 
```

你可以在许多可以使用 c-strings 的地方使用它

```
printf("%s" &vec[0])
vec[10] = '\0';
vec[11] = 'b'; 
```

但是，很自然地，您会遇到与 c-strings 相同的问题。您可能会忘记您的空终端或写过去分配的空间。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-02T19:42:53.223

我不知道你*为什么*想做这样的事情，但试试这个：

```
std::string my_string("a\0b", 3); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-10-05T01:36:19.380

[用户定义的文字为 C++ 添加了哪些新功能？](https://stackoverflow.com/questions/237804/user-defined-literals-in-c11-a-much-needed-addition-or-making-c-even-more-b)给出了一个优雅的答案：定义

```
std::string operator "" _s(const char* str, size_t n) 
{ 
    return std::string(str, n); 
} 
```

那么你可以这样创建你的字符串：

```
std::string my_string("a\0b"_s); 
```

甚至这样：

```
auto my_string = "a\0b"_s; 
```

有一种“旧式”的方式：

```
#define S(s) s, sizeof s - 1 // trailing NUL does not belong to the string 
```

那么你可以定义

```
std::string my_string(S("a\0b")); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-02T19:48:20.307

以下将工作...

```
std::string s;
s.push_back('a');
s.push_back('\0');
s.push_back('b'); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-10-14T17:00:53.160

你必须小心这个。如果您将“b”替换为任何数字字符，您将使用大多数方法默默地创建错误的字符串。请参阅：[C++ 字符串文字转义字符的规则](https://stackoverflow.com/questions/10220401/c-string-literals-escape-character)。

例如，我把这个看起来很无辜的片段放在程序中间

```
// Create '\0' followed by '0' 40 times ;)
std::string str("\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00", 80);
std::cerr << "Entering loop.\n";
for (char & c : str) {
    std::cerr << c;
    // 'Q' is way cooler than '\0' or '0'
    c = 'Q';
}
std::cerr << "\n";
for (char & c : str) {
    std::cerr << c;
}
std::cerr << "\n"; 
```

这是该程序为我输出的内容：

```
Entering loop.
Entering loop.

vector::_M_emplace_ba
QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ 
```

那是我的第一个打印语句两次，几个非打印字符，后跟一个换行符，然后是内部存储器中的某些内容，我刚刚覆盖了它（然后打印，表明它已被覆盖）。最糟糕的是，即使使用[彻底和详细的 gcc 警告](https://stackoverflow.com/questions/5088460/flags-to-enable-thorough-and-verbose-g-warnings/9862800#9862800)来编译它，我也没有任何迹象表明有什么问题，并且通过 valgrind 运行程序并没有抱怨任何不正确的内存访问模式。换句话说，现代工具完全无法检测到它。

你可以用更简单的方法来解决同样的问题`std::string("0", 100);`，但是上面的例子有点棘手，因此更难看出哪里出了问题。

幸运的是，C++11 使用初始化列表语法为我们提供了一个很好的解决方案。这使您不必指定字符数（如上所示，您可能会做错），并避免组合转义数字。`std::string str({'a', '\0', 'b'})`对于任何字符串内容都是安全的，这与采用数组`char`和大小的版本不同。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-01-11T14:13:22.883

在 C++14 中，您现在可以使用文字

```
using namespace std::literals::string_literals;
std::string s = "a\0b"s;
std::cout << s.size(); // 3 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T19:56:01.677

如果这个问题不仅仅是为了教育目的，最好使用 std::vector<char> 。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-11-09T18:53:47.293

anonym 的回答非常好，但在 C++98 中也有一个非宏解决方案：

```
template <size_t N>
std::string RawString(const char (&ch)[N])
{
  return std::string(ch, N-1);  // Again, exclude trailing `null`
} 
```

使用此函数，`RawString(/* literal */)`将生成与以下相同的字符串`S(/* literal */)`：

```
std::string my_string_t(RawString("a\0b"));
std::string my_string_m(S("a\0b"));
std::cout << "Using template: " << my_string_t << std::endl;
std::cout << "Using macro: " << my_string_m << std::endl; 
```

此外，宏还有一个问题：表达式实际上不是`std::string`写的，因此不能用于例如简单的赋值初始化：

```
std::string s = S("a\0b"); // ERROR! 
```

...所以最好使用：

```
#define std::string(s, sizeof s - 1) 
```

显然，您应该只在项目中使用一种或另一种解决方案，并将其命名为您认为合适的任何名称。

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2010-02-01T10:16:41.117

我知道这个问题已经问了很长时间了。但是对于任何遇到类似问题的人可能会对以下代码感兴趣。

```
CComBSTR(20,"mystring1\0mystring2\0") 
```

* * *

## 回答 #11

> 赞同：-8
> 
> 时间：2008-10-02T19:47:12.760

几乎所有 std::strings 的实现都是空终止的，所以你可能不应该这样做。请注意，“a\0b”实际上是四个字符长，因为自动空终止符（a、null、b、null）。如果你真的想这样做并打破 std::string 的合同，你可以这样做：

```
std::string s("aab");
s.at(1) = '\0'; 
```

但如果你这样做了，你所有的朋友都会嘲笑你，你永远不会找到真正的幸福。

# qa - QA 是否应该从严格的黑盒角度进行测试？

> ID：164170
> 
> 赞同：3
> 
> 时间：2008-10-02T19:39:15.413
> 
> 标签：qa, black-box

假设单元测试由开发人员处理，QA 是否有任何理由了解产品如何工作的细节？我的意思是，他们是否需要知道后台发生了什么？他们是否应该在不使用普通 UI 的情况下测试产品的各个部分？例如，测试人员进入数据库并手动更改值以查看会发生什么是否有意义？

编辑：
假设我们正在使用一个供非开发人员使用的应用程序，我们不是在处理带有 API 的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T19:48:32.787

这取决于您编写的方法和软件类型。有不同类型的 QA。如果软件应该是容错的，QA 应该模拟故障。此外，了解产品的工作原理可以帮助 QA 考虑潜在的问题案例并更彻底地测试它们。

另一方面，了解产品的工作原理可能会阻止 QA 从用户的角度进行完全测试。因此，也许首先应该在不了解内部结构的情况下设计基本测试，然后根据潜在问题进行更深入的测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T19:47:30.480

当然，这取决于架构。我在一个项目中工作，其中 db 层由不同建筑物中的一个完全独立的团队开发、管理和测试。他们的 QA 肯定会使用数据来查看程序、查询等是否都在一系列测试条件下运行。

如果你在 UI 端，那么有两个级别，一个是简单的功能测试，QA 不需要应用程序的工作知识（并且所有这些都应该是自动化的），然后是 QA，它说明应用程序是否做它应该做的事情。对于第二种情况，如果 QA 团队知道它是如何工作的，那真的很有帮助。一开始就拒绝愚蠢的错误可以节省大量时间，但更重要的是，它们需要像用户一样行事，并且有端到端的用例来尝试一些更复杂的覆盖场景。要设计这样的测试，他们必须对应用程序有很好的了解。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:49:38.073

测试人员尽可能多地了解软件的实现是绝对有意义的。这将帮助他们更好地测试。

黑盒测试是一种有用且必要的技术，但对幕后发生的事情有所了解可以更容易地定义真正有趣的测试用例。

依赖开发人员的单元测试来满足所有白盒测试需求的问题在于，总的来说，开发人员并不是非常彻底的测试人员，尤其是在他们编写的代码方面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T19:49:38.243

在我参与的项目中，QA 从用户的角度进行测试，他们的测试是从满足需求的角度进行的。他们的测试是黑盒测试。白盒测试由开发人员完成。我们从没想过 QA 人员会打开数据库查询工具并手动更改值。这是开发人员单元测试的职责。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T19:51:55.790

我认为这取决于您的 QA 团队在给定项目中所扮演的角色。我认为您可以提出一个论点，即由数据库中存在的特定值引起的情况应该由测试用例表示，如果它们可以用这种方式表示，那么开发人员应该为这些情况编写（应该编写）单元测试.

如果您还使用代码检查来识别和修复缺陷，则可能没有必要将 QA 暴露给幕后的任何内容。我想有些项目可能对他们在用户体验之外测试代码有所帮助，但我可能会使用 QA 团队进行黑盒测试，而不是白盒或明盒测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T20:02:41.193

**我想说，QA 人员完全**有理由不了解您的应用程序如何工作的详细内部知识。QA 人员的计算机能力应与您的目标受众大致相同。

原因很简单：QA 人员对您的应用程序的构建方式了解得越多，他们就越有可能避免普通用户遇到的正常可用性问题。

QA 不仅仅是测试应用程序是否有效。它还应该是关于测试您的普通用户是否可以理解并因此实际可用。

**更新**
这太长了，无法放入评论框中。

关于@testerab 的问题。

我将 QA 定义为负责确保 1\. 满足业务需求的个人或团队；并且，2\. 与这些要求相关的应用程序功能没有错误。因此，绰号“质量保证”。我认为属于 QA 的第三个项目就是可用性。

他们必须了解业务需求，这意味着他们应该与任何业务分析师和最终用户（如果有的话）携手合作。与我共事过的最好的 QA 成员都是从这些领域聘用的。我见过的最差的 QA 成员是开发人员，或者接受过这样的培训。从技术支持离职的人也倾向于成为优秀的 QA 成员，因为他们确切地知道最终用户会尝试的垃圾类型。

有许多不同类别的应用程序。其中最常见的是美化数据输入。您有一些屏幕可以输入信息并按下按钮。然后将信息存储和/或路由到它需要去的任何地方。从 MS Word 到 CRM 的一切都属于这一类。

因此，QA 人员的工作是首先确保应用程序将接受所需的输入并执行所需的功能。第二步是提交错误的输入并验证应用程序以所需的方式响应。例如，它不会爆炸或允许不良信息通过。自动化测试工具在这些情况下工作得很好。最后一部分是决定该功能是否应该隐藏在三个菜单级别深处，还是应该更容易获得。

以上都不需要质量检查人员阅读代码或玩弄比特。

有些系统没有 UI 组件。对于这些，由开发人员提供一个测试工具，允许 QA 团队提交数据并审查结果。这涵盖了 Web 服务和您可以想象的任何类型的 EDI。

其他系统本身就是 API。这些要求要么有足够知识的 QA 人员自己实现此类 API 调用，要么需要开发人员提供轻松调用它们并记录结果的方法。在这种情况下，最好 QA 团队可以自己进行编程，但同样不能访问底层代码。

审查实际代码的问题在于它往往会导致人们只关注他们所看到的内容。这是不好的。相反，他们应该在精神上摆脱那些人为的限制，以便他们可以在需要输入数字的文本框中盲目地键入“ABC”。

* * *

至于“查看”代码以便知道要测试什么，这是一个完全不同的问题，并且在代码审查设置中由训练有素的开发人员更好地解决。这里的目的是识别可能的错误、最佳实践、安全故障等。QA 人员很少能够进行这种级别的分析，因为它需要有人成为活跃的开发人员。

* * *

关于 SDET：如果您的产品拥有或现在是开发人员用来构建其他东西的 API 或基础，那么您可能需要一个或多个人专门围绕它实施软件，以支持常规 QA 小组。我对这个角色的必要性持观望态度，并相信这可能是一个逐个项目的决策。

我相信有两个小组更有资格测试 API。这些是已经在实施的最终用户以及构建它的公司中的其他开发人员。狗食现在是一种常见的做法，而且非常划算。毕竟，如果它不起作用，您可以确定它会很快得到修复。对于最终用户，只要他们将其视为开发团队响应的真实对话，他们就会很乐意为您“测试”它。

我经历过这三种情况，作为最终用户，我觉得可以访问原始开发人员对于解决问题有很长的路要走。特别是当他们也在使用该产品时。通常与这些项目相关的 QA 人员的误译数量非常可怕。

* * *

总而言之，我与各种 QA 人员共事过。从您想知道他们如何设法开车上班的超级明星到非常善于发现导致应用程序阻塞的那些极端情况的超级明星。

最好的人的特点是： 1\. 从来不是程序员；2.了解业务；3\. 准确了解最终用户每天所做的事情。4\. 真诚地关心那些使用该软件的人。

最差的特征包括： 1\. 曾经是程序员或认为他们是程序员；2\. 不懂业务；3\. 从未见过最终用户；4\. 过于频繁地使用“白痴”这个词；5\. 关注它的工作原理，而不是它是否可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T20:04:41.983

我认为混合方法效果很好。如果您结合使用白盒测试（单元测试）和黑盒测试，您最终会获得更好的覆盖率。每个都有其优点和缺点，但它们确实部分掩盖了另一个的弱点。

了解代码的内部工作原理会导致您以某种方式进行测试，这并不总是发现某些问题的最佳方式。

# sql - Informix SQL 语法 - 嵌套计数、总和、舍入

> ID：164173
> 
> 赞同：2
> 
> 时间：2008-10-02T19:40:03.883
> 
> 标签：sql, tsql, syntax, count, informix

让我为这个问题的简单性提前道歉（我听到了 Jeff 的播客以及他担心问题的质量会被“降低”），但我被卡住了。我正在使用 AquaData 来访问我的 Informix DB。MS SQL 和 Informix SQL 之间有一些古怪的细微差别。无论如何，我正在尝试做一个简单的嵌套表达式，它讨厌我。

```
select 
  score,
  count(*) students,
  count(finished) finished,
  count(finished) / count(*)students   
--  round((count(finished) / count(*)students),2) 
from now_calc 
group by score
order by score 
```

带有简单除法表达式的行返回完成的人的百分比，这正是我想要的......我只需要将结果四舍五入到 2 位。注释行 (--) 不起作用。我已经尝试了所有我能想到的变化。

*我不想同时使用第 5 行和第 6 行

* * *

对不起，我应该提到 now_calc 是一个临时表，字段名称实际上是“students”和“finished”。我将它们命名为这样，因为我要将这些结果直接输出到 Excel 中，并且我希望字段名称兼作列标题。所以，我明白你在说什么，并基于此，我通过删除 (*) 使其工作，如下所示：

```
select 
  score,
  count(students) students,
  count(finished) finished,
  round((count(finished) / count(students) * 100),2) perc
from now_calc 
group by score
order by score 
```

我包括了整个查询——这对其他任何人来说可能更有意义。从学习的角度来看，重要的是要注意计数在“已完成”字段上起作用的唯一原因是因为 Case 语句根据对 Case 语句的评估将值设为 1 或 null。如果该案例陈述不存在，计算“完成”将产生与计算“学生”完全相同的结果。

```
--count of cohort members and total count of all students (for reference)
select 
  cohort_yr, 
  count (*) id,
  (select count (*) id from prog_enr_rec where cohort_yr is not null and prog = 'UNDG' and cohort_yr >=1998) grand
from prog_enr_rec
where cohort_yr is not null 
and prog = 'UNDG'
and cohort_yr >=1998
group by cohort_yr
order by cohort_yr;

--cohort members from all years for population
select 
  id,  
  cohort_yr,
  cl,
  enr_date,
  prog
from prog_enr_rec
where cohort_yr is not null 
and prog = 'UNDG'
and cohort_yr >=1998
order by cohort_yr
into temp pop with no log;

--which in population are still attending (726)
select 
  pop.id, 
  'Y' fin 
from pop, stu_acad_rec
where pop.id = stu_acad_rec.id 
and pop.prog = stu_acad_rec.prog
and sess = 'FA'
and yr = 2008
and reg_hrs > 0
and stu_acad_rec.cl[1,1] <> 'P'
into temp att with no log;

--which in population graduated with either A or B deg (702)
select 
  pop.id,
  'Y' fin
from pop, ed_rec
where pop.id = ed_rec.id
and pop.prog = ed_rec.prog
and ed_rec.sch_id = 10 
and (ed_rec.deg_earn[1,1] = 'B'
or  (ed_rec.deg_earn[1,1] = 'A'
and pop.id not in (select pop.id 
           from pop, ed_rec
           where pop.id = ed_rec.id
           and pop.prog = ed_rec.prog
           and ed_rec.deg_earn[1,1] = 'B'
           and ed_rec.sch_id = 10)))
into temp grad with no log;

--combine all those that either graduated or are still attending
select * from att
union
select * from grad
into temp all_fin with no log;

--ACT scores for all students in population who have a score (inner join to eliminate null values)
--score > 50 eliminates people who have data entry errors - SAT scores in ACT field
--2270
select 
  pop.id,
  max (exam_rec.score5) score
from pop, exam_rec
where pop.id = exam_rec.id
and ctgry = 'ACT'
and score5 > 0 
and score5 < 50
group by pop.id
into temp pop_score with no log;

select 
  pop.id students,
  Case when all_fin.fin = 'Y' then 1 else null end finished,
  pop_score.score
from pop, pop_score, outer all_fin
where pop.id = all_fin.id 
and pop.id = pop_score.id
into temp now_calc with no log;

select 
  score,
  count(students) students,
  count(finished) finished,
  round((count(finished) / count(students) * 100),2) perc
from now_calc 
group by score
order by score 
```

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T19:48:40.027

```
SELECT
        score,
        count(*) students,
        count(finished) finished,
        count(finished) / count(*) AS something_other_than_students,   
        round((count(finished) / count(*)),2) AS rounded_value
    FROM now_calc 
    GROUP BY score
    ORDER BY score; 
```

请注意，输出列名称“students”被重复，也让您感到困惑。我使用的 AS 是可选的。

我现在已经正式验证了针对 IDS 的语法，它是可用的：

```
Black JL: sqlcmd -Ffixsep -d stores -xf xx.sql | sed 's/        //g'
+ create temp table now_calc(finished CHAR(1), score INTEGER, name CHAR(10) PRIMARY KEY);
+ insert into now_calc values(null, 23, 'a');
+ insert into now_calc values('y',  23, 'b');
+ insert into now_calc values('y',  23, 'h');
+ insert into now_calc values('y',  23, 'i');
+ insert into now_calc values('y',  23, 'j');
+ insert into now_calc values('y',  43, 'c');
+ insert into now_calc values(null, 23, 'd');
+ insert into now_calc values('y',  43, 'e');
+ insert into now_calc values(null, 23, 'f');
+ insert into now_calc values(null, 43, 'g');
+ SELECT
        score,
        count(*) students,
        count(finished) finished,
        count(finished) / count(*) AS something_other_than_students,
        round((count(finished) / count(*)),2) AS rounded_value
    FROM now_calc
    GROUP BY score
    ORDER BY score;
 23|       7|       4| 5.71428571428571E-01|      0.57
 43|       3|       2| 6.66666666666667E-01|      0.67
Black JL: 
```

I let 'finished' take nulls because the only reason for 'count(finished) / count(*)' not to return 1 is if 'finished' accepts nulls -- not very good table design, though. And I put 7 rows with score 23 to get a large number of decimal places (and then changed one row with score 43 to generate a second number with a large number of decimal places).

# performance - 对于动态的、个性化的 Web 应用程序，什么被认为是好的响应时间？

> ID：164175
> 
> 赞同：162
> 
> 时间：2008-10-02T19:40:50.153
> 
> 标签：performance, scalability

对于包含动态内容和个性化的复杂 Web 应用程序，服务器的良好响应时间是多少（不包括网络延迟和浏览器渲染时间）？我正在考虑 Facebook、Amazon、MyYahoo 等网站。一个相关的问题是后端服务的良好响应时间是多少？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-02T20:01:46.733

对此有大量的研究。这是一个[快速的总结](http://www.useit.com/papers/responsetime.html)。

> ## 响应时间：三个重要限制
> 
> [雅各布尼尔森](http://www.nngroup.com/articles/author/jakob-nielsen/)于1993 年 1 月 1 日
> 
> 总结：在优化 Web 和应用程序性能时，需要牢记 3 个主要时间限制（由人类感知能力决定）。
> 
> *摘自我1993 年出版的《[可用性工程》一书中的第 5 章：](http://www.nngroup.com/books/usability-engineering/)*
> 
> 三十年来，关于响应时间的基本建议大致相同 [Miller 1968; 卡等人。1991]：
> 
> *   **0.1 秒**大约是让用户感觉到系统在**瞬间做出反应**的极限，这意味着除了显示结果之外不需要特殊的反馈。
> *   **1.0 秒**大约是**用户思维流**保持不间断的极限，即使用户会注意到延迟。正常情况下，在大于 0.1 秒小于 1.0 秒的延迟期间不需要特殊的反馈，但用户确实会失去直接对数据进行操作的感觉。
> *   **10 秒**大约是**让用户的注意力**集中在对话上的极限。对于更长的延迟，用户将希望在等待计算机完成时执行其他任务，因此应向他们提供反馈，指示计算机何时完成。如果响应时间可能变化很大，则延迟期间的反馈尤其重要，因为用户将不知道会发生什么。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-05-25T21:29:56.967

我们争取 20 毫秒的响应时间，而一些复杂的页面则需要 100 毫秒。对于最复杂的页面，我们将页面分解成更小的部分，并使用渐进式显示模式来加载每个部分。这样，即使页面需要 1 到 2 秒才能加载，某些部分也会快速加载，从而在页面其余部分加载时保持用户参与。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-02T19:51:47.257

我一直在为我的应用程序争取 < 3 秒，但在性能方面我有点挑剔。

如果你四处打听，他们会说人们开始对 >= 7 秒的范围失去兴趣，到 10-15 秒你通常会失去他们，除非你真的有他们想要或需要的东西。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-02T19:46:19.517

这取决于是什么让您的用户满意。例如，Gmail 一开始需要很长时间才能打开，但用户等待是因为值得等待。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-02T19:47:37.547

当然，这取决于您问题的性质，因此答案非常主观。

在页面可读/可用之前，网站的第一个响应也只是一小部分时间。

我对大于 10 秒的响应感到恼火。我认为应该在 5-7 秒后呈现一个网站。

顺便说一句：stackoverflow.com 的响应时间非常好！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-02T20:05:38.987

我们公司有5秒的响应时间标准限制，我们的目标一般是2-3秒。这占页面加载的 98%。一些特定的任务被允许长达 15 秒，但我们通过放置一个页面并每 5 秒刷新一次来告诉用户我们仍在尝试处理请求来缓解这个时间。这样，用户就会看到正在发生的事情，而不仅仅是离开。虽然，考虑到我在一个用户因商业原因被迫使用的网站上工作，他们不会离开，但他们能够大声抱怨。

一般来说，如果处理时间超过 5 秒，请放置一个临时页面，以免用户失去兴趣。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-02T20:17:18.567

我想您会发现，如果您的 Web 应用程序正在执行复杂的操作，然后向用户提供反馈，他们不会介意（太多）。

例如：加载谷歌邮件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T19:50:42.423

它不仅取决于让用户满意的因素，还取决于您有多少开发时间？您可以为问题投入哪些资源（软件、硬件和人员）？

如果托管应用程序正在做一些“复杂”的事情，我不介意它们会延迟几秒钟。如果它真的很简单，延迟会困扰我。

* * *

## 回答 #9

> 赞同：-7
> 
> 时间：2008-10-02T19:51:26.773

2 到 3 秒

# javascript - 如何获取远程图像以显示在画布中？

> ID：164181
> 
> 赞同：8
> 
> 时间：2008-10-02T19:42:28.713
> 
> 标签：javascript, image, canvas

如何从服务器获取图像？

我有这段代码可以让我在画布上绘制一些图像。

```
<html>
  <head>
    <script type="text/javascript">
      function draw(){
        var canvas = document.getElementById('canv');
        var ctx = canvas.getContext('2d');

        for (i=0;i<document.images.length;i++){
          ctx.drawImage(document.images[i],i*150,i*130);
        }
    }
    </script>
  </head>
  <body onload="draw();">
    <canvas id="canv" width="1024" height="1024"></canvas>
    <img src="http://www.google.com/intl/en_ALL/images/logo.gif">
    <img src="http://l.yimg.com/a/i/ww/beta/y3.gif">
    <img src="http://static.ak.fbcdn.net/images/welcome/welcome_page_map.png">
  </body>
</html> 
```

我不想循环遍历 document.images，而是想不断地从服务器获取图像。

```
for (;;) {
    /* how to fetch myimage??? */
    myimage = fetch???('http://myserver/nextimage.cgi');
    ctx.drawImage(myimage, x, y);
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-02T19:44:43.827

使用内置的[JavaScript Image 对象](http://www.w3schools.com/htmldom/dom_obj_image.asp)。

这是一个使用 Image 对象的非常简单的示例：

```
myimage = new Image();
myimage.src = 'http://myserver/nextimage.cgi'; 
```

这是对此答案的评论中更适合您的方案的机制。

谢谢奥利耶！[_](https://stackoverflow.com/users/784/olliej)

> 值得注意的是，您不能同步请求资源，因此您实际上应该执行以下操作：

```
myimage = new Image();
myimage.onload = function() {
                     ctx.drawImage(myimage, x, y);
                 }
myimage.src = 'http://myserver/nextimage.cgi'; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-03T02:03:55.647

如果要将图像绘制到画布上，还需要等待图像实际加载，因此正确的做法是：

```
myimage = new Image();
myimage.onload = function() {
    context.drawImage(myimage, ...);
}
myimage.src = 'http://myserver/nextimage.cgi'; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T19:47:04.227

要在 JavaScript 中添加图像，您可以执行以下操作：

```
myimage = new Image()
myimage.src='http://....' 
```

如果您页面上的图像的 ID 为“image1”，您可以将 image1 的 src 分配给 myimage.src。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-09T15:52:16.500

我发现在这里使用原型非常有帮助。如果您不熟悉它们，原型是对象的一部分，允许您为它们设置自己的变量和/或方法。

做类似的事情：

```
Image.prototype.position = {
    x: 0,
    y: 0
}

Image.prototype.onload = function(){
    context.drawImage(this, this.position.x, this.position.y);
} 
```

允许您在没有太多工作的情况下设置位置并绘制到画布上。

“位置”变量允许您在画布上移动它。
所以可以这样做：

```
var myImg = new Image();
myImg.position.x = 20;
myImg.position.y = 200;
myImg.src = "http://www.google.com/intl/en_ALL/images/logo.gif"; 
```

并且图像将自动在 (20,200) 处绘制到画布上。

原型适用于所有 HTML 和原生 Javascript 对象。所以

```
Array.prototype.sum = function(){
    var _sum = 0.0;
    for (var i=0; i<this.length; i++){
        _sum += parseFloat(this[i]);
    }
    return _sum;
} 
```

给所有数组一个新函数。

然而，

```
var Bob;
Bob.Prototype.sayHi = function(){
    alert("Hello there.");
} 
```

不起作用（出于多种原因，但我只会谈论原型）。
Prototype 是一种“属性”，它包含您输入的所有属性/方法，并且已经存在于每个 HTML 和本机 Javascript 对象中（不是您制作的对象）。
原型还允许轻松调用（您可以使用 "myImg.position.x" 而不是 "myImg.prototype.position.x" ）。

此外，如果您要定义变量，则应该更像这样。

```
var Bob = function(){
    this.sayHi = function(){
        alert("Hello there.");
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-12-17T03:51:18.400

使用承诺：

```
class App {
  imageUrl = 'https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE4HZBo'

  constructor(dom) {
    this.start(dom)
  }

  async start(dom) {
    const appEl = dom.createElement('div')
    dom.body.append(appEl)

    const imageEl = await this.loadImage(this.imageUrl)

    const canvas = dom.createElement('canvas')
    canvas.width = imageEl.width
    canvas.height = imageEl.height
    const ctx = canvas.getContext('2d')
    ctx.drawImage(imageEl, 0, 0)

    appEl.append(canvas)
  }

  loadImage = async (url) => 
    new Promise((resolve) => {
      const imageEl = new Image()
      imageEl.src = url
      imageEl.onload = () => resolve(imageEl)
    })
}

new App(document)
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-02T19:55:03.863

如果你使用 jQuery，你可以这样做：

```
$.('<img src="http://myserver/nextimage.cgi" />').appendTo('#canv'); 
```

您还可以在 img 标签中添加宽度和其他任何内容。

# c# - 如何使用 Linq to Xml 获取单个 XElement 对象？

> ID：164192
> 
> 赞同：3
> 
> 时间：2008-10-02T19:45:11.860
> 
> 标签：c#, .net, linq-to-xml

我想使用 Linq to Xml 通过属性名称从 .xml 文件中获取单个 XElement，类似于在下面通过 Id 在 Linq to Sql 中检索单个对象的方式：

```
var singleDog = context.Dogs.Single(p => p.Id == int.Parse(Id)); 
```

这可能吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T19:56:03.330

绝对地。只需使用类似的东西：

```
xdoc.Descendants()
    .Where(x => x.HasAttribute("id") && x.Attribute("id")==id)
    .Single(); 
```

诚然，可能有一种更有效的方法......

# c - 为什么写入用字符串文字初始化的“char *s”而不是“char s[]”时会出现分段错误？

> ID：164194
> 
> 赞同：319
> 
> 时间：2008-10-02T19:45:21.547
> 
> 标签：c, segmentation-fault, c-strings

以下代码在第 2 行收到 seg 错误：

```
char *str = "string";
str[0] = 'z';  // could be also written as *str = 'z'
printf("%s\n", str); 
```

虽然这工作得很好：

```
char str[] = "string";
str[0] = 'z';
printf("%s\n", str); 
```

使用 MSVC 和 GCC 测试。

* * *

## 回答 #1

> 赞同：266
> 
> 时间：2008-10-02T19:54:04.863

请参阅 C 常见问题解答，[问题 1.32](http://c-faq.com/decl/strlitinit.html)

> **问**：这些初始化有什么区别？
> `char a[] = "string literal";`
> `char *p = "string literal";`
> 如果我尝试将新值分配给`p[i]`.
> 
> **答**：字符串文字（C 源代码中双引号字符串的正式术语）可以以两种略有不同的方式使用：
> 
> 1.  作为 char 数组的初始值设定项，就像在 的声明中一样`char a[]`，它指定了该数组中字符的初始值（如果需要，还指定它的大小）。
> 2.  在其他任何地方，它都会变成一个未命名的静态字符数组，并且这个未命名的数组可能存储在只读存储器中，因此不一定可以修改。在表达式上下文中，数组像往常一样立即转换为指针（参见第 6 节），因此第二个声明初始化 p 以指向未命名数组的第一个元素。
> 
> 一些编译器有一个开关来控制字符串文字是否可写（用于编译旧代码），有些编译器可能有选项可以使字符串文字被正式视为 const char 数组（以便更好地捕获错误）。

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2008-10-02T19:49:29.650

通常，字符串文字在程序运行时存储在只读内存中。这是为了防止您意外更改字符串常量。在您的第一个示例中，`"string"`存储在只读内存中并`*str`指向第一个字符。当您尝试将第一个字符更改为`'z'`.

在第二个示例中，编译器将字符串`"string"`从其只读主*目录复制*`str[]`到数组中。然后允许更改第一个字符。您可以通过打印每个地址来检查：

```
printf("%p", str); 
```

此外，在第二个示例中打印的大小`str`将显示编译器已为其分配了 7 个字节：

```
printf("%d", sizeof(str)); 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-10-03T10:40:57.233

这些答案中的大多数都是正确的，但只是为了增加一点清晰度......

人们所指的“只读存储器”是 ASM 术语中的文本段。它与内存中加载指令的位置相同。出于安全等明显原因，这是只读的。当您创建一个初始化为字符串的 char* 时，字符串数据被编译到文本段中，程序初始化指针以指向文本段。所以如果你试图改变它，kaboom。段错误。

当编写为数组时，编译器会将初始化的字符串数据放在数据段中，这与您的全局变量等存在的位置相同。该内存是可变的，因为数据段中没有指令。这一次，当编译器初始化字符数组（仍然只是一个 char*）时，它指向的是数据段而不是文本段，您可以在运行时安全地更改它。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2015-06-05T08:50:02.833

> 为什么写入字符串时会出现分段错误？

**C99 N1256 草案**

字符串字面量有两种不同的用法：

1.  初始化`char[]`：

    ```
    char c[] = "abc"; 
    ```

    这是“更神奇”，并在 6.7.8/14“初始化”中描述：

    > 字符类型的数组可以由字符串字面量初始化，可选地用大括号括起来。字符串文字的连续字符（如果有空间或数组大小未知，则包括终止的空字符）初始化数组的元素。

    所以这只是一个捷径：

    ```
    char c[] = {'a', 'b', 'c', '\0'}; 
    ```

    像任何其他常规数组一样，`c`可以修改。

2.  在其他任何地方：它会生成：

    *   未命名
    *   char 数组[C 和 C++ 中的字符串文字类型是什么？](https://stackoverflow.com/questions/2245664/what-is-the-type-of-string-literals-in-c-c)
    *   带静态存储
    *   如果修改，则给出 UB

    所以当你写：

    ```
    char *c = "abc"; 
    ```

    这类似于：

    ```
    /* __unnamed is magic because modifying it gives UB. */
    static char __unnamed[] = "abc";
    char *c = __unnamed; 
    ```

    `char[]`请注意从to的隐式转换`char *`，这始终是合法的。

    那么你修改了`c[0]`，你也修改`__unnamed`了，也就是UB。

    这记录在 6.4.5“字符串文字”中：

    > 5 在翻译阶段 7 中，将一个字节或零值代码附加到每个由一个或多个字符串文字产生的多字节字符序列。然后使用多字节字符序列来初始化一个静态存储持续时间和长度刚好足以包含该序列的数组。对于字符串文字，数组元素的类型为 char，并使用多字节字符序列的各个字节初始化 [...]
    > 
    > 6 如果这些数组的元素具有适当的值，则未指定这些数组是否不同。如果程序尝试修改这样的数组，则行为未定义。

6.7.8/32“初始化”给出了一个直接的例子：

> 例 8：声明
> 
> ```
> char s[] = "abc", t[3] = "abc"; 
> ```
> 
> 定义“普通”字符数组对象`s`，`t`其元素用字符串字面量初始化。
> 
> 此声明与
> 
> ```
> char s[] = { 'a', 'b', 'c', '\0' },
> t[] = { 'a', 'b', 'c' }; 
> ```
> 
> 数组的内容是可修改的。另一方面，声明
> 
> ```
> char *p = "abc"; 
> ```
> 
> 定义`p`类型为“pointer to char”并将其初始化为指向长度为 4 的类型为“char 数组”的对象，其元素使用字符串字面量进行初始化。如果尝试使用`p`来修改数组的内容，则行为未定义。

**GCC 4.8 x86-64 ELF 实现**

程序：

```
#include <stdio.h>

int main(void) {
    char *s = "abc";
    printf("%s\n", s);
    return 0;
} 
```

编译和反编译：

```
gcc -ggdb -std=c99 -c main.c
objdump -Sr main.o 
```

输出包含：

```
 char *s = "abc";
8:  48 c7 45 f8 00 00 00    movq   $0x0,-0x8(%rbp)
f:  00 
        c: R_X86_64_32S .rodata 
```

结论：GCC 将`char*`其存储在`.rodata`section 中，而不是`.text`.

如果我们对`char[]`:

```
 char s[] = "abc"; 
```

我们获得：

```
17:   c7 45 f0 61 62 63 00    movl   $0x636261,-0x10(%rbp) 
```

所以它被存储在堆栈中（相对于`%rbp`）。

但是请注意，默认链接描述文件将`.rodata`和`.text`放在同一段中，该段具有执行但没有写权限。这可以通过以下方式观察到：

```
readelf -l a.out 
```

其中包含：

```
 Section to Segment mapping:
  Segment Sections...
   02     .text .rodata 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-10-02T19:50:27.447

在第一个代码中，“string”是一个字符串常量，并且永远不应该修改字符串常量，因为它们通常被放置在只读内存中。“str”是用于修改常量的指针。

在第二个代码中，“string”是一个数组初始值设定项，是

```
char str[7] =  { 's', 't', 'r', 'i', 'n', 'g', '\0' }; 
```

“str”是分配在栈上的数组，可以自由修改。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-02T19:49:21.303

因为在`"whatever"`第一个示例的上下文中的类型是`const char *`（即使您将其分配给非常量字符 *），这意味着您不应该尝试写入它。

编译器通过将字符串放入内存的只读部分来强制执行此操作，因此写入它会产生段错误。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-02T19:50:12.533

```
char *str = "string"; 
```

上面的设置`str`指向`"string"`在程序的二进制图像中硬编码的文字值，这可能在内存中被标记为只读。

`str[0]=`尝试写入应用程序的只读代码也是如此。我猜这可能是编译器依赖的。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-12-07T13:34:30.033

要理解这个错误或问题，您应该首先了解指针和数组的区别，所以首先我在这里向您解释它们的区别

### 字符串数组

```
 char strarray[] = "hello"; 
```

在内存数组中存储在连续的内存单元中，按`[h][e][l][l][o][\0] =>[]`1 char 字节大小的内存单元存储，并且可以通过此处名为 strarray 的名称访问此连续的内存单元。所以这里的字符串数组`strarray`本身包含初始化到它的字符串的所有字符。在此case 在这里`"hello"` ，所以我们可以通过索引值访问每个字符来轻松更改其内存内容

```
`strarray[0]='m'` it access character at index 0 which is 'h'in strarray 
```

并且它的值更改为`'m'`所以 strarray 值更改为`"mello"`;

这里需要注意一点，我们可以通过逐个字符更改字符串数组的内容，但不能直接初始化其他字符串，就像`strarray="new string"`是无效的一样

### 指针

众所周知，指针指向内存中的内存位置，未初始化的指针指向随机内存位置，因此初始化后指向特定的内存位置。

```
char *ptr = "hello"; 
```

这里指针 ptr 被初始化为字符串`"hello"`，它是存储在只读存储器 (ROM) 中的常量字符串，因此`"hello"`不能更改，因为它存储在 ROM 中

ptr 存储在堆栈部分并指向常量字符串`"hello"`

所以 ptr[0]='m' 无效，因为您无法访问只读内存

但是 ptr 可以直接初始化为其他字符串值，因为它只是指针，因此它可以指向其数据类型的变量的任何内存地址

```
ptr="new string"; is valid 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-02T19:51:06.463

```
char *str = "string"; 
```

分配一个指向字符串文字的指针，编译器将其放入可执行文件的不可修改部分；

```
char str[] = "string"; 
```

分配并初始化一个可修改的局部数组

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-02T20:00:45.317

@matli 链接到的 C 常见问题解答提到了它，但这里还没有其他人，所以为了澄清：如果在初始化字符数组*之外*的任何地方使用字符串文字（源代码中的双引号字符串）（即：@马克的第二个例子，它工作正常），该字符串由编译器存储在一个特殊的*静态字符串表中*，这类似于创建一个本质上是匿名的全局静态变量（当然是只读的）（没有变量“名称”）。*只读*部分是重要部分，这也是@Mark 的第一个代码示例出现段错误的原因。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-02T19:54:04.707

这

```
 char *str = "string"; 
```

line 定义一个指针并将其指向一个文字字符串。文字字符串是不可写的，所以当你这样做时：

```
 str[0] = 'z'; 
```

你得到一个段错误。在某些平台上，文字可能位于可写内存中，因此您不会看到段错误，但无论如何它都是无效代码（导致未定义的行为）。

该行：

```
char str[] = "string"; 
```

分配一个字符数组，并将字面量字符串**复制**到该数组中，该数组是完全可写的，所以后续更新没有问题。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-02T19:51:59.627

像“string”这样的字符串文字可能作为只读数据分配在可执行文件的地址空间中（给予或接受你的编译器）。当你去触摸它时，它会吓坏你在它的泳衣区，并让你知道一个段错误。

在您的第一个示例中，您将获得指向该 const 数据的指针。在您的第二个示例中，您正在使用 const 数据的副本初始化一个包含 7 个字符的数组。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-01-19T23:00:19.210

```
// create a string constant like this - will be read only
char *str_p;
str_p = "String constant";

// create an array of characters like this 
char *arr_p;
char arr[] = "String in an array";
arr_p = &arr[0];

// now we try to change a character in the array first, this will work
*arr_p = 'E';

// lets try to change the first character of the string contant
*str_p = 'G'; // this will result in a segmentation fault. Comment it out to work.

/*-----------------------------------------------------------------------------
 *  String constants can't be modified. A segmentation fault is the result,
 *  because most operating systems will not allow a write
 *  operation on read only memory.
 *-----------------------------------------------------------------------------*/

//print both strings to see if they have changed
printf("%s\n", str_p); //print the string without a variable
printf("%s\n", arr_p); //print the string, which is in an array. 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-02T19:55:16.110

首先，`str`是一个指向 的指针`"string"`。允许编译器将字符串文字放在内存中您无法写入但只能读取的位置。（这确实应该触发警告，因为您将 a 分配`const char *`给 a `char *`。您是否禁用了警告，或者您只是忽略了它们？）

其次，您正在创建一个数组，这是您可以完全访问的内存，并使用`"string"`. 您正在创建一个`char[7]`（六个用于字母，一个用于终止 '\0'），并且您可以随心所欲地使用它。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-02-04T14:09:37.850

假设字符串是，

```
char a[] = "string literal copied to stack";
char *p  = "string literal referenced by p"; 
```

在第一种情况下，当 'a' 进入范围时，将复制文字。这里 'a' 是在堆栈上定义的数组。这意味着将在堆栈上创建字符串，并将其数据从代码（文本）内存中复制，该内存通常是只读的（这是特定于实现的，编译器也可以将此只读程序数据放入可读写内存中）。

在第二种情况下，p 是在堆栈（本地范围）上定义的指针，并引用存储在其他位置的字符串文字（程序数据或文本）。通常修改这样的内存不是好的做法，也不鼓励。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-08-31T21:49:58.710

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-10-11T08:42:52.550

首先是一个不能修改的常量字符串。其次是具有初始化值的数组，因此可以对其进行修改。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-08-01T05:10:54.933

`Section 5.5 Character Pointers and Functions`of`K&R`还讨论了这个话题：

> 这些定义之间有一个重要区别：
> 
> `char amessage[] = "now is the time"; /* an array */`
> `char *pmessage = "now is the time"; /* a pointer */`
> 
> `amessage`是一个数组，大到足以容纳字符序列并`'\0'`对其进行初始化。数组中的单个字符可能会更改，但`amessage`始终引用相同的存储。另一方面，`pmessage`是一个指针，初始化为指向一个字符串常量；指针可能随后被修改为指向别处，但如果您尝试修改字符串内容，则结果未定义。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2013-01-03T19:03:45.657

当您尝试访问无法访问的内存时会导致分段错误。

`char *str`是指向不可修改的字符串的指针（出现段错误的原因）。

而是`char str[]`一个数组，可以修改..

# asp.net - 从网页打印条形码标签

> ID：164197
> 
> 赞同：13
> 
> 时间：2008-10-02T19:45:36.040
> 
> 标签：asp.net, html, css, printing

我正在开发一个 ASP.Net Web 应用程序，该应用程序必须在标准 Avery 样式的标签表上打印动态创建的标签（一种特定的尺寸，所以只有一种整体布局）。标签具有可变数量的行 (3-6)，可能包含文本行或图形条形码图像。

我继承的第一个剪裁使用等宽字体来减少格式问题，但这不允许足够的文本适合标签，客户不满意。基本上它是格式化的文本。

我的下一个版本使用 TABLE、DIV、CSS 和一些 JavaScript 计算来使用比例字体格式化标签。它仍然需要一些调整（用户必须正确设置打印边距并关闭打印页眉和页脚），但它似乎工作。

然而，不同的打印机如何呈现文本似乎存在一些差异（WYS 不是 WYG），所以即使我们使用至少两种不同的打印机（喷墨打印机和激光打印机）在不同的浏览器上进行测试，一些用户的标签不要排队。可以通过调整页面设置对话框上的边距来调整轻微的边距变化，但更难的问题是标签间的间距可能会偏离一英寸的一小部分，所以如果第一个标签居中很好，通过页面末尾标签文本和图像已从标签的顶部或底部爬出。

我们即将切换到生成 Word、Excel 或 PDF 输出，这将需要相当多的开发时间，并且可能会在打印过程中添加额外的步骤。

那么，是否有人对如何在不同类型的打印机上精确呈现 HTML/CSS 布局有任何建议？我真的不在乎换行符/分词符是否有点不同，但我需要能够可预测地定位每个标签区域的左上角。

现在，标签在表格中顺着页面向下流动，我们一直在调整单元格和内部 DIV 的框模型，以使它们具有统一的高度。我怀疑使用每个元素的绝对定位可能是最好的答案，但由于标签元素的 ASP.Net 生成，这也会很棘手。如果我确定这会起作用，我宁愿尝试它，也不愿放弃我们必须采用不同的生成方法的所有东西。

轻微更新：现在我正在做一些绝对定位的测试 - 只设置包含块元素的顶部和左侧坐标。到目前为止，页面上的偏移量（页边距、纸张对齐方式等）有细微的变化，但所有测试的浏览器和打印机都将元素放在相对于彼此的正确位置***。***我很欣赏 PDF 提示，但有人知道以这种方式使用绝对定位的其他“陷阱”吗？

**更新：** 作为记录，我使用 iTextSharp 重写了标签打印部分，它运行良好 - 绝对是将来这样做的方式......

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-02T19:48:13.723

忘记 HTML 并制作 PDF。HTML 打印非常多变——不仅跨浏览器，而且跨同一浏览器的不同版本。PDF更容易。

即使您使用一个浏览器/字体设置/打印机/月相完全正确，它也将是您必须维护的最脆弱的东西。无论您认为制作 PDF 需要多长时间（而且这并不难，因为那里有一些免费的库），HTML 最终会花费您更多的时间。与 Word 文件相比，PDF 阅读器被广泛部署和打印更一致。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T19:48:53.957

网络不是保证获得一致打印结果的格式。鉴于使用 MS Word 对标签打印的标准支持，以及自动化和生成的相对简单性，我强烈建议采用这条路线。

在使用 Web 内容时，我不知道有任何方法可以在所有类型的浏览器、操作系统和打印机上进行精确打印。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T19:51:00.957

“精确”和“打印”这两个词并不能很好地协同工作。大约一年前，我做了一个 OCR/OMR 应用程序，即使在构建 PDF 时，我也看到了不同打印驱动程序等之间的显着差异。正因为如此，我的直觉是告诉你，你可能不会有 100% 的成功。

如果 CSS 和布局问题不适合您，您可能需要使用 GDI+ 将标签构建为图像——至少这样您可以使用 GetFontMetrics() 等。

祝你好运！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T19:52:17.863

我有一个类似的问题，答案是你不能这样做。相反，我使用 iTextSharp 实时生成了一个 PDF 文件并将其传递给响应。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-16T04:03:07.990

使用 SQL Server Reporting Services，我生成了一个 PDF 以发送到打印机，但它可以在屏幕上显示为 HTML，使用您可以包含在网页中的控件。互联网上提供了 RDLC 文件，可打印为各种 Avery 格式。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-11-12T21:10:57.180

我重写了本周在 2011 年提到的 SharpPDFLabel 代码，因为我需要它更加灵活（并与当前的 iTextSharp 库一起使用）。

你可以在这里得到它： [https ://github.com/finalcut/SharpPDFLabel](https://github.com/finalcut/SharpPDFLabel)

如果需要，我添加了指定每个标签内容的功能（或者继续创建一张相同的标签）。通过扩展`LabelDefinition`类，您可以很容易地指定标签的布局。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-15T07:43:01.880

由于跨浏览器的打印行为不一致，我还为 HTML/CSS 方法而苦苦挣扎。

我创建了一个 C# 库来从 ASP.NET 生成 Avery 标签，希望您会发现它有用：

[https://github.com/wheelibin/SharpPDFLabel#readme](https://github.com/wheelibin/SharpPDFLabel#readme)

您可以将图像和文本添加到标签中，并且可以轻松定义更多标签类型。

*（我将它用于条形码标签，条形码生成为图像，然后使用此库添加到标签中。）*

干杯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T19:50:07.010

向您的应用程序添加一些选项，让用户根据他们的特定配置调整间距。如果需要，您可以将其包含在标签上，并通过媒体选择器对其进行样式化，但您可能也希望将它们保留在某个地方。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T16:23:15.630

Flash 也是推送可打印标签（如标签）的好方法，尽管实现和维护有点复杂。在大多数情况下，它的显示速度比 PDF 快得多，您可以将其嵌入到页面设计中，只需在 Flash 中添加一个“打印”按钮即可。

几年前，当我们使用 HTML 和 PDF 生成确认收据时，我这样做了。HTML 是“好的”，但受最终用户网络浏览器的支配，所以我们很快放弃了这种方法。只要有 PDF 阅读器，PDF 就很好，令我们惊讶的是，我们的很多客户都没有。因此，在我们使用包含一些动态文本区域和“打印”按钮的简单 Flash 电影切换到 FLASH 版本后，它也被转储了。我使用一些闪存变量在页面和闪存之间传递数据。您还可以使用网络服务。

当我需要的不仅仅是简单的文本时，我会使用来自[DynamicPDF.com](http://www.DynamicPDF.com)的 PDF 生成器组件的免费社区版。它工作得很好而且非常快。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-12-16T21:07:41.843

我刚刚经历了同样的事情。最后切换并制作了一个简短的 JSF 小应用程序（在 Glassfish 上运行），它使用 JasperReports 直接打印到标签打印机。按钮，打印机上的即时标签，如果您不想，甚至不必在屏幕上查看它，因为 Jasper 可以直接输出到打印机（以及浏览器中的 PDF）。

# visual-studio - 如何将 EULA 添加到 VS2008 安装项目？

> ID：164247
> 
> 赞同：12
> 
> 时间：2008-10-02T19:52:16.397
> 
> 标签：visual-studio, visual-studio-2008, setup-project, eula

这是一个非常简单的问题，答案很简单，但是在互联网上找到答案并不是那么简单。

我在 Visual Studio 2008 中有一个简单的安装（部署）项目，并且我有 EULA 文本。我需要在项目中做什么才能将 EULA 放入安装向导中？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-02T19:54:26.890

这就是您在 vs2003 和 vs2005 中执行操作的方式，我不相信他们已经进行了更改，但我还没有运行 vs2008，所以我不能确定。

右键单击安装项目，选择查看->用户界面。

在“开始”部分，右键单击，然后选择添加对话框。选择许可证对话框。

将许可对话框指向一个 RTF 文件。

# c# - App.config 文件控制台应用程序中的保护部分

> ID：164268
> 
> 赞同：6
> 
> 时间：2008-10-02T19:55:49.713
> 
> 标签：c#, .net, encryption, configuration

我正在尝试加密控制台应用程序的 App.config 文件中的`appSettings`and`connectionStrings`部分。出于某种原因`section.SectionInformation.IsProtected`，总是返回 true。

```
static void Main(string[] args)
{
    EncryptSection("connectionStrings", "DataProtectionConfigurationProvider"); 
}

private static void EncryptSection(string sectionName, string providerName)
{
    string assemblyPath = Assembly.GetExecutingAssembly().Location;
    Configuration config = ConfigurationManager.OpenExeConfiguration(assemblyPath);

    ConfigurationSection section = config.GetSection(sectionName);

    if (section != null && !section.SectionInformation.IsProtected)
    {
        section.SectionInformation.ProtectSection(providerName);
        config.Save(); 
    }
} 
```

不知道为什么它总是返回 true。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:38:47.283

您的代码会打开当前的应用程序配置。你可以试试这个：

```
static void Main(string[] args)
{
    if (args.Length != 0)
    {
        Console.Error.WriteLine("Usage : Program.exe <configFileName>"); // App.Config
    }
    EncryptSection(args[0], "connectionStrings", "DataProtectionConfigurationProvider");
}

private static void EncryptSection(string configurationFile, string sectionName, string providerName)
{
    Configuration config = ConfigurationManager.OpenExeConfiguration(configurationFile);
    ConfigurationSection section = config.GetSection(sectionName);

    if (section != null && !section.SectionInformation.IsProtected)
    {
        section.SectionInformation.ProtectSection(providerName);
        config.Save();
    }
} 
```

# javascript - 无论如何将Firebug'profile'结果记录到外部文件？

> ID：164282
> 
> 赞同：2
> 
> 时间：2008-10-02T20:00:17.033
> 
> 标签：javascript, debugging, firebug

具体来说，我们的网站上有一些外部 JavaScript 跟踪代码，每次点击锚点时，它们都会陷入无限循环。

我们不维护跟踪代码，因此我们不知道它是如何工作的。由于代码导致浏览器几乎立即锁定，我想知道是否有办法将 Firebug 的“配置文件”功能的结果记录到外部文件以供审查？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T20:17:33.187

也许通过修改 firebug 本身或创建 firebug 插件，您可以将数据记录到首选项或 sqllite。但是 Firefox 不授予对普通旧 javascript 的写访问权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T22:37:06.767

您应该能够通过在有问题的 JavaScript 中设置断点来缩小范围。它可能很混乱（特别是如果他们“缩小”他们的 JavaScript），但我认为这是你最好的选择。

# php - 如何使用 php 脚本可读的 wininet 传输文件？

> ID：164284
> 
> 赞同：4
> 
> 时间：2008-10-02T20:00:42.557
> 
> 标签：php, c++, windows, wininet

我想使用 wininet 将文本文件传输到网络服务器，就像使用将文件发布到服务器的网络表单传输文件一样。

根据我收到的答案，我尝试了以下代码：

```
 static TCHAR hdrs[] = "Content-Type: multipart/form-data\nContent-Length: 25";
 static TCHAR frmdata[] = "file=filename.txt\ncontent";

   HINTERNET hSession = InternetOpen("MyAgent",
      INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL, 0);
   HINTERNET hConnect = InternetConnect(hSession, "example.com",
      INTERNET_DEFAULT_HTTP_PORT, NULL, NULL, INTERNET_SERVICE_HTTP, 0, 1);
   HINTERNET hRequest = HttpOpenRequest(hConnect, "POST", "test.php", NULL, NULL, NULL, 0, 1);
   HttpSendRequest(hRequest, hdrs, strlen(hdrs), frmdata, strlen(frmdata));"); 
```

test.php 脚本正在运行，但它似乎没有得到正确的数据。

任何人都可以给我任何额外的帮助或寻找的地方吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T20:43:46.057

让我们一步一步来。

首先涉及的 HTTP 标头：

1.  内容类型：多部分/表单数据
2.  内容长度：<这取决于内容字节的总和>

然后，您必须使用 POST 表单的内容构建一个字符串。假设您有输入命名文件：

> file=filename.txt
> **<您现在在回车后添加文件内容>**

你计算这个字符串的长度并放在上面的 Content-Length 上。

好的，完整的 HTTP 请求如下所示：

```
POST /file_upload.php HTTP/1.0
Content-type: multipart/form-data
Content-length: <calculated string's length: integer>

file=filename.txt
...File Content... 
```

现在来自 PHP 手册的一些代码：

```
<?php
// In PHP versions earlier than 4.1.0, $HTTP_POST_FILES should be used instead
// of $_FILES.

$uploaddir = '/var/www/uploads/';
$uploadfile = $uploaddir . basename($_FILES['file']['name']);

echo '<pre>';
if (move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)) {
    echo "File is valid, and was successfully uploaded.\n";
} else {
    echo "Possible file upload attack!\n";
}

echo 'Here is some more debugging info:';
print_r($_FILES);

print "</pre>";

?> 
```

了解我，我可能弄乱了内容的格式，但这是一般的想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T14:54:12.267

将我上面的表单数据和标题更改为以下解决了该问题：

```
 static TCHAR frmdata[] = "-----------------------------7d82751e2bc0858\nContent-Disposition: form-data; name=\"uploadedfile\"; filename=\"file.txt\"\nContent-Type: text/plain\n\nfile contents  here\n-----------------------------7d82751e2bc0858--";
  static TCHAR hdrs[] = "Content-Type: multipart/form-data; boundary=---------------------------7d82751e2bc0858"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T20:04:06.713

[这](http://msdn.microsoft.com/en-us/library/aa384322(VS.85).aspx#Posting_data_to_the_)是对其中涉及的事物的一般描述。基本上，您必须创建一个对 Web 地址的 HTTP 请求，将信息附加到请求中，然后发送它。在您的情况下，该请求必须是 POST 请求。

# .net - 在 .NET 中编写计划的 Windows 服务

> ID：164286
> 
> 赞同：3
> 
> 时间：2008-10-02T20:01:02.553
> 
> 标签：.net, windows-services

我想编写一个用户可以安排的 Windows 服务。即用户可以选择每天上午 9:00 到下午 6 点运行服务，也可以每天晚上运行，从晚上 12 点开始到第二天早上 6 点，等等。 box .NET API 可以帮助我做到这一点吗？我知道我可以使用计划任务来做到这一点，但是有没有办法以编程方式做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T20:09:16.467

我使用[Quartz.NET](http://quartznet.sourceforge.net/)在 Windows 服务中执行计划任务取得了很好的效果。您可以做任何事情，从简单的间隔调度到 cron 样式的调度。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-02T20:07:00.573

我的第一反应是质疑为什么要提供服务？但更重要的是，问题是为什么不使用操作系统提供的强大调度器呢？

也就是说，Windows 服务几乎只是您的应用程序在其中运行的一个线程。您可以将它分为两​​部分，第一部分是在计时器上执行的服务本身。服务的启动可以检查注册表值以确定它应该执行的频率。

该服务的第二部分将是一个小的 Windows 应用程序，它允许用户设置计划，当然，还可以将其写入前面提到的注册表值。

您不需要任何类型的特殊 API。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T20:10:51.813

如果您不希望用户必须处理任务调度程序，那么您应该编写一个程序，让他们选择运行程序的日期和时间，然后您以编程方式为他们设置计划任务。这样他们就不必具体了解您正在运行的进程，也不必知道如何使用任务调度程序。他们只是从您的应用程序中完成所有操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T20:05:17.833

如果您要安排它，只需构建一个控制台程序并向安装程序添加一些代码，以帮助用户在 Windows 中设置计划任务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-20T18:09:36.110

我实现了一些无人值守的服务（用 c# 编写的 Windows 服务），使用 crontab 算法来管理调度。该模式功能强大且灵活。我们可以在任何时间创建计划，只使用 cron 表达式。也许我错了，但我认为 cron 唯一没有涵盖的时间表是如果我们想要一个月的最后一天，但这从来都不是所有服务的要求。

我从互联网上的一篇文章（由 Atif Aziz 开源）中复制了 cron 算法，并在我的实用程序类中实现，多年来运行良好。

在我的博客中查看更多详细信息： [CronTab 调度解析器算法](http://blog.robertolopes.com/2010/11/17/crontab-schedule-parser-algorithm/)

干杯!

罗伯托

# java - 如何避免 BIRT 中的表和组内的分页符？

> ID：164292
> 
> 赞同：1
> 
> 时间：2008-10-02T20:02:16.047
> 
> 标签：java, eclipse, report, birt

使用 BIRT 2.3.1 创建报告时，我不希望在表格或组中出现分页符；如果表格不适合页面上的可用空间，我想将整个元素放在下一页中。

使用以前版本的 BIRT 可以将 pageBreakInside 设置为“避免”，但它不起作用。在 BIRT 2.3.1 中，这个（无用的）选项被删除了，因为它没有正确实现。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-19T06:17:01.993

这是报告中的“难题”之一。试图在 2.3 中获得它，但我们错过了，而不是让人们认为他们做错了什么（当它不起作用时），我们在 2.3.1 中将其退出。

这是 2.5（2009 年 6 月）的优先级列表。很抱歉让我们失望了，我们只是没时间了。

# wcf - 使用 WCF 和 NetMsmqBinding 时如何指定消息标签？

> ID：164295
> 
> 赞同：3
> 
> 时间：2008-10-02T20:02:59.163
> 
> 标签：wcf, msmq

我想使用 NetMsmqBinding 设置 MSMQ 消息标签。我知道[使用 MsmqIntegrationBinding 很容易](http://blogs.msdn.com/skaufman/archive/2007/12/17/msmq-label-property-and-wcf.aspx)，但我想继续使用 NetMsmqBinding （如果可能的话，**甚至调用私有方法**）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-25T05:30:59.360

我认为这是一个有趣的问题。不幸的是，从我所看到的一切来看，您似乎无法使用 NetMsmqBinding 访问传出 MSMQ 消息上的 Label 属性。

以下是我遇到的一些链接：

*   [http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/3389679b-a130-4e83-bb4c-1b522c216227/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/3389679b-a130-4e83-bb4c-1b522c216227/)

*   [http://blogs.msdn.com/skaufman/archive/2007/12/17/msmq-label-property-and-wcf.aspx](http://blogs.msdn.com/skaufman/archive/2007/12/17/msmq-label-property-and-wcf.aspx)

我找不到任何可以确切解释原因的东西，但推理是有道理的——NetMsmqBinding 没有公开任何特定于 System.Messaging 的东西，因此绑定本身可以轻松地换成另一个绑定，而无需更改任何代码。正如您所说，MsmqIntegrationBinding 与 System.Messaging 概念紧密耦合，因此您可以访问所有 System.Messaging 内容，但代价是与其他绑定的可互换性。如果设置标签很重要，最简单的方法可能是只使用 msmqIntegrationBinding。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T02:24:35.580

George：没有答案，但我很想知道您打算如何将 MSMQ 标签与 NetMsmqBinding 一起使用。

我问的原因是 NetMsmqBinding 真的是为了支持发送和接收端点都是 WCF 应用程序的场景而创建的，所以此时您不妨将所需的任何带外数据粘贴在消息头中...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-28T08:12:47.890

使用 OperationContext.Current.IncomingMessageProperties.Values

# migration - 如何升级 PowerBuilder 代码？

> ID：164297
> 
> 赞同：2
> 
> 时间：2008-10-02T20:03:57.447
> 
> 标签：migration, powerbuilder

我有来自 PowerBuilder 5 的无法构建的代码。编译器在完成之前停止，没有任何错误代码。

我想将代码升级到 PowerBuilder 的最新版本，但有一些 PowerBuilder 的中间版本与旧的 Microsoft java dll 具有二进制依赖关系，由于某些法庭案件，Microsoft 不再可以分发该 dll。

那么，有没有办法让我的代码在更新的环境中运行？

/约翰/

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-03T04:26:23.260

首先，您不需要使用“PowerBuilder 的中间版本”来迁移到当前版本，所以即使这个 java DLL 依赖项对我来说听起来有问题（至少它没有响铃），除非它影响 PowerBuilder 的目标版本。

对于迁移，您可能需要查看此[迁移指南](http://www.techno-kitten.com/PowerBuilder_Help/PowerBuilder_Migration/powerbuilder_migration.html "PB 迁移指南")，以及可能影响您[的 PB 更改列表。](http://www.techno-kitten.com/Changes_to_PowerBuilder/changes_to_powerbuilder.html "对 PB 的更改")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T03:33:15.087

非常不寻常的声音问题。您可以尝试将代码迁移到更新版本的 PowerBuilder，看看它是否会编译或至少会失败，但会给您一些有用的错误消息。

我还建议将其发布在 Sybase 新闻组的 PowerBuilder 部分。他们非常活跃，充满了一些经验丰富的优秀 PB 头脑。您可以在此处找到它们： [http ://forums.sybase.com](http://forums.sybase.com)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T05:05:38.487

从这里：[http ://forums.sybase.com/cgi-bin/webnews.cgi?cmd=item-4558&group=sybase.public.powersite](http://forums.sybase.com/cgi-bin/webnews.cgi?cmd=item-4558&group=sybase.public.powersite)

我刚刚了解到“严重”消息和 psdwc70.dll 无法自行注册的消息的组合可能是因为 msjava.dll 不存在和/或在您的计算机上注册。psdwc70.dll 文件依赖于 msjava.dll 才能正确安装。

/约翰/

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T02:56:29.747

您是否尝试过在 PB5 中导出代码并在新版本中导入？

# windows - Windows 在无头构建期间挂起

> ID：164304
> 
> 赞同：3
> 
> 时间：2008-10-02T20:05:22.450
> 
> 标签：windows, installation, build-process

我们正在尝试自动化构建我们的一个产品，其中包括使用 WISE 打包一些东西的步骤。有一次，WISE 会弹出一个窗口，上面有一个进度条来显示它的运行情况。如果一个连接到具有远程桌面的机器，则构建工作正常，但如果一个未连接，则构建停止，直到您重新连接，此时窗口打开并进行构建。有人知道解决这个问题吗？某种诱使 Windows 相信已连接桌面会话的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T20:52:36.927

很抱歉再次猜测 - 但我遇到了一个聪明的安装程序锁定的问题。这是因为 WISE 安装了“字体”，所以会广播“系统配置已更改”消息。我的 DELL 上运行了一个戴尔实用程序，该实用程序有一个无法读取的消息队列，因此广播锁定了安装程序。WISE 为我制作了一个新版本，它进行了异步广播来解决问题。您的系统上可能有一个应用程序在没有桌面时不会打扰读取其消息队列。

最后是答案：检查您的 WISE 安装程序是否有最新补丁。特别是，寻找修复与窗口系统相关的锁定的补丁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T21:14:47.213

你用的是什么版本？查看功能集，看起来他们的“std”版本可能会受到限制。也许无人值守安装需要专业版？这只是一个猜测......

[无论如何，我想知道您是否可以简单地为调用CreateDesktop](http://msdn.microsoft.com/en-us/library/ms682124(VS.85).aspx)的框编写一个自动运行任务来假装有一个交互式登录？

我找到了一个关于桌面切换的[CreateDesktop 示例](http://www.codeproject.com/KB/cs/csdesktopswitching.aspx) ，以及[一个关于无人值守安装的示例](http://www.tech-archive.net/Archive/Development/microsoft.public.win32.programmer.kernel/2008-02/msg00083.html)——您可以使用其中一个作为起点来“伪造”WISE :)

可能值得一试...

# c++ - 使用 CodeSynthesis XSD 树映射的 C++ 类型

> ID：164305
> 
> 赞同：1
> 
> 时间：2008-10-02T20:05:25.057
> 
> 标签：c++, xsd, templates, types, codesynthesis

我正在使用 CodeSynthesis XSD C++/Tree Mapping 实用程序将现有的 xsd 转换为 c++ 代码，我们可以在其中填充值。这是我们始终确保遵循架构的原因。

完成转换后，我试图让它工作，以便我可以测试它。问题是，我不习惯在 C++ 中这样做，这是我第一次使用这个工具。

我从一个名为 ABSTRACTNETWORKMODEL 的类开始，其中包含类型`versno_type`和`fromtime_type` typedef'd。这是我尝试使用的构造函数以及 typedef

```
ABSTRACTNETWORKMODEL(const versno_type&, const fromtime_type&);
typedef ::xml_schema::double_ versno_type;
typedef ::xml_schema::time fromtime_type; 
```

所有这些都在 ABSTRACTNETWORKMODEL 类中，double_ 和 time 的定义是：

```
typedef ::xsd::cxx::tree::time<char, simple_type> time;
typedef double double_; 
```

其中 time 的定义是具有多个构造函数的类：

```
template<typename C, typename B>
class time: public B, public time_zone
{
  public:
  time(unsigned short hours, unsigned short minutes, double seconds);
  ...
} 
```

我知道我没有正确创建一个新的 ABSTRACTNETWORKMODEL，但我不知道我需要做什么。这是我目前要做的所有事情：

```
 ::xml_schema::time t();
  ABSTRACTNETWORKMODEL anm(1234, t); 
```

当然，这会引发关于转换第二个参数的错误，但是有人可以告诉我这是不正确的吗？或者至少为我指明正确的道路，因为我现在想做的一件事就是学习更多的 C++。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T18:13:44.703

我以前被这个咬过。如果该行：

```
::xml_schema::time t(); 
```

与您的代码中出现的完全一样（即使用括号），那么问题是您实际上并没有像您想的那样实例化一个对象。

要实例化您将使用的对象

```
::xml_schema::time t; 
```

相反，第一行声明了一个不带参数的函数 t() 并返回一个类型为 的对象`::xml_schema::time`。由于没有主体，编译器认为您稍后会定义该函数。它是完全合法的 C++，它是人们经常做的事情（比如，在头文件中），所以编译器接受它，不会发出警告，因为它无法知道这不是你的意思，并且会做一些你没有做的事情没想到。

当你将该函数传递给`ABSTRACTNETWORKMODEL`构造函数时，你会得到一个错误，因为你不能将函数作为参数传递（你可以传递一个指向函数的指针，你可以调用函数，传递结果临时）：

```
::xml_schema::time t();
ABSTRACTNETWORKMODEL anm(1234, t()); // calls t(), gets a temporary of type ::xml_schema::time, and passes the temporary to the constructor 
```

所以“时间的实例化没有导致错误”的原因是时间对象从未被实例化。time 类也没有默认构造函数，尝试使用正确的语法实例化 t 会引发您所期望的错误。

为了记录，在某些情况下需要括号。例如，当实例化一个临时对象并在同一行中操作该临时对象时：

```
int hours = time().get_hours(); // assuming that there is now a default constructor 
```

因为删除第一组括号会导致错误：

```
int hours = time.set_time("12:00:00am"); // error: there is a time class, but no object named "time" 
```

相信我，我真的很喜欢 C++，但语法有时会变得很难保持直截了当。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T21:24:33.773

在办公室里询问，看来我的问题不是创建 ABSTRACTNETWORKMODEL，而是实际上是 ::xml_schema::time。

我觉得奇怪的是时间的实例化并没有导致错误，因为它没有任何默认构造函数，或者即使模板和类型正确，它也没有被接受。

# ruby - 使用 MacPorts 在 Mac OS X 上安装 RMagick

> ID：164307
> 
> 赞同：10
> 
> 时间：2008-10-02T20:05:26.333
> 
> 标签：ruby, macos, imagemagick, gem, rmagick

安装了 ImageMagick 6.4.4 的 MacPorts 版本后，安装 RMagick gem 时出现错误。

```
/opt/local/bin/ruby extconf.rb update rmagick
checking for Ruby version >= 1.8.2... yes
checking for /usr/bin/gcc-4.0... yes
checking for Magick-config... no
Can't install RMagick 2.7.0\. Can't find Magick-config in
    /System/Library/Frameworks/JavaVM.framework/Versions/1.5/Commands:
    /Users/jason/.bin:/opt/local/bin:/usr/local/bin:/usr/local/mysql/bin:
    /usr/local/ec2-api-tools/bin:/opt/local/bin:/usr/bin:
    /usr/local/bin:/bin:/usr/sbin:/sbin:/usr/X11/bin 
```

我已经成功安装了旧版本的 rmagick。我已经看到对 ImageMagick 开发包的引用，但它似乎无法从 MacPorts 获得。

如何使用 MacPorts 的 ImageMagick 6.4.4 在 Mac OS X 上安装 RMagick 2.7？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-12-01T20:15:37.637

我建议使用[Homebrew](https://brew.sh/)而不是 Macports。安装 Homebrew 后，运行：

```
brew install imagemagick
gem install rmagick 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-03T04:08:36.313

在安装 rmagick gem 之前从命令行试试这个：

```
sudo port install tiff -macosx imagemagick +q8 +gs +wmf 
```

你也读过这里的安装文档[吗](http://rmagick.rubyforge.org/install-osx.html)？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T22:02:17.693

安装脚本在您的路径中找不到 Magick-config。通过 MacPorts 安装 ImageMagick 时是否使用了非标准安装位置？通常它进入 /opt/local/bin/

您可以通过运行以下命令查看 MacPorts 将 Magick-config 放在哪里：

> 端口内容 ImageMagick

如果您发现它在那里列出，请确保该目录包含在您的 PATH 中并重新运行 rmagick 安装。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-25T10:11:29.713

我已经运行了安装命令，但我不断收到此错误：

> /Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require': 没有要加载的文件 -- RMagick2.so (LoadError)

原来它正确地构建了共享对象文件，但名称是“错误的”。

我得到的文件名为`/Library/Ruby/Gems/1.8/gems/rmagick-2.11.1/lib/RMagick2.bundle`；重命名它以`RMagick2.so`解决此问题。

# air - 在系统托盘中运行的 Adob e AIR 应用程序能否弹出窗口？

> ID：164311
> 
> 赞同：4
> 
> 时间：2008-10-02T20:06:14.633
> 
> 标签：air

例如，如果我要在 AIR 上编写一个日历应用程序，比如使用 Flex，这个应用程序是否可以像 Microsoft Outlook 一样弹出提醒窗口来提醒即将到来的约会？

澄清：这些窗口可以是我可以输入和保存信息的实际对话框吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T20:58:22.620

请参阅[创建 toast 样式的窗口](http://www.adobe.com/devnet/air/flex/quickstart/articles/creating_toast-style_windows.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T20:08:20.167

[Twhirl](http://www.twhirl.org/)在系统托盘中运行时会弹出“toast”通知（类似于大多数即时通讯工具）。

所以是的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-25T02:15:11.190

有通知气球提示，但这种方法在 Windows 7 中不适合系统托盘图标，而且它不是跨平台的。不幸的是，您只能使用 Shell_NotifyIcon 在 Win32 API 中调用它，并且无法从 Air 中获取它。

坚持制作自己的烤面包机弹出窗口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-30T02:40:45.383

是的

您的 Flex AIR 应用程序可以弹出窗口、对话框、烤面包机等等。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-02-07T22:50:29.490

查看Adob​​e 网站上的[这篇文章](http://www.adobe.com/devnet/air/flash/quickstart/articles/creating_toast-style_windows.html)，以创建您自己的 Toast 样式弹出窗口。

（这归功于[Duncan Smart](https://stackoverflow.com/users/1278/duncan-smart)，回答[了这个问题](https://stackoverflow.com/questions/164311/can-an-adobe-air-app-thats-running-in-the-system-tray-pop-up-a-window)。）

# sql - GROUP BY 和 DISTINCT 之间有什么区别吗

> ID：164319
> 
> 赞同：396
> 
> 时间：2008-10-02T20:09:06.700
> 
> 标签：sql, group-by, distinct

前几天我学到了一些关于 SQL 的简单知识：

```
SELECT c FROM myTbl GROUP BY C 
```

与以下结果相同：

```
SELECT DISTINCT C FROM myTbl 
```

我很好奇的是，SQL 引擎处理命令的方式有什么不同，还是它们真的是一回事？

我个人更喜欢独特的语法，但我相信它比其他任何东西都更不习惯。

编辑：这不是关于聚合的问题。`GROUP BY`了解 with 聚合函数的使用。

* * *

## 回答 #1

> 赞同：290
> 
> 时间：2008-10-02T20:52:47.033

[就您所说的问题而言， MusiGenesis](https://stackoverflow.com/questions/164319/is-there-any-difference-between-group-by-and-distinct#164485)的回答在功能上是正确的；SQL Server 足够聪明地意识到，如果您使用“Group By”而不使用任何聚合函数，那么您的实际意思是“Distinct” - 因此它会生成一个执行计划，就像您只是使用“Distinct”一样。”

然而，我认为同样重要的是要注意[Hank](https://stackoverflow.com/questions/164319/is-there-any-difference-between-group-by-and-distinct#164323)的回应——如果你不小心的话，对“Group By”和“Distinct”的漫不经心的处理可能会导致一些有害的陷阱。说这不是“关于聚合的问题”并不完全正确，因为您询问的是两个 SQL 查询关键字之间的功能差异，其中一个**用于聚合**，而另一个不用于聚合。

锤子有时可以用来拧螺丝，但如果你手边有螺丝刀，为什么还要麻烦呢？

（出于类比的目的，`Hammer : Screwdriver :: GroupBy : Distinct`并且`screw => get list of unique values in a table column`）

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2008-10-02T20:10:58.163

`GROUP BY`允许您使用聚合函数，例如`AVG`、`MAX`、`MIN`、`SUM`和`COUNT`. 另一方面`DISTINCT`，只是删除重复项。

例如，如果您有一堆采购记录，并且您想知道每个部门花费了多少，您可能会执行以下操作：

```
SELECT department, SUM(amount) FROM purchases GROUP BY department 
```

这将为每个部门提供一行，其中包含部门名称和该部门`amount`所有行中所有值的总和。

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2017-08-23T07:43:13.443

### 从单纯的重复删除功能的角度来看有什么区别

除了 like `DISTINCT`,`GROUP BY`允许*按组*聚合数据（许多其他答案已经提到）这一事实之外，我认为最重要的区别是这两个操作在[逻辑顺序的两个非常不同的步骤中“发生”在`SELECT`语句中执行的操作](https://blog.jooq.org/2016/12/09/a-beginners-guide-to-the-true-order-of-sql-operations)。

以下是最重要的操作：

*   `FROM`（包括`JOIN`,`APPLY`等）
*   `WHERE`
*   `GROUP BY` *（可以删除重复项）*
*   聚合
*   `HAVING`
*   窗口函数
*   `SELECT`
*   `DISTINCT` *（可以删除重复项）*
*   `UNION`, `INTERSECT`, `EXCEPT` *（可以删除重复项）*
*   `ORDER BY`
*   `OFFSET`
*   `LIMIT`

如您所见，每个操作的逻辑顺序会影响可以用它做什么以及它如何影响后续操作。特别是，`GROUP BY`操作*“发生在”*操作（投影）之前这一事实`SELECT`意味着：

1.  它不依赖于投影（这可能是一个优势）
2.  它不能使用投影中的任何值（这可能是一个缺点）

### 1.不依赖于投影

一个不依赖于投影的例子是有用的，如果你想计算不同值的窗口函数：

```
SELECT rating, row_number() OVER (ORDER BY rating) AS rn
FROM film
GROUP BY rating 
```

当针对[Sakila 数据库](https://www.jooq.org/sakila)运行时，这会产生：

```
rating   rn
-----------
G        1
NC-17    2
PG       3
PG-13    4
R        5 
```

同样无法`DISTINCT`轻松实现：

```
SELECT DISTINCT rating, row_number() OVER (ORDER BY rating) AS rn
FROM film 
```

该查询是“错误的”并产生如下内容：

```
rating   rn
------------
G        1
G        2
G        3
...
G        178
NC-17    179
NC-17    180
... 
```

这不是我们想要的。该`DISTINCT`操作*“发生在”*投影之后，因此我们不能再删除`DISTINCT`评分，因为已经计算和投影了窗口函数。为了使用`DISTINCT`，我们必须嵌套查询的那部分：

```
SELECT rating, row_number() OVER (ORDER BY rating) AS rn
FROM (
  SELECT DISTINCT rating FROM film
) f 
```

旁注：[在这种特殊情况下，我们还可以使用`DENSE_RANK()`](https://blog.jooq.org/2013/10/09/sql-trick-row_number-is-to-select-what-dense_rank-is-to-select-distinct/)

```
SELECT DISTINCT rating, dense_rank() OVER (ORDER BY rating) AS rn
FROM film 
```

### 2.它不能使用投影中的任何值

SQL 的缺点之一是它有时过于冗长。出于与我们之前看到的相同的原因（即操作的逻辑顺序），我们不能“轻松”按我们正在投影的东西进行分组。

这是无效的 SQL：

```
SELECT first_name || ' ' || last_name AS name
FROM customer
GROUP BY name 
```

这是有效的（重复表达式）

```
SELECT first_name || ' ' || last_name AS name
FROM customer
GROUP BY first_name || ' ' || last_name 
```

这也是有效的（嵌套表达式）

```
SELECT name
FROM (
  SELECT first_name || ' ' || last_name AS name
  FROM customer
) c
GROUP BY name 
```

[我在一篇博文中更深入地讨论了这个主题](https://blog.jooq.org/2016/12/09/a-beginners-guide-to-the-true-order-of-sql-operations)

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2008-10-02T20:41:02.973

**没有区别**（至少在 SQL Server 中）。两个查询使用相同的执行计划。

[http://sqlmag.com/database-performance-tuning/distinct-vs-group](http://sqlmag.com/database-performance-tuning/distinct-vs-group)

如果涉及子查询，可能*会有所不同：*

[http://blog.sqlauthority.com/2007/03/29/sql-server-difference-between-distinct-and-group-by-distinct-vs-group-by/](http://blog.sqlauthority.com/2007/03/29/sql-server-difference-between-distinct-and-group-by-distinct-vs-group-by/)

**没有区别**（Oracle 风格）：

[http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:32961403234212](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:32961403234212)

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2008-10-02T20:11:07.973

`DISTINCT`如果您只想删除重复项，请使用。如果`GROUPY BY`要应用聚合运算符（`MAX`、`SUM`、`GROUP_CONCAT`、 ... 或`HAVING`子句），请使用。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-10-02T20:51:01.920

我预计它们的执行可能存在细微差别。我在 Oracle 10g 中检查了两个功能等效查询的执行计划：

```
core> select sta from zip group by sta;

---------------------------------------------------------------------------
| Id  | Operation          | Name | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |      |    58 |   174 |    44  (19)| 00:00:01 |
|   1 |  HASH GROUP BY     |      |    58 |   174 |    44  (19)| 00:00:01 |
|   2 |   TABLE ACCESS FULL| ZIP  | 42303 |   123K|    38   (6)| 00:00:01 |
---------------------------------------------------------------------------

core> select distinct sta from zip;

---------------------------------------------------------------------------
| Id  | Operation          | Name | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |      |    58 |   174 |    44  (19)| 00:00:01 |
|   1 |  HASH UNIQUE       |      |    58 |   174 |    44  (19)| 00:00:01 |
|   2 |   TABLE ACCESS FULL| ZIP  | 42303 |   123K|    38   (6)| 00:00:01 |
--------------------------------------------------------------------------- 
```

中间操作略有不同：“HASH GROUP BY”与“HASH UNIQUE”，但估计成本等是相同的。然后我在跟踪的情况下执行了这些操作，并且两者的实际操作计数相同（除了第二个由于缓存而不必进行任何物理读取）。

但我认为，由于操作名称不同，执行会遵循一些不同的代码路径，这会带来更显着差异的可能性。

我认为您应该为此目的更喜欢 DISTINCT 语法。这不仅仅是习惯，它更清楚地表明了查询的目的。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-10-02T20:11:37.177

对于您发布的查询，它们是相同的。但是对于其他可能不正确的查询。

例如，它与以下内容不同：

```
SELECT C FROM myTbl GROUP BY C, D 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2012-05-17T16:04:57.037

我阅读了上述所有评论，但除了聚合位之外，没有人指出 Group By 和 Distinct 之间的主要区别。

Distinct 返回所有行，然后对它们进行重复数据删除，而 Group By 在算法一一读取行时对行进行重复数据删除。

这意味着它们可以产生不同的结果！

例如，以下代码会产生不同的结果：

```
SELECT distinct ROW_NUMBER() OVER (ORDER BY Name), Name FROM NamesTable

 SELECT ROW_NUMBER() OVER (ORDER BY Name), Name FROM NamesTable
GROUP BY Name 
```

如果表中有 10 个名称，其中 1 个与另一个名称重复，则第一个查询返回 10 行，而第二个查询返回 9 行。

原因就是我上面所说的，所以他们可以表现得不同！

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2008-10-02T20:12:00.280

如果将 DISTINCT 与多列一起使用，则结果集不会像使用 GROUP BY 那样进行分组，并且您不能将聚合函数与 DISTINCT 一起使用。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-10-02T20:20:31.277

GROUP BY 有一个非常具体的含义，它与 DISTINCT 函数不同（呵呵）。

GROUP BY 使查询结果使用所选表达式进行分组，然后可以应用聚合函数，这些函数将作用于每个组，而不是整个结果集。

这是一个可能有帮助的例子：

给定一个如下所示的表：

```
name
------
barry
dave
bill
dave
dave
barry
john 
```

这个查询：

```
SELECT name, count(*) AS count FROM table GROUP BY name; 
```

将产生如下输出：

```
name    count
-------------
barry   2
dave    3
bill    1
john    1 
```

这显然与使用 DISTINCT 有很大不同。如果您想对结果进行分组，请使用 GROUP BY，如果您只想要特定列的唯一列表，请使用 DISTINCT。这将使您的数据库有机会根据您的需要优化查询。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-10-02T20:10:10.707

它们具有不同的语义，即使它们碰巧在您的特定数据上具有相同的结果。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2011-12-28T11:28:58.283

如果您使用没有任何聚合函数的 GROUP BY，那么在内部它将被视为 DISTINCT，因此在这种情况下，GROUP BY 和 DISTINCT 之间没有区别。

但是，当您提供 DISTINCT 子句时，最好使用它来查找您的唯一记录，因为 GROUP BY 的目标是实现聚合。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-10-02T20:57:40.750

当您的意思是 DISTINCT 时，请不要使用 GROUP BY，即使它们碰巧工作相同。我假设您正试图从查询中减少毫秒，我必须指出，开发人员的时间比计算机时间贵几个数量级。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2018-06-19T00:44:28.000

[从 Teradata 的角度来看](https://www.dwhpro.com/distinct-vs-group-teradata/)：

从结果集的角度来看，在 Teradata 中使用 DISTINCT 还是 GROUP BY 并不重要。答案集将是相同的。

从性能的角度来看，是不一样的。

要了解影响性能的因素，您需要了解在使用 DISTINCT 或 GROUP BY 执行语句时 Teradata 上发生了什么。

在 DISTINCT 的情况下，行会立即重新分配，而不会发生任何预聚合，而在 GROUP BY 的情况下，首先会完成预聚合，然后才在 AMP 之间重新分配唯一值。

现在不要认为从性能的角度来看 GROUP BY 总是更好。当您有许多不同的值时，GROUP BY 的预聚合步骤不是很有效。Teradata 必须对数据进行排序以删除重复项。在这种情况下，最好先重新分配，即使用 DISTINCT 语句。只有当有许多重复值时，GROUP BY 语句可能是更好的选择，因为只有在重复数据删除步骤发生后，在重新分配之后。

简而言之，Teradata 中的 DISTINCT 与 GROUP BY 意味着：

GROUP BY -> for many duplicates DISTINCT -> no or a few duplicates only 。有时，在使用 DISTINCT 时，您会用完 AMP 上的假脱机空间。原因是重新分配会立即发生，并且偏差可能会导致 AMP 空间不足。

如果发生这种情况，使用 GROUP BY 可能会有更好的机会，因为在第一步中已经删除了重复项，并且跨 AMP 移动的数据更少。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-10-02T20:15:29.867

group by 用于聚合操作——比如当你想获得按列 C 分解的 B 计数时

```
select C, count(B) from myTbl group by C 
```

distinct 听起来像 - 你得到独特的行。

在 sql server 2005 中，查询优化器似乎能够优化我运行的简单示例中的差异。不过，不知道您是否可以在所有情况下都依靠它。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-10-02T20:12:44.397

在该特定查询中没有区别。但是，当然，如果您添加任何聚合列，那么您将不得不使用 group by。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-10-03T10:09:12.443

从“SQL 语言”的角度来看，这两种结构是等价的，您选择哪一种是我们都必须做出的“生活方式”选择之一。我认为 DISTINCT 更明确是一个很好的例子（因此对继承你的代码等的人更加体贴）但这并不意味着 GROUP BY 构造是一个无效的选择。

我认为这个“GROUP BY 用于聚合”是错误的强调。人们应该知道，设置函数（MAX、MIN、COUNT 等）可以省略，以便他们可以理解编码器的意图。

理想的优化器将识别等效的 SQL 结构，并始终相应地选择理想的计划。对于您在现实生活中选择的 SQL 引擎，您必须进行测试 :)

PS 请注意 DISTINCT 关键字在 select 子句中的位置可能会产生不同的结果，例如对比：

```
SELECT COUNT(DISTINCT C) FROM myTbl;

SELECT DISTINCT COUNT(C) FROM myTbl; 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-01-29T16:06:26.983

我知道这是一个旧帖子。但碰巧我有一个查询，它使用 group by 只是为了在 toad 中使用该查询时返回不同的值，oracle 报告一切正常，我的意思是响应时间很好。当我们从 Oracle 9i 迁移到 11g 时，Toad 中的响应时间非常好，但在报告中，完成报告需要大约 35 分钟，而使用以前的版本大约需要 5 分钟。

解决方案是更改组并使用 DISTINCT，现在报告在大约 30 秒内运行。

我希望这对有同样情况的人有用。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-02T20:16:27.383

您只是注意到这一点，因为您选择的是单个列。

尝试选择两个字段，看看会发生什么。

Group By 旨在像这样使用：

```
SELECT name, SUM(transaction) FROM myTbl GROUP BY name 
```

这将显示每个人所有交易的总和。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-07-17T22:21:41.623

有时它们可​​能会给您相同的结果，但它们旨在用于不同的意义/情况。主要区别在于语法。

请注意下面的示例。`DISTINCT`用于过滤掉重复的值集。(6, cs, 9.1) 和 (1, cs, 5.5) 是两个不同的集合。因此`DISTINCT`，将显示两行，而`GROUP BY Branch`仅显示一组。

```
 SELECT * FROM student; 
+------+--------+------+
| Id   | Branch | CGPA |
+------+--------+------+
|    3 | civil  |  7.2 |
|    2 | mech   |  6.3 |
|    6 | cs     |  9.1 |
|    4 | eee    |  8.2 |
|    1 | cs     |  5.5 |
+------+--------+------+
5 rows in set (0.001 sec)

SELECT DISTINCT * FROM student; 
+------+--------+------+
| Id   | Branch | CGPA |
+------+--------+------+
|    3 | civil  |  7.2 |
|    2 | mech   |  6.3 |
|    6 | cs     |  9.1 |
|    4 | eee    |  8.2 |
|    1 | cs     |  5.5 |
+------+--------+------+
5 rows in set (0.001 sec)

SELECT * FROM student GROUP BY Branch;
+------+--------+------+
| Id   | Branch | CGPA |
+------+--------+------+
|    3 | civil  |  7.2 |
|    6 | cs     |  9.1 |
|    4 | eee    |  8.2 |
|    2 | mech   |  6.3 |
+------+--------+------+
4 rows in set (0.001 sec) 
```

有时，如果不使用一些额外的子句或条件，`GROUP BY`子句可以达到的结果是不可能达到的。`DISTINCT`例如在上述情况下。

要获得与您必须在子句`DISTINCT`中传递所有列名相同的结果，如下所示。`GROUP BY`因此，请查看语法差异。在这种情况下，您必须了解要使用`GROUP BY`子句的所有列名。

```
SELECT * FROM student GROUP BY Id, Branch, CGPA;
+------+--------+------+
| Id   | Branch | CGPA |
+------+--------+------+
|    1 | cs     |  5.5 |
|    2 | mech   |  6.3 |
|    3 | civil  |  7.2 |
|    4 | eee    |  8.2 |
|    6 | cs     |  9.1 |
+------+--------+------+ 
```

我还注意到`GROUP BY`默认情况下以升序显示结果，但`DISTINCT`事实并非如此。但我不确定这一点。供应商可能会有所不同。

来源：[https ://dbjpanda.me/dbms/languages/sql/sql-syntax-with-examples#group-by](https://dbjpanda.me/dbms/languages/sql/sql-syntax-with-examples#group-by)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-09-27T09:47:56.207

在使用方面，GROUP BY 用于对要计算的那些行进行分组。DISTINCT 不会进行任何计算。它不会显示重复的行。

如果我想呈现没有重复的数据，我总是使用 DISTINCT。

如果我想计算芒果的总数量，我会使用 GROUP BY

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-02T21:05:41.370

我一直理解的方式是，使用 distinct 与按您选择的每个字段按您选择它们​​的顺序进行分组相同。

IE：

```
select distinct a, b, c from table; 
```

是相同的：

```
select a, b, c from table group by a, b, c 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2018-01-09T04:40:49.070

功能效率完全不同。如果您只想选择“返回值”，除了重复的，使用 distinct 比 group by 更好。因为“分组依据”包括（排序+删除），“不同”包括（删除）

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-07-01T19:08:26.877

在 Hive (HQL) 中，`GROUP BY`可以比 快得多`DISTINCT`，因为前者不需要比较表中的所有字段。

请参阅：[https](https://sqlperformance.com/2017/01/t-sql-queries/surprises-assumptions-group-by-distinct) ://sqlperformance.com/2017/01/t-sql-queries/surprises-assumptions-group-by-distinct 。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-08-30T15:15:58.107

通常我们可以`DISTINCT`用来消除表中特定列上的重复项。

> 在“GROUP BY”的情况下，我们可以在特定列上应用聚合函数，如 `AVG`、`MAX`、`MIN`、`SUM`和 ，并`COUNT`在同一列上获取列名及其聚合函数结果。

例子 ：

```
select  specialColumn,sum(specialColumn) from yourTableName group by specialColumn; 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2015-02-10T16:56:21.003

除了使用聚合函数外，group by 和 distinct 子句之间没有显着差异。两者都可以用来区分值，但如果从性能角度来看 group by 更好。使用 distinct 关键字时，内部使用排序操作，可以在执行计划中查看。

试试简单的例子

声明@tmpresult 表（Id tinyint）

插入 @tmpresult 选择 5 联合全部 选择 2 联合全部 选择 3 联合全部 选择 4

从@tmpresult 中选择不同的 ID

# sql-server-2005 - SSRS 2005 帮助 - 需要从 TSQL 中获取文件大小（列中指定的路径）。任何人？

> ID：164324
> 
> 赞同：2
> 
> 时间：2008-10-02T20:10:17.510
> 
> 标签：sql-server-2005, tsql, reporting-services, filesize

我需要获取文件夹大小并在报告（SSRS）上显示信息。我需要为许多数据库（循环！）执行此操作。这些数据库是网站的后端。有没有人这样做过？你能指点我一些样品或正确的方向吗？xp_filesize 之类的解决方案是否正确？帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T11:32:21.767

查看问题和 Tomalak 的回复，我假设报告服务器将能够访问数据库中保存的文件夹：

首先设置查询以让您返回路径的结果集 - 我假设您对这部分没有任何问题。接下来，您需要在报告中添加自定义代码函数：http: [//msdn.microsoft.com/en-us/library/ms155798.aspx](http://msdn.microsoft.com/en-us/library/ms155798.aspx) - 此函数将文件夹路径作为参数，并传回文件夹的大小。如果您想在报告中嵌入代码，您必须在 VB.Net 中编写，或者您可以编写一个 DLL 并将其引入。

一个示例 VB.Net 代码块（请记住，您可能需要为对象添加 System.IO 前缀。）[http://www.freevbcode.com/ShowCode.asp?ID=4287](http://www.freevbcode.com/ShowCode.asp?ID=4287)

```
Public Shared Function GetFolderSize(ByVal DirPath As String, _
   Optional IncludeSubFolders as Boolean = True) As Long

  Dim lngDirSize As Long
  Dim objFileInfo As FileInfo
  Dim objDir As DirectoryInfo = New DirectoryInfo(DirPath)
  Dim objSubFolder As DirectoryInfo

Try

'add length of each file
  For Each objFileInfo In objDir.GetFiles()
    lngDirSize += objFileInfo.Length
  Next

  'call recursively to get sub folders
  'if you don't want this set optional
  'parameter to false 
If IncludeSubFolders then
  For Each objSubFolder In objDir.GetDirectories()
    lngDirSize += GetFolderSize(objSubFolder.FullName)
  Next
End if

Catch Ex As Exception

End Try

   Return lngDirSize
End Function 
```

现在，在您的报告中，在您的表格中，对于显示文件夹大小的单元格，您将拥有类似以下的表达式：

```
=Code.GetFolderSize(Fields!FolderPath.Value) 
```

我怀疑这种方法对于手动查看的报告是否有效，但是对于小型结果集或通过电子邮件发送的预定报告，您可能会侥幸逃脱？

哦，这篇文章建议您“可能”在 RS 中使用 System.IO 遇到权限问题：http: [//blogs.sqlxml.org/bryantlikes/pages/824.aspx](http://blogs.sqlxml.org/bryantlikes/pages/824.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T17:59:04.777

您能否澄清在您的场景中谁应该做什么？您希望 SQL Server 获取信息还是希望 Reporting Server 获取信息？

“文件夹大小”到底是什么意思？“一个文件夹，总结每个文件”足够还是需要递归？无论哪种方式，我都会使用一个小的自定义 .NET 函数，它使用`System.IO.Directory`它的亲戚。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T11:20:56.393

我会考虑把它分成两部分，也许是一个 Windows 服务来扫描目录并将数据聚合到数据库中，然后像往常一样使用 SSRS 来报告数据库。

我建议这样做的原因是使用 master..xp_filesize 并且它与 SQL Server 服务开始使用的帐户相关，需要访问要扫描的路径。一旦这变成访问其他机器上的路径，我就会对它的安全隐患感到不太舒服。

希望这可以帮助

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-03T09:48:27.977

在 SSRS 中，您可以借助自定义数据扩展来做到这一点。您需要将数据源的路径作为您的文件夹名称，它将检索您的文件及其相关信息并显示

如需进一步参考和自定义 dll，请使用此 [http://www.devx.com/dbzone/Article/31336/0/page/4](http://www.devx.com/dbzone/Article/31336/0/page/4)

我之前已经这样做了。

注意：您必须对报表设计器和报表管理器配置文件进行相关更改。

# linq - 如何获取 XElement 的位置（）？

> ID：164335
> 
> 赞同：8
> 
> 时间：2008-10-02T20:12:20.873
> 
> 标签：linq, linq-to-xml

任何像 /NodeName/position() 这样的 XPath 都会为您提供节点 wrt 的位置，它是父节点。

XElement（Linq to XML）对象上没有可以获取Element位置的方法。有没有？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-02T23:19:52.920

实际上 NodesBeforeSelf().Count 不起作用，因为它甚至可以获取 XText 类型的所有内容

问题是关于 XElement 对象。所以我想这是

```
int position = obj.ElementsBeforeSelf().Count(); 
```

应该使用的，

感谢科比的指导。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-02T20:36:16.213

您可以使用 NodesBeforeSelf 方法来执行此操作：

```
 XElement root = new XElement("root",
        new XElement("one", 
            new XElement("oneA"),
            new XElement("oneB")
        ),
        new XElement("two"),
        new XElement("three")
    );

    foreach (XElement x in root.Elements())
    {
        Console.WriteLine(x.Name);
        Console.WriteLine(x.NodesBeforeSelf().Count()); 
    } 
```

更新：如果你真的只想要一个 Position 方法，只需添加一个扩展方法。

```
public static class ExMethods
{
    public static int Position(this XNode node)
    {
        return node.NodesBeforeSelf().Count();  
    }
} 
```

现在你可以调用 x.Position()。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T20:33:25.707

```
static int Position(this XNode node) {
  var position = 0;
  foreach(var n in node.Parent.Nodes()) {
    if(n == node) {
      return position;
    }
    position++;
  }
  return -1;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T23:36:39.947

实际上，在 XDocument 的 Load 方法中，您可以设置 SetLineInfo 的加载选项，然后您可以将 XElements 类型转换为 IXMLLineInfo 以获取行号。

你可以做类似的事情

```
var list = from xe in xmldoc.Descendants("SomeElem")
           let info = (IXmlLineInfo)xe
           select new 
           {
              LineNum = info.LineNumber,
              Element = xe
           } 
```

# .net - 存储库是否应该实现 IQueryable ?

> ID：164342
> 
> 赞同：27
> 
> 时间：2008-10-02T20:13:27.783
> 
> 标签：.net, linq, design-patterns

我正在考虑两个 IRepository 接口之一，一个是 IQueryable 的后代，一个包含 IQueryable。

像这样：

```
public interface IRepository<T> : IQueryable<T>
{
    T Save(T entity);
    void Delete(T entity);
} 
```

或这个：

```
public interface IRepository<T>
{
    T Save(T entity);
    void Delete(T entity);
    IQueryable<T> Query();
} 
```

LINQ 的用法是：

```
from dos
in ServiceLocator.Current.GetInstance<IRepository<DomainObject>>()
where dos.Id == id
select dos 
```

或者...

```
from dos
in ServiceLocator.Current.GetInstance<IRepository<DomainObject>>().Query
where dos.Id == id
select dos 
```

我有点喜欢第一个，但模拟起来有问题。其他人如何实现 LINQable、mockable 存储库？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-02T20:21:02.973

取决于您是否想要 Has-A 或 Is-A 关系。

第一个是 Is-A 关系。IRepository 接口是一个 IQueryable 接口。第二个是has-a。IRepository 有一个 IQueryable 接口。在写这篇文章的过程中，我实际上比第一个更喜欢第二个，只是因为当使用你的第二个 IRepository 时，我可以给 Query() 方法任何返回 IQueryable 的方法。对我来说，这比第一个实现更灵活。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-03-16T00:25:32.890

就个人而言，我使用 将`Repository Pattern`存储库中的所有项目作为`IQueryable`. 通过这样做，我的存储库层现在非常轻巧、小……现在可以对所有类型的查询操作开放服务层（它消耗存储库层）。

基本上，我所有的逻辑现在都位于服务层（它不知道它将使用什么类型的存储库..并且不想知道<-关注点分离）..而我的存储库层只是处理获取数据并将数据保存到存储库（一个 sql 服务器、一个文件、太空中的卫星......等等 <-- 更多的关注点分离）。

例如。或多或少的伪代码，因为我记得我们在代码中做了什么并为这个答案简化了它......

```
public interface IRepository<T>
{
    IQueryable<T> Find();
    void Save(T entity);
    void Delete(T entity);
} 
```

并拥有一个用户存储库...

```
public class UserRepository : IRepository<User>
{
    public IQueryable<User> Find()
    {
        // Context is some Entity Framework context or 
        // Linq-to-Sql or NHib or an Xml file, etc...
        // I didn't bother adding this, to this example code.
        return context.Users().AsQueryable();
    }

    // ... etc
} 
```

现在是最好的一点:)

```
public void UserServices : IUserServices
{
    private readonly IRepository<User> _userRepository;

    public UserServices(IRepository<User> userRepository)
    {
        _userRepository = userRepository;
    }

    public User FindById(int userId)
    {
        return _userRepository.Find()
            .WithUserId(userId)
            .SingleOrDefault();  // <-- This will be null, if the 
                                 //     user doesn't exist
                                 //     in the repository.
    }

    // Note: some people might not want the FindBySingle method because this
    //       uber method can do that, also. But i wanted to show u the power
    //       of having the Repository return an IQuerable.
    public User FindSingle(Expression<Func<User, bool>> predicate)
    {
        return _userRepository
            .Find()
            .SingleOrDefault(predicate);
    }
} 
```

加分：WTF是`WithUserId(userId)`在`FindById`方法吗？那是[Pipe 和 Filter](http://www.asp.net/mvc/videos/aspnet-mvc-storefront-part-3-pipes-and-filters)。使用它们 :) 爱它们 :) 拥抱它们 :) 它们使您的代码非常易读 :) 现在，如果您想知道它的作用.. 这是扩展方法。

```
public static User WithId(this IQueryable<User> source, int userId)
{
    return source.Where(u => u.UserId == userId).SingleOrDefault();
} 
```

即使这个问题是……嗯……将近两年了：）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T09:43:28.733

你总是可以针对 List 快速写东西，它不是使用模拟框架来模拟的，但它确实很好用。

# java - 从任意 .class 文件创建一个 BCEL JavaClass 对象

> ID：164343
> 
> 赞同：4
> 
> 时间：2008-10-02T20:13:34.693
> 
> 标签：java, bytecode, bcel

我在玩BCEL。我不是用它来生成字节码，而是试图检查现有编译类的结构。

我需要能够指向硬盘驱动器上任意位置的任意 .class 文件并基于该文件加载[JavaClass对象。](http://jakarta.apache.org/bcel/apidocs/org/apache/bcel/classfile/JavaClass.html)理想情况下，我想避免将给定的类添加到我的类路径中。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-02T20:20:11.697

直接的方法是使用文件名创建一个 ClassParser 并调用 parse()。或者，您可以使用 SyntheticRepository 并提供类路径（这不是您的类路径，IYSWIM）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-10-07T05:56:21.720

现有的 .class 可以类加载到 java lang 类对象。然后就可以转换成BCEL中间的javaclass结构了。以下代码可能会有所帮助：-

```
Class<?> javaClass1 = null;
javaClass1 = ucl.loadClass("com.sample.Customer");
org.apache.bcel.classfile.JavaClass javaClazz1=org.apache.bcel.Repository.lookupClass(javaClass1); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-01T22:50:53.110

```
new ClassParser(classfilebytearrayhere).parse() 
```

# c++ - 如何使用 fstream 从第二行读取文本文件？

> ID：164344
> 
> 赞同：18
> 
> 时间：2008-10-02T20:13:44.707
> 
> 标签：c++, fstream

如何让我的`std::fstream`对象从第二行开始读取文本文件？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-02T21:29:43.997

您可以使用流的忽略功能：

```
ifstream stream("filename.txt");

// Get and drop a line
stream.ignore ( std::numeric_limits<std::streamsize>::max(), '\n' );

// Get and store a line for processing.
// std::getline() has a third parameter the defaults to '\n' as the line
// delimiter.
std::string line;
std::getline(stream,line);

std::string word;
stream >> word; // Reads one space separated word from the stream. 
```

### 读取文件的常见错误：

```
while( someStream.good() )  // !someStream.eof()
{
    getline( someStream, line );
    cout << line << endl;
} 
```

失败的原因是：读取最后一行时，它没有读取 EOF 标记。所以流仍然很好，但是流中没有更多数据可供读取。于是重新进入循环。std::getline() 然后尝试从 someStream 读取另一行并失败，但仍将一行写入 std::cout。

简单的解决方案：

```
while( someStream ) // Same as someStream.good()
{
    getline( someStream, line );
    if (someStream) // streams when used in a boolean context are converted to a type that is usable in that context. If the stream is in a good state the object returned can be used as true
    {
        // Only write to cout if the getline did not fail.
        cout << line << endl;
    }
} 
```

正确解决方案：

```
while(getline( someStream, line ))
{
    // Loop only entered if reading a line from somestream is OK.
    // Note: getline() returns a stream reference. This is automatically cast
    // to boolean for the test. streams have a cast to bool operator that checks
    // good()
    cout << line << endl;
} 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-02T20:15:37.730

使用 getline() 读取第一行，然后开始读取流的其余部分。

```
ifstream stream("filename.txt");
string dummyLine;
getline(stream, dummyLine);
// Begin reading your stream here
while (stream)
   ... 
```

（更改为 std::getline（感谢 dalle.myopenid.com））

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-07-29T09:49:12.610

**更有效的方法是使用std::istream::ignore**忽略字符串

 **```
for (int currLineNumber = 0; currLineNumber < startLineNumber; ++currLineNumber){
    if (addressesFile.ignore(numeric_limits<streamsize>::max(), addressesFile.widen('\n'))){ 
        //just skipping the line
    } else 
        return HandleReadingLineError(addressesFile, currLineNumber);
} 
```

当然， HandleReadingLineError 不是标准的，而是*手工制作*的。第一个参数是要提取的最大字符数。如果这恰好是 numeric_limits::max()，则没有限制：cplusplus.com 上的链接：[std::istream::ignore](http://www.cplusplus.com/reference/istream/istream/ignore/)

如果你要跳过很多行，你肯定应该使用它而不是 getline：当我需要跳过文件中的 100000 行时，它需要大约一秒钟，而使用 getline 需要 22 秒。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T20:18:38.550

调用 getline() 一次丢弃第一行

还有其他方法，但问题是这个，你不知道第一行要多久吗？所以你不能跳过它，直到你知道第一个'\ n'在哪里。但是，如果您确实知道第一行将有多长，则可以简单地越过它，然后开始阅读，这会更快。

所以要做到这一点，第一种方式看起来像：

```
#include <fstream>
#include <iostream>
using namespace std;

int main () 
{
    // Open your file
    ifstream someStream( "textFile.txt" );

    // Set up a place to store our data read from the file
    string line;

    // Read and throw away the first line simply by doing
    // nothing with it and reading again
    getline( someStream, line );

    // Now begin your useful code
    while( !someStream.eof() ) {
        // This will just over write the first line read
        getline( someStream, line );
        cout << line << endl;
    }

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-05-18T10:20:57.427

```
#include <iostream>
#include <fstream>
#include <string>

using namespace std;

int main()
{
string textString;
string anotherString;
ifstream textFile;
textFile.open("TextFile.txt");
if (textFile.is_open()) {
    while (getline(textFile, textString)){
        anotherString = anotherString + textString;
    }
}

std::cout << anotherString;

textFile.close();
return 0;
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2019-10-06T15:29:03.367

此代码可以从文件中的指定行读取文件，但您必须事先在文件资源管理器中创建文件我的文件名是“temp”代码如下

[https://i.stack.imgur.com/OTrsj.png](https://i.stack.imgur.com/OTrsj.png)

希望这可以帮助

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2020-04-21T11:31:21.573

您可以使用以下忽略功能：

```
fstream dataFile("file.txt");
dataFile.ignore(1, '\n'); // ignore one line 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-10-02T20:19:58.623

```
#include <fstream>
#include <iostream>
using namespace std;

int main () 
{
  char buffer[256];
  ifstream myfile ("test.txt");

  // first line
  myfile.getline (buffer,100);

  // the rest
  while (! myfile.eof() )
  {
    myfile.getline (buffer,100);
    cout << buffer << endl;
  }
  return 0;
} 
```

# dns - 没有 IPv6 的 Ping 失败

> ID：164350
> 
> 赞同：0
> 
> 时间：2008-10-02T20:15:24.720
> 
> 标签：dns, ipv6, ping

我们的用户界面正在与另一台机器上的另一个应用程序通信，通常使用域名进行连接。

在我们的网络上，安装 IPv6 后，DNS 名称解析工作得很好，所有机器都可以被 ping 通并正常联系。

卸载 IPv6 后，ping 相同的 DNS 名称会返回某个远程子网（24.28.193.9；本地子网为 192.168.1.1）上的 IP 地址；然后我们的应用程序无法通信。重新安装 IPv6 时，DNS 解析会自行更正。

即使在 ping 不起作用时没有 IPv6，我仍然可以使用 Windows 资源管理器通过输入`\\\\MACHINE_NAME\\`. 我不确定为什么名称解析似乎在这里起作用。我们在 Windows XP SP2 环境中工作。

可以ping通机器的IP。只有 DNS 名称无法正确解析。

我查找了我们的 DNS 服务器的地址。我们所有的计算机都指向网络网关，这是一个无线路由器。安装 IPv6 时，路由器的 DNS 服务器地址与未安装时相同。

最奇怪的是，我刚刚发现我 ping 什么 DNS 名称并不重要。所有对 DNS 名称的 ping 都返回相同的地址：“24.28.193.9”。

我尝试刷新 DNS 解析器缓存并在目标机器和源机器上注册 DNS。一切都无济于事。我可以 ping 的唯一 DNS 名称是当前机器的名称。

关于为什么我们的软件在没有安装 IPv6 的情况下无法通信的任何想法？

* * *

**更新：**

好的，我现在做了更多的研究。

我查找了我们的 DNS 服务器的地址。我们所有的计算机都指向网络网关，这是一个无线路由器。安装 IPv6 时，路由器的 DNS 服务器地址与未安装时相同。

最奇怪的是，我刚刚发现我 ping 什么 DNS 名称并不重要。所有对 DNS 名称的 ping 都返回相同的地址：“24.28.193.9”。

我尝试刷新 DNS 解析器缓存并在目标机器和源机器上注册 DNS。一切都无济于事。我可以 ping 的唯一 DNS 名称是当前机器的名称。

还有其他建议吗？非常感谢你的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T20:40:34.533

你有很多事情发生在这里

1.  DNS 名称解析
2.  Windows 名称解析
3.  IP-IP ICMP 通信

你写的问题好像#3 有问题，但你描述的一切都指向问题实际上是#1。如果您无法解决问题，您能否在未安装 IPv6 的情况下 ping 正确的 IP？

听起来您可能安装了具有正确信息的 IPv6 名称服务器，而 IPv4 名称服务器不正确？您是通过 DHCP 还是硬编码接收名称服务器？安装 IPv6 和未安装 IPv6 时，您使用的名称服务器的 IP 是什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T03:09:53.370

我知道这是一个迟到的答案，但如果其他人有同样的问题，关键是 IP 地址“24.28.193.9”。快速的谷歌搜索显示它似乎与您的 ISP 通过为*所有*不存在的域名返回一个固定的 IP 地址而完全破坏了 DNS 协议有关（正确的答案是 NXDOMAIN）。您的网络网关很可能只是将您的查询转发到您的 ISP 的名称服务器。

您的系统依赖于 DNS 协议的正确运行。在通过其他方法（很可能是 NetBIOS 名称解析）查询名称之前，他们希望得到 NXDOMAIN 答案。由于 DNS 服务器完全损坏并返回错误的答案，因此永远不会查找正确的地址。

安装或卸载 IPv6 改变这种情况的原因很可能是因为与它相关的东西正在改变名称解析顺序（在尝试 DNS 之前使用其他方法查找）。因此，一种解决方法是自己更改名称解析顺序。

真正的解决办法是要么改用更好的 ISP（一个不会破坏既定协议的），要么运行你自己的 DNS 服务器（自从 VeriSign 推出[类似的噱头](http://en.wikipedia.org/wiki/Site_Finder)以来，我开始在我管理的所有系统上做这件事；他们甚至更糟糕的是，改变 ISP 根本没有任何区别）。

参考：

*   [警告：Road Runner DNS 说存在不存在的域](http://groups.google.com/group/alt.online-services.roadrunner/browse_thread/thread/98123e2e3c35cbe7)

# tdd - TDD研究

> ID：164354
> 
> 赞同：10
> 
> 时间：2008-10-02T20:15:45.920
> 
> 标签：tdd

我知道北卡罗来纳州立大学对 TDD 进行了一些研究。他们发表了一篇名为“[工业测试驱动开发的初步调查](http://collaboration.csc.ncsu.edu/laurie/Papers/TDDpaperv8.pdf)”的论文。可以在[此处](http://collaboration.csc.ncsu.edu/laurie/publications.html)找到 NCSU 的其他出版物。

有人能指出我关于这个主题的其他好的出版物吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-20T14:47:32.633

[关于测试优先编程方法的有效性](http://www.cs.du.edu/~snarayan/sada/teaching/COMP3705/lecture/p1/NRC-47445.pdf)，Hakan Erdogmus、Maurizio Morisio 和 Marco Torchiano。

尽管名称涵盖了 TDD：

抽象的：

> 测试驱动开发（TDD）基于将一个功能形式化为测试，实现功能以使测试通过，并迭代过程。
> 
> 本文描述了用于评估 TDD 一个重要方面的受控实验：在 TDD 中，程序员在相应的实现代码之前编写功能测试。实验是在本科生中进行的。实验组采用测试优先策略，而对照组采用更传统的开发技术，在实施后编写测试。两组都遵循增量过程，一次添加一个新功能并对其进行回归测试。
> 
> 我们发现，考试优先的学生平均会写更多的考试，反过来，写更多考试的学生往往更有效率。我们还观察到，最低质量随着程序员测试的数量线性增加，与所采用的开发策略无关。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T20:34:29.853

[ACM 数字图书馆](http://portal.acm.org/dl.cfm)有不少关于 TDD 的论文。只需搜索测试驱动开发。

谷歌[测试驱动开发学术研究](http://www.google.com/search?q=test+driven+development+academic+research)的最佳结果：

[测试驱动开发：IEEE 计算机协会的概念、分类和未来方向](http://www2.computer.org/portal/web/csdl/doi/10.1109/MC.2005.314)。

在 ACM[通过 TDD 改进软件架构](http://www.acm.org/src/subpages/gf_entries_06/DavidJanzen_src_gf06.pdf)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-08-23T03:36:48.440

作为一名 TDD 实践者，我推出了一个新网站[WeDoTDD.com](http://WeDoTDD.com)，其中列出了这一点。实践它的公司，以及他们如何实践测试驱动开发背后的故事！

# c++ - 如果在抛出异常时无法承受缓慢的性能，我可以使用 STL 吗？

> ID：164356
> 
> 赞同：8
> 
> 时间：2008-10-02T20:16:20.147
> 
> 标签：c++, performance, exception

例如，我正在编写一个实时处理和流式传输音频的多线程时间关键型应用程序。音频中断是完全不可接受的。这是否意味着我不能使用 STL，因为引发异常时可能会减慢速度？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-02T20:20:43.427

通常，如果 new 失败，STL 容器会自行抛出的唯一异常是 std::bad_alloc。唯一的其他时间是用户代码（例如构造函数、赋值、复制构造函数）抛出时。如果您的用户代码从不抛出，那么您只需要防止新的抛出，无论如何您很可能都必须这样做。

其他可能引发异常的事情： - 如果您越界访问 at() 函数，它们可能会引发 std::out_of_range。无论如何，这是一个严重的程序错误。

其次，异常并不总是很慢。如果您的音频处理中发生异常，则可能是由于您无论如何都需要处理的严重错误。错误处理代码可能比将异常传输到捕获站点的异常处理代码要昂贵得多。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-02T20:21:32.490

如果一个 STL 容器抛出，你可能遇到比减速更大的问题 :)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-08-15T10:45:24.343

前面的答案中没有明确写，所以：

## C++ 中发生异常

使用或不使用 STL 不会删除将释放您分配的对象资源的 RAII 代码。

例如：

```
void doSomething()
{
    MyString str ;
    doSomethingElse() ;
} 
```

在上面的代码中，编译器将生成代码以释放 MyString 资源（即将调用 MyString 析构函数），无论在此期间发生什么，包括如果 doSomethingElse 抛出异常或者如果您之前执行“返回”函数作用域的结束。

如果您对此有疑问，那么您应该修改您的心态，或者尝试 C。

## 例外应该是例外

通常，当发生异常时（[并且仅在发生时](https://stackoverflow.com/questions/1897940/in-what-ways-do-c-exceptions-slow-down-code-when-there-are-no-exceptions-thown)），您的性能会受到影响。

但是，只有在以下情况下才应发送异常：

*   您有一个异常事件要处理（即某种错误）
*   在非常特殊的情况下（即堆栈中多个函数调用的“大量返回”，例如在进行复杂搜索时，或在线程优雅中断之前展开堆栈）

这里的关键字是“异常”，这很好，因为我们正在讨论“异常”（见模式？）。

在您的情况下，如果您抛出异常，那么很可能发生了如此糟糕的事情，您的程序无论如何都会毫无例外地崩溃。

在这种情况下，您的问题不在于处理性能损失。它是为了优雅地处理错误，或者更糟糕的是，优雅地终止程序（包括“抱歉”消息框，将未保存的数据保存到临时文件中以供以后恢复等）。

这意味着（除非在非常特殊的情况下），不要将异常用作“返回数据”。当发生非常糟糕的事情时抛出异常。仅当您知道如何处理异常时才捕获异常。避免尝试/捕获（除非您知道如何处理异常）。

## STL 呢？

现在我们知道了：

*   你仍然想使用 C++
*   您的目标不是为了好玩而每秒钟都抛出数千个异常

我们应该讨论 STL：

STL 将（如果可能）通常会验证您是否做错了什么。如果你这样做，它会抛出一个异常。尽管如此，在 C++ 中，您通常不会为您不会使用的东西付费。

一个例子是访问矢量数据。

如果你**知道**你不会越界，那么你应该使用运算符 []。

如果你**知道**你不会验证边界，那么你应该使用 at() 方法。

示例 A：

```
typedef std::vector<std::string> Vector ;

void outputAllData(const Vector & aString)
{
   for(Vector::size_type i = 0, iMax = aString.size() ; i != iMax ; ++i)
    {
       std::cout << i << " : " << aString[i] << std::endl ;
    }
} 
```

示例 B：

```
typedef std::vector<std::string> Vector ;

void outputSomeData(const Vector & aString, Vector::size_type iIndex)
{
   std::cout << iIndex << " : " << aString.at(iIndex) << std::endl ;
} 
```

示例A“信任”程序员，并且不会浪费任何时间进行验证（因此，如果无论如何都有错误*，那么当时*抛出异常的机会就会减少......这通常意味着错误/异常/崩溃通常会之后发生，这将无助于调​​试，并且会损坏更多数据）。

示例 B 要求向量验证索引是否正确，如果不正确则抛出异常。

这是你的选择。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T20:51:22.090

不要害怕性能方面的例外。

在过去的 C++ 中，启用异常的构建在某些编译器上可能会慢很多。

如今，无论您的构建是否带有异常处理，这都无关紧要。

一般来说，STL 不会抛出异常，除非您的内存不足，因此这对于您的应用程序类型也不应该是问题。

（现在不要使用带有 GC 的语言.....）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T21:08:33.360

有几点值得注意：

*   您的应用程序是多线程的。如果一个线程（可能是 GUI 线程）因异常而变慢，它不应该影响实时线程的性能。

*   例外是针对特殊情况。如果在您的实时线程中抛出异常，则很可能意味着您无论如何都无法继续播放音频。如果您发现出于某种原因不断地处理这些线程中的异常，请重新设计以首先避免异常。

我建议您接受带有异常的 STL（除非 STL 本身被证明太慢 - 但请记住：**首先测量，然后优化**），并且还为您自己的“异常情况”（音频硬件故障等）采用异常处理在您的应用程序中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T20:29:42.143

我正在努力思考 STL 的哪些部分指定它们可以引发异常。以我的经验，大多数错误处理都是通过返回码或作为使用 STL 的先决条件来处理的。传递给 STL 的对象肯定会引发异常，例如复制构造函数，但无论使用 STL，这都是一个问题。其他人已经提到了诸如`std::vector::at()`但您通常可以执行检查或使用替代方法以确保不会引发异常的功能。

当然，STL 的特定实现可以执行“检查”，通常用于调试构建，在您使用 STL 时，我认为它只会引发断言，但也许有些会引发异常。

如果不存在 try/catch，我相信除非您自己的类引发异常，否则不会产生/最小的性能损失。

在 Visual Studio 上，您可以完全禁用 C++ 异常，请参阅`Project Properties -> C/C++ -> Code Generation -> Enable C++ Exceptions`. 我认为这在大多数 C++ 平台上都可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T20:58:50.200

你说的好像例外是不可避免的。简单地不要做任何可能导致异常的事情——修复你的错误，验证你的输入。

# .net - 如何创建电子邮件发送服务？

> ID：164363
> 
> 赞同：4
> 
> 时间：2008-10-02T20:17:20.270
> 
> 标签：.net, email

我一直在考虑这个想法一段时间，想看看你的想法。

我想创建一个 .NET 服务来发送和跟踪电子邮件。

我的粗略想法：

1.  在各种应用程序中，序列化 .NET 电子邮件 (System.Net.Mail.MailMessage) 对象的实例并将它们放入数据库或文件系统队列中

2.  邮件服务/进程轮询队列并发送电子邮件

3.  强制订阅/取消订阅列表/规则

4.  跟踪打开、退回、不在办公室的自动回复等。

5.  将状态报告回原始应用程序

有人对我应该如何开始或我可能遇到的问题有什么建议吗？是否有我应该查看的现成软件/服务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T02:12:26.233

即使您使用的是为您完成大部分工作的高级工具，您也需要尽可能了解 SMTP 协议。根据我自己使用 .NET 处理出站和入站电子邮件的经验，直到我学会 telnet 到 SMTP 服务器的端口 25 并通过自己发出命令来发送电子邮件时，我才真正“明白”。

如果您要发送大量电子邮件并且需要监控 NDR（不可送达报告），则必须将 SMTP 信封发件人地址设置为您自己的服务器，并在所有这些电子邮件进入时解析它们以弄清楚发生了什么.

System.Net 电子邮件类不允许您在与 MTA 的对话中设置 MAIL FROM 而不将电子邮件标头中的 From 地址设置为相同的东西，因此您需要使用像[aspNetEmail](http://www.aspnetemail.com/)这样的第 3 方库，如果您需要这些地址不同。

[ListNanny](http://www.listnanny.net/)是另一个有助于解析 NDR 的工具，以及其他功能。

我不确定是否要序列化 ​​MailMessage 对象。我认为只存储单独的数据元素本身然后在需要时实例化 MailMessage 对象会更简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T02:18:06.923

[您可能会发现在 webapp](https://stackoverflow.com/questions/124304/handling-undelivered-emails-in-webapp)中处理未送达电子邮件的一些答案很有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-20T18:06:11.673

我建议您认真考虑外包您的电子邮件服务。我也考虑过为我的 webapps 构建这样的服务，但是有很多事情你必须保持在上面，这会占用你的时间远离你的主要 webapp（当然，除非你把这个服务作为你的主要产品）。第三方服务消除了令人头疼的问题和持续的维护。

如果你走这条路，你需要定期监控你的服务器声誉，维护与大型 ISP 的白名单关系，监控和处理退回邮件，为每个 ISP 设置正确的消息限制，实施 DKIM、VERP、SPF 等功能。假设这是针对选择加入的邮件，您的主要目标是确保发送的每封邮件都将进入用户的邮箱，而不是他们的垃圾邮件箱。准备好花费比你意识到的更多的时间。

对于事务性电子邮件（帐户注册确认、帐户状态报告、计费等），请查看这篇针对具有 webapp 友好 API 的提供商的[SO 帖子](https://stackoverflow.com/questions/2317560/any-web-services-with-apis-for-outsourcing-webapp-email)。

对于营销电子邮件和大量选择加入邮件，请查看此[SO 帖子](https://stackoverflow.com/questions/14303/good-email-service-for-bulk-emailing)。我刚刚将 [MailChimp](http://mailchimp.com)添加到该列表中。

# c# - Moqing一个界面

> ID：164369
> 
> 赞同：4
> 
> 时间：2008-10-02T20:19:20.873
> 
> 标签：c#, .net, tdd, moq

当我在谷歌搜索/阅读这个答案时，我想我也会在这里问。

我有一个类是 SDK 的包装器。该类接受一个 ILoader 对象并使用 ILoader 对象创建一个 ISBAObject，该 ISBAObject 被强制转换为一个 ISmallBusinessInstance 对象。我只是想用 Moq 来模拟这种行为。

```
 [TestMethod]
    public void Test_Customer_GetByID()
    {
        var mock = new Mock<ILoader>();

        var sbainst = new Mock<ISbaObjects>();

        mock.Expect(x => x.GetSbaObjects("")).Returns(sbainst);

    } 
```

编译器错误显示：错误 1 ​​'Moq.Language.IReturns.Returns(Microsoft.BusinessSolutions.SmallBusinessAccounting.Loader.ISbaObjects)' 的最佳重载方法匹配有一些无效参数

这里发生了什么？我希望 ISbaObjects 的 Mock 能够毫无问题地返回。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-02T20:24:20.127

您需要使用 sbainst.Object，因为 sbinst 不是 ISbaObjects 的实例 - 它只是模拟部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T22:42:27.050

更新，正确的代码

```
[TestMethod]
public void Test_Customer_GetByID()
{
    var mock = new Mock<ILoader>();

    var sbainst = new Mock<ISbaObjects>();

    mock.Expect(x => x.GetSbaObjects("")).Returns(sbainst.Object);

} 
```

# c++ - 多线程服务器的结构化异常处理

> ID：164372
> 
> 赞同：4
> 
> 时间：2008-10-02T20:19:57.330
> 
> 标签：c++, exception-handling, seh

[本文](http://blogs.msdn.com/larryosterman/archive/2004/09/10/228068.aspx)很好地概述了为什么结构化异常处理不好。有没有办法获得阻止服务器崩溃的稳健性，同时克服文章中提到的问题？

我有一个服务器软件，可以同时运行大约 400 个连接的用户。但如果发生崩溃，所有 400 个用户都会受到影响。我们添加了结构化异常处理并享受了一段时间的结果，但最终不得不将其删除，因为一些崩溃导致整个服务器挂起（这比让它崩溃并自行重启更糟糕）。

所以我们有这个：

*   使用 SEH：400 中只有 1 个用户在大多数崩溃中遇到问题
*   没有 SEH：如果任何用户发生崩溃，所有 400 都会受到影响。
*   但有时与 SEH：服务器挂起，所有 400 都受到影响，未来的用户会尝试连接。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T04:09:40.087

使用 SEH，因为您的程序随机崩溃是一个坏主意。您可以撒在程序上以使其停止崩溃，这不是神奇的小精灵尘埃。追踪并修复导致崩溃的错误是正确的解决方案。

当您确实需要处理结构化异常时使用 SEH 很好。Larry Osterman 发表了一篇后续文章，解释[了哪些情况需要 SEH：内存映射文件、RPC 和安全边界转换](http://blogs.msdn.com/larryosterman/archive/2006/10/16/so-when-is-it-ok-to-use-seh.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T20:24:24.743

将您的程序分解为工作进程和单个服务器进程。服务器进程将处理初始请求，然后将它们交给工作进程。如果工作进程崩溃，则只有该工作进程上的用户会受到影响。不要将 SEH 用于一般的异常处理 - 正如您所发现的，它可以而且会让您对死锁敞开大门，而且您仍然可能崩溃。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T07:16:45.597

修复程序中的错误？;)

就我个人而言，我会保留 SEH 处理程序，让他们转储出访问冲突或发生任何事情的调用堆栈并解决问题。“有时服务器挂起”问题可能是由于线程导致的死锁导致 SEH 异常保持锁定，因此不太可能与您使用 SEH 本身的事实有关。

# java - 以编程方式检查 .class 文件

> ID：164378
> 
> 赞同：15
> 
> 时间：2008-10-02T20:20:53.083
> 
> 标签：java, bytecode, decompiling

我正在做一个项目，我们在 Java 服务和用其他各种语言编写的客户端之间进行大量远程对象传输。鉴于我们当前的限制，我决定看看如何根据现有的 Java 类生成代码。基本上，我需要获取一个`.class`文件（或它们的集合）来解析字节码以确定所有数据成员，也许还有 getter/setter，然后编写一些可以用不同语言输出代码的东西来创建一个具有相同结构的类。

我不是在寻找诸如 JAD 之类的标准反编译器。我需要能够获取一个`.class`文件并为其数据成员和方法创建一个对象模型。这可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-02T20:53:00.917

我用过BCEL，发现它真的很尴尬。[ASM](http://asm.objectweb.org/)要好得多。它非常广泛地使用访问者（这可能有点令人困惑）并且不创建对象模型。不创建对象模型被证明是一个好处，因为您想要创建的任何模型都不太可能看起来像对所有数据的字面解释。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T20:22:40.943

我过去使用过 BCEL，它非常易于使用。那是几年前的事了，所以现在可能会有更好的东西。

[阿帕奇雅加达BCEL](http://jakarta.apache.org/bcel/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T00:10:52.143

根据您的描述，听起来[简单的反射](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html)就足够了。您可以发现类的所有静态结构，以及访问特定实例的字段。

如果您尝试翻译方法说明，我只会继续使用 BCEL。（如果这就是你想要实现的自动化，祝你好运！）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-03T03:26:58.147

[JAD](http://varaneckas.com/jad/)是一个不允许编程访问的 java 反编译器。它不再可用，并且可能不适用于具有 Java7 字节码的较新项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T04:17:53.327

我很震惊，还没有人提到[ASM](http://asm.objectweb.org)。这是您的钱可以买到的最好的字节码库。好吧，好吧，它是免费的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T20:35:37.947

我认为 javassist 也可以帮助你。

[http://www.jboss.org/javassist/](http://www.jboss.org/javassist/)

我从来没有需要使用它，但如果你试一试，你会告诉我们你对它的意见吗？

虽然我认为它更多的是用于字节码操作而不是 .class 检查。

# flash - Flash 横幅与弹出窗口拦截器冲突？

> ID：164382
> 
> 赞同：3
> 
> 时间：2008-10-02T20:21:05.517
> 
> 标签：flash, banner, popup-blocker

我们一直在使用 getURL 链接方法（在空白窗口中）创建横幅。对于许多人来说，它工作得很好。您单击横幅并被带到我们的网站。对于其他人（包括我），单击 flash 对象会在 FireFox 中触发弹出警告（2 和 3，默认设置）。奇怪的是，它不会发生在每个人身上。它发生在我的主机（vista 64，FF3）上，但不在我的辅助机器（XP 64，FF3）上。我有其他人和我一样在运行 Vista/FF3，它对他们来说运行良好……但不是我。

一个示例是此页面左侧的 300x250 横幅： [http ://www.jguitar.com/](http://www.jguitar.com/)

我们很困惑，不知道为什么会这样。任何反馈将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T22:15:41.623

根据我的经验，您需要将链接放在 onRelease 处理程序（或 as3 中的 MouseEvent.CLICK）中，以免被阻止。如果您将其设置为 onPress 或其他任何内容，它将被阻止。这在某些设置上并非万无一失，无论如何它都会被阻止，但这通常是由于阻止程序或类似的设置更严格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T14:33:40.160

Use this code, with **allowscriptaccess='always'** and **wmode='transparant'** or **'opaque'** in the HTML code on the Flash element.

```
private function click(event : MouseEvent) : void {
    getURL(LoaderInfo(root.loaderInfo).parameters.clic kTag);
}

private function getURL(url : String, window : String = "_blank") : void { 
    var browser : String = ExternalInterface.call("function getBrowser(){return 
    navigator.userAgent}") as String; 

    if (browser.indexOf("Firefox") != -1 || browser.indexOf("MSIE 7.0") != -1) { 
        ExternalInterface.call('window.open("' + url + '","' + window + '")'); 
    } else { 
       navigateToURL(new URLRequest(url), window); 
    }
} 
```

# .net - 搜索字符串文字

> ID：164393
> 
> 赞同：19
> 
> 时间：2008-10-02T20:23:33.077
> 
> 标签：.net, string, localization, string-literals

在寻求本地化的过程中，我需要找到散落在我们源代码中的所有字符串文字。我正在寻找一种将其编写到修改后源存储库检查中的方法。（在某些人检查某些内容后，IE 有一个框设置来检查此统计信息）我可能会使用 NAnt 和 CruiseControl 或其他东西来处理 CVS 的管理（在我的情况下是 StarTeam :(）但是你知道任何可编写脚本的吗（或命令行）实用程序来准确循环通过源代码查找字符串文字？我意识到我可以根据正则表达式进行简单的字符串查找，但想要更多的收益。（也许分析字符串或将其分类) 因为很多时候字符串可能不一定需要翻译。有什么想法吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-02T20:32:34.133

Visual Studio 2010 及更早版本：

1.  在文件中查找 (CTRL+SHIFT+F)
2.  用途：正则表达式
3.  查找：（**`:q`** 引用的字符串）
4.  找到所有

查找结果窗口现在将包含所有文件的报告，包括行号和带引号的字符串的行本身。

对于 Visual Studio 2012 和更高版本的搜索`((\".+?\")|('.+?'))`（[参考，](http://msdn.microsoft.com/en-us/library/vstudio/2k3te2cs%28v=vs.110%29.aspx) [@CincauHangus](https://stackoverflow.com/users/484578/cincauhangus)的帽子提示）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T20:29:35.763

它使用编译后的二进制文件而不是源代码，但 Sysinternals 的[Strings](http://technet.microsoft.com/en-us/sysinternals/bb897439.aspx)应用程序可能有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-04-28T12:44:13.357

要查找所有`Text="textonly"`实例，请在搜索时使用以下正则表达式：

```
(Text=)(")([a-z]) 
```

这有助于查找`Text="*"`但排除已转换为使用资源文件的文本：

```
Text="<%$ Resources:LocalizedText, KeyNameFromResourceFile%>" 
```

也`(>)([a-z])`可用于在标签之间查找文字，如下所示：

```
<h1>HeaderText</h1> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-02-18T16:36:39.980

1.  在文件中查找 (CTRL+SHIFT+F)
2.  查找选项 -> 检查`Use Regular Expressions`

对于文字中的特定文本：

3.  找什么：`"+.*(MYSPECIFICTEXT)+.*"+`

对于所有文字

3.  找什么：`"+.*"+`

然后

4.  找到所有

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T20:27:02.243

CodePlex 上有一个您可以使用的[C# 解析器。](http://www.codeplex.com/csparser)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-10-29T08:25:51.627

嗨，这是用于搜索文字的正则表达式，我用它来查找要翻译的文本。它还包括空格和不同的引号

正则表达式：

```
([",`,'])([\w,\s]*)([",`,']) 
```

searchstring: var test='这是一个测试';

# php - Is it possible to add data members dynamically in PHP?

> ID：164395
> 
> 赞同：4
> 
> 时间：2008-10-02T20:23:48.490
> 
> 标签：php, oop

I'm wondering if its possible to add new class data members at run-time in PHP?

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-02T20:28:15.860

Yes.

```
$prop = 'newname';
$obj->$prop = 42; 
```

will do the same thing as:

```
$obj->newname = 42; 
```

Either one will add "newname" as a property in $obj if it does not yet exist.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T20:27:20.337

It is. You can add public members are run time with no additional code, and can affect protected/private members using the magical overloading methods __get() / __set(). See [here](http://www.php.net/manual/en/language.oop5.overloading.php) for more details.

# javascript - JavaScript：如何将消息打印到错误控制台？

> ID：164397
> 
> 赞同：451
> 
> 时间：2008-10-02T20:23:55.150
> 
> 标签：javascript, debugging

如何将消息打印到错误控制台，最好包括一个变量？

例如，类似：

```
print('x=%d', x); 
```

* * *

## 回答 #1

> 赞同：475
> 
> 时间：2008-10-02T20:26:42.663

安装[Firebug](http://en.wikipedia.org/wiki/Firebug_(software))然后你就可以使用`console.log(...)`and`console.debug(...)`等[了（更多信息参见文档](http://getfirebug.com/wiki/index.php/Console_Panel#Message_types)）。

* * *

## 回答 #2

> 赞同：335
> 
> 时间：2012-09-20T16:07:42.647

```
console.error(message); // Outputs an error message to the Web Console
console.log(message); // Outputs a message to the Web Console
console.warn(message); // Outputs a warning message to the Web Console
console.info(message); // Outputs an informational message to the Web Console. In some browsers it shows a small "i" in front of the message. 
```

您还可以添加 CSS：

```
console.log('%c My message here', "background: blue; color: white; padding-left:10px;"); 
```

更多信息可以在这里找到：[https ://developer.mozilla.org/en-US/docs/Web/API/console](https://developer.mozilla.org/en-US/docs/Web/API/console)

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2010-06-17T09:08:41.203

异常记录到 JavaScript 控制台。如果你想禁用[Firebug ，你可以使用它。](http://en.wikipedia.org/wiki/Firebug_%28software%29)

```
function log(msg) {
    setTimeout(function() {
        throw new Error(msg);
    }, 0);
} 
```

用法：

```
log('Hello World');
log('another message'); 
```

* * *

## 回答 #4

> 赞同：54
> 
> 时间：2008-10-03T10:00:49.683

*[Debugging JavaScript: Throw Away Your Alerts](http://www.sitepoint.com/debugging-javascript-throw-away-your-alerts/)*中概述了一种跨浏览器的好方法。.

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2011-01-27T23:39:42.947

这是如何将消息打印到浏览器的错误控制台而不是调试器控制台的字面问题的解决方案。（绕过调试器可能有充分的理由。）

正如我在关于抛出错误以在错误控制台中获取消息的建议的评论中指出的那样，一个问题是这会中断执行线程。如果你不想中断线程，你可以在一个单独的线程中抛出错误，一个使用 setTimeout 创建的线程。因此，我的解决方案（结果证明是 Ivo Danihelka 对解决方案的阐述）：

```
var startTime = (new Date()).getTime();
function logError(msg)
{
  var milliseconds = (new Date()).getTime() - startTime;
  window.setTimeout(function () {
    throw( new Error(milliseconds + ': ' + msg, "") );
  });
}
logError('testing'); 
```

我包括自开始时间以来的时间（以毫秒为单位），因为超时可能会扭曲您可能期望看到消息的顺序。

Error 方法的第二个参数是文件名，这里是一个空字符串，以防止输出无用的文件名和行号。可以获取调用者函数，但不能以简单的浏览器独立方式获取。

如果我们可以显示带有警告或消息图标而不是错误图标的消息会很好，但我找不到这样做的方法。

使用 throw 的另一个问题是它可能被封闭的 try-catch 捕获并丢弃，并且将 throw 放在单独的线程中也可以避免该障碍。但是，还有另一种方法可以捕获错误，即如果 window.onerror 处理程序被替换为执行不同操作的处理程序。帮不了你。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-03-12T09:17:09.080

如果你使用**Safari**，你可以写

```
console.log("your message here"); 
```

它出现在浏览器的控制台上。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-03-26T13:54:42.187

要真正回答这个问题：

```
console.error('An error occurred!');
console.error('An error occurred! ', 'My variable = ', myVar);
console.error('An error occurred! ' + 'My variable = ' + myVar); 
```

除了错误，您还可以使用信息、日志或警告。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-02T20:52:12.167

如果您使用[Firebug](http://getfirebug.com/)并且还需要支持 IE、Safari 或 Opera，[Firebug Lite](http://getfirebug.com/lite.html)会为这些浏览器添加 console.log() 支持。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-03T03:44:52.080

[WebKit](http://en.wikipedia.org/wiki/WebKit) Web Inspector 还支持[Firebug 的](http://en.wikipedia.org/wiki/Firebug)控制台API（只是[Dan 的回答的](https://stackoverflow.com/questions/164397/javascript-how-do-i-print-a-message-to-the-error-console/164408#164408)一个小补充）。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-11-29T17:08:07.040

上面提到的关于“throw()”的注释。似乎它完全停止了页面的执行（我在 IE8 中检查过），所以它对于记录“正在进行的进程”不是很有用（比如跟踪某个变量......）

我的建议可能是在文档的某处添加一个*textarea元素，并在需要时更改（或附加到）其**值*（这将更改其文本）以记录信息......

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-03-20T10:38:48.033

与往常一样，Internet Explorer 是旱冰鞋中的一头大象，它阻止您只是简单地使用`console.log()`.

[jQuery 的日志](http://plugins.jquery.com/files/jquery.log.js_0.txt)可以很容易地适应，但是必须到处添加它是一件痛苦的事。如果您使用 jQuery，一个解决方案是在最后将其放入您的 jQuery 文件中，首先缩小：

```
function log()
{
    if (arguments.length > 0)
    {
        // Join for graceful degregation
        var args = (arguments.length > 1) ? Array.prototype.join.call(arguments, " ") : arguments[0];

        // This is the standard; Firebug and newer WebKit browsers support this.
        try {
            console.log(args);
            return true;
        } catch(e) {
            // Newer Opera browsers support posting erros to their consoles.
            try {
                opera.postError(args);
                return true;
            } 
            catch(e) 
            {
            }
        }

        // Catch all; a good old alert box.
        alert(args);
        return false;
    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-05-21T14:37:51.523

访问[https://developer.chrome.com/devtools/docs/console-api](https://developer.chrome.com/devtools/docs/console-api)获取完整的控制台 api 参考

```
 console.error(object[Obj,....])\ 
```

在这种情况下， object 将是您的错误字符串

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-11-04T17:49:19.667

```
function foo() {
  function bar() {
    console.trace("Tracing is Done here");
  }
  bar();
}

foo();
```

```
console.log(console); //to print console object
console.clear('console.clear'); //to clear console
console.log('console.log'); //to print log message
console.info('console.info'); //to print log message 
console.debug('console.debug'); //to debug message
console.warn('console.warn'); //to print Warning
console.error('console.error'); //to print Error
console.table(["car", "fruits", "color"]);//to print data in table structure
console.assert('console.assert'); //to print Error
console.dir({"name":"test"});//to print object
console.dirxml({"name":"test"});//to print object as xml formate
```

```
To Print Error:- console.error('x=%d', x); 
```

```
console.log("This is the outer level");
console.group();
console.log("Level 2");
console.group();
console.log("Level 3");
console.warn("More of level 3");
console.groupEnd();
console.log("Back to level 2");
console.groupEnd();
console.log("Back to the outer level");
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-02-01T11:56:35.323

```
console.log("your message here"); 
```

为我工作.. 我正在寻找这个.. 我使用 Firefox。这是我的脚本。

```
 $('document').ready(function() {
console.log('all images are loaded');
}); 
```

适用于 Firefox 和 Chrome。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-09-04T07:36:46.927

最简单的方法是：

```
console.warn("Text to print on console"); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-06-12T13:24:11.377

要回答您的问题，您可以使用 ES6 功能，

```
var var=10;
console.log(`var=${var}`); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-10-23T14:25:52.607

这不会打印到控制台，但会打开一个警告弹出窗口，其中包含您的消息，这可能对某些调试有用：

做就是了：

```
alert("message"); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-12-20T10:17:28.593

使用 es6 语法，您可以使用：

```
console.log(`x = ${x}`); 
```

# sql-server-2005 - Sql 2005 Express版连接慢

> ID：164400
> 
> 赞同：1
> 
> 时间：2008-10-02T20:24:56.240
> 
> 标签：sql-server-2005

我在笔记本电脑上运行 SqlServer 2005 express edition 以用于开发目的。似乎当我打开与数据库的连接时，设置时间真的很慢。最多可能需要 10 秒才能建立连接。我通常同时打开多个连接（Profiler、开发环境、查询分析器等）。我有一种预感，缓慢的时间与我打开多个连接的事实有关。

Express 版中是否有一个调节器可以在对一个实例进行多个连接时限制连接时间？

更新：我的工作站不在活动目录上，并且 SQL 正在运行混合模式安全性。我将尝试使用 sql 身份验证登录。我没有使用用户实例。

Update2：我设置了一个跟踪来尝试找出发生了什么。打开与数据库的连接后，将执行以下命令：

```
master.dbo.sp_MShasdbaccess 
```

此命令需要 6 秒才能执行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:52:18.317

我想到了。问题是我有多个将 AutoClose 设置为 true 的数据库。我在所有数据库中将其关闭，问题就消失了。

看到[这篇文章](http://www.sqlservercentral.com/articles/Administering/autoclosefordatabases/891/)了解更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T20:33:32.960

你确定连接是瓶颈吗？是你的 conn.Open() 线需要 10 秒吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T20:42:48.553

AFAIK SQL Express 中不再有治理者。

现在，您是否在 Windows Active Directory 域中？如果是这样，您的 DNS 可能存在问题，或者意味着连接到域控制器以验证您登录到服务器实例的连接需要花费一些时间。我建议您尝试切换服务器以使用 SQL 安全性，为 SA 帐户提供密码，然后尝试以 SA 身份登录，看看是否有区别。

# javascript - 哪些 JavaScript 框架相互冲突？

> ID：164403
> 
> 赞同：5
> 
> 时间：2008-10-02T20:25:26.007
> 
> 标签：javascript, frameworks, conflict

有时我想将*mootools*用于某些事物，而将 Prototype &*`script.aculo.us`*用于其他事物，但在同一个站点内。我什至考虑过添加其他人，但担心冲突。任何人都有经验，还是我只是想让事情对自己来说太复杂了？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T20:44:19.457

如果您真的非常想这样做，那么您将能够没有太多问题 - 主库被设计为在它们自己的命名空间内表现良好，但有几个值得注意的例外 - 来自[将 JQuery 与其他框架一起使用](http://docs.jquery.com/Using_jQuery_with_Other_Libraries)：

> jQuery 库及其几乎所有插件都被限制在 jQuery 命名空间内。作为一般规则，“全局”对象也存储在 jQuery 命名空间内，因此您不应该在 jQuery 和任何其他库（如 Prototype、MooTools 或 YUI）之间发生冲突。
> 
> 也就是说，有一个警告：默认情况下，jQuery 使用“$”作为“jQuery”的快捷方式，您可以覆盖它。

所以，是的，你可以做到，但你可能会为自己制造更麻烦的维护问题 - 框架功能之间的细微差别今天对你来说可能很明显，但在 6 个月后回来，它可能会完全不同故事！因此，我建议尽可能保持简单，并在代码库中尽可能少地使用不同的框架（最好是 1 个！）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T20:30:38.210

AFAIK，所有流行的框架都旨在与其他框架相结合。我不认为将它们结合起来有那么大的问题。但是，我不鼓励纯粹从带宽需求的情况下组合它们。与更复杂的开发体验相比，缓慢的网站体验更不可原谅。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T22:48:49.110

最近的一个问题：[jQuery 和原型冲突](https://stackoverflow.com/questions/134572/jquery-prototype-conflict)

Prototype.js 库曾经非常令人反感，并且与许多其他库/代码发生冲突。然而，据我所知，他们最近放弃了一些非常核心的工作人员，例如更换 Element 对象等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T20:30:03.280

你最好坚持每个应用程序使用一个框架。否则您的客户将花费太多时间/带宽下载 javascript。

话虽如此，Prototype 和 JQuery 可以一起工作。信息在 JQuery 网站上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T22:08:18.537

我的建议是很好地学习一个（或多个！）框架，以便您能够复制您需要的功能，而不会增加多个框架的开销。

请记住，您向客户端推送的代码越多，一切都会变得越慢。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T22:22:19.237

根据我的经验，我可以说一些 javascript 库与浏览器冲突，而不是彼此冲突。我的意思是：有时针对某些库编写的代码与针对浏览器 DOM 编写的代码不能很好地共存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-29T10:24:03.593

我的 Framework Scanner 工具可用于查找库之间的 JS/CSS 冲突：

[http://mankz.com/code/GlobalCheck.htm](http://mankz.com/code/GlobalCheck.htm)

# regex - 如何与正则表达式“反向匹配”？

> ID：164414
> 
> 赞同：137
> 
> 时间：2008-10-02T20:27:08.247
> 
> 标签：regex, inverse-match

我正在逐行处理一个文件，我想做一个反向匹配。例如，我想匹配有六个字母的字符串的行，但前提是这六个字母不是' *Andrea* '。我该怎么做？

我正在使用[RegexBuddy](https://en.wikipedia.org/wiki/RegexBuddy)，但仍然遇到问题。

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-10-02T20:28:46.700

```
(?!Andrea).{6} 
```

假设您的正则表达式引擎支持负前瞻...

...或者您可能更愿意`[A-Za-z]{6}`使用`.{6}`

请注意，前瞻和后瞻通常不是“反转”正则表达式匹配的正确方法。正则表达式并不是真正为进行否定匹配而设置的；他们将其留给您使用的任何语言。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-12-15T19:57:06.583

对于 Python/Java，

```
^(.(?!(some text)))*$ 
```

[http://www.lisnichenko.com/articles/javapython-inverse-regex.html](http://www.lisnichenko.com/articles/javapython-inverse-regex.html)

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2016-08-09T09:06:59.817

在[PCRE](https://en.wikipedia.org/wiki/Perl_Compatible_Regular_Expressions)和类似变体中，您实际上可以创建一个匹配任何不包含值的行的正则表达式：

```
^(?:(?!Andrea).)*$ 
```

这叫做[淬炼的贪婪令牌](https://stackoverflow.com/a/37343088/1188377)。缺点是表现不佳。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-02T20:41:10.820

正则表达式实现的功能和语法很重要。

你可以使用前瞻。以 Python 为例，

```
import re

not_andrea = re.compile('(?!Andrea)\w{6}', re.IGNORECASE) 
```

打破它：

**(?!Andrea)**表示“如果接下来的 6 个字符不是“Andrea”则匹配”；如果是的话

**\w**表示“单词字符” - 字母数字字符。这相当于类 [a-zA-Z0-9_]

**\w{6}**表示正好是六个单词字符。

**re.IGNORECASE**表示您将排除“Andrea”、“andrea”、“ANDREA”...

另一种方法是使用您的程序逻辑 - 使用与*Andrea*不匹配的所有行，并通过第二个正则表达式检查六个字符。或者首先检查至少六个单词字符，然后检查它是否与*Andrea*不匹配。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-02T20:32:44.867

[负前瞻断言](http://www.regular-expressions.info/lookaround.html)

```
(?!Andrea) 
```

这不完全是反向匹配，但它是您可以直接使用正则表达式的最佳选择。但并非所有平台都支持它们。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-31T07:44:06.117

如果您想在 RegexBuddy 中执行此操作，有两种方法可以获取与正则表达式不匹配的所有行的列表。

在“测试”面板的工具栏上，将测试范围设置为“逐行”。当你这样做时，一个项目列出所有没有匹配的行将出现在同一工具栏上的列出所有按钮下。（如果您没有看到“列出所有”按钮，请单击主工具栏中的“匹配”按钮。）

在 GREP 面板上，您可以打开“基于行”和“反转结果”复选框，以获取您正在浏览的文件中不匹配行的列表。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-11-28T16:12:28.467

`(?!`在实践中很有用。虽然严格来说，向前看并不是数学上定义的正则表达式。

您可以手动编写反向正则表达式。

这是[一个](http://www.vidarholen.net/contents/junk/files/invert.hs)自动计算结果的程序。它的结果是机器生成的，通常比手写复杂得多。但结果有效。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-05-31T14:19:35.523

我刚刚想出了这种可能是硬件密集型的方法，但它正在工作：

您可以用空字符串替换与正则表达式匹配的所有字符。

这是一个单行：

`notMatched = re.sub(regex, "", string)`

我之所以使用它是因为我被迫使用一个非常复杂的正则表达式，并且无法弄清楚如何在合理的时间内反转它的每个部分。

**这只会返回字符串结果，而不是任何匹配对象！**

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2008-10-02T20:56:07.010

在 Perl 中，您可以：

```
process($line) if ($line =~ !/Andrea/); 
```

# c# - 确定枚举值是否在列表中（C#）

> ID：164425
> 
> 赞同：8
> 
> 时间：2008-10-02T20:29:50.317
> 
> 标签：c#, .net, enums

我正在构建一个有趣的小应用程序来确定我是否应该骑自行车上班。

我想测试一下是下雨还是雷暴（ing）。

```
public enum WeatherType : byte
{ Sunny = 0, Cloudy = 1, Thunderstorm = 2, Raining = 4, Snowing = 8, MostlyCloudy = 16 } 
```

我在想我可以做类似的事情：

```
WeatherType _badWeatherTypes = WeatherType.Thunderstorm | WeatherType.Raining;
if(currentWeather.Type == _badWeatherTypes)
{
 return false;//don't bike
} 
```

但这不起作用，因为 _badWeatherTypes 是两种类型的组合。我想将它们分开，因为这应该是一种学习体验，并且将其分开可能在其他情况下有用（IE，发票未支付原因等......）。

我也不想这样做：（这将删除为多人配置的能力）

```
if(WeatherType.Thunderstorm)
{
 return false; //don't bike
}
etc... 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-02T20:35:14.750

您当前的代码将说明它是否*完全是*“下雨和打雷”。要确定它是否“下雨、打雷以及可能是其他什么”，您需要：

```
if ((currentWeather.Type & _badWeatherTypes) == _badWeatherTypes) 
```

要确定是“下雨*还是*打雷，可能还有其他”，您需要：

```
if ((currentWeather.Type & _badWeatherTypes) != 0) 
```

编辑（为了完整性）：

最好使用`FlagsAttribute`，即用 装饰类型`[Flags]`。为了按位逻辑，这不是必需的，但会影响`ToString()`行为方式。C# 编译器忽略了这个属性（至少目前；C# 3.0 规范没有提到它）但是对于作为有效标志的枚举通常是一个好主意，并且它记录了该类型的预期用途。同时，约定是当您使用标志时，您将枚举名称复数 - 因此您将其更改为`WeatherTypes`（因为任何实际值实际上是 0 或更多天气类型）。

还值得思考“阳光”的真正含义。它目前的值为 0，这意味着它没有其他所有内容；你不能同时晴天和下雨（当然，这在物理上是可能的）。请不要编写禁止彩虹的代码！;) 另一方面，如果在你的真实用例中你真的想要一个值，这意味着“没有所有其他值”，那么你很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-11-09T15:36:34.983

我不确定它应该是一个标志 - 我认为你应该有一个范围输入：

*   温度
*   下雨多少
*   抗风强度
*   您喜欢的任何其他输入（例如雷暴）

然后，您可以使用算法来确定条件是否足够好。

我认为您还应该对骑自行车回家的天气保持不变的可能性有多大的投入。标准可能不同——回家后可以更轻松地淋浴和换衣服。

如果您真的想让它变得有趣，请从天气服务 api 收集输入数据，并每天评估决定 - 是的，我应该骑自行车，或者不，这是一个错误。然后也许你可以让应用程序学会做出更好的决定。

下一步是让你的决定“社交化”，看看其他人是否听到你在做同样的决定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T20:31:39.907

使用 FlagsAttribute。这将允许您将枚举用作位掩码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T20:35:41.457

您需要在枚举上使用 [Flags] 属性（[在此处查看）；](http://weblogs.asp.net/wim/archive/2004/04/07/109095.aspx)然后您可以使用按位并检查单个匹配项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T20:37:39.033

您应该在枚举上使用 Flags 属性。除此之外，您还需要测试是否设置了特定标志：

```
(currentWeather.Type & WeatherType.Thunderstorm == WeatherType.Thunderstorm) 
```

这将测试 currentWeather.Type 是否设置了 WeatherType.Thunderstorm 标志。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T21:01:48.493

我不会将自己限制在比特世界中。正如您所发现的，枚举和位运算符不是一回事。如果您想使用按位运算符解决这个问题，我会坚持使用它们，即不要打扰枚举。但是，我想要以下内容：

```
 WeatherType[] badWeatherTypes = new WeatherType[]
        {   
            WeatherType.Thunderstorm, 
            WeatherType.Raining
        };

        if (Array.IndexOf(badWeatherTypes, currentWeather.Type) >= 0)
        {
                        return false;
        } 
```

# python - 基于 User-Agent 更改 Django 模板

> ID：164427
> 
> 赞同：40
> 
> 时间：2008-10-02T20:30:09.443
> 
> 标签：python, django, django-templates, mobile-website, django-middleware

我做了一个 Django 网站，但我喝了 Koolaid，我想做一个*iPhone*版本。经过深思熟虑，我提出了两个选择：

1.  制作一个完整的其他网站，例如 i.xxxx.com。使用 Django 的站点框架将其绑定到同一个数据库中。
2.  找一些中间件读取用户代理，并动态更改模板目录。

但是，我真的更喜欢选项＃2；我有一些保留意见，主要是因为 Django 文档[不鼓励即时更改设置](http://docs.djangoproject.com/en/dev/topics/settings/)。我找到了一个可以做我想做的事情的[片段。](http://www.djangosnippets.org/snippets/1098/)我的主要问题是让它尽可能无缝，我希望它对用户来说是自动的和透明的。

有没有其他人遇到过同样的问题？有人愿意分享他们是如何处理制作 Django 网站的 iPhone 版本的吗？

**更新**

我结合了中间件并调整了模板调用。

对于中间件，我使用[了 minidetector](http://code.google.com/p/minidetector/)。我喜欢它，因为它可以检测到[大量](http://www.youtube.com/watch?v=b6E682C7Jj4)的移动用户代理。我所要做的就是在我的视图中检查 request.mobile 。

对于模板调用调整：

```
 def check_mobile(request, template_name):
     if request.mobile:
         return 'mobile-%s'%template_name
     return template_name 
```

我将它用于我知道我有两个版本的任何视图。

**去做：**

*   弄清楚如何在 render_to_response 的扩展版本中访问*request.mobile*，这样我就不必使用 check_mobile('template_name.html')
*   如果不存在移动版本，则使用以前的自动回退到常规模板。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-02T20:44:38.020

您可以修改请求并添加一个值，让您的视图知道用户是否在 iphone 上，而不是动态更改模板目录。然后包装 render_to_response （或您用于创建 HttpResponse 对象的任何内容）以获取模板的 iphone 版本，而不是标准的 html 版本（如果他们使用的是 iphone）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-08-15T11:57:53.370

检测中间件中的用户代理，切换url绑定，获利！

如何？Django 请求对象有一个 .urlconf 属性，可以由中间件设置。

来自 django 文档：

> Django 确定要使用的根 URLconf 模块。通常，这是 ROOT_URLCONF 设置的值，但如果传入的 HttpRequest 对象具有名为 urlconf 的属性（由中间件请求处理设置），则将使用其值代替 ROOT_URLCONF 设置。

1.  在 yourproj/middlware.py 中，编写一个检查 http_user_agent 字符串的类：

    ```
    import re
    MOBILE_AGENT_RE=re.compile(r".*(iphone|mobile|androidtouch)",re.IGNORECASE)
    class MobileMiddleware(object):
        def process_request(self,request):
            if MOBILE_AGENT_RE.match(request.META['HTTP_USER_AGENT']):
                request.urlconf="yourproj.mobile_urls" 
    ```

2.  不要忘记将其添加到 settings.py 中的 MIDDLEWARE_CLASSES 中：

    ```
    MIDDLEWARE_CLASSES= [...
        'yourproj.middleware.MobileMiddleware',
    ...] 
    ```

3.  创建一个移动 urlconf，yourproj/mobile_urls.py：

    ```
    urlpatterns=patterns('',('r'/?$', 'mobile.index'), ...) 
    ```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-19T12:46:33.280

我正在开发 djangobile，一个 django 移动扩展：[http ://code.google.com/p/djangobile/](http://code.google.com/p/djangobile/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T22:00:13.650

你应该看看[django-mobileadmin](http://code.google.com/p/django-mobileadmin/)源代码，它正好解决了这个问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-16T09:41:23.410

其他方式是创建您自己的模板加载器来加载特定于用户代理的模板。这是一种非常通用的技术，可用于根据其他因素动态确定必须加载的模板，例如请求的语言（现有 Django i18n 机器的良好伴侣）。

Django Book 有一个[关于这个主题的部分](http://www.djangobook.com/en/1.0/chapter10/#cn234)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-18T19:06:33.953

有一篇很好的文章解释了如何通过不同的模板呈现相同的数据 [http://www.postneo.com/2006/07/26/acknowledgeing-the-mobile-web-with-django](http://www.postneo.com/2006/07/26/acknowledging-the-mobile-web-with-django)

但是，您仍然需要自动将用户重定向到移动网站，这可以使用多种方法完成（您的 check_mobile 技巧也可以）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T21:08:31.410

在某些中间件中解析用户的 UA 后将用户重定向到 i.xxx.com 怎么样？我非常怀疑移动用户是否关心 url 的外观，他们仍然可以使用主 url 访问您的网站。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-11T07:43:09.383

最佳可能方案：使用 minidetector 将额外信息添加到请求中，然后使用 django 的内置请求上下文将其传递给您的模板，如下所示

```
from django.shortcuts import render_to_response
from django.template import RequestContext

def my_view_on_mobile_and_desktop(request)
    .....
    render_to_response('regular_template.html', 
                       {'my vars to template':vars}, 
                       context_instance=RequestContext(request)) 
```

然后在您的模板中，您可以引入以下内容：

```
<html>
  <head>
  {% block head %}
    <title>blah</title>
  {% if request.mobile %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}/styles/base-mobile.css">
  {% else %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}/styles/base-desktop.css">
  {% endif %}
  </head>
  <body>
    <div id="navigation">
      {% include "_navigation.html" %}
    </div>
    {% if not request.mobile %}
    <div id="sidebar">
      <p> sidebar content not fit for mobile </p>
    </div>
    {% endif %>
    <div id="content">
      <article>
        {% if not request.mobile %}
        <aside>
          <p> aside content </p>
        </aside>
        {% endif %}
        <p> article content </p>
      </aricle>
    </div>
  </body>
</html> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-24T21:09:45.207

一个简单的解决方案是围绕`django.shortcuts.render`. 我把我的放在`utils`应用程序根目录的库中。包装器通过在“移动”或“桌面”文件夹中自动呈现模板来工作。

在`utils.shortcuts`：

> ```
> from django.shortcuts import render
> from user_agents import parse
> 
> def my_render(request, *args, **kwargs):
>   """
>   An extension of django.shortcuts.render.
> 
>   Appends 'mobile/' or 'desktop/' to a given template location
>   to render the appropriate template for mobile or desktop
> 
>   depends on user_agents python library
>   https://github.com/selwin/python-user-agents
> 
>   """
>   template_location = args[0]
>   args_list = list(args)
> 
>   ua_string = request.META['HTTP_USER_AGENT']
>   user_agent = parse(ua_string)
> 
>   if user_agent.is_mobile:
>       args_list[0] = 'mobile/' + template_location
>       args = tuple(args_list)
>       return render(request, *args, **kwargs)
>   else:
>       args_list[0] = 'desktop/' + template_location
>       args = tuple(args_list)
>       return render(request, *args, **kwargs) 
> ```

在`view`：

> ```
> from utils.shortcuts import my_render
> 
> def home(request):    return my_render(request, 'home.html') 
> ```

# linux - 为什么在与 UNIX/Linux 环境交互时使用 UTF-8 编码？

> ID：164430
> 
> 赞同：12
> 
> 时间：2008-10-02T20:31:03.823
> 
> 标签：linux, unix, encoding

我知道这是习惯，但为什么呢？是否有真正的技术原因为什么任何其他方式都是一个非常糟糕的主意，或者它只是基于编码和向后兼容性的历史？此外，不使用`UTF-8`，而是使用其他编码（最值得注意的是，`UTF-16`）有什么危险？

编辑：通过交互，我主要是指`shell`and `libc`。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-02T20:33:44.207

部分是因为文件系统需要 NUL ('\0') 字节来终止文件名，所以 UTF-16 不能很好地工作。您必须修改大量代码才能进行更改。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-02T22:40:39.223

正如 jonathan-leffler 提到的，主要问题是 ASCII 空字符。C 传统上期望字符串以空值结尾。因此，标准 C 字符串函数将阻塞包含等效于 ASCII null (0x00) 的字节的任何 UTF-16 字符。虽然您当然可以使用广泛的字符支持进行编程，但 UTF-16 不是[文件名、文本文件、环境变量](http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8)中 Unicode 的合适外部编码。

此外，UTF-16 和 UTF-32 具有大端和小端方向。为了解决这个问题，您需要外部元数据，例如 MIME 类型或[Byte Orientation Mark](http://unicode.org/faq/utf_bom.html#BOM)。它指出，

> 在 8 位环境中透明地使用 UTF-8 的情况下，使用 BOM 会干扰任何需要以特定 ASCII 字符开头的协议或文件格式，例如使用“#!” 在 Unix shell 脚本的开头。

UTF-16 的前身，称为 UCS-2，不支持代理对，也有[同样的问题](http://www.uazone.org/multiling/unicode/ucs2.html)。应避免使用 UCS-2。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T20:32:22.400

我相信这主要是 UTF8 与 ASCII 提供的向后兼容性。

要回答“危险”问题，您需要指定“交互”的含义。您的意思是与 shell、libc 或内核交互吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T20:50:21.453

现代 Unix 使用 UTF-8，但这并不总是正确的。在只有几年历史的 RHEL2 上，默认值为

```
$ 语言环境
朗=C
LC_CTYPE="C"
LC_NUMERIC="C"
LC_TIME="C"
LC_COLLATE="C"
LC_MONETARY="C"
LC_MESSAGES="C"
LC_PAPER="C"
LC_NAME="C"
LC_ADDRESS="C"
LC_TELEPHONE="C"
LC_MEASUREMENT="C"
LC_IDENTIFICATION="C"
LC_ALL=
```

C/POSIX 语言环境应为 7 位 ASCII 兼容编码。

然而，正如 Jonathan Leffler 所说，任何允许在字符序列中包含 NUL 字节的编码在 Unix 上都是不可行的，因为系统 API 是区域设置无关的；字符串都被假定为以 \0 结尾的字节序列。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-06T13:13:35.480

我相信当微软开始使用两字节编码时，0xffff 以上的字符还没有被分配，所以使用两字节编码意味着没有人需要担心字符长度不同。

既然有超出此范围的字符，那么无论如何您都必须处理不同长度的字符，为什么有人会使用 UTF-16？我怀疑如果微软今天设计他们的 unicode 支持，他们会做出不同的决定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T20:33:23.583

是的，这是出于兼容性原因。UTF-8 可以向后兼容 ASCII。Linux/Unix 是基于 ASCII 的，所以它才有意义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T20:39:37.563

我认为 7 位 ASCII 很好。

严肃地说，Unicode 在事物方案中相对较新，[UTF-8](http://en.wikipedia.org/wiki/UTF-8)向后兼容 ASCII，并且对于典型文件使用更少的空间（一半），因为它每个代码点（字符）使用 1 到 4 个字节，而[UTF-16](http://en.wikipedia.org/wiki/UTF-16)使用每个代码点（字符）2 或 4 个字节。

由于更简单的宽度，UTF-16 更适合内部程序使用。它的前身 UCS-2 恰好是每个代码点的 2 个字节。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T20:56:54.823

我认为这是因为期望 ASCII 输入的程序将无法处理 UTF-16 等编码。对于大多数字符（在 0-255 范围内），这些程序会将高字节视为 NUL / 0 字符，它在许多语言和系统中用于标记字符串的结尾。这在 UTF-8 中不会发生，它旨在避免嵌入 NUL 并且与字节顺序无关。

# c# - 发生异常后在 Visual Studio 调试器中继续

> ID：164433
> 
> 赞同：49
> 
> 时间：2008-10-02T20:31:16.240
> 
> 标签：c#, debugging, exception

当我调试 C# 程序并抛出异常（由代码抛出或由框架抛出）时，IDE 停止并让我进入代码中的相应行。

目前一切都很好。

然后我按“F5”继续。从这一刻起，我仿佛陷入了无限循环。IDE 总是让我回到异常行。我必须`Shift`+ `F5`（停止调试/终止程序）才能摆脱他。

我在这里和一些同事谈过，他们告诉我这有时也会发生在他们身上。

发生了什么？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2014-04-11T03:06:36.050

您可能在 Visual Studio 中选中了“ **Unwind the callstack on unhandled exceptions ”选项。**当此选项打开时，Visual Studio 将在异常之前展开，因此点击`F5`将继续撞击同一个异常。

如果您取消选中选项 Visual Studio 将在异常处中断，但点击`F5`将继续超过该行。

此选项位于菜单*Tools* → *Options* → *Debugging* → *General*下。

* * *

**更新：** [根据 Microsoft](https://github.com/MicrosoftDocs/visualstudio-docs/issues/305)的说法，此选项*已从*VS2017 中的 Visual Studio 中删除，可能更早。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-02T20:41:26.670

这是因为该异常未处理，并且 Visual Studio 无法在没有以某种方式处理的情况下越过该行。简而言之，它是设计使然。

您可以做的一件事是将执行点（黄线/箭头）拖放到代码中的前一个点，并修改内存中的值（使用 Visual Studio 监视窗口），以便它们不会导致异常。然后再次开始单步执行代码¹。

最好停止执行并修复导致异常的问题，或者在不需要抛出时正确处理异常。

[¹这可能会产生意想不到的后果，因为您实际上是在重新执行某些代码（而不是倒回执行）。]

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T20:43:47.663

当 IDE 在有问题的代码行上中断时，它会在执行生成异常的行之前停止。如果继续，它将再次执行该行，并再次获取异常。

如果您想跳过错误以查看会发生什么，如果没有发生错误，您可以将黄色突出显示的行（接下来将执行的行）拖到有问题的代码之后的下一行代码。当然，根据违规行未能执行的操作，您的程序现在可能处于导致其他错误的状态，在这种情况下，您并没有真正帮助自己，并且可能应该修复您的代码，以便异常不会不会发生，或者处理得当。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T20:39:33.943

一旦你得到一个异常，除非在你的代码中处理了异常，否则 Visual Studio（或你可能使用的任何 IDE）将不会让你走得更远。

此行为是设计使然。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T20:42:07.247

未捕获的异常将导致您的应用程序崩溃。取而代之的是，VS 只会让您处于未捕获的异常状态，您将不得不终止或回退您的应用程序。

# python - 在 Linux/X11 上以编程方式启动独立的 Adob e flashplayer

> ID：164460
> 
> 赞同：7
> 
> 时间：2008-10-02T20:36:02.750
> 
> 标签：python, linux, adobe, x11, flash

当您从命令行启动时，独立的 flashplayer 不接受除 .swf 文件之外的任何参数。我需要播放器全屏显示，没有窗口边框等。这可以通过在程序启动后按 ctrl+f 来完成。我想以编程方式执行此操作，因为我需要它在没有任何人工交互的情况下启动全屏。

我的猜测是我需要一些方法来获取窗口的句柄，然后向它发送一个看起来像“ctrl+f”键击的事件。

如果它有什么不同，它看起来像 flashplayer 是一个 gtk 应用程序，我安装了 pygtk 的 python。

**更新**（我使用的解决方案......感谢 ypnos 的回答）：

```
./flashplayer http://example.com/example.swf & sleep 3 && ~/xsendkey -window "Adobe Flash Player 10" Control+F 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T23:44:15.357

您可以使用专门的应用程序将击键发送到窗口管理器，然后如果窗口作为屏幕上的活动窗口启动，它应该将其传递给 flash。但是，这很容易出错，因为启动 flash 和窗口出现时间之间存在延迟。

例如，您的脚本可以执行以下操作： flashplayer *.swf sleep 3 && xsendkey Control+F

应用程序 xsendkey 可以在这里找到：[http://people.csail.mit.edu/adonovan/hacks/xsendkey.html](http://people.csail.mit.edu/adonovan/hacks/xsendkey.html) 如果没有给定一个特定的窗口，它会将它发送到由您的窗口管理器处理的根窗口。您也可以先尝试使用 xprop 或与之相关的东西来找出 Window id。

另一个选项是窗口管理器，它能够记住您的设置并自动应用它们。例如 Fluxbos 就提供了这个功能。如果 flashplayer 支持调整大小，您可以设置 Fluxbox 以减少 Window 装饰并将其拉伸到整个屏幕。这也不是很好，因为它可能会影响您打开的所有 Flashplayer 窗口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T21:26:19.480

其实我很久以前就做过了，但不是小事。我们所做的是使用[Sawfish 窗口管理器](http://sawfish.wikia.com/wiki/Main_Page)并编写一个钩子来识别 flashplayer 窗口，然后剥离所有装饰并将其全屏捕捉。

这可能在不使用窗口管理器的情况下通过从外部应用程序注册 X 窗口创建事件来实现，但我对 X11 不够熟悉，无法告诉您如何完成。

另一种选择是编写一个 pygtk 应用程序，将独立的 Flash 播放器嵌入到 gtk.Socket 中，然后调整自身的大小。经过一番思考，这可能是你最好的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T13:40:49.643

```
nspluginplayer --fullscreen src=path/to/flashfile.swf 
```

来自 [ [http://gwenole.beauchesne.info//en/projects/nspluginwrapper](nspluginwrapper](http://gwenole.beauchesne.info//en/projects/nspluginwrapper](nspluginwrapper)项目)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-04T06:56:19.980

> 另一种选择是编写一个 pygtk 应用程序，将独立的 Flash 播放器嵌入到 gtk.Socket 中，然后调整自身的大小。经过一番思考，这可能是你最好的选择。

这正是我所做的。除此之外，我的播放器通过 Xcomposite、Xfixes 和 Cairo 缩放 Flash 内容。在这里可以找到包含 python 源的 .deb： [http ://www.crutzi.info/crutziplayer](http://www.crutzi.info/crutziplayer)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-16T21:31:19.987

我已经使用与 bmdhacks 提到的机制类似的机制使用 openbox 完成了这项工作。我从中确实注意到的是，独立的 Flash 播放器在全屏时的表现比在最大化的未装饰窗口中的相同播放器要差得多。（由于菜单栏，令人讨厌的是不能正确全屏）。我想知道使用自定义 gtk 主题运行它以使菜单不可见。不过，这只是一个性能问题。如果全屏当前可以正常工作，那么它会非常复杂。我在 OLPC XO 上运行，那里的性能更是一个问题。

我对 nspluginplayer 运气不佳（我认为这太麻烦了）。

最终，我有幸制作了正在运行的闪存，因此我可以简单地将代码放入闪存本身。出于类似的原因，由于您可以在 flash 中嵌入 flash，因此应该可以制作一个自动全屏并包含目标 sfw 的小存根 swf。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-22T07:57:47.483

您必须使用 Acton 脚本 3 cmd：

```
stage.displayState = StageDisplayState.FULL_SCREEN; 
```

请参阅 Adob​​e Action 脚本 3 编程。

但要小心：在全屏下，你会失去显示性能！

我遇到了这个问题......在Linux下更多！

# c# - 这位 ASP.NET 顾问知道他在做什么吗？

> ID：164468
> 
> 赞同：9
> 
> 时间：2008-10-02T20:37:56.927
> 
> 标签：c#, asp.net, exception, session-variables

我们一家子公司的 IT 部门让一家咨询公司为他们编写了一个 ASP.NET 应用程序。现在它在混淆当前用户是谁并且已知错误地向 Joe 显示 Bob 的一些数据时遇到了间歇性问题。

顾问被带回来进行故障排除，我们被邀请听取他们的解释。有两件事突出。

首先，顾问领导提供了这个伪代码：

```
void MyFunction()
{
    Session["UserID"] = SomeProprietarySessionManagementLookup();
    Response.Redirect("SomeOtherPage.aspx");
} 
```

他接着说会话变量的赋值是异步的，这似乎不正确。授予对查找函数的调用可以异步执行某些操作，但这似乎不明智。

鉴于所谓的异步性，他的理论是在引发重定向不可避免的 ThreadAbort 异常之前没有分配会话变量。然后，此故障阻止 SomeOtherPage 显示正确的用户数据。

其次，他举了一个他推荐的编码最佳实践的例子。而不是写：

```
int MyFunction(int x, int x)
{
    try 
    {
        return x / y; 
    }
    catch(Exception ex)
    {
        // log it
        throw;
    }
} 
```

他推荐的技术是：

```
 int MyFunction(int x, int y, out bool isSuccessful)
  {
    isSuccessful = false;

    if (y == 0)
        return 0;

    isSuccessful = true;

    return x / y;
  } 
```

这肯定会奏效，并且在某些情况下从性能的角度来看可能会更好。

然而，从这些和其他讨论点来看，在我们看来，这个团队在技术上并不精通。

意见？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-02T20:39:55.643

经验法则：如果您需要询问顾问是否知道他在做什么，他可能不知道；）

我倾向于同意这里。显然你没有提供太多，但他们似乎不是很能干。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-02T20:43:06.977

我会同意的。这些家伙似乎很无能。

（顺便说一句，我会检查他们是否在“SomeProprietarySessionManagementLookup”中使用静态数据。看到这一点 - 行为与你在几个月前继承的项目*中描述的完全一样*。我们终于看到了......并希望我们能与写它的人面对面......）

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-02T20:42:24.280

如果顾问编写的应用程序应该能够跟踪用户并且只向正确的用户显示正确的数据而它没有这样做，那么显然有问题。一个好的顾问会发现问题并解决它。一个糟糕的顾问会告诉你这是异步的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-02T20:57:25.493

在异步部分，唯一可行的方法是，如果正在进行的分配实际上是 Session 上的一个索引器设置器，它隐藏了一个异步调用，没有回调指示成功/失败。这似乎是一个可怕的设计选择，它看起来像你框架中的一个核心类，所以我觉得它不太可能。

通常异步调用有一种方法可以指定回调，这样您就可以确定结果是什么，或者操作是否成功。Session 的文档应该很清楚，如果它实际上隐藏了一个异步调用，但是是的......看起来顾问不知道他在说什么......

* * *

分配给会话索引器的方法调用不能是异步的，因为要异步获取值，您必须使用回调......没有办法解决这个问题，所以如果没有显式回调，它绝对不是异步的（嗯，内部可能有一个异步调用，但是方法的调用者会认为它是同步的，因此如果方法内部例如异步调用 Web 服务，则无关紧要）。

* * *

对于第二点，我认为这会好得多，并且基本上保持相同的功能：

```
int MyFunction(int x, int y)
{
    if (y == 0)
    {
        // log it
        throw new DivideByZeroException("Divide by zero attempted!");
    }

    return x / y; 
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-02T20:40:57.653

对于第一点，这确实看起来很奇怪。

在第二个问题上，尽量避免除以 0 是合理的——这是完全可以避免的，而且避免很简单。但是，使用 out 参数表示成功仅在某些情况下是合理的，例如 int.TryParse 和 DateTime.TryParseExact - 调用者无法轻松确定其参数是否合理。即使这样，返回值通常是成功/失败，而 out 参数是方法的结果。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-02T21:46:14.737

Asp.net 会话，如果您使用的是内置提供程序，不会意外给您其他人的会话。`SomeProprietarySessionManagementLookup()`是可能的罪魁祸首，并且返回错误的值或只是不工作。

> ```
> Session["UserID"] = SomeProprietarySessionManagementLookup(); 
> ```

首先，从异步 SomeProprietarySessionManagementLookup() 分配返回值是行不通的。顾问代码可能如下所示：

```
public void SomeProprietarySessionManagementLookup()
{
    // do some async lookup
    Action<object> d = delegate(object val)
    {
        LookupSession(); // long running thing that looks up the user.
        Session["UserID"] = 1234; // Setting session manually
    };

    d.BeginInvoke(null,null,null);               
} 
```

顾问并不完全是 BS，但他们写了一些错误的代码。Response.Redirect() 确实会抛出 ThreadAbort，如果专有方法是异步的，asp.net*不知道*在 asp.net 本身保存会话之前等待异步方法写回会话。这可能就是为什么它有时有效，有时无效的原因。

如果 asp.net 会话在进程中，他们的代码可能会工作，但状态服务器或数据库服务器不会。这取决于时间。

我测试了以下内容。我们在开发中使用状态服务器。此代码有效，因为会话是在主线程完成之前写入的。

```
Action<object> d = delegate(object val)
{
    System.Threading.Thread.Sleep(1000);  // waits a little
    Session["rubbish"] = DateTime.Now;
};

d.BeginInvoke(null, null, null);
System.Threading.Thread.Sleep(5000);      // waits a lot

object stuff = Session["rubbish"];
if( stuff == null ) stuff = "not there";
divStuff.InnerHtml = Convert.ToString(stuff); 
```

下一段代码**不起作用，**因为在异步方法开始设置会话值时会话已经保存回状态服务器。

```
Action<object> d = delegate(object val)
{
    System.Threading.Thread.Sleep(5000);  // waits a lot
    Session["rubbish"] = DateTime.Now;
};

d.BeginInvoke(null, null, null);

// wait removed - ends immediately.
object stuff = Session["rubbish"];
if( stuff == null ) stuff = "not there";
divStuff.InnerHtml = Convert.ToString(stuff); 
```

第一步是让顾问让他们的代码同步，因为他们的*性能技巧*根本不起作用。如果解决了问题，请让顾问使用[异步编程设计模式正确实施](http://msdn.microsoft.com/en-us/library/aa719599(VS.71).aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T20:43:09.270

我部分同意他的观点——检查 y 是否为零肯定比捕捉（昂贵的）异常要好。out bool isSuccessful 对我来说似乎真的过时了，但无论如何。

回复：异步 sessionid 小丑 - 可能是也可能不是，但听起来顾问正在冒烟作为掩护。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T20:44:49.890

[科迪的经验法则是完全正确的。](https://stackoverflow.com/questions/164468/does-this-consultant-know-what-hes-doing#164478) 如果你不得不问，他可能不会。

似乎第二点显然是不正确的。.NET 的标准解释说，如果一个方法失败，它应该抛出一个异常，这似乎更接近原来的；不是顾问的建议。假设异常准确且具体地描述了失败。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T20:48:44.750

顾问首先创建了代码，对吗？它不起作用。我想你已经在他们身上沾满了污垢。

异步答案听起来像废话，但其中可能有一些东西。大概他们已经提供了一个合适的解决方案以及描述他们自己创建的问题的伪代码。我更倾向于根据他们的解决方案而不是他们对问题的表达来评判他们。如果他们的理解有缺陷，他们的新解决方案也将不起作用。然后你就会知道他们是白痴。（事实上​​，看看你是否已经在他们代码的任何其他区域有类似的证明）

另一个是代码风格问题。有很多不同的方法可以应对这种情况。我个人不喜欢那种风格，但会有适合的情况。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-02T20:52:49.497

他们在异步上是错误的。

分配发生，然后页面重定向。该函数可以异步启动某些内容并返回（甚至可以想象以自己的方式更改 Session），但无论它返回什么，都必须在您在重定向之前提供的代码中分配。

他们在任何低级代码甚至高级函数中的防御性编码风格都是错误的，除非它是一个特定的业务案例，即 0 或 NULL 或空字符串或任何应该以这种方式处理的东西 - 在这种情况下，它是总是成功（成功的标志是令人讨厌的代码味道）而不是例外。例外是例外。你不想通过溺爱函数的调用者来掩盖这样的行为。尽早发现并抛出异常。我认为 Maguire 在编写 Solid Code 或 McConnell 在 Code Complete 中介绍了这一点。无论哪种方式，它都闻起来了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T21:19:53.643

**这家伙不知道自己在做什么**。明显的罪魁祸首就在这里：

```
Session["UserID"] = SomeProprietarySessionManagementLookup(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T20:50:35.557

典型的“顾问”胡说八道：

1.  问题在于 SomeProprietarySessionManagementLookup 正在做什么
2.  只有抛出异常才会昂贵。不要害怕，但只有在*特殊*`try..catch`情况下才会发生抛出。如果变量**不**应该为零，那么 an将是合适的。*`y` **`ArgumentOutOfRangeException`***

 **** * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T20:51:00.407

我必须同意约翰鲁迪的观点。我的直觉告诉我问题出在 SomeProprietarySessionManagementLookup() 中。

..而且您的顾问听起来并不确定。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-02T20:53:30.353

以非异步方式存储在 Session 中。因此，除非该函数是异步的，否则这是不正确的。但即便如此，由于它没有调用 BeginCall 并且在完成时有要调用的内容，所以在 Session 行完成之前，下一行代码不会执行。

对于第二个语句，虽然可以使用它，但它并不是最佳实践，您需要注意一些事项。您节省了抛出异常的成本，但您不想知道您正在尝试除以零而不是仅仅移动过去吗？

我认为这根本不是一个可靠的建议。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-02T21:00:29.853

很奇怪。在第二个项目上，它可能会或可能不会更快。虽然它肯定不是相同的功能。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-02T21:16:49.440

我猜您的顾问建议使用状态变量而不是异常进行错误处理是一种更好的做法？我不同意。人们多久忘记或懒得对返回值进行错误检查？此外，通过/失败变量不提供信息。除了除以零之外，还有更多的事情可能出错，比如整数 x/y 太大或 x 是 NaN。当事情出错时，状态变量不能告诉你出了什么问题，但异常可以。Exception 是例外情况，除以零或 NaN 绝对是例外情况。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-02T21:39:17.437

会话的事情是可能的。毫无疑问，这是一个错误，但可能是在下一次读取之后，写入到达了您正在使用的任何自定义会话状态提供程序。会话状态提供者 API 提供锁定以防止此类事情发生，但如果实施者只是忽略了所有这些，那么您的顾问可能会说实话。

第二个问题也有点道理。这不是很惯用 - 它是 int.TryParse 之类的稍微颠倒的版本，用于避免因抛出大量异常而导致的性能问题。但是，除非您大量调用该代码，否则它不太可能产生明显的差异（相比之下，每页减少一个数据库查询等）。这当然不是您默认应该做的事情。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-03T13:42:15.673

If SomeProprietarySessionManagementLookup(); 正在执行异步分配，它更可能看起来像这样：

```
SomeProprietarySessionManagementLookup(Session["UserID"]); 
```

代码将结果分配给 Session["UserID"] 的事实表明它不应该是异步的，并且应该在调用 Response.Redirect 之前获得结果。如果 SomeProprietarySessionManagementLookup 在计算其结果之前返回，则无论如何它们都存在设计缺陷。

抛出异常或使用 out 参数是一个观点和情况的问题，在实际实践中，无论你怎么做，都不会成为一堆豆子。要使异常对性能的影响成为一个问题，您需要大量调用该函数，这本身可能就是一个问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-06T23:02:23.420

如果顾问在您的服务器上部署了他们的 ASP.NET 应用程序，那么他们可能已经以未编译的形式部署了它，这意味着您可以查看一堆浮动的 *.cs 文件。

如果您只能找到他们的已编译的 .NET 程序集（DLL 和 EXE），那么您仍然应该能够将它们反编译成一些可读的源代码。我敢打赌，如果您查看代码，您会发现它们在专有查找代码中使用静态变量。然后，您将有一些非常具体的东西向您的老板展示。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-26T02:20:20.790

整个答案流充满了典型的程序员态度。它让我想起了 Joel 的“你不应该做的事情”文章（从头开始重写。）我们对系统一无所知，除了有一个错误，有人在网上发布了一些代码。未知数太多，说“这家伙不知道自己在做什么”是很可笑的。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-03-08T20:35:12.637

而不是堆积在顾问身上，你可以很容易地堆积在购买他们服务的人身上。没有顾问是完美的，招聘经理也不是……但归根结底，你应该采取的真正方向非常明确：与其**试图找出错误，不如将精力投入到协作寻找解决方案**上。无论某人在他们的角色和职责上多么熟练，他们肯定会有不足之处。如果您确定存在一种不称职的模式，那么您可能会选择过渡到另一个资源，但在历史上，指责从来没有解决过一个问题。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2008-10-02T20:49:20.660

关于第二点，我不会在这里使用例外。例外是为特殊情况保留的。
但是，任何东西除以零肯定不等于零（至少在数学上），所以这将是具体情况。

# c# - 您会使用什么报告工具？

> ID：164492
> 
> 赞同：1
> 
> 时间：2008-10-02T20:42:30.083
> 
> 标签：c#, printing, report

我需要一个通过我的 C# 应用程序同时处理屏幕和打印报告的工具。

我正在寻找简单、标准和强大的功能。

我需要能够让用户能够使用我自己的 GUI 选择要显示的列、格式化等...并根据他们的选择动态构建报告。Crystal 不适合这里的账单，因为不能动态添加列（并且不能动态调整列宽）。

我正在考虑在我的应用程序中将 HTML 与 WebBrowser 控件一起使用，但我对打印和打印预览几乎没有控制权。

另一种选择是转到 .NET 3.5（我使用的是 2.0）并将 XAML 与流文档一起使用。

你会用什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T20:59:25.970

我们使用 SQL 报告服务。HTML 报告有它们的位置，但您无法对格式进行太多控制。

SQL 报告服务摘要：

优点：
基本版本是免费的
包含在 SQL express 中
许多导出选项 pdf、html、csv 等
可以使用许多不同的数据源
公开各种方法的 Web 服务
SQL 标准版包含一个报表构建器组件，允许用户创建和共享自己的报表
很多功能查询格式等
调度选项
可扩展性 导入 .net 框架 dll 以实现自定义功能
熟悉的 microsoft 环境

缺点：
额外的设置
应用程序和报告服务器之间的无缝身份验证可能会很痛苦，具体取决于您的设置
有点学习曲线，尽管它不是太很难捡起
报告模型创建者需要一些工作并且不会自动生成字段

我听说过有关 DevXpress 的好消息，因此可能值得研究。

大约 5 年前，我使用了 Crystal，并记得安装起来很痛苦，而且许可成本很高。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T01:54:35.717

查看 Studio 2008 / .NET 3.5 中的报告查看器内容

这个惊人的网站有完整的独家新闻： [GotReportViewer](http://www.gotreportviewer.com/)

这是一个很好的报告系统构建，可以显示报告和打印。它不像 Crystal 或 SQL Reporting Services 那样成熟。如果您所需要的只是一些轻量级的报告，那么您将无法超越价格。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T20:46:00.153

Crystal = 占用空间大，部署庞大，速度快，设计器好，支持 MS ReportViewer = 占用空间小，速度慢，设计器差，支持.. 好吧，在 reportviewer 之后搜索起来不是那么容易，一个名字都在使用.. 叹息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T20:46:00.513

我们在这里使用[ActiveReports.net](http://www.datadynamics.com/Products/ProductOverview.aspx?Product=ARNET3)。他们很好，而且往往能很好地完成工作，但我不确定他们是否符合你对“动态”的定义。但是你几乎可以让他们通过代码做任何事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T20:48:24.657

我目前正在考虑将 DevXpress XtraReports 作为 CR 的替代品。到目前为止，我喜欢我所看到的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T00:50:05.200

SQL Reporting Services 可能不够灵活，无法满足您的需求，因为您并没有真正获得深层次的代码操作。

活动报告可以让您进入绑定事件，并且几乎可以做任何您想做的事情，但是活动报告有几个小错误（比如无法绑定到数据表的默认视图），这让您很痛苦。除此之外，它非常灵活。

XtraReports 很棒，但它们比 Active Reports 贵很多。话虽如此，他们的支持非常棒，而且报告包坚如磐石。如果可能的话，我会考虑为他们分出现金。

# c++ - 如何在 Windows 中创建线程安全的单例模式？

> ID：164496
> 
> 赞同：16
> 
> 时间：2008-10-02T20:43:01.253
> 
> 标签：c++, windows, singleton

我一直在这里阅读有关线程安全的单例模式：

[http://en.wikipedia.org/wiki/Singleton_pattern#C.2B.2B_.28using_pthreads.29](http://en.wikipedia.org/wiki/Singleton_pattern#C.2B.2B_.28using_pthreads.29)

它在底部说，唯一安全的方法是使用 pthread_once - 这在 Windows 上不可用。

这是保证线程安全初始化的**唯一方法吗？**

我在 SO 上读过这个帖子：

[C++ 中单例的线程安全惰性构造](https://stackoverflow.com/questions/6915/thread-safe-lazy-contruction-of-a-singleton-in-c)

并且似乎暗示了原子操作系统级别的交换和比较功能，我假设在 Windows 上是：

[http://msdn.microsoft.com/en-us/library/ms683568.aspx](http://msdn.microsoft.com/en-us/library/ms683568.aspx)

这可以做我想要的吗？

**编辑：**我想要延迟初始化，并且只有一个类的实例。

另一个站点上的某个人提到在命名空间内使用全局变量（他将单例描述为反模式） - 它怎么可能是“反模式”？

**接受的答案：**
当我使用 Visual Studio 2008 时，我 接受了[Josh 的回答](https://stackoverflow.com/questions/164496/how-can-i-create-a-thread-safe-singleton-pattern-in-windows#164640)- 注意：对于未来的读者，如果您不使用此编译器（或 2005） - 不要使用接受的答案！

**编辑：** **代码工作正常，除了 return 语句 - 我收到一个错误：错误 C2440：'return'：无法从'volatile Singleton *'转换为'Singleton *'。我是否应该将返回值修改为 volatile Singleton *？**

**编辑：**显然 const_cast<> 将删除 volatile 限定符。再次感谢乔希。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-02T20:51:04.913

保证**单例的跨平台线程安全初始化的**一种简单方法是在应用程序启动任何其他线程**之前**（或至少任何其他将访问单例的线程）。

然后以通常的方式使用互斥锁/临界区来确保对单例的线程安全访问。

**延迟初始化**也可以使用类似的机制来实现。遇到的常见问题是提供线程安全所需的互斥锁通常在单例本身中初始化，这只会将线程安全问题推向互斥锁/关键部分的初始化。解决此问题的一种方法是在应用程序的主线程中创建和初始化互斥锁/临界区，然后通过调用静态成员函数将其传递给单例。然后可以使用这个预初始化的互斥体/临界区以线程安全的方式对单例进行重量级初始化。例如：

```
// A critical section guard - create on the stack to provide 
// automatic locking/unlocking even in the face of uncaught exceptions
class Guard {
    private:
        LPCRITICAL_SECTION CriticalSection;

    public:
        Guard(LPCRITICAL_SECTION CS) : CriticalSection(CS) {
            EnterCriticalSection(CriticalSection);
        }

        ~Guard() {
            LeaveCriticalSection(CriticalSection);
        }
};

// A thread-safe singleton
class Singleton {
    private:
        static Singleton* Instance;
        static CRITICAL_SECTION InitLock;
        CRITICIAL_SECTION InstanceLock;

        Singleton() {
            // Time consuming initialization here ...

            InitializeCriticalSection(&InstanceLock);
        }

        ~Singleton() {
            DeleteCriticalSection(&InstanceLock);
        }

    public:
        // Not thread-safe - to be called from the main application thread
        static void Create() {
            InitializeCriticalSection(&InitLock);
            Instance = NULL;
        }

        // Not thread-safe - to be called from the main application thread
        static void Destroy() {
            delete Instance;
            DeleteCriticalSection(&InitLock);
        }

        // Thread-safe lazy initializer
        static Singleton* GetInstance() {
            Guard(&InitLock);

            if (Instance == NULL) {
                Instance = new Singleton;
            }

            return Instance;
        }

        // Thread-safe operation
        void doThreadSafeOperation() {
            Guard(&InstanceLock);

            // Perform thread-safe operation
        }
}; 
```

但是，有充分的理由完全避免使用单例（以及为什么有时将它们称为**反模式**）：

*   它们本质上是美化的全局变量
*   它们可能导致应用程序的不同部分之间的高度耦合
*   它们可以使单元测试更加复杂或不可能（由于很难将真实的单例与虚假的实现交换）

另一种方法是使用“逻辑单例”，您可以在主线程中创建和初始化一个类的单个实例，并将其传递给需要它的对象。如果您想将许多对象创建为单例，这种方法可能会变得笨拙。在这种情况下，可以将不同的对象捆绑到单个“上下文”对象中，然后在必要时传递该对象。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-02T21:12:58.903

如果您使用的是 Visual C++ 2005/2008，则可以使用双重检查锁定模式，因为“[易失性变量表现为栅栏](http://en.wikipedia.org/wiki/Double-checked_locking#Usage_in_Microsoft_Visual_C.2B.2B)”。这是实现延迟初始化单例的最有效方式。

来自[MSDN 杂志：](http://msdn.microsoft.com/en-us/magazine/cc163405.aspx)

```
Singleton* GetSingleton()
{
    volatile static Singleton* pSingleton = 0;

    if (pSingleton == NULL)
    {
        EnterCriticalSection(&cs);

        if (pSingleton == NULL)
        {
            try
            {
                pSingleton = new Singleton();
            }
            catch (...)
            {
                // Something went wrong.
            }
        }

        LeaveCriticalSection(&cs);
    }

    return const_cast<Singleton*>(pSingleton);
} 
```

每当您需要访问单例时，只需调用 GetSingleton()。第一次调用时，静态指针将被初始化。初始化后，NULL 检查将阻止仅读取指针的锁定。

*不要*在任何编译器上使用它，因为它不可移植。该标准不保证这将如何工作。Visual C++ 2005 显式地增加了 volatile 的语义，使之成为可能。

您必须在代码[的其他地方声明和初始化 CRITICAL SECTION 。](http://msdn.microsoft.com/en-us/library/ms683472(VS.85).aspx)但是这种初始化很便宜，所以惰性初始化通常并不重要。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-04-20T20:12:12.463

虽然我喜欢公认的解决方案，但我刚刚找到了另一个有希望的线索，并认为我应该在这里分享它：[一次性初始化 (Windows)](http://msdn.microsoft.com/en-us/library/aa363808%28v=VS.85%29.aspx "一次性初始化 (Windows)")

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T20:51:37.143

您可以使用诸如互斥锁或临界区之类的操作系统原语来确保线程安全初始化，但是每次访问单例指针时都会产生开销（由于获取锁）。它也是非便携式的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T20:53:23.210

对于这个问题，您需要考虑一个澄清点。你需要...

1.  真正创建了一个类的唯一一个实例
2.  可以创建一个类的许多实例，但该类应该只有一个真正确定的实例

网上有很多示例可以在 C++ 中实现这些模式。这是一个[代码项目示例](http://www.codeproject.com/KB/cpp/singletonrvs.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T21:01:29.133

下面解释了如何在 C# 中执行此操作，但完全相同的概念适用于任何支持单例模式的编程语言

[http://www.yoda.arachsys.com/csharp/singleton.html](http://www.yoda.arachsys.com/csharp/singleton.html)

您需要决定是否要延迟初始化。延迟初始化意味着包含在单例中的对象是在第一次调用它时创建的：

```
MySingleton::getInstance()->doWork(); 
```

如果直到稍后才进行该调用，则如文章中所述，线程之间存在竞争条件的危险。但是，如果你把

```
MySingleton::getInstance()->initSingleton(); 
```

在您假设它是线程安全的代码的最开始，然后您不再延迟初始化，当您的应用程序启动时您将需要“一些”更多的处理能力。但是，如果您这样做，它将解决很多关于比赛条件的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T19:40:22.947

如果您正在寻找更便携、更简单的解决方案，您可以求助于 boost。

[boost::call_once](http://www.boost.org/doc/libs/1_32_0/doc/html/call_once.html)可用于线程安全初始化。

它使用起来非常简单，并将成为下一个 C++0x 标准的一部分。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-21T05:24:21.677

该问题不需要单例是否是惰性构造的。由于许多答案都假设，我假设对于第一句话讨论：

鉴于语言本身不是线程感知的，加上优化技术，编写可移植的可靠 c++ 单例非常困难（如果不是不可能的话），请参阅Scott Meyers的“ [C++ and the Perils of Double-Checked Locking](http://erdani.org/publications/DDJ_Jul_Aug_2004_revised.pdf) ”和安德烈亚历山德雷斯库。

我已经看到许多答案通过使用 CriticalSection 在 Windows 平台上同步对象，但是当所有线程都在一个处理器上运行时，CriticalSection 才是线程安全的，今天它可能不是真的。

MSDN 引用：“单个进程的线程可以使用临界区对象进行互斥同步。”。

和[http://msdn.microsoft.com/en-us/library/windows/desktop/ms682530(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/ms682530%28v=vs.85%29.aspx)

进一步澄清：

临界区对象提供的同步类似于互斥对象提供的同步，但临界区只能由单个进程的线程使用。

现在，如果“惰性构造”不是必需的，那么以下解决方案既是跨模块安全的，也是线程安全的，甚至是可移植的：

```
struct X { };

X * get_X_Instance()
{
    static X x;
    return &x;
}
extern int X_singleton_helper = (get_X_instance(), 1); 
```

它是跨模块安全的，因为我们使用本地范围的静态对象而不是文件/命名空间范围的全局对象。

它是线程安全的，因为： X_singleton_helper 必须在进入 main 或 DllMain 之前分配给正确的值。也因为这个事实，它不是惰性构造的），在这个表达式中，逗号是一个运算符，而不是标点符号。

在此处显式使用“extern”以防止编译器对其进行优化（Scott Meyers 文章的关注，最大的敌人是优化器。），并使诸如 pc-lint 之类的静态分析工具保持沉默。“在 main/DllMain 之前”是 Scott meyer 在“Effective C++ 3rd”第 4 项中称为“单线程启动部分”。

但是，我不太确定是否允许编译器根据语言标准优化 get_X_instance() 的调用，请评论。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-02T20:48:06.293

有很多方法可以在 Windows 上进行线程安全的 Singleton* 初始化。事实上，其中一些甚至是跨平台的。在您链接到的 SO 线程中，他们正在寻找一个用 C 懒惰构造的 Singleton，考虑到您正在处理的内存模型的复杂性，这更具体，并且可能有点棘手。 .

*   你不应该使用它

# firebird - 在 Firebird 中使用 CURRENT_TIMESTAMP、算术运算符和参数

> ID：164516
> 
> 赞同：4
> 
> 时间：2008-10-02T20:48:04.330
> 
> 标签：firebird

为什么这不起作用（当参数设置为 1 时）：

```
SELECT * FROM TABLE WHERE TIMESTAMPFIELD > (CURRENT_TIMESTAMP - ?) 
```

但这有效：

```
SELECT * FROM TABLE WHERE TIMESTAMPFIELD > (CURRENT_TIMESTAMP - 1) 
```

我收到错误消息：`"conversion error from string "39723.991882951" "`

我正在使用火鸟 2.1

**编辑：**

在一些帮助下，我自己找到了答案：

```
SELECT * FROM TABLE WHERE TIMESTAMPFIELD > (CURRENT_TIMESTAMP - CAST(? as DECIMAL(18,9)) 
```

如果参数以浮点值形式给出，则有效。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T20:56:05.730

你到底想做什么？也许我可以对更多细节更有帮助。

> SELECT * FROM TABLE WHERE TIMESTAMPFIELD > (CURRENT_TIMESTAMP - ?)

您如何在代码中设置参数？您使用哪种语言？

如果你使用 Delphi，那么你的参数应该作为 Float 传递。IE：

```
MyQuery.ParamByName('delta').asFloat := 0.1; 
```

试试这个并告诉我们它是否有效

高温高压

# ruby-on-rails - 嵌套还是不嵌套？

> ID：164520
> 
> 赞同：11
> 
> 时间：2008-10-02T20:48:36.200
> 
> 标签：ruby-on-rails, ruby, nested

**前提：** 通常在准备一个新的 Ruby on Rails 应用程序时，我会绘制有关用户导航的模型和关系。通常我会遇到一个我需要问自己的地方，我是否应该超越通常的“经验法则”，即嵌套不超过 1 级。有时我觉得需要嵌套，而不是创建另一个命名空间路由和重复工作。
这是一个例子：

**模型：**用户、公司、地点
用户拥有并属于许多公司（多对多）
用户拥有并属于许多地点（多对多）
公司拥有并属于许多地点（多对多）

**Routes:**
***1 级嵌套***
users/:user_id/companies/ - 列出与用户相关的所有公司
users/:user_id/locations/ - 列出与用户相关的所有位置
***1 级嵌套***
users/:user_id/companies/:company_id/位置/ - 列出用户的所有公司位置

**所以，我的问题是在 RoR 中嵌套超过 1 层是否合适？是还是不是？为什么？**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-02T22:11:16.733

我倾向于遵循 Jamis Buck 的[建议](http://weblog.jamisbuck.org/2007/2/5/nesting-resources)，并且永远不会嵌套超过一层。

编辑：如果您要嵌套超过 1 层，我会查看Edge中新的[浅层路线功能](http://ryandaigle.com/articles/2008/9/7/what-s-new-in-edge-rails-shallow-routes)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T22:19:44.530

```
users/:user_id/companies/:company_id/locations/ 
```

虽然从技术上讲这很好，但命名的路由助手不会因此

```
user_company_location_path( user_id, company_id, location_id ) 
```

不得不像这样推车第 3 轮参数很烦人。任何烦人的事情都可能是一个危险信号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T03:05:44.313

虽然理论上听起来不错，但我发现嵌套多个级别可能会开始变得混乱 - 特别是如果您在不同级别有相同的命名控制器（这可能很常见）

例如

```
 user/x/blog/y/profile/z, and
  user/x/profile/a 
```

我经常会发现我在与我认为我正在工作的不同的命名空间中工作。如果他们做类似但不同的事情，它会变得相当混乱 =)

我当前的应用程序，我上周通过并删除了大部分嵌套路由。（当然，YMMV）

# .net - 在 .NET 中将成员对象公开为属性或方法

> ID：164527
> 
> 赞同：15
> 
> 时间：2008-10-02T20:49:38.320
> 
> 标签：.net, class, properties, methodology

在 .NET 中，如果一个类包含一个作为类对象的成员，该成员应该作为属性公开还是与方法一起公开？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-02T20:53:34.473

您应该为任何概念上表示对象状态的东西使用属性，只要它的检索不是一个足够昂贵的操作，您应该避免重复使用它。

来自[MSDN](http://msdn.microsoft.com/en-us/library/bzwdh01d.aspx#cpconpropertyusageguidelinesanchor1)：

> 类库设计者通常必须决定将类成员实现为属性还是方法。一般来说，方法代表动作，属性代表数据。使用以下指南可帮助您在这些选项之间进行选择。
> 
> *   当成员是逻辑数据成员时使用属性。在以下成员声明中，Name 是一个属性，因为它是类的逻辑成员。
>     
>     
>     
>     ```
>     public string Name
>     get 
>     {
>         return name;
>     }
>     set 
>     {
>         name = value;
>     } 
>     ```
>     
>     
> *   在以下情况下使用方法：
>     
>     
>     *   该操作是一种转换，例如 Object.ToString。
>     *   该操作非常昂贵，以至于您希望与用户交流他们应该考虑缓存结果。
>     *   使用 get 访问器获取属性值会产生可观察到的副作用。
>     *   连续调用该成员两次会产生不同的结果。
>     *   执行顺序很重要。请注意，类型的属性应该能够以任何顺序设置和检索。
>     *   该成员是静态的，但返回一个可以更改的值。
>     *   该成员返回一个数组。返回数组的属性可能非常具有误导性。通常需要返回内部数组的副本，以便用户无法更改内部状态。再加上用户可以很容易地假设它是索引属性这一事实，导致代码效率低下。在下面的代码示例中，每次调用 Methods 属性都会创建一个数组副本。结果，将在以下循环中创建数组的 2n+1 个副本。
>         
>         
>         
>         ```
>         Type type = // Get a type.
>         for (int i = 0; i < type.Methods.Length; i++)
>         {
>            if (type.Methods[i].Name.Equals ("text"))
>            {
>               // Perform some operation.
>            }
>         } 
>         ```
>         
>         
> 
> 以下示例说明了属性和方法的正确使用。
> 
> ```
>  class Connection
>     {
>        // The following three members should be properties
>        // because they can be set in any order.
>        string DNSName {get{};set{};}
>        string UserName {get{};set{};}
>        string Password {get{};set{};}
> 
>        // The following member should be a method
>        // because the order of execution is important.
>        // This method cannot be executed until after the 
>        // properties have been set.
>        bool Execute ();
>     } 
> ```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-02T20:52:59.387

如果您所做的只是公开与当前对象的状态相关的对象实例，则应该使用属性。

当您有一些逻辑不仅仅是访问内存中的对象并返回该值，或者您正在执行对当前对象的状态有广泛影响的操作时，应该使用方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T20:52:55.270

这与此事无关。

如果值是关于对象状态的一些细节，它应该是一个属性。

如果它对对象执行某些操作，它应该是 Method。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T20:51:53.960

财产。属性基本上只是一种“便宜”的方法。获取或设置对对象的引用非常便宜。

澄清一下，属性通常应该代表对象的内部状态。但是，将成员实现为属性或方法会告诉用户调用的成本可能有多高。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T20:51:54.617

属性读取类中的实例并为其赋值。

方法对分配给类的数据做一些事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-02T21:11:03.853

**概述**

通常，属性存储对象的数据，例如*Name*，方法是可以要求对象执行的操作，例如*Move*或*Show*。有时不清楚哪些类成员应该是属性，哪些应该是方法 - 集合类 (VB) 的*Item*方法存储和检索数据，并且可以作为索引属性实现。另一方面，将*Item*实现为方法也是合理的。

**句法**

类成员的使用方式也可能是决定它应该表示为属性还是方法的因素。从参数化属性中检索信息的语法几乎与作为函数实现的方法所使用的语法相同。但是，修改此类值的语法略有不同。

如果将类的成员实现为属性，则必须以这种方式修改它的值：

*ThisObject.ThisProperty(Index) = NewValue*

如果类成员被实现为方法，则必须使用参数来修改被修改的值：

*ThisObject.ThisProperty（索引，新值）*

**错误**

尝试将值分配给只读属性将返回与对方法的类似调用不同的错误消息。正确实现的类成员返回更容易解释的错误消息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-26T18:21:00.743

I confused about the using property and method before. But now I am using this rule according to [MSDN Guideline](https://msdn.microsoft.com/en-us/library/vstudio/ms229054%28v=vs.100%29.aspx):

methods represent actions and properties represent data. Properties are meant to be used like fields, meaning that properties should not be computationally complex or produce side effects. When it does not violate the following guidelines, consider using a property, rather than a method, because less experienced developers find properties easier to use.

# java - fmt:parseDate - 无法建立解析索引语言环境

> ID：164559
> 
> 赞同：2
> 
> 时间：2008-10-02T20:55:41.237
> 
> 标签：java, jsp, jstl

有谁知道这个错误的根本原因？我将已知的良好数据提供给 fmt:parseDate 标记（它的数据库驱动数据由我们控制），但是这个错误随机弹出。我似乎无法找到一种方法来复制导致此异常的原因。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T10:22:11.253

网站的开放程度 - 在某些情况下，区域设置来自用户首选项 Accept--Language 标头 - 用户可能发送了错误的值，可能来自 Chrome 浏览器 :)。这是一个类似的[例子](http://mail-archives.apache.org/mod_mbox/jakarta-taglibs-user/200410.mbox/%3C200410141245.55548.f.tordini@kataweb.it%3E)

# nhibernate - 您如何使用 NHibernate 将枚举映射到数据库和从数据库映射枚举？

> ID：164564
> 
> 赞同：1
> 
> 时间：2008-10-02T20:57:01.467
> 
> 标签：nhibernate, enumeration

编辑：瑞恩提出了一个很好的观点。我特别希望能够相互映射，同时仍将人类可读的值存储在数据库中。也就是说，我不希望我的数据库中有一堆枚举整数。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T21:08:29.037

根据[文档](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/mapping.html#mapping-declaration-property)，您可以将映射文件中属性的类型属性留空，也可以定义它并指定枚举的类名。

另一种方法是将枚举转换为 int 并将 int 用作映射类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T21:04:14.057

您必须实现自定义 IUserType。看到[这个帖子](http://davidgardiner.blogspot.com/2007/11/using-enum-types-with-nhibernate.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-18T00:40:24.577

我认为您可以将类型设置为字符串：

```
<property name="EnumProperty" Type="string" Length="50" NotNull="true" /> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T20:59:05.877

我从来没有使用过 NHibernate，但你不能将 SQL 数据类型设置为 int 吗？

# morphing - 关键点变形

> ID：164574
> 
> 赞同：3
> 
> 时间：2008-10-02T20:58:23.710
> 
> 标签：morphing

是否有一个库/软件可以接受图像之间的多个关键点和它们的匹配并产生变形？或者关于如何做到这一点的任何想法/算法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-12T16:37:36.663

[Xmorph 和 GTK morph](http://xmorph.sourceforge.net/)可以做到这一点——尽管关键点必须是等效矩形网格的一部分。可以通过 C API 访问底层算法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T22:09:09.133

[Gryphon Software](http://en.wikipedia.org/wiki/Gryphon_Software_Morph)的一款较旧的软件可以进行图像变形。我从 1994 年看到了一篇关于它的文章。我找不到公司网站，所以他们现在可能正在放弃 ware。

她引用了 Wikipedia 上一篇关于[名为 Dissolve 的电影编辑技术](http://en.wikipedia.org/wiki/Dissolve_(film))的文章。

> 在非线性视频编辑中，溶解是在软件中完成的，通过在图像的每个像素的 RGB 值之间逐渐进行插值。

希望有帮助。

# xml - C++ 中的 MSXML - 漂亮的打印/缩进新创建的文档

> ID：164575
> 
> 赞同：8
> 
> 时间：2008-10-02T20:58:24.257
> 
> 标签：xml, msxml, pretty-print

我正在使用 MSXML 解析器写出 XML 文件，并带有我从这里下载的包装器：http: [//www.codeproject.com/KB/XML/JW_CXml.aspx](http://www.codeproject.com/KB/XML/JW_CXml.aspx)。效果很好，除了当我从代码创建一个新文档（所以不从文件加载和修改）时，结果都在一个大行中。我希望元素能够很好地缩进，以便我可以在文本编辑器中轻松阅读。

谷歌搜索显示许多人有相同的问题 - 大约在 2001 年左右被问到。回复通常会说“应用 XSL 转换”或“添加您自己的空白节点”。尤其是最后一个让我去 %( 所以我希望在 2008 年有一种更简单的方法来漂亮的 MSXML 输出。所以我的问题；有吗，我该如何使用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T21:45:03.473

这是已接受答案的修改版本，它将在内存中进行转换（仅在最后几行更改，但为了方便未来的读者，我发布了整个块）：

```
bool CXml::FormatDOMDocument(IXMLDOMDocument *pDoc)
{
    // Create the writer
    CComPtr <IMXWriter> pMXWriter;
    if (FAILED (pMXWriter.CoCreateInstance(__uuidof (MXXMLWriter), NULL, CLSCTX_ALL))) {
        return false;
    }
    CComPtr <ISAXContentHandler> pISAXContentHandler;
    if (FAILED (pMXWriter.QueryInterface(&pISAXContentHandler))) {
        return false;
    }
    CComPtr <ISAXErrorHandler> pISAXErrorHandler;
    if (FAILED (pMXWriter.QueryInterface (&pISAXErrorHandler))) {
        return false;
    }
    CComPtr <ISAXDTDHandler> pISAXDTDHandler;
    if (FAILED (pMXWriter.QueryInterface (&pISAXDTDHandler))) {
        return false;
    }

    if (FAILED (pMXWriter->put_omitXMLDeclaration (VARIANT_FALSE)) ||
        FAILED (pMXWriter->put_standalone (VARIANT_TRUE)) ||
        FAILED (pMXWriter->put_indent (VARIANT_TRUE)) ||
        FAILED (pMXWriter->put_encoding (L"UTF-8")))
    {
        return false;
    }

    // Create the SAX reader
    CComPtr <ISAXXMLReader> pSAXReader;
    if (FAILED(pSAXReader.CoCreateInstance(__uuidof (SAXXMLReader), NULL, CLSCTX_ALL))) {
        return false;
    }

    if (FAILED(pSAXReader->putContentHandler (pISAXContentHandler)) ||
        FAILED(pSAXReader->putDTDHandler (pISAXDTDHandler)) ||
        FAILED(pSAXReader->putErrorHandler (pISAXErrorHandler)) ||
        FAILED(pSAXReader->putProperty (L"http://xml.org/sax/properties/lexical-handler", CComVariant (pMXWriter))) ||
        FAILED(pSAXReader->putProperty (L"http://xml.org/sax/properties/declaration-handler", CComVariant (pMXWriter))))
    {
        return false;
    }

    // Perform the write
    bool success1 = SUCCEEDED(pMXWriter->put_output(CComVariant(pDoc.GetInterfacePtr())));
    bool success2 = SUCCEEDED(pSAXReader->parse(CComVariant(pDoc.GetInterfacePtr())));

    return success1 && success2;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-05-02T12:28:59.833

即使我的 2 美分在 7 年后到货，我认为这个问题仍然值得一个简单的答案，只需几行代码，这可以通过使用 Visual C++ 的`#import`指令和本机 C++ COM 支持库（提供智能指针和封装错误处理）来实现.

请注意，就像接受的答案一样，它不会尝试适应`CXml`OP 正在使用的类，而是显示核心思想。我也假设`msxml6`.

**漂亮地打印到任何流**

```
void PrettyWriteXmlDocument(MSXML2::IXMLDOMDocument* xmlDoc, IStream* stream)
{
    MSXML2::IMXWriterPtr writer(__uuidof(MSXML2::MXXMLWriter60));
    writer->encoding = L"utf-8";
    writer->indent = _variant_t(true);
    writer->standalone = _variant_t(true);
    writer->output = stream;

    MSXML2::ISAXXMLReaderPtr saxReader(__uuidof(MSXML2::SAXXMLReader60));
    saxReader->putContentHandler(MSXML2::ISAXContentHandlerPtr(writer));
    saxReader->putProperty(PUSHORT(L"http://xml.org/sax/properties/lexical-handler"), writer.GetInterfacePtr());
    saxReader->parse(xmlDoc);
} 
```

**文件流**

如果您需要将流写入文件，则需要`IStream`接口的实现。
[wtlext](https://gitlab.com/FireDaemon/open-source/wtlext/blob/master/include/wtlext/filestream.h)有一个类，您可以使用它或从中推断如何编写自己的。

另一个对我来说效果很好的简单解决方案是利用 Ado Stream 类：

```
void PrettySaveXmlDocument(MSXML2::IXMLDOMDocument* xmlDoc, const wchar_t* filePath)
{
    ADODB::_StreamPtr stream(__uuidof(ADODB::Stream));
    stream->Type = ADODB::adTypeBinary;
    stream->Open(vtMissing, ADODB::adModeUnknown, ADODB::adOpenStreamUnspecified, _bstr_t(), _bstr_t());
    PrettyWriteXmlDocument(xmlDoc, IStreamPtr(stream));
    stream->SaveToFile(filePath, ADODB::adSaveCreateOverWrite);
} 
```

**把它粘在一起**

一个简单的`main`函数显示了这一点：

```
#include <stdlib.h>
#include <objbase.h>
#include <comutil.h>
#include <comdef.h>
#include <comdefsp.h>
#import <msxml6.dll>
#import <msado60.tlb> rename("EOF", "EndOfFile")  // requires: /I $(CommonProgramFiles)\System\ado

void PrettyWriteXmlDocument(MSXML2::IXMLDOMDocument* xmlDoc, IStream* stream);
void PrettySaveXmlDocument(MSXML2::IXMLDOMDocument* xmlDoc, const wchar_t* filePath);

int wmain()
{
    CoInitializeEx(nullptr, COINIT_MULTITHREADED);

    try
    {
        MSXML2::IXMLDOMDocumentPtr xmlDoc(__uuidof(MSXML2::DOMDocument60));
        xmlDoc->appendChild(xmlDoc->createElement(L"root"));

        PrettySaveXmlDocument(xmlDoc, L"xmldoc.xml");
    }
    catch (const _com_error&)
    {
    }

    CoUninitialize();

    return EXIT_SUCCESS;
}

// assume definitions of PrettyWriteXmlDocument and PrettySaveXmlDocument go here 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T21:18:59.200

试试这个，这是我几年前在网上找到的。

```
#include <msxml2.h>

bool FormatDOMDocument (IXMLDOMDocument *pDoc, IStream *pStream)
{

    // Create the writer

    CComPtr <IMXWriter> pMXWriter;
    if (FAILED (pMXWriter.CoCreateInstance(__uuidof (MXXMLWriter), NULL, CLSCTX_ALL)))
    {
        return false;
    }
    CComPtr <ISAXContentHandler> pISAXContentHandler;
    if (FAILED (pMXWriter.QueryInterface(&pISAXContentHandler)))
    {
        return false;
    }
    CComPtr <ISAXErrorHandler> pISAXErrorHandler;
    if (FAILED (pMXWriter.QueryInterface (&pISAXErrorHandler)))
    {
        return false;
    }
    CComPtr <ISAXDTDHandler> pISAXDTDHandler;
    if (FAILED (pMXWriter.QueryInterface (&pISAXDTDHandler)))
    {
        return false;
    }

    if (FAILED (pMXWriter ->put_omitXMLDeclaration (VARIANT_FALSE)) ||
        FAILED (pMXWriter ->put_standalone (VARIANT_TRUE)) ||
        FAILED (pMXWriter ->put_indent (VARIANT_TRUE)) ||
        FAILED (pMXWriter ->put_encoding (L"UTF-8")))
    {
        return false;
    }

    // Create the SAX reader

    CComPtr <ISAXXMLReader> pSAXReader;
    if (FAILED (pSAXReader.CoCreateInstance (__uuidof (SAXXMLReader), NULL, CLSCTX_ALL)))
    {
        return false;
    }

    if (FAILED (pSAXReader ->putContentHandler (pISAXContentHandler)) ||
        FAILED (pSAXReader ->putDTDHandler (pISAXDTDHandler)) ||
        FAILED (pSAXReader ->putErrorHandler (pISAXErrorHandler)) ||
        FAILED (pSAXReader ->putProperty (
        L"http://xml.org/sax/properties/lexical-handler", CComVariant (pMXWriter))) ||
        FAILED (pSAXReader ->putProperty (
        L"http://xml.org/sax/properties/declaration-handler", CComVariant (pMXWriter))))
    {
        return false;
    }

    // Perform the write

    return 
       SUCCEEDED (pMXWriter ->put_output (CComVariant (pStream))) &&
       SUCCEEDED (pSAXReader ->parse (CComVariant (pDoc)));
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T21:06:50.103

除非库有格式选项，否则唯一的另一种方法是使用 XSLT，或外部漂亮的打印机（我认为 htmltidy 也可以做 xml）codeproject 库中似乎没有选项，但您可以指定 XSLT样式表到 MSXML。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T21:46:14.283

我已经为基本的 xml 缩进编写了一个 sed 脚本。如果一切都失败了，您可以将其用作外部缩进器（将其保存到 xmlindent.sed，并使用*sed -f xmlindent.sed <filename>*处理您的 xml ）。您可能需要 cygwin 或其他一些 posix 环境才能使用它。

这是来源：

```
:a
/>/!N;s/\n/ /;ta
s/  / /g;s/^ *//;s/  */ /g
/^<!--/{
:e
/-->/!N;s/\n//;te
s/-->/\n/;D;
}
/^<[?!][^>]*>/{
H;x;s/\n//;s/>.*$/>/;p;bb
}
/^<\/[^>]*>/{
H;x;s/\n//;s/>.*$/>/;s/^    //;p;bb
}
/^<[^>]*\/>/{
H;x;s/\n//;s/>.*$/>/;p;bb
}
/^<[^>]*[^\/]>/{
H;x;s/\n//;s/>.*$/>/;p;s/^/ /;bb
}
/</!ba
{
H;x;s/\n//;s/ *<.*$//;p;s/[^    ].*$//;x;s/^[^<]*//;ba
}
:b
{
s/[^    ].*$//;x;s/^<[^>]*>//;ba
} 
```

Hrmp，标签似乎乱码......您可以从这里复制浪费：[XML indenting with sed(1)](http://mitchnull.blogspot.com/2008/09/xml-indenting-with-sed1.html)

# c# - 序列化对象时省略 XML 处理指令

> ID：164585
> 
> 赞同：10
> 
> 时间：2008-10-02T21:01:02.160
> 
> 标签：c#, .net, xml-serialization, visual-studio-2003

我在 C# VS2003 / .Net 1.1 应用程序中序列化一个对象。但是，我需要在没有处理指令的情况下对其进行序列化。XmlSerializer 类输出如下内容：

```
<?xml version="1.0" encoding="utf-16" ?> 
<MyObject>
    <Property1>Data</Property1>
    <Property2>More Data</Property2>
</MyObject> 
```

有没有办法得到类似下面的东西，而不处理结果文本来删除标签？

```
<MyObject>
    <Property1>Data</Property1>
    <Property2>More Data</Property2>
</MyObject> 
```

对于那些好奇的人，我的代码看起来像这样......

```
XmlSerializer serializer = new XmlSerializer(typeof(MyObject));
StringBuilder builder = new StringBuilder();

using ( TextWriter stringWriter = new StringWriter(builder) )
{
    serializer.Serialize(stringWriter, comments);
    return builder.ToString();
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T20:47:05.900

我做了一个小修正

```
XmlSerializer serializer = new XmlSerializer(typeof(MyObject));
StringBuilder builder = new StringBuilder();
XmlWriterSettings settings = new XmlWriterSettings();
settings.OmitXmlDeclaration = true;
using ( XmlWriter stringWriter = XmlWriter.Create(builder, settings) )
{   
   serializer.Serialize(stringWriter, comments);  
  return builder.ToString();
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-02T21:03:52.387

在 2.0 中，您将使用[XmLWriterSettings.OmitXmlDeclaration](http://msdn.microsoft.com/en-us/library/system.xml.xmlwritersettings.omitxmldeclaration.aspx)并序列化为 XmlWriter - 但是我认为这在 1.1 中不存在；所以并不*完全*有用 - 但只是一件“考虑升级”的事情......是的，我意识到这并不总是可能的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T21:06:02.600

以下链接将带您到一个帖子，其中有人有一种方法可以通过使用 XmlWriter 并进入“元素”状态而不是“开始”状态来抑制处理指令。这导致处理指令不被写入。

[抑制处理指令](http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.framework.webservices/2004-03/0315.html)

> 如果您将 XmlWriter 传递给序列化程序，它只会在 XmlWriter 的状态为“开始”时发出处理指令（即，尚未向其写入任何内容）。

```
// Assume we have a type named 'MyType' and a variable of this type named 
'myObject' 
System.Text.StringBuilder output = new System.Text.StringBuilder(); 
System.IO.StringWriter internalWriter = new System.IO.StringWriter(output); 
System.Xml.XmlWriter writer = new System.Xml.XmlTextWriter(internalWriter); 
System.Xml.Serialization.XmlSerializer serializer = new 
System.Xml.Serialization.XmlSerializer(typeof(MyType)); 

writer.WriteStartElement("MyContainingElement"); 
serializer.Serialize(writer, myObject); 
writer.WriteEndElement(); 
```

> 在这种情况下，写入器将处于“元素”状态（在元素内部），因此不会写入任何处理指令。一旦您完成了 XML 的编写，您就可以从底层流中提取文本并将其处理成您想要的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T11:48:30.883

省略命名空间怎么样？

而不是使用

```
XmlSerializerNamespaces namespaces = new XmlSerializerNamespaces();
                namespaces.Add("", ""); 
```

前任：

```
<message xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T21:05:01.527

如果“处理指令”是指 xml 声明，则可以通过设置 XmlWriterSettings 的 OmitXmlDeclaration 属性来避免这种情况。您需要使用 XmlWriter 进行序列化，以完成此操作。

```
XmlSerializer serializer = new XmlSerializer(typeof(MyObject));
StringBuilder builder = new StringBuilder();
XmlWriterSettings settings = new XmlWriterSettings();
settings.OmitXmlDeclaration = true;

using ( XmlWriter stringWriter = new StringWriter(builder, settings) )
{
    serializer.Serialize(stringWriter, comments);
    return builder.ToString();
} 
```

但是啊，这并不能回答你对 1.1 的问题。好吧，供其他人参考。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T10:51:17.617

这适用于 .NET 1.1。（但你还是应该考虑升级）

```
 XmlSerializer s1= new XmlSerializer(typeof(MyClass)); 
    XmlSerializerNamespaces ns = new XmlSerializerNamespaces();
    ns.Add( "", "" );

    MyClass c= new MyClass();
    c.PropertyFromDerivedClass= "Hallo";

    sw = new System.IO.StringWriter();
    s1.Serialize(new XTWND(sw), c, ns);
    ....

   /// XmlTextWriterFormattedNoDeclaration
   /// helper class : eliminates the XML Documentation at the
   /// start of a XML doc. 
   /// XTWFND = XmlTextWriterFormattedNoDeclaration
   public class XTWFND : System.Xml.XmlTextWriter
   {
     public XTWFND(System.IO.TextWriter w) : base(w) { Formatting = System.Xml.Formatting.Indented; }
     public override void WriteStartDocument() { }
   } 
```

# sql-server - 如何安装“SQL Server”ODBC 驱动程序？

> ID：164593
> 
> 赞同：5
> 
> 时间：2008-10-02T21:02:29.897
> 
> 标签：sql-server, installation

我有“SQL Native Client”，但没有“SQL Server”ODBC 驱动程序。我的机器上安装了 SQL 2005。

尝试通过安装 SQL Server 客户端工具来修复。

任何想法，将不胜感激。

我正在运行 Windows XP Pro。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T21:37:09.280

找到这个[微软下载](http://www.microsoft.com/Downloads/details.aspx?familyid=6C050FE3-C795-4B7D-B037-185D0506396C&displaylang=en)。它说它提供了 SQL Server ODBC 驱动程序。

编辑：这是 SP1 下载：[Service Pack 1](http://www.microsoft.com/Downloads/details.aspx?familyid=78CAC895-EFC2-4F8E-A9E0-3A1AFBD5922E&displaylang=en)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T21:56:52.637

我找到了[一篇](http://www.macropool.com/en/download/mdac_xp_sp2.html)关于修复 MDAC 的文章。

这是简短的
1\. 在 Windows 资源管理器中，打开 c:\Windows\Inf 文件夹。
注意 如果您看不到 c:\Windows\Inf 文件夹，请执行以下步骤
：在桌面上，双击我的电脑，然后在工具菜单上，单击文件夹选项。
湾。单击查看选项卡。
C。在高级设置下，选中显示隐藏文件和文件夹复选框。
d。清除隐藏已知文件类型的扩展名复选框。
e. 单击确定。
2\. 在 C:\Windows\Inf 文件夹中，右键单击 Mdac.inf 文件，然后单击安装。

...

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-05-06T20:36:21.007

您还可以尝试适用于 SQL Server 的 OpenLink ODBC 驱动程序。这些支持旧版本和新版本的 SQL Server（从 4.2 到最新版本）。

见：[http ://uda.openlinksw.com/](http://uda.openlinksw.com/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2014-01-10T11:37:19.597

Easysoft SQL Server ODBC 驱动程序支持新旧版本的 SQLServer [http://www.easysoft.com/products/data_access/odbc-sql-server-driver/index.html](http://www.easysoft.com/products/data_access/odbc-sql-server-driver/index.html)

# c# - 调用存储过程

> ID：164594
> 
> 赞同：1
> 
> 时间：2008-10-02T21:02:51.750
> 
> 标签：c#, .net, sql, stored-procedures

我有 ac# 应用程序，它仅通过存储过程与数据库交互。我尝试了各种技术来调用存储过程。根是 SqlCommand 类，但是我想实现几件事：

*   让c#和sql的接口更流畅，让过程调用看起来更像c#函数调用
*   有一种简单的方法来确定是否在代码中的任何位置调用了给定的存储过程。
*   使过程调用的创建快速而简单。

我探索了各种途径。一方面，我有一个项目，它的命名空间结构反映了存储过程的名称结构，这样我就可以从类的名称中生成存储过程的名称，并且我可以判断给定的存储过程是否正在使用中通过在命名空间树中对其进行微调。还有哪些其他体验？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T21:04:03.153

您应该尝试[LINQ to SQL](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T21:10:10.937

当存储过程是数据库的接口时，我倾向于将它们包装在反映问题域的类中，以便大多数应用程序代码使用这些对象而不调用存储过程，甚至不知道存储过程或数据库连接。应用程序对象通常在它们之间运行。

我认为在您的应用程序中镜像 SP 是一个错误，因为通常情况下，您的关系模型与您的应用程序域对象模型不是 1-1 的。

例如，通常我没有代表链接表或其他数据库设计和规范化工件的应用程序对象。这些是包含在其他对象中或由其他对象返回的对象的集合。

很多都是由阻抗不匹配造成的，但我认为这是课程的马匹——让数据库做他们擅长的事情，而 OO 模型做他们擅长的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T21:12:34.300

您是否考虑过使用[MS 的企业库](http://www.codeplex.com/entlib)？它允许您轻松调用存储过程。我通常为每个数据库设置一个类，该类仅用于调用这些存储的过程。然后你可以有类似的东西（对不起，它是 vb.net 而不是 c#）：

```
Public Shared Function GetOrg(ByVal OrgID As Integer) As System.Data.DataSet
    Return db.ExecuteDataSet("dbo.cp_GetOrg", OrgID)
End Function 
```

其中 db 定义为：

```
Dim db As Microsoft.Practices.EnterpriseLibrary.Data.Database = DatabaseFactory.CreateDatabase() 
```

然后，您将拥有一个用于调用存储过程的函数。然后，您可以在代码中搜索这一功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T21:45:33.863

在构建我当前的产品时，我非常想实现的工具之一是一个数据库类（比如 DatabaseFactory——只是我不关心那个），它可以简化我的开发并消除一些“陷阱”。在该类中，我希望能够使用如下函数到存储过程的映射将存储过程调用为真正的 C# 函数：

公共 int Call_MySproc(int paramOne, bool paramTwo, ref int outputParam)

{

...参数处理和 sproc 调用在这里

}

但是，尝试执行此操作时面临的最大问题在于创建实现 sproc 调用的 C# 函数所需的工作。幸运的是，很容易在 T-SQL 中创建代码生成器来执行此操作。我从最初由 Paul McKenzie 创建的一个开始，然后以各种方式对其进行修改以生成我想要的 C# 代码。

您可以谷歌 Paul McKenzie 并查找他的原始代码生成器，或者，如果您想在 mark-at-BSDIWeb.com 上给我写信，我将捆绑我的 SQL 类库的源代码和相关的 sproc 代码生成器并将其放置在我们的网站上。如果我收到一两个请求，我会发布它，然后回来编辑此响应以将其他人也指向源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T21:24:22.417

你想要的最简单的解决方案[我并不是说它比其他解决方案更好或更差]是创建一个数据集并将存储过程从服务器资源管理器拖到数据集设计器表面。这将在适配器中创建可以调用和检查引用的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T21:56:41.387

尽管它们不是很流行，但我们使用[类型化数据集](http://www.asp.net/Learn/data-access/tutorial-68-cs.aspx)作为所有存储过程的前端。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T01:20:35.017

Microsoft 的新实体框架可满足您的要求。EF 通常用于为数据库对象创建代理类，但很多人没有意识到的一件事是它还为存储过程创建了代理方法（当然是自动生成的）。这使您可以像使用常规方法调用一样使用您的 SP。

看看这个！

# linux - 如何在 Linux 中设置权限，以便两个用户可以更新服务器上的同一个 SVN 工作副本？

> ID：164597
> 
> 赞同：4
> 
> 时间：2008-10-02T21:03:20.347
> 
> 标签：linux, svn, permissions

我的服务器同时安装了 Subversion 和 Apache，Apache Web 目录也是一个 Subversion 工作副本。这样做的原因是简单的命令`svn update /server/staging`会将最新的源代码部署到登台服务器。

Apache 公共网络目录：`/server/staging` *——（这是一个 SVN 工作副本。）*

我的服务器上有两个用户，“richard”和“austin”。他们都是“开发者”组的成员。我使用“sudo chown -R richard:developers /server”递归地将 /server 目录的权限设置为 richard:developers。

然后，我为“richard”和“developers”组设置了读取、写入和执行的权限。

那么可以肯定的是，'austin' 现在应该可以使用该`svn update /server/staging`命令了？然而，当他尝试时，他得到了错误：

```
svn: Can't open file '/server/staging/.svn/lock': Permission denied 
```

如果我递归地将 /server 的所有者更改为 austin:developers，他可以很好地运行命令，但是“richard”不能。

我该如何解决这个问题？我想创建一个提交后挂钩，以便在提交文件时自动部署登台站点，但我看不到一种适用于两个用户的方法。钩子是：

```
/usr/bin/svn update /server/staging 
```

对他们两个使用相同的用户帐户实际上并不是一个可接受的解决方案，而且我不知道有任何方法可以在挂钩内以“root”身份运行命令。

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-02T21:21:31.643

目录集组 ID

如果设置了目录条目上的 setgid 位，则该目录中的文件将拥有组所有权作为目录，而不是创建文件的用户的组。

当多个用户需要访问某些文件时，此属性很有用。如果用户在设置了 setgid 属性的目录中工作，则任何用户在该目录中创建的任何文件都将具有该组的权限。例如，管理员可以创建一个名为 spcprj 的组并将用户 Kathy 和 Mark 添加到组 spcprj。目录 spcprjdir 可以通过设置 GID 位来创建，并且 Kathy 和 Mark 虽然在不同的主要组中可以在目录中工作并且可以完全访问该目录中的所有文件，但仍然无法访问彼此的主要组中的文件.

以下命令将在目录上设置 GID 位：

```
chmod g+s spcprjdir 
```

目录“spcprjdir”的目录列表：

```
drwxrwsr-x 2 kathy spcprj 1674 Sep 17 1999 spcprjdir 
```

组权限中执行位的“s”会导致写入目录“spcprjdir”的所有文件属于组“spcprj”。

编辑：source = [Linux 文件和文件权限](http://www.comptechdoc.org/os/linux/usersguide/linux_ugfilesp.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T21:14:46.730

`svnserve`我将使用该`svn://`协议设置一个简单的 Subversion 服务器。您可以进行设置，使其在自己的用户帐户下运行，然后存储库将只能由该用户访问。然后，此用户可以具有正确的权限以`svn update /server/staging`在 post-commit 挂钩上运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T21:17:06.957

在您的 svn 存储库中，您可以找到一个设置权限的“conf”目录。你有3个文件：

*   授权
*   密码
*   svnserve.conf

您在 authz 文件中设置每个用户或每个组的用户拥有哪种访问权限。你在那里设置组，SVN 组不是 linux 用户组（虚线是注释）：

```
[groups]
# harry_and_sally = harry,sally
projectgroup = richard,austin

# [/foo/bar]
# harry = rw  -- user harry has read/write access
# * =  -- everybody have no access

# [repository:/baz/fuz]
# @harry_and_sally = rw  -- harry_and_sally group members have read/write access
# * = r  -- everyone has read access

[/server/staging]
@projectgroup = rw
* = r 
```

解决此示例并设置您的配置。在“passwd”文件中设置用户密码。执行

```
cat passwd 
```

你会得到注释文件，并解释如何设置它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T23:09:42.040

我使用 WebDAV - 所有 SVN 更新和提交都是通过 apache 处理的，我从来没有遇到过这样的问题。

# .net - 在 Visual Studio 中调试时如何查看我的应用程序线程？

> ID：164600
> 
> 赞同：17
> 
> 时间：2008-10-02T21:03:52.433
> 
> 标签：.net, visual-studio, visual-studio-2008, multithreading, debugging

我想在调试时查看我的应用程序中当前处于活动状态的线程。

如何使用 Visual Studio 执行此操作？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-02T21:05:58.593

是的，去 Debug->Windows->Threads

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-02T21:06:08.107

调试 | 窗户 | 线程

或者

`Ctrl`+ `Alt`+`H`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-02T21:10:05.680

虽然 RichS 的回答在技术上是正确的，但如果您有许多线程处于等待状态或睡眠状态，那么该窗口中显示的信息就没有那么有用了。

我建议您确保为线程命名，以便在“线程”窗口中获得更好的可见性。使用 Thread.Name 属性为您的线程分配一个有意义的名称。你会很高兴你做到了。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-02T21:08:30.503

如果您使用的是 VS 2008，请查看有关[VS 2008 多线程改进的](http://channel9.msdn.com/posts/DanielMoth/Multi-threading-Debugging-Enhancements-in-Visual-Studio-2008/)截屏视频。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-02T21:28:07.697

此外，在创建线程时给它们命名，这样更容易在 Visual Studio 的线程工具窗口中识别它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-27T17:30:35.563

我最近一直在使用 Allinea 的 DDTLite 插件 - 很好地融入了 VS2008 (SP1)，并提供了许多非常有用的窗口来管理多个线程（步进、断点等），甚至只是同时查看线程的位置（一种树状的堆栈视图，真的很酷）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-05-05T09:25:07.350

您可以通过 Visual Studio 或仅从任务管理器简单地跟踪线程。对于 VS- 调试应用程序后，只需从上方菜单选项导航到调试，然后转到窗口，然后转到线程。调试->Windows->线程。有时您可能无法从 VS 线程窗口获取信息，因此请从桌面转到任务管理器并导航到线程列。参考下图。 [干得好](https://i.stack.imgur.com/Oam1g.png)

# .net - 为什么尝试块很贵？

> ID：164613
> 
> 赞同：51
> 
> 时间：2008-10-02T21:08:09.727
> 
> 标签：.net, coding-style

我听过这样的建议，如果可能的话，你应该避免尝试 catch 块，因为它们很昂贵。

我的问题是关于 .NET 平台的：为什么 try 块很贵？

**回复摘要：**

在这个问题上显然有两个阵营：那些说尝试块很昂贵，而那些说“可能有点贵”。

那些说 try 块很昂贵的人通常会提到展开调用堆栈的“高成本”。就个人而言，我不相信这个论点 - 特别是在阅读了异常处理程序如何存储[在这里](http://www.yoda.arachsys.com/csharp/exceptions2.html)之后。

Jon Skeet 属于“也许有一点点”阵营，他写了两篇关于异常和性能的文章，您可以在[此处](http://www.yoda.arachsys.com/csharp/exceptions2.html)找到。

有一篇文章我觉得非常有趣：它谈到了 try 块的“其他”性能影响（不一定是内存或 cpu 消耗）。Peter Ritchie 提到他发现 try 块中的代码没有像编译器那样优化。[你可以在这里](http://msmvps.com/blogs/peterritchie/archive/2007/06/22/performance-implications-of-try-catch-finally.aspx)阅读他的发现。

最后，在 CLR 中实现异常的人有一篇关于该问题的博客文章。去看看 Chris Brumme 的[文章](http://blogs.msdn.com/cbrumme/archive/2003/10/01/51524.aspx)。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-02T21:12:47.797

昂贵的不是块本身，甚至没有*捕获*异常本身，这是昂贵的，它是运行时展开调用堆栈，直到找到可以处理异常的堆栈帧。抛出异常是相当轻量级的，但如果运行时必须遍历六个堆栈帧（即六个方法调用深度）才能找到合适的异常处理程序，可能会在执行过程中执行 finally 块，您可能会看到明显的时间流逝.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-02T21:18:09.763

您不应该避免 try/catch 块，因为这通常意味着您没有正确处理可能发生的异常。结构化异常处理 (SEH) 仅在异常实际发生时成本高昂，因为运行时必须遍历调用堆栈以查找 catch 处理程序，执行该处理程序（可能有多个），然后执行 finally 块，然后返回控制回到正确位置的代码。

异常并非旨在用于控制程序逻辑，而是用于指示错误情况。

> 关于异常的最大误解之一是它们是针对“异常情况”的。实际情况是它们用于传达错误条件。从框架设计的角度来看，没有所谓的“异常情况”。条件是否异常取决于使用的上下文， --- 但可重用库很少知道它们将如何使用。例如，OutOfMemoryException 对于简单的数据输入应用程序可能是异常的；对于执行自己的内存管理的应用程序（例如 SQL 服务器）来说，这并不是什么特别的事情。换句话说，一个人的特殊情况是另一个人的慢性病。 [[http://blogs.msdn.com/kcwalina/archive/2008/07/17/ExceptionalError.aspx]](http://blogs.msdn.com/kcwalina/archive/2008/07/17/ExceptionalError.aspx)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T15:36:55.680

一个 try 块一点也不贵。除非抛出异常，否则几乎不会产生任何成本。如果抛出异常，那是一种**特殊**情况，您不再关心性能。如果您的程序需要 0.001 秒或 1.0 秒才能结束，这有关系吗？不，不是的。重要的是报告给您的信息有多好，以便您可以修复它并阻止它再次发生。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-03T01:38:49.310

我认为人们真的高估了抛出异常的性能成本。是的，性能受到影响，但相对较小。

我运行了以下测试，抛出并捕获了一百万个异常。在我的 Intel [Core 2 Duo](http://en.wikipedia.org/wiki/Intel_Core_2_Duo#Core_2_Duo) 2.8 GHz 上花了大约 20 秒。每秒大约有 50K 异常。如果你只扔了一小部分，你就会遇到一些架构问题。

这是我的代码：

```
using System;
using System.Diagnostics;

namespace Test
{
    class Program
    {
        static void Main(string[] args)
        {
            Stopwatch sw = Stopwatch.StartNew();
            for (int i = 0; i < 1000000; i++)
            {
                try
                {
                    throw new Exception();
                }
                catch {}
            }
            Console.WriteLine(sw.ElapsedMilliseconds);
            Console.Read();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-04T11:29:42.180

当您将代码包装在 try/catch 块中时，编译器会发出更多 IL；看，对于以下程序：

```
using System;
public class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("abc");
    }
} 
```

编译器会发出这个 IL：

```
.method private hidebysig static void  Main(string[] args) cil managed
{
  .entrypoint
  // Code size       13 (0xd)
  .maxstack  8
  IL_0000:  nop
  IL_0001:  ldstr      "abc"
  IL_0006:  call       void [mscorlib]System.Console::WriteLine(string)
  IL_000b:  nop
  IL_000c:  ret
} // end of method Program::Main 
```

而对于稍作修改的版本：

```
using System;
public class Program
{
    static void Main(string[] args)
    {
        try { Console.WriteLine("abc"); }
        catch { }
    }
} 
```

发出更多：

```
.method private hidebysig static void  Main(string[] args) cil managed
{
  .entrypoint
  // Code size       23 (0x17)
  .maxstack  1
  IL_0000:  nop
  .try
  {
    IL_0001:  nop
    IL_0002:  ldstr      "abc"
    IL_0007:  call       void [mscorlib]System.Console::WriteLine(string)
    IL_000c:  nop
    IL_000d:  nop
    IL_000e:  leave.s    IL_0015
  }  // end .try
  catch [mscorlib]System.Object 
  {
    IL_0010:  pop
    IL_0011:  nop
    IL_0012:  nop
    IL_0013:  leave.s    IL_0015
  }  // end handler
  IL_0015:  nop
  IL_0016:  ret
} // end of method Program::Main 
```

所有这些 NOP 和其他成本。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-20T21:11:44.523

IMO 整个讨论就像是在说“哇 lops 很贵，因为我需要增加一个计数器……我不会再使用它们了”，或者“哇创建一个对象需要时间，我不会创建不再有成吨的物体了。”

底线是您添加代码，大概是有原因的。如果代码行没有产生一些开销，即使它有 1 个 CPU 周期，那它为什么会存在呢？没有什么是免费的。

与您添加到应用程序中的任何代码行一样，明智的做法是仅在需要它做某事时才将其放在那里。如果捕获异常是您需要做的事情，那么就这样做......就像如果您需要一个字符串来存储某些内容，请创建一个新字符串。同样，如果您声明一个从未使用过的变量，那么您就是在浪费内存和 CPU 周期来创建它，应该将其删除。与尝试/捕获相同。

换句话说，如果有代码可以做某事，那么假设做某事会以某种方式消耗 CPU 和/或内存。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T21:23:43.510

您需要担心的不是 try 块，而是*catch*块。然后，并不是您要避免编写这些块：而是您希望尽可能多地编写永远不会真正使用它们的代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T00:02:21.257

这不是我永远担心的事情。我宁愿关心尝试的清晰度和安全性……最后不要担心自己有多“昂贵”。

我个人不使用 286，也没有人使用[.NET](http://en.wikipedia.org/wiki/.NET_Framework)或 Java。继续前行。担心编写会影响您的用户和其他开发人员的好代码，而不是为 99.999999% 的使用它的人正常工作的底层框架。

这可能不是很有帮助，我并不是要严厉，而只是强调观点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T21:12:50.323

我怀疑它们是否特别昂贵。很多时候，它们是必要的/必需的。

尽管我强烈建议仅在必要时在正确的位置/嵌套级别使用它们，而不是在每次调用返回时重新抛出异常。

我想这个建议的主要原因是说你不应该在 if---else 是更好的方法的地方使用 try-catch。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T21:26:46.217

有点 O/T，但是...

有相当好的设计概念说你永远不应该要求异常处理。这意味着您应该能够在任何对象被抛出异常之前查询任何可能抛出异常的条件。

就像能够在“write()”之前说“writable()”，诸如此类。

这是一个不错的主意，如果使用它，它会使 Java 中的已检查异常看起来有点愚蠢——我的意思是，检查一个条件，然后就被迫仍然为相同的条件编写一个 try/catch？

这是一个非常好的模式，但是编译器可以强制执行检查异常，这些检查不能。此外，并非所有库都是使用这种设计模式创建的——当您考虑异常时，请牢记这一点。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T21:39:28.653

每次*尝试*都需要记录很多信息，例如堆栈指针、CPU 寄存器的值等，以便在抛出异常时可以展开堆栈并恢复通过*try块时的状态。*不仅每次*尝试*都需要记录很多信息，当抛出异常时，需要恢复很多值。所以*尝试*非常昂贵，而*投掷/接球*也非常昂贵。

这并不意味着您不应该使用异常，但是，在性能关键代码中，您可能不应该使用太多的尝试，也不应该过于频繁地抛出异常。

# c# - 在 Visual Studio 2005 中使用 Crystal Reports（C# .NET Windows 应用程序）

> ID：164621
> 
> 赞同：9
> 
> 时间：2008-10-02T21:09:26.213
> 
> 标签：c#, .net, database, visual-studio, crystal-reports

我需要在 C# .NET Windows 应用程序中创建报告。我有一个 SQL Server 2005 数据库、Visual Studio 2005，并且可以很好地创建存储过程和数据集。

有人可以指出我创建报告的正确方向吗？我只是似乎无法解决。一些示例将是一个好的开始，或者是一个简单的操作指南……任何比 MSDN 文档解释得更好的东西。

我正在使用 CrystalDecisions.Windows.Forms.CrystalReportViewer 控件来显示报告，我认为这是正确的。

如果我即将踏上漫长而复杂的旅程，创建和显示也可以打印的报告的最简单方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T19:39:06.550

我现在已经成功地完成了这项工作。

**简要概述**

它的工作原理是拥有一个“数据类”，它只是一个包含变量且没有代码的常规 C# 类。然后将其实例化并填充数据，然后放置在 ArrayList 中。ArrayList 与要加载的报表名称一起绑定到报表查看器。在报表设计器中使用“.Net Objects”，而不是与数据库通信。

**解释**

我创建了一个类来保存我的报告的数据。这个类是由我通过手动从数据库中检索数据来手动填充的。你如何做到这一点并不重要，但这里有一个例子：

```
DataSet ds = GeneratePickingNoteDataSet(id);
foreach (DataRow row in ds.Tables[0].Rows) {
    CPickingNoteData pickingNoteData = new CPickingNoteData();

    pickingNoteData.delivery_date = (DateTime)row["delivery_date"];
    pickingNoteData.cust_po = (int)row["CustomerPONumber"];
    pickingNoteData.address = row["CustomerAddress"].ToString();
    // ... and so on ...

    rptData.Add(pickingNoteData);
} 
```

然后将该类放入 ArrayList 中。arraylist 中的每个元素对应于完成报告中的一个“行”。

列表中的第一个元素也可以保存报表页眉数据，列表中的最后一个元素可以保存报表页脚数据。因为这是一个 ArrayList，所以可以使用普通的 Array 访问来获取它们：

```
((CPickingNoteData)rptData[0]).header_date = DateTime.Now;
((CPickingNoteData)rptData[rptData.Count-1]).footer_serial = GenerateSerialNumber(); 
```

一旦你有一个充满数据的数组列表，像这样将它绑定到你的报表查看器，其中“rptData”的类型是“ArrayList”

```
ReportDocument reportDoc = new ReportDocument();
reportDoc.Load(reportPath);
reportDoc.SetDataSource(rptData);
crystalReportViewer.ReportSource = reportDoc; 
```

现在您需要将数据类绑定到报表本身。您在设计器内部执行此操作：

1.  打开“字段资源管理器”选项卡（可能位于“查看”菜单下），然后右键单击“数据库字段”
2.  点击“项目数据”
3.  单击“.NET 对象”
4.  向下滚动列表以找到您的数据类（如果不存在，请编译您的应用程序）
5.  按“>>”然后确定
6.  您现在可以将班级成员拖到报告中并根据需要进行排列。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T21:19:55.047

Crystal 是创建报告的一种可能选项。它已经存在了很长时间，似乎很多人都喜欢它。

您可能想看看 SQL 报告服务。我都使用过，但我更喜欢 SQL 报告服务。它很好地集成到工作室中，并且与其他微软项目类似。它也可以通过 sql express 等免费使用。

这是一篇关于开始报告服务的好文章： [http ://www.simple-talk.com/sql/learn-sql-server/beginning-sql-server-2005-reporting-services-part-1/](http://www.simple-talk.com/sql/learn-sql-server/beginning-sql-server-2005-reporting-services-part-1/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T05:34:02.520

您可以将报表查看器与内置于 vs.net 的客户端报表一起使用（ReportBuilder/ReportViewer 控件）。您可以像创建 sql 报告服务一样创建报告，但不需要 sql server（也不需要 asp.net）。另外，您可以完全控制它们（如何呈现、如何收集数据、生成它们的层、生成后如何处理它们，例如邮寄、发送到 ftp 等）。您还可以导出为 PDF 和 Excel。

在您的情况下，根据数据和用户输入构建报告，这可能会很好，因为您可以在进行过程中构建自己的数据源和数据。准备好报告数据后，将其绑定到您的报告。

报表可以很容易地在 Visual Studio 2005 中构建（将报表添加到您的项目），并使用 ReportViewer 控件显示在 Winforms 应用程序中。

如果对客户端报告感兴趣，我推荐给大家看看这是一本很棒的书。它提供了很多很棒的信息以及许多不同的场景和使用客户端报告的方法。

[http://www.apress.com/book/view/9781590598542](http://www.apress.com/book/view/9781590598542)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T21:22:23.357

我赞同 alex 的建议，看看 sql 报告服务 - 如果您有 sql 开发人员许可证，那么您可能已经有报告服务

我不喜欢水晶报告，设计器太乏味（一直在编辑表达式）太多服务器部署问题（检查那些许可证文件！）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T23:16:47.637

我用水晶。我将简要概述我的方法，但请注意，我是一家单人店，它可能无法转化为您的环境。

首先，使用 CR 查看器创建一个表单。然后：

1) 找出您需要的数据，并创建一个检索所需列的视图。2) 使用向导创建一个新的 Crystal 报表，将您的视图作为数据源。3）拖放，插入，删除，以及任何使您的报告粗略成形的东西。是的，这很乏味。4）创建必要的按钮点击或其他，并创建生成报告的功能。5) 将数据检索到 DataTable（可能在 DataSet 中）。您不必使用视图。6) 创建报表对象。将 DataTable 设置为 DataSource。将报告对象分配给 CR 查看器。这是有例子的一部分。

评论：

如果您丢失了带有数据库字段等的窗口（字段资源管理器），请转到查看/文档大纲。（让比尔盖茨站在舞台上并让他找到它是我的幻想。）

设置视图的原因是，如果要添加列，则修改视图，字段资源管理器将自动更新。我在其他方面遇到了各种各样的麻烦。此方法也是解决需要扫描所有表以重置它们指向的表的错误的解决方法。你想递给水晶一张桌子。您不想尝试让 Crystal 加入表格等。我并不是说它不起作用；我说更难。

Business Objects 网站上有（或曾经有）Crystal 的 VS 实现的文档，但我相信它已经消失在注册/登录屏幕后面。（我自己可以了解更多信息。）

我很难让 Crystal 在我想要的时候分页，而不是在我不想要的时候分页等等。它远非我用过的最好的报告编写器，我不明白为什么它似乎已经放这么多人倒闭。此外，他们的许可政策很难在一个小型、流动的组织中处理。

编辑添加示例：

```
AcctStatement oRpt = new AcctStatement() ;
oRpt.Database.Tables[0].SetDataSource(dsRpt.Tables[0]);
oRpt.SetParameterValue("plan_title",sPlanName) ;
crViewer.ReportSource = oRpt ; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T19:27:51.353

我发现以下网站解决了我的问题。包括在此处以供将来参考。

[CrystalReportViewer 对象模型](http://msdn.microsoft.com/en-us/library/ms227490(VS.80).aspx)教程关于如何使整个事情工作的教程。并且还[设置一个项目以使用 Crystal Reports](http://msdn.microsoft.com/en-us/library/ms227453(VS.80).aspx) 并专门[准备表单](http://msdn.microsoft.com/en-us/library/ms227525(VS.80).aspx)并[添加控件](http://msdn.microsoft.com/en-us/library/ms227507(VS.80).aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-07T18:16:00.803

我认为这可能会帮助你 [http://infynet.wordpress.com/2010/10/06/crystal-report-in-c/](http://infynet.wordpress.com/2010/10/06/crystal-report-in-c/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-24T11:12:15.967

我强烈建议尝试另一种报告解决方案——我在 Crystal 方面有很多经验，并且已经设法在 .Net 中用它做一些时髦的事情，但老实说，Crystal 和 .Net 的集成对于任何事情来说都是绝对的猪，除了最简单的情况。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-09-14T11:29:55.240

我试过RS。我正在从 RS 转换回 Crystal。RS太重太慢（或其他东西）。当 Crystal 在不到一秒的时间内完成报告时，没有理由必须等待 30 秒才能呈现 RS。

# c# - 如何创建和解析相对路径？

> ID：164630
> 
> 赞同：1
> 
> 时间：2008-10-02T21:11:34.927
> 
> 标签：c#, file-io, path

我的应用程序在执行它的目录的子目录中打开文件，调用子目录`sample`并包含文件：

*   `example.raf`（示例扩展，不重要）
*   `background.gif`

`example.raf`包含到的相对路径`background.gif`（在这种情况下，只有文件名，因为文件与 raf 位于同一目录中）并且打开 RAF 会导致应用程序读取和显示`background.gif`.

当我使用`OpenFileDialog`加载 RAF 文件时，一切正常，图像加载正确。我知道打开文件对话框以某种方式更改了当前工作目录，但我无法在不调用打开文件对话框的情况下重新创建它

不幸的是，如果我直接从代码中调用**raf 读取**`OpenFileDialog`方法，而不像这样提供文件形式的路径

```
LoadRAF("sample\\example.raf"); 
```

在这种情况下，我遇到了问题，应用程序尝试从 **ExecutablePath**加载图像，而不是从包含**RAF**文件和**图像**的子目录加载。当然，这是正常行为，但在这种情况下，这是非常不受欢迎的。需要在我的应用程序中处理相对和绝对类型的路径，所以我应该怎么做才能解决这个问题，如何**更改 ExecutablePath** 或者我可以做些什么来使这项工作至少在以下情况下工作`OpenFileDialog`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-17T09:54:33.820

我的项目 ZipSolution ( [http://zipsolution.codeplex.com/](http://zipsolution.codeplex.com/) ) 中的下一个代码显示了如何在 .net 中解析和创建相对路径

```
using System;
using System.Collections.Generic;
using System.Text;
using System.IO;

namespace ZipSolution
{
    internal static class RelativePathDiscovery
    {
        /// <summary>
        /// Produces relative path when possible to go from baseLocation to targetLocation
        /// </summary>
        /// <param name="baseLocation">The root folder</param>
        /// <param name="targetLocation">The target folder</param>
        /// <returns>The relative path relative to baseLocation</returns>
        /// <exception cref="ArgumentNullException">base or target locations are null or empty</exception>
        public static string ProduceRelativePath(string baseLocation, string targetLocation)
        {
            if (string.IsNullOrEmpty(baseLocation))
            {
                throw new ArgumentNullException("baseLocation");
            }

            if (string.IsNullOrEmpty(targetLocation))
            {
                throw new ArgumentNullException("targetLocation");
            }

            if (!Path.IsPathRooted(baseLocation))
            {
                return baseLocation;
            }

            if (!Path.IsPathRooted(targetLocation))
            {
                return targetLocation;
            }

            if (string.Compare(Path.GetPathRoot(baseLocation), Path.GetPathRoot(targetLocation), true) != 0)
            {
                return targetLocation;
            }

            if (string.Compare(baseLocation, targetLocation, true) == 0)
            {
                return ".";
            }

            string resultPath = ".";

            if (!targetLocation.EndsWith(@"\"))
            {
                targetLocation = targetLocation + @"\";
            }

            if (baseLocation.EndsWith(@"\"))
            {
                baseLocation = baseLocation.Substring(0, baseLocation.Length - 1);
            }

            while (!targetLocation.StartsWith(baseLocation + @"\", StringComparison.OrdinalIgnoreCase))
            {
                resultPath = resultPath + @"\..";
                baseLocation = Path.GetDirectoryName(baseLocation);

                if (baseLocation.EndsWith(@"\"))
                {
                    baseLocation = baseLocation.Substring(0, baseLocation.Length - 1);
                }
            }

            resultPath = resultPath + targetLocation.Substring(baseLocation.Length);

            // preprocess .\ case
            return resultPath.Substring(2, resultPath.Length - 3);
        }

        /// <summary>
        /// Resolves the relative pathes
        /// </summary>
        /// <param name="relativePath">Relative path</param>
        /// <param name="basePath">base path for discovering</param>
        /// <returns>Resolved path</returns>
        public static string ResolveRelativePath(string relativePath, string basePath)
        {
            if (string.IsNullOrEmpty(basePath))
            {
                throw new ArgumentNullException("basePath");
            }

            if (string.IsNullOrEmpty(relativePath))
            {
                throw new ArgumentNullException("relativePath");
            }

            var result = basePath;

            if (Path.IsPathRooted(relativePath))
            {
                return relativePath;
            }

            if (relativePath.EndsWith(@"\"))
            {
                relativePath = relativePath.Substring(0, relativePath.Length - 1);
            }

            if (relativePath == ".")
            {
                return basePath;
            }

            if (relativePath.StartsWith(@".\"))
            {
                relativePath = relativePath.Substring(2);
            }

            relativePath = relativePath.Replace(@"\.\", @"\");
            if (!relativePath.EndsWith(@"\"))
            {
                relativePath = relativePath + @"\";
            }

            while (!string.IsNullOrEmpty(relativePath))
            {
                int lengthOfOperation = relativePath.IndexOf(@"\") + 1;
                var operation = relativePath.Substring(0, lengthOfOperation - 1);
                relativePath = relativePath.Remove(0, lengthOfOperation);

                if (operation == @"..")
                {
                    result = Path.GetDirectoryName(result);
                }
                else
                {
                    result = Path.Combine(result, operation);
                }
            }

            return result;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T21:19:57.730

OpenFileDialog 在幕后吐出一条绝对路径。

如果您知道 raf 文件的位置，您可以执行以下操作：

```
string parentPath = Directory.GetParent(rafFilePath);
string imagePath = Path.Combine(parentPath, imageFileNameFromRaf); 
```

imagePath 现在将包含从 raf 文件中包含的图像名称派生的图像的绝对路径，以及 raf 文件所在的目录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-17T10:03:43.407

在从相对路径读取之前，您可以尝试使用 Environment.CurrentDirectory 将当前目录更改为包含可执行文件的目录。或者相反，如果您有相对路径 (Path.IsPathRooted)，您可以将 (Path.Combine) 您的根目录与相对路径结合起来，以获得绝对路径。

# grails - 创建没有版本号的 grails 战争

> ID：164642
> 
> 赞同：29
> 
> 时间：2008-10-02T21:13:40.447
> 
> 标签：grails

如何创建一个 grails 战争文件，使其没有版本号

（例如 foo-0.1.war）

当我执行“grails war”命令时附加到末尾？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2011-02-03T22:34:11.173

如果有人看到这篇文章并使用 Grails 1.3.x，配置选项已从`grails.war.destFile`in更改`Config.groovy`为`grails.project.war.file`in `BuildConfig.groovy`。

此外，文件名是相对于项目工作区的，因此它应该具有如下值：

`grails.project.war.file = "target/${appName}.war"`

这是根据最新的[Grails 文档](http://grails.org/doc/latest/guide/17.%20Deployment.html)。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-02T21:32:18.467

我认为您可以在 war 命令中指定战争名称。

```
grails war foo.war 
```

另请查看最新的 Grails 文档，了解在何处将其设置为配置选项。有关详细信息，请参阅其他答案。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-21T21:38:54.003

来自[Grails 文档](http://grails.org/doc/1.0.x/)，***第 17 章，部署***

> 您还可以通过多种方式自定义创建的 WAR 文件。例如，您可以为命令指定一个路径（绝对路径或相对路径），该命令指示它在哪里放置文件以及给它起什么名字：
> 
> ```
> grails war /opt/java/tomcat-5.5.24/foobar.war 
> ```
> 
> 或者，您可以在 Config.groovy 中添加一行来更改默认位置和文件名：
> 
> ```
> grails.war.destFile = "foobar-prod.war" 
> ```
> 
> 当然，您提供的任何命令行参数都会覆盖此设置。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-13T01:24:14.987

汇总其他出色的答案。有几种选择：

在命令行上显式设置： `grails war foo.war`

在 application.properties 中将属性设置`app.version`为空将导致战争被命名`foo.war`。

`grails.war.destFile`使用Config.groovy中的属性显式设置战争的名称

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-09-01T17:41:57.607

Grails 3.x 已切换到 gradle 并使用[war](https://docs.gradle.org/current/userguide/war_plugin.html)插件。您可以在`build.gradle`文件中指定这样的名称：

```
war {
    archiveName 'foo.war'
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T01:38:20.890

另一种生成没有版本号的war文件的方法是在**application.properties中保留属性****app.version**为空

 *** * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-06-26T21:35:50.487

我参加聚会有点晚了……但无论如何：

我认为删除版本号的原因是为了消除重命名war文件的需要，以便它部署在“*正确的*”上下文路径**/appName**上。**如果是这种情况，那么更好的选择是使用版本化的 war 文件名，这样您就可以使用grails-app/conf/BuildConfig.groovy**中的以下命名模式在 tomcat 上同时部署多个版本：

```
grails.project.war.file = "target/${appName}##${appVersion}.war" 
```

如[http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Parallel_deployment中所述](http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Parallel_deployment)

这种方法适用于一般的战争，而不仅仅是圣杯的战争。

# c# - int 是 64 位 C# 中的 64 位整数吗？

> ID：164643
> 
> 赞同：30
> 
> 时间：2008-10-02T21:13:47.497
> 
> 标签：c#, 64-bit, 32-bit, primitive

在我的 C# 源代码中，我可能将整数声明为：

```
int i = 5; 
```

或者

```
Int32 i = 5; 
```

在当前流行的 32 位世界中，它们是等价的。但是，随着我们进入 64 位世界，我是否正确地说以下内容将变得相同？

```
int i = 5;
Int64 i = 5; 
```

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-02T21:15:18.663

不，C# 规范严格定义它是32 位`int`的别名。`System.Int32`改变这将是一个*重大*的突破性变化。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-07-14T18:45:34.537

C# 中的`int`关键字被定义为`System.Int32`类型的别名，这（从名称判断）意味着是一个 32 位整数。到规范：

> [CLI 规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-335.pdf)第 8.2.2 节（内置值和引用类型）有一个包含以下内容的表：
> 
> *   `System.Int32`- 有符号 32 位整数
> 
> [C# 规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-334.pdf)第 8.2.1 节（预定义类型）有一个类似的表：
> 
> *   `int`- 32 位有符号整数类型

这保证了`System.Int32`在 CLR 和`int`C# 中始终是 32 位的。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-07-14T20:50:54.673

> sizeof(testInt) 会是 8 吗？

不， sizeof(testInt) 是一个错误。testInt 是一个局部变量。sizeof 运算符需要一个类型作为其参数。这永远不会是 8，因为它总是一个错误。

> VS2010 将 ac# 托管整数编译为 4 个字节，即使在 64 位机器上也是如此。

正确的。我注意到 C# 规范的第 18.5.8 节定义`sizeof(int)`为编译时常量 4。也就是说，当您说 `sizeof(int)`编译器只是将其替换为 4 时；就像您在源代码中说“4”一样。

> 有谁知道 C# 中的标准“int”是否/何时会是 64 位？

绝不。C# 规范的第 4.1.4 节指出“int”是“System.Int32”的同义词。

如果您想要的是“指针大小的整数”，请使用 IntPtr。IntPtr 在不同的架构上改变它的大小。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-07-14T18:45:30.610

`int``Int32`在所有平台上始终是同义词。

微软不太可能在未来改变这一点，因为它会破坏许多假设`int`为 32 位的现有代码。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-07-14T19:00:30.423

我认为您可能会感到困惑的是，它`int`是一个别名，`Int32`因此它始终为 4 个字节，但`IntPtr`假设与 CPU 架构的字长匹配，因此在 32 位系统上为 4 个字节，在 8 个字节上64位系统。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-07-14T18:48:39.497

根据 C# 规范[ECMA-334](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-334.pdf)的“11.1.4 简单类型”部分，保留字`int`将别名为`System.Int32`. 由于这在规范中，因此不太可能更改。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-02T21:28:38.427

无论您使用的是 32 位版本还是 64 位版本的 CLR，在 C# 中，an`int`始终表示`System.Int32`并且`long`将始终表示`System.Int64`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-07-04T03:50:03.860

以下在 C#中将[始终为真：](https://msdn.microsoft.com/en-us/library/exx3b86w.aspx)

**sbyte 有**符号 8 位，1 字节

**字节**无符号 8 位，1 字节

**短**符号 16 位，2 字节

**ushort**无符号 16 位，2 字节

**int 有**符号 32 位，4 字节

**uint**无符号 32 位，4 字节

**长**符号 64 位，8 字节

**ulong**无符号 64 位，8 字节

整数*文字*只是一个数字序列（例如`314159`）*，没有*任何这些显式类型。C# 将它分配给它适合的序列（**int**、**uint**、**long**、**ulong ）中的第一个类型。**这似乎在上述至少一个回应中有点混乱。

[奇怪](https://msdn.microsoft.com/en-us/library/aa664674(v=vs.71).aspx)的是，出现在一串数字之前的*一元减号运算符*（减号）*不会*将选择减少到（**int**，**long**）。字面量总是积极的；减号确实是一个运算符。所以想必`-314159`是*完全*一样的东西`-((int)314159)`。除非显然有一种特殊情况可以`-2147483648`直接进入**int**；否则它会是`-((uint)2147483648)`。我认为这会做一些不愉快的事情。

不知何故，预测 C#（和朋友）永远不会为 >=128 位整数的“软名称”类型而烦恼似乎是安全的。只要处理器支持进行如此广泛的数学运算，我们就会得到对*任意*大整数的良好支持和对 UInt128、UInt256 等的超精确支持，并且几乎不使用其中的任何一个。64 位地址空间*真的*很大。如果它们太小，那将是出于某种深奥的原因，例如 ASLR 或更高效的 MapReduce 之类的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-02T21:22:03.843

是的，正如 Jon 所说，与“C/C++ 世界”不同，Java 和 C# 不依赖于它们所运行的系统。它们严格定义了字节/短/整数/长和单/双精度浮点数的长度，在每个系统上都相等。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2015-08-20T23:31:12.670

不带后缀的 int 可以是 32 位也可以是 64 位，这取决于它所代表的值。

如 MSDN 中所定义：

> 当整数文字没有后缀时，它的类型是第一个可以表示其值的类型：int、uint、long、ulong。

这是地址： [https ://msdn.microsoft.com/en-us/library/5kzh1b5w.aspx](https://msdn.microsoft.com/en-us/library/5kzh1b5w.aspx)

# c# - 格式化 C# 代码片段的文字参数

> ID：164645
> 
> 赞同：34
> 
> 时间：2008-10-02T21:14:43.000
> 
> 标签：c#, code-generation, code-snippets

有什么方法可以更改代码片段的文字在片段生成的代码中使用时的呈现方式？

具体来说，我想知道我是否可以有一个名为 $PropertyName$ 的文字，然后让代码片段引擎呈现“_$PropertyName$”，其中第一个字符变为小写。

我买不起R#。请帮忙 ：）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-02T21:40:12.113

不幸的是，似乎没有办法。如您所见，片段对[转换函数的支持非常有限。](http://msdn.microsoft.com/en-us/library/ms242312(VS.80).aspx)

您必须坚持使用 VS 标准解决方案，即编写两种文字：一种用于属性名称，另一种用于成员变量名称。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-08-17T13:06:43.537

“修复”可能是在命名或成员变量中使用前缀，即：

```
string m_$name$;
string $name$
{
 get{return m_$name$;}
 set{m_$name$=value;}
}; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-12-13T09:39:00.223

您可以输入一个大写的第一个字母，然后是一个属性名称，然后是一个小写的首字母。试试这个片段：

```
<?xml version="1.0" encoding="utf-8"?>
<CodeSnippet Format="1.0.0" xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
  <Header>
    <Title>Notifiable Property</Title>
    <Author>Nikolay Makhonin</Author>
    <Shortcut>propn</Shortcut>
    <Description>Property With in Built Property Changed method implementation.</Description>
    <SnippetTypes>
      <SnippetType>SurroundsWith</SnippetType>
      <SnippetType>Expansion</SnippetType>
    </SnippetTypes>
  </Header>
  <Snippet>
    <Declarations>
        <Literal>
            <ID>Type</ID>
            <Default>Type</Default>
        </Literal>
        <Literal>
            <ID>P</ID>
            <Default>P</Default>
        </Literal>
        <Literal>
            <ID>roperty</ID>
            <Default>ropertyName</Default>
        </Literal>
        <Literal>
            <ID>p</ID>
            <Default>p</Default>
        </Literal>
        <Literal>
            <ID>Ownerclass</ID>
            <ToolTip>The owning class of this Property.</ToolTip>
            <Function>ClassName()</Function>
            <Default>Ownerclass</Default>
        </Literal>
    </Declarations>
    <Code Language="CSharp">
      <![CDATA[#region $P$$roperty$

        private Field<$Type$> _$p$$roperty$;
        public static readonly string $P$$roperty$PropertyName = GetPropertyName(() => (($Ownerclass$)null).$P$$roperty$);
        public $Type$ $P$$roperty$
        {
            get { return _$p$$roperty$; }
            set { Set(ref _$p$$roperty$, value); }
        }

        #endregion

]]>
    </Code>
  </Snippet>
</CodeSnippet> 
```

# semantic-web - 我在哪里可以找到各种领域的公共领域猫头鹰本体的良好集合？

> ID：164648
> 
> 赞同：14
> 
> 时间：2008-10-02T21:14:56.637
> 
> 标签：semantic-web, owl, ontology

我正在构建一个本体处理工具，并且需要大量各种猫头鹰本体的示例，因为人们在现实世界中构建和使用它们。我不是在谈论像 Cyc 这样的基础本体，我是在谈论更小的、特定于领域的本体。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-06T13:59:46.103

没有明确的集合 afaik，但这些链接都有有用的 OWL 和 RDFS 本​​体集合：

*   [schemaweb.info](http://www.schemaweb.info/)
*   [词汇.org](http://vocab.org/)
*   [猫头鹰](http://www.owlseek.com/master.html)
*   [链接开放数据星座](http://www.umbel.org/lod_constellation.html)
*   [RDF 模式注册表](http://139.91.183.30:9090/RDF/Examples.html)（现在相当老了）

此外，还有一些通用的 RDF/RDFS/OWL 搜索引擎可能会对您有所帮助：

*   [辛迪斯](http://sindice.com/)
*   [斯沃格尔](http://swoogle.umbc.edu/)

伊恩

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-10-03T13:35:26.203

在提出问题时，我的首选网站可能不存在。对于像我这样的后来者：

[链接的开放词汇](http://lov.okfn.org/dataset/lov/)

我希望我能早点找到它！

它经过精心修饰、维护，拥有所有最流行的本体，并且拥有良好的搜索引擎。然而，它不包括一些专门的收藏，最值得注意的是，（大部分？）OBO Foundry 中的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-08T18:39:46.083

谢谢！我发现了更多：

*   [OntoSelect - 可浏览的本体存储库](http://olp.dfki.de/ontoselect/)
*   [Protege本体库](http://protegewiki.stanford.edu/index.php/Protege_Ontology_Library)
*   [CO-ODE 本体](http://www.co-ode.org/ontologies/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-14T13:47:58.777

[在生命科学领域，可以在OBO Foundry 网站](http://www.obofoundry.org/)上找到公开可用的本体。可以通过[本体查找服务](http://www.ebi.ac.uk/ontology-lookup/)或[NCBO 的 Bioportal](http://bioportal.bioontology.org/)查询这些本体，其中还包含其他资源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T10:37:16.197

另一种概念搜索工具：[猎鹰](http://iws.seu.edu.cn/services/falcons/conceptsearch/index.jsp?query=)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-07T10:06:12.233

还有一个很好的搜索本体的网络引擎。它称为 Watson Semantic Web Search，您可以[在此处](http://kmi-web05.open.ac.uk/WatsonWUI/)试用。

# c# - 实体框架和 ASP.NET 的最佳实践

> ID：164661
> 
> 赞同：4
> 
> 时间：2008-10-02T21:18:19.483
> 
> 标签：c#, asp.net, .net, entity-framework, linq-to-entities

我一直在让自己发疯，试图让实体框架在 ASP.NET 环境中按预期（或至少按我预期）工作，特别是在尝试保存到数据库时处理属于不同上下文的对象。

处理实体框架和 ASP.NET 时的最佳实践是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T21:26:30.850

实体框架 V1 的持久性无知 (POCO) 适配器 [http://blogs.gotdotnet.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx](http://blogs.gotdotnet.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx)

# .net - .Net 框架和 Office 2007 中的 Office 2003 PIA 先决条件

> ID：164689
> 
> 赞同：0
> 
> 时间：2008-10-02T21:28:10.817
> 
> 标签：.net, office-2007

当 Windows 安装程序中的 Office 2003 PIA 先决条件和启动条件针对 Office 2007 系统运行时会发生什么情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T21:44:38.297

是的，除非出于未安装 Office 2003 的简单原因，否则它将失败。我们为 Office 2007 和 Office 2003 创建单独的安装程序。

此外，Office 2003 加载项与 Office 2007 加载项的结构也有所不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T21:42:24.497

我相信 2003 PIA 需要安装 Office 2003（所以我猜它会失败）。AFAIK，2003 互操作不适用于 2007 应用程序。可以在[此处](http://blogs.msdn.com/andreww/archive/2007/06/08/why-is-vs-development-not-supported-with-multiple-versions-of-office.aspx)找到有关这些类型场景的更多信息。因此，即使它确实安装了（很容易测试），您也可能没有一个可以工作的应用程序。

您是否试图让一些 2003 加载项与 Office 2007 一起使用？

# c++ - 带有gui和linux下的c ++最好的稳定编辑器和编译器是什么？

> ID：164693
> 
> 赞同：7
> 
> 时间：2008-10-02T21:29:31.890
> 
> 标签：c++, compiler-construction, editor

在 linux 下工作的带有 gui 的 C++ 的最佳稳定（编辑器和编译器）是什么？

注意：明确不寻找完整的 IDE。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-08T20:53:08.520

我喜欢用**Emacs**编写代码。它也为 gdb 提供了一个不错的 gui。我最近在处理一些代码片段时拍了一张快照（见下文，它看起来一点也不像 1980 年 :)。

也就是说，还有很多其他优秀的 IDE。我喜欢用于 Java 开发的**Eclipse**，听说它也有一个不错的 C++ 插件（CDT）。**Netbeans**最近也适用于 C++。**KDevelop**是一个支持多种语言的 KDE IDE，目前正在为 KDE4 重写：[KDevelop 博客](http://zwabel.wordpress.com/)。看起来很有希望。还有一些其他的我无法告诉你它们是怎样的，因为我没有测试过它们，包括**Anjuta**（用于 Gnome 桌面）和**Code::Blocks**（用 wxWidgets 编写，它非常跨平台）。如果您想要的只是编译器的 GUI 和符号浏览器，您还可以使用[**geany**](http://www.geany.org/)，它非常快，并且包括一个嵌入式终端，如 KDevelop。

所有这些都有其起起落落。最好尝试一下，然后再决定。从稳定性来看，我发现 Emacs 很稳定，从不崩溃，Eclipse 也很成熟。Netbeans 获得第三名。它有时会挂起，但总的来说它也很成熟。KDevelop 喜欢（ed）时不时崩溃，但在这方面取得了很大进展。尤其是 3.5 版本确实向前迈出了一大步，感觉比之前的任何版本都成熟。

Emacs 编辑一些代码：

![C++ emacs 编辑一些代码](https://i.stack.imgur.com/PSlaR.png)

Emacs 调试会话：

![C++ emacs 调试](https://i.stack.imgur.com/g2hHA.png)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-02T21:35:55.773

留在免费的领域，可能是带有 C++ 插件的 Eclipse，否则我使用 g++ + gdb + make + gvim + 其他 gnu 的东西进行编码。结果很棒，但学习曲线很严重。

根据您的编码，还有[Qt 设计](http://trolltech.com/products/appdev)器和[KDevelop](http://www.kdevelop.org/)，但我没有使用它们。

补充：读回你原来的问题，你似乎想要一些还不是 IDE 的东西（程序列表），尽管它提供了一个 GUI。我不记得任何 gcc 的 GUI，但 gdb 确实有一个名为[DDD](http://www.gnu.org/software/ddd/)的 GUI 。因此，您至少在某些时候必须使用控制台。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-02T22:06:00.927

[Code::Blocks](http://www.codeblocks.org/)作为 Windows 和 Linux 的 C++ IDE 运行良好。我现在只在工作中使用它（在两个平台上），并且比 Visual Studio 更喜欢它。我发现代码完成也往往工作得更好！

它非常擅长挑选可用的编译器并与 gcc、MinGW 和 Visual Studio 编译器一起使用，它还具有调试功能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-03T03:06:06.370

**SciTE**是一个很好的“程序员的编辑器”，它是专门为此目的而编写的。它背后的引擎*Scintilla*也在 IDE 中广泛使用。Linux 上事实上的编译器是**GCC**，它也是一个非常强大和稳定的编译器。您应该选择 GCC 4 或更高版本以获得更好的 C++ 性能。

SciTE 也具有集成编译器的基本支持（按下按钮并查看编译器的输出、基本代码完成......）。SciTE 最重要的一点是，你必须先编辑它自己的配置，让它成为一个舒适的编辑器。默认情况下禁用许多重要功能，例如行号、文件选项卡、恢复会话。

您还需要熟悉（公认简单的）**Makefile**格式，以便**`make`**用于构建。SciTE + make 无论如何都不能替代一个好的 IDE，但如果你不想使用一个完整的 IDE，它们仍然非常擅长让你保持生产力。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-02T21:48:47.477

日食不错。带有它的插件的 Netbeans 也不错。您也可以使用 Kdevelop（非常可配置）。

如果你想 GUI Moranar 提到 QT desiner。还有 Glade（GTK 绑定）和 WxGlade（包括 C++ 在内的多种语言的 wx 绑定）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-02T13:14:22.040

在 Linux 环境中进行开发时，有 2 种方法可供您选择： 如果您想以一体化的方式管理您的项目，您应该选择 KDevelop。

它是迄今为止我使用过的最先进、最稳定的 IDE（在 Linux 环境中）。Code::Blocks、Eclipse CDT、Netbeans 也非常强大，但根据我的经验，KDevelop 拥有其他 IDE 必须提供的一切，甚至更多。但是您应该自己检查其他 IDE，因为这是我的意见。

第二种也是比较耗时的方法是去了解Moranar提到的gnu开发工具链。gcc/g++, make, gdb/DDD, valgrind,(g)vim/scite ... 。出于测试目的，还建议您熟悉 perl 或 bash 脚本等脚本语言。它节省了很多时间......

如果您想快速完成工作，您应该坚持使用 IDE 解决方案，但如果您想成为一个更完整、更有能力的开发人员，请选择 gnu 工具链。到目前为止我还没有后悔过。

ps 如果您选择 scite 作为您的编辑器，请向 ypnos（我上面的那个人）询问他的配置。它拥有您需要的一切，而且对眼睛也很容易:)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-03T00:14:24.800

我要把我的两分钱放在这里。我真的很喜欢 KATE（KDE 的一部分）。它是 KDevelop 中使用的编辑器，但不用作 IDE。相反，它有一个内置的命令行，因此您可以自己发出构建命令。在带有 Make 或 Scons 或 Bjam 或其他设置的项目上（很容易为您的项目编写一个简短的 Bjam 文件），您可以直接发出 build 命令。

我喜欢 KATE，因为它具有没有臃肿的 IDE 功能。不幸的是，它没有重构支持，但它确实有一个符号浏览器，我用得不够多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T21:55:32.670

我喜欢Linux 和 Windows 上的[SciTE](http://www.scintilla.org/SciTE.html)。

它*非常*轻巧且可定制。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T22:16:27.580

我建议使用 Eclipse，因为它是一个非常适合初学者使用的 IDE。它也可用于 Windows 和 Linux。最有用的功能之一是自动完成。此外，还有一个大型社区可以回答您对此提出的任何问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-02T22:43:17.127

Eclipse 和 Netbeans 对于所有支持的语言都非常棒。Eclipse 过去快得多，netbeans 赶上了，而且功能更强大，更干净，支持更多语言。

此外，如果您认为这是一项您不想复制的投资，请使用 Netbeans——他们目前拥有最多的开源编辑器，并且还在增加。

就我个人而言，我更喜欢与环境无关。我了解我需要了解的关于我正在工作的任何环境的知识，而不会过于依赖键绑定和特定的布局技巧，诸如此类。

我仍然遇到使用 emacs 并喜欢它的人（以及一些使用 VI 的人！）。他们觉得自己无法改变，因为他们在学习击键方面的投入很大。对我来说，这似乎有点弄巧成拙（您通过依附于特定的键盘布局来拒绝使用更新/其他工具），但无论如何。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T21:54:31.050

我不确定您的问题是否完全重复，但这已被讨论过多次。看有关已讨论过的所有其他问答线程的完整列表，[此答案。](https://stackoverflow.com/questions/161437/best-ides-for-c-development#161442)或者选择[IDE](https://stackoverflow.com/questions/tagged/ide)标签。

* * *

编辑：

我想这可能听起来很讨厌，但如果这听起来很粗鲁，我想不出另一种说法，所以提前道歉：

据我所知（如果我错了，我相信人们会纠正我）IDE 和编辑器/编译器组合之间的主要区别在于集成调试器的存在。既然我无法想象在没有调试器的情况下进行严肃的开发工作，为什么不直接说“IDE”并完成它呢？我的意思是你无论如何都需要一个调试器——为什么不把整个东西放在一个包里，然后收工呢？如果您真的不需要调试器，那么请分享您正在进行的开发类型，您只需要编写和编译代码而无需调试它。

我理解“如果你不使用它，就不要为此付费”的理念，但我认为说“好吧，我只需要一个编辑器和编译器，因为我不需要 IDE 的额外开销”是在这种特殊情况下只是一个错误的命题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T21:58:33.520

Sun Studio 包括一个完整的 IDE 和一个非常高性能的编译器，可用于 Red Hat（或 CentOS）和 SUSE Linux 平台以及 Solaris。它是免费的，但据我所知，目前还不是开源的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-05T01:34:59.793

KDevelop，代码：：块，Eclipse

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-05T01:11:00.403

SciTE + scite-debug == 我所需要的一切

SciTE：[http](http://www.scintilla.org/SciTE.html) ://www.scintilla.org/SciTE.html scite-debug：[http ://scitedebug.luaforge.net/](http://scitedebug.luaforge.net/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-04T12:20:53.927

我认为Qt SDK 附带的[Qt Creator是最好的选择，整个包现在是 LGPL 并且可以在 Windows、Linux 和 Mac OS 上运行。](http://www.qtsoftware.com/products/developer-tools?currentflipperobject=937ba3e952f85ef68ddbb7cb4b20fc19)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-01-17T14:23:53.483

我在 Windows 或 Linux 上使用过的最好的编辑器是[SlickEdit](http://www.slickedit.com/)。它不是免费的（尽管您可以下载功能齐全的试用版）——但我认为每一分钱都值得。

当谈到 Linux 上的免费/开源编辑器时，我现在使用[Geany](http://www.geany.org/)，而在 Windows 上我使用[Notepad++](http://notepad-plus-plus.org/)。

至于编译器 - gcc 是我选择的编译器。

# .net - .NET DBNull 与所有变量类型都没有？

> ID：164697
> 
> 赞同：6
> 
> 时间：2008-10-02T21:30:32.247
> 
> 标签：.net, vb.net, variables, dbnull, null

我对 .NET 中的空值和变量有点困惑。（首选VB）

有没有办法检查任何给定变量的“nullness”，无论它是对象还是值类型？还是我的空检查必须始终预测它是检查值类型（例如 System.Integer）还是对象？

我想我正在寻找的是一个检查所有可能的空值的函数。也就是说，任何类型的变量

a) 自声明以来从未被赋值

b）从数据对象（来自数据库）中分配了一个空值

c) 被设置为等于另一个为空的变量值

d) 设置为从未设置或过期的 ASP.NET 会话/应用程序变量。

在 .NET 中处理空场景时是否有一般的最佳实践？

**更新：**当我谈论一个值类型为“null”时，我真正的意思是一个值类型，它要么从未设置，要么在某些时候设置为等于或从空对象强制转换。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T21:34:05.967

值类型不能为空。它违反了作为值类型的含义。您可以将值类型包装为 Nullable(Of T)，这为您提供了一组很棒的方法，并检查 Nothing 是否有效。但是使用该包装器确实有很多开销。也许你可以澄清你想要做什么？

为了完整起见，Nullable 包装器的 VB 语法为：

```
Dim i as Nullable(Of Integer) = Nothing '.NET 2.0/3.0'
Dim j as Integer? = Nothing '.NET 3.5' 
```

编辑：值类型总是预初始化为默认值，数字为 0，布尔值为 false 等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T21:40:02.677

这就是你所追求的吗？

```
if IsNothing(foo) OrElse IsDbNull(foo) Then
    ' Do Something Because foo Is Either Nothing or DBNull.Value
End If 
```

事实上，我不确定你为什么想要这种结构。我检查 DBNULL.Value 的唯一时间是当我使用来自数据库的值时，并且在我将所述值从 DATA 命名空间类分配给其他类之前[即 dim b as string = dataReader(0) ]。

通常，如果您担心一个对象尚未实例化，或者需要重新实例化它，那么只需进行 IsNothing 检查就足够了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T00:12:38.580

普通值类型（布尔值、整数、长整数、浮点数、双精度、枚举和结构）不能为空。

所有值类型的默认值为 0。

CLR 不会让您访问变量，除非它们已被设置。您可能认为情况并非总是如此，但有时 CLR 会介入并为您初始化它们。在方法级别，您必须在使用所有变量之前显式初始化它们。

此外，正如其他人指出的那样，由于 .net 2.0 有一个新的泛型类型，称为`Nullable<T>`. C# 中有一些编译器简写，比如 int? 意思是`Nullable<int>`，双？手段`Nullable<double>`等

您只能包装`Nullable<T>`不可为空的值类型，这很好，因为引用已经能够为空。

```
int? x = null; 
```

对于 int?，虽然您可以针对 null 进行测试，但有时调用`x.HasValue()`.

在 C# 中还有可以为[空的合并运算符](http://msdn.microsoft.com/en-us/library/ms173224.aspx)?? 当您想将可为空的值分配给不可为空的值类型时。但是如果你没有操作符，你可以调用GetValueOrDefault()。

```
int y = x ?? 2; // y becomes 2 if x is null.
int z = x.GetValueOrDefault(2); // same as y 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T21:47:24.017

在 .Net 中，我知道只有两种类型的 null，null（在 VB 中没有）和 DbNull。如果您使用 System.Nullable，则可以使用与对象相同的 null 检查语法。如果您的可空对象被装箱，.Net 2.0 CLR 足够聪明，可以找出处理此问题的正确方法。

我遇到这两种类型的唯一情况是在应用程序的数据层中，我可能会直接访问数据库数据。例如，我在 DataTable 中遇到了 DbNull。要在这种情况下检查这两种空类型，您可以编写一个扩展方法，例如（对不起，在 C# 中）：

```
static public bool IsNull(this object obj)
{
    return obj != null && obj != DbNull.Value;
}

...

if(dataTable[0]["MyColumn"].IsNull())
{
  //do something
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T21:35:20.177

值类型变量不能包含 null，那是因为 null 是什么意思，null 表示引用不指向任何地方。我在 VB.net 上不知道，但在 c# 上，您可以使用“？”将值类型包装为可空值，例如：

```
int? a = null; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T21:49:15.367

只要您使用 Option Strict On 进行开发，(a) 应该不是问题。编译器会对你大喊大叫。如果您担心检查参数，只需使用

```
Public Sub MySub(ByVal param1 as MyObject, ByVal param2 as Integer)
    if param1 is nothing then
         Throw New ArgumentException("param1 cannot be null!")
    end if
    'param2 cannot be null
End Sub 
```

对于 (b)，您的数据库交互层应该处理这个问题。如果您使用的是 LINQ，有一些方法可以处理这个问题。如果您使用的是类型化数据集，则自动生成的行上有一个 .IsMyVariableNull 属性。

对于 (c)，您无需担心值类型，但可以使用简单的 Is Nothing（或 IsNot Nothing）检查引用类型。

对于 (d)，您可以在读取后应用相同的逻辑。针对 Nothing 测试接收变量。

在大多数情况下，对 Is Nothing 进行简单的检查就可以了。您的数据库交互层将帮助您处理数据中更棘手的空值情况，但如何正确处理它们取决于您。

# ruby - 如何在 Ruby 中使用 C# 样式的枚举？

> ID：164714
> 
> 赞同：8
> 
> 时间：2008-10-02T21:36:45.397
> 
> 标签：ruby, enumeration, language-construct

我只想知道在 Ruby 中模拟 C# 样式枚举的最佳方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T22:09:25.070

不太一样，但我经常会为这种事情建立一个哈希：

```
STATES = {:open => 1, :closed => 2, :max => 3, :min => 4}.freeze() 
```

冻结哈希可以防止我意外修改其内容。

此外，如果您想在访问不存在的内容时引发错误，您可以使用默认 Proc 来执行此操作：

```
STATES = Hash.new { |hash, key| raise NameError, "#{key} is not allowed" }
STATES.merge!({:open => 1, :closed => 2, :max => 3, :min => 4}).freeze()

STATES[:other] # raises NameError 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T22:24:58.997

> 具体来说，我希望能够针对给定某个变量的一组值执行逻辑测试。示例是窗口的状态：“最小化、最大化、关闭、打开”

如果您需要将枚举映射到值（例如，您需要最小化到等于 0，最大化到等于 100 等），我会使用符号哈希值，如下所示：

```
WINDOW_STATES = { :minimized => 0, :maximized => 100 }.freeze 
```

冻结（就像 nate 说的那样）阻止你在未来意外破坏东西。您可以通过执行此操作来检查某些内容是否有效

```
WINDOW_STATES.keys.include?(window_state) 
```

或者，如果您不需要任何值，而只需要检查“成员资格”，那么数组就可以了

```
WINDOW_STATES = [:minimized, :maximized].freeze 
```

像这样使用它

```
WINDOW_STATES.include?(window_state) 
```

如果您的键将是字符串（例如 RoR 应用程序中的“状态”字段），那么您可以使用字符串数组。我在我们的许多 Rails 应用程序中一直这样做。

```
WINDOW_STATES = %w(minimized maximized open closed).freeze 
```

这几乎就是 Rails`validates_inclusion_of`验证器的用途 :-)

### 个人备注：

我不喜欢打字包括？一直，所以我有这个（它只是因为 .in?(1, 2, 3) 情况而变得复杂：

```
class Object

    # Lets us write array.include?(x) the other way round
    # Also accepts multiple args, so we can do 2.in?( 1,2,3 ) without bothering with arrays
    def in?( *args )
        # if we have 1 arg, and it is a collection, act as if it were passed as a single value, UNLESS we are an array ourselves.
        # The mismatch between checking for respond_to on the args vs checking for self.kind_of?Array is deliberate, otherwise
        # arrays of strings break and ranges don't work right
        args.length == 1 && args.first.respond_to?(:include?) && !self.kind_of?(Array) ?
            args.first.include?( self ) :
            args.include?( self )
        end
    end
end 
```

这使您可以键入

```
window_state.in? WINDOW_STATES 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T21:43:02.327

我不认为 Ruby 支持真正的枚举——尽管如此，仍然有可用的解决方案。

[枚举和 Ruby](http://www.rubyfleebie.com/enumerations-and-ruby/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T22:02:39.267

在 ruby​​ 中定义枚举以使用具有常量变量的类的最简单方法。

```
class WindowState
  Open = 1
  Closed = 2
  Max = 3
  Min = 4
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T22:15:23.247

像其他人所说的那样创建一个类或散列会起作用。但是，Ruby 要做的是使用[符号](http://www.rubytips.org/2008/01/26/what-is-a-ruby-symbol-symbols-explained/)。Ruby 中的符号以冒号开头，如下所示：

```
greetingtype = :hello 
```

它们有点像只包含名称的对象。

# windows - 用于在 Windows 上创建安装程序的 API

> ID：164719
> 
> 赞同：6
> 
> 时间：2008-10-02T21:38:19.903
> 
> 标签：windows, installation

有很多用于在 Windows 上创建安装程序的工具（InstallShield、InnoSetup、NSIS，仅举几例）。我见过的所有工具都属于这些类别之一或两者

*   指向并单击。用于创建安装程序的良好 GUI，但无法手动编辑安装程序定义/项目文件。
*   文本文件：没有（官方）GUI。安装程序是根据手动编辑的文本文件中的定义编译的。

我正在构建的安装程序都是使用 DSL（表示为 YAML 文件）定义的，因此使用 GUI 是不可能的，创建文本文件虽然可行，但很麻烦。

我真正想要的是一个公开（完整）API 的工具，通过它我可以控制安装程序的创建。有没有这样的工具？

编辑：我也很想听听基于非 MSI 的工具。MSI不是必需的（相反...）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T21:41:44.840

[Wix 3.0 beta](http://wix.sourceforge.net/downloadv3.html "WiX 3.0 测试版")包含为此目的的 .NET 支持。我不知道它的效果如何，但它包含文档。它是一个用于操作安装创建过程和所有优点的类型框架，所以我认为如果你不想写一行 WiX XML，你甚至不需要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T21:52:48.603

WiX 是一个很棒的工具，但是您必须进行大量直接编码才能使事情发生。幸运的是，文档非常好，并且有几个 GUI 工具，例如SourceForge 上的[WixEdit](http://sourceforge.net/projects/wixedit/)可以帮助完成此过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T06:18:03.850

好吧，您可以使用 Windows Installer API 直接创建 MSI 文件，但我认为您最好使用 WiX。

“直接编码”将比直接处理 Windows Installer API 少得多，我猜这可能对您的需要来说太“低级”了。根据您要执行的操作，您可以使用 WiX 生成 MSI，然后使用 API 对其进行调整。

生成 XML 有什么问题？这确实是您最简单的选择...您无需手动编辑它，只需编写您自己的代码即可从您的 DSL 文件和一些模板生成所需的 XML。

# powerbuilder - 从 Powerbuilder 9.0 中的弹出窗口返回自定义结构

> ID：164727
> 
> 赞同：1
> 
> 时间：2008-10-02T21:40:02.113
> 
> 标签：powerbuilder

如何从 Powerbuilder 9.0 中的弹出窗口返回值或结构？CloseWithReturn 仅对响应窗口有效，因此不可用。当我为 Message.PowerObjectParm 设置一个值时，弹出窗口关闭时该值变为空。我需要使用弹出窗口，以便用户可以单击返回调用者窗口并滚动浏览行。

程序流程： 1) 窗口 A OpenWithParm 2) 窗口 B 现在打开 3) 用户与两个窗口交互 3) 用户关闭窗口 B 4) 窗口 B 需要将结构传递回窗口 A

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T04:19:57.643

您可以通过在打开弹出窗口时传入对父窗口的引用并将引用存储在实例变量中来绕过父限制的“一个实例”。这也可以确保您使用正确版本的 w_my_parent_window_name。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T03:28:57.423

您将无法按照您的想法完成此操作。由于您从父级打开的窗口不是响应窗口，因此两者没有明确链接在一起。

但是您可以通过在父窗口中拥有一个属于您的自定义结构类型的公共实例变量来完成此操作。然后在关闭子窗口之前，通过以下方式在父窗口中显式设置变量：

```
w_my_parent_window_name.istr_my_structure = lstr_my_structure 
```

仅当仅实例化一个 w_my_parent_window_name 实例时才应执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T20:42:16.523

如果您使用的是 PFC，如果我没记错的话，您也可以使用一项服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-24T19:30:08.820

Message.PowerObjectParm 可用于传递*对象*。弹出窗口关闭时它变为 NULL 的原因是结构是自动实例化和自动销毁的。它们仅在声明的范围内有效。例如，如果它在函数中声明，它将在函数完成时被销毁；如果它是弹窗的实例变量，它会在弹窗关闭时与弹窗一起被销毁。

在关闭弹出窗口之前，您可以将结构复制回父窗口上相同类型的变量中，如 Dougman 建议的那样，或者您可以使用对象而不是结构。例如，只需创建自定义对象并在其中声明公共实例变量，就像结构变量一样。

您当然需要显式地创建和销毁对象。由弹出窗口创建的对象将保持实例化，直到显式销毁，即使在弹出窗口本身被销毁之后也是如此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T17:46:41.760

总是有多种方法可以解决问题。我会提出另一个，即使这个问题很老......

当您关闭弹出窗口时，您可以在父窗口上触发自定义事件。好吧，从技术上讲，您可以触发父窗口上的*任何*事件，但我建议专门为此创建一个自定义事件，以便您可以将结构作为参数传递给该事件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-08T13:02:29.157

使用局部结构变量返回选定的值，只需在父窗口中使用 Message.PowerObjectParm 并验证结构变量的存在，如果关闭响应窗口而不进行任何选择。

# c# - Redirect Standard Output Efficiently in .NET

> ID：164736
> 
> 赞同：9
> 
> 时间：2008-10-02T21:42:36.100
> 
> 标签：c#, .net, process, cgi

I am trying to call php-cgi.exe from a .NET program. I use RedirectStandardOutput to get the output back as a stream but the whole thing is very slow.

Do you have any idea on how I can make that faster? Any other technique?

```
 Dim oCGI As ProcessStartInfo = New ProcessStartInfo()
    oCGI.WorkingDirectory = "C:\Program Files\Application\php"
    oCGI.FileName = "php-cgi.exe"
    oCGI.RedirectStandardOutput = True
    oCGI.RedirectStandardInput = True
    oCGI.UseShellExecute = False
    oCGI.CreateNoWindow = True

    Dim oProcess As Process = New Process()

    oProcess.StartInfo = oCGI
    oProcess.Start()

    oProcess.StandardOutput.ReadToEnd() 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-02-15T18:38:20.440

The best solution I have found is:

```
private void Redirect(StreamReader input, TextBox output)
{
    new Thread(a =>
    {
        var buffer = new char[1];
        while (input.Read(buffer, 0, 1) > 0)
        {
            output.Dispatcher.Invoke(new Action(delegate
            {
                output.Text += new string(buffer);
            }));
        };
    }).Start();
}

private void Window_Loaded(object sender, RoutedEventArgs e)
{
    process = new Process
    {
        StartInfo = new ProcessStartInfo
        {
            CreateNoWindow = true,
            FileName = "php-cgi.exe",
            RedirectStandardOutput = true,
            UseShellExecute = false,
            WorkingDirectory = @"C:\Program Files\Application\php",
        }
    };
    if (process.Start())
    {
        Redirect(process.StandardOutput, textBox1);
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-02T21:56:19.047

You can use the [OutputDataReceived event](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.outputdatareceived.aspx) to receive data as it's pumped to StdOut.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-14T19:02:45.277

The problem is due a bad php.ini config. I had the same problem and i downloaded the Windows installer from: [http://windows.php.net/download/](http://windows.php.net/download/).

After that and commenting out not needed extensions, the conversion process is alà Speedy Gonzales, converting 20 php per second.

You can safely use "oProcess.StandardOutput.ReadToEnd()". It's more readable and alomost as fast as using the thread solution. To use the thread solution in conjunction with a string you need to introduce an event or something.

Cheers

# iphone - 在 2D 场景中创建“放大镜”的最佳方式是什么？

> ID：164743
> 
> 赞同：2
> 
> 时间：2008-10-02T21:44:08.640
> 
> 标签：iphone, objective-c, opengl, core-animation

我正在开发一款游戏，我需要让玩家通过镜头（例如，放大镜）观察飞机（例如，墙壁）。游戏是在 iPhone 上运行的，所以我的选择是 Core Animation 或 OpenGL ES。

我的第一个想法（我还没有尝试过）是使用 Core Animation 来做到这一点。

1.  使用 CALayers 在其上创建墙和对象。
2.  使用 CALayer 的`renderInContext:`方法创建墙壁的图像作为背景层。
3.  将图像裁剪为镜头形状，按比例放大，然后将其绘制在背景上。
4.  在上面画上镜框和“闪亮玻璃”层。

笔记：

*   我比 OpenGL 更熟悉 Core Animation，所以也许有更好的方法来使用 OpenGL 来做到这一点。（请告诉我！）
*   如果我使用未附加到视图的 CALayers，我是否必须自己管理所有动画？还是有一种简单的方法可以手动运行它们？
*   3D视角不重要；我只是放大一面平坦的墙壁。
*   我担心执行上述所有操作对于流畅的动画来说太慢了。

在我提交大量代码来编写此代码之前，我的问题是**您是否看到上述计划中的任何陷阱，或者您能否推荐一种更简单的方法来做到这一点？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T00:45:06.740

我已经使用 UIView 在 iPhone 上实现了放大镜。CA太慢了。

您可以使用它的 drawRect 方法将 CGImage 绘制到 UIView 中。这是我的drawRect中的步骤：

1.  获取当前上下文
2.  创建用于剪切视图的路径（圆形）
3.  缩放当前变换矩阵 (CTM)
4.  移动当前变换矩阵
5.  绘制CG图像

您可以预先渲染 CGImage，然后将其保存在图形内存中。如果你想要动态的东西，从头开始绘制而不是绘制 CGImage。

速度非常快，看起来很棒。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T23:29:34.050

我就是这样做的，这听起来是个不错的计划。

无论你选择 OGL 还是 CA，基本原则都是一样的，所以我会坚持你更喜欢的。

1.  确定您要放大的区域
2.  将此区域渲染到单独的表面
3.  将任何边框/叠加层渲染到表面上
4.  将放大的表面渲染到主场景上，适当地进行裁剪。

在性能方面，您将不得不尝试并查看（只需确保您在实际硬件上进行测试，因为模拟器比硬件快得多）。如果速度变慢，那么您可以考虑减少执行步骤 2/3 的频率，例如每 2-3 帧。这会产生一些放大滞后，但它可能是完全可以接受的。

我怀疑 OGL / CA 之间的性能将大致相当。CA 建立在 OGL 库之上，但您的成本将是进行实际渲染，而不是花在图层上的时间。

# windows - 在 Windows 对话框中处理 WM_ERASEBKGND 时如何避免闪烁

> ID：164751
> 
> 赞同：10
> 
> 时间：2008-10-02T21:46:21.693
> 
> 标签：windows, dialog, resize, gdi, flicker

我有一个调整大小的对话框。它还有一个自定义背景，我绘制它以响应 WM_ERASEBKGND 调用（当前是对 FillSolidRect 的简单调用）。

调整对话框大小时，会出现巨大的闪烁。为了尝试减少闪烁，我枚举了所有子窗口并将它们添加到剪切区域。这似乎有点帮助——现在闪烁在所有子控件中最明显，因为它们重新绘制。

如何在调整大小时使对话框无闪烁？我怀疑双缓冲必须发挥作用，但我不确定如何通过带有子控件的对话框来做到这一点（而不是让所有子控件都由所有者绘制或类似的东西）。

我应该注意，我使用的是 C++（不是 .NET）和 MFC，尽管欢迎纯基于 Win32 的解决方案 :)

注意：我尝试过但不起作用的一件事（不知道为什么）是：

```
CDC memDC;
memDC.CreateCompatibleDC(pDC);
memDC.FillSolidRect(rect, backgroundColor);

pDC->BitBlt(0, 0, rect.Width(), rect.Height(), &memDC, 0, 0, SRCCOPY); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-19T09:47:47.477

假设“FillSolidRect”是背景的擦除，然后从 WM_ERASEBKGND 返回 TRUE。

要执行几乎在代码片段中执行的双缓冲，您需要使用 CreateCompatibleBitmap 并将其选择到您的 memDC 中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-02T23:04:24.250

尝试将以下行添加到您的 OnInitDialog 函数：

```
 ModifyStyle(0, WS_CLIPCHILDREN, 0); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-02T22:01:05.153

在 WM_ERASEBKGND 处理中什么也不做，并将擦除作为主 WM_PAINT 的一部分。您可以更智能地绘制，以便仅重绘无效区域，或者更轻松地对绘图进行双重缓冲。

通过在擦除背景中不做任何事情，您可以将所有绘图代码放在一个位置，这应该使其他人更容易遵循和维护。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-31T20:00:59.563

如果您的目标是 WinXP 或更高版本，您还可以使用 WS_EX_COMPOSITED 样式为具有此样式的顶级窗口默认启用双缓冲。请记住，这有其自身的一组限制——特别是，不再使用 GetDC 等从 OnPaint 循环中抽出。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-02-12T09:55:13.273

您可以将调用 InvalidateRect 方法的参数设置为 false。这将阻止您在窗口重绘时发送 WM_ERASEBKGND。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-02T21:49:56.897

双缓冲确实是完成这项工作的唯一方法。

只要您确定，子控件就会自行处理`CLIPCHILDREN`。

# metadata - 最佳实践 - 元数据和功能定义数据是否应该混合使用？

> ID：164752
> 
> 赞同：1
> 
> 时间：2008-10-02T21:46:34.127
> 
> 标签：metadata

考虑一个简单的新闻文章 Web 应用程序的情况，该应用程序具有“状态”的 DB 表列，可通过以下单选按钮集访问：

状态 - [x] 发布 [] 草稿 [] 存档

...其中“发布”公开显示文章，“草稿”和“存档”不公开。从功能上讲，“草稿”和“存档”做同样的事情，但带有额外的元数据含义。“显示”和“隐藏”两种功能状态以及“发布”、“草稿”和“存档”的元数据混合在“状态”的同一列中。

这是一个好习惯吗？虽然这是一个非常简单的案例，但更大的案例可能会揭示这种做法的缺陷（或没有......）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T22:05:43.473

功能状态与行为有关——它们不需要在您的数据库中建模。如果您的业务逻辑只关心“显示”状态为“已发布”的文章 - 没有理由使用“显示”列将数据的复杂性加倍。

在您决定业务逻辑需要*额外数据*来决定是否显示或隐藏文章（可能是 IsApproved 标志）时，您可以存储该数据。

换个角度看——如果再增加一列“Show”，那么状态为“Draft”和“Show”=1的文章会怎么做？根据您的业务规则，这是一个无效状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T22:03:28.797

在这种情况下，我会说这是适当的功能。

我们都在媒体上看到过有人不小心同时点击 show[x] 和 Draft[x] 的 WTF。

就现在的样子，不可能一不小心把草稿拿出来。这在报纸上很重要，因为记者因以下内容而臭名昭著：

StackOverflow 的 John Doe 说：“---我不记得那个丑陋的混蛋说了什么——检查磁带，稍后再填写”

可能不应该打印。

# php - 如何访问数组中的最后一个元素？

> ID：164767
> 
> 赞同：1
> 
> 时间：2008-10-02T21:50:31.027
> 
> 标签：php, arrays, element

```
$array = explode(".", $row[copy]);
$a = $array.length -1; 
```

我想返回这个数组的最后一个元素，但我得到的只是-1。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-02T23:34:43.163

您还可以使用：

$a = end($array);

这也将数组内部指针设置为数组的末尾，但它确实很容易获得最后一个元素。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-02T21:55:08.943

尝试[计数](http://php.net/count)：

```
$array = explode(".", $row[copy]);
$a = count($array) - 1;
$array[$a]; // last element 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T22:12:42.893

您也可以使用[array_pop()](http://php.net/array_pop)。此函数接受一个数组，删除数组的最后一个元素并返回该元素。

```
$array = explode(".", $row[copy]);
$a = array_pop($array); 
```

这将修改 $array，删除最后一个元素，所以如果您仍然需要该数组来做某事，请不要使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T23:41:16.363

如果你只想要决赛之后的一切。你可以试试

```
$pos = strrpos($row['copy'], '.');
$str=($pos!==false) ? substr($row['copy'],$pos+1) : ''; 
```

如果您只需要最后一个元素，这将节省生成数组。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T23:46:32.560

实际上，有一个函数可以完全满足您的要求：end()

$res = end(explode('.', $row['copy']) );

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T21:54:34.670

我认为你的第二行应该更像：

```
$index = count($array) - 1;
$a = $array[$index]; 
```

如果要从数组中获取元素，则需要使用方括号。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T21:55:37.053

我的 PHP 有点生疏了，但这不应该是：

```
$array = explode(".", $row[$copy]);
$a = $array[count($array)]; 
```

即：“副本”前面不是缺少“$”，.length 真的有效吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T21:57:43.630

由于这是 PHP 的标签，我假设您使用的是 PHP，如果是这样，那么您将想要这样做：

```
$array = explode(".", $row[copy]);
$a = count($array) - 1;
$value = $array[$a]; 
```

但这仅在您的键是数字且从 0 开始时才有效。

如果您想获取数组的最后一个元素，但没有数字键或者它们不是从 0 开始，那么：

$array = explode(".", $row[copy]); $revArray = array_reverse($array, true); $value = $revArray[key($revArray)];

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-26T12:22:45.330

嗨，你也可以使用它：

$stack = 数组（“橙子”、“香蕉”、“苹果”、“覆盆子”）；$fruit = array_pop($stack); print_r($stack);

在此之后，$stack 将只有 3 个元素：

数组（ [0] => 橙色 [1] => 香蕉 [2] => 苹果）

并且覆盆子将分配给$fruit。

# windows - 如何在 Windows XP 中转发进程的 TCP/IP 流量？

> ID：164768
> 
> 赞同：2
> 
> 时间：2008-10-02T21:50:57.983
> 
> 标签：windows, proxy, tcp, forwarding, portforwarding

[替代文字 http://img440.imageshack.us/img440/6950/problemyd1.png](http://img440.imageshack.us/img440/6950/problemyd1.png)

（带点的卷线代表网络路由。）

有一个名为“foo.exe”的进程，有没有办法将它通过 TCP/IP 通信的所有内容转发到位于其他地方的转发代理？此转发不应反映到其他进程。

另一个问题：如果有多个网络适配器，是否可以强制进程使用一个特定的适配器。

由于在这个例子中 targethost.com 是已知的，我可以编辑“system32\drivers\etc\hosts”来将 targethost.com 的 IP 映射到 localhost，其中端口 8765 将是第一个等待传入连接并传递所有内容的转发器转发到 proxy.foo.com。我想知道是否有更优雅的方式来做到这一点。

这不适用于恶意软件，我正在使用复杂的家庭网络进行一些网络测试。谢谢你警告我们。

为此，一些免费软件将是完美的，或者是代码创意（本机或 .net）。非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T21:54:15.170

如果您将自己的计算机设置为防火墙，然后您的应用程序连接到您自己计算机上的端口，并且该端口被转发到原始目的地并登录或转发到您的间谍计算机，这并不难。

或者，您可以将另一台计算机设为防火墙并让它记录/转发信息。

最后，您可以使用嗅探器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T11:06:29.840

[SocksCap](http://soft.softoogle.com/ap/sockscap-download-5157.shtml)可能会完成这项工作（如果您可以在 proxy.foo.com 上建立 SOCKS 代理）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-03T22:25:15.197

您可以挂接到 TCP 堆栈，例如，通过使用 Windows 过滤平台或其前身，或者您可以替换该特定进程的网络库/调用。

# user-interface - 克服 Windows 用户对象句柄限制

> ID：164776
> 
> 赞同：4
> 
> 时间：2008-10-02T21:53:57.573
> 
> 标签：user-interface, winapi, swt

我正在寻找在构建重量级 Windows 界面时处理用户对象句柄限制的高级策略。请说明您如何使用 SWT 或直接 Windows GUI API 克服或绕过此问题。我唯一不感兴趣的是优化小部件使用的策略，因为我已经广泛地这样做了，它并没有解决问题，只会降低它的可能性。

我的情况：
我有一个基于 SWT 的 GUI，它允许在同一个父 shell 中进行多个会话，并且在每个会话中它们是 3 个单独的位置，其中显示了用户生成的评论列表。当用户打开多个会话并提取填充这些列表的数据时，用户对象句柄的数量会根据评论的数量而急剧增加。

我目前的解决方案：
1\. 默认情况下，我对评论进行分页，从而限制每个会话中的评论行数，但由于管理需求，我还有一个有效的“查看全部”按钮，它完全绕过了这一点。
2.我在每一行自定义绘制所有不可编辑的信息。这意味着每一行仅使用 2 个对象句柄。
3\. 我创建了 JNI 调用来查询操作系统的当前使用情况和最大使用情况。有了这个，我可以向用户表明即将发生崩溃。不用说，他们忽略了这个警告。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-03T12:58:16.527

首先，您确定问题不是桌面堆与句柄计数吗？每个句柄可以消耗一定数量的 Windows 桌面堆。一个 USER 句柄可能会占用很多空间，有些可能会占用很少的空间。我建议这样做是为了确保当它真的是别的东西时你不会追逐用户句柄计数。（谷歌微软的 dheapmon 工具，它可能会有所帮助）

我读过您可以通过更改注册表中的键来更改句柄的最大值：

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\ CurrentVersion\Windows\ **USERProcessHandleQuota**和**GDIProcessHandleQuota**

这可能是用户的短期修复。

我会通过首先弄清楚每个项目需要维护哪些 2 个用户句柄来解决这个问题（比如列表框中的每个项目需要 2 个？）。这似乎很可疑。[用户句柄](http://msdn.microsoft.com/en-us/library/ms725486.aspx)仅适用于少数顶级 Windows UI 对象（Windows、菜单、光标、窗口位置、***图标***等）。我不明白为什么您的小部件需要为每个项目保留 2 个对象（它是一个图标句柄吗？？）。

**如果你想把整个事情拆开——这听起来像是[虚拟模式列表视图](http://msdn.microsoft.com/en-us/library/bb774735(VS.85).aspx)（LVS_OWNERDATA）的工作。**

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T22:15:17.613

您应该考虑使用无窗口控件。它们正是为这种情况而设计的。请参阅Raymond Chen 的[“无窗口控件并不神奇”](https://devblogs.microsoft.com/oldnewthing/20050211-00/?p=36473)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-02T11:46:48.293

不仅顶级窗口，而且大多数本机控件每个都使用一个用户对象。有关用户和其他句柄类型的深入解释，请参阅[给我一个句柄，我将向您展示一个对象。](http://msdn.microsoft.com/en-us/library/ms810501.aspx)这也意味着 SWT 对每个小部件至少使用一个用户句柄，即使对于复合材料也是如此。

如果您确实达到了每个进程 10000 个用户对象的限制，并且您没有泄漏，那么您唯一的选择是减少应用程序中的小部件实例的数量。我写了[一篇](http://www.subshell.com/en/subshell/blog/index.html)关于我们如何为我们的应用程序做到这一点的博客文章。

# .net - WinForms：让我的 UI 独立于我的 BLL 层运行的实施问题？

> ID：164789
> 
> 赞同：2
> 
> 时间：2008-10-02T21:55:38.660
> 
> 标签：.net, multithreading, mvp

我正在尝试以 MVP 风格做一个 Windows 窗体应用程序 - 之前没有对线程做太多工作 - 我感到很困惑。

我的 UI 是一组非常简单的表单。每个表单都实现了一个接口并包含对位于业务逻辑层中的中介类的引用，反之亦然。所以简化图如下所示：

```
CheckInForm : ICheckIn                      <-------> CheckInMediator : ICheckInMediator
----------------------------------------------------------------------------------------
CheckInForm.Show()                          <--------
                                            --------> AttemptCheckIn(CheckInInfo)
CheckInForm.DisplayCheckInInfo(DisplayInfo) <-------- 
                                            --------> CompleteCheckIn(AdditionalCheckInInfo)
  PleaseWaitDialog.Show()                   <--------
  PleaseWaitDialog.Close()                  <--------
CheckInForm.Close()                         <-------- 
```

如您所见，中介类控制 UI，告诉它何时显示数据、启动、关闭等。它们甚至表示模式对话框何时出现以及何时关闭（即上面的 PleaseWaitDialog）。 UI 所做的是在屏幕上显示数据并将输入中继回中介。

这种架构很好且解耦，并且非常容易测试和原型化。现在我将它们放在一起，但是我开始遇到线程问题。例如，如果我希望我的 PleaseWaitDialog 在 CheckInForm 上显示为模式表单（使用 ShowDialog()），直到由中介控制的计时器计数 5 秒（请记住，这是一个简化）我会得到一个跨线程错误如果我从计时器的回调中调用 PleaseWaitDialog.Close() 。同样，如果我有一个模式对话框阻止用户与 UI 交互，我不希望它阻止业务层中的活动，除非我另有说明（例如使用确认对话框）。

我想我想做的是在主线程上运行中介和业务逻辑，在一个完全独立的线程上运行 UI，我的第一个问题是这样做有意义吗？

我的第二个问题是，我该如何做一些事情，比如让一个类在一个单独的线程中运行？我如何让两者沟通？我正在阅读 .NET 线程，但我有一个截止日期和一些示例，说明如何在主线程上生成一个包含 UI 的线程并让它们的对象相互交谈真的很有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T22:09:59.733

您是否查看过[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)类？它非常适合在后台类型程序中进行大量简化处理，并提供可以列出的事件以使您的 GUI 显示进度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T13:16:07.597

您**可以**从另一个线程操作 WinForms 控件，但是您需要使用`Control.Invoke()`，并且由于上下文切换和关联的幕后 CLR voodoo，您将为每个跨线程调用付出相当大的性能损失。

如果您想在多线程应用程序中将 GUI 与业务逻辑和基础架构代码分离，我建议切换到使用线程安全队列的消息传递模型。每次下层需要告诉 GUI 做某事时，它们都会将消息对象放入队列中，GUI 元素会通过`Forms.Timer`. 这对于大型、处理器密集型应用程序特别有效，因为您可以通过调整更新计时器频率在一定程度上限制 GUI 更新的处理需求。

对于以其他方式返回的调用（GUI -> 较低层），您可以只从 GUI 代码调用中介方法，只要这些调用相当快地返回 - 您需要非常小心延迟 GUI 线程，因为整个应用程序的响应能力将受到影响。如果您有一些难以足够快地返回的呼叫，您可以添加另一个队列。

# ms-access - 如何通过 ADO 打开 Access DB 以便我可以写入，而其他人只能读取？

> ID：164792
> 
> 赞同：2
> 
> 时间：2008-10-02T21:56:27.113
> 
> 标签：ms-access, ado

从文档中，我希望 adModeShareDenyWrite 成为方式，但它不能正常工作。

我正在通过 ADO 使用 Access 数据库。我的连接字符串显示 Mode=8，即 adModeShareDenyWrite。但是当我尝试从表中删除一行时，我得到：

未指定的错误，描述：无法从指定的表中删除。，来源：Microsoft JET 数据库引擎

换句话说，该设置阻止我使用我的 OWN 连接更新数据库。

我在网上发现了一些其他帖子报告了同样的事情，与 Access 一起使用的 adModeShareDenyWrite 设置没有按文档说明工作。

我正在寻找不涉及管理员更改权限的解决方案。它必须是我的程序可以控制的东西。

我的动机是尽量减少数据库损坏的机会。Microsoft 记录的 mdb 文件损坏的原因之一是两个应用程序写入同一个数据库。所以，我想确保只有一个应用程序可以与数据库建立写连接。其他人可以阅读，但在尝试写入时应该会失败。谁先建立联系，谁就赢了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T21:08:36.427

科里·特拉格写道：

> 我的动机是尽量减少数据库损坏的机会。Microsoft 记录的 mdb 文件损坏的原因之一是两个应用程序写入同一个数据库。所以，我想确保只有一个应用程序可以与数据库建立写连接。其他人可以阅读，但在尝试写入时应该会失败。谁先建立联系，谁就赢了。

你为什么担心它？Jet 默认是一个多用户数据库引擎。如果其他人正在更新表，则所涉及的数据页将被锁定为只读（处于写入开始之前的状态）。

没有现实的理由担心仅仅是多用户交互造成的腐败。Jet 数据库的损坏通常是由于连接断开或写入期间连接中断（例如用户强制退出响应速度不快的应用程序）。

我认为你对腐败的恐惧是错误的。

另一方面，您应该仍然可以使用独占锁打开，我不确定为什么它不起作用。您是否考虑过使用 DAO 而不是 ADO 来操作 Jet 数据？鉴于它是本机数据接口（而不是通用接口层），它应该更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T20:19:48.487

如果您有多个用户通过网络连接到 access 数据库，您可能需要考虑升级到 SqlServer 而不是使用 Access。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T19:23:36.827

科里·特拉格写道：

> 我正在寻找不涉及管理员更改权限的解决方案。它必须是我的程序可以控制的东西。

好吧，如果问题是由于 NTFS 权限对用户是只读的，那么您无法做任何事情来使 MDB 可写。您没有指定 MDB 的存储位置，在服务器上还是在本地硬盘驱动器上，但在任何一种情况下，对于具有 MDB 上的 WRITE 权限的用户，都必须设置 NTFS 权限以允许它（对于共享在服务器上，必须在 SHARE 和基础文件上都允许它）。如果它是本地文件，最好的解决方案是确保将文件存储在用户级登录具有完全 WRITE 权限的位置。这将是用户配置文件中的任何地方，几乎没有其他地方。

也就是说，我并不是真的暗示这是你问题的根源（我真的不能说一种或另一种方式），只是指出如果它*是*原因，那么你就没有什么可以做的以编程方式解决它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T22:06:52.860

一种解决方案是让他们访问数据库的副本。他们可以改变他们想要的任何东西，但它不会让你与主人一起复制它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T22:27:55.837

我想你在这里从客户端接口访问一个 MDB 文件，不管它是什么，其他人也可以同时连接到同一个文件。当您在连接模式下使用 adModeShareDenyWrite 时，这意味着您仍然可以与其他人共享数据（在 MDB 文件中的表或记录上没有任何类型的锁）但无法修改（这就是您收到错误消息的原因）。

一种解决方案是管理您的连接参数，如下所示：

```
(where you have a user object with a '.role' property, or anything equivalent ...)
if activeUser.role = "admin" then
    m_connectionMode = adModeWrite
else
    m_connectionMode = adModeShareDenyWrite
endif 
```

然后您可以使用参数 m_connectionMode 打开您的 ADO 连接。管理员将有权插入/更新/删除，而其他用户只能查看数据。这意味着您在程序中的某个地方，或者理想情况下在一个表中，有一些数据说明了您的应用程序中谁是什么。

编辑：跟随科里的多次评论：

你将无法直接做你想做的事。我的建议：当应用程序访问数据库时，它会检查 .mdb 文件夹中的特殊文件（无论文件是什么）。

如果此文件存在，应用程序会打开一个“只读”连接。

如果此文件不存在，应用程序会创建该文件（您可以使用“transferDatabase”创建一个文件）并打开一个读写连接。退出应用程序后，销毁文件。

# php - CLOS 类似于 PHP 的对象模型

> ID：164800
> 
> 赞同：4
> 
> 时间：2008-10-02T21:59:13.113
> 
> 标签：php, oop, moose, clos

我从[Moose](http://www.iinteractive.com/moose/)回到了 php 开发，我真的很想念 CLOS，比如 php 的对象模型。是否有某种语法糖可以让我在处理对象时在 php中编写**更少的代码？**

只是为了更加强调这一要求。我不想在几个地方写一件事。我可以忍受自动生成的部分代码，但是在我必须看到开发的代码中，我不想看到只是混乱的冗余信息（想想：如果你真的需要更多类比的话：LISP 宏）。因此，如果这更有意义的话，这部分也可以称为 DSL。

我希望至少有一些**角色**（mixins），以及某种**内省**，而无需重新发明轮毂。代码生成器和自动加载器可能是至少部分解决此问题的一种方法。

ps 对于 JavaScript，有[Joose](http://code.google.com/p/joose-js/)，所以类似的 API 会非常有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T06:33:12.300

php 中还没有 mixins，但是有一个 RFC 用于特性的工作大致相同。[http://wiki.php.net/rfc/traits](http://wiki.php.net/rfc/traits)

对 __call 使用重载可以让您将方法分派给其他类并让它看起来像一个 mixin。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T09:30:13.740

[Symfony 项目有一个 mixins 机制](http://www.symfony-project.org/book/1_0/17-Extending-Symfony)，允许像 CLOS 中那样面向方面的编程。就个人而言，我不喜欢用户空间空间中的这种黑客行为（至少不使用 PHP）。我认为您最好使用该语言提供的功能，并且也许等待诸如特征之类的东西（也许）进入该语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-17T21:36:08.237

还有一个新项目[http://github.com/huberry/phuby](http://github.com/huberry/phuby)在 php 中实现角色！

# c# - 如何从代码隐藏访问用户控件的公共属性？

> ID：164802
> 
> 赞同：0
> 
> 时间：2008-10-02T21:59:49.790
> 
> 标签：c#, asp.net

我在转发器中有一个用户控件，我需要在数据绑定事件期间将数据传递给它，因此我在控件中创建了两个公共属性。如何从页面的代码隐藏类访问这些属性？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T22:03:51.153

在转发器中的数据绑定事件期间？

```
MyUserControl myControl = (MyUserControl)e.item.FindControl("NameInASPX");
myControl.MyCustomProperty = foo; 
```

# netbios - NetBIOS 与 FQDN

> ID：164808
> 
> 赞同：0
> 
> 时间：2008-10-02T22:02:22.513
> 
> 标签：netbios, fqdn

我在访问网站时遇到问题，我可以使用 NetBIOS 名称访问它，但使用 FQDN 访问时出现错误。

有关如何解决此问题的任何想法？

（还没有配置DNS，我们修改了Hosts文件，输入相关的名称和IP。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-30T15:51:52.367

首先，检查显而易见的：文件中是否有任何拼写错误？

接下来，测试名称解析。一些简单的事情，比如通过它的 FQDN ping Web 服务器就可以了。看看是否提到了正确的IP。

*   如果您收到“未知主机”，您的客户端的主机文件没有您输入的 FQDN 条目（检查主机名中的拼写错误），或者由于某种原因，您的计算机没有读取您的主机文件。
*   如果您得到错误的 IP 地址，那么您的主机文件中的 IP 有误（检查 IP 地址中的拼写错误），您计算机的 DNS 缓存被污染（尝试：`ipconfig /flushdns`在 Windows 机器上），或者其他东西覆盖了查找（主机文件中的重复条目？）。

接下来，尝试与您的 Web 服务器通信。使用 Telnet，对它说 HTTP，看看它是如何响应的：

```
telnet 192.168.0.1 80 
```

替换您的 Web 服务器的 IP 地址，而不是`192.168.0.1`. 提供以下行：

```
GET / HTTP/1.1
Host: fqdn.mywebserver.com 
```

尝试使用服务器的 IP、服务器的 netbios 名称，最后使用服务器的 FQDN 代替`fqdn.mywebserver.com`. 输入主机头后一定要按*两次回车。*

如果 netbios 名称和 FQDN 之间的响应不同，则这是 Web 服务器配置问题；您需要调整虚拟主机设置（在 Apache 中，该`ServerAlias`指令应用于添加附加名称。在 IIS 中，它位于网站（选项卡）-> 高级（按钮）中）。

在那之后......我真的没有想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T01:06:58.417

假设，正如上面提到的 dragonmantank，FQDN 在您的 hosts 文件中，我会查看 Web 服务器软件本身是否配置为接受 Host 字段中带有 FQDN 的请求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T22:29:03.883

只是为了确保你有这样的东西

```
192.168.100.5 othermachine othermachine.mydomain.local 
```

其中包含 netbios 和 FQDN 而不仅仅是 IP 和 netbios 名称？

# algorithm - 如何使用众包排序对一百万张图像进行排名

> ID：164831
> 
> 赞同：83
> 
> 时间：2008-10-02T22:09:06.850
> 
> 标签：algorithm, sorting, crowdsourcing

我想通过制作一个游戏来对一组风景图像进行排名，让网站访问者可以对它们进行评分，以便找出人们认为哪些图像最吸引人。

这样做的好方法是什么？

*   **热或不风格**？即显示单个图像，要求用户从 1-10 对其进行排名。正如我所看到的，这可以让我对分数进行平均，我只需要确保我在所有图像中获得均匀分布的选票。实施起来相当简单。
*   **选择 A 或 B**吗？即显示两张图片，让用户选择更好的一张。这很有吸引力，因为没有数字排名，这只是一个比较。但是我将如何实现它？我的第一个想法是将其作为快速排序进行，比较操作由人工提供，一旦完成，只需无限重复排序即可。

你会*怎么*做？

*如果你需要数字，我说的是一百万张图片，在一个每天有 20,000 次访问的网站上。我想一小部分人可能会玩这个游戏，为了争论，假设我每天可以生成 2,000 次人类排序操作！这是一个非营利性网站，最终好奇的人会通过我的个人资料找到它:)*

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-10-02T23:05:05.187

正如其他人所说，排名 1-10 并没有那么好，因为人们有不同的级别。

**Pick A-or-B**方法的问题在于它不能保证系统是传递的（A 可以击败 B，但 B 击败 C，并且 C 击败 A）。 **使用非传递比较运算符会破坏排序算法**。使用快速排序，在此示例中，未选择作为基准的字母将被错误地相互排列。

在任何给定时间，您都希望获得所有图片的绝对排名（即使其中一些/全部是并列的）。您还希望您的排名不会改变**，除非有人投票**。

我会使用**Pick A-or-B（或平局）**方法，但确定类似于用于 2 人游戏（最初是国际象棋）排名的[Elo 评级系统的排名：](https://en.wikipedia.org/wiki/Elo_rating_system)

> Elo 球员评分系统将球员的比赛记录与对手的比赛记录进行比较，并确定球员赢得比赛的概率。这个概率因素根据每场比赛的结果决定了球员的评分上升或下降了多少分。当玩家击败评分较高的对手时，玩家的评分会比他或她击败评分较低的玩家时上升得更多（因为玩家应该击败评分较低的对手）。

**Elo系统：**

1.  所有新玩家开始时的基本评分为**1600**
2.  WinProbability = 1/(10^((对手当前评分-玩家当前评分)/400) + 1)
3.  ScoringPt = 1 分，如果他们赢了比赛，如果他们输了，0 分，平局 0.5 分。
4.  玩家新评分 = 玩家旧评分 + (K-Value * (ScoringPt–玩家获胜概率))

将“玩家”替换为图片，您就有一种简单的方法可以根据公式调整两张图片的评分。然后，您可以使用这些数字分数进行排名。（这里的 K 值是锦标赛的“级别”。小型本地锦标赛为 8-16，大型邀请赛/地区锦标赛为 24-32。您可以使用 20 之类的常数）。

使用这种方法，您只需要为每张图片保留一个数字，这比将每张图片的各个等级保持到其他图片的内存密集度要少得多。

编辑：根据评论添加了更多的肉。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-02T22:46:26.480

大多数天真的解决问题的方法都有一些严重的问题。最糟糕的是[bash.org](http://www.bash.org) 和[qdb.us](http://www.qdb.us/top)显示报价的方式 - 用户可以对报价进行向上 (+1) 或向下 (-1) 投票，最佳报价列表按总净得分排序。这受到了可怕的时间偏差的影响——旧的报价通过简单的长寿积累了大量的正面投票，即使它们只是有点幽默。如果笑话随着年龄的增长而变得更有趣，那么这个算法可能是有意义的，但是——相信我——他们没有。

有各种尝试来解决这个问题 - 查看每个时间段的正票数量，对最近的投票进行加权，对旧票实施衰减系统，计算正票与反对票的比率等。大多数都存在其他缺陷。

最好的解决方案——我认为——是网站[The Funniest](https://web.archive.org/web/20130603073646/http://thefunniest.info/) [The Cutest](http://thecutest.info/)、[The Fairest](http://thefairest.info/)和[Best Thing](http://bestthing.info/)使用的一个[改进的 Condorcet 投票系统](https://web.archive.org/web/20120705002603/http://bestthing.info/algorithms.html)：

> 系统给每个人一个数字，根据它所面临的事情，它通常击败的事情的百分比。所以每个人得到百分比分数 NumberOfThingsIBeat / (NumberOfThingsIBeat + NumberOfThingsThatBeatMe)。此外，在将它们与集合中的合理百分比进行比较之前，它们会被禁止出现在顶部列表中。
> 
> 如果集合中有一个 Condorcet 获胜者，此方法将找到它。由于这不太可能，考虑到统计性质，它会找到最接近孔多塞赢家的那个。

有关实施此类系统的更多信息，请访问[Ranked Pairs](http://en.wikipedia.org/wiki/Ranked_Pairs)上的 Wikipedia 页面。

该算法要求人们比较两个对象（您的 Pick-A-or-B 选项），但坦率地说，这是一件好事。我相信，在决策理论中，人类在比较两个对象方面比在抽象排名方面要好得多。数百万年的进化使我们擅长从树上摘下最好的苹果，但在决定我们摘下的苹果与真正的柏拉图式苹果树的紧密程度时却很糟糕。（顺便说一下，这就是为什么[层次分析过程](http://en.wikipedia.org/wiki/Analytic_Hierarchy_Process)如此出色的原因……但这有点离题了。）

[最后要说明的一点是，SO 使用一种算法来寻找最佳答案，这与bash.org](http://bash.org)寻找最佳报价的算法非常相似。它在这里运行良好，但在那里非常失败 - 很大程度上是因为这里可能会编辑一个旧的、高度评价但现在已经过时的答案。bash.org 不允许编辑，即使你可以编辑关于现在过时的网络模因的十年前笑话，也不清楚你如何去编辑......无论如何，我的观点是正确的算法通常取决于你的问题的细节。:-)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-12-16T18:06:44.180

我知道这个问题已经很老了，但我想我会做出贡献

我会看看微软研究院开发的 TrueSkill 系统。它类似于 ELO，但收敛时间要快得多（与线性相比看起来是指数型的），因此您可以从每次投票中获得更多收益。然而，它在数学上更复杂。

[http://en.wikipedia.org/wiki/TrueSkill](http://en.wikipedia.org/wiki/TrueSkill)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-02T22:20:04.060

我不喜欢**Hot-or-Not 风格**。即使他们都喜欢完全相同的图像，不同的人也会选择不同的数字。我也讨厌满分 10 分，我永远不知道该选择哪个数字。

**Pick A-or-B**更加简单有趣。您可以看到两张图片，并在网站上的图片之间进行比较。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-24T13:42:48.240

这些来自[Wikipedia](http://en.wikipedia.org/wiki/Elo_rating_system)的方程式使得计算 Elo 评级变得更简单/更有效，图像 A 和 B 的算法很简单：

*   从您的数据库中获取 Ne、mA、mB 和额定值 RA、RB。
*   使用执行的比较次数 (Ne) 和比较图像的次数 (m) 和当前评级计算 KA、KB、QA、QB：

![ķ](https://upload.wikimedia.org/math/6/4/9/649faf9fa677faa81f14a8543b823f37.png)

![质量保证](https://upload.wikimedia.org/math/d/c/9/dc9a6f0ad70b86ed17cfd64cfa37b922.png)

![QB](https://upload.wikimedia.org/math/c/5/e/c5e734efd10fa149568386835828074c.png)

*   计算 EA 和 EB。

![EA](https://upload.wikimedia.org/math/c/2/e/c2eecfeb247543d45ced6cc8871cfd97.png)

![EB](https://upload.wikimedia.org/math/2/2/2/2222eecc1f0a611e7a3f158a6ffa9139.png)

*   对胜者的 S 打分：胜者为 1，负者为 0，如果平局为 0.5，
*   使用以下方法计算两者的新评级： ![新评级](https://upload.wikimedia.org/math/2/3/f/23fbcb658ac1e2565003c2190f28a21e.png)

*   更新数据库中的新评级 RA,RB 和计数 mA,mB。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-02T22:14:47.553

您可能想要组合使用。

第一阶段：Hot-or-not 风格（尽管我会选择 3 个选项投票：糟透了，Meh/OK。酷！）

将集合分类到 3 个桶中后，我会从同一个桶中选择两个图像，然后选择“哪个更好”

然后，您可以使用英式足球的晋级和降级系统将前几名“糟糕”移动到 Meh/OK 区域，以优化边缘情况。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-02T22:26:04.717

排名1-10是行不通的，每个人的等级不一样。总是给出 3-7 分的人的排名会被总是给出 1 或 10 分的人所掩盖。

a-or-b 更可行。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-03-05T05:26:52.830

哇，我游戏迟到了。

我非常喜欢 ELO 系统，但就像欧文所说的那样，在我看来，你会慢慢建立任何重要的结果。

我相信人类比仅仅比较两张图像有更大的能力，但你希望将交互保持在最低限度。

那么您如何显示 n 个图像（n 是您可以在屏幕上明显显示的任何数字，这可能是 10、20、30，具体取决于用户的偏好）并让他们选择他们认为最好的那个。现在回到 ELO。你需要修改你的评级系统，但要保持同样的精神。实际上，您已经将一张图像与其他 n-1 张图像进行了比较。所以你做你的ELO评级n-1次，但你应该将评级的变化除以n-1来匹配（这样不同n值的结果相互一致）。

你完成了。你现在拥有了世界上最好的。一个简单的评级系统，一键处理许多图像。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-05-17T03:01:03.677

如果您更喜欢使用选择 A 或 B 策略，我会推荐这篇论文：[http ://research.microsoft.com/en-us/um/people/horvitz/crowd_pairwise.pdf](http://research.microsoft.com/en-us/um/people/horvitz/crowd_pairwise.pdf)

> Chen, X.、Bennett, PN、Collins-Thompson, K. 和 Horvitz, E.（2013 年 2 月）。众包环境中的成对排名聚合。在第六届 ACM 网络搜索和数据挖掘国际会议论文集上（第 193-202 页）。ACM。

该论文讲述了将著名的 Bradley-Terry 成对比较模型扩展到众包设置的*Crowd-BT模型。*它还给出了一种自适应学习算法，以提高模型的时间和空间效率。[您可以在Github](https://github.com/DmitryUlyanov/Pairwise-Ranking-Aggregation)上找到该算法的 Matlab 实现（但我不确定它是否有效）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-19T06:36:10.387

已停业的网站 whatsbetter.com 使用了[Elo 风格的方法](https://en.wikipedia.org/wiki/Elo_rating_system)。[您可以在 Internet Archive 上的常见问题解答](https://web.archive.org/web/20050305040452/http://www.whatsbetter.com/faq.pyt)中阅读有关该方法的信息。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T22:27:51.453

**选择 A-or-B**是最简单且不易产生偏见的，但是在每次人际互动中，它给您的信息会大大减少。我认为由于减少了偏差，Pick 更出色，并且在有限的范围内它为您提供了相同的信息。

一个非常简单的评分方案是对每张图片进行计数。当有人给出肯定比较时，增加计数，当有人给出否定比较时，减少计数。

对 100 万个整数列表进行排序非常快，在现代计算机上只需不到一秒钟的时间。

也就是说，这个问题是相当不合适的——你需要 50 天的时间才能将每张图像显示一次。

我敢打赌，尽管您对排名最高的图像更感兴趣？因此，您可能希望通过预测排名来偏向您的图像检索 - 因此您更有可能显示已经实现一些正面比较的图像。这样，您将更快地开始显示“有趣”的图像。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-07T17:04:13.937

我喜欢快速排序选项，但我会花几个星期：

*   将“比较”结果保存在数据库中，然后对它们进行平均。
*   通过为用户提供 4-6 张图像并让他们对它们进行排序，每次查看获得不止一个比较。
*   通过运行 qsort 并记录和修剪您没有足够数据的任何内容来选择要显示的图像。然后当你记录了足够的项目时，吐出一页。

另一个有趣的选择是使用人群来教授神经网络。

# visual-studio - 在 Visual Studio 2005 和 VS2008 中创建项目失败

> ID：164839
> 
> 赞同：0
> 
> 时间：2008-10-02T22:12:16.187
> 
> 标签：visual-studio, visual-studio-2008

每次我尝试在 Visual Studio（2005 和 2008）中创建新项目或解决方案时，都会收到一条错误消息，提示“项目创建失败”。我什至尝试在管理模式下运行 vs，但我仍然得到相同的答案。除了卸载所有VS并重新安装它之外，任何人都有任何建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T22:16:27.673

这听起来像是一个表现不佳的加载项。你能在安全模式下启动它吗？

```
devenv.exe /SafeMode 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T22:49:08.517

如果您在管理员模式下运行，然后单击以管理员身份运行并且拥有所有最新更新且没有加载项，我认为您可能需要重新安装它。确保您选择了您计划用于获取 sdk 的所有开发类型，而不仅仅是可再发行组件。

如果这不起作用，您可以与微软代表交谈。通过一些快速的在线研究，人们在 Visual Studio SP1 之前真的只有这样的问题，64 位 Vista 的任何东西都无法编译 ASP。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T22:17:02.307

出乎意料的是，我会猜测是安全/权利问题，例如。尝试在您没有写入权限或具有其他受限权限的驱动器/文件夹上创建解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T22:20:01.753

是在 Vista 中吗，我知道 2005 在 Vista 中存在兼容性问题，不知道 2008 的情况，但它们都有最新的更新吗？

# vim - 你的 .vimrc 中有什么？

> ID：164847
> 
> 赞同：157
> 
> 时间：2008-10-02T22:14:18.833
> 
> 标签：vim, refactoring

Vi 和 Vim 允许非常棒的自定义，通常存储在`.vimrc`文件中。程序员的典型功能是语法高亮、智能缩进等。

**你还有什么其他的高效编程技巧，隐藏在你的 .vimrc 中？**

我最感兴趣的是重构、自动类和类似的生产力宏，尤其是对于 C#。

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-10-05T05:57:56.637

你自找的 ：-）

```
"{{{Auto Commands

" Automatically cd into the directory that the file is in
autocmd BufEnter * execute "chdir ".escape(expand("%:p:h"), ' ')

" Remove any trailing whitespace that is in the file
autocmd BufRead,BufWrite * if ! &bin | silent! %s/\s\+$//ge | endif

" Restore cursor position to where it was before
augroup JumpCursorOnEdit
   au!
   autocmd BufReadPost *
            \ if expand("<afile>:p:h") !=? $TEMP |
            \   if line("'\"") > 1 && line("'\"") <= line("$") |
            \     let JumpCursorOnEdit_foo = line("'\"") |
            \     let b:doopenfold = 1 |
            \     if (foldlevel(JumpCursorOnEdit_foo) > foldlevel(JumpCursorOnEdit_foo - 1)) |
            \        let JumpCursorOnEdit_foo = JumpCursorOnEdit_foo - 1 |
            \        let b:doopenfold = 2 |
            \     endif |
            \     exe JumpCursorOnEdit_foo |
            \   endif |
            \ endif
   " Need to postpone using "zv" until after reading the modelines.
   autocmd BufWinEnter *
            \ if exists("b:doopenfold") |
            \   exe "normal zv" |
            \   if(b:doopenfold > 1) |
            \       exe  "+".1 |
            \   endif |
            \   unlet b:doopenfold |
            \ endif
augroup END

"}}}

"{{{Misc Settings

" Necesary  for lots of cool vim things
set nocompatible

" This shows what you are typing as a command.  I love this!
set showcmd

" Folding Stuffs
set foldmethod=marker

" Needed for Syntax Highlighting and stuff
filetype on
filetype plugin on
syntax enable
set grepprg=grep\ -nH\ $*

" Who doesn't like autoindent?
set autoindent

" Spaces are better than a tab character
set expandtab
set smarttab

" Who wants an 8 character tab?  Not me!
set shiftwidth=3
set softtabstop=3

" Use english for spellchecking, but don't spellcheck by default
if version >= 700
   set spl=en spell
   set nospell
endif

" Real men use gcc
"compiler gcc

" Cool tab completion stuff
set wildmenu
set wildmode=list:longest,full

" Enable mouse support in console
set mouse=a

" Got backspace?
set backspace=2

" Line Numbers PWN!
set number

" Ignoring case is a fun trick
set ignorecase

" And so is Artificial Intellegence!
set smartcase

" This is totally awesome - remap jj to escape in insert mode.  You'll never type jj anyway, so it's great!
inoremap jj <Esc>

nnoremap JJJJ <Nop>

" Incremental searching is sexy
set incsearch

" Highlight things that we find with the search
set hlsearch

" Since I use linux, I want this
let g:clipbrdDefaultReg = '+'

" When I close a tab, remove the buffer
set nohidden

" Set off the other paren
highlight MatchParen ctermbg=4
" }}}

"{{{Look and Feel

" Favorite Color Scheme
if has("gui_running")
   colorscheme inkpot
   " Remove Toolbar
   set guioptions-=T
   "Terminus is AWESOME
   set guifont=Terminus\ 9
else
   colorscheme metacosm
endif

"Status line gnarliness
set laststatus=2
set statusline=%F%m%r%h%w\ (%{&ff}){%Y}\ [%l,%v][%p%%]

" }}}

"{{{ Functions

"{{{ Open URL in browser

function! Browser ()
   let line = getline (".")
   let line = matchstr (line, "http[^   ]*")
   exec "!konqueror ".line
endfunction

"}}}

"{{{Theme Rotating
let themeindex=0
function! RotateColorTheme()
   let y = -1
   while y == -1
      let colorstring = "inkpot#ron#blue#elflord#evening#koehler#murphy#pablo#desert#torte#"
      let x = match( colorstring, "#", g:themeindex )
      let y = match( colorstring, "#", x + 1 )
      let g:themeindex = x + 1
      if y == -1
         let g:themeindex = 0
      else
         let themestring = strpart(colorstring, x + 1, y - x - 1)
         return ":colorscheme ".themestring
      endif
   endwhile
endfunction
" }}}

"{{{ Paste Toggle
let paste_mode = 0 " 0 = normal, 1 = paste

func! Paste_on_off()
   if g:paste_mode == 0
      set paste
      let g:paste_mode = 1
   else
      set nopaste
      let g:paste_mode = 0
   endif
   return
endfunc
"}}}

"{{{ Todo List Mode

function! TodoListMode()
   e ~/.todo.otl
   Calendar
   wincmd l
   set foldlevel=1
   tabnew ~/.notes.txt
   tabfirst
   " or 'norm! zMzr'
endfunction

"}}}

"}}}

"{{{ Mappings

" Open Url on this line with the browser \w
map <Leader>w :call Browser ()<CR>

" Open the Project Plugin <F2>
nnoremap <silent> <F2> :Project<CR>

" Open the Project Plugin
nnoremap <silent> <Leader>pal  :Project .vimproject<CR>

" TODO Mode
nnoremap <silent> <Leader>todo :execute TodoListMode()<CR>

" Open the TagList Plugin <F3>
nnoremap <silent> <F3> :Tlist<CR>

" Next Tab
nnoremap <silent> <C-Right> :tabnext<CR>

" Previous Tab
nnoremap <silent> <C-Left> :tabprevious<CR>

" New Tab
nnoremap <silent> <C-t> :tabnew<CR>

" Rotate Color Scheme <F8>
nnoremap <silent> <F8> :execute RotateColorTheme()<CR>

" DOS is for fools.
nnoremap <silent> <F9> :%s/$//g<CR>:%s// /g<CR>

" Paste Mode!  Dang! <F10>
nnoremap <silent> <F10> :call Paste_on_off()<CR>
set pastetoggle=<F10>

" Edit vimrc \ev
nnoremap <silent> <Leader>ev :tabnew<CR>:e ~/.vimrc<CR>

" Edit gvimrc \gv
nnoremap <silent> <Leader>gv :tabnew<CR>:e ~/.gvimrc<CR>

" Up and down are more logical with g..
nnoremap <silent> k gk
nnoremap <silent> j gj
inoremap <silent> <Up> <Esc>gka
inoremap <silent> <Down> <Esc>gja

" Good call Benjie (r for i)
nnoremap <silent> <Home> i <Esc>r
nnoremap <silent> <End> a <Esc>r

" Create Blank Newlines and stay in Normal mode
nnoremap <silent> zj o<Esc>
nnoremap <silent> zk O<Esc>

" Space will toggle folds!
nnoremap <space> za

" Search mappings: These will make it so that going to the next one in a
" search will center on the line it's found in.
map N Nzz
map n nzz

" Testing
set completeopt=longest,menuone,preview

inoremap <expr> <cr> pumvisible() ? "\<c-y>" : "\<c-g>u\<cr>"
inoremap <expr> <c-n> pumvisible() ? "\<lt>c-n>" : "\<lt>c-n>\<lt>c-r>=pumvisible() ? \"\\<lt>down>\" : \"\"\<lt>cr>"
inoremap <expr> <m-;> pumvisible() ? "\<lt>c-n>" : "\<lt>c-x>\<lt>c-o>\<lt>c-n>\<lt>c-p>\<lt>c-r>=pumvisible() ? \"\\<lt>down>\" : \"\"\<lt>cr>"

" Swap ; and :  Convenient.
nnoremap ; :
nnoremap : ;

" Fix email paragraphs
nnoremap <leader>par :%s/^>$//<CR>

"ly$O#{{{ "lpjjj_%A#}}}jjzajj

"}}}

"{{{Taglist configuration
let Tlist_Use_Right_Window = 1
let Tlist_Enable_Fold_Column = 0
let Tlist_Exit_OnlyWindow = 1
let Tlist_Use_SingleClick = 1
let Tlist_Inc_Winwidth = 0
"}}}

let g:rct_completion_use_fri = 1
"let g:Tex_DefaultTargetFormat = "pdf"
let g:Tex_ViewRule_pdf = "kpdf"

filetype plugin indent on
syntax on 
```

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-10-02T22:17:21.510

这不在我的 .vimrc 文件中，但昨天我了解了该`]p`命令。这就像粘贴缓冲区的内容一样`p`，但它会自动调整缩进以匹配光标所在的行！这非常适合移动代码。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-10-02T22:17:22.803

我使用以下内容将所有临时文件和备份文件保存在一个地方：

```
set backup
set backupdir=~/.vim/backup
set directory=~/.vim/tmp 
```

将杂乱无章的工作目录保存在各处。

您必须先创建这些目录，vim**不会**为您创建它们。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2009-03-17T00:23:50.367

上面发布的某人（即弗鲁）有这行：

“自动 cd 进入文件所在的目录：”

```
autocmd BufEnter * execute "chdir ".escape(expand("%:p:h"), ' ') 
```

我自己也在做类似的事情，直到我发现可以通过内置设置完成同样的事情：

```
set autochdir 
```

我认为类似的事情发生在我身上好几次了。Vim 有很多不同的内置设置和选项，有时自己动手做比在文档中搜索内置方法更快、更容易。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-01-24T11:40:48.033

我的最新添加是为了**突出显示当前行**

```
set cul                                           # highlight current line
hi CursorLine term=none cterm=none ctermbg=3      # adjust color 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2009-08-02T15:43:34.117

**2012 年更新**：我现在真的建议查看[vim-powerline](https://github.com/Lokaltog/vim-powerline)，它已经取代了我的旧状态行脚本，尽管目前缺少一些我错过的功能。

* * *

我想说[我的 vimrc](https://github.com/gaving/dotfiles/blob/master/.vimrc)中的状态行内容可能是最有趣/最有用的（从[这里](http://github.com/scrooloose/vimfiles/blob/52b9810195dc571a87eb8ef6af5ae821184b1baa/vimrc)的作者 vimrc和相应的博客文章中[摘录](http://got-ravings.blogspot.com/2009/07/vim-pr0n-combating-long-lines.html)）。

截屏：

[状态行 http://img34.imageshack.us/img34/849/statusline.png](http://img34.imageshack.us/img34/849/statusline.png)

代码：

```
"recalculate the trailing whitespace warning when idle, and after saving
autocmd cursorhold,bufwritepost * unlet! b:statusline_trailing_space_warning

"return '[\s]' if trailing white space is detected
"return '' otherwise
function! StatuslineTrailingSpaceWarning()
    if !exists("b:statusline_trailing_space_warning")

        if !&modifiable
            let b:statusline_trailing_space_warning = ''
            return b:statusline_trailing_space_warning
        endif

        if search('\s\+$', 'nw') != 0
            let b:statusline_trailing_space_warning = '[\s]'
        else
            let b:statusline_trailing_space_warning = ''
        endif
    endif
    return b:statusline_trailing_space_warning
endfunction

"return the syntax highlight group under the cursor ''
function! StatuslineCurrentHighlight()
    let name = synIDattr(synID(line('.'),col('.'),1),'name')
    if name == ''
        return ''
    else
        return '[' . name . ']'
    endif
endfunction

"recalculate the tab warning flag when idle and after writing
autocmd cursorhold,bufwritepost * unlet! b:statusline_tab_warning

"return '[&et]' if &et is set wrong
"return '[mixed-indenting]' if spaces and tabs are used to indent
"return an empty string if everything is fine
function! StatuslineTabWarning()
    if !exists("b:statusline_tab_warning")
        let b:statusline_tab_warning = ''

        if !&modifiable
            return b:statusline_tab_warning
        endif

        let tabs = search('^\t', 'nw') != 0

        "find spaces that arent used as alignment in the first indent column
        let spaces = search('^ \{' . &ts . ',}[^\t]', 'nw') != 0

        if tabs && spaces
            let b:statusline_tab_warning = '[mixed-indenting]'
        elseif (spaces && !&et) || (tabs && &et)
            let b:statusline_tab_warning = '[&et]'
        endif
    endif
    return b:statusline_tab_warning
endfunction

"recalculate the long line warning when idle and after saving
autocmd cursorhold,bufwritepost * unlet! b:statusline_long_line_warning

"return a warning for "long lines" where "long" is either &textwidth or 80 (if
"no &textwidth is set)
"
"return '' if no long lines
"return '[#x,my,$z] if long lines are found, were x is the number of long
"lines, y is the median length of the long lines and z is the length of the
"longest line
function! StatuslineLongLineWarning()
    if !exists("b:statusline_long_line_warning")

        if !&modifiable
            let b:statusline_long_line_warning = ''
            return b:statusline_long_line_warning
        endif

        let long_line_lens = s:LongLines()

        if len(long_line_lens) > 0
            let b:statusline_long_line_warning = "[" .
                        \ '#' . len(long_line_lens) . "," .
                        \ 'm' . s:Median(long_line_lens) . "," .
                        \ '$' . max(long_line_lens) . "]"
        else
            let b:statusline_long_line_warning = ""
        endif
    endif
    return b:statusline_long_line_warning
endfunction

"return a list containing the lengths of the long lines in this buffer
function! s:LongLines()
    let threshold = (&tw ? &tw : 80)
    let spaces = repeat(" ", &ts)

    let long_line_lens = []

    let i = 1
    while i <= line("$")
        let len = strlen(substitute(getline(i), '\t', spaces, 'g'))
        if len > threshold
            call add(long_line_lens, len)
        endif
        let i += 1
    endwhile

    return long_line_lens
endfunction

"find the median of the given array of numbers
function! s:Median(nums)
    let nums = sort(a:nums)
    let l = len(nums)

    if l % 2 == 1
        let i = (l-1) / 2
        return nums[i]
    else
        return (nums[l/2] + nums[(l/2)-1]) / 2
    endif
endfunction

"statusline setup
set statusline=%f "tail of the filename

"display a warning if fileformat isnt unix
set statusline+=%#warningmsg#
set statusline+=%{&ff!='unix'?'['.&ff.']':''}
set statusline+=%*

"display a warning if file encoding isnt utf-8
set statusline+=%#warningmsg#
set statusline+=%{(&fenc!='utf-8'&&&fenc!='')?'['.&fenc.']':''}
set statusline+=%*

set statusline+=%h "help file flag
set statusline+=%y "filetype
set statusline+=%r "read only flag
set statusline+=%m "modified flag

"display a warning if &et is wrong, or we have mixed-indenting
set statusline+=%#error#
set statusline+=%{StatuslineTabWarning()}
set statusline+=%*

set statusline+=%{StatuslineTrailingSpaceWarning()}

set statusline+=%{StatuslineLongLineWarning()}

set statusline+=%#warningmsg#
set statusline+=%{SyntasticStatuslineFlag()}
set statusline+=%*

"display a warning if &paste is set
set statusline+=%#error#
set statusline+=%{&paste?'[paste]':''}
set statusline+=%*

set statusline+=%= "left/right separator

function! SlSpace()
    if exists("*GetSpaceMovement")
        return "[" . GetSpaceMovement() . "]"
    else
        return ""
    endif
endfunc
set statusline+=%{SlSpace()}

set statusline+=%{StatuslineCurrentHighlight()}\ \ "current highlight
set statusline+=%c, "cursor column
set statusline+=%l/%L "cursor line/total lines
set statusline+=\ %P "percent through file
set laststatus=2 
```

除其他外，它会在状态行上通知通常的标准文件信息，但还包括其他内容，例如 :set paste、混合缩进、尾随空格等的警告。如果您对代码格式特别感兴趣，这将非常有用。

此外，如屏幕截图所示，将其与 [syntastic](http://github.com/scrooloose/syntastic/tree/master)结合使用可以突出显示任何语法错误（假设您选择的语言捆绑了相关的语法检查器。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2009-03-16T23:30:03.070

我的迷你版：

```
syntax on
set background=dark
set shiftwidth=2
set tabstop=2

if has("autocmd")
  filetype plugin indent on
endif

set showcmd             " Show (partial) command in status line.
set showmatch           " Show matching brackets.
set ignorecase          " Do case insensitive matching
set smartcase           " Do smart case matching
set incsearch           " Incremental search
set hidden              " Hide buffers when they are abandoned 
```

大版本，从各个地方收集：

```
syntax on
set background=dark
set ruler                     " show the line number on the bar
set more                      " use more prompt
set autoread                  " watch for file changes
set number                    " line numbers
set hidden
set noautowrite               " don't automagically write on :next
set lazyredraw                " don't redraw when don't have to
set showmode
set showcmd
set nocompatible              " vim, not vi
set autoindent smartindent    " auto/smart indent
set smarttab                  " tab and backspace are smart
set tabstop=2                 " 6 spaces
set shiftwidth=2
set scrolloff=5               " keep at least 5 lines above/below
set sidescrolloff=5           " keep at least 5 lines left/right
set history=200
set backspace=indent,eol,start
set linebreak
set cmdheight=2               " command line two lines high
set undolevels=1000           " 1000 undos
set updatecount=100           " switch every 100 chars
set complete=.,w,b,u,U,t,i,d  " do lots of scanning on tab completion
set ttyfast                   " we have a fast terminal
set noerrorbells              " No error bells please
set shell=bash
set fileformats=unix
set ff=unix
filetype on                   " Enable filetype detection
filetype indent on            " Enable filetype-specific indenting
filetype plugin on            " Enable filetype-specific plugins
set wildmode=longest:full
set wildmenu                  " menu has tab completion
let maplocalleader=','        " all my macros start with ,
set laststatus=2

"  searching
set incsearch                 " incremental search
set ignorecase                " search ignoring case
set hlsearch                  " highlight the search
set showmatch                 " show matching bracket
set diffopt=filler,iwhite     " ignore all whitespace and sync

"  backup
set backup
set backupdir=~/.vim_backup
set viminfo=%100,'100,/100,h,\"500,:100,n~/.viminfo
"set viminfo='100,f1

" spelling
if v:version >= 700
  " Enable spell check for text files
  autocmd BufNewFile,BufRead *.txt setlocal spell spelllang=en
endif

" mappings
" toggle list mode
nmap <LocalLeader>tl :set list!<cr>
" toggle paste mode
nmap <LocalLeader>pp :set paste!<cr> 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2009-08-18T19:40:59.010

有时最简单的东西是最有价值的。我的 .vimrc 中完全不可缺少的两行：

```
诺尔；：
诺尔, ;

```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-10-03T00:46:14.600

杂项。设置：

1.  关闭烦人的错误铃声：

    ```
    set noerrorbells
    set visualbell
    set t_vb= 
    ```

2.  使用换行使光标按预期移动：

    ```
    inoremap <Down> <C-o>gj
    inoremap <Up> <C-o>gk 
    ```

3.  在目录中查找`ctags`“标签”文件，直到找到一个：

    ```
    set tags=tags;/ 
    ```

4.  使用 Python 语法显示 SCons 文件：

    ```
    autocmd BufReadPre,BufNewFile SConstruct set filetype=python
    autocmd BufReadPre,BufNewFile SConscript set filetype=python 
    ```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-10-28T19:04:04.577

我的大量评论 vimrc，带有 readline-esque (emacs) 键绑定：

```
if version >= 700

"------ Meta ------"

" clear all autocommands! (this comment must be on its own line)
autocmd!

set nocompatible                " break away from old vi compatibility
set fileformats=unix,dos,mac    " support all three newline formats
set viminfo=                    " don't use or save viminfo files

"------ Console UI & Text display ------"

set cmdheight=1                 " explicitly set the height of the command line
set showcmd                     " Show (partial) command in status line.
set number                      " yay line numbers
set ruler                       " show current position at bottom
set noerrorbells                " don't whine
set visualbell t_vb=            " and don't make faces
set lazyredraw                  " don't redraw while in macros
set scrolloff=5                 " keep at least 5 lines around the cursor
set wrap                        " soft wrap long lines
set list                        " show invisible characters
set listchars=tab:>·,trail:·    " but only show tabs and trailing whitespace
set report=0                    " report back on all changes
set shortmess=atI               " shorten messages and don't show intro
set wildmenu                    " turn on wild menu :e <Tab>
set wildmode=list:longest       " set wildmenu to list choice
if has('syntax')
    syntax on
    " Remember that rxvt-unicode has 88 colors by default; enable this only if
    " you are using the 256-color patch
    if &term == 'rxvt-unicode'
        set t_Co=256
    endif

    if &t_Co == 256
        colorscheme xoria256
    else
        colorscheme peachpuff
    endif
endif

"------ Text editing and searching behavior ------"

set nohlsearch                  " turn off highlighting for searched expressions
set incsearch                   " highlight as we search however
set matchtime=5                 " blink matching chars for .x seconds
set mouse=a                     " try to use a mouse in the console (wimp!)
set ignorecase                  " set case insensitivity
set smartcase                   " unless there's a capital letter
set completeopt=menu,longest,preview " more autocomplete <Ctrl>-P options
set nostartofline               " leave my cursor position alone!
set backspace=2                 " equiv to :set backspace=indent,eol,start
set textwidth=80                " we like 80 columns
set showmatch                   " show matching brackets
set formatoptions=tcrql         " t - autowrap to textwidth
                                " c - autowrap comments to textwidth
                                " r - autoinsert comment leader with <Enter>
                                " q - allow formatting of comments with :gq
                                " l - don't format already long lines

"------ Indents and tabs ------"

set autoindent                  " set the cursor at same indent as line above
set smartindent                 " try to be smart about indenting (C-style)
set expandtab                   " expand <Tab>s with spaces; death to tabs!
set shiftwidth=4                " spaces for each step of (auto)indent
set softtabstop=4               " set virtual tab stop (compat for 8-wide tabs)
set tabstop=8                   " for proper display of files with tabs
set shiftround                  " always round indents to multiple of shiftwidth
set copyindent                  " use existing indents for new indents
set preserveindent              " save as much indent structure as possible
filetype plugin indent on       " load filetype plugins and indent settings

"------ Key bindings ------"

" Remap broken meta-keys that send ^[
for n in range(97,122) " ASCII a-z
    let c = nr2char(n)
    exec "set <M-". c .">=\e". c
    exec "map  \e". c ." <M-". c .">"
    exec "map! \e". c ." <M-". c .">"
endfor

""" Emacs keybindings
" first move the window command because we'll be taking it over
noremap <C-x> <C-w>
" Movement left/right
noremap! <C-b> <Left>
noremap! <C-f> <Right>
" word left/right
noremap  <M-b> b
noremap! <M-b> <C-o>b
noremap  <M-f> w
noremap! <M-f> <C-o>w
" line start/end
noremap  <C-a> ^
noremap! <C-a> <Esc>I
noremap  <C-e> $
noremap! <C-e> <Esc>A
" Rubout word / line and enter insert mode
noremap  <C-w> i<C-w>
noremap  <C-u> i<C-u>
" Forward delete char / word / line and enter insert mode
noremap! <C-d> <C-o>x
noremap  <M-d> dw
noremap! <M-d> <C-o>dw
noremap  <C-k> Da
noremap! <C-k> <C-o>D
" Undo / Redo and enter normal mode
noremap  <C-_> u
noremap! <C-_> <C-o>u<Esc><Right>
noremap! <C-r> <C-o><C-r><Esc>

" Remap <C-space> to word completion
noremap! <Nul> <C-n>

" OS X paste (pretty poor implementation)
if has('mac')
    noremap  √ :r!pbpaste<CR>
    noremap! √ <Esc>√
endif

""" screen.vim REPL: http://github.com/ervandew/vimfiles
" send paragraph to parallel process
vmap <C-c><C-c> :ScreenSend<CR>
nmap <C-c><C-c> mCvip<C-c><C-c>`C
imap <C-c><C-c> <Esc><C-c><C-c><Right>
" set shell region height
let g:ScreenShellHeight = 12

"------ Filetypes ------"

" Vimscript
autocmd FileType vim setlocal expandtab shiftwidth=4 tabstop=8 softtabstop=4

" Shell
autocmd FileType sh setlocal expandtab shiftwidth=4 tabstop=8 softtabstop=4

" Lisp
autocmd Filetype lisp,scheme setlocal equalprg=~/.vim/bin/lispindent.lisp expandtab shiftwidth=2 tabstop=8 softtabstop=2

" Ruby
autocmd FileType ruby setlocal expandtab shiftwidth=2 tabstop=2 softtabstop=2

" PHP
autocmd FileType php setlocal expandtab shiftwidth=4 tabstop=4 softtabstop=4

" X?HTML & XML
autocmd FileType html,xhtml,xml setlocal expandtab shiftwidth=2 tabstop=2 softtabstop=2

" CSS
autocmd FileType css setlocal expandtab shiftwidth=4 tabstop=4 softtabstop=4

" JavaScript
" autocmd BufRead,BufNewFile *.json setfiletype javascript
autocmd FileType javascript setlocal expandtab shiftwidth=2 tabstop=2 softtabstop=2
let javascript_enable_domhtmlcss=1

"------ END VIM-500 ------"

endif " version >= 500 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-11-02T21:59:07.300

我不是世界上最先进的 vim'er，但这里有一些我捡到的

```
function! Mosh_Tab_Or_Complete()
    if col('.')>1 && strpart( getline('.'), col('.')-2, 3 ) =~ '^\w'
        return "\<C-N>"
    else
        return "\<Tab>"
endfunction

inoremap <Tab> <C-R>=Mosh_Tab_Or_Complete()<CR> 
```

使制表符自动完成功能确定您是要在此处放置一个单词还是一个实际的制表符（4 个空格）。

```
map cc :.,$s/^ *//<CR> 
```

删除从此处到文件末尾的所有打开空格。出于某种原因，我发现这很有用。

```
set nu! 
set nobackup 
```

显示行号，不要创建那些烦人的备份文件。无论如何，我从来没有从旧备份中恢复过任何东西。

```
imap ii <C-[> 
```

在插入时，按两次 i 进入命令模式。我从来没有遇到过连续有 2 个 i 的单词或变量，这样我就不必让我的手指离开主行或按多个键来回切换。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-10-28T12:31:20.333

```
syntax on
set cindent
set ts=4
set sw=4
set backspace=2
set laststatus=2
set nohlsearch
set modeline
set modelines=3
set ai
map Q gq

set vb t_vb=

set nowrap
set ss=5
set is
set scs
set ru

map <F2> <Esc>:w<CR>
map! <F2> <Esc>:w<CR>

map <F10> <Esc>:qa<CR>
map! <F10> <Esc>:qa<CR>

map <F9>  <Esc>:wqa<CR>
map! <F9>  <Esc>:wqa<CR>

inoremap <s-up> <Esc><c-w>W<Ins>
inoremap <s-down> <Esc><c-w>w<Ins>

nnoremap <s-up> <c-w>W
nnoremap <s-down> <c-w>w

" Fancy middle-line <CR>
inoremap <C-CR> <Esc>o
nnoremap <C-CR> o

" This is the way I like my quotation marks and various braces
inoremap '' ''<Left>
inoremap "" ""<Left>
inoremap () ()<Left>
inoremap <> <><Left>
inoremap {} {}<Left>
inoremap [] []<Left>
inoremap () ()<Left>

" Quickly set comma or semicolon at the end of the string
inoremap ,, <End>,
inoremap ;; <End>;
au FileType python inoremap :: <End>:

au FileType perl,python set foldlevel=0
au FileType perl,python set foldcolumn=4
au FileType perl,python set fen
au FileType perl        set fdm=syntax
au FileType python      set fdm=indent
au FileType perl,python set fdn=4
au FileType perl,python set fml=10
au FileType perl,python set fdo=block,hor,mark,percent,quickfix,search,tag,undo,search

au FileType perl,python abbr sefl self
au FileType perl abbr sjoft shift
au FileType perl abbr DUmper Dumper

function! ToggleNumberRow()
       if !exists("g:NumberRow") || 0 == g:NumberRow
               let g:NumberRow = 1
               call ReverseNumberRow()
       else
               let g:NumberRow = 0
               call NormalizeNumberRow()
       endif
endfunction

" Reverse the number row characters
function! ReverseNumberRow()
       " map each number to its shift-key character
       inoremap 1 !
       inoremap 2 @
       inoremap 3 #
       inoremap 4 $
       inoremap 5 %
       inoremap 6 ^
       inoremap 7 &
       inoremap 8 *
       inoremap 9 (
       inoremap 0 )
       inoremap - _
    inoremap 90 ()<Left>
       " and then the opposite
       inoremap ! 1
       inoremap @ 2
       inoremap # 3
       inoremap $ 4
       inoremap % 5
       inoremap ^ 6
       inoremap & 7
       inoremap * 8
       inoremap ( 9
       inoremap ) 0
       inoremap _ -
endfunction

" DO the opposite to ReverseNumberRow -- give everything back
function! NormalizeNumberRow()
       iunmap 1
       iunmap 2
       iunmap 3
       iunmap 4
       iunmap 5
       iunmap 6
       iunmap 7
       iunmap 8
       iunmap 9
       iunmap 0
       iunmap -
       "------
       iunmap !
       iunmap @
       iunmap #
       iunmap $
       iunmap %
       iunmap ^
       iunmap &
       iunmap *
       iunmap (
       iunmap )
       iunmap _
       inoremap () ()<Left>
endfunction

"call ToggleNumberRow()
nnoremap <M-n> :call ToggleNumberRow()<CR>

" Add use <CWORD> at the top of the file
function! UseWord(word)
       let spec_cases = {'Dumper': 'Data::Dumper'}
       let my_word = a:word
       if has_key(spec_cases, my_word)
               let my_word = spec_cases[my_word]
       endif

       let was_used = search("^use.*" . my_word, "bw")

       if was_used > 0
               echo "Used already"
               return 0
       endif

       let last_use = search("^use", "bW")
       if 0 == last_use
               last_use = search("^package", "bW")
               if 0 == last_use
                       last_use = 1
               endif
       endif

       let use_string = "use " . my_word . ";"
       let res = append(last_use, use_string)
       return 1
endfunction

function! UseCWord()
       let cline = line(".")
       let ccol = col(".")
       let ch = UseWord(expand("<cword>"))
       normal mu
       call cursor(cline + ch, ccol)

endfunction

function! GetWords(pattern)
       let cline = line(".")
       let ccol = col(".")
       call cursor(1,1)

       let temp_dict = {}
       let cpos = searchpos(a:pattern)
       while cpos[0] != 0
               let temp_dict[expand("<cword>")] = 1
               let cpos = searchpos(a:pattern, 'W')
       endwhile

       call cursor(cline, ccol)
       return keys(temp_dict)
endfunction

" Append the list of words, that match the pattern after cursor
function! AppendWordsLike(pattern)
       let word_list = sort(GetWords(a:pattern))
       call append(line("."), word_list)
endfunction

nnoremap <F7>  :call UseCWord()<CR>

" Useful to mark some code lines as debug statements
function! MarkDebug()
       let cline = line(".")
       let ctext = getline(cline)
       call setline(cline, ctext . "##_DEBUG_")
endfunction

" Easily remove debug statements
function! RemoveDebug()
       %g/#_DEBUG_/d
endfunction

au FileType perl,python inoremap <M-d> <Esc>:call MarkDebug()<CR><Ins>
au FileType perl,python inoremap <F6> <Esc>:call RemoveDebug()<CR><Ins>
au FileType perl,python nnoremap <F6> :call RemoveDebug()<CR>

" end Perl settings

nnoremap <silent> <F8> :TlistToggle<CR>
inoremap <silent> <F8> <Esc>:TlistToggle<CR><Esc>

function! AlwaysCD()
       if bufname("") !~ "^scp://" && bufname("") !~ "^sftp://" && bufname("") !~ "^ftp://"
               lcd %:p:h
       endif
endfunction
autocmd BufEnter * call AlwaysCD()

function! DeleteRedundantSpaces()
       let cline = line(".")
       let ccol = col(".")
       silent! %s/\s\+$//g
       call cursor(cline, ccol)
endfunction
au BufWrite * call DeleteRedundantSpaces()

set nobackup
set nowritebackup
set cul

colorscheme evening

autocmd FileType python set formatoptions=wcrq2l
autocmd FileType python set inc="^\s*from"
autocmd FileType python so /usr/share/vim/vim72/indent/python.vim

autocmd FileType c      set si
autocmd FileType mail   set noai
autocmd FileType mail   set ts=3
autocmd FileType mail   set tw=78
autocmd FileType mail   set shiftwidth=3
autocmd FileType mail   set expandtab
autocmd FileType xslt   set ts=4
autocmd FileType xslt   set shiftwidth=4
autocmd FileType txt    set ts=3
autocmd FileType txt    set tw=78
autocmd FileType txt    set expandtab

" Move cursor together with the screen
noremap <c-j> j<c-e>
noremap <c-k> k<c-y>

" Better Marks
nnoremap ' ` 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-10-03T12:44:37.817

一些常见拼写错误的修复为我节省了惊人的时间：

```
:command WQ wq
:command Wq wq
:command W w
:command Q q

iab anf and
iab adn and
iab ans and
iab teh the
iab thre there 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-09-24T21:11:27.670

我的 242 行`.vimrc`并不是那么有趣，但由于没有人提到它，我觉得我必须分享两个最重要的映射，它们除了默认映射之外增强了我的工作流程：

```
map <C-j> :bprev<CR>
map <C-k> :bnext<CR>
set hidden " this will go along 
```

说真的，切换缓冲区是经常要做**的事情。**Windows，当然，但一切都不太适合屏幕。

用于快速浏览错误（见 quickfix）和 grep 结果的类似地图集：

```
map <C-n> :cn<CR>
map <C-m> :cp<CR> 
```

简单、轻松、高效。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-10-20T20:03:55.380

我没有意识到我的 3200 条 .vimrc 行中有多少只是为了满足我的古怪需求，在这里列出来会很无聊。但也许这就是 Vim 如此有用的原因......

```
iab AlP ABCDEFGHIJKLMNOPQRSTUVWXYZ
iab MoN January February March April May June July August September October November December
iab MoO Jan Feb Mar Apr May Jun Jul Aug Sep Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
iab NuM 12345678901234567890123456789012345678901234567890123456789012345678901234567890 
iab RuL ----+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0

" Highlight every other line
map ,<Tab> :set hls<CR>/\\n.*\\n/<CR>

" This is for working across multiple xterms and/or gvims
" Transfer/read and write one block of text between vim sessions (capture whole line):
" Write
nmap ;w :. w! ~/.vimxfer<CR>
" Read
nmap ;r :r ~/.vimxfer<CR>
" Append 
nmap ;a :. w! >>~/.vimxfer<CR> 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-10-02T22:24:02.570

```
 set nobackup 
set nocp
set tabstop=4
set shiftwidth=4
set et
set ignorecase

set ai
set ruler
set showcmd
set incsearch
set dir=$temp       " Make swap live in the %TEMP% directory
syn on

" Load the color scheme
colo inkpot 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-10-03T00:38:28.330

我在 vim 中使用 cscope（充分利用了多个缓冲区）。我使用 control-K 来启动大部分命令（我记得是从 ctags 偷来的）。另外，我已经生成了 .cscope.out 文件。

如果有（“cscope”）

```
set cscopeprg=/usr/local/bin/cscope
set cscopetagorder=0
set cscopetag
set cscopepathcomp=3
set nocscopeverbose
cs add .cscope.out
set csverb

"
" cscope find
"
" 0 or s: Find this C symbol
" 1 or d: Find this definition
" 2 or g: Find functions called by this function
" 3 or c: Find functions calling this function
" 4 or t: Find assignments to
" 6 or e: Find this egrep pattern
" 7 or f: Find this file
" 8 or i: Find files #including this file
" 
map ^Ks     :cs find 0 <C-R>=expand("<cword>")<CR><CR>
map ^Kd     :cs find 1 <C-R>=expand("<cword>")<CR><CR>
map ^Kg     :cs find 2 <C-R>=expand("<cword>")<CR><CR>
map ^Kc     :cs find 3 <C-R>=expand("<cword>")<CR><CR>
map ^Kt     :cs find 4 <C-R>=expand("<cword>")<CR><CR>
map ^Ke     :cs find 6 <C-R>=expand("<cword>")<CR><CR>
map ^Kf     :cs find 7 <C-R>=expand("<cfile>")<CR><CR>
map ^Ki     :cs find 8 <C-R>=expand("%")<CR><CR> 
```

万一

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-10-03T00:56:24.187

我将 vimrc 文件保存在 github 上。你可以在这里找到它：

[http://github.com/developernotes/vim-setup/tree/master](http://github.com/developernotes/vim-setup/tree/master)

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-10-02T22:56:10.917

```
map = }{!}fmt^M}
map + }{!}fmt -p '> '^M}
set showmatch 
```

= 用于重新格式化普通段落。+ 用于重新格式化引用电子邮件中的段落。showmatch 用于在我键入右括号或括号时闪烁匹配的括号/括号。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2011-08-20T23:28:52.210

把它放在你的 vimrc 中：

```
imap <C-l> <Space>=><Space> 
```

并且永远不要考虑再次输入 hashrocket。是的，我知道你不需要在 Ruby 1.9 中。但别介意。

我的完整 vimrc 在[这里](https://github.com/dpoggi/dotvim/blob/master/vimrc)。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-10-02T22:22:18.330

我在 OS X 上，所以其中一些在其他平台上可能有更好的默认值，但无论如何：

```
syntax on
set tabstop=4
set expandtab
set shiftwidth=4 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2008-10-03T00:43:52.373

使用目录树中第一个可用的“标签”文件：

```
:set tags=tags;/ 
```

left 和 right 用于切换缓冲区，不移动光标：

```
map <right> <ESC>:bn<RETURN>
map <left> <ESC>:bp<RETURN> 
```

使用单个按键禁用搜索突出显示：

```
map - :nohls<cr> 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2009-10-28T12:37:19.670

```
set tabstop=4 softtabstop=4 shiftwidth=4 expandtab autoindent cindent 
set encoding=utf-8 fileencoding=utf-8
set nobackup nowritebackup noswapfile autoread
set number
set hlsearch incsearch ignorecase smartcase

if has("gui_running")
    set lines=35 columns=140
    colorscheme ir_black
else
    colorscheme darkblue
endif

" bash like auto-completion
set wildmenu
set wildmode=list:longest

inoremap <C-j> <Esc>

" for lusty explorer
noremap glr \lr
noremap glf \lf
noremap glb \lb

" use ctrl-h/j/k/l to switch between splits
map <c-j> <c-w>j
map <c-k> <c-w>k
map <c-l> <c-w>l
map <c-h> <c-w>h

" Nerd tree stuff
let NERDTreeIgnore = ['\.pyc$', '\.pyo$']
noremap gn :NERDTree<Cr>

" cd to the current file's directory
noremap gc :lcd %:h<Cr> 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-10-02T23:16:44.237

我试图让[我的 .vimrc](http://www.pixelbeat.org/settings/.vimrc "我的.vimrc")尽可能普遍有用。

一个方便的技巧是 .gpg 文件的处理程序可以安全地编辑它们：

```
au BufNewFile,BufReadPre *.gpg :set secure vimi= noswap noback nowriteback hist=0 binary
au BufReadPost *.gpg :%!gpg -d 2>/dev/null
au BufWritePre *.gpg :%!gpg -e -r 'name@email.com' 2>/dev/null
au BufWritePost *.gpg u 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-10-02T22:41:10.267

[在我的 .vimrc](http://code.google.com/p/lh-vim/source/browse#svn/misc/trunk)中实际上并没有多少内容（即使它有 850 行）。主要是设置和一些我懒得提取到插件中的常见和简单的映射。

如果您的意思是“自动类”中的“模板文件”，我使用的是[模板扩展插件](http://code.google.com/p/lh-vim/wiki/muTemplate)——在同一个站点上，您会找到我为 C&C++ 编辑定义的 ftplugins，有些可能适用于C# 我猜。

[关于重构方面，http: //vim.wikia.com](http://vim.wikia.com)上有专门针对此主题的提示；IIRC 示例代码适用于 C#。它启发了我一个仍然需要大量工作的[重构插件](http://code.google.com/p/lh-vim/wiki/lhRefactor)（实际上需要重构）。

你应该看看 vim mailing-list 的档案，特别是关于使用 vim 作为有效 IDE 的主题。不要忘记查看 :make, tags, ...

高温下，

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2008-10-03T12:25:55.263

1) 我喜欢状态行（带有文件名、ascii 值（十进制）、十六进制值和标准行、cols 和 %）：

```
set statusline=%t%h%m%r%=[%b\ 0x%02B]\ \ \ %l,%c%V\ %P
" Always show a status line
set laststatus=2
"make the command line 1 line high
set cmdheight=1 
```

2）我也喜欢拆分窗口的映射。

```
" <space> switches to the next window (give it a second)
" <space>n switches to the next window
" <space><space> switches to the next window and maximizes it
" <space>= Equalizes the size of all windows
" + Increases the size of the current window
" - Decreases the size of the current window

 :map <space> <c-W>w
:map <space>n <c-W>w
:map <space><space> <c-W>w<c-W>_
:map <space>= <c-W>=
if bufwinnr(1)
  map + <c-W>+
  map - <c-W>-
endif 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2008-10-02T22:43:48.543

好吧，你必须自己清理我的[配置](http://github.com/adimit/config)。玩得开心。大多数情况下，这只是我想要的设置，包括映射和随机语法相关的东西，以及折叠设置和一些插件配置、tex 编译解析器等。

顺便说一句，我发现非常有用的是“突出显示光标下的单词”：

```
 highlight flicker cterm=bold ctermfg=white
 au CursorMoved <buffer> exe 'match flicker /\V\<'.escape(expand('<cword>'), '/').'\>/' 
```

请注意，只有`cterm`and`termfg`被使用，因为我不使用`gvim`. 如果您希望它起作用，`gvim`只需分别用`gui`和替换它们`guifg`。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-08-02T15:49:35.287

我的 .vimrc 包括（以及其他更有用的东西）以下行：

```
set statusline=%2*%n\|%<%*%-.40F%2*\|\ %2*%M\ %3*%=%1*\ %1*%2.6l%2*x%1*%1.9(%c%V%)%2*[%1*%P%2*]%1*%2B 
```

我在为高中期末学习而感到无聊。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2011-08-20T23:10:34.253

My .vimrc is [available on Github](https://github.com/mikl/dotfiles/blob/master/vimrc). Lots of small tweaks and handy bindings in there :)

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2009-11-01T02:01:46.313

我的 .vimrc 和 .bashrc 以及我的整个 .vim 文件夹（包含所有插件）可在以下网址找到： [http](http://code.google.com/p/pal-nix/) ://code.google.com/p/pal-nix/ 。

这是我的 .vimrc 供快速查看：

```
 " .vimrc 
"
" $Author$
" $Date$
" $Revision$ 

" * Initial Configuration * {{{1 "
" change directory on open file, buffer switch etc. {{{2
set autochdir

" turn on filetype detection and indentation {{{2
filetype indent plugin on

" set tags file to search in parent directories with tags; {{{2
set tags=tags;

" reload vimrc on update  {{{2
autocmd BufWritePost .vimrc source %

" set folds to look for markers {{{2
:set foldmethod=marker

" automatically save view and reload folds {{{2
"au BufWinLeave * mkview
"au BufWinEnter * silent loadview

" behave like windows {{{2
"source $VIMRUNTIME/mswin.vim " can't use  if on (use with gvim only)
"behave mswin

" load dictionary files for complete suggestion with Ctrl-n {{{2
set complete+=k
autocmd FileType * exec('set dictionary+=~/.vim/dict/' . &filetype)

" * User Interface * {{{1 "
" turn on coloring {{{2
if has('syntax')
    syntax on
endif

" gvim color scheme of choice {{{2
if has('gui')
    so $VIMRUNTIME/colors/desert.vim
endif

" turn off annoying bell {{{2
set vb

" set the directory for swp files {{{2
if(isdirectory(expand("$VIMRUNTIME/swp")))
    set dir=$VIMRUNTIME/swp
endif

" have fifty lines of cmdline (etc) history {{{2
set history=50

" have cmdline completion  (for filenames, help topics, option names) {{{2
" first list the available options and complete the longest common part, then
" have further s cycle through the possibilities:
set wildmode=list:longest,full

" use "[RO]" for "[readonly]" to save space in the message line: {{{2
set shortmess+=r

" display current mode and partially typed commands in status line  {{{2
set showmode
set showcmd

" Text Formatting -- General  {{{2
set nocompatible     "prevents vim from emulating vi's original bugs
set backspace=2      "make backspace work normal (indent, eol, start)
set autoindent
set smartindent      "makes vim smartly guess indent level
set tabstop=2        "sets up 2 space tabs
set shiftwidth=2     "tells vim to use 2 spaces when text is indented
set smarttab         "uses shiftwidth for inserting s
set expandtab        "insert spaces instead of 
set softtabstop=2    "makes vim see multiple space characters as tabstops
set showmatch        "causes cursor to jump to bracket match
set mat=5            "how many tenths of a second to blink matches
set guioptions-=T    "removes toolbar from gvim
set ruler            "ensures each window contains a status line
set incsearch        "vim will search for text as you type
set hlsearch         "highlight search terms
set hl=l:Visual      "use Visual mode's highlighting scheme --much better
set ignorecase       "ignore case in searches --faster this way
set virtualedit=all  "allows the cursor to stray beyond defined text
set number           "show line numbers in left margin
set path=$PWD/**     "recursively set the path of the project
                     "get more information from the status line 
set statusline=[%n]\ %<%.99f\ %h%w%m%r%{exists('*CapsLockStatusline')?CapsLockStatusline():''}%y%=%-16(\ %l,%c-%v\ %)%P
set laststatus=2     "keep status line showing
set cursorline       "highlight current line
highlight CursorLine guibg=lightblue guifg=white ctermbg=blue ctermfg=white
"set spell          "spell check
set spellsuggest=3  "suggest better spelling
set spelllang=en    "set language
set encoding=utf-8  "set character encoding

" * Macros * {{{1 "
" Function keys {{{2
" Don't you always find yourself hitting  instead of ? {{{3
inoremap  
noremap   

" turn off syntax highlighting {{{3
nnoremap   :nohlsearch
inoremap   :nohlsearcha

" NERD Tree Explorer {{{3
nnoremap   :NERDTreeToggle 

" open tag list {{{3
nnoremap   :TlistToggle

" Spell check {{{3
nnoremap   :set spell

" No spell check {{{3
nnoremap   :set nospell

" refactor curly braces on keyword line {{{3
map  :%s/) \?\n^\s*{/) {/g

" useful mappings to paste and reformat/reindent {{{2
nnoremap  P P'[v']=
nnoremap  p P'[v']=

" * Scripts * {{{1 "
:au Filetype html,xml,xsl source ~/.vim/scripts/closetag.vim

" Modeline {{{1
" vim:set fdm=marker sw=4 ts=4: 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-03-31T19:22:01.577

行号和语法高亮。

```
set number
syntax on 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2008-11-02T20:57:59.327

What's in my `.vimrc`?

```
ngn@macavity:~$ cat .vimrc
" This file intentionally left blank 
```

The real config files lie under `~/.vim/ :)`

And most of the stuff there is parasiting on other people's efforts, blatantly adapted from `vim.org` to my editing advantage.

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2008-10-20T19:41:33.833

这是我的.vimrc。我使用 Gvim 7.2

```
set guioptions=em
set showtabline=2
set softtabstop=2
set shiftwidth=2
set tabstop=2

" Use spaces instead of tabs
set expandtab
set autoindent

" Colors and fonts
colorscheme inkpot
set guifont=Consolas:h11:cANSI

"TAB navigation like firefox
:nmap <C-S-tab> :tabprevious<cr>
:nmap <C-tab> :tabnext<cr>
:imap <C-S-tab> <ESC>:tabprevious<cr>i
:imap <C-tab> <ESC>:tabnext<cr>i
:nmap <C-t> :tabnew<cr>
:imap <C-t> <ESC>:tabnew<cr>i
:map <C-w> :tabclose<cr>

" No Backups and line numbers
set nobackup
set number
set nuw=6

" swp files are saved to %Temp% folder
set dir=$temp
" sets the default size of gvim on open
set lines=40 columns=90 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2010-10-06T11:03:06.590

我不能没有这条线，通常首先出现在我的`.vimrc`：

```
" prevent switch to Replece mode if <Insert> pressed in insert mode
imap <Insert> <Nop> 
```

我不能没有的另一点是在点击 PgDown/PgUp 时保留当前行：

```
map <silent> <PageUp> 1000<C-U>
map <silent> <PageDown> 1000<C-D>
imap <silent> <PageUp> <C-O>1000<C-U>
imap <silent> <PageDown> <C-O>1000<C-D>
set nostartofline 
```

禁用烦人的匹配括号突出显示：

```
set noshowmatch
let loaded_matchparen = 1 
```

编辑大 (>4MB) 文件时禁用语法突出显示：

```
au BufReadPost *        if getfsize(bufname("%")) > 4*1024*1024 |
\                               set syntax= |
\                       endif 
```

最后[是我的简单在线计算器](http://vimrc-dissection.blogspot.com/2010/05/vim-inline-calculator.html)：

```
function CalcX(line_num)
        let l = getline(a:line_num)
        let expr = substitute( l, " *=.*$","","" )
        exec ":let g:tmp_calcx = ".expr
        call setline(a:line_num, expr." = ".g:tmp_calcx)
endfunction
:map <silent> <F11> :call CalcX(".")<CR> 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2009-10-28T18:52:23.930

这是我不起眼的.vimrc。这是一项正在进行的工作（应该一直如此），所以请原谅凌乱的布局和注释掉的行。

```
" =====Key mapping
" Insert empty line.
nmap <A-o> o<ESC>k
nmap <A-O> O<ESC>j
" Insert one character.
nmap <A-i> i <Esc>r
nmap <A-a> a <Esc>r
" Move on display lines in normal and visual mode.
nnoremap j gj
nnoremap k gk
vnoremap j gj
vnoremap k gk
" Do not lose * register when pasting on visual selection.
vmap p "zxP
" Clear highlight search results with <esc>
nnoremap <esc> :noh<return><esc>
" Center screen on next/previous selection.
map n nzz
map N Nzz
" <Esc> with jj.
inoremap jj <Esc>
" Switch jump to mark.
nnoremap ' `
nnoremap ` '
" Last and next jump should center too.
nnoremap <C-o> <C-o>zz
nnoremap <C-i> <C-i>zz
" Paste on new line.
nnoremap <A-p> :pu<CR>
nnoremap <A-S-p> :pu!<CR>
" Quick paste on insert mode.
inoremap <C-F> <C-R>"
" Indent cursor on empty line.
nnoremap <A-c> ddO
nnoremap <leader>c ddO
" Save and quit quickly.
nnoremap <leader>s :w<CR>
nnoremap <leader>q :q<CR>
nnoremap <leader>Q :q!<CR>
" The way it should have been.
noremap Y y$
" Moving in buffers.
nnoremap <C-S-tab> :bprev<CR>
nnoremap <C-tab> :bnext<CR>
" Using bufkill plugin.
nnoremap <leader>b :BD<CR>
nnoremap <leader>B :BD!<CR>
nnoremap <leader>ZZ :w<CR>:BD<CR>
" Moving and resizing in windows.
nnoremap + <C-W>+
nnoremap _ <C-W>-
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l
nnoremap <leader>w <C-w>c
" Moving in tabs
noremap <c-right> gt
noremap <c-left> gT
nnoremap <leader>t :tabc<CR>
" Moving around in insert mode.
inoremap <A-j> <C-O>gj
inoremap <A-k> <C-O>gk
inoremap <A-h> <Left>
inoremap <A-l> <Right>

" =====General options
" I copy a lot from external apps.
set clipboard=unnamed
" Don't let swap and backup files fill my working directory.
set backupdir=c:\\temp,.    " Backup files
set directory=c:\\temp,.    " Swap files
set nocompatible
set showmatch
set hidden
set showcmd                     " This shows what you are typing as a command.
set scrolloff=3
" Allow backspacing over everything in insert mode
set backspace=indent,eol,start
" Syntax highlight
syntax on                           
filetype plugin on
filetype indent on

" =====Searching
set ignorecase
set hlsearch
set incsearch

" =====Indentation settings
" autoindent just copies the indentation from the line above.
"set autoindent
" smartindent automatically inserts one extra level of indentation in some cases.
set smartindent
" cindent is more customizable, but also more strict.
"set cindent
set tabstop=4
set shiftwidth=4

" =====GUI options.
" Just Vim without any gui.
set guioptions-=m
set guioptions-=T
set lines=40
set columns=150
" Consolas is better, but Courier new is everywhere.
"set guifont=Courier\ New:h9
set guifont=Consolas:h9
" Cool status line.
set statusline=%<%1*===\ %5*%f%1*%(\ ===\ %4*%h%1*%)%(\ ===\ %4*%m%1*%)%(\ ===\ %4*%r%1*%)\ ===%====\ %2*%b(0x%B)%1*\ ===\ %3*%l,%c%V%1*\ ===\ %5*%P%1*\ ===%0* laststatus=2
colorscheme mildblack
let g:sienna_style = 'dark'

" =====Plugins

" ===BufPos
nnoremap <leader>ob :call BufWipeout()<CR>
" ===SuperTab
" Map SuperTab to space key.
let g:SuperTabMappingForward = '<c-space>'
let g:SuperTabMappingBackward = '<s-c-space>'
let g:SuperTabDefaultCompletionType = 'context'
" ===miniBufExpl
" let g:miniBufExplMapWindowNavVim = 1
" let g:miniBufExplMapCTabSwitchBufs = 1
" let g:miniBufExplorerMoreThanOne = 0
" ===AutoClose
" let g:AutoClosePairs = {'(': ')', '{': '}', '[': ']', '"': '"', "'": "'"}
" ===NERDTree
nnoremap <leader>n :NERDTreeToggle<CR>
" ===delimitMate
let delimitMate = "(:),[:],{:}" 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2010-09-10T21:55:50.897

当我不带参数启动 gVim 时，我希望它在我的“项目”目录中打开，这样我就可以做`:find`等。但是，当我用文件启动它时，我不希望它切换目录，我希望它保留就在那里（部分是为了打开我想要打开的文件！）。

```
if argc() == 0
   cd $PROJECT_DIR
endif 
```

为了可以`:find`从当前项目中的任何文件中使用，我设置了查找目录树的路径，直到它找到`src`或`scripts`下降到那些目录树，至少直到它找到`c:\work`我所有项目的根目录。这允许我在一个非当前项目中打开文件（即`PROJECT_DIR`上面指定了一个不同的目录）。

```
set path+=src/**;c:/work,scripts/**;c:/work 
```

这样我就可以在 gVim 失去焦点时自动保存和重新加载，并退出插入模式，以及在编辑只读文件时从 Perforce 自动签出......

```
augroup AutoSaveGroup
    autocmd!
    autocmd FocusLost       *.cpp,*.h,*.cs,*.rad*,Jam*,*.py,*.bat,*.mel    wa
    autocmd FileChangedRO   *.cpp,*.h,*.cs,*.rad*,Jam*,*.py,*.bat,*.mel    silent !p4 edit %:p
    autocmd FileChangedRO   *.cpp,*.h,*.cs,*.rad*,Jam*,*.py,*.bat,*.mel    w!
augroup END

augroup OutOfInsert
    autocmd!
    autocmd FocusLost * call feedkeys("\<C-\>\<C-N>")
augroup END 
```

最后，切换到当前缓冲区中文件的目录，以便于该目录中的`:e`其他文件。

```
augroup MiscellaneousTomStuff
    autocmd!
    " make up for the deficiencies in 'autochdir'
    autocmd BufEnter * silent! lcd %:p:h:gs/ /\\ /
augroup END 
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2010-11-16T23:22:49.067

```
 " insert change log in files
    fun! InsertChangeLog()
    let l:flag=0
    for i in range(1,5)
        if getline(i) !~ '.*Last Change.*'
            let l:flag = l:flag + 1
        endif
    endfor
    if l:flag >= 5
        normal(1G)
        call append(0, "File: <+Description+>")
        call append(1, "Created: " . strftime("%a %d/%b/%Y hs %H:%M"))
        call append(2, "Last Change: " . strftime("%a %d/%b/%Y hs %H:%M"))
        call append(3, "author: <+your name+>")
        call append(4, "site: <+site+>")
        call append(5, "twitter: <+your twitter here+>")
        normal gg
    endif
endfun
map <special> <F4> <esc>:call InsertChangeLog()<cr>

" update changefile log
" http://tech.groups.yahoo.com/group/vim/message/51005
fun! LastChange()
    let _s=@/
    let l = line(".")
    let c = col(".")
    if line("$") >= 5
        1,5s/\s*Last Change:\s*\zs.*/\="" . strftime("%Y %b %d %X")/ge
    endif
    let @/=_s
    call cursor(l, c)
endfun
autocmd BufWritePre * keepjumps call LastChange()

    function! JumpToNextPlaceholder()
    let old_query = getreg('/')
    echo search("<+.\\++>")
    exec "norm! c/+>/e\<CR>"
    call setreg('/', old_query)
endfunction
autocmd BufNewFile * :call LoadFileTemplate()
nnoremap <special> <leader>j :call JumpToNextPlaceholder()<CR>a
inoremap <special> <leader>j <ESC>:call JumpToNextPlaceholder()<CR>a

" Cientific calculator
command! -nargs=+ Calc :py print <args>
py from math import *
map ,c :Calc

set statusline=%F%m%r%h%w\
\ ft:%{&ft}\ \
\ff:%{&ff}\ \
\%{strftime(\"%a\ %d/%m/%Y\ \
\%H:%M:%S\",getftime(expand(\"%:p\")))}%=\ \
\buf:%n\ \
\L:%04l\ C:%04v\ \
\T:%04L\ HEX:%03.3B\ ASCII:%03.3b\ %P
set laststatus=2 " Always show statusline 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2009-11-29T23:54:52.713

return、backspace、spacebar 和 hyphen 键没有绑定到任何有用的东西，所以我映射它们以便更方便地浏览文档：

```
" Page down, page up, scroll down, scroll up
noremap <Space> <C-f>
noremap - <C-b>
noremap <Backspace> <C-y>
noremap <Return> <C-e> 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2009-10-29T07:35:19.523

几乎一切都[在这里](http://code.google.com/p/lh-vim/)。它主要面向编程，尤其是 C++。

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2011-03-20T11:10:29.570

这不在我的 .vimrc 中，但与其相关。

在你的 .bashrc 添加这一行 `alias :q=exit`

令人惊讶的是我已经使用了多少，有时甚至没有意识到！

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2010-10-20T12:49:51.587

我用的比较多的两个函数是占位符跳转文件和InsertChangeLog()，共同“方便创建文件，描述更友好

```
" place holders snippets
" File Templates
" --------------
"  <leader>j jumps to the next marker
" iabbr <buffer> for for <+i+> in <+intervalo+>:<cr><tab><+i+>
function! LoadFileTemplate()
    "silent! 0r ~/.vim/templates/%:e.tmpl
    syn match vimTemplateMarker "<+.\++>" containedin=ALL
    hi vimTemplateMarker guifg=#67a42c guibg=#112300 gui=bold
endfunction
function! JumpToNextPlaceholder()
    let old_query = getreg('/')
    echo search("<+.\\++>")
    exec "norm! c/+>/e\<CR>"
    call setreg('/', old_query)
endfunction
autocmd BufNewFile * :call LoadFileTemplate()
nnoremap <leader>j :call JumpToNextPlaceholder()<CR>a
inoremap <leader>j <ESC>:call JumpToNextPlaceholder()<CR>a

fun! InsertChangeLog()
    normal(1G)
    call append(0, "Arquivo: <+Description+>")
    call append(1, "Criado: " . strftime("%a %d/%b/%Y hs %H:%M"))
    call append(2, "Last Change: " . strftime("%a %d/%b/%Y hs %H:%M"))
    call append(3, "autor: <+digite seu nome+>")
    call append(4, "site: <+digite o endereço de seu site+>")
    call append(5, "twitter: <+your twitter here+>")
    normal gg
endfun 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2011-03-14T01:14:25.433

我的（非常定制的）vimrc 可能太长，无法在此处发布，所以我将仅链接到它：

[https://github.com/majutsushi/etc/blob/master/vim/.vimrc](https://github.com/majutsushi/etc/blob/master/vim/.vimrc)

里面有一些有用的花絮，我要么自己写，要么在状态栏之类的地方捡到，里面有我觉得有用的各种信息。我写的这个插件的网站上有一个截图：

[http://majutsushi.github.com/tagbar/](http://majutsushi.github.com/tagbar/)

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2008-10-09T04:48:12.377

[我的 .vimrc](http://media.camronflanders.com/.vimrc)。我的单词交换功能通常很受欢迎。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2008-12-15T18:38:49.523

```
set guifont=FreeMono\ 12

colorscheme default

set nocompatible
set backspace=indent,eol,start
set nobackup "do not keep a backup file, use versions instead
set history=10000 "keep 10000 lines of command line history
set ruler "show the cursor position all the time
set showcmd "display incomplete commands
set showmode
set showmatch
set nojoinspaces "do not insert a space, when joining lines
set whichwrap="" "do not jump to the next line when deleting
"set nowrap
filetype plugin indent on
syntax enable
set hlsearch
set incsearch "do incremental searching
set autoindent
set noexpandtab
set tabstop=4
set shiftwidth=4
set number
set laststatus=2
set visualbell "do not beep
set tabpagemax=100
set statusline=%F\ %h%m%r%=%l/%L\ \(%-03p%%\)\ %-03c\ 

"use listmode to make tabs visible and make them gray so they are not
"disctrating too much
set listchars=tab:»\ ,eol:¬,trail:.
highlight NonText ctermfg=gray guifg=gray
highlight SpecialKey ctermfg=gray guifg=gray
highlight clear MatchParen
highlight MatchParen cterm=bold
set list

match Todo /@todo/ "highlight doxygen todos

"different tabbing settings for different file types
if has("autocmd")
    autocmd FileType c setlocal tabstop=4 softtabstop=4 shiftwidth=4 expandtab
    autocmd FileType cpp setlocal tabstop=4 softtabstop=4 shiftwidth=4 expandtab
    autocmd FileType go setlocal tabstop=4 softtabstop=4 shiftwidth=4 noexpandtab
    autocmd FileType make setlocal tabstop=4 softtabstop=4 shiftwidth=4 noexpandtab
    autocmd FileType python setlocal tabstop=4 softtabstop=4 shiftwidth=4 noexpandtab

    " doesnt work properly -- revise me
    autocmd CursorMoved * call RonnyHighlightWordUnderCursor()
    autocmd CursorMovedI * call RonnyHighlightWordUnderCursor()

    "jump to the end of the file if it is a logfile
    autocmd BufReadPost *.log normal G

    autocmd BufRead,BufNewFile *.go set filetype=go
endif

highlight Search ctermfg=white ctermbg=gray
highlight IncSearch ctermfg=white ctermbg=gray
highlight RonnyWordUnderCursorHighlight cterm=bold

function! RonnyHighlightWordUnderCursor()
python << endpython
import vim

# get the character under the cursor
row, col = vim.current.window.cursor
characterUnderCursor = ''
try:
    characterUnderCursor = vim.current.buffer[row-1][col]
except:
    pass

# remove last search
vim.command("match RonnyWordUnderCursorHighlight //")

# if the cursor is currently located on a real word, move on and highlight it
if characterUnderCursor.isalpha() or characterUnderCursor.isdigit() or characterUnderCursor is '_':

    # expand cword to get the word under the cursor
    wordUnderCursor = vim.eval("expand(\'<cword>\')")
    if wordUnderCursor is None :
        wordUnderCursor = ""

    # escape the word
    wordUnderCursor = vim.eval("RonnyEscapeString(\"" + wordUnderCursor + "\")")
    wordUnderCursor = "\<" + wordUnderCursor + "\>"

    currentSearch = vim.eval("@/")

    if currentSearch != wordUnderCursor :
        # highlight it, if it is not the currently searched word
        vim.command("match RonnyWordUnderCursorHighlight /" + wordUnderCursor + "/")

endpython
endfunction

function! RonnyEscapeString(s)
python << endpython
import vim

s = vim.eval("a:s")

escapeMap = {
    '"'     : '\\"',
    "'"     : '\\''',
    "*"     : '\\*',
    "/"     : '\\/',
    #'' : ''
}

s = s.replace('\\', '\\\\')

for before, after in escapeMap.items() :
    s = s.replace(before, after)

vim.command("return \'" + s + "\'")
endpython
endfunction 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2009-04-25T16:29:04.000

我在鼠标悬停时显示折叠内容和语法组：

```
function! SyntaxBallon()
    let synID   = synID(v:beval_lnum, v:beval_col, 0)
    let groupID = synIDtrans(synID)
    let name    = synIDattr(synID, "name")
    let group   = synIDattr(groupID, "name")
    return name . "\n" . group
endfunction

function! FoldBalloon()
    let foldStart = foldclosed(v:beval_lnum)
    let foldEnd   = foldclosedend(v:beval_lnum)
    let lines = []
    if foldStart >= 0
        " we are in a fold
        let numLines = foldEnd - foldStart + 1
        if (numLines > 17)
            " show only the first 8 and the last 8 lines
            let lines += getline(foldStart, foldStart + 8)
            let lines += [ '-- Snipped ' . (numLines - 16) . ' lines --']
            let lines += getline(foldEnd - 8, foldEnd)
        else
            " show all lines
            let lines += getline(foldStart, foldEnd)
        endif
    endif
    " return result
    return join(lines, has("balloon_multiline") ? "\n" : " ")
endfunction

function! Balloon()
    if foldclosed(v:beval_lnum) >= 0
        return FoldBalloon()
    else
        return SyntaxBallon()
endfunction

set balloonexpr=Balloon()
set ballooneval 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2009-04-25T16:38:54.817

```
set nocompatible
syntax on
set number
set autoindent
set smartindent
set background=dark
set tabstop=4 shiftwidth=4
set tw=80
set expandtab
set mousehide
set cindent
set list listchars=tab:»·,trail:·
set autoread
filetype on
filetype indent on
filetype plugin on

" abbreviations for c programming
func LoadCAbbrevs()
 "  iabbr do do {<CR>} while ();<C-O>3h<C-O>
 "  iabbr for for (;;) {<CR>}<C-O>k<C-O>3l<C-O>
 "  iabbr switch switch () {<CR>}<C-O>k<C-O>6l<C-O>
 "  iabbr while while () {<CR>}<C-O>k<C-O>5l<C-O>
 "  iabbr if if () {<CR>}<C-O>k<C-O>2l<C-O>
    iabbr #d #define
    iabbr #i #include
endfunc
au FileType c,cpp call LoadCAbbrevs()

au BufReadPost * if line("'\"") > 0 && line("'\"") <= line("$") |
                         \ exe "normal g'\"" | endif

autocmd FileType python set nocindent shiftwidth=4 ts=4 foldmethod=indent 
```

那里不多。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2009-11-01T02:02:40.710

我的 .vimrc 中最重要的部分是它如何在每个有选项卡的地方显示一个“»”字符，以及它如何以红色突出显示“坏”空白。坏空格是行中间的制表符或末尾的不可见空格之类的东西。

```
syntax enable

" Incremental search without highlighting.
set incsearch
set nohlsearch

" Show ruler.
set ruler

" Try to keep 2 lines above/below the current line in view for context.
set scrolloff=2

" Other file types.
autocmd BufReadPre,BufNew *.xml set filetype=xml

" Flag problematic whitespace (trailing spaces, spaces before tabs).
highlight BadWhitespace term=standout ctermbg=red guibg=red
match BadWhitespace /[^* \t]\zs\s\+$\| \+\ze\t/

" If using ':set list' show things nicer.
execute 'set listchars=tab:' . nr2char(187) . '\ '
set list
highlight Tab ctermfg=lightgray guifg=lightgray
2match Tab /\t/

" Indent settings for code: 4 spaces, do not use tab character.
"set tabstop=4 shiftwidth=4 autoindent smartindent shiftround
"autocmd FileType c,cpp,java,xml,python,cs setlocal expandtab softtabstop=4
"autocmd FileType c,cpp,java,xml,python,cs 2match BadWhitespace /[^\t]\zs\t/
set tabstop=8 shiftwidth=4 autoindent smartindent shiftround
set expandtab softtabstop=4
2match BadWhitespace /[^\t]\zs\t\+/

" Automatically show matching brackets.
set showmatch

" Auto-complete file names after <TAB> like bash does.
set wildmode=longest,list
set wildignore=.svn,CVS,*.swp

" Show current mode and currently-typed command.
set showmode
set showcmd

" Use mouse if possible.
" set mouse=a

" Use Ctrl-N and Ctrl-P to move between files.
nnoremap <C-N> :confirm next<Enter>
nnoremap <C-P> :confirm prev<Enter>

" Confirm saving and quitting.
set confirm

" So yank behaves like delete, i.e. Y = D.
map Y y$

" Toggle paste mode with F5.
set pastetoggle=<F5>

" Don't exit visual mode when shifting.
vnoremap < <gv
vnoremap > >gv

" Move up and down by visual lines not buffer lines.
nnoremap <Up>   gk
vnoremap <Up>   gk
nnoremap <Down> gj
vnoremap <Down> gj 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2010-05-15T17:34:48.383

I have this in my `~/.vim/after/syntax/vim.vim` file:

What it does is:

*   highlights the word blue in the color blue
*   highlights the wrod red in the color red
*   etc

Ie: so if you go:

```
highlight JakeRedKeywords cterm=bold term=bold ctermbg=black ctermfg=Red 
```

The word red will be red and the word black will be black.

Here is the code:

```
syn cluster vimHiCtermColors contains=vimHiCtermColorBlack,vimHiCtermColorBlue,vimHiCtermColorBrown,vimHiCtermColorCyan,vimHiCtermColorDarkBlue,vimHiCtermColorDarkcyan,vimHiCtermColorDarkgray,vimHiCtermColorDarkgreen,vimHiCtermColorDarkgrey,vimHiCtermColorDarkmagenta,vimHiCtermColorDarkred,vimHiCtermColorDarkyellow,vimHiCtermColorGray,vimHiCtermColorGreen,vimHiCtermColorGrey,vimHiCtermColorLightblue,vimHiCtermColorLightcyan,vimHiCtermColorLightgray,vimHiCtermColorLightgreen,vimHiCtermColorLightgrey,vimHiCtermColorLightmagenta,vimHiCtermColorLightred,vimHiCtermColorMagenta,vimHiCtermColorRed,vimHiCtermColorWhite,vimHiCtermColorYellow

syn case ignore

syn keyword vimHiCtermColorYellow yellow contained 
syn keyword vimHiCtermColorBlack black contained
syn keyword vimHiCtermColorBlue blue contained
syn keyword vimHiCtermColorBrown brown contained
syn keyword vimHiCtermColorCyan cyan contained
syn keyword vimHiCtermColorDarkBlue darkBlue contained
syn keyword vimHiCtermColorDarkcyan darkcyan contained
syn keyword vimHiCtermColorDarkgray darkgray contained
syn keyword vimHiCtermColorDarkgreen darkgreen contained
syn keyword vimHiCtermColorDarkgrey darkgrey contained
syn keyword vimHiCtermColorDarkmagenta darkmagenta contained
syn keyword vimHiCtermColorDarkred darkred contained
syn keyword vimHiCtermColorDarkyellow darkyellow contained
syn keyword vimHiCtermColorGray gray contained
syn keyword vimHiCtermColorGreen green contained
syn keyword vimHiCtermColorGrey grey contained
syn keyword vimHiCtermColorLightblue lightblue contained
syn keyword vimHiCtermColorLightcyan lightcyan contained
syn keyword vimHiCtermColorLightgray lightgray contained
syn keyword vimHiCtermColorLightgreen lightgreen contained
syn keyword vimHiCtermColorLightgrey lightgrey contained
syn keyword vimHiCtermColorLightmagenta lightmagenta contained
syn keyword vimHiCtermColorLightred lightred contained
syn keyword vimHiCtermColorMagenta magenta contained
syn keyword vimHiCtermColorRed red contained
syn keyword vimHiCtermColorWhite white contained
syn keyword vimHiCtermColorYellow yellow contained

syn match  vimHiCtermFgBg   contained   "\ccterm[fb]g="he=e-1  nextgroup=vimNumber,@vimHiCtermColors,vimFgBgAttrib,vimHiCtermError

highlight vimHiCtermColorBlack ctermfg=black ctermbg=white
highlight vimHiCtermColorBlue ctermfg=blue
highlight vimHiCtermColorBrown ctermfg=brown
highlight vimHiCtermColorCyan ctermfg=cyan
highlight vimHiCtermColorDarkBlue ctermfg=darkBlue
highlight vimHiCtermColorDarkcyan ctermfg=darkcyan
highlight vimHiCtermColorDarkgray ctermfg=darkgray
highlight vimHiCtermColorDarkgreen ctermfg=darkgreen
highlight vimHiCtermColorDarkgrey ctermfg=darkgrey
highlight vimHiCtermColorDarkmagenta ctermfg=darkmagenta
highlight vimHiCtermColorDarkred ctermfg=darkred
highlight vimHiCtermColorDarkyellow ctermfg=darkyellow
highlight vimHiCtermColorGray ctermfg=gray
highlight vimHiCtermColorGreen ctermfg=green
highlight vimHiCtermColorGrey ctermfg=grey
highlight vimHiCtermColorLightblue ctermfg=lightblue
highlight vimHiCtermColorLightcyan ctermfg=lightcyan
highlight vimHiCtermColorLightgray ctermfg=lightgray
highlight vimHiCtermColorLightgreen ctermfg=lightgreen
highlight vimHiCtermColorLightgrey ctermfg=lightgrey
highlight vimHiCtermColorLightmagenta ctermfg=lightmagenta
highlight vimHiCtermColorLightred ctermfg=lightred
highlight vimHiCtermColorMagenta ctermfg=magenta
highlight vimHiCtermColorRed ctermfg=red
highlight vimHiCtermColorWhite ctermfg=white
highlight vimHiCtermColorYellow ctermfg=yellow 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2008-10-14T16:45:44.380

这是我的。它们已经发展了很多年，并且在 Linux/Windows/OSX 中同样运行良好（我上次检查时）：

[vimrc](https://github.com/jmcantrell/dotfiles-vim/blob/master/vimrc)和 [gvimrc](https://github.com/jmcantrell/dotfiles-vim/blob/master/gvimrc)

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2010-11-14T12:45:18.837

以下是我的 vimrc 的一些部分和来自 vimrc 的文件：

## 用于`F10`切换常见的布尔设置：

```
" F10 inverts 'wrap'
xnoremap <F10>          :<C-U>set wrap! <Bar> set wrap? <CR>gv
nnoremap <F10>          :set wrap! <Bar> set wrap? <CR>
inoremap <F10>          <C-O>:set wrap! <Bar> set wrap? <CR>
" Shift-F10 inverts 'virtualedit'
xnoremap <S-F10>        :<C-U>set ve=<C-R>=(&ve == 'all') ? '' : 'all'<return> ve?<CR>gv
nnoremap <S-F10>        :set ve=<C-R>=(&ve == 'all') ? '' : 'all'<return> ve?<CR>
inoremap <S-F10>        <C-O>:set ve=<C-R>=(&ve == 'all') ? '' : 'all'<return> ve?<CR>
" Ctrl-F10 inverts 'hidden'
xnoremap <C-F10>        :<C-U>set hidden! <Bar> set hidden? <CR>gv
nnoremap <C-F10>        :set hidden! <Bar> set hidden? <CR>
inoremap <C-F10>        <C-O>:set hidden! <Bar> set hidden? <CR> 
```

## 使用`F11`和`F12`移动快速修复条目

```
" F11 and F12 to go to resp. previous and next item in quickfix entries
nnoremap <F11>          :silent! cc<CR>:silent! cp <CR>:call ErrBlink()<CR>
nnoremap <F12>          :silent! cc<CR>:silent! cn <CR>:call ErrBlink()<CR>
" Shift-F11 and Shift-F12 to go to resp prev. and next file in quickfix list
nnoremap <S-F11>        :silent! cc<CR>:silent! cpf<CR>:call ErrBlink()<CR>
nnoremap <S-F12>        :silent! cc<CR>:silent! cnf<CR>:call ErrBlink()<CR>
" Ctrl-F11 and Ctrl-F1 to recall older and newer quickfix lists
nnoremap <C-F11>        :silent! col <CR>:call ErrBlink()<CR>
nnoremap <C-F12>        :silent! cnew<CR>:call ErrBlink()<CR> 
```

## `*`使用and搜索视觉选择的文本`#`（前缀 with`_`也可以保留旧搜索）

```
xnoremap <silent> _* :<C-U>
  \let old_reg=getreg('"')<Bar>let old_regtype=getregtype('"')<CR>
  \gvy/<C-R><C-R>/\|<C-R><C-R>=substitute(
  \substitute(escape(@", '/\.*$^~['), '\s\+', '\\s\\+', 'g'), '\_s\+', '\\_s*', 'g')<CR><CR>
  \gV:call setreg('"', old_reg, old_regtype)<CR>

xnoremap <silent> _# :<C-U>
  \let old_reg=getreg('"')<Bar>let old_regtype=getregtype('"')<CR>
  \gvy?<C-R><C-R>/\|<C-R><C-R>=substitute(
  \substitute(escape(@", '?\.*$^~['), '\s\+', '\\s\\+', 'g'), '\_s\+', '\\_s*', 'g')<CR><CR>
  \gV:call setreg('"', old_reg, old_regtype)<CR>

xnoremap <silent> * :<C-U>
  \let old_reg=getreg('"')<Bar>let old_regtype=getregtype('"')<CR>
  \gvy/<C-R><C-R>=substitute(
  \substitute(escape(@", '/\.*$^~['), '\s\+', '\\s\\+', 'g'), '\_s\+', '\\_s*', 'g')<CR><CR>
  \gV:call setreg('"', old_reg, old_regtype)<CR>

xnoremap <silent> # :<C-U>
  \let old_reg=getreg('"')<Bar>let old_regtype=getregtype('"')<CR>
  \gvy?<C-R><C-R>=substitute(
  \substitute(escape(@", '?\.*$^~['), '\s\+', '\\s\\+', 'g'), '\_s\+', '\\_s*', 'g')<CR><CR>
  \gV:call setreg('"', old_reg, old_regtype)<CR> 
```

## 使用`F1`和`F3`搜索（将结果添加到当前结果）

```
set grepprg=ack
" F2 uses ack to search a Perl pattern
nnoremap <F2>         :grep<space>
nnoremap <S-F2>       :grepadd<space>
" F3 uses vim to search current pattern
nnoremap <F3>         :noautocmd vim // **/*<C-F>Bhhi
nnoremap <F3><F3>     :noautocmd vim /<C-R><C-O>// **/*<Return>
" F3 to search the current highlighted pattern
xnoremap <F3>         "zy:noautocmd vim /\M<C-R>=escape(@z,'\/')<CR>/ **/*<CR>
nnoremap <S-F3>       :noautocmd vimgrepadd // **/*<C-F>Bhhi
nnoremap <S-F3><S-F3> :noautocmd vimgrepadd /<C-R><C-O>// **/*<Return>
xnoremap <S-F3>       "zy:noautocmd vimgrepadd /\M<C-R>=escape(@z,'\/')<CR>/ **/*<CR> 
```

## 在可视模式下粘贴时不要存储替换的文本

```
xnoremap p              pgvy 
```

## 帮助功能

```
" Have cursor line and column blink a bit
function! BlinkHere()
    for i in range(1,6)
        set cursorline! cursorcolumn!
        redraw
        sleep 30m
    endfor
endfunction

" Blink on mappings to quickfix commands
function! ErrBlink()
    silent! cw
    silent! normal! z17
    silent! cc
    silent! normal! zz
    silent! call BlinkHere()
endfunction 
```

## 自动排序 quickfix 列表

```
function! s:CompareQuickfixEntries(i1, i2)
  if bufname(a:i1.bufnr) == bufname(a:i2.bufnr)
    return a:i1.lnum == a:i2.lnum ? 0 : (a:i1.lnum < a:i2.lnum ? -1 : 1)
  else
    return bufname(a:i1.bufnr) < bufname(a:i2.bufnr) ? -1 : 1
  endif
endfunction

function! s:SortUniqQFList()
  let sortedList = sort(getqflist(), 's:CompareQuickfixEntries')
  let uniqedList = []
  let last = ''
  for item in sortedList
    let this = bufname(item.bufnr) . "\t" . item.lnum
    if this !=# last
      call add(uniqedList, item)
      let last = this
    endif
  endfor
  call setqflist(uniqedList)
endfunction
autocmd! QuickfixCmdPost * call s:SortUniqQFList() 
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2010-04-30T16:40:30.400

一些我最喜欢的定制，我还没有发现太常见：

```
" Windows *********************************************************************"
set equalalways           " Multiple windows, when created, are equal in size"
set splitbelow splitright " Put the new windows to the right/bottom"

" Insert new line in command mode *********************************************"
map <S-Enter> O<ESC> " Insert above current line"
map <Enter> o<ESC>   " Insert below current line"

" After selecting something in visual mode and shifting, I still want that"
" selection intact ************************************************************"
vmap > >gv
vmap < <gv 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2009-08-25T19:55:13.060

现在才看到这个：

```
:nnoremap <esc> :noh<return><esc> 
```

我在[ViEmu 博客](http://www.viemu.com/blog/2009/06/16/a-vim-and-viemu-mapping-you-really-cant-miss-never-type-noh-again/)中找到了它，我真的很喜欢这个。一个简短的解释 - 它使 Esc 在正常模式下关闭搜索突出显示。

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2009-08-25T19:56:58.673

```
set tabstop=4
set shiftwidth=4
set cindent
set noautoindent
set noexpandtab
set nocompatible
set cino=:0(4u0
set backspace=indent,start
set term=ansi
let lpc_syntax_for_c=1
syntax enable

autocmd FileType c set cin noai nosi
autocmd FileType lpc set cin noai nosi
autocmd FileType css set nocin ai noet
autocmd FileType js set nocin ai noet
autocmd FileType php set nocin ai noet

function! DeleteFile(...)
  if(exists('a:1'))
    let theFile=a:1
  elseif ( &ft == 'help' )
    echohl Error
    echo "Cannot delete a help buffer!"
    echohl None
    return -1
  else
    let theFile=expand('%:p')
  endif
  let delStatus=delete(theFile)
  if(delStatus == 0)
    echo "Deleted " . theFile
  else
    echohl WarningMsg
    echo "Failed to delete " . theFile
    echohl None
  endif
  return delStatus
endfunction
"delete the current file
com! Rm call DeleteFile()
"delete the file and quit the buffer (quits vim if this was the last file)
com! RM call DeleteFile() <Bar> q! 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2009-10-29T20:00:40.327

[http://github.com/elventails/vim/blob/master/vimrc](http://github.com/elventails/vim/blob/master/vimrc)

有 CakePHP/PHP/Git 的附加功能

请享用！

将添加你们正在使用的不错的选项并更新存储库；

干杯，

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2010-04-30T16:29:16.807

我的[.vimrc](http://hackr.se/vim/vimrc)、我使用的插件和其他调整都是定制的，以帮助我完成最常执行的任务：

*   使用 Mutt/Vim 读/写电子邮件
*   在 GNU/Linux 下编写 C 代码，通常使用 glib、gobject、gstreamer
*   浏览/阅读 C 源代码
*   使用 Python、Ruby on Rails 或 Bash 脚本
*   使用 HTML、Javascript、CSS 开发 Web 应用程序

我在这里有一些关于我的[Vim 配置的更多信息](http://hackr.se/vim/vim-configuration/)

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2008-11-02T21:59:14.867

```
" **************************
" * vim general options ****
" **************************
set nocompatible
set history=1000
set mouse=a

" don't have files trying to override this .vimrc:
set nomodeline

" have <F1> prompt for a help topic, rather than displaying the introduction
" page, and have it do this from any mode:
nnoremap <F1> :help<Space>
vmap <F1> <C-C><F1>
omap <F1> <C-C><F1>
map! <F1> <C-C><F1>

set title

" **************************
" * set visual options *****
" **************************
set nu
set ruler
syntax on

" colorscheme oceandeep
set background=dark

set wildmenu
set wildmode=list:longest,full

" use "[RO]" for "[readonly]"
set shortmess+=r

set scrolloff=3

" display the current mode and partially-typed commands in the status line:
set showmode
set showcmd

" don't make it look like there are line breaks where there aren't:
set nowrap

" **************************
" * set editing options ****
" **************************
set autoindent
filetype plugin indent on
set backspace=eol,indent,start
autocmd FileType text setlocal textwidth=80
autocmd FileType make set noexpandtab shiftwidth=8

" * Search & Replace
" make searches case-insensitive, unless they contain upper-case letters:
set ignorecase
set smartcase
" show the `best match so far' as search strings are typed:
set incsearch
" assume the /g flag on :s substitutions to replace all matches in a line:
set gdefault

" ***************************
" * tab completion **********
" ***************************
setlocal omnifunc=syntaxcomplete#Complete
imap <Tab> <C-x><C-o>
inoremap <tab> <c-r>=InsertTabWrapper()<cr>

" ***************************
" * keyboard mapping ********
" ***************************
imap <A-1> <Esc>:tabn 1<CR>i
imap <A-2> <Esc>:tabn 2<CR>i
imap <A-3> <Esc>:tabn 3<CR>i
imap <A-4> <Esc>:tabn 4<CR>i
imap <A-5> <Esc>:tabn 5<CR>i
imap <A-6> <Esc>:tabn 6<CR>i
imap <A-7> <Esc>:tabn 7<CR>i
imap <A-8> <Esc>:tabn 8<CR>i
imap <A-9> <Esc>:tabn 9<CR>i

map <A-1> :tabn 1<CR>
map <A-2> :tabn 2<CR>
map <A-3> :tabn 3<CR>
map <A-4> :tabn 4<CR>
map <A-5> :tabn 5<CR>
map <A-6> :tabn 6<CR>
map <A-7> :tabn 7<CR>
map <A-8> :tabn 8<CR>
map <A-9> :tabn 9<CR>

" ***************************
" * Utilities Needed ********
" ***************************
function InsertTabWrapper()
      let col = col('.') - 1
      if !col || getline('.')[col - 1] !~ '\k'
          return "\<tab>"
      else
          return "\<c-p>"
      endif
endfunction

" end of .vimrc 
```

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2008-10-03T00:47:12.227

我将我的 .vimrc 放在[http://dotfiles.org/~petdance/.vimrc](http://dotfiles.org/~petdance/.vimrc)上，我[在 dotfiles.org 上也有一些其他文件](http://dotfiles.org/~petdance/)。

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2009-10-28T12:33:28.473

***:map + v%zf*** # 点击“+”折叠函数/循环括号内的任何内容。

***:set expandtab*** # tab 会根据 ts (tabspace) 的设置展开为空格

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2010-06-07T12:37:23.007

这是我的！感谢分享。您可以在此处找到有关 vim 插件的其他内容：http: [//github.com/ametaireau/dotfiles/](http://github.com/ametaireau/dotfiles/)

希望能帮助到你。

```
" My .vimrc configuration file.
" =============================
"
" Plugins
" -------
" Comes with a set of utilities to enhance the user experience.
" Django and python snippets are possible thanks to the snipmate
" plugin.
"
" A also uses taglist and NERDTree vim plugins.
"
" Shortcuts
" ----------
" Here are some shortcuts I like to use when editing text using VIM:
"
" <alt-left/right> to navigate trough tabs
" <ctrl-e> to display the explorator
" <ctrl-p> for the code explorator
" <ctrl-space> to autocomplete
" <ctrl-n> enter tabnew to open a new file
" <alt-h> highlight the lines of more than 80 columns
" <ctrl-h> set textwith to 80 cols
" <maj-k> when on a python file, open the related pydoc documentation
" ,v and ,V to show/edit and reload the vimrc configuration file

colorscheme evening 
syntax on                       " syntax highlighting
filetype on                     " to consider filetypes ...
filetype plugin on              " ... and in plugins
set directory=~/.vim/swp        " store the .swp files in a specific path
set expandtab                   " enter spaces when tab is pressed
set tabstop=4                   " use 4 spaces to represent tab
set softtabstop=4
set shiftwidth=4                " number of spaces to use for auto indent
set autoindent                  " copy indent from current line on new line
set number                      " show line numbers
set backspace=indent,eol,start  " make backspaces more powerful 
set ruler                       " show line and column number
set showcmd                     " show (partial) command in status line
set incsearch                   " highlight search
set noignorecase
set infercase
set nowrap

" shortcuts
map <c-n> :tabnew 
map <silent><c-e> :NERDTreeToggle <cr>
map <silent><c-p> :TlistToggle <cr>
nnoremap <a-right> gt
nnoremap <a-left>  gT
command W w !sudo tee % > /dev/null
map <buffer> K :execute "!pydoc " . expand("<cword>")<CR>
map <F2> :set textwidth=80 <cr>
" Replace trailing slashes
map <F3> :%s/\s\+$//<CR>:exe ":echo'trailing slashes removes'"<CR>
map <silent><F6> :QFix<CR>

" edit vim quickly
map ,v :sp ~/.vimrc<CR><C-W>_
map <silent> ,V :source ~/.vimrc<CR>:filetype detect<CR>:exe ":echo'vimrc reloaded'"<CR> 

" configure expanding of tabs for various file types
au BufRead,BufNewFile *.py set expandtab
au BufRead,BufNewFile *.c set noexpandtab
au BufRead,BufNewFile *.h set noexpandtab
au BufRead,BufNewFile Makefile* set noexpandtab

" remap CTRL+N to CTRL + space
inoremap <Nul> <C-n>

" Omnifunc completers
autocmd FileType python set omnifunc=pythoncomplete#Complete

" Tlist configuration
let Tlist_GainFocus_On_ToggleOpen = 1
let Tlist_Close_On_Select = 0
let Tlist_Auto_Update = 1
let Tlist_Process_File_Always = 1
let Tlist_Use_Right_Window = 1
let Tlist_WinWidth = 40
let Tlist_Show_One_File = 1
let Tlist_Show_Menu = 0
let Tlist_File_Fold_Auto_Close = 0
let Tlist_Ctags_Cmd = '/usr/bin/ctags'
let tlist_css_settings = 'css;e:SECTIONS'

" NerdTree configuration
let NERDTreeIgnore = ['\.pyc$', '\.pyo$']

" Highlight more than 80 columns lines on demand
nnoremap <silent><F1>
\    :if exists('w:long_line_match') <Bar>
\        silent! call matchdelete(w:long_line_match) <Bar>
\        unlet w:long_line_match <Bar>
\    elseif &textwidth > 0 <Bar>
\        let w:long_line_match = matchadd('ErrorMsg', '\%>'.&tw.'v.\+', -1) <Bar>
\    else <Bar>
\        let w:long_line_match = matchadd('ErrorMsg', '\%>80v.\+', -1) <Bar>
\    endif<CR>

command -bang -nargs=? QFix call QFixToggle(<bang>0)
function! QFixToggle(forced)
  if exists("g:qfix_win") && a:forced == 0
    cclose
    unlet g:qfix_win
  else
    copen 10
    let g:qfix_win = bufnr("$")
  endif
endfunction 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2008-10-03T14:52:48.213

我的`~/.vimrc`非常标准（主要是.`$VIMRUNTIME/vimrc_example.vim``~/.vim``~/.vim/ftplugin``~/.vim/syntax`

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2010-04-15T20:16:52.050

我最喜欢的 .vimrc 是一组用于处理宏的映射：

```
nnoremap <Leader>qa mqGo<Esc>"ap
nnoremap <Leader>qb mqGo<Esc>"bp
nnoremap <Leader>qc mqGo<Esc>"cp
<SNIP>
nnoremap <Leader>qz mqGo<Esc>"zp

nnoremap <Leader>Qa G0"ad$dd'q
nnoremap <Leader>Qb G0"bd$dd'q
nnoremap <Leader>Qc G0"cd$dd'q
<SNIP>
nnoremap <Leader>Qz G0"zd$dd'q 
```

有了这个 \q[az] 将标记您的位置，并在当前文件的底部打印给定寄存器的内容， \Q[az] 将把最后一行的内容放入给定寄存器并返回到您的标记的位置。使编辑宏或将一个宏复制和调整到新寄存器中变得非常容易。

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2010-01-16T23:29:02.783

我制作了一个功能，可以自动将您的文本发送到私人粘贴箱。

```
let g:pfx='' " prefix for private pastebin.

function PBSubmit()
python << EOF
import vim
import urllib2 as url
import urllib

pfx = vim.eval( 'g:pfx' )

URL = 'http://'

if pfx == '':
    URL += 'pastebin.com/pastebin.php'
else:
    URL += pfx + '.pastebin.com/pastebin.php'

data = urllib.urlencode( {  'code2': '\n'.join( vim.current.buffer ).decode( 'utf-8' ).encode( 'latin-1' ),
                            'email': '',
                            'expiry': 'd',
                            'format': 'text',
                            'parent_pid': '',
                            'paste': 'Send',
                            'poster': '' } )

url.urlopen( URL, data )

print 'Submitted to ' + URL
EOF
endfunction

map <Leader>pb :call PBSubmit()<CR> 
```

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2008-12-05T00:17:13.370

下面最重要的事情可能是字体选择和配色方案。是的，我花了太长时间愉快地摆弄这些东西。:)

```
"set tildeop
set nosmartindent
" set guifont=courier
" awesome programming font
" set guifont=peep:h09:cANSI
" another nice looking font for programming and general use
set guifont=Bitstream_Vera_Sans_MONO:h09:cANSI
set lines=68
set tabstop=2
set shiftwidth=2
set expandtab
set ignorecase
set nobackup
" set writebackup

" Some of my favourite colour schemes, lovingly crafted over the years :)
" very dark scarlet background, almost white text
" hi Normal   guifg=#FFFFF0 guibg=#3F0000 ctermfg=white ctermbg=Black
" C64 colours
"hi Normal   guifg=#8CA1EC guibg=#372DB4 ctermfg=white ctermbg=Black 
" nice forest green background with bisque fg
hi Normal   guifg=#9CfCb1 guibg=#279A1D ctermfg=white ctermbg=Black 
" dark green background with almost white text 
"hi Normal   guifg=#FFFFF0 guibg=#003F00 ctermfg=white ctermbg=Black

" french blue background, almost white text
"hi Normal   guifg=#FFFFF0 guibg=#00003F ctermfg=white ctermbg=Black

" slate blue bg, grey text
"hi Normal   guifg=#929Cb1 guibg=#20403F ctermfg=white ctermbg=Black 

" yellow/orange bg, black text
hi Normal   guifg=#000000 guibg=#f8db3a ctermfg=white ctermbg=Black 
```

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2009-03-31T14:44:16.487

我为我的待办事项或清单文档创建了自己的语法，其中突出显示了诸如

-> 这样做（粗体）

!-> 立即执行此操作（橙色）

++> 正在执行此操作（绿色）

=> 完成（灰色）

我在 ./syntax/ 中有文件作为 fc_comdoc.vim

在 vimrc 中为我的自定义扩展名 .txtcd 或 .txtap 的任何内容设置此语法

```
au BufNewFile,BufRead *.txtap,*.txtcd   setf fc_comdoc 
```

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2009-10-30T00:35:39.557

其中很多来自[维基](http://vim.wikia.com/wiki/Vim_Tips_Wiki)顺便说一句。

```
set nocompatible
source $VIMRUNTIME/mswin.vim
behave mswin
set nobackup
set tabstop=4
set nowrap

set guifont=Droid_Sans_Mono:h9:cANSI
colorscheme torte
set shiftwidth=4
set ic
syn off
set nohls
set acd
set autowrite
noremap \c "+yy
noremap \x "+dd
noremap \t :tabnew<CR>
noremap \2 I"<Esc>A"<Esc>
noremap \3 bi'<Esc>ea'<Esc>
noremap \" i"<Esc>ea"<Esc>
noremap ?2 Bi"<Esc>Ea"<Esc>
set matchpairs+=<:>
nnoremap <C-N> :next<CR>
nnoremap <C-P> :prev<CR>
nnoremap <Tab> :bnext<CR>
nnoremap <S-Tab> :bprevious<CR>
nnoremap \w :let @/=expand("<cword>")<Bar>split<Bar>normal n<CR>
nnoremap \W :let @/='\<'.expand("<cword>").'\>'<Bar>split<Bar>normal n<CR>

autocmd FileType xml exe ":silent %!xmllint --format --recover - "
autocmd FileType cpp set tabstop=2 shiftwidth=2 expandtab autoindent smarttab
autocmd FileType sql set tabstop=2 shiftwidth=2 expandtab autoindent smarttab

" Map key to toggle opt
function MapToggle(key, opt)
  let cmd = ':set '.a:opt.'! \| set '.a:opt."?\<CR>"
  exec 'nnoremap '.a:key.' '.cmd
  exec 'inoremap '.a:key." \<C-O>".cmd
endfunction
command -nargs=+ MapToggle call MapToggle(<f-args>)

map <F6> :if exists("syntax_on") <Bar> syntax off <Bar> else <Bar> syntax enable <Bar> endif <CR>

" Display-altering option toggles
MapToggle <F7> hlsearch
MapToggle <F8> wrap
MapToggle <F9> list

" Behavior-altering option toggles
MapToggle <F10> scrollbind
MapToggle <F11> ignorecase
MapToggle <F12> paste
set pastetoggle=<F12> 
```

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2009-10-22T10:01:12.977

对 C/C++ 和 svn 使用有用的东西（可以很容易地为 git/hg/whatever 修改）。我将它们设置为我的 F 键。

不是 C#，但仍然有用。

```
function! SwapFilesKeep()
    " Open a new window next to the current one with the matching .cpp/.h pair"
    let command = "echo " . bufname("%") . "|sed s,\h$,\H,|sed s,cpp,h,|sed s,H$,cpp,"
    let newfilename = system(command)
    silent execute("vs " . newfilename)
endfunction

function! SwapFiles()
    " swap between .cpp and .h "
    let command = "echo " . bufname("%") . "|sed s,\h$,\H,|sed s,cpp,h,|sed s,H$,cpp,"
    let newfilename = system(command)
    silent execute("e " . newfilename)
endfunction

function! SvnDiffAll()
    let tempfile = system("tempfile")
    silent execute ":!svn diff .>" . tempfile
    execute ":sf ".tempfile
    return
endfunction

function! SvnLog()
    let fn = expand('%')
    let tempfile = system("tempfile")
    silent execute ":!svn log -v " . fn . ">" . tempfile
    execute ":sf ".tempfile
    return
endfunction

function! SvnStatus()
    let tempfile = system("tempfile")
    silent execute ":!svn status .>" . tempfile
    execute ":sf ".tempfile
    return
endfunction

function! SvnDiff()
    " diff with BASE "
    let dir = expand('%:p:h')
    let fn = expand('%')
    let fn = substitute(fn,".*\\","","")
    let fn = substitute(fn,".*/","","")
    silent execute ":vert diffsplit " . dir . "/.svn/text-base/" . fn . ".svn-base"
    silent execute ":set ft=cpp"
    unlet fn dir
    return
endfunction 
```

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2009-10-28T14:20:34.333

我倾向于将我的 .vimrc 拆分为不同的部分，以便我可以在我运行的所有不同机器上打开和关闭不同的部分，即 Windows 上的一些位，Linux 上的一些位等：

```
 "*****************************************
"* SECTION 1 - THINGS JUST FOR GVIM      *
"*****************************************
if v:version >= 700

    "Note: Other plugin files
    source ~/.vim/ben_init/bens_pscripts.vim
    "source ~/.vim/ben_init/stim_projects.vim
    "source ~/.vim/ben_init/temp_commands.vim
    "source ~/.vim/ben_init/wwatch.vim

    "Extract sections of code as a function (works in C, C++, Perl, Java)
    source ~/.vim/ben_init/functify.vim

    "Settings that relate to the look/feel of vim in the GUI
    source ~/.vim/ben_init/gui_settings.vim

    "General VIM settings
    source ~/.vim/ben_init/general_settings.vim

    "Settings for programming
    source ~/.vim/ben_init/c_programming.vim

    "Settings for completion
    source ~/.vim/ben_init/completion.vim

    "My own templating system
    source ~/.vim/ben_init/templates.vim

    "Abbreviations and interesting key mappings
    source ~/.vim/ben_init/abbrev.vim

    "Plugin configuration
    source ~/.vim/ben_init/plugin_config.vim

    "Wiki configuration
    source ~/.vim/ben_init/wiki_config.vim

    "Key mappings
    source ~/.vim/ben_init/key_mappings.vim

    "Auto commands
    source ~/.vim/ben_init/autocmds.vim

    "Handy Functions written by other people
    source ~/.vim/ben_init/handy_functions.vim

    "My own omni_completions
    source ~/.vim/ben_init/bens_omni.vim

endif 
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2009-10-28T12:37:12.103

```
set ai 
set si 
set sm 
set sta 
set ts=3 
set sw=3 
set co=130 
set lines=50 
set nowrap 
set ruler 
set showcmd 
set showmode 
set showmatch 
set incsearch 
set hlsearch 
set gfn=Consolas:h11
set guioptions-=T
set clipboard=unnamed
set expandtab
set nobackup

syntax on 
colors torte 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2009-10-22T09:28:47.253

我多年插手 vim 的结果都[在这里](http://pastebin.com/f82bd697)。

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2010-06-07T13:00:30.857

```
"{{{1 Защита от множественных загрузок 
if exists("b:dollarHOMEslashdotvimrcFileLoaded")
    finish
endif
let b:dollarHOMEslashdotvimrcFileLoaded=1
" set t_Co=8
" set t_Sf=[3%p1%dm
" set t_Sb=[4%p1%dm
"{{{1 Options 
"{{{2 set 
set nocompatible
set background=dark
set display+=lastline
"set iminsert=0
"set imsearch=0
set grepprg=grep\ -nH\ $*
set expandtab
set tabstop=4
set shiftwidth=4
set softtabstop=4
set backspace=indent,eol,start
set autoindent
set nosmartindent
set backup
set conskey
set bioskey
set browsedir=buffer
" bomb may work bad
set nobomb
exe "set backupdir=".$HOME."/.vimbackup,."
set backupext=~
set history=32
set ruler
set showcmd
set hlsearch
set incsearch
set nocindent
set textwidth=80
set complete=.,i,d,t,w,b,u,k
" set conskey
set noconfirm
set cscopetag
set cscopetagorder=1
" set copyindent
" !may be not safe
set exrc
set secure
" set foldclose
set noswapfile
" set swapsync=sync
set fsync
set guicursor="a:block-blinkoff0"
set autowriteall
set hidden
set nojoinspaces
set nostartofline
" set virtualedit+=onemore
set lazyredraw
set visualbell
set makeef=make.##.err.log
set modelines=16
set more
set virtualedit+=block
set winaltkeys=no
set fileencodings=utf-8,cp1251,koi8-r,default
set encoding=utf-8
set list
set listchars=tab:>-,trail:-,nbsp:_
set magic
set pastetoggle=<F1>
set foldmethod=marker
set wildmenu
set wildcharm=<Tab>
set formatoptions=arcoqn12w
"set formatoptions+=t
set scrolloff=2

"{{{3 define keys
"{{{4 get keys from zkbd
if isdirectory($HOME."/.zkbd") &&
  \filereadable($HOME."/.zkbd/".$TERM."-pc-linux-gnu")
    let s:keys=split(system("cat ".
                \shellescape($HOME."/.zkbd/".$TERM."-pc-linux-gnu").
                \" | grep \"^key\\\\[\" | ".
                \"sed -re \"s/^key\\\\[([[:alnum:]]*)\\\\]='(.*)'\\$".
                           \"/\\\\1=\\\\2/g\""), "\\n")
    for key in s:keys
        let tmp=split(key, "=")
        if tmp[0]=~"^F\\d\\+$"
            execute "set <".tmp[0].">=".
                        \substitute(tmp[1], "\\^\\[", "\<ESC>", "g")
        endif
    endfor
endif
" function g:DefineKeys()
    "{{{4 screen
    if 0 && $_SECONDLAUNCH
        set    <F1>=[11~
        set    <F2>=[12~
        set    <F3>=[13~
        set    <F4>=[14~
        set    <F5>=[15~
        set    <F6>=[17~
        set    <F7>=[18~
        set    <F8>=[19~
        set    <F9>=[20~
        set   <F10>=[21~
        set   <F11>=[23~
        set   <F12>=[24~
        set  <S-F1>=[23~
        set  <S-F2>=[24~
        set  <S-F3>=[25~
        set  <S-F4>=[26~
        set  <S-F5>=[28~
        set  <S-F6>=[29~
        set  <S-F7>=[31~
        set  <S-F8>=[32~
        set  <S-F9>=[33~
        set <S-F10>=[34~
        set <S-F11>=[23$
        set <S-F12>=[24$
        set  <HOME>=[7~
        set   <END>=[8~
    "{{{4 xterm 
    elseif $TERM=="xterm"
        set      <M-a>=a
        set      <M-b>=b
        set      <M-c>=c
        set      <M-d>=d
        set      <M-e>=e
        set      <M-f>=f
        set      <M-g>=g
        set      <M-h>=h
        set      <M-i>=i
        set      <M-j>=j
        set      <M-k>=k
        set      <M-l>=l
        set      <M-m>=m
        set      <M-n>=n
        set      <M-o>=o
        set      <M-p>=p
        set      <M-q>=q
        set      <M-r>=r
        set      <M-s>=s
        set      <M-t>=t
        set      <M-u>=u
        set      <M-v>=v
        set      <M-w>=w
        set      <M-x>=x
        set      <M-y>=y
        set      <M-z>=z
        "set <M-SPACE>= 
        "set    <Left>=OD
        "set  <S-Left>=O2D
        "set  <C-Left>=O5D
        "set   <Right>=OC
        "set <S-Right>=O2C
        "set <C-Right>=O5C
        "set      <Up>=OA
        "set    <S-Up>=O2A
        "set    <C-Up>=O5A
        "set    <Down>=OB
        "set  <S-Down>=O2B
        "set  <C-Down>=O5B
        set       <F1>=[11~
        set       <F2>=[12~
        set       <F3>=[13~
        set       <F4>=[14~
        set       <F5>=[15~
        set       <F6>=[17~
        set       <F7>=[18~
        set       <F8>=[19~
        set       <F9>=[20~
        set      <F10>=[21~
        set      <F11>=[23~
        set      <F12>=[24~
        "set    <C-F1>=
        "set    <C-F2>=
        "set    <C-F3>=
        "set    <C-F4>=
        "set    <C-F5>=[15;5~
        "set    <C-F6>=[17;5~
        "
        "set    <C-F7>=[18;5~
        "set    <C-F8>=[19;5~
        "set    <C-F9>=[20;5~
        "set   <C-F10>=[21;5~
        "set   <C-F11>=[23;5~
        "set   <C-F12>=[24;5~
        set     <S-F1>=[11;2~
        set     <S-F2>=[12;2~
        set     <S-F3>=[13;2~
        set     <S-F4>=[14;2~
        set     <S-F5>=[15;2~
        set     <S-F6>=[17;2~
        set     <S-F7>=[18;2~
        set     <S-F8>=[19;2~
        set     <S-F9>=[20;2~
        set    <S-F10>=[21;2~
        set    <S-F11>=[23;2~
        set    <S-F12>=[24;2~
        set      <END>=OF
        set    <S-END>=O2F
        set   <S-HOME>=O2H
        set     <HOME>=OH
        set      <DEL>=
        " set   <PageUp>=[5~
        " set <PageDown>=[6~
        "  noremap  <DEL>
        " inoremap  <DEL>
        " cnoremap  <DEL>
        set    <S-Del>=[3;2~
        " set   <C-Del>=[3;5~
        " set   <M-Del>=[3;3~
    "{{{4 rxvt --- aterm
    elseif $TERM=="rxvt"
        set      <M-a>=a
        set      <M-b>=b
        set      <M-c>=c
        set      <M-d>=d
        set      <M-e>=e
        set      <M-f>=f
        set      <M-g>=g
        set      <M-h>=h
        set      <M-i>=i
        set      <M-j>=j
        set      <M-k>=k
        set      <M-l>=l
        set      <M-m>=m
        set      <M-n>=n
        set      <M-o>=o
        set      <M-p>=p
        set      <M-q>=q
        set      <M-r>=r
        set      <M-s>=s
        set      <M-t>=t
        set      <M-u>=u
        set      <M-v>=v
        set      <M-w>=w
        set      <M-x>=x
        set      <M-y>=y
        set      <M-z>=z
        set       <F1>=OP
        set       <F2>=OQ
        set       <F3>=OR
        set       <F4>=OS
        set       <F5>=[15~
        set       <F6>=[17~
        set       <F7>=[18~
        set       <F8>=[19~
        set       <F9>=[20~
        set      <F10>=[21~
        set      <F11>=[23~
        set      <F12>=[24~
        set     <S-F1>=[23~
        set     <S-F2>=[24~
        set     <S-F3>=[25~
        set     <S-F4>=[26~
        set     <S-F5>=[28~
        set     <S-F6>=[29~
        set     <S-F7>=[31~
        set     <S-F8>=[32~
        set     <S-F9>=[33~
        set    <S-F10>=[34~
        set    <S-F11>=[23$
        set    <S-F12>=[24$
        " set  <C-S-F2>=[24^
        " set  <C-S-F3>=[25^
        " set  <C-S-F4>=[26^
        " set  <C-S-F5>=[28^
        " set  <C-S-F6>=[29^
        " set  <C-S-F7>=[31^
        " set  <C-S-F8>=[32^
        " set  <C-S-F9>=[33^
        " set <C-S-F10>=[34^
        " set <C-S-F11>=[23@
        " set <C-S-F12>=[24@
        " set    <M-F5>=<F5>
        " set    <M-F6>=<F6>
        " set    <M-F7>=<F7>
        " set    <M-F8>=<F8>
        " set    <M-F9>=<F9>
        " set   <M-F10>=<F10>
        " set   <M-F11>=<F11>
        " set   <M-F12>=<F12>
        " set  <M-S-F5>=<S-F5>
        " set  <M-S-F6>=<S-F6>
        " set  <M-S-F7>=<S-F7>
        " set  <M-S-F8>=<S-F8>
        " set  <M-S-F9>=<S-F9>
        " set <M-S-F10>=<S-F10>
        " set <M-S-F11>=<S-F11>
        " set <M-S-F12>=<S-F12>
    "{{{4 rxvt-unicode --- urxvt
    elseif $TERM=="rxvt-unicode"
        set      <M-a>=a
        set      <M-b>=b
        set      <M-c>=c
        set      <M-d>=d
        set      <M-e>=e
        set      <M-f>=f
        set      <M-g>=g
        set      <M-h>=h
        set      <M-i>=i
        set      <M-j>=j
        set      <M-k>=k
        set      <M-l>=l
        set      <M-m>=m
        set      <M-n>=n
        set      <M-o>=o
        set      <M-p>=p
        set      <M-q>=q
        set      <M-r>=r
        set      <M-s>=s
        set      <M-t>=t
        set      <M-u>=u
        set      <M-v>=v
        set      <M-w>=w
        set      <M-x>=x
        set      <M-y>=y
        set      <M-z>=z
        set       <F1>=[11~
        set       <F2>=[12~
        set       <F3>=[13~
        set       <F4>=[14~
        set       <F5>=[15~
        set       <F6>=[17~
        set       <F7>=[18~
        set       <F8>=[19~
        set       <F9>=[20~
        set      <F10>=[21~
        set      <F11>=[23~
        set      <F12>=[24~
        " fluxbox!<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        set     <S-F1>=[23~
        set     <S-F2>=[24~
        set     <S-F3>=[25~
        set     <S-F4>=[26~
        set     <S-F5>=[28~
        set     <S-F6>=[29~
        set     <S-F7>=[31~
        set     <S-F8>=[32~
        set     <S-F9>=[33~
        set    <S-F10>=[34~
        set    <S-F11>=[23$
        set    <S-F12>=[24$
        " set    <C-F1>=[11^
        " set    <C-F2>=[12^
        " set    <C-F3>=[13^
        " set    <C-F4>=[14^
        " set    <C-F5>=[15^
        " set    <C-F6>=[17^
        " set    <C-F7>=[18^
        " set    <C-F8>=[19^
        " set    <C-F9>=[20^
        " set   <C-F10>=[21^
        " set   <C-F11>=[23^
        " set   <C-F12>=[24^
        " openbox!<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        " set    <S-F1>=[23~
        " set    <S-F2>=[24~
        " set    <S-F3>=[25~
        " set    <S-F4>=[26~
        " set    <S-F5>=[28~
        " set    <S-F6>=[29~
        " set    <S-F7>=[31~
        " set    <S-F8>=[32~
        " set    <S-F9>=[33~
        " set   <S-F10>=[34~
        " set   <S-F11>=[23$
        " set   <S-F12>=[24$
        " set  <C-S-F2>=[24^
        " set  <C-S-F3>=[25^
        " set  <C-S-F4>=[26^
        " set  <C-S-F5>=[28^
        " set  <C-S-F6>=[29^
        " set  <C-S-F7>=[31^
        " set  <C-S-F8>=[32^
        " set  <C-S-F9>=[33^
        " set <C-S-F10>=[34^
        " set <C-S-F11>=[23@
        " set <C-S-F12>=[24@
        " set    <M-F5>=<F5>
        " set    <M-F6>=<F6>
        " set    <M-F7>=<F7>
        " set    <M-F8>=<F8>
        " set    <M-F9>=<F9>
        " set   <M-F10>=<F10>
        " set   <M-F11>=<F11>
        " set   <M-F12>=<F12>
        " set  <M-S-F5>=<S-F5>
        " set  <M-S-F6>=<S-F6>
        " set  <M-S-F7>=<S-F7>
        " set  <M-S-F8>=<S-F8>
        " set  <M-S-F9>=<S-F9>
        " set <M-S-F10>=<S-F10>
        " set <M-S-F11>=<S-F11>
        " set <M-S-F12>=<S-F12>
    endif
    " autocmd! DefineKeys
" endfunction
" "{{{4 autocmd 
" augroup DefineKeys
" autocmd BufEnter * call g:DefineKeys()
" augroup END

"{{{2 filetipe 
filetype plugin indent on
syntax on

"{{{2 let 
"{{{ NERDCommenter 
let           NERDShutUp=1
let      NERDSpaceDelims=1
"}}}
let g:c_syntax_for_h=1
let g:xml_syntax_folding=1
let           paste_mode=0 " 0 = normal, 1 = paste
"{{{3 keys if $TERM=="rxvt-unicode"
    " " fluxbox!<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    " let    g:C_F1="\<ESC>[11^"
    " let    g:C_F2="\<ESC>[12^"
    " let    g:C_F3="\<ESC>[13^"
    " let    g:C_F4="\<ESC>[14^"
    " let    g:C_F5="\<ESC>[15^"
    " let    g:C_F6="\<ESC>[17^"
    " let    g:C_F7="\<ESC>[18^"
    " let    g:C_F8="\<ESC>[19^"
    " let    g:C_F9="\<ESC>[20^"
    " let   g:C_F10="\<ESC>[21^"
    " let   g:C_F11="\<ESC>[23^"
    " let   g:C_F12="\<ESC>[24^"
    " let  g:M_S_F1="\<ESC>\<ESC>[23$"
    " let  g:M_S_F2="\<ESC>\<ESC>[24$"
    " let  g:M_S_F3="\<ESC>\<ESC>[25$"
    " let  g:M_S_F4="\<ESC>\<ESC>[26$"
    " let  g:M_S_F5="\<ESC>\<ESC>[28$"
    " let  g:M_S_F6="\<ESC>\<ESC>[29$"
    " let  g:M_S_F7="\<ESC>\<ESC>[31$"
    " let  g:M_S_F8="\<ESC>\<ESC>[32$"
    " let  g:M_S_F9="\<ESC>\<ESC>[33$"
    " let g:M_S_F10="\<ESC>\<ESC>[34$"
    " let g:M_S_F11="\<ESC>\<ESC>[23$"
    " let g:M_S_F12="\<ESC>\<ESC>[24$"
    " let  g:M_C_F1="\<ESC>\<ESC>[11^"
    " let  g:M_C_F2="\<ESC>\<ESC>[12^"
    " let  g:M_C_F3="\<ESC>\<ESC>[13^"
    " let  g:M_C_F4="\<ESC>\<ESC>[14^"
    " let  g:M_C_F5="\<ESC>\<ESC>[15^"
    " let  g:M_C_F6="\<ESC>\<ESC>[17^"
    " let  g:M_C_F7="\<ESC>\<ESC>[18^"
    " let  g:M_C_F8="\<ESC>\<ESC>[19^"
    " let  g:M_C_F9="\<ESC>\<ESC>[20^"
    " let g:M_C_F10="\<ESC>\<ESC>[21^"
    " let g:M_C_F11="\<ESC>\<ESC>[23^"
    " let g:M_C_F12="\<ESC>\<ESC>[24^"
" endif
"{{{3 Настройки :TOhtml 
let    html_number_lines=1
" let  html_ignore_folding=1
let         html_use_css=1
let          html_no_pre=0
let            use_xhtml=1
"{{{3 Предотвратить загрузку 
let      loaded_cmdalias=0
"{{{3 Mine 
" let g:kmaps={"en": "", "ru": "russian-dvp"}

"{{{1 Syntax 
highlight TooLongLine term=reverse ctermfg=Yellow ctermbg=Red
2match TooLongLine /\S\%>81v/

"{{{1 Autocommands 
autocmd VimLeavePre * silent mksession! ~/.vim/lastSession.vim
au BufWritePost * if getline(1) =~ "^#!" | execute "silent! !chmod a+x %" | 
            \endif
autocmd BufRead,BufWinEnter * let &l:modifiable=(!(&ro && !&bt=="quickfix"))

"{{{1 Digraphs 
digraphs ca  94 "^
digraphs ga  96 "`
digraphs ti 126 "~

"{{{1 Menus 
" menu Encoding.koi8-r       :e ++enc=8bit-koi8-r<CR>
" menu Encoding.windows-1251 :e ++enc=8bit-cp1251<CR>
" menu Encoding.ibm-866      :e ++enc=8bit-ibm866<CR>
" menu Encoding.utf-8        :e ++enc=2byte-utf-8<CR>
" menu Encoding.ucs-2le      :e ++enc=ucs-2le<CR>

"{{{1 Команды 
function s:Substitute(sstring, line1, line2)
    execute a:line1.",".a:line2."!perl -pi -e 'use encoding \"utf8\"; s'".
                \escape(shellescape(a:sstring), '%!').
                \" 2>/dev/null"
endfunction
command -range=% -nargs=+ S call s:Substitute(<q-args>, <line1>, <line2>)

"{{{1 Mappings 
"{{{2 Menu mappings 

"{{{2 function mappings 
"
"{{{3 Function Eatchar 
function Eatchar(pat)
    let l:pat=((a:pat=="")?("*"):(a:pat))
    let c = nr2char(getchar(0))
    return (c =~ l:pat) ? '' : c
endfunction
"{{{3 CleverTab - tab to autocomplete and move indent 
function CleverTab()
    if strpart( getline('.'), col('.')-2, 1) =~ '^\k$'
        return "\<C-n>"
    else
        return "\<Tab>"
    endif
endfunction
inoremap <Tab> <C-R>=CleverTab()<CR>
"{{{3 Keymap switch 
function! SwitchKeymap(kmaps, knum)
    let s:kmapvals=values(a:kmaps)
    if a:knum=="+"
        let s:ki=index(s:kmapvals, &keymap)
        echo s:ki
        if s:ki==-1
            let &keymap=s:kmapvals[0]
            return
        elseif s:ki>=len(a:kmaps)-1
            let &keymap=s:kmapvals[0]
            return
        endif
        let &keymap=s:kmapvals[s:ki+1]
        return
    elseif has_key(a:kmaps, a:knum)
        let &keymap=a:kmaps[a:knum]
        return
    endif
    let s:ki=0
    for val in s:kmapvals
        if s:ki==a:knum
            let &keymap=val
            return
        endif
        let s:ki+=1
    endfor
    let &keymap=s:kmapvals[0]
endfunction
" inoremap <S-Tab> <C-\><C-o>:call<SPACE>SwitchKeymap(g:kmaps,<SPACE>"+")<C-m>

"{{{2 ToggleVerbose 
function! ToggleVerbose()
    let g:verboseflag = !g:verboseflag
    if g:verboseflag
        exe "set verbosefile=".$HOME."/.logs/vim/verbose.log
        set verbose=15
    else
        set verbose=0
        set verbosefile=
    endif
endfunction
noremap <F4>sv :call<SPACE>ToggleVerbose()
inoremap <F4>sv <C-o>:call<SPACE>ToggleVerbose()

"{{{2 Other mappings 
"{{{3 <.*F12> mappings - for some browsing 
 noremap <F12>        :TlistToggle<CR>
inoremap <F12>        <C-O>:TlistToggle<CR>
inoremap <S-F12>      <C-O>:BufExplorer<CR>
 noremap <S-F12>      :BufExplorer<CR>
inoremap <M-F12>      <C-O>:NERDTreeToggle<CR>
 noremap <M-F12>      :NERDTreeToggle<CR>
"{{{3 yank/paste 
vnoremap <C-Insert>   "+y
nnoremap <S-Insert>   "+p
inoremap <S-Insert>    <C-o><S-Insert>
vnoremap p            "_da<C-r><C-r>"<CR><ESC>
"{{{3 Motions 
"{{{4 Left/Right replace 
cnoremap <C-b>        <Left>
cnoremap <C-f>        <Right>
inoremap <C-b>        <C-\><C-o>h
inoremap <C-f>             <C-o>a

cnoremap <M-b>        <C-Right>
inoremap <M-b>        <C-o>w
inoremap <M-f>        <C-o>b
cnoremap <M-f>        <C-Left>
"{{{4 Page Up/Down 
nnoremap <C-b>             <C-U><C-U>
inoremap <PageUp>     <C-O><C-U><C-O><C-U>
nnoremap <C-f>             <C-D><C-D>
inoremap <PageDown>   <C-O><C-D><C-O><C-D>
"{{{4 Up/Down 
inoremap <C-G>        <C-\><C-o>gk
inoremap <Up>         <C-\><C-o>gk
inoremap <Down>       <C-\><C-o>gj
inoremap <C-l>        <C-\><C-o>gj
nnoremap <Down>       gj
vnoremap <Down>       gj
nnoremap  j           gj
vnoremap  j           gj
nnoremap gj            j
vnoremap gj            j
nnoremap gk            k
vnoremap gk            k
nnoremap  k           gk
vnoremap  k           gk
nnoremap <Up>         gk
vnoremap <Up>         gk
"{{{4 Smart <HOME> and <END> 

    " imap <HOME>        <C-o>g^
    " imap <C-O>g^<HOME> <C-o>^
" inoremap <C-o>^<HOME>  <C-o>0
    " imap <END>         <C-o>g$
" inoremap <C-o>g$<END>  <C-o>$
    " nmap <HOME>        <C-o>g^
    " nmap <C-O>g^<HOME>       ^
" nnoremap <C-o>^<HOME>        0
    " nmap <END>              g$
" nnoremap <C-o>g$<END>        $
"{{{3 <F3> and searching 
 noremap   <F3>            :nohl<CR>
inoremap <S-F3>       <C-o>:nohl<CR>
inoremap   <F3>       <C-o>n
"{{{3 <F2> for saving, <F10> for exiting 
 noremap <F2>              :up<CR>
inoremap <F2>         <C-o>:up<CR>
inoremap <F10>        <ESC>ZZ
 noremap <F10>        <ESC>ZZ
inoremap <S-F10>      <ESC>:q!<CR>
 noremap <S-F10>           :q!<CR>
inoremap <C-F10>      <ESC>:silent<SPACE>mksession<SPACE>session.vim<CR>:wq!
 noremap <C-F10>           :silent<SPACE>mksession<SPACE>session.vim<CR>:wq!
"{{{3 Something 
inoremap <C-z>        <C-o>u
 noremap <F1>         :set paste!<C-m>
inoremap <C-^>        <C-O><C-^>
inoremap <C-d>        <Del>
cnoremap <C-d>        <Del>
"{{{3 <C-j> 
inoremap <C-j>j       <C-o>:bn<CR>
inoremap <C-j>J       <C-o>:bN<CR>
 noremap <C-j>j            :bn<CR>
 noremap <C-j>J            :bN<CR>
"{{{3 for visual 
inoremap <S-Left>     <C-o>vge
inoremap <S-Up>       <C-o>vk
inoremap <S-Down>     <C-o>vj
inoremap <S-Right>    <C-o>ve
inoremap <S-End>      <C-o>v$
inoremap <S-Home>     <C-o>v$o^
vnoremap A            <C-c>i
"{{{3 <F4> 
"{{{4 <F4> folds 
 noremap <F4>{        a{{{<ESC>
inoremap <F4>{         {{{
 noremap <F4>}        a}}}<ESC>
inoremap <F4>}         }}}
inoremap <F4>[        <C-o>o{{{<C-o>:call NERDComment(0,"norm")<C-m>
 noremap <F4>[             o{{{<C-o>:call NERDComment(0,"norm")<C-m>
inoremap <F4>]        <C-o>o}}}<C-o>:call NERDComment(0,"norm")<C-m>
 noremap <F4>]             o}}}<C-o>:call NERDComment(0,"norm")<C-m>
"{{{4 <F4> folds 
inoremap <F4>f        <C-o>za<C-o>j<C-o>^
 noremap <F4>f             zaj
"{{{4 <F4> yank/paste/delete 
inoremap <F4>p        <C-o>p
inoremap <F4>gp       <C-o>"+p
inoremap <F4>y(       <C-o>ya)
inoremap <F4>yl       <C-o>yy
inoremap <F4>gy(      <C-o>"+ya)
inoremap <F4>gyl      <C-o>"+yy
inoremap <F4>P        <C-o>P
inoremap <F4>d(       <C-o>da)
inoremap <F4>dl       <C-o>dd
"{{{4 <F4> frequently used expressions 
inoremap <F4>c        \033[m<C-/><C-o>h
"{{{4 <F4> alternate 
    imap <F4>a        <C-o>:A<C-m>
     map <F4>a             :A<C-m>
"}}}
"}}}
"{{{3 «,» 
"
" &lower
" &upper
" &1st
" &2nd
" &both lower and upper (or both 1st and 2nd)
" prefixed with &e
" prefixed with &E
" is &Prefix for smth
" &prefixed with (([what]p(prefix)))
" -: nothing
" +: added
" /: replaced
" [invc]: for modes insert, normal, visual, command (for insert mode if
"         omitted)
"     |     vimrc       |        |        |       |       |
"     | i     n  v  c   |  tex   |   c    | html  | vim   | other
" ----+-----------------+--------+--------+-------+-------+---------------------
"   a | l     l         |        |        |       |       |
"   b | b     -  -  b   | +Pu    | +eb+Eb |       |       |
"   c | l     b         | +u     |        |       |       |
"   d | b     b  b      |        |        |       |       |
"   e | Pl          Pl  |        | +l+Pu  |       |       |
"   f | b(eb) - - b     |        |        |       | /u    | zsh:+el
"   g |                 |        |        |       |       |
"   h | b(el) - - b(el) | /u     |        |       |       | sh:/u+eu
"   i | l     l  -  l   |        |        |       |       |
"   j |                 |        |        |       |       |
"   k |                 |        |        |       |       |
"   l | l               | +Pu    |        |       |       | make:+u
"   m | l     l         | /[in]m | +u     |       |       |
"   n | l               | /l+u   |        | /l    | /l    |
"   o | l               |        |        |       |       |
"   p | -     -  -  b   | +el    |        |       |       |
"   q | b(eb)           | +Pl    |        |       |       |
"   r |                 | +u     |        |       |       |
"   s | l(el) - - b     | +u     | +u     |       | +u+eu | make,perl,zsh:+u
"   t | b(el) - - l     | +eu    |        |       |       |
"   u | l     -  -  b   |        |        | +u    | +u    |
"   v |                 |        |        |       |       |
"   w | b     -  -  b   |        |        |       |       |
"   x |                 |        |        |       |       |
"   y | l     l  l      |        |        |       |       |
"   z |                 |        |        |       |       |
" ' " | b               | /b     |        |       |       |
" ; : | 1               |        |        |       |       |
" , . | b     2  - 1    |        |        | +e2   |       |
" ? ! |                 |        |        |       |       |
" < > |                 | +b     |        | +b+eb | +1    |
" - _ |                 | +1     |        | +b    |       |
" @ / | b               |        |        |       |       |
"   = |                 |        |        |       |       |
"
"{{{4 insert 
inoremap ,<SPACE>     ,<SPACE>
inoremap ,<Esc>       ,
inoremap ,<BS>        <Nop>
inoremap ,ef           <C-o>I{<C-m><C-o>o}<C-o>O
inoremap ,eF            <C-m>{<C-m><C-o>o}<C-o>O
inoremap ,F              {<C-o>o}<C-o>O
inoremap ,f               {}<C-\><C-o>h
inoremap ,h               []<C-\><C-o>h
inoremap ,s               ()<C-\><C-o>h
inoremap ,u            <LT>><C-\><C-o>h
inoremap ,es               (<C-\><C-o>E<C-o>a)<C-\><C-o>h
inoremap ,H           [[::]]<C-o>F:
inoremap ,eh            [::]<C-o>F:
inoremap ,,                \
inoremap ,.           <C-o>==
inoremap ,w           <C-o>w
inoremap ,W           <C-o>W
inoremap ,b           <C-o>b
inoremap ,B           <C-o>B
inoremap ,a           <C-o>A
inoremap ,i           <C-o>I
inoremap ,l           <C-o>o
inoremap ,o           <C-o>O
inoremap ,dw          <C-o>"zdaw
inoremap ,p           <C-o>"zp
inoremap ,P           <C-o>"zP
inoremap ,yw          <C-o>"zyaw
inoremap ,y           <C-o>"zy
inoremap ,d           <C-o>"zd
inoremap ,D           <C-o>"_d
inoremap ,c           <C-o>:call<SPACE>NERDComment(0,"toggle")<C-m>
inoremap ,ec          <C-o>:call<SPACE>NERDComment(0,"toEOL")<C-m>
inoremap ,t                                <C-r>=Tr3transliterate(input("Translit: "))<C-m>
inoremap ,T           <C-o>b<C-o>"tdiw<C-r><C-r>=Tr3transliterate(@t)<C-m>
inoremap ,et          <C-o>B<C-o>"tdiW<C-r><C-r>=Tr3transliterate(@t)<C-m>
inoremap ,/            <C-x><C-f>
inoremap ,@                 <C-o>:w!<C-m>
inoremap ,;                 <C-o>%
inoremap ,m           <C-\><C-o>:call system("make &")<C-m>
inoremap ,n           \<C-m>
inoremap ,q           «»<C-\><C-o>h
inoremap ,Q           „“&lt;C-\><C-o>h
inoremap ,eq          “”&lt;C-\><C-o>h
inoremap ,eQ          ‘’&lt;C-\><C-o>h
inoremap ,"           ""<C-\><C-o>h
inoremap ,'           ''<C-\><C-o>h

"{{{4 visual 
vnoremap ,y                "zy
vnoremap ,d                "zd
vnoremap ,D                "_d
vnoremap ,p                "zp

"{{{4 command 
cnoremap ,s                ()<Left>
cnoremap ,S              \(\)<Left><Left>
cnoremap ,U           \<LT>\><Left><Left>
cnoremap ,u             <LT>><Left>
cnoremap ,F               \{}<Left>
cnoremap ,f                {}<Left>
cnoremap ,h                []<Left>
cnoremap ,H            [[::]]<Left><Left><Left>
cnoremap ,eh             [::]<Left><Left>
cnoremap ,i                  <Home>
cnoremap ,a                  <End>
cnoremap ,,                \
cnoremap ,.           <C-r>:
cnoremap ,p           <C-r>"
cnoremap ,P           <C-r>+
cnoremap ,z           <C-r>z
cnoremap ,t           <C-r>=Tr3transliterate(input("Translit: "))<C-m>
cnoremap ,b           <C-Left>
cnoremap ,w           <C-Right>
cnoremap ,B           <C-Left>
cnoremap ,W           <C-Right>

"{{{4 normal 
nnoremap ,C                     :!
nnoremap ,c           :call<SPACE>NERDComment(0,"toggle")<C-m>
nnoremap ,d           "_
nnoremap ,D           "_d
nnoremap ,m           :call system("make &")<C-m>
nnoremap ,a           $
nnoremap ,i           ^
nnoremap ,,           ==
nnoremap ,y           "zy
nnoremap ,p           "zp
nnoremap ,P           "zP

"{{{1 Functions 

"{{{1 
nohlsearch
" vim: ft=vim:fenc=utf-8:ts=4 
```

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2009-11-20T21:16:38.927

没有 TAB 完成我活不下去

```
" Intelligent tab completion
inoremap <silent> <Tab> <C-r>=<SID>InsertTabWrapper(1)<CR>
inoremap <silent> <S-Tab> <C-r>=<SID>InsertTabWrapper(-1)<CR>

function! <SID>InsertTabWrapper(direction)
    let idx = col('.') - 1
    let str = getline('.')

    if a:direction > 0 && idx >= 2 && str[idx - 1] == ' '
                \&& str[idx - 2] =~? '[a-z]'
        if &softtabstop && idx % &softtabstop == 0
            return "\<BS>\<Tab>\<Tab>"
        else
            return "\<BS>\<Tab>"
        endif
    elseif idx == 0 || str[idx - 1] !~? '[a-z]'
        return "\<Tab>"
    elseif a:direction > 0
        return "\<C-p>"
    else
        return "\<C-n>"
    endif
endfunction 
```

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2009-10-28T20:04:17.540

除了我的 vimrc，我还有更多的插件。一切都存储在[http://github.com/jceb/vimrc](http://github.com/jceb/vimrc)的 git 存储库中。

```
" Author: Jan Christoph Ebersbach jceb AT e-jc DOT de

""""""""""""""""""""""""""""""""""""""""""""""""""
" ---------- Settings ----------
"
""""""""""""""""""""""""""""""""""""""""""""""""""

" Prevent modelines in files from being evaluated (avoids a potential
" security problem wherein a malicious user could write a hazardous
" modeline into a file) (override default value of 5)
set modeline
set modelines=5

" ########## miscellaneous options ##########
set nocompatible               " Use Vim defaults instead of 100% vi compatibility
set whichwrap=<,>              " Cursor key move the cursor to the next/previous line if pressed at the end/beginning of a line
set backspace=indent,eol,start " more powerful backspacing
set viminfo='20,\"50           " read/write a .viminfo file, don't store more than
set history=100                " keep 50 lines of command line history
set incsearch                  " Incremental search
set hidden                     " hidden allows to have modified buffers in background
set noswapfile                 " turn off backups and files
set nobackup                   " Don't keep a backup file
set magic                      " special characters that can be used in search patterns
set grepprg=grep\ --exclude='*.svn-base'\ -n\ $*\ /dev/null " don't grep through svn-base files
" Try do use the ack program when available
let tmp = ''
for i in ['ack', 'ack-grep']
 let tmp = substitute (system ('which '.i), '\n.*', '', '')
 if v:shell_error == 0
  exec "set grepprg=".tmp."\\ -a\\ -H\\ --nocolor\\ --nogroup"
  break
 endif
endfor
unlet tmp
"set autowrite                                               " Automatically save before commands like :next and :make
" Suffixes that get lower priority when doing tab completion for filenames.
" These are files we are not likely to want to edit or read.
set suffixes=.bak,~,.swp,.o,.info,.aux,.log,.dvi,.bbl,.blg,.brf,.cb,.ind,.idx,.ilg,.inx,.out,.toc,.pdf,.exe
"set autochdir                  " move to the directory of the edited file
set ssop-=options              " do not store global and local values in a session
set ssop-=folds                " do not store folds

" ########## visual options ##########
set wildmenu             " When 'wildmenu' is on, command-line completion operates in an enhanced mode.
set wildcharm=<C-Z>
set showmode             " If in Insert, Replace or Visual mode put a message on the last line.
set guifont=monospace\ 8 " guifont + fontsize
set guicursor=a:blinkon0 " cursor-blinking off!!
set ruler                " show the cursor position all the time
set nowrap               " kein Zeilenumbruch
set foldmethod=indent    " Standardfaltungsmethode
set foldlevel=99         " default fold level
set winminheight=0       " Minimal Windowheight
set showcmd              " Show (partial) command in status line.
set showmatch            " Show matching brackets.
set matchtime=2          " time to show the matching bracket
set hlsearch             " highlight search
set linebreak
set lazyredraw           " no readraw when running macros
set scrolloff=3          " set X lines to the curors - when moving vertical..
set laststatus=2         " statusline is always visible
set statusline=(%{bufnr('%')})\ %t\ \ %r%m\ #%{expand('#:t')}\ (%{bufnr('#')})%=[%{&fileformat}:%{&fileencoding}:%{&filetype}]\ %l,%c\ %P " statusline
"set mouse=n             " mouse only in normal mode support in vim
"set foldcolumn=1        " show folds
set number               " draw linenumbers
set nolist               " list nonprintable characters
set sidescroll=0         " scroll X columns to the side instead of centering the cursor on another screen
set completeopt=menuone  " show the complete menu even if there is just one entry
set listchars+=precedes:<,extends:> " display the following nonprintable characters
if $LANG =~ ".*\.UTF-8$" || $LANG =~ ".*utf8$" || $LANG =~ ".*utf-8$"
 set listchars+=tab:»·,trail:·" display the following nonprintable characters
endif
set guioptions=aegitcm   " disabled menu in gui mode
"set guioptions=aegimrLtT
set cpoptions=aABceFsq$  " q: When joining multiple lines leave the cursor at the position where it would be when joining two lines.
" $:  When making a change to one line, don't redisplay the line, but put a '$' at the end of the changed text.
" v: Backspaced characters remain visible on the screen in Insert mode.

colorscheme peaksea " default color scheme

" default color scheme
" if &term == '' || &term == 'builtin_gui' || &term == 'dumb'
if has('gui_running')
 set background=light " use colors that fit to a light background
else
 set background=light " use colors that fit to a light background
 "set background=dark " use colors that fit to a dark background
endif

syntax on " syntax highlighting

" ########## text options ##########
set smartindent              " always set smartindenting on
set autoindent               " always set autoindenting on
set backspace=2              " Influences the working of <BS>, <Del>, CTRL-W and CTRL-U in Insert mode.
set textwidth=0              " Don't wrap words by default
set shiftwidth=4             " number of spaces to use for each step of indent
set tabstop=4                " number of spaces a tab counts for
set noexpandtab              " insert spaces instead of tab
set smarttab                 " insert spaces only at the beginning of the line
set ignorecase               " Do case insensitive matching
set smartcase                " overwrite ignorecase if pattern contains uppercase characters
set formatoptions=lcrqn      " no automatic linebreak
set pastetoggle=<F11>        " put vim in pastemode - usefull for pasting in console-mode
set fileformats=unix,dos,mac " favorite fileformats
set encoding=utf-8           " set default-encoding to utf-8
set iskeyword+=_,-           " these characters also belong to a word
set matchpairs+=<:>

""""""""""""""""""""""""""""""""""""""""""""""""""
" ---------- Special Configuration ----------
"
""""""""""""""""""""""""""""""""""""""""""""""""""

" ########## determine terminal encoding ##########
"if has("multi_byte") && &term != 'builtin_gui'
"    set termencoding=utf-8
"
"    " unfortunately the normal xterm supports only latin1
"    if $TERM == "xterm" || $TERM == "xterm-color" || $TERM == "screen" || $TERM == "linux" || $TERM_PROGRAM == "GLterm"
"        let propv = system("xprop -id $WINDOWID -f WM_LOCALE_NAME 8s ' $0' -notype WM_LOCALE_NAME")
"        if propv !~ "WM_LOCALE_NAME .*UTF.*8"
"            set termencoding=latin1
"        endif
"    endif
"    " for the possibility of using a terminal to input and read chinese
"    " characters
"    if $LANG == "zh_CN.GB2312"
"        set termencoding=euc-cn
"    endif
"endif

" Set paper size from /etc/papersize if available (Debian-specific)
if filereadable('/etc/papersize')
 let s:papersize = matchstr(system('/bin/cat /etc/papersize'), '\p*')
 if strlen(s:papersize)
  let &printoptions = "paper:" . s:papersize
 endif
 unlet! s:papersize
endif

""""""""""""""""""""""""""""""""""""""""""""""""""
" ---------- Autocommands ----------
"
""""""""""""""""""""""""""""""""""""""""""""""""""

filetype plugin on " automatically load filetypeplugins
filetype indent on " indent according to the filetype

if !exists("autocommands_loaded")
 let autocommands_loaded = 1

 augroup templates
  " read templates
  " au BufNewFile ?akefile,*.mk TSkeletonSetup Makefile
  " au BufNewFile *.tex TSkeletonSetup latex.tex
  " au BufNewFile build*.xml TSkeletonSetup antbuild.xml
  " au BufNewFile test*.py,*Test.py TSkeletonSetup pyunit.py
  " au BufNewFile *.py TSkeletonSetup python.py
 augroup END

 augroup filetypesettings
  " Do word completion automatically
  au FileType debchangelog setl expandtab
  au FileType asciidoc,mkd,txt,mail call DoFastWordComplete()
  au FileType tex,plaintex setlocal makeprg=pdflatex\ \"%:p\"
  au FileType mkd setlocal autoindent
  au FileType java,c,cpp setlocal noexpandtab nosmarttab
  au FileType mail setlocal textwidth=70
  au FileType mail call FormatMail()
  au FileType mail setlocal formatoptions=tcrqan
  au FileType mail setlocal comments+=b:--
  au FileType txt setlocal formatoptions=tcrqn textwidth=72
  au FileType asciidoc,mkd,tex setlocal formatoptions=tcrq textwidth=72
  au FileType xml,docbk,xhtml,jsp setlocal formatoptions=tcrqn
  au FileType ruby setlocal shiftwidth=2

  au BufReadPost,BufNewFile *  set formatoptions-=o " o is really annoying
  au BufReadPost,BufNewFile *  call ReadIncludePath()

  " Special Makefilehandling
  au FileType automake,make setlocal list noexpandtab

  au FileType xsl,xslt,xml,html,xhtml runtime! scripts/closetag.vim

  " Omni completion settings
  "au FileType c  setlocal completefunc=ccomplete#Complete
  au FileType css setlocal omnifunc=csscomplete#CompleteCSS
  "au FileType html setlocal completefunc=htmlcomplete#CompleteTags
  "au FileType js setlocal completefunc=javascriptcomplete#CompleteJS
  "au FileType php setlocal completefunc=phpcomplete#CompletePHP
  "au FileType python setlocal completefunc=pythoncomplete#Complete
  "au FileType ruby setlocal completefunc=rubycomplete#Complete
  "au FileType sql setlocal completefunc=sqlcomplete#Complete
  "au FileType *  setlocal completefunc=syntaxcomplete#Complete
  "au FileType xml setlocal completefunc=xmlcomplete#CompleteTags

  au FileType help setlocal nolist

  " insert a prompt for every changed file in the commit message
  "au FileType svn :1![ -f "%" ] && awk '/^[MDA]/ { print $2 ":\n - " }' %
 augroup END

 augroup hooks
  " replace "Last Modified: with the current time"
  au BufWritePre,FileWritePre * call LastMod()

  " line highlighting in insert mode
  autocmd InsertLeave * set nocul
  autocmd InsertEnter * set cul

  " move to the directory of the edited file
  "au BufEnter *      if isdirectory (expand ('%:p:h')) | cd %:p:h | endif

  " jump to last position in the file
  au BufRead *  if line("'\"") > 0 && line("'\"") <= line("$") && &filetype != "mail" | exe "normal g`\"" | endif
  " jump to last position every time a buffer is entered
  "au BufEnter *  if line("'x") > 0 && line("'x") <= line("$") && line("'y") > 0 && line("'y") <= line("$") && &filetype != "mail" | exe "normal g'yztg`x" | endif
  "au BufLeave *  if &modifiable | exec "normal mxHmy"
 augroup END

 augroup highlight
  " make visual mode dark cyan
  au FileType * hi Visual ctermfg=Black ctermbg=DarkCyan gui=bold guibg=#a6caf0
  " make cursor red
  au BufEnter,BufRead,WinEnter * :call SetCursorColor()

  " hightlight trailing spaces and tabs and the defined print margin
  "au FileType * hi WhiteSpaceEOL_Printmargin ctermfg=black ctermbg=White guifg=Black guibg=White
  au FileType * hi WhiteSpaceEOL_Printmargin ctermbg=White guibg=White
  au FileType * let m='' | if &textwidth > 0 | let m='\|\%' . &textwidth . 'v.' | endif | exec 'match WhiteSpaceEOL_Printmargin /\s\+$' . m .'/'
 augroup END
endif

""""""""""""""""""""""""""""""""""""""""""""""""""
" ---------- Functions ----------
"
""""""""""""""""""""""""""""""""""""""""""""""""""

" set cursor color
function! SetCursorColor()
 hi Cursor ctermfg=black ctermbg=red guifg=Black guibg=Red
endfunction
call SetCursorColor()

" change dir the root of a debian package
function! GetPackageRoot()
 let sd = getcwd()
 let owd = sd
 let cwd = owd
 let dest = sd
 while !isdirectory('debian')
  lcd ..
  let owd = cwd
  let cwd = getcwd()
  if cwd == owd
   break
  endif
 endwhile
 if cwd != sd && isdirectory('debian')
  let dest = cwd
 endif
 return dest
endfunction

" vim tip: Opening multiple files from a single command-line
function! Sp(dir, ...)
 let split = 'sp'
 if a:dir == '1'
  let split = 'vsp'
 endif
 if(a:0 == 0)
  execute split
 else
  let i = a:0
  while(i > 0)
   execute 'let files = glob (a:' . i . ')'
   for f in split (files, "\n")
    execute split . ' ' . f
   endfor
   let i = i - 1
  endwhile
  windo if expand('%') == '' | q | endif
 endif
endfunction
com! -nargs=* -complete=file Sp call Sp(0, <f-args>)
com! -nargs=* -complete=file Vsp call Sp(1, <f-args>)

" reads the file .include_path - useful for C programming
function! ReadIncludePath()
 let include_path = expand("%:p:h") . '/.include_path'
 if filereadable(include_path)
  for line in readfile(include_path, '')
   exec "setl path +=," . line
  endfor
 endif
endfunction

" update last modified line in file
fun! LastMod()
 let line = line(".")
 let column = col(".")
 let search = @/

 " replace Last Modified in the first 20 lines
 if line("$") > 20
  let l = 20
 else
  let l = line("$")
 endif
 " replace only if the buffer was modified
 if &mod == 1
  silent exe "1," . l . "g/Last Modified:/s/Last Modified:.*/Last Modified: " .
     \ strftime("%a %d. %b %Y %T %z %Z") . "/"
 endif
 let @/ = search

 " set cursor to last position before substitution
 call cursor(line, column)
endfun

" toggles show marks plugin
"fun! ToggleShowMarks()
" if exists('b:sm') && b:sm == 1
"  let b:sm=0
"  NoShowMarks
"  setl updatetime=4000
" else
"  let b:sm=1
"  setl updatetime=200
"  DoShowMarks
" endif
"endfun

" reformats an email
fun! FormatMail()
 " workaround for the annoying mutt send-hook behavoir
 silent! 1,/^$/g/^X-To: .*/exec 'normal gg'|exec '/^To: /,/^Cc: /-1d'|1,/^$/s/^X-To: /To: /|exec 'normal dd'|exec '?Cc'|normal P
 silent! 1,/^$/g/^X-Cc: .*/exec 'normal gg'|exec '/^Cc: /,/^Bcc: /-1d'|1,/^$/s/^X-Cc: /Cc: /|exec 'normal dd'|exec '?Bcc'|normal P
 silent! 1,/^$/g/^X-Bcc: .*/exec 'normal gg'|exec '/^Bcc: /,/^Subject: /-1d'|1,/^$/s/^X-Bcc: /Bcc: /|exec 'normal dd'|exec '?Subject'|normal P

 " delete signature
 silent! /^> --[\t ]*$/,/^-- $/-2d
 " fix quotation
 silent! /^\(On\|In\) .*$/,/^-- $/-1:s/>>/> >/g
 silent! /^\(On\|In\) .*$/,/^-- $/-1:s/>\([^\ \t]\)/> \1/g
 " delete inner and trailing spaces
 normal :%s/[\xa0\x0d\t ]\+$//g
 normal :%s/\([^\xa0\x0d\t ]\)[\xa0\x0d\t ]\+\([^\xa0\x0d\t ]\)/\1 \2/g
 " format text
 normal gg
 " convert bad formated umlauts to real characters
 normal :%s/\\\([0-9]*\)/\=nr2char(submatch(1))/g
 normal :%s/&#\([0-9]*\);/\=nr2char(submatch(1))/g
 " break undo sequence
 normal iu
 exec 'silent! /\(^\(On\|In\) .*$\|\(schrieb\|wrote\):$\)/,/^-- $/-1!par '.&tw.'gqs0'
 " place the cursor before my signature
 silent! /^-- $/-1
 " clear search buffer
 let @/ = ""
endfun

" insert selection at mark a
fun! Insert() range
 exe "normal vgvmzomy\<Esc>"
 normal `y
 let lineA = line(".")
 let columnA = col(".")

 normal `z
 let lineB = line(".")
 let columnB = col(".")

 " exchange marks
 if lineA > lineB || lineA <= lineB && columnA > columnB
  " save z in c
  normal mc
  " store y in z
  normal `ymz
  " set y to old z
  normal `cmy
 endif

 exe "normal! gvd`ap`y"
endfun

" search with the selection of the visual mode
fun! VisualSearch(direction) range
 let l:saved_reg = @"
 execute "normal! vgvy"
 let l:pattern = escape(@", '\\/.*$^~[]')
 let l:pattern = substitute(l:pattern, "\n$", "", "")
 if a:direction == '#'
  execute "normal! ?" . l:pattern . "^M"
 elseif a:direction == '*'
  execute "normal! /" . l:pattern . "^M"
 elseif a:direction == '/'
  execute "normal! /" . l:pattern
 else
  execute "normal! ?" . l:pattern
 endif
 let @/ = l:pattern
 let @" = l:saved_reg
endfun

" 'Expandvar' expands the variable under the cursor
fun! <SID>Expandvar()
 let origreg = @"
 normal yiW
 if (@" == "@\"")
  let @" = origreg
 else
  let @" = eval(@")
 endif
 normal diW"0p
 let @" = origreg
endfun

" execute the bc calculator
fun! <SID>Bc(exp)
 setlocal paste
 normal mao
 exe ":.!echo 'scale=2; " . a:exp . "' | bc"
 normal 0i "bDdd`a"bp
 setlocal nopaste
endfun

fun! <SID>RFC(number)
 silent exe ":e http://www.ietf.org/rfc/rfc" . a:number . ".txt"
endfun

" The function Nr2Hex() returns the Hex string of a number.
func! Nr2Hex(nr)
 let n = a:nr
 let r = ""
 while n
  let r = '0123456789ABCDEF'[n % 16] . r
  let n = n / 16
 endwhile
 return r
endfunc

" The function String2Hex() converts each character in a string to a two
" character Hex string.
func! String2Hex(str)
 let out = ''
 let ix = 0
 while ix < strlen(a:str)
  let out = out . Nr2Hex(char2nr(a:str[ix]))
  let ix = ix + 1
 endwhile
 return out
endfunc

" translates hex value to the corresponding number
fun! Hex2Nr(hex)
 let r = 0
 let ix = strlen(a:hex) - 1
 while ix >= 0
  let val = 0
  if a:hex[ix] == '1'
   let val = 1
  elseif a:hex[ix] == '2'
   let val = 2
  elseif a:hex[ix] == '3'
   let val = 3
  elseif a:hex[ix] == '4'
   let val = 4
  elseif a:hex[ix] == '5'
   let val = 5
  elseif a:hex[ix] == '6'
   let val = 6
  elseif a:hex[ix] == '7'
   let val = 7
  elseif a:hex[ix] == '8'
   let val = 8
  elseif a:hex[ix] == '9'
   let val = 9
  elseif a:hex[ix] == 'a' || a:hex[ix] == 'A'
   let val = 10
  elseif a:hex[ix] == 'b' || a:hex[ix] == 'B'
   let val = 11
  elseif a:hex[ix] == 'c' || a:hex[ix] == 'C'
   let val = 12
  elseif a:hex[ix] == 'd' || a:hex[ix] == 'D'
   let val = 13
  elseif a:hex[ix] == 'e' || a:hex[ix] == 'E'
   let val = 14
  elseif a:hex[ix] == 'f' || a:hex[ix] == 'F'
   let val = 15
  endif
  let r = r + val * Power(16, strlen(a:hex) - ix - 1)
  let ix = ix - 1
 endwhile
 return r
endfun

" mathematical power function
fun! Power(base, exp)
 let r = 1
 let exp = a:exp
 while exp > 0
  let r = r * a:base
  let exp = exp - 1
 endwhile
 return r
endfun

" Captialize movent/selection
function! Capitalize(type, ...)
  let sel_save = &selection
  let &selection = "inclusive"
  let reg_save = @@

  if a:0  " Invoked from Visual mode, use '< and '> marks.
 silent exe "normal! `<" . a:type . "`>y"
  elseif a:type == 'line'
 silent exe "normal! '[V']y"
  elseif a:type == 'block'
 silent exe "normal! `[\<C-V>`]y"
  else
 silent exe "normal! `[v`]y"
  endif

  silent exe "normal! `[gu`]~`]"

  let &selection = sel_save
  let @@ = reg_save
endfunction

" Find file in current directory and edit it.
function! Find(...)
  let path="."
  if a:0==2
    let path=a:2
  endif
  let l:list=system("find ".path. " -name '".a:1."' | grep -v .svn ")
  let l:num=strlen(substitute(l:list, "[^\n]", "", "g"))
  if l:num < 1
    echo "'".a:1."' not found"
    return
  endif
  if l:num != 1
    let tmpfile = tempname()
    exe "redir! > " . tmpfile
    silent echon l:list
    redir END
    let old_efm = &efm
    set efm=%f

    if exists(":cgetfile")
        execute "silent! cgetfile " . tmpfile
    else
        execute "silent! cfile " . tmpfile
    endif

    let &efm = old_efm

    " Open the quickfix window below the current window
    botright copen

    call delete(tmpfile)
  endif
endfunction

""""""""""""""""""""""""""""""""""""""""""""""""""
" ---------- Plugin Settings ----------
"
""""""""""""""""""""""""""""""""""""""""""""""""""

" hide dotfiles by default - the gh mapping quickly changes this behavior
let g:netrw_list_hide = '\(^\|\s\s\)\zs\.\S\+'

" Do not go to active window.
"let g:bufExplorerFindActive = 0
" Don't show directories.
"let g:bufExplorerShowDirectories = 0
" Sort by full file path name.
"let g:bufExplorerSortBy = 'fullpath'
" Show relative paths.
"let g:bufExplorerShowRelativePath = 1

" don't allow autoinstalling of scripts
let g:GetLatestVimScripts_allowautoinstall = 0

" load manpage-plugin
runtime! ftplugin/man.vim

" load matchit-plugin
runtime! macros/matchit.vim

" minibuf explorer
"let g:miniBufExplModSelTarget = 1
"let g:miniBufExplorerMoreThanOne = 0
"let g:miniBufExplModSelTarget = 0
"let g:miniBufExplUseSingleClick = 1
"let g:miniBufExplMapWindowNavVim = 1
"let g:miniBufExplVSplit = 25
"let g:miniBufExplSplitBelow = 1
"let g:miniBufExplForceSyntaxEnable = 1
"let g:miniBufExplTabWrap = 1

" calendar plugin
" let g:calendar_weeknm = 4

" xml-ftplugin configuration
let xml_use_xhtml = 1

" :ToHTML
let html_number_lines = 1
let html_use_css = 1
let use_xhtml = 1

" LatexSuite
"let g:Tex_DefaultTargetFormat = 'pdf'
"let g:Tex_Diacritics = 1

" python-highlightings
let python_highlight_all = 1

" Eclim settings
"let org.eclim.user.name     = g:tskelUserName
"let org.eclim.user.email    = g:tskelUserEmail
"let g:EclimLogLevel         = 4 " info
"let g:EclimBrowser          = "x-www-browser"
"let g:EclimShowCurrentError = 1
" nnoremap <silent> <buffer> <tab> :call eclim#util#FillTemplate("${", "}")<CR>
" nnoremap <silent> <buffer> <leader>i :JavaImport<CR>
" nnoremap <silent> <buffer> <leader>d :JavaDocSearch -x declarations<CR>
" nnoremap <silent> <buffer> <CR> :JavaSearchContext<CR>
" nnoremap <silent> <buffer> <CR> :AntDoc<CR>

" quickfix notes plugin
map <Leader>n <Plug>QuickFixNote
nnoremap <F6> :QFNSave ~/.vimquickfix/
nnoremap <S-F6> :e ~/.vimquickfix/
nnoremap <F7> :cgetfile ~/.vimquickfix/
nnoremap <S-F7> :caddfile ~/.vimquickfix/
nnoremap <S-F8> :!rm ~/.vimquickfix/

" EnhancedCommentify updated keybindings
vmap <Leader><Space> <Plug>VisualTraditional
nmap <Leader><Space> <Plug>Traditional
let g:EnhCommentifyTraditionalMode = 'No'
let g:EnhCommentifyPretty = 'No'
let g:EnhCommentifyRespectIndent = 'Yes'

" FuzzyFinder keybinding
nnoremap <leader>fb :FufBuffer<CR>
nnoremap <leader>fd :FufDir<CR>
nnoremap <leader>fD :FufDir <C-r>=expand('%:~:.:h').'/'<CR><CR>
nmap <leader>Fd <leader>fD
nmap <leader>FD <leader>fD
nnoremap <leader>ff :FufFile<CR>
nnoremap <leader>fF :FufFile <C-r>=expand('%:~:.:h').'/'<CR><CR>
nmap <leader>FF <leader>fF
nnoremap <leader>ft :FufTextMate<CR>
nnoremap <leader>fr :FufRenewCache<CR>
"let g:FuzzyFinderOptions = {}
"let g:FuzzyFinderOptions = { 'Base':{}, 'Buffer':{}, 'File':{}, 'Dir':{},
   "\                      'MruFile':{}, 'MruCmd':{}, 'Bookmark':{},
   "\                      'Tag':{}, 'TaggedFile':{},
   "\                      'GivenFile':{}, 'GivenDir':{}, 'GivenCmd':{},
   "\                      'CallbackFile':{}, 'CallbackItem':{}, }
let g:fuf_onelinebuf_location  = 'botright'
let g:fuf_maxMenuWidth     = 300
let g:fuf_file_exclude     = '\v\~$|\.o$|\.exe$|\.bak$|\.swp$|((^|[/\\])\.[/\\]$)|\.pyo|\.pyc|autom4te\.cache|blib|_build|\.bzr|\.cdv|cover_db|CVS|_darcs|\~\.dep|\~\.dot|\.git|\.hg|\~\.nib|\.pc|\~\.plst|RCS|SCCS|_sgbak|\.svn'

" YankRing
nnoremap <silent> <F8> :YRShow<CR>
let g:yankring_history_file = '.yankring_history_file'
let g:yankring_replace_n_pkey = '<c-\>'
let g:yankring_replace_n_nkey = '<c-m>'

" supertab
let g:SuperTabDefaultCompletionType = "<c-n>"

" TagList
let Tlist_Show_One_File = 1

" UltiSnips
"let g:UltiSnipsJumpForwardTrigger = "<tab>"
"let g:UltiSnipsJumpBackwardTrigger = "<S-tab>"

" NERD Commenter
nmap <leader><space> <plug>NERDCommenterToggle
vmap <leader><space> <plug>NERDCommenterToggle
imap <C-c> <ESC>:call NERDComment(0, "insert")<CR>

" disable unused Mark mappings
nmap <leader>_r <plug>MarkRegex
vmap <leader>_r <plug>MarkRegex
nmap <leader>_n <plug>MarkClear
vmap <leader>_n <plug>MarkClear
nmap <leader>_* <plug>MarkSearchCurrentNext
nmap <leader>_# <plug>MarkSearchCurrentPrev
nmap <leader>_/ <plug>MarkSearchAnyNext
nmap <leader>_# <plug>MarkSearchAnyPrev
nmap <leader>__* <plug>MarkSearchNext
nmap <leader>__# <plug>MarkSearchPrev

" Nerd Tree explorer mapping
nmap <leader>e :NERDTree<CR>

" TaskList settings
let g:tlWindowPosition = 1

""""""""""""""""""""""""""""""""""""""""""""""""""
" ---------- Keymappings ----------
"
""""""""""""""""""""""""""""""""""""""""""""""""""

" edit/reload .vimrc-Configuration
nnoremap gce :e $HOME/.vimrc<CR>
nnoremap gcl :source $HOME/.vimrc<CR>:echo "Configuration reloaded"<CR>

" un/hightlight current line
nnoremap <silent> <Leader>H :match<CR>
nnoremap <silent> <Leader>h mk:exe 'match Search /<Bslash>%'.line(".").'l/'<CR>

" spellcheck off, german, englisch
nnoremap gsg :setlocal invspell spelllang=de<CR>
nnoremap gse :setlocal invspell spelllang=en<CR>

" switch to previous/next buffer
nnoremap <silent> <c-p> :bprevious<CR>
nnoremap <silent> <c-n> :bnext<CR>

" kill/delete trailing spaces and tabs
nnoremap <Leader>kt msHmt:silent! %s/[\t \x0d]\+$//g<CR>:let @/ = ""<CR>:echo "Deleted trailing spaces"<CR>'tzt`s
vnoremap <Leader>kt :s/[\t \x0d]\+$//g<CR>:let @/ = ""<CR>:echo "Deleted trailing, spaces"<CR>

" kill/reduce inner spaces and tabs to a single space/tab
nnoremap <Leader>ki msHmt:silent! %s/\([^\xa0\x0d\t ]\)[\xa0\x0d\t ]\+\([^\xa0\x0d\t ]\)/\1 \2/g<CR>:let @/ = ""<CR>:echo "Deleted inner spaces"<CR>'tzt`s
vnoremap <Leader>ki :s/\([^\xa0\x0d\t ]\)[\xa0\x0d\t ]\+\([^\xa0\x0d\t ]\)/\1 \2/g<CR>:let @/ = ""<CR>:echo "Deleted inner spaces"<CR>

" start new undo sequences when using certain commands in insert mode
inoremap <C-U> <C-G>u<C-U>
inoremap <C-W> <C-G>u<C-W>
inoremap <BS> <C-G>u<BS>
inoremap <C-H> <C-G>u<C-H>
inoremap <Del> <C-G>u<Del>

" swap two words
" http://www.vim.org/tips/tip.php?tip_id=329
nmap <silent> gw "_yiw:s/\(\%#[ÄÖÜäöüßa-zA-Z0-9]\+\)\(\_W\+\)\([ÄÖÜäöüßa-zA-Z0-9]\+\)/\3\2\1/<CR><C-o><C-l>:let @/ = ""<CR>
nmap <silent> gW "_yiW:s/\(\%#[ÄÖÜäöüßa-zA-Z0-9-+*_]\+\)\(\_W\+\)\([ÄÖÜäöüßa-zA-Z0-9-+*_]\+\)/\3\2\1/<CR><C-o><C-l>:let @/ = ""<CR>

" Capitalize movement
nnoremap <silent> gC :set opfunc=Capitalize<CR>g@
vnoremap <silent> gC :<C-U>call Capitalize(visualmode(), 1)<CR>

" delete search-register
nnoremap <silent> <leader>/ :let @/ = ""<CR>

" browse current buffer/selection in www-browser
nnoremap <Leader>b :!x-www-browser %:p<CR>:echo "WWW-Browser started"<CR>
vnoremap <Leader>b y:!x-www-browser <C-R>"<CR>:echo "WWW-Browser started"<CR>

" lookup/translate inner/selected word in dictionary
" recode is only needed for non-utf-8-text
" nnoremap <Leader>T mayiw`a:exe "!dict -P - -- $(echo " . @" . "\| recode latin1..utf-8)"<CR>
"nnoremap <Leader>t mayiw`a:exe "!dict -P - -- " . @"<CR>
" vnoremap <Leader>T may`a:exe "!dict -P - -- $(echo " . @" . "\| recode latin1..utf-8)"<CR>
"vnoremap <Leader>t may`a:exe "!dict -P - -- " . @"<CR>

" delete words in insert mode like expected - doesn't work properly at
" the end of the line
inoremap <C-BS> <C-w>

" Switch buffers
nnoremap <silent> [b :ls<Bar>let nr = input("Buffer: ")<Bar>if nr != ''<Bar>exe ":b " . nr<Bar>endif<CR>
" Search for the occurence of the word under the cursor
nnoremap <silent> [I [I:le 
```

# autocomplete - 有人可以将模糊查询与 LuceneDictionary 解决方案进行比较吗？

> ID：164849
> 
> 赞同：1
> 
> 时间：2008-10-02T22:14:59.940
> 
> 标签：autocomplete, lucene, spell-checking

根据this post on [how to do query auto-completionsuggestions in lucene](https://stackoverflow.com/questions/120180/how-to-do-query-auto-completionsuggestions-in-lucene)获得“你是不是意思”功能最好涉及使用LuceneDictionary。但在阅读这篇文章之前，我可能会为此使用模糊查询。现在我想知道哪个更快，哪个更容易实现？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-29T11:09:57.480

你有没有看过一些 Lucene 的 NGram 包装器。它们是在 Lucene 中执行“您的意思是”功能的最佳方法。我为文档[找到了这个页面](http://lucene.apache.org/java/2_2_0/api/org/apache/lucene/analysis/ngram/package-summary.html)。

# javascript - 如何在 Yahoo 富文本编辑器中设置焦点

> ID：164855
> 
> 赞同：2
> 
> 时间：2008-10-02T22:15:53.727
> 
> 标签：javascript, html, richtext

我有一个 HTML 表单，其中包含 YAHOO 富文本编辑器。

当我显示表单时，我希望 YAHOO 编辑器具有焦点，以便光标准备好接受输入，而无需用户单击它或进入它

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T23:53:47.007

我从[YUI 图书馆](http://developer.yahoo.com/yui)的文档中得到了这个。特别是在标题为[Editor - Basic Buttons的示例中](http://developer.yahoo.com/yui/examples/editor/editor_adv_editor.html)

> `var myEditor = new YAHOO.widget.Editor('editor', {focusAtStart:true});`
> `myEditor.render();`

这里的关键是作为可选属性对象一部分的“focusAtStart”属性

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T22:21:12.640

我没有使用 YAHOO 富文本编辑器，但是如果您使用 window.onload 事件，它不会工作吗？-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-06T12:17:10.570

和 roenving 一样，我从未使用过 YAHOO 富文本编辑器，但它应该可以与`window.onload`事件一起使用。

假设您`id="yahoo_text_editor"`为您的 YAHOO 富文本编辑器指定。
然后做

```
<body onload="document.getElementById('yahoo_text_editor').focus()"> 
```

希望这可以帮助。

# vxworks - 什么是 vxWorks 共享内存锚？

> ID：164857
> 
> 赞同：0
> 
> 时间：2008-10-02T22:16:18.453
> 
> 标签：vxworks

在 vxWorks 内存映射中，有一个区域（在 vxWorks 的加载地址下方）被描述为“共享内存锚点”。

它是干什么用的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T22:17:39.667

在将多台单板计算机插入公共背板（例如 VMEbus）的环境中，VxWorks 的 VxMP 变体为常见的 VxWorks 对象添加了“本地”和“全局”属性。

例如，您可以在其中一台单板计算机上拥有一个“全局”消息队列，但可以从任何其他单板计算机（所有运行 VxWorks 和 VxMP）向该消息队列发送和接收消息.

为了实现这一壮举，在每台单板计算机上都标识了一个“共享内存”区域，并且所有板都知道所有其他板的共享内存地址，并且它们通过这些共享内存区域（和特殊驱动程序）进行通信。

当每块板子启动时，它必须发现它的共享内存区域在哪里，因此这个值就是“共享内存锚”。

# c# - 然后评估每个参数“模式”的分配是否有名称？

> ID：164858
> 
> 赞同：2
> 
> 时间：2008-10-02T22:16:24.820
> 
> 标签：c#

以下 C# 代码片段：

```
 int i = 1;
  string result = String.Format("{0},{1},{2}", i++, i++, i++);
  Console.WriteLine(result); 
```

写出：1,2,3

在我在编译器中尝试这个之前，我期待分配发生然后进行评估，所以我的预期输出是：1,1,1

所以我的问题是：这个分配然后评估每个参数的“模式”（它是否称为模式？）是否有一个名称？

编辑：我指的是评估参数并将参数分配给 String.Format() 函数的模式。不是 i 的递增。

（我可能在上面的问题中错误地使用了评估这个词，因为如果参数是（i + j）那么我们知道它会在分配之前被评估。在那个上下文中使用评估这个词时，我指的是i 的递增。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T22:29:10.840

在 C# 中，参数的**评估顺序**严格从左到右。当您评估表达式`i++`时，会`i`计算并推送 的值，然后`i`增加 的值。

System.Int32 上的 ++ 运算符实际上是一个具有特殊名称`++`和特殊语法的函数，通过编写对变量的引用和字符 ++ 来调用它。

所以实际上，你写的是

```
// assume this function is defined:
int Inc(ref int i)
{
  var old = i;
  i = i + 1;
  return old;
}

...
int i = 1;
string result = String.Format("{0},{1},{2}", Inc(ref i), Inc(ref i), Inc(ref i));
Console.WriteLine(result);
... 
```

由于参数是从左到右评估的，`Inc(ref i)`因此被调用 3 次，每次在传递to`i`的当前值后递增。这也正是您的代码中发生的情况。`i``String.Format(...)`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T22:37:11.057

函数的参数[在 C# 中从左到右](http://msdn.microsoft.com/en-us/library/aa691335.aspx)计算。在 C/C++ 中情况并非如此，标准规定评估顺序未定义。

# perl - 如何在列表中拆分管道分隔的字符串？

> ID：164865
> 
> 赞同：7
> 
> 时间：2008-10-02T22:17:20.900
> 
> 标签：perl, parsing

在工作中，我们正在开发一个客户可以使用的时事通讯系统。作为实习生，我的工作之一是帮助解决较小的难题。在这种情况下，我需要做的是扫描电子邮件服务器的日志以查找退回的邮件，并将电子邮件和电子邮件退回到“错误电子邮件数据库”的原因添加。

bad emails 表有两列：'email' 和 'reason' 我使用以下语句从日志中获取信息并将其发送到 Perl 脚本

```
grep " 550 " /var/log/exim/main.log | awk '{print $5 "|" $23 " " $24 " " $25 " " $26 " " $27 " " $28 " " $29 " " $30 " " $31 " " $32 " " $33}' | perl /devl/bademails/getbademails.pl 
```

如果您对更高效的 awk 脚本有建议，那么我也会很高兴听到这些建议，但我主要关注的是 Perl 脚本。awk 通过管道将“foo@bar.com|reason forbounce”传送到 Perl 脚本。我想接收这些字符串，将它们拆分为 | 并将两个不同的部分放入数据库中各自的列中。这是我所拥有的：

```
#!usr/bin/perl                                                                                                                                                                               

use strict;
use warnings;
use DBI;

my $dbpath = "dbi:mysql:database=system;host=localhost:3306";
my $dbh = DBI->connect($dbpath, "root", "******")
    or die "Can't open database: $DBI::errstr";

while(<STDIN>) {
    my $line = $_;                                    
    my @list = # ?  this is where i am confused
    for (my($i) = 0; $i < 1; $i++)
    {
        if (defined($list[$i]))
        {
            my @val = split('|', $list[$i]);
            print "Email: $val[0]\n";
            print "Reason: $val[1]";
            my $sth = $dbh->prepare(qq{INSERT INTO bademails VALUES('$val[0]', '$val[1]')});
            $sth->execute();                                                                                                  
            $sth->finish();                                                                                                                                                                              
        }
    }
}
exit 0; 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-02T22:28:58.907

像这样的东西会起作用：

```
while(<STDIN>) {
  my $line = $_;
  chomp($line);
  my ($email,$reason) = split(/\|/, $line);
  print "Email: $email\n";
  print "Reason: $reason";
  my $sth = $dbh->prepare(qq{INSERT INTO bademails VALUES(?, ?)});
  $sth->execute($email, $reason);                                                                                                  
  $sth->finish();                                                                                                                                                                              
} 
```

您可能会发现在 Perl 中完成所有事情会更容易。"next unless / 550 /" 可以替换 grep，而正则表达式可能会替换 awk。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-02T22:25:08.260

我不确定你想在@list 中添加什么？如果 awk 对每个条目进行管道传输，那么您将在 $line 中拥有它，并且您不需要 @list 上的 for 循环。

也就是说，如果您要将它通过管道传输到 Perl 中，为什么要首先使用 grep 和 AWK？

```
#!/ust/bin/perl -w
use strict;

while (<>) {
  next unless / 550 /;
  my @tokens = split ' ', $_;
  my $addr = $tokens[4];
  my $reason = join " ", @tokens[5..$#tokens];

  # ... DBI code
} 
```

关于 DBI 调用的旁注：您应该真正使用占位符，以便“坏电子邮件”无法将 SQL 注入您的数据库。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-02T22:25:33.563

为什么不放弃 grep 和 awk 而直接使用 Perl？

免责声明：我没有检查以下代码是否编译：

```
while (<STDIN>) {
    next unless /550/; # skips over the rest of the while loop
    my @fields = split;
    my $email = $fields[4];
    my $reason = join(' ', @fields[22..32]);
    ...
} 
```

编辑：请参阅[@dland 的评论](https://stackoverflow.com/users/18625/dland)以获得进一步的优化:-)

希望这可以帮助？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-03T06:44:41.743

您是否考虑过使用[App::Ack](http://search.cpan.org/dist/ack/ack)代替？您可以只使用 Perl，而不是使用外部程序。不幸的是，您必须通读[ack](http://search.cpan.org/src/PETDANCE/ack-1.86/ack)程序代码才能真正了解如何执行此操作，但是您应该得到一个更便携的程序。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-02T22:35:07.723

```
my(@list) = split /\|/, $line; 
```

如果行尾有额外的管道符号，这将在 @list 中生成两个以上的条目。为避免这种情况，请使用：

```
$line =~ m/^([^|]+)\|(.*)$/;
my(@list) = ($1, $2); 
```

正则表达式中的美元可以说是多余的，但也记录了“行尾”。

# java - 如何从 Java 写入 Windows 事件日志？

> ID：164879
> 
> 赞同：24
> 
> 时间：2008-10-02T22:20:36.243
> 
> 标签：java, windows, logging, event-log

如何从 Java 写入 Windows 事件日志？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-02T22:27:30.813

Log4J 是一个基于 Java 的日志记录实用程序。该类`NTEventLogAppender`可用于“附加到 NT 事件日志系统”。请参阅此处的文档：

[http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/nt/NTEventLogAppender.html](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/nt/NTEventLogAppender.html)

**编辑：**有一个较新的版本， [Log4j 2](http://logging.apache.org/log4j/2.x/)，“它比其前身提供了重大改进。”

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-09-28T18:10:27.517

您可以使用[JNA](https://github.com/twall/jna/)直接写入事件日志，而无需任何本机 DLL。有关各种事件日志方法（自 JNA 3.2.8 起提供），请参阅 Advapi32 和 Advapi32Util 类。

如果您使用的是 Log4j，请考虑使用[Log4jna](https://github.com/dblock/log4jna)而不是 NTEventLogAppender。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-02T22:28:33.807

早在 2001 年，JavaWorld 就发表了一篇关于如何[将消息写入 Windows NT 事件日志的文章。](http://www.javaworld.com/javaworld/jw-09-2001/jw-0928-ntmessages.html)或者，您可以查看 Log4j [NTEventLogAppender](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/nt/NTEventLogAppender.html)类。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-02-07T04:04:16.683

您还可以在 Windows XP Pro 及更高版本上使用 eventcreate 命令。

```
String command = "eventcreate "
               + " /l APPLICATION"
               + " /so \"" + applicationObjectName + "\""
               + " /t " + lvl
               + " /id " + id
               + " /d \"" + description + "\"";

Runtime.getRuntime().exec(command); 
```

对于 XP 家庭及更低版本，您可以创建一个使用 wscript.shell.eventcreate 方法编写的 vbs 应用程序。但是，您牺牲了指定来源的能力。

示例： [http ://www.ozzu.com/mswindows-forum/posting-event-log-with-batch-files-t76791.html](http://www.ozzu.com/mswindows-forum/posting-event-log-with-batch-files-t76791.html)

# .net - 如果我从查询字符串中获取一个参数，它是 URL 解码的吗？

> ID：164890
> 
> 赞同：1
> 
> 时间：2008-10-02T22:24:49.683
> 
> 标签：.net, asp.net

在 .NET 中，如果我执行以下操作：

```
string temp = Request.QueryString["myKey"]; 
```

temp 中的值是否已经 URL 解码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T22:25:46.107

是的。

# ruby-on-rails - 在 Windows 上运行 Ruby/Rails 的限制

> ID：164896
> 
> 赞同：81
> 
> 时间：2008-10-02T22:26:38.507
> 
> 标签：ruby-on-rails, windows, ruby, ironruby

在 RoR 的安装文档中，它提到在 Windows 上运行 Ruby on Rails 有很多限制，在某些情况下，整个库都不起作用。

这些限制有多糟糕，我是否应该始终默认使用 Linux 来编码/运行 RoR，Iron Ruby 是否有望解决这些限制，或者它们是操作系统本身的核心？

***编辑***感谢有关在 Linux 上安装和运行的答案，但我真的想了解安装文档中引用的功能限制和非工作库 - 我试图找到评论的链接，但它是当我安装我认为的 msi 包时，在安装中引用了我

***编辑*** 感谢最近对 IronRuby 的引用，这当然是一个值得关注的项目，而且显然它是一种 .NET 语言，如果它兑现承诺，它将是无价的。然而，最终，就我而言，我只是硬着头皮安装了一个 Ubuntu 服务器。

<bias> 几年前我就该这么做了</bias>

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-10-03T12:20:59.300

以下是 Windows 上 Rails 的当前问题的概述：

*   Ruby 和 Rails 在 Windows 上比在类 Unix 操作系统上要慢。
*   一些 gem 和库在 Windows 上不起作用。
*   某些 Unix 主义在 Windows 上不可用（[示例](http://tomayko.com/writings/unicorn-is-unix)）。
*   社区主要是在 Mac 或 Linux 上（*这是一个特别难以处理的问题；当部落的其他人都在聚会时，没有人愿意在一个岛上独自一人，在另一个岛上玩得开心，相处得很好。社区很重要。似乎大多数从 Rails 开始的 Windows 开发人员很快就会切换到 Mac 或 Linux。**但是**，坚持不懈的 Windows Ruby 用户的小型社区非常友好、敬业且知识渊博 -[**去打**](http://groups.google.com/group/rubyinstaller)个招呼。*）

* * *

**[请注意，由于RubyInstaller](http://rubyinstaller.org)团队在为 Windows 上的 Ruby 带来稳定性、兼容性和性能方面做出的巨大努力，以下许多建议现在已经过时。我不再需要使用 VirtualBox，它充分说明了 Windows 上的 Ruby 已经走了多远。**

如果您想了解更多技术细节，请阅读以下内容。：

*   [Ruby for Windows - 第 1 部分](http://blog.mmediasys.com/2008/01/17/ruby-for-windows-part-1/)
*   [Windows 是 Ruby 支持的平台吗？我猜不会](http://blog.mmediasys.com/2008/03/06/is-windows-a-supported-platform-for-ruby-i-guess-not/)
*   [测试适用于 Windows 的新一键式 Ruby 安装程序](http://www.akitaonrails.com/2008/7/21/testing-the-new-one-click-ruby-installer-for-windows)
*   [还在 Windows 上玩 Ruby](http://www.akitaonrails.com/2008/7/26/still-playing-with-ruby-on-windows)
*   [与 Luis Lavena 聊天（Windows 上的 Ruby）](http://www.akitaonrails.com/2008/7/2/chatting-with-luis-lavena-ruby-on-windows)

最后一个的选择报价是：

> **AkitaOnRails：**最明显的一点是，任何带有 C 扩展但没有适用于 Windows 的适当二进制文件的 Gem 都会失败。尝试执行 shell 命令会失败，RubyInline 也会失败。还有什么？
> 
> **Luis Lavena：**呵呵，这只是冰山一角

说了这么多，我并不觉得在 Windows 上使用 Rails 开发*太*痛苦了。在大多数情况下，使用 Ruby 是一种乐趣。我会避免使用 InstantRails，因为坦率地说，使用一键式安装程序正确安装 Ruby，然后执行`gem install rails`. 如果你需要 Apache 和 MySQL，[WAMP](http://www.wampserver.com)是一个不错的选择，尽管如果你只是坚持使用 Mongrel 和 SQLite，即使这些也不是必需的。

我最近所做的是运行[VirtualBox](http://www.virtualbox.org/)和一个 Ubuntu Server 实例，该实例与部署服务器密切相关。我将网络驱动器映射到 Ubuntu 服务器，然后直接在 VM 上编辑和运行我的代码。它几乎不使用任何内存（目前使用约 43MB；与使用约 230MB 的 Firefox 相比），Rails 实际上比在 Windows 上本地运行它的性能更好。另外，您可以在相对安全的情况下试验您的虚拟服务器。这是一个非常好的设置，我强烈推荐它。

最后，这里有几个针对 Windows 用户的 Ruby/Rails 博客：

*   [DEV_MEM.dump_to(:blog) (Luis Lavena)](http://blog.mmediasys.com/)
*   [铁路上的软糖](http://www.softiesonrails.com/)
*   [红宝石在 Windows](http://rubyonwindows.blogspot.com/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-02T23:00:23.373

[我发现在 Windows 上使用Instant Rails](http://wiki.rubyonrails.org/rails/pages/InstantRails)建立并运行开发环境非常简单。尤其是在使用[Netbeans](http://www.netbeans.org/)或[Radrails](http://www.aptana.com/rails)作为 IDE 时。

不到10分钟的工作。

那些挣扎的人发现了什么问题？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T23:06:39.113

我已经在 Windows PC 上开发 Rails 几年了，刚开始安装时没有遇到真正的问题。然而，我最近重新构建了我的机器并努力让 One-Click Ruby 安装程序和最新版本的 Gems 正常工作。所以这就是我尝试过的。

## 选项 1：运行 Linux 虚拟机

Charles Roper 在 Linux 虚拟机中运行 Rails 的想法给我留下了深刻的印象，这也是我最初选择的路线。一切都很顺利，我一直在[budanters.blogspot.com](http://budanters.blogspot.com/)上记录它。但是，我一直在努力从 Windows 主机访问 MySQL 服务器（在 Linux 虚拟机中）。

## 选项 2：使用 jRuby

我最近安装了 Windows 版本的[NetBeans 6.5](http://www.netbeans.org/downloads/index.html) Ruby 包，在不知不觉中，它安装了 JRuby 和 Rails gems。IDE 有一个用于安装 Gems 的 UI，我现在已经让我的旧应用程序备份并在我的开发环境中运行。

## 2009 年 11 月更新

我现在在 Windows 上使用 Netbeans 6.7，总的来说我对它非常满意。唯一的缺点是它安装了 JRuby 1.2，我需要手动安装 JRuby 1.3 才能使某些东西正常工作（我不记得是什么），而且我完全无法使用 Capistrano 或 Vlad the Deployer 进行部署工作。[Vlad](http://isitjruby.com/vlad)使用了不适用于 JRuby 的[Open4](http://isitjruby.com/open4)。

## 2010 年 5 月更新

Netbeans 6.8 附带 JRuby 1.4，因此不再需要手动安装 JRuby 1.3。此外，在 JRuby 1.5 中，Open4 现在似乎可以工作了，这意味着 Vlad 可能会开始工作。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-07-25T03:20:05.600

还没有人提到[Bitnami RubyStack](http://bitnami.org/stack/rubystack)吗？多年来，我一直在使用它，与 RadRails 一起使用。包括 Apache、MySQL/Postgre、phpmyadmin、git 等。可选的 Ruby 1.9.2/Rails 3.0b。您也可以在 VM 中运行 Ubuntu 风格的 RubyStack，但我还没有尝试过。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-19T09:42:35.973

[http://railsinstaller.org/](http://railsinstaller.org/)上有一个打包的安装程序，值得一试。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-03T13:25:58.560

就我个人而言，我发现让 Ruby + Rails 在 Windows 上运行起来是小菜一碟。从下载到浏览到我的第一个“HelloWorld”应用程序花了我 15 分钟。我什至没有打扰任何 InstantRails 的东西。

随后我不能说我遇到了任何报告的速度问题或 Windows 下的 Gems 问题。

这些家伙还为 Visual Studio 做了一个很好的 Ruby 开发人员添加：

[http://www.sapphiresteel.com/](http://www.sapphiresteel.com/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T23:02:45.487

当我上次在 windows 上摆弄 Rails 时，我使用了 Instant Rails，发现它是一个相当痛苦的过程，除了 Instant Rails 缺乏更新（从网站的外观来看，这仍然是一个小问题，因为即时 Rails 2.0 使用 ROR 2.0，而最新版本是 2.1)。您还可以查看[这个问题](https://stackoverflow.com/questions/35494/is-there-anyway-to-run-ruby-on-rails-applications-on-a-windows-box#35545)的答案，因为它提到了许多其他让 RoR 在 Windows 上轻松运行的方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T22:37:38.607

您可以使用 Windows 选项来启动和安装所有内容，例如[Instantrails](http://wiki.rubyonrails.org/rails/pages/InstantRails)：

然而，我个人尝试让同事在 Windows 上启动和运行的经验是，这是一个非常痛苦的经历。您应该能够让大部分（如果不是全部）运行起来，但要准备好花一点时间胡思乱想（并感到沮丧）。

YMMV

我可能会推荐使用 Linux 或 Mac 进行 Rails 开发（但我对 Windows 略有偏见，因此您可能需要对它持保留态度）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-02T22:56:56.250

如果你被困在 Windows 上，一个选择是让虚拟服务器运行 Linux/BSD/what-have-you。

它还解决了许多其他问题（允许您轻松尝试多个服务器配置等）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-03T00:10:04.297

在 Windows 下运行的最大限制是很多东西都超级慢。

看到[这个线程](http://railsforum.com/viewtopic.php?id=7219)。进行讨论。

像“脚本/控制台”这样简单的事情和运行 rake 任务在 Windows 上花费的时间是在 Linux 或 Mac 上的 5 倍。

其他限制是：

*   Vista上没有IE6。
*   BackgroundRB 和许多其他基于 c 的 gem 在 Windows 上不起作用。
*   没有乘客

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-03T00:11:13.967

如果您无法摆脱 Windows，请使用 VMware 并运行某种形式的 linux（ubuntu 很流行）。您的 No.1 限制将是编译的 gem，它们在 Windows 上不能很好地播放。

大多数教程假设您使用某种形式的 *nix，当您开始突破基本脚手架时，您会感到痛苦。图像处理、全文搜索甚至一些数据库适配器要么只能在 *nix 上运行，要么安装起来很麻烦。

大多数网络主机也运行 linux，最好在与主机相同的平台上进行开发，以避免部署问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-03T00:20:09.653

一般来说，Rails 的性能在 Windows 上是个问题。

至于您的部署设置，您可以在 FCGI 中运行 Rails 或使用 mongrel（并将 Apache 或 IIS 设置为代理）。mod_rails ( [http://www.modrails.com](http://www.modrails.com) ) 是目前 Rails 的最佳部署选项，但不能在 Windows 上运行。

您可能会发现在 Windows 上使用 JRuby 在您想要的任何 JVM 环境（tomcat、J2EE 服务器等）中运行 Rails 会更幸运。

IronRuby 还没有在生产环境中运行 Rails，但最终它的目标是在任何 ASP.NET 环境 (IIS) 中运行 Rails。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-04T09:53:28.010

你可以只使用 Cygwin 和它的 Ruby 版本。这消除了关于编译的 gem 在 Windows 上不起作用的争论——我已经设法以这种方式编译了很多 gem。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-05-02T15:10:02.603

我自己不是 Rails 开发人员，但我认为这可能很有趣。微软发布了 IronRuby 1.0，它是运行在 .NET 平台上的 Ruby 版本，显然比 Windows 上的官方 Rails 实现**快 4 倍。**

[http://www.drdobbs.com/open-source/224600662](http://www.drdobbs.com/open-source/224600662)

官方网站 [http://ironruby.codeplex.com/](http://ironruby.codeplex.com/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-03-10T18:41:53.577

为了加快速度，您可以尝试我的 loader speeder upper（帮助 rails 在打瞌睡时运行得更快）：[https](https://github.com/rdp/faster_require) ://github.com/rdp/faster_require 另外检查 spork，它可以在打瞌睡

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-11-25T09:48:49.370

RailsIntaller 的替代品是[RailsFTW](http://railsftw.bryanbibat.net/)。Ruby & Rails 更新更多。

# python - 我将如何打包和销售 Django 应用程序？

> ID：164901
> 
> 赞同：42
> 
> 时间：2008-10-02T22:27:56.977
> 
> 标签：python, django, piracy-prevention

目前，我正在托管我自己为客户开发的 Django 应用程序，但我现在开始考虑将其出售给人们，让他们自己托管。

我的问题是：如何打包和销售 Django 应用程序，同时保护其代码免遭盗版或盗窃？分发一堆 .py 文件听起来不是一个好主意，因为我卖给它的人也可以复制它们并传递它们。

我认为出于这个问题的目的，可以安全地假设购买此产品的每个人都将运行相同的（LAMP）设置。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-02T23:10:21.443

不要试图混淆或加密代码——它永远不会起作用。

我建议将 Django 应用程序“作为服务”出售——要么为他们托管，要么向他们出售代码*和支持*。写一份合同，禁止他们重新分配它。

也就是说，如果您决定以某种方式混淆代码 - 您可以将 Python 应用程序完全分发为 .pyc（Python 编译的字节码）。这就是 Py2App 的工作方式。

它仍然是可重新分发的，*但*编辑文件会非常困难 - 所以你可以添加一些基本的许可内容，而不是被一些`#`s挫败。

正如我所说，我认为您不会通过加密或混淆等方式在反盗版方面取得成功。取决于您的客户，一个简单的合同，也许一些非常基本的检查会比一些复杂的解密系统走得更远（并让使用您的应用程序的体验*更好*，而不是*希望不会更糟*）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-02T22:54:43.557

您可以将整个东西打包为 Amazon Machine Instance (AMI)，然后让它们在[Amazon EC2](http://aws.amazon.com/ec2/)上运行您的应用程序。这个解决方案的好处是 Amazon 会[为您处理计费](http://docs.amazonwebservices.com/AWSEC2/latest/DeveloperGuide/index.html?paidamis-intro.html)，并且由于您正在分发整个机器映像，您可以确定您的所有客户都使用相同的 LAMP 堆栈。AMI 是一个加密的机器映像，可以根据您的需要进行配置。

您可以让亚马逊向客户收取一次性费用、基于使用的费用或月费。

当然，此解决方案要求您的客户在亚马逊托管他们的应用程序，并支付适当的费用。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-02T22:40:24.200

我的做法是这样的：

1.  加密所有代码
2.  编写一个安装程序，使用机器的主机名和许可证文件联系服务器并获取解密密钥，然后解密代码并将其编译为 python 字节码
3.  添加（在安装程序中）一个模块，该模块在导入时检查机器的主机名和许可证文件，如果不匹配则终止

这样，用户只需在主机名更改和首次安装时联系服务器，但您可以获得一小层安全性。您可以将主机名更改为更复杂的名称，但实际上没有必要——任何想要盗版的人都会这样做，但是像这样的简单机制会让诚实的人保持诚实。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-15T07:01:38.453

“加密”Python 源代码（或字节码，或任何使用它的语言的真正字节码——不仅仅是 Python）就像一些人放在网页上试图禁用鼠标右键的 JavaScript 小东西，声明“现在你不能偷我的照片了！”

变通办法是微不足道的，不会阻止一个坚定的人。

如果你真的很想卖一个 Python 软件，你需要认真对待。聘请律师起草许可/合同条款，让人们在购买时同意，然后让他们拥有实际的软件。这意味着如果他们违反许可/合同条款，您将不得不将他们告上法庭，但无论如何您都必须这样做（例如，如果有人破坏了您的“加密”并开始分发您的软件），并且拥有从长远来看，已经写在纸上的法律文字的实际适当形式以及他们的签名，对您的业务来说会好得多。

但是，如果您真的对人们“窃取”您的软件*感到*偏执，那么请坚持使用托管模型并且不要让他们访问服务器。许多成功的企业都基于这种模式。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-03T14:48:12.870

您将永远无法从真正想要它的人那里获得源代码。最好现在就掌握这个事实，以后不用再头疼了。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-05-06T18:40:40.743

作为朋友，我可以坦率地说吗？除非你的应用真的很棒，否则你可能不会吸引很多买家。为什么要把时间浪费在律师、混淆、许可和诸如此类的事情上？通过开源代码......并维护它，您将获得更好的声誉。

Django 来自许可（和混淆）频谱的开源端。当然，MIT 许可证比 GPL 更常见；它们仍然与微软的 EULA 之类的东西相去甚远。很多 Djangophiles 会拒绝封闭源代码，仅仅是因为微软就是这样做的。

此外，人们会更加信任您的代码，因为他们将能够阅读并验证它不包含恶意代码。请记住，“混淆”意味着“隐藏”；谁会真正知道你隐藏了什么？

诚然，没有简单的方法可以通过开源代码获利。但是你可以提供你的服务，甚至在 Pledgie.com 上发布一个活动，为那些感谢你所有伟大工作的人。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-28T04:19:39.013

您可能需要考虑的一件事是 FogBugz 的功能。只需包含一个为目标平台编译并包含验证许可证的代码的小型二进制文件（可能是 C 程序）。

通过这种方式，您可以让诚实的人保持诚实，而不会让您感到头疼。

# c# - Windows 窗体 - 输入按键激活提交按钮？

> ID：164903
> 
> 赞同：104
> 
> 时间：2008-10-02T22:28:29.487
> 
> 标签：c#, winforms

如何在表单的任何位置捕获输入按键并强制它触发提交按钮事件？

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2008-10-02T22:39:36.043

如果您将`Form`' 的`AcceptButton`属性设置为 上的`Button`s之一，则`Form`默认情况下您将获得该行为。

否则，将`KeyPreview`属性设置为`true`on`Form`并处理其`KeyDown`事件。您可以检查`Enter`密钥并采取必要的措施。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2013-07-25T08:36:07.367

```
private void textBox_KeyDown(object sender, KeyEventArgs e) 
{
    if (e.KeyCode == Keys.Enter)
        button.PerformClick();
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-02T22:40:01.720

您可以在表单的属性中将一个按钮指定为“AcceptButton”，它将捕获表单上的任何“Enter”按键并将它们路由到该控件。

请参阅[如何：使用设计器将 Windows 窗体按钮指定为接受按钮，](https://docs.microsoft.com/en-us/dotnet/framework/winforms/controls/designate-a-wf-button-as-the-accept-button-using-the-designer)并注意它概述的少数例外情况（多行文本框等）

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-06-10T11:25:14.290

如前所述，将表单的*AcceptButton*属性设置为其按钮之一，并将该按钮的*DialogResult*属性设置为*DialogResult.OK*，以便调用者知道对话框是被接受还是被解除。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-04-20T19:09:54.107

您可以订阅 的`KeyUp`事件`TextBox`。

```
private void txtInput_KeyUp(object sender, KeyEventArgs e)
{
    if (e.KeyCode == Keys.Enter)
       DoSomething();
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-02T22:39:28.150

Form 有一个[KeyPreview](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.keypreview.aspx)属性，您可以使用它来拦截按键。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-02T22:39:52.470

将表单上的 KeyPreview 属性设置为 True，然后在表单级别使用 KeyPress 事件来检测 Enter 键。在检测时调用“提交”按钮的任何代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-03-03T13:39:35.153

只需使用

```
this.Form.DefaultButton = MyButton.UniqueID; 
```

**将您的按钮 ID 替换为“MyButton”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-05-29T05:02:48.043

```
 if (e.KeyCode.ToString() == "Return")
  { 
      //do something
  } 
```

# mysql - 如何为单个 MySQL 数据库启用 STRICT_ALL_TABLES'？

> ID：164914
> 
> 赞同：5
> 
> 时间：2008-10-02T22:38:15.157
> 
> 标签：mysql

有没有办法为单个 MySQL 数据库启用 STRICT_ALL_TABLES？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-09T23:57:03.690

设置 sql_mode = 'STRICT_ALL_TABLES'; 会做的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-13T09:50:07.323

您可以通过使用 --sql-mode="modes" 选项启动 mysqld 或在 my.cnf（Unix 操作系统）或 my.ini（Windows）中使用 sql-mode="modes" 来设置默认 SQL 模式。模式是由逗号（“，”）字符分隔的不同模式的列表。默认值为空（未设置模式）。如果要显式清除模式值，也可以为空（命令行上的 --sql-mode="" 或 Unix 系统上的 my.cnf 或 Windows 上的 my.ini 中的 sql-mode=""） .

参考[MySql 网站](http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T23:44:01.630

不要认为您可以直接执行此操作，但您可能会在处理特定数据库时为当前会话设置 Strict 接近。可以在特定用户的配置文件中执行此操作。

# compact-framework - 扩展 NETCF MainMenu 以支持背景颜色属性的代码

> ID：164915
> 
> 赞同：4
> 
> 时间：2008-10-02T22:38:42.877
> 
> 标签：compact-framework, mobile

我已经搜索了在 Compact Framework 的 MainMenu 控件上更改背景颜色的解决方案，我发现的唯一答案是您需要创建一个自定义控件。有没有人有这方面的示例代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T17:29:39.123

我做了一些类似的事情，我想处理 WM_EXITMENULOOP 消息，该消息在 .NETCF 中不能作为事件使用。

解决方案是将主菜单“子类化”，这是一个旧的 MFC 技巧，您可以用自己的函数替换 WndProc 函数，处理任何 Windows 消息（在我的情况下为 WM_EXITMENULOOP），并为其他所有内容调用基类 WndProc。

Alex Yakhnin 的博客上提供了一些关于如何子类化控件的示例代码： [Example of subclassing a window in .NETCF](http://blog.opennetcf.com/ayakhnin/SearchView.aspx?q=NativeWindow)

在您的情况下，您实际上是对 MainMenu 所在的 Form 进行子类化，我认为 WM_DRAWITEM 将是您想要自己处理的 Windows 消息。我没有尝试自己更改背景颜色，所以不完全确定这会起作用，但子类化将是我开始的地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T14:01:00.843

没有办法做到这一点。
你的权利，你可能需要创建自己的控件。

这是我一直在考虑做的事情，以使应用程序在 Windows CE 和 Windows Mobile 上运行。
当应用程序需要同时使用这两种菜单时，添加菜单的问题在于，菜单会出现在 Windows CE 上的屏幕顶部并覆盖可能存在的所有控件。
从长远来看，只需制作一个新控件就不会那么麻烦了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T22:30:17.927

I tried to do something similar a while back and discovered that you have to write your own menu; essentially from scratch. I gave up because the project I was working on couldn't afford the expense. I also discovered that [OpenNETCF](http://www.opennetcf.com/) has a pretty awesome menu control. I don't know if it's included in their free software, but it might be worth looking into.

# c# - 如何将十进制值显示到小数点后 2 位？

> ID：164926
> 
> 赞同：747
> 
> 时间：2008-10-02T22:41:56.833
> 
> 标签：c#, .net, format, decimal

当前使用 显示小数的值时`.ToString()`，精确到小数点后 15 位，由于我用它来表示美元和美分，所以我只希望输出为小数点后 2 位。

我`.ToString()`是否为此使用了一个变体？

* * *

## 回答 #1

> 赞同：1055
> 
> 时间：2008-10-02T22:43:02.617

```
decimalVar.ToString("#.##"); // returns ".5" when decimalVar == 0.5m 
```

或者

```
decimalVar.ToString("0.##"); // returns "0.5"  when decimalVar == 0.5m 
```

或者

```
decimalVar.ToString("0.00"); // returns "0.50"  when decimalVar == 0.5m 
```

* * *

## 回答 #2

> 赞同：643
> 
> 时间：2011-04-20T01:16:08.007

我知道这是一个老问题，但我很惊讶地发现似乎没有人发布答案；

1.  没有使用银行家四舍五入
2.  将值保留为小数。

这就是我会使用的：

```
decimal.Round(yourValue, 2, MidpointRounding.AwayFromZero); 
```

[http://msdn.microsoft.com/en-us/library/9s0xa85y.aspx](http://msdn.microsoft.com/en-us/library/9s0xa85y.aspx)

* * *

## 回答 #3

> 赞同：415
> 
> 时间：2009-12-15T14:29:47.167

```
decimalVar.ToString("F"); 
```

这会：

*   四舍五入到小数点后 2 位，*例如。* `23.456`→`23.46`
*   确保始终有 2 位小数，*例如。* `23`→ `23.00`; `12.5`→`12.50`

显示货币的理想选择。

查看有关[ToString("F")](http://msdn.microsoft.com/en-us/library/dwhawy9k%28v=vs.110%29.aspx#FFormatString)的文档（感谢 Jon Schneider）。

* * *

## 回答 #4

> 赞同：115
> 
> 时间：2008-10-02T22:43:37.110

如果你只需要这个来显示使用 string.Format

```
String.Format("{0:0.00}", 123.4567m);      // "123.46" 
```

[http://www.csharp-examples.net/string-format-double/](http://www.csharp-examples.net/string-format-double/)

“m”是十进制后缀。关于十进制后缀：

[http://msdn.microsoft.com/en-us/library/364x0z75.aspx](http://msdn.microsoft.com/en-us/library/364x0z75.aspx)

* * *

## 回答 #5

> 赞同：59
> 
> 时间：2008-10-02T22:58:37.697

给定**十进制 d=12.345;** 表达式**d.ToString("C")**或**String.Format("{0:C}", d)**产生**12.35 美元**- 请注意，使用当前文化的货币设置，包括符号。

请注意，[“C”](http://msdn.microsoft.com/en-us/library/dwhawy9k%28v=vs.110%29.aspx#CFormatString)使用当前文化中的位数。您始终可以使用`C{Precision specifier}`like覆盖默认值以强制执行必要的精度`String.Format("{0:C2}", 5.123d)`。

* * *

## 回答 #6

> 赞同：53
> 
> 时间：2009-04-21T23:20:35.723

如果您希望它使用逗号和小数点（但没有货币符号）格式化，例如 3,456,789.12...

```
decimalVar.ToString("n2"); 
```

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2011-10-26T07:30:22.117

有一个非常重要的特征`Decimal`并不明显：

> 一个`Decimal`“知道”它有多少小数位是基于它来自哪里

以下可能是意料之外的：

```
Decimal.Parse("25").ToString()          =>   "25"
Decimal.Parse("25.").ToString()         =>   "25"
Decimal.Parse("25.0").ToString()        =>   "25.0"
Decimal.Parse("25.0000").ToString()     =>   "25.0000"

25m.ToString()                          =>   "25"
25.000m.ToString()                      =>   "25.000" 
```

对于上述所有示例，执行相同的操作`Double`将导致零小数位 ( `"25"`)。

如果您想要小数点到小数点后 2 位，那很有可能是因为它是货币，在这种情况下，这在 95% 的情况下可能都很好：

```
Decimal.Parse("25.0").ToString("c")     =>   "$25.00" 
```

或者在 XAML 中你会使用`{Binding Price, StringFormat=c}`

我遇到了一个需要小数的情况，因为小数是在将 XML 发送到亚马逊的网络服务时。该服务正在抱怨，因为 Decimal 值（最初来自 SQL Server）被发送为`25.1200`并被拒绝，（`25.12`是预期的格式）。

无论值的来源如何，我需要做的只是`Decimal.Round(...)`使用 2 个小数位来解决问题。

```
 // generated code by XSD.exe
 StandardPrice = new OverrideCurrencyAmount()
 {
       TypedValue = Decimal.Round(product.StandardPrice, 2),
       currency = "USD"
 } 
```

`TypedValue`是类型`Decimal`，所以我不能只做`ToString("N2")`，需要将它四舍五入并将其保留为`decimal`.

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2013-11-18T20:44:08.593

这是一个显示不同格式的小 Linqpad 程序：

```
void Main()
{
    FormatDecimal(2345.94742M);
    FormatDecimal(43M);
    FormatDecimal(0M);
    FormatDecimal(0.007M);
}

public void FormatDecimal(decimal val)
{
    Console.WriteLine("ToString: {0}", val);
    Console.WriteLine("c: {0:c}", val);
    Console.WriteLine("0.00: {0:0.00}", val);
    Console.WriteLine("0.##: {0:0.##}", val);
    Console.WriteLine("===================");
} 
```

结果如下：

```
ToString: 2345.94742
c: $2,345.95
0.00: 2345.95
0.##: 2345.95
===================
ToString: 43
c: $43.00
0.00: 43.00
0.##: 43
===================
ToString: 0
c: $0.00
0.00: 0.00
0.##: 0
===================
ToString: 0.007
c: $0.01
0.00: 0.01
0.##: 0.01
=================== 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-10-02T22:44:43.377

[Math.Round 方法（十进制，Int32）](http://msdn.microsoft.com/en-us/library/zy06z30k.aspx)

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2016-10-14T19:53:44.177

[Mike M.](https://stackoverflow.com/a/5724542)在 .NET 上的回答对我来说是完美的，但 .NET Core 在撰写本文时还没有`decimal.Round`方法。

在 .NET Core 中，我必须使用：

```
decimal roundedValue = Math.Round(rawNumber, 2, MidpointRounding.AwayFromZero); 
```

一个 hacky 方法，包括转换为字符串，是：

```
public string FormatTo2Dp(decimal myNumber)
{
    // Use schoolboy rounding, not bankers.
    myNumber = Math.Round(myNumber, 2, MidpointRounding.AwayFromZero);

    return string.Format("{0:0.00}", myNumber);
} 
```

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2017-08-01T01:51:52.193

如果值为 0，您很少需要空字符串。

```
decimal test = 5.00;
test.ToString("0.00");  //"5.00"
decimal? test2 = 5.05;
test2.ToString("0.00");  //"5.05"
decimal? test3 = 0;
test3.ToString("0.00");  //"0.00" 
```

评分最高的答案不正确，浪费了（大多数）人的 10 分钟时间。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2012-10-25T14:35:16.783

这些都没有完全满足我的需要，强制**2 dp**并四舍五入为`0.005 -> 0.01`

强制 2 dp 需要将精度提高 2 dp 以确保我们至少有 2 dp

然后四舍五入以确保我们的 dp 不超过 2

```
Math.Round(exactResult * 1.00m, 2, MidpointRounding.AwayFromZero)

6.665m.ToString() -> "6.67"

6.6m.ToString() -> "6.60" 
```

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2017-08-24T15:18:18.513

最受好评的答案描述了一种格式化十进制值的*字符串表示的方法，并且它有效。*

但是，如果您真的想将保存的精度更改为实际值，则需要编写如下内容：

```
public static class PrecisionHelper
{
    public static decimal TwoDecimalPlaces(this decimal value)
    {
        // These first lines eliminate all digits past two places.
        var timesHundred = (int) (value * 100);
        var removeZeroes = timesHundred / 100m;

        // In this implementation, I don't want to alter the underlying
        // value.  As such, if it needs greater precision to stay unaltered,
        // I return it.
        if (removeZeroes != value)
            return value;

        // Addition and subtraction can reliably change precision.  
        // For two decimal values A and B, (A + B) will have at least as 
        // many digits past the decimal point as A or B.
        return removeZeroes + 0.01m - 0.01m;
    }
} 
```

一个示例单元测试：

```
[Test]
public void PrecisionExampleUnitTest()
{
    decimal a = 500m;
    decimal b = 99.99m;
    decimal c = 123.4m;
    decimal d = 10101.1000000m;
    decimal e = 908.7650m

    Assert.That(a.TwoDecimalPlaces().ToString(CultureInfo.InvariantCulture),
        Is.EqualTo("500.00"));

    Assert.That(b.TwoDecimalPlaces().ToString(CultureInfo.InvariantCulture),
        Is.EqualTo("99.99"));

    Assert.That(c.TwoDecimalPlaces().ToString(CultureInfo.InvariantCulture),
        Is.EqualTo("123.40"));

    Assert.That(d.TwoDecimalPlaces().ToString(CultureInfo.InvariantCulture),
        Is.EqualTo("10101.10"));

    // In this particular implementation, values that can't be expressed in
    // two decimal places are unaltered, so this remains as-is.
    Assert.That(e.TwoDecimalPlaces().ToString(CultureInfo.InvariantCulture),
        Is.EqualTo("908.7650"));
} 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2011-08-23T00:15:19.753

您可以使用 system.globalization 将数字格式化为任何所需的格式。

**例如：**

```
system.globalization.cultureinfo ci = new system.globalization.cultureinfo("en-ca"); 
```

如果您有 a`decimal d = 1.2300000`并且需要将其修剪到小数点后 2 位，则可以像这样打印它`d.Tostring("F2",ci);`，其中 F2 是字符串格式为 2 位小数，ci 是语言环境或文化信息。

有关更多信息，请查看此链接
[http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx)

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2016-06-25T20:01:50.350

[https://msdn.microsoft.com/en-us/library/dwhawy9k%28v=vs.110%29.aspx](https://msdn.microsoft.com/en-us/library/dwhawy9k%28v=vs.110%29.aspx)

此链接详细说明了如何处理您的问题以及如果您想了解更多信息可以做什么。为简单起见，您想要做的是

```
double whateverYouWantToChange = whateverYouWantToChange.ToString("F2"); 
```

如果你想要这种货币，你可以通过输入“C2”而不是“F2”来简化它

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2019-08-20T06:54:00.997

```
Double Amount = 0;
string amount;
amount=string.Format("{0:F2}", Decimal.Parse(Amount.ToString())); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2020-03-13T11:39:06.437

如果您只需要保留 2 个小数位（即切除所有其余的小数位）：

```
decimal val = 3.14789m;
decimal result = Math.Floor(val * 100) / 100; // result = 3.14 
```

如果您只需要保留 3 位小数：

```
decimal val = 3.14789m;
decimal result = Math.Floor(val * 1000) / 1000; // result = 3.147 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-02-13T21:08:42.883

```
 var arr = new List<int>() { -4, 3, -9, 0, 4, 1 };
        decimal result1 = arr.Where(p => p > 0).Count();
        var responseResult1 = result1 / arr.Count();
        decimal result2 = arr.Where(p => p < 0).Count();
        var responseResult2 = result2 / arr.Count();
        decimal result3 = arr.Where(p => p == 0).Count();
        var responseResult3 = result3 / arr.Count();
        Console.WriteLine(String.Format("{0:#,0.000}", responseResult1));
        Console.WriteLine(String.Format("{0:#,0.0000}", responseResult2));
        Console.WriteLine(String.Format("{0:#,0.00000}", responseResult3)); 
```

您可以根据需要放置任意数量的 0。

# mysql - 如何找出某个值是否作为mySql中的主键存在？

> ID：164927
> 
> 赞同：4
> 
> 时间：2008-10-02T22:42:21.683
> 
> 标签：mysql

找出表中是否已经存在具有特定值的主键的最佳方法是什么？

我能想到：

```
SELECT key FROM table WHERE key = 'value'; 
```

并计算结果，或者：

```
SELECT SQL_CALC_FOUND_ROWS key FROM table WHERE key = 'value' LIMIT 1;
SELECT FOUND_ROWS(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T22:47:23.560

我认为您在问题中的任何一个建议都是合适的。

但是，根据您使用它的方式，您可以通过执行 INSERT IGNORE 来节省时间，如果主键不存在，您可以插入新行。如果确实存在，则忽略该错误，以便您可以正常继续。

根据您的使用情况，其他类似选项包括使用 REPLACE 或 INSERT ON DUPLICATE KEY UPDATE 类型的插入。如果主键已经存在，这允许您更新现有条目，否则它只会插入您的新条目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T22:49:07.423

做第一个并计算结果（总是 0 或 1）。简单快捷。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T23:23:06.173

我会做：

```
SELECT 1 FROM table WHERE id key = 'value' 
```

其他任何事情都可能会稍微干扰查询优化，所以我会坚持下去。

编辑：虽然我刚刚意识到我不认为我曾经在 MySQL 中这样做过，尽管我不明白为什么它不起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T22:49:49.887

例子

```
Select count(key) into :result from table where key = :theValue 
```

如果您尝试在插入或更新之间做出决定，请在 Oracle 中使用 MERGE 语句。我相信 MS-SQL 类似于 UPSERT 语句。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-27T16:16:15.957

SELECT 1 FROM mytable WHERE mykey = 'value' LIMIT 1

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-02T22:49:59.327

我认为使用 IF EXISTS 会更直观、更简单。

```
 IF EXISTS (SELECT key FROM table WHERE key = 'value')
    PRINT 'Found it!'
ELSE
    PRINT 'Cannot find it!' 
```

# perl - 如何将国际化添加到我的 Perl 脚本？

> ID：164931
> 
> 赞同：13
> 
> 时间：2008-10-02T22:43:02.150
> 
> 标签：perl, localization, internationalization, cgi

我正在考虑为用 Perl 编写的成熟 CGI 应用程序引入多语言支持。我最初考虑使用 Perl 散列（存储在磁盘上）为翻译文件推出我自己的解决方案，但后来我遇到了一个 CPAN 模块，它似乎可以满足我的需求（[i18n](http://search.cpan.org/~audreyt/i18n-0.10/lib/i18n.pm "i18n")）。

有人对 Perl 的国际化（特别是 i18n CPAN 模块）有任何经验吗？i18n 模块是多语言支持的首选方法，还是我应该重新考虑自定义解决方案？

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-02T23:00:49.690

有一篇关于软件本地化的[Perl 期刊文章。](http://search.cpan.org/perldoc?Locale::Maketext::TPJ13)它将让您很好地了解添加多语言支持时可以期待什么。文笔优美，幽默风趣。

具体来说，这篇文章是由编写和维护[`Locale::Maketext`](http://search.cpan.org/perldoc?Locale::Maketext).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T12:56:59.540

如果你有时间，那么看看 I18N 在[Jifty](http://search.cpan.org/dist/Jifty/)框架中的完成方式——虽然最初很混乱，但它非常优雅和可用。

它们重载`_`，以便您可以`_("text to translate")`在代码中的任何位置使用。这些字符串然后像往常一样使用[Locale::Maketext](http://search.cpan.org/dist/Locale-Maketext/)进行翻译。

[它真正强大的原因在于，它们使用Scalar::Defer](http://search.cpan.org/dist/Scalar-Defer/)将翻译推迟到需要字符串时，这样您就可以随时开始添加字符串，甚至在您知道它们将被翻译成哪种语言之前。例如在配置文件等中。这确实使 I18N 易于使用。

# math - 指数是如何计算的？

> ID：164964
> 
> 赞同：6
> 
> 时间：2008-10-02T22:58:14.000
> 
> 标签：math, analysis

我正在尝试确定我的一种算法的渐近运行时间，该算法使用指数，但我不确定如何以编程方式计算指数。

我专门寻找用于双精度浮点数的 pow() 算法。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-03T00:16:34.000

我有机会查看 fdlibm 的实现。评论描述了使用的算法：

```
 *                    n
 * Method:  Let x =  2   * (1+f)
 *      1\. Compute and return log2(x) in two pieces:
 *              log2(x) = w1 + w2,
 *         where w1 has 53-24 = 29 bit trailing zeros.
 *      2\. Perform y*log2(x) = n+y' by simulating muti-precision
 *         arithmetic, where |y'|<=0.5.
 *      3\. Return x**y = 2**n*exp(y'*log2) 
```

然后是处理的所有特殊情况的列表（0、1、inf、nan）。

在所有特殊情况处理之后，代码中最密集的部分涉及`log2`和`2**`计算。并且其中任何一个都没有循环。因此，尽管浮点原语很复杂，但它看起来像是一个渐近恒定时间算法。

欢迎浮点专家（我不是其中之一）发表评论。:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T01:33:32.583

除非他们发现了更好的方法，否则我相信三角函数、对数函数和指数函数（例如指数增长和衰减）的近似值通常使用算术规则和**泰勒级数**展开计算，以产生准确的近似结果在要求的精度范围内。（有关幂级数、泰勒级数和麦克劳林级数展开函数的详细信息，请参阅任何微积分书籍。）请注意，我已经有一段时间没有这样做了，所以我不能告诉你，例如，确切地如何计算您需要包含的系列中的项数可以保证误差小到在双精度计算中可以忽略不计。

例如，e^x 的 Taylor/Maclaurin 级数展开是这样的：

```
 +inf [ x^k ]           x^2    x^3      x^4        x^5
e^x = SUM  [ --- ] = 1 + x + --- + ----- + ------- + --------- + ....
      k=0  [  k! ]           2*1   3*2*1   4*3*2*1   5*4*3*2*1 
```

如果您采用所有项（k 从 0 到无穷大），则此展开是准确且完整的（无错误）。

但是，如果您没有将所有项都取到无穷大，而是在说 5 个项或 50 个项或其他任何项之后停止，您会产生一个与实际 e^x 函数值相差一个余数的**近似**结果，这很容易计算。

指数的好消息是它很好地收敛并且它的多项式展开的项很容易迭代编码，所以你**可能**（重复，**可能**- 记住，已经有一段时间了）甚至不需要预先计算你有多少项需要保证您的错误小于精度，因为您可以在每次迭代时测试贡献的大小，并在它变得足够接近零时停止。在实践中，我不知道这个策略是否可行——我必须尝试一下。有些重要的细节我早就忘记了。诸如：机器精度，机器误差和舍入误差等。

另外，请注意，如果您没有使用 e^x，但您正在使用另一个基数（如 2^x 或 10^x）进行增长/衰减，则近似多项式函数会发生变化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T23:01:06.443

对于整数指数，通常的方法是将 a 提高到 b，如下所示：

```
result = 1
while b > 0
  if b is odd
    result *= a
    b -= 1
  b /= 2
  a = a * a 
```

它的指数大小通常是对数的。该算法基于不变量“a^b*result = a0^b0”，其中 a0 和 b0 是 a 和 b 的初始值。

对于负或非整数指数，需要对数和近似值以及数值分析。运行时间将取决于使用的算法和库的调整精度。

编辑：由于似乎有一些兴趣，这里有一个没有额外乘法的版本。

```
result = 1
while b > 0
  while b is even
    a = a * a
    b = b / 2
  result = result * a
  b = b - 1 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T11:42:09.703

您可以使用 exp(n*ln(x)) 来计算 x ^n。x 和 n 都可以是双精度浮点数。自然对数和指数函数可以使用泰勒级数计算。在这里你可以找到公式：[http ://en.wikipedia.org/wiki/Taylor_series](http://en.wikipedia.org/wiki/Taylor_series)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T00:30:26.900

如果我正在编写一个针对 Intel 的 pow 函数，我将返回 exp2(log2(x) * y)。英特尔的 log2 微代码肯定比我能编写的任何代码都快，即使我还记得我第一年的微积分和研究生院的数值分析。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-08-27T21:36:21.907

e^x = (1 + 分数) * (2^exponent), 1 <= 1 + 分数 < 2

x * log2(e) = log2(1 + 分数) + 指数，0 <= log2(1 + 分数) < 1

指数 = floor(x * log2(e))

1 + 分数 = 2^(x * log2(e) - 指数) = e^((x * log2(e) - 指数) * ln2) = e^(x - 指数 * ln2), 0 <= x - 指数* ln2 < ln2

# vba - 枚举计算机上设置的 DSN 列表

> ID：164967
> 
> 赞同：5
> 
> 时间：2008-10-02T23:00:17.350
> 
> 标签：vba, excel, dsn

我有一个 Excel 应用程序，我想在其中向用户显示数据源名称（即：DSN）的列表，以便她/他可以选择要使用的数据源。

希望获得列表后，我可以轻松访问 DSN 属性以连接到适当的数据库。

请注意，我*不想*使用无 DSN 连接。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-02T23:31:48.023

DSN 条目存储在注册表中的以下键中。

```
HKEY_CURRENT_USER\Software\ODBC\ODBC.INI\ODBC 数据源
HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBC.INI\ODBC 数据源
```

这包含所有已定义 DSN 的列表。这充当全局索引，每个 DSN 的特定详细信息存储在具有 DSN 名称的键中：

```
HKEY_CURRENT_USER\Software\ODBC\ODBC.INI
HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBC.INI
```

从数据源 (ODBC) 控制面板小程序的用户 DSN 和系统 DSN 选项卡中创建一些条目，并检查这些值是如何存储在注册表中的。

以下示例列举了通过控制面板 > 管理工具 > 数据源 (ODBC) [用户 Dsn 选项卡] 为用户定义的 DSN。

[http://support.microsoft.com/kb/178755](http://support.microsoft.com/kb/178755)

```
 Option Explicit

  Private Declare Function RegOpenKeyEx Lib "advapi32.dll" _
      Alias "RegOpenKeyExA" _
      (ByVal hKey As Long, _
      ByVal lpSubKey As String, _
      ByVal ulOptions As Long, _
      ByVal samDesired As Long, phkResult As Long) As Long

  Private Declare Function RegEnumValue Lib "advapi32.dll" _
      Alias "RegEnumValueA" _
      (ByVal hKey As Long, _
      ByVal dwIndex As Long, _
      ByVal lpValueName As String, _
      lpcbValueName As Long, _
      ByVal lpReserved As Long, _
      lpType As Long, _
      lpData As Any, _
      lpcbData As Long) As Long

  Private Declare Function RegCloseKey Lib "advapi32.dll" _
      (ByVal hKey As Long) As Long

  Const HKEY_CLASSES_ROOT = &H80000000
  Const HKEY_CURRENT_USER = &H80000001
  Const HKEY_LOCAL_MACHINE = &H80000002
  Const HKEY_USERS = &H80000003

  Const ERROR_SUCCESS = 0&

  Const SYNCHRONIZE = &H100000
  Const STANDARD_RIGHTS_READ = &H20000
  Const STANDARD_RIGHTS_WRITE = &H20000
  Const STANDARD_RIGHTS_EXECUTE = &H20000
  Const STANDARD_RIGHTS_REQUIRED = &HF0000
  Const STANDARD_RIGHTS_ALL = &H1F0000
  Const KEY_QUERY_VALUE = &H1
  Const KEY_SET_VALUE = &H2
  Const KEY_CREATE_SUB_KEY = &H4
  Const KEY_ENUMERATE_SUB_KEYS = &H8
  Const KEY_NOTIFY = &H10
  Const KEY_CREATE_LINK = &H20
  Const KEY_READ = ((STANDARD_RIGHTS_READ Or _
                    KEY_QUERY_VALUE Or _
                    KEY_ENUMERATE_SUB_KEYS Or _
                    KEY_NOTIFY) And _
                    (Not SYNCHRONIZE))

  Const REG_DWORD = 4
  Const REG_BINARY = 3
  Const REG_SZ = 1

  Private Sub Command1_Click()
     Dim lngKeyHandle As Long
     Dim lngResult As Long
     Dim lngCurIdx As Long
     Dim strValue As String
     Dim lngValueLen As Long
     Dim lngData As Long
     Dim lngDataLen As Long
     Dim strResult As String

     lngResult = RegOpenKeyEx(HKEY_CURRENT_USER, _
             "SOFTWARE\ODBC\ODBC.INI\ODBC Data Sources", _
              0&, _
              KEY_READ, _
              lngKeyHandle)

     If lngResult <> ERROR_SUCCESS Then
         MsgBox "Cannot open key"
         Exit Sub
     End If

     lngCurIdx = 0
     Do
        lngValueLen = 2000
        strValue = String(lngValueLen, 0)
        lngDataLen = 2000

        lngResult = RegEnumValue(lngKeyHandle, _
                                 lngCurIdx, _
                                 ByVal strValue, _
                                 lngValueLen, _
                                 0&, _
                                 REG_DWORD, _
                                 ByVal lngData, _
                                 lngDataLen)
        lngCurIdx = lngCurIdx + 1

        If lngResult = ERROR_SUCCESS Then
           strResult = strResult & lngCurIdx & ": " & Left(strValue, lngValueLen) & vbCrLf
        End If
     Loop While lngResult = ERROR_SUCCESS
     Call RegCloseKey(lngKeyHandle)

     Call MsgBox(strResult, vbInformation)
  End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T09:44:09.950

您可以使用 ODBC API 的**SQLDataSources**函数。请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms711004.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-18T19:46:10.373

非常酷的解决方案。我遇到了一个问题，即 CURRENT_USER 没有显示所有 DSN，当然不是我需要的。我将其更改为 LOCAL_MACHINE 并看到所有显示在连接管理器中的 DSN，包括显示在 CURRENT_USER 下的子集。

[http://msdn.microsoft.com/en-us/library/windows/desktop/ms712603(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/ms712603(v=vs.85).aspx)

# regex - 用于匹配英国邮政编码的正则表达式

> ID：164979
> 
> 赞同：219
> 
> 时间：2008-10-02T23:05:03.907
> 
> 标签：regex, validation, regex-group, postal-code

我正在使用一个正则表达式，它将仅在输入字符串中验证完整的复杂英国邮政编码。所有不常见的邮政编码形式都必须像往常一样被覆盖。例如：

**火柴**

*   CW3 9SS
*   SE5 0EG
*   SE50EG
*   se5 0eg
*   WC2H 7LT

**没有匹配**

*   aWC2H 7LT
*   WC2H 7LTa
*   WC2H

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2008-10-02T23:13:26.197

我建议查看英国政府邮政编码数据标准 [链接现已失效；[XML 存档](http://webarchive.nationalarchives.gov.uk/+/http://www.cabinetoffice.gov.uk/media/291370/bs7666-v2-0-xsd-PostCodeType.htm)，请参阅[Wikipedia](http://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation)进行讨论]。有关于数据的简要描述，附加的 xml 模式提供了一个正则表达式。它可能不是您想要的，但会是一个很好的起点。RegEx 与 XML 略有不同，因为给定的定义允许格式 A9A 9AA 中第三位的 P 字符。

英国政府提供的 RegEx 是：

```
([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\s?[0-9][A-Za-z]{2}) 
```

正如维基百科讨论中指出的那样，这将允许一些非真实的邮政编码（例如那些以 AA、ZY 开头的邮政编码），并且它们确实提供了您可以尝试的更严格的测试。

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2018-08-16T21:08:16.177

我最近[在 R 语言的英国邮政编码上发布了这个问题](https://stackoverflow.com/q/51828712/3600709)的[答案](https://stackoverflow.com/a/51828886/3600709)。我发现**英国政府的正则表达式模式不正确**，无法*正确*验证某些邮政编码。不幸的是，这里的许多答案都是基于这种不正确的模式。

 ***我将在下面概述其中一些问题，并提供一个*实际*有效的修订正则表达式。

* * *

# 笔记

**我的回答**（以及一般的正则表达式）：

*   **仅验证邮政编码*格式***。
*   **不确保邮政编码*合法存在***。
    *   为此，请使用适当的 API！有关更多信息，请参见[Ben 的回答](https://stackoverflow.com/a/17024047/3600709)。

* * *

[如果您不关心*错误的正则表达式*而只想跳到答案，请向下滚动到“**答案**”部分。]

# 糟糕的正则表达式

**不应使用本节中的正则表达式。**

这是英国政府向开发人员提供的失败的正则表达式（不确定此链接会持续多久，但您可以在他们的[批量数据传输文档](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/488478/Bulk_Data_Transfer_-_additional_validation_valid_from_12_November_2015.pdf)中看到它）：

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z]))))[0-9][A-Za-z]{2})$ 
```

## 问题

### 问题 1 - 复制/粘贴

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/1)。

正如许多开发人员可能会做的那样，他们复制/粘贴代码（尤其是正则表达式）并粘贴它们期望它们能够工作。虽然这在理论上很好，但在这种特殊情况下却失败了，因为从本文档复制/粘贴实际上将其中一个字符（空格）更改为换行符，如下所示：

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z]))))
[0-9][A-Za-z]{2})$ 
```

大多数开发人员会做的第一件事就是不加思索地删除换行符。现在正则表达式不会匹配带有空格的邮政编码（`GIR 0AA`邮政编码除外）。

要解决此问题，应将换行符替换为空格字符：

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$
                                                                                                                                                     ^ 
```

### 问题 2 - 边界

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/2)。

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$
^^                     ^ ^                                                                                                                                            ^^ 
```

邮政编码正则表达式不正确地锚定正则表达式。如果像这样的值通过，任何使用此正则表达式来验证邮政编码的人都可能会感到惊讶`fooA11 1AA`。这是因为他们已经锚定了第一个选项的开始和第二个选项的结束（彼此独立），正如上面的正则表达式中所指出的那样。

这意味着`^`（在行首断言位置）仅适用于第一个选项`([Gg][Ii][Rr] 0[Aa]{2})`，因此第二个选项将验证以邮政编码**结尾**的任何字符串（无论之前发生什么）。

同样，第一个选项没有锚定到 line 的末尾`$`，因此`GIR 0AAfoo`也被接受。

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z]))))[0-9][A-Za-z]{2})$ 
```

要解决此问题，应将两个选项都包装在另一个组（或非捕获组）中，并将锚点放置在该组周围：

```
^(([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2}))$
^^                                                                                                                                                                      ^^ 
```

### 问题 3 - 不正确的字符集

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/3)。

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$
                                                                                       ^^ 
```

正则表达式在此处缺少 a`-`以指示字符范围。就目前而言，如果邮政编码采用格式`ANA NAA`（其中`A`表示字母并`N`表示数字），并且它以`A`or以外的任何内容开头`Z`，它将失败。

这意味着它将匹配`A1A 1AA`and `Z1A 1AA`，但不匹配`B1A 1AA`。

要解决此问题，`-`应将字符放在相应字符集中的`A`和之间：`Z`

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$
                                                                                        ^ 
```

### 问题 4 - 错误的可选字符集

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/4)。

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$
                                                                                                                                        ^ 
```

我发誓他们在网上公布之前甚至没有测试过这个东西。他们使错误的字符集成为可选的。他们在`[0-9]`选项 2（第 9 组）的第四个子选项中做出了选项。这允许正则表达式匹配格式不正确的邮政编码，例如`AAA 1AA`.

要解决此问题，请将下一个字符类改为可选（并随后使集合`[0-9]`匹配一次）：

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?)))) [0-9][A-Za-z]{2})$
                                                                                                                                                ^ 
```

### 问题 5 - 性能

此正则表达式的性能极差。首先，他们将最不可能匹配的模式选项放在`GIR 0AA`开头。与任何其他邮政编码相比，有多少用户可能拥有此邮政编码；可能永远不会？这意味着每次使用正则表达式时，都必须先用尽该选项，然后再继续下一个选项。要查看性能如何受到影响，请检查[原始正则](https://regex101.com/r/ajQHrd/5)[表达式在翻转选项](https://regex101.com/r/ajQHrd/6)(22)后针对同一正则表达式所采取的步骤数 (35 )。

性能的第二个问题是由于整个正则表达式的结构方式。如果一个选项失败，就没有必要回溯每个选项。当前正则表达式的结构方式可以大大简化。**我在答案**部分对此提供了修复。

### 问题 6 - 空间

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/8)

这本身可能不被认为是一个*问题*，但它确实引起了大多数开发人员的关注。正则表达式中的空格不是可选的，这意味着输入其邮政编码的用户必须在邮政编码中放置一个空格。这是一个简单的解决方法，只需`?`在空格之后添加以使其成为可选。有关修复，请参阅**答案**部分。

* * *

# 回答

## 1.修复英国政府的正则表达式

**修复问题**部分中列出的所有问题并简化模式会产生以下更短、更简洁的模式。我们还可以删除大部分组，因为我们正在验证整个邮政编码（而不是单个部分）：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/12)

```
^([A-Za-z][A-Ha-hJ-Yj-y]?[0-9][A-Za-z0-9]? ?[0-9][A-Za-z]{2}|[Gg][Ii][Rr] ?0[Aa]{2})$ 
```

这可以通过从一种情况（大写或小写）中删除所有范围并使用不区分大小写的标志来进一步缩短。**注意**：有些语言没有，所以请使用上面较长的一种。每种语言都以不同的方式实现不区分大小写标志。

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/13)。

```
^([A-Z][A-HJ-Y]?[0-9][A-Z0-9]? ?[0-9][A-Z]{2}|GIR ?0A{2})$ 
```

`[0-9]`再次替换为更短`\d`（如果您的正则表达式引擎支持它）：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/14)。

```
^([A-Z][A-HJ-Y]?\d[A-Z\d]? ?\d[A-Z]{2}|GIR ?0A{2})$ 
```

## 2\. 简化模式

在不确保特定字母字符的情况下，可以使用以下内容（请记住**1\. Fixing the UK Government's Regex**的简化也已在此处应用）：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/15)。

```
^([A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}|GIR ?0A{2})$ 
```

如果您不关心特殊情况，甚至更进一步`GIR 0AA`：

```
^[A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}$ 
```

## 3\. 复杂的模式

我不建议对邮政编码进行过度验证，因为新区、区和分区可能随时出现。我建议*可能*做的是增加对边缘情况的支持。存在一些特殊情况，并在[此 Wikipedia 文章](https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Special_cases)中进行了概述。

这是包含**3.** (3.1, 3.2, 3.3) 小节的复杂正则表达式。

关于**1\. Fixing the UK Government's Regex**中的模式：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/19)

```
^(([A-Z][A-HJ-Y]?\d[A-Z\d]?|ASCN|STHL|TDCU|BBND|[BFS]IQQ|PCRN|TKCA) ?\d[A-Z]{2}|BFPO ?\d{1,4}|(KY\d|MSR|VG|AI)[ -]?\d{4}|[A-Z]{2} ?\d{2}|GE ?CX|GIR ?0A{2}|SAN ?TA1)$ 
```

以及关于**2\. 简化模式**：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/20)

```
^(([A-Z]{1,2}\d[A-Z\d]?|ASCN|STHL|TDCU|BBND|[BFS]IQQ|PCRN|TKCA) ?\d[A-Z]{2}|BFPO ?\d{1,4}|(KY\d|MSR|VG|AI)[ -]?\d{4}|[A-Z]{2} ?\d{2}|GE ?CX|GIR ?0A{2}|SAN ?TA1)$ 
```

### 3.1 英国海外领土

维基百科文章目前指出（一些格式略有简化）：

*   `AI-1111`: 安圭拉
*   `ASCN 1ZZ`: 阿森松岛
*   `STHL 1ZZ`: 圣赫勒拿
*   `TDCU 1ZZ`: 特里斯坦·达库尼亚
*   `BBND 1ZZ`： 英属印度洋领地
*   `BIQQ 1ZZ`: 英属南极领地
*   `FIQQ 1ZZ`： 福克兰群岛
*   `GX11 1ZZ`: 直布罗陀
*   `PCRN 1ZZ`: 皮特凯恩群岛
*   `SIQQ 1ZZ`: 南乔治亚岛和南桑威奇群岛
*   `TKCA 1ZZ`： 特克斯和凯科斯群岛
*   `BFPO 11`: 阿克罗蒂里和德凯利亚
*   `ZZ 11`& `GE CX`：百慕大（根据[本文件](http://www.bpo.bm/Lists/Postal%20Codes/Attachments/1/Bermuda%20Postal%20Codes%20and%20Parishes%202013.pdf)）
*   `KY1-1111`：开曼群岛（根据[本文件](http://www.caymanpost.gov.ky/portal/page/portal/poshome/posnpimages/POSTCODE%20FINDER%20COLOUR.pdf)）
*   `VG1111`：英属维尔京群岛（根据[本文件](http://www.bvi.gov.vg/content/what-are-postcodes-addresses-british-virgin-islands)）
*   `MSR 1111`：蒙特塞拉特（根据[本文件](http://www.gov.ms/wp-content/uploads/2014/02/Postal-Code-Guide-pamphlet.pdf)）

仅匹配英国海外领土的包罗万象的正则表达式可能如下所示：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/15)。

```
^((ASCN|STHL|TDCU|BBND|[BFS]IQQ|GX\d{2}|PCRN|TKCA) ?\d[A-Z]{2}|(KY\d|MSR|VG|AI)[ -]?\d{4}|(BFPO|[A-Z]{2}) ?\d{2}|GE ?CX)$ 
```

### 3.2 英军邮局

尽管它们最近已更改为更好地与英国邮政编码系统保持一致`BF#`（其中`#`代表数字），但它们被认为是*可选的替代邮政编码*。这些邮政编码遵循（ed）的格式`BFPO`，后跟 1-4 位数字：

[请参阅此处使用的正则表达式](https://regex101.com/r/ajQHrd/17)

```
^BFPO ?\d{1,4}$ 
```

### 3.3 圣诞老人？

圣诞老人还有另一个特殊情况（如其他答案中所述）：`SAN TA1`是有效的邮政编码。一个正则表达式非常简单：

```
^SAN ?TA1$ 
```

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2011-08-31T15:02:35.620

看起来我们将要使用`^(GIR ?0AA|[A-PR-UWYZ]([0-9]{1,2}|([A-HK-Y][0-9]([0-9ABEHMNPRV-Y])?)|[0-9][A-HJKPS-UW]) ?[0-9][ABD-HJLNP-UW-Z]{2})$`，这是上面 Minglis 建议的稍作修改的版本。

但是，我们将不得不确切地调查规则是什么，因为上面列出的各种解决方案似乎应用了不同的规则来允许哪些字母。

经过一番研究，我们发现了更多信息。显然，“govtalk.gov.uk”上的一个页面将您指向邮政编码规范[govtalk-postcodes](http://interim.cabinetoffice.gov.uk/govtalk/schemasstandards/e-gif/datastandards/address/postcode.aspx)。这指向 XML Schema 中的[XML 模式](http://interim.cabinetoffice.gov.uk/media/291293/bs7666-v2-0.xml)，它提供邮政编码规则的“伪正则表达式”语句。

我们已经采取了这一点并对其进行了一些工作，以给出以下表达式：

```
^((GIR &0AA)|((([A-PR-UWYZ][A-HK-Y]?[0-9][0-9]?)|(([A-PR-UWYZ][0-9][A-HJKSTUW])|([A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRV-Y]))) &[0-9][ABD-HJLNP-UW-Z]{2}))$ 
```

这使得空格是可选的，但确实将您限制为一个空格（将 '&' 替换为 '{0,} 以获得无限空间）。它假定所有文本都必须是大写的。

如果你想允许小写，任意数量的空格，使用：

```
^(([gG][iI][rR] {0,}0[aA]{2})|((([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y]?[0-9][0-9]?)|(([a-pr-uwyzA-PR-UWYZ][0-9][a-hjkstuwA-HJKSTUW])|([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y][0-9][abehmnprv-yABEHMNPRV-Y]))) {0,}[0-9][abd-hjlnp-uw-zABD-HJLNP-UW-Z]{2}))$ 
```

这不包括海外领土，只强制执行格式，而不是不同区域的存在。它基于以下规则：

可以接受以下格式：

*   “GIR 0AA”</li>
*   A9 9ZZ
*   A99 9ZZ
*   AB9 9ZZ
*   AB99 9ZZ
*   A9C 9ZZ
*   AD9E 9ZZ

在哪里：

*   9 可以是任何一位数。
*   A 可以是除 Q、V 或 X 之外的任何字母。
*   B 可以是除 I、J 或 Z 之外的任何字母。
*   C 可以是除 I、L、M、N、O、P、Q、R、V、X、Y 或 Z 之外的任何字母。
*   D 可以是除 I、J 或 Z 之外的任何字母。
*   E可以是A、B、E、H、M、N、P、R、V、W、X或Y中的任何一个。
*   Z 可以是除 C、I、K、M、O 或 V 之外的任何字母。

最良好的祝愿

科林

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2013-06-10T12:36:03.253

没有能够*验证*邮政编码的综合英国邮政编码正则表达式。您可以使用正则表达式检查邮政编码的格式是否正确；并不是说它确实存在。

邮政编码任意复杂且不断变化。例如`W1`，对于每个邮政编码区域，outcode 没有，也可能永远不会包含 1 到 99 之间的每个数字。

你不能指望目前存在的东西永远是真实的。例如，在 1990 年，邮局认为阿伯丁有点拥挤。他们在 AB1-5 的末尾添加了一个 0，使其成为 AB10-50，然后在它们之间创建了许多邮政编码。

每当建立一条新街道时，就会创建一个新的邮政编码。这是获得建造许可的过程的一部分；地方当局有义务与邮局保持更新（不是他们都这样做）。

此外，正如许多其他用户所指出的，还有一些特殊的邮政编码，例如 Girobank，GIR 0AA，以及给圣诞老人写信的邮政编码 SAN TA1——你可能不想在那里发布任何东西，但它似乎没有被任何其他答案覆盖。

然后是 BFPO 邮政编码，现在正在[更改为更标准的格式](https://www.gov.uk/government/publications/british-forces-post-office-locations)。两种格式都将有效。最后，还有海外领土^([来源维基百科](http://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom))。

```
+----------+-------------------------- --------+
| 邮编 | 位置 |
+----------+-------------------------- --------+
| AI-2640 | 安圭拉 |
| ASCN 1ZZ | 阿森松岛 |
| STHL 1ZZ | 圣赫勒拿 |
| TDCU 1ZZ | 特里斯坦达库尼亚 |
| BBND 1ZZ | 英属印度洋领地 |
| BIQQ 1ZZ | 英属南极领地 |
| FIQQ 1ZZ | 福克兰群岛 |
| GX11 1AA | 直布罗陀 |
| PCRN 1ZZ | 皮特凯恩群岛 |
| SIQQ 1ZZ | 南乔治亚岛和南桑威奇群岛 |
| TKCA 1ZZ | 特克斯和凯科斯群岛 |
+----------+-------------------------- --------+
```

接下来，您必须考虑到英国将其邮政编码系统“出口”到世界许多地方。任何验证“英国”邮政编码的东西也将验证许多其他国家的邮政编码。

如果您想*验证*英国邮政编码，最安全的方法是使用当前邮政编码查找。有多种选择：

*   Ordnance Survey在开放数据许可下发布[Code-Point Open 。](http://www.ordnancesurvey.co.uk/oswebsite/products/code-point-open/)它会稍微落后于时代，但它是免费的。这将（可能 - 我不记得）不包括北爱尔兰数据，因为军械调查在那里没有职权范围。北爱尔兰的测绘由北爱尔兰军械测量局进行，他们有自己的独立的、付费的[指针](https://maps.osni.gov.uk/CMSPages/moreinfo_address_data.aspx)产品。您可以使用它并附加一些不太容易涵盖的内容。

*   Royal Mail 发布[Postcode Address File (PAF)](http://www.poweredbypaf.com/)，其中包括 BFPO，我不确定 Code-Point Open 是否会这样做。它会定期更新，但要花钱（有时他们可能会非常刻薄）。PAF 包括完整的地址而不仅仅是邮政编码，并带有自己的[程序员指南](http://www.poweredbypaf.com/wp-content/themes/amu/paf_downloads/programmers_guide.pdf)。开放数据用户组 (ODUG) 目前正在游说免费发布 PAF，[这是他们的立场描述](http://data.gov.uk/library/odug-response-to-ofcom-paf-review-consultation)。

*   最后，还有[AddressBase](https://www.ordnancesurvey.co.uk/business-and-government/products/addressbase-products.html)。这是军械调查局、地方当局、皇家邮政和一家匹配公司之间的合作，以创建有关所有英国地址的所有信息的权威目录（他们也相当成功）。它是付费的，但如果您与地方当局、政府部门或政府服务机构合作，他们可以免费使用。除了包含邮政编码之外，还有更多信息。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-10-02T23:12:53.980

```
^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$ 
```

> 匹配有效英国邮政编码的正则表达式。在英国邮政系统中，并非所有字母都用于所有位置（与车辆牌照相同），并且有各种规则来管理这一点。此正则表达式考虑了这些规则。规则详情：邮编前半部分有效格式[AZ][AZ][0-9][AZ][AZ][AZ][0-9][0-9][AZ][0-9][ 0-9] [AZ][AZ][0-9] [AZ][AZ][AZ] [AZ][0-9][AZ] [AZ][0-9] 例外位置 - 第一。约束 - 未使用 QVX 位置 - 第二。Contraint - IJZ 不使用，除了 GIR 0AA 位置 - 第三。约束 - AEHMNPRTVXY 仅使用位置 - Forth。Contraint - ABEHMNPRVWXY 邮政编码的后半部分 有效格式 [0-9][AZ][AZ] 例外位置 - 第二和第三。约束 - CIKMOV 未使用

[http://regexlib.com/REDetails.aspx?regexp_id=260](http://regexlib.com/REDetails.aspx?regexp_id=260)

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2013-07-06T22:18:33.060

我查看了上面的一些答案，我建议不要使用@Dan 的[答案 (c. Dec 15 '10)](https://stackoverflow.com/questions/164979/uk-postcode-regex-comprehensive#answer-164992)中的模式，因为它错误地将几乎 0.4% 的有效邮政编码标记为无效，而其他的则没有.

Ordnance Survey 提供名为 Code Point Open 的服务，该服务：

> 包含英国所有当前邮政编码单位的列表

我使用以下数据针对完整的邮政编码列表（2013 年 7 月 6 日）运行了上面的每个正则表达式`grep`：

```
cat CSV/*.csv |
    # Strip leading quotes
    sed -e 's/^"//g' |
    # Strip trailing quote and everything after it
    sed -e 's/".*//g' |
    # Strip any spaces
    sed -E -e 's/ +//g' |
    # Find any lines that do not match the expression
    grep --invert-match --perl-regexp "$pattern" 
```

共有 1,686,202 个邮政编码。

以下是每个*不* 匹配的有效邮政编码的数量`$pattern`：

```
'^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]?[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$'
# => 6016 (0.36%) 
```

```
'^(GIR ?0AA|[A-PR-UWYZ]([0-9]{1,2}|([A-HK-Y][0-9]([0-9ABEHMNPRV-Y])?)|[0-9][A-HJKPS-UW]) ?[0-9][ABD-HJLNP-UW-Z]{2})$'
# => 0 
```

```
'^GIR[ ]?0AA|((AB|AL|B|BA|BB|BD|BH|BL|BN|BR|BS|BT|BX|CA|CB|CF|CH|CM|CO|CR|CT|CV|CW|DA|DD|DE|DG|DH|DL|DN|DT|DY|E|EC|EH|EN|EX|FK|FY|G|GL|GY|GU|HA|HD|HG|HP|HR|HS|HU|HX|IG|IM|IP|IV|JE|KA|KT|KW|KY|L|LA|LD|LE|LL|LN|LS|LU|M|ME|MK|ML|N|NE|NG|NN|NP|NR|NW|OL|OX|PA|PE|PH|PL|PO|PR|RG|RH|RM|S|SA|SE|SG|SK|SL|SM|SN|SO|SP|SR|SS|ST|SW|SY|TA|TD|TF|TN|TQ|TR|TS|TW|UB|W|WA|WC|WD|WF|WN|WR|WS|WV|YO|ZE)(\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}))|BFPO[ ]?\d{1,4}$'
# => 0 
```

当然，这些结果只处理被错误标记为无效的有效邮政编码。所以：

```
'^.*$'
# => 0 
```

关于过滤无效邮政编码的最佳模式，我没有说什么。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2013-05-10T15:41:40.223

这里的大多数答案不适用于我数据库中的所有邮政编码。我终于找到了一个使用政府提供的新正则表达式验证所有人的方法：

[https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/413338/Bulk_Data_Transfer_-_additional_validation_valid_from_March_2015.pdf](https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/413338/Bulk_Data_Transfer_-_additional_validation_valid_from_March_2015.pdf)

它不在以前的任何答案中，所以我将其发布在这里，以防他们取消链接：

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$ 
```

更新：更新了 Jamie Bull 指出的正则表达式。不确定是我的错误复制还是政府正则表达式中的错误，链接现在关闭了......

更新：正如 ctwheels 所发现的，此正则表达式适用于 javascript 正则表达式风格。请参阅他对 pcre (php) 风格的评论。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2015-04-23T10:07:34.440

根据这个维基百科表

![在此处输入图像描述](https://i.stack.imgur.com/XOv8u.png)

此模式涵盖所有情况

```
(?:[A-Za-z]\d ?\d[A-Za-z]{2})|(?:[A-Za-z][A-Za-z\d]\d ?\d[A-Za-z]{2})|(?:[A-Za-z]{2}\d{2} ?\d[A-Za-z]{2})|(?:[A-Za-z]\d[A-Za-z] ?\d[A-Za-z]{2})|(?:[A-Za-z]{2}\d[A-Za-z] ?\d[A-Za-z]{2}) 
```

在 Android\Java 上使用时使用 \\d

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2014-11-12T12:34:55.077

一个旧帖子，但在谷歌搜索结果中仍然很高，所以我想我会更新。这份 10 月 14 日的文档将英国邮政编码正则表达式定义为：

```
^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([**AZ**a-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) [0-9][A-Za-z]{2})$ 
```

从：

[https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/359448/4__Bulk_Data_Transfer_-_additional_validation_valid.pdf](https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/359448/4__Bulk_Data_Transfer_-_additional_validation_valid.pdf)

该文件还解释了其背后的逻辑。但是，它有一个错误（粗体）并且还允许小写，虽然这不是通常的合法，所以修改了版本：

```
^(GIR 0AA)|((([A-Z][0-9]{1,2})|(([A-Z][A-HJ-Y][0-9]{1,2})|(([A-Z][0-9][A-Z])|([A-Z][A-HJ-Y][0-9]?[A-Z])))) [0-9][A-Z]{2})$ 
```

这适用于以前版本没有的新伦敦邮政编码（例如 W1D 5LH）。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2013-04-11T15:44:09.900

这是 Google 在其[i18napis.appspot.com](http://i18napis.appspot.com/address/data/GB)域上提供的正则表达式：

```
GIR[ ]?0AA|((AB|AL|B|BA|BB|BD|BH|BL|BN|BR|BS|BT|BX|CA|CB|CF|CH|CM|CO|CR|CT|CV|CW|DA|DD|DE|DG|DH|DL|DN|DT|DY|E|EC|EH|EN|EX|FK|FY|G|GL|GY|GU|HA|HD|HG|HP|HR|HS|HU|HX|IG|IM|IP|IV|JE|KA|KT|KW|KY|L|LA|LD|LE|LL|LN|LS|LU|M|ME|MK|ML|N|NE|NG|NN|NP|NR|NW|OL|OX|PA|PE|PH|PL|PO|PR|RG|RH|RM|S|SA|SE|SG|SK|SL|SM|SN|SO|SP|SR|SS|ST|SW|SY|TA|TD|TF|TN|TQ|TR|TS|TW|UB|W|WA|WC|WD|WF|WN|WR|WS|WV|YO|ZE)(\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}))|BFPO[ ]?\d{1,4} 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2014-04-29T21:52:50.683

邮政编码可能会发生变化，验证邮政编码的唯一真正方法是拥有完整的邮政编码列表并查看它是否存在。

但是正则表达式很有用，因为它们：

*   易于使用和实施
*   很短
*   跑得快
*   非常容易维护（与完整的邮政编码列表相比）
*   仍然捕获大多数输入错误

但是正则表达式往往很难维护，尤其是对于那些一开始就没有想到它的人来说。所以它必须是：

*   尽可能容易理解
*   相对未来的证明

这意味着这个答案中的大多数正则表达式都不够好。例如，我可以看到这`[A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRV-Y]`将匹配 AA1A 形式的邮政编码区域 - 但是如果添加新的邮政编码区域，那将是一件令人头疼的事情，因为很难理解它匹配的邮政编码区域。

我还希望我的正则表达式将邮政编码的前半部分和后半部分匹配为带括号的匹配项。

所以我想出了这个：

```
(GIR(?=\s*0AA)|(?:[BEGLMNSW]|[A-Z]{2})[0-9](?:[0-9]|(?<=N1|E1|SE1|SW1|W1|NW1|EC[0-9]|WC[0-9])[A-HJ-NP-Z])?)\s*([0-9][ABD-HJLNP-UW-Z]{2}) 
```

在 PCRE 格式中，它可以写成如下：

```
/^
  ( GIR(?=\s*0AA) # Match the special postcode "GIR 0AA"
    |
    (?:
      [BEGLMNSW] | # There are 8 single-letter postcode areas
      [A-Z]{2}     # All other postcode areas have two letters
      )
    [0-9] # There is always at least one number after the postcode area
    (?:
      [0-9] # And an optional extra number
      |
      # Only certain postcode areas can have an extra letter after the number
      (?<=N1|E1|SE1|SW1|W1|NW1|EC[0-9]|WC[0-9])
      [A-HJ-NP-Z] # Possible letters here may change, but [IO] will never be used
      )?
    )
  \s*
  ([0-9][ABD-HJLNP-UW-Z]{2}) # The last two letters cannot be [CIKMOV]
$/x 
```

对我来说，这是在尽可能多地进行验证、同时面向未来和易于维护之间的正确平衡。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2013-01-10T12:22:03.210

过去一天左右，我一直在寻找英国邮政编码正则表达式，偶然发现了这个线程。我按照上面的大部分建议进行了工作，但没有一个对我有用，所以我想出了我自己的正则表达式，据我所知，它捕获了截至 13 年 1 月的所有有效英国邮政编码（根据最新文献来自皇家邮政）。

下面发布了正则表达式和一些简单的邮政编码检查 PHP 代码。注意：- 它允许小写或大写邮政编码和 GIR 0AA 异常，但为了处理输入的邮政编码中间很可能存在空格，它还使用简单的 str_replace 在测试之前删除空格反对正则表达式。除此之外的任何差异以及皇家邮政本身甚至都没有在他们的文献中提及它们（参见[http://www.royalmail.com/sites/default/files/docs/pdf/programmers_guide_edition_7_v5.pdf](http://www.royalmail.com/sites/default/files/docs/pdf/programmers_guide_edition_7_v5.pdf)并从第 17 页开始阅读） ！

**注意：**在皇家邮政自己的文献（上面的链接）中，第 3 位和第 4 位的位置有些模糊，如果这些字符是字母，则例外。我直接联系了 Royal Mail 进行了清理，并用他们自己的话来说“外向代码第 4 位的字母，格式为 AANA NAA，没有例外，第 3 位的例外仅适用于外向代码的最后一个字母，带有格式 ANA NAA。” 直接从马嘴里！

```
<?php

    $postcoderegex = '/^([g][i][r][0][a][a])$|^((([a-pr-uwyz]{1}([0]|[1-9]\d?))|([a-pr-uwyz]{1}[a-hk-y]{1}([0]|[1-9]\d?))|([a-pr-uwyz]{1}[1-9][a-hjkps-uw]{1})|([a-pr-uwyz]{1}[a-hk-y]{1}[1-9][a-z]{1}))(\d[abd-hjlnp-uw-z]{2})?)$/i';

    $postcode2check = str_replace(' ','',$postcode2check);

    if (preg_match($postcoderegex, $postcode2check)) {

        echo "$postcode2check is a valid postcode<br>";

    } else {

        echo "$postcode2check is not a valid postcode<br>";

    }

?> 
```

我希望它可以帮助遇到此线程寻找解决方案的其他人。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2011-06-08T09:10:14.570

这是一个基于文档中指定格式的正则表达式，这些格式链接到 marcj 的答案：

```
/^[A-Z]{1,2}[0-9][0-9A-Z]? ?[0-9][A-Z]{2}$/ 
```

这与规范之间的唯一区别是根据规范，最后 2 个字符不能在 [CIKMOV] 中。

编辑：这是另一个测试尾随字符限制的版本。

```
/^[A-Z]{1,2}[0-9][0-9A-Z]? ?[0-9][A-BD-HJLNP-UW-Z]{2}$/ 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-01-25T11:44:17.530

上面的一些正则表达式有点限制。请注意真正的邮政编码：鉴于上述规则“位置 3 - 仅使用 AEHMNPRTVXY”，“W1K 7AA”将失败，因为“K”将被禁止。

正则表达式：

```
^(GIR 0AA|[A-PR-UWYZ]([0-9]{1,2}|([A-HK-Y][0-9]|[A-HK-Y][0-9]([0-9]|[ABEHMNPRV-Y]))|[0-9][A-HJKPS-UW])[0-9][ABD-HJLNP-UW-Z]{2})$ 
```

似乎更准确一点，请参阅[题为“英国邮政编码”的 Wikipedia 文章](http://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom)。

请注意，此正则表达式只需要大写字符。

更大的问题是您是否限制用户输入以仅允许实际存在的邮政编码，或者您是否只是试图阻止用户在表单字段中输入完整的垃圾。正确匹配每个可能的邮政编码，并在未来对其进行验证，是一个更难的难题，除非您是 HMRC，否则可能不值得。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2017-12-01T09:00:54.533

我想要一个简单的正则表达式，可以允许太多，但不能拒绝有效的邮政编码。我用这个（输入是一个剥离/修剪的字符串）：

```
/^([a-z0-9]\s*){5,8}$/i 
```

这允许使用最短的邮政编码，如“L1 8JQ”以及最长的邮政编码，如“OL14 5ET”。

因为它最多允许 8 个字符，所以如果没有空格，它也会允许不正确的 8 个字符的邮政编码：“OL145ETX”。但同样，这是一个简单的正则表达式，因为这已经足够好了。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-08-07T07:43:58.097

以下是我们处理英国邮政编码问题的方式：

```
^([A-Za-z]{1,2}[0-9]{1,2}[A-Za-z]?[ ]?)([0-9]{1}[A-Za-z]{2})$ 
```

**解释：**

*   期望 1 或 2 个 az 字符，上限或下限
*   期望 1 或 2 个数字
*   期望 0 或 1 az char，上限或下限罚款
*   允许的可选空间
*   期望 1 个数字
*   预计 2 az，上限或下限罚款

这得到了大多数格式，然后我们使用 db 来验证邮政编码是否真实，这些数据由 openpoint [https://www.ordnancesurvey.co.uk/opendatadownload/products.html驱动](https://www.ordnancesurvey.co.uk/opendatadownload/products.html)

希望这可以帮助

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-01-23T10:47:47.023

**基本规则：**

```
^[A-Z]{1,2}[0-9R][0-9A-Z]? [0-9][ABD-HJLNP-UW-Z]{2}$ 
```

英国的邮政编码（或称为邮政编码）由五到七个字母数字字符组成，由空格分隔。涉及哪些字符可以出现在特定位置的规则相当复杂，并且充满了例外。因此，刚刚显示的正则表达式遵循基本规则。

**完整规则：**

如果您需要一个以牺牲可读性为代价来勾选所有邮政编码规则框的正则表达式，请执行以下操作：

```
^(?:(?:[A-PR-UWYZ][0-9]{1,2}|[A-PR-UWYZ][A-HK-Y][0-9]{1,2}|[A-PR-UWYZ][0-9][A-HJKSTUW]|[A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRV-Y]) [0-9][ABD-HJLNP-UW-Z]{2}|GIR 0AA)$ 
```

*资料来源：[https ://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s16.html](https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s16.html)*

针对我们的客户数据库进行了测试，看起来非常准确。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2015-11-09T14:03:46.917

我使用以下正则表达式，我已经针对所有有效的英国邮政编码进行了测试。它基于推荐的规则，但尽可能合理地精简，并且不使用任何特殊语言特定的正则表达式规则。

```
([A-PR-UWYZ]([A-HK-Y][0-9]([0-9]|[ABEHMNPRV-Y])?|[0-9]([0-9]|[A-HJKPSTUW])?) ?[0-9][ABD-HJLNP-UW-Z]{2}) 
```

它假定邮政编码已转换为大写并且没有前导或尾随字符，但将接受 outcode 和 incode 之间的可选空格。

特殊的“GIR0 0AA”邮政编码被排除在外，并且不会验证，因为它不在邮局的官方邮政编码列表中，据我所知，不会用作注册地址。如果需要，作为特殊情况添加它应该是微不足道的。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-10-02T23:13:30.627

邮政编码的前半部分 有效格式

*   [AZ][AZ][0-9][AZ]
*   [AZ][AZ][0-9][0-9]
*   [AZ][0-9][0-9]
*   [AZ][AZ][0-9]
*   [AZ][AZ][AZ]
*   [AZ][0-9][AZ]
*   [AZ][0-9]

例外情况
位置 1 - 未使用 QVX
位置 2 - IJZ 未使用，GIR 0AA 除外
位置 3 - 仅使用 AEHMNPRTVXY
位置 4 - ABEHMNPRVWXY

邮政编码的后半部分

*   [0-9][AZ][AZ]

例外
位置 2+3 - CIKMOV 未使用

请记住，并非所有可能的代码都被使用，因此此列表是有效代码的必要条件但不是充分条件。与所有有效代码的列表匹配可能更容易？

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2015-03-27T13:44:37.443

根据皇家邮政的[程序员指南](http://www.royalmail.com/sites/default/files/docs/pdf/programmers_guide_edition_7_v5.pdf)检查邮政编码的格式是否有效：

```
 |----------------------------outward code------------------------------| |------inward code-----|
#special↓       α1        α2    AAN  AANA      AANN      AN    ANN    ANA (α3)        N         AA
^(GIR 0AA|[A-PR-UWYZ]([A-HK-Y]([0-9][A-Z]?|[1-9][0-9])|[1-9]([0-9]|[A-HJKPSTUW])?) [0-9][ABD-HJLNP-UW-Z]{2})$ 
```

[doogal.co.uk](http://www.doogal.co.uk/UKPostcodes.php)上的所有邮政编码都匹配，但不再使用的邮政编码除外。

在空格后添加 a`?`并使用不区分大小写的匹配来回答此问题：

```
'se50eg'.match(/^(GIR 0AA|[A-PR-UWYZ]([A-HK-Y]([0-9][A-Z]?|[1-9][0-9])|[1-9]([0-9]|[A-HJKPSTUW])?) ?[0-9][ABD-HJLNP-UW-Z]{2})$/ig);
Array [ "se50eg" ] 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2016-01-04T14:41:22.310

如果您不想验证失败，然后修剪服务器端，则此选项允许双方留有空格和制表符。

```
^\s*(([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) {0,1}[0-9][A-Za-z]{2})\s*$) 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2015-09-23T09:35:19.857

要向此列表添加一个更实用的正则表达式，我使用它允许用户输入一个`empty string`是：

```
^$|^(([gG][iI][rR] {0,}0[aA]{2})|((([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y]?[0-9][0-9]?)|(([a-pr-uwyzA-PR-UWYZ][0-9][a-hjkstuwA-HJKSTUW])|([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y][0-9][abehmnprv-yABEHMNPRV-Y]))) {0,1}[0-9][abd-hjlnp-uw-zABD-HJLNP-UW-Z]{2}))$ 
```

这个正则表达式允许大写和小写字母之间有一个可选的空格

从软件开发人员的角度来看，此正则表达式对于地址可能是可选的软件很有用。例如，如果用户不想提供他们的地址详细信息

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-04-25T17:56:27.463

通过经验测试和观察，以及通过[https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation](https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation)确认，这是我的 Python 正则表达式版本，它可以正确解析和验证英国邮政编码：

`UK_POSTCODE_REGEX = r'(?P<postcode_area>[A-Z]{1,2})(?P<district>(?:[0-9]{1,2})|(?:[0-9][A-Z]))(?P<sector>[0-9])(?P<postcode>[A-Z]{2})'`

这个正则表达式很简单并且有捕获组。它**不**包括所有*合法*英国邮政编码的验证，但只考虑字母与数字的位置。

这是我在代码中使用它的方式：

```
@dataclass
class UKPostcode:
    postcode_area: str
    district: str
    sector: int
    postcode: str

    # https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation
    # Original author of this regex: @jontsai
    # NOTE TO FUTURE DEVELOPER:
    # Verified through empirical testing and observation, as well as confirming with the Wiki article
    # If this regex fails to capture all valid UK postcodes, then I apologize, for I am only human.
    UK_POSTCODE_REGEX = r'(?P<postcode_area>[A-Z]{1,2})(?P<district>(?:[0-9]{1,2})|(?:[0-9][A-Z]))(?P<sector>[0-9])(?P<postcode>[A-Z]{2})'

    @classmethod
    def from_postcode(cls, postcode):
        """Parses a string into a UKPostcode

        Returns a UKPostcode or None
        """
        m = re.match(cls.UK_POSTCODE_REGEX, postcode.replace(' ', ''))

        if m:
            uk_postcode = UKPostcode(
                postcode_area=m.group('postcode_area'),
                district=m.group('district'),
                sector=m.group('sector'),
                postcode=m.group('postcode')
            )
        else:
            uk_postcode = None

        return uk_postcode

def parse_uk_postcode(postcode):
    """Wrapper for UKPostcode.from_postcode
    """
    uk_postcode = UKPostcode.from_postcode(postcode)
    return uk_postcode 
```

以下是单元测试：

```
@pytest.mark.parametrize(
    'postcode, expected', [
        # https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation
        (
            'EC1A1BB',
            UKPostcode(
                postcode_area='EC',
                district='1A',
                sector='1',
                postcode='BB'
            ),
        ),
        (
            'W1A0AX',
            UKPostcode(
                postcode_area='W',
                district='1A',
                sector='0',
                postcode='AX'
            ),
        ),
        (
            'M11AE',
            UKPostcode(
                postcode_area='M',
                district='1',
                sector='1',
                postcode='AE'
            ),
        ),
        (
            'B338TH',
            UKPostcode(
                postcode_area='B',
                district='33',
                sector='8',
                postcode='TH'
            )
        ),
        (
            'CR26XH',
            UKPostcode(
                postcode_area='CR',
                district='2',
                sector='6',
                postcode='XH'
            )
        ),
        (
            'DN551PT',
            UKPostcode(
                postcode_area='DN',
                district='55',
                sector='1',
                postcode='PT'
            )
        )
    ]
)
def test_parse_uk_postcode(postcode, expected):
    uk_postcode = parse_uk_postcode(postcode)
    assert(uk_postcode == expected) 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-10-21T11:44:33.150

看看这个页面上的python代码：

[http://www.brunningonline.net/simon/blog/archives/001292.html](http://www.brunningonline.net/simon/blog/archives/001292.html)

> 我有一些邮政编码解析要做。要求很简单；我必须将邮政编码解析为输出代码和（可选）输入代码。好消息是我不必执行任何验证 - 我只需以一种模糊的智能方式切碎提供给我的东西。我不能在格式方面假设我的导入，即大小写和嵌入空格。但这不是坏消息。坏消息是我必须在 RPG 中完成这一切。:-(
> 
> 尽管如此，我还是把一些 Python 函数放在一起来澄清我的想法。

我用它来为我处理邮政编码。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2012-05-15T12:14:09.323

我有英国邮政编码验证的正则表达式。

这适用于所有类型的邮政编码，无论是内部还是外部

```
^((([A-PR-UWYZ][0-9])|([A-PR-UWYZ][0-9][0-9])|([A-PR-UWYZ][A-HK-Y][0-9])|([A-PR-UWYZ][A-HK-Y][0-9][0-9])|([A-PR-UWYZ][0-9][A-HJKSTUW])|([A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRVWXY]))) || ^((GIR)[ ]?(0AA))$|^(([A-PR-UWYZ][0-9])[ ]?([0-9][ABD-HJLNPQ-UW-Z]{0,2}))$|^(([A-PR-UWYZ][0-9][0-9])[ ]?([0-9][ABD-HJLNPQ-UW-Z]{0,2}))$|^(([A-PR-UWYZ][A-HK-Y0-9][0-9])[ ]?([0-9][ABD-HJLNPQ-UW-Z]{0,2}))$|^(([A-PR-UWYZ][A-HK-Y0-9][0-9][0-9])[ ]?([0-9][ABD-HJLNPQ-UW-Z]{0,2}))$|^(([A-PR-UWYZ][0-9][A-HJKS-UW0-9])[ ]?([0-9][ABD-HJLNPQ-UW-Z]{0,2}))$|^(([A-PR-UWYZ][A-HK-Y0-9][0-9][ABEHMNPRVWXY0-9])[ ]?([0-9][ABD-HJLNPQ-UW-Z]{0,2}))$ 
```

这适用于所有类型的格式。

例子：

> AB10-------->只有外部邮政编码
> 
> A1 1AA----------------->（外部和内部）邮政编码的组合
> 
> WC2A-------->外

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2021-11-02T06:29:27.523

虽然这里有很多答案，但我对其中任何一个都不满意。它们中的大多数只是简单地损坏，太复杂或刚刚损坏。

我查看了[@ctwheels](https://stackoverflow.com/questions/164979/regex-for-matching-uk-postcodes#51885364)的答案，发现它非常具有解释性和正确性；我们必须为此感谢他。然而，对我来说又一次太多的“数据”，对于这么简单的事情。

幸运的是，我设法获得了一个仅包含英格兰超过 100 万个活动邮政编码的数据库，并制作了一个小型 PowerShell 脚本来测试和基准测试结果。

英国邮政编码规范：[有效的邮政编码格式](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/611951/Appendix_C_ILR_2017_to_2018_v1_Published_28April17.pdf)。

**这是“我的”正则表达式：**

```
^([a-zA-Z]{1,2}[a-zA-Z\d]{1,2})\s(\d[a-zA-Z]{2})$ 
```

简短、简单、甜美。即使是最没有经验的人也能理解发生了什么。

**解释：**

```
^ asserts position at start of a line
    1st Capturing Group ([a-zA-Z]{1,2}[a-zA-Z\d]{1,2})
        Match a single character present in the list below [a-zA-Z]
        {1,2} matches the previous token between 1 and 2 times, as many times as possible, giving back as needed (greedy)
        a-z matches a single character in the range between a (index 97) and z (index 122) (case sensitive)
        A-Z matches a single character in the range between A (index 65) and Z (index 90) (case sensitive)
        Match a single character present in the list below [a-zA-Z\d]
        {1,2} matches the previous token between 1 and 2 times, as many times as possible, giving back as needed (greedy)
        a-z matches a single character in the range between a (index 97) and z (index 122) (case sensitive)
        A-Z matches a single character in the range between A (index 65) and Z (index 90) (case sensitive)
        \d matches a digit (equivalent to [0-9])
        \s matches any whitespace character (equivalent to [\r\n\t\f\v ])
    2nd Capturing Group (\d[a-zA-Z]{2})
        \d matches a digit (equivalent to [0-9])
        Match a single character present in the list below [a-zA-Z]
        {2} matches the previous token exactly 2 times
        a-z matches a single character in the range between a (index 97) and z (index 122) (case sensitive)
        A-Z matches a single character in the range between A (index 65) and Z (index 90) (case sensitive)
$ asserts position at the end of a line 
```

**结果（检查邮政编码）：**

```
TOTAL OK: 1469193
TOTAL FAILED: 0
-------------------------------------------------------------------------
Days              : 0
Hours             : 0
Minutes           : 5
Seconds           : 22
Milliseconds      : 718
Ticks             : 3227185939
TotalDays         : 0.00373516891087963
TotalHours        : 0.0896440538611111
TotalMinutes      : 5.37864323166667
TotalSeconds      : 322.7185939
TotalMilliseconds : 322718.5939 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2012-08-08T12:57:05.657

我们得到了一个规格：

```
英国邮政编码必须采用以下形式之一（有一种例外，见下文）：
    § A9 9AA
    § A99 9AA
    § AA9 9AA
    § AA99 9AA
    § A9A 9AA
    § AA9A 9AA
其中 A 代表字母字符，9 代表数字字符。
附加规则适用于字母字符，如下所示：
    § 位置 1 的字符不能是 Q、V 或 X
    § 位置 2 的字符不能是 I、J 或 Z
    § 位置 3 的字符不能是 I、L、M、N、O、P、Q、R、V、X、Y 或 Z
    § 位置 4 的字符不能是 C、D、F、G、I、J、K、L、O、Q、S、T、U 或 Z
    § 最右边两个位置的字符不能是 C、I、K、M、O 或 V
不遵循这些一般规则的一个例外是邮政编码“GIR 0AA”，这是一种特殊的有效邮政编码。
```

我们想出了这个：

```
/^([A-PR-UWYZ][A-HK-Y0-9](?:[A-HJKS-UW0-9][ABEHMNPRV-Y0-9]?)?\s*[0-9][ABD-HJLNP-UW-Z]{2}|GIR\s*0AA)$/i 
```

但请注意 - 这允许组之间有任意数量的空格。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-03-31T08:00:40.447

接受的答案反映了皇家邮政给出的规则，尽管正则表达式中有错字。这个错字似乎也出现在 gov.uk 网站上（就像它在 XML 存档页面中一样）。

在格式 A9A 9AA 中，规则允许 P 字符位于第三个位置，而正则表达式不允许这样做。正确的正则表达式是：

```
(GIR 0AA)|((([A-Z-[QVX]][0-9][0-9]?)|(([A-Z-[QVX]][A-Z-[IJZ]][0-9][0-9]?)|(([A-Z-[QVX]][0-9][A-HJKPSTUW])|([A-Z-[QVX]][A-Z-[IJZ]][0-9][ABEHMNPRVWXY])))) [0-9][A-Z-[CIKMOV]]{2}) 
```

缩短这会导致以下正则表达式（使用 Perl/Ruby 语法）：

```
(GIR 0AA)|([A-PR-UWYZ](([0-9]([0-9A-HJKPSTUW])?)|([A-HK-Y][0-9]([0-9ABEHMNPRVWXY])?))\s?[0-9][ABD-HJLNP-UW-Z]{2}) 
```

它还包括第一个和第二个块之间的可选空间。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2017-11-15T17:16:11.123

我在几乎所有变体和批量传输 pdf 中的正则表达式以及维基百科网站上发现的内容是这样的，特别是对于维基百科正则表达式，第一个 |（竖线）之后需要有一个 ^。我通过测试 AA9A 9AA 发现了这一点，否则 A9A 9AA 的格式检查将验证它。例如，检查应该无效的 EC1D 1BB 会返回有效，因为 C1D 1BB 是有效格式。

这是我想出的一个好的正则表达式：

```
^([G][I][R] 0[A]{2})|^((([A-Z-[QVX]][0-9]{1,2})|([A-Z-[QVX]][A-HK-Y][0-9]{1,2})|([A-Z-[QVX]][0-9][ABCDEFGHJKPSTUW])|([A-Z-[QVX]][A-HK-Y][0-9][ABEHMNPRVWXY])) [0-9][A-Z-[CIKMOV]]{2})$ 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2019-03-09T23:30:00.287

以下方法将检查邮政编码并提供完整信息

```
const isValidUKPostcode = postcode => {
    try {
        postcode = postcode.replace(/\s/g, "");
        const fromat = postcode
            .toUpperCase()
            .match(/^([A-Z]{1,2}\d{1,2}[A-Z]?)\s*(\d[A-Z]{2})$/);
        const finalValue = `${fromat[1]} ${fromat[2]}`;
        const regex = /^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([AZa-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z]))))[0-9][A-Za-z]{2})$/i;
        return {
            isValid: regex.test(postcode),
            formatedPostCode: finalValue,
            error: false,
            message: 'It is a valid postcode'
        };
    } catch (error) {
        return { error: true , message: 'Invalid postcode'};
    }
}; 
```

```
console.log(isValidUKPostcode('GU348RR'))
{isValid: true, formattedPostcode: "GU34 8RR", error: false, message: "It is a valid postcode"} 
```

```
console.log(isValidUKPostcode('sdasd4746asd'))
{error: true, message: "Invalid postcode!"} 
```

```
valid_postcode('787898523')
result => {error: true, message: "Invalid postcode"} 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2017-05-04T22:10:47.820

我需要一个可以在 SAS 中使用`PRXMATCH`和相关功能的版本，所以我想出了这个：

```
^[A-PR-UWYZ](([A-HK-Y]?\d\d?)|(\d[A-HJKPSTUW])|([A-HK-Y]\d[ABEHMNPRV-Y]))\s?\d[ABD-HJLNP-UW-Z]{2}$ 
```

测试用例和注释：

```
/* 
Notes
The letters QVX are not used in the 1st position.
The letters IJZ are not used in the second position.
The only letters to appear in the third position are ABCDEFGHJKPSTUW when the structure starts with A9A.
The only letters to appear in the fourth position are ABEHMNPRVWXY when the structure starts with AA9A.
The final two letters do not use the letters CIKMOV, so as not to resemble digits or each other when hand-written.
*/

/*
    Bits and pieces
    1st position (any):         [A-PR-UWYZ]         
    2nd position (if letter):   [A-HK-Y]
    3rd position (A1A format):  [A-HJKPSTUW]
    4th position (AA1A format): [ABEHMNPRV-Y]
    Last 2 positions:           [ABD-HJLNP-UW-Z]    
*/

data example;
infile cards truncover;
input valid 1\. postcode &$10\. Notes &$100.;
flag = prxmatch('/^[A-PR-UWYZ](([A-HK-Y]?\d\d?)|(\d[A-HJKPSTUW])|([A-HK-Y]\d[ABEHMNPRV-Y]))\s?\d[ABD-HJLNP-UW-Z]{2}$/',strip(postcode));
cards;
1  EC1A 1BB  Special case 1
1  W1A 0AX   Special case 2
1  M1 1AE    Standard format
1  B33 8TH   Standard format
1  CR2 6XH   Standard format
1  DN55 1PT  Standard format
0  QN55 1PT  Bad letter in 1st position
0  DI55 1PT  Bad letter in 2nd position
0  W1Z 0AX   Bad letter in 3rd position
0  EC1Z 1BB  Bad letter in 4th position
0  DN55 1CT  Bad letter in 2nd group
0  A11A 1AA  Invalid digits in 1st group
0  AA11A 1AA  1st group too long
0  AA11 1AAA  2nd group too long
0  AA11 1AAA  2nd group too long
0  AAA 1AA   No digit in 1st group
0  AA 1AA    No digit in 1st group
0  A 1AA     No digit in 1st group
0  1A 1AA    Missing letter in 1st group
0  1 1AA     Missing letter in 1st group
0  11 1AA    Missing letter in 1st group
0  AA1 1A    Missing letter in 2nd group
0  AA1 1     Missing letter in 2nd group
;
run; 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2019-05-14T16:09:01.030

我从一个 XML 文档中窃取了它，它似乎涵盖了所有没有硬编码 GIRO 的情况：

```
%r{[A-Z]{1,2}[0-9R][0-9A-Z]? [0-9][A-Z]{2}}i 
```

（忽略大小写的 Ruby 语法）

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2021-09-21T12:38:27.377

我今天为英国邮政编码验证做了正则表达式，据我所知，它适用于所有英国邮政编码，如果你放一个空格或者你不放一个空格，它就可以工作。

```
^((([a-zA-Z][0-9])|([a-zA-Z][0-9]{2})|([a-zA-Z]{2}[0-9])|([a-zA-Z]{2}[0-9]{2})|([A-Za-z][0-9][a-zA-Z])|([a-zA-Z]{2}[0-9][a-zA-Z]))(\s*[0-9][a-zA-Z]{2})$) 
```

让我知道是否有它不涵盖的格式

# php - PHP 4 和 5、Ctrl-C、system() 和子进程

> ID：164981
> 
> 赞同：2
> 
> 时间：2008-10-02T23:07:34.243
> 
> 标签：php, windows, system, children, copy-paste

我有一个 PHP 脚本，它使用`system()`调用来执行其他（可能长时间运行的）程序（感兴趣：NCBI BLAST、phrap、primer3 和其他用于进行 DNA 序列分析和组装的程序）。

我在 Windows XP 下运行，在命令提示符下使用 PHP 的 CLI 版本，或者作为服务运行。（无论哪种情况，我都通过数据库表中的任务队列与它通信）。

在 PHP4 下：当我点击`Ctrl`+时`C`，脚本停止并且当时运行的任何子进程也停止。在 PHP5 下：当我点击`Ctrl`+时`C`，脚本停止，但孩子仍在运行。

同样，当将脚本作为服务运行时，使用 PHP4 运行时停止服务会停止子进程，而使用 PHP5 时子进程会继续运行。

我尝试编写一个最小的测试应用程序，并发现了相同的行为。测试 PHP 脚本仅使用 system() 执行 C 程序（仅休眠 30 秒），然后等待按键被按下。

我查看了 PHP 4.4.9 和 5.2.6 的源代码，但在 system() 代码中没有发现它们会导致这种情况的差异。我还快速查看了 CLI 应用程序的启动代码，并没有发现信号处理方面的任何差异。

任何可能导致此问题或解决方法的提示将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T02:09:09.363

此问题至少出现在 PHP 5.1.2 中。

当通过 CTRL+C 或 CTRL+BREAK 发送 SIGINT 时，将调用处理程序。如果此处理程序向其他子级发送 SIGTERM，则不会收到信号。

SIGINT 可以通过 posix_kill() 发送，它的工作方式与预期完全一样——这仅适用于通过硬中断启动时。

来自： http: [//php.oregonstate.edu/manual/en/function.pcntl-signal.php](http://php.oregonstate.edu/manual/en/function.pcntl-signal.php)

该文档包含用于捕获 CTRL+C 并将 posix_kill 发送给孩子的示例代码。它有很多关于子进程和信号的其他代码和信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T17:41:27.997

不要使用 system()，而是看一下[proc_open()](http://no2.php.net/manual/en/function.proc-close.php)、[proc_close()](http://no2.php.net/manual/en/function.proc-close.php)和[proc_terminate()](http://no2.php.net/manual/en/function.proc-terminate.php)。

# svn - 在 .Net 项目中引用来自 svn:external build 的构建工件

> ID：164990
> 
> 赞同：2
> 
> 时间：2008-10-02T23:11:38.603
> 
> 标签：svn, build-process, nant

这是[我之前问过的问题的延续问题](https://stackoverflow.com/questions/142237/integrating-external-sources-in-a-build.)

我现在在项目树的根目录中有一个 /externals 目录。在这里面，我引用了另一个项目。我可以在主项目 NAnt 脚本中编写所有外部组件的构建脚本。这些构建的结果如下：

/externals/external-project1/build/buildartifacts/{dlls|html|js}

/externals/external-project2/build/buildartifacts/{dlls|html|js}

这一切都很好，但现在我很好奇我的主要项目应该如何引用这些构建工件。例如，假设外部项目构建了我的一些代码库所依赖的 DLL。我应该简单地引用构建工件目录中的 DLL，还是应该实现另一个将这些复制到 /thirdparty/libs/ 文件夹的 NAnt 任务？

这意味着我的构建现在依赖于构建这个外部项目（可以是内部项目，也可以是第三方项目）的能力。签入最新的构建工件集以确保主构建不会因为依赖构建中断而中断是个好主意吗？

希望这足够清楚。只是把这个写下来对我来说至少澄清了这个问题:-)。

- 编辑 -

多谢你们。我想我将实施“签出修订版”，但由于构建速度如此之快，我不会签入任何构建工件。还必须弄清楚如何处理外部项目的依赖关系（例如：原型、swfobject 等）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T23:25:48.617

我会说构建它们一次并检查 /public/ext/some_dependency/ref 中的构建工件（显然，该文件夹的命名取决于您:-)）并从那里引用它们。

我的主要原因是每次构建产品时都很少需要构建外部依赖项。一般来说，外部依赖关系应该很少改变。另外，您希望严格控制何时选择外部依赖项更改，以避免在编码阶段引入不稳定。

作为对此的扩展，我将添加一个单独的 CI 任务，该任务将仅构建外部依赖项，并在某些外部条件下在上述文件夹中检查它们 - 依赖源文件夹中的提交或其他内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T23:35:20.323

我的建议之一（我认为来自 Mike Mason 的 Pragmatic Version Control 一书）在您的外部引用特定修订，以便您始终获得相同版本的外部依赖项，直到您明确选择更改它。

此时，您可能已经交互式地构建了一次以确保其正常工作，因此每次都依赖它来构建并不是真正的问题，这避免了在构建任务中添加一些间接性的需要。

如果您选择使用间接，并且由于某种原因构建确实在外部失败，则可能会错过此操作，因为下一个 nant 任务将拾取前一个二进制文件。

# mysql - CHAR() 或 VARCHAR() 作为 ISAM MySQL 表中的主键？

> ID：164991
> 
> 赞同：7
> 
> 时间：2008-10-02T23:12:06.760
> 
> 标签：mysql

我需要一个简单的表，其中包含 MySQL 中的用户名和密码字段。由于用户名必须是唯一的，因此将它们设为主键对我来说是有意义的。

`CHAR()`使用还是`VARCHAR()`作为主键更好？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-02T23:18:02.940

也可以只使用用户 ID 索引，连接与 char/varchar 相比要快得多。如果您不小心必须扩展架构的功能，现在添加所需的两秒钟可以为您节省大量时间。

需要考虑的一些陷阱：

*   假设我们在未来添加了几张表，如果有人想更改用户名怎么办？
*   说应用程序比我们想象的更成功，我们必须考虑优化，你真的想在这一点上重做你的模式以减少 varchar'ed 索引的开销吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T23:21:18.813

我会努力不使用 CHAR() 或 VARCHAR() 作为 PK，而是使用带有 auto_increment 的 int。这允许您在需要时在子表中使用该 user_id，并且对 PK 的查询应该更快。如果您必须使用 CHAR() 或 VARCHAR()，我会使用 CHAR()，因为它是固定宽度。

我不是 100% 确定 MySQL 如何处理 VARCHAR()，但大多数数据库引擎必须在后台做一些魔术来帮助引擎知道 VARCHAR() 字段在哪里结束以及下一个字段从哪里开始，一个 CHAR( ) 使其直截了当，并使引擎不必考虑太多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T23:54:58.827

[我会努力不使用 CHAR() 或 VARCHAR() 作为 PK，而是使用带有 auto_increment 的 int。] +1

放置用户名的唯一约束，但使用 int 字段作为 PK

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T23:20:10.767

我没有看到 CHAR 在我研究过的任何 MySQL 数据库中使用得太多。我会选择 VARCHAR

例如，对于 CHAR(30)，整个 30 个字符都存储在表中，这意味着每个条目都将占用相同的空间，即使您的用户名只有 10 个字符长。

使用 VARCHAR(30) 它只会使用足够的空间来存储您输入的字符串。

在一张小桌子上它不会有太大的区别，但在一张更大的桌子上，VARCHAR 应该证明它整体上保持更小。

# c# - 在VS2008中调试时如何发现函数末尾的返回值？

> ID：164996
> 
> 赞同：4
> 
> 时间：2008-10-02T23:14:22.463
> 
> 标签：c#, visual-studio-2008

在 Visual Studio 2008 中使用 C# 并在调试器中单步执行一个函数，我到达了一个函数的末尾，并且在最后一个大括号 } 上并即将返回。有没有办法找出函数即将返回的值？

如果返回值的计算如下：

```
return (x.Func() > y.Func()); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-02T23:17:35.890

这有点低级，但如果您切换到反汇编，那么您可以单步执行说明并查看返回值设置为什么。它通常在@eax 寄存器中设置。

如果您不想单步执行，您可以在 ret 指令上放置一个断点并在该点检查寄存器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-18T10:11:13.197

我为 Visual Studio 制作了一个名为[BugAid](http://www.bugaidsoftware.com)的商业扩展（目前处于测试阶段），它完全符合您的要求。

在您的示例中，它将向您展示：

![报表可视化](https://i.stack.imgur.com/y3YSq.png)

它的方法是在调试代码时检测代码，允许我们检索对“Func”的两次调用的返回值，从而得出表达式是否`x.Func() > y.Func()`为真。

有关更多信息，请参阅我[关于该主题的博客文章](http://www.bugaidsoftware.com/2011/11/tips-for-using-statement-visualization/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T23:17:01.227

你可以把

```
(x.Func() > y.Func()) 
```

在监视窗口中对其进行评估，并查看结果。除非声明是

```
return ValueChangesAfterEveryCall(); 
```

你应该没事。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-02T23:24:33.407

我仍在使用 VS 2003 和 C++，所以这可能适用也可能不适用。如果您使用“auto”选项卡（靠近“locals”和“watch”选项卡），它会在您返回后告诉您函数的返回值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T00:30:01.037

我实际上建议重构代码以将单个函数返回放入局部变量中。这样，您和其他人在调试代码以找出特定评估时不必费劲。通常，这会生成更易于调试的代码，因此也更易于其他人理解和维护。

```
int sumOfSomething = x.Func();
int pendingSomethings = y.Func();
return (sumOfSomething > pendingSomethings); 
```**********