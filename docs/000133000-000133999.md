# StackOverflow 问答 000133000-000133999

# apache-flex - Flex HttpService：附加到目的地

> ID：133002
> 
> 赞同：0
> 
> 时间：2008-09-25T12:28:54.067
> 
> 标签：apache-flex, rest, proxy, httpservice

我正在使用 Flex 连接到 Rest 服务。例如，要访问订单 #32，我可以调用 URL [http://[service]/orders/32](http://[service]/orders/32)。URL*必须*配置为目标 - 因为客户端将连接到服务的不同实例。所有这些都使用 Blaze 代理，因为它涉及 GET、PUT、DELETE 和 POST 调用。问题是：- 使用 HttpService 时如何将“32”附加到目的地的末尾？我所做的只是设置目的地，并在某些时候将其转换为 URL。我已经跟踪了代码，但我不知道这是在哪里完成的，所以无法替换它。

选项有： 1\. 将目标解析为 Flex 客户端中的 URL，然后将 URL（带有附加数据）设置为 URL。2.编写我自己的覆盖标准代理的java Flex Adapter，并将参数映射到url，如下所示：[http://[service]/order/](http://[service]/order/) {id}?id=32 to [http://[service]/订单/32](http://[service]/order/32)

以前有没有人遇到过这个问题，有没有简单的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T15:35:56.220

众所周知，这就是我解决此问题的方法：

我在服务器上创建了一个自定义 HTTPProxyAdapter

```
public MyHTTPProxyAdapter extends flex.messaging.services.http.HTTPProxyAdapter {

public Object invoke(Message message) {
    // modify the message - if required
    process(message);
    return super.invoke(message);
}

private void process(Message message) {
        HTTPMessage http = (HTTPMessage)message;
        if(http != null) {
            String url = http.getUrl();
            ASObject o = (ASObject)http.getBody();
            if(o != null) {
                Set keys = o.keySet();
                Iterator it = keys.iterator();
                while(it.hasNext()) {
                    String key = (String)it.next();
                    String token = "[" + key +"]";
                    if(url.contains(token)) {
                        url = url.replace(token, o.get(key).toString());
                        o.remove(key);
                    }

                }
                http.setUrl(url);
            }
        }
    }
} 
```

然后将目标适配器替换为我的适配器。我现在可以在 config.xml 中使用以下 URL，方括号中的任何内容都将替换为 Query 字符串：

```
<destination id="user-getbytoken">
        <properties>
            <url>http://localhost:8080/myapp/public/client/users/token/[id]</url>
        </properties>
</destination> 
```

在此示例中，将目标设置为 user-getbytoken 和参数 {id:123} 将导致[http://localhost:8080/myapp/public/client/users/token/123的 url](http://localhost:8080/myapp/public/client/users/token/123)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T16:11:18.697

这是通过单击事件的处理程序将 URL 解析为 Flex 中的 HTTPService 的简单方法。

这是一项服务：

```
<mx:HTTPService
    id="UCService"
    result="UCServiceHandler(event)" 
    showBusyCursor="true"
    resultFormat="e4x"
    /> 
```

然后是处理程序：

```
 private function UCmainHandler(UCurl:String) {

            UCService.url = UCurl;
            UCService.send();

        } 
```

这是一个示例点击事件：

```
<mx:Button label="add to cart" click="UCmainHandler('http://sampleurl.com/cart/add/p18_q1?destination=cart')" /> 
```

当然，您可以将其他值传递给点击处理程序，或者甚至让处理程序根据其他当前设置等向 url 添加内容......

希望有帮助！

# optimization - 什么是大 O 符号？你用它吗？

> ID：133008
> 
> 赞同：33
> 
> 时间：2008-09-25T12:29:50.413
> 
> 标签：optimization, complexity-theory, big-o

什么是大 O 符号？你用它吗？

我想我错过了这门大学课：D

有没有人使用它并给出一些他们在哪里使用它的真实例子？

* * *

### 也可以看看：

[八岁的Big-O？](https://stackoverflow.com/questions/107165/big-o-for-eight-year-olds)
[Big O，您如何计算/近似它？](https://stackoverflow.com/questions/3255/big-o-how-do-you-calculateapproximate-it)
[你在现实生活中应用了计算复杂性理论吗？](https://stackoverflow.com/questions/111426/did-you-apply-computational-complexity-theory-in-real-life)

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-25T12:57:10.350

大多数人在谈论 Big-O 时会忘记一件重要的事情，因此我觉得有必要提一下：

您不能使用 Big-O 来比较两种算法的**速度**。Big-O 仅说明如果将处理的项目数量加倍，算法会（大约）变慢多少，或者如果将数量减半，算法会变快多少。

但是，如果您有两种完全不同的算法，一种 ( `A`) 是`O(n^2)`，另一种 ( `B`) 是`O(log n)`，则并不是说它`A`比 慢`B`。实际上，有 100 个项目，`A`可能比`B`. 它只说有 200 个项目，`A`增长速度会变慢，`n^2`并且`B`会变慢`log n`。因此，如果您对两者进行基准测试，并且您知道`A`处理 100 个项目需要多少时间，以及`B`相同的 100 个项目需要多少时间，并且`A`比的下降速度比其中一个慢得多`B``B``A``B``A``A`，它迟早会超越——这是肯定的）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-25T12:51:05.167

大 O 表示法表示算法的限制因素。它是算法运行时间如何与输入相关的简化表达式。

例如（在 Java 中）：

```
/** Takes an array of strings and concatenates them
  * This is a silly way of doing things but it gets the 
  * point across hopefully
  * @param strings the array of strings to concatenate
  * @returns a string that is a result of the concatenation of all the strings
  *          in the array
  */
public static String badConcat(String[] Strings){
    String totalString = "";
    for(String s : strings) {
        for(int i = 0; i < s.length(); i++){
            totalString += s.charAt(i);
        }
    }
    return totalString;
} 
```

现在想想这实际上在做什么。它正在遍历输入的每个字符并将它们加在一起。这似乎很简单。问题是**String 是不可变的**。因此，每次在字符串上添加字母时，都必须创建一个新字符串。为此，您必须将旧字符串中的值复制到新字符串中并添加新字符。

这意味着您将复制第一个字母*n*次，其中*n*是输入中的字符数。您将复制角色`n-1`时间，因此总共会有`(n-1)(n/2)`副本。

这是`(n^2-n)/2`并且对于大 O 表示法，我们（通常）仅使用最高幅度因子并丢弃任何乘以它的常数，我们最终得到`O(n^2)`.

使用类似 a 的`StringBuilder`方法将遵循 O(nLog(n))。如果您计算开头的字符数并设置容量，`StringBuilder`您可以得到它`O(n)`。

因此，如果我们有 1000 个字符的输入，第一个示例将执行大约 100 万次操作，`StringBuilder`将执行 10,000 次，而`StringBuilder`with`setCapacity`将执行 1000 次操作来做同样的事情。这是粗略估计，但`O(n)`符号是数量级，而不是精确的运行时间。

这不是我经常使用的东西。然而，当我试图找出做某事的最佳算法时，它一直在我的脑海里。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T12:32:46.647

[Big-O](https://stackoverflow.com/questions/107165/big-o-for-eight-year-olds)已经为 8 岁儿童提出了一个非常相似的问题？. 希望那里的答案能回答您的问题，尽管那里的提问者确实对这一切有一些数学知识，如果您需要更全面的解释，您可能没有那么清楚。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T12:33:16.553

每个程序员都应该知道什么是大 O 表示法，它如何应用于具有常见数据结构和算法的动作（从而为他们正在解决的问题选择正确的 DS 和算法），以及如何为他们自己的算法计算它。

1）它是在处理数据结构时衡量算法效率的顺序。

2) 像 'add' / 'sort' / 'remove' 这样的动作对于不同的数据结构（和算法）可能会花费不同的时间，例如对于 hashmap，'add' 和 'find' 是 O(1)，但是 O (log n) 表示二叉树。在处理普通数组时，QuickSort 的排序是 O(nlog n)，而 BubbleSort 的排序是 O(n^2)。

3）通常可以通过查看算法的循环深度来进行计算。没有循环，O(1)，循环遍历所有集合（即使它们在某个点中断）O(n)。如果循环在每次迭代中将搜索空间减半？O(log n)。对一系列循环取最高的 O()，并在嵌套循环时乘以 O()。

是的，它比这更复杂。如果你真的有兴趣买一本教科书。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T16:35:03.160

'Big-O' 表示法用于比较变量（例如 n）的两个函数的增长率，因为 n 变得非常大。如果函数 f 比函数 g 增长得快得多，我们说 g = O(f) 意味着对于足够大的 n，f 将*始终*大于 g 直到一个比例因子。

事实证明，这在计算机科学中是一个非常有用的想法，尤其是在算法分析中，因为我们经常精确地关注函数的增长率，例如，表示两种不同算法所花费的时间。非常粗略地说，如果 t1 = O(t2) 对于足够大的 n（通常是问题-例如数组的长度或图中的节点数或其他。

这个规定，即 n 变得足够大，使我们能够提取很多有用的技巧。也许最常用的一个是您可以将函数简化为增长最快的项。例如 n^2 + n = O(n^2) 因为随着 n 变得足够大，n^2 项变得比 n*大得多*，以至于 n 项实际上是微不足道的。所以我们可以不考虑它。

然而，这确实意味着大 O 表示法对小 n 的用处不大，因为我们已经忘记的增长较慢的项仍然足以影响运行时。

我们现在拥有的是一种用于比较两种不同算法成本的工具，以及一种表示一种比另一种更快或更慢的简写。Big-O 表示法可能被滥用，这是一种耻辱，因为它已经不够精确了！有等价的术语可以说一个函数的增长速度比另一个函数慢，并且两个函数的增长速度相同。

哦，我用它吗？是的，一直以来——当我弄清楚我的代码有多高效时，它给出了一个很好的“粗略估计”的成本近似值。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-03T04:34:44.967

**Big-O背后的“直觉”**

想象一下两个函数在 x 上的“竞争”，因为 x 接近无穷大：f(x) 和 g(x)。

现在，如果从某个点（某个 x）开始，一个函数总是比另一个函数具有更高的值，那么让我们称这个函数比另一个函数“更快”。

因此，例如，如果对于每个 x > 100，您看到 f(x) > g(x)，那么 f(x) 比 g(x)“快”。

在这种情况下，我们会说 g(x) = O(f(x))。f(x) 对 g(x) 构成了某种“速度限制”，因为最终它会通过它并永远离开它。

这不完全是[big-O notation](http://en.wikipedia.org/wiki/Big_O_notation)的定义，它还指出 f(x) 对于某个常数 C 只需大于 C*g(x) （这只是另一种说法，你不能通过将 g(x) 乘以一个常数因子来帮助 g(x) 赢得比赛 - f(x) 最终总是会获胜）。正式定义也使用绝对值。但我希望我设法让它变得直观。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-27T16:06:30.960

值得考虑的是，许多算法的复杂性都基于多个变量，尤其是在多维问题中。例如，我最近不得不为以下内容编写一个算法。给定一组 n 个点和 m 个多边形，提取位于任何多边形中的所有点。复杂性基于两个已知变量 n 和 m，以及每个多边形中有多少点的未知数。这里的大 O 表示法比 O(f(n)) 甚至 O(f(n) + g(m)) 更复杂。当您处理大量同质项目时，Big O 是很好的选择，但不要期望总是如此。

还值得注意的是，数据的实际迭代次数通常取决于数据。快速排序通常很快，但给它预先排序的数据，它会变慢。我的点和多边形算法很快就结束了，接近 O(n + (m log(m))，基于对数据可能如何组织以及 n 和 m 的相对大小的先验知识。它会下降在不同相对大小的随机组织数据上表现不佳。

最后要考虑的是，算法的速度和它使用的空间量之间通常存在直接的权衡。 [鸽子洞分类](http://en.wikipedia.org/wiki/Pigeonhole_sort)就是一个很好的例子。回到我的点和多边形，假设我所有的多边形都可以简单快速地绘制，我可以在屏幕上填充它们，比如用蓝色，每个固定的时间。因此，如果我在黑屏上绘制我的 m 个多边形，则需要 O(m) 时间。要检查我的任何 n 个点是否在多边形中，我只需检查该点的像素是绿色还是黑色。所以检查是O(n)，总分析是O(m + n)。当然，缺点是，如果我要处理毫米级精度的真实世界坐标，我需要近乎无限的存储空间......呵呵。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-27T16:19:44.627

也可能值得考虑*摊销*时间，而不仅仅是最坏的情况。这意味着，例如，如果您将算法运行*n*次，则平均为*O(1)*，但有时可能会更糟。

一个很好的例子是动态表，它基本上是一个随着您向其中添加元素而扩展的数组。一个简单的实现会为每个添加的元素将数组的大小增加 1，这意味着每次添加新元素时都需要复制所有元素。如果您使用此方法连接一系列数组，这将导致*O(n ² )算法。*另一种方法是在每次需要更多存储空间时将阵列容量翻倍。尽管有时追加是一个*O(n)*操作，但您只需要为每添加*n 个元素复制**O(n)*个元素，因此该操作平均为*O(1)*。这就是*StringBuilder*或****std::vector*已实现。***

 *** * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-10-18T14:27:14.667

## 什么是大 O 符号？

大 O 表示法是一种表示算法所需的与输入数据大小相关的许多步骤之间关系的方法。这被称为算法复杂度。例如，使用冒泡排序对大小为 N 的列表进行排序需要 O(N^2) 步。

## 我是否使用大 O 表示法？

我有时会使用 Big O 表示法向其他程序员传达算法的复杂性。当我考虑使用什么算法时，我一直在使用基础理论（例如大 O 分析技术）。

## 具体例子？

我已经使用复杂性分析的理论来创建不需要内存重新分配的高效堆栈数据结构的算法，并且支持 O(N) 的平均索引时间。我使用大 O 表示法向其他人解释算法。我还使用复杂性分析来了解何时可以进行线性时间排序 O(N)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T12:34:46.580

来自维基百科......

在分析算法以提高效率时，大 O 表示法很有用。例如，完成一个大小为 n 的问题所需的时间（或步骤数）可能被发现为 T(n) = 4n² - 2n + 2。

随着 n 变大，n² 项将占主导地位，因此所有其他项都可以忽略不计——例如，当 n = 500 时，4n² 项是 2n 项的 1000 倍。在大多数情况下，忽略后者对表达式的值的影响可以忽略不计。

明明没用过。。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-25T12:39:58.423

您应该能够评估算法的复杂性。这与它需要多少元素的知识相结合，可以帮助您确定它是否不适合其任务。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T12:34:45.830

它表示算法在最坏的情况下有多少次迭代。

要搜索列表中的项目，您可以遍历列表直到找到该项目。在最坏的情况下，该项目位于最后。

假设列表中有 n 个项目。在最坏的情况下，您需要进行 n 次迭代。在大 O 概念中，它是 O(n)。

它实际上说明了算法的效率。

# sql-server - 如何检查 SQL Server 表中是否存在列？

> ID：133031
> 
> 赞同：2038
> 
> 时间：2008-09-25T12:34:00.093
> 
> 标签：sql-server, sql-server-2008, tsql, sql-server-2012, sql-server-2016

如果它不存在，我需要添加一个特定的列。我有类似以下的内容，但它总是返回 false：

```
IF EXISTS(SELECT *
          FROM   INFORMATION_SCHEMA.COLUMNS
          WHERE  TABLE_NAME = 'myTableName'
                 AND COLUMN_NAME = 'myColumnName') 
```

如何检查 SQL Server 数据库的表中是否存在列？

* * *

## 回答 #1

> 赞同：2245
> 
> 时间：2008-09-25T12:39:21.297

SQL Server 2005 及更高版本：

```
IF EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'columnName'
          AND Object_ID = Object_ID(N'schemaName.tableName'))
BEGIN
    -- Column Exists
END 
```

Martin Smith 的版本更短：

```
IF COL_LENGTH('schemaName.tableName', 'columnName') IS NOT NULL
BEGIN
    -- Column Exists
END 
```

* * *

## 回答 #2

> 赞同：1082
> 
> 时间：2011-03-20T14:47:50.917

更简洁的版本

```
IF COL_LENGTH('table_name','column_name') IS NULL
BEGIN
/* Column does not exist or caller does not have permission to view the object */
END 
```

关于查看元数据的权限这一点适用于所有答案，而不仅仅是这个答案。

请注意，第一个参数表名称[`COL_LENGTH`](http://msdn.microsoft.com/en-us/library/ms188732.aspx)可以根据需要采用一个、两个或三个部分名称格式。

引用不同数据库中的表的示例是

```
COL_LENGTH('AdventureWorks2012.HumanResources.Department','ModifiedDate') 
```

与使用元数据视图相比，此答案的一个区别是元数据函数（例如，`COL_LENGTH`始终只返回有关已提交更改的数据，而不管有效的隔离级别如何）。

* * *

## 回答 #3

> 赞同：165
> 
> 时间：2008-09-25T12:35:54.987

调整以下内容以满足您的特定要求：

```
if not exists (select
                     column_name
               from
                     INFORMATION_SCHEMA.columns
               where
                     table_name = 'MyTable'
                     and column_name = 'MyColumn')
    alter table MyTable add MyColumn int 
```

**编辑以处理对问题的编辑**：这应该可行 - 仔细检查您的代码是否存在愚蠢的错误；例如，您是否在与您的插入应用相同的数据库上查询 INFORMATION_SCHEMA？在任一语句中，您的表/列名称是否有错字？

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2008-09-25T12:35:28.920

试试这个...

```
IF NOT EXISTS(
  SELECT TOP 1 1
  FROM INFORMATION_SCHEMA.COLUMNS
  WHERE 
    [TABLE_NAME] = 'Employees'
    AND [COLUMN_NAME] = 'EmployeeID')
BEGIN
  ALTER TABLE [Employees]
    ADD [EmployeeID] INT NULL
END 
```

* * *

## 回答 #5

> 赞同：64
> 
> 时间：2016-05-01T04:46:00.187

对于在删除列之前检查列存在的人。

从**SQL Server 2016 开始**，您可以使用新的 DIE 语句而不是大`IF`包装器

```
ALTER TABLE Table_name DROP COLUMN IF EXISTS Column_name 
```

* * *

## 回答 #6

> 赞同：49
> 
> 时间：2009-06-26T08:58:19.733

我更喜欢`INFORMATION_SCHEMA.COLUMNS`系统表，因为 Microsoft 不保证在版本之间保留系统表。例如，`dbo.syscolumns`它在 SQL 2008 中仍然有效，但它已被弃用，将来可能随时被删除。

* * *

## 回答 #7

> 赞同：43
> 
> 时间：2008-09-25T12:38:35.777

您可以使用信息模式系统视图来查找有关您感兴趣的表的几乎所有信息：

```
SELECT *
  FROM INFORMATION_SCHEMA.COLUMNS
 WHERE TABLE_NAME = 'yourTableName'
 ORDER BY ORDINAL_POSITION 
```

您还可以使用 Information_schema 视图来查询视图、存储过程和关于数据库的几乎所有内容。

* * *

## 回答 #8

> 赞同：36
> 
> 时间：2008-09-25T12:38:39.487

尝试类似：

```
CREATE FUNCTION ColumnExists(@TableName varchar(100), @ColumnName varchar(100))
RETURNS varchar(1) AS
BEGIN
DECLARE @Result varchar(1);
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.Columns WHERE TABLE_NAME = @TableName AND COLUMN_NAME = @ColumnName)
BEGIN
    SET @Result = 'T'
END
ELSE
BEGIN
    SET @Result = 'F'
END
RETURN @Result;
END
GO

GRANT EXECUTE ON  [ColumnExists] TO [whoever]
GO 
```

然后像这样使用它：

```
IF ColumnExists('xxx', 'yyyy') = 'F'
BEGIN
  ALTER TABLE xxx
  ADD yyyyy varChar(10) NOT NULL
END
GO 
```

它应该适用于 SQL Server 2000 和 SQL Server 2005。不确定 SQL Server 2008，但不明白为什么不这样做。

* * *

## 回答 #9

> 赞同：34
> 
> 时间：2008-09-25T12:37:59.270

首先检查`table`/ `column`( `id`/ `name`) 组合是否存在于`dbo.syscolumns`（包含字段定义的内部 SQL Server 表）中，如果不存在，则发出适当的`ALTER TABLE`查询以添加它。例如：

```
IF NOT EXISTS ( SELECT  *
            FROM    syscolumns
            WHERE   id = OBJECT_ID('Client')
                    AND name = 'Name' ) 
ALTER TABLE Client
ADD Name VARCHAR(64) NULL 
```

* * *

## 回答 #10

> 赞同：28
> 
> 时间：2013-03-20T22:27:38.757

我的一个好朋友和同事向我展示了如何使用`IF`带有 SQL 函数的块`OBJECT_ID`以及`COLUMNPROPERTY`在 SQL SERVER 2005+ 中检查列。您可以使用类似于以下内容的内容：

[你可以自己看看这里](http://sqlfiddle.com/#!3/ababc/3)

```
IF (OBJECT_ID(N'[dbo].[myTable]') IS NOT NULL AND
    COLUMNPROPERTY( OBJECT_ID(N'[dbo].[myTable]'), 'ThisColumnDoesNotExist', 'ColumnId') IS NULL)
BEGIN
    SELECT 'Column does not exist -- You can add TSQL to add the column here'
END 
```

* * *

## 回答 #11

> 赞同：27
> 
> 时间：2011-03-03T15:49:31.893

```
declare @myColumn   as nvarchar(128)
set @myColumn = 'myColumn'
if not exists (
    select  1
    from    information_schema.columns columns 
    where   columns.table_catalog   = 'myDatabase'
        and columns.table_schema    = 'mySchema' 
        and columns.table_name      = 'myTable' 
        and columns.column_name     = @myColumn
    )
begin
    exec('alter table myDatabase.mySchema.myTable add'
    +'    ['+@myColumn+'] bigint       null')
end 
```

* * *

## 回答 #12

> 赞同：25
> 
> 时间：2011-08-02T19:54:19.907

这在 SQL 2000 中对我有用：

```
IF EXISTS 
(
    SELECT * 
    FROM INFORMATION_SCHEMA.COLUMNS 
    WHERE table_name = 'table_name' 
    AND column_name = 'column_name'
)
BEGIN
...
END 
```

* * *

## 回答 #13

> 赞同：22
> 
> 时间：2011-09-30T13:08:56.320

试试这个

```
SELECT COLUMNS.*
FROM   INFORMATION_SCHEMA.COLUMNS COLUMNS,
       INFORMATION_SCHEMA.TABLES TABLES
WHERE  COLUMNS.TABLE_NAME = TABLES.TABLE_NAME
       AND Upper(COLUMNS.COLUMN_NAME) = Upper('column_name') 
```

* * *

## 回答 #14

> 赞同：19
> 
> 时间：2012-05-04T14:14:59.630

我需要类似的 SQL SERVER 2000，正如@Mitch 指出的那样，这仅适用于 2005+。

如果它可以帮助其他人，这最终对我有用：

```
if exists (
    select * 
    from 
        sysobjects, syscolumns 
    where 
        sysobjects.id = syscolumns.id 
        and sysobjects.name = 'table' 
        and syscolumns.name = 'column') 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2013-09-12T12:30:20.953

```
IF NOT EXISTS( SELECT NULL
            FROM INFORMATION_SCHEMA.COLUMNS
           WHERE table_name = 'TableName'
             AND table_schema = 'SchemaName'
             AND column_name = 'ColumnName')  BEGIN

  ALTER TABLE [SchemaName].[TableName] ADD [ColumnName] int(1) NOT NULL default '0';

END; 
```

* * *

## 回答 #16

> 赞同：15
> 
> 时间：2014-05-08T07:15:45.407

```
if exists (
  select * 
  from INFORMATION_SCHEMA.COLUMNS 
  where TABLE_NAME = '<table_name>' 
  and COLUMN_NAME = '<column_name>'
) begin
  print 'Column you have specified exists'
end else begin
  print 'Column does not exist'
end 
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2015-01-07T23:56:25.060

[已接受答案](https://stackoverflow.com/a/133057/538763)的临时表版本：

```
if (exists(select 1 
             from tempdb.sys.columns  
            where Name = 'columnName'
              and Object_ID = object_id('tempdb..#tableName')))
begin
...
end 
```

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2013-05-23T10:25:43.887

```
select distinct object_name(sc.id)
from syscolumns sc,sysobjects so  
where sc.name like '%col_name%' and so.type='U' 
```

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2019-11-01T11:53:11.197

**如果列不存在，请执行以下操作：**

```
BEGIN
    IF (COL_LENGTH('[dbo].[Table]', 'Column ') IS NULL)
    BEGIN
        //Do something
    END
END; 
```

**如果列存在，请执行以下操作：**

```
BEGIN
    IF (COL_LENGTH('[dbo].[Table]', 'Column ') IS NOT NULL)
    BEGIN
        //Do something
    END
END; 
```

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2015-03-26T17:42:36.757

Wheat 的回答很好，但假设您在任何架构或数据库中都没有任何相同的表名/列名对。为了使其在这种情况下安全，请使用此...

```
select *
from Information_Schema.Columns
where Table_Catalog = 'DatabaseName'
  and Table_Schema = 'SchemaName'
  and Table_Name = 'TableName'
  and Column_Name = 'ColumnName' 
```

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2016-02-15T20:45:22.163

有几种方法可以检查列的存在。我强烈建议使用`INFORMATION_SCHEMA.COLUMNS`它是为了与用户交流而创建的。考虑下表：

```
 sys.objects
 sys.columns 
```

甚至还有其他一些可用于检查的访问方法`system catalog.`

另外，无需使用`SELECT *`，只需通过以下方式进行测试`NULL value`

```
IF EXISTS(
           SELECT NULL 
           FROM INFORMATION_SCHEMA.COLUMNS
           WHERE
             TABLE_NAME = 'myTableName'
             AND COLUMN_NAME = 'myColumnName'
         ) 
```

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2017-05-24T07:17:40.077

最简单易懂的解决方案之一是：

```
IF COL_LENGTH('Table_Name','Column_Name') IS NULL
 BEGIN
    -- Column Not Exists, implement your logic
 END 
ELSE
 BEGIN
    -- Column Exists, implement your logic
 END 
```

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2016-11-16T12:21:08.690

这是我用来管理在数据库中添加列的简单脚本：

```
IF NOT EXISTS (
        SELECT *
        FROM sys.Columns
        WHERE Name = N'QbId'
            AND Object_Id = Object_Id(N'Driver')
        )
BEGIN
    ALTER TABLE Driver ADD QbId NVARCHAR(20) NULL
END
ELSE
BEGIN
    PRINT 'QbId is already added on Driver'
END 
```

在此示例中，`Name`是`ColumnName`要添加的，`Object_Id`是`TableName`

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2018-10-30T14:31:52.030

下面的查询可用于检查表中是否存在搜索列。我们也可以根据搜索结果做出决定，如下所示。

```
IF EXISTS (SELECT 'Y' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = <YourTableName> AND COLUMN_NAME = <YourColumnName>)
  BEGIN
    SELECT 'Column Already Exists.'
  END
  ELSE
  BEGIN
    ALTER TABLE <YourTableName> ADD <YourColumnName> <DataType>[Size]
  END 
```

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2019-07-11T23:18:02.283

另一个贡献是以下示例，如果不存在则添加列。

```
 USE [Northwind]
    GO

    IF NOT EXISTS(SELECT * FROM INFORMATION_SCHEMA.COLUMNS 
                    WHERE TABLE_NAME = 'Categories'
                        AND COLUMN_NAME = 'Note')
    BEGIN

    ALTER TABLE Categories ADD Note NVARCHAR(800) NULL

    END
    GO 
```

希望能帮助到你。西蒙妮

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2020-08-11T18:51:33.673

```
//Only checks
IF EXISTS (
SELECT *
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_CATALOG = 'Database_Name'
and TABLE_SCHEMA = 'Schema_Name'
and TABLE_NAME = 'Table_Name'
and COLUMN_NAME = 'Column_Name'
and DATA_TYPE = 'Column_Type') -- Where statement lines can be deleted.

BEGIN
--COLUMN EXISTS IN TABLE
END

ELSE BEGIN
--COLUMN DOES NOT EXISTS IN TABLE
END 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2014-07-10T11:01:43.773

还有一个变种...

```
SELECT 
  Count(*) AS existFlag 
FROM 
  sys.columns 
WHERE 
  [name] = N 'ColumnName' 
  AND [object_id] = OBJECT_ID(N 'TableName') 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-05-10T15:56:44.450

table -->script table as -->new windows - 你有设计脚本。在新窗口中检查并查找列名

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-05-29T13:43:52.593

执行以下查询以检查给定表中是否存在该列：

```
IF(SELECT COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = 'TableName' AND COLUMN_NAME = 'ColumnName') IS NOT NULL
PRINT 'Column Exists in the given table'; 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2019-07-08T10:58:47.380

```
IF EXISTS (
SELECT *
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_CATALOG = 'Database Name'
and TABLE_SCHEMA = 'Schema Name'
and TABLE_NAME = 'Table Name'
and COLUMN_NAME = 'Column Name'
and DATA_TYPE = 'Column Type') -- Where statement lines can be deleted.

BEGIN
--COLUMN EXISTS IN TABLE
END

ELSE BEGIN
--COLUMN DOES NOT EXISTS IN TABLE
END 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2021-11-02T08:21:59.243

您可以一次检查 SQLDB 中的多个列并返回一个字符串作为状态以检查列是否存在

```
IF EXISTS 
        (
          SELECT *
          FROM INFORMATION_SCHEMA.COLUMNS
          WHERE TABLE_NAME = 'Table Name'
          AND(COLUMN_NAME = 'column 1'
          or COLUMN_NAME = 'column 2'
          or COLUMN_NAME = 'column 3'
          or COLUMN_NAME = 'column 4')
        )
        SELECT 'Column exists in table' AS[Status];
        ELSE
        SELECT 'Column does not exist in table' AS[Status]; 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2019-04-03T09:45:20.677

```
IF EXISTS(SELECT 1 FROM sys.columns 
      WHERE Name = N'columnName'
      AND Object_ID = Object_ID(N'schemaName.tableName')) 
```

> 这应该是解决这个问题的相当简单的方法和直接的解决方案。对于类似的场景，我已经多次使用它。它就像一个魅力，毫无疑问。

# winforms - 在 Winforms 中控制具有自动完成功能的标签？

> ID：133049
> 
> 赞同：4
> 
> 时间：2008-09-25T12:36:30.413
> 
> 标签：winforms, controls, autocomplete, tags

我正在寻找一个 WinForm 控件，它可以为多个空格分隔提供自动完成行为 - 正是 ala del.icio.us（或 stackoverflow.com）。

有谁知道如何在 .NET 2.0 WinForm 应用程序中做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T12:43:08.417

ComboBox 可以自动完成，但一次只能完成一个单词。

如果你想让每个单词分别自动完成，你必须自己写。

我已经做了，希望不会太长。它不是 100% 完全符合您的要求，它用于在输入电子邮件地址时在电子邮件客户端中自动完成。

```
/// <summary>
/// Extended TextBox with smart auto-completion
/// </summary>
public class TextBoxAC: TextBox
{
    private List<string> completions = new List<string>();
    private List<string> completionsLow = new List<string>();
    private bool autocompleting = false;
    private bool acDisabled = true;

    private List<string> possibleCompletions = new List<string>();
    private int currentCompletion = 0;

    /// <summary>
    /// Default constructor
    /// </summary>
    public TextBoxAC()
    {
        this.TextChanged += new EventHandler(TextBoxAC_TextChanged);
        this.KeyPress += new KeyPressEventHandler(TextBoxAC_KeyPress);
        this.KeyDown += new KeyEventHandler(TextBoxAC_KeyDown);

        this.TabStop = true;
    }

    /// <summary>
    /// Sets autocompletion data, list of possible strings
    /// </summary>
    /// <param name="words">Completion words</param>
    /// <param name="wordsLow">Completion words in lowerCase</param>
    public void SetAutoCompletion(List<string> words, List<string> wordsLow)
    {
        if (words == null || words.Count < 1) { return; }

        this.completions = words;
        this.completionsLow = wordsLow;

        this.TabStop = false;
    }

    private void TextBoxAC_TextChanged(object sender, EventArgs e)
    {
        if (this.autocompleting || this.acDisabled) { return; }

        string text = this.Text;
        if (text.Length != this.SelectionStart) { return; }

        int pos = this.SelectionStart;
        string userPrefix = text.Substring(0, pos);
        int commaPos = userPrefix.LastIndexOf(",");

        if (commaPos == -1)
        {
            userPrefix = userPrefix.ToLower();
            this.possibleCompletions.Clear();
            int n = 0;
            foreach (string s in this.completionsLow)
            {
                if (s.StartsWith(userPrefix))
                {
                    this.possibleCompletions.Add(this.completions[n]);
                }
                n++;
            }
            if (this.possibleCompletions.Count < 1) { return; }

            this.autocompleting = true;
            this.Text = this.possibleCompletions[0];
            this.autocompleting = false;
            this.SelectionStart = pos;
            this.SelectionLength = this.Text.Length - pos;
        }
        else
        {
            string curUs = userPrefix.Substring(commaPos + 1);

            if (curUs.Trim().Length < 1) { return; }

            string trimmed;
            curUs = this.trimOut(curUs, out trimmed);
            curUs = curUs.ToLower();

            string oldUs = userPrefix.Substring(0, commaPos + 1);

            this.possibleCompletions.Clear();
            int n = 0;
            foreach (string s in this.completionsLow)
            {
                if (s.StartsWith(curUs))
                {
                    this.possibleCompletions.Add(this.completions[n]);
                }
                n++;
            }
            if (this.possibleCompletions.Count < 1) { return; }

            this.autocompleting = true;
            this.Text = oldUs + trimmed + this.possibleCompletions[0];
            this.autocompleting = false;
            this.SelectionStart = pos;
            this.SelectionLength = this.Text.Length - pos + trimmed.Length;
        }
        this.currentCompletion = 0;
    }

    private void TextBoxAC_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.Back || e.KeyCode == Keys.Delete)
        {
            this.acDisabled = true;
        }

        if (e.KeyCode == Keys.Up || e.KeyCode == Keys.Down)
        {
            if ((this.acDisabled) || (this.possibleCompletions.Count < 1))
            {
                return;
            }

            e.Handled = true;
            if (this.possibleCompletions.Count < 2) { return; }

            switch (e.KeyCode)
            {
                case Keys.Up:
                    this.currentCompletion--;
                    if (this.currentCompletion < 0)
                    {
                        this.currentCompletion = this.possibleCompletions.Count - 1;
                    }
                    break;
                case Keys.Down:
                    this.currentCompletion++;

                    if (this.currentCompletion >= this.possibleCompletions.Count)
                    {
                        this.currentCompletion = 0;
                    }
                    break;
            }

            int pos = this.SelectionStart;
            string userPrefix = this.Text.Substring(0, pos);
            int commaPos = userPrefix.LastIndexOf(",");

            if (commaPos == -1)
            {
                pos--;
                userPrefix = this.Text.Substring(0, pos);

                this.autocompleting = true;
                this.Text = userPrefix + this.possibleCompletions[this.currentCompletion].Substring(userPrefix.Length);
                this.autocompleting = false;
                this.SelectionStart = pos + 1;
                this.SelectionLength = this.Text.Length - pos;
            }
            else
            {
                string curUs = userPrefix.Substring(commaPos + 1);

                if (curUs.Trim().Length < 1) { return; }

                string trimmed;
                curUs = this.trimOut(curUs, out trimmed);
                curUs = curUs.ToLower();

                string oldUs = userPrefix.Substring(0, commaPos + 1);

                this.autocompleting = true;
                this.Text = oldUs + trimmed + this.possibleCompletions[this.currentCompletion];
                this.autocompleting = false;
                this.SelectionStart = pos;
                this.SelectionLength = this.Text.Length - pos + trimmed.Length;
            }
        }
    }

    private void TextBoxAC_KeyPress(object sender, KeyPressEventArgs e)
    {
        if (!Char.IsControl(e.KeyChar)) { this.acDisabled = false; }
    }

    private string trimOut(string toTrim, out string trim)
    {
        string ret = toTrim.TrimStart();

        int pos = toTrim.IndexOf(ret);
        trim = toTrim.Substring(0, pos);

        return ret;
    }
} 
```

# css - 可见性：隐藏和显示：无有什么区别？

> ID：133051
> 
> 赞同：1307
> 
> 时间：2008-09-25T12:37:47.617
> 
> 标签：css, visibility

CSS 规则`visibility:hidden`和`display:none`两者都导致元素不可见。这些是同义词吗？

* * *

## 回答 #1

> 赞同：1625
> 
> 时间：2008-09-25T12:40:05.647

`display:none`意味着有问题的标签根本不会出现在页面上（尽管您仍然可以通过 dom 与它进行交互）。其他标签之间不会有空间分配给它。

`visibility:hidden`表示与 不同`display:none`，标签不可见，但在页面上为其分配了空间。标签被渲染，它只是在页面上看不到。

例如：

```
test | <span style="[style-tag-value]">Appropriate style in this tag</span> | test 
```

替换`[style-tag-value]`为`display:none`结果：

```
test |   | test 
```

替换`[style-tag-value]`为`visibility:hidden`结果：

```
test |                        | test 
```

* * *

## 回答 #2

> 赞同：271
> 
> 时间：2008-09-25T13:50:55.757

**它们不是同义词。**

`display:none`从页面的正常流程中移除元素，允许其他元素填充。

`visibility:hidden`将元素留在页面的正常流程中，从而仍然占用空间。

想象一下，您在游乐园排队乘车，排队的人变得如此吵闹，以至于安全人员将他们从队伍中拉了出来。然后，排队的每个人都将向前移动一个位置以填补现在的空位。这就像`display:none`.

将此与类似的情况进行对比，但您面前的某个人穿上了隐形斗篷。在查看线路时，看起来好像有一个空白空间，但人们无法真正填满那个看起来空白的空间，因为有人仍然在那里。这就像`visibility:hidden`.

* * *

## 回答 #3

> 赞同：123
> 
> 时间：2009-10-02T21:27:30.370

值得补充的一点是，虽然没有被问到，但还有第三个选项可以使对象完全透明。考虑：

```
1st <a href="http://example.com" style="display: none;">unseen</a> link.<br />
2nd <a href="http://example.com" style="visibility: hidden;">unseen</a> link.<br />
3rd <a href="http://example.com" style="opacity: 0;">unseen</a> link.
```

（请务必单击上方的“运行代码片段”按钮以查看结果。）

1 和 2 的区别已经指出（即 2 仍然占用空间）。但是，2 和 3 有区别：在情况 3 中，鼠标悬停在链接上时仍然会切换到手，用户仍然可以点击链接，并且仍然会在链接上触发 Javascript 事件。这通常*不是*您想要的行为（但有时可能是？）。

另一个区别是，如果您选择文本，然后复制/粘贴为纯文本，您将获得以下信息：

```
1st link.
2nd  link.
3rd unseen link. 
```

在案例 3 中，文本确实被复制了。也许这对于某种类型的水印很有用，或者如果您想隐藏如果用户不小心复制/粘贴您的内容时会出现的版权声明？

* * *

## 回答 #4

> 赞同：95
> 
> 时间：2008-09-25T12:39:43.200

`display:none`从布局流中移除元素。

`visibility:hidden`隐藏它但留下空间。

* * *

## 回答 #5

> 赞同：78
> 
> 时间：2015-01-14T09:39:16.387

子节点有很大的不同。例如：如果您有一个父 div 和一个嵌套的子 div。所以如果你这样写：

```
<div id="parent" style="display:none;">
    <div id="child" style="display:block;"></div>
</div> 
```

在这种情况下，任何 div 都不可见。但是如果你这样写：

```
<div id="parent" style="visibility:hidden;">
    <div id="child" style="visibility:visible;"></div>
</div> 
```

然后子 div 将可见，而父 div 将不显示。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2008-09-25T12:41:15.083

它们不是同义词 -`display: none`从页面流中删除元素，页面的其余部分就像它不存在一样流动。

`visibility: hidden`隐藏元素而不是页面流，在页面上为它留出空间。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2008-09-25T12:40:46.223

`display: none`完全从页面中删除元素，并且页面的构建就像该元素根本不存在一样。

`Visibility: hidden`即使您再也看不到它，也会在文档流中留下空间。

这可能会或可能不会有很大的不同，具体取决于您在做什么。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-09-25T12:41:24.410

随着`visibility:hidden`对象仍然占据页面上的垂直高度。随着`display:none`它被完全删除。如果您在图像下方有文本并且您这样做`display:none`了，则该文本将向上移动以填充图像所在的空间。如果你做可见性：隐藏文本将保留在同一位置。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-09-25T12:41:45.317

`display:none`将隐藏元素并折叠占用的空间，而`visibility:hidden`将隐藏元素并保留元素空间。display:none 还会影响旧版本 IE 和 Safari 中 javascript 提供的一些属性。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2013-05-29T13:47:24.430

`visibility:hidden`保留空间；`display:none`没有。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-04-01T17:42:43.563

除了所有其他答案之外，IE8 还有一个重要区别：如果您使用`display:none`并尝试获取元素的宽度或高度，IE8 将返回 0（而其他浏览器将返回实际大小）。IE8 仅返回正确的宽度或高度`visibility:hidden`。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2018-01-29T06:08:33.540

```
display: none; 
```

它将在页面上不可用，并且不占用任何空间。

```
visibility: hidden; 
```

它隐藏了一个元素，但仍会占用与以前相同的空间。该元素将被隐藏，但仍然会影响布局。

`visibility: hidden`保留空间，`display: none`而不保留空间。

无显示示例：[https ://www.w3schools.com/css/tryit.asp?filename=trycss_display_none](https://www.w3schools.com/css/tryit.asp?filename=trycss_display_none)

可见性隐藏示例：[https ://www.w3schools.com/cssref/tryit.asp?filename=trycss_visibility](https://www.w3schools.com/cssref/tryit.asp?filename=trycss_visibility)

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-05-29T13:49:42.203

`visibility:hidden`将元素保留在页面中并占用该空间，但不会向用户显示。

`display:none`将在页面中不可用且不占用任何空间。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2020-12-04T15:15:59.117

**显示：无**

它将从页面的正常流程中删除元素，允许其他元素填充。

一个元素根本不会出现在页面上，但我们仍然可以通过 DOM 与它进行交互。在其他元素之间不会为其分配空间。

**可见性：隐藏**

它会将元素留在页面的正常流程中，从而仍然占用空间。

一个元素是不可见的，并且在页面上为它分配了元素的空间。

**其他一些隐藏元素的方法**

使用**z-index**

```
#element {
   z-index: -11111;
} 
```

**将元素移出页面**

```
#element {
   position: absolute; 
   top: -9999em;
   left: -9999em;
} 
```

**关于可见性的有趣信息：隐藏和显示：无属性**

`visibility: hidden`并且`display: none`将具有同样的性能，因为它们都重新触发布局、绘制和合成。但是，`opacity: 0`功能是否等同于`visibility: hidden`并且不会重新触发布局步骤。

CSS-transition 属性也是我们需要注意的重要事项。因为从切换`visibility: hidden`到`visibility: visible`允许使用 CSS 转换，而从切换`display: none`到`display: block`不允许。`visibility: hidden`具有不捕获 JavaScript 事件的额外好处，而`opacity: 0`捕获事件

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2011-12-27T05:25:48.537

如果 visibility 属性设置为`"hidden"`，浏览器仍然会在页面上为内容占用空间，即使它是不可见的。
但是当我们将对象设置为 时`"display:none"`，浏览器不会在页面上为其内容分配空间。

例子：

```
<div style="display:none">
Content not display on screen and even space not taken.
</div>

<div style="visibility:hidden">
Content not display on screen but it will take space on screen.
</div> 
```

[查看详情](http://www.shubelal.com/devquery.html)

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2020-03-04T15:48:20.290

这里有很多详细的答案，但我认为我应该添加它来解决可访问性问题，因为这会产生影响。

`display: none;`并且`visibility: hidden;`可能无法被所有屏幕阅读器软件读取。请记住视障用户将体验到什么。

该问题还询问同义词。`text-indent: -9999px;`是另一个大致相等的。与它的重要区别`text-indent`在于它通常会被屏幕阅读器阅读。这可能会带来一些糟糕的体验，因为用户仍然可以通过标签访问链接。

对于可访问性，我今天看到使用的是一种样式组合，用于隐藏元素同时对屏幕阅读器可见。

```
{
  clip: rect(1px, 1px, 1px, 1px);
  clip-path: inset(50%);
  height: 1px;
  width: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
} 
```

一个很好的做法是创建一个指向内容主体锚点的“跳转到内容”链接。视障用户可能不想在每个页面上都听完整的导航树。使链接在视觉上隐藏。用户只需点击标签即可访问该链接。

有关可访问性和隐藏内容的更多信息，请参阅：

*   [https://webaim.org/techniques/css/invisiblecontent/](https://webaim.org/techniques/css/invisiblecontent/)
*   [https://webaim.org/techniques/skipnav/](https://webaim.org/techniques/skipnav/)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2017-10-01T00:18:13.540

另一个区别是它`visibility:hidden`适用于非常非常旧的浏览器，并且`display:none`不：

[https://www.w3schools.com/cssref/pr_class_visibility.asp](https://www.w3schools.com/cssref/pr_class_visibility.asp)

[https://www.w3schools.com/cssref/pr_class_display.asp](https://www.w3schools.com/cssref/pr_class_display.asp)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2019-06-18T20:25:02.877

差异超出了样式，并反映在使用 JavaScript 操作时元素的行为方式。

效果和副作用`display: none`：

*   目标元素从文档流中取出（不影响其他元素的布局）；
*   所有后代都受到影响（也不显示，也不能“跳出”这个继承）；
*   无法对目标元素或其后代进行测量——它们根本不会被渲染，因此它们的`clientWidth`, `clientHeight`, `offsetWidth`, `offsetHeight`, `scrollWidth`, `scrollHeight`, `getBoundingClientRect()`, `getComputedStyle()`, 都返回`0`s。

的影响和副作用`visibility: hidden`：

*   目标元素隐藏在视图之外，但没有被移出流程并影响布局，占用其正常空间；
*   `innerText`（但不是`innerHTML`）目标元素和后代返回空字符串。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-02-04T07:10:41.287

`display:none;`既不会显示元素，也不会在页面上为元素分配空间，而`visibility:hidden;`不会在页面上显示元素，但会在页面上分配空间。在这两种情况下，我们都可以访问 DOM 中的元素。为了更好地理解它，请查看以下代码： [display:none vs visibility:hidden](https://jsfiddle.net/pritam1605/vp7uuukt/2/)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-09-18T10:50:14.223

总结所有其他答案：

| 能见度 | 展示 |
| --- | --- |
| 具有可见性的元素：隐藏，出于所有实际目的（鼠标指针、键盘焦点、屏幕阅读器）而隐藏，但仍占用渲染标记中的空间 | 具有 display:none 的元素，出于所有实际目的（鼠标指针、键盘焦点、屏幕阅读器）而隐藏，并且不占用渲染标记中的空间 |
| css 过渡可应用于可见性更改 | css 过渡不能应用于显示更改 |
| 您可以使父可见性：隐藏但具有可见性的子级：可见仍会显示 | 当 parent 为 display:none 时，孩子不能覆盖并使自己可见 |
| DOM 树的一部分（因此您仍然可以使用 DOM 查询来定位它） | DOM 树的一部分（因此您仍然可以使用 DOM 查询来定位它） |
| 渲染树的一部分 | 不是渲染树的一部分 |
| 父元素或子元素中的任何重排/布局也可能会触发这些元素中的重排，因为它们是渲染树的一部分。 | 父元素中的任何回流/布局都不会影响这些元素，因为它们不是渲染树的一部分 |
| 在可见性：隐藏和可见之间切换，可能不会触发回流/布局。（根据此评论，它确实：[可见性：隐藏和显示：无有什么区别？](https://stackoverflow.com/questions/133051/what-is-the-difference-between-visibilityhidden-and-displaynone#comment47789527_133064)可能也根据此[https://developers.google.com/speed/docs/insights/browser-reflow](https://developers.google.com/speed/docs/insights/browser-reflow)） | 在 display:none 和 display: 之间切换会导致布局/reflow，因为这个元素现在将成为渲染树的一部分 |
| 您可以通过 DOM 方法测量元素 | 您不能使用 DOM 方法测量元素或其后代 |
| 如果页面上有大量元素使用可见性：无，浏览器可能会在渲染时挂起，因为所有这些元素都需要布局，即使它们没有显示 | 如果您有大量使用 display:none 的元素，它们不会影响渲染，因为它们不是渲染树的一部分 |
|  |  |

### 资源：

*   [https://developers.google.com/speed/docs/insights/browser-reflow](https://developers.google.com/speed/docs/insights/browser-reflow)
*   [http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/](http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/)
*   [可见性之间的性能差异：隐藏和显示：无](https://stackoverflow.com/questions/11757016/performance-differences-between-visibilityhidden-and-displaynone)

### 其他信息：

*   也有一些浏览器支持特性，但它们似乎适用于非常旧的浏览器，并且在其他答案中可用，所以我没有在这里讨论它们。
*   还有其他一些隐藏元素的替代方法，例如不透明度或屏幕外的绝对定位。所有这些都在某些或其他答案中被触及，并且有一些缺点。
*   根据此评论（[visibility:hidden 和 display:none 之间的性能差异](https://stackoverflow.com/questions/11757016/performance-differences-between-visibilityhidden-and-displaynone#comment47693909_11757125)），如果您有很多元素使用 display:none 并且您更改为 display: （其他），它将导致单次回流，而如果您有多重可见性：隐藏元素并将它们变为可见，它将导致每个元素的回流。（我真的不明白这个）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-10-11T23:09:34.553

如本堆栈其他地方所述，两者不是同义词。`visibility:hidden`将在页面上留下空间，而`display:none`将完全隐藏元素。我认为谈论这如何影响给定元素的子元素很重要。如果您要使用，`visibility:hidden`那么您可以使用正确的样式显示该元素的子元素。但是`display:none`不管你用`display: block | flex | inline | grid | inline-block`不用都把孩子藏起来。

# asp.net-mvc - 我应该如何将 Web UI 绑定到 XML 属性？

> ID：133077
> 
> 赞同：0
> 
> 时间：2008-09-25T12:41:43.990
> 
> 标签：asp.net-mvc, xml, data-binding

我想将我的 UI 与网页上的一组 XElement 及其属性绑定。假设，这可能适用于表示 XML 树的任何对象。我希望可能有更好的方法来做到这一点。

我应该使用 XPath 查询来获取集合的元素和每个（在本例中）XElement 的属性值吗？是否有一种对象旨在简化针对 XML 的数据绑定？

```
<% foreach(var x in element.Descendants()) 
    {%>
<%= DateTime.Parse(x.Attribute["Time"]).ToShortDate() %>
<% } %>
<%-- excuse me, I just vomited a little in my mouth --%> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-22T12:01:03.717

我通常使用带有 [XmlRoot]、[XmlElement]、[XmlAttribute] 的“占位符”类，并且我将 xml 传递给反序列化器，它为我提供了占位符类型的对象。完成此操作后，唯一要做的就是对强类型对象进行一些基本的 DataBinding。

这是一个“启用 Xml”的示例类：

```
[XmlRoot(ElementName = "Car", IsNullable = false, Namespace="")]
public class Car
{
    [XmlAttribute(AttributeName = "Model")]
    public string Model { get; set; }
    [XmlAttribute(AttributeName = "Make")]
    public string Make { get; set ;}
} 
```

以下是如何从文件中正确反序列化它：

```
public Car ReadXml(string fileLocation)
{
    XmlSerializer carXml = new XmlSerializer(typeof(Car));

    FileStream fs = File.OpenRead(fileLocation);
    Car result = imageConfig.Deserialize(fs) as Car;

    return result;
} 
```

当然，您可以将 FileStream 替换为 MemoryStream 以直接从内存中读取 Xml。

一旦在 Html 中，它将转换为如下内容：

```
<!-- It is assumed that MyCar is a public property of the current page. -->
<div>
   Car Model : <%= MyCar.Model %> <br/>
   Car Make : <%= MyCar.Make %>
</div> 
```

# sql - SQL Server 中从日期+时间获取日期的最有效方法？

> ID：133081
> 
> 赞同：76
> 
> 时间：2008-09-25T12:42:00.680
> 
> 标签：sql, sql-server, tsql

在 MS SQL 2000 和 2005 中，给定一个日期时间，例如“2008-09-25 12:34:56”，获取仅包含“2008-09-25”的日期时间的最有效方法是什么？

[在这里](https://stackoverflow.com/questions/2775/whats-the-best-way-to-remove-the-time-portion-of-a-datetime-value-sql-server)复制。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-09-29T21:18:09.150

我必须承认我以前没有见过马特展示的地板浮动转换。我不得不对此进行测试。

我测试了一个纯选择（它将返回日期和时间，这不是我们想要的），这里的统治解决方案（地板浮动），一个常见的“天真”这里提到的（stringconvert）和这里提到的我是使用（因为我认为这是最快的）。

我在测试服务器 MS SQL Server 2005 上测试了查询，该服务器在 Win 2003 SP2 服务器上运行，Xeon 3GHz CPU 在最大内存（32 位，大约 3.5 Gb）上运行。这是我所在的夜晚，所以机器几乎空载空转。我已经掌握了一切。

这是我的测试运行的日志，它从包含变化到毫秒级别的时间戳的大表中选择。这个特定的数据集包括超过 2.5 年的日期。该表本身有超过 1.3 亿行，所以这就是我限制为前百万的原因。

```
SELECT TOP 1000000 CRETS FROM tblMeasureLogv2 
SELECT TOP 1000000 CAST(FLOOR(CAST(CRETS AS FLOAT)) AS DATETIME) FROM tblMeasureLogv2
SELECT TOP 1000000 CONVERT(DATETIME, CONVERT(VARCHAR(10), CRETS, 120) , 120) FROM tblMeasureLogv2 
SELECT TOP 1000000 DATEADD(DAY, DATEDIFF(DAY, 0, CRETS), 0) FROM tblMeasureLogv2 
```

> SQL Server 解析和编译时间：CPU 时间 = 0 毫秒，运行时间 = 1 毫秒。
> 
> （1000000 行受影响）表 'tblMeasureLogv2'。扫描计数 1，逻辑读取 4752，物理读取 0，预读读取 0，lob 逻辑读取 0，lob 物理读取 0，lob 预读读取 0。
> 
> SQL Server 执行时间：CPU 时间 = 422 毫秒，经过时间 = 33803 毫秒。
> 
> （1000000 行受影响）表 'tblMeasureLogv2'。扫描计数 1，逻辑读取 4752，物理读取 0，预读读取 0，lob 逻辑读取 0，lob 物理读取 0，lob 预读读取 0。
> 
> SQL Server 执行时间：CPU 时间 = 625 毫秒，经过时间 = 33545 毫秒。
> 
> （1000000 行受影响）表 'tblMeasureLogv2'。扫描计数 1，逻辑读取 4752，物理读取 0，预读读取 0，lob 逻辑读取 0，lob 物理读取 0，lob 预读读取 0。
> 
> SQL Server 执行时间：CPU 时间 = 1953 毫秒，经过时间 = 33843 毫秒。
> 
> （1000000 行受影响）表 'tblMeasureLogv2'。扫描计数 1，逻辑读取 4752，物理读取 0，预读读取 0，lob 逻辑读取 0，lob 物理读取 0，lob 预读读取 0。
> 
> SQL Server 执行时间：CPU 时间 = 531 毫秒，经过时间 = 33440 毫秒。SQL Server 解析和编译时间：CPU 时间 = 0 毫秒，运行时间 = 1 毫秒。
> 
> SQL Server 执行时间：CPU 时间 = 0 毫秒，经过时间 = 1 毫秒。

我们在这里看到了什么？

让我们关注 CPU 时间（我们正在查看转换），我们可以看到我们有以下数字：

```
Pure-Select:  422
Floor-cast:   625
String-conv: 1953
DateAdd:      531 
```

在我看来，DateAdd（至少在这种特殊情况下）比 floor-cast 方法稍快。

在你去那里之前，我多次运行这个测试，查询的顺序改变了，结果相同。

这是我的服务器上奇怪的东西，还是什么？

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-25T12:45:46.553

```
Select DateAdd(Day, DateDiff(Day, 0, GetDate()), 0) 
```

DateDiff(Day, 0, GetDate()) 与 DateDiff(Day, '1900-01-01', GetDate()) 相同

由于 DateDiff 返回一个整数，您将获得自 1900 年 1 月 1 日以来经过的天数。然后将该整数天数添加到 1900 年 1 月 1 日。最终效果是删除了时间分量。

我还应该提到，此方法适用于任何日期/时间部分（如年、季度、月、日、小时、分钟和秒）。

```
Select  DateAdd(Year, DateDiff(Year, 0, GetDate()), 0)
Select  DateAdd(Quarter, DateDiff(Quarter, 0, GetDate()), 0)
Select  DateAdd(Month, DateDiff(Month, 0, GetDate()), 0)
Select  DateAdd(Day, DateDiff(Day, 0, GetDate()), 0)
Select  DateAdd(Hour, DateDiff(Hour, 0, GetDate()), 0)
Select  DateAdd(Second, DateDiff(Second, '20000101', GetDate()), '20000101') 
```

最后一个，几秒钟，需要特殊处理。如果您使用 1900 年 1 月 1 日，您将收到错误消息。

两个日期时间列的差异导致运行时溢出。

您可以通过使用不同的参考日期（如 2000 年 1 月 1 日）来规避此错误。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-25T12:46:08.877

```
select cast(floor(cast(@datetime as float)) as datetime) 
```

之所以有效，是因为将日期时间转换为浮点数给出了自 1900 年 1 月 1 日以来的天数（包括一天的小数）。地板它会删除小数天数并留下整天数，然后可以将其转换回日期时间。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-03-25T17:10:45.387

在 SQL Server 2012 中使用

```
select cast(getdate() as date) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T15:51:10.633

```
select cast(getdate()as varchar(11))as datetime 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T12:50:50.630

要获取 YYYY-MM-DD，请使用：

```
select convert(varchar(10), getdate(), 120) 
```

**编辑：**哎呀，他想要一个 DateTime 而不是字符串。相当于 Oracle 中的 TRUNC()。您可以将我发布的内容转换回 DateTime：

```
select convert(datetime, convert(varchar(10), getdate(), 120) , 120) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T15:59:12.643

CONVERT、FLOOR 和 DATEDIFF 将执行相同的操作。

[如何仅从 SQL Server 日期时间数据类型返回日期部分](https://stackoverflow.com/questions/113045/how-to-return-the-date-part-only-from-a-sql-server-datetime-datatype#113733)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T23:25:39.307

下面的链接中描述了三种方法。我没有对它们进行性能测试以确定哪个最快。

[http://www.blackwasp.co.uk/SQLDateFromDateTime.aspx](http://www.blackwasp.co.uk/SQLDateFromDateTime.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-13T05:23:58.160

`CAST(FLOOR(CAST(yourdate AS DECIMAL(12, 5))) AS DATETIME)`迄今为止表现最好。[在 sql server 中获取没有时间的日期](http://www.andrewdenhertog.com/sql-server/get-date-without-time-in-sql-server)时，您可以看到证明和测试

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-25T12:53:28.673

```
CONVERT(VARCHAR(10), GETDATE(), 120) AS [YYYY-MM-DD] 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-12-07T11:49:20.367

怎么样`SELECT CAST(CASt(GETDATE() AS int) AS DATETIME)`？？

# web-services - 从 ASP 调用 Web 服务的最佳方法是什么？

> ID：133087
> 
> 赞同：1
> 
> 时间：2008-09-25T12:43:14.780
> 
> 标签：web-services, asp-classic

注意：不是 ASP.NET。

我已经阅读了各种方法，包括使用 SOAPClient（这是标准 Windows 2003 安装的一部分吗？）、ServerXMLHTTP，以及从头开始构建 XML 并手动解析结果。

有没有人这样做过？你用了什么，你会推荐它吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T13:36:10.303

好吧，由于 Web 服务通过标准 HTTP 处理 XML，因此您可以使用 Microsoft 最新的 XML 解析器自行开发。您应该确保您拥有最新版本的 MSXML 和 XML 核心服务（请参阅[Microsoft 下载](http://msdn.microsoft.com/en-us/aa570309.aspx)）。

```
<% 
    SoapUrl = "http://www.yourdomain.com/yourwebservice.asmx" 
    set xmlhttp = CreateObject("MSXML2.ServerXMLHTTP") 
    xmlhttp.open "GET", SoapUrl, false 
    xmlhttp.send()
    Response.write xmlhttp.responseText 
    set xmlhttp = nothing 
%> 
```

[这是ASPFree.com](http://www.aspfree.com/c/a/ASP/Consuming-a-WSDL-Webservice-from-ASP/)上的一个很好的教程

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T12:46:21.107

我们在这里使用 MS Soap Toolkit 第 3 版。似乎工作正常（我只写了服务）。

# xml - 如何使用 XPath 2.0 识别数字序列中的重复值？

> ID：133092
> 
> 赞同：13
> 
> 时间：2008-09-25T12:44:28.570
> 
> 标签：xml, xpath, xpath-2.0

我有一个 XPath 表达式，它为我提供了一系列值，如下所示：

`1 2 2 3 4 5 5 6 7`

`1 2 3 4 5 6 7`这很容易使用.转换为一系列唯一值`distinct-values()`。但是，我要提取的是重复值列表 = `2 5`。我想不出一个简单的方法来做到这一点。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-13T16:11:30.457

**使用这个简单的 XPath 2.0 表达式**：

```
$vSeq[index-of($vSeq,.)[2]] 
```

where`$vSeq`是我们要在其中找到重复项的值序列。

**有关此“工作原理”的说明，请参见**：

**[http://dnovatchev.wordpress.com/2008/11/16/xpath-2-0-gems-find-all-duplicate-values-in-a-sequence-part-2/](http://dnovatchev.wordpress.com/2008/11/16/xpath-2-0-gems-find-all-duplicate-values-in-a-sequence-part-2/)**

TLDR；这张图片可以是一个视觉解释。

如果顺序是：

```
$vSeq  =  1,   2,   3,   2,   4,   5,   6,   7,   5,   7,   5 
```

然后评估上面的 XPath 表达式会产生：`2, 5, 7`

* * *

[![在此处输入图像描述](https://i.stack.imgur.com/BY7pP.jpg)](https://i.stack.imgur.com/BY7pP.jpg)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T18:14:46.107

关于什么：

```
distinct-values(
  for $item in $seq
  return if (count($seq[. eq $item]) > 1)
         then $item
         else ()) 
```

这将遍历序列中的项目，如果序列中等于该项目的项目数大于一，则返回该项目。然后，您必须使用`distinct-values()`从该列表中删除重复项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T20:50:01.067

xslt呢？它适用于您的要求吗？

```
 <xsl:for-each select="/r/a">
        <xsl:variable name="cur" select="." />
        <xsl:if test="count(./preceding-sibling::a[. = $cur]) > 0 and count(./following-sibling::a[. = $cur]) = 0">
            <xsl:value-of select="." />
        </xsl:if>
    </xsl:for-each> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T13:23:56.323

计算原始集和不同值集之间的差异。这是多次出现的一组数字。请注意，如果此结果集中的数字在原始序列中出现两次以上，则它们不一定是不同的，因此如果需要，请再次转换为一组不同的值。

# apache-flex - 将 Flex 应用程序国际化的最佳实践？

> ID：133094
> 
> 赞同：5
> 
> 时间：2008-09-25T12:44:35.823
> 
> 标签：apache-flex, actionscript, internationalization

我正在研究国际化我正在开发的 Flex 应用程序，我很好奇是否有任何最佳实践或建议。

在谷歌上搜索这些信息会导致一些小文章和博客文章，每一篇都以不同的方式进行，而且优缺点并不完全清楚。

编辑为缩小范围：

*   只需要支持两种语言（en_CA 和 fr_CA）
*   需要能够在运行时切换

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T13:53:02.133

当然，在谷歌搜索更多之后，我发现了一篇关于[运行时本地化](http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:_Runtime_Localization)的文章。

并遵循以下步骤：

将以下内容添加到编译器参数以指定支持的语言环境及其路径：（在 Flex Builder 中，选择项目并转到属性 -> Flex 编译器 -> 附加编译器参数）

`-locale=en_CA,fr_CA -source-path=locale/{locale}`

创建以下文件：

```
src/locale/en_CA/resources.properties
src/locale/fr_CA/resources.properties 
```

然后编译器抱怨：`unable to open 'C:\Program Files\Adobe\Flex Builder 3\sdks\3.1.0\frameworks\locale\en_CA'`

这看起来与错误[SDK-12507有关](http://bugs.adobe.com/jira/browse/SDK-12507)

**解决方法：**
在`sdks\3.1.0\bin`目录中，执行以下命令：

```
copylocale en_US en_CA  
copylocale en_US fr_CA 
```

这将在 Flex Builder 安装中创建语言环境目录，并在其中构建一些所需的资源。

然后在您的`.mxml`文件中，引用资源包：

```
<mx:Metadata>
    [ResourceBundle("resources")]
</mx:Metadata> 
```

并将字符串国际化：

```
<mx:TitleWindow title="Window Title"> 
```

变成：

```
<mx:TitleWindow 
    title="{resourceManager.getString('resources', 'windowTitle')}"> 
```

和

```
var name:String = "Name"; 
```

变成：

```
var name:String = resourceManager.getString("resources", "name"); 
```

在你的`src/locale/en_CA/resources.properties`文件中：

```
windowTitle=Window Title
name=Name 
```

# asp.net - asp.net 中的基本表单身份验证有多安全？

> ID：133106
> 
> 赞同：20
> 
> 时间：2008-09-25T12:46:39.470
> 
> 标签：asp.net, forms-authentication

假设您有一个只有 2 个页面的简单站点：login.aspx 和 secret.aspx。您的站点只使用 ASP.net 表单身份验证和 login.aspx 上的 ASP.net 登录服务器控件来保护您的站点。详细情况如下：

*   该站点配置为使用 SqlMembershipProvider
*   该网站拒绝所有匿名用户
*   Cookie 已禁用

显然，关于安全性需要考虑很多事情，但我对 .net 框架附带的零代码开箱即用体验更感兴趣。

如果为了这个问题，唯一的攻击点是 login.aspx 中的用户名/密码文本框，那么黑客是否可以注入允许他们访问我们的 secret.aspx 页面的代码？

Microsoft 提供的零代码开箱即用体验的安全性如何？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-25T12:53:43.680

您仍然有一些未考虑的变量：

*   成员资格提供程序使用的数据存储（在本例中为 Sql Server 数据库）的安全性。
*   托管在同一 IIS 中的其他站点的安全性
*   托管站点所涉及的机器的一般网络安全性，或者在托管站点的同一网络上
*   托管站点的机器的物理安全
*   您是否使用适当的措施来加密身份验证流量？(HTTPS/SSL)

并非所有这些问题都是特定于 MS 的，但它们值得一提，因为如果不加以处理，它们中的任何一个都可以轻松超过您所询问的问题。但是，出于您的问题的目的，我假设它们没有任何问题。

在这种情况下，我很确定表单身份验证会完成它应该做的事情。我认为目前没有任何活跃的漏洞利用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T12:51:36.697

据我所知，密码将作为纯文本（但已编码）发送。所以最重要的是在登录屏幕上使用 HTTPS 协议。

其他设置对我来说似乎是安全的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T12:57:18.367

使用 .NET 基本表单身份验证所使用的 HTTP 基本身份验证，为了查看 secret.aspx 页面，浏览器必须发送用户名和密码的 Base64 编码串联。

除非您使用 SSL，否则任何有权扫描服务器和浏览器之间的网络的人都可以读取此信息。他们可以解码用户名和密码。他们以后可以重放用户名和密码以访问 secret.aspx 页面。

也就是说，除非您使用 SSL，否则有人还可以使用 secret.aspx 扫描其他人的整个会话，因此实际上他们也可以访问页面的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T13:08:27.263

好吧，试着看看幕后：

> **密码保护**
> 
> 在数据库中存储用户名、密码和其他身份验证信息的应用程序绝不应以明文形式存储密码，以免数据库被盗或被破坏。为此，SqlMembershipProvider 支持密码和密码答案的三种存储格式（“编码”）。提供者的 PasswordFormat 属性（从 passwordFormat 配置属性初始化）确定使用哪种格式：
> 
> *   MembershipPasswordFormat.Clear，以明文形式存储密码和密码答案。
> *   MembershipPasswordFormat.Hashed（默认值），它存储从密码和密码答案生成的加盐哈希。salt 是由 .NET Framework 的 RNGCryptoServiceProvider 类生成的随机 128 位值。每个密码/密码答案对都使用这个唯一值加盐，加盐存储在 aspnet_Membership 表的 PasswordSalt 字段中。密码和盐的散列结果存储在密码字段中。同样，密码答案和盐的散列结果存储在 PasswordAnswer 字段中。
> *   MembershipPasswordFormat.Encrypted，存储加密的密码和密码答案。SqlMembershipProvider 使用配置部分的decryptionKey 属性中指定的对称加密/解密密钥和配置部分的decryption 属性中指定的加密算法对密码和密码答案进行加密。如果要求 SqlMembershipProvider 对密码和密码答案进行加密，并且如果将 decryptionKey 设置为 Autogenerate，则会引发异常。这可以防止包含加密密码和密码答案的成员数据库在移动到另一个服务器或另一个应用程序时变得无效。

因此，您的安全强度（开箱即用）将取决于您使用的密码保护格式策略：

*   如果您使用明文，显然更容易侵入您的系统。
*   另一方面，使用 Encrypted 时，安全性将取决于对您的机器（或至少是 machine.config）的物理访问。
*   使用散列密码（默认）将保证安全性，具体取决于：a）RNGCryptoServiceProvider 类的散列策略的已知反转和b）访问数据库以破坏随机生成的盐。

我不知道是否可以使用某种彩虹表破解默认的基于哈希的系统。

有关更多详细信息，请查看此链接：http: [//msdn.microsoft.com/en-us/library/aa478949.aspx](http://msdn.microsoft.com/en-us/library/aa478949.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T12:52:26.850

如果通过会员提供商正确配置，您将拥有足够的安全级别。除此之外，可以通过规范攻击访问该页面，但这与您的一般安全性有关。[我做了一个关于使用安全企业应用程序块](http://msdn.microsoft.com/en-us/library/cc309508.aspx)的演示。您可能想阅读这些内容并在您的站点上实施安全性时对其进行调查，并注意常见的安全威胁。鉴于您在一个开放的共享网络上，并且总安全性将是一个不插电的服务器，该服务器被锁定在一个由军方 24/7 全天候保护的保险箱中，任何网站都不会是 100% 不可破解的（根据橙皮书，围绕国防部“A”级安全性） ）。但是成员资格提供程序的开箱即用功能（如果配置正确）将提供大量的安全性。

编辑：是的，我同意其他评论，如果您想保护用户名/密码免受数据包嗅探器和网络监视器的影响，至少登录屏幕上的 HTTPS 是给定的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T12:54:19.357

Asp.Net 支持无 cookie 会话，正如[这篇博文所示](http://stainedsole.wordpress.com/2008/02/12/cookieless-forms-authentication/)。它使用 url 中的标识符来跟踪用户，而不是会话 cookie。

我不确定这有多安全，但我认为这是安全的，因为难以暴力破解身份字符串。

看起来它或多或少是开箱即用的，但是当重定向用户并想要维护会话状态时，您必须包含会话 ID。博客文章展示了如何做到这一点，以及网络上的许多其他文章。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T17:54:31.847

以下是微软关于这个主题的两篇好文章：

[如何：保护 ASP.NET 2.0 中的表单身份验证](http://msdn.microsoft.com/en-us/library/ms998310.aspx)

[信息：使用安全套接字层 (SSL) 帮助保护表单身份验证](http://support.microsoft.com/default.aspx?scid=kb;en-us;813829)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T18:14:16.900

URL 上的 Cookie 不够安全，它存在很多不同的问题（尤其是引荐来源泄漏，如果有的话）和 HTTPS 的使用。

# asp.net - ASP.Net 中等信任设置

> ID：133109
> 
> 赞同：2
> 
> 时间：2008-09-25T12:47:36.113
> 
> 标签：asp.net, configuration, medium-trust

我正在尝试将 IPermission 节点配置为中等信任的一部分。但是我无法在节点上找到 PathDiscovery 属性的有效值列表

```
<IPermission class="FileIOPermission" version="1" Read="$AppDir$" Write="$AppDir$" Append="$AppDir$" PathDiscovery="$AppDir$"/> 
```

我需要设置权限，以便帐户能够访问主路径下的所有子目录。当前 .svc（WCF 服务文件）会引发 404 错误，因为 ASP.Net 帐户无法从几个级别的子文件夹中获取它。我试图避免将节点更改为

```
<IPermission class="FileIOPermission" version="1" Unrestricted="true"/> 
```

有任何想法吗？

TIA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T16:49:03.193

我当然同意您不应该将节点更改为 Unrestricted，因为这几乎会破坏部分信任的目的。

根据[MSDN 上的 System.Security.Permissions.FileIOPermission 文档](http://msdn.microsoft.com/en-us/library/system.security.permissions.fileiopermission.aspx)， FileIOPermission 也应该暗示对该路径下所有内容的权限。从那个文档：

> 访问文件夹意味着访问其包含的所有文件，以及访问其子文件夹中的所有文件和文件夹。例如，对 C:\folder1\ 的读取权限意味着对 C:\folder1\file1.txt、C:\folder1\folder2\、C:\folder1\folder2\file2.txt 等的读取权限。

当然，Microsoft 对构建自定义信任 .config 文件的记录非常糟糕，因此 FileIOPermission 的 .config 标记的行为可能与代码类不同......不过这让我感到惊讶。

是否有可能是其他问题导致了 404？仔细检查服务是否在您期望的凭据下执行，并且路径正在被正确评估......

# regex - 如何在 Ant 'ReplaceRegExp' 任务中执行数学函数？

> ID：133111
> 
> 赞同：9
> 
> 时间：2008-09-25T12:47:50.573
> 
> 标签：regex, ant

我需要在 Ant 构建脚本的源文件中增加一个数字。我可以使用该`[ReplaceRegExp](http://ant.apache.org/manual/Tasks/replaceregexp.html)`任务来查找我想要增加的数字，但是我如何在`replace`属性中增加该数字？

这是我到目前为止所得到的：

```
<replaceregexp file="${basedir}/src/path/to/MyFile.java"
    match="MY_PROPERTY = ([0-9]{1,});"
    replace="MY_PROPERTY = \1;"/> 
```

在替换属性中，我该怎么做

```
replace="MY_PROPERTY = (\1 + 1);" 
```

我不能使用该`buildnumber`任务将值存储在文件中，因为我已经在同一个构建目标中使用它。是否有另一个 ant 任务可以让我增加属性？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T12:55:51.320

你可以使用类似的东西：

`<propertyfile file="${version-file}"> <entry key="revision" type="string" operation="=" value="${revision}" /> <entry key="build" type="int" operation="+" value="1" />`

所以蚂蚁任务是propertyfile。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T16:59:52.370

在 ant 中，对于像这样不太适合模具的小案例，您总是有备用“脚本”标签。这是上述内容的快速（混乱）实现：

```
 <property name="propertiesFile" location="test-file.txt"/>

    <script language="javascript">
        regex = /.*MY_PROPERTY = (\d+).*/;

        t = java.io.File.createTempFile('test-file', 'txt');
        w = new java.io.PrintWriter(t);
        f = new java.io.File(propertiesFile);
        r = new java.io.BufferedReader(new java.io.FileReader(f));
        line = r.readLine();
        while (line != null) {
            m = regex.exec(line);
            if (m) {
                val = parseInt(m[1]) + 1;
                line = 'MY_PROPERTY = ' + val;
            }
            w.println(line);
            line = r.readLine();
        }
        r.close();
        w.close();

        f.delete();
        t.renameTo(f);
    </script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T12:58:20.893

好问题，可以在 perl 中完成类似的操作，但我认为这在 ant、.NET 和其他领域是不可能的。如果我错了，我真的很想知道，因为这是一个很酷的概念，我'在 Perl 中使用过很多次，我真的可以在你提到的情况下使用。

# java - JConnect 错误代码列表是什么？

> ID：133112
> 
> 赞同：1
> 
> 时间：2008-09-25T12:48:01.290
> 
> 标签：java, jdbc, sybase, error-code, jconnect

我最近更改了一个应用程序，将数据库用户名和密码存储在配置文件中（***gasp***密码以纯文本形式存储在配置文件中）。

应用程序现在要求用户输入她的用户名和密码，然后才能继续。

新版本的应用程序现在必须询问`SQLException`导致异常的原因（无效的用户名或密码、无法访问数据库服务器、连接超时等），以便它可以决定下一步做什么（提示用户更正用户名和密码，告诉用户在解决网络问题后重试，重新连接隐形等）。

试图找到`SQLException`与这些（和其他）原因相关的错误代码（SQLException.getErrorCode()）几乎是不可能的，我们不得不猜测（这有时可能很危险）。

Java API 文档说这是特定于供应商的。

有没有人可以设置的错误代码`Sybase JConnect JDBC drivers`？

*   `JRE 1.5`
*   `jConnect for JDBC 2.0 (spec version 5.2)`
*   `Sybase IQ 12.7`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T12:24:46.540

似乎捕获的 SQLException 中的大多数 errorCode 都是 0。

这意味着您必须检查`Connection`//的`Statement`SQLWarnings`ResultSet`

```
connection.getWarnings(); 
```

或链接到抛出的异常的异常

```
sqlException.getNextException(); 
```

这里的棘手之处在于链接的异常可能是`SQLException`或`IOException`可能是其他异常（不记得遇到过其他异常）。

# winapi - 如何使用其句柄更改窗口所有者

> ID：133122
> 
> 赞同：11
> 
> 时间：2008-09-25T12:49:57.450
> 
> 标签：winapi, window, owner

我想为另一个外部应用程序（与 .NET 无关，纯 Win32）制作一个 .NET 表单作为 TopMost 表单，因此它保持在该 Win32App 之上，而不是其他正在运行的应用程序。

我有 Win32App 的句柄（由 Win32App 本身提供），我已经通过[C# 中的 P/Invoke尝试了](http://www.pinvoke.net/default.aspx/user32/SetParent.html)[Win32 SetParent() 函数](http://msdn.microsoft.com/en-us/library/ms633541(VS.85).aspx)，但是我的 .NET 表单被限制在 Win32App 中，这不是我想要的.

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-25T13:42:20.973

我认为您正在寻找的是 P/Invoke`SetWindowLongPtr(win32window, GWLP_HWNDPARENT, formhandle)`

[谷歌搜索](http://www.google.com/search?q=setwindowlongptr+parent)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T13:57:36.583

是的！我已经有一个 SetWindowLongPtr 的 P/Invoke 导入（这是 x64 安全的）。并使用 Reflector 我搜索了 Form.Owner 属性（即 get_Owner(Form value) 方法）并设法更改了所有者

```
SetWindowLongPtr(childHdl, -8, OwnerHdl) 
```

在我可以在这里发布解决方案之前，我正在查看 -8 (0xFFFFFFFFFFFFFFF8) 的含义，但乔尔已经指出了这一点。

谢谢！

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2020-07-08T00:29:06.203

自从提出这个问题以来已经 12 年了，所以我想我会从[这里](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-setwindowlongptra)提供一个更新的答案。

> 不要使用 GWLP_HWNDPARENT 索引调用 SetWindowLongPtr 来更改子窗口的父级。而是使用[SetParent](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-setparent)函数。

# ide - 除了 Domino Designer 之外，还有其他用于 Lotus Notes 的 IDE 吗？

> ID：133125
> 
> 赞同：4
> 
> 时间：2008-09-25T12:50:25.170
> 
> 标签：ide, lotus-notes, lotusscript

是否还有其他值得我花时间进行 Lotus Notes 开发的 IDE？我们主要进行 LotusScript 开发，并且会扼杀 Eclipse 或 Visual Studio 的功能，例如“显示声明”。我知道[Notes 中有一个用于 Java 开发的 Eclipse 插件](http://www.ibm.com/developerworks/lotus/library/notes-eclipse/)，但似乎它只*适用*于Java，而且我们在 LotusScript 中有太多遗留代码，无法放弃它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T20:30:29.260

Lotus Notes 在版本 8 中已移至 Eclipse 平台。您可以在 2 种不同模式下运行客户端，基本模式是我们都知道的版本或在 Eclipse 平台上（称为标准）。IDE 也正在迁移到 Eclipse，版本 8.5 beta 2 目前可用于新的基于 Eclipse 的 IDE。请记住，它是一个 Beta 版本，它的功能并不完整。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-11T14:01:18.180

时间站在我们这边。

基于 Eclipse 的 Domino Designer 现在可以从[http://www.ibm.com/developerworks/downloads/ls/dominodesigner/learn.html免费下载](http://www.ibm.com/developerworks/downloads/ls/dominodesigner/learn.html)

它具有出色的 Java 和 LotusScript 编辑器，具有所有出色的 Eclipse 功能，例如重构和自定义类的提前输入。

每个多米诺骨牌上瘾者都应该看看这个。管理员也是如此，因为上面的下载包括管理员客户端。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-11T16:34:23.300

从 8.5 版开始，Domino Designer 作为 Eclipse 应用程序运行。8.5.1 将带来大量改进，包括基于 Eclipse 的 LotusScript 和 Java 编辑以及对性能、稳定性和 XPages 的改进。

马特

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:45:26.217

您将找到的最接近的东西是[Teamstudio LotusScript Browser](http://www.teamstudio.com/support/free-utilities.html)。

它不是很好，但它是免费的，几乎可以弥补它。

特征：

1.  不支持键盘快捷键。
2.  没有完全集成到设计器中，所以有点迟钝。
3.  仅适用于脚本库
4.  它确实具有查找定义和引用功能，这几乎是有用的。

还有一个传闻中的用于 eclipse 的 LotusScript 插件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T12:54:25.207

Teamstudio 出售许多工具来帮助您进行 Lotus Notes 开发，看起来它们可以做一些您想要的事情，但看起来它们不能组装到 IDE 中。

[http://www.teamstudio.com/products/product-index.html](http://www.teamstudio.com/products/product-index.html)

（披露：几年前我曾在 Team Studio 的姊妹公司工作，但从未与他们的产品有太多关系）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T05:27:47.060

你可以给[Zeus](http://www.zeusedit.com) IDE 一个测试驱动器。它是高度和语言中立的，因此可以为**Lotus Notes**配置它。

[Zeus根据](http://www.zeusedit.com)**ctags**生成的信息自动维护一个标签数据库，因此如果**ctags为****Lotus Notes**生成标签信息，它将能够显示、浏览和搜索这些标签信息。

PS：如果决定试驾并发现它不正确支持**Notes**，请随时在[Zeus 论坛](http://www.zeusedit.com/forum)上发布错误报告。

[![替代文字](https://i.stack.imgur.com/jZGHP.jpg)](https://i.stack.imgur.com/jZGHP.jpg)
[（来源：[zeusedit.com](http://www.zeusedit.com/images/_lookmain.jpg)）]

# eclipse - Eclipse 搜索菜单随机禁用

> ID：133129
> 
> 赞同：34
> 
> 时间：2008-09-25T12:51:12.843
> 
> 标签：eclipse, search, eclipse-3.4, ganymede, eclipse-3.3

我在日常工作中使用*Eclipse 3.3*，并且也广泛使用了*Eclipse 3.2*。在这两个版本中，有时菜单中的搜索选项（Java 搜索、文件搜索等）会被禁用，似乎是随机的。但是，使用`Ctrl`+ `H`，我可以访问搜索功能。有谁知道为什么会这样？它是否已在*Eclipse 3.4*中修复？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2011-06-01T09:02:35.957

window > close all perspective 对我有用。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-09-11T00:46:05.750

使用 Eclipse 4.3(!) 在进行区分大小写的搜索后，这发生在我身上。

`Window -> Close All Perspectives`没有修复它，也没有使用`-clean`. 在弄乱搜索框时，我发现只需单击以前的搜索条目就可以编辑它并再次搜索！单击返回区分大小写的搜索会使该选项再次变灰。

因此，在您重置工作区中的任何内容之前，请尝试使用`Down Arrow`.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-10-18T08:22:02.833

我认为这个答案是您解决所有版本问题所需要的。

我正在使用 RAD 8，我也遇到了这个问题，而不是删除`org.eclipse.search`（当前使用的工作区）`workspace/metadata/plugins`文件夹中的目录，然后重新启动 Eclipse。

就这样。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T15:06:33.877

我没有确切的答案。我建议您尝试将禁用与哪个透视处于活动状态相关联。同样，哪个视图处于活动状态。我一直在使用 3.4 并没有遇到这个问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-21T13:51:02.690

该死！我也有这个问题——在 Eclipse 3.4.2 中。

似乎与 Navigator 和 Project Explorer 视图有关： - 切换到 Debug 透视图：搜索菜单项在那里。- 切换到 Java 或 Java EE 透视图：搜索菜单项仍然存在。- 在 Navigator 或 Project Explorer 中单击一个项目：搜索菜单项全部禁用。

（诅咒！我经常在 Selected Resources 中使用搜索！）-：

嗯...它可能还取决于当前在编辑器中打开的文件类型。（就像 Java 与 xml。）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-12T17:18:40.553

仍然存在于 Eclipse 3.5.2 中——并且第一次真正具有粘性。

我检查了“关闭所有打开的文件并随后打开任何其他文件”的答案，并带回了搜索菜单项。此外，如果你很幸运并且打开了搜索结果视图，那么确实有这个小链接“打开搜索对话框”。

顺便说一句，另外许多其他与项目相关的菜单项似乎也随之变灰，并且它们没有恢复活力:-(但我并没有真正检查这些是否只是有用和计划的项目在这种情况下显示为灰色。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T21:17:25.633

我正在使用在 Eclipse 3.4 上运行的 RAD 7.5.1，我经常遇到令人沮丧的问题。我在哪个视角或视图中，或者我打开了哪个编辑器都没有关系。

重新启动 RAD 通常会清除它，但因为那是一个巨大的痛苦，我发现你可以在搜索视图中绕过它，有一个链接；“从搜索对话框开始搜索”将弹出搜索对话框。

这不是一个很好的解决方法，因为该链接仅在您没有搜索历史记录时显示。要进行其他搜索，您必须清除视图中的搜索历史记录。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-01T21:16:19.447

对于任何被此咬伤的人的迟到评论，但我发现“ *eclipse -clean* ”修复了它=>这会在开始之前清理工作区

感谢[http://letsgetdugg.com/2009/04/19/recovering-a-corrupt-eclipse-workspace/](http://letsgetdugg.com/2009/04/19/recovering-a-corrupt-eclipse-workspace/)的提示，在我猜到我的工作区可能已损坏之后。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-03T01:45:59.537

在搜索之前，请检查您是否可以在空工作集中选择范围。大多数搜索菜单在您选择它时会禁用搜索按钮。我的也是:)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-04-08T09:01:04.407

窗口 > 关闭所有视角也对我有用。

但是，如果您只是在项目中寻找文本搜索，您可以在标记的文本上按`Ctrl`+ `Alt`+`G`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-04T12:45:00.817

我在 Debian Lenny 下的 MyEclipse 7 (eclipse 3.4) 有这个问题。视角似乎无关紧要。`Ctrl`我用快捷键+绕过它，`H`但我希望有更好的方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-01-19T23:16:55.707

即使重新启动 Eclipse，我也无法让它工作。

这对我有用：关闭所有打开的文件并打开另一个文件。不同的文件恰好是 .java，但不确定这是否与它有关。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-03-30T13:49:57.893

我不时遇到这个问题。

在过去，我通过使用 -clean 选项启动 eclipse 来修复。

有一次，当它不起作用时，我创建了一个新的工作区。

对于这两个解决方案，我按照[这些说明进行操作。](http://www.eclipsezone.com/eclipse/forums/t61566.html)

clean 选项今天对我不起作用，我发现这个线程是因为我不想创建新的工作区。但是，关闭所有文件并重新打开一个文件确实有效。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-10-10T05:23:15.960

我在 eclipse 3.6.2 中也遇到了这个问题：Helios Service Release 1。

关闭所有编辑器窗口，并启用搜索。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-06-02T08:52:57.653

切换到另一个视角，然后返回，对我来说很快。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-01-22T06:38:36.463

我在`Ctrl`+ `H`“文件搜索”选项卡中遇到了类似的问题。“搜索”和“替换”按钮变灰（禁用）。解决方案是填写“文件名模式”文本框（例如 *.py）。可能这是设计使然！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-07-03T06:19:51.700

刚刚在 Eclipse Neon 3 中遇到了这个问题。这是 RAD 中非常常见的问题。我可以在控制台中找到 using，然后切换回源并搜索。RAD 将禁用每个打开的源文件的查找/搜索选项。这非常令人沮丧。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2010-04-08T15:04:46.343

我也有这个问题。它是在我安装 m2eclipse 插件时出现的。

我没有找到解决方案，但您可以使用`Ctrl`+`H`快捷方式。`Ctrl`您可以使用+`PgDown`或`Ctrl`+`PgUp`键在选项卡之间导航。

我已经卸载了以下管道并且它有效。

*   Maven 集成
*   PMD
*   eclipse checkstyle插件
*   EclEmma（覆盖范围）

我不知道是哪一个导致了问题。要卸载插件：帮助 -> 软件更新...-> “已安装的软件”选项卡。

# apache - 将 iPlanet/Sun ONE 配置为 JBoss/Tomcat 应用程序的 HTTP/HTTPS 前端的最佳方式是什么？

> ID：133136
> 
> 赞同：0
> 
> 时间：2008-09-25T12:52:33.543
> 
> 标签：apache, tomcat, jboss, sunone

将 iPlanet/Sun ONE 配置为 JBoss/Tomcat 应用程序的 HTTP/HTTPS 前端的最佳方式是什么？

是否有任何性能考虑？

这与 Apache httpd 和 Tomcat 之间的本机集成相比如何？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T12:57:24.717

iPlanet 有一些插件可以做到这一点。查看 iPlanet 文档中的反向代理插件。

这可能会有所帮助： [http ://docs.sun.com/source/816-7156-10/agplugin.html#18923](http://docs.sun.com/source/816-7156-10/agplugin.html#18923)

# c# - LLBLGen：如何软删除条目

> ID：133143
> 
> 赞同：5
> 
> 时间：2008-09-25T12:53:19.423
> 
> 标签：c#, llblgenpro

我继承了一个使用 LLBLGen Pro 作为 DB 层的项目。DB 模型要求在删除条目时有一个标志（DeletedDate 设置为当前时间）。最后一位程序员忽略了这个要求，并在整个应用程序中使用了定期删除。

有没有办法将代码生成器设置为自动执行此操作，或者我是否必须为需要它的实体重载每个删除运算符？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T14:18:00.013

我在 SQL Server 2005 中使用删除任何软删除表的 INSTEAD OF 触发器实现了这一点。触发器设置删除标志并执行清理。这个解决方案的美妙之处在于它可以正确处理访问数据库的任何系统发出的删除。INSTEAD OF 在 SQL Server 中相对较新，我知道有一个 Oracle 等价物。

这个解决方案还可以很好地与我们的 O/R 映射器配合使用——我创建了过滤掉软删除记录并映射它们的视图。这些视图也用于所有报告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T13:23:09.863

您可以在 LLBLGen 中创建自定义任务，在生成实体时为您覆盖这些任务。在网站上查看他们的模板工作室和模板示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T16:41:46.413

这取决于您使用的是自助服务还是适配器。如果是 SS，您将需要修改模板，以便它为您设置标志，而不是删除实体。

如果是适配器，您可以从 DataAccessAdapter 继承并覆盖删除方法来为您设置标志，而不是删除实体。

这通常是一个糟糕的性能解决方案，尽管每个查询都需要过滤掉“已删除”实体 - 并且因为“已删除”列上的选择性不会很高（所有“未删除”记录都是空的 - 我'我猜这将是他们中的大多数）索引它不会给你带来很多好处——你最终会得到很多表扫描。

# sorting - 如何使用批处理文件实现快速排序？

> ID：133154
> 
> 赞同：11
> 
> 时间：2008-09-25T12:55:35.283
> 
> 标签：sorting, batch-file

虽然通常总是为工作选择正确的语言是件好事，但有时尝试用一种非常不合适的语言做某事可能是有益的。

1.  它可以帮助您更好地理解问题。也许您不必像您认为的那样解决它*。*
2.  它可以帮助您更好地理解语言。也许它支持的功能比您意识到的要多。

并将这个想法推向不合逻辑的结论......你将如何在批处理文件中实现快速排序？甚至可能吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-25T12:55:44.563

事实证明，这并不像你想象的那么难。语法丑得要命，但批处理语法实际上能够做一些令人惊讶的事情，包括递归、局部变量和一些令人惊讶的复杂的字符串解析。不要误会我的意思，这是一种糟糕的语言，但令我惊讶的是，它并没有完全瘫痪。我认为我没有学到任何关于快速排序的知识，但我学到了很多关于批处理文件的知识！

无论如何，这里是批处理文件中的快速排序 - 我希望您在阅读它时像我在编写它时一样尝试理解奇怪的语法。:-)

```
@echo off
SETLOCAL ENABLEDELAYEDEXPANSION

call :qSort %*
for %%i in (%return%) do set results=!results! %%i
echo Sorted result: %results%
ENDLOCAL
goto :eof

:qSort
SETLOCAL
    set list=%*
    set size=0
    set less=
    set greater=
    for %%i in (%*) do set /a size=size+1
    if %size% LEQ 1 ENDLOCAL & set return=%list% & goto :eof
    for /f "tokens=2* delims== " %%i in ('set list') do set p=%%i & set body=%%j
    for %%x in (%body%) do (if %%x LEQ %p% (set less=%%x !less!) else (set greater=%%x !greater!))
    call :qSort %less%
    set sorted=%return%
    call :qSort %greater%
    set sorted=%sorted% %p% %return%
ENDLOCAL & set return=%sorted%
goto :eof 
```

通过给它一组数字来调用它，以便在命令行上排序，用空格分隔。例子：

```
C:\dev\sorting>qsort.bat 1 3 5 1 12 3 47 3
Sorted result:  1 1 3 3 3 5 12 47 
```

代码有点难理解。它基本上是标准的快速排序。关键是我们将数字存储在一个字符串中——穷人的数组。第二个 for 循环非常模糊，它基本上将数组拆分为头部（第一个元素）和尾部（所有其他元素）。Haskell 使用符号 x:xs 执行此操作，但批处理文件使用 /f 开关调用的 for 循环执行此操作。为什么？为什么不？

SETLOCAL 和 ENDLOCAL 调用让我们可以做局部变量 - 有点像。SETLOCAL 为我们提供了原始变量的完整副本，但是当我们调用 ENDLOCAL 时，所有更改都被完全擦除，这意味着您甚至无法使用全局变量与调用函数进行通信。这解释了丑陋的“ENDLOCAL & set return=%sorted%”语法，尽管逻辑表明它实际上是有效的。执行该行时，由于该行尚未执行，因此尚未擦除已排序的变量-然后由于该行已执行，因此未擦除返回变量。合乎逻辑！

此外，有趣的是，您基本上不能在 for 循环中使用变量，因为它们无法更改 - 这消除了 for 循环的大部分意义。解决方法是设置 ENABLEDELAYEDEXPANSION 有效，但会使语法比正常情况更难看。请注意，我们现在有一个混合变量，仅通过它们的名称来引用，通过在它们前面加上一个 %，通过在它们前面加上两个 %，通过将它们包装在 % 中，或者通过将它们包装在 ! 中。而且这些引用变量的不同方式几乎是完全不可互换的！

除此之外，应该比较容易理解！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-11T03:45:12.283

这是我不久前写的一个更清晰的版本：

```
@echo off

echo Sorting:  %*

set sorted=

:sort
:: If we've only got one left, we're done.
if "%2"=="" (
  set sorted=%sorted% %1
  :: We have to do this so that sorted gets actually set before we print it.
  goto :finalset
)
:: Check if it's in order.
if %1 LEQ %2 (
  :: Add the first value to sorted.
  set sorted=%sorted% %1
  shift /1
  goto :sort
)
:: Out of order.
:: Reverse them and recursively resort.
set redo=%sorted% %2 %1
set sorted=
shift /1
shift /1
:loop
if "%1"=="" goto :endloop
set redo=%redo% %1
shift /1
goto :loop
:endloop
call :sort %redo%
:: When we get here, we'll have already echod our result.
goto :eof

:finalset
echo Final Sort:  %sorted%
goto :eof 
```

例子：

```
C:\Path> sort 19 zebra blah 1 interesting 21 bleh 14 think 2 ninety figure it out 
```

产生：

```
Sorting:  19 zebra blah 1 interesting 21 bleh 14 think 2 ninety figure it out
Final Sort:   1 2 14 19 21 blah bleh figure interesting it ninety out think zebra 
```

# asp.net - 经典 ASP 和 ASP.NET 集成

> ID：133173
> 
> 赞同：13
> 
> 时间：2008-09-25T12:59:46.317
> 
> 标签：asp.net, asp-classic

在之前的工作中，我们有一个经典的 ASP 应用程序，没有人愿意迁移到 ASP.NET。它所做的事情，做得非常好。

但是，需要添加一些似乎最适合 ASP.NET 的新功能。做出决定是为了让系统成为 ASP 和 ASP.NET 的奇怪混合体。

我们最大的症结是会话管理，我们一起破解了一个通过表单变量传递会话值的解决方案。我已经与通过 cookie 处理同样问题的其他人交谈过。

这两种方法似乎都是一个可怕的问题（除了非常不安全之外）。

有没有更好或更清洁的方法，或者这只是一个糟糕的主意，开始讨论这个话题是没有意义的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-25T13:07:10.683

您不能将会话数据保存到服务器端数据存储吗？即 XML 文件、数据库等。然后您可以将哈希（根据一些安全识别会话的标准计算得出）传递给 .NET 页面，该页面可以使用此标识符从数据存储中提取数据并填充您的会话数据. 这仍然意味着每次都必须通过代理将请求从 ASP 传递到 ASP.NET，以确保每个应用程序中都有最新的会话数据，但恐怕我不知道实现此目的的替代方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T13:03:54.437

我不得不处理同样的问题。在我的例子中，我将一个密钥加密到一个 cookie 中，并将数据库用于任何其他信息。我在 .NET 中编写了加密并进行了互操作以解密 ASP 端的 id。处理 base-64 字符串有些奇怪，因为 ASP 不会获得与 .NET 相同的字符串，因此您可能必须像我一样将 base-64 字符串重写为等效的十六进制或一些类似的最低公分母战术。它相对安全（保存 XSS 攻击）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T13:04:49.707

好吧，最终最好的主意可能是将 ASP 应用程序转换为 .NET。我认为这可能是不言而喻的。如果安全是一个大问题，您可以采取一些步骤来加密和维护会话信息的完整性，以使其更加安全，例如一些对称加密和散列等等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T13:07:00.090

在一般情况下，我不知道有任何更清洁的方法可以做到这一点。但也许您可以更具体地描述您必须在系统之间共享什么状态？在您的特定情况下可能有更清洁的解决方案。会话对象状态并不总是保持状态的最佳方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T13:09:16.293

我必须同意[Wes P](https://stackoverflow.com/questions/133173/classic-asp-and-aspnet-integration#133198)的观点……长期目标是什么？如果长期目标是将经典的 ASP 应用程序迁移到 ASP.NET，那么我认为我的短期修复，无论它可能是什么，都会奏效。如果长期要保留经典的 ASP 应用程序，那么最好使用更强大的会话管理解决方案，类似于[Oglester](https://stackoverflow.com/questions/133173/classic-asp-and-aspnet-integration#133192)推荐的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-10T21:57:23.600

您可以创建一个新的 .NET Web 窗体应用程序，在其中包含您的 .asp 经典代码，并将以下内容添加到您的 web.config 文件中。确保以**集成管道**模式运行应用程序池。

这将确保身份验证模块（如表单身份验证）向后兼容 ASP Classic。您的 ASP Classic 代码将受到您的 .NET 代码所使用的相同身份验证机制的保护（如 web.config 中所定义），而不必像您提到的那样实现本地机制。

```
 <system.webServer>
    <modules>
      <remove name="FormsAuthenticationModule" />
      <add name="FormsAuthenticationModule" type="System.Web.Security.FormsAuthenticationModule" />
      <remove name="UrlAuthorization" />
      <add name="UrlAuthorization" type="System.Web.Security.UrlAuthorizationModule" />
      <remove name="DefaultAuthentication" />
      <add name="DefaultAuthentication" type="System.Web.Security.DefaultAuthenticationModule" />
      <remove name="Session" />
      <add name="Session" type="Microsoft.AspNet.SessionState.SessionStateModuleAsync, Microsoft.AspNet.SessionState.SessionStateModule, Version=1.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" preCondition="integratedMode" />
    </modules>
  </system.webServer> 
```

# bug-tracking - 正确组织的 bugtracker 的规则（Mantis 等人）

> ID：133175
> 
> 赞同：3
> 
> 时间：2008-09-25T12:59:53.900
> 
> 标签：bug-tracking, mantis

在一个特定的项目中，我们总共与 10 名团队成员合作。

在项目上工作了大约一年之后（并且一直使用 Mantis 作为 bug-/feature-tracker），bugtracker 变得越来越难以使用，因为没有设置标准来解释如何创建新任务，如何评论任务等。这会导致相同错误的多个条目，在搜索错误时无法轻松找到错误等。

你如何组织你的 bugtracker？您是否对应用程序的不同部分（GUI、后端等）使用了很多（子）类别，是否在任务标题中使用标签（即“[GUI][OptionPage] 错误”）？

是否允许团队中的任何人引入新任务，或者此步骤是否通过单个“Mantis-master”引导（然后谁会知道新报告是重复的还是全新的条目）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T13:04:29.723

始终将版本控制系统提交链接到问题并返回，以便您知道进行了哪些提交确实解决了哪个问题以及完成某个提交的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T13:05:40.593

我们所做的是将批准条目的角色引入错误跟踪器。这个角色可以由不同的人分担。该过程要么是批准，要么是通过小幅编辑批准，要么是拒绝条目并要求进一步编辑或澄清。

如果该角色不授予在（核心）团队中工作的人员，则更好地进行一般理解。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-18T10:45:21.960

在开放网络上的“大型”螳螂系统中，我看到规则类似于

新：任何人都可以输入错误。

已确认：少数人可以将其升级到此级别。这些人已经看到了每个新的错误一段时间，因此他们会知道它是否是重复的。或者他们可以将其传回给记者进行澄清，直到他们充分理解以完成这项工作。

确认：由基本上说“我们将这样做”的决策者设定。

我实际上不记得它在哪里，更重要的是*我不知道它的效果如何*。

# c# - 嵌入式 Outlook 视图控件

> ID：133194
> 
> 赞同：4
> 
> 时间：2008-09-25T13:04:20.753
> 
> 标签：c#, .net, visual-studio-2008, outlook, add-in

我正在尝试在 Windows XP SP3 和 Internet Explorer 7 上使用 Visual Studio 2008 制作 Outlook 2003 加载项。

我的加载项正在使用自定义文件夹主页，该主页显示我的自定义表单，其中包含 Outlook 视图控件。

每次尝试设置 OVC 的文件夹属性时，我都会收到带有“HRESULT 中的异常：0xXXXXXXXX”描述的 COM 异常。错误码是一个随机数，每次都不一样。这不是第一次访问控件的属性，在此之前，已经设置了 View 和 ViewXML 属性。控件被标记为安全的脚本。

我正在使用活动资源管理器的 CurrentFolder.FolderPath 属性的值，这似乎是正确的：

```
Outlook.Explorer currentExplorer = app.ActiveExplorer();
        if (currentExplorer != null)
        {
            ovcWrapper.Folder = currentExplorer.CurrentFolder.FolderPath;
        } 
```

这是堆栈跟踪的顶部：

```
System.Runtime.InteropServices.COMException (0xXXXXXXXX): Exception from HRESULT: 0xXXXXXXXX
at Microsoft.Office.Interop.OutlookViewCtl.ViewCtlClass.set_Folder(String pVal)
at AxMicrosoft.Office.Interop.OutlookViewCtl.AxViewCtl.set_Folder(String value).. 
```

仅当文件夹位于非默认 PST 文件中时才会发生这种情况。更改为默认 PST 文件中的文件夹不会产生异常。

我必须强调，在我去度假之前一切都很好:)。我不在时，Windows XP 似乎安装了一些更新，这些更新改变了 Internet Explorer 或 Outlook 2003 的默认安全性。

在另一台（虚拟机）上安装了 Office 2007 和 Internet Explorer 6，没有任何更新，一切正常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T14:55:35.060

过了一会儿，我终于找到了解决方案：将外部存储的名称更改为新名称。

在插件启动期间，它会加载非默认的 PST 文件，并将其名称（不是 pst 文件的名称，而是根文件夹的名称）更改为“Documents”。

这是代码：

```
session.AddStore("C:\\test.pst"); // loads existing or creates a new one, if there is none.
storage = session.Folders.GetLast(); // grabs root folder of the new fileStorage.

if (storage.Name != storageName) // if fileStorage is brand new, it has default name.
{
      storage.Name = "Documents";
      session.RemoveStore(storage); // to apply new fileStorage name, it have to be removed and added again.
      session.AddStore(storagePath);
 } 
```

解决方案是不再使用“文档”作为名称，而是使用新的名称。问题与特定名称无关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:38:52.567

Dobri Dan，nency :)

鉴于此处的信息，我不知道我是否真的可以提供“银弹”解决方案……但这里有一些想法/笔记可供尝试：

在一些项目中与 Outlook 合作过过去，我可以告诉您，有时在授予/授予外部用户/进程访问权限时，它是一只有趣的鸟。它有时需要用户手动确认访问或登录...所以请确保您有

```
app.Session.Logon() 
```

照顾的地方。

我注意到的另一件事是使用`app.ActiveExplorer()` Make sure that this function is return exactly what you think it is; 它占用用户桌面上*最顶层的窗口...通常是您尝试使用的窗口，**但并不总是*您尝试使用的窗口，因此请仔细检查。

# perforce - 在 Perforce 中，如何获取已签出文件的列表？

> ID：133204
> 
> 赞同：44
> 
> 时间：2008-09-25T13:06:53.493
> 
> 标签：perforce

如何获取用户使用 P4V 或 P4 签出的文件列表（包括用户名）？

我想提供一个仓库位置并查看该位置下所有已签出的文件（包括子文件夹）的列表。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-25T13:09:53.297

从命令行：

```
p4 opened -a //depot/Your/Location/... 
```

... 表示应包含子文件夹。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-25T13:47:08.107

看到您还询问了 P4V 并且到目前为止只有命令行答案，这就是您为 P4V 所做的事情。“待定”窗格可让您部分实现所需。确保清除“用户”和“工作区”过滤器，您将获得按更改列表和客户端规范分组的所有文件的列表。不像 Iain 和 Mark 建议的那样使用 P4 命令行时获得的直接文件列表那么干净，但在某些情况下可能会有所帮助。

另一种方法是在 P4V 中使用建议的命令行解决方案之一创建自定义菜单。例如：

1.  工具->管理自定义工具
2.  新的
3.  称它为例如由用户打开文件
4.  检查“添加到适用的上下文菜单”
5.  在应用程序字段中，浏览到 p4.exe
6.  在 Arguments 中，输入 opens -a %D （后者采用当前选择的 depot 路径）
7.  选中该框以在控制台中运行。

我敢肯定，如果需要过滤输出，您可能会对此有所了解。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-25T13:16:02.317

您还可以像这样限制 p4 打开的输出：

```
p4 opened -C <client-spec> //depot/... 
```

获取在该客户端规范上打开的文件列表

```
p4 opened //depot/... 
```

将为您提供当前 P4USER 打开的文件列表

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-07-27T07:15:01.393

如果您想搜索特定用户：

```
p4 opened -u the_user_name 
```

如果您想搜索特定的变更列表：

```
p4 opened -u the_user_name -c cl_number 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-03-01T23:51:59.147

我只想指出一些关于命令行参数的事情。

在要查看的文件夹后添加“ **/... ”很重要，因为它会告诉 perforce 递归地执行此操作。**

所以，我一开始就在尝试这个：

```
p4 opened -a //myP4Path/dev_project 
```

直到我这样做才起作用：

```
p4 opened -a //myP4Path/dev_project/... 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-03-20T12:08:50.457

在 p4v 中：尝试重命名顶级目录。您将收到警告和当前签出文件的列表以及用户名。

# c - 有没有典型的状态机实现模式？

> ID：133214
> 
> 赞同：127
> 
> 时间：2008-09-25T13:08:33.583
> 
> 标签：c, design-patterns, finite-automata

我们需要在**C**中实现一个简单的状态机。
标准的 switch 语句是最好的方法吗？
我们有一个当前状态（state）和一个转换触发器。

```
 switch(state)
{
  case STATE_1:
     state = DoState1(transition);
     break;
  case STATE_2:
     state = DoState2(transition);
     break;
}
...
DoState2(int transition)
{
   // Do State Work
   ...
   if(transition == FROM_STATE_2) {
     // New state when doing STATE 2 -> STATE 2
   }
   if(transition == FROM_STATE_1) {
    // New State when moving STATE 1 -> STATE 2
   }
   return new_state;
} 
```

**简单状态机**有没有更好的方法

 **编辑：对于 C++，我认为 Boost [Statechart](http://www.boost.org/doc/libs/1_36_0/libs/statechart/doc/index.html)库可能是要走的路。但是，它对C**没有**帮助。让我们专注于 C 用例。

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2008-09-25T13:35:31.257

我更喜欢对大多数状态机使用表驱动方法：

```
typedef enum { STATE_INITIAL, STATE_FOO, STATE_BAR, NUM_STATES } state_t;
typedef struct instance_data instance_data_t;
typedef state_t state_func_t( instance_data_t *data );

state_t do_state_initial( instance_data_t *data );
state_t do_state_foo( instance_data_t *data );
state_t do_state_bar( instance_data_t *data );

state_func_t* const state_table[ NUM_STATES ] = {
    do_state_initial, do_state_foo, do_state_bar
};

state_t run_state( state_t cur_state, instance_data_t *data ) {
    return state_table[ cur_state ]( data );
};

int main( void ) {
    state_t cur_state = STATE_INITIAL;
    instance_data_t data;

    while ( 1 ) {
        cur_state = run_state( cur_state, &data );

        // do other program logic, run other state machines, etc
    }
} 
```

这当然可以扩展为支持多个状态机等。也可以容纳转换操作：

```
typedef void transition_func_t( instance_data_t *data );

void do_initial_to_foo( instance_data_t *data );
void do_foo_to_bar( instance_data_t *data );
void do_bar_to_initial( instance_data_t *data );
void do_bar_to_foo( instance_data_t *data );
void do_bar_to_bar( instance_data_t *data );

transition_func_t * const transition_table[ NUM_STATES ][ NUM_STATES ] = {
    { NULL,              do_initial_to_foo, NULL },
    { NULL,              NULL,              do_foo_to_bar },
    { do_bar_to_initial, do_bar_to_foo,     do_bar_to_bar }
};

state_t run_state( state_t cur_state, instance_data_t *data ) {
    state_t new_state = state_table[ cur_state ]( data );
    transition_func_t *transition =
               transition_table[ cur_state ][ new_state ];

    if ( transition ) {
        transition( data );
    }

    return new_state;
}; 
```

表驱动方法更易于维护和扩展，并且更易于映射到状态图。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-25T13:35:49.133

您可能已经看到我对另一个 C 问题的回答，其中我提到了 FSM！这是我的做法：

```
FSM {
  STATE(x) {
    ...
    NEXTSTATE(y);
  }

  STATE(y) {
    ...
    if (x == 0) 
      NEXTSTATE(y);
    else 
      NEXTSTATE(x);
  }
} 
```

定义了以下宏

```
#define FSM
#define STATE(x)      s_##x :
#define NEXTSTATE(x)  goto s_##x 
```

这可以修改以适应特定情况。例如，您可能有一个`FSMFILE`要驱动 FSM 的文件，因此您可以将读取下一个字符的操作合并到宏本身中：

```
#define FSM
#define STATE(x)         s_##x : FSMCHR = fgetc(FSMFILE); sn_##x :
#define NEXTSTATE(x)     goto s_##x
#define NEXTSTATE_NR(x)  goto sn_##x 
```

现在您有两种类型的转换：一种进入一个状态并读取一个新字符，另一种进入一个状态而不消耗任何输入。

您还可以通过以下方式自动处理 EOF：

```
#define STATE(x)  s_##x  : if ((FSMCHR = fgetc(FSMFILE) == EOF)\
                             goto sx_endfsm;\
                  sn_##x :

#define ENDFSM    sx_endfsm: 
```

这种方法的好处是您可以直接将绘制的状态图转换为工作代码，相反，您可以轻松地从代码中绘制状态图。

在其他实现 FSM 的技术中，转换的结构隐藏在控制结构中（while、if、switch ...）并由变量值（通常是`state`变量）控制，将漂亮的图表与复杂的代码。

我从一篇发表在伟大的“计算机语言”杂志上的文章中学到了这种技术，不幸的是，该杂志已不再出版。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2012-02-17T03:37:59.173

我也使用了表格方法。但是，有开销。为什么要存储第二个指针列表？C 中没有 () 的函数是 const 指针。所以你可以这样做：

```
struct state;
typedef void (*state_func_t)( struct state* );

typedef struct state
{
  state_func_t function;

  // other stateful data

} state_t;

void do_state_initial( state_t* );
void do_state_foo( state_t* );
void do_state_bar( state_t* );

void run_state( state_t* i ) {
    i->function(i);
};

int main( void ) {
    state_t state = { do_state_initial };

    while ( 1 ) {
        run_state( state );

        // do other program logic, run other state machines, etc
    }
} 
```

当然，根据您的恐惧因素（即安全与速度），您可能需要检查有效指针。对于大于三个左右状态的状态机，上面的方法应该比等效的开关或表格方法更少的指令。你甚至可以宏化为：

```
#define RUN_STATE(state_ptr_) ((state_ptr_)->function(state_ptr_)) 
```

另外，我从 OP 的示例中感觉到，在考虑/设计状态机时应该进行简化。我不认为过渡状态应该用于逻辑。每个状态函数都应该能够在不明确了解过去状态的情况下执行其给定的角色。基本上，您设计的是如何从您所处的状态过渡到另一个状态。

最后，不要基于“功能”边界开始设计状态机，为此使用子功能。而是根据您何时必须等待某些事情发生才能继续进行划分状态。这将有助于最大限度地减少在获得结果之前必须运行状态机的次数。这在编写 I/O 函数或中断处理程序时可能很重要。

此外，经典 switch 语句的一些优点和缺点：

优点：

*   它是用语言编写的，因此有记录且清晰
*   状态在它们被调用的地方定义
*   可以在一个函数调用中执行多个状态
*   所有状态通用的代码都可以在switch语句之前和之后执行

缺点：

*   可以在一个函数调用中执行多个状态
*   所有状态通用的代码都可以在switch语句之前和之后执行
*   开关实现可能很慢

请注意这两个属性既是赞成又是反对。我认为这种切换为状态之间提供了过多共享的机会，并且状态之间的相互依赖可能变得难以管理。然而，对于少数状态，它可能是最可读和可维护的。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2017-07-06T17:14:27.250

在[Martin Fowler 的 UML Distilled](https://martinfowler.com/books/uml.html)中，他在第 10 章状态机图（强调我的）中指出（没有双关语）：

> 状态图可以通过三种主要方式实现：**嵌套开关**、**状态模式**和 **状态表**。

让我们使用手机显示屏状态的简化示例：

[![在此处输入图像描述](https://i.stack.imgur.com/jfuIy.png)](https://i.stack.imgur.com/jfuIy.png)

### 嵌套开关

Fowler 给出了一个 C# 代码示例，但我已将其改编为我的示例。

```
public void HandleEvent(PhoneEvent anEvent) {
    switch (CurrentState) {
    case PhoneState.ScreenOff:
        switch (anEvent) {
        case PhoneEvent.PressButton:
            if (powerLow) { // guard condition
                DisplayLowPowerMessage(); // action
                // CurrentState = PhoneState.ScreenOff;
            } else {
                CurrentState = PhoneState.ScreenOn;
            }
            break;
        case PhoneEvent.PlugPower:
            CurrentState = PhoneState.ScreenCharging;
            break;
        }
        break;
    case PhoneState.ScreenOn:
        switch (anEvent) {
        case PhoneEvent.PressButton:
            CurrentState = PhoneState.ScreenOff;
            break;
        case PhoneEvent.PlugPower:
            CurrentState = PhoneState.ScreenCharging;
            break;
        }
        break;
    case PhoneState.ScreenCharging:
        switch (anEvent) {
        case PhoneEvent.UnplugPower:
            CurrentState = PhoneState.ScreenOff;
            break;
        }
        break;
    }
} 
```

### 状态模式

这是我使用 GoF 状态模式的示例的实现：

[![在此处输入图像描述](https://i.stack.imgur.com/4G0vE.png)](https://i.stack.imgur.com/4G0vE.png)

### 状态表

从福勒那里得到灵感，下面是我的示例表：

```
源状态目标状态事件保护动作
-------------------------------------------------- ----------------------------------
ScreenOff ScreenOff pressButton powerLow displayLowPowerMessage  
ScreenOff ScreenOn pressButton !powerLow
ScreenOn ScreenOff 按下按钮
ScreenOff Screen充电插头电源
ScreenOn Screen充电插头电源
ScreenCharging ScreenOff 拔掉电源

```

### 比较

嵌套开关将所有逻辑保存在一个位置，但是当有很多状态和转换时，代码可能难以阅读。它可能比其他方法（没有多态性或解释）更安全和更容易验证。

状态模式实现可能会将逻辑分散到几个单独的类中，这可能会使理解它作为一个整体成为一个问题。另一方面，小班分开很容易理解。如果您通过添加或删除转换来更改行为，则设计特别脆弱，因为它们是层次结构中的方法，并且可能对代码进行大量更改。如果你遵循小接口的设计原则，你会发现这种模式做得并不好。但是，如果状态机稳定，则不需要进行此类更改。

状态表方法需要为内容编写某种解释器（如果您对所使用的语言进行了反思，这可能会更容易），这可能需要大量工作。正如 Fowler 指出的那样，如果您的表与您的代码是分开的，您可以修改软件的行为而无需重新编译。然而，这有一些安全隐患；该软件的行为基于外部文件的内容。

### 编辑（不是真正的 C 语言）

还有一种流畅的界面（也称为内部领域特定语言）方法，这可能是由具有[一流功能](https://en.wikipedia.org/wiki/First-class_function)的语言所促进的。存在无[状态库](https://www.hanselman.com/blog/Stateless30AStateMachineLibraryForNETCore.aspx)，该博客显示了一个带有代码的简单示例。讨论了[Java 实现（Java8 之前）](http://gabrielsw.blogspot.ca/2008/08/state-machines-using-fluent-interfaces.html)。我也在[GitHub 上看到了一个 Python 示例](https://github.com/txt/ase16/blob/master/src/fsm.py)。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-25T13:24:00.643

随着状态机变大，还有更易于维护的[逻辑网格](http://www.codeguru.com/Cpp/misc/misc/math/article.php/c9629)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-25T19:36:45.427

对于简单的状态机，只需为您的状态使用 switch 语句和枚举类型。根据您的输入在 switch 语句中进行转换。在实际程序中，您显然会更改“if(input)”以检查您的转换点。希望这可以帮助。

```
typedef enum
{
    STATE_1 = 0,
    STATE_2,
    STATE_3
} my_state_t;

my_state_t state = STATE_1;

void foo(char input)
{
    ...
    switch(state)
    {
        case STATE_1:
            if(input)
                state = STATE_2;
            break;
        case STATE_2:
            if(input)
                state = STATE_3;
            else
                state = STATE_1;
            break;
        case STATE_3:
            ...
            break;
    }
    ...
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-25T13:25:30.903

对于简单的情况，您可以使用您的 switch 样式方法。我发现过去效果很好的是也可以处理转换：

```
static int current_state;    // should always hold current state -- and probably be an enum or something

void state_leave(int new_state) {
    // do processing on what it means to enter the new state
    // which might be dependent on the current state
}

void state_enter(int new_state) {
    // do processing on what is means to leave the current state
    // might be dependent on the new state

    current_state = new_state;
}

void state_process() {
    // switch statement to handle current state
} 
```

我对 boost 库一无所知，但是这种方法非常简单，不需要任何外部依赖项，并且易于实现。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-25T20:58:42.343

switch() 是在 C 中实现状态机的一种强大且标准的方法，但如果您有大量状态，它会降低可维护性。另一种常用的方法是使用函数指针来存储下一个状态。这个简单的例子实现了一个设置/复位触发器：

```
/* Implement each state as a function with the same prototype */
void state_one(int set, int reset);
void state_two(int set, int reset);

/* Store a pointer to the next state */
void (*next_state)(int set, int reset) = state_one;

/* Users should call next_state(set, reset). This could
   also be wrapped by a real function that validated input
   and dealt with output rather than calling the function
   pointer directly. */

/* State one transitions to state one if set is true */
void state_one(int set, int reset) {
    if(set)
        next_state = state_two;
}

/* State two transitions to state one if reset is true */
void state_two(int set, int reset) {
    if(reset)
        next_state = state_one;
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2015-04-29T02:10:10.400

我在 edx.org 课程 Embedded Systems - Shape the World UTAustinX - UT.6.02x，第 10 章，由 Jonathan Valvano 和 Ramesh Yerraballi 找到了一个非常巧妙的 Moore FSM C 实现......

```
struct State {
  unsigned long Out;  // 6-bit pattern to output
  unsigned long Time; // delay in 10ms units 
  unsigned long Next[4]; // next state for inputs 0,1,2,3
}; 

typedef const struct State STyp;

//this example has 4 states, defining constants/symbols using #define
#define goN   0
#define waitN 1
#define goE   2
#define waitE 3

//this is the full FSM logic coded into one large array of output values, delays, 
//and next states (indexed by values of the inputs)
STyp FSM[4]={
 {0x21,3000,{goN,waitN,goN,waitN}}, 
 {0x22, 500,{goE,goE,goE,goE}},
 {0x0C,3000,{goE,goE,waitE,waitE}},
 {0x14, 500,{goN,goN,goN,goN}}};
unsigned long currentState;  // index to the current state 

//super simple controller follows
int main(void){ volatile unsigned long delay;
//embedded micro-controller configuration omitteed [...]
  currentState = goN;  
  while(1){
    LIGHTS = FSM[currentState].Out;  // set outputs lines (from FSM table)
    SysTick_Wait10ms(FSM[currentState].Time);
    currentState = FSM[currentState].Next[INPUT_SENSORS];  
  }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-25T13:26:37.250

[这篇文章](http://www.codeproject.com/KB/architecture/StatePatternBy_Sarath__.aspx)是状态模式的好文章（虽然它是 C++，而不是专门的 C）。

如果你能上手《[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)》这本书，说明和例子都非常清楚。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T14:07:19.133

您可能想查看**libero** FSM 生成器软件。从状态描述语言和/或（Windows）状态图编辑器中，您可以为 C、C++、java 和许多其他语言生成代码......加上漂亮的文档和图表。[来自iMatix](http://www.imatix.com/technologies)的源代码和二进制文件

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-05-26T05:47:29.567

我最喜欢的模式之一是状态设计模式。对相同的给定输入集做出不同的响应或行为。
将 switch/case 语句用于状态机的问题之一是，当您创建更多状态时，switch/case 变得更难/难以阅读/维护，促进无组织的意大利面条代码，并且越来越难以在不破坏某些内容的情况下进行更改。我发现使用设计模式可以帮助我更好地组织数据，这就是抽象的重点。与其围绕您来自的状态来设计您的状态代码，不如构建您的代码，以便在您进入新状态时记录状态。这样，您就可以有效地记录您之前的状态。我喜欢@JoshPetit 的回答，并且直接从 GoF 书中采取了他的解决方案：

stateCtxt.h：

```
#define STATE (void *)
typedef enum fsmSignal
{
   eEnter =0,
   eNormal,
   eExit
}FsmSignalT;

typedef struct fsm 
{
   FsmSignalT signal;
   // StateT is an enum that you can define any which way you want
   StateT currentState;
}FsmT;
extern int STATECTXT_Init(void);
/* optionally allow client context to set the target state */
extern STATECTXT_Set(StateT  stateID);
extern void STATECTXT_Handle(void *pvEvent); 
```

stateCtxt.c:

```
#include "stateCtxt.h"
#include "statehandlers.h"

typedef STATE (*pfnStateT)(FsmSignalT signal, void *pvEvent);

static FsmT      fsm;
static pfnStateT UsbState ;

int STATECTXT_Init(void)
{    
    UsbState = State1;
    fsm.signal = eEnter;
    // use an enum for better maintainability
    fsm.currentState = '1';
    (*UsbState)( &fsm, pvEvent);
    return 0;
}

static void ChangeState( FsmT *pFsm, pfnStateT targetState )
{
    // Check to see if the state has changed
    if (targetState  != NULL)
    {
        // Call current state's exit event
        pFsm->signal = eExit;
        STATE dummyState = (*UsbState)( pFsm, pvEvent);

        // Update the State Machine structure
        UsbState = targetState ;

        // Call the new state's enter event
        pFsm->signal = eEnter;            
        dummyState = (*UsbState)( pFsm, pvEvent);
    }
}

void STATECTXT_Handle(void *pvEvent)
{
    pfnStateT newState;

    if (UsbState != NULL)
    {
         fsm.signal = eNormal;
         newState = (*UsbState)( &fsm, pvEvent );
         ChangeState( &fsm, newState );
    }        
}

void STATECTXT_Set(StateT  stateID)
{
     prevState = UsbState;
     switch (stateID) 
     {
         case '1':               
            ChangeState( State1 );
            break;
          case '2':
            ChangeState( State2);
            break;
          case '3':
            ChangeState( State3);
            break;
     }
} 
```

statehandlers.h：

```
/* define state handlers */
extern STATE State1(void);
extern STATE State2(void);
extern STATE State3(void); 
```

statehandlers.c：

```
#include "stateCtxt.h:"

/* Define behaviour to given set of inputs */
STATE State1(FsmT *fsm, void *pvEvent)
{   
    STATE nextState;
    /* do some state specific behaviours 
     * here
     */
    /* fsm->currentState currently contains the previous state
     * just before it gets updated, so you can implement behaviours 
     * which depend on previous state here
     */
    fsm->currentState = '1';
    /* Now, specify the next state
     * to transition to, or return null if you're still waiting for 
     * more stuff to process.  
     */
    switch (fsm->signal)
    {
        case eEnter:
            nextState = State2;
            break;
        case eNormal:
            nextState = null;
            break;
        case eExit:
            nextState = State2;
            break;
    }

    return nextState;
}

STATE  State3(FsmT *fsm, void *pvEvent)
{
    /* do some state specific behaviours 
     * here
     */
    fsm->currentState = '2';
    /* Now, specify the next state
     * to transition to
     */
     return State1;
}

STATE   State2(FsmT *fsm, void *pvEvent)
{   
    /* do some state specific behaviours 
     * here
     */
    fsm->currentState = '3';
    /* Now, specify the next state
     * to transition to
     */
     return State3;
} 
```

对于大多数状态机，尤其是。有限状态机，每个状态都会知道它的下一个状态应该是什么，以及转换到下一个状态的标准。对于松散状态设计，情况可能并非如此，因此可以选择公开 API 以转换状态。如果您需要更多抽象，可以将每个状态处理程序分离到自己的文件中，这相当于 GoF 书中的具体状态处理程序。如果您的设计很简单，只有几个状态，那么为了简单起见，stateCtxt.c 和 statehandlers.c 都可以合并到一个文件中。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-25T13:13:05.397

根据我的经验，使用“switch”语句是处理多种可能状态的标准方法。尽管我很惊讶您将转换值传递给每个状态处理。我认为状态机的全部意义在于每个状态都执行一个动作。然后下一个动作/输入确定要转换到哪个新状态。因此，我希望每个状态处理函数立即执行为进入状态而固定的任何内容，然后再决定是否需要转换到另一个状态。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-25T13:34:21.210

有一本书名为[Practical Statecharts in C/C++](https://rads.stackoverflow.com/amzn/click/com/1578201101)。**但是，对于我们需要的东西来说**，它太重了。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-03-20T08:29:21.863

对于支持的编译器`__COUNTER__`，您可以将它们用于简单（但很大）的状态混搭。

```
 #define START 0      
  #define END 1000

  int run = 1;
  state = START;    
  while(run)
  {
    switch (state)
    {
        case __COUNTER__:
            //do something
            state++;
            break;
        case __COUNTER__:
            //do something
            if (input)
               state = END;
            else
               state++;
            break;
            .
            .
            .
        case __COUNTER__:
            //do something
            if (input)
               state = START;
            else
               state++;
            break;
        case __COUNTER__:
            //do something
            state++;
            break;
        case END:
            //do something
            run = 0;
            state = START;
            break;
        default:
            state++;
            break;
     } 
  } 
```

使用`__COUNTER__`而不是硬编码数字的优点是您可以在其他状态的中间添加状态，而无需每次都重新编号。如果编译器不支持`__COUNTER__`，则可以以有限的方式谨慎使用`__LINE__`

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-08-15T17:18:50.220

您可以在 c 中使用极简的 UML 状态机框架。[https://github.com/kiishor/UML-State-Machine-in-C](https://github.com/kiishor/UML-State-Machine-in-C)

它支持有限和分层状态机。它只有 3 个 API、2 个结构和 1 个枚举。

状态机由`state_machine_t`结构表示。它是一种抽象结构，可以继承来创建状态机。

```
//! Abstract state machine structure
struct state_machine_t
{
   uint32_t Event;          //!< Pending Event for state machine
   const state_t* State;    //!< State of state machine.
}; 
```

状态由指向`state_t`框架中结构的指针表示。

如果框架配置为有限状态机，则`state_t`包含，

```
typedef struct finite_state_t state_t;

// finite state structure
typedef struct finite_state_t{
  state_handler Handler;        //!< State handler function (function pointer)
  state_handler Entry;          //!< Entry action for state (function pointer)
  state_handler Exit;           //!< Exit action for state (function pointer)
}finite_state_t; 
```

该框架提供了一个 API`dispatch_event`来将事件分派到状态机和两个用于状态遍历的​​ API。

```
state_machine_result_t dispatch_event(state_machine_t* const pState_Machine[], uint32_t quantity); 
```

```
state_machine_result_t switch_state(state_machine_t* const, const state_t*);

state_machine_result_t traverse_state(state_machine_t* const, const state_t*); 
```

有关如何实现分层状态机的更多详细信息，请参阅 GitHub 存储库。

代码示例
[https://github.com/kiishor/UML-State-Machine-in-C/blob/master/demo/simple_state_machine/readme.md](https://github.com/kiishor/UML-State-Machine-in-C/blob/master/demo/simple_state_machine/readme.md)
[https://github.com/kiishor/UML-State-Machine-in -C/blob/master/demo/simple_state_machine_enhanced/readme.md](https://github.com/kiishor/UML-State-Machine-in-C/blob/master/demo/simple_state_machine_enhanced/readme.md)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-25T13:23:27.337

在 C++ 中，考虑[状态模式](http://en.wikipedia.org/wiki/State_pattern)。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-10T19:36:23.437

您的问题类似于“是否有典型的数据库实现模式”？答案取决于你想达到什么目标？如果您想实现更大的确定性状态机，您可以使用模型和状态机生成器。示例可在 www.StateSoft.org - SM Gallery 查看。雅努什·多布罗沃尔斯基

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-08-13T17:30:03.657

我也更喜欢表驱动的方法。我过去使用过`switch`语句。我遇到的主要问题是调试转换并确保设计的状态机已正确实现。这发生在存在大量状态和事件的情况下。

使用表驱动方法，状态和转换被汇总在一个地方。

下面是这种方法的演示。

```
/*Demo implementations of State Machines
 *
 * This demo leverages a table driven approach and function pointers
 *
 * Example state machine to be implemented
 *
 *          +-----+      Event1        +-----+      Event2        +-----+
 *    O---->|  A  +------------------->|  B  +------------------->|  C  |
 *          +-----+                    +-----+                    +-----+
 *             ^                                                     |
 *             |                       Event3                        |
 *             +-----------------------------------------------------+
 *
 * States: A, B, C
 * Events: NoEvent (not shown, holding current state), Event1, Event2, Event3
 *
 * Partly leveraged the example here: http://web.archive.org/web/20160808120758/http://www.gedan.net/2009/03/18/finite-state-machine-matrix-style-c-implementation-function-pointers-addon/
 *
 * This sample code can be compiled and run using GCC.
 * >> gcc -o demo_state_machine demo_state_machine.c
 * >> ./demo_state_machine
 */

#include <stdio.h>
#include <assert.h>

// Definitions of state id's, event id's, and function pointer
#define N_STATES  3
#define N_EVENTS  4

typedef enum {
  STATE_A,
  STATE_B,
  STATE_C,
} StateId;

typedef enum {
  NOEVENT,
  EVENT1,
  EVENT2,
  EVENT3,
} Event;
typedef void (*StateRoutine)();

// Assert on number of states and events defined
static_assert(STATE_C==N_STATES-1,
  "Number of states does not match defined number of states");
static_assert(EVENT3==N_EVENTS-1,
  "Number of events does not match defined number of events");

// Defining State, holds both state id and state routine
typedef struct {
    StateId id;
    StateRoutine routine;
}  State;

// General functions
void evaluate_state(Event e);

// State routines to be executed at each state
void state_routine_a(void);
void state_routine_b(void);
void state_routine_c(void);

// Defining each state with associated state routine
const State state_a = {STATE_A, state_routine_a};
const State state_b = {STATE_B, state_routine_b};
const State state_c = {STATE_C, state_routine_c};

// Defning state transition matrix as visualized in the header (events not
// defined, result in mainting the same state)
State state_transition_mat[N_STATES][N_EVENTS] = {
   { state_a, state_b, state_a, state_a},
   { state_b, state_b, state_c, state_b},
   { state_c, state_c, state_c, state_a}};

// Define current state and initialize
State current_state = state_a;

int main()
{
    while(1) {
    // Event to receive from user
    int ev;

    printf("----------------\n");
    printf("Current state: %c\n", current_state.id + 65);
    printf("Event to occur: ");
    // Receive event from user
    scanf("%u", &ev);
    evaluate_state((Event) ev); // typecast to event enumeration type
    printf("-----------------\n");
    };
    return (0);
}

/*
 * Determine state based on event and perform state routine
 */
void evaluate_state(Event ev)
{
    //Determine state based on event
  current_state = state_transition_mat[current_state.id][ev];
  printf("Transitioned to state: %c\n", current_state.id + 65);
    // Run state routine
    (*current_state.routine)();
}

/*
 * State routines
 */
void state_routine_a() {
  printf("State A routine ran. \n");

}
void state_routine_b() {
  printf("State B routine ran. \n");
}
void state_routine_c() {
  printf("State C routine ran. \n");
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2008-09-25T13:11:48.020

Boost 有状态图库。[http://www.boost.org/doc/libs/1_36_0/libs/statechart/doc/index.html](http://www.boost.org/doc/libs/1_36_0/libs/statechart/doc/index.html)

不过，我不能说它的用途。自己没用过（还）

# asp.net - ASP.NET/IIS：所有文件类型为 404

> ID：133225
> 
> 赞同：5
> 
> 时间：2008-09-25T13:10:50.737
> 
> 标签：asp.net, iis, web-config, http-status-code-404, custom-errors

我在 web.config 中设置了 404 处理程序页面，但它仅在 URL 的扩展名是 .aspx（或由 ASP.NET 处理的其他文件）时才有效。我知道我可以在网站选项中设置静态 HTML 页面，但我想要一个页面。是否有任何选项可以为 IIS 中的所有请求扩展分配 ASPX 处理程序页面？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-25T13:18:31.407

直接的问题是是否有选项可以将 ASPX 处理程序分配给所有请求扩展：是的，有。我将很快讨论如何做到这一点。

首先，我认为“隐藏”的问题——你真正想要的答案——是是否有办法重定向除 ASPX、ASMX 等以外的页面的所有 404 错误。是的，有，而且这个**更好**选择它是否可以解决您遇到的问题。

要重定向 IIS 6 中的所有 404，请右键单击您的 Web 应用程序根目录（无论是它自己的站点还是主站点中的虚拟目录），然后选择“属性”。从那里，选择“自定义错误”选项卡。在列表中找到 404 并将其更改为您想要的重定向。

现在，如果这还不够——我真的希望它够——是的，您可以通过 ASPX 处理程序运行每个页面。然而，这样做会在效率方面付出相当高的成本——原始 HTML/图像服务比任何动态服务都要快得多。

为此，请右键单击您的 Web 应用程序根并选择“属性”。选择“主目录”选项卡。点击“配置；” 将弹出一个新窗口。从 ASP.NET 页面服务之一复制路径，然后将其用于通配符应用程序映射。

请记住，大多数时候这是**错误的答案。**它会对您的表现产生负面影响，相当于使用电锯雕刻火鸡。我强烈推荐第一个选项而不是这个选项，如果它适合你的话。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T13:21:18.200

有关信息：

这是 IIS7 带来的几个好处之一 - 所有页面都通过处理程序进行路由，这样您就可以执行自定义 404 并且 - 有用 -*任何*文件的目录和文件级别安全性（基于与 asp 相同的 web.config 内容） IIS7 之前的 .net 文件）。

因此，从概念上讲，“使用 II7”是一个答案（将是“及时”的答案）——但如果您没有托管/托管在 W2k8（或更高版本）上，它当然不是一个非常实用的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T13:13:21.993

web.config 只能为其网站控制的页面设置错误页面。如果您有 ASP.Net 应用程序范围之外的任何其他页面，那么您可以在 IIS 中为它们设置处理。那里有一个用于配置 404 页面的选项，您可以将其指向您的自定义页面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T13:15:16.967

我能想到的唯一另一件事是将所有扩展传递给asp.net。

这样，所有类型的文件都由 asp.net 处理，您的自定义错误页面将正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T13:16:44.653

在 IIS 应用程序配置中，可以设置通配符映射（“.*”）到 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T13:25:37.097

1.  您可以在 IIS 中设置通配符映射（应用程序配置/映射/通配符映射/ - 只需将 aspnet_isapi.dll 设置为可执行文件并取消选中验证文件是否存在框），这会将所有传入请求路由到您的应用程序 - 这样您就可以控制行为直接从它。

2.  您不必在 IIS 应用程序设置中设置静态页面。恕我直言，您应该能够从您的应用程序中设置有效的 url（例如 /error_handler.aspx），在特定服务器错误的情况下将其用作登录页面。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-14T09:40:06.653

在 IIS 中，您可以为 404 错误设置自定义错误并将其定向到站点属性中的 URL。

它默认显示静态 html C:\WINDOWS\help\iisHelp\common\404b.htm

您可以将其更改为您网站上的相对网址。

# asp.net - 服务器端控件属性中的评估脚本

> ID：133226
> 
> 赞同：2
> 
> 时间：2008-09-25T13:11:16.383
> 
> 标签：asp.net, controls, eval

如何在服务器端控件中实现 eval 脚本？

例如。`<a runat="server" href="?id=<%= Eval("Id") %>">hello world</a>`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T13:16:19.600

如果服务器端控件位于数据绑定控件（ListView、GridView、FormView、DetailsView）内，则语法为：`<%# Eval("Id") %>`.

如果服务器端控件不在数据绑定控件中，则必须通过代码隐藏访问它并在那里设置属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T13:14:54.253

据我所知，它的 <%# 而不是 <%=

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T13:15:09.167

数据绑定表达式是您的朋友，请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms178366.aspx)以获取示例。

# java - 如何在带有通配符名称的 Java jar 中发现资源？

> ID：133229
> 
> 赞同：8
> 
> 时间：2008-09-25T13:11:56.773
> 
> 标签：java, classpath

我想发现我的 ClassLoader 使用通配符模式知道的所有 xml 文件。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T11:41:56.407

Spring`ApplicationContext`可以轻松做到这一点：

```
 ApplicationContext context = new ClassPathXmlApplicationContext("applicationConext.xml");
 Resource[] xmlResources = context.getResources("classpath:/**/*.xml"); 
```

请参阅[ResourcePatternResolver#getResources](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/core/io/support/ResourcePatternResolver.html#getResources(java.lang.String)e)或[ApplicationContext](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/context/ApplicationContext.html)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-05-19T21:59:17.343

```
 List<URL> resources = CPScanner.scanResources(new PackageNameFilter("net.sf.corn.cps.sample"), new ResourceNameFilter("A*.xml")); 
```

将代码段放入您的 pom.xml

```
<dependency>
    <groupId>net.sf.corn</groupId>
    <artifactId>corn-cps</artifactId>
    <version>1.0.1</version>
</dependency> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-25T13:28:17.233

它需要一点技巧，但这里有一个相关的[博客条目](http://bill.burkecentral.com/2008/01/14/scanning-java-annotations-at-runtime/)。您首先找出罐子的 URL，然后打开罐子并扫描其内容。我想你会通过查找“/META-INF/MANIFEST.MF”来发现所有 jar 的 URL。目录将是另一回事。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T13:47:54.533

JAR 文件只是另一个 ZIP 文件，对吗？

[所以我想你可以使用http://java.sun.com/javase/6/docs/api/java/util/zip/ZipInputStream.html](http://java.sun.com/javase/6/docs/api/java/util/zip/ZipInputStream.html)来迭代 jar 文件

我在想类似的事情：

`ZipSearcher searcher = new ZipSearcher(new ZipInputStream(new FileInputStream("my.jar"))); List xmlFilenames = searcher.search(new RegexFilenameFilter(".xml$"));`

干杯。基思。

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2008-09-25T13:22:11.413

好吧，它不是来自 Java 内部，而是

`jar -tvf jarname | grep xml$`

将向您展示 jar 中的所有 XML。

# eclipse - 在命令行上构建 Eclipse 插件和功能

> ID：133234
> 
> 赞同：22
> 
> 时间：2008-09-25T13:13:17.580
> 
> 标签：eclipse, eclipse-pde

我有一堆 Eclipse 插件和功能，我想将它们构建为夜间（无头）构建的一部分。我已经设法使用复杂的设置来做到这一点，包括手动指定 Eclipse 插件 jar 的路径、复制 customTargets.xml 等。

真的没有更简单的解决方案吗？有没有办法只指出我的更新站点的 site.xml 并说“构建”；即相当于在更新站点项目中单击“全部构建”？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-08-19T18:35:20.323

*鉴于这个问题的所有答案都是 3-5 岁，我认为更新对其他人有用。*

对于那些想要将 Eclipse 插件构建添加到 CI 流程的人，我建议他们查看[Eclipse Tycho 项目](http://eclipse.org/tycho/)。这本质上是一个 Maven 插件，允许您将 Eclipse 项目包装在 Maven 项目中。有了这个，我们使用 Atlassian Bamboo 来构建我们的 Eclipse 插件。这也允许我们使用 Maven jarsigner 插件来签署我们的插件文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T13:23:10.287

我自己一直在与这个问题作斗争。您在使用 productBuild 脚本吗？也许将您的功能放入产品中会对您有所帮助。

我正在对产品配置进行无头构建。我定制的唯一脚本是将一些 ant 任务添加到 customTargets.xml 以从 SVN 获取我的源代码，并在构建之后对 JNLP 清单进行一些清理，因为我正在使用 WebStart。

然后，您只需在 scripts/productBuild 目录（在 pde-build 插件中）中的开箱即用 productBuild.xml 上调用 antRunner。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T04:30:00.090

查看[Ant4Eclipse](http://ant4eclipse.sourceforge.net/)。我用它来解析 Eclipse 的 .classpath/.project 文件以确定项目依赖项和类路径。结合[Groovy Ant Task](http://groovy.codehaus.org/The+groovy+Ant+Task)，我使用 Eclipse 项目文件在 Ant 中自动构建了多个项目以获取构建信息。

存在[buildPlugin](http://ant4eclipse.sourceforge.net/ant-for-eclipse-reference-buildPlugin.html)任务，但我没有亲自使用过。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T15:17:58.770

我们目前正在使用 PDE 来自动构建功能和我们的完整产品。它工作得很好。确保为产品构建或功能构建使用正确的脚本。 [关于使用 PDE 的 Eclipse 帮助](http://help.eclipse.org/ganymede/nav/4_2)

编辑：我们现在已经迁移到[Buckminster](http://www.eclipse.org/buckminster/)，它具有出色的命令行界面。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T13:18:03.137

您可能会研究 buckminster 和 maven。肯定有一个学习曲线，但他们似乎做得很好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-23T16:41:07.633

我们使用的是 headlesseclipse，可以在 Google Code 上找到：

[http://code.google.com/p/headlesseclipse/](http://code.google.com/p/headlesseclipse/)

它工作得很好，并且可以轻松地自动化插件和功能的命令行构建。但是，我还没有找到一种通过命令行自动构建更新站点的方法。

# asp.net - ASP.Net 会话

> ID：133236
> 
> 赞同：24
> 
> 时间：2008-09-25T13:14:14.397
> 
> 标签：asp.net, session, session-state

我想将用户正在执行的某些操作的“状态”存储在一系列不同的 ASP.Net 网络表单中。我对持久状态的选择是什么，每种解决方案的优缺点是什么？

我一直在使用 Session 对象，并使用一些辅助方法来强类型化对象：

```
 public static Account GetCurrentAccount(HttpSessionState session)
    {
        return (Account)session[ACCOUNT];
    }

    public static void SetCurrentAccount(Account obj, HttpSessionState session)
    {
        session[ACCOUNT] = obj;
    } 
```

许多消息来源告诉我“会话是邪恶的”，所以这确实是这个问题的根本原因。我想知道您认为“最佳实践”是什么，以及为什么。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-25T13:41:41.037

会话状态本身并没有什么坏处。

不过，有几件事情要记住，这可能会咬到你：

1.  如果用户按下浏览器后退按钮，您将返回上一页，但您的会话状态不会恢复。因此，您的 CurrentAccount 可能不是页面上最初的样子。
2.  ASP.NET 进程可以被 IIS 回收。发生这种情况时，您的下一个请求将启动一个新进程。如果您正在使用进程会话状态，默认情况下，它将消失:-(
3.  如果用户有一段时间不活动，会话也可能超时并产生相同的结果。这默认为 20 分钟，所以一顿美味的午餐就可以了。
4.  使用进程外会话状态要求存储在会话状态中的所有对象都是可序列化的。
5.  如果用户打开第二个浏览器窗口，他将期望拥有第二个不同的应用程序，但会话状态很可能会在两个之间共享。因此，在一个浏览器窗口中更改 CurrentAccount 将在另一个浏览器窗口中执行相同的操作。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-25T13:52:45.660

临时存储表单数据的两种选择是，首先，将每个表单的信息存储在会话状态变量中，其次，使用 URL 参数传递表单信息。使用 Cookie 作为潜在的第三种选择根本不可行，原因很简单，您的许多访问者可能会关闭 cookie（但这不会影响会话 cookie）。另外，根据您的问题的性质，我假设您不希望在完全提交之前将此信息存储在数据库表中。

使用会话变量是这个问题的经典解决方案，但它确实存在一些缺点。其中包括 (1) 如果您使用 inproc 会话管理，大量数据可能会耗尽服务器 RAM，(2) 在服务器场中的多个服务器之间共享会话变量需要额外考虑，以及 (3) 专业设计的应用程序必须防止会话过期（不要只转换会话变量并使用它 - 如果会话已过期，则转换将引发错误）。然而，对于绝大多数应用程序来说，会话​​变量无疑是要走的路。

另一种方法是在 URL 中传递每个表单的信息。这种方法的主要问题是您必须非常小心地“传递”信息。例如，如果您在四个页面中收集信息，则需要在第一个页面中收集信息，将其在 URL 中传递到第二个页面，您必须将其存储在该页面的视图状态中。然后，当调用第三个页面时，您将从第二个页面收集表单数据以及视图状态变量，并在 URL 等中进行编码。如果您有五个或更多页面，或者如果访问者将在站点周围跳转，您你手上会一团糟。还要记住，所有信息都需要 A) 序列化为 URL 安全字符串 B) 以防止简单的基于 URL 的黑客攻击的方式编码（例如 如果您将价格以明文形式传递并传递，有人可能会更改价格）。请注意，您可以通过创建一种“会话管理器”并让它为您管理 URL 字符串来减少其中一些问题，但是您仍然必须对任何给定链接可能会破坏某人的整个会话的可能性非常敏感，如果它没有得到妥善管理。

最后，我只使用 URL 变量将非常有限的数据从一个页面传递到下一个页面（例如，在指向该项目的链接中编码的项目 ID）。

那么，让我们假设您确实会使用内置的会话功能来管理用户的数据。为什么有人会告诉你“会话是邪恶的”？好吧，除了上面提到的内存负载、服务器群和过期注意事项之外，对 Session 变量的主要批评是它们实际上是无类型变量。

幸运的是，谨慎使用 Session 变量可以避免内存问题（大项目无论如何都应该保存在数据库中），如果您运行的站点大到需要一个服务器场，那么有很多机制可用于共享 ASP 内置的状态.NET（提示：您不会使用 inproc 存储）。

为了从本质上避免 Session 的所有其他缺点，我建议实现一个对象来保存您的会话数据以及一些简单的 Session 对象管理功能。然后将它们构建到 Page 类的后代中，并将这个后代 Page 类用于所有页面。然后，通过页面类作为一组强类型值访问您的 Session 数据是一件简单的事情。请注意，您的对象字段将为您提供一种以强类型方式访问每个“会话变量”的方法（例如，每个变量一个字段）。

如果这对您来说是一项简单的任务，或者您是否想要一些示例代码，请告诉我！

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-25T13:17:45.167

据我所知，`Session`这是存储此信息的预期方式。请记住，会话状态通常默认存储在进程中。如果您有多个 Web 服务器，或者 IIS 重新启动，您将丢失会话状态。这可以通过使用 ASP.NET 状态服务，甚至是 SQL 数据库来存储会话来解决。这可以确保人们恢复他们的会话，即使他们被重新路由到不同的 Web 服务器，或者在工作进程回收的情况下。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-25T13:17:19.800

至于“会话是邪恶的”......如果你在经典的 ASP 中开发，我不得不同意，但 ASP.NET/IIS 做得更好。

真正的问题是保持状态的最佳方式是什么。在我们的例子中，当涉及到当前登录的用户时，我们将该对象存储在 Session 中，因为我们**不断地**引用它来获取他们的姓名、电子邮件地址、授权等。

其他不需要任何长期持久性的小信息我们使用 cookie 和视图状态的组合**。**

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-25T13:49:00.223

其声名狼藉的原因之一是匆忙的开发人员在 UI 代码中过度使用字符串文字（而不是像你这样的辅助类）作为项目键，并最终得到一大袋不可测试的混杂状态。某种包装器是非恶意会话使用的入门级要求。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-25T13:24:57.723

当您想要在您的 Web 应用程序中存储可以全局访问的信息时，执行此操作的一种方法是`ThreadStatic`属性。这会将 a 的`static`成员`Class`变为由当前线程共享的成员，而不是由其他线程共享的成员。的优点`ThreadStatic`是您不必有可用的网络上下文。例如，如果您有一个不引用的后端`System.Web`，但也想在那里共享信息，您可以`id`在属性中的每个请求的开头设置用户`ThreadStatic`，并在您的依赖项中引用它而无需访问到`Session`对象。

因为它只`static`针对单个线程，所以我们确保其他同时访问者不会得到我们的会话。只要您确保为每个请求都重置该属性，这将有效。这使它成为饼干的理想伴侣。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-25T13:36:18.540

我认为在这种情况下使用 Session 对象是可以的，但是您应该记住，如果长时间没有浏览器活动，Session 可能会过期（[HttpSessionState.Timeout](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.timeout.aspx)属性确定会话状态提供程序在多少分钟内终止会话），所以最好在返回之前检查值是否存在：

```
public static Account GetCurrentAccount(HttpSessionState session)
{
    if (Session[ACCOUNT]!=null)
        return (Account)Session[ACCOUNT];
    else
        throw new Exception("Can't get current account. Session expired.");
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T13:24:35.930

[http://www.tigraine.at/2008/07/17/session-handling-in-aspnet/](http://www.tigraine.at/2008/07/17/session-handling-in-aspnet/)

希望这可以帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-25T13:21:14.627

短期信息，只需要生存到下一个请求，也可以存储在`ViewState`. 这意味着对象被序列化并存储在发送到浏览器的页面中，然后在单击事件或类似事件时将其发送回服务器。然后将`ViewState`其解码并再次变成对象，以备检索。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T13:22:11.287

会话不是邪恶的，它们在 ASP.NET 应用程序中提供重要功能，提供在用户“会话”期间必须在多个页面之间共享的数据。有一些建议，我想说尽可能使用 SQL 会话管理，并确保您在会话集合中使用的对象是“可序列化的”。最佳实践是在绝对需要跨页面共享状态信息时使用会话对象，而在不需要时不要使用它。信息不会在客户端可用，会话密钥要么保存在 cookie 中，要么通过查询字符串保存，或者根据配置方式使用其他方法，然后会话对象在数据库表中可用（除非你使用 InProc，

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-25T13:24:40.673

Session as evil：不在 ASP.NET 中，正确配置。是的，尽可能地无国籍是理想的，但现实是你无法从这里到达那里。但是，您可以使 Session 以减轻其影响的方式运行——特别是 StateServer 或数据库会话。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-25T13:37:29.283

我认为“邪恶”来自过度使用会话。如果你只是把任何东西都粘在里面（比如对所有东西都使用全局变量），你最终会表现不佳并且一团糟。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T20:53:39.987

Anything you put in the session object stays there for the duration of the session unless it is cleaned up. Poor management of memory stored using inproc and stateserver will force you to scale out earlier than necessary. Store only an ID for the session/user in the session and load what is needed into the cache object on demand using a helper class. That way you can fine tune it's lifetime according to how often that data us used. The next version of asp.net may have a distributed cache(rumor).

# iphone - UITextView 中的文本不显示在 UIScrollView 中

> ID：133243
> 
> 赞同：1
> 
> 时间：2008-09-25T13:15:08.607
> 
> 标签：iphone, cocoa-touch, uitextview

我想要一个`UIScrollView`带有一组子视图的子视图，其中每个子视图都有`UITextView`一个不同的文本。对于这个任务，我修改了`PageControl`苹果“iphone dev center”中的示例，以便将其添加`UITextView`到用于生成滚动视图的子视图的简单视图中。当我运行应用程序（在模拟器和手机上）时，没有看到文本，但如果我激活“用户交互”并单击它，文本会神奇地出现（以及键盘）。

有没有人有解决方案或在`UITextView`内部取得任何进展`UIScrollView`？谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-05-05T14:00:37.877

我解决了强制“假”滚动的问题：

```
textView.contentOffset = CGPointMake(0, 1);
textView.contentOffset = CGPointMake(0, 0); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T04:06:18.223

我认为问题源于它`UITextView`是 的子类`UIScrollView`，因此您基本上将滚动视图嵌入其中`UIScrollViews`。即使文本正确显示，您也会遇到可用性问题，因为如果手指滑动应该滚动外部视图或文本视图，则永远不会清楚。

是的，Safari 有点这样做，但它必须这样做，而且这不是使用 Safari 最令人愉快的部分。

我认为这是困难表明您正在与系统作对的时候之一。我强烈建议回去重新考虑 UI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T11:46:17.413

当 UITextView 从屏幕外滚动到屏幕区域时，您可能会遇到 UITextView 无法正确更新的问题。

检查此页面的“屏幕外 UITextViews 未正确更新”部分：[UIScrollView 中的多个虚拟页面](http://cocoawithlove.com/2009/01/multiple-virtual-pages-in-uiscrollview.html)

我使用的解决方案是在滚动视图开始出现在屏幕上时强制重绘它们。这是一个完全令人讨厌的问题，但确实解决了问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T11:16:27.920

问题很可能是下一个`UIScrollViews`。

我认为有三种解决方案：

*   `userInteractionEnabled`选择各种控件时启用和禁用。
*   假设文本是静态的，使用 a`UILabel`而不是 a `UITextView`(`UILabel`不是 的子类`UIScrollView`)
*   实现您自己的视图并自己在 drawRect 消息中绘制文本，而不是依赖`UITextView`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-30T06:49:07.257

我对这个问题的解决方案是不同的：它只有在我将 UIScrollView 的“Autoresize Subviews”属性设置为关闭时才有效。

```
[scrollView setAutoresizesSubviews:NO]; 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-15T09:52:05.283

通过将文本值分配放入**scrollViewDidScroll**方法，它对我有用。

示例片段：

* * *

样品.h

```
...
@interface myRootUIViewController : UIViewController <UIScrollViewDelegate>
... 
```

* * *

评论：请记住：不要忘记 UIScrollViewDelegate 协议。

* * *

样品.m

```
 - (void)viewDidLoad {
       ... whatever is created before and/or after...

       NSString * text = @"Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                           Nunc semper lacus quis erat. Cras sapien magna, porta non, 
                           suscipit nec, egestas in, arcu. Maecenas sit amet est. 
                           Quisque felis risus, tempor eu, dictum ac, volutpat id, 
                           libero. Ut gravida, purus vitae interdum elementum, tortor 
                           justo porttitor nisi, id rhoncus massa.";

       // calculate the required frame height according to defined font size and
       // given text
       CGRect frame = CGRectMake(0.0, 500.0, self.view.bounds.size.width, 1000.0); 
       CGSize calcSize = [text sizeWithFont:[UIFont systemFontOfSize:13.0]
              constrainedToSize:frame.size lineBreakMode: UILineBreakModeWordWrap];
              // for whatever reasons, contraintedToSize seem only be able to
              // calculate an appropriate height if the input frame height is larger
              // than required. Means: if your text requires height=250 and input
              // frame height=100, then this method won't give you the expected
              // result.

       frame.size = calcSize;
       frame.size.height += 0; // calcSize might be not pixel-precise, 
                               // so add here additional padding pixels
       UITextView * tmpTextView = [[UITextView alloc]initWithFrame:frame];

       // do whatever adjustments
       tmpTextView.backgroundColor = [UIColor blueColor]; // show area explicitly (dev 
                                                          // purpose)
       self.myTextView = tmpTextView;
       self.myTextView.editable = NO;
       self.myTextView.scrollEnabled = NO;
       self.myTextView.multipleTouchEnabled = NO;
       self.myTextView.userInteractionEnabled = NO; // pass on events to parentview
       self.myTextView.font = [UIFont systemFontOfSize:13.0];
       [tmpTextView release];
       [self.scrollView addSubview:self.myTextView];
}

...

- (void)scrollViewDidScroll:(UIScrollView *)sender {
  // for simplicity text is repeated again, of course it can be a member var/etc...
  NSString * text = @"Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                           Nunc semper lacus quis erat. Cras sapien magna, porta non, 
                           suscipit nec, egestas in, arcu. Maecenas sit amet est. 
                           Quisque felis risus, tempor eu, dictum ac, volutpat id, 
                           libero. Ut gravida, purus vitae interdum elementum, tortor 
                           justo porttitor nisi, id rhoncus massa.";
  self.myTextView.text = text; // assign value within this method and it is
                               // painted as expected.
    } 
```

* * *

评论：

我显然已经用示例命名和值调整了源代码片段。希望没有错别字。但是，代码还包含文本所需帧高度的计算，以防文本的值可以更改，因此实际上需要不同的帧大小。

将实际的文本值分配到 scrollViewDidScroll 方法对我有用，在滚动等期间没有任何闪烁（到目前为止仅在 iPhone 模拟器中测试过）。

希望有帮助。当然，我愿意接受任何建设性的反馈、改进建议或什至其他解决此问题的方法。

# c# - 说明 C# 中 volatile 关键字的用法

> ID：133270
> 
> 赞同：89
> 
> 时间：2008-09-25T13:20:03.727
> 
> 标签：c#, .net, volatile

我想编写一个小程序，直观地说明`volatile`关键字的行为。理想情况下，它应该是一个对非易失性静态字段执行并发访问并因此获得不正确行为的程序。

在同一个程序中添加 volatile 关键字应该可以解决问题。

那是我没能做到的。即使尝试了几次，启用优化等，我总是能在没有“volatile”关键字的情况下得到正确的行为。

你对这个话题有什么想法吗？你知道如何在一个简单的演示应用程序中模拟这样的问题吗？它取决于硬件吗？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-08-16T10:50:07.700

我已经实现了一个工作示例！

主要思想来自 wiki，但对 C# 进行了一些更改。wiki文章为C++的静态字段演示了这一点，看起来C#总是仔细地编译对静态字段的请求......我用非静态的做例子：

如果您在**Release**模式下运行此示例并且**没有调试器**（即使用 Ctrl+F5），那么该行将`while (test.foo != 255)`被优化为“while(true)”并且该程序永远不会返回。但是添加`volatile`关键字后，您总是会得到“确定”。

```
class Test
{
    /*volatile*/ int foo;

    static void Main()
    {
        var test = new Test();

        new Thread(delegate() { Thread.Sleep(500); test.foo = 255; }).Start();

        while (test.foo != 255) ;
        Console.WriteLine("OK");
    }
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-25T13:32:47.313

是的，它取决于硬件（如果没有多个处理器，您不太可能看到问题），但它也取决于实现。CLR 规范中的内存模型规范允许 CLR 的 Microsoft 实现不一定要做的事情。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T13:36:20.147

当没有指定 'volatile' 关键字时，这并不是真正的故障问题，更多的是在没有指定时可能会发生错误。通常，您会比编译器更好地知道这种情况！

考虑它的最简单方法是编译器可以，如果它愿意，内联某些值。通过将值标记为 volatile，您是在告诉自己和编译器该值实际上可能会发生变化（即使编译器不这么认为）。这意味着编译器不应内联值、保留缓存或提前读取值（以尝试优化）。

这种行为实际上与 C++ 中的关键字不同。

[MSDN在这里](http://msdn.microsoft.com/en-us/library/aa645755.aspx)有一个简短的描述。[这是一篇关于易失性、原子性和联锁](http://www.yoda.arachsys.com/csharp/threads/volatility.shtml)主题的更深入的帖子

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-25T13:57:50.250

在 C# 中很难演示，因为代码是由虚拟机抽象出来的，因此在这台机器的一个实现上，它可以在没有 volatile 的情况下正常工作，而在另一个实现上可能会失败。

[不过，Wikipedia 有一个很好的例子，如何用 C 来演示它。](http://en.wikipedia.org/wiki/Volatile_variable)

如果 JIT 编译器决定变量的值无论如何都不能改变，因此在 C# 中可能会发生同样的事情，从而创建甚至不再检查它的机器代码。如果现在另一个线程正在更改该值，则您的第一个线程可能仍会陷入循环。

[另一个例子是忙碌等待。](http://en.wikipedia.org/wiki/Busy_waiting)

同样，这也可能发生在 C# 上，但它在很大程度上取决于虚拟机和 JIT 编译器（或解释器，如果它没有 JIT ......理论上，我认为 MS 总是使用 JIT 编译器，Mono 也使用一个；但您可以手动禁用它）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-11-09T01:18:04.213

这是我对这种行为的集体理解的贡献......这并不多，只是一个演示（基于 xkip 的演示），它显示了易失性与非易失性（即“正常”）int值的行为，并排-side，在同一个程序中......这就是我找到这个线程时正在寻找的东西。

```
using System;
using System.Threading;

namespace VolatileTest
{
  class VolatileTest 
  {
    private volatile int _volatileInt;
    public void Run() {
      new Thread(delegate() { Thread.Sleep(500); _volatileInt = 1; }).Start();
      while ( _volatileInt != 1 ) 
        ; // Do nothing
      Console.WriteLine("_volatileInt="+_volatileInt);
    }
  }

  class NormalTest 
  {
    private int _normalInt;
    public void Run() {
      new Thread(delegate() { Thread.Sleep(500); _normalInt = 1; }).Start();
      // NOTE: Program hangs here in Release mode only (not Debug mode).
      // See: http://stackoverflow.com/questions/133270/illustrating-usage-of-the-volatile-keyword-in-c-sharp
      // for an explanation of why. The short answer is because the
      // compiler optimisation caches _normalInt on a register, so
      // it never re-reads the value of the _normalInt variable, so
      // it never sees the modified value. Ergo: while ( true )!!!!
      while ( _normalInt != 1 ) 
        ; // Do nothing
      Console.WriteLine("_normalInt="+_normalInt);
    }
  }

  class Program
  {
    static void Main() {
#if DEBUG
      Console.WriteLine("You must run this program in Release mode to reproduce the problem!");
#endif
      new VolatileTest().Run();
      Console.WriteLine("This program will now hang!");
      new NormalTest().Run();
    }

  }
} 
```

上面有一些非常简洁的解释，以及一些很好的参考资料。感谢所有人帮助我解决`volatile`问题（至少知道不要依赖`volatile`我的第一直觉`lock`）。

干杯，感谢所有的鱼。基思。

* * *

**PS：**我会对原始请求的演示非常感兴趣，它是：“我希望看到***静态****volatile int**在****静态****int*行为不端*的***地方正确运行。**

 ****我已经尝试过并且失败了这个挑战。（实际上我很快就放弃了；-）。在我尝试使用静态变量的所有内容中，无论它们是否*易变*，它们的行为都“正确”......我很想解释为什么会这样，如果确实如此......是这样吗？编译器不会在寄存器中缓存静态变量的*值*（即，它会缓存对该堆地址的*引用）？*

不，这不是一个新问题......这是试图让社区*回到*原来的问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-02-04T15:23:07.057

我遇到了乔·阿尔巴哈里（Joe Albahari）的以下文字，对我有很大帮助。

*   [内存屏障和波动性](http://www.albahari.com/threading/part4.aspx#_Memory_Barriers_and_Volatility)

我从上面的文本中获取了一个示例，我通过创建一个静态易失字段进行了一些更改。当您删除`volatile`关键字时，程序将无限期地阻塞。**在发布**模式下运行此示例。

```
class Program
{
    public static volatile bool complete = false;

    private static void Main()
    {           
        var t = new Thread(() =>
        {
            bool toggle = false;
            while (!complete) toggle = !toggle;
        });

        t.Start();
        Thread.Sleep(1000); //let the other thread spin up
        complete = true;
        t.Join(); // Blocks indefinitely when you remove volatile
    }
} 
```

# asp.net - 我必须在 ASP.NET 中使用 Viewstate

> ID：133277
> 
> 赞同：4
> 
> 时间：2008-09-25T13:22:08.667
> 
> 标签：asp.net, vb.net, visual-studio, viewstate, state

我正在从经典的 ASP 迁移到 ASP.NET，并且遇到了你们许多人已经知道的“视图状态”。我的假设可能会过激，但它看起来非常麻烦。过去我开发了许多 ASP 表单，并且从未遇到过保持状态的问题。有没有其他方法或者我必须在 ASP.NET 中学习这个 Viewstate 的东西？我使用 Visual Studio 2008、VB.NET 作为语言背后的代码，以及带有 SQL Server 2005 的 Framework v3.5。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T13:24:40.360

你不必。查看[MVC 框架](http://www.asp.net/mvc/)。它消除了 ViewState 并像旧的 ASP 一样工作（至少从这个角度来看）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-25T18:41:15.390

[本系列文章是理解 ViewState 的必读文章](http://weblogs.asp.net/infinitiesloop/archive/2006/08/03/truly-understanding-viewstate.aspx)

我禁用它并在 Page_Init 而不是 Load 中完成大部分工作（由于 ControlState，值仍然保持不变）。这个设置对我来说效果很好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-25T18:35:16.137

ViewState 是可选的，但很有帮助。ViewState 是发生在服务器端控件上的所有更改。因此，如果您将文本分配给标签，并且您希望该文本持续存在而不需要在每次回发时重新分配它，那么您将需要维护它。另一个我总是打开 ViewState 的例子是任何数据绑定。

也就是说，出于同样的原因，有时关闭 ViewState 会很有帮助。例如，我**总是**关闭 ViewState 的一个地方是 MESSAGE 标签。这样，当我必须向用户打印一条消息（一条应该只出现一次然后消失的消息）时，我只需将文本添加到标签中然后忘记它。在下一次 PostBack 期间，标签将自动恢复为在该控件的 ASPX 声明中找到的文本（在本例中为空字符串）。

现在，请注意这与表单集合无关，表单集合是在 PostBack 期间发布到 IIS 的值。表单集合将用户输入的值发送到表单元素（文本框、复选框、下拉列表等）中。这些 .NET 将填充到适当的位置——这发生在处理 ViewState*之后。*

这样，如果您向客户端发送带有短语“hi there”的文本框，用户将其更改为“See ya”，然后提交表单，那么在 Page_Load 事件触发时文本框将拥有一个文本框TEXT 属性中的“See ya”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T13:23:38.257

在经典的 ASP 中，我们总是只使用一个 HIDDEN 字段来完成这项工作。Viewstate 只是自动为您执行此操作的一种方式。相信我，学习曲线并不像你想象的那么高。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-25T13:27:11.667

当您关闭 ViewState 时，某些控件会严重受损，因此请准备好解决这些问题。最简单的做法是懒惰并保持打开状态，但如果不加以检查，ViewState 很容易占 HTML 大小的 30%。

例如，假设您有一个 DropDown，并将其绑定到一个 Fruits 列表。在页面加载的 if(!IsPostBack) { } 块中绑定它。如果关闭 ViewState，单击按钮时将丢失项目。他们需要绑定每个页面加载。您还将丢失您选择的索引，因此您需要将其从 Request.Form[] 变量中移除。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T13:27:36.780

当您使用 ASP.NET 时，Viewstate 是包的一部分。对于基本页面/网站，您不必“知道”如何使用 Viewstate。当您在页面上放置控件时，它就会被使用。

使用 ASP.NET 很难避免 Viewstate，因为即使您在项目级别将其关闭，某些单独的控件仍然使用 Viewstate 来保存其信息。

如果您不想处理 Viewstate，请考虑使用 ASP.NET MVC 框架。您可能会对来自 Classic ASP 的 MVC 框架更满意。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-25T13:23:43.327

ViewState 在几乎所有情况下都是完全可选的。即使 ViewStateEnabled=false，ASP.NET 也会自动重新填充字段。我使用 ASP.NET 已经 5 或 6 年了，从来没有依赖过 ViewState。我什至尽可能禁用它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T13:33:13.663

ViewState 在大多数情况下是自动工作的。这就是 ASP.NET 跟踪其所有控件的当前状态的方式。

如果您想存储一些额外的数据，您也可以手动使用视图状态。这很简单：

```
Viewstate["Key"] = value; 
```

唯一需要注意的是，您存储在视图状态中的任何对象都必须是可序列化的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T14:38:34.660

我绝对可以建议避免在 DataGrids 和 DropDownLists 中使用 ViewState，因为我自己最近才开始这样做。我这样做不是为了好玩，我必须修复一个已经变得如此之大以至于导致其他问题的页面。但事实证明这很容易，结果如此戏剧性，我很高兴。当然，对于一个小型的简单应用程序或少量数据，这不是必需的，但另一方面，保持一致是件好事（总是从已知到已知，这样您就可以不断改进您的流程......），以及为什么随身携带额外的行李，曾经吗？

这将需要您进行一些手动干预。例如，如果您关闭下拉列表的视图状态，则需要在每次回发时重新绑定它们，然后从 Request 对象中恢复 SelectedValue。你需要阅读这个，但谷歌有很多现成的信息。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T13:25:39.860

对于“植根”到页面的 asp.net 控件，视图状态会自动保留。您几乎不需要做任何事情，值和其他一些信息在隐藏输入 B64 编码中传递。如果你愿意，你可以看它，但没关系，这一切都是为你自动处理的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-25T13:34:24.253

如果您正在为自己的消费编写代码，您可以将其关闭而不必担心。

假设您要维护其他人编写的 Web 窗体代码，因此您应该知道配置选项和痛点是什么。我能想到的前几名

*   如何在站点、页面和控制级别禁用它
*   为什么 MachineKey 与网络农场相关
*   为什么您的事件日志充满了 ViewStateAuthentication 错误
*   ViewStateUserKey 是什么

就实际学习曲线而言，这可能是对几篇 MSDN 文章的透彻阅读。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-25T13:40:56.500

ViewState 是 Web 表单隐喻固有的必要邪恶。我个人认为这种方法已经过时、臃肿而且通常对网络不友好。最好按照上面的建议检查 MVC 框架。

我建议您避免使用 ViewState 作为“缓存”来来回传递数据的诱惑（我已经看到网站这样做是因为集群设置和没有 SQL 支持的会话状态）。数据被序列化并添加到页面中，并且必须在每个请求中进行往返，这会增加页面的总大小并使您的站点加载速度变慢。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-12-05T07:23:42.807

```
'<%@ Control Language="C#" AutoEventWireup="true" CodeFile="HomePage.ascx.cs" Inherits="HomePage" %>
<script runat="server">
  void testHF_ValueChanged(object sender, EventArgs e)
    {
       this.HFvalue.Text = this.testHF.Value ;

    }
</script>
<asp:Label ID="UserNamelbl" runat="server" Text="User Name : " Visible="false"></asp:Label>
<asp:TextBox ID="UserNametxt" runat="server" Visible="false" ></asp:TextBox>
 <asp:Label ID="HFvalue" Text="......" runat="server"></asp:Label>
 <asp:HiddenField ID="testHF"
OnValueChanged="testHF_ValueChanged"
value="" 
runat="server" ></asp:HiddenField>
<input type="submit" name="SubmitButton" value="Submit" onclick="CL()" />

<script type="text/javascript">
    function CL() 
    {
        this.testHF.Value = this.UserNametxt.Text;  
    }
</script>
' 
```

# orm - .NET 3.5 的 Castle-ActiveRecord 教程坏了？

> ID：133281
> 
> 赞同：1
> 
> 时间：2008-09-25T13:22:12.363
> 
> 标签：orm, .net-3.5, documentation, castle-activerecord

有没有人尝试过使用 C# 3.5的 ActiveRecord[介绍示例？](http://www.castleproject.org/activerecord/gettingstarted/index.html)我不知何故感觉样本完全错误或过时了。XML 配置完全错误：

```
<add key="connection.connection_string" value="xxx" /> 
```

应该 ：

```
<add key="hibernate.connection.connection_string" value="xxx" /> 
```

（如果我理解 nhibernate 配置语法正确..）

我想知道我做错了什么。在用户模型上调用 Count() 时出现“无法为用户执行 ExecuteQuery”异常。

不知道这可能是什么。教程源代码与页面上的源代码有很大不同（最明显的是 XML 配置），它是一个 VS2003 示例，在大多数情况下具有不同的语法（没有泛型等）。

有什么建议么？ActiveRecord 看起来很棒..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T13:29:56.417

NHibernate 2.0 版中删除了密钥的“休眠”部分。此版本适用于 NHibernate 2.0 及更高版本：

```
<add key="connection.connection_string" value="xxx" /> 
```

编辑：我看到快速入门没有附带 Castle 和 NHibernate 的二进制文件。您一定是从某个地方下载了二进制文件；如果您能提供您的 NHibernate.dll 文件的版本号，将会很有帮助。

令人困惑的是，至少一些快速入门已经更新为最新的 NHibernate (NH) 2.0，但最新的“正确”Castle 版本仍然是 1.0 RC3（现在差不多一年了），其中不包括 NH 2.0。

你可以走两条路。您可以继续使用 Castle RC3，在这种情况下，您确实需要在配置条目中添加“休眠”前缀。或者，您可以从主干下载 Castle 的[构建](http://builds.castleproject.org/)，它应该针对 NH 2.0 运行。后一种方法的问题在于，NH 2.0 中引入的其他一些重大更改可能无法在快速启动中修复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T13:40:52.287

（这对于评论帖子来说太长了）

[@Tigraine] 从您对我之前的回答的评论看来，错误不在于配置，而在于您的一个实体。删除“休眠”更正了配置，以便它为您提供真正的错误，这似乎是实体“发布”没有正确归因于 ActiveRecord 以创建其映射。

如果您进一步了解它给出的错误，它可能有一些关于“发布”失败的细节。

一些常见的事情包括：

*   该类没有该`[ActiveRecord]`属性。
*   该属性没有`[PrimaryKey]`属性。
*   没有名为“Post”的匹配表（如果`PluralizeTableNames`为“true”，则为“Posts”）。
*   属性属性没有匹配的列。
*   您的属性属性和公共方法不是`virtual`（这个总是让我很生气）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T13:25:44.290

删除`hibernate.`所有配置条目的“”部分。你的第一个例子是正确的。

# java - JTAPI API 有模拟器吗？

> ID：133282
> 
> 赞同：1
> 
> 时间：2008-09-25T13:22:38.820
> 
> 标签：java, unit-testing, testing, jtapi

我们要测试应用程序的 JTAPI 功能。是否有可用的 JTAPI 模拟器？使用真实硬件进行测试有点困难。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T13:29:16.903

[gjtapi](http://gjtapi.sourceforge.net/)似乎有一个。

# c# - 发送电子邮件时的线程

> ID：133287
> 
> 赞同：4
> 
> 时间：2008-09-25T13:23:30.863
> 
> 标签：c#, multithreading, email

我有一个发送电子邮件的简单功能，我将如何使用线程来加快电子邮件传递？

示例代码将是理想的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T13:24:26.180

代替使用 SendAsync。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T13:33:46.003

查看以下链接以获取 sendAsync 方法的演示。[MSDN]

[http://msdn.microsoft.com/en-ca/library/x5x13z6h(VS.80).aspx](http://msdn.microsoft.com/en-ca/library/x5x13z6h(VS.80).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T13:34:25.563

您可以在另一个线程中运行该函数。作为 SendMail 您的邮件发件人功能，您可以：

```
ThreadPool.QueueUserWorkItem(delegate { SendMail(message); }); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-01-30T11:01:19.613

在 4.0 中，您可以使用以下内容，

```
new Thread(x => SendMail(message)).Start(); 
```

和

```
public static void SendEmail(MailMessage message)
{
    using (SmtpClient client = new SmtpClient("smtp.XXXXXX.com"))
    {
        client.Send(message);
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T13:28:37.357

使用静态 void 方法创建您的类，这将使您的类开始在单独的线程上执行您想要执行的操作，例如：

```
using System;
using System.Threading;

class Test
{
    static void Main() 
    {
        Thread newThread =  new Thread(new ThreadStart(Work.DoWork));
        newThread.Start();
    }
}

class Work 
{
    Work() {}
    public static void DoWork() {}
} 
```

如果您不想自己管理线程，另一种选择是使用 ThreadPool 类。

有关线程的更多信息 - [http://msdn.microsoft.com/en-us/library/xx3ezzs2.aspx](http://msdn.microsoft.com/en-us/library/xx3ezzs2.aspx)

有关 ThreadPool 的更多信息 - [http://msdn.microsoft.com/en-us/library/3dasc8as(VS.80).aspx](http://msdn.microsoft.com/en-us/library/3dasc8as(VS.80).aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T13:30:48.613

但是，拥有单独的线程不会加快电子邮件的传递速度。它所要做的就是更快地将控制权返回给调用方法。所以除非你需要这样做，否则我什至不会打扰它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T14:08:13.203

当您使用多个线程发送电子邮件时，请注意不要被您的 isp 识别为垃圾邮件。最好选择较小的批次，每批次之间有一些延迟。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-25T13:31:19.423

你知道更好更容易的是创建一个应用程序后端并每 30 分钟发送一次电子邮件。将信息放入您需要发送到那里和从那里发送出去的数据库中，创建一个每 30 分钟启动一次的应用程序池。当它启动时，您可以发送电子邮件。无需等待您的事件处理程序发送电子邮件...

它对我们有用。只是认为它会对你有所帮助。

# php - CodeIgniter 中的子文件夹

> ID：133308
> 
> 赞同：3
> 
> 时间：2008-09-25T13:26:22.400
> 
> 标签：php, codeigniter, admin

我是 CodeIgniter 的新手，我需要一些帮助。我想实现以下内容：

*   通过以下方式查看用户的个人资料：http://localhost/profile/johndoe

*   通过以下方式管理用户的个人资料：http://localhost/admin/profile/johndoe

*   能够通过以下方式完成进一步的处理： http://localhost/admin/profile/create ...和... http://localhost/admin/profile/edit/johndoe

我已经创建了管理对象并对其进行了保护。我是否必须在管理员下创建配置文件功能，并使用 URI 进行相应处理？有没有更好的办法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T15:25:58.993

这不是一个好主意。

如果要实现这些 URL，则需要两个控制器：

1.  配置文件，具有功能`index`
2.  管理员，具有功能`profile`

在 Admin 中，该`profile`函数必须读取第一个参数 (create/edit/[userid])，然后执行相应的操作。（您还必须确保没有用户可以称自己为“创建”或“编辑”。）

相反，我将只使用一个具有功能`show`、、`edit`和`create`（或`add`）的控制器。容易得多。然后你会得到这些 URL：

*   http://localhost/profile/show/johndoe
*   http://localhost/profile/edit/johndoe
*   http://localhost/profile/create/johndoe

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T19:34:02.047

我找到了我正在寻找的解决方案：http: [//www.clipmarks.com/clipmark/75D02C9E-3E76-483E-8CCE-30403D891969/](http://www.clipmarks.com/clipmark/75D02C9E-3E76-483E-8CCE-30403D891969/)

谢谢，Christian D，我比我更喜欢你的解决方案。我会去的。

# javascript - 如何让 jQuery 执行同步而不是异步的 Ajax 请求？

> ID：133310
> 
> 赞同：1289
> 
> 时间：2008-09-25T13:26:54.193
> 
> 标签：javascript, jquery, ajax, asynchronous

我有一个提供标准扩展点的 JavaScript 小部件。其中之一是`beforecreate`功能。它应该返回`false`以防止创建项目。

我已经使用 jQuery 在这个函数中添加了一个 Ajax 调用：

```
beforecreate: function (node, targetNode, type, to) {
  jQuery.get('http://example.com/catalog/create/' + targetNode.id + '?name=' + encode(to.inp[0].value),

  function (result) {
    if (result.isOk == false) 
        alert(result.message);
  });
} 
```

但我想阻止我的小部件创建项目，所以我应该`false`在母函数中返回，而不是在回调中。有没有办法使用 jQuery 或任何其他浏览器内 API 执行同步 AJAX 请求？

* * *

## 回答 #1

> 赞同：1224
> 
> 时间：2008-09-25T13:30:37.290

从[jQuery 文档](https://api.jquery.com/jquery.ajax/)中：您将**异步**选项指定为**false**以获取同步 Ajax 请求。然后你的回调可以在你的母亲函数继续之前设置一些数据。

如果按照建议进行更改，您的代码将如下所示：

```
beforecreate: function (node, targetNode, type, to) {
    jQuery.ajax({
        url: 'http://example.com/catalog/create/' + targetNode.id + '?name=' + encode(to.inp[0].value),
        success: function (result) {
            if (result.isOk == false) alert(result.message);
        },
        async: false
    });
} 
```

* * *

## 回答 #2

> 赞同：270
> 
> 时间：2011-04-12T21:45:44.857

您可以通过调用将 jQuery 的 Ajax 设置置于同步模式

```
jQuery.ajaxSetup({async:false}); 
```

然后使用执行您的 Ajax 调用`jQuery.get( ... );`

然后再打开一次

```
jQuery.ajaxSetup({async:true}); 
```

我猜它的效果与@Adam 所建议的相同，但它可能对那些想要重新配置他们`jQuery.get()`或`jQuery.post()`更复杂的`jQuery.ajax()`语法的人有所帮助。

* * *

## 回答 #3

> 赞同：144
> 
> 时间：2010-04-07T13:30:16.010

优秀的解决方案！我注意到当我尝试实现它时，如果我在成功子句中返回一个值，它会以未定义的形式返回。我必须将它存储在一个变量中并返回该变量。这是我想出的方法：

```
function getWhatever() {
  // strUrl is whatever URL you need to call
  var strUrl = "", strReturn = "";

  jQuery.ajax({
    url: strUrl,
    success: function(html) {
      strReturn = html;
    },
    async:false
  });

  return strReturn;
} 
```

* * *

## 回答 #4

> 赞同：89
> 
> 时间：2012-04-28T17:41:39.133

所有这些答案都忽略了使用 async:false 进行 Ajax 调用将导致浏览器挂起直到 Ajax 请求完成这一点。使用流控制库将解决这个问题，而不会挂起浏览器。这是[Frame.js](https://github.com/bishopZ/Frame.js)的示例：

```
beforecreate: function(node,targetNode,type,to) {

    Frame(function(next)){

        jQuery.get('http://example.com/catalog/create/', next);
    });

    Frame(function(next, response)){

        alert(response);
        next();
    });

    Frame.init();
} 
```

* * *

## 回答 #5

> 赞同：53
> 
> 时间：2012-04-25T15:34:38.047

```
function getURL(url){
    return $.ajax({
        type: "GET",
        url: url,
        cache: false,
        async: false
    }).responseText;
}

//example use
var msg=getURL("message.php");
alert(msg); 
```

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2016-12-13T12:55:38.410

`async: false`注意：由于此警告消息，您不应使用：

> 从 Gecko 30.0 (Firefox 30.0 / Thunderbird 30.0 / SeaMonkey 2.27) 开始，由于对用户体验的负面影响，主线程上的同步请求已被弃用。

Chrome 甚至在控制台中对此发出警告：

> 主线程上的同步 XMLHttpRequest 已被弃用，因为它会对最终用户的体验产生不利影响。如需更多帮助，请查看[https://xhr.spec.whatwg.org/](https://xhr.spec.whatwg.org/)。

如果您正在做这样的事情，这可能会破坏您的页面，因为它可能会在任何一天停止工作。

如果你想以一种仍然感觉它是同步的但仍然不阻塞的方式来做，那么你应该使用 async/await 并且可能还有一些基于新[Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) API之类的承诺的 ajax

```
async function foo() {
  var res = await fetch(url)
  console.log(res.ok)
  var json = await res.json()
  console.log(json)
} 
```

**编辑** chrome 正在处理当页面被用户导航离开或关闭时，在页面关闭[中禁止同步 XHR 。](https://www.chromestatus.com/features/4664843055398912)这涉及到 beforeunload、unload、pagehide 和 visibilitychange。

如果这是您的用例，那么您可能想看看[navigator.sendBeacon](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon)

页面也可以使用 http 标头或 iframe 的允许属性禁用同步请求

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2015-05-10T06:28:53.557

请记住，如果您正在执行跨域 Ajax 调用（通过使用[JSONP](https://stackoverflow.com/a/3506306/56621)） - 您**不能**同步执行此操作，`async`jQuery 将忽略该标志。

```
$.ajax({
    url: "testserver.php",
    dataType: 'jsonp', // jsonp
    async: false //IGNORED!!
}); 
```

对于 JSONP 调用，您可以使用：

1.  Ajax 调用到您自己的域 - 并在服务器端进行跨域调用
2.  更改您的代码以异步工作
3.  使用像 Frame.js 这样的“函数排序器”库（这个[答案](https://stackoverflow.com/a/10365952/1785164)）
4.  阻止 UI 而不是阻止执行（这个[答案](https://stackoverflow.com/a/134810/1785164)）（我最喜欢的方式）

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2014-11-15T11:33:46.987

我使用了 Carcione 给出的答案并将其修改为使用 JSON。

```
 function getUrlJsonSync(url){

    var jqxhr = $.ajax({
        type: "GET",
        url: url,
        dataType: 'json',
        cache: false,
        async: false
    });

    // 'async' has to be 'false' for this to work
    var response = {valid: jqxhr.statusText,  data: jqxhr.responseJSON};

    return response;
}    

function testGetUrlJsonSync()
{
    var reply = getUrlJsonSync("myurl");

    if (reply.valid == 'OK')
    {
        console.dir(reply.data);
    }
    else
    {
        alert('not valid');
    }    
} 
```

我添加了' **JSON'的****dataType**并将**.responseText**更改为**responseJSON**。

 ******我还使用返回对象的**statusText属性检索了状态。**请注意，这是 Ajax 响应的状态，而不是 JSON 是否有效。

后端必须以正确（格式正确）的 JSON 返回响应，否则返回的对象将是未定义的。

回答原始问题时需要考虑两个方面。一种是告诉 Ajax 同步执行（通过设置**async: false**），另一种是通过调用函数的 return 语句而不是回调函数返回响应。

我也用 POST 试了一下，效果很好。

我将 GET 更改为 POST 并添加了**数据：postdata**

```
function postUrlJsonSync(url, postdata){

    var jqxhr = $.ajax({
        type: "POST",
        url: url,
        data: postdata,
        dataType: 'json',
        cache: false,
        async: false
    });

    // 'async' has to be 'false' for this to work
    var response = {valid: jqxhr.statusText,  data: jqxhr.responseJSON};

    return response;
} 
```

请注意，上述代码仅适用于**async**为**false**的情况。如果要设置**async: true**返回的对象**jqxhr**在 AJAX 调用返回时将无效，只有在异步调用完成后才有效，但设置**响应**变量为时已晚。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2016-08-20T19:52:07.723

与`async: false`您一起获得一个被阻止的浏览器。对于非阻塞同步解决方案，您可以使用以下内容：

## ES6/ECMAScript2015

使用 ES6，您可以使用生成器和[co 库](https://github.com/tj/co)：

```
beforecreate: function (node, targetNode, type, to) {
    co(function*(){  
        let result = yield jQuery.get('http://example.com/catalog/create/' + targetNode.id + '?name=' + encode(to.inp[0].value));
        //Just use the result here
    });
} 
```

## ES7

使用 ES7，你可以只使用 asyc await：

```
beforecreate: function (node, targetNode, type, to) {
    (async function(){
        let result = await jQuery.get('http://example.com/catalog/create/' + targetNode.id + '?name=' + encode(to.inp[0].value));
        //Just use the result here
    })(); 
} 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2014-08-16T13:20:10.440

这是示例：

```
$.ajax({
  url: "test.html",
  async: false
}).done(function(data) {
   // Todo something..
}).fail(function(xhr)  {
   // Todo something..
}); 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2017-10-03T09:52:59.623

**首先我们应该了解什么时候使用 $.ajax 以及什么时候使用 $.get/$.post**

当我们需要对 ajax 请求进行低级控制时，例如请求标头设置、缓存设置、同步设置等，那么我们应该使用 $.ajax。

$.get/$.post：当我们不需要对 ajax 请求进行低级控制时。只需简单地获取/发布数据到服务器。**它是简写**

```
$.ajax({
  url: url,
  data: data,
  success: success,
  dataType: dataType
}); 
```

因此我们不能在 $.get/$.post 中使用其他功能（同步、缓存等）。

**因此，对于 ajax 请求的低级控制（同步、缓存等），我们应该使用 $.ajax**

```
 $.ajax({
     type: 'GET',
      url: url,
      data: data,
      success: success,
      dataType: dataType,
      async:false
    }); 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-02-15T19:55:31.350

这是我使用 jQuery 对 ASYNC 请求的简单实现。我希望这对任何人都有帮助。

```
var queueUrlsForRemove = [
    'http://dev-myurl.com/image/1', 
    'http://dev-myurl.com/image/2',
    'http://dev-myurl.com/image/3',
];

var queueImagesDelete = function(){

    deleteImage( queueUrlsForRemove.splice(0,1), function(){
        if (queueUrlsForRemove.length > 0) {
            queueImagesDelete();
        }
    });

}

var deleteImage = function(url, callback) {
    $.ajax({
        url: url,
        method: 'DELETE'
    }).done(function(response){
        typeof(callback) == 'function' ? callback(response) : null;
    });
}

queueImagesDelete(); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-04-29T10:50:01.887

因为`XMLHttpReponse`不推荐使用同步操作，所以我想出了以下包装的解决方案`XMLHttpRequest`。这允许有序的 AJAX 查询，同时本质上仍然是异步的，这对于单次使用的 CSRF 令牌非常有用。

它也是透明的，因此 jQuery 等库可以无缝运行。

```
/* wrap XMLHttpRequest for synchronous operation */
var XHRQueue = [];
var _XMLHttpRequest = XMLHttpRequest;
XMLHttpRequest = function()
{
  var xhr   = new _XMLHttpRequest();
  var _send = xhr.send;

  xhr.send = function()
  {
    /* queue the request, and if it's the first, process it */
    XHRQueue.push([this, arguments]);
    if (XHRQueue.length == 1)
      this.processQueue();
  };

  xhr.processQueue = function()
  {
    var call = XHRQueue[0];
    var xhr  = call[0];
    var args = call[1];

    /* you could also set a CSRF token header here */

    /* send the request */
    _send.apply(xhr, args);
  };

  xhr.addEventListener('load', function(e)
  {
    /* you could also retrieve a CSRF token header here */

    /* remove the completed request and if there is more, trigger the next */
    XHRQueue.shift();
    if (XHRQueue.length)
      this.processQueue();
  });

  return xhr;
}; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-01-11T17:10:15.343

由于最初的问题是关于`jQuery.get`，因此值得一提的是（如此[处](https://stackoverflow.com/a/44172561/1526703)所述）**可以**`async: false`在 a 中使用，`$.get()`但**最好避免**使用它，因为不推荐使用异步`XMLHTTPRequest`（并且浏览器可能会发出警告）：

```
$.get({
  url: url,// mandatory
  data: data,
  success: success,
  dataType: dataType,
  async:false // to make it synchronous
}); 
```

# sql - 用于存储本地化版本数据的良好数据库表设计

> ID：133313
> 
> 赞同：7
> 
> 时间：2008-09-25T13:27:33.020
> 
> 标签：sql, sql-server, database-design, localization

我正在尝试设计一些表来存储一些数据，这些数据稍后必须转换为不同的语言。任何人都可以为此提供一些“最佳实践”或指导方针吗？

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-25T13:34:13.443

假设您有一个如下所示的产品表：

```
Products
----------
id
price

Products_Translations
----------------------
product_id
locale
name
description 
```

然后你只需加入 product_id = product.id 和 locale='en-US'

当然这会对性能产生影响，因为您现在需要一个连接来获取名称和描述，但它允许以后使用任意数量的语言环境。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T13:36:44.840

你能描述一下“动态数据”的性质吗？

实现这一点的一种方法是拥有 3 个不同的表：

*   语言表
    *   该表将存储语言和密钥：

```
    [1、英文],
    [2、西班牙语]

```

*   数据定义表
    *   首次输入动态数据时，在此表中使用数据的标识符和标识符进行记录：

```
      [1, '数据1'],
      [2，“数据2”]

```

*   数据_语言表
    *   该表将链接语言、数据定义和翻译

```
      所以：[Data_Language，Data_Definition，语言，翻译]
          [1, 1, 1, '红色']
          [2, 1, 2, '罗霍']
          [3, 2, 1, '绿色']
          [4, 2, 2, '佛得角']

          ETC ...

```

输入动态数据后，创建默认的“英语”记录，然后在您空闲时进行翻译。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T13:31:16.180

我相信有关您正在做什么的更多信息会有所帮助。你能提供一些数据样本吗？你所说的动态是什么意思？随着时间的推移将插入大量数据并对数据进行大量更改，或者数据只需要在一小段时间内可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T13:36:10.147

通常，您可能应该查看具有常见非本地化数据的父表，以及具有本地化数据和语言键的子表。如果通过动态，您的意思是它经常更改，您可能想看看使用触发器和类似“translationRequired”标志的东西来标记更改后需要翻译的内容。

# perforce - 在 Perforce 中，您可以将文件夹重命名为相同的名称但大小写不同吗？

> ID：133320
> 
> 赞同：14
> 
> 时间：2008-09-25T13:28:29.617
> 
> 标签：perforce

我可以将 Perforce 中的文件夹从*//depot/FooBar/*重命名为*//depot/Foobar/*吗？

我已经尝试*过从 //depot/FooBar/*重命名为*//depot/Temp/*到*//Depot/Foobar/*但最终结果与*//depot/FooBar/*相同。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-25T14:00:40.663

一旦它进入 Perforce，情况就会保持不变。正如约翰所说，您可以删除，正确设置名称，然后再次添加。但是，有一个小问题......

如果其他人（运行 Windows）已经同步了错误大小写的版本，那么当他们再次同步正确的版本时，它不会改变他们 PC 上的大小写。这是 Windows 文件系统承认大小写但基本上与大小写无关的特性。

如果许多用户已经同步，并且不方便让他们也从客户端中删除（并从他们的机器中炸毁文件夹），那么您可以求助于一种黑暗而肮脏的 Perforce 技术，称为“检查点手术”。它不适合胆小的人，但你可以这样做：

1.  停止服务器，设置检查点。
2.  使用您最喜欢的可以处理数兆字节文件的文本编辑器，搜索并用新名称替换所有出现的旧案例名称。您当然也可以使用脚本。
3.  重播您的检查点文件以重新创建 Perforce 数据库元数据。
4.  重新启动您的服务器。

这将透明地影响所有用户客户端规范，因此当他们同步时，他们将获得正确的案例，就像魔术一样。

听起来很麻烦，但我以前必须这样做，只要你小心、备份、试运行等，那么一切都应该没问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-23T01:26:55.240

也许不再需要了，但这里是关于在 Windows 和 Unix 上更改文件大小写的官方 Perforce HowTo：[http ://answers.perforce.com/articles/KB/3448/?q=change+file+case](http://answers.perforce.com/articles/KB/3448/?q=change+file+case)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T14:11:43.227

我不确定目录，但我们遇到了文件问题。要修复它，我们必须删除文件，提交更改，然后 p4 添加正确大小写的文件并提交第二个更改。完成后，已同步错误大小写文件的 unix 用户必须 p4 同步，然后物理删除文件（因为 p4 不会更新大小写），然后 p4 sync -f 文件。

我们的服务器在 Windows 上，所以这可能会有所不同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-28T05:29:20.587

我认为您应该删除 Perforce 缓存，以便显示您的修改。

您可以使用 ABC rename 重命名为 abc_TMP，然后将 abc_TMP 重命名为 abc，然后清除缓存。

清除缓存的设置：

1.  打开 windows 用户主文件夹（在 windows7 ==> C:\Users\ 上）
2.  找到名为“.p4qt”的文件夹
3.  将文件夹重命名为“old.p4qt”
4.  启动 Perforce，现在一切正常！

注意：这些步骤将保留您的默认设置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T13:43:51.390

我猜它对待文件和文件夹是一样的。

对于文件：这取决于（取决于您是否拥有 Windows 或 Unix 服务器）。我们的 Windows perforce 服务器（我们的 Java 代码版本）有这个问题，偶尔有人会签入一个有大小写问题的文件（这会导致编译错误，因为它是 Java）。解决此问题的唯一方法是删除文件并使用正确的大小写重新提交。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-13T22:25:32.440

这个问题已经超过 3 年了，但是我在将 Subversion 导入 Perforce 时遇到了这样的问题，并认为我得到的信息可能对某些人有用。它类似于 obliterate 方法，但可以帮助您保留历史记录。您使用当时可能不可用的重复命令来保留历史记录。该过程基本上是：

1.  复制到临时位置。
2.  删除您刚刚复制的位置。
3.  从临时位置复制到重命名的案例位置。
4.  抹去临时位置。

通过这种方式，您可以保留文件更改的历史记录，但也可以将它们全部放在新路径中。不幸的是，不会有路径案例更改的历史记录，但这似乎是不可避免的。与此处提到的其他方法类似，用户将需要手动重命名其工作区中的目录或删除并重新同步以获取新路径名。

此外，P4V 会缓存它在树中显示的路径，因此在执行此操作后它可能仍会显示为旧名称。但是， p4 dirs 命令将显示新案例。

# delphi - 使用 Delphi 最小化外部应用程序

> ID：133325
> 
> 赞同：5
> 
> 时间：2008-09-25T13:30:10.177
> 
> 标签：delphi, window, minimize

有没有办法在我的 Delphi 应用程序中最小化我无法控制的外部应用程序？

例如notepad.exe，除了我要最小化的应用程序将只有一个实例。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T14:04:30.483

您可以使用**FindWindow**查找应用程序句柄并使用**ShowWindow**将其最小化。

```
var  
  Indicador :Integer;
begin 
  // Find the window by Classname
  Indicador := FindWindow(PChar('notepad'), nil);
  // if finded
  if (Indicador <> 0) then begin
    // Minimize
    ShowWindow(Indicador,SW_MINIMIZE);
  end;
end; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T13:33:58.420

我不是 Delphi 专家，但如果你可以调用 win32 api，你可以使用 FindWindow 和 ShowWindow 来最小化一个窗口，即使它不属于你的应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T15:30:32.353

感谢这一点，最后我使用了 Neftali 代码的修改版本[，](https://stackoverflow.com/questions/133325/minimize-a-external-application-with-delphi#133530)我将其包含在下面，以防其他人将来遇到同样的问题。

```
FindWindow(PChar('notepad'), nil); 
```

总是返回 0，所以在寻找一个原因时，我找到了这个可以找到 hwnd 的[函数，并且很有效。](http://www.swissdelphicenter.ch/torry/showcode.php?id=327)

```
function FindWindowByTitle(WindowTitle: string): Hwnd;
    var
      NextHandle: Hwnd;
      NextTitle: array[0..260] of char;
begin
      // Get the first window
      NextHandle := GetWindow(Application.Handle, GW_HWNDFIRST);
      while NextHandle > 0 do
      begin
        // retrieve its text
        GetWindowText(NextHandle, NextTitle, 255);
        if Pos(WindowTitle, StrPas(NextTitle)) <> 0 then
        begin
          Result := NextHandle;
          Exit;
        end
        else
          // Get the next window
          NextHandle := GetWindow(NextHandle, GW_HWNDNEXT);
      end;
      Result := 0;
end;

procedure hideExWindow()
var Indicador:Hwnd;
begin
    // Find the window by Classname
    Indicador := FindWindowByTitle('MyApp'); 
    // if finded
    if (Indicador <> 0) then
    begin
        // Minimize
        ShowWindow(Indicador,SW_HIDE); //SW_MINIMIZE
    end;
end; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-13T19:02:37.080

我猜 FindWindow(PChar('notepad'), nil) 应该是 FindWindow(nil, PChar('notepad')) 以按标题查找窗口。

# sharepoint - 在 ASP.NET 中开发 SharePoint Web 部件

> ID：133328
> 
> 赞同：8
> 
> 时间：2008-09-25T13:30:45.010
> 
> 标签：sharepoint, web-parts

我被要求在 ASP.NET 中开发一些用户控件，这些控件稍后将作为 Web 部件拉入 SharePoint 网站。我是 SharePoint 新手，在需要对这些部件进行原型制作期间，我无法访问 SharePoint 服务器。

有谁知道这种方法行不通的任何原因？如果不推荐这种方法，那么其他选择是什么？关于在考虑 SharePoint 的情况下开发 ASP.NET Web 部件时要考虑的资源/教程的任何建议？

谢谢

**编辑：2008 年 12 月 31 日** 我终于标记了这个答案。我花了一段时间才意识到，尽管一开始很痛苦，但立即走 SharePoint 路线是最好的方法。免费的 VPC 映像使设置开发相对轻松。

虽然您可以像我一样在没有 SharePoint 的情况下在 ASP.NET 中开发 Web 部件，但在开发和部署 SharePoint 应用程序时，您还没有学到任何东西，只是将学习曲线推到了您认为已经完成的时间, （并且可能已经告知利益相关者）。延迟 SharePoint 学习曲线对您或您的项目没有任何好处，并且您的最终产品将更好地满足您在此过程中获得的专业知识。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T13:55:48.680

ASP.NET Web 部件在 SharePoint 中的工作方式与在 ASP.NET 中的工作方式相同。[这就是我将采取的路线（从ASP.NET Web 部件](http://msdn.microsoft.com/en-us/library/e0s9t4ck.aspx)类派生的自定义控件）。这将减轻在 SharePoint 服务器上实际开发的任何要求。

您将遇到的唯一问题是您将无法利用 SharePoint 框架。如果您在 SharePoint 中进行任何高级操作，这很重要。但是，SharePoint 是 ASP.NET 加上一些附加功能，因此您可以使用[System.Web.UI.WebControls.WebPart](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webparts.webpart.aspx)类开发的任何东西都应该在 SharePoint 中运行良好。

当您从纯 ASP.NET 转到 SharePoint 时，一些有助于减轻痛苦的注意事项：

*   如果你可以把所有东西都放在一个程序集中，部署会更容易
    *   尝试将您需要的所有内容放入部署到 SharePoint 的 DLL 中
    *   如果需要，使用程序集资源嵌入 JS、CSS 和图像文件
*   强命名您正在构建的程序集
    *   大多数 SharePoint 部署最终都在 GAC 中，并且需要一个强名称

这是一篇相关的博客文章；[在 SharePoint 2007 中开发基本 Web 部件](http://dotnet.org.za/zlatan/archive/2008/03/25/developing-basic-web-parts-in-sharepoint-2007.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T13:40:57.153

我想最简单的方法是使用 CodePlex 的[SmartPart for SharePoint](http://www.codeplex.com/smartpart)。项目描述说“**可以托管任何 ASP.NET Web 用户控件**的 SharePoint Web 部件。无需编写代码即可创建 Web 部件！”，我想这正是您想要做的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T13:42:32.737

设置我的机器以开发 Sharepoint 花了我几天时间。

请参阅[http://weblogs.asp.net/erobillard/archive/2007/02/23/build-a-sharepoint-development-machine.aspx](http://weblogs.asp.net/erobillard/archive/2007/02/23/build-a-sharepoint-development-machine.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T14:21:17.433

如果是非常短期的事情，微软有一个限时的 WSS 评估 VPC 镜像：

[WSS3 SP1 开发人员评估 VPC 映像](http://www.microsoft.com/downloads/details.aspx?familyid=1beeac6f-2ea1-4769-9948-74a74bd604fa&displaylang=en&tm)

如果您现在没有时间/资源来设置您自己的 VPC 映像，这将帮助您开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T13:33:20.653

您需要访问共享点服务器，因为没有它您无法模拟您的 Web 部件，您必须将其部署到您的共享点站点以测试它是否正常工作。调试也会很痛苦。或者您可以使用 SmartPart，它是一个 Web 部件，其作用类似于您的用户控件在共享点站点中显示的包装器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T13:46:07.767

像对典型的 .net 网站一样构建和测试控件。解决方案 1 = 控件 解决方案 2 = 托管控件的虚拟网站。

在 Sharepoint 上部署：

您需要对控件进行签名。

将签名的 DLL 放入共享点服务器（Windows/程序集）上的 GAC

在 sharepoint 站点上的虚拟服务器根 web.config 中将控件标记为安全。

IE

```
<SafeControl Assembly="MyControl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=975cc42deafbee31" Namespace="MyNamespace" TypeName="*" Safe="True" AllowRemoteDesigner="True" /> 
```

在您的共享点页面中注册组件：

```
<%@ Register Namespace="MyNamespace" Assembly="MyControl, Version=1.0.0.0, Culture=Neutral, PublicKeyToken=975cc42deafbee31" TagPrefix="XXXX" %> 
```

使用控件：

```
<XXXX:ClassName runat="server" Field1="Value1" Field2="Value2" ....></XXXX:Classname> 
```

如果您需要使用相同的版本号替换控件，则需要回收应用程序池以重新加载。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T13:50:24.107

如果您不需要执行任何特定于 SharePoint 的操作（即访问列表、其他 Web 部件等），那么您可以像常规 Web 部件（派生自 System.Web.UI.WebControls.WebParts.WebPart 类）一样构建您的 Web 部件，并且当添加到 SharePoint 网站时，它将起作用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T18:49:59.597

您不需要 SharePoint 来开发 WebPart。您可以通过从 System.Web.UI.WebControls.WebParts 继承来开发 Web 部件。这是创建 Web 部件的首选方式，除非您需要以下功能，例如

```
* Connections between web parts that are outside of a Web Part zone

* Cross page connections

* A data caching infrastructure that allows caching to the content database

* Client-side connections (Web Part Page Services Component) 
```

在这种情况下，您需要通过从 Microsoft.SharePoint.WebPartpages.WebPart 继承来开发 webpart。[你可以在这里](http://www.megasolutions.net/Sharepoint/Developing_Custom_Web_Parts_for_Windows_SharePoint_Services.aspx)找到更多有用的信息

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T22:06:14.443

您的用户控件必须部署为 Web 部件是否有任何特殊原因？通过 12 hive 中的 CONTROLTEMPLATES 文件夹或 Web 应用程序虚拟目录中的某个位置，将用户控件直接部署到 Sharepoint 站点是完全可行的，然后您可以使用 Sharepoint Designer 从网页中引用该位置。

但是，如果 Web 部件要求至关重要，那么我推荐 Smartpart for Sharepoint，如前所述。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T06:59:36.753

实际上，由于 Web 部件的“滥用”性质，应始终将其部署到共享点的 bin 文件夹中。如果可能，请始终将 Web 部件部署到 bin，并编写自己的 CAS 并将其包含在清单中。

# c# - 以编程方式删除 Window Mobile 设备上的电子邮件和 SMS

> ID：133330
> 
> 赞同：2
> 
> 时间：2008-09-25T13:30:49.020
> 
> 标签：c#, vb.net, windows-mobile, compact-framework

我正在寻找可以删除 Windows Mobile 设备上所有电子邮件和短信的代码片段。最好该代码会删除“已发送”和“草稿”文件夹以及“收件箱”中的项目。

我的平台是 Windows Mobile (5.0 SDK) 和 .net 2.0 compact framework (C# / VB.NET)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T20:08:28.813

不幸的是，微软并**没有**让托管开发人员轻松做到这一点。为什么 WindowsMo​​bile.PocketOutlook 类包装器不提供此功能，只能猜测。您所要做的就是将您自己的 COM 互操作对象写入 MAPI。抱歉，我没有给你一个示例，但我至少可以给你一些你会感兴趣的方法的指针：

*   [IMAPI::GetMsgStoresTable](http://msdn.microsoft.com/en-us/library/ms859847.aspx)
*   [IMAPISession::OpenMessageStore](http://msdn.microsoft.com/en-us/library/ms859878.aspx)
*   [IMsgStore::OpenEntry](http://msdn.microsoft.com/en-us/library/ms860167.aspx)
*   [IMAPIFolder::DeleteMessages](http://msdn.microsoft.com/en-us/library/ms859723.aspx)

[InTheHand 有一个包装器](http://inthehand.com/content/Mobile.aspx)，其中包含 POOM 的其他方法，但我从未使用过它，我不知道它是否有任何你需要的东西。不过，在开始自己动手之前，可能值得一看。

# eclipse - Subclipse 错误消息“存储库的预期格式'3'；找到格式'5'”

> ID：133335
> 
> 赞同：1
> 
> 时间：2008-09-25T13:31:20.563
> 
> 标签：eclipse, svn

我在 Eclipse 中安装了 subclipse，但是当我尝试打开存储库时收到错误消息“存储库的预期格式 '3'；找到格式 '5'”。

以下是导致错误消息的步骤顺序。

从 Eclipse 主菜单中选择“Window -> Open Perspective -> SNV Repository Exploring”。

右键单击“SVN 存储库”选项卡。从弹出菜单中选择“新建 -> 存储库位置...”。将出现“添加 SVN 存储库”面板。

在“Url”字段中输入“file:///Users/caylespandon/svn/MyProject”。单击“完成”按钮。

出现带有以下错误消息的面板：

```
无法验证
验证位置时出错：“org.tigris.subversion.javahl.ClientException：
无法打开存储库
svn：无法打开到 URL 的 ra_local 会话
svn：无法打开存储库“文件：///Users/caylespandon/svn/MyProject”
不支持的存储库版本
svn：存储库的预期格式“3”；找到格式“5”
"

```

请注意，我可以从命令行访问相同的存储库：

```
~> svn checkout file:///Users/caylespandon/svn/MyProject
我的项目/主干
一个 MyProject/trunk/Jamrules
一个 MyProject/trunk/.project
一个 MyProject/trunk/setenv
[...]

```

以下是版本信息：

Eclipse：版本 3.4.0 构建 ID I20080617-2000

子剪辑版本：1.2.0

SVN 版本：1.4.4 (r25188)

在 Mac 上运行：OS X 版本 10.5.4

PS——如果您的回答涉及从文件切换到 svn+ssh，请解释为什么以及如何将现有存储库从文件转换为 svn+ssh 而不会丢失任何历史记录。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T13:37:57.897

只是在这里猜测，但请确保您的 libsvnjavahl 库版本与您使用的 SVN 版本相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T16:12:10.927

看看[这些对](https://stackoverflow.com/questions/122533/how-can-i-downgrade-the-format-of-a-subversion-repositiory)类似问题的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T12:38:09.117

（回答自己）

我最终选择了 Cory Engebretson 建议的解决方案，即使用 Subversive 而不是 Subclipse。我做了一些谷歌搜索，看看一个是否比另一个更好，它们似乎几乎等同于一个和另一个。我找到了 Subversive 更清晰的帮助（尤其是安装说明），并且我能够毫不费力地让它工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T15:02:19.190

对于您发布的问题，我无能为力，但我建议您尝试颠覆性的。我出于对一些 subclipse 错误的沮丧而做出了切换，并且更开心了。安装确实需要更多的工作。

[Eclipse 颠覆性项目](http://www.eclipse.org/subversive/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T15:57:12.787

问题的根源在于您使用的是旧的 SVN 客户端，它不理解 SVN 存储库的新格式 (5)。

# data-access-layer - “数据服务层”和“数据访问层”有什么区别？

> ID：133350
> 
> 赞同：13
> 
> 时间：2008-09-25T13:34:12.320
> 
> 标签：data-access-layer

我记得读过其中一个将低级别调用抽象为与数据无关的框架（例如 ExecuteCommand 方法等），而另一个通常包含特定于业务的方法（例如 UpdateCustomer）。

这个对吗？哪个是哪个？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-25T13:47:56.577

对我来说，这是关于如何处理项目设计的个人设计决定。有时数据访问和数据服务是一回事。对于 .NET 和 LINQ 就是这种情况。

对我来说，数据服务层实际上是对数据库的调用。数据访问层接收对象并创建或修改它们，以便数据服务层调用数据库。

在我的设计中，业务逻辑层根据业务规则处理对象，然后将它们传递给数据访问层，数据访问层将格式化它们以进入数据库或数据库中的对象，数据服务层处理实际的数据库调用.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-25T13:58:47.330

我认为通常这两个术语是可以互换的，但根据您的开发环境的上下文可能具有更具体的含义。

数据访问层位于数据和应用程序之间的边界。“数据”只是应用程序使用的不同数据源集。这可能意味着必须在每个应用程序中进行大量编码，以将来自多个来源的数据拉到一起。创建所需数据视图的代码在某些应用程序中是多余的。

随着数据源数量的增长和变得越来越复杂，有必要隔离数据访问的各种任务，以解决数据访问、转换和集成的细节问题。通过精心设计的数据服务，*业务服务*将能够与更高抽象级别的数据进行交互。处理数据访问、集成、语义解析、转换和重组以处理应用程序所需的数据视图和结构的数据逻辑最好封装在数据服务层中。

可以将数据服务层进一步分解为其组成部分（即数据访问、转换和集成）。在这种情况下，您可能有一个“数据访问层”，它只关注检索数据，以及一个“数据服务层”，它通过数据访问层检索其数据，并将检索到的数据组合并转换为所需的各种对象业务服务层。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-05-14T00:35:56.083

这是战壕深处的另一个视角！数据访问层是一个软件抽象层，它隐藏了实际获取数据的复杂性/实现。应用程序要求数据访问层（参见 DAO 设计模式）“获取我这个”或“更新那个”等（间接）。数据访问层负责执行特定于实现的操作，例如读取/更新各种数据源，例如 Oracle、MySQL、Cassandra、RabbitMQ、Redis、一个简单的文件系统、一个缓存，甚至委托给另一个数据服务层.

如果所有这些工作都发生在一台机器和同一个应用程序中，那么术语数据服务层就相当于一个服务门面（间接）。它负责服务并将应用程序调用委托给正确的数据访问层。

有点令人困惑的是，在分布式计算世界或面向服务的体系结构中，数据服务层实际上可以是充当独立应用程序的 Web 服务。在这种情况下，数据服务层将接收到的上游应用程序数据请求委托给正确的数据访问层。在这种情况下，Web 服务间接地从应用程序访问数据——应用程序只需要知道调用什么服务来获取数据，因此作为经验法则，在分布式计算环境中，这种方法将降低应用程序的复杂性（并且总会有例外的情况）

因此，为了清楚起见，该应用程序使用 DSL 和 DAL。应用程序中的 DSL 应该与同一应用程序中的 DAL 通信。DAL 可以选择使用单个数据源，或者委托给另一个 Web 服务。Web 服务 DSL 可以针对该请求将工作委托给 DAL。实际上，单个 Web 服务请求可以使用多个数据源来响应数据。

尽管如此，从实用的角度来看，只有当系统变得越来越复杂时，才应该更多地关注架构模式。把事情做对是个好习惯，但不必要地给你的工作镀金是没有意义的。还记得雅格尼吗？好吧，它无法在需要的时候引起共鸣！

总结：David Wheeler 的一句著名格言是：“计算机科学中的所有问题都可以通过另一个间接级别来解决”；[1] 这经常被故意错误地引用为“抽象层”代替“间接级别”。Kevlin Henney 对此的推论是，“……除了间接层太多的问题。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-05T16:08:18.600

[WebSphere Commerce](http://pic.dhe.ibm.com/infocenter/wchelp/v7r0m0/index.jsp?topic=/com.ibm.commerce.developer.soa.doc/concepts/csddsl.htm)文档中的**数据服务层**概念很简单：

> 数据服务层 (DSL) 为数据访问提供了一个独立于物理模式的抽象层。数据服务层的目的是为访问数据提供一致的接口（称为数据服务外观），独立于对象-关系映射框架

目前在互联网中，**DSL**概念主要与**SOA**（面向服务的架构）相关联，但不仅如此。[这里](http://www.codeproject.com/Articles/32237/N-Tier-development-with-ASP-NET-MVC-WCF-and-LINQ)提到了一个 N 层应用的例子。

# ruby-on-rails - 如何在 Ruby on Rails 中以编程方式找到命名空间/模块名称？

> ID：133357
> 
> 赞同：62
> 
> 时间：2008-09-25T13:34:38.120
> 
> 标签：ruby-on-rails, ruby, namespaces

如何在下面的过滤器中找到命名空间或模块“Foo”的名称？

```
class ApplicationController < ActionController::Base
  def get_module_name
    @module_name = ???
  end
end

class Foo::BarController < ApplicationController
  before_filter :get_module_name
end 
```

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2013-01-03T19:20:33.350

这些解决方案都没有考虑具有多个父模块的常量。例如：

```
A::B::C 
```

从 Rails 3.2.x 开始，您可以简单地：

```
"A::B::C".deconstantize #=> "A::B" 
```

从 Rails 3.1.x 开始，您可以：

```
constant_name = "A::B::C"
constant_name.gsub( "::#{constant_name.demodulize}", '' ) 
```

这是因为#demodulize 与#deconstantize 相反：

```
"A::B::C".demodulize #=> "C" 
```

如果您确实需要手动执行此操作，请尝试以下操作：

```
constant_name = "A::B::C"
constant_name.split( '::' )[0,constant_name.split( '::' ).length-1] 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2015-01-09T09:01:38.087

对于简单的情况，您可以使用：

```
self.class.parent 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-09-25T13:40:09.450

这应该这样做：

```
 def get_module_name
    @module_name = self.class.to_s.split("::").first
  end 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2020-05-29T22:41:28.880

### 对于 Rails 6.1

`self.class.module_parent`

* * *

Hettomei 的答案在 Rails 6.0 之前都可以正常工作

> 弃用警告：`Module#parent`已重命名为`module_parent`. `parent`已弃用并将在 Rails 6.1 中删除。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-25T14:04:19.533

如果控制器确实有模块名称，这将起作用，但如果没有，则返回控制器名称。

```
class ApplicationController < ActionController::Base
  def get_module_name
    @module_name = self.class.name.split("::").first
  end
end 
```

但是，如果我们将其更改为：

```
class ApplicatioNController < ActionController::Base
  def get_module_name
    my_class_name = self.class.name
    if my_class_name.index("::").nil? then
      @module_name = nil
    else
      @module_name = my_class_name.split("::").first
    end
  end
end 
```

您可以确定该类是否具有模块名称，并返回您可以测试的类名称以外的其他内容。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-06T08:12:31.833

我知道这是一个旧线程，但我只是遇到了需要根据控制器的命名空间进行单独导航的需要。我想出的解决方案是在我的应用程序布局中：

```
<%= render "#{controller.class.name[/^(\w*)::\w*$/, 1].try(:downcase)}/nav" %> 
```

这看起来有点复杂，但基本上执行以下操作 - 它采用控制器类名称，例如非命名空间控制器的“People”和命名空间控制器的“Admin::Users”。使用带有正则表达式的 [] 字符串方法，返回两个冒号之前的任何内容，如果没有任何内容，则返回 nil。然后它将其更改为小写（如果没有命名空间并返回 nil，则存在“try”）。然后，这给我们留下了命名空间或 nil。然后它只是简单地渲染有或没有命名空间的部分，例如没有命名空间：

```
app/views/_nav.html.erb 
```

或在管理命名空间中：

```
app/views/admin/_nav.html.erb 
```

当然，每个命名空间都必须存在这些部分，否则会发生错误。现在，每个控制器的每个命名空间的导航都将出现，而无需更改任何控制器或视图。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-04-04T16:35:25.790

`my_class.name.underscore.split('/').slice(0..-2)`

或者

`my_class.name.split('::').slice(0..-2)`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-12-15T17:00:29.013

没有人提到使用`rpartition`？

```
const_name = 'A::B::C'
namespace, _sep, module_name = const_name.rpartition('::')
# or if you just need the namespace
namespace = const_name.rpartition('::').first 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-25T13:42:32.940

我认为没有*更清洁*的方法，我在其他地方看到过

```
class ApplicationController < ActionController::Base
  def get_module_name
    @module_name = self.class.name.split("::").first
  end
end 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-07-23T02:14:24.533

我建议`gsub`而不是`split`. `split`考虑到您不需要任何其他模块名称，它会更有效。

```
class ApplicationController < ActionController::Base
  def get_module_name
    @module_name = self.class.to_s.gsub(/::.*/, '')
  end
end 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-11-24T11:35:29.070

有许多子模块：

```
module ApplicationHelper
  def namespace
    controller.class.name.gsub(/(::)?\w+Controller$/, '')
  end
end 
```

示例：`Foo::Bar::BazController`=>`Foo::Bar`

# c++ - 你如何处理 C++ 中的字符串？

> ID：133364
> 
> 赞同：17
> 
> 时间：2008-09-25T13:35:58.430
> 
> 标签：c++, string

你最喜欢在 C++ 中使用字符串的方式是什么？一个 C 风格的`char`s 数组？或者`wchar_t`？`CString`, `std::basic_string`, `std::string`,`BSTR`还是`CComBSTR`?

当然，这些都有自己的应用领域，但无论如何，你最喜欢哪一个，为什么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-25T13:51:55.210

std::string 或 std::wstring，取决于您的需要。为什么？

*   他们是标准的
*   它们是便携式的
*   他们可以处理 I18N
*   他们有性能保证（根据标准）
*   防止缓冲区溢出和类似攻击
*   可以根据需要轻松转换为其他类型
*   很好地模板化，为您提供多种选择，同时减少代码膨胀并提高性能。真的。不能处理模板的编译器现在早已不复存在。

C 风格的字符数组只是自找麻烦。有时您仍然需要处理它们（这就是 std::string.c_str() 的用途），但是，老实说 - C 语言中最大的危险之一是程序员使用 char* 做坏事并结束缓冲区溢出。只是不要这样做。

wchar__t 的数组是一样的，只是更大。

CString、BSTR 和 CComBSTR 不是标准的，也不是可移植的。除非绝对强迫，否则避免使用它们。理想情况下，只需在需要时将 std::string/std::wstring 转换为它们，这应该不会很昂贵。

请注意，std::string 只是 std::basic_string 的子项，但除非您有充分的理由不使用，否则最好还是使用 std::string。真的很好。在这种情况下，让编译器负责优化。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-25T13:42:43.377

**标准::字符串**！！

他们称其为“标准”是有原因的。

basic_string 是一个实现细节，应该被忽略。

BSTR & CComBSTR 仅用于与 COM 的互操作，并且仅用于互操作的时刻。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T13:40:20.557

std::string 除非我需要调用专门采用您列出的其他 API 的 API。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-19T22:11:00.943

这是一篇比较 C++ 中最常见的字符串类型以及如何在它们之间进行转换的文章。[在 Visual C++ 中解开字符串](http://www.johndcook.com/cplusplus_strings.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-25T13:41:07.763

如果可以使用 MFC，请使用 CString。否则使用 std::string。另外，std::string 可以在任何支持标准 C++ 的平台上工作。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T14:08:47.337

当我有选择时（我通常不会），我倾向于使用带有 UTF-8 编码的 std::string （以及[UTF8 CPP](http://utfcpp.sourceforge.net/)库的帮助。并不是说我喜欢 std::string 那么多，但至少它是标准的和便携的。

不幸的是，在我从事的几乎所有现实生活项目中，都有内部字符串类——它们中的大多数实际上比 std::string 更好，但仍然......

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-25T14:21:23.297

我是 Qt 开发人员，所以我当然倾向于尽可能使用 QString :)。

非常好：符合 unicode、线程安全的隐式共享（又名写时复制），并且它带有一个旨在解决实际现实问题的 API（拆分、连接、替换（使用和不使用正则表达式）、转换到/从数字...）

如果我不能使用 QString，那么 std::wstring。如果你被 C 卡住了，我推荐 glib GString。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T13:38:59.530

C 风格的 char 数组有它们的位置，但如果你广泛使用它们，你就会因为一个错误而浪费时间调试。我们有自己的字符串类，专门用于我们的（嵌入式开发环境）。

我们不使用 std::string 因为它并不总是可供我们使用。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T13:43:17.600

我尽可能使用`std::string`（或）。`basic_string<TCHAR>`它非常通用（就像`CStringT`），它是类型安全的（不像`printf`），并且在每个平台上都可用。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-25T13:46:28.280

其他，std::wstring。

std::string 是 20 世纪的技术。使用 Unicode，卖给 60 亿人而不是 3 亿人。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-19T22:35:49.273

如果您使用 MFC，请使用 CString。否则我同意大多数其他人，std::string 或 std::wstring。

微软本可以通过在其最新的 MFC 更新中添加 std::basic_string<TCHAR> 重载来为世界带来巨大的帮助。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-25T13:47:59.150

我喜欢根据项目设置使用 TCHAR，它是 wchar 或 char 的定义。它在 tchar.h 中定义，您可以在其中找到所需的函数和类型的所有相关定义。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-25T13:49:50.660

如果可以的话， std::string 和 std::wstring ，如果必须的话，还有别的东西。

它们可能并不完美，但它们经过了很好的测试，很好理解，而且用途广泛。它们与标准库的其余部分配合得很好，这也是一个巨大的好处。

另外值得一提的是[stringstreams](http://www.cppreference.com/wiki/io/sstream/start)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-25T13:54:45.873

Unicode 是未来。不要使用 char* 和 std::string。请）我厌倦了本地化错误。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-25T14:00:18.433

std::string 总比没有好，但令人讨厌的是它缺少基本功能，如拆分、连接，甚至是体面的格式调用......

# .net - .NET：SqlDataReader.Close 或 .Dispose 导致 Timeout Expired 异常

> ID：133374
> 
> 赞同：7
> 
> 时间：2008-09-25T13:37:02.920
> 
> 标签：.net, sql-server, database, timeout

当试图在 SqlDataReader 上调用 Close 或 Dispose 时，我得到一个超时过期异常。如果你有一个到 SQL Server 的 DbConnection，你可以自己复制它：

```
String CRLF = "\r\n";
String sql = 
    "SELECT * " + CRLF +
    "FROM (" + CRLF +
    "   SELECT (a.Number * 256) + b.Number AS Number" + CRLF +
    "   FROM    master..spt_values a," + CRLF +
    "       master..spt_values b" + CRLF +
    "   WHERE   a.Type = 'p'" + CRLF +
    "       AND b.Type = 'p') Numbers1" + CRLF +
    "   FULL OUTER JOIN (" + CRLF +
    "       SELECT (print("code sample");a.Number * 256) + b.Number AS Number" + CRLF +
    "       FROM    master..spt_values a," + CRLF +
    "           master..spt_values b" + CRLF +
    "       WHERE   a.Type = 'p'" + CRLF +
    "           AND b.Type = 'p') Numbers2" + CRLF +
    "   ON 1=1";

DbCommand cmd = connection.CreateCommand();
cmd.CommandText = sql;
DbDataReader rdr = cmd.ExecuteReader();
rdr.Close(); 
```

如果您调用 reader.Close() 或 reader.Dispose()，它将抛出 System.Data.SqlClient.SqlException：

*   错误代码：-2146232060 (0x80131904)
*   消息：“超时。在操作完成之前超时时间已过，或者服务器没有响应。”

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-25T13:40:45.377

这是因为您刚刚打开数据阅读器，还没有完全迭代它。在尝试关闭尚未完成的数据读取器（以及 DbConnection）之前，您需要 .Cancel() 您的 DbCommand 对象。当然，通过 .Cancel()-ing 您的 DbCommand，我不确定这一点，但您可能会遇到其他一些异常。但如果它发生，你应该抓住它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T13:56:47.147

Cruizer 得到了答案：调用 command.Cancel()：

```
using (DbCommand cmd = connection.CreateCommand())
{
    cmd.CommandText = sql;
    using (DbDataReader rdr = cmd.ExecuteReader())
    {
       while (rdr.Read())
       {
          if (WeShouldCancelTheOperation())
          {
             cmd.Cancel();
             break;
          }
       }
    }    
} 
```

知道即使读者已经阅读了所有行也可以调用 Cancel 也很有帮助（即它不会抛出一些*“没有什么可以取消”的*异常。）

```
DbCommand cmd = connection.CreateCommand();
try
{
    cmd.CommandText = sql;
    DbDataReader rdr = cmd.ExecuteReader();
    try
    {
       while (rdr.Read())
       {
          if (WeShouldCancelTheOperation())
             break;
       }
       cmd.Cancel();
    }    
    finally
    {
       rdr.Dispose();
    }
}
finally
{
   cmd.Dispose();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T13:45:31.793

您实际上在哪里读取数据？您只是在创建一个阅读器，而不是在阅读数据。这只是一个猜测，但如果您不阅读，也许读者有问题要关闭；）

```
DbDataReader rdr = cmd.ExecuteReader();
while(rdr.Read())
{
    int index = rdr.GetInt32(0);
} 
```

# c# - 以编程方式提升进程特权？

> ID：133379
> 
> 赞同：157
> 
> 时间：2008-09-25T13:38:00.483
> 
> 标签：c#, .net, windows, windows-services, process-elevation

我正在尝试使用 InstallUtil.exe 安装服务，但通过`Process.Start`. 这是代码：

```
ProcessStartInfo startInfo = new ProcessStartInfo (m_strInstallUtil, strExePath);
System.Diagnostics.Process.Start (startInfo); 
```

where`m_strInstallUtil`是“InstallUtil.exe”的完全限定路径和 exe，并且`strExePath`是我的服务的完全限定路径/名称。

从提升的命令提示符运行命令行语法有效；从我的应用程序运行（使用上面的代码）没有。我假设我正在处理一些进程提升问题，那么我将如何在提升状态下运行我的进程？我需要看看`ShellExecute`这个吗？

这一切都在 Windows Vista 上。我在提升到管理员权限的 VS2008 调试器中运行该进程。

我也试过设置`startInfo.Verb = "runas";`，但似乎没有解决问题。

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-09-25T13:57:54.073

您可以通过将 startInfo 对象的 Verb 属性设置为“runas”来指示应以提升的权限启动新进程，如下所示：

```
startInfo.Verb = "runas"; 
```

这将导致 Windows 的行为就像进程已从资源管理器中使用“以管理员身份运行”菜单命令启动一样。

这确实意味着将出现 UAC 提示并需要用户确认：如果这是不希望的（例如因为它会发生在一个冗长的进程中间），您需要运行整个主机进程通过[Create and Embed an Application Manifest (UAC)](https://msdn.microsoft.com/en-us/library/bb756929.aspx)提升权限以要求“highestAvailable”执行级别：这将导致 UAC 提示在您的应用启动后立即出现，并导致所有子进程以提升的权限运行而无需额外提示.

编辑：我看到你刚刚编辑了你的问题，说明“runas”对你不起作用。这真的很奇怪，因为它应该（在几个生产应用程序中对我来说也是如此）。但是，通过嵌入清单来要求父进程以提升的权限运行肯定可以工作。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2012-06-05T22:12:08.690

此代码将上述所有内容放在一起并使用管理员权限重新启动当前 wpf 应用程序：

```
if (IsAdministrator() == false)
{
    // Restart program and run as admin
    var exeName = System.Diagnostics.Process.GetCurrentProcess().MainModule.FileName;
    ProcessStartInfo startInfo = new ProcessStartInfo(exeName);
    startInfo.Verb = "runas";
    System.Diagnostics.Process.Start(startInfo);
    Application.Current.Shutdown();
    return;
}

private static bool IsAdministrator()
{
    WindowsIdentity identity = WindowsIdentity.GetCurrent();
    WindowsPrincipal principal = new WindowsPrincipal(identity);
    return principal.IsInRole(WindowsBuiltInRole.Administrator);
}

// To run as admin, alter exe manifest file after building.
// Or create shortcut with "as admin" checked.
// Or ShellExecute(C# Process.Start) can elevate - use verb "runas".
// Or an elevate vbs script can launch programs as admin.
// (does not work: "runas /user:admin" from cmd-line prompts for admin pass) 
```

更新：首选应用清单方式：

在 Visual Studio 中右键单击项目，添加新的应用程序清单文件，更改文件，以便您设置 requireAdministrator，如上所示。

原方式的一个问题：如果将重启代码放在app.xaml.cs OnStartup中，即使调用了Shutdown，它仍然可能会短暂启动主窗口。如果 app.xaml.cs init 没有运行并且在某些竞争条件下它会这样做，我的主窗口就会爆炸。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-23T23:56:19.950

根据文章[*Chris Corio：教您的应用程序使用 Windows Vista 用户帐户控制很好地运行，MSDN 杂志，2007 年 1 月*](https://web.archive.org/web/20150525211734/https://msdn.microsoft.com/en-us/magazine/cc163486.aspx)，仅`ShellExecute`检查嵌入式清单并在需要时提示用户提升，而`CreateProcess`其他 API 则不会。希望能帮助到你。

另请参阅：[与 .chm 相同的文章](http://download.microsoft.com/download/3/A/7/3A7FA450-1F33-41F7-9E6D-3AA95B5A6AEA/MSDNMagazineJanuary2007en-us.chm)。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-01-12T08:43:21.440

```
[PrincipalPermission(SecurityAction.Demand, Role = @"BUILTIN\Administrators")] 
```

这将在没有 UAC 的情况下完成 - 无需启动新进程。如果正在运行的用户是 Admin 组的成员，就我而言。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T13:53:55.983

您应该使用模拟来提升状态。

```
WindowsIdentity identity = new WindowsIdentity(accessToken);
WindowsImpersonationContext context = identity.Impersonate(); 
```

完成后不要忘记撤消模拟上下文。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2022-01-05T20:56:39.283

我知道这是一个非常古老的帖子，但我只是想分享我的解决方案：

```
System.Diagnostics.ProcessStartInfo StartInfo = new System.Diagnostics.ProcessStartInfo
{
    UseShellExecute = true, //<- for elevation
    Verb = "runas",  //<- for elevation
    WorkingDirectory = Environment.CurrentDirectory,
    FileName = "EDHM_UI_Patcher.exe",
    Arguments = @"\D -FF"
};
System.Diagnostics.Process p = System.Diagnostics.Process.Start(StartInfo); 
```

**注意：**如果 VisualStudio 已经在运行 Elevated，则不会显示 UAC 对话框，要对其进行测试，请运行 bin 文件夹中的 exe。

# asp.net - 配置用于 ASP.Net 身份验证的数据库

> ID：133390
> 
> 赞同：5
> 
> 时间：2008-09-25T13:39:20.123
> 
> 标签：asp.net, asp.net-mvc, authentication

我想在我的 asp.net mvc 站点中使用表单身份验证。

我可以使用已经存在的 sql db（在远程服务器上）吗？如何配置站点以使用此数据库进行身份验证？我需要/使用哪些表进行身份验证？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T13:45:19.127

你可以。检查`aspnet_regsql.exe`Windows\Microsoft.NET\Framework\v2.xxx 文件夹中的程序参数，特别是`sqlexportonly`.

创建所需表后，您可以配置：在 web.config 文件中创建连接字符串，然后设置 MemberShipProvider 以使用此连接字符串：

```
 <connectionStrings>
    <add name="MyLocalSQLServer" connectionString="Initial Catalog=aspnetdb;data source=servername;uid=whatever;pwd=whatever;"/>
  </connectionStrings>

<authentication mode="Forms">
  <forms name="SqlAuthCookie" timeout="10" loginUrl="Login.aspx"/>
</authentication>
<authorization>
  <deny users="?"/>
  <allow users="*"/>
</authorization>
<membership defaultProvider="MySqlMembershipProvider">
  <providers>
    <clear/>
    <add name="MySqlMembershipProvider" connectionStringName="MyLocalSQLServer" applicationName="MyAppName" type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
  </providers>
</membership> 
```

[Ps：这里](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)有一些关于整个概念的非常好的文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T14:23:14.977

最简单的方法是只使用 aspnet_regsql.exe 应用程序的 Windows 界面。

您可以在 c:\windows\microsoft.net\framework\v2.0.50727 文件夹中找到它。

只需输入aspnet_regsql.exe，它就会打开一个向导，这样你就不需要记住任何命令行开关了。

# delphi - Delphi中的密码加密

> ID：133393
> 
> 赞同：17
> 
> 时间：2008-09-25T13:39:48.687
> 
> 标签：delphi, configuration, encryption, passwords

我需要将数据库密码存储在配置文件中。出于显而易见的原因，我想对它们进行加密（最好使用 AES）。有谁知道一个 Delphi 实现，它很容易引入到具有超过 10,000 行历史增长（URGH！）源代码的现有项目中？

澄清：简单意味着将单元添加到项目中，添加最大值。读取配置文件并使用它完成的 5 行代码。时间不应超过 15 分钟。

另一个说明：需要密码才能创建与数据库的连接，而不是支持应用程序的用户管理方案。所以使用哈希没有帮助。数据库引擎检查密码是否有效，而不是应用程序。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-25T13:58:19.717

我支持 David Barton 的[DCPCrypt library](http://www.cityinthesky.co.uk/cryptography.html)的推荐。我已经在几个项目中成功使用过，阅读使用示例后不会超过 15 分钟。它使用 MIT 许可证，因此您可以在商业项目和其他项目中自由使用它。DCPCrypt 实现了许多算法，包括 AES 的 Rijndael。

也有许多可谷歌搜索的独立（单单元）实现 - 问题是您信任哪一个，除非您准备好自己验证特定库的正确性。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-25T14:18:50.713

对于典型的身份验证目的，您不需要存储密码，您只需检查用户输入的密码是否正确。如果这是您的情况，那么您可以只存储一个哈希签名（例如 MD5）并将其与输入密码的签名进行比较。如果两个签名匹配输入的密码是正确的。

存储加密密码可能很危险，因为如果有人获得您的“主”密码，他们可以检索您所有用户的密码。

如果您决定使用 MD5，您可以使用 Delphi 附带的 MessageDigest_5.pas（至少它包含在我的 Delphi 2007 副本中）。Delphi 源代码还有其他实现可供您选择。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-25T14:08:04.860

我认为 Turbopower LockBox 是一个出色的文字库：

[http://sourceforge.net/projects/tplockbox/](http://sourceforge.net/projects/tplockbox/)

我不知道它是否对你的使用来说太大了，但它非常易于使用，你可以用 5 行代码加密一个字符串。这一切都在示例中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T16:24:05.420

TOndrej 有正确的方法。您永远不应该使用可逆密码存储密码。正如正确指出的那样，如果您的“主”密钥被泄露，则整个系统都会被泄露。使用不可逆散列（例如 MD5）更加安全，您可以将散列值存储为明文。只需对输入的密码进行哈希处理，然后将其与存储的哈希值进行比较。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T23:06:43.767

我一直使用 Turbopower Lockbox。它运行良好，而且非常易于使用。我实际上将它用于完全相同的事情，将密码存储在配置文本文件中。

[http://sourceforge.net/projects/tplockbox/](http://sourceforge.net/projects/tplockbox/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-10-13T02:29:07.230

TurboPower LockBox 3 (http://lockbox.seanbdurkin.id.au/) 使用自动加盐。我建议不要使用 Barton 的 DCPCrypt，因为 IV 没有加盐。在某些情况下，这是一个非常严重的安全漏洞。

与之前的评论相反，LB3 的 AES 实现完全符合标准。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-25T13:45:51.510

我用过这个[库](http://www.cityinthesky.co.uk/cryptography.html)，添加起来很快。但是[wiki 显示](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard#Delphi)了更多的解决方案。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T13:55:14.233

即使您加密了，在我看来，您的解密密钥和加密密码都将在您的可执行文件中，这意味着绝不是默默无闻的安全。任何人都可以获取解密密钥和加密密码并生成原始密码。

你想要的是一个单向哈希。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T13:29:28.740

只是提醒。

如果您不需要与其他 crypt 库进行互操作，那么 DCP 或 LockBox 就可以完成这项工作。

但

如果您需要它完全符合 rinjdael 规范，请忘记免费组件，它们大多数时候有点“糟糕”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-28T08:22:18.757

正如其他人所指出的，出于身份验证的目的，您应该避免使用可逆加密存储密码，即您应该只存储密码哈希，并根据您存储的哈希检查用户提供的密码的哈希。但是，这种方法有一个缺点：如果攻击者掌握了您的密码存储数据库，它很容易受到[彩虹表攻击。](http://en.wikipedia.org/wiki/Rainbow_table)

您应该做的是存储预选（和秘密）盐值 + 密码的哈希值。即，连接盐和密码，散列结果，并存储这个散列。进行身份验证时，请执行相同的操作 - 连接您的盐值和用户提供的密码、哈希，然后检查是否相等。这使得彩虹表攻击不可行。

当然，如果用户通过网络发送密码（例如，如果您正在使用 Web 或客户端-服务器应用程序），那么您不应该以明文形式发送密码，而不是存储散列（salt +密码）您应该存储并检查哈希（盐+哈希（密码）），并让您的客户端对用户提供的密码进行预哈希并通过网络发送该密码。这也可以保护您的用户密码，以防用户（许多人）将相同的密码用于多种用途。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-29T05:45:18.657

我建议使用某种盐。不要将 crypt(password) 存储在配置文件中，而是插入此存储 crypt(salt + password)。作为“盐”，您可以使用打开数据库所需的东西，例如。db_name+user_name。对于 crypt 函数，您可以使用一些众所周知的算法，如 AES、Idea、DES，或者像将每个字节与其他字符串中的字节进行异或运算一样简单，该字符串将成为您的密钥。为了使其解决起来更加不同，您可以使用一些随机字节并存储它们。

所以要存储：

1.  init_str := 5 个随机字节
2.  new_password := salt + 密码 // salt := db_name + user_name
3.  crypted_pa​​ssword = xor_bytes(init_str + new_password, '我的关键词')
4.  crypted_pa​​ssword := init_str + crypted_pa​​ssword
5.  将 crypted_pa​​ssword 存储在配置中，因为这将是您可以对其进行 hexify 或 base64 处理的字节

并连接：

1.  将从配置读取的数据拆分为 init_str 和 crypted_pa​​ssword
2.  new_password = xor_bytes(init_str + crypted_pa​​ssword, 'my keyphrase')
3.  密码 := 从 new_password 中删除 (db_name + user_name)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T14:00:33.037

尼克当然是对的——当你说你想花 15 分钟来实施安全解决方案时，我只是假设你知道自己在做什么。如果您决定采用（更好的）路线，DCPCrypt 库还实现了许多散列算法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-13T07:11:13.447

几个解决方案：

*   根本不存储密码。如果数据库支持集成身份验证，请使用它。该进程可以设置为以特定身份运行，并由数据库自动进行身份验证
*   使用 Windows 证书存储和证书来加密您的密码。如果您将用于加密密码的密钥存储在您的应用程序中，那么无论如何您的安全性都非常低，您还必须保护密钥。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-10-13T10:07:31.277

您需要将其存储在只有当前用户也可以访问的地方。

基本上有两种方法可以做到这一点：

1.  将其存储在[EFS 加密文件](http://en.wikipedia.org/wiki/Encrypting_File_System)中。
2.  将其存储在[安全的本地存储](https://stackoverflow.com/questions/442443/is-there-some-sort-of-secure-local-storage-on-windows)中。

Internet Explorer 使用 2。但如果您可以获得本地访问权限，则可以解密 1\. 和 2\. 如果您拥有正确的主密钥和算法（例如，[iepv](http://www.nirsoft.net/utils/internet_explorer_password.html)可以获取 Internet Explorer 密码）。

所以：
如果可以，请避免存储密码。
首先寻找替代方案（如 Windows 身份验证、目录服务等）。

——杰伦

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-09-14T11:43:06.750

这个 Embarcadero 的演示给出了一个简单但对于大多数应用程序来说足够强大的系统： [https ://edn.embarcadero.com/article/28325](https://edn.embarcadero.com/article/28325)

# php - 如何在 Joomla 中设置内容类型？

> ID：133394
> 
> 赞同：6
> 
> 时间：2008-09-25T13:39:55.783
> 
> 标签：php, http, joomla, content-type

我正在开发一个 Joomla 组件，其中一个视图需要将自身呈现为 PDF。在视图中，我尝试使用以下行设置内容类型，但是当我看到响应时，它仍然是 text/html。

```
header('Content-type: application/pdf'); 
```

如果我在常规 php 页面中执行此操作，一切都会按预期工作。看来我需要告诉 Joomla 使用 application/pdf 而不是 text/html。我该怎么做？

注意：设置其他标题，例如`Content-Disposition`，按预期工作。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T17:51:13.543

从 1.5 版开始，Joomla 有了 JDocument 对象。使用[JDocument::setMimeEncoding()](http://api.joomla.org/Joomla-Framework/Document/JDocument.html#setMimeEncoding)设置内容类型。

```
$doc =& JFactory::getDocument();
$doc->setMimeEncoding('application/pdf'); 
```

在您的特殊情况下，查看[JDocumentPDF](http://api.joomla.org/Joomla-Framework/Document/JDocumentPDF.html)可能是值得的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-07T06:37:00.880

对于那些认为以上是一个非常古老的答案的人，我确认 JDocument::setMimeEncoding() 仍然有效，即使在 1.6 版本上（尚未在 1.7 上尝试过）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-17T19:34:43.023

我在 joomla 2.5 中遇到了同样的问题。在 joomla 管理面板中单击 8 小时后，我找到了解决方案。

1.  登录您的 joomla 管理面板并单击媒体管理器
2.  单击右上角的选项按钮。这将打开一个带有各种选项的配置选项卡
3.  在合法文件扩展名、应用程序/pdf 或您需要的任何内容的框中。值用逗号分隔。 *请注意，显然您必须根据我刚刚找到的论坛按字母顺序列出内容*
4.  点击保存按钮

您现在应该能够将 pdf 加载到媒体管理器中。希望这对你有用。我刚刚设置我的上传`.mov`扩展。

问题是它只工作了一次。现在，每当我导航到硬盘上的电影 .mov 文件时，浏览链接都不起作用。但如果我选择任何其他文件类型，它会这样做吗？

# database-design - 什么是正交索引？

> ID：133418
> 
> 赞同：7
> 
> 时间：2008-09-25T13:42:34.687
> 
> 标签：database-design, indexing

我的产品责任范围内的一张表被批评为具有多个正交索引。

什么是正交索引？
为什么不好？
如何避免这种情况？

--Update--
后端数据库引擎在这里不一定相关，因为我们的应用程序与数据库无关。但如果它有帮助，甲骨文是一种可能性。

有问题的表格不用于财务分析。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T15:11:48.183

正交意味着彼此独立。

不知道为什么会不好。事实上，当有一个与主查询无关的常见查询时，我通常使用二级索引（除了“id”自动增量主键）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T14:19:26.097

我相信我在两个不同的场合听说过“正交索引”这个词，但我不知道这是否是一个公认的术语。在这两种情况下，它们都指的是查询优化器不使用的索引，因为：

*   有一次，它索引了一个完全不相关的列，从未用作搜索条件或排序列；这个词对我来说听起来“古怪”，但我没有反对:)

*   在另一种情况下，它是一个两列索引，但字段中列的顺序与所需的顺序相反。

我完全不知道这是否与您的问题有关:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T14:55:02.590

我可能会在这里回答我自己的问题，但请随意加入你自己的想法。

Javier 的回答 (+1) 让我开始认为，如果该索引中的项目完全不相关，那么拥有多个唯一索引可能是一件坏事。

换句话说，由于二级索引的唯一性约束，您增加了无法存储真实数据的机会。它还可能对不一定存在的数据引入人为约束。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T13:52:40.340

正交只是意味着独立，即与主要关注点无关。

# database - 你如何处理小数据集？

> ID：133420
> 
> 赞同：5
> 
> 时间：2008-09-25T13:42:49.770
> 
> 标签：database, theory

对于非常小的数据集，我工作的策略通常是将它们粘贴到文本文件中，但根据我的经验，这可能是一个令人头疼的开发问题。数据通常来自数据库，如果不是，则设置/存储它所涉及的过程通常隐藏在代码中。使用数据库，您通常可以查看所有可用的数据以及它与其他数据相关的方式。

有时对于非常小的数据集，我只是将它们存储在代码中的内部数据结构中（如 Perl 哈希），但是当需要更改时，它就在开发人员手中。

那么如何处理少量不经常更改的数据呢？您是否设置了何时使用数据库表或文本文件或.. 的标准？

我很想只使用数据库表来处理所有事情，但我不确定这是否有任何影响。

**编辑：**对于上下文：

我被要求在网站上为少数几家公司添加一个新的联系表，将来还会偶尔添加更多。除了，公司没有联系电子邮件地址。这些公司内部的用户有（因为他们通过自己的帐户发布工作）。不过现在，我们想要一个“推测应用程序”类型的功能，并且表单需要一个电子邮件地址来发送这些应用程序。但我们也不想将电子邮件地址作为属性放入表单中，否则垃圾邮件发送者可以将其用作开放式电子邮件网关。很明显，我们需要一个 ID -> contact_email 类型与公司的关系。

因此，我可以向具有数百万行的表添加一列，从字面上看，该列将被使用大约 20 次，或者创建一个最多容纳大约 20 行的新表。通常我们过去处理这个问题的方式只是创建一个讨厌的文本文件并从那里读取它。但这会造成维护噩梦，并且当它们依赖的数据发生更改时，经常会检查这些文本文件。也许这是这个过程的一个错误，但我只是想听听对此的看法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T13:45:41.667

把它放在数据库中。如果它不经常更改，请将其缓存在中间层。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T13:46:26.737

立即想到的示例是适合存储为枚举的示例以及适合存储在“查找”数据库表中的示例。

我倾向于“划清界限”的规则是，如果它会导致数据库中的一列包含映射到枚举值的“幻数”，那么该枚举应该真正作为查找表存在。如果它与存储在数据库中的数据无关（例如，应用程序配置数据而不是用户生成的数据），那么它一直是一个枚举。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T13:47:14.457

当然，这取决于您开发的用于使用数据集的软件工具的用户，无论大小如何？

可能只是他们知道 Excel，因此您的工具必​​须解析他们创建的 .csv 文件。

如果它是为开发人员编写的，那么谁在乎你使用什么。但是，我不喜欢使用少量或临时数据使数据库混乱。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T13:47:18.653

我们有一个标准的配置文件格式（键：值）和一个类来处理它。我们只是在所有项目中使用它。大多数情况下，我们只是为我们的应用程序（手机开发）设置持久属性，所以这是一件合适的事情。YMMV

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T13:51:32.277

在程序访问数据库的情况下，我会将所有内容存储在其中：便于备份和移动数据。

对于没有数据库访问权限的小程序，我将我的数据存储在 .net 设置中，这些设置存储在一个 xml 文件中——当然这是 c# 的一个特性，所以它可能不适用于你。

无论如何，我确保将所有数据存储在一个地方。通常是一个数据库。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T23:04:45.973

你考虑过[sqlite](http://www.sqlite.org/quickstart.html)吗？它是基于文件的，可以解决您“只需一个文件就可以”（零配置）的感觉，但它是一个非常好的数据库，并且可扩展性非常好。它支持许多 API，并且有许多用于管理它的[前端。](http://www.google.com/search?q=sqlite+gui)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T15:08:08.647

如果这些是类似配置的小数据，我会使用一些简单且通用的格式。ini、json 和 yaml 通常都可以。Java 和 .NET 爱好者也喜欢 XML。简而言之，使用您可以轻松读取到内存对象并忘记它的东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T22:33:20.260

我会将它添加到主表中的数据库中：

1.  备份和恢复（您确实想恢复此文本文件，对吗？）
2.  即席查询（因为您可以使用 SQL 工具将其连接到其他数据库数据）
3.  如果数据库列是空的，它的存储要求应该是最小的（如果它是 Oracle 表末尾的 NULL 列，则没有）
4.  如果您想拥有多个应用程序服务器会更容易，因为您不需要保留一些额外配置文件的多个副本
5.  将它放入一个小子表只会使设计复杂化，而不会带来任何真正的好处

无论如何，作为处理的一部分，您很可能已经进入数据库中的同一行，因此性能不太可能成为问题。如果不是，则可以将其缓存在内存中。

# wcf - 从 WCF 服务生成 2.0 Web 服务代理时的 propertyNameFieldSpecified

> ID：133430
> 
> 赞同：0
> 
> 时间：2008-09-25T13:44:52.887
> 
> 标签：wcf, service

我从 Visual Studio 2008 创建了一个 Web 引用（添加 Web 引用），奇怪的是，我需要将我要提交的所有字段的*propertyNameField Specified 设置为 true。*如果不这样做，值将不会传递回 WCF 服务。

我在几个地方读到这已在 Visual Studio 的 RTM 版本中得到修复。为什么它仍然发生？

我的数据合同都是有效的，除了属性和列表。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T17:50:22.327

这是一个完整的答案：http: [//blogs.msdn.com/eugeneos/archive/2007/02/05/solving-the-disappearing-data-issue-when-using-add-web-reference-or-wsdl- exe-with-wcf-services.aspx](http://blogs.msdn.com/eugeneos/archive/2007/02/05/solving-the-disappearing-data-issue-when-using-add-web-reference-or-wsdl-exe-with-wcf-services.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T13:47:44.253

我在 VB.NET 中看到这种情况发生在具有可为空值的情况下，但 C# 具有“正确”代码。

也许一个想法是从 C# 项目中引用该服务。然后从您的 VB.NET 代码中引用该项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T13:57:39.643

我正在使用 C#。我怀疑它与自动属性有关，但没有运气。

这是一个示例类：

```
[DataContract]
public class BrowserBase : IBrowser
{

    [DataMember]
    public BrowserType BrowserType { get; set; }

    [DataMember]
    public IList<ResolutionBase> Resolutions { get; set; }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-17T14:52:41.640

XSD.EXE 工具是罪魁祸首。当您执行“添加 Web 引用”时，Visual Studio 将为所有引用类型生成类。为此，它使用 xsd.exe 工具。网上有 xsd.exe 的替代品

即：[http ://www.bware.biz/DotNet/Development/CodeXS/Article/Article_web.htm](http://www.bware.biz/DotNet/Development/CodeXS/Article/Article_web.htm)

但我还没有看到如何替换 Add Web Reference 的行为。

# java - 使用 Java Web 服务时如何访问 HttpServletRequest 对象

> ID：133436
> 
> 赞同：15
> 
> 时间：2008-09-25T13:45:52.867
> 
> 标签：java, web-services, annotations, servlets

我正在使用 Java 6、Tomcat 6 和 Metro。我使用 WebService 和 WebMethod 注释来公开我的 Web 服务。我想获得有关请求的信息。我尝试了以下代码，但 wsCtxt 始终为空。我必须采取什么步骤才能使 WebServiceContext*不*为空。

换句话说：如何执行以下行来获取 wsCtxt 的非空值？

MessageContext msgCtxt = wsCtxt.getMessageContext();

```
@WebService
public class MyService{

  @Resource
  WebServiceContext wsCtxt;

  @WebMethod
  public void myWebMethod(){
    MessageContext msgCtxt = wsCtxt.getMessageContext();
    HttpServletRequest req = (HttpServletRequest)msgCtxt.get(MessageContext.SERVLET_REQUEST);
    String clientIP = req.getRemoteAddr();
  } 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T14:10:29.050

我建议您将变量从 wsCtxt 重命名为 wsContext 或将 name 属性分配给 @Resource 注释。@Resource 上的[J2ee 教程](http://java.sun.com/javaee/5/docs/tutorial/doc/bncjk.html)指出变量的名称用作查找的一部分。我在 Glassfish 中使用资源注入注入不同类型的资源时遇到了同样的问题。

虽然您的正确名称可能不是 wsContext。我正在关注这个[java 提示](http://www.java-tips.org/java-ee-tips/java-api-for-xml-web-services/using-jax-ws-based-web-services-wit.html)。如果你喜欢变量名 wsCtxt，那么在变量声明中使用 name 属性：

> `@Resource(name="wsContext") WebServiceContext wsCtxt;`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T13:50:10.030

以下代码适用于我使用 Java 5、Tomcat 6 和 Metro

可能是 Java 6 中的 WS 支持与您使用的 Metro 版本之间存在冲突。您是否在 Java 5 版本上尝试过它？

```
@WebService
public class Sample {
    @WebMethod
    public void sample() {
        HttpSession session = findSession();
        //Stuff

    }
    private HttpSession findSession() {
        MessageContext mc = wsContext.getMessageContext();
        HttpServletRequest request = (HttpServletRequest)mc.get(MessageContext.SERVLET_REQUEST);
        return request.getSession();
    }
    @Resource
    private WebServiceContext wsContext;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T12:37:06.603

我仍然有这个问题。这是我的解决方法是编写一个 ServletRequestListener 将请求放入 ThreadLocal var。然后WebService就可以从ThreadLocal获取请求了。换句话说，我正在重新实现一些对我不起作用的东西。

这是监听器：

```
import javax.servlet.ServletRequest;
import javax.servlet.ServletRequestEvent;
import javax.servlet.ServletRequestListener;

public class SDMXRequestListener implements ServletRequestListener {

    public SDMXRequestListener() {
    }

    public void requestDestroyed(ServletRequestEvent event) {
    }

    public void requestInitialized(ServletRequestEvent event) {
        final ServletRequest request = event.getServletRequest();
        ServletRequestStore.setServletRequest(request);
    }

} 
```

这是 ThreadLocal 包装器：

```
import javax.servlet.ServletRequest;

public class ServletRequestStore {

    private final static ThreadLocal<ServletRequest> servletRequests = new ThreadLocal<ServletRequest>();

    public static void setServletRequest(ServletRequest request) {
        servletRequests.set(request);
    }

    public static ServletRequest getServletRequest() {
        return servletRequests.get();
    }

} 
```

和 web.xml 接线：

```
 <listener>
        <listener-class>ecb.sdw.webservices.SDMXRequestListener</listener-class>
    </listener> 
```

Web 服务使用以下代码获取请求：

> 最终 HttpServletRequest 请求 = (HttpServletRequest) ServletRequestStore.getServletRequest();

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T14:06:15.673

也许 javax.ws.rs.core.Context 注释是你正在寻找的，而不是资源？

# c# - 可以通过编程方式终止 TCP/IP 堆栈吗？

> ID：133442
> 
> 赞同：3
> 
> 时间：2008-09-25T13:46:42.693
> 
> 标签：c#, tcp

我们的服务器应用程序正在侦听一个端口，一段时间后它不再接受传入的连接。（虽然我很想解决这个问题，但这不是我在这里要问的；）

奇怪的是，当我们的应用程序停止接受端口 44044 上的连接时，IIS（在端口 8080 上）也是如此。杀死我们的应用程序可以解决所有问题 - IIS 再次开始响应。

那么问题来了，一个应用程序会搞乱整个 TCP/IP 堆栈吗？或者，应用程序如何做到这一点？

毫无意义的细节：我们的应用程序是在 XP/SP2 上的 .Net 2.0 下用 C# 编写的。

澄清：IIS 没有“拒绝”尝试的连接。它永远不会看到它们。客户端收到“服务器未及时响应”消息（使用 .Net TCP 客户端。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T17:03:02.020

你可能会饿死堆栈。在每秒高打开/关闭事务的环境中很容易耗尽，例如服务大量未合并请求的网络服务器。

默认的 TIME-WAIT 延迟会加剧这种情况 - 套接字在被回收之前必须关闭的时间默认为 90 秒（如果我没记错的话）

有一堆可以调整的注册表键 - 建议至少创建/编辑以下键

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters

TcpTimedWaitDelay = 30
MaxUserPort = 65534 
MaxHashTableSize = 65536 
MaxFreeTcbs = 16000 
```

MSDN 和 Technet 上有大量关于这些键功能的文档。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T13:50:59.017

您还没有用尽可用的端口句柄吗？
`netstat -a`

当应用程序打开和关闭端口（但实际上并没有正确关闭它们）时，我看到了类似的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T13:52:17.783

发生这种情况时，使用 netstat -a 查看活动连接。也许，您的服务器应用程序没有关闭/处理“关闭”连接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T18:41:41.260

来自大家的好建议，感谢您的帮助。

所以这就是发生的事情：事实证明，我们有几个服务竞争同一个端口，并且大多数时候“适当的”服务会获得端口。有时，第二个服务会抢走端口，而第一个服务会尝试打开另一个端口。从那时起，服务将在每次处理请求时不断获取新端口（因为它们没有使用首选端口），最终我们将耗尽所有可用端口。

当然，实际的问题是：“一个应用程序能搞乱整个 TCP/IP 堆栈吗？”，这个问题的答案是：是的。一种方法是监听一大堆端口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T13:54:09.073

我猜 RichS 的端口号注释是正确的。

除此之外，TCP/IP 堆栈只是您操作系统中的一个模块，因此可能存在可能允许应用程序杀死它的错误。它不会是第一个被程序杀死的司机。

（向 Andrew Tanenbaum 致敬，他坚持认为操作系统应该是模块化的，而不是单一的。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T22:20:02.663

我自己也遇到过几次类似的情况。一个好的故障排除步骤是尝试从受影响的机器连接到当时没有遇到任何连接问题的已知目的地。如果连接尝试失败，您很可能会在错误消息/代码中获得更多有趣的细节。例如，它可以说没有足够的句柄或内存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-07T07:45:37.770

从支持和系统管理员的角度来看，我只在极少数情况下（不止一次）看到过这种情况，但它肯定会发生。

在诊断问题时，应仔细排除可能的原因，而不是一出现故障就盲目重启系统。我之所以这么说，是因为与我合作的许多客户都想这样做。

# windows-xp - 带有 Service Pack 3 的 Windows XP 中的 IPSec AES 256 加密？

> ID：133453
> 
> 赞同：1
> 
> 时间：2008-09-25T13:48:05.610
> 
> 标签：windows-xp, aes, ipsec

Windows XP Sp3 中的 IPsec 是否支持 AES-256 加密？

**更新：**

1.  Windows IPsec FAQ 说它在 Windows XP 中不受支持，但也许他们在 Service Pack 3 中更改了它？
    http://www.microsoft.com/technet/network/ipsec/ipsecfaq.mspx
    问题：*是否支持高级加密标准 (AES) 加密？*

2.  origamigumby，请指定在哪里，因为我找不到它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T20:37:07.887

***编辑*** [http://technet.microsoft.com/en-us/library/dd125380.aspx](http://technet.microsoft.com/en-us/library/dd125380.aspx)表示我的原始链接（ [https://web.archive.org/web/1/http://search.techrepublic%2ecom% 2ecom/search/microsoft+windows+and+network+security.html](https://web.archive.org/web/1/http://search.techrepublic%2ecom%2ecom/search/microsoft+windows+and+network+security.html)）是错误的。

在 Vista 之前不支持它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T22:25:50.293

我正在使用 Windows XP SP3。当我添加新的 IPsec 过滤器规则时，我得到的 ESP 的唯一选项是 DES 和 3DES，因此常见问题解答是正确的 - 在 Windows Vista 之前不支持 AES。

# api - 哪些 DNS 具有 API 访问权限？

> ID：133458
> 
> 赞同：31
> 
> 时间：2008-09-25T13:49:33.373
> 
> 标签：api, service, dns

我在 slashdot 上看到了这一点，并意识到如果我可以将 dns 控制编程到我的一些应用程序中，那会让生活变得更轻松。[那边有人](http://ask.slashdot.org/comments.pl?sid=975011&cid=25146235)推荐了[dynect](http://dynect.com/features/api.html)，它显然有一个很棒的 api。不幸的是，没有很多其他的推荐。我对管理 dns 服务器一无所知，我主要使用灯堆栈，所以在 linux 上，我理解 bind 是要走的路，但除了基本设置之外，我会迷路。我宁愿外包细节。

哪些 DNS 服务具有 API 并且易于使用且无需花费大量资金？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-12-01T14:43:20.183

我想在过去的 3 年里，这是一个已解决的问题。以下是一些要检查的内容：

*   亚马逊现在有一个不错的 dns 服务[http://aws.amazon.com/route53/](http://aws.amazon.com/route53/)
*   如果您是客户，Linode 有一个免费的基于 api 的 dns。
*   如果您是客户，Dynadot 有一个带有 api 的收费 dns。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-11-12T20:36:32.623

嘿，我没用过，但 Zerigo 看起来很有希望。如果他们允许足够的主机，我们可能会最终选择他们。他们的 API 是标准的 REST 东西……非常简单。

[http://www.zerigo.com/docs/apis/dns/1.1](http://www.zerigo.com/docs/apis/dns/1.1)

谢谢，

埃里克。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T14:13:27.107

我们使用 DjbDNS，它被后端到 MySQL 上，所以我们只需点击数据库进行更改并定期重建配置数据。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-01-21T23:40:04.323

有没有人看到以下任何具有 API 的 DNS 提供商：

*   [http://durabledns.com/](http://durabledns.com/)
*   [https://dnsimple.com/](https://dnsimple.com/)（也支持API注册）
*   [http://www.loaddns.com/](http://www.loaddns.com/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-01T17:06:01.503

我们使用[Zonomi](http://zonomi.com)。它非常便宜，而且对我们来说从未失望过。使用 API

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-01T21:13:40.287

您可以尝试[http://customdns.ca](http://customdns.ca)。我有几个域 - 到目前为止没有问题。他们提供 RestFul API。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-02T14:06:18.260

[http://www.dns.com](http://www.dns.com)

以下是 API 文档的链接：

[https://github.com/dnsdotcom/API_DOC/](https://github.com/dnsdotcom/API_DOC/)

玩得开心！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-05-18T04:07:47.830

没用过api，但是我用registrar 10多年了，从来没有遇到过问题：namecheap.com

这是 API[介绍](https://www.namecheap.com/support/api/intro.aspx)。这是 API[方法列表](https://www.namecheap.com/support/api/methods.aspx)。

相当全面。从购买到主机和电子邮件转发设置。

# c# - 如何从 C# 中的 LinkedList 中删除与给定条件匹配的元素？

> ID：133487
> 
> 赞同：6
> 
> 时间：2008-09-25T13:55:49.023
> 
> 标签：c#, .net, data-structures

我有一个 LinkedList，其中 Entry 有一个名为 id 的成员。我想从 id 与搜索值匹配的列表中删除条目。最好的方法是什么？我不想使用 Remove()，因为 Entry.Equals 会比较其他成员，而我只想匹配 id。我希望做这样的事情：

```
entries.RemoveWhereTrue(e => e.id == searchId); 
```

编辑：有人可以为我重新打开这个问题吗？它不是重复的 - 它应该是重复的问题是关于 List 类的。List.RemoveAll 不起作用 - 这是 List 类的一部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T14:13:46.280

```
list.Remove(list.First(e => e.id == searchId)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T15:21:34.933

这是一个简单的解决方案：

```
list.Remove(list.First((node) => node.id == searchId)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T13:58:28.783

只需使用 Where 扩展方法。您将获得一个新列表 (IIRC)。

# vbscript - 检查有效的指南

> ID：133493
> 
> 赞同：2
> 
> 时间：2008-09-25T13:57:08.660
> 
> 标签：vbscript, guid

如何检查字符串是否是 vbscript 中的有效 GUID？有没有人写过 IsGuid 方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-09-07T14:23:36.243

此功能在经典 ASP 中工作：

```
Function isGUID(byval strGUID)
      if isnull(strGUID) then
        isGUID = false
        exit function
      end if
      dim regEx
      set regEx = New RegExp
      regEx.Pattern = "^({|\()?[A-Fa-f0-9]{8}-([A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}(}|\))?$"
      isGUID = regEx.Test(strGUID)
      set RegEx = nothing
End Function 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T14:04:51.870

这类似于[c# 中的相同问题](https://stackoverflow.com/questions/104850/c-test-if-string-is-a-guid-without-throwing-exceptions#104932)。这是您需要的正则表达式...

^[A-Fa-f0-9]{32}$|^({|()?[A-Fa-f0-9]{8}-([A-Fa-f0-9]{4}-) {3}[A-Fa-f0-9]{12}(}|))?$|^({)?[0xA-Fa-f0-9]{3,10}(, {0,1}[ 0xA-Fa-f0-9]{3,6}){2}, {0,1}({)([0xA-Fa-f0-9]{3,4}, {0,1}){7 }[0xA-Fa-f0-9]{3,4}(}})$

但这只是初学者。您还必须验证日期/时间等各个部分是否在可接受的范围内。要了解测试有效 GUID 的复杂程度，请查看其中一个 Guid 构造函数的源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T14:02:49.660

在 VBScript 中，您可以使用 RegExp 对象通过正则表达式匹配字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-19T11:58:35.937

Techek 的功能在经典 ASP (vbScript) 中对我不起作用。由于某种奇怪的原因，它总是返回 True 。通过一些小的改动，它确实奏效了。见下文

```
Function isGUID(byval strGUID)
  if isnull(strGUID) then
    isGUID = false
    exit function
  end if
  dim regEx
  set regEx = New RegExp
  regEx.Pattern = "{[0-9A-Fa-f-]+}"
  isGUID = regEx.Test(strGUID)
  set RegEx = nothing
End Function 
```

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-06-25T09:14:52.110

还有另一种解决方案：

```
try
{
  Guid g = new Guid(stringGuid);
  safeUseGuid(stringGuid); //this statement will execute only if guid is correct
}catch(Exception){} 
```

# ruby - Ruby 到 Actionscript3 字节码

> ID：133506
> 
> 赞同：5
> 
> 时间：2008-09-25T13:59:45.503
> 
> 标签：ruby, actionscript-3, compiler-construction

嗨，我正在研究 Ruby 到 actionscript 3 字节码编译器，发现提到了一个名为 Red Sun 的项目，但可以找到的信息很少。

所以我的问题是......有哪些工具可以将 Ruby 源代码转换为 AS3 字节码

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T15:42:48.720

我是 Red Sun 项目的首席开发人员。信息很少，因为它真的还没有准备好使用。我在 360|Flex San Jose 开发了最初的原型并将其展示给了少数人。这引起了进一步的兴趣，并鼓励我为[RubyConf](http://rubyconf.org)提出它，为此接受了关于 Red Sun 的[介绍性演讲](http://rubyconf.org/talks/81)。

从那时起，我有时间充实框架并真正看到什么是可能的。我将很快公开概述所有这些内容，但由于其局限性，我决定放弃生成 ActionScript 3 字节码的想法。Ruby 和 ActionScript 有点相似，但 Ruby 在其方法分派语义上有一些显着差异，这需要 ActionScript 中的任何实现都使用自定义方法查找解决方案。也许可以在 JavaScript 中完成，但是 ActionScript 3 不允许重新分配原型字段以指向不同的对象，并且 Ruby 依赖于在运行时修改继承层次结构。

RubyConf 的演讲将于 11 月 8 日星期六举行。[您可以在http://github.com](http://github.com)上跟踪 Red Sun 的发展，点击此处[http://github.com/jonathanbranam/redsun](http://github.com/jonathanbranam/redsun)，我将在我的网站[http://jonathanbranam.net](http://jonathanbranam.net)上发布信息。我计划推出一个网站，只是为了提供有关 Red Sun 的信息，但尚未完成以分享链接。

Red Sun 不包含 Ruby 解析器或编译器，因此它依赖于由真正的 Ruby 1.9 实现生成的 Ruby 1.9 字节码。它目前基于 1.9.0-4，如果与此版本有偏差，可能需要更改。就功能而言，截至目前（2008 年 10 月 27 日），它支持基本的方法调度、类和模块。就是这样。标准库尚未移植，我希望在其中很大一部分依赖 Rubinius。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T20:03:00.763

我不知道任何 Ruby->AS3 转换器，但在未来，[Iron Monkey](https://wiki.mozilla.org/Tamarin:IronMonkey)可能会让在 Tamarin（AS3 虚拟机）上运行 Ruby 成为可能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T21:29:21.233

顺便说一句，我很确定您可以在 Ruby 中做一些在 AS3 中无法做到的事情，因此任何转换器可能只能转换 Ruby 代码的子集。

# asp.net - 使用 SqlMetal 和 Visual Studio 时自动生成 DataContext 设计器文件

> ID：133515
> 
> 赞同：5
> 
> 时间：2008-09-25T14:00:59.337
> 
> 标签：asp.net, visual-studio-2008, linq-to-sql, dbml, sqlmetal

我正在使用[SqlMetal](http://msdn.microsoft.com/en-us/library/bb386987.aspx)为使用 LinqToSql 的 ASP.net 应用程序通用我的 DataContext.dbml 类。当我最初创建 DataContext.dbml 文件时，Visual Studio 使用它来创建相关的 DataContext.designer.cs 文件。此设计器文件包含 C# 中的 DataContext 类，该类在整个应用程序中使用（并且从 dbml 文件中的 XML 派生），对于弥合 SqlMetal 的输出和使用带有 LinqToSql 的 DataContext 之间的差距至关重要。

但是，当我对数据库进行更改并重新创建 dbml 文件时，设计器文件永远不会在我的网站中重新生成。而是保留旧的设计器文件（因此对 DBML 文件的任何更改都不能通过 LinqToSql DataContext 类访问）。

到目前为止，我能够用来重新生成设计器文件的唯一过程是

1.  转到 Windows 资源管理器并删除 dbml 和 Designer.cs 文件
2.  转到 Visual Studio 并在解决方案资源管理器中点击刷新。dbml 和 Designer.cs 文件现在从项目中消失了。
3.  使用 SqlMetal 重新生成 dbml 文件
4.  转到 Visual Studio 并在解决方案资源管理器中点击刷新。现在重新创建了 Designer.cs 文件。

似乎 Visual Studio 只会在检测到新的 dbml 文件但还没有 Designer.cs 文件时才会生成 Designer.cs 文件。这个过程非常不切实际，因为它涉及几个手动步骤，并且会弄乱源代码控制。

有谁知道我如何可以自动重新生成 Designer.cs 文件，而无需遵循上述手动删除/刷新/重新生成/删除过程？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T17:20:13.587

当您在 Visual Studio 中更改 DBML 时，designer.cs 文件通常会自动维护。如果重新创建 DBML 时 VS 没有运行，它可能不知道。

检查 Visual Studio 中的 .DBML 文件是否将自定义工具属性设置为 MSLinqToSQLGenerator。如果不是，则将其设置为该值。如果是在进行更改后尝试右键单击 DBML 并选择运行自定义工具以查看是否更新了 .designer.cs。

您还可以使用 SqlMetal 生成类文件：

```
sqlmetal /code:DataContext.designer.cs /language:csharp DataContext.dbml 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-23T18:18:42.187

不知道它是怎么做到的，但这里有一些我努力让它回来的事情。

它被锁定了，所以它生成了一个新的 db.designer.cs 文件 (db1.designer.cs)。

我无法比较打开，将该文件与前一个文件进行比较（BC不应该锁定，我认为这不是问题，以前从未遇到过这个问题。）

在记事本中打开项目文件并查找这些条目，我在源代码管理中恢复到以前的版本..

这是我带回来的。

```
<Compile Include="db.designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>db.dbml</DependentUpon>
</Compile>

 ... 

<LastGenOutput>db.designer.cs</LastGenOutput> 
```

lastgenOutput 设置为 db1.desginer.cs

# language-design - Fantom 编程语言的第一印象？

> ID：133528
> 
> 赞同：13
> 
> 时间：2008-09-25T14:02:56.180
> 
> 标签：language-design, fantom

这里有没有人试用过[Fantom 编程语言](http://www.fandev.org)？（双关语）。

我的第一印象：

*   我喜欢让代码在 .NET 或 Java VM 上运行的能力。
*   语法很好很干净，没有尝试任何花哨的东西。
*   我相信“库就是语言”，Fan 的开发者[相信他们的 USP 就是他们的 API](http://fandev.org/doc/docIntro/WhyFan.html)：

> 但是让一种语言同时在 Java 和 .NET 上运行是很容易的部分——事实上，这个问题有很多解决方案。困难的部分是获得可移植的 API。Fan 提供了一组抽象出 Java 和 .NET API 的 API。实际上，我们认为这是 Fan 的主要优势之一，因为它使我们有机会开发一套与 Java 和 .NET 对应部分相比更优雅且易于使用的系统 API。

还有其他想法，第一印象，利弊吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T14:08:04.017

它看起来非常受 Ruby 的启发。它说它是 RESTful 的，但我不知道具体如何。与[boo](http://en.wikipedia.org/wiki/Boo_(programming_language))相比，后者更成熟但在许多方面都相似（不过，它的语法是受 Python 启发的）。

保持泛型和命名空间非常有限的设计决策是有问题的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T23:25:16.360

我认为他们的解释总结了这一点：

> “我们创建 Fan 的主要原因是编写可以在 Java VM 和 .NET CLR 上无缝运行的软件。现实情况是，许多软件组织都致力于这些平台中的一个或另一个。”

它看起来并不比所有其他非 JVM/.NET 语言更好。在没有关于他们的任何信息的情况下（他们的博客只是一个错误页面），我看不出他们为什么一定会比其他人更正确。 *每种*语言开始时都相当优雅，因为它的设计目的是为了（尽管我在刚才看到的小范代码中看到了一些尴尬）——真正的问题是它如何适应全新的事物，我们只是简单地还不知道。

但是，如果您的组织有“一切都必须在我们的 VM 上运行”的规则，那么这对您来说可能是一个可以接受的折衷方案。

仅仅为了虚拟机的独立性，你就放弃了很多。例如，你的问题是关于 SO 的第一个 Fan 问题——比 Lisp 少几个*数量级。*

对于什么问题，范是最好的解决方案？Python 和 Ruby 已经可以在这两种虚拟机上运行（或者两者都没有），拥有大型社区和大型库，并且似乎具有大致相同的抽象级别，但要成熟得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-13T05:36:16.720

直到几周前我才听说范。从网站上看，它大约一岁，所以还很年轻，未经证实。然而，有几个有趣的点：首先，该语言通过提供一个参与者模型（类似于 erlang）和支持不可变对象来解决并发问题。其次，该对象遵循具有类型推断的 Scala 示例。类型推断允许程序员省略类型声明，但由编译器计算它，提供了与动态类型语言一样的代码更短、更清晰的优势，同时保留了静态类型语言的效率。最后，它似乎是一种非常快的语言，几乎与 Java 一样快，并且非常接近或击败 JM 上第二快的语言：scala。显示性能的基准可以在以下位置找到[http://www.slideshare.net/michael.galpin/performance-comparisons-of-dynamic-languages-on-the-java-virtual-machine?type=powerpoint](http://www.slideshare.net/michael.galpin/performance-comparisons-of-dynamic-languages-on-the-java-virtual-machine?type=powerpoint)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T22:12:25.787

这很有趣。

创建 Java（或 C#）是为了通过创建 JVM（或 CLR）来消除平台依赖性，该 JVM（或 CLR）将在运行时将代码编译成特定的机器代码。

现在，有一种语言是**独立于虚拟机**的吗？嗯....什么鬼？！？！

再说一次，这是一个非常有趣的话题，这可能是未来......:) 去一个通用的单一语言

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T23:32:08.497

我认为它看起来像是一种很棒的语言功能，但我不确定它有多大用处。我认为针对 .NET 和 JVM 并不是那么有用。Java 已经是跨平台的，.NET 也是，与 Mono。通过以两个 VM 为目标，您必须仅使用两者都可用的 API。您不能使用任何可用于 Java 和 .NET 的优秀原生 API。我无法想象他们的 API 与 Java 或 .NET 中的任何一个一样完整。

# c - 阅读 /dev/urandom 是线程安全的吗？

> ID：133546
> 
> 赞同：10
> 
> 时间：2008-09-25T14:07:25.953
> 
> 标签：c, multithreading, random, posix

这是代码：

```
 `unsigned int number;
  FILE* urandom = fopen("/dev/urandom", "r");
  if (urandom) {
    size_t bytes_read = fread(&number, 1, sizeof(number), urandom);
    DCHECK(bytes_read == sizeof(number));
    fclose(urandom);
  } else {
    NOTREACHED();
  }` 
```

`如果不是，我如何使它成为线程安全的？`

 `* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T14:10:11.577

只要函数的每次执行都在自己的线程中（即，局部变量`number`, `urandom`,`bytes_read`不在线程之间共享），我看不到任何线程安全问题。然后每个线程都有自己的文件描述符到`/dev/urandom`. `/dev/urandom`可以从多个进程同时打开，所以没关系。

顺便说一句，`/dev/urandom`可能无法打开，您的代码应该处理它。一些原因是：可用的文件描述符用完；`/dev`没有正确安装（尽管在这种情况下你有更大的问题）；您的程序正在以`chroot`拒绝访问任何设备的特殊方式运行；等等

# .net - .NET Windows 集成身份验证

> ID：133549
> 
> 赞同：1
> 
> 时间：2008-09-25T14:07:49.103
> 
> 标签：.net, security, authentication, windows-authentication

我正在寻找将扩展添加到现有协议（不能轻易更改实际协议）以允许用户在 .NET 中进行 Windows 身份验证（NTLM？）的最佳/最简单方法。我已经查看了 AuthenticationManager 类，但它要求我使用 Web(Http)Request 这不是一个选项。NegotiateStream 是一种选择，因为我想将其集成到现有协议中，而不是将其包装到新协议中。除了这两个之外，我还有其他选择吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-25T14:17:43.820

我假设由于您无法执行 HTTPRequest，因此这是一款桌面软件。

Active Directory 和 LDAP 是您最有可能使用的协议。

我认为[System.Environment](http://msdn.microsoft.com/en-us/library/system.environment.aspx)和[System.DirectoryServices](http://msdn.microsoft.com/en-us/library/system.directoryservices.aspx)将是开始的地方。

我喜欢[DirectorySearcher](http://msdn.microsoft.com/en-us/library/system.directoryservices.directorysearcher.aspx)和[Environment.UserName](http://msdn.microsoft.com/en-us/library/system.environment.username.aspx)来获取有关用户的任何信息。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T14:29:56.303

如果您只能扩展您的协议，那么执行此操作的一种方法是编写您自己的 Stream 类，然后将其传递给 NegotiateStream，然后将 NegotiateStream 提供给您的消息放入您自己的协议中，然后通过您的协议将响应返回给 NegotiateStream流类。但如果可能的话，最简单的方法是将整个协议（流）包装在 NegotiateStream 中......

# ruby-on-rails - 在观察者中访问会话的好主意吗？

> ID：133558
> 
> 赞同：7
> 
> 时间：2008-09-25T14:08:52.907
> 
> 标签：ruby-on-rails, ruby, session, logging, observers

我想在我的 Ruby on Rails 应用程序中记录用户的操作。

到目前为止，我有一个模型观察器，它在更新和创建后将日志插入数据库。为了存储哪个用户执行了记录的操作，我需要访问会话，但这是有问题的。

首先，它打破了MVC模型。其次，技术范围从 hackish 到古怪，甚至可能将实现与 Mongrel 服务器捆绑在一起。

正确的做法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T21:46:55.397

嗯，这是一个棘手的情况。您几乎必须违反 MVC 才能使其正常工作。

我会做这样的事情：

```
class MyObserverClass < ActiveRecord::Observer
  cattr_accessor :current_user # GLOBAL VARIABLE. RELIES ON RAILS BEING SINGLE THREADED

  # other logging code goes here
end

class ApplicationController
  before_filter :set_current_user_for_observer

  def set_current_user_for_observer
    MyObserverClass.current_user = session[:user]
  end
end 
```

它有点hacky，但它并不比我见过的许多其他核心rails 更hacky。

您需要做的就是使其成为线程安全的（这仅在您在 jruby 上运行时才重要）是将 cattr_accessor 更改为正确的方法，并将其数据存储在线程本地存储中

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T15:09:13.277

我觉得这是一个非常有趣的问题。我会在这里大声思考一下......

最终，我们面临的是为了实现一组特定功能而违反设计模式可接受实践的决定。所以，我们必须问问自己

*1）不*违反MVC模式的可能解决方案是什么

2) 有哪些可能*违反*MVC 模式的解决方案

3) 哪个选项最好？我认为设计模式和标准实践非常重要，但同时如果坚持它们会使您的代码更加复杂，那么正确的解决方案很可能是违反实践。有些人可能不同意我的观点。

让我们首先考虑#1。

在我的脑海中，我会想到以下可能的解决方案

A）如果你真的对谁在执行这些操作感兴趣，这些数据是否应该以任何方式存储在模型中？它将使您的观察者可以使用此信息。这也意味着您的 ActiveRecord 类的任何其他前端调用者都可以获得相同的功能。

B）如果您对了解谁创建了条目并不真正感兴趣，但对记录 Web 操作本身更感兴趣，那么您可能会考虑“观察”控制器操作。自从我研究 Rails 源代码以来已经有一段时间了，所以我不确定他们的 ActiveRecord::Observer 是谁“观察”了该模型，但您也许可以将其调整为控制器观察者。从这个意义上说，您不再观察模型，向该观察者提供会话和其他控制器类型数据信息是有意义的。C) 具有最少“结构”的最简单的解决方案是简单地将日志记录代码放在您正在观看的操作方法的末尾。

现在考虑选项 #2，打破 MVC 实践。

A）正如您所建议的，您可以找到让模型观察者访问会话数据的方法。您已将模型与业务逻辑耦合。

B）在这里想不出其他人：）

如果我想将人员附加到记录中，我个人的倾向是 1A，如果我想将人员附加到记录，或者只有少数地方我有兴趣这样做，我个人的倾向是 1A。如果您真的想要为您的所有控制器和操作提供强大的日志记录解决方案，您可以考虑 1B。

让您的模型观察者查找会话数据有点“臭”，如果您尝试在任何其他项目/情况/上下文中使用您的模型，可能会中断。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T15:00:07.073

你是对的，它打破了 MVC。我建议在您的控制器中使用回调，主要是因为在某些情况下（例如调用保存但验证失败的模型）您不希望观察者记录任何内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T04:53:21.657

我找到了一种干净的方法来做我选择的答案所建议的事情。

[http://pjkh.com/articles/2009/02/02/creating-an-audit-log-in-rails](http://pjkh.com/articles/2009/02/02/creating-an-audit-log-in-rails)

该解决方案使用 AuditLog 模型和 TrackChanges 模块向任何模型添加跟踪功能。它仍然需要您在更新或创建时向控制器添加一行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-03T10:04:43.063

过去，在做这样的事情时，我倾向于扩展 User 模型类以包含“当前用户”的想法

查看先前的答案，我看到了将实际活动记录用户存储在会话中的建议。这有几个缺点。

*   它在会话数据库中存储了一个可能很大的对象
*   这意味着用户的副本一直被“缓存”（或直到强制注销）。这意味着在用户注销并重新登录之前，不会识别此用户状态的任何更改。这意味着例如，尝试禁用用户将等待他注销并重新登录。这可能不是您想要的行为。

因此，在请求开始时（在过滤器中），您从会话中获取 user_id 并读取用户，设置 User.current_user。

像这样的东西...

```
类用户
  cattr_accessor :current_user
结尾

类应用
  before_filter :retrieve_user

  def 检索用户
    如果会话[：user_id].nil？
      User.current_user = nil
    别的
      User.current_user = User.find(session[:user_id])
    结尾
  结尾
结尾

```

从那时起，它应该是微不足道的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-28T13:22:22.290

[http://www.zorched.net/2007/05/29/making-session-data-available-to-models-in-ruby-on-rails](http://www.zorched.net/2007/05/29/making-session-data-available-to-models-in-ruby-on-rails)

# .net - 如何以事务方式使用远程 MSMQ？

> ID：133559
> 
> 赞同：8
> 
> 时间：2008-09-25T14:09:01.410
> 
> 标签：.net, transactions, msmq

我正在编写一个 Windows 服务，它从 MSMQ 中提取消息并将它们发布到遗留系统 (Baan)。如果发帖失败或发帖过程中机器宕机，我不想丢失消息。因此，我使用 MSMQ 事务。失败时我中止，成功时我承诺。

在处理本地队列时，此代码运行良好。但在生产中，我希望将运行服务的机器（或机器）与队列本身分开。当我针对远程队列进行测试时，抛出 System.Messaging.MessageQueueException：“事务使用无效。”

我已验证有问题的队列是事务性的。

这是从队列接收的代码：

```
// Begin a transaction.
_currentTransaction = new MessageQueueTransaction();
_currentTransaction.Begin();

Message message = queue.Receive(wait ? _queueTimeout : TimeSpan.Zero, _currentTransaction);
_logger.Info("Received a message on queue {0}: {1}.", queue.Path, message.Label);
WORK_ITEM item = (WORK_ITEM)message.Body;
return item; 
```

## 回答

我已经切换到[SQL Service Broker](http://www.developer.com/db/article.php/3640771)。它支持远程事务接收，而 MSMQ 3.0 不支持。而且，作为额外的奖励，它已经使用了我们集群和备份的 SQL Server 实例。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T14:26:12.100

我留下了一条评论，询问您正在使用的 MSMQ 版本，因为我认为这是您的问题的原因。事务接收未在早期版本的 MSMQ 中实现。如果是这种情况，那么这篇[博](http://blogs.msdn.com/johnbreakwell/archive/2007/12/11/how-do-i-get-transactional-remote-receives.aspx)文将解释您的选择。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T14:23:49.813

如果 MSDTC 在两台机器上都运行，则使用 TransactionScope 应该可以工作。

```
MessageQueue queue = new MessageQueue("myqueue");
using (TransactionScope tx = new TransactionScope()) {
    Message message = queue.Receive(MessageQueueTransactionType.Automatic);
    tx.Complete();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:56:34.657

我已经切换到[SQL Service Broker](http://www.developer.com/db/article.php/3640771)。它支持远程事务接收，而 MSMQ 3.0 不支持。而且，作为额外的奖励，它已经使用了我们集群和备份的 SQL Server 实例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T10:55:42.797

为了使用事务范围，您必须在验证 MSDTC 已安装且远程客户端连接已激活之前。

安装 MSDTC 不是问题，但激活远程客户端连接必须导致服务器重新启动（在 windows server 2003 上就是这种情况）。

也许这篇文章可以帮助你： [如何激活 MSDTC 和远程客户端连接](http://social.msdn.microsoft.com/forums/en-US/adodotnetdataproviders/thread/7172223f-acbe-4472-8cdf-feec80fd2e64)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-16T09:41:45.660

避免使用远程 MSMQ（否则升级到 MSMQ 4.0 以支持远程 MSMQ 事务）。1) 或者，您可以创建一个 Web 服务来推送消息 2) 为交易目的创建本地 MSMQ 3) 创建具有捆绑（批次）编号和消息编号的小型实用程序...一旦批处理失败，请删除目标处的消息，否则请执行此操作作为交易范围

# asp.net - 英国邮政编码查找流程的好例子

> ID：133567
> 
> 赞同：4
> 
> 时间：2008-09-25T14:10:53.930
> 
> 标签：asp.net, user-interface, postal-code

作为电子商务帐户注册的一部分，我正在寻找一个设计良好的英国邮政编码查询流程。

我们正在重新设计我们的，想看看那里有什么，以及我如何使它尽可能友好。

- 更新 -

基本上，我们当前的设计是一个手动输入表单（工作得很好），一个经验不足的开发人员然后将邮政编码查找固定在该表单上。

所以当前顺序为：Country, Line1, Line2, Line3, Town, County, Postcode。他只是在底部放了一个查找按钮。所以用户逐行查看，然后查看邮政编码并使用查找。

由于答案中关于允许手动覆盖的观点，我希望看到其他一些人在行动。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T14:16:51.997

无论哪种方式，请确保您包含手动地址覆盖（即允许用户在没有查找帮助的情况下输入他们的地址）。我住在一个新建的地址，它还没有出现在每个人的数据库中。大约 50% 的时间我无法在电子商务网站上注册。很烦人。

:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T14:14:19.367

简单的门牌号\姓名和邮政编码提示有什么问题？

也许您可以说出您当前的查找是如何工作的，以及为什么感觉需要重新设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-12T09:56:51.973

只是一个想法——为什么不看看主要的 PAF 经销商是如何在他们的网站上做到这一点的——他们会比大多数人（你会想）投入更多的心思。

例如 QAS、Postcodesoftware.co.uk、Hopewiser，甚至是皇家邮政本身

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T14:24:35.100

你的意思是问：

1.  房屋名称或编号：
2.  邮政编码：

然后打电话给 Capscan、Equifax（特别是如果你稍后会进行信用搜索，因为在这种情况下他们的地址匹配是免费的）、邮局，还是等等？

然后显示以与用户验证（或显示列表以供选择）。

除了手动输入地址的选项外，您仍然应该在后台尝试匹配地址，以便获得唯一的地址密钥。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T14:31:05.023

啊，我明白了；我见过的最好的有一个“侧边栏”，您可以在其中输入您的邮政编码/号码并按查找；然后将填写地址字段，您可以根据需要覆盖这些字段。

这样，您就有了手动输入的正常地址流程，并且您最终不会将邮政编码放在首位。

如果我现在能找到一个例子，那该死的！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-15T10:52:36.040

我发现效果很好：

1.  国家（默认为英国）
2.  邮政编码+“查找地址”按钮
3.  邮政编码查找结果框/下拉列表（仅在单击按钮时显示）

在选择地址、将国家/地区更改为非英国或发生某些错误（例如，查找服务器超时或未找到邮政编码）之前，表格的其余部分将被隐藏

1.  街道（1 - 3 条线，最好是 2 条）
2.  镇

这使事情变得简单并且运作良好，因为您的大多数访问者都来自英国。对于非英国游客，“查找地址”按钮应该被隐藏，对于额外的点，您可以将邮政编码字段移动到城镇下方。

一个可选的附加功能是也为非英国游客显示州/县字段 - 在某些国家/地区，这是地址的重要组成部分。在英国，郡县被皇家邮政忽略，应将其排除在您的表格之外（更短的表格，更好的可用性）。

希望这可以帮助！

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-25T14:27:07.713

要正确进行查找，您必须使用邮局的邮政地址文件 (PAF)。它很昂贵，而且在哪里可以使用它是有限制的——你不能将它包含在产品中。但它确实列出了每所房子的正确地址。

# c++ - C ++中的哈希表？

> ID：133569
> 
> 赞同：56
> 
> 时间：2008-09-25T14:11:32.103
> 
> 标签：c++, performance, map, hashtable, complexity-theory

每当我需要存储与特定类型的值（键值 - 例如字符串或其他对象）关联的一些数据时，我通常使用 C++ stdlib 映射。stdlib 映射实现基于树，它提供比标准数组或 stdlib 向量更好的性能 (O(log n))。

我的问题是，你知道任何提供更好性能（O（1））的 C++“标准”哈希表实现吗？类似于 Java API 的 Hashtable 类中可用的东西。

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2008-09-25T14:15:41.893

如果您使用的是 C++11，则可以访问`<unordered_map>`和`<unordered_set>`标头。这些提供类[`std::unordered_map`](http://en.cppreference.com/w/cpp/container/unordered_map)和[`std::unordered_set`](http://en.cppreference.com/w/cpp/container/unordered_set).

如果您将 C++03 与 TR1 一起使用，则可以使用相同的标头访问类`std::tr1::unordered_map`和`std::tr1::unordered_set`（除非您使用的是 GCC，在这种情况下，标头是`<tr1/unordered_map>`and `<tr1/unordered_set>`）。

在所有情况下，也有相应的`unordered_multimap`和`unordered_multiset`类型。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-25T14:28:21.363

如果您还没有 unordered_map 或 unordered_set，它们是[boost](http://www.boost.org/)的一部分。
[这是两者的文档](http://www.boost.org/doc/libs/1_36_0/doc/html/unordered.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T14:15:52.110

这里有很多人提到的[hash_map](http://www.sgi.com/tech/stl/hash_map.html)对象，但它不是 stl 的一部分。它是一个 SGI 扩展，所以如果你在 STL 中寻找某些东西，我认为你不走运。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T14:17:51.653

Visual Studio`stdext::hash_map`在 header 中有这个类`<hash_map>`，而 gcc`__gnu_cxx::hash_map`在同一个 header 中有这个类。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-25T14:58:45.953

std::tr1::unordered_map，在`<unordered_map>`

如果您没有 tr1，请获取 boost，并在 in 中使用 boost::unordered_map`<boost/unordered_map.hpp>`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T14:14:29.413

参见SGI 的[std::hash_map](http://www.sgi.com/tech/stl/hash_map.html)。

这也包含在[STLPort](http://www.stlport.com/doc/index.html)发行版中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T14:20:31.177

[GNU 的libstdc++](http://gcc.gnu.org/onlinedocs/libstdc++/libstdc++-html-USERS-4.3/a00210.html)也支持 hash_map 。

Dinkumware 也[支持](http://dinkumware.com/manuals/?manual=compleat&page=hash_map.html#hash_map)这一点，这意味着很多实现都会有一个 hash_map（我认为即使是 Visual C++ 也提供了 Dinkumware）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T14:28:32.173

如果您的编译器有可用的 TR1 扩展，请使用它们。如果没有，boost.org 有一个非常相似的版本，除了 std:: 命名空间。在这种情况下，请放入 using 声明，以便稍后切换到 std::。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-25T14:14:20.337

[std::hash_map](http://www.sgi.com/tech/stl/hash_map.html)

# php - 如何在php中将多个 标签转换为单个标签

> ID：133571
> 
> 赞同：15
> 
> 时间：2008-09-25T14:12:16.470
> 
> 标签：php, html, regex

想转换

```
<br/>
<br/>
<br/>
<br/>
<br/> 
```

进入

```
<br/> 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-25T14:17:39.843

您可以使用正则表达式执行此操作：

```
preg_replace("/(<br\s*\/?>\s*)+/", "<br/>", $input); 
```

如果您传入源 HTML，这将返回一个字符串，其中单个 <br/> 替换它们的每次运行。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-25T14:24:09.267

[我的几乎与levik](https://stackoverflow.com/questions/133571/how-to-convert-multiple-br-tag-to-a-single-br-tag-in-php#133600)的 (+1)完全相同，只是考虑了一些不同的 br 格式：

```
preg_replace('/(<br[^>]*>\s*){2,}/', '<br/>', $sInput); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T14:43:41.683

增强的可读性，更短，无论属性如何都能产生正确的输出：

```
preg_replace('{(<br[^>]*>\s*)+}', '<br/>', $input); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-04T10:17:52.173

谢谢大家.. 使用 Jakemcgraw 的 (+1) 版本

刚刚添加了不区分大小写的选项..

```
{(<br[^>]*>\s*)+}i 
```

测试这些正则表达式的好工具是：

[http://www.spaweditor.com/scripts/regex/index.php](http://www.spaweditor.com/scripts/regex/index.php)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T14:15:51.220

使用正则表达式匹配`<br/>`一次或多次，然后使用 preg_replace （或类似的）替换为`<br/>`例如 levik 的回复。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T14:27:12.537

没有 preg_replace，但仅适用于 PHP 5.0.0+

```
$a = '<br /><br /><br /><br /><br />';
while(($a = str_ireplace('<br /><br />', '<br />', $a, $count)) && $count > 0)
{}
// $a becomes '<br />' 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T14:22:48.020

您可能想使用正则表达式。以下我没有测试过，但我相信它是正确的。

```
$text = preg_replace( "/(<br\s?\/?>)+/i","<br />", $text ); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-20T16:28:43.007

一种快速、非正则表达式的方法：

```
while(strstr($input, "<br/><br/>"))
{
    $input = str_replace("<br/><br/>", "<br/>", $input);
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-04-01T13:18:33.767

用户可以输入许多变体

```
<br>
<br/>
< br />
<br >
<BR>
<BR>< br> 
```

...和更多。

所以我觉得接下来会更好

```
$str = preg_replace('/(<[^>]*?br[^>]*?>\s*){2,}/i', '<br>', $str); 
```

# asp.net - 通过 CSS 设置单选按钮启用/禁用

> ID：133596
> 
> 赞同：2
> 
> 时间：2008-09-25T14:16:29.377
> 
> 标签：asp.net, javascript, css

有没有办法通过 CSS 启用/禁用（未选中/未选中）单选按钮？

我需要切换客户端上的一些单选按钮，以便可以在服务器上读取值，但是将“启用”属性设置为“假”然后通过 javascript 在客户端上更改它似乎阻止我发回任何启用后更改为单选按钮。

请参阅：[ASP.NET 没有看到单选按钮值更改](https://stackoverflow.com/questions/130165/aspnet-not-seeing-radio-button-value-change)

建议我改用 control.style.add("disabled", "true") ，但这似乎并没有为我禁用单选按钮。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T14:19:22.977

Disabled 是 html 属性，而不是 css 属性。

为什么你不能只使用一些 jQuery

```
$('#radiobuttonname').attr('disabled', 'true'); 
```

或普通的旧javascript

```
document.getElementById(id).disabled = true; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T14:21:39.367

据我所知，CSS 不会影响应用程序的功能。它只会影响显示。所以虽然你可以用 css (display:none) 隐藏它，但你不能禁用它。

您可以做的是在使用 javascript 的页面加载时禁用它。有几种方法可以做到这一点，但一个简单的方法是做类似的事情

```
<script>document.getElementById('<%=CONTROLID%>').disabled=true;</script> 
```

并将其放在body标签下方顶部的.aspx文件中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T14:22:26.243

CSS 用于更改表示。JavaScript 用于改变行为。将元素设置为启用或禁用是一种行为，应该在 JavaScript 中完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T14:24:49.187

如果您查看 asp.net 为禁用的单选按钮生成的 html，您会看到该按钮嵌入在 span 标记中，并且 span 的 disabled 属性设置为 true。也许以封闭跨度为目标的javascript会为您解决问题

# regex - 可以使用正则表达式匹配嵌套模式吗？

> ID：133601
> 
> 赞同：237
> 
> 时间：2008-09-25T14:17:40.873
> 
> 标签：regex, nested, finite-automata

是否可以编写一个匹配出现次数未知的嵌套模式的正则表达式？例如，当有未知数量的开/关大括号嵌套在外大括号内时，正则表达式是否可以匹配左大括号和右大括号？

例如：

```
public MyMethod()
{
  if (test)
  {
    // More { }
  }

  // More { }
} // End 
```

应该匹配：

```
{
  if (test)
  {
    // More { }
  }

  // More { }
} 
```

* * *

## 回答 #1

> 赞同：274
> 
> 时间：2008-09-25T14:27:12.643

不，就这么简单。一个有限自动机（它是正则表达式的基础数据结构）除了它所处的状态之外没有内存，如果你有任意深度的嵌套，你需要一个任意大的自动机，这与*有限*自动机的概念相冲突。

您可以将嵌套/配对元素匹配到固定深度，其中深度仅受您的记忆限制，因为自动机变得非常大。然而，在实践中，您应该使用下推自动机，即用于上下文无关文法的解析器，例如 LL（自上而下）或 LR（自下而上）。您必须考虑更糟糕的运行时行为：O(n^3) 与 O(n)，其中 n = 长度（输入）。

有许多可用的解析器生成器，例如Java 的[ANTLR](http://www.antlr.org/)。为 Java（或 C）找到现有的语法也不难。
更多背景信息：维基百科的[自动机理论](http://en.wikipedia.org/wiki/Automata_theory)

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2010-10-03T18:49:51.500

使用正则表达式检查嵌套模式非常容易。

```
'/(\((?>[^()]+|(?1))*\))/' 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-09-25T14:40:25.420

如果字符串在一行上，则可能是有效的 Perl 解决方案：

```
my $NesteD ;
$NesteD = qr/ \{( [^{}] | (??{ $NesteD }) )* \} /x ;

if ( $Stringy =~ m/\b( \w+$NesteD )/x ) {
    print "Found: $1\n" ;
  } 
```

高温高压

**编辑：**检查：

*   [http://dev.perl.org/perl6/rfc/145.html](http://dev.perl.org/perl6/rfc/145.html)
*   红宝石信息：[http ://www.ruby-forum.com/topic/112084](http://www.ruby-forum.com/topic/112084)
*   更多 perl：[http ://www.perlmonks.org/?node_id=660316](http://www.perlmonks.org/?node_id=660316)
*   更多 perl：[https ://metacpan.org/pod/Text::Balanced](https://metacpan.org/pod/Text::Balanced)
*   perl、perl、perl： http: [//perl.plover.com/yak/regex/samples/slide083.html](http://perl.plover.com/yak/regex/samples/slide083.html)

[Torsten Marek](https://stackoverflow.com/users/9567/torsten-marek)的另一件事（他正确地指出，它不再是正则表达式）：

*   [http://coding.derkeiler.com/Archive/Perl/comp.lang.perl.misc/2008-03/msg01047.html](http://coding.derkeiler.com/Archive/Perl/comp.lang.perl.misc/2008-03/msg01047.html)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-12-05T06:35:28.943

是的，如果它是 .NET RegEx 引擎。.Net 引擎支持由外部堆栈提供的有限状态机。查看[详情](http://retkomma.wordpress.com/2007/10/30/nested-regular-expressions-explained/)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-09-25T14:47:07.887

常规语言的[Pumping 引理](http://en.wikipedia.org/wiki/Pumping_lemma_for_regular_languages)是您不能这样做的原因。

生成的自动机将具有有限数量的状态，例如 k，因此一串 k+1 个左大括号必然会在某处重复一个状态（当自动机处理字符时）。同一状态之间的字符串部分可以无限复制多次，自动机不会知道其中的区别。

特别是，如果它接受 k+1 个左大括号，然后是 k+1 个右大括号（它应该接受），它还将接受泵送的左大括号数量，然后是不变的 k+1 个右大括号（它不应该）。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-25T15:09:20.360

正确的正则表达式将无法做到这一点，因为您将离开正则语言领域进入上下文无关语言领域。

然而，许多语言提供的“正则表达式”包严格来说更强大。

例如，[Lua](http://www.lua.org)正则表达式具有`%b()`匹配平衡括号的“”识别器。在您的情况下，您将使用“ `%b{}`”

另一个类似于 sed 的复杂工具是[gema](http://gema.sourceforge.net)，您可以在其中非常轻松地匹配平衡的花括号`{#}`。

因此，根据您可以使用的工具，您的“正则表达式”（在更广泛的意义上）可能能够匹配嵌套括号。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-03-28T11:20:37.837

# 是的

...假设有一些最大数量的嵌套你很乐意停下来。

让我解释。

* * *

[@torsten-marek](https://stackoverflow.com/users/9567/torsten-marek)是正确的，正则表达式无法检查这样的嵌套模式，**但是**可以*定义*一个嵌套的正则表达式模式，这将允许您捕获这样的嵌套结构*，直到某个最大深度*。我创建了一个来捕获[EBNF 风格的](https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form)评论（[在这里试试](https://regex101.com/r/NsVPFp/3)），比如：

```
(* This is a comment (* this is nested inside (* another level! *) hey *) yo *) 
```

正则表达式（用于单深度注释）如下：

```
m{1} = \(+\*+(?:[^*(]|(?:\*+[^)*])|(?:\(+[^*(]))*\*+\)+ 
```

`\(+\*+`通过将and`\*+\)+`替换为`{`and`}`并将其间的所有内容替换为简单的 ，这可以很容易地适应您的目的`[^{}]`：

```
p{1} = \{(?:[^{}])*\} 
```

（[这是](https://regex101.com/r/JewQGp/1/)尝试的链接。）

要嵌套，只需在块本身内允许此模式：

```
p{2} = \{(?:(?:p{1})|(?:[^{}]))*\}
  ...or...
p{2} = \{(?:(?:\{(?:[^{}])*\})|(?:[^{}]))*\} 
```

要查找三重嵌套块，请使用：

```
p{3} = \{(?:(?:p{2})|(?:[^{}]))*\}
  ...or...
p{3} = \{(?:(?:\{(?:(?:\{(?:[^{}])*\})|(?:[^{}]))*\})|(?:[^{}]))*\} 
```

一个清晰的模式已经出现。要查找嵌套深度为 的注释`N`，只需使用正则表达式：

```
p{N} = \{(?:(?:p{N-1})|(?:[^{}]))*\}

  where N > 1 and
  p{1} = \{(?:[^{}])*\} 
```

可以编写一个脚本来递归地生成这些正则表达式，但这超出了我需要的范围。（这留给读者作为练习。）

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-09-17T08:43:24.110

在 PHP 正则表达式引擎中使用递归匹配比括号的过程匹配要快得多。尤其是较长的字符串。

[http://php.net/manual/en/regexp.reference.recursive.php](http://php.net/manual/en/regexp.reference.recursive.php)

例如

```
$patt = '!\( (?: (?: (?>[^()]+) | (?R) )* ) \)!x';

preg_match_all( $patt, $str, $m ); 
```

对比

```
matchBrackets( $str );

function matchBrackets ( $str, $offset = 0 ) {

    $matches = array();

    list( $opener, $closer ) = array( '(', ')' );

    // Return early if there's no match
    if ( false === ( $first_offset = strpos( $str, $opener, $offset ) ) ) {
        return $matches;
    }

    // Step through the string one character at a time storing offsets
    $paren_score = -1;
    $inside_paren = false;
    $match_start = 0;
    $offsets = array();

    for ( $index = $first_offset; $index < strlen( $str ); $index++ ) {
        $char = $str[ $index ];

        if ( $opener === $char ) {
            if ( ! $inside_paren ) {
                $paren_score = 1;
                $match_start = $index;
            }
            else {
                $paren_score++;
            }
            $inside_paren = true;
        }
        elseif ( $closer === $char ) {
            $paren_score--;
        }

        if ( 0 === $paren_score ) {
            $inside_paren = false;
            $paren_score = -1;
            $offsets[] = array( $match_start, $index + 1 );
        }
    }

    while ( $offset = array_shift( $offsets ) ) {

        list( $start, $finish ) = $offset;

        $match = substr( $str, $start, $finish - $start );
        $matches[] = $match;
    }

    return $matches;
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-25T15:25:10.523

正如 zsolt 提到的，一些正则表达式引擎支持递归——当然，这些引擎通常使用回溯算法，因此它不会特别有效。例子：`/(?>[^{}]*){(?>[^{}]*)(?R)*(?>[^{}]*)}/sm`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-25T14:19:02.553

不，此时您正在进入[上下文无关语法](http://en.wikipedia.org/wiki/Context-free_grammar)领域。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-04-01T20:39:10.703

这似乎有效：`/(\{(?:\{.*\}|[^\{])*\})/m`

# google-app-engine - 当然 Google Appengine 可以扩展，但它也很快吗？

> ID：133608
> 
> 赞同：2
> 
> 时间：2008-09-25T14:17:59.517
> 
> 标签：google-app-engine

我想知道响应时间是否良好，而不仅仅是它是否可以扩展。有经验的人吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T15:57:08.187

像 GAE 这样的可扩展架构与基于优化速度的架构不同。需要一种不同的方法。

DataStore 的设计目的不是在小规模上超快速，而是处理大量数据并进行分布式处理。我们可以说小规模的数据库访问“非常慢”（与标准关系数据库相比）。

看看：[google-appengine-second-look](http://highscalability.com/google-appengine-second-look)和[how-i-learned-stop-worrying-and-love-using-lot-disk-space-scale](http://highscalability.com/how-i-learned-stop-worrying-and-love-using-lot-disk-space-scale)

一些[实验结果](http://www.ongwt.com/post/2008/05/24/Google-App-Engine-1-Community-0)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T00:09:47.363

I've implemented some ajax popups for a GAE application and the popups need a server round trip to be less than half second on average to be usable. And it turned out to work pretty well. The support for memcache also makes it easy to optimize for speed on GAE.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-25T23:25:33.510

现有的答案（和评论）在正确的轨道上。简而言之，应用引擎数据存储比大多数关系数据库慢，但比大多数其他 NoSQL 风格的数据存储快。我已经看到一些独立的比较反映了这一点，例如[http://radar.oreilly.com/2010/06/on-the-performance-of-clouds.html](http://radar.oreilly.com/2010/06/on-the-performance-of-clouds.html)

应用引擎多年来一直在其系统状态网站上跟踪数据存储的延迟：[http ://code.google.com/status/appengine](http://code.google.com/status/appengine)

# algorithm - 平衡二叉树 (AVL)

> ID：133610
> 
> 赞同：14
> 
> 时间：2008-09-25T14:18:19.327
> 
> 标签：algorithm, computer-science, binary-tree, theory, avl-tree

好的，对于周围的 CS 家伙来说，这是另一个理论领域。

在 90 年代，我在实施 BST 方面做得相当好。唯一让我无法理解的是平衡二叉树 (AVL) 的算法的复杂性。

你们能帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-25T14:26:34.267

我认为在这里发布节点平衡算法的完整代码并不好，因为它们变得相当大。[但是，关于红黑树](http://en.wikipedia.org/wiki/Red-black_tree)的 Wikipedia 文章包含该算法的完整 C 实现，而关于[AVL 树](http://en.wikipedia.org/wiki/AVL_tree)的文章也有几个指向高质量实现的链接。

这两种实现对于大多数通用场景来说已经足够了。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-25T14:43:10.203

替罪羊树可能有最简单的平衡确定算法来理解。如果任何插入导致新节点太深，它会通过查看重量平衡而不是高度平衡来找到要重新平衡的节点。删除时是否重新平衡的规则也很简单。它不在节点中存储任何神秘信息。证明它是正确的比较棘手，但你不需要它来理解算法......

然而，与 AVL 不同，它并非始终保持高度平衡。像红黑一样，它的不平衡是有界的，但与红黑不同的是，它可以通过参数进行调整，因此对于大多数实际目的，它看起来就像你需要的一样平衡。但是，我怀疑如果您将其调整得太紧，那么对于最坏情况的插入，它最终会比 AVL 更差或更差。

**对问题编辑的回应**

我将提供我个人理解 AVL 树的途径。

首先，您必须了解什么是树旋转，因此请忽略您曾经听过 AVL 算法的所有其他内容并理解这一点。直截了当地了解哪个是右旋转，哪个是左旋转，以及每个对树的作用，否则对精确方法的描述只会让你感到困惑。

接下来，了解平衡 AVL 树的技巧是每个节点在其中记录其左右子树的高度差。“高度平衡”的定义是，对于树中的每个节点，它都介于 -1 和 1 之间。

接下来，了解如果您添加或删除了一个节点，您可能会使树不平衡。但是您只能更改作为您添加或删除的节点的祖先的节点的平衡。所以，你要做的就是沿着树的方向工作，使用旋转来平衡你找到的任何不平衡节点，并更新它们的平衡分数，直到树再次平衡。

理解它的最后一部分是在一个体面的参考中查找用于重新平衡您找到的每个节点的特定旋转：这是它的“技术”，而不是高级概念。您只需要在修改 AVL 树代码或可能在数据结构考试期间记住细节。自从我上次在调试器中打开 AVL 树代码以来已经有好几年了 - 实现往往会达到它们工作的程度，然后继续工作。所以我真的不记得了。您可以使用一些扑克筹码在桌子上解决问题，但很难确定您是否真的掌握了所有情况（数量不多）。最好只是查一下。

然后就是将其全部转换为代码的业务。

我不认为查看代码清单对除最后一个以外的任何阶段都有很大帮助，因此请忽略它们。即使在最好的情况下，代码写得很清楚，它看起来就像教科书上的过程描述，但没有图表。在更典型的情况下，它是 C 结构操作的混乱。所以只能坚持看书。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-06T02:09:41.350

我最近一直在用 AVL 树做一些工作。

我能找到的关于如何平衡它们的最佳帮助是通过搜索谷歌。

我只是围绕这个伪代码编写了代码（如果你了解如何进行旋转，它很容易实现）。

```
IF tree is right heavy
{
  IF tree's right subtree is left heavy
  {
     Perform Double Left rotation 
  }
  ELSE
  {
     Perform Single Left rotation
  }
}
ELSE IF tree is left heavy
{
  IF tree's left subtree is right heavy
  {
     Perform Double Right rotation
  }
  ELSE
  {
     Perform Single Right rotation
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T14:45:38.950

我同意，一个完整的程序是不合适的。

虽然经典的 AVL 和 RB 树使用确定性方法，但我建议看一下“[随机二叉搜索树](http://citeseer.ist.psu.edu/martinez97randomized.html)”，无论密钥的统计分布如何，保持平衡和保证良好平衡的成本更低。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T16:10:35.997

AVL 树效率低下，因为每次插入/删除都可能需要进行多次旋转。

红黑树可能是更好的选择，因为插入/删除更有效。这种结构保证到叶子的最长路径不超过最短路径的两倍。因此，虽然不如 AVL 树平衡，但避免了最严重的不平衡情况。

如果您的树将被多次读取，并且在创建后不会被更改，那么对于完全平衡的 AVL 树来说，额外的开销可能是值得的。此外，红黑树需要为每个节点提供一个额外的存储空间，从而赋予节点的“颜色”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-17T04:09:28.967

为了平衡 AVL 树，我刚刚写了一堆函数，我想在这里与大家分享。我想这个实现是完美的。当然欢迎提问/提问/批评：

[http://uploading.com/files/5883f1c7/AVL_Balance.cpp/](http://uploading.com/files/5883f1c7/AVL_Balance.cpp/)

作为 Stackoverflow 的新手，我尝试在此处发布我的代码，但遇到了错误的格式问题。因此，将文件上传到上述链接。

干杯。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-24T23:57:18.577

有一个自平衡 avl 树的完整实现 @ [http://code.google.com/p/self-balancing-avl-tree/](http://code.google.com/p/self-balancing-avl-tree/)。它还实现了对数时间连接和拆分操作以及映射/多映射集合

# vim - 你如何从 Vim 中的 'gf' 返回

> ID：133626
> 
> 赞同：197
> 
> 时间：2008-09-25T14:20:34.313
> 
> 标签：vim, editor

我正在将 Vim 用于以 Unix 模式安装的 Windows。感谢这个站点，我现在使用`gf`命令转到光标下的文件。

我正在寻找一个命令：

1.  返回上一个文件（类似于 ctags 的`Ctrl`+ `T`），或
2.  重新映射`gf` 以在新窗口中自动启动新文件。

* * *

## 回答 #1

> 赞同：311
> 
> 时间：2008-09-25T14:23:50.343

I use `Ctrl`-`O`

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-09-25T20:21:02.887

I frequently use `Ctrl`-`6` for this.

It's handy because it allows me to quickly jump back and forth between the two files.

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2008-09-26T09:42:49.807

You might want to use `CTRL-W gf` to open the file in a new tab.

You can close the newly opened file as always with `:bd`, or use `CTRL-6` and other usual ways of changing buffers.

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-25T14:24:33.057

Just use `:e#` followed by `Enter` - that basically says to edit the last (most recent) file.

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-05-05T10:08:29.197

Use gf to descend into a file and use :bf to get back

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-25T14:21:21.410

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-26T10:51:27.007

I got `CTRL`-`W``f` to work.
It's quite depressing that I've spent so long perfecting maps for these commands only to discover that there are built-in versions.

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-25T15:12:10.663

I don't know the answer to part 2 of your question, but I can help with part 1\. Use

```
:e# 
```

Vim maintains a list of files (buffers) that it's editing. If you type

```
:buffers 
```

it will list all the files you are currently editing. The file in that list with a % beside it is the current file. The one with the # beside it is the alternate file. :e# will switch between the current and alternate file. Rather than type that much, I map F2 to :e# so I can easily flip between the current and alternate files. I map the command to F2 by adding this to .vimrc

```
nmap `<F2> :e#<CR>` 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T14:36:10.890

See [:help alternate-file](http://vimdoc.sourceforge.net/htmldoc/editing.html#alternate-file).

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-26T07:55:18.523

When you open a new file (with *gf* or *:n* or another command) the old file remains in a buffer list. You can list open files with *:ls*

If you want to navigate easily between buffers in vim, you can create a mapping like this:

```
nmap <M-LEFT> :bN<cr>
nmap <M-RIGHT> :bn<cr> 
```

Now you can switch between buffers with `Alt`+`←</kbd> or `Alt`+`→</kbd>.``

The complete documentation on mappings is here:

```
:help map.txt 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T09:29:12.430

I haven't looked at your **gf** command but I imagine it uses the **:e** or **:find** command.
Assuming that this is correct, simply replace the **:e** or **:find** with **:new** (or **:vnew** for a vertical split) and the file will open in a new window instead of the same one.

e.g.

```
"Switch between header and cpp
nmap ,s :find %:t:r.cpp<CR>
nmap ,S :new %:t:r.cpp<CR>
nmap ,h :find %:t:r.h<CR>
nmap ,H :new %:t:r.h<CR>
nmap ,F :new =expand("<cfile>:t")<CR><CR>
nmap ,d :new =expand("<cfile>")<CR><CR> 

```

# sql - 在sql server中一次插入固定数量的行2000

> ID：133648
> 
> 赞同：2
> 
> 时间：2008-09-25T14:23:30.843
> 
> 标签：sql, sql-server

我想一次将 50,000 条记录插入到 sql server 数据库 2000 中。如何做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T15:02:34.727

您可以使用 SELECT TOP 子句：在 MSSQL 2005 中，它进行了扩展，允许您使用变量来指定记录数（旧版本只允许使用数字常量）

您可以尝试这样的事情：（未经测试，因为我目前无法访问 MSSQL2005）

```
begin
declare @n int, @rows int

    select @rows = count(*) from sourcetable

    select @n=0

    while @n < @rows
    begin

        insert into desttable
        select top 2000 * 
        from sourcetable
        where id_sourcetable not in (select top (@n) id_sourcetable 
                    from sourcetable 
                    order by id_sourcetable)
        order by id_sourcetable

        select @n=@n+2000
    end
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T14:27:49.617

你的意思是为了某种测试？

```
declare @index integer
set @index = 0
while @index < 50000
begin
   insert into table
   values (x,y,z)
   set @index = @index + 1
end 
```

但我希望这不是你的意思。

如果您的意思是进行批量插入的最佳方式，请使用`BULK INSERT`或类似`bcp`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T14:30:35.803

您是从另一个数据库/表中插入，以编程方式还是从平面文件中插入？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T14:33:01.600

从外部数据源[bcp](http://msdn.microsoft.com/en-us/library/ms162802.aspx)可用于导入数据。-b 开关允许您指定批处理大小。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T15:25:54.187

将@rows 声明为 int set @rows = 1 而@rows >0

## 开始

```
insert mytable (field1, field2, field3)
select   top 2000 pa.field1, pa.field2, pa.field3 
from table1 pa (nolock) 
left join mytable ta (nolock)on ta.field2 = pa.feild2
    and ta.field3 = pa.field3 and ta.field1 = pa.field1
where ta.field1 is null
order by pa.field1 
```

设置@rows = @@rowcount

结尾

这是我们目前在 SQL Server 2000 生产环境中使用的代码，其中表和字段名已更改。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T19:40:24.030

使用 SQL 2000，我可能会依靠 DTS 来执行此操作，具体取决于数据所在的位置。您可以明确告诉 DTS 将什么用于批量提交大小。否则，SQL 2005 批处理解决方案的修改版本会很好。我认为您不能将 TOP 与 SQL 2000 中的变量一起使用。

# c# - 如何使用 System.IO.DirectoryInfo 访问映射的网络驱动器？

> ID：133660
> 
> 赞同：38
> 
> 时间：2008-09-25T14:24:26.643
> 
> 标签：c#, .net

我需要在映射的网络驱动器上创建一个目录。我正在使用代码：

```
DirectoryInfo targetDirectory = new DirectoryInfo(path);
if (targetDirectory != null)
{
    targetDirectory.Create();
} 
```

如果我指定“\\\\ServerName\\Directory”之类的路径，一切正常。如果我将“\\ServerName\Directory”映射为，比如驱动器 Z:，并指定“Z:\\”之类的路径，它将失败。

创建 targetDirectory 对象后，VS 显示（在调试模式下）targetDirectory.Exists = false，并且尝试执行 targetDirectory.Create() 会引发异常：

```
System.IO.DirectoryNotFoundException: "Could not find a part of the path 'Z:\'." 
```

但是，相同的代码也适用于本地目录，例如 C:。

该应用程序是一个 Windows 服务（WinXP Pro、SP2、.NET 2），在与映射驱动器的用户相同的帐户下运行。Qwinsta 回复说用户的会话是会话 0，因此它与服务的会话相同。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-09-25T14:39:03.957

映射的网络驱动器是特定于用户的，因此如果应用程序在与创建映射驱动器号 (z:) 的用户不同的身份下运行，它将无法工作。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-04-15T14:53:35.733

基于事实，映射驱动器号不起作用，简单的解决方案是键入完整的网络路径。

阿卡，

我的`R:/`驱动器被映射到`\\myserver\files\myapp\`

所以**而不是**使用

`"R:/" + "photos"`

**利用**

`"\\myserver\files\myapp\" + "photos"`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-25T14:40:40.787

运行您的应用程序的帐户可能无权访问映射的驱动器。如果这是一个 Web 应用程序，那肯定是问题...默认情况下，一个 Web 应用程序在 NETWORK SERVICE 帐户下运行，该帐户没有任何映射驱动器设置。尝试使用模拟来查看它是否可以解决问题。尽管您可能需要找出比仅使用模拟更好的解决方案。如果是我，我会坚持使用 UNC 路径。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T14:31:38.907

您是否使用与程序运行时完全相同的凭据进行映射？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T08:04:22.277

Are you running on Vista/Server 2k8? Both of those isolate services into Session 0 and the first interactive session is Session 1\. There's more info [here](http://web.archive.org/web/20070228141518/http://blogs.msdn.com/sripod/archive/2006/11/21/session-0-isolation-in-vista-and-application-compatibility.aspx), on session isolation. Thus, even if it's the same user being used for both the service and the interactive logon, it'll be different sessions.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T14:30:59.907

您可以尝试使用[WNetConnection](http://msdn.microsoft.com/en-us/library/aa385453.aspx)将映射的驱动器解析为网络路径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-10T18:00:28.377

我在 Win Server 2012 上遇到了同样的问题。禁用 UAC 解决了它。

# asp.net-mvc - 绑定日期格式 (ASP.NET MVC)

> ID：133671
> 
> 赞同：35
> 
> 时间：2008-09-25T14:25:48.140
> 
> 标签：asp.net-mvc

在我的 ASP.net MVC 应用程序中，我的视图如下所示：

```
...
<label>Due Date</label>
<%=Html.TextBox("due")%>
... 
```

我正在使用 a`ModelBinder`将帖子绑定到我的模型（到期属性是`DateTime`类型）。问题是当我将“01/01/2009”放入文本框中时，帖子没有验证（由于其他数据输入不正确）。**活页夹使用日期和时间**“01/01/2009 **00:00:00** ”重新填充它。

**有没有办法告诉活页夹正确格式化日期（即`ToShortDateString()`）？**

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2010-02-26T12:55:35.973

我刚刚遇到了这个非常简单而优雅的解决方案，在 MVC 2 中可用：

[http://geekswithblogs.net/michelotti/archive/2010/02/05/mvc-2-editor-template-with-datetime.aspx](http://geekswithblogs.net/michelotti/archive/2010/02/05/mvc-2-editor-template-with-datetime.aspx)

基本上，如果您使用的是 MVC 2.0，请在您的视图中使用以下内容。

```
 <%=Html.LabelFor(m => m.due) %>
 <%=Html.EditorFor(m => m.due)%> 
```

然后在 /Views/Shared/EditorTemplates 中创建一个局部视图，名为 DateTime.ascx

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<System.DateTime?>" %>
<%=Html.TextBox("", (Model.HasValue ? Model.Value.ToShortDateString() : string.Empty), new { @class = "datePicker" }) %> 
```

当 EditorFor<> 被调用时，它将找到一个匹配的编辑器模板。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-10-30T13:29:57.807

用属性装饰模型中的`DataType`属性，并指定它是 a `Date`，而不是 a `DateTime`：

```
public class Model {
  [DataType(DataType.Date)]
  public DateTime? Due { get; set; }
} 
```

您也必须在视图中使用`EditorFor`而不是：`TextBoxFor`

```
@Html.EditorFor(m => m.Due) 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-02-22T23:42:07.147

这是一个肮脏的黑客，但它似乎工作。

```
<%= Html.TextBoxFor(model => model.SomeDate,
    new Dictionary<string, object> { { "Value", Model.SomeDate.ToShortDateString() } })%> 
```

您获得模型绑定，并且能够使用格式化字符串覆盖文本字段的 HTML“值”属性。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T08:48:01.953

你为什么不使用

```
<% =Html.TextBox("due", Model.due.ToShortDateString()) %> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-08-14T07:22:18.070

我在自己寻找答案时发现了这个问题。上面的解决方案对我不起作用，因为我的 DateTime 可以为空。这是我通过支持可为空的 DateTime 对象来解决它的方法。

```
<%= Html.TextBox(String.Format("{0:d}", Model.Property)) %> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-02-17T16:14:07.020

首先，添加此扩展以获取属性路径：

```
public static class ExpressionParseHelper
{
    public static string GetPropertyPath<TEntity, TProperty>(Expression<Func<TEntity, TProperty>> property)
    {                       
         Match match = Regex.Match(property.ToString(), @"^[^\.]+\.([^\(\)]+)$");
         return match.Groups[1].Value;
    }
} 
```

比为 HtmlHelper 添加这个扩展：

```
 public static MvcHtmlString DateBoxFor<TEntity>(
                this HtmlHelper helper,
                TEntity model,
                Expression<Func<TEntity, DateTime?>> property,
                object htmlAttributes)
            {
                DateTime? date = property.Compile().Invoke(model);
                var value = date.HasValue ? date.Value.ToShortDateString() : string.Empty;
                var name = ExpressionParseHelper.GetPropertyPath(property);

                return helper.TextBox(name, value, htmlAttributes);
            } 
```

你还应该添加这个 jQuery 代码：

```
$(function() {
    $("input.datebox").datepicker();
}); 
```

datepicker 是一个 jQuery 插件。

现在你可以使用它了：

```
<%= Html.DateBoxFor(Model, (x => x.Entity.SomeDate), new { @class = "datebox" }) %> 
```

[ASP.NET MVC2 和 DateTime 格式](https://stackoverflow.com/questions/2227742/asp-net-mvc2-and-datetime-format/2238204#2238204)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T15:43:06.627

为了在视图后面的代码中获得对模型的强类型访问，您可以执行以下操作：

```
public partial class SomethingView : ViewPage<T>
{
} 
```

其中 T 是要从 Action 传入的 ViewData 类型。

然后在你的控制器中你会有一个动作：

```
public ActionResult Something(){
    T myObject = new T();
    T.Property = DateTime.Today();

    Return View("Something", myObject);
} 
```

之后，您的视图中有很好的强类型模型数据，因此您可以执行以下操作：

```
<label>My Property</label>
<%=Html.TextBox(ViewData.Model.Property.ToShortDateString())%> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-09T15:04:10.333

我发现最好的方法是重置 ModelValue

```
ModelState.SetModelValue("due", new ValueProviderResult(
       due.ToShortDateString(), 
       due.ToShortDateString(), 
       null)); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T17:12:44.493

我个人想我会说最好或最容易通过强类型页面和一些定义的模型类来做到这一点，但如果你希望它成为活页夹中的东西，我会这样做：

```
public class SomeTypeBinder : IModelBinder
{
    public object GetValue(ControllerContext controllerContext, string modelName,
                              Type modelType, ModelStateDictionary modelState)
    {
        SomeType temp = new SomeType();
        //assign values normally
        //If an error then add formatted date to ViewState
        controllerContext.Controller.ViewData.Add("FormattedDate",
                              temp.Date.ToShortDateString());
    }
} 
```

然后在创建文本框时在视图中使用它，即：

```
<%= Html.TextBox("FormattedDate") %> 
```

希望有帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-19T03:09:00.300

MVC4 EF5 视图我试图用今天的日期预加载一个字段，然后将其传递给视图以供批准。

```
ViewModel.SEnd = DateTime.Now    //preload todays date  
return View(ViewModel)           //pass to view 
```

在视图中，我的第一个代码允许编辑：

```
@Html.EditedFor(item.SEnd)        //allow edit 
```

后来我将其更改为仅显示日期，用户无法更改它但提交会触发控制器 savechanges

```
 <td>
 @Html.DisplyFor(item.SEnd)       //show no edit
 </td> 
```

当我更改为 DisplayFor 时，我需要添加它以确保将预加载的值传递回控制器。我还需要为视图模型中的每个字段添加 HiddenFor。

```
 @Html.HiddenFor(model => model.SEnd)     //preserve value for passback. 
```

初学者的东西，但需要一段时间才能解决这个问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-12-08T22:01:19.853

这对我有用：mvc 2

`<%: Html.TextBoxFor(m => m.myDate, new { @value = Model.myDate.ToShortDateString()}) %>`

简单又甜美！

user82646 的评论，我想我会让它更明显。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-29T05:54:14.633

尝试这个

```
<%:Html.TextBoxFor(m => m.FromDate, new { @Value = (String.Format("{0:dd/MM/yyyy}", Model.FromDate)) }) %> 
```

# algorithm - 红眼消除算法

> ID：133675
> 
> 赞同：42
> 
> 时间：2008-09-25T14:26:25.813
> 
> 标签：algorithm, image-processing

我需要为我正在处理的应用程序实现红眼消除。

谷歌搜索主要提供商业最终用户产品的链接。

您知道可以在 GPL 应用程序中使用的良好红眼消除算法吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-05T09:34:31.130

我在这里参加聚会已经很晚了，但是对于未来的搜索者，我已将以下算法用于我编写的个人应用程序。

首先，要减少的区域由用户选择并作为中心点和半径传递给红眼减少方法。该方法遍历半径内的每个像素并进行以下计算：

```
//Value of red divided by average of blue and green:
Pixel pixel = image.getPixel(x,y);
float redIntensity = ((float)pixel.R / ((pixel.G + pixel.B) / 2));
if (redIntensity > 1.5f)  // 1.5 because it gives the best results
{
    // reduce red to the average of blue and green
    bm.SetPixel(i, j, Color.FromArgb((pixel.G + pixel.B) / 2, pixel.G, pixel.B));
} 
```

我真的很喜欢这个结果，因为它们保持了颜色强度，这意味着眼睛的光反射没有减少。（这意味着眼睛保持“活”的样子。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T00:24:04.067

一个很好的发现眼睛的图书馆是[openCV](http://sourceforge.net/projects/opencvlibrary/)。它具有非常丰富的图像处理功能。另请参阅Ilia V. Safonov 的题为“自动红眼检测”的[这篇论文。](http://www.graphicon.ru/2007/proceedings/Papers/Paper_11.pdf)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T14:43:22.170

首先你需要找到眼睛！标准方法是运行边缘检测器，然后运行 ​​Hough 变换以找到两个相同大小的圆，但可能有更简单的算法来简单地找到红色像素簇。

然后你需要决定用什么替换它们，假设图像中有足够的绿色/蓝色数据，你可以简单地忽略红色通道。

OpenCV 是一个非常好的图像处理免费库，它可能对你想要的东西来说有点过头了——但是有很多例子和一个非常活跃的社区。您还可以搜索对象跟踪算法，跟踪场景中的彩色对象是一个非常相似和常见的问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-25T14:29:54.137

如果没有其他人提出更直接的答案，您可以随时下载[GIMP 的源代码，](http://www.gimp.org/source/)看看他们是如何做到的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-25T14:29:41.763

最简单且仍然非常有效的算法是将感兴趣区域的 RGB 三元组的 R 归零。

红色消失，但保留其他颜色。

该算法的进一步扩展可能涉及仅将红色为主色（R > G 和 R > B）的三元组的 R 值归零。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T14:31:17.830

你可以试试 imagemagick——这个页面上有一些关于如何做到这一点的提示

[http://www.cit.gu.edu.au/~anthony/info/graphics/imagemagick.hints](http://www.cit.gu.edu.au/~anthony/info/graphics/imagemagick.hints)

在页面上搜索红眼

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-25T14:43:27.597

开源项目[Paint.NET](http://www.getpaint.net/download.html)在 C# 中有一个实现。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-05-10T17:44:00.330

这里是java实现解决方案

```
public void corrigirRedEye(int posStartX, int maxX, int posStartY, int maxY, BufferedImage image) {
    for(int x = posStartX; x < maxX; x++) {
        for(int y = posStartY; y < maxY; y++) {

            int c = image.getRGB(x,y);
            int  red = (c & 0x00ff0000) >> 16;
            int  green = (c & 0x0000ff00) >> 8;
            int  blue = c & 0x000000ff;

            float redIntensity = ((float)red / ((green + blue) / 2));
            if (redIntensity > 2.2) {
                Color newColor = new Color(90, green, blue);
                image.setRGB(x, y, newColor.getRGB());
            }

        }
    }
} 
```

作为从诸如 open cv 之类的应用程序检测到的两个矩形中检索的参数（这应该是一个涉及眼睛位置的矩形）

```
int posStartY = (int) leftEye.getY();

    int maxX = (int) (leftEye.getX() + leftEye.getWidth());
    int maxY = (int) (leftEye.getY() + leftEye.getHeight());

    this.corrigirRedEye(posStartX, maxX, posStartY, maxY, image);

    // right eye

    posStartX = (int) rightEye.getX();
    posStartY = (int) rightEye.getY();

    maxX = (int) (rightEye.getX() + rightEye.getWidth());
    maxY = (int) (rightEye.getY() + rightEye.getHeight());

    this.corrigirRedEye(posStartX, maxX, posStartY, maxY, image); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-09-24T21:16:48.037

这是 Benry 提供的答案的更完整的实现：

```
 using SD = System.Drawing;

  public static SD.Image ReduceRedEye(SD.Image img, SD.Rectangle eyesRect)
  {
     if (   (eyesRect.Height > 0)
         && (eyesRect.Width > 0)) {
        SD.Bitmap bmpImage = new SD.Bitmap(img);
        for (int x=eyesRect.X;x<(eyesRect.X+eyesRect.Width);x++) {
           for (int y=eyesRect.Y;y<(eyesRect.Y+eyesRect.Height);y++) {
              //Value of red divided by average of blue and green:
              SD.Color pixel = bmpImage.GetPixel(x,y);
              float redIntensity = ((float)pixel.R / ((pixel.G + pixel.B) / 2));
              if (redIntensity > 2.2f)
              {
                 // reduce red to the average of blue and green
                 bmpImage.SetPixel(x, y, SD.Color.FromArgb((pixel.G + pixel.B) / 2, pixel.G, pixel.B));
                 pixel = bmpImage.GetPixel(x,y); // for debug
              }
           }
        }
        return (SD.Image)(bmpImage);
     }
     return null;
  } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-04-13T07:16:57.440

阅读这个博客，关于红眼的检测和校正有一个很好的解释。 [使用 OpenCV 和 python 进行红眼校正](http://pytech-solution.blogspot.in)

# c# - 从 .NET 确定 C# 和 C++ 的 SLOC 和复杂性

> ID：133679
> 
> 赞同：4
> 
> 时间：2008-09-25T14:26:43.707
> 
> 标签：c#, c++, metrics

几年来，我一直在我的项目中使用 SourceMonitor，以记录 C# 和 C++ 组件的源代码复杂性和基本 SLOC（包括注释）。这些用于向我们的客户进行外部报告，所以我无法争论它们的优点或不足。

我一直在研究一个存储库分析工具，它能够在任何日期/时间为我提供项目的快照视图。我要添加的下一个阶段是缓存指定文件和修订的指标。

我知道 SourceMonitor 可以编写脚本以允许我提供要测试的文件并从结果文件 CSV 或 XML 中获取指标。

.NET 中是否有一个本地库，我可以使用它来做同样的事情——例如，避免产生外部进程并解析结果。

我只需要以下指标：

*   SLOC
*   注释行数
*   最复杂方法的复杂性
*   最复杂方法的名称

我需要在**C#**代码和普通**C++**代码上运行它。

编辑：由于我已经拥有提供所需 GUI 和报告的工具，因此需要使用库/API 编写或生成指标，而无需手动步骤。理想情况下，我想获取指定文件/修订版（而不是整个项目）的指标，我的实用程序将自动从版本控制中拖动。

**注意：我为此创建了一个赏金，并且在它过期时正在度假...... NDepends 的答案并不让我满意，因为它不查看源代码，而是查看程序集本身！**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T15:10:05.537

[依赖](http://www.ndepend.com/Features.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T20:34:59.367

您可以在此处找到 C# SLOC 的开源代码和评论：[http ://code.google.com/p/projectpilot/source/browse/#svn/trunk/ProjectPilot.Framework/Metrics](http://code.google.com/p/projectpilot/source/browse/#svn/trunk/ProjectPilot.Framework/Metrics)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-05T22:36:10.257

用于计算 SLOC 的可靠的基于命令行的工具是[Cloc](http://cloc.sourceforge.net/)。它支持多种语言，包括 C# 和 C++。支持的输出格式为 xml、csv 和 sql。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-10T16:30:58.490

这不会给您带来功能复杂性并且它不是可编写脚本的（据我所知），但适用于 VS 的 SlickEdit Gadgets 具有出色的 SLOC 报告工具，您可以从解决方案资源管理器中使用，并会在文件中为您提供详细报告，项目或解决方案级别。

你可以在这里得到它：[http ://www.slickedit.com/content/view/441](http://www.slickedit.com/content/view/441)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-26T08:24:04.353

虽然我从未找到可以同样解析 C# 和 C++ 的 .NET 产品，但我确实设法找到了一个易于使用的产品，即支持这些语言等等的[CODECOUNT 。](http://sunset.usc.edu/research/CODECOUNT/)

它有一个简单的命令行，不像我的项目中使用的 SourceMonitor，直到 CODECOUNT 替换它。

# windows - 生成一个新的 xterm 窗口

> ID：133680
> 
> 赞同：0
> 
> 时间：2008-09-25T14:26:56.420
> 
> 标签：windows, unix, ssh, xterm

当我使用 Bitvise Tunnelier 并生成一个连接到我们的太阳站的新 xterm 窗口时，一切正常。我们在 sun 站上安装了可视化 slick 编辑器，我被指示使用命令 vs& 打开它。当我这样做时，我得到以下信息：

```
fbm240-1:/home/users/ajahn 1 % vs&
[1] 4716
fbm240-1:/home/users/ajahn 2 % Visual SlickEdit: Can't open connection to X. DIS
PLAY='<Default Display>' 
```

我宁愿不费力地将我的材料来回传输到服务器。建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T14:43:11.373

你需要在你的 Windows 机器上安装一个 Xwindows 服务器，以便在 Sun 服务器上远程运行图形 Unix 应用程序并让它显示在你的 Windows 机器上。我不认为 Tunnelier 支持 Xwindows 隧道。看看 Xming，一个用于 Windows 的 Xwindows 服务器，它带有一个 ssh 客户端 Putty：

[http://sourceforge.net/projects/xming](http://sourceforge.net/projects/xming)

**编辑：**很高兴看到这对你有用。这里有一些关于正在发生的事情的更多解释。X-Windows，Unix 图形环境是基于客户端-服务器的。IE：它能够在远程系统上显示单独的图形窗口，而无需像 VNC 或远程桌面这样的全屏软件。Unix 中的图形程序称为 X-Windows 客户端，而实际进行显示的东西称为 X-Windows 服务器。

现在，Bitvise Tunnelier 只是一个 ssh 客户端。IE：它只处理命令行终端连接。但是，ssh 协议实际上能够通过 ssh 为 X-Windows 建立隧道，但您需要两件事：1) 在桌面上运行的 X-Windows 服务器（实际显示应用程序），以及 2) 支持 X 的 ssh 客户端-Windows 隧道。输入 Xming，一个用于 Windows 的轻量级 X 服务器和 Putty，一个 ssh 客户端。

因此，您可以通过 ssh 进入您的 Sun 设备并输入终端命令，但 Visual SlickEdit 是一个 X-Windows 客户端应用程序。要运行它，您需要一个 X-Windows 服务器。当 X-Windows 服务器可用时，它会在终端上设置 DISPLAY 变量来告诉图形应用程序在哪里显示内容。

One more note: Some of the answers below recommended that you set the DISPLAY variable to the hostname of your Sun box. That might have worked, but it would have displayed the VS windows on the Sun's screen, not your Windows box.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T14:35:36.570

您在运行 vs 的 shell 中的 DISPLAY 环境变量是什么？真的是“<默认显示>”吗？如果是，请尝试将其设置为“：0”或“您的主机*名*：0”，然后再次运行 vs（您可能需要`xhost +`在您的主机上使用）。

这只是帮助您解决此问题所需的说明的一小部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T14:37:41.607

在带有显示器的系统上（您启动隧道器的系统）：

xhost +fbm240-1

如果不是系统名称，请将 fbm240-1 替换为系统名称。我猜的。

您还需要确保您的 DISPLAY 设置正确；如果您正在使用 ssh 隧道，那么它应该已经存在（如果是 openssh，请使用 -Y；如果是 putty，则在 Connection->SSH->X11 下选择“启用 X11 转发”；如果是其他，请阅读文档）。如果您正确地设置了 X 隧道，那么您很可能根本不必乱用 xhost。

# php - 分析 PHP 代码

> ID：133686
> 
> 赞同：36
> 
> 时间：2008-09-25T14:27:41.770
> 
> 标签：php, performance, profiling

我想找到一种方法来确定 PHP 中的每个函数以及 PHP 中的每个文件运行多长时间。我有一个旧的遗留 PHP 应用程序，我试图在其中找到“粗糙点”，所以我想客观地找出哪些例程和页面需要很长时间才能加载。

是否有任何预制工具可以做到这一点，或者我是否坚持使用 microtime 并构建自己的分析框架？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-25T16:16:15.893

上周我实际上做了一些优化工作。XDebug 确实是要走的路。

只需将其作为扩展启用（由于某种原因，它不适用于我的 Windows 机器上的 ze_extension），使用 xdebug.profiler_enable_trigger=On 设置您的 php.ini 并使用 XDEBUG_PROFILE=1 作为获取或发布调用您的正常 url变量来描述这个请求。没有什么比这更容易了！

另外，我真的可以推荐[webgrind](http://code.google.com/p/webgrind/)，一个基于 web 的 (php) google Summer Of Code 项目，它可以读取和解析您的调试输出文件！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-07-28T18:18:36.960

**这是一个很好的提示。**

当您使用 XDebug 分析您的 PHP 时，设置 profiler_trigger 并在书签中使用它来触发 XDebug 分析器；）

```
javascript:if(document.URL.indexOf('XDEBUG_PROFILE')<1){var%20sep=document.URL.indexOf('?');sep%20=%20(sep<1)?'?':'&';window.location.href=document.URL+sep+'XDEBUG_PROFILE';} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T14:30:04.727

看看[xdebug](http://www.xdebug.org/docs/profiler)，它允许深入分析。这里是如何使用 xdebug[的解释。](http://devzone.zend.com/article/2899-Profiling-PHP-Applications-With-xdebug)

> Xdebug 的 Profiler 是一个强大的工具，它使您能够分析您的 PHP 代码并确定瓶颈，或者通常查看您的代码的哪些部分很慢并且可以使用速度提升。Xdebug 2 中的分析器以 cachegrind 兼容文件的形式输出分析信息。

[感谢](https://stackoverflow.com/users/18077/schizoduckie)SchizoDuckie[提到](https://stackoverflow.com/questions/133686/what-is-the-best-way-to-profile-php-code#134305) [Webgrind](http://code.google.com/p/webgrind/)。_ 这是我第一次听说它。非常有用（+1）。

否则，您可以在 linux 上使用[kcachegrind](http://sourceforge.net/projects/kcachegrind/)或其较小的衍生版本[wincachegrind](http://sourceforge.net/projects/wincachegrind/)。这两个应用程序都将读取 xdebug 的分析器输出文件并汇总它们以供您查看。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T14:30:39.140

我曾经看过[Zend Core](http://www.zend.com/en/products/core/features)的截屏视频。看起来不错，但实际上要花钱，我不知道这对你来说是否有问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-25T15:20:47.710

XDebug 很好，但它不是那么容易使用或设置 IMO。

Zend Studio 内置的分析器非常易于使用。您只需点击浏览器工具栏上的一个按钮，然后*BAM*您就有了您的代码配置文件。ts 可能不如 CacheGrind 转储那么深入，但它对我来说总是足够好。

您还需要设置 Zend Platform，但这对于开发使用来说是直接且免费的——尽管您仍然需要为 Zend Studio 许可证付费。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T14:30:38.550

如果您安装 xdebug 扩展，您可以将其设置为导出运行配置文件，您可以在 WinCacheGrind（在 Windows 上）中读取。我不记得在 Linux 上读取文件的应用程序的名称。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-25T14:34:02.737

xdebug 的分析功能非常好。如果你得到它以 valgrind 格式保存输出，那么你可以使用 KCachegrind 或 Wincachegrind 之类的东西来查看调用图，如果你是一个视觉类的人，更容易弄清楚发生了什么。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-15T22:02:48.700

除了具有非常强大的实时调试功能外，NuSphere (www.nusphere.com) 的 PhpED 还具有一个内置的分析器，只需在 IDE 中单击即可运行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T22:07:06.283

最简单的解决方案是使用 Zend Profiler，您不需要使用 Zend Platform，您可以直接在浏览器中运行它，它非常准确，并且具有您需要的最多功能，并且集成在 Zend Studio 中

# c# - .NET - 如何隐藏 DateTimePicker 中的无效选择

> ID：133690
> 
> 赞同：2
> 
> 时间：2008-09-25T14:28:12.877
> 
> 标签：c#, datetime, controls, user-interface

我已经设置了 DateTimePicker 的 MaxDate 和 MinDate 属性。但是，当我在运行时测试控件时，无法区分无效日期和有效日期。唯一的区别是单击无效日期不会执行任何操作。

这对用户来说不是很直观。我希望能够一眼看出有效日期是什么。

有什么方法可以突出显示有效日期范围 - 或者更恰当地说，“暗淡”无效日期？或者，是否有另一个更合适的控制？我确信几个组合框会起作用，但我真的认为当被要求输入日期时，应该向用户展示一个日历控件。

上下文：这是一个 WinForms 图表应用程序。有效数据的范围是固定的（新数据是通过另一个进程添加的）。用户需要为图表的开始时间选择日期和时间（以及持续时间，单独处理）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T14:59:08.900

我有一个类似的问题。我扩展了 DateTimePicker 控件，以便在值更改时运行验证过程，并在发生非法选择时恢复到以前的值或最接近的合法值。

对此的逻辑扩展是闪现一个警告对话框或标签以通知用户这已经发生。

您还可以覆盖控件的日历显示部分以突出显示/降低无效选项 - 例如，它已经突出显示当前日期和当前选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T14:40:04.797

我不确定是否有自己没有扩展控制权，并且所有者绘制这将是一种努力。

如果您找不到您想要的功能，我会考虑使用 ErrorProvider 控件并验证用户输入作为一个选项。

# asp.net - 如何根据屏幕分辨率调整 Asp.Net 页面的大小

> ID：133691
> 
> 赞同：8
> 
> 时间：2008-09-25T14:28:20.737
> 
> 标签：asp.net

我正在开发一个具有图表控件的 Web 应用程序。我开发了一个通用图表用户控件以在整个应用程序中使用。

我正在寻找一种优雅的方法来设置图表控件以及其他控件的宽度，基于屏幕（浏览器大小）的高度。

请帮助我谢谢Shaik

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T14:36:21.483

一般而言，相对于客户端屏幕调整元素大小的最简单方法是给它一个指定为百分比的宽度（例如 25%）。您还可以通过以 em 为单位指定宽度（例如 10em），从而相对于字体大小调整对象的大小。

如果百分比不起作用，那么替代方法是使用 JavaScript 在客户端浏览器中动态调整对象的大小。这样做的缺点是 JavaScript 必须与构成控件的 HTML 元素交互，而不是直接作用于控件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T14:44:30.170

听起来您想根据客户端值调整服务器端动态图像的大小。您首先需要加载页面一次，使用 Javascript 获取屏幕大小。（谷歌。你可以在[Quirksmode.org](http://www.quirksmode.org/dom/w3c_cssom.html)上获得使用哪些 Javascript 元素的完整跨浏览器技术列表，但你仍然需要弄清楚如何自己编写脚本。）然后，将该大小发布回服务器，用这个新的大小设置控件，然后像往常一样将它呈现给客户端。请记住，如果用户完全调整浏览器窗口的大小，它将不再“适合”。而且你总是可以像 Aaron 提到的那样使用 CSS 的百分比大小，但是当然浏览器会调整图像的大小，这看起来永远不会那么好。

另一种选择是将它放在 Flash 控件中。只要图表是由 Flash 使用矢量元素呈现的，通常动态调整大小会更好。

无论哪种方式，您都需要确保这对您的网页设计有意义。有时让它动态化是好的，有时一定数量的静态大小是有意义的——这一切都取决于很多东西，包括是否值得去麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T18:12:44.007

Cyscape 的一款名为“Browserhawk”的产品[http://www.cyscape.com/showbrow.aspx](http://www.cyscape.com/showbrow.aspx)将为您提供在服务器端做出正确渲染决策所需的信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T18:32:10.043

一个隐藏的 div 设置为 100% by 100% 可以用来告诉你浏览器窗口客户区的大小；我认为没有回发/回调的方法可以测量屏幕

see [How to implement a web page that scales when the browser window is resized](https://stackoverflow.com/questions/90595/how-to-implement-a-web-page-that-scales-when-the-browser-window-is-resized) for additional info

# visual-c++ - 为什么我在 Visual Studio 中编译 C++ 项目时会出现致命错误“LNK1104：无法打开文件 'C:\Program.obj'”？

> ID：133698
> 
> 赞同：124
> 
> 时间：2008-09-25T14:29:48.550
> 
> 标签：visual-c++, linker

我在 Visual Studio 2008 中创建了一个新的 C++ 项目。尚未编写任何代码；只有项目设置已更改。

当我编译项目时，我收到以下致命错误：

> 致命错误 LNK1104：无法打开文件 'C:\Program.obj'

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-09-25T14:33:01.647

此特定问题是由指定对路径中有空格的 lib 文件的依赖关系引起的。路径需要用引号括起来才能正确编译项目。

在项目属性的**Configuration Properties -> Linker -> Input**选项卡上，有一个**Additional Dependencies**属性。此问题已通过添加引号得到解决。例如，将此属性更改为：

> C:\Program Files\sofware sdk\lib\library.lib

到：

> "C:\Program Files\sofware sdk\lib\library.lib"

我在哪里添加了引号。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2014-08-13T16:10:44.853

如果文件仍在运行，则可能会发生这种情况。

> :-1: 错误: LNK1104: 无法打开文件'debug\****.exe'

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-02-04T17:07:12.467

关闭并重新打开 Visual Studio 后，我的问题就消失了。不知道为什么会出现问题，但这可能值得一试。

这是在 VS 2013 Ultimate，Windows 8.1 上。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-12-26T19:11:31.633

还要检查您是否没有打开它：**Configuration Properties -> C/C++ -> Preprocessor -> Preprocess to a File**。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-12-22T09:51:46.410

我的问题是缺少`.lib`扩展名，我只是链接`mylib`，VS 决定寻找`mylib.obj`.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-09-26T05:20:37.513

我有同样的问题。它是由附加库路径的文件夹名称中的“，”引起的。它通过更改附加库路径来解决。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-08-13T19:54:57.807

在我的情况下，这是一个错误的参考问题。项目引用了另一个项目的输出，但后者没有输出前者正在寻找的文件。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-12-30T09:27:52.347

解决方案 1（就我而言）：重新启动 windows Explorer 进程（是的，windows 文件管理器）。

解决方案2：

1.  关闭 Visual Studio。Windows 注销
2.  登录，重新打开 Visual Studio
3.  像往常一样构建。它现在构建并可以访问有问题的文件。

我认为有时文件系统或控制它的人会丢失它的权限。在重新启动 Windows 会话之前，尝试杀死僵尸`msbuild32.exe`进程，重新启动 Visual Studio，检查 none 甚至显示问题文件。没有构建配置问题。它不时发生。Windows 中的某些内部问题无法修复，需要重新启动。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-19T11:22:31.187

我遇到了同样的错误，只是我安装了一个 Nuget 包（一个不仅是头文件），然后尝试卸载。
对我来说错的是我仍然在我的一个 .cpp 文件中包含我刚刚卸载的包的标题（非常愚蠢，是的）。
我什至在 中删除了指向它的附加库目录链接`Project -> Properties -> Linker -> General`，但当然无济于事，因为我仍在尝试引用不存在的标头。

在这种情况下绝对是一个令人困惑的错误消息，因为标题名称是`<boost/filesystem.hpp>`但错误给了我`"cannot open file 'llibboost_filesystem-vc140-mt-gd-1_59.lib'"`并且没有行号或任何东西。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-06-07T06:16:11.330

我遇到了同样的问题，但我的案例的解决方案未在答案中列出。我的防病毒程序 (AVG) 将文件确定`MyProg.exe`为病毒并将其放入“病毒库”。你需要检查这个仓库，如果文件在那里 - 然后恢复它。它帮助了我。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-11-16T00:26:17.397

对于装配项目（ProjectName -> Build Dependencies -> Build Customizations -> masm（已选择）），将**Generate Preprocessed Source Listing**设置为**True**也对我造成了问题，清除设置修复了它。VS2013 在这里。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-12-04T21:58:31.483

我遇到了同样的问题，链接器抱怨主可执行文件丢失。这发生在我们将解决方案移植到新的**Visual Studio 2013**期间。该解决方案是托管和非托管项目/代码的多种组合。问题（和修复）最终是解决方案文件夹中缺少***app.config***文件。花了一天的时间来解决这个问题:(，因为输出日志不是很有帮助。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-12-19T16:07:09.573

我根据此列表检查了所有设置：http: [//msdn.microsoft.com/en-us/library/ts7eyw4s.aspx#feedback](http://msdn.microsoft.com/en-us/library/ts7eyw4s.aspx#feedback)。这对我有帮助，对于我的情况，我发现项目属性的链接依赖项有双引号，不应该存在。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-12-08T09:09:29.507

在我的情况下，它是路径长度（包括文件名）。

```
..\..\..\..\..\..\..\SWX\Binary\VS2008\Output\Win32\Debug\boost_unit_test_framework-vc90-mt-gd-1_57.lib; 
```

至于发布路径是（这工作正常）：

```
..\..\..\..\..\..\..\SWX\Binary\VS2008\Output\Win32\Release\boost_unit_test_framework-vc90-mt-1_57.lib; 
```

==> 短一个字符。

1.  我还通过重命名 lib 文件（使用较短的名称）并在

*链接器 -> 输入 -> 附加依赖项*

2.  我还通过添加绝对路径而不是相对路径来验证这一点，因为所有那些“..”也扩展了路径字符串。这也奏效了。

**所以对我来说问题是路径+文件名字符串的总大小太长了！**

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-11-23T01:13:22.387

我正在回答，因为我没有看到其他人列出这个特定的解决方案。

显然，我的防病毒软件（Ad-Aware）标记了一个我的项目所依赖的 DLL，并将其删除。即使排除了 DLL 所在的目录，相同的行为仍然持续到我重新启动计算机。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-02-04T23:51:28.840

就我而言，我已经用 GLM 替换了之前游戏引擎图形课程中的数学库文件。问题是我没有将它们添加到 Visual Studio 的解决方案资源管理器中的项目中（即使它们在项目存储库中）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-02-07T04:56:58.410

我遇到了与 LNK2038 错误相关的问题，按照这篇[文章](https://stackoverflow.com/questions/7668200/error-lnk2038-mismatch-detected-for-iterator-debug-level-value-0-doesnt)隔离了 RELEASE 和 DEBUG DLL。在这个过程中，我清理了这些依赖项所在的整个文件夹。

幸运的是，我备份了所有这些文件，并将出现此错误的文件返回到 DEBUG 文件夹以解决问题。错误代码在某种程度上具有误导性，因为我不得不花费大量时间再次从这篇文章的一个答案中得出这个提示。

希望这个答案，对有需要的人有所帮助。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-05-31T18:20:17.567

我通过在我的解决方案中添加一个现有项目来解决它，**但**我**第** **一次****忘记**添加它**。**

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-10-25T18:31:45.647

我有同样的错误：

```
fatal error LNK1104: cannot open file 'GTest.lib;' 
```

这是最后造成的`;`。如果你有多个库，它们应该用空格（空格键）分隔，没有逗号或分号！

所以在列出库时不要使用`;`或任何其他东西`Project properties >> Configuration Properties >> Linker >> Input`

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-11-20T06:20:08.730

我尝试了上述解决方案，但对我没有用。所以我重命名了exe并重建了解决方案。这个对我有用。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-12-12T22:14:46.253

在 Visual Studio 2019 中构建 VC++ DLL 时，我遇到了这个确切的错误：

> LNK1104：无法打开文件“C:\Program.obj”

结果在项目属性>链接器>输入>模块定义文件下，我指定了一个在文件名末尾有**一个不匹配的双引号的def文件。**删除不匹配的双引号解决了这个问题。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-07-16T11:09:49.433

杀死`msbuild32.exe`并重新建造。它对我有用。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-09-13T01:32:38.123

我的问题是由其他应用程序使用我尝试调试**的 .dll文件引起的。**

**关闭****使用 .dll**的应用程序为我解决了这个问题。

 *** * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-05-30T19:09:18.877

可能的解决方案：

1.  检查路径是否包含任何空格，转到“属性”>“链接器”>“输入”>“附加路径”并包括“带空格的路径”

2.  如果程序仍在运行，请关闭所有内容并重新启动。

3.  检查是否未创建 .obj 文件。当您在“属性”>“C++”>“预处理器”>“生成预处理器文件”打开时直接构建项目时，会发生这种情况。将其关闭并构建项目，然后您可以打开 Properties > C++ > Preprocessor > Generate preprocessor file。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-09-13T11:44:09.423

我有一个类似的问题。我使用以下命令解决了它以终止正在运行的任务：

> taskkill /f /im [nameOfExe]

/f：强制关闭任务。/im：下一个参数是映像名称，也就是可执行文件名称，例如 Program.exe。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2018-11-14T05:25:58.877

我在“Visual Studio 2013”​​中遇到了同样的问题。

```
LNK1104: cannot open file 'debug\****.exe 
```

**它在关闭并重新启动 Visual Studio 后解决。**

* * *

## 回答 #27

> 赞同：-4
> 
> 时间：2017-09-14T10:19:16.890

我遇到了同样的问题，我刚刚将代码复制到新项目并开始构建。其他一些错误开始出现。错误 C4996：“fopen”：此函数或变量可能不安全。考虑改用 fopen_s

为了再次解决这个问题，我在 Project 项目中添加了我的一个属性，如下所示。项目 -> 属性 -> 配置属性 -> c/c++ 。在这个类别中有字段名称预处理器定义我添加了_CRT_SECURE_NO_WARNINGS这个来解决问题希望它会有所帮助......

谢谢你

# javascript - 如何创建带有可调整列的 HTML 表格？

> ID：133703
> 
> 赞同：11
> 
> 时间：2008-09-25T14:30:06.523
> 
> 标签：javascript, html, css, adjustable

我想知道如何创建一个可以调整列宽的表格。我还没有弄清楚如何做到这一点。如果你知道这种技术的秘诀，请告诉我。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2018-01-07T23:16:54.470

添加此 CSS 以使您的表格的列宽可调整...

```
 th {resize:horizontal; overflow:auto;} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-25T15:15:37.410

没有简单的答案，例如“使用一些 foobar html 属性”。这是通过 javascript 和 DOM 操作完成的。
如果您想通过 Prototype 看到此功能的实现，您可以查看[TableKit](http://www.millstream.com.au/view/code/tablekit/)。
我确信那里有 jQuery 实现......我喜欢我的旧原型；）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T14:34:14.110

我相信它就像在单元格标题边缘的区域捕获鼠标单击事件一样简单，然后在拖动鼠标时动态更改列的宽度。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T15:13:03.377

您是在寻找 Outlook 的效果还是出现 <-> 来显示您调整表格的大小？

*   我为此所做的，是创建一个只有几个像素宽的 div 或单元格。
*   我改变了光标，所以它是一个箭头<->。
*   单击该 div 控件上的使用
*   在单击该 div 控件上的使用时，我会即时创建另一个“浮动”div，以显示它们最终将其定位的位置。
*   移动与 JavaScript 上的鼠标移动事件相关联。
*   一旦释放控件，我就会根据他们移动新控件的位置重新定位表格单元格的高度或宽度。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-27T03:09:16.007

用于 jQuery 的[Flexigrid看起来很不错。](http://flexigrid.info/)

*更新：*根据@Vincent 的评论，使用非常简单......有关完整详细信息，请参阅站点，但是对于最基本的示例 - 包含脚本然后将功能挂钩到您的表：

```
$('#myTableID').flexigrid(); 
```

或带有选项：

```
$('.classOfTables').flexigrid({height:'auto',striped:false}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T14:41:06.307

Yahoo UI (YUI)[数据表](http://developer.yahoo.com/yui/datatable/)小部件允许调整列的大小。它是公开的，但仍处于测试阶段，而且 YUI 库非常庞大。任何实现都必须在 JavaScript/DHTML 中，因为默认的 HTML 表没有这种功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-03-29T08:18:22.660

申请不适用于我的 FF58 `resize:horizontal`。`<th>`相反，我在`<div>`它们中的每一个中创建了一个并调整了它的大小：

```
.mytable th div{
    resize:horizontal;
    overflow: auto;
} 
```

# java - Ant 和可用任务 - 如果某些东西不可用怎么办？

> ID：133710
> 
> 赞同：6
> 
> 时间：2008-09-25T14:31:10.497
> 
> 标签：java, ant, build

当我使用该任务时，该属性仅在资源（例如文件）可用时才设置为 TRUE。如果不是，则该属性未定义。

当我打印属性的值时，如果资源可用，则返回 true，否则只打印属性名称。

*如果资源不可*用，有没有办法将属性设置为某个值？我曾尝试在可用检查之前明确设置属性，但随后 ant 抱怨：

```
[可用] 已弃用 - 用于覆盖现有属性。
[可用] 构建文件不应为不同的值重用相同的属性名称。

```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-25T14:40:20.430

您可以将条件与 not 结合使用：

[http://ant.apache.org/manual/Tasks/condition.html](http://ant.apache.org/manual/Tasks/condition.html)

```
 <condition property="fooDoesNotExist">
    <not>
      <available filepath="path/to/foo"/>
    </not>
  </condition> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-09-02T15:19:28.087

```
<available filepath="/path/to/foo" property="foosThere" value="true"/>
<property name="foosThere" value="false"/> 
```

foosThere 的分配只有在您的可用性检查尚未设置为 true 时才会成功。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T16:07:33.760

这种行为的原因是目标中的 if/unless 属性。如果/除非设置了具有该名称的属性，则将执行具有此类属性的目标。如果它设置为 false 或设置为 true 没有区别。因此，您可以使用 available-task 设置（或不设置）属性并基于此执行（或不执行）任务。在available-task之前设置属性是没有办法的，因为ant中的属性是不可变的，一旦设置就不能更改。

有三种可能的解决方案，将属性设置为之前未设置的值：

1.  您将 available-task 与 not 结合使用。
2.  您创建一个设置属性的任务，仅当属性未设置时才会执行（除非任务属性）。
3.  您只需在调用*后将属性设置为可用。*由于该属性仅在未设置时才会更改，因此这将满足您的要求。

# ruby - 如何从 Ruby 的命令行读取密码？

> ID：133719
> 
> 赞同：35
> 
> 时间：2008-09-25T14:32:33.007
> 
> 标签：ruby

我在 Windows 机器上运行 Ruby 和 MySQL。

我有一些 Ruby 代码需要连接到 MySQL 数据库并执行选择。要连接到数据库，我需要提供密码等。

Ruby 代码可以显示要求输入密码的提示，用户输入密码并按 Enter 键。我需要的是将输入的密码显示为一行星号。

如何让 Ruby 将键入的密码显示为“dos 框”中的一行星号？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-25T16:19:52.967

为了回答我自己的问题，并且为了其他任何想知道的人的利益，您需要一个名为[HighLine的 Ruby gem。](http://rubydoc.info/gems/highline/frames)

```
require 'rubygems'
require 'highline/import'

def get_password(prompt="Enter Password")
   ask(prompt) {|q| q.echo = false}
end

thePassword = get_password() 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-25T14:36:41.560

穷人的解决方法：

```
system "stty -echo"
# read password
system "stty echo" 
```

或使用[http://raa.ruby-lang.org/project/ruby-password/](http://raa.ruby-lang.org/project/ruby-password/)

> 该库的目标受众是需要编写提示、生成、验证和加密密码的 Ruby 程序的系统管理员。

**编辑：**哎呀我没注意到你需要这个 Windows :(

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-04-14T17:52:52.340

根据 Highline 文档，这似乎有效。不确定它是否可以在 Windows 上运行。

```
#!/usr/local/bin/ruby
require 'rubygems'
require 'highline/import'

username = ask("Enter your username:  ") { |q| q.echo = true }
password = ask("Enter your password:  ") { |q| q.echo = "*" } 
```

这是控制台上的输出：

```
$ ruby highline.rb 
Enter your username:  doug
Enter your password:  ****** 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-06-01T19:03:43.230

从 Ruby 2.3 开始，您可以使用以下`IO#getpass`方法：

```
require 'io/console' 

STDIN.getpass("Password: ") 
```

[http://ruby-doc.org/stdlib-2.3.0/libdoc/io/console/rdoc/IO.html#method-i-getpass](http://ruby-doc.org/stdlib-2.3.0/libdoc/io/console/rdoc/IO.html#method-i-getpass)

[以上内容是从Zoran Majstorovic](https://stackoverflow.com/users/3452582/zoran-majstorovic)删除的答案中复制的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-09-11T21:35:27.073

以下作品（lobin.rb）在 ruby​​ 而不是 jruby

```
require 'highline/import'

$userid = ask("Enter your username:  ") { |q| q.echo = true }
$passwd = ask("Enter your password:  ") { |q| q.echo = "*" } 
```

控制台输出：

```
E:\Tools>ruby login.rb
Enter your username:  username
Enter your password:  ******** 
```

但是，如果我在 jruby 中运行它会失败并且没有机会输入您的密码。

```
E:\Tools>jruby login.rb
Enter your username:  username
Enter your password: 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-08T13:51:06.747

fancy_gets gem 有一个可以与 jruby 配合使用的密码：

[https://github.com/lorint/fancy_gets](https://github.com/lorint/fancy_gets)

代码最终如下：

```
require 'fancy_gets'
include FancyGets

puts "Password:"
pwd = gets_password
# ... 
```

# version-control - 在 CVS 中移动文件而不重置修订号

> ID：133721
> 
> 赞同：10
> 
> 时间：2008-09-25T14:32:50.383
> 
> 标签：version-control, cvs

最近我一直在我们的源代码树中移动源文件。例如，将一堆文件放入一个通用程序集中。我一直在这样做，我从 CVS 中删除文件，然后在新位置再次添加它。问题是文件的修订号重置回 1.1。有没有一些简单的方法可以在不重置数字的情况下移动东西。

我可能应该提到我无权访问存储库，所以任何需要的东西都对我没有帮助，但它可能会帮助其他人。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-25T14:57:29.403

实现此效果的普遍接受的方法是执行以下步骤。技术术语是复制。

1.  登录托管 CVS 存储库的服务器并将存储库文件从您想要的位置**复制**（不要移动）到新位置。
2.  在客户端 cvs 从旧位置删除文件。
3.  在客户端 cvs 更新新位置的目录内容（这样文件就会出现在那里）。
4.  在客户端执行复制文件的强制 cvs 提交（使用 -f 标志）以记录它被重新复制的事实（为此添加日志注释）。

此过程将文件历史记录保留在其新位置，并且也不会破坏存储库的向后连续性。如果您及时返回，该文件将正确显示在其旧位置。您也可以使用相同的过程重命名文件。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-25T14:42:48.003

无法使用仅限客户端的命令来移动文件。您需要访问服务器文件系统，并且可以将存储库中的“,v”文件移动到新位置。这将保留所有历史记录，因为 CVS 将每个修订及其注释记录在该文件中。

请记住，文件在被删除时会被移动到“阁楼”子文件夹（无法从客户端看到）。这就是文件被删除后如何恢复的方式。

通常，这种方法不会立即出现问题，但是如果您决定检查可能依赖于先前目录结构的产品的早期版本，则必须考虑后果！

这是其他版本控制系统（如 Subversion）具有明确优势的地方。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T14:36:07.787

[在线 CVS 手册](http://www.cvsnt.org/manual/html/Moving-files.html)有一些关于如何执行此操作的详细信息：

> 移动文件的正常方法是发出 cvs rename 命令。
> 
> $ cvs 重命名旧的新的
> $ cvs commit -m "将旧的重命名为新的"
> 
> 这是移动文件的最简单方法。它不容易出错，并且保留了所做操作的历史记录。CVSNT 客户端可以通过检出旧版本的存储库来检索原始名称。
> 
> 此功能仅在 CVSNT 服务器 2.0.55 及更高版本上受支持。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T14:37:10.890

最简单的方法是访问你的 repo 所在的 cvs 服务器，然后用 mv 移动你的文件夹/文件（假设是一个 *nix 机器）。这样文件的历史将被保留。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T14:36:15.243

这不是 CVS 的已知缺陷之一——没有用于移动文件的内置机制吗？然而，我已经很久没有使用它了，所以也许现在有一个解决方案。

Subversion 将允许您移动文件，但也会对其进行跟踪，以便新文件获得最新的修订号。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T15:08:08.223

它似乎保留了您在移动时必须使用 -v 选项的版本历史记录，请参见下文

> CVS 重命名文件很麻烦。从存储库的角度来看，您可以删除文件或添加新文件。所以，通常的流程是
> 
> mv oldfile.c newfile.c cvs delete oldfile.c cvs add newfile.c
> 
> 这确实有效，但是在多年的艰苦开发过程中，您丢失了您在提交操作中编写的所有更改信息，这可能不是您想要的。但是有办法；您必须可以直接访问存储库。首先，去那里，找到你的项目所在的目录并执行以下操作：
> 
> cp oldfile.c,v newfile.c,v
> 
> 现在转到您的工作目录并进行 cvs 更新；newfile.c 将显示为一个新文件。现在您可以 cvs 删除 oldfile.c 并提交。

# reporting-services - SSAS 中的自定义 ROLAP 数据源

> ID：133751
> 
> 赞同：1
> 
> 时间：2008-09-25T14:37:18.220
> 
> 标签：reporting-services, ssas, olap, cubes, rolap

我正在尝试从一堆二进制文件构建 OLAP 数据源，而我们当前的模型无法正常工作。我们使用 SSAS 作为结果的分析/报告模型，但无法从 SQL 中获得我们想要的性能。

我们的主要限制是：

1.  数据库非常大。我们有数百万行的巨大维度表和几个较小的事实表（<1,000,000 行）。

2.  我们有一个动态多维数据集。B/C 事实表是动态构建的，并且通常（可能每天多次），在设置多维数据集时不会有任何巨大的开销。当前在多维数据集上的部署时间可能超过 24 小时，我们需要将性能提高几个数量级，而硬件无法提供给我们。

基本上，我们想要一个快速的设置和部署，它本身并不适合使用 SQL Server 2005 的 SSAS，但是我们想要使用 SSRS 进行报告，并且我们想要一个 OLAP 模型在 Excel 中进行分析，所以我们仍然想如果可能，使用 SSAS 构建多维数据集。

SSAS 中用于快速部署的常见解决方案是 ROLAP，但我们会在较大的 ROLAP 查询中遇到执行错误，而且我们也不喜欢将二进制数据转换为 SQL 并将其加载到多维数据集中所涉及的所有开销。

有没有人在 SSAS 可以使用的自定义 OLAP 数据源上做过工作？我们正在寻求创建我们自己的 ROLAP 引擎，它将直接查询二进制源文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T15:04:02.073

如果您需要一个低延迟多维数据集（即显示最新数据的多维数据集），则此类事物的规范架构是：

*   使用来自源的更改数据增量加载事实表。
*   使用每天或其他合适时间生成新分区的进程构建分区多维数据集。多维数据集以 ROLAP 模式设置了最新的分区，并将较旧的分区构建为 MOLAP。
*   设置一个更新分区并将旧分区从 ROLAP 更改为 MOLAP 的进程，因为它会生成新的前沿分区。

针对多维数据集的查询将针对最新数据针对相对较小的 ROLAP 分区，针对历史数据针对 MOLAP 分区。MOLAP 分区可以有聚合。该过程不断在前沿 ROLAP 分区上打勾并转换其前身。AS 将保留旧分区并使用它，直到替换分区建成并上线。

如果这种类型的架构符合您的要求，您可以考虑这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T15:35:25.553

感谢您的回复，奈杰尔。

我想我需要更好地解释一下。我的源数据采用专有格式，而不是数据库，因此获取事实表本身需要相当多的时间。然后我们需要尽快（最好在几分钟内）部署多维数据集并获得快速的查询响应，即使在使用 SQL 的小型数据集上我们目前也看不到。

因为多维数据集的结构是动态的，我们经常不得不重建多维数据集的各个方面，我们不会在事后引入新数据，因此将其部分划分为 MOLAP 和 ROLAP 的其他部分并没有真正的帮助。我们正在寻找“全流程”的性能。

我们开始意识到我们不能使用 SQL 进行查询，并且想知道是否有人创建了分析服务（或任何 OLAP 工具）可以读取的自定义 ROLAP 数据源。

我们可以快速处理创建结果集；我们只需要弄清楚如何从 SSAS 获取查询并将这些结果反馈给它。我们实际上只是希望将 SSAS 用作我们的系统与 Excel、SSRS 等之间的中介，而不是使用它来处理或聚合数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T19:19:14.377

您能否将[R](http://www.r-project.org/)之类的东西与自制库（它支持[C 扩展](http://cran.r-project.org/doc/manuals/R-exts.html)）一起使用来连接您的数据集。R 将为您提供相当大的灵活性来构建复杂的报告或数据预处理库。它还有一个[Excel](http://sunsite.univie.ac.at/rcom/excel/index.html)接口。

这是与传统 DB/OLAP 模型有些不同的工具链，但您可以相当轻松地用 C 语言编写快速数据集加载器，并跳过加载到数据库的中间步骤。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T20:26:44.437

我还没有运气。我们正在走的路线是构建我们自己的数据提供程序并构建用于 excel 的插件来模拟 olap 行为，或者使用 CLR 表值函数来模拟我们的数据源并以此构建多维数据集。我在 CLR 上进行的一次尝试性能很差，但由于构建多维数据集时 SSAS 运行的查询量很大，但结果却失败了。我正在等待在 SQL 08 环境中获得更新更快的机器，看看这是否可行。祝斯科特好运。

# c# - 如何将 XML 文件反序列化为具有只读属性的类？

> ID：133772
> 
> 赞同：2
> 
> 时间：2008-09-25T14:40:28.120
> 
> 标签：c#, .net, xml, xml-serialization

我有一个用作设置类的类，该类被序列化为 XML 文件，然后管理员可以对其进行编辑以更改应用程序中的设置。（设置比`App.config`允许的要复杂一些。）

我正在使用`XmlSerializer`该类来反序列化 XML 文件，并且我希望它能够设置属性类，但我不希望使用该类/程序集的其他开发人员能够通过代码设置/更改属性。我可以使用 XmlSerializer 类来实现这一点吗？

添加更多细节：这个特定的类是一个集合，根据 FxCop，`XmlSerializer`该类具有对反序列化只读集合的​​特殊支持，但我无法找到更多关于它的信息。这违反的规则的确切细节是：

> 返回集合的属性应该是只读的，这样用户就不能完全替换后备存储。用户仍然可以通过调用集合上的相关方法来修改集合的内容。请注意，XmlSerializer 类对反序列化只读集合具有特殊支持。有关详细信息，请参阅 XmlSerializer 概述。

这正是我想要的，但它是如何做到的呢？

**编辑：**好的，我想我在这里有点疯狂。就我而言，我所要做的就是在构造函数中初始化 Collection 对象，然后删除属性设置器。然后 XmlSerializable 对象实际上知道使用 Collection 对象中的 Add/AddRange 和 indexer 属性。以下确实有效！

```
public class MySettings
{
    private Collection<MySubSettings> _subSettings;
    public MySettings()
    {
       _subSettings = new Collection<MySubSettings>();
    }

    public Collection<MySubSettings> SubSettings
    {
         get { return _subSettings; }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T14:46:26.903

您必须使用可变列表类型，例如 ArrayList（或 IList IIRC）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T14:44:53.227

我认为您不能使用自动序列化，因为该属性是只读的。

我的做法是实现[ISerializable](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.aspx)接口并手动完成。您将能够从这里设置内部值。

但是，如果您的子对象（以只读方式公开）可以自行序列化，那么它应该都能正常工作..

我认为 FxCop 抱怨的规则是你有类似的东西：

```
public List<MyObject> Collection
{
   get { return _collection; }
   set { _collection = value; }
} 
```

不是吗？如果没有，你能粘贴一些代码，这样我就可以看到你到底在做什么？有几种方法可以完成上述所有操作:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T15:03:20.450

@Rob Cooper 说得对，只需实现[ISerializable](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.aspx)接口，您就可以自定义控制您的类如何序列化和反序列化并手动设置字段。这是一个多一点的腿部工作，但它会实现你想要的目标。祝你好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T15:10:33.057

@leppie 的回应实际上是最接近的。这是 XmlSerializer 文档中的实际相关文本，有关更多详细信息，请参阅我对上述问题的编辑：

> XmlSerializer 对实现 IEnumerable 或 ICollection 的类进行特殊处理。实现 IEnumerable 的类必须实现采用单个参数的公共 Add 方法。Add 方法的参数必须与从 GetEnumerator 返回的值的 Current 属性返回的类型相同，或者该类型的基数之一。除了 IEnumerable 之外，实现 ICollection 的类（例如 CollectionBase）必须具有采用整数的公共 Item 索引属性（C# 中的索引器），并且必须具有整数类型的公共 Count 属性。Add 方法的参数必须与从 Item 属性返回的类型相同，或者是该类型的基数之一。对于实现 ICollection 的类，要序列化的值是从索引的 Item 属性中检索的，

# python - 并发访问 RRD (RRDTool)

> ID：133774
> 
> 赞同：2
> 
> 时间：2008-09-25T14:40:55.420
> 
> 标签：python, rrdtool

我使用 RRDTool ( [http://oss.oetiker.ch/rrdtool/](http://oss.oetiker.ch/rrdtool/) ) 作为图形后端来存储性能指标。这是通过 Python 脚本中的 RRDTool CLI 完成的。

我的问题是脚本是多线程的，每个线程都以相当快的速度更新 RRD。有时更新失败是因为一个线程正在访问 RRD 文件，而另一个线程也尝试访问它。

我的印象是这可以尝试，因为 RRDTool 使用自己的锁定机制，但我想这不是真的。

有没有人有并发访问 RRD 的好方法？

我可以想到几种方法：

1.  让 1 个线程创建一个队列，并且仅从单个线程提供 RRD。

2.  在 Python 脚本中创建我自己的锁定机制。（我该怎么做？）

有什么更好的或者你以前遇到过这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-04T11:37:12.190

您也可以尝试使用 rrdcached 进行更新。然后所有的写更新都会通过rrdcached进行序列化。当您想读取 RRD 以生成图形时，您告诉守护程序刷新它，然后磁盘上的 RRD 将代表最新状态。

如果通过环境变量指向缓存的守护进程，所有 RRD 工具都会透明地执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-22T11:40:09.513

[rrd-users 列表中的这个线程](http://www.mail-archive.com/rrd-users@lists.oetiker.ch/msg13015.html)可能很有用。rrdtool 的作者指出，它的文件锁定处理并发读取和写入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T15:32:22.893

一个独占锁应该足以解决这个问题：

*   [Python 文档页面](http://docs.python.org/lib/lock-objects.html)
*   [使用示例](http://effbot.org/zone/thread-synchronization.htm)

在主级别定义你的锁对象，而不是在线程级别，你就完成了。

编辑回应评论：

如果你`lock = new Lock()`在线程级定义你的锁（

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-02T21:54:03.600

我建议使用`rrdcached`，这也将提高数据收集器的性能。(1.4.x)的最新版本`rrdtool`大大提高了 ; 的功能和性能`rrdcached`。您也可以根据数据调整缓存行为以进行优化。

我们在这里大量使用 rrdcached，每秒对大量 RRD 文件进行数百次更新。

# svn - SVN 项目组织：每个模块或每个项目

> ID：133777
> 
> 赞同：7
> 
> 时间：2008-09-25T14:41:14.060
> 
> 标签：svn, project-organization

我有一个 subversion 存储库，其中包含多个子文件夹，对应于构成我的项目的各种应用程序、配置文件、DLL 等（我将它们称为“模块”）。现在我们开始“分支”成几个相关的项目。也就是说，每个高级项目都将使用一些模块，可能会在项目之间稍作修改。项目数量（~5）小于模块数量（~20）

现在我想弄清楚如何组织回购。逐个模块地保留顶级子文件夹是否有意义，每个项目都有子文件夹？或者顶层应该是每个项目，每个项目都有自己的模块子文件夹：

回购：

```
module 1
    Project 1
    Project 2
    ...

    Project 5
module 2
    Project 1
    ....
    Project 5
....
module 20
    Project 1
    ...
    Project 5 
```

-或者-

回购：

```
Project 1
   module 1
   module 2
   ...
   module 20
Project 2
   module 1
   module 2
   ...
   module 20
...
Project 5
   module 1
   module 2
   ...
   module 20 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T14:57:40.323

最好在顶层按**Project**进行组织，因为您将要检出整个分支并拥有该项目的工作副本。如果您按模块进行组织，则必须进行多次检出（您使用的每个模块一次检出）才能将项目构建到可用的程度。

将项目和模块分开可能是有意义的，例如：

```
Projects
   Project 1
   Project 2
   ...
Modules
   Module 1
   Module 2
   ... 
```

如果您将它与 svn [**externals**](http://svnbook.red-bean.com/en/1.0/ch07s03.html)和/或[**供应商分支**](http://svnbook.red-bean.com/en/1.1/ch07s05.html)结合使用，您可以为需要不同模块版本的项目支持不同的分支，但当项目碰巧共享相同版本的模块时，仍然受益于拥有单个模块源.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T14:45:23.707

我会按项目组织然后按模块（你的第二个例子）。主要原因是管理项目的开销比管理模块要多，至少对我来说是这样。

每个不同的项目都需要自己的构建脚本设置、属性文件等，并且在您的计算机上跟踪 5 个工作副本要比跟踪 20 个工作副本容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T14:46:02.023

我更喜欢第一个。

虽然维护每个存储库确实需要额外的努力，但我喜欢我的修订号对项目有意义。

即我们的旗舰产品修订版为48123，我们的新项目修订版为31。如果您有跨存储库依赖关系，那么您可以使用svn externals。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T14:45:12.663

我认为您使用“高级”来描述项目是什么表明您应该设置项目/模块。

但是，您可以设置模块和项目 - 即，它们在 SVN 存储库中处于同一级别。您的项目可以依赖模块，如果可能，项目可以提供特定的操作实现，将模块变成具有默认但可覆盖实现的基本模块。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T15:05:04.427

我倾向于按项目组织，但现在总是。如果您的代码有访问控制方面的内容，请组织以*最小化权限管理*；这也可能导致存储库的每个团队组织。

顺便说一句：您似乎希望在一个大存储库中工作 - 我认为这很聪明，因为这意味着更好的历史处理：一旦您在存储库之间移动内容，您就会丢失历史记录。换句话说，我不同意 Ben Scheirman 对此的建议。

# routing - 是否可以在 IIS 5 中使用 Castle MonoRail 路由功能？

> ID：133806
> 
> 赞同：1
> 
> 时间：2008-09-25T14:45:08.357
> 
> 标签：routing, iis-5, castle-monorail

我是否必须使用 IIS 6 或更高版本才能使用 Castle MonoRail 路由功能？

我知道 casini 可以工作，但实际上我们不会使用 casini 部署 Web 应用程序，不是吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T17:17:31.483

通常所需的配置更改是对所有文件扩展名的请求都通过 ASP.net 过滤器（您可以在 IIS 中检查 .aspx 扩展名的配置）。

但是，对于特定虚拟目录的请求，而不是该目录中的特定文件，IIS 会在通过请求之前尝试验证目录是否存在。为了解决这个问题，人们通常编写一个 ISAPI 过滤器来拦截对目录的请求，或者将所有以 .mr 结尾的请求映射到 ASP.net 引擎，并调整他们的 url 呈现策略。

# java-me - 将 WBXML 数据发送到 Web 服务器的更好方法是什么？

> ID：133815
> 
> 赞同：2
> 
> 时间：2008-09-25T14:46:09.713
> 
> 标签：java-me, mobile

请您帮我以 WBXML 格式将数据从移动应用程序发送到 Web 服务器？我有一点将 xml 转换为 wbxml，但没有得到如何以有效的方式将其发送到 Web 服务器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T13:50:23.727

I'm not sure I fully understand your question but here goes...

You need to use a POST HTTP request, and write the WBXML data to the connection objects output stream. Here is a brief example, obviously you'll need more code for it to actually work:

```
byte[] wbxml = getMyWbxmlData();
HttpConnection conn = (HttpConnection)Connector.open("http://myserver.com/mywbxmlhandler");
conn.setRequestMethod(HttpConnection.POST);
OutputStream output = conn.openOutputStream();
output.write(wbxml);
InputStream input = conn.openInputStream(); // This will flush the outputstream
// Do response processing 
```

That is all assuming your WBXML already includes the preamble, such as version number, public code page identifier etc.

# c++ - c++ boost lambda 库

> ID：133837
> 
> 赞同：4
> 
> 时间：2008-09-25T15:00:10.273
> 
> 标签：c++, functional-programming, boost-lambda

使用 boost lambda 库开始编程的最佳方式可能是什么。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-25T19:17:18.063

在 C++ 语言和库的范围内，我建议首先习惯使用 STL 算法函数模板进行编程，因为 boost::lambda 最常见的用途之一是用内联表达式替换仿函数类。

库文档本身为您提供了它的用途的前期示例：

```
for_each(a.begin(), a.end(), std::cout << _1 << ' '); 
```

where`std::cout << _1 << ' '`产生一个函数对象，当被调用时，它将其第一个参数写入`cout`流。您可以使用自定义仿函数类`std::ostream_iterator`或显式循环来执行此操作，但 boost::lambda 在简洁性和清晰度方面胜出——至少如果您习惯于函数式编程概念的话。

当您（过度）使用 STL 时，您会发现自己倾向于 boost::bind 和 boost::lambda。它对以下事情非常方便：

```
std::sort( c.begin(), c.end(), bind(&Foo::x, _1) < bind(&Foo::x, _2) ); 
```

在你到达那一点之前，没有那么多。所以使用 STL 算法，编写自己的函子，然后使用 boost::lambda 将它们转换为内联表达式。

从专业的角度来看，我相信开始使用 boost::lambda 的最佳方式是让 boost::bind 的用法被理解和接受。在 boost::bind 表达式中使用占位符看起来没有“裸”boost::lambda 占位符那么神奇，并且在代码审查期间更容易接受。超出基本的 boost::lambda 使用很可能会让你的同事感到悲伤，除非你在一个前沿的 C++ 商店。

尽量不要太过分——在*某些*时候和地方，`for`-loop*确实*是正确的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T15:13:26.747

依靠。您是否已经精通函数式编程概念？如果没有，我建议您从专为函数式编程设计的语言开始，而不是使用带有功能特性的过程语言。如果您不习惯以函数式风格进行编码（不一定*更难*，但肯定会有所不同），那么您将花费更多时间与语法作斗争，而没有足够的时间学习完成工作。

至于从哪里开始，我在 Scheme 上切入了我的功能性牙齿，但有很多不错的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T15:13:53.920

如果您使用的是相当新的编译器，则可以使用 boost。如果它不在您的机器上，请安装它（在 unbuntu 上使用 sudo apt-get install libboost-dev，如果您在 Windows 上，则从 boost.org 获取二进制文件）。阅读[文档](http://www.boost.org/doc/libs/1_36_0/doc/html/lambda.html)，然后查看现有代码以了解可能使用它们的情况。例如，如果您使用一小段代码对函数进行参数化，您是否有很多可以消除的代码重复？

# ruby-on-rails - 为什么 Helpers 中不应该有 html？

> ID：133840
> 
> 赞同：8
> 
> 时间：2008-09-25T15:00:38.850
> 
> 标签：ruby-on-rails, ruby

我听说最好不要在您的助手中实际包含任何 html；我的问题是，为什么不呢？此外，如果你试图生成一个 html 列表或类似的东西，我怎样才能避免实际的标签？

谢谢！

-fREW

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-25T19:48:27.053

我的建议 - 如果它是一小段 HTML（几个标签），请不要担心。不仅如此 - 考虑部分（因为在帮助程序中将 html 字符串拉在一起是一种痛苦，而这正是视图所擅长的）。

我经常在我的助手中包含 HTML（直接或通过调用 Rails 方法，如 link_to）。我的世界并没有在我周围崩溃。事实上，我想说的是，我的代码因此非常干净、可维护和易于理解。

就在昨晚，我写了一个 link_to_user 助手来吐出带有用户正常链接的 html 以及旁边的用户图标。我本可以部分完成，但我认为 link_to_user 是一种更简洁的处理方式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T21:25:05.010

我看不出有什么问题。大多数 rails 助手生成 HTML 代码（这是他们的目的）——对我来说，这意味着这就是你应该自己做的事情。

然而，始终存在代码可读性问题。如果你有一个只构建一大串原始 HTML 的助手，那么它会很难理解。虽然在帮助程序中生成 HTML 很好，但您应该使用`content_tag`,`render :partial`而不仅仅是`return %Q(<a href="#{something}">#{text}>)`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T15:06:36.497

这不是您问题的完整答案，但您可以通过[content_tag](http://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html)方法在标签中创建 html。我猜为什么会是代码的清洁度。

此外， content_tag 允许您将标签嵌套在块中。查看[content_tag 上的这篇博文](http://tuples.us/2007/05/03/content_tag-is-fixed/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-30T17:36:42.277

在 Rails 3 上，您可以使用***html_safe*** String 方法使您的辅助方法返回不会被转义的 html 标记。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T15:52:26.370

如前所述，帮助程序通常被认为用作业务逻辑，用于执行驱动视图代码但不是视图代码本身的事情。放置生成视图代码片段的东西的最常规位置是部分。如果需要，partials 可以调用 helper，但为了保持分离，最好将业务保持在 helper 中，view 在 partial 中。

另外，请记住，这都是惯例，而不是硬性规定。如果有充分的理由打破惯例，那就做最有效的事情。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-08-05T02:53:16.423

我通常将 html 放入部分中。

考虑语义。如果你把 html 放在一个字符串中，你就失去了它的语义方面：它变成了一个字符串而不是标记。非常不一样。例如，您无法验证字符串，但可以验证标记。

我想将 html 放入帮助程序而不是部分（以及我如何找到该线程）的原因是简洁。我希望能够写`=hr`而不是`=render 'hr'`.

要回答我没有问的问题；-)：要在帮助程序中取消转义 HTML，试试这个

```
def hr
  raw '<hr />'
end 
```

# coding-style - 没有权威的责任是没有意义的——基于技术的解决方案？

> ID：133847
> 
> 赞同：4
> 
> 时间：2008-09-25T15:01:45.697
> 
> 标签：coding-style, development-process

我爸爸总是说“没有权威的责任是没有意义的”。

但是，我发现作为开发人员，我们总是陷入以下情况：

*   负责确保软件“无错误”，但无权实施错误跟踪系统
*   负责按时完成项目，但不能影响需求、质量或团队资源（项目管理的三个部分）
*   等等

当然，你可以说很多事情来解决这个问题——找一份新工作，和老板打架，等等......

但是这个问题的技术解决方案呢？也就是说，你可以自己做什么样的编码事情，*而*不必说服团队纠正其中的一些问题——或者你可以使用什么样的工具来证明为什么未跟踪的错误会伤害你，错过最后期限是因为质量问题，你如何利用这些工具获得更多的“权威”，而不必当老板？

* * *

***举个例子——老板来找你说“为什么有这么多虫子！！？！？” - 我们中的大多数人会说“我们没有一个好的系统来跟踪他们！”，但根据我的经验，这通常被视为一个借口。那么，如果您可以指向一些报告（经理喜欢报告）并说“看，这就是为什么”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T16:13:28.927

你所能做的就是尽力而为，不要觉得成功软件的关键就在你手中，你是团队的一员，不必对所有事情负责。

显然，您所处的环境会对您的软件产生负面影响，但无法改变他的所有行为，所以我建议您从您的开始，开始作为一个团队工作，有自己的错误、截止日期、要求、质量和资源不为剩下的混乱烦恼，但尽量在工作中做到最好。

作为一个自我指导的团队，向您的老板展示您的计划和进度报告，在您需要时寻求更多资源，并向他展示您的计划是否会受到影响。

您可以在wikipedia的[PSP](http://es.wikipedia.org/wiki/Personal_Software_Process)和[TSP](http://en.wikipedia.org/wiki/Team_Software_Process)文章中找到更多关于此的建议

在向您的老板展示出色的工作并按时完成任务后，他肯定会更加信任您，并让您的一些想法流向整个团队。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T15:06:53.750

您不需要错误跟踪系统，您需要自动化测试：单元测试或其他。您可以使用 Makefile 设置自动化测试。您总是可以找到被管理层阻止的路径，但这并不意味着您在工作的限制范围内无法做任何事情。当然，答案可能是“找另一份工作”。如果您现在找不到另一份工作，请学习一些技能，以便您可以。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T16:48:48.217

简单的答案是——您可以自己开始使用这些工具。

改进*自己的*工作。如果人们希望您修复代码，请告诉他们提交错误。向他们展示如何。确保他们可以在不安装任何东西的情况下做到这一点。他们想要状态更新？告诉他们检查错误。他们询问您所做的代码更改？向他们展示如何进行源代码控制历史查询。或者只是在你的盒子上展示它们。开始向他们展示这些东西*是有效*的。

当你需要从他们那里得到同样的结果时，要求他们做一些跑腿的工作。当您在源代码管理中找不到更改时，请他们开始从备份磁带中手动区分他们的修订。不要为他们做他们的工作，或者源代码控制和错误跟踪的工作。

最重要的是，在施加这种同伴压力时，**要善待它**。苍蝇和蜂蜜等等。

如果他们不明白，您可以继续成为您公司或团队中唯一的[专业开发人员。](http://www.codinghorror.com/blog/archives/000643.html)或者至少它有助于充实你的简历：*“在 CVS 和 FogBugs 中建立和指导他人提高产品质量的经验”*等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T15:34:20.407

至于用于显示未跟踪的错误正在损害团队生成高质量代码的能力的特定工具，这里有一个 catch-22，因为您需要一些东西来跟踪错误，然后才能显示它们的影响。你无法衡量你无法追踪的东西。那么该怎么办？

作为一个类似的例子，我们最近有一个人加入了我们的团队，他觉得我们通过电子邮件进行代码审查的方式很荒谬。因此，他找到了一个开源工具，将其安装在他的盒子上，让我们一些思想开放的团队成员试用了一段时间，然后将其演示给我们的团队负责人。几周之内，他就有机会向我们所有的团队进行演示。这个新人正在影响整个公司。我听说过很多采用这种游击式工具的故事。

**诀窍在于确定谁有权做出决定，找出他们看重的东西，并收集足够的证据证明你想要实施的东西会给他们带来他们看重的东西。**

要更广泛地了解如何从组织的中层或底层领导，请查看 John Maxwell 的*360 度领导者*。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-31T16:11:04.580

如果您想要一份关于质量及其对生产力的影响的报告 - 这是最好的：http: [//itprojectguide.blogspot.com/2008/11/caper-jones-2008-software-quality.html](http://itprojectguide.blogspot.com/2008/11/caper-jones-2008-software-quality.html) Caper Jones 有几本书和仍然出现在会议上。在一个好的 IDE 之外，开发人员/IT 团队需要源代码控制（VSS、SubVersion 等）和问题跟踪

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-26T14:48:59.930

如果会计师被要求在不使用复式输入的情况下生成一组帐户并且不平衡，那么没有人会期望会计师这样做。

然而，自大约 13 世纪以来，会计师一直在标准使用复式记账法。

我们作为一个行业需要很长时间才能拥有如此根深蒂固的标准实践，以至于没有它们就可以工作。

**所以，很抱歉，我预计我们将不得不在未来很多**年面对这类问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T15:06:05.127

很抱歉没有直接回答你的问题，但是......

我强烈认为你提到的失败是一种沟通，作为专业人士，我们有责任发展我们的沟通技巧，使我们得到足够的尊重和信任，以利用我们需要的权威来改善我们的工作环境和流程你建议的方式。

简而言之，我认为没有一种技术方案可以解决工作场所因沟通不畅而产生的所有问题。

如果有的话，技术已经导致直接面对面交流的损耗。

抱歉，我又跑题了 - 随意降级。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T15:07:02.440

只有编码才能使您自己的源文件保持整洁、注释良好、通过测试保持低错误数。但是您将需要用于跟踪进度和错误的外部工具（bugzilla、yoxel、trac、甘特图工具、Mylyn for Eclipse、博客等等）。在这些情况下，人、纪律、良好习惯和领导力是压倒性的力量，没有任何软件工具和个人的提议可以单独获胜。

# language-agnostic - AOL 和 Outlook 通讯录采集器

> ID：133851
> 
> 赞同：0
> 
> 时间：2008-09-25T15:02:25.837
> 
> 标签：language-agnostic

当用户插入他的用户名和密码时，我如何获取 aol 或 Outlook 通讯簿我看到很多程序这样做，也许有人有源代码？

我为 yahoo gmail 和 hotmail 找到了一个非常好的

[https://sourceforge.net/projects/opencontactsnet/](https://sourceforge.net/projects/opencontactsnet/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T15:32:58.650

您无法获取 Outlook 通讯簿，因为它们位于用户的计算机上 - 它们需要导出为 CSV 并上传。有[很多](http://www.google.com/search?rlz=1C1CHMP_enUS291&sourceid=chrome&ie=UTF-8&q=asp.net+import+csv)使用 ASP.NET 导入 CSV 文件的教程。

看起来您也无法获得 AOL 联系人 - 根据[本文](http://www.readwriteweb.com/archives/yahoo_releases_address_book_api.php)，他们是唯一没有提供公共地址簿 API 的主要电子邮件提供商。

# python - 在 apache 和 mod_python 下运行 subversion

> ID：133860
> 
> 赞同：6
> 
> 时间：2008-09-25T15:05:26.437
> 
> 标签：python, svn, apache

我的 Apache 服务器在一些非默认（非 root）帐户上运行。当它尝试运行一个 python 脚本，该脚本又执行一个 subversion checkout 命令时，'svn checkout' 失败并显示以下错误消息：

```
svn: Can't open file '/root/.subversion/servers': Permission denied 
```

同时在同一用户帐户下的命令行中使用 subversion checkout 命令运行该 python 脚本运行良好。

带有 mod_python 3.2.8 的 Apache 服务器 2.2.6 在 Fedora Core 6 机器上运行。

有人可以帮帮我吗？非常感谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T15:26:22.457

听起来您运行 apache 进程的环境有点不寻常。不管出于什么原因，svn 似乎认为它需要的用户配置文件在 /root 中。您可以通过在命令行上指定要使用的配置目录来避免 svn 使用文件的根版本，如下所示：

```
svn --config-dir /home/myuser/.subversion checkout http://example.com/path 
```

虽然没有修复您的环境，但它至少可以让您的脚本正常运行......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T08:53:26.420

好吧，感谢所有回答问题的人。无论如何，我想我解决了这个谜团。

SELinux 在机器上被完全禁用，所以问题肯定是在 'svn co' 无法找到它运行的用户帐户的 config_dir。

Apache / mod_python 不会在运行 apache 的用户帐户的 shell 环境中读取。因此，例如，当 apache 在某个真实用户（不是任何人）下运行时，mod_python 看不到 $HOME

现在'svn co'有一个标志--config-dir，它指向配置目录来读取参数。默认情况下它是$HOME/.subversion，即它对应于用户帐户的主目录。显然，当不存在 $HOME 时，mod_python 会转到根主目录（ /​​root ）并尝试在那里摆弄 .subversion 内容 - 这显然失败了。

推杆

SetEnv HOME /home/qa

进入 /etc/httpd/conf/httpd.conf 并不能解决问题，因为 SetEnv 与 shell 环境无关 - 它只设置 apache 相关环境

同样 PythonOption - 仅设置 mod_python 相关变量，之后可以使用 req.get_options() 读取

运行 'svn co --config-dir /home/ ...' 肯定会为从 mod_python 中运行提供一种解决方法，但会妨碍那些尝试从命令行运行脚本的人。

所以建议的（和有效的）解决方案是在启动 appache 之前设置 HOME 环境变量。

例如在 /etc/init.d/httpd 脚本中

```
 QAHOME=/home/qa
    ...
    HOME=$QAHOME LANG=$HTTPD_LANG daemon $httpd $OPTIONS 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T15:24:06.890

尝试授予 Apache 用户（运行 apache 服务的用户）对该文件的 r+w 权限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T15:30:10.870

难道 Apache 的错误日志没有给你一个线索吗？

也许它与 SELinux 有关。检查 /var/log/audit/audit.log 并相应地调整您的 SELinux 配置，如果 audit.log 文件表明它是拒绝 Apache 访问的 SELinux。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T10:06:52.683

Permission Denied 错误显示脚本正在使用 root 凭据运行，因为它正在 root 的主目录中查找文件。

我建议您将钩子脚本更改为：

```
id > /tmp/id 
```

这样您就可以检查结果以确保 uid/gid 和 euid/egid 是什么。您可能会发现它实际上并没有像您认为的用户那样运行。

我的第一个猜测，如 Troels，也是 SELinux，但如果您绝对确定通过 Apache 运行的脚本与您的手动测试使用完全相同的用户/组运行，那只是我的猜测。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-23T21:02:18.123

发生的事情是 apache 是使用 root 的环境变量启动的，所以它认为它应该在 /root/ 中找到它的配置文件。不是这种情况。如果您执行 sudo apache2ctl start 会发生什么，它会从 sudo $HOME=/root/ 中提取您的 $HOME 变量

我自己刚刚找到了解决这个问题的方法（虽然使用 mod_perl，但同样的事情）

运行这个命令（如果它的 apache 1，删除 2）：

```
sudo /etc/init.d/apache2 stop
sudo /etc/init.d/apache2 start 
```

当 /etc/init.d/apache2 启动 apache 时，它​​会设置 apache 应该在其下运行的所有正确环境变量。

# asp.net - 如何从代码隐藏访问按钮位置？

> ID：133865
> 
> 赞同：0
> 
> 时间：2008-09-25T15:06:39.350
> 
> 标签：asp.net

我有一个第三方弹出窗口来显示消息。它有两个属性 OffsetX 和 OffsetY。在浏览器中设置其位置。

现在我在按钮单击事件上调用此弹出窗口。我需要这个弹出窗口就在我的按钮旁边，为此我必须设置上面提到的弹出窗口的 OffsetX 和 OffsetY 属性。

我在按钮的点击事件上尝试了以下代码，

Popup.OffsetX = Button.Style.Item("Top") Popup.OffsetY = Button.Style.Item("Left")

但是 Button.Style.Item("Top") 和 Button.Style.Item("Left") 的值总是什么都没有，并且 Popup 总是出现在左下角，因为 value = nothing。

仅供参考，我没有从 CSS 设置顶部和左侧。我只是从工具箱中拖动按钮。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T15:13:44.763

“Top”和“Left”的值，除非在 CSS 中明确定义，否则不会被定义。将控件拖到设计器上不会这样做，因为顶部/左侧位置可能会因浏览器、最终用户屏幕分辨率（元素是否因屏幕宽度而重新定位）和许多其他因素而有所不同。

从它的声音来看，您可能需要使用一些客户端 javascript（如果可能）来触发显示的弹出窗口和/或设置其 Top 和 Left 属性。

# networking - 应该如何为新服务选择默认 TCP/IP 端口？

> ID：133879
> 
> 赞同：122
> 
> 时间：2008-09-25T15:08:26.477
> 
> 标签：networking, tcp

在开发将侦听 TCP/IP 端口的应用程序时，应该如何选择默认端口？假设此应用程序将安装在多台计算机上，并且需要避免端口冲突。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-25T15:10:16.817

去[这里](http://www.iana.org/assignments/port-numbers)选择一个带有描述的端口`Unassigned`

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-25T15:11:22.553

第一步：查看[IANA 列表](http://www.iana.org/assignments/port-numbers)：

你会在列表的尾部看到

“动态和/或专用端口是从 49152 到 65535 的端口”

因此，这些将是您更好的选择，但是一旦您选择了一个，您就可以随时在其上进行谷歌搜索，以查看是否有足够受欢迎的应用程序已经“认领”了它

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-25T15:20:14.357

如果通过广泛使用，您的意思是您希望防止其他人在未来使用它，您可以在[此处申请将其标记为由 IANA 为您的应用程序保留](http://www.iana.org/cgi-bin/usr-port-number.pl)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-25T15:13:46.683

我知道的最全面的官方 IANA 端口号和非官方端口号列表是[nmap-services](http://nmap.org/data/nmap-services)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T15:12:34.687

您可能希望避免使用[此列表](http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)（维基百科）中的任何端口。

我只会选择一个，一旦该应用程序被大众使用，端口号将被识别并包含在此类列表中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T15:25:24.253

从 IANA 列表中选择一个未分配的产品通常就足够了，但如果您谈论的是商业发布的产品，您确实应该向 IANA 申请分配给您的产品。请注意，执行此操作的过程简单但缓慢；上次申请，用了一年。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-25T16:10:19.200

正如其他人提到的，请检查 IANA。

然后检查您的本地系统 /etc/services 以查看是否有一些自定义端口已在使用中。

请不要对其进行硬编码。以某种方式确保它是可配置的——如果没有其他原因，您希望能够让多个开发人员同时使用他们自己的本地化构建。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T15:35:23.353

如果这是针对您希望广泛使用的应用程序，请 [在此处](http://www.iana.org/cgi-bin/usr-port-number.pl "这里")注册一个号码，以免其他人使用它。

否则，只需随机选择一个未使用的。

在动态范围内使用一个的问题是它可能不可用，因为它可能被用于动态端口号。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T15:11:27.657

[好吧，你可以在这里](http://www.iana.org/assignments/port-numbers)参考一些常用的端口号，尽量不要使用别人的。

如果“向广大公众开放”是指您在自己的系统上打开端口，我会与您的系统管理员讨论他们觉得可以使用哪些端口。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T15:13:36.153

选择一个[不太](http://www.governmentsecurity.org/articles/CommonPorts.php) [常见的数字](http://www.iana.org/assignments/port-numbers)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T16:03:56.327

选择一个不会干扰最常见的守护进程和服务器的默认端口。还要确保端口号没有被列为某些病毒的攻击媒介——一些公司有严格的政策，无论如何他们都会阻止这些端口。最后但同样重要的是，确保端口号是可配置的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-04-15T15:08:26.140

使用 iana 列表。从以下位置下载 csv 文件：

[https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.csv](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.csv)

并使用此 shell 脚本搜索未注册的端口：

```
for port in {N..M}; do if ! grep -q $port service-names-port-numbers.csv; then echo $port;fi; done; 
```

并输入 2 个数字而不是 N 和 M。

# comments - Reddit 的评论系统（分层）

> ID：133880
> 
> 赞同：4
> 
> 时间：2008-09-25T15:09:02.560
> 
> 标签：comments, reddit, hierarchical-trees

对于那些看过 Reddit 源代码的人来说，它管理评论层次结构的逻辑到底在哪里？

我下载了代码，但甚至找不到数据库结构，更不用说读写评论的地方了。

如果有人在线程中途回复某人，它是否会更新大量评论？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T03:33:02.833

Comment 模型的类定义在[r2/models/link.py](https://github.com/reddit/reddit/blob/master/r2/r2/models/link.py#L591)中。

# windows - 通过批处理或 cmd 文件停止和启动服务？

> ID：133883
> 
> 赞同：304
> 
> 时间：2008-09-25T15:09:22.607
> 
> 标签：windows, command-line, batch-file, cmd

如何编写 bat 或 cmd 脚本以通过错误检查可靠地停止和启动服务（或让我知道无论出于何种原因它都没有成功）？

* * *

## 回答 #1

> 赞同：357
> 
> 时间：2008-09-25T15:15:44.213

使用`SC`（服务控制）命令，它为您提供了比`start`&更多的选项`stop`。

```
  描述：
          SC 是一个命令行程序，用于与
          NT 服务控制器和服务。
  用法：
      sc <服务器> [命令] [服务名称] ...

      选项 <server> 的格式为“\\ServerName”
      可以通过键入以下命令获得有关命令的更多帮助：“sc [command]”
      命令：
        query-----------查询服务的状态，或者
                        枚举服务类型的状态。
        queryex---------查询服务的扩展状态，或
                        枚举服务类型的状态。
        start-----------启动服务。
        pause-----------向服务发送暂停控制请求。
        interrogate-----向服务发送一个 INTERROGATE 控制请求。
        continue--------向服务发送CONTINUE控制请求。
        stop------------向服务发送 STOP 请求。
        config----------更改服务的配置（持久）。
        description-----更改服务的描述。
        failure---------更改服务在失败时采取的操作。
        qc-------------查询服务的配置信息。
        qdescription----查询服务的描述。
        qfailure--------查询服务失败时的动作。
        delete----------删除服务（从注册表中）。
        create----------创建服务。（将其添加到注册表中）。
        control---------向服务发送控制。
        sdshow----------显示服务的安全描述符。
        sdset-----------设置服务的安全描述符。
        GetDisplayName--获取服务的 DisplayName。
        GetKeyName------获取服务的 ServiceKeyName。
        EnumDepend------枚举服务依赖。

      以下命令不需要服务名称：
      sc <服务器> <命令> <选项>
        boot------------(ok | bad) 表示最后一次启动是否应该
                        保存为最后一次正确的引导配置
        Lock------------锁定服务数据库
        QueryLock-------查询SCManager数据库的LockStatus
  例子：
          sc 启动我的服务

```

* * *

## 回答 #2

> 赞同：220
> 
> 时间：2008-09-25T15:13:54.980

```
net start [serviceName] 
```

和

```
net stop [serviceName] 
```

很清楚地告诉你他们是成功还是失败。例如

```
U:\>net stop alerter
The Alerter service is not started.

More help is available by typing NET HELPMSG 3521. 
```

如果从批处理文件运行，您可以访问返回代码的 ERRORLEVEL。0 表示成功。任何更高的值都表示失败。

作为 bat 文件，`error.bat`：

```
@echo off
net stop alerter
if ERRORLEVEL 1 goto error
exit
:error
echo There was a problem
pause 
```

输出如下所示：

```
U:\>error.bat
The Alerter service is not started.

More help is available by typing NET HELPMSG 3521.

There was a problem
Press any key to continue . . . 
```

**返回代码**

```
 - 0 = Success
 - 1 = Not Supported
 - 2 = Access Denied
 - 3 = Dependent Services Running
 - 4 = Invalid Service Control
 - 5 = Service Cannot Accept Control
 - 6 = Service Not Active
 - 7 = Service Request Timeout
 - 8 = Unknown Failure
 - 9 = Path Not Found
 - 10 = Service Already Running
 - 11 = Service Database Locked
 - 12 = Service Dependency Deleted
 - 13 = Service Dependency Failure
 - 14 = Service Disabled
 - 15 = Service Logon Failure
 - 16 = Service Marked For Deletion
 - 17 = Service No Thread
 - 18 = Status Circular Dependency
 - 19 = Status Duplicate Name
 - 20 = Status Invalid Name
 - 21 = Status Invalid Parameter 
 - 22 = Status Invalid Service Account
 - 23 = Status Service Exists
 - 24 = Service Already Paused 
```

**编辑 20.04.2015**

返回代码：

> NET 命令不返回记录在案的 Win32_Service 类返回代码（服务未激活、服务请求超时等），并且对于许多错误只会返回错误级别 2。

看这里：[http ://ss64.com/nt/net_service.html](http://ss64.com/nt/net_service.html)

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-09-25T15:15:06.587

您可以使用 NET START 命令，然后检查 ERRORLEVEL 环境变量，例如

```
net start [your service]
if %errorlevel% == 2 echo Could not start service.
if %errorlevel% == 0 echo Service started successfully.
echo Errorlevel: %errorlevel% 
```

免责声明：我是从头顶写的，但我认为它会起作用。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-12-07T16:45:59.093

而不是检查代码，这也有效

```
net start "Apache tomcat" || goto ExitError

:End  
exit 0  

:ExitError  
echo An error has occurred while starting the tomcat services  
exit 1 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-06-13T01:31:31.333

我为此创建了我的个人批处理文件，我的有点不同，但可以随意修改。不久前我创建了这个，因为我很无聊，想为人们提供一种简单的方法来输入结束、开始、停止或设置为自动。此 BAT 文件仅要求您输入服务名称，其余的工作将由您完成。我没有意识到他正在寻找说明任何错误的东西，我一定是误读了那部分。虽然通常这可以通过在行尾输入 >> output.txt 来完成。

%var% 只是用户能够将自己的服务输入其中的一种方式，而不必每次要启动/停止不同的服务时都去修改 bat 文件。

如果我错了，任何人都可以随时纠正我。

```
@echo off
set /p c= Would you like to start a service [Y/N]?
  if /I "%c%" EQU "Y" goto :1
  if /I "%c%" EQU "N" goto :2
    :1  
    set /p var= Service name: 
:2 
set /p c= Would you like to stop a service [Y/N]?
  if /I "%c%" EQU "Y" goto :3
  if /I "%c%" EQU "N" goto :4
    :3  
    set /p var1= Service name:
:4
set /p c= Would you like to disable a service [Y/N]?
  if /I "%c%" EQU "Y" goto :5
  if /I "%c%" EQU "N" goto :6
    :5  
    set /p var2= Service name:
:6 
set /p c= Would you like to set a service to auto [Y/N]?
  if /I "%c%" EQU "Y" goto :7
  if /I "%c%" EQU "N" goto :10
    :7  
    set /p var3= Service name:
:10
sc start %var%
sc stop %var1%
sc config %var2% start=disabled
sc config %var3% start=auto 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-25T15:12:32.893

`net start`对我来说，使用and的返回码`net stop`似乎是最好的方法。试试看：[Net Start return codes](http://www.eggheadcafe.com/software/aspnet/31708197/net-start-return-codes.aspx)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-01-28T20:52:52.547

语法总是让我......所以......

如果您是两台机器上的管理员，以管理员身份运行 .bat 并且机器位于同一域中，那么这里明确地如何向批处理文件添加一行，该行将终止远程服务（在另一台机器上）。机器名称遵循 UNC 格式 \myserver

```
sc \\ip.ip.ip.ip stop p4_1 
```

在这种情况下... p4_1 既是服务名称又是显示名称，当您在服务管理器中查看服务的属性时。您必须使用服务名称。

对于您的 Service Ops 迷……请务必附加您的原因代码和评论！即“4”等于“已计划”并注释“停止服务器进行维护”

```
sc \\ip.ip.ip.ip stop p4_1 4 Stopping server for maintenance 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-02-10T17:04:40.100

我们想认为“net stop”会停止服务。可悲的是，现实并非非黑即白。如果服务需要很长时间才能停止，该命令将在服务停止之前返回。但是，除非您检查错误级别，否则您不会知道。

解决方案似乎是循环查找服务的状态，直到它停止，每次循环都暂停。

但话又说回来...

我看到第一个服务需要很长时间才能停止，然后后续服务的“网络停止”似乎什么都不做。查看服务管理器中的服务，它的状态仍然是“已启动”——没有更改为“正在停止”。然而，我可以使用 SCM 手动停止第二个服务，它会在 3 或 4 秒内停止。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-01-27T08:56:01.157

或者您可以使用此 cmd 启动远程服务：`sc \\<computer> start <service>`

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-02-12T16:33:38.250

我刚刚使用了上面 Jonas 的示例并创建了 0 到 24 个错误级别的完整列表。其他帖子是正确的，`net start`仅`net stop`使用`errorlevel`0 表示成功，2 表示失败。

但这对我有用：

```
net stop postgresql-9.1
if %errorlevel% == 2 echo Access Denied - Could not stop service
if %errorlevel% == 0 echo Service stopped successfully
echo Errorlevel: %errorlevel% 
```

更改`stop`为`start`并反向工作。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2016-05-24T08:55:22.827

手动重启服务没问题 - services.msc 有“重启”按钮，但在命令行中，sc 和 net 命令都缺少“重启”开关，如果在 cmd/bat 文件中安排重启，服务会立即停止并启动，有时会收到错误，因为服务尚未停止，需要一些时间才能关闭。

这可能会产生错误：sc stop sc start

插入超时是个好主意，我使用 ping（它每 1 秒 ping 一次）： sc stop ping localhost -n 60 sc start

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-11-26T19:53:57.160

这是使用批处理启动系统还原的 Windows 10 命令：

```
sc config swprv start= Auto 
```

您可能还喜欢这些命令：

*   更改注册表值以自动启动系统还原

    REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v DisableSR /t REG_DWORD /d 0 /f

*   创建系统还原点

    Wmic.exe /Namespace:\root\default Path SystemRestore Call CreateRestorePoint "djibe saved your PC", 100, 12

*   更改系统还原磁盘使用情况

    vssadmin 调整shadowstorage /for=C: /on=C: /maxsize=10%

享受

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-25T15:26:10.147

`SC`可以用服务做任何事情...启动、停止、检查、配置等等...

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-05-09T09:52:13.263

有时你会发现停止不起作用..

我的 SQlServer 有时会这样做。使用以下命令行会杀死它。如果你真的需要你的脚本来杀死那些不会停止的东西。我会把它作为最后的手段

```
taskkill /pid [pid number] /f 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-11-05T16:15:18.260

1.  [**SC**](https://ss64.com/nt/sc.html)
2.  [**网络停止/开始**](https://ss64.com/nt/net-service.html)
3.  [**服务**](https://docs.microsoft.com/en-us/sysinternals/downloads/psservice)
4.  [**WMIC**](https://docs.microsoft.com/en-gb/windows/win32/wmisdk/wmic)
5.  Powershell 也是[易于](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-service?view=powershell-7)使用[的](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/stop-service?view=powershell-7)选项

SC 和 NET 已经作为 anwests 给出。PsService 添加了一些简洁的功能，但需要从 Microsoft 下载。

但我最喜欢的方式是使用 WMIC，因为 WQL 语法提供了一种强大的方式来管理多个服务（也可以通过 powershell/vbscript/jscript/c# 使用 WMI 对象）。

最简单的使用方法：

```
wmic service MyService call StartService
wmic service MyService  call StopService 
```

并以 WQL 为例

```
wmic service where "name like '%%32Time%%' and ErrorControl='Normal'" call StartService 
```

这将启动所有名称包含`32Time`并具有正常错误控制的服务。

[以下](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-service)是您可以使用的方法。

和 ：

```
wmic service get /FORMAT:VALUE 
```

您可以查看有关服务的可用信息。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-10-05T18:53:13.073

我正在用 C# 编写 Windows 服务，停止/卸载/构建/安装/启动循环太累了。编写了一个迷你脚本，调用它`reploy.bat`并放入我的 Visual Studio 输出目录（具有构建的服务可执行文件的目录）以自动执行循环。

只需设置这 3 个变量

`servicename`：这显示在 Windows 服务控制面板 (services.msc)

`slndir`: 包含您的解决方案 (.sln) 文件的文件夹（不是完整路径）

`binpath`：从构建到服务可执行文件的完整路径（不是文件夹路径）

注意：这需要从 Visual Studio 开发人员命令行运行`msbuild`命令才能工作。

```
SET servicename="My Amazing Service"
SET slndir="C:dir\that\contains\sln\file"
SET binpath="C:path\to\service.exe"
SET currdir=%cd%

call net stop %servicename%
call sc delete %servicename%
cd %slndir%
call msbuild 
cd %bindir%
call sc create %servicename% binpath=%binpath%
call net start %servicename%
cd %currdir% 
```

也许这对某人有帮助:)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-11-25T02:59:04.703

我没有找到上述任何答案来提供令人满意的解决方案，因此我编写了以下批处理脚本...

```
:loop
net stop tomcat8 
sc query tomcat8 | find "STOPPED"
if errorlevel 1 (
  timeout 1
  goto loop
)
:loop2
net start tomcat8
sc query tomcat8 | find "RUNNING"
if errorlevel 1 (
  timeout 1
  goto loop2
) 
```

它会一直运行**net stop**直到服务状态为 STOPPED，只有在状态停止后才会运行**net start**。如果服务需要很长时间才能停止，**net stop**可能会失败终止。如果由于某种原因服务没有成功启动，它将继续尝试启动服务，直到状态为 RUNNING。

# python - 在 Python 中高效匹配多个正则表达式

> ID：133886
> 
> 赞同：16
> 
> 时间：2008-09-25T15:10:05.740
> 
> 标签：python, regex, lexical-analysis

当你有正则表达式时，词法分析器很容易编写。今天我想用 Python 写一个简单的通用分析器，并想出了：

```
import re
import sys

class Token(object):
    """ A simple Token structure.
        Contains the token type, value and position. 
    """
    def __init__(self, type, val, pos):
        self.type = type
        self.val = val
        self.pos = pos

    def __str__(self):
        return '%s(%s) at %s' % (self.type, self.val, self.pos)

class LexerError(Exception):
    """ Lexer error exception.

        pos:
            Position in the input line where the error occurred.
    """
    def __init__(self, pos):
        self.pos = pos

class Lexer(object):
    """ A simple regex-based lexer/tokenizer.

        See below for an example of usage.
    """
    def __init__(self, rules, skip_whitespace=True):
        """ Create a lexer.

            rules:
                A list of rules. Each rule is a `regex, type`
                pair, where `regex` is the regular expression used
                to recognize the token and `type` is the type
                of the token to return when it's recognized.

            skip_whitespace:
                If True, whitespace (\s+) will be skipped and not
                reported by the lexer. Otherwise, you have to 
                specify your rules for whitespace, or it will be
                flagged as an error.
        """
        self.rules = []

        for regex, type in rules:
            self.rules.append((re.compile(regex), type))

        self.skip_whitespace = skip_whitespace
        self.re_ws_skip = re.compile('\S')

    def input(self, buf):
        """ Initialize the lexer with a buffer as input.
        """
        self.buf = buf
        self.pos = 0

    def token(self):
        """ Return the next token (a Token object) found in the 
            input buffer. None is returned if the end of the 
            buffer was reached. 
            In case of a lexing error (the current chunk of the
            buffer matches no rule), a LexerError is raised with
            the position of the error.
        """
        if self.pos >= len(self.buf):
            return None
        else:
            if self.skip_whitespace:
                m = self.re_ws_skip.search(self.buf[self.pos:])

                if m:
                    self.pos += m.start()
                else:
                    return None

            for token_regex, token_type in self.rules:
                m = token_regex.match(self.buf[self.pos:])

                if m:
                    value = self.buf[self.pos + m.start():self.pos + m.end()]
                    tok = Token(token_type, value, self.pos)
                    self.pos += m.end()
                    return tok

            # if we're here, no rule matched
            raise LexerError(self.pos)

    def tokens(self):
        """ Returns an iterator to the tokens found in the buffer.
        """
        while 1:
            tok = self.token()
            if tok is None: break
            yield tok

if __name__ == '__main__':
    rules = [
        ('\d+',             'NUMBER'),
        ('[a-zA-Z_]\w+',    'IDENTIFIER'),
        ('\+',              'PLUS'),
        ('\-',              'MINUS'),
        ('\*',              'MULTIPLY'),
        ('\/',              'DIVIDE'),
        ('\(',              'LP'),
        ('\)',              'RP'),
        ('=',               'EQUALS'),
    ]

    lx = Lexer(rules, skip_whitespace=True)
    lx.input('erw = _abc + 12*(R4-623902)  ')

    try:
        for tok in lx.tokens():
            print tok
    except LexerError, err:
        print 'LexerError at position', err.pos 
```

它工作得很好，但我有点担心它效率太低。是否有任何正则表达式技巧可以让我以更有效/优雅的方式编写它？

具体来说，有没有办法避免线性循环所有正则表达式规则以找到适合的规则？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-11-09T16:59:03.160

我建议使用 re.Scanner 类，它没有记录在标准库中，但它非常值得使用。这是一个例子：

```
import re

scanner = re.Scanner([
    (r"-?[0-9]+\.[0-9]+([eE]-?[0-9]+)?", lambda scanner, token: float(token)),
    (r"-?[0-9]+", lambda scanner, token: int(token)),
    (r" +", lambda scanner, token: None),
])

>>> scanner.scan("0 -1 4.5 7.8e3")[0]
[0, -1, 4.5, 7800.0] 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-25T15:54:53.540

您可以使用“|”将所有正则表达式合并为一个 运算符，并让正则表达式库完成识别标记的工作。应注意确保令牌的偏好（例如，避免将关键字匹配为标识符）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-02-17T08:51:33.957

我在 python 文档中找到[了这个。](http://docs.python.org/3/library/re.html#writing-a-tokenizer)它只是简单而优雅。

```
import collections
import re

Token = collections.namedtuple('Token', ['typ', 'value', 'line', 'column'])

def tokenize(s):
    keywords = {'IF', 'THEN', 'ENDIF', 'FOR', 'NEXT', 'GOSUB', 'RETURN'}
    token_specification = [
        ('NUMBER',  r'\d+(\.\d*)?'), # Integer or decimal number
        ('ASSIGN',  r':='),          # Assignment operator
        ('END',     r';'),           # Statement terminator
        ('ID',      r'[A-Za-z]+'),   # Identifiers
        ('OP',      r'[+*\/\-]'),    # Arithmetic operators
        ('NEWLINE', r'\n'),          # Line endings
        ('SKIP',    r'[ \t]'),       # Skip over spaces and tabs
    ]
    tok_regex = '|'.join('(?P<%s>%s)' % pair for pair in token_specification)
    get_token = re.compile(tok_regex).match
    line = 1
    pos = line_start = 0
    mo = get_token(s)
    while mo is not None:
        typ = mo.lastgroup
        if typ == 'NEWLINE':
            line_start = pos
            line += 1
        elif typ != 'SKIP':
            val = mo.group(typ)
            if typ == 'ID' and val in keywords:
                typ = val
            yield Token(typ, val, line, mo.start()-line_start)
        pos = mo.end()
        mo = get_token(s, pos)
    if pos != len(s):
        raise RuntimeError('Unexpected character %r on line %d' %(s[pos], line))

statements = '''
    IF quantity THEN
        total := total + price * quantity;
        tax := price * 0.05;
    ENDIF;
'''

for token in tokenize(statements):
    print(token) 
```

这里的诀窍是这条线：

```
tok_regex = '|'.join('(?P<%s>%s)' % pair for pair in token_specification) 
```

此处`(?P<ID>PATTERN)`将使用 指定的名称标记匹配的结果`ID`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T15:38:49.430

`re.match`被锚定。你可以给它一个位置参数：

```
pos = 0
end = len(text)
while pos < end:
    match = regexp.match(text, pos)
    # do something with your match
    pos = match.end() 
```

看看 pygments，它提供了大量的词法分析器，用于具有不同实现的语法高亮目的，大多数基于正则表达式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-25T19:24:13.210

组合标记正则表达式可能会起作用，但您必须对其进行基准测试。就像是：

```
x = re.compile('(?P<NUMBER>[0-9]+)|(?P<VAR>[a-z]+)')
a = x.match('9999').groupdict() # => {'VAR': None, 'NUMBER': '9999'}
if a:
    token = [a for a in a.items() if a[1] != None][0] 
```

过滤器是您必须进行一些基准测试的地方...

**更新：**我对此进行了测试，似乎您按照所述组合所有标记并编写如下函数：

```
def find_token(lst):
    for tok in lst:
        if tok[1] != None: return tok
    raise Exception 
```

为此，您将获得大致相同的速度（也许快一点）。我相信加速必须在匹配的调用次数中，但是令牌识别的循环仍然存在，这当然会杀死它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T15:40:47.287

这不完全是您问题的直接答案，但您可能想查看[ANTLR](http://www.antlr.org)。根据[此](http://www.antlr.org/wiki/display/ANTLR3/Code+Generation+Targets)文档，python 代码生成目标应该是最新的。

至于您的正则表达式，如果您坚持使用正则表达式，实际上有两种方法可以加快速度。第一个是按照在默认文本中找到正则表达式的概率顺序对正则表达式进行排序。您可以在代码中添加一个简单的分析器，为每种标记类型收集标记计数并在工作主体上运行词法分析器。另一种解决方案是对您的正则表达式进行桶排序（因为您的键空间，作为一个字符，相对较小），然后在对第一个字符执行单个区分后使用数组或字典来执行所需的正则表达式。

但是，我认为如果你打算走这条路，你真的应该尝试像[ANTLR](http://www.antlr.org)这样的东西，它更容易维护、更快，而且不太可能出现错误。

# vb.net - 在 VB ASP.NET 中使用泛型创建多维哈希表？

> ID：133887
> 
> 赞同：1
> 
> 时间：2008-09-25T15:10:14.740
> 
> 标签：vb.net, generics, asp.net-2.0

我需要创建一个多维（嵌套）哈希表/字典，以便我可以使用类似的语法

```
val = myHash("Key").("key") 
```

我知道我需要使用泛型，但我无法在 ASP.NET 2.0 中使用 VB 找出正确的语法，网上有很多 c# 示例，但它们并没有多大帮助。

干杯!

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T15:13:35.730

好的，我在 C# 方面比 vb.net 更好，但我会试一试......

```
Dim myHash as Dictionary(Of string, Dictionary(Of string, Integer)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T20:12:52.060

还有 System.Collections.Specialized.StringDictionary(Of T) 集合，它只是一个预定义的 Dictionary(Of String, T)。

使用普通 Dictionary 或 StringDictionary 的语法如下所示：

```
val = myHash("key")("key") 
```

不像这样：

```
val = myHash("key").("key") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T20:18:25.713

考虑到您可能只需要使用 Dictionary，它可以将您的多个键组合成具有自己的复合哈希码的单个键对象。例如，制作一个多键类，然后将其用作键。

在伪代码中：

```
class Multikey {
 private keys;
 public setKey1(...)
 public setKey2(...)
}
Dim myKey as MultiKey(...)
myKey.key1 = ...
myKey.key2 = ...

Dim mydic as Dictionary(Of MultiKey, Integer)

val = mydic(myKey) 
```

# algorithm - 你如何在给定的垂直距离上找到一个点？

> ID：133897
> 
> 赞同：52
> 
> 时间：2008-09-25T15:12:19.807
> 
> 标签：algorithm, math, graphics, geometry, coordinates

我在窗口中画了一条线，让用户拖动它。所以，我的线由两点定义：(x1,y1) 和 (x2,y2)。但现在我想在我的线的末端画“帽子”，即在我的每个端点处画短垂直线。大写字母的长度应为 N 个像素。

因此，要在端点 (x1,y1) 处绘制我的“帽”线，我需要找到两个点，它们形成一条垂直线，并且每个点距点 (x1,y1) 的距离为 N/2 像素。

那么如何计算一个点 (x3,y3)，因为它需要与已知线的终点 (x1,y1) 相距 N/2 的垂直距离，即由 (x1,y1) 定义的线和(x2,y2)？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-09-25T15:22:17.083

您需要计算一个垂直于线段的单位向量。避免计算斜率，因为这可能导致除以零错误。

```
dx = x1-x2
dy = y1-y2
dist = sqrt(dx*dx + dy*dy)
dx /= dist
dy /= dist
x3 = x1 + (N/2)*dy
y3 = y1 - (N/2)*dx
x4 = x1 - (N/2)*dy
y4 = y1 + (N/2)*dx 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-25T15:25:03.597

您只需评估正交倒数并乘以 N/2

```
vx = x2-x1
vy = y2-y1
len = sqrt( vx*vx + vy*vy )
ux = -vy/len
uy = vx/len

x3 = x1 + N/2 * ux
Y3 = y1 + N/2 * uy

x4 = x1 - N/2 * ux
Y4 = y1 - N/2 * uy 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-26T01:25:22.267

由于 2 到 1 和 1 到 3 的向量是垂直的，所以它们的点积为 0。

这给您留下了两个未知数：x 从 1 到 3 (x13)，y 从 1 到 3 (y13)

使用勾股定理来获得这些未知数的另一个方程。

通过替换解决每个未知数...

这需要平方和不平方，因此您会丢失与方程式相关的符号。

要确定符号，请考虑：

```
while x21 is negative, y13 will be positive
while x21 is positive, y13 will be negative
while y21 is positive, x13 will be positive
while y21 is negative, x13 will be negative 
```

已知：点 1 : x1 , y1

已知：点 2 : x2 , y2

```
x21 = x1 - x2
y21 = y1 - y2 
```

已知：距离 |1->3| : N/2

方程a：勾股定理

```
x13^2 + y13^2 = |1->3|^2
x13^2 + y13^2 = (N/2)^2 
```

已知：角度 2-1-3 ：直角

向量 2->1 和 1->3 是垂直的

2->1 点 1->3 为 0

等式 b：点积 = 0

```
x21*x13 + y21*y13 = 2->1 dot 1->3
x21*x13 + y21*y13 = 0 
```

黑白 x13 和 y13 的比率：

```
x21*x13 = -y21*y13
x13 = -(y21/x21)y13

x13 = -phi*y13 
```

方程 a：用比率求解 y13

```
 plug x13 into a
phi^2*y13^2 + y13^2 = |1->3|^2

  factor out y13
y13^2 * (phi^2 + 1) = 

  plug in phi
y13^2 * (y21^2/x21^2 + 1) = 

  multiply both sides by x21^2
y13^2 * (y21^2 + x21^2) = |1->3|^2 * x21^2

  plug in Pythagorean theorem of 2->1
y13^2 * |2->1|^2 = |1->3|^2 * x21^2

  take square root of both sides
y13 * |2->1| = |1->3| * x21

  divide both sides by the length of 1->2
y13 = (|1->3|/|2->1|) *x21

  lets call the ratio of 1->3 to 2->1 lengths psi
y13 = psi * x21

  check the signs
    when x21 is negative, y13 will be positive
    when x21 is positive, y13 will be negative

y13 = -psi * x21 
```

方程 a：用比率求解 x13

```
 plug y13 into a
x13^2 + x13^2/phi^2 = |1->3|^2

  factor out x13
x13^2 * (1 + 1/phi^2) = 

  plug in phi
x13^2 * (1 + x21^2/y21^2) = 

  multiply both sides by y21^2
x13^2 * (y21^2 + x21^2) = |1->3|^2 * y21^2

  plug in Pythagorean theorem of 2->1
x13^2 * |2->1|^2 = |1->3|^2 * y21^2

  take square root of both sides
x13 * |2->1| = |1->3| * y21

  divide both sides by the length of 2->1
x13 = (|1->3|/|2->1|) *y21

  lets call the ratio of |1->3| to |2->1| psi
x13 = psi * y21

  check the signs
    when y21 is negative, x13 will be negative
    when y21 is positive, x13 will be negative

x13 = psi * y21 
```

凝聚

```
x21 = x1 - x2
y21 = y1 - y2

|2->1| = sqrt( x21^2 + y^21^2 )
|1->3| = N/2

psi = |1->3|/|2->1|

y13 = -psi * x21
x13 =  psi * y21 
```

我通常不会这样做，但我在工作中解决了它，并认为彻底解释它会帮助我巩固我的知识。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T15:39:52.110

如果要避免 sqrt，请执行以下操作：

```
in: line_length, cap_length, rotation, position of line centre

define points:
  tl (-line_length/2, cap_length)
  tr (line_length/2, cap_length)
  bl (-line_length/2, -cap_length)
  br (line_length/2, -cap_length)

rotate the four points by 'rotation'
offset four points by 'position'

drawline (midpoint tl,bl to midpoint tr,br)
drawline (tl to bl)
drawline (tr to br) 
```

# c++ - C/C++ 条形图

> ID：133899
> 
> 赞同：2
> 
> 时间：2008-09-25T15:12:28.370
> 
> 标签：c++, winapi, charts, graph

只是一个快速的问题。

我正在寻找一个类似于 Windows 任务管理器“性能”视图的简单条形图（又名图形）控件。并找到了一些，但它们都依赖于 MFC 或 .NET :(

我希望这里的某人可能拥有或知道在哪里可以获得不是 MFC 的简单条形图 Win32 控件。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T17:04:45.620

如果您必须走自己的路线，请查看折线 GDI 调用。这可以在一个电话中为您画出整条线。

我在一个使用自定义代码绘制图表的系统上工作（没有第 3 方控件，所有 win32 GDI）。听起来真的很难，但也没那么糟糕。

将坐标空间中的点映射到设备上下文、绘制网格线/背景和 Ployline 的一些数学运算。完毕！;)

哎呀，您可以使用 GDI 映射模式来简化数学运算（但我不会）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T15:25:29.540

如果您找到了一个好的 MFC 控件，也许您最好的方法是自己将代码转换为纯 Win32 - 毕竟 MFC 是 Win32 API 的薄包装器。出于兴趣，您找到的 MFC 控件的名称是什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-08T21:58:26.763

几个月前我也遇到过同样的问题：试图找到一个性能监控库的现有实现，它看起来类似于 Windows 任务管理器。但是因为我找不到任何在多平台上工作的现有库（不依赖于 MFC 或 .NET），所以我决定创建自己的库:-)

今天我刚刚发布了这个库的 beta 版本，并将它作为一个开源项目提供。在这里查看：[http ://code.google.com/p/qw-performance-monitoring/](http://code.google.com/p/qw-performance-monitoring/)

让我知道这是否有用。我还在做一些测试，以确保这个库中的每个功能都可以在 Mac、Linux 和 Windows 上运行。完成测试后，我将发布稳定版本。目前，请享受使用此测试版 :-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T15:38:14.563

我认为 Win32 通用控件库中没有标准的。您要么必须使用其他人的小部件库，要么使用 GDI 滚动您自己的小部件库来绘制图形。自己滚动可能并不难 - 只需创建一个位图控件，并在每次数据更新为您在内存中绘制的图形时设置图像。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-04T11:00:39.880

看看这个惊人的开源库： http: [//mctrl.sourceforge.net](http://mctrl.sourceforge.net)

# .net - 您知道任何用于创建距离矩阵/路由图的 .NET 组件吗？

> ID：133916
> 
> 赞同：0
> 
> 时间：2008-09-25T15:14:59.503
> 
> 标签：.net, components, graph-theory

基于经典 GIS 格式的地理数据。这些矩阵是不同车辆路线问题等的基本输入。它们通常可以在最佳时间或最短距离的基础上产生。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T16:07:50.593

[快速图](http://www.codeplex.com/quickgraph)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-06T05:39:21.680

[ThinkGeo](http://thinkgeo.com/)有一个路由扩展，您可以使用它来构建矩阵。这确实涉及一些额外的工作。

# legacy-code - 如何最好地集成多个系统？

> ID：133919
> 
> 赞同：9
> 
> 时间：2008-09-25T15:15:19.800
> 
> 标签：legacy-code, system-integration

好吧，在我工作的地方，我们维护了过去几十年编写的相当多的系统。

这些系统多种多样，包括多种操作系统（Linux、Solaris、Windows）、多种数据库（Oracle、sybase 和 mysql 的多个版本），甚至多种语言（C、C++、JSP、PHP 和许多其他语言）用过的。

每个系统都是相当自主的，即使是以将相同的数据输入多个系统为代价。

管理层最近决定，我们应该调查如何让所有系统愉快地相互交谈和共享数据。

请记住，虽然我们可以对任何单个系统进行软件更改，但对任何一个（或更多）系统进行完全重写并不是管理层可能会接受的事情。

这里几个开发人员的第一个想法是直截了当的：如果系统 A 需要来自系统 B 的数据，它应该连接到系统 B 的数据库并获取它。同样，如果它需要给 B 数据，它应该只是将它插入到 B 的数据库中。

由于使用的数据库（和版本）混乱，其他开发人员认为我们应该拥有一个新数据库，将来自所有其他系统的表结合起来，以避免不得不处理多个连接。通过这样做，他们希望我们能够合并一些表并摆脱冗余数据输入。

这大约是我被请来对整个混乱发表意见的时候了。

使用数据库作为系统通信手段的整个想法对我来说很有趣。业务逻辑必须放置在多个系统中（如果系统 A 想向系统 B 添加数据，则在插入之前更好地理解 B 的有关数据的规则），几个系统很可能必须进行某种形式的数据库轮询才能找到对其数据的任何更改，持续维护将是一件令人头疼的事情，因为对数据库模式的任何更改现在都会传播多个系统。

我的第一个想法是花时间为不同的系统编写 API/服务，一旦编写，就可以轻松地来回传递/检索数据。许多其他开发人员认为这比仅仅使用数据库要多得多，而且工作量要大得多。

那么让这些系统相互通信的最佳方式是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T15:39:56.447

集成不同的系统是我的日常工作。

如果我是你，我会努力避免直接从系统 B 中访问系统 A 的数据。从系统 B **更新**系统 A 的数据库是非常不明智的。使您的业务逻辑如此分散与良好做法完全相反。你最终会后悔的。

中央数据库的想法不一定是坏事……但所涉及的工作量可能在从头开始重写系统的数量级之内。这当然不是我会尝试的，至少以你描述的形式。它可以成功，但它比点对点集成方法要困难得多，而且需要更多的纪律。听到它与将数据直接推入其他系统的“牛仔”方法相提并论，这很有趣。

总的来说，你的直觉看起来不错。有几种方法。您提到一个：实施服务。这不是一个糟糕的方法，特别是如果您需要实时更新。另一个是一个单独的集成应用程序，负责对数据进行洗牌。这是我通常采用的方法，但通常是因为我无法更改我正在集成的系统来请求它需要的数据；我必须将数据推入。在您的情况下，服务方法还不错。

对于第一次接触系统集成的人来说，我想说的一件事可能并不明显，那就是系统中的每条数据都应该有一个单一的、权威的事实点。如果数据是重复的（并且是重复的），并且副本彼此不一致，则必须认为该数据的真实副本是正确的。没有其他方法可以在复杂性以指数速度飙升的情况下集成系统。意大利面条集成就像意大利面条代码，应该不惜一切代价避免它。

祝你好运。

编辑：

中间件解决了传输问题，但这不是集成的核心问题。如果系统之间的距离足够近，以至于一个应用程序可以将数据直接推送到另一个应用程序，那么它们可能足够接近，以至于一个应用程序提供的服务可以被另一个应用程序直接调用。在您的情况下，我不会推荐中间件。您可能会从中获得一些好处，但这会被增加的复杂性所抵消。你需要一次解决一个问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T15:24:27.250

听起来您可能想研究[消息队列](http://en.wikipedia.org/wiki/Message_queue)和[面向消息的中间件](http://en.wikipedia.org/wiki/Message-oriented_middleware)。

[MSMQ](http://en.wikipedia.org/wiki/Microsoft_Message_Queuing)和[Java 消息服务](http://en.wikipedia.org/wiki/Java_Message_Service)就是例子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T15:22:45.553

看来你正在寻找意见，所以我会提供我的。

我同意其他开发人员的观点，即为所有不同的系统编写 API 是多余的。如果您只是采用创建单个数据库的其他建议，您可能会更快地完成它并且对它有更多的控制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-03T13:31:25.483

通过推送/戳数据库直接连接将一个系统的许多内部细节暴露给另一个系统。有明显的缺点：升级一个系统可能会破坏另一个系统。此外，一个系统如何访问另一个系统的数据库可能存在技术限制（考虑在 Unix 上用 C 语言编写的应用程序如何与在 Windows 2003 Server 上运行的 SQL Server 2005 数据库交互）。

您必须决定的第一件事是“主数据库”将驻留的平台，对于提供急需粘合剂的中间件也是如此。我建议您考虑使用面向消息的中间件，而不是采用 API 级别的中间件集成（例如 CORBA）。MS Biztalk、Sun 的 eGate 和 Oracle 的 Fusion 可以是其中的一些选项。

您对新数据库的想法是朝着正确方向迈出的一步。您可能想阅读一些关于[企业实体聚合](http://msdn.microsoft.com/en-us/library/ms954596.aspx)模式的内容。

将“数据集成”与中间件相结合是可行的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-03T13:45:28.093

您将面临的挑战之一是对齐每个不同系统中的数据，以便首先将其集成。可能您要集成的每个系统都包含完全不同的数据集，但更有可能是重叠的数据。在深入编写 API:s 之前（根据您的描述，我也会采取这种方式），我建议您尝试为需要集成的数据提出一个逻辑数据模型。然后，此数据模型将帮助您利用您在不同系统中拥有的数据，并使其对其他数据库更有用。

我还强烈推荐一种迭代的集成方法。遗留系统存在如此多的不确定性，以至于试图一次性设计和实施它的风险太大。从小处着手，逐步实现合理集成的系统。“完全集成”几乎不值得追求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T17:59:01.653

如果您打算采用中间件 + 单一中央数据库策略，您可能需要考虑分多个阶段实现这一目标。这是一个可以考虑的逻辑逐步过程：

1.  为不同系统实现服务/API，公开每个系统的功能
2.  中间件的实现，它访问这些 API 并为所有系统提供一个接口以访问来自其他系统的数据/服务（如果可用，则从中央源访问数据，否则从另一个系统获取）
3.  仅实施中央数据库，无数据
4.  在中间件级别实现缓存/数据存储服务，每当从任何系统访问数据时，可以在中央数据库中存储/缓存数据，例如，如果系统 A 的记录 1-5 由系统 B 通过中间件、中间件获取数据缓存服务可以将这些记录存储在中央数据库中，下次这些记录将从中央数据库中获取
5.  数据清理可以并行发生
6.  您还可以创建导入机制，每天将数据从多个系统推送到中央数据库（自动或手动）

这样，工作量分布在多个里程碑上，数据以先访问先存储的方式逐渐存储在中央数据库中。

# vba - 针对 MS Access 2003 执行动态 SQL 查询

> ID：133922
> 
> 赞同：3
> 
> 时间：2008-09-25T15:15:34.557
> 
> 标签：vba, ms-access

这是一个*超级基本*的问题，但我正在尝试通过一些表单值针对表单所在的 MS Access 数据库执行一个查询。我认为我不需要正式通过 ADO，但也许我做。

无论如何，我们将不胜感激。对不起，我是一个 n00b。;)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T16:24:12.737

您可以使用以下 DAO 代码查询 Access DB：

```
Dim rs As DAO.Recordset
Dim db As Database

Set db = CurrentDb
Set rs = db.OpenRecordset("SELECT * FROM Attendance WHERE ClassID = " & ClassID)

do while not rs.EOF
  'do stuff
  rs.movenext
loop

rs.Close
Set rs = Nothing 
```

在我的例子中，ClassID 是表单上的一个文本框。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T01:21:23.357

这里以防万一您想要 ADO 版本：

```
Dim cn as new ADODB.Connection, rs as new ADODB.RecordSet
Dim sql as String

set cn = CurrentProject.Connection
sql = "my dynamic sql string"

rs.Open sql, cn ', Other options for the type of recordset to open, adoOpenStatic, etc.

While Not rs.EOF
  'do things with recordset
  rs.MoveNext   ' Can't tell you how many times I have forgotten the MoveNext. silly.
Wend
rs.Close
cn.Close
Set rs = Nothing
Set cn = Nothing 
```

DAO 和 ADO 在用法上非常接近。您可以使用 DAO 获得更多控制权，使用 ADO 获得更好的性能。在我遇到的大多数访问数据库应用程序中，它确实没有什么区别。当我看到链接表有很大的不同时。ADO 通常表现更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T19:45:49.397

您得到的答案以及您似乎正在接受通过 DAO 记录集的循环。这通常是完成文本的一种非常低效的方法。例如，这个：

```
 Set db = CurrentDB()
  Set rs = db.OpenRecordset("[sql]")
  If rs.RecordCount > 0
     rs.MoveFirst
     Do While Not rs.EOF
       rs.Edit
       rs!Field = "New Data"
       rs.Update
       rs.MoveNext
     Loop 
  End If
  rs.Close
  Set rs = Nothing
  Set db = Nothing 
```

效率将远低于：

```
 UPDATE MyTable SET Field = "New Data" 
```

可以运行：

```
 CurrentDb.Execute "UPDATE MyTable SET Field = 'New Data'" 
```

需要遍历记录集的情况很少见，并且在大多数情况下，SQL 更新速度会快几个数量级（并且会导致在数据页上保持更短的读/写锁）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T19:03:12.527

这就是我最终想出的真正有效的方法。

```
Dim rs As DAO.Recordset
Dim db As Database

Set db = CurrentDB
Set rs = db.OpenRecordset(SQL Statement)

While Not rs.EOF
    'do stuff
Wend

rs.Close 
```

# javascript - JavaScript 发布请求，如表单提交

> ID：133925
> 
> 赞同：1687
> 
> 时间：2008-09-25T15:15:43.510
> 
> 标签：javascript, forms, post, submit

我正在尝试将浏览器定向到不同的页面。如果我想要一个 GET 请求，我可能会说

```
document.location.href = 'http://example.com/q=a'; 
```

但是除非我使用 POST 请求，否则我尝试访问的资源将无法正确响应。如果这不是动态生成的，我可能会使用 HTML

```
<form action="http://example.com/" method="POST">
  <input type="hidden" name="q" value="a">
</form> 
```

然后我只需从 DOM 提交表单。

但我真的想要让我说的 JavaScript 代码

```
post_to_url('http://example.com/', {'q':'a'}); 
```

什么是最好的跨浏览器实现？

**编辑**

对不起，我不清楚。我需要一个改变浏览器位置的解决方案，就像提交表单一样。如果[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)可以做到这一点，那并不明显。而且这不应该是异步的，也不应该使用 XML，所以 Ajax 不是答案。

* * *

## 回答 #1

> 赞同：2299
> 
> 时间：2008-09-25T15:28:53.073

## 在表单中动态创建`<input>`并提交

```
/**
 * sends a request to the specified url from a form. this will change the window location.
 * @param {string} path the path to send the post request to
 * @param {object} params the parameters to add to the url
 * @param {string} [method=post] the method to use on the form
 */

function post(path, params, method='post') {

  // The rest of this code assumes you are not using a library.
  // It can be made less verbose if you use one.
  const form = document.createElement('form');
  form.method = method;
  form.action = path;

  for (const key in params) {
    if (params.hasOwnProperty(key)) {
      const hiddenField = document.createElement('input');
      hiddenField.type = 'hidden';
      hiddenField.name = key;
      hiddenField.value = params[key];

      form.appendChild(hiddenField);
    }
  }

  document.body.appendChild(form);
  form.submit();
} 
```

例子：

```
post('/contact/', {name: 'Johnny Bravo'}); 
```

**编辑**：由于这已经得到了如此多的支持，我猜人们会复制粘贴很多。所以我添加了`hasOwnProperty`检查以修复任何无意的错误。

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2011-04-04T00:21:54.333

这将是使用[jQuery](http://en.wikipedia.org/wiki/JQuery)的所选答案的一个版本。

```
// Post to the provided URL with the specified parameters.
function post(path, parameters) {
    var form = $('<form></form>');

    form.attr("method", "post");
    form.attr("action", path);

    $.each(parameters, function(key, value) {
        var field = $('<input></input>');

        field.attr("type", "hidden");
        field.attr("name", key);
        field.attr("value", value);

        form.append(field);
    });

    // The form needs to be a part of the document in
    // order for us to be able to submit it.
    $(document.body).append(form);
    form.submit();
} 
```

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2008-09-25T15:33:36.370

@Aaron 答案的简单快速和肮脏的实现：

```
document.body.innerHTML += '<form id="dynForm" action="http://example.com/" method="post"><input type="hidden" name="q" value="a"></form>';
document.getElementById("dynForm").submit(); 
```

当然，您应该更愿意使用 JavaScript 框架，例如[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)或[jQuery](http://en.wikipedia.org/wiki/JQuery) ...

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2008-09-25T15:29:47.657

使用[此答案](https://stackoverflow.com/questions/118693/how-do-you-dynamically-create-a-radio-button-in-javascript-that-works-in-all-br#120372)`createElement`中提供的功能，这是必要的，因为[IE 与](http://msdn.microsoft.com/en-us/library/ms534184(VS.85).aspx)通常使用以下方法创建的元素的 name 属性损坏：`document.createElement`

```
function postToURL(url, values) {
    values = values || {};

    var form = createElement("form", {action: url,
                                      method: "POST",
                                      style: "display: none"});
    for (var property in values) {
        if (values.hasOwnProperty(property)) {
            var value = values[property];
            if (value instanceof Array) {
                for (var i = 0, l = value.length; i < l; i++) {
                    form.appendChild(createElement("input", {type: "hidden",
                                                             name: property,
                                                             value: value[i]}));
                }
            }
            else {
                form.appendChild(createElement("input", {type: "hidden",
                                                         name: property,
                                                         value: value}));
            }
        }
    }
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
} 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2010-07-15T20:50:39.717

[Rakesh](http://en.wikipedia.org/wiki/Safari_%28web_browser%29) [Pai 的回答](https://stackoverflow.com/questions/133925/javascript-post-request-like-a-form-submit/133997#133997)令人惊叹，但是当我尝试发布一个名为`submit`. 例如，`post_to_url("http://google.com/",{ submit: "submit" } );`。我已经稍微修补了这个函数来绕过这个可变空间碰撞。

```
 function post_to_url(path, params, method) {
        method = method || "post";

        var form = document.createElement("form");

        //Move the submit function to another variable
        //so that it doesn't get overwritten.
        form._submit_function_ = form.submit;

        form.setAttribute("method", method);
        form.setAttribute("action", path);

        for(var key in params) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);

            form.appendChild(hiddenField);
        }

        document.body.appendChild(form);
        form._submit_function_(); //Call the renamed function.
    }
    post_to_url("http://google.com/", { submit: "submit" } ); //Works! 
```

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2013-08-19T01:00:29.567

不可以。您不能像提交表单那样使用 JavaScript 发布请求。

您可以拥有 HTML 格式的表单，然后使用 JavaScript 提交它。（如本页多次解释的那样）。

您可以自己创建 HTML，不需要 JavaScript 来编写 HTML。如果有人这么建议，那就太愚蠢了。

```
<form id="ninja" action="http://example.com/" method="POST">
  <input id="donaldduck" type="hidden" name="q" value="a">
</form> 
```

您的函数只会按照您想要的方式配置表单。

```
function postToURL(a,b,c){
   document.getElementById("ninja").action     = a;
   document.getElementById("donaldduck").name  = b;
   document.getElementById("donaldduck").value = c;
   document.getElementById("ninja").submit();
} 
```

然后，像这样使用它。

```
postToURL("http://example.com/","q","a"); 
```

但我会忽略这个功能，然后做。

```
document.getElementById('donaldduck').value = "a";
document.getElementById("ninja").submit(); 
```

最后，样式决定进入 ccs 文件。

```
#ninja{ 
  display:none;
} 
```

就个人而言，我认为表格应该通过名称来解决，但现在这并不重要。

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2012-03-22T01:41:05.143

这是 rakesh 的答案，但支持数组（这在表单中很常见）：

纯javascript：

```
function post_to_url(path, params, method) {
    method = method || "post"; // Set method to post by default, if not specified.

    // The rest of this code assumes you are not using a library.
    // It can be made less wordy if you use one.
    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    var addField = function( key, value ){
        var hiddenField = document.createElement("input");
        hiddenField.setAttribute("type", "hidden");
        hiddenField.setAttribute("name", key);
        hiddenField.setAttribute("value", value );

        form.appendChild(hiddenField);
    }; 

    for(var key in params) {
        if(params.hasOwnProperty(key)) {
            if( params[key] instanceof Array ){
                for(var i = 0; i < params[key].length; i++){
                    addField( key, params[key][i] )
                }
            }
            else{
                addField( key, params[key] ); 
            }
        }
    }

    document.body.appendChild(form);
    form.submit();
} 
```

哦，这是 jquery 版本：（代码略有不同，但归结为同一件事）

```
function post_to_url(path, params, method) {
    method = method || "post"; // Set method to post by default, if not specified.

    var form = $(document.createElement( "form" ))
        .attr( {"method": method, "action": path} );

    $.each( params, function(key,value){
        $.each( value instanceof Array? value : [value], function(i,val){
            $(document.createElement("input"))
                .attr({ "type": "hidden", "name": key, "value": val })
                .appendTo( form );
        }); 
    } ); 

    form.appendTo( document.body ).submit(); 
} 
```

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2009-01-23T23:53:02.440

如果您安装了[Prototype](http://prototypejs.org/)，您可以收紧代码以生成和提交隐藏表单，如下所示：

```
 var form = new Element('form',
                        {method: 'post', action: 'http://example.com/'});
 form.insert(new Element('input',
                         {name: 'q', value: 'a', type: 'hidden'}));
 $(document.body).insert(form);
 form.submit(); 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2008-09-25T16:05:21.003

一种解决方案是生成表单并提交。一种实现是

```
function post_to_url(url, params) {
    var form = document.createElement('form');
    form.action = url;
    form.method = 'POST';

    for (var i in params) {
        if (params.hasOwnProperty(i)) {
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = i;
            input.value = params[i];
            form.appendChild(input);
        }
    }

    form.submit();
} 
```

所以我可以用一个简单的实现一个 URL 缩短书签

```
javascript:post_to_url('http://is.gd/create.php', {'URL': location.href}); 
```

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2014-01-27T21:25:33.243

好吧，希望我已经阅读了所有其他帖子，这样我就不会浪费时间从 Rakesh Pai 的回答中创建这个。这是一个适用于数组和对象的递归解决方案。不依赖 jQuery。

添加了一个段来处理应该像数组一样提交整个表单的情况。（即，项目列表周围没有包装对象）

```
/**
 * Posts javascript data to a url using form.submit().  
 * Note: Handles json and arrays.
 * @param {string} path - url where the data should be sent.
 * @param {string} data - data as javascript object (JSON).
 * @param {object} options -- optional attributes
 *  { 
 *    {string} method: get/post/put/etc,
 *    {string} arrayName: name to post arraylike data.  Only necessary when root data object is an array.
 *  }
 * @example postToUrl('/UpdateUser', {Order {Id: 1, FirstName: 'Sally'}});
 */
function postToUrl(path, data, options) {
    if (options === undefined) {
        options = {};
    }

    var method = options.method || "post"; // Set method to post by default if not specified.

    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    function constructElements(item, parentString) {
        for (var key in item) {
            if (item.hasOwnProperty(key) && item[key] != null) {
                if (Object.prototype.toString.call(item[key]) === '[object Array]') {
                    for (var i = 0; i < item[key].length; i++) {
                        constructElements(item[key][i], parentString + key + "[" + i + "].");
                    }
                } else if (Object.prototype.toString.call(item[key]) === '[object Object]') {
                    constructElements(item[key], parentString + key + ".");
                } else {
                    var hiddenField = document.createElement("input");
                    hiddenField.setAttribute("type", "hidden");
                    hiddenField.setAttribute("name", parentString + key);
                    hiddenField.setAttribute("value", item[key]);
                    form.appendChild(hiddenField);
                }
            }
        }
    }

    //if the parent 'data' object is an array we need to treat it a little differently
    if (Object.prototype.toString.call(data) === '[object Array]') {
        if (options.arrayName === undefined) console.warn("Posting array-type to url will doubtfully work without an arrayName defined in options.");
        //loop through each array item at the parent level
        for (var i = 0; i < data.length; i++) {
            constructElements(data[i], (options.arrayName || "") + "[" + i + "].");
        }
    } else {
        //otherwise treat it normally
        constructElements(data, "");
    }

    document.body.appendChild(form);
    form.submit();
}; 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2008-09-25T15:39:24.000

正如其他人建议的那样，我会沿着 Ajax 路线走下去：

```
var xmlHttpReq = false;

var self = this;
// Mozilla/Safari
if (window.XMLHttpRequest) {
    self.xmlHttpReq = new XMLHttpRequest();
}
// IE
else if (window.ActiveXObject) {
    self.xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
}

self.xmlHttpReq.open("POST", "YourPageHere.asp", true);
self.xmlHttpReq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

self.xmlHttpReq.setRequestHeader("Content-length", QueryString.length);

self.xmlHttpReq.send("?YourQueryString=Value"); 
```

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2008-09-25T15:26:03.283

这里有三个选项。

1.  标准 JavaScript 答案：使用框架！大多数 Ajax 框架都会为您抽象出一种创建[XMLHTTPRequest](http://en.wikipedia.org/wiki/XMLHttpRequest) POST 的简单方法。

2.  自己发出 XMLHTTPRequest 请求，将 post 传递给 open 方法而不是 get。（更多信息在*[XMLHTTPRequest (Ajax) 中使用 POST 方法](http://www.openjs.com/articles/ajax_xmlhttp_using_post.php)*。）

3.  通过 JavaScript，动态创建表单、添加操作、添加输入并提交。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2013-09-10T20:22:05.933

最简单的方法是使用 Ajax Post Request：

```
$.ajax({
    type: "POST",
    url: 'http://www.myrestserver.com/api',
    data: data,
    success: success,
    dataType: dataType
    }); 
```

在哪里：

*   数据是一个对象
*   dataType 是服务器期望的数据（xml、json、script、text、html）
*   url 是您的 REST 服务器或服务器端接受 HTTP-POST 的任何函数的地址。

然后在成功处理程序中使用 window.location 之类的内容重定向浏览器。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2010-09-21T21:22:04.480

这是我使用 jQuery 编写它的方式。在 Firefox 和 Internet Explorer 中测试。

```
function postToUrl(url, params, newWindow) {
    var form = $('<form>');
    form.attr('action', url);
    form.attr('method', 'POST');
    if(newWindow){ form.attr('target', '_blank'); 
  }

  var addParam = function(paramName, paramValue) {
      var input = $('<input type="hidden">');
      input.attr({ 'id':     paramName,
                 'name':   paramName,
                 'value':  paramValue });
      form.append(input);
    };

    // Params is an Array.
    if(params instanceof Array){
        for(var i=0; i<params.length; i++) {
            addParam(i, params[i]);
        }
    }

    // Params is an Associative array or Object.
    if(params instanceof Object) {
        for(var key in params){
            addParam(key, params[key]);
        }
    }

    // Submit the form, then remove it from the page
    form.appendTo(document.body);
    form.submit();
    form.remove();
} 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2008-09-25T15:28:34.230

[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)库包含一个带有“.toQueryString()”方法的Hashtable 对象，它允许您轻松地将 JavaScript 对象/结构转换为查询字符串样式的字符串。由于帖子要求请求的“正文”是查询字符串格式的字符串，这允许您的 Ajax 请求作为帖子正常工作。下面是一个使用原型的例子：

```
$req = new Ajax.Request("http://foo.com/bar.php",{
    method: 'post',
    parameters: $H({
        name: 'Diodeus',
        question: 'JavaScript posts a request like a form request',
        ...
    }).toQueryString();
}; 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2013-03-29T13:41:35.750

这在我的情况下非常有效：

```
document.getElementById("form1").submit(); 
```

您可以在以下功能中使用它：

```
function formSubmit() {
     document.getElementById("frmUserList").submit();
} 
```

使用它，您可以发布所有输入值。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2018-08-31T17:33:24.620

我的解决方案将编码深度嵌套的对象，这与@RakeshPai 目前接受的解决方案不同。

它使用 'qs' npm 库及其 stringify 函数将嵌套对象转换为参数。

此代码适用于 Rails 后端，但您应该能够通过修改传递给 stringify 的选项来修改它以使用所需的任何后端。Rails 要求将 arrayFormat 设置为“括号”。

```
import qs from "qs"

function normalPost(url, params) {
  var form = document.createElement("form");
  form.setAttribute("method", "POST");
  form.setAttribute("action", url);

  const keyValues = qs
    .stringify(params, { arrayFormat: "brackets", encode: false })
    .split("&")
    .map(field => field.split("="));

  keyValues.forEach(field => {
    var key = field[0];
    var value = field[1];
    var hiddenField = document.createElement("input");
    hiddenField.setAttribute("type", "hidden");
    hiddenField.setAttribute("name", key);
    hiddenField.setAttribute("value", value);
    form.appendChild(hiddenField);
  });
  document.body.appendChild(form);
  form.submit();
} 
```

例子：

```
normalPost("/people/new", {
      people: [
        {
          name: "Chris",
          address: "My address",
          dogs: ["Jordan", "Elephant Man", "Chicken Face"],
          information: { age: 10, height: "3 meters" }
        },
        {
          name: "Andrew",
          address: "Underworld",
          dogs: ["Doug", "Elf", "Orange"]
        },
        {
          name: "Julian",
          address: "In a hole",
          dogs: ["Please", "Help"]
        }
      ]
    }); 
```

产生这些 Rails 参数：

```
{"authenticity_token"=>"...",
 "people"=>
  [{"name"=>"Chris", "address"=>"My address", "dogs"=>["Jordan", "Elephant Man", "Chicken Face"], "information"=>{"age"=>"10", "height"=>"3 meters"}},
   {"name"=>"Andrew", "address"=>"Underworld", "dogs"=>["Doug", "Elf", "Orange"]},
   {"name"=>"Julian", "address"=>"In a hole", "dogs"=>["Please", "Help"]}]} 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-05-11T18:57:35.200

另一个**递归**解决方案，因为其他一些似乎被破坏了（我没有测试所有这些）。这取决于[lodash 3.x](https://github.com/lodash/lodash/blob/3.10.1/doc/README.md)和 ES6（不需要 jQuery）：

```
function createHiddenInput(name, value) {
    let input = document.createElement('input');
    input.setAttribute('type','hidden');
    input.setAttribute('name',name);
    input.setAttribute('value',value);
    return input;
}

function appendInput(form, name, value) {
    if(_.isArray(value)) {
        _.each(value, (v,i) => {
            appendInput(form, `${name}[${i}]`, v);
        });
    } else if(_.isObject(value)) {
        _.forOwn(value, (v,p) => {
            appendInput(form, `${name}[${p}]`, v);
        });
    } else {
        form.appendChild(createHiddenInput(name, value));
    }
}

function postToUrl(url, data) {
    let form = document.createElement('form');
    form.setAttribute('method', 'post');
    form.setAttribute('action', url);

    _.forOwn(data, (value, name) => {
        appendInput(form, name, value);
    });

    form.submit();
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-09-25T15:20:04.077

您可以使用 DHTML 动态添加表单，然后提交。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-11-21T09:07:14.200

[FormObject](https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects)是一个选项。但是现在大多数浏览器都不支持 FormObject。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-25T15:23:34.507

您可以使用 jQuery 之类的库及其[$.post 方法](http://docs.jquery.com/Ajax/jQuery.post)。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-25T15:40:48.117

这就像 Alan 的选项 2（上图）。如何实例化 httpobj 留作练习。

```
httpobj.open("POST", url, true);
httpobj.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');
httpobj.onreadystatechange=handler;
httpobj.send(post); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2011-05-27T13:19:34.030

这是基于使用 jQuery 的 beauSD 代码。它经过改进，因此它可以递归地在对象上工作。

```
function post(url, params, urlEncoded, newWindow) {
    var form = $('<form />').hide();
    form.attr('action', url)
        .attr('method', 'POST')
        .attr('enctype', urlEncoded ? 'application/x-www-form-urlencoded' : 'multipart/form-data');
    if(newWindow) form.attr('target', '_blank');

    function addParam(name, value, parent) {
        var fullname = (parent.length > 0 ? (parent + '[' + name + ']') : name);
        if(value instanceof Object) {
            for(var i in value) {
                addParam(i, value[i], fullname);
            }
        }
        else $('<input type="hidden" />').attr({name: fullname, value: value}).appendTo(form);
    };

    addParam('', params, '');

    $('body').append(form);
    form.submit();
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2018-01-20T01:41:16.967

我使用 document.forms java 并循环它来获取表单中的所有元素，然后通过 xhttp 发送。所以这是我的 javascript / ajax 提交解决方案（以所有 html 为例）：

```
 <!DOCTYPE html>
           <html>
           <body>
           <form>
       First name: <input type="text" name="fname" value="Donald"><br>
        Last name: <input type="text" name="lname" value="Duck"><br>
          Addr1: <input type="text" name="add" value="123 Pond Dr"><br>
           City: <input type="text" name="city" value="Duckopolis"><br>
      </form> 

           <button onclick="smc()">Submit</button>

                   <script>
             function smc() {
                  var http = new XMLHttpRequest();
                       var url = "yourphpfile.php";
                     var x = document.forms[0];
                          var xstr = "";
                         var ta ="";
                    var tb ="";
                var i;
               for (i = 0; i < x.length; i++) {
     if (i==0){ta = x.elements[i].name+"="+ x.elements[i].value;}else{
       tb = tb+"&"+ x.elements[i].name +"=" + x.elements[i].value;
             } }

           xstr = ta+tb;
      http.open("POST", url, true);
       http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

      http.onreadystatechange = function() {
          if(http.readyState == 4 && http.status == 200) {

        // do whatever you want to with the html output response here

                } 

               }
            http.send(xstr);

              }
         </script>

         </body>
     </html> 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-09-25T02:17:58.810

我用来自动发布和引导用户到另一个页面的方法是编写一个隐藏的表单，然后自动提交它。请放心，隐藏的表单绝对不会占用网页上的空间。代码将是这样的：

```
 <form name="form1" method="post" action="somepage.php">
    <input name="fielda" type="text" id="fielda" type="hidden">

    <textarea name="fieldb" id="fieldb" cols="" rows="" style="display:none"></textarea>
</form>
    document.getElementById('fielda').value="some text for field a";
    document.getElementById('fieldb').innerHTML="some text for multiline fieldb";
    form1.submit(); 
```

**自动提交申请**

自动提交的应用程序会将用户自动放入另一个页面的表单值引导回该页面。这样的应用程序将是这样的：

```
fieldapost=<?php echo $_post['fielda'];>
if (fieldapost !="") {
document.write("<form name='form1' method='post' action='previouspage.php'>
  <input name='fielda' type='text' id='fielda' type='hidden'>
</form>");
document.getElementById('fielda').value=fieldapost;
form1.submit();
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2018-03-06T23:14:25.293

这是我的做法。

```
function redirectWithPost(url, data){
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = url;

        for(var key in data){
            var input = document.createElement('input');
            input.name = key;
            input.value = data[key];
            input.type = 'hidden';
            form.appendChild(input)
        }
        document.body.appendChild(form);
        form.submit();
    } 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-07-09T00:22:21.730

使用 POST 或 GET 重定向的 jQuery 插件：

[https://github.com/mgalante/jquery.redirect/blob/master/jquery.redirect.js](https://github.com/mgalante/jquery.redirect/blob/master/jquery.redirect.js)

要进行测试，请包含上述 .js 文件或将类复制/粘贴到您的代码中，然后在此处使用代码，将“args”替换为您的变量名，将“values”替换为这些相应变量的值：

```
$.redirect('demo.php', {'arg1': 'value1', 'arg2': 'value2'}); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2019-02-13T09:13:36.513

你可以使用 jQuery 的 trigger 方法来提交表单，就像你按下一个按钮一样，像这样，

```
$('form').trigger('submit') 
```

它将在浏览器上提交。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-12-10T09:27:46.687

以上解决方案都没有只使用 jQuery 处理深层嵌套参数，所以这是我的两分钱解决方案。

如果您使用 jQuery 并且需要处理深层嵌套参数，则可以使用以下函数：

```
 /**
     * Original code found here: https://github.com/mgalante/jquery.redirect/blob/master/jquery.redirect.js
     * I just simplified it for my own taste.
     */
    function postForm(parameters, url) {

        // generally we post the form with a blank action attribute
        if ('undefined' === typeof url) {
            url = '';
        }

        //----------------------------------------
        // SOME HELPER FUNCTIONS
        //----------------------------------------
        var getForm = function (url, values) {

            values = removeNulls(values);

            var form = $('<form>')
                .attr("method", 'POST')
                .attr("action", url);

            iterateValues(values, [], form, null);
            return form;
        };

        var removeNulls = function (values) {
            var propNames = Object.getOwnPropertyNames(values);
            for (var i = 0; i < propNames.length; i++) {
                var propName = propNames[i];
                if (values[propName] === null || values[propName] === undefined) {
                    delete values[propName];
                } else if (typeof values[propName] === 'object') {
                    values[propName] = removeNulls(values[propName]);
                } else if (values[propName].length < 1) {
                    delete values[propName];
                }
            }
            return values;
        };

        var iterateValues = function (values, parent, form, isArray) {
            var i, iterateParent = [];
            Object.keys(values).forEach(function (i) {
                if (typeof values[i] === "object") {
                    iterateParent = parent.slice();
                    iterateParent.push(i);
                    iterateValues(values[i], iterateParent, form, Array.isArray(values[i]));
                } else {
                    form.append(getInput(i, values[i], parent, isArray));
                }
            });
        };

        var getInput = function (name, value, parent, array) {
            var parentString;
            if (parent.length > 0) {
                parentString = parent[0];
                var i;
                for (i = 1; i < parent.length; i += 1) {
                    parentString += "[" + parent[i] + "]";
                }

                if (array) {
                    name = parentString + "[" + name + "]";
                } else {
                    name = parentString + "[" + name + "]";
                }
            }

            return $("<input>").attr("type", "hidden")
                .attr("name", name)
                .attr("value", value);
        };

        //----------------------------------------
        // NOW THE SYNOPSIS
        //----------------------------------------
        var generatedForm = getForm(url, parameters);

        $('body').append(generatedForm);
        generatedForm.submit();
        generatedForm.remove();
    } 
```

这是一个如何使用它的示例。html代码：

```
<button id="testButton">Button</button>

<script>
    $(document).ready(function () {
        $("#testButton").click(function () {
            postForm({
                csrf_token: "abcd",
                rows: [
                    {
                        user_id: 1,
                        permission_group_id: 1
                    },
                    {
                        user_id: 1,
                        permission_group_id: 2
                    }
                ],
                object: {
                    apple: {
                        color: "red",
                        age: "23 days",
                        types: [
                            "golden",
                            "opal",
                        ]
                    }
                },
                the_null: null, // this will be dropped, like non-checked checkboxes are dropped
            });
        });
    });
</script> 
```

如果您单击测试按钮，它将发布表单，您将在 POST 中获得以下值：

```
array(3) {
  ["csrf_token"] => string(4) "abcd"
  ["rows"] => array(2) {
    [0] => array(2) {
      ["user_id"] => string(1) "1"
      ["permission_group_id"] => string(1) "1"
    }
    [1] => array(2) {
      ["user_id"] => string(1) "1"
      ["permission_group_id"] => string(1) "2"
    }
  }
  ["object"] => array(1) {
    ["apple"] => array(3) {
      ["color"] => string(3) "red"
      ["age"] => string(7) "23 days"
      ["types"] => array(2) {
        [0] => string(6) "golden"
        [1] => string(4) "opal"
      }
    }
  }
} 
```

注意：如果要将表单发布到当前页面以外的另一个 url，可以将 url 指定为 postForm 函数的第二个参数。

因此，例如（重用您的示例）：

```
postForm({'q':'a'}, 'http://example.com/'); 
```

希望这可以帮助。

注2：代码取自[重定向插件](https://github.com/mgalante/jquery.redirect/blob/master/jquery.redirect.js)。我基本上只是根据我的需要对其进行了简化。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-06-15T19:59:30.507

尝试

```
function post_to_url(url, obj) {
  let id=`form_${+new Date()}`;
  document.body.innerHTML+=`
    <form id="${id}" action="${url}" method="POST">
      ${Object.keys(obj).map(k=>`
        <input type="hidden" name="${k}" value="${obj[k]}">
      `)}
    </form>`
  this[id].submit();  
}

// TEST - in second param object can have more keys
function jump() { post_to_url('https://example.com/', {'q':'a'}); }
```

```
Open chrome>networks and push button:
<button onclick="jump()">Send POST</button>
```

* * *

## 回答 #31

> 赞同：-3
> 
> 时间：2008-09-25T15:22:14.180

您可以进行 AJAX 调用（可能使用库，例如​​使用 Prototype.js 或 JQuery）。AJAX 可以处理 GET 和 POST 选项。

# winforms - 无论哪个子控件具有焦点，Enter 键是否始终触发默认按钮

> ID：133932
> 
> 赞同：1
> 
> 时间：2008-09-25T15:19:42.207
> 
> 标签：winforms

我有一个带有默认确定按钮和取消按钮的表单。我有一个可以编辑节点的树视图，即您可以双击它们或按 F2 打开另一个表单。

现在，我从不喜欢那个 F2 快捷方式，现在我启用了树视图标签编辑，情况更糟。我在测试表单时的第一反应是按“Enter”来编辑选定的节点，但这样做会违反正常的默认按钮行为。

您的意见：应用程序是否应该始终强制使用 Enter 键触发默认按钮？如果是这样，应用程序应该使用哪种快捷方式来“编辑所选项目”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T15:26:11.910

绝对不是... 让我们的用户感到困惑的是，输入没有选择他们突出显示的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T21:12:54.057

绝对没有。Enter 键通常用于触发默认按钮，但通常不会。例如， Enter 通常表示多行文本框中的新行。

在这种情况下，输入听起来像是一个不错的选择。F2 在 Windows 中往往意味着“编辑”。

但是，如果这是一个长期存在的应用程序，您可能只会激怒习惯 F2 的用户。

# php - 有没有办法让 PHP 将数据实时打印到 Web 浏览器？

> ID：133935
> 
> 赞同：9
> 
> 时间：2008-09-25T15:19:51.067
> 
> 标签：php

例如，如果我有一个 echo 语句，则不能保证浏览器会立即显示它，可能会同时显示几十个 echo 语句，并且可能会等到整个页面完成后才显示任何内容。

有没有办法让每个回声在执行时出现在浏览器中？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T15:28:13.433

您可以使用[`flush()`](http://php.net/flush)强制将缓冲区内容发送到浏览器。

您可以使用“”启用隐式刷新[`ob_implicit_flush(true)`](http://php.net/ob_implicit_flush)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-25T15:35:56.020

```
function printnow($str, $bbreak=true){
    print "$str";
    if($bbreak){
        print "<br />";
    }
    ob_flush(); flush();
} 
```

显然，如果您将复杂的对象（或至少那些不实现 __toString 的对象）传递给它，这将不会起作用，但是，您明白了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T16:07:11.360

正如其他人指出的那样，除了 PHP 之外，还有一些地方可能会挂起（例如，Web 服务器或客户端的浏览器）。如果您真的想确保信息在可用时显示出来，您可能需要一些基于 AJAX 的解决方案。您将拥有一个处理显示的 PHP 脚本和另一个执行计算的 PHP 脚本，并让显示脚本向另一个发出 AJAX 请求。 [jQuery](http://jquery.com/)有一些非常简单的 AJAX 函数可以帮助你。

如果浏览器不支持/禁用 JavaScript，您还希望有一个后备，这只是标准页面，可能直到最后才显示内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T15:25:43.753

您可以`flush()`在**PHP**中调用，但还有其他几个地方可以保存输出（例如在网络服务器上）。如果您正在使用输出缓冲，您还需要调用`ob_flush()`。

您可能还会发现某些浏览器在 HTML 有效之前不会呈现页面，直到所有标签都关闭（如 body、html）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T22:23:09.897

Enabling implicit flush as blueyed said should do the trick since it calls flush after every echo however some browsers also require no-cache headers to be set. Here is what I use. Your mileage may vary depending on the browser.

```
header('Cache-Control: no-cache, no-store, max-age=0, must-revalidate');
header('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past
header('Pragma: no-cache'); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T15:21:28.397

在这里开始你的调查：

[http://httpd.apache.org/docs/1.3/misc/FAQ-F.html#nph-scripts](http://httpd.apache.org/docs/1.3/misc/FAQ-F.html#nph-scripts)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T15:55:44.880

flush() 是答案的一部分。然而，至少在一年前，在 Safari 中使用刷新是不可靠的。根据您的情况，我会研究涉及 javascript 的解决方案。也许进度条的各种实现都有可以回收的代码/想法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T16:08:44.273

我建议使用 AJAX。

# dependency-injection - Castle-Windsor 运行时交换服务

> ID：133945
> 
> 赞同：1
> 
> 时间：2008-09-25T15:21:34.667
> 
> 标签：dependency-injection, runtime, castle-windsor

假设我们将税务服务的接口定义为 ITaxService，并且我们获得了多个 TaxService 的实现（按地区），但是我想将特定的税务实现附加到来自特定地区的特定客户。

DI 在这种情况下会有所帮助吗？如何？“代码片段将不胜感激”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T02:59:28.217

在不了解更多信息的情况下，这似乎适合策略模式的实现（[http://en.wikipedia.org/wiki/Strategy_pattern](http://en.wikipedia.org/wiki/Strategy_pattern)）。

像 Windsor 这样的依赖注入工具可以用作工厂的一种形式，以确定在给定情况下使用的正确策略（税务服务）（例如，键入区域标识符），但它更让我印象深刻。该工具作为对象存储库，而不是专门用于依赖注入的目的。

# c++ - 在 Windows CE 6.0 中的进程之间共享 GDI 句柄

> ID：133948
> 
> 赞同：0
> 
> 时间：2008-09-25T15:21:55.213
> 
> 标签：c++, windows-ce, gdi

我知道 GDI 句柄在“Big Windows”中是独一无二的并且是特定于进程的，但它们在 Windows CE 6.0 中的工作方式是否相同？

例如：我有一个字体管理服务，其他几个服务和应用程序将使用它。此服务具有用于打印和显示的有效字体和配置列表；CreateFontIndirect() 已在它们中的每一个上调用。当这些客户端应用程序之一请求特定字体（和配置）时，我可以返回适当的 HFONT 吗？如果没有，是否有一种安全/有效的方法来复制句柄，例如 DuplicateHandle 用于内核句柄。

我问的原因是，我已经看到通过 PostMessage 传递给另一个应用程序的 HFONT 可以正常工作，但我不认为它们是“应该”的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T21:47:04.647

我相信你是对的，你不能依赖 HFONT 安全地跨进程传递。

> “我问的原因是，我看到通过 PostMessage 传递给另一个应用程序的 HFONT 可以正常工作，但我不认为它们是‘应该’的。”

他们没有正确通过，所以没有“应该”。虽然 HFONT 不能保证跨进程工作，但也不能保证它们在进程之间是*唯一*的。'Arial' 可能在一个时间点与每个应用程序的特定版本在两个不同进程中具有相同的 HFONT 值，并且可能随时更改（包括使用它的中途！）

就像我在画画，橙色颜料用完了，我把它放在我的画架上作为第三根管子。我可以伸手去拿你的 easle 并抓住第三个 tupe……但我不能保证它是橙色的……我不能保证它甚至包含油漆！也许你今天在 easle 刷牙……哎呀！

GDI 句柄类似于该示例中的数字“3”。今天，GDI 可能会在所有 easles 上保持相同的管状顺序。它可能会保持其中一些井井有条，而有些则不会（即橙色的'sorta works'，但'seafoam green'被破坏了）。它们可能在一个 CE 设备上是有序的，但在另一个设备上却不是。

一如既往，YMMV。

# c# - 在 C#/.Net 中进行面向方面编程 (AOP) 的最佳/最流行的方法是什么？

> ID：133950
> 
> 赞同：4
> 
> 时间：2008-09-25T15:22:04.917
> 
> 标签：c#, .net, aop

在 C#/.Net 中进行面向方面编程 (AOP) 的最佳/最流行的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T15:45:32.970

*   [Castle 的DynamicProxy](http://www.castleproject.org/projects/dynamicproxy/)可能是在 CLR 上执行 AOP 的最常用工具。
*   [Spring 框架](http://www.springframework.net/docs/1.2.0-M1/reference/html/aop.html)还通过其命名空间提供 AOP 功能 `Spring.Aop`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T15:48:12.637

[Postsharp](http://www.postsharp.org/)是另一个著名的：“将 AOP 引入 .NET！” 我对它的经验很少，但它看起来不错，值得一看。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-23T22:20:07.673

[PostSharp](http://www.postsharp.org/)很好。我已经使用它大约一年了。考虑到它所提供的近乎神一般的力量，它易于安装并且学习曲线相当浅。此外，似乎既有一个活跃的开发者社区，也有一个响应迅速的开发者。

查看 PostSharp 主页上的代码示例。这些都是用 PostSharp 完成的简单方面的好例子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-08T16:15:29.603

我已经使用 Spring.Net AOP Framework 大约 9 个月了。即使编织是在运行时而不是在编译期间完成的，它也非常强大，并且似乎不会在使用中造成性能损失。唯一需要注意的是，尽管您应用建议的对象不需要了解 Spring.Net AOP，但它们*必须*至少实现一个接口。顺便说一句，对于 Spring.Net 而言，该文档通常非常出色，它指出此限制将在将来的版本中删除，但没有给出路线图。

Spring.Net AOP 不需要您使用 Spring.Net 框架的其余部分，可以单独使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T15:44:04.473

对于几种不同类型的事情，我玩过自己的滚动。我有一些运气。一般来说，我创建一个接口，用一个类实现它，然后创建一个实现接口的代理，执行我想要的任何前置条件步骤，调用真实对象的方法，然后执行我想要的任何后置条件步骤。我对这种方法的主要烦恼之一是接口中不能有构造函数，接口中也不能有静态方法，因此没有明显的地方可以放置这种类型的代码。困难的部分是代码生成——因为你要么要发出 IL，要么要发出必须编译的 C#。但这只是我的方法。它迫使我一次只考虑一个方面，真的——我没有 没有达到我可以抽象出“方面”并以这些术语思考的地步。简而言之：推出自己的工具集或找到您喜欢的工具集，可能来自[埃里克·博登的名单](http://www.bodden.de/tools/aop-dot-net/)。

# web-services - 通过 List Webservice 更新列表项来触发 SharePoint 工作流

> ID：133953
> 
> 赞同：16
> 
> 时间：2008-09-25T15:22:17.473
> 
> 标签：web-services, sharepoint, workflow, autostart

我正在开发一个简单的 SharePoint 顺序工作流，它应该绑定到文档库。将小工作流与文档库相关联时，我检查了这些选项

*   允许具有编辑项目权限的经过身份验证的用户手动启动此工作流。
*   创建新项目时启动此工作流程。
*   更改项目时启动此工作流程。

现在我将一个文档上传到这个库，工作流程开始，例如发送一封邮件。它完成了，一切都很好。

当我在新项目上选择编辑属性并保存更改时，再次触发工作流。完全符合我们的预期。

即使在 Copy.asmx Web 服务的帮助下将新项目复制到库中，工作流也能正常启动。

但**现在**我想**通过 SharePoint WebService Lists.asmx**更新该项目。

我的[CAML](http://en.wikipedia.org/wiki/Collaborative_Application_Markup_Language)在这里：

```
<Method ID='1' Cmd='Update'>
  <Field Name='ID'>1</Field>
  <Field Name='myDummyPropertyField'>NewValue</Field>
</Method> 
```

项目正在更新（时间戳已更改，并且也是一个虚拟属性），但工作流程不会重新开始。

这种行为在我们的开发**和**测试系统上是可重现的。

检查错误日志（C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\LOGS）我发现了一条奇怪的错误消息：

```
09/25/2008 16:51:40.17  w3wp.exe (0x1D94)                           0x1D60  Windows SharePoint Services     General                         6875    Critical    Error loading and running event receiver Microsoft.SharePoint.Workflow.SPWorkflowAutostartEventReceiver in Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c. Additional information is below.  : The object specified does not belong to a list. 
```

谁能证实这种行为？或任何解决方案提示？

* * *

我会随时通知您有关此主题的任何进展。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-15T14:13:59.060

**最后，我们通过了 Microsoft 的支持服务流程并获得了解决方案！**

首先，微软表示这是一个错误。这是一个小错误，因为有一个很好的解决方法，所以可能需要更长的时间，直到修复这个错误（支持技术人员说下一个服务包或下一个版本（！））。

但现在解决问题。

**原因**

让我们看一下我的问题中的 CAML 代码：

```
<Method ID='1' Cmd='Update'>
  <Field Name='ID'>1</Field>
  <Field Name='myDummyPropertyField'>NewValue</Field>
</Method> 
```

出于任何原因，Workflow Manager 无法使用该 ID，我们在第二行中输入了该 ID。奇怪的是，所有其他 SharePoint 命令都使用 ID，但不是 Workflow Manager。Workflow Manager 使用“完全限定”的文档名称。因此，由于我们没有任何线索并且没有输入任何完全限定的文档名称，Workflow Manager 默认使用当前文档库的名称。现在错误消息开始变得有意义：

```
The object specified does not belong to a list. 
```

当然，对象（文档库）不属于列表，它是列表。

**解决方案**

我们必须在 CAML 查询中再添加一行：

```
<Field Name='FileRef'>/sites/mySite/myDocLib/myFolder/myDocument.txt</Field> 
```

FileRef 将完全限定的文档名称传递给 Workflow Manager，它现在非常高兴 - 启动项目的工作流。

请注意，您必须包含完整的绝对服务器路径，省略您的服务器名称（例如在您的 SPItem 的 ServerRelativePath 属性中找到）。

完整的工作 CAML 查询：

```
 <Method ID='1' Cmd='Update'>
    <Field Name='ID'>1</Field>
    <Field Name='FileRef'>/sites/mySite/myDocLib/myFolder/myDocument.txt</Field>
    <Field Name='myDummyPropertyField'>NewValue</Field>
  </Method> 
```

**未来**

也许这种未记录的行为将在即将推出的服务包之一中得到修复，也许不会。Microsoft 支持部门已致歉，并将发布有关此主题的 MSDN 文章。在接下来的一个月里，我希望这篇关于 stackoverflow 的文章能够帮助处于相同情况的开发人员。

谢谢阅读！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T09:25:21.100

我们在审批工作流程中遇到了类似的问题。为了解决这个问题，我们编写了自己的事件接收器并将其附加到列表中。根据项目是更新还是编辑，我们随后启动了审批工作流程。

希望这可以帮助...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T06:28:05.133

我也遇到过这个问题，发现一旦工作流程启动，无论您如何更新项目，它都无法自动重新启动。但是，您可以根据需要多次手动重新启动工作流程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T23:18:11.620

我见过同样的行为。但是你会收到[这样的帖子](http://sharepointmagazine.net/technical/development/the-dog-ate-my-task-use-sharepoint-designer-to-email-daily-task-reminders?disqus_reply=3886089#dsq-alerts)，向人们展示如何每天创建一个来设置电子邮件提醒。

# php - 用单引号解析 XML？

> ID：133956
> 
> 赞同：0
> 
> 时间：2008-09-25T15:23:05.583
> 
> 标签：php, xml, xml-parsing, html-entities

我目前遇到一个问题，其中一个元素从我的 xml 文件中返回，其中包含一个单引号。这导致 xml_parse 将其分成多个块，例如：Get Wired, You're Hired！然后输入为“Get Wired, You”是一个对象，单引号是第二个，“re Hired!” 作为第三者。

我想做的是：

```
while($data = fread($fp, 4096)){
        if(!xml_parse($xml_parser, htmlentities($data,ENT_QUOTES), feof($fp))) {
            break;
        }
    } 
```

但这一直在打破。我可以运行 str_replace 来代替 htmlentities，它运行没有问题，但不想使用 htmlentities。

有任何想法吗？

**更新：** 根据下面 JimmyJ 的回复，我尝试了以下解决方案，但没有成功（仅供参考，链接帖子上方有一两个响应更新了直接链接的代码）：

```
function XMLEntities($string)
    {
        $string = preg_replace('/[^\x09\x0A\x0D\x20-\x7F]/e', '_privateXMLEntities("$0")', $string);
        return $string;
    }

    function _privateXMLEntities($num)
    {
    $chars = array(
        39  => '&#39;',
        128 => '&#8364;',
        130 => '&#8218;',
        131 => '&#402;',
        132 => '&#8222;',
        133 => '&#8230;',
        134 => '&#8224;',
        135 => '&#8225;',
        136 => '&#710;',
        137 => '&#8240;',
        138 => '&#352;',
        139 => '&#8249;',
        140 => '&#338;',
        142 => '&#381;',
        145 => '&#8216;',
        146 => '&#8217;',
        147 => '&#8220;',
        148 => '&#8221;',
        149 => '&#8226;',
        150 => '&#8211;',
        151 => '&#8212;',
        152 => '&#732;',
        153 => '&#8482;',
        154 => '&#353;',
        155 => '&#8250;',
        156 => '&#339;',
        158 => '&#382;',
        159 => '&#376;');
        $num = ord($num);
        return (($num > 127 && $num < 160) ? $chars[$num] : "&#".$num.";" );
    }
if(!xml_parse($xml_parser, XMLEntities($data), feof($fp))) {
            break;
        } 
```

**更新：**根据下面汤姆的问题，魔术引号确实已关闭。

**解决方案：**我最终解决问题的方法如下：

在为每个单独的项目/帖子/等收集数据后，我将该数据存储到稍后用于输出的数组中，然后清除收集期间使用的局部变量。我在一个步骤中添加了一个检查数据是否已经存在的步骤，如果存在，我将它连接到最后，而不是覆盖它。

所以，如果我最终得到三个块（如上，让我们坚持'Get Wired，You're Hired！'，然后我将不再做

```
$x = 'Get Wired, You'
$x = "'"
$x = 're Hired!' 
```

要做：

```
$x = 'Get Wired, You' . "'" . 're Hired!' 
```

这不是最佳解决方案，但似乎有效。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T14:54:01.403

我认为启用魔术引号有时会弄乱 xml 解析 - 这是否启用？您可以在运行时使用禁用此功能

```
set_magic_quotes_runtime(0); 
```

编辑：如果源不是发布或获取，这可能不相关，但我在 PHP 手册中读到它可能会导致奇怪的行为

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:03:05.253

为什么不使用 simplexml_load_file 之类的东西轻松解析文件？

# c# - unlockbits、lockbits 和 try-finally

> ID：133958
> 
> 赞同：6
> 
> 时间：2008-09-25T15:23:09.797
> 
> 标签：c#, .net

我正在调用一些使用 .NET 中的 BitmapData 类的代码。我遇到了一些在 Googlespace 上找不到明确答案的问题。

因为似乎 LockBits 和 UnlockBits 必须始终成对调用，所以我使用这个：

```
 System.Drawing.Imaging.BitmapData tempImageData = tempImage.LockBits(
            new System.Drawing.Rectangle(0, 0, tempImage.Width, tempImage.Height),
            System.Drawing.Imaging.ImageLockMode.ReadOnly, tempImage.PixelFormat);
         try
         {
            //use external library on the data
         }//Exception not handled here; throw to calling method
         finally
         {
            tempImage.UnlockBits(tempImageData);
         } 
```

（我最近一直在玩 using 语句，这在 C# 中非常有用，这让我想到我应该这样做。）问题是，即使是 MS 自己的文档（[http://msdn.microsoft.com/ en-us/library/system.drawing.bitmap.unlockbits.aspx](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.unlockbits.aspx)）认为它不适合使用 try-finally 模式。

try-finally 是必要的还是无偿的？

**更新：我最终可能会捕获并重新抛出异常，因为我不知道它可能是什么并且没有更早地捕获它们。**

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T17:37:48.613

try-finally 模式是正确的。由于这是外部代码，因此您无法控制引发哪些异常，并且无论发生什么错误，都需要执行 UnlockBits 清理代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T15:35:05.743

即使您确实捕获了异常，使用 finally 也意味着您不会重复 UnlockBits 调用，这是我的选择中的一个优点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T15:29:14.757

您是否期望抛出某种异常？如果是，你能抓住它吗？如果没有，那么我看不到尝试/最终的意义。

关于例外也有不同的哲学。就我个人而言，我认为它们是“特殊的”——就像你上次写入文件时断电一样，所以你的序列化文件比你预期的要短。我不确定当您像这样操作位时会发生什么样的异常情况。如果你离开数组的末端，这并不例外，这只是意味着你需要加强你的边界检查。

# asp.net-mvc - 在 ASP.NET MVC 中，如何编写模型以便视图中的复选框对应于数据库中的整数？

> ID：133964
> 
> 赞同：0
> 
> 时间：2008-09-25T15:24:12.430
> 
> 标签：asp.net-mvc

我有一个数据库列“WantsReply”，它在逻辑上包含一个布尔值（位），但不幸的是实现为一个整数。任何非零值表示“是”，零表示“否”。

如果我写

```
class Entry {
   [Column] public int WantsReply {get; set;}
} 
```

在我的模型中，并将其映射到视图中的复选框

```
Html.CheckBox( "WantsReply", View.Model.WantsReply ) 
```

然后我在提交视图时收到转换错误。另一方面，如果我写

```
[Column] public bool WantsReply {get; set;} 
```

然后视图提交工作正常，但是当我运行查询时出现不同的转换错误

```
from entry in Entries select entry; 
```

如何解决这种阻抗不匹配问题，以便查询和提交都能正常工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T17:24:01.907

与其更改列属性的类型，不如将其映射到新属性？

```
public partial class Entry {
    public bool WantsReplyAsBool
    {
        get
        {
            return WantsReply != 0;
        }
        set
        {
            if (value)
            {
                WantsReply = 1;
            }
            else
            { 
                WantsReply = 0;
            }
        }
    } 
} 
```

如果您愿意，整数属性可以是私有的。在您的视图中使用 bool 属性。

# regex - 在记事本++中查找CRLF

> ID：133965
> 
> 赞同：332
> 
> 时间：2008-09-25T15:24:27.157
> 
> 标签：regex, notepad++

如何在 Notepad++ 中查找/替换所有 CR/LF 字符？

我正在寻找与 Microsoft Word 中的 ^p 特殊字符等效的内容。

* * *

## 回答 #1

> 赞同：426
> 
> 时间：2008-09-25T15:27:07.897

**`[\r\n]+`**也应该工作

2012 年 3 月 26 日更新，**[Notepad++ 6.0](http://notepad-plus-plus.org/news/notepad-6.0-release.html)**的发布日期：

OMG，它现在确实有效！

![Notepad++ 中的 PCRE 正则表达式](https://i.stack.imgur.com/ZiyXX.png)

* * *

原始答案 2008 (Notepad++ 4.x) - 2009-2010-2011 (Notepad++ 5.x)

实际上不，它似乎不适用于正则表达式......

但如果你有 Notepad++ 5.x，你可以使用“**扩展**”搜索模式并查找`\r\n`. 那确实找到了你所有的`CRLF`.

（我意识到这与其他答案相同，但同样，“扩展模式”仅适用于 Notepad++ 4.9、5.x 等）

* * *

自 2009 年 4 月以来，您在 Notepad++ 站点上有一篇关于此主题的 wiki 文章：
“**[如何替换行尾，从而更改行布局](http://sourceforge.net/apps/mediawiki/notepad-plus/index.php?title=Replacing_Newlines)**”。
（[georgiecasey](https://stackoverflow.com/users/467509/georgiecasey)在下面的[回答中](https://stackoverflow.com/questions/133965/find-crlf-in-notepad/4608574#4608574)提到）

一些相关的摘录包括以下搜索过程：

> ### 简单搜索（`Ctrl`+ `F`），搜索模式=`Normal`
> 
> 您可以`EOL`在编辑窗口中选择一个。
> 
> *   只需将光标移动到行尾，然后键入`Shift`+`Right`箭头。
> *   或者，要`EOL`使用鼠标选择，从行尾开始并拖动到下一行的开头；拖动到右侧`EOL`将不起作用。您可以手动复制并将`EOL`其粘贴到 Unix 文件的字段中（`LF`-only）。
> 
> ### 简单搜索 (Ctrl+F)，搜索模式 = 扩展
> 
> “扩展”选项显示`\n`和`\r`作为可以匹配的字符。
> 与普通搜索模式一样，Notepad++ 正在寻找确切的字符。
> 在 UNIX 格式的文件中搜索`\r`不会找到任何东西，但搜索`\n`会。同样，Macintosh 格式的文件将包含`\r`但不包含`\n`.
> 
> ### 简单搜索 (Ctrl+F)，搜索模式 = 正则表达式
> 
> 正则表达式使用字符`^`并将`$`匹配字符串锚定到行的开头或结尾。例如，搜索`return;$`将找到“return;”的出现。在同一行上没有后续文本的情况下发生。锚字符在所有文件格式中的作用相同。
> 这 '。' 点元字符与行尾不匹配。
> 
> [在 Notepad++ 5.8.5 中测试]：**带有显式`\r`或`\n`不工作的正则表达式搜索（与[Scintilla 文档](http://www.scintilla.org/ScintillaDoc.html)相反）**。
> 也不会搜索显式（粘贴的）LF 或选择 EOL 时放置在字段中的（不可见）EOL 字符。不带正则表达式的高级搜索 ( `Ctrl`+ )`R`
> 
> `Ctrl`+`M`将插入与换行符匹配的内容。它们将被替换字符串替换。
> 我推荐这种方法是最可靠的，除非你真的需要使用正则表达式。
> 例如，要删除双倍行距文件中的每隔一个换行符，请在搜索字符串框中输入`Ctrl`+`M`两次，并在替换字符串框中输入一次。
> 
> ### 使用正则表达式的高级搜索 ( `Ctrl`+ `R`)。
> 
> `Ctrl`+`M`和都不`$`匹配`\r\n`。

* * *

同一个 wiki 还提到了**Hex 编辑器替代方案**：

> *   在文档的开头键入新字符串。
> *   然后选择以**十六进制模式查看文档**。
> *   选择新行之一并点击`Ctrl`+ `H`。
> *   当您打开“替换”对话框时，在背景上选择新的替换字符串并`Ctrl`+`C`复制它以将其粘贴到“替换为文本”输入中。
> *   然后根据需要替换或全部替换。
> 
> 注意：为换行选择的字符通常显示为**`0a`**.
> 如果文件是 Windows 格式，它可能有不同的值。在这种情况下，您可以随时前往`Edit -> EOL Conversion -> Convert to Unix Format`，并在更换后将其切换回 和`Edit -> EOL Conversion -> Convert to Windows Format`。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-08T17:40:18.700

看来这是一个[常见问题解答](http://notepad-plus.sourceforge.net/uk/newlineFindReplace-HOWTO.php)，提供的解决方案是：

> **没有正则表达式的简单搜索 (Ctrl+H)**
> 
> 您可以打开查看/显示行尾或查看/显示全部，然后选择现在可见的换行符。然后，当您启动命令时，一些与换行符匹配的字符将被粘贴到搜索字段中。与正则表达式模式不同，匹配项将被替换字符串替换。
> 
> 注意 1：如果您使用鼠标选择它们，请从它们之前开始并拖动到下一行的开头。拖到行尾是行不通的。
> 
> 注意 2：您不能自己将它们复制并粘贴到该字段中。
> 
> **不带正则表达式的高级搜索 (Ctrl+R)**
> 
> Ctrl+M 将插入与换行符匹配的内容。它们将被替换字符串替换。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-25T15:31:33.987

在“替换”对话框中，您要将搜索模式设置为“扩展”。正常或正则表达式模式将不起作用。

然后只需找到“\r\n”（或者对于 unix 文件或者对于 mac 格式文件只查找 \n），并将替换设置为您想要的任何内容。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-25T15:53:27.507

我对查找/替换窗口中的 \r\n 正则表达式不太满意。

但是，这适用于 Notepad++ v4.1.2：

1.  使用“查看|显示行尾”菜单启用行尾字符的显示。（回车换行应显示为单个阴影 CRLF“字符”。）

2.  选择一个 CRLF '字符'（将光标放在一个字符的前面，按住 SHIFT 键，然后按一次 RIGHT CURSOR 键）。

3.  将 CRLF 字符复制到剪贴板。

4.  确保您*没有*打开查找或查找/替换对话框。

5.  打开查找/替换对话框。“查找内容”字段显示剪贴板的内容：在这种情况下，CRLF 字符 - 显示为 2 个“框字符”（可能是不可打印的字符？）

6.  确保“正则表达式”选项为 OFF。

现在您应该能够根据需要计算、查找或替换。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-03-28T06:06:18.577

带有 CRLF 的图像

![在此处输入图像描述](https://i.stack.imgur.com/WjBZU.png)

* * *

没有 CRLF 的图像

![在此处输入图像描述](https://i.stack.imgur.com/p1mxh.png)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-12-01T16:43:21.493

我发现它的工作方式是使用“替换”功能，并使用“\n”和“扩展”模式。我正在使用版本 5.8.5。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-05-26T21:28:58.053

在 2013，v6.13 或更高版本中，使用：

菜单*编辑*→ *EOL 转换*→ *Windows 格式*。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T15:26:01.443

假设它具有“正则表达式”搜索，请查找 \r\n。我更喜欢 \r?\n，因为有些文件不使用回车。

编辑：感谢您的反馈，无论是谁投了反对票。我了解到...好吧，什么都没有，因为您没有提供任何反馈。为什么这是错误的？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T16:48:46.593

使用高级搜索选项 ( `Ctrl`+ `R`) 并使用 CRLF ( `Ctrl`+ `M`) 的键盘快捷键插入回车。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-03-27T07:34:34.583

如果您需要进行复杂的正则表达式替换，包括 \r\n，您可以通过三步方法解决限制：

1.  全部替换`\r\n`为标签，比如说`#GO#`→检查“扩展”，替换`\r\n`为`#GO#`
2.  执行您的正则表达式，例如`ICON="*"`从 html 书签中删除多行 → 检查正则表达式，替换`ICON=.[^"]+.> by >`
3.  放回 \r\n → 检查“扩展”，替换`#GO#`为`\r\n`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-01-29T06:54:03.543

转到查看->显示符号->显示所有字符//它对我有用

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-04-11T12:45:54.177

我在记事本++中打开了文件，并在几个步骤中进行了替换：

1.  将所有“\r\n”替换为“\r\n”
2.  将所有“; \r\n”替换为“\r\n”
3.  将所有“\r\n”替换为“”

这会将所有中断放在应有的位置，并删除那些破坏文件的中断。

它对我有用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-03-20T13:06:15.320

进行此设置。菜单->查看->显示符号->取消选中显示行尾

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-01-19T00:40:48.670

我在 NP v6.9 中完全无法做到这一点。我发现在 Msoft Word (2K) 上很容易。

打开文档，转到编辑->替换。

然后在搜索框的底部，单击“更多”，然后找到“特殊”按钮，他们为您提供了一些东西。对于 Dos 样式，我使用了“段落”之一。这是 Windows 中的 cr lf 对。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-10-10T07:45:13.053

**要查找任何类型的换行符序列**，请使用以下正则表达式构造：

```
\R 
```

要查找并选择*连续*的换行符序列，请在:`+`之后添加。`\R``\R+`

确保打开*正则表达式*模式：

[![在此处输入图像描述](https://i.stack.imgur.com/8mhVj.png)](https://i.stack.imgur.com/8mhVj.png)

它匹配：

*   `U+000DU+000A -`CRLF`序列
*   `U+000A`- `LINE FEED`,*低频*
*   `U+000B`- `LINE TABULATION`, *VT*
*   `U+000C`- `FORM FEED`,*法郎*
*   `U+000D`- `CARRIAGE RETURN`, *CR*
*   `U+0085`- `NEXT LINE`, *NEL*
*   `U+2028`-`LINE SEPARATOR`
*   `U+2029`-`PARAGRAPH SEPARATOR`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-02-27T17:46:07.827

要将包含不同行的文档更改为单行，每行在逗号分隔列表中形成一个条目：

1.  `ctrl`+`f`打开搜索/替换器。
2.  单击“替换”选项卡。
3.  用“”填写“查找内容”条目`\r\n`。
4.  `,`用“ ”或“ ”填写“替换为”条目`,` （取决于偏好）。
5.  **取消选中“匹配整个单词”复选框**（避开逻辑的重要部分）。
6.  选中“扩展”单选按钮。
7.  单击“全部替换”按钮。

**这些步骤变成*例如***

> 富吧
> 
> 巴兹
> 
> 巴兹富

**进入：**

> foo bar,bar baz,baz foo

**或：（**取决于偏好）

> foo bar, bar baz, baz foo

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-05-22T08:15:57.400

**也许你可以使用 TextFX 插件**

在 TextFX 中，转到 textfx 编辑 → 删除空白行

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-07-21T19:26:24.820

只需在替换字段中进行查找并替换为空白的 \r，以便所有内容都上升到一行。然后进行查找和替换（在我的情况下是分号）并替换为 ;\n

:) -T&C

# javascript - “this”关键字在函数中如何工作？

> ID：133973
> 
> 赞同：252
> 
> 时间：2008-09-25T15:25:50.960
> 
> 标签：javascript, language-features, language-design

我刚刚在 JavaScript 中遇到了一个有趣的情况。我有一个类，其方法使用对象文字表示法定义多个对象。在这些对象中，`this`正在使用指针。从程序的行为中，我推断出`this`指针指的是调用方法的类，而不是由字面量创建的对象。

这似乎是任意的，尽管这是我期望它工作的方式。这是定义的行为吗？跨浏览器安全吗？是否有任何理由说明为什么它超出了“规范所说的”（例如，它是一些更广泛的设计决策/哲学的结果）？精简代码示例：

```
// inside class definition, itself an object literal, we have this function:
onRender: function() {

    this.menuItems = this.menuItems.concat([
        {
            text: 'Group by Module',
            rptletdiv: this
        },
        {
            text: 'Group by Status',
            rptletdiv: this
        }]);
    // etc
} 
```

* * *

## 回答 #1

> 赞同：564
> 
> 时间：2008-09-25T15:52:39.677

从我的另一篇文章中蚕食，这里比你想知道的还要*多*。

在开始之前，请记住关于 Javascript 的最重要的事情，并在没有意义时对自己重复一遍。Javascript 没有类（ES6`class`是[语法糖](https://stackoverflow.com/a/30783368/2039244)）。如果某些东西看起来像一个类，这是一个聪明的把戏。Javascript 有**对象** 和**函数**。（这不是 100% 准确，函数只是对象，但有时将它们视为独立的事物会有所帮助）

*this*变量附加到函数。每当你调用一个函数时，*它*都会被赋予一个特定的值，这取决于你调用函数的方式。这通常称为调用模式。

在javascript中有四种调用函数的方法。您可以将函数作为*方法*、*函数*、*构造函数*和*apply*调用。

## 作为一种方法

方法是附加到对象的函数

```
var foo = {};
foo.someMethod = function(){
    alert(this);
} 
```

当作为方法调用时，*this*将绑定到函数/方法所属的对象。在此示例中，这将绑定到 foo。

## 作为一个函数

如果你有一个独立的函数，*this*变量将绑定到“全局”对象，几乎总是浏览器上下文中的*窗口*对象。

```
 var foo = function(){
    alert(this);
 }
 foo(); 
```

**这可能是让你绊倒的原因**，但不要难过。许多人认为这是一个糟糕的设计决定。由于回调是作为函数而不是作为方法调用的，这就是为什么您会看到看似不一致的行为。

许多人通过做类似的事情来解决这个问题，嗯，这个

```
var foo = {};
foo.someMethod = function (){
    var that=this;
    function bar(){
        alert(that);
    }
} 
```

您定义一个*指向*this*的*变量。闭包（它自己的一个主题）保留*了它*，所以如果你调用 bar 作为回调，它仍然有一个引用。

注意：在`use strict`模式下，如果用作函数，`this`则不绑定到全局。（它是`undefined`）。

## 作为构造函数

您还可以调用函数作为构造函数。根据您使用的命名约定 (TestObject)，这也**可能是您正在做的事情，也是让您绊倒的事情**。

您使用 new 关键字将函数作为构造函数调用。

```
function Foo(){
    this.confusing = 'hell yeah';
}
var myObject = new Foo(); 
```

当作为构造函数调用时，将创建一个新对象，并将*this*绑定到该对象。同样，如果您有内部函数并且它们被用作回调，您将把它们作为函数调用，并且*this*将绑定到全局对象。使用那个 var that = 这个技巧/模式。

有些人认为constructor/new关键字是Java/传统OOP程序员用来创建类似于类的东西的一种方式。

## 使用 Apply 方法

最后，每个函数都有一个名为“apply”的方法（是的，函数是 Javascript 中的对象）。Apply 可以让你确定*this*的值是什么，还可以让你传入一个参数数组。这是一个无用的例子。

```
function foo(a,b){
    alert(a);
    alert(b);
    alert(this);
}
var args = ['ah','be'];
foo.apply('omg',args); 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-25T22:24:16.897

## 函数调用

函数只是一种对象。

所有 Function 对象都有[call](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/call)和[apply](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/apply)方法，它们执行被调用的 Function 对象。

`this`调用时，这些方法的第一个参数指定在函数执行期间将由关键字引用的对象- 如果它是`null`或`undefined`，则全局对象 ,`window`用于`this`。

因此，调用函数...

```
whereAmI = "window";

function foo()
{
    return "this is " + this.whereAmI + " with " + arguments.length + " + arguments";
} 
```

...带括号 - `foo()`- 等效于`foo.call(undefined)`or `foo.apply(undefined)`，*实际上*`foo.call(window)`与or相同`foo.apply(window)`。

```
>>> foo()
"this is window with 0 arguments"
>>> foo.call()
"this is window with 0 arguments" 
```

附加参数`call`作为参数传递给函数调用，而单个附加参数`apply`可以将函数调用的参数指定为类似数组的对象。

因此，`foo(1, 2, 3)`等价于`foo.call(null, 1, 2, 3)`或`foo.apply(null, [1, 2, 3])`。

```
>>> foo(1, 2, 3)
"this is window with 3 arguments"
>>> foo.apply(null, [1, 2, 3])
"this is window with 3 arguments" 
```

如果函数是对象的属性...

```
var obj =
{
    whereAmI: "obj",
    foo: foo
}; 
```

...通过对象访问对函数的引用并用括号 - `obj.foo()`- 调用它相当于`foo.call(obj)`or `foo.apply(obj)`。

但是，作为对象属性的函数并不“绑定”到这些对象。正如您在`obj`上面的定义中看到的那样，由于函数只是一种对象，它们可以被引用（因此可以通过引用传递给函数调用或通过引用从函数调用返回）。*传递对 Function 的引用时，不会携带有关从*何处传递的附加信息，这就是发生以下情况的原因：

```
>>> baz = obj.foo;
>>> baz();
"this is window with 0 arguments" 
```

对我们的 Function 引用的调用`baz`, 不为调用提供任何上下文，因此它实际上与`baz.call(undefined)`, 所以`this`最终引用`window`。如果我们想`baz`知道它属于`obj`，我们需要在`baz`调用时以某种方式提供该信息，这就是`call`or`apply`和闭包的第一个参数发挥作用的地方。

## 范围链

```
function bind(func, context)
{
    return function()
    {
        func.apply(context, arguments);
    };
} 
```

当一个函数被执行时，它会创建一个新的作用域并引用任何封闭的作用域。在上面的例子中创建匿名函数时，它有一个对创建它的作用域的引用，也就是`bind`'s 作用域。这被称为“关闭”。

```
[global scope (window)] - whereAmI, foo, obj, baz
    |
    [bind scope] - func, context
        |
        [anonymous scope] 
```

当你试图访问一个变量时，这个“作用域链”会被遍历以找到一个具有给定名称的变量——如果当前作用域不包含该变量，你会查看链中的下一个作用域，依此类推，直到你到达全局范围。当匿名函数返回并`bind`完成执行时，匿名函数仍然具有对`bind`' 作用域的引用，因此`bind`' 作用域不会“消失”。

鉴于以上所有内容，您现在应该能够理解以下示例中的作用域是如何工作的，以及为什么在调用具有特定值的“预绑定”周围传递函数的技术在`this`调用时会起作用：

```
>>> baz = bind(obj.foo, obj);
>>> baz(1, 2);
"this is obj with 2 arguments" 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-25T15:38:25.577

> 这是定义的行为吗？跨浏览器安全吗？

是的。是的。

> 有没有任何理由可以解释为什么它是这样的......

的含义`this`很容易推断：

1.  如果`this`在构造函数中使用，并且使用`new`关键字调用该函数，`this`则指将要创建的对象。`this`即使在公共方法中也将继续表示对象。
2.  如果`this`在其他任何地方使用，包括嵌套的*受保护*函数，它指的是全局范围（在浏览器的情况下是窗口对象）。

第二种情况显然是一个设计缺陷，但通过使用闭包很容易解决它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-25T15:43:41.120

在这种情况下，内部`this`绑定到全局对象而不是`this`外部函数的变量。这就是语言的设计方式。

请参阅 Douglas Crockford 的“JavaScript: The Good Parts”以获得很好的解释。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-03-13T12:40:55.007

我找到了一个关于*ECMAScript的很好的教程*

> this 值是与执行上下文相关的特殊对象。因此，它可以被命名为上下文对象（即执行上下文被激活的上下文对象）。

任何对象都可以用作上下文的这个值。

> a this 值是执行上下文的属性，而不是变量对象的属性。

这个特性非常重要，因为与变量相反，这个值从不参与标识符解析过程。即在代码中访问 this 时，它的值直接取自执行上下文，无需任何范围链查找。this 的值在进入上下文时仅确定一次。

在全局上下文中，一个 this 值就是全局对象本身（也就是说，这里的 this 值等于变量对象）

在函数上下文的情况下，每个函数调用中的这个值可能不同

参考[Javascript-the-core](http://dmitrysoshnikov.com/ecmascript/javascript-the-core/)和[Chapter-3-this](http://dmitrysoshnikov.com/ecmascript/chapter-3-this/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-09-29T06:05:40.023

这里的所有答案都非常有帮助，但我仍然很难弄清楚`this`在我的案例中指向什么，这涉及到对象解构。所以我想使用我的代码的简化版本再添加一个答案，

```
let testThis = {
  x: 12,
  y: 20,
  add({ a, b, c }) {
    let d = a + b + c()
    console.log(d)
  },
  test() {
    //the result is NaN
    this.add({
      a: this.x,
      b: this.y,
      c: () => {
        //this here is testThis, NOT the object literal here
        return this.a + this.b 
      },
    })
  },
  test2() {
    //64 as expected
    this.add({
      a: this.x,
      b: this.y,
      c: () => {
        return this.x + this.y
      },
    })
  },
  test3() {
    //NaN
    this.add({
      a: this.x,
      b: this.y,
      c: function () {
        //this here is the global object
        return this.x + this.y 
      },
    })
  },
} 
```

正如这里解释[的 Javascript - 解构对象 - 'this' 设置为全局或未定义，而不是 object](https://stackoverflow.com/questions/41603396/javascript-destructuring-object-this-set-to-global-or-undefined-instead-o)它实际上与对象解构无关，而是如何调用 c()，但在这里不容易看穿它。

[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#description)说“箭头函数表达式最适合非方法函数”，但箭头函数在这里有效。

# .net - GetAsyncKeyState 是否有 .Net 替代品？

> ID：133977
> 
> 赞同：3
> 
> 时间：2008-09-25T15:25:59.087
> 
> 标签：.net, winapi, api, keyboard

在 VB6 中，我使用了对 Windows API **GetAsyncKeyState**的调用来确定用户是否按下了 ESC 键以允许他们退出长时间运行的循环。

```
Declare Function GetAsyncKeyState Lib "user32" (ByVal nVirtKey As Long) As Integer 
```

纯 .NET 中是否存在需要直接调用 API 的等效项？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T15:30:18.047

[您可以从http://pinvoke.net/default.aspx/user32/GetAsyncKeyState.html](http://pinvoke.net/default.aspx/user32/GetAsyncKeyState.html)找到 GetAsyncKeyState 的 P/Invoke 声明

例如，这是 C# 签名：

```
[DllImport("user32.dll")]
static extern short GetAsyncKeyState(int vKey); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T15:56:39.950

根据您所需的用途，有几个选项，包括调用与上述相同的方法）。从控制台应用程序：

```
bool exitLoop = false;
for(int i=0;i<bigNumber && !exitLoop;i++)
{
    // Do Stuff.
    if(Console.KeyAvailable)
    {
        // Read the key and display it (false to hide it)
        ConsoleKeyInfo key = Console.ReadKey(true);
        if(ConsoleKey.Escape == key.Key)
        {
            exitLoop=false;
        }
    }
} 
```

如果您正在处理 Windows 窗体，则每个窗体都有许多关键相关事件，您可以根据需要侦听和处理（简化了大部分逻辑）：

```
public partial class Form1 : Form
{
    private bool exitLoop;
    public Form1()
    {
        InitializeComponent();
        this.KeyUp += new System.Windows.Forms.KeyEventHandler(this.Form1_KeyUp);
    }
    public void doSomething()
    {
        // reset our exit flag:
        this.exitLoop = false;
        System.Threading.ThreadPool.QueueUserWorkItem(new System.Threading.WaitCallback(delegate(object notUsed)
            {
                while (!exitLoop)
                {
                    // Do something
                }
            }));
    }
    private void Form1_KeyUp(object sender, KeyEventArgs e)
    {
        if (Keys.Escape == e.KeyCode)
        {
            e.Handled = true;
            this.exitLoop = true;
        }
    }

} 
```

请注意，这是*非常*简化的——它不处理任何常见的线程问题或类似问题。正如评论中指出的那样，最初的解决方案并没有解决这个问题，我添加了一个快速的小 ThreadPool 调用来线程化后台工作。另请注意，侦听关键事件的问题在于其他控件实际上可能会处理它们，因此您需要确保在正确的控件上注册事件。如果 Windows 窗体应用程序是您前进的方向，您也可以尝试将自己注入到消息循环本身中......

```
public override bool PreProcessMessage(ref Message msg)
{
  // Handle the message or pass it to the default handler...
  base.PreProcessMessage(msg);
} 
```

# sql-server - 适用于 MS SQL Server 的 Visio 模具

> ID：133986
> 
> 赞同：2
> 
> 时间：2008-09-25T15:26:54.530
> 
> 标签：sql-server, visio

有没有人有一套很好的用于 MS SQL Server 的 Visio 模具？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T21:27:54.147

某些版本的 Visio 内置了数据库支持。在 Visio 的 MVP 站点上有几个链接：

新网址： http: [//visio.mvps.org/3rdParty/default.html](http://visio.mvps.org/3rdParty/default.html) 旧网址：http: [//visio.mvps.org/3rdparty.htm](http://visio.mvps.org/3rdparty.htm)

希望这可以帮助！杰夫

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T20:55:04.083

我自己没有尝试过，但在[http://visiotoolbox.com/downloads.aspx?resourceid=1&aid=562有一个](http://visiotoolbox.com/downloads.aspx?resourceid=1&aid=562)

# c - 哪些工具有助于确定给定 C 源代码的圈复杂度

> ID：133987
> 
> 赞同：2
> 
> 时间：2008-09-25T15:27:02.593
> 
> 标签：c, complexity-theory

我想知道可以使用哪种工具来测量 C 源代码的圈复杂度。

我看过其他帖子提出了同样的问题，但我只想知道 C 源代码的特定工具。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T15:31:24.550

[http://www.spinroot.com/static/](http://www.spinroot.com/static/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T15:41:21.967

[Locmetrics](http://www.locmetrics.com/)是一个很好的工具，适用于 C（以及其他），并且会给你 McCabe 圈结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T15:50:18.200

我发现这个工具也是非常有用的 [源监视器](http://www.campwoodsw.com/sourcemonitor.html)

# java - 在 Java 中同步 String 对象

> ID：133988
> 
> 赞同：54
> 
> 时间：2008-09-25T15:27:07.883
> 
> 标签：java, multithreading, synchronization, thread-safety, synchronized

我有一个 web 应用程序，我正在对它进行一些负载/性能测试，特别是在我们预计数百名用户访问同一页面并在此页面上大约每 10 秒刷新一次的功能上。我们发现我们可以使用此功能进行的一个改进领域是将来自 Web 服务的响应缓存一段时间，因为数据没有变化。

在实现了这个基本缓存之后，在进一步的测试中我发现我没有考虑并发线程如何同时访问缓存。我发现在大约 100 毫秒的时间内，大约 50 个线程试图从缓存中获取对象，发现它已经过期，访问 Web 服务以获取数据，然后将对象放回缓存中。

原始代码看起来像这样：

```
private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {

  final String key = "Data-" + email;
  SomeData[] data = (SomeData[]) StaticCache.get(key);

  if (data == null) {
      data = service.getSomeDataForEmail(email);

      StaticCache.set(key, data, CACHE_TIME);
  }
  else {
      logger.debug("getSomeDataForEmail: using cached object");
  }

  return data;
} 
```

因此，为了确保在对象`key`过期时只有一个线程在调用 Web 服务，我认为我需要同步 Cache get/set 操作，并且似乎使用缓存键将是对象的一个​​很好的候选者同步（这样，对电子邮件 b@b.com 的此方法的调用不会被对 a@a.com 的方法调用阻止）。

我将方法更新为如下所示：

```
private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {

  SomeData[] data = null;
  final String key = "Data-" + email;

  synchronized(key) {      
    data =(SomeData[]) StaticCache.get(key);

    if (data == null) {
        data = service.getSomeDataForEmail(email);
        StaticCache.set(key, data, CACHE_TIME);
    }
    else {
      logger.debug("getSomeDataForEmail: using cached object");
    }
  }

  return data;
} 
```

我还为“同步块之前”、“同步块内部”、“即将离开同步块”和“同步块之后”等内容添加了日志记录行，这样我就可以确定我是否有效地同步了 get/set 操作。

然而，这似乎没有奏效。我的测试日志的输出如下：

```
(log output is 'threadname' 'logger name' 'message')  
http-80-Processor253 jsp.view-page - getSomeDataForEmail: about to enter synchronization block  
http-80-Processor253 jsp.view-page - getSomeDataForEmail: inside synchronization block  
http-80-Processor253 cache.StaticCache - get: object at key [SomeData-test@test.com] has expired  
http-80-Processor253 cache.StaticCache - get: key [SomeData-test@test.com] returning value [null]  
http-80-Processor263 jsp.view-page - getSomeDataForEmail: about to enter synchronization block  
http-80-Processor263 jsp.view-page - getSomeDataForEmail: inside synchronization block  
http-80-Processor263 cache.StaticCache - get: object at key [SomeData-test@test.com] has expired  
http-80-Processor263 cache.StaticCache - get: key [SomeData-test@test.com] returning value [null]  
http-80-Processor131 jsp.view-page - getSomeDataForEmail: about to enter synchronization block  
http-80-Processor131 jsp.view-page - getSomeDataForEmail: inside synchronization block  
http-80-Processor131 cache.StaticCache - get: object at key [SomeData-test@test.com] has expired  
http-80-Processor131 cache.StaticCache - get: key [SomeData-test@test.com] returning value [null]  
http-80-Processor104 jsp.view-page - getSomeDataForEmail: inside synchronization block  
http-80-Processor104 cache.StaticCache - get: object at key [SomeData-test@test.com] has expired  
http-80-Processor104 cache.StaticCache - get: key [SomeData-test@test.com] returning value [null]  
http-80-Processor252 jsp.view-page - getSomeDataForEmail: about to enter synchronization block  
http-80-Processor283 jsp.view-page - getSomeDataForEmail: about to enter synchronization block  
http-80-Processor2 jsp.view-page - getSomeDataForEmail: about to enter synchronization block  
http-80-Processor2 jsp.view-page - getSomeDataForEmail: inside synchronization block 
```

我希望一次只看到一个线程进入/退出围绕 get/set 操作的同步块。

在 String 对象上同步是否存在问题？我认为缓存键是一个不错的选择，因为它是操作所独有的，即使`final String key`在方法中声明了，我认为每个线程都会获得对*同一个对象*的引用，因此会对此进行同步单个对象。

我在这里做错了什么？

**更新**：进一步查看日志后，似乎具有相同同步逻辑的方法，其中密钥始终相同，例如

```
final String key = "blah";
...
synchronized(key) { ... 
```

不要表现出相同的并发问题 - 一次只有一个线程进入块。

**更新2**：感谢大家的帮助！我接受了关于`intern()`ing Strings 的第一个答案，这解决了我最初的问题 - 多个线程正在进入我认为它们不应该进入的同步块，因为`key`' 具有相同的值。

正如其他人所指出的那样，`intern()`出于这样的目的并在这些字符串上同步确实是一个坏主意 - 当对 webapp 运行 JMeter 测试以模拟预期负载时，我看到使用的堆大小增长到近 1GB不到20分钟。

目前我正在使用仅同步整个方法的简单解决方案 - 但我**真的很**喜欢 martinprobst 和 MBCook 提供的代码示例，但是因为我`getData()`目前在这个类中有大约 7 个类似的方法（因为它需要大约 7 个不同的数据来自 Web 服务），我不想为每个方法添加关于获取和释放锁的几乎重复的逻辑。但这对于未来的使用绝对是非常非常有价值的信息。我认为这些最终是关于如何最好地使这种线程安全的操作的正确答案，如果可以的话，我会给这些答案更多的投票！

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-25T15:30:41.650

在没有让我的大脑完全投入使用的情况下，快速浏览一下您所说的内容，您似乎需要对您的字符串进行 intern()：

```
final String firstkey = "Data-" + email;
final String key = firstkey.intern(); 
```

否则，具有相同值的两个字符串不一定是相同的对象。

请注意，这可能会引入新的争论点，因为在 VM 的深处，intern() 可能必须获取锁。我不知道现代虚拟机在这个领域会是什么样子，但希望它们能得到极大的优化。

我假设您知道 StaticCache 仍然需要是线程安全的。但是与调用 getSomeDataForEmail 时锁定缓存而不仅仅是键的情况相比，那里的争用应该很小。

**对问题更新的回应**：

我认为这是因为字符串文字总是产生相同的对象。Dave Costa 在评论中指出它甚至比这更好：文字总是产生规范表示。因此，程序中任何地方具有相同值的所有字符串文字都会产生相同的对象。

**编辑**

其他人指出，**在实习生字符串上同步实际上是一个非常糟糕的主意**- 部分原因是允许创建实习生字符串导致它们永久存在，部分原因是如果程序中任何地方的不止一位代码在实习生字符串上同步，您在这些代码位之间存在依赖关系，并且可能无法防止死锁或其他错误。

在我键入时，正在其他答案中开发通过为每个键字符串存储一个锁定对象来避免这种情况的策略。

这是另一种选择 - 它仍然使用单个锁，但我们知道无论如何我们都需要其中一个用于缓存，而且您说的是 50 个线程，而不是 5000 个，所以这可能不是致命的。我还假设这里的性能瓶颈是在 DoSlowThing() 中缓慢阻塞 I/O，因此将极大地受益于不被序列化。如果这不是瓶颈，那么：

*   如果 CPU 很忙，那么这种方法可能还不够，您需要另一种方法。
*   如果 CPU 不忙，并且访问服务器不是瓶颈，那么这种方法是矫枉过正的，你不妨忘记这个和 per-key 锁定，在整个操作周围放置一个大的同步（静态缓存），然后做这是简单的方法。

显然，这种方法在使用前需要进行可扩展性测试——我不保证。

此代码不需要 StaticCache 是同步的或线程安全的。如果任何其他代码（例如计划清理旧数据）触及缓存，则需要重新访问。

IN_PROGRESS 是一个虚拟值 - 不完全干净，但代码很简单，它节省了两个哈希表。它不处理 InterruptedException 因为我不知道您的应用在这种情况下想要做什么。此外，如果 DoSlowThing() 对于给定的键始终失败，则此代码本身并不完全优雅，因为通过的每个线程都会重试它。由于我不知道失败标准是什么，以及它们可能是临时的还是永久的，所以我也不处理这个，我只是确保线程不会永远阻塞。在实践中，您可能希望在缓存中放置一个指示“不可用”的数据值，这可能是有原因的，以及何时重试的超时。

```
// do not attempt double-check locking here. I mean it.
synchronized(StaticObject) {
    data = StaticCache.get(key);
    while (data == IN_PROGRESS) {
        // another thread is getting the data
        StaticObject.wait();
        data = StaticCache.get(key);
    }
    if (data == null) {
        // we must get the data
        StaticCache.put(key, IN_PROGRESS, TIME_MAX_VALUE);
    }
}
if (data == null) {
    // we must get the data
    try {
        data = server.DoSlowThing(key);
    } finally {
        synchronized(StaticObject) {
            // WARNING: failure here is fatal, and must be allowed to terminate
            // the app or else waiters will be left forever. Choose a suitable
            // collection type in which replacing the value for a key is guaranteed.
            StaticCache.put(key, data, CURRENT_TIME);
            StaticObject.notifyAll();
        }
    }
} 
```

每次将任何内容添加到缓存时，所有线程都会唤醒并检查缓存（无论它们使用什么键），因此可以使用较少争议的算法获得更好的性能。但是，大部分工作将在 I/O 上大量空闲 CPU 时间阻塞期间进行，因此这可能不是问题。

如果您为缓存及其关联的锁、它返回的数据、IN_PROGRESS 虚拟对象以及要执行的慢速操作定义合适的抽象，则此代码可以与多个缓存一起使用。将整个事情滚动到缓存上的方法中可能不是一个坏主意。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-25T15:53:37.210

在实习生字符串上同步可能根本不是一个好主意 - 通过实习，字符串变成一个全局对象，如果你在应用程序的不同部分同步相同的实习字符串，你可能会变得非常奇怪和基本上无法调试的同步问题，例如死锁。这似乎不太可能，但当它发生时，你真的被搞砸了。作为一般规则，仅在您绝对确定模块之外的任何代码都不会锁定它的本地对象上进行同步。

在您的情况下，您可以使用同步哈希表来存储密钥的锁定对象。

例如：

```
Object data = StaticCache.get(key, ...);
if (data == null) {
  Object lock = lockTable.get(key);
  if (lock == null) {
    // we're the only one looking for this
    lock = new Object();
    synchronized(lock) {
      lockTable.put(key, lock);
      // get stuff
      lockTable.remove(key);
    }
  } else {
    synchronized(lock) {
      // just to wait for the updater
    }
    data = StaticCache.get(key);
  }
} else {
  // use from cache
} 
```

这段代码有一个竞争条件，两个线程可能将一个对象依次放入锁表中。然而，这应该不是问题，因为那时您只有一个线程调用 Web 服务并更新缓存，这应该不是问题。

如果您在一段时间后使缓存无效，则应在从缓存中检索数据后再次检查数据是否为空，在 lock != null 情况下。

或者，更容易的是，您可以使整个缓存查找方法（“getSomeDataByEmail”）同步。这意味着所有线程在访问缓存时都必须同步，这可能是一个性能问题。但和往常一样，先试试这个简单的解决方案，看看它是否真的有问题！在许多情况下，它不应该是这样，因为您可能花费更多时间来处理结果而不是同步。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-25T16:17:38.197

字符串*不*适合同步。如果您必须在字符串 ID 上同步，可以通过使用字符串创建互斥锁来完成（请参阅“[在 ID 上同步](http://illegalargumentexception.blogspot.com/2008/04/java-synchronizing-on-transient-id.html)”）。该算法的成本是否值得取决于调用您的服务是否涉及任何重要的 I/O。

还：

*   我希望*StaticCache.get()*和*set()*方法是线程安全的。
*   [String.intern()](http://java.sun.com/javase/6/docs/api/java/lang/String.html#intern())是有代价的（因 VM 实现而异），应谨慎使用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-11-11T22:06:08.650

这是一个安全的简短 Java 8 解决方案，它使用专用锁对象的映射进行同步：

```
private static final Map<String, Object> keyLocks = new ConcurrentHashMap<>();

private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {
    final String key = "Data-" + email;
    synchronized (keyLocks.computeIfAbsent(key, k -> new Object())) {
        SomeData[] data = StaticCache.get(key);
        if (data == null) {
            data = service.getSomeDataForEmail(email);
            StaticCache.set(key, data);
        }
    }
    return data;
} 
```

它的缺点是键和锁对象会永远保留在地图中。

这可以像这样解决：

```
private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {
    final String key = "Data-" + email;
    synchronized (keyLocks.computeIfAbsent(key, k -> new Object())) {
        try {
            SomeData[] data = StaticCache.get(key);
            if (data == null) {
                data = service.getSomeDataForEmail(email);
                StaticCache.set(key, data);
            }
        } finally {
            keyLocks.remove(key); // vulnerable to race-conditions
        }
    }
    return data;
} 
```

但是随后流行的键将不断地重新插入映射中，并重新分配锁定对象。

**更新**：当两个线程同时进入同一个键但具有不同锁的同步部分时，这就留下了竞争条件的可能性。

[所以使用过期的 Guava Cache](https://github.com/google/guava/wiki/CachesExplained)可能更安全有效：

```
private static final LoadingCache<String, Object> keyLocks = CacheBuilder.newBuilder()
        .expireAfterAccess(10, TimeUnit.MINUTES) // max lock time ever expected
        .build(CacheLoader.from(Object::new));

private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {
    final String key = "Data-" + email;
    synchronized (keyLocks.getUnchecked(key)) {
        SomeData[] data = StaticCache.get(key);
        if (data == null) {
            data = service.getSomeDataForEmail(email);
            StaticCache.set(key, data);
        }
    }
    return data;
} 
```

请注意，这里假设它`StaticCache`是线程安全的，并且不会因不同键的并发读取和写入而受到影响。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-25T16:04:40.070

其他人建议实习字符串，这会奏效。

问题是 Java 必须保留被实习的字符串。有人告诉我，即使您没有持有引用，它也会这样做，因为下次有人使用该字符串时该值需要相同。这意味着实习所有字符串可能会开始占用内存，这对于您所描述的负载可能是一个大问题。

我已经看到了两种解决方案：

**您可以在另一个对象上同步**

代替电子邮件，创建一个包含电子邮件的对象（例如用户对象），该对象将电子邮件的值作为变量保存。如果您已经有另一个代表该人的对象（假设您已经根据他们的电子邮件从数据库中提取了某些内容），您可以使用它。通过实现 equals 方法和 hashcode 方法，您可以确保 Java 在执行静态 cache.contains() 以确定数据是否已经在缓存中时认为对象相同（您必须在缓存上同步）。

实际上，您可以保留第二个 Map 以锁定对象。像这样的东西：

```
Map<String, Object> emailLocks = new HashMap<String, Object>();

Object lock = null;

synchronized (emailLocks) {
    lock = emailLocks.get(emailAddress);

    if (lock == null) {
        lock = new Object();
        emailLocks.put(emailAddress, lock);
    }
}

synchronized (lock) {
    // See if this email is in the cache
    // If so, serve that
    // If not, generate the data

    // Since each of this person's threads synchronizes on this, they won't run
    // over eachother. Since this lock is only for this person, it won't effect
    // other people. The other synchronized block (on emailLocks) is small enough
    // it shouldn't cause a performance problem.
} 
```

这将防止在同一个电子邮件地址上同时进行 15 次提取。您需要一些东西来防止太多条目出现在 emailLocks 映射中。使用来自 Apache Commons 的[LRUMap](http://commons.apache.org/collections/apidocs/org/apache/commons/collections/map/LRUMap.html)就可以了。

这将需要一些调整，但它可能会解决您的问题。

**使用不同的密钥**

如果您愿意忍受可能的错误（我不知道这有多重要），您可以使用字符串的哈希码作为键。int 不需要被实习。

**概括**

我希望这有帮助。线程很有趣，不是吗？您还可以使用会话设置一个值，意思是“我已经在努力寻找这个”，并检查第二个（第三个，第 N 个）线程是否需要尝试创建或只是等待结果显示在缓存中。我想我有三个建议。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-27T17:26:01.847

您可以使用 1.5 并发实用程序来提供一个缓存，旨在允许多个并发访问和单点添加（即只有一个线程执行昂贵的对象“创建”）：

```
 private ConcurrentMap<String, Future<SomeData[]> cache;
 private SomeData[] getSomeDataByEmail(final WebServiceInterface service, final String email) throws Exception {

  final String key = "Data-" + email;
  Callable<SomeData[]> call = new Callable<SomeData[]>() {
      public SomeData[] call() {
          return service.getSomeDataForEmail(email);
      }
  }
  FutureTask<SomeData[]> ft; ;
  Future<SomeData[]> f = cache.putIfAbsent(key, ft= new FutureTask<SomeData[]>(call)); //atomic
  if (f == null) { //this means that the cache had no mapping for the key
      f = ft;
      ft.run();
  }
  return f.get(); //wait on the result being available if it is being calculated in another thread
} 
```

显然，这不会像您想要的那样处理异常，并且缓存没有内置的驱逐。也许您可以将其用作更改 StaticCache 类的基础。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-08T08:48:10.257

使用不错的缓存框架，例如[ehcache](http://ehcache.sourceforge.net/)。

实现一个好的缓存并不像某些人认为的那么容易。

关于 String.intern() 是内存泄漏源的评论，这实际上是不正确的。内部字符串**是**垃圾收集的，它可能需要更长时间，因为在某些 JVM（SUN）上，它们存储在 Perm 空间中，只有完整的 GC 才会触及。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T15:39:07.557

来电：

```
 final String key = "Data-" + email; 
```

每次调用该方法时都会创建一个新对象。因为该对象是您用来锁定的对象，并且每次调用此方法都会创建一个新对象，所以您实际上并没有根据密钥同步对映射的访问。

这进一步解释了您的编辑。当您有一个静态字符串时，它将起作用。

使用 intern() 解决了这个问题，因为它从 String 类保存的内部池中返回字符串，这确保如果两个字符串相等，将使用池中的一个。看

[http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#intern()](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#intern())

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T15:39:28.570

您的主要问题不仅仅是可能存在多个具有相同值的 String 实例。主要问题是您只需要一个监视器来同步访问 StaticCache 对象。否则，多个线程最终可能会同时修改 StaticCache（尽管在不同的键下），这很可能不支持并发修改。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-05-11T18:31:56.307

这个问题在我看来有点过于宽泛，因此它引发了同样广泛的答案。因此，我将尝试回答我被重定向[的问题，不幸的是，该问题已被关闭为重复项。](https://stackoverflow.com/questions/7555826/synchronize-on-value-not-object "同步值，而不是对象")

```
public class ValueLock<T> {

    private Lock lock = new ReentrantLock();
    private Map<T, Condition> conditions  = new HashMap<T, Condition>();

    public void lock(T t){
        lock.lock();
        try {
            while (conditions.containsKey(t)){
                conditions.get(t).awaitUninterruptibly();
            }
            conditions.put(t, lock.newCondition());
        } finally {
            lock.unlock();
        }
    }

    public void unlock(T t){
        lock.lock();
        try {
            Condition condition = conditions.get(t);
            if (condition == null)
                throw new IllegalStateException();// possibly an attempt to release what wasn't acquired
            conditions.remove(t);
            condition.signalAll();
        } finally {
            lock.unlock();
        }
    } 
```

在（外部）`lock`操作时，获取（内部）锁以在短时间内获得对映射的独占访问权，如果对应对象已经在映射中，则当前线程将等待，否则将 new`Condition`放入map，释放（内部）锁并继续，并且（外部）锁被认为已获得。（外部）`unlock`操作，首先获取（内部）锁，将发出信号`Condition`，然后从地图中移除对象。

该类不使用并发版本`Map`，因为对它的每次访问都由单个（内部）锁保护。

请注意，`lock()`该类方法的语义与 的不同，没有配对`ReentrantLock.lock()`的重复`lock()`调用`unlock()`将无限期挂起当前线程。

可能适用于这种情况的使用示例，OP 描述

```
 ValueLock<String> lock = new ValueLock<String>();
    // ... share the lock   
    String email = "...";
    try {
        lock.lock(email);
        //... 
    } finally {
        lock.unlock(email);
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-08-22T19:13:46.057

这有点晚了，但这里有很多不正确的代码。

在这个例子中：

```
private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {

  SomeData[] data = null;
  final String key = "Data-" + email;

  synchronized(key) {      
    data =(SomeData[]) StaticCache.get(key);

    if (data == null) {
        data = service.getSomeDataForEmail(email);
        StaticCache.set(key, data, CACHE_TIME);
    }
    else {
      logger.debug("getSomeDataForEmail: using cached object");
    }
  }

  return data;
} 
```

同步范围不正确。对于支持 get/put API 的静态缓存，至少应该围绕 get 和 getIfAbsentPut 类型操作进行同步，以便安全访问缓存。同步的范围将是缓存本身。

如果必须对数据元素本身进行更新，则会增加一个额外的同步层，该层应该在单个数据元素上。

SynchronizedMap 可用于代替显式同步，但仍需注意。如果使用了错误的 API（get 和 put 而不是 putIfAbsent），那么即使使用了同步映射，操作也不会进行必要的同步。注意使用 putIfAbsent 引入的复杂性：要么，即使在不需要 put 值的情况下也必须计算它（因为在检查缓存内容之前，put 无法知道是否需要 put 值），或者需要小心使用委托（例如，使用 Future，它有效，但有点不匹配；见下文），如果需要，看跌值是按需获得的。

Futures 的使用是可能的，但看起来相当尴尬，而且可能有点过度设计。Future API 是异步操作的核心，特别是对于可能无法立即完成的操作。涉及 Future 很可能会增加一层线程创建——额外的可能是不必要的复杂性。

将 Future 用于此类操作的主要问题是 Future 本质上与多线程相关联。在不需要新线程时使用 Future 意味着忽略 Future 的许多机制，使其成为用于此用途的过于繁重的 API。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-08-27T10:16:13.657

**2019 年最新更新，**

如果您正在寻找**在 JAVA 中实现同步的新方法**，那么这个答案适合您。

[![在此处输入图像描述](https://i.stack.imgur.com/tZVvW.png)](https://i.stack.imgur.com/tZVvW.png)

我发现了 Anatoliy Korovin 的这篇很棒的博客，这将帮助您深入了解同步。

[如何在 Java 中通过对象的值来同步块](https://dzone.com/articles/synchronized-by-the-value-of-the-object-in-java)。

**这帮助我希望新的开发人员也会发现这很有用。**

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-25T15:59:34.013

为什么不只呈现一个静态 html 页面，该页面会提供给用户并每 x 分钟重新生成一次？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-25T19:06:59.477

如果您不需要它，我还建议完全摆脱字符串连接。

```
final String key = "Data-" + email; 
```

缓存中是否还有其他事物/对象类型使用您在密钥开头需要额外的“数据”的电子邮件地址？

如果没有，我就这么做

```
final String key = email; 
```

你也避免了所有额外的字符串创建。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-26T00:16:14.823

如果其他人有类似的问题，下面的代码可以工作，据我所知：

```
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.atomic.AtomicInteger;
import java.util.function.Supplier;

public class KeySynchronizer<T> {

    private Map<T, CounterLock> locks = new ConcurrentHashMap<>();

    public <U> U synchronize(T key, Supplier<U> supplier) {
        CounterLock lock = locks.compute(key, (k, v) -> 
                v == null ? new CounterLock() : v.increment());
        synchronized (lock) {
            try {
                return supplier.get();
            } finally {
                if (lock.decrement() == 0) {
                    // Only removes if key still points to the same value,
                    // to avoid issue described below.
                    locks.remove(key, lock);
                }
            }
        }
    }

    private static final class CounterLock {

        private AtomicInteger remaining = new AtomicInteger(1);

        private CounterLock increment() {
            // Returning a new CounterLock object if remaining = 0 to ensure that
            // the lock is not removed in step 5 of the following execution sequence:
            // 1) Thread 1 obtains a new CounterLock object from locks.compute (after evaluating "v == null" to true)
            // 2) Thread 2 evaluates "v == null" to false in locks.compute
            // 3) Thread 1 calls lock.decrement() which sets remaining = 0
            // 4) Thread 2 calls v.increment() in locks.compute
            // 5) Thread 1 calls locks.remove(key, lock)
            return remaining.getAndIncrement() == 0 ? new CounterLock() : this;
        }

        private int decrement() {
            return remaining.decrementAndGet();
        }
    }
} 
```

在 OP 的情况下，它将像这样使用：

```
private KeySynchronizer<String> keySynchronizer = new KeySynchronizer<>();

private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {
    String key = "Data-" + email;
    return keySynchronizer.synchronize(key, () -> {
        SomeData[] existing = (SomeData[]) StaticCache.get(key);
        if (existing == null) {
            SomeData[] data = service.getSomeDataForEmail(email);
            StaticCache.set(key, data, CACHE_TIME);
            return data;
        }
        logger.debug("getSomeDataForEmail: using cached object");
        return existing;
    });
} 
```

如果同步代码没有返回任何内容，则可以这样编写同步方法：

```
public void synchronize(T key, Runnable runnable) {
    CounterLock lock = locks.compute(key, (k, v) -> 
            v == null ? new CounterLock() : v.increment());
    synchronized (lock) {
        try {
            runnable.run();
        } finally {
            if (lock.decrement() == 0) {
                // Only removes if key still points to the same value,
                // to avoid issue described below.
                locks.remove(key, lock);
            }
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-05-27T07:18:08.897

我添加了一个小锁类，可以锁定/同步任何键，包括字符串。

请参阅 Java 8、Java 6 的实现和一个小测试。

爪哇 8：

```
public class DynamicKeyLock<T> implements Lock
{
    private final static ConcurrentHashMap<Object, LockAndCounter> locksMap = new ConcurrentHashMap<>();

    private final T key;

    public DynamicKeyLock(T lockKey)
    {
        this.key = lockKey;
    }

    private static class LockAndCounter
    {
        private final Lock lock = new ReentrantLock();
        private final AtomicInteger counter = new AtomicInteger(0);
    }

    private LockAndCounter getLock()
    {
        return locksMap.compute(key, (key, lockAndCounterInner) ->
        {
            if (lockAndCounterInner == null) {
                lockAndCounterInner = new LockAndCounter();
            }
            lockAndCounterInner.counter.incrementAndGet();
            return lockAndCounterInner;
        });
    }

    private void cleanupLock(LockAndCounter lockAndCounterOuter)
    {
        if (lockAndCounterOuter.counter.decrementAndGet() == 0)
        {
            locksMap.compute(key, (key, lockAndCounterInner) ->
            {
                if (lockAndCounterInner == null || lockAndCounterInner.counter.get() == 0) {
                    return null;
                }
                return lockAndCounterInner;
            });
        }
    }

    @Override
    public void lock()
    {
        LockAndCounter lockAndCounter = getLock();

        lockAndCounter.lock.lock();
    }

    @Override
    public void unlock()
    {
        LockAndCounter lockAndCounter = locksMap.get(key);
        lockAndCounter.lock.unlock();

        cleanupLock(lockAndCounter);
    }

    @Override
    public void lockInterruptibly() throws InterruptedException
    {
        LockAndCounter lockAndCounter = getLock();

        try
        {
            lockAndCounter.lock.lockInterruptibly();
        }
        catch (InterruptedException e)
        {
            cleanupLock(lockAndCounter);
            throw e;
        }
    }

    @Override
    public boolean tryLock()
    {
        LockAndCounter lockAndCounter = getLock();

        boolean acquired = lockAndCounter.lock.tryLock();

        if (!acquired)
        {
            cleanupLock(lockAndCounter);
        }

        return acquired;
    }

    @Override
    public boolean tryLock(long time, TimeUnit unit) throws InterruptedException
    {
        LockAndCounter lockAndCounter = getLock();

        boolean acquired;
        try
        {
            acquired = lockAndCounter.lock.tryLock(time, unit);
        }
        catch (InterruptedException e)
        {
            cleanupLock(lockAndCounter);
            throw e;
        }

        if (!acquired)
        {
            cleanupLock(lockAndCounter);
        }

        return acquired;
    }

    @Override
    public Condition newCondition()
    {
        LockAndCounter lockAndCounter = locksMap.get(key);

        return lockAndCounter.lock.newCondition();
    }
} 
```

爪哇 6：

公共类 DynamicKeyLock 实现 Lock { private final static ConcurrentHashMap locksMap = new ConcurrentHashMap(); 私人最终 T 密钥；

```
 public DynamicKeyLock(T lockKey) {
        this.key = lockKey;
    }

    private static class LockAndCounter {
        private final Lock lock = new ReentrantLock();
        private final AtomicInteger counter = new AtomicInteger(0);
    }

    private LockAndCounter getLock()
    {
        while (true) // Try to init lock
        {
            LockAndCounter lockAndCounter = locksMap.get(key);

            if (lockAndCounter == null)
            {
                LockAndCounter newLock = new LockAndCounter();
                lockAndCounter = locksMap.putIfAbsent(key, newLock);

                if (lockAndCounter == null)
                {
                    lockAndCounter = newLock;
                }
            }

            lockAndCounter.counter.incrementAndGet();

            synchronized (lockAndCounter)
            {
                LockAndCounter lastLockAndCounter = locksMap.get(key);
                if (lockAndCounter == lastLockAndCounter)
                {
                    return lockAndCounter;
                }
                // else some other thread beat us to it, thus try again.
            }
        }
    }

    private void cleanupLock(LockAndCounter lockAndCounter)
    {
        if (lockAndCounter.counter.decrementAndGet() == 0)
        {
            synchronized (lockAndCounter)
            {
                if (lockAndCounter.counter.get() == 0)
                {
                    locksMap.remove(key);
                }
            }
        }
    }

    @Override
    public void lock()
    {
        LockAndCounter lockAndCounter = getLock();

        lockAndCounter.lock.lock();
    }

    @Override
    public void unlock()
    {
        LockAndCounter lockAndCounter = locksMap.get(key);
        lockAndCounter.lock.unlock();

        cleanupLock(lockAndCounter);
    }

    @Override
    public void lockInterruptibly() throws InterruptedException
    {
        LockAndCounter lockAndCounter = getLock();

        try
        {
            lockAndCounter.lock.lockInterruptibly();
        }
        catch (InterruptedException e)
        {
            cleanupLock(lockAndCounter);
            throw e;
        }
    }

    @Override
    public boolean tryLock()
    {
        LockAndCounter lockAndCounter = getLock();

        boolean acquired = lockAndCounter.lock.tryLock();

        if (!acquired)
        {
            cleanupLock(lockAndCounter);
        }

        return acquired;
    }

    @Override
    public boolean tryLock(long time, TimeUnit unit) throws InterruptedException
    {
        LockAndCounter lockAndCounter = getLock();

        boolean acquired;
        try
        {
            acquired = lockAndCounter.lock.tryLock(time, unit);
        }
        catch (InterruptedException e)
        {
            cleanupLock(lockAndCounter);
            throw e;
        }

        if (!acquired)
        {
            cleanupLock(lockAndCounter);
        }

        return acquired;
    }

    @Override
    public Condition newCondition()
    {
        LockAndCounter lockAndCounter = locksMap.get(key);

        return lockAndCounter.lock.newCondition();
    }
} 
```

测试：

```
public class DynamicKeyLockTest
{
    @Test
    public void testDifferentKeysDontLock() throws InterruptedException
    {
        DynamicKeyLock<Object> lock = new DynamicKeyLock<>(new Object());
        lock.lock();
        AtomicBoolean anotherThreadWasExecuted = new AtomicBoolean(false);
        try
        {
            new Thread(() ->
            {
                DynamicKeyLock<Object> anotherLock = new DynamicKeyLock<>(new Object());
                anotherLock.lock();
                try
                {
                    anotherThreadWasExecuted.set(true);
                }
                finally
                {
                    anotherLock.unlock();
                }
            }).start();
            Thread.sleep(100);
        }
        finally
        {
            Assert.assertTrue(anotherThreadWasExecuted.get());
            lock.unlock();
        }
    }

    @Test
    public void testSameKeysLock() throws InterruptedException
    {
        Object key = new Object();
        DynamicKeyLock<Object> lock = new DynamicKeyLock<>(key);
        lock.lock();
        AtomicBoolean anotherThreadWasExecuted = new AtomicBoolean(false);
        try
        {
            new Thread(() ->
            {
                DynamicKeyLock<Object> anotherLock = new DynamicKeyLock<>(key);
                anotherLock.lock();
                try
                {
                    anotherThreadWasExecuted.set(true);
                }
                finally
                {
                    anotherLock.unlock();
                }
            }).start();
            Thread.sleep(100);
        }
        finally
        {
            Assert.assertFalse(anotherThreadWasExecuted.get());
            lock.unlock();
        }
    }
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-06-20T23:08:02.680

在你的情况下，你可以使用这样的东西（这不会泄漏任何内存）：

```
private Synchronizer<String> synchronizer = new Synchronizer();

private SomeData[] getSomeDataByEmail(WebServiceInterface service, String email) {
    String key = "Data-" + email;

    return synchronizer.synchronizeOn(key, () -> {

        SomeData[] data = (SomeData[]) StaticCache.get(key);
        if (data == null) {
            data = service.getSomeDataForEmail(email);
            StaticCache.set(key, data, CACHE_TIME);
        } else {
          logger.debug("getSomeDataForEmail: using cached object");
        }
        return data;

    });
} 
```

要使用它，您只需添加一个依赖项：

```
compile 'com.github.matejtymes:javafixes:1.3.0' 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-10-07T07:48:16.620

您应该非常小心地使用具有同步的短期对象。每个 Java 对象都有一个附加的监视器，默认情况下这个监视器是放气的；但是，如果 2 个线程争用获取监视器，监视器就会膨胀。如果该对象将长期存在，这不是问题。但是，如果对象的生命周期很短，那么清理这个膨胀的监视器可能会严重影响 GC 时间（因此延迟更高，吞吐量降低）。甚至可能很难发现 GC 时间，因为它并不总是被列出。

如果您确实想要同步，您可以使用 java.util.concurrent.Lock。或者使用手动制作的条带锁并将字符串的哈希用作该条带锁的索引。你保留这个带状锁，这样你就不会遇到 GC 问题。

所以是这样的：

```
static final Object[] locks = newLockArray();

Object lock = locks[hashToIndex(key.hashcode(),locks.length];
synchronized(lock){
       ....
}

int hashToIndex(int hash, int length) {
    if (hash == Integer.MIN_VALUE return 0;
    return abs(hash) % length;
} 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2016-10-12T02:33:27.700

在字符串对象上同步的其他方式：

```
String cacheKey = ...;

    Object obj = cache.get(cacheKey)

    if(obj==null){
    synchronized (Integer.valueOf(Math.abs(cacheKey.hashCode()) % 127)){
          obj = cache.get(cacheKey)
         if(obj==null){
             //some cal obtain obj value,and put into cache
        }
    }
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2019-03-06T18:18:05.453

如果您可以合理地保证字符串值在您的系统中是唯一的，那么您可以安全地使用 String.intern 进行同步。UUIDS 是解决这个问题的好方法。您可以通过缓存、映射或什至将 uuid 存储为实体对象上的字段，将 UUID 与您的实际字符串键相关联。

```
 @Service   
    public class MySyncService{

      public Map<String, String> lockMap=new HashMap<String, String>();

      public void syncMethod(String email) {

        String lock = lockMap.get(email);
        if(lock==null) {
            lock = UUID.randomUUID().toString();
            lockMap.put(email, lock);
        }   

        synchronized(lock.intern()) {
                //do your sync code here
        }
    } 
```

# java - “链接 javax/xml/namespace/QName 类时违反加载程序约束”来自 Oracle 10g 上的 webapp

> ID：133993
> 
> 赞同：5
> 
> 时间：2008-09-25T15:28:00.547
> 
> 标签：java, oracle, oracle10g, jaxb, classpath

我们有一个 Web 应用程序，可以部署在许多应用程序服务器上，包括 Oracle 10g。然而，在那个平台上，我们遇到了类路径问题。webapp 使用 JAXB 2，但 Oracle 10g 附带 JAXB 1，这会导致错误。为了解决这些问题，我们将 Oracle 配置为首选 Web 应用程序中的类，但现在我们在尝试实例化 JAXB 上下文时遇到上述错误。

查找“违反加载器约束”异常 - 当已加载一个类加载器的类尝试访问同一包中的包私有但由不同的类加载器加载的内容时，似乎会抛出该异常。我已经尝试在我们的 webapp 中删除任何包含 javax.xml.namespace.QName 的 jar，并验证它是被拾取的 Oracle 中包含的实例，但错误仍然存​​在。有任何想法吗？

（这是关于 10g 和 JAXB 2的[早期问题](https://stackoverflow.com/questions/132409/jaxb-2-in-an-oracle-10g-webapp)的后续问题。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T17:27:16.423

这个类是 WS Java 库的一半。从多个类加载器加载它并稍后比较它们真的很容易，从而导致 LinkageError。

跟踪此问题的一种有效（但大锤）技术是从 Java 源修改 Classloader 以转储该特定类在加载时从哪个 jar 加载，然后在您的引导类路径之前添加修改后的版本：

-Xbootclasspath/p:/path/to/hackedBin

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T15:30:40.917

您使用的是什么版本的 Java？最新版本随 rt.jar 中的此类一起提供。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T16:13:38.753

可能是完全不相关的，但我记得 Weblogic 在同一个类中遇到的问题。问题的原因是更改了类的序列号（Sun 意外更改了它）。解决方法是向 JVM 提供 -Dcom.sun.xml.namespace.QName.useCompatibleSerialVersionUID=1.0。

会不会是同一个问题，只是误报了？试试看。

见这里： http: [//forums.bea.com/thread.jspa?threadID=600014563](http://forums.bea.com/thread.jspa?threadID=600014563)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T16:37:45.750

`lib`您可以只更新应用服务器文件夹下的 JAXB jar吗？

# asp.net-2.0 - 创建新的 ASP.NET 2.0 Web 应用程序项目时默认加载哪些程序集？

> ID：133999
> 
> 赞同：2
> 
> 时间：2008-09-25T15:29:25.380
> 
> 标签：asp.net-2.0

创建新的 ASP.NET 2.0 Web 应用程序项目时默认加载哪些程序集？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T15:32:55.607

您引用的那些加上强制性的，例如：mscorlib、System、System.Web、System.Xml 要检查新 Web 应用程序中引用了哪些程序集，请检查解决方案资源管理器中的 References 子文件夹。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T15:43:12.353

```
System
System.Configuration
System.Data
System.Drawing
System.EnterpriseServices
System.Web
System.Web.Mobile
System.Web.Services
System.XML 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T15:54:07.583

生成当前应用程序域中已加载程序集的列表，`AppDomain.GetAssemblies()`用于查看已加载的所有内容

```
 Assembly[] loadedAssemblies = 
            AppDomain.CurrentDomain.GetAssemblies();

        foreach (Assembly assembly in loadedAssemblies)
        {
            Response.Write(assembly.FullName);
            Response.Write("<br />");
        } 
```**`**************