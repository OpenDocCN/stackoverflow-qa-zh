# StackOverflow 问答 000908000-000908999

# django - 处理 django 上的大型上传，超过 nginx 上的最大大小

> ID：908007
> 
> 赞同：1
> 
> 时间：2009-05-25T20:46:08.713
> 
> 标签：django, forms, file-upload, nginx, large-file-support

我们在 nginx 上有一个 django 应用程序，用户可以在其中上传媒体文件。媒体很大，例如 30 分钟的电视和广播节目，产生 100-300mb，我们的共享主机将上传限制为 30mb。

如何嵌入一个智能上传器，它将放置 20-30mb 的块而不是尝试上传大文件？我们不想破坏我们高度编辑的表单，所以如果有一种简单的方法可以插入诸如防弹小部件之类的工具，那么您就很棒了。

链接、片段、示例 - 高度赞赏，欢迎任何想法。提前发送。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T21:38:23.460

您应该考虑替代托管（可能是虚拟专用服务器），因为对于任何严重的下载，您将很快遇到共享托管的限制。

# recursion - 有人可以向我解释这些 Haskell 函数吗？

> ID：908014
> 
> 赞同：2
> 
> 时间：2009-05-25T20:48:45.137
> 
> 标签：recursion, functional-programming, lazy-evaluation, haskell

我过去曾涉足过 Haskell，最近又认真研究了它，我正在阅读真实世界的 Haskell。他们所展示的一些例子，我还没有理解。这样的：

```
myLength []     = 0
myLength (x:xs) = 1 + myLength (xs) 
```

我不明白这是如何工作的，真正添加的 1 是什么？递归如何返回可以添加的东西？我不明白。

在这里我们有这个：

```
splitLines [] = []
splitLines cs =
       let (pre, suf) = break isLineTerminator cs
       in  pre : case suf of 
                   ('\r':'\n':rest) -> splitLines rest
                   ('\r':rest)      -> splitLines rest
                   ('\n':rest)      -> splitLines rest
                   _                -> []

isLineTerminator c = c == '\r' || c == '\n' 
```

这是如何工作的，什么是 pre 真正被附加的？我不明白 case 表达式的结果是如何可以连接 pre 的。也许我只是需要有人详细解释这些功能的评估。我一定错过了一些非常重要的东西。

提前致谢！

编辑：我知道，这是复制粘贴失败。对不起。

编辑2：似乎我的困惑是这些功能实际上是/返回/我现在已经全部解决了。谢谢各位大神解答，终于成功了！我很感激！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-25T21:09:18.090

至于第一种，它是一种非常基本的递归方式。但是，它似乎缺少了一部分：

```
myLength [] = 0 
```

它的工作原理是每次从列表中缩小一个元素并将一个元素添加到结果中。为了可视化，考虑调用

```
myLength [1,2,3] 
```

这将评估为：

```
1 + myLength [2,3]
1 + 1 + myLength [3]
1 + 1 + 1 + myLength []
1 + 1 + 1 + 0 
```

这是3。

至于第二个，好吧，您已经将下一行的字符串分成两部分：pre 和 suf。现在，suf 将以 \n、\r 或 \r\n 开头。我们想删除这些。所以我们使用模式匹配。看看 rest 变量如何本质上是 suf 变量减去初始换行符。

所以我们有pre，它是第一行，还有rest，它是文本的其余部分。因此，为了继续将其余部分拆分为行，我们递归地调用 splitLines 并将结果连接到 pre。

为了形象化，假设你有字符串“foo\nbar\r\nbaz”。

因此，调用时，结果将是：

```
[ pre => foo, suf => \nbar\r\nbaz, rest => bar\r\n\baz ]
foo : splitLines bar\r\nbaz 
```

然后再次调用 splitLines，结果展开为：

```
[ pre => bar, suf => \r\nbaz, rest = baz ]
foo : bar : splitLines baz 
```

然后再一次：

```
[ pre => baz, suf => [], rest = [] ]
foo : bar : baz 
```

这是最终的结果。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-25T20:53:24.347

我认为的定义`myLength`错过了列表为空的情况：

```
myLength [] = 0
myLength (x:xs) = 1 + myLength (xs) 
```

使用此定义，`myLength`空列表的 为 0。`(x:xs)`模式将列表解压缩为第一个项目 ，`a`以及包含其余项目的列表，`xs`。如果列表有一项，`xs`则为空列表，因此结果为 1 + 0。依此类推。

当您首先查看基本情况时，递归是最容易理解的，然后查看每个级别的递归是如何建立在结果上的。（基本情况是函数不调用自身的情况。如果递归函数没有基本情况，则输出将是无限的。）

在第二个示例中，基本案例（案例陈述中的最后一个案例）也是一个空列表。所以 pre 总是会被附加到一个列表中，这将产生一个新的、更长的列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-25T20:53:57.433

回复：`myLength (x:xs) = 1 + myLength (xs)`-这是定义的“一半” `myLength`，它说，通过模式匹配，*如果*参数有一个头和一个尾，那么结果比尾部的递归尾调用多一个——需要另一半说当参数无法匹配时结果为 0 `x:xs`，即当参数为空列表时。

在第二种情况下，不同模式匹配的可能性只是通过`case`.

顺便说一句，懒惰不是这里的关键问题——ML，具有急切的评估但很像 Haskell 的模式匹配，将非常相似地工作。看起来模式匹配是你真正需要复习的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-25T21:04:25.260

首先第一个例子应该是这样的（**编辑：**看起来你现在修复了它）：

```
myLength []     = 0
myLength (x:xs) = 1 + myLength (xs) 
```

它的工作原理是这样的：假设我给它一个包含三个项目的列表，它返回一加尾巴的长度（这是一加尾巴的长度（这是一加尾巴的长度，（`[]`在这个点），即1），即w），即3（最终答案）。也许嵌套括号会帮助您理解它。;-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-25T21:05:25.537

看看函数的类型签名是什么是有启发性的。他们可能是：

```
myLength :: [a] -> Int 
```

在`myLength`, 1 被添加到递归调用的结果中`myLength`，这是一个`Int`，这反过来导致一个`Int`。

```
splitLines :: [Char] -> [[Char]] 
```

在`splitLines`, `pre`(a `[Char]`) 被添加到 case 语句的结果之前，从案例来看，它是递归调用的结果`splitLines`，即`[[Char]]`; 或一个空列表。在这两种情况下，前置`pre`(a `[Char]`) 将`[[Char]]`依次生成 a。

# .net - 在 IIS 中托管远程单例，客户端可以阻止服务器

> ID：908026
> 
> 赞同：1
> 
> 时间：2009-05-25T20:53:35.343
> 
> 标签：.net, singleton, remoting

我们有一个托管在 IIS 中的远程单例对象，它为多个客户端提供服务。在开发过程中，我们注意到如果一个客户端在调试器中停止，所有其他连接的客户端都将停止接收来自服务器的消息。消息通过事件回调传递，服务器将创建自己的线程来发送消息。我可以通过将 Sleep 放入客户端事件处理程序来创建相同的行为。我们在服务器上的跟踪显示对所有客户端事件处理程序的调用都是阻塞的。

当同一对象托管在独立 exe 中时，在调试或暂停一个客户端时不会发生阻塞。

我的问题是为什么我们看到托管在 IIS 下的对象和独立 exe 之间的行为不同？IIS 中是否存在阻止一个客户端阻止其他客户端与单例对话的设置。

该项目最初是一个 2.0 项目，目前它是针对 3.5 框架构建的，尽管我们没有使用任何 3.5 运行时。

客户端的远程处理配置如下

```
 <system.runtime.remoting>
    <application>
      <channels>
        <channel ref="http" port="0" clientConnectionLimit="120" useDefaultCredentials="true" timeout="2000">
          <clientProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
          </clientProviders>
          <serverProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
          </serverProviders>
        </channel>
      </channels>
    </application>
  </system.runtime.remoting> 
```

在 IIS 上，服务器配置如下

```
<configuration>
<system.runtime.remoting>
    <application>
      <channels>
        <channel ref="http">
          <clientProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
          </clientProviders>
          <serverProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
            </serverProviders>
        </channel>
      </channels>
      <service>
        <wellknown mode="Singleton" displayName="NotificationManager"  type="Notification.NotificationManager, Notification"  objectUri="NotificationManager.rem"/>
       </service>
    </application>
</system.runtime.remoting>
</configuration> 
```

独立服务器配置如下：

```
 <system.runtime.remoting>
    <application>
      <channels>
        <channel ref="http" port="8080" clientConnectionLimit="120" useDefaultCredentials="true" timeout="20000">
          <clientProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
          </clientProviders>
          <serverProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
          </serverProviders>
        </channel>
      </channels>
      <service>
        <wellknown mode="Singleton" displayName="NotificationManager" type="Notification.NotificationManager, Notification"  objectUri="NotificationManager.rem"/>
      </service>
    </application>
  </system.runtime.remoting> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T17:18:03.840

通过将超时值添加到通道来修复 IIS 的总阻塞

```
 <channel ref="http" timeout="20000"> 
```

我仍然感到惊讶的是，一个阻塞客户端会导致与其他机器的连接开始失败。

# sql - 使列唯一会强制创建索引吗？

> ID：908045
> 
> 赞同：4
> 
> 时间：2009-05-25T21:03:11.987
> 
> 标签：sql, sql-server

在 SQL Server 2005+（我同时使用）中，将`UNIQUE`约束添加到列会自动创建索引，还是应该仍然`CREATE INDEX`？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-25T21:05:04.650

请参阅此[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms177420.aspx)：

> 数据库引擎会自动创建一个 UNIQUE 索引来强制执行 UNIQUE 约束的唯一性要求。

如果您确实创建了一个索引，您最终会得到两个索引，如下例所示：

```
create table TestTable (id int)
alter table TestTable add constraint unique_id unique (id)
create unique index ix_TestTable_id on TestTable (id)

select * from sys.indexes where [object_id] = object_id('TestTable') 
```

这将在 TestTable 上显示两个唯一索引；以及代表表本身的 HEAP。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T21:43:34.790

是的，它确实。

事实上，你甚至可以创建一个`CLUSTERED UNIQUE CONSTRAINT`：

```
ALTER TABLE mytable ADD CONSTRAINT UX_mytable_col1 UNIQUE CLUSTERED (col1) 
```

，这将使表聚集在 上`col1`。

几乎所有数据库都为 建立索引`UNIQUE CONSTRAINT`，否则很难维护。

`Oracle`甚至不区分`UNIQUE CONSTRAINT`and `UNIQUE INDEX`：一个命令只是另一个命令的同义词。

唯一的区别`Oracle`是 a`UNIQUE INDEX`应该有一个用户提供的名称，而 a`UNIQUE CONSTRAINT`可以使用系统生成的名称创建：

```
ALTER TABLE mytable MODIFY col1 UNIQUE 
```

这将创建一个名为`SYS_CXXXXXX`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T21:06:52.197

添加唯一约束时会创建索引：

[参考](http://msdn.microsoft.com/en-us/library/ms177420.aspx)——见第二段。

> 默认情况下，将 UNIQUE 约束添加到表中的一个或多个现有列时，数据库引擎会检查列中的现有数据以确保所有值都是唯一的。如果将 UNIQUE 约束添加到具有重复值的列，数据库引擎将返回错误并且不添加约束。
> 
> 数据库引擎会自动创建一个 UNIQUE 索引来强制执行 UNIQUE 约束的唯一性要求。因此，如果尝试插入重复行，数据库引擎将返回一条错误消息，指出违反了 UNIQUE 约束并且不会将该行添加到表中。除非显式指定聚集索引，否则默认情况下会创建唯一的非聚集索引以强制执行 UNIQUE 约束。

# c# - 优化查找：字典键查找与数组索引查找

> ID：908050
> 
> 赞同：35
> 
> 时间：2009-05-25T21:06:00.297
> 
> 标签：c#, .net, performance, poker

我正在编写一个 7 张牌扑克手评估器作为我的宠物项目之一。在尝试优化它的速度时（我喜欢这个挑战），我震惊地发现字典键查找的性能与数组索引查找相比非常慢。

例如，我运行了这个示例代码，它枚举了所有 52 个选择 7 = 133,784,560 个可能的 7 手牌：

```
var intDict = new Dictionary<int, int>();
var intList = new List<int>();
for (int i = 0; i < 100000; i ++)
{
    intDict.Add(i, i);  
    intList.Add(i);
}

int result;

var sw = new Stopwatch();
sw.Start();
for (int card1 = 0; card1 < 46; card1++)
  for (int card2 = card1 + 1; card2 < 47; card2++)
    for (int card3 = card2 + 1; card3 < 48; card3++)
      for (int card4 = card3 + 1; card4 < 49; card4++)
        for (int card5 = card4 + 1; card5 < 50; card5++)
          for (int card6 = card5 + 1; card6 < 51; card6++)
            for (int card7 = card6 + 1; card7 < 52; card7++)
              result = intDict[32131]; // perform C(52,7) dictionary key lookups
sw.Stop();
Console.WriteLine("time for dictionary lookups: {0} ms", sw.ElapsedMilliseconds);

sw.Reset();

sw.Start();
for (int card1 = 0; card1 < 46; card1++)
  for (int card2 = card1 + 1; card2 < 47; card2++)
    for (int card3 = card2 + 1; card3 < 48; card3++)
      for (int card4 = card3 + 1; card4 < 49; card4++)
        for (int card5 = card4 + 1; card5 < 50; card5++)
          for (int card6 = card5 + 1; card6 < 51; card6++)
            for (int card7 = card6 + 1; card7 < 52; card7++)
              result = intList[32131]; // perform C(52,7) array index lookups
sw.Stop();
Console.WriteLine("time for array index lookups: {0} ms", sw.ElapsedMilliseconds); 
```

输出：

```
time for dictionary lookups: 2532 ms
time for array index lookups: 313 ms 
```

是否会出现这种行为（性能下降 8 倍）？IIRC，字典平均有 O(1) 查找，而数组有最坏情况的 O(1) 查找，所以我确实希望数组查找更快，但不会这么快！

我目前将扑克手牌排名存储在字典中。我想如果这与字典查找一样快，我必须重新考虑我的方法并改用数组，尽管索引排名会有点棘手，我可能不得不问另一个问题。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-05-25T21:09:02.410

不要忘记，Big-O 符号只说明了复杂性如何随着大小（等）而增长——它并没有给出所涉及的常数因素的任何指示。这就是为什么有时即使键的线性*搜索*也比字典查找快，当键足够少时。在这种情况下，您甚至没有对数组进行搜索 - 只是一个直接的索引操作。

对于直接索引查找，数组基本上是理想的——这只是

```
pointer_into_array = base_pointer + offset * size 
```

（然后是指针取消引用。）

执行字典查找相对复杂 - 与（例如）在有很多键时按键进行线性查找相比非常快，但比直接数组查找要复杂得多。它必须计算密钥的哈希，然后计算出应该在哪个桶中，可能处理重复的哈希（或重复的桶），然后检查是否相等。

与往常一样，为这项工作选择正确的数据结构——如果你真的可以只对数组（或`List<T>`）进行索引，那么是的，那将是非常快的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-25T21:13:34.477

> 是否会出现这种行为（性能下降 8 倍）？

为什么不？每个数组查找几乎是瞬时的/可忽略的，而字典查找可能至少需要一个额外的子例程调用。

它们都是 O(1) 的意义在于，即使每个集合中有 50 倍以上的项目，性能下降仍然只是它 (8) 的一个因素。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-26T01:03:45.293

有些事情可能需要一千年，但仍然是 O(1)。

如果您在反汇编窗口中单步执行此代码，您将很快了解其中的区别。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-26T02:43:13.407

当键空间非常大并且无法映射成稳定的有序顺序时，字典结构最有用。如果您可以将键转换为相对较小范围内的简单整数，那么您将很难找到比数组性能更好的数据结构。

On an implementation note; in .NET, dictionaries are essentially hashables. You can somewhat improve their key-lookup performance by ensuring that your keys hash into a large space of unique values. It looks like in your case, you are using a simple integer as a key (which I believe hashes to its own value) - so that may be the best you can do.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-25T21:09:56.963

数组查找是您可以做的最快的事情 - 基本上它只是从数组的开头到您想要查找的元素的一点指针算术。另一方面，字典查找可能会慢一些，因为它需要进行散列处理并关注找到正确的存储桶。虽然预期的运行时间也是 O(1) - 算法常数更大，所以它会更慢。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-25T21:10:19.943

欢迎使用 Big-O 表示法。您始终必须考虑涉及一个恒定的因素。

做一个字典查找当然比数组查找要昂贵得多。

Big-O 只告诉您算法如何扩展。将查找次数加倍并查看数字如何变化：两者都应该花费大约两倍的时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-25T21:18:37.977

从 Dictionary 中检索元素的成本[是 O(1)](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)，但这是因为字典是作为哈希表实现的 - 所以您必须首先计算哈希值才能知道要返回哪个元素。哈希表通常效率不高 - 但它们适用于大型数据集或具有大量唯一哈希值的数据集。

List（除了是一个用来描述数组而不是链表的垃圾词！）会更快，因为它将通过直接计算您想要返回的元素来返回值。

# text - sIFR 3 文本不会显示在子文件夹中

> ID：908056
> 
> 赞同：0
> 
> 时间：2009-05-25T21:09:07.370
> 
> 标签：text, sifr, subdirectory

我正在使用 sIFR3，我没有设置任何限制，即 sIFR.domains = ['*']。sIFR 文本在根级别页面上显示得非常好，但我在子文件夹页面中看不到任何文本，它是空白的。知道那里出了什么问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-25T22:59:04.903

检查你的路径。如果它们是相对的，那么当您在子目录中时，它们可能没有指向正确的目录。

# iphone - 使用 libxml2 在 iPhone 项目上从 Xcode 启动 Instruments 失败

> ID：908067
> 
> 赞同：1
> 
> 时间：2009-05-25T21:13:30.467
> 
> 标签：iphone

每当在 Xcode 的 Instruments 中启动使用 libxml2 的 iPhone 应用程序时，我都会遇到崩溃。关于原因的想法？最终给出了这个理由：

```
Reason: Incompatible library version: Foundation requires version 10.0.0 or later, but libxml2.2.dylib provides version 9.0.0 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-17T10:45:19.523

对我来说，当我为 Simulator 编译 2.2.1 应用程序，然后将 Simulator 版本切换到 3.0，然后从 Simulator 启动应用程序时，就会发生这种情况。我的应用程序崩溃并出现与您相同的错误。

[更新] 最后，它只在模拟器上发生，而不是在 iPhone 上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-17T12:12:45.787

这里的行为相同。仪器在模拟器上崩溃，但在 iPhone 上没有，所以这不是解决方案，但至少可以解决。

如果我在 3.0 SDK 上编译，它适用于模拟器和 iPhone

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-10T01:56:03.573

我已经确认，如果您在 3.0 或 3.1 中与 SDK 相关版本的 libxml2.dylib 进行链接，则 Instruments 可以正常工作。

我相信 2.2.1 下的失败只是该版本中的一个错误，它一定是一次性的。

# c# - 在 asp.mvc 中检查视图模型更改的简单方法

> ID：908073
> 
> 赞同：2
> 
> 时间：2009-05-25T21:17:03.563
> 
> 标签：c#, asp.net-mvc

有没有一种简单的方法来检查视图模型（不是域模型）在回发中的修改？

```
 public ActionResult Billing()
    {
        var viewModel = new BillingViewModel();

        viewModel.prop1 = DomainService.Prop1 // Map Domain model to View Model

        return View(viewModel);
    }

    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Billing(BillingViewModel viewModel)
    {
        //TODO: Check if ViewModel has changes and save to Domain Repository if valid
        if (ValidateBillingViewModel(viewModel))
        { 
```

我的自制解决方案是将模型哈希存储在隐藏字段中并再次检查，但有更好的选择吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-25T21:50:43.107

在这一点上，asp.net MVC 有一个相当贫乏的模型故事（即它没有）。好消息是你可以插入任何你喜欢的 ORM/DAL。坏消息是 MS (Linq-to-SQL) 支持的那个没有脏标志。

我建议查看[SubSonic](http://subsonicproject.com/)，这是一个相当成熟的 ActiveRecord 实现（也有一个脏标志）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T21:30:59.183

MVC 中的规范方法是获取（或存储）模型服务器端并使用 UpdateModel 或模型绑定来更新新检索（存储）模型上的字段。您的 ORM 将负责检测模型上的任何属性是否已更改，以便知道是否有任何属性已更改。LINQ to SQL 通过在属性设置为原始值以外的其他值时调用自动生成的模型实体类中的 PropertyChanged 处理程序来执行此操作。

# asp.net - 检测 F5 被按下并刷新

> ID：908075
> 
> 赞同：2
> 
> 时间：2009-05-25T21:17:17.027
> 
> 标签：asp.net, vb.net, refresh, keydown

我有一个网络表单，我想检测是否按下了 F5 按钮或是否刷新了页面。我知道回发，但这不是我要找的。我有一个gridview，当单击按钮并为gridview设置参数值时，它会在模式弹出窗口中加载。当刷新被击中并且如果先前单击了模式弹出按钮，则模式弹出在刷新后立即可见。我想检测页面是否刷新以防止这种情况。有任何想法吗？我想尝试覆盖，但我不确定如何使用它。我尝试了 Control.ModifierKeys，但我无权访问 ModifierKeys。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T01:59:19.720

按 F5 或物理单击浏览器刷新的行为类似于离开页面。这在事件 window.onunload 中被捕获。试试下面的[代码片段](http://snippets.dzone.com/posts/show/142)示例：

```
window.onbeforeunload = function (evt) {
  var message = 'Are you sure you want to leave?';
  if (typeof evt == 'undefined') {
    evt = window.event;
  }
  if (evt) {
    evt.returnValue = message;
  }
  return message;
} 
```

这将捕获刷新并允许您执行某些操作或提示用户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T21:37:20.357

请记住，热键是在浏览器的客户端处理的。实现这一点的最简单方法是通过 javascript。

请看以下链接：

[http://snippets.dzone.com/posts/show/3552](http://snippets.dzone.com/posts/show/3552)

# time - Paypal 日期格式：什么是“HH:MM:SS DD Mmm YY, YYYY PST”？

> ID：908077
> 
> 赞同：5
> 
> 时间：2009-05-25T21:18:04.500
> 
> 标签：time, formatting, paypal

我正在查看 PayPal `IPN docs`，它说`datetime`他们的字符串的戳记格式为：

```
HH:MM:SS DD Mmm YY, YYYY PST 
```

所以年份被指定了两次？

一次是两位数，另一次是四位数？

这看起来很奇怪。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-25T21:32:47.823

这似乎是文档中的一个错误。实际格式应为“HH:MM:SS Mmm DD, YYYY PST”（例如“08:30:06 Apr 19, 2017 PDT”）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-04-29T23:50:53.413

实际上在 PHP 中你需要使用 date("Ymd\TH:i:s\Z") 。这将导致看起来像 2012-04-30T00:05:47Z 的东西——我没有注意到 urlencoded 和 non 之间的区别。

你们在哪里找到这些信息？这些信息在他们的文档中是难以捉摸的，我花了一两个小时寻找和尝试东西。我看到这种格式的唯一地方是在 TIMESTAMP 字段中。CreateRecurringPaymentsProfile 的 PayPal NVP API 的 PROFILESTARTDATE 和“订阅开始日期应该是有效的”错误很难处理。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-06-06T16:19:15.183

对于 php，语法是`date("G:i:s M m, Y T");`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-27T12:37:53.260

根据他们的文档，这是正确的格式 - 2010-03-27T12:34:49Z 所以它是 - YYYY-MM-DDTHH:MM:SSZ （我不知道中间的 T 和 Z 是什么，但它是恒定的对于所有日期）我已经用 Java 创建了 PayPal NVP 库，所以如果你想检查它是如何工作的，或者使用它，我们非常欢迎你。它在 sourceforge - payapal-nvp.sourceforge.net

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-19T04:19:26.293

完整的日期加上小时、分钟、秒和秒的小数部分 YYYY-MM-DDThh:mm:ss.sTZD（例如 1997-07-16T19:20:30.45+01:00） 其中 TZD = 时区指示符（Z或 +hh:mm 或 -hh:mm)

示例 1994-11-05T08:15:30-05:00 对应于美国东部标准时间 1994 年 11 月 5 日上午 8:15:30。

1994-11-05T13:15:30Z 对应于同一时刻。

[https://www.w3.org/TR/NOTE-datetime](https://www.w3.org/TR/NOTE-datetime)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-08-09T05:51:24.690

实际上，我认为正确的格式是：yyyy-MM-ddTHH:MM:ssZ

案子很重要。

# delphi - 使用 Classes 单元中的 TParser 解析过滤器字符串

> ID：908082
> 
> 赞同：-1
> 
> 时间：2009-05-25T21:20:01.780
> 
> 标签：delphi, parsing

我想解析类似于以下内容的过滤器字符串：

```
((Field1 = 'red') and (field2 = 2)) or (Field3 between 1 and 5) or (field4 in ['up', 'down']) 
```

我想在 Classes 单元中使用 TParser，但似乎没有太多的文档或示例。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-25T21:41:59.613

IDE 使用 TParser 将 DFM 文件解析为二进制格式 (ObjectTextToBinary)。据我所知，它只识别 5 个标记：（EOF、符号、字符串、整数、浮点数）。它不够通用，而是为特殊目的而构建的。您必须对其进行子类化并根据需要更改它的实现。我的观点是，最好只为您的特定目的编写自己的类/自动机。（它甚至不是解析器，而是词法标记器）。

# php - php - 更改文件权限

> ID：908084
> 
> 赞同：3
> 
> 时间：2009-05-25T21:22:07.597
> 
> 标签：php, permissions

我有一个 PHP 脚本，它使用 chmod 更改我的服务器上的文件权限。我希望能够通过浏览器（作为没人）和通过 cron 作业（作为用户名）运行脚本。

只有文件的所有者才能更改权限是否正确？即，如果我通过 cron 作业创建文件并设置权限，那么在从浏览器运行脚本时我不能更改这些权限？

请问有没有办法解决这个问题？删除（取消链接）并以脚本运行的任何用户身份重新创建文件？或者有没有办法通过cron作业作为nobody运行php脚本？/ 通过浏览器作为用户名？

目的是能够通过更改文件权限使图像公开可见或不公开。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-27T19:00:25.913

解决方案 1：为用户和 cron 用户创建一个组，将每个用户添加到新组中，并授予两个用户对文件的读写权限（chmod g+rw 文件名）。（比下一个解决方案更安全）。

解决方案2：最简单的方法是让每个人都可以读写文件（chmod a+rw filename）会有这个效果。

不过，我不建议将此用于生产用途。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T22:16:14.720

您无需在脚本中输入用户名或密码即可执行此操作。

在您的 crontab 中有 sudo 以您的 Web 服务器运行的用户身份执行脚本。按照您的示例，我将使用nobody 用户。

0 12 * * * (sudo -u 没人 php ./yourscript.php)

请注意，“nobody”用户（以及像“apache”这样的用户）通常没有登录权限。这可能需要您允许 sudo 在没有 tty 的情况下执行脚本。如果您收到类似以下的错误，您就会知道这一点：“sudo：抱歉，您必须有一个 tty 才能运行 sudo”

可以通过使用 visudo 命令注释掉“Defaults requiretty”行来允许这样做。与对 sudo 的任何更改一样，您可能希望搜索此更改可能带来的任何副作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T16:46:42.330

是的，只有文件的所有者可以这样做。您的选项取决于您对服务器的控制类型。

如果你对服务器有足够的控制权，你可以使用 SuPHP 而不是 Apache 的 mod_php。这样，PHP 脚本将以拥有该脚本的用户身份运行，并且由 PHP 脚本创建的任何文件都将归同一用户所有。

如果您没有那么多控制权（例如，常见的共享网络托管），您可以使用类似 Joomla 的 FTP 方法。在 Joomla 中打开 FTP 支持时，它会使用 FTP 进行所有文件操作。这样，它可以创建或操作具有与 FTP 用户相同权限的文件。

像这样（省略错误处理）：

```
$ftp = ftp_connect('localhost');
ftp_login($ftp, 'username', 'password');
ftp_chdir($ftp, '/root/to/website');
ftp_chmod($ftp, 0644, 'filename.ext');
ftp_close($ftp); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-25T21:38:03.383

只有文件的所有者才能做到这一点，我建议将 cronjob 作为“nobody”运行。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-25T21:25:57.837

通常只有所有者或超级用户（或同等人员）

# git - 如何在 Git 中对项目计划、待办事项、wiki 等进行版本控制？

> ID：908087
> 
> 赞同：1
> 
> 时间：2009-05-25T21:23:05.190
> 
> 标签：git, project-management

在我几乎所有的项目中，我几乎没有“项目范围”的文件，因为它们的内容应该在所有分支之间共享。这些文件通常包括项目时间表、待办事项列表、wiki 等。目前我已将它们包括在内`.gitignore`，因此无论我签出哪个分支，它们都没有版本化但保持不变。但是，我真的很希望以与源代码版本“正交”的方式对它们进行版本控制。`git`在没有太多痛苦的情况下这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T04:12:44.703

您可以将这些文件（wiki、todo 等）放在其专用的 Git 存储库中，然后通过[子树合并策略](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)将它们添加到开发存储库（如[本问题](https://stackoverflow.com/questions/899373/transferring-legacy-code-base-from-cvs-to-distributed-repository-e-g-git-or-mer/899428#899428)中所述）。

这样，它们就会被包含在任何开发中，并且它们也会被这些子项目更新。

然后，子项目对分支所做的任何修改都可以合并回原始“wiki” Git 存储库中的“主”分支，并且所有子项目都可以将自己的开发分支与该主“wiki”分支合并到为了更新通过子树合并包含的此内容。

不完全是“正交”版本，但仍然是一个实用的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T08:48:20.733

我通常更喜欢使用单独的工具来进行调度、问题跟踪、wiki 文档等。例如，Trac 提供了这些功能并与 git 后端很好地集成。源代码控制仅用于源代码控制。

如果您想使用源代码管理工具来存储项目管理数据，请考虑在源代码管理中为“管理”和“实施”设置单独的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T22:01:52.617

你不能只有一个通用/项目范围的分支，然后是一堆项目分支吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-31T17:56:42.067

您可以使用`git submodule`将对项目范围的 repo 的引用插入到所有存储库中。

# wpf - 使用 WrapPanel 和 ScrollViewer 在 WPF 中提供多列列表框

> ID：908089
> 
> 赞同：4
> 
> 时间：2009-05-25T21:24:28.807
> 
> 标签：wpf, data-binding, xaml, listbox

我正在制作一个简单的 LOB 应用程序，它从 XML 文件加载数据并将其显示在一个列表中，并带有几个按钮进行编辑。

在我的第一次尝试中，一切都很好，只是列表在一个长列中向下滚动。我希望数据能够换行，以便在窗口底部开始第二列，依此类推——如果您调整窗口大小，数据应该相应地调整大小。

首先，我只是将 ListBox 放在 ScrollViewer 中。这没有任何区别。

然后，我在 ItemTemplate 中添加了 WrapPanel。在这一点上，我得到了一个水平的长行，但它从未包裹到第二行，尽管我设置了 ScrollViewer.Horizo​​ntalScrollbar=disabled。

我在各种博客和论坛上搜索了网络，但看不到建议和我的代码（包括在下面）之间的区别。任何提示将不胜感激。

```
<Window x:Class="MyApp.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="My App" Height="300" Width="400"
        FocusManager.FocusedElement="{Binding ElementName=eventsList}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
                <ScrollViewer Grid.Row="0" Grid.Column="0"     HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
            <ListBox Name="eventsList">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
            </ListBox>
        </ScrollViewer>

        <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal"     HorizontalAlignment="Center" Visibility="Collapsed">
            <Button Name="action1Button" />
            <Button Name="action2Button" />
            <Button Name="action3Button" />
        </StackPanel>
    </Grid>
</Window> 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-28T23:26:42.117

您似乎走在了正确的轨道上：将 ListBox 中的 ItemsPanelTemplate 替换为 WrapPanel，将 WrapPanel 的 Orientation 设置为 Vertical，并将 ScrollViewer.VerticalScrollBar 设置为 Disabled 应该是您需要做的所有事情。

这对我有用：

```
<Window x:Class="ScrollingWrapPanel.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <ListBox ScrollViewer.VerticalScrollBarVisibility="Disabled">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel IsItemsHost="True" Orientation="Vertical"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Red"/>
            </ListBoxItem>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Orange"/>
            </ListBoxItem>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Yellow"/>
            </ListBoxItem>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Green"/>
            </ListBoxItem>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Blue"/>
            </ListBoxItem>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Indigo"/>
            </ListBoxItem>
            <ListBoxItem>
                <Rectangle Width="80" Height="80" Margin="10" Fill="Violet"/>
            </ListBoxItem>
        </ListBox>
    </Grid>
</Window> 
```

这应该会导致它垂直渲染一整列，换行，然后继续下一列，根据需要水平滚动（但不是垂直），如图所示：

[![带有 WrapPanel 的 ListBox 垂直环绕](https://i.stack.imgur.com/J7nUs.png)](https://i.stack.imgur.com/J7nUs.png)

这个实现的关键是

1.  在 WrapPanel 上设置 Orientation="Vertical" 以便垂直而不是水平地包裹，并且
2.  在 ListBox 上设置 ScrollViewer.VerticalScrollBarVisibility="Disabled" 以便 ScrollViewer 知道将其高度限制为可用空间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T06:43:07.633

我相信要做到这一点，您需要编写自定义代码 - 您在覆盖 ItemsPanelTemplate 方面有正确的想法，但 WrapPanel 不会按照您想要的方式订购东西 - 它会订购东西：

```
A B C D
E F G H
I J K L 
```

而你可能想要它：

```
A D G J
B E H K
C F I L 
```

此外，通过将它放在 ScrollViewer 中，就像告诉它它有一个无限大小的屏幕，所以结果只会是一行（因为 ScrollViewer 会给它所需的空间）。编写面板并不难，它基本上只有两个功能（测量和排列）。

# c++ - 在 C++ 中，是否可以抛出 std::exception 不会捕获的异常？

> ID：908092
> 
> 赞同：2
> 
> 时间：2009-05-25T21:25:43.390
> 
> 标签：c++, exception

**问题一：**

是否有可能抛出一个不会被 std::exception 捕获的异常？

```
try
{
}
catch(std::exception & e)
{
}
catch(...)
{
  //Is this block needed?
} 
```

**问题2：**

是否更好：

```
catch(std::exception & e) 
```

或者

```
catch(std::exception e) 
```

或者

```
catch(const std::exception &e)//<--- this is the method I usually use 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-25T21:33:14.280

Q1：是的。您可以抛出任何类型，而不是从 std::exception 继承的必要类型。
您可以写入`throw 1;`throw 和 int 或`throw "hello";`throw a `char*`，两者都不继承自`std::exception`. 然而，这被认为是不好的做法，因为类的用户不能指望你扔任何东西。如果你不想继承`std::exception`你通常做的事情，那就是创建你自己的异常层次结构。

Q2：按值捕获异常（第二个选项）是一种不好的做法，因为您强制复制异常实例并且可能执行可能导致进一步异常的分配。
使用第一个选项建议您打算更改`e`catch 块，这也是您可能希望避免的事情，因为异常通常在创建后保持不可变。唯一剩下的是第三个选项。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-25T21:29:17.707

可以肯定的是，你可以抛出任何你想要的类型，它不需要从`std::exception`.

抓住`const`参考更好。原因是你可以抛出一个`const`或一个非`const`-，它可以被一个非-捕获`const`。这就像无声地抛弃`const`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-25T21:33:25.997

您的第二个问题的答案是您应该按值抛出并按引用捕获。如果您按值捕获，您可能会得到“[对象切片](http://en.wikipedia.org/wiki/Object_slicing)”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T22:21:01.627

It is sometimes necessary to throw an exception that does not inherit from std::exception. When shipping a shared library it's best practice to either re-implement or wrap most the std library types instead of exposing methods/functions that use them directly as it can cause all sorts of linker/compiler interoperability issues.

# html - 仅使用 CSS，是否可以创建一个完全覆盖整个文档内容区域的 div？

> ID：908103
> 
> 赞同：1
> 
> 时间：2009-05-25T21:31:43.537
> 
> 标签：html, css, stylesheet

我只是想知道是否可以只使用 CSS 而不是 javascript 来设置一个可以完全覆盖整个内容区域的 DIV？（注意：整个内容，而不仅仅是视口）。这似乎是不可能的，因为 <body> 元素有一些边距，而且似乎没有简单的方法来设置 div 的样式以包含 body 元素的边距宽度和高度。但事实上有可能吗？

**更新**：对不起，一个要求是我们不能将 <body> 的边距设置为 0...（更新 2：说，如果我们需要将其放入库并且不能要求所有使用它的人设置身体有边距0）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-25T21:36:08.423

当然，我想。

重置默认边距：

```
* { margin: 0; padding: 0; } 
```

那么对于

```
<div id="shader"></div> 
```

做：

```
#shader {position: absolute; width: 100%; height: 100%; min-height: 100%; top: 0; left: 0;} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-25T22:03:10.257

这可能是一个解决方案，但它不会在 IE 中工作......

```
div.cover { position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px; } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-25T22:14:27.787

如果设置了 <body> 边距，那么您不能在 <div> 上使用负边距来覆盖 <body> 边距吗？我了解 <body> 边距可能因浏览器而异。如果 <body> 有 10px 的边距，那么设置 div 的样式如下：

```
div#mydiv {
margin: -10px;
} 
```

您将使用相同的原则来覆盖填充（如果适用）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-26T01:04:59.050

从逻辑上讲，这是不可能的。您的 DIV 必须进入身体内部，而不是外部。

或者换一种说法，你要求覆盖整个“内容区域”，但这并不是你真正想要的，你想要覆盖整个身体。

Lazlow has the best suggestion. Maybe set the negative margins/padding to something large so you can be sure it's bigger than the browser default, then have an inner div with the same margin/padding values only positive?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-25T21:36:41.950

是的。您只需将 body 标签的 padding 和 margin 设置为 0，然后将 div 标签的 padding 和 margin 设置为零。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-25T22:00:32.587

那这个呢？

```
<div style="position:absolute;left:0px;top:0px;width:100%;height:100%;">... 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T01:39:52.503

Liked Ambrose's answer. The body is ultimate container for your HTML. I have not seen any margins in the body with Mozilla, Chrome, IE, or Opera -- current versions. To prove it: style
body {background-color: yellow;} /*and take a look. */

in any case, it's always a good practice to normalize the browsers setting for margin, padding, etc to zero! like Dmitri Farkov above

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-26T15:53:04.963

I think there's no way to make the div "float" over your browser, if would so, then the technology could overcome your screen, something like body style="margin: -40px" - should this bleed on your desktop?

And by the way, html styled is abnormal, what would you do next? style , ?? In any case they ARE there so you could set styles on all of them but I don't think it would be much clever.

I don't know if this could help:

```
<div style="margin:-100%"> 
```

But I doubt this can overcome the browser window...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-03T13:55:17.630

I think MiffTheFox's approach is the best, because its solution covers the situation where other divs has absolute positioning. Remember that absolute positioning elements go off the flow, and if any element is positioned for example at top:9000px, body height will not be >9000px.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-08T13:16:24.027

```
<style type="text/css">
    #superdiv{ position:fixed; top:0; left:0; width:100%; height:100%; }
</style>

<div id="superdiv">
    Put some content here.
</div> 
```

# winforms - OpenNetCF FTP类多线程问题

> ID：908105
> 
> 赞同：1
> 
> 时间：2009-05-25T21:32:31.490
> 
> 标签：winforms, multithreading

目前，我有类似的东西：

```
public partial class Form1 : Form
{
delegate void StringDelegate(string value);

private FTP m_ftp;

public Form1()
{
InitializeComponent();
}

private void connect_Click(object sender, EventArgs e)
{
OnResponse("Connecting");
m_ftp = new FTP(server.Text);
m_ftp.ResponseReceived += new FTPResponseHandler(m_ftp_ResponseReceived);
m_ftp.Connected += new FTPConnectedHandler(m_ftp_Connected);
m_ftp.BeginConnect(user.Text, password.Text);
}

void m_ftp_Connected(FTP source)
{
// when this happens we're ready to send command
OnResponse("Connected.");
}

void m_ftp_ResponseReceived(FTP source, FTPResponse Response)
{
OnResponse(Response.Text);
}

private void OnResponse(string response)
{
if (this.InvokeRequired)
{
this.Invoke(new StringDelegate(OnResponse), new object[] { response } );
return;
}

}

private void getFileList_Click(object sender, EventArgs e)
{
FTPFiles files = m_ftp.EnumFiles();

fileList.Items.Clear();

foreach (FTPFile file in files)
{
fileList.Items.Add( new ListViewItem( new string[] { file.Name, file.Size.ToString() } ));
}

tabs.SelectedIndex = 1;
}

private void upload_Click(object sender, EventArgs e)
{
FileStream stream = File.OpenRead("\\My Documents\\My Pictures\\Waterfall.jpg");
m_ftp.SendFile(stream, "waterfall.jpg");
stream.Close();
} 
```

效果很好 - 这个例子取自样本。但是，在最近重新访问后，我有一个问题。在这种特殊情况下，由于 OnResponse() 函数不会更新 UI，因此这里似乎没有任何作用。我删除了它（以及对它的所有调用），它仍然像以前一样工作。我错过了什么吗？

在阅读了有关表单多线程的更多信息后，我了解到这种机制（在上面的代码中演示）是为了确保 UI 是响应式的。

因此，如果我们需要更新 UI 元素（例如文本框、标签等），我们将按如下方式实现 OnResponse：

```
delegate void StringDelegate(string dummy); 
void OnResponse(string dummy)
{
    if(!InvokeRequired)
    {
        button1.Text = dummy; 
     } 
    else 
        Invoke(new StringDelegate(OnResponse),new object[] {enabled}); 
} 
```

如果这个函数被实现为：

```
 delegate void StringDelegate(string dummy); 
    void OnResponse(string dummy)
    {
        if(InvokeRequired)
        {            
            Invoke(new StringDelegate(OnResponse),new object[] {dummy}); 
            return;
        }
    } 
```

拥有它有什么用？绝对有必要吗？

还有一个问题：这里的 ftp 对象是在自己的线程上运行的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T22:32:24.863

FTP 对象肯定是在它自己的线程上运行的。我怎么知道？这一行：

```
m_ftp.BeginConnect(user.Text, password.Text); 
```

这是一种异步方法。一旦调用它，FTP 组件将使用 .NET 线程池中的一个线程来完成所有工作。这个专用线程是用于“引发”事件的线程。最终，“引发事件”只是对添加到事件调用列表中的所有委托的一个或多个方法调用；正是这个由 Begin 方法启动的专用线程调用了这些方法。此线程与运行 UI 的线程不同，因此需要调用调用。

如果您希望 FTP 组件使用 UI 线程，您将使用 Connect 方法而不是 BeginConnect 方法。这意味着您的事件也不会起作用，您的 UI 也不会响应交互 - 这是完全可以预料的，因为线程一次只能做一件事：它要么为 UI 提供服务，要么执行 FTP 代码。这就是为什么你需要第二个线程。

有道理？

-Oisin

# php - 有没有办法在 php 页面之间共享对象？

> ID：908108
> 
> 赞同：12
> 
> 时间：2009-05-25T21:33:06.667
> 
> 标签：php, connection-pooling

我是 php 新手，但在其他 Web 技术中，您可以在页面实例之间共享对象。例如，在 java jsp 页面中，您很容易拥有作为整个服务器实例的静态类存在的类。如何在php中做到这一点？

我不是指会话变量（至少我不这么认为）。这更多是出于资源池的目的（可能是要共享的套接字，或数据库连接等）。所以需要在后续加载之间共享整个类，而不仅仅是我可以存储在会话中的一些原始变量。

我也研究过做 php 单例类，但我相信该类只在同一页面内共享，而不是跨页面共享。

为了让事情更清楚，我正在寻找可以帮助我共享连接到服务器的连接到 connectSocket.php 页面的套接字的东西，这样加载该页面的所有用户都使用相同的套接字并且不打开新的一个。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-25T21:46:22.100

这是一个有点困难的答案，可能不是您正在寻找的。

PHP 建立在“无共享”架构之上。如果您在应用程序中需要某种类型的状态，则必须通过其他方式执行此操作。

首先，我建议您研究问题的核心。您真的需要它吗？如果您假设 PHP 应用程序可能会死掉（并丢失状态），是否可以丢失数据？

如果您必须维护状态，即使在应用程序死亡或其他情况下，您也应该假设放置数据的最佳位置可能是 MySQL。PHP 旨在作为您业务逻辑的薄层，因此我强烈推荐它。

如果您不关心重新启动后丢失数据，那么您正在寻找的问题域可能是缓存。我建议查看[memcached](http://ca3.php.net/memcached)，或者如果您在单台机器上，[apc](http://ca3.php.net/apc)。APC 肯定会在单台机器上与 Apache 一起为您工作，但您仍然必须为您的应用程序编写代码，假设您可能会丢失数据。

如果您担心底层数据存储 (MySQL) 太慢，但重启后仍需要维护数据，您应该研究这两个系统的组合。您始终可以从缓存中推送和拉取数据，但只有在更新时才将其发送到 Mysql。

如果数据纯粹是用户或会话绑定的，您可能只想查看会话系统。

我个人开发了一个相当大的多租户应用程序，虽然它是一个相当复杂的应用程序，但我从来不需要你正在寻找的真实状态。

**更新**：抱歉，我没有阅读您关于共享套接字的说明。您将需要一个单独的守护程序来处理此问题，也许如果您可以进一步解释您的问题，可能还有其他方法。这是什么类型的插座？

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-25T21:56:28.337

网络服务的 Java 和网络服务的解释性语言（如 PHP 和 Perl）之间存在根本区别。在 Java 中，您的 Web 服务器将拥有一个维护状态的操作环境（即 Tomcat）。对于解释型语言，对您的 Web 服务器的请求通常会产生一个新的 Web 服务器线程，进而为该线程加载一个新的操作环境，在本例中为 PHP 环境。

因此，在 PHP 中，没有页面实例的概念。对 Web 服务器的每个请求都是一个新的开始。所有的类都是重新加载的，所以没有类共享的概念，也没有资源池的概念，除非是外部实现。

因此，在 Web 请求之间共享套接字实际上是不可能的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-25T21:55:27.217

这可能是部分答案，但您可以将类的实例保存到 Session 变量中并在其他时间访问它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-25T21:54:42.240

大多数 PHP 数据库库已经使用连接池。例如，您调用 pg_connect 就好像您正在请求一个新连接，但如果连接字符串与已经存在的连接相同，您将取回已建立的连接。如果您只关心数据库访问池，那么您只需确认它存在于您正在使用的 db 库中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-14T16:33:02.937

另一个可怕的解决方案可能是将对象的数据加载到任何 $_SESSION 变量中，然后将其返回到另一个页面的对象中。事实上，这是我将在我的项目中遵循的解决方案，直到我得到更好的解决方案。

问候！

# c# - 如何绑定到其他项目/命名空间中包含的集合？

> ID：908112
> 
> 赞同：1
> 
> 时间：2009-05-25T21:34:39.490
> 
> 标签：c#, wpf, data-binding, xaml

我这样做了：

```
this.combobox.ItemsSource = Common.Component.ModuleManager.Instance.Modules; 
```

将组合框绑定到位于其他项目/命名空间中的集合。但我不得不把它移到`ComboBox`一个 DataTemplate 中。

现在我需要做这样的事情：

```
<ComboBox ItemsSource="{Binding Common.Component.ModuleManager.Instance.Modules}"/> 
```

我不想列出我所有的尝试，但没有一个成功。
有更好的想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-25T22:24:47.080

您需要将 .NET 命名空间映射到 XAML 文件顶部的 XML 命名空间：

```
<Window 
    x:Class="WindowsApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:q="clr-namespace:Common.Component"> 
```

所以现在“q”被映射到“Common.Component”命名空间。现在您可以使用 x:Static 标记扩展来访问 ModuleManager 类的静态“实例”属性：

```
<ComboBox
    ItemsSource="{Binding Modules,Source={x:Static q:ModuleManager.Instance}}" /> 
```

看看这是否适合你。

**编辑**

还有一件事：如果您的“Common.Component”命名空间位于单独的程序集中，您需要告诉 XAML：

```
xmlns:q="clr-namespace:Common.Component;assembly=CommonAssemblyFilename" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T08:33:13.650

在不相关的注释中，您可能希望绑定到 Observable 集合以提高性能。更多 WPF 优化细节[在这里](http://msdn.microsoft.com/en-us/library/bb613546.aspx)。

> 将 IEnumerable 绑定到 ItemsControl 会强制 WPF 创建包装器 IList<(Of <(T>)>) 对象，这意味着您的性能会受到第二个对象的不必要开销的影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T15:49:27.920

好的，我找到了解决方法。如果集合包含在其他程序集中，则一定有问题。

我向 XAML 和 Binding 的程序集添加了一个新类。

```
public static class ResourceHelper
{
    public static IEnumerable<Common.Component.Module> Modules = Common.Component.ModuleManager.Instance.Modules;
} 
```

然后我将绑定更改为

```
<ComboBox ItemsSource="{Binding Path=.,Source={x:Static e:ResourceHelper.Modules}}"/> 
```

这很好用。
感谢马特为您提供帮助。

# perl - 如何使用 CGI.pm 获取整个请求正文？

> ID：908113
> 
> 赞同：19
> 
> 时间：2009-05-25T21:34:42.610
> 
> 标签：perl, cgi

我正在尝试编写一个 Perl CGI 脚本来处理 XML-RPC 请求，其中 XML 文档作为 HTTP POST 请求的主体发送。

CGI.pm 模块在从 HTTP 请求中提取命名参数方面做得很好，但我不知道如何让它给我整个 HTTP 请求正文（即我的 XML-RPC 请求中的 XML 文档处理）。

如果不是 CGI.pm，是否有另一个模块能够从请求中解析出这些信息？我宁愿不必从环境变量中“手动”提取这些信息。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-25T22:17:55.190

您可以使用特殊参数名称 POSTDATA 获取原始 POST 数据。

```
my $q = CGI->new;
my $xml = $q->param( 'POSTDATA' ); 
```

或者，您可以直接读取 STDIN 而不是使用 CGI.pm，但是您会丢失 CGI.pm 所做的所有其他有用的东西。

[POSTDATA 技巧记录在优秀的](http://search.cpan.org/~lds/CGI.pm-3.43/CGI.pm#HANDLING_NON-URLENCODED_ARGUMENTS)CGI.pm 文档中。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-02-13T09:55:03.080

是的，可以使用 POSTDATA，但只有在请求 Content-Type 未设置为“multipart/form-data”时才有效。

如果它设置为'multipart/form-data'，CGI.pm 会进行自己的内容处理并且POSTDATA 不会被初始化。

因此，其他选项包括`$cgi->query_string`和/或`$cgi->Dump`。

以`$cgi->query_string`GET 格式 ( `param=value&...`) 返回 POST 的内容，并且似乎没有一种方法可以简单地获取客户端传入的 POST STDIN 的内容。

因此，要获取 POST 请求的标准输入的实际内容，如果您可以选择修改 CGI.pm，您可以在第 620 行附近进行修改以将`@lines`某处的内容保存在变量中，例如：

```
$self->{standard_input} = join '', @lines; 
```

然后通过`$cgi->{standard_input}`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-10-07T13:41:01.183

要处理所有情况，包括*Content-Type*为时的情况，请在CGI**之前**`multipart/form-data`读取（并放回）原始数据。

 **```
use strict;
use warnings;

use IO::Handle;
use IO::Scalar;

STDIN->blocking(1); # ensure to read everything
my $cgi_raw = '';

{ 
  local $/; 
  $cgi_raw = <STDIN>;
  my $s;
  tie  *STDIN, 'IO::Scalar', \$s;
  print STDIN $cgi_raw;
  tied(*STDIN)->setpos(0);
}

use CGI qw /:standard/;
... 
```

# ruby - 活动记录查询

> ID：908116
> 
> 赞同：2
> 
> 时间：2009-05-25T21:36:01.170
> 
> 标签：ruby, activerecord

我有以下 ActiveRecords

```
class Product < ActiveRecord::Base  
  has_many :reviews  
end  

class Review < ActiveRecord::Base  
  belongs_to :product  
end 
```

每个评论对象都包含一个名为“评分”的字段，
我希望获得平均评分大于特定范围的所有产品的列表。
我不明白如何使用 find 命令来执行此操作。
find 让我们做这样的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T21:49:00.863

- 是的，它可以做到。像这样的东西应该可以解决问题......

```
 Product.find(:all, :include => 'reviews', :conditions => ['review.rating > ?', min_rating]) 
```

**编辑**- 只需重新阅读您的问题。您想使用平均评分。我会求助于 SQL 来执行此操作，或者如果它是一种常见操作，则计算平均评分并将其存储在每次保存评分时的产品中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-01T15:59:55.700

当查询开始像这个一样询问聚合值的条件时，我会使用 SQL。有多种方法可以实现您想要的结果 - 这对我来说感觉最直接：

```
bound = 3
products = Product.where('id in 
  (
    select product_id 
    from reviews 
    group by product_id 
    having avg(rating) > ?)', bound) 
```

# c# - C# TextWriter 每 1024 个字符插入换行符

> ID：908119
> 
> 赞同：2
> 
> 时间：2009-05-25T21:36:15.397
> 
> 标签：c#, text

我正在使用文本编写器将数据写入文本文件，但如果行超过 1024 个字符，则会插入换行符，这对我来说是个问题。有关如何解决此问题或增加字符限制的任何建议？

```
textWriter.WriteLine(strOutput); 
```

非常感谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-25T21:39:53.393

使用 Write，而不是 WriteLine

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-25T21:40:14.330

那么你正在使用[`TextWriter.WriteLine(string)`](http://msdn.microsoft.com/en-us/library/7ack4zyt.aspx)which appends `\r\n`after `strOutput`。正如文档所说：

> *将后跟行终止符*的字符串写入文本流。

（强调我的。）但这与 1024 个字符无关——我猜这就是你读取它的方式（例如，使用 1024 个字符的缓冲区）。

为了避免额外的换行符，只需使用

```
textWriter.Write(strOutput); 
```

编辑：您在评论中说您需要在“整行已写出”之后换行 - 但听起来`strOutput`并不总是同一行。

我怀疑完成你想要的最简单的方法是将“复制”端与“换行”端分开。用于`Write`您要复制的所有文本，然后只需调用

```
textWriter.WriteLine(); 
```

当你想要换行时。如果这没有帮助，我认为我们将需要更多上下文 - 请提供您正在做什么的代码示例。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-25T22:05:55.510

我编写了一个示例应用程序，它可以写入和读取 1025 个字符的字符串。大小永远不会改变。虽然如果我用 notepad.exe (Windows) 打开它，我可以在第二行看到多余的字符。这些似乎是记事本的限制。这是我的示例代码

```
 static void Main(string[] args)
    {
        using (TextWriter streamWriter = new StreamWriter("lineLimit.txt")) {
            String s=String.Empty;
            for(int i=0;i<1025;i++){
                s+= i.ToString().Substring(0,1);
            }
            streamWriter.Write(s);
            streamWriter.Close();
        }
        using (TextReader streamReader = new StreamReader("lineLimit.txt"))
        {
            String s = streamReader.ReadToEnd();
            streamReader.Close();
            Console.Out.Write(s.Length);
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T21:58:00.143

如果您需要在输出末尾添加换行符，只需附加它们。

```
textWriter.Write(strOutput +"\r\n"); 
```

# testing - 分支机构覆盖范围

> ID：908123
> 
> 赞同：0
> 
> 时间：2009-05-25T21:37:07.533
> 
> 标签：testing, branch

在编写应该具有 100% 分支覆盖率的测试用例时，是否可以让一个案例涵盖两个分支，另一个案例只涵盖一个分支。

注意：我们假设代码中只有三个分支。

编辑：3 个分支意味着三个基本的 if 语句，它们在代码主体中都是相互独立的。例如

```
input (x, y)
if (x<0)
    something
if (x==y)
    something
if (x > y)
    something
output (x) 
```

我有一个覆盖第一个分支的测试用例和一个覆盖其他两个分支的测试用例

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T15:55:03.213

测试是我们对产品提出的问题。每个（书面）分支进行一次测试的想法可能有用或愚蠢。

我对你给出的例子有一些疑问

*输入 (x, y)
如果 (x<0)
某事
如果 (x==y)
某事
如果 (x > y)
某事
输出 (x)*

如果 x 大于零会发生什么？你*应该*跌倒吗？如果 x 小于 y 会发生什么？某物？没有什么？

事情是这样的：代码（和分支）（和条件）覆盖是个好主意。但是“覆盖”一条线、一个分支或一个条件是什么意思？是为了确保程序*可以*工作——也就是说，执行给定的行/分支/条件而不会崩溃？或者是为了确保该程序*能够*正常工作？

---迈克尔 B.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-25T21:50:06.587

就个人而言，我专注于代码的行为。因此，执行代码有三种不同的可能方式，因此应该有三个测试。

这样想 - 如果两个分支之一中断，您可能不知道，因为测试仍然通过（因为另一个分支仍然有效）但生产代码失败。不理想。

是的，这确实需要更多时间，但在某些情况下，这是值得的……100% 的一切？也许不会到那种极端的程度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-25T21:46:51.743

100% 的分支机构覆盖率？要求类似内容的人是否有任何真实世界的测试覆盖经验？以我的经验，对于相当复杂的项目，获得 75-80% 的*代码*覆盖率和大约 60-70% 的分支覆盖率是可以期望的最好的。这些数字通常是原始的、预分析的数字。在消除了无法访问的片段后，它们会上升（约 92-95% 的代码和 80-85% 的分支），例如断言、默认切换案例、“深度防御”代码路径等。至于您的问题：您拥有的测试用例越少越好。不要忘记，测试不仅需要时间来开发，还需要运行和分析故障。在您第一次等了 4 天以完成整个测试套件后，您很快就会了解到将测试用例数量减少到最少的价值，从而对覆盖范围充满信心。

# agile - 敏捷故事和任务

> ID：908125
> 
> 赞同：8
> 
> 时间：2009-05-25T21:37:52.727
> 
> 标签：agile, extreme-programming

在设计后端系统时，你通常给你的故事和任务赋予什么粒度？

创建故事和任务的大多数示例通常以 GUI 应用程序为中心，故事是用户可以做的事情（例如，通过 ISBN 搜索一本书），每个任务都围绕启用此 GUI 功能。

在设计后端系统时，即没有用户界面而只是一堆与数据库、中间件等对话的服务时，您如何提出任务和故事？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-27T21:08:49.570

基本上，我尝试将我的用户故事的大小保持在 1 到 10 个工作日的范围内。这使我无法将 Mike Cohn 所称的“史诗”或“主题”作为用户故事传递给开发人员，另一方面，我的用户故事会变得如此具体以暗示解决方案（他们应该描述问题，不是应该如何解决）。

就内容而言，我确保我的故事只包含商业价值——它从不描述我（应该）*如何*满足需求，也不“需要”非用户领域的知识来理解。

**很好的例子：**作为内容管理员，我希望所有用户在写回话之前都必须登录，以拒绝他们发送垃圾邮件的能力。

**不好的例子：**将验证码添加到网站。

另一方面，任务是解决解决方案的步骤——它们描述了需要添加/修改的组件和功能。这就是“添加验证码”解决方案的用武之地。就大小而言，我尝试让每个*任务*的大小在每天 1/2 到 2-3 天之间。

任务还包括一组适用于每个功能/要求/问题/错误的标准任务，例如：

*   文档
*   编写测试用例
*   手动测试
*   编写自动化功能测试等。

希望这会有所帮助，阿萨夫。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-25T21:43:24.043

只要您有用户，用户故事就可以围绕用户可以做的事情。如果您为其他开发人员提供 API，那么他们就是您的用户。届时事情将变得更加技术性（即用户可以更新员工记录）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-25T22:42:35.187

我的故事基于类的公共接口。对于任务粒度，我会争取半天到两天的工作量。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-26T16:26:50.043

用户/参与者可以是一个系统，不一定是一个人。您的服务将具有 API、预期的输入和结果以及服务级别协议（非功能性要求）。所有这些都可以在故事卡中指定。

最重要的是，您的故事卡应指定验收标准。验收标准将有助于推动开发人员测试 Deiven 开发单元测试、自动化功能测试和自动化性能测试。如果满足接受标准，则该卡被产品所有者接受和批准。

# math - 难以理解逻辑

> ID：908142
> 
> 赞同：4
> 
> 时间：2009-05-25T21:43:41.747
> 
> 标签：math, logic

好的，所以我必须证明以下顺序：

```
(p -> r) ^ (q -> r) |- p ^ q -> r 
```

我理解为什么这显然是正确的，我也理解自然演绎的规则。我不明白的是我如何去证明它。这是提供的模型答案：

```
1\. (p -> r) ^ (q -> r) |- p ^ q -> r     premise
2\. p ^ q                                 assumption
3\. p                                     ^e 2
4\. p -> r                                ^e 1
5\. r                                     ->e 4,3
6\. p ^ q -> r                            ->i 2,5

(e = elimination / i = introduction). 
```

有人可以为我提供链接或“愚蠢”的解释吗？我觉得我错过了一个简单的概念，导致这很难理解......？

例如，在第 4 行，为什么需要第 3 行中的 p 删除 ->，而在第 3 行中，您可以在不使用 aq 的情况下删除 ^q？

我相信这很简单，但对我来说似乎没有意义......？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-25T21:48:58.617

在第 2 行，你有`p ^ q`这意味着两者`p`都是`q`真的。由此可见，这`p`是真的，因为如果两者都是真的，那么任何一个都是真的。

在第 4 行中，只有当为`r`真时才`p`为真。在第 3 行中，这`p`是真的。因此，`r`也是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T21:46:59.200

您可以在不使用 q 的情况下删除 ^ q，因为 p ^ q 表示 p AND q -- p 与 q 无关。

您不能在不使用 p 的情况下删除 p -> 因为 p -> r 意味着 p 意味着 r - r 只有在 p 也是如此时才能保证为真。

# c++ - c ++实现跨线程池取消

> ID：908143
> 
> 赞同：4
> 
> 时间：2009-05-25T21:43:51.793
> 
> 标签：c++, multithreading

我有几个线程池，我希望我的应用程序处理取消操作。

为此，我实现了一个共享操作控制器对象，我在每个被调用的线程池工作函数中的不同位置进行轮询。

这是一个好的模型，还是有更好的方法？

我只是担心所有这些 operationController.checkState() 在整个代码中都乱七八糟。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-25T22:35:44.763

是的，这是一个很好的方法。Herb Sutter 有一篇[很好的文章](http://www.ddj.com/architect/207100682)，将其与替代品（更糟）进行了比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T21:49:38.570

对于任何类型的异步取消，您都将不得不定期轮询某种标志。有一个基本问题是必须将事物保持在一致的状态。如果你只是在它正在做的事情中杀死一个线程，那么坏事迟早会发生。

根据您实际在做什么，您可以忽略操作的结果而不是取消它。您让操作继续进行，但不要等待它完成，也不要检查结果。

如果您确实需要停止操作，那么您将不得不在适当的点进行轮询，并进行任何必要的清理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T21:50:42.653

这是一个很好的方法。

另一种可能的方法是，如果有一些其他子例程[s] 无论如何线程都会定期调用，则在该子例程中进行检查并抛出异常（在线程顶部被捕获），假设“取消”可能被认为是异常的，并假设线程正在执行的代码是异常安全的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-25T21:59:37.037

我不会那样做，检查共享对象。

我很可能会为每个线程对象提供一种方法来取消自己线程内的执行，无论是事件、线程安全状态变量还是其他。

共享操作控制器的问题在于，在我看来，逻辑是颠倒的，当它不控制任何东西时，为什么要称它为“控制器”？

对我来说，Operation Controller 将收到一个取消命令，然后依次选择适当的线程并发出信号让它们停止。如果您知道我的意思，那将是正确的“指挥链”。你这样做的方式是在线程上引入一种不自然的行为，它不会“服从”停止命令，而是每次检查他的“上级”是否“在某个地方写了命令”。不知何故，它只是感觉不对。

此外，如果您将来只停止一个“一些”线程怎么办？如果您想包含一些高级逻辑以便线程只会在给定条件下停止怎么办？然后你必须重写每个线程中的代码来处理这种情况。

因此，我将提供一种方法，让每个线程都能够处理给它们的信号，例如通过使用具有 FIFO 结构的[命令模式。](http://en.wikipedia.org/wiki/Command_pattern)

（顺便说一句，我意识到他们是线程池工作人员，而不是实际的线程类，但我认为每个工作人员都必须单独停止，而不是相反）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-25T22:22:52.277

在类似的情况下，我使用了一个事件，非自动重置，所有线程都可以查看该事件。与轮询非常相似，只是如果您的线程有时阻塞，它们也可以为“停止”事件休眠。（在 Windows 上更容易。）

/L

# unix - 如何重定向到标准输出？

> ID：908146
> 
> 赞同：4
> 
> 时间：2009-05-25T21:45:27.157
> 
> 标签：unix, stdout, redirect

我有一个用 ansi C 编写的 UNIX 应用程序，可以将数据直接写入文件。该文件由参数参数之一指定。

出于测试目的，我可以使用 /dev/null 作为文件名，这有效地将输出重定向到空。

我希望能够通过类似的方法将输出重定向到标准输出。这可能吗？如果是这样，怎么做？我试过以下没有运气：

> a.out -f /dev/ttys000

（其中 /dev/ttys000 是 'w' 列表指定的 tty）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-25T21:48:33.453

`/dev/stdout`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T21:50:23.450

您可以检测字符串“stdout”参数，然后在 C (1) [http://en.wikipedia.org/wiki/File_descriptor中使用标准输出文件句柄](http://en.wikipedia.org/wiki/File_descriptor)

或使用 /dev/stdout 或 /dev/fd/1

如果这是一个“内置”功能而不是临时测试的东西，您可能希望在 stdout 文件描述符而不是设备节点上使用 C 函数，因为 C 标准比 POSIX 标准更耐寒恕我直言.

# persistence - 工作流持久化 - WebServiceInputActivity

> ID：908163
> 
> 赞同：1
> 
> 时间：2009-05-25T21:51:02.107
> 
> 标签：persistence, workflow-foundation

[替代文字 http://home.elka.pw.edu.pl/~pkolodzi/Capture.PNG](http://home.elka.pw.edu.pl/~pkolodzi/Capture.PNG)

我用两种方法创建了**IAdder接口：** **PassA**和**PassB**。我的工作流程从通过**PassA**远程调用激活的**webServiceInputActivity1开始。**我的工作流程中的另一个元素是另一个**webServiceInputActivity2**元素。这次“IsActivating”属性设置为 false。我希望我的工作流程在第一个活动完成后保持不变（它确实返回 void）。应通过调用 PassB Web 方法重新激活工作流。

 ****在将工作流发布为 Web 服务并调用 PassA 之后，我得到了：

```
 System.InvalidOperationException: Workflow with id &quot;b0c5f9dd-57f3-427f-b172-17d4663f7eaf&quot; not found in state persistence store.
   at System.Workflow.Runtime.Hosting.PersistenceDBAccessor.RetrieveInstanceState(Guid instanceStateId, Guid ownerId, DateTime timeout)
   at System.Workflow.Runtime.Hosting.SqlWorkflowPersistenceService.LoadWorkflowInstanceState(Guid id)
   at System.Workflow.Runtime.WorkflowRuntime.InitializeExecutor(Guid instanceId, CreationContext context, WorkflowExecutor executor, WorkflowInstance workflowInstance)
   at System.Workflow.Runtime.WorkflowRuntime.Load(Guid key, CreationContext context, WorkflowInstance workflowInstance)
   at System.Workflow.Runtime.WorkflowRuntime.GetWorkflow(Guid instanceId)
   at System.Workflow.Activities.WorkflowWebService.Invoke(Type interfaceType, String methodName, Boolean isActivation, Object[] parameters)
   at PersistanceWebServiceWorkflow.Workflow1_WebService.PassA(Int32 a) in C:\Users\djpiter\AppData\Local\Temp\2dnwfnsn.cs:line 39 
```

你有什么想法我做错了吗？

ps：（数据库设置正确。我在控制台应用程序和延迟活动中托管的工作流上对其进行了测试。我还在web.config文件中添加了必要的行。）

亲切的问候 PK

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-25T22:03:36.560

如果您的某个活动会引发异常，则将从数据库中删除工作流状态信息。在 Debug - Exceptions - Common Language Runtime Exceptions 中配置“抛出异常时中断”运行您的工作流调试器

# sql - 如何获取每张发票的价格？

> ID：908164
> 
> 赞同：1
> 
> 时间：2009-05-25T21:51:21.700
> 
> 标签：sql, mysql

我正在开发一个每天处理大约 500 张发票的后端。我的数据库中有以下表格。

```
invoices
invoice_id int primary_key auto_increment
user_id varchar(10)
invoice_type enum { package, document }

users
user_id int primary_key auto_increment
rate_package_id int
rate_document_id int

rates
rate_id  int
rate_name  varchar(10)

rate_prices
price_id  int primary_key auto_increment
rate_id int
weight int
price double(8,2) 
```

在一天结束时，我必须为每张发票设置价格。

如何获取每张发票的价格？我实际上没有 ieda，除了将“rate_package_id”和“rate_package_document_id”添加到发票表中，这样我就可以直接从 rate_prices 查询价格。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-25T21:56:02.783

```
SELECT  invoice_id, price
FROM    invoices i
JOIN    users u
ON      u.user_id = i.user_id
JOIN    rates r
ON      r.rate_id = CASE WHEN i.invoice_type = package THEN u.rate_package_id ELSE u.rate_document_id END
JOIN    rate_prices p
ON      p.rate_id = r.rate_id 
```

不知道你把包裹的重量放在哪里。

似乎它必须是它`invoices`，在这种情况下只需将它添加到最后一个`JOIN`条件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T21:58:23.450

我假设您可能需要一个与发票关联的 LineItems 表，例如：

```
lineitem_id int primary_key auto_increment
invoice_id int
price_id int
quantity int
total_price double(8,2) 
```

然后，您有一个表格将价格与发票相关联，每张发票可以有 1 个或多个行项目。

# php - 解析文本中的 bbcode youtube 标签并替换为包含视频 ID 的 html

> ID：908167
> 
> 赞同：2
> 
> 时间：2009-05-25T21:52:35.397
> 
> 标签：php, parsing, youtube, bbcode, preg-replace-callback

我正在构建一个应该解析 bbcode 标签的博客，如下所示：

输入：`<youtube=http://www.youtube.com/watch?v=VIDEO_ID&feature=channel>`
输出：

```
<object width="400" height="245">
<param name="movie" value="http://www.youtube-    nocookie.com/v/VIDEO_ID&hl=en&fs=1&rel=0&showinfo=0"></param>
<param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param>
<embed src="http://www.youtube-nocookie.com/v/VIDEO_ID&hl=en&fs=1&rel=0&showinfo=0" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="400" height="245"></embed>
</object> 
```

到目前为止，我的功能非常简单，因为我已经陷入了最简单的部分！现在，我有一个主进程函数，它调用不同的进程函数。在这种情况下，其中之一是 processYouTubeVideos()。所以我这样称呼它：

```
$str = eregi_replace('\<youtube=([^>]*)\>', processYouTubeVideos("\\1"), $str); 
```

processYouTubeVideos() 完美地接收来自 youtube 标记内部的 URL，但由于某种原因，当使用 explode() （或拆分）时，永远找不到分隔符。即使使用“u”或“tube”之类的测试值......

```
function processYouTubeVideos ($str) {

    $params = explode("?", $str);
    $params = explode("&", $params[1]);

    return $params[0];

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-25T21:57:51.237

尝试：

```
$str = preg_replace('/<youtube=([^>]*)>/e', 'processYouTubeVideos("$1")', $str); 
```

您尝试运行的代码将不起作用，因为输出字符串上的函数将在目标模式而不是输出上调用。这意味着您要按字面意思向函数发送“\1”。添加`var_dump($str);`到函数的开头并尝试再次运行您的代码，您会清楚地看到这一点。

[preg_replace](http://se2.php.net/preg_replace)有一个特殊的标志“e”，您可以使用它在每次替换时执行一个函数。这通过在标记位置 ($1) 插入子模式，然后在代码上运行类似`eval()`or的东西`create_function()`来执行它并检索结果来工作。然后将其发送回`preg_replace()`并进行实际替换。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T22:05:20.783

processYouTubeVideos("\1") 函数在 eregi_replace*之前*运行。

以下是我相信你想要的：

```
$str = eregi_replace('\<youtube=([^>]*)\>', "\\1", $str);
$str = processYouTubeVideos($str); 
```

它执行替换，然后将结果值发送到 processYouTubeVideos。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-03-19T05:53:47.607

早期的两个答案现在都已被完全弃用。

现代技术是使用`preg_replace_callback()`，然后解析 url 并隔离查询字符串的目标部分。我将演示`sprintf()`在 html 模板字符串中使用占位符。

模式本身并没有花太多精力来验证 bbcode 标记，因此如果您需要强验证，则需要对模式进行改进。

代码：（[演示](https://3v4l.org/MYKdf)）

```
$bbCode = <<<BBCODE
Here is some text <youtube=http://www.youtube.com/watch?v=VIDEO_ID&feature=channel> and some more text
BBCODE;

echo preg_replace_callback(
         '~<youtube=([^>]+)>~',
         function ($m) {
             parse_str(parse_url($m[1], PHP_URL_QUERY), $queryStringArray);
             $videoId = $queryStringArray['v'] ?? null;
             if (!$videoId) {
                 return $m[0];  // do not replace bbcode because could not isolate the video id
             }
             return sprintf(
                        '<object width="400" height="245">
                             <param name="movie" value="http://www.youtube-nocookie.com/v/%1$s&hl=en&fs=1&rel=0&showinfo=0"></param>
                             <param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param>
                             <embed src="http://www.youtube-nocookie.com/v/%1$s&hl=en&fs=1&rel=0&showinfo=0" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="400" height="245"></embed>
                         </object>',
                         $videoId
                    );
         },
         $bbCode
     ); 
```

输出：

```
Here is some text <object width="400" height="245">
                             <param name="movie" value="http://www.youtube-nocookie.com/v/VIDEO_ID&hl=en&fs=1&rel=0&showinfo=0"></param>
                             <param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param>
                             <embed src="http://www.youtube-nocookie.com/v/VIDEO_ID&hl=en&fs=1&rel=0&showinfo=0" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="400" height="245"></embed>
                         </object> and some more text 
```

# java - 何时刷新 BufferedWriter

> ID：908168
> 
> 赞同：50
> 
> 时间：2009-05-25T21:52:59.530
> 
> 标签：java, io

在 Java 程序（Java 1.5）中，我有一个包装 Filewriter 的 BufferedWriter，我多次调用 write() ......生成的文件非常大......

在这个文件的行中，有一些是不完整的……

每次我写东西时我是否需要调用flush（但我怀疑它会效率低下）或使用另一种BufferedWriter方法或使用另一个类......？

（因为我有无数行要写，我确实想要一些非常有效的东西。）理想的“冲洗”时刻是什么？（当我达到 BufferedWriter 的容量时）...

在里面：

```
try {
  analysisOutput = new BufferedWriter(new FileWriter(
      "analysisResults", true));
  analysisOutput.newLine();
  analysisOutput.write("Processing File " + fileName + "\n");
} 
catch (FileNotFoundException ex) {
  ex.printStackTrace();
} 
catch (IOException ex) {
  ex.printStackTrace();
} 
```

写作：

```
private void printAfterInfo(String toBeMoved,HashMap<String, Boolean> afterMap, Location location)
  throws IOException {
    if(afterMap != null) {
      for (Map.Entry<String, Boolean> map : afterMap.entrySet()) {
        if (toBeMoved == "Condition") {
          if (1 <= DEBUG)
            System.out.println("###" + toBeMoved + " " + location + " "
                + conditionalDefs.get(conditionalDefs.size() - 1)
                + " After " + map.getKey() + " "
                + map.getValue() + "\n");

          analysisOutput.write("###" + toBeMoved + " " + location + " "
              + conditionalDefs.get(conditionalDefs.size() - 1)
              + " After " + map.getKey() + " " + map.getValue()
              + "\n");
        } else {
          if (1 <= DEBUG)
            System.out.println("###" + toBeMoved + " " + location + " "
                + map.getKey() + " After " 
                + map.getValue() + "\n");
          if (conditionalDefs.size() > 0)
            analysisOutput.write("###" + toBeMoved + " " + location + " "
                + conditionalDefs.get(conditionalDefs.size() - 1) + " "
                + map.getKey() + " After " + map.getValue()
                + "\n");
          else
            analysisOutput.write("###" + toBeMoved + " " + location + " " + map.getKey() + " After " + map.getValue() + "\n");

        }
      }
    } 
```

我刚刚发现不完整的行是“处理文件”之前的行......所以当我从一个我分析的文件切换到另一个文件时会发生这种情况......

结束：

```
dispatch(unit);

try {
  if (analysisOutput != null) {
    printFileInfo();
    analysisOutput.close();
  }
} 
catch (IOException ex) {
  ex.printStackTrace();
} 
```

有时 printFileInfo 打印出来的信息不会出现在结果文件中...

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-05-25T22:03:37.013

当`BufferedWriter`它填满它的缓冲区时，它将已经刷新。来自以下文档[`BufferedWriter.write`](http://java.sun.com/javase/6/docs/api/java/io/BufferedWriter.html#write)：

> 通常，此方法将给定数组中的字符存储到此流的缓冲区中， *并根据需要将缓冲区刷新到底层流*。

（强调我的。）

的重点`BufferedWriter`基本上是将大量的小写入合并为更少的大写入，因为这通常更有效（但编码更痛苦）。你不应该做任何特别的事情来让它正常工作，除了确保在你*完成*它时刷新它 - 并且调用`close()`将执行此操作并刷新/关闭底层编写器。

换句话说，放松 - 只需写入、写入、写入和关闭 :) 通常需要`flush`手动调用的唯一时间是，如果您现在真的非常需要将数据保存在磁盘上。（例如，如果您有一个永久记录器，您可能希望每隔一段时间刷新一次，这样读取日志的人就不需要等到缓冲区满了才能看到新的日志条目！）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-25T21:55:59.460

理想的刷新时刻是在文件关闭之前，您需要另一个程序读取文件以查看已写入的数据。在许多情况下，这从来都不是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-10-11T14:12:31.047

如果你有一个循环交替`init`and `printAfterInfo`，我对你的问题的猜测是你`close`在同一个文件上创建一个新的之前没有你的作家。您最好创建`BufferedWriter`一次并在所有处理结束时关闭它。

# c# - 将 C# 对象渲染为 Html

> ID：908181
> 
> 赞同：7
> 
> 时间：2009-05-25T21:57:43.593
> 
> 标签：c#, html, rendering, template-engine

我们有一堆域实体，它们应该呈现为 html 格式，在弹出窗口中显示它们的详细信息。

我很乐意做这样的事情：

```
Product product = new Product(...);
product.ToHtml();  // or: HtmlRenderer.Render(Product); 
```

但我的主要问题是如何从后面做这些事情。我有3个不同的答案：

**1\. 按代码渲染：**

我可以简单地编写用于在 ToHtml 方法 (C#) 中呈现 Html 的代码 - 问题在于它*过于*静态。如果您想将标题移动一点到中间，您应该更改代码。此外，在 C# 中很难阅读 Html 缩进。

**2\. 使用 XSL：**

XSL Files 可以轻松管理 Html 模板，并且使用 XSLT 我可以将 XML 文件转换到文档的正确位置。已经由其他人编写的解析器（只需要学习语法）**为此，我们需要每个对象都可以序列化为 Xml。并且如果对象更改-> Xml 将更改-> xslt 也需要更改** 这也将使我可以轻松缩进 html 的选项，例如：添加 css 功能和\或更改 html 设计

**3.使用其他模板引擎：**

编写我自己的 C# -> Html 模板引擎，这样它将从文件 (*.template) 中读取模板，并使用反射在模板的正确位置插入正确的属性。** 在这个解决方案中，我们有很多可以想到的问题，例如：语法应该是怎样的？这东西好吗？ **%Name%** %Description% 以及我们如何处理数组？** 也许我们可以使用现有的引擎（Brail 或 T4-Templating）？

你喜欢哪个？你知道一个好的引擎吗？现在我更喜欢第二种解决方案，但它会很慢。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-25T22:21:28.223

我曾经需要将任何类型的集合呈现给 Html 表。我在 IEnumerable<T> 上创建了一个扩展方法，该方法具有 css 等的重载。你可以在这里看到我的博客文章：

[http://crazorsharp.blogspot.com/2009/03/cool-ienumberable-extension-method_25.html](http://crazorsharp.blogspot.com/2009/03/cool-ienumberable-extension-method_25.html)

它使用反射来获取对象的所有属性，并渲染一个漂亮的小桌子。看看这是否适合你。

```
[System.Runtime.CompilerServices.Extension()]
public string ToHtmlTable<T>(IEnumerable<T> list, string propertiesToIncludeAsColumns = "")
{
    return ToHtmlTable(list, string.Empty, string.Empty, string.Empty, string.Empty, propertiesToIncludeAsColumns);
}

[System.Runtime.CompilerServices.Extension()]
public string ToHtmlTable<T>(IEnumerable<T> list, string tableSyle, string headerStyle, string rowStyle, string alternateRowStyle, string propertiesToIncludeAsColumns = "")
{
    dynamic result = new StringBuilder();
    if (String.IsNullOrEmpty(tableSyle)) {
        result.Append("<table id=\"" + typeof(T).Name + "Table\">");
    } else {
        result.Append((Convert.ToString("<table id=\"" + typeof(T).Name + "Table\" class=\"") + tableSyle) + "\">");
    }

    dynamic propertyArray = typeof(T).GetProperties();

    foreach (object prop in propertyArray) {
       if (string.IsNullOrEmpty(propertiesToIncludeAsColumns) || propertiesToIncludeAsColumns.Contains(prop.Name + ",")) {
        if (String.IsNullOrEmpty(headerStyle)) {
            result.AppendFormat("<th>{0}</th>", prop.Name);
        } else {
            result.AppendFormat("<th class=\"{0}\">{1}</th>", headerStyle, prop.Name);
        }
      }
    }

    for (int i = 0; i <= list.Count() - 1; i++) {
        if (!String.IsNullOrEmpty(rowStyle) && !String.IsNullOrEmpty(alternateRowStyle)) {
            result.AppendFormat("<tr class=\"{0}\">", i % 2 == 0 ? rowStyle : alternateRowStyle);

        } else {
            result.AppendFormat("<tr>");
        }
        foreach (object prop in propertyArray) {
            if (string.IsNullOrEmpty(propertiesToIncludeAsColumns) || propertiesToIncludeAsColumns.Contains(prop.Name + ",")) {
                object value = prop.GetValue(list.ElementAt(i), null);
                result.AppendFormat("<td>{0}</td>", value ?? String.Empty);
            }
        }
        result.AppendLine("</tr>");
    }

    result.Append("</table>");

    return result.ToString();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-25T22:02:56.810

这是您的视图的工作，而不是您的控制器或模型。正如您所怀疑的，使用方法 (1) 会使您的更改非常脆弱。相反，为您希望呈现特定域实体的每种方式编写一个视图片段。然后只需拉入适当的视图来构建您的最终页面。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-26T02:26:06.297

我完全同意约翰·费米内拉的看法。将 Html 渲染直接集成到您的域实体中是对您的域的可怕污染，具有完全任意和外部的关注。就像约翰说的那样，这样做会让你的实体变得非常脆弱，并打破这两个关键规则：关注点分离和单一职责。

从您给出的选择来看，#3 是最接近合适的方法。您无需编写自己的模板引擎。网上有很多免费和现成的模板引擎可以很好地完成这项工作（NVelocity、StringTemplate、Brail 等）

在您的演示文稿/视图中继续渲染它所属的位置，并且不要用更高级别的问题污染您的域。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-25T22:03:50.833

我真诚地喜欢方法 A。HTML 已经是一个标准，所以你不应该用 XML（通过 XSL - 方法 2）或自定义格式（方法 3）等中间格式来打败自己。

但是，如果写入/用于 ASP.NET MVC，您可以构建一个 .ASCX（用户控件）来接受您的类型的对象并呈现适当的 HTML。而且你不会得到讨厌的 C# 缩进，也不会突出显示或自动完成。

您还可以编写多个用户视图来适应一种对象类型的不同场景。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-25T22:06:41.170

您是否有理由不想创建将域实体对象作为参数的自定义控件 .ascx 文件，然后您可以以任何您想要的方式制作 gui。通过这种方式，您可以动态地将控件添加到页面并设置一个属性来填充它们。

**编辑 1：** 只需将控件呈现给 HTMLTextWriter 而不是将其放置在页面上。

```
 StringBuilder outString = new StringBuilder();
        StringWriter outWriter = new StringWriter(outString);
        HtmlTextWriter htmlText = new HtmlTextWriter(outWriter);
        System.Web.UI.WebControls.Label lbl1 = new System.Web.UI.WebControls.Label();
        lbl1.Text = "This is just a test!";
        lbl1.ToolTip = "Really";
        lbl1.RenderControl(htmlText);
        ViewData["Output"] = outString.ToString(); 
```

输出

```
<span title="Really">This is just a test!</span> 
```

当然使用您的自定义控件而不是内置控件，但这是一个快速简单的演示。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-03T02:20:16.557

经过一番研究，我制作了自己的函数来将任何对象转换为 HtmlString。

VB .Net 代码：

```
 Public Function ToHtmlString(ByVal fObj As Object) As String
    Dim pType = fObj.GetType()
    Dim props As IList(Of PropertyInfo) = pType.GetProperties()
    Dim value As Object = Nothing
    Dim htmlString As String = "<html><body><form>"

    For Each p In props
        value = p.GetValue(fObj, Nothing)
        If value <> Nothing Then
            htmlString += String.Format("<input type=""hidden"" name=""{0}"" id=""{0}"" value=""{1}""/>", p.Name, value)
        End If
    Next

    htmlString += "</form></body></html>"
    Return htmlString.ToString() 
```

它将从特定对象中获取属性名称和值。您可以根据您的

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T02:02:28.263

就个人而言，我会结合方法二和三：只需使用反射创建一个通用 XML 文档，例如：

```
<object type="xxxx">
    <property name="ttt" value="vvv"/>
    ...
</object> 
```

并使用 XSTL 样式表从中创建实际的 HTML。

# yacc - YACC 编译错误

> ID：908184
> 
> 赞同：2
> 
> 时间：2009-05-25T21:58:06.773
> 
> 标签：yacc, nmake, newline

我正在 PC 上使用 Cygwin shell 编译 YACC 文件。我得到一个“未知字符\15”。奇怪的是，另一台机器上的同事可以使用相同的 shell 编译完全相同的文件，而不会出现警告或错误。我需要在我的 shell 或编译器中设置某种标志吗？我们正在使用 nmake 和 Visual Studio 编译器。如果需要，我很乐意提供更多信息。

非常感谢你！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-25T22:02:46.267

检查您的行尾设置。您可能有 CRLF，而 YACC 只需要 LF。CR 是 ASCII 13（八进制的 15）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T22:19:33.953

当您安装 cygwin 时，您会被询问默认的 EOL（行尾）应该是什么，传统的 unix "\n" 或传统的 dos "\r\n"。我的猜测是您和您的同事对 cygwin 的配置不同。您可能想再次运行 setup.exe 并选择 dos EOL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T22:03:26.683

八进制 15 是回车。您是否从同事的机器上以文本模式传输文件？

# disk - 有什么方法可以检测驱动器是否为 SSD？

> ID：908188
> 
> 赞同：36
> 
> 时间：2009-05-25T21:59:06.773
> 
> 标签：disk, hard-drive, solid-state-drive

我正准备发布一个只对普通硬盘有效的工具，而不是 SSD（固态硬盘）。事实上，它不应该与 SSD 一起使用，因为它会导致大量读取/写入而没有真正的效果。

任何人都知道一种检测给定驱动器是否为固态的方法？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2012-10-19T18:04:58.093

**终于找到可靠的解决方案了！**其中两个，实际上！

检查 /sys/block/sdX/queue/rotational，其中*sdX*是驱动器名称。如果为 0，则表示您正在处理 SSD，而 1 表示普通的旧 HDD。

我无法确定引入它的 Linux 版本，但它存在于 Ubuntu 的 Linux 3.2 和 vanilla Linux 3.6 中，而不存在于 vanilla 2.6.38 中。Oracle 还将它[反向移植](https://oss.oracle.com/el5/docs/RELEASE-NOTES-U5-en.html)到基于 2.6.32 的 Unbreakable Enterprise 内核 5.5。

还有一个 ioctl 来检查驱动器是否自 Linux 3.3 以来是旋转的，由[this commit](https://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=ef00f59c95fe6e002e7c6e3663cdea65e253f4cc)引入。不过，使用 sysfs 通常更方便。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-25T22:22:06.773

You can actually fairly easily determine the rotational latency -- I did this once as part of a university project. It is described in [this report](http://daimi.au.dk/~mg/mamian/random-bits.pdf). You'll want to skip to page 7 where you see some nice graphs of the latency. It goes from about 9.3 ms to 1.1 ms -- a drop of 8.2 ms. That corresponds directly to `60 s / 8.2 ms = 7317 RPM`.

It was done [with simple C code](http://daimi.au.dk/~mg/mamian/src/) -- here's the part that measures the between positions `a`and `b` in a scratch file. We did this with larger and larger `b` values until we have been wandered all the way around a cylinder:

```
/* Measure the difference in access time between a and b.  The result
 * is measured in nanoseconds. */
int measure_latency(off_t a, off_t b) {
  cycles_t ta, tb;

  overflow_disk_buffer();

  lseek(work_file, a, SEEK_SET);
  read(work_file, buf, KiB/2);

  ta = get_cycles();
  lseek(work_file, b, SEEK_SET);
  read(work_file, buf, KiB/2);
  tb = get_cycles();

  int diff = (tb - ta)/cycles_per_ns;
  fprintf(stderr, "%i KiB to %i KiB: %i nsec\n", a / KiB, b / KiB, diff);
  return diff;
}

```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-09-07T11:51:15.250

此命令`lsblk -d -o name,rota`列出您的驱动器，如果是旋转磁盘，则 ROTA 为 1，如果是 SSD，则为 0。示例输出：

```
名称罗塔
sda 1
数据库 0

```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-25T22:23:17.190

Detecting SSDs is not as impossible as dseifert makes out. There is already some progress in linux's libata ([http://linux.derkeiler.com/Mailing-Lists/Kernel/2009-04/msg03625.html](http://linux.derkeiler.com/Mailing-Lists/Kernel/2009-04/msg03625.html)), though it doesn't seem user-ready yet.

And I definitely understand why this needs to be done. It's basically the difference between a linked list and an array. Defragmentation and such is usually counter-productive on a SSD.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-25T22:22:14.947

You could get lucky by running

```
smartctl -i sda 
```

from [Smartmontools](http://smartmontools.sourceforge.net/). Almost all SSDs has SSD in the Model field. No guarantee though.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-07-24T15:56:24.140

我的两分钱来回答这个古老但非常重要的问题......如果通过 SCSI 访问磁盘，那么您将（可能）能够使用 SCSI INQUIRY 命令来请求其旋转速率。VPD（重要产品数据）页面被调用`Block Device Characteristics`并有一个数字`0xB1`。本页的字节 4 和 5 包含一个具有含义的数字：

*   0000h “未报告中等转速”
*   0001h “非旋转介质（例如，固态）”
*   0002h - 0400h “保留”
*   0401h - FFFEh “以每分钟转数表示的标称中等转速（即 rpm）（例如，7 200 rpm = 1C20h、10 000 rpm = 2710h 和 15 000 rpm = 3A98h）”
*   FFFFh “保留”

所以，SSD在这个领域必须有`0001h`。`T10.org`可以在[此处](ftp://www.t10.org/t10/document.07/07-203r0.pdf)找到有关此页面的文档。

但是，我不清楚该标准的实施情况。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-05-12T16:26:20.107

我编写了以下 javascript 代码。我需要确定机器是否正在使用 SSD 驱动器以及它是否是引导驱动器。该解决方案使用 MSFT_PhysicalDisk WMI 接口。

```
function main()
{
    var retval= false;
    // MediaType - 0 Unknown, 3 HDD, 4 SSD
    // SpindleSpeed - -1 has rotational speed, 0 has no rotational speed (SSD)
    // DeviceID - 0 boot device
    var objWMIService = GetObject("winmgmts:\\\\.\\root\\Microsoft\\Windows\\Storage");
    var colItems = objWMIService.ExecQuery("select * from MSFT_PhysicalDisk");  
    var enumItems = new Enumerator(colItems);
    for (; !enumItems.atEnd(); enumItems.moveNext()) 
    {
        var objItem = enumItems.item();
        if (objItem.MediaType == 4 && objItem.SpindleSpeed == 0)
        {
            if (objItem.DeviceID ==0)
            {
                retval=true;
            }
        }
    }
    if (retval)
    {
        WScript.Echo("You have SSD Drive and it is your boot drive.");
    }
    else
    {
        WScript.Echo("You do not have SSD Drive");
    }
    return retval;
}
main(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-25T22:13:05.387

SSD devices emulate a hard disk device interface, so they can just be used like hard disks. This also means that there is no general way to detect what they are.

You probably could use some characteristics of the drive (latency, speed, size), though this won't be accurate for all drives. Another possibility may be to look at the S.M.A.R.T. data and see whether you can determine the type of disk through this (by model name, certain values), however unless you keep a database of all drives out there, this is not gonna be 100% accurate either.

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2019-03-09T17:40:15.943

写文本文件
读文本文件

重复10000次...

`10000/elapsed`

对于 ssd 会更高，python3：

```
def ssd_test():

    doc = 'ssd_test.txt'
    start = time.time()
    for i in range(10000):
        with open(doc, 'w+') as f:
            f.write('ssd test')
            f.close()
        with open(doc, 'r') as f:
            ret = f.read()
            f.close()
    stop = time.time()
    elapsed = stop - start
    ios = int(10000/elapsed)
    hd = 'HDD'
    if ios > 6000: # ssd>8000; hdd <4000
        hd = 'SSD'
    print('detecting hard drive type by read/write speed')
    print('ios', ios, 'hard drive type', hd)
    return hd 
```

# iphone - 如何让控制器远离xib

> ID：908208
> 
> 赞同：3
> 
> 时间：2009-05-25T22:04:41.643
> 
> 标签：iphone, interface-builder

作为一个新手，IB 和所有可能的联系让我感到困惑。我发现的大多数教程都是我所说的意大利面条代码的转世，其中纠缠是通过拖动创建的所有连接。当然，我想使用 IB 来布局视图（调整大小和放置视觉元素），这就是 IB 的优势所在。但是控制器不是视图，因此如果我的所有控制器都是单独的代码并且不出现在 IB 中的任何位置，那么它就不那么令人困惑了。我怀疑这会使意大利面最小化。它还鼓励一个 xib-per-view 警告。为此，这里的问题是，我在哪里可以找到符合此策略的示例项目？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-25T23:02:48.640

我没有一组示例项目，但我会给你一些关于事情如何工作以及何时应该在 XIB 文件或代码中创建控制器的信息。

如果您的控制器是通过用户操作动态创建的，您通常不会在 XIB 文件中实例化它们。相反，您将在代码中实例化它们，就像上面提到的伤害一样。一旦你这样做了，你仍然需要一种机制来将这个在代码中创建的控制器连接到你在 IB 中创建的用户界面元素。

IB 为解决这个问题提供的机制是文件的所有者。掌握文件的所有者对于“获取”Interface Builder 至关重要。

文件的所有者不是 XIB 文件“中”的对象，它是 XIB 文件中表示的对象。它是加载 XIB 文件时已经存在的对象的占位符。在运行时加载 NIB 文件时，它们会使用 NSBundle 方法 -[NSBundle loadNibNamed:ownwer:options:] 加载。owner 参数用于在 XIB/NIB 文件中解析文件的所有者占位符对象。在运行时加载文件时，针对文件所有者建立的所有连接都将针对您作为所有者参数传递给 NSBundle 方法的对象进行解析。在 iPhone 上，您通常不会自己加载 NIB 文件。取而代之的是 UIViewController 为你做的。UIViewController 的 loadView 方法的默认实现可能如下所示：

```
- (void)loadView {
    [[self nibBundle] loadNibNamed:[self nibName] owner:self options:nil];
} 
```

因此，通过将您的 XIB 文件中的元素连接到文件的所有者，您将把它们连接到您的视图控制器。

您将拥有一些静态地在您的应用程序中的控制器——它们将永远存在。导航或选项卡控制器及其根项通常在其应用程序的整个生命周期中都存在。在这种情况下，我会在 MainWindow.xib 文件中设置这些视图控制器。大多数其他控制器将动态创建，并以编程方式响应用户所做的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T22:16:13.523

Good question. The pattern I try to stick with is making the controller in code, adding IBOutlets and IBActions for the things in the XIB/NIB that interact with that code, and a thing in the controller's constructor which loads the XIB/NIB with "self" as the owner, and in IB I connect stuff to the "File's Owner" placeholder, whose identity I will have specified to be the my controller's class.

# iphone - 包含 AVAudioPlayer 的问题

> ID：908209
> 
> 赞同：7
> 
> 时间：2009-05-25T22:04:53.717
> 
> 标签：iphone

我正在尝试将此类用作

```
AVAudioPlayer *newPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL: fileURL error: nil]; 
```

并得到这个编译器错误

```
error: AVAudioPlayer.h no such file or directory 
```

我在文件`#import "AVAudioPlayer.h`开头添加了`.m`

你能告诉我我该如何解决吗？

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-10-10T10:01:14.427

代替

`#import "AVAudioPlayer.h"`

尝试

`#import <AVFoundation/AVAudioPlayer.h>`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-26T23:44:01.907

将 AVFoundation 框架添加到您的项目中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-30T02:56:56.550

问题在于，正如拳头所说，您可能没有将框架添加到您的项目中。您需要转到 Frameworks 文件夹（在左侧的项目树中，通常只是在**Resources**文件夹下方），右键单击**Frameworks->Add->Existing Frameworks..** '，然后从列表中选择**AVFoundation 。**请注意，默认情况下 XCode 将打开您设置的 Active SDK 的 frameworks 文件夹，因此它必须至少是 OS 2.2 才能显示（这是苹果发布它时的最早版本）。一旦你添加了框架，它应该编译和链接，你不必手动添加 h 文件。

希望它有所帮助，-Adi

# php - Textmate 和 PHP - 捆绑包有一些问题

> ID：908211
> 
> 赞同：1
> 
> 时间：2009-05-25T22:05:31.983
> 
> 标签：php, editor, textmate

我一直在使用 Textmate 编写 Ruby/Python 脚本，现在需要破解一些 PHP。我在使用捆绑包时遇到了一些问题：

1.  代码高亮不支持 HTML...
2.  当我键入`php`+ tab TM 时吐出：

    ```
    ?><?php> 
    ```

    代替：

    ```
    <?php ?> 
    ```

任何人都知道我可能会出错吗？提前致谢...

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-25T22:16:30.963

将文件类型更改为 HTML（即使您正在编辑 .php 文件！）将解决问题。

其原因记录在[http://wiki.macromates.com/Troubleshooting/PHPSyntaxHighlight](http://wiki.macromates.com/Troubleshooting/PHPSyntaxHighlight)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-31T14:44:00.843

不，最好的方法是在底部状态栏中将语言设置为“HTML”。

![状态栏，改为](https://i.stack.imgur.com/CqAxH.png)

你仍然可以让文件名以 php 结尾

# opengl-es - 为什么在 OpenGL ES 中缩小对象会导致对象变轻？

> ID：908218
> 
> 赞同：4
> 
> 时间：2009-05-25T22:08:19.343
> 
> 标签：opengl-es

为什么在 OpenGL ES 1.x 中缩放（均匀）对象会导致对象更轻？

更有意义的是它会变暗，因为法线不是按比例缩小也会使物体变暗吗？但由于某种原因，物体变得更轻了。当我放大时，物体变得更暗。在我看来，这应该是相反的。

请不要建议使用 GL_NORMALIZE 等。我只是好奇为什么 OpenGL 实现会这样工作。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T10:13:59.063

简单的问题，复杂的答案。这是红皮书的相关摘录：

> 转换法线
> 
> 法线向量的变换方式与顶点或位置向量不同。在数学上，最好不要将法线向量视为向量，而是将其视为垂直于这些向量的平面。然后，法向量的变换规则由垂直平面的变换规则描述。齐次平面由行向量 (a , b, c, d) 表示，其中 a、b、c 或 d 中的至少一个为非零。如果 q 是非零实数，则 (a, b, c, d) 和 (qa, qb, qc, qd) 表示同一平面。如果 ax+by+cz+dw = 0，则点 (x, y, z, w)T 在平面 (a, b, c, d) 上。（如果 w = 1，这是欧几里得的标准描述平面。）为了让 (a, b, c, d) 表示欧几里得平面，a、b 或 c 中的至少一个必须为非零。如果它们都为零，那么 (0, 0, 0,
> 
> 如果 p 是齐次平面且 v 是齐次顶点，则语句“v 位于平面 p 上”在数学上写为 pv = 0，其中 pv 是正常矩阵乘法。如果 M 是一个非奇异顶点变换（即具有逆 M-1 的 4 × 4 矩阵），则 pv = 0 等价于 pM-1Mv = 0，因此 Mv 位于平面 pM-1 上。因此，pM-1 是顶点变换 M 下的平面图像。
> 
> 如果您喜欢将法线向量视为向量而不是垂直于它们的平面，则设 v 和 n 为向量，使得 v 垂直于 n。那么，nTv = 0。因此，对于任意非奇异变换 M，nTM-1Mv = 0，这意味着 nTM-1 是变换后的法向量的转置。因此，变换后的法向量是**(M-1)T** n 。换句话说，法线向量是通过变换点的变换的逆转置来变换的。哇！

简而言之，位置和法线的变换方式不同。如前文所述，法线变换矩阵为**(M-1)T**。将 M 缩放到 sM 将导致**(M-1)T/s**：比例因子越小，转换后的法线越大……我们开始吧！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T22:47:15.597

看起来法线没有随对象缩放。这意味着全尺寸对象的法线将大大覆盖较小尺寸的对象。这将导致光源和法线之间的角度完全相同，但表面要小得多。

# c++ - C++ 中是否有任何函数可以计算保证至少 64 位宽的字符串的指纹或散列？

> ID：908227
> 
> 赞同：2
> 
> 时间：2009-05-25T22:12:34.793
> 
> 标签：c++, stl, boost

C++ 中是否有任何函数可以计算保证至少 64 位宽的字符串的指纹或散列？

我想将我的替换`unordered_map<string, int>`为`unordered_map<long long, int>`.

鉴于我得到的答案（感谢 Stack Overflow 社区......）我所描述的技术并不为人所知。我想要一个无序的指纹图而不是字符串的原因是为了空间和速度。第二个映射不必存储字符串，并且在进行查找时，它不会导致任何额外的缓存未命中来获取这些字符串。唯一的缺点是碰撞的可能性很小。这就是为什么密钥必须是 64 位的原因：2^(-64) 的概率基本上是不可能的。当然，这是基于一个好的散列函数，这正是我的问题所寻求的。

再次感谢 Stack Overflowers。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-25T22:26:18.840

`unordered_map`总是将密钥散列到`size_t`变量中。这与密钥的类型无关，完全取决于您正在使用的架构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T22:26:45.483

如果要将任何字符串映射到唯一整数：

```
typedef std::map<string,long long> Strings;
static Strings s_strings;
long long s_highWaterMark = 0;
long long my_function(const string& s)
{
  Strings::const_iterator it = s_strings.find(s);
  if (it != s_strings.end())
  {
    //we've previously returned a fingerprint for this string
    //now return the same fingerprint again
    return it->second;
  }
  //else new fingerprint
  long long rc = ++s_highWaterMark;
  //... remember it for next time
  s_strings.insert(Strings::value_type(s, rc));
  //... and return it this time
  return rc;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T02:26:40.397

c++ 没有原生 128 位类型，也没有原生散列支持。应该在 TR1 中添加此类散列扩展，但据我所知，我的许多编译器不支持 128 位整数。（微软支持一种`__int128`类型——虽然只在 x64 平台上）

我希望 unordered_map 包含的函数在任何情况下都会更快。

如果你真的想那样做，MD5 提供了一个很好的 128 位散列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T22:16:23.587

你想要达到的究竟是什么？使用“更大”的哈希函数，您的地图不会更好地工作。无论如何，并不显着。

# sql-server - Deploy SQL Server Schema Changes using SQLCMD

> ID：908235
> 
> 赞同：2
> 
> 时间：2009-05-25T22:17:12.087
> 
> 标签：sql-server

I'm using Visual Studio Team System 2008's Database tools to develop my databases. On my local dev machine, when I want to deploy schema changes to the SQL Server instance on my machine, I just use the Data --> Schema Compare feature of VS2008.

But with live databases I can't do this because I can't connect to the database directly from my machine and the server haven't got VS2008 installed.

So I was thinking about the SQLCMD tool. Isn't that what VS2008 uses "under the hood"?

I want to use as part of an automatic deployment strategy. I want to be able to publish SQL scripts generated by VS2008 to the server and have an application run scripts on the live database to update the schema.

**UPDATE**

**I'm trying to achieve automatic change script generation by taking the deploy script VS2008 Database Edition generates and comparing it against a live database. Only I want to do it through code, no tool or anything. It must be able to run from a Windows Service on the server.**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-25T22:24:34.537

SqlCmd would work. If you also want automatic versioning support you should check out [Tarantino.Net](http://code.google.com/p/tarantino/wiki/DatabaseChangeManagement), a database management tool that keeps track of which sql-files have already been run.

# c++ - 在运行时获取模板元编程编译时常量

> ID：908256
> 
> 赞同：46
> 
> 时间：2009-05-25T22:24:56.640
> 
> 标签：c++, templates, runtime, metaprogramming

### 背景

考虑以下：

```
template <unsigned N>
struct Fibonacci
{
    enum
    {
        value = Fibonacci<N-1>::value + Fibonacci<N-2>::value
    };
};

template <>
struct Fibonacci<1>
{
    enum
    {
        value = 1
    };
};

template <>
struct Fibonacci<0>
{
    enum
    {
        value = 0
    };
}; 
```

这是一个常见的例子，我们可以将斐波那契数的值作为编译时常量：

```
int main(void)
{
    std::cout << "Fibonacci(15) = ";
    std::cout << Fibonacci<15>::value;
    std::cout << std::endl;
} 
```

但是您显然无法在运行时获得该值：

```
int main(void)
{
    std::srand(static_cast<unsigned>(std::time(0)));

    // ensure the table exists up to a certain size
    // (even though the rest of the code won't work)
    static const unsigned fibbMax = 20;
    Fibonacci<fibbMax>::value;

    // get index into sequence
    unsigned fibb = std::rand() % fibbMax;

    std::cout << "Fibonacci(" << fibb << ") = ";
    std::cout << Fibonacci<fibb>::value;
    std::cout << std::endl;
} 
```

因为**fibb**不是编译时常量。

### 问题

所以我的问题是：

在运行时查看此表的最佳方法是什么？最明显的解决方案（“解决方案”应该轻描淡写）是有一个大的 switch 语句：

```
unsigned fibonacci(unsigned index)
{
    switch (index)
    {
    case 0:
        return Fibonacci<0>::value;
    case 1:
        return Fibonacci<1>::value;
    case 2:
        return Fibonacci<2>::value;
    .
    .
    .
    case 20:
        return Fibonacci<20>::value;
    default:
        return fibonacci(index - 1) + fibonacci(index - 2);
    }
}

int main(void)
{
    std::srand(static_cast<unsigned>(std::time(0)));

    static const unsigned fibbMax = 20;    

    // get index into sequence
    unsigned fibb = std::rand() % fibbMax;

    std::cout << "Fibonacci(" << fibb << ") = ";
    std::cout << fibonacci(fibb);
    std::cout << std::endl;
} 
```

但是现在表格的大小是非常硬编码的，将其扩展为 40 并不容易。

我想出的唯一一个具有类似查询方法的方法是：

```
template <int TableSize = 40>
class FibonacciTable
{
public:
    enum
    {
        max = TableSize
    };

    static unsigned get(unsigned index)
    {
        if (index == TableSize)
        {
            return Fibonacci<TableSize>::value;
        }
        else
        {
            // too far, pass downwards
            return FibonacciTable<TableSize - 1>::get(index);
        }
    }
};

template <>
class FibonacciTable<0>
{
public:
    enum
    {
        max = 0
    };

    static unsigned get(unsigned)
    {
        // doesn't matter, no where else to go.
        // must be 0, or the original value was
        // not in table
        return 0;
    }
};

int main(void)
{
    std::srand(static_cast<unsigned>(std::time(0)));

    // get index into sequence
    unsigned fibb = std::rand() % FibonacciTable<>::max;

    std::cout << "Fibonacci(" << fibb << ") = ";
    std::cout << FibonacciTable<>::get(fibb);
    std::cout << std::endl;
} 
```

这似乎工作得很好。我看到的唯一两个问题是：

*   调用堆栈可能很大，因为计算 Fibonacci<2> 需要我们通过 TableMax 一直到 2，并且：

*   如果该值在表之外，则返回零而不是计算它。

那么我有什么遗漏吗？似乎应该有更好的方法在运行时挑选出这些值。

一个 switch 语句的模板元编程版本可能会生成一个特定数量的 switch 语句？

提前致谢。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-25T23:16:14.090

```
template <unsigned long N>
struct Fibonacci
{
    enum
    {
        value = Fibonacci<N-1>::value + Fibonacci<N-2>::value
    };
    static void add_values(vector<unsigned long>& v)
    {
        Fibonacci<N-1>::add_values(v);
        v.push_back(value);
    }
};

template <>
struct Fibonacci<0>
{
    enum
    {
        value = 0
    };
    static void add_values(vector<unsigned long>& v)
    {
        v.push_back(value);
    }

};

template <>
struct Fibonacci<1>
{
    enum
    {
        value = 1
    };
    static void add_values(vector<unsigned long>& v)
    {
        Fibonacci<0>::add_values(v);
        v.push_back(value);
    }
};

int main()
{
    vector<unsigned long> fibonacci_seq;
    Fibonacci<45>::add_values(fibonacci_seq);
    for (int i = 0; i <= 45; ++i)
        cout << "F" << i << " is " << fibonacci_seq[i] << '\n';
} 
```

经过深思熟虑，我想出了这个解决方案。当然，您仍然必须在运行时将值添加到容器中，但（重要的是）它们不是在运行时*计算*的。

附带说明一下，重要的是不要在`Fibonacci<1>`上面定义`Fibonacci<0>`，否则编译器在解析对 的调用时会感到*非常*`Fibonacci<0>::add_values`困惑，因为`Fibonacci<0>`没有指定模板特化。

当然，TMP 有其局限性：您需要预先计算的最大值，并且在运行时获取值需要递归（因为模板是递归定义的）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-05-18T06:11:16.620

我知道这个问题很老，但它引起了我的兴趣，我不得不尝试在运行时不填充动态容器的情况下进行操作：

```
#ifndef _FIBONACCI_HPP
#define _FIBONACCI_HPP

template <unsigned long N>
struct Fibonacci
{
    static const unsigned long long value = Fibonacci<N-1>::value + Fibonacci<N-2>::value;

    static unsigned long long get_value(unsigned long n)
    {
        switch (n) {
            case N:
                return value;
            default:
                return n < N    ? Fibonacci<N-1>::get_value(n)
                                : get_value(n-2) + get_value(n-1);
        }
    }
};

template <>
struct Fibonacci<0>
{
    static const unsigned long long value = 0;

    static unsigned long long get_value(unsigned long n)
    {
        return value;
    }
};

template <>
struct Fibonacci<1>
{
    static const unsigned long long value = 1;

    static unsigned long get_value(unsigned long n)
    {
        return value;
    }
};

#endif 
```

这似乎可行，并且当使用优化编译时（不确定您是否要允许），调用堆栈不会深入 - 当然对于值（参数）n> N，堆栈上有正常的运行时递归，其中 N 是模板实例化中使用的 TableSize。但是，一旦您低于 TableSize，生成的代码将替换在编译时计算的常量，或者最坏的情况是通过跳过跳转表“计算”的值（在 gcc 中使用 -c -g -Wa,-adhlns=main. s 并检查了清单），与我认为您的显式 switch 语句会导致的结果相同。

像这样使用时：

```
int main()
{
    std::cout << "F" << 39 << " is " << Fibonacci<40>::get_value(39) << '\n';
    std::cout << "F" << 45 << " is " << Fibonacci<40>::get_value(45) << '\n';
} 
```

在第一种情况下根本没有计算调用（在编译时计算的值），在第二种情况下调用堆栈深度最差：

```
fibtest.exe!Fibonacci<40>::get_value(unsigned long n=41)  Line 18 + 0xe bytes    C++
fibtest.exe!Fibonacci<40>::get_value(unsigned long n=42)  Line 18 + 0x2c bytes    C++
fibtest.exe!Fibonacci<40>::get_value(unsigned long n=43)  Line 18 + 0x2c bytes    C++
fibtest.exe!Fibonacci<40>::get_value(unsigned long n=45)  Line 18 + 0xe bytes    C++
fibtest.exe!main()  Line 9 + 0x7 bytes    C++
fibtest.exe!__tmainCRTStartup()  Line 597 + 0x17 bytes    C 
```

即它递归直到它在“表”中找到一个值。（通过在调试器中逐行执行反汇编验证，也通过用随机数 <= 45 替换测试整数来验证）

递归部分也可以用线性迭代解决方案代替：

```
static unsigned long long get_value(unsigned long n)
{
    switch (n) {
        case N:
            return value;    
        default:
            if (n < N) {
                return Fibonacci<N-1>::get_value(n);
            } else {
                // n > N
                unsigned long long i = Fibonacci<N-1>::value, j = value, t;
                for (unsigned long k = N; k < n; k++) {
                    t = i + j;
                    i = j;
                    j = t;
                }
                return j;
            }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-06-18T21:04:21.040

如果您有支持可变参数模板（C++0x 标准）的 C++ 编译器，您可以在编译时将 fibonacii 序列保存在元组中。在运行时，您可以通过索引访问该元组中的任何元素。

```
#include <tuple>   
#include <iostream>

template<int N>
struct Fib
{
    enum { value = Fib<N-1>::value + Fib<N-2>::value };
};

template<>
struct Fib<1>
{
    enum { value = 1 };
};

template<>
struct Fib<0>
{
    enum { value = 0 };
};

// ----------------------
template<int N, typename Tuple, typename ... Types>
struct make_fibtuple_impl;

template<int N, typename ... Types>
struct make_fibtuple_impl<N, std::tuple<Types...> >
{
    typedef typename make_fibtuple_impl<N-1, std::tuple<Fib<N>, Types... > >::type type;
};

template<typename ... Types>
struct make_fibtuple_impl<0, std::tuple<Types...> >
{
    typedef std::tuple<Fib<0>, Types... > type;
};

template<int N>
struct make_fibtuple : make_fibtuple_impl<N, std::tuple<> >
{};

int main()
{
   auto tup = typename make_fibtuple<25>::type();
   std::cout << std::get<20>(tup).value;  
   std::cout << std::endl; 

   return 0;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-03-20T14:35:29.093

使用 C++11：您可以创建`std::array`一个简单的 getter：[https ://ideone.com/F0b4D3](https://ideone.com/F0b4D3)

```
namespace detail
{

template <std::size_t N>
struct Fibo :
    std::integral_constant<size_t, Fibo<N - 1>::value + Fibo<N - 2>::value>
{
    static_assert(Fibo<N - 1>::value + Fibo<N - 2>::value >= Fibo<N - 1>::value,
                  "overflow");
};

template <> struct Fibo<0u> : std::integral_constant<size_t, 0u> {};
template <> struct Fibo<1u> : std::integral_constant<size_t, 1u> {};

template <std::size_t ... Is>
constexpr std::size_t fibo(std::size_t n, index_sequence<Is...>)
{
    return const_cast<const std::array<std::size_t, sizeof...(Is)>&&>(
        std::array<std::size_t, sizeof...(Is)>{{Fibo<Is>::value...}})[n];
}

template <std::size_t N>
constexpr std::size_t fibo(std::size_t n)
{
    return n < N ?
        fibo(n, make_index_sequence<N>()) :
        throw std::runtime_error("out of bound");
}
} // namespace detail

constexpr std::size_t fibo(std::size_t n)
{
    // 48u is the highest
    return detail::fibo<48u>(n);
} 
```

在 C++14 中，您可以简化一些功能：

```
template <std::size_t ... Is>
constexpr std::size_t fibo(std::size_t n, index_sequence<Is...>)
{
    constexpr std::array<std::size_t, sizeof...(Is)> fibos{{Fibo<Is>::value...}};
    return fibos[n];
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-05-01T07:48:25.570

我的想法是递归地将斐波那契序列保存在可变参数模板中，然后将其转换为数组。所有这些都是在编译时完成的。例如，当 n = 5 时，我们有：

```
F<5>::array
= F<4, 0>::array
= F<3, 0, 1>::array
= F<2, 0, 1, 1>::array
= F<1, 0, 1, 1, 2>::array
= F<0, 0, 1, 1, 2, 3>::array
= { 0, 1, 1, 2, 3 } 
```

然后我们可以在运行时索引数组。

我的 C++14 实现：

```
#include <cstdint>
#include <array>
#include <iostream>

template<uint64_t n>
struct Helper { static constexpr uint64_t value = Helper<n - 1>::value + Helper<n - 2>::value; };

template<>
struct Helper<0> { static constexpr uint64_t value = 0; };

template<>
struct Helper<1> { static constexpr uint64_t value = 1; };

template<u_int64_t x>
class Fib {
private:
    template<u_int64_t n, u_int64_t...rest>
    struct Get {
        static constexpr std::array<u_int64_t, n + sizeof...(rest)> value = Get<n - 1, rest..., Helper<sizeof...(rest)>::value>::value;
    };

    template<u_int64_t...rest>
    struct Get<0, rest...> {
        static constexpr std::array<u_int64_t, sizeof...(rest)> value{rest...};
    };
public:
    static constexpr std::array<u_int64_t, x> sequence = Get<x>::value;
};

template<u_int64_t x>
constexpr std::array<u_int64_t, x> Fib<x>::sequence;

int main() {
    for (int i = 0; i < 45; i++) std::cout << "F" << i << " = " << Fib<45>::sequence[i] << std::endl;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-25T23:29:47.243

C（以及大多数情况下是 C++）的基本特性之一是您不需要为不需要的东西付费。

查找表的自动生成并不是编译器需要为您做的事情。即使您需要该功能，也不是其他所有人都需要。

如果您想要一个查找表，请编写一个程序来制作一个。然后在您的程序中使用该数据。

如果您希望在运行时计算值，请不要使用模板元程序，只需使用常规程序来计算值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-05T02:39:42.510

您可以使用预处理器元编程技术生成开关或静态数组。如果复杂性不超过该方法的限制，并且您不希望通过生成代码或数据的额外步骤来扩展您的工具链，那么这是一个不错的决定。

# sql-server - 而不是 SQL Server 中的触发器丢失 SCOPE_IDENTITY？

> ID：908257
> 
> 赞同：24
> 
> 时间：2009-05-25T22:25:32.087
> 
> 标签：sql-server, tsql, linq-to-sql, sql-server-2008

我有一个表，我在其中创建了一个`INSTEAD OF`触发器来执行一些业务规则。

问题是当我将数据插入此表时，`SCOPE_IDENTITY()`返回一个`NULL`值，而不是实际插入的标识。

### 插入 + 范围代码

```
INSERT INTO [dbo].[Payment]([DateFrom], [DateTo], [CustomerId], [AdminId])
VALUES ('2009-01-20', '2009-01-31', 6, 1)

SELECT SCOPE_IDENTITY() 
```

### 扳机：

```
CREATE TRIGGER [dbo].[TR_Payments_Insert]
   ON  [dbo].[Payment]
   INSTEAD OF INSERT
AS 
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    IF NOT EXISTS(SELECT 1 FROM dbo.Payment p
              INNER JOIN Inserted i ON p.CustomerId = i.CustomerId
              WHERE (i.DateFrom >= p.DateFrom AND i.DateFrom <= p.DateTo) OR (i.DateTo >= p.DateFrom AND i.DateTo <= p.DateTo)
              ) AND NOT EXISTS (SELECT 1 FROM Inserted p
              INNER JOIN Inserted i ON p.CustomerId = i.CustomerId
              WHERE  (i.DateFrom <> p.DateFrom AND i.DateTo <> p.DateTo) AND 
              ((i.DateFrom >= p.DateFrom AND i.DateFrom <= p.DateTo) OR (i.DateTo >= p.DateFrom AND i.DateTo <= p.DateTo))
              )

    BEGIN
        INSERT INTO dbo.Payment (DateFrom, DateTo, CustomerId, AdminId)
        SELECT DateFrom, DateTo, CustomerId, AdminId
        FROM Inserted
    END
    ELSE
    BEGIN
            ROLLBACK TRANSACTION
    END

END 
```

该代码在创建此触发器之前工作。我在 C# 中使用 LINQ to SQL。我没有看到更改`SCOPE_IDENTITY`为`@@IDENTITY`. 我该如何进行这项工作？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-25T22:31:40.123

使用`@@identity`而不是`scope_identity()`.

while`scope_identity()`返回当前作用域中`@@identity`最后创建的 id，返回当前会话中最后创建的 id。

`scope_identity()`通常建议在字段中使用该函数`@@identity`，因为您通常不希望触发器干扰 id，但在这种情况下您会这样做。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-26T03:11:41.837

由于您使用的是 SQL 2008，因此我强烈建议您使用 OUTPUT 子句而不是自定义标识函数之一。SCOPE_IDENTITY 目前在并行查询方面存在一些问题，导致我完全反对它。@@Identity 没有，但它仍然不像 OUTPUT 那样明确和灵活。加上 OUTPUT 处理多行插入。看看有一些很好的例子[的 BOL 文章。](http://msdn.microsoft.com/en-us/library/ms177564.aspx)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-03-06T19:04:41.283

我对使用@@identity 持严重保留意见，因为它可能会返回错误的答案。

但是有一种解决方法可以强制 @@identity 具有 scope_identity() 值。

为了完整起见，首先我将列出我在网上看到的这个问题的其他一些解决方法：

1.  使触发器返回一个行集。然后，在执行插入的包装器 SP 中，`INSERT Table1 EXEC sp_ExecuteSQL ...`对另一个表执行操作。然后 scope_identity() 将起作用。这很麻烦，因为它需要动态 SQL，这很痛苦。另外，请注意，动态 SQL 在调用 SP 的用户的权限下运行，而不是在 SP 所有者的权限下运行。如果原始客户端可以插入到表中，他应该仍然具有该权限，只要知道如果您拒绝直接插入到表中的权限，您可能会遇到问题。

2.  如果有另一个候选键，则使用这些键获取插入行的标识。例如，如果 Name 上有一个唯一索引，那么您可以插入，然后使用 Name 从刚刚插入的表中选择（最多为多行）ID。虽然如果另一个会话删除了您刚刚插入的行，这可能会出现并发问题，但如果有人在应用程序可以使用它之前删除了您的行，这并不比原来的情况更糟。

现在，这里是如何明确地使您的触发器安全以使 @@Identity 返回正确的值，**即使您的 SP 或其他触发器在主 insert 之后插入到带有标识的表中**。

此外，请在您的代码中添加关于您正在做什么以及为什么这样做的注释，以便触发器的未来访问者不会破坏事情或浪费时间试图弄清楚它。

```
CREATE TRIGGER TR_MyTable_I ON MyTable INSTEAD OF INSERT
AS
SET NOCOUNT ON

DECLARE @MyTableID int
INSERT MyTable (Name, SystemUser)
SELECT I.Name, System_User
FROM Inserted

SET @MyTableID = Scope_Identity()

INSERT AuditTable (SystemUser, Notes)
SELECT SystemUser, 'Added Name ' + I.Name
FROM Inserted

-- The following statement MUST be last in this trigger. It resets @@Identity
-- to be the same as the earlier Scope_Identity() value.
SELECT MyTableID INTO #Trash FROM MyTable WHERE MyTableID = @MyTableID 
```

通常，对审计表的额外插入会破坏一切，因为因为它有一个标识列，所以@@Identity 将返回该值，而不是从插入到 MyTable 中的值。但是，最终选择会根据我们之前保存的 Scope_Identity() 创建一个正确的新 @@Identity 值。这也证明了它对 MyTable 表上任何可能的附加 AFTER 触发器的影响。

**更新：**

我刚刚注意到这里不需要 INSTEAD OF 触发器。这可以满足您的所有需求：

```
CREATE TRIGGER dbo.TR_Payments_Insert ON dbo.Payment FOR INSERT
AS 
SET NOCOUNT ON;
IF EXISTS (
   SELECT *
   FROM
      Inserted I
      INNER JOIN dbo.Payment P ON I.CustomerID = P.CustomerID
   WHERE
      I.DateFrom < P.DateTo
      AND P.DateFrom < I.DateTo
) ROLLBACK TRAN; 
```

这当然允许 scope_identity() 继续工作。唯一的缺点是身份表上的回滚插入确实会消耗所使用的身份值（身份值仍会随着插入尝试中的行数而增加）。

我已经盯着这个看了几分钟，现在还没有绝对的把握，但我*认为*这保留了包含开始时间和排他结束时间的含义。如果结束时间包含在内（这对我来说很奇怪），那么比较需要使用 <= 而不是 <。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-12-27T06:20:43.463

主要问题：触发器和实体框架都在不同的范围内工作。问题是，如果您在触发器中生成新的 PK 值，则范围不同。因此，此命令返回零行，EF 将抛出异常。

解决方案是在触发器末尾添加以下 SELECT 语句：

```
SELECT * FROM deleted UNION ALL
SELECT * FROM inserted; 
```

代替 * 您可以提及所有列名，包括

```
SELECT IDENT_CURRENT(‘tablename’) AS <IdentityColumnname> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-26T06:10:55.933

就像 araqnid 评论的那样，触发器似乎在满足条件时回滚事务。您可以使用 AFTER INSTERT 触发器更轻松地做到这一点：

```
CREATE TRIGGER [dbo].[TR_Payments_Insert]
   ON  [dbo].[Payment]
   AFTER INSERT
AS 
BEGIN
    SET NOCOUNT ON;

    IF <Condition>
    BEGIN
        ROLLBACK TRANSACTION
    END
END 
```

然后您可以再次使用 SCOPE_IDENTITY()，因为 INSERT 不再在触发器中完成。

如果它们在同一个插入中，则条件本身似乎会让两个相同的行过去。使用 AFTER INSERT 触发器，您可以重写条件，如：

```
IF EXISTS(
    SELECT *
    FROM dbo.Payment a
    LEFT JOIN dbo.Payment b
        ON a.Id <> b.Id
        AND a.CustomerId = b.CustomerId
        AND (a.DateFrom BETWEEN b.DateFrom AND b.DateTo
        OR a.DateTo BETWEEN b.DateFrom AND b.DateTo)
    WHERE b.Id is NOT NULL) 
```

它会捕获重复的行，因为现在它可以根据 Id 区分它们。如果您删除一行并将其替换为同一语句中的另一行，它也可以工作。

无论如何，如果您需要我的建议，请完全远离触发器。正如你所看到的，即使在这个例子中，它们也非常复杂。通过存储过程执行插入。它们比触发器更简单、更快：

```
create procedure dbo.InsertPayment
    @DateFrom datetime, @DateTo datetime, @CustomerId int, @AdminId int
as
BEGIN TRANSACTION

IF NOT EXISTS (
    SELECT *
    FROM dbo.Payment
    WHERE CustomerId = @CustomerId
    AND (@DateFrom BETWEEN DateFrom AND DateTo
    OR @DateTo BETWEEN DateFrom AND DateTo))
    BEGIN

    INSERT into dbo.Payment 
    (DateFrom, DateTo, CustomerId, AdminId)
    VALUES (@DateFrom, @DateTo, @CustomerId, @AdminId)

    END
COMMIT TRANSACTION 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-07-11T18:11:54.423

聚会有点晚了，但我自己正在研究这个问题。一种解决方法是在执行插入的调用过程中创建一个临时表，将范围标识从而不是触发器内部插入到该临时表中，然后在插入完成后从临时表中读取标识值.

在程序中：

```
CREATE table #temp ( id int )

... insert statement ...

select id from #temp
-- (you can add sorting and top 1 selection for extra safety)

drop table #temp 
```

代替触发器：

```
-- this check covers you for any inserts that don't want an identity value returned (and therefore don't provide a temp table)
IF OBJECT_ID('tempdb..#temp') is not null
begin
    insert into #temp(id)
    values
    (SCOPE_IDENTITY())
end 
```

为了安全起见，您可能想将其称为 #temp 以外的其他名称（足够长且随机的名称，以至于其他人都不会使用它：#temp1234235234563785635）。

# python - Generating file to download with Django

> ID：908258
> 
> 赞同：98
> 
> 时间：2009-05-25T22:26:01.680
> 
> 标签：python, django

Is it possible to make a zip archive and offer it to download, but still not save a file to the hard drive?

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-05-26T05:53:30.510

要触发下载，您需要设置`Content-Disposition`标题：

```
from django.http import HttpResponse
from wsgiref.util import FileWrapper

# generate the file
response = HttpResponse(FileWrapper(myfile.getvalue()), content_type='application/zip')
response['Content-Disposition'] = 'attachment; filename=myfile.zip'
return response 
```

如果您不希望磁盘上的文件需要使用`StringIO`

```
import cStringIO as StringIO

myfile = StringIO.StringIO()
while not_finished:
    # generate chunk
    myfile.write(chunk) 
```

您也可以选择设置`Content-Length`标题：

```
response['Content-Length'] = myfile.tell() 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-05-25T22:42:00.633

You'll be happier creating a temporary file. This saves a lot of memory. When you have more than one or two users concurrently, you'll find the memory saving is very, very important.

You can, however, write to a [StringIO](http://docs.python.org/library/stringio.html) object.

```
>>> import zipfile
>>> import StringIO
>>> buffer= StringIO.StringIO()
>>> z= zipfile.ZipFile( buffer, "w" )
>>> z.write( "idletest" )
>>> z.close()
>>> len(buffer.getvalue())
778 
```

The "buffer" object is file-like with a 778 byte ZIP archive.

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-09-08T20:12:00.750

为什么不制作一个 tar 文件呢？像这样：

```
def downloadLogs(req, dir):
    response = HttpResponse(content_type='application/x-gzip')
    response['Content-Disposition'] = 'attachment; filename=download.tar.gz'
    tarred = tarfile.open(fileobj=response, mode='w:gz')
    tarred.add(dir)
    tarred.close()

    return response 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-25T22:29:21.890

Yes, you can use the [zipfile module](http://www.python.org/doc/2.5.2/lib/zipfile-objects.html), [zlib module](http://www.python.org/doc/2.5.2/lib/module-zlib.html) or other [compression modules](http://www.python.org/doc/2.5.2/lib/archiving.html) to create a zip archive in memory. You can make your view write the zip archive to the `HttpResponse` object that the Django view returns instead of sending a context to a template. Lastly, you'll need to set the mimetype to the appropriate format to [tell the browser to treat the response as a file](http://docs.djangoproject.com/en/dev/ref/request-response/#telling-the-browser-to-treat-the-response-as-a-file-attachment).

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-08-03T07:24:04.957

### 模型.py

```
from django.db import models

class PageHeader(models.Model):
    image = models.ImageField(upload_to='uploads') 
```

### 视图.py

```
from django.http import HttpResponse
from StringIO import StringIO
from models import *
import os, mimetypes, urllib

def random_header_image(request):
    header = PageHeader.objects.order_by('?')[0]
    image = StringIO(file(header.image.path, "rb").read())
    mimetype = mimetypes.guess_type(os.path.basename(header.image.name))[0]

    return HttpResponse(image.read(), mimetype=mimetype) 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-07-29T13:10:32.160

```
def download_zip(request,file_name):
    filePath = '<path>/'+file_name
    fsock = open(file_name_with_path,"rb")
    response = HttpResponse(fsock, content_type='application/zip')
    response['Content-Disposition'] = 'attachment; filename=myfile.zip'
    return response 
```

您可以根据需要替换 zip 和内容类型。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-11-03T01:04:07.303

与内存中的 tgz 存档相同：

```
import tarfile
from io import BytesIO

def serve_file(request):
    out = BytesIO()
    tar = tarfile.open(mode = "w:gz", fileobj = out)
    data = 'lala'.encode('utf-8')
    file = BytesIO(data)
    info = tarfile.TarInfo(name="1.txt")
    info.size = len(data)
    tar.addfile(tarinfo=info, fileobj=file)
    tar.close()

    response = HttpResponse(out.getvalue(), content_type='application/tgz')
    response['Content-Disposition'] = 'attachment; filename=myfile.tgz'
    return response 
```

# php - In Cakephp, how can I access an array from the whole application

> ID：908264
> 
> 赞同：2
> 
> 时间：2009-05-25T22:28:51.393
> 
> 标签：php, arrays, cakephp

In CakePHP, how can I make an array we use accessible by the whole application? Is there an equivalent of PHP's define() function?

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-26T07:39:01.763

使用配置类。

在 app/config/bootstrap.php 中：

配置::write('myArray', array(1,2,3));

然后在您的应用程序中的任何地方，例如模型、视图、控制器、助手、行为、组件等，只需使用以下方式访问它：

$myArray = Configure::read('myArray'); // $myArray 将包含数组（1,2,3）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T22:41:15.610

I normally use the "bootstrap.php" file located in the "config" folder.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T23:16:14.697

如果您不想将自己“限制”在 CakePHP 给您的范围内，您可以使用全局变量 (yukk) 或简单地将其包装在一个类中：

```
class Foo {
    public static $bar = { 3, 7, 42 };
} 
```

或者使用单例模式：

```
class Foo {
    private static $instance = null;
    public $myVar;

    private function __construct() {
        $this->myVar = { 3, 7, 42 };
    }

    public static function getInstance() {
        if (self::$instance == null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
} 
```

然后你可以这样做：

```
var_dump(Foo::$bar); 
```

或者

```
var_dump(Foo::getInstance()->myVar); 
```

# vim - 在 (G)Vim 的新标签中打开 (c) 标签

> ID：908269
> 
> 赞同：18
> 
> 时间：2009-05-25T22:31:20.437
> 
> 标签：vim

Ctrl+w Ctrl+i 和 :stj 很好，但是如何在 GVim/Vim 的新选项卡中跳转到标签（光标下）？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-05-25T22:54:30.077

类似的问题[How to use multiple tabs when tag to a function in Vim](https://stackoverflow.com/questions/539231/how-to-use-multiple-tabs-when-tagging-to-a-function-in-vim)

它用这些设置指出了[这个wiki](http://vim.wikia.com/wiki/Open_every_buffer_in_its_own_tabpage)（[它指向stackoverflow](https://stackoverflow.com/questions/563616/vimctags-tips-and-tricks)）（似乎在终端中工作正常，没有尝试过gvim）：

```
"--------------------
" Function: Open tag under cursor in new tab
" Source:   https://stackoverflow.com/questions/563616/vimctags-tips-and-tricks
"--------------------
map <C-\> :tab split<CR>:exec("tag ".expand("<cword>"))<CR>
"--------------------
" Function: Remap keys to make it more similar to firefox tab functionality
" Purpose:  Because I am familiar with firefox tab functionality
"--------------------
map     <C-T>       :tabnew<CR>
map     <C-N>       :!gvim &<CR><CR>
map     <C-W>       :confirm bdelete<CR> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-01-25T06:14:53.867

您还可以在预览`:ptag`中打开标签`C-w}`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-03-10T22:24:19.273

您可以像这样轻松跳转到新标签中的标签

```
<c-w>gf open in a new tab (Ctrl-w gf) 
```

此外，您可以在拆分视图中打开它：

```
<c-w>f  open in a new window (Ctrl-w f) 
```

检查这个 - [http://vim.wikia.com/wiki/Open_file_under_cursor](http://vim.wikia.com/wiki/Open_file_under_cursor)

# c++ - 用于 std::set 的 std::back_inserter？

> ID：908272
> 
> 赞同：116
> 
> 时间：2009-05-25T22:32:12.477
> 
> 标签：c++, algorithm, stl

我想这是一个简单的问题。我需要做这样的事情：

```
std::set<int> s1, s2;
s1 = getAnExcitingSet();
std::transform(s1.begin(), s1.end(), std::back_inserter(s2), ExcitingUnaryFunctor()); 
```

当然，`std::back_inserter`由于没有`push_back`. `std::inserter`还需要一个迭代器？我没用过`std::inserter`所以不知道怎么办。

有人有想法吗？

* * *

当然，我的另一个选择是使用一个向量 for `s2`，然后再对它进行排序。也许这样更好？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-05-25T22:42:48.370

`set`没有，`push_back`因为元素的位置由集合的比较器确定。使用`std::inserter`并通过它`.begin()`：

```
std::set<int> s1, s2;
s1 = getAnExcitingSet();
transform(s1.begin(), s1.end(), 
          std::inserter(s2, s2.begin()), ExcitingUnaryFunctor()); 
```

然后，插入迭代器将调用`s2.insert(s2.begin(), x)`where`x`是写入时传递给迭代器的值。该集合使用迭代器作为插入位置的提示。你也可以使用`s2.end()`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-12-08T02:07:29.030

2016 年，有人提议使用“单参数`inserter`迭代器”。 [https://isocpp.org/files/papers/p0471r0.html](https://isocpp.org/files/papers/p0471r0.html)。我找不到提案是否推进了。我认为这是有道理的。

现在你可以让这个行为定义 maker 函数：

```
template<class Container>
auto sinserter(Container& c){
    using std::end;
    return std::inserter(c, end(c));
} 
```

用作：

```
std::transform(begin(my_vec), end(my_vec), sinserter(my_set), [](auto& e){return e.member;}); 
```

# javascript - javascript securty：记录用户屏幕分辨率的AJAX调用，是否可以防止假号码？

> ID：908283
> 
> 赞同：1
> 
> 时间：2009-05-25T22:38:38.877
> 
> 标签：javascript, security, csrf, javascript-security

这是一个 javascript 安全问题：假设一个页面找到了计算机的屏幕分辨率，例如 1024 x 768，并希望使用 AJAX 调用将此数据记录到数据库中。

有没有办法真正防止虚假数据输入数据库？我认为无论 HTML 或 Javascript 做什么，用户都可以对代码进行逆向工程，以便将一些假数字输入数据库，或者有没有办法完全防止它发生？（100% 安全）。

**更新**：或在类似的情况下...如果我编写一个简单的 javascript 游戏...有没有办法让用户通过 AJAX 发回分数并谎报他们的分数？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-25T23:02:01.090

如果您一开始就假设您正在与之通信的用户是恶意的，那么不；您无法控制他们传递给您的数据。当然不是 100% 确定的——在最坏的情况下，他们可以使用网络工具重写或用他们想要的任何内容替换任何“正确”的内容。

如果您只是想防止偶然的恶意行为，您可以混淆或加密您的代码和/或数据。这不会阻止坚定的攻击者。

如果您确实信任真实用户，但怀疑其他人可能试图冒充他们，您可以使用其他技术，例如动态金丝雀：向用户发送一个随机数，如果他们返回相同的数字给您，您就知道它真的来自他们。（或者你受到了中间人攻击，但是嘿；这就是 SSL 的用途。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T22:41:08.107

无法阻止用户从 JavaScript 发回他们喜欢的任何数字。

我认为您能做的最好的事情是在服务器端进行某种检查，以确保发回的数字看起来像一个现实的解决方案。

不过，我不确定为什么有人会首先花时间欺骗这些数字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T22:41:39.510

是的，你是对的。由于您使用的是客户端代码，因此您必须以一种或另一种方式告诉用户的计算机（以及用户），无论您使用的是什么加密或混淆。没有办法解决它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-25T23:00:54.370

对于决议，基本上不可能确定它是否是有效的决议。我的分辨率通常以5120 x 1600发送到服务器，这看起来很不现实，但这是因为2个屏幕经常被发送为1。否则，屏幕分辨率和屏幕配置的可能性很大，你' d 可能会删除很多有效的，尽管它们可能很少。

对于游戏分数，您可以进行额外的检查，使其检查更加复杂。诸如在整个游戏过程中发送多个分数通知并要求 X 号以确保收到的分数是有效的。（即，必须收到 200-300、400-500、700-800 之间的一个，然后是 1000 的最终分数。）有了最终分数，您还可以拥有某种只能使用一次或包含的加密值一些带有CRC的数据。基本上，最后，需要接收其他数据而不仅仅是分数，特别是对于更高的分数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-25T23:02:51.697

为了通过详细说明 Dok 和您自己的评论来尝试回答，操纵应用程序以“欺骗”某些东西之间存在明显的区别，无论是在线业务以获得更便宜的东西还是 MMPORG 获得更多经验, 而不是以不正确地呈现界面并降低该特定（黑客？）用户的整体用户体验的方式对其进行操作。

您最好将时间花在网站的其他方面。我不建议我网站的用户操纵 HTML 以使其在他们的机器上看起来很有趣，但我不会全力以赴并混淆我的服务器输出以阻止他们伤害自己。在您的情况下，针对预定义的安全值进行范围检查，利用数据库，以确保用户以“允许的”分辨率查看会给您的应用程序带来不必要的负担，并且需要时间来完成。

# python - Secure plugin system for python application

> ID：908285
> 
> 赞同：2
> 
> 时间：2009-05-25T22:39:48.187
> 
> 标签：python, plugins, signing

I have an application written in python. I created a plugin system for the application that uses egg files. Egg files contain compiled python files and can be easily decompiled and used to hack the application. Is there a way to secure this system? I'd like to use digital signature for this - sign these egg files and check the signature before loading such egg file. Is there a way to do this programmatically from python? Maybe using winapi?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T03:51:12.573

> 有没有办法保护这个系统？

答案是“这取决于”。

您应该问的两个问题是“人们应该能够做什么”和“人们能够做什么（对于给定的实现）”。如果存在后者是前者的子集的实现，则可以保护系统。

我的一个朋友正在为一名编程竞赛评委工作：该程序在一些测试数据上运行用户提交的程序，并将其输出与参考输出进行比较。这该死的很难保证：你想运行其他人的代码，但又不想让他们运行*任意*代码。您的情况与此有些相似吗？那么答案是“很难”。

您是否希望用户从 Web 上下载不可信的代码并在运行时保证它不会占用他们的机器？然后看看各种网络语言。一种解决方案是不提供对系统调用 (JavaScript) 的访问或提供对某些潜在危险调用（Java 的 SecurityManager）的有限访问。据我所知，它们都不能在 python 中完成，但你总是可以破解解释器并禁止加载不在某些白名单上的外部模块。这可能很容易出错。

您是否希望用户编写插件，并且无法修改应用程序中的主体代码？考虑到用户可以反编译 .pyc 文件并对其进行修改。假设那些运行你的代码的人总是可以修改它，并考虑一下魔兽世界的淘金机器人。

一种仅限 Linux 的解决方案，类似于沙盒 web-ish 模型，是使用 AppArmor，它限制了您的应用程序可以访问哪些文件以及它可以进行哪些系统调用。这可能是一个可行的解决方案，但我对此了解不多，所以除了“调查”之外，我无法给你建议。

如果您所担心的只是邪恶的人在中间管中传输代码时修改代码，那么存在标准的加密解决方案 (SSL)。如果您只想加载已签名的插件（因为您想控制用户的操作？），签名代码听起来是正确的解决方案（但要注意编辑 .pyc 文件并禁用 is-it- 的狡猾用户或邪恶的人签名支票）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T22:49:00.993

Maybe some crypto library like this [http://chandlerproject.org/Projects/MeTooCrypto](http://chandlerproject.org/Projects/MeTooCrypto) helps to build an ad-hoc solution. Example usage: [http://tdilshod.livejournal.com/38040.html](http://tdilshod.livejournal.com/38040.html)

# search - 无法在 Emacs 中有效搜索

> ID：908286
> 
> 赞同：7
> 
> 时间：2009-05-25T22:39:55.893
> 
> 标签：search, emacs

我想在 Emacs 中有一个类似于 Vim 中的工具

```
 :g/search/ 
```

获取匹配列表。

**如何在 Emacs 中获得匹配列表？**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-25T22:56:06.813

`M-x occur`?

从[手册](https://www.gnu.org/software/emacs/manual/html_node/emacs/Other-Repeating-Search.html)：

> `M-x occur`
> 
> 提示输入正则表达式，并显示一个列表，显示缓冲区中包含匹配项的每一行。匹配的文本使用`match`面部突出显示。要将搜索限制在缓冲区的一部分，请缩小到该部分（请参阅缩小）。数字参数`n`指定`n`上下文行将在每个匹配行之前和之后显示。上下文行的默认数量由变量指定`list-matching-lines-default-context-lines`。
> 
> 在`*Occur*`缓冲区中，您可以单击每个条目，或将点移到那里并键入`RET`，以访问已搜索到的缓冲区中的相应位置。`o`并`C-o`在另一个窗口中显示匹配；`C-o`不选择它。或者，您可以使用`C-x `` ( `next-error`) 命令逐个访问事件（请参阅编译模式）。
> 
> `e`在缓冲区中键入会`*Occur*`切换到发生编辑模式，其中对条目所做的编辑也会应用于原始缓冲区中的文本。键入`C-c C-c`以返回到发生模式。
> 
> 该命令`M-x list-matching-lines`是 的同义词`M-x occur`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-25T23:01:22.700

除了`M-x occurr`检查 Mx grep。这同时适用于多个文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-25T22:58:39.990

我通常的工作流程不是获取列表并选择（不知道该怎么做），而是使用增量搜索：

```
C-s <search target> 
```

在该点之后获得第一场比赛。如果你不喜欢它，另一个`C-s`得到下一个。继续直到你满意为止（你需要一个额外`C-s`的来从缓冲区和缓冲区中环绕）。足够新的 emacsen 还可以突出显示所有可见的匹配项。

正如 Török Gábor 在评论中指出的那样，这是`isearch-forward`. 如果您的绑定不同，您需要修改规定的程序。

# time - 平均教学时间

> ID：908299
> 
> 赞同：0
> 
> 时间：2009-05-25T22:44:07.040
> 
> 标签：time, operating-system, instructions

假设我们平均每 20,000,000 条指令有一个页面错误，一条正常指令需要 2 纳秒，而一个页面错误导致指令需要额外的 10 毫秒。考虑到页面错误，平均指令时间是多少？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-25T22:49:34.580

20,000,000 条指令，其中一条会出现页面错误

因此，20,000,000 条指令将占用

```
 (2 nanoseconds * 20,000,000) + 10 milliseconds 
```

获取结果（这是 20,000,000 条指令的总时间），然后将其除以指令数以获得每条指令的时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T22:50:37.027

> 考虑到页面错误，平均指令时间是多少？

平均指令时间是总时间除以指令数。

那么：20,000,000 条指令的*总*时间是多少？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T22:48:40.323

2.5 纳秒？很简单的算术，我猜。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T23:03:56.703

如果 20,000,000 条指令中有 1 条导致页面错误，那么您的页面错误率为：

```
Page Fault Rate = (1/20000000) 
```

然后，您可以计算每条指令的平均时间：

```
Average Time = (1 - Page Fault Rate) * 2 ns + (Page Fault Rate * 10 ms) 
```

达到 2.5 ns / 指令

# database - 数据库 - 数据版本控制（后续）

> ID：908303
> 
> 赞同：5
> 
> 时间：2009-05-25T22:47:19.250
> 
> 标签：database, database-design, versioning

我的原始问题可以在[这里](https://stackoverflow.com/questions/762405/database-data-versioning)找到，我已经得到了一些很好的答案、idas 和提示。

作为可行性和性能研究的一部分，我已经开始转换我的模式，以便使用这些想法对我的数据进行版本控制。在这样做时，我想出了一些其他的问题。

在我最初的问题中，我的示例很简单，没有真正的关系引用。为了保留我上一个问题的示例，我现在将“名称”部分扩展到另一个表。

所以现在，我的数据变成了：

```
Person
------------------------------------------------
ID                UINT NOT NULL,
NameID            UINT NOT NULL,
DOB               DATE NOT NULL,
Email             VARCHAR(100) NOT NULL

PersonAudit
------------------------------------------------
ID                UINT NOT NULL,
NameID            UINT NOT NULL,
DOB               DATE NOT NULL,
Email             VARCHAR(100) NOT NULL,
UserID            UINT NOT NULL,         -- Who
PersonID          UINT NOT NULL,         -- What
AffectedOn        DATE NOT NULL,         -- When
Comment           VARCHAR(500) NOT NULL  -- Why

Name
------------------------------------------------
ID                UINT NOT NULL,
FirstName         VARCHAR(200) NOT NULL,
LastName          VARCHAR(200) NOT NULL,
NickName          VARCHAR(200) NOT NULL

NameAudit
------------------------------------------------
ID                UINT NOT NULL,
FirstName         VARCHAR(200) NOT NULL,
LastName          VARCHAR(200) NOT NULL,
NickName          VARCHAR(200) NOT NULL,
UserID            UINT NOT NULL,         -- Who
NameID            UINT NOT NULL,         -- What
AffectedOn        DATE NOT NULL,         -- When
Comment           VARCHAR(500) NOT NULL  -- Why 
```

在 GUI 中，我们可以看到以下形式：

```
ID            :  89213483
First Name    :  Firsty
Last Name     :  Lasty
Nick Name     :  Nicky
Date of Birth :  January 20th, 2005
Email Address :  my.email@host.com 
```

可以对以下内容进行更改：

1.  仅对“名称”部分
2.  仅对“人”部分
3.  对于“姓名”和人物部分

如果出现“1”，我们将原始记录复制到 NameAudit 并使用更改更新我们的名称记录。由于对名称的人员引用仍然相同，因此无需更改 Person 或 PersonAudit。

如果出现“2”，我们将原始记录复制到 PersonAudit 并使用更改更新 Person 记录。由于名称部分没有更改，因此不需要更改 Name 或 NameAudit。

如果出现“3”，我们根据上述两种方法更新我们的数据库。

如果我们要对人员和姓名部分进行 100 次更改，那么当您稍后尝试显示更改历史时会出现一个问题。我的所有更改都显示该人拥有最后一个版本的名称。这显然是错误的。

为了解决这个问题，Person 中的 NameID 字段似乎应该引用 NameAudit（但仅当 Name 发生更改时）。

正是这种条件逻辑开始使事情复杂化。

我很想知道是否有人在使用他们的数据库之前遇到过这种问题以及应用了什么样的解决方案？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-25T23:45:04.843

您可能应该尝试阅读有关“临时数据库”处理的信息。你可以看的两本书是 Darwen、Date 和 Lorentzos “[时间数据和关系模型](https://rads.stackoverflow.com/amzn/click/com/B001E4587Q)”和（在一个完全不同的极端）“[在 SQL 中开发面向时间的数据库应用程序](https://rads.stackoverflow.com/amzn/click/com/1558604367)”，Richard T. Snodgrass，Morgan Kaufmann Publishers, Inc. ，旧金山，1999 年 7 月，504+xxiii 页，ISBN 1-55860-436-7。该文件已绝版，但可在他的网站[cs.arizona.edu](http://www.cs.arizona.edu/~rts/publications.html)上以 PDF 格式获取。您还可以查找“[艾伦的关系](http://en.wikipedia.org/wiki/Allen%27s_Interval_Algebra)”以了解间隔 - 它们可能对您有所帮助。

* * *

我假设您数据库中的 DATE 类型包括时间（因此您可能使用 Oracle）。SQL 标准类型可能是 TIMESTAMP，带有一些用于亚秒级分辨率的小数位数。如果您的 DBMS 不包含 DATE 时间，那么您将面临一个难题，即决定如何在一天内处理多个更改。

您需要显示的大概是任一表中更改的历史记录，以及在进行更改时有效的另一表中的相应值。您还需要确定您所显示的是前图像还是后图像；大概，又是后像。这意味着您将有一个“排序”查询（Snodgrass 的术语），其列如下：

```
Start time        -- When this set of values became valid
End time          -- When this set of values became invalid
PersonID          -- Person.ID (or PersonAudit.ID) for Person data
NameID            -- Name.ID (or NameAudit.ID) for Name data
DOB               -- Date of Birth recorded while data was valid
Email             -- Email address recorded while data was valid
FirstName         -- FirstName recorded while data was valid
LastName          -- LastName recorded while data was valid
NickName          -- NickName recorded while data was valid 
```

我假设一旦 Person.ID 建立，它就不会改变；Name.ID 同上。这意味着它们在记录有效时仍然有效。

其中一个困难的部分是建立正确的“开始时间”和“结束时间”值集，因为转换可能发生在任一表（或两者）中。目前，我什至不确定您是否拥有所需的所有数据。插入新记录时，您不会捕获它变为有效的时间（当您插入新记录时，*XYZAudit表中没有任何内容，是吗？）。*

* * *

*可以说的还有很多。不过，在进一步讨论之前，我希望对目前提出的一些问题有一些反馈。*

* * *

其他一些可能有帮助的 SO 问题：

*   [单个维度内不重叠范围的数据结构](https://stackoverflow.com/questions/210729/data-structure-for-non-overlapping-ranges-within-a-single-dimension)
*   [为什么我们需要时态数据库](https://stackoverflow.com/questions/800331/why-do-we-need-a-temporal-database)
*   [确定两个日期范围是否重叠](https://stackoverflow.com/questions/325933/determine-whether-two-date-ranges-overlap)
*   [时间限制层次结构的最佳关系数据库表示](https://stackoverflow.com/questions/765186/best-relational-database-representation-of-time-bound-hierarchies)

* * *

由于这个答案是第一次写的，还有另一本书出版了关于另一组称为“断言版本控制”的用于处理时间数据的方法。这本书是 Tom Johnston 和 Randall Weiss 所著的“[在关系数据库中管理时间：如何设计、更新和查询时态数据](https://rads.stackoverflow.com/amzn/click/com/0123750415)”。[您可以在AssertedVersioning.com](http://assertedversioning.com/)找到他们的公司。请注意：该机制可能存在专利问题。

此外，还发布了 SQL 2011 标准（ISO/IEC 9075:2011，在多个部分中）。它包括一些时间数据支持。[您可以在TemporalData.com](http://temporaldata.com/)上找到有关该问题以及与时间数据相关的其他问题的更多信息，该网站更多的是一个通用信息网站，而不是一个需要研究特定产品的网站。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T23:02:17.347

保留一个具有自动增量的更改表，`ID`并进行所有更改以引用该表。

始终将原始记录放到审计表中。

要构建历史记录，请选择所有更改并显示最接近更改的值。

像这样：

```
`改变`

1
2
3
4
5
6

`名称审计`

1 - 以约翰·史密斯的身份创建
5 - 改为詹姆斯史密斯

`人员审计`

1 - 出生于 1980 年 1 月 1 日，出生于 `Seattle, WA`
2 - 将出生日期更改为“01.01.1980”
3 - 将出生日期更改为“02.01.1980”
4 - 将出生日期更改为“02.01.1980”
6 - 将 POB 更改为“华盛顿特区”

```

然后选择：

```
SELECT  c.id,
        (
        SELECT   MAX(id)
        FROM     NameAudit na
        WHER     na.id <= c.id
        ) as nameVersion,
        (
        SELECT   MAX(id)
        FROM     PersonAudit pa
        WHER     pa.id <= c.id
        ) as personVersion,
        na.*,
        pa.*
FROM    change c
JOIN    NameAudit na
ON      na.id = nameVersion
JOIN    PersonAudit pa
ON      pa.id = nameVersion
WHERE   change_id BETWEEN 1 AND 6 
```

# java - 如何在 WAS 6.0 上运行我的 JSF 1.1 应用程序

> ID：908311
> 
> 赞同：1
> 
> 时间：2009-05-25T22:50:49.927
> 
> 标签：java, jsf, jakarta-ee, websphere

当我部署使用 JSF1.1 运行时环境的应用程序时，我在访问部署在 Websphere Application Server 6.0 上的网站时遇到了麻烦。

起初它加载了一些错误，告诉我我的 commandLink 缺少 bodyContent，这是可选的，但我认为编辑了我的页面并显示了页面。

当我尝试按下任何按钮或进行任何事件处理时，它只是没有反应。

然后我将我的 web 模块类加载器模式设置为：Parent Last，然后我捕获了一个异常：错误 500：SRVE0207E：servlet 抛出未捕获的初始化异常

详细的错误是

```
[5/23/06 11:57:23:761 CEST] 0000007d ServletWrappe A SRVE0242I: [component-showcase_war] 

[/component-showcase] [/index.jsp]: Initialization successful. 
[5/23/06 11:57:23:766 CEST] 0000007d ServletWrappe E SRVE0100E: Did not realize init() exception thrown by servlet Persistent Faces Servlet: java.lang.NullPointerException 
at com.icesoft.faces.webapp.xmlhttp.PersistentFacesCommonlet.init(Unknown Source) 
at com.icesoft.faces.webapp.xmlhttp.PersistentFacesServlet.init(Unknown Source) 
at com.ibm.ws.webcontainer.servlet.ServletWrapper.init(ServletWrapper.java:274) 
at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java(Compiled Code)) 
at com.ibm.ws.webcontainer.webapp.WebAppRequestDispatcher.forward(WebAppRequestDispatcher.java(Compiled Code)) 
at org.apache.jasper.runtime.PageContextImpl.forward(PageContextImpl.java:510) 
at com.ibm._jsp._index._jspService(_index.java:66) 
at com.ibm.ws.jsp.runtime.HttpJspBase.service(HttpJspBase.java(Compiled Code)) 
at javax.servlet.http.HttpServlet.service(HttpServlet.java(Compiled Code)) 
at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java(Compiled Code)) 
at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java(Compiled Code)) 
at com.ibm.wsspi.webcontainer.servlet.GenericServletWrapper.handleRequest(GenericServletWrapper.java(Inlined Compiled Code)) 
at com.ibm.ws.jsp.webcontainerext.JSPExtensionServletWrapper.handleRequest(JSPExtensionServletWrapper.java(Compiled Code)) 
at com.ibm.ws.jsp.webcontainerext.JSPExtensionProcessor.handleRequest(JSPExtensionProcessor.java:241) 
at com.ibm.ws.webcontainer.webapp.WebAppRequestDispatcher.forward(WebAppRequestDispatcher.java(Compiled Code)) 
at com.ibm.ws.webcontainer.extension.DefaultExtensionProcessor.handleRequest(DefaultExtensionProcessor.java(Compiled Code)) 
at com.ibm.ws.webcontainer.webapp.WebApp.handleRequest(WebApp.java:2933) 
at com.ibm.ws.webcontainer.webapp.WebGroup.handleRequest(WebGroup.java:221) 
at com.ibm.ws.webcontainer.VirtualHost.handleRequest(VirtualHost.java:210) 
at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java(Compiled Code)) 
at com.ibm.ws.webcontainer.channel.WCChannelLink.ready(WCChannelLink.java(Compiled Code)) 
at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleDiscrimination(HttpInboundLink.java(Compiled Code)) 
at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleNewInformation(HttpInboundLink.java(Compiled Code)) 
at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.ready(HttpInboundLink.java:288) 
at com.ibm.ws.tcp.channel.impl.NewConnectionInitialReadCallback.sendToDiscriminaters(NewConnectionInitialReadCallback.java:201) 
at com.ibm.ws.tcp.channel.impl.NewConnectionInitialReadCallback.complete(NewConnectionInitialReadCallback.java:103) 
at com.ibm.ws.tcp.channel.impl.WorkQueueManager.requestComplete(WorkQueueManager.java(Compiled Code)) 
at com.ibm.ws.tcp.channel.impl.WorkQueueManager.attemptIO(WorkQueueManager.java(Compiled Code)) 
at com.ibm.ws.tcp.channel.impl.WorkQueueManager.workerRun(WorkQueueManager.java(Compiled Code)) 
at com.ibm.ws.tcp.channel.impl.WorkQueueManager$Worker.run(WorkQueueManager.java(Compiled Code)) 
at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java(Compiled Code)) 
```

您认为是什么问题，我在这里缺少什么，我一直在搜索，有人说要删除默认的 WAS jsf-api.jar 文件，但它没有帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T23:09:54.943

我认为 WAS 有另一个名为*ws-jsf.jar 的*JSF jar 。也删除它并尝试

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T12:26:05.397

```
 at com.icesoft.faces.webapp.xmlhttp.PersistentFacesServlet.init(Unknown Source) 
```

此 servlet 无法初始化。[访问icesoft.com](http://www.icesoft.com//)并了解它的作用以及失败的原因可能是一个想法，而不仅仅是从您的应用服务器中删除文件。

如果您提供有关您正在使用的技术堆栈的更多详细信息（包括您使用应用程序部署的 JSF 实现），则可能更容易诊断问题。

> 我将我的网络模块类加载器模式设置为：Parent Last

这是正确的做法。通过这样做，您的应用程序将使用它自己的 JSF 实现，而不是容器中的旧版本。我没有删除任何文件。

这里是我部署到 WAS 6.0 的简单 JSF 1.1 应用程序的结构。我使用了 MyFaces 库版本 1.1.6。

```
test.jsp
WEB-INF/faces-config.xml
WEB-INF/web.xml
WEB-INF/lib/commons-beanutils-1.7.0.jar
WEB-INF/lib/commons-el-1.0.jar
WEB-INF/lib/jstl-1.1.0.jar
WEB-INF/lib/commons-collections-3.1.jar
WEB-INF/lib/commons-lang-2.1.jar
WEB-INF/lib/myfaces-api-1.1.6.jar
WEB-INF/lib/commons-digester-1.8.jar
WEB-INF/lib/commons-logging-1.1.1.jar
WEB-INF/lib/myfaces-impl-1.1.6.jar 
```

faces-config.xml 文档类型：

```
<!DOCTYPE faces-config PUBLIC
  "-//Sun Microsystems, Inc.//DTD JavaServer Faces Config 1.1//EN"
  "http://java.sun.com/dtd/web-facesconfig_1_1.dtd"> 
```

网页.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<web-app id="WebApp_ID" version="2.4"
    xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd">
    <display-name>jsf11</display-name>
    <context-param>
        <param-name>javax.faces.STATE_SAVING_METHOD</param-name>
        <param-value>server</param-value>
    </context-param>
    <servlet>
        <servlet-name>Faces Servlet</servlet-name>
        <servlet-class>javax.faces.webapp.FacesServlet</servlet-class>
        <load-on-startup>-1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-name>Faces Servlet</servlet-name>
        <url-pattern>/faces/*</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>Faces Servlet</servlet-name>
        <url-pattern>*.faces</url-pattern>
    </servlet-mapping>
</web-app> 
```

# itext - checkmark when pdf signed with iText

> ID：908312
> 
> 赞同：0
> 
> 时间：2009-05-25T22:51:00.130
> 
> 标签：itext, digital-signature

I'm signing PDFs using iText. And I include a graphic representation of the signature in the document.

This works, but the green checkmark (or yellow question mark) that shows when the document is verified interferes with the graphic I inserted, making the end result look ugly.

Is there a way to manage the size of the green checkbox?
Are there any properties, fonts, image scale, etc that dictate the size of this green check mark?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-25T02:55:04.157

复选标记由 PDF 阅读器呈现。有关更多信息，请参阅[如何生成没有绿色复选标记的签名 PDF](https://stackoverflow.com/questions/367965/how-to-generate-a-signed-pdf-w-o-green-checkmark)。

# matlab - Simulink version of AnyLogic component

> ID：908318
> 
> 赞同：1
> 
> 时间：2009-05-25T22:57:04.907
> 
> 标签：matlab, simulink, anylogic

Does anybody know what components in Simulink (MATLAB package) are analogs for AnyLogic components? (e.g: source, buffer, delay, sink). Or how can I easily simulate behavior of AnyLogic model in MATLAB? Maybe there are some cool magic tools?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T07:08:13.470

AnyLogic 是最好的商业模拟工具之一，而 Matlab 是最好的工程工具。但是它们有不同的符号。所以在大多数情况下，转换是不可能的！例如将机场的 DE 模型转换为 Matlab。

我的建议：使用 Matlab 进行工程任务，使用 AnyLogic 进行业务模拟。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T23:24:42.497

如果您问是否有一种简单的方法可以将 AnyLogic 模型转换为 Simulink 模型，我对此表示怀疑。我还没有看到任何这样的转换工具。

我有一种感觉，如果你想在 MATLAB 中模拟你的模型，你将不得不在 Simulink 中重建你的 AnyLogic 模型。我将从查看此[Simulink 文档页面上的](http://www.mathworks.com/products/simulink/)[**Block List**](http://www.mathworks.com/access/helpdesk/help/toolbox/simulink/slref/f4-4889.html)和[**Function List**](http://www.mathworks.com/access/helpdesk/help/toolbox/simulink/slref/bq3cxmi.html)链接开始。您应该能够找到与 AnyLogic 模型中的组件类似的组件。

# algorithm - 摊销适用于 App Engine 的分布（和百分位数）计算？

> ID：908321
> 
> 赞同：1
> 
> 时间：2009-05-25T22:59:07.930
> 
> 标签：algorithm, google-app-engine, frequency, amortization

这适用于 Google App Engine，但不一定受此限制。

在 Google App Engine 上，数据库不是关系型数据库，因此无法实现聚合函数（例如 sum、average 等）。每行相互独立。要计算总和和平均值，应用程序只需通过重新计算对数据库的每个新写入来摊销其计算，以便它始终是最新的。

如何计算百分位数和频率分布（即密度）？我想绘制一个值域的密度图，而这组值可能在数百万的量级。循环遍历整个数据集（每个查询的限制是返回 1000 行）并基于此进行计算可能是可行的，但我宁愿做一些聪明的方法。

是否有一些算法可以计算或近似可以在一段时间内计算的密度/频率/百分比分布？

顺便说一句，数据是不确定的，因为最大值和最小值可能无处不在。因此，分布必须采用大约 95% 的数据，并且仅基于此进行密度。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-25T23:16:16.680

一遍又一遍地获取整行（一次限制为 1000 个......）以便每行获得一个数字肯定没有吸引力。因此，通过将单个数字记录在包含数字列表的单独实体中来对数据进行非规范化（我相信每个查询的限制为 1 MB，因此每个列表的 4 字节数字不超过 250,000 个数字）。

因此，在添加数字时，还要获取最新的“添加的数据值列表”实体，如果完全创建一个新实体，则追加新数字，保存它。正如您所暗示的那样，如果统计数据中的微小错误不是杀手，则可能不需要事务性。

如果可以更改项目的数据，则具有记录“已删除”数据值的相同类型的单独实体；要将一个项目的值从 23 更改为 45，将 23 添加到最新的“已删除值”列表中，并将 45 添加到最新的“添加值”列表中——这也包括项目删除。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T23:06:56.730

> 循环遍历整个数据集（每个查询的限制是返回 1000 行）并基于此进行计算可能是可行的，但我宁愿做一些聪明的方法。

这是对我来说最明显的方法，你为什么要避免它？

# python - 如何在 python 3 中将二进制数据写入标准输出？

> ID：908331
> 
> 赞同：132
> 
> 时间：2009-05-25T23:04:05.907
> 
> 标签：python, python-3.x

在 python 2.x 中，我可以这样做：

```
import sys, array
a = array.array('B', range(100))
a.tofile(sys.stdout)
```

然而，现在我得到了一个`TypeError: can't write bytes to text stream`. 我应该使用一些秘密编码吗？

* * *

## 回答 #1

> 赞同：208
> 
> 时间：2009-05-26T00:09:34.077

更好的方法：

```
import sys
sys.stdout.buffer.write(b"some binary data") 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-25T23:11:15.143

```
import os
os.write(1, a.tostring()) 
```

或者，`os.write(sys.stdout.fileno(), …)`如果这比`1`您更具可读性。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2019-01-07T11:44:50.930

这样做的惯用方式（仅适用于 Python 3）是：

```
with os.fdopen(sys.stdout.fileno(), "wb", closefd=False) as stdout:
    stdout.write(b"my bytes object")
    stdout.flush() 
```

好的部分是它使用普通的文件对象接口，每个人在 Python 中都习惯了。

请注意，我设置`closefd=False`为避免`sys.stdout`在退出`with`块时关闭。否则，您的程序将无法再打印到标准输出。但是，对于其他类型的文件描述符，您可能希望跳过该部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-04-13T13:05:25.533

如果您想在 python3 中指定编码，您仍然可以使用 bytes 命令，如下所示：

```
import os
os.write(1,bytes('Your string to Stdout','UTF-8')) 
```

其中 1 是标准输出对应的常用编号 --> sys.stdout.fileno()

否则，如果您不关心编码，请使用：

```
import sys
sys.stdout.write("Your string to Stdout\n") 
```

如果您想使用没有编码的 os.write，请尝试使用以下内容：

```
import os
os.write(1,b"Your string to Stdout\n") 
```

# macos - 在 Zsh 中登录时无法启动受“0700”保护的程序

> ID：908333
> 
> 赞同：0
> 
> 时间：2009-05-25T23:04:40.150
> 
> 标签：macos, ubuntu, find, zsh

我有以下代码应该可以在 Bash 中启动程序。

```
if [ "`uname`" = "Darwin" ]; then
   compctl -f -x 'p[2]' -s "`/bin/ls -d1 /Applications/*/*.app
/Application:/*.app | sed 's|^.*/\([^/]*\)\.app.*|\\1|;s/ /\\\\ /g'`"                 
-- open
   alias run='open -a' 
fi 
```

但是，它在我的 Zsh 中根本不起作用。我不能用它打开任何程序。

它的另一个错误是它会打开所有程序。我只想要权限为 700 的可启动程序。

我知道您可以通过以下方式很好地搜索这些程序

```
 find -perm 700 -type f *.app 
```

但是，我无法让我的 find 命令完全适用于每个程序文件。这表明我可能有更好的方法可以让程序在终端中启动。

**如何**在 Mac/Ubuntu 的 Zsh 中使程序可启动？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T00:05:01.823

哦，zsh。这总是让事情变得有趣。

但是有一些技术可以让调试这些事情变得更容易。我要做的第一件事是远离`ls`,`find`而是使用，因为你想要路径名，而不是人类可读的列表：

```
find . -executable -a -name \*.app 
```

也许....

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T12:44:46.513

您如何看待别名而不是完成？别名仍然选项卡完成。跨行拆分以使其更易于阅读...

```
`print -l /Applications/**/MacOS/*(*f:700:) | 
grep -v "Contents.*Contents" | 
sed -e "s#\(.*/\)\([^./]*\)\(\.app\)\(.*\)#alias \2=\"\1\2\3\4\"#g"` 
```

第一个在自己的行上打印每个匹配项，第二个删除应用程序的子包，最后一个生成别名命令。删除反引号以查看并确认生成的命令。

[编辑：] 这直接运行可执行文件 - 如果您更喜欢使用“open blah.app”方法，您可以将 sed 命令的最后部分更改为：

```
#alias \2=\"open \1\2\3\"# 
```

# ms-access - ms-access 导入 dll，在 dll 路径中以反斜杠结尾

> ID：908343
> 
> 赞同：1
> 
> 时间：2009-05-25T23:15:26.680
> 
> 标签：ms-access

我希望通过 Tools > References 将路径 c:\windows\system32\vbscript.dll\3 添加到 ms-access 来查看对 VBscript 正则表达式 5.5 的引用。但是，目录树只显示了没有结尾“\3”的完整路径

“\3”是什么意思（版本号？），它的正确名称是什么？如何正确将此引用添加到我的访问项目？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-27T03:34:12.083

更好的是，不要添加对它的引用。相反，使用后期绑定。这意味着您将使用普通对象变量而不是 RegExp 库的数据类型：

```
 Dim objRegEx As Object
  Set objRegEx = CreateObject("VBScript.Regexp") 
```

因此，您无需担心特定计算机上安装的库版本。一次调用它的速度差异可以忽略不计，但如果您要定期使用它，请创建一个像这样的公共函数：

```
 Public Function RegEx() As Object
    Static objRegEx As Object

    If objRegEx Is Nothing Then
       Set objRegEx = CreateObject("VBScript.Regexp")
    End If
    Set RegEx = objRegEx
  End Function 
```

然后您根本不需要做任何事情——只需像使用指向其顶级对象的变量一样使用 RegExp。这将在您第一次使用时自动初始化，然后会一直持续到您关闭应用程序。

如果您担心在关闭之前进行清理，您可以这样做：

```
 Public Function RegEx(Optional bolClose As Boolean = False) As Object
    Static objRegEx As Object

    If bolClose Then
       Set objRegEx = Nothing
       Exit Function
    End If
    If objRegEx Is Nothing Then
       Set objRegEx = CreateObject("VBScript.Regexp")
    End If
    Set RegEx = objRegEx
  End Function 
```

并在您的应用程序的关闭例程中这样调用它：

```
 Call RegEx(True) 
```

鲍勃是你的叔叔！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-25T23:40:34.663

比兹尔，

\3 是一个红鲱鱼。

要将引用添加到您的 Access 项目，请打开任何代码窗口，从“工具”菜单中选择“引用”，向下滚动到下图所示的条目并检查它。

请注意，尽管 DLL 驻留在 System32 目录中，但 Location 显示为 \3。它与微软版本的方式有关。

[![替代文字](https://i.stack.imgur.com/K9sG7.gif)](https://i.stack.imgur.com/K9sG7.gif)
[（来源：[windowsdevcenter.com](http://www.windowsdevcenter.com/windows/2004/11/09/graphics/wrdh_0903.gif)）]

# wcf - ServicesReferences.ClientConfig 中的标记

> ID：908354
> 
> 赞同：3
> 
> 时间：2009-05-25T23:21:00.553
> 
> 标签：wcf, silverlight

我创建了一个 WCF 服务并将其添加到我正在处理的现有 Silverlight 应用程序中。

当我在调试模式下运行 silverlight 应用程序时，当我引用 WCF Web 服务时它会失败。

> 服务参考配置中无法识别的元素“”。请注意，Silverlight 中只有一部分 Windows Communication Foundation 配置功能可用。

显然搜索后，以下行导致应用程序失败：

```
<transport>
   <extendedProtectionPolicy policyEnforcement="Never" />
</transport> 
```

删除上述行后，一切正常。这里有什么问题？我应该相信这段代码并配置其他东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T23:19:04.673

您使用哪个版本的 Silverlight？ `<extendedProtectionPolicy>`仅在 Silverlight 3 中可用。

在 Windows 7 上运行 wcf + silverlight 存在一些问题。 [ [http://blogs.msdn.com/silverlightws/archive/2009/04/05/some-known-issues-in-sl3-beta.aspx](http://blogs.msdn.com/silverlightws/archive/2009/04/05/some-known-issues-in-sl3-beta.aspx) ]

**问题：**在 Windows 7 Beta 上，生成代理时可能会遇到以下错误：“元素 'httpTransport' 不能包含子元素 'extendedProtectionPolicy'，因为父元素的内容模型为空”。

**解决方法：**在 Windows 7 上，当您使用启用 Silverlight 的 WCF 服务项目模板时，可能会在 Web.config 中生成一个元素。Silverlight 不支持此元素。只需从 Web.config 中删除该元素并尝试重新生成 Silverlight 代理。

高温高压

# c# - 调用 McAfee 病毒扫描引擎

> ID：908356
> 
> 赞同：5
> 
> 时间：2009-05-25T23:22:02.860
> 
> 标签：c#, virus-scanning, mcafee

我有一个客户的请求，要求使用他们服务器上的 McAfee Virus Scan 将病毒扫描集成到应用程序中。我做了一些调查，发现 McScan32.dll 是主要的扫描引擎，它导出了各种看起来有用的功能。我还发现提到了 McAfee Scan Engine SDK，但无法获得有关它的更多信息。

是否有人使用过 McAfee Scan Engine SDK，如果有，您从哪里获得有关它的信息。我正在尝试集成到 C# 应用程序中，并且 SDK 似乎可以导出 C 风格的函数，但是一旦我掌握了 SDK，那就是另一个问题了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-07-13T16:44:51.193

[Opswat.com](http://opswat.com)提供了一套围绕现有病毒检查器的 API，看看他们的产品 Metascan Ultra Plus。

# iphone - 当 iPhone 进入睡眠状态时，AVAudioPlayer 停止播放音频

> ID：908359
> 
> 赞同：4
> 
> 时间：2009-05-25T23:23:42.373
> 
> 标签：iphone

只要我的应用程序正在运行，我就需要一直播放背景声音。为此，我尝试使用 AVAudioPlayer。但是，一旦 iPhone 进入睡眠模式，它就会停止播放声音。

你能告诉我如何解决这个问题吗？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T05:43:10.967

您可能需要设置音频会话类别。来自“iPhone 应用程序编程指南”

> 类别是标识应用程序的一组音频行为的键。通过设置一个类别，您可以向 iPhone OS 表明您的音频意图，例如当屏幕锁定时您的音频是否应该继续。

[每个类别的详细信息在“音频会话类别](http://developer.apple.com/library/ios/#documentation/Audio/Conceptual/AudioSessionProgrammingGuide/AudioSessionCategories/AudioSessionCategories.html#//apple_ref/doc/uid/TP40007875-CH4)”中列出

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-11T17:22:01.050

在您的特定示例中，您可以尝试以下操作。它应该开箱即用。

```
// Registers this class as the delegate of the audio session.
[[AVAudioSession sharedInstance] setDelegate: self];    
// Allow the app sound to continue to play when the screen is locked.
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-02-08T07:11:05.527

好吧，这个解决方案也可能会有所帮助

```
 [[AVAudioSession sharedInstance] setDelegate: self]; 
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil]; 
[[AVAudioSession sharedInstance] setActive: YES error: nil]; 
```

引用自 [http://www.mindyourcode.com/ios/iphone/how-to-play-audio-in-iphone-sleep-mode/](http://www.mindyourcode.com/ios/iphone/how-to-play-audio-in-iphone-sleep-mode/)

# java - Java：new Something().method() vs 临时变量

> ID：908363
> 
> 赞同：1
> 
> 时间：2009-05-25T23:25:56.753
> 
> 标签：java

也许这很愚蠢，但两者之间有区别吗

```
new Something().method(); 
```

和

```
Something tmpSomething = new Something();
tmpSomething.method(); 
```

因为我只在这个特定对象上调用一个方法，所以我选择了第一个解决方案，但我不确定这是否是完全相同的行为......

我只想提一下构造函数初始化了一个 Writer 和方法在这个文件中写入......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T00:55:58.070

我做了一个快速测试。这是极其微不足道的测试代码：

```
public class TestLiveness
{
    public static void test1()
    {
        System.out.println(new Square(4).square());
        count();
    }

    public static void test2()
    {
        Square t = new Square(4);
        System.out.println(t.square());
        count();
    }

    private static void count()
    {
        for(int i=0; i<1000000; i++)
            System.out.println(i);
    }

    static class Square
    {
        private int val;

        Square(int val)
        {
            this.val = val;
        }

        int square()
        {
            return val * val;
        }
    }
} 
```

Javap显示两种方法编译不同；链接不会触及局部变量表，而临时变量确实会一直存在，直到方法返回。但是，VM/JIT 编译器可能仍会执行活性分析，并允许在方法返回之前对实例进行垃圾收集。

```
public static void test1();
  Code:
   0:   getstatic       #2; //Field java/lang/System.out:Ljava/io/PrintStream;
   3:   new     #3; //class TestLiveness$Square
   6:   dup
   7:   iconst_4
   8:   invokespecial   #4; //Method TestLiveness$Square."<init>":(I)V
   11:  invokevirtual   #5; //Method TestLiveness$Square.square:()I
   14:  invokevirtual   #6; //Method java/io/PrintStream.println:(I)V
   17:  invokestatic    #7; //Method count:()V
   20:  return

public static void test2();
  Code:
   0:   new     #3; //class TestLiveness$Square
   3:   dup
   4:   iconst_4
   5:   invokespecial   #4; //Method TestLiveness$Square."<init>":(I)V
   8:   astore_0
   9:   getstatic       #2; //Field java/lang/System.out:Ljava/io/PrintStream;
   12:  aload_0
   13:  invokevirtual   #5; //Method TestLiveness$Square.square:()I
   16:  invokevirtual   #6; //Method java/io/PrintStream.println:(I)V
   19:  invokestatic    #7; //Method count:()V
   22:  return 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-25T23:30:06.493

除了在第二种情况下你有一个不必要的变量，这使得代码更难维护之外，没有任何区别。

此外，仅在调用单个方法后才被丢弃的对象构成了[代码异味](http://en.wikipedia.org/wiki/Code_smell)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-25T23:29:20.193

他们是一样的。尽管构造一个对象并且只调用它的一个方法可能表明设计不佳。`Something.method();`为什么不需要公开构造函数就不允许？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-25T23:29:54.903

好吧，在第二种情况下，您已经获得了对象 tmpSomething，因此您可以在整个代码中使用它，但在第一个示例中您没有。所以你不能。

我想第一种方法可能更有效，但可能不是 Java 约定的最佳实践。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-25T23:32:03.340

如果您可以从第一次调用中获得一些价值，也许您可​​能想要定义您的方法静态：

```
public static ____ method() {
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-26T00:11:21.433

这两个片段之间存在细微差别，但仅在其范围内查看时才会如此。在方法中考虑它们：

```
 public void doSomething1() {
    new Something().method();
    doSomeLongRunningSomething();   
  }

  public void doSomething2() {
    Something tmpSomething = new Something();
    tmpSomething.method();
    doSomeLongRunningSomething();   
  } 
```

在第一种方法中，“某物”可立即用于垃圾收集，而在第二种方法中，`tmpSomething`在`doSomeLongRunningSomething`. 如果您在`finalize`（例如关闭文件）期间做任何有趣的事情，这*可能会*引入一些怪癖。

也就是说，我更喜欢第二个示例并命名新实例，因为它有助于调试处理。在单步执行代码时，您有一个更易于观察的命名实例。当您获得预先存在的实例时，这并不适用，在这种情况下，我发现链接方法更具可读性，例如`myDog.getEyes().getLeftEye().getColorAsRgb().getRed()`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-25T23:45:49.130

首先，我同意其他所有人的观点，并说它们在功能方面是相同的。

然而，我对这篇文章中大多数人所说的话持相反的看法，我认为第一个例子是要走的路。

对于第一个示例，我将通过某种形式的依赖注入进一步扩展它。如果您需要注入该“某事”类的模拟/测试版本，这将使您养成测试事物的能力。

另外，通过不训练破坏（在一行上执行多个操作，这是一种代码味道，例如 new dog().getEyes().getColour();），在我看来可以提高可读性并优化您的重构能力稍后的。仅仅因为目前您只在该对象上调用该方法并不意味着您以后不需要该对象对其执行其他操作，这意味着您无论如何都必须为该“某事”对象提取一个变量。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-26T01:28:34.790

没有错，即使你只调用一个函数。

查看Wikipedia上的[Fluent Interfaces](http://en.wikipedia.org/wiki/Fluent_interface#Java)或Martin Fowler 的[Fluent Interfaces](http://www.martinfowler.com/bliki/FluentInterface.html)

# c# - 字符串的双引号问题

> ID：908364
> 
> 赞同：1
> 
> 时间：2009-05-25T23:25:59.593
> 
> 标签：c#, visual-studio

有没有办法在下面的行中以格式良好的方式在 Visual Studio 中编写？

```
string x = "<Site name=\"Stack Overflow\" >Inner Content</Site>"; 
```

使它看起来像：

```
string x= "<Site name="Stack Overflow">
           Inner content;
          </Site>" 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-25T23:26:55.550

您是否尝试过使用字符串文字？

```
string x= @"<Site name=""Stack Overflow"">
           Inner content;
          </Site>" 
```

我不完全确定这就是你所要求的。您是否希望查看是否可以让 Visual Studio 将代码格式化为这种方式？如果是这样，则无法在 C# 编辑器中执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T00:07:08.573

我不是 100% 确定你在找什么。如果您希望它在 VS 中看起来不错，您可以执行以下操作：

```
string x = "<Site name=\"Stack Overflow\">" + 
           "Inner Content" + 
           "</Site>"; 
```

我很确定您需要对 C++/C# 中的引号进行转义。我不知道有什么方法可以避免它，除了一次加载一个字符。

如果您想将返回值添加到结果字符串中，您可以像这样在 \n 处：

```
string x = "<Site name=\"Stack Overflow\">\nInner Content\n</Site>"; 
```

# cross-browser - 这个覆盖视口的 div 在 IE 7、8、FF、Chrome 和 Safari 上完美运行，但为什么不是 IE 6？

> ID：908365
> 
> 赞同：0
> 
> 时间：2009-05-25T23:26:40.353
> 
> 标签：cross-browser, internet-explorer-6

这个覆盖视口的 div 在 IE 7、8、FF、Chrome 和 Safari 上完美运行，但为什么不是 IE 6？

[http://www.0011.com/css/test/cover_up/i4.html](http://www.0011.com/css/test/cover_up/i4.html)

我认为如果 IE 6 是位置：固定但不是绝对的，它会中断吗？

（在 IE 6 上，div 只有 1 行高）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T23:31:16.790

试试这个 CSS

```
body,
html {
    width: 100%;
    height: 100%;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T23:38:32.203

Alex 的建议 99% 有效：

[http://www.0011.com/css/test/cover_up/i4b.html](http://www.0011.com/css/test/cover_up/i4b.html)

然而，

1）出现封面div时弹出滚动条

2）为什么绝对定位的 div 在 IE 6 上没有视口的高度？我认为规范说，当没有“定位”的最近祖先时，视口就是包含元素。IE 6 不再遵循规范？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T18:09:55.907

IE6 不像其他浏览器那样解释对象元素的高度，所以你不能真正使用'height=100%'。可悲的是，我知道解决此问题的唯一方法是使用 javascript 来确定可视窗口的宽度和高度（以像素为单位），然后将 'min-width' 和 'min-height' 样式设置为这些值。

[这个链接](http://perishablepress.com/press/2007/01/16/maximum-and-minimum-height-and-width-in-internet-explorer/)应该可以帮助你找到你要找的东西。

# iphone - UIWebView - 如何识别“最后一个”webViewDidFinishLoad 消息？

> ID：908367
> 
> 赞同：23
> 
> 时间：2009-05-25T23:27:18.857
> 
> 标签：iphone, objective-c, uiwebview

每次加载页面中的**任何**对象时，似乎都会发送 webViewDidFinishLoad 消息。有没有办法确定所有内容的加载都已完成？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2010-05-09T03:54:31.440

我猜 iframe 会导致`webViewDidStartLoad`/`webViewDidFinishLoad`对。

作为答案提到的`[webView isLoading]`支票对我不起作用；`false`即使在两次`webViewDidFinishLoad`调用中的第一次之后它也返回了。相反，我跟踪加载如下：

```
- (void)webViewDidStartLoad:(UIWebView *)webView {
  webViewLoads_++;
}

- (void)webViewDidFinishLoad:(UIWebView *)webView {
  webViewLoads_--;

  if (webViewLoads_ > 0) {
    return;
  }

  …
}

- (void)webView:(UIWebView*)webView didFailLoadWithError:(NSError*)error {
  webViewLoads_--;
} 
```

（请注意，这仅在开始/完成对不连续出现的情况下才有效，但根据我的经验，到目前为止还没有发生。）

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-04-23T09:50:18.670

检查这个，它肯定对你有用：

```
- (void)webViewDidFinishLoad:(UIWebView *)webView {
    if ([[webView stringByEvaluatingJavaScriptFromString:@"document.readyState"] isEqualToString:@"complete"]) {
        // UIWebView object has fully loaded.
    }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-26T01:32:15.267

有趣的是，我没想到它会那样工作。虽然我确定还有其他方法可以做到这一点（有没有办法从 webViewDidFinishLoad 消息中提取 URL，以便您可以看到哪个是完成加载的主页？），但我能想到的主要是使用估计进度来检查页面的进度，并在 100% 完成加载时触发你想做的任何事情，这就是我在我的应用程序中所做的。谷歌“iphone webviewestimatedprogress”并单击第一个链接以获取我编写的有关如何执行此操作的指南。

更新：

请在下面使用 phopkins 的答案而不是我的答案！在您的应用程序中使用私有 API 是一个坏主意，您可能会被拒绝，而他的解决方案是正确的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-30T08:22:17.523

另一种以较少控制监视加载进度的方法是观察 WebViewProgressEstimateChangedNotification、WebViewProgressFinishedNotification 和 WebViewProgressStartedNotification 通知。例如，您可以观察这些通知以在您的应用程序中实现一个简单的进度指示器。**您可以通过调用estimatedProgress 方法来更新进度指示器，以估计当前加载的内容量。**

来自[http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Classes/WebView_Class/Reference/Reference.html](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Classes/WebView_Class/Reference/Reference.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-02T10:23:37.813

您还可以使用我编写的这个简短类别，它将块添加到 UIWebView 中，还允许您在默认 UIWebView 行为（在每个对象加载后收到通知）或“预期”行为（仅在页面完全加载时收到通知）之间进行选择。

[https://github.com/freak4pc/UIWebView-Blocks](https://github.com/freak4pc/UIWebView-Blocks)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-30T13:14:07.727

我需要从尚未完全加载的页面中捕获一个变量。

这对我有用：

```
- (void) webViewDidFinishLoad:(UIWebView *)webView {
    NSString *valueID = [webView stringByEvaluatingJavaScriptFromString:@"document.valueID;"];

    if([valueID isEqualToString:@""]){
        [webView reload];
        return;
    }

    //page loaded
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-02-13T22:20:58.600

所有选项都不适用于我的用例。我使用 phopkins 的例子稍作修改。我发现如果加载到 webview 中的 HTML 包含一个图像，该图像将是一个单独的请求，并且是连续发生的，所以我们必须考虑到这一点，我用计时器做到了这一点。不是最好的解决方案，但它似乎有效。：

```
- (void)webViewActuallyFinished {
     _webViewLoads--;

    if (_webViewLoads > 0) {
        return;
    }

    //Actually done loading

}

- (void)webViewDidStartLoad:(UIWebView *)webView {
    _webViewLoads++;
}

- (void)webViewDidFinishLoad:(UIWebView *)webView {

    [NSTimer scheduledTimerWithTimeInterval:2 target:self selector:@selector(webViewActuallyFinished) userInfo:nil repeats:NO];
}

- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error {
  _webViewLoads--;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-09T04:05:12.950

嗨，它可能已经有点远了，但我希望这会有所帮助。

我只是在它进入 webViewDidFinishLoad 方法时使用了一个通知，以便我可以捕获该方法的一个实例，然后我将检测到通知并从那里执行我的逻辑。

希望这可以帮助。它不会捕获 webViewDidFinishLoad 方法的最后一个调用实例，但允许您在调用它后执行某些操作，并且也不会重复调用该特定方法（例如显示一个按钮）。

****** *** ** *** ******编辑****** ** *** ** *** ******

 **我做了一个测试并设法测试了它。它确实有效，并且在加载整个页面后将调用从通知中调用的方法。

或者，我认为您可以在委托方法 webViewDidStartLoad 和 webViewDidFinishLoad 上进行计数器，以确保在运行代码之前它们是相同的。不过，这是一个丑陋的 hack，因为我们永远不会知道它会被调用多少次，除非像我一样，您正在加载 html 提要并且可以添加 JavaScript 来检查您正在加载的页面上有多少元素。我只是分享一些我试图解决这个问题的方法。希望能帮助到你。

鼓励反馈。谢谢！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-03-15T13:47:13.423

这是我在 DOM 加载时用来显示微调器的方法，它建立在 @Vinod 的回答之上。

注意 between`webViewDidStartLoad`和*readyState*是从上一个请求（如果有的话）**完成**`webViewDidFinishLoad`的，这就是为什么轮询应该在.***`webViewDidFinishLoad`***

 ****readyState*可能的值是*loading*、*interactive*或*completed*（也许*nil*？）

```
- (void)webViewDidStartLoad:(UIWebView *)webView {
    [self spinnerOn];
}

- (void)webViewDidFinishLoad:(UIWebView *)webView {
    [self startDOMCompletionPolling];
}

- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error {
    [self startDOMCompletionPolling];
}

- (void)startDOMCompletionPolling {
    if (self.domCompletionListener) {
        [self.domCompletionListener invalidate];
    }
    self.domCompletionListener = [NSTimer scheduledTimerWithTimeInterval:0.1 target:self selector:@selector(checkDOMCompletion) userInfo:nil repeats:YES];
}

- (void)checkDOMCompletion {
    NSString *readyState = [self.webView stringByEvaluatingJavaScriptFromString:@"document.readyState"];

    if (readyState != nil) {
        if (readyState.length > 0) {
            if ([readyState isEqualToString:@"loading"]) { //keep polling
                return;
            }
        }
    }
    //'completed', 'interactive', nil, others -> hide spinner
    [self.domCompletionListener invalidate];
    [self spinnerOff];
} 
```

* * *

## 回答 #10

> 赞同：-7
> 
> 时间：2009-06-21T17:22:34.073

我这样做的方式是这样的：

```
- (void)webViewDidFinishLoad:(UIWebView *)webview  {
    if (webview.loading)
    return;
    // now really done loading code goes next
    [logic]
} 
```

# visual-studio-2008 - 如何在 Visual Studio 中创建实体图？

> ID：908370
> 
> 赞同：6
> 
> 时间：2009-05-25T23:28:24.487
> 
> 标签：visual-studio-2008

如何在 Visual Studio 2008 中创建这些实体/类图？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-25T23:32:41.543

首先，在 Visual Studio 中打开一个项目并按照以下步骤操作：

*   在解决方案资源管理器窗口中，右键单击项目并选择“添加 -> 新项目”。
*   在 Add New Item 对话框中，突出显示“Class Diagram”并为其命名。
*   按添加按钮。类图文件将添加到您的项目中，并且设计器将打开。

要将现有类添加到图表中，只需将其从解决方案资源管理器窗口拖放到设计图面上。要创建一个新类（或 Struct、Enum 等），请右键单击设计器并展开“添加 ->”菜单项。选择适当的类型并按照说明进行操作。

[在这里](http://www.developingfor.net/visual-studio/visual-studio-2008-class-diagram.html)阅读更多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T23:32:40.017

创建一个新项目，右键单击解决方案并点击查看类图。

不太确定您是否可以通过这种方式创建类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T01:22:42.150

如果您指的是*类图，*请按照 Ekeko 的说明进行操作。

如果您指的是*Entity Framework*，则需要下载 Visual Studio 2008 SP1，其中包括 Entity Designer 的最新位。安装后，您可以在可视化设计器中创建一个新的实体数据模型，方法是添加一个新项：“ADO.NET 实体数据模型”。

# ant - Apache Ivy：解决嵌入在安装程序中的依赖项

> ID：908371
> 
> 赞同：4
> 
> 时间：2009-05-25T23:28:34.640
> 
> 标签：ant, build, build-automation, dependencies, ivy

我有一个构建问题，我必须通过 Apache Ivy 解决非标准工件。

**问题：**

*   我依赖于两个工件（a.jar 和 a-lib.jar）。
*   这两个依赖项仅作为单个安装程序 (a_installer.jar) 的一部分。
*   安装程序可以下载，嵌入的工件本身不能。
*   可以操纵安装程序来解压缩所需的依赖项。

**要求：**

*   我必须在构建期间解析/下载工件（我无法将安装程序或提取的工件与我的代码一起保留）。
*   我不能使用存储库来存储提取的工件。
*   子类化/扩展常春藤/任何都很好。

有没有人解决过类似的问题，或者分享一些有用的信息？

或者，也许我以错误的方式处理问题？从我目前在网上发现的情况来看，人们似乎只是使用 Ivy 来下载*文件*并在事后手动（使用 Ant/whatever）对它们进行后处理，而实际上并没有解决Ivy 中更复杂的*依赖关系。*

谢谢

*PS：我不在乎安装程序是否也放入了常春藤下载缓存，但我只想下载一次安装程序（而不是两个依赖项）。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-01-27T20:03:52.730

调用“ivy:retrieve”的问题在于，您还需要在*ivy.xml*（包含 URL）中添加一个“artifact”标签，以便检索在 Maven 存储库中找不到的依赖项......

我不喜欢这个有两个原因

1.  *ivy.xml*应该只声明您的依赖项，而不是它们的位置。
2.  *需要build.xml*中的附加自定义逻辑来处理 3rd 方包

理想情况下，应该由您的存储库设置来决定如何下载各种 jar，这就是我喜欢**打包**解析器的原因。即使我想要的库不在 Maven 中，我也可以配置 ivy 来处理它。

以下是将[jreleaseinfo](http://jreleaseinfo.sourceforge.net/)项目转为 ivy 依赖项的示例（托管在 sourceforge 中，我在 Maven 中找不到）

*常春藤.xml*：

```
<?xml version="1.0" encoding="ISO-8859-1"?>
<ivy-module version="2.0">
    <info organisation="com.myspotontheweb" module="ivy_packager"/>
    <dependencies>
        <dependency org="ch.oscg" name="jreleaseinfo" rev="1.3.0"/>
    </dependencies>
</ivy-module> 
```

声明两个解析器。默认是 Maven2，另一个是配置为在本地查找指令的**打包程序。**（另见常春藤综述项目）

*常春藤设置.xml*

```
<ivysettings>
    <settings defaultResolver="maven2"/>
    <resolvers>
        <ibiblio name="maven2" m2compatible="true"/>

        <packager name="repackage" buildRoot="${user.home}/.ivy2/packager/build" resourceCache="${user.home}/.ivy2/packager/cache">
            <ivy pattern="file:///${basedir}/repository/[organisation]/[module]/[revision]/ivy.xml"/>
            <artifact pattern="file:///${basedir}/repository/[organisation]/[module]/[revision]/packager.xml"/>
        </packager>
    </resolvers>
    <modules>
        <module organisation="ch.oscg" name="jreleaseinfo" resolver="repackage"/>
    </modules>
</ivysettings> 
```

魔术包含在“打包程序”文件中。在解析时，这将用于生成下载和提取所需 jar 的 ANT 脚本。（无需将此逻辑放入您的*build.xml*）

*存储库/ch.oscg/jreleaseinfo/1.3.0/packager.xml*

```
<packager-module version="1.0">

    <property name="name" value="${ivy.packager.module}"/>
    <property name="version" value="${ivy.packager.revision}"/>
    <property name="zipname" value="${name}-${version}"/>

    <resource dest="archive" url="http://sourceforge.net/projects/jreleaseinfo/files/jreleaseinfo/jreleaseinfo%201.3.0/jreleaseinfo-1.3.0.zip/download" sha1="9386d92758e627d04c2480b820731fd538b13a3f" type="zip"/>

    <build>

        <move file="archive/${zipname}/${zipname}.jar" tofile="artifacts/jars/${name}.jar"/>

    </build>
</packager-module> 
```

为了减少文件的数量，我省略了模块的*ivy.xml*。这似乎是可选的，除非您想声明它的许可证和其他应该存在于公共存储库中的属性。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-11-12T06:57:15.870

我认为这非常简单：'ivy:retrieve' a_installer，然后将 aj 和 a-lib 解压缩到你的 lib 目录（或任何你想要的地方）。这应该很容易与蚂蚁做？

我想知道是否有一些你没有提到的复杂情况阻止你这样做。

# javascript - jQuery UI 多选

> ID：908379
> 
> 赞同：3
> 
> 时间：2009-05-25T23:31:42.967
> 
> 标签：javascript, jquery, html, jquery-ui

从 jquery ui 中查看[这个演示](http://jqueryui.com/demos/selectable/)你必须按住 Ctrl 键才能进行多项选择 我真的很喜欢这段代码，但我不想强迫我的访问者按下 ctrl 键 我希望代码允许在不按住 ctrl 键的情况下进行多项选择

这可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T00:18:46.567

我在评论中问了你一个问题，但我只会写一个简单的选择解决方案，这样你就可以看到我在想什么。

所以基本上你可以使用 jquery toggle() 效果来滚动你自己的选择器。当用户单击时，您将添加橙色类，当他再次单击时，它将删除橙色类。

```
$(document).ready( function() {
    $('ul#selectable li').toggle( function() {
        $(this).addClass('orange'); }, function() {
        $(this).removeClass('orange'); } );
}); 
```

然后你所有的工作就是用橙色类获取所有的 li 元素并将它们发布到一个表单或任何你的最终目标。尚未检查此代码，但您所做的是要求 selectable 中所有在 class 属性末尾具有橙色值的 li 元素。

使用下面的代码，我正在创建一个新数组，然后将每个“橙色 li”的 text() 值添加到其中。

```
var theSelections = new Array();

$('ul#selectable li[class$="orange"]').each( function(i) {
    theSelections[i] = $(this).text();
}); 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-25T23:41:08.983

是的。但是，该实现必须允许在第二次单击时取消选择选定的项目。您只需稍微修改代码即可实现此目的。

对所有项目执行 .selectable('Enable')。

然后你需要对所有项目执行 .selectable('toggle') onClick。

这应该够了吧。

# ruby-on-rails - 可以将 edit_order_path 连接到 Orders 控制器的“修改”操作（而不是“编辑”操作）吗？

> ID：908386
> 
> 赞同：1
> 
> 时间：2009-05-25T23:37:00.553
> 
> 标签：ruby-on-rails, routes

```
<%= link_to 'Edit', edit_order_path(@order) %> 
```

是否可以将此链接连接到 Orders 控制器的**修改操作**（而不是**编辑操作**）**而不更改此语法**：

```
edit_order_path(@order) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T00:49:48.940

路线.rb：

```
map.edit_order "order/modify/:id" ,
:controller => "order" ,
:action => "modify" ,
:id => /\d+/ 
```

# php - 启用 ERP 应用程序以支持多个客户端

> ID：908387
> 
> 赞同：0
> 
> 时间：2009-05-25T23:37:04.703
> 
> 标签：php, mysql, erp

公司有一个ERP应用，只支持一个公司使用一个数据库，如何让应用支持多个公司和多个数据库使用相同的代码？

应用程序是 PHP，数据库是 MySQL。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T23:56:42.510

这完全取决于您的应用程序架构和数据库结构，如果重构太难，解决方案可能是拥有多个 ERP 实例。此外，由于它是一个 ERP（包含公司的敏感信息），您可能**必须**将实例安装在不同的服务器上，以确保您的客户不会将财务信息与其他公司存储在同一台机器上。

您可以虚拟化一台“大型”服务器。我建议您使用反向代理将来自多个子域的请求重定向到您的虚拟访客。您还可以拥有一个安装了 Apache、PHP 和 ERP 的虚拟化服务器模板，准备好安装在虚拟化主机中。当客户购买您的产品时，您只需安装并打开该虚拟访客并为客户提供访问权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T23:41:15.833

您可以在第二台服务器上重新安装它。如果你有执照当然可以这样做。它是什么ERP应用程序？

* * *

编辑：

对于我们的 ERP 产品，我使用一段 url 来区分数据库。例如

```
http://myserver.com/company1/customers 
```

相对

```
http://myserver.com/company2/customers 
```

嵌入在文档中的所有 url 都是相对 url，因此它们位于同一公司内。

# vim - 如何让 Vim Omni Completion 在 Makefile 中工作？

> ID：908388
> 
> 赞同：2
> 
> 时间：2009-05-25T23:37:52.907
> 
> 标签：vim, makefile, omnicomplete

我希望能够在 Makefiles 中使用 Vim 全方位补全，这样我就可以获得目标依赖项等的自动补全。有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T10:21:54.383

我不确定全补全，但你可以在 Vim 中使用正常补全。

例如，如果您有一个名为“installdocs”的目标，您可以键入：

```
ins<C-n> 
```

Vim 会为你完成目标名称。

# c++ - 列表查找算法

> ID：908392
> 
> 赞同：0
> 
> 时间：2009-05-25T23:40:24.243
> 
> 标签：c++, matlab

我正在尝试将[Matlab](http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/ref/find.html)中 find 函数的用法转换为[C++](http://www.cplusplus.com/reference/algorithm/find/)。从我从 C++ 查找函数中看到的内容来看，我似乎无法在描述中找到在列表中查找某些条件为真的索引的简单方法，而不仅仅是比较项目之间的相等性正在搜索和项目列表。在我实现我自己的执行查找功能的方法之前，很高兴看看是否已经有任何简单、高效、标准的实现方式来执行此操作。提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-25T23:42:58.280

如果您正在寻找数学条件，则需要“find_if”。使用 find if 将允许您传入一个谓词，该谓词确定列表中的给定项目是否匹配。您仍然需要编写匹配逻辑（或在标准算法中找到相关的现有函数，但不必编写“查找”的整个框架。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T23:49:32.867

话又说回来，“find 的整个框架”并不是那么难，即使你没有尾递归。

这可能是一个值得自己编写的示例，因为即使此时您在抽出正确函数方面的速度不如从标准库中选择它的速度快，但在多写几次之后，您将是。更不用说你会真正知道引擎盖下发生了什么，正如我们在雪佛兰所说的那样......

# c# - .NET 项目参考：如何通过引用的项目引用 dll？

> ID：908397
> 
> 赞同：4
> 
> 时间：2009-05-25T23:44:23.580
> 
> 标签：c#, dll, static, reference, class

希望我问得正确：

我有一个项目

```
Projects.Client 
```

我有我的类库（我一直使用的基础设施）

```
Library 
```

假设这两个都是项目，我怎么**能从“Projects.Client”中的一个类中做到这一点**

```
using Library;

public class xxx
{
    public void DoSomething()
    {
        Library.SomeDll.DoSomething();
    }
} 
```

**SomeDll.dll 在“库”项目中被引用。“库”是最终客户端项目“Projects.Client”中的参考**

我知道我可以简单地将 SomeDll 添加到“Projects.Client”项目中，但是有很多项目，我一直都在使用它们。我希望能够包含“库”并以某种方式能够引用其中的所有内容（包括原始代码和 dll）。这可能吗？

请注意：我不想为所有方法编写显式包装器，并且 dll 是静态的，所以我似乎无法在“库”项目中这样做：

```
public static class WrapSomeDll
{
    public static extern SomeDll Dll();
} 
```

感谢任何创造性的答案，我什至可能不需要双重参考、包装等

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T00:19:04.273

抱歉，这行不通。您需要引用 SomeDll 才能在 Project.Client 中使用其元数据。真的就这么简单。

请记住，引用不仅仅是将符号解析为地址的问题。这是一个提取元数据（类型）以便可以使用的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T12:18:28.873

您只需要引用项目并为要使用的命名空间添加*using子句。*无需指定 DLL 的名称

# vb.net - 如何在 VB.NET 的同一个 MSIE 窗口中导航到不同的网页

> ID：908404
> 
> 赞同：1
> 
> 时间：2009-05-25T23:50:30.743
> 
> 标签：vb.net

我有打开一个新窗口的代码，但我希望能够编辑同一个窗口。

```
System.Diagnostics.Process.Start("iexplore.exe", "http://www.live.com") 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-25T23:57:17.877

我不确定，但一个好的开始可能是获取您感兴趣的窗口的句柄：

[http://www.pocketpcdn.com/articles/dotnetcf_hwnd.html](http://www.pocketpcdn.com/articles/dotnetcf_hwnd.html)

然后分别调查可以向 IE 发送哪些互操作消息以更改选项卡 X 中的 URL

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T00:24:55.213

为了增加难度和增加控制/力量：

1.  将输入文本发送到您的 IE 进程。Alt-D 专注于导航栏，然后是 URL，然后是 ENTER。
2.  如上所述，使用 MSAA 查找导航栏并将其发送文本。
3.  使用 MSAA 获得对浏览器的 IHTMLDocument 访问权限，然后以编程方式使用该浏览器和相关接口驱动浏览器。

我不知道您的确切情况，但是如果您可以托管自己的 MSHTML 实例或 WebBrowser 控件，那么获取接口和执行上面#3 中提到的操作会容易得多；跨进程做这些事情充满了危险。

我刚刚进行了一次网络搜索，发现了一个[WatiN](http://watin.sourceforge.net/ "等待")工具，它显然包含了很多这项工作；也许它对你有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-13T04:14:52.767

如果您使用的是 2008，则有一个功能可以创建第二个表单，然后添加 Webbrowser 控件

然后可以调用该页面

```
myForm.show 
```

然后可以使用

```
Webbrowser1.Url = New Uri("http://www.google.com") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-26T11:03:44.960

使用以下代码：

```
System.Diagnostics.Process.Start("http://www.live.com") 
```

那就是：不要`iexplore.exe`直接调用——只要让系统确定要打开哪个默认浏览器。

这可能会产生两种行为：

*   在现有 Internet Explorer 窗口中打开一个新选项卡，
*   或者它创建一个新窗口。

重要的一点是，这取决于可以在 Internet Explorer 应用程序中控制的*首选项。*如果打开一个新窗口，那么这是用户选择的设置——不要*试图*覆盖它：覆盖用户的偏好被认为是不礼貌的。

如果用户不希望打开新窗口，他们只需在 Internet Explorer 首选项中进行更改。

# c# - 如何从 SharePoint 2007 中的用户控件调用 webpart 类文件中的方法？

> ID：908413
> 
> 赞同：0
> 
> 时间：2009-05-25T23:53:37.507
> 
> 标签：c#, sharepoint, user-controls, sharepoint-2007

我已按照此 MSDN 文章中的说明进行操作：http: [//msdn.microsoft.com/en-us/library/dd206945.aspx](http://msdn.microsoft.com/en-us/library/dd206945.aspx)

是否可以从 MyUserControl.ascx 文件中调用 myWebPart.cs 文件中的方法？除非我这样做，否则我似乎对 myWebPart.cs 中的方法没有智能感知：

```
myWebpart mywbprt = new myWebpart();
mywbprt.myMethInWebPartcs(); 
```

但是，这会出现错误，并且无法编译：

```
Error   2   'myWebpart' is a 'namespace' but is used like a 'type' 
```

myWebPart.cs 和 MyUserControl.ascx 共享相同的命名空间，我认为这足以在用户控件中调用 myWebPart.cs 中的方法，但显然不是？

我错过了 SharePoint 的一些复杂性吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T00:26:32.823

首先，看起来 myWebPart 所在的命名空间与 Web 部件同名。你应该改变它。然后您可能不会遇到编译时错误。

您将遇到运行时错误。如果您要调用的此方法与 Web 部件的运行时状态交互，则很可能不应从 Web 部件外部调用它。

更重要的是，用户控件需要查找并调用当前活动的 Web 部件的特定实例，而不是创建新实例，这与已经运行的实例无关。

如果该方法是静态方法（或者应该是静态方法），那么这更有意义，但我认为这种方法不属于 Web 部件。应将其移至 Web 部件和用户控件共享的类库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T01:33:16.230

我同意约翰所说的，我想添加以下内容......

如果您的用户控件包含在您的 Web 部件中，您应该能够使用 Parent 属性并在层次结构中向上找到它。另一种在两者之间进行通信的方式是注册从一个到另一个的事件。

# c# - 使用 OLEDB / Microsoft Jet 驱动程序导致 Excel 文件中出现“数字存储为文本”

> ID：908416
> 
> 赞同：4
> 
> 时间：2009-05-25T23:55:25.400
> 
> 标签：c#, excel, oledb

我在使用 C# 中的 OLDEDB 将条目写入 excel 文件时遇到问题。本质上，我想使用 excel 模板文件来格式化一些信息。这个想法是用户可以运行查询，它将结果填充到 excel 文件中，然后用户可以继续使用 excel 来处理结果。

为此，我创建了一个“raw_data”选项卡并使用 OLEDB 像表格一样对其进行写入。但是我遇到了预设计算的问题。有些列是文本，有些是数字，论坛应在打开工作表后立即引用这些列。

Excel 版本 2003 C#/.Net 3.5

这是我的连接字符串

```
string connectString = @"Provider=Microsoft.Jet.OLEDB.4.0;Data Source={filename};Extended Properties=""Excel 8.0;HDR=YES;IMEX=0"""; 
```

{filename} 稍后在代码中被替换为文件的路径

```
DbProviderFactory factory = DbProviderFactories.GetFactory("System.Data.OleDb");
using (DbConnection connection = factory.CreateConnection())
{
  connection.ConnectionString = connectString;
  using (DbCommand command = connection.CreateCommand())
  {

    connection.Open();
    query = "INSERT INTO [raw_prod$] (correlationid, created, ipaddr, nai, started, delta, csid, bytesin, bytesout, cause, bsid, servopt, svzone) VALUES (\"{correlationid}\", \"{created}\", \"{ipaddr}\", \"{nai}\", \"{started}\", {delta}, \"{csid}\", {bytesin}, {bytesout}, {cause}, \"{bsid}\", \"{servopt}\", \"{zone}\")";
    //Replace {} code with actual values skipped
    command.CommandText = query;
    command.ExecuteNonQuery();
  }
} 
```

当此运行时，数据按预期填充，但 excel 将数据视为文本，因此 sum(c2:c100) 之类的东西不起作用。如果我只是突出显示一个条目并按回车键，它将自动变为文本。我尝试将列格式化为模板中的数字，如您所见，我删除了 sql 中的双引号。

如何让 excel 立即将这些条目视为数字，以便所有计算都有效？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T03:37:01.633

我想通了，这实际上是一种愚蠢的烦人。在我的 excel 文件中，任何列的第 2-8 行我想成为一个数字，我只是填写了一些虚拟数字。这样，Jet 驱动程序在扫描这些列时将看到这些数字并考虑这些列号。然后从第 9 行开始我从 C# 中的插入，并相应地编辑模板以仅从第 9 行开始计算。真的很痛苦，但它似乎工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T00:15:43.610

您是否尝试过修改 TypeGuessRows 的 reg 设置？HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Excel\TypeGuessRows 应该是寻找 Jet 4.0 的地方。出于调试目的，您可以将其设置为大于默认值 8 的数字，（或者，如果绝对确定第一行是正确的，请将其设置为 1。）

一些有助于调试[Daily Does](http://www.dicks-blog.com/archives/2004/06/03/)和[MSDN的链接](http://social.msdn.microsoft.com/forums/en-US/adodotnetdataproviders/thread/9ec840d0-d132-4837-8cee-d4b89334401c)

啊哈！刚刚在代码底部发现了示例。尝试删除那些数字值周围的引号

```
\"{correlationid}\", \"{created}\", \"{ipa 
```

我猜会是

```
{correlationid}, \"{created}\", \"{ipa 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-18T19:45:12.260

我在 Excel 2007 上遇到了同样的问题，并通过做两件事来解决它：

*   使用上面 philw 提到的 CREATE TABLE 方法
*   修改连接字符串并在excel 12.0部分后添加“xml”

请参阅以下代码示例

```
string connectionString = @"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=""" + scratchFile 
    + @""";Extended Properties=""Excel 12.0 xml;HDR=YES""";   

DbProviderFactory factory = DbProviderFactories.GetFactory("System.Data.OleDb");

using (DbConnection connection = factory.CreateConnection())
{
    connection.ConnectionString = connectionString;

    using (DbCommand command = connection.CreateCommand())
    {
        connection.Open();

        command.CommandText = @"CREATE TABLE [RawData$] " + 
            "([Organization] varchar(255), " +
            "[Department] varchar(255), [TotalSales] int, [TotalHours] int)";
        command.ExecuteNonQuery();

        command.CommandText = @"INSERT INTO [RawData$] " +
            "(Organization,Department,TotalSales,TotalHours)" +
            "VALUES('Organization','Department',700,70)";

        command.ExecuteNonQuery();

    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-20T07:23:51.767

您可以通过在创建导出表时明确告诉 Jet 列的类型来做到这一点：

```
 "create table [tabName] ([col1] varchar(255), [col2] double)" 
```

唯一的问题是，如果您尝试将字符数据粘贴到数字列中，Jet 在您插入时会抛出，这不足为奇。

一个相关的问题是您如何处理空值：就 Jet 而言，空字符串不是空值：如果您尝试将其插入数字列，Jet 就会抛出异常。

# asp.net-mvc - 仅在 ASP.NET MVC 站点的一部分中将操作过滤器应用于每个控制器？

> ID：908423
> 
> 赞同：5
> 
> 时间：2009-05-25T23:57:41.760
> 
> 标签：asp.net-mvc

我已经看到了对[类似问题](https://stackoverflow.com/questions/649409/can-you-apply-an-actionfilter-in-asp-net-mvc-on-every-action)的一个很好的答案，它解释了通过从一个用您自己的 ActionFilter 属性装饰的新基类继承所有控制器，您可以如何将一些逻辑应用于您网站的*所有*请求。

我想根据我的用户访问的网站区域找到一种方法。

例如，我将有一个带有 View 操作的 Product 控制器，但我希望允许将其用于以下两个 url：

/Product/View/321 - 向“普通”用户显示产品 ID 321 /Admin/Product/View/321 - 使用相同的视图控制器，但为我的管理员用户提供额外的功能。

我可以将“admin”作为名为“user”的参数传递到我的产品控制器上的视图操作中，以向管理员显示额外信息，[这里](http://www.iansuttle.com/blog/post/ASPNET-MVC-Action-Filter-for-Localized-Sites.aspx)显示了一种方法。但是我需要做的是确认我的用户被允许查看该网址。我不想用检查身份验证的 ActionAttribute 来装饰我的 Product 控制器，因为当未经身份验证的用户（和登录的管理员）在 /Product/View/321 上查看它时，我希望他们都看到标准视图。

所以我想做*的*，在伪代码中描述如下：

**当调用格式为“{userlevel}/{controller}/{action}/{id}”的 url 时，我想调用另一个执行身份验证检查的控制器，然后“链接”到原始 {controller } 并通过 {action}、{id} 和 {userlevel} 属性。**

我该怎么做？

（我知道对控制器的每次调用进行检查的开销可能很小。**我想这样做，因为除了用户身份验证检查之外，我以后可能还需要做一些更昂贵的事情，我会宁愿只为我网站的低流量*管理*区域运行该代码。似乎没有必要为网站的每个公共用户执行这些操作**）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T08:12:47.877

起初我认为这可能就像添加这样的新路线一样简单：

```
routes.MapRoute(
    "Admin",
    "Admin/{*pathInfo}",
    new { controller="Admin", action="Index", pathInfo="" }
    ); 
```

然后有一个控制器是这样的：

```
public class AdminController : Controller
{
    public ActionResult Index(string pathInfo)
    {
        //Do admin checks, etc here....
        return Redirect("/" + pathInfo);
    }
} 
```

但是，不幸的是，您可以使用的所有用于重定向的选项（即 Redirect、RedirectToAction 和 RedirectToRoute）都执行 302 样式重定向。基本上，这意味着您`/Admin/Product/Whatever`将执行然后弹回浏览器，告诉它重定向到`/Product/Whatever`一个全新的请求，这意味着您已经丢失了上下文。我不知道保持重定向服务器端的干净方法（即像`Server.Transfer`旧的一样），显然[SO 社区也不](https://stackoverflow.com/questions/544000/in-asp-net-mvc-preserve-url-when-return-redirecttoaction)...

（显然，这是一个非解决方案，因为它不能解决你的问题，但我想我还是把它放在这里，以防你可以以其他方式使用这些想法）

* * *

**那么，这个问题的实际解决方案是什么？**另一个想法是使用 ActionFilter（是的，我知道您说过您不想这样做，但我认为以下内容将满足您的目的）。像这样添加一条新路线：

```
routes.MapRoute(
    "Admin",
    "Admin/{controller}/{action}/{id}",
    new { controller = "Home", action = "Index", id = "", userLevel = "Admin" }
    ); 
```

然后像这样添加一个 ActionFilter （您可以通过您提到的基本控制器对象将其应用于所有请求）：

```
public class ExtendedAdminViewAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        object userLevel = filterContext.RouteData.Values["userLevel"];
        if (userLevel != null && userLevel.ToString() == "Admin")
        {
            //Do your security auth checks to ensure they really are an admin
            //Then do your extra admin logic...
        }
    }
} 
```

因此，尽管它使用了适用于所有请求的 ActionFilter，但在大多数正常情况下（即对 的请求`/Product/Whatever`）所做的唯一额外工作是对那位路由数据`userLevel`（换句话说，您应该真正看到普通用户的性能受到影响，因为您只在他们通过`/Admin/Product/Whatever`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T00:37:43.597

1）你不能只检查视图中的角色吗？

```
<% if (HttpContext.Current.User.IsInRole ("Administrator")) { %>
  // insert some admin specific stuff here
  <%= model.ExtraStuff %>
% } %> 
```

如果您需要设置管理员特定的视图模型属性，您可以在控制器中执行相同的检查。在您的控制器中，只有当用户已经通过身份验证时，您才能进行额外的处理：

```
public ActionResult Details (int productId)
{
  ProductViewModel model = new ProductViewModel ();

  if (User.Identity.IsAuthenticated && User.IsInRole ("Administrator"))
  {
    // do extra admin processing
    model.ExtraStuff = "stuff";
  }

  // now fill in the non-admin specific details
  model.ProductName = "gizmo";

  return View (model);
} 
```

这里唯一缺少的是当管理员在未经身份验证的情况下尝试访问视图时重定向到您的登录页面。

2）或者，如果您想使用一些额外的位重用默认产品视图，您可以尝试以下操作：

```
public class AdminController
{
  [Authorize(Roles = Roles.Admin)]
  public ActionResult Details(int productId)
  {
    ProductController productController = new ProductController(/*dependencies*/);

    ProductViewModel model = new ProductViewModel();
    // set admin specific bits in the model here
    model.ExtraStuff = "stuff";
    model.IsAdmin = true;

    return productController.Details(productId, model);
  }
}

public class ProductController
{
  public ActionResult Details(int productId, ProductViewModel model)
  {
    if (model == null)
    {
        model = new ProductViewModel();      
    }

    // set product bits in the model

    return Details(model);
  }
} 
```

注意：我更喜欢解决方案 1) 而不是 2)，因为您需要创建 ProductController 的新实例，并且会带来它自己的一系列问题，尤其是在使用 IoC 时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T14:25:43.067

您可以通过创建一个基本控制器类来相当容易地解决这个问题，该类检查 OnActionExecuting 中的用户级别，如果获得授权，则将 Role 属性设置为相同的值，并将“Role”条目添加到 ViewData 以在视图中使用。您可以将它用作所有控制器的基类，它们都可以访问 Role 属性，并且您的所有视图都将在 ViewData 中添加一个“Role”条目：

```
public abstract class BaseController : Controller
{
    public string Role { get; protected set; }

    protected override void OnActionExecuting( ActionExecutingContext filterContext )
    {
        base.OnActionExecuting( filterContext );
        Role = string.Empty;
        string role = string.Empty;
        object value;
        if ( filterContext.RouteData.Values.TryGetValue( "role", out value ) )
            role = value as string ?? string.Empty;
        if ( filterContext.HttpContext.User.IsInRole( role ) )
            Role = role.ToLowerInvariant();
        ViewData[ "role" ] = Role;
    }
} 
```

更改 Global.asax.cs 中的默认路由：

```
routes.MapRoute(
    "Default",                                              
    "{role}/{controller}/{action}/{id}",                           
    new { role = "", controller = "Home", action = "Index", id = "" }  
); 
```

现在，在您的控制器操作中，检查 Role 属性，例如“admin”，如果是，请为管理功能添加任何必要的视图数据。

使用局部渲染您的管理 UI，并在您的视图中检查角色并调用 RenderPartial：

```
<% if ( Equals( ViewData[ "role" ], "admin" ) )
        Html.RenderPartial( "_AdminFunctions" ); %>
<p>
    This is the standard, non Admin interface...
</p> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T15:28:13.240

这是一个“开箱即用”的答案：

如何利用 entLib 中的策略注入块？有了它，您可以创建一个对您的操作运行“预方法”的策略。您的预先方法也许可以解决您的问题。

# java - SQL排序有限制？（不平凡）

> ID：908424
> 
> 赞同：5
> 
> 时间：2009-05-25T23:58:08.920
> 
> 标签：java, sql

```
table {
  id: long
  name: string
}

1235 Fred
1902 Trever
5123 George
6467 Derek
7868 Joe
8972 Bob
9272 Alf
9842 Hank 
```

我想在 Joes 之前返回 2 条记录，**按升序**排列。

即正确的值应该是：

```
5123 George
6467 Derek 
```

有什么想法吗？供参考：

1.  返回不正确的行：

    select * from table with id<7868 order by id asc limit 2

2.  返回不正确的排序顺序：

    select * from table with id<7868 order by id desc limit 2

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T00:02:22.747

```
SELECT * FROM
  (select * from table where id<7868 order by id desc limit 2) AS foo
ORDER BY ID ASC 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T00:03:48.220

尝试：

```
Select * from (
    select * from table with id<7868 
    order by id desc limit 2
) as t order by id asc 
```

执行子查询可以让您首先获得正确的行，然后您可以重新排序它们

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T00:11:46.100

在 PostgreSQL 中：

select * from "table" where id < 7868 order by id asc limit 2 offset 2

同样在 MySQL 中（我相信）“limit 2, 2”

“LIMIT 2 OFFSET 2”也适用于 SQLite，至少在我尝试过的版本中（3.6.13）

# asp.net - 如何判断 JavaScript 文件是否已包含在 ASP.NET 页面中？

> ID：908425
> 
> 赞同：13
> 
> 时间：2009-05-25T23:59:51.740
> 
> 标签：asp.net, javascript, html, script-tag

我有一个 ASP.NET 用户控件（.ascx 文件）。在这个用户控件中，我想使用一个 .js 文件。

所以我包括`<script src="file.js" type"text/javascript"></script>`在页面上。

但是，有时我在已经加载了相同脚本的网页中使用此用户控件。

如何添加`<script />`仅当页面尚未包含`<script />`同一脚本的另一个标记时才会在页面上呈现的声明？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-26T00:31:02.457

当您使用 asp.net 时，检查服务器端是有意义的，因为您选择在其中添加对 javascript 文件的引用。从您的 .ascx 文件中，您可以注册以下内容：

```
this.Page.ClientScript.RegisterClientScriptInclude("GlobalUnqiueKey", UrlOfJavascriptFile); 
```

...从您的页面中，您只需直接调用 ClientScript 对象：

```
ClientScript.RegisterClientScriptInclude("GlobalUnqiueKey", UrlOfJavascriptFile); 
```

'GlobalUniqueKey' 可以是任何字符串（我也为此使用了 javascript 文件的 url）

如果您尝试使用相同的密钥字符串注册脚本，它不会做任何事情。因此，如果您在您的页面、控件或其他任何地方调用它，您最终将在您的页面中只有一个引用。这样做的好处是您可以在页面上拥有多个控件实例，即使它们都尝试注册相同的脚本，但最多只能完成一次。他们都不需要担心脚本已经注册。

有一个“IsClientScriptIncludeRegistered(stringkey)”方法，您可以使用该方法查看脚本是否已包含在该键下，但在注册为多次尝试注册之前进行检查似乎非常多余，不会引发异常或导致任何其他错误。

在客户端进行检查意味着，假设浏览器缓存了多个 javascript 引用（它们可能没有缓存），您仍然有多个标签，并且每个标签的开销都会导致一些 javascript 运行。如果您在一个页面上有 20 个控件实例，您可能会遇到严重的问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-26T00:10:47.597

您可以在客户端做两件事之一...

1.  检查与您要检查的 javascript 文件相对应的脚本标记的 dom
2.  测试一个您知道已经/将在 javascript 文件中定义的变量或函数，用于未定义。

这是一个快速的 JS 函数，它使用 JQuery 来做你需要的事情：

```
function requireOnce(url) {    
    if (!$("script[src='" + url + "']").length) {
        $('head').append("<script type='text/javascript' src='" + url + "'></script>"); 
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T00:10:02.700

使用类似下面的东西：

```
if(typeof myObjectOrFunctionDecalredInThisScript != 'undefined') {
  // code goes here
  var myObjectOrFunctionDecalredInThisScript = { };
} 
```

这会测试您的对象或函数是否已经存在，从而防止重新声明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-28T18:12:22.707

```
var storePath = [];
function include(path){
if(!storePath[path]){
    storePath[path]= true;
    var e = document.createElement("script");
    e.src = path;
    e.type = "text/javascript";
    document.getElementsByTagName("head")[0].appendChild(e);
    return false;
 } } 
```

在您的主页中使用它并调用函数**包含**参数 javascript 文件名

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-26T04:57:13.693

因为您只想在网站的一页上包含 javascript。
如果你使用 Asp.net(4.0) 那就很容易了。
只需包含以下代码

```
<script type="text/javascript" scr="filepath and name here"></script> 
```

在`ContentPlaceHolder`内容页面中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-10-30T16:34:07.043

@Shimmy 我在很长一段时间后遇到了这个问题，但也许它仍然有用，或者至少可以帮助后面的其他人。要检查 jquery 是否已经加载，请执行此操作

```
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.x.x.min.js"><\/script>')</script> 
```

不要错过 document.write 语句中结束脚本标记中的转义字符。

@mysomic，为什么我没有想到这一点。竖起大拇指

PS：我很想在@Shimmy 写下jQuery 本身就是他想要加载的脚本的那一行写下这个。但不知道如何在那里写。看不到回复或任何类似的链接。这可能听起来很愚蠢，但也许我错过了一些东西。请指出来，有人吗？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-06-17T15:18:05.710

如果您从服务器端需要它，并且 Page.ClientScript.RegisterClientScriptInclude 将无法为您工作，以防脚本通过 Page.ClientScript.RegisterClientScript 以外的其他方式包含（例如 page.Header.Controls.Add(..) ，你可以使用这样的东西：

```
static public void AddJsFileToHeadIfNotExists(Page page, string jsRelativePath)
{
    foreach (Control ctrl in page.Header.Controls)
    {
        if (ctrl is HtmlLink htmlLink)
        {
            if (htmlLink.Href.ToLower().Contains(jsRelativePath.ToLower())) return;
        }
        if (ctrl is ITextControl textControl
          && (textControl is LiteralControl || textControl is Literal))
        {
            if (textControl.Text.ToLower().Contains(jsRelativePath.ToLower())) return;
        }
        if (ctrl is HtmlControl htmlControl)
        {
            if (htmlControl.Attributes["src"]?.ToUpper()
              .Contains(jsRelativePath.ToUpper())) return;
        }
    }

    HtmlGenericControl Include = new HtmlGenericControl("script");
    Include.Attributes.Add("type", "text/javascript");
    Include.Attributes.Add("src", page.ResolveUrl(jsRelativePath));
    page.Header.Controls.Add(Include);    
} 
```

# xml - 从 xpath 选择器获取绝对路径

> ID：908426
> 
> 赞同：0
> 
> 时间：2009-05-26T00:00:18.930
> 
> 标签：xml, xpath

xpath 选择是否可以返回找到的每个节点的绝对路径？

举个例子

```
//chapter 
```

返回

```
//book[1]/chapter
//book[2]/chapter
... 
```

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T00:30:41.270

仅使用 XPath 没有简单的方法来做到这一点。如果您使用 XSLT，有几个可用的方法，例如[http://www.dpawson.co.uk/xsl/sect2/N6077.html#d7984e96](http://www.dpawson.co.uk/xsl/sect2/N6077.html#d7984e96)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T01:10:40.957

Python 的 lxml 模块可以通过调用 Elements 的**getpath**方法来完成。

# lambda - 为什么将 #' 与 lambda 一起使用？

> ID：908427
> 
> 赞同：14
> 
> 时间：2009-05-26T00:01:10.020
> 
> 标签：lambda, lisp, quote

为什么我应该将 #' 与 lambda 一起使用？它通常是这样写的，所以我想这是一种很好的形式。但这些线似乎和我一样：

```
> (mapcar #'(lambda (x) (+ x 1)) '(1 2 3))
(2 3 4)
> (mapcar (lambda (x) (+ x 1)) '(1 2 3))
(2 3 4) 
```

有人愿意让初学者了解差异吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-26T07:01:30.527

在各种 Lisp 方言中是不同的。以下使用 Common Lisp：

第一个 **#' 是 (function ...) 的缩写**。所以以下只是文字上的不同，但 Common Lisp 读起来是一样的：

```
#'(lambda (x) (* x 2)) 
```

和

```
(function (lambda (x) (* x 2))) 
```

#' 是一个 readmacro，在 Lisp 系统读取 Lisp 代码时进行转换。

如果 Lisp 计算

```
(function (lambda (x) (* x 2))) 
```

**Lisp 系统创建一个函数对象，FUNCTION 将它作为它的值**返回。

所以，每当你需要一个函数作为一个值时，你就需要这样写。当您想将函数作为值传递给另一个函数时，当您想从函数中返回它或当您想将它存储在变量中时，需要一个函数作为值。例子：

```
(map #'(lambda (x) (* x 2)) '(1 2 3))

(defun (y) #'(lambda (x) (* x y)))

(defparameter *twice-fn* #'(lambda (x) (* x 2))) 
```

现在，什么是 (lambda (x) (* x 2)) ？

这是两个不同的事情，具体取决于上下文。

**Lambda 表达式**

可以使用 lambda 表达式代替函数名：

```
(function foo)   and    (function (lambda (x) (* x 2))) 
```

和

```
(foo 17)    and  ((lambda (x) (* x 2)) 17) 
```

以上两个是合法的 Common Lisp 语法。可以直接使用 lambda 表达式。

请注意，以下两种形式在 Common Lisp中是**非法的：**

```
(#'(lambda (x) (* x 2)) 17)   ; illegal in Common Lisp

(function #'(lambda (x) (* x 2)))  ; illegal in Common Lisp 
```

**宏**

在 Common Lisp 标准化过程中，添加了一个宏 LAMBDA（它不是 Common Lisp 的第一个描述 CLtL1 的一部分）。它使编写稍微短一些的代码成为可能。例子：

```
(lambda (x) (* x 2)) 
```

在上述情况下，LAMBDA 是一个宏。在宏扩展期间，它将扩展为：

```
(function (lambda (x) (* x 2))) 
```

请记住，在上面的 FUNCTION 形式中，内部 lambda 是 lambda 表达式的一部分，表示函数并且不会被扩展。

所以，现在上面的三个例子可以写成：

```
(map (lambda (x) (* x 2)) '(1 2 3))

(defun (y) (lambda (x) (* x y)))

(defparameter *twice-fn* (lambda (x) (* x 2))) 
```

它稍微短一些，看起来不那么杂乱，看起来更类似于 Scheme 代码。对于习惯于读写 Scheme 代码的程序员来说，它看起来要好一些。

**概括**

a) (function (lambda (x) (* x 2))) 是编写将函数作为值返回的代码的“真实”方式。

b) #'(lambda (x) (* x 2)) 是上述的较短符号

c) (lambda (x) (* x 2)) 甚至更短，但使用宏扩展来创建 a) 的形式。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-26T00:45:11.477

`#'`是 的简写`function`，它返回一个指向函数的指针（而不是应用它）。 `lambda`返回一个函数，通常需要一个指向该函数的指针。由于这很常见，因此还有一个宏（在变量空间中）可以为您执行此操作，它也被调用`lambda`。两行代码是相同的。

哪个更好归结为[Lisp-1/Lisp-2 辩论](http://en.wikipedia.org/wiki/Common_Lisp#The_function_namespace)：在 Common Lisp 中，由于宏，您可以做任何一个。一如既往，保持一致。

# silverlight - Prism(2) Silverlight 参考数据

> ID：908436
> 
> 赞同：0
> 
> 时间：2009-05-26T00:05:31.260
> 
> 标签：silverlight, prism

我需要确保在加载模块并在屏幕上显示之前加载某些基本数据。考虑到 Silverlight 中数据加载的异步性质，我想知道是否应该遵循某种模式来加载我的数据（例如模块上的事件或要挂钩的引导程序，或要覆盖的方法）...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T06:02:19.150

您可以将模块 InitializationMode 设置为 OnDemand，一旦您有数据调用 moduleManager.LoadModule("YourModuleName"); [如此处](http://mokosh.co.uk/post/tag/prism/)所述。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T20:35:36.547

还有另一种选择。如果您知道您将需要该模块，并且数据静态存储在另一个模块中，您可以建立依赖关系：

```
ModuleCatalog m = new ModuleCatalog();
...
m.AddModule(typeof(PersonModule.PersonModule), "ModuleA"); 
```

在这种情况下，您的模块将建立对具有数据的任何模块的依赖关系，这将确保预先加载数据。

# email - 即席数据处理/ETL

> ID：908445
> 
> 赞同：1
> 
> 时间：2009-05-26T00:11:37.253
> 
> 标签：email, etl, street-address

我刚开始在一家新公司从事外包通信（例如打印和邮件、电子邮件、传真）。要求之一是处理客户数据并准备好邮寄。

对于重复性工作，使用与一些寻址软件链接的 ETL 工具很容易，但对于临时工作来说，这有点矫枉过正。我以前使用过内部开发的东西（笨重但可用），但我不想在这里重新开发。有什么建议吗？

一些特点：

*   基本 DBMS 功能（最好带有适当的 DBMS 后端以支持 SQL）
*   字段连接（例如结合名字 + 姓氏）
*   “推列”（例如，对于地址字段 1 - 8，将它们向左推，因此如果一个为空白，则下一个被推上）
*   澳大利亚邮政邮件分拣和dpid分配（或者可以相对容易地链接到外部工具）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T14:20:36.803

用 Python 或 Perl 自己动手是否可以接受？

# php - 重定向到和从另一台服务器后，我可以依赖会话可用性吗？

> ID：908448
> 
> 赞同：0
> 
> 时间：2009-05-26T00:14:27.717
> 
> 标签：php, security, apache, session

问题确实在标题中。

我有一个在线表格，经过一系列阶段后，用户被发送到另一台服务器上的支付网关，然后在完成他们的详细信息后再次返回（没有发送卡或个人信息，只是加密令牌，这就是重点）。

那么，当会话数据被发回（通过 POST 吗？）时，我可以依赖仍然可用的会话数据吗？我也*应该*这样做吗？

我的测试似乎表明是的，但这是我第一次尝试做这样的事情。另一种方法是在重定向之前保存表单进度，然后在它们返回时恢复它。那会更好吗？为什么会这样？

蒂亚:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T10:59:09.847

是的，您通常可以依赖此工作。

您的会话仍会以正常方式超时，因此只要您希望您的客户在第三方站点上花费的时间少于会话超时所需的时间，您应该没问题。

对于我维护的一些站点，我完全按照您的建议进行操作，并且没有严重的问题。我想如果您的大部分客户都希望禁用 cookie，这可能会更复杂，但如果您与公众打交道，这真的不是问题。

但是，大多数支付网关允许您向他们传递其他信息，当他们将客户返回您的站点时，他们将发送给您。即使他们没有内置的方法来执行此操作，您也可以将 GET 参数添加到他们用来将客户返回给您的 URL。在这里添加一个 ID 或订单号是非常值得的，这样即使会话已经结束，您也可以做一些事情。

注意：某些支付服务实际上不会在交易结束时将客户返回到您的站点，而只是调用您的服务器，让您知道特定的支付已完成。在这种情况下，您的会话将不完整，因为不是客户从您的 Web 服务器发出请求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T00:25:33.077

这取决于会话的超时时间以及 apache 是否崩溃/重新启动。如果您需要故障安全方式，则将会话信息保留回数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T00:27:00.437

依靠。您的 PHP 会话可能是通过使用存储会话 id 的 cookie 来处理的，但是如果您的客户关闭了 cookie，那么（取决于 SID 的配置/使用）它可以添加到查询字符串中。在 cookie 的情况下，这应该不是问题——会话应该继续。如果 cookie 被禁用，那么您将依赖支付网关提供商在返回客户时提供会话 ID

编辑：只是补充一点，如果客户没有被注销（会话结束），将表单数据存储在会话变量中应该不是问题。

至于安全性，您可能希望确保会话以某种方式限制为一个 ip（检查每个页面加载以确保它匹配）以确保会话不会被支付网关或中间其他不道德的人劫持（只有在关闭 cookie 并且查询字符串包含 PHPSESSID 时才真正值得关注）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T15:05:04.890

如果要确保会话可用，可以像这样编辑会话 cookie 超时：

```
session_set_cookie_params(604800);
session_start(); 
```

这将使 cookie 在创建一周后过期。默认是在浏览器关闭时过期。

你可以在这里读更多关于它的内容

http://uk3.php.net/manual/en/function.session-set-cookie-params.php

# asp.net-mvc - ASP MVC 以 JSON 格式查看内容

> ID：908450
> 
> 赞同：17
> 
> 时间：2009-05-26T00:15:34.423
> 
> 标签：asp.net-mvc, json, partial

我有一个 MVC 应用程序，其中包含很多使用 Ajax (jQuery) 调用的控制器操作，并返回更新屏幕的一部分的部分视图内容。但我宁愿返回 JSON 这样的东西。

```
return Json(new { 
    Result = true, 
    Message = "Item has been saved", 
    Content = View("Partial") 
}); 
```

HTML 只是 Json 的一个属性。这意味着我需要检索 View 方法呈现的 HTML。有什么简单的方法可以做到这一点，我见过的一些例子非常复杂。

编辑：这个问题最初是针对 ASP.NET MVC 1，但如果版本 2 更容易，我想听听答案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-26T15:19:39.850

这是答案！[与Martin From 的](http://thriftybliss.spaces.live.com/blog/cns!58DA805F37F31F20!170.entry)方法略有不同，它似乎有效。如果缺少某些东西，请人们在评论部分提供任何代码更改。谢谢。

从你的控制器调用它是这样的：

```
string HTMLOutput = Utils.RenderPartialToString("~/Views/Setting/IndexMain.ascx", "", items, this.ControllerContext.RequestContext); 
```

将此添加到课程中

```
public static string RenderPartialToString(string controlName, object viewData, object model, System.Web.Routing.RequestContext viewContext)
{
     ViewDataDictionary vd = new ViewDataDictionary(viewData);
     ViewPage vp = new ViewPage { ViewData = vd };

     vp.ViewData = vd;
     vp.ViewData.Model = model;
     vp.ViewContext = new ViewContext();
     vp.Url = new UrlHelper(viewContext);

     Control control = vp.LoadControl(controlName);

     vp.Controls.Add(control);

     StringBuilder sb = new StringBuilder();

     using (StringWriter sw = new StringWriter(sb))
     using (HtmlTextWriter tw = new HtmlTextWriter(sw))
     {
         vp.RenderControl(tw);
     }

     return sb.ToString();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-26T01:06:21.543

[NerdDinner](http://nerddinner.com/)有一些很好的例子。这是 NerdDinner 中的 SearchController，它有一个名为 SearchByLocation 的方法，该方法返回 JsonDinners 列表（ NerdDinner 的[源代码](http://nerddinner.codeplex.com/)是 Creative Commons）：

```
namespace NerdDinner.Controllers {

    public class JsonDinner {
        public int      DinnerID    { get; set; }
        public string   Title       { get; set; }
        public double   Latitude    { get; set; }
        public double   Longitude   { get; set; }
        public string   Description { get; set; }
        public int      RSVPCount   { get; set; }
    }

    public class SearchController : Controller {

        IDinnerRepository dinnerRepository;

        //
        // Dependency Injection enabled constructors

        public SearchController()
            : this(new DinnerRepository()) {
        }

        public SearchController(IDinnerRepository repository) {
            dinnerRepository = repository;
        }

        //
        // AJAX: /Search/FindByLocation?longitude=45&latitude=-90

        [AcceptVerbs(HttpVerbs.Post)]
        public ActionResult SearchByLocation(float latitude, float longitude) {

            var dinners = dinnerRepository.FindByLocation(latitude, longitude);

            var jsonDinners = from dinner in dinners
                              select new JsonDinner {
                                  DinnerID = dinner.DinnerID,
                                  Latitude = dinner.Latitude,
                                  Longitude = dinner.Longitude,
                                  Title = dinner.Title,
                                  Description = dinner.Description,
                                  RSVPCount = dinner.RSVPs.Count
                              };

            return Json(jsonDinners.ToList());
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-29T10:06:46.130

这是解决问题的好方法：http: [//craftycode.wordpress.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/](http://craftycode.wordpress.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-05T21:10:09.677

我正在使用本文中的 HTML Helper：[Render partial view to string in ASP.NET MVC](http://www.klopfenstein.net/lorenz.aspx/render-partial-view-to-string-in-asp-net-mvc)。它完美地工作！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-22T14:54:56.123

我花了很长时间试图做同样的事情。我有一个需要扩展的快速解决方案。

注意：我已经看到了一个问题。所有 cookie 和其他变量都丢失了 :(

我做了什么：

1.  创建新的 ActionResult

    ```
    public class JsonHtmlViewResult : ViewResult
    {
        public IJsonHtml Data { get; set; }

        public override void ExecuteResult(ControllerContext context)
        {
            if (Data == null)
            {
                Data = new DefaultJsonHtml();
            }

            using (StringWriter sw = new StringWriter())
            {
                HttpRequest request = HttpContext.Current.Request;
                HttpContext.Current = new HttpContext(request, new HttpResponse(sw));

                base.ExecuteResult(context);

                Data.HtmlContent = sw.ToString();
            }

            // Do the serialization stuff.
            HttpResponseBase response = context.HttpContext.Response;
            response.ClearContent();
            response.ContentType = "application/json";

            JavaScriptSerializer serializer = new JavaScriptSerializer();
            response.Write(serializer.Serialize(Data));
        }
    } 
    ```

2.  数据类

    ```
    public interface IJsonHtml
    {
        String HtmlContent { get; set; }
    }

    public class DefaultJsonHtml : IJsonHtml
    {
        public String HtmlContent { get; set; }
    } 
    ```

3.  控制器扩展

    ```
    public static ActionResult JsonHtmlViewResult(this Controller controller, string viewName, string masterName, object model, IJsonHtml data)
    {
        if (model != null)
        {
            controller.ViewData.Model = model;
        }

        return new JsonHtmlViewResult
        {
            Data = data,
            ViewName = viewName,
            MasterName = masterName,
            ViewData = controller.ViewData,
            TempData = controller.TempData
        };
    } 
    ```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-17T23:13:23.093

我使用 Razor 找到了一个更新的答案，这可能会有所帮助[http://codepaste.net/8xkoj2](http://codepaste.net/8xkoj2)

```
public static string RenderViewToString(string viewPath, object model,ControllerContext context)
{            
    var viewEngineResult = ViewEngines.Engines.FindView(context, viewPath, null);
    var view = viewEngineResult.View;

    context.Controller.ViewData.Model = model;

    string result = String.Empty;
    using (var sw = new StringWriter())
    {

        var ctx = new ViewContext(context, view, 
                                  context.Controller.ViewData, 
                                  context.Controller.TempData, 
                                  sw);
        view.Render(ctx, sw);

        result = sw.ToString();
    }

    return result;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T01:08:52.770

为什么不只使用静态 html“部分”并从 json 中获取所有动态内容？当页面加载或需要时，您应该能够使用 jquery 加载 html 文件。

[JQuery Ajax](http://docs.jquery.com/Ajax/jQuery.get#urldatacallbacktype)上的这个链接给出了这个例子：

```
//Alert out the results from requesting test.php (HTML or XML, depending on what was returned).
$.get("test.php", function(data){
  alert("Data Loaded: " + data);
}); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-09T06:56:35.200

我不知道从哪个版本号开始你可以做到这一点，但现在你可以用一种非常简单的方式返回 JSON：

```
public ActionResult JSONaction()
{
    return Json(data, JsonRequestBehavior);
} 
```

不需要精心制作的助手等。

data 当然是您模型中的数据 JsonRequestBehavior 指定是否允许来自客户端的 HTTP GET 请求。（[来源](http://msdn.microsoft.com/en-us/library/system.web.mvc.jsonrequestbehavior%28v=vs.108%29.aspx)），是可选的，`DenyGet`是默认行为，所以如果主要使用`JsonRequestBehavior.AllowGet`，[这](https://stackoverflow.com/questions/8464677/why-is-jsonrequestbehavior-needed)就是为什么它在那里

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-26T02:28:30.050

克雷格，

看看这个。Jeffery Palermo 为 ASP.NET MVC 编写了一个子控制器，它应该可以完成你想要的：

MvcContrib - 现在支持 ASP.NET MVC 的子控制器：http: [//jeffreypalermo.com/blog/mvccontrib-now-with-subcontroller-support/](http://jeffreypalermo.com/blog/mvccontrib-now-with-subcontroller-support/)

# windows - 用于将更改拉到多个存储库的 mercurial windows 批处理文件

> ID：908452
> 
> 赞同：1
> 
> 时间：2009-05-26T00:16:24.530
> 
> 标签：windows, mercurial, batch-file

我是 Windows 上的一个 mercurial 用户，我正在尝试编写一个批处理文件来检查对存储在一个公共文件夹中的多个存储库的传入更改（即主文件夹下可能有 10 个左右的小型 mercurial 存储库）。我有以下批处理文件，它成功地遍历了多个存储库并运行 hg 传入。但是，当发现具有远程更改的存储库时，我似乎无法让它执行 hg -pull -u 。

```
 FOR /D /r %%G in (".hg*") DO (
    @echo Processing: %%G
    cd /d %%G\.. 
    hg incoming
    IF NOT ERRORLEVEL 0 (
        echo Pulling changes from the server
        hg pull -u
    )
    cd..
    ) 
```

我很确定问题出在 If 语句上。hg 传入似乎没有可以由 ERRORLEVEL 解释的返回值。这是正确的方法还是我应该使用 python 代替？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T09:10:53.277

`hg incoming`and的退出代码`hg outgoing`是`1`如果没有传入/传出变更集，`0`否则，这意味着您的测试是倒退的。（自从提出这个问题以来，退出代码已经记录在案，现在可以在`hg help incoming`和中找到`hg help outgoing`。）

此外，两者都做`hg incoming`并且`hg pull`做两次：你应该简单地使用`hg pull`. 的帮助`hg incoming`说：

> 对于远程存储库，`--bundle`如果传入后跟随拉取，则使用可避免两次下载变更集。

因此，您实际上是使用两倍的带宽下载所有变更集两次。

# bash - 如何在编辑过程中将文件保存在内存中？

> ID：908457
> 
> 赞同：7
> 
> 时间：2009-05-26T00:24:04.077
> 
> 标签：bash, vim, gnupg

短版：回声“测试”| vim - | grep “好”

这不起作用，因为 vim 不会输出到管道。它说：“Vim：警告：输出不是终端”。有什么办法可以做到这一点？跨编辑器支持也会很好。

我试过命名管道，但 vim 不会打开它们。

长版：echo $passw | gpg -q -d --passphrase-fd 0 $文件名 | vim - | “gpg 以某种方式使用 $passw 对其进行加密并将其存储回 $filename”。

我正在尝试编辑一个 gpg 加密文件，但不想在任何时候将解密文件放在磁盘上。

完整的脚本在这里：[https ://github.com/ptarjan/viencrypt](https://github.com/ptarjan/viencrypt)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T05:41:31.873

请记住，默认情况下 Vim 会在磁盘上创建一个交换文件。使用以下命令启动 vim 以避免它：

```
vim "+set noswapfile" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-26T02:32:04.443

你可以让 vim 为你加密它。

在将文件保存到 vim 之前，请通过 gpg 加密器过滤内容：

```
    :{range}![!]{filter} [!][arg] *:range!*
          通过外部程序过滤 {range} 行
          {筛选}。Vim 用
          最新给定的命令并附加可选的 [arg]。
          Vim 将 filter 命令的输出保存在
          临时文件，然后将文件读入
          缓冲。Vim 使用 'shellredir' 选项来重定向
          过滤器输出到临时文件。
          但是，如果 'shelltemp' 选项关闭，则管道
          尽可能使用（在 Unix 上）。
          当 'R' 标志包含在 'cpoptions' 标记中时
          过滤的行被删除，除非
          |:标记| 使用命令。示例：>
            :keepmarks '<,'>!sort
    <            
          当过滤后的行数小于
          之前，无论如何都会删除缺失行中的标记。
        w

```

所以，如果你想通过 gpg 过滤它（我猜这里的标志）：

```
:%!gpg -q -d -p $password
:w $filename 
```

如果您想在 vim 中使用它们，您需要导出`$password`和`$filename`环境变量，以便 vim 可以访问它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-26T00:29:30.790

您可以在某处安装一个 tmpfs 文件系统（将数据存储在内存中）并在那里完成您的工作。

编辑（！）：对不起，做那个ramfs。不同之处在于 tmpfs 可以被调出交换空间，这是您不想要的。或者，您可以关闭所有交换设备（使用 swapoff）并使用 tmpfs。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-05-31T05:21:47.453

另一种选择是为 Vim 使用[gnupg](http://www.vim.org/scripts/script.php?script_id=3645)插件，而不是重新发明轮子。:) 当然，我有点偏见，因为我是插件的当前维护者。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T00:35:00.047

这是正确的：Vim 不会输出到管道。Vim 不会将其输入输出到管道，而是将其输出到编辑器窗口中，您可以在其中编辑它。您无法在 vim 之后继续管道序列。所以试试：

回声 $passw | gpg -q -d --passphrase-fd 0 $文件名 | vim -

或者根本不使用 vim。

如果您想在传回 gpg 之前编辑文件，则必须分两步进行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-26T06:04:58.880

您可以使用该`%p`命令将正在编辑的文件打印到标准输出。

在本例中，Vim 读取其标准输入并将其发送到标准输出：

```
$ (echo one; echo two; echo three; echo four) | \
  vim - -nes -u NONE  -c ':%p' -c ':q!' | \
  tail -n +2 | \
  grep t
two
three 
```

笔记：

*   `vim -`: 从标准输入读取
*   `-n`：不创建交换文件，只使用内存
*   `-e`: 以 ex 模式启动
*   `-s`：静默或批处理模式
*   `-u NONE`: 不要阅读`.vimrc`(如果你想`.vimrc`被阅读，跳过这个选项。但是不同的人有不同的`.vimrc`-s，所以如果你不写`-u NONE`，你的代码可能不适用于不同的人，甚至对你来说，如果你改变你的`.vimrc`。）
*   `-c <something>`: 作为命令运行某些东西
*   `-c ':%p'`: 将缓冲区的内容打印到标准输出
*   `-c 'q!'`： 不保存直接退出
*   `tail -n +2`: 扔掉 Vim 输出的第一行（也就是 ' `Vim: Reading from stdin...`' 行）

在下面的例子中，Vim 实际上做了一些有用的事情：它删除了标准输入的第一列。

```
$ (echo one; echo two; echo three; echo four) | \
  vim - -nes -u NONE  -c ':exec "normal G\<c-v>ggx"' -c ':%p' -c ':q!' | \
  tail -n +2
ne
wo
hree
our 
```

笔记：

*   `:exec`：执行以下命令（命令行命令，非普通模式命令）
*   `normal`：执行给定正常模式命令的命令行命令
*   `G`: 转到文件的最后一行
*   `\<c-v>`: 开始块选择
*   `gg`: 转到第一行
*   `x`: 删除选中的字符

编辑：

> 我可以在交互式会话中的 ":wq" 之后立即告诉 vim 发出 ":%p" 吗？

你可以告诉 Vim 诸如“退出前运行命令 X”之类的事情，例如使用 VimLeave 自动命令（参见`:help autocommand`, `:help VimLeave`）：

```
$ (echo "line 1"; echo "line 2") | \
  vim - -nes -u NONE -c ':autocmd VimLeave * :%p'
Vim: Reading from stdin...
:q!        # you type :q!
line 1
line 2 
```

问题出在“:%p”命令上。如果您使用“-e”参数，您将无法获得可视化编辑器。如果你不使用 "-e"，Vim 不会将 ":%p" 的结果打印到标准输出，而是打印到终端。

我将在另一篇文章中提出不同的建议。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-26T21:30:08.123

原始问题的解决方案（据我所知）：

`secret.txt`包含加密的文本。

`./encode.sh`是对称编码器脚本。

以下命令将从 secret.txt 中读取文本，解码，使其在 Vim 中可编辑，编码，然后将其写回 secret.txt：

```
$ cp secret.txt | \
  ./encode.sh | \
  vim - -n -u NONE \
      -c ':autocmd VimLeave * :exec "%!./encode.sh" | write! tmp'; \
  mv tmp secret.txt 
```

笔记：

*   `:autocmd VimLeave * <command>`:`<command>`在离开 Vim 之前执行任何文件
*   `:exec "%!./encode.sh" | write! secret.txt`:`./encode.sh`将缓冲区的全部内容作为过滤器运行，然后将缓冲区写入`secret.txt`
*   “作为过滤器”意味着缓冲区的内容将被送入 `./encode.sh`. 缓冲区的内容将在`./encode.sh`执行完成后被标准输出替换。

但我不得不说，这个解决方案是丑陋的。我会推荐[与 rampion 相同的方法](https://stackoverflow.com/questions/908457/how-can-i-keep-a-file-in-memory-during-editing/908703#908703)：查看提到的自动命令 ( `:help autocommand`) 并尝试在 Vim 中完成整个编辑过程。

最后附注：Vim 有自己的加密命令，它完全按照您在[项目网页上](http://github.com/ptarjan/gpg-encrypt/tree/master)的描述：“它只是将文件解密为只有您可读的文件，您在您最喜欢的编辑器中编辑它，然后重新加密它并将文件保存回它的来源。”

Vim 帮助 ( `:help :X`) 说明了该算法：

> *   使用的算法是可破解的。一个 4 个字符的密钥在大约一小时内，一个 6 个字符的密钥在一天内（在 Pentium 133 PC 上）。这要求您知道一些必须出现在文件中的文本。专家可以用任何键破解它。当文本被解密后，这也意味着密钥可以被泄露，其他使用相同密钥加密的文件也可以被解密。
> *   Pkzip 使用相同的加密，美国政府不反对其出口。Pkzip 的公共文件 APPNOTE.TXT 详细描述了这个算法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-26T00:34:29.000

你不能对 root 用户隐藏任何东西，即使是在内存中（他们可以访问 /dev/mem）。这是无法回避的事实。

所以我只使用你的主目录中的临时文件，除了root之外，它应该受到保护。在一行中，输入：

```
echo "testing" >~/proc$$ ; vim ~/proc$$ ;
    grep "good" ~/proc$$ ; rm -f ~/proc$$ 
```

如果您想要真正的安全性，请将文件移动到您是唯一 root 用户的框中并在那里执行。然后将加密文件移回。

# grails - 从 groovy 堆栈跟踪中获取源代码信息

> ID：908463
> 
> 赞同：1
> 
> 时间：2009-05-26T00:26:44.633
> 
> 标签：grails, groovy, stack-trace

生成异常时，我想显示特定异常的一些附加信息（源代码）。但是 grails 有非常多的例外（这都是关于 groovy 动态性质的）。我的问题是从哪里获取以及如何显示源代码。我需要的只是文件/行信息。

那么...是否有可能获取在 grails/groovy 中生成异常的文件和行？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-27T10:25:34.283

嗯，你还没有得到这个？默认情况下，我所有的 grails 异常都包含文件/行信息。唯一的困难是，如果异常在闭包中，它不会显示实际的闭包名称。你能发布一个示例堆栈跟踪吗？

# sql - SQL Server 查询按列中的最大值分组

> ID：908472
> 
> 赞同：6
> 
> 时间：2009-05-26T00:33:04.043
> 
> 标签：sql, sql-server-2005, tsql, sql-server-2008

****更新：**

**使用 MS SQL Server 2005 中可用的 Rank() over partition 语法确实为我指明了正确的方向，它（或者我应该写“I”）无法在不求助于枚举代码行的情况下给我所需的结果.**

**例如，如果我们选择排名的 TOP (1)，我只会得到一个值，即 slot 1。如果我使用 MAX()，那么我会得到每个 slot 的排名靠前的值......在我的情况下, 不起作用，因为如果插槽 2 的顶部值为 NULL，但它旁边的 MAX 值是非空的，那就是我想要的。**

**因此，由于找不到完整的 T-SQL 解决方案，我只好在 SQL 中尽可能多地进行过滤，然后在客户端的代码中枚举结果。**

原来的：

我一直在[阅读高级 T-SQL 书籍](https://rads.stackoverflow.com/amzn/click/com/0964981203)、StackOverflow 和谷歌，试图弄清楚如何通过使用数据透视或使用分析函数来处理这个查询。到目前为止，我还没有找到正确的组合。

我有排序的时间表（更高的价值，更大的优先级）。每个时间表都有一个播放列表，其中包含一定数量的带有文件的编号插槽。

我需要做的是排列所有时间表及其相关的播放列表，并且对于每个插槽，从时间表中获取具有最高排名值的文件。

所以，如果我有一个特定客户的查询，播放列表和时间表之间有一个连接，按 Schedule.Rank DESC 排序，如下所示：

```
PlaylistId   Schedule.Rank    SlotNumber    FileId
100               100             1          1001
100               100             2          NULL
100               100             3          NULL
200                80             1          1101
200                80             2          NULL 
200                80             3          NULL
300                60             1          1201
300                60             2          NULL
300                60             3          2202
400                20             1          1301
400                20             2          2301
400                20             3          NULL 
```

由此，我需要找到每个 slotnumber 的 MAX 排名行的 FileId：

```
SlotNumber   FileId    Schedule.Rank
1             1001         100
2             2301          20
3             2202          60 
```

关于如何做到这一点的任何想法？

下表定义：

```
CREATE TABLE dbo.Playlists(
    id int NOT NULL)

CREATE TABLE dbo.Customers(
    id int NOT NULL,
    name nchar(10) NULL)

CREATE TABLE dbo.Schedules(
    id int NOT NULL,
    rank int NOT NULL,
    playlistid int NULL,
    customerid int NULL)

CREATE TABLE dbo.PlaylistSlots(
    id int NOT NULL,
    slotnumber int NOT NULL,
    playlistid int NULL,
    fileid int NULL) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T00:45:27.637

```
SELECT slotnumber, fileid, rank
FROM
(
    SELECT slotnumber, fileid, Schedules.rank, RANK() OVER (PARTITION BY slotnumber ORDER BY Schedules.rank DESC) as rankfunc
    FROM Schedules
    INNER JOIN PlaylistSlots ON Schedules.playlistid = PlaylistSlots.playlistid
) tmp
WHERE rankfunc = 1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T00:39:01.630

您是否查看过 SQL Server（2005 年以后）的[PARTITION 和 RANK](http://weblogs.sqlteam.com/jeffs/archive/2007/03/28/60146.aspx)功能？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T01:00:18.107

```
 select SlotNumber, FileId, ScheduleRank
FROM intermediateTable a, 
(
   SELECT SlotNumber, Max(Schedule.Rank) as MaxRank
   FROM intermediateTable O
   WHERE FileId is not null GROUP BY SlotNumber) b
WHERE b.SlotNumber = a.SlotNumber and b.MaxRank = a.Rank 

```

此查询使用中间输出来构建最终输出。
这有帮助吗？

# javascript - 如何在给定的偏移量处获取 HTML 字符串中的父元素？

> ID：908477
> 
> 赞同：2
> 
> 时间：2009-05-26T00:36:08.967
> 
> 标签：javascript, dom, text, highlight, offset

## 新问题

我正在寻找一种在 Javascript 中获取 HTML 字符串中给定位置的父元素的方法（例如 document.innerHTML 或 document.body.innerHTML）。

简单的例子：

```
<p>I really <em>like <a href="...">stackoverflow</a></em> a lot.</p>
                                   ^...........^
                               Offset 35  to  48 
```

给定偏移量 35（到 48），该函数应返回“a”元素的节点对象。我想知道这是否可能，如果是的话，解决这个问题的好方法是什么。

*提前感谢您的努力！*

* * *

## 老问题

有没有办法在 Firefox 的 HTML 文档中突出显示给定偏移量的文本？

我有一个要突出显示的偏移量和字符串长度的列表。我想我需要在给定的偏移量处找出文本节点的父元素，对吗？

我认为一旦我有了正确的父节点，添加突出显示对我来说应该不是问题，因为这只是 DOM 操作。

你有什么想法或提示吗？

**澄清：**偏移量是相对于 body 标签的内容。感谢@Jonathan 指出这一点。

非常感谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T00:54:07.760

查看[Search and Highlight With Javascript](http://www.nsftools.com/misc/SearchAndHighlight.htm)的源代码，它可能是一个很好的起点。

# c# - ScrollableControl 和事件中的 Windows 窗体控件

> ID：908486
> 
> 赞同：0
> 
> 时间：2009-05-26T00:42:08.097
> 
> 标签：c#, winforms, events, controls

我注意到，当单击 ScrollableControl（面板等）中包含的控件时，并不总是会触发 Click 事件或其他控件行为。

如果被单击的控件没有焦点并且仅部分可见，则它会滚动到视图中。这是我所期望的，但是 Click 事件不会被触发或其他控制行为不会发生。

如果控件已经具有焦点并且仅部分可见，则事件会被触发。

复选框 - 滚动到视图中，选中状态不会改变。CheckedListBox - 滚动到视图中，单击的项目没有被选中。TreeView - 滚动到视图中，单击的节点没有被选中。按钮 - 滚动到视图中，不会引发单击事件。

要重现这一点，您可以执行以下操作：

1.  将上述任何控件添加到面板
2.  为 Click、SelectedItemChanged 等添加事件处理程序
3.  调整表单大小，使滚动条在面板上可见
4.  滚动面板，使其中一个控件部分可见
5.  单击部分可见的控件

有什么方法可以确保事件被触发？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T02:40:34.567

大卫，

它对我有用。

**Form1.Designer.cs**中的代码：

 **```
namespace WindowsFormsApplication1
{
    partial class Form1
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.panel1 = new System.Windows.Forms.Panel();
            this.textBox2 = new System.Windows.Forms.TextBox();
            this.textBox1 = new System.Windows.Forms.TextBox();
            this.panel1.SuspendLayout();
            this.SuspendLayout();
            // 
            // panel1
            // 
            this.panel1.AutoScroll = true;
            this.panel1.Controls.Add(this.textBox2);
            this.panel1.Controls.Add(this.textBox1);
            this.panel1.Location = new System.Drawing.Point(86, 75);
            this.panel1.Name = "panel1";
            this.panel1.Size = new System.Drawing.Size(176, 70);
            this.panel1.TabIndex = 0;
            // 
            // textBox2
            // 
            this.textBox2.Location = new System.Drawing.Point(109, 17);
            this.textBox2.Name = "textBox2";
            this.textBox2.Size = new System.Drawing.Size(100, 20);
            this.textBox2.TabIndex = 1;
            this.textBox2.Click += new System.EventHandler(this.textBox2_Click);
            // 
            // textBox1
            // 
            this.textBox1.Location = new System.Drawing.Point(3, 17);
            this.textBox1.Name = "textBox1";
            this.textBox1.Size = new System.Drawing.Size(100, 20);
            this.textBox1.TabIndex = 0;
            this.textBox1.Click += new System.EventHandler(this.textBox1_Click);
            // 
            // Form1
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(493, 271);
            this.Controls.Add(this.panel1);
            this.Name = "Form1";
            this.Text = "Form1";
            this.panel1.ResumeLayout(false);
            this.panel1.PerformLayout();
            this.ResumeLayout(false);

        }

        #endregion

        private System.Windows.Forms.Panel panel1;
        private System.Windows.Forms.TextBox textBox2;
        private System.Windows.Forms.TextBox textBox1;
    }
} 
```

**Form1.cs**中的代码：

 **```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void textBox1_Click(object sender, EventArgs e)
        {
            MessageBox.Show("Click1");
        }

        private void textBox2_Click(object sender, EventArgs e)
        {
            MessageBox.Show("Click2");
        }
    }
} 
```

# ruby-on-rails - 插件可用于 rake 任务吗？

> ID：908487
> 
> 赞同：0
> 
> 时间：2009-05-26T00:42:37.847
> 
> 标签：ruby-on-rails, ruby, plugins, rake

当我为使用插件中定义的模型的应用程序运行 rake 任务时，我得到一个未初始化常量错误，但是当我使用脚本/运行器运行模型进程时，它在 rake 任务中被触发，那么作业运行正常吗？

加载我所有插件的脚本/运行程序之间是否存在一些区别，即使它正在传递一个环境，当我启动一个 rake 任务时也不会发生这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T00:55:44.980

您的 rake 任务需要依赖于 :environment。这将启动您的应用程序的环境并让您访问您的模型等。

例如

```
desc "Make DB Views"
task :views => [:environment] do |t|
# your task's code

end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-25T15:55:42.030

You need to specify that your Rake task requires the environment to be loaded:

```
task :your_task => :environment do |t| ... 
```

or

```
task :your_task => [:environment] do |t| ... 
```

or

```
task :your_task, :param1, :param2, :needs => :environment do |t, args| ... 
```

or

```
task :your_task, :param1, :param2, :needs => [:environment] do |t, args| ... 
```

If you did specify this, then there is another problem. I think one common source of errors is due to the fact that the plugins are loaded inside a namespace called `Rails::Plugin`. So if you defined a class called `Foo` in your plugin, then the Rake task needs to reference it as `Rails::Plugin::Foo` instead of simply `Foo`.

If this does not solve your problem then try to add `puts "Check"` on the first line of the plugin's `init.rb` file, and make sure that `Check` is displayed when you run your rake task. If it is, then your plugin is being loaded, but perhaps it fails silently after that.

One last thing: maybe you are trying to use the plugin outside the task, for example at the beginning of your Rake file, in some initialization code? If so, then it will fail because the plugins only get loaded when the task is executed (when the environment is loaded).

Hope this helps.

# eclipse - Eclipse - 运行不在本机 Eclipse 控制台中的程序

> ID：908488
> 
> 赞同：14
> 
> 时间：2009-05-26T00:43:16.143
> 
> 标签：eclipse

我目前正在编写一些 ncurses 代码，而本机 Eclipse (3.2.2) 控制台无法显示其图形。相反，我想通过 xterm 运行该程序。我想要的是能够启动 xterm 并从那里运行。我宁愿不参与任何插件或爵士乐。只是一些简单的事情。

编辑

所以我有答案，而且很简单...运行-> 外部工具-> 外部工具-> 新启动配置... 然后选择终端模拟器的位置。/usr/bin/gnome-terminal 就我而言。之后设置适当的参数。“-e ~/ncurses/start”就我而言。然后通过取消选中“通用”选项卡中的该选项来确保您没有分配控制台。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-26T04:16:49.150

[Annon](https://stackoverflow.com/users/112316/annon)补充了他的问题：

> 不断在 Eclipse 和终端之间来回切换是一件很痛苦的事情。我正在寻找一种方法来点击“F5”之类的东西并让它在新的 xterm 终端进程中运行我的 ncurses 程序

最简单的方法是将命令行报告到外部工具配置中，并指向 eclipse 使用 shell（如[本程序](http://www.avajava.com/tutorials/lessons/how-do-i-open-a-windows-command-prompt-in-my-console.html)中所述）

![http://www.avajava.com/tutorials/eclipse/how-do-i-open-a-windows-command-prompt-in-my-console/how-do-i-open-a-windows-command-在我的控制台中提示-03.gif](https://i.stack.imgur.com/GB0bv.png)

在参数中，您将添加命令行 eclipse execute （可以检索的命令行，如下面本答案的第二部分所述）。
当然，用您选择的 shell 替换“cmd.exe”，并尽量**不要在该外部启动器的“常用”选项卡中设置**“ `Allocate Console`”复选框。

![http://www.avajava.com/tutorials/eclipse/how-do-i-open-a-windows-command-prompt-in-my-console/how-do-i-open-a-windows-command-提示在我的控制台 04.gif](https://i.stack.imgur.com/FZwJb.png)

* * *

通过 xterm 启动，不涉及 eclipse（不是你想要的，只是保留在这里存档）

您可以通过 Eclipse（运行配置）启动程序，并通过“ps”命令观察所使用的确切 Java 命令行。
或者在调试模式下启动它，然后在调试视图中右键单击任务并打开属性。它将显示命令行，如此[处](http://dev.eclipse.org/newslists/news.eclipse.newcomer/msg13645.html)所述。

然后直接在您的控制台中启动该命令行（此时根本不涉及 Eclipse）。

![http://www.aicas.com/jamaica/3.4/doc/html/debugger1.gif](https://i.stack.imgur.com/VAhQd.gif)

# java - Eclipse/Java 代码完成不起作用

> ID：908489
> 
> 赞同：641
> 
> 时间：2009-05-26T00:43:45.363
> 
> 标签：java, eclipse, ide

我已经下载、解压缩并设置了 Eclipse 3.4.2 和一些插件（值得注意的、EPIC、Clearcase、QuantumDB、MisterQ）。

现在我发现当我编辑 Java 项目时，代码完成不起作用。如果我键入`String.`并按`ctrl`+`space`一个弹出窗口显示“无默认建议”，底部的状态栏显示“没有可用的完成”。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1352
> 
> 时间：2009-05-26T04:24:53.317

尝试**恢复**' `Windows > Preferences > Java > Editor > Content Assist > Advanced`'中的默认选项

您在此首选项屏幕中看到的数据类型示例，但不一定是您当前拥有的数据。

![eclipse 内容辅助设置](https://i.stack.imgur.com/bkZLv.jpg)

（来自[Vadim](http://www.berezniker.com/users/vadim)在这篇[博文中的“Eclipse (Mylyn) 中的内容辅助重复项”](http://www.berezniker.com/content/pages/java/content-assist-duplicates-eclipse-mylyn)：
如果有重复的 Mylyn 条目，请取消选中名称中不包含“ `(Mylyn)`”的重复条目）

[Eclipse 帮助页面](http://help.eclipse.org/helios/index.jsp?topic=/org.eclipse.jdt.doc.user/reference/preferences/java/editor/ref-preferences-content-assist-advanced.htm)定义了要恢复的默认列表：

> **选择“默认”内容辅助列表**中包含的提案种类：
> 
> *   其他 Java 提案，
> *   SWT 模板提案，
> *   模板提案，
> *   类型提案

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2013-01-21T19:37:52.120

我在这里添加一个答案，以防其他人在 Google 上找到它。相同的症状；不同的问题。对我来说，类型缓存已经损坏。

来自[http://mschrag.blogspot.co.nz/2009/01/open-type-cant-find-your-class.html](http://mschrag.blogspot.co.nz/2009/01/open-type-cant-find-your-class.html)

*   退出 Eclipse
*   转到工作区/.metadata/.plugins/org.eclipse.jdt.core
*   删除 *.index 和 savedIndexNames.txt
*   重新启动 Eclipse 并搜索`Ctrl`+`T`查找有问题的类型。索引将被重建。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2017-06-17T09:45:23.840

如果有人来这里并想激活自动完成功能，请转到

`Preferences -> Java -> Editor -> Content Assist.`

然后在**自动激活**部分填写 Java 的**自动激活触发器**：

```
abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ._ 
```

[![在此处输入图像描述](https://i.stack.imgur.com/d4vOQ.png)](https://i.stack.imgur.com/d4vOQ.png)

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2013-05-04T05:34:11.477

对于那些运行 Xfce + 并激活了 IBus 插件的用户，可能存在键盘快捷键冲突。

在我的博客上查看更多信息：http: [//peter-butkovic.blogspot.de/2013/05/keyboard-shortcut-ctrlspace-caught-in.html](http://peter-butkovic.blogspot.de/2013/05/keyboard-shortcut-ctrlspace-caught-in.html)

**更新**：

正如@nhahtdh 的评论所建议的那样，添加更多信息以直接回答：Xfce 中的 IBus 插件默认使用`Ctrl`+`Space`快捷键进行键盘布局切换。要更改它，请转到：选项并将其更改为您喜欢的任何其他内容。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-04-27T11:30:09.647

检查项目的库。可能是您包含了两个这样的 jar 文件，其中相同的类可用，或者说代码中的一个类可以在两个 jar 文件中引用。在这种情况下，eclipse 也会停止辅助代码，因为它完全被混淆了。

更好的检查方法是转到辅助不起作用的文件并在其中注释所有导入，而不是逐个添加导入并在每次导入时检查代码辅助是否正常工作。您可以轻松找到具有重复引用的类.

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2013-11-30T11:53:35.507

这些都不适合我。

我只在一次特定的课程中遇到过这个问题。最终对我有用的是删除有问题的类并重新创建它。问题解决了……神秘没那么多！

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2015-01-07T10:39:11.373

另一个对我有用的解决方案是转到 Java--> Appearence --> Type Filters 并禁用所有![在此处输入图像描述](https://i.stack.imgur.com/HrfDh.png)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-05-26T11:39:53.757

如果您安装了 Google Toolbar for IE，可能会遇到同样的问题。因为，工具栏捕获了快捷键 ctrl `+Space`。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-01-01T04:22:32.173

我遇到了这个问题，就像@Marc 一样，只在一个特定的课程上。我发现我需要指定 Open With = Java Editor。作为一个 Eclipse 新手，我什至没有意识到我只是在使用纯文本编辑器。

在包资源管理器中，右键单击该文件并选择“打开方式”。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-11-21T18:22:04.867

我遇到了这个问题，并花了几个小时试图找出问题所在。尝试按照上面不同答案中提到的步骤进行操作，我找到的解决方案与 Mona 建议的方法相同，但略有不同。试图添加作为对 Mona 答案的评论，但没有可用的选项。我的 Eclipse 的问题是，类路径不知何故损坏了，所有的 jar 和依赖项目都丢失了。从存储库中获取最新的 .classpath 后，它运行良好。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2014-01-17T21:41:34.567

检查您是否没有过滤掉 Window > Preferences > Java > Appearance > Type Filters 中的许多选项

此列表中的项目不会出现在快速修复中，不会自动完成，也不会出现在其他不同的地方，例如“打开类型”对话框。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2014-09-11T09:59:30.653

我也面临这个问题，但它以不同的方式解决。我遵循的步骤可能对其他人有帮助。

1.  右键单击项目（您正在处理的项目）
2.  转到属性 > Java 构建路径 > JRE 系统库
3.  点击右侧的编辑...
4.  选择 JRE 7

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2017-01-11T09:01:28.727

一旦您检查了配置并且完成仍然无法正常工作：

*   **确保你有正确的目录结构。**

您看到文件旁边的正确图标了吗？：

[![在此处输入图像描述](https://i.stack.imgur.com/vGNoP.png)](https://i.stack.imgur.com/vGNoP.png)

它将告诉您 Eclipse 将如何处理该文件：

[![在此处输入图像描述](https://i.stack.imgur.com/hHHgf.png)](https://i.stack.imgur.com/hHHgf.png)

我发布了这个答案，因为我与 Maven webapp 工件有过这个故事。默认情况下，Maven-WebApp 不会为源创建文件夹，我将我的 Java 放入资源中，想知道发生了什么 5 分钟...... :)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2018-01-24T14:33:30.567

也许这可以帮助遇到同样问题的其他人。

我的设置：由其他人制作的旧 Gradle 项目（版本 Gradle 2.12），使用 Gradle 导入向导导入 STS（Eclipse Oxygen.2 (4.7.2)）。

代码完成也不起作用（我仍然在 Java 文件中有空 Js），但至少我通过以下方式使代码完成工作：

*   右键单击项目文件夹 > 属性 > Gradle > 配置工作区设置 > Java > 编辑器 > 内容辅助 > 高级
*   检查上方窗口中的“Java 提案”。
*   2x 申请并关闭

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2020-04-14T22:59:28.083

自从升级到 Eclipse 2019-09 以来，我遇到了这个问题。根据上面的一些建议，这对我有用。

我必须去 Eclipse -> Preferences -> Java -> Editor -> Content Assist -> Advanced。

[![Java 编辑器/内容辅助高级](https://i.stack.imgur.com/f8UCl.png)](https://i.stack.imgur.com/f8UCl.png)

我发现如果我打开任何键绑定建议，Java Non-Type、Java、Java（Task-Focused）或 Java Type 建议，那么我就可以使用自动完成。如果我将它们全部打开，那么不仅会自动完成工作，而且还会列出重复的方法。我猜，但我可能会使用 Java 类型建议。任何澄清这四种类型的不同之处将不胜感激。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2015-12-02T08:27:48.893

就我而言，Intellisense 只在一个项目的几个课程中消失了。原来这是因为构建路径上缺少一个库（尽管它以前工作过）。

所以一定要检查 Eclipse 中的所有错误或问题，并尝试查找是否可能缺少库

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2016-06-07T19:05:38.913

我遇到了这个问题，最终我是用文本编辑器而不是 java 编辑器打开文件。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-06-03T10:19:10.163

**对于那些使用最新的 3-19 eclipse build 的人：**

我只是在从**Oxygen**升级到**3-19** eclipse 版本时发生这种情况，所以我假设在升级过程中自动完成功能没有正确迁移。

对我有用的唯一解决方案是创建一个新的 eclipse 工作区，并将项目导入其中。这可能需要几分钟，但值得 - 与花在其他解决方案上的时间相比......

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2020-05-17T01:38:00.550

在 Java Spring Boot 项目上运行 STS，这对我有用：

[![在此处输入图像描述](https://i.stack.imgur.com/OV89f.jpg)](https://i.stack.imgur.com/OV89f.jpg)

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-11-23T15:56:56.670

对我来说，问题是同一个库的多个版本之间的冲突。Eclipse 辅助使用的是比 maven 更旧的版本。

我不得不去.m2目录并删除不需要的lib版本+重新启动eclipse。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-11-06T16:34:35.203

**编辑不属于项目目录的文件**时，我在 Eclipse Neon 上遇到问题。当我将相同的文件复制到项目根目录时，甚至没有复制到 src 目录，完成开始工作。

当文件从不同的目录打开时，只有 JRE 的补全有效。例如：`java.`完成，但`junit.`没有完成。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2017-12-21T17:09:09.287

以防万一有人到了绝望的地步，没有任何效果......我们碰巧内容辅助以某种方式缩小，所以没有显示任何建议，只是“按Ctrl + Space for non-Java......”可以看到。因此，只需拖动内容辅助的一角即可放大弹出窗口。

我知道，尴尬。希望能帮助到你。

注意：这是一个使用 Eclipse Oxygen 的带有 Xfce4 的 Ubuntu 服务器。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-02-05T00:17:45.480

如果您在枚举中遇到这种情况，或者在使用匿名类初始化数组时，这是 Eclipse 中的一个已知错误。请参阅[Eclipse content assistant not working in enum constant parameter list](https://stackoverflow.com/questions/47481597/eclipse-content-assist-not-working-in-enum-constant-parameter-list)。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-09-06T13:55:42.407

对 2021 年 9 月的我来说，这是一个奇怪的 Eclipse 错误。我的班级的注释中有一个多行字符串。当尝试完成代码时，这会导致该特定类失败（即使该类编译得很好）。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-12-26T05:35:44.400

我们可以根据需要更改设置。

假设我们要将**java 提案**作为最高优先级，我们需要进行如下更改。

`Windows`> `Preferences`> `Java`> `Editor`> `Content Assist`> `Advanced`

选择`Java proposal`并点击`up`按钮

[![在此处输入图像描述](https://i.stack.imgur.com/sDn9x.jpg)](https://i.stack.imgur.com/sDn9x.jpg)

# iphone - 需要 iPhone 地图帮助

> ID：908490
> 
> 赞同：0
> 
> 时间：2009-05-26T00:44:13.037
> 
> 标签：iphone, google-maps

我需要你帮忙。我看到了一个适用于 iphone 的应用程序 myhomes。该应用程序的链接来自 myhomes.com。他们正在使用地图，其中当您单击标记时会显示一个按钮（这对我来说真的是一个问题，当我们单击 webview 中的标记时如何在目标 c 中显示一个按钮，因为我们可能会使用 javascript）。这将重定向到显示该事件详细信息的其他屏幕。我想在我的代码中使用这种功能。他们可能正在使用一些 api。我很想知道他们是如何做到的。现在仪式我正在使用谷歌地图javascript显示地图，并在我们点击标记时显示弹出窗口。但该弹出是不可点击的，因为它是 html 类型。如何在我的 uiview 上放置一个按钮，与我的标记所在的位置相同？如何将目标 c 与 javascript 结合起来？我知道大多数开发人员可能都知道这一点。请尝试帮助我。这将是一个很大的赞赏。

希望寻找答案...非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T09:33:42.187

请参阅 iPhone 3.0 SDK 中包含的 MapKit 组件文档。

# java - 如何使用具有特定 MessgeBodyReaders/Writers 的特定资源实例初始化 Jersey？

> ID：908495
> 
> 赞同：1
> 
> 时间：2009-05-26T00:50:34.960
> 
> 标签：java, spring, jetty, jersey, grizzly

我正在尝试使用预配置的资源实例在预配置的端口/url 上启动 Jersey。我不太清楚如何正确地做到这一点。

这是一段代码。请帮帮我，填空：

```
@Component
@PerRequest
@Path("/svc")
@Consumes({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML})
@Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML})
public class MyService
{
    // This piece is known
}

public class JSONMessageBodyWriter implements MessageBodyWriter<Object>
{
    // This piece is known
}

public class XMLMessageBodyWriter implements MessageBodyWriter<Object>
{
    // This piece is known
}

// This is where I need help
MyService service = new MyService();
...
HttpHandler handler = ???
...
HttpServer server = ???
server.createContext("/services", handler);
...
server.start(); 
```

在上面的代码片段中，我试图通过[http://localhost:8080/services/svc](http://localhost:8080/services/svc) url 公开 MyService。如果将插入 JSONMessageBodyWriter 和 XMLMessageBodyWriter - 该服务将相应地针对 XML 和 JSON 工作。

如果你知道如何在 Jetty 或 Grizzly 上执行此操作，也请告诉我。春天能帮上忙吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-12T02:13:36.590

Jersey 本身提供了一整套[示例](http://download.java.net/maven/2/com/sun/jersey/samples/jersey-samples/1.0.3/jersey-samples-1.0.3-project.zip)，特别是最简单的 helloworld 示例显示了如何在端口上启动服务器以仅运行它或在 JUnits 中进行测试。如果您看一下，您将获得有关如何设置和启动服务器的示例。

现在，在将 MessageBodyReaders 和 MessageBodyWriters 配置为 jersey 应用程序的一部分时，您会发现 JAX-RS 规范本身（由 jersey 实现）涵盖了这一点。首先，您的读者和作者需要 @Provider 注释。此外，读者应该得到@Consumes 注释，而作者应该得到@Produces 注释，因此您可以分别指定它们消费和产生的mime-type。

接下来是激活它们。上面的 helloworld 示例不会显示这一点，因为它不使用自定义读取器或写入器（另一个示例可能，我没有看）。因此，无需提供包来查找资源（就像它们所做的那样；当您看到 helloworld 示例时，您就会知道我所说的内容），您将编写 Application 的子类，在其中指定资源类和读取器/写入器类。对于 reader 和 writer，您可以选择指定一个类（从 getClasses 返回），或者自己提供一个已经创建的实例（从 getSingletons 返回）。

最后，将 Application 子类的名称指定为 init-parameter 的值`"javax.ws.rs.Application"`。当您启动服务器时，可以将 init-params 传递给 GrizzlyWebContainerFactory.create（同样，您将在示例中看到它使用的）。

希望这可以帮助。

# pdf - 是否有一个好的 ActiveX/COM 组件可以“打印”到 PDF？

> ID：908500
> 
> 赞同：2
> 
> 时间：2009-05-26T00:54:34.670
> 
> 标签：pdf, pdf-generation

在这里抓着稻草，我想我记得在某处看到过解决方案，但现在找不到。

问题是我需要一个 Windows 应用程序（不是 .Net）才能生成 PDF。“标准”解决方案是使用[PDF995](http://www.pdf995.com)或[CutePDF](http://www.cutepdf.com/)之类的东西，它们创建一个虚拟打印机，然后您的应用程序可以打印到该打印机并将其重定向到 PDF 文件。问题是控制这些打印机需要更新 INI 文件或注册表项，这很容易出错并且经常遇到并发问题。

以编程方式构建 PDF 文件不是一种选择，它需要能够获取通常发送到打印机的输出，或者可能直接从 Excel 文件转换。

理想情况下，我只需将 Excel 文件传递​​给 COM/ActiveX 对象，它就会写入我指定的文件。下一个最佳选择是它为每个打印作业创建一个单独的打印机，或者有一些合理的方法来保证我提供的文件名将包含我打印的文档。

这个[Excel 到 PDF 批处理转换器](http://www.a-pdf.com/excel-to-pdf/)可能会起到作用，因为它至少具有命令行模式，有人试过吗？它只会解决 Excel 文件的问题。

那么，有没有更好的解决方案？

（附带说明，对于 Visual FoxPro 报告，[XFRX](http://www.eqeus.com/frx2wrd.php)工作得非常好，它将报告直接转换为 PDF，而不需要打印机驱动程序。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T18:10:06.177

你可能想看看 BullZip（谷歌它，因为我还不能添加超链接）。我们最近让 Jody Meyer 在底特律地区福克斯用户组展示了这个工具（之前也在大急流城地区福克斯用户组展示过）。这是一次很棒的会议。

她展示了如何使用 COM 对象自动执行大量 BullZip 功能，包括文件名以及作者和关键字等属性。水印也很简单。它简单明了，她的例子坚如磐石。已经为您完成了大量功能，因此您可以简单地重新设计演示表单。

您可以在 DAFUG 网站的下载文件夹中下载它。文件名是 BullZipDemo.zip（google Detroit Area Fox User Group）并添加文件夹和文件名。

瑞克 VFP MVP

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-09T02:55:49.883

对于这种情况，我会推荐[Amyuni PDF Converter](http://www.amyuni.com/en/developer/pdfconverter/whatsnew)。它提供了一个微软认证的 PDF 打印机和 ActiveX/.Net 控件来与之通信。使用这些控件可以避免并发问题。 *免责声明：我是该产品开发团队的一员。*

# silverlight - 使用 Silverlight 2 进行短音频缓存

> ID：908505
> 
> 赞同：1
> 
> 时间：2009-05-26T00:58:20.107
> 
> 标签：silverlight, audio, silverlight-2.0

我正在尝试在 Silverlight 2 中创建的游戏中使用大量短声音样本。这些样本的长度不到 2 秒。

我希望在初始化期间将所有音频样本加载到画布上。我一直在将媒体元素添加到画布和一个通用列表来管理它。到目前为止，它似乎有效。

当我第一次播放样本时，它播放得很完美。如果它已经完成播放并且我想重新使用相同的元素，它会切断声音的第一部分。为了再次播放样本，我停下来播放媒体元素。

是否有另一种方法我应该使用样本以使音频不被剪辑并获得良好的性能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-14T17:30:52.640

一些评论：

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.controls.mediaelement(VS.95).aspx)：尝试一次限制您在应用程序中拥有的 MediaElement 对象的数量。如果您的应用程序树中有超过一百个 MediaElement 对象，无论它们是否同时播放，都可能引发 MediaFailed 事件。解决此问题的方法是在需要时将 MediaElement 对象添加到树中，并在不需要时将其删除。

您可以尝试寻找示例的开头以重置当前正在播放的点，然后再重新使用它：

```
mediaelement.Position = new TimeSpan(); 
```

另请参阅[MSDN MediaElement.Position](http://msdn.microsoft.com/en-us/library/system.windows.controls.mediaelement.position(VS.95).aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T17:05:36.277

此外，确保所有音频样本最初都被带到客户端可能是个好主意。根据您的设置方式，MediaElements 可能正在使用其渐进式下载功能从服务器获取媒体文件。虽然这本身没有问题（浏览器缓存应该在初始下载后帮助您），但这确实意味着您必须处理浏览器缓存，并且存在一些潜在问题。

尝试的可能步骤：

1.  将您的音频文件标记为“内容”。这将使它们在 .xap 中聚集起来。
2.  将您的音频文件加载到 MemoryStreams（请参阅 Application.GetResourceStream 方法）并调用 MediaElement.SetSource()。

HTH，埃里克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T02:52:03.640

尽管我不确定它在 Silverlight 中的效果如何，但您可以使用的一种技术是创建一个大文件，将所有样本连接在一起（每个样本之间可能有半秒左右的沉默）。找出每个样本的时间码，然后将媒体元素搜索到该位置并播放。您只需要与要播放的同步声音一样多的媒体元素。

# asp.net - 是否有支持请求参数连接的 URL 构建器？

> ID：908507
> 
> 赞同：8
> 
> 时间：2009-05-26T00:59:58.233
> 
> 标签：asp.net, parameters, httpwebrequest, request, webrequest

我想实现以下目标：

```
UrlBuilder ub = new UrlBuilder("http://www.google.com/search");
ub.Parameters.Add("q","request");
ub.Parameters.Add("sourceid","ie8");

string uri = ub.ToString(); //http://www.google.com/search?q=request&sourceid=ie8 
```

.NET 中是否有任何内容，或者我必须自己创建？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-26T01:22:37.657

我所知道的不存在。这是一些简单的事情，可以满足您的需求。用法是：

```
 UrlBuilder ub = new UrlBuilder("www.google.com/search")
        .AddQuery("q", "request")
        .AddQuery("sourceid", "ie8");

        string url=ub.ToString(); 
```

==

代码是：

```
 public class UrlBuilder
    {
        private string _authority;
        private string _host;
        private int? _port;
        private Dictionary<string, object> _query = new Dictionary<string, object>();

        public UrlBuilder(string host)
            : this("http", host, null)
        {

        }
        public UrlBuilder(string authority, string host)
            : this(authority, host, null)
        {
        }
        public UrlBuilder(string authority, string host, int? port)
        {
            this._authority = authority;
            this._host = host;
            this._port = port;
        }

        public UrlBuilder AddQuery(string key, object value)
        {
            this._query.Add(key, value);
            return this;
        }

        public override string ToString()
        {
            string url = _authority + "://" + _host;
            if (_port.HasValue)
            {
                url += ":" + _port.ToString();
            }

            return AppendQuery(url);
        }

        private string AppendQuery(string url)
        {
            if (_query.Count == 0)
            {
                return url;
            }

            url += "?";
            bool isNotFirst = false;
            foreach (var key in this._query.Keys)
            {
                if (isNotFirst)
                {
                    url += "&";
                }
                url += HttpUtility.UrlEncode(key) + "=" + HttpUtility.UrlEncode(this._query[key].ToString());
                isNotFirst = true;
            }

            return url;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T01:05:51.840

UriBuilder类[有](http://msdn.microsoft.com/en-us/library/system.uribuilder.query.aspx)帮助吗？

它没有任何添加查询字符串参数的方法。查看 Query 属性以设置值。

编辑：见[UriTemplate](http://msdn.microsoft.com/en-us/library/system.uritemplate.aspx)类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T06:39:25.360

我开发了自己的，更适合我的需求，感谢您的代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Collections.Specialized;

namespace Utils
{
    public class ParameterCollectionBuilder : NameValueCollection
    {
        #region NameValueCollection Implementation
        public ParameterCollectionBuilder() : base() { }
        public ParameterCollectionBuilder(string uri)
        {
            Init(uri);
        }
        public ParameterCollectionBuilder(Uri uri) : this(uri.OriginalString) { }
        public ParameterCollectionBuilder(NameValueCollection baseCollection)
        {
            foreach (string key in baseCollection.Keys) this[key] = baseCollection[key];
            Init(ToString());
        }
        /// <summary>
        /// 
        /// </summary>
        /// <param name="baseCollection"></param>
        /// <param name="uri"></param>
        /// <remarks>Note: any existing params in the uri will override the params in the collection.</remarks>
        public ParameterCollectionBuilder(NameValueCollection baseCollection, string uri)
        {
            foreach (string key in baseCollection.Keys) this[key] = baseCollection[key];
            Init(uri);
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="baseCollection"></param>
        /// <param name="uri"></param>
        /// <remarks>Note: any existing params in the uri will override the params in the collection.</remarks>
        public ParameterCollectionBuilder(NameValueCollection baseCollection, Uri uri) : this(baseCollection, uri.OriginalString) { }

        public override string ToString()
        {
            return Prefix + Query + Suffix;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="name"></param>
        /// <param name="value"></param>
        /// <remarks>Overides existing values.</remarks>
        public new void Add(string name, object value)
        {
            Set(name, GetString(value));
        }

        /// <summary>
        /// Add an array of key-value pairs separated by colon char ':'.
        /// </summary>
        /// <param name="names">Invalid items will be ignored.</param>
        public void AddRange(string[] names)
        {
            rangeFlag = true;
            for (int i = 0; i < names.Length; i++)
            {
                string item = names[i];
                item = item.Replace("?", "");
                item = item.Replace("&", "");
                item = item.Replace("=", ":");
                string[] pair = item.Split(':');
                if (pair.Length == 2) Set(pair[0], pair[1]);                
            }
            InitUri(FullString);
            rangeFlag = false;
        }

        public void AppendQueryString(string query)
        {
            Add(BuildCollection(query));
        }

        public void RemoveRange(string[] keys)
        {
            rangeFlag = true;
            foreach (string key in keys)
            {
                Remove(key);  
            } 
            InitUri(FullString);
            rangeFlag = false;
        }

        bool rangeFlag = false;
        public new void Set(string name, object value)
        {
            base.Set(name, GetString(value));
            if (!rangeFlag && Uri != null) InitUri(FullString);
        }

        public override void Remove(string name)
        {
            base.Remove(name);
            if (!rangeFlag && Uri != null) InitUri(FullString);
        }

        public override void Clear()
        {
            base.Clear();
            if (Uri != null) InitUri(FullString);
        }

        #endregion NameValueCollection Implementation

        static string ParseQuery(string uri)
        {
            string query = "";

            if (!uri.Contains('=')) return query;

            int
                start = 0,
                end = uri.Length;

            if (uri.Contains('?')) start = uri.IndexOf('?');
            if (uri.Contains(':')) end = uri.LastIndexOf(':');

            query = uri.Substring(start, (start < end ? end : uri.Length) - start);
            return query;
        }

        void Init(string uri)
        {
            if (Uri == null)
            {
                InitUri(uri);
            }
            OriginalQuery = ParseQuery(uri);
            int qIndex = string.IsNullOrEmpty(OriginalQuery) ? uri.Length : uri.IndexOf(OriginalQuery);
            Prefix = uri.Substring(0, qIndex);
            Suffix = uri.Substring(qIndex + OriginalQuery.Length);
            Merge(OriginalQuery);
        }

        void Merge(string query)
        {
            NameValueCollection col = BuildCollection(query);
            foreach (string key in col.Keys)
            {
                string value = col[key];
                if (!string.IsNullOrEmpty(value)) this[key] = value;
            }
        }
        void InitUri(string uri)
        {
            try
            {
                Uri = new Uri(uri);
            }
            catch { }
        }

        static string GetString(object value)
        {
            return value is string ? value as string : value.ToString();
        }

        static NameValueCollection BuildCollection(string query)
        {
            NameValueCollection collection = new NameValueCollection();
            if (string.IsNullOrEmpty(query) || !query.Contains('=')) return new NameValueCollection();

            //Prepare string
            query = query.ToLower();
            if (!query.StartsWith("?"))
            {
                if (query.Contains('?')) query = query.Substring(query.IndexOf('?'));
            }
            query = query.Replace("?", "");

            foreach (string pair in query.Split('&'))
            {
                string[] separated = pair.Split('=');
                if (separated.Length == 2) collection[separated[0]] = separated[1];
            }

            return collection;
        }

        static string BuildQuery(NameValueCollection parameters)
        {
            string query = "";
            Char separator = '?';
            bool first = true;
            foreach (string key in parameters.Keys)
            {
                query += string.Format("{0}{1}={2}", separator, key, parameters[key]);
                if (first)
                {
                    first = false;
                    separator = '&';
                }
            }
            return query;
        }

        #region Properties
        public Uri Uri { get; private set; }

        public string Prefix { get; private set; }
        public string OriginalQuery { get; private set; }
        public string Suffix { get; private set; }
        public string OriginalString
        {
            get
            {
                return Prefix + OriginalQuery + Suffix;
            }
        }
        public string Query
        {
            get
            {
                return BuildQuery(this);
            }
        }
        public string FullString
        {
            get
            {
                return ToString();
            }
        }
        #endregion Properties
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-04T09:50:19.720

我建议你看看[这篇](http://www.codeproject.com/KB/aspnet/UrlBuilder.aspx)关于 CodeProject 的文章。

作者扩展了[System.UriBuilder](http://msdn.microsoft.com/en-us/library/system.uribuilder.aspx)类并添加了一个 QueryString 属性，其行为方式与[HttpRequest.QueryString](http://msdn.microsoft.com/en-us/library/system.web.httprequest.querystring.aspx)属性非常相似。

使用此类，您的示例将变为：

```
UrlBuilder ub = new UrlBuilder("http://www.google.com/search");
ub.QueryString.Add("q", "request");
ub.QueryString.Add("sourceid", "ie8");
string uri = ub.ToString(); //http://www.google.com/search?q=request&sourceid=ie8 
```

它没有像[Josh 的解决方案那样](https://stackoverflow.com/questions/908507/is-there-a-url-builder-that-supports-request-paramater-concatenation-as-well/908552#908552)[流畅的界面](http://en.wikipedia.org/wiki/Fluent_interface)，但可以轻松扩展以包含一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-21T16:49:25.940

使用[Flurl](http://tmenier.github.io/Flurl) [披露：我是作者]，您的示例将如下所示：

```
string uri = "http://www.google.com/search"
  .SetQueryParams(new { q = "request", sourceid = "ie8" }); 
```

基本 URL 构建器可通过 NuGet 获得：

`PM> Install-Package Flurl`

还有一个新的配套库，它使用[流畅](http://tmenier.github.io/Flurl/fluent-http)、[可测试的](http://tmenier.github.io/Flurl/testable-http)HTTP 扩展 Flurl：

`PM> Install-Package Flurl.Http`

# html - 如何在一个超链接中获得两种颜色？

> ID：908509
> 
> 赞同：2
> 
> 时间：2009-05-26T01:00:58.073
> 
> 标签：html, colors, hyperlink

我的网站中有一个超链接，我想成为`#A0A0A0`and 的一部分`#880000`，`a:link`并且`a:visited`我希望它变成 and 的一部分和`#FFFFFF`一部分`#AA0000`。但我希望它是一个链接。到目前为止，我已经尝试了两种解决方案，但都没有达到我想要的方式。`a:hover``a:active`

第一个是：

```
a.menu:link { color: #a0a0a0; text-decoration: none; }

a.menu:visited { color: #a0a0a0; text-decoration: none; }

a.menu:hover { color: #ffffff; text-decoration: none; }

a.menu:active { color: #ffffff; text-decoration: none; }

<a class="menu" href="/about.html">Dubious
    <span style="color: #880000;">Array</span>
.net</a> 
```

在此解决方案中，中间部分 ('Array') 的颜色始终保持不变，`#880000`不会变为`#AA0000`for`:hover`或`:active`。

第二种解决方案是为`<a> </a>`字符串的每个部分创建一个（因此一个用于“Dubious”，一个用于“Array”，一个用于“.net”）并让中间的`<a> </a>`css

```
a.redMenu:link { color: #880000; text-decoration: none; }

a.redMenu:visited { color: #880000; text-decoration: none; }

a.redMenu:hover { color: #AA0000; text-decoration: none; }

a.redMenu:active { color: #AA0000; text-decoration: none; } 
```

这样颜色效果很好；但是字符串是三个独立的链接，因此将鼠标悬停在一个链接上不会改变其他链接的颜色。

所以我想要做的是将超链接中间的css从更改`a.menu`为`a.redMenu`然后再更改为`a.menu`，但我不知道如何。这里有人可以解决我的问题吗？

谢谢，雅各布

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T01:34:58.333

您可以使用原始 HTML，只需删除内联样式：

```
<a class="menu" href="/about.html">
 Dubious<span>Array</span>.net
</a> 
```

然后只需为 span 添加这些 css 声明：

```
a.menu:link span, a.menu:visited span{color: #880000;}
a.menu:hover span, a.menu:active span {color: #aa0000;} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T01:04:22.983

```
a.redMenu:hover span { color: #AA0000; text-decoration: none; } 
```

这告诉**跨度**当它的父链接悬停时是什么颜色。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T01:08:08.230

```
<html>
<head>

<style type="text/css">

p { background: #00c }
a.menu:link    { color: #a0a0a0; text-decoration: none; }
a.menu:visited { color: #a0a0a0; text-decoration: none; }
a.menu:active  { color: #ffffff; text-decoration: none; }
a.menu:hover span.normal { color: #800 }
a.menu:hover span.hilite { color: #880 }

</style>

</head>

<body>

    <p><a class="menu" href="/about.html"><span class="normal">Dubious
        <span class="hilite">Array</span> .net</span></a>
    </p>

</body>
</html> 
```

# javascript - 管理大量代码的技巧？

> ID：908510
> 
> 赞同：3
> 
> 时间：2009-05-26T01:02:19.053
> 
> 标签：javascript

我的项目似乎越来越大，我的一些课程长达数千行。每次我想进行更改时都很难搜索它们。

我发现 JavaScript 不像其他一些编程语言那样容易布局清晰。因此，当课程达到几千行时，我很难阅读它。

我试过把它分成多个文件，但是你把类分开了，这似乎不对。例如，如果一个类中的每个方法都使用一个全局变量，那么您将只能在该类的一个文件中找到该全局变量。

另外，如果我想使用来自 100 个不同 .js 文件的 JavaScript 代码，我最终会得到类似这样的东西......

```
<script type="text/javascript" src="Scripts/classes/Node.js"></script>
<script type="text/javascript" src="Scripts/classes/Queue.js"></script>
<script type="text/javascript" src="Scripts/classes/DblyLinkedList.js"></script>
  .... 97 more lines like this 
```

虽然，我想可能有一些我可以做的事情......

```
<script type="text/javascript" src="Scripts/.../*.js"></script> 
```

或类似的东西……对吗？

当代码达到极限时，有人有任何关于管理代码的技巧吗？

清理 JavaScript 代码的技巧也会有所帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T01:10:24.390

将 JS 分解成单独的文件有一些主要的缺点，主要是你迫使 Web 浏览器对每个文件发出单独的请求。

您是否考虑过将所有文件分开，但为每个项目制作一个仅包含必要文件的单个文件“捆绑包”？这可以通过脚本自动化。

这篇 SitePoint 文章可能会帮助您入门：[http ://www.sitepoint.com/blogs/2007/04/10/faster-page-loads-bundle-your-css-and-javascript/](http://www.sitepoint.com/blogs/2007/04/10/faster-page-loads-bundle-your-css-and-javascript/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T01:10:57.400

*   (a) 让你的课程更短[即使这意味着更多的文件]，
*   (b) 保持它们“全文索引”以提高搜索和操作的速度（不知道有任何 IDE 专门支持这种方式的 Javascript，但像 Emacs、Vim、Eclipse 或 TextMate 这样的强大编辑器肯定会这样做），
*   (c) 将它们按层次分组，这样您的页面就可以只有几个 `<script>`标签用于“上层”脚本，每个标签都只包含几个“下层”脚本。

哦，*当然*，虔诚地把一切都放在一个好的变更控制系统（SVN、Mercurial 等）之下，否则你的生活肯定会非常非常悲惨：-(。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T01:13:51.980

您可能希望将相关的类组合到包中，其中每个包都是一个文件。查看[YSlow](http://developer.yahoo.com/yslow/)以了解有关性能的最佳实践。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T01:08:37.903

好吧，一个好的编辑器总是有用的，因为它会为您提供文件中定义的所有功能的快捷方式。

其次，确保你不是在看一堵代码墙。缩进、空格和换行是很好的帮助。

对缩进非常严格。2个空格是2个空格，总是（或你使用的任何数量）

如果你把你的 { 放在一个声明下，那么总是把它放在那里，无一例外）

关于您希望文本如何对齐的明确规则将有很大帮助。

而且我不知道最后一件事......我不确定浏览器是否可以使用这种通配符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T01:08:41.023

```
<script type="text/javascript" src="Scripts/.../*.js"></script> 
```

将不起作用，此外，在拆分依赖文件时会遇到一个有趣的问题，因为您不能保证它们都会按照您预期的顺序下载。

不幸的是，最好的选择确实是一个很好的 IDE，它可以生成一个易于导航的大纲。我将 Eclipse 与 Spket 和/或 Aptana 一起使用，但是您正在寻找更容易管理的东西。

编辑：关于将 js 拆分为多个文件的另一个快速说明。尽可能避免它。每个单独的文件意味着一个单独的 http 请求。减少所需的请求数量可以对站点性能产生巨大影响。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T01:14:21.933

AvatarKava 的建议是合理的。在单独的文件中工作并在构建时将它们连接起来。但是，我还建议您查看您的班级结构。“数千行”的课程听起来不太健康。你确定你的班级没有承担太多的责任吗？有没有可以运送到其他单一职责类的任务？这将有助于提高代码的清晰度，而不是巧妙地拆分文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T01:18:45.527

同样的建议适用于大多数语言......

尽可能避免使用全局变量。您通常可以通过包装静态变量或使用对象来获得所需的行为。

```
if (foo == undefined)
   var foo 
```

尽可能使用命名约定，这样您就可以通过读取变量或函数名称来跟踪事情。要么使用 grep，要么使用 intellisense 获得 IDE。

将事物拆分为目录。在名为“classes”的目录中包含 100 个文件是没有帮助的。例如，您可能有一个用于队列、列表、树等的集合目录。如果您有很多，您甚至可能有一个树子目录或列表子目录等。然后您还可以为该目录...只是一个名为 collections.js 的文件，其中包含该目录中的所有文件。当然，您必须小心拆分，因为您不想包含您永远不会使用的文件。

# ruby-on-rails - 你应该只在局部变量中使用局部变量吗？

> ID：908512
> 
> 赞同：7
> 
> 时间：2009-05-26T01:03:06.057
> 
> 标签：ruby-on-rails, partial, instance-variables, local-variables

使用局部变量似乎是可取的，可以在应用程序范围内使用以避免跨应用程序的依赖关系。

但是在单个控制器中，引用实例变量似乎是可以接受的，您知道这些实例变量将在所有使用部分的操作中可用。

但是，如果您这样做，似乎存在风险，即特定操作可能会更改为不再向其视图提供实例变量。然后部分将停止工作。不过，我不确定这是否真的是一个问题，因为常规视图会遇到同样的风险。

如果您在部分中引用实例变量，这有关系吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T01:07:42.553

你今天大放异彩！:-)

您可以将变量传递给部分，`:locals`以保持这一切都很好和干净。例如，

```
render :partial => 'my_partial', :locals => { :some_variable => some_variable, :some_important_value => 'an important point!' } 
```

然后这些变量在局部视图中可用：

```
<%= some_variable %>
<%= some_important_value %> 
```

但是，在局部变量中使用实例变量并没有什么特别的错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T19:15:09.347

我只建议使用实例变量，只要不共享部分，因为这会很快让人困惑；）

# .net - .Net 使用 nant 进行调试构建的依赖注入

> ID：908517
> 
> 赞同：1
> 
> 时间：2009-05-26T01:05:43.353
> 
> 标签：.net, vb.net, dependency-injection, nant

我有一个使用 vb.net 2.0 和 nant 构建的相对较小的应用程序。它是一个调用外部 exe 以生成一些输出文件的应用程序，然后处理这些输出文件。

我已经为 exe 构建了一个接口，我已经创建了一个存根实现和真正的实现，我想做的是使用 nant 创建一个调用存根实现的应用程序的 DEBUG 构建，或者创建将使用正确实现的应用程序的 PROD 构建。

我怎么能做到这一点？

另外，我没有能力更新到较新版本的 .net，只是让您知道 :)

谢谢！标记

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T01:51:03.667

你有没有想过使用#if DEBUG 预处理指令？您可以执行以下操作：

```
object myDependency;
#if DEBUG
myDependency = new Stub();
#else
myDependency = new Actual();
#endif 
```

只是一个想法，但如果它是一个相对较小的应用程序，它是一个不错的、简单的解决方案，不需要很多麻烦。构建调试配置文件时，会自动设置调试编译器选项。构建发布配置文件时，调试编译器选项不存在。除了简单的应用程序之外，我会说使用 IoC 框架......比如 Ninject。它漂亮而简单，轻量级......应该适用于较小的应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T09:14:37.153

那里有很多 DI 框架，而且还会有更多。然而，它们（我所知道的）都不是“构建工具”。如果你需要一些快速的东西，比如 Funq(1) 会很好，或者 ProS(2) 完成后

您可能想阅读 Daniel Cazzulino 在 Funq(3) 上的文章，他在其中对几个 DI 进行了基准测试

我会在上面链接，但还不允许

# ruby-on-rails - Rails 仪表板设计：每个 div 一个控制器动作

> ID：908520
> 
> 赞同：12
> 
> 时间：2009-05-26T01:05:53.930
> 
> 标签：ruby-on-rails, ruby, model-view-controller, dashboard

我正在实现一个仪表板作为一个相对的 Rails 新手（更多的是一个基础设施的人）。仪表板将由多个页面组成，每个页面将包含多个图表/表格/等。对于模块化，我希望添加新图表或更改数据视图尽可能简单。

假设一页有 5 个不同的图表。我可以让控制器进行 5 次单独的数据查找，将所有相关数据保存在实例变量中，并渲染 5 个部分，每个部分都触及数据的子集。但似乎更模块化的是有一个“索引”控制器动作，它的渲染有一堆 div，并且对于每个 div，都有另一个控制器动作来进行数据查找并有一个关联的视图部分负责管理该数据的视图在 div 内。

因此，如果我要显示具有两个图表的网站仪表板页面，`website/index`将使用`website/graph1`和`website/graph2`查找每个图表的数据，然后`_graph1.html.erb`使用`_graph2.html.erb`控制器数据来填写 div`"graph1"`和`"graph2"`等。

这是正确的设计吗？如果是，最简单的方法是什么？我有一个使用`remote_function`with`:action => "graph1"`来填写 div 的近似值，但我对它并不是 100% 满意。我怀疑我错过了 Rails 为我做的更简单的事情。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-26T19:31:46.223

## 版本 1：

我在生产中实际使用的简单方法：iframe。

大多数情况下，您实际上并不关心页面是否一次全部呈现并直接从服务器呈现，实际上交错加载会更好。

如果您只是将 iframe src'd 放到控制器的显示操作中，那么您就有一个非常简单的解决方案，不需要直接的跨控制器交互。

临：

*   容易死
*   适用于现有的表演动作等
*   甚至可能更快，这取决于并行与顺序请求和内存负载等的节省

缺点：

*   您不能总是轻松地将页面与任何内容一起保存
*   iframe 将脱离主机页面的 javascript 命名空间，因此如果它们需要，您可能需要为它们提供自己的简约布局；他们也无法影响其 iframe 之外的周围页面
*   可能会更慢，具体取决于 ping 时间等
*   如果页面上有许多这样的模块，则潜在的 n+1 效率错误

## 版本 2：

使用 JS 调用执行相同的操作，将 div 替换为部分内容，à la：

```
<div id="placeholder">
<%= update_page {|page| page['placeholder'].replace with some partial call here } %> 
```

同上，除了：

临：

*   不会将其锁定到 iframe 中，因此共享 JS 上下文等
*   允许更好地处理故障情况

缺点：

*   需要 JS 和占位符 div；稍微复杂一点

## 版本 3：

调用一大堆部分。但是，一旦您谈论诸如仪表板之类的事情，其中​​各个模块具有大量设置逻辑，这样做就会变得复杂。

有多种方法可以通过将这些东西变成“mixins”或类似的东西来解决这个问题，但 IMO 他们有点笨拙。

ETA：通过 mixins 实现它的方法是创建本质上是一个库文件，它实现了模块控制器的设置功能，包括在任何使用调用 'em 的东西的地方，并调用 'em。

但是，这有缺点：

*   您必须知道哪些顶级控制器操作将导致包含这些模块的页面（如果这些确实是可能出现的小部件，例如依赖于用户偏好，那么您可能不容易）
*   它并不能真正充当成熟的控制器
*   它仍然混合了很多逻辑，你持有的东西需要知道它持有的东西
*   你不能轻易地将它隔离到它自己的控制器中，因为它需要在一个库类型的文件/mixin 中

可以从另一个控制器调用一个控制器中的方法。然而，这是一个主要的痛苦，也是一个主要的kludge。您唯一应该考虑这样做的情况是：a）它们都是独立必需的控制器，并且b）它必须完全在后端运行。

我不得不这样做一次 - 主要是因为重构它的原因更加痛苦 - 我保证你不想去那里，除非你必须这样做。

## 概括

最好的方法恕我直言，如果你有足够复杂的东西需要大量设置 - 一个简单的 iframe 显示模块，传递一个参数告诉它使用极简布局（只是 CSS + JS 标题），因为它没有被显示作为自己的页面。

这使您可以保持事物完全独立，或多或少地像它们自己的完全正常的控制器一样运行（除了布局设置），保留正常的路线等。

如果您不需要大量设置，则只需使用部分，并将所需的任何内容作为局部变量传递。但是，如果您遇到诸如 n+1 效率错误之类的问题，这将开始变得脆弱……

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-11-13T17:51:19.333

你为什么不试试 Apotomo，这是 Rails 的有状态小部件：

[一个教程如何构建一个简单的仪表板](https://github.com/apotonick/dashboard_tutorial)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T16:36:44.377

您可以通过使用来实现这一点

渲染输出=渲染：动作=>“graph2”

但我个人可能会将代码包装在共享帮助程序中，或者在 lib 目录下编写您自己的“lib”，以便通过共享模板重用代码。请记住，除非您更改您的 route.rb 文件，否则定义的任何公共方法都可以通过

/控制器/动作/：id

还要记住关闭函数的布局 :layout => nil （或在控制器布局“graph”的顶部指定， :except => ["graph2"]

干杯

基督教

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T13:11:12.263

如果不按照您概述的方式使用 AJAX，我不知道有任何特殊的 Rails 技巧可以实现这一目标。

获得您寻求的模块化的最简单方法是将控制器代码的这些部分放入单独的方法中（例如`set_up_graph1_data`，`set_up_graph2_data`等），您只需从您的`index`操作中调用这些方法来设置视图的变量。

`ApplicationController`如果您希望它们可用于多个控制器，您可以将这些方法放入其中。

顺便说一句，Rails 早期*确实*有一个称为“组件”的功能，它可以让你完全按照你的要求做，而不必使用 AJAX。从您的角度来看，您可以只渲染另一个控制器操作，内联。但是，出于性能和设计理念的原因，此功能已被删除。

# visual-studio - 在 XOML 文件上使用查看代码时，将显示设计器视图

> ID：908529
> 
> 赞同：1
> 
> 时间：2009-05-26T01:08:59.150
> 
> 标签：visual-studio, designer, designview, code-view

在 Visual Studio 中：当您在解决方案资源管理器中右键单击 xml 文件并选择“查看代码”时，它会将您带到设计器（设计视图）。

**重现步骤**

*   创建一个xml
*   在代码隐藏中添加一些东西[我使用 C#]
*   关闭代码隐藏和设计器
*   右键单击解决方案资源管理器中的 xml
*   选择“查看代码”

**实际结果**

*   打开设计器视图。

**预期成绩**

*   代码视图应该打开。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T01:15:18.013

我在其他地方发现了这个问题，没有答案，所以这是我发现的解决方案/解决方法。

*   在解决方案资源管理器中右键单击 xml 文件。
*   选择“打开方式...”
*   选择“Xml 编辑器”
*   点击“设为默认值”
*   点击“确定”

您现在应该能够查看代码。

注意：
默认开启器的不同设置具有奇怪的（愚蠢的？）不同的行为。在我的带有 .NET 3.5 SP1 的 VS2008 上：
**工作流设计器：**只允许设计器视图。
**XML 编辑器：**只允许查看代码。
**源代码（文本）编辑器：**默认为设计器视图，但允许代码视图。

# php - 从 Delphi 运行外部 php 脚本

> ID：908535
> 
> 赞同：0
> 
> 时间：2009-05-26T01:12:31.607
> 
> 标签：php, delphi, post, winsock

好的 - 这是我之前关于[使用 php 脚本发送电子邮件的](https://stackoverflow.com/questions/874965/sending-email-in-delphi-without-smtp-and-using-php-function-at-server)问题的延续。我现在使用[PEAR](http://pear.php.net/package/Mail)发送邮件。我使用的php脚本如下（单独执行成功）：**PHPEMail.php**

```
<?php
require_once "Mail.php"; // Pear Mail.php 

$from = "FromName <FromName@SomeAddress.com>";
$to = $_POST["destination"]; // destination  
$subject = "Hello You!";
$body = $_POST["nicebody"]; // body of text sent 
$host = "ValidServerName";
$username = "User";         // validation at server    
$password = "Password";     // validation at server 

$headers = array ('From' => $from,
  'To' => $to,
  'Subject' => $subject);
$smtp = Mail::factory('smtp',
  array ('host' => $host,
    'auth' => true,
    'username' => $username,
    'password' => $password));

$mail = $smtp->send($to, $headers, $body);

if (PEAR::isError($mail)) {
  echo("<p>" . $mail->getMessage() . "</p>");
 } else {
  echo("<p>Message successfully sent!</p>");
 }
?> 
```

我现在需要从 Delphi 执行这个脚本 (PHPEMail.php)，传递一些变量，使用 winsock。我要使用这段代码 - 到目前为止还没有成功：

```
Procedure SendEmail;
var
  WSADat:WSAData;
  SomeText:TextFile;
  Client:TSocket;
  Info,TheData,Lina,Nicebody:String;
  SockAddrIn:SockAddr_In;
begin
  try
    if not FileExists(Log) then exit;     
    AssignFile(SomeText, Log);             // try to open log, assigned to SomeText
    Reset(SomeText);                       // Reopen SomeText for reading
    while not Eof(SomeText) do
    begin
      ReadLn(SomeText, Lina);             //read each line of SomeTextans place it in linha
      nicebody:=Nicebody+#13#10+Lina;     // nicebody = all line red from SomeText
    end;
    CloseFile(SomeText);                  // SomeText is closed
    DeleteFile(PChar(Log));               // log is deleted
//
    WSAStartUp(257,WSADat);
    Client:=Socket(AF_INET,SOCK_STREAM,IPPROTO_IP);
    SockAddrIn.sin_family:=AF_INET;
    SockAddrIn.sin_port:=htons(80);
    SockAddrIn.sin_addr.S_addr:=inet_addr('66.66.66.66'); // server IP
    if Connect(Client,SockAddrIn,SizeOf(SockAddrIn))=0 then begin
      Info:='destination='+EmailDestAddressFromIni + '' +'Nicebody='+Nicebody;
      TheData:='POST PHPEMail.php HTTP/1.0'                   +#13#10+
             'Connection: close'                              +#13#10+
             'Content-Type: application/x-www-form-urlencoded'+#13#10+
             'Content-Length: '+IntToStr(Length(Info))       +#13#10+
             'Host: someEmailHostAddress'                         +#13#10+
             'Accept: text/html'                              +#13#10+#13#10+
              Info                                            +#13#10;
      Send(Client,Pointer(TheData)^,Length(TheData),0);
      end;
    CloseSocket(Client);
  except
    exit;
  end;
end;

[... more code not related] 
```

我很确定故障出在发送到 Web 服务器的“TheData”中。PHP脚本只是没有被触发。有人知道出了什么问题吗？

（注意：我想用winsock，我不想要第三方组件。完整的代码，它是一个服务器，重约12ko，注定要嵌入一些硬件中）。

**见最后的代码。**

* * *

因为我在服务器日志上看不到 POST，所以我对我的代码做了一些改进（加上一些错误消息）。现在服务器的日志显示发送的数据包的一些跟踪......也就是说，通常的 id 和时间加上字母“P”......可能是单词 'POST' 的第一个字母（发送的数据）。因此，我必须调查“Send()”命令。（我在德尔福 2009 年）。我没有从 winsock 或发送命令中得到任何错误。

```
Procedure SendEmail;

const
  a = #13#10;

var
  WSAData:TWSAData;
  Texto:TextFile;
  ClientSocket :TSocket;
  Info,Data,Lina,Contenu:String;
  host:SockAddr_In;
  i_result:Integer;

begin
  try
    if not FileExists(Log) then exit;     
    AssignFile(Texto, Log);      
    Reset(Texto);  // Reopen texto for reading
    while not Eof(Texto) do
    begin
      ReadLn(Texto, Lina); //read each line of texto and place it in lina
      Contenu:=Contenu+#13#10+Lina;  // contenu is all lines of texto
    end;
    CloseFile(Texto); // close texto
    DeleteFile(PChar(Log)); // delete log

    // Initialize Winsock
    i_result := WSAStartUp(257,WSAData);
    if (i_Result <> NO_ERROR) then
    begin
     MessageBox(0,'Initialization of winsock failed.','Error',MB_OK Or MB_ICONERROR);
     Exit;
    end;

    // Create a SOCKET for connecting to server
    ClientSocket := Socket(AF_INET,SOCK_STREAM,IPPROTO_IP);
    If ClientSocket = INVALID_SOCKET Then
    begin
     MessageBox(0,'ServerSocket creation failed.','Error',MB_OK Or MB_ICONERROR);
     WSACleanUp;
     Exit;
    end;

    // The sockaddr_in structure specifies the address family,
    // IP address, and port of the server to be connected to.
    host.sin_family:=AF_INET;
    host.sin_port:=htons(80);
    host.sin_addr.S_addr:=inet_addr('77.66.66.66');

    // Connect to server.
    i_result:= Connect(ClientSocket,host,SizeOf(host));
    if i_result = SOCKET_ERROR then
    begin
     MessageBox(0,'Failed to connect to remote computer.','Error',MB_OK Or MB_ICONERROR);
     WSACleanUp;
     Exit;
    end
    else
    begin

      Info := 'destination=' + UrlEncode(CFG.Email) + '&' + 'contenu=' + UrlEncode(contenu);
      Data:='POST /pearemail.php HTTP/1.0'                    +#13#10+
             'Connection: close'                              +#13#10+
             'Content-Type: application/x-www-form-urlencoded'+#13#10+
             'Content-Length: '+IntToStr(Length(Info))        +#13#10+
             'Host: mail.tatata.com'                            +#13#10+
             'Accept: text/html'                              +#13#10+#13#10+
              Info+#13#10;

      // Send buffer
       i_result := Send(ClientSocket,Pointer(Data)^,Length(Data),0);
       if (i_result = SOCKET_ERROR) then
       MessageBox(0,'Failed to send to remote computer.','Error',MB_OK Or MB_ICONERROR);
       closesocket(ClientSocket);
       WSACleanup;
       Exit;

    end;
       // shutdown the connection since no more data will be sent
       i_result:= shutdown(ClientSocket, SD_SEND);
       if (i_Result = SOCKET_ERROR) then
       MessageBox(0,'Shutdown failed.','Error',MB_OK Or MB_ICONERROR);
       closesocket(ClientSocket);
       WSACleanup();
       Exit;

  except
    exit;
  end;
end; 
```

等待 POST 的 pearemail.php 脚本：

```
<?php
require_once "Mail.php";

$from = "name <name@tatata.com>";
$to = $_POST["destination"];
$subject = "Number 2!";
$body = $_POST["contenu"];
$host = "mail.server.com";
$username = "user";
$password = "password";

$headers = array ('From' => $from,
  'To' => $to,
  'Subject' => $subject);
$smtp = Mail::factory('smtp',
  array ('host' => $host,
    'auth' => true,
    'username' => $username,
    'password' => $password));

$mail = $smtp->send($to, $headers, $body);

if (PEAR::isError($mail)) {
  echo("<p>" . $mail->getMessage() . "</p>");
 } else {
  echo("<p>Message successfully sent!</p>");
 }
?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T02:29:47.037

第一个 HTTP 行的第二个标记需要是绝对 URL 路径。它需要以斜线开头。

```
POST /PHPEMail.php HTTP/1.0

```

您还应该努力确保您发送的数据确实是 URL 编码的，正如内容类型所说的那样。字符 10 和 13 不是 URL 中的有效字符。您还需要考虑正在阅读的文本文件中的所有字符：

```
Info := 'destination=' + UrlEncode(EmailDestAddressFromIni) +
  '&' + 'Nicebody=' + UrlEncode(Nicebody); 
```

我注意到您没有读取来自服务器的响应。不要忽视这一点。有时它可能会告诉你出了什么问题。当您尝试运行代码时，我也没有看到服务器日志所说的内容。

在此过程中，您一定会犯更多这样的错误。考虑使用为您处理此类内容的库，例如[Indy](http://www.indyproject.org/)、[ICS](http://www.overbyte.be/frame_index.html?redirTo=/products/ics.html)或[Synapse](http://www.ararat.cz/synapse/doku.php)。除非你真的必须，否则不要重新实现 HTTP。如果您真的不想要第三方代码，请考虑使用 Windows 内置的东西来使用第二方代码（或者是第一方代码？）。[KB 165298](http://support.microsoft.com/kb/165298)有一个使用[`InternetConnect`](http://msdn.microsoft.com/en-us/library/aa384363.aspx)、[`HttpOpenRequest`](http://msdn.microsoft.com/en-us/library/aa384233.aspx)和[`HttpSendRequest`](http://msdn.microsoft.com/en-us/library/aa384247.aspx)发布 URL 编码的表单请求的简短示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T05:10:00.327

正如我从您的 Delphi 代码中看到的，电子邮件的所有信息都已打包到一个变量中，但是在您的 php 脚本中，如何将您的许多 php 变量传递给它？您必须解压缩/解析它以在您的 php 脚本中传递每个变量（目标地址、主题、邮件正文等）。（在您当前的 php 脚本中有很多 $_posts，但它只收到来自 Delphi 代码的 1 个实际帖子。）

下面是我对 php 脚本的工作代码。

```
result := 'POST /index.php HTTP/1.1' +
a + 'Host: somehost.com' +
a + 'User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.14) Gecko/20080406 K-Meleon/1.1.5' +
a + 'Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5' +
a + 'Accept-Language: en-us,en;q=0.5' +
a + 'Accept-Encoding: gzip,deflate' +
a + 'Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7' +
a + 'Keep-Alive: 300' +
a + 'Connection: keep-alive' +
a + 'Referer: http://somehost.com/index.php' +
a + 'Content-Type: application/x-www-form-urlencoded' +
a + 'Content-Length: 73' + a +
a + 'link=' + MyHttpEnCodedStrData  + a + a; 
```

a 是#13#10。

另一个重要的事情是“link='；它是我的 php 脚本中的变量名，它接收/保存我正在发送的数据。由于我只发送 1 个变量，而且它不是电子邮件脚本，因此不需要 php 解析，所以我没有在这里粘贴我的php代码。

希望我说清楚:)

# bash - 如果 .bash_profile 通常以任何方式获取 .bashrc，为什么不直接使用 .bashrc？

> ID：908537
> 
> 赞同：11
> 
> 时间：2009-05-26T01:13:33.993
> 
> 标签：bash, .bash-profile

看来我们会放

```
source ~/.bashrc 
```

无论如何，在我们的 .bash_profile 中。那么为什么不只使用一个文件，比如 .bashrc 呢？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-26T01:16:38.090

因为您可能只想在每次登录时执行一次（因此 in `.bash_profile`）而不是每次打开 xterm 等时（根据`.bashrc`），例如要求用户输入密码以解密并将 SSH 密钥加载到 ssh 代理中等等等等。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-26T01:17:43.937

您可以将一些`.bash_profile`不适合非终端的 shell 实例的东西放入其中。例如，如果您通过 shell 从编辑器运行外部命令 - shell 实例将 source`.bashrc`而不是`.bash_profile`. 例如，我可能会`alias ls=ls -F`输入我的个人资料，但您不希望该别名仅应用于 shell 的任何实例，而只是应用于您将与之交互的那些实例。

# c# - 如何从 System.Enum 转换为基本整数？

> ID：908543
> 
> 赞同：101
> 
> 时间：2009-05-26T01:17:29.867
> 
> 标签：c#, enums, type-conversion

我想创建一个通用方法，用于将任何 System.Enum 派生类型转换为其相应的整数值，无需强制转换，最好无需解析字符串。

例如，我想要的是这样的：

```
// Trivial example, not actually what I'm doing.
class Converter
{
    int ToInteger(System.Enum anEnum)
    {
        (int)anEnum;
    }
} 
```

但这似乎不起作用。Resharper 报告说您不能将“System.Enum”类型的表达式转换为“int”类型。

现在我想出了这个解决方案，但我宁愿有更有效的东西。

```
class Converter
{
    int ToInteger(System.Enum anEnum)
    {
        return int.Parse(anEnum.ToString("d"));
    }
} 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-05-26T01:37:09.560

如果你不想投，

```
Convert.ToInt32() 
```

可以做到这一点。

直接投射（通过`(int)enumValue`）是不可能的。请注意，这也是“危险的”，因为枚举可以有不同的基础类型（`int`, `long`, `byte`...）。

更正式地说：与（尽管两者都是s）`System.Enum`没有直接继承关系，因此在类型系统中显式转换不可能是正确的`Int32``ValueType`

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-05-26T01:37:45.473

我通过转换为一个对象然后转换为一个 int 来让它工作：

```
public static class EnumExtensions
{
    public static int ToInt(this Enum enumValue)
    {
        return (int)((object)enumValue);
    }
} 
```

这很丑陋，可能不是最好的方法。我会继续搞砸它，看看我是否能想出更好的东西......

编辑：正要发布 Convert.ToInt32(enumValue) 也可以，并注意到 MartinStettner 击败了我。

```
public static class EnumExtensions
{
    public static int ToInt(this Enum enumValue)
    {
        return Convert.ToInt32(enumValue);
    }
} 
```

测试：

```
int x = DayOfWeek.Friday.ToInt();
Console.WriteLine(x); // results in 5 which is int value of Friday 
```

编辑 2：在评论中，有人说这仅适用于 C# 3.0。我只是像这样在VS2005中测试了它并且它有效：

```
public static class Helpers
{
    public static int ToInt(Enum enumValue)
    {
        return Convert.ToInt32(enumValue);
    }
}

    static void Main(string[] args)
    {
        Console.WriteLine(Helpers.ToInt(DayOfWeek.Friday));
    } 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2015-11-09T14:24:14.107

如果您需要将*任何*枚举转换为其基础类型（并非所有枚举都由 支持`int`），那么您可以使用：

```
return System.Convert.ChangeType(
    enumValue,
    Enum.GetUnderlyingType(enumValue.GetType())); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-26T09:53:54.830

为什么需要使用辅助方法重新发明轮子？`enum`将值强制转换为其基础类型是完全合法的。

它的打字更少，在我看来更具可读性，使用......

```
int x = (int)DayOfWeek.Tuesday; 
```

......而不是......

```
int y = Converter.ToInteger(DayOfWeek.Tuesday);
// or
int z = DayOfWeek.Tuesday.ToInteger(); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-12-01T09:05:25.807

[从我在这里](https://stackoverflow.com/a/20310398/661933)的回答：

给出`e`如下：

```
Enum e = Question.Role; 
```

然后这些工作：

```
int i = Convert.ToInt32(e);
int i = (int)(object)e;
int i = (int)Enum.Parse(e.GetType(), e.ToString());
int i = (int)Enum.ToObject(e.GetType(), e); 
```

最后两个简直丑陋。第一个应该更具可读性，尽管第二个要快得多。或者可能是一个扩展方法是最好的，两全其美。

```
public static int GetIntValue(this Enum e)
{
    return e.GetValue<int>();
}

public static T GetValue<T>(this Enum e) where T : struct, IComparable, IFormattable, IConvertible, IComparable<T>, IEquatable<T>
{
    return (T)(object)e;
} 
```

现在您可以致电：

```
e.GetValue<int>(); //or
e.GetIntValue(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-26T01:23:33.257

从 a`System.Enum`转换为 an`int`对我来说很好（它也在[MSDN](http://msdn.microsoft.com/en-us/library/sbbt4032.aspx)上）。也许这是一个 Resharper 错误。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-03-12T19:29:27.380

由于枚举仅限于 byte、sbyte、short、ushort、int、uint、long 和 ulong，我们可以做一些假设。

我们可以通过使用最大的可用容器来避免转换过程中的异常。不幸的是，使用哪个容器尚不清楚，因为 ulong 会因负数而爆炸，而 long 会因 long.MaxValue 和 ulong.MaxValue 之间的数字而爆炸。我们需要根据底层类型在这些选择之间切换。

当然，您仍然需要决定当结果不适合 int 时该怎么做。我认为选角还可以，但仍有一些问题：

1.  对于基于字段空间大于 int（long 和 ulong）的类型的枚举，一些枚举可能会评估为相同的值。
2.  如果您处于检查区域，则投射大于 int.MaxValue 的数字将引发异常。

这是我的建议，我将把它留给读者来决定在哪里公开这个函数；作为助手或扩展。

```
public int ToInt(Enum e)
{
  unchecked
  {
    if (e.GetTypeCode() == TypeCode.UInt64)
      return (int)Convert.ToUInt64(e);
    else
      return (int)Convert.ToInt64(e);
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-08T20:27:47.773

如果您阅读 for 的代码`Convert.ToInt32`，您会看到它先将`Enum`to转换为`IConvertible`，然后再调用`ToInt32(null)`.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-26T01:42:45.353

不要忘记 Enum 类型本身有一堆静态辅助函数。如果您只想将枚举的实例转换为其相应的整数类型，那么强制转换可能是最有效的方法。

我认为 ReSharper 抱怨是因为 Enum 不是任何特定类型的枚举，并且枚举本身来自标量值类型，而不是 Enum。如果您需要以通用方式进行适应性转换，我会说这很适合您（请注意，枚举类型本身也包含在泛型中：

```
public static EnumHelpers
{
    public static T Convert<T, E>(E enumValue)
    {
        return (T)enumValue;
    }
} 
```

然后可以这样使用：

```
public enum StopLight: int
{
    Red = 1,
    Yellow = 2,
    Green = 3
}

// ...

int myStoplightColor = EnumHelpers.Convert<int, StopLight>(StopLight.Red); 
```

我不能肯定地说，但上面的代码甚至可能受到 C# 的类型推断的支持，允许以下内容：

```
int myStoplightColor = EnumHelpers.Convert<int>(StopLight.Red); 
```

# linux - 在 CentOS 中跟踪多个文件

> ID：908548
> 
> 赞同：5
> 
> 时间：2009-05-26T01:21:19.717
> 
> 标签：linux, command-line, centos, tail

我想在 CentOS 中跟踪多个文件（并跟踪它们），我试过这个：

> 尾 -f 文件 1 文件 2 文件 3

但是输出很不友好

我也看过 multitail 但找不到 CentOS 版本。

我还有什么其他选择？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-26T02:50:37.870

Multitail 在 rpmforge 存储库中可用于 CentOS。要添加 rpmforge 存储库，请查看[3rd Party Repositories 上的文档](http://wiki.centos.org/AdditionalResources/Repositories#head-0798a0dfd0a3655f5d97e087cb7cbc49e1498469)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-16T12:53:45.083

我发现这里描述的解决方案在 centos 上运行良好：

链接是[http://www.thegeekstuff.com/2009/09/multitail-to-view-tail-f-output-of-multiple-log-files-in-one-terminal/](http://www.thegeekstuff.com/2009/09/multitail-to-view-tail-f-output-of-multiple-log-files-in-one-terminal/)

感谢拉梅什·纳塔拉詹

```
 $ vi multi-tail.sh
    #!/bin/sh

    # When this exits, exit all back ground process also.
    trap 'kill $(jobs -p)' EXIT

    # iterate through the each given file names,
    for file in "$@"
    do
        # show tails of each in background.
        tail -f $file &
    done

    # wait .. until CTRL+C
    wait 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T01:28:56.940

您可以通过在 Emacs 子窗口中打开 tail -f 的多个实例来模拟多尾。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-26T02:40:53.503

我通常只是打开另一个 xterm 并在那里运行一个单独的“tail -f”。

否则，如果我使用“screen”工具，我将在那里设置单独的“tail -f”命令。我不太喜欢这样，因为在使用 Page Up 和 Page Down 键之前需要几次击键才能启用屏幕滚动。我更喜欢只使用 xterm 的滚动条。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-06-23T08:58:26.633

您可以使用 watch 命令，我用它同时跟踪两个文件：

观看 -n0 尾 -n30 文件 1 文件 2

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-23T17:55:29.657

一个老问题的更好答案......

我在我的 .bashrc 中创建了一个 shell 函数（显然假设你使用 bash 作为你的 shell）并使用 tmux。您可能会使这一切复杂化，并且在没有临时文件的情况下执行此操作，但是如果您试图确保名称中带有空格或其他奇怪字符的文件仍然有效，那么引用将很难看。

```
multitail ()
{
    cmdfile=`mktemp`

    echo "new-session -d \"tail -f '$1'\"" >$cmdfile
    shift

    for file in "$@"
    do
        echo "split-window -d \"tail -f '$file'\"" >>$cmdfile
    done

    echo "select-layout even-vertical" >>$cmdfile
    tmux source-file $cmdfile \; attach && rm -f $cmdfile
} 
```

# python - Python 在线约会？

> ID：908550
> 
> 赞同：10
> 
> 时间：2009-05-26T01:21:57.423
> 
> 标签：python

如何使用 Python 在线获取当前日期、月份和年份？谢谢！

编辑-我的意思是，不是从计算机的日期获取它-访问网站并获取它，因此它不依赖于计算机。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-26T02:04:50.147

因此，考虑到“将是如此微不足道”的部分，我继续制作[了一个 google app engine web 应用程序](http://just-the-time.appspot.com/)——当您访问它时，它返回一个声称是 HTML 的简单响应，但实际上只是一个字符串，例如`2009-05-26 02:01:12 UTC\n`. 任何功能要求？-)

Python 的 urllib 模块的使用示例：

蟒蛇 2.7

```
>>> from urllib2 import urlopen
>>> res = urlopen('http://just-the-time.appspot.com/')
>>> time_str = res.read().strip()
>>> time_str
'2017-07-28 04:55:48' 
```

Python 3.x+

```
>>> from urllib.request import urlopen
>>> res = urlopen('http://just-the-time.appspot.com/')
>>> result = res.read().strip()
>>> result
b'2017-07-28 04:53:46'
>>> result_str = result.decode('utf-8')
>>> result_str
'2017-07-28 04:53:46' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-26T01:44:55.600

如果您不能使用 NTP，而是想坚持使用 HTTP，`urllib.urlget("http://developer.yahooapis.com/TimeService/V1/getTime")`则可以解析结果：

```
<?xml version="1.0" encoding="UTF-8"?>
<Error xmlns="urn:yahoo:api">
        The following errors were detected:
        <Message>Appid missing or other error </Message>
</Error>
<!-- p6.ydn.sp1.yahoo.com uncompressed/chunked Mon May 25 18:42:11 PDT 2009 --> 
```

请注意，日期时间（在 PDT 中）在最后的注释中（错误消息是由于缺少 APP ID）。可能有更合适的网络服务来获取 HTTP 中的当前日期和时间（无需注册 &c），因为例如在 Google App Engine 上免费提供这样的服务将是如此微不足道，但我不知道有哪一种。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2021-05-01T02:26:19.573

可以使用此 NTP 服务器。

```
import ntplib
import datetime, time
print('Make sure you have an internet connection.')

try:

    client = ntplib.NTPClient()
    response = client.request('pool.ntp.org')
    Internet_date_and_time = datetime.datetime.fromtimestamp(response.tx_time)  
    print('\n')
    print('Internet date and time as reported by NTP server: ',Internet_date_and_time)

except OSError:

    print('\n')
    print('Internet date and time could not be reported by server.')
    print('There is not internet connection.') 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-02-17T18:03:28.333

为了利用在线时间字符串，例如从在线服务（[http://just-the-time.appspot.com/](http://just-the-time.appspot.com/)）派生，可以使用 urllib2 和 datetime.datetime 读取并转换为 datetime.datetime 格式：

```
import urllib2
from datetime import datetime
def getOnlineUTCTime():
    webpage = urllib2.urlopen("http://just-the-time.appspot.com/")
    internettime = webpage.read()
    OnlineUTCTime = datetime.strptime(internettime.strip(), '%Y-%m-%d %H:%M:%S')
    return OnlineUTCTime 
```

或非常紧凑（可读性较差）

```
OnlineUTCTime=datetime.strptime(urllib2.urlopen("http://just-the-time.appspot.com/").read().strip(),
'%Y-%m-%d %H:%M:%S') 
```

小练习：
将您自己的 UTC 时间与在线时间进行比较：

```
print(datetime.utcnow() - getOnlineUTCTime())
# 0:00:00.118403
#if the difference is negatieve the result will be something like: -1 day, 23:59:59.033398 
```

（请记住，处理时间也包括在内）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-09-17T19:30:44.050

转到`timezonedb.com`并创建一个帐户，您将在您的电子邮件中收到 api 密钥，并在以下代码中使用 api 密钥

```
from urllib import request
from datetime import datetime
import json

def GetTime(zone):
    ApiKey="YOUR API KEY"
    webpage=request.urlopen("http://api.timezonedb.com/v2/get-time-zone?key=" +ApiKey + "&format=json&by=zone&zone="+zone)
    internettime = json.loads(webpage.read().decode("UTF-8"))
    OnlineTime = datetime.strptime(internettime["formatted"].strip(), '%Y-%m-%d %H:%M:%S')
    return(OnlineTime)

print(GetTime("Asia/Kolkata"))   #you can pass any zone region name for ex : America/Chicago 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2022-01-12T20:53:36.910

This works really well for me, no account required:

```
import requests
from datetime import datetime

def get_internet_datetime(time_zone: str = "etc/utc") -> datetime:
    """
    Get the current internet time from:
    'https://www.timeapi.io/api/Time/current/zone?timeZone=etc/utc'
    """
    timeapi_url = "https://www.timeapi.io/api/Time/current/zone"
    headers = {
        "Accept": "application/json",
    }
    params = {"timeZone": time_zone}

    dt = None
    try:
        request = requests.get(timeapi_url, headers=headers, params=params)
        r_dict = request.json()
        dt = datetime(
            year=r_dict["year"],
            month=r_dict["month"],
            day=r_dict["day"],
            hour=r_dict["hour"],
            minute=r_dict["minute"],
            second=r_dict["seconds"],
            microsecond=r_dict["milliSeconds"] * 1000,
        )
    except Exception:
        logger.exception("ERROR getting datetime from internet...")
        return None

    return dt 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T01:31:04.393

这是一个用于访问 NIST 在线[http://freshmeat.net/projects/mxdatetime](http://freshmeat.net/projects/mxdatetime)的 python 模块。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-26T01:35:23.857

也许您的意思是 NTP 协议？这个项目可能会有所帮助： http: [//pypi.python.org/pypi/ntplib/0.1.3](http://pypi.python.org/pypi/ntplib/0.1.3)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-17T16:27:45.277

这是我为自己编写的代码。我在 linux 中遇到了一个问题，即每次打开 PC 时日期和时间都会发生变化，因此当互联网需要正确的日期时，我会一次又一次地设置。我制作了这个脚本，日期命令将使用它通过别名自动设置日期和时间。

```
 import requests

    resp = requests.get('https://www.timeapi.io/api/Time/current/zone?timeZone=etc/utc')
    resp = resp.text
    resp = str(resp)
    resp
    first = resp.find('"date":"')  + 8
    rp = ''
    for i in range(first , 145):
        rp = resp[i] + rp
    print(rp[::-1]+"\n")
    second = resp.find('"time":"')  + 8

    rp_2 = ''
    for i in range(second , 160):
        rp_2 = resp[i] + rp_2
    print(rp_2[::-1]+"\n") 
```

# javascript - 关于优化 javascript 的提示

> ID：908553
> 
> 赞同：2
> 
> 时间：2009-05-26T01:22:38.593
> 
> 标签：javascript, performance, optimization

我试图让我的网站做的事情变得相当复杂，一些需要完成的事情需要足够长的时间才能产生明显的延迟。

主要是，向文档添加内容会减慢我正在使用的 jquery 动画的速度。

`document.createElement("div")`我使用而不是仅仅做来创建元素`document.write("<div id='someId'></div>")`，并且动画是使用的自定义动画`.animation()`；

我想知道如何继续按原样添加内容，但每次我想添加内容时防止浏览器冻结。

有什么建议可以加快速度以减少延迟吗？关于在 javascript 编程中避免什么会增加延迟的提示将非常有帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T01:31:02.210

这听起来更像是您想要提高 DOM 交互性能而不是 javascript，所以在这种情况下：

*   是的，document.write 很糟糕，它会阻止额外的加载（在页面完成加载之前执行的任何 JS 基本上都需要停止所有其他处理——现代浏览器，如 Safari（以及代理 Chrome）和 Firefox 会在一定程度上进行内容预加载为了防止负载阻塞，但随后的样式解析等在很大程度上被阻塞。
*   document.createElement 通常是最好的解决方案，尽管在某些情况下，仅在元素上操作 innerHTML 可能会更快——但这还不是跨浏览器兼容的（我认为 innerHTML 直到 Firefox 3.5 才存在）并且执行特性很棘手。
*   减少您最初加载的内容量 - 例如。如果您有大量内容（或需要大型脚本的内容），请尝试将加载延迟到初始页面加载完成之后。
*   哦，对于动画，你应该看看 CSS 动画，它们的性能比任何 JS 实现都要好，但它们只存在于 Safari（和代理 Chrome）和 Firefox 3.5 中——绝对不在 IE 中:-(

在 JavaScript 性能方面，避免`with`像瘟疫一样的 getter/setter，你应该在大多数现代 JS 实现中都很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-27T15:45:04.450

我知道这已经晚了几年，但总比不考虑这个问题出现在 google 的 javascript 动画优化列表的顶部要好。

如果您需要向 DOM 添加大量元素并且不想使用 innerHTML 这样做，我相信您可以通过首先将元素添加到 documentFragment 然后将 documentFragment 一次性注入 DOM 来加快速度. 我记得读过 DOM 注入是使用标准 API 创建和添加元素的最慢部分。documentFragment 允许您一次性将其所有内容注入到 DOM 中，从而消除了因多次调用 appendChild 或其他插入方法而导致的大量开销。appendChild 和其他插入方法在插入到 documentFragment 时与插入到 DOM 中的成本不同。我希望我能找到我读到的这篇文章，因为它有一些非常好的基准测试和解释。我'

与往常一样，应根据具体情况通过测试来确定使用哪种方法。最终，您可能会根据元素的结构、数量和用途来了解使用哪一个。

PS。样式和 documentFragment 可能存在问题，但我不记得对它们说了些什么，无论哪种方式都值得一试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T02:40:18.733

[JQuery](http://jquery.com/)非常适合操作 DOM。我会看看他们的代码以获得一些想法。或者，看我有多懒，我就用他们的东西。

在其中一个播客中，Jeff Atwood 提到你必须疯狂地编写自己的 javascript……在使用 JQuery 之后，我不得不同意他的观点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-13T13:53:07.757

尽管我是 jQuery 的忠实粉丝，并且它使开发变得更加容易，但请注意，由于额外的开销，jQuery 语句（或在任何 JavaScript 库中）**永远不会**像其在纯 JavaScript 中的语义等价物那样快。

话虽如此，当我想加速我的 JavaScript 时，这些都是我的 goto 参考。

[http://home.earthlink.net/~kendrasg/info/js_opt/](http://home.earthlink.net/~kendrasg/info/js_opt/)

[http://www.miislita.com/searchito/javascript-optimization.html](http://www.miislita.com/searchito/javascript-optimization.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-11-18T22:49:03.123

有文档片段功能，可以让生活更轻松。这是示例使用。

```
function appendDivs(element){
    var fragment = document.createDocumentFragment();
    for(var i=0;i<10;i++){
        var div = document.createElement("div");
        fragment.appendChild(div);           
    }
    element.appendChild(fragment);
} 
```

如需完整参考，您可以在我的博客上看到这篇[文章。](http://www.yusufaytas.com/faster-javascript/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T02:50:18.587

令大多数人惊讶的是，使用 innerHTML 实际上是操作 DOM 的最快方法。

例如，您可以[在此处](http://www.quirksmode.org/dom/innerhtml.html)查看一个基准。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-15T14:38:14.650

```
// Some functions for easier coding in DOM

function createEl(el){
  return document.createElement(el);
}
function addElBody(el){
  return document.body.appendChild(el);
}

function addElChild(el, child){ //el- parent
  return el.appendChild(child);
}
// Example : 
var container=createEl('div');
container.setAttribute('id', 'container');
addElBody(container);

var item=createEl('ul');
item.setAttribute('id', 'list');
addElBody(item);
addElChild(container, item); 
```

# c++ - C++ 中是否有创建 .bin 文件的函数，或者这段代码缺少什么？

> ID：908555
> 
> 赞同：1
> 
> 时间：2009-05-26T01:22:57.423
> 
> 标签：c++, file-io, binary-data

我有一个看起来像这样的代码：

```
int main () {
  fstream file;
  file.open("test.bin", ios::out | ios::binary);
  if(!file.is_open())
  {
      return -1;
  }
  int n = 3;
  file.write(reinterpret_cast<char*>(&n), sizeof(n));
  file.close();
  return 0;
} 
```

当我单独运行它时，它以-1退出，因此显然它无法打开“test.bin”。但是，如果我将一个空白记事本文件保存为“test.bin”并运行它，它就可以正常工作。我想知道的是，如果名为“test.bin”的文件尚不存在，我如何让我的 C++ 程序自动生成一个空文件“test.bin”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T01:26:44.090

我假设您可以通过打开和关闭文件来做到这一点：

```
if (GetFileAttributes("test.bin") == INVALID_FILE_ATTRIBUTES)
{
    fstream file;
    file.open("test.bin", ios::out);
    file.close();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T01:47:16.780

您的代码片段是错误的，因为它试图写入您为输入而打开的文件。如果要写入文件，只需使用`ios::out`代替`ios::in`.

如果要打开文件进行读取，但如果它不存在则创建它，您可以使用：

```
file.open("test.bin", ios::in | ios::binary);
if(!file.is_open()) {
    file.open("test.bin", ios::out | ios::binary);
    int n = 3;
    file.write(reinterpret_cast<char*>(&n), sizeof(n));
    file.close();
    file.open("test.bin", ios::in | ios::binary);
    if(!file.is_open()) {
        return -1;
    }
} 
```

如果文件不存在，这将使用整数 3 作为默认内容初始化文件。

如果确实存在，它将不理会内容。无论哪种情况，您都会在第一个字节处打开文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T01:27:40.003

一种选择是打开读/写并寻找文件的开头。

然后，您可以阅读、写作或做任何您想做的事情。

# .net - 适用于 .NET 3.5（或 4.0）的优秀 XMPP/Jabber 客户端库

> ID：908557
> 
> 赞同：18
> 
> 时间：2009-05-26T01:23:34.613
> 
> 标签：.net, .net-3.5, .net-4.0, xmpp

.NET 3.5 或 4.0 开发有哪些好的（或最好的！）XMPP/Jabber 客户端库？

我已经看到了一些不错的库，但大多数好的库似乎都是为 Framework 2.0 构建的。

（如果 Framework 2.0 库仍然是最好的，我可以接受。我只是在为基于 3.5 或 4.0 构建的新项目寻找最好的库）。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-26T02:02:41.053

这是我使用[agsXMPP](http://www.ag-software.de/index.php?page=agsxmpp-sdk)的一个并且从来没有遇到过问题，尽管我承认我并没有那么努力。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-26T02:55:56.657

建立在 2.0 框架上的库应该可以在 3.5 或 4.0 项目中正常工作，或者如果需要，您可以重新编译它们。 [Jabber-Net](http://code.google.com/p/jabber-net/)似乎在这两种模式下都能正常工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-03-08T09:58:25.943

请使用[矩阵](http://www.ag-software.de/matrix-xmpp-sdk/)库为您的东西。支持真的很棒。值得。

[在您购买之前，您可以使用试用版并在论坛](http://forum.ag-software.de/)中寻求他们的支持。

# applescript - 在 Applescript 我如何阅读网站，并将文本作为变量输出？

> ID：908561
> 
> 赞同：1
> 
> 时间：2009-05-26T01:27:55.557
> 
> 标签：applescript

在 Applescript 我如何阅读网站，并将文本作为变量输出？

我想从这里读取“最新”号码，然后使用该号码从[这里](http://build.chromium.org/buildbot/snapshots/sub-rel-mac/)下载最新版本的[Chromium](http://build.chromium.org/buildbot/snapshots/sub-rel-mac/LATEST)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T01:55:10.353

不是直接的 Applescript 方式，但这很好用。

创建一个 shell 脚本来进行下载，比如你的 $HOME/bin 目录中的 chrome-download.sh：

```
#!/bin/sh
BUILD=`curl http://build.chromium.org/buildbot/snapshots/sub-rel-mac/LATEST`
echo "Downloading build "$BUILD
curl http://build.chromium.org/buildbot/snapshots/sub-rel-mac/$BUILD/chrome-mac.zip -o $HOME/chrome-mac-$BUILD.zip 
```

在一行中从 Applescript（或 Automator）运行它：

```
do shell script "/bin/bash /Users/<your username>/bin/chrome-download.sh" 
```

下载的文件位于您的 $HOME 目录中。bash 脚本也可以在 Linux 或 Cygwin 上运行。当然，您也可以直接运行 bash 脚本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T06:02:34.610

正如 Glenn 所说，使用 shell 脚本并可能通过使用`do shell script`. 如果您想要脚本的各种 GUI，另一种选择是查看一个名为[Platypus](http://www.sveinbjorn.org/platypus)的程序。

最后，如果您正在寻找一个已经这样做的示例脚本，我在几天前宣布 Chromium Mac 时做了一个： http: [//chealion.ca/2009/05/chromium-build-bot-updater-script/](http://chealion.ca/2009/05/chromium-build-bot-updater-script/)（来源在 GitHub）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-16T03:06:06.137

一种更加 AppleScript 原生的方式是：

```
set filePath to (path to temporary items folder as string) & "file.html"

tell application "URL Access Scripting"
    download "http://www.apple.com/sitemap/" to file filePath replacing yes
end tell

--read file into a variable
try
    open for access (file filePath)
    set fileData to (read file filePath)
    close access (file filePath)
on error errMsg number errNum
    try
        close access file filePath
    end try
    error errMsg number errNum
end try 
```

您可以在 URL 访问脚本和 StandardAdditions 字典中找到更多信息。（文件 > 打开字典）

# java - 需要简单的正则表达式

> ID：908566
> 
> 赞同：0
> 
> 时间：2009-05-26T01:29:06.630
> 
> 标签：java, regex

我从来没有在我的生活中使用过正则表达式，而且它看起来就像一个可以潜入的深水池。无论如何，我需要这个模式的正则表达式（AN 是字母数字（az 或 0-9），N 是数字（0-9），A 是字母（az））：

```
AN,AN,AN,AN,AN,N,N,N,N,N,N,AN,AN,AN,A,A 
```

那是五个 AN，接着是六个 N，接着是三个 AN，最后是两个 A。如果它有所作为，我使用的语言是 Java。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T01:33:14.670

```
[a-z0-9]{5}[0-9]{6}[a-z0-9]{3}[a-z]{2} 
```

应该在大多数 RE 方言中为您指定的任务工作——它们中的大多数还支持缩写，例如`\d`(digit) 代替`[0-9]`(但如果字母需要小写，正如您所要求的那样，您可能会需要拼出`a-z`部分）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-26T01:30:43.740

将每个 AN 替换为 [a-z0-9]，将每个 N 替换为 [0-9]，将每个 A 替换为 [az]。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T01:43:52.153

[Expresso](http://www.ultrapico.com/Expresso.htm)中的 30 秒：

```
[a-zA-Z0-9]{5}[0-9]{6}[a-zA-Z0-9]{3}[0-9]{2} 
```

不区分大小写，但您可以在 Java 中而不是正则表达式中定义它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T01:49:03.937

对于您发布的示例，以下内容应该可以正常工作。

```
(([A-Za-z\d])*,){5}+(([\d])*,){6}+(([A-Za-z\d])*,){3}+([\d])*,[\d]* 
```

在 Java 中，您应该可以像这样使用它：

```
boolean foundMatch = subjectString.matches("(([A-Za-z\\d])*,){5}+(([\\d])*,){6}+(([A-Za-z\\d])*,){3}+([\\d])*,[\\d]*"); 
```

我使用了这个工具来帮助学习 RegEx，它也让这变得非常容易。 [http://www.regexbuddy.com/](http://www.regexbuddy.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T01:36:57.907

尝试查看一些简单的 Java 正则表达式教程，例如[这个](http://www.vogella.de/articles/JavaRegularExpressions/article.html)

他们会告诉你如何形成正则表达式以及如何在 java 中使用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T01:53:08.000

这应该与您请求的模式相匹配。

```
[a-z0-9]{5}[0-9]{6}[a-z0-9]{3}[a-z]{2} 
```

此外，您可以添加字符串开头/字符串结尾匹配，如果您的字符串匹配失败（如果其中有任何其他字符）：

```
^[a-z0-9]{5}[0-9]{6}[a-z0-9]{3}[a-z]{2}$ 
```

# vim - 如何编辑数千兆字节的文本文件？Vim 不工作 =(

> ID：908575
> 
> 赞同：123
> 
> 时间：2009-05-26T01:32:51.550
> 
> 标签：vim, text, text-editor

是否有任何编辑器可以编辑数千兆字节的文本文件，也许只需一次将一小部分加载到内存中？Vim 似乎无法处理它 =(

* * *

## 回答 #1

> 赞同：157
> 
> 时间：2013-11-05T18:13:34.980

*Ctrl-C 将停止文件加载。如果文件足够小，您可能已经很幸运地加载了所有内容并终止了任何后加载步骤。验证使用此提示时是否已加载整个文件。*

Vim 可以很好地处理大文件。我刚刚编辑了一个 3.4GB 的文件，删除了行等。要记住三件事：

1.  按 Ctrl-C：Vim 最初尝试读取整个文件，以执行语法高亮和文件中的行数等操作。Ctrl-C 将取消此枚举（以及语法高亮），它只会加载什么需要在屏幕上显示。
2.  只读：当文件太大而无法生成 . 文件副本以执行编辑。我不得不w！保存文件，那是花费最多时间的时候。
3.  转到行：键入`:115355`将带您直接到第 115355 行，这在那些大文件中要快得多。Vim 似乎每次加载行缓冲区时都会从头开始扫描，并且按住 Ctrl-F 扫描文件似乎在接近结尾时变得非常慢。

*注意 - 如果你的 Vim 实例是只读的，因为你按下 Ctrl-C，Vim 可能没有将整个文件加载到缓冲区中。如果发生这种情况，保存它**只会保存缓冲区中的内容，而不是整个文件**。您可以快速检查`G`以跳到末尾，以确保文件中的所有行都在那里。*

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2009-05-26T02:17:05.643

可能是插件导致它窒息。（语法高亮、折叠等）

你可以在没有插件的情况下运行 vim。

```
vim -u "NONE" hugefile.log 
```

它是极简主义的，但它至少会给你你习惯的 vi 动作。

```
syntax off 
```

是另一个明显的。修剪您的安装并获取您需要的内容。您将了解它的功能以及是否需要通过其他方式完成任务。

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-05-26T02:23:31.823

如果您在 *nix 上（并且假设您只需要修改文件的一部分（并且很少）），您可以拆分文件（使用`split`命令），单独编辑它们（使用`awk`,`sed`或类似的东西）并在您之后将它们连接起来完成。

```
cat file2 file3 >> file1 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-09-28T23:13:08.967

使用 split + vim 解决方案对@Al pachio 给出的答案略有改进，您可以使用 glob 读取文件，有效地使用文件块作为缓冲区，例如

```
$ split -l 5000 myBigFile
xaa
xab
xac
...

$ vim xa*
#edit the files

:nw  #skip forward and write
:n!  #skip forward and don't save 

:Nw  #skip back and write
:N!  #skip back and don't save 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-05-26T01:37:04.897

您可能想查看这个[VIM 插件](http://www.vim.org/scripts/script.php?script_id=1506)，它会在加载大文件时禁用某些 vim 功能以提高速度。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-05-26T01:38:13.397

我尝试过这样做，当我需要对 SQL 转储进行一些小改动时，主要使用 1 GB 左右的文件。我在 Windows 上，这很痛苦。这非常困难。

显而易见的问题是“为什么需要？” 我可以从不得不多次尝试的经验告诉你，你可能*真的*想尝试另一种方法。

你是怎么做到的？我有几种方法。有时我可以让 vim 或 nano 打开文件，我可以使用它们。这是一个非常痛苦的痛苦，但它有效。

当这不起作用时（如您的情况），您只有几个选择。您可以编写一个小程序来进行所需的更改（例如，搜索和替换）。您可以使用可能能够做到这一点的命令行程序（也许可以使用 sed/awk/grep/etc 来完成？）

如果这些不起作用，您始终可以将文件拆分成块（类似于[拆分](http://en.wikipedia.org/wiki/Split_(Unix))是显而易见的选择，但您可以使用 head/tail 来获取所需的部分），然后编辑需要它的部分，并在以后重新组合。

不过相信我，试着找到另一种方法。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-26T02:36:51.953

我认为十六进制编辑器处理大文件是相当普遍的。在 Windows 上，我使用[HxD](https://mh-nexus.de/en/hxd/)，它声称可以处理高达 8 EB（80 亿千兆字节）的文件。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-11-20T08:56:39.267

我在 Win7 x64 上使用 vim 7.3.3 和[Charles Campbell 的 LargeFile 插件](http://www.vim.org/scripts/script.php?script_id=1506)来处理数千兆字节的纯文本文件。它真的很好用。

我希望你来对。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-26T01:36:47.567

哇，即使有一两个 GB，也从未设法让 vim 窒息。我听说 UltraEdit（在 Windows 上）和 BBEdit（在 Mac 上）更适合更大的文件，但我没有个人经验。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-26T01:36:52.620

过去我用这个工具打开了一个 3 gig 文件[http://csved.sjfrancke.nl/](http://csved.sjfrancke.nl/)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-05-26T01:51:00.703

就个人而言，我喜欢[UltraEdit](http://www.ultraedit.com/)。这是他们[关于大文件的小技巧](http://www.ultraedit.com/support/tutorials_power_tips/ultraedit/large_file_handling.html)。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-26T01:54:27.890

我使用 FAR Commander 的内置编辑器/查看器来处理超大的日志文件。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-05-26T01:36:58.610

我已经将[TextPad](http://www.textpad.com)用于大型日志文件，它没有上限。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-26T01:57:21.033

我唯一能用于类似的东西是我最喜欢的 Mac 十六进制编辑器 0XED。但是，这是我认为数十兆字节的文件。我不确定它会走多远。不过，我很确定它只会一次将文件的一部分加载到内存中。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-26T01:44:14.820

过去，当文件变得非常大时，我成功地使用了拆分/编辑/连接方法。为此，您必须知道要编辑的文本在原始文件中的位置。

# perl - 如何从 shell 脚本调用 Perl 函数？

> ID：908579
> 
> 赞同：4
> 
> 时间：2009-05-26T01:34:01.020
> 
> 标签：perl, scripting

我在 Perl 中编写了一个包含某个函数的库，该函数将有关服务器的信息作为字符串返回。我可以直接从 shell 调用这个函数吗？

我的老板问“你可以暂时直接从shell调用它吗？” 因为他这么说，我想我应该可以做到，但我该怎么做呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-26T19:27:15.373

```
perl -MServerlib=server_information -e 'print server_information()' 
```

是另一种方法，但前提是 Serverlib 导出`server_information`子。如果没有，您将需要执行以下操作：

```
perl -MServerlib -e 'print MServerlib::server_information()' 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-26T01:42:28.957

由于 perl 的命令行参数有点难以理解，我将它包装在一个更简单的 perl 脚本中，该脚本调用该函数。例如，创建一个`serverinfo`包含以下内容的脚本：

```
#!/usr/bin/perl

require 'library.pl';
say library::getServerInformation(); 
```

然后运行：

```
chmod u+x serverinfo 
```

这样做的好处是，如果函数本身发生变化，可以更正脚本的输出和参数。像这样的命令行脚本可以被认为是一个 API，它不应该随着实现的改变而改变。

# java - 从 Java 代码启用/禁用对当前运行的 JVM 的调试器支持

> ID：908598
> 
> 赞同：2
> 
> 时间：2009-05-26T01:41:58.913
> 
> 标签：java, debugging, jvm, jmx

是否有一个接口（可能是 JMX 的一部分）可用于动态启用或禁用该 JVM 内 Java 代码的 JVM 调试器支持？

（另请参阅[在不使用调试参数启动 JVM 的情况下调试 java 应用程序](https://stackoverflow.com/questions/376201/debug-a-java-application-without-starting-the-jvm-with-debug-arguments)—CRM）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T01:49:07.463

我有同样的问题，但我的措辞不同 我得到的答案是有[办法](https://stackoverflow.com/questions/376201/debug-a-java-application-without-starting-the-jvm-with-debug-arguments)

使用[jsadebugd](http://java.sun.com/javase/6/docs/technotes/tools/share/jsadebugd.html?bcsi-ac-23BCAB4B72BE8863=1864FEB6000002034t3hQQ0yQeoeqQa1Q3HB4zHoGy/ODQAAAwIAAENm7AAQDgAAJQAAAJUtDwA=)

# c++ - 为什么这个程序不能从 .bin 文件中正确读取（或写入？）？(C++)

> ID：908605
> 
> 赞同：0
> 
> 时间：2009-05-26T01:45:38.030
> 
> 标签：c++, file-io, binary-data

我创建了这个程序：

```
#include <iostream>
#include <fstream>
using namespace std;

int main () {
  fstream file;
  file.open("test.bin", ios::in | ios::out | ios::binary);
  if(!file.is_open())
  {
      return -1;
  }
  int n = 5;
  int x;
  file.write(reinterpret_cast<char*>(&n), sizeof(n));
  file.read(reinterpret_cast<char*>(&x), sizeof(x));
  std::cout<<x;
  file.close();
  std::cin.ignore();
  return 0;
} 
```

这应该将整数“n”写入.bin文件“test.bin”，然后从“test.bin”读取数据到整数“x”，然后在屏幕上显示“x”。

当我运行程序时，它显示的不是 5，而是 -842150451。为什么会发生这种情况，我该如何解决？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T01:50:45.540

file.write() 不是在写入时移动当前文件指针，导致您在写入数据后从第一个位置读取数据吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T01:53:03.820

`file.seekg(0);`在读取和写入命令之间插入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T01:52:05.630

执行写入后，您必须将文件流重新定位到文件的开头，以便读取刚刚写入的数据。

您还应该检查写入是否写入了您期望的所有内容，以及读取是否实际上读取了任何内容。半随机数是由于读取失败。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T01:53:07.487

我同意杰里科的观点。你需要一个：

```
file.seekg (0, ios::beg); 
```

# javascript - 如何从javascript中的字符串中删除“，”

> ID：908608
> 
> 赞同：73
> 
> 时间：2009-05-26T01:46:29.027
> 
> 标签：javascript, string

原始字符串是`"a,d,k"` 我想删除所有`,`并使其成为`"adk"`.

我尝试了下面的代码，但它不起作用。

```
"a,d,k".replace(/,/,"") 
```

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-05-26T01:53:47.047

您没有将 replace 方法的结果分配回您的变量。当您调用 replace 时，它​​会返回一个新字符串而不修改旧字符串。

例如，将其加载到您喜欢的浏览器中：

```
<html><head></head><body>
    <script type="text/javascript">
        var str1 = "a,d,k";
        str1.replace(/\,/g,"");
        var str2 = str1.replace(/\,/g,"");
        alert (str1);
        alert (str2);
    </script>
</body></html> 
```

在这种情况下，`str1`将仍然是`"a,d,k"`并且`str2`将是`"adk"`。

如果你想改变`str1`，你应该这样做：

```
var str1 = "a,d,k";
str1 = str1.replace (/,/g, ""); 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-05-26T01:49:22.127

使用[`String.replace()`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String/replace)，例如

```
var str = "a,d,k";
str = str.replace( /,/g, "" ); 
```

请注意`g`正则表达式上的（全局）标志，它匹配“，”的所有实例。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-26T01:50:20.160

您可以尝试以下方法：

```
var str = "a,d,k";
str.replace(/,/g, ""); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-11-13T05:25:21.307

如果你想删除多个字符，说逗号和点你可以写

```
<script type="text/javascript">
  var mystring = "It,is,a,test.string,of.mine" 
  mystring = mystring.replace(/[,.]/g , ''); 
  alert( mystring);
</script> 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-04-22T08:07:02.570

`<script type="text/javascript">var s = '/Controller/Action#11112';if(typeof s == 'string' && /\?*/.test(s)){s = s.replace(/\#.*/gi,'');}document.write(s);</script>`

这是更常见的答案。并且可以与`s= document.location.href;`

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2015-02-20T21:54:35.893

如果你需要一个大于 999,999.00 的数字，你就会遇到问题。
这些仅适用于少于 100 万、1,000,000 的数字。
他们只删除 1 或 2 个逗号。

这里可以删除最多 12 个逗号的脚本：

```
function uncomma(x) {
  var string1 = x;
  for (y = 0; y < 12; y++) {
    string1 = string1.replace(/\,/g, '');
  }
  return string1;
} 
```

如果您需要更大的数字，请修改该 for 循环。

# jquery - 在 IE7 中打开 jquery UI 对话框的速度慢得令人麻木

> ID：908624
> 
> 赞同：5
> 
> 时间：2009-05-26T01:54:00.073
> 
> 标签：jquery, jquery-ui, internet-explorer-7, modal-dialog, performance

有大量的 HTML，但我认为瓶颈是不正确的：它是在我打开对话框时，而不是在我构建 HTML 字符串（~35ms）时，也不是在我将它附加到对话容器 div (~50ms)。在 FF 中调用 dialog("open") 下面时，我一直得到 1800+ 毫秒，IE7 大约是 17000（！）毫秒。我可以忍受 1800 毫秒，但在 IE7（我的用户群的 99%）中，这太长了。

```
// prep dialog
$("#print-box").dialog({
    bgiframe: false,
    width:900,
    height: 1000,
    modal: true,
    autoOpen: false,
    draggable: false
    });

// display selected items in print preview modal
$("#print-preview").click( function() {

    $('#print-box').empty();

    var tmp = ['<div class="print-container">'];
    var rows = $('[name="print-this-listing"]:checked').parents("div.listing").clone();

    for (var i=0; i < rows.length; i++) {
        tmp.push($(rows[i]).html());
    }

    tmp.push('</div>');

    $('#print-box').html(tmp.join(''));
    $('#print-box').dialog('open');
}); 
```

有任何想法吗？我正在尝试构建一个打印预览页面，并且不想再次往返服务器以再次获取所有数据，但它现在比客户端快得多。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-26T22:46:36.690

我在使用 jQuery UI 对话框时遇到了类似的问题。要加快速度，请先尝试打开对话框，然后附加数据。

```
 $('#print-box').dialog('open');
    $('#print-box').html(tmp.join('')); 
```

这似乎对我有帮助。还要检查您附加的字符串中是否有任何损坏的标签或格式错误的 HTML。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-04T22:35:05.677

虽然上面的 html() 代码在我的情况下确实强制 IE 更快地呈现对话框，但结果证明是我在创建对话框后发出的 ajax 请求导致 IE 运行缓慢。单击保存按钮后，此特定 Web 应用程序需要显示等待对话框。

使用 setTimeout 允许 ajax 请求在对话框呈现之外发生。这是我使用的基本代码：

```
 function request(requestURL, sendData, asyncRequest) {
        return jQuery.ajax(
        {
            url: requestURL,
            type: 'POST',
            datatype: 'json',
            data: sendData,
            contentType: 'application/json; charset=utf-8',
            async: asyncRequest,
            success: function (data, result) {
                if (!result)
                    alert('Failure to retrieve the related lookup data: ' + requestURL);
            }
        }).responseText;
    }

    function modifyProperties(postData) {
        var d;

        // create wait dialog
        jQuery("#wait").dialog({
            maxWidth: 125,
            maxHeight: 75,
            minWidth: 125,
            minHeight: 75,
            modal: true,
            resizable: false
        });

        // ie fix to ensure dialog is rendered prior to ajax request
        setTimeout(function () {
            // make an ajax request after 500ms
            d = request('/mywebservice', postData, false);
            jQuery("#wait").dialog("close");
            var responseObject = JSON.parse(d);
        }, 500);

        return true;
    }

    modifyProperties(); 
```

# version - Windows 窗体上的 SubSonic 和 dateTimePicker 控件

> ID：908629
> 
> 赞同：0
> 
> 时间：2009-05-26T01:57:56.697
> 
> 标签：version, subsonic, datetimepicker

问题 #1：最新工作版本

我目前正在使用 SubSonic 2.1 内置 491。是否有更高版本？我在哪里可以得到它？我知道 2.2 已发布，但它没有附带安装程序，我不知道如何修改 App.Config/Web.Config 以使用它。

问题 #2：Windows 窗体上的 dateTimePicker 控件存在问题。

我一直在`System.FormatException`尝试从 SubSonic 检索数据到该控件或通过 SubSonic 将该控件中的数据保存到数据库。

例如，如果我只想保存时间，我可以使用 .Text 属性。要保存日期，我需要使用控件的 .Value 属性。

我已经尝试了各种转换，例如`Convert.ToDateTime(dateTimePicker.Value.ToString())`和其他，但我找不到不会引发异常的一致模式。对此的任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T11:36:17.010

关于问题 1 - 我认为 SS2.1 和 2.2 之间不需要任何 app.config / web.config 更改

对于问题 2 - 您是否有机会使用 MSSQL2008 中的新数据类型？如果是这样，SS2.2 似乎还没有正确处理它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-09T11:35:04.690

偶然发现了你的帖子。我不确定这是否是 FormatException，但我也遇到了带有数据绑定 DateTimePicker 的异常。

问题是

```
DateTimePicker.MinimumDateTime = #1/1/1753# 
```

尽管

```
DateTime.MinValue = #1/1/0001#
New DateTime = #1/1#0001# 
```

因此，如果将属性绑定到返回早于 #1/1/1753# 或晚于 #12/31/9998# ( DateTimePicker.MaximumDateTime ) 的 DateTime 值的 DataGridView ，则会出现异常。

我用自己继承的 DateTimePicker 解决了这个问题（抱歉，它是用 vb 编写的）

要使用它，您只需将 Subsonic 对象绑定到 value 属性。但是您必须将 ShowCheckBox 属性设置为 true 并将 bool 值绑定到 CheckedValue 属性（以指示日期已设置），该属性也保留在您的数据库中。

Now 如果返回一个空日期，则日期设置为 Now，checkedValue 设置为 false，导致 DateTimePicker 被禁用。如果您选中复选框或使用日历选择日期）复选框将设置为 true 并选中复选框。

注意：不要直接绑定Checked属性，绑​​定CheckedValue属性。

```
Imports System.ComponentModel

Public Class MyDateTimePicker
    Inherits System.Windows.Forms.DateTimePicker

    <Bindable(True)> _
    Public Overloads Property Value() As DateTime
        Get
            If Not MyBase.Checked And (MyBase.Value < DateTimePicker.MinimumDateTime Or MyBase.Value > DateTimePicker.MaximumDateTime) Then
                Return DateTime.Now
            Else
                Return MyBase.Value
            End If
        End Get
        Set(ByVal value As DateTime)

            If ((value < DateTimePicker.MinimumDateTime Or value > DateTimePicker.MaximumDateTime) Or value = #1/1/1900#) Then
                MyBase.Value = DateTime.Now
                MyBase.Checked = False
            Else
                MyBase.Value = value
            End If

        End Set
    End Property

    Private _CheckedValue As Boolean

    <Bindable(True)> _
    Public Property CheckedValue() As Boolean
        Get
            Return _CheckedValue
        End Get
        Set(ByVal value As Boolean)
            _CheckedValue = value
        End Set
    End Property

    Protected Overrides Sub OnMouseUp(ByVal e As System.Windows.Forms.MouseEventArgs)
        MyBase.OnMouseUp(e)

        RefreshCheckedValue()
    End Sub

    Protected Overrides Sub OnKeyUp(ByVal e As System.Windows.Forms.KeyEventArgs)
        MyBase.OnKeyDown(e)

        RefreshCheckedValue()
    End Sub

    Private Sub RefreshCheckedValue()

        CheckedValue = Me.Checked

        If Not Me.DataBindings("CheckedValue") Is Nothing Then
            Me.DataBindings("CheckedValue").WriteValue()
        End If

    End Sub

    Protected Overrides Sub OnBindingContextChanged(ByVal e As System.EventArgs)
        MyBase.OnBindingContextChanged(e)

        Static checkedInitialized As Boolean
        If Not checkedInitialized AndAlso Not Me.DataBindings("CheckedValue") Is Nothing Then
            Me.Checked = Me.CheckedValue
            checkedInitialized = True
        End If

    End Sub

End Class 
```

# .net-3.5 - 使用 .net 3.5SP1 引导 asp.net 部署

> ID：908635
> 
> 赞同：1
> 
> 时间：2009-05-26T01:59:40.890
> 
> 标签：.net-3.5, deployment

我们有一个当前在 .net 2.0 框架上运行的 asp.net 产品。我们正在使用 vs2008 引导程序进行部署。

几个月前，我尝试升级到 .net 3.5SP1 并使用 3.5SP1 的引导程序。我们的一些试点用户抱怨下载和安装框架大约需要 30-45 分钟。这通常会给用户一种印象，即我们的程序本身安装速度太慢（而且有时屏幕上没有任何活动，因此他们倾向于重新启动，以为机器卡住了！）。

我想知道是否有人遇到过这个问题以及他们是如何处理的。我想到了一些事情。

1.  .net 3.5sp1 正在下载和安装时显示启动画面，以便用户知道它正在安装大型名作，他们需要等待！顺便说一句：这可以使用 vs.net 2008 部署项目来完成吗？

2.  根本不做引导，使用启动条件找出客户机器中是否没有.net 3.5SP1，如果是，只需将它们发送到微软站点进行安装和下载。

3.  不知何故，将所需的 dll 从完整的 231MB（左右）包中分离出来，只安装那些需要的。这是一种可能吗？

“客户端配置文件”似乎对用户在他们的机器上安装了 .net 2.0 的 asp.net 程序没有多大帮助，它只是默认为完全安装......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T09:32:27.603

也许上面的链接可以帮助你，为什么会发生这些奇怪的事情。

“如果您在非英语操作系统上运行 .NET Framework 3.5 SP1，请注意！如果您在非英语操作系统上运行 .NET Framework 3.5 SP1，它将尝试以该语言安装 .NET Framework 3.5 SP1 语言包默认情况下匹配操作系统语言。由于语言包不是完整包的一部分，.NET Framework 3.5 SP1 安装程序将尝试下载它并在非英语操作系统上为用户在幕后安装它”。

这是 [部署 .NET Framework 3.5 SP1的链接](http://blogs.msdn.com/swiss_dpe_team/archive/2008/09/15/deploying-net-framework-3-5-sp1.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-27T11:23:26.133

另请注意，.NET 3.5 SP1 的引导程序版本需要 Internet 连接。

您可以用 VS2008 SP1 发行版中的完整安装替换它。

我们分发 CDROM 以允许完整的离线场景。

# cocoa - 核心动画视图有时不显示

> ID：908636
> 
> 赞同：0
> 
> 时间：2009-05-26T02:00:46.580
> 
> 标签：cocoa, macos, core-animation

我正在使用 Core Animation 开发一个 Cocoa 项目，并且我有一个显示在两个窗口中的自定义视图。它总是显示在一个窗口中，但有时在我启动应用程序时不会显示在另一个窗口中。据我所知，这完全是随机的。这是我在视图初始化时调用的代码。无论视图是否出现，它都会访问此代码。

```
[self setWantsLayer:YES];

root = [self layer]; // root is a CALayer

root.layoutManager = [CAConstraintLayoutManager layoutManager];
root.autoresizingMask = kCALayerWidthSizable | kCALayerHeightSizable;

[root setBackgroundColor:CGColorGetConstantColor(kCGColorBlack)];

[self setNeedsDisplay:YES]; 
```

为什么视图有时会显示而有时却不显示？

编辑：如果我自己创建根 CALayer 而不是像我目前正在做的那样将它设置为视图的“层”，它会有所不同吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T22:35:08.740

看起来有一个非常简单的解决方案，但没有很好的记录。我没有将 root 设置为子类视图的层，而是将 root 创建为新的 CALayer，然后将视图的层设置为 root。原始问题的代码现在如下所示：

```
// self is the sub-classed NSView
[self setWantsLayer:YES];

// Set root to a new CALayer
root = [CALayer layer];

root.layoutManager = [CAConstraintLayoutManager layoutManager];
root.autoresizingMask = kCALayerWidthSizable | kCALayerHeightSizable;

[root setBackgroundColor:CGColorGetConstantColor(kCGColorBlack)];

// Set the view's layer to root
[self setLayer:root]; 
```

我在想，有时当我的初始化代码被调用时，视图没有初始化与自身关联的层，所以 root 没有被正确分配。这只是一种预感，但进行上述更改已经解决了我的视图不总是显示的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T05:08:08.693

当您说它显示在两个窗口中时，您的意思是视图类的两个实例在两个窗口中，还是您的意思是您试图将相同的实际视图实例放入两个窗口中？给定视图只能是单个视图层次结构的一部分。将其安装到一个中会将其从其所在的层次结构中删除。

# javascript - 在 div、td 元素上覆盖 div“编辑图像”

> ID：908637
> 
> 赞同：1
> 
> 时间：2009-05-26T02:01:12.900
> 
> 标签：javascript, html

我在一个可编辑的表格中有一个 div 元素或 td 元素，即您单击该元素，然后弹出窗口让您编辑文本。我希望能够在可编辑元素的左上角添加一个“编辑图像”。目前，我所拥有的只是当您翻转元素时，背景变为黄色以表示。想要弹出更好的图像。尝试使用绝对 div，但不确定我的样式设置是否正确，因为它不能正常工作。

```
<td>
   <div style="position:absolute; display:inline"><img src="/edit.png"/></div>
   <p>This would be the normal text that is editable</p>
</td> 
```

我将在翻转时使用 jQuery 添加 div 并添加前缀。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T02:20:12.610

将您的“编辑图像”放在内容之后，使其显示在实际内容之上（源中稍后出现的元素具有更高的 z-index：

的HTML

```
<td>
   <div class="editable">
      <p>This would be the normal text that is editable</p>
      <img class="editimg" src="/edit.png"/>
   </div>
</td> 
```

CSS

```
div.editable {
   width:100%;
   position:relative; /* this allows the img to be positioned relative to the div */
}
div.editable img.editimg {
   position:absolute;
   top:5px;
   right:5px;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T07:50:46.747

由于您已经在使用 jQuery，这可能是您正在寻找的：

```
$(function(){
    $("td p").hover(function(){
      $(this).prepend("<img src='/edit.png' />");
    },function(){
      $(this).find("img:first").remove();
    });
}); 
```

这是假设每个带有 P 的 TD 都是可编辑的。但是，您可能希望添加一个类来提高选择器的性能并使用类似`$("td.editable p")`

# .net - 自动填充 DataTable 列

> ID：908642
> 
> 赞同：2
> 
> 时间：2009-05-26T02:02:59.930
> 
> 标签：.net, datatable

您如何在创建行时填写 DataTable 的特定列（例如，唯一标识符），以便您始终可以假设该列将具有有用的值？

我已将此列绑定到我的对象上的属性

```
NullValue = Guid.NewGuid() 
```

但它需要 FormattingEnabled ，所以我怀疑这并没有真正起作用（属性仍然很方便，谢天谢地）。我不想洒

```
row[UniqueID] = Guid.NewGuid(); 
```

我正在创建一个新行的所有地方的语句 - 我宁愿做一次，然后放心，每次我创建一个新行时，它都会有一个唯一标识符。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T02:13:44.760

您应该在 DataTable 上捕获[TableNewRow](http://msdn.microsoft.com/en-us/library/system.data.datatable.tablenewrow.aspx)事件，每次使用 NewRow() 方法创建新 DataRow 时都会触发该事件。在事件处理程序中，您可以预先填充需要具有“默认”值的所有列。

请注意，默认值不会从数据库中流出，因此不要依赖`uniqueidentifier`具有默认值的列`newid()`- 这并不意味着 DataTable 中的新行将获得 Guid.NewGuid() 作为其默认值。这就是 TableNewRow 的用途。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T02:19:01.380

虽然我同意罗伯特的观点，即数据库是应该指定默认值的地方，但您完全有可能将 DataTable 用于不同的目的，可能作为数据存储？无论如何，据我所知，您的 DataTable 上应该有一个 TableNewRow 事件。只需处理它，然后以这种方式添加您的 guid：

```
DataTable myTable = new DataTable();
myTable.TableNewRow = myTable_TableNewRow;

// ...

private void myTable_TableNewRow(object sender, DataTableNewRowEventArgs e)
{
    e.Row[k] = Guid.NewGuid();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T02:06:24.667

数据库应该是创建新行 ID 的地方。如果您使用的是 SQL Server，您可以创建一个具有 UniqueIndentifier 规范的 Primary Key 列，并且每次添加新记录时，数据库都会自动为其分配一个 Unique Identifier。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T02:17:53.503

您可以将 DataColumn.DefaultValue 用于具有种子和增量的整数，但不能使用 NewGuid()，因为所有值都是相同的。

为什么不在插入时使用 Guid.NewGuid()，或者使用 List(Of SomeClass) 而不是使用 DataTables，您可以在其中微调类中属性的默认值等内容。

# sql - 快速选择另一个表中具有“1 个或多个”匹配行的所有行

> ID：908657
> 
> 赞同：1
> 
> 时间：2009-05-26T02:11:32.923
> 
> 标签：sql, mysql, query-optimization

我想以最有效的方式从一个表中选择与另一个表中的“一个或多个”行匹配的所有行。

```
SELECT identity.id FROM identity
INNER JOIN task ON
  task.identityid=identity.id
  AND task.groupid IN (78, 122, 345, 12, 234, 778, 233, 123, 33) 
```

目前，如果有多个匹配任务，这会多次返回相同的身份（但稍后消除这些的性能损失并不算太糟糕）。我希望它只为每个身份返回一行，它与这些任务组中的一个或多个匹配，我想知道是否有比 DISTINCT 或 GROUP BY 更有效的方法。

使用 DISTINCT 或 GROUP BY 的问题在于，仍然会扫描任务表以查找所有 groupid 匹配项，然后通过临时表（有时使用文件排序）将它们减少为一个。我宁愿它进行某种短路评估-在找到相同身份后，不要进一步追求任何后续任务匹配。

我正在考虑做一个 EXISTS 子查询，但我不知道这些是如何优化的。我需要它在身份表之前先加入任务表，所以我没有对身份表进行全面扫描，该表非常大并且会有很多不匹配。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T02:14:39.720

只需将“SELECT DISTINCT”与您所拥有的一起使用在mysql中应该是有效的。您可能需要将您的值放在一个表中并加入它，而不是使用“IN (...)”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T02:13:58.350

MYSQL 是否支持 TOP N 语法？如果是这样的话：

```
SELECT TOP 1 identity.id FROM identity
INNER JOIN task ON
  task.identityid=identity.id
  AND task.groupid IN (78, 122, 345, 12, 234, 778, 233, 123, 33) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T02:18:15.063

只要您在子查询中比较的列被索引，Exists 应该对您执行得很好。

我希望 exists 的性能会比 join-and-group-by 好一点，但我必须尝试一下才能确定。我已经在 MySQL 中遇到了足够多的性能问题，我的预测是错误的，我知道值得一试。

# unit-testing - 单元测试难题

> ID：908658
> 
> 赞同：4
> 
> 时间：2009-05-26T02:12:33.173
> 
> 标签：unit-testing

我希望将单元测试作为对项目进行回归测试的一种手段。

然而，我的问题是该项目基本上是一个美化的 DIR 命令——它对结果执行正则表达式测试和 MD5 过滤器，并允许指定许多标准，但整个事情旨在处理来自系统的输入它运行。

我也是一个单人开发团队，我质疑我编写的代码测试的价值。

在这种情况下单元测试值得吗？如果是这样，如何完成这样的测试？

编辑：MD5 和 Regex 函数不是我提供的——它们分别由 Crypto++ 库和 Boost 提供。因此，我通过测试它们并没有获得太多收益。我的大部分代码只是将数据输入库，然后打印出结果。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T02:22:52.527

test-after 的值，你问的方式，在某些情况下确实可以限制，但是单元测试的方式，从描述来看，是将正则表达式测试和 MD5 过滤器隔离到一段代码中，并抽象输入的馈送，以便在生产中从系统馈送，并且在单元测试期间，您的测试类通过该输入。

然后，您收集您打算支持的不同场景的样本，并通过练习每个场景的不同单元测试来提供这些样本。

如果您必须更改代码以处理新场景，我认为单元测试的价值将会体现出来。当您进行更改时，您将确信旧方案不会中断。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T02:41:39.727

> 在这种情况下单元测试值得吗？

不一定：尤其是对于单人团队，我认为对比“单元”更大的东西进行自动化测试可能就足够了……更多细节请参见“**[应该测试内部实现，还是只测试公共行为？](https://stackoverflow.com/questions/856115)** ”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T02:24:31.260

单元测试仍然可以在单人表演中提供价值。它使您对模块的功能和正确性（在某种程度上）充满信心。但是可能需要一些设计注意事项来帮助使测试更适用于您的代码。模块化有很大的不同，特别是如果结合某种依赖注入，而不是紧密耦合。这允许协作者的测试版本用于单独测试模块。在您的情况下，模拟文件系统对象可以返回一组可预测的数据，因此可以评估您的过滤和标准代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T02:27:36.980

回归测试的价值通常要等到自动化之后才能实现。一旦完成，事情就会变得容易得多。

这意味着您必须能够从已知位置开始（如果您在文件上生成 MD5，则每次都必须从相同的文件开始）。然后成功运行一次，您可以在其中保存输出 - 这就是基线。

从那时起，回归测试就是一个简单的按钮工作。开始您的测试，收集输出并将其与您已知的基线进行比较（当然，如果输出发生变化，您需要手动检查它，或者在将其保存为新基线之前使用另一个独立的脚本）。

请记住回归测试的想法是捕捉新代码引入的任何错误（即回归软件）。这不是测试新代码的功能。

即使作为一个单人开发团队，您越能将其自动化，效果就越好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T02:24:44.240

当您编写代码时，您是否在执行过程中对其进行了测试？这些测试可以写入自动化脚本，这样当您必须在 2 个月内做出更改时，您可以重新运行所有这些测试以确保您没有退步。

根据我的经验，回归的机会会急剧增加，具体取决于您完成第 1 版并开始编码第 2 版之后的时间，因为您通常会忘记它在不同条件下如何工作的细微差别 - 您的单元测试是一种编码这些细微差别的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T02:27:05.747

针对文件系统的集成测试是值得的。只要确保它完成了它需要做的事情。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T02:30:18.767

1.  **单元测试在单人车间场景中有价值吗？**绝对地！没有什么比能够完全自信地重构代码更好的了，因为您没有破坏任何东西。

2.  **我如何对此进行单元测试？**模拟系统调用，然后测试其余的逻辑。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-26T03:45:05.163

> 我质疑我编写的代码测试的价值

好吧，现在确实如此，但在一年后，你会成为你，一个比你编写的软件开发经验多一年的开发人员——现在，经验和知识较少的开发人员（相比之下）。您是否不希望对那个经验不足的人（一年前的您）编写的代码进行适当的测试，以便您可以放心地进行更改，确保没有任何问题？

# c# - 有没有办法在不安装 DirectX SDK 的情况下在 C# 中播放音频片段？

> ID：908669
> 
> 赞同：4
> 
> 时间：2009-05-26T02:20:27.010
> 
> 标签：c#, audio, audio-player

对于一个学校项目，我需要创建一个程序，如果它可以包含一些声音效果会很好。我们正在使用 C#（和 Visual C# Express Edition 2008 版）对我们的程序进行编码，我想知道是否有办法在不安装 DirectX SDK 的情况下播放短音频文件。

在我们学校的计算机上，我们没有足够的权限来安装任何 SDK，我们必须使用这些计算机进行开发。有没有什么方法可以在没有 DirectX SDK 的情况下播放音频文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T02:28:08.710

您可以使用[System.Media.SoundPlayer](http://msdn.microsoft.com/en-us/library/system.media.soundplayer.aspx)，但它只适用于 wav。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T02:42:00.290

您也可以使用语音引擎 (.net3) 添加音效！
好玩好玩好玩！

添加对 System.Speech dll 的引用

```
using System.Speech;

System.Speech.Synthesis.SpeechSynthesizer ss = new System.Speech.Synthesis.SpeechSynthesizer();  
ss.Rate = 8;  
ss.SpeakAsync("Booom Booom Booom Booom Booom Booom"); 
```

尝试增加/减少速率和音调以获得更多乐趣

# java - 当我尝试编译我的 Java 代码时，为什么会得到“异常；必须被捕获或声明为被抛出”？

> ID：908672
> 
> 赞同：46
> 
> 时间：2009-05-26T02:22:57.050
> 
> 标签：java, exception

考虑：

```
import java.awt.*;

import javax.swing.*;
import java.awt.event.*;
import javax.crypto.*;
import javax.crypto.spec.*;
import java.security.*;
import java.io.*;

public class EncryptURL extends JApplet implements ActionListener {

    Container content;
    JTextField userName = new JTextField();
    JTextField firstName = new JTextField();
    JTextField lastName = new JTextField();
    JTextField email = new JTextField();
    JTextField phone = new JTextField();
    JTextField heartbeatID = new JTextField();
    JTextField regionCode = new JTextField();
    JTextField retRegionCode = new JTextField();
    JTextField encryptedTextField = new JTextField();

    JPanel finishPanel = new JPanel();

    public void init() {

        //setTitle("Book - E Project");
        setSize(800, 600);
        content = getContentPane();
        content.setBackground(Color.yellow);
        content.setLayout(new BoxLayout(content, BoxLayout.Y_AXIS));

        JButton submit = new JButton("Submit");

        content.add(new JLabel("User Name"));
        content.add(userName);

        content.add(new JLabel("First Name"));
        content.add(firstName);

        content.add(new JLabel("Last Name"));
        content.add(lastName);

        content.add(new JLabel("Email"));
        content.add(email);

        content.add(new JLabel("Phone"));
        content.add(phone);

        content.add(new JLabel("HeartBeatID"));
        content.add(heartbeatID);

        content.add(new JLabel("Region Code"));
        content.add(regionCode);

        content.add(new JLabel("RetRegionCode"));
        content.add(retRegionCode);

        content.add(submit);

        submit.addActionListener(this);
    }

    public void actionPerformed(ActionEvent e) {

        if (e.getActionCommand() == "Submit"){

            String subUserName = userName.getText();
            String subFName = firstName.getText();
            String subLName = lastName.getText();
            String subEmail = email.getText();
            String subPhone = phone.getText();
            String subHeartbeatID = heartbeatID.getText();
            String subRegionCode = regionCode.getText();
            String subRetRegionCode = retRegionCode.getText();

            String concatURL =
                "user=" + subUserName + "&f=" + subFName +
                "&l=" + subLName + "&em=" + subEmail +
                "&p=" + subPhone + "&h=" + subHeartbeatID +
                "&re=" + subRegionCode + "&ret=" + subRetRegionCode;

            concatURL = padString(concatURL, ' ', 16);
            byte[] encrypted = encrypt(concatURL);
            String encryptedString = bytesToHex(encrypted);
            content.removeAll();
            content.add(new JLabel("Concatenated User Input -->" + concatURL));

            content.add(encryptedTextField);
            setContentPane(content);
        }
    }

    public static byte[] encrypt(String toEncrypt) throws Exception{
        try{
            String plaintext = toEncrypt;
            String key = "01234567890abcde";
            String iv = "fedcba9876543210";

            SecretKeySpec keyspec = new SecretKeySpec(key.getBytes(), "AES");
            IvParameterSpec ivspec = new IvParameterSpec(iv.getBytes());

            Cipher cipher = Cipher.getInstance("AES/CBC/NoPadding");
            cipher.init(Cipher.ENCRYPT_MODE, keyspec, ivspec);
            byte[] encrypted = cipher.doFinal(toEncrypt.getBytes());

            return encrypted;
        }
        catch(Exception e){
        }
    }

    public static byte[] decrypt(byte[] toDecrypt) throws Exception{
        String key = "01234567890abcde";
        String iv = "fedcba9876543210";

        SecretKeySpec keyspec = new SecretKeySpec(key.getBytes(), "AES");
        IvParameterSpec ivspec = new IvParameterSpec(iv.getBytes());

        Cipher cipher = Cipher.getInstance("AES/CBC/NoPadding");
        cipher.init(Cipher.DECRYPT_MODE, keyspec, ivspec);
        byte[] decrypted = cipher.doFinal(toDecrypt);

        return decrypted;
    }

    public static String bytesToHex(byte[] data) {
        if (data == null)
        {
            return null;
        }
        else
        {
            int len = data.length;
            String str = "";
            for (int i=0; i<len; i++)
            {
                if ((data[i]&0xFF) < 16)
                    str = str + "0" + java.lang.Integer.toHexString(data[i]&0xFF);
                else
                    str = str + java.lang.Integer.toHexString(data[i]&0xFF);
            }
            return str;
        }
    }

    public static String padString(String source, char paddingChar, int size)
    {
        int padLength = size-source.length() % size;
        for (int i = 0; i < padLength; i++) {
            source += paddingChar;
        }
        return source;
    }
} 
```

我收到一个未报告的异常：

```
java.lang.Exception; must be caught or declared to be thrown
byte[] encrypted = encrypt(concatURL); 
```

也：

```
.java:109: missing return statement 
```

我该如何解决这些问题？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-26T02:36:54.293

你所有的问题都源于此

```
byte[] encrypted = cipher.doFinal(toEncrypt.getBytes());
return encrypted; 
```

它们包含在 try、catch 块中，问题是如果程序发现异常，您不会返回任何内容。像这样（根据您的程序逻辑对其进行修改）：

```
public static byte[] encrypt(String toEncrypt) throws Exception{
    try{
        String plaintext = toEncrypt;
        String key = "01234567890abcde";
        String iv = "fedcba9876543210";

        SecretKeySpec keyspec = new SecretKeySpec(key.getBytes(), "AES");
        IvParameterSpec ivspec = new IvParameterSpec(iv.getBytes());

        Cipher cipher = Cipher.getInstance("AES/CBC/NoPadding");
        cipher.init(Cipher.ENCRYPT_MODE,keyspec,ivspec);
        byte[] encrypted = cipher.doFinal(toEncrypt.getBytes());

        return encrypted;
    } catch(Exception e){
        return null;            // Always must return something
    }
} 
```

对于第二个，您必须从*encrypt*方法调用中捕获异常，如下所示（也可以根据您的程序逻辑对其进行修改）：

```
public void actionPerformed(ActionEvent e)
  .
  .
  .
    try {
        byte[] encrypted = encrypt(concatURL);
        String encryptedString = bytesToHex(encrypted);
        content.removeAll();
        content.add(new JLabel("Concatenated User Input -->" + concatURL));

        content.add(encryptedTextField);
    setContentPane(content);
    } catch (Exception exc) {
        // TODO: handle exception
    }
} 
```

您必须从中吸取的教训：

*   具有返回类型的方法必须**始终**返回该类型的对象，我的意思是在所有可能的情况下
*   **必须始终**处理所有已检查的异常

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-26T03:30:30.317

问题出在这种方法中：

```
 public static byte[] encrypt(String toEncrypt) throws Exception{ 
```

这是***方法签名***，它几乎说：

*   方法名称是什么：**加密**
*   它接收什么参数：一个名为**toEncrypt的字符串**
*   它的访问修饰符：**public static**
*   以及它在调用时是否会**抛出**异常。

在这种情况下，方法签名表明当调用此方法时“可能”会抛出“Exception”类型的异常。

```
 ....
    concatURL = padString(concatURL, ' ', 16);
    byte[] encrypted = encrypt(concatURL); <-- HERE!!!!!
    String encryptedString = bytesToHex(encrypted);
    content.removeAll();
    ...... 
```

所以编译器说：要么用 try/catch 构造包围它，要么声明方法（在哪里使用）来自己抛出“异常”。

真正的问题是“加密”方法定义。任何方法都不应该返回“异常”，因为它太通用并且可能隐藏一些其他[类型的异常，](https://stackoverflow.com/questions/528917/why-dont-you-have-to-explicitly-declare-that-you-might-throw-some-built-in-excep/528942#528942)更好的是有一个特定的异常。

试试这个：

```
public static byte[] encrypt(String toEncrypt) {
    try{
      String plaintext = toEncrypt;
      String key = "01234567890abcde";
      String iv = "fedcba9876543210";

      SecretKeySpec keyspec = new SecretKeySpec(key.getBytes(), "AES");
      IvParameterSpec ivspec = new IvParameterSpec(iv.getBytes());

      Cipher cipher = Cipher.getInstance("AES/CBC/NoPadding");
      cipher.init(Cipher.ENCRYPT_MODE,keyspec,ivspec);
      byte[] encrypted = cipher.doFinal(toEncrypt.getBytes());

      return encrypted;
    } catch ( NoSuchAlgorithmException nsae ) { 
        // What can you do if the algorithm doesn't exists??
        // this usually won't happen because you would test 
        // your code before shipping. 
        // So in this case is ok to transform to another kind 
        throw new IllegalStateException( nsae );
    } catch ( NoSuchPaddingException nspe ) { 
       // What can you do when there is no such padding ( whatever that means ) ??
       // I guess not much, in either case you won't be able to encrypt the given string
        throw new IllegalStateException( nsae );
    }
    // line 109 won't say it needs a return anymore.
  } 
```

基本上在这种特殊情况下，您应该确保系统中的加密包可用。

Java 需要对加密包进行扩展，因此，异常被声明为“已检查”异常。让您在他们不存在时处理。

在这个小程序中，如果加密包不可用，您将无法执行任何操作，因此您可以在“开发”时进行检查。如果在您的程序运行时抛出这些异常是因为您在“开发”中做错了什么，那么 RuntimeException 子类更合适。

最后一行不再需要 return 语句，在第一个版本中，您捕获了异常并且什么都不做，这是错误的。

```
try { 
    // risky code ... 
} catch( Exception e ) { 
    // a bomb has just exploited
    // you should NOT ignore it 
} 

// The code continues here, but what should it do??? 
```

如果代码要失败，最好[快速失败](http://en.wikipedia.org/wiki/Fail-fast)

以下是一些相关的答案：

*   [在 Java 中捕获异常](https://stackoverflow.com/questions/534718/catching-exceptions-in-java/534939#534939)

*   [何时选择已检查和未检查的异常](https://stackoverflow.com/questions/27578/when-to-choose-checked-and-unchecked-exceptions)

*   [为什么你不必明确声明你可能会在 Java 中抛出一些内置异常？](https://stackoverflow.com/questions/528917/why-dont-you-have-to-explicitly-declare-that-you-might-throw-some-built-in-excep/528942#528942)

*   [RuntimeException 以外的异常](https://stackoverflow.com/questions/462501/exception-other-than-runtimeexception/462745#462745)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-26T02:29:55.290

第一个错误

> java.lang.异常；必须被捕获或声明被抛出 byte[] encrypted = encrypt(concatURL);

意味着您的方法抛出了一个未由您调用它`encrypt`的方法处理或声明的异常。[在Java 异常教程](http://java.sun.com/docs/books/tutorial/essential/exceptions/)`actionPerformed`中阅读有关它的所有内容。

您有几个选项可供您选择以获取要编译的代码。

*   您可以`throws Exception`从您的`encrypt`方法中删除并*实际处理*内部的异常`encrypt`。
*   您可以从方法中删除 try/catch 块`encrypt`并将`throws Exception`异常处理块添加到您的`actionPerformed`方法中。

通常最好在最低级别处理异常，而不是将其传递到更高级别。

第二个错误只是意味着您需要向包含第 109 行的任何方法添加一个 return 语句（`encrypt`在这种情况下也是 ）。方法中有一个 return 语句，但如果抛出异常，它可能无法到达，所以你要么需要在 catch 块中返回，要么从 中删除 try/catch `encrypt`，正如我之前提到的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T02:43:38.977

您需要决定如何处理`encrypt`方法抛出的异常。

目前，`encrypt`声明为`throws Exception`- 但是，在方法的主体中，异常在 try/catch 块中被捕获。我建议你：

*   从内部删除`throws Exception`子句`encrypt`并处理异常（**至少考虑编写日志消息**）；或者，
*   从 的主体中删除 try/catch 块`encrypt`，并用 try/catch 包围对的调用*（*`encrypt`即在 中`actionPerformed`）。

关于您所指的编译错误：如果在 的块中引发了异常，则`try`该块完成`encrypt`后不会返回任何内容`catch`。您可以通过最初将返回值声明为`null`：

```
public static byte[] encrypt(String toEncrypt) throws Exception{
  byte[] encrypted = null;
  try {
    // ...
    encrypted = ...
  }
  catch(Exception e){
    // ...
  }
  return encrypted;
} 
```

然而，如果你能纠正更大的问题（异常处理策略），这个问题就会自行解决——特别是如果你选择了我建议的第二个选项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T02:31:56.393

在`actionPerformed(ActionEvent e)`你的调用`encrypt()`中，它被声明为 throw `Exception`。但是，`actionPerformed`既没有捕获这个异常（在调用周围使用 try/catch `encrypt()`），也没有声明它`Exception`自己抛出。

`encrypt`但是，您的方法并没有真正抛出`Exception`. 它吞下所有异常，甚至没有记录投诉。（糟糕的做法和糟糕的作风！）

此外，您的`encrypt`方法执行以下操作：

```
public static byte[] encrypt(String toEncrypt) throws Exception {
  try{
    ....
    return encrypted; // HERE YOU CORRECTLY RETURN A VALUE
  } catch(Exception e) {
  }
  // YOU DO NOT RETURN ANYTHING HERE
} 
```

也就是说，如果你确实捕获了任何异常，你会默默地丢弃它，然后从你的方法的底部掉下来，`encrypt`而实际上没有返回任何东西。这不会编译（如您所见），因为声明为返回值的方法必须为每个可能的代码路径返回值或抛出异常。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T02:33:26.267

在您的“加密”方法中，您应该摆脱 try/catch，而是在您调用 encrypt 的位置（在“actionPerformed”内）添加一个 try/catch，或者在 encrypt 内的 catch 内返回 null（这是第二个错误。

# linux - 仅解压缩特定扩展名

> ID：908679
> 
> 赞同：8
> 
> 时间：2009-05-26T02:25:31.773
> 
> 标签：linux, file, archive, unzip

我有一个包含 .jpg、.png、.gif 图像的 zip 档案的目录。我想解压缩每个存档，只拍摄图像并将它们放在一个带有存档名称的文件夹中。

所以：

```
files/archive1.zip
files/archive2.zip
files/archive3.zip
files/archive4.zip 
```

打开 archive1.zip - 获取 sunflower.jpg、rose_sun.gif。创建一个文件夹 files/archive1/ 并将图像添加到该文件夹​​，因此 files/archive1/folder1.jpg、files/archive1/rose_sun.gif。对每个存档执行此操作。

我真的不知道如何做到这一点，欢迎所有建议。我有 600 多个档案，自动解决方案将是救命稻草，最好是 linux 解决方案。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2016-03-24T01:44:29.580

**简而言之**

您可以使用单行查找 + 解压缩来完成此操作。

```
find . -name "*.zip" -type f -exec unzip -jd "images/{}" "{}" "*.jpg" "*.png" "*.gif" \; 
```

**详细地**

`unzip`允许您指定所需的文件：

```
unzip archive.zip "*.jpg" "*.png" "*.gif" 
```

和`-d`一个目标目录：

```
unzip -d images/ archive.zip "*.jpg" "*.png" "*.gif" 
```

将其与 a 结合使用`find`，您可以提取所有 zip 中的所有图像：

```
find . -name "*.zip" -type f -exec unzip -d images/ {} "*.jpg" "*.png" "*.gif" \; 
```

使用`unzip -j`垃圾提取zip的内部目录结构，我们可以在一个命令中完成所有操作。这为您提供了由您希望作为单行的 zip 名称分隔的平面图像列表。

```
find . -name "*.zip" -type f -exec unzip -jd "images/{}" "{}" "*.jpg" "*.png" "*.gif" \; 
```

一个限制是`unzip -d`不会创建超过一个新级别的目录，所以`mkdir images`首先。享受。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-26T02:34:07.013

[7zip](http://www.7-zip.org/)可以做到这一点，并且有一个[Linux 版本](http://sourceforge.net/projects/p7zip/)。

```
mkdir files/archive1
7z e -ofiles/archive1/ files/archive1.zip *.jpg *.png *.gif 
```

（刚刚测试过，它有效。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T02:36:08.053

您可以使用 zip 库编写程序。如果您使用 Mono，则可以使用[DotNetZip](http://dotnetzip.codeplex.com)。

代码如下所示：

```
foreach (var archive in listOfZips)
{
    using (var zip = ZipFile.Read(archive)
    {
        foreach (ZipEntry e in zip)
        {
            if (IsImageFile(e.FileName))
            {
                e.FileName = System.IO.Path.Combine(archive.Replace(".zip",""), 
                                  System.IO.Path.GetFileName(e.FileName));
                e.Extract("files");
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T02:39:09.280

类似于以下内容：

```
#!/bin/bash
cd ~/basedir/files
for file in *.zip ; do
    newfile=$(echo "${file}" | sed -e 's/^files.//' -e 's/.zip$//')
    echo ":${newfile}:"
    mkdir tmp
    rm -rf "${newfile}"
    mkdir "${newfile}"
    cp "${newfile}.zip" tmp
    cd tmp
    unzip "${newfile}.zip"
    find . -name '*.jpg' -exec cp {} "../${newfile}" ';'
    find . -name '*.gif' -exec cp {} "../${newfile}" ';'
    cd ..
    rm -rf tmp
done 
```

这是经过测试的，将处理文件名中的空格（zip 文件和提取的文件）。如果 zip 文件在不同的目录中具有相同的文件名，则可能会发生冲突（如果要展平目录结构，则无法避免这种情况）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T02:42:47.323

Perl 的[Archive-Zip](http://search.cpan.org/perldoc?Archive::Zip "存档-Zip")是一个很好的压缩/解压缩库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-08T06:47:45.420

这是我对第一个答案的看法......

```
#!/bin/bash
cd files
for zip_name in *.zip ; do
    dir_name=$(echo "${zip_name}" | sed -e 's/^files.//' -e 's/.zip$//')
    mkdir ${dir_name}
    7z e -o${dir_name}/ ${zip_name} *.jpg *.png *.gif
done 
```

或者，如果您只想使用常规解压缩命令...

```
unzip -d ${dir_name}/ ${zip_name} *.jpg *.png *.gif 
```

我还没有测试过这个，但它应该可以工作......或者类似的东西。绝对比第一个解决方案更有效。:)

希望这可以帮助！

# java - JAR 文件无法在 Mac 上打开

> ID：908680
> 
> 赞同：4
> 
> 时间：2009-05-26T02:25:47.687
> 
> 标签：java, macos, class, jar

我一直试图在我的 Mac 上打开一个 JAR 文件，但没有成功。它说无法打开 JAR 文件，并要求我在控制台中查找任何错误消息。这是控制台消息。我怀疑问题本身就在第一行，但我不是软件背景，所以不知道这是否足以让任何了解 Java 的人说出问题所在。我确实更新了我的软件，所以我假设我有最新版本的 Java，虽然我不知道如何 100% 确保 - Java.com 网站只是告诉我更新我的 Mac 上的整体软件并说会还要照顾 Java 的最新版本。请帮忙！

```
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079] Exception in thread "main"  
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079] java.lang.UnsupportedClassVersionError: Bad version number in .class file 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.lang.ClassLoader.defineClass1(Native Method) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.lang.ClassLoader.defineClass(ClassLoader.java:675) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.net.URLClassLoader.defineClass(URLClassLoader.java:260) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.net.URLClassLoader.access$100(URLClassLoader.java:56) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.net.URLClassLoader$1.run(URLClassLoader.java:195) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.security.AccessController.doPrivileged(Native Method) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.net.URLClassLoader.findClass(URLClassLoader.java:188) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.lang.ClassLoader.loadClass(ClassLoader.java:316) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:280) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.lang.ClassLoader.loadClass(ClassLoader.java:251) 
5/26/09 7:48:01 AM [0x0-0x72072].com.apple.JarLauncher[1079]  at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:374) 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-26T09:55:09.210

当 JVM 遇到不受支持的类版本时，会引发上述异常。当 JVM 遇到为*以后*的JVM 构建的类时，就会发生这种情况。所以你需要升级你的VM，然后改变你的默认Java。

以下是更改默认值的方法：

在 Spotlight 中键入“java 首选项”。您将看到“Java 首选项”实用程序。运行它，您可以将默认 Java 实例更改为您需要的（可能是 Java 6）。

编辑：该实用程序位于应用程序/实用程序/Java 中。不过，使用 Spotlight 似乎更容易找到它！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-26T02:27:23.390

我猜 JAR 需要 Java 6；大多数 Mac 只安装了 Java 5。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-26T02:30:57.970

`UnsupportedClassVersionError`- 这是你的罪魁祸首。类文件是在比您尝试运行它的 JRE 更高版本的 JDK 上生成的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T03:58:50.143

目前 Mac 附带 Java 1.5。可以在此处为 64 位 Intel Mac 下载 Java 1.6：http: [//support.apple.com/downloads/Java_for_Mac_OS_X_10_5_Update_1](http://support.apple.com/downloads/Java_for_Mac_OS_X_10_5_Update_1)。来自[http://support.apple.com/kb/HT1856](http://support.apple.com/kb/HT1856)：

*此版本不会更改 Java 的默认版本。此版本仅适用于 Mac OS X 10.5.2 及更高版本，不应安装在早期版本的 Mac OS X 上。此版本仅适用于基于 Intel 的 64 位 Mac，不能在基于 PowerPC 或 32-位基于 Intel 的 Mac。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-29T02:38:00.083

请使用从 Oracle 下载 Java SE Development Kit 8u241

[https://www.oracle.com/java/technologies/javase-jdk8-downloads.html](https://www.oracle.com/java/technologies/javase-jdk8-downloads.html)

您需要在 Oracle 上创建一个帐户，下载将自动开始。

选择 macOS x64 。下载并安装后，您将能够打开您的文件

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-07-14T05:10:31.507

只需右键单击 .jar 文件并使用存档实用程序打开。简单的。存档实用程序的位置：`/System/Library/CoreServices/Archive\ Utility.app`

# iphone - CoreData 相当于 sum...group by

> ID：908692
> 
> 赞同：3
> 
> 时间：2009-05-26T02:29:32.467
> 
> 标签：iphone, core-data

我有以下伪 SQL 架构：

```
table flight
  id int primary key
  date timestamp
  aircraft_id int (foreign key to aircraft.id)

table flight_component
  flight_id int (foreign key to flight.id)
  component_id int (foreign key to component.id)
  duration double 
```

如果我将其转换为使用 CoreData，是否有一种等效的方法可以使用另一个查询谓词来获取每个组件的总持续时间？我认为 SQL 等价物是

```
select component_id, sum(duration)
from flight_component
join flight on (flight_component.flight_id = flight.id)
where flight.date between ? and ?
group by component_id 
```

还是我必须进行查询，然后自己总结所有组件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-26T05:04:54.407

您可以查询@"someArray.@sum"。[在集合运算符](http://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueCoding/Articles/CollectionOperators.html#//apple_ref/doc/uid/20002176-SW7)页面上有一个此类运算符的列表。

# automation - 工作流程系统

> ID：908705
> 
> 赞同：5
> 
> 时间：2009-05-26T02:32:26.207
> 
> 标签：automation, workflow

我刚开始在一家新的通信公司工作，我们正在研究一个工作流/内部网系统来管理工作和流程。

基本上，我们从客户那里接收数据文件，然后通过我们的系统进行处理。

1.  接收数据文件（FTP、电子邮件等）
2.  处理数据文件（具有到文件的数据映射的通用脚本，或定制的 ETL 包）。添加地址值
3.  创建打印流（将处理后的数据文件发送到 postscript / PDF 合成引擎），或创建电子邮件输出
4.  将输出发送到生产车间（复制到打印机输入流、邮寄机器）
5.  处理其他流（例如发送电子邮件/传真，上传到 e-Archive）
6.  更新内部系统（例如仓库库存、发票）

我们还有很多其他的内部业务流程（例如重新处理损坏的输出、处理死/退回的邮件）。

我试图将所有元素分开。有些是现成的（例如打印流组合、电子邮件发送/管理、CRM）。有些将在内部构建（例如，重新处理损坏的输出）。

但是，我正在寻找将它们联系在一起的东西，并将业务工作流程放入其中。例如，调度作业、按顺序启动数据处理任务和管理错误。其中很多都需要人为的步骤。此外，加入 SLA 管理和业务活动监控/报告。

很快一项关键要求是自动文件接收和处理（即目录监视和匹配客户端/应用程序）。

我热衷于易于管理和维护的东西（例如，在工作流程中添加新步骤，或条件逻辑，或其他）。

我意识到这是一项艰巨的工作，目前我们专注于每个单独的组件并实施手动流程，直到我们有一个系统来管理它。我们不想设计一个庞大的定制系统来连接它，而是更愿意考虑购买某种工作流或集成系统。

有什么建议么？我看过 Biztalk，但不确定它是否过分或不适合内部系统。我接触过的另一个产品是 Sagent Automation，但它看起来有点笨拙。

- 编辑 -

忘了提一下，我们现有的技能主要是微软。因此，基于 Microsoft 技术/.Net 的任何内容都将是可取的。但是，如果有很棒的产品，我们不会反对提高技能

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T02:45:49.750

查看 Apache 的[Active MQ](http://activemq.apache.org/)。它实现了 Java 消息服务 1.1 规范、servlet API 上的层，并具有大量可以满足您的要求的特性。您还可以在[Camel](http://camel.apache.org/)上进行分层，它添加了许多[企业集成模式](http://camel.apache.org/enterprise-integration-patterns.html)的丰富实现。

通常，JMS 消息被持久化在事务数据库中，可以将其配置为提供极高程度的容错能力（例如，RAID、主备数据库机器对、事务日志文件的多个副本）。在数据库之上可以运行多台负载平衡的应用服务器机器，运行 Active MQ，为您提供可扩展性和高可用性。我想你会发现如果你使用 Active MQ 作为你的公共消息总线，你可以以一种非常解耦的方式编写你的组件。

在 JMS 中，当消息被消费者出队时，消费进程必须稍后确认消息已成功处理。如果没有及时收到确认，JMS 系统将恢复该消息，以便另一个消费进程可以尝试处理它。这意味着您可以运行应用程序的多个副本以获得可靠性和容错性。

看看本周刚刚发布的 O'Reilly 的[Java 消息服务，第 2 版。](http://oreilly.com/catalog/9780596522049/)

另一种途径是研究[BPEL](http://en.wikipedia.org/wiki/BPEL)（业务流程执行语言）。

**编辑：**我对微软的产品不是很熟悉，但[MSMQ](http://en.wikipedia.org/wiki/Microsoft_Message_Queuing)似乎等同于 JMS。

You *should* be able to use ActiveMQ in a Microsoft environment. They claim to support "[cross language clients](http://activemq.apache.org/cross-language-clients.html)" like "C# and .NET". And even if that should be problematic, since ActiveMQ has a Java servlet-based API for queueing and de-queuing messages, the outside world only has to be able to make HTTP requests to the ActiveMQ server. That should limit the amount of learning your team would have to do. Good luck, this sounds like an awesome project!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T00:06:06.877

SharePoint has a workflow engine that works very well. You can build your workflow using SharePoint designer or Visual Studio 2008\. It uses Windows Workflow, which is similar to BizTalk (if not the same engine), but without BizTalk's other services that may not be necessary for your application.

# javascript - 如何使用 jQuery ajax post 传递多个复选框

> ID：908708
> 
> 赞同：27
> 
> 时间：2009-05-26T02:33:58.353
> 
> 标签：javascript, jquery, html, ajax

如何使用 jQuery ajax post 传递多个复选框

这是ajax函数

```
 function submit_form(){
 $.post("ajax.php", {
 selectedcheckboxes:user_ids,
 confirm:"true"
 },
 function(data){
  $("#lightbox").html(data);
  });
 } 
```

这是我的表格

```
<form>
<input type='checkbox' name='user_ids[]' value='1'id='checkbox_1' />
<input type='checkbox' name='user_ids[]' value='2'id='checkbox_2' />
<input type='checkbox' name='user_ids[]' value='3'id='checkbox_3' />
<input name="confirm" type="button" value="confirm" onclick="submit_form();" />
</form> 
```

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-05-26T04:28:34.223

来自 POST 的 jquery 文档（[第三个示例](http://api.jquery.com/jquery.post/#entry-examples)）：

```
$.post("test.php", { 'choices[]': ["Jon", "Susan"] }); 
```

所以我只会遍历复选框并构建数组。就像是

```
var data = { 'user_ids[]' : []};
$(":checked").each(function() {
  data['user_ids[]'].push($(this).val());
});
$.post("ajax.php", data); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2010-02-03T09:44:45.000

刚刚遇到这个试图找到解决同一问题的方法。为了实现 Paul 的解决方案，我进行了一些调整以使此功能正常运行。

```
var data = { 'venue[]' : []};

$("input:checked").each(function() {
   data['venue[]'].push($(this).val());
}); 
```

简而言之，添加 input:checked 而不是 :checked 将输入到数组中的字段限制为仅表单上的复选框。保罗确实是正确的，`this`需要被封闭为`$(this)`

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-12-01T19:30:20.937

可以使用以下内容，然后分解发布结果`explode(",", $_POST['data']);`以给出结果数组。

```
var data = new Array();
$("input[name='checkBoxesName']:checked").each(function(i) {
    data.push($(this).val());
}); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-07-28T16:47:06.657

这是一种更灵活的方式。

假设这是您的表格。

```
<form>
<input type='checkbox' name='user_ids[]' value='1'id='checkbox_1' />
<input type='checkbox' name='user_ids[]' value='2'id='checkbox_2' />
<input type='checkbox' name='user_ids[]' value='3'id='checkbox_3' />
<input name="confirm" type="button" value="confirm" onclick="submit_form();" />
</form> 
```

这是你下面的jquery ajax ...

```
 // Don't get confused at this portion right here
                // cuz "var data" will get all the values that the form
                // has submitted in the $_POST. It doesn't matter if you 
                // try to pass a text or password or select form element.
                // Remember that the "form" is not a name attribute
                // of the form, but the "form element" itself that submitted
                // the current post method
                var data = $("form").serialize(); 

                $.ajax({
                    url: "link/of/your/ajax.php", // link of your "whatever" php
                    type: "POST",
                    async: true,
                    cache: false,
                    data: data, // all data will be passed here
                    success: function(data){ 
                        alert(data) // The data that is echoed from the ajax.php
                    }
                }); 
```

在您的 ajax.php 中，您尝试 echo 或 print_r 您的帖子以查看其中发生了什么。这应该看起来像这样。只会返回您选中的复选框。如果您没有检查任何内容，它将返回错误。

```
<?php 
    print_r($_POST); // this will be echoed back to you upon success.
    echo "This one too, will be echoed back to you"; 
```

希望这足够清楚。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-30T05:28:40.537

如果您不打算推出自己的解决方案，请查看这个 jQuery 插件：

malsup.com/jquery/form/

它会为您做到这一点，甚至更多。强烈推荐。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-03-20T13:42:11.190

这会更好更容易

```
var arr = $('input[name="user_ids[]"]').map(function(){
  return $(this).val();
}).get();

console.log(arr); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-07-27T17:16:31.353

Paul Tarjan 的以下内容为我工作，

```
var data = { 'user_ids[]' : []};
$(":checked").each(function() {
  data['user_ids[]'].push($(this).val());
});
$.post("ajax.php", data); 
```

但是我**的页面上有多个表单**，它从所有表单中提取了复选框，所以我进行了以下修改，所以它只从一个表单中提取，

```
var data = { 'user_ids[]' : []};
$('#name_of_your_form input[name="user_ids[]"]:checked').each(function() {
  data['user_ids[]'].push($(this).val());
});
$.post("ajax.php", data); 
```

只需将*name_of_your_form*更改为您的表单名称。

我还会提到，如果用户不选中任何框，那么 PHP 中就不会设置数组。我需要知道用户是否未选中所有框，所以我在表单中添加了以下内容，

```
<input style="display:none;" type="checkbox" name="user_ids[]" value="none" checked="checked"></input> 
```

这样，如果没有选中任何框，它仍然会将数组设置为“none”。

# .net - 在内存中 OleDbConnection 到 Excel 文件

> ID：908712
> 
> 赞同：8
> 
> 时间：2009-05-26T02:36:38.927
> 
> 标签：.net, sql, sql-server-2005, excel

我想打开一个 OleDbConnection 到内存中作为 FileStream 的 Excel 文件。有谁知道这是否可行以及如何实现？

大图我想将文件字节传递到 .NET CLR 存储过程中并提取数据。也许有更好的方法来做到这一点，我没有考虑过。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T14:22:41.200

您可以使用[SpreadsheetGear](http://www.spreadsheetgear.com/)从内存中的字节数组或使用 SpreadsheetGear.Factory.GetWorkbookSet().Workbooks.OpenFromMemory(byte[]) / OpenFromStream(System.IO.Stream) 从任何流中打开文件。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T02:46:57.533

[您可以使用VSTO](http://msdn.microsoft.com/en-us/library/d2tx7z6d(VS.80).aspx)提取数据。它有一个[Excel 的对象模型](http://msdn.microsoft.com/en-us/library/microsoft.office.tools.excel(VS.80).aspx)。然后将您想要的内容传递给proc。我认为这比试图让 CLR 存储的过程破译 Excel 文件流更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T02:57:49.570

JP 提供的 VSTO 解决方案绝对是可行的。但是，如果您真的想使用 OleDb 和一些 SQL，请查看[这篇](http://support.microsoft.com/kb/321686)文章：这是一篇 MS 知识库文章，描述了如何使用 OleDb 将数据从 excel 导入 SQLSever。

# javascript - 绘制交互式图表

> ID：908715
> 
> 赞同：0
> 
> 时间：2009-05-26T02:37:22.530
> 
> 标签：javascript, flash, actionscript

我的老板想要绘制本​​地网络，然后，如果您单击其中一台计算机或将鼠标悬停在其中一台计算机上，他想查看 RAM、CPU、操作系统等内容。这必须在浏览器中完成，更多具体来说，Intranet 的 wiki。

我的一位同事建议使用 flash（我是一个完全的菜鸟，但我认为 ActionScript 是什么？）我认为它也可以在 javascript 中完成，但我不知道。不知道什么会更好。

如果可能的话，他希望它是可扩展的，因此稍后添加另一台计算机或编辑值不应该太难，尽管拓扑不应该经常更改。我不知道，这可能取决于我编写一种单独的方式来编辑它。

有什么想法/建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T05:14:39.993

直到最新版本的 Visio（2003 年？）之一，才有一个非常有用的网络发现工具可以构建图表。然后使用 Save As HTML 选项，有许多不同的方法来构建可点击的图表。

我想其他网络制图师也可以这样做。

这是我发现做你想做的最简单的方法。我知道的唯一缺点是 Visio 发现将发送大量数据包。它可以淹没网络。但是，在我看来，如果您的网络容易加载，您想尽快知道。最好有一份工作，你可以随意停止和开始。

不要忘记，您到达的任何流程都应该能够定期重建图表，例如每周或每月一次。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T02:44:39.690

您想要的技术可能称为[HTML Image Map](http://en.wikipedia.org/wiki/Image_map)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T02:55:39.387

购买监控系统可能具有成本效益。

[OpManager](http://www.manageengine.com/products/opmanager/index.html)非常易于使用并提供图形功能。

[Paessler](http://www.paessler.com/prtg)更便宜，仍然很详细，但没有绘图功能。

# windows - 为什么我不能在 Windows 中启动命名 Erlang 节点？

> ID：908718
> 
> 赞同：4
> 
> 时间：2009-05-26T02:40:21.727
> 
> 标签：windows, erlang

我正在尝试使用 Windows XP Home 中的 -sname 选项启动一个命名的 Erlang 节点，但是当我运行 erl 时，它会打印出一条很长的错误消息，我不明白，然后退出：

```
> erl -sname allyourcode
{error_logger,{{2009,5,25},{16,20,57}},"Protocol: ~p: register error: ~p~n",["in
                                                                             et_tcp",{{badmatch,{error,econnrefused}},[{inet_tcp_dist,listen,1},{net_kernel,s
                                                                                                                                                 tart_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,
                                                                                                                                                                                                                      init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2009,5,25},{16,20,57}},crash_report,[[{initial_call,{net_kernel,
                                                                     init,['Argument__1']}},{pid,},{registered_name,[]},{error_info,{exit,{er
                                                                                                                                           ror,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[
                                                                                                                                                                                                                           net_sup,kernel_sup,]},{messages,[]},{links,[#Port,]},{dicti
                                                                                                                                                                                                                                                                                 onary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{st
                                                                                                                                                                                                                                                                                                                                                               ack_size,24},{reductions,490}],[]]}
{error_logger,{{2009,5,25},{16,20,57}},supervisor_report,[{supervisor,{local,net
                                                                       _sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{p
                                                                                                                                                      id,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[allyourcode,shortn
                                                                                                                                                                                                                    ames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2009,5,25},{16,20,57}},supervisor_report,[{supervisor,{local,ker
                                                                       nel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined
                                                                                                                                         },{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent}
                                                                                                                                        ,{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2009,5,25},{16,20,57}},std_info,[{application,kernel},{exited,{s
                                                                               hutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kern
                                                  el,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}) 
```

我想包含 erl_crash.dump 文件，但我不知道这样做的好方法，因为它很长。

起初，我以为我遇到了防火墙问题，因为第一次尝试这样做时，我的防火墙询问我是否会授予不同程序的权限，我做到了；但是，即使禁用了我的防火墙，我仍然遇到同样的问题。

使用 -name 似乎也无济于事。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T12:34:32.837

是的，您甚至可能必须重新启动您的操作系统 - 要检查这是否属实，您也可以简单地启动一个具有不同名称的节点，通常最好使用完全限定名称，例如：

> erl -name rambo@127.0.0.1 -setcookie KILLER

然后，使用以下命令开始另一个：

> erl -name terminator@127.0.0.1 -setcookie KILLER

并尝试 ping 另一个节点：

> net_adm:ping('rambo@127.0.0.1')。

您应该收到一条“乒乓”消息。

下次使用

> 节点（）。

查看所有可见节点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T05:16:41.507

我想你会发现你已经用那个名字启动了一个节点。尝试关闭所有 Erlang 控制台窗口，然后重试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-21T01:03:32.897

1.  您需要确保您没有使用已注册的名称（当然）：这包括 Erlang 已声明的任何名称。

2.  如果您在同一台机器上但在不同的用户下启动，请确保您的 cookie 相同。

# sql-server - 什么时候在 Sql Server 中设置 IS_MEMBER？

> ID：908726
> 
> 赞同：0
> 
> 时间：2009-05-26T02:42:52.033
> 
> 标签：sql-server, sql-server-2005, security

我试图让 IS_MEMBER 在 Sql Server 2005 的 UDF 中工作。

我有一个 Windows 组“Domain\TestGroup”。

我将我的登录名“Domain\Kieran”分配给它。

选择 SUSER_NAME(); 给出“域\基兰”

但选择 IS_MEMBER('Domain\TestGroup'); 返回 NULL。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T04:46:50.920

来自[IS_MEMBER](http://msdn.microsoft.com/en-us/library/ms186271(SQL.90).aspx)的 NULL 答案意味着 SQL Server 无法识别 Windows 组。

它会查看您连接中的登录令牌。它不查询 Active Directory。

从 BOL 链接：

> IS_MEMBER 通过检查由 Windows 创建的访问令牌来确定 Windows 组成员身份。访问令牌不反映用户连接到 SQL Server 实例后对组成员身份所做的更改。

因此，即使 doamin\kieran 在组中，您也可能需要注销并重新登录，以便使用组成员身份更新您的登录令牌。

它应该在您的 UDF 中全部工作（除非您在 UDF 中有 EXECUTE AS USER 或 OWNER）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T05:06:17.320

啊。我想我看到了问题。

我的登录是在 builtin\Administrators 中，它是服务器固定角色 sysadmin 的成员。

因此，我是 sysadmin 的成员，这意味着我是 dbo，不会看到任何角色或组信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T03:02:12.620

检查`ERRORLOG`并查看是否有任何错误表明 SQL Server 服务无法连接到“域”Active Directory。

# web-applications - 如何在 nagios 电子邮件中发送额外信息

> ID：908731
> 
> 赞同：8
> 
> 时间：2009-05-26T02:44:41.907
> 
> 标签：web-applications, monitoring, nagios

我已经设置了一个 nagios 监控并配置了 check_http 插件来检查我的应用程序中的特定 URL。该 url 返回“ok”或错误消息。

当我的 nagios 检测到不“正常”时，它会向我发送一封电子邮件。但是我得到的只是“HTTP CRITICAL - 找不到字符串”。我想在电子邮件中收到的是从我的 URL 返回的实际错误消息。我尝试过使用详细 (-v) 选项。在命令行中，它会返回一个完整的请求，包括我的错误消息，但是 nagios 电子邮件只会向我发送详细响应的第一行。

我想在 nagios 通知中得到的不是*string not found*来获取实际的错误消息。有什么办法可以使用 check_http （或者可能是其他）插件，还是我必须自己写？

**编辑：** 到目前为止，我一直在我的电子邮件通知中使用 $SERVICEOUTPUT$。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-27T15:22:34.433

在您的服务通知命令定义中，您似乎可以使用两个服务输出宏（来自[http://nagios.sourceforge.net/docs/3_0/macrolist.html ）：](http://nagios.sourceforge.net/docs/3_0/macrolist.html)

*   $SERVICEOUTPUT$：上次服务检查（即“Ping OK”）输出的第一行文本。
*   $LONGSERVICEOUTPUT$：上次服务检查的全文输出（第一行除外）。

如果你不成功，我想最简单的方法是为 check_http 编写一个包装器，将你的错误消息放在第一行输出。

# php - 如何打开我无条件打开open_basedir？

> ID：908734
> 
> 赞同：0
> 
> 时间：2009-05-26T02:45:55.210
> 
> 标签：php, open-basedir

这是PHP的问题。我设置了open_basedir，即使我使特定目录可以访问，也无法访问底部层次结构中的文件夹。

例如，当它是说 /home/user1/test/example/ 的层次结构的目录时

open_basedir=.: /home/user1/test/

当我设置在test/文件夹下排列的文件可以打开，但无法打开example/下发布的文件。

open_basedir=.: /home/user1/test/: /home/user1/test/example/

没关系。但 。你能给我一个好主意吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T03:15:59.910

您还需要确保在 apache httpd.conf 中正确设置了访问权限

# manual - fcntl问题没有手动输入

> ID：908735
> 
> 赞同：2
> 
> 时间：2009-05-26T02:46:37.767
> 
> 标签：manual, manpage, fcntl

当我使用 `man fcntl' 得到消息：

```
No manual entry for fcntl 
```

需要安装哪个pkg？

附言。我使用debian。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T02:52:10.190

这并不能直接回答您的问题，但是：我自己只是使用互联网：这是[google](http://www.google.com/search?q=man+fcntl&ie=utf-8&oe=utf-8&aq=t&rls=com.ubuntu:en-US:unofficial&client=firefox-a)中“man fcntl”的[第一个搜索结果](http://www.manpagez.com/man/2/fcntl/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T02:52:29.083

`fcntl`是一个标准的 C 库函数，因此它应该是您的开发包之一。然而，我很久以前就放弃了在 UNIX 机器上使用 man，尝试在 Google 中输入“man fcntl”（带引号）以获取在线版本。

只是不要这样做来试图弄清楚它`man`本身是如何工作的。在 Google 中输入“man man”会返回一些有趣的结果（工作不安全）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T02:56:51.490

在 Debian 中，这些手册页在 manpages-dev 包中可用。

# ruby-on-rails - Ruby on Rails 应用程序必须使用 cookie 吗？

> ID：908738
> 
> 赞同：3
> 
> 时间：2009-05-26T02:47:23.523
> 
> 标签：ruby-on-rails

Rails 依赖于 cookie 是真的吗？似乎 flash 是会话的一部分，并且会话使用 cookie ......所以当我在 Firefox 中禁用 cookie 时，一个正在运行的 Rails 应用程序显示

> [错误] ActionController::InvalidAuthenticityToken

那么，对于一个 RoR 应用程序来说，cookie 是必须的，这是真的吗？

**更新：**或者，让 Rails 应用程序再次运行，最简单的方法是什么？（如果它只是一台服务器（Apache 运行 mod_rails），那么它更容易吗？）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T03:01:32.170

它们不是强制性的，但有些事情你不能没有 cookie。[您可以按照此处](http://ryandaigle.com/articles/2007/9/24/what-s-new-in-edge-rails-better-cross-site-request-forging-prevention)所述关闭真实性令牌。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T04:29:25.207

使用 cookie 不是强制性的，但它是 Rails 2.x 以上的默认设置。当您尝试将 cookie 存储在多个服务器的内存中时（并且您遇到诸如粘性会话、丢失用户数据等问题），使用 cookie 可以作为一种简单的解决方案来解决一些更困难的问题。

您可以设置 rails 存储会话数据的位置；那是闪光灯和与特定用户相关的任何东西。在 environment.rb 中，您可以使用*config.action_controller.session_store*配置存储会话的位置。选项有*：:cookie_store、:active_record_store、:p_store、:drb_store、:mem_cache_store 或:memory_store*。

如果您将该选项注释掉或从 environemnt.rb 中删除，则 cookie_store 是默认值。它也是最通用的。如果您有多个服务器，则对用户的一个请求可能会进入一个服务器，而下一个请求可能会进入另一台服务器。在这种情况下，您不能使用 memory_store，因为第二台服务器不会知道有关当前用户的任何信息。

通过将会话信息存储在加密的 cookie 中，服务器上存储此信息的负载就会减少。唯一的缺点是对服务器的每个请求都需要传递 cookie（通常 <1k），但这与我所经历的任何事情都没有明显区别。

:cookie_store, :mem_cache_store 和 :active_record_store 是最常用的。

# python - Python中的正则表达式替换

> ID：908739
> 
> 赞同：2
> 
> 时间：2009-05-26T02:48:22.040
> 
> 标签：python, regex, timestamp

我有一个包含多个条目的 CSV 文件，每个条目都有 2 个 unix 时间戳格式的日期。

我有一个名为 的方法`convert()`，它接收时间戳并将其转换为`YYYYMMDD`.

现在，由于我在每一行中有 2 个时间戳，我将如何用新值替换每个时间戳？

编辑：为了澄清，我想将每个出现的时间戳转换为`YYYYMMDD`格式。这就是困扰我的地方，因为它`re.findall()`返回了一个列表。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T02:53:37.660

如果你知道替换：

```
p = re.compile( r',\d{8},')
p.sub( ','+someval+',', csvstring ) 
```

如果是格式更改：

```
p = re.compile( r',(\d{4})(\d\d)(\d\d),')
p.sub( r',\3-\2-\1,', csvstring ) 
```

编辑：对不起，刚刚意识到你说python，上面修改过

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T03:20:59.307

我假设“unix时间戳格式化日期”是指自纪元以来的秒数。这假定文件中的每个数字都是 UNIX 时间戳。如果不是这种情况，您需要调整正则表达式：

```
import re, sys

# your convert function goes here

regex = re.compile(r'(\d+)')
for line in sys.stdin:
  sys.stdout.write(regex.sub(lambda m:
  convert(int(m.group(1))), line)) 
```

这从标准输入读取并在找到的每个数字上调用转换。

这里的“技巧”是`re.sub`可以采用一个将匹配对象转换为字符串的函数。我假设您的转换函数需要一个 int 并返回一个字符串，所以我使用 lambda 作为适配器函数来获取匹配的第一组，将其转换为 int，然后将生成的 int 传递给转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T06:55:48.433

无法评论您的问题，但您是否看过 python 的 CSV 模块？ [http://docs.python.org/library/csv.html#module-csv](http://docs.python.org/library/csv.html#module-csv)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T03:55:32.217

我会使用这些方面的东西。很像 Laurence 的响应，但具有您请求的时间戳转换并将文件名作为参数。此代码假定您正在使用最近的日期（2001 年 9 月 9 日之后）。如果您需要更早的日期，请降低 10 到 9 或更少。

```
import re, sys, time

regex = re.compile(r'(\d{10,})')

def convert(unixtime):
  return time.strftime("%Y%m%d", time.gmtime(unixtime))

for line in open(sys.argv[1]):
  sys.stdout.write(regex.sub(lambda m: convert(int(m.group(0))), line)) 
```

编辑：清理代码。

**样本输入**

```
foo,1234567890,bar,1243310263
cat,1243310263,pants,1234567890
baz,987654321,raz,1 
```

**输出**

```
foo,20090213,bar,20090526
cat,20090526,pants,20090213
baz,987654321,raz,1 # not converted (too short to be a recent) 
```

# perl - 如何控制 Perl 的 Data::Dumper 中的变量名？

> ID：908741
> 
> 赞同：11
> 
> 时间：2009-05-26T02:49:48.963
> 
> 标签：perl, data-dumper

我有这个简单的 Perl 脚本：

```
#! /usr/bin/perl -w

use strict;
use Data::Dumper;

my %foo = ( 'abc' => 1 );

print Dumper(\%foo); 
```

它输出：

```
$VAR1 = {
          'abc' => 1
        }; 
```

我如何让它输出这个呢？

```
%foo = (
         'abc' => 1
       ); 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-26T03:08:52.637

```
print Data::Dumper->Dump( [ \%foo ], [ qw(*foo) ] ); 
```

扩展语法采用两个数组引用：一个是要转储的标量，一个是要使用的名称。如果名称以 * 为前缀，并且对应的标量是 arrayref 或 hashref，则生成数组或散列赋值。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-26T03:17:04.010

除了 ysth 的回答，您还可以使用 Ovid 的[Data::Dumper::Names](http://search.cpan.org/dist/Data-Dumper-Names/lib/Data/Dumper/Names.pm)模块。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-12-27T16:24:22.987

```
use Data::Dumper;

$Data::Dumper::Terse = 1;

print '%foo = '.(Dumper \%foo); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-26T14:17:22.567

此外，[Data::Dumper::Simple](http://search.cpan.org/dist/Data-Dumper-Simple/lib/Data/Dumper/Simple.pm)大致做到了这一点。

# objective-c - NSDictionary Objective-C

> ID：908742
> 
> 赞同：3
> 
> 时间：2009-05-26T02:49:53.940
> 
> 标签：objective-c, cocoa

我正在尝试以字符串作为键以以下方式存储数据，并且我想要一个数组作为值。

关键对象

"字母" {'a','b','c','d'}
"数字" {1,2,3,4,5,6,7}

这可能`NSDictionary`在代码中吗？如果是这样，那会是什么样子？我真的很困惑。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-26T03:02:47.003

在代码中执行此操作的一种简单方法（并且只是您可以执行的多种方法之一）：

```
NSMutableDictionary *dict = [NSMutableDictionary dictionary];
[dict setObject:[NSArray arrayWithObjects:@"a", @"b", @"c", @"d", nil] forKey:@"letters"];
[dict setObject:[NSArray arrayWithObjects:[NSNumber numberWithInt:1], [NSNumber numberWithInt:2], [NSNumber numberWithInt:3], [NSNumber numberWithInt:4], nil] forKey:@"numbers"]; 
```

这将创建一个`NSDictionary`带有字符串数组和`NSNumber`对象数组的数组，还有其他创建数组的方法，但这演示了一种基本方法。

根据以下评论：

如果您想一次将一项添加到数组中...

```
 // create the dictionary and add the letters and numbers mutable arrays
  NSMutableDictionary *dict = [NSMutableDictionary dictionary];
  NSMutableArray *letters = [NSMutableArray array];
  NSMutableArray *numbers = [NSMutableArray array];
  [dict setObject:letters forKey:@"letters"];
  [dict setObject:numbers forKey:@"numbers"];

  // add a letter and add a number
  [[dict objectForKey:@"letters"] addObject:@"a"];
  [[dict objectForKey:@"numbers"] addObject:[NSNumber numberWithInt:1]];  
  // This now has an NSDictionary (hash) with two arrays, one of letters and one 
  // of numbers with the letter 'a' in the letters array and the number 1 in 
  // the numbers array 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-26T03:05:51.957

假设您有一个`NSArray`被调用`letters`和一个被调用`numbers`包含正确值：

```
NSDictionary* dict = [NSDictionary dictionaryWithObjectsAndKeys:
    letters, @"letters",
    numbers, @"numbers",
    nil
]; 
```

`retain`如果您想保留，请确保`dict`使用`alloc`and `initWithObjectsAndKeys`。

有关详细信息，请参阅[NSDictionary API 参考。](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSDictionary_Class/Reference/Reference.html#//apple_ref/doc/uid/20000140-SW10)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T02:53:48.113

您可以将它们表示为属性列表。 [属性列表文档](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man5/plist.5.html)。

```
<dict>
    <key>letters</key>
    <array>
        <string>a</string>
        <string>b</string>
        <string>c</string>
        <string>d</string>
    </array>
    <key>letters</key>
    <array>
        <integer>1</integer>
        <integer>2</integer>
        <integer>3</integer>
        <integer>4</integer>
        <integer>5</integer>
        <integer>6</integer>
        <integer>7</integer>
    </array>
 </dict> 
```

有关如何在 Cocoa 中序列化和反序列化数据的概述，请参阅 Cocoa 的[存档和序列化指南](http://developer.apple.com/documentation/Cocoa/Conceptual/Archiving/index.html)

# c++-cli - 使用来自完全非托管 C++ 应用程序的 .net 程序集？

> ID：908743
> 
> 赞同：1
> 
> 时间：2009-05-26T02:50:00.710
> 
> 标签：c++-cli

有什么方法可以在完全非托管的 C++ 应用程序中引用和使用托管 .net 程序集中的类和方法？（没有/clr）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T02:57:26.933

绝对可以，[来自 CodeProject 的这个 gem](http://www.codeproject.com/KB/mcpp/unmanaged_to_managed.aspx)应该会很有帮助

您需要一个**CCW（COM 可调用包装器）。**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T13:52:36.610

您可以通过 COM 公开 .NET 类并通过 COM 使用这些类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T02:54:45.693

您可以 - 通过托管 CLR。[我在这里](http://blogs.msdn.com/calvin_hsia/archive/2006/08/07/691467.aspx)找到了一组示例代码。不过，我无法知道那里的建议有多好，因为我从来没有这样做过。

# ruby-on-rails - Authlogic 通过 curl 但不是浏览器工作

> ID：908746
> 
> 赞同：3
> 
> 时间：2009-05-26T02:50:46.357
> 
> 标签：ruby-on-rails, authlogic

这可能与 authlogic 一样与 Rails 有很大关系，但我很困惑。如果我使用 curl 请求一个 url，如下所示：

```
curl http://neevor:l3ftcas3@localhost:3000/users/alerts/1.xml 
```

我得到了想要的结果。但是，如果我尝试使用浏览器做同样的事情，我会得到：

```
Redirected to http://192.168.0.49:3000/login
Filter chain halted as [:require_login] rendered_or_redirected. 
```

这是正常的登录页面。

感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T21:02:23.857

你使用的是什么浏览器？一些浏览器不允许在这样的 URL 中传递用户名和密码——例如，[IE 已经停止允许这样](http://support.microsoft.com/kb/834489)的 . 我相信 FireFox 也不允许这样做。

# c# - 带有 MemoryStream 的 FileResult 给出空结果..有什么问题？

> ID：908747
> 
> 赞同：20
> 
> 时间：2009-05-26T02:51:12.033
> 
> 标签：c#, asp.net-mvc

我正在使用将 ical 内容序列化为 MemoryStream 或实际上任何类型的流的库来生成 ics 文件（ iCalendar 或 RFC 2445 或您如何称呼它们）。

这是我的代码块：

```
 public ActionResult iCal(int id) {

        MyApp.Event kiEvt = evR.Get(id);

        // Create a new iCalendar
        iCalendar iCal = new iCalendar();

        // Create the event, and add it to the iCalendar
        DDay.iCal.Components.Event evt = iCal.Create<DDay.iCal.Components.Event>();

        // Set information about the event
        evt.Start = kiEvt.event_date;
        evt.End = evt.Start.AddHours(kiEvt.event_duration); // This also sets the duration            
        evt.Description = kiEvt.description;
        evt.Location = kiEvt.place;
        evt.Summary = kiEvt.title;

        // Serialize (save) the iCalendar
        iCalendarSerializer serializer = new iCalendarSerializer(iCal);

        System.IO.MemoryStream fs = new System.IO.MemoryStream();

        serializer.Serialize(fs, System.Text.Encoding.UTF8);

        return File(fs, "text/calendar", "MyApp.wyd."+kiEvt.id+".ics");
    } 
```

我的问题是 fs 包含一些内容，但控制器返回空文件 - 具有正确的 mimetype 和文件名。我很可能在流处理方面遗漏了一些东西，但不知道是什么。

有人可以帮我吗？提前致谢。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-26T02:55:30.107

只是一个猜测：您是否需要在返回[之前](http://msdn.microsoft.com/en-us/library/system.io.memorystream.seek.aspx)返回到流的开头？

```
fs.Seek(0, 0); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-02T21:06:26.927

```
iCalendar iCal = new iCalendar();
foreach (CalendarItem item in _db.CalendarItems.Where(r => r.Start > DateTime.Now && r.Active == true && r.CalendarID == ID).ToList())
{
    Event evt = new Event();
    evt.Start = new iCalDateTime(item.Start);
    evt.End = new iCalDateTime(item.End);
    evt.Summary = "Some title";
    evt.IsAllDay = false;
    evt.Duration = (item.End - item.Start).Duration();
    iCal.Events.Add(evt);
}
// Create a serialization context and serializer factory. 
// These will be used to build the serializer for our object. 
ISerializationContext ctx = new SerializationContext();
ISerializerFactory factory = new DDay.iCal.Serialization.iCalendar.SerializerFactory();
// Get a serializer for our object
IStringSerializer serializer = factory.Build(iCal.GetType(), ctx) as IStringSerializer;
if (serializer == null) return Content("");
string output = serializer.SerializeToString(iCal);
var contentType = "text/calendar";
var bytes = Encoding.UTF8.GetBytes(output);
var result = new FileContentResult(bytes, contentType);
result.FileDownloadName = "FileName.ics";
return result; 
```

# java - 如何签署 Java 小程序以在浏览器中使用？

> ID：908748
> 
> 赞同：41
> 
> 时间：2009-05-26T02:52:05.683
> 
> 标签：java, browser, applet, certificate, self-signed

我正在尝试在我的网站上部署 Java 小程序。我还需要签名，因为我需要访问剪贴板。我已经按照我能找到的所有签名教程进行操作，但没有取得任何成功。这是我到目前为止所做的：

*   在 NetBeans 中编写了一个小程序。它在小程序查看器中运行良好。
*   用它制作了一个 .jar 文件。
*   通过这样做创建了一个证书：

> ```
> keytool -genkey -keyalg rsa -alias myKeyName
> keytool -export -alias myKeyName -file myCertName.crt 
> ```

*   像这样用 jarsigner 签名：

> ```
> jarsigner "C:\my path\myJar.jar" myKeyName 
> ```

*   制作了一个包含以下内容的html文件：

> ```
> <html>
>   <body>
> <applet code="my/path/name/myApplet.class" archive="../dist/myJar.jar"/>
>   </body>
> </html> 
> ```

当我打开那个 html 文件时，我从来没有得到安全确认对话框（因此得到“java.security.AccessControlException：访问被拒绝”错误）。这发生在所有浏览器上。

我错过了一步吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-12-22T03:03:45.260

3个简单的步骤

1.  keytool -genkey -keystore myKeyStore -alias me

2.  keytool -selfcert -keystore myKeyStore -alias me

3.  jarsigner -keystore myKeyStore jarfile.jar 我

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-26T06:51:49.330

也许是因为您在jar 文件*之外打开了一些 .class 文件？*

这样它可能不会显示警告。我尝试这样做，但它仍然向我显示证书警告，并且对于一个简单的情况，它实际上阻止了我从具有分离类的 JAR 访问一个类。

也许您的特定设置或文件组织会导致该行为。如果您可以更详细地进行布局，我们可以提供更好的帮助（或者更确切地说，尝试将所有这些 .class 文件放在另一个签名的 Jar 中并将其添加到存档“...，anotherJar.jar”）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T03:36:13.770

首先，我建议获得一个有效的代码签名证书。[您可以从Thawte](https://www.thawte.com/secure-email/personal-email-certificates/index.html?click=main-nav-products-email)获得免费证书。尽管这些证书通常用于 S/MIME，但它们也适用于代码签名。

第二个选项是将您的自签名证书导入浏览器正在调用的 JRE 的 cacert 文件中。

接下来要检查的是确保您的浏览器正在运行最新的 jar。一种方法是始终增加您的版本号。另一个选项是清除 Java 小程序缓存。我通常也会清除浏览器的缓存，但这不是必需的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T05:08:37.973

你提到：

> 当我打开那个 html 文件时，我从来没有得到安全确认对话框......

您是从本地文件系统打开文件，还是通过 URL 到托管 HTML 文件和 applet jar 的 Web 服务器？这可能就是您没有收到警告的原因。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-03T05:08:37.520

这是一种对 jar 进行签名然后检查所有类文件是否已使用您的密钥库签名的方法。

```
#!/bin/bash
KEYSTORE=/home/user/NetBeansProjects/sign/keystore
FILES=`find /home/user/NetBeansProjects/Project/dist/ -name "*.jar"`
for f in $FILES; 
   do echo password |  /usr/bin/jarsigner -keystore $KEYSTORE -verbose $f myself;
   echo "Signed $f"; 
  /usr/bin/jarsigner -verify -verbose -certs $f | grep X.509 | sort -u;
done 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-26T03:07:40.080

编辑：这个答案是历史性的。JDK9 显然会弃用小程序。在撰写本文时（2017 年 1 月 1 日），您应该签署小程序但不授予它们额外的权限，然后过渡到更新的技术。

我建议你不要签署代码。如果你在玩弄别人的安全，那么你真的应该知道你在做什么。

`JTextComponent`如果足够的话，应该允许复制和粘贴文本。

`jarsigner -verify`将检查您的 jar 是否已签名。您还可以快速查看清单文件和`META-INF/`.

信任证书的弹出对话框可能被禁用。在 Sun 的实现中：打开 Java 控制面板；转到高级选项卡；展开安全节点；前两个复选框应该是“允许用户授予对已签名上下文的权限”和“允许用户授予对来自不受信任机构的内容的权限”。

# php - jQuery+AJAX 删除锚点不起作用

> ID：908756
> 
> 赞同：-1
> 
> 时间：2009-05-26T02:54:57.080
> 
> 标签：php, jquery, ajax, codeigniter

嗨，我正在使用 jQuery 和 Codeigniter。我正在创建一个简单的待办事项列表，可以使用 ajax 添加删除条目。

问题是每当我单击删除锚点时，它都不会删除该条目。顺便说一句，添加条目功能有效。

这是我的代码：

todo_view.php

```
<html>
    <head>Todo List</head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#submit').click(function() {

                var msg = $('#message').val();

                $.post("<?= site_url('todo/add') ?>", {message: msg}, function() {
                    $('#content').load("<?= site_url('todo/view/ajax') ?>");
                    $('#message').val('');
                });
            });

            $('a.delete').click(function() {
                var id = $('input', this).val();
                $.post("<?= site_url('todo/delete') ?>", {todoid: id}, function() {
                    $('#content').load("<?= site_url('todo/view/ajax') ?>");
                });
            });

        });
    </script>
    <body>
        <div id="form">
            <input type="text" name="message" id="message" />
            <input type="submit" name="submit" id="submit" value="Add todo" />
        </div>
        <div id="content">
            <?php $this->load->view('message_list'); ?>
        </div>
    </body>
</html> 
```

message_list.php

```
<ol>
    <?php foreach ($todolist as $todo): ?>
        <li>
        <?php echo $todo->todo; ?> 
        <a href="#" class="delete"><input type="hidden" value="<?=$todo->todoid ?>" />delete</a></li>
    <?php endforeach; ?>
</ol> 
```

为什么它不起作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T05:24:40.747

首先，要跟踪 GET/POST 标头和值，您应该开始使用**[Firebug](http://getfirebug.com/)**（Firefox 的扩展）。真正让您的生活轻松调试 ajax 调用和响应方面。

接下来（有点像 alimango 提到的那样）......最可能的原因是在您的主页的 DOM 已经加载之后正在加载消息列表。jQuery 不会自动将 click 事件绑定到稍后添加的元素。您的点击绑定例程必须在消息列表添加到 DOM 之后调用。现在这并不总是可能的......因为您的列表正在动态获取/更改。

一种解决方案是使用自**jQuery 1.3**以来引入的**[live()](http://docs.jquery.com/Events/live#typefn)**绑定事件函数。这有助于将处理程序绑定到**所有当前和未来**匹配元素的事件（如点击）。也可以绑定自定义事件。有关详细信息，请参阅[http://docs.jquery.com/Events/live#typefn](http://docs.jquery.com/Events/live#typefn)

 ****第二种解决方案是使用**[LiveQuery](http://plugins.jquery.com/project/livequery)** - 一个 jQuery 插件，它“通过绑定事件或自动触发匹配元素的回调来利用 jQuery 选择器的强大功能，即使在页面已加载且 DOM 更新后也是如此。” 您可以从[http://plugins.jquery.com/project/livequery获取它](http://plugins.jquery.com/project/livequery)

干杯，微观世界^地球

# c - 在 C 中将 strsep() 与动态字符串数组一起使用

> ID：908759
> 
> 赞同：1
> 
> 时间：2009-05-26T02:55:40.107
> 
> 标签：c, arrays, string, pointers

我有以下代码：

```
#include <string.h>

int main(void) {
    char *buffer = NULL, **words = NULL, *aPtr = NULL, *sPtr;
    int count = 0;

    buffer = strdup("The quick brown fox jumps over the lazy dog");
    sPtr = buffer;

    do {
        aPtr = strsep(&sPtr, " ");

        words[count++] = ... // missing code
    } while(aPtr);

    return 0;
} 
```

如您在上面看到的，我缺少一些代码...是否有任何一种 strdup() 适用于这种情况？strdup() 函数本身似乎不起作用......如果没有，我怎样才能使这段代码工作？

指针的指针让我头疼...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T03:09:47.300

到目前为止，您还没有分配`words[0]`, `words[1]`, ... 所以使用`strdup`没有帮助。

更糟糕的是，你事先不知道会有多少单词，所以这`malloc`对你需要的空间来说并不是微不足道的。

一种选择是`words`用链表或动态数组替换。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T03:11:27.220

您需要为`words`数组分配空间，例如：

```
 #define MAX_NUM_WORDS 1024
...
/* on the stack */
char* words[MAX_NUM_WORDS];
...
/* or on the heap */
char** words;
if (( words = ( char** )malloc( MAX_NUM_WORDS * sizeof( char* ))) == NULL )
{
    perror( "malloc" );
    exit( 1 );
} 
```

或者更好 - 使用动态数据结构，如单链表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T03:35:07.733

如果只是为了尝试，您可能会使用一些简单的东西：

```
#include <stdio.h>
#include <string.h>

#define MAX_WORDS 100

int main(void) {
    char *buffer, *words[MAX_WORDS], *aPtr;
    int count = 0, i;

    buffer = strdup("The quick brown fox jumps over the lazy dog");
    if (!buffer) return 1;

    do {
        aPtr = strsep(&buffer, " ");
        if (aPtr && count < MAX_WORDS) words[count++] = aPtr;
    } while(aPtr && count < MAX_WORDS);

    for (i = 0; i < count; i++) {
        printf("%s\n", words[i]);   
    }
    return 0;
} 
```

运行它：

```
[macbook:~] jianlin $ ./a.out
The
quick
brown
fox
jumps
over
the
lazy
dog
[macbook:~] jianlin $ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T03:12:20.820

您的第一个问题是您想要一个单词列表 - 您可以通过硬编码单词中的一些限制（N 个单词的数组，每个单词是一个地址）来逃避，但这并不是真正的生产质量。真正的解决方案是有一个列表（可以在内部实现为一个不断增长的数组）

我没有看到 strdup 的问题，但你应该 void strsep，该函数没有好的 API。手动完成 strsep 几乎会更容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T03:29:56.683

您需要一个动态分配的数组。你可以自己动手，但为什么不使用`Seq_T`Dave Hanson 的[C Interfaces and Implementations](http://www.cs.princeton.edu/software/cii)呢？该`Seq_addhi`功能将完全按照您的意愿行事。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-26T18:39:47.187

上面的循环有点笨拙，所以我将其更改为：

```
#include <stdio.h>
#include <string.h>

#define MAX_WORDS 100

int main(void) {
    char *buffer, *words[MAX_WORDS], *aPtr;
    int count = 0, i;

    buffer = strdup("The quick brown fox jumps over the lazy dog");
    if (!buffer) return 1;

    while((aPtr = strsep(&buffer, " ")) && count < MAX_WORDS)
        words[count++] = aPtr;

    for (i = 0; i < count; i++) {
        printf("%s\n", words[i]);   
    }
    return 0;
} 
```

输出是一样的。

# html - 如何链接相同或不同文件夹中的html页面？

> ID：908765
> 
> 赞同：51
> 
> 时间：2009-05-26T02:59:26.260
> 
> 标签：html, anchor

如果它们位于相同或不同的文件夹中而不写完整路径，我如何链接到 html 页面？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-05-26T03:03:20.900

在同一文件夹中，只需使用文件名：

```
<a href="thefile.html">my link</a> 
```

在父文件夹的目录中：

```
<a href="../thefile.html">my link</a> 
```

在子目录中：

```
<a href="subdir/thefile.html">my link</a> 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-26T17:32:05.777

此外，这将上升一个目录，然后返回到另一个子文件夹。

```
<a href = "../subfolder/page.html">link</a> 
```

要上多个目录，您可以这样做。

```
<a href = "../../page.html">link</a> 
```

去根，我用这个

```
<a href = "~/page.html">link</a> 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-05-26T05:55:10.520

另外，如果要引用根目录，可以使用：

```
/ 
```

这将指的是根。因此，假设我们在一个嵌套在几级文件夹中的文件中，并且您想返回到主 index.html：

```
<a href="/index.html">My Index Page</a> 
```

罗伯特对进一步的相对路径解释很准确。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-05-26T03:02:29.983

您可以使用

```
../ 
```

因此，要从 /webroot/site/pages/folder1/myotherpage.htm 进入文件夹 /webroot/site/pages/folder2/mypage.htm，您的链接将如下所示：

```
<a href="../folder2/mypage.htm">Link to My Page</a> 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-26T03:02:28.780

使用相对路径

主页可能是： **/index.html**

二级页面： **/otherFolder/otherpage.html**

链接是这样的：

```
<a href="/otherFolder/otherpage.html">otherpage</a> 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-09-22T18:02:56.523

如果您想链接到根目录，您可以使用

`/`， 或者`/index.html`

如果您想链接到同一目录中的文件，只需输入文件名

```
<a href="/employees.html">Employees Click Here</a> 
```

要移回文件夹，您可以使用

```
../ 
```

要从根目录链接到员工目录中的索引页面，您可以这样做

```
<a href="../employees/index.html">Employees Directory Index Page</a> 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-26T06:06:29.437

我会提醒您：如果您使用的是绝对路径，那么您的应用程序不能安装在服务器的“子目录”中！

例如， http: [//yourserver.com/yourapp](http://yourserver.com/yourapp)可能会工作，但[http://myserver.com/apps/yourapp](http://myserver.com/apps/yourapp)不会！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-01-14T01:31:27.710

简短的回答：

**.** 用于当前目录

**..**用于上层目录，如`cd ..`shell 上的命令。

简单而棘手，我写这个答案主要是为了自己不要忘记下次。

```
ademSite/
├── index.html
└── style.css 
```

中的*CSS*链接`index.html`：

`<link rel="stylesheet" href="style.css">`或者 `<link rel="stylesheet" href="./style.css">`

```
ademSite/
├── index.html
└── stylefiles
    └── style.css 
```

这种情况应该是：

`<link rel="stylesheet" href="stylefiles/style.css">`或者`<link rel="stylesheet" href="./stylefiles/style.css">`

```
├── html
│   └── index.html
└── stylefiles
    └── style.css 
```

在这种情况下，路径***必须***是： `<link rel="stylesheet" href="../stylefiles/style.css">`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-05-07T03:40:16.163

利用

```
../ 
```

例如，如果您的文件，假设图像`folder1`在`folder2` 您以这种方式找到它

```
../folder1/folder2/image 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-28T17:08:46.037

下面的答案是我创建的将 html 内容从另一个共享驱动器链接到我将发送给经理的 html 页面。当然，路径与您的使用相关，但在我的情况下，我只会将 html 发送给他们，而从加载运行器动态更新的所有其他内容都会为我更新。节省大量纸张，并且他们可以按照自己认为合适的方式处理数字，而不仅仅是硬拷贝。

```
SRC="file://///shareddrive/shareddrive-folder/username/scripting/testReport\contents.html" NAME="contents_frame" title="Table of Contents" 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-03-21T17:26:55.507

对于 ASP.NET，这在开发和部署方面对我有用：

```
<a runat="server" href="~/Subfolder/TargetPage">TargetPage</a> 
```

使用`runat="server"`和`href="~/"`是进入根目录的关键。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-06-16T02:45:15.237

href="./page.htm" 用于同一目录

href="../page.htm" 父目录

href="~/page.htm" 根目录或最上层目录。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2018-04-10T15:06:33.793

这对我有用`<a href="preferedfile name.html">to be clicked <a/>`

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2022-01-26T18:32:02.277

当我在创建网页时，我发现将 Html 文件移动到不同的文件夹，它会改变图像、视频、音乐、PDF 文件等的路径。有了它们，你必须走出 HTML 文件位于，与 `../HTML`。然后当你出去的时候，根据你的页面内容在哪里，插入，

```
 <a href="Meme/WP/Chipmunk.html">Chipmunk Memes</a>

 */ This is where the HTML is located ^^^^^^ */

 <img class="demo cursor" src="../6.png" width="100" height="50" onclick="currentSlide(6)" alt="Sasha Having Some Fun">

 */ This is where the images are located. The "../6.png" is the image file, and it is located one directory back. */
```

# html - 绝对定位元素的奇怪 CSS 问题

> ID：908778
> 
> 赞同：0
> 
> 时间：2009-05-26T03:04:28.497
> 
> 标签：html, css, internet-explorer-7

在 firefox、safari、ie8 中，[我网站上](http://vanquish.websitewelcome.com/~toberua)的菜单系统运行良好。

但是，在 IE7 中，链接项就消失了！我已经尝试了很多事情来看看他们可能逃到了哪里，但他们似乎只是消失了！

[这个网站](http://www.brunildo.org/test/IE_raf3.html)看起来像是在做某事，除了我的标题部分没有任何浮动！

现在，我通常很擅长使用 CSS，并且可以摆脱大多数 IE 错误，但这个问题让我有点发疯。

我也尝试过使用 IE8 的开发人员工具，但没有设法修复它。

有任何想法吗？

**注意**我意识到这个网站打破了一些可用性约定（一个复选框）但我没有设计它并且没有太多发言权:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T03:31:58.333

问题是

```
#header ul li {text-indent: -9999px} 
```

我无法告诉您为什么其他浏览器会处理它，但我对其进行了测试，我知道这是问题所在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T03:20:07.780

如果您尝试使用 position: fixed 而不是 position: absolute，在 IE7 中会发生什么？

# c++ - 等待某个网站被访问

> ID：908793
> 
> 赞同：0
> 
> 时间：2009-05-26T03:16:32.683
> 
> 标签：c++, c, window

我的目标是在访问网站时触发一个事件。现在，可能通过窗口标题或窗口中的文本。或者甚至可能阅读一个 URL。

截至目前，我知道 FindWindow (class,title); 然而，所有将这行代码放入循环中的所有尝试，并且它的退出条件是窗口出现时都没有结果。

任何帮助都会非常有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T18:12:32.967

那是不可能的。至少如果我理解正确的话。您想在您机器上的任何软件访问特定网站时注册回调？

想象一下浏览器使用 SSL，没有办法通过监听流量或类似的东西来检测它。

但是，如果您想收到与特定 IP 的所有连接的通知，那么您可以使用内核的嗅探机制，甚至将所有流量重定向到该 IP 到您使用 iptables 或类似设置设置的代理。

Windows 有一个名为 WinPCap 的嗅探库，在 linux 上你可以使用 tcpdump。不过，有关您的问题的更多信息会很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T10:38:32.227

寻找窗口标题可能有点问题。我不知道您对桌面有多少控制权，但您可能会考虑为 Firefox（或 IE 中的等价物）构建一个插件来查找此特定站点。

[https://developer.mozilla.org/En/Extensions/Firefox](https://developer.mozilla.org/En/Extensions/Firefox)

您还可以考虑构建一个简单的本地代理服务器（取决于您在做什么）来查找该站点并执行一些操作。您必须确保机器上的所有浏览器都指向此本地代理才能使其正常工作。有关自定义代理服务器的一些讨论，请参见下面的链接：

[如何在 C# 中创建一个简单的代理？](https://stackoverflow.com/questions/226784/how-to-create-a-simple-proxy-in-c)

# data-structures - 为添加项目（在列表末尾）、迭代和删除项目而优化的数据结构

> ID：908802
> 
> 赞同：1
> 
> 时间：2009-05-26T03:24:48.847
> 
> 标签：data-structures

我需要一个以高性能方式支持以下操作的数据结构：

*   将项目添加到列表末尾
*   按照添加项目的顺序遍历列表（随机访问并不重要）
*   从列表中删除项目

我应该使用什么类型的数据结构？（我将在下面发布我目前正在考虑的答案。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T03:27:41.850

您应该使用链表。将一个项目添加到列表的末尾是 O(1)。迭代很容易，您也可以在 O(1) 中从列表中的任何已知位置删除一个项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T05:12:12.977

这听起来像是一个链表，但是您需要考虑一个问题。当您说“从列表中删除一个项目”时，这取决于您是否有“完整的项目”要删除，或者只是它的值。

我将澄清：假设您的值是字符串。您可以构造一个包含一个字符串和两个链接指针（向前和向后）的类/结构。当给定这样一个类时，很容易将其从 O(1) 中的列表中删除。在伪代码中，删除项目 c 如下所示（请忽略验证测试）：

```
c.backwards = c.forwards
if c.backwards = null: head = c.forwards
if c.forwards = null: tail = c.backwards
delete c 
```

但是，如果您希望删除包含字符串“hello”的项目，则需要 O(n)，因为您需要遍历列表。

如果是这种情况，我建议使用链表和哈希表的组合进行 O(1) 查找。插入到列表的末尾（伪代码）：

```
new_item = new Item(value = some_string, backwards = tail, forwards = null)
tail.forwards = new_item
tail = new_item
hash.add(key = some_string, value = new_item) 
```

扫描链表就是扫描链表，没有问题：

```
i = head

while i != null:
    ... do something with i.value ...
    i = i.forwards 
```

按值从列表中删除一个项目（伪代码，无验证测试）：

```
item_to_remove = hash.find_by_key(some_string)
if (item_to_remove != null):
    hash.delete_key(some_string)
    item_to_remove.backwards = item_to_remove.forwards
    if item_to_remove.forwards = null: tail = item_to_remove.backwards
    if item_to_remove.backwards = null: head = item_to_remove.forwards
    delete item_to_remove 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T03:27:49.493

我正在考虑使用一个简单的项目列表。添加新项目时，我会将其添加到列表的末尾。要删除一个项目，我实际上不会将其从列表中删除，我只会将其标记为已删除，并在遍历项目时跳过它。

我将跟踪列表中已删除项目的数量，当超过一半的项目被删除时，我将创建一个没有已删除项目的新列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T03:41:49.123

循环和双链表。它满足所有 3 个要求：

在列表末尾添加一个项目：O(1)。通过添加到 Head->prev。它支持以添加它们的相同顺序遍历列表。您可以删除任何元素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T09:41:02.220

假设 Java（其他语言有类似的结构，但我首先找到了 JavaDocs）：

*   [ArrayList](http://java.sun.com/javase/6/docs/api/index.html?java/util/ArrayList.html)如果您有要删除的项目的索引
*   [LinkedHashMap](http://java.sun.com/javase/6/docs/api/index.html?java/util/LinkedHashMap.html)如果你只有项目而不是它的位置

# asp.net - Global.asax、全局变量和用代码编辑

> ID：908803
> 
> 赞同：1
> 
> 时间：2009-05-26T03:25:27.050
> 
> 标签：asp.net, asp.net-3.5, global-variables, global-asax

我有两个问题：

1) 我的网站在我的**global.asax**文件中声明了一些全局变量。它们是简单的、小的键/值对，并且只有少数几个。对于我网站上几乎每个页面都需要访问的小值，这是一个很好的做法吗？将它们存储在数据库中并需要进行数据库查找似乎会浪费资源用于不快速变化的值。

2）如果其中一个值每周更改一次，是否可以允许用户使用表单或其他方式编辑全局变量？

例子：

```
<script runat="server">

  Overloads Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)

      Application("default_scoring_id") = 3
      Application("week_current") = 3

  End Sub

</script> 
```

在上面的示例中，系统需要知道当前日期在哪一周（其中 15 周）。因此，每周一早上一次，“week_current”值需要更改。

我可以很容易地做到这一点，但是有没有办法让用户在不接触代码的情况下更改这个值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T03:29:33.673

典型的做法是将这些放到 web.config 中，可以进行编辑。然后这些`<appSettings>`值将在每个页面上可用，但可以编辑文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T03:35:53.477

我会考虑使用内置缓存（System.Web.Caching.Cache）

这样，您就可以将它们存储在您想要的任何位置（例如在数据库中），从应用程序中轻松更改它们，并进行快速且廉价的检索。

从继承自 BasePage 的类中使用给定的 Cache 对象（例如 Cache.Add(..)），从其他地方使用 HttpContext.Current.Cache（例如 HttpContext.Current.Cache.Remove(Key)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T03:37:00.917

1) 好的做法通常是将这些值存储在 web.config 中。请参阅[此处](http://www.codersource.net/asp_net_web_configuration_file.html)和[此处](http://www.4guysfromrolla.com/articles/053102-1.aspx)获取一些指南。

2) a) 如果您将其存储在 web.config 中，它将很容易更新，而无需重新编译，并且 Web 应用程序应立即获取更改。

b) 更新“周数”之类的内容真的需要手动进行吗？这听起来有点容易出错，如果可能的话，我建议通过根据当前日期计算它来自动化它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T04:09:47.870

其他答案表明可以使用不同的方法，并且必须这样做。但是，即使您想允许用户编辑全局变量，您也必须在共享对象上获取锁或互斥锁，更改全局变量的值，然后释放锁或互斥锁。

```
lock(globalsharedobject) //This is C# code.
{
    Application("default_scoring_id") = 3;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T05:16:02.833

Web.config 是 .NET 方式，或者 ASP.NET 方式，它并不总是最有效或最合适的。

您的 Global.asax 文件不仅仅是一些事件，您可以将静态数据放在 System.Web.HttpApplication 子类的任何类中，并在 Global.asax 文件中继承它。

HttpSessionState 和 HttpApplicationState 是经典 ASP 时代的遗物，您最好避免使用它们，因为它们没有真正的用途。

根据对象的类型（System.Type），您可以设计自己的强类型对象来存储有关应用程序和会话的信息，对于应用程序级数据，一堆静态字段就足够了。

它们必须是静态的，因为每个 HttpModule 和 HttpApplication 实例都是池化对象，因此为避免这种混淆，请确保您的持久数据存储在一个静态或多个静态字典中。但是在修改这些集合时要注意并发问题。一个好的策略是锁定对象，仅在您修改它的持续时间内，并确保在 modyfiny 集合时不调用任何其他代码，一个简单的交换习惯用法，在这里可能会有所帮助，它很快而且不是- 死锁保证。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-11T09:36:04.353

```
<%@ Application Language="C#" %>

<script runat="server">

    void Application_Start(object sender, EventArgs e) 
    {
    // Code that runs on application startup

    }

    void Application_End(object sender, EventArgs e) 
    {
    //  Code that runs on application shutdown

    }

    void Application_Error(object sender, EventArgs e) 
    { 
    // Code that runs when an unhandled error occurs

    }

    void Session_Start(object sender, EventArgs e) 
    {

    // Code that runs when a new session is started

    }

    void Session_End(object sender, EventArgs e) 
    {
    // Code that runs when a session ends. 
    // Note: The Session_End event is raised only when the sessionstate mode
    // is set to InProc in the Web.config file. If session mode is set to StateServer 
    // or SQLServer, the event is not raised.

    }
    protected void Application_BeginRequest(Object sender, EventArgs e)
    {
    Context.Items.Add("Request_Start_Time", DateTime.Now);
    }
    protected void Application_EndRequest(Object sender, EventArgs e)
    {
    TimeSpan tsDuration = DateTime.Now.Subtract((DateTime)Context.Items["Request_Start_Time"]);
    Context.Response.Write("<b>Request Processing Time: From Global.asax file " + tsDuration.ToString());
    Application["time"] = tsDuration.ToString();
    }

</script> 
```

# makefile - 离开目录……？

> ID：908808
> 
> 赞同：8
> 
> 时间：2009-05-26T03:28:06.063
> 
> 标签：makefile

当我使用 makefile（我有 12 个 makefile）编译我的代码时，会出现一个错误，告诉 `make.exe[1]: Leaving directory Error 2` 我这是什么原因？还有“错误 2 或错误 1”是什么意思？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-26T06:35:08.617

当 make 在此上下文中打印“错误 2”时，它仅表示递归 make 调用中存在错误。您必须查看该消息之前的错误消息，以确定子制作中的真正问题。例如，给定一个像这样的 Makefile：

```
all:
        $(MAKE) -f sub.mk 
```

...和这样的 sub.mk ：

```
all:
        @exit 1 
```

当我运行 GNU make 时，它​​会打印以下内容：

```
gmake -f sub.mk
gmake[1]: Entering directory `/tmp/foo'
gmake[1]: *** [all] Error 1
gmake[1]: Leaving directory `/tmp/foo'
gmake: *** [all] Error 2 
```

`Error 2`告诉我子制作中有某种错误。我必须查看该消息上方，查看`Error 1`来自 submake 本身的消息。在那里，我可以看到在尝试构建时调用的一些命令`all`退出代码 1 退出。不幸的是，除了“退出代码 0 表示 OK”之外，并没有真正定义应用程序退出代码的标准。您必须查看失败的特定命令并检查其文档以确定特定退出代码的含义。

正如其他人所说，这些错误消息与 Unix errno 值无关。最外面的“2”只是当子make出错时make自己分配的错误代码；内部的“1”只是失败命令的退出代码。它可以很容易地是“7”或“11”或“42”。

# php - 将选定的 Wikipedia 文章复制到自己的 wiki 中？

> ID：908813
> 
> 赞同：0
> 
> 时间：2009-05-26T03:31:11.517
> 
> 标签：php, mysql, mediawiki, wikipedia

有没有办法将某些维基百科文章（大约 10,000 篇）批量复制到我自己的 mediawiki 网站？

编辑：如何在不覆盖类似名称的文章/页面的情况下执行此操作？我也不打算使用非法手段（爬虫等）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T03:34:17.437

维基百科数据库可供[下载](http://en.wikipedia.org/wiki/Wikipedia_database)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T03:53:36.773

如果您希望获得一组特定的文章，那么您可以使用导出页面 ( [http://en.wikipedia.org/wiki/Special:Export](http://en.wikipedia.org/wiki/Special:Export) ) 来获取相关页面的 XML 转储；您可以一次导出多个页面，尽管您可能希望分隔您的请求。

`Special:Import`您可以使用.xml 文件中的其中一个导入脚本将 XML 转储导入 MediaWiki `maintenance/`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-20T05:19:58.660

[http://www.wikihow.com/Import-XML-Dumps-to-Your-MediaWiki-Wiki](http://www.wikihow.com/Import-XML-Dumps-to-Your-MediaWiki-Wiki)

这对你有帮助，我希望。

# c++ - C++ 的内联不是完全可选的吗？

> ID：908830
> 
> 赞同：20
> 
> 时间：2009-05-26T03:37:35.830
> 
> 标签：c++, inline

我有一个具有内联成员的类，但后来我决定要从标头中删除实现，因此我将函数的成员主体移到 cpp 文件中。起初我只是将内联签名留在头文件中（我马虎），程序无法正确链接。然后我修复了我的标题，当然一切正常。

*但是内联不是完全可选的吗？*

在代码中：

第一的：

```
//Class.h
class MyClass
{
   void inline foo()
   {}
}; 
```

接下来更改为（不会链接）：

```
//Class.h
class MyClass
{
   void inline foo();
};

//Class.cpp
void MyClass::foo()
{} 
```

然后到（会正常工作）：

```
//Class.h
class MyClass
{
   void foo();
};

//Class.cpp
void MyClass::foo()
{} 
```

我认为 inline 是可选的，并想象我可能会因为我的草率而受到警告，但没想到会出现链接错误。在这种情况下，编译器应该做的正确/标准的事情是什么，根据标准，我应该得到我的错误吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-26T13:29:20.590

事实上，有一个定义规则说，*必须*在每个使用它的翻译单元中定义一个内联函数。血淋淋的细节如下。首先`3.2/3`：

> 每个程序都应包含该程序中使用的每个非内联函数或对象的一个​​定义；无需诊断。定义可以显式出现在程序中，可以在标准或用户定义库中找到，或者（在适当时）隐式定义（参见 12.1、12.4 和 12.8）。内联函数应在使用它的每个翻译单元中定义。

当然`7.1.2/4`：

> 内联函数应在使用它的每个翻译单元中定义，并且在每种情况下都应具有完全相同的定义（3.2）。[注意：在其定义出现在翻译单元之前，可能会遇到对内联函数的调用。] 如果具有外部链接的函数在一个翻译单元中声明为内联，则应在其出现的所有翻译单元中声明为内联；不需要诊断。具有外部链接的内联函数在所有翻译单元中应具有相同的地址。外部内联函数中的静态局部变量始终引用同一个对象。外部内联函数中的字符串文字是不同翻译单元中的相同对象。

但是，如果您在类定义中定义函数，它会被隐式声明为`inline`函数。这将允许您在程序中多次包含包含该内联函数体的类定义。由于该函数具有`external`链接，因此它的任何定义都将引用*相同*的函数（或更血腥 - 指向相同的函数`entity`）。

关于我的索赔的血腥细节。首先`3.5/5`：

> 此外，如果类的名称具有外部链接，则成员函数、静态数据成员、类或类范围的枚举具有外部链接。

然后`3.5/4`：

> 如果具有命名空间范围的名称是 [...] 命名类（第 9 条）的名称，或者是在 typedef 声明中定义的未命名类，其中该类具有用于链接目的的 typedef 名称，则该名称具有外部链接。

这个“用于链接目的的名称”很有趣：

```
typedef struct { [...] } the_name; 
```

由于现在您的程序中有*同一实体*的多个定义，ODR 的另一件事恰好限制了您。`3.2/5`接下来是无聊的东西。

> 如果每个定义出现在不同的翻译单元中，程序中可以有多个类类型（第 9 条）、枚举类型（7.2）、带有外部链接的内联函数（7.1.2）[...] 的定义，并提供定义满足以下要求。给定这样一个名为 D 的实体在多个翻译单元中定义，则
> 
> *   D 的每个定义都应由相同的记号序列组成；和
> *   在 D 的每个定义中，根据 3.4 查找的相应名称应指在 D 的定义中定义的实体，或应指同一实体，在重载决议 (13.3) 和部分模板特化匹配后 (14.8) .3) [...]

我现在切断了一些不重要的东西。以上是关于内联函数需要记住的两个重要内容。如果您多次定义 extern 内联函数，但确实以不同方式定义它，或者如果您定义它并且其中使用的名称解析为不同的实体，那么您正在执行未定义的行为。

函数必须在使用它的每个 TU 中定义的规则很容易记住。并且它是相同的也很容易记住。但是那个名字解析的东西呢？这里有一些例子。考虑一个静态函数`assert_it`：

```
static void assert_it() { [...] } 
```

现在，既然`static`会给它内部链接，当你将它包含到多个翻译单元中时，每个定义都会定义一个*不同的实体*。这意味着您*不允许*使用`assert_it`将在程序中多次定义的 extern 内联函数：因为发生的情况是内联函数将引用`assert_it`一个 TU 中调用的一个实体，但引用相同的另一个实体在另一个 TU 中命名。你会发现这都是无聊的理论，编译器可能不会抱怨，但我发现这个例子特别显示了 ODR 和实体之间的关系。

* * *

接下来是再次回到您的特定问题。

以下是相同的事情：

```
struct A { void f() { } };
struct A { inline void f(); }; void A::f() { } // same TU! 
```

但是这个不同，因为该函数是非内联的。您将违反 ODR，因为您有多个定义`f`是否多次包含标题

```
struct A { void f(); }; void A::f() { } // evil! 
```

现在，如果您在类内部`inline`声明 of `f`，然后省略在标题中定义它，那么您就违反了`3.2/3`（并且`7.1.2/4`说的是同一件事，只是更详细），因为该函数未在该翻译单元中定义！

请注意，在 C (C99) 中，内联具有与 C++ 不同的语义。如果你创建一个外部内联函数，你应该首先阅读一些好论文（最好是标准），因为这些在 C 中真的很棘手（基本上，任何使用的函数内联定义都需要另一个非内联函数定义在另一个TU. C 中的静态内联函数很容易处理。除了具有通常的“内联替换”提示之外，它们的行为与任何其他函数一样`inline`。C 和 C++ 中的静态仅用作内联替换提示。因为静态已经创建任何时候使用不同的实体（由于内部链接），`inline`只会添加内联替换提示 - 不多。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-26T03:39:23.850

该方法是否实际内联由编译器自行决定。但是 inline 关键字的存在也会影响方法的链接。

C++ 链接不是我的专长，所以我将遵循链接以获得更好的解释。

*   [http://publib.boulder.ibm.com/infocenter/zos/v1r9/index.jsp?topic=/com.ibm.zos.r9.cbclx01/inline_linkage.htm](http://publib.boulder.ibm.com/infocenter/zos/v1r9/index.jsp?topic=/com.ibm.zos.r9.cbclx01/inline_linkage.htm)
*   [http://en.wikipedia.org/wiki/Inline_function](http://en.wikipedia.org/wiki/Inline_function)

或者，您可以等待[litb](https://stackoverflow.com/users/34509/litb)在一个小时左右提供血腥细节；）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-26T04:24:08.903

注意：当方法被声明为内联时，它的定义必须和它的声明一起。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-26T20:28:33.783

关于harshath.jr的回答，如果方法的定义具有“inline”关键字，则不需要将方法声明为内联，并且该定义在同一个标​​头中可用，*即*：

```
class foo
{
  void bar();
};

inline void foo::bar()
{
  ...
} 
```

这对于根据构建是“*调试*”还是“*发布*”有条件地内联方法很有用，如下所示：

```
// Header - foo.h

class foo
{
  void bar();  // Conditionally inlined.
};

#ifndef FOO_DEBUG
# include "foo.inl"
#endif 
```

“内联”文件可能如下所示：

```
// Inline Functions/Methods - foo.inl
#ifndef FOO_DEBUG
# define FOO_INLINE inline
#else
# define FOO_INLINE
#endif

FOO_INLINE void foo::bar()
{
  ...
} 
```

并且实现可能如下所示：

```
// Implementation file - foo.cpp
#ifdef FOO_DEBUG
# include "foo.inl"
#endif

... 
```

它并不完全漂亮，但是当激进的内联成为调试难题时，它就派上了用场。

# ruby - 如何测试使用外部命令行工具的软件

> ID：908831
> 
> 赞同：1
> 
> 时间：2009-05-26T03:38:12.557
> 
> 标签：ruby, tdd

我试图弄清楚如何测试驱动软件，该软件启动以文件路径作为输入并在长时间处理到标准输出或某些文件后写入输出的外部进程？在这种情况下编写测试有一些常见的模式吗？很难创建快速执行的测试来验证外部工具的正确使用，而无需在测试中启动实际工具并检查结果。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T03:43:42.293

您可以记忆（[http://en.wikipedia.org/wiki/Memoization](http://en.wikipedia.org/wiki/Memoization)）外部流程。用 Ruby 编写一个包装器，计算输入文件的 md5 和，并根据已知校验和的数据库对其进行检查。如果匹配一个，则复制正确的输出；否则，正常调用该工具。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T04:21:11.787

测试到你的界限。在您的情况下，边界是您为调用外部程序而构造的命令行（您可以通过猴子修补来捕获）。如果您将自己粘在该程序的标准输出中（或通过读取文件来处理其结果），那是另一个边界。测试是您的程序是否可以处理该“输入”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-26T05:17:36.107

90% 的答案是模拟外部命令行工具并验证正确的输入在两者之间的分割接口处传递给它们。这有助于保持测试套件的速度。此外，您不必引入命令行工具，因为它们不是“正在测试的代码” - 它可能导致单元测试失败，原因可能是代码更改或命令中的某些行为更改线效用。

但是您似乎在定义“正确输入”时遇到了麻烦-在这种情况下，使用诸如记忆化之类的优化（正如戴夫建议的那样）可能会给您两全其美的效果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-26T03:43:05.363

假设外部程序经过良好测试，您应该只测试您的程序是否将正确的数据传递给它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T05:04:06.170

我认为您遇到了单元测试的一个常见问题，因为正确性实际上取决于集成是否有效，那么单元测试如何帮助您？

基本答案是单元测试测试您打算传递给命令行工具的参数实际上是通过这种方式传递的，并且您期望返回的结果实际上是按照您打算处理它们的方式处理的。

然后是第二级测试，它可能是自动化的，也可能不是自动化的（最好是自动化的，但它确实取决于它是否实用），它位于调用真正实用程序的功能级别，以便您可以看到你打算通过什么以及你期望得到什么与实际发生的事情相匹配。

一组测试“测试”外部工具（可能以不同的时间表运行，或者仅在您升级这些工具时）建立您的假设，传递原始输入并断言您得到了返回原始输出。这样，如果您升级该工具，您就可以捕捉到任何可能影响您的行为变化。

您必须决定最后一组测试是否值得。这在很大程度上取决于所涉及的工具。

# ruby-on-rails - named_scope 中的变量字段名称？

> ID：908832
> 
> 赞同：3
> 
> 时间：2009-05-26T03:38:24.083
> 
> 标签：ruby-on-rails, ruby, activerecord, named-scope

在 Rails 模型中，我试图实现一个基于 start_date 和 end_date 过滤的 named_scope。这很简单。但我将不得不在很多不同的领域多次这样做。

这是自找麻烦吗？如果是这样，为什么（SQL 注入？）并且有另一种方法来实现这一点。

```
named_scope :between, lambda {|start_date, end_date, field|
  { :conditions => ["#{field} >= ? AND #{field} <= ?", start_date, end_date] }
} 
```

编辑：使用的解决方案

使用 Eggdrop 的思路，我选择了：

```
@@valid_fields = %w(fields in here)

named_scope :between, lambda{ |start_date, end_date, field_name|
  field = (@@valid_fields.include?(field_name)) ? (field_name) : raise (ActiveRecord::StatementInvalid)
  {  :conditions => ["#{field} >= ? AND #{field} <= ?",  start_date, end_date]}
} 
```

现在，我可以将我的 named_scope 重用于我希望在日期范围上过滤的字段，而无需一遍又一遍地重写本质上相同的范围，并将字段名称列入白名单，以避免在代码暴露给用户时对我的列名和棘手的 SQL 注入造成任何混乱将来输入。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T05:12:43.943

也许您可以在模型中编写一个方法来验证“字段”：

如果表 x，则“字段”必须是该表中特定的现有日期字段。

换句话说，您不允许直接将外部输入到“字段”中 - 外部输入必须映射到您的验证方法中指定的已知属性和定义的条件。

不过，总的来说，似乎不建议采用这种总体方向。

# version-control - 如何构建具有多个依赖项目的 VCS

> ID：908839
> 
> 赞同：2
> 
> 时间：2009-05-26T03:43:38.190
> 
> 标签：version-control, continuous-integration

我确信这是其他人以前解决过的常见问题，因此我呼吁其他开发人员/项目经理的集体智慧寻求帮助。

我有很多项目：

*   应用
*   网络应用
*   服务器应用
*   开发工具
*   甲骨文

所有应用程序/实用程序都依赖于 ORM：当 ORM 更改时，需要对其进行编译，并且所有应用程序都需要针对它重新编译然后部署。现在我的 VCS 结构有点混乱：

*   应用名称
    *   树干
        *   应用
        *   网络应用
        *   服务器应用
        *   Dev Utils（现在大约 4 个文件夹，但还在增长）
        *   甲骨文
    *   释放
        *   项目名称（应用程序或 WebApp）版本号
    *   分支机构
        *   ExperimentName_DevName

理想情况下，我希望每个应用程序都有一个根文件夹（Application/WebApp/ORM 等），每个应用程序都有自己的 Trunk/Branches/Releases 等，以在逻辑上和物理上将它们分开。我的理由是，由于在应用程序上完成了大量工作，并且它被更频繁地发布，每个发布分支都有相同实用程序的相同副本等。此外，检查主干以处理它总是意味着所有其他项目随之而来。

然而，分离意味着将某些项目从解决方案中剥离出来，同时修改任何项目是一件痛苦的事情——在 2-3 个 IDE 之间跳转（尤其是在对 ORM 进行更改时）。

我正在考虑这个问题，因为很快我就会组装一台 CI 机器（在一周左右的时间里准备好回答有关该问题的问题），并且我正在尝试找出一种方法来自动创建/部署版本。通常，只有应用程序被部署，通过脚本复制到所有工作站在启动时从中拉出的服务器，但就像我之前所说的，如果 ORM 更改/发布，所有其他应用程序都应该重新构建和部署。

（今天我破坏了我们的网站和 3 个实用程序，因为我更改了 ORM 并使用更新版本的应用程序部署它，但忘记使用新的 ORM 重建/部署其他应用程序 - 哎呀。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T15:14:05.323

设身处地为您的开发人员着想。这应该不难，因为听起来您就是其中之一 :-) 不是从架构的角度，而是从可用性的角度来看您的版本控制布局。问问自己：作为开发人员，我们每天对源代码做的最常见的事情是什么？具体考虑您与 VCS 系统和项目布局的交互。你想让普通的事情变得简单。不太常见的用例更难找到是可以的，只要你有如何做的记录，这样当（不是如果！）人们忘记时，他们就会知道去哪里提醒自己如何做.

我见过很多试图在架构上“完美”的 VCS 布局，但从日常使用的角度来看，最终导致没有尽头的麻烦和头痛。我并不是说这两者不能重合和很好地融合在一起，我只是说从用户的角度考虑它，并让它成为你的指南。

从 CI 的角度来看，我仍然会采用这种方法。即使您的设置最终在您选择的 CI 中定义变得更加复杂，您也只需在那里进行一次设置。如果布局在开发过程中易于使用，那么您的大部分 CI 设置也应该相对容易。然后，您只需关注需要更多时间的最后一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T03:57:53.513

将您的代码库拆分为不同的“项目”可能非常困难。我们在每个单独的“可部署”边界上都这样做了。包括一个其他人共同/使用的“平台”层，作为一个单独的项目。但这也不是很完美。

我不能强调的一件事是，需要在签入之后和实际部署任何东西之前运行某种形式的连续回归/测试。此外，甚至可能涉及一些手动测试的“释放”过程可能会有所帮助，并且肯定可以防止一些鸡蛋在脸上的情况。（最好晚几天再发布它然后坏掉。）

（很抱歉没有直接解决您的问题）

# sql - Rails 组合 ('AND') 搜索关联的连接表

> ID：908842
> 
> 赞同：1
> 
> 时间：2009-05-26T03:47:38.003
> 
> 标签：sql, ruby-on-rails, join

我无法让 rails 对对象的关联连接表返回组合 ('AND') 搜索。

例如，我有分类中的书籍。可以说：书 1：属于第 5 类和第 8 类

但是我无法使用连接表来过滤结果？例如::->

类书籍 has_and_belongs_to_many :categories, :join_table => "book_categories"

Book.find :all, :conditions => "book_categories.category_id = 5 AND book_categories.category_id = 8", :include => "categories" ... 返回 nil （为什么它不返回 5 & 8 ??)

但是：“或”确实有效：

Book.find :all, :conditions => "book_categories.category_id = 5 OR book_categories.category_id = 8" ... 返回类别 5 和 8 中的所有书籍

我肯定错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T03:57:15.713

问题出在 SQL 级别。该条件在链接表行上运行，并且任何单独的链接表行都不能`category_id`同时具有 5 和 8。您确实希望*单独*的链接表行具有这些 ID。

尝试查看 Rails' [`named_scope`](http://millarian.com/2008/8/31/quick-tip-named_scope)，特别是允许使用 lambda 过滤的部分（以便您可以接受参数）。我自己从来没有尝试过，但如果我必须实现你正在寻找的东西，那就是我想要的。

# jquery - jqgrid ASP.NET MVC——为网格获取正确的数据

> ID：908844
> 
> 赞同：2
> 
> 时间：2009-05-26T03:48:24.947
> 
> 标签：jquery, asp.net-mvc, ajax, jqgrid

这是我的困境，

我无法将我的数据处理成符合`jqgrid`标准的形式。这是我第一次使用`jqgrid`，我花了很多时间阅读它。

我的js代码如下：

```
jQuery("#list").jqGrid({
    url: '/Home/ListContacts/',
    dataType: "json",
    contentType: "application/json; charset=utf-8",
    mtype: 'POST',
    colNames: ['First Name', 'MI', 'Last Name'],
    colModel: [{
            name: 'First Name',
            index: 'FName',
            width: 40,
            align: 'left'
        },
        {
            name: 'MI',
            index: 'MInitial',
            width: 40,
            align: 'left'
        },
        {
            name: 'Last Name',
            index: 'LName',
            width: 400,
            align: 'left'
        }
    ],
    pager: jQuery('#pager'),
    rowNum: 10,
    rowList: [5, 10, 20, 50],
    sortname: 'Id',
    sortorder: "desc",
    repeatitems: false,
    viewrecords: true,
    imgpath: '/scripts/themes/basic/images',
    caption: 'My first grid'
}); 
```

我从数据库中得到什么：

```
[
    ["4", "Jenna", "Mccarthy"],
    ["56", "wer", "weoiru"]
] 
```

如果我错了，现在纠正我，但是我的 colModel 中的 index: 指的是我数据库中的列名，对吗？

有人可以指出一个直截了当的参考，或者只是让我开始，我将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T13:35:58.093

索引是将在 sidx 查询字符串参数中传递给控制器​​的内容，以指示当您单击网格中的列标题时应使用哪一列进行排序。Name 是为该列的数据返回的 json 中的属性名称。由于显而易见的原因，这些通常是相同的。我有很长的系列文章，[从这里开始](http://blogs.teamb.com/craigstuntz/2009/04/14/38200/)，它非常详细地解释了所有这些。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-01T13:14:10.663

我可以看到你有“名字”和“姓氏”。您的 JSON 数据中缺少“MI”列 **我从数据库中获取的内容：[["4","Jenna","Mccarthy"],["56","wer","weoiru"]]**

JSON 中的第一个字段是 id，对吧？第二个是“名字”，第三个应该是“MI”，依此类推。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T10:51:46.757

您的列模型不应该是 [id, first, lastname] 吗？无论如何，有[Phil Haack 的帖子](http://haacked.com/archive/2009/04/14/using-jquery-grid-with-asp.net-mvc.aspx)，我有一个关于[启用编辑](http://ericdotnet.wordpress.com/2009/05/02/editing-in-jqgrid-with-aspnet-mvc/)的帖子。

# c++ - 标记 SIC 汇编器源

> ID：908847
> 
> 赞同：3
> 
> 时间：2009-05-26T03:51:29.237
> 
> 标签：c++, tokenize, sic

我已经为我的系统编程类编写了一个 SIC 汇编器，但我对标记化部分感到困惑。

例如，以这行源代码为例：

格式（自由格式）为：{LABEL} OPCODE {OPERAND{,X}} {COMMENT}

卷曲表示该字段是可选的。

此外，每个字段必须由至少一个空格或制表符分隔。

```
ENDFIL      LDA     EOF         COMMENT GOES HERE 
```

上面的代码更容易组织，但下面的代码片段给我带来了困难。

```
 RSUB                COMMENT GOES HERE 
```

我的代码将读取注释的第一个单词，就好像它是一个操作数一样。

这是我的代码：

```
//tokenize line
    if(currentLine[0] != ' ' && currentLine[0] != '\t')
    {
        stringstream stream(currentLine);
        stream >> LABEL;
        stream >> OPCODE;
        stream >> OPERAND;
        stream.str("");

        if(LABEL.length() > 6 || isdigit(LABEL[0]) || !alphaNum(LABEL))
        {
            errors[1] = 1;
        }
        else if(LABEL.length() == currentLine.length())
        {
            justLabel = true;
            errors[6] = 1;
            return;
        }
    }
    else
    {
        stringstream stream(currentLine);
        stream >> OPCODE;
        stream >> OPERAND;
        stream.str("");
    } 
```

我的教授要求用两个版本的源代码测试汇编器——一个有错误，一个没有。

RSUB OPCODE 不依赖于 OPERAND，因此我了解 RSUB OPCODE 之后的所有内容都可以视为注释，但是如果错误的源代码在 OPERAND 字段中包含值，或者缺少依赖于 OPERAND 的 OPCODE OPERAND 值，我该如何补偿？我需要将这些标记为错误并打印出错误的操作数值（或缺少）。

我的问题是：如何防止代码的注释部分被视为操作数？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-05-26T04:04:10.597

在我见过的汇编语言（如其他编程语言）中，有一个标记注释的分隔符：例如注释前的分号：

```
ENDFIL LDA EOF ;COMMENT GOES HERE
RSUB ;ANOTHER COMMENT GOES HERE 
```

但是，在您的语法中，您能否通过行前的空白数量来判断某事是否是评论，例如，通过操作码和评论之间有两个（不仅仅是一个）空白事件的事实？

```
{LABEL}<whitespace>OPCODE<whitespace>{OPERAND{,X}}<whitespace>{COMMENT} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-26T04:06:12.517

如何判断某行中的文本是操作数还是注释？是根据上下文吗？例如，如果 OPCODE 是“RSUB”，那么您会知道不需要 OPERAND 吗？然后你应该根据读取的 OPCODE 对 OPERAND 执行一些魔法：

```
if (OPCODE == "RSUB") OPERAND.clear(); 
```

# sql - 选择没有链接任何外键的行

> ID：908849
> 
> 赞同：16
> 
> 时间：2009-05-26T03:53:50.330
> 
> 标签：sql, linq

我有 2 张桌子组和人

人们有 GroupId 链接到 Group.GroupId （主键）

如何选择没有任何人的组？在 t-sql 和 linq 中

谢谢你

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-05-26T03:57:16.803

**更新**

我已经通过 SQL Server 2005 运行了四种不同的方法来执行此操作，并包含执行计划。

```
-- 269 reads, 16 CPU
SELECT *
FROM Groups
WHERE NOT EXISTS (
    SELECT *
    FROM People
    WHERE People.GroupId = Groups.GroupId
);

-- 249 reads, 15 CPU
SELECT *
FROM Groups
WHERE (
    SELECT COUNT(*)
    FROM People
    WHERE People.GroupId = Groups.GroupId
) = 0

-- 249 reads, 14 CPU
SELECT *
FROM Groups
WHERE GroupId NOT IN (
    SELECT DISTINCT GroupId
    FROM Users
)

-- 10 reads, 12 CPU
SELECT *
FROM Groups
    LEFT JOIN Users ON Users.GroupId = Groups.GroupId
WHERE Users.GroupId IS NULL 
```

所以最后一个，虽然可以说是四个中可读性最低的，但表现最好。

这让我感到惊讶，老实说，我仍然更喜欢 WHERE NOT EXISTS 语法，因为我认为它更明确 - 它读起来与您正在尝试做的完全一样。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-26T04:00:36.260

我首选的方法是左反半连接：

```
SELECT    g.*
FROM      Groups g
LEFT JOIN People p ON g.GroupID = p.GroupID
WHERE     p.GroupID IS NULL 
```

我发现它最直观、灵活和高效。

我写了一篇关于各种查询策略来搜索缺失数据的整篇文章 -如果您有兴趣，请看[这里。](http://code.msdn.microsoft.com/SQLExamples/Wiki/View.aspx?title=QueryBasedUponAbsenceOfData&referringTitle=Home)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T04:53:56.197

我认为最简单的解决方案是：

```
SELECT * 
FROM GROUPS
WHERE GroupId NOT IN (SELECT DISTINCT GroupId FROM People) 
```

# c# - 获取系统中已安装的应用程序

> ID：908850
> 
> 赞同：88
> 
> 时间：2009-05-26T03:53:53.247
> 
> 标签：c#, .net, installation

如何使用 c# 代码获取系统中安装的应用程序？

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2009-05-26T04:18:19.417

遍历注册表项“SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall”似乎给出了已安装应用程序的完整列表。

除了下面的示例之外，您还可以找到与我在[此处](http://bytes.com/groups/net-c/276143-getting-list-installed-programs-windows-using-c)所做的类似的版本。

这是一个粗略的例子，你可能想要做一些事情来去除空白行，就像提供的第二个链接一样。

```
string registry_key = @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall";
using(Microsoft.Win32.RegistryKey key = Registry.LocalMachine.OpenSubKey(registry_key))
{
    foreach(string subkey_name in key.GetSubKeyNames())
    {
        using(RegistryKey subkey = key.OpenSubKey(subkey_name))
        {
            Console.WriteLine(subkey.GetValue("DisplayName"));
        }
    }
} 
```

或者，您可以使用前面提到的 WMI：

```
ManagementObjectSearcher mos = new ManagementObjectSearcher("SELECT * FROM Win32_Product");
foreach(ManagementObject mo in mos.Get())
{
    Console.WriteLine(mo["Name"]);
} 
```

但这执行起来相当慢，而且我听说它可能只列出安装在“ALLUSERS”下的程序，尽管这可能是不正确的。它还会忽略 Windows 组件和更新，这可能对您很方便。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2019-07-25T05:56:16.737

我希望能够提取应用程序列表，就像它们出现在开始菜单中一样。使用注册表，我得到了没有出现在开始菜单中的条目。

我还想找到 exe 路径并提取一个图标以最终制作一个漂亮的启动器。不幸的是，使用注册表方法，这是一种偶然发现，因为我的观察是这些信息不可靠。

我的替代方案基于 shell:AppsFolder，您可以通过运行来访问`explorer.exe shell:appsFolder`它，它列出了当前已安装并可通过开始菜单访问的所有应用程序，包括商店应用程序。问题是这是一个虚拟文件夹，无法使用`System.IO.Directory`. 相反，您必须使用本机 shell32 命令。幸运的是，微软在 Nuget 上发布了[Microsoft.WindowsAPICodePack-Shell](https://www.nuget.org/packages/Microsoft.WindowsAPICodePack-Shell/)，它是上述命令的包装器。话不多说，代码如下：

```
// GUID taken from https://docs.microsoft.com/en-us/windows/win32/shell/knownfolderid
var FOLDERID_AppsFolder = new Guid("{1e87508d-89c2-42f0-8a7e-645a0f50ca58}");
ShellObject appsFolder = (ShellObject)KnownFolderHelper.FromKnownFolderId(FOLDERID_AppsFolder);

foreach (var app in (IKnownFolder)appsFolder)
{
    // The friendly app name
    string name = app.Name;
    // The ParsingName property is the AppUserModelID
    string appUserModelID = app.ParsingName; // or app.Properties.System.AppUserModel.ID
    // You can even get the Jumbo icon in one shot
    ImageSource icon =  app.Thumbnail.ExtraLargeBitmapSource;
} 
```

这就是它的全部。您还可以使用启动应用程序

```
System.Diagnostics.Process.Start("explorer.exe", @" shell:appsFolder\" + appModelUserID); 
```

这适用于常规 Win32 应用和 UWP 商店应用。他们的苹果怎么样。

由于您有兴趣列出所有已安装的应用程序，因此可以合理地预期您可能还希望监视新应用程序或已卸载的应用程序，您可以使用以下命令来执行此操作`ShellObjectWatcher`：

```
ShellObjectWatcher sow = new ShellObjectWatcher(appsFolder, false);
sow.AllEvents += (s, e) => DoWhatever();
sow.Start(); 
```

编辑：人们可能还想知道上面提到的 AppUserMoedlID 是[Windows 用于对任务栏中的窗口进行分组的唯一 ID](https://docs.microsoft.com/en-us/windows/win32/shell/appids)。

2022：在 Windows 11 中测试，仍然运行良好。Windows 11 似乎还缓存了本身未安装的应用程序，例如不需要安装的便携式应用程序。它们出现在开始菜单搜索结果中，也可以从中检索`shell:appsFolder`。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-05-19T04:31:55.843

我同意通过注册表项进行枚举是最好的方法。

**但是请注意**，给出的键`@"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall"`, 将列出 32 位 Windows 安装中的所有应用程序，以及 Windows 64 位安装中的 64 位应用程序。

为了还可以查看安装在 Windows 64 位系统上的 32 位应用程序，您还需要枚举密钥`@"SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall"`.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-26T04:02:10.877

你可以看看[这篇文章](http://www.dreamincode.net/code/snippet1995.htm)。它利用注册表来读取已安装应用程序的列表。

```
public void GetInstalledApps()
{
    string uninstallKey = @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall";
    using (RegistryKey rk = Registry.LocalMachine.OpenSubKey(uninstallKey))
    {
        foreach (string skName in rk.GetSubKeyNames())
        {
            using (RegistryKey sk = rk.OpenSubKey(skName))
            {
                try
                {
                    lstInstalled.Items.Add(sk.GetValue("DisplayName"));
                }
                catch (Exception ex)
                { }
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-09-28T14:15:09.160

虽然公认的解决方案有效，但它并不完整。到目前为止。

如果要获取所有密钥，则需要考虑另外两件事：

> x86 和 x64 应用程序无法访问相同的注册表。基本上 x86 无法正常访问 x64 注册表。有些应用程序只注册到 x64 注册表。

和

> 一些应用程序实际上安装到 CurrentUser 注册表而不是 LocalMachine

考虑到这一点，我设法使用以下代码获取所有已安装的应用程序，**而不**使用 WMI

这是代码：

```
List<string> installs = new List<string>();
List<string> keys = new List<string>() {
  @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall",
  @"SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall"
};

// The RegistryView.Registry64 forces the application to open the registry as x64 even if the application is compiled as x86 
FindInstalls(RegistryKey.OpenBaseKey(RegistryHive.LocalMachine, RegistryView.Registry64), keys, installs);
FindInstalls(RegistryKey.OpenBaseKey(RegistryHive.CurrentUser, RegistryView.Registry64), keys, installs);

installs = installs.Where(s => !string.IsNullOrWhiteSpace(s)).Distinct().ToList();
installs.Sort(); // The list of ALL installed applications

private void FindInstalls(RegistryKey regKey, List<string> keys, List<string> installed)
{
  foreach (string key in keys)
  {
    using (RegistryKey rk = regKey.OpenSubKey(key))
    {
      if (rk == null)
      {
        continue;
      }
      foreach (string skName in rk.GetSubKeyNames())
      {
        using (RegistryKey sk = rk.OpenSubKey(skName))
        {
          try
          {
            installed.Add(Convert.ToString(sk.GetValue("DisplayName")));
          }
          catch (Exception ex)
          { }
        }
      }
    }
  }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-09-25T09:28:14.013

值得注意的是，Win32_Product WMI 类表示由[Windows Installer 安装](http://msdn.microsoft.com/en-us/library/aa394378%28v=vs.85%29.aspx)的产品。并非每个应用程序都使用 Windows 安装程序

但是“SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall”代表 32 位应用程序。对于 64 位，您还需要遍历“HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall”，并且由于并非每个软件都有 64 位版本，因此安装的应用程序总数是两个位置上具有“UninstallString”的键的联合价值与他们。

但最好的选择保持不变。遍历注册表项是一种更好的方法，因为每个应用程序在注册表中都有一个条目[包括 Windows Installer 中的条目]。但是注册表方法是不安全的，因为好像有人删除了相应的键然后你不会知道应用程序条目。相反，更改 HKEY_Classes_ROOT\Installers 更加棘手，因为它与 Microsoft Office 或其他产品等许可问题相关联。对于更强大的解决方案，您始终可以将注册表替代方案与 WMI 结合使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-26T04:02:06.323

遍历“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall”键并检查它们的“DisplayName”值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-02-05T11:54:01.843

使用 Windows 安装程序 API！

它允许对所有程序进行可靠的枚举。注册表不可靠，但 WMI 是重量级的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-01-18T19:39:36.710

列表的对象：

```
public class InstalledProgram
{
    public string DisplayName { get; set; }
    public string Version { get; set; }
    public string InstalledDate { get; set; }
    public string Publisher { get; set; }
    public string UnninstallCommand { get; set; }
    public string ModifyPath { get; set; }
} 
```

创建列表的调用：

```
 List<InstalledProgram> installedprograms = new List<InstalledProgram>();
    string registry_key = @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall";
    using (RegistryKey key = Registry.LocalMachine.OpenSubKey(registry_key))
    {
        foreach (string subkey_name in key.GetSubKeyNames())
        {
            using (RegistryKey subkey = key.OpenSubKey(subkey_name))
            {
                if (subkey.GetValue("DisplayName") != null)
                {
                    installedprograms.Add(new InstalledProgram
                    {
                        DisplayName = (string)subkey.GetValue("DisplayName"),
                        Version = (string)subkey.GetValue("DisplayVersion"),
                        InstalledDate = (string)subkey.GetValue("InstallDate"),
                        Publisher = (string)subkey.GetValue("Publisher"),
                        UnninstallCommand = (string)subkey.GetValue("UninstallString"),
                        ModifyPath = (string)subkey.GetValue("ModifyPath")
                    });
                }
            }
        }
    } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-09-22T22:01:32.970

正如其他人指出的那样，接受的答案不会同时返回 x86 和 x64 安装。以下是我的解决方案。它创建一个`StringBuilder`，将注册表值附加到它（带有格式），并将其输出写入文本文件：

```
const string FORMAT = "{0,-100} {1,-20} {2,-30} {3,-8}\n";

private void LogInstalledSoftware()
{
    var line = string.Format(FORMAT, "DisplayName", "Version", "Publisher", "InstallDate");
    line += string.Format(FORMAT, "-----------", "-------", "---------", "-----------");
    var sb = new StringBuilder(line, 100000);
    ReadRegistryUninstall(ref sb, RegistryView.Registry32);
    sb.Append($"\n[64 bit section]\n\n{line}");
    ReadRegistryUninstall(ref sb, RegistryView.Registry64);
    File.WriteAllText(@"c:\temp\log.txt", sb.ToString());
}

   private static void ReadRegistryUninstall(ref StringBuilder sb, RegistryView view)
    {
        const string REGISTRY_KEY = @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall";
        using var baseKey = RegistryKey.OpenBaseKey(RegistryHive.LocalMachine, view);
        using var subKey = baseKey.OpenSubKey(REGISTRY_KEY);
        foreach (string subkey_name in subKey.GetSubKeyNames())
        {
            using RegistryKey key = subKey.OpenSubKey(subkey_name);
            if (!string.IsNullOrEmpty(key.GetValue("DisplayName") as string))
            {
                var line = string.Format(FORMAT,
                    key.GetValue("DisplayName"),
                    key.GetValue("DisplayVersion"),
                    key.GetValue("Publisher"),
                    key.GetValue("InstallDate"));
                sb.Append(line);
            }
            key.Close();
        }
        subKey.Close();
        baseKey.Close();
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-26T03:58:58.473

您最好的选择是使用[WMI](http://msdn.microsoft.com/en-us/library/aa394572(VS.85).aspx)。特别是[Win32_Product](http://msdn.microsoft.com/en-us/library/aa394378(VS.85).aspx)类。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-26T04:04:41.283

我是否建议您看一下 WMI（[Windows Management Instrumentation](http://msdn.microsoft.com/en-us/library/aa394582(VS.85).aspx)）。如果您将 System.Management 引用添加到您的 C# 项目，您将获得对“ManagementObjectSearcher”类的访问权限，您可能会发现它很有用。

[已安装应用程序](http://msdn.microsoft.com/en-us/library/aa390887(VS.85).aspx)有多种 WMI 类，但如果它是使用 Windows Installer 安装的，那么 Win32_Product 类可能最适合您。

```
ManagementObjectSearcher s = new ManagementObjectSearcher("SELECT * FROM Win32_Product"); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-06-25T10:35:49.213

我使用了尼克斯方法 - 我需要检查是否安装了 Visual Studio 的远程工具，这似乎有点慢，但在一个单独的线程中这对我来说很好。- 这是我的扩展代码：

```
 private bool isRdInstalled() {
        ManagementObjectSearcher p = new ManagementObjectSearcher("SELECT * FROM Win32_Product");
        foreach (ManagementObject program in p.Get()) {
            if (program != null && program.GetPropertyValue("Name") != null && program.GetPropertyValue("Name").ToString().Contains("Microsoft Visual Studio 2012 Remote Debugger")) {
                return true;
            }
            if (program != null && program.GetPropertyValue("Name") != null) {
                Trace.WriteLine(program.GetPropertyValue("Name"));
            }
        }
        return false;
    } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2017-06-21T14:02:14.007

我的要求是检查我的系统中是否安装了特定软件。此解决方案按预期工作。它可能会帮助你。我在 c# 中使用了一个带有 Visual Studio 2015 的 Windows 应用程序。

```
 private void Form1_Load(object sender, EventArgs e)
        {

            object line;
            string softwareinstallpath = string.Empty;
            string registry_key = @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall";
            using (var baseKey = Microsoft.Win32.RegistryKey.OpenBaseKey(RegistryHive.LocalMachine, RegistryView.Registry64))
            {
                using (var key = baseKey.OpenSubKey(registry_key))
                {
                    foreach (string subkey_name in key.GetSubKeyNames())
                    {
                        using (var subKey = key.OpenSubKey(subkey_name))
                        {
                            line = subKey.GetValue("DisplayName");
                            if (line != null && (line.ToString().ToUpper().Contains("SPARK")))
                            {

                                softwareinstallpath = subKey.GetValue("InstallLocation").ToString();
                                listBox1.Items.Add(subKey.GetValue("InstallLocation"));
                                break;
                            }
                        }
                    }
                }
            }

            if(softwareinstallpath.Equals(string.Empty))
            {
                MessageBox.Show("The Mirth connect software not installed in this system.")
            }

            string targetPath = softwareinstallpath + @"\custom-lib\";
            string[] files = System.IO.Directory.GetFiles(@"D:\BaseFiles");

            // Copy the files and overwrite destination files if they already exist. 
            foreach (var item in files)
            {
                string srcfilepath = item;
                string fileName = System.IO.Path.GetFileName(item);
                System.IO.File.Copy(srcfilepath, targetPath + fileName, true);
            }
            return;

        } 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2022-02-01T14:47:17.897

```
string[] registryKeys = new string[] {
@"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall",
@"SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall" };

public class InstalledApp
{
    public string DisplayName { get; set; }
    public string DisplayIcon { get; set; }
    public string Version { get; set; }
    public string InstallLocation { get; set; }
}

private void AddInstalledAppToResultView(RegistryHive hive, RegistryView view, string registryKey,Dictionary<string,InstalledApp> resultView)
{
    using (var key = RegistryKey.OpenBaseKey(hive, view).OpenSubKey(registryKey))
    {
        foreach (string subKeyName in key.GetSubKeyNames())
        {
            using (RegistryKey subkey = key.OpenSubKey(subKeyName))
            {
                var displayName = subkey.GetValue("DisplayName");
                var displayIcon = subkey.GetValue("DisplayIcon");
                if (displayName == null || displayIcon == null)
                    continue;

                var app = new InstalledApp
                {
                    DisplayName = (string)displayName,
                    DisplayIcon = (string)displayIcon,
                    InstallLocation = (string)subkey.GetValue("InstallLocation"),
                    Version = (string)subkey.GetValue("DisplayVersion")
                };

                if(!resultView.ContainsKey(app.DisplayName))
                {
                    resultView.Add(app.DisplayName,app);
                }
            }
        }
    }
}

void Main()
{
    var result = new Dictionary<string,InstalledApp>();
    var view = Environment.Is64BitOperatingSystem ? RegistryView.Registry64 : RegistryView.Registry32;
    AddInstalledAppToResultView(RegistryHive.LocalMachine, view, registryKeys[0],result);
    AddInstalledAppToResultView(RegistryHive.CurrentUser, view, registryKeys[0],result);
    AddInstalledAppToResultView(RegistryHive.LocalMachine, RegistryView.Registry64, registryKeys[1],result);

    Console.WriteLine("==============" + result.Count + "=================");
    result.Values.ToList().ForEach(item => Console.WriteLine(item));
} 
```

# javascript - 用于更改嵌入代码中的高度和宽度值的正则表达式

> ID：908863
> 
> 赞同：1
> 
> 时间：2009-05-26T04:00:10.953
> 
> 标签：javascript, regex, embed

你好

我有一个应用程序，用户可以在其中粘贴他们的嵌入代码。在显示时，我想将嵌入代码的高度和宽度更改为我选择的固定值。你能告诉我在嵌入代码中查找宽度和高度的正则表达式吗？宽度=“300”高度=“500”。我希望能够完全获得这两个值，以便可以替换它们。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T05:00:56.843

正则表达式根本不擅长解析 HTML（请参阅[您能否提供一些示例，说明为什么用正则表达式解析 XML 和 HTML 很困难？](https://stackoverflow.com/questions/701166)为什么）。您需要的是一个 HTML 解析器。请参阅[您能否提供一个使用您最喜欢的解析器解析 HTML 的示例？](https://stackoverflow.com/questions/773340)对于使用各种解析器的示例。

您可能对与 JavaScript 相关的两个答案感兴趣：[jQuery](https://stackoverflow.com/questions/773340/can-you-provide-an-example-of-parsing-html-with-your-favorite-parser/773978#773978)和[DOM](https://stackoverflow.com/questions/773340/can-you-provide-an-example-of-parsing-html-with-your-favorite-parser/773894#773894)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T04:23:28.137

以下示例考虑了排序、使用了哪些引号以及人们是否输入了空格

直接替换：

```
embeddedString = embeddedString.replace(/(width\s*=\s*["'])[0-9]+(["'])/ig, $1 + yourWidth + $2);
embeddedString = embeddedString.replace(/(height\s*=\s*["'])[0-9]+(["'])/ig, $1 + yourHeight + $2); 
```

或转换宽度：

```
embeddedString = embeddedString.replace(/width\s*=\s*["']["']/ig, function($0, $1)
{
    return $1 * 2;
}); 
```

如果你真的想删除整个东西，但使用值：

```
var originalWidth;
var originalHeight;
embeddedString = embeddedString.replace(/(?:width|height)\s*=\s*["']([0-9]+)["']\s*(?:width|height)\s*=\s*["']([0-9]+)["']/ig, function($0, $1, $2, $3, $4)
{
    // $0 = original string
    // $1 = either 'width' or 'height'
    // $2 = the value of width or height, depending on above
    // $3 = either 'width' or 'height'
    // $4 = the value of width or height, depending on above
    // here you might want to set another value, eg:
    originalWidth = $2;
    return "";
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T04:10:07.667

这个是这样做的：

```
width="(.*?)" height="(.*?)" 
```

并获取第一个和第二个值。您使用什么语言？实现可能会有所不同。

在 PHP 中：

```
 $pattern = '/width="(.*?)" height="(.*?)"/';
     $subject = 'width="500" height="300"';

     preg_match($pattern, $subject, $matches);

     print_r($matches); 
```

# c++ - 模板类表达式参数重载

> ID：908865
> 
> 赞同：0
> 
> 时间：2009-05-26T04:01:24.963
> 
> 标签：c++, templates, parameters, overloading

嘿，我想弄清楚是否可以用表达式参数“重载”模板类定义。有点像下面的代码片段。

```
template<class T>
class Test
{
public:
    T testvar;

    Test()
    {
        testvar = 5;
        cout << "Testvar: " << testvar << endl;
    }
};

template<class T>
class Test<T, int num>
{
public:
    T testvar;

    Test()
    {
        testvar = 10;

        cout << "Testvar: " << testvar << endl;
        cout << "Param: " << num << endl;
    }
}; 
```

谢谢。

编辑：为了记录，如果这不是很明显，我正在尝试用 C++ 来做到这一点...... :)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T04:16:01.770

模板允许默认模板参数，它可以提供类似于您正在寻找的东西..

```
template<class T, int num = -1>
class Test
{
public:
    T testvar;

    Test()
    {
        testvar = (num == -1 ? 10 : 5);

        cout << "Testvar: " << testvar << endl;
        if ( num != -1 )
            cout << "Param: " << num << endl;
    }
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T12:33:05.007

如果您希望能够只为 指定一个模板参数`Test`，则需要按照[Shmoopty 的建议](https://stackoverflow.com/questions/908865/template-class-expression-parameter-overloading/908898#908898)声明一个默认模板参数。

也可以部分专门化不同的参数值：

```
// This base template will be used whenever the second parameter is
// supplied and is not -1.
template<class T, int num = -1>
class Test
{
public:
    T testvar;

    Test()
    {
        testvar = 10;
        cout << "Testvar: " << testvar << endl;
        cout << "Param: " << num << endl;
    }
};

// This partial specialisation will be chosen
// when the second parameter is omitted (or is supplied as -1).
template<class T, int num>
class Test<T, -1>
{
public:
    T testvar;

    Test()
    {
        testvar = 5;
        cout << "Testvar: " << testvar << endl;
    }
}; 
```

这避免了对`if`or`switch`语句的需求，这使得它稍微快了一点（不执行运行时测试），并允许稍后以额外的部分专业化的形式“嫁接”额外的案例。（尽管哪种方法更清晰是个人品味的问题。）

# c# - 如何使用 ADO.NET 更新大表

> ID：908875
> 
> 赞同：4
> 
> 时间：2009-05-26T04:05:59.757
> 
> 标签：c#, ado.net

好的，这就是我必须解决的问题。我需要用 C# 编写一个方法来修改 SQL Server 2008 中的表。该表可能包含数百万条记录。修改包括通过添加新列来更改表，然后为表中的每一行计算和设置新字段的值。

添加列不是问题。问题在于有效地设置值。由于显而易见的原因，我不想将整个表读入 DataTable 然后更新和提交。我在想我想使用游标来遍历表中的行并一一更新它们。我还没有进行大量 ADO.NET 开发，但据我了解，仅支持只读服务器端 (firehose) 游标。

那么做这样的事情的正确方法是什么（最好使用 C# 中的一些示例代码）？不允许对 DB 进行存储过程或其他此类修改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T04:59:57.453

.jpg

下面是一个使用[NerdDinner](http://nerddinner.codeplex.com/)数据库和一些 SQLConnection、SQLCommand 和 SQLDataReader 对象的示例。**它为晚餐**表中的每个事件日期增加一天。

```
using System;
using System.Data.SqlClient;

namespace NerdDinner
{
    public class Class1
    {
        public void Execute()
        {
            SqlConnection readerConnection = new SqlConnection(Properties.Settings.Default.ConnectionString);
            readerConnection.Open();

            SqlCommand cmd = new SqlCommand("SELECT DinnerID, EventDate FROM Dinners", readerConnection);
            SqlDataReader reader = cmd.ExecuteReader();

            SqlConnection writerConnection = new SqlConnection(Properties.Settings.Default.ConnectionString);
            writerConnection.Open();

            SqlCommand writerCommand = new SqlCommand("", writerConnection);

            while (reader.Read())
            {
                int DinnerID = reader.GetInt32(0);
                DateTime EventDate = reader.GetDateTime(1);

                writerCommand.CommandText = "UPDATE Dinners SET EventDate = '" + EventDate.AddDays(1).ToString() + "' WHERE DinnerID = " + DinnerID.ToString();
                writerCommand.ExecuteNonQuery();
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T04:41:25.933

您的问题看起来像是您应该使用 T-SQL 而不是 C# 来解决的问题，除非有一些您正在动态选择的业务规则并且计算列值 T-SQL 应该是要走的路。只需编写一个存储过程或打开 Management Studio 并编写代码来进行更改。
如果这没有帮助，请详细说明您想对表做什么**，**然后我们可以帮助您确定这是否可以通过 T-SQL 完成。

[编辑] 你可以做这样的事情

```
 string sql = " USE "  + paramDbName;
    sql+= " ALTER TABLE XYZ ADD COLUMN " + param1 + " datatype etc, then put semicolon to separate the commands as well"
    sql+= " UPDATE  XYZ SET Columnx = " + some logic here
    cmd.CommandText = sql;
    cmd.ExecuteNonQuery(); 
```

在所需的 Sql Server 2008 实例上执行此操作。
如果文本行太多，请使用 StringBuilder。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T04:31:20.933

这是一个建议：您可以使用 DataReader 读取数据，为当前行创建更新命令并将其添加到命令列表中。然后在事务中运行更新命令。像这样的东西：

```
var commands=new List<SqlCommand>();
while(dr.Read())
{
var cmd=new SqlCommand();

cmd.CommandText="Add your command text here";
commands.Add(cmd);
}

using(var cnn=new SqlConnection("Connection String"))
{
IDbTransaction transaction;
try
{
cnn.Open();
transaction=cnn.BeginTransaction();
foreach(var cmd in commands)
{
cmd.Transaction=transaction;
cmd.ExecuteNonQuery();
cmd.Dispose(); 
}
transaction.Commit();
}
catch(SqlException)
{
if(transaction!=null)
transaction.Rollback();
throw;
}
} 
```

# c# - 检测 win 或 web 表单

> ID：908878
> 
> 赞同：0
> 
> 时间：2009-05-26T04:07:37.743
> 
> 标签：c#, configuration, web-config, app-config

检测当前应用程序是赢还是网络表单（或其他）应用程序的任何可靠的优雅方法？

我们有一个通用的配置类，它需要打开 app.config 或 web.config。

目前，我在尝试 OpenExeConfiguration 时遇到了 ArgumentException，但它不是很优雅，可能会掩盖其他问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T04:16:45.047

我通常检查是否有可用的 HttpContext（如果它是 Web 应用程序，因为在 Web 服务`HttpContenxt.Current`中为空）为此，您应该添加`System.Web`到您的引用中。

```
if(HttpContext.Current!=null)
//It's a web application
else
//it's a win application 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T04:10:01.660

尝试使用依赖注入，这样配置类就不必执行 switch 语句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T04:18:45.140

您可以尝试通过 获取正在执行的进程[`Process.GetCurrentProcess()`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.getcurrentprocess.aspx)，可能您可以检查[`Process.MainWindowHandle`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.mainwindowhandle.aspx)is not `IntPtr.Zero`，或者检查进程名称，或者可能扫描进程的加载模块。这将有一个优势（我假设），不需要您加载当前执行上下文不需要的程序集（例如，当该应用程序是 Web 应用程序时，不要加载 System.Windows.Forms.dll）。

然而，这似乎不优雅。

# string - str.find() 遇到问题

> ID：908879
> 
> 赞同：1
> 
> 时间：2009-05-26T04:09:33.267
> 
> 标签：string, python-3.x, text-parsing

我正在尝试使用 str.find() 并且它不断引发错误，我做错了什么？

```
import codecs

    def countLOC(inFile):
        """ Receives a file and then returns the amount
            of actual lines of code by not counting commented
            or blank lines """

        LOC = 0  
        for line in inFile:
            if line.isspace():
                continue
            comment = line.find('#')
            if comment > 0:
                for letter in range(comment):
                    if not letter.whitespace:
                        LOC += 1
                        break            
        return LOC

    if __name__ == "__main__":
        while True:
            file_loc = input("Enter the file name: ").strip()
            try:
                source = codecs.open(file_loc)
            except:
                print ("**Invalid filename**")
            else:
                break 
        LOC_count = countLOC(source)

        print ("\nThere were {0} lines of code in {1}".format(LOC_count,source.name)) 
```

错误

```
 File "C:\Users\Justen-san\Documents\Eclipse Workspace\countLOC\src\root\nested\linesOfCode.py", line 12, in countLOC
        comment = line.find('#')
    TypeError: expected an object with the buffer interface 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T05:16:39.773

使用内置函数`open()`代替`codecs.open()`.

您正在与非 Unicode (Python 3 `bytes`, Python 2 `str`) 和 Unicode (Python 3 `str`, Python 2 `unicode`) 字符串类型之间的区别发生冲突。Python 3 不会像 Python 2 那样在非 Unicode 和 Unicode 之间自动转换。使用不带参数的 codecs.open() 会`encoding`返回一个对象，`bytes`当您读取它时会产生该对象。

此外，您的`countLOC`功能将不起作用：

```
for letter in range(comment):
    if not letter.whitespace:
        LOC += 1
        break 
```

该 for 循环将遍历从零到比`'#'`字符串 ( `letter = 0, 1, 2...`) 中的位置小一的数字；`whitespace`不是整数方法，即使是，您也不会调用它。

此外，如果该行不包含`#`.

您的“固定”但在其他方面忠实（且效率低下）的版本`countLOC`：

```
def countLOC(inFile):
    LOC = 0  
    for line in inFile:
        if line.isspace():
            continue
        comment = line.find('#')
        if comment > 0:
            for letter in line[:comment]:
                if not letter.isspace():
                    LOC += 1
                    break
        else:
            LOC += 1
    return LOC 
```

我如何编写函数：

```
def count_LOC(in_file):
    loc = 0  
    for line in in_file:
        line = line.lstrip()
        if len(line) > 0 and not line.startswith('#'):
            loc += 1
    return loc 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T04:17:26.060

您实际上是在将打开的文件传递给函数吗？也许尝试打印类型（文件）和类型（行），因为这里有些可疑 - 以打开的文件作为参数，我无法重现您的问题！（您的代码中还有其他错误，但没有一个错误会导致该异常）。哦，顺便说一句，作为最佳实践，不要`file`出于自己的目的使用内置函数的名称，例如 —— 这会导致令人难以置信的混乱！

# networking - 你能为我推荐一些网络论文吗？

> ID：908891
> 
> 赞同：-1
> 
> 时间：2009-05-26T04:11:49.397
> 
> 标签：networking

这个学期我正在学习计算机网络，我觉得学习为什么互联网设计成今天这样很有趣。我也喜欢阅读教学幻灯片中提到的论文，例如*系统设计中的端到端论证*和*DARPA 互联网协议的设计哲学*。

您能否向我推荐一些其他有趣的论文/文章，尤其是那些与 TCP/IP 协议等更高层相关的文章？

非常感谢您的回复。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T04:14:42.987

一般来说，Andrew Tanenbaum 的书都值得一读。它们通常用作网络课程的标准讲座。

另一方面，它们是相当基础的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T08:34:02.290

Roy Thomas Fielding 在 UCI 撰写了关于*架构风格和基于网络的软件架构设计的*论文（2000 年），该论文更多地关注网络环境中的应用程序；但我会推荐它，因为它与您关于 *了解 Internet 为何像今天这样设计*的要求有关。

链接：[架构风格和基于网络的软件架构设计](http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-01T12:54:47.790

一本经典著作是 Radia Perlman 的“互连第二版”。

另一个非常好的是Christian Huiitema 的“Routing in the Internet”。

如果您认真学习互联网的工作原理，您还需要了解 BGP。一个不错的介绍是 John Stewart 的“Internet 中的 BGP4 域间路由”。

更高级的主题是 MPLS。Ina Minei 和 Julian Lucek 的“MPLS-Enabled Applications”是一本非常好的书。

另一个更高级的主题是多播。我可以推荐 Brian Edwards 和其他人的“域间多播路由”。

如果您对如何配置网络设备的更实用细节感兴趣，思科出版社出版的书籍往往很好（尽管显然是特定于供应商的）。

最后，如果您想进行网络编程，Richard Stevens 的“Unix Network Programming, Volume 1”是必读的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T04:13:39.197

[http://www.cs.ucsb.edu/~almeroth/classes/F05.276/papers/vegas.pdf](http://www.cs.ucsb.edu/~almeroth/classes/F05.276/papers/vegas.pdf)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T04:29:31.383

我不确定这是否正是您要寻找的，但有一些关于点对点网络的非常有趣的论文。

一些例子：

*   Chord：面向 Internet 应用程序的可扩展点对点查找服务
*   激励措施在 BitTorrent 中建立稳健性
*   使用 Freenet 保护在线自由表达

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-26T04:31:53.413

如果您想了解 TCP/IP 协议是**什么**（不是*为什么*），经典书籍是*[TCP/IP Illustrated, Volume 1: The Protocols](https://rads.stackoverflow.com/amzn/click/com/0201633469)*。

# .net - 您如何为 .NET 项目实施持续集成？

> ID：908896
> 
> 赞同：2
> 
> 时间：2009-05-26T04:13:57.200
> 
> 标签：.net, continuous-integration

我的公司目前使用 CruiseControl.NET，我觉得配置起来很麻烦。您使用什么 CI 解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T05:03:14.657

试试[CiFactory](http://code.google.com/p/ci-factory/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T04:25:49.853

我们使用[TeamCity](http://www.jetbrains.com/teamcity/index.html)，它需要花费一些硬币，但与巡航控制相比是一个巨大的进步。它简单、易于配置，并为您的构建提供大量反馈。我强烈推荐它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T15:23:43.510

在我目前的项目中，我们使用的是 Atlassian 的[Bamboo](http://www.atlassian.com/software/bamboo/)。我喜欢它，如果您使用 JIRA 进行错误跟踪，它有一些非常不错的插件可用。

真正帮助我们的是它非常灵活。我们有多个 Java 和 .NET 应用程序，Bamboo 可以很好地处理它们。它不是免费的，但如果你有一个复杂的环境和构建系统，它工作得很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T04:20:37.967

我还没有尝试过，但我听说 Team Foundation 有一些功能可以让您进行自动构建。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-26T13:26:08.787

我们曾经使用[Cruise Control](http://cruisecontrol.sourceforge.net/)，但现在改为使用[TeamCity](http://www.jetbrains.com/teamcity/index.html)。

自动化构建工作得非常好，我们现在不想在没有它的情况下进行开发。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T15:16:31.497

我们在这里使用[Zed 构建和错误](http://www.hericus.com/)。他们有一个免费用于小型设置的社区版，以及一个用于大型项目/使用的商业版。

不错的功能：无需编辑 XML 来定义您的构建，整个过程使用非常干净和一致的 UI 完成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T06:39:11.073

我们使用 JetBrains 的 CC 或 TeamCity（它是免费的）。任何一天我都会选择 TeamCity 而不是 CC。

# emacs - Emacs 的 dired 模式下的图标

> ID：908899
> 
> 赞同：6
> 
> 时间：2009-05-26T04:16:35.093
> 
> 标签：emacs, dired

我想使用 emacs 的 dired 模式作为我的文件浏览器。我非常喜欢看到文件/文件夹的图标，而不是看到扩展名和颜色。这些图标给了我一个非常快速的视觉反馈。我在网上搜索了显示图标的 dired，但没有找到。所以我想知道是否有可能做到这一点，如果可以，怎么做？

明确提出我的问题

如何在 Emacs 的 dired 模式下显示文件和文件夹的图标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T09:42:27.567

如果您使用的是 Windows，可以尝试`dired-dispicon.el`. [从这里](http://ring.riken.jp/archives/elisp/gohome/junk/)获取相关文件。请参阅[http://wiki.gohome.org/teranisi/?EmacsOnWindows](http://wiki.gohome.org/teranisi/?EmacsOnWindows)了解它的外观。请注意，您可能需要支持图像的 emacs 版本（例如，对于 Windows，您可以尝试[EmacsW32](http://ourcomments.org/Emacs/EmacsW32.html)）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2020-03-17T23:32:43.117

[all-the-icons-dired](https://github.com/jtbm37/all-the-icons-dired)是一个更新的解决方案。另一个看起来不错的选项是使用[treemacs-icons-dired](https://github.com/Alexander-Miller/treemacs#treemacs-icons-dired)

我刚刚切换到 treemacs-icons-dired 并推荐它。只需安装软件包并添加一个模式挂钩，如：

```
(add-hook 'dired-mode-hook 'treemacs-icons-dired-mode) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-10-21T15:50:52.410

使用适用于 GTK（在 Linux 上）的[dired-icon扩展。](https://gitlab.com/xuhdev/dired-icon)

免责声明：我是扩展的作者。

# c# - 获取硬件信息

> ID：908902
> 
> 赞同：4
> 
> 时间：2009-05-26T04:17:00.617
> 
> 标签：c#, .net-3.5, .net-2.0, c#-3.0, c#-2.0

如何使用 c# 代码获取系统的硬件信息？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-26T04:20:07.560

您可以使用 System.Management 命名空间来检索使用 C# 的计算机的硬件信息。

[这是一篇在 C# 中检索硬件信息的文章](http://www.codeproject.com/KB/system/hardware_properties_c_.aspx)。

这是[WMI](http://msdn.microsoft.com/en-us/library/aa394582(VS.85).aspx)类[的](http://msdn.microsoft.com/en-us/library/aa394554(VS.85).aspx)列表。

# java - Java 系统属性的范围

> ID：908903
> 
> 赞同：56
> 
> 时间：2009-05-26T04:17:12.177
> 
> 标签：java, jvm, system-properties

在 Java 中，我们使用 System.setProperty() 方法来设置一些系统属性。根据[这篇文章](http://blogs.oracle.com/foo/entry/monitored_system_setproperty)，系统属性的使用有点棘手。

> System.setProperty() 可能是一个邪恶的调用。
> 
> *   它是 100% 线程敌对的
> *   它包含超全局变量
> *   当这些变量在运行时发生神秘变化时，调试起来非常困难。

我的问题如下。

1.  系统属性的范围如何？它们是特定于每个虚拟机的，还是具有“超级全局性质”，在每个虚拟机实例上共享相同的属性集？我猜选项1

2.  是否有任何工具可用于监视运行时更改以检测系统属性的更改。（只是为了便于问题检测）

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-05-26T04:44:38.487

**系统属性的范围**

至少通过阅读该[`System.setProperties`](http://java.sun.com/javase/6/docs/api/java/lang/System.html#setProperties(java.util.Properties))方法的 API 规范，我无法得到系统属性是否由 JVM 的所有实例共享的答案。

为了找出答案，我编写了两个快速程序，它们将通过 设置系统属性`System.setProperty`，使用相同的键，但值不同：

```
class T1 {
  public static void main(String[] s) {
    System.setProperty("dummy.property", "42");

    // Keep printing value of "dummy.property" forever.
    while (true) {
      System.out.println(System.getProperty("dummy.property"));
      try {
        Thread.sleep(500);
      } catch (Exception e) {}
    }
  }
}

class T2 {
  public static void main(String[] s) {
    System.setProperty("dummy.property", "52");

    // Keep printing value of "dummy.property" forever.
    while (true) {
      System.out.println(System.getProperty("dummy.property"));
      try {
        Thread.sleep(500);
      } catch (Exception e) {}
    }
  }
} 
```

（请注意，运行上面的两个程序会使它们进入无限循环！）

事实证明，当使用两个单独`java`的进程运行这两个程序时，一个 JVM 进程中设置的属性值不会影响另一个 JVM 进程的值。

我应该补充一点，这是使用 Sun 的 JRE 1.6.0_12 的结果，并且至少在 API 规范中没有定义这种行为（或者我无法找到它），行为可能会有所不同。

**是否有任何工具可以监控运行时更改**

据我所知不是。但是，如果确实需要检查系统属性是否有更改，则可以一次保留 的副本`Properties`，并将其与另一个调用进行比较`System.getProperties`-- 毕竟，[`Properties`](http://java.sun.com/javase/6/docs/api/java/util/Properties.html)它是 的子类[`Hashtable`](http://java.sun.com/javase/6/docs/api/java/util/Hashtable.html)，因此比较将是以类似的方式进行。

下面的程序演示了一种检查系统属性是否发生变化的方法。可能不是一个优雅的方法，但它似乎完成了它的工作：

```
import java.util.*;

class CheckChanges {

  private static boolean isDifferent(Properties p1, Properties p2) {
    Set<Map.Entry<Object, Object>> p1EntrySet = p1.entrySet();
    Set<Map.Entry<Object, Object>> p2EntrySet = p2.entrySet();

    // Check that the key/value pairs are the same in the entry sets
    // obtained from the two Properties.
    // If there is an difference, return true.
    for (Map.Entry<Object, Object> e : p1EntrySet) {
      if (!p2EntrySet.contains(e))
        return true;
    }
    for (Map.Entry<Object, Object> e : p2EntrySet) {
      if (!p1EntrySet.contains(e))
        return true;
    }

    return false;
  }

  public static void main(String[] s)
  {
    // System properties prior to modification.
    Properties p = (Properties)System.getProperties().clone();
    // Modification of system properties.
    System.setProperty("dummy.property", "42");
    // See if there was modification. The output is "false"
    System.out.println(isDifferent(p, System.getProperties()));
  }
} 
```

**属性不是线程安全的？**

[`Hashtable`](http://java.sun.com/javase/6/docs/api/java/util/Hashtable.html) *是 thread-safe*，所以我期待它`Properties`也是如此，事实上，[`Properties`](http://java.sun.com/javase/6/docs/api/java/util/Properties.html)该类的 API Specifications 证实了这一点：

> 这个类是线程安全的：多个线程可以共享一个`Properties` 对象而不需要外部同步。，[序列化形式](http://java.sun.com/javase/6/docs/api/serialized-form.html#java.util.Properties)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-08-30T00:04:21.353

系统属性是每个进程的。这意味着它们比静态字段更具全局性，静态字段是每个类加载器。因此，例如，如果您有一个运行多个 Java webapps 的 Tomcat 实例，每个实例都有一个`com.example.Example`带有名为 的静态字段的类`globalField`，那么这些 webapps 将共享系统属性，但`com.example.Example.globalField`可以在每个 webapp 中设置为不同的值。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-26T04:39:53.593

每个 VM 有一份属性副本。它们与其他静态（包括单例）有很多相同的问题。

我想，作为一个黑客，你调用`System.setProperties`一个版本的`Properties`响应会根据上下文（线程、调用堆栈、一天中的时间等）而有所不同。它还可以记录任何更改`System.setProperty`。您还可以为`SecurityManager`相关权限设置日志安全检查。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-26T04:38:56.013

是的，“系统属性”是每个虚拟机的（尽管有许多“神奇”属性包含有关主机系统的信息，例如：“os.name”、“os.arch”等）。

至于您的第二个问题：我不知道这样的工具，但如果您担心系统属性会发生变化，您可以使用特殊的[SecurityManager](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/SecurityManager.html)来防止（甚至可能跟踪）系统属性更改。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-26T04:41:28.337

它们的范围是正在运行的 JVM，但除非您有一些深奥的类加载器问题，否则带有属性对象的静态变量将执行相同的操作，并且有机会同步或执行您需要的任何其他操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-10-26T07:23:55.053

当您启动一个新的 JVM 时，它会复制环境变量并将它们用于它的所有生命周期。因此，如果您对该环境进行更改，它们将仍然局限于此。我遇到并正在调查的奇怪行为略有不同：如果我启动一个 JVM，它声明了一些影响我在应用程序中使用的库的行为的环境变量（cmd 行上的 -D 参数）。但是，如果在 java 代码中（它们是可见的），我对它们进行了更改，那么这些更改似乎不会影响库的行为。奇怪的是我们在同一个JVM中！

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-26T05:50:39.093

你没有说你使用系统属性的动机是什么。

我们使用 Spring 进行配置，并使用注入 XML 的属性文件设置初始属性。应用程序运行时对配置的更改是使用 JMX 进行的。

当然，还有许多其他方法可以使用属性文件、基于 xml 的配置等来更改 Java 中的配置。

# ruby-on-rails - Rails 枚举类型或替代方案

> ID：908906
> 
> 赞同：26
> 
> 时间：2009-05-26T04:17:58.200
> 
> 标签：ruby-on-rails, enums

我只是在 Rails 上学习 ruby​​，我有一个用户角色表（所有者、管理员和用户）。代码中会有一些地方我需要检查用户的角色并显示不同的选项。有谁知道如何在不使用幻数或其他丑陋方法的情况下做到这一点？

在我工作过的 ASP.Net Web 应用程序中，我看到这是通过使用枚举类型完成的：

```
public enum UserRole { Owner = 1, Admin = 2, User = 3 }

// ...

if (user.Role == UserRole.Admin)
    // Show special admin options 
```

数据库中的每个不同角色都反映为枚举类型，其值设置为数据库中该角色的 ID。这似乎不是一个很好的解决方案，因为它取决于可能改变的数据库知识。即使这是处理此类事情的正确方法，我也不知道如何在 rails 中使用枚举类型。

我将不胜感激对此事的任何见解。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-26T05:38:20.367

Ruby 本身没有枚举类型，但是这个站点显示了一个方法[http://www.rubyfleebie.com/enumerations-and-ruby/](http://www.rubyfleebie.com/enumerations-and-ruby/)

你可以在你的用户模型中做这样的事情：

```
#constants
OWNER = 1
ADMIN = 2
USER = 3

def is_owner?
  self.role == OWNER
end

def is_admin?
  self.role == ADMIN
end

def is_user?
  self.role == USER
end 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-12-26T19:32:50.700

Rails 4.1 中添加的功能是您想要的吗？

[http://coherence.io/blog/2013/12/17/whats-new-in-rails-4-1.html](http://coherence.io/blog/2013/12/17/whats-new-in-rails-4-1.html)

从博文复制：

```
class Bug < ActiveRecord::Base
  # Relevant schema change looks like this:
  #
  # create_table :bugs do |t|
  #   t.column :status, :integer, default: 0 # defaults to the first value (i.e. :unverified)
  # end

  enum status: [ :unverified, :confirmed, :assigned, :in_progress, :resolved, :rejected, :reopened ]

...

Bug.resolved           # => a scope to find all resolved bugs
bug.resolved?          # => check if bug has the status resolved
bug.resolved!          # => update! the bug with status set to resolved
bug.status             # => a string describing the bug's status
bug.status = :resolved # => set the bug's status to resolved 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-24T12:40:14.843

[这似乎是使用我的classy_enum](https://github.com/beerlington/classy_enum) gem的一个很好的案例。它本质上允许您定义一组固定的选项，其中每个选项都是具有特定于它的行为和属性的类。它有助于减少分散在整个应用程序中的所有条件逻辑。

例如，如果你正在做这样的事情：

```
class User < ActiveRecord::Base
  def options
    if user.is_admin?
      [...admin options...]
    else
      [...non admin options...]
    end
  end
end 
```

然后调用为：`user.options`其他地方......

classy_enum 允许您将该逻辑移动到一个单独的位置，并具有相同的功能而没有条件逻辑：

```
class User < ActiveRecord::Base
  classy_enum_attr :role

  delegate :options, :to => :role
end 
```

[自述文件](https://github.com/beerlington/classy_enum/blob/master/README.md)有一个工作示例并详细描述了 gem。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-26T14:47:04.190

对于这种情况，我更喜欢使用恰当命名的[授权](http://github.com/DocSavage/rails-authorization-plugin/tree/master/)插件。

这会让你

```
permit "role" 
```

限制对角色的访问，以及

```
permit? "role" 
```

简单地测试访问。这两个都委托给`User#has_role?(role)`.

不要觉得你必须使用他们的`ObjectRoles`实现。您可以使用`Hardwired`角色，然后实现自己的`User#has_role?(role)`方法来使用现有模式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-11T03:14:16.470

刚开始学习 Rails（来自 C#），并且有同样的问题。似乎 Rails 并没有真正的枚举，因为哲学不同。我会使用大量枚举来尝试组织 C# 项目中的所有细节，但也许因为 Rails 为您处理了这么多，它们并不那么重要。这不是一个真正的答案，只是一个观察。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-09T02:19:00.403

rubyforge 上有一个[枚举插件，所以你可以这样做：](http://enum-column.rubyforge.org/)

```
t.column :severity, :enum, :limit => [:low, :medium, :high, :critical] 
```

使用`:limit`属性传递参数是相当丑陋的，但它是一种更标准化的方式。

要安装，只需：

```
script/plugin install svn://rubyforge.org/var/svn/enum-column/plugins/enum-column 
```

它目前适用于 Rails 2.2.2 或更高版本。Rubyforge 链接：www.rubyforge.org/projects/enum-column/

# asp.net - 处理潜在覆盖后，如何遵循 ASP.NET MVC 的“默认”HttpHandler？

> ID：908910
> 
> 赞同：2
> 
> 时间：2009-05-26T04:18:35.733
> 
> 标签：asp.net, asp.net-mvc, url-rewriting

我需要为 MVC 实现一个自定义处理程序，让我首先查看 URL 请求，以确定它是否应该在将 URL 提交给路由引擎之前重写 url。任何模式都是重定向的候选者，所以我需要在标准 MVC 路由引擎查看它之前拦截 URL 请求。

在查看了一大堆为 ASP.NET MVC 实现自定义路由的示例、博客、文章等之后，我仍然没有找到适合我的场景的用例。我们有一个现有的 ASP.NET 实现可以正常工作，但是当没有匹配覆盖时，我们将返回“标准”处理程序。我们目前使用的技术与这篇 MSDN 文章中描述的技术非常相似：http: [//msdn.microsoft.com/en-us/library/ms972974.aspx#urlrewriting_topic5](http://msdn.microsoft.com/en-us/library/ms972974.aspx#urlrewriting_topic5)说“HTTP 处理程序工厂可以返回 HTTP System.Web.UI.PageParser 类的 GetCompiledPageInstance() 方法返回的处理程序。（这与内置 ASP.NET 网页 HTTP 处理程序工厂 PageHandlerFactory 的工作原理相同。）“。

我想弄清楚的是：如果当前请求与任何动态配置的（通过数据表）值不匹配，我如何才能首先查看传入的请求，然后将其传递给 MVC 路由？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T13:24:58.460

您需要：

1.  不使用 global.asax 中的标准 MapRoute 扩展方法（这是设置路由处理程序的方法）。
2.  相反，编写您自己的路由子类型，[如下所示](http://blog.maartenballiauw.be/post/2009/05/20/ASPNET-MVC-Domain-Routing.aspx "ASP.NET MVC 域路由")。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T19:56:40.150

尽管我向 Craig 解释说我可能不再需要覆盖场景（更喜欢未来而不是过去），但我意识到有一个简单且相当干净的地方可以实现此覆盖 - 在 Default.aspx 代码隐藏文件中。这是标准的 Page_Load 方法：

```
 public void Page_Load(object sender, System.EventArgs e)
    {
        // Change the current path so that the Routing handler can correctly interpret
        // the request, then restore the original path so that the OutputCache module
        // can correctly process the response (if caching is enabled).

        string originalPath = Request.Path;
        HttpContext.Current.RewritePath(Request.ApplicationPath, false);
        IHttpHandler httpHandler = new MvcHttpHandler();
        httpHandler.ProcessRequest(HttpContext.Current);
        HttpContext.Current.RewritePath(originalPath, false);
    } 
```

如您所见，在 MVC 处理程序前面添加一个 url 处理拦截器非常容易。这会改变标准的默认页面行为，并且需要反映在您想要使用相同方法创建的任何其他 MVC 应用程序中，但它看起来确实可行。

# java - 使用 JBoss Cache 作为 Apache Lucene 的目录

> ID：908916
> 
> 赞同：1
> 
> 时间：2009-05-26T04:20:55.097
> 
> 标签：java, caching, jboss, lucene, directory

有没有人尝试将 Lucene 索引存储在 JBoss Cache 中？Lucene Directory 有什么好的实现吗？我只找到了[这个](http://viewvc.jboss.org/cgi-bin/viewvc.cgi/jbosscache/jbosscache-lucene/jbosscache/src/java/org/apache/lucene/store/jbosscache/)的来源，但我找不到任何文档或推荐。

基本上我想做的是将 Lucene 索引存储在 JBoss Cache 中，并使用使用 GridGain 支持编写的应用程序来操作它（GridGain 几乎开箱即用地支持 JBoss Cache）。

请分享你的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T14:22:11.543

JBossCache 并不适合作为 lucene 的目录介质，因为它没有文件锁定功能，而且它的原子性充其量是模糊的。这些都不能形成良好的一致索引。

您可能有兴趣了解 Compass 项目的作用（Compass 对 Lucene 的作用就像 Hibernate 对 JDBC 的作用）。Compass 支持[使用许多 3rd 方分发技术来存储索引](http://www.compass-project.org/docs/2.2.0/reference/html/compass-needle.html)，但 JBoss Cache 不是其中之一。我相信它被尝试过，并被放弃，因为它只是没有用。

# objective-c - Objective-C 异步回调来自

> ID：908920
> 
> 赞同：1
> 
> 时间：2009-05-26T04:21:34.970
> 
> 标签：objective-c, cocoa, cocoa-touch

我正在尝试创建一个处理一些 NSURLConnection 和身份验证内容的类，然后在完成 didReceiveData 事件后对 downloadFinished 进行回调。这在 Objective-C 中究竟是如何工作的？谢谢！

```
#import "fetch.h"

...

- (IBAction)downloadButton {
    fetch *downloader = [[fetch alloc] init];

    [downloader setAuth:Username.text password:Password.text saveName:@"test.txt"];
    [downloader download:@"http://google.com"];
}

-(void)downloadFinished:(NSString *)fileName
{
...
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-26T05:01:15.067

[在 URL 加载系统指南的使用 NSURLConnection](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html)部分中有一个很好的例子。

# ruby-on-rails - 在 Rails 上，form_for 和 validate_presence_of 如何协同工作？

> ID：908933
> 
> 赞同：2
> 
> 时间：2009-05-26T04:27:32.087
> 
> 标签：ruby-on-rails

当我们在模型中有 validate_presence_of :name 时，然后当我们放入重新渲染“新”的创建操作时，form_for 将填充字段，而 error_messages_for 'story' 将具有正确的错误消息。

这真的很棒，同时，这看起来像魔术……我发现很多书都没有解释魔术是如何发生的。是通过一些全局变量吗？

当 form_for 被调用时......它是否使用从@story.save 返回的@story，而不是来自新操作的@story = Story.new？所以如果我使用 :story 作为form_for，字段不会在错误时填充？

有时我觉得在使用 Ruby on Rails 时我在玩魔法，但我不知道魔法是如何发生的……有点像我让兔子出现，但我不知道我是怎么做到的。所以我真的很想知道 Rails 的内部工作原理。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-26T04:52:29.087

是的，Rails 非常神奇。不幸的是，这些只是你必须学会​​接受的东西，一旦你习惯了这些约定，你就可以使用魔法轻松地完成一些非常复杂的事情。

这里有三个单独的问题，它们单独相对简单，但当你一次全部考虑在内时看起来非常神奇。让我们一一分解：

**当验证失败时，它们不允许保存模型对象并将错误添加到 object.errors 哈希中。**

当您运行 @story.save 时，它​​会启动所有验证。由于 @story.name 为空， validates_presence_of :name 将错误添加到对象。

**控制器中的实例变量可用于它们呈现的视图。**

所以，是的，它是视图可以访问的同一个@story - 一个无效并且附加了错误信息的那个。

**form_for 有很多种形式，你用的那个很聪明**

您视图中的 form_for 标记可能如下所示：

```
<%= form_for @story do |story| => 
```

这是 form_for 的一个特殊版本，它从传入的对象中推断出各种信息并适当地呈现表单。由于这条线，@story 填充了一些字段

```
@story = params[:story] 
```

in your controller, so it goes ahead and fills in those fields for you. It does some other things, too - for example, it checks @story.new_record? to see if it should use the POST HTTP method (RESTful create) or the PUT method (RESTful update).

In summary, there are lots of little bits of magic to learn, but once you do the big magic is much easier to understand. Good luck!

# apache - 需要帮助将 apache .htaccess 代码转换为 lighttpd url_rewrite 代码

> ID：908934
> 
> 赞同：1
> 
> 时间：2009-05-26T04:28:05.457
> 
> 标签：apache, url-rewriting, rewrite, lighttpd, translate

我有这个基于 XAMPP 构建的自定义编写的 CMS。我正在尝试在 lighttpd 上进行相同的测试，以对所谓的性能提升进行基准测试……但我陷入了重写规则。我在 .htaccess 中使用 WordPress 的默认重写规则，只要没有与 URL 结构相同的任何文件或目录，它会将所有 url 解析交给我的脚本。这是代码：

```
RewriteBase /somedir/

# Let the Script handle all pretty URLs
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteCond %{SCRIPT_FILENAME} !-f
RewriteRule .* index.php [L] 
```

谁能帮我把它翻译成 lighttpd 格式？我只能（部分）自己通过轻量级文档找出最后一行……即

```
url.rewrite-once = ( ".*" => "index.php" ) 
```

但这当然还不够……我的 CMS 所做的只是给我 404。

谢谢，显微镜^地球

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T04:54:41.097

您可以尝试将 php 脚本设置为 404 URL：

```
server.error-handler-404 = "/404.php" 
```

然后在此脚本中设置变量（例如 $_GET），然后包含目标脚本。

# oop - 使用像 IStartable 这样的概念有什么好处？

> ID：908941
> 
> 赞同：3
> 
> 时间：2009-05-26T04:32:39.390
> 
> 标签：oop, dependency-injection, inversion-of-control, object-lifetime

而不是使用这样的接口：

```
public interface IStartable
{
    void Start();
    void Stop();
} 
```

我通常只是让对象的构造函数运行 Start() 代码，并实现 IDisposable 以便 dispose 方法运行 Stop() 代码。

只是风格问题吗？还是因为没有像 IStartable 这样的东西而错过了一些重要的东西？我所看到的只是额外的复杂性，因为您必须保持它的启动/停止状态。

使用 start/stop 与使用 ctor/dispose 的优缺点是什么，尤其是在 IoC/DI 容器的上下文中？

*编辑：很好的答案，你已经说服我使用可启动对象的界面。我无法决定谁的答案最好，所以我会在 24 小时后接受投票最多的人。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-26T04:40:19.850

使用界面的一般优势是它们是自我描述和自我广告的。如果没有接口，你就没有办法问一个对象，“你能不能启动和停止？” 相反，如果您确实使用接口，则可以查询对象以查看它们中的哪些将响应这些类型的消息。那么你就可以放心地保证这些对象已经实现了接口封装的功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-26T04:40:37.073

一般来说，构造函数应该产生一个正确初始化的对象

仅此而已！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T04:47:00.107

它可能取决于你说 Start() 时的具体含义。但总的来说，将对象初始化与例程执行（尤其是有状态和/或长时间运行的执行！）混合在一起违反了[SoC](http://en.wikipedia.org/wiki/Separation_of_concerns)。

It also leaves a great deal of ambiguity. To a consumer, for a given object how do we know it is "starting" when we invoke the ctor? "For this given object, which implements no contract, I must leave it to hope in the author that it conforms to my expectations"? An interface makes the presence and availability of the action explicit.

# delphi - 如何使用 Open Tools API 检测 IDE 中的文件是否正在编辑

> ID：908942
> 
> 赞同：6
> 
> 时间：2009-05-26T04:33:27.050
> 
> 标签：delphi, ide, opentools

我使用访问 ClearCase 的 Open Tools API 制作了一个小型 IDE 插件。它有菜单项“签入”、“签出”等。它工作正常，但如果我开始在 IDE 编辑器中输入或尝试保存文件，我希望它自动签出只读文件。你认为这可能吗？

我尝试了一些东西，但最终放弃了。IOTAEditorServices.KeyboardServices 具有看起来很有希望的 AddKeyboardBinding 方法。使用它，我添加了一个绑定类型为 btPartial 的通知程序（后来尝试了 btComplete），插件开始检测一些快捷键按下，但不是所有的键盘事件，远非如此......任何想法将不胜感激！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-26T08:00:18.723

我认为一种“更干净”的方法是将 a`IOTAEditorNotifier`连接到每个编辑器，并`IOTAEditor.Modified`在编辑器的内容被修改时由 IDE 调用您的方法，无论是通过键盘、鼠标还是以编程方式从另一个插件。

[这](http://cc.embarcadero.com/Item/17217)是一个示例，它注册一个`IOTAIDENotifier`要在 IDE 中打开文件的通知，以便它可以注册其`IOTAEditorNotifier`实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T07:03:27.373

我一定有可能：我们在这里使用 SourceConexion ( [http://www.epocalipse.com/scx.htm](http://www.epocalipse.com/scx.htm) )，它会在您编辑源代码或更改表单之前自动签出文件。

JVCS 有 IDE 集成支持，它是开源的，也许他们也实现了这个：http: [//jedivcs.sourceforge.net/](http://jedivcs.sourceforge.net/)

# c++ - 关于C++中赋值运算符的问题

> ID：908946
> 
> 赞同：1
> 
> 时间：2009-05-26T04:36:19.760
> 
> 标签：c++, operator-overloading

请原谅在某些人看来是一个非常简单的问题，但我想到了这个用例：

```
struct fraction {
    fraction( size_t num, size_t denom ) : 
        numerator( num ), denominator( denom )
    {};
    size_t numerator;
    size_t denominator;
}; 
```

我想做的是使用如下语句：

```
fraction f(3,5);
...
double v = f; 
```

现在拥有`v`我的分数所代表的价值。我将如何在 C++ 中做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T04:41:45.870

一种方法是定义一个转换运算符：

```
struct fraction
{
  size_t numerator;
  size_t denominator;

  operator float() const
  {
     return ((float)numerator)/denominator;
  }
}; 
```

大多数人宁愿不将隐式转换运算符定义为样式问题。这是因为转换运算符倾向于“在幕后”行动，并且很难判断正在使用哪些转换。

```
struct fraction
{
  size_t numerator;
  size_t denominator;

  float as_float() const
  {
     return ((float)numerator)/denominator;
  }
}; 
```

在此版本中，您将调用该`as_float`方法以获得相同的结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T04:45:01.450

赋值运算符和转换构造函数用于从其他类的对象初始化*您的类的对象。*相反，您需要一种方法来使用您的类的对象来初始化其他类型的对象。这就是转换运算符的用途：

```
struct fraction {
     //other members here...
     operator double() const { return (double)numerator / denominator;}
     //other members here...
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T04:43:54.447

您可以使用运算符 double 进行转换：

```
struct fraction
{
     operator double() const
      {
         //remember to check for  denominator to 0
          return (double)numerator/denominator;
      }
}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-26T04:40:46.637

`operator=`与它无关，而是你想向你`struct`的公众添加类似的`operator double`东西：

```
operator double() {
  return ((double) numerator))/denominator;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T04:42:55.493

使用这么多代码将是编译器错误，因为编译器不知道如何将 struct fraction 转换为 double。如果要提供转换，则必须定义`operator double()`编译器将用于此转换的转换。

# c++ - what happens when you modify an element of an std::set?

> ID：908949
> 
> 赞同：13
> 
> 时间：2009-05-26T04:37:02.723
> 
> 标签：c++, stl, collections, set

If I change an element of an std::set, for example, through an iterator, I know it is not "reinserted" or "resorted", but is there any mention of if it triggers undefined behavior? For example, I would imagine insertions would screw up. Is there any mention of specifically what happens?

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-26T04:55:07.273

You should not edit the values stored in the set directly. I copied this from MSDN documentation which is somewhat authoritative:

> The STL container class set is used for the storage and retrieval of data from a collection in which the values of the elements contained are unique and serve as the key values according to which the data is automatically ordered. The value of an element in a set may not be changed directly. Instead, you must delete old values and insert elements with new values.

Why this is is pretty easy to understand. The `set` implementation will have no way of knowing you have modified the value behind its back. The normal implementation is a red-black tree. Having changed the value, the position in the tree for that instance will be wrong. You would expect to see all manner of wrong behaviour, such as `exists` queries returning the wrong result on account of the search going down the wrong branch of the tree.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-26T09:56:29.643

The precise answer is platform dependant but as a general rule, a "key" (the stuff you put in a set or the first type of a map) is suppose to be "immutable". To put it simply, that should not be modified, and there is no such thing as automatic re-insertion.

More precisely, the *member variables* used for to compare the key must not be modified.

Windows vc compiler is quite flexible (tested with VC8) and this code compile:

```
// creation
std::set<int> toto;
toto.insert(4);
toto.insert(40);
toto.insert(25);

// bad modif
(*toto.begin())=100;

// output
for(std::set<int>::iterator it = toto.begin(); it != toto.end(); ++it)
{
    std::cout<<*it<<" ";
}
std::cout<<std::endl; 
```

The output is **100 25 40**, which is obviously not sorted... Bad... Still, such behavior is useful when you want to modify data not participating in the *operator <*. But you better know what you're doing: that's the price you get for being too flexible.

Some might prefer gcc behavior (tested with 3.4.4) which gives the error "assignment of read-only location". You can work around it with a const_cast:

```
const_cast<int&>(*toto.begin())=100; 
```

That's now compiling on gcc as well, same output: **100 25 40**. But at least, doing so will probably makes you wonder what's happening, then go to stack overflow and see this thread :-)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-26T05:29:08.243

You cannot do this; they are `const`. There exists no method by which the `set` can detect you making a change to the internal element, and as a result you cannot do so. Instead, you have to remove and reinsert the element. If you are using elements that are expensive to copy, you may have to switch to using pointers and custom comparators (or switch to a C++1x compiler that supports rvalue references, which would make things a whole lot nicer).

# xml - 如何使用 JDBC 使用 informix 的 genxmlquery 功能？

> ID：908964
> 
> 赞同：1
> 
> 时间：2009-05-26T04:44:30.640
> 
> 标签：xml, jdbc, informix

我需要以 XML 格式提取数据库查询的结果。我计划使用 JDBC 作为我的编程语言。我偶然发现了 IDS 11.0 的 XML 发布功能，并打算使用它。已配置数据库设置以执行 XML 发布，并且能够在命令提示符 (dbaccess databasename -) 中执行查询并获得 XML 输出。我不知道如何在 JDBC 中使用 genxmlquery。有人请在这方面帮助我。

我在命令提示符中使用了以下行并获得了 xml 输出：

```
 EXECUTE FUNCTION genxmlquery('newquery','select * from site_info'); 
```

我不知道如何使用 JDBC 来做同样的事情。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T14:43:22.467

像对待 JDBC 中的 SELECT 语句一样对待该语句——毕竟它返回数据。您可能会将数据（XML 文档）检索到 LVARCHAR 或 Smart Blob 主变量中。

# ant - 在 Ant 脚本中处理 file:// 协议

> ID：908973
> 
> 赞同：0
> 
> 时间：2009-05-26T04:47:12.040
> 
> 标签：ant, ivy, file-uri

一些 Ant 目标需要将 URL 定义为属性（如`ivy pattern`），并且由于`file://`Windows（`file:/`或`file:///`）和 Unix（`file://`）上的协议不同，因此整个脚本的可移植性较差。

有没有一种*很好的*方法来处理`file`协议而不会弄乱属性和 Ant 条件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T06:20:38.003

使用`file:///`应该适用于两个系统。但也许[PathConvert](http://ant.apache.org/manual/Tasks/pathconvert.html)任务可以帮助你呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T10:22:22.717

我最终决定使用 Ant 的 Condition 任务：

```
<condition property="file.protocol" value="file:///" else="file://">
    <os family="dos"/>
</condition> 
```

# jquery - 使用 $('.ajax_form').ajaxForm(); 的奇怪行为；

> ID：908975
> 
> 赞同：3
> 
> 时间：2009-05-26T04:48:03.180
> 
> 标签：jquery, ajaxform

这是我第一次在如下类上应用 jquery ajaxForm

```
<form class="ajax_form"...><input type="text" name="q" /><input type="submit" /></form>
<form class="ajax_form"...><input type="text" name="q" /><input type="submit" /></form>

<script>
$('.ajax_form').ajaxForm({
  dataType: 'json',
  error: ajaxErrorHandler,
  success: function(response) { // do some ui update .. }
});
</script> 
```

现在，在 Ajax 调用完成后，我**总是进入错误部分**，尽管 firebug 没有报告任何错误响应，不确定我做错了什么。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-09-17T17:41:23.767

在这种情况下，这可能合适，也可能不合适，但我会提供它，因为当我在寻找类似问题的答案时，它对我很有用。如果您在 Firefox 中提交带有文件上传的“multipart/form-data”表单，jquery.form 将使用 iframe 提交表单。如果返回数据的 Content-Type 是 text/plain，则 iframe 会将生成的文本包装在 <pre> 标签中，这将阻止 jquery json 解析器并给您一个解析器错误，即使 Firebug 正确显示了响应甚至 json .

在我弄清楚之前，这让我头疼不已（在此线程的帮助下：[http://www.extjs.com/forum/archive/index.php/t-17248.html](http://www.extjs.com/forum/archive/index.php/t-17248.html)）。

在我的案例中，答案是确保响应 Content-Type 是“text/html”（这是违反直觉的，至少对我来说是这样）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-14T15:14:03.343

问题在于您的 json 数据。这些可能格式不正确，无法解析。在这种情况下，将不会调用成功函数。

如果您打印错误回调的消息，您可以验证这一点。使用以下代码：

```
url = url + "?" + $(".ajaxForm").serialize();
$(".ajaxForm").ajax({url: url, dataType: "json", type : "post",
                    success: function(response) {},
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(textStatus);
                        console.log(errorThrown);
                    }}); 
```

其中一个打印输出应该类似于“解析器错误”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T06:57:45.467

@c.sokun：在这里使用类应该不是问题，只要只有一种形式使用该类。在同一页面上具有相同类的两个表单肯定会导致打嗝（请参阅您的代码......或者它是一个错字？）

您是否尝试过使用**[FireBug](http://getfirebug.com/)**并检查传递的参数和返回的值？那应该是第一个！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-12T10:30:23.713

ajaxErrorHandler 是否在其他地方定义？我试过你的代码，它工作得很好。您使用的是什么版本的 jQuery 和 jQuery 表单？

这是我尝试过的代码。在与此测试相同的目录中使用包含“{test:'hello world'}”的名为“test.json”的文件：

```
<script type="text/javascript" src="http://malsup.com/jquery/jquery-1.2.6.js"></script>
<script type="text/javascript" src="http://malsup.com/jquery/form/jquery.form.js?2.28"></script>

<form class="ajax_form" action="test.json" method="post"><input type="text" name="q" /><input type="submit" /></form>
<br/>
<form class="ajax_form" action="test.json" method="post"><input type="text" name="q" /><input type="submit" /></form>

<script>
$('.ajax_form').ajaxForm({
  dataType: 'json',
  error: function() {alert("error");},
  success: function(response) {alert(response.test);}
});
</script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-14T08:08:20.513

好吧，我检查了 API 并没有找到任何对名为“错误”的选项字段的引用，所以可能这就是原因。[在这里](http://malsup.com/jquery/form/#api)检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T05:55:33.593

我认为您需要一个 url 和 post 类型的表单才能将数据发送到某处？

这就是他们在[jquery.com](http://docs.jquery.com/Types#Options)上设置的方式：

```
$("#myform").ajaxForm({
   url: "mypage.php",
   type: "POST"
 }); 
```

# javascript - 在 HTML 正文中显示 javascript 值

> ID：908977
> 
> 赞同：3
> 
> 时间：2009-05-26T04:48:23.630
> 
> 标签：javascript, html, forms, windows-desktop-gadgets

我的 html 文档的标题中有以下相关代码：

```
test1.value = System.Gadget.Settings.read("Date1"); 
```

我正在尝试在我的 html 文档正文中显示 test1 值。

它在我使用时显示：

```
<input type="text" id="test1" /> 
```

但是当我使用（在体内）时不起作用：

```
<script type="text/javascript">
    document.write(document.getElementById('test1').id);
</script> 
```

任何建议将不胜感激

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T05:26:01.447

这可能很明显，但为什么不直接写：

```
<html>
  <body>
    <div>Here's the Date1 value: 
      <script type="text/javascript">
        document.write(System.Gadget.Settings.read("Date1"));
      </script>
    </div>
  </body>
</html> 
```

如果这不能满足您的要求，请解释您的预期输出是什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-28T22:31:08.127

这不起作用，因为您的脚本在页面的标题中，并且输入 text1 的声明在正文中.. 所以发生的是，当浏览器运行脚本时它不会找到该对象。

你将需要这样的东西......

```
<html>
  <body>
    <input type="text" id="test1" />
    <script type="text/javascript">
      document.write(document.getElementById('test1').id);
    </script>
  </body>
</html> 
```

# php - 用于日历开始和日期选择器的 php/javascript

> ID：908997
> 
> 赞同：1
> 
> 时间：2009-05-26T05:01:39.013
> 
> 标签：php, javascript

我正在为日历开始和日期选择器搜索 php/javascript。根据这些日期，我需要检索数据库现金和银行金额详细信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T05:15:56.890

您正在构建银行的网上银行系统吗？如果您是，我建议您仔细检查您从互联网上下载的任何代码。对托管大量`snippets`.

[jQuery 的 UI DatePicker 非常好。](http://docs.jquery.com/UI/Datepicker)很多人也在使用它，所以它正在成为一种标准。这很重要，就像人们认识 DatePicker 一样，他们会更倾向于使用它并且已经知道它是如何工作的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T05:04:08.977

我的推荐是来自 UI.jQuery 的 DatePicker - [http://ui.jquery.com](http://ui.jquery.com)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T23:20:15.217

我一直很喜欢 Dynarch 日历： [http](http://www.dynarch.com/projects/calendar/) ://www.dynarch.com/projects/calendar/ 这是我过去主要使用的。

我认为 JQuery 日历也是一个不错的选择。*******************