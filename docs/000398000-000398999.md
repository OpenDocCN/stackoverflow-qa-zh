# StackOverflow 问答 000398000-000398999

# c# - 在 .net 中处理数据库异常

> ID：398002
> 
> 赞同：3
> 
> 时间：2008-12-29T16:09:13.820
> 
> 标签：c#, sql-server, exception-handling

当我们可以捕获异常时： `Violation of UNIQUE KEY constraint 'IX_Product'. Cannot insert duplicate key in object 'Product'. (2627)`.
挑战在于如何将索引名称 IX_Product 分解为成员（即我不想将消息子串化）。一个表上可能有多个唯一约束，我们需要知道哪一个可以向用户提供更详细的信息。最好将它作为 DbException 捕获，因此它不是特定于 SQL Server 的。有没有办法从异常中获取受影响的索引而不必解析字符串？

我想出但我没有测试过的唯一解决方案是使用存储过程并在其中捕获错误并从存储过程返回更详细的消息。但我相信这仍然会有问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T16:26:17.827

您必须：

1.  编码您的客户端组件以识别每个插入/更新语句可能引发异常的约束名称，
2.  重命名所有约束，以便它们以您希望在客户端代码中使用它们的方式“可破译”，或者......
3.  在尝试插入/更新之前检查存储过程中的所有约束，如果检查失败，则在过程中抛出（引发）您自己的自定义异常，然后再尝试插入更新并让约束创建异常......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T16:19:18.903

呃...也许我遗漏了一些明显的东西...但是不是更好地利用您的时间来*修复错误*而不是解析异常吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T16:39:15.493

这听起来像是一个糟糕的设计问题。RDBMS**应该**强制执行这些事情，但应用程序也应该了解并围绕这些约束构建。期望您的 RBDMS 处理您的应用程序应该从一开始就捕获或阻止的逻辑异常是一件非常残酷的事情。数据库引擎用于数据操作，而不是用于向应用程序抛出异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T16:33:18.313

一旦你把它作为一个异常对象解析是你最好的选择。不过，我不会太快将其视为一种实现而忽略它——带有组的正则表达式不应该太难完美适合您的情况。

您也可能最终在存储过程中得到类似的解决方案（解析）。此外，通过将解析代码推送到数据库服务器，您将强制您的数据库能够在不解析的情况下解析确切的细节（这在数据库 A 上可能微不足道，但在数据库 B 和 C 上却异常困难）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T16:55:56.987

不要解析异常文本。（在这里呼应安德鲁......）

如果您预计数据插入/更新操作中有许多可能的陷阱，您应该在 C# 层中捕获这些陷阱。从 ApplicationException 扩展以构建您自己的异常来处理这些特定的约束。

但这假设您的数据模型的位置使得您可以做出这些决定，而无需使用数据库告诉您可以成功执行语句。如果您的数据设计不允许您在不通过 db 引擎运行的情况下知道是否违反了约束，那么您的数据设计存在缺陷。

# unit-testing - 您是在编写功能代码之前还是之后编写单元测试？

> ID：398004
> 
> 赞同：18
> 
> 时间：2008-12-29T16:09:43.633
> 
> 标签：unit-testing, testing, tdd

我想知道大多数人是什么时候编写单元测试的，如果有的话。我通常在编写初始代码后编写测试，以确保它按预期工作。然后我修复损坏的部分。

我用这种方法取得了相当大的成功，但一直想知道是否先切换到编写测试会是有利的？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-29T16:17:49.013

只要有可能，我都会尝试遵循纯 TDD 方法：

1.  *为正在开发的功能*编写单元测试；这迫使我决定公共接口
2.  尽快编码功能（尽可能简单，但不简单）
3.  正确/重构/重新测试
4.  *如果需要*进行额外测试以获得更好的覆盖率、特殊路径等[罕见但值得考虑]
5.  重复下一个功能

很容易兴奋并首先开始编写功能，但这通常意味着您不会提前考虑所有公共接口。

编辑：请注意，如果您先编写代码，很容易*无意中*编写测试以符合代码，而不是相反的方式'round！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-29T16:15:47.130

我真的*很想*先写代码，而且经常这样做。但是我做的真正的 TDD 越多，在没有测试的情况下我拒绝编写任何代码时，我发现我编写的代码越多，可测试的代码越多，代码也越好。

所以，是的，先写测试。这需要意志力和决心，但它确实会产生更好的结果。

作为额外的奖励，TDD 确实帮助我在一个分散注意力的环境中保持专注。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-29T16:22:03.483

我遵循 TDD 方法，但我不像某些人那样纯粹。通常，我会使用一个简单地抛出 NotImplementedException 的存根来粗略地处理类/方法。然后我将开始编写测试。一次一项功能，一次一项测试。通常，我会发现我错过了一个测试——也许是在编写其他测试时或者当我发现一个错误时——然后我会回去编写一个测试（如果需要，还可以修复错误）。

使用 TDD 有助于使您的代码与 YAGNI 保持一致（您不需要它），只要您只为需要开发的功能编写测试并且只编写满足您的测试的最简单的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T16:13:19.913

我们尝试事先编写它们，但我完全承认，我们的环境有时是混乱的，有时这一步是最初跳过并稍后编写的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T16:13:38.150

我通常会在编写代码之前写一个我将要编写的单元测试列表，然后实际编写单元测试代码，但那是因为我使用程序生成单元测试存根，然后修改它们以测试适当的情况。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T16:20:19.073

我倾向于在编写代码时使用单元测试来测试代码。这样我就可以同时使用我正在编写的内容，因为我在编写代码时使用单元测试来测试代码。就像控制台应用程序一样。

有时我什至编写了没有断言的测试，只是调试输出，只是为了测试我使用某些东西的方式是否正常工作。

所以我的答案是，经过一点编码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T16:20:57.213

我使用测试驱动开发 (TDD) 来生成我的大部分生产代码，所以我首先编写单元测试，除非我正在处理无法测试的遗留代码（当编写测试的门槛太高时）。

否则，我编写代码应满足的功能级验收测试。

首先编写单元测试让我确切地知道“我在哪里”：我知道到目前为止已经编码的内容是可操作的，可以集成或发送给测试团队；它不是没有错误的，但它可以工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T16:41:44.253

我将提供我对编写单元测试相当陌生，并且我希望我在编写代码之前就已经编写了它们。或者，至少对如何编写更多可测试代码以及​​对依赖注入等概念有了更好的理解，这似乎对编写可测试代码至关重要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-29T16:54:38.410

通常我在代码之前编写单元测试。它们非常有益，并且在代码有意义之前编写它们。依赖注入非常适合单元测试。依赖注入允许你的部分代码被模拟出来，所以你只测试一个特定的单元，即你的代码是松散耦合的，因此很容易换成不同的（在这种情况下是模拟的）实现。

# svn - 拒绝访问 Apache 上的 .svn 文件夹

> ID：398008
> 
> 赞同：58
> 
> 时间：2008-12-29T16:12:04.970
> 
> 标签：svn, apache, deployment, capistrano

我们在 Subversion 中有一个使用 Capistrano 部署的 Rails 应用程序，但注意到我们可以访问“/.svn”中的文件，这会带来安全问题。

我想知道最好的方法是什么。一些想法：

*   拒绝访问的全局 Apache 配置
*   在公用文件夹和所有子文件夹中添加 .htaccess 文件
*   更改权限的上限任务

我不太喜欢删除文件夹或使用 svn 导出的想法，因为我想保留“svn 信息”。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-12-29T16:36:08.090

最好的选择是使用 Apache 配置。

使用 htaccess 或全局配置主要取决于您是否控制服务器。

如果你这样做，你可以使用类似的东西

```
<DirectoryMatch .*\.svn/.*>
    拒绝所有人
</目录匹配>

```

如果不这样做，您可以使用 FilesMatch 在 .htaccess 文件中执行类似的操作

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-12-29T18:14:50.027

保护 .svn 文件的另一种方法是在 Apache 配置中使用重定向：

```
RedirectMatch 404 /\\.svn(/|$) 
```

因此，您得到的不是 403 禁止（并为可能的攻击者提供线索），而是 404，这是我们在随机输入路径时所期望的。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2010-07-14T23:48:12.607

我不喜欢 404ing 每个文件以点开头的想法。我会使用更具选择性的方法，或者使用我在项目中使用的 cvs（示例中为 svn）

```
RedirectMatch 404 /\\.svn(/|$) 
```

或捕获所有 cvs 系统

```
RedirectMatch 404 /\\.(svn|git|hg|bzr|cvs)(/|$) 
```

-- 过时的答案如下（见评论） --

我还不能写评论所以... csexton 的答案不正确，因为用户无法访问 .svn 文件夹，但可以访问其中的任何文件！例如，您可以访问 [http://myserver.com/.svn/entries](http://myserver.com/.svn/entries)

正确的规则是

```
RedirectMatch 404 /\\.svn(/.*|$) 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-03-13T02:01:27.577

我认为 Riccardo Galli 是对的。甚至 apache 已经有 .svn 设置对我来说是禁止的，但是 .svn/entries 肯定是可用的……暴露我的 svn 服务器、端口号、用户名等。

我实际上想，为什么不限制 .git 作为预防措施（假设你还没有使用 git，但可能有一天你不会考虑目录限制）。

然后我想，为什么不限制所有应该隐藏的东西呢？谁能想到这个问题？

```
RedirectMatch 404 /\\..*(/.*|$) 
```

我在初始阶段之后添加了“。*” - 与 Riccardo 的唯一区别。似乎是 404 .svn、.git、.blah 等。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-04-18T09:43:32.687

我宁愿拒绝访问所有点文件（例如：.htaccess、.svn、.xxx 等），因为它们通常不需要可通过网络访问。

这是实现这一点的规则（直到包括 Apache 2.2）：

```
<LocationMatch "\/\..*">
    Order allow,deny
    Deny from all
</LocationMatch> 
```

*（更新）*或者您可以使用以下内容（适用于 Apache 2.2 和 2.4）：

```
# Deny access to dot-files, as 404 error
# (not giving hint about potential existence to the file)
RedirectMatch 404 ".*\/\..*" 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-23T01:21:25.833

RedirectMatch 会以 404 响应，这很好。

但是，如果启用了“选项+索引”，那么用户仍然可以从父目录中看到“.svn”目录。

用户将无法进入该目录——这就是“404 Not Found”的来源。但是，他们将能够看到该目录并为可能的攻击者提供线索。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-22T22:30:33.930

在我看来，Apache conf 应该是：

```
<Directory ~ "\.svn">
    Order allow,deny
    Deny from all
</Directory> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-07-12T22:02:22.747

我不是很喜欢 RedirectMatch，所以我改用了 RewriteRule：

```
RewriteRule /\..*(/.*|$) - [R=404,L] 
```

连字符的意思是“不要做任何替换”。我也无法弄清楚为什么在上面的示例中，正则表达式有两个反斜杠：

```
/\\..*(/.*|$) 
```

所以我拿出了一个，它工作正常。我不明白为什么你会在那里使用两个。有人愿意开导我吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-04-08T19:55:57.043

这：

```
RedirectMatch permanent .*\.(svn|git|hg|bzr|cvs)/.* / 
```

如果您不想将错误发送回用户，也可以使用。

它只是重定向回站点根页面。此外，这是一个永久重定向，因此机器人不会尝试重新索引此 URL。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-04-19T09:47:43.640

Apache Subversion FAQ 建议使用此解决方案：

```
# Disallow browsing of Subversion working copy administrative dirs.
<DirectoryMatch "^/.*/\.svn/">
    Order deny,allow
    Deny from all
</DirectoryMatch> 
```

来源：[https ://subversion.apache.org/faq.html#website-auto-update](https://subversion.apache.org/faq.html#website-auto-update)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-02-15T09:05:18.343

RedirectMatch 与 mod_alias 中的其他指令一样，即使在不区分大小写的文件系统上也区分大小写（请参阅[mod_alias 文档](https://httpd.apache.org/docs/2.4/mod/mod_alias.html)）。所以上面关于所有版本控制系统的匹配和阻止文件的答案是不正确的。

代替

```
RedirectMatch 404 /\\.(svn|git|hg|bzr|cvs)(/|$) 
```

或者

```
RedirectMatch permanent .*\.(svn|git|hg|bzr|cvs)/.* / 
```

像这样的东西是必要的

```
RedirectMatch 404 "(?i)/\.?(cvs|svn|git|hg|bzr)" 
```

真正阻止一切，因为

*   CVS 目录是大写的；和
*   不要在前面以点 (.) 开头。

我希望这会有所帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-11-23T04:46:12.033

在服务器配置文件的 .htaccess 中。

(1)

```
RewriteEngine on
RewriteRule "^(.*/)?\.git/" - [F,L] 
```

和 (2)

```
RedirectMatch 404 /\.git 
```

将这两种方法都放在`.htaccess`文件中。

它通过返回 404 隐藏名称以 .git 开头的任何文件或目录，例如 .git 目录或 .gitignore 文件。

* * *

## 回答 #13

> 赞同：-7
> 
> 时间：2008-12-29T17:07:44.263

在您的 subversion 服务器安装中创建访问权限文件。

例如，如果您的文件夹结构是

*/svn*

*/svn/rights/svnath.conf*

创建一个配置文件并在您的 apache subversion 配置文件中输入该文件的路径，您通常可以在*/etc/httpd/conf.d/subversion.conf找到该文件*

在您的 svnath.conf 文件中，将权限定义为：

# Foo.com 的访问权限

[foo.com:/trunk/source]

dev1=rw

dev2=rw .....

通过这种方式，您可以从单个文件和更精细的级别控制访问权限。

更多信息请阅读 svn 红皮书。

# xcode - 在 Xcode 中将捆绑目标链接到命令行目标

> ID：398010
> 
> 赞同：0
> 
> 时间：2008-12-29T16:12:21.117
> 
> 标签：xcode

我在 Xcode 中有一个包含多个目标的项目。其中一个构建一个同步模式包，另一个构建一个 Foundation 命令行工具，该工具使用包中定义的模式启动同步会话。

模式包模板创建`Schema-strings.h`和`Schema-strings.m`文件，其中包含数据类名称、实体名称和属性名称的常量，我想在我的命令行工具代码中使用这些常量。

如何配置目标以使其成为可能？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T21:43:07.143

离开计算机一段时间后，我意识到解决此问题的一种方法是添加`Schema-strings.m`到命令行工具目标的“编译源”阶段。但我仍然有兴趣了解获得类似结果的任何其他方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T16:44:55.603

将创建同步模式包的目标作为依赖项添加到命令行目标。您可以通过将目标同步模式捆绑目标拖放到命令行目标或将其添加到命令行目标的常规检查器窗口的依赖项列表中来执行此操作。

# html - 在 ASP.NET 中访问 HTML 元素

> ID：398021
> 
> 赞同：7
> 
> 时间：2008-12-29T16:15:55.883
> 
> 标签：html, asp.net

我想更改单选按钮（HTML 元素）的文本，而不是 ASP.NET 组件。

如何从 ASP.NET 更改它？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-29T16:19:16.267

添加一个简单的：

```
runat="server" 
```

到您的 HTML 标记，它将允许通过后面的代码修改一些属性。

这些被称为“混合控制”。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-29T16:20:33.610

您需要在该元素的 HTML 中添加一个 runat="server" 属性。

```
<input type="radio" id="someRadioId" value="bleh" runat="server"> 
```

这将允许您通过其 ID someRadioId 访问该元素。后面代码中的这个元素将是 HtmlInputRadioButton 类型。

[请参阅 MSDN 上的这篇文章](http://msdn.microsoft.com/en-us/library/17tk0thz.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T16:22:01.020

一个简单的 RadioButtonList，当像这样初始化时：

```
list.Items.Add(new ListItem("item 1", "1"));
list.Items.Add(new ListItem("item 2", "2"));
list.Items.Add(new ListItem("item 3", "3")); 
```

呈现为以下 HTML：

```
<table id="list" border="0">
    <tr>
        <td><input id="list_0" type="radio" name="list" value="1" /><label for="list_0">item 1</label></td>
    </tr><tr>
        <td><input id="list_1" type="radio" name="list" value="2" /><label for="list_1">item 2</label></td>
    </tr><tr>
        <td><input id="list_2" type="radio" name="list" value="3" /><label for="list_2">item 3</label></td>
    </tr>
</table> 
```

因此，通过 JavaScript，您可以遍历类型为“radio”的元素，获取它们的 id，然后查找将 id 作为 'for' 值的标签元素。并更新他们的innerHTML。

# performance - 经典 ASP 页面的性能测试？

> ID：398028
> 
> 赞同：6
> 
> 时间：2008-12-29T16:19:24.520
> 
> 标签：performance, asp-classic

我想知道如何对旧的asp页面进行性能测试。您使用过哪些工具？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T16:41:10.217

PS：我假设旧 ASP 您指的是“经典 ASP”而不是 ASP.NET。

下面是一小段 VBScript 代码，我会放在页面上以计算它们执行所需的时间，您可能会发现它很有用。

```
<%
' Start the timer
starttime = timer()
%>

<!-- HTML and Code Here -->

<%
' End the timer
endtime = timer()
' Get the difference
benchmark = endtime - starttime
' Output the timing result
%>
<div class="noprint"><div class="debug">
<span class="text">Execute: <%= benchmark %> secs</span>
</div></div> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-29T16:25:53.990

关于如何对 ASP Web 应用程序进行压力测试并没有什么特别之处。剖析是另一回事。

对于压力测试，我推荐[The Grinder](http://grinder.sourceforge.net/)（一次又一次:-)）

我没有分析过 ASP 应用程序，所以我无法帮助你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-05T17:27:39.410

这个问题迟到了，但值得为下一个偶然发现这个问题的可怜的灵魂提供帮助：

如果你正在寻找一个特定的 ASP 页面，[http](http://aspprofiler.sourceforge.net/) ://aspprofiler.sourceforge.net/ 绝对很棒。几年前我用过它，忘记了我有它，最近在对一个需要永远加载的页面进行故障排除时重新发现了它。

从他们的页面：

> ASP Profiler 是用于 Active Server Pages（使用 VBScript）代码的行级性能分析器。它显示了您的 ASP 页面是如何运行的，哪些行被执行了多少次，以及每行需要多少毫秒。特别是对于大量数据驱动的页面，您可以准确地看到哪些行减慢了页面，并在必要时进行了优化。
> 
> 这个程序本身是纯粹用 ASP 和 VBScript 编写的。

我遇到的唯一问题是，如果页面从其他地方接收数据，您只能通过 QueryString 输入它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T18:43:15.337

这些线程可能有用：

*   [在经典的 asp/sql 服务器网站中查找性能瓶颈](https://stackoverflow.com/questions/352597/finding-performance-bottlenecks-in-a-classic-aspsql-server-website#352884)
*   [ASP.NET 压力测试](https://stackoverflow.com/questions/299518/aspnet-stress-testing#299784)
*   [使用 EQATEC Profiler 分析 ASP.NET 网站](https://stackoverflow.com/questions/378617/profiling-aspnet-websites-with-eqatec-profiler#378730)

正如 Vinko 所说，测试 ASP 与 ASP.NET 并没有什么“特别”之处。任何可以测试一个的工具都可以（通常）测试另一个。

就个人而言，我喜欢使用 LoadRunner 进行测试，使用 MS Visual Studio Analyzer 进行分析。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T16:48:13.773

[Apache Benchmark](http://httpd.apache.org/docs/2.0/programs/ab.html)，甚至还有 Windows 版本。它测试每秒请求数和平均时间

# .net - 如何以编程方式使笔记本电脑进入睡眠模式

> ID：398032
> 
> 赞同：5
> 
> 时间：2008-12-29T16:20:40.850
> 
> 标签：.net, api, shutdown, sleep-mode, hibernate-mode

我可以使用哪些 API 或工具来查询系统的功能并选择最适合将 PC 置于睡眠、休眠或关机模式的选项？

感谢您的任何指示。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-29T16:35:49.227

查看 SystemInformation.PowerStatus，然后您可以调用 Application.SetSuspendState 使 PC 进入睡眠或休眠状态，如下所示：

```
Application.SetSuspendState(PowerState.Hibernate, true, true); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-11T06:12:11.167

您可以使用 API：

```
Declare Function SetSuspendState Lib "PowrProf" (ByVal Hibernate As Integer, ByVal ForceCritical As Integer, ByVal DisableWakeEvent As Integer) As Integer

SetSuspendState(0, 0, 0) 'Sleep without forcing and ?no? wake events
SetSuspendState(1, 0, 0) 'Hibernate without forcing and ?no? wake events 
```

将休眠设置为 1（真）以休眠或 0（假）以休眠。

[请参阅此处](http://msdn.microsoft.com/en-us/library/windows/desktop/aa373201%28v=vs.85%29.aspx)的 API 。

# asp.net - ASP.NET 网站还是 ASP.NET Web 应用程序？

> ID：398037
> 
> 赞同：869
> 
> 时间：2008-12-29T16:24:13.090
> 
> 标签：asp.net, .net, visual-studio, projects-and-solutions

当我在 Visual Studio 中启动一个新的 ASP.NET 项目时，我可以创建一个 ASP.NET Web 应用程序或者我可以创建一个 ASP.NET 网站。

ASP.NET Web 应用程序和 ASP.NET 网站有什么区别？为什么我会选择一个而不是另一个？

答案是否会根据我使用的 Visual Studio 版本而有所不同？

* * *

## 回答 #1

> 赞同：564
> 
> 时间：2008-12-29T16:28:58.167

### 网站：

网站项目是即时编译的*。*你最终会得到更多的 DLL 文件，这可能会很痛苦。当您在一个目录中有页面或控件需要引用另一个目录中的页面和控件时，它也会产生问题，因为另一个目录可能尚未编译到代码中。另一个问题可能是出版。

如果 Visual Studio 没有被告知要不断地重复使用相同的名称，它将一直为页面生成的 DLL 文件提供新名称。这可能导致有多个包含相同类名的 DLL 文件的紧密副本，这将产生大量错误。Web Site 项目是随 Visual Studio 2005 引入的，但事实证明它并不流行。

### Web应用程序：

*Web 应用程序*项目是作为插件创建的，现在作为 Visual Studio 2005 SP 1 的一部分存在。主要区别在于 Web 应用程序项目的设计与 Visual Studio 2003 附带的 Web 项目类似。它将在构建时将应用程序编译成单个 DLL 文件。要更新项目，必须重新编译并发布 DLL 文件以进行更改。

Web 应用程序项目的另一个不错的特性是从项目视图中排除文件要容易得多。在网站项目中，您排除的每个文件都使用文件名中的排除关键字重命名。在 Web 应用程序项目中，该项目只跟踪从项目视图中包含/排除哪些文件，而不重命名它们，使事情变得更加整洁。

*[参考](https://web.archive.org/web/20081211085108/http://www.megasolutions.net/AspNet/difference-between-Web-Site-and-Web-Application-Project-27210.aspx)*

文章*[ASP.NET 2.0 - 网站与 Web 应用程序项目](http://maordavid.blogspot.com/2007/06/aspnet-20-web-site-vs-web-application.html)*也给出了为什么使用一个而不是另一个的原因。这是它的摘录：

> *   您需要将大型 Visual Studio .NET 2003 应用程序迁移到 VS 2005 吗？**使用 Web 应用程序项目。**
> *   您想在不创建项目文件的情况下将任何目录作为 Web 项目打开和编辑吗？**使用网站项目。**
> *   您需要在编译期间添加预构建和构建后步骤吗？ **使用 Web 应用程序项目。**
> *   您需要使用多个 Web 项目构建一个 Web 应用程序吗？**使用 Web 应用程序项目。**
> *   您想为每一页生成一个程序集吗？**使用网站项目。**
> *   您更喜欢动态编译和处理页面而不在每个页面视图上构建整个站点？**使用网站项目。**
> *   您更喜欢单页代码模型而不是代码隐藏模型？**使用网站项目。**

*[Web 应用程序项目与网站项目](http://msdn.microsoft.com/en-us/library/dd547590.aspx)*(MSDN) 解释了网站和 Web 应用程序项目之间的差异。此外，它还讨论了要在 Visual Studio 中进行的配置。

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2009-03-09T19:16:42.443

**网站**是您部署到 ASP.NET Web 服务器（例如 IIS）的内容。只是一堆文件和文件夹。网站中没有任何东西可以将您与 Visual Studio 联系起来（没有项目文件）。网页（如 .aspx、.ascx、.master）的代码生成和编译是[在运行时动态](http://msdn.microsoft.com/library/ms366723)完成的，框架会检测到这些文件的更改并自动重新编译。您可以将要[在页面之间共享](http://msdn.microsoft.com/library/t990ks23)的代码放在特殊的 App_Code 文件夹中，也可以将其预编译并将程序集放在 Bin 文件夹中。

**Web 应用程序**是一个特殊的 Visual Studio 项目。**与网站的主要区别在于，当您构建项目时，所有代码文件都被编译成一个程序集，该程序集放置在 bin 目录中。您不会将代码文件部署到 Web 服务器。**您可以将它们放在任何地方，而不是为共享代码文件创建一个特殊文件夹，就像在类库中所做的那样。由于 Web 应用程序包含不打算部署的文件，例如项目和代码文件，因此 Visual Studio 中有一个[发布](http://msdn.microsoft.com/library/aa983453)命令可将网站输出到指定位置。

## App_Code 与 Bin

部署共享代码文件通常不是一个好主意，但这并不意味着您必须选择 Web 应用程序。您可以拥有一个引用类库项目的网站，该类库项目包含网站的所有代码。Web 应用程序只是一种方便的方法。

## 代码隐藏

*本主题特定于 .aspx 和 .ascx 文件。该主题与不使用代码隐藏文件的新应用程序框架（例如 ASP.NET MVC 和 ASP.NET 网页）的相关性越来越低。*

通过将所有代码文件编译到单个程序集中，包括.aspx 页面和 .ascx 控件的代码[隐藏](http://msdn.microsoft.com/magazine/cc163675)文件，在 Web 应用程序中，您必须为每一个微小的更改重新构建，并且您无法进行实时更改。这在开发过程中可能是一个真正的痛苦，因为您必须不断地重新构建才能看到更改，而对于 Web 站点，运行时会检测到更改并且页面/控件会自动重新编译。

让运行时管理代码隐藏程序集对您来说工作量较少，因为您无需担心为页面/控件提供唯一名称，或将它们组织到不同的命名空间中。

我并不是说部署代码文件总是一个好主意（特别是在共享代码文件的情况下），但代码隐藏文件应该只包含执行 UI 特定任务、连接事件处理程序等的代码。你的应用程序应该是分层，以便重要代码始终位于 Bin 文件夹中。如果是这种情况，那么部署代码隐藏文件不应被视为有害。

Web 应用程序的另一个限制是您只能使用项目的语言。在网站中，您可以有一些 C# 页面，一些 VB 页面等。不需要特殊的 Visual Studio 支持。这就是构建提供程序可扩展性的美妙之处。

此外，在 Web 应用程序中，您不会在页面/控件中进行错误检测，因为编译器仅编译您的代码隐藏类而不是标记代码（在 MVC 中，您可以使用 MvcBuildViews 选项修复此问题），它是在运行时编译的。

## 视觉工作室

因为 Web 应用程序是 Visual Studio 项目，所以您可以获得一些网站中没有的功能。例如，您可以使用构建事件来执行各种任务，例如缩小和/或合并 Javascript 文件。

Visual Studio 2010 中引入的另一个不错的功能是[Web.config 转换](http://msdn.microsoft.com/library/dd465318)。~~这在网站中也不可用。~~现在适用于 VS 2013 中的网站。

构建 Web 应用程序比构建网站更快，特别是对于大型站点。这主要是因为 Web 应用程序不编译标记代码。在 MVC 中，如果您将 MvcBuildViews 设置为 true，那么它会编译标记代码并获得错误检测，这非常有用。不利的一面是，每次构建解决方案时，它都会构建完整的站点，这可能会很慢且效率低下，尤其是在您不编辑站点的情况下。我发现自己打开和关闭 MvcBuildViews（这需要卸载项目）。另一方面，通过网站，您可以选择是否要将站点构建为解决方案的一部分。如果您选择不这样做，那么构建解决方案的速度非常快，如果您进行了更改，您可以随时单击网站节点并选择构建。

在 MVC Web 应用程序项目中，您有额外的命令和对话框用于常见任务，例如“添加视图”、“转到视图”、“添加控制器”等。这些在 MVC 网站中不可用。

如果您使用 IIS Express 作为开发服务器，您可以在网站中添加虚拟目录。此选项在 Web 应用程序中不可用。

~~NuGet 包还原在网站上不起作用，您必须手动安装 packages.config 中列出的包~~[包还原现在适用于从 NuGet 2.7 开始](http://docs.nuget.org/docs/reference/package-restore)的网站

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2009-03-04T14:19:03.917

**网站**=当网站由平面设计师创建并且程序员只编辑一两个页面时使用

**Web 应用程序**= 当应用程序由程序员创建并且图形设计师只编辑一两个页面/图像时使用。

网站可以使用任何 HTML 工具进行工作，而无需开发人员工作室，因为不需要更新项目文件等。当团队主要使用开发人员工作室并且代码内容高时，Web 应用程序是最好的。

（一些编码错误是在编译时在 Web 应用程序中发现的，直到运行时才在网站中发现。）

**警告：** **我多年前写了这个答案，从那以后就没有使用过 Asp.net。我预计事情现在已经开始了。**

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2009-07-15T20:15:09.567

除非您特别需要动态编译的项目，**否则不要使用网站项目**。

为什么？因为当你试图改变或理解你的项目时，网站项目会让你陷入困境。Visual Studio 中的静态类型查找功能（例如查找用法、重构）将永远用于任何规模合理的项目。有关详细信息，请参阅 Visual Studio 中的 Stack Overflow 问题*[Slow “Find All References”](https://stackoverflow.com/questions/428436/slow-find-all-references-in-visual-studio)*。

我真的不明白为什么他们在 Visual Studio 2005 中放弃了 Web 应用程序，因为它们会导致痛苦、理智流失、生产力痈的网站项目类型。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-01-24T12:16:47.833

MSDN中有一篇文章描述了这些差异：

[比较网站项目和 Web 应用程序项目](https://docs.microsoft.com/en-us/previous-versions/aa730880(v=vs.80))

顺便说一句：关于该主题有一些类似的问题，例如：

*   [网站与 Visual Studio 中的 ASP.Net Web 应用程序](https://stackoverflow.com/questions/237664/web-site-vs-asp-net-web-application-in-visual-studio) *注意：已删除，不再在 SO*
*   [ASP.NET 中的网站或 web 应用程序](https://stackoverflow.com/questions/82361/website-or-webapplication-in-asp-net)

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-12-29T17:23:28.773

这听起来可能有点明显，但我认为这是一个被误解的东西，因为 Visual Studio 2005 最初只与网站一起提供。如果您的项目处理的网站相当有限并且没有太多的逻辑或物理分离，那么该网站就可以了。但是，如果它确实是一个具有不同模块的 Web 应用程序，许多用户在其中添加和更新数据，那么您最好使用 Web 应用程序。

网站模型的最大优点是该`app_code`部分中的任何内容都是动态编译的。您可以在不完全重新部署的情况下进行 C# 文件更新。然而，这是一个巨大的牺牲。很多事情都发生在难以控制的幕后。命名空间很难控制，并且默认情况下，特定的 DLL 使用会出现在窗口之外，`app_code`因为所有内容都是动态编译的。

Web 应用程序模型没有动态编译，但您可以控制我提到的内容。

如果您正在做 n 层开发，我强烈推荐 Web 应用程序模型。如果您正在做一个有限的网站或快速而肮脏的实现，那么网站模型可能具有优势。

更详细的分析可见：

*   *[Web 应用程序项目和 Web 部署项目在这里](http://west-wind.com/weblog/posts/5601.aspx)*
*   *[网站或网络应用程序？](http://blogs.vertigo.com/personal/swarren/Blog/Lists/Posts/Post.aspx?ID=10)*

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2011-07-07T11:56:05.837

来自 MCTS 自定进度培训套件考试 70-515 书：

> 使用 Web 应用程序（项目），
> 
> 1.  您可以创建 MVC 应用程序。
> 2.  Visual Studio 将文件列表存储在项目文件（.csproj 或 .vbproj）中，而不是依赖于文件夹结构。
> 3.  不能混合使用 Visual Basic 和 C#。
> 4.  您不能在不停止调试会话的情况下编辑代码。
> 5.  您可以在多个 Web 项目之间建立依赖关系。
> 6.  您必须在部署之前编译应用程序，这会阻止您在另一个页面无法编译时测试一个页面。
> 7.  您不必将源代码存储在服务器上。
> 8.  您可以控制程序集名称和版本。
> 9.  部署后不重新编译就无法编辑单个文件。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2009-01-24T12:17:22.497

这取决于你正在开发什么。

一个以内容为导向的网站的内容会经常变化，而网站则更好。

应用程序倾向于将其数据存储在数据库中，并且其页面和代码很少更改。在这种情况下，最好有一个 Web 应用程序，其中程序集的部署受到更多控制并且对单元测试有更好的支持。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2013-01-03T13:52:50.210

> **`Compilation`** 首先是编译上的区别。网站不是在服务器上预编译的，而是在文件上编译的。这可能是一个优势，因为当您想更改网站中的某些内容时，您只需从服务器下载特定文件，更改它并将此文件上传回服务器，一切都会正常工作。在 Web 应用程序中，您不能这样做，因为一切都是预编译的，并且您最终只有一个 dll。当您更改项目的一个文件中的某些内容时，您必须再次重新编译所有内容。因此，如果您希望有可能更改服务器网站上的某些文件，对您来说是更好的解决方案。它还允许许多开发人员在一个网站上工作。另一方面，如果您不希望您的代码在服务器上可用，您应该选择 Web 应用程序。

**`Project structure`** 项目的结构也有所不同。在 Web 应用程序中，您有一个项目文件，就像在普通应用程序中一样。在网站中没有传统的项目文件，你只有解决方案文件。所有引用和设置都存储在 web.config 文件中。 **`@Page directive`** @Page 指令中有一个不同的属性，用于包含与此页面关联的类的文件。在 Web 应用程序中，它是标准的“CodeBehind”，在 Web 站点中，您使用“CodeFile”。您可以在以下示例中看到这一点：

**Web应用程序：**

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs"  
Inherits="WebApplication._Default" %> 
```

**网站：**

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %> 
```

> 命名空间 - 在上面的示例中，您还可以看到另一个区别 - 命名空间是如何创建的。在 Web 应用程序中，命名空间只是项目的名称。在网站中有用于动态编译页面的默认命名空间 ASP。
> 
> 编辑并继续 - 在 Web 应用程序中编辑并继续选项可用（要打开它，您必须转到工具菜单，单击选项，然后在调试中找到编辑并继续）。此功能在 Web Site.ASP.NET MVC 中不起作用如果您想使用以下方式开发 Web 应用程序
> 
> ASP.NET MVC（模型视图控制器）最好的默认选项是 Web 应用程序。虽然可以在 Web 站点中使用 MVC，但不推荐。
> 
> 摘要 - ASP.NET Web 应用程序和网站之间最重要的区别是编译。因此，如果您在一个较大的项目中工作，几个人可以修改它，最好使用网站。但是，如果您正在做一个较小的项目，您也可以使用 Web 应用程序。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2013-04-04T12:54:24.590

是的，Web 应用程序比网站好得多，因为 Web 应用程序给了我们自由：

1.  将多个项目放在一个保护伞下，并在它们之间建立项目依赖关系。例如，对于 PCS，我们可以在 Web 应用程序中进行以下操作 -

    *   门户网站
    *   通知控制器（用于发送电子邮件）
    *   业务层
    *   数据访问层
    *   异常管理器
    *   服务器实用程序
    *   WCF 服务（所有平台通用）
    *   项目清单
2.  对与 ASP.NET 页面关联的类文件中的代码运行单元测试

3.  从独立类中引用与页面和用户控件相关联的类
4.  为整个站点创建单个程序集
5.  控制为站点生成的程序集名称和版本号
6.  避免将源代码放在生产服务器上。（您可以避免将源代码部署到 IIS 服务器。在某些情况下，例如共享主机环境，您可能会担心未经授权访问 IIS 服务器上的源代码。（对于网站项目，您可以通过以下方式避免这种风险在开发计算机上预编译并部署生成的程序集而不是源代码。但是，在这种情况下，您将失去一些简单的站点更新的好处。）
7.  网站的性能问题（对网站的第一个请求可能需要编译网站，这可能会导致延迟。如果网站在内存不足的 IIS 服务器上运行，包括整个网站在一个单个程序集可能使用比多个程序集所需的更多内存。）

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2009-01-24T12:19:07.330

主要区别之一是网站动态编译并创建动态程序集。Web 应用程序编译成一个大型程序集。

Visual Studio 2008 消除了两者之间的区别。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2009-08-15T17:03:07.363

应用程序通常在部署之前编译，因为网站使用 app_code 目录。当应用程序代码文件夹中有任何更改时，服务器将重新编译代码。这意味着您可以在网站上动态添加/更改代码。

应用程序的优点是无需重新编译，因此初始启动时间会更快。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-09-28T12:21:32.617

我建议您观看 ASP.NET 网站上的视频*[Web 应用程序项目和 Web 部署项目](http://www.asp.net/learn/videos/video-16.aspx)*，它非常详细地解释了不同之处，这对我很有帮助。

顺便说一句，不要被标题弄糊涂了，视频的很大一部分解释了网站项目和 Web 应用程序项目之间的区别以及为什么微软在 Visual Studio 2005 中重新引入了 Web 应用程序项目（您可能已经知道，它最初仅附带网站项目，然后在 SP1 中添加了 Web 应用程序项目）。一个很棒的视频，我强烈推荐给任何想知道区别的人。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2012-06-18T07:44:11.400

“网站”的代码位于特殊的 App_Code 目录中，并在运行时编译成多个 DLL（程序集）。一个“网络应用程序”被预编译成一个单独的 DLL。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2012-05-09T10:07:57.420

网站和项目>>网站是使用 Visual Studio 创建 ASP.NET 应用程序的两种不同方法。一个是无项目的，另一个是项目环境。差异如下

1.  解决方案文件存储在与项目环境中的根目录相同的目录中。
2.  在项目环境中部署之前需要删除解决方案和项目文件。
3.  完整的根目录部署在无项目环境中。

使用这两种方法没有太大的基本区别。但是，如果您要创建需要较长时间的网站，请选择项目环境。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2012-07-05T03:26:16.723

它始终取决于您的客户的要求。ASP.NET 仅包含用户为应用程序的安全性和易于维护而需要的灵活功能。

您可以将**Web 应用程序**视为在 ASP.NET 框架内运行的二进制文件。**网站**作为静态网页，您可以查看并轻松部署源代码。

但这两种 ASP.NET 技术的优缺点各有千秋。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2012-12-19T05:14:39.097

**Web 应用程序项目模型**

*   提供与 Visual Studio .NET Web 项目相同的 Web 项目语义。有一个项目文件（基于项目文件的结构）。构建模型 - 项目中的所有代码都编译成单个程序集。支持 IIS 和内置的 ASP.NET 开发服务器。支持 Visual Studio 2005（重构、泛型等）和 ASP.NET（母版页、成员资格和登录、站点导航、主题等）的所有功能。不再需要使用 FrontPage 服务器扩展 (FPSE)。

**网站项目模型**

*   没有项目文件（基于文件系统）。
*   新的编译模型。
*   动态编译和处理页面，而无需在每个页面视图上构建整个站点。
*   支持 IIS 和内置的 ASP.NET 开发服务器。
*   每个页面都有自己的程序集。
*   不同的代码模型。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2012-08-28T04:36:07.113

网站 - 不会创建任何解决方案文件。如果我们想创建网站，则不需要 Visual Studio。

Web 应用程序 - 将创建一个解决方案文件。如果我们要创建 Web 应用程序应该需要 Visual Studio。它将`.dll`在 bin 文件夹中创建一个文件。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2012-07-04T18:46:48.573

在 Web 应用程序项目中，Visual Studio 需要用于页面和用户控件的附加 .designer 文件。网站项目不需要这种开销。标记本身被解释为设计。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-01-21T11:04:50.367

绝对是 Web 应用程序，单个 DLL 文件，易于维护。但是网站更灵活；您可以随时随地编辑 aspx 文件。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2014-01-02T05:10:45.580

**网站：**它会自动生成 app_code 文件夹，如果您在服务器上发布它，之后如果您对任何特定文件或页面进行一些更改，那么您不必编译所有文件。

**Web 应用程序**它会自动生成网站不生成的解决方案文件，如果您在一个文件中进行更改，则必须编译完整的项目以反映其更改。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-09-23T21:55:24.813

Web 应用程序需要更多内存，大概是因为您别无选择，只能编译成单个程序集。我刚刚将一个大型旧站点转换为 Web 应用程序，并且在编译时遇到内存不足的问题，错误消息如下：

```
Unexpected error writing metadata to file '' -- 
Not enough storage is available to complete this operation. 
```

错误，并在运行时出现以下错误消息：

```
Exception information: 
    Exception type: HttpException 
    Exception message: Exception of type 'System.OutOfMemoryException' was thrown.
   at System.Web.Compilation.BuildManager.ReportTopLevelCompilationException() 
```

我建议在内存受限的旧硬件上转换较大的站点，选择恢复为网站模型的选项。即使在最初的成功之后，问题也可能在以后慢慢出现。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2014-10-28T08:07:01.037

在 Web 应用程序中，您可以创建项目功能的层，并可以通过将其划分为多个项目来创建它们之间的相互依赖关系，但您永远无法在网站上这样做。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-01-06T12:14:31.567

[![这里的 Web Supportive Application 是网站的一个示例。](https://i.stack.imgur.com/rNe7s.jpg)](https://i.stack.imgur.com/rNe7s.jpg)

这里的 Web Supportive Application 是网站的一个示例。网站和 Web 应用程序都可以是动态/静态的，这取决于要求，这是一个了解网站和 Web 应用程序工作的示例。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-02-12T12:38:19.797

总结上面的一些答案：

**灵活性**，您可以对网页进行实时更改吗？

*网站*：可能。优点：短期利益。缺点：项目混乱的长期风险。

*网络应用程序*：缺点：不可能。编辑页面，将更改存档到源代码管理，然后构建和部署整个站点。优点：保持高质量的项目。

**发展问题**

*网站*：没有 .csproj 文件的简单项目结构。两个 .aspx 页面可以具有相同的类名而不会发生冲突。随机项目目录名称导致构建错误，例如[为什么 .net 框架与它自己生成的文件](https://stackoverflow.com/q/6940452/1845672)冲突以及[为什么 .net 框架与它自己生成的文件冲突](https://stackoverflow.com/q/6940452/1845672)。优点：简单（简单化）。缺点：不稳定。

*Web App* : 类似于 WebForms 项目的项目结构，带有一个 .csproj 文件。asp 页面的类名必须是唯一的。优点：简单（智能）。缺点：没有，因为 Web 应用程序仍然很简单。

# javascript - Web 桌面 - 你觉得它有趣吗？

> ID：398044
> 
> 赞同：8
> 
> 时间：2008-12-29T16:27:08.777
> 
> 标签：javascript, windows

作为最近几年进入 web 开发的 win32 开发人员，我发现
基于 extjs 的 web 桌面非常有趣。

[Coolite Desktop](http://examples.coolite.com/Examples/Desktop/Introduction/Overview/Desktop.aspx)（损坏）
[Extjs Desktop](http://extjs.com/deploy/dev/examples/desktop/desktop.html)
[Puppy Web Desktop](http://pupweb.org/desktop/)
[Wikipedia list](http://en.wikipedia.org/wiki/Web_desktop)
[Lifehack list](http://www.lifehack.org/articles/technology/your-desktop-anywhere-21-web-based-desktops.html)
[Windows 3.1 desktop](http://209.213.121.56.nyud.net/)（损坏）
你知道其他人吗？

没有任何将应用程序开发为 Web 桌面的经验（我不是在推广 extjs，只是印象深刻......），
我不得不说我喜欢这个概念。

你怎么看，有用吗？

编辑 12 月 30 日有关此主题的更多信息：
[are-webos-practical-yet](https://stackoverflow.com/questions/398915/are-webos-practical-yet)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-29T16:40:19.313

我觉得这是一个有趣的实验，但我并没有真正找到它的附加值。

桌面概念适用于操作系统。大多数人使用一种操作系统。他们熟悉它的工作原理以及在导航方面的期望。话虽如此，在应用程序（或站点）级别拥有桌面会增加用户必须学习的另一种导航模型。如果他们期望它在他们的操作系统上是相同的（它不太可能），那么它可能会导致混乱，因为它不像他们习惯的那样工作 - 尽管它看起来*应该*。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-29T16:38:55.650

不。

此外， UI 的[恐怖谷](https://blog.codinghorror.com/avoiding-the-uncanny-valley-of-user-interface/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-29T16:39:02.683

我认为它们只是纯粹的技术演示，我认为网络桌面不会有任何吸引力，除非谷歌抓住这一点并将他们所有的主要应用程序（谷歌 Office、Gmail 等）作为网络桌面中的应用程序提供。

当然，整个桌面方法并不完全适合浏览器的心态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-29T16:42:16.250

真的，这看起来不像是一个巨大的进步。我不在乎桌面是在我的浏览器中运行还是在我的实际 PC 中运行。桌面环境继续遭受许多问题。

首先，我真的需要一些方法来整理和组织围绕我个人现实世界“逻辑”任务的开放应用程序。桌面环境都显示一个单一的、组织不善的静态应用程序列表。在忙碌的工作日中，我感觉自己有一半时间失去了理智。我经常有一种感觉就是“我为什么来到这个房间！？！”的代名词。当我无法跟踪我在桌面环境中的位置，或者为什么给定的应用程序甚至打开时的感觉。

已经尝试通过按应用对项目进行分组来解决这个问题。例如，在 Windows 中，将所有 Microsoft Word 内容分组到任务栏上的一个组中。问题是，我需要任务上的内容与我的真实世界任务相对应。诚然，我不希望 UI 能读懂我的想法，但如果有一些非常巧妙的方法可以将不同应用程序的多个实例组合在一起并通过一项任务识别它们，那就太棒了。

桌面环境的另一个问题是它们的性能。他们继续尝试突破硬件的极限。通常，他们会走得很远。正如[Jeff 指出的那样](http://www.codinghorror.com/blog/archives/001173.html)，对于开发人员来说，我希望我的工具能够快速运行。我无法忍受等待加载一些 GUI 小部件以便我可以编写代码，或者为此浏览网络或写一封电子邮件。在我看来，这就是为什么直接命令行开发继续蓬勃发展以及为什么我们中的许多人不想放弃 Windows XP 转而使用 Vista 的原因。

如果 Vista 无法做到这一点，那么拥有“网络桌面”就不会提高性能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-29T17:03:41.107

正如其他人所说，这已经存在了一段时间。我想如果它要起飞，它早就起飞了。我不认为这是技术追赶的问题，我认为这是开发人员不想将时间投入到久经考验的技术上的问题。

桌面是组织应用程序的好方法吗？我认识的大多数人不经常使用他们的桌面，它很少真正可见。Windows 中的“开始”菜单有更多用途，它类似于浏览器书签列表。

此外，我的观点是 Silverlight 将提供更好的基于浏览器的用户体验，同时减少开发时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T16:41:41.900

在我看来，但人们永远不会将它们用作台式机的替代品，有太多的怪癖和潜在的陷阱，无法真正替代甚至有用。

他们确实做了一个很酷的 ajax-y 技术演示，并作为如何开发具有桌面感觉的应用程序的指南（我不确定这是否值得），但仅此而已。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-29T16:43:23.423

能力的展示是惊人的。在 Web 浏览器中创建桌面环境是浏览器和 javascript 功能的一个很好的指示。

话虽如此，我相信它会（并希望它确实）作为一个可行的开发平台而消亡。目前，浏览器不提供桌面所具有的处理能力，桌面的开发比浏览器“模拟”桌面要容易得多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-29T16:48:14.693

Web 浏览器中的桌面隐喻很简洁，但是

*   1分钟后第一个链接仍在下载图像，所以我关闭了浏览器
*   第二个链接立即出现，看起来非常好
*   对于 Intranet 应用程序，这可能有意义
*   对于具有多个任务的基于任务的站点，这可能是有意义的
*   这并不是一个新概念——BBS 软件在 20 多年前就有这个概念，并在 8-10 年前将其扩展到网络；这个比喻不是很流行，因为这不是人们使用网络的方式......但是！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-29T19:37:00.953

不，因为网络就是操作系统，平台就是浏览器。

我使用了几个基于 Web 的应用程序，包括 Google Docs、Gmail 等。并非所有这些都来自同一提供商。我使用浏览器访问它们。

强迫我使用“网络桌面”就像十年前 ISP 的门户思维——强迫用户进入你自己的“世界”，让他们只使用你提供的应用程序。而不是仅仅充当通往那里所有可能选择的门户。

恕我直言，这就是 Web 桌面会失败的原因。PC 的操作系统可以利用您桌面上所有可能的资源，就像浏览器用于互联网一样。对我来说，Web 桌面等同于在您当前的操作系统上安装另一个操作系统并限制自己仅使用该操作系统。

# c# - 如何有效过滤基于多个列表框和组合的列表框？

> ID：398047
> 
> 赞同：1
> 
> 时间：2008-12-29T16:28:40.740
> 
> 标签：c#, asp.net

我有一个带有 5 个列表框的 aspx 页面。每个列表框都可以过滤另一个列表框，因此如果用户选择列表框 1 中的项目，则应过滤列表框 2、3、4 和 5。如果用户选择列表框 3 中的项目，则应过滤列表框 1、2、4 和 5。过滤器可以前进和后退。另一种情况是我在列表框 1 中选择一个项目，它过滤其他项目，然后我在列表框 2 中选择一个项目，它进一步过滤列表框 1 和其他项目，就像链式效果一样。我还必须处理多项选择。这可能会变得非常混乱，我很好奇是否有人知道处理这个问题的好方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T17:02:08.707

根据我对此类问题的经验，有时最简单的方法是在代码后面动态构建所有内容。

您从页面上的 ListBox 1 开始，并酌情禁用/隐藏其他。然后处理 ListBox 1 上的 ItemSelected 事件并将适当的项目添加到 ListBox 2 并启用/取消隐藏它。然后以类似的方式处理 ListBox 2 上的 Item Selected Event 级联更新您的页面/控件。

如有必要，您可以将列表框包装在更新面板中，这样刷新不会影响页面上的其他控件。

伪代码：

```
aspx:
    <asp:ListBox runat="server" ID="lb1" OnSelectedIndexChanged="OnLB1Change" AutoPostBack="true" >
        <asp:ListItem Text="A" Value="A"></asp:ListItem>
        <asp:ListItem Text="B" Value="B"></asp:ListItem>
    </asp:ListBox> 
```

后面的代码：

```
 protected void OnLB1Change(object sender, EventArgs e)
    {
        int val = ((ListBox)sender).SelectedIndex;

        switch (val)
        {
            case 0:
                //set up LB2 for values A
            break;
            case 1:
               //set up LB2 for values B
            break;

        }
    } 
```

# social-networking - 社交软件阅读摘要：有什么内容？

> ID：398054
> 
> 赞同：6
> 
> 时间：2008-12-29T16:32:29.280
> 
> 标签：social-networking

尽管我是一名寻求探索社交软件模式的程序员，但我也对它们的心理和社会学起源感兴趣。

***我建议的格式是将每个回复限制在一个阅读范围内，并简要说明其重要性。***

这个想法是，我们将能够看到哪些特定的读数是最重要的。由于社区 wiki 帖子不计入一个人的声誉，希望不会有太多的投诉。

我自己已经阅读了几篇论文和几本书，所以我将开始对话......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T16:36:50.410

## **[Shirky：社区、受众和规模](http://shirky.com/writings/community_scale.html)**

一篇 2002 年的文章认为社区无法扩展，因为人类与他人建立联系的能力有限，而这些联系使社区变得有用。我同意。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T16:33:50.667

## **[美味的教训](http://bokardo.com/archives/the-delicious-lesson/)**

[来自Bokardo](http://bokardo.com/)的 Del.icio.us 教训是，在社交应用中，个人价值先于网络价值。换句话说，您不应该期望您的用户对组功能的健康做出有意义的贡献。您可以而且应该做的是假设用户会按照自己的利益行事，然后尝试从他们所做的事情中学习。派生的信息对团队有用。

无论如何，这就是我从中得到的。还有很多关于一般标记优点的讨论，但这种阅读之所以重要，是因为上面概述的课程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T17:01:39.393

## [为社交网络设计](http://bokardo.com/archives/designing-for-the-social-web-the-book/)

作者 Joshua Porter 是一名网页设计师，因此本文对如何设计社交网络应用程序提出了建议；然而，这里有大量的心理和社会学分析可以得出这个建议。您可能还对《纽约时报》关于[环境亲密关系](http://ploneglenn.blogspot.com/2008/09/ambient-intimacy-is-new-collective.html)的这篇文章感兴趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T16:45:35.790

## **[卢卡斯影业栖息地的教训](http://www.fudco.com/chip/lessons.html)**

[“多用户在线环境” Habitat](http://en.wikipedia.org/wiki/Habitat_(video_game))的主要开发人员写下了他们的经验和教训。[Habitat 是一个虚拟社区，可以被认为是第二人生](http://en.wikipedia.org/wiki/Second_life)的早期先驱。在论文中，作者宣布了一些社交软件指南，其中一些在今天已被广泛接受。一些指导方针，例如带宽永远是稀缺资源的假设，是有先见之明的。作者花了很多时间试图说，我认为社交软件的复杂性应该来自用户，而不是程序员。

在另一个有远见的壮举中，作者警告社交软件的管理员尝试“在系统内工作”。我已经看到很多社交应用程序在审查用户的行为时受到很多负面关注，原因似乎不公平。Flickr 和 Digg 立即浮现在脑海中。作者可能会建议 flickr 和 digg 的版主在不拔出管理员卡并清除用户内容的情况下尝试阻止不需要的行为。

就像[LambdaMOO](http://www.cc.gatech.edu/classes/AY2001/cs6470_fall/LTAND.html)论文一样，有一个隐含的警告，不要假设您的软件用户有任何更高的思想。假设在线身份将显示离线人类所做的每一个基本行为。作者提醒我们，这些化身背后是真实的人。

本文末尾还有大量参考书目，尽管列出的材料现在已经过时了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T23:07:45.927

## [Shirky：一个群体是它自己最大的敌人](http://www.shirky.com/writings/group_enemy.html)

2003 年，Clay Shirky (shirky.com) 在 The O'Reilly Emerging Technology Conference 上发表了关于社交软件的演讲，这篇文章本质上是一个抄本。借用 WR Bion 的《团体经验》，他首先谈到了团体、线上和线下倾向于自我毁灭的方式。

这是一篇内容广泛的文章，其中 Shirky 解释了社交软件设计中的许多典型问题，列出了此类软件的设计者应该做出的假设，并概述了常见缺陷的解决方案。

总的来说，这是一本很棒的读物。如果您正在考虑编写一些新的社交软件产品，我建议您定期阅读以保持进度。

# internet-explorer - IE 302 重定向无缓存标头问题

> ID：398068
> 
> 赞同：6
> 
> 时间：2008-12-29T16:38:15.480
> 
> 标签：internet-explorer, caching, redirect, http-status-code-302

信息发布后返回 302 重定向。此重定向旨在重新加载当前页面。

这一切都很好，但 IE 在标题中添加了 No-Cache：

```
Cache-Control: no-cache 
```

我们正在使用 Squid 来缓存我们的内容，并将其放在标题中绕过 squid。
由于这种重定向经常被使用（没有办法解决这个问题），这大大增加了我们系统的负载。

Firefox 没有这个问题，它只是请求重定向的页面而不更改标题，这正是我们想要的。

我们可以做些什么来阻止 IE 添加无缓存？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-18T16:07:44.220

迷人。这确实是一个没有直接解决方法的 IE 问题。问题是 IE 将无条件地将 Cache-Control: no-cache 请求标头（或 Pragma: no-cache 请求标头，如果您有代理）添加到 HTTP POST 请求。

这无疑是十多年前在 IE 中引入的，以适应那些不能正确处理 HTTP POST 请求并且会错误地返回缓存响应的错误代理服务器。

IE 的一个怪癖是，当您重定向时，无缓存标头会重新添加到重定向的请求中。因此，在您的情况下，您的重定向请求还会发送从 POST 请求中携带的“无缓存”请求标头。

不幸的是，没有直接的解决方法。您可以将 IE 用户重定向到使用 JavaScript 将他们重定向回原始页面的插页式页面。（但不要使用 META REFRESH，因为它总是发送无缓存请求）。

# c++ - 模板中的静态成员变量，具有多个 dll

> ID：398069
> 
> 赞同：19
> 
> 时间：2008-12-29T16:38:30.643
> 
> 标签：c++, dll, visual-studio-2005, static, templates

我的代码是针对多个 .dll 文件构建的，并且我有一个具有静态成员变量的模板类。

我希望这个静态成员变量的同一个实例在所有 dll 中都可用，但它不起作用：我在每个 dll 中看到不同的实例（不同的值）。

当我不使用模板时，没有问题：在其中一个源文件中初始化静态成员，并在类上使用 __declspec(dllexport) 和 __declspec(dllimport) 指令。但它不适用于模板。有什么办法让它工作吗？

我看到了一些使用“extern”的建议解决方案，但我认为我不能使用它，因为我的代码应该适用于 Visual Studio 2002 和 2005。

谢谢你。

澄清：我希望每个不同类型的模板实例都有一个不同的静态变量实例。但是，如果我在 2 个不同的 dll 中实例化具有相同类型的模板，我希望它们都具有相同的变量。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-30T18:05:35.553

也存在以下解决方案：

*   在**库**中：显式实例化一些模板特化并与 dllexport 共享它们
*   在**主程序**中：
    *   如果专业可用，它将从库中使用
    *   如果专业化不可用，则在主程序中编译

详细说明如何执行此操作：

[Anteru 的博客显式模板实例化](http://anteru.net/2008/11/19/318/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T17:21:24.597

问题是每个不同的模板实例化都是不同的类型，具有自己的静态变量，不与具有不同模板参数的其他实例共享。您可以提供一个包含静态变量的非模板基类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T17:12:16.737

创建模板特化，然后导出特化的静态成员。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-18T15:20:06.390

似乎有一种方法可以减少对使用模板类的代码的限制。

使静态成员成为指针。创建具有固定已知类型并可从 DLL 导出的全局映射。该映射使用类的 typeid() 作为键，使用“每个类的全局变量”的地址作为值。通过一个函数初始化静态成员，该函数测试该类是否已存在于映射中，如果存在，则强制该类的第二个版本（在第二个 DLL 中）指向该类的第一个版本的静态变量。

这样，每个 DLL 都有一个不同的静态对象，但每个 DLL 也有一个指针，并且所有指针都指向同一个静态对象。

这是一些伪代码，假设静态的类型与模板参数相同（但应该很容易适应其他情况）。

```
map<string,void*> dllexport the_map;  // instantiate this once in a single DLL

T *set_the_global(T *candidate) {
  map<string,void*>::iterator r = the_map.find(string(typeid(the_class<T>).name()));
  if(r == the_map.end()) {
    the_map[string(typeid(the_class<T>).name())] = (void*)candidate;
    return candidate;  // new class: use it as global storage location
  } else {
    return (T*)(r->second);  // class already has global storage location
  }
}

template <class T> class the_class {
  virtual void something();  // so RTTI exists
  static T *the_global;  // use this! always points to the same object
  static T one_per_dll;  // only used in initialisation
};
template<class T> the_class<T>::one_per_dll;
template<class T> the_class<T>::the_global = set_the_global(&the_class<T>::one_per_dll) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T17:14:08.370

我可以看到这个问题有两个修复程序。

首先是你使用另一个类，一个不是模板的类来保存这个静态值——还是让它成为一个全局的？- 并将其从 dll 中导出。

另一个稍微复杂一些，因为您在代码中实例化模板并导出实例化的模板化值。举个例子，我有一种特殊的链表模板类，需要在 DLL 之间共享一个静态值。我编写了要模板化的代码，但它只真正用于少数类型。我会这样实例化这些类：

```
template <class T> class Foo;
template<> class Foo<int> {}; 
```

然后您可以导出其中包含的静态变量。

```
__declspec(dllexport) int Foo<int>::StaticMember = 0; 
```

（或者类似的东西，我对 dll 导出/导入有点生疏了。）

尽管真正的问题是您为什么要这样做，因为从技术上讲，DLL 可以跨进程使用，而内存中只存储一个副本。您真的希望所有进程只有一个静态版本，还是每个进程一个？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T17:27:24.320

您已经尝试过这种用法：

```
#pragma data_seg(".JOE")
HWND hWndServer = NULL;
HHOOK hook = NULL;
#pragma data_seg()
#pragma comment(linker, "/section:.JOE,rws") 
```

请注意，变量需要光束初始化。

更多信息：http: [//msdn.microsoft.com/en-us/library/ms997537.aspx](http://msdn.microsoft.com/en-us/library/ms997537.aspx) [http://www.flounder.com/hooks.htm](http://www.flounder.com/hooks.htm)

祝你好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T19:52:37.240

在`extern template`实例化被接受到标准草案中之前，微软似乎为 VC++ 编译器实现了一个扩展。

如果使用非标准扩展，VC++编译器会产生警告；VS.NET (2003) 及更高版本请参阅此[警告](http://msdn.microsoft.com/en-us/library/9d0x3403(VS.71).aspx)说明以了解详细信息。此警告也针对[VS 6.0](http://msdn.microsoft.com/en-us/library/aa233865(VS.60).aspx)列出。

我个人从未尝试使用此扩展程序，因此我无法保证此建议。显然，我将这个答案限制在 Microsoft Visual Studio（我看到了你关于 Unix 的评论），但我发帖希望它可能有用。

# xml - 在 xml 文档中嵌入可能格式不正确的 html 的适当方法是什么？

> ID：398083
> 
> 赞同：3
> 
> 时间：2008-12-29T16:44:09.960
> 
> 标签：xml, xslt, content-management-system

营销人员希望能够在（基于 xml 的）CMS 中编写直接内联 HTML。xhtml 合规性等可能会付诸东流，但他们是老板。CMS 使用常规的 xml/xslt 转换管道。目前，我们只使用单个节点和一个包含所有讨厌的 cdata 节点，使用一些讨厌的连接创建。

还有其他方法吗？

编辑：我可能能够说服他们 HTML 应该是某种格式*良好*的 HTML 片段，但在已知的世界中，我无法让他们同意 xhtml/strict 合规性，就像其他东西实际上*是*. 但据我了解，格式良好对我没有任何帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T17:05:48.717

CDATA 是执行此操作的*唯一*方法，无效标记根本不可能以任何已解析的结构进入 XML 文档。

我可以建议一个替代解决方案吗？修复问题标记，因为它被插入到 XML 中 - 绝对不是微不足道的，但坦率地说，他们给你的任务是荒谬的。

查看[HTML Tidy](http://tidy.sourceforge.net/)或[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)，它们可以使用标签汤并将其转换为有效的、格式良好的 xml。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T17:20:56.470

除了使用 CDATA 部分之外，一种解决方案是对营销人员编写的所有小于号和 & 号进行编码，并在显示之前对其进行解码。

但是，我确实认为涉及 HTML Tidy 之类的解决方案可能是最佳的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T19:02:14.317

我很确定您可以过滤营销人员通过 XHTML 转换器输入的 HTML。

比如[SgmlReader](http://wiki.developer.mindtouch.com/SgmlReader)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T18:53:11.680

您可以通过使用 CDATA 部分或通过显式转义相关字符（这两个选项实际上是等效的）来嵌入它们的所有污点。如前所述，有一些工具（例如 Tidy）会有所帮助，当然，一旦您获得了格式良好的文档，您可以使用 XSLT 将其转换为不那么令人不快的东西（当然，取决于 CMS您正在使用）。

说了这么多，我建议现在是讨论谁是哪些领域的“老板”的时候了。如果您在讨论品牌或其他任何事情时开始推翻他们，营销人员不会接受太多。你有你的专业领域，他们有他们的，他们的绝对不是 HTML。现在就打这场仗，否则你将在未来面临一个痛苦的世界。

# java - Java/JRuby on Rails vs .NET 3.5...感觉我做错了

> ID：398089
> 
> 赞同：0
> 
> 时间：2008-12-29T16:46:47.257
> 
> 标签：java, .net, ruby-on-rails, jruby

我打算用 Metro/Hibernate 用 Ja​​va 开发一个 Web 服务（SOAP 到 C++ 客户端），并在它前面有一个用 JRuby on Rails 编写的网站，通过 JRuby 和通常通过数据库连接 Java 模块。我已经编写了一些代码并设置了所有内容。

现在，我听说 .NET 3.5 非常强大，并且在阅读了一些内容后我承认这是真的。但是，放弃 Java 和 RoR 的这种可怕而奇怪的混合体，将所有东西都切换到 .NET 是否有意义？一切：服务、数据库连接（对象的 linq）、web-front、ajax 东西——一切都在一个巨大的 .NET 3.5 解决方案中。

我也希望玩得开心，但不如说，在 C++ 中用于服务器端：)

我知道，凭借 RoR 的力量，它是否属于任何一方并不重要。但是，无论我是为 .NET 还是 Java 设置的，我仍然觉得我做错了，我应该切换到我当前正在使用的非侧。

我在 Web 开发方面的经验非常有限，我只写过一次 ASP.NET Web 服务并支持 Java Web 服务，所以我有一个真正的强迫症，可以在这里选择平台。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T17:00:14.937

.NET 3.5 很有趣（在主流平台中），但在我个人看来，Ruby 的乐趣与 .NET 3.5 一样有趣。

关于功能，它们也大致相当，您当然可以在两者中毫无问题地制作一个 SOAP Web 服务应用程序。

关于“可怕的混合”，没有这样的东西，它只是一个（非常活跃的）端口，就像 .NET 领域的 IronRuby 或 IronPython。

当然，如果你坚持使用 .NET 并用 C# 编写，而不是混合搭配 Ruby 和 Java，将会有更多连贯的整体。但是您当然只能使用 JRuby。

鉴于乐趣和能力因素或多或少相等，我会选择 JRuby，以防我将来碰巧必须部署在 Linux、Solaris 或其他非 Windows 上。

如果您确定要永远坚持使用 Windows，请选择对您来说最有趣的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T17:00:30.427

对不起，但你在做的事情听起来像个大泥球。你走哪条路对我来说并不重要，但我会通过减少你正在使用的技术/框架的数量来简化架构。如果您可以在 Ruby/Rails 中找到一种无需参考 Java 的方法（尽管您可能需要保留 C++ 客户端），那将是可行的。显然，在 .NET（我的首选平台）中工作是另一种选择。Windows Communication Foundation 使得编写比旧的 ASP.NET Web 服务更轻的 Web 服务（包括使用 JSON 的 RESTful Web 服务）变得更加容易。

如果我今天这样做，我会使用 ASP.NET MVC 作为 Web 前端、WCF（用于 Web 服务），或者消除 C++ 客户端，或者考虑用 C# 和 .NET 或 Mono 编写它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T17:13:33.987

在我看来，你在这里有点过度计划或过度工程。通过阅读，我对您的架构不太清楚，但我看到很多词，如 .NET、Java、SOAP、C++、JRuby on Rails、RoR、Web 服务、Hibernate、ajax、linq 等，都被抛出周围，​​所以我只是想知道它们将如何融合在一起。由于我不太了解您的问题，因此这里有一些可能适合或不适合您需求的简化架构。我也没有看到你的帖子有任何问题，所以鉴于这种情况，我建议：

1.  Web 前端：使用 Ajax 的 RoR。网络服务：.NET。数据访问：Linq。

    这意味着您的 .NET Web 服务将使用 Linq 访问数据并通过 SOAP 公开，这将由前端 Ror 使用。

2.  或者，将 .NET 替换为 Java，将 Linq 替换为 Hibernate。

如果以上没有用，那么我的另一个建议是您不必将所有这些技术组合在一个解决方案中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T17:14:13.130

我宁愿在未来转向 FreeBSD 或 Debian……我肯定不想永远留在 Windows 上。但是有Mono，对吧？

# gridview - 链接gridviews进行分页？

> ID：398094
> 
> 赞同：0
> 
> 时间：2008-12-29T16:50:52.270
> 
> 标签：gridview

我实施了 HectorMac 的建议，[https:](https://stackoverflow.com/questions/254075/aspnet-grid-with-frozen-columns) //stackoverflow.com/questions/254075/aspnet-grid-with-frozen-columns ，但我启用了分页，因为我有很多记录......我想知道是否有人有，或者可以指导我如何链接两个网格视图，所以当我在一个网格上推进页面时，另一个也会推进......

谢谢 ...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T16:54:05.900

在黑暗中拍摄：http: [//msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.pageindexchanged.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.pageindexchanged.aspx)

# sql - SQL在特定行周围选择“窗口”

> ID：398100
> 
> 赞同：8
> 
> 时间：2008-12-29T16:54:52.683
> 
> 标签：sql, mysql

以前很可能有人问过这样的问题，但我想不出要搜索的术语。

我正在开发一个照片库应用程序，并希望显示 9 个缩略图，以显示当前照片的上下文（在 3x3 网格中，当前照片位于中心，除非当前照片在前 4 张照片中显示，在这种情况下，如果当前照片是第二张我想选择照片 1 到 9)。例如，给定一个包含带有 id 的照片列表的相册：

1、5、9、12、13、18、19、20、21、22、23、25、26

如果当前照片是 19，我还想查看：

9、12、13、18、19、20、21、22、23

如果当前照片是 5，我还想查看：

1、5、9、12、13、18、19、20、21

我一直在想一些事情：

```
SELECT *
FROM photos
WHERE ABS(id - currentphoto) < 5
ORDER BY id ASC 
LIMIT 25 
```

但这在 id 不连续的情况下（如上面的示例）或当前照片之前的照片不足的情况下不起作用。

有什么想法吗？

谢谢，

多姆

ps 如果有什么不清楚的地方请留言，我会澄清这个问题。如果有人能想到一个更有用的标题来帮助其他人将来找到这个问题，那么也请发表评论。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T18:14:20.013

可能只使用一个 UNION，然后在显示结果的程序代码中修剪掉额外的结果（因为这将在非边缘情况下返回 20 行）：

```
(SELECT 
     * 
FROM photos
   WHERE ID < #current_id#
   ORDER BY ID DESC LIMIT 10)
UNION
  (SELECT *
   FROM photos
   WHERE ID >= #current_id#
   ORDER BY ID ASC LIMIT 10)
ORDER BY ID ASC 
```

**编辑：根据le dorfier**的建议，将 UNION 两侧的限制增加到 10 。

编辑2：修改以更好地反映最终实施，如多米尼克所建议的那样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T17:21:30.853

如果您使用的是 SQL Server，则可以使用 row_number() 函数为您提供行顺序索引并执行以下操作：

```
declare @selected_photo integer;
set @selected_photo = 5;

declare @buffer_size integer;
set @buffer_size = 2;

select
   ph.rownum,
   ph.id
from
   (select row_number() over (order by Id) as rownum, * from Photos) as ph
where
   ph.rownum between case
                         when @selected_photo - @buffer_size < 1 then 1
                         else @selected_photo - @buffer_size
                      end
                      and @selected_photo + @buffer_size 
```

编辑：这是一篇关于在 MySQL 中模拟 row_number() 函数的文章，结合它可能会得到你需要的东西 - 我会尝试它，但没有一个 MySQL 数据库可以在工作中使用。:-)

[http://www.xaprb.com/blog/2006/12/02/how-to-number-rows-in-mysql/](http://www.xaprb.com/blog/2006/12/02/how-to-number-rows-in-mysql/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T17:03:44.383

这是标准的“行排序”问题...如果您的数据库具有 rowId 功能，您可以使用它，否则您需要一个子查询来计算 ID 小于当前行 ID 的行数...像这样：

-- 假设@Id 是“中间”的 id 值

```
 Select *  From Photos P
 Where (Select Count(*) From Photos
         Where id <= P.Id)
     Between (Select Count(*) From Photos
              Where id < @Id) - 4
        And  (Select Count(*) From Photos
              Where id < @Id) + 4 
```

作为评论提出了专辑问题，您希望将专辑谓词添加到每个子查询

```
 Select *  From Photos P
   Where (Select Count(*) From Photos
          Where album = @album
            And id <= P.Id)
     Between (Select Case When Count(*) < 4 
                      Then 4 Else Count(*) End
              From Photos
              Where album = @album
                 And id < @Id) - 4
        And  (Select Case When Count(*) < 4 
                      Then 4 Else Count(*) End
              From Photos
              Where album = @album
                  And id < @Id) + 4 
```

# google-analytics - 如何在 Google Analytics 中修改页面 URL

> ID：398110
> 
> 赞同：5
> 
> 时间：2008-12-29T17:00:54.373
> 
> 标签：google-analytics

如何修改传递给 Google Analytics 的当前页面的 URL？

（我需要从某些页面中删除扩展名，因为对于不同的情况，可以请求一个页面有或没有它，而 GA 将其视为两个不同的页面。）

例如，如果页面 URL 是`http://mysite/cake/ilikecake.html`，我该如何传递给谷歌分析`http://mysite/cake/ilikecake`呢？

我可以很好地剥离扩展，我只是不知道如何将我想要的 URL 传递给 Google Analytics。我已经尝试过了，但 Google Analytics（分析）控制台中的统计信息未显示任何页面浏览量：

> pageTracker._trackPageview('cake/ilikecake');

谢谢，迈克

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T16:05:00.853

您可以编辑 GA 配置文件并添加自定义过滤器...

创建一个“搜索和替换”自定义过滤器，将过滤器字段设置为“请求 URI”并使用类似：

搜索字符串： `(.*ilikecake\.)html$`

替换字符串：（ `$1`
是`\1`）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-29T20:17:12.400

想到了两种可能：

1.  访问可能需要一段时间（最长约 24 小时）才能反映在 Google Analytics（分析）统计信息中。你多久之前做出改变的？

2.  尝试以“/”开头的路径名，所以

    ```
    pageTracker._trackPageview('/cake/ilikecake'); 
    ```

    然后稍等一下，根据第一项。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-13T06:33:58.440

通常你的文件末尾有 ga 脚本代码，而特殊的 _trackPageviews() 调用通常在其他地方使用。

在定义 pagetracker 后，您是否确定已调用 pageTracker._trackPageview()？

像这样：

```
var pageTracker = _gat._getTracker("UA-XXXXXXX-X");
pageTracker._trackPageview(); 
```

否则我想你只会得到一个 JavaScript 错误。

# javascript - 检测 Firebug 的 Javascript？

> ID：398111
> 
> 赞同：68
> 
> 时间：2008-12-29T17:01:38.333
> 
> 标签：javascript, firebug

检测用户是否启用了 Firebug 的可靠方法是什么？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-12-29T17:06:18.510

# 原答案：

检查`console`对象（仅使用 Firebug 创建），如下所示：

```
if (window.console && window.console.firebug) {
  //Firebug is enabled
} 
```

* * *

# 更新（2012 年 1 月）：

Firebug 开发人员已[决定删除`window.console.firebug`](http://code.google.com/p/fbug/issues/detail?id=4772). 您仍然可以通过[鸭子类型来](http://en.wikipedia.org/wiki/Duck_typing)检测 Firebug 的存在，例如

```
if (window.console && (window.console.firebug || window.console.exception)) {
  //Firebug is enabled
} 
```

或[其他各种方法](http://code.google.com/p/fbug/issues/detail?id=4772#c8)，例如

```
if (document.getUserData('firebug-Token')) ...
if (console.log.toString().indexOf('apply') != -1) ...
if (typeof console.assert(1) == 'string') ... 
```

但总的来说，实际上应该没有必要这样做。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-29T17:05:02.740

如果启用了 firebug，window.console 将不会未定义。console.firebug 将返回版本号。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-01-08T22:22:34.797

从 Firebug 版本 1.9.0 开始，`console.firebug`由于隐私问题不再定义；请参阅[发行说明](http://getfirebug.com/wiki/index.php/Firebug_Release_Notes#Firebug_1.9)、[错误报告](http://code.google.com/p/fbug/issues/detail?id=4772)。**这打破了上述方法。**确实，它将艾伦的问题的答案改为“没有办法”；如果有*另*一种方式，它被认为是一个错误。

相反，解决方案是检查可用性`console.log`或您想要使用或替换的任何内容。

这是一个替换 David Brockman 上面介绍的那种代码的建议，但不会删除任何现有函数。

```
(function () {
    var names = ['log', 'debug', 'info', 'warn', 'error', 'assert', 'dir', 'dirxml', 
                'group', 'groupEnd', 'time', 'timeEnd', 'count', 'trace', 'profile', 'profileEnd'];

    if (window.console) {
        for (var i = 0; i < names.length; i++) {
            if (!window.console[names[i]]) {
                window.console[names[i]] = function() {};
            }
        }
    } else {
        window.console = {};
        for (var i = 0; i < names.length; i++) {
            window.console[names[i]] = function() {};
        }
    }
})(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-29T17:13:53.410

可能无法检测到。

Firebug 有多个选项卡，可以单独禁用，现在默认不启用。

GMail 只能判断我是否启用了“控制台”选项卡。比这更深入的探测可能需要安全规避，你不想去那里。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-30T00:01:30.373

如果未安装，您可以使用类似的方法来防止代码中的 firebug 调用导致错误。

```
if (!window.console || !console.firebug) {
    (function (m, i) {
        window.console = {};
        while (i--) {
            window.console[m[i]] = function () {};
        }
    })('log debug info warn error assert dir dirxml trace group groupEnd time timeEnd profile profileEnd count'.split(' '), 16);
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-09-19T02:38:55.437

请记住，在 Chrome 中 window.console 也返回 true 或 [ `Object console]`。

此外，我会检查是否安装了 Firebug

`if (window.console.firebug !== undefined) // firebug is installed`

以下是我在 Safari 和 Chrome 中得到的，没有安装 firebug。

```
if (window.console.firebug) // true
if (window.console.firebug == null) // true
if (window.console.firebug === null) // false 
```

Is-True 和 Is-Not 运算符显然会进行类型强制，这在 JavaScript 中应该避免。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-16T03:05:47.273

目前，window.console.firebug 已被最新的 firebug 版本删除。因为 firebug 是一个基于扩展的 JavaScript 调试器，它在 window.console 中定义了一些新的函数或对象。所以大多数时候，你只能使用这个新定义的函数来检测firebug的运行状态。

如

```
if(console.assert(1) === '_firebugIgnore') alert("firebug is running!"); 
if((console.log+'''').indexOf('return Function.apply.call(x.log, x, arguments);') !== -1)  alert("firebug is running!"); 
```

您可以在每个萤火虫中测试这些方法。

最良好的祝愿！

# c# - Expression.AddChecked 和 System.Int16

> ID：398117
> 
> 赞同：3
> 
> 时间：2008-12-29T17:05:29.370
> 
> 标签：c#, expression-trees

给定两条短裤 ( `System.Int16`)

```
short left = short.MaxValue;
short right = 1; 
```

我想`OverflowException`在添加它们时得到一个。

```
checked(left+right) 
```

不起作用，因为结果`left+right`是`Int32`.

```
checked((short)(left+right)) 
```

按预期工作。

我的问题是，使用表达式树，“技巧”不起作用：

```
var a = Expression.Constant(left);
var b = Expression.Constant(right);
var sum = Expression.ConvertChecked(Expression.Add(a, b), typeof(short));
var l = Expression.Lambda(sum);
var f = (Func<short>)l.Compile(); 
```

调用`f()`不会抛出溢出异常而是返回`-32768`。怎么了？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T17:23:42.640

问题是添加*是*作为short + short 完成的（它可能存在于IL中，即使它在C#中不存在） - 然后单独执行转换。这个完整的程序显示了这一点 - 即使没有转换，结果也是 -32768：

```
using System;
using System.Linq.Expressions;

class Test
{
    static void Main(string[] args)
    {
        short left = short.MaxValue;
        short right = 1;
        var a = Expression.Constant(left);
        var b = Expression.Constant(right);
        var sum = Expression.Add(a, b);
        var convert = Expression.ConvertChecked(sum, typeof(short));
        var convertLambda = Expression.Lambda<Func<short>>(convert);
        var convertFunc = convertLambda.Compile();
        Console.WriteLine("Conversion: {0}", convertFunc());
        var sumLambda = Expression.Lambda<Func<short>>(sum);
        var sumFunc = sumLambda.Compile();
        Console.WriteLine("Sum: {0}", sumFunc());
    }
} 
```

如果你让它做一个 int + int 加法然后转换，它会抛出一个溢出异常：

```
using System;
using System.Linq.Expressions;

class Test
{
    static void Main(string[] args)
    {
        short left = short.MaxValue;
        short right = 1;
        var a = Expression.Constant((int) left);
        var b = Expression.Constant((int) right);
        var sum = Expression.Add(a, b);
        var convert = Expression.ConvertChecked(sum, typeof(short));
        var convertLambda = Expression.Lambda<Func<short>>(convert);
        var convertFunc = convertLambda.Compile();
        Console.WriteLine("Conversion: {0}", convertFunc());
        var sumLambda = Expression.Lambda<Func<int>>(sum);
        var sumFunc = sumLambda.Compile();
        Console.WriteLine("Sum: {0}", sumFunc());
    }
} 
```

我不知道为什么`AddChecked`不起作用...这看起来像一个错误:(使用[允许指定方法的重载可能会起作用](http://msdn.microsoft.com/en-us/library/bb336728.aspx)，但我不确定...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T17:30:11.553

谢谢。

换句话说：您在 C# 中看到的内容不能 1:1 转换为表达式树。我想知道为什么他们决定隐含地将两条短裤的总和扩大到 int。

# orm - 使用 ORM 有什么好处？

> ID：398134
> 
> 赞同：64
> 
> 时间：2008-12-29T17:14:29.523
> 
> 标签：orm

作为一名希望从手动编码的 PHP 站点迁移到基于框架的站点的 Web 开发人员，我看到了很多关于 ORM 相对于另一种的优势的讨论。它似乎对*一定（？）*规模的项目很有用，对于企业级应用程序甚至更重要。

作为开发人员，它给了我什么？我的代码与我现在使用的单个 SELECT 语句有何不同？它对数据库访问和安全性有何帮助？它如何找出数据库模式和用户凭据？

**编辑：** *@duffymo 指出了对我来说应该很明显的事情：ORM 仅对 OOP 代码有用。我的代码不是OO的，所以没有遇到ORM解决的问题。*

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-12-29T17:30:17.153

我想说，如果你不处理对象，那么使用 ORM 就没有什么意义了。

如果您的关系表/列与对象/属性 1:1 映射，则使用 ORM 没有多大意义。

如果您的对象与其他对象没有任何 1:1、1:m 或 m:n 关系，则使用 ORM 没有多大意义。

如果你有复杂的、手动调优的 SQL，那么使用 ORM 没有多大意义。

如果您决定您的数据库将存储过程作为其接口，那么使用 ORM 就没有多大意义了。

如果您有一个无法重构的复杂遗留模式，那么使用 ORM 没有多大意义。

所以反过来：

如果您有一个实体对象模型，对象之间的关系为 1:1、1:m 和 m:n，则没有存储过程，并且喜欢 ORM 解决方案将为您提供的动态 SQL，无论如何使用 ORM。

像这样的决定总是一种选择。选择、实施、衡量、评估。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-12-29T17:33:14.167

ORM 被大肆宣传是解决数据访问问题的方法。就个人而言，在企业项目中使用它们之后，它们远不是企业应用程序开发的解决方案。也许他们在小项目中工作。以下是我们在使用 nHibernate 时遇到的问题：

1.  配置：ORM 技术需要配置文件来将表模式映射到对象结构中。在大型企业系统中，配置增长非常迅速，并且变得极难创建和管理。随着业务需求和模型在敏捷环境中不断变化和发展，维护配置也变得乏味且不可维护。

2.  自定义查询：框架提供者不支持或不推荐映射不适合任何已定义对象的自定义查询的能力。开发人员被迫通过编写临时对象和查询，或编写自定义代码来获取他们需要的数据来寻找解决方法。他们可能不得不定期使用存储过程来处理比简单选择更复杂的事情。

3.  专有绑定：这些框架需要使用专有库和专有对象查询语言，这些语言在计算机科学行业中没有标准化。这些专有库和查询语言将应用程序绑定到提供程序的特定实现，如果需要，几乎没有或没有更改的灵活性，也没有相互协作的互操作性。

4.  对象查询语言：提供称为对象查询语言的新查询语言来对对象模型执行查询。它们自动生成针对数据库的 SQL 查询，并将用户从流程中抽象出来。对于面向对象的开发人员来说，这似乎是一种好处，因为他们觉得编写 SQL 的问题已经解决了。实际问题是这些查询语言不能支持大多数实际应用程序所需的一些中级到高级 SQL 构造。它们还阻止开发人员在必要时调整 SQL 查询。

5.  性能：ORM 层使用反射和自省来实例化对象并使用数据库中的数据填充对象。这些在处理方面是昂贵的操作，并增加了映射操作的性能下降。转换为生成未优化查询的对象查询没有调整它们的选项会导致显着的性能损失和数据库管理系统的过载。几乎不可能对 SQL 进行性能调整，因为框架在控制自动生成的 SQL 方面几乎没有灵活性。

6.  紧密耦合：这种方法在模型对象和数据库模式之间创建了紧密的依赖关系。开发人员不希望数据库字段和类字段之间存在一对一的关联。更改数据库模式会对对象模型和映射配置产生影响，反之亦然。

7.  缓存：此方法还需要使用对象缓存和上下文，这些缓存和上下文是维护和跟踪对象状态并减少缓存数据的数据库往返所必需的。如果不在多层实现中维护和同步这些缓存，则在数据准确性和并发性方面可能会产生重大影响。通常必须插入第三方缓存或外部缓存来解决这个问题，给数据访问层增加了巨大的负担。

有关我们分析的更多信息，您可以阅读： [http ://www.orasissoftware.com/driver.aspx?topic=whitepaper](http://www.orasissoftware.com/driver.aspx?topic=whitepaper)

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2008-12-29T17:34:44.397

在非常高的层次上：ORM 有助于减少对象-关系阻抗不匹配。它们允许您从关系数据库存储和检索完整的活动对象，而无需自己进行大量解析/序列化。

> 作为开发人员，它给了我什么？

首先，它可以帮助您保持干爽。您的架构或模型类是权威的，另一个是自动生成的，这减少了错误的数量和样板代码的数量。

它有助于编组。ORM 通常会处理将各个列的值编组为适当的类型，这样您就不必自己解析/序列化它们。此外，它允许您从数据库中检索完全形成的对象，而不是简单地包装自己的行对象。

> 我的代码与我现在使用的单个 SELECT 语句有何不同？

由于您的查询将返回对象而不仅仅是行，因此您将能够使用属性访问而不是创建新查询来访问相关对象。您通常可以在需要时直接编写 SQL，但对于大多数操作 (CRUD)，ORM 将使与持久对象交互的代码更简单。

> 它对数据库访问和安全性有何帮助？

一般来说，ORM 有自己的 API 用于构建查询（例如属性访问），因此不太容易受到 SQL 注入攻击；但是，它们通常允许您将自己的 SQL 注入到生成的查询中，以便您可以在需要时做一些奇怪的事情。此类注入的 SQL 您有责任自行清理，但是，如果您不使用此类功能，则 ORM 应负责自动清理用户数据。

> 它如何找出数据库模式和用户凭据？

许多 ORM 附带工具，这些工具将检查模式并构建一组模型类，允许您与数据库中的对象进行交互。[数据库] 用户凭据通常存储在设置文件中。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-12-29T17:34:44.367

如果您手动编写数据访问层，那么您实际上是在编写自己的功能较差的 ORM。

Oren Eini 有一个不错的博客，它总结了您在 DAL/ORM 中可能需要的基本功能以及为什么编写您自己的功能在一段时间后变成一个坏主意：http: [//ayende.com/Blog/archive/2006/05/12 /25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx](http://ayende.com/Blog/archive/2006/05/12/25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx)

编辑：OP 在其他答案中评论说他的代码库不是非常面向对象的。处理对象映射只是 ORM 的一个方面。[Active Record](http://www.martinfowler.com/eaaCatalog/activeRecord.html)模式是一个很好的例子，说明 ORM 在对象 1:1 映射到表的场景中仍然有用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-29T17:24:56.600

主要好处：

1.  数据库抽象
2.  以 API 为中心的设计理念
3.  高层次 == 在基本层次上不用担心（它是为你考虑的）

我不得不说，使用 ORM 确实是数据库驱动应用程序的演变。您不必担心总是编写的样板 SQL，而更多地担心接口如何协同工作以构成一个非常简单的系统。

我喜欢不必担心 INNER JOIN 和 SELECT COUNT(*)。我只是在我的高级抽象中工作，同时我已经处理了数据库抽象。

话虽如此，我从来没有真正遇到过需要在多个数据库系统上实际运行相同代码的问题。但是，这并不是说这种情况不存在，对于一些开发人员来说，这是一个非常现实的问题。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-12-29T20:29:44.357

我不能代表其他 ORM，只是 Hibernate（用于 Java）。

Hibernate 给了我以下信息：

*   在运行时自动更新生产系统上表的模式。有时您仍然需要自己手动更新一些内容。
*   自动创建外键，防止您编写创建孤立数据的错误代码。
*   实现连接池。有多个连接池提供程序可用。
*   缓存数据以加快访问速度。有多个缓存提供程序可用。这也允许您将许多服务器聚集在一起以帮助您扩展。
*   使数据库访问更加透明，以便您可以轻松地将应用程序移植到另一个数据库。
*   使查询更易于编写。下面的查询通常需要你写 'join' 三次，可以这样写：
    *   “来自发票 i，其中 i.customer.address.city = ？” 这将检索具有特定城市的所有发票
    *   返回一个 Invoice 对象列表。然后我可以调用 invoice.getCustomer().getCompanyName(); 如果数据尚未在缓存中，则在后台自动查询数据库

您可以对数据库进行逆向工程以创建休眠模式（我自己还没有尝试过），或者您可以从头开始创建模式。

当然，任何新技术都有一个学习曲线，但我认为这是非常值得的。

需要时，您仍然可以下拉到较低的 SQL 级别来编写优化查询。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-12-29T17:22:42.707

使用的大多数数据库是不直接转换为对象的关系数据库。对象关系映射器所做的是获取数据，围绕它创建一个外壳，其中包含用于更新、删除、插入和其他可执行操作的实用功能。因此，您现在不再将其视为行数组，而是拥有一个对象列表，您可以像操作其他任何对象一样操作，完成后只需调用 obj.Save()。

我建议你看看一些正在使用的 ORM，我最喜欢的是 Python 框架[django](http://www.djangoproject.com)中使用的 ORM 。这个想法是，您编写数据在数据库中的外观定义，而 ORM 负责验证、检查以及在插入数据之前需要运行的任何机制。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-29T17:24:50.673

> 作为开发人员，它给了我什么？

节省您的时间，因为您不必编写数据库访问部分的代码。

> 我的代码与我现在使用的单个 SELECT 语句有何不同？

您将使用属性或 xml 文件来定义到数据库表的类映射。

> 它对数据库访问和安全性有何帮助？

大多数框架都尝试在适用的情况下遵循 db 最佳实践，例如参数化 SQL 等。因为实现细节是在框架中编码的，所以您不必担心它。然而，出于这个原因，了解您正在使用的框架也很重要，并注意任何可能打开意外漏洞的设计缺陷或错误。

> 它如何找出数据库模式和用户凭据？

您一如既往地提供连接字符串。框架提供者（例如 SQL、Oracle、MySQL 特定类）提供查询数据库模式、处理类映射以及根据需要呈现/执行数据库访问代码的实现。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-29T17:25:28.317

就个人而言，迄今为止，我在使用 ORM 技术方面并没有很好的经验。我目前在一家使用 nHibernate 的公司工作，我真的无法继续使用它。随时给我一个存储过程和 DAL！更多的代码是肯定的......但也有更多的控制和更容易调试的代码——根据我使用早期版本的 nHibernate 的经验，它必须被添加。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-12-29T17:30:30.320

使用 ORM 将删除您的代码对特定 SQL 方言的依赖关系。您将与在代码和数据库实现之间提供隔离的抽象层进行交互，而不是直接与数据库交互。此外，ORM 通常通过构造参数化查询来防止 SQL 注入。当然你可以自己做，但是有框架保证很好。

ORM 以两种方式之一工作：一些从现有数据库中发现模式——LINQToSQL 设计器执行此操作——另一些则要求您将类映射到表上。在这两种情况下，一旦模式被映射，ORM 就可以为您创建（重新创建）您的数据库结构。数据库权限可能仍需要手动或通过自定义 SQL 应用。

通常，通过 API 或使用配置文件以编程方式提供的凭据 - 或两者兼有，默认来自配置文件，但可以在代码中覆盖。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-05-07T09:05:26.917

虽然我几乎完全同意接受的答案，但我认为可以通过考虑轻量级替代方案对其进行修改。

*   如果您有复杂的、手动调优的 SQL
*   如果您的对象与其他对象没有任何 1:1、1:m 或 m:n 关系
*   如果您有一个无法重构的复杂遗留架构

> ...那么您可能会受益于轻量级 ORM，其中 SQL 不会被模糊或抽象到更容易编写自己的数据库集成的地步。

这些是我公司的开发团队决定我们需要进行更灵活的抽象以驻留在 JDBC 之上的众多原因中的几个。

有许多开源替代方案可以完成类似的事情，[jORM](https://github.com/jajja/jorm)是我们提出的解决方案。

我建议在选择轻量级 ORM 之前评估一些最强大的候选者。它们在处理抽象数据库的方法上略有不同，但从上往下看可能看起来很相似。

*   [约姆](https://github.com/jajja/jorm)
*   [主动JDBC](http://code.google.com/p/activejdbc/)
*   [ORMLite](http://ormlite.com)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-18T08:54:01.547

我对 ORM 框架的关注可能正是它吸引许多开发人员的原因。

nameley，它消除了“关心”数据库级别发生的事情的需要。我们在应用程序的日常运行中看到的大多数问题都与数据库问题有关。我有点担心一个 100% ORM 的世界，人们不会知道哪些查询正在访问数据库，或者如果他们知道，他们不确定如何更改或优化它们。

{我意识到这可能是一个相反的答案:) }

# linux - Linux下的文档管理

> ID：398136
> 
> 赞同：5
> 
> 时间：2008-12-29T17:15:00.193
> 
> 标签：linux, organization, document-management

经过多年在杂乱无章的文档的海洋中航行，我开始寻找一种廉价/免费的方法来对我们的工作文档进行结构分类，以便整理并更好地执行工作流程。所以我希望能够根据项目、客户、使用的组件等标记文档。
例如，想象这些文档：

*   《业务需求》，标签：projectX
*   《项目布局》，标签：projectX、appserverZ
*   《类图》，标签：projectX、businesslogic
*   《报价单》，标签：projectX、customerY

...等等..
这样我可以通过标签过滤文档，例如获取给定项目的所有文档，或给定客户的所有报价，或使用给定应用程序服务器的所有项目。 .
像[M 文件这样的](http://www.m-files.com)东西会很完美，但我更喜欢基于 Linux 的解决方案.. :) （如果可能的话，甚至不是基于网络的）
我整天都在尝试在 Freshmeat 和 Wikipedia 上找到的 DMS，但我找不到一个像 M 文件一样工作的文件.. :/
我将不胜感激任何提示/指针，非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T17:21:04.830

听起来您可能正在寻找类似[Lucene](http://lucene.apache.org/java/docs/)的东西，以及一些元数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T18:15:26.423

Lucene 是一个很棒的开发工具，但如果你更喜欢开箱即用的东西，[Alfresco](http://www.alfresco.com/)会工作，但它可能已经过时了。其中之一也可能[会](http://java-source.net/open-source/content-managment-systems)起作用。

# delphi - 执行嵌套 TRY / FINALLY 语句的最佳实践

> ID：398137
> 
> 赞同：20
> 
> 时间：2008-12-29T17:16:36.667
> 
> 标签：delphi, memory-management, object-lifetime, try-finally

嗨，在 delphi 中做嵌套 try 和 finally 语句的最佳方法是什么？

```
var cds1  : TClientDataSet;
    cds2  : TClientDataSet;
    cds3  : TClientDataSet;
    cds4  : TClientDataSet;
begin
  cds1      := TClientDataSet.Create(application );
  try
    cds2      := TClientDataSet.Create(application );
    try
      cds3      := TClientDataSet.Create(application );
      try
        cds4      := TClientDataSet.Create(application );
        try
        ///////////////////////////////////////////////////////////////////////
        ///      DO WHAT NEEDS TO BE DONE
        ///////////////////////////////////////////////////////////////////////
        finally
          cds4.free;
        end;

      finally
        cds3.free;
      end;
    finally
      cds2.free;
    end;
  finally
    cds1.free;
  end;
end; 
```

你能提出一个更好的方法吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-29T17:25:20.877

以下内容如何：

```
var cds1  : TClientDataSet;
    cds2  : TClientDataSet;
    cds3  : TClientDataSet;
    cds4  : TClientDataSet;
begin
  cds1      := Nil;
  cds2      := Nil;
  cds3      := Nil;
  cds4      := Nil;
  try
    cds1      := TClientDataSet.Create(nil);
    cds2      := TClientDataSet.Create(nil);
    cds3      := TClientDataSet.Create(nil);
    cds4      := TClientDataSet.Create(nil);
    ///////////////////////////////////////////////////////////////////////
    ///      DO WHAT NEEDS TO BE DONE
    ///////////////////////////////////////////////////////////////////////
  finally
    freeandnil(cds4);
    freeandnil(cds3);
    freeandnil(cds2);
    freeandnil(Cds1);
  end;
end; 
```

这使它保持紧凑，并且只尝试释放已创建的实例。确实没有必要执行嵌套，因为任何失败都会导致最终掉到最后并执行您提供的示例中的所有清理。

就我个人而言，我尽量不要嵌套在同一个方法中……除了 try/try/except/finally 场景。如果我发现自己需要嵌套，那么对我来说这是考虑重构为另一个方法调用的好时机。

**编辑**感谢[mghie](https://stackoverflow.com/users/30568/mghie)和[utku](https://stackoverflow.com/users/14716/utku-karatas)的评论，清理了一下。

**EDIT**将对象创建更改为不引用应用程序，因为在此示例中没有必要。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-29T17:38:47.743

我会使用这样的东西：

```
var
  Safe: IObjectSafe;
  cds1 : TClientDataSet;
  cds2 : TClientDataSet;
  cds3 : TClientDataSet;
  cds4 : TClientDataSet;
begin
  Safe := ObjectSafe;
  cds1 := Safe.Guard(TClientDataSet.Create(nil)) as TClientDataSet;
  cds2 := Safe.Guard(TClientDataSet.Create(nil)) as TClientDataSet;
  cds3 := Safe.Guard(TClientDataSet.Create(nil)) as TClientDataSet;
  cds4 := Safe.Guard(TClientDataSet.Create(nil)) as TClientDataSet;
  ///////////////////////////////////////////////////////////////////////
  ///      DO WHAT NEEDS TO BE DONE
  ///////////////////////////////////////////////////////////////////////

  // if Safe goes out of scope it will be freed and in turn free all guarded objects
end; 
```

对于接口的实现，请参阅[这篇](http://dn.codegear.com/article/28217)文章，但您可以轻松地自己创建类似的东西。

**编辑：**

我刚刚注意到在链接的文章中 Guard() 是一个过程。在我自己的代码中，我重载了返回 TObject 的 Guard() 函数，上面的示例代码假设类似。当然，现在可以使用泛型更好的代码......

**编辑2：**

如果您想知道为什么 try ... finally 在我的代码中被完全删除：如果不引入内存泄漏（当析构函数引发异常）或访问冲突的可能性，就不可能删除嵌套块。因此最好使用辅助类，让接口的引用计数完全接管。帮助类可以释放它保护的所有对象，即使某些析构函数引发异常。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T09:29:59.383

没有嵌套尝试的代码还有另一种变体……我终于想到了。如果您不创建将构造函数的 AOWner 参数设置为 nil 的组件，那么您可以简单地使用 VCL 免费为您提供的生命周期管理：

```
var
  cds1: TClientDataSet;
  cds2: TClientDataSet;
  cds3: TClientDataSet;
  cds4: TClientDataSet;
begin
  cds1 := TClientDataSet.Create(nil);
  try
    // let cds1 own the other components so they need not be freed manually
    cds2 := TClientDataSet.Create(cds1);
    cds3 := TClientDataSet.Create(cds1);
    cds4 := TClientDataSet.Create(cds1);

    ///////////////////////////////////////////////////////////////////////
    ///      DO WHAT NEEDS TO BE DONE
    ///////////////////////////////////////////////////////////////////////

  finally
    cds1.Free;
  end;
end; 
```

我是小代码的忠实信徒（如果它不是太混淆的话）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-23T09:59:09.060

如果您想走这条（IMO）丑陋的路线（初始化为 nil 的组处理以了解是否需要释放），您至少必须保证您不会让析构函数中的异常阻止释放其余部分你的对象。
就像是：

```
function SafeFreeAndNil(AnObject: TObject): Boolean;
begin
  try
    FreeAndNil(AnObject);
    Result :=  True;
  except
    Result := False;
  end;
end;

var cds1  : TClientDataSet;
    cds2  : TClientDataSet;
    IsOK1 : Boolean;
    IsOK2 : Boolean;
begin
  cds1      := Nil;
  cds2      := Nil; 
 try
    cds1      := TClientDataSet.Create(nil);
    cds2      := TClientDataSet.Create(nil);    
    ///////////////////////////////////////////////////////////////////////
    ///      DO WHAT NEEDS TO BE DONE
    ///////////////////////////////////////////////////////////////////////
  finally
    IsOk2 := SafeFreeAndNil(cds2);    // an error in freeing cds2 won't stop execution
    IsOK1 := SafeFreeAndNil(Cds1);
    if not(IsOk1 and IsOk2) then
      raise EWhatever....
  end;
end; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-10T10:05:33.483

[关于构造函数和析构函数中的异常](http://codegearguru.com/video/030/TSuicide.html)有一个很好的视频

它展示了一些很好的例子，例如：

```
var cds1  : TClientDataSet;
    cds2  : TClientDataSet;
begin
  cds1      := Nil;
  cds2      := Nil; 
 try
    cds1      := TClientDataSet.Create(nil);
    cds2      := TClientDataSet.Create(nil);    
    ///////////////////////////////////////////////////////////////////////
    ///      DO WHAT NEEDS TO BE DONE
    ///////////////////////////////////////////////////////////////////////
  finally
    freeandnil(cds2);    //// what has if there in an error in the destructor of cds2
    freeandnil(Cds1);
  end;
end; 
```

如果 cds2 的析构函数出错了怎么办

**Cds1 不会被破坏**

编辑

另一个很好的资源是：

Jim McKeeth 关于代码范围 III 中[延迟异常处理](http://cc.codegear.com/item/26436)的精彩视频，他谈到了在 finally 块中处理异常的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T18:54:00.137

@mghie：Delphi 有堆栈分配的对象：

```
type
  TMyObject = object
  private
    FSomeField: PInteger;
  public
    constructor Init;
    destructor Done; override;
  end;

constructor TMyObject.Init;
begin
  inherited Init;
  New(FSomeField);
end;

destructor TMyObject.Done;
begin
  Dispose(FSomeField);
  inherited Done;
end;

var
  MyObject: TMyObject;

begin
  MyObject.Init;
  /// ...
end; 
```

不幸的是，如上例所示： 堆栈分配的对象并不能防止内存泄漏。

所以这仍然需要像这样调用析构函数：

```
var
  MyObject: TMyObject;

begin
  MyObject.Init;
  try
    /// ...
  finally
    MyObject.Done;
  end;
end; 
```

好的，我承认，这几乎是题外话，但我认为在这种情况下它可能会很有趣，因为堆栈分配的对象被提到作为一种解决方案（如果没有自动析构函数调用，它们就不是）。

# c# - 在同一时间和同一天优雅地处理预订

> ID：398139
> 
> 赞同：2
> 
> 时间：2008-12-29T17:18:18.347
> 
> 标签：c#, asp.net, sql

让我们想象一下我有与这里相同的数据库架构：[http ://www.databaseanswers.org/data_models/driving_school/index.htm](http://www.databaseanswers.org/data_models/driving_school/index.htm)

如果客户进行了预订，并且与另一个预订在同一天和同一时间，我该如何优雅地处理这个业务问题？此外，如果同时进行两次预订怎么办？这是与多线程一样的并发问题。

我正在为这个项目使用 Sqlite、C# 和 ASP.NET。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T17:39:54.277

这就是交易的用途。您的预订代码应开始交易，使用 SELECT 确认时间可用，如果可用，则插入或更新数据库以进行预订，最后提交交易。

如果时间不可用，要么不插入或更新数据库以进行预订，要么回滚事务。

# ruby-on-rails - 如何获得 DateTime 持续时间？

> ID：398144
> 
> 赞同：6
> 
> 时间：2008-12-29T17:20:11.307
> 
> 标签：ruby-on-rails, ruby

我很困惑如何做到这一点。

我需要获取一个 datetime 对象并以小时、天等为单位获取当前时间的持续时间。

谢谢你。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T17:27:50.933

以秒为单位获取持续时间很容易：

```
>> foo = Time.new
=> Mon Dec 29 18:23:51 +0100 2008
>> bar = Time.new
=> Mon Dec 29 18:23:56 +0100 2008
>> print bar - foo
5.104063=> nil 
```

所以，五秒多一点。

但是要以更人性化的形式呈现它，您需要第三方添加，如[`time_period_to_s`](http://www.postal-code.com/binarycode/2007/04/04/english-friendly-timespan/)，或`Duration`包。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T07:09:20.197

[`distance_of_time_in_words`](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#M001475 "distance_of_time_in_words")将为您提供两个时间/日期对象之间时间的字符串表示形式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-29T17:24:39.240

您需要[Time](http://www.ruby-doc.org/core/classes/Time.html)类而不是 DateTime。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-30T03:04:33.483

如果您使用的是 rails，那么[distance_of_time_in_words_to_now](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#M001477)可能就是您要找的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-15T06:29:37.650

我只想分享我的代码以获得更多可读的持续时间。

而不是[`distance_of_time_in_words`](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#M001475)像@Ryan Bigg 建议的那样使用，我更喜欢@Sören Kuklau 的建议。

但为了显示对人类友好的形式，我做了这样的事情。

```
def get_duration opts
    from = Time.parse opts[:from]
    to   = Time.parse opts[:to]

    duration      = to - from
    durationLabel = []
    separator     = " "

    hours = (duration / 3600).floor
    restDuration = duration%3600

    durationLabel << "#{hours}h" if hours > 0

    return durationLabel.join separator if restDuration.floor == 0

    minutes = (restDuration / 60).floor
    restDuration = duration%60

    durationLabel << "#{minutes}m" if minutes > 0

    return durationLabel.join separator if restDuration.floor == 0

    seconds = restDuration.floor

    durationLabel << "#{seconds}s" if seconds > 0

    durationLabel.join separator
end

get_duration from: "2018-03-15 11:50:43", to: "2018-03-15 11:51:50"
# return 1m 7s 
```

它将计算小时、分钟和秒。我们将得到一些更人性化但准确的东西，而不是像这样的模糊响应**`about 1 minutes`**或硬响应，直到第二个像**`67.0`****`1m 7s`**

# google-maps - 寻找 google-analytics 风格的地图创建应用程序或 api

> ID：398153
> 
> 赞同：2
> 
> 时间：2008-12-29T17:23:21.347
> 
> 标签：google-maps, maps, ip-geolocation, statistics

我正在寻找基于访问者 IP 地址创建应用程序或 api 的谷歌分析式地图，有什么建议吗？

谢谢，

尼佩雷斯

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-29T23:06:28.877

您看过[Google 可视化 API](http://code.google.com/apis/visualization/)吗？具体来说，[强度图](http://code.google.com/apis/visualization/documentation/gallery/intensitymap.html)和[地理](http://code.google.com/apis/visualization/documentation/gallery/geomap.html)图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:00:28.287

我知道有一些这样的服务可用。尝试用谷歌搜索“ip 访问者地理位置”和类似的组合。

一个看起来很有趣的是[hostip.info](http://www.hostip.info/)，因为他们有一个社区维护的 IP 地理定位数据库，如果您想滚动自己的地图，可以完整下载该数据库。

他们还提供一项[服务](http://geostats.hostip.info/)，如果您不想自己做这项工作，您可以上传日志以生成小地图图像。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-19T13:52:26.133

我们最近为我们的[EmbeddedAnalytics](http://www.embeddedanalytics.com)服务添加了一个功能。这一切都基于您的 Google Analytics 数据，并利用 Google 的 Exp API 获取数据。

# django - 订购 admin.ModelAdmin 对象

> ID：398163
> 
> 赞同：45
> 
> 时间：2008-12-29T17:25:50.033
> 
> 标签：django, django-admin

假设我的披萨应用程序带有 Topping 和 Pizza 类，它们在 Django Admin 中显示如下：

```
PizzaApp
-
Toppings      >>>>>>>>>>      Add / Change

Pizzas        >>>>>>>>>>      Add / Change 
```

但我希望他们是这样的：

```
PizzaApp
-
Pizzas        >>>>>>>>>>      Add / Change

Toppings      >>>>>>>>>>      Add / Change 
```

如何在我的 admin.py 中配置它？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2011-03-17T21:56:30.237

您可以尝试的解决方法是调整您的 models.py，如下所示：

```
class Topping(models.Model):
    .
    .
    .
    class Meta:
        verbose_name_plural = "2\. Toppings"

class Pizza(models.Model):
    .
    .
    .
    class Meta:
        verbose_name_plural = "1\. Pizzas" 
```

不确定它是否违反 django 的最佳实践，但它可以工作（用 django trunk 测试）。

祝你好运！

PS：对不起，如果这个答案发布得太晚了，但它可以帮助其他人在未来的类似情况下。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-10-19T18:33:53.173

如果你想在 10 秒内解决这个问题，只需在 verbose_name_plural 中使用空格，例如：

```
class Topping(models.Model):
    class Meta:
        verbose_name_plural = "  Toppings" # 2 spaces

class Pizza(models.Model):
    class Meta:
        verbose_name_plural = " Pizzas" # 1 space 
```

当然，它并不优雅，但在我们得到更好的解决方案之前可能会工作一段时间。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-03-08T20:38:20.563

[多亏了这个Django 片段](http://djangosnippets.org/snippets/1939/#comments)，我最终设法做到了，您只需要注意`ADMIN_REORDER`设置：

```
ADMIN_REORDER = (
    ('app1', ('App1Model1', 'App1Model2', 'App1Model3')),
    ('app2', ('App2Model1', 'App2Model2')),
) 
```

`app1`不得以项目名称为前缀，即使用`app1`而不是`mysite.app1`.

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2015-09-14T19:56:47.870

现在有一个不错的 Django 包：

[https://pypi.python.org/pypi/django-modeladmin-reorder](https://pypi.python.org/pypi/django-modeladmin-reorder)

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2018-06-19T18:10:25.963

2018 年 6 月的答复

这个答案类似于[Vasil 的想法](https://stackoverflow.com/a/1140868/9963540)

我试图解决类似的问题，然后我看到了这样[的片段](https://books.agiliq.com/projects/django-admin-cookbook/en/latest/set_ordering.html)。

我根据这个剪辑做了一些修改。代码如下。

```
# myproject/setting.py
...
# set my ordering list
ADMIN_ORDERING = [
    ('pizza_app', [
        'Pizzas',
        'Toppings'
    ]),
]
# Creating a sort function
def get_app_list(self, request):
    app_dict = self._build_app_dict(request)
    for app_name, object_list in ADMIN_ORDERING:
        app = app_dict[app_name]
        app['models'].sort(key=lambda x: object_list.index(x['object_name']))
        yield app

# Covering django.contrib.admin.AdminSite.get_app_list
from django.contrib import admin

admin.AdminSite.get_app_list = get_app_list
... 
```

**请注意，此排序功能中使用的排序列表包含系统中所有应用程序及其模块的排序。如果不需要，请根据自己的需要设计排序功能。**

它在 Django 2.0 上运行良好

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-12-29T18:41:12.610

[这实际上是在编写你的第一个 Django 应用程序](https://docs.djangoproject.com/en/3.0/intro/tutorial07/)的最底部，第 7 部分。

这是相关部分：

> **自定义管理索引页面**
> 
> 同样，您可能想要自定义 Django 管理索引页面的外观。
> 
> 默认情况下，它会按字母顺序显示 INSTALLED_APPS 中已向管理应用程序注册的所有应用程序。您可能希望对布局进行重大更改。毕竟 index 可能是 admin 最重要的页面，应该很容易使用。
> 
> 要自定义的模板是 admin/index.html。（对上一节中的 admin/base_site.html 执行相同操作——将其从默认目录复制到您的自定义模板目录。）编辑该文件，您将看到它使用了一个名为 app_list 的模板变量。该变量包含每个已安装的 Django 应用程序。您可以使用您认为最好的任何方式硬编码指向特定于对象的管理页面的链接，而不是使用它。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-05-15T02:37:34.233

这是 Emmanuel 使用的代码片段，针对 Django 1.8 进行了更新：

在模板标签/admin_reorder.py 中：

```
from django import template
from django.conf import settings
from collections import OrderedDict

register = template.Library()

# from http://www.djangosnippets.org/snippets/1937/
def register_render_tag(renderer):
    """
    Decorator that creates a template tag using the given renderer as the 
    render function for the template tag node - the render function takes two 
    arguments - the template context and the tag token
    """
    def tag(parser, token):
        class TagNode(template.Node):
            def render(self, context):
                return renderer(context, token)
        return TagNode()
    for copy_attr in ("__dict__", "__doc__", "__name__"):
        setattr(tag, copy_attr, getattr(renderer, copy_attr))
    return register.tag(tag)

@register_render_tag
def admin_reorder(context, token):
    """
    Called in admin/base_site.html template override and applies custom ordering
    of apps/models defined by settings.ADMIN_REORDER
    """
    # sort key function - use index of item in order if exists, otherwise item
    sort = lambda order, item: (order.index(item), "") if item in order else (
        len(order), item)
    if "app_list" in context:
        # sort the app list
        order = OrderedDict(settings.ADMIN_REORDER)
        context["app_list"].sort(key=lambda app: sort(order.keys(),
            app["app_url"].strip("/").split("/")[-1]))
        for i, app in enumerate(context["app_list"]):
            # sort the model list for each app
            app_name = app["app_url"].strip("/").split("/")[-1]
            if not app_name:
                app_name = app["name"].lower()
            model_order = [m.lower() for m in order.get(app_name, [])]
            context["app_list"][i]["models"].sort(key=lambda model:
            sort(model_order, model["admin_url"].strip("/").split("/")[-1]))
    return "" 
```

在 settings.py 中：

```
ADMIN_REORDER = (
    ('app1', ('App1Model1', 'App1Model2', 'App1Model3')),
    ('app2', ('App2Model1', 'App2Model2')),
) 
```

（在此处插入您自己的应用程序名称。管理员会将缺少的应用程序或模型放在列表的末尾，只要您在每个应用程序中至少列出两个模型。）

在您的 base_site.html 副本中：

```
{% extends "admin/base.html" %}
{% load i18n admin_reorder %}

{% block title %}{{ title }} | {% trans 'Django site admin' %}{% endblock %}

{% block branding %}
{% admin_reorder %}
<h1 id="site-name">{% trans 'Django administration' %}</h1>
{% endblock %}

{% block nav-global %}{% endblock %} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-01-18T14:04:15.630

还可以使用一个名为**“Django Admin Index Custom App & Model Ordering”**的小代码。该片段只需 3 次简单的编辑即可解决问题。

在这里看看细节。 [http://djangosnippets.org/snippets/2613/](http://djangosnippets.org/snippets/2613/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-29T18:40:15.810

我将它添加到 Django 的跟踪中：

[http://code.djangoproject.com/ticket/9928](http://code.djangoproject.com/ticket/9928)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-11-06T13:12:55.640

如果您使用[Suit](http://djangosuit.com) for the AdminSite，您可以使用[menu tag](http://django-suit.readthedocs.org/en/develop/configuration.html#id1)进行菜单自定义。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-12-04T19:35:15.540

我正在寻找一个简单的解决方案，我可以在管理面板中按应用程序的名称对应用程序进行排序。我想出了以下模板标签：

```
from django import template
from django.conf import settings
register = template.Library()

@register.filter
def sort_apps(apps):
    apps.sort(
        key = lambda x:
        settings.APP_ORDER.index(x['app_label'])
        if x['app_label'] in settings.APP_ORDER
        else len(apps)
    )
    print [x['app_label'] for x in apps]
    return apps 
```

然后，只需覆盖`templates/admin/index.html`并添加该模板标签：

```
{% extends "admin/index.html" %}
{% block content %}
{% load i18n static sort_apps %}
<div id="content-main">

{% if app_list %}
    {% for app in app_list|sort_apps %}
        <div class="app-{{ app.app_label }} module">
        <table>
        <caption>
            <a href="{{ app.app_url }}" class="section" title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">{{ app.name }}</a>
        </caption>
        {% for model in app.models %}
            <tr class="model-{{ model.object_name|lower }}">
            {% if model.admin_url %}
                <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
            {% else %}
                <th scope="row">{{ model.name }}</th>
            {% endif %}

            {% if model.add_url %}
                <td><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
            {% else %}
                <td>&nbsp;</td>
            {% endif %}

            {% if model.admin_url %}
                <td><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></td>
            {% else %}
                <td>&nbsp;</td>
            {% endif %}
            </tr>
        {% endfor %}
        </table>
        </div>
    {% endfor %}
{% else %}
    <p>{% trans "You don't have permission to edit anything." %}</p>
{% endif %}
</div>
{% endblock %} 
```

然后自定义`APP_ORDER`settings.py中的：

```
APP_ORDER = [
    'app1',
    'app2',
    # and so on...
] 
```

它在 Django 1.10 上运行良好

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-08-23T16:50:11.333

```
ADMIN_ORDERING = {
    "PizzaApp": [
        "Pizzas",
        "Toppings",
    ],
}

def get_app_list(self, request):
    app_dict = self._build_app_dict(request)
    for app_name, object_list in app_dict.items():
        if app_name in ADMIN_ORDERING:
            app = app_dict[app_name]
            app["models"].sort(
                key=lambda x: ADMIN_ORDERING[app_name].index(x["object_name"])
            )
            app_dict[app_name]
            yield app
        else:
            yield app_dict[app_name]

admin.AdminSite.get_app_list = get_app_list 
```

这个解决方案对我有用，修改了林伟雄的那个。

您可以保留默认的身份验证顺序并指定您自己的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-06-09T17:14:00.103

这是一个为您提供更多灵活性的版本，即：

*   您可以部分定义应用程序排序，其余部分由 Django 添加到列表中
*   您可以指定模块的顺序，或避免定义它，而是使用 '*'
*   您定义的应用程序顺序将首先出现，然后是所有其余应用程序附加在它之后
*   要检查您的应用程序的名称，请查看应用`apps.py`程序目录中的文件并检查名称属性，`class Config(AppConfi):`或者如果不存在，请使用项目中应用程序的目录名称。

在文件中的某处添加此代码`settings.py`：

```
# ======[Setting the order in which the apps/modules show up listed on Admin]========
# set my ordering list
ADMIN_ORDERING = [
    ('crm', '*'),
    ('property', '*'),
]

# Creating a sort function
def get_app_list(self, request):
    """
    Returns a sorted list of all the installed apps that have been
    registered in this site.

    Allows for:
        ADMIN_ORDERING = [
            ('app_1', [
                'module_1',
                'module_2'
            ]),
            ('app_2', '*'),
        ]
    """

    app_dict = self._build_app_dict(request)

    # Let's start by sorting the apps alphabetically on a list:
    app_list = sorted(app_dict.values(), key=lambda x: x['name'].lower())

    # Sorting the models alphabetically within each app.
    for app in app_list:
        if app['app_label'] in [el[0] for el in ADMIN_ORDERING]:
            app_list.remove(app)
        else:
            app['models'].sort(key=lambda x: x['name'])

    # Now we order the app list in our defined way in ADMIN_ORDERING (which could be a subset of all apps).
    my_ordered_apps = []
    if app_dict:
        for app_name, object_list in ADMIN_ORDERING:
            app = app_dict[app_name]
            if object_list == '*':
                app['models'].sort(key=lambda x: x['name'])
            else:
                app['models'].sort(key=lambda x: object_list.index(x['object_name']))
            my_ordered_apps.append(app)

        # Now we combine and arrange the 2 lists together
        my_ordered_apps.extend(app_list)

    return my_ordered_apps

# Covering django.contrib.admin.AdminSite.get_app_list
from django.contrib import admin
admin.AdminSite.get_app_list = get_app_list
# ========================================= 
```

这无非就是覆盖了Django在文件python2.7/site-packages/django/contrib/admin/sites.py上定义的函数。

该`get_app_list`方法`class AdminSite(object):`生成项目中所有应用程序的数据结构，包括 Django 的身份验证应用程序，例如：

```
[
  {
    "app_label": "auth",
    "app_url": "/admin/auth/",
    "has_module_perms": "True",
    "models": [
      {
        "add_url": "/admin/auth/group/add/",
        "admin_url": "/admin/auth/group/",
        "name": "<django.utils.functional.__proxy__ object at 0x11057f990>",
        "object_name": "Group",
        "perms": {
          "add": "True",
          "change": "True",
          "delete": "True"
        }
      },
      {
        "add_url": "/admin/auth/user/add/",
        "admin_url": "/admin/auth/user/",
        "name": "<django.utils.functional.__proxy__ object at 0x11057f710>",
        "object_name": "User",
        "perms": {
          "add": "True",
          "change": "True",
          "delete": "True"
        }
      }
    ],
    "name": "<django.utils.functional.__proxy__ object at 0x108b81850>"
  },
  {
    "app_label": "reservations",
    "app_url": "/admin/reservations/",
    "has_module_perms": "True",
    "models": [
      {
        "add_url": "/admin/reservations/reservationrule/add/",
        "admin_url": "/admin/reservations/reservationrule/",
        "name": "<django.utils.functional.__proxy__ object at 0x11057f6d0>",
        "object_name": "ReservationRule",
        "perms": {
          "add": "True",
          "change": "True",
          "delete": "True"
        }
      }
    ],
    "name": "Availability"
  },
  {
    "app_label": "blog",
    "app_url": "/admin/blog/",
    "has_module_perms": "True",
    "models": [
      {
        "add_url": "/admin/blog/category/add/",
        "admin_url": "/admin/blog/category/",
        "name": "Categories",
        "object_name": "Category",
        "perms": {
          "add": "True",
          "change": "True",
          "delete": "True"
        }
      },
      {
        "add_url": "/admin/blog/post/add/",
        "admin_url": "/admin/blog/post/",
        "name": "<django.utils.functional.__proxy__ object at 0x11057f110>",
        "object_name": "Post",
        "perms": {
          "add": "True",
          "change": "True",
          "delete": "True"
        }
      },
      {
        "add_url": "/admin/blog/tag/add/",
        "admin_url": "/admin/blog/tag/",
        "name": "<django.utils.functional.__proxy__ object at 0x11057f390>",
        "object_name": "Tag",
        "perms": {
          "add": "True",
          "change": "True",
          "delete": "True"
        }
      }
    ],
    "name": "Blog"
  },
(...)
] 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-29T18:17:19.880

这只是黑暗中的一次野刺，但是您调用 admin.site.register(< Model class >, < ModelAdmin class >) 的顺序是否有可能确定显示顺序？实际上，我怀疑这是否可行，因为我相信 Django 维护了一个作为标准 Python 字典实现的 Model -> ModelAdmin 对象的注册表，它不维护迭代顺序。

如果这不符合您的要求，您可以随时使用 django/contrib/admin 中的源代码。如果您需要维护迭代顺序，您可以将 AdminSite 类（在 admin/sites.py 中）中的 _registry 对象替换为维护键插入顺序的 UserDict 或 DictMixin。（但请对这个建议持保留态度，因为我自己从未做过这些改变，我只是对 Django 如何迭代 ModelAdmin 对象的集合进行有根据的猜测。我确实认为 django/contrib但是，/admin/sites.py 是查找此代码的地方，而 AdminSite 类以及 register() 和 index() 方法尤其是您想要的。）

显然，这里最好的事情是您可以在自己的 /admin.py 模块中指定一个简单的选项。我相信这就是您希望收到的答案。不过，我不确定这些选项是否存在。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-07-16T23:48:17.580

我的解决方案是创建 django.contrib.admin.sites.AdminSite 和 django.contrib.admin.options.ModelAdmin 的子类。

我这样做是为了为每个应用程序显示一个更具描述性的标题，并为每个应用程序中模型的外观排序。因此，我的 settings.py 中有一个 dict，它将 app_labels 映射到描述性名称以及它们应该出现的顺序，模型按我在管理站点注册时在每个 ModelAdmin 中提供的序数字段排序。

尽管文档中鼓励创建自己的 AdminSite 和 ModelAdmin 子类，但我的解决方案最终看起来像一个丑陋的黑客。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-07-11T12:17:49.823

将`lib\site-packages\django\contrib\admin\templates\admin\index.html`模板复制到`project1\templates\admin\`目录，其中`project1`是您的项目的名称。

在复制的文件中，即`project1\templates\admin\index.html`替换行：

```
{% block content %} 
...
{% endblock %} 
```

和：

```
{% block content %}
<div id="content-main">

{% if app_list %}
    <div class="module">
        <table>
            <caption>App 1</caption>
            <tr>  <th>  <a href="/admin/app1/model1/">Model 1</a>  </th>  <td>Description of model 1</td>  </tr>
            <tr>  <th>  <a href="/admin/app1/model2/">Model 2</a>  </th>  <td>Description of model 1</td>  </tr>
            <tr>  <th>  <a href="..."                >...</a>      </th>  <td>...</td>                     </tr>
        </table>
    </div>

    <div class="module">
        <table>
            <caption>Authentication and authorization</caption>
            <tr>  <th>  <a href="/admin/auth/user/"  >Users</a>    </th>  <td>List of users</td>           </tr>
            <tr>  <th>  <a href="/admin/auth/group/" >Groups</a>   </th>  <td>List of users' groups</td>   </tr>
        </table>
    </div>
{% else %}
    <p>{% trans "You don't have permission to view or edit anything." %}</p>
{% endif %}

</div>
{% endblock %} 
```

在哪里：

*   `app1` 是带有模型的应用程序的名称，
*   `modeli` 是 中第 i 个模型的名称`app1`。

如果您在项目中定义了多个具有模型的应用程序，则只需在上述`index.html`文件中添加另一个表。

因为我们改变了模板，所以我们可以自由地改变它的 HTML 代码。例如，我们可以添加对模型的描述，如上所示。您还可以恢复*添加*和*更改*链接——我删除了它们，因为我认为它们是多余的。

答案是来自[Dave Kasper 的答案](https://stackoverflow.com/a/398301)的实际演示。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-11-28T08:13:27.170

custom_admin.py

```
from django.contrib.admin import AdminSite

class CustomAdminSite(AdminSite):
    def get_urls(self):
        urls = super(MyAdminSite, self).get_urls()
        return urls

    def get_app_list(self, request):
        app_dict = self._build_app_dict(request)
        ordered_app_list = []

        if app_dict:
            # TODO: change this dict
            admin_ordering = {
                'app1': ('Model1', 'Model2'),
                'app2': ('Model7', 'Model4'),
                'app3': ('Model3',),
            }

            ordered_app_list = []
            for app_key in admin_ordering:
                app = app_dict[app_key]
                app_ordered_models = []
                for model_name in admin_ordering[app_key]:
                    for model in app_dict[app_key]['models']:
                        if model['object_name'] == model_name:
                            app_ordered_models.append(model)
                            break

                app['models'] = app_ordered_models
                ordered_app_list.append(app)

        return ordered_app_list 
```

admin_site = CustomAdminSite()

网址.py

```
from custom_admin import admin_site

urlpatterns = [
    path('admin/', admin_site.urls),
] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-05-05T19:42:56.180

将以下代码添加到您的 settings.py 中：

```
def get_app_list(self, request):
    """
    Return a sorted list of all the installed apps that have been
    registered on this site.
    """
    ordering = {
        # for superuser
        'Group': 1,
        'User': 2,

        # fist app
        'TopMessage': 101,
        'Slider': 102,
        'ProductCategory': 103,
        'Product': 104,
        'ProductPicture': 105,

        # 2nd app
        'ProductReview': 201,
        'Promotion': 202,
        'BestSeller': 203,
    }
    app_dict = self._build_app_dict(request)
    app_list = sorted(app_dict.values(), key=lambda x: x['name'].lower())

    for app in app_list:
        app['models'].sort(key=lambda x: ordering[x['object_name']])

    return app_list

admin.AdminSite.get_app_list = get_app_list 
```

并更改排序字典以匹配您的应用程序和模型。就是这样。

我的解决方案的好处是，如果用户是超级用户，它将显示“auth”模型。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-07-20T05:43:46.127

默认情况下，Django 按字母顺序对 admin 中的模型进行排序。所以Event admin中模型的顺序是Epic、EventHero、EventVillain、Event

相反，您希望订单是

*   EventHero、EventVillain、Epic 然后是事件。

用于呈现管理索引页面的模板是`admin/index.html`，视图功能是`ModelAdmin.index`.

```
def index(self, request, extra_context=None):
"""
Display the main admin index page, which lists all of the installed
apps that have been registered in this site.
"""
app_list = self.get_app_list(request)
context = {
    **self.each_context(request),
    'title': self.index_title,
    'app_list': app_list,
    **(extra_context or {}),
}

request.current_app = self.name

return TemplateResponse(request, self.index_template or
    'admin/index.html', context) 
```

方法`get_app_list`，设置模型的顺序。：

```
def get_app_list(self, request):
"""
Return a sorted list of all the installed apps that have been
registered in this site.
"""
app_dict = self._build_app_dict(request)

# Sort the apps alphabetically.
app_list = sorted(app_dict.values(), key=lambda x: x['name'].lower())

# Sort the models alphabetically within each app.
for app in app_list:
    app['models'].sort(key=lambda x: x['name'])

return app_list 
```

因此，要将我们覆盖的顺序设置`get_app_list`为：

```
class EventAdminSite(AdminSite):
def get_app_list(self, request):
    """
    Return a sorted list of all the installed apps that have been
    registered in this site.
    """
    ordering = {
        "Event heros": 1,
        "Event villains": 2,
        "Epics": 3,
        "Events": 4
    }
    app_dict = self._build_app_dict(request)
    # a.sort(key=lambda x: b.index(x[0]))
    # Sort the apps alphabetically.
    app_list = sorted(app_dict.values(), key=lambda x: x['name'].lower())

    # Sort the models alphabetically within each app.
    for app in app_list:
        app['models'].sort(key=lambda x: ordering[x['name']])

    return app_list 
```

代码`app['models'].sort(key=lambda x: ordering[x['name']])`设置了固定的顺序。您的应用现在看起来像这样。

[![在此处输入图像描述](https://i.stack.imgur.com/seA50.png)](https://i.stack.imgur.com/seA50.png)

[检查文档](https://books.agiliq.com/projects/django-admin-cookbook/en/latest/set_ordering.html)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-07-20T06:23:20.150

在`Settings.py`文件设置中，应用程序/模块显示在管理员上的顺序

设置我的订购单

```
ADMIN_ORDERING = [
    ('Your_App1', '*'),
    ('Your_App2', '*'),
] 
```

在 ADMIN_ORDERING 下创建排序函数

```
def get_app_list(self, request):
    """
    You Can Set Manually Ordering For Your Apps And Models   

        ADMIN_ORDERING = [
            ('Your_App1', [
                'module_1',
                'module_2'
            ]),
            ('Your_App2', '*'),
        ]
    """

    app_dict = self._build_app_dict(request)

    # Let's start by sorting the apps alphabetically on a list:
    app_list = sorted(app_dict.values(), key=lambda x: x['name'].lower())

    # Sorting the models alphabetically within each app.
    for app in app_list:
        if app['app_label'] in [el[0] for el in ADMIN_ORDERING]:
            app_list.remove(app)
        else:
            app['models'].sort(key=lambda x: x['name'])

    # Now we order the app list in our defined way in ADMIN_ORDERING (which could be a subset of all apps).
    my_ordered_apps = []
    if app_dict:
        for app_name, object_list in ADMIN_ORDERING:
            app = app_dict[app_name]
            if object_list == '*':
                app['models'].sort(key=lambda x: x['name'])
            else:
                app['models'].sort(key=lambda x: object_list.index(x['object_name']))
            my_ordered_apps.append(app)

        # Now we combine and arrange the 2 lists together
        my_ordered_apps.extend(app_list)

    return my_ordered_apps

# Covering django.contrib.admin.AdminSite.get_app_list
from django.contrib import admin
admin.AdminSite.get_app_list = get_app_list 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-11-25T07:55:22.023

一个非常简单且自包含的方法可以使用装饰器模式以这种方式来使用您的应用程序和模块：

```
# admin.py

from django.contrib import admin

def app_resort(func):                                                                                            
    def inner(*args, **kwargs):                                                                                            
        app_list = func(*args, **kwargs)
        # Useful to discover your app and module list:
        #import pprint                                                                                          
        #pprint.pprint(app_list)

        app_sort_key = 'name'
        app_ordering = {
            "APP_NAME1": 1,
            "APP_NAME2": 2,
            "APP_NAME3": 3,
        }

        resorted_app_list = sorted(app_list, key=lambda x: app_ordering[x[app_sort_key]] if x[app_sort_key] in app_ordering else 1000)

        model_sort_key = 'object_name'
        model_ordering = {
            "Model1": 1,
            "Model2": 2,
            "Model3": 3,
            "Model14": 4,
        }
        for app in resorted_app_list:
            app['models'].sort(key=lambda x: model_ordering[x[model_sort_key]] if x[model_sort_key] in model_ordering else 1000)
        return resorted_app_list
    return inner                                                                                            

admin.site.get_app_list = app_resort(admin.site.get_app_list) 
```

此代码仅将排序字典中定义的键排序在顶部，而将所有其他键留在底部。该方法很干净，但它需要在之前执行 get_app_list ......当性能很重要并且你有一个很大的 app_list 时，这可能不是一个好主意。

# cocoa - 在应用程序加载之前将数据加载到 Cocoa 视图中

> ID：398166
> 
> 赞同：3
> 
> 时间：2008-12-29T17:28:00.247
> 
> 标签：cocoa, macos

我想在应用程序启动之前将一些数据从 mysql 加载到我的可可应用程序视图中。

我确信这应该发生在控制器中，以便它可以将所需的数据发送到视图。

我正在寻找一种用于此类事情的方法或常用技术。

非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T17:30:02.520

听起来您正在寻找 awakeFromNib 函数。

[http://www.cocoadev.com/index.pl?AwakeFromNib](http://www.cocoadev.com/index.pl?AwakeFromNib)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T18:25:33.657

您可以使用[- applicationDidFinishLaunching:](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/doc/uid/20000012-CACBHCEH)或[- applicationWillFinishLaunching:](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/doc/uid/20000012-CACBHCEH)委托消息，通过在您的应用程序委托/控制器中实现其中一个消息，并在那里进行任何您想要的初始化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T15:20:11.707

在从 nib 加载对象之前和之后，Cocoa 为您提供了许多执行任务的地方，但是仔细阅读文档以确保事情按照您期望的顺序发生是很重要的。在开发 Cocoa 应用程序时，我通常使用以下策略：

*   在适当的情况下，我实现了 +(void)initialize 方法，该方法在创建类的任何实例之前调用。例如，我可能会在此处设置应用程序的默认首选项。
*   在我的应用程序控制器（应用程序委托）中，我实现了 applicationDidFinishLaunching: 委托方法来加载我的数据文件。如果一切正常，我将创建窗口控制器并显示我想在启动时显示的任何窗口。
*   在窗口/视图控制器中，我重写 windowDidLoad: 或 loadView 以执行涉及从 nib 加载的对象的任务。如果我需要创建任何不涉及 nib 的实例变量，我也会覆盖 init 方法并在那里执行此操作。
*   如果在从 nib 加载视图对象后需要在视图对象中执行任何操作，我将覆盖 awakeFromNib。

# wix - DB Pro（数据老兄）和 Wix3 SqlExtension

> ID：398169
> 
> 赞同：1
> 
> 时间：2008-12-29T17:28:50.103
> 
> 标签：wix, sqlcmd, datadude

我正在尝试在安装过程中使用 Wix 创建数据库。我使用 Db Pro Visual Studio SKU（有时称为 Data Dude）设置了我的数据库。但是，输出似乎只能由 sqlcmd.exe 使用，因为它在其中使用特定的语法（变量引用，如`:setenv`and `$(FOO)`）。

我正在尝试使用显然没有使用 sqlcmd.exe 的 wix sqlextension（我还没有调查它正在使用什么数据访问技术。

有谁知道是否有一种方法可以在 wix sqlextension 中本地使用 data dude 的输出，或者是否有一些东西可以获取 sqlcmd 输出并将其转换为针对 sql server 执行所需的运行时 sql？

请注意，最终目标是将 wix 完全集成到我们的构建系统中，因此我正在寻找一种自动化方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-03T20:27:13.350

如果您使用 Visual Studio DBPro 创建了包，则最好使用 VSDBCMD.exe 进行 DB 部署。这样做的好处是 VSDBCMD.exe 始终计算出目标与源之间的差异，并创建一个可以从同一命令行运行的 delta 脚本。您只需要提供 /action:Deploy。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-24T18:57:32.263

有一篇博客文章介绍了从 WiX 3 调用 sqlcmd.exe 实用程序，网址为[http://neilsleightholm.blogspot.com/2008/08/executing-sqlcmd-from-wix.html](http://neilsleightholm.blogspot.com/2008/08/executing-sqlcmd-from-wix.html)

# .net - 在已编译的 .NET 程序集中更改程序集版本

> ID：398170
> 
> 赞同：55
> 
> 时间：2008-12-29T17:29:24.610
> 
> 标签：.net

简单的问题...有没有办法更改已编译的 .NET 程序集的程序集版本？

我实际上可以更改程序集文件版本。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-07T23:21:00.210

您可以使用[ILMerge](https://github.com/dotnet/ILMerge)：

```
ILMerge.exe Foo.dll /ver:1.2.3.4 /out:Foo2.dll
```

这样做的一个正当理由是在您发现重大更改的构建中增加程序集版本（例如使用 NDepend）。这样，如果没有重大更改，程序集版本保持不变，您可以轻松修补已发布的构建。

我们总是增加文件版本，这反映了内部版本号。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-12-02T14:59:09.517

老话题，但这是我的 5 毛钱......

1.  拆卸

    > **ildasm my.exe /output:my.il /metadata**

2.  编辑**my.il**以更改版本信息。有几个地方可以研究：

    *   主要：次要：修订：构建 - 通常出现一次
    *   major.minor.revision.build - 多次出现。该字符串位于实际行之后的注释部分中。版本是字节数组中的十六进制值。例子：

`.custom instance void [mscorlib]System.Reflection.AssemblyFileVersionAttribute::.ctor(string) = ( 01 00 07 **35** 2E **31** 2E **33** 2E **30** 00 00 ) // ...5.1.3.0..`

3.  编辑**my.res**以更改版本信息。双击并使用 Visual Studio 进行编辑。非常简单的程序。

4.  集合

    > **ilasm my.il /res:my.res**

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-29T17:41:28.410

你为什么要这样做？如果它是为了让另一个应用程序可以使用它，您可能希望改为查看[程序集绑定重定向](http://msdn.microsoft.com/en-us/library/2fc472t2.aspx)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-30T14:15:49.307

听起来您的过程很繁重，因为您必须更新多个 AssemblyInfo 文件。您是否考虑过在项目之间共享相同的 AssemblyInfo 文件？ [Derik Whittaker](http://devlicio.us/blogs/derik_whittaker/archive/2008/04/15/how-to-share-configuration-files-between-projects.aspx)给出了一个很好的例子来说明如何做到这一点。

一旦你有了一个文件，你就可以通过构建过程使用[MSBuild](http://blogs.msdn.com/msbuild/archive/2005/11/11/how-to-update-assembly-version-numbers-with-msbuild.aspx)或[NAnt](http://bloggingabout.net/blogs/joshua/archive/2005/07/26/8675.aspx)更新你的单个 AssemblyInfo 版本来更进一步。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-10-31T01:05:12.440

如果你有正式的测试和源代码控制，这个过程就变得相当简单。首先要了解谁可以更改版本的不同数字段以及何时更改。.net 程序集有 4 个数字段（即 1.0.0.1）。

第一段包含主要版本号。这是由高层管理人员设置的，表示 UI 或应用程序平台的重大变化。程序集版本和文件版本之间的编号应始终相同。

第二段包含次要版本号，也称为功能版本号。这是由项目管理设置的，表示新功能已添加到应用程序中。程序集版本和文件版本之间的编号应始终相同。

第三部分包含内部版本号。这是由测试组设置的，表示应用程序已准备好部署。它在错误修复发布之前进行了更改。发布新版本时，测试会将第四段重置为 0。这可以是程序集版本和文件版本之间的相同数字，但通常将程序集版本保留为 0，以简化修补现有部署。

第四段包含修订号。每当他们将新代码签入源代码控制时，开发组都会设置此设置。此编号将包含在已编译 DLL 的文件版本中，但不包含在程序集版本中。

我发现这有助于部署人员、测试人员和开发人员跟踪最新版本，而不会互相干扰。不幸的是，我还与使用静态版本控制系统的公司合作过，因此没有人真正知道最新、最好的程序集是什么。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-10-25T19:45:41.177

[此答案](https://stackoverflow.com/a/15244192/24315)中引用的[VerPatch](http://www.codeproject.com/Articles/37133/Simple-Version-Resource-Tool-for-Windows)简单有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-13T15:16:37.887

它奇怪的人错过了[Resource Hacker](http://www.angusj.com/resourcehacker/)。它是专门为破解文件资源而设计的。因此，它还将帮助您编辑程序集信息，包括**File Version**。

```
using System;
using System.Windows.Forms;
using System.Diagnostics;

public class rh
{
    public static void Main()
    {
        Assembly_Changer("file_path.exe");
    }

    private static string rc()
    {
        string FileVersion = "6,8,0,1";
        return "1 VERSIONINFO"
        + "\n FILEVERSION " + FileVersion
        + "\n PRODUCTVERSION 0,0,0,0" 
        + "\n FILEOS 0x4"
        + "\n FILETYPE 0x1"
        + "\n {BLOCK \"StringFileInfo\"{BLOCK \"000004b0\"{}}BLOCK \"VarFileInfo\"{VALUE \"Translation\", 0x0000 0x04B0}}";
    }

    public static void Assembly_Changer(string exe)
    {
        System.IO.File.WriteAllText("details.rc", rc());
        process("reshacker.exe", "-open details.rc -save resources.res -action compile -log NUL");
        process("reshacker.exe", "-open \"" + exe + "\" -resource resources.res -save \"" + exe + "\" -action addoverwrite -mask \"Version info\"");
    }

    public static bool process(string filename, string args)
    {
        using (Process process = new Process())
        {
            process.StartInfo.FileName = filename;
            process.StartInfo.Arguments = args;
            process.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
            process.Start();
            process.WaitForExit();
        }
        return true;
    }   
} 
```

# c# - 具有覆盖 CreateParams 的 ListBox 不会引发项目事件

> ID：398176
> 
> 赞同：0
> 
> 时间：2008-12-29T17:33:06.460
> 
> 标签：c#, winforms, listbox

我已经创建了一个自定义 ListBox，就像在[这里](https://stackoverflow.com/questions/353561/how-to-create-a-c-winforms-control-that-hovers#354326)一样。问题是它不会引发任何特定于项目的事件，例如 DrawItem 和 SelectedIndexChanged。

知道为什么吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T21:18:31.840

当我尝试这段代码时它工作得很好：

```
 public partial class Form1 : Form {
    MyListBox mList;
    public Form1() {
      InitializeComponent();
    }

    protected override void OnLoad(EventArgs e) {
      mList = new MyListBox(this);
      mList.Location = new Point(5, 10);
      mList.Size = new Size(50, this.ClientSize.Height + 50);
      for (int ix = 0; ix < 100; ++ix) mList.Items.Add(ix);
      mList.SelectedIndexChanged += new EventHandler(mList_SelectedIndexChanged);
    }

    void mList_SelectedIndexChanged(object sender, EventArgs e) {
      MessageBox.Show(mList.SelectedIndex.ToString());
    }

    protected override void Dispose(bool disposing) {
      // Moved from Designer.cs file
      if (disposing) mList.Dispose();
      if (disposing && (components != null)) {
        components.Dispose();
      }
      base.Dispose(disposing);
    }

  } 
```

# java - Findbugs 没有发现潜在的 SQL 注入漏洞

> ID：398179
> 
> 赞同：5
> 
> 时间：2008-12-29T17:33:46.320
> 
> 标签：java, sql-injection, findbugs

我刚刚为 Eclipse 安装了 FindBugs 插件，希望它能帮助我找到代码中的 SQL 注入漏洞。然而，它似乎并没有找到任何东西，即使我故意放了一些。

在以下示例中，假设`staticFinalBaseQuery`声明如下：

public static final String staticFinalBaseQuery = "SELECT foo FROM table where id = '";

并且假设`userInputfilterString`是包装示例片段的方法的参数。它直接来自用户输入，没有经过净化。

例如，以下代码段不会触发警告：

```
String query = staticFinalBaseQuery + userInputfilterString;
pstmt = dbConnection.prepareStatement(query); 
```

where`staticFinalBaseQuery`是一个静态的最终字符串，`userInputfilterString`是直接来自用户输入的字符串，仅在运行时可用，根本不被清除。显然，这是一个漏洞。

我希望触发“ [Aprepared statement is generated from a nonconstant String](http://findbugs.sourceforge.net/bugDescriptions.html#SQL_PREPARED_STATEMENT_GENERATED_FROM_NONCONSTANT_STRING) ”警告。

以下代码段也不会引起警告（不足为奇，因为它们的编译形式可能相同）：

```
pstmt = dbConnection.prepareStatement(staticFinalBaseQuery + userInputfilterString); 
```

但是，这将导致警告：

```
pstmt = dbConnection.prepareStatement(staticFinalBaseQuery + userInputfilterString + "'"); 
```

如果我附加一个空字符串或一个空格，则不会触发任何警告。

**所以，我的问题是，**如何让 FindBugs 在我的第一个示例中触发？我也很好奇**为什么**第一个不会引起警告，但最后一个呢？

提前致谢！

**编辑**：我向 FindBugs 的错误跟踪系统[提交了一个错误](https://sourceforge.net/tracker2/?func=detail&aid=2475589&group_id=96405&atid=614693)，因为这似乎是一个错误。但是，如果有人有任何提示，我很想听听。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T21:00:57.523

这里很难区分安全代码和不安全代码。当然，userInputfilterString*可能*是不安全的，但在编译时不可能确定这一点。但是，字符串连接中的单引号字符是使用可注入代码的标志。这就是为什么 FindBugs 在包含该字符的行上触发，而不是在仅字符串连接的行上触发。

基本上，这不是一个错误，而是软件可以做多少检查 SQL 注入的限制。由于字符串可能包含*任何内容*（即，它可能在另一个函数中具有易受攻击的连接），因此无法让工具确定存在问题的任何确定性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T16:46:09.967

我认为[PMD](http://pmd.sourceforge.net/)或[Checkstyle](http://checkstyle.sourceforge.net/)也不会捕捉到它，但你可以试一试（我定期使用所有 3 个，使用的好工具）。

编辑：PMD 是正确的链接，但我称它为 findbugs... findbugs on the brain 我猜...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T00:49:17.823

考虑升级到商业软件，例如[http://www.ouncelabs.com/](http://www.ouncelabs.com/)，它将更好地服务于您的目的......

# stored-procedures - SQL：在一个存储过程中组合多个动态结果集

> ID：398188
> 
> 赞同：1
> 
> 时间：2008-12-29T17:37:07.683
> 
> 标签：stored-procedures

我们遇到了一个小问题，可以使用一些帮助 - 我们需要将来自一个存储过程的多个结果集组合到一个结果集中（我们的 Java 报告框架的限制）。我们已经查看了 Union 等，但问题是存储过程结果集是多个交叉表结果，并且 (1) 每个结果集的列数是未知的， (2) 每个结果集的列名是未知的。

基本上，如果 sp_ 有 3 个结果，例如：

身份证名称

1 山姆

2 时间

ID FName LName

1 约翰·雅各布

2 提姆测试

3 山姆霍普金斯

身份证金额

1 1000

2 5000

理想的结果基本上会按原样返回我们的框架将打印给用户的上述文本。另请注意，这 3-4 个结果集彼此不相关。

我们使用的是 SQL Server 2000 和 Java 1.4。

任何意见，将不胜感激。

谢谢， SP

PS：如果上述解释不是很清楚，另一种解释。在 SQL 查询分析器中，如果我们有 3 个选择语句：

从国家中选择 *；{返回 id,countryname,countrycode}

从人中选择*；{id，国家名称，国家代码}

从余额中选择 *；{id，国家名称，国家代码}

然后结果显示在三个单独的结果集框中。我们需要将这些结果集作为一个结果集由存储过程返回（由于发生交叉表，我们不知道列的编号/名称）。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T17:41:42.200

您的问题没有指定您正在使用哪个数据库供应商或哪个客户端应用程序框架，但大多数具有存储过程的数据库都能够返回多个结果集，以及我熟悉的少数客户端框架（VB6、C++、.Net 等） .) 所有人都有能力从单个数据库访问中检索这些多个结果集，并操纵它们来做你可能想要的任何事情......

根据您的评论，如果您的报告框架可以硬编码以生成列标题（名字、姓氏、金额等），而无需从数据库中获取这些字符串，那么您可以这样做：

```
 Select ID, Name as value1, null as value2
  From TableA 
    Union
  Select ID, FName as value1, LName as value2
  From TableB 
    Union
  Select ID, Cast(Amount as VarChar(20)) as value1, null as value2
  From TableC 
```

关键是每个选择返回的列数必须相同（本例中为 3），并且它们的名称（别名）和数据类型也必须相同......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:07:19.450

如果来自不同表的 id 是相关的，那么您的 t-SQL 应该是左连接。

# sql - MSSQL 2005 全文搜索设置

> ID：398190
> 
> 赞同：0
> 
> 时间：2008-12-29T17:38:53.233
> 
> 标签：sql, sql-server, full-text-search

我开始涉足 MSSQL2005 的全文搜索。这是一个新的开发中数据库，所以我可以随意使用它。

假设我有一个“表单”表，它与其他两个表“答案”和“评论”具有一对多的关系。我希望用户能够输入一个搜索词，并通过全文搜索将所有这三个表挂起来。最好的方法是什么？似乎我可以创建一个[索引视图](http://www.microsoft.com/technet/prodtechnol/sql/2005/impprfiv.mspx)来加快速度。

如果我确实使用索引视图（这是最好的路线吗？），我该如何处理一对多关系？假设我真正想弄清楚的是“表单”表的 ID，该表将包含在子答案/评论表中找到的任何搜索结果，因此我可以显示包含已定位条目的整个表单。视图上的内部连接会导致返回多个“主”表单行——这听起来对性能不太好。如何将所有子答案/评论行连接到视图的一个“列”中？所以代替....

```
Form 1, Answer A, Comment A 
Form 1, Answer B, Comment A 
Form 1, Answer A, Comment B 
Form 1, Answer B, Comment B 
```

……会……

```
Form 1, Answer A Answer B, Comment A Comment B 
```

请记住，我关心的只是那个主“表单”行的 ID。

这对我来说似乎是合乎逻辑的，但我还不确定全文搜索的最佳实践，所以只是好奇我是否正确地接近它。

**更新：**看起来索引视图非常严格；没有左连接，没有子查询，所以我可能会沿着由触发器填充的汇总表的路径走下去，如果它不会太笨拙的话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T09:30:57.277

在 SQL 中，您应该使用以下经验法则： - 从要检索的元素开始 - 添加过滤器以限制要检索的元素集

这听起来很简单，但这确实是您所要做的。在这里，您需要表单元素（行），因此您编写：

```
SELECT ID
FROM Form 
```

然后添加过滤器以将总集限制为您感兴趣的表单集。您可以使用 IN 谓词来执行此操作。正如您所说，Answer 和 Comment 与 Form 具有 1:n 的关系，这意味着 Answer 和 Comment 具有 Form.ID 的 FK。所以我们可以添加 where：

```
WHERE ID IN
(SELECT FormID FROM Answer WHERE CONTAINS(FullTextColumnInAnswer, @stringToSearch))
OR
ID IN
(SELECT FormID FROM Comment WHERE CONTAINS(FullTextColumnInComment, @stringToSearch)) 
```

这将导致一组不同的 Form.ID 值，这些值是至少有 1 个答案或评论的表单的 ID，其中包含要在启用全文搜索的字段中搜索的字符串。

在 SqlServer 2000 上，这可能比在 2005 上慢，因为您使用多个 CONTAINS 语句。

您也可以在连接场景中使用 CONTAINSTABLE() 代替，请参阅 BOL 示例，尽管我会先设置 IN 子句以使事情正常进行。

# sharepoint - 如何更新“文档”内容类型或从它继承的类型中的“标题”字段的默认值

> ID：398192
> 
> 赞同：1
> 
> 时间：2008-12-29T17:39:48.787
> 
> 标签：sharepoint, sharepoint-2007, wss

“标题”字段是密封的。任何更新默认值的尝试都会将该值重置为“null”

* * *

谢谢你的时间。

您执行“RemoveFieldRef and FieldRef it right back in”的想法与通过“文档”或继承的内容类型的接口设置属性“必需”和“默认值”相同，但如果我们正在构建，您的想法会有所帮助自定义内容类型。

将“标题”设置为必需并不适用于所有情况。一种这样的情况是当您尝试通过“新建”添加项目时（在我的情况下，它会打开一个基于 Office 2007 的模板）。

由于必填字段的“标题”让我很难过，我想尝试“默认值”路线，但即使这个路线似乎也不起作用。有什么帮助吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T19:32:52.553

您可以立即将其 RemoveFieldRef 和 FieldRef 重新放入。实际上，文档内容类型本身就是这样做的，以使标题不再是必需的。在默认的 ctypeswss.xml 中，没有在 Document 内容类型上设置密封属性。

查看 [12]\TEMPLATE\FEATURES\CTypes\ctypeswss.xml 并向下滚动到大约第 32 行以查看内容类型如何执行此操作。

.b

（免责声明：我正在发高烧，所以如果我没有任何意义，请怪罪在我厨房周围跑来跑去的棒棒糖）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T21:10:50.160

使用您为添加的项目和更新的事件的内容类型注册的事件接收器执行此操作。这样，每当添加新项目时，都可以为其指定默认标题。您可以在 Content Type CAML 中注册 Event Recievers，如下所示：

```
 <ContentType ...>
    <FieldRefs>
      <FieldRef ID="{fa564e0f-0c70-4ab9-b863-0177e6ddd247}" Name="Title" DisplayName="My Title" Required="FALSE" ShowInDisplayForm="FALSE" ShowInNewForm="FALSE" ShowInEditForm="FALSE" ShowInListSettings="FALSE"/>
    </FieldRefs>
    <XmlDocuments>
      <XmlDocument NamespaceURI="http://schemas.microsoft.com/sharepoint/events">
        <Receivers>
          <Receiver>
            <Name>TitleCreator</Name>
            <Type>ItemAdded</Type>
            <Assembly>...</Assembly>
            <Class>TitleCreatorItemEventReceiver</Class>
          </Receiver>
          <Receiver>
            <Name>TitleCreator</Name>
            <Type>ItemUpdated</Type>
            <SequenceNumber>1</SequenceNumber>
            <Assembly>...</Assembly>
            <Class>TitleCreatorItemEventReceiver</Class>
          </Receiver>
        </Receivers>
      </XmlDocument>
    </XmlDocuments>
  </ContentType> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T21:27:05.170

这是我们为“标题”找到的：

*   “Title”字段未在 fieldwss.xml (12\TEMPLATE\FEATURES\fields) 中密封
*   它没有在 ctypeswss.xml (12\TEMPLATE\FEATURES\ctypes) 中的“文档”内容类型下密封
*   它被封装在 schema.xml (12\TEMPLATE\FEATURES\DocumentLibrary\DocLib) 中的文档库定义中

通过 OM 设置默认值会将内容类型 .Update() 上的值重置为 NULL。这是因为“标题”在 DL 定义中是密封的。

向 MS 提出服务请求。等待结果！！！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T06:21:01.870

嗯...如果您不做自定义内容类型，那么我建议您通过功能接收器做您想做的事情。您可以将该接收器附加到默认文档内容类型并根据需要处理您的列，例如设置默认值或仅在未提供用户值时设置默认值。

.b

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T17:20:41.507

这种方法适用于所有字段，除了隐藏的“标题”字段似乎真的很特别

# git - Git：无法从一台计算机推送

> ID：398203
> 
> 赞同：9
> 
> 时间：2008-12-29T17:50:16.457
> 
> 标签：git

我的一位同事在他的机器上从 git 推送更改时遇到问题。如果他登录到另一台机器，他可以很好地推送 - 但是从他的机器上，当他尝试推送时，他会收到以下错误

```
    D:\Projects\test1\best-practices>git push
    计数对象：4，完成。
    压缩对象：100% (2/2)，完成。
    写入对象：100% (3/3)，273 字节，完成。
    总计 3（增量 1），重复使用 0（增量 0）
    错误：无法创建临时 sha1 文件名 ./objects/42：权限被拒绝

    致命：无法写入对象
    错误：解包失败：解包器退出并显示错误代码
    到 //civ3s012/gitrepos/best-practices/.git
     ！[远程拒绝] master -> master (n/a (unpacker error))
    错误：未能将一些参考资料推送到“//civ3s012/gitrepos/best-practices/.git”

```

服务器是一台windows机器，客户端也是。没有其他人遇到这个问题 - 这似乎是服务器权限问题，但据我们所知，我们已经排除了这个问题。此外，他可以登录到另一台机器并使用相同的用户名进行推送，这使得它看起来好像不是服务器权限。任何想法这里可能出了什么问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T22:09:11.053

我不是 Windows 用户，所以我在这里有点暗中刺伤。看起来远程文件系统已安装，而您只是在推送（不使用 ssh:// 或 git://）。那 FS 是否以某种方式以只读方式安装？他可以在那里（外面`git`）创建/修改文件吗？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-29T23:53:43.760

尝试将此配置变量添加到远程存储库：

```
 $ git config core.sharedRepository "all"
 $ git config receive.denyNonFastForwards True 
```

这些通常由设置repo 时的`--shared`选项设置。`git init`

我不知道 Windows 权限如何交互，所以我不确定这是否是解决方案。但我知道有时 linux 用户可以通过这种方式在 Git 远程中创建权限失败的文件。当他们属于正确的组但没有将其作为*主要*组时，就会发生这种情况。将 repo 共享设置为`all`解决此问题。

这似乎发生在从 SVN 或 CVS 导入的共享存储库中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-29T18:44:59.170

我知道这是一个简单的系统管理员吹嘘答案，但是您是否确认他的硬盘驱动器未满？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T15:50:36.137

问题最终成为该共享的存储密码，该密码允许读取访问权限，但不允许写入访问权限。即使我们使用适当的用户名和密码明确安装了驱动器，存储的密码也必须在后台使用，这使得这很难追踪。要清除密码，我们转到控制面板、用户帐户、单击高级、管理密码，然后删除相关服务器的登录信息。在那之后，一切都按预期进行。我接受 Pat Notz 的回答，因为它最终成为只读 FS。谢谢！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T18:01:32.020

也许他在他的本地 repo 中创建了一个分支，该分支已经存在于服务器上，并且 ref 无法更新，因为它是由其他人创建的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T15:48:52.490

另一个脑残的答案。您确定您有权读取这些文件吗？发生在我身上几次，我会错误地以另一个用户的身份进行更改。后来就推不动了。陈是你的朋友。

# asp.net-mvc - 如何使用 ASP.NET MVC 根据网站部分设置不同的 web.config 默认错误页面

> ID：398205
> 
> 赞同：1
> 
> 时间：2008-12-29T17:50:36.863
> 
> 标签：asp.net-mvc, error-handling, web-config

我认为这是非常典型的，您拥有相同的网站项目，其中包含“管理员”部分和面向公众的部分。在这个网站中，我想配置默认错误，但我也希望它们以正确的布局显示。（管理员看起来与面向公众的网站不同）。

在 webforms 中，您可以在 admin 目录中放置一个不同的 web.config 来处理这个问题，无论如何在 MVC 中可以这样做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T18:16:11.193

设置 HandleErrorAttribute 的 View（或 Master）属性：

```
[HandleError(View="Foo")]
public ActionResult Bar(... 
```

# .net - 我应该将 OODB 用于小型应用程序吗？

> ID：398206
> 
> 赞同：2
> 
> 时间：2008-12-29T17:52:07.810
> 
> 标签：.net, object-oriented-database

我们希望使用 .net 构建一个应用程序来维护会议记录和类似内容。我正在考虑为此使用[db4o](http://www.db4o.com/about/productinformation/)或一些 OODB。这是个坏主意吗？我希望简单地创建一个会议记录存储库，用户可以在其中按日期和类似的小事情进行查找。使用 SQL Express DB 是否比使用 db4o 或[Versant FastObjects更好](http://www.versant.com/en_US/products/fastobjects)

编辑：这是一个跟踪讨论和会议记录的小创意。我想尽可能地减小应用程序的大小。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-17T23:23:16.767

如果您还没有尝试过 DB4O，我想您会感到惊讶。它在 .Net 应用程序中非常易于使用。您可以用一行代码保存任何 .Net 对象，并用一行代码对其进行再水化。此外，您可以使用 LINQ 查询您的对象，以便轻松搜索。

唯一真正的缺点是，如果您拥有大型数据集，除非您正确索引数据，否则性能会下降。创建这些索引将纠正性能问题，但要有效地创建它们有些复杂。

最后，请注意 DB4O 是一个 GPL 许可系统。这是一个左拷贝许可证，因此您不能在不根据 GPL 许可证发布源代码的情况下将您的应用程序分发给任何人。

总而言之，DB4O 在您所描述的小型应用程序中非常棒！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T18:46:20.120

在不知道对象/数据结构的情况下无法回答

听起来有点矫枉过正，但另一方面它可能会简化实现，特别是如果对象持久性是自动/简化的

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T18:46:51.523

您所描述的那种应用程序——小用户群，跟踪小块文本——很可能适用于您选择的任何数据库，甚至只是一个包含文本文件的目录。如果你想学习一些新东西，它可能也会做一个很好的小实验。但我认为没有充分的理由选择 OODB 而非其他任何东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T18:25:38.617

既然您需要诸如查找等操作，为什么不尝试使用 sqlite 呢？

# actionscript-3 - Actionscript 3.0，为什么缺少好的 OOP 元素？

> ID：398209
> 
> 赞同：2
> 
> 时间：2008-12-29T17:53:11.693
> 
> 标签：actionscript-3, oop

任何使用过 actionscript 3.0 编程的人都肯定注意到它缺乏对私有构造函数和抽象类的支持。有一些方法可以解决这些缺陷，比如从应该是抽象的方法中抛出错误，但是这些解决方法很烦人，而且不是很优雅。（从应该是抽象的方法中抛出错误是运行时检查，而不是编译时检查，这可能会导致很多挫败感）。

我知道 actionscript 3.0 遵循当前的 ECMAscript 标准，这就是它缺少私有构造函数的原因，但是抽象类呢，它们不在 ECMAscript 标准中吗？

我想更具体的问题是为什么 ECMAscript 标准不支持私有构造函数？是不是未来可以期待的事情？

我一直想知道这个是否要退出，任何见解都将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T19:08:22.447

私有构造函数和抽象类不是“好的 OOP 元素”。它们是源自 C++ 的不错的 hack。在更动态的语言中，通常不需要它们。

特别是抽象类是完全不需要的，因为您不必在祖先中声明接口以符合接口。事实上，你甚至不必继承一个共同的祖先来使用一些多态性。

我并不是说没有这样的东西，AS 会更好；而不是你应该用你正在使用的语言来思考，而不是试图从你习惯的任何东西中翻译出来。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-03T21:15:41.553

ActionScript 3 所基于的旧 ECMAScript 4 标准中既没有定义私有构造函数，也没有定义抽象类。如果我没记错的话，ECMAScript 工作组之所以选择不实现这些更复杂的 OOP 功能，是因为他们特别关注简单性和与旧版本 ECMAScript 的向后兼容性。我将我从他们那里听到的解释为“我们可能会在以后添加这些功能，但让我们慢慢来”。例如，abstract 关键字是保留字，因此他们考虑到了这一点。

值得注意的是，工作组选择以新的焦点重新启动该语言的下一个版本。这种努力被称为“和谐”，因为两个竞争的子组对 ECMAScript 未来的发展方向有着截然不同的看法。这有点妥协。Harmony 的进步将比旧的 ES4 慢得多，甚至在 AS3 中已经实现的类语法最初也会从标准中删除。换句话说，他们将在一段时间内让它看起来更像今天的 JavaScript，以专注于对即将分支的团队很重要的一些其他功能。这将成为 ES3.1。稍后，新的 ES4 将重新考虑类和一些更类似于 Java 的 OOP 特性。

然而，AS3 呢？基本上，Adobe 通过使用尚未完成的标准来抢先一步，他们受到了政治的影响。但是，[Adobe 打算继续参与 ECMAScript 工作组](http://blogs.adobe.com/open/2008/08/blog_entry_dated_81408_715_pm.html)，他们可能会考虑添加工作组推荐的功能。也就是说，AS3 可能永远不会是未来 ECMAScript 的完整（或完全兼容）实现。这意味着什么？好吧，由于它们又是非标准的，Adobe 可以选择向 ActionScript 添加功能，即使这些功能不是标准的一部分。如果您觉得抽象类或私有构造函数对您作为开发人员很重要，[请在公共 Flash Player 错误数据库中请求这些功能](http://bugs.adobe.com/flashplayer/)，或者为现有功能请求投票（如果它们已经存在）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-30T20:11:00.940

我知道，这个问题真的很老了，但我只是偶然发现，不得不修改这个：

构造函数不是OO。对象应该由工厂实例化。
抽象类不是面向对象的。相反，应该使用接口（AS3 有）和 mixins（AS3 没有）。

AS3 是一门糟糕的语言，但其根本原因远不止这两者。AS3 基本上是 AVM2 字节码的结构化表示。1:1 映射很容易实现。而且我想，它很可能会保持这种状态，因为 Adob​​e 似乎对推动平台功能、他们的商业创作工具和 flex 框架（包括 mxml）更感兴趣。

问候
back2dos

# delphi - 有关 Turbo Delphi 2009 版本的任何信息？

> ID：398211
> 
> 赞同：12
> 
> 时间：2008-12-29T17:53:18.090
> 
> 标签：delphi, delphi-2009

单独地，Turbo Delphi 版本和 Delphi 2009 中添加的新改进是 Delphi 长期以来发生的两件最好的事情。但目前你只能得到其中之一。有谁知道 Embarcadero 是否有计划发布 Turbo Delphi 2009？

我是一个付费客户，拥有自己的 D2009 副本，但我正在尝试建立一个开源项目，该项目将大量使用泛型，如果该语言是可免费下载。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-29T18:12:01.873

[这个播客](http://www.delphi.org/2008/08/episode-2-nick-hodges/)中有一些信息。我们现在所知道的：是的，可能会有一个。但它可能不会像上一个 Turbo 那样功能丰富。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T19:53:56.910

在 CodeRage 的闭幕主题演讲中提到了这一点。没有官方日期，但他们说他们肯定想要 Turbo 级别的产品。

# vb.net - 在 VB 2005 中正确使用数组作为字段成员

> ID：398212
> 
> 赞同：0
> 
> 时间：2008-12-29T17:53:20.507
> 
> 标签：vb.net, arrays, visual-studio-2005

我通常使用 C#，我正试图通过将 qbasic 程序员简化为 VB 2005 来将他转换为面向对象编程的乐趣。

下面是我想要完成的一个极其简化的版本。它成功编译，但卡片对象数组中的所有成员都设置为“Nothing”。测试行抛出 NullReferenceException。我究竟做错了什么？

```
 Sub Main()
        Dim deck1 As New Deck
        Console.WriteLine("Test: " & deck1.cards(2).face)
    End Sub

    Class Card
        Public face As String
        Sub New()
            face = "Blank"
        End Sub
    End Class

    Class Deck
        Public cards(51) As Card
    End Class 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T17:56:02.967

是的，当您在 .NET 中创建数组时，数组的每个元素都设置为元素类型的默认值 - 对于类来说，它是 null/Nothing。

您需要在使用它之前填充数组（或期望它充满空引用）。

请注意，这在 C# 中的行为方式完全相同。

编辑：由于没有人实际发布可以使用的人口代码，这里是：

```
Class Deck
    Public cards(51) As Card

    Public Sub New()
        For i As Integer = 0 To cards.Length-1
            cards(i) = New Card()
        Next
    End Sub
End Class 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:09:08.743

你需要做一些事情

```
For Each currentItem As String in Me.face
 currentItem = "Blank"
End 
```

如果 for-each 的语法关闭，我很抱歉，我通常是 C# 人。但基本问题是您还没有初始化数组的每个元素。

# java - 如何在查询时设置休眠实体使用的模式名称？

> ID：398215
> 
> 赞同：6
> 
> 时间：2008-12-29T17:55:03.343
> 
> 标签：java, hibernate, orm

我们的应用程序将 Hibernate 用于 ORM，并将数据存储在多个模式中，并由为应用程序定制授权的用户访问它们。

模式名称是在运行时根据数据确定的；在实体映射文档中包含他们的名字是不可行的。这意味着我需要一种方法来告诉 Hibernate 在执行查找时使用特定的模式名称。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T19:28:53.327

这是一个页面，列出了一些可以[在 Hibernate 中管理多个模式的](http://web.archive.org/web/20071011173719/http://hibernate.org/429.html)方法。我可能会去实现你自己的[连接提供者](http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/connection/ConnectionProvider.html)。您可能还想禁用缓存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-15T10:30:19.520

我们在工作中遇到了这个问题。正如罗伯特建议的那样，我通过创建一个名为“OracleSchemaRemappingDataSource”的连接提供程序（即DataSource 的实现）并使用spring 进行管道来修复它。

基本上，这个数据源实现了 getConnection()。该方法的实现通过spring注入从其他一些数据源获取连接来工作，它假定它是一个oracle连接，然后执行

```
ALTER SESSION SET CURRENT_SCHEMA = 'someotherschema' 
```

他们把那个连接传回来。

所有的休眠配置都小心使用名称而不为它们指定模式。

另外：有了这个，您不想禁用缓存 - 允许休眠正常管理连接，因为我们没有在应用程序中做任何魔术，例如在每个用户的基础上使用不同的连接。

# sharepoint - 在 Sharepoint wiki 中显示代码片段

> ID：398216
> 
> 赞同：53
> 
> 时间：2008-12-29T17:55:09.613
> 
> 标签：sharepoint, code-formatting

有没有办法让 SharePoint 以预先格式化的方式显示代码片段？

目前，如果您插入任何代码，它看起来就像文本的其余部分一样。有什么总比没有好。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2011-01-26T16:20:29.437

我发现[hilite.me](http://www.hilite.me/)可以生成 html 样式的代码，您可以将其插入到 sharpoint wiki 中。

它支持多种语言和风格，是一个在线应用程序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-31T21:27:48.403

不，因为 MOSS 的 wiki 只是一个新页面，链接上附加了“wiki”一词。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-03-17T15:52:18.843

尽管这是一个老问题，但我还有另一个在提出问题时可能不存在的解决方案：

您可以创建[GitHub Gist](https://gist.github.com)并在 SharePoint wiki 页面上使用 Gist 的嵌入代码。如果您已经在使用 Gist，想要在 wiki 之外的多个地方共享代码片段，和/或想要将代码片段的历史与 wiki 页面的其余部分分开，这将特别有用。

要使用嵌入代码而不剥离脚本标签，请在编辑页面时转到功能区中的插入 > 嵌入代码：

[![Office 365 SharePoint 插入功能区的屏幕截图](https://i.stack.imgur.com/4ZGM7.png)](https://i.stack.imgur.com/4ZGM7.png)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-07-25T19:33:36.783

此解决方案假定您使用的 IDE 已经为您格式化了代码。如果您有原始文本文件，其他一些答案会更好。

在编辑 Sharepoint Wiki 页面时：

1.  将代码从 IDE 复制到新的 MS Word 文档
2.  在 MS Word 中突出显示所有内容：Ctrl+A
3.  在 MS Word 中再次复制
4.  切换到维基页面，粘贴
5.  继续编辑 wiki 或保存

使用 Eclipse 作为 IDE 可以正常工作。可能能够直接从 VS 粘贴到 SharePoint。

如果您有要在多个页面中重复使用的代码片段，请使用类似的复制/粘贴技术将 htm 文件保存或上传到 SharePoint 文档库，然后插入“页面查看器 Web 部件”以查看不同页面中的 htm。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-31T21:40:18.987

我不知道您是否专门使用 Wiki 功能。据我所知，您的 wiki 条目就像表格中的行一样存储。如果您不使用 wiki，您可以使用语法高亮工具。这都是javascript。 [http://code.google.com/p/syntaxhighlighter/](http://code.google.com/p/syntaxhighlighter/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-08T22:51:00.857

几个星期以来，我们一直在使用 Telerik Rad Editor

其中一个工具是“格式化代码块”你可以在这里看到它：http: [//demos.telerik.com/aspnet-ajax/Editor/Examples/Default/DefaultCS.aspx](http://demos.telerik.com/aspnet-ajax/Editor/Examples/Default/DefaultCS.aspx)

如果您为 MOSS 安装 RadEditor .. 我们也会在 Wiki 页面中获得这个惊人的工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-28T22:12:24.953

所以这不是一个很好的答案，但对我们来说它比默认值更好。您可以使用 Windows Live writer (WLW) 等工具编写 wiki。WLW 有一个代码格式化程序的插件。如果您使用代码格式化程序通过 WLW 编写 wiki 页面，则可以转到 Wiki 页面并选择“编辑 HTML 源代码”。然后，您可以从 WLW 复制到 wiki 页面并获得良好的样式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-24T09:26:40.010

我发现的最好方法是使用 tohtml.com

您可以将代码剪切并粘贴到其中，它会生成 html，您可以将其粘贴到您的 sharepoint wiki

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-07-26T07:44:57.067

您可以使用 prisimjs 显示代码片段。当您添加 prisimjs 和 css 时，您可以像这样使用；

> ```
> p { 颜色：红色 }
> ```

如果你想要更简单的解决方案来使用 prisimjs，你可以检查这个：

[http://yasingokhanyuksel.blogspot.com.tr/2017/07/sharepoint-code-syntax-highlighting.html](http://yasingokhanyuksel.blogspot.com.tr/2017/07/sharepoint-code-syntax-highlighting.html)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2020-03-10T10:55:46.183

如果您希望在现代页面上使用此功能，可以使用 Qualitem 的源代码内容 webpart。

[https://spfxhub.com/packages/qualitem-source-code-content-web-part](https://spfxhub.com/packages/qualitem-source-code-content-web-part)

**免责声明**：我是共同开发者。

# linux - 使用包管理器时如何管理 Perl 模块？

> ID：398221
> 
> 赞同：32
> 
> 时间：2008-12-29T18:01:21.380
> 
> 标签：linux, perl, module, packages, cpan

[SO上最近的一个问题](https://stackoverflow.com/questions/397817/unable-to-find-perl-modules-in-intrepid-ibex-ubuntu)让我思考。

在我尝试过的大多数 Linux 发行版上，一些 Perl 模块可以通过包管理器获得。其他人，当然不是。有一段时间，每当我需要安装一些 CPAN 模块时，我都会使用我的包管理器来确定一个包是否可用，并在它可用时安装它。

明显的优势是，只要有新版本的软件包可用，您就可以更新模块。

但是，当模块不以预打包形式提供并且该模块存在依赖项时，您就会遇到麻烦。每次 cpan shell 询问它是否应该遵循依赖项时都启动你的包管理器可能会很累人。

通常，另一个缺点是预打包模块的版本。如果您正在运行 Debian 或 Ubuntu，您很快就会发现您将无法生活在最前沿，就像许多 CPAN 模块作者似乎所做的那样。

Linux 上的其他 Perl 人员如何处理这个问题？你只是忽略了你的包管理器必须提供的东西吗？是否有任何工具可以使 apt（例如）和 cpan 成为更好的队友？还是您根本不通过 cpan shell 安装任何东西？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-29T19:23:13.820

为了开发，我安装了我自己的 Perl 并且不理会系统 Perl。如果我想升级系统 Perl，我使用系统包管理器。对于我的 Perl 开发，我使用 cpan 工具。

由于我将它们分开，我不应该弄乱系统维护任务等所需的 Perl，但我不必依赖系统的开发决策。

安装单独的 Perls 非常容易。当您从源代码分发版运行配置时，它会询问您要将所有内容安装在哪里。给它任何你喜欢的路径。例如，我在*/usr/local/perls*中安装了许多 Perls ，并且每个安装的所有内容都单独存在。然后我在*/usr/local/bin*中为它们创建符号链接（例如 perl5.8.9、perl.5.10.0、perl5.10.0 线程）。当我想要一个特定版本时，我只使用我想要的那个：

```
$ perl5.10.0 program.pl 
```

特定的二进制文件确保程序选择正确的模块搜索路径等等（与该二进制文件的 Config.pm 模块中的内容相同）。

这是我用来创建符号链接的脚本。它在 bin 目录中查找，找出 Perl 版本，并制作类似的链接`cpan5.10.1`等等。每个程序都已经知道要调用的正确 perl：

```
#!perl

use 5.010;

use strict;
use warnings;

use File::Basename;
use File::Spec::Functions;

my $perls_directory = catfile(
    $ARGV[0] // '/usr/local/perls', 
    'perl*'
);
die "$perls_directory does not exist!\n" 
    unless -d dirname $perls_directory;

my $links_directory = $ARGV[1] // catfile( $ENV{HOME}, 'bin' ); #/
die "$links_directory does not exist!\n" unless -d $links_directory;

foreach my $directory ( glob( $perls_directory ) )
{
    say "Processing $directory...";

    unless( -e catfile( $directory, 'bin' ) )
    {
        say "\tNo bin/ directory. Skipping!";
        next;
    }

    my @perls = glob( catfile( $directory, qw( bin perl5* ) ) );    

    my( $perl_version ) = $perls[0] =~ m/(5\.\d+\.\d+)\z/;
    say "\tperl version is $perl_version";

    foreach my $bin ( glob( catfile( $directory, 'bin', '*' ) ) )
    {
        say "\tFound $bin";
        my $basename = basename( $bin );

        my $link_basename = do {
            if( $basename =~ m/5\.\d+\.\d+\z/) { $basename }
            else                               { "$basename$perl_version" }
        };

        my $link = catfile( $links_directory, $link_basename );
        next if -e $link;
        say "\t\tlinking $bin => $link";
        symlink $bin => $link or
            warn "\t\tCould not create symlink [$!]: $bin => $link!";
    }
} 
```

对于特定的 Perl，一切都安装在正确的位置。

我也一直在考虑应该将那些 Perl 目录置于某种源代码控制之下。如果我添加了一个我不喜欢的模块，我会退回到较早的版本。不过，我才刚刚开始这样做，而且还没有玩太多。

我在 Effective Perler 博客中写了更多关于这类事情的文章：

*   [链接到每个版本的工具。](http://www.effectiveperlprogramming.com/2010/03/make-links-to-per-version-tools/)
*   [使用 Git 管理您的 Perl 模块。](http://www.effectiveperlprogramming.com/2010/02/manage-your-perl-modules-with-git/)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-29T18:06:23.243

我们通过 CPAN shell 安装所有东西。这确实忽略了包管理器必须提供的功能，但它避免了您在尝试使用它们时提到的令人头疼的问题（触发依赖关系，使用正确的版本）。

此外，这意味着我们的包可以在任何运行 CPAN 的平台上以编程方式（或通过 shell 手动）构建。依赖包管理器会影响您将软件分发到不使用/支持该包管理器的平台的能力。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-03-13T14:32:48.227

自从最初提出这个问题以来，[perlbrew](https://metacpan.org/module/App::perlbrew)已经发布。它使安装自定义的、独立的 perl 安装变得微不足道。在这些版本之间切换同样简单：

```
perlbrew switch $version 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-30T18:59:35.600

我使用[Debian](http://www.debian.org)进行开发和生产，并依赖发行版提供的 debian Perl 软件包。

对于需要在 debian 中不可用的 Perl 模块的情况，我通常会创建自己的 debian 包并安装它。

当然，这种方法也不是没有缺陷，因为很多 debian perl 模块已经过时（至少在当前的 debian 稳定版本 - etch 中），并且向后移植像[Catalyst](http://www.catalystframework.org/)这样有很多依赖关系的东西是不切实际的。

但是，通过依赖 OS 包管理器，我保留了它的所有强大功能，这些功能带来了轻松的维护，特别是对于已部署的服务器，因为您确切知道安装了哪些包，以及一个简单的`apt-get update;apt-get upgrade`（来自 debian 或来自本地存储库) 将所有服务器升级到相同的状态，包括 Perl 模块。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-30T01:42:36.817

我在所有盒子上执行以下操作：

*   我自己编译 perl：我仍然使用 5.8.[89] 大多数情况下，股票 5.10.0 的性能回归让我很受打击，等待 5.10.1 再试一次；
*   我使用（并强烈推荐） local::lib 模块来为每个项目保留一个模块目录。现在，该目录已同步到安装项目的所有服务器，但我正在使用 git 进行测试；
*   我为每个项目创建一个 Task:: 模块，这样我就可以使用一个命令安装所有依赖项。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-14T21:17:33.633

我还使用 cpan shell 和 local::lib。

您不应该为每个项目都需要一个 Task:: 。只需使用 Module::Install （我喜欢像这样使用 Module::Starter ：

```
$ module-starter --mi --module=Module::Name --author="Me" --email=me@cpan.org 
```

然后只需将您的依赖项弹出 requires 'module::dependency'; 在 Makefile.PL 中。最后，当它是安装时间时，您只需`perl Makefile.PL`（回答是）然后`make installdeps`

[从我最初给出这个答案的5年后编辑]

这些天 perlbrew 和 cpanm 是要使用的东西。local::lib 仍然有一个用例，但是 perlbrew 和 cpanm 的组合解决了这些情况的一个超集。当您不准备编译自己的 perl 时，请使用 local::lib。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T18:41:51.830

我建议只使用 cpan。Linux 发行版中包含的模块仅用于覆盖包依赖性。当您在没有互联网访问的情况下仅使用 CD 安装 linux 时，它不能使用 cpan，因此某些模块作为包包含在内，但对于 Perl 开发人员来说，这很糟糕。

此外，我曾经配置了一个 cpan 来在我的家中安装模块（.perl），而无需 root 登录。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-14T21:28:28.320

对于生产：

在开发中，选择一个似乎适合需求的 perl 模块版本；如果可能，请选择目标操作系统的出厂版本（这使得以下大部分内容变得多余），否则，请选择另一个。为它创建一个 RPM 规范文件。使用干净的构建 VM 以可重现的方式构建 RPM（从在适当的分支上签入的规范文件/源）。

当可以构建最终构建时（合并后），从发布分支执行相同的构建，将生成的 RPM 提交到部署存储库中。这将用于最终验证，然后通过复制到生产存储库来发布到生产。

生产中的所有服务器都使用经过全面测试的完全相同的二进制文件；他们使用与开发人员预期的相同的规范文件和源。

Perl 模块不会被任何不遵循此模型的进程升级。也没有任何其他生产软件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-02T21:54:43.480

我使用 FreeBSD 端口并将所有 CPAN 依赖项包装在“元端口”中，作为一种[本地端口](http://lists.freebsd.org/pipermail/freebsd-ports/2006-June/033026.html)。FreeBSD 有相当多的 CPAN 模块，并且它们的[构建系统足够平易近人](http://www.freebsd.org/doc/en_US.ISO8859-1/books/porters-handbook/)，如果它不存在，您可以轻松编写自己的端口——只是不要忘记[提交所述端口](http://www.freebsd.org/send-pr.html)，以便将其包含在端口树中。如果 port 没有当前版本的库存，您可以随时编辑 port 的 Makefile 以便它使用新版本，同样[不要忘记提交更改](http://www.freebsd.org/doc/en_US.ISO8859-1/articles/contributing-ports/index.html):-)。

最后，我使用[Tinderbox](http://tinderbox.marcuscom.com/)将整个混乱构建为二进制包，然后将其安装在所有生产和开发机器上。

底线——一旦你克服了编辑 Makefile 的恐惧，FreeBSD 的移植是维护你的 perl 应用程序及其依赖项的好方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-09-28T08:06:15.420

我最近开始使用 Gentoo，Gentoo 在这方面有一些非常重要的优势。第一个是`g-cpan`通常能够从 CPAN 安装许多（尽管不是全部）模块作为本地的 Gentoo 包，尽管更新成为一个问题。

通常在 Gentoo 上，我的方法是使用`g-cpan`创建一个 ebuild 文件，然后从中安装，必要时进行调整。优点是升级变得非常容易。然后我将文件从 g-cpan/perl 移动到 dev-perl 并将它放在一个覆盖中供其他人使用。这让我可以快速处理 g-cpan 无法处理的情况，而 gentoo 的包装无论如何都是轻而易举的事/

# apache2 - 如何让我的 Apache 2 服务器强制浏览器打开文件传输对话框？

> ID：398223
> 
> 赞同：10
> 
> 时间：2008-12-29T18:01:55.700
> 
> 标签：apache2, mime-types

如果 URL 指向具有 .pln 或 .psa 扩展名的文件，如何让我的 Apache 2 服务器强制浏览器打开文件传输对话框？

我有一个简单的 LAMP 服务器，带有 CentOS 5、Apache 2、MYSQL 5、PHP 5，最近构建了 CentOS 5.2 i386 安装 CD。我的 Web 应用程序生成要下载并导入自定义应用程序的文件。文件扩展名为 .psa 和 .pln。如何让我的服务器强制浏览器打开文件传输对话框？如果我将浏览器指向 Apache 2 服务器上的 .psa 或 .pln 文件，该文件的内容将在弹出窗口中显示为简单文本。我想要一个文件传输对话。

我正在开发的网络应用程序部署在另一个网络服务器上，并根据需要处理 .pln 和 .psa 文件。我无法比较服务器配置文件，因为我没有对工作服务器的管理员访问权限。

如何更改服务器的行为？这是否需要对我的网络应用程序代码进行代码更改（例如发送显式标头）？如果是这样，为什么它对其他服务器起作用？是否可以通过配置服务器的默认行为来避免代码更改？

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T18:06:32.307

您应该能够使用 FilesMatch 指令来添加必要的标头。

```
<FilesMatch "\.(?i:pin)$">
  Header set Content-Disposition attachment
</FilesMatch> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:06:36.440

*强迫*浏览器做某事总是一个棘手的提议，因为浏览器可以忽略你并做它喜欢做的事情:)

也就是说，如果“Content-type”标头设置为“application/octet-stream”，大多数浏览器都会通过“另存为”对话框提示用户。要么编写一个简单的包装 cgi 来提供具有正确标题的请求文件，要么使用 Apache2 的 mime-types（查看 config 目录。）

希望这会有所帮助，快乐的黑客（以及快乐的圣诞节、新年或任何你可能庆祝的事情）

米莎

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T18:08:25.577

啊，不知道那个头白马，这可能是一个更好的方法，因为它允许你保留原始的 MIME 类型，必须记住那个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T18:13:54.130

我尝试了几个没有明显效果的配置更改。

1.  我将以下行添加到我的 /etc/httpd/conf/httpd.conf 文件中：

AddType 应用程序/八位字节流 .pln .psa

我重新启动了 Apache 服务器，但没有任何效果。

2.  我在 /etc/httpd/conf/httpd.conf 文件中添加了以下行： ForceType application/octet-stream Header set Content-Disposition attachment ForceType application/octet-stream Header set Content-Disposition attachment 我重新启动了 Apache 服务器并且它没有效果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T18:24:09.370

如果您有 Firefox（如果没有，为什么不呢？）安装 Chris Pedericks Developer Toolbar，并检查标题是否设置正确。如果是这样，可能是浏览器的问题。正如我所说，您不能确定任何给定的浏览器都会“正确”解释响应标头。无论如何，我们在这里谈论的是什么浏览器？

如果标头设置不正确，您可能需要重新检查 httpd.conf 文件。可能您添加的指令不在正确的部分？（例如在错误的 <Location > 指令下）

# c# - 如何用 C#“自然地”混合颜色？

> ID：398224
> 
> 赞同：48
> 
> 时间：2008-12-29T18:02:23.593
> 
> 标签：c#, .net, colors, mixing

我必须以自然的方式混合一些颜色。这表示

```
blue + yellow = green 
blue + red = purple 
```

等等。我将颜色作为 RGB 值。当我尝试混合它们时，我得到了正确的“RGB”结果，例如

```
green + red = yellow
yellow + blue = white 
```

但不是正确的“自然湿漆”结果。任何好主意如何以自然的方式混合RGB？

如果有人知道`Microsoft.Xna.Framework.Graphics`命名空间内的解决方案，那就太好了，但通用解决方案也会有所帮助:)

* * *

@Jay Bazuzi：

> 请发布一个代码示例，显示您正在尝试执行的操作。

当然 - 这是我混合两种 RGB 颜色的功能。

```
public Color colorMixer(Color c1, Color c2)
{

    int _r = Math.Min((c1.R + c2.R),255);
    int _g = Math.Min((c1.G + c2.G),255);
    int _b = Math.Min((c1.B + c2.B),255);

    return new Color(Convert.ToByte(_r),
                     Convert.ToByte(_g),
                     Convert.ToByte(_b));
} 
```

到目前为止我在这个线程中读到的内容非常有希望 - 我会将 C1 和 C2 转换为 L *a* b*，混合它们 - 将其转换回 RGB 并返回该颜色。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-12-29T18:28:26.787

“天然湿漆”有点暧昧；建议的 CMYK 混合不起作用，因为您仍在添加颜色。

**如果您想要 Photoshop 中的结果（正如 Jon B 检查的那样），您需要使用 L*a*b* 空间。** RGB 与 Lab 之间的转换公式和说明[在这里](http://en.wikipedia.org/wiki/Lab_color_space)。

实验室空间经过专门设计，使得线性变化对应于人眼所感知的一定量的颜色变化。这很重要，因为例如我们对绿色比其他颜色更敏感，因为我们根据色调和亮度等对变化的感知不同。

尝试当前建议的任何其他方法不仅会产生您不想要的颜色，而且不会代表颜色的“恒定外观”变化，特别是如果您将其用于恒定变化很重要的东西，例如渐变.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T18:37:15.940

[您可以使用WIC](http://en.wikipedia.org/wiki/Windows_Imaging_Component)免费获得 cmyk<->rgb 转换。~~但它只是 .NET 3.0~~

# asp.net-2.0 - ASP.NET 2.0：为 ObjectDataSource 指定对象的实例

> ID：398231
> 
> 赞同：3
> 
> 时间：2008-12-29T18:06:35.347
> 
> 标签：asp.net-2.0, pass-by-reference, objectdatasource

我正在使用 ObjectDataSource 将数据绑定到 GridView；它工作正常，只是它总是创建一个新对象用作数据源。我可以很好地完成所有设置，但我不能使用现有对象的实例来指定它的“数据源”。是否有可能做到这一点？如果是这样，怎么做？

如果不可能，为什么？

编辑：这是正在发生的事情的要点（对象类型已更改）：在第一页上，您正在编辑狗的属性。其中一个属性是“有小狗”，如果它是真的，下一页你指定这些小狗的名字。就我而言，发生的事情是那些小狗没有与原来的狗联系在一起，而是与“新”狗联系在一起。（暗示我的问题是“母狗”是巧合。;-)）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-29T18:23:46.000

为 ObjectDataSource 上的 ObjectCreating 事件创建一个事件处理程序。

您可以使用 ObjectDataSourceEventArgs 属性分配实例

```
protected void ObjectDataSource1_ObjectCreating(object sender, ObjectDataSourceEventArgs e)
{
    e.ObjectInstance = myObject;
} 
```

将此事件也连接到标记中

```
<asp:ObjectDataSource OnObjectCreating="ObjectDataSource1_ObjectCreating" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:12:48.860

正如我刚刚[在我自己的问题中](https://stackoverflow.com/questions/394492/why-is-my-applicationcache-passing-back-a-reference-instead-of-a-value)发现的那样，存储在应用程序缓存中的项目将作为参考传递给使用。您可以考虑将数据存储在那里（或者也可能存储在 Session 中）并以这种方式传递项目。

# coldfusion - 使用 ColdFusion 生成 Powerpoint PPT？

> ID：398235
> 
> 赞同：3
> 
> 时间：2008-12-29T18:07:24.613
> 
> 标签：coldfusion, powerpoint

有谁知道是否可以在 ColdFusion 中生成 powerpoint ppts？我不能依赖安装office副本并通过COM生成一个副本的方法，并且我不能使用ooxml，因为我的客户端仍处于office 2003时代。任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T21:52:48.907

您可以尝试使用 Apache POI，特别是他们的 Powerpoint 支持。看起来仍处于测试阶段：

[http://poi.apache.org/slideshow/index.html](http://poi.apache.org/slideshow/index.html)

我以前使用过 POI 来从 Word 文档中获取额外信息，并且在 ColdFusion 中相当容易。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T16:40:06.347

ColdFusion 没有内置 PPT 创建功能，但您可以使用 OpenOffice 制作一些东西。

查看 CPresentation (CF8)，它允许您创建基于 Web 的演示文稿 - 实际上不是 PPT 格式，而是通过 Flash 播放器以相同的方式显示。

您是否考虑过使用 PDF 代替？出于所有意图和目的，除了一些动画之外，PDF 可以很好地替代 PPT。CF 拥有大量的 PDF 创建和操作功能！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-23T02:41:00.617

我知道这不是一个好的答案，但 ColdFusion 9 可以将 cfpresentation 转换为 PowerPoint 文件，并且创建 cfpresentation 非常简单......

但是，这当然需要一台仍处于测试阶段的服务器，并且如果您正在运行自己的服务器，则一旦发布就需要大量现金支出。

担

# php - 如何使用 CSV MIME 类型？

> ID：398237
> 
> 赞同：126
> 
> 时间：2008-12-29T18:08:38.417
> 
> 标签：php, csv, http-headers, mime

在我正在开发的 Web 应用程序中，用户可以单击指向 CSV 文件的链接。没有为 mime 类型设置标题，因此浏览器只是将其呈现为文本。我希望将此文件作为 .csv 文件发送，以便用户可以直接使用 calc、excel、gnumeric 等打开它。

```
header('Content-Type: text/csv');
echo "cell 1, cell 2"; 
```

此代码在我的计算机上按预期工作（不是一直如此吗？）但在另一台计算机上不起作用。

我的浏览器是 FF 3.0.1（在 linux 上）的夜间版本。它不工作的浏览器是 IE 7 和 FF 3.0（在 Windows 上）

有什么我不知道的怪癖吗？

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2008-12-29T18:11:25.197

您可以尝试通过执行以下操作来强制浏览器打开“另存为...”对话框：

```
header('Content-type: text/csv');
header('Content-disposition: attachment;filename=MyVerySpecial.csv');
echo "cell 1, cell 2"; 
```

这应该适用于大多数主要浏览器。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-29T18:14:22.260

您没有指定语言或框架，但以下标头用于文件下载：

```
"Content-Disposition: attachment; filename=abc.csv" 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-05-04T09:51:45.757

使用 Internet Explorer，您通常还必须指定 Pragma: public 标头才能正常下载。

```
header('Pragma: public'); 
```

只是我的2美分..

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-08T10:27:59.583

此代码可用于导出任何文件，包括 csv

```
// application/octet-stream tells the browser not to try to interpret the file
header('Content-type: application/octet-stream');
header('Content-Length: ' . filesize($data));
header('Content-Disposition: attachment; filename="export.csv"'); 
```

# django - 在非 GPL django 项目中使用 GPL django 应用程序有什么影响？

> ID：398240
> 
> 赞同：2
> 
> 时间：2008-12-29T18:11:26.337
> 
> 标签：django, licensing, gpl, lgpl

如果我要在我的 django 项目中集成第三方 GPLv3、v2 或 LGPL django 应用程序，许可证将适用于整个项目还是仅适用于我正在使用的第三方应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T19:01:33.287

GPLv2 在网络应用程序上并不那么流行，因为你没有分发。GPLv3 可能是，这种情况有一些额外的措辞。

通常最好联系开发人员。他更改许可证或阐明其意图的情况并不少见。大多数与 Django 相关的代码都在 MIT 许可下，因此询问并非没有道理。

并且，如果他特别不想处理您的案件；那么无论您认为法律术语如何，您都不应该使用该代码。

（艾纳尔）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:15:05.237

取决于许可证的语言。如果不清楚最好咨询[律师。](http://www.abanet.org/intelprop/opensource.html)

# java - 从基于 Java 的对象更新 JavaFX 窗口

> ID：398252
> 
> 赞同：3
> 
> 时间：2008-12-29T18:15:27.157
> 
> 标签：java, javafx

我正在学习 JavaFX，我正在寻找有关使用 Java 对象更新 JavaFX 显示的教程。例如，从服务器接收状态更新 @ 1hz 并将它们显示在 fx 窗口上。这可能吗？如果有，有教程吗？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T18:25:13.827

据我了解，目前不支持从 Java 调用 JavaFX。但是，这里有两篇博客文章至少涉及到这个主题：

*   [如何在 Swing 应用程序中使用 JavaFX](http://blogs.oracle.com/javafx/entry/how_to_use_javafx_in)
*   [从 Java 调用 JavaFX？](http://java.dzone.com/news/calling-javafx-from-java)

我认为更自然的解决方案是在您的 Java 代码中提供一个访问点并设置 JavaFX 以定期轮询新的更新，即 JavaFX 要求新数据而不是让 Java 告诉它。

# forms - Safari 3.2.1 发送 POST 后跟 GET 请求

> ID：398257
> 
> 赞同：1
> 
> 时间：2008-12-29T18:18:12.453
> 
> 标签：forms, post, safari, get, tomcat5.5

我有一个在 Tomcat 5.5.27 和 5.5.26 上运行的 servlet，并且有一个带有 POST 方法的 Web 表单。如果我使用 Safari 3.2.1，我会从日志中看到 Tomcat 收到一个 POST 后立即/同时是 GET 并且它失败了。如果我使用 Firefox 3.0.5，我发现它只发送 POST 并且一切正常。

尝试使用 Eclipse 进行调试时，我发现使用 Safari 时调用的是 doGet() 方法，而使用 Firefox 时调用的是 doPost()。

实际上，Safari 似乎同时触发 POST，然后立即触发 GET，而 Firefox 仅触发 POST（根据 HTML 表单应该如此）。

有没有其他人经历过这种情况？在这种情况下有解决方案吗？

这是 HTML 表单的片段：

```
<form action="/vidisearch/Search" method="post" name="SearchForm" id="SearchForm">
    <div class="input required">
    <label for="Concepts">Concepts, comma separated<br />
    ex. (remove quotes) &quot;man-made object, cemetery, graphic event, atmospheric event, tool event&quot;</label>
    <input name="concepts" type="text" value="" id="concepts" />
    </div>

    <div class="input required">
    <label for="Operators">Operators, comma separated<br />
    ex. (remove quotes) &quot;NOT, AND, OR, AND, AND&quot;</label>
    <input type="text" name="operators" value="" id="operators" />
    </div>

    <div class="input required">
    <label for="Specializations">Specializations, comma separated<br />
    ex. (remove quotes) &quot;true, false, false, true, false&quot;</label>
    <input type="text" name="specializations" value="" id="specializations" />
    </div>

    <div class="input required">
    <label for="Results">Various parameters</label>
    <table width="100%" border="0" style="border: 0;">
    <tr>
    <td>Ontology ID<br />
    <input name="ontologyID" type="text" id="ontologyID" value="" /></td>
    <td>Result page<br />
    <input name="page" type="text" id="page" value="0" /></td>
    <td>Shots per page<br />
    <input name="shotsPerPage" type="text" id="shotsPerPage" value="20" /></td>
    <td>New search<br />
    <input name="newSearch" type="text" id="newSearch" value="true" /></td></tr>
    </table>
    </div>

    <div class="submit"><input type="submit" value="Search" /></div>
</form> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-22T15:40:38.033

我认为您有一个具有空 src 的图像标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:35:02.873

如果没有看到表单的 HTML，很难说，但也许您的提交按钮是用链接包裹的，而 Safari 既在发布表单*，又*在跟踪链接（通过 GET）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T18:35:10.203

我不确定发生了什么，但我知道您需要提供更多信息。

例如，它可能正在为相关资源（如图像）发送 GET，而 Firefox 将它们保存在缓存中，或者您在 <a> 标记内有表单提交按钮。

另一种选择是 Javascript 不兼容，以防您通过 Javascript 提交内容。

嗅探流量（查看[Fiddler](http://www.fiddlertool.com/)或[Wireshark](http://wireshark.org)）并查看 Safari 试图获取什么以及它正在发布什么

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T23:08:35.643

我对 Safari 的行为感到非常困惑，因为我曾经提醒过它曾经工作过。我担心最新的升级之一破坏了某些东西。

使用[HTTPScoop](http://www.tuffcode.com/)，我看到Safari 在收到响应时显然会触发POST，然后触发GET。然而，我认为它实际上同时触发了两个请求，因为两个响应的日期+时间对于 POST 和 GET 都是相同的。

响应是一个 RSS 提要并具有 HTTP/1.1 200 OK 代码。第二个 GET 请求与 POST 相同的请求 URL ( [http://127.0.0.1:8180/vidisearch/Search](http://127.0.0.1:8180/vidisearch/Search) ) 但正文是 0 字节，它当然没有 GET 参数，并且由于缺少，答案是错误的参数。

相反，Firefox 只触发 POST 并获得正确答案。

# latex - 与 href 相关的 LaTeX 帮助

> ID：398259
> 
> 赞同：6
> 
> 时间：2008-12-29T18:20:57.957
> 
> 标签：latex

我正在尝试使用 LaTeX 创建一个超链接。当我使用命令 pdflatex 编译文件时，出现错误。

该文件的相关行是：

```
\documentclass[12pt]{article}
\usepackage{hyperref}
\begin{document}
...
\href{http://www.cs.utah.edu/dept/old/texinfo/as/gprof_toc.html}{gprof} 
```

pdflatex 创建了一个名为missfont.log 的文件，其中包含以下内容：

```
mktextfm pzdr 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-29T18:38:13.583

你有安装 pzdr 字体吗？如果您使用的是 Debian 或 Ubuntu，请尝试安装 texlive-fonts-recommended 软件包。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-29T18:32:47.197

hyperref 包是否声称要对任意网页进行超链接？我认为它只是用于文档内链接（它会自动执行）。我会做

```
\usepackage{url} 
```

和

```
\url{http://foo.com} 
```

格式化文档中的 URL。

补充：谢谢威尔，我不知道href。但是，如果您要创建的文档主要将纸张作为预期媒介，我认为用于格式化 URL 的 url 包是可行的方法。但是，如果您认为 href 包包含 url 包，我很乐意直接说明这一点。

# crystal-reports - Crystal 报表 11：如何处理或修剪特殊字符

> ID：398260
> 
> 赞同：8
> 
> 时间：2008-12-29T18:22:52.273
> 
> 标签：crystal-reports

在我的水晶报告中，我注意到从表格中拉出的一个字段有特殊字符。更具体地说，回车和制表符。有没有办法把它去掉，所以它不会在我的报告中显示为空白？

提前致谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-29T18:56:15.123

这应该这样做：

```
stringvar output := {TABLE_NAME.FIELD_NAME};
output := Trim(output);  //get rid of leading & trailing spaces
output := Replace(output,Chr(13),'');  //get rid of line feed character
output := Replace(output,Chr(10),'');  //get rid of carriage return character

//add any other special characters you want to strip out. 
```

如果你有很多字符要去掉，你可以使用这种稍微花哨的方法。只需将要删除的任何字符添加到 in[] 中：

```
stringvar input := {DROPME.TEST_FIELD};
stringvar output := '';
numbervar i;

input := Trim(input);

for i := 1 to Length(input) Step 1 do
  if not(input[i] in [Chr(13),Chr(10)]) then
    output := output + input[i];

output 
```

# asp.net - System.Web.UI.HtmlControls 和 System.Web.UI.WebControls 有什么区别

> ID：398271
> 
> 赞同：6
> 
> 时间：2008-12-29T18:29:34.943
> 
> 标签：asp.net, controls

我正在比较每个命名空间的两个基类，有点困惑。

```
System.Web.UI.WebControls.WebControl
System.Web.UI.HtmlControls.HtmlControl 
```

我看到两者之间的细微差别。例如，`HtmlControl`具有更少的属性，而`WebControl`具有很多属性，例如 CssClass 属性。除了额外的属性之外，`WebControl`基类在处理渲染的方式上似乎更加健壮。

为什么需要有两个命名空间和两组几乎相同的控件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-29T18:33:11.830

System.Web.UI.HtmlControls 中的控件只是实际 HTML 控件的薄包装。System.Web.UI.WebControls.WebControl 是您的标准 ASP.NET 控件。

稍微扩展一下：

> [System.Web.UI.HtmlControls](http://msdn.microsoft.com/en-us/library/system.web.ui.htmlcontrols(VS.80).aspx) 命名空间包含允许您在 Web 窗体页上创建 HTML 服务器控件的类。HTML 服务器控件在服务器上运行并直接映射到大多数浏览器支持的标准 HTML 标记。这允许您以编程方式控制 Web 表单页面上的 HTML 元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T18:34:29.877

RadioButtonList 是一个 ASP.NET WebControl。但是 HTML 中不存在这样的控件 - 在 HTML 中，您将拥有一组类型为“radio”的 INPUT 控件，它们共享相同的 name 属性值。

因此，WebControls 是呈现为 HTML 控件的 ASP.NET 控件。HtmlControl 是页面上 HTML 控件的实际表示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T18:36:57.407

来自[w3schools](http://www.w3schools.com/aspnet/aspnet_refwebcontrols.asp)：

> 与 HTML 服务器控件一样，Web 服务器控件也是在服务器上创建的，它们需要 runat="server" 属性才能工作。但是，Web 服务器控件不一定映射到任何现有的 HTML 元素，它们可能表示更复杂的元素。

Web 控件通常更强大一点，但也需要更多资源来动态生成相应的 HTML。

# datetime - 在哪里进行转换 - 时区、计量单位等

> ID：398275
> 
> 赞同：3
> 
> 时间：2008-12-29T18:31:11.960
> 
> 标签：datetime, units-of-measurement, timezone

应该在代码的哪里进行转换？客户端、服务器、业务还是数据库？

我们目前在我们的数据库中进行时区和计量单位的转换，性能正在扼杀我们，并希望移动逻辑。你认为最好的位置在哪里？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T19:04:43.950

我肯定会从数据库中获取该代码。您希望尽可能将数据全部存储在一组通用单元中。将您的时间数据存储在一个特定的区域（通常是您自己的）是很常见的。

我也不会将它放在业务层中，因为那样您会遇到必须使用来自不同区域设置的时间进行计算的情况，并且您需要它们具有相同的起始参考。同样，您应该将它们全部放在一个共同的基础上，这里最合乎逻辑的事情是让该基础成为您存储它们的任何语言环境。

我认为最合乎逻辑的做法是在显示时间之前的最后一刻将时间转换为用户的语言环境。这将它牢牢地放在 GUI 层中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T18:33:58.757

通常这些是客户端/UI 选择。但是该首选项可以传递给服务器或业务规则。

我会在客户端执行此操作以规范其他任何地方的数据。

编辑：

如果您有一个非常瘦的客户端并且不想为其添加逻辑，那么找到下一个您有代码/规则/等的地方并将它们添加到那里。找到最外层/客户端代码并将其放在一起。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T18:35:15.587

我们正试图“尽可能早地”完成它们（在我们的例子中，它是连接客户端的地方）并在服务器上端到端地处理统一数据。当然，当发回时，数据会被适当地转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T18:53:18.077

我不确定您所说的“转换”是什么意思。如果您的意思是本地化，那么传统上是在 GUI 层中完成的。

# flash - 将 amfphp 与 Flash CS3 和 AS2 一起使用

> ID：398277
> 
> 赞同：0
> 
> 时间：2008-12-29T18:31:31.303
> 
> 标签：flash, actionscript-3, actionscript-2, remoting, amfphp

全部，

我已经开始尝试使用 amfphp。我浏览了一些很棒的教程（尤其是 Lee Brimlow 在 gotoandlearn.com 上的教程）。

只要您使用的是 AS3，它就可以很好地工作，因为 AS3 包含内置的 NetConnection 类。

但是，我希望在一堆现有的 AS2 项目中使用 amfphp。

问题是 AS2 似乎没有 NetConnection 类，但 Adob​​e 的远程处理组件仅适用于 Flash 8，不适用于 CS3。

谷歌搜索出现了一堆建议，我将文件从我的 Flash 8 安装复制到 CS3，但我没有 Flash 8。

我卡住了吗？有没有办法解决这个问题？

非常感谢您提供任何建议或指导。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T18:41:33.857

我自己不做任何 as2 编程，但是这个帖子[http://drupal.org/node/258605#comment-852450](http://drupal.org/node/258605#comment-852450)看起来它有你需要的类的下载。

您也可以尝试通过加载单独的 as3 swf 并通过 LocalConnection [http://www.kirupa.com/forum/showthread.php?p=1964550#post1964550](http://www.kirupa.com/forum/showthread.php?p=1964550#post1964550)进行通信来组合 as2 和 as3但我猜这几乎可以删除所有amfphp 的好处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T00:41:18.183

[您可以在 Adob​​e 网站上找到用于MAC](http://download.macromedia.com/pub/flashremoting/flash8/flashremoting_components_flash8.dmg)和[PC](http://download.macromedia.com/pub/flashremoting/flash8/flashremoting_components_flash8.msi)的 flash 8 的 as2 Remoting Components 。它可能没有安装在 Flash CS3 的正确文件夹中，但 mx.remoting 类与您的其他 as2 mx 软件包位于同一文件夹中，NetConnection Debugger 位于 WindowSWF 文件夹中，swc 本身位于 Common Libraries 中.

我现在在办公室而不是家里上课，所以我不是 100% 准确的。

[我记得amfphp 网站](http://amfphp.org/videotuts.html)上有一些关于 as2 的方便的视频教程。

# c# - [L]GPL 在 Java/C# 代码中的应用

> ID：398280
> 
> 赞同：2
> 
> 时间：2008-12-29T18:32:22.767
> 
> 标签：c#, java, open-source, gpl, lgpl

[L]GPL 许可证应如何应用于 Java 和 C# 代码？我知道当 Sun JDK 成为 GPL 时，他们对标准库做了特殊的例外。

所以，如果我无法打开我的应用程序源并且仍然想分发它......

*   ...我可以使用 GPL 的库（通过**import** 'ing 它的类）吗？
*   ...我可以使用 LGPL 的吗
*   ...我的应用程序能否在 GPL 的应用程序服务器之上运行（使用它的服务和 API）

在上述所有问题中，GPL = GPL v.2。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T19:10:31.130

首先，如果您在其他人的作品之上构建商业软件，您应该聘请律师来帮助您确保您始终遵守版权所有者的许可和您的特定用途。

也就是说，这是我的建议：

1.  除非您想将代码作为 GPL 分发，否则不应链接到 GPL 应用程序或库。
2.  就 LGPL 而言，您可能需要与版权所有者核实，但自由软件基金会已经澄清了其对 Java 的 LGPL 的解释：[David Turner 的 LGPL 和 Java](http://www.fsf.org/licensing/licenses/lgpl-java.html)。
3.  如果您要扩展 GPL 框架（例如应用服务器），则需要遵循框架的许可。
4.  如果您使用 SOAP 之类的东西来访问服务，那么在 GPLv2 下应该没问题。如果您使用 RMI，那么情况可能会有所不同，因为您要链接到的存根可能在 GPL 下。

现在，如果您担心 Java 运行时，我认为您不必担心。如果 Sun 只制作 Java GPL，我会感到惊讶。他们有太多的客户，他们依赖于 Java 可以扩展并用于构建专有应用程序这一事实。软件通常在多个许可下发布，允许用户选择条款（例如，Firefox 使用这种方法并获得三重许可：GPL、LGPL 和 MPL）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T19:00:23.600

不管 Sun 对开源的承诺如何，您都可以使用 GPL、LGPL、MIT 甚至所谓的“专有”许可来许可您的 Java 应用程序。

“......我可以使用 GPL 的库（通过导入它的类）吗？” 不。除非它不是纯 GPL（它可能是双重许可的，具有“类路径异常”或类似的东西，或者具有用于外部访问的公共域接口）。但是，这仅适用于您分发应用程序的情况。如果您的应用程序**仅**在内部使用，那么您不需要分发源代码。

“...我可以使用 LGPL'ed one” 如果您将其保存在单独的文件中，您可以参考 LGPL 代码。对于 Java，将 LGPL 代码保存在单独的 jar 中。对于 C#，将其保存在单独的 DLL 中。如果您允许最终用户替换它，您可以在您的应用程序中包含 LGPL 代码（但这可能比仅将其保留为单独的文件更难）

“......我的应用程序能否在 GPL 的应用程序服务器之上运行（使用它的服务和 API）”。不，除非这些服务/API 有其他许可。

另请参阅：[https ://stackoverflow.com/questions/137048/how-do-i-tell-if-i-can-re-use-a-free-software-library-in-a-commercial-app](https://stackoverflow.com/questions/137048/how-do-i-tell-if-i-can-re-use-a-free-software-library-in-a-commercial-app)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T19:31:58.403

[咆哮] GPL 和 LGPL 是由非常糟糕的律师编写的糟糕的许可证，他们无法弄清楚他们的术语。因此，任何人都可以猜测它们的真正含义以及它们如何应用于现实世界的情况 [/rant]

正确的答案是，如果被版权所有者起诉是您真正关心的问题，那么您应该咨询律师。这些许可证太复杂，您无法在此论坛上获得有意义的答案。

现实世界的答案是，将他们的 Java 库置于 LGPL 之下的人很可能打算将它们链接到商业 Java 应用程序中/在其中重新分发，因此如果您只是简单地重新分发那些未修改的库，则极不可能遇到任何麻烦。应用。

在 GPL 下分发 Java 库的人要么不打算将它们嵌入到商业应用程序中，要么不关心法律后果，因为 GPL 不是库的适当许可，而仅适用于独立应用程序. 我建议在商业代码中避开 GPL 的 Java 库。不过，将 GPL 应用程序与您的商业应用程序并排包含在内是可以的。

关于在 GPL 应用程序服务器中运行，只要您坚持使用标准 API（servlet、jsps、JMX 等），您肯定没问题。如果您必须使用服务器专有的 API，那么问题会更加复杂，所以我肯定会咨询律师，尽管 App Server 代码所有者的意图很可能是应该允许这样的使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-06T13:03:32.190

IANAL 但我认为重要的是要记住 GPL 取决于版权。因此，版权法允许的任何内容在 GPL 下都是允许的。例如，GPL 禁止制作派生作品并将其链接到非 GPL 模块。例如，这种参数用于防止使用二进制 Linux 内核模块。但是，不是内核派生作品的模块不能被认为属于内核的版权，因此不必是 GPL。注意：带有模块的生成内核可能被认为是派生作品，并且证明模块不是派生作品可能是一个问题。但它不是切割和干燥的。

此外，GPL 包含基本操作系统的例外情况，允许将 GPL 软件链接到平台的非自由库。这允许自由软件在非自由平台上运行。可以说 JVM 是一个平台，甚至像 J2EE 应用程序服务器这样的东西也可能是一个平台。您可能不允许将 GPL Web 应用程序和平台一起重新分发，但移植到 Websphere（例如）的 GPL Web 应用程序可能仍然符合 GPL。

鉴于复杂性，与律师讨论这件事是有意义的。

# design-patterns - 什么是级联对象的好数据结构？

> ID：398296
> 
> 赞同：4
> 
> 时间：2008-12-29T18:39:25.797
> 
> 标签：design-patterns, data-structures, internationalization

我想知道在实现诸如 CSS 之类的东西时使用什么类型的数据结构和设计模式，您可以在不同的粒度级别指定格式或其他一些属性。

我目前正在研究的一个具体示例与应用程序的国际化有关。

首先，英语是默认语言，但该应用程序将在美洲和欧洲两个不同地区使用。在大多数情况下，两个地区之间的各种文本和标签是相同的，但在某些情况下，技术术语会因地区而异。将文本翻译成其他语言时，有些会保留该地区的原始英文文本。

因此，查找标签的文本将像这样工作。看地区和语言的具体组合。如果什么都没有，只看语言。如果没有，请查看英语和地区的组合。如果没有，只看英文。

我正在寻找将此类数据存储在数据库以及代码中的数据结构中的最佳方法。无论是在这种特定情况下，还是在一般情况下。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T18:44:53.913

当然是分层的！

数据库：

```
create table Element 
(
    Id int not null,      --primary key
    ParentId int null,    --parent element foreign key
    tag varchar(64)       --etc
)
create table ElementProperty
(
    Id int not null,          --primary key
    ElementId int not null,   --owning element
    PropertyName varchar(64) not null,
    PropertyValue varchar(512) null
) 
```

目的：

```
public class Element
{
    public string Tag;    //use a property instead though
    public Element ParentElement;
    public IDictionary<string,string> CssProperties;
    public string GetCssPropertyValue(string propertyName)
    {
        if (CssProperties.HasKey(propertyName))
        {
            return CssProperties[propertyName];
        }
        if (ParentElement != null)
        {
            return ParentElement.GetCssPropertyValue(propertyName);
        }
        return null;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T19:29:00.627

正如 Doug Currie 所说，级联表是要走的路，因此您将拥有通用英语的“en”资源，以及美国和英国地区的“en_US”或“en_UK”资源。

您应该检查您的语言库，看看它们是否为此提供了抽象。例如，Java 提供了 ResourceBundle，它以这种方式为语言环境提供分层回退：[javadoc for java.util.ResourceBundle](http://java.sun.com/javase/6/docs/api/java/util/ResourceBundle.html)

同样，GNU 有 gettext，它在整个自由软件世界中都被使用：[GNU gettext 的主页](http://www.gnu.org/software/gettext/)。

您的环境可能会有类似的 API 来处理 i18n/l10n。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T19:29:14.510

如果您使用 RFC 4646 语言标签作为您的语言标识符（就像浏览器一样；例如“DE-AT”），它们具有内置的层次结构。

为了处理查找，将破折号处的标识符分解为一个按长度递减排序的列表，其中中性/默认语言（例如英语）作为空字符串；在这种情况下，这将是“DE-AT”、“DE”、“”（=>“EN”）。然后找到第一个匹配项。

我已经在 SQL 和基于文件的查找中成功地使用了这种设计。

如果您有大量字符串和/或本地化，建议缓存键。哈希表的哈希表效果很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T19:09:19.167

级联哈希表运行良好。如果在本地找不到密钥，每个哈希表都有一个指向另一个哈希表的链接。每个本地语言和区域对都有一个哈希表，它链接到其本地语言的哈希表，该哈希表链接到区域和英语的哈希表，最终链接到英语哈希表。

[Lua](http://www.lua.org/manual/5.1/manual.html)内置了这种结构作为其基本的*表*数据结构。表的元表可用于满足缺失键的查找。这也可以用于动态构建类/对象层次结构。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T14:08:55.873

您可以根据以下伪代码在访问层中驱动它，而不是在数据存储中硬编码您的序列：

```
string lookup(key, language, region) {
    string result = datasearch(key, language, region)
    if result == null {
        result = datasearch(key, language, "")
    }
    if result == null {
        result = datasearch(key, "EN", region)
    }
    if result == null {
        result = datasearch(key, "EN", "")
    }
    return result
} 
```

好处：

1.  代码的所有其他部分都将调用这个单一`lookup`的例程，因此该序列恰好在一个位置。

2.  该序列未嵌入数据存储中。

3.  这意味着，如果您需要查看“规则”，您有一点可做，如果您需要更改它们，则需要一点维护（包括无数据存储维护）。

# algorithm - 在螺旋中循环

> ID：398299
> 
> 赞同：170
> 
> 时间：2008-12-29T18:40:29.320
> 
> 标签：algorithm, matrix, loops, spiral

一位朋友需要一种算法，可以让他遍历 NxM 矩阵的元素（N 和 M 是奇数）。我想出了一个解决方案，但我想看看我的同胞们是否能想出一个更好的解决方案。

我发布我的解决方案作为这个问题的答案。

**示例输出：**

对于 3x3 矩阵，输出应为：

(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1 )

![3x3 矩阵](https://i.stack.imgur.com/kjR4H.png)

此外，该算法应支持非方阵，例如对于 5x3 矩阵，输出应为：

(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1 ) (2, -1) (2, 0) (2, 1) (-2, 1) (-2, 0) (-2, -1)

![5x3 矩阵](https://i.stack.imgur.com/NE82F.png)

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-12-29T18:41:38.087

这是我的解决方案（在 Python 中）：

```
def spiral(X, Y):
    x = y = 0
    dx = 0
    dy = -1
    for i in range(max(X, Y)**2):
        if (-X/2 < x <= X/2) and (-Y/2 < y <= Y/2):
            print (x, y)
            # DO STUFF...
        if x == y or (x < 0 and x == -y) or (x > 0 and x == 1-y):
            dx, dy = -dy, dx
        x, y = x+dx, y+dy 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-10-12T15:29:12.413

C++有人吗？来自python的快速翻译，为了完整性而发布

```
void Spiral( int X, int Y){
    int x,y,dx,dy;
    x = y = dx =0;
    dy = -1;
    int t = std::max(X,Y);
    int maxI = t*t;
    for(int i =0; i < maxI; i++){
        if ((-X/2 <= x) && (x <= X/2) && (-Y/2 <= y) && (y <= Y/2)){
            // DO STUFF...
        }
        if( (x == y) || ((x < 0) && (x == -y)) || ((x > 0) && (x == 1-y))){
            t = dx;
            dx = -dy;
            dy = t;
        }
        x += dx;
        y += dy;
    }
} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2015-11-10T21:22:21.643

```
let x = 0
let y = 0
let d = 1
let m = 1

while true
  while 2 * x * d < m
    print(x, y)
    x = x + d
  while 2 * y * d < m
    print(x, y)
    y = y + d
  d = -1 * d
  m = m + 1 
```

对于这个问题，已经有许多用各种编程语言编写的解决方案，但它们似乎都源于相同的复杂方法。我将考虑计算螺旋的更普遍的问题，它可以用归纳法简洁地表达。

基本情况：从 (0, 0) 开始，向前移动 1 格，向左转，向前移动 1 格，向左转。归纳步：前进n+1格，左转，前进n+1格，左转。

表达这个问题的数学优雅强烈表明应该有一个简单的算法来计算解决方案。牢记抽象，我选择不使用特定的编程语言来实现算法，而是使用伪代码。

首先，我将考虑一种算法，使用 4 对 while 循环仅计算螺旋的 2 次迭代。每一对的结构相似，但在其自身的权利上却截然不同。起初这可能看起来很疯狂（有些循环只执行一次），但我会一步一步地进行转换，直到我们到达 4 对相同的循环，因此可以用放置在另一个循环内的一对循环来替换。这将为我们提供一个不使用任何条件的计算 n 次迭代的通用解决方案。

```
let x = 0
let y = 0

//RIGHT, UP
while x < 1
  print(x, y)
  x = x + 1
while y < 1
  print(x, y)
  y = y + 1

//LEFT, LEFT, DOWN, DOWN
while x > -1
  print(x, y)
  x = x - 1
while y > -1
  print(x, y)
  y = y - 1

//RIGHT, RIGHT, RIGHT, UP, UP, UP
while x < 2
  print(x, y)
  x = x + 1
while y < 2
  print(x, y)
  y = y + 1

//LEFT, LEFT, LEFT, LEFT, DOWN, DOWN, DOWN, DOWN
while x > -2
  print(x, y)
  x = x - 1
while y > -2
  print(x, y)
  y = y - 1 
```

我们将进行的第一个转换是引入一个新变量 d，表示方向，它的值可以是 +1 或 -1。每对循环后方向切换。由于我们知道所有点的 d 值，我们可以将每个不等式的每一边乘以它，相应地调整不等式的方向，并将 d 与一个常数的任何乘法简化为另一个常数。这给我们留下了以下内容。

```
let x = 0
let y = 0
let d = 1

//RIGHT, UP
while x * d < 1
  print(x, y)
  x = x + d
while y * d < 1
  print(x, y)
  y = y + d
d = -1 * d

//LEFT, LEFT, DOWN, DOWN
while x * d < 1
  print(x, y)
  x = x + d
while y * d < 1
  print(x, y)
  y = y + d
d = -1 * d

//RIGHT, RIGHT, RIGHT, UP, UP, UP
while x * d < 2
  print(x, y)
  x = x + d
while y * d < 2
  print(x, y)
  y = y + d
d = -1 * d

//LEFT, LEFT, LEFT, LEFT, DOWN, DOWN, DOWN, DOWN
while x * d < 2
  print(x, y)
  x = x + d
while y * d < 2
  print(x, y)
  y = y + d 
```

现在我们注意到 x * d 和 RHS 都是整数，因此我们可以从 RHS 中减去 0 和 1 之间的任何实数值，而不会影响不等式的结果。我们选择从每隔一对 while 循环的不等式中减去 0.5，以建立更多的模式。

```
let x = 0
let y = 0
let d = 1

//RIGHT, UP
while x * d < 0.5
  print(x, y)
  x = x + d
while y * d < 0.5
  print(x, y)
  y = y + d
d = -1 * d

//LEFT, LEFT, DOWN, DOWN
while x * d < 1
  print(x, y)
  x = x + d
while y * d < 1
  print(x, y)
  y = y + d
d = -1 * d

//RIGHT, RIGHT, RIGHT, UP, UP, UP
while x * d < 1.5
  print(x, y)
  x = x + d
while y * d < 1.5
  print(x, y)
  y = y + d
d = -1 * d

//LEFT, LEFT, LEFT, LEFT, DOWN, DOWN, DOWN, DOWN
while x * d < 2
  print(x, y)
  x = x + d
while y * d < 2
  print(x, y)
  y = y + d 
```

我们现在可以引入另一个变量 m 来表示我们在每对 while 循环中采取的步数。

```
let x = 0
let y = 0
let d = 1
let m = 0.5

//RIGHT, UP
while x * d < m
  print(x, y)
  x = x + d
while y * d < m
  print(x, y)
  y = y + d
d = -1 * d
m = m + 0.5

//LEFT, LEFT, DOWN, DOWN
while x * d < m
  print(x, y)
  x = x + d
while y * d < m
  print(x, y)
  y = y + d
d = -1 * d
m = m + 0.5

//RIGHT, RIGHT, RIGHT, UP, UP, UP
while x * d < m
  print(x, y)
  x = x + d
while y * d < m
  print(x, y)
  y = y + d
d = -1 * d
m = m + 0.5

//LEFT, LEFT, LEFT, LEFT, DOWN, DOWN, DOWN, DOWN
while x * d < m
  print(x, y)
  x = x + d
while y * d < m
  print(x, y)
  y = y + d 
```

最后，我们看到每对 while 循环的结构是相同的，并且可以简化为放置在另一个循环内的单个循环。另外，为了避免使用实数值，我将 m 的初始值相乘；值 m 递增；每个不等式的两边都减 2。

这导致了此答案开头显示的解决方案。

编辑：已经有几年了，但我遇到了类似的问题，并在 F# 中编写了以下解决方案，我想分享一下。在我的原始答案中，print 这个词可能用词不当，但希望这个非伪代码版本能够解决评论中关于多功能性和终止条件的任何观点。我添加了示例用例，用于围绕任意点旋转并为迭代 NxM 矩阵找到原始问题的正确解决方案。

```
let spiral =
    let rec f (x, y) d m = seq {
        let mutable x = x
        let mutable y = y
        while 2 * x * d < m do
            yield x, y
            x <- x + d
        while 2 * y * d < m do
            yield x, y
            y <- y + d
        yield! f (x, y) -d (m + 1)
    }
    f (0, 0) 1 1

spiral
|> Seq.take 5
|> List.ofSeq;;
// [(0, 0); (1, 0); (1, 1); (0, 1); (-1, 1)]

spiral
|> Seq.take 5
|> Seq.map (fun (x, y) -> x + 5, y + 5)
|> List.ofSeq;;
// [(5, 5); (6, 5); (6, 6); (5, 6); (4, 6)]

spiral
|> Seq.takeWhile (fun (x, y) -> x * x + y * y < 9)
|> Seq.filter (fun (x, y) -> -2 <= x && x <= 2 && -1 <= y && y <= 1)
|> List.ofSeq;;
// [(0, 0); (1, 0); (1, 1); (0, 1); (-1, 1); (-1, 0); (-1, -1); (0, -1); (1, -1); (2, -1); (2, 0); (2, 1); (-2, 1); (-2, 0); (-2, -1)] 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-10-10T05:25:35.103

这是在平方螺旋中找到位置的 O(1) 解决方案：[小提琴](http://jsfiddle.net/davidonet/HJQ4g/)

```
function spiral(n) {
    // given n an index in the squared spiral
    // p the sum of point in inner square
    // a the position on the current square
    // n = p + a

    var r = Math.floor((Math.sqrt(n + 1) - 1) / 2) + 1;

    // compute radius : inverse arithmetic sum of 8+16+24+...=
    var p = (8 * r * (r - 1)) / 2;
    // compute total point on radius -1 : arithmetic sum of 8+16+24+...

    var en = r * 2;
    // points by face

    var a = (1 + n - p) % (r * 8);
    // compute de position and shift it so the first is (-r,-r) but (-r+1,-r)
    // so square can connect

    var pos = [0, 0, r];
    switch (Math.floor(a / (r * 2))) {
        // find the face : 0 top, 1 right, 2, bottom, 3 left
        case 0:
            {
                pos[0] = a - r;
                pos[1] = -r;
            }
            break;
        case 1:
            {
                pos[0] = r;
                pos[1] = (a % en) - r;

            }
            break;
        case 2:
            {
                pos[0] = r - (a % en);
                pos[1] = r;
            }
            break;
        case 3:
            {
                pos[0] = -r;
                pos[1] = r - (a % en);
            }
            break;
    }
    console.log("n : ", n, " r : ", r, " p : ", p, " a : ", a, "  -->  ", pos);
    return pos;
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-07-28T21:42:48.503

我喜欢 python 的生成器。

```
def spiral(N, M):
    x,y = 0,0   
    dx, dy = 0, -1

    for dumb in xrange(N*M):
        if abs(x) == abs(y) and [dx,dy] != [1,0] or x>0 and y == 1-x:  
            dx, dy = -dy, dx            # corner, change direction

        if abs(x)>N/2 or abs(y)>M/2:    # non-square
            dx, dy = -dy, dx            # change direction
            x, y = -y+dx, x+dy          # jump

        yield x, y
        x, y = x+dx, y+dy 
```

测试：

```
print 'Spiral 3x3:'
for a,b in spiral(3,3):
    print (a,b),

print '\n\nSpiral 5x3:'
for a,b in spiral(5,3):
    print (a,b), 
```

你得到：

```
Spiral 3x3:
(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1) 

Spiral 5x3:
(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1) (2, -1) (2, 0) (2, 1) (-2, 1) (-2, 0) (-2, -1) 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-05-15T18:56:45.663

Java 螺旋式“代码高尔夫”尝试，基于 C++ 变体。

```
public static void Spiral(int X, int Y) {
    int x=0, y=0, dx = 0, dy = -1;
    int t = Math.max(X,Y);
    int maxI = t*t;

    for (int i=0; i < maxI; i++){
        if ((-X/2 <= x) && (x <= X/2) && (-Y/2 <= y) && (y <= Y/2)) {
            System.out.println(x+","+y);
            //DO STUFF
        }

        if( (x == y) || ((x < 0) && (x == -y)) || ((x > 0) && (x == 1-y))) {
            t=dx; dx=-dy; dy=t;
        }   
        x+=dx; y+=dy;
    }
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2015-08-06T20:02:59.400

这是一个 C++ 解决方案，它表明您可以直接轻松地从以前的坐标计算下一个 (x, y) 坐标 - 无需跟踪当前方向、半径或其他任何内容：

```
void spiral(const int M, const int N)
{
    // Generate an Ulam spiral centered at (0, 0).
    int x = 0;
    int y = 0;

    int end = max(N, M) * max(N, M);
    for(int i = 0; i < end; ++i)
    {
        // Translate coordinates and mask them out.
        int xp = x + N / 2;
        int yp = y + M / 2;
        if(xp >= 0 && xp < N && yp >= 0 && yp < M)
            cout << xp << '\t' << yp << '\n';

        // No need to track (dx, dy) as the other examples do:
        if(abs(x) <= abs(y) && (x != y || x >= 0))
            x += ((y >= 0) ? 1 : -1);
        else
            y += ((x >= 0) ? -1 : 1);
    }
} 
```

如果您要做的只是生成螺旋中的前 N ​​个点（没有原始问题对 N x M 区域的屏蔽约束），则代码变得非常简单：

```
void spiral(const int N)
{
    int x = 0;
    int y = 0;
    for(int i = 0; i < N; ++i)
    {
        cout << x << '\t' << y << '\n';
        if(abs(x) <= abs(y) && (x != y || x >= 0))
            x += ((y >= 0) ? 1 : -1);
        else
            y += ((x >= 0) ? -1 : 1);
    }
} 
```

诀窍是您可以比较 x 和 y 以确定您在正方形的哪一侧，并告诉您向哪个方向移动。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-07-28T20:34:42.150

TDD，在 Java 中。

SpiralTest.java：

```
import java.awt.Point;
import java.util.List;

import junit.framework.TestCase;

public class SpiralTest extends TestCase {

    public void test3x3() throws Exception {
        assertEquals("(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1)", strung(new Spiral(3, 3).spiral()));
    }

    public void test5x3() throws Exception {
        assertEquals("(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1) (2, -1) (2, 0) (2, 1) (-2, 1) (-2, 0) (-2, -1)",
                strung(new Spiral(5, 3).spiral()));
    }

    private String strung(List<Point> points) {
        StringBuffer sb = new StringBuffer();
        for (Point point : points)
            sb.append(strung(point));
        return sb.toString().trim();
    }

    private String strung(Point point) {
        return String.format("(%s, %s) ", point.x, point.y);
    }

} 
```

螺旋.java：

```
import java.awt.Point;
import java.util.ArrayList;
import java.util.List;

public class Spiral {
    private enum Direction {
    E(1, 0) {Direction next() {return N;}},
    N(0, 1) {Direction next() {return W;}},
    W(-1, 0) {Direction next() {return S;}},
    S(0, -1) {Direction next() {return E;}},;

        private int dx;
        private int dy;

        Point advance(Point point) {
            return new Point(point.x + dx, point.y + dy);
        }

        abstract Direction next();

        Direction(int dx, int dy) {
            this.dx = dx;
            this.dy = dy;
        }
    };
    private final static Point ORIGIN = new Point(0, 0);
    private final int   width;
    private final int   height;
    private Point       point;
    private Direction   direction   = Direction.E;
    private List<Point> list = new ArrayList<Point>();

    public Spiral(int width, int height) {
        this.width = width;
        this.height = height;
    }

    public List<Point> spiral() {
        point = ORIGIN;
        int steps = 1;
        while (list.size() < width * height) {
            advance(steps);
            advance(steps);
            steps++;
        }
        return list;
    }

    private void advance(int n) {
        for (int i = 0; i < n; ++i) {
            if (inBounds(point))
                list.add(point);
            point = direction.advance(point);
        }
        direction = direction.next();
    }

    private boolean inBounds(Point p) {
        return between(-width / 2, width / 2, p.x) && between(-height / 2, height / 2, p.y);
    }

    private static boolean between(int low, int high, int n) {
        return low <= n && n <= high;
    }
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-29T20:07:37.897

这是我的解决方案（在 Ruby 中）

```
def spiral(xDim, yDim)
   sx = xDim / 2
   sy = yDim / 2

   cx = cy = 0
   direction = distance = 1

   yield(cx,cy)
   while(cx.abs <= sx || cy.abs <= sy)
      distance.times { cx += direction; yield(cx,cy) if(cx.abs <= sx && cy.abs <= sy); } 
      distance.times { cy += direction; yield(cx,cy) if(cx.abs <= sx && cy.abs <= sy); } 
      distance += 1
      direction *= -1
   end
end

spiral(5,3) { |x,y|
   print "(#{x},#{y}),"
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-06-03T21:45:45.513

哈斯克尔，任你选择：

```
spiral x y = (0, 0) : concatMap ring [1 .. max x' y'] where
    ring n | n > x' = left x' n  ++ right x' (-n)
    ring n | n > y' = up   n  y' ++ down (-n) y'
    ring n          = up n n ++ left n n ++ down n n ++ right n n
    up    x y = [(x, n) | n <- [1-y .. y]]; down = (.) reverse . up
    right x y = [(n, y) | n <- [1-x .. x]]; left = (.) reverse . right
    (x', y') = (x `div` 2, y `div` 2)

spiral x y = filter (\(x',y') -> 2*abs x' <= x && 2*abs y' <= y) .
             scanl (\(a,b) (c,d) -> (a+c,b+d)) (0,0) $
             concat [ (:) (1,0) . tail 
                    $ concatMap (replicate n) [(0,1),(-1,0),(0,-1),(1,0)]
                    | n <- [2,4..max x y] ] 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2019-06-13T06:49:19.443

你的问题看起来像一个叫做螺旋记忆的问题。在那个问题中，网格上的每个正方形都以螺旋图案分配，从位于原点的数字 1 开始。然后在向外盘旋的同时向上计数。例如：

```
17  16  15  14  13

18   5   4   3  12

19   6   1   2  11

20   7   8   9  10

21  22  23  ----> 
```

我在下面发布了用于计算遵循此螺旋模式的每个数字的坐标的解决方案：

```
def spiral_pattern(num):
    x = y = 0
    for _ in range(num-1):
        x, y = find_next(x, y)
    yield (x, y)

def find_next(x, y):
    """find the coordinates of the next number"""
    if x == 0 and y == 0:
        return 1, 0

    if abs(x) == abs(y):
        if x > 0 and y > 0:
            x, y = left(x, y)
        elif x < 0 and y > 0:
            x, y = down(x, y)
        elif x < 0 and y < 0:
            x, y = right(x, y)
        elif x > 0 and y < 0:
            x, y = x+1, y
    else:
        if x > y and abs(x) > abs(y):
            x, y = up(x, y)
        elif x < y and abs(x) < abs(y):
            x, y = left(x, y)
        elif x < y and abs(x) > abs(y):
            x, y = down(x, y)
        elif x > y and abs(x) < abs(y):
            x, y = right(x, y)

    return x, y

def up(x, y):
    return x, y+1

def down(x, y):
    return x, y-1

def left(x, y):
    return x-1, y

def right(x, y):
    return x+1, y 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-07-09T23:58:32.470

这是在 C 中。

我碰巧选择了错误的变量名。在名称中 T == top, L == left, B == bottom, R == right。所以，tli 是左上 i，brj 是右下 j。

```
#include<stdio.h>

typedef enum {
   TLTOR = 0,
   RTTOB,
   BRTOL,
   LBTOT
} Direction;

int main() {
   int arr[][3] = {{1,2,3},{4,5,6}, {7,8,9}, {10,11,12}};
   int tli = 0, tlj = 0, bri = 3, brj = 2;
   int i;
   Direction d = TLTOR;

   while (tli < bri || tlj < brj) {
     switch (d) {
     case TLTOR:
    for (i = tlj; i <= brj; i++) {
       printf("%d ", arr[tli][i]);
    }
    tli ++;
    d = RTTOB;
    break;
     case RTTOB:
    for (i = tli; i <= bri; i++) {
       printf("%d ", arr[i][brj]);
    }
    brj --;
    d = BRTOL;
    break;
     case BRTOL:
    for (i = brj; i >= tlj; i--) {
       printf("%d ", arr[bri][i]);
    }
    bri --;
        d = LBTOT;
    break;
     case LBTOT:
    for (i = bri; i >= tli; i--) {
       printf("%d ", arr[i][tlj]);
    }
    tlj ++;
        d = TLTOR;
    break;
 }
   }
   if (tli == bri == tlj == brj) {
      printf("%d\n", arr[tli][tlj]);
   }
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-08-09T02:45:51.083

我有一个开源库**[pixelscan](https://github.com/dpmcmlxxvi/pixelscan)**，这是一个 python 库，它提供了以各种空间模式扫描网格上的像素的功能。包括的空间模式是圆形、环形、网格、蛇形和随机游走。还有各种转换（例如，剪辑、交换、旋转、平移）。原来的OP问题可以解决如下

```
for x, y in clip(swap(ringscan(0, 0, 0, 2)), miny=-1, maxy=1):
    print x, y 
```

这产生了点

```
(0,0) (1,0) (1,1) (0,1) (-1,1) (-1,0) (-1,-1) (0,-1) (1,-1) (2,0) (2,1) (-2,1) (-2,0)
(-2,-1) (2,-1) 
```

库生成器和转换可以链接起来以各种顺序和空间模式更改点。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-03-04T15:11:41.470

这是 Python 3 中的一个解决方案，用于以顺时针和逆时针方向以螺旋方式打印连续整数。

```
import math

def sp(n): # spiral clockwise
    a=[[0 for x in range(n)] for y in range(n)]
    last=1
    for k in range(n//2+1):
      for j in range(k,n-k):
          a[k][j]=last
          last+=1
      for i in range(k+1,n-k):
          a[i][j]=last
          last+=1
      for j in range(n-k-2,k-1,-1):
          a[i][j]=last
          last+=1
      for i in range(n-k-2,k,-1):
          a[i][j]=last
          last+=1

    s=int(math.log(n*n,10))+2 # compute size of cell for printing
    form="{:"+str(s)+"}"
    for i in range(n):
        for j in range(n):
            print(form.format(a[i][j]),end="")
        print("")

sp(3)
# 1 2 3
# 8 9 4
# 7 6 5

sp(4)
#  1  2  3  4
# 12 13 14  5
# 11 16 15  6
# 10  9  8  7

def sp_cc(n): # counterclockwise
    a=[[0 for x in range(n)] for y in range(n)]
    last=1
    for k in range(n//2+1):
      for j in range(n-k-1,k-1,-1):
          a[n-k-1][j]=last
          last+=1
      for i in range(n-k-2,k-1,-1):
          a[i][j]=last
          last+=1
      for j in range(k+1,n-k):
          a[i][j]=last
          last+=1
      for i in range(k+1,n-k-1):
          a[i][j]=last
          last+=1

    s=int(math.log(n*n,10))+2 # compute size of cell for printing
    form="{:"+str(s)+"}"
    for i in range(n):
        for j in range(n):
            print(form.format(a[i][j]),end="")
        print("")

sp_cc(5)
#  9 10 11 12 13
#  8 21 22 23 14
#  7 20 25 24 15
#  6 19 18 17 16
#  5  4  3  2  1 
```

**解释**

螺旋由同心正方形组成，例如顺时针旋转的 5x5 正方形如下所示：

```
 5x5        3x3      1x1

>>>>>
^   v       >>>
^   v   +   ^ v   +   >
^   v       <<<
<<<<v 
```

（`>>>>>`表示“向右走 5 次”或将列索引增加 5 次，`v`表示向下或增加行索引等）

所有正方形的大小都相同，我在同心正方形上循环。

对于每个方块，代码有四个循环（每边一个），在每个循环中我们增加或减少列或行索引。如果`i`是行索引和`j`列索引，则可以通过以下方式构造 5x5 正方形： -`j`从 0 递增到 4（5 次） -`i`从 1 递增到 4（4 次） -`j`从 3 递减到 0（4 次） - 递减`i`从 3 到 1（3 次）

对于下一个正方形（3x3 和 1x1），我们做同样的事情，但适当地移动初始和最终索引。我为每个同心正方形使用了一个索引`k`，有 n//2 + 1 个同心正方形。

最后，一些关于漂亮打印的数学。

**要打印索引：**

```
def spi_cc(n): # counter-clockwise
    a=[[0 for x in range(n)] for y in range(n)]
    ind=[]
    last=n*n
    for k in range(n//2+1):
      for j in range(n-k-1,k-1,-1):
          ind.append((n-k-1,j))
      for i in range(n-k-2,k-1,-1):
          ind.append((i,j))
      for j in range(k+1,n-k):
          ind.append((i,j))
      for i in range(k+1,n-k-1):
          ind.append((i,j))

    print(ind)

spi_cc(5) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-09-06T18:35:44.440

这是c#，linq'ish。

```
public static class SpiralCoords
{
  public static IEnumerable<Tuple<int, int>> GenerateOutTo(int radius)
  {
    //TODO trap negative radius.  0 is ok.

    foreach(int r in Enumerable.Range(0, radius + 1))
    {
      foreach(Tuple<int, int> coord in GenerateRing(r))
      {
        yield return coord;
      }
    }
  }

  public static IEnumerable<Tuple<int, int>> GenerateRing(int radius)
  {
    //TODO trap negative radius.  0 is ok.

    Tuple<int, int> currentPoint = Tuple.Create(radius, 0);
    yield return Tuple.Create(currentPoint.Item1, currentPoint.Item2);

    //move up while we can
    while (currentPoint.Item2 < radius)
    {
      currentPoint.Item2 += 1;
      yield return Tuple.Create(currentPoint.Item1, currentPoint.Item2);
    }
    //move left while we can
    while (-radius < currentPoint.Item1)
    {
      currentPoint.Item1 -=1;
      yield return Tuple.Create(currentPoint.Item1, currentPoint.Item2);    
    }
    //move down while we can
    while (-radius < currentPoint.Item2)
    {
      currentPoint.Item2 -= 1;
      yield return Tuple.Create(currentPoint.Item1, currentPoint.Item2);
    }
    //move right while we can
    while (currentPoint.Item1 < radius)
    {
      currentPoint.Item1 +=1;
      yield return Tuple.Create(currentPoint.Item1, currentPoint.Item2);    
    }
    //move up while we can
    while (currentPoint.Item2 < -1)
    {
      currentPoint.Item2 += 1;
      yield return Tuple.Create(currentPoint.Item1, currentPoint.Item2);
    }
  }

} 
```

问题的第一个示例（3x3）是：

```
var coords = SpiralCoords.GenerateOutTo(1); 
```

问题的第二个示例（5x3）是：

```
var coords = SpiralCoords.GenerateOutTo(2).Where(x => abs(x.Item2) < 2); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-09-06T17:35:46.190

这是一个略有不同的版本 - 尝试在 LUA中使用`recursion`和。`iterators`在每一步，程序都会在矩阵内部进一步下降并循环。我还在螺旋`clockwise`或`anticlockwise`. 输出从右下角开始，向中心递归循环。

```
local row, col, clockwise

local SpiralGen
SpiralGen = function(loop)  -- Generator of elements in one loop
    local startpos = { x = col - loop, y = row - loop }
    local IteratePosImpl = function() -- This function calculates returns the cur, next position in a loop. If called without check, it loops infinitely

        local nextpos = {x = startpos.x, y = startpos.y}        
        local step = clockwise and {x = 0, y = -1} or { x = -1, y = 0 }

        return function()

            curpos = {x = nextpos.x, y = nextpos.y}
            nextpos.x = nextpos.x + step.x
            nextpos.y = nextpos.y + step.y
            if (((nextpos.x == loop or nextpos.x == col - loop + 1) and step.y == 0) or 
                ((nextpos.y == loop or nextpos.y == row - loop + 1) and step.x == 0)) then --Hit a corner in the loop

                local tempstep = {x = step.x, y = step.y}
                step.x = clockwise and tempstep.y or -tempstep.y
                step.y = clockwise and -tempstep.x or tempstep.x
                -- retract next step with new step
                nextpos.x = curpos.x + step.x 
                nextpos.y = curpos.y + step.y

            end         
            return curpos, nextpos
        end
    end
    local IteratePos = IteratePosImpl() -- make an instance
    local curpos, nextpos = IteratePos()
    while (true) do
        if(nextpos.x == startpos.x and nextpos.y == startpos.y) then            
            coroutine.yield(curpos)
            SpiralGen(loop+1) -- Go one step inner, since we're done with this loop
            break -- done with inner loop, get out
        else
            if(curpos.x < loop + 1 or curpos.x > col - loop or curpos.y < loop + 1 or curpos.y > row - loop) then
                break -- done with all elemnts, no place to loop further, break out of recursion
            else
                local curposL = {x = curpos.x, y = curpos.y}
                curpos, nextpos = IteratePos()
                coroutine.yield(curposL)
            end
        end     
    end 
end

local Spiral = function(rowP, colP, clockwiseP)
    row = rowP
    col = colP
    clockwise = clockwiseP
    return coroutine.wrap(function() SpiralGen(0) end) -- make a coroutine that returns all the values as an iterator
end

--test
for pos in Spiral(10,2,true) do
    print (pos.y, pos.x)
end

for pos in Spiral(10,9,false) do
    print (pos.y, pos.x)
end 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-06-26T13:20:57.920

//PHP实现

```
function spiral($n) {

    $r = intval((sqrt($n + 1) - 1) / 2) + 1;

    // compute radius : inverse arithmetic sum of 8+16+24+...=
    $p = (8 * $r * ($r - 1)) / 2;
    // compute total point on radius -1 : arithmetic sum of 8+16+24+...

    $en = $r * 2;
    // points by face

    $a = (1 + $n - $p) % ($r * 8);
    // compute de position and shift it so the first is (-r,-r) but (-r+1,-r)
    // so square can connect

    $pos = array(0, 0, $r);
    switch (intval($a / ($r * 2))) {
        // find the face : 0 top, 1 right, 2, bottom, 3 left
        case 0:
            $pos[0] = $a - $r;
            $pos[1] = -$r;
            break;
        case 1:
            $pos[0] = $r;
            $pos[1] = ($a % $en) - $r;
            break;
        case 2:
            $pos[0] = $r - ($a % $en);
            $pos[1] = $r;
            break;
        case 3:
            $pos[0] = -$r;
            $pos[1] = $r - ($a % $en);
            break;
    }
    return $pos;
}

for ($i = 0; $i < 168; $i++) {

    echo '<pre>';
    print_r(spiral($i));
    echo '</pre>';
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-10-20T15:06:11.943

这是针对此问题的 JavaScript (ES6) 迭代解决方案：

```
let spiralMatrix = (x, y, step, count) => {
    let distance = 0;
    let range = 1;
    let direction = 'up';

    for ( let i = 0; i < count; i++ ) {
        console.log('x: '+x+', y: '+y);
        distance++;
        switch ( direction ) {
            case 'up':
                y += step;
                if ( distance >= range ) {
                    direction = 'right';
                    distance = 0;
                }
                break;
            case 'right':
                x += step;
                if ( distance >= range ) {
                    direction = 'bottom';
                    distance = 0;
                    range += 1;
                }
                break;
            case 'bottom':
                y -= step;
                if ( distance >= range ) {
                    direction = 'left';
                    distance = 0;
                }
                break;
            case 'left':
                x -= step;
                if ( distance >= range ) {
                    direction = 'up';
                    distance = 0;
                    range += 1;
                }
                break;
            default:
                break;
        }
    }
} 
```

以下是如何使用它：

`spiralMatrix(0, 0, 1, 100);`

这将创建一个向外的螺旋，从坐标 (x = 0, y = 0) 开始，步长为 1，项目总数等于 100。实现始终按以下顺序开始移动 - 上、右、下，左。

请注意，此实现创建方阵。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-12-06T16:53:45.960

这是 Julia 的答案：我的方法是在原点周围分配同心正方形（“螺旋”）中的点`(0,0)`，其中每个正方形都有边长`m = 2n + 1`，以生成一个以位置编号（从 1 开始作为原点）作为键的有序字典和相应的坐标作为值。

由于每个螺旋的最大位置在`(n,-n)`，其余点可以通过简单地从该点向后工作来找到，即从右下角按`m-1`单位，然后重复垂直的 3 段`m-1`单位。

这个过程在下面以相反的顺序编写，对应于螺旋如何进行而不是这个反向计数过程，即`ra`[右升]段递减`3(m+1)`，然后`la`[左升]段递减`2(m+1)`，依此类推——希望这是不言自明的.

```
import DataStructures: OrderedDict, merge

function spiral(loc::Int)
    s = sqrt(loc-1) |> floor |> Int
    if s % 2 == 0
        s -= 1
    end
    s = (s+1)/2 |> Int
    return s
end

function perimeter(n::Int)
    n > 0 || return OrderedDict([1,[0,0]])
    m = 2n + 1 # width/height of the spiral [square] indexed by n
    # loc_max = m^2
    # loc_min = (2n-1)^2 + 1
    ra = [[m^2-(y+3m-3), [n,n-y]] for y in (m-2):-1:0]
    la = [[m^2-(y+2m-2), [y-n,n]] for y in (m-2):-1:0]
    ld = [[m^2-(y+m-1), [-n,y-n]] for y in (m-2):-1:0]
    rd = [[m^2-y, [n-y,-n]] for y in (m-2):-1:0]
    return OrderedDict(vcat(ra,la,ld,rd))
end

function walk(n)
    cds = OrderedDict(1 => [0,0])
    n > 0 || return cds
    for i in 1:n
        cds = merge(cds, perimeter(i))
    end
    return cds
end 
```

因此，对于您的第一个示例，插入`m = 3`等式以查找 n 给出`n = (5-1)/2 = 2`，并将位置的有序字典提供给坐标，您可以通过访问字典的字段`walk(2)`将其变成坐标数组：`vals`

```
walk(2)
DataStructures.OrderedDict{Any,Any} with 25 entries:
  1  => [0,0]
  2  => [1,0]
  3  => [1,1]
  4  => [0,1]
  ⋮  => ⋮

[(co[1],co[2]) for co in walk(2).vals]
25-element Array{Tuple{Int64,Int64},1}:
 (0,0)  
 (1,0)  
 ⋮       
 (1,-2) 
 (2,-2) 
```

请注意，对于某些函数 [例如`norm`]，最好将坐标保留在数组中，而不是`Tuple{Int,Int}`，但这里我根据要求使用列表推导将它们更改为元组——<code>(x,y)。

未指定“支持”非方阵的上下文（请注意，此解决方案仍会计算离网值），但如果您想在计算完整螺旋后仅过滤`x`到`y`（此处为`x=5`, ）的范围`y=3`然后`intersect`这个矩阵针对来自 的值`walk`。

```
grid = [[x,y] for x in -2:2, y in -1:1]
5×3 Array{Array{Int64,1},2}:
 [-2,-1]  [-2,0]  [-2,1]
   ⋮       ⋮       ⋮ 
 [2,-1]   [2,0]   [2,1]

[(co[1],co[2]) for co in intersect(walk(2).vals, grid)]
15-element Array{Tuple{Int64,Int64},1}:
 (0,0)  
 (1,0)  
 ⋮ 
 (-2,0) 
 (-2,-1) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-10-12T22:17:11.753

这是基于您自己的解决方案，但我们可以更聪明地找到角落。如果 M 和 N 非常不同，这使您更容易看到如何跳过外部区域。

```
def spiral(X, Y):
    x = y = 0
    dx = 0
    dy = -1
    s=0
    ds=2
    for i in range(max(X, Y)**2):
            if abs(x) <= X and abs(y) <= Y/2:
                    print (x, y)
                    # DO STUFF...
            if i==s:
                    dx, dy = -dy, dx
                    s, ds = s+ds/2, ds+1
            x, y = x+dx, y+dy 
```

以及比 O(max(n,m)^2) 更好的基于生成器的解决方案，它是 O(nm+abs(nm)^2)，因为如果它们不是解决方案的一部分，它会跳过整个条带。

```
def spiral(X,Y):
X = X+1>>1
Y = Y+1>>1
x = y = 0
d = side = 1
while x<X or y<Y:
    if abs(y)<Y:
        for x in range(x, x+side, d):
            if abs(x)<X: yield x,y
        x += d
    else:
        x += side
    if abs(x)<X:
        for y in range(y, y+side, d):
            if abs(y)<Y: yield x,y
        y += d
    else:
        y += side
    d =-d
    side = d-side 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-03-15T04:05:57.540

```
Here is my attempt for simple C solution. First print the outer spiral and move one block inside..and repeat.

#define ROWS        5
#define COLS        5
//int A[ROWS][COLS] = { {1, 2, 3, 4}, {5, 6, 7, 8}, {11, 12, 13, 14}, {15, 16, 17, 18} };
//int A[ROWS][COLS] = { {1, 2, 3}, {6, 7, 8}, { 12, 13, 14} };
//int A[ROWS][COLS] = { {1, 2}, {3, 4}};

int A[ROWS][COLS] = { {1, 2, 3, 4, 5}, {6, 7, 8, 9, 10}, {11, 12, 13, 14, 15} , {16, 17, 18, 19, 20}, {21, 22, 23, 24, 25} };

void print_spiral(int rows, int cols)
{
    int row = 0;
    int offset = 0;

    while (offset < (ROWS - 1)) {
        /* print one outer loop at a time. */
        for (int col = offset; col <= cols; col++) {
            printf("%d ", A[offset][col]);
        }

        for (row = offset + 1; row <= rows; row++) {
            printf("%d ", A[row][cols]);
        }

        for (int col = cols - 1; col >= offset; col--) {
            printf("%d ", A[rows][col]);
        }

        for (row = rows - 1; row >= offset + 1; row--) {
            printf("%d ", A[row][offset]);
        }

       /* Move one block inside */
        offset++;
        rows--;
        cols--;
    }
    printf("\n");
}

int _tmain(int argc, _TCHAR* argv[])
{
    print_spiral(ROWS-1, COLS-1);
    return 0;
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-04-04T11:13:56.110

这是我非常非常糟糕的解决方案，由对 Java 的最低限度的了解。在这里，我必须将单位以螺旋形式放置在场上。单位不能放置在其他单位的顶部或山上或海洋中。

**要清楚。这不是一个好的解决方案。这是一个非常糟糕的解决方案，增加了其他人的乐趣，以嘲笑它可以做得多么糟糕**

```
private void unitPlacementAlgorithm(Position p, Unit u){
    int i = p.getRow();
    int j = p.getColumn();

    int iCounter = 1;
    int jCounter = 0;

    if (getUnitAt(p) == null) {
            unitMap.put(p, u);
    } else {
        iWhileLoop(i, j, iCounter, jCounter, -1, u);
    }

}

private void iWhileLoop(int i, int j, int iCounter, int jCounter, int fortegn, Unit u){
    if(iCounter == 3) {
        for(int k = 0; k < 3; k++) {
            if(k == 2) { //This was added to make the looping stop after 9 units
                System.out.println("There is no more room around the city");
                return; 
            }
            i--;

            if (getUnitAt(new Position(i, j)) == null 
                && !(getTileAt(new Position(i, j)).getTypeString().equals(GameConstants.OCEANS)) 
                && !(getTileAt(new Position(i, j)).getTypeString().equals(GameConstants.MOUNTAINS))) {
                    unitMap.put(new Position(i, j), u);
                    return;
            }
            iCounter--;
        }
    }

    while (iCounter > 0) {
        if (fortegn > 0) {
            i++;
        } else {
            i--;
        }

        if (getUnitAt(new Position(i, j)) == null 
            && !(getTileAt(new Position(i, j)).getTypeString().equals(GameConstants.OCEANS)) 
            && !(getTileAt(new Position(i, j)).getTypeString().equals(GameConstants.MOUNTAINS))) {
                unitMap.put(new Position(i, j), u);
                return;
        }
        iCounter--;
        jCounter++;
    }
    fortegn *= -1;
    jWhileLoop(i, j, iCounter, jCounter, fortegn, u);
}

private void jWhileLoop(int i, int j, int iCounter, int jCounter,
        int fortegn, Unit u) {
    while (jCounter > 0) {
        if (fortegn > 0) {
            j++;
        } else {
            j--;
        }

        if (getUnitAt(new Position(i, j)) == null 
            && !(getTileAt(new Position(i, j)).getTypeString().equals(GameConstants.OCEANS)) 
            && !(getTileAt(new Position(i, j)).getTypeString().equals(GameConstants.MOUNTAINS))) {
                unitMap.put(new Position(i, j), u);
                return;

        }
        jCounter--;
        iCounter++;
        if (jCounter == 0) {
            iCounter++;
        }

    }
    iWhileLoop(i, j, iCounter, jCounter, fortegn, u);
} 
```

感谢任何真正能读到这篇文章的人

**额外问题：这个“算法”的运行时间是多少？:P**

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-12-29T19:16:01.847

AutoIt 解决方案

```
#include <Math.au3>
#include <Array.au3>

Func SpiralSearch($xMax,$yMax)
    $x = 0
    $y = 0
    $dx = 0
    $dy = -1
    for $i=0 To _max($xMax, $yMax)^2-1 Step 1
        if -$xMax/2 < $x and $x <= $xMax/2 And -$yMax/2 < $y And $y <= $yMax/2 Then
            MsgBox(0, "We are here ", $x & " " & $y)
        EndIf
        if $x == $y or ($x < 0 and $x == -$y) or ($x > 0 and $x == 1-$y) Then
            _ArraySwap ($dx, $dy)
            $dx=-$dx
        EndIf
        $x += $dx
        $y += $dy
    Next
EndFunc 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-06-26T04:36:51.927

我最近遇到了类似的挑战，我必须创建一个二维数组并使用螺旋矩阵算法对结果进行排序和打印。此 C# 代码适用于 N,N 二维数组。为了清楚起见，它很冗长，并且可能会根据您的需要进行重构。

```
//CREATE A NEW MATRIX OF SIZE 4 ROWS BY 4 COLUMNS - SCALE MATRIX SIZE HERE
SpiralMatrix SM = new SpiralMatrix(4, 4);
string myData = SM.Read();

public class SpiralMatrix
{
    //LETS BUILD A NEW MATRIX EVERY TIME WE INSTANTIATE OUR CLASS
    public SpiralMatrix(int Rows, int Cols)
    {
        Matrix = new String[Rows, Cols];

        int pos = 1;
        for(int r = 0; r<Rows; r++){
            for (int c = 0; c < Cols; c++)
            {
                //POPULATE THE MATRIX WITH THE CORRECT ROW,COL COORDINATE
                Matrix[r, c] = pos.ToString();
                pos++;
            }
        }
    }

    //READ MATRIX
    public string Read()
    {
        int Row = 0;
        int Col = 0;

        string S = "";
        bool isDone = false;

        //CHECK tO SEE IF POSITION ZERO IS AVAILABLE
        if(PosAvailable(Row, Col)){
            S = ConsumePos(Row, Col);
        }

        //START READING SPIRAL
        //THIS BLOCK READS A FULL CYCLE OF RIGHT,DOWN,LEFT,UP EVERY ITERATION
        while(!isDone)
        {
            bool goNext = false;

            //READ ALL RIGHT SPACES ON THIS PATH PROGRESSION
            while (PosAvailable(Row, Col+1))
            {
                //Is ReadRight Avail
                Col++;
                S += ConsumePos(Row, Col);
                goNext = true;
            }

            //READ ALL DOWN SPACES ON THIS PATH PROGRESSION
            while(PosAvailable(Row+1, Col)){
                //Is ReadDown Avail
                Row++;
                S += ConsumePos(Row, Col);
                goNext = true;
            }

            //READ ALL LEFT SPACES ON THIS PATH PROGRESSION
            while(PosAvailable(Row, Col-1)){
                //Is ReadLeft Avail
                Col--;
                S += ConsumePos(Row, Col);
                goNext = true;
            }

            //READ ALL UP SPACES ON THIS PATH PROGRESSION
            while(PosAvailable(Row-1, Col)){
                //Is ReadUp Avail
                Row--;
                S += ConsumePos(Row, Col);
                goNext = true;
            }

            if(!goNext){
                //DONE - SET EXIT LOOP FLAG
                isDone = true;
            }
        }

        return S;
    }

    //DETERMINE IF THE POSITION IS AVAILABLE
    public bool PosAvailable(int Row, int Col)
    {
        //MAKE SURE WE ARE WITHIN THE BOUNDS OF THE ARRAY
        if (Row < Matrix.GetLength(0) && Row >= 0
            && Col < Matrix.GetLength(1) && Col >= 0)
        {
            //CHECK COORDINATE VALUE
            if (Matrix[Row, Col] != ConsumeChar)
                return true;
            else
                return false;
        }
        else
        {
            //WE ARE OUT OF BOUNDS
            return false;
        }
    }

    public string ConsumePos(int Row, int Col)
    {
        string n = Matrix[Row, Col];
        Matrix[Row, Col] = ConsumeChar;
        return n;
    }

    public string ConsumeChar = "X";
    public string[,] Matrix;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-09-10T00:41:25.940

我和一个朋友一起做了这个，他在 Javascript 上将螺旋线调整为画布纵横比。我得到的最佳解决方案是逐像素地进行图像演化，填充整个图像。

希望它对某人有所帮助。

```
var width = 150;
var height = 50;

var x = -(width - height)/2;
var y = 0;
var dx = 1;
var dy = 0;
var x_limit = (width - height)/2;
var y_limit = 0;
var counter = 0;

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext('2d');

setInterval(function(){
   if ((-width/2 < x && x <= width/2)  && (-height/2 < y && y <= height/2)) {
       console.log("[ " + x + " , " +  y + " ]");
       ctx.fillStyle = "#FF0000";
       ctx.fillRect(width/2 + x, height/2 - y,1,1);
   }
   if( dx > 0 ){//Dir right
       if(x > x_limit){
           dx = 0;
           dy = 1;
       }
   }
   else if( dy > 0 ){ //Dir up
       if(y > y_limit){
           dx = -1;
           dy = 0;
       }
   }
   else if(dx < 0){ //Dir left
       if(x < (-1 * x_limit)){
           dx = 0;
           dy = -1;
       }
   }
   else if(dy < 0) { //Dir down
       if(y < (-1 * y_limit)){
           dx = 1;
           dy = 0;
           x_limit += 1;
           y_limit += 1;
       }
   }
   counter += 1;
   //alert (counter);
   x += dx;
   y += dy;      
}, 1); 
```

您可以在[http://jsfiddle.net/hitbyatruck/c4Kd6/](http://jsfiddle.net/hitbyatruck/c4Kd6/)上看到它。请务必更改 javascript vars 和 HTML 属性上的画布的宽度和高度。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-10-21T02:00:23.763

只是为了好玩 Javascript：

```
function spiral(x, y) {
  var iy = ix = 0
    , hr = (x - 1) / 2
    , vr = (y - 1) / 2
    , tt = x * y
    , matrix = []
    , step = 1
    , dx = 1
    , dy = 0;

  while(matrix.length < tt) {

    if((ix <= hr && ix >= (hr * -1)) && (iy <= vr && (iy >= (vr * -1)))) {
      console.log(ix, iy);
      matrix.push([ix, iy]);
    }

    ix += dx;
    iy += dy;

    // check direction
    if(dx !== 0) {
      // increase step
      if(ix === step && iy === (step * -1)) step++;

      // horizontal range reached
      if(ix === step || (ix === step * -1)) {
        dy = (ix === iy)? (dx * -1) : dx;
        dx = 0;  
      }
    } else {
      // vertical range reached
      if(iy === step || (iy === step * -1)) {
        dx = (ix === iy)? (dy * -1) : dy;
        dy = 0;
      }
    }
  }

  return matrix;
}

var sp = spiral(5, 3); 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-07-18T15:40:57.527

C# 版本，也处理非正方形大小。

```
private static Point[] TraverseSpiral(int width, int height) {
    int numElements = width * height + 1;
    Point[] points = new Point[numElements];

    int x = 0;
    int y = 0;
    int dx = 1;
    int dy = 0;
    int xLimit = width - 0;
    int yLimit = height - 1;
    int counter = 0;

    int currentLength = 1;
    while (counter < numElements) {
        points[counter] = new Point(x, y);

        x += dx;
        y += dy;

        currentLength++;
        if (dx > 0) {
            if (currentLength >= xLimit) {
                dx = 0;
                dy = 1;
                xLimit--;
                currentLength = 0;
            }
        } else if (dy > 0) {
            if (currentLength >= yLimit) {
                dx = -1;
                dy = 0;
                yLimit--;
                currentLength = 0;
            }
        } else if (dx < 0) {
            if (currentLength >= xLimit) {
                dx = 0;
                dy = -1;
                xLimit--;
                currentLength = 0;
            }
        } else if (dy < 0) {
            if (currentLength >= yLimit) {
                dx = 1;
                dy = 0;
                yLimit--;
                currentLength = 0;
            }
        }

        counter++;
    }

    Array.Reverse(points);
    return points;
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-08-17T00:36:30.787

我正在分享我为不同目的设计的这段代码；它是关于查找列号“X”和数组元素@螺旋索引“索引”的行号“Y”。该函数采用矩阵的宽度“w”和高度“h”，以及所需的“索引”。当然，这个函数可以用来产生同样需要的输出。我认为这是最快的方法（因为它跳过单元格而不是扫描它们）。

```
 rec BuildSpiralIndex(long w, long h, long index = -1)
    {  
        long count = 0 , x = -1,  y = -1, dir = 1, phase=0, pos = 0,                            length = 0, totallength = 0;
        bool isVertical = false;
        if(index>=(w*h)) return null;

        do 
        {                
            isVertical = (count % 2) != 0;
            length = (isVertical ? h : w) - count/2 - count%2 ;
            totallength += length;
            count++;
        } while(totallength<index);

        count--; w--; h--;
        phase = (count / 4); pos = (count%4);
        x = (pos > 1 ? phase : w - phase);
        y = ((pos == 1 || pos == 2) ? h - phase : phase) + (1 * (pos == 3 ? 1 : 0));
        dir = pos > 1 ? -1 : 1;
        if (isVertical) y -= (totallength - index - 1) * dir;
        else x -= (totallength - index -1) * dir;
        return new rec { X = x, Y = y };
    } 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-09-26T17:32:46.533

[Python 使用Can Berk Güder answer](https://stackoverflow.com/a/398302/3887605)循环顺时针螺旋代码。

```
def spiral(X, Y):
    x = y = 0
    dx = 0
    dy = 1
    for i in range(max(X, Y)**2):
        if (-X/2 < x <= X/2) and (-Y/2 < y <= Y/2):
            print (x, y)
            # DO STUFF...
        if x == -y or (x < 0 and x == y) or (x > 0 and x-1 == y):
            dx, dy = dy, -dx
        x, y = x+dx, y+dy 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-11-09T11:42:49.930

Davidont 在 VB.Net 中的出色解决方案

```
 Public Function Spiral(n As Integer) As RowCol
    ' given n an index in the squared spiral
    ' p the sum of point in inner square
    ' a the position on the current square
    ' n = p + a
    ' starts with row 0 col -1
    Dim r As Integer = CInt(Math.Floor((Math.Sqrt(n + 1) - 1) / 2) + 1)

    ' compute radius : inverse arithmetic sum of 8+16+24+...=
    Dim p As Integer = (8 * r * (r - 1)) \ 2
    ' compute total point on radius -1 : arithmetic sum of 8+16+24+...

    Dim en As Integer = r * 2
    ' points by face

    Dim a As Integer = (1 + n - p) Mod (r * 8)
    ' compute the position and shift it so the first is (-r,-r) but (-r+1,-r)
    ' so square can connect

    Dim row As Integer
    Dim col As Integer

    Select Case Math.Floor(a \ (r * 2))
        ' find the face : 0 top, 1 right, 2, bottom, 3 left
        Case 0
            row = a - r
            col = -r
        Case 1
            row = r
            col = (a Mod en) - r
        Case 2
            row = r - (a Mod en)
            col = r
        Case 3
            row = -r
            col = r - (a Mod en)
    End Select

    Return New RowCol(row, col)
End Function 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-01-29T15:57:42.470

这是我在 c# 中制作方形螺旋的方法，我前一段时间做了这个，我只是想我可以添加它，因为它与其他所有不同，不是最好的，但只是一种不同的方式，我相信它可以也适用于非正方形。

这种方法我采用最大步数，而不是最大向量。

这种方法的主要内容是角落，第一步有一些调整，“进步”步骤需要走出右下角的“角落”。

```
private void Spiral(int sequence)
{
    const int x = 0;
    const int y = 1;
    int[,] matrix = new int[2, sequence];
    int dirX, dirY, prevX, prevY, curr;
    dirX = dirY = prevX = prevY = curr = default(int);

    do
    {
        if (curr > 0)
        {
            prevX = matrix[x, curr - 1];
            prevY = matrix[y, curr - 1];
        }

        //Change direction based on the corner.
        if (Math.Abs(prevX) == Math.Abs(prevY) && curr > 0)
        {
            dirX = dirY = 0;

            if (prevY > 0 && prevX > 0)
                dirX = -1;
            else if (prevY > 0 && prevX < 0)
                dirY = -1;
            else if (prevY < 0 && prevX < 0)
                dirX = 1;
            else if (prevY < 0 && prevX > 0) //Move forward
                dirX = 1;
            else if (prevY == 0 && prevX == 0) //For the first step.
                dirX = 1;
        }
        else if (prevY < 0 && prevX > 0 && (Math.Abs(matrix[x, curr - 2]) == Math.Abs(matrix[y, curr - 2]))) //Move forward
        {
            dirX = 0;
            dirY = 1;
        }
        else if (prevX == 1 && prevY == 0) //For the second step.
        {
            dirY = 1;
            dirX = 0;
        }

        matrix[x, curr] = prevX + dirX;
        matrix[y, curr] = prevY + dirY;

        System.Console.Write($"({matrix[x, curr]},{matrix[y, curr]}) ");

    } while (++curr < sequence);
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2019-05-17T11:18:53.317

这是一个 Python/numpy 解决方案，它用螺旋填充任何矩形。它解决的问题与原始问题略有不同，但这正是我所需要的。

```
import numpy as np
import matplotlib.pyplot as plt

def spiral(m, n):
    M = np.zeros([m, n], dtype=int)
    i, j = 0, 0 # location of "turtle"
    di, dj = 0, 1 # direction of movement
    h = (np.min([m,n]))/2
    for ii in range(m * n):
        M[i, j] = ii
        if (i < h and (i == j+1 or i+1 == n-j)) or (i >= m-h and (m-i == n-j or m-i == j+1)):
            di, dj = dj, -di # turn clockwise
        i, j = i + di, j + dj
    return M

plt.imshow(spiral(16, 24)) 
```

[![螺旋](https://i.stack.imgur.com/MsZgk.png)](https://i.stack.imgur.com/MsZgk.png)

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2020-09-06T07:56:13.923

一个`Kotlin`螺旋。

```
data class Point(val x: Int, val y: Int) {
    operator fun plus(p: Point): Point = Point(x + p.x, y + p.y)

    override fun toString() = "($x, $y)"

    companion object {
        enum class Directions(val d: Point) {
            RIGHT(Point(1, 0)),
            UP(Point(0, 1)),
            LEFT(Point(-1, 0)),
            DOWN(Point(0, -1))
        }

        fun spiral() = sequence {
            var p = Point(0, 0)
            // Always start at the origin.
            yield(p)
            // 0, 2, 4, 6 ...
            generateSequence(0) { it + 2 }.forEach { n ->
                // For each of the 4 directions
                Directions.values().forEach { d ->
                    // actual length depends slightly on direction
                    val l = n + when (d) {
                        Directions.RIGHT, Directions.UP -> 1
                        Directions.LEFT, Directions.DOWN -> 2
                    }
                    // run to the next corner
                    for (i in 1..l) {
                        p += d.d
                        yield(p)
                    }
                }
            }
        }
    }
} 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2014-09-19T13:59:47.143

我真的很喜欢这篇文章的挑战 1+。**[我用Ruby](http://en.wikipedia.org/wiki/Ruby_%28programming_language%29)** Code试过这个：

对于**3X3**方阵

```
(0..8).each do |i|
    j = Math.sqrt(i).round
    k = (j ** 2 - i).abs - j
    p = [k, -k].map {|l| (l + j ** 2 - i - (j % 2)) * 0.5 * (-1) ** j}.map(&:to_i)
    puts "(#{p[0]}, #{p[1]}) "
end 
```

**输出：**

```
(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1) 
```

* * *

如您在图片中提到的，对于**5X3**

```
iter = (0..19).to_enum
while true
    i = iter.next
    j = Math.sqrt(i).round
    k = (j ** 2 - i).abs - j
    p = [k, -k].map {|l| (l + j ** 2 - i - (j % 2)) * 0.5 * (-1) ** j}.map(&:to_i)
    print "(#{p[0]}, #{p[1]}) "
  if i == 11
    5.times {i = iter.next}
  end
end 
```

为此的输出：

```
(0, 0) (1, 0) (1, 1) (0, 1) (-1, 1) (-1, 0) (-1, -1) (0, -1) (1, -1) (2, -1) (2, 0) (2, 1) (-2, 1) (-2, 0) (-2, -1) 
```

# permissions - 负载均衡服务器上的文件上传

> ID：398305
> 
> 赞同：4
> 
> 时间：2008-12-29T18:43:05.600
> 
> 标签：permissions, file-upload, load-balancing

我有一个我开发的网络项目，其中一个主要功能是上传文件。

所有权限均基于 Windows 身份验证。当我第一次创建项目时，我没有意识到它会在负载平衡的服务器上。现在是在负载均衡服务器的环境中，文件上传已经成为一个主要问题。

我最初以为我可以只为网络共享创建一个虚拟目录作为上传文件夹，但是该解决方案已变成权限噩梦。我无法在生产环境中进行任何成功的测试运行。

所以我现在在想，我的解决方案是在服务器上创建一个服务来检查上传目录并同步它们。我看到的另一个可能的解决方案是将文件存储在我过去遇到过一些问题的数据库中。

有谁知道将文件上传到使用 Windows 权限进行身份验证的负载平衡服务器的直接解决方案？

谢谢。

更新 - 因此，我已更改应用程序池以通过对共享具有完全权限的域帐户以及 Windows 权限中的文件夹本身运行。虚拟目录在 IIS 中具有完全权限，但我仍然遇到同样的问题。

需要做的一件事是创建目录的能力，我认为这可能会让我感到困惑。我只是在使用 System.IO.Directory.CreateDirectory

关于我可能缺少权限的任何其他想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T18:54:19.307

如果您真的想避免存储在数据库中，我认为您的下一个最佳选择是您已经谈到的虚拟目录解决方案，尽管我可以看到权限问题如何根据您的设置很容易失控。

在我们的生产环境中，我们所有不同的站点都有自己的应用程序池。应用程序池本身都有自己的域帐户，这使得管理文件系统和 SQL 服务器中的权限变得更加容易。这些帐户中的每一个都是 IIS WP 域组的成员。在集群中的每台服务器上，域 IIS WP 是本地内置 IIS_WPG 组的成员。群集中每台服务器上的 IIS 配置都是相同的。这样做的重要影响是确保给定的 Web 应用程序始终以相同的身份运行，而不管集群中的哪个服务器受到攻击。

使用我描述的设置，实现虚拟目录解决方案将非常简单，尽管您仍然需要担心其他明显的问题，例如命名冲突等。如果您仍在使用默认的应用程序池身份设置，我认为实施我所描述的内容将有助于您在处理集群配置时更轻松。

[本文列出了在文件系统中存储的一些优点和缺点：](http://imar.spaanjaars.com/QuickDocId.aspx?quickdoc=414)

> **好处**
> 
> 将文件存储在磁盘上的主要好处之一是它很容易做到。只需在 FileUpload 控件上调用 SaveAs 就可以了。
> 
> 另一个优点是磁盘上的文件易于备份；您只需将文件复制到另一个位置。这也使得增量备份更容易；已备份的文件无需再次复制。
> 
> **缺点**
> 
> 将文件存储在文件系统中也有一些缺点。可能最成问题的问题是磁盘上文件的松散耦合性质。它们与数据库中的记录没有强关系。因此，当您从数据库中删除产品时，您最终可能会得到一个孤立的产品图像。没有直接的方法可以在产品表和您的图像文件夹之间进行 INNER JOIN 以确定您留下了哪些孤立文件。这意味着页面开发人员负责编写代码，以便在关联的数据库记录被删除时从磁盘中删除文件。
> 
> 此外，要将上传的文件存储在磁盘上，您的 Web 服务器需要写入文件系统的权限。当您运行自己的服务器时，这很容易实现，但在 ISP 场景中可能会出现更多问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T19:06:33.900

您的解决方案应该可以正常工作：

1.  创建网络帐户
2.  让每台服务器上的应用程序的应用程序池在此帐户下运行
3.  在特定服务器上创建一个文件夹并授予此网络帐户权限
4.  将文件夹设置为“共享”，并授予该共享的帐户权限
5.  设置所有服务器使用该目录存储上传的文件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T21:07:19.443

供参考，

此问题的解决方案是使用有权访问共享、文件夹权限和虚拟目录权限的用户帐户进行临时模拟。

当我最初尝试这个时，我的模拟代码中有一些错误，然后在修复时输入了错误的密码，所以我放弃了这种方法。我终于尝试了其他所有方法并回到了这个 - 看起来它正在工作。

因此，在将网络共享处理为看起来像的虚拟目录时，答案就是模拟。

这是实现这一切的代码的链接：

[http://support.microsoft.com/kb/306158#4](http://support.microsoft.com/kb/306158#4)

# f# - 如何将字符串切割成给定长度的子字符串

> ID：398316
> 
> 赞同：1
> 
> 时间：2008-12-29T18:47:09.510
> 
> 标签：f#

我有一个字符串，我想将它切成给定长度 n 的子字符串数组。我对余数不感兴趣（如果字符串的长度不能除以 n 而没有余数）

```
let ChopString (myString : string) n = 
    let res = 
        seq{ 
            for i = 0 to myString.Length / n - 1 do
                yield( String.sub myString (i*n) n )
            }    
        |> Seq.to_array
    res 
```

这是我能做的最好的。在我看来很难看。

有没有更好/更短的版本，可能没有 for 循环？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-29T19:28:59.300

`stringInstance.[start..end]`比 . 更具可读性`String.sub`。这是我想出的：

```
 let chop (input : string) len = 
        seq { for start in 0 .. len .. input.Length - 1
            do yield input.[start..start + len - 1] }
        |> Seq.toArray 
```

或者您可以使用：

```
 let chop (input : string) len = 
        Array.init (input.Length / len) (fun index ->
            let start = index * len
            input.[start..start + len - 1]) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T02:08:12.880

[Craig Stunz](https://stackoverflow.com/users/7714/craig-stuntz)在这里留下了现在丢失的答案。无论如何，他指出[有关 F# 的文章](http://microsoft.apress.com/asptodayarchive/74014/introducing-f)有两个用于字符串操作的函数：`explode`和`implode`. 这两个函数来自标准 ML 库。这是代码：

```
let rec explode str = 
       let len = String.length str in
           if len=0 then [] else 
              (String.sub str 0 1) :: explode (String.sub str 1 (len-1)) 

let rec implode lst = match lst with
                         []  -> ""
                       | x1 :: x2 -> x1 ^ implode x2 
```

`explode`将字符串切成字符串列表，其中每个字符串都是一个字符。
`implode`相反 - 将字符串列表连接成一个字符串。
这两个函数都是递归的，所以比较性能会很有趣。

# .net - 为自定义类型创建 ADO.NET 映射

> ID：398325
> 
> 赞同：4
> 
> 时间：2008-12-29T18:52:53.850
> 
> 标签：.net, database

我有一个我创建的自定义类型，它应该作为 guid 保存在数据库（在本例中为 SQL 服务器）中（尽管这个问题对于可以存储为字符串、整数等的对象同样有效） .

当我将此类型作为参数传递给 DbCommand 对象时，我得到一个异常：

> ArgumentException：不存在从对象类型 [...] 到已知托管提供程序本机类型的映射。

我在类上有允许隐式转换为字符串或 guid 的 CType 运算符，但 .NET 不使用这些运算符，因为它不知道它应该转换类型。

有没有办法向内部映射添加类型，或者告诉 .NET 如何将我的自定义类型存储在数据库中？

我显然可以在将类型传递给 .NET 时自己转换类型，但我希望这会自动发生，就像大多数内置类型一样。

* * *

我尝试为我的类型实现一个 TypeConverter 类（从 TypeConverter 继承，覆盖 CanConvertFrom、CanConvertTo、ConvertFrom、ConvertTo、IsValid，并将 System.ComponentModel.TypeConverter 属性添加到我的类），但这仍然不起作用。

我假设它缺少一块告诉.NET 在将值存储在数据库中时要转换为什么类型。

* * *

目前，我的解决方法是在将参数列表传递给 SQL 服务器之前拦截参数列表，并使用一种方法将我的自定义类型更改为 guid。这很脏，但它现在确实有效，但我仍然认为这个问题没有答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-28T15:04:06.220

根据[我应该如何将用户定义的类型传递给 SqlParameterCollection.AddWithValue？](https://stackoverflow.com/questions/767072/how-should-i-pass-a-user-defined-type-to-sqlparametercollection-addwithvalue)， 这是不可能的。我也查看了 GetMetaTypeFromValue 方法，看起来所有映射实际上都是硬编码在框架中的，因此不可能有用户定义的映射。

多么烦人，拥有一个为给定类型定义映射的属性将非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-22T07:35:48.117

为了解决这个问题创建了接口：

```
 public interface ICustomDbValue
    {
        object Value { get; }
    } 
```

我为我的自定义类型实现了它。我还通过下一个代码起作用的函数包装了 SQL 命令的创建：

```
 ...
    IDbCommand command = connection.CreateCommand();
    ...
    ICustomDbValue customParam = rawData as ICustomDbValue;
    object value = customParam != null ? customParam.Value : rawData;
    IDataParameter parameter = command.CreateParameter();
    parameter.Value = value ?? DBNull.Value;
    ... 
```

我所要做的就是始终使用此函数并为我的类型实现 ICustomDbValue。它几乎看起来像使用属性。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-29T19:04:22.297

以下是 .Net 中类型转换器的一些链接

[http://msdn.microsoft.com/en-us/library/yy580hbd.aspx](http://msdn.microsoft.com/en-us/library/yy580hbd.aspx)

[http://msdn.microsoft.com/en-us/library/ayybcxe5.aspx](http://msdn.microsoft.com/en-us/library/ayybcxe5.aspx)

# version-control - 您对代码使用什么备份策略？

> ID：398332
> 
> 赞同：22
> 
> 时间：2008-12-29T18:54:23.583
> 
> 标签：version-control, backup

每个人都使用源代码控制来管理版本（对吗？），这提供了某种程度的备份。但是，有时您的本地副本与存储库不同步。此外，一些沙盒类型的项目可能还没有 ;-) 进入 SCC。

**编辑**：我的项目目录中有多个项目。并非所有都在当前开发中，但只要发现错误，其中任何一个都可能需要“修复”。从 SCC 恢复单个活跃的项目似乎完全合理。从 SCC 恢复我支持的所有几十个项目似乎不如从备份恢复并根据需要从 SCC 同步。

除了源代码控制之外，您还使用哪些备份策略来保证代码安全？

可以在[https://stackoverflow.com/questions/38388/organization-wide-backup-strategy](https://stackoverflow.com/questions/38388/organization-wide-backup-strategy)找到类似的问题，但如果您碰巧在没有总体战略。我将在答案中提供我的策略。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-29T18:57:52.700

我的策略始终是签入并备份整个存储库。

我**从不**遗漏任何东西，我确保定期备份（每天增量、每周和每月轮换）正在发生并且正常运行。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-29T19:33:32.067

在一天结束时，我将我的代码检查到源代码管理中。

在午夜左右，[Mozy](http://mozy.com/)启动并在异地备份我的代码。

在凌晨 1 点左右，SC 盒子被备份到磁带上。

在凌晨 3 点左右，[Syncback](http://www.2brightsparks.com/downloads.html) SE 醒来并将我的代码备份到外部 HD。

一整天，我的工作盒使用[Live Sync与我的家庭盒同步](https://sync.live.com/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-29T19:05:03.933

（除了远程服务器的源代码控制）我使用免费版本的 SyncBack (www.2brightsparks.com) 和这个批处理文件：（syncback.exe 的参数指定以前配置的 syncback 备份配置文件）

```
@echo off

echo Stop and start SQL Server
echo -------------------------

net stop "SQL Server (SQLEXPRESS)"
net stop "SQL Server (SQLSERVER2008)"
echo -----------------------------------------------------------
echo Back up running now... please wait.

"C:\Program Files\2BrightSparks\SyncBack\SyncBack.exe" c e-contents f-contents

echo Backing up done. Starting SQL Server...
echo -----------------------------------------------------------

net start "SQL Server (SQLEXPRESS)"
net start "SQL Server (SQLSERVER2008)"

echo -----------------------------------------------------------
echo Back up is done and SQL Server is running now.
echo -----------------------------------------------------------

pause 
```

每天有两个 8GB 闪存驱动器。在本周末，我会做同样的事情，但随后将目标放在桌面外部驱动器上。

SyncBack 很棒！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-29T19:45:03.730

OSX 的[时间机器](http://www.apple.com/macosx/features/timemachine.html)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-29T19:05:05.963

在我看来，时不时地从 SCC 重建所有内容无论如何都是一个好习惯（例如在夜间）。这样做可以确保您没有忘记将任何重要文件添加到存储库。无论如何，整个过程最多需要几个步骤。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-29T18:56:31.207

我使用[Microsoft SyncToy 2.0](http://en.wikipedia.org/wiki/SyncToy)将我的项目目录与网络共享上的文件夹同步。我有单独的计划任务，它们为各种目录运行不同的 SyncToy 脚本（按 Visual Studio 版本细分）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-29T19:09:56.937

对于除了最简单的 5 分钟测试之外的所有内容，我使用版本控制，在我的例子中是 Subversion。

我使用了一些运行 linux 的旧硬件和一个我承诺的 Subversion 服务器。然后我有一个 cron 脚本，每晚归档存储库（如果自上次更改后），并将其以邮件的形式附加到我的 gmail 帐户，正文中包含更改日志。由于 Gmail 的 20 mb 附件限制，除了最密集的二进制存储库之外，所有存储库都可以通过拆分文件进行备份。

我计划重新设计以将备份放在 Amazon S3 上，但还没有时间去做。

恕我直言，最重要的是始终在其他地方（地理上）进行备份，而不仅仅是在 USB 驱动器或其他东西上。

在非常小的 5 分钟的情况下。测试我把它们放在我的 Dropbox (www.getdropbox.com) 中。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-29T20:56:47.720

> 如果磁盘驱动器死机，没有人愿意从 SCC 重建他们的整个项目目录

嗯？我们*总是*这样做。事实上，我们有一个构建服务器，它可以从干净的结帐中不断地执行新的构建。如果从备份恢复似乎比从 SCC 恢复更好，您需要改进您的 SCC。

对于所有尚未准备好投入生产的代码，我们在 SCC 中有一个名为“playground”和“junk”的目录。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-29T19:10:47.027

尽管这是一个主观的答案，但我认为您没有正确使用源代码控制。

是的，您的本地副本通常与存储库不同步，但是任何给定的更改都应该只是少量的工作（例如，您不应该有连续几天没有签入的东西）。如果您经常提交，那么在驱动器丢失（盗窃/故障/等）的情况下，您会损失少量（通常<1天）的工作。

如果您正在做一些对其他开发人员造成破坏的完全疯狂的事情，那么您应该在一个分支中工作。完成后，将更改合并回来。

您还应该能够随时从您的 SCC 系统重建项目。时不时地做一件好事，只是为了确保您需要构建的所有内容都在 SCC 中 - 有时文件会丢失，而您永远不会注意到，因为您总是从您一直使用的工作副本构建过去 6 个月。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-29T19:13:34.603

我使用[Mercurial](http://www.selenic.com/mercurial/wiki/)作为我的版本控制系统。我使用 Windows 笔记本电脑上的存储库作为我的主存储库，但每隔两三天使用 Mercurial 的克隆功能将其备份到我的 ubuntu 服务器。我还使用[同步玩具](http://en.wikipedia.org/wiki/SyncToy)将重要目录备份到闪存驱动器，包括在我的笔记本电脑上找到的存储库副本。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-29T19:34:53.407

我使用[Unison](http://www.cis.upenn.edu/~bcpierce/unison/)在家里的两台不同机器上复制我的整个主目录。这样，如果我马虎或者我有 20 年前的文件不受源代码控制（`.emacs`）我仍然有一定的保护措施。我还在工作的机器上复制除了个人文件（照片、音乐）之外的所有内容。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-29T20:02:57.563

版本控制 (SVN) 对我来说绰绰有余。然而，有一些规则：

*   我尽可能频繁地提交（4-6 小时的工作没有提交已经开始产生出问题的刺痛感）。
*   解决方案的 SVN 结构始终是原子的。您只需要一个新的 CheckOut 就可以在任何解决方案上运行“rebuild-copy-package”集成脚本（运行测试可能需要在此之前提供数据库连接设置）。
*   SVN服务器可靠，定期备份。
*   更改仅通过提交在组成应用程序的不同解决方案（即从开源共享库到利用它的内部代码）之间传播（集成服务器选择它并创建可在下游解决方案中使用的包） .
*   沙盒项目（原型）始终保存在名为“YYYY-MM-DD PrototypeName”的 SVN（Trunk 或标签的兄弟）的 Prototypes 文件夹中

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-29T20:53:10.970

**不要使用双向同步工具进行备份**

...好吧，至少不会自动

同步工具（例如 unison）正在*同步*两个（或更多）位置。因此，如果您不小心弄乱了某个位置的文件，则该混乱将转换为另一个位置，而您不会注意到。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-29T19:04:09.507

我们还检查所有内容（尽早检查并经常检查）并使用 tar 和 ftp 将整个存储库 (CVS) 备份到我们的备份服务器。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-29T19:09:51.053

当你写的东西（还）不属于主构建时，创建一个分支。当它应该进入主构建时，将您的分支与它合并。

分布式 VCS 还使本地分支变得非常容易，中央存储库永远不会知道它们的存在。

通过将更改推送到远程副本来备份本地存储库（分布式 VCS）非常简单，以至于我使用 git 作为大多数文档、配置文件以及基本上任何非二进制文件的主要备份方法。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-29T19:10:18.277

如果您在很长一段时间内偏离源代码控制，那么您需要一些分布式源代码控制。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-29T20:26:15.847

我正在开发一种名为“Transactor Code Agent”的产品，它旨在满足您的要求。

它为您的源文件提供本地备份和版本控制。

它使您可以将现有的源代码控制设置用于其用途（管理多个开发人员在多个版本中“大部分完成”的工作），同时为您正在进行的工作提供自动备份和本地文件版本控制。

测试版应该在一月份的某个时候发布。

您可以在以下位置查看我们的“网站”（有点粗糙）

[www.transactor.com](http://www.transactor.com)

那里有一个表格，您可以使用它来注册私人测试版。

**更新：**

根据我在评论中得到的一些反馈，这里有更多信息：

1）我有反对源代码控制的事情吗？

不！我认为源代码控制是一件很棒的事情。如果使用得当，它为管理软件生命周期提供了一个巨大的工具。

但是，如果使用得当，源代码控制会留下很大的空白，因为它在完成之前无法保护开发人员的工作。我们需要的是专注于单个程序员正在进行的工作的东西。代码代理就是这样做的。

换句话说，源代码控制是一种旨在让老板的生活更轻松的工具（因为它有助于随着时间的推移管理功能和更改以及团队和版本）

Code Agent 是一款旨在让您的生活更轻松的工具（因为它确保您的工作始终得到保存）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-29T20:48:32.073

未签入（并因此备份）到您的 VCS 的代码**不存在**。它并不比你头脑中的代码更真实。真的就是这么简单。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-11-24T22:41:30.587

我使用了一个产品（我写的，它是我的 micro-isv），称为 Transactor Code Agent。它是专为程序员设计的备份工具。

它监视您的源代码，每次您保存更改时，它都会备份它并为您保留本地历史记录。

我认为它在备份方面比源代码控制效果更好，原因如下：

1.  源代码管理旨在成为一种变更管理工具，以帮助您的程序从一个一致的状态转移到另一个
2.  您不必担心维护私有分支
3.  您不必为了备份目的而中断工作进行检查。您可以只专注于编写代码，并在完成后检查您的东西。

你可以在这里下载它的演示：

[http://www.transactor.com/download](http://www.transactor.com/download)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-29T19:46:26.457

因为我使用 TFS（Team Foundation Server），所以我只备份 SQL Server 数据库，就像我使用的任何其他数据库一样

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-29T20:40:25.037

万一出现任何问题，我有时会通过电子邮件将我正在处理的重要邮件发送到 webmail 帐户，例如 yahoo 或 hotmail。我知道每个人都在谈论从纸质到数字化的转变，但有时你永远不知道会发生什么，所以我会打印出纸质版。显然，这不是最好的解决方案，尤其是对于大型项目而言，因此我通常会将硬拷贝限制为更小、更重要的部分。我也倾向于有点偏执，所以我最终会采取备份备份的备份。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-29T21:09:03.530

我使用 rdiff-backup 通过 SSH 对我的笔记本电脑执行每日增量备份。它使用 deltra 压缩（如 rsync），因此速度非常快。它还允许您在备份数据中返回任意天数，以便您可以在完成一些复杂的代码之后立即返回，但在您不小心将其全部删除之前。

开始有点棘手，但在我看来非常值得。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-12-29T21:16:37.257

除了颠覆之外，我还使用[crashplan](http://www.crashplan.com/landing/index.html)进行在线异地备份。它还可以备份到本地存储和其他计算机（尽管不幸的是，目前似乎需要在每个目的地存储相同的备份集 - 即不能在异地存储少量重要的东西，而在本地存储更大的集。）

我还使用了 unison（对于太大而无法在异地备份的东西——音乐、电影等）和 OSX 时间胶囊，这样在数据丢失的情况下，我可以在不求助于在线备份的情况下进行恢复。在线备份适用于房屋被烧毁或被盗等灾难。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-12-29T21:31:04.373

> 但是，有时您的本地副本与存储库不同步。此外，一些沙盒类型的项目可能还没有 ;-) 进入 SCC。

首先，您应该尽量减少代码“超出”SCC 的时间。不是为了备份目的，而是为了跟踪什么时候做了什么，特别是*为什么*。提交评论是*无价*的。包含 3000 个文件并带有“初始修订”消息的大型签入不是很有用。

沙盒项目参数确实有一定的分量，但是您应该像对待所有其他文件一样对待它。将它们备份到外部 USB 驱动器或其他任何东西。如果您没有备份所有其他文件，我建议您现在开始。

> 而且，当然，如果磁盘驱动器死机，没有人愿意从 SCC 重建他们的整个项目目录——从实际备份中恢复要好得多。

这不只是`svn checkout`吗？为什么不只是“从 SCC 重建”？

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-12-29T22:15:46.250

Subversion：服务器由 Beanstalk 管理，客户端使用 Tortoise SVN。每次编码会话后，所有内容都会返回到 SVN 存储库，因此我永远不必担心丢失代码。我还定期将最新代码备份到 CD 并将其锁定在保险库中以确保安全！

另外，请记住，您的代码只是等式的一部分。大多数现代开发环境本身都需要大量定制（集成第 3 方工具是一个明显的例子，但仅使用适当的选项安装 IDE 也需要相当长的时间）。因此，我也在一个可以轻松备份到外部硬盘驱动器的虚拟机中进行所有开发。这些也被锁定在保险库中。

最后，我备份了一个“参考”数据库来完成图片。我不能只备份模式，因为在我的产品中，数据库中保存了重要的系统数据（例如，与网站一起提供的内容）。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-12-29T22:49:45.883

我使用[MozyPro](http://mozy.com/pro)自动对我机器上的当前代码以及源代码控制数据库进行异地备份。这每晚都会递增运行。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-11-24T22:56:56.537

在线（互联网）备份是该过程的重要组成部分。

对外部驱动器的所有类型的备份都注定会失败，除非它们是由指定的个人（例如秘书）进行的。如果您是一家非常小的商店（或像我这样的 µ-ISV），这不是一个选择。即便如此，外部驱动器保存在哪里？带防火功能的保险箱是唯一可能的好答案。将它们存放在异地并不好：人们会忘记将其带回办公室进行定期备份。

恕我直言，备份到 NAS 是比外部驱动器更好的解决方案。但是在建筑物着火的那一天，异地备份是您生存的唯一机会。

除了 SCC DB 之外，我个人还使用[Mozy](http://www.mozy.com)来备份主要的本地目录。

不用说，AES-256 或类似的加密对于将源代码存储在其他人的硬盘驱动器上是必不可少的。Mozy 及其所有严肃的竞争对手都提供它。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-11-24T23:05:28.723

来自 joelonsoftware 的 joel 在一些帖子中说，如果构建和部署您的项目需要两个以上的命令行（或准备工作超过一分钟），那么您做错了。我完全同意他的观点，我认为单片机就足够了。备份系统仅适用于灾难性灾难（硬盘故障、火灾和龙卷风）。

# php - 将应用程序目录考虑在内的 PHP 标头页面

> ID：398333
> 
> 赞同：2
> 
> 时间：2008-12-29T18:54:27.530
> 
> 标签：php, path

我正在为一个项目快速学习 PHP，我有很多愚蠢的问题要问。第一个是以下。我有这样的结构：

*   索引.php
*   头文件.php
*   图片/
*   数据
    *   数据.php

现在，问题是我想在 data.php 文件中包含 header.php 文件。那没问题。

我遇到的问题是 header.php 以相对方式链接到图像文件夹。因此，图像不会加载。

更糟糕的是，这个结构在一个特定的别名下，所以我不能将 / 附加到图像链接的开头。

我想，我需要的是一种在脚本中获取应用程序路径的方法。这样我就可以参考图像而不必担心包含的位置。

你如何在 PHP 中获得这条路径？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T19:11:24.123

尝试包括这样的文件：

```
<?php
    include($_SERVER['DOCUMENT_ROOT'].'/data/data.php/');
?> 
```

这`DOCUMENT_ROOT`将返回位于您网站的 Web 服务器上的根文件夹的路径。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T20:03:26.580

许多人使用这样的东西。将`dirname(__FILE__)`返回当前脚本的目录。然后你将它连接到你所包含的脚本的相对路径。

```
require(realpath(dirname(__FILE__).'/lib/Database.php')); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T18:59:01.827

看一眼`$_SERVER['PATH_TRANSLATED']`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T19:16:46.673

使用 set_include_path(get_include_path().PATH_SEPARATOR.$new_path) 其中 $new_path 应该让您从绝对根文件夹一直到 getcwd() 的结果。

确保将此包含路径添加到主文件，这样代码就不会为 data/ 中的每个文件重复。这也将确保您不再为同样的问题而烦恼。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T20:53:45.277

All the good PHP answers being already taken, I'd suggest you look at it the other way: is there something preventing you from linking the image as `src="/images/yourimage.gif"`? This way the image will load no matter where you call it from.

# open-source - 最好的命令行时间跟踪应用程序？

> ID：398344
> 
> 赞同：47
> 
> 时间：2008-12-29T19:01:09.230
> 
> 标签：open-source, command-line, time-tracking

我正在寻找在终端中运行并允许我跟踪时间的东西。我希望它是开源的，但这不是必需的。

我发现的大多数时间跟踪应用程序都是基于 web 或 gui 的，输入数据需要更长的时间，然后我想要。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-11-15T03:15:25.883

时间陷阱。它简单轻巧，使用起来有些直观。

```
$ t switch World Domination Plan
$ t in --at "5 minutes ago" Research Volcano Islands
$ t out
$ t display
Timesheet World Domination Plan:
Day            Start      End        Duration   Notes
Mar 14, 2009   19:53:30 - 20:06:15   0:12:45    Research Volcano Islands
Total                                0:12:45 
```

它是用 ruby​​ 编写的，可作为 gemcutter 或 github 上的 gem：http: [//github.com/samg/timetrap](http://github.com/samg/timetrap)

用 python 编写的类似工具称为 TimeBook，可在 bitbucket 上找到。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-29T19:32:13.473

一个真正的基本的将是

```
$ echo `date`": what I'm doing now" >> timelog.txt 
```

如果你想稍后处理它，如果你这样做`date +%s`或者`date +%F%T`.

您可以将其包装为 shell 脚本：

```
#!/usr/bin/bash -
echo `date +%s` $* >> ~/timelog.txt 
```

您真正想做的一些提示可能会有所帮助。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-11-17T17:53:29.340

我最近发现了[**TaskWarrior**](http://taskwarrior.org/)，它纯粹是 CLI，但功能非常丰富。

**编辑 2015 年 6 月：**自从我几年前写了这个答案以来，taskwarrior 已经在一个很棒的项目中开发了很多功能和集成。我最喜欢的有：

*   [https://inthe.am/about](https://inthe.am/about)（网络界面）
*   [http://mirakel.azapps.de/index.html](http://mirakel.azapps.de/index.html)（安卓应用）

更多任务战士工具[在这里](http://taskwarrior.org/tools/)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-03-14T18:52:00.357

Emacs[组织模式](http://orgmode.org/)！

*   [(视频) Emacs Org-mode - 一个用于记笔记和项目计划的系统](http://www.youtube.com/watch?v=oJTwQvgfgMM)
*   [Emacs 和 Org-mode 实现 GTD](http://members.optusnet.com.au/~charles57/GTD/gtd_workflow.html)
*   [计时](http://doc.norang.ca/org-mode.html#Clocking)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-29T21:08:23.687

你可以使用[wtime](http://wtime.sourceforge.net/)：

```
wtime [ -t task ] [ <action> ]

-t  task
    Specify the name of the task. It has to be  a  valid  file-
    name.  Only the first 32 characters are taken into account.
    The default value is "default".

action is one of the following:

-h  Display help.

-a  Start counting.

-s  Stop counting.

-c  Display current elapsed time in seconds.

-r  [ start [ end ]]
    Display time spent on the task during the  specified
    period.  The  parametres start and end represent the
    begginning and end of the reporting  period  respec-
    tively.  The  format  of start and end is '%d-%m-%Y'
    (see strptime (1)).  The default values are the cur-
    rent  time for end and the begginning of the current
    month for the start parameter. 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-06-14T21:51:23.590

如果你使用 todo.txt-cli，你应该考虑使用Python 编写的[打卡时间跟踪。](http://code.google.com/p/punch-time-tracking/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-11-01T10:09:06.153

App::TimeTracker - 易于扩展的基于命令行的时间跟踪器

```
~$ cd work/some_project
~/work/some_project$ tracker start
Started working on some_project at 13:06:20
~/work/some_project$ # hack ... hack ... hack
~/work/some_project$ tracker stop
Worked 00:15:42 on some_project

~/work/some_project$ cd ../other_project
~/work/other_project$ tracker start
Started working on other_project at 13:32:54
~/work/other_project$ # hack some more
~/work/other_project$ tracker current
Working 00:35:31 on other_project
Started at 13:32:54

~/work/other_project$ tracker start --tag testing
Worked 00:38:23 on other_project
Started working on other_project (testing) at 14:11:27
~/work/other_project$ # hack, then go for lunch
~/work/other_project$ # ups, forgot to hit stop when I left
~/work/other_project$ tracker stop --at 14:30
Worked 00:18:33 on other_project (testing)

~/work/other_project$ tracker report --this day
work                     01:12:38
   some_project             00:15:42
   other_project            00:56:56
total                    01:12:38 
```

作者网站上的更多详细信息：http: [//timetracker.plix.at/](http://timetracker.plix.at/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-02-01T15:41:50.743

我最近开始使用 Worklog，它看起来非常简单直接。

[http://ajy.co/2010/worklog-a-simple-time-tracking-program/](http://ajy.co/2010/worklog-a-simple-time-tracking-program/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-29T19:36:27.350

取决于您要时间跟踪的信息。在一家公司，我们只需要跟踪我们一天的总工作时间（税收/社会保险目的）。最简单的解决方案是： `last`. 更细化你可以做类似的事情

```
echo -e -n `date`\tProjectName\tTask\tComment >> MyTimeTable.txt
...whatever...
echo -e \t`date` >> MyTimeTable.txt 
```

并与通常的嫌疑人（grep，awk，...）一起处理。

当您需要更多功能时，我不知道有没有人可以在没有 gui 的情况下工作。

# ruby-on-rails - 为 Rails 项目生成特定于环境的文件的最佳方法是什么？

> ID：398347
> 
> 赞同：1
> 
> 时间：2008-12-29T19:03:27.900
> 
> 标签：ruby-on-rails, ruby, templates, caching

我在 Javascript 文件中有一些我需要的设置——要连接的服务器——这些设置会根据我的环境而变化。对于`development`、`test`和`staging`，我想使用登台服务器；对于`production`，生产服务器。我已经有了 Ruby 中的设置（在我的`environment/xyz.rb`文件中配置）。到目前为止，我一直在使用`application.js.erb`文件和自定义路由在请求时动态创建 JS 文件。不过，这很慢，这意味着只为这个文件创建一个额外的控制器和视图目录。

我希望有一个模板文件和一个从模板生成正确版本并将静态文件放在`public/javascripts`目录中的 rake 任务。有没有人尝试过这样的事情？你用什么渲染的？你把模板文件和渲染代码放在哪里了？

还是只保留动态版本并将其缓存在生产环境中更好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T20:03:55.157

你能做这样的事情吗？

```
<% javascript_include_file "#{RAILS_ENV}.js" %> 
```

我做了类似的事情，虽然它不是使用 JS 文件，而是使用一些 RB 文件......我这样做是出于同样的原因，确定要连接到哪些服务器。

对我来说，我的`"lib"`目录中有一个 rb 文件，名为`"constants.rb"`. 该文件有一些 if 语句会根据环境（开发、测试、登台或生产）切换，这些语句会切换出我需要附加到的 IP 地址的值。在我运行应用程序的机器的庞然大物上，这对于我的目的来说已经足够了。

这是一个示例：

```
if ENV['RAILS_ENV'] != "production" ## if the rails environment is development or staging then use the test server
  @@IP_ADDRESS = "10.16.121.173" ## the test server
else ## if the Rails environment is production, then use the live server.
  @@IP_ADDRESS = "10.16.8.44" ## The is the shared IP address
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T23:46:32.807

使用 rake 任务来生成这些 javascript 文件确实是一种选择。我正在使用 rake 任务从 YAML 格式的翻译文件中为 JS 前端生成 i18n 翻译文件。一种选择是将 ERB 用于模板。我会把 rakefile`lib/tasks/foo.rake`和模板放在`lib/tasks/foo/foo.erb`. 如果您的 JS 模板不是很复杂，我建议使用普通`Hash.to_json`方法生成 javascript 内容：

```
namespace :js do
  task :generate_config => :environment do
    File.open("#{RAILS_ROOT}/public/javascripts/configuration.js", 'w') do |out|
      config = {:option_1 => 'Value 1', :option_2 => 'Value 2'}
      out << "var CONFIG = #{config.to_json}"
    end
  end
end 
```

**但是**配置文件是您不想忘记在更改配置源数据时重新生成的东西。我正在使用一种解决方案在生产环境中生成“缩小”的 JS 文件，以将大量 javascript 文件附加在一起，这样我就可以节省 HTTP 请求。但是您可以使用基本相同的解决方案。如果您使用 Capistrano 来部署您的应用程序，它会非常有用。

在文件中`app/helpers/application_helper.rb`创建全局可用的新辅助方法：

```
module ApplicationHelper
  def javascript_include_config_tag
    if ActionController::Base.perform_caching
      unless File.exists?("#{RAILS_ROOT}/public/javascripts/configuration.js")

        #
        # TODO: Generate configuration data in here
        #
        config = 'configuration file contents'

        File.open("#{RAILS_ROOT}/public/javascripts/configuration.js", 'w') do |out|
          out << config
        end
      end
      javascript_include_tag('configuration')
    else
      # Link to js generated dynamically on each request. Useful in development.
      javascript_include_tag('PATH_TO_DYNAMICALLY_GENERATED_JS')
    end
  end
end 
```

在您看来，您只需包含 javascript

```
<%= javascript_include_config_tag %> 
```

这里的想法是，这个 JS 配置文件仅在新 Capistrano 部署后第一次在页面加载时生成。它还有一个巨大的缺点，即您无法`configuration.js`在生成第一页之前请求文件，但在我的应用程序中，它到目前为止运行良好。

# asp.net - 通过方法名称使用 __DoPostBack 调用服务器端方法

> ID：398351
> 
> 赞同：2
> 
> 时间：2008-12-29T19:04:36.370
> 
> 标签：asp.net, server-side

我想使用 __DoPostBack 调用服务器端方法并生成 HTML，但我不希望我的页面中有一个隐藏的 ASP runat 服务器控件，它可以通过其名称而不是触发它的控件的名称来调用服务器端方法？ ?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T19:13:34.993

每当我看到这个问题时，我都会有点紧张，因为提问者不太了解导致回帖的所有含义，所以我想简要介绍一下：

*   浏览器中的当前 DOM 实例被销毁。就浏览器而言，您正在提交当前页面并请求一个全新的页面。
*   不仅有问题的服务器端方法会运行，还会运行整个页面生命周期的其余部分，包括任何所需的数据绑定或页面加载/初始化代码。它将全部从头开始重新渲染。

这真的是你想要发生的事情吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T19:33:54.127

研究 ASP.Net 处理 AJAX 功能或另一个术语的回调的各种方式，因为这似乎是您正在尝试做的事情。该方法必须存在于页面中，或者如果它存在于控件中，则该控件必须存在一个 ID，以识别单击了哪个按钮，因为可以在页面上多次重复相同的控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T19:17:06.297

如果我单击 runatserver 按钮也会发生同样的情况，所有页面都将再次呈现。

我使用控件名称作为参数调用了 __DoPostBack javascript 函数，如果我单击按钮或链接按钮，它的工作方式相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-30T01:53:28.273

正如乔尔所提到的，你可能有一些意想不到的行为会覆盖这样的回传。如果您完全了解正在发生的事情，那就没有错。

我认为您可能真正想要的是一个`WebMethod`. 这将使您的页面保持完整，但允许您调用特定的服务器端方法：

```
public partial class _Default : Page 
{
  [WebMethod]
  public static string GetDate()
  {
    return DateTime.Now.ToString();
  }
} 
```

[使用jQuery直接调用ASP.NET AJAX页面方法](http://encosia.com/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-03-20T13:43:38.753

创建一个 ID 为“DummyButton”的虚拟按钮，`style="display:none"`并使用您想要的代码添加一个单击事件处理程序。`__doPostBack('<%= DummyButton.UniqueID %>');`从 javascript 脚本元素调用。

你需要用css隐藏假人；如果您设置`Visisble="false"`,`__doPostback`将不会执行常规回发，因为它不会使用按钮作为回发启动器元素。在这种情况下，服务器仍然会受到攻击，但您可能会遇到奇怪的问题。

# silverlight - Silverlight 是否支持 StringFormat 绑定？

> ID：398353
> 
> 赞同：12
> 
> 时间：2008-12-29T19:04:40.050
> 
> 标签：silverlight, data-binding

我知道 WPF 3.5 SP1 支持`StringFormat`绑定，但 Silverlight 可以这样做吗？我认为它可以，但该死的，如果我能让它工作！

这是我的 XAML 的片段：

```
<TextBlock Text="{Binding StartTime, StringFormat=t}" /> 
```

它编译正常，但是当它到达浏览器时出现运行时错误......

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-12-12T01:34:25.837

我不知道是哪个版本的 Silverlight 引入了它，但你现在可以了。我正在使用 Silverlight 4 测试版。

```
 <data:DataGridTextColumn Header="Date" 
     Binding="{Binding CreateDt, StringFormat=\{0:d\}}" /> 
```

[http://blog.davemdavis.net/2009/12/silverlight-4-data-binding-string.html](http://blog.davemdavis.net/2009/12/silverlight-4-data-binding-string.html)

这是有关[Formatting Types](http://msdn.microsoft.com/en-us/library/26etazsy(v=VS.95).aspx)的信息，以及有关[DateTime](http://www.csharp-examples.net/string-format-datetime/)的更多信息。

[这是有关Silverlight Binding](http://msdn.microsoft.com/en-us/library/cc278072(VS.95).aspx)的完整文档。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-29T20:32:05.273

Silverlight 3 和更低版本没有，但您可以使用 Value Converter 并在绑定中指定 ConverterParamenter。您必须通过从 IValueConverter 派生一个类来创建自己的值转换器，就像我在[这里](http://blogs.msdn.com/synergist/archive/2008/07/30/using-a-converterparameter-in-a-silverlight-2-value-converter.aspx)展示的那样。

Silverlight 4 及更高版本具有与 WPF 相同的 StringFormat 绑定属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-31T20:34:28.320

Simon 提到的字符串格式在 Silverlight 4 中。Blend 甚至支持设置格式。

# sql-server - SQL Server：使用 SELECT INTO 保留计算字段

> ID：398375
> 
> 赞同：2
> 
> 时间：2008-12-29T19:14:10.470
> 
> 标签：sql-server, calculated-columns, select-into

我的公司最近进行了一次数据迁移（在 SQL Server 2005 数据库中），我们注意到使用 SELECT INTO 创建的一些表没有维护原始表的计算字段，而是 SQL Server 创建了具有返回类型的常规字段原始计算。例如，假设您有这个表：

```
create table Example (
 id int not null,
 quantity decimal(19,5) not null,
 price decimal(19,5) not null,
 total as price*quantity 
) 
```

在执行 SELECT * INTO Example2 FROM Example 之后，您会得到：

```
create table Example2 (
 id int not null,
 quantity decimal(19,5) not null,
 price decimal(19,5) not null,
 total decimal(38,9) null
) 
```

我修复了它删除坏字段并重新创建它们，但我想知道是否有一种方法可以维护使用 SELECT INTO 创建的表中的计算字段（可能使用一些特殊的 SQL Server 配置或使用替代 SQL 命令）。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T19:31:17.253

我认为您无法使用 SELECT INTO 执行此操作 - 就像您针对视图进行选择一样，它只是将结果提取到新表中。

您可能需要先创建包含计算列的表，然后从非计算列的源表中进行常规插入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T20:15:00.720

作为一项策略，最好避免使用 SELECT INTO 创建表，尤其是在迁移中。您不仅会丢失计算，还会丢失索引、触发器以及可能的任何默认值或约束。在迁移中，您应该始终编写要移动的表，包括触发器、索引等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T19:30:40.123

我的理解是新表是根据记录集中的数据类型创建的。但是，记录集不包含有关如何生成结果值的信息 - 因此计算公式会丢失。（作为极端示例，将包含 GROUP BY 的视图视为 SELECT INTO 的源）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-09-30T18:14:52.373

如果您不想修改 Select Into 语句，另一种方法是删除列（Alter Table Drop Column）并将它们重新创建（Alter Table Add）作为计算列。

# c# - 获取最后 10 行非常大的文本文件 > 10GB

> ID：398378
> 
> 赞同：70
> 
> 时间：2008-12-29T19:16:08.157
> 
> 标签：c#, text, large-files

显示一个非常大的文本文件（这个特定文件超过 10GB）的最后 10 行的最有效方法是什么。我想只写一个简单的 C# 应用程序，但我不确定如何有效地做到这一点。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-12-29T19:59:13.217

读到文件末尾，然后向后搜索，直到找到十个换行符，然后考虑到各种编码，向前读到最后。请务必处理文件中的行数少于 10 行的情况。下面是一个实现（在您标记此的 C# 中），概括为找到`numberOfTokens`位于`path`编码的文件中的最后一个`encoding`标记分隔符由`tokenSeparator`;表示的位置 结果作为 a 返回`string`（这可以通过返回`IEnumerable<string>`枚举标记的 an 来改进）。

```
public static string ReadEndTokens(string path, Int64 numberOfTokens, Encoding encoding, string tokenSeparator) {

    int sizeOfChar = encoding.GetByteCount("\n");
    byte[] buffer = encoding.GetBytes(tokenSeparator);

    using (FileStream fs = new FileStream(path, FileMode.Open)) {
        Int64 tokenCount = 0;
        Int64 endPosition = fs.Length / sizeOfChar;

        for (Int64 position = sizeOfChar; position < endPosition; position += sizeOfChar) {
            fs.Seek(-position, SeekOrigin.End);
            fs.Read(buffer, 0, buffer.Length);

            if (encoding.GetString(buffer) == tokenSeparator) {
                tokenCount++;
                if (tokenCount == numberOfTokens) {
                    byte[] returnBuffer = new byte[fs.Length - fs.Position];
                    fs.Read(returnBuffer, 0, returnBuffer.Length);
                    return encoding.GetString(returnBuffer);
                }
            }
        }

        // handle case where number of tokens in file is less than numberOfTokens
        fs.Seek(0, SeekOrigin.Begin);
        buffer = new byte[fs.Length];
        fs.Read(buffer, 0, buffer.Length);
        return encoding.GetString(buffer);
    }
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-12-29T19:20:33.310

我可能只是将它作为二进制流打开，寻找到最后，然后返回寻找换行符。备份 10 行（或 11 行，取决于最后一行）以找到您的 10 行，然后只需阅读到最后并在您阅读的内容上使用 Encoding.GetString 将其转换为字符串格式。根据需要拆分。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-12-29T19:22:56.643

尾巴？Tail 是一个 unix 命令，将显示文件的最后几行。[Windows 2003 Server 资源工具包](http://www.microsoft.com/downloads/details.aspx?FamilyID=9d467a69-57ff-4ae7-96ee-b18c4790cffd&DisplayLang=en)中有一个 Windows 版本。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-12-29T19:26:08.713

正如其他人所建议的那样，您可以有效地转到文件末尾并向后阅读。但是，这有点棘手——特别是因为如果您有可变长度编码（例如 UTF-8），您需要巧妙地确保获得“完整”字符。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-29T19:21:51.013

您应该能够使用[FileStream.Seek()](http://msdn.microsoft.com/en-us/library/system.io.filestream.seek(VS.71).aspx)移动到文件的末尾，然后向后工作，寻找 \n 直到有足够的行。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-29T20:22:21.610

我不确定它的效率如何，但在 Windows PowerShell 中获取文件的最后十行就像

```
Get-Content file.txt | Select-Object -last 10 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-29T19:24:21.713

这就是 unix tail 命令的作用。见[http://en.wikipedia.org/wiki/Tail_(Unix)](http://en.wikipedia.org/wiki/Tail_(Unix))

互联网上有很多开源实现，这里是一个针对 win32 的：[Tail for WIn32](http://www.codeproject.com/KB/applications/Tail_for_Win32.aspx)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-30T09:15:29.617

我认为以下代码将通过重新编码的细微变化来解决问题

```
StreamReader reader = new StreamReader(@"c:\test.txt"); //pick appropriate Encoding
reader.BaseStream.Seek(0, SeekOrigin.End);
int count = 0;
while ((count < 10) && (reader.BaseStream.Position > 0))
{
    reader.BaseStream.Position--;
    int c = reader.BaseStream.ReadByte();
    if (reader.BaseStream.Position > 0)
        reader.BaseStream.Position--;
    if (c == Convert.ToInt32('\n'))
    {
        ++count;
    }
}
string str = reader.ReadToEnd();
string[] arr = str.Replace("\r", "").Split('\n');
reader.Close(); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-29T19:25:02.523

您可以使用 Windows 版本的[tail](http://tailforwin32.sourceforge.net/)命令，然后将其输出到带有 > 符号的文本文件中，或者根据您的需要在屏幕上查看它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-03-04T13:48:40.950

这是我的版本。高温高压

```
using (StreamReader sr = new StreamReader(path))
{
  sr.BaseStream.Seek(0, SeekOrigin.End);

  int c;
  int count = 0;
  long pos = -1;

  while(count < 10)
  {
    sr.BaseStream.Seek(pos, SeekOrigin.End);
    c = sr.Read();
    sr.DiscardBufferedData();

    if(c == Convert.ToInt32('\n'))
      ++count;
    --pos;
  }

  sr.BaseStream.Seek(pos, SeekOrigin.End);
  string str = sr.ReadToEnd();
  string[] arr = str.Split('\n');
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-29T19:28:41.377

如果您使用 FileMode.Append 打开文件，它将为您寻找文件的末尾。然后你可以寻找你想要的字节数并读取它们。无论您做什么，它都可能不会很快，因为这是一个非常庞大的文件。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-29T19:32:22.897

一种有用的方法是`FileInfo.Length`。它以字节为单位给出文件的大小。

你的文件是什么结构？您确定最后 10 行将在文件末尾附近吗？如果您有一个包含 12 行文本和 10GB 的 0 的文件，那么查看结尾不会真的那么快。再说一次，您可能需要查看整个文件。

如果您确定该文件在新行中包含许多短字符串，请查找到末尾，然后再检查，直到您计算出 11 个行尾。然后你可以向前阅读接下来的 10 行。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-29T21:18:27.097

我认为其他海报都表明没有真正的捷径。

您可以使用诸如tail（或powershell）之类的工具，也可以编写一些愚蠢的代码来寻找文件的结尾，然后返回n个换行符。

网上有很多tail的实现——看看源代码，看看**他们**是怎么做的。Tail 非常高效（即使在非常大的文件上），所以他们在编写它时一定是正确的！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-06-06T22:57:06.437

使用 Sisutil 的答案作为起点，您可以逐行读取文件并将它们加载到`Queue<String>`. 它确实从一开始就读取文件，但它具有不尝试向后读取文件的优点。正如 Jon Skeet 指出的那样，如果您有一个具有可变字符宽度编码（如 UTF-8）的文件，这可能会非常困难。它也没有对行长做出任何假设。

我用一个 1.7GB 的文件（手头没有 10GB 的文件）对此进行了测试，大约花了 14 秒。当然，在比较计算机之间的加载和读取时间时，通常需要注意事项。

```
int numberOfLines = 10;
string fullFilePath = @"C:\Your\Large\File\BigFile.txt";
var queue = new Queue<string>(numberOfLines);

using (FileStream fs = File.Open(fullFilePath, FileMode.Open, FileAccess.Read, FileShare.Read)) 
using (BufferedStream bs = new BufferedStream(fs))  // May not make much difference.
using (StreamReader sr = new StreamReader(bs)) {
    while (!sr.EndOfStream) {
        if (queue.Count == numberOfLines) {
            queue.Dequeue();
        }

        queue.Enqueue(sr.ReadLine());
    }
}

// The queue now has our set of lines. So print to console, save to another file, etc.
do {
    Console.WriteLine(queue.Dequeue());
} while (queue.Count > 0); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-05-31T09:22:07.033

使用 PowerShell，`Get-Content big_file_name.txt -Tail 10`其中 10 是要检索的底线数。

这没有性能问题。我在一个超过 100 GB 的文本文件上运行它并立即得到结果。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-29T22:05:09.593

打开文件并开始读取行。读完 10 行后，打开另一个指针，从文件的开头开始，因此第二个指针比第一个指针滞后 10 行。继续阅读，同时移动两个指针，直到第一个指针到达文件末尾。然后使用第二个指针读取结果。它适用于任何大小的文件，包括空文件和短于尾长的文件。而且很容易适应任何长度的尾巴。当然，缺点是您最终会读取整个文件，而这可能正是您要避免的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-07-31T16:24:49.753

如果您有一个每行格式相同的文件（例如 daq 系统），您只需使用 streamreader 获取文件的长度，然后取其中一行 ( `readline()`)。

将总长度除以字符串的长度。现在您有了一个通用的长数字来表示文件中的行数。

关键是您`readline()`在获取数组或其他数据之前使用。这将确保您从新行的开头开始，并且不会从前一行获取任何剩余数据。

```
StreamReader leader = new StreamReader(GetReadFile);
leader.BaseStream.Position = 0;
StreamReader follower = new StreamReader(GetReadFile);

int count = 0;
string tmper = null;
while (count <= 12)
{
    tmper = leader.ReadLine();
    count++;
}

long total = follower.BaseStream.Length; // get total length of file
long step = tmper.Length; // get length of 1 line
long size = total / step; // divide to get number of lines
long go = step * (size - 12); // get the bit location

long cut = follower.BaseStream.Seek(go, SeekOrigin.Begin); // Go to that location
follower.BaseStream.Position = go;

string led = null;
string[] lead = null ;
List<string[]> samples = new List<string[]>();

follower.ReadLine();

while (!follower.EndOfStream)
{
    led = follower.ReadLine();
    lead = Tokenize(led);
    samples.Add(lead);
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-11-25T02:37:16.540

我刚刚遇到了同样的问题，一个巨大的日志文件，应该通过 REST 接口访问。当然，将其加载到任何内存中并通过 http 将其完整发送并不是解决方案。

正如 Jon 所指出的，这个解决方案有一个非常具体的用例。就我而言，我确定（并检查）编码是 utf-8（带有 BOM！），因此可以从 UTF 的所有好处中获益。这肯定不是通用解决方案。

这是对我非常有效和快速的工作（我忘了关闭流 - 现在已修复）：

```
 private string tail(StreamReader streamReader, long numberOfBytesFromEnd)
    {
        Stream stream = streamReader.BaseStream;
        long length = streamReader.BaseStream.Length;
        if (length < numberOfBytesFromEnd)
            numberOfBytesFromEnd = length;
        stream.Seek(numberOfBytesFromEnd * -1, SeekOrigin.End);

        int LF = '\n';
        int CR = '\r';
        bool found = false;

        while (!found) {
            int c = stream.ReadByte();
            if (c == LF)
                found = true;
        }

        string readToEnd = streamReader.ReadToEnd();
        streamReader.Close();
        return readToEnd;
    } 
```

我们首先使用 BaseStream 寻找接近末尾的某个位置，当我们拥有正确的流位置时，使用通常的 StreamReader 读取到末尾。

这实际上并不允许指定从末尾开始的行数，这无论如何都不是一个好主意，因为这些行可能是任意长的，因此会再次破坏性能。所以我指定字节的数量，读取直到我们到达第一个换行符，然后舒适地读取到最后。从理论上讲，您也可以查找 CarriageReturn，但在我的情况下，这不是必需的。

如果我们使用这段代码，它不会干扰编写器线程：

```
 FileStream fileStream = new FileStream(
            filename,
            FileMode.Open,
            FileAccess.Read,
            FileShare.ReadWrite);

        StreamReader streamReader = new StreamReader(fileStream); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-07-01T21:05:31.487

如果您需要从文本文件中反向读取任意数量的行，您可以使用一个与 LINQ 兼容的类。它侧重于性能和对大文件的支持。您可以阅读几行并调用**Reverse()**以按正序获取最后几行：

**用法**：

```
var reader = new ReverseTextReader(@"C:\Temp\ReverseTest.txt");
while (!reader.EndOfStream)
    Console.WriteLine(reader.ReadLine()); 
```

**ReverseTextReader 类**：

```
/// <summary>
/// Reads a text file backwards, line-by-line.
/// </summary>
/// <remarks>This class uses file seeking to read a text file of any size in reverse order.  This
/// is useful for needs such as reading a log file newest-entries first.</remarks>
public sealed class ReverseTextReader : IEnumerable<string>
{
    private const int BufferSize = 16384;   // The number of bytes read from the uderlying stream.
    private readonly Stream _stream;        // Stores the stream feeding data into this reader
    private readonly Encoding _encoding;    // Stores the encoding used to process the file
    private byte[] _leftoverBuffer;         // Stores the leftover partial line after processing a buffer
    private readonly Queue<string> _lines;  // Stores the lines parsed from the buffer

    #region Constructors

    /// <summary>
    /// Creates a reader for the specified file.
    /// </summary>
    /// <param name="filePath"></param>
    public ReverseTextReader(string filePath)
        : this(new FileStream(filePath, FileMode.Open, FileAccess.Read, FileShare.Read), Encoding.Default)
    { }

    /// <summary>
    /// Creates a reader using the specified stream.
    /// </summary>
    /// <param name="stream"></param>
    public ReverseTextReader(Stream stream)
        : this(stream, Encoding.Default)
    { }

    /// <summary>
    /// Creates a reader using the specified path and encoding.
    /// </summary>
    /// <param name="filePath"></param>
    /// <param name="encoding"></param>
    public ReverseTextReader(string filePath, Encoding encoding)
        : this(new FileStream(filePath, FileMode.Open, FileAccess.Read, FileShare.Read), encoding)
    { }

    /// <summary>
    /// Creates a reader using the specified stream and encoding.
    /// </summary>
    /// <param name="stream"></param>
    /// <param name="encoding"></param>
    public ReverseTextReader(Stream stream, Encoding encoding)
    {          
        _stream = stream;
        _encoding = encoding;
        _lines = new Queue<string>(128);            
        // The stream needs to support seeking for this to work
        if(!_stream.CanSeek)
            throw new InvalidOperationException("The specified stream needs to support seeking to be read backwards.");
        if (!_stream.CanRead)
            throw new InvalidOperationException("The specified stream needs to support reading to be read backwards.");
        // Set the current position to the end of the file
        _stream.Position = _stream.Length;
        _leftoverBuffer = new byte[0];
    }

    #endregion

    #region Overrides

    /// <summary>
    /// Reads the next previous line from the underlying stream.
    /// </summary>
    /// <returns></returns>
    public string ReadLine()
    {
        // Are there lines left to read? If so, return the next one
        if (_lines.Count != 0) return _lines.Dequeue();
        // Are we at the beginning of the stream? If so, we're done
        if (_stream.Position == 0) return null;

        #region Read and Process the Next Chunk

        // Remember the current position
        var currentPosition = _stream.Position;
        var newPosition = currentPosition - BufferSize;
        // Are we before the beginning of the stream?
        if (newPosition < 0) newPosition = 0;
        // Calculate the buffer size to read
        var count = (int)(currentPosition - newPosition);
        // Set the new position
        _stream.Position = newPosition;
        // Make a new buffer but append the previous leftovers
        var buffer = new byte[count + _leftoverBuffer.Length];
        // Read the next buffer
        _stream.Read(buffer, 0, count);
        // Move the position of the stream back
        _stream.Position = newPosition;
        // And copy in the leftovers from the last buffer
        if (_leftoverBuffer.Length != 0)
            Array.Copy(_leftoverBuffer, 0, buffer, count, _leftoverBuffer.Length);
        // Look for CrLf delimiters
        var end = buffer.Length - 1;
        var start = buffer.Length - 2;
        // Search backwards for a line feed
        while (start >= 0)
        {
            // Is it a line feed?
            if (buffer[start] == 10)
            {
                // Yes.  Extract a line and queue it (but exclude the \r\n)
                _lines.Enqueue(_encoding.GetString(buffer, start + 1, end - start - 2));
                // And reset the end
                end = start;
            }
            // Move to the previous character
            start--;
        }
        // What's left over is a portion of a line. Save it for later.
        _leftoverBuffer = new byte[end + 1];
        Array.Copy(buffer, 0, _leftoverBuffer, 0, end + 1);
        // Are we at the beginning of the stream?
        if (_stream.Position == 0)
            // Yes.  Add the last line.
            _lines.Enqueue(_encoding.GetString(_leftoverBuffer, 0, end - 1));

        #endregion

        // If we have something in the queue, return it
        return _lines.Count == 0 ? null : _lines.Dequeue();
    }

    #endregion

    #region IEnumerator<string> Interface

    public IEnumerator<string> GetEnumerator()
    {
        string line;
        // So long as the next line isn't null...
        while ((line = ReadLine()) != null)
            // Read and return it.
            yield return line;
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        throw new NotImplementedException();
    }

    #endregion
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-10-01T19:29:09.800

前段时间我将此代码用于一个小实用程序，希望对您有所帮助！

```
private string ReadRows(int offset)     /*offset: how many lines it reads from the end (10 in your case)*/
{
    /*no lines to read*/
    if (offset == 0)
        return result;

    using (FileStream fs = new FileStream(FullName, FileMode.Open, FileAccess.Read, FileShare.ReadWrite, 2048, true))
    {
        List<char> charBuilder = new List<char>(); /*StringBuilder doesn't work with Encoding: example char  */
        StringBuilder sb = new StringBuilder();

        int count = 0;

        /*tested with utf8 file encoded by notepad-pp; other encoding may not work*/

        var decoder = ReaderEncoding.GetDecoder();
        byte[] buffer;
        int bufferLength;

        fs.Seek(0, SeekOrigin.End);

        while (true)
        {
            bufferLength = 1;
            buffer = new byte[1];

            /*for encoding with variable byte size, every time I read a byte that is part of the character and not an entire character the decoder returns '�' (invalid character) */

            char[] chars = { '�' }; //� 65533
            int iteration = 0;

            while (chars.Contains('�'))
            {
                /*at every iteration that does not produce character, buffer get bigger, up to 4 byte*/
                if (iteration > 0)
                {
                    bufferLength = buffer.Length + 1;

                    byte[] newBuffer = new byte[bufferLength];

                    Array.Copy(buffer, newBuffer, bufferLength - 1);

                    buffer = newBuffer;
                }

                /*there are no characters with more than 4 bytes in utf-8*/
                if (iteration > 4)
                    throw new Exception();

                /*if all is ok, the last seek return IOError with chars = empty*/
                try
                {
                    fs.Seek(-(bufferLength), SeekOrigin.Current);
                }
                catch
                {
                    chars = new char[] { '\0' };
                    break;
                }

                fs.Read(buffer, 0, bufferLength);

                var charCount = decoder.GetCharCount(buffer, 0, bufferLength);
                chars = new char[charCount];

                decoder.GetChars(buffer, 0, bufferLength, chars, 0);

                ++iteration;
            }

            /*when i get a char*/
            charBuilder.InsertRange(0, chars);

            if (chars.Length > 0 && chars[0] == '\n')
                ++count;

            /*exit when i get the correctly number of line (*last row is in interval)*/
            if (count == offset + 1)
                break;

            /*the first search goes back, the reading goes on then we come back again, except the last */
            try
            {
                fs.Seek(-(bufferLength), SeekOrigin.Current);
            }
            catch (Exception)
            {
                break;
            }

        }
    }

    /*everithing must be reversed, but not \0*/
    charBuilder.RemoveAt(0);

    /*yuppi!*/
    return new string(charBuilder.ToArray());
} 
```

为速度附上画面

[![在此处输入图像描述](https://i.stack.imgur.com/CX5Ur.png)](https://i.stack.imgur.com/CX5Ur.png)

* * *

## 回答 #21

> 赞同：-11
> 
> 时间：2008-12-30T01:41:57.863

为什么不使用返回字符串 [] 的 file.readalllines？

然后您可以获得最后 10 行（或数组的成员），这将是一项微不足道的任务。

这种方法没有考虑任何编码问题，我不确定这种方法的确切效率（完成方法所花费的时间等）。

# c# - 在 C# 中使用带宽限制上传

> ID：398383
> 
> 赞同：0
> 
> 时间：2008-12-29T19:17:25.860
> 
> 标签：c#

我试图将文件从本地机器移动到远程服务器。试图看看是否有比 BITS 更好的方法来上传文件，在 c# 中限制带宽

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T21:26:40.623

你看过这篇文章吗？

使用名为 ThrottledStream 的 codeproject 类。

[C#中的带宽限制](https://stackoverflow.com/questions/371032/bandwidth-throttling-in-c)

# python - Python 代理脚本

> ID：398385
> 
> 赞同：0
> 
> 时间：2008-12-29T19:19:08.260
> 
> 标签：python, proxy

我正在编写一个简单的 python 脚本，这样我就可以从不同的 IP 地址测试我的网站。

页面的 url 在查询字符串中给出，脚本获取页面并将其显示给用户。下面的代码用于重写包含 url 的标签，但我认为它不完整/完全正确。

```
def rel2abs(rel_url, base=loc):
    return urlparse.urljoin(base, rel_url)

def is_proxy_else_abs(tag, attr):
    if tag in ('a',):
        return True
    if tag in ('form', 'img', 'link') and attr in ('href', 'src', 'action', 'background'):
        return False

def repl(matchobj):
    if is_proxy_else_abs(matchobj.group(1).lower(), matchobj.group(3).lower()):
        return r'<%s %s %s="http://%s?%s" ' %(proxy_script_url, matchobj.group(1), matchobj.group(2), matchobj.group(3), urllib.urlencode({'loc':rel2abs(matchobj.group(5))}))
    else:
        return r'<%s %s %s="%s" ' %(matchobj.group(1), matchobj.group(2), matchobj.group(3), rel2abs(matchobj.group(5)))

def fix_urls(page):
    get_link_re = re.compile(r"""<(a|form|img|link) ([^>]*?)(href|src|action|background)\s*=\s*("|'?)([^>]*?)\4""", re.I|re.DOTALL)
    page = get_link_re.sub(repl, page)
    return page 
```

这个想法是'a'标签的href属性应该通过代理脚本路由，但css、javascript、图像、表单等不应该，所以如果它们在原始页面中是相对的，则必须将它们设为绝对。

问题是代码并不总是有效，可以用多种方式编写 css 等。我可以使用更全面的正则表达式吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T20:09:34.070

请在此处阅读有关解析 HTML 的其他帖子。例如[用于 HTML 解析的 Python 正则表达式 (BeautifulSoup)](https://stackoverflow.com/questions/55391/python-regular-expression-for-html-parsing-beautifulsoup)和[Python 中的 HTML 解析器](https://stackoverflow.com/questions/71151/html-parser-in-python)。

使用 Beautiful Soup，而不是正则表达式。

# c# - 在 .NET 2.0 中将位图转换为一个多页 TIFF 图像

> ID：398388
> 
> 赞同：46
> 
> 时间：2008-12-29T19:19:56.057
> 
> 标签：c#, .net, .net-2.0, drawing, tiff

如何将位图数组转换为 TIFF 格式的全新图像，将所有位图作为帧添加到这个新的 tiff 图像中？

使用.NET 2.0。

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-12-29T20:06:06.260

从第一个位图开始，将其放入 Image 对象中

```
Bitmap bitmap = (Bitmap)Image.FromFile(file); 
```

将位图作为 tiff 保存到内存

```
MemoryStream byteStream = new MemoryStream();
bitmap.Save(byteStream, ImageFormat.Tiff); 
```

将 Tiff 放入另一个 Image 对象中

```
Image tiff = Image.FromStream(byteStream) 
```

准备编码器：

```
var encoderInfo = ImageCodecInfo.GetImageEncoders().First(i => i.MimeType == "image/tiff");

EncoderParameters encoderParams = new EncoderParameters(2);
encoderParams.Param[0] = new EncoderParameter(Encoder.Compression, (long)EncoderValue.CompressionNone);
encoderParams.Param[1] = new EncoderParameter(Encoder.SaveFlag, (long)EncoderValue.MultiFrame); 
```

保存到文件：

```
tiff.Save(sOutFilePath, encoderInfo, encoderParams); 
```

对于后续页面，准备编码器：

```
EncoderParameters EncoderParams = new EncoderParameters(2);
EncoderParameter SaveEncodeParam = new EncoderParameter(
     Encoder.SaveFlag, 
     (long)EncoderValue.FrameDimensionPage);
EncoderParameter CompressionEncodeParam = new EncoderParameter(
     Encoder.Compression, (long)EncoderValue.CompressionNone);
EncoderParams.Param[0] = CompressionEncodeParam;
EncoderParams.Param[1] = SaveEncodeParam;
tiff.SaveAdd(/* next image as tiff - do the same as above with memory */, EncoderParams); 
```

最后刷新文件：

```
EncoderParameter SaveEncodeParam = new EncoderParameter(
     Encoder.SaveFlag, (long)EncoderValue.Flush);
EncoderParams = new EncoderParameters(1);
EncoderParams.Param[0] = SaveEncodeParam;
tiff.SaveAdd(EncoderParams); 
```

那应该让你开始。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2011-10-06T14:42:31.167

在谷歌上搜索了一下之后发现了这篇文章。我尝试了 a'b'c'd'e'f'g'h' 在帖子中的代码，但这对我不起作用。也许，我没有正确地做某事。

无论如何，我发现另一篇将图像保存到多页 tiff 的帖子。这是帖子的链接：[向多帧 TIFF 添加帧](https://web.archive.org/web/20150405144620/http://bobpowell.net/addframes.aspx)。

另外，这是对我有用的代码。它应该与那个帖子相同。

```
Encoder encoder = Encoder.SaveFlag;
ImageCodecInfo encoderInfo = ImageCodecInfo.GetImageEncoders().First(i => i.MimeType == "image/tiff");
EncoderParameters encoderParameters = new EncoderParameters(1);
encoderParameters.Param[0] = new EncoderParameter(encoder, (long)EncoderValue.MultiFrame);

// Save the first frame of the multi page tiff
Bitmap firstImage = (Bitmap) _scannedPages[0].RawContent;
firstImage.Save(fileName, encoderInfo, encoderParameters);

encoderParameters.Param[0] = new EncoderParameter(encoder, (long)EncoderValue.FrameDimensionPage);

// Add the remaining images to the tiff
for (int i = 1; i < _scannedPages.Count; i++)
{
   Bitmap img = (Bitmap) _scannedPages[i].RawContent;
   firstImage.SaveAdd(img, encoderParameters);
}

// Close out the file
encoderParameters.Param[0] = new EncoderParameter(encoder, (long)EncoderValue.Flush);
firstImage.SaveAdd(encoderParameters); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2018-09-03T13:31:02.220

死灵
法 公认的答案有点含糊。
这是完整的工作代码：

```
public class MultiPageTiff
{

    private static System.Drawing.Imaging.ImageCodecInfo GetEncoderInfo(string mimeType)
    {
        System.Drawing.Imaging.ImageCodecInfo[] encoders =
            System.Drawing.Imaging.ImageCodecInfo.GetImageEncoders();

        if (encoders != null)
        {
            for (int i = 0; i < encoders.Length; i++)
            {
                if (encoders[i].MimeType == mimeType)
                {
                    return encoders[i];
                } // End if (encoders[i].MimeType == mimeType) 
            } // Next i 

        } // End if (encoders != null) 

        return null;
    } // End Function GetEncoderInfo 

    public static System.Drawing.Image Generate(string[] filez)
    {
        System.Drawing.Image multiPageFile = null;
        byte[] ba = null;

        System.Drawing.Imaging.ImageCodecInfo tiffCodec = GetEncoderInfo("image/tiff");

        using (System.IO.MemoryStream ms = new System.IO.MemoryStream())
        {
            for (int i = 0; i < filez.Length; ++i)
            {
                using (System.Drawing.Image inputImage = System.Drawing.Image.FromFile(filez[i]))
                {

                    using (System.IO.MemoryStream byteStream = new System.IO.MemoryStream())
                    {
                        inputImage.Save(byteStream, System.Drawing.Imaging.ImageFormat.Tiff);

                        if (i == 0)
                        {
                            multiPageFile = System.Drawing.Image.FromStream(byteStream);
                            multiPageFile = SaveImages(tiffCodec, ms, multiPageFile, null);
                        }
                        else
                        {

                            using (System.Drawing.Image tiffImage = System.Drawing.Image.FromStream(byteStream))
                            {
                                multiPageFile = SaveImages(tiffCodec, ms, tiffImage, multiPageFile);
                            } // End Using tiffImage 

                        }
                    } // End Using byteStream 

                } // End Using inputImage 

            } // Next i 

            ba = ms.ToArray();
        } // End Using ms 

        System.IO.File.WriteAllBytes(@"d:\mytiff.tiff", ba);

        //if (multiPageFile != null)
        //{
        //    multiPageFile.Dispose();
        //    multiPageFile = null;
        //}

        return multiPageFile;
    }

    private static System.Drawing.Image SaveImages(
          System.Drawing.Imaging.ImageCodecInfo tiffCodec
        , System.IO.MemoryStream outputStream
        , System.Drawing.Image tiffImage, System.Drawing.Image firstImage)
    {

        using (System.Drawing.Imaging.EncoderParameters encParameters =
              new System.Drawing.Imaging.EncoderParameters(3))
        {

            if (firstImage == null)
            {
                encParameters.Param[0] = new System.Drawing.Imaging.EncoderParameter(
                    System.Drawing.Imaging.Encoder.SaveFlag
                    , (long)System.Drawing.Imaging.EncoderValue.MultiFrame // 18L 
                );
            }
            else
            {
                encParameters.Param[0] = new System.Drawing.Imaging.EncoderParameter(
                    System.Drawing.Imaging.Encoder.SaveFlag
                    , (long)System.Drawing.Imaging.EncoderValue.FrameDimensionPage // 23L
                );
            }

            encParameters.Param[1] = new System.Drawing.Imaging.EncoderParameter(
                System.Drawing.Imaging.Encoder.ColorDepth, 24L
            );

            encParameters.Param[2] = new System.Drawing.Imaging.EncoderParameter(
                System.Drawing.Imaging.Encoder.Compression
                , (long)System.Drawing.Imaging.EncoderValue.CompressionLZW
            );

            if (firstImage == null)
            {
                firstImage = tiffImage;

                ((System.Drawing.Bitmap)tiffImage).SetResolution(96, 96);
                firstImage.Save(outputStream, tiffCodec, encParameters);
            }
            else
            {
                ((System.Drawing.Bitmap)tiffImage).SetResolution(96, 96);

                firstImage.SaveAdd(tiffImage, encParameters);
            }

            if (encParameters.Param[0] != null)
                encParameters.Param[0].Dispose();

            if (encParameters.Param[1] != null)
                encParameters.Param[1].Dispose();

            if (encParameters.Param[2] != null)
                encParameters.Param[2].Dispose();

        } // End Using encParameters 

        return firstImage;
    }

} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-10-30T16:38:35.293

有帮助的话题。谢谢（你的）信息。我需要从 base64 编码字符串数组拼接多页图像。这是我根据这个线程中的信息汇总的。我不太明白为什么我必须创建一个明确指定的图像格式的内存流，但这是最终的工作，如果有更好的方法来处理这个问题，请告诉我。谢谢

```
/// <summary>
    /// Takes in an array of base64 encoded strings and creates a multipage tiff.
    /// </summary>
    /// <param name="sOutFile">file to be generated</param>
    /// <param name="pagesbase64Array"></param>
    private void SaevAsMultiPageTiff(string sOutFile, string[] pagesbase64Array)
    {
        System.Drawing.Imaging.Encoder encoder = System.Drawing.Imaging.Encoder.SaveFlag;
        ImageCodecInfo encoderInfo = ImageCodecInfo.GetImageEncoders().First(i => i.MimeType == "image/tiff");
        EncoderParameters encoderParameters = new EncoderParameters(1);
        encoderParameters.Param[0] = new EncoderParameter(encoder, (long)EncoderValue.MultiFrame);

        Bitmap firstImage = null;
        try
        {

            using (MemoryStream ms1 = new MemoryStream())
            {
                using (MemoryStream ms = new MemoryStream(Convert.FromBase64String(pagesbase64Array[0])))
                {
                    Image.FromStream(ms).Save(ms1, ImageFormat.Tiff);
                    firstImage = (Bitmap)Image.FromStream(ms1);
                }
                // Save the first frame of the multi page tiff
                firstImage.Save(sOutFile, encoderInfo, encoderParameters); //throws Generic GDI+ error if the memory streams are not open when this is called
            }

            encoderParameters.Param[0] = new EncoderParameter(encoder, (long)EncoderValue.FrameDimensionPage);

            Bitmap imagePage;
            // Add the remining images to the tiff
            for (int i = 1; i < pagesbase64Array.Length; i++)
            {

                using (MemoryStream ms1 = new MemoryStream())
                {
                    using (MemoryStream ms = new MemoryStream(Convert.FromBase64String(pagesbase64Array[i])))
                    {
                        Image.FromStream(ms).Save(ms1, ImageFormat.Tiff);
                        imagePage = (Bitmap)Image.FromStream(ms1);
                    }

                    firstImage.SaveAdd(imagePage, encoderParameters); //throws Generic GDI+ error if the memory streams are not open when this is called
                }
            }

        }
        catch (Exception)
        {
            //ensure the errors are not missed while allowing for flush in finally block so files dont get locked up.
            throw;
        }
        finally
        {
            // Close out the file
            encoderParameters.Param[0] = new EncoderParameter(encoder, (long)EncoderValue.Flush);
            firstImage.SaveAdd(encoderParameters);
        }
    } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-29T20:17:57.860

[在处理和创建标准化格式的文件时，我不喜欢 Microsoft 的跟踪记录，我建议使用 ImageMagick，它以MagickNet](http://midimick.com/magicknet/magickDoc.html)的形式作为 .Net 库提供（注意，[http](http://midimick.com/magicknet/) ://midimick.com/magicknet/目前有一个间谍软件弹出窗口，我已提醒网站所有者）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-02-13T09:35:23.137

这里是多tiff文件的拆分操作。它就像字符串子字符串函数一样工作。图像的第一个索引将是您的 MasterBitMap，您将继续向 MasterBitmap 添加帧，直到索引结束。

```
public void SaveMultiFrameTiff(int start, int end)
    {            
        string outputFileName = "out.TIF";  
        string inputFileName = "input.TIF";            

        try
        {                

            Bitmap MasterBitmap = new Bitmap(inputFileName ); //Start page of document(master)
            Image imageAdd = Image.FromFile(inputFileName );  //Frame Image that will be added to the master          
            Guid guid = imageAdd.FrameDimensionsList[0]; //GUID
            FrameDimension dimension = new FrameDimension(guid);
            // start index cannot be less than 0 and cannot be greater than frame count        
            if (start < 1 || end > MasterBitmap.GetFrameCount(dimension)) { return; }        

            EncoderParameters ep = new EncoderParameters(1);

            //Get Image Codec Information
            ImageCodecInfo[] codecs = ImageCodecInfo.GetImageEncoders();
            ImageCodecInfo codecInfo = codecs[3]; //image/tiff

            //MultiFrame Encoding format
            EncoderParameter epMultiFrame = new EncoderParameter(System.Drawing.Imaging.Encoder.SaveFlag, (long)EncoderValue.MultiFrame);
            ep.Param[0] = epMultiFrame;
            MasterBitmap.SelectActiveFrame(dimension, start - 1);
            MasterBitmap.Save(outputFileName, codecInfo, ep);//create master document

            //FrameDimensionPage Encoding format
            EncoderParameter epFrameDimensionPage = new EncoderParameter(System.Drawing.Imaging.Encoder.SaveFlag, (long)EncoderValue.FrameDimensionPage);
            ep.Param[0] = epFrameDimensionPage;

            for (int i = start; i < end; i++)
            {
                imageAdd.SelectActiveFrame(dimension, i);//select next frame
                MasterBitmap.SaveAdd(new Bitmap(imageAdd), ep);//add it to the master
            }

            //Flush Encoding format
            EncoderParameter epFlush = new EncoderParameter(System.Drawing.Imaging.Encoder.SaveFlag, (long)EncoderValue.Flush);
            ep.Param[0] = epFlush;
            MasterBitmap.SaveAdd(ep); //flush the file                   
        }
        catch (Exception ex)
        {
            throw ex;
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-02-22T17:41:47.527

这是在 vb.net 中执行此操作的方法：

```
Imports System.Drawing.Imaging

Sub CreateTiff(sOutTiffFile As String, sInFile1 As String, sInFile2 As String)
    Dim bitmap As Bitmap = Image.FromFile(sInFile1)
    Dim byteStream As MemoryStream = New MemoryStream()
    bitmap.Save(byteStream, System.Drawing.Imaging.ImageFormat.Tiff)

    Dim tiff As Image = Image.FromStream(byteStream)

    Dim oParams As EncoderParameters = New EncoderParameters(2)
    oParams.Param(0) = New EncoderParameter(Imaging.Encoder.Compression, EncoderValue.CompressionCCITT4)
    oParams.Param(1) = New EncoderParameter(Imaging.Encoder.SaveFlag, EncoderValue.MultiFrame)
    tiff.Save(sOutTiffFile, GetEncoderInfo("image/tiff"), oParams)

    'Next Page
    Dim bitmap2 As Bitmap = Image.FromFile(sInFile2)
    oParams.Param(1) = New EncoderParameter(Imaging.Encoder.SaveFlag, EncoderValue.FrameDimensionPage)
    tiff.SaveAdd(bitmap2, oParams)

    'Flush 
    Dim oFlushParams As EncoderParameters = New EncoderParameters(1)
    oFlushParams.Param(0) = New EncoderParameter(Imaging.Encoder.SaveFlag, EncoderValue.Flush)
    tiff.SaveAdd(oFlushParams)
End Sub

Private Function GetEncoderInfo(mimeType As String) As System.Drawing.Imaging.ImageCodecInfo
    Dim encoders = System.Drawing.Imaging.ImageCodecInfo.GetImageEncoders()
    For i As Integer = 0 To encoders.Length - 1
        If encoders(i).MimeType = mimeType Then
            Return encoders(i)
        End If
    Next
    Return Nothing
End Function 
```

# c - 为什么星号在变量名之前，而不是在类型之后？

> ID：398395
> 
> 赞同：231
> 
> 时间：2008-12-29T19:22:25.443
> 
> 标签：c, pointers, variables, naming-conventions

为什么大多数 C 程序员都这样命名变量：

```
int *myVariable; 
```

而不是这样：

```
int* myVariable; 
```

两者都是有效的。在我看来，星号是类型的一部分，而不是变量名的一部分。谁能解释一下这个逻辑？

* * *

## 回答 #1

> 赞同：295
> 
> 时间：2008-12-29T19:28:47.973

它们是完全等价的。然而，在

```
int *myVariable, myVariable2; 
```

很明显 myVariable 的类型为**int***，而 myVariable2 的类型为**int**。在

```
int* myVariable, myVariable2; 
```

**两者都是int***类型似乎很明显，但这与**int**`myVariable2`类型不正确。

 **因此，第一种编程风格更直观。

* * *

## 回答 #2

> 赞同：146
> 
> 时间：2008-12-29T19:25:26.687

如果换个角度看，`*myVariable`is 是 type `int`，这是有道理的。

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2015-07-22T11:23:20.500

到目前为止没有人在这里提到的是这个星号实际上是 C 中的“*取消引用运算符*”。

```
*a = 10; 
```

上面的行并不意味着我要分配`10`给`a`，这意味着我要分配`10`给任何内存位置`a`指向的位置。而且我从未见过有人写作

```
* a = 10; 
```

你？所以*解引用操作符*几乎总是写成没有空格。这可能是为了将它与跨越多行的乘法区分开来：

```
x = a * b * c * d
  * e * f * g; 
```

这里`*e`会误导，不是吗？

好的，现在以下行实际上是什么意思：

```
int *a; 
```

大多数人会说：

*这意味着这`a`是一个指向`int`值的指针。*

这在技术上是正确的，大多数人喜欢以这种方式查看/阅读它，这就是现代 C 标准定义它的方式（请注意，语言 C 本身早于所有 ANSI 和 ISO 标准）。但这不是看待它的唯一方法。您还可以按如下方式阅读此行：

**的取消引用值的`a`类型为`int`。**

所以实际上这个声明中的星号也可以看作是一个解引用操作符，这也说明了它的位置。那`a`是一个指针根本没有真正声明，这是一个隐含的事实，你唯一可以真正取消引用的是一个指针。

C标准只对`*`操作符定义了两种含义：

*   间接运算符
*   乘法运算符

而且间接只是一个单一的含义，声明指针没有额外的含义，只有间接，这就是解引用操作所做的，它执行间接访问，所以在这样的语句`int *a;`中也是间接**访问**（`*`意味着间接访问），因此上面的第二个语句比第一个语句更接近标准。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2008-12-29T19:35:23.547

因为该行中的 * 与变量的绑定比与类型的绑定更紧密：

```
int* varA, varB; // This is misleading 
```

正如@Lundin 在下面指出的那样， const 增加了更多需要考虑的微妙之处。您可以通过每行声明一个变量来完全回避这一点，这绝不是模棱两可的：

```
int* varA;
int varB; 
```

清晰代码和简洁代码之间的平衡很难达到——十几行冗余代码`int a;`也不好。尽管如此，我还是默认每行一个声明，并担心以后合并代码。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2011-10-14T15:30:55.243

我要在这里冒个险，说*这个问题有一个直接的答案*，对于变量声明以及参数和返回类型，星号应该放在名称旁边：`int *myVariable;`。要了解原因，请查看如何在 C 中声明其他类型的符号：

`int my_function(int arg);`对于一个函数；

`float my_array[3]`对于一个数组。

一般的模式，称为**声明后使用**，是符号的类型被分成名称之前的部分和名称*周围*的部分，并且名称周围的这些部分模仿您用来获取左侧类型的值：

`int a_return_value = my_function(729);`

`float an_element = my_array[2];`

和：`int copy_of_value = *myVariable;`。

C++ 在使用引用的工作中抛出了一个扳手，因为您使用引用的语法与值类型的语法相同，因此您可能会争辩说 C++ 对 C 采取了不同的方法。另一方面，C++ 保留了相同的在指针的情况下 C 的行为，所以在这方面引用确实是奇怪的。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2016-03-08T19:33:48.397

一位伟大的大师曾经说过“必须按照编译器的方式阅读它”。

[http://www.drdobbs.com/conversationsa-midsummer-nights-madness/184403835](http://www.drdobbs.com/conversationsa-midsummer-nights-madness/184403835)

当然这是关于 const 放置的主题，但同样的规则也适用于这里。

编译器将其读取为：

```
int (*a); 
```

不是：

```
(int*) a; 
```

如果您养成将星号放在变量旁边的习惯，它将使您的声明更易于阅读。它还避免了诸如：

```
int* a[10]; 
```

- 编辑 -

当我说它被解析为 时，要准确解释我的意思`int (*a)`，这意味着它与 的`*`绑定比它对 的绑定更紧密，`a`这与表达式中的绑定比它更紧密地绑定`int`的方式非常相似，因为 的优先级更高。`4 + 3 * 7` `3``7``4``*`

为 ascii 艺术道歉，用于解析的 AST 概要`int *a`大致如下所示：

```
 Declaration
      /         \
     /           \
Declaration-      Init-
Secifiers       Declarator-
    |             List
    |               |
    |              ...
  "int"             |
                Declarator
                /       \
               /        ...
           Pointer        \
              |        Identifier
              |            |
             "*"           |
                          "a" 
```

正如清楚地表明的那样，由于它们的共同祖先是，因此`*`绑定更紧密，而您需要一直向上查找涉及 的共同祖先。`a``Declarator``Declaration``int`

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-12-29T19:35:37.133

这只是一个偏好问题。

当您阅读代码时，在第二种情况下区分变量和指针更容易，但是当您将通用类型的变量和指针放在一行中时可能会导致混淆（项目指南通常不鼓励这样做，因为降低了可读性）。

我更喜欢在类型名称旁边声明带有相应符号的指针，例如

```
int* pMyPointer; 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2019-07-11T17:52:00.523

喜欢`int* x;`的人试图将他们的代码强制进入一个虚构的世界，其中类型在左侧，标识符（名称）在右侧。

我说“虚构”是因为：

> 在 C 和 C++ 中，在一般情况下，声明的标识符被类型信息包围。

这听起来可能很疯狂，但你知道这是真的。这里有些例子：

*   `int main(int argc, char *argv[])`意思是“`main`是一个函数，它接受一个`int`和一个指针数组`char`并返回一个`int`。” 换句话说，*大多数*类型信息都在右侧。有些人认为函数声明不算数，因为它们在某种程度上是“特殊的”。好的，让我们尝试一个变量。

*   `void (*fn)(int)`mean`fn`是一个指向一个函数的指针，它接受一个`int`并且什么都不返回。

*   `int a[10]``int`将 'a' 声明为 10秒的数组。

*   `pixel bitmap[height][width]`.

*   显然，我挑选了一些在右边有很多类型信息的例子来说明我的观点。有很多声明，其中大多数（如果不是全部）类型位于左侧，例如`struct { int x; int y; } center`.

这种声明语法源于 K&R 希望让声明反映使用情况。阅读简单的声明很直观，阅读更复杂的声明可以通过学习左右规则（有时称为螺旋规则或仅称为左右规则）来掌握。

C 语言非常简单，以至于许多 C 程序员都接受这种风格并将简单的声明编写为`int *p`.

在 C++ 中，语法变得更加复杂（包括类、引用、模板、枚举类），并且作为对这种复杂性的反应，您将看到在许多声明中将类型与标识符分开的努力。换句话说，`int* p`如果您查看大量 C++ 代码，您可能会看到更多 - 样式的声明。

在任何一种语言中，您始终*可以通过以下方式在**变量*声明`typedef`的左侧拥有类型类型左侧的标识符）。例如：

```
typedef int array_of_10_ints[10];
array_of_10_ints a; 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2019-06-04T11:07:01.153

这个主题中的很多论点都是主观的，关于“星号绑定到变量名”的论点是幼稚的。这里有一些不仅仅是意见的论点：

* * *

***被遗忘的指针类型限定符***

形式上，“星”既不属于类型也不属于变量名，它是它自己的语法项的一部分，名为*指针*。正式的 C 语法 (ISO 9899:2018) 是：

> (6.7) 声明：
> *声明说明符* *init-declarator-list* [opt] `;`

其中*declaration-specifiers*包含类型（和存储），而*init-declarator-list*包含指针和变量名。如果我们进一步剖析这个声明符列表语法，我们会看到：

> (6.7.6)*声明器：*
> *指针[opt]直接声明*
> 器 ...
> (6.7.6)*指针：*
> `*` *type-qualifier-list* [opt]
> `*` *type-qualifier-list* [opt] *指针*

声明符是整个声明，直接声明符是标识符（变量名），指针是星号，后跟属于指针本身的可选类型限定符列表。

是什么让关于“星属于变量”的各种风格参数不一致，是他们忘记了这些指针类型限定符。`int* const x`,`int *const x`或`int*const x`?

考虑一下和`int *const a, b;`的类型是什么？不再那么明显，“星星属于变量”。相反，人们会开始思考属于哪里。`a``b``const`

您绝对可以提出一个合理的论点，即星号属于指针类型限定符，但仅此而已。

指针的类型限定符列表可能会给使用该`int *a`样式的人带来问题。那些在 a 中使用指针`typedef`（我们不应该这样做，非常糟糕的做法！）并认为“星号属于变量名”的人倾向于编写这个非常微妙的错误：

```
 /*** bad code, don't do this ***/
    typedef int *bad_idea_t; 
    ...
    void func (const bad_idea_t *foo); 
```

这编译得很干净。现在你可能会认为代码是 const 正确的。不是这样！此代码意外地是伪造的 const 正确性。

的类型`foo`实际上是`int*const*`- 最外面的指针是只读的，而不是指向的数据。所以在这个函数里面我们可以做`**foo = n;`，它会改变调用者中的变量值。

这是因为在表达式`const bad_idea_t *foo`中，`*`不属于这里的变量名！在伪代码中，此参数声明将被读取为`const (bad_idea_t *) foo`而*不是*`(const bad_idea_t) *foo`。在这种情况下，星形属于隐藏指针类型 - 类型是指针，并且 const 限定的指针写为`*const`.

但是上面示例中问题的根源在于将指针隐藏在 a`typedef`而不是`*`样式后面的做法。

* * *

***关于在一行上声明多个变量***

在一行上声明多个变量被广泛认为是不好的做法^(1))。CERT-C 很好地总结为：

> DCL04-C。每次声明不要声明多个变量

只是阅读英文，然后常识同意*一个*声明应该是*一个*声明。

变量是否是指针并不重要。在单行上声明每个变量可以使代码在几乎所有情况下都更加清晰。

因此，关于程序员感到困惑的论点`int* a, b`是不好的。问题的根源在于使用了多个声明符，而不是`*`. 不管风格如何，你都应该写这个：

```
 int* a; // or int *a
    int b; 
```

* * *

另一个合理但主观的论点是，给定`int* a`的类型`a`是毫无疑问`int*`的，因此星号属于类型限定符。

但基本上我的结论是，这里发布的许多论点都是主观和幼稚的。你不能真正为任何一种风格做出有效的论据——这确实是一个主观个人偏好的问题。

* * *

1) [CERT-C DCL04-C](https://wiki.sei.cmu.edu/confluence/display/c/DCL04-C.+Do+not+declare+more+than+one+variable+per+declaration)。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-29T19:27:25.153

因为当你有这样的声明时它更有意义：

```
int *a, *b; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-10-18T05:25:34.587

对于在一行中声明多个指针，我更喜欢`int* a, * b;`更直观地将“a”声明为指向整数的指针，并且在同样声明“b”时不混合样式。就像有人说的那样，无论如何我都不会在同一个语句中声明两种不同的类型。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-02-10T10:57:13.980

当您在一个语句中初始化和分配变量时，例如

```
int *a = xyz; 
```

您将值分配`xyz`给`a`，而不是`*a`。这使得

```
int* a = xyz; 
```

更一致的符号。

# php - PHP：实现 SeekableIterator 接口

> ID：398398
> 
> 赞同：1
> 
> 时间：2008-12-29T19:23:22.650
> 
> 标签：php, seekableiterator

我目前正在编写一个实现 SeekableIterator 接口的类并且遇到了问题。我有两个正在使用的内部数组，并希望允许从类外部对它们进行迭代。有没有一种简单的方法可以在不首先合并类中的两个数组的情况下做到这一点？这是我正在尝试做的一个简单示例：

```
class BookShelf implements ArrayAccess, Countable, SeekableIterator {
    protected $_books = array(...);
    protected $_magazines = array(...);

    /**** CLASS CONTENT HERE ****/
}

$shelf = new BookShelf();

// Loops through both arrays, first books (if any) and then magazines (if any)
foreach($shelf as $item) {
    echo $item;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T19:42:26.387

假设这些数组都是数字索引的，如果当前索引小于

```
count($this->_books); 
```

然后返回

```
$this->_books[$index]; 
```

否则，如果索引小于 count(books)+count(magazines)，则返回

```
$this->_magazines[$index-count($this->_books)] 
```

如果两者都失败，可能会出现 OutOfBoundsException。

其他一切都应该到位。

# windows-xp - 任务计划拒绝

> ID：398400
> 
> 赞同：0
> 
> 时间：2008-12-29T19:23:46.767
> 
> 标签：windows-xp, scheduled-tasks

尽管有些人可能不认为它与编程相关，但它确实是。任务调度程序是一个程序。它正在启动我编写的流程。说这是一个常见问题并不是很有帮助。

我已经在家里的 Windows xP 机器和办公室的几台机器上设置了自己的备份程序，在那里我使用任务计划程序启动备份文件，该文件对所有文件的 xcopy 进行 xcopy，其日期比什么都新在备份驱动器上到备份驱动器。

尝试为朋友进行设置时，即使设置了他的登录密码，我也无法运行任务计划程序。

他最近摆脱了他所有的诺顿防病毒软件。. . 可能有联系吗？

我也有我自己的 Windows 2000 机器，我很久以前就从这台机器上删除了 Norton，而且任务调度程序也不能在那里工作。. . 那里并不那么重要，因为那台机器上的数据波动性已经不大了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T19:35:43.763

也许是一个愚蠢的问题 - 但他的登录名是盒子上的管理员吗？我会设置一个“服务帐户”并赋予它管理员权限并在该帐户下运行任务。防病毒或防火墙可能存在残留问题 - 根据他现在使用的内容，他可能必须明确授权该程序运行。

确保使用的任何帐户都不必登录即可运行 - 当然机器必须打开。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T19:38:43.260

任务调度程序服务是否正在运行？是否设置为“自动”启动？

要检查，请打开您的控制面板，转到“管理工具”，然后转到“服务”。在列表中找到“任务计划程序”并确保它正在运行。

编辑：另外，如果它设置为作为另一个用户运行的任务，请确保“RunAs”（Win2k）或“Secondary Logon”（在 XP/Vista 中）服务也在运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T19:36:26.837

我会开始：

1.  替换任务脚本以完成更简单的任务，即尽可能独立于权限等 - 只是为了确保它启动。一个简单的虚拟任务可能是在临时文件夹中创建一个目录。
2.  如果“运行身份”用户已登录，检查任务调度程序是否会运行该进程
3.  确保系统用户可以访问要运行的文件/脚本/程序

...然后从那里拿走它。

# deployment - Windows 磁盘克隆与自动安装服务器

> ID：398410
> 
> 赞同：0
> 
> 时间：2008-12-29T19:27:30.660
> 
> 标签：deployment, scripting, windows-server-2003

在开发、测试和部署期间，我需要完全自动化 Windows 2003 服务器设置。

我正在尝试找到自动删除服务器的最佳方法，该服务器安装操作系统、我拥有的软件依赖项（例如 SQL 服务器、.net 框架 + 我自己的应用程序代码）。

根据我的发现，有两种方法可以解决这个问题：

1.  磁盘克隆（也称为磁盘映像）。使用 Ghost、Acronis 等工具。
2.  无人值守安装 OS + SW。使用 RIS（现在称为 WDS）或[Unattended](http://unattended.sourceforge.net/)，基本上运行无人值守的操作系统安装，然后无人值守安装首次启动所需的所有软件（使用 Windows 安装管理器的各种命令行标志，如 MSI、InstallSheld.

**无人值守安装专家：**

*   在创建无人值守安装的脚本/配置中自行记录整个安装和配置的优势
*   这些脚本/配置可以位于修订控制系统中。
*   使用[DriverPacks](http://driverpacks.net/)可以灵活地安装在几乎任何硬件上。

**无人值守安装缺点：**

*   完全部署需要更长的时间。
*   比只需要安装、手动配置服务器然后克隆它的磁盘克隆需要完成更多的工作。

**磁盘克隆优点：**

*   创建克隆的工作更少。
*   快速部署。

**磁盘克隆缺点：**

*   很难跟踪克隆之前发生的配置/安装更改，因为它们都不是脚本化的。
*   生成的部署不像临时安装那样“干净”，需要他使用 SysPrep 或类似的东西。
*   将磁盘克隆还原到新硬件时，可能会出现硬件/驱动程序问题。

我知道这不是严格意义上的编程问题（尽管编写无人值守的 Windows + S/W 安装确实需要一些编码），但这是我们所有人都必须不时做的事情，我们不妨想出最好的方法来做到这一点。

编辑：有关情况的更多信息：虚拟化是开发的不错选择，但对于测试，尤其是压力测试，必须使用具有快速磁盘的真实硬件。

需要开发 Windows Server 2003 和 SQL Server 2005 服务器设备和内部应用程序。因此，这将在内部部署以进行开发和测试，并最终出售给客户。

所以基本上我要问的是：安装开发、测试和生产服务器的推荐方法是什么？磁盘克隆？自动安装？两者的结合？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T19:55:30.683

我不知道这是否适合您的情况，但要认真考虑的另一件事是虚拟化。

虚拟化基本上具有磁盘克隆的所有好处，但您没有硬件/驱动程序问题。

如果您在基础 VM 上的正确时间点拍摄快照，您将能够恢复到基础映像安装过程中的任何时间点。

当然，代价是虚拟化会降低您的性能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T20:36:17.433

你已经弄清楚了基本的利弊，但如果我们要提供任何帮助，我想我们需要更多关于你的情况的信息。这将部署在多少台服务器上？内部应用程序，待售应用程序？有很多变数。基本上，你的情况如何？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-14T13:22:29.167

我知道这是一篇较旧的帖子，但由于它出现在我的搜索中，我认为它可能会出现在其他人中。

拍摄 VM 的快照时，通常会将它们保存为 .vhd 文件，该文件本质上是一个映像，并且可以写入真实的硬盘。如果您在 vm 中配置操作系统，您应该能够对其进行快照并将其移动到另一个 vm 主机，甚至将其安装到真实硬件上。

使用像 HyperV 或 VMWare 这样的虚拟机不需要或使用额外的硬件驱动程序，所以当它第一次启动到真正的硬件时，它应该能够拉驱动程序并工作（在一个完美的世界中），实际上是使用设备管理器应该可以帮助您找到安装后未安装的任何驱动程序。

# firebug - 萤火虫 css 文件

> ID：398413
> 
> 赞同：0
> 
> 时间：2008-12-29T19:28:44.357
> 
> 标签：firebug

我有一个关于 .CSS 页面的萤火虫问题...

在右侧的“样式”中，您有 css ......在右边，你有 css.file 的名称......通常这是指正确的 css 文件......但有时我会得到类似的东西'template...r=default (line 458)'，所以我无法立即找到该文件。这是我可以更改的设置吗？在服务器上还是在 firebug/firefox 中？

谢谢...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T19:45:15.680

如果您将鼠标悬停在链接上，它应该会为您提供完整的文件名。我不认为有它的设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T20:05:08.853

如果您在 Firebug 中右键单击名称（或名称片段），您可以将其 url 复制到剪贴板，甚至可以直接在新选项卡中打开它。

# java - 检测未使用的属性键的简单方法？

> ID：398422
> 
> 赞同：3
> 
> 时间：2008-12-29T19:30:17.707
> 
> 标签：java, properties

给定一组属性文件和可能引用这些属性文件中的键的文件列表，确定哪些键未使用的最简单方法是什么？

例子：

给定一个带有文件的项目

*木偶.properties*

```
kermit=Kermit the Frog
oscar=Oscar the Grouch 
```

*smurfs.properties*

```
papa=Papa Smurf 
```

和*/WEB-INF/pages/template.jsp*

```
Some jsp template displaying the key <bean:write bundle='muppets' key='kermit'/>. 
```

然后运行带有输入“*.properties”和“/WEB-INF/**/*.jsp”的程序应该报告

```
Unused properties:

muppets.properties
oscar

smurfs.properties
papa 
```

最简单的方法是什么？是否有任何开源 Java 库可以让这变得简单？这个想法是将解决方案嵌入到内部 Maven 报告插件中，该插件将在构建 Web 应用程序时运行。

我知道会有误报（密钥字符串出现在非密钥上下文中的文件中），但这没关系。能够找到任何未使用的密钥会很有帮助。

编辑：我正在寻找一个独立的基于代码的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T20:04:04.300

IntelliJ IDEA 具有此功能。不幸的是，它在应用程序中使用，而不是作为 Maven 插件。

IDEA 中的一些模块是开源的。许多插件可供社区使用。也许您可以查看他们的网站，看看是否有任何可以抓取的东西。

我希望这有助于[http://www.jetbrains.net/devnet/index.jspa](http://www.jetbrains.net/devnet/index.jspa)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-28T14:13:54.033

我认为JInto可以帮助你。

[http://www.guh-software.de/jinto_en.html](http://www.guh-software.de/jinto_en.html)

# database-design - 维护数据库表行的排序顺序

> ID：398425
> 
> 赞同：12
> 
> 时间：2008-12-29T19:30:58.640
> 
> 标签：database-design

假设我在数据库表中包含有关每行新闻文章的信息。该表有一个整数“排序”列来规定文章在网站上呈现的顺序。我如何最好地实施和维护这种排序顺序。

我要避免的问题是文章编号为 1,2,3,4,..,100，当文章编号 50 突然变得有趣时，它将其排序编号设置为 1，然后它们之间的所有文章都必须具有它们的排序数增加一。

当然，将初始排序号设置为 100,200,300,400 等会留下一些移动空间，但在某些时候它会中断。

有没有正确的方法可以做到这一点，也许是完全不同的方法？

* * *

*添加-1*：

所有文章标题都显示在链接到内容的列表中，所以是的，所有排序的项目都会立即显示。

*添加-2*：

一个项目不一定移动到列表的顶部；任何项目都可以放在有序列表中的任何位置。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-29T21:23:14.873

忘记正确 - 你想避免的问题不是什么大问题，而是取决于你的 RDBMS 的几个 UPDATE 语句（我假设 Oracle 并且你正在将文章“向上”移动列表）：

```
UPDATE Articles
SET sort_number = sort_number + 1
WHERE sort_number BETWEEN :new_sort_number and :current_sort_number - 1;

UPDATE Articles
SET sort_number = :new_sort_number
WHERE article_id = :article_id; 
```

最大的警告是 SET 功能在所有 RDBMS 中的工作方式不同。

如果你真的想考虑*正确*的，考虑从数据结构的角度重新考虑这个问题——你可能要问的是如何在数据库中实现链表。

维护*排序号*列的替代方法是维护*父 ID*列。这可以说是更正确的，因为它保留了数据的序列化，但缺点是查询数据并不漂亮或高效（例如，想想 Oracle 中的 CONNECT BY）。

相反，如果问题是，*最好*的办法是考虑*父 ID*列的正确性和通过派生*排序号*列的值（可能来自*父 ID*数据或第一个解决方案）来非规范化数据。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-29T19:41:18.200

如果我正确理解您的问题；我会使用包含某种类型的排名索引号的列。这个数字不必是唯一的。您将需要提出某种类型的算法来计算排名。

然后只需对排名列进行排序，使用辅助列来处理排名关系（可能是创建日期或其他内容）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-08-21T17:40:22.083

这很简单。你需要有一个“订单栏”。

要使用此方法，您至少需要 2 列：

1.  id - 32 位`int`
2.  orderValue - 64 位`bigint` *（大整数，不是双精度！！！）*

## 插入/更新

1.  当您插入第一条新记录时，您必须
    `set orderValue = round(max_bigint / 2)`.

2.  如果插入属于列表开头的行，则必须
    `set orderValue = round("orderValue of previously inserted record" / 2)`

3.  如果插入属于列表末尾的行，则必须
    `set orderValue = round("max_bigint + orderValue of final record" / 2)`

4.  如果您插入其他任何地方，您必须
    `set orderValue = round("orderValue of record before + orderValue of record after" / 2)`

此方法具有非常大的最大列表大小。如果您遇到约束错误或者您认为您将用完分辨率，您可以随时重建 orderValue 列（规范化）。

如果您使用规范化来持续组织 orderValue 列，您可以使用 32 位 int。

它非常简单快捷！

记住 -*不要使用双打*！只有整数 - orderValue 列需要非常高的精度！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-30T18:38:03.443

在链表数据结构之后为您的表建模。去掉“排序”列，取而代之的是一个 next_article_id 列，它指向它之后的下一篇文章。然后，当您想在第 50 位添加新文章时，您只需更新文章 #49 以指向您的新文章，然后将您的新文章指向之前指向的文章 #49。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-02-19T16:19:15.817

以 Alkini 的回答为基础（我会直接回复，但目前我缺乏积分/特权）。该方法仅在新的显示顺序小于新的显示顺序时才有效。如果它是相反的方式，那么你需要在另一个方向之间移动文章。

if (new_sort_number == current_sort_number)

```
Do nothing 
```

if (new_sort_number < current_sort_number)

```
UPDATE Articles
SET sort_number = sort_number + 1
WHERE sort_number BETWEEN :new_sort_number and :current_sort_number - 1; 
```

if (new_sort_number > current_sort_number)

```
UPDATE Articles
SET sort_number = sort_number - 1
WHERE sort_number BETWEEN :current_sort_number + 1 and :new_sort_number; 
```

然后在任何一种情况下，更新被移动的文章。

```
UPDATE Articles
SET sort_number = :new_sort_number
WHERE article_id = :article_id; 
```

希望可以帮助其他人寻找通用的显示顺序更新算法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-04T22:41:39.310

使用实数似乎是计算效率最高的选择。您可以通过将两行之间的距离增加一半来在其他两行之间移动一行。要在第 1 行和第 2 行之间移动新行，请将新行计算为新行 = 第 1 行 + (第 2 行 - 第 1 行)/2.0。但是，由于浮点数限制，这个系列（使用双精度）将在 53 次迭代中收敛。所以最坏的情况你只能做 53 次插入（如果你不总是在最后一个 newrow 和 row2 之间插入，则更多）。这类似于留下空白并填充它们的想法。进行更新的想法效率较低，但在插入一定数量后不会中断。保持列索引可能会有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T19:36:31.017

使用降序排序，即最高的排序号显示在顶部。

如果应该将较旧的文章放在列表顶部，只需将其排序列设置为 MAX(Sort)+1。无需重新编号整个表。

**评论后更新**：

将排序顺序更改为浮点数。如果一篇文章的排序顺序在另外两篇文章之间重新排列，则新的排序值设置为 ((上一篇文章的排序) + (下一篇文章的排序)) / 2。否则，将排序设置为 MAX+1。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T19:48:29.730

> 我要避免的问题是文章编号为 1,2,3,4,..,100

我建议你不要尝试让你的排序键成为你的主键，或者是唯一的。如果它们的键不是唯一的，您可以拥有多个具有相同值的项目。您可能只想将排序键设置为简单的 1-10 比例。

所以也许 10 级的事情会非常有趣，5 级会很正常，而 1 级会非常无聊。当某事变得无聊或更有趣时，只需向下或向上调整排序键的值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-29T21:50:14.023

为了做到这一点，我们将行设置为递增整数，然后使用存储过程来移动项目。proc 需要两个参数，即项目的当前索引和要将其移动到的新索引。它会更新 items set index = index + sign(@newidx - @oldidx) where index between itemMax(@newidx, @oldidx) and itemMin(@newidx, @oldidx) 以更新其间的项目，然后更新更改新索引的实际项目。这不是实际的代码，只是来自记忆。在我们的表中，我们有两列，id 和索引，因此即使在某一时刻您最终在同一索引处有两个项目，我们也可以通过 ID 区分它们。这可以通过对要移动到的项目和索引 -1 进行更新来规避，然后更新其余部分，最后将 -1 处的新项目移动到新索引。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-29T22:08:56.747

我会接受大多数人所说的答案，即您的表中应该有一个单独的列，其中包含记录的排序/兴趣值。如果您想在仍然保持稳健的同时考虑某种时间参数，您可能需要尝试合并给定时间段的数据“视图”。

即每晚午夜创建主表的表视图，但仅使用过去 2 或 3 天的文章创建它，然后严格维护该表上的排序/兴趣计数。如果有人选择了不在该表中的旧文章（比如一周前），您可以随时将其插入当前视图。这样就可以获得减龄效果。

重点是在表上维护小索引，其中排序/兴趣值的插入和更新应该保持相对较快。您应该只需要在视图创建期间预先支付一次复杂的连接费用，然后您可以将其保持平坦以针对过度读取进行优化。您在视图中的最大值是多少，几百，几千？每次有人提出请求时都试图对十万个进行排序。

# fractals - 了解有关 Dragon Curves 的维基百科条目

> ID：398441
> 
> 赞同：3
> 
> 时间：2008-12-29T19:35:04.060
> 
> 标签：fractals

我正在玩 Project Euler 的[Problem 220](http://projecteuler.net/index.php?section=problems&id=220)，我对 Wikipedia 关于该主题的文章[Dragon Curve](http://en.wikipedia.org/wiki/Dragon_curve)有点困惑。关于无需绘制整条曲线即可计算第 n 个转弯方向的主题，它说：

> 首先，以 k * 2^m 的形式表示 n，其中 k 是奇数。第n 圈的方向由k mod 4 决定，即k 除以4 的余数。如果k mod 4 为1，则第n 圈为R；如果k mod 4 为1，则第n 圈为R。如果 k mod 4 为 3，则第 n 轮为 L。
> 
> 例如，要确定转弯 76376 的方向：
> 
> ```
> 76376 = 9547 x 8.
> 9547 = 2386x4 + 3
> so 9547 mod 4 = 3
> so turn 76376 is L 
> ```

*   除了检查 2 的连续幂的可分性之外，是否有一种聪明的方法可以确定 n 是否**可以表示为 k2^m？**
*   如果 n 不能以这种方式表达，这意味着什么？

（问题涉及计算长度为 2^50 的龙曲线上的点的位置，因此实际绘制曲线是不可能的。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T19:42:21.380

m 是数字最低有效端的零位数。最简单的算法是只要数字是偶数就除以 2，但您也可以使用二进制搜索来加快速度。

所有整数都可以用这种方式表示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T20:05:45.683

任何整数都可以表示为 k * 2^m，其中 k 是奇数。要了解原因，请以二进制形式写入任意数字。从右边（最低有效位）开始，将有一个全为零的字符串。它可能是一个空字符串。零的数量是 m。其余位组成 k。k 的最低有效位是一个（因为如果它是一个零，你只需扩展你的零字符串），所以 k 是奇数。

要找到 k 和 m，您可能会编写一个简单的循环（在本例中为 Python）：

```
def k_and_m(n):
    k, m = n, 0
    while (k % 2) == 0:
        k >>= 1
        m += 1
    return k, m 
```

# design-patterns - 状态机实现

> ID：398458
> 
> 赞同：4
> 
> 时间：2008-12-29T19:38:15.617
> 
> 标签：design-patterns, state-machine

我正在尝试构建一个棋盘游戏......看起来它必须使用状态机来实现......

我知道 GoF 的[状态模式](http://en.wikipedia.org/wiki/State_pattern)，但我确信必须有其他方法来实现状态机。请让我知道..如果您知道任何包含有关不同实现细节的文章或书籍（权衡每个实现），请指导我..谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T20:56:18.343

看看[拉格尔](http://www.complang.org/ragel/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T21:04:29.310

我们使用了 Harel 的状态图（类似于/等价于状态机，但更容易思考），有一本好书叫[Practical Statecharts in C/C++](https://rads.stackoverflow.com/amzn/click/com/1578201101)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T20:05:48.040

这是一个非常简单的 FSM 实现：

```
public delegate void ProcessEvent<TEvent>(TEvent ev);

public abstract class StateMachine<TEvent>
{
    private ProcessEvent<TEvent> state;

    protected ProcessEvent<TEvent> State
    {
        get { return this.state; }
        set { this.state = value; }
    }

    public void ProcessEvent(TEvent ev)
    {
        this.state(ev);
    }
} 
```

您可以按如下方式使用它：

```
public class MyFsm : StateMachine<byte>
{
    public MyFsm()
    {
        this.State = this.Started;
    }

    private void Started(byte ev)
    {
        Console.WriteLine(ev);

        if (ev == 255)
        {
            this.State = this.Stopped;
        }
    }

    private void Stopped(byte ev) { }
}

class Program
{
    static void Main(string[] args)
    {
        MyFsm fsm = new MyFsm();
        fsm.ProcessEvent((byte) 0);
        fsm.ProcessEvent((byte) 255);
        fsm.ProcessEvent((byte) 0);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-16T22:29:42.130

有限状态机为实现所有事件驱动的游戏提供了最佳平台。

由于您的目标是构建状态机，因此您可以使用现有框架，而您需要的只是添加事件提取器和操作。

一个示例框架可以在以下位置看到：

[http://www.StateSoft.org](http://www.StateSoft.org)

# cryptography - 有人计划使用 Galois 的 Cryptol 吗？

> ID：398463
> 
> 赞同：0
> 
> 时间：2008-12-29T19:39:16.003
> 
> 标签：cryptography, dsl, cryptol

我在 Dobb 博士 2008 年 12 月 29 日的电子邮件报告中看到，有一种用于设计加密系统的新 DSL（特定领域语言）。它被称为[Cryptol](http://www.galois.com/technology/communications_security/cryptol)，可从 Galois 获得。

有人看过吗？有人有使用它的计划吗？值得吗，你觉得呢？

* * *

罗伯特·甘布尔指出：

Cryptol 并不新鲜，它已经存在很多年了。新的是它（部分）对公众的可用性，它最初是为 NSA 开发和使用的。

* * *

就像布赖恩一样，我没有任何真正的理由使用 Cryptol。如果我需要（重新）验证我们拥有的基于 SSL 的实现，它可能会很有用，尽管我不确定它是否会有所帮助（我们不需要验证 SSL 库；我们可能需要验证我们的（错误）使用 SSL 库）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T19:50:50.630

看起来很有趣，但我目前没有充分的理由自己使用它。应该是对其他人的好处。

# sql - 按特定字段值排序 SQL 查询

> ID：398468
> 
> 赞同：22
> 
> 时间：2008-12-29T19:41:22.317
> 
> 标签：sql, firebird

我有一个 sql 查询（使用 Firebird 作为 RDBMS），我需要按字段 EDITION 对结果进行排序。但是，我需要按字段的内容排序。即“NE”排在第一位，“OE”排在第二位，“OP”排在第三位，空白排在最后。不幸的是，我不知道如何实现这一点。我所做的只是 ORDER BY [FIELD] ASC/DESC，仅此而已。

有什么建议么？

编辑：我真的应该澄清一下：我只是希望在这里了解更多。我现在有了它，我只有多个选择语句来定义首先显示哪个。查询相当大，我真的希望学习一种更有效的方法：例如：

```
SELECT * FROM RETAIL WHERE MTITLE LIKE 'somethi%' AND EDITION='NE'
UNION 
SELECT * FROM RETAIL WHERE MTITLE LIKE 'somethi%' AND EDITION='OE'
UNION
SELECT * FROM RETAIL WHERE MTITLE LIKE 'somethi%' AND EDITION='OP'
UNION (etc...) 
```

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-29T19:49:05.687

```
Order By Case Edition
    When 'NE' Then 1
    When 'OE' Then 2
    When 'OP' Then 3
    Else 4 End 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-29T19:47:58.187

```
SELECT 
  /*other fields*/
  CASE WHEN 'NE' THEN 1
    WHEN "OE" THEN 2
    WHEN "OP" THEN 3
    ELSE 4
END AS OrderBy
FROM
  /*Tables*/
WHERE
  /*conditions*/
ORDER BY
  OrderBy,
  /*other fields*/ 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-29T19:47:12.757

将这些值添加到另一个带有数字列的表格中：

```
Edition  Rank
NE       1
OE       2
OP       3 
```

加入表，并按 RANK 字段排序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-29T19:52:21.140

尝试：

```
select *
from MyTable
order by
case [FIELD] 
    when 'NE' then 1
    when 'OE' then 2
    when 'OP' then 3
    when '' then 4
    else 5
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-01-14T10:20:11.760

```
SELECT * FROM (

SELECT 1 as Rank, R.* FROM RETAIL R WHERE MTITLE LIKE 'somethi%' AND EDITION='NE'
   UNION ALL
SELECT 2 as Rank, R.* FROM RETAIL R WHERE MTITLE LIKE 'somethi%' AND EDITION='OE'
   UNION ALL
SELECT 3 as Rank, R.* FROM RETAIL R WHERE MTITLE LIKE 'somethi%' AND EDITION='OP'
   UNION ALL (etc...)

) ORDER BY 1 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T19:52:57.240

试试这个：

```
ORDER BY FIND_IN_SET(EDITION, 'NE,OE,OP,') 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-02T09:44:06.750

```
 CREATE TABLE #TMP
(
       ID INT IDENTITY(1,1),
       NAME VARCHAR(100),
)

INSERT INTO #TMP
SELECT 'ASHISH'
UNION ALL
SELECT 'CHANDAN'
UNION ALL
SELECT 'DILIP'
UNION ALL
SELECT 'ESHA'
UNION ALL
SELECT 'FIZA'
UNION ALL
SELECT 'MAHESH'
UNION ALL
SELECT 'VIPUL'
UNION ALL
SELECT 'ANIL'

-- I want to sort NAME column from value 'DILIP' then query will be as bellow

SELECT * FROM #TMP ORDER BY CASE WHEN NAME='DILIP' THEN '1' ELSE NAME END ASC

DROP TABLE #TMP 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-17T13:36:03.990

这个怎么样？

```
SELECT * 
FROM RETAIL
WHERE MTITLE LIKE 'somethi%'
ORDER BY POSITION(EDITION, ' OP OE NE') DESC 
```

如果 substr 为空字符串，则结果为 1。如果未找到匹配项，则结果为 0。

位置（）

在火鸟 2.1 中添加

参考： [https ://firebirdsql.org/refdocs/langrefupd21-intfunc-position.html](https://firebirdsql.org/refdocs/langrefupd21-intfunc-position.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-06-05T17:10:36.293

```
SELECT (CASE WHEN 'NE' THEN 1
    WHEN "OE" THEN 2
    WHEN "OP" THEN 3
    ELSE 4) as orden,* FROM Retail WHERE MTITLE LIKE 'somethi%' 
     AND EDITION IN ('NE', 'OE', 'OP', '') ORDER BY Orden 
```

# joomla - Joomla 主菜单 html 输出

> ID：398476
> 
> 赞同：4
> 
> 时间：2008-12-29T19:44:08.910
> 
> 标签：joomla, joomla1.5

我正在尝试编辑输出 joomla main_menu 模块，以便制作自定义下拉菜单。目前它当前输出的html是这样的：

```
<ul class="menu">
<li class="active item1" id="current"><a href="#"><span>First Level Item </span</a></li>  
<li class="parent item63"><a href="#"><span>First Level Item Parent</span></a>
<ul>
  <li class="item60"><a href="#"><span>Second Level Item</span></a></li>
  <li class="item69"><a href="#"><span>Second Level Item</span></a></li>
</ul>
</li>
<li class="item64"><a href="#"><span>First Level Item</span></a></li>
<li class="item66"><a href="#"><span>First Level Item</span></a></li> 
```

我想做的是删除输出的跨度标签。

到目前为止我所知道的是，如果我想编辑输出；在我的模板文件夹中，我创建了一个名为“html”的目录，然后在该目录中创建了一个名为“mod___mainmenu”的新目录，然后从模块目录中的现有 mod_mainmenu 文件夹中复制 default.php 文件。我为获取文件所做的所有更改都会更改输出。

我遇到的问题是我无法理解 default.php 文件中编写的代码发生了什么，因为它使用了一些我不熟悉的 XML 系统并且没有注释。

如果有人有任何想法会非常有帮助！

这是菜单的 default.php 文件中的代码：

```
defined('_JEXEC') or die('Restricted access');

if ( ! defined('modMainMenuXMLCallbackDefined') )
{

function modMainMenuXMLCallback(&$node, $args)

{
    $user   = &JFactory::getUser();
    $menu   = &JSite::getMenu();
    $active = $menu->getActive();
    $path   = isset($active) ? array_reverse($active->tree) : null;

    if (($args['end']) && ($node->attributes('level') >= $args['end']))
    {
        $children = $node->children();
        foreach ($node->children() as $child)
        {
            if ($child->name() == 'ul') {
                $node->removeChild($child);
            }
        }
    }

    if ($node->name() == 'ul') {
        foreach ($node->children() as $child)
        {
            if ($child->attributes('access') > $user->get('aid', 0)) {
                $node->removeChild($child);
            }
        }
    }

    if (($node->name() == 'li') && isset($node->ul)) {
        $node->addAttribute('class', 'parent');
    }

    if (isset($path) && in_array($node->attributes('id'), $path))
    {
        if ($node->attributes('class')) {
            $node->addAttribute('class', $node->attributes('class').' active');
        } else {
            $node->addAttribute('class', 'active');
        }
    }
    else
    {
        if (isset($args['children']) && !$args['children'])
        {
            $children = $node->children();
            foreach ($node->children() as $child)
            {
                if ($child->name() == 'ul') {
                    $node->removeChild($child);
                }
            }
        }
    }

    if (($node->name() == 'li') && ($id = $node->attributes('id'))) {
        if ($node->attributes('class')) {
            $node->addAttribute('class', $node->attributes('class').' item'.$id);
        } else {
            $node->addAttribute('class', 'item'.$id);
        }
    }

    if (isset($path) && $node->attributes('id') == $path[0]) {
        $node->addAttribute('id', 'current');
    } else {
        $node->removeAttribute('id');
    }
    $node->removeAttribute('level');
    $node->removeAttribute('access');
}

define('modMainMenuXMLCallbackDefined', true);
}
modMainMenuHelper::render($params, 'modMainMenuXMLCallback'); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T04:36:22.287

您应该尽可能避免编辑核心文件，以避免在升级时覆盖您的更改。请改用模板覆盖文件。

当我遇到这个问题时，我想在每个菜单项中添加并清空 em 标签，以允许[Gilder/Levin 图像替换](http://www.mezzoblue.com/tests/revised-image-replacement/#gilderlevin)。在我的 html 覆盖 ({templatedir}\html\mod_mainmenu\default.php) 中，我用输出缓冲区包围了对 modMainMenuHelper::render 的调用（基本上是最后一行），并使用了一个简单的 str_replace 来添加 em 标签：

```
ob_start();
modMainMenuHelper::render($params, 'modMainMenuXMLCallback');
$mainMenuContent = ob_get_clean();
echo str_replace('</span>', '</span><em></em>', $mainMenuContent); 
```

由于您只想摆脱 span 标签，您可以这样做：

```
ob_start();
modMainMenuHelper::render($params, 'modMainMenuXMLCallback');
$mainMenuContent = ob_get_clean();
echo str_replace(array('<span>','</span>'), array('',''), $mainMenuContent); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T21:43:14.693

事实证明，跨度标签被添加到一个完全不同的文件中。

如果你去 modules/mod_mainmenu 目录，会有一个 helper.php 文件，它也控制一些输出。

在第 285 和 293 行，代码中有一些 span 标签。删除那些使输出按照我想要的方式工作。

# .net - winforms控件大小限制

> ID：398485
> 
> 赞同：1
> 
> 时间：2008-12-29T19:47:56.827
> 
> 标签：.net, winforms, controls

我正在使用面板的绘制事件来显示一个非常长的图表。我遇到了 .net 控件大小（高度和宽度）被默默限制为有符号 16 位整数（32,767）的问题。我假设这是一个潜在的 win32 限制。

**有没有办法绕过这个限制并拥有更大的控制？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T19:53:07.130

您可以尝试拥有自己的滚动条（而不是滚动面板），然后仅绘制图表中可见的部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T20:38:52.763

考虑渲染一个与表单长度相同的缩略图视图（一个屏幕），并用一个视图矩形指示您所在的位置。然后只需全尺寸渲染他们滚动到的部分。

假设你已经有了呈现整个 DNA 序列的代码，你甚至可能不需要做太多的改变；[Bitmap](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx)类有一个[Clone()](http://msdn.microsoft.com/en-us/library/ms141944.aspx)方法，看起来可以让您克隆 Bitmap的一个矩形部分，它还有一个[GetThumbnailImage()](http://msdn.microsoft.com/en-us/library/system.drawing.image.getthumbnailimage.aspx)方法，您可以使用它来创建缩略图。

# build-process - 配置设置最佳实践

> ID：398489
> 
> 赞同：5
> 
> 时间：2008-12-29T19:49:02.147
> 
> 标签：build-process, configuration-files, configuration-management

我想知道一些关于存储配置设置的最佳实践。假设您在多个应用程序之间共享了一些设置。我听说过存储这些需要共享的设置（XML 文件）的好方法和坏方法。

只是想知道在跨构建维护应用程序设置以更容易部署方面什么是好的标准。

我想我是从 2 个场景来看这个的：

1.  内部应用程序（无论是大型 .com 还是小型管理应用程序）。
2.  在创建供其他人使用的 API 时，当您不知道将在其应用程序中使用您的 API 的消费者的最终值是什么时，如何引用配置设置。

* * *

*添加-1*：

谢谢。我听说过一些可怕的故事，有些地方在管理多个应用程序的配置设置时遇到了噩梦。我不是一个构建人员，所以我不知道为什么，但我想肯定地尝试确保我现在在 web.config 与自定义配置文件等类型的场景方面理解它。

*添加-2*：

当您创建要使用的 API 时又如何呢？您可以说一个要提取某些配置信息的类，但是直到客户端使用您的 API（特别是 C#/.NET）才定义这些端点（属性）？您将在哪里以及如何设置这些属性，比如说您创建的配置类，例如“ApplicationDefinitions”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T21:27:35.973

我们必须支持多个 UAT（用户验收测试）、生产、开发和灾难恢复环境。

理想情况下，这些信息都在一个巨大的 LDAP 服务器中。

在现实世界中，我们编写了一个使用 Jakarta-Velocity 作为模板引擎的 ANT 任务。这会从单个模板文件生成多个文件（UAT、DEV、PROD、DR）。

我们有一个用于所有常见内容的中心文件和用于单个应用程序的较小文件。任何一个应用程序的命令行都需要知道它是否是正在运行的 UAT/DEV.. 系统等，然后它会加载公共文件和应用程序特定文件。

这在实践中效果很好，我们已经使用了大约 8 年。我见过很多其他人试图为他们的所有环境处理多个应用程序文件，但这并不漂亮。经常犯错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T19:50:49.007

如果它跨越多个应用程序，您可以（非常小心地）将设置放入 machine.config。

或者，您可以拥有一个单独的通用配置设置存储库文件，每次构建 Web 应用程序/解决方案时，该文件都会被读取并用于生成新的 web.config。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T19:51:29.100

我尝试做的是将部署到不同环境的不同配置设置分离到单独的文件中，按逻辑功能组织，然后不将这些文件包含在部署脚本中......

如果您在 .Net 中进行编码，则可以将跨多个应用程序的通用设置存储在 machine.config 中......再次，不要将它们直接放在 machine.config 中，而是创建对单独文件的引用（使用自定义的 configSection 和 configSource="" 属性来创建对该单独文件的间接引用...

# .net - Dotnetnuke 版本确定

> ID：398491
> 
> 赞同：18
> 
> 时间：2008-12-29T19:49:51.630
> 
> 标签：.net, version, dotnetnuke

我的任务是修复简单地从一台服务器复制到另一台服务器的 dotnetnuke 安装，我需要做的第一件事是弄清楚它是哪个版本。

最简单的方法是什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-29T22:19:20.470

首先列出了最简单的方法，同时还提供了其他想法。

## 检查具有“超级用户”访问权限的版本

如果相关站点已启动并正在运行并且您拥有超级用户登录名（通常是“主机”用户），则版本信息将显示在“主机”菜单下的“主机设置”页面顶部。

## 从数据库检查版本

如果站点运行不正常，或者您没有登录名，并且您可以访问数据库，则可以查询“版本”表以查找版本。

以下查询将返回正确的版本号，假设在安装 DotNetNuke 时未使用 objectQualifier。如果是，您将需要查找表名，可能是 dnn_Version。

```
select top 1 * from version order by createddate desc 
```

## 从文件系统检查版本

或者，您可以在网站的 bin 目录中找到 DotNetNuke.dll 并检查其版本。

右键单击-> 属性-> 详细信息-> 文件版本

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T19:55:52.523

以管理员身份登录并转到“主机设置”页面。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-03-11T15:14:14.940

以下 SP 给出了当前版本的 DNN

执行 dbo.GetDatabaseVersion

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-03T17:36:20.977

**注意：**此方法需要 Internet 访问权限。如果您的 Internet 连接或计算机有任何问题，请联系您的 Microsoft Windows Server 管理员（请记住将他们视为神圣实体；让自己站起来乞求帮助一直对我有用。 ..您已被警告）。

登录到 DNN 站点，就像编辑站点一样，在 DNN 徽标上方寻找一个蓝色的“更新”小按钮并单击它。这应该会将您带到显示您的版本信息的 DNN 站点。

![在此处输入图像描述](https://i.stack.imgur.com/vzvvC.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-11-12T16:22:26.447

最简单的方法是使用主机用户登录到您的 DNN 站点，然后转到主机 => 主机设置

他们可以对 DNN 版本和很多关于您当前 DNN 站点状态的信息进行罚款。

# c# - 从 C# 中的存储过程返回值

> ID：398501
> 
> 赞同：5
> 
> 时间：2008-12-29T19:53:20.360
> 
> 标签：c#, sql, database, stored-procedures

我见过一些与此类似的问题，但没有一个是完全相同的。无论如何，我有一个以行结尾的存储过程，

```
select SCOPE_IDENTITY()
return 
```

然后我通过调用`executeScalar()`. 这完美地工作。但是，我觉得以结尾`return select SCOPE_IDENTITY()`（也不为此返回值创建新参数）会更正确。这可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-29T19:57:58.820

一般来说，有三种方法可以做到这一点......您可以做您正在做的事情 - 使用 Select - 实际上返回单行单列结果集并让 ADO.Net 为您提取值。或者

您可以使用 return 语句返回值，（这种方法篡改了返回错误代码的返回值的常见使用模式）或

您可以使用所谓的 OutPut 参数，（有效地将存储的过程传递给一个参数的引用，它（过程）可以填充一个值，然后在过程返回后 ADO.net 调用代码可以使用该值.. .

每个人都有优点和缺点......我喜欢第一个选项，因为它是最简单和最容易编码的......（它不是最高效的）

在存储过程中使用输出参数的示例...

```
 Create Procedure MyProc
  @Name varchar(20),
  @DOB DateTime,
  @EmployeeId Integer Output = Null
  As
  Set NoCount On

     If @EmployeeId Is Null 
       Begin
          Insert Employees(Name, DateofBirth)
          Values (@Name, @DOB)
          Set @EmployeeId = Scope_Identity()
       End
     Else If Exists(Select * From Employees
                    Where EmployeeId =@EmployeeId)
       Begin
           Update Employees Set
              Name = Isnull(@Name, Name),
              DateOfBirth = IsNull(@DOB, DateOfBirth)
           Where EmployeeId = @EmployeeId
       End
     Else
        Raiserror('EmployeeId %d is missing or has been deleted.',
                   16, 1, @EmployeeId)

     Return 0 
```

当您从 ADO.Net 调用存储的过程并将此参数添加到参数集合中时...有一个重载，它采用一个方法参数，该参数是一个名为 ParameterDirection 的枚举，它可以采用 ParameterDirection.InputOutput 或 ParameterDirection.Output 的值， （除其他外）

# c# - 转换 SqlDataReaders

> ID：398509
> 
> 赞同：4
> 
> 时间：2008-12-29T19:57:30.460
> 
> 标签：c#, .net, sql, sqldatareader

`(int)reader[0]`替换为 有什么好处`reader.GetInt32(0)`？我敢肯定这种铸造功能的存在是有原因的，但除了自己避免铸造在美学上更令人愉悦之外，我不确定这些原因是什么。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T20:46:12.343

在代码中......

```
 void OneWay()
        {
            System.Data.SqlClient.SqlDataReader reader = null;
            int i = reader.GetInt32(0);
        }

        void OtherWay()
        {
            System.Data.SqlClient.SqlDataReader reader = null;
            int i = (int)reader[0];
        } 
```

在伊利诺伊州

```
.method private hidebysig instance void OneWay() cil managed
{
    .maxstack 2
    .locals init (
        [0] class [System.Data]System.Data.SqlClient.SqlDataReader reader,
        [1] int32 i)
    L_0000: nop 
    L_0001: ldnull 
    L_0002: stloc.0 
    L_0003: ldloc.0 
    L_0004: ldc.i4.0 
    L_0005: callvirt instance int32 [System.Data]System.Data.Common.DbDataReader::GetInt32(int32)
    L_000a: stloc.1 
    L_000b: ret 
}

.method private hidebysig instance void OtherWay() cil managed
{
    .maxstack 2
    .locals init (
        [0] class [System.Data]System.Data.SqlClient.SqlDataReader reader,
        [1] int32 i)
    L_0000: nop 
    L_0001: ldnull 
    L_0002: stloc.0 
    L_0003: ldloc.0 
    L_0004: ldc.i4.0 
    L_0005: callvirt instance object [System.Data]System.Data.Common.DbDataReader::get_Item(int32)
    L_000a: unbox.any int32
    L_000f: stloc.1 
    L_0010: ret 
} 
```

所以，IL 是不同的，但我怀疑它们之间是否存在任何明显的差异。也许在一百万次迭代之后你会看到差异，但不太可能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T20:45:27.337

前者还可以接受列名作为字符串而不是索引，并尝试将列值转换为 int。后者只接受索引并且不会执行转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T22:22:39.247

reader[0] 返回一个 System.Object，(int)reader[0] 实际上是从 Object 转换为 Int32。

如果您调用 GetXXX(0) 方法，则不会执行任何转换。因此，从流中检索的数据必须已经是方法指定的类型。

如果检索到的数据类型不匹配或该列具有 DBNull，则会引发 InvalidCastException。

# sql - SQL 视图中未使用字段的性能

> ID：398517
> 
> 赞同：3
> 
> 时间：2008-12-29T20:01:37.253
> 
> 标签：sql, performance, view, query-analyzer

我正在使用 MS SQL Server。

当我定义数据库模式时，我定义了一个（非物化）视图，其中包括许多字段，例如如下（其中“主题”是表的名称，视图是主题表上的自联接） ：

```
CREATE VIEW View_Topic_Ancestor AS
SELECT
    Subordinate.Id AS Subordinate_Id,
    Subordinate.Folder_Id AS Subordinate_Folder_Id,
    Subordinate.topicTitle AS Subordinate_topicTitle,
    Subordinate.topicXhtml AS Subordinate_topicXhtml,
    Subordinate.crossLinked AS Subordinate_crossLinked,
    Superior.Id AS Superior_Id,
    Superior.topicTitle AS Superior_topicTitle,
    Superior.topicXhtml AS Superior_topicXhtml,
    Superior.crossLinked AS Superior_crossLinked
FROM Topic AS Subordinate LEFT OUTER JOIN Topic AS Superior
ON Superior.Folder_Id = Subordinate.Folder_Id
AND 
Superior.LeftValue = (SELECT MAX(Ancestor.LeftValue)
    FROM Topic AS Ancestor
    WHERE Subordinate.LeftValue > Ancestor.LeftValue
    AND Subordinate.LeftValue < Ancestor.RightValue
    AND Subordinate.Folder_Id = Ancestor.Folder_Id) 
```

稍后（在运行时）我在 select 语句中使用此视图，如下所示：

```
SELECT
    T.Id AS Shared_Id,
    V.Superior_Id,
    V.Superior_topicTitle,
    V.Subordinate_Id,
    V.Subordinate_Folder_Id,
    V.Subordinate_topicXhtml
FROM Topic AS T, View_Topic_Ancestor AS V
WHERE Folder_Id='e2eb2b68-738d-49ad-9787-a1e655b7973f'
AND T.crossLinked = V.Subordinate_Id 
```

此 SELECT 语句不引用（不选择）视图中的许多字段：例如，它选择了 Subordinate_topicXhtml 字段，但不选择 Superior_topicXhtml 字段。

我的问题是：

1) 在视图中定义但在视图的运行时选择中未引用的字段对性能有很大影响吗？假设您愿意，Superior_topicXhtml 字段包含大量数据（是一个很长的字符串）。

2）我如何自己验证这个答案？测试（用秒表测量经过的时间）是唯一的方法，还是有可能获得基于理论的答案？我正在使用带有 SQL Express 的 Microsoft SQL Server 2008 的“Microsoft Server SQL Management Studio”。我了解如何获取（但尚未学会如何解释）此查询的“估计执行计划”，但这仅显示正在发生的索引和循环，而不是是否从未引用的字段中检索数据。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T20:07:36.180

查询优化器通过将定义视图的 sql 与您构造的用于从视图中“选择”的 sql 组合到单个 sql 查询中来创建查询计划。如果在这个组合的、优化的 sql 中，任何特定属性（列）不是必需的，则不会使用它。具体而言，如果最终选择不需要它，则不会通过网络发送。此外，如果任何 Where 子句、Order By 或优化的 sql 中的任何其他内容都不需要它，并且 ARE 需要的所有属性恰好都在索引中，那么该查询只能读取索引，而不会触及完全没有表...甚至认为他的视图引用了索引中不存在的列...您可以通过查看查询的查询执行计划来看到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T21:34:04.117

在 Management Studio 中显示查询的执行计划后，您可以使用鼠标将鼠标悬停在执行计划中的节点上。

悬停时，会显示一个大的工具提示：其中包括该节点检索到的字段的“输出列表”，以及显示读取这些字段的实例数的“估计行数”字段。

# c# - 如何在 C# 中实现 glob

> ID：398518
> 
> 赞同：19
> 
> 时间：2008-12-29T20:02:21.637
> 
> 标签：c#, glob, wildcard

我不知道在 StackOverflow 上发布您自己的问题答案是否合法，但我看到没有人问过这个问题。我去寻找一个 C# Glob 并没有找到，所以我写了一个其他人可能会觉得有用的。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-29T20:03:51.150

```
 /// <summary>
    /// return a list of files that matches some wildcard pattern, e.g. 
    /// C:\p4\software\dotnet\tools\*\*.sln to get all tool solution files
    /// </summary>
    /// <param name="glob">pattern to match</param>
    /// <returns>all matching paths</returns>
    public static IEnumerable<string> Glob(string glob)
    {
        foreach (string path in Glob(PathHead(glob) + DirSep, PathTail(glob)))
            yield return path;
    }

    /// <summary>
    /// uses 'head' and 'tail' -- 'head' has already been pattern-expanded
    /// and 'tail' has not.
    /// </summary>
    /// <param name="head">wildcard-expanded</param>
    /// <param name="tail">not yet wildcard-expanded</param>
    /// <returns></returns>
    public static IEnumerable<string> Glob(string head, string tail)
    {
        if (PathTail(tail) == tail)
            foreach (string path in Directory.GetFiles(head, tail).OrderBy(s => s))
                yield return path;
        else
            foreach (string dir in Directory.GetDirectories(head, PathHead(tail)).OrderBy(s => s))
                foreach (string path in Glob(Path.Combine(head, dir), PathTail(tail)))
                    yield return path;
    }

    /// <summary>
    /// shortcut
    /// </summary>
    static char DirSep = Path.DirectorySeparatorChar;

    /// <summary>
    /// return the first element of a file path
    /// </summary>
    /// <param name="path">file path</param>
    /// <returns>first logical unit</returns>
    static string PathHead(string path)
    {
        // handle case of \\share\vol\foo\bar -- return \\share\vol as 'head'
        // because the dir stuff won't let you interrogate a server for its share list
        // FIXME check behavior on Linux to see if this blows up -- I don't think so
        if (path.StartsWith("" + DirSep + DirSep))
            return path.Substring(0, 2) + path.Substring(2).Split(DirSep)[0] + DirSep + path.Substring(2).Split(DirSep)[1];

        return path.Split(DirSep)[0];
    }

    /// <summary>
    /// return everything but the first element of a file path
    /// e.g. PathTail("C:\TEMP\foo.txt") = "TEMP\foo.txt"
    /// </summary>
    /// <param name="path">file path</param>
    /// <returns>all but the first logical unit</returns>
    static string PathTail(string path)
    {
        if (!path.Contains(DirSep))
            return path;

        return path.Substring(1 + PathHead(path).Length);
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-13T21:45:42.150

我偶然发现了铁红宝石的来源，其中包含一个非常简洁的 Glob 类。从相关代码中提取它相当容易。

[https://github.com/IronLanguages/main/blob/master/Languages/Ruby/Ruby/Builtins/Glob.cs](https://github.com/IronLanguages/main/blob/master/Languages/Ruby/Ruby/Builtins/Glob.cs)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-27T15:31:33.867

您可以使用 C# 中的“dir”（又名“Get-ChildItem”）powershell cmdlet。
（我不是说你是否应该这样做。）

您必须手动将此引用添加到您的项目文件（“ *.csproj”或“* .vcproj”）：

```
<Reference Include="System.Management.Automation" /> 
```

有关如何从 C# 使用 cmdlet 的更多详细信息，请参见此处：http: [//www.devx.com/tips/Tip/42716](http://www.devx.com/tips/Tip/42716)

这是一个工作程序：

```
using System;
using System.Collections.Generic;

using System.Management.Automation;
using System.Management.Automation.Runspaces;
using System.Collections.ObjectModel;

namespace CsWildcard {
    class Program {

        static IEnumerable<string> CmdletDirGlobbing(string basePath, string glob){
            Runspace runspace = RunspaceFactory.CreateRunspace();
            runspace.Open();

            // cd to basePath
            if(basePath != null){
                Pipeline cdPipeline = runspace.CreatePipeline();
                Command cdCommand = new Command("cd");
                cdCommand.Parameters.Add("Path", basePath);
                cdPipeline.Commands.Add(cdCommand);
                cdPipeline.Invoke(); // run the cmdlet
            }

            // run the "dir" cmdlet (e.g. "dir C:\*\*\*.txt" )
            Pipeline dirPipeline = runspace.CreatePipeline();
            Command dirCommand = new Command("dir");
            dirCommand.Parameters.Add("Path", glob);
            dirPipeline.Commands.Add(dirCommand);

            Collection<PSObject> dirOutput = dirPipeline.Invoke();

            // for each found file
            foreach (PSObject psObject in dirOutput) {

                PSMemberInfoCollection<PSPropertyInfo> a = psObject.Properties;
                // look for the full path ("FullName")
                foreach (PSPropertyInfo psPropertyInfo in psObject.Properties) {
                    if (psPropertyInfo.Name == "FullName") {
                        yield return psPropertyInfo.Value.ToString(); // yield it
                    }
                }
            }

        }

        static void Main(string[] args) {
            foreach(string path in CmdletDirGlobbing(null,"C:\\*\\*\\*.txt")){
                System.Console.WriteLine(path);
            }
            foreach (string path in CmdletDirGlobbing("C:\\", "*\\*\\*.exe")) {
                System.Console.WriteLine(path);
            }   
            Console.ReadKey();
        }

    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-22T03:22:15.053

[使用https://github.com/dazinator/DotNet.Glob](https://github.com/dazinator/DotNet.Glob)很容易：

例子：

```
public static class Glob
{
  public static IEnumerable<FileInfo> Exec(DirectoryInfo dir, string glob)
  {
    var matcher = DotNet.Globbing.Glob.Parse(glob);
    return dir.EnumerateAllFiles().Where(f => matcher.IsMatch(f.FullName));
  }

  public static IEnumerable<FileInfo> EnumerateAllFiles(this DirectoryInfo dir)
  {
    foreach (var f in dir.EnumerateFiles())
    {
      yield return f;
    }

    foreach (var sub in dir.EnumerateDirectories())
    {
      foreach (var f in EnumerateAllFiles(sub))
      {
        yield return f;
      }
    }
  }
} 
```

# php - Flash 到 MySQL 数据库的简单安全方法

> ID：398537
> 
> 赞同：0
> 
> 时间：2008-12-29T20:10:19.293
> 
> 标签：php, mysql, flash, actionscript, database-connection

任何可用于**Flash > MySQL DB**集成的简单但安全的脚本？我需要一些用于登录数据库的东西。

**用PHP**交换变量既好又容易，但显然不安全。

**通过远程处理？**我已经[安装了 Flash 8 远程处理组件](http://blog.vixiom.com/2007/04/17/actionscript-20-flash-remoting-with-flash-cs3/)，还有一些想法：[idea-1](http://www.flash-db.com/Tutorials/helloAS2/)、[idea-2](http://www.joristimmerman.be/wordpress/tag/as2-remoting/)。

**通过网络连接？**得到了一些线索：[lead-1](http://www.oscartrelles.com/archives/as3_flash_remoting_example)，[lead-2](http://osflash.org/as3lrf)。

**冷聚变？**有人有什么想法吗？

* * *

不太可能的解决方案：

*   **通过 XML？**有人知道如何使用 XML 连接到数据库吗？*（AS2 或 AS3）*

*   **出于安全原因，无法使用**AMF-PHP （脚本安装在服务器根目录上）****

***   **Java Server** ras 要专门安装在服务器上。**

 *** * *

**编辑：**加密应该使 PHP 解决方案更可行，尽管只为高安全登录数据库提供基本保护。**另请参阅**：SO ：[1、2、3](https://stackoverflow.com/questions/190461/a-simple-medium-securelogin-protocol)，[Adobe](https://stackoverflow.com/questions/73947/)：[4](https://stackoverflow.com/questions/46415/) [。](http://www.adobe.com/devnet/flashplayer/articles/secure_swf_apps_12.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T13:54:17.523

无论您使用 Flash 还是 PHP，您仍然使用 HTML 表单技术/规范来执行 GET/POST，因此使用 Flash 与使用 PHP、Perl、CGI 等一样安全（或不安全）。

如果您想在登录时获得一定程度的安全性，您应该考虑获得该站点的 SSL 许可证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-21T16:03:26.407

查看 AS3crypto - [http://code.google.com/p/as3crypto/](http://code.google.com/p/as3crypto/) - 这是一个很棒的加密库。

1) 生成 1024 位（或更高，取决于您需要的安全性）RSA 公钥/私钥。

2) 将公钥存储在您的 swf 文件中（这样做是安全的，即使有人反编译了您的 swf）。

3) 将您的私钥存储在服务器上的安全位置。

3) 使用公钥和 AS3crypto 库，加密从 swf 发送的任何数据，然后再将其发送到服务器。

4) 数据到达服务器后，使用只有您可以访问的私钥对其进行解密。

提示 - 最好将时间散列到传输的数据中，以防止有人提交相同的加密数据以获得访问权限。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T21:40:23.513

过去，我使用 ASP.NET Web 服务通过 SSL 进行登录等 Flex->DB。Flash 应该能够通过 https 与任何网页对话，无论是 ASP.NET、PHP 还是任何其他应用程序服务器。

您能否更具体地说明“高安全性登录数据库”的要求？什么是您的理想解决方案？

ColdFusion 8 也可以在 Linux、Macintosh 和 Solaris 上运行，尽管我自己从未使用过 CF。

[http://www.adobe.com/products/coldfusion/systemreqs/](http://www.adobe.com/products/coldfusion/systemreqs/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T14:01:03.847

首先，如果您担心连接的安全性，请不要通过它发送密码：始终使用它的哈希值。就我个人而言，我从不会将纯文本密码保存的时间超过必要的时间。

其余的，基本上就是我在之前的回答中所说的：在第一个“身份验证”调用中，我还将传递会话 ID 以供正常 PHP 使用。在服务器上，您检查会话表中的 ID 并验证包含数据的 POST 是否来自链接到该会话的 IP。然后你验证用户名和指定的哈希值，如果所有这些都是正确的，你可以很确定用户就是他们所说的那个人。

关键是在 PHP 中使用 session_.... 函数。我确保将会话 ID 和匹配的 IP（您可以从*$_SERVER['REMOTE_ADDR']*获得）都存储在我的会话表中。这样，当小程序调用您的服务器时，您可以检查 sessionID 和 IP 是否匹配，从而增加了一些额外的安全性。

无论如何，这些天没有什么是安全的，而且我也不是安全专家，所以有更好的解决方案。问题是：你愿意为此付出多少努力？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T02:29:53.883

有一个关于 google 代码的项目，您可以通过 TCP 套接字连接[http://code.google.com/p/assql/](http://code.google.com/p/assql/)直接从您的 swf 电影连接到 MySQL 数据库。我从未尝试过，但这听起来很有趣且非常不安全。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T12:35:00.493

Afaik 不可能通过 ActionScript 直接与 MySQL 服务器通信（除非有人编写了一个实际处理网络内容的包，但我还没有看到）。

我还可以指出，您关于“由于 PHP 不安全”的评论并不准确吗？当您实际上从小程序中执行所有操作时，情况就更糟了：如今，反编译 .SWF 是小菜一碟，然后他们甚至会拥有您数据库的登录数据。

我认为，正如 Ristonj 建议的那样，最好使用 URLRequest 类。

我通常做的是将当前的 php 会话 ID 传递给小程序，以便我可以在初始小程序请求中包含这个和用户 IP。在服务器上，我检查 ip/session 在会话表中是否实际处于活动状态并匹配。如果是这样，用户将获得一种允许他执行请求的命令令牌，这反过来可以执行您的数据库更新。

如果您通过 SSL 连接完成所有这些操作，那么您将非常安全。是的，您必须将 PHP 脚本存储在服务器上，但是获取这些脚本的源代码比仅仅能够反编译小程序并提取所有内容要困难得多:)

我喜欢将所有可能存在危险的程序逻辑只保留在服务器上，而不是小程序中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T13:34:57.767

基本上，Flash 必须将用户名+密码详细信息传递给 PHP 脚本以进行身份​​验证……稍后 PHP 将使用 GET/POST 将私人详细信息发送回 Flash。

我需要一些安全措施来确保坏人无法访问这些私人信息。

**编辑：** PHP>MySQL DB 似乎足够安全。它只是 Flash>PHP 部分需要一些：

*   加密（散列？）
*   安全连接（HTTPS 还是通过 SSL 的 HTTP？）
*   或者更好、更直接的 MySQL DB 方法（Remoting？）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-09T07:12:44.147

直接从 AS3 访问 MySQL——查看： [http ://code.google.com/p/assql/](http://code.google.com/p/assql/)

# asp.net - 是否可以将 Web 用户控件添加到类库中？

> ID：398538
> 
> 赞同：9
> 
> 时间：2008-12-29T20:11:52.240
> 
> 标签：asp.net, web-controls

我正在考虑构建一些 Web 用户控件，着眼于重用，但我似乎无法在 VS2008 的类库中添加 Web 用户控件。有没有办法解决这个问题，或者有没有更好的方法来创建可重用的控件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T20:32:55.257

您可以创建封装所需功能的**Web 用户控件**或**Web 自定义控件。**这两个控件之间的主要区别在于易于创建与设计时的易用性。

您或许应该考虑创建一个 Web 自定义控件库。有一个[使用 Web 控件库模板创建 Web 自定义控件的演练](http://msdn.microsoft.com/en-us/library/aa728786(VS.71).aspx)。

根据 MSDN 文章“ [Web 用户控件与 Web 自定义控件的建议](http://msdn.microsoft.com/en-us/library/aa651710(VS.71).aspx)”，这些是这两种控件之间的区别：

> **Web 用户控件**很容易制作，但在高级场景中使用起来不太方便。您开发 Web 用户控件的方式几乎与开发 Web 窗体页面的方式完全相同。与 Web 窗体一样，用户控件可以在可视化设计器中创建，可以使用与 HTML 分离的代码编写，并且可以处理执行事件。
> 
> 但是，由于 Web 用户控件是在运行时动态编译的，因此它们无法添加到工具箱中，并且在添加到页面时由简单的占位符字形表示。如果您习惯于完整的 Visual Studio .NET 设计时支持，包括属性窗口和设计视图预览，这会使 Web 用户控件更难使用。
> 
> 此外，在应用程序之间共享用户控件的唯一方法是在每个应用程序中放置一个单独的副本，如果您对控件进行更改，这需要更多的维护。
> 
> **Web 自定义控件**是编译后的代码，这使得它们更易于使用但更难以创建；Web 自定义控件必须用代码编写。但是，一旦创建了控件，就可以将其添加到工具箱中，并在具有完整属性窗口支持和 ASP.NET 服务器控件的所有其他设计时功能的可视化设计器中显示它。
> 
> 此外，您可以在全局程序集缓存中安装 Web 自定义控件的单个副本，并在应用程序之间共享它，这使得维护更加容易。有关详细信息，请参阅全局程序集缓存。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T20:20:35.483

请按照以下步骤操作（来自Phil Haacked的[这篇文章）：](http://haacked.com/archive/2006/02/07/addingwebusercontroltoaclasslibraryinvs.net2005.aspx)

1.  关闭 VS.NET 2005。

2.  打开目录 C**:\Program Files\Microsoft Visual Studio 8\Web\WebNewFileItems\CSharp**（假设默认安装 VS.NET）。

3.  在记事本中打开**CSharpItems.vsdir**文件。选择文本并将其复制到剪贴板。

4.  现在打开文件**C:\Program Files\Microsoft Visual Studio 8\VC#\CSharpProjectItems\CSharpItems.vsdir**并将剪贴板的内容粘贴到现有文本的下方。

5.  现在将**C:\Program Files\Microsoft Visual Studio 8\Web\WebNewFileItems\CSharp**（不包括 CSharpItems.vsdir）的内容复制到文件夹**C:\Program Files\Microsoft Visual Studio 8\VC#\CSharpProjectItems**中。

现在，当您选择添加 | 时，“Web 用户控制”应该是一个选项。新物品。

*参考：[http ://haacked.com/archive/2006/02/07/addingwebusercontroltoaclasslibraryinvs.net2005.aspx](http://haacked.com/archive/2006/02/07/addingwebusercontroltoaclasslibraryinvs.net2005.aspx)*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T21:27:23.820

正如 platte 的链接所提到的，如果您要重用，那么 Web 用户控件不是很好。必须手动将 ascx 文件复制到您要在其中使用它们的每个项目中，否则您必须自行破解。

最好使用 System.Web.UI.WebControls.WebControl，这是您在添加“ASP.NET 服务器控件”时得到的。这些是为重用而设计的。如果现有的框架控件之一在很大程度上符合要求，并且您只需要扩展它的功能，那么添加一个“ASP.NET 服务器控件”并将其更改为从 Panel 或 Menu 或其他继承。

如果您仍然决心让可重用的 Web 用户控件发挥作用，那么[The Gu 的这篇文章](http://weblogs.asp.net/scottgu/archive/2005/08/28/423888.aspx)应该会让您走上正确的道路。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T20:16:27.830

有一个名为“ASP.NET 服务器控件”的项目模板，我假设您可以使用它...

--larsw

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T20:42:22.037

你可以在类库中做任何事情。

1.  添加对 System.Web 的引用
2.  创建从 WebControl 或 HtmlControl 或其他继承的新 Control 类。

就是这样。您现在拥有一个可重用的 ASP.NET 控件。

你可以做一些特殊的事情，比如为你的类和属性添加属性，但它们实际上是不需要的。

```
[DefaultProperty("Text")]
[Category("...")]
[DefaultValue("")] 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T20:52:20.707

您可以使用虚拟路径提供程序，但您应该考虑它是否真的值得您尝试。考虑一下这个关于这个主题的[codeproject 文章](http://www.codeproject.com/KB/aspnet/ASP2UserControlLibrary.aspx)。

# c++ - 将新分配的数据直接传递给函数

> ID：398543
> 
> 赞同：5
> 
> 时间：2008-12-29T20:16:02.857
> 
> 标签：c++, memory-leaks

在学习不同的语言时，我经常看到动态分配的对象，最常见的是在 Java 和 C# 中，如下所示：

```
functionCall(new className(initializers)); 
```

我知道这在内存管理语言中是完全合法的，但是这种技术可以在 C++ 中使用而不会导致内存泄漏吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-29T21:02:30.203

您的代码是有效的（假设 functionCall() 实际上保证指针被删除），但它很脆弱，会使大多数 C++ 程序员的警钟响起。

您的代码存在多个问题：

*   首先，谁拥有指针？谁负责释放它？调用代码无法做到这一点，因为您不存储指针。这意味着被调用的函数必须这样做，但是对于查看该函数的人来说并不清楚。同样，如果我从其他地方调用代码，我当然不希望函数在我传递给它的指针上调用 delete！
*   如果我们使您的示例稍微复杂一些，它可能会泄漏内存，*即使被调用的函数调用 delete 也是如此*。假设它看起来像这样：`functionCall(new className(initializers), new className(initializers));`想象第一个分配成功，但第二个抛出异常（可能是内存不足，或者类构造函数抛出异常）。functionCall 永远不会被调用，*也无法*释放内存。

简单（但仍然很混乱）的解决方案是首先分配内存，存储指针，然后在声明的相同范围内释放它（因此调用函数拥有内存）：

```
className* p = new className(initializers);
functionCall(p);
delete p; 
```

但这仍然是一团糟。如果 functionCall 抛出异常怎么办？然后 p 不会被删除。除非我们在整个事情上添加一个 try/catch，但是，天哪，这很混乱。如果函数变得有点复杂，并且可能在 functionCall 之后但在 delete 之前返回怎么办？哎呀，内存泄漏。无法维持。错误的代码。

因此，一个不错的解决方案是使用智能指针：

```
boost::shared_ptr<className> p = boost::shared_ptr<className>(new className(initializers));
functionCall(p); 
```

现在处理内存的所有权。拥有`shared_ptr`内存，并保证它会被释放。当然，我们可以使用它`std::auto_ptr`来代替，但 `shared_ptr`会实现您通常期望的语义。

请注意，我仍然在单独的行上分配了内存，因为在进行函数调用时在同一行上进行多次分配的问题仍然存在。其中一个可能仍然抛出，然后你已经泄漏了内存。

智能指针通常是处理内存管理所需的绝对最小值。但通常，*不错的*解决方案是编写自己的 RAII 类。

`className`应该在堆栈上分配，并在其构造函数中进行`new`必要的分配。在其析构函数中，它应该释放该内存。这样，您就可以保证不会发生内存泄漏，并且您可以使函数调用像这样简单：

```
functionCall(className(initializers)); 
```

C++ 标准库就是这样工作的。`std::vector`是一个例子。你永远不会用`new`. 您在堆栈上分配它，并让它在内部处理其内存分配。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-29T20:18:15.177

是的，只要你在函数内部释放内存。但这绝不是 C++ 的最佳实践。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-29T20:19:18.560

这取决于。

这会将内存的“所有权”传递给 functionCAll()。它要么需要释放对象，要么保存指针，以便以后释放。像这样传递原始指针的所有权是将内存问题构建到代码中的最简单方法之一——泄漏或双重删除。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-29T23:28:07.210

在 C++ 中，我们不会像那样动态地创建内存。
相反，您将创建一个临时堆栈对象。

如果您希望对象的生命周期大于对函数的调用，则只需要通过 new 创建一个堆对象。在这种情况下，您可以将 new 与智能指针结合使用（有关示例，请参见其他答案）。

```
// No need for new or memory management just do this
functionCall(className(initializers));

// This assumes you can change the functionCall to somthing like this.
functionCall(className const& param)
{
    << Do Stuff >>
} 
```

如果你想传递一个非 const 引用，那么这样做：

```
calssName tmp(initializers);
functionCall(tmp);

functionCall(className& param)
{
    << Do Stuff >>
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T20:55:06.520

如果您正在调用的函数具有接受所有权语义，则它是安全的。我不记得我需要这个的时间，所以我认为它不寻常。

如果函数以这种方式工作，它应该将其参数作为智能指针对象，以便意图明确；IE

```
void functionCall(std::auto_ptr<className> ptr); 
```

而不是

```
void functionCall(className* ptr); 
```

这使得所有权的转移变得明确，当函数的执行超出范围时，调用函数将处理 ptr 指向的内存。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T20:20:27.217

这适用于在堆栈上创建的对象，但不适用于 C++ 中的常规指针。

一个自动指针也许能够处理它，但我还没有弄乱它们足以知道。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T20:23:03.560

一般来说，不，除非你*想*泄漏内存。事实上，在大多数情况下，这是行不通的，因为

```
new T(); 
```

在 C++ 中是 T*，而不是 T（在 C# 中，new T() 返回 T）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T20:36:29.460

看看[Smart Pointers](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/smart_ptr.htm)或[C 和 C++ 的垃圾收集器](http://www.hpl.hp.com/personal/Hans_Boehm/gc/)。

# design-patterns - 实现状态驱动的类

> ID：398547
> 
> 赞同：1
> 
> 时间：2008-12-29T20:17:10.810
> 
> 标签：design-patterns, class

假设实现类“CAR”的要求。

现在，这个类包含各种状态，如“未点燃”、“点燃”、“损坏”、“穿孔”等，

我认为实现此要求的方式是在类中使用布尔标志，即“属性”，并在每个成员函数中使用这些布尔标志“检查状态”。例如，

```
CAR.goRacing()
{
    如果（bIsPunctured）
       返回 ENUM_CANT_DRIVE；

    //启动发动机...
}
```

当对象暴露的状态数量增加时，这个实现，看起来很简单，开始变得非常复杂。我还看到过单个状态使对象的维护变得非常麻烦的情况（我确信在这种情况下，我应该为我的编程技能负责）
是否有实现这种**状态驱动**对象的标准方法？

我看过 Steve Yeggey 的[Property Pattern](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)，但我真的没有一个真实的例子！

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T20:19:50.010

这听起来绝对是[状态模式的工作](http://en.wikipedia.org/wiki/State_pattern)

基本上，您创建应用程序（上下文）并将某些操作的行为定义为单独的类/接口（状态）

这个类将有不同的实现子类，每个状态一个。

当状态改变时，状态对象将新状态分配给上下文。这样您就可以将所有状态代码放入单独的类中，并避免使用经典的意大利面条代码。

*编辑*

这是我能想到的最简单的实现。

假设你有一个“宠物”，一个脑袋根据它所处的状态做某事。

当该状态完成时，状态更改为下一个（正在睡眠 -> 唤醒 -> 播放等）

我什至不知道这是否编译。这只是为了得到这个想法*

```
//These are the states of the "Pet" class
//sleep -> wake up ->  play -> dinner -> sleep -> wake up .. etc. 
class Pet {

    State currentState;
    static Pet createNew(){
        Pet p = new Pet();
        State s = new Sleep();
        s.setContext( p );
        p.currentState = 
        return p;
    }

    public void doSomething(){ 
        currentState.doSomething();
   }

}   

abstract class State {
    Pet context;
    void setContext( Pet c ) { 
        this.context = c;
    }
    abstract doSomething();
    void sout( Striing message ) { 
        System.out.println( message );
    }
}
class Sleep extends State { 
    public void doSomething(){
       sout( "zzzZZZ ... " );
       State nextState = new WakeUp();
       nextState.setContext( context );
       context.currentState = nextState;
    }
}
class WakeUp extends State { 
    public void doSomething(){
       sout( "uuuaaaaww... zzzz What time is it? ... " );
       State nextState = new Play();
       nextState.setContext( context );
       context.currentState = nextState;
    }
}
class Play extends State { 
    public void doSomething(){
       sout( "boing, boing, poing, poing" );
       State nextState = new Dinner();
       nextState.setContext( context );
       context.currentState = nextState;
    }
}
class Dinner extends State { 
    public void doSomething(){
       sout( "Yum, yum..." );
       State nextState = new Sleep();
       nextState.setContext( context );
       context.currentState = nextState;
    } 
```

}

然后你的客户类就使用它！

```
Pet myPet = Pet.createNew();

while( I_FeelLikePlaying() ){ 
    myPet.doSomething();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T20:28:27.277

有关状态模式的改进、利用 .NET 设施版本的信息，请参见[此处。](https://stackoverflow.com/questions/398458/state-machine-implementations#398527)状态可以是一个简单的函数（大多数情况下都会这样做），但它也可以是一个对象（或另一个状态机）......

问候，

安德烈亚斯

# python - 当您的正则表达式引擎不支持它时，由 \b 分割

> ID：398560
> 
> 赞同：5
> 
> 时间：2008-12-29T20:22:14.777
> 
> 标签：python, regex

如何在不支持它的正则表达式引擎中按字边界拆分？

python 的 re 可以匹配 \b 但似乎不支持对其进行拆分。我似乎记得与其他具有相同限制的正则表达式引擎打交道。

示例输入：

```
"hello, foo" 
```

预期输出：

```
['hello', ', ', 'foo'] 
```

实际的python输出：

```
>>> re.compile(r'\b').split('hello, foo')
['hello, foo'] 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-29T20:38:26.570

(\W+) 可以为您提供预期的输出：

```
>>> re.compile(r'(\W+)').split('hello, foo')
['hello', ', ', 'foo'] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T21:41:31.233

也可以为此使用 re.findall() ：

```
>>> re.findall(r'.+?\b', 'hello, foo')
['hello', ', ', 'foo'] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T20:39:05.070

好的，我想通了：

将拆分模式放入捕获括号中，并将包含在输出中。您可以使用 \w+ 或 \W+：

```
>>> re.compile(r'(\w+)').split('hello, foo')
['', 'hello', ', ', 'foo', ''] 
```

要删除空结果，请将其通过 filter() 并使用 None 作为过滤器函数，它将过滤任何不评估为 true 的内容：

```
>>> filter(None, re.compile(r'(\w+)').split('hello, foo'))
['hello', ', ', 'foo'] 
```

编辑：CMS指出，如果你使用 \W+ 你不需要使用 filter()

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T20:31:15.773

尝试

```
>>> re.compile(r'\W\b').split('hello, foo')
['hello,', 'foo'] 
```

这在边界之前的非单词处分裂。您的示例没有什么可拆分的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T20:39:57.783

有趣的。到目前为止，我尝试过的大多数 RE 引擎都进行了这种拆分。

我玩了一下，发现它`re.compile(r'(\W+)').split('hello, foo')`给出了你期望的输出......不过，不确定这是否可靠。

# delphi - 为什么在 Delphi 2007 IDE 中剪切/粘贴表单组件有时会停止工作？

> ID：398563
> 
> 赞同：2
> 
> 时间：2008-12-29T20:23:17.613
> 
> 标签：delphi, clipboard, delphi-2007

这真让我抓狂。我不会再接受它了。我要问，即使冒着永远公开羞辱的风险！（如果它*真的很*明显或者我自己对系统做了什么）。

由于我从来没有足够的耐心去解决的原因，我在 Delphi 2007 的可视表单编辑器中处理的表单经常变成“伪只读”；我可以将新组件添加到表单中，我可以移动/调整现有组件的大小（并更改对象检查器中的任何属性），我可以选择一个组件并将其“复制”到剪贴板。

但是我完全无法从表单中剪切一个组件，或者粘贴一个新的副本。我不相信这与“锁定控件”编辑菜单选项有关，因为我可以打开或关闭它，它具有应有的效果 - 剪切和粘贴的消失发生在右键单击上下文菜单上，从键盘和主编辑菜单 - 就好像表单已变为只读，与剪贴板有关。

如果我在 IDE 中关闭表单然后重新打开它，一切都会重新开始正常工作（就像 D1、D3、D5 和 D7 以前对我所做的那样）。

我不会生气，因为我确定我曾经读过一些关于为什么会在新闻组上发生这种情况的内容，并且在过去几个月中时不时地让我很多次，但我没能找到新闻组今晚参考，我决定，随着越来越多的 Delphi 用户似乎在使用 StackOverflow，这里值得一问。

**帮助**- 当我做大量的模板工作时，它让我*非常*生气！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T17:04:41.073

您可以尝试下载[剪贴板监视器](http://www.xcalibur.co.uk/DelphiThings/)应用程序，看看是否有任何东西弄乱了您的剪切/粘贴。我注意到在虚拟机中运行时出现类似问题，虚拟机对剪贴板中的内容感到困惑，并且在我回到主机应用程序之前不会让我再次剪切/粘贴打开其他东西（记事本工作正常）并复制新鲜的东西。我认为这是我系统上其他剪贴板监视应用程序的问题，而不是其他任何问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T22:20:38.953

我经常使用复制/粘贴“设计”，但它们从未消失。

您是否正在使用其他一些可以处理复制/粘贴的 IDE 插件？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T10:47:56.137

我认为这是 IDE 中的一个已知错误，但我似乎找不到任何对它的引用。我也遇到过这个问题。您可能想尝试[IDE Fix Pack](http://andy.jgknet.de/blog/?page_id=15)，尽管它并没有声称可以解决此问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T10:25:06.153

检查其他应用程序是否也可以使用剪贴板。有时我在我的应用程序的剪贴板操作中间暂停，这会阻止其他应用程序打开剪贴板。可能会令人困惑！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-02-10T08:48:59.477

病毒检测器应用程序：Webroot SecureAnywhere 停止粘贴工作 - 当我禁用这个愚蠢的病毒检测器时 - 一切又好了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-28T07:55:25.783

我认为您应该尝试桌面设置。我遇到了同样的问题，将设置更改为调试后，剪切/复制开始工作。

# vbscript - 使用 VBScript 在没有防火墙的情况下阻止 UDP 端口

> ID：398569
> 
> 赞同：0
> 
> 时间：2008-12-29T20:31:14.387
> 
> 标签：vbscript

我正在测试一个通过 UDP 端口与服务器通信的应用程序，我需要阻止此端口以确保应用程序可以处理它。
问题：
1\. 它必须在自动化测试中完成（由 VBScripts 控制）。
2\. 必须在 Windows XP 中完成，不使用防火墙。

我试过这个：

```
 Set objFirewall = CreateObject("HNetCfg.FwMgr")
Set objPolicy = objFirewall.LocalPolicy.CurrentProfile
Set colPorts = objPolicy.GloballyOpenPorts

Set objPort = colPorts.Item(9999,6)
objPort.Enabled = FALSE 
```

但它没有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T21:02:51.327

这可能很有趣：如何使用 IPSec 阻止特定的网络协议和端口 [http://support.microsoft.com/kb/813878](http://support.microsoft.com/kb/813878)

# windows - 需要从命令行运行 Windows 安全对话框

> ID：398571
> 
> 赞同：1
> 
> 时间：2008-12-29T20:31:44.087
> 
> 标签：windows

你知道，当你输入 ctrl-alt-del 或 ctrl-alt-end 时，你通常会得到什么。除了在这种情况下，我不能按这些键，但我想启动那个框。具体来说，我希望能够从命令行调出更改密码对话框。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-10-27T12:57:50.520

你调用`Shell.WindowsSecurity`方法。[该文档](http://msdn.microsoft.com/en-us/library/windows/desktop/gg537748%28v=vs.85%29.aspx)包括示例代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-06-04T04:25:37.397

这是Raymond Chen给出的答案的扩展。我展示了如何从批处理文件中调用 WindowsSecurity。请注意，它只有在通过终端会话连接到 Microsoft 终端服务器时才能正常工作。

```
@if (@CodeSection == @Batch) @then
@echo off

:: See https://gist.github.com/DavidRuhmann/5199433 and 
:: http://msdn.microsoft.com/en-us/library/windows/desktop/gg537748%28v=vs.85%29.aspx
:: for details.

CScript //E:JScript //Nologo "%~0" %*
exit /b

@end

try
{
    var objShell = new ActiveXObject("shell.application");
    objShell.WindowsSecurity();
    WScript.Quit(0);
}
catch(e)
{
    WScript.Quit(1);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-04-19T15:34:08.173

OSK.exe 将调出屏幕键盘。它应该允许你点击 ctrl-alt-del

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-20T13:11:45.863

[control.exe password.cpl](http://www.geekgirls.com/windowsxp_controlpanel.htm) - 将启动密码控制面板小程序。

# c# - 在 Windows 移动应用程序中过滤自动完成选项

> ID：398577
> 
> 赞同：0
> 
> 时间：2008-12-29T20:34:57.373
> 
> 标签：c#, .net, windows-mobile, compact-framework

我正在开发 Windows 移动应用程序（c#，.net 2.0）。我想为特定的文本框使用设备的自动完成功能，但我想比设备默认提供的更具体。

例如，我想自动完成以建议特定长度的单词。一次给出几个选项也很好。

任何人都可以在这方面给我一些帮助，或者提供有用参考的链接吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T22:33:31.657

不幸的是，内置的自动完成功能非常有限。如果我们有某种形式的回调或钩子可以用来拦截和改变它的行为，那就太好了，但没有。获得您所追求的控制粒度的唯一方法是滚动您自己的（或找到第三方）自动完成控制。

# lisp - 学习 LISP 的最佳方法是什么？

> ID：398579
> 
> 赞同：174
> 
> 时间：2008-12-29T20:36:01.787
> 
> 标签：lisp, scheme, common-lisp

我用 Python、PHP、Java 和 C 编程已经有几年或几年了，我刚刚读完 Hackers and Painters，所以我很想试试 LISP！

我理解它与我所知道的完全不同，而且这并不容易。我还认为（如果我错了，请纠正我）围绕 LISP 的社区和开发较少。所以我的问题是：学习 LISP 的最佳方法是什么？

我不介意买书或投资一些时间。我只是不想浪费。

“最终”的想法是使用 LISP 进行 Web 开发，我知道这并不常见，所以......我知道在选择第一本书或教程之前计划好我的学习并花大量时间在可能不会的东西上成为最好的方式！

谢谢大家的答案！

**编辑：**我读了 Practical Common Lisp 并且是：... 很长，很难，很有趣，肯定让我在 Lisp 中滚动，之后我读了这个小计划，它很短，很有趣，对我的整体编程非常非常好。所以我的建议是先阅读小计划者，然后（几个小时，值得一读）如果你决定 lisp（或计划或任何方言）不是你要找的东西，你仍然会玩得很开心递归的新思路！

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-12-29T20:38:41.920

尝试阅读Peter Seibel 的[Practical Common Lisp](http://www.gigamonkeys.com/book/)。

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2008-12-29T20:47:36.943

我个人最喜欢的是 Abelson & Sussman [Structure and Interpretation of Computer Programs](http://mitpress.mit.edu/sicp/)。它使用 Scheme，这是一种很好的 Lisp 方言。

如果你喜欢更实用的方法，也许你应该选择一些用于网页设计的 Lisp 框架（我不知道这样的野兽是否存在）并直接加入。

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2008-12-29T20:47:04.150

您可能想从[The Little Schemer](https://rads.stackoverflow.com/amzn/click/com/0262560992)作为热身开始。这不是一本关于编写生产 Lisp 程序的实用书，但它是一本学习如何用 Lisp*思考的好书。*

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2008-12-29T21:21:46.950

MIT 以 DIVX 和 MPEG 格式提供了完整的 LISP 课程。我强烈推荐它。

[http://groups.csail.mit.edu/mac/classes/6.001/abelson-sussman-lectures/](http://groups.csail.mit.edu/mac/classes/6.001/abelson-sussman-lectures/)

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2010-12-27T17:02:28.090

现在有一本书叫[**“LISP 之国”**](http://landoflisp.com/)，它通过编写 80 年代风格的文字游戏来教授 LISP 编程。我现在正在读它，它写得很好，并没有把自己太当回事，我喜欢。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-12-29T22:23:40.307

这里有几个选项。首先，Scheme 和 Common Lisp 在相当深的方面（比如作用域）是相当不同的。你应该选择一个开始并坚持*一段时间*。我是 Common Lisp 的粉丝，但这可能是那些 vi-vs-EMACS 宗教问题之一。

对于 Scheme，请选择 Kent Dybvig 的[Scheme 编程语言](http://www.scheme.com/tspl3/)，然后是 SICP。

对于 Common Lisp 和 Practical Common Lisp，我推荐 David Lamkins 的[成功 Lisp。](http://www.psg.com/~dlamkins/sl/) 成功的 Lisp[也可以免费在线获得](http://www.freebookcentre.net/programming-books-download/Successful-Lisp-(David-B.-Lamkins).html)。

之后，看看Queinnec 的[Lisp in Small Pieces和 Norvig](http://pagesperso-systeme.lip6.fr/Christian.Queinnec/WWW/LiSP.html)[在 AI book 中](http://www.amazon.com/exec/obidos/ISBN=1558601910/martyhallsrecomm/)的 Lisp 。

Marty Hall在约翰霍普金斯大学有[一份不错的名单。](http://www.apl.jhu.edu/~hall/lisp-books.html)

**更新**：我并不是说永远坚持下去，只是试图同时学习两者会令人困惑。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2011-09-15T05:23:43.420

拿起康拉德·巴尔斯基 (Conrad Barski [**) 的《Lisp之国》。**](https://rads.stackoverflow.com/amzn/click/com/1593272812)这是使用卡通和游戏对 Lisp 编程进行有趣的介绍。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-12-29T20:51:47.433

我推荐[Project Euler](http://projecteuler.net)作为小问题的绝佳来源，您可以使用它来自学任何新的编程语言。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-12-29T21:57:24.103

Paul Graham 的 Ansi Common Lisp 是一本好书。

我认为它可能已经绝版，所以你最好通过亚马逊获得它。我在大学二年级的时候拿到了“自然语言处理”课程的书。我们必须用 LISP 编写程序项目，所以我需要快速学习 Lisp。

这本书对我帮助很大。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-12-30T06:41:59.630

有一次我遇到了问题。我不知道口齿不清。所以我决定在一个盒子里下载 LISP。

然后我发现自己在没有任何帮助或文档的情况下安装了 Emacs。

然后我有两个问题。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-02-04T04:17:32.027

对于认真的学习者，我推荐Norvig 的[PAIP](http://norvig.com/paip.html)。它是学习 Lisp 和 AI 的绝佳资源。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-02-04T04:26:05.270

伯克利提供播客格式的[CS61a](http://webcast.berkeley.edu/course_details_new.php?seriesid=2008-D-26263&semesterid=2008-D)。这是基于 SICP 的 CS 课程介绍。这是一个比 1982 年麻省理工学院提供的视频更现代的版本。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2009-03-10T13:42:37.027

我现在正在学习 Lisp，并且遇到了学习 Lisp 的“书”。这是由[Rainer Joswig提出的](https://stackoverflow.com/users/69545/rainer-joswig)

这本书名为[Common Lisp: A Gentle Introduction to Symbolic Computation](http://www.cs.cmu.edu/~dst/LispBook/book.pdf)，可以以 PDF 格式下载。作者在第一章从类似于 UML 的 Lisp 方法开始，并逐渐介绍了越来越多的 Lisp 语法。

我还查看了实用的 lisp，我认为作者忽略了许多必需的信息，即使对于经验丰富的程序员也是如此。这本书似乎没有这样做（我还没有完全完成，但发现它足够有用，可以提出建议）。

还有一件事，你需要一个工作环境。我发现[Lisp in a Box](http://common-lisp.net/project/lispbox/)可以很好地工作。它在 Windows 和 Linux 上运行并使用 eMac。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-11-08T10:49:27.150

我被 LISP 的 JVM 方言 - Clojure 所吸引。Clojure 是一种很棒的 LISP，因为

*   它具有“简化的语法”，即需要较少的 parathensis，有巧妙设计的集合集
*   它是基于 JVM 的，所以它下面有稳定、高性能的运行时，此外整个 Java 生态系统（库，例如数据库驱动程序、构建工具、IDE）都在我们的范围内
*   Noir 是一个很好的 Web 框架，应用可以部署在 Java Web 和应用服务器上

换句话说，Clojure 可以立即用于生产环境。

在资源方面，至少有 4 本书和植物在线资源：

*   书籍：“Clojure 的乐趣” - 非常有见地但可能很难，因此最好与“Programming Clojure”一起阅读。
*   在线教程：[Mark Volkmann 教程很棒](http://java.ociweb.com/mark/clojure/article.html)
*   另请参阅[https://stackoverflow.com/questions/599519/which-tutorial-on-clojure-is-best](https://stackoverflow.com/questions/599519/which-tutorial-on-clojure-is-best)
*   [4Clojure](http://www.4clojure.com/)网站包含许多简单的编程任务，因此可以玩 Clojure 并查看其他人的解决方案

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-12-29T20:41:50.730

我喜欢阅读[Practical Common LISP](https://rads.stackoverflow.com/amzn/click/com/1590592395)和[ANSI Common LISP](https://rads.stackoverflow.com/amzn/click/com/0133708756)。

[在 LISP 上](https://rads.stackoverflow.com/amzn/click/com/0130305529)看起来很有趣，但 190 美元对于一本书来说似乎有点贵。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-12-29T21:38:47.120

对于 Web 开发，您可能想看看[hunchentoot](http://www.weitz.de/hunchentoot/)，一个用通用 lisp 编写的 Web 服务器。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-01-13T01:16:37.577

我发现完成“The Little Schemer”中的练习确实有助于磨练我思维的递归、模式匹配方面，并使在 XSLT 中的工作变得相当容易。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-08-05T08:02:17.310

根据您的编程经验，我首先推荐 Gentle Introduction to Symbolic Computation 或 Practical Common Lisp。为了练习，我在 Windows 中使用 Allegro CL 8.2 Free Express Edition。它把练习变成了很多乐趣。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-29T20:40:00.547

有点难以回答的问题......我认为这完全取决于你的学习方式。

我在大学的 AI 和专家系统课程中学习了 LISP，但这就是我学习的方式……我不是一个很好的书本学习者，我更喜欢有人在课堂上向我解释它。

LISP 绝对是一种独特的语言，如果您习惯于传统的 C、Java、PHP 编程，它需要一个新的思路。

祝你好运！

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-29T20:49:17.860

我发现阅读[SICP](http://mitpress.mit.edu/sicp/)这本书确实帮助我学习。我使用了 Steel Bank Common Lisp (SBCL) 并取得了很好的成功。

祝你好运

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-29T20:45:20.817

我不知道 Lisp 有什么特别之处使它不同于学习任何其他语言。您只需要开始使用它并尝试它的功能。

一种选择可能是尝试一个简单的[项目](https://stackoverflow.com/questions/10936/projects-for-learning-a-new-language)。

另一个特定于 Lisp 的选项是编写一个 Emacs 扩展来帮助您完成日常工作。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-03-21T17:57:14.840

按顺序阅读这些书：符号计算的简单介绍，Paul Graham 的 ANSI Common Lisp，然后转到 Practical Common Lisp。或者在使用 PCL 时跳过 ACL 并将其用作参考。

# windows - 如何确定最低系统要求

> ID：398586
> 
> 赞同：10
> 
> 时间：2008-12-29T20:38:51.483
> 
> 标签：windows, deployment, requirements

您如何确定 Windows 应用程序的最低系统要求是什么？（操作系统、RAM、HD、CPU）。我通常凭直觉行事，但我希望能够用一些东西来支持它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T20:41:36.767

> 同样，是否有可用于人为限制 CPU 速度和 RAM 的工具？我希望能够减慢测试计算机的速度，而不是购买具有过时 CPU 的系统。

[你的问题的第二部分在这里](https://stackoverflow.com/questions/284051/emulate-old-pc#284108)得到了非常详细的回答。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T20:40:30.653

您的最低系统要求是您的依赖项的一组系统要求中的最高要求。

# domain-driven-design - 在复合应用程序中重用域模型的最佳实践是什么？

> ID：398588
> 
> 赞同：2
> 
> 时间：2008-12-29T20:38:57.647
> 
> 标签：domain-driven-design, cab, scsf, composite-application

我们有一个使用复合 UI 应用程序块 (CAB)/智能客户端软件工厂 (SCSF) 构建的复合应用程序。迄今为止，我们的复合应用程序中的每个模块都使用了自己的一组 DTO，并且业务逻辑已在整个模块中重复，包括 UI 层和服务层。我想追求更多领域驱动的方法，以便将业务逻辑封装在一个领域层中，该领域层可以分布到 UI 层和服务层，并且（理想情况下）跨模块。

我们的复合应用程序中同时有多个模块正在开发中，我们需要能够以任何顺序部署它们。理想情况下，我希望我们的模块共享一个通用的域模型，但我担心当我们部署新版本的域模型和一个模块时，我们需要针对域模型对其他模块进行回归测试.

另一种方法似乎是在每个模块中复制域模型，但所有这些代码重复对我来说都很有趣。该行业是否针对这种情况制定了任何最佳实践？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T14:10:21.657

我使用了单个域模型，但它允许对每个单独的定义进行版本控制。代码生成提供每个服务的接口，以及可以跨服务和版本边界的映射代码。

# c# - 如何在 .NET 中为自定义配置部分启用 configSource 属性？

> ID：398607
> 
> 赞同：27
> 
> 时间：2008-12-29T20:46:22.343
> 
> 标签：c#, .net, configuration, app-config, configuration-files

[根据此处](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx)找到的大量信息，我们如何才能使外部 .config 工作？我尝试了与外部 appSettings 文件相同的设置，但它无法找到我的自定义部分的文件。

```
<configSections>
...
    <section name="CustomSettings" type="Fully.Qualified.TypeName.CustomSettings, AssemblyName" />
</configSections>
<!-- this works -->
<CustomSettings attrib1="val1" attrib2="val2" .../> 
```

然而...

```
<!--this does not work-->
<CustomSettings configSource="someExternalFile.config"/> 
```

其中 someExternalFile.config 将包含

```
<CustomSettings attrib1="val1" attrib2="val2" .../> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-29T20:53:43.717

实际文件，必须相对于项目输出文件夹放置（默认为“\bin\debug”或“bin\Release”

此外，您的项目树中的文件，查看文件的属性，并确保“复制到输出目录”设置设置为“始终复制”或“如果较新则复制”

编辑：确保单独的配置文件有一个 xml 元素头。整个文件内容应如下所示：

```
<?xml version="1.0" encoding="utf-8" ?>
<CustomSettings attrib1="val1" attrib2="val2" .../> 
```

# .net - 为什么要在 .NET 中使用“.pfx”文件

> ID：398610
> 
> 赞同：19
> 
> 时间：2008-12-29T20:47:27.380
> 
> 标签：.net, pfx

.NET 中使用的“.pfx”扩展名是什么？

为什么在构建解决方案时要求输入密码？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-29T20:51:44.187

包含加密私钥的文件。它可能被用于对应用程序进行代码签名（因此用户知道谁创建了程序，因此他们是否可以信任它）。

通过右键单击项目，获取属性，然后查看签名选项卡，您可能会看到它正在被使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T20:50:18.230

.pfx 是安全证书的扩展。它们通常受密码保护。

# c# - Linq to SQL 类

> ID：398612
> 
> 赞同：0
> 
> 时间：2008-12-29T20:47:37.333
> 
> 标签：c#, .net, sql, linq, linq-to-sql

我有一个类，见下文，当我尝试从另一个页面查询它时，它没有链接，例如，如果我输入“var Notes = HandhedNotes.GetNotesByLinkIDJoin();” 当我查看注释时，那里没有链接。我认为这是由于 IQuerable 也许我应该使用其他东西？

```
namespace WebSys
{
  public partial class HandheldNote
  {        
    public static IQueryable GetNotesByLinkIDJoin()
    {
        WebSysDataContext db = new WebSysDataContext(Contexts.WEBSYS_CONN());

        var Note = from x in db.HandheldNotes
                   join t in db.Employees on x.By equals t.EmployeeNo
                   orderby x.DateAdded
                   select new
                   {
                       DateRaised = x.DateAdded,
                       Note = x.Note,
                       TypeID = x.TypeID,
                       EmployeeID = t.Forenames + " " + t.Surname
                   };
        return (IQueryable)Note;
    }

} 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T21:10:40.610

随便你想要什么。
看来您实际上是在尝试收集笔记，因此您可以这样做...

```
public IList<Note> GetMyNotes()
{
IList<Note> NoteList = (from x in db.HandheldNotes
                   join t in db.Employees on x.By equals t.EmployeeNo
                   orderby x.DateAdded
                   select new Note
                   {
                       DateRaised = x.DateAdded,
                       Note = x.Note,
                       TypeID = x.TypeID,
                       EmployeeID = t.Forenames + " " + t.Surname
                   }).ToList<Note>();
        return NoteList;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T20:52:57.680

你没有列举任何东西。延迟加载是最好的。访问 Note 上的匿名参数之一，您将能够访问它们。

您还可以做的是创建课程...

```
public class Note
{
public DateTime DateRaised;
public string Note ;
public int TypeID;
public string EmployeeID;
} 
```

接着

```
Note Note = (from x in db.HandheldNotes
                   join t in db.Employees on x.By equals t.EmployeeNo
                   orderby x.DateAdded
                   select new Note
                   {
                       DateRaised = x.DateAdded,
                       Note = x.Note,
                       TypeID = x.TypeID,
                       EmployeeID = t.Forenames + " " + t.Surname
                   }).FirstOrDefault();
        return Note; 
```

我认为重要的是要这样说：

您正在创建 DataContext，然后尝试返回尚未枚举的 LINQ 变量。当您尝试访问此信息时，您将收到底层数据上下文不存在的错误。您的 2 个选项是在其他地方使用 Datacontext 或从此函数返回枚举值。使用 ToArray() 或 ToList() 或类似的东西......

# c# - System.Text.Encoding.GetEncoding("iso-8859-1") 抛出 PlatformNotSupportedException？

> ID：398621
> 
> 赞同：14
> 
> 时间：2008-12-29T20:50:14.283
> 
> 标签：c#, .net, compact-framework

请参阅主题，请注意此问题仅适用于 .NET**紧凑型**框架。这发生在附带 Windows Mobile 6 Professional SDK 的模拟器以及我的英文版 HTC Touch Pro（所有 .NET CF 3.5）上。iso-8859-1 代表西欧 (ISO)，它可能是除了 us-ascii 之外最重要的编码（至少当一个通过 usenet 帖子的数量时）。

我很难理解为什么不支持这种编码，而支持以下编码（同样在模拟器和我的 HTC 上）：

*   iso-8859-2（中欧 (ISO)）
*   iso-8859-3（拉丁文 3 (ISO)）
*   iso-8859-4（波罗的海 (ISO)）
*   iso-8859-5（西里尔文 (ISO)）
*   iso-8859-7（希腊语 (ISO)）

那么，支持说希腊语是否比支持德语、法语和西班牙语更重要？任何人都可以对此有所了解吗？

谢谢！

安德烈亚斯

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-29T21:15:23.080

我会尝试使用“windows-1252”作为编码字符串。[根据维基百科](http://en.wikipedia.org/wiki/Windows-1252)，Windows-1252 是 ISO-8859-1 的超集。

```
System.Text.Encoding.GetEncoding(1252) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-29T21:13:36.110

[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/x5b31f9d.aspx "这篇 MSDN 文章")说：

> .NET Compact Framework 支持所有设备上的字符编码：Unicode（BE 和 LE）、UTF8、UTF7 和 ASCII。
> 
> 对代码页编码的支持有限，并且仅当设备的操作系统能够识别编码时。
> 
> 如果所需的编码在设备上不可用，.NET Compact Framework 将引发 PlatformNotSupportedException。

我相信所有（或至少许多）ISO 编码都是代码页编码，属于“有限支持”规则。UTF8 可能是您最好的替代品。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-07-07T20:01:16.360

我稍后才知道，但我为 .net cf 实现了编码 ISO-8859-1，我希望这会有所帮助：

```
namespace System.Text
{
    public class Latin1Encoding : Encoding
    {
        private readonly string m_specialCharset = (char) 0xA0 + @"¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ";

        public override string WebName
        {
            get { return @"ISO-8859-1"; }
        }

        public override int CodePage
        {
            get { return 28591; }
        }

        public override int GetByteCount(char[] chars, int index, int count)
        {
            return count;
        }

        public override int GetBytes(char[] chars, int charIndex, int charCount, byte[] bytes, int byteIndex)
        {
            if (chars == null)
                throw new ArgumentNullException(@"chars", @"null array");
            if (bytes == null)
                throw new ArgumentNullException(@"bytes", @"null array");
            if (charIndex < 0)
                throw new ArgumentOutOfRangeException(@"charIndex");
            if (charCount < 0)
                throw new ArgumentOutOfRangeException(@"charCount");
            if (chars.Length - charIndex < charCount)
                throw new ArgumentOutOfRangeException(@"chars");
            if (byteIndex < 0 || byteIndex > bytes.Length)
                throw new ArgumentOutOfRangeException(@"byteIndex");

            for (int i = 0; i < charCount; i++)
            {
                char ch = chars[charIndex + i];
                int chVal = ch;
                bytes[byteIndex + i] = chVal < 160 ? (byte)ch : (chVal <= byte.MaxValue ? (byte)m_specialCharset[chVal - 160] : (byte)63);
            }

            return charCount;
        }

        public override int GetCharCount(byte[] bytes, int index, int count)
        {
            return count;
        }

        public override int GetChars(byte[] bytes, int byteIndex, int byteCount, char[] chars, int charIndex)
        {
            if (chars == null)
                throw new ArgumentNullException(@"chars", @"null array");
            if (bytes == null)
                throw new ArgumentNullException(@"bytes", @"null array");
            if (byteIndex < 0)
                throw new ArgumentOutOfRangeException(@"byteIndex");
            if (byteCount < 0)
                throw new ArgumentOutOfRangeException(@"byteCount");
            if (bytes.Length - byteIndex < byteCount)
                throw new ArgumentOutOfRangeException(@"bytes");
            if (charIndex < 0 || charIndex > chars.Length)
                throw new ArgumentOutOfRangeException(@"charIndex");

            for (int i = 0; i < byteCount; ++i)
            {
                byte b = bytes[byteIndex + i];
                chars[charIndex + i] = b < 160 ? (char)b : m_specialCharset[b - 160];
            }

            return byteCount;
        }

        public override int GetMaxByteCount(int charCount)
        {
            return charCount;
        }

        public override int GetMaxCharCount(int byteCount)
        {
            return byteCount;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T21:26:01.483

奇怪的是 8859-1 不受支持，但也就是说，UTF-8 确实有能力表示所有 8859-1 字符（以及更多），所以你有理由不能只使用 UTF- 8代替？这就是我们在内部所做的，我今天刚刚处理了几乎同样的问题。使用 UTF-8 的好处是您可以在不进行修改且不增加西方语言权重的情况下获得对远东和西里尔语言的支持。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-11-10T09:34:29.447

如果有人遇到异常（.NET 紧凑框架），例如：

```
 System.Text.Encoding.GetEncoding(“iso-8859-1”) throws PlatformNotSupportedException,

//Please follow the steps: 

   byte[] bytes=Encoding.Default.GetBytes(yourText.ToString);

//The code is:

    FileInfo fileInfo = new FileInfo(FullfileName); //file type :  *.text,*.xml 
    string yourText = (char) 0xA0 + @"¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ";

    using (FileStream s = fileInfo.OpenWrite()) {
                        s.Write(Encoding.Default.GetBytes(yourText.ToString()), 0, yourText.Length);
    } 
```

# c++ - C++ 中的工厂和动态分配问题

> ID：398641
> 
> 赞同：3
> 
> 时间：2008-12-29T20:55:58.733
> 
> 标签：c++, design-patterns, factory

我有一个工厂，可以在我的应用程序中构建生命周期最长的对象。比如说，它们具有`ClientA`依赖`ClientB`于`Provider`（具有许多可能实现的抽象类）的类型，因此两个客户端都有对 Provider 的引用作为成员。

根据命令行参数，工厂选择一个实现`Provider`，构造它（用“ `new`”），并将它传递给两个客户端的构造函数。

工厂返回一个代表我的整个应用程序的对象。我的主要功能基本上是这样的：

```
int main(int argc, char** argv)
{
    AppFactory factory(argc, argv);
    App app = factory.buildApp();
    return app.run();
} 
```

`buildApp`方法基本上是这样的：

```
App AppFactory::buildApp()
{
    Provider* provider = NULL;

    if (some condition)
    {
        provider = new ProviderX(); 
    }
    else
    {
        provider = new ProviderY();
    }

    ClientA clientA(*provider);
    ClientB clientB(*provider);

    App app(clientA, clientB);
    return app;
} 
```

所以，当执行结束时，所有对象的析构函数都会被调用，除了提供者对象（因为它是用“ `new`”构造的）。

如何改进此设计以确保调用提供程序的析构函数？

编辑：澄清一下，我的意图是客户端、提供者和 App 对象共享相同的生命周期。在所有答案之后，我现在认为客户端和提供者都应该在堆上分配其传递给 App 对象的引用，该对象将负责在它死时删除它们。你说什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T06:03:03.403

共享所有权智能指针非常简单：

```
App AppFactory::buildApp()
{
    boost::shared_ptr<Provider> provider;

    if (some condition)
    {
        provider.reset(new ProviderX()); 
    }
    else
    {
        provider.reset(new ProviderY());
    }

    ClientA clientA(provider);
    ClientB clientB(provider);

    App app(clientA, clientB);
    return app;
} 
```

假设 app 对象拥有客户端，并且客户端都共享一个提供者。让客户接受 a `shared_ptr<Provider>`then，而不是 a `Provider&`。只要仍然存在拥有提供程序对象的 shared_ptr 的副本，就不会释放该对象。

最好不要复制clientA和clientB，也不要通过值返回来复制应用程序，而是将客户端移动到应用程序中，并将应用程序本身移动到返回的对象中。这将在即将推出的 C++ 版本中实现。但目前，要么将它们设为指针（使用 shared_ptr），要么继续复制它们。另一种选择是使用 auto_ptr，它具有伪所有权转移语义。但该模板存在一些固有问题。所以你应该避免使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T21:00:44.467

使提供者成为 AppFactory 的实例变量。然后将 provider 设为智能指针或在 AppFactory 的 dtor 中将其删除。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T21:38:03.487

除非 App 的构造函数复制客户端，否则它们也需要进行 new() 处理 - 当前的客户端分配在堆栈上，并且在返回应用程序时将被删除。

我认为您可能需要注意正在创建哪些对象 - 例如将调试语句放在客户端的构造函数中。

您可能想要的是让 Provider 被引用计数，并让每个 Client 减少引用计数，但这是很多工作。

或者让 AppFactory 拥有 Provider。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T21:02:33.917

这里并没有足够的帮助，但是您可以在不进行太多更改的情况下向 Provider 对象添加引用计数，并且当客户端被破坏时，它们会删除引用。当 Provider 对象中的引用变为 0 时，调用 delete this。

你的生命周期和范围有点粗略。为什么要在堆栈上创建一些对象，而在堆上创建一些对象——特别是你的客户？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T22:00:55.563

一个选项是让工厂返回一个 AppComponents 对象，其中包含工厂构造的所有组件。即是这样的：

```
int main(int argc, char** argv)
{
    AppFactory factory(argc, argv);
    AppComponents components = factory.buildApp();
    return components.getApp().run();
} 
```

然后 AppComponents 类将负责删除您的 Provider 和其他对象。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T22:25:19.100

将provider设为AppFactory的成员变量，并在析构函数中删除：

```
class AppFactory
{
    public:
    AppFactory(int argc, char** argv) : provider(NULL)
    {
       //...
    }
    ~AppFactory()
    {
        if (provider != NULL)
            delete provider;
    }
    App buildApp()
    {

        if (some condition)
        {
            provider = new ProviderX(); 
        }
        else
        {
            provider = new ProviderY();
        }

        ClientA clientA(*provider);
        ClientB clientB(*provider);

        App app(clientA, clientB);
        return app;

    } 
    private:
    Provider* provider;

};

int main(int argc, char** argv)
{
    AppFactory factory(argc, argv);
    App app = factory.buildApp();
    return app.run();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T06:25:15.467

您说“提供程序和 App 对象共享相同的生命周期”，但请注意在 C++ 中，以下代码片段...

```
App app(clientA, clientB);
return app; 
```

...正在返回 App 对象的*副本*：因此您可以（取决于编译器，例如参见[http://msdn.microsoft.com/en-us/library/ms364057(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms364057(VS.80).aspx) ）实际上有两个 App 对象实例（一个在 AppFactory::buildApp() 方法内，另一个在 main 函数内）。

为了回答您的问题，我想我同意您的编辑：将指针传递给您的 App 构造函数，将其存储为 App 实例的成员数据，并在您销毁 App 实例时将其删除。但是，除此之外，您还可以更改代码以确保不复制 App 实例：例如，在堆上分配 App 实例，更改 AppFactory::buildApp() 方法以返回指向App，并在 main 函数结束时删除 App 实例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T21:01:33.763

打电话

```
delete provider;
provider = NULL; 
```

在 ClientA 和 ClientB 的析构函数中。这也将调用提供者的析构函数。

# .net - .NET 中的序列化异常：System.InvalidOperationException：您必须在 System.Collections.Generic.Stack`1 上实现默认访问器

> ID：398642
> 
> 赞同：1
> 
> 时间：2008-12-29T20:56:14.537
> 
> 标签：.net, generics, serialization

我想做的就是

```
XmlSerializer serializer = new XmlSerializer(typeof(Stack<int>)); 
```

我在运行时得到以下信息：

`System.InvalidOperationException``System.Collections.Generic.Stack`：您必须在`1 [[System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]上实现默认访问器， 因为它继承自 ICollection。

我不应该序列化`Stack<int>`吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-29T21:16:04.030

由于 Stack 类没有默认访问器（例如通过索引），因此您无法使用该方法对其进行序列化。

我建议将您的堆栈复制到列表然后序列化列表。

```
List<int> serializableLIst = new List<int>( myStack );
XmlSerializer serializer = new XmlSeralizer(typeof(List<int>)); 
```

看看是不是效果更好。

# sql - 正确的一对一映射表

> ID：398648
> 
> 赞同：0
> 
> 时间：2008-12-29T20:58:33.283
> 
> 标签：sql, mapping, one-to-one

我想制作一个只有两个整数列的表，作为两个不同数据集之间的映射表，我希望对其施加正确的约束。

我最初将两列设置为复合主键，但后来意识到这代表了多对多，只防止发生重复的多对多映射。

如何指定我希望两列在所有行中都是唯一的整数？我正在使用 MS SQL，但我想这是一个一般的数据库设计问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T21:03:43.447

创建另一个表是为了创建多对多关系，因此您可能不应该创建它（除非我遗漏了什么）。

One to one mandatory is the same as having the two tables as a single table. The only acceptable one to one is optional, and you simply have to relate the two tables, no third table necessary.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T21:02:58.813

在一个列上创建一个主键，在另一列上创建另一个单独的唯一约束或唯一索引。

```
CREATE TABLE [dbo].[test](
    [x] [int] NOT NULL,
    [y] [int] NOT NULL,
     CONSTRAINT [PK_test] PRIMARY KEY CLUSTERED 
     ( [x] ASC) 
     WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, 
         IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, 
         ALLOW_PAGE_LOCKS  = ON) 
     ON [PRIMARY]) 
 ON [PRIMARY]

CREATE UNIQUE NONCLUSTERED INDEX [IX_test] ON [dbo].[test] 
  ([y] ASC) 
   WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, 
         SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, 
         DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, 
         ALLOW_PAGE_LOCKS  = ON)  
 ON [PRIMARY] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T21:02:05.353

对每列使用 UNIQUE 列约束。

# c# - VB到C#翻译实现接口事件的事件处理程序

> ID：398651
> 
> 赞同：1
> 
> 时间：2008-12-29T21:01:05.340
> 
> 标签：c#, vb.net, events

我正在查看 VB 中的 WPF 中的代码。我正在尝试将其转换为 C#。尽管我使用 VB .Net 到 C# 转换器，但我无法找出 C# 中以下代码的正确语法。任何想法如何用 C# 编写这个？

VB代码：

```
Public Event PropertyChanged As PropertyChangedEventHandler Implements System.ComponentModel.INotifyPropertyChanged.PropertyChanged 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T21:36:00.447

这篇文章应该会有所帮助：

[如何：实现接口事件（C# 编程指南）](http://msdn.microsoft.com/en-us/library/ak9w5846.aspx)

所以在你的情况下它应该是（理论上）：

```
 public event PropertyChangedEventHandler PropertyChanged; 
```

# java - 正常运行 GWT shell，编译时使用 -noserver？

> ID：398654
> 
> 赞同：1
> 
> 时间：2008-12-29T21:02:03.870
> 
> 标签：java, eclipse, gwt

我想在“测试”时运行 GWT shell（漂亮的小 Google 弹出式浏览器窗口），然后单击工具上的实际“编译/浏览”，将程序编译到不同的目录并使用 -noserver 模式在我的 IIS 服务器上对其进行测试。

问题：

我没有编辑正常的 shell 脚本，所以它启动得很好。我所做的编辑会在刷新时查看。然而，编译/浏览将我带到 mini-Tomcat 服务器而不是我的目录。编译似乎正在运行（因为我可以直接浏览到该目录并且它正在接收更新），但编译/浏览并没有将我分流到那里。

这是我现在得到的编译脚本：

```
@java -Xmx256M -noserver -port 80 -cp "%~dp0\src;%~dp0\bin;C:/dev/gwt-windows-1.5.3/gwt-user.jar;C:/dev/gwt-windows-1.5.3/gwt-dev-windows.jar" com.google.gwt.dev.GWTCompiler -out c:/dev/Practice /Practice/Practice.html 
```

显然，我想去的区域是“ [http://localhost/Practice/Practice.html](http://localhost/Practice/Practice.html) ”（IIS 服务器），但它正在跳转到“ [http://localhost:8888/practice.Practice/Practice.html](http://localhost:8888/practice.Practice/Practice.html) ”（ Tomcat 服务器）。

想法？

（PS Running Eclipse for editor，运行/调试配置参数为：

```
practice.Practice/Practice.html 
```

就是这样）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T19:01:29.633

您可以为 GWTCompiler 类创建一个 Eclipse 运行配置文件。您传入的参数之一是要编译到的路径，因此您可以从 Eclipse 运行编译，如果您指定它，它会将文件直接写入 IIS 的文件夹。编译完成后，您可以使用已经打开的托管模式实例，只需输入[http://localhost/Practice/Practice.html](http://localhost/Practice/Practice.html)路径，它就会工作。

托管模式浏览器可以指向任何服务器，即使不使用 -noserver 运行它，如果您收到有关离开域的安全警告，您可以将 -whiteList 参数添加到托管模式运行配置文件。安全警告将为您提供一个示例 whiteList 参数。

尝试在没有参数的情况下运行 GWTCompiler 和 GWTShell。我会更详细，但我现在没有开发环境。

# oracle - 在 Oracle 中何时使用 vsize 函数而不是 length 函数的有用示例？

> ID：398664
> 
> 赞同：4
> 
> 时间：2008-12-29T21:04:39.670
> 
> 标签：oracle, plsql

似乎 vsize() 和 length() 返回相同的结果。有谁知道何时使用 vsize 而不是长度的实际示例？

```
select vsize(object_name), length(object_name) from user_objects 
```

结果：

```
/468ba408_LDAPHelper    20  20
/de807749_LDAPHelper    20  20
A4201_A4201_UK  14  14
A4201_PGM_FK_I  14  14
A4201_PHC_FK_I  14  14 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T14:30:51.320

嗯，Length() 接受一个字符参数（CHAR、VARCHAR2、NCHAR、NVARCHAR2、CLOB 或 NCLOB），而 VSize() 接受几乎任何数据类型，所以如果你传递 Length() 一个非字符数据类型，则必须有一个隐式转换。

长度对字符集也很敏感。

```
drop table daa_test;
create table daa_test as select sysdate dt from dual;
alter session set nls_date_format = 'YYYY-MM-DD';
select vsize(dt)  from daa_test;
select length(dt) from daa_test;
alter session set nls_date_format = 'YYYY-MM-DD HH24:mi:ss';
select vsize(dt)  from daa_test;
select length(dt) from daa_test; 
```

...给...

```
drop table daa_test succeeded.
create table succeeded.
alter session set succeeded.
VSIZE(DT)              
---------------------- 
7                      

1 rows selected

LENGTH(DT)             
---------------------- 
10                     

1 rows selected

alter session set succeeded.
VSIZE(DT)              
---------------------- 
7                      

1 rows selected

LENGTH(DT)             
---------------------- 
19                     

1 rows selected 
```

恕我直言，VSize 在理解数据的内部存储需求方面确实很有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T21:28:01.883

请参阅：[http ://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1897591221788](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1897591221788)

# asp.net-mvc - 带有 Spring.NET 和 ModelBinder 的 ASP.NET MVC

> ID：398665
> 
> 赞同：3
> 
> 时间：2008-12-29T21:05:29.823
> 
> 标签：asp.net-mvc, unity-container, spring.net

我正在做一个使用 ASP.NET MVC 中的 Spring.NET IoC 功能的演示。这有点像 www.asp.net 网站上的结对编程视频教程中介绍的 MyBlog 应用程序。我已经使用 Microsoft 的 Unity 框架完成了相同的演示，现在想试用 Spring 容器。为此，我实现了一个简单的 IControllerFactory，它首先像这样创建 Spring 对象工厂：

```
IObjectFactory factory;
(....)
factory = new XmlObjectFactory(new FileSystemResource(application.Server.MapPath("objects.xml"))) 
```

接下来它从该工厂获取控制器，如下所示：

```
public IController CreateController(System.Web.Routing.RequestContext requestContext, string controllerName) {
    IController result = context.GetObject(controllerName) as IController;
    return result;
} 
```

（为简化起见，删除了错误处理）。

现在在我的 HomeController 的某个地方，我有这样的动作：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult AddEntry([Bind] BlogEntry entry, int id) {
    entry.EntryDate = DateTime.Now;
.... 
```

这是 AddEntry.aspx 视图的一部分，它定义了条目参数的编辑器（非常基本的东西）：

```
<form method="post" action="/Home/AddEntry/<%= ViewData["id"] %>">
    <table>
        <tr>
            <td><label for="Title">Title</label></td>
            <td><input name="entry.Title" type="text"/></td>
        </tr>
        <tr>
            <td><label for="Text">Content</label></td>
            <td><input name="entry.Text" type="text"/></td>
        </tr>
    </table>
    <br />
    <input type="submit" value="Add entry" />
    <input type="button" value="Cancel" onclick="history.back(-1);" />
</form> 
```

现在是这样：当我使用 Unity IoC 时，它就像一个魅力。“entry”参数从我的表单中反序列化，就像它应该和行一样

```
entry.EntryDate = DateTime.Now; 
```

完成没有问题。

但是，当我切换到 Spring.NET 对象工厂（如上所述）时，事情开始变得疯狂。首先，参数“entry”变为空，因此引发异常。为了跟踪可能出现的问题，我实现了一种自定义 IModelBinder，如下所示：

```
public class BlogEntryBinder : IModelBinder {
    public ModelBinderResult BindModel(ModelBindingContext bindingContext) {
        ModelBinderResult result = ModelBinders.DefaultBinder.BindModel(bindingContext);
        return result;
    }
} 
```

当我使用 Unity 框架来到这里并从 bindingContext 向下钻取到 HttpRequest 时，我看到 Request.HttpMethod 是“POST”并且 Request.Form 已正确填充。当我使用 Spring.NET 做同样的事情时，方法是“GET”并且 Request.Form 是空的。然而，当我在这两种情况下进入我的控制器操作 (AddEntry) 并深入到 Request 时，我看到 Request.HttpMethod 和 Request.Form 具有它们正确的值。

现在的问题是如何使用 Spring.NET 修复该版本，使其与使用 Unity 框架的版本一样工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T21:35:41.057

我找到了答案！

我的对象定义如下所示：

```
<!-- Controlers -->
<object name="Home" type="MyBlog.Controllers.HomeController">
    <property name="BlogService" ref="BlogService" />
    <property name="BlogEntryService" ref="BlogEntryService" />
    <property name="BlogEntryCommentService" ref="BlogEntryCommentService" />
</object> 
```

没关系设置的属性它实际上做了什么，每次我请求这个对象时它都会返回相同的实例

```
IController result = context.GetObject(controllerName) as IController; 
```

所以当我将定义更改为

```
<!-- Controlers -->
<object name="Home" type="MyBlog.Controllers.HomeController" singleton="false">
    <property name="BlogService" ref="BlogService" />
    <property name="BlogEntryService" ref="BlogEntryService" />
    <property name="BlogEntryCommentService" ref="BlogEntryCommentService" />
</object> 
```

一切都开始工作得很好。

最好的问候，马蒂亚斯。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-04T17:47:28.430

只是为了澄清这种行为的附加说明：控制器被 ASP.NET MVC 框架视为原型，但 Spring 默认为单例模式。因此，您需要在容器配置中将您的对象显式标记为非单例。即将推出的 Spring MVC 集成模块将处理此问题，因此您不会遇到此问题。

hth，埃里希

# .net - 类 DLL 的 App.config 有我在网络应用程序中需要的信息

> ID：398671
> 
> 赞同：2
> 
> 时间：2008-12-29T21:08:43.950
> 
> 标签：.net, configuration

我有一个包含多个服务引用的类库。为了推进项目，我将`<system.serviceModel>`配置部分从 app.config 复制到 web.config 中。现在它工作得很好，因为我目前只有两个参考资料。我将遇到的问题是，我不会自动将任何其他服务引用添加到库中，如果我在不执行复制和粘贴操作的情况下调用它们，我的代码将会中断。我可以做些什么来确保我的应用程序可以自动访问库 app.config 文件中的 WCF 端点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T09:51:48.327

看看以下页面： http: [//msdn.microsoft.com/en-us/library/ms734706](http://msdn.microsoft.com/en-us/library/ms734706(VS.85).aspx) (VS.85).aspx 。我相信可以在另一个中“包含”一个单独的配置文件。您需要确保已部署类库的 app.config 文件，并将其链接到 web.config。

# ruby-on-rails - Rails：如何观察实际上没有模型的连接记录？

> ID：398673
> 
> 赞同：5
> 
> 时间：2008-12-29T21:09:36.087
> 
> 标签：ruby-on-rails, ruby, associations, observer-pattern, has-and-belongs-to-many

是否可以使用 Observer 来观察 JOIN 记录的创建？例如，您有一个拥有_and_belongs_to_many Book Models 的用户模型。是否可以在创建或删除 books_users 记录时对其进行监控，或者我必须有一个 BookUser 模型来执行此操作？

我想观察的例子：

```
User.books << book 
```

或者

```
User.books.push(book) 
```

管他呢！

谢谢，

戴夫·K。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T21:15:32.207

这就是您应该使用 has_many :through 而不是 has_and_belongs_to 的确切原因；它允许您创建一个 BookUser 模型，其中可以使用常规的 activerecord 回调/观察者（例如 after_save）。该站点更好地解释了差异，[http://blog.hasmanythrough.com/2006/4/20/many-to-many-dance-off](http://blog.hasmanythrough.com/2006/4/20/many-to-many-dance-off)

# asp.net - Firefox 中的“连接部分加密”

> ID：398676
> 
> 赞同：0
> 
> 时间：2008-12-29T21:10:59.767
> 
> 标签：asp.net, javascript, firefox, ssl

我无法确定这是 Firefox 中的错误还是网站异常，因为它似乎只通过特定顺序发生。

*TLDR 步骤如下*

如果您访问主页（下面的链接），然后单击引号链接，它会将您发送到一个名为 quoteconfig.aspx 的页面，该页面会检查 javascript，然后在启用时重定向您，否则会向您发出警告。自动重定向后，Firefox 显示有关“连接部分加密”的 SSL 警告（请参阅状态栏上的图标）。但是，如果您单击不执行 javascript 重定向的登录或我的帐户链接，则不会出现 SSL 警告。此外，在刷新页面或浏览到另一个页面然后再次单击引号链接时，SSL 警告就会消失。

我已经运行了 Fiddler 和 Windows 网络监视器并验证了页面上的所有链接都是 https://。它在 IE 7&8、Safari、Opera 和 Chrome 上运行良好。

还能是什么？

脚步：

1.  使用 Firefox 访问下面的 url（在 3.0.5 上测试）
2.  点击报价链接
3.  观察状态栏中的 SSL 警告

[网站链接](http://www.zoomrp.com)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T21:28:09.030

看起来`window.location = "quote.aspx"`可能是罪魁祸首。至少在我的浏览器上，它重定向到页面的 http 版本，而不是 https。然后 http 立即使用 302 重定向到 https。

# c# - 数据访问库返回数据集或对象

> ID：398680
> 
> 赞同：4
> 
> 时间：2008-12-29T21:13:28.980
> 
> 标签：c#, sql, serialization

在使用调用存储过程的库时是否存在普遍共识？返回数据集或使用 sqldatareader 填充自定义对象？

序列化数据传输对象的成本是否低于数据集？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T23:56:05.797

就个人而言，我将 SqlDataAdapter 与 DataTables 一起使用。DataTables 的开销比 DataSets 少得多*。*我的实体对象仅包含业务规则，它们不用于跨层传输数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T23:59:13.840

您可能想考虑跳过数据访问库；取而代之的是，在需要时自动为您提供业务对象并填充数据。[休眠](http://en.wikipedia.org/wiki/NHibernate)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T00:16:41.013

我必须同意正义，不一定是关于 NHibernate（尽管这是一个很好的选择）我肯定会考虑使用某种 ORM，如 NHibernate、Subsonic、Linq-to-sql、llblgen 或周围的任何其他 ORM .

正如[杰里米米勒所说：](http://codebetter.com/blogs/jeremy.miller/archive/2008/11/07/how-to-design-your-data-connectivity-strategy.aspx)

> 如果您手动编写 ADO.Net 代码，那么您就是在窃取您的雇主或客户的信息。

为此，我不得不推荐返回对象而不是数据集或数据表。

此外，如果您要返回数据集，除非您强烈键入每个数据集，否则您将不得不在库中编写大量“提升”代码以从数据集中获取值。使用 ORM 和对象，所有繁重的工作都为您完成。

最后，使用 c# 中的 Linq，您现在可以获得更好的功能来处理可能给数据集带来优势的集合（聚合、分组、排序、过滤等）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T21:19:33.320

我也使用 dataReader，但请注意，如果你这样做了，你必须小心在完成自定义对象的填充后尽快关闭它（以及它正在使用的连接）......一个陷阱请注意，当您调用 OpenReader() 时，请确保将名为 CommandBehavior 的可选参数设置为 CommandBehavior.CloseConenction，或者，即使您关闭了阅读器，底层连接也不会关闭并释放到池中，直到它获得由 GC 拾取，如果您在循环中调用多个读取器对象，这很容易导致您用完可用的连接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T21:45:06.093

在某些时候，这取决于库的目的，或者我可以说，库的功能。由于 OOP 炒作，“普遍共识”是首先使用数据读取器检索/获取 DAL 中的数据，因为它们更快，然后加载您的对象并关闭您的读取器，但是，情况并非总是如此。为了简单起见，有些人传回数据集，以便可以限制网格视图，并且可以使用最少的代码启用分页/排序。记住简单是最好的。

然而，在报告应用程序中，我注意到数据集的相似之处，尤其是当数据由 Web 服务公开时。

序列化的成本将取决于应用程序的使用情况和经验。缺乏经验的开发人员可能会在数据集中返回 3000 到 50000 行不必要的数据。请记住，数据集是一种动物，但具有很多功能。明智地使用。

大多数 ORM 在幕后进行序列化（我在这里更正）所以可以公平地说它不会花费那么多，但话又说回来，它取决于应用程序。

# c++ - 在 C++ 文件中查找语句模式

> ID：398682
> 
> 赞同：2
> 
> 时间：2008-12-29T21:13:52.863
> 
> 标签：c++, parsing, macros

我有一个看起来像这样的宏：

```
#define coutError    if (VERBOSITY_SETTING >= VERBOSITY_ERROR)    ods() 
```

其中 ods() 是一个行为类似于 cout 的类，而 VERBOSITY_SETTING 是一个全局变量。其中有一些用于不同的详细设置，它允许代码看起来像这样：

```
if (someErrorCondition)
{
    // ... do things relating to the error condition ...

    coutError << "Error condition occurred";
} 
```

并且在这个框架中有设置详细程度等的功能。但是，当不使用大括号时，明显的模式会中断，如下所示：

```
void LightSwitch::TurnOn()
{
    if (!PowerToSwitch)
        coutError << "No power!";
    else
        SwitchOn = true;
} 
```

因为宏，会变成这样：

```
void LightSwitch::TurnOn()
{
    if (!PowerToSwitch)
        if (VERBOSITY_SETTING >= VERBOSITY_ERROR)
            ods() << "No power!";
        else
            SwitchOn = true;
} 
```

这不是 if 语句的预期功能。

现在，我了解了一种正确修复此宏的方法，因此它不会导致此问题，但我想对代码进行审核并找到任何具有“if (...) coutError < < ...; else" 以查明是否有任何其他情况发生这种情况，以确保在修复宏时，它确实是正确的功能。

我可以使用任何语言/工具来找到它，我只想知道最好的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T21:33:33.853

您可以尝试 - 暂时 - 将宏修改为这样的东西，看看什么不能编译......

```
#define coutError {} if (VERBOSITY_SETTING >= VERBOSITY_ERROR) ods() 
```

'else' 子句现在应该给出错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T22:05:18.453

不要费心去寻找代码中发生逻辑错误的所有位置——从源头上解决问题！更改宏，以免出错：

```
#define coutError if(VERBOSITY_SETTING < VERBOSITY_ERROR); else ods() 
```

请注意，我在这里所做的是反转测试，为`then`子句添加一个空语句，并将输出对象放入`else`子句中。这仍然允许您`<< foo << bar`在宏之后使用，并且如果您有一个`else`属于不同`if`语句的尾随子句，它将正确匹配，因为它像这样扩展：

```
if(foo)
    coutError << bar;
else
    baz(); 
```

变成

```
if(foo)
    if(VERBOSITY_SETTING < VERBOSITY_ERROR)
        ;
    else
        ods() << bar;
else
    baz(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T21:47:59.957

我认为宏的所有良好用法都以'{'或';'开头。

所以试试这个正则表达式：

```
[^{;]\s*coutError 
```

您需要打开多行匹配并搜索整个文件。

您可能需要获取更多的东西，以便您可以找到有问题的行:-)

或者，如果我们可以解决一些会正确失败的问题，那么更改宏是一个好主意。可能是一个块后跟条件运算符：

```
#define coutError {} (VERBOSITY_SETTING >= VERBOSITY_ERROR)?(ods()):(nullstream()) 
```

（但确实需要实现 nullstream() 运算符。）

（或者完全暂时摆脱条件 - 正如您所建议的那样，是对另一个答案@Roddy（当前选择的答案）的评论）。

ps 我知道你没有问，但是一个简单的方法来包装宏以使其安全是使用`do {} while(false)`循环。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T21:57:00.187

我在您上面的评论中看到您正在考虑在宏中使用模板，但我还不能发表评论（我还差 9 分），所以...

什么阻止你做

```
#define CoutError(s) { if (VERBOSITY_SETTING >= VERBOSITY_ERROR){ ods(s); } } 
```

进而

```
void LightSwitch::TurnOn()
{
    if (!PowerToSwitch)
        CoutError("No power!");
    else
        SwitchOn = true;
} 
```

并重新定义 ods 以接受一个字符串，或者如果你不能，那么只需定义一个 OdsHelper 函数，该函数接受一个字符串，其主体只是 ods << inString?

如果没有明显的收获，我不会尝试模仿 << 语法的宏。至少对于模拟函数语法的宏，我们使用得更多，而且我们知道我们必须编写块来防止出现奇怪的问题。

你真的需要 << 语法吗？

你真的需要为这个简单的行为引入一个模板吗？

哦，最后一件事 - 不要使用宏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T21:19:31.823

我认为真正的问题是宏的使用——而不是被预处理的代码。但我认为这不是您正在寻找的答案。

我会找到一种完全不使用宏的方法——如果你确实使用条件编译，你可以在调用 ods() 时这样做——取决于一些#define，它可以使用你想要的任何功能。

只是我的 $.02

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T21:25:24.277

正则表达式搜索？

# windows - 如何确定Windows中进程的内存布局？

> ID：398696
> 
> 赞同：4
> 
> 时间：2008-12-29T21:18:52.590
> 
> 标签：windows, memory

我如何确定进程可以访问哪些内存，而不是调用`ReadProcessMemory()`每个字节/页面/任何东西来查看它是获胜还是失败？

（我知道这一定是可能的，因为有几个工具可以显示此类信息，例如 IDA Pro 调试器、WinHex、Sysinternals 的进程监视器，...）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T21:34:10.000

[VirtualQueryEx](http://msdn.microsoft.com/en-us/library/aa366907(VS.85).aspx)可能是您想要的功能。

# .net - 像 MySQL 这样的开源数据库可以支持我的网站的负载吗？

> ID：398704
> 
> 赞同：6
> 
> 时间：2008-12-29T21:21:13.333
> 
> 标签：.net, mysql, database, open-source

我即将开始开发一个产品（在 .NET 中），并且我正在评估开源数据库引擎，以避免在我的产品的总成本中增加许可成本。

你知道哪些是有效的？MySQL 是一个不错的选择吗？它可以支持什么样的网站负载？

你有在现实生活项目中使用开源数据库的经验吗？

还是我只需要使用 Oracle 或 SQL Server 来开发强大的产品？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-29T21:24:27.617

MySQL 足以让 Flickr、Facebook、Wikipedia、Google 和 YouTube 使用它（Wiki 说）——我想说它们各自提供的负载比你可能达到的要多。我相信 WordPress.com - 超过 400 万个博客（[统计数据](http://wordpress.com/stats/)），包括 CNN、Time 等博客 - 也使用 MySQL。

开发强大的产品绝对不需要 Oracle/MSSQL。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-29T21:27:11.527

这个维基百科链接应该会有所帮助，它比较了大多数大型关系数据库。[http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems](http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems)假设您正确编写代码，Mysql 应该可以正常工作，这是 wikipedia 运行的内容，因此如果配置正确并在足够好的硬件/集群设置上运行，它应该支持几乎所有应用程序。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-29T21:25:24.900

这是一个很难回答的问题。应用程序的性质 数据库交互的性质和数量。我可以说 MySQL 和 PostgreSQL 在大多数情况下都可以像任何 DBMS 一样工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-30T01:30:03.410

MySQL 并不像你想象的那么便宜。

使用 MySQL 的大型组织花费大量资源来保持其运行，并且通常必须开发​​自己的扩展。MySQL 内部人员最近发表了几篇关于他们产品质量差的文章。我已经使用 MySQL 好几年了，在将所有权更改为 SUNW 之后，版本的质量急剧下降。

我意识到 MySQL 可以进行优化并使其运行良好，但我不是 dba，也无法在我的所有项目中拥有 dba。我有几个非常复杂的查询，有时会导致系统内存不足。我目前正在将我的系统迁移到 SQL Server Express。测试查询在 SQL Server Express 上的运行速度明显快于在 MySQL 上的运行速度。如果您在数据库方面不是很强大并且需要一个健壮和快速的系统，我不会使用 MySQL。SQL Server Express 更适合具有中等数据库知识的开发人员。他们已经自动化并调整了很多你必须在 MySQL 上手动完成的事情。

另一方面，如果您对数据库非常熟悉，则可能需要考虑 PostgresSQL。它是开源的。它不像 MySQL 那样用户友好，但据我粗略了解，它更强大，更稳定。

底线 - MySQL 曾经是一个不错的选择，但考虑 SQL Server Express 和 PostgresSQL 作为当前更好的选择。

编辑：

这里有一些参考资料。还有另外两个非常严厉的——但我把它们从reddit上拿了下来。

[蒙蒂说](http://monty-says.blogspot.com/2008/11/oops-we-did-it-again-mysql-51-released.html)

[这是个好举动吗](http://www.mysqlperformanceblog.com/2008/12/10/mysql-51-went-to-ga-was-it-a-good-move/)

[破坏mysql](http://feedblog.org/2008/12/04/destroying-mysql/)

[咬牙切齿](http://www.theregister.co.uk/2008/12/01/mysql_5_1_monty_rant/)

[批评](http://www.eweek.com/c/a/Database/MySQL-Founder-Urges-Cautious-Approach-to-MySQL-51/)

[随机论坛帖子](http://episteme.arstechnica.com/eve/forums/a/tpc/f/6330927813/m/377006385931)

[这是怎么回事](http://blogs.oracle.com/datacharmer/entry/what_s_going_on_in)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-29T21:24:57.867

MySql 应该可以满足您的需求...

它适用于很多很多企业。
另请注意，它有很多支持，熟悉它的开发人员，它仍在开发中，等等。不要再看了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-29T21:30:45.780

维基百科（恕我直言，有史以来最好的网络世界之一）在 MySQL 上运行，所以它不会很糟糕。我很高兴能够针对适合项目需要的任何 DB 平台进行编码，虽然 MSSQL 有一些有趣的功能，我真的从中获得了很多乐趣，但 MySQL 是我所有的开源包运行的基础，并且我不能说我对该设置有任何抱怨。如果您可以在 PostgreSQL 和 MySQL 之间进行选择，我建议您选择 PostgreSQL 路线，因为如果您深入研究存储过程和函数开发，PostgreSQL 将为您提供更强大的功能集供您使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-29T21:56:05.087

这一切都取决于您在数据库中寻找什么。实际上，您的数据集有多大？你需要什么样的负载？您是否需要集群和/或分区？你打算有一个全职的 DBA 吗？除了从 vanilla SQL 获得的内容之外，您还需要任何扩展吗？

该应用程序是真正的“绿地”推出，还是进入已经拥有现有基础设施/员工来支持现有数据库的环境？

MySQL 已经达到了它可以处理大多数你想要反对它的任何东西的地步，但是“免费”和“可以完成工作”本身还不足以做出决定。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-29T21:25:37.630

据我所知，SQL Express 是免费的。它可能缺少标准 SQL Server 的一些功能，但它允许您将其与您的产品一起分发，并且您的客户端可以在需要时向上移动。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-29T21:58:41.493

我同意[ceejayoz](https://stackoverflow.com/questions/398704/open-source-databases-capabilities#398713)的观点，mysql 是一个成熟的 DBMS。没有多余的装饰，没有限制，闪电般的快速，容错性和鲁棒性根据需要。
绝对值得拥有更多的机会。

但是，由于对开源上瘾，我不得不指出 mysql 是根据 GPL 获得许可的。

您是否打算在兼容 GPL 的许可下发布该项目？这是一个经常被忽视的要求。

**编辑：**
我的守时受到了一些批评，我必须更好地解释我的立场

关于将封闭源代码链接到 GPL 的 GPL 参考
[http://www.gnu.org/licenses/old-licenses/gpl-2.0-faq.html#MereAggregation](http://www.gnu.org/licenses/old-licenses/gpl-2.0-faq.html#MereAggregation)

你应该阅读常见问题解答，特别是当它说

*...管道、套接字和命令行参数是通常在两个独立程序之间使用的通信机制。因此，当它们用于通信时，模块通常是单独的程序。**但是，如果通信的语义足够亲密**，交换复杂的内部数据结构，**那也可以作为考虑将这两个部分组合**成一个更大程序的基础*

当 mysql 接口库在 3.80 版本中从 LGPL 切换到 GPL 时，我已经被咬了。我们，我们的法律部门，与 MysqlAB 进行了讨论，如果我没记错的话，在 Sun 收购之前公司的名称，在这一点上以及他们给我们的选择是获得非 GPL 商业许可或继续使用 3.80 版本的图书馆。

顺便说一句，.net 连接器是 GPL，下载页面
[http://dev.mysql.com/downloads/connector/net/5.2.html](http://dev.mysql.com/downloads/connector/net/5.2.html)
中明确说明 ，我不认为你，因为我包括其他所有人, 可以找到有用的通过原始 tcp 通信与可用连接器进行通信的服务器。

关于mysql % php 的另外两个词：php license 和mysql license 互不兼容 Sun 和MysqlAB 之前，不得不插入一个为php 和其他开源项目量身定制的[许可例外](http://www.mysql.com/about/legal/licensing/foss-exception/)，以允许php 支持mysql。这是一个漫长而充满激情的辱骂，我对结果感到失望，我们显然有机会在 GPL 下发布 php。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-29T22:15:06.580

另请注意，MySQL .Net 客户端库是 GPL 版的。如果你使用它，你必须在 GPL 许可下发布你的应用程序。并且您不得将 MySQL 与您的产品一起分发。

或者您可以购买 MySQL，但相对于 MSSQL/Oracle 的优势消失了。

或者，您可以使用直接连接到 MySQL 的 3p 客户端库，而无需 GPL 库。

总而言之，这不是一个容易做出的决定。三思而后行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-29T22:28:51.137

关于 MySQL 和 GPL 的说明：我相信如果您不分发应用程序的二进制文件（即，您的产品是一个只有您托管而不部署到您的客户端的 Web 应用程序），那么您可以使用 GPL 许可证而不需要您的应用程序也是开源的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-29T22:53:45.313

当您在 .Net 中进行开发时，您可能会发现 MS SQL Server 很有用。

例如，您可以编写 CLR 存储过程，这对于构建来自大量来源的数据树视图非常有效。

它在具有高级服务的 Express Edition 中也是免费的。

该版本包括非常好的报告服务。

MySQL 作为数据库引擎也非常出色，快速且免费，但由于您已经在使用 .Net，所以我会首先考虑 MSSQL。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-31T14:36:31.340

我已将大型开发从 Ms SQL 迁移到 PostGreSQL（出于与您类似的原因）并且感到惊喜。

我发现有一些警告：

*   期待一些围绕存储过程（PostGreSQL 中的“函数”）的学习曲线。如果您熟悉 Oracle 的 plsql，这可能没什么大不了的。
*   npgsql .Net 连接器存在一些稳定性问题（尤其是 .Net 2.0）。然而，开发者社区是活跃的并且对查询和问题做出响应。（有更稳定的商业连接器可用）

（根据我的经验以及在开发可以支持多个数据库的代码库的过程中，我发现最好从查询语言中删除大部分逻辑。通过这种方法，PostGreSQL 具有表现得足够好，学习曲线并不繁​​重）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-29T21:25:22.637

Oracle 还有一个免费版本，称为 Oracle XE。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-29T21:41:22.077

如果您只是担心许可费用，可以使用功能强大的免费 SQL Server 版本。这涉及到一个大小限制，但如果你超出了这个范围，你可能还会获得足够的收入来支付付费版本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-29T21:58:48.997

有点不合时宜的答案（对于 mysql 和维基百科中显示的兴趣）：

这是 Wikipedia 过去的服务器布局图的链接。

[http://meta.wikimedia.org/wiki/Server_layout_diagrams](http://meta.wikimedia.org/wiki/Server_layout_diagrams)

取自：

[http://en.wikipedia.org/wiki/Wikipedia#Software_and_hardware](http://en.wikipedia.org/wiki/Wikipedia#Software_and_hardware)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-29T23:14:04.667

我断断续续地使用 MySQL 和 Postgres 超过五年了，两者都很好。但是请注意，MySQL 与 Postgres 是 Linux 与 Windows 等的圣战之一。

对于大多数日常使用来说，两者都应该没问题。请注意，集群、热备份等高级功能可能需要努力/研究才能设置。

Postgres 在语法和某些特性上更像“Oracle”，事实上，它有时被称为“穷人的 Oracle”。MySQL 我不确定要比较什么。

在这两者中，长期以来，Postgres 被认为更健壮，而 MySQL - 更快，然而，这两个优势现在都有些争议。

另请注意，虽然 Wikipedia 和 Flickr 确实运行 MySQL，但没有人说他们的后端需要多少实际的 MySQL 服务器。

与彼此以及商业数据库相比，其中一个可能遗漏/实现了许多功能。如果您指定您的特定需求（集群、触发器、序列、ACID 合规性、良好的可扩展性？），它可能会影响您最好使用哪个数据库。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-31T15:01:41.147

如果您正在开发销售产品，MYSQL 不是免费的。使用该程序发布数据库需要相当大的许可成本。看看火鸟。功能强大，免费，除了完整的数据库服务器外，还有一个占用空间小的版本。

# image-processing - 图像处理语言/环境

> ID：398706
> 
> 赞同：5
> 
> 时间：2008-12-29T21:21:46.733
> 
> 标签：image-processing, programming-languages

我有兴趣研究一些图像处理。我想matlab是最好的方法，但现在我无法访问matlab。我尝试了 octave，但由于某种原因，它甚至无法加载 png、bmp 或 1 种特定格式以外的任何内容。R 似乎也不是这里的关键。

这里选择的语言是什么？珀尔？

也有人能指出我在图像处理方面可能错过的任何其他好的教程吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-29T21:39:25.997

Opencv 是一个优秀的图像处理库。虽然是用 C 语言编写的，但它带有一些高级工具来显示图像、处理图像文件、鼠标事件等，因此您无需编写大量 Windows 代码即可进行实验。

它也适用于 python，尽管我没有将它与 PIL 一起使用。
如果您对算法的工作原理感兴趣，那么使用 python 和 numpy 自己实现它们是很容易的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-29T21:27:31.073

我想这取决于你想做什么。Matlab 无疑是一个高端选择，但对于很多事情来说，通用编程语言的图像模块可以做到这一点。

我使用 python 图像库 PIL 进行了一些像素修饰和图像处理。对于处理合理大小的单个 RGB 图像（例如，消费类数码相机提供的图像）来说，它是完全足够的。它可以处理 alpha 通道，有一些过滤器，或多或少的快速访问像素信息的方法——它是 python，一种非常简单易读的语言。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-29T21:26:35.507

我的计算机视觉课程中推荐的语言是带有[OpenCV 库的](http://opencv.willowgarage.com/wiki/ "OpenCV 维基")[Ch](http://www.softintegration.com/products/thirdparty/opencv/demos/)。Ch 基本上是 C 的解释版本，语法非常相似，但有一些不错的特性，比如将数组视为矩阵。OpenCV 将包含您可能需要的几乎所有图像处理功能。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T14:07:48.273

我认为任何免费的编程环境都可以很好地完成基本的图像处理。如果速度不是问题，[Processing](http://processing.org/)可以正常工作，并且您将来可以轻松地将代码扩展到 Java。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T21:26:10.343

看看[Adob​​e Pixel Bender](http://labs.adobe.com/technologies/pixelbender/)。玩起来真的很有趣。

# .net - 请提供工厂模式建议

> ID：398708
> 
> 赞同：1
> 
> 时间：2008-12-29T21:22:57.807
> 
> 标签：.net, architecture, design-patterns, factory

我正在努力在我的空闲时间通过在一个简单的数据存储项目中使用它来围绕工厂模式。这个想法是使用 VB.NET 中的简单工厂模式获取简单数据并将其保存到数据库中。我想我对模式本身有了基本的了解，但是，我正在努力解决的是如何将工厂类干净地融入架构中。对于这个项目，我有一个标准的 3 层架构，基本上看起来像这样：

介绍

```
 -Presentation.Common
 -Presentation.DataStorageWebAppName 
```

商业

```
 -BusinessLayer.Common
 -BusinessLayer.DataStorageAppName 
```

数据

```
 -DataLayer.Common
 -DataLayer.DataStorageAppName 
```

常见的

```
 -Common
 -Common.DataStorageAppName 
```

接口

```
 -Interfaces.Common
 -Interfaces.DataStorageAppName 
```

为了突出我在构建应用程序时遇到问题的特定场景，让我举个例子。假设在业务层中，我在 BusinessLayer.DataStorageAppName DLL 中创建了一个名为 Foo 的类。它有一个接口 IFoo，它位于 Interfaces.DataStorageAppName DLL 中。为了使用简单的工厂模式通过其接口 IFoo 创建类 Foo 的实例，现在，我在 BusinessLayer.DataStorageAppName 中创建了一个工厂类，并编写了一个共享/静态方法来通过 IFoo 接口给我一个实例。后来，据我了解，我可以决定换掉这个 Factory 类返回的对象，而无需做很多其他事情（理论上）。

言归正传，这是可行的，但似乎很奇怪的是，我现在被迫创建了几个工厂类：基本上每个 DLL 一个，这样我就可以避免循环引用。有没有一种更简洁的方法来实现这些工厂类，而无需使用诸如温莎城堡等 3rd 方解决方案。似乎我在这里错过了一个基本概念。如果您愿意的话，似乎应该可以在负责分发对象实例的体系结构中拥有一个“存储库”。

先感谢您！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T21:32:28.507

我采取了一种更简单的方法。我定义了一个实体类，并且我有一个生产实体列表（List<Entity>）的工厂。我告诉工厂我想要返回什么类型，它假设类型是表，属性是列，生成 sql，获取数据，填充该类型的新实例列表。

工厂还可以接收实体对象并使用反射来更新其在数据库中的值。

现在我唯一需要做的就是为给定的数据库创建一组实体类，顺便说一句，它们也是数据传输对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T11:25:48.980

为什么您的 IFoo 实现和返回它的工厂方法不能存在于与 BusinessLayer 不同的程序集中（因此您可以从所有客户端程序集中引用这个新程序集），是否有原因？如果有原因，是否有可能 IFoo 也应该在 BusinessLayer 中定义（因此不需要对 Interfaces 程序集的引用）？

如果您的接口确实需要从业务层以外的地方访问，并且实现确实确实依赖于业务层，那么您需要考虑的不仅仅是工厂方法。您可以使用控制反转/依赖注入的一些原则来更好地分离关注点。

[根据 OP 的后续回答进行编辑] IMO，工厂方法不足以被视为 IoC 方法。它最适合的是封装特定实现的构造，以便在多个地方重复使用或简单地将其[扫到地毯下](http://www.laputan.org/mud/mud.html#SweepingItUnderTheRug)。对我来说缺少的是打破依赖关系：由于您的工厂方法与被调用的方法位于同一个程序集中，为了更改返回的具体类型，您需要重新编译。考虑以下两者之间的区别：

```
public class FooConsumer1
{
    public void DoStuff()
    {
        IFoo myFoo = new Foo();
        myFoo.Bar();
    }
} 
```

和：

```
public class FooConsumer2
{
    public void DoStuff()
    {
        IFoo myFoo = FooFactory.getFoo();
        myFoo.Bar();
    }
}

public class FooFactory
{
    public static IFoo GetFoo()
    {
        return new Foo();
    }
} 
```

第二种的好处是，如果你在多个地方创建了一个IFoo，当你创建一个SuperFoo类来替换Foo时，你只有一个地方可以改变它。此外，如果它会以某种方式动态地在两个实现之间做出决定，那么只有一个地方可以放置逻辑。另一个优点是，如果构造函数复杂/丑陋，或者需要一些额外的代码来查找配置设置等，那么它会将所有这些隐藏在使用它的方法之外。

然而，这些都不是真的（至少在我看来）帮助你打破这个方法和它使用的具体实现之间的依赖关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T00:34:04.973

It doesn't have to be funky to have several factory classes, if they handle different concerns. I would advice not to use static factory methods, but rather create instances of the factories you use. Then the factories themselves can implement interfaces, and perhaps some of the funkiness goes away.

# html - Colspan 所有列

> ID：398734
> 
> 赞同：456
> 
> 时间：2008-12-29T21:31:00.100
> 
> 标签：html, html-table, tablelayout

我如何指定一个`td`标签应该跨越所有列（当表中列的确切数量将是可变的/难以确定何时呈现 HTML 时）？[w3schools](http://www.w3schools.com/tags/att_td_colspan.asp)提到您可以使用`colspan="0"`，但它没有确切说明哪些浏览器支持该值（IE 6 在我们的支持列表中）。

似乎设置`colspan`为大于您可能拥有的理论列数的值会起作用，但如果您`table-layout`设置为`fixed`. 使用大量的自动布局有什么缺点`colspan`吗？有没有更正确的方法来做到这一点？

* * *

## 回答 #1

> 赞同：343
> 
> 时间：2011-02-17T11:04:47.150

只需使用这个：

```
colspan="100%" 
```

它适用于 Firefox 3.6、IE 7 和 Opera 11！（我猜别人，我不能尝试）

* * *

*警告：正如下面评论中提到的，**这实际上与`colspan="100"`.** `table-layout: fixed`因此，对于具有 css或超过 100 列的表，此解决方案将失效。*

* * *

## 回答 #2

> 赞同：290
> 
> 时间：2008-12-29T21:44:16.827

我有 IE 7.0、Firefox 3.0 和 Chrome 1.0

TD 中的 colspan="0" 属性**不跨越****上述任何浏览器中的**所有 TD 。

也许不推荐作为正确的标记做法，但如果你给出的**colspan 值高于可能的总数。其他行中的列**，则 TD 将跨越所有列。

**当 table-layout CSS 属性设置为 fixed 时，这不起作用。**

*再一次，这不是完美的解决方案，但当 table-layout CSS 属性为automatic*时，这似乎可以在上述 3 个浏览器版本中工作。希望这可以帮助。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2009-09-24T10:55:48.950

如果您想制作一个跨越所有列的“标题”单元格，作为表格的标题，您可能需要使用标题标签（[http://www.w3schools.com/tags/tag_caption.asp](http://www.w3schools.com/tags/tag_caption.asp) / [https:// developer.mozilla.org/en-US/docs/Web/HTML/Element/caption](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/caption)) 这个元素就是为此目的。它的行为类似于 div，但不跨越表的父级的整个宽度（就像 div 会在同一位置做一样（不要在家里尝试这个！）），而是跨越表的宽度桌子。有一些跨浏览器的边界等问题（对我来说是可以接受的）。无论如何，您可以让它看起来像一个跨越所有列的单元格。在其中，您可以通过添加 div 元素来创建行。我不确定你是否可以将它插入到 tr 元素之间，但我猜这将是一个 hack（所以不推荐）。另一种选择是摆弄浮动 div，但这太糟糕了！

做

```
<table>
    <caption style="gimme some style!"><!-- Title of table --></caption>
    <thead><!-- ... --></thead>
    <tbody><!-- ... --></tbody>
</table> 
```

别

```
<div>
    <div style="float: left;/* extra styling /*"><!-- Title of table --></div>
    <table>
        <thead><!-- ... --></thead>
        <tbody><!-- ... --></tbody>
    </table>
    <div style="clear: both"></div>
</div> 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2018-09-16T14:47:21.863

作为部分答案，这里有几点关于`colspan="0"`问题中提到的。

### tl;博士版本：

`colspan="0"`在任何浏览器中都不起作用。W3Schools 是错误的（像往常一样）。HTML 4 说这`colspan="0"`应该导致一列跨越整个表格，但没有人实现这一点，并且在 HTML 4 之后从规范中删除了它。

### 更多细节和证据：

*   所有主流浏览器都将其视为等同于`colspan="1"`.

    这是一个演示，展示了这一点；在您喜欢的任何浏览器上尝试。

    ```
    td {
      border: 1px solid black;
    }
    ```

    ```
    <table>
      <tr>
        <td>ay</td>
        <td>bee</td>
        <td>see</td>
      </tr>
      <tr>
        <td colspan="0">colspan="0"</td>
      </tr>
      <tr>
        <td colspan="1">colspan="1"</td>
      </tr>
      <tr>
        <td colspan="3">colspan="3"</td>
      </tr>
      <tr>
        <td colspan="1000">colspan="1000"</td>
      </tr>
    </table>
    ```

*   HTML 4 规范（现在已经过时了，但在被问到这个问题时又回来了）[*确实*说](https://www.w3.org/TR/REC-html40/struct/tables.html#adef-colspan)应该`colspan="0"`将其视为跨越所有列：

    > 值零 ("0") 表示单元格跨越从当前列到定义单元格的列组 (COLGROUP) 的最后一列的所有列。

    但是，大多数浏览器从未实现过这一点。

*   HTML 5.0（早在 2012 年就提出了候选推荐）、WhatWG HTML 生活标准（今天的主导标准）和最新的 W3 HTML 5 规范都没有包含上述 HTML 4 引用的措辞，并且一致同意 a`colspan`为 0是不允许的，在所有三个规范中都出现了这样的措辞：

    > `td`and`th`元素可以指定一个内容属性，其`colspan`值必须是大于零的有效非负整数...

    资料来源：

    *   [https://www.w3.org/TR/html50/tabular-data.html#attributes-common-to-td-and-th-elements](https://www.w3.org/TR/html50/tabular-data.html#attributes-common-to-td-and-th-elements)
    *   [https://html.spec.whatwg.org/multipage/tables.html#attributes-common-to-td-and-th-elements](https://html.spec.whatwg.org/multipage/tables.html#attributes-common-to-td-and-th-elements)
    *   [https://www.w3.org/TR/html53/tabular-data.html#attributes-common-to-td-and-th-elements](https://www.w3.org/TR/html53/tabular-data.html#attributes-common-to-td-and-th-elements)
*   [问题中链接到的 W3Schools 页面](https://www.w3schools.com/tags/att_td_colspan.asp)的以下声明- 至少现在 - 完全错误：

    > 只有 Firefox 支持 colspan="0"，它有一个特殊的含义……【它】告诉浏览器将单元格跨越到列组（colgroup）的最后一列

    和

    > ### HTML 4.01 和 HTML5 的区别
    > 
    > 没有任何。

    如果您还没有意识到 W3Schools 通常因其经常出现的错误而受到 Web 开发人员的蔑视，请考虑这是为什么。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-12-29T21:39:39.443

对于 IE 6，您需要将 colspan 与表中的列数相等。如果你有 5 列，那么你会想要：`colspan="5"`.

原因是[IE 处理 colspan](http://www.webmasterworld.com/forum21/9991.htm)的方式不同，它使用 HTML 3.2 规范：

> IE 实现了 HTML 3.2 定义，它设置`colspan=0`为`colspan=1`.

该错误有[据可查](http://www.google.com/search?hl=en&lr=&ie=UTF-8&q=IE+6+colspan+bug&btnG=Search)。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2014-03-28T19:52:59.113

如果您正在使用 jQuery（或者不介意添加它），这将比任何这些 hack 更好地完成工作。

```
function getMaxColCount($table) {
    var maxCol = 0;

    $table.find('tr').each(function(i,o) {
        var colCount = 0;
        $(o).find('td:not(.maxcols),th:not(.maxcols)').each(function(i,oo) {
            var cc = Number($(oo).attr('colspan'));
            if (cc) {
                colCount += cc;
            } else {
                colCount += 1;
            }
        });
        if(colCount > maxCol) { 
            maxCol = colCount; 
        }
    });

    return maxCol;
} 
```

为了简化实现，我使用诸如“maxCol”之类的类来装饰我需要调整的任何 td/th，然后我可以执行以下操作：

```
$('td.maxcols, th.maxcols').each(function(i,o) {
    $t = $($(o).parents('table')[0]); $(o).attr('colspan',  getMaxColCount($t));
}); 
```

如果您发现这不起作用的实现，请不要抨击答案，在评论中解释，如果可以涵盖，我会更新。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-10-28T04:32:51.103

另一个工作但丑陋的解决方案：`colspan="100"`，其中 100 是一个大于您需要的总列的值`colspan`。

根据 W3C，该`colspan="0"`选项仅对`COLGROUP`标签有效。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2018-10-08T12:22:32.183

下面是一个简洁的 es6 解决方案（类似于[Rainbabba 的答案](https://stackoverflow.com/a/22721999/695734)，但没有 jQuery）。

```
Array.from(document.querySelectorAll('[data-colspan-max]')).forEach(td => {
    let table = td;
    while (table && table.nodeName !== 'TABLE') table = table.parentNode;
    td.colSpan = Array.from(table.querySelector('tr').children).reduce((acc, child) => acc + child.colSpan, 0);
});
```

```
html {
  font-family: Verdana;
}
tr > * {
  padding: 1rem;
  box-shadow: 0 0 8px gray inset;
}
```

```
<table>
<thead>
  <tr>
    <th>Header 1</th>
    <th>Header 2</th>
    <th>Header 3</th>
    <th>Header 4</th>
    <th>Header 5</th>
    <th>Header 6</th>
  </tr>
</thead>
<tbod><tr>
  <td data-colspan-max>td will be set to full width</td>
</tr></tbod>
</table>
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2022-02-11T03:57:15.357

## 只需设置`colspan`为表中的列数。

#### 所有其他“捷径”都有陷阱。

最好的办法是一`colspan`开始就设置正确的数字。如果您的表格有 5 列，请将其设置为`colspan="5"`“这是唯一适用于所有场景的方法”。不，这不是一个过时的解决方案，或者只推荐用于 IE6 或任何东西——这实际上是处理这个问题的最佳方法。

我不建议使用 Javascript 来解决这个问题，除非列数在运行时发生变化。

如果列数是可变的，那么您需要计算列数，以便您可以填充`colspan`. 如果您有可变数量的列，则生成表的任何内容都应该能够适应计算表的列数。

正如其他答案所提到的，如果您的表格未设置为`table-layout: fixed`，您也可以设置`colspan`为一个非常大的数字。但是我发现这个解决方案很混乱，如果你稍后回来并决定它应该是一个固定的表格布局，这可能会让人头疼。最好只是第一次正确地做。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-02T20:26:57.573

CSS 解决方案将是理想的，但我找不到，所以这里有一个 JavaScript 解决方案：对于`tr`具有给定类的元素，通过选择一整行来最大化它，计算其`td`元素及其`colSpan`属性，并设置加宽与`el.colSpan = newcolspan;`. 像这样...

```
var headertablerows = document.getElementsByClassName('max-col-span');

[].forEach.call(headertablerows, function (headertablerow) {
    var colspan = 0;
    [].forEach.call(headertablerow.nextElementSibling.children, function (child) {
        colspan += child.colSpan ? parseInt(child.colSpan, 10) : 1;
    });

    headertablerow.children[0].colSpan = colspan;
});
```

```
html {
  font-family: Verdana;
}
tr > * {
  padding: 1rem;
  box-shadow: 0 0 8px gray inset;
}
```

```
 <table>
    <tr class="max-col-span">
      <td>1 - max width
      </td>
    </tr>
    <tr>
      <td>2 - no colspan
      </td>
      <td colspan="2">3 - colspan is 2
      </td>
    </tr>
  </table>
```

如果您使用的是 table `headers`，您可能需要对此进行调整，但这应该提供一种使用*100% 纯 JavaScript 的概念验证方法。*

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-12-17T12:35:36.980

只是想添加我的经验和答案。
注意：它仅在您有一个预定义的`table`和一个`tr`with `th`s 时才有效，但在您的行中动态加载（例如通过 AJAX）。

在这种情况下，您可以计算`th`第一个标题行中的 ' 数量，并使用它来跨越整个列。

如果您想在未找到结果时转发消息，则可能需要这样做。

在 jQuery 中`table`是这样的，你的输入表在哪里：

```
var trs = $(table).find("tr");
var numberColumns = 999;
if (trs.length === 1) {
    //Assume having one row means that there is a header
    var headerColumns = $(trs).find("th").length;
    if (headerColumns > 0) {
        numberColumns = headerColumns;
    }
} 
```

# sql-server - 您可以限制（数据库）表中的行数吗？

> ID：398747
> 
> 赞同：4
> 
> 时间：2008-12-29T21:35:11.947
> 
> 标签：sql-server

我们有一个数据库（SQL Server 2005），我们希望对其进行源代码控制。作为其中的一部分，我们将有一个版本表来存储数据库的当前版本号。有没有办法将该表限制为仅容纳一行？或者将版本号存储在表中是一个坏主意？

最终使用了这种方法：

```
CREATE TABLE [dbo].[DatabaseVersion]
    (
        [MajorVersionNumber] [int]  NOT NULL,
        [MinorVersionNumber] [int]  NOT NULL,
        [RevisionNumber] [int]  NOT NULL
    )
GO

Insert DataBaseVersion (MajorVersionNumber,  MinorVersionNumber,  RevisionNumber) values (0, 0, 0)
GO

CREATE TRIGGER DataBaseVersion_Prevent_Delete
ON DataBaseVersion INSTEAD OF DELETE
AS
BEGIN
    RAISERROR ('DatabaseVersion must always have one Row. (source = INSTEAD OF DELETE)', 16, 1) 
END
GO

CREATE TRIGGER DataBaseVersion_Prevent_Insert
ON DataBaseVersion INSTEAD OF INSERT
AS
BEGIN
    RAISERROR ('DatabaseVersion must always have one Row. (source = INSTEAD OF INSERT)', 16, 1) 
END
GO 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-29T21:37:46.123

使用触发器。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-29T21:41:35.180

泛化表以保存“设置”并使其成为键/值对

```
CREATE TABLE Settings (Key nvarchar(max), Value nvarchar(max)) 
```

然后在 Key 上做一个唯一索引。

```
CREATE UNIQUE INDEX SettingsIDX ON Settings (Key) 
```

这将创建一个具有唯一键值对的表，其中一个可以是版本。

```
INSERT INTO Settings (Key, Value) VALUES ('Version','1'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-10T22:38:04.620

您可以使用 Joe Celko 的 default+primary+check 技术：

```
create table database_version (

  lock char(1) primary key default 'x' check (lock='x'),
  major_version_number int NOT NULL,
  minor_version_number int NOT NULL,
  revision_number int NOT NULL
); 
```

[摆弄](http://sqlfiddle.com/#!3/aeb48/3)它

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T21:40:18.193

一点也不。您可以简单地向该表添加另一个升序列（日期、id 等），然后按该另一列降序排列查询并将结果限制为 1 行：

```
SELECT v.version FROM version v ORDER by v.date DESC LIMIT 1; 
```

这样，您甚至可以获得每个版本何时到达的历史记录。

编辑：

上面的 sql 查询在 SQL Server 上不起作用，因为它不支持 LIMIT 语句。必须避免这一缺陷，可能如[“All Things SQL Server”博客条目中](http://blogs.msdn.com/sqlserver/archive/2006/10/25/limit-in-sql-server.aspx)所述。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T01:22:52.440

根据您对其他回复的评论，似乎：

1.  您不希望用户只修改值。
2.  您只希望返回一个值。
3.  该值是静态的，并且是脚本化的。

那么，我是否可以建议您编写一个返回静态值的函数？由于无论如何您都必须编写对版本号的更新脚本，所以当您更新数据库时，您只需在脚本中删除并重新创建该函数。

这具有可从视图或过程中使用的优点，并且由于函数的返回值是只读的，因此无法修改（无需修改函数）。

**编辑**：您也不必担心将表限制在一行的复杂解决方案。

只是一个建议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T16:34:24.487

保留数据库的版本号是完全有意义的。但是，我更喜欢有一个版本表，它可以包含多行，其中包含版本号、更新发生时间和执行升级的用户的字段。

这样您就可以知道哪些升级脚本已运行，并且可以轻松查看它们是否已乱序运行。

当您想读取当前版本号时，您可以读取最近的记录。

如果您只存储一条记录，您就可以知道是否错过了脚本。如果您想变得非常聪明，您可以在升级脚本中进行检查，这样它们就不会运行，除非以前的数据库版本是正确的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T21:42:07.223

通过创建一个允许的原始行作为数据库初始化脚本的一部分，并且（也在该脚本中）为所有登录删除对该表的插入权限（仅允许更新）

您可能还想禁止删除...

# java - 新 NetBeans 项目的命令行上的 NoClassDefFoundError

> ID：398748
> 
> 赞同：1
> 
> 时间：2008-12-29T21:35:27.890
> 
> 标签：java, netbeans, ant

我在 NetBeans 中创建了一个新的 J2SE 项目，并且可以从 IDE 运行它，但是当我尝试在命令行上使用 Ant 运行它时，出现以下问题：

<剪辑>

```
run:
     [java] Exception in thread "main" java.lang.NoClassDefFoundError: IndexBuilder
     [java] Java Result: 1 
```

<剪辑>

根据下面的代码段`project.properties`，应该可以找到该类。

```
run.classpath=\
    ${javac.classpath}:\
    ${build.classes.dir} 
```

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T02:18:28.087

您收到的错误意味着以下情况之一为真：

*   在类`IndexBuilder`路径中找不到该类
*   `IndexBuilder`在类路径上找不到必要的（用于类加载）依赖项

也就是说，在加载类时，有可能（甚至很可能）**可以**找到该类，但找不到该类的某些关键依赖项。例如，如果`IndexBuilder`扩展了另一个类并且在类路径中找不到该基类，您将收到此错误。另一个例子是，如果`IndexBuilder`在静态初始化程序中使用了一个类并且找不到该类。

检查您的类路径，不仅要检查，`IndexBuilder`还要检查`IndexBuilder`依赖的任何内容。

例如，参见这个[讨论](http://www.jroller.com/sjivan/entry/difference_between_classnotfoundexception_and_noclassdeffounderror)。`NoClassDefFoundError`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T18:26:47.800

您是否尝试在 Project Properties -> Run 选项卡中将工作目录设置为“build\classes”？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T18:41:29.327

您的项目引用的至少一个 JAR/Lib 可能没有被复制到程序的类路径中。将项目使用的所有 jars/lib 复制到项目的 /dist 文件夹（或 YourApplication.jar 所在的任何位置），然后尝试运行您的程序。如果这解决了这意味着您的 Netbeans 项目配置不完全正确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T02:36:47.827

当您从命令行运行它时，您实际上是在调用[Apache Ant](http://ant.apache.org)。您收到 ClassNotFound 异常的原因是因为 ${javac.classpath} 和所有其他属性没有被正确填充。这就是您的代码在 Netbeans 上下文中运行的原因。Netbeans 正在为您设置这些属性。

要回答您如何从命令行运行它的原始问题，您需要设置一个属性文件，该文件通过属性声明定义这些参数：

```
<property file="myproject.properties"/> 
```

另一种解决方案是通过 sh 脚本将属性设置为环境变量。或者您可以在构建脚本中使用真实路径而不是属性。

有关如何从命令行调用 Ant 的更多详细信息，请参见[此处。](http://ant.apache.org/manual/running.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T16:23:49.763

您是在 Windows 还是 Unix 上运行它。如果是 Windows，请尝试将您的属性文件更改为：

```
 run.classpath=${javac.classpath};${build.classes.dir} 

```

请注意分号而不是冒号。

# jquery - 使用 jQuery 的 onclick 和 onclick 属性有什么区别？

> ID：398760
> 
> 赞同：39
> 
> 时间：2008-12-29T21:38:55.637
> 
> 标签：jquery

以下两段 HTML 有什么区别（如果我在徒手打字时有任何拼写错误，请致歉）？

使用 jQuery：

```
<script type="text/javascript">
    $(document).ready(function() {
        $("#clickme").click(function() {
            alert("clicked!");
        });
    });
</script>

<a id="clickme" href="javascript:void(0);">click me</a> 
```

不使用 jQuery：

```
<a id="clickme" href="javascript:void(0);" onclick="alert('clicked!');">click me</a> 
```

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-12-29T21:51:36.313

一个很大的区别是 jQuery 的事件是在一个注册表中处理的，该注册表在单击事件上进行解析。至关重要的是，这意味着您可以分配多个回调，并按照它们注册的顺序触发它们：

```
<script type="text/javascript">
    $(document).ready(function() {
        $("#clickme").click(function() {
            alert("clicked!");
        });
        $("#clickme").click(function() {
            alert("I concur, clicked!");
        });
    });
</script> 
```

它们都将按`click`该顺序在事件中被调用。“真实”`onClick`事件被 jQuery 的注册表驱动系统覆盖。在 vanilla 文档结构中，没有像 jQuery 这样的系统，只能有一个`onClick`事件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-29T21:55:50.423

它也是 UI 代码（HTML）和逻辑代码（JavaScript）的更清晰的分离。它使阅读每一个都更容易一些。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-29T21:51:01.883

不同之处之一是使用 jQuery 添加处理程序`click`不会删除以前的处理程序。

# html - 电子邮件中的乱码 html

> ID：398777
> 
> 赞同：1
> 
> 时间：2008-12-29T21:43:37.437
> 
> 标签：html, email, formatting

是否有某种用于 html 电子邮件的格式化协议？我们有一个通过电子邮件发送报告的自动化系统，当我查看源代码时，我看到它们由行长度分隔，并带有“=”断行。也就是说，我得到类似的东西：

```
<html><body>some text some text some text some=
some text some text some text some text som<ta=
ble>some text some text some text some text <t=
r><td... 
```

有没有人有更多关于这是什么的信息？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T21:57:11.700

您必须将消息作为[多部分 MIME](http://www.enewsletterpro.com/articles/multi_part_mime_messages.asp)发送。最佳做法是：

*   对于不支持 HTML 的邮件客户端，或者某些人只是在电子邮件中关闭 HTML（尽管许多客户端不会自动下载图像，但图像存在安全/垃圾邮件问题），始终以这种方式发送 HTML 和纯文本版本无论如何来自不受信任的站点）；
*   图像可以包含在消息中，而不是直接链接。直接链接可以节省带宽，但会造成垃圾邮件甚至是安全问题（例如，[Internet Explorer 的 PNG 图像存在缓冲区溢出错误](http://www.symantec.com/security_response/vulnerability.jsp?bid=13941)）。嵌入图像是具有 cid 值的引用；和
*   只使用最基本的 HTML。浏览器对 HTML 的支持从原始到奇异不等。当我考虑这样做时，我们无法在我们调查的少数邮件客户端上获得一致（甚至可以接受的不同）外观和感觉，导致我们将报告作为附件发送 PDF，在很多方面，更可取（例如，它们可以很容易地保存）。

至于您的乱码消息，在我看来，您的消息没有被正确识别为 HTML，因此邮件客户端将文本行包装为 70 个左右字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T22:01:24.983

您的消息正在以某种方式转换为[“引用的可打印”](http://en.wikipedia.org/wiki/Quoted_printable)编码。这可能是您正在创建的邮件标头的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T21:58:02.183

看起来它可以被引用 - 打印。HTML 中的等号符号如何看待，它们是否被 =3E 替换？

从技术上讲，这没有什么问题，但是对于那些不能或不想阅读 HTML 邮件的人（比如我）来说，包含一个替代的纯文本会很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T22:07:18.700

电子邮件[RFC](http://www.faqs.org/rfcs/rfc2822.html)强制执行行长度限制，特别是每行不应超过 78 个字符，不包括 CRLF。每行末尾的等号只是一个行分隔符，任何支持 HTML 的电子邮件阅读器都会正确解析它，只要必要的标题到位（Content-Text：text/html）。可以在[此处](http://www.w3.org/TR/1998/NOTE-HTMLThreading-0105)找到有关电子邮件约定中的 HTML 的更多详细信息。

# c# - 如何实现这种类型的 OOP 结构？

> ID：398781
> 
> 赞同：1
> 
> 时间：2008-12-29T21:45:04.550
> 
> 标签：c#, .net, oop

我想构建一个不错的 API (C#) 以使人们更容易使用，我想我以前见过这个并且想知道如何做到这一点：

```
MyNamespace.Cars car = null;

if(someTestCondition)
       car = new Honda();
else    
       car = new Toyota();

car.Drive(40); 
```

这可能吗？如果是这样，需要做什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-29T21:49:57.177

```
Interface Car
{
void Drive(int miles);
}

class Honda : Car
{
...
}
class Toyota : Car
{
...
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-29T21:50:37.283

你可以通过几种不同的方式来做到这一点。你可以声明一个抽象基类，或者你可以有一个你的对象实现的接口。我相信“C#”首选方法是有一个接口。就像是：

```
public interface ICar
{
    public Color Color { get; set; }

    void Drive(int speed);
    void Stop();

}

public class Honda : ICar
{

    #region ICar Members

    public Color Color { get; set; }

    public void Drive(int speed)
    {
        throw new NotImplementedException();
    }

    public void Stop()
    {
        throw new NotImplementedException();
    }

    #endregion
}

public class Toyota : ICar
{
    #region ICar Members

    public Color Color { get; set; }

    public void Drive(int speed)
    {
        throw new NotImplementedException();
    }

    public void Stop()
    {
        throw new NotImplementedException();
    }

    #endregion
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-29T22:16:04.627

我看到每个人都在向您推送接口/抽象基类的更改。您提供的伪代码或多或少意味着您已经有了这个。

我再摆点别的：

您需要创建一个“CarFactory”，它将返回您的基类/接口的特定实现。Create 方法可以将您的测试条件作为参数，以便您创建正确的汽车。

编辑：这是来自 MSDN 的链接——[http://msdn.microsoft.com/en-us/library/ms954600.aspx](http://msdn.microsoft.com/en-us/library/ms954600.aspx)

编辑：查看评论以获取另一个链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T21:49:19.703

创建一个名为 Cars 的类。给它 Drive 方法。在您的本田和丰田课程中扩展该基础课程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T21:57:32.573

```
namespace MyNameSpace
{
  public interface Cars
  {
    public void Drive(int miles);
  }
  public class Honda : Cars
  {
    public void Drive(int miles) { ... }
  }
  public class Toyota : Cars
  {
    public void Drive(int miles) { ... }
  }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T21:59:55.300

不要忘记命名空间，另请参阅我在关于变量名的问题中的评论

```
namespace MyNamespace {
    public interface Cars {
        void Drive(int speed);
    }

    public class Honda : Cars {
        public void Drive(int speed) { 
        }
    }
    public class Toyota : Cars {
        public void Drive(int speed) {

        }
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T22:00:27.607

使用名为 Drive() 的抽象方法创建一个名为 Cars 的抽象类。子类化它并添加实现。

# c# - 这个 ASP.NET MVC 验证代码是否易于阅读和遵循？

> ID：398801
> 
> 赞同：2
> 
> 时间：2008-12-29T21:53:00.523
> 
> 标签：c#, asp.net-mvc

我想知道每个人对此有何看法。代码容易理解吗？还是有更好的方法来做到这一点？顺便说一句，这就是我目前使用 ASP.NET MVC 进行验证的方式。我可以跟随它，但我是写它的人。出于某种原因，SO 正在删除验证器之间的换行符。

```
 public override Validation<MemberCreate> ValidationRules()
    {
        var validation = new Validation<MemberCreate>();

        validation.Add(x => x.Name)
            .LengthBetween(
                Config.Member.NameMinLength, 
                Config.Member.NameMaxLength, 
                Resources.Errors.LengthBetweenNotValid.Fmt(
                    Resources.Titles.Name, 
                    Config.Member.NameMinLength, 
                    Config.Member.NameMaxLength))
            .Characters(Resources.Errors.CharactersNotValid.Fmt(Resources.Titles.Name));

        validation.Add(x => x.EmailAddress).Email(
            Resources.Errors.EmailNotValid.Fmt(
                Resources.Titles.EmailAddress));

        validation.Add(x => x.VerifyEmailAddress).Equal(
            x => x.EmailAddress, 
            Resources.Errors.CompareNotValid.Fmt(
                Resources.Titles.VerifyEmailAddress, 
                Resources.Titles.EmailAddress));

        validation.Add(x => x.PassWord).LengthGreaterThan(
            Config.Member.PassWordMinLength, 
            Resources.Errors.LengthGreaterThanNotValid.Fmt(
                Resources.Titles.PassWord, 
                Config.Member.PassWordMinLength));

        validation.Add(x => x.VerifyPassWord).Equal(
            x => x.PassWord,
            Resources.Errors.CompareNotValid.Fmt(
                Resources.Titles.VerifyPassWord,
                Resources.Titles.PassWord));

        return validation;
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T21:56:29.113

无论如何，我都不是 C# 人，但它看起来很简单。它似乎将一堆规则放入某种结构中，我认为它随后会应用于验证某种类型的消息。命令模式的应用，我想。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T21:59:43.583

只要你保持它的格式很好，我就没有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T21:59:51.867

我会以清教徒的理由投赞成票——格式不一致，看不到评论。

务实地，一个人可以通过一点努力来遵循你正在做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T22:16:28.977

我是一个 PHP 人，我仍然可以了解正在发生的事情。您正在为注册页面分组验证器。创建成员时，它会验证数据。一些验证器是快捷方式（如`email`）。它仍然可以使用一些评论。

# sql-server - 将 SQL Server 后端用于 Subversioning 存储库

> ID：398802
> 
> 赞同：2
> 
> 时间：2008-12-29T21:53:13.270
> 
> 标签：sql-server, svn

有没有人尝试使用 SQL Server 数据库作为 Subversion 文件系统后端？这样所有的 Subversion 存储库都将存储在 SQL 数据库而不是平面文件系统中吗？使备份和报告更容易？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T21:59:11.180

Subversion 有两种不同的存储库格式。有使用“平面”文件系统的默认 FSFS。但您也可以创建使用 berkeley db 的存储库。

要创建这样的 BDB 存储库，请使用命令

```
svnadmin create path/to/repository --fs-type BDB 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T21:59:38.840

这是不可行的。颠覆的整个核心都需要重写。Subversion 确实支持 Berkeley db 实现，并且使用适当的工具，可以将该 db 导出到 mssql 以进行报告。

# reporting-services - Reporting Services：如何在标题中放置报表参数

> ID：398803
> 
> 赞同：12
> 
> 时间：2008-12-29T21:53:13.517
> 
> 标签：reporting-services

我有两个报表参数，它们是在创建关联数据集时自动设置的。它们是 ReportID 和 CompanyID。用户从列表框中选择公司名称并从另一个列表框中选择报告名称。标准的 SELECT ID, Name FROM TableName 查询用于填充相应的列表框。报告参数工作正常，报告显示正确。我的问题是这个。我想将选定的报告名称和公司名称放在报告标题中（这些是用户在点击查看报告按钮之前从下拉列表中选择的名称值。我设置了两个新参数，报告名称和公司名称；标记它们被隐藏并将它们的默认值设置为适当的数据集。问题是标题总是显示列表中的名字，而不是用户选择的名字。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-29T22:02:00.630

使用从查询中填充的原始参数集执行此操作没有问题。

在我的报告中，我有一个由“SELECT FarmNumber, FarmName FROM Farms”查询填充的“Farm”参数。用户从 ComboBox 中选择他想要的农场。我使用以下表达式在报告的标题中显示选定的农场：

```
=Parameters!Farm.Label 
```

“标签”是用户选择的农场的“显示文本”（本例中为农场名称）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T21:58:38.950

不将Parameters!ReportID.Value 放入标题中的文本框吗？

听起来，您应该使用在“ReportID”位置中命名的任何原始参数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-02-22T17:54:23.050

使用 SSRS 2008 R2，我有一个带有多个参数的标头：

```
My Export for [@ReportDate] [@AccountId.Label] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-10T18:44:52.233

如果 CompanyID 是一个多值参数，这将起作用：

```
 =Join(Parameters!CompanyIDs.Label,System.Environment.NewLine) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-18T11:13:43.970

=参数！农场。*价值*

**用标签替换值**

=参数！农场。*标签*

# vba - 以编程方式将参数传递到访问报告中

> ID：398804
> 
> 赞同：16
> 
> 时间：2008-12-29T21:53:41.240
> 
> 标签：vba, ms-access

我有一个现有的 Access MDB。我正在向运行现有报告的现有表单添加命令按钮。所做的更改是此按钮需要传入一个参数，该参数包含要报告的记录的 ID - 目前该报告在 MDB 中的每条记录上运行。

我已经更改了运行报告的查询以使用 ID 值的参数，因此现在当单击按钮时，Access 会提示输入要报告的记录 ID，并且报告会按应有的方式显示。

但是，我一生都无法弄清楚如何将参数传递到报告中以供查询使用。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-29T22:09:46.947

DoCmd.OpenReport 方法有各种参数，其中之一是 Where 语句：

```
DoCmd.OpenReport"rptReport", acViewPreview,,"ID=" & Me.ID 
```

那是

```
expression.OpenReport(ReportName, View, FilterName, WhereCondition, WindowMode, OpenArgs) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T02:04:54.680

我对这类问题的一般方法是将标准保存在数据库中，通常是一个有一行的控制表。然后要引用您的标准，您在括号中放置一个查询，该查询返回您想要的标准的一个值。在你的情况下，它会是这样的：

```
(select reportID from control) 
```

此技术的优点是控制表会记住您下次运行报告时的设置。当然，ReportID 将绑定到表单中的字段。我也喜欢您的查询与表单隔离的事实；它们可以独立于表单运行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-02T02:43:10.000

为什么每个人都想把事情弄得这么复杂，我不知道。

1.  不带参数保存报表的记录源。

2.  根据 Remou 的建议，通过 DoCmd.OpenReport 的适当参数中的标准。

尝试以任何其他方式执行此操作将成为抵制在 Access 中完成任务的自然方法的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T04:26:24.787

docmd.openreport 的 Where 子句是一个字符串，它使用与 SQL 语句中的 where 子句相同的格式。

将您查询的参数化放在 docmd 而不是报告的 RecordSource 的原因是灵活性。您可能需要在没有任何参数的情况下打开报告/返回所有记录或能够过滤不同的字段。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-24T18:26:35.983

我知道这是一个旧帖子，但这花了我一点时间。错误是“无效使用 parren”，但问题是字段名称中的空格。我正在从数据库创建一个报告，有人犯了常见的错误，空格。

当数据库字段有空格时，要通过 where 子句将参数传递给查询，请使用以下示例：

```
DoCmd.OpenReport "rptByRegionalOffice", acViewPreview, , "[" & "Regional Office" & "]" & "=" & "'" & cmboOffices.Value & "'" 
```

如果您考虑这一点，您会发现这将`where [Regional Office]='string value'`像您在 access sql 中所期望的那样产生。

# ios - 存在 Xib 文件的自定义绘图

> ID：398806
> 
> 赞同：3
> 
> 时间：2008-12-29T21:55:44.167
> 
> 标签：ios, cocoa-touch, xib

我有一个要添加一些自定义绘图的视图。

我知道如何使用未连接到 Nib/Xib 文件的视图来执行此操作

*   您在方法中编写绘图代码`-drawRect:`。

但是如果我`init`使用的视图

```
[[MyView alloc] initWithNibName:@"MyView" bundle:[NSBundle mainBundle]]; 
```

`-drawRect:`当然不会被调用。我试着做下面的代码`-viewDidLoad`

```
CGRect rect = [[self view] bounds];

CGContextRef ref = UIGraphicsGetCurrentContext();
CGContextSetLineWidth(ref, 2.0);
CGContextSetRGBStrokeColor(ref, 1.0, 1.0, 1.0, 1.0);
CGContextSetRGBFillColor(ref, 0, 0, 0, 0);
CGContextAddRect(ref, CGRectMake(1, 1, rect.size.width - 10, rect.size.height - 10));
CGContextStrokePath(ref);
CGContextDrawPath(ref, kCGPathFillStroke); 
```

但是什么都画不出来。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T23:09:18.997

以下是三种可能的解决方案，具体取决于您的限制。

1.  将 Xib 文件中的 NSView 对象的类设置为您的自定义类之一。您提到您知道如何使用“硬编码” NSView 子类进行自定义绘图，这将以相同的方式工作。加载 Xib 文件时，NSView 作为自定义类的对象而不是默认值加载到内存中。使用 Interface Builder 在 Xib 中更改视图的类类型很简单。
2.  如果 Xib 文件中的 NSView 对象已经是某种您不想覆盖的自定义视图，您可以在 Interface Builder 中向该视图添加一个子视图，并简单地将子视图变成您设计的自定义类（如#1)
3.  您可以在运行时以编程方式将子视图添加到 Xib 文件中的 NSView 对象。在上面的示例代码中，您可以创建自己的自定义 NSView 子类的实例，然后使用该`addSubView:`方法将其添加到现有视图中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T00:44:02.720

我认为问题在于您将视图及其视图控制器视为可互换的。例如，没有`-[UIView initWithNibName:bundle:]`方法——那是 UIViewController 方法。

此外，视图并不像用于绘图的“画布”。将要求视图自行绘制；一般不会从“外”拉进来。

所以：

1.  将 UIViewController 的子类从 MyView 重命名为 MyViewController。

2.  创建一个名为 MyView 的新 UIView 子类。

3.  向您的新 MyView 类添加一个`-drawRect:`方法来执行您想要的绘图。

4.  最后，使用 Identity Inspector 将 Interface Builder 中视图控制器视图的自定义类设置为 MyView。

例如，您应该能够将其用于您的`-[MyView drawRect:]`实现：

```
- (void)drawRect:(CGRect)rect {
    CGRect bounds = [[self view] bounds];

    CGContextRef ref = UIGraphicsGetCurrentContext();
    CGContextSetLineWidth(ref, 2.0);
    CGContextSetRGBStrokeColor(ref, 1.0, 1.0, 1.0, 1.0);
    CGContextSetRGBFillColor(ref, 0, 0, 0, 0);
    CGContextAddRect(ref, CGRectMake(1, 1, bounds.size.width - 10, bounds.size.height - 10));
    CGContextStrokePath(ref);
    CGContextDrawPath(ref, kCGPathFillStroke);
} 
```

绘图将被剪裁到传入的更新矩形。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T23:05:45.773

在一个简单的子视图中完成所有绘图并将其添加到 XIB 视图（在 viewDidLoad 中）怎么样？

# .net - 是否有适用于 .NET 的 Rhino JavaScript 引擎的端口

> ID：398809
> 
> 赞同：3
> 
> 时间：2008-12-29T21:56:21.313
> 
> 标签：.net, javascript-engine

我在一家同时拥有 Java 和 .NET 应用程序实现的公司工作。该应用程序允许最终用户使用脚本自定义处理和业务规则。Java 版本支持使用[Rhino 引擎](http://www.mozilla.org/rhino/)的 JavaScript 。.NET 应用程序需要 VBScript。我想使用 .NET 做类似的事情，但我更喜欢使用 JavaScript。我已经搜索过，但我很难找到像 Rhino 这样可以在 .NET 运行时中工作的东西。有没有人知道或有在 .NET 中使用 JavaScript 引擎的经验？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-03-09T10:22:31.570

您可以通过 IKVM.NET 在 .NET 上使用 Rhino。我做过一次，非常简单；您下载 jar 文件并使用 IKVM.NET 生成 dll。然后你像往常一样引用 dll。

你应该检查 Iron JS。它是在 DLR 上运行的完全 .NET 解决方案。

V8 也应该可以正常工作：http: [//javascriptdotnet.codeplex.com/](http://javascriptdotnet.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T22:09:45.387

您可能应该使用[JScript](http://msdn.microsoft.com/en-us/library/hbxc2t98.aspx) - Microsoft 的 JavaScript 实现，它是一种完整的 .NET 语言。

编辑：原来问题是[重复](https://stackoverflow.com/questions/172753/embedding-javascript-engine-into-net-c)的。一些具体建议：使用[Managed JScript](http://blogs.msdn.com/jscript/archive/2007/05/07/introducing-managed-jscript.aspx)，或者在 JScript 模式下使用[MSScriptControl.ScriptControlClass 。](http://weblogs.asp.net/rosherove/articles/DotNetScripting.aspx)

# performance - 在大量字符串中查找长时间重复的子字符串

> ID：398811
> 
> 赞同：11
> 
> 时间：2008-12-29T21:56:55.507
> 
> 标签：performance, algorithm, string, search

我天真地想象我可以构建一个后缀树，在其中为每个节点保留一个访问计数，然后计数大于 1 的最深节点就是我正在寻找的结果集。

我有一个非常长的字符串（数百兆字节）。我有大约 1 GB 的 RAM。

这就是为什么构建一个带有计数数据的后缀树在空间方面效率太低而无法为我工作。引用[维基百科的后缀树](http://en.wikipedia.org/wiki/Suffix_tree)：

> 存储字符串的后缀树通常需要比存储字符串本身更多的空间。
> 
> 每个边和节点中的大量信息使得后缀树非常昂贵，在良好的实现中消耗大约是源文本内存大小的十到二十倍。后缀数组将此要求降低到四倍，研究人员继续寻找更小的索引结构。

那是维基百科对树的评论，而不是尝试。

我怎样才能在如此大量的数据中找到长的重复序列，并且在合理的时间内（例如，在现代台式机上不到一个小时）？

（一些维基百科链接以避免人们将它们发布为“答案”：[字符串算法](http://en.wikipedia.org/wiki/Category:Algorithms_on_strings)，尤其是[最长重复子字符串问题](http://en.wikipedia.org/wiki/Longest_repeated_substring_problem);-)）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-25T11:29:09.007

执行此操作的有效方法是创建子字符串的索引，并对它们进行排序。这是一个 O(n lg n) 操作。

[BWT](http://en.wikipedia.org/wiki/Burrows%E2%80%93Wheeler_transform)压缩执行此步骤，因此这是一个很好理解的问题，并且有基数和[后缀](http://en.wikipedia.org/wiki/Suffix_array)（要求 O(n)）排序实现等以使其尽可能高效。大文本仍然需要很长时间，可能需要几秒钟。

如果您想使用实用程序代码，C++的`std::stable_sort()`性能*要比*自然语言好得多`std::sort()`（并且比 C 快得多`qsort()`，但原因不同）。

然后访问每个项目以查看其与其邻居的公共子串的长度为 O(n)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T22:16:35.263

您可以查看基于磁盘的后缀树。我通过谷歌找到了这个[后缀树实现库](http://sfxdisk.dead-inside.org/)，还有一堆可以帮助自己实现它的文章。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T22:38:14.520

您可以使用分而治之的方式解决此问题。我认为这应该与使用 trie 具有相同的算法复杂性，但在实现方面可能效率较低

```
void LongSubstrings(string data, string prefix, IEnumerable<int> positions)
{
    Dictionary<char, DiskBackedBuffer> buffers = new Dictionary<char, DiskBackedBuffer>();
    foreach (int position in positions)
    {
        char nextChar = data[position];
        buffers[nextChar].Add(position+1);
    }

    foreach (char c in buffers.Keys)
    {
        if (buffers[c].Count > 1)
            LongSubstrings(data, prefix + c, buffers[c]);
        else if (buffers[c].Count == 1)
            Console.WriteLine("Unique sequence: {0}", prefix + c);
    }
}

void LongSubstrings(string data)
{
    LongSubstrings(data, "", Enumerable.Range(0, data.Length));
} 
```

在此之后，您需要创建一个实现 DiskBackedBuffer 的类，它是一个数字列表，当缓冲区达到一定大小时，它会使用临时文件将自己写入磁盘，并在读取时从磁盘调用从。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-01T14:13:47.423

回答我自己的问题：

鉴于长匹配也是短匹配，您可以通过首先找到较短的匹配然后查看是否可以“增长”这些匹配来用多次传球换取 RAM。

字面意义上的方法是为数据中某个固定长度的所有序列构建一个 trie（在每个节点中都有计数）。然后，您剔除所有与您的条件不匹配的节点（例如最长匹配）。然后对数据进行后续传递，将尝试构建得更深，但不会更广。重复直到找到最长的重复序列。

一位好朋友建议使用散列。通过散列从每个字符开始的固定长度字符序列，您现在遇到了查找重复散列值的问题（并验证重复，因为散列是有损的）。如果您分配数据长度的数组来保存哈希值，您可以做一些有趣的事情，例如查看匹配是否比数据的固定长度传递长，您可以只比较哈希序列而不是重新生成他们。等等。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-17T16:49:54.970

像这样的简单程序怎么样：

```
S = "ABAABBCCAAABBCCM"

def findRepeat(S):
    n = len(S)
    #find the maxim lenth of repeated string first 
    msn = int(floor(n/2))
    #start with maximum length 
    for i in range(msn,1,-1):
        substr = findFixedRepeat(S, i)
        if substr:
            return substr
    print 'No repeated string'
    return 0

def findFixedRepeat(str, n):
    l = len(str)
    i = 0
    while  ((i + n -1) < l):
        ss = S[i:i+n]
        bb = S[i+n:]
        try:
            ff = bb.index(ss)
        except:
            ff = -1

        if ff >= 0:
            return ss;
        i = i+1
    return 0
print findRepeat(S) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T22:08:19.587

这段文字有断字吗？然后我怀疑你想要关键字上下文的变体：为一行中的 n 个单词复制每一行 n 次，在每个单词处断开每一行；排序整个事情的阿尔法；寻找重复。

如果它是一根长喇叭线，比如生物信息学 DNA 序列，那么你想在磁盘上构建类似 trie 的东西；为每个字符建立一条记录，并为下一个节点创建一个磁盘偏移量。我会看一下[Knuth](http://www-cs-faculty.stanford.edu/~knuth/taocp.html)的第 3 卷，第 5.4 节，“外部排序”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T22:20:52.027

[您可以通过构建后缀数组](http://en.wikipedia.org/wiki/Suffix_array)来解决您的问题吗？否则，您可能需要使用其他答案中提到的基于磁盘的后缀树之一。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-02T08:49:01.337

只是一个迟来的念头在我脑海中浮现……

取决于您的操作系统/环境。（例如 64 位指针和 mmap() 可用。）

您可以通过 mmap() 在磁盘上创建一个非常大的 Suffix-tree，然后将该树的缓存最常访问子集保存在内存中。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-29T22:08:24.797

最简单的方法可能就是[花 100 美元](http://www.codinghorror.com/blog/archives/001198.html)购买更多 RAM。否则，您可能必须查看磁盘支持的结构来保存您的后缀树。

# javascript - 如何处理 Firefox 在标签之间插入文本元素

> ID：398816
> 
> 赞同：2
> 
> 时间：2008-12-29T21:57:38.797
> 
> 标签：javascript, html, firefox

我正在尝试编写 javascript 来通过使用 parentNode、firstChild、nextSibling、childNodes[] 等来查找相对于给定元素的页面元素。Firefox 通过在每个 html 元素之间插入文本节点来解决这个问题。我读过我可以通过删除元素之间的所有空格来解决这个问题，但我已经尝试过了，但它不起作用。有没有办法编写适用于所有现代浏览器的代码？

例如：

```
<div id="parent"><p id="child">Hello world</p></div> 
```

在 IE 中 parent.firstChild 是子元素，但在 Firefix 中它是一个幻影文本元素。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T22:21:49.560

我有一个解决方法。您可以插入以下两种方法：

```
Element.prototype.fChild = function(){
    var firstChild = this.firstChild;
    while(firstChild != null && firstChild.nodeType === 3){
        firstChild = firstChild.nextSibling;
    }
    return firstChild;
 }
 Element.prototype.nSibling = function(){
    var nextSibling = this.nextSibling;
    while(nextSibling != null && nextSibling.nodeType === 3){
        nextSibling = nextSibling.nextSibling;
    }
    return nextSibling;
 } 
```

你现在可以使用：

```
document.getElementById("parent").fChild();
document.getElementById("parent").nSibling(); 
```

代替：

```
 document.getElementById("parent").firstChild;
 document.getElementById("parent").nextSibling; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T23:54:01.060

您必须检查 nodeType == 1。

```
if (el.nodeType === 1) {
    return el;
} 
```

我为你写了一个小的 DOM 遍历类（主要是从 MooTools 复制的）。在这里下载：http: [//gist.github.com/41440](http://gist.github.com/41440)

```
DOM = function () {

    function get(id) {
        if (id && typeof id === 'string') {
            id = document.getElementById(id);
        }
        return id || null;
    }

    function walk(element, tag, walk, start, all) {
        var el = get(element)[start || walk], elements = all ? [] : null;
        while (el) {
            if (el.nodeType === 1 && (!tag || el.tagName.toLowerCase() === tag)) {
                if (!all) {
                    return el;
                }
                elements.push(el);
            }
            el = el[walk];
        }
        return elements;
    }

    return {

        // Get the element by its id
        get: get,

        walk: walk,

        // Returns the previousSibling of the Element (excluding text nodes).
        getPrevious: function (el, tag) {
            return walk(el, tag, 'previousSibling');
        },

        // Like getPrevious, but returns a collection of all the matched previousSiblings.
        getAllPrevious: function (el, tag) {
            return walk(el, tag, 'previousSibling', null, true);
        },

        // As getPrevious, but tries to find the nextSibling (excluding text nodes).
        getNext: function (el, tag) {
            return walk(el, tag, 'nextSibling');
        },

        // Like getNext, but returns a collection of all the matched nextSiblings.
        getAllNext: function (el, tag) {
            return walk(el, tag, 'nextSibling', null, true);
        },

        // Works as getPrevious, but tries to find the firstChild (excluding text nodes).
        getFirst: function (el, tag) {
            return walk(el, tag, 'nextSibling', 'firstChild');
        },

        // Works as getPrevious, but tries to find the lastChild.
        getLast: function (el, tag) {
            return walk(el, tag, 'previousSibling', 'lastChild');
        },

        // Works as getPrevious, but tries to find the parentNode.
        getParent: function (el, tag) {
            return walk(el, tag, 'parentNode');
        },

        // Like getParent, but returns a collection of all the matched parentNodes up the tree.
        getParents: function (el, tag) {
            return walk(el, tag, 'parentNode', null, true);
        },

        // Returns all the Element's children (excluding text nodes).
        getChildren: function (el, tag) {
            return walk(el, tag, 'nextSibling', 'firstChild', true);
        },

        // Removes the Element from the DOM.
        dispose: function (el) {
            el = get(el);
            return (el.parentNode) ? el.parentNode.removeChild(el) : el;
        }

    };
}();

// Now you can do:
DOM.getFirst("parent") // first child
// or
DOM.getFirst("parent", "p") // first p tag child
// or
var el = DOM.get("parent") // get element by id
DOM.getFirst(el) // first child 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T22:06:49.823

您可以使用 tagName 来检查标签的名称。如果未定义，那么这是您的“幻影”文本节点。

例如

```
`function getFirstTag(node) {
  return ((node.firstChild.tagName) ? node.firstChild : node.firstChild.nextSibling);
}` 
```

* * *

 `## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T22:46:32.600

检查[DOM 2 级核心参考](http://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-1950641247)以查看各种可能的节点类型，因此您可以使用简单的 JavaScript 片段过滤掉不需要的节点。一种解决方案是对对象进行猴子修补（参见 Vernicht 的答案），或者如果您不喜欢猴子修补，那么您可以将这些方法添加到您自己的库中，或者更好的解决方案可能是使用像 jQuery 或原型。

# c# - 带有 C# 和 WPF 的键盘挂钩，用于最小化系统托盘应用程序

> ID：398830
> 
> 赞同：4
> 
> 时间：2008-12-29T22:00:58.963
> 
> 标签：c#, wpf, keyboard, hook

我有一个 WPF 应用程序，我通过 this.Hide() 和 System.Windows.Forms.NotifyIcon 将其最小化到系统托盘。当它最小化时，我想要一个键盘钩子最大化应用程序。例如，如何注册像 Windows-Button & T 这样的键盘钩子。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T23:48:26.093

如果您不介意 Win32 API 调用，我会说您最好的选择是调用[RegisterHotKey](http://msdn.microsoft.com/en-us/library/ms646309%28VS.85%29.aspx)。您将修饰符和键传递给它以捕获，然后将 a`WM_HOTKEY`发送到您最初传入的 HWND。

# frameworks - 用于辅助演出的生产力超级明星框架/工具

> ID：398840
> 
> 赞同：2
> 
> 时间：2008-12-29T22:06:02.353
> 
> 标签：frameworks

如果您要开始构建网站作为咨询业务 - 保持您的日常工作 - 而且您还有一个蹒跚学步的孩子和一个妻子，您会选择哪些框架/工具来节省您的打字时间？

任何语言。

我正在寻找一个生产力超级明星堆栈，当我必须在 6 个月后更新站点或在生产中“进化”数据模型时，它不会束缚我的双手。

它需要允许我对客户说“是”：社区功能、CMS、安全性、审核、AJAX，......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-29T22:13:45.427

我会建议Django。超级简单，可以快速启动和运行。您正在使用 Python，它有一个大型库可供使用。对我来说，Ruby on Rails 紧随其后。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T22:13:02.683

如果您想要一个带有许多选项的预制框架来插入您自己的代码，请查看 Microsoft 的 Sharepoint 服务器。Sharepoint 本身就是一个世界，但它是一个非常强大的环境。

更新：我很惊讶被否决了这个。请记住，提问者特别要求包含 CMS 的框架。Sharepoint 符合这一标准 - 与直接的 .NET 或其他 Web 开发框架不同。

如果您要对该条目投反对票，我认为您应该向提出问题的人解释为什么您认为他甚至不应该将其作为一种选择进行探索。你可能是对的——集体智慧是对 SO 投票的全部意义所在。但是没有解释，我们不知道*为什么*你认为你是对的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T22:14:51.087

我可能会看看 DotNetNuke。它易于设置（很多主机都会为您完成）并且易于使用，并且可以将企业未来能够维护的自定义站点组合在一起。

创建特定于业务的自定义模块和数百个用于销售（或免费）的模块相当容易，这些模块可以集成到 DNN 中以用于特殊用途。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T23:26:59.133

我建议使用您可以理解的语言使用任何 MVC！在 python、php 和 ruby​​ 中，有几个 CMS 使用了这种设计，而且……这让你可以为 Ajax 的战斗做好准备，并且可以非常快速地扩展任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T23:48:03.600

这绝对不是一个可以回答的问题。

我更喜欢 asp.net webforms，因为我认为它允许非常快速的 Web 应用程序开发，但我相信您会收到以下建议：

asp.net mvc Ruby on Rails PHP 和一些框架 Python 和一些框架，例如 Django

我相信 PHP 拥有您可以使用的最多的预构建应用程序，尽管 asp.net 也有您正在寻找的东西。

所有这些平台和框架都可以做你想做的事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T11:07:07.643

我建议研究[Grails](http://grails.org)。它使用类似于 Java 的[Groovy](http://groovy.codehaus.org/)（因此，如果您已经知道这一点，那么您就可以开始了）。Groovy 在 JVM 上运行，因此您仍然可以使用所有已用于 Java 的优秀库。然而，由于它是一种动态语言，有很多类似 Ruby 的花里胡哨，你可以在需要/想要的时候使用闭包和那种简洁的东西。Java 的传统缓慢的编译-部署-测试开发周期不会让您放慢脚步。

Grails 已经安装了[Hibernate](http://hibernate.org/)和[Spring](http://www.springsource.org/about)。您几乎可以立即创建 CRUD 应用程序（很像 Rails 应用程序），同时深入研究并能够控制每一个小细节，因为它建立在这些经过验证且得到良好支持的技术之上。此外，还有数百个插件可帮助您轻松设置邮件列表、安全性、AJAX 组件等。

否则，如果您想建立一个社区站点并且不想编写一行代码，您可以随时查看[ning.com](http://ning.com)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T22:09:48.010

我的答案将围绕 .NET 堆栈展开。

1.  使用母版页和 CSS 模板。这使得为​​您的客户打造新的外观和感觉变得更加容易。

2.  当然，我会在 .NET 世界中包含动态数据框架。

3.  托管可能会成为您的客户的问题。关于管理电子邮件地址的问题，如何快速更新网站以包含新的联系电话号码的程序（我假设每个客户都不同）考虑在您最喜欢的虚拟主机上获得一个经销商帐户，并根据需要分配虚拟主机帐户。围绕这一点有很多问题。它可能会成为经常性收入的一个很好的来源。

为自己构建一些模式，包括处理所有数据调用的数据库包装器（即包装所有数据调用、设置 ADO.NET 对象、运行 sproc 调用并从 app.config 中获取 connstring 的 dll 或相似的东西。）

这对可维护性也有很大帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T00:04:36.123

在 Rails 和 Django 之间进行选择。他们都有不同的优势。总的来说，我更喜欢 Rails，但 Django 的管理界面可以在需要时为您节省大量时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T04:05:34.857

这里还有一个因素需要考虑：你最熟悉什么？我相信一些研究发现，在尝试学习新的语言/框架时，生产力会损失 30% 以上。

有时，坚持你所知道的并没有什么错。但是，如果您对学习什么语言/框架感兴趣，我会推荐您参考其他帖子，因为上面是我唯一真正需要添加的内容。

# eclipse - 如何在 Eclipse 中安装 JScience 库？

> ID：398850
> 
> 赞同：1
> 
> 时间：2008-12-29T22:08:26.187
> 
> 标签：eclipse, jscience

或者只是任何图书馆，一般来说？我下载了 bin.zip 文件，但我似乎无能为力？这把我逼到了墙角……

编辑：换句话说，没有“标准”的方法吗？我知道如何添加 Jar 文件，可以将它们（和文档）放在任何地方吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T22:13:20.683

应该不会比将 JAR 放入您的项目构建路径更难。

解压缩存档并将 JAR 放在 Eclipse 可以找到它们的地方。

# .net - 如何测试我的 .NET 知识？

> ID：398856
> 
> 赞同：1
> 
> 时间：2008-12-29T22:09:50.113
> 
> 标签：.net

许多编程和计算机科学主题都很棘手，因此有时很难知道您是否在阅读后立即获得了一个想法。一些程序员的学习材料很好地结合了自测；一个很好的例子是[信号量小书](http://www.greenteapress.com/semaphores/)。

我喜欢用一些方法来测试我对 .NET 运行时的了解：BCL、C# 以及 WPF。我特别想了解数据结构中的存储和检索如何在 .NET 中以某种类似于 STL（、、、`deque`等`vector`）的方式工作`map`。理想情况下，这就像信号量书中的材料一样，其中相关材料与自测一起呈现。

建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T22:44:53.883

什么构成测试可能是这个问题中最模棱两可的部分。据我了解，测试本身可以是以下任何一种：

1）定义反刍，有人说了各种定义，但不理解可能存在的任何关系。

2) 使用特定的命名法重写定义，以尝试展示对概念的掌握。

3）从头开始教别人这个概念。在这种情况下，翻译材料以及首选哪种方法可能会遇到挑战。

4) 举一个使用特定概念的例子。这可能很棘手，因为一些定义事物的地方也会给出一些琐碎的例子。

5）“告诉我一个地方......”类型的问题是询问如何使用某些东西。

第三个是我经常看到的用来描述某人真正理解一个概念的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T23:28:06.383

您可以为 MCSD 进行一些练习测试。这会给你一个从哪里开始的好主意。大多数练习测试将参考找到答案的各种书籍。

[http://www.measureup.com/catalog/exam.aspx?vid=5&cid=MCSD&tid=25](http://www.measureup.com/catalog/exam.aspx?vid=5&cid=MCSD&tid=25)

是一些练习测试的列表。

我不知道您可以在哪里测试一些较新的技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T22:48:07.637

如果您能够在现实世界的应用程序中有效且高效地使用新技术、技术或语言，那么您可能已经超越了初学者阶段并且对它的了解足以说“我知道”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T22:13:37.097

这是任何文本的问题。如果你担心它，你有几个选择：寻找有问题集的文本，或者尝试自己使用它。我正在研究 Common Lisp、Python 和 Ruby 中的 Project Euler；我发现在思考问题时给自己写笔记也很有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T22:38:22.663

在获得一个想法和真正理解它之间存在天壤之别。“有点”得到它意味着你得到了术语，认识到问题，但可能无法坐下来编写解决方案或向其他人解释它。我的个人经验是，如果我对自己诚实，我知道我的理解会落在哪一边。

*   如果你不确定你是否完全理解某事，你不会
*   如果你不能向别人解释，你可能不会。如果你能向你做的人解释。

我在自学方面取得进展的很大一部分（这将永远是这个职业的很大一部分）一直在我的脑海中浮现，在“某种”水平上学习东西对我没有任何好处，而教学我自己不满足。当你真正学到东西时，你就拥有了它。直到那时。

冒着成为超级极客的风险，有 [一个很棒的发明词](http://en.wikipedia.org/wiki/Grok)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-04T16:23:00.533

认证是评估知识的最佳方式之一，但也应遵循实践。并尝试提出该项目并实施它。

# c# - 使用配置类或参数实例化对象

> ID：398866
> 
> 赞同：1
> 
> 时间：2008-12-29T22:14:24.397
> 
> 标签：c#, .net, constructor

我遇到了与同事的设计分歧，并希望人们对对象构造函数设计提出意见。简而言之，您更喜欢哪种对象构造方法，为什么？

```
 public class myClass
    {
        Application m_App;

        public myClass(ApplicationObject app) 
        { 
             m_App = app;
        }  
        public method DoSomething 
       { 
         m_App.Method1();
         m_App.Object.Method();
       }
    } 
```

或者

```
 public class myClass
    {
        Object m_someObject;
        Object2 m_someOtherObject;

        public myClass(Object instance, Object2 instance2) 
        { 
             m_someObject = instance; 
             m_someOtherObject = instance2;
        }  
        public method DoSomething 
       { 
         m_someObject.Method();
         m_someOtherObject.Method();
       }
    } 
```

背后的故事是，我遇到了一个似乎与今天构建对象完全不同的观点。目前，对象是使用 Application 类构建的，该类包含应用程序的所有当前设置（事件日志目标、数据库字符串等），因此每个对象的构造函数如下所示：

```
public Object(Application) 
```

许多类单独持有对这个 Application 类的引用。在每个类中，根据需要引用应用程序的值。例如

```
Application.ConfigurationStrings.String1 or Application.ConfigSettings.EventLog.Destination 
```

最初我认为你可以使用这两种方法。问题是，在调用堆栈的底部，您调用参数化构造函数，然后在堆栈的较高位置，当新对象期望对应用程序对象的引用时，我们遇到了很多空引用错误并看到了设计缺陷。

我对使用应用程序对象设置每个类的感觉是，它打破了对每个对象的封装，并允许应用程序类成为一个保存所有信息的神类。在考虑这种方法的缺点时，我遇到了问题。

我想更改对象构造函数以仅接受它需要的参数，以便`public object(Application)`更改为`public object(classmember1, classmember2 etc...)`. 我目前觉得这使它更可测试，隔离更改，并且不会混淆要传递的必要参数。

目前，另一位程序员没有看到差异，我很难找到示例或更改设计的充分理由，并说这是我的直觉，只是违背了我知道的 OO 原则，我知道这不是一个令人信服的论点。我的设计思想偏离了基础吗？有没有人有任何观点可以支持其中一个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-29T23:02:03.113

我的观点是，你给班级提供了它完成工作所需的最小的“东西”。“应用程序”方法在前期更容易，但正如您已经看到的那样，它会导致维护问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T23:05:46.803

见鬼，为什么不只创建一个名为“Do”的巨大类和一个名为“It”的方法，然后将整个宇宙传递给 It 方法呢？

```
Do.It(universe) 
```

保持尽可能小。当事情不可避免地发生故障时，离散意味着更容易调试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T10:38:44.180

我认为史蒂夫·麦康奈尔说得非常简洁。他说，

> “‘便利性’哲学和‘智力可管理性’哲学之间的区别归结为编写程序和阅读程序的重点不同。最大化范围确实可以使程序易于编写，但是任何例程都可以使用任何程序的程序任何时候的变量都比使用结构良好的例程的程序更难理解。在这样的程序中，您不能只理解一个例程；您必须了解与该例程共享全局数据的所有其他例程。这样的程序是难以阅读、难以调试和难以修改。” [麦康奈尔 2004]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T23:03:40.910

我不会把 Application 对象称为“上帝”类；它真的看起来像一个实用程序类。它不是其他类可以随意使用的公共静态类（或者更好的是一组类）是否有原因？

# c# - 使用 LINQ 更新集合中的所有对象

> ID：398871
> 
> 赞同：587
> 
> 时间：2008-12-29T22:15:23.800
> 
> 标签：c#, .net, linq, foreach

有没有办法使用 LINQ 执行以下操作？

```
foreach (var c in collection)
{
    c.PropertyToSet = value;
} 
```

为了澄清，我想遍历集合中的每个对象，然后更新每个对象的属性。

我的用例是我对博客文章有一堆评论，我想遍历博客文章的每条评论，并将博客文章的日期时间设置为 +10 小时。我可以在 SQL 中做到这一点，但我想将它保留在业务层中。

* * *

## 回答 #1

> 赞同：951
> 
> 时间：2008-12-29T23:28:54.650

虽然您可以使用`ForEach`扩展方法，但如果您只想使用可以执行的框架

```
collection.Select(c => {c.PropertyToSet = value; return c;}).ToList(); 
```

由于*惰性评估*`ToList`，需要立即评估选择。

 ** * *

## 回答 #2

> 赞同：415
> 
> 时间：2011-04-22T12:40:45.277

```
collection.ToList().ForEach(c => c.PropertyToSet = value); 
```

* * *

## 回答 #3

> 赞同：81
> 
> 时间：2011-06-03T23:38:09.863

我正在这样做

```
Collection.All(c => { c.needsChange = value; return true; }); 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-12-29T22:56:16.527

我实际上找到了一个扩展方法，可以很好地做我想做的事

```
public static IEnumerable<T> ForEach<T>(
    this IEnumerable<T> source,
    Action<T> act)
{
    foreach (T element in source) act(element);
    return source;
} 
```

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2013-01-18T19:55:36.883

采用：

```
ListOfStuff.Where(w => w.Thing == value).ToList().ForEach(f => f.OtherThing = vauleForNewOtherThing); 
```

我不确定这是否过度使用 LINQ，但是当我想针对特定条件更新列表中的特定项目时，它对我有用。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2018-07-25T07:19:29.500

尽管您特别要求提供 LINQ 解决方案并且这个问题已经很老了，但我发布了一个非 LINQ 解决方案。这是因为 LINQ（=语言集成**查询**）旨在用于对集合的查询。所有 LINQ 方法都不会修改底层集合，它们只是*返回*一个新集合（或者更准确地说是一个新集合的迭代器）。因此，无论您使用 a`Select`做什么都不会影响基础集合，您只需获得一个新集合。

当然，您*可以*使用 a `ForEach`（顺便说一下，这不是 LINQ，而是 的扩展名`List<T>`）。但这*实际上*无论如何都在使用`foreach`，但是带有 lambda 表达式。除此之外，*每个*LINQ 方法都会在内部迭代您的集合，例如使用`foreach`or `for`，但它只是将其隐藏在客户端之外。我不认为这更具可读性和可维护性（考虑在调试包含 lambda 表达式的方法时编辑代码）。

话虽如此，这不应该使用 LINQ 来*修改*集合中的项目。更好的方法是您在问题中已经提供的解决方案。使用经典循环，您可以轻松地迭代您的集合并更新其项目。事实上，所有这些依赖的解决方案`List.ForEach`都没有什么不同，但从我的角度来看，要阅读起来要困难得多。

因此，在您想要*更新*集合元素的情况下，您不应该使用 LINQ。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-12-29T22:22:21.883

没有内置的扩展方法可以做到这一点。虽然定义一个是相当直接的。在帖子的底部是我定义的一个名为 Iterate 的方法。可以这样使用

```
collection.Iterate(c => { c.PropertyToSet = value;} ); 
```

迭代源

```
public static void Iterate<T>(this IEnumerable<T> enumerable, Action<T> callback)
{
    if (enumerable == null)
    {
        throw new ArgumentNullException("enumerable");
    }

    IterateHelper(enumerable, (x, i) => callback(x));
}

public static void Iterate<T>(this IEnumerable<T> enumerable, Action<T,int> callback)
{
    if (enumerable == null)
    {
        throw new ArgumentNullException("enumerable");
    }

    IterateHelper(enumerable, callback);
}

private static void IterateHelper<T>(this IEnumerable<T> enumerable, Action<T,int> callback)
{
    int count = 0;
    foreach (var cur in enumerable)
    {
        callback(cur, count);
        count++;
    }
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-08-17T14:10:14.743

我已经尝试了一些变体，并且我继续回到这个人的解决方案。

[http://www.hookdonlinq.com/UpdateOperator.ashx](http://www.hookedonlinq.com/UpdateOperator.ashx)

同样，这是其他人的解决方案。但是我已经将代码编译成一个小库，并且经常使用它。

我将在此处粘贴他的代码，以防他的网站（博客）在未来某个时候不复存在。（没有什么比看到一个帖子说“这是您需要的确切答案”、点击和死 URL 更糟糕的了。）

```
 public static class UpdateExtensions {

    public delegate void Func<TArg0>(TArg0 element);

    /// <summary>
    /// Executes an Update statement block on all elements in an IEnumerable<T> sequence.
    /// </summary>
    /// <typeparam name="TSource">The source element type.</typeparam>
    /// <param name="source">The source sequence.</param>
    /// <param name="update">The update statement to execute for each element.</param>
    /// <returns>The numer of records affected.</returns>
    public static int Update<TSource>(this IEnumerable<TSource> source, Func<TSource> update)
    {
        if (source == null) throw new ArgumentNullException("source");
        if (update == null) throw new ArgumentNullException("update");
        if (typeof(TSource).IsValueType)
            throw new NotSupportedException("value type elements are not supported by update.");

        int count = 0;
        foreach (TSource element in source)
        {
            update(element);
            count++;
        }
        return count;
    }
}

int count = drawingObjects
        .Where(d => d.IsSelected && d.Color == Colors.Blue)
        .Update(e => { e.Color = Color.Red; e.Selected = false; } ); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-29T22:22:22.210

不，LINQ 不支持大规模更新的方式。唯一*更短*的方法是使用`ForEach`扩展方法 -[为什么 IEnumerable 上没有 ForEach 扩展方法？](https://stackoverflow.com/questions/101265/why-is-there-not-a-foreach-extension-method-on-the-ienumerable-interface#101303)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-29T22:38:39.620

我的2便士：-

```
 collection.Count(v => (v.PropertyToUpdate = newValue) == null); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-29T23:33:34.393

您可以使用 LINQ 将您的集合转换为数组，然后调用 Array.ForEach()：

```
Array.ForEach(MyCollection.ToArray(), item=>item.DoSomeStuff()); 
```

显然，这不适用于结构集合或内置类型（如整数或字符串）。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-06-25T00:47:41.330

我写了一些扩展方法来帮助我解决这个问题。

```
namespace System.Linq
{
    /// <summary>
    /// Class to hold extension methods to Linq.
    /// </summary>
    public static class LinqExtensions
    {
        /// <summary>
        /// Changes all elements of IEnumerable by the change function
        /// </summary>
        /// <param name="enumerable">The enumerable where you want to change stuff</param>
        /// <param name="change">The way you want to change the stuff</param>
        /// <returns>An IEnumerable with all changes applied</returns>
        public static IEnumerable<T> Change<T>(this IEnumerable<T> enumerable, Func<T, T> change  )
        {
            ArgumentCheck.IsNullorWhiteSpace(enumerable, "enumerable");
            ArgumentCheck.IsNullorWhiteSpace(change, "change");

            foreach (var item in enumerable)
            {
                yield return change(item);
            }
        }

        /// <summary>
        /// Changes all elements of IEnumerable by the change function, that fullfill the where function
        /// </summary>
        /// <param name="enumerable">The enumerable where you want to change stuff</param>
        /// <param name="change">The way you want to change the stuff</param>
        /// <param name="where">The function to check where changes should be made</param>
        /// <returns>
        /// An IEnumerable with all changes applied
        /// </returns>
        public static IEnumerable<T> ChangeWhere<T>(this IEnumerable<T> enumerable, 
                                                    Func<T, T> change,
                                                    Func<T, bool> @where)
        {
            ArgumentCheck.IsNullorWhiteSpace(enumerable, "enumerable");
            ArgumentCheck.IsNullorWhiteSpace(change, "change");
            ArgumentCheck.IsNullorWhiteSpace(@where, "where");

            foreach (var item in enumerable)
            {
                if (@where(item))
                {
                    yield return change(item);
                }
                else
                {
                    yield return item;
                }
            }
        }

        /// <summary>
        /// Changes all elements of IEnumerable by the change function that do not fullfill the except function
        /// </summary>
        /// <param name="enumerable">The enumerable where you want to change stuff</param>
        /// <param name="change">The way you want to change the stuff</param>
        /// <param name="where">The function to check where changes should not be made</param>
        /// <returns>
        /// An IEnumerable with all changes applied
        /// </returns>
        public static IEnumerable<T> ChangeExcept<T>(this IEnumerable<T> enumerable,
                                                     Func<T, T> change,
                                                     Func<T, bool> @where)
        {
            ArgumentCheck.IsNullorWhiteSpace(enumerable, "enumerable");
            ArgumentCheck.IsNullorWhiteSpace(change, "change");
            ArgumentCheck.IsNullorWhiteSpace(@where, "where");

            foreach (var item in enumerable)
            {
                if (!@where(item))
                {
                    yield return change(item);
                }
                else
                {
                    yield return item;
                }
            }
        }

        /// <summary>
        /// Update all elements of IEnumerable by the update function (only works with reference types)
        /// </summary>
        /// <param name="enumerable">The enumerable where you want to change stuff</param>
        /// <param name="update">The way you want to change the stuff</param>
        /// <returns>
        /// The same enumerable you passed in
        /// </returns>
        public static IEnumerable<T> Update<T>(this IEnumerable<T> enumerable,
                                               Action<T> update) where T : class
        {
            ArgumentCheck.IsNullorWhiteSpace(enumerable, "enumerable");
            ArgumentCheck.IsNullorWhiteSpace(update, "update");
            foreach (var item in enumerable)
            {
                update(item);
            }
            return enumerable;
        }

        /// <summary>
        /// Update all elements of IEnumerable by the update function (only works with reference types)
        /// where the where function returns true
        /// </summary>
        /// <param name="enumerable">The enumerable where you want to change stuff</param>
        /// <param name="update">The way you want to change the stuff</param>
        /// <param name="where">The function to check where updates should be made</param>
        /// <returns>
        /// The same enumerable you passed in
        /// </returns>
        public static IEnumerable<T> UpdateWhere<T>(this IEnumerable<T> enumerable,
                                               Action<T> update, Func<T, bool> where) where T : class
        {
            ArgumentCheck.IsNullorWhiteSpace(enumerable, "enumerable");
            ArgumentCheck.IsNullorWhiteSpace(update, "update");
            foreach (var item in enumerable)
            {
                if (where(item))
                {
                    update(item);
                }
            }
            return enumerable;
        }

        /// <summary>
        /// Update all elements of IEnumerable by the update function (only works with reference types)
        /// Except the elements from the where function
        /// </summary>
        /// <param name="enumerable">The enumerable where you want to change stuff</param>
        /// <param name="update">The way you want to change the stuff</param>
        /// <param name="where">The function to check where changes should not be made</param>
        /// <returns>
        /// The same enumerable you passed in
        /// </returns>
        public static IEnumerable<T> UpdateExcept<T>(this IEnumerable<T> enumerable,
                                               Action<T> update, Func<T, bool> where) where T : class
        {
            ArgumentCheck.IsNullorWhiteSpace(enumerable, "enumerable");
            ArgumentCheck.IsNullorWhiteSpace(update, "update");

            foreach (var item in enumerable)
            {
                if (!where(item))
                {
                    update(item);
                }
            }
            return enumerable;
        }
    }
} 
```

我这样使用它：

```
 List<int> exampleList = new List<int>()
            {
                1, 2 , 3
            };

        //2 , 3 , 4
        var updated1 = exampleList.Change(x => x + 1);

        //10, 2, 3
        var updated2 = exampleList
            .ChangeWhere(   changeItem => changeItem * 10,          // change you want to make
                            conditionItem => conditionItem < 2);    // where you want to make the change

        //1, 0, 0
        var updated3 = exampleList
            .ChangeExcept(changeItem => 0,                          //Change elements to 0
                          conditionItem => conditionItem == 1);     //everywhere but where element is 1 
```

供参考参数检查：

```
/// <summary>
/// Class for doing argument checks
/// </summary>
public static class ArgumentCheck
{

    /// <summary>
    /// Checks if a value is string or any other object if it is string
    /// it checks for nullorwhitespace otherwhise it checks for null only
    /// </summary>
    /// <typeparam name="T">Type of the item you want to check</typeparam>
    /// <param name="item">The item you want to check</param>
    /// <param name="nameOfTheArgument">Name of the argument</param>
    public static void IsNullorWhiteSpace<T>(T item, string nameOfTheArgument = "")
    {

        Type type = typeof(T);
        if (type == typeof(string) ||
            type == typeof(String))
        {
            if (string.IsNullOrWhiteSpace(item as string))
            {
                throw new ArgumentException(nameOfTheArgument + " is null or Whitespace");
            }
        }
        else
        {
            if (item == null)
            {
                throw new ArgumentException(nameOfTheArgument + " is null");
            }
        }

    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-12-15T16:16:32.130

您可以使用[Magiq](http://magiq.codeplex.com)，这是一个 LINQ 的批处理操作框架。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-12-15T16:20:56.287

这是我使用的扩展方法...

```
 /// <summary>
    /// Executes an Update statement block on all elements in an  IEnumerable of T
    /// sequence.
    /// </summary>
    /// <typeparam name="TSource">The source element type.</typeparam>
    /// <param name="source">The source sequence.</param>
    /// <param name="action">The action method to execute for each element.</param>
    /// <returns>The number of records affected.</returns>
    public static int Update<TSource>(this IEnumerable<TSource> source, Func<TSource> action)
    {
        if (source == null) throw new ArgumentNullException("source");
        if (action == null) throw new ArgumentNullException("action");
        if (typeof (TSource).IsValueType)
            throw new NotSupportedException("value type elements are not supported by update.");

        var count = 0;
        foreach (var element in source)
        {
            action(element);
            count++;
        }
        return count;
    } 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-11-10T13:30:10.173

有些人认为这是一个评论，但对我来说是一个答案，因为做错事的正确方法是不去做。所以，这个问题的答案就在问题本身。

> 不要使用 LINQ 修改数据。使用循环。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-29T22:27:21.687

我假设您想更改查询中的值，以便您可以为它编写一个函数

```
void DoStuff()
{
    Func<string, Foo, bool> test = (y, x) => { x.Bar = y; return true; };
    List<Foo> mylist = new List<Foo>();
    var v = from x in mylist
            where test("value", x)
            select x;
}

class Foo
{
    string Bar { get; set; }
} 
```

但是，如果这就是您的意思，请不要确定。

* * *

## 回答 #17

> 赞同：-4
> 
> 时间：2019-01-14T11:30:59.627

假设我们有如下数据，

```
var items = new List<string>({"123", "456", "789"});
// Like 123 value get updated to 123ABC .. 
```

如果我们想修改列表并将列表的现有值替换为修改后的值，则首先创建一个新的空列表，然后通过在每个列表项上调用修改方法来循环数据列表，

```
var modifiedItemsList = new List<string>();

items.ForEach(i => {
  var modifiedValue = ModifyingMethod(i);
  modifiedItemsList.Add(items.AsEnumerable().Where(w => w == i).Select(x => modifiedValue).ToList().FirstOrDefault()?.ToString()) 
});
// assign back the modified list
items = modifiedItemsList; 
```

# flash - AS3 FLVPLaybackCaptioning 组件显示图像？

> ID：398874
> 
> 赞同：2
> 
> 时间：2008-12-29T22:15:59.290
> 
> 标签：flash, actionscript-3, flash-cs3, flvplayback

我正在使用 FLVPlaybackCaptioning 组件来显示视频的字幕。我们构建了一个播放器，它使用本地托管或从服务器流式传输的 FLV 文件来显示视频的标题、幻灯片标题和幻灯片文本。这个例子在这里：

[http://www.brainline.org/multimedia/webreadyplayer](http://www.brainline.org/multimedia/webreadyplayer)

我想使用 FLVPlaybackCaptioning 组件显示图像。它从一个 XML 文件中提取到一个动态文本字段中，并选择了多行并启用了 HTML。所以它应该允许我在文本字段中显示图像。但是它不允许我使用 html 代码显示图像。我正在为 XML 字幕文件使用 DXFP 格式，而我正在查看的行是：

```
<p begin="00:00:36.00"><img src="http://www.brainline.org/multimedia/slide1.jpg"/></p> 
```

这将不允许加载图像。我尝试在我的机器上本地指定图像，在另一个域上以及几乎所有让它显示的东西。关于如何使用 FLVPlaybackCaptioning 组件显示图像的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T16:38:51.343

从我所读到的，它似乎只接受 xml 数据。如果您能够在视频播放时确定您在视频中的位置，您可能可以让侦听器进行检查，然后将其加载到占位符中。

我过去使用的另一个技巧是通过使用简单的图像 html 标记作为文本内容将图像加载到多行文本符号中。如果您可以动态填充该标记的 src= 部分，那么它可能会起作用，但 FLVPlaybackCaptioning 似乎不直接支持图像。

您可以使您的 xml 包含`<img src="captionimage.gif">`并将该 xml 加载到文本中，看看是否有效。

# .net - 检查（T的）集合中是否存在对象

> ID：398878
> 
> 赞同：1
> 
> 时间：2008-12-29T22:16:33.923
> 
> 标签：.net, linq, collections

我在这个问题上看到了[LINQy way to check if any objects in a collection has the same property value](https://stackoverflow.com/questions/312024/linqy-way-to-check-if-any-objects-in-a-collection-have-the-same-property-value)，有一个请求说如何使用 LINQ 来查看某个属性是否在集合中匹配。然而，这是最快的合理过程吗？我将部署一些需要一定数量的资源管理的东西，并且我希望应用程序能够尽可能地响应，而不会使代码在其他人或我稍后返回时非常难以破译。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T00:30:44.823

> 然而，这是最快的合理过程吗？

我猜想一种快速的方法（也许是最快的方法）可能是将所有对象添加到字典或哈希集中，使用属性作为关键字段：像 HashSet.Add 这样的方法有一个返回码告诉您是否已添加此属性值。例如：

```
static bool containsDuplicate(Container<Foo> fooCollection)
{
    //create the hash set
    HashSet<Bar> hashSet = new HashSet<Bar>();
    //for each object to be tested
    foreach (Foo foo in fooCollection)
    {
        //get the interesting object property
        Bar propertyValue = fooCollection.bar;
        //see whather we've already seen this property value
        if (!hashSet.Add(propertyValue))
        {
            //duplicate detected
            return true;
        }
    }
    //no duplicate detected
    return false;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T22:28:30.967

LINQ 几乎从来都不是做任何事情的最快方式（就原始执行时间而言）。

不过，它通常“足够快”。当您有一个带有单元测试的工作应用程序时，您可以对其进行分析以查看是否需要优化。

“我们应该忘记小的效率，比如大约 97% 的时间：过早的优化是万恶之源。” ——唐纳德·克努斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T23:30:36.833

事实上，LINQ 可以正常工作。当然，如果您知道可以在给定情况下优化情况，则始终可以为更具体的类型编写自己的 LINQ 扩展方法。由于类型**更**具体，因此应优先使用您自己的方法而不是默认方法`Enumerable`。哪个很好;-p

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T00:39:44.913

这实际上取决于您的集合中的数据量以及执行此操作的频率。Linq 按属性搜索将必须通读集合中的每个项目/属性。

如果您的集合中只有 10 个项目，并且此操作每秒只执行一次，那么仅向前扫描以通过属性查找项目很可能足够快。

如果您的集合中有 1000 万个项目，那么只需要转发或需要每秒执行 100 次此类操作，那么您可能需要对该属性进行一些索引。

如果事实证明您需要对此进行索引，我建议将此逻辑封装在一个对象中。因此，例如添加一个 Item 会将其添加到主集合中，并在排序的哈希集中添加一个属性索引器。

# database - 在开发新系统时 - 是否应该始终与利益相关者讨论数据库模式？

> ID：398881
> 
> 赞同：2
> 
> 时间：2008-12-29T22:17:48.367
> 
> 标签：database, database-design, project-management, database-administration

我比我将要描述的项目所涉及的人员高出几个层次/级别。

一般要求是基于 Web 的问题管理系统。该系统只是一个更大项目的一小部分。

领导 pm 有一个技术 pm，他应该处理项目的这一部分。领导下午问我，帮助信息不在请求帮助的上下文中是否正常。领导 pm 正在提供有关该站点的反馈，并希望提供模式对话框等错误消息，并希望我看一下。我在看系统，我在想……

*   在冷聚变中开发了一个新应用程序！？！？
*   该应用程序的数据验证**极差**
*   应用数据验证页面远离数据输入表单
*   应用程序帮助页面导航离开表单
*   开发人员和 pm 之间没有讨论 db 模式
*   未讨论 db 架构，因为它不存在
*   有一个菜单页面——也就是说，一旦你进入一个页面，你必须回到主菜单，然后进入你想要的下一页
*   领导 pm 不知道 dbms 是什么...
*   有一个技术 pm，她不知道什么是 dbms...
*   领导 pm 想解雇技术 pm 很长时间了，但技术 pm 受到保护……
*   领导 pm 建议在几个专有项目中存在所需的确切功能（其中几个是开源的 - bugtracker、bugzilla 等），但技术 pm 和开发人员不会听。

我有两个问题？

难道我

*   解雇开发人员？
*   解雇技术经理和保护她的人？
*   解雇铅下午？
*   为他们下载并配置 bugtracker/bugzilla，然后全部启动？
*   为他们下载并配置 bugtracker/bugzilla，然后去喝杯啤酒忘忧？

数据库模式不是在项目的早期就被讨论和严格考虑的标准操作程序吗？

编辑：

我曾经与各种技术知识（和智力）水平不同的客户一起工作。我总是与利益相关者讨论数据库模式。如果他们不知道什么是模式，我会教他们。如果他们没有理解的背景，我仍然会和他们讨论模式——即使他们没有意识到我们在谈论模式。在我直接参与的大多数项目中，数据是系统中最重要的部分。彻底散列模式/域模型对于更好地理解系统以及可以完成和报告的事情至关重要。我非常重视海报上关于 SO 的意见。有趣的是，我的方法不是通常的做法。

顺便说一句 - 可悲的是，该项目使用纳税人的资金，而 IT 部分是与一所著名大学的合作......开发和技术 pm 是长期员工 - 他们并不缺乏经验。当我知道聪明而勤奋的人失业而像这样的人有工作时，我感到特别难过。

当我年轻的时候，我会向上报告这种类型的无能，并期望采取适当的行动。既然我在链上，我发现自己不想微观管理其他人的责任。

我的决定是喝两杯啤酒，然后回到我的职责中......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T22:29:20.667

好的，首先要回答你的问题：不不，一千次不！用户不是您应该与之讨论数据库模式的人；一般来说，你最好和一头牛讨论微积分。就算他们有技术背景，下次需求变了怎么办？他们应该参与架构更新吗？

更一般地说，这听起来像是技术主管让问题与“客户”或利益相关者脱节的情况。如果您被要求实际*解决*问题，我建议您需要构建某种 GUI 原型，甚至可能只是一个故事板，然后逐步完成*。*然后你就会知道事情的发展方向。

**扩展**：是的，在项目中讨论数据库模式是正常的。我会说你确实需要认真考虑一些，嗯，与线索的主要咨询。

**扩展更多**：我理解你的意思，但问题是数据库模式是一个实现细节。我们已经习惯了数据库，以至于忘记了它，最终得到了看起来像数据库的应用程序。但是数据库并不是提供客户价值的东西。这是客户是否可以做他们想做的事情。如果您将客户查看应用程序的方式与数据库模式联系起来，那么您将它们与一种实现联系起来；更改，例如为了使系统更有效而对表格进行非规范化，成为您必须向客户展示的东西。最好向他们展示可观察的东西，并将这些细节留给我们自己。

但我怀疑我们也有术语冲突。我会同意你关于“域模型”的看法。如果通过 db 模式，您的意思是仅在用户的系统视图中可见的那些表和关系，如果您愿意，“用例”，那么我们会同意。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T16:37:34.217

应该与利益相关者讨论数据，绝对可以。DB SCHEMA 不应与利益相关者讨论，除非在特殊情况下，利益相关者都“精通数据库”。

那么如何在不讨论 DB Schema 的情况下讨论 DATA 呢？这是我发现的实体关系 (ER) 图和一般 ER 模型的主要用途。许多数据库设计人员倾向于将 ER 视为关系数据建模 (RDM) 的淡化版本。根据我的经验，如果您不认为它是淡化的 RDM，它可以更有利地使用它。

ER 和 RDM 之间有什么区别？在 RDM 中，多对多关系需要中间有一个接线盒。此接线盒包含将接线盒链接到多对多关系中的参与者的外键。

在 ER 中，当严格应用时，在多对多关系中不需要接线盒。您只需将关系表示为一条线，并在该线的两端指示“许多”的可能性。事实上，ER 图根本不需要外键。通过外键进行链接的概念可以排除在与大多数用户的讨论之外。

数据规范化与 ER 图表完全无关。一个构建良好的 ER 图将几乎没有有害的冗余，但这在很大程度上是偶然的，而不是仔细计划的结果。

面向涉众的 ER 图中的“实体”和“关系”应该只包括主题专家理解的实体，而不包括在逻辑数据库设计过程中添加的实体或关系。

保存在数据库中并按需提供的值可以连接到属性，而属性又可以连接到实体或实体之间的关系。此外，属性可以绑定到域，即每个属性可以采用的一组可能值。一些存储在数据库中的值，比如外键，应该被排除在与大多数利益相关者的讨论之外。

了解数据的利益相关者通常对这些概念有直观的把握，尽管“实体”、“关系”、“属性”和“领域”这些术语对他们来说可能并不熟悉。不了解主题数据的利益相关者需要特殊处理。

ER 模型和图表的美妙之处在于，它们不仅可以用来讨论数据库中的数据，还可以用来讨论数据以用户可以看到的形式出现。如果您有任何不了解表格和表格填写的利益相关者，我的建议是您尽量让他们远离计算机，如果仍然可能的话。

通过相当机械的过程，可以将构建良好的 ER 图转变为构建良好的关系模式。更具创造性的设计过程可能会产生逻辑上等效的“更好”模式。一些技术利益相关者需要了解关系模式，而不仅仅是 ER 图。不要向不需要知道关系模式的人展示关系模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T22:51:23.917

好吧，首先您可能应该非常仔细地审查技术 pm 和她的赞助商之间的关系。当你后来暗示你可以解雇保护者时，我很惊讶你说技术 pm 受到保护。要么她是，要么她没有受到保护。如果您可以解雇保护者，那么她就没有受到保护。

所以听起来没有人受到保护，更糟糕的是——没有人在交流。我建议如下：召集与领导 pm、技术 pm 和开发人员的会议。一旦在一起，轮流问每个人：“除了你的工作之外，不要引用任何东西（即你不能在这个练习期间责怪任何人），在 5 分钟或更短的时间内告诉我为什么我今天不应该解雇你”。

我意识到这是一个极端的建议，但你已经描述了一个经典问题的可怕解决方案。这个项目的每个方面以及由此产生的“代码”听起来都像是一场灾难。您可能应该在监督这个混乱中发挥更大的作用，但您没有（无论出于何种原因）。我意识到你应该期望在 PM 级别雇佣的专业人员做得比这更好。

因此，我建议对团队进行重大重组。一旦你把对失业的恐惧放在一张桌子上（我会告诉他们你正在为每个人写下沟通失败），然后要求他们发布立即改善沟通的计划以及解决混乱的详细时间表周末。

然后摆脱你自己的流浪汉，因为你现在是这个项目的 LEAD-lead PM。

如果他们在这场灾难中振作起来并卷土重来，然后慢慢地再次开始增加他们的责任。如果不是……总会有一扇门的。

干杯，

-R

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T22:39:33.377

> 领导 pm 建议在几个专有项目中存在所需的确切功能（其中几个是开源的 - bugtracker、bugzilla 等），但技术 pm 和开发人员不会听。

如果这是真的，请告诉领导 pm 更加自信；然后告诉他/她安装 bugzilla 并完成它。如果技术 pm 和开发人员因为固执而没有在听，他们需要聊一聊……

无论哪种方式，我都会说您的组织存在问题...由于“未在此处开发”的案例而损失了数千美元？但是，既然到了实现的地步，比开发层面更上游的问题……

至于与大家讨论数据库模式，我会说不。在收集到申请要求后，每个可以积极贡献的人都应该参与进来。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T22:41:52.030

哇，听起来像一场灾难。让我粗略地谈谈你的观点：

1.  首先，人们使用他们觉得舒服的语言进行开发。如果有人在存在更好的替代方案的情况下仍能适应旧环境，这肯定表明他们对获得技能没有兴趣。

2.  数据验证可以防止人们走得太远，却发现这是一条死胡同。缺乏验证意味着开发人员没有考虑用户。此外，它*不是*最后附加的东西......它根本不是那样工作的。

3.  网络“对话”不能是您所想的意义上的“模态”。但是，弹出一个附加窗口很容易。页面上的帮助应该几乎总是使用这种弹出窗口。

4.  数据验证永远不应该离开输入数据的页面——这是可怕的 UI 设计。

5.  数据库模式是您遇到的最少的问题。如果开发人员负责交付功能并且明显胜任数据模式设计，我认为与首席 PM 讨论模式的细微差别并不重要。它*应该*在各种代码级别的利益相关者之间进行讨论，并且它必须能够处理工作的需求。然而，从 PM 的角度来看，重要的不是模式，而是操作方面。当然，如果您对开发人员构建良好数据库模式的能力没有信心，那么所有的赌注都是错误的。

6.  如果您真的不知道 dbms 是什么，那么您可能会遇到严重的问题。你有标准吗？如果扩展项目中的其他人都在使用 MS SQL Server，而这个人选择了 Oracle，那么您如何将专业知识和员工转移到这个项目中或从这个项目中转移出来？这是组织失控的标志。

7.  忽略替代专有产品有两个原因。首先，它们可能无法真正满足您的需求。其次，技术 PM 和开发人员可能只是在为浪费您的资源而做一些令人讨厌的“不是这里发明”的理由。问题在于，在您的水平上，您不太可能有足够的洞察力来了解两者之间的区别。

8.  关于解雇开发人员……是否可以通过赞助一些额外的培训来帮助他？如果这个人在其他方面是一名优秀的员工并且非常了解您的业务，那么当只需要朝着正确的方向推动时，我会非常犹豫解雇他们。

9.  技术 PM 听起来她真的没有在做她的工作。她是指出我所写的缺陷并推动改进的合乎逻辑的人。就她的职位而言，真正的问题是，她能否学会更好地维护您的组织利益。

10.  首席 PM 听起来也太被动了。上面关于技术 PM 的评论也适用于此。

11.  如果 bugtracker 等真的有效，那么走这条路是有意义的。但是，您可能希望在解雇人员时更加谨慎。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T22:55:16.763

首先，我同意 Charlie Martin 关于数据库模式的看法。

第二，

听起来这个项目的开发人员非常环保——这是他/她的第一份编程工作吗？如果是这样，我只会在他们的简历说其他内容的情况下解雇开发人员。

我不知道领导/技术 pms 在项目中的参与程度如何，但听起来责任是 dev > tech pm > Lead pm。如果是这样的话，那么技术经理完全放弃了。您可能想找出为什么丢球并据此解雇/留住她，但是像这样的拙劣工作是我工作的谴责时间。

最后，恕我直言，“保护”的东西是废话——你需要根据他们的品质和价值来奖励和谴责人们，而不是他们的姑姑是谁。

祝你好运！干杯!

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T23:13:08.613

哇。我感觉到你的痛苦。

在我看来，问题的第一个来源似乎是“受保护”的 techPM。她为什么受到保护？由谁保护？我曾经在一个项目中，首席执行官的秘书首先成为业务分析师，然后（在他辞职后）成为项目经理，因为他们有外遇。她不知道我们用什么语言编程，并认为要求是浪费时间。由于她受到组织中最高级别的人的保护，唯一真正的解决方案是另谋高就。

你似乎认为你可以解雇她和她的保护者，所以可能是比你低但高于首席 PM 的人，所以他对此无能为力，但你可以？是的，你应该解雇他们两个。

主要 PM 可能会或可能不会被挽救，这取决于保护者是谁。他本可以处于困境和困境之间，他知道该怎么做，但由于技术 pm 和她的保护者之间关系的性质，无法对她和向她报告的人施加任何影响。有一次，我的两个老板和我的一个下属有染，这造成了各种组织破坏（这就是为什么保护者和技术 PM 都必须被解雇的原因）。让他从怀疑中受益，并与他讨论如果技术 pm 和她的保护者不在，他将如何以不同的方式处理事情。如果你喜欢你听到的，你可以留住他，但从组织上讲，你需要介入并确保清楚这个人是负责人，不允许任何人忽视他。一旦领导失去了权威，他只能在管理层的大力支持下才能恢复。

我还将与领导和开发人员坐下来，并准确解释项目目前的情况是什么是不可接受的。如果开发人员觉得无法从领导那里获得指导（假设您决定留住他），或者无法适应新的业务方式，或者无法理解为什么现在的代码不可接受，请减少损失并摆脱他也是。如果一个新人无论如何都可以挽救，那么他可能会更好地为领导工作，因为他不会有无视他的历史。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T23:33:40.757

我不一定认为数据库模式应该始终与利益相关者共享。大多数人不知道如何处理这类信息。如果您试图确保产品符合要求，则应预先清楚地列出要求并在整个项目开发过程中进行验证。

如果您在开发方面遇到问题，那只是课程的标准。应该找到更值得信赖的人。如果你雇佣了一个糟糕的程序员，那是你的错误。

有几种可能的解决方案：

*   获得更好的编码器。他会讨厌处理所有糟糕的代码，但希望他能坚持到完成为止。希望你愿意付给他很多钱。
*   保留编码器并让他解决所有问题。聘请一位可以更好地管理他的新 PM。那个编码员最了解他的代码，他可能需要更少的时间来改进它。从长远来看，你最好不要在工资单上保留一个糟糕的编码员，所以当你完成后就失去他。
*   接受它，为参与其中的每个人买一杯啤酒，然后从开源重新开始。您可能仍然需要技术 PM 来管理软件。那时你还必须忘记做任何定制的事情。也许承包商可以解决这个问题。

无论哪种方式，你都会损失一些钱。下次可能应该密切关注事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-29T23:45:03.777

我倾向于这样想。数据库模式用于支持应用程序的数据存储要求。应用程序需要存储哪些数据将取决于最终用户的需求。如果您没有向最终用户咨询他们对应用程序的要求，那么您显然会遇到麻烦，但是如果您能够很好地处理他们的要求（以及可能的未来要求），那么数据库模式是一个技术决策，可以由项目团队在没有最终用户/客户直接输入的情况下制作。

最终用户不太可能理解表、字段、规范化等的复杂性，但他们会理解“系统需要做 xyz”。以最终用户理解的语言与他们交谈，让您的团队做出适当的技术决策。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-30T17:19:45.893

我最大的问题是关于首席 pm 和技术 pm 保护者之间的关系：首席 pm 是否有充分的理由害怕保护者的报复？完全有可能他觉得自己什么都做不了，直到情况变得糟糕到这对保护者之上的人来说显然很重要。在这种情况下，他不应该受到任何更严厉的对待。

技术 pm 显然不胜任她的工作，她的保护者更感兴趣的是支持她而不是完成工作。这向我表明，他们需要以某种方式处理，至少要谈论完成实际工作的重要性，最大限度地解雇他们两个。

鉴于您所概述的气候，开发人员可能会蹲下来，试图在政治上生存。我对开发人员的了解不够多，无法提供任何建议。

所以，如果你的描述和我惊人的通灵能力给了我一个清晰准确的画面：

保护领导 pm 免受报复，并告诉他放弃所有的垃圾并实施现成的解决方案。（如果他自己不能可靠地选择一个，他不应该成为领导。）

管教技术 pm 和她的保护者。您真的不希望人们以这种方式破坏企业生产力。

开发是领导 pm 的责任。就这样吧。不要进行过多的微观管理。喝几杯啤酒。回到你平常的工作。

# exception - InvalidCastException：RPC_E_CANTCALLOUT_ININPUTSYNCCALL

> ID：398882
> 
> 赞同：1
> 
> 时间：2008-12-29T22:17:59.053
> 
> 标签：exception, com

我正在用 C# 构建一个应用程序，该应用程序具有一个静态类，该类启动一个 COM 类并处理另一个挂钩键盘的类的一些事件处理程序。当我从 WPF 窗口中的按钮事件处理程序调用 COM 类的方法时，该方法可以正常工作，但是当我在静态类中的一个事件回调中调用它时，它会引发以下异常：

> 无法将类型为“BLAHBLAH”的 COM 对象转换为接口类型“BLAHBLAH”。此操作失败，因为 IID 为“{9DD6680B-3EDC-40DB-A771-E6FE4832E34A}”的接口的 COM 组件上的 QueryInterface 调用因以下错误而失败：无法进行传出调用，因为应用程序正在调度输入-同步调用。（来自 HRESULT 的异常：0x8001010D (RPC_E_CANTCALLOUT_ININPUTSYNCCALL)）。

你能告诉我，这个异常是什么意思，我该如何解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2015-04-10T07:09:47.063

将您的代码包装在一个新线程中：

```
Thread thread = new Thread(() =>
{
    ManagementObjectSearcher theSearcher = new ManagementObjectSearcher("SELECT * FROM Win32_DiskDrive");
    foreach (ManagementObject currentObject in theSearcher.Get())
    {
        Debug.WriteLine("Device present: " + currentObject);          
        ManagementObject theSerialNumberObjectQuery = new ManagementObject("Win32_PhysicalMedia.Tag='" + currentObject["DeviceID"] + "'");
        serial = theSerialNumberObjectQuery["SerialNumber"].ToString();
    }
});
thread.Start();
thread.Join(); //wait for the thread to finish 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T16:08:43.517

请参阅此 KB [http://support.microsoft.com/kb/198996](http://support.microsoft.com/kb/198996) 看起来是因为线程（可能不是用户定义的线程）

# c++ - 如何使用 memset 将指向内存的指针设置为 NULL？

> ID：398883
> 
> 赞同：5
> 
> 时间：2008-12-29T22:18:10.893
> 
> 标签：c++, null, pointers, memset

我有一个结构

```
typedef struct my_s {

   int x;
   ...
} my_T;

my_t * p_my_t; 
```

我想设置 to 的地址，`p_my_t`到目前为止`NULL`，这就是我尝试这样做的方式：

```
memset (&p_my_t, 0, sizeof(my_t*)) 
```

不过，这对我来说并不合适。这样做的正确方法是什么？

* * *

*修改问题 - 提出一个更复杂的问题*：

这是我正在尝试做的事情：

*   两个进程，A 和 B
*   A、B中的malloc p_my_t有N个线程，可以访问
*   开始在 A 中删除，但我不能简单地释放它，因为 B 中的线程可能仍在使用它。
*   所以我调用了一个函数，将 p_my_t 的地址传递给 B 以在 B 中将其地址设置为 NULL，这样 B 中的其他线程就不能再使用了
*   从 B 回调后，我在 A 中释放内存

*注意：没有标准的方法可以通过进程之间的共享内存来管理内存分配。您将不得不对正在发生的事情做一些相当仔细的思考。*

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-29T22:22:25.753

不要`memset`用于初始化空指针，因为这会将内存设置为所有位为零，这不能保证是空指针的表示，只需执行以下操作：

```
p_my_t = NULL; 
```

或等价物：

```
p_my_t = 0; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-29T22:22:48.857

你到底想做什么？ `p_my_t`已经是一个指针，但你还没有为它分配内存。如果要将指针设置为 NULL，只需执行

```
p_my_t = NULL; 
```

尝试取消引用此指针将导致分段错误（或 Windows 上的访问冲突）。

一旦指针实际指向某物（例如，通过`malloc()`或通过为其分配 a 的地址`struct my_T`），那么您可以正确地使用`memset()`它：

```
memset(p_my_t, 0, sizeof(struct my_T)); 
```

这会将整个结构清零，将所有字段设置为零。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T23:02:13.380

将指针设置为*null*的推荐代码是分配 0（零）。Bjarne Stroustrup[做到](http://www.research.att.com/~bs/bs_faq2.html#null)了 :) 无论如何，它与 NULL 一样具有表现力，并且不依赖于宏定义。

请注意，NULL 不是关键字，它不是保留的，虽然重新定义会令人困惑，但没有什么说你不应该（除了风格）。一位同事经常开玩笑说在某些标头中将 NULL 定义为不同于 0 的东西，只是为了看看其他人的代码如何表现。

在即将发布的标准中，将有一个更具表现力的*nullptr*关键字来标识空指针。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T02:56:05.747

我想也许你想要

```
extern void set_t_pointer_to_null(my_T *pp); 
```

并打电话

```
set_t_pointer_to_null(&p_my_t); 
```

在哪里

```
void set_t_pointer_to_null(my_T *pp) { *pp = NULL; } 
```

我不确定是否值得定义一个函数来执行此操作，但我认为这回答了您要问的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T10:50:22.933

如果我做对了，memset 将无法解决您的问题。如果 A 和 B 是单独的进程，那么`p_my_t`在进程 A 中，进程 B 中的形式将是不同`p_my_t`的。您只是不能在不同进程之间传递指针。我建议您使用某种 IPC 机制来同步您的两个进程（例如消息队列），并且只使用`p_my_t = NULL`而不是 memset。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T22:39:09.417

谢谢，这是我想要做的

*   两个进程，A 和 B
*   A、B中的malloc p_my_t有N个线程，可以访问
*   开始在 A 中删除，但我不能简单地释放它，因为 B 中的线程可能仍在使用。
*   所以我调用了一个函数，将 p_my_t 的地址传递给 B 以在 B 中将其地址设置为 NULL，这样 B 中的其他线程就不能再使用了
*   从 B 回调后，我在 A 中释放内存

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T22:48:50.067

根据您的回复（在这篇文章的其他地方）说明：

> 谢谢，这是我想要做的
> 
> *   两个进程，A 和 B
> *   A、B中的malloc`p_my_t`有N个线程，可以访问
> *   开始在 A 中删除，但我不能简单地释放它，因为 B 中的线程可能仍在使用。
> *   所以我调用一个函数，将地址传递`p_my_t`给 B 以在 B 中将其地址设置为 NULL ，这样 B 中的其他线程就不能再使用了
> *   从 B 回调后，我在 A 中释放内存

您需要的是所有线程和进程之间的某种形式的同步。我不确定您如何在进程之间共享此对象，但我怀疑您正在使用共享内存。

通常我会推荐使用共享指针类（例如 Boost 的`shared_ptr`类），但我不确定它在这种情况下的效果如何。您可能需要考虑调整您的类，以便它跟踪自己的引用并可以与 Boost`intrusive_ptr`类一起使用。

这样，进程 A 可以简单地忘记该对象，当进程 B 完成时，实例`my_T`将知道没有更多的引用，并自行清理。

当在内部添加或删除引用时，同步将在这里发挥作用`my_T`（因此您不会遇到令人讨厌的竞争条件，它认为它应该自行清理但实际上仍在使用中）。

另一种具有更多“kluge”感觉的方法是给每个实例`my_T`一个“is-valid”标志，以便所有使用它的进程/线程都知道是否继续这样做。

有关 Boost 各种指针类的更多详细信息，请查看[他们的文档](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/smart_ptr.htm)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T18:43:36.473

根据您的更新，在我看来，您真正想做的是保护对资源的访问，这意味着您应该使用进程之间共享的读/写锁来保护该资源的 ptr，并测试ptr 使用前。

*   在共享内存中分配结构。
*   将 ptr 分配给共享内存中的结构。
*   使用读/写锁保护对结构的 ptr 的访问。
*   进程 A 在初始化或使 ptr 和结构无效时应获取对 ptr 的 WRITE 锁。
*   进程 B 应该获取对 ptr 的 READ 锁，并在使用结构之前测试 ptr 是否有效

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T03:44:54.027

通过阅读您的多线程评论，我应该说*没有*安全的代码序列来完成您的任务。您将不得不退后一步重新检查您的算法。

# sql - PostgreSQL 哈希索引

> ID：398884
> 
> 赞同：29
> 
> 时间：2008-12-29T22:18:46.710
> 
> 标签：sql, postgresql, indexing, database

有谁知道应该使用 PostgreSQL HASH 而不是 B-TREE 的情况，因为在我看来这些东西是一个陷阱。与 B-TREE 相比，它们需要更多时间来创建或维护（至少多 10 倍），它们还占用更多空间（对于我的一个 table.columns，B-TREE 占用 240 MB，而 HASH 会占用 4 GB），我似乎从我的谷歌搜索中了解到，它们的 SELECT 速度并不比 B-TREE 快；然而 HASH 可能最近已经优化或者谷歌是错误的。

无论如何，我想要你的意见和经验。如果这些 HASH 是邪恶的，人们应该知道。

也谢谢
：MySQL 的 HASH 怎么样？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-29T22:31:29.760

在您具有已知键值（尤其是已知唯一值）的情况下，哈希比 B 树更快。

*如果所讨论的列从不*打算使用`<`或`>`命令进行比较扫描，则应使用散列。

哈希是`O(1)`复杂性，B-Trees 是`O(log n)`复杂性（iirc），ergo，对于具有唯一条目的大型表，获取一个`ITEM="foo"`，它们将是查找它的最有效方式。

当这些唯一字段用于连接条件时，这尤其*实用。*

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-12-22T08:11:25.987

对于仅使用 = 运算符搜索的文本列，最好使用哈希索引。例如，需要为查找建立索引的 URL 列。

对于 URL 之类的东西，哈希索引大约是 B-Tree 索引大小的 30%。

减小的大小允许 PostgreSQL 更有效地使用它的缓存内存（也就是 shared_buffers）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-02-27T15:31:56.623

由于[http://www.postgresql.org/docs/9.2/static/sql-createindex.html](http://www.postgresql.org/docs/9.2/static/sql-createindex.html)点哈希索引仍然不是 WAL 安全的；这意味着它们对于崩溃不是 100% 可靠的（必须重建索引，并且在复制时可能会发生错误的响应）。还要检查[http://www.postgresql.org/docs/9.1/static/wal-intro.html](http://www.postgresql.org/docs/9.1/static/wal-intro.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-31T16:31:26.330

我没有尝试过，但正在考虑这种方法，在未记录的临时表上使用哈希索引。

我的理解是，它们构建速度更快，占用空间更少，查询速度略快于 b-tree。

根据[这个基准](http://www.depesz.com/2010/06/28/should-you-use-hash-index/)，散列索引比 BTree 索引要快一些，而且要小一些。但是，你不能用它们创建一个唯一的哈希索引——另外它们不是 WAL 记录的。

# shared-memory - 在 Linux 中使用 ipcrm 删除共享内存

> ID：398886
> 
> 赞同：22
> 
> 时间：2008-12-29T22:20:04.417
> 
> 标签：shared-memory, ipcs

我正在使用共享内存应用程序，并使用以下命令删除段：

```
 ipcrm -M 0x0000162e (this is the key) 
```

但我不知道我是否做对了，因为当我运行时，`ipcs`我看到相同的段，但密钥为 0x0000000。那么内存段真的被删除了吗？当我多次运行我的应用程序时，我会看到带有密钥 0x000000 的不同内存段，如下所示：

```
 key        shmid      owner      perms      bytes      nattch     status
 0x00000000 65538      me         666        27         2          dest 
 0x00000000 98307      me         666        5          2          dest 
 0x00000000 131076     me         666        5          1          dest
 0x00000000 163845     me         666        5          0 
```

实际发生了什么？内存段真的被删除了吗？

**编辑：**问题是 - 如下面接受的答案所述 - 有两个进程使用共享内存，直到所有进程都关闭，内存段不会消失。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-29T22:27:41.903

我模糊地记得在我的 UNIX（AIX 和 HPUX，我承认我从未在 Linux 中使用过共享内存）的日子里，删除只是将块标记为不再可被新客户端附加。

只有在没有更多进程附加到它之后，它才会在某个时候被物理删除。

这与删除的常规文件相同，它们的目录信息被删除，但文件的内容仅在最后一个进程关闭后才会消失。这有时会导致日志文件在文件系统上占用越来越多的空间，即使它们被删除，因为进程仍在写入它们，这是文件指针之间“分离”的结果（零个或多个目录条目指向到 inode）和文件内容（inode 本身）。

您可以从`ipcs`输出中看到 4 个中的 3 个仍然有附加的进程，因此在这些进程与共享内存块分离之前，它们不会去任何地方。另一个可能正在等待一些“扫描”功能来清理它，但这当然取决于共享内存的实现。

编写良好的共享内存客户端（或相关的日志文件）应定期重新附加（或翻转）以确保这种情况是暂时的并且不会影响软件的操作。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-29T22:52:22.307

您说您使用了以下命令

> `ipcrm -M 0x0000162e (this is the key)`

从 ipcrm 的手册页

> ```
>  -M shmkey
>          Mark the shared memory segment associated with key shmkey for
>          removal.  This marked segment will be destroyed after the
>          last detach. 
> ```

因此 -M 选项的行为与您观察到的完全一样，即仅在最后一次分离后才将段设置为销毁。

# c# - 使用 C# 插件扩展 C++ 应用程序

> ID：398888
> 
> 赞同：1
> 
> 时间：2008-12-29T22:20:44.447
> 
> 标签：c#, .net, c++, windows, plugins

我有一个 C++ Windows 应用程序，可以通过使用应用程序公开的 API 编写 C++ 插件来扩展它。还有一个插件可以将 C++ API 转换为 Python（例如，插件可以用 Python 编写）。

除了 C++ 和 Python，我想允许用户用 C# 编写插件。由于我对 .NET 世界不是很熟悉，所以我不确定如何实现 C# 插件系统。

对于这种插件系统，你会推荐使用什么（主机是 C++，插件是 C#）？为了实现这一目标，我需要学习什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T22:26:14.887

使用 COM 对象和接口公开您的 API，您将向许多开发环境开放您的应用程序，包括 C#。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T22:28:04.757

有几个之前的帖子可以帮助你：

*   [使用简单的 API 进行交互](https://stackoverflow.com/questions/285551/how-to-add-a-simple-api-to-my-c-application-for-access-by-labview#285574)
*   [通过 DLL 接口在 C++ 和 C# 之间进行通信](https://stackoverflow.com/questions/315051/using-a-class-defined-in-a-c-dll-in-c-code#315068)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T23:13:01.533

实际上以及COM的建议。如果您真的想添加第一类 .NET 插件支持，则可以托管您自己的 CLR 进程。这里有一篇关于它的非常有趣的文章。

[http://msdn.microsoft.com/en-us/magazine/cc163567.aspx](http://msdn.microsoft.com/en-us/magazine/cc163567.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T23:48:02.773

我过去以各种方式做到了这一点。我发现 C++/CLI 是在 .Net 和非托管 C++ 之间架起一座桥梁的最佳选择（不过，正如其他海报所指出的，COM 是另一种选择）。

我过去这样做的方法包括：

1.  使用反射从我的 C++ API 生成 C++/CLI API 包装器代码。当然，原生 C++ 没有反射系统，所以我们推出了自己的反射系统。然后将生成的 C++/CLI 代码编译成 C# 插件将引用的程序集。
2.  使用反射（即，使用 Reflection.Emit 的东西）从我的 C++ API 生成动态程序集。生成的程序集可以在进程内用于脚本语言，或者您甚至可以在运行时针对它编译 C# 代码。该程序集甚至可以写入磁盘以静态使用。这里的缺点是你可能无法发出比编译器更好的 IL，所以除非你需要动态生成，否则不要走这条路。
3.  手写 C++/CLI API 包装器。如果 API 不是很大，手动编写一个包装器就很容易了。

最后，您将拥有一个用于编译 C# 插件的程序集。现在您需要在运行时加载插件程序集。为此，您必须托管 CLR。

托管 CLR 并不困难，尽管我只做过一次，那是几年前的事了——也许时代已经改变了。如果您对托管 CLR 不满意，请尽可能将您的应用程序代码推送到 DLL 中，然后编写一个小型 C++/CLI 应用程序来显示您的非托管 UI。现在 CLR 由小型 C++/CLI 应用程序托管。

# .net - List (of T) 和 Collection(of T) 有什么区别？

> ID：398903
> 
> 赞同：103
> 
> 时间：2008-12-29T22:25:40.207
> 
> 标签：.net, list, collections

我已经看到它们以许多相同的方式使用，我担心如果我不更好地理解这一点，我将走上一条不可逆转的设计之路。另外，我正在使用.NET。

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2015-02-04T20:05:11.043

在 C# 中，表示一袋对象有三个概念。按功能递增的顺序，它们是：

*   **可枚举**- 无序、不可修改
*   **收藏**- 可以添加/删除项目
*   **列表**- 允许项目有顺序（按索引访问和删除）

**可枚举**没有顺序。您不能在集合中添加或删除项目。您甚至无法计算集合中的项目数。它严格允许您一个接一个地访问集合中的每个项目。

**集合**是一个可修改的集合。您可以从集合中添加和删除对象，还可以获取集合中项目的计数。但是仍然没有顺序，因为没有顺序：无法通过索引访问项目，也没有任何排序的方法。

**List**是一组有序的对象。您可以对列表进行排序、按索引访问项目、按索引删除项目。

事实上，在查看这些接口时，它们是相互构建的：

*   `interface IEnumerable<T>`

    *   `GetEnumeration<T>`
*   `interface ICollection<T> : IEnumerable<T>`

    *   `Add`
    *   `Remove`
    *   `Clear`
    *   `Count`
*   `interface IList<T> : ICollection<T>`

    *   `Insert`
    *   `IndexOf`
    *   `RemoveAt`

声明变量或方法参数时，应选择使用

*   IEnumerable
*   ICollection
*   列表

基于您在概念上需要对一组对象执行的操作。

如果您只需要能够对列表中的每个对象执行某些操作，那么您只需要`IEnumerable`：

```
void SaveEveryUser(IEnumerable<User> users)
{
    for User u in users
      ...
} 
```

您不在乎用户是否保存在`List<T>`,`Collection<T>`或`Array<T>`其他任何内容中。你只需要`IEnumerable<T>`接口。

如果您需要能够添加、删除或计算集合中的项目，请使用**Collection**：

```
ICollection<User> users = new Collection<User>();
users.Add(new User()); 
```

如果您关心排序顺序，并且需要正确的顺序，请使用**List**：

```
IList<User> users = FetchUsers(db); 
```

图表形式：

```
| Feature                | IEnumerable<T> | ICollection<T> | IList<T> |
|------------------------|----------------|----------------|----------|
| Enumerating items      | X              | X              | X        |
|                        |                |                |          |
| Adding items           |                | X              | X        |
| Removing items         |                | X              | X        |
| Count of items         |                | X              | X        |
|                        |                |                |          |
| Accessing by index     |                |                | X        |
| Removing by index      |                |                | X        |
| Getting index of item  |                |                | X        | 
```

`List<T>`和`Collection<T>`in`System.Collections.Generic`是实现这些接口的两个类；但它们不是唯一的类：

*   [`ConcurrentBag<T>`](https://msdn.microsoft.com/en-us/library/dd381779(v=vs.110).aspx)是一个有序的对象包 ( `IEnumerable<T>`)
*   [`LinkedList<T>`](https://msdn.microsoft.com/en-us/library/he2s3bh7(v=vs.110).aspx)是一个包，您不允许通过索引 ( `ICollection`) 访问项目；但您可以在集合中任意添加和删除项目
*   [`SynchronizedCollection<T>`](https://msdn.microsoft.com/en-us/library/ms668265(v=vs.110).aspx)是一个有序集合，您可以在其中按索引添加/删除项目

因此，您可以轻松更改：

```
IEnumerable<User> users = new SynchronizedCollection<User>();

SaveEveryUser(users); 
```

# tl;博士

*   **可枚举**- 访问项目，无序，不可修改
*   **集合**- 可以修改（添加、删除、计数）
*   **列表**- 可以按索引访问

选择你需要的*概念*，然后使用匹配的类。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-12-29T22:56:12.550

`Collection<T>`是一个可定制的包装器`IList<T>`。虽然`IList<T>`没有密封，但它不提供任何自定义点。`Collection<T>`的方法默认委托给标准`IList<T>`方法，但可以很容易地重写以执行您想要的操作。也可以在一个`Collection<T>`我不相信可以用 IList 完成的事件中连接事件。

简而言之，事后扩展它要容易得多，这可能意味着更少的重构。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-12-29T22:39:01.227

`List<T>`旨在供应用程序代码内部使用。您应该避免编写接受或返回的公共 API `List<T>`（考虑改用超类或集合接口）。

`Collection<T>`为自定义集合提供基类（尽管它可以直接使用）。

`Collection<T>`除非有`List<T>`您需要的特定功能，否则请考虑在您的代码中使用。

以上只是建议。

[改编自：框架设计指南，第二版]

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2008-12-29T23:27:10.363

`List<T>`是一个非常常见的容器，因为它非常通用（有很多方便的方法，如`Sort`,`Find`等） - 但是如果你想覆盖任何行为（例如检查插入时的项目），它没有扩展点。

`Collection<T>`是任何`IList<T>`（默认为`List<T>`）的包装器 - 它具有扩展点（`virtual`方法），但不像`Find`. 由于是间接的，它比 略慢`List<T>`，但不是很多。

使用 LINQ，额外的方法`List<T>`变得不那么重要了，因为 LINQ-to-Objects 倾向于提供它们......例如`First(pred)`，`OrderBy(...)`等。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-29T22:31:27.870

列表更快。

例如做

```
private void button1_Click(object sender, EventArgs e)
{
  Collection<long> c = new Collection<long>();
  Stopwatch s = new Stopwatch();
  s.Start();
  for (long i = 0; i <= 10000000; i++)
  {
    c.Add(i);
  }
  s.Stop();
  MessageBox.Show("collect " + s.ElapsedMilliseconds.ToString());

  List<long> l = new List<long>();
  Stopwatch s2 = new Stopwatch();
  s2.Start();
  for (long i = 0; i <= 10000000; i++)
  {
    l.Add(i);
  }
  s2.Stop();
  MessageBox.Show("lis " + s2.ElapsedMilliseconds.ToString());

} 
```

在我的机器`List<>`上几乎快两倍。

**编辑**

我不明白为什么人们不赞成这一点。在我的工作机器和家用机器上，List<> 代码都快了 80%。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-12-29T22:37:42.837

List 表示一个集合，其中项目的顺序很重要。它还支持排序和搜索方法。集合是一种更通用的数据结构，它对数据的假设更少，也支持更少的操作方法。如果您想公开自定义数据结构，您可能应该扩展集合。如果您需要在不暴露数据结构的情况下操作数据，列表可能是更方便的方法。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-08-06T16:03:51.177

所有这些接口都继承自`IEnumerable`，你应该确保你理解。该接口基本上允许您在 foreach 语句（在 C# 中）中使用该类。

*   `ICollection`是您列出的最基本的接口。它是一个支持 a 的可枚举接口，`Count`仅此而已。
*   `IList`就是一切`ICollection`，但它还支持添加和删除项目，按索引检索项目等。它是“对象列表”最常用的接口，我知道这是模糊的。
*   `IQueryable`是一个支持 LINQ 的可枚举接口。您始终可以`IQueryable`从 IList 创建一个并使用 LINQ to Objects，但您也可以发现`IQueryable`用于延迟执行 LINQ to SQL 和 LINQ to Entities 中的 SQL 语句。
*   `IDictionary`是一种不同的动物，因为它是唯一键到值的映射。它也是可枚举的，因为您可以枚举键/值对，但除此之外，它的用途与您列出的其他用途不同

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-29T22:37:59.043

这是研究生院的问题之一。T 的集合有点抽象；可能有默认实现（我不是 .net/c# 人），但集合将具有基本操作，如添加、删除、迭代等。

T 列表暗示了这些操作的一些细节：添加应该花费恒定时间，删除应该花费与元素数量成比例的时间，getfirst 应该是恒定时间。一般来说，List是一种Collection，但Collection不一定是一种List。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-29T22:45:47.123

[Hanselman Speaks](http://www.hanselman.com/blog/PermaLink.aspx?guid=4bfad15c-0e56-4902-a603-39afe094bfdf)：“`Collection<T>`看起来像一个列表，它甚至有一个`List<T>`内部。每一个方法都委托给内部`List<T>`。它包括一个受保护的属性，它暴露了`List<T>`.”

编辑： `Collection<T>`System.Generic.Collections .NET 3.5 中不存在。如果您从 .NET 2.0 迁移到 3.5，如果您使用大量`Collection<T>`对象，则需要更改一些代码，除非我遗漏了一些明显的东西......

编辑 2：`Collection<T>`现在位于 .NET 3.5 的 System.Collections.ObjectModel 命名空间中。帮助文件是这样说的：

“System.Collections.ObjectModel 命名空间包含可用作可重用库的对象模型中的集合的类。当属性或方法返回集合时使用这些类。”

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-11-07T08:25:31.497

根据 MSDN， List(Of T).Add 是“一个 O(n) 操作”（当超出“容量”时），而 Collection(Of T).Add*始终*是“一个 O(1) 操作”。如果 List 是使用 Array 和 Collection 一个 Linked List 实现的，那将是可以理解的。但是，如果是这种情况，人们会期望 Collection(Of T).Item 是“一个 O(n) 操作”。但是——这不是——*不是*！？！Collection(Of T).Item 是“一个 O(1) 操作”，就像 List(Of T).Item 一样。

最重要的是，上面的“tuinstoel”的“2008 年 12 月 29 日 22:31”帖子声称速度测试显示 List(Of T).Add 比 Collection(Of T).Add 快，我已经复制了长的和弦的。虽然我的速度只比他声称的 80% 快了 33%，但根据 MSDN，它应该是相反的“n”倍！？！

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-12-29T22:30:03.960

两者都实现相同的接口，因此它们的行为方式相同。也许它们在内部的实现方式不同，但这必须进行测试。

`Collection<T>`我看到的唯一真正的区别是名称空间和用标记的事实`ComVisibleAttribute(false)`，因此 COM 代码不能使用它。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-10-31T12:50:50.593

除了其他答案之外，我还编译了通用列表和集合功能的快速概述。集合是列表的有限子集：

```
* = 存在
o = 部分存在

属性/方法集合<T> 列表<T>
---------------------------------------------- Add()                *              *
AddRange()                          *
AsReadOnly()                        *
BinarySearch()                      *
Capacity                            *
Clear()              *              *
Contains()           *              *
ConvertAll()                        *
CopyTo()             o              *
Count                *              *
Equals()             *              *
Exists()                            *
Find()                              *
FindAll()                           *
FindIndex()                         *
FindLast()                          *
FindLastIndex()                     *
ForEach()                           *
GetEnumerator()      *              *
GetHashCode()        *              *
GetRange()                          *
GetType()            *              *
IndexOf()            o              *
Insert()             *              *
InsertRange()                       *
Item()               *              *
LastIndexOf()                       *
New()                o              *
ReferenceEquals()    *              *
Remove()             *              *
RemoveAll()                         *
RemoveAt()           *              *
RemoveRange()                       *
Reverse()                           *
Sort()                              *
ToArray()                           *
ToString()           *              *
TrimExcess()                        *
TrueForAll()                        * 
```

# windows - Windows 应用程序的最佳安装文件夹结构

> ID：398906
> 
> 赞同：4
> 
> 时间：2008-12-29T22:26:37.443
> 
> 标签：windows, installation

我使用 Wix 创建了一个安装包，它在用户的机器上安装了 Windows 服务。目前，这些文件正在安装到 [%ProgramFiles%\APLICATIONNAME]。

这是构建安装文件夹的未来证明方式吗？我应该安装到 [%ProgramFiles%\APLICATIONNAME\VERSION_NUMBER] 吗？

任何建议将不胜感激。

谢谢，

阿尼

* * *

**更新：**

不支持不同版本的并行安装。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T22:30:45.813

特定于版本的文件夹不好。您需要做的是确保所有后续安装程序都正确升级到以前的版本，以便不需要不同的文件夹。

如果您想允许并行安装不同版本，您可能需要使用主要和次要版本号来执行类似 ProgFiles\App 1.0 的操作。但是，所有这些最终应该取决于安装文件的最终用户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T23:59:24.527

作为附加说明，如果您将应用程序数据存储在 %AppData% 文件夹的注册表中，那么这些是使用版本化文件夹名称的合理位置，

例如。`%AppData%\Manufacturer\Application\1.0`和`HKCU\Manufacturer\Product\1.0`或任何东西。

我们将它与每个主要版本的文件夹一起使用，这样如果我们决定更改我们的注册表结构、修改数据文件格式等，我们只需要确保次要版本之间的兼容性。主要版本可以使用单独的过程来帮助用户从 2.x 版本迁移到 3.x 版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T19:34:29.147

如果不支持不同版本的并行安装，我认为 [%ProgramFiles%\APLICATIONNAME] 就足够了。但是我个人更喜欢 [%ProgramFiles%\COMPANYNAME\APLICATIONNAME]。

# php - 网络操作系统实用了吗？

> ID：398915
> 
> 赞同：3
> 
> 时间：2008-12-29T22:29:43.803
> 
> 标签：php, javascript, ajax, user-interface, web-operating-system

我是一名全职 Web 开发人员，但我的根基是桌面程序员，这些天似乎有很多关于 Web 操作系统的讨论。

将您的 Web 应用程序整合到 Web 操作系统中以使其对用户更加友好，或者只是做一个传统的 HTML 布局，是否可行？

我发现了一个看起来非常有趣的基于 Ext JS 和 PHP 的软件，它将我自己的 Web 应用程序整合到其中并让它们感觉更像一个桌面应用程序会很简单。

qWikiOffice - [http://qwikioffice.com/](http://qwikioffice.com/)

[http://glidertools.net/preferences.jpg](http://glidertools.net/preferences.jpg)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T22:38:44.410

请允许我第一个说“WebOS”有点用词不当。真正的意思是一个看起来和感觉像现代操作系统的网络“应用程序”，因为它有文件夹和其他小部件。

我认为对于某些事情，“webos”最终会变得实用，但就目前而言，通过 AJAX 结合传统桌面应用程序类型概念的“传统”html 布局是当前的实用水平。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T22:33:35.527

呃，你是说“实用”吗？还是“海盗”？

无论如何，是的，我认为它们对于特定类别的用户来说是实用的。对开发人员来说不是很好，对那些想要轻量级应用程序和阅读 RSS 和搜索/冲浪网络的人来说非常好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T22:39:58.977

尽管这个想法很酷，但它并不实用，因为世界上许多国家的互联网速度都很糟糕。我刚去过泰国，大多数地方的互联网速度都不够快，gmail 无法在 ajax 模式下工作。它可能会在西方国家发生。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T09:41:11.233

更多答案在这里：
[Web 桌面](https://stackoverflow.com/questions/398044/web-desktops-do-you-find-it-interesting)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T22:34:48.333

我还没有看到使用 WebOS 的令人信服的理由。我的浏览器有标签，我真的不介意在不同的标签中打开我的所有 Web 应用程序。我的操作系统主要用于文件操作，无论如何我都不想在 Web 浏览器中进行操作。

我认为这些只不过是人们在玩大量的 JavaScript。如果您要开发一个 Web 应用程序，为什么不制作它，以便大多数人都能够使用它（使其脱离特定的 WebOS）。

# merge - 如何选择附加到工作项的变更集进行合并？

> ID：398926
> 
> 赞同：2
> 
> 时间：2008-12-29T22:34:15.743
> 
> 标签：merge, branch, changeset, workitem

我有一组已完成的工作项，我准备将它们的更改移动到我们的生产分支。是否可以找到附加到它们的变更集并有选择地将它们与目标分支合并？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T06:39:06.623

简短的回答并不容易。

目前，工作项和代码提升之间没有真正的联系。您可以在签入时（或实际上在任何时候）将变更集与工作项相关联，但这只是目前的情况。

基本上，您必须使用 Visual Studio 中提供的 UI 手动执行此操作（即查找工作项，获取变更集 ID，然后通过选择适当的变更集范围进行（可能几个）合并。如果这是一种常规方式工作，然后您可以在 .NET 中编写一个程序，该程序使用[Microsoft TFS API](http://msdn.microsoft.com/en-us/library/bb130146.aspx)与工作项跟踪组件对话以获取所需的变更集，然后以编程方式进行合并或启动命令行客户端 ( [tf](http://msdn.microsoft.com/en-us/library/bd6dxhfy.aspx) ) 以启动适当的合并的 UI。

抱歉，这不是一个更有帮助的答案。我知道微软的团队现在已经听过这种情况几次了，但是我还没有听说过任何计划在当前或下一个 TFS 版本中更好地支持“开箱即用”。也就是说，TFS2010 中的分支广告合并内容有很多改进，因此可能会有/将会有一些东西对您有所帮助。如果此功能对您很重要，则可能值得您在[http://connect.microsoft.com/VisualStudio上记录一些反馈。](http://connect.microsoft.com/VisualStudio)

祝你好运，

马丁。

# php - 收集最小数算法

> ID：398945
> 
> 赞同：1
> 
> 时间：2008-12-29T22:39:54.000
> 
> 标签：php, algorithm

我正在寻找一种算法（或 PHP 代码，我想）以从一组数字中得到 10 个最低的数字。我正在考虑制作一个十项数组，检查当前数字是否小于数组中的一个数字，如果是，则找到数组中的最高数字并将其替换为当前数字。

但是，我计划从数千个中找到最低的 10 个数字，并且认为可能有更快的方法来做到这一点。我计划在 PHP 中实现它，所以任何原生 PHP 函数都可以使用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-29T22:43:25.320

对数组进行排序并使用十个第一个/最后一个条目。

老实说：对包含一千个条目的数组进行排序所花费的时间比眨眼所花费的时间要少。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-29T23:13:10.907

您正在寻找的是一种**选择算法**。关于该主题的 Wikipedia 页面在[选择*k*个最小或最大元素](http://en.wikipedia.org/wiki/Selection_algorithm#Selecting_k_smallest_or_largest_elements)部分中有几个小节。当列表足够大时，您可以*击败*天真的“对整个列表进行排序并选择前 10 个”算法所需的时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-29T22:47:09.323

天真的方法是对输入进行排序。它可能已经足够快了，所以在做任何更复杂的事情之前先试一试并分析它。

可能更快的方法：线性搜索输入，但保持输出数组排序，以便更容易确定下一个输入是否属于数组。伪代码：

```
output[0-9] = input[0-9];
sort(output);
for i=10..n-1
  if input[i] < output[9]
    insert(input[i]) 
```

其中 insert(x) 将找到正确的位置（二进制搜索）并进行适当的移位。

但说真的，请先尝试天真的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-29T22:46:55.627

你从哪里得到这组数字？

如果您的数字列表已经在一个数组中，您可以简单地执行[sort()](http://us.php.net/manual/en/function.sort.php)，然后执行[array_slice()](http://us.php.net/manual/en/function.array-slice.php)来获取前 10 个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T23:38:34.913

我对一个小数组并不重要，但随着它变大，提高处理速度的一种快速简便的方法是利用数组键索引，它适用于 1 铣床。行将使用大约 40% 的时间。例子：

```
// sorting array values

$numbers = array();
for($i = 0; $i < 1000000; ++$i)
{
    $numbers[$i] = rand(1, 999999);
}

$start = microtime(true);
sort($numbers);
$res = array_slice($numbers, 0, 10, true);
echo microtime(true) - $start . "\n";
// 2.6612658500671
print_r($res);

unset($numbers, $res, $start);

// sorting array keys

$numbers = array();
for($i = 0; $i < 1000000; ++$i)
{
    $numbers[rand(1, 999999)] = $i;
}

$start = microtime(true);
ksort($numbers);
$res = array_keys(array_slice($numbers, 0, 10, true));
echo microtime(true) - $start . "\n";
// 0.9651210308075
print_r($res); 
```

但是，如果数组数据来自数据库，最快的可能就是在那里对其进行排序：

```
SELECT number_column FROM table_with_numbers ORDER BY number_column LIMIT 10 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T00:19:12.163

创建一个排序集（Java 中的 TreeSet，我不了解 PHP），并添加前 10 个数字。现在迭代其余数字迭代所有数字，添加新数字，然后从集合中删除最大的数字。

如果 n >> 10，此算法是 O(n)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T00:30:09.457

我会使用一个有 10 个元素的[堆](http://en.wikipedia.org/wiki/Heap_%28data_structure%29)，并且在树的根部有最大的数字。然后从数字列表的开头开始：

*   如果堆中的元素少于 10 个：将数字添加到列表中
*   否则，如果数字小于堆中的最大数字，则移除堆中的最大数字，然后将当前数字添加到列表中
*   否则，忽略它。

你最终会得到堆中最小的 10 个数字。如果您使用数组作为堆数据结构，那么您可以直接使用数组。

（或者：您可以切出前 10 个元素，并将它们堆起来，而不是使用上面的第一步，这会稍微快一些）。

但是，正如其他人所指出的，对于 1000 个元素，只需对列表进行排序并取前 10 个元素。

# asp.net - 将 Cookie 用于 Web 会话状态 - 有哪些陷阱？

> ID：398948
> 
> 赞同：7
> 
> 时间：2008-12-29T22:41:39.910
> 
> 标签：asp.net, session, cookies, webserver, session-state

当涉及到扩展 Web 应用程序时，使用进程内会话状态是有害的（不能很好地与集群一起使用，当服务器回收时会爆炸）。

假设您只需要在会话状态中保留少量信息，那么为此目的使用加密的 cookie 项而不是特定状态服务器/数据库的缺点是什么？

显然，使用 cookie 会产生少量的网络开销，并且显然您是在客户端浏览器/移动设备上启用 cookie 的假设下操作的。

**您还可以看到哪些其他陷阱？**

**对于简单、可扩展和健壮的会话来说，这是一个不错的选择吗？**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-29T23:17:21.413

对于简单、可扩展和健壮的会话来说，这是一种极好的方法。当然，你的加密货币的质量很重要，这通常是一件很难做到的事情，但这是可以做到的。

我不同意其他一些海报：

可以针对加密的 cookie 值发起的任何重放攻击都可以针对存储为 cookie 的会话密钥发起。如果这很重要，请使用 https。

如果清除 cookie，存储在状态服务器或数据库中的会话数据也会丢失；当会话密钥丢失时，将无法再检索会话。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T23:02:11.523

另一个陷阱是它们可能被盗并在您的网站上重放。

顺便说一句：除了在 cookie 中存储一些东西之外，您还应该考虑在 cookie 中存储一个键并使用 memcached 之类的东西（memcached 跨服务器场工作）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T23:02:18.153

好吧，通常 cookie 用于会话 ID，因此只要信息量很小，将信息存储在 cookie 中就是一个不错的选择，尽管您不应该存储任何有价值的东西（如 CC 号码、SSN等）应该真正存储在 cookie 中，即使已加密。

我不是专家，但根据我的经验，我发现以下是正确的（至少使用 PHP 和 ASP.Net）。

**曲奇饼**

*   ***[pro] 可扩展性很好，因为它会在每个请求上传输***
*   [pro] Cookie 只能通过 SSL 连接提交
*   [pro] 可以使用跨服务器技术，和跨服务器机器
*   [con] 在每个请求和响应中传输数据
*   [con] 需要在浏览器上启用

**状态服务器/数据库**

*   ***[pro] 仅存储在服务器上的数据***
*   ***[pro] 即使用户清除 cookie，数据仍然存在***
*   [pro] 可以使用跨服务器技术
*   [con] 需要在请求/响应时传递一个 ID（因此需要 cookie 或附加到每个 URL）
*   [con] 在默认模式下不能很好地扩展，但如果整台机器可以专门和专门用于状态，那么这不是什么大问题。可以遵循许多其他扩展技术来实现可扩展性。
*   [con] 需要通过 URL 或 Cookie 或其他方式传递的会话 ID 变量，以使用户与数据保持联系。

# java - 在私有实用程序类构造函数中使用的首选 Throwable 是什么？

> ID：398953
> 
> 赞同：34
> 
> 时间：2008-12-29T22:44:10.577
> 
> 标签：java, coding-style, throwable

[Effective Java (Second Edition)](http://java.sun.com/docs/books/effective/)的第 4 条讨论了使用私有构造函数来强制执行不可实例化。这是书中的代码示例：

```
public final class UtilityClass {
    private UtilityClass() {
        throw new AssertionError();
    }
} 
```

然而，`AssertionError`这似乎不是正确的扔东西。没有任何东西被“断言”，这就是 API 定义[AssertionError](http://java.sun.com/javase/6/docs/api/java/lang/AssertionError.html)使用的方式。

`Throwable`在这种情况下通常有什么不同吗？一个人通常只是抛出一个`Exception`带有信息的将军吗？或者为此编写一个习惯是否很常见`Exception`？

这很简单，但我想我只是从风格和标准的角度对它感到好奇。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-12-29T22:46:27.483

有一个断言：“我断言这个构造函数永远不会被调用”。所以，确实，`AssertionError`这里是正确的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-30T17:26:29.250

我喜欢包括 Bloch 的评论：

```
// Suppress default constructor for noninstantiability 
```

或者更好的是把它放在错误中：

```
private UtilityClass()
{
    throw new AssertionError("Suppress default constructor for noninstantiability");
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-29T23:43:20.847

[UnsupportedOperationException](http://java.sun.com/javase/6/docs/api/java/lang/UnsupportedOperationException.html)听起来是最合适的，尽管检查异常会更好，因为它可能会警告某人在编译时错误地实例化了该类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-29T22:50:04.167

那么[IllegalAcessError](http://java.sun.com/javase/6/docs/api/java/lang/IllegalAccessError.html)呢？:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-29T23:30:02.747

不不不，非常尊重 Josh Bloch，*除非它来自断言，否则**永远不要抛出 an 。`AssertionError`* 如果你想要一个 AssertionError 这里，用`assert(false)`. 然后阅读代码的人可以稍后找到它。

更好的是，定义你自己的异常，比如说`CantInstantiateUtilityClass`。然后你会有代码说

```
try {
    // some stuff
} catch (CantInstantiateUtilityClass e) {
    // react
} 
```

以便捕手的读者知道发生了*什么*。

* * *

让我注意，标准*仍然*定义`AssertionError`为断言失败的结果，而不是一些初学者认为*应该*抛出的东西来代替定义明确的信息异常。可悲的是，良好的异常规则可能是 Java 编程中最不鼓励的技能。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-07-15T14:15:57.783

当代码需要包含 JUnit 作为依赖项时，例如在 maven 测试范围内`<scope>test</scope>`，那么直接进入`Assertion.fail()`方法并从清晰度的显着改进中受益。

```
public final class UtilityClass {
    private UtilityClass() {
        fail("The UtilityClass methods should be accessed statically");
    }
} 
```

当超出测试范围时，您可以使用类似以下的内容，这需要像上面一样使用静态导入。 `import static pkg.Error.fail;`

```
public class Error {
    private static final Logger LOG = LoggerFactory.getLogger(Error.class);
    public static void fail(final String message) {
        LOG.error(message);
        throw new AssertionError(message);
        // or use your preferred exception 
        // e.g InstantiationException
    }
} 
```

其中以下用法。

```
public class UtilityClassTwo {
    private UtilityClassTwo() {
        Error.fail("The UtilityClass methods should be accessed statically");
    }
} 
```

以其最惯用的形式，它们都归结为：

```
public class UtilityClassThree {
    private UtilityClassThree() {
        assert false : "The UtilityClass methods should be accessed statically";
    }
} 
```

可以抛出内置异常之一 UnsupportedOperationException 以指示“不支持请求的操作”。

```
 private Constructor() {
    throw new UnsupportedOperationException(
            "Do not instantiate this class, use statically.");
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-29T22:48:00.507

断断续续的断言意味着您破坏了代码的合同规范。所以这是正确的事情。

但是，我假设您将私下实例化一个实例，它也会调用构造函数并导致错误——除非您有另一个构造函数？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-01-24T19:54:10.400

您可以创建自己的扩展类`Throwable`，例如：

```
class NoninstantiabilityError extends Throwable 
```

这具有以下优点：

*   名字就说明问题
*   因为它直接延伸`Throwable`所以不太可能被意外抓住
*   因为它直接扩展`Throwable`它被检查并且意外调用相应的构造函数需要捕获异常

使用示例：

```
public final class UtilityClass {
    private UtilityClass() throws NoninstantiabilityError {
        throw new NoninstantiabilityError();
    }

    ...
} 
```

# html - 任何视频微格式

> ID：398956
> 
> 赞同：2
> 
> 时间：2008-12-29T22:45:13.990
> 
> 标签：html, video, microformats

是否有人为视频和视频叠加创建了 HTML 微格式，包括：

*   视频文件
*   与时间码（开始/结束）和屏幕区域的链接

谢谢，

迈克尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T12:53:46.053

MF wiki上有几个[例子](http://microformats.org/wiki/video-info-examples)——它们有帮助吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T00:35:35.580

以下是我发现最适合我需求的内容： [Apple 的 Final Cut Pro XML 格式](http://developer.apple.com/referencelibrary/AppleApplications/idxFinalCutProFinalCutExpress-date.html)。

# .net - null 在 .NET 中如何表示

> ID：398966
> 
> 赞同：6
> 
> 时间：2008-12-29T22:47:44.220
> 
> 标签：.net, memory, null

我正在与一位同事交谈，并且出现了 null 的主题。他告诉我，在幕后的 .NET 中，这只是一个非常小的数字。我一直认为该对象只是没有指向堆上任何内存的指针，但我不确定哪种方式。

所以我希望社区可以为我们清理它;P

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-29T22:51:53.883

是 0。

从 ECMA-335 规范中的 ldnull 截取：

> 可能会认为 ldnull 是多余的：为什么不改用 ldc.i4.0 或 ldc.i8.0 呢？答案是 ldnull 提供了一个与大小无关的 null - 类似于不存在的 ldc.i 指令。但是，即使 CIL 包含 ldc.i 指令，保留 ldnull 指令仍然有利于验证算法，因为它使类型跟踪更容易。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-30T00:01:11.700

当可空类型实例设置为空时，其基础值为零。

更具体地说，可空类型是将基础类型的值与布尔空指示符组合在一起的结构。可空类型的实例具有两个公共只读属性：bool 类型的**HasValue和可空类型的基础类型的****Value**。

**HasValue**对于非空实例为真，对于空实例为假。

因此，当**HasValue**为 true 时，**Value**属性返回包含的值。当**HasValue**为 false 时，访问 Value 属性的尝试会引发异常。但是，如果您可以访问它，您会发现它包含零。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T22:49:38.693

根据我的经验，我相信`Nothing`会奏效，也会如此`DBNull.Value`

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-29T23:15:53.773

来自[MSDN](http://msdn.microsoft.com/en-us/library/edakx9da.aspx)：

> null 关键字是表示空引用的文字，它不引用任何对象

为了尝试在旧版本的 c# 中使其更清晰一点，值类型不能为空，即它必须有一个值，如果你没有分配一个值，你会得到一个潜在的随机值，比如：

```
int i;
i++;
console.writeline(i); 
```

在旧版本的 c# 中，对象必须被初始化，否则它们为空，这意味着它们没有对任何对象的引用。

现在在 c# 2.0+ 中使用可为空的值类型，您可以拥有一个可为空的 int，这意味着如果您有以下代码：

```
int? i;
i++;
console.writeline(i); 
```

实际上，您将在 i++ 处遇到异常，因为 i 从未被初始化为 null 以外的任何内容。如果 null 为 0，则此代码将正常执行，因为它只会计算为 0+1，但这是不正确的行为。

如果 null 始终为 0，并且您有一个可为空的 int，并且您编写了一些代码，例如：

```
int? i;
if (int == 0)
{
//do something
} 
```

如果 null 与 0 相同，则很有可能会出现一些意外行为，因为编译器无法区分 int 为 null 和 int 显式设置为 0。

另一个澄清我脑海中事情的例子：

```
public int? AddNumbers(int? x, int? y)
{
    if (x == null || y == null)
        return null;
    if (x == 0)
        return y;
    if (y == 0)
        return x;

    return x + y;
} 
```

在这个例子中，很明显 null 和 0 是非常不同的，因为如果你为 x 或 y 传入 0，并且 null 等于 0，那么上面的代码将永远无法检查 x == 0 或 y == 0，但是如果您运行代码并为 x 或 y 传递 0，则检查确实会执行。

# c# - foreach 循环如何在 C# 中工作？

> ID：398982
> 
> 赞同：86
> 
> 时间：2008-12-29T22:52:46.707
> 
> 标签：c#, foreach

哪些类型的类可以使用`foreach`循环？

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2008-12-29T23:01:43.240

实际上，**严格**来说，您需要使用`foreach`的只是一个公共`GetEnumerator()`方法，它返回带有`bool MoveNext()`方法和`? Current {get;}`属性的东西。但是，最**常见**的含义是“实现`IEnumerable`/`IEnumerable<T>`的东西，返回`IEnumerator`/ `IEnumerator<T>`。

暗示，这包括任何实现`ICollection`/`ICollection<T>`的东西，例如像`Collection<T>`, `List<T>`, 数组 ( `T[]`) 等任何东西。所以任何标准的“数据收集”通常都会支持`foreach`.

为了证明第一点，以下工作很好：

```
using System;
class Foo {
    public int Current { get; private set; }
    private int step;
    public bool MoveNext() {
        if (step >= 5) return false;
        Current = step++;
        return true;
    }
}
class Bar {
    public Foo GetEnumerator() { return new Foo(); }
}
static class Program {
    static void Main() {
        Bar bar = new Bar();
        foreach (int item in bar) {
            Console.WriteLine(item);
        }
    }
} 
```

**它是如何工作的？**

类似的 foreach 循环`foreach(int i in obj) {...}`相当于：

```
var tmp = obj.GetEnumerator();
int i; // up to C# 4.0
while(tmp.MoveNext()) {
    int i; // C# 5.0
    i = tmp.Current;
    {...} // your code
} 
```

但是，也有变化。例如，如果枚举器 (tmp) 支持`IDisposable`，则也使用它（类似于`using`）。

**请注意声明“ `int i`”在循环*内部*（C# 5.0）与*外部*（向上 C#4.0）放置**的区别。**如果您`i`在代码块中使用匿名方法/lambda，这一点很重要。但那是另一个故事；-p**

 *** * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-29T22:55:11.770

来自[MSDN](http://msdn.microsoft.com/en-us/library/ttw7t8t6(VS.80).aspx)：

> 该语句为**数组或对象集合**`foreach`中的每个元素重复一组嵌入语句。该语句用于遍历集合以获取所需的信息，但不应用于更改集合的内容以避免不可预知的副作用。（强调我的）**`foreach`**

 **所以，如果你有一个数组，你可以使用 foreach 语句来遍历数组，像这样：

```
 int[] fibarray = new int[] { 0, 1, 2, 3, 5, 8, 13 };
    foreach (int i in fibarray)
    {
        System.Console.WriteLine(i);
    } 
```

您还可以使用它来遍历`List<T>`集合，如下所示：

```
List<string> list = new List<string>();

foreach (string item in list)
{
    Console.WriteLine(item);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-29T23:12:54.857

根据博客文章*[Duck Notation](https://docs.microsoft.com/en-us/archive/blogs/kcwalina/duck-notation)*，使用了鸭子类型。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-29T23:24:50.307

这是文档： [主要文章使用](http://msdn.microsoft.com/en-us/library/ttw7t8t6(VS.71).aspx) [带有集合对象的](http://msdn.microsoft.com/en-us/library/aa288257(VS.71).aspx)[数组](http://msdn.microsoft.com/en-us/library/aa288254(VS.71).aspx)

需要注意的是“集合元素的类型必须可转换为标识符类型”。这有时无法在编译时检查，如果实例类型不可分配给引用类型，则可能会生成运行时异常。

如果水果篮里有非苹果，例如橙子，这将产生运行时异常。

```
List<Fruit> fruitBasket = new List<Fruit>() { new Apple(), new Orange() };
foreach(Apple a in fruitBasket) 
```

这可以安全地将列表过滤为仅使用[Enumerable.OfType的 Apple](http://msdn.microsoft.com/en-us/library/bb360913.aspx)

```
foreach(Apple a in fruitBasket.OfType<Apple>() ) 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-03-17T10:40:18.810

```
IList<ListItem> illi = new List<ListItem>();
ListItem li = null;

foreach (HroCategory value in listddlsubcategory)
{
    listddlsubcategoryext = server.getObjectListByColumn(typeof(HroCategory), "Parentid", value.Id);
    li = new ListItem();
    li.Text = value.Description;
    li.Value = value.Id.ToString();
    illi.Add(li);
    IList<ListItem> newilli = new List<ListItem>();
    newilli = SubCatagoryFunction(listddlsubcategoryext, "-->");
    foreach (ListItem c in newilli)
    {
        illi.Add(c);
    }
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2018-04-24T14:20:58.230

也可以在[MSDN](https://docs.microsoft.com/en-us/dotnet/csharp/iterators)上找到有关此主题的有用信息。从那篇文章中汲取精华：

foreach 关键字枚举一个集合，为集合中的每个元素执行一次嵌入语句：

```
foreach (var item in collection)
{
    Console.WriteLine(item.ToString());
} 
```

编译器将上面示例中显示的 foreach 循环转换为类似于此构造的内容：

```
IEnumerator<int> enumerator = collection.GetEnumerator();
while (enumerator.MoveNext())
{
    var item = enumerator.Current;
    Console.WriteLine(item.ToString());
} 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2018-03-31T07:18:28.670

你可以试试这个...

```
List<int> numbers = new List<int>();
        numbers.Add(5);
        numbers.Add(15);
        numbers.Add(25);
        numbers.Add(35);

        Console.WriteLine("You are added total number: {0}",numbers.Count);
        foreach (int number in numbers)
        {
            Console.WriteLine("Your adding Number are: {0}", number);
        } 
```

# java - 需要更简单的 Java/SQL 数据传输

> ID：398992
> 
> 赞同：4
> 
> 时间：2008-12-29T22:59:30.840
> 
> 标签：java, sql, jdbc

所以，我正在使用 jdbc 与 MySQL 数据库通信。对于许多表和许多查询/视图，我创建了一个类，它封装了表的一行或查询/表结果。对数据库的访问会返回此类的一个对象（当我确切知道只有一个匹配行时）或此类对象的向量。

每个类都有一个工厂方法，它从 ResultSet 的一行构建一个对象。需要很多 ResultSet.getXXX() 方法，以及关于哪个值在哪个列中的繁琐记账，尤其是在更改表/查询/视图布局之后。

创建和维护这些对象是一项无聊、工作密集且令人麻木的任务。换句话说，由工具完成的任务。它应该读取 SQL（MySQL 变体，唉）并生成 Java 代码。或者，至少，给我一个表/查询/视图的表示（XML？DOM？），让我自己进行 java 代码生成。

你能说出这个工具的名字吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T23:03:28.477

我对你的问题有点困惑。为什么不使用像 Hibernate 这样的对象关系映射框架？

我曾经遇到过同样的问题，必须直接读写大量 SQL。最终，我开始使用 Hibernate 编写更新的项目并且没有回头。系统负责我构建实际表并在后台运行 SQL，我主要可以使用 java 对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T01:40:37.647

如果您正在寻找一个简单的框架来帮助编写 sql 的繁重工作，我会推荐[ibatis sql maps](http://ibatis.apache.org/)。这个框架基本上完全符合您的要求。

Hibernate 也是一个不错的选择，但对于像您这样的简单问题，它似乎有点过大。

您还可以查看[spring 框架](http://springframework.org)。这旨在为编写 java 应用程序创建一个简单的环境，并且还具有非常有用的 sql 抽象。但是要小心 spring，你可能会开始喜欢这个框架，并在它上面度过了太多的快乐时光 8)

至于你对反思的关注。Java 在反射的性能开销方面不再存在重大问题（至少从 1.4 版和 O/R 映射工具开始）。

根据我的经验，最好关心编写良好且易于理解的代码，而不是关心可能会花费的一些性能开销，这只是理论上的。

在大多数情况下，性能问题不会出现在您期望的地方，并且只能在编写代码后使用在您的代码上使用的测量工具来识别。最常见的性能问题与 I/O 相关或基于您自己的代码中的一些错误（即大量创建类或循环的新实例，运行数百万次，这不是必需的......）而不是 jdk 本身.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-29T23:37:54.103

几年前我创建了一个类似的迷你框架，但它是用于原型设计而不是用于生产。

想法如下，做起来非常简单。权衡是使用反射的成本。尽管 Hibernate 和其他 ORM 工具也支付了这个成本。

这个想法很简单。

*   您有一个执行查询的 Dao 类。

*   阅读 ResultSet 元数据，您可以在其中获取表名、字段、类型等。

*   在类路径中查找与表名匹配和/或具有相同数量/类型的字段的类。

*   使用反射设置值。

*   返回此对象并将其投射到另一侧，您就完成了。

在运行时找到类似乎很荒谬。而且可能看起来也太冒险了，因为查询可能会改变或表结构可能会改变。但是想想看。发生这种情况时，您无论如何都必须更新映射以匹配新结构。因此，您只需更新匹配的类并对此感到满意。

我不知道 ORM 工具如何工作以降低反射调用成本（因为映射唯一可以帮助您找到匹配的类）在我的版本中，查找大约 30,000 个类（我添加了来自其他地方的 jar测试它）只花了 0.30 毫秒或类似的时间。我将该类保存在缓存中，第二次我不必进行查找。

如果您有兴趣（并且仍在阅读），我会尝试在我的旧 PC 中找到该库。

最后我的代码是这样的：

```
 Employee e = ( Employee ) MagicDataSource.find( "select * from employee where id = 1 "); 
```

或者

```
Employee[] emps = ( Employee[] ) MagicDataSource.findAll("select * from employee "); 
```

里面是这样的：

```
Object[] findAll( String query ) {
     ResultSet rs = getConnection().prepareStatemet( query ).executeQuery();
     ResultSetMetaData md = rs.getMetadata();
     String tableName = md.getTableName();

     String clazz = findClass( toCamelCase( tableName ) ); // search in a list where all the class names where loaded.
     Class.forName( clazz );

     while( rs.next() ) {

         for each attribute etc. etc. 
             setter...
         end

         result.append( object );
     }

    return result.toArray();
 } 
```

如果有人知道 ORM 工具如何处理反射成本，请告诉我。我从开源项目中读到的代码并没有尝试对此做任何事情。

最后，它让我可以为系统监控或类似的东西创建快速的小程序。我不再做那个工作了，那个 lib 现在已经被遗忘了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T03:20:57.710

除了 ORM...

如果您使用的是 rs.getString 和 rs.getInt 例程，那么如果您依赖命名列而不是编号列，那么您当然可以减轻维护负担。

例如，特别是 rs.getInt("id") 而不是 rs.getInt(1)。

我很少有一个实际的列更改数据类型，所以未来的 SQL 维护只是将新列添加到表中，这些可以简单地添加到你的怪物绑定列表的末尾你们每个人的小 DAO 对象。

接下来，您将采用使用列名的习惯用法，并将其扩展为使用一致名称的计划，同时使用“唯一”名称。目的是数据库中的每一列都有一个与之关联的唯一名称。从理论上讲，它可以像 tablename_columnname 一样简单（尽管很冗长），因此如果您有一个“member”表，则 id 列的列名是“member_id”。

这给你带来了什么？

它使您能够在任何“有效”结果集上使用您的通用 DAO。

“有效”结果集是使用您的唯一命名规范命名的列的结果集。

因此，您会得到“选择 id member_id，name member_name from member where id = 1”。

你为什么想这么做？为什么要去那个麻烦？

因为那样你的连接就变得微不足道了。

```
PreparedStatement = con.prepareStatement("select m.id member_id, m.name member_name, p.id post_id, p.date post_date, p.subject post_subject from member m, post p where m.id = p.member_id and m.id = 123");
ResultSet rs = ps.executeQuery();
Member m = null;
Post p = null;
while(rs.next()) {
    if (m == null) {
        m = MemberDAO.createFromResultSet(rs);
    }
    p = PostDAO.createFromResultSet(rs);
    m.addPost(p);
} 
```

看，这里的绑定逻辑并不关心结果集的内容，因为它只对它关心的列感兴趣。

在你的 DAO 中，你让他们对 ResultSet 稍微聪明一点。事实证明，如果您执行 'rs.getInt("member_id")' 并且 member_id 实际上并未发生在结果集中，您将收到 SQLException。

但是通过一些工作，使用 ResultSetMetaData，您可以进行快速预检查（通过预先获取所有列名），然后您可以调用处理这些细节的“baseDAO.getInt”而不是调用“rs.getInt”为您避免异常。

这里的美妙之处在于，一旦你这样做了，你就可以轻松地获取不完整的 DAO。

```
PreparedStatement = con.prepareStatement("select m.id member_id from member m where m.id = 123");
ResultSet rs = ps.executeQuery();
Member m = null;
if (rs.next()) {
    m = MemberDAO.createFromResultSet(rs);
} 
```

最后，它真的（真的）是一个微不足道的脚本（例如，使用 AWK），它可以获取 bean 的属性并将其转换为初始 DAO 的适当绑定代码块。类似的脚本可以轻松地获取 SQL 表语句并将其转换为 Java Bean（至少是基本成员），然后您的 IDE 将其转换为一系列 getter/setter。

通过将绑定代码集中到 DAO 中，维护实际上几乎不是什么事情，因为它在一个地方进行了更改。使用部分绑定，您可以无情地滥用它们。

```
PreparedStatement = con.prepareStatement("select m.name member_name, max(p.date) post_date from member m, post p where post.member_id = m.id and m.id = 123");
ResultSet rs = ps.executeQuery();
Member m = null;
Post p = null;
if (rs.next()) {
    m = MemberDAO.createFromResultSet(rs);
    p = MemberDAO.craateFromResultSet(rs);
}
System.out.println(m.getName() + " latest post was on " + p.getDate()); 
```

您前进的负担主要是编写 SQL，但即使这样也并不可怕。编写 SQL 和 EQL 没有太大区别。请注意，编写一个包含无数列的 select 语句确实有点糟糕，因为你不能（也不应该）使用“select * from ...”（select * always (ALWAYS) 导致麻烦，输入法）。

但这些只是现实。不过，我发现（除非你正在做报告），这个问题根本不会发生很多。大多数情况下，每张桌子至少发生一次，但不会一遍又一遍地发生。而且，很自然，一旦你拥有它一次，你可以“剪切和粘贴”你的荣耀，或者重构它（即 sql = "select " + MemberDAO.getAllColumns() + ", " + PostDAO.getAllColumns() + “来自成员 m，帖子 p”）。

现在，我喜欢 JPA 和 ORM，我发现它们很有用，但我也发现它们是 PITA。那里有一种明确的爱/恨关系。当事情进展顺利时，男孩，是否顺利。但是当它变得不稳定时——哎呀男孩。然后它会变得丑陋。但是，总的来说，我确实推荐它们。

但是如果你正在寻找一个“轻量级”的非框架，这种技术是有用的、实用的、低开销的，并且可以让你对查询有很大的控制权。在您的查询和数据库之间根本没有黑魔法或暗物质，当事情不起作用时，这不是对其他人 100K 行代码中的框架或边缘情况错误条件的某种神秘误解，而是很有可能， SQL 中的一个错误——它所属的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-28T20:44:32.200

编辑：没关系。在寻找解决我*自己*问题的方法时，我忘记检查这件事的日期。对不起。您可以忽略以下内容。

@millermj - 你这样做是为了好玩，还是因为有需要？只是好奇，因为这听起来与 Eclipse 和 NetBeans 等 Java IDE 已经提供的（使用 Java Persistence API）完全一样，具有 New->JPA->Entity Classes from Tables 功能。

我可能没有抓住重点，但如果有人*只*需要与他们的表匹配并且可以持久化的类，那么 JPA 加上一些 IDE“魔法”可能就足够了。

# nhibernate - hibernate - 映射默认实体的模式？

> ID：398994
> 
> 赞同：1
> 
> 时间：2008-12-29T23:00:40.900
> 
> 标签：nhibernate, hibernate

在 Hibernate 中映射默认数据库对象是否有一种简洁的方法？

例如，在此类中，Foo 应该始终能够返回 Bar，无论它是为 Foo 自定义定义的，还是来自存储在数据库中某处的默认值。Foo 的用户应该能够在其中设置自定义 Bar 对象，但他们不需要对 Bar 的写访问 - 因此降低了可见性。：

```
public Class Foo {
    public Bar Bar {
        get {
            return CustomBar ?? DefaultBar;
        }
    }

    public Bar CustomBar { get; set; }
    protected Bar DefaultBar { get; private set; }
} 
```

我想知道的是如何休眠映射 DefaultFoo 属性。所有 Bar 类都应该能够访问该单个 DefaultFoo 对象。我知道如何在 Hibernate 中执行此操作的唯一方法是在 Foo 中使用一对多映射。（Foo 包含一对多的酒吧）...这似乎有点笨拙，因为总是最多只有一个酒吧。这种行为有更好的模式吗？TIA。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T18:37:28.903

这也称为 NullObject 或 DefaultObject 模式。在 Hibernate 邮件列表上对此进行了一些讨论。但是我还没有看到任何关于如何将它实际存储在数据库中的信息。如果您想要一个真正的 NullObject，在数据库外部，那么您可以实现一个 Singleton 默认对象并实现 ILifecycle 接口（我认为）并否决 OnSave 事件以防止它被持久化。*****`****